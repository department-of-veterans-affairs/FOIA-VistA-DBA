KIDS Distribution saved on Jun 18, 1999@10:53:47
Released GMRC*3*4
**KIDS**:GMRC*3.0*4^

**INSTALL NAME**
GMRC*3.0*4
"BLD",953,0)
GMRC*3.0*4^CONSULT/REQUEST TRACKING^0^2990428^y
"BLD",953,1,0)
^^1^1^2990428^
"BLD",953,1,1,0)
See National Patch Module for details of enhancements.
"BLD",953,4,0)
^9.64PA^123.5^3
"BLD",953,4,123,0)
123
"BLD",953,4,123,222)
y^y^f^^^^n
"BLD",953,4,123.1,0)
123.1
"BLD",953,4,123.1,222)
y^n^f^^n^^y^o^n
"BLD",953,4,123.1,224)

"BLD",953,4,123.5,0)
123.5
"BLD",953,4,123.5,222)
y^y^f^^^^n
"BLD",953,4,"B",123,123)

"BLD",953,4,"B",123.1,123.1)

"BLD",953,4,"B",123.5,123.5)

"BLD",953,"ABPKG")
n
"BLD",953,"INI")
EN^GMRCYP4
"BLD",953,"INIT")
ONETIME^GMRCSTSU
"BLD",953,"KRN",0)
^9.67PA^19^18
"BLD",953,"KRN",.4,0)
.4
"BLD",953,"KRN",.4,"NM",0)
^9.68A^2^2
"BLD",953,"KRN",.4,"NM",1,0)
GMRC CONSULTS LIST    FILE #123^123^0
"BLD",953,"KRN",.4,"NM",2,0)
GMRC CONSULTS LIST HEADER    FILE #123^123^0
"BLD",953,"KRN",.4,"NM","B","GMRC CONSULTS LIST    FILE #123",1)

"BLD",953,"KRN",.4,"NM","B","GMRC CONSULTS LIST HEADER    FILE #123",2)

"BLD",953,"KRN",.401,0)
.401
"BLD",953,"KRN",.401,"NM",0)
^9.68A^1^1
"BLD",953,"KRN",.401,"NM",1,0)
GMRC CONSULTS LIST    FILE #123^123^0
"BLD",953,"KRN",.401,"NM","B","GMRC CONSULTS LIST    FILE #123",1)

"BLD",953,"KRN",.402,0)
.402
"BLD",953,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",953,"KRN",.402,"NM",1,0)
GMRC SERVICE USER MGMT    FILE #123.5^123.5^0
"BLD",953,"KRN",.402,"NM",2,0)
GMRC SETUP REQUEST SERVICE    FILE #123.5^123.5^0
"BLD",953,"KRN",.402,"NM","B","GMRC SERVICE USER MGMT    FILE #123.5",1)

"BLD",953,"KRN",.402,"NM","B","GMRC SETUP REQUEST SERVICE    FILE #123.5",2)

"BLD",953,"KRN",.403,0)
.403
"BLD",953,"KRN",.5,0)
.5
"BLD",953,"KRN",.84,0)
.84
"BLD",953,"KRN",3.6,0)
3.6
"BLD",953,"KRN",3.8,0)
3.8
"BLD",953,"KRN",9.2,0)
9.2
"BLD",953,"KRN",9.8,0)
9.8
"BLD",953,"KRN",9.8,"NM",0)
^9.68A^51^45
"BLD",953,"KRN",9.8,"NM",1,0)
GMRCP5^^0^B44529925
"BLD",953,"KRN",9.8,"NM",2,0)
GMRCP5A^^0^B49354696
"BLD",953,"KRN",9.8,"NM",3,0)
GMRCP5B^^0^B31916321
"BLD",953,"KRN",9.8,"NM",4,0)
GMRCP5C^^0^B49791242
"BLD",953,"KRN",9.8,"NM",5,0)
GMRCA1^^0^B15821563
"BLD",953,"KRN",9.8,"NM",6,0)
GMRCUTL1^^0^B2487353
"BLD",953,"KRN",9.8,"NM",7,0)
GMRCP513^^0^B42632
"BLD",953,"KRN",9.8,"NM",8,0)
GMRCTIU^^0^B12058070
"BLD",953,"KRN",9.8,"NM",9,0)
GMRCAU^^0^B15406844
"BLD",953,"KRN",9.8,"NM",10,0)
GMRCP5D^^0^B49856228
"BLD",953,"KRN",9.8,"NM",11,0)
GMRCAAC^^0^B6998457
"BLD",953,"KRN",9.8,"NM",12,0)
GMRCGUIA^^0^B32110464
"BLD",953,"KRN",9.8,"NM",13,0)
GMRCGUIB^^0^B16436783
"BLD",953,"KRN",9.8,"NM",14,0)
GMRCTIU1^^0^B23177260
"BLD",953,"KRN",9.8,"NM",16,0)
GMRCTIU3^^0^B8728862
"BLD",953,"KRN",9.8,"NM",17,0)
GMRCTIUA^^0^B3771284
"BLD",953,"KRN",9.8,"NM",18,0)
GMRCTIUE^^0^B25549514
"BLD",953,"KRN",9.8,"NM",19,0)
GMRCTIUL^^0^B15841263
"BLD",953,"KRN",9.8,"NM",20,0)
GMRCTIUP^^0^B53267990
"BLD",953,"KRN",9.8,"NM",21,0)
GMRCSLDT^^0^B9536985
"BLD",953,"KRN",9.8,"NM",22,0)
GMRCSLM2^^0^B39147567
"BLD",953,"KRN",9.8,"NM",23,0)
GMRCSLM3^^0^B20107255
"BLD",953,"KRN",9.8,"NM",24,0)
GMRCSLM4^^0^B19847518
"BLD",953,"KRN",9.8,"NM",25,0)
GMRCSLMU^^0^B7703750
"BLD",953,"KRN",9.8,"NM",26,0)
GMRCMER^^0^B2227423
"BLD",953,"KRN",9.8,"NM",27,0)
GMRCASF^^0^B11232167
"BLD",953,"KRN",9.8,"NM",28,0)
GMRCACMT^^0^B21785856
"BLD",953,"KRN",9.8,"NM",29,0)
GMRCSLM^^0^B34554551
"BLD",953,"KRN",9.8,"NM",30,0)
GMRCSLM1^^0^B43489370
"BLD",953,"KRN",9.8,"NM",31,0)
GMRCSLMV^^0^B1565781
"BLD",953,"KRN",9.8,"NM",32)
^^^
"BLD",953,"KRN",9.8,"NM",32,0)
GMRC513U^^1^
"BLD",953,"KRN",9.8,"NM",33,0)
GMRCUTIL^^0^B10352521
"BLD",953,"KRN",9.8,"NM",37,0)
GMRCSTSU^^0^B14345379
"BLD",953,"KRN",9.8,"NM",38,0)
GMRCYP4^^0^B3699758
"BLD",953,"KRN",9.8,"NM",40,0)
GMRCA2^^0^B6378536
"BLD",953,"KRN",9.8,"NM",41,0)
GMRCP^^0^B10716462
"BLD",953,"KRN",9.8,"NM",42)
^^^
"BLD",953,"KRN",9.8,"NM",42,0)
GMRCR06^^1
"BLD",953,"KRN",9.8,"NM",43,0)
GMRCAFRD^^0^B29295543
"BLD",953,"KRN",9.8,"NM",44,0)
GMRCART^^0^B32452056
"BLD",953,"KRN",9.8,"NM",45,0)
GMRCREXT^^0^B2145943
"BLD",953,"KRN",9.8,"NM",46,0)
GMRCSLMA^^0^B13215523
"BLD",953,"KRN",9.8,"NM",47,0)
GMRCACTM^^0^B3098073
"BLD",953,"KRN",9.8,"NM",48,0)
GMRCALRT^^0^B7437207
"BLD",953,"KRN",9.8,"NM",50,0)
GMRCGUIC^^0^B59555671
"BLD",953,"KRN",9.8,"NM",51,0)
GMRCGUIU^^0^B5871399
"BLD",953,"KRN",9.8,"NM","B","GMRC513U",32)

"BLD",953,"KRN",9.8,"NM","B","GMRCA1",5)

"BLD",953,"KRN",9.8,"NM","B","GMRCA2",40)

"BLD",953,"KRN",9.8,"NM","B","GMRCAAC",11)

"BLD",953,"KRN",9.8,"NM","B","GMRCACMT",28)

"BLD",953,"KRN",9.8,"NM","B","GMRCACTM",47)

"BLD",953,"KRN",9.8,"NM","B","GMRCAFRD",43)

"BLD",953,"KRN",9.8,"NM","B","GMRCALRT",48)

"BLD",953,"KRN",9.8,"NM","B","GMRCART",44)

"BLD",953,"KRN",9.8,"NM","B","GMRCASF",27)

"BLD",953,"KRN",9.8,"NM","B","GMRCAU",9)

"BLD",953,"KRN",9.8,"NM","B","GMRCGUIA",12)

"BLD",953,"KRN",9.8,"NM","B","GMRCGUIB",13)

"BLD",953,"KRN",9.8,"NM","B","GMRCGUIC",50)

"BLD",953,"KRN",9.8,"NM","B","GMRCGUIU",51)

"BLD",953,"KRN",9.8,"NM","B","GMRCMER",26)

"BLD",953,"KRN",9.8,"NM","B","GMRCP",41)

"BLD",953,"KRN",9.8,"NM","B","GMRCP5",1)

"BLD",953,"KRN",9.8,"NM","B","GMRCP513",7)

"BLD",953,"KRN",9.8,"NM","B","GMRCP5A",2)

"BLD",953,"KRN",9.8,"NM","B","GMRCP5B",3)

"BLD",953,"KRN",9.8,"NM","B","GMRCP5C",4)

"BLD",953,"KRN",9.8,"NM","B","GMRCP5D",10)

"BLD",953,"KRN",9.8,"NM","B","GMRCR06",42)

"BLD",953,"KRN",9.8,"NM","B","GMRCREXT",45)

"BLD",953,"KRN",9.8,"NM","B","GMRCSLDT",21)

"BLD",953,"KRN",9.8,"NM","B","GMRCSLM",29)

"BLD",953,"KRN",9.8,"NM","B","GMRCSLM1",30)

"BLD",953,"KRN",9.8,"NM","B","GMRCSLM2",22)

"BLD",953,"KRN",9.8,"NM","B","GMRCSLM3",23)

"BLD",953,"KRN",9.8,"NM","B","GMRCSLM4",24)

"BLD",953,"KRN",9.8,"NM","B","GMRCSLMA",46)

"BLD",953,"KRN",9.8,"NM","B","GMRCSLMU",25)

"BLD",953,"KRN",9.8,"NM","B","GMRCSLMV",31)

"BLD",953,"KRN",9.8,"NM","B","GMRCSTSU",37)

"BLD",953,"KRN",9.8,"NM","B","GMRCTIU",8)

"BLD",953,"KRN",9.8,"NM","B","GMRCTIU1",14)

"BLD",953,"KRN",9.8,"NM","B","GMRCTIU3",16)

"BLD",953,"KRN",9.8,"NM","B","GMRCTIUA",17)

"BLD",953,"KRN",9.8,"NM","B","GMRCTIUE",18)

"BLD",953,"KRN",9.8,"NM","B","GMRCTIUL",19)

"BLD",953,"KRN",9.8,"NM","B","GMRCTIUP",20)

"BLD",953,"KRN",9.8,"NM","B","GMRCUTIL",33)

"BLD",953,"KRN",9.8,"NM","B","GMRCUTL1",6)

"BLD",953,"KRN",9.8,"NM","B","GMRCYP4",38)

"BLD",953,"KRN",19,0)
19
"BLD",953,"KRN",19,"NM",0)
^9.68A^3^2
"BLD",953,"KRN",19,"NM",2)
^^^
"BLD",953,"KRN",19,"NM",2,0)
GMRC PRINT TEST PAGE^^0
"BLD",953,"KRN",19,"NM",3,0)
GMRC MGR^^2
"BLD",953,"KRN",19,"NM","B","GMRC MGR",3)

"BLD",953,"KRN",19,"NM","B","GMRC PRINT TEST PAGE",2)

"BLD",953,"KRN",19.1,0)
19.1
"BLD",953,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",953,"KRN",101,0)
101
"BLD",953,"KRN",101,"NM",0)
^9.68A^56^53
"BLD",953,"KRN",101,"NM",1,0)
GMRCACT PRINT CONSULT FORM^^0
"BLD",953,"KRN",101,"NM",2,0)
GMRCACTM SERVICE ACTION MENU^^2
"BLD",953,"KRN",101,"NM",3,0)
GMRCACT DETAILED DISPLAY^^0
"BLD",953,"KRN",101,"NM",4,0)
GMRCACT COMPLETE^^0
"BLD",953,"KRN",101,"NM",5,0)
GMRCACT SIGNIFICANT FINDINGS^^0
"BLD",953,"KRN",101,"NM",6,0)
GMRCACT RESULTS DISPLAY^^0
"BLD",953,"KRN",101,"NM",7,0)
GMRCACT NEW PATIENT^^0
"BLD",953,"KRN",101,"NM",8,0)
GMRCACT RECEIVED REQUEST^^0
"BLD",953,"KRN",101,"NM",10,0)
GMRCACTM CHANGE VIEW^^0
"BLD",953,"KRN",101,"NM",11,0)
GMRCACT FORWARD^^0
"BLD",953,"KRN",101,"NM",12,0)
GMRCACT COMMENT ORDERS^^0
"BLD",953,"KRN",101,"NM",13,0)
GMRCACT MAKE ADDENDUM^^0
"BLD",953,"KRN",101,"NM",14,0)
GMRCB BLANK LINE^^0
"BLD",953,"KRN",101,"NM",15,0)
GMRCACT DISCONTINUE^^0
"BLD",953,"KRN",101,"NM",16,0)
GMRCACT CANCEL REQUEST^^0
"BLD",953,"KRN",101,"NM",17,0)
GMRC SELECT ITEM^^0
"BLD",953,"KRN",101,"NM",18,0)
GMRCACT DOWN A LINE^^0
"BLD",953,"KRN",101,"NM",19,0)
GMRCACT FIRST SCREEN^^0
"BLD",953,"KRN",101,"NM",20,0)
GMRCACT GOTO PAGE^^0
"BLD",953,"KRN",101,"NM",21,0)
GMRCACT LAST SCREEN^^0
"BLD",953,"KRN",101,"NM",22,0)
GMRCACT NEXT SCREEN^^0^
"BLD",953,"KRN",101,"NM",23,0)
GMRCACT PREVIOUS SCREEN^^0
"BLD",953,"KRN",101,"NM",24,0)
GMRCACT PRINT LIST^^0
"BLD",953,"KRN",101,"NM",25,0)
GMRCACT PRINT SCREEN^^0
"BLD",953,"KRN",101,"NM",26,0)
GMRCACT QUIT^^0
"BLD",953,"KRN",101,"NM",27,0)
GMRCACT REDISPLAY^^0
"BLD",953,"KRN",101,"NM",28,0)
GMRCACT RESET MENU^^0
"BLD",953,"KRN",101,"NM",29,0)
GMRCACT SEARCH LIST^^0^
"BLD",953,"KRN",101,"NM",30,0)
GMRCACT SELECT SERVICE^^0
"BLD",953,"KRN",101,"NM",31,0)
GMRCACT TRK DATE CHANGE^^0
"BLD",953,"KRN",101,"NM",32,0)
GMRCACT UP ONE LINE^^0
"BLD",953,"KRN",101,"NM",33,0)
GMRCACT VIEW BY STATUS^^0
"BLD",953,"KRN",101,"NM",34,0)
GMRCACTM DISPLAY ACTIONS^^0
"BLD",953,"KRN",101,"NM",35,0)
GMRCACTM HIDDEN ACTIONS^^0
"BLD",953,"KRN",101,"NM",36,0)
GMRCACTM USER REVIEW SCREEN^^0
"BLD",953,"KRN",101,"NM",37,0)
GMRCB BLANK LINE1^^0
"BLD",953,"KRN",101,"NM",38,0)
GMRCB BLANK LINE2^^0
"BLD",953,"KRN",101,"NM",39,0)
GMRCB BLANK LINE3^^0
"BLD",953,"KRN",101,"NM",40,0)
GMRCB BLANK LINE4^^0
"BLD",953,"KRN",101,"NM",41,0)
GMRCB BLANK LINE5^^0
"BLD",953,"KRN",101,"NM",42)
^^^
"BLD",953,"KRN",101,"NM",42,0)
TIU ACTION CWAD DISPLAY^^4
"BLD",953,"KRN",101,"NM",43)
^^^
"BLD",953,"KRN",101,"NM",43,0)
VALM DOWN A LINE^^4
"BLD",953,"KRN",101,"NM",44)
^^^
"BLD",953,"KRN",101,"NM",44,0)
VALM FIRST SCREEN^^4
"BLD",953,"KRN",101,"NM",45)
^^^
"BLD",953,"KRN",101,"NM",45,0)
VALM GOTO PAGE^^4
"BLD",953,"KRN",101,"NM",47)
^^^
"BLD",953,"KRN",101,"NM",47,0)
VALM NEXT SCREEN^^4
"BLD",953,"KRN",101,"NM",48)
^^^
"BLD",953,"KRN",101,"NM",48,0)
VALM PREVIOUS SCREEN^^4
"BLD",953,"KRN",101,"NM",49)
^^^
"BLD",953,"KRN",101,"NM",49,0)
VALM PRINT LIST^^4
"BLD",953,"KRN",101,"NM",50)
^^^
"BLD",953,"KRN",101,"NM",50,0)
VALM PRINT SCREEN^^4
"BLD",953,"KRN",101,"NM",51)
^^^
"BLD",953,"KRN",101,"NM",51,0)
VALM QUIT^^4
"BLD",953,"KRN",101,"NM",52)
^^^
"BLD",953,"KRN",101,"NM",52,0)
VALM REFRESH^^4
"BLD",953,"KRN",101,"NM",54)
^^^
"BLD",953,"KRN",101,"NM",54,0)
VALM SEARCH LIST^^4
"BLD",953,"KRN",101,"NM",55)
^^^
"BLD",953,"KRN",101,"NM",55,0)
VALM UP ONE LINE^^4
"BLD",953,"KRN",101,"NM",56,0)
GMRCACT CWAD DISPLAY^^0
"BLD",953,"KRN",101,"NM","B","GMRC SELECT ITEM",17)

"BLD",953,"KRN",101,"NM","B","GMRCACT CANCEL REQUEST",16)

"BLD",953,"KRN",101,"NM","B","GMRCACT COMMENT ORDERS",12)

"BLD",953,"KRN",101,"NM","B","GMRCACT COMPLETE",4)

"BLD",953,"KRN",101,"NM","B","GMRCACT CWAD DISPLAY",56)

"BLD",953,"KRN",101,"NM","B","GMRCACT DETAILED DISPLAY",3)

"BLD",953,"KRN",101,"NM","B","GMRCACT DISCONTINUE",15)

"BLD",953,"KRN",101,"NM","B","GMRCACT DOWN A LINE",18)

"BLD",953,"KRN",101,"NM","B","GMRCACT FIRST SCREEN",19)

"BLD",953,"KRN",101,"NM","B","GMRCACT FORWARD",11)

"BLD",953,"KRN",101,"NM","B","GMRCACT GOTO PAGE",20)

"BLD",953,"KRN",101,"NM","B","GMRCACT LAST SCREEN",21)

"BLD",953,"KRN",101,"NM","B","GMRCACT MAKE ADDENDUM",13)

"BLD",953,"KRN",101,"NM","B","GMRCACT NEW PATIENT",7)

"BLD",953,"KRN",101,"NM","B","GMRCACT NEXT SCREEN",22)

"BLD",953,"KRN",101,"NM","B","GMRCACT PREVIOUS SCREEN",23)

"BLD",953,"KRN",101,"NM","B","GMRCACT PRINT CONSULT FORM",1)

"BLD",953,"KRN",101,"NM","B","GMRCACT PRINT LIST",24)

"BLD",953,"KRN",101,"NM","B","GMRCACT PRINT SCREEN",25)

"BLD",953,"KRN",101,"NM","B","GMRCACT QUIT",26)

"BLD",953,"KRN",101,"NM","B","GMRCACT RECEIVED REQUEST",8)

"BLD",953,"KRN",101,"NM","B","GMRCACT REDISPLAY",27)

"BLD",953,"KRN",101,"NM","B","GMRCACT RESET MENU",28)

"BLD",953,"KRN",101,"NM","B","GMRCACT RESULTS DISPLAY",6)

"BLD",953,"KRN",101,"NM","B","GMRCACT SEARCH LIST",29)

"BLD",953,"KRN",101,"NM","B","GMRCACT SELECT SERVICE",30)

"BLD",953,"KRN",101,"NM","B","GMRCACT SIGNIFICANT FINDINGS",5)

"BLD",953,"KRN",101,"NM","B","GMRCACT TRK DATE CHANGE",31)

"BLD",953,"KRN",101,"NM","B","GMRCACT UP ONE LINE",32)

"BLD",953,"KRN",101,"NM","B","GMRCACT VIEW BY STATUS",33)

"BLD",953,"KRN",101,"NM","B","GMRCACTM CHANGE VIEW",10)

"BLD",953,"KRN",101,"NM","B","GMRCACTM DISPLAY ACTIONS",34)

"BLD",953,"KRN",101,"NM","B","GMRCACTM HIDDEN ACTIONS",35)

"BLD",953,"KRN",101,"NM","B","GMRCACTM SERVICE ACTION MENU",2)

"BLD",953,"KRN",101,"NM","B","GMRCACTM USER REVIEW SCREEN",36)

"BLD",953,"KRN",101,"NM","B","GMRCB BLANK LINE",14)

"BLD",953,"KRN",101,"NM","B","GMRCB BLANK LINE1",37)

"BLD",953,"KRN",101,"NM","B","GMRCB BLANK LINE2",38)

"BLD",953,"KRN",101,"NM","B","GMRCB BLANK LINE3",39)

"BLD",953,"KRN",101,"NM","B","GMRCB BLANK LINE4",40)

"BLD",953,"KRN",101,"NM","B","GMRCB BLANK LINE5",41)

"BLD",953,"KRN",101,"NM","B","TIU ACTION CWAD DISPLAY",42)

"BLD",953,"KRN",101,"NM","B","VALM DOWN A LINE",43)

"BLD",953,"KRN",101,"NM","B","VALM FIRST SCREEN",44)

"BLD",953,"KRN",101,"NM","B","VALM GOTO PAGE",45)

"BLD",953,"KRN",101,"NM","B","VALM NEXT SCREEN",47)

"BLD",953,"KRN",101,"NM","B","VALM PREVIOUS SCREEN",48)

"BLD",953,"KRN",101,"NM","B","VALM PRINT LIST",49)

"BLD",953,"KRN",101,"NM","B","VALM PRINT SCREEN",50)

"BLD",953,"KRN",101,"NM","B","VALM QUIT",51)

"BLD",953,"KRN",101,"NM","B","VALM REFRESH",52)

"BLD",953,"KRN",101,"NM","B","VALM SEARCH LIST",54)

"BLD",953,"KRN",101,"NM","B","VALM UP ONE LINE",55)

"BLD",953,"KRN",409.61,0)
409.61
"BLD",953,"KRN",409.61,"NM",0)
^9.68A^4^4
"BLD",953,"KRN",409.61,"NM",1,0)
GMRC DETAILED DISPLAY^^0
"BLD",953,"KRN",409.61,"NM",2,0)
GMRC RESULTS DISPLAY^^0
"BLD",953,"KRN",409.61,"NM",3,0)
GMRC CONSULT TRACKING^^0
"BLD",953,"KRN",409.61,"NM",4,0)
GMRC ALERT ACTION^^0
"BLD",953,"KRN",409.61,"NM","B","GMRC ALERT ACTION",4)

"BLD",953,"KRN",409.61,"NM","B","GMRC CONSULT TRACKING",3)

"BLD",953,"KRN",409.61,"NM","B","GMRC DETAILED DISPLAY",1)

"BLD",953,"KRN",409.61,"NM","B","GMRC RESULTS DISPLAY",2)

"BLD",953,"KRN",771,0)
771
"BLD",953,"KRN",869.2,0)
869.2
"BLD",953,"KRN",870,0)
870
"BLD",953,"KRN",8994,0)
8994
"BLD",953,"KRN",8994,"NM",0)
^9.68A^^
"BLD",953,"KRN","B",.4,.4)

"BLD",953,"KRN","B",.401,.401)

"BLD",953,"KRN","B",.402,.402)

"BLD",953,"KRN","B",.403,.403)

"BLD",953,"KRN","B",.5,.5)

"BLD",953,"KRN","B",.84,.84)

"BLD",953,"KRN","B",3.6,3.6)

"BLD",953,"KRN","B",3.8,3.8)

"BLD",953,"KRN","B",9.2,9.2)

"BLD",953,"KRN","B",9.8,9.8)

"BLD",953,"KRN","B",19,19)

"BLD",953,"KRN","B",19.1,19.1)

"BLD",953,"KRN","B",101,101)

"BLD",953,"KRN","B",409.61,409.61)

"BLD",953,"KRN","B",771,771)

"BLD",953,"KRN","B",869.2,869.2)

"BLD",953,"KRN","B",870,870)

"BLD",953,"KRN","B",8994,8994)

"BLD",953,"QUES",0)
^9.62^^
"BLD",953,"REQB",0)
^9.611^5^5
"BLD",953,"REQB",1,0)
OR*3.0*21^2
"BLD",953,"REQB",2,0)
TIU*1.0*4^2
"BLD",953,"REQB",3,0)
TIU*1.0*19^2
"BLD",953,"REQB",4,0)
TIU*1.0*31^2
"BLD",953,"REQB",5,0)
GMRC*3.0*1^2
"BLD",953,"REQB","B","GMRC*3.0*1",5)

"BLD",953,"REQB","B","OR*3.0*21",1)

"BLD",953,"REQB","B","TIU*1.0*19",3)

"BLD",953,"REQB","B","TIU*1.0*31",4)

"BLD",953,"REQB","B","TIU*1.0*4",2)

"DATA",123.1,1,0)
ENTERED IN CPRS^5^^^  ^NW^IP^^
"DATA",123.1,2,0)
CPRS RELEASED ORDER^^^USE ENTERED IN CPRS AFTER CONSULTS 2.5^^
"DATA",123.1,3,0)
STATUS CHANGE^^^^SC^^SC^Status Change^^
"DATA",123.1,4,0)
SIG FINDING UPDATE^^^^^^^Significant Findings Update^^
"DATA",123.1,6,0)
DISCONTINUED^1^^^OD^DC^DC^Discontinued^^
"DATA",123.1,8,0)
SCHEDULED^6^^^SC^^SC^^
"DATA",123.1,9,0)
INCOMPLETE RPT^9^^^SC^^A^^
"DATA",123.1,10,0)
COMPLETE/UPDATE^2^^^RE^^CM^Administrative Complete^^
"DATA",123.1,11,0)
EDIT/RESUBMITTED^5^^^XX^^RP^Edit/Resubmit^^
"DATA",123.1,12,0)
DISASSOCIATE RESULT^^^^^^^Disassociate Result^^
"DATA",123.1,13,0)
ADDENDUM ADDED TO^2^^^RE^^CM^^
"DATA",123.1,14,0)
NEW NOTE ADDED^2^^^RE^^CM^^
"DATA",123.1,15,0)
SERVICE ENTERED^6^^^SN^^SC^^
"DATA",123.1,16,0)
EDIT BEFORE RELEASE^^^NOT AVAILABLE AFTER CONSULTS 2.5^^
"DATA",123.1,17,0)
FORWARDED FROM^5^^^XX^^IP^Forwarded^^
"DATA",123.1,19,0)
CANCELLED^13^^^OC^CA^CA^Cancelled/Denied^^
"DATA",123.1,20,0)
ADDED COMMENT^^^^^^^Added^^
"DATA",123.1,21,0)
RECEIVED^6^^^SC^^SC^^
"DATA",123.1,22,0)
PRINTED TO^^
"DATA",123.1,99,0)
UNKNOWN ACTION^99^^
"FIA",123)
REQUEST/CONSULTATION
"FIA",123,0)
^GMR(123,
"FIA",123,0,0)
123DI
"FIA",123,0,1)
y^y^f^^^^n
"FIA",123,0,10)

"FIA",123,0,11)

"FIA",123,0,"RLRO")

"FIA",123,0,"VR")
3.0^GMRC
"FIA",123,123)
0
"FIA",123,123.01)
0
"FIA",123,123.02)
0
"FIA",123,123.03)
0
"FIA",123,123.25)
0
"FIA",123.1)
REQUEST ACTION TYPES
"FIA",123.1,0)
^GMR(123.1,
"FIA",123.1,0,0)
123.1
"FIA",123.1,0,1)
y^n^f^^n^^y^o^n
"FIA",123.1,0,10)

"FIA",123.1,0,11)

"FIA",123.1,0,"RLRO")

"FIA",123.1,0,"VR")
3.0^GMRC
"FIA",123.1,123.1)
0
"FIA",123.5)
REQUEST SERVICES
"FIA",123.5,0)
^GMR(123.5,
"FIA",123.5,0,0)
123.5
"FIA",123.5,0,1)
y^y^f^^^^n
"FIA",123.5,0,10)

"FIA",123.5,0,11)

"FIA",123.5,0,"RLRO")

"FIA",123.5,0,"VR")
3.0^GMRC
"FIA",123.5,123.5)
0
"FIA",123.5,123.51)
0
"FIA",123.5,123.5101)
0
"FIA",123.5,123.52)
0
"FIA",123.5,123.53)
0
"FIA",123.5,123.54)
0
"FIA",123.5,123.55)
0
"FIA",123.5,123.555)
0
"FIA",123.5,123.56)
0
"INI")
EN^GMRCYP4
"INIT")
ONETIME^GMRCSTSU
"KRN",.4,539,-1)
0^1
"KRN",.4,539,0)
GMRC CONSULTS LIST^2920512.2233^^123^^^2980508^
"KRN",.4,539,"DXS",1,9.2)
S I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^GMR(123,D0,0)):^(0),1:""),D0=$P(DIP(1),U,12) S:'$D(^ORD(100.01,+D0,0)) D0=-1 S DIP(101)=$S($D(^ORD(100.01,D0,.1)):^(.1),1:"")
"KRN",.4,539,"DXS",2,9)
S I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^GMR(123,D0,0)):^(0),1:""),D0=$P(DIP(1),U,4) S:'$D(^SC(+D0,0)) D0=-1 S DIP(101)=$S($D(^SC(D0,0)):^(0),1:"") S X=$P(DIP(101),U,2) S D0=I(0,0)
"KRN",.4,539,"F",1)
X DXS(1,9.2) S X=$E(DIP(101),1,245) S D0=I(0,0) W X K DIP;C2;L1;Z;"OE/RR STATUS:ABBREVIATION"~9;C8;L15~D DT^GMRCSL;Z;"D DT^GMRCSL"~
"KRN",.4,539,"F",2)
D PAT^GMRCSL;Z;"D PAT^GMRCSL"~X DXS(2,9) W X K DIP;L5;C72;Z;"PATIENT LOCATION:ABBREVIATION"~
"KRN",.4,539,"H")
[GMRC CONSULTS LIST HEADER]
"KRN",.4,540,-1)
0^2
"KRN",.4,540,0)
GMRC CONSULTS LIST HEADER^2950707.1136^^123^^^2980508
"KRN",.4,540,"F",1)
"TO SERVICE: ";C1~1;C13~"Pt.";C72;S~"Sts    Last Action         Date of Request   Patient      SSN      Loc ";C1~
"KRN",.4,540,"F",2)
"-----------------------------------------------------------------------------";C1~
"KRN",.4,540,"H")
@
"KRN",.4,540,"SUB")
1
"KRN",.401,228,-1)
0^1
"KRN",.401,228,0)
GMRC CONSULTS LIST^2920514.1537^^123^^^2980508^
"KRN",.401,228,2,0)
^.4014^2^2
"KRN",.401,228,2,1,0)
123^^TO^]#"1^^^^^^4
"KRN",.401,228,2,1,"ASK")
1
"KRN",.401,228,2,1,"CM")
S Y(1)=$S($D(^GMR(123,D0,0)):^(0),1:"") S X=$S('$D(^GMR(123.5,+$P(Y(1),U,5),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(1)=X
"KRN",.401,228,2,1,"F")
CARDIOLOGXz^CARDIOLOGY
"KRN",.401,228,2,1,"GET")
S Y(1)=$S($D(^GMR(123,D0,0)):^(0),1:"") S X=$S('$D(^GMR(123.5,+$P(Y(1),U,5),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(1)=X
"KRN",.401,228,2,1,"IX")
^GMR(123,"C",^GMR(123,^2
"KRN",.401,228,2,1,"PTRIX")
^GMR(123.5,"B",
"KRN",.401,228,2,1,"QCON")
I DISX(1)="CARDIOLOGY"
"KRN",.401,228,2,1,"SER")
2.0606^0.6733
"KRN",.401,228,2,1,"T")
CARDIOLOGY^CARDIOLOGY
"KRN",.401,228,2,1,"TXT")
TO equals CARDIOLOGY
"KRN",.401,228,2,2,0)
123^3^DATE OF REQUEST^-+@^^^^^^1
"KRN",.401,228,2,2,"GET")
S DISX(2)=$P($G(^GMR(123,D0,0)),U,7)
"KRN",.401,228,2,2,"QCON")
I DISX(2)'=""
"KRN",.401,228,2,2,"SER")
0.0000^0.0000
"KRN",.401,228,2,2,"TXT")
DATE OF REQUEST not null
"KRN",.401,228,2,"B",123,1)

"KRN",.401,228,2,"B",123,2)

"KRN",.402,763,-1)
0^2
"KRN",.402,763,0)
GMRC SETUP REQUEST SERVICE^2981215.1555^^123.5^^^2990617
"KRN",.402,763,"DIAB",1,1,123.51,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.52,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.53,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.55,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.555,0)
ALL
"KRN",.402,763,"DIAB",3,0,123.5,0)
1.11;"ABBREVIATED PRINT NAME (Optional)"
"KRN",.402,763,"DR",1,123.5)
.01;123.01///^S X="CONSULTS";1.11ABBREVIATED PRINT NAME (Optional)~;1.1;2;123.09;123.03;123.3;123.33;123.08;123.1;10;101;
"KRN",.402,763,"DR",2,123.51)
.01:2
"KRN",.402,763,"DR",2,123.5101)
.01;
"KRN",.402,763,"DR",2,123.52)
.01
"KRN",.402,763,"DR",2,123.53)
.01
"KRN",.402,763,"DR",2,123.55)
.01
"KRN",.402,763,"DR",2,123.555)
.01
"KRN",.402,764,-1)
0^1
"KRN",.402,764,0)
GMRC SERVICE USER MGMT^2980430.1312^^123.5^^^2990617
"KRN",.402,764,"DIAB",1,1,123.53,0)
ALL
"KRN",.402,764,"DIAB",1,1,123.54,0)
ALL
"KRN",.402,764,"DIAB",1,1,123.55,0)
ALL
"KRN",.402,764,"DIAB",1,1,123.555,0)
ALL
"KRN",.402,764,"DR",1,123.5)
123.3;123.33;123.08;123.1;123.2;
"KRN",.402,764,"DR",2,123.53)
.01
"KRN",.402,764,"DR",2,123.54)
.01:2
"KRN",.402,764,"DR",2,123.55)
.01
"KRN",.402,764,"DR",2,123.555)
.01
"KRN",19,2046,-1)
2^3
"KRN",19,2046,0)
GMRC MGR^Consult Management^^M^.5^^^^^^^128
"KRN",19,2046,10,0)
^19.01PI^10^10
"KRN",19,2046,10,10,0)
6814^TP
"KRN",19,2046,10,10,"^")
GMRC PRINT TEST PAGE
"KRN",19,2046,"U")
CONSULT MANAGEMENT
"KRN",19,6814,-1)
0^2
"KRN",19,6814,0)
GMRC PRINT TEST PAGE^Print Test Page^^R^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",19,6814,1,0)
^^4^4^2980316^
"KRN",19,6814,1,1,0)
This option allows a user to select a printer for reviewing print
"KRN",19,6814,1,2,0)
parameters. A report is generated which includes the current device print
"KRN",19,6814,1,3,0)
parameters and a ruler to verify the length of the current print page. A
"KRN",19,6814,1,4,0)
description of how to use the ruler is included in the report.
"KRN",19,6814,25)
SETUP^GMRCP5
"KRN",19,6814,"U")
PRINT TEST PAGE
"KRN",101,1393,-1)
0^36
"KRN",101,1393,0)
GMRCACTM USER REVIEW SCREEN^Consult/Request Review^^M^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1393,1,0)
^^2^2^2980727^^^^
"KRN",101,1393,1,1,0)
This is the actions which may be taken by a user in the Consult/Request
"KRN",101,1393,1,2,0)
Tracking package.
"KRN",101,1393,4)
23^3^^ACT
"KRN",101,1393,10,0)
^101.01PA^15^5
"KRN",101,1393,10,5,0)
1723^PF^6^^^
"KRN",101,1393,10,5,1)

"KRN",101,1393,10,5,"^")
GMRCACT PRINT CONSULT FORM
"KRN",101,1393,10,6,0)
1718^DD^4^^^
"KRN",101,1393,10,6,"^")
GMRCACT DETAILED DISPLAY
"KRN",101,1393,10,7,0)
1712^RT^5^^^
"KRN",101,1393,10,7,"^")
GMRCACT RESULTS DISPLAY
"KRN",101,1393,10,12,0)
1720^SP^1^^^Select Patient
"KRN",101,1393,10,12,"^")
GMRCACT NEW PATIENT
"KRN",101,1393,10,15,0)
5042^CV^2^
"KRN",101,1393,10,15,"^")
GMRCACTM CHANGE VIEW
"KRN",101,1393,26)
D PHDR^GMRCSLMA
"KRN",101,1393,28)
Select Action: 
"KRN",101,1393,99)
57695,49256
"KRN",101,1402,-1)
0^30
"KRN",101,1402,0)
GMRCACT SELECT SERVICE^Service^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1402,1,0)
^^1^1^2980703^^
"KRN",101,1402,1,1,0)
Select a service/specialty to review consults
"KRN",101,1402,4)
^^^SS
"KRN",101,1402,15)
D EXIT^GMRCSLMA("R")
"KRN",101,1402,20)
D SS^GMRCSLM,ENTRY^GMRCSLMA("HL")
"KRN",101,1402,21,0)
^101.021A^^0
"KRN",101,1402,99)
57323,50595
"KRN",101,1712,-1)
0^6
"KRN",101,1712,0)
GMRCACT RESULTS DISPLAY^Results Display^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1712,1,0)
^^3^3^2980713^^^^
"KRN",101,1712,1,1,0)
Display the consult result using the RT. This will list all TIU consult
"KRN",101,1712,1,2,0)
reports (with addenda), all Medicine package results, and resolution
"KRN",101,1712,1,3,0)
comments.
"KRN",101,1712,15)
D EXIT^GMRCSLMA("R")
"KRN",101,1712,20)
D RT^GMRCA1(""),ENTRY^GMRCSLMA("H")
"KRN",101,1712,26)
S XQORM("A")="Select Action: "
"KRN",101,1712,28)

"KRN",101,1712,99)
57471,48368
"KRN",101,1712,101.04)
^
"KRN",101,1717,-1)
0^12
"KRN",101,1717,0)
GMRCACT COMMENT ORDERS^Add Comment^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1717,.1)

"KRN",101,1717,1,0)
^^1^1^2980804^^^^
"KRN",101,1717,1,1,0)
Add a comment to a consult.
"KRN",101,1717,2,0)
^101.02A^^0
"KRN",101,1717,4)
^3
"KRN",101,1717,15)
D EXIT^GMRCSLMA("R")
"KRN",101,1717,20)
D COMMENT^GMRCA1(""),ENTRY^GMRCSLMA("")
"KRN",101,1717,99)
57471,48368
"KRN",101,1718,-1)
0^3
"KRN",101,1718,0)
GMRCACT DETAILED DISPLAY^Detailed Display ^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1718,1,0)
^^1^1^2981019^^^^
"KRN",101,1718,1,1,0)
Display consult details for order, audit log, and results
"KRN",101,1718,4)
^3
"KRN",101,1718,10,0)
^101.01PA^0^0
"KRN",101,1718,15)
D EXIT^GMRCSLDT,EXIT^GMRCSLMA("R")
"KRN",101,1718,20)
D EN^GMRCSLDT,ENTRY^GMRCSLMA("H")
"KRN",101,1718,99)
57471,48368
"KRN",101,1720,-1)
0^7
"KRN",101,1720,0)
GMRCACT NEW PATIENT^Select Patient^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1720,1,0)
^^1^1^2981019^^^^
"KRN",101,1720,1,1,0)
Select a new patient
"KRN",101,1720,10,0)
^101.01PA^0^0
"KRN",101,1720,15)
S VALMBCK="R",VALMBG=1 K GMRCSEL,GMRCO,GMRCND
"KRN",101,1720,20)
D SP^GMRCSLM S VALMBCK="R" Q:$D(GMRCQUT)  D INIT^GMRCSLM,HDR^GMRCSLM
"KRN",101,1720,99)
57471,48368
"KRN",101,1723,-1)
0^1
"KRN",101,1723,0)
GMRCACT PRINT CONSULT FORM^Print Form 513^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1723,1,0)
^^1^1^2980915^^^^
"KRN",101,1723,1,1,0)
Print Consult Std Form 513 for an order
"KRN",101,1723,10,0)
^101.01PA^0^0
"KRN",101,1723,15)
D EXIT^GMRCSLMA("R")
"KRN",101,1723,20)
S VALMBCK="R" D SEL^GMRCP5 Q:$D(GMRCQUT)  D EN^GMRCP5(GMRCND),ENTRY^GMRCSLMA("")
"KRN",101,1723,21,0)
^101.021A
"KRN",101,1723,99)
57471,48368
"KRN",101,1973,-1)
0^11
"KRN",101,1973,0)
GMRCACT FORWARD^Forward^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1973,1,0)
^^1^1^2980727^^^^
"KRN",101,1973,1,1,0)
Forward order to another service
"KRN",101,1973,4)
^3
"KRN",101,1973,10,0)
^101.01PA^0^0
"KRN",101,1973,15)
D EXIT^GMRCSLMA("R")
"KRN",101,1973,20)
D FR^GMRCAFRD("") S:$D(GMRCSS) GMRCDG=GMRCSS D:$D(GMRCDG) SERV1^GMRCASV D ENTRY^GMRCSLMA("HL")
"KRN",101,1973,99)
57471,48368
"KRN",101,1999,-1)
0^15
"KRN",101,1999,0)
GMRCACT DISCONTINUE^Discontinue^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1999,1,0)
^^1^1^2980714^^
"KRN",101,1999,1,1,0)
Discontinue an order. (Updates OE/RR status to "dc")
"KRN",101,1999,4)
24^2
"KRN",101,1999,10,0)
^101.01PA^0^0
"KRN",101,1999,15)
D EXIT^GMRCSLMA("R")
"KRN",101,1999,20)
S GMRCA=6 D DC^GMRCA1("",GMRCA),ENTRY^GMRCSLMA("L")
"KRN",101,1999,99)
57471,48368
"KRN",101,2070,-1)
0^16
"KRN",101,2070,0)
GMRCACT CANCEL REQUEST^Cancel (Deny)^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,2070,1,0)
^^3^3^2980714^^
"KRN",101,2070,1,1,0)
The service may cancel a consult request, with an explanation. (Updates
"KRN",101,2070,1,2,0)
OE/RR status to "x").  Requestors of cancelled consults may edit and
"KRN",101,2070,1,3,0)
resubmit the request.
"KRN",101,2070,4)
^3
"KRN",101,2070,15)
D EXIT^GMRCSLMA("R")
"KRN",101,2070,20)
S GMRCA=19 D DC^GMRCA1("",GMRCA),ENTRY^GMRCSLMA("L")
"KRN",101,2070,99)
57471,48368
"KRN",101,2071,-1)
0^4
"KRN",101,2071,0)
GMRCACT COMPLETE^Complete/Update^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,2071,1,0)
^^1^1^2980804^^^^
"KRN",101,2071,1,1,0)
Complete/Update the results for a consult.
"KRN",101,2071,4)
^^^CT
"KRN",101,2071,10,0)
^101.01PA^0^0
"KRN",101,2071,15)
D EXIT^GMRCSLMA("R")
"KRN",101,2071,20)
D ENTER^GMRCTIU(""),ENTRY^GMRCSLMA("LH")
"KRN",101,2071,99)
57471,48368
"KRN",101,2112,-1)
2^2
"KRN",101,2112,0)
GMRCACTM SERVICE ACTION MENU^Service Action Menu^^Q^18^^^^^^^128
"KRN",101,2112,1,0)
^^4^4^2980826^^^^
"KRN",101,2112,1,1,0)
This is the menu of actions which may be used for a service to keep
"KRN",101,2112,1,2,0)
track service activities for consults and requests.  There are paging,
"KRN",101,2112,1,3,0)
print and tracking actions included.  The tracking actions perform an
"KRN",101,2112,1,4,0)
activity tracking audit trail.
"KRN",101,2112,4)
18^3
"KRN",101,2112,10,0)
^101.01PA^25^14
"KRN",101,2112,10,5,0)
1723^PF^23^^^
"KRN",101,2112,10,5,"^")
GMRCACT PRINT CONSULT FORM
"KRN",101,2112,10,6,0)
1718^DD^21^^^
"KRN",101,2112,10,6,"^")
GMRCACT DETAILED DISPLAY
"KRN",101,2112,10,7,0)
1712^RT^22^^^
"KRN",101,2112,10,7,"^")
GMRCACT RESULTS DISPLAY
"KRN",101,2112,10,9,0)
1720^SP^1^^^
"KRN",101,2112,10,9,"^")
GMRCACT NEW PATIENT
"KRN",101,2112,10,10,0)
5042^CV^2^^^
"KRN",101,2112,10,10,"^")
GMRCACTM CHANGE VIEW
"KRN",101,2112,10,13,0)
2121^RC^3^^^
"KRN",101,2112,10,13,"^")
GMRCACT RECEIVED REQUEST
"KRN",101,2112,10,14,0)
1973^FR^9^^^
"KRN",101,2112,10,14,"^")
GMRCACT FORWARD
"KRN",101,2112,10,15,0)
1717^CM^12^^^
"KRN",101,2112,10,15,"^")
GMRCACT COMMENT ORDERS
"KRN",101,2112,10,17,0)
2071^CT^14^^^
"KRN",101,2112,10,17,"^")
GMRCACT COMPLETE
"KRN",101,2112,10,18,0)
1999^DC^11^^^
"KRN",101,2112,10,18,"^")
GMRCACT DISCONTINUE
"KRN",101,2112,10,19,0)
2070^CX^10^^^
"KRN",101,2112,10,19,"^")
GMRCACT CANCEL REQUEST
"KRN",101,2112,10,23,0)
5021^MA^15^^^
"KRN",101,2112,10,23,"^")
GMRCACT MAKE ADDENDUM
"KRN",101,2112,10,24,0)
5043^^4^
"KRN",101,2112,10,24,"^")
GMRCB BLANK LINE
"KRN",101,2112,10,25,0)
5121^SF^16^
"KRN",101,2112,10,25,"^")
GMRCACT SIGNIFICANT FINDINGS
"KRN",101,2112,10,"B",1712,7)

"KRN",101,2112,10,"B",1717,15)

"KRN",101,2112,10,"B",1718,6)

"KRN",101,2112,10,"B",1720,9)

"KRN",101,2112,10,"B",1723,5)

"KRN",101,2112,10,"B",1973,14)

"KRN",101,2112,10,"B",1999,18)

"KRN",101,2112,10,"B",2070,19)

"KRN",101,2112,10,"B",2071,17)

"KRN",101,2112,10,"B",2121,13)

"KRN",101,2112,10,"B",5021,23)

"KRN",101,2112,10,"B",5042,10)

"KRN",101,2112,10,"B",5043,24)

"KRN",101,2112,10,"B",5121,25)

"KRN",101,2112,26)
D PHDR^GMRCSLMA
"KRN",101,2112,28)
Select Action: 
"KRN",101,2112,99)
57790,45042
"KRN",101,2121,-1)
0^8
"KRN",101,2121,0)
GMRCACT RECEIVED REQUEST^Receive^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,2121,1,0)
^^1^1^2980713^^^^
"KRN",101,2121,1,1,0)
Acknowledge the receipt of a consult (updates CPRS status to active).
"KRN",101,2121,4)
^3^^RC
"KRN",101,2121,10,0)
^101.01PA^0^0
"KRN",101,2121,15)
D EXIT^GMRCSLMA("R")
"KRN",101,2121,20)
D RC^GMRCA1(""),ENTRY^GMRCSLMA("L")
"KRN",101,2121,28)

"KRN",101,2121,99)
57471,48369
"KRN",101,2759,-1)
4^47
"KRN",101,2759,0)
VALM NEXT SCREEN
"KRN",101,2760,-1)
4^48
"KRN",101,2760,0)
VALM PREVIOUS SCREEN
"KRN",101,2761,-1)
4^52
"KRN",101,2761,0)
VALM REFRESH
"KRN",101,2763,-1)
4^44
"KRN",101,2763,0)
VALM FIRST SCREEN
"KRN",101,2764,-1)
4^55
"KRN",101,2764,0)
VALM UP ONE LINE
"KRN",101,2765,-1)
4^43
"KRN",101,2765,0)
VALM DOWN A LINE
"KRN",101,2767,-1)
4^51
"KRN",101,2767,0)
VALM QUIT
"KRN",101,2768,-1)
4^50
"KRN",101,2768,0)
VALM PRINT SCREEN
"KRN",101,2769,-1)
4^49
"KRN",101,2769,0)
VALM PRINT LIST
"KRN",101,2773,-1)
4^54
"KRN",101,2773,0)
VALM SEARCH LIST
"KRN",101,2783,-1)
4^45
"KRN",101,2783,0)
VALM GOTO PAGE
"KRN",101,3730,-1)
0^31
"KRN",101,3730,0)
GMRCACT TRK DATE CHANGE^Date Range^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,3730,1,0)
^^1^1^2980703^^^^
"KRN",101,3730,1,1,0)
Select a new date range for displaying consults.
"KRN",101,3730,2,0)
^101.02A^1^1
"KRN",101,3730,2,1,0)
DT
"KRN",101,3730,2,"B","DT",1)

"KRN",101,3730,4)
18^4
"KRN",101,3730,10,0)
^101.01PA^0^0
"KRN",101,3730,15)
D EXIT^GMRCSLMA("R")
"KRN",101,3730,20)
D ^GMRCSPD,SELEXIT^GMRCSLMA
"KRN",101,3730,26)

"KRN",101,3730,28)

"KRN",101,3730,99)
57323,51958
"KRN",101,4037,-1)
0^33
"KRN",101,4037,0)
GMRCACT VIEW BY STATUS^Status^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,4037,1,0)
^^1^1^2980703^
"KRN",101,4037,1,1,0)
Allows a user to specify the status of the Consults to be displayed.
"KRN",101,4037,2,0)
^101.02A^1^1
"KRN",101,4037,2,1,0)
ST
"KRN",101,4037,2,"B","ST",1)

"KRN",101,4037,15)
D EXIT^GMRCSLMA("R")
"KRN",101,4037,20)
D EN^GMRCSTAT,ENTRY^GMRCSLMA("HL")
"KRN",101,4037,99)
57323,50919
"KRN",101,4277,-1)
0^22
"KRN",101,4277,0)
GMRCACT NEXT SCREEN^Next Screen^^X^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,4277,2,0)
^101.02A^1^1
"KRN",101,4277,2,1,0)
NX
"KRN",101,4277,2,"B","NX",1)

"KRN",101,4277,10,0)
^101.01PA^2^2
"KRN",101,4277,10,1,0)
5131^^2^
"KRN",101,4277,10,1,"^")
GMRCACT RESET MENU
"KRN",101,4277,10,2,0)
2759^^1^
"KRN",101,4277,10,2,1)

"KRN",101,4277,10,2,"^")
VALM NEXT SCREEN
"KRN",101,4277,20)
S XQORM("A")="Select Action: "
"KRN",101,4277,28)
Select Action: 
"KRN",101,4277,99)
57596,55659
"KRN",101,4278,-1)
0^23
"KRN",101,4278,0)
GMRCACT PREVIOUS SCREEN^Previous Screen^^X^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,4278,10,0)
^101.01PA^2^2
"KRN",101,4278,10,1,0)
5131^^2^
"KRN",101,4278,10,1,"^")
GMRCACT RESET MENU
"KRN",101,4278,10,2,0)
2760^^1^
"KRN",101,4278,10,2,"^")
VALM PREVIOUS SCREEN
"KRN",101,4278,99)
57596,55659
"KRN",101,4279,-1)
0^26
"KRN",101,4279,0)
GMRCACT QUIT^Exit^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,4279,20)
S VALMBCK="Q",GMRCQUT=1
"KRN",101,4279,99)
57526,85455
"KRN",101,4280,-1)
0^27
"KRN",101,4280,0)
GMRCACT REDISPLAY^Redisplay Screen^^X^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,4280,10,0)
^101.01PA^2^2
"KRN",101,4280,10,1,0)
5131^^2^
"KRN",101,4280,10,1,"^")
GMRCACT RESET MENU
"KRN",101,4280,10,2,0)
2761^^1^
"KRN",101,4280,10,2,"^")
VALM REFRESH
"KRN",101,4280,99)
57596,55659
"KRN",101,4732,-1)
4^42
"KRN",101,4732,0)
TIU ACTION CWAD DISPLAY
"KRN",101,4770,-1)
0^17
"KRN",101,4770,0)
GMRC SELECT ITEM^Place a consult item in reverse video.^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,4770,1,0)
^^4^4^2980901^^^^
"KRN",101,4770,1,1,0)
This protocol is used when a user of the consults package or interface
"KRN",101,4770,1,2,0)
selects a consult record. When the record is entered (by number), it is
"KRN",101,4770,1,3,0)
highlighted in inverse video. The user can then choose an action for the
"KRN",101,4770,1,4,0)
item (i.e., DC a consult, Receive a consult, etc.).
"KRN",101,4770,15)
S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU") Q
"KRN",101,4770,20)
D SET^GMRCSLMV(+$P(XQORNOD(0),"=",2))
"KRN",101,4770,21,0)
^101.021A
"KRN",101,4770,99)
57117,33328
"KRN",101,5021,-1)
0^13
"KRN",101,5021,0)
GMRCACT MAKE ADDENDUM^Make Addendum^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5021,1,0)
^^1^1^2980716^^^^
"KRN",101,5021,1,1,0)
Make an addendum to the Result of the Consult in TIU.
"KRN",101,5021,4)
^3
"KRN",101,5021,15)
D EXIT^GMRCSLMA("R")
"KRN",101,5021,20)
D ADDEND^GMRCTIU(""),ENTRY^GMRCSLMA("LH")
"KRN",101,5021,99)
57471,48369
"KRN",101,5042,-1)
0^10
"KRN",101,5042,0)
GMRCACTM CHANGE VIEW^Change View ...^^M^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5042,1,0)
^^2^2^2980819^^^^
"KRN",101,5042,1,1,0)
This is the menu of selection criteria for consults (date range, service,
"KRN",101,5042,1,2,0)
or status).
"KRN",101,5042,10,0)
^101.01PA^4^4
"KRN",101,5042,10,1,0)
3730^DT^1^
"KRN",101,5042,10,1,"^")
GMRCACT TRK DATE CHANGE
"KRN",101,5042,10,2,0)
4037^ST^2^
"KRN",101,5042,10,2,"^")
GMRCACT VIEW BY STATUS
"KRN",101,5042,10,3,0)
1402^SS^3^
"KRN",101,5042,10,3,"^")
GMRCACT SELECT SERVICE
"KRN",101,5042,10,4,0)
5043^^^
"KRN",101,5042,10,4,"^")
GMRCB BLANK LINE
"KRN",101,5042,15)
D EXIT^GMRCSLMA("R")
"KRN",101,5042,26)
W ""
"KRN",101,5042,99)
57695,50104
"KRN",101,5043,-1)
0^14
"KRN",101,5043,0)
GMRCB BLANK LINE^   ^^A^^^^^^^^
"KRN",101,5043,1,0)
^^2^2^2971217^^^^
"KRN",101,5043,1,1,0)
   
"KRN",101,5043,1,2,0)
Displays a blank line.  (Item text is 3 spaces.)  Use to get whitespace.
"KRN",101,5043,2,0)
^101.02A^1^1
"KRN",101,5043,2,1,0)
BLANK
"KRN",101,5043,2,"B","BLANK",1)

"KRN",101,5043,99)
57471,48369
"KRN",101,5121,-1)
0^5
"KRN",101,5121,0)
GMRCACT SIGNIFICANT FINDINGS^Sig Findings^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5121,1,0)
^^1^1^2980804^^^^
"KRN",101,5121,1,1,0)
Update the significant findings flag for a consult.
"KRN",101,5121,2,0)
^101.02A^2^1
"KRN",101,5121,2,2,0)
SF
"KRN",101,5121,2,"B","SF",2)

"KRN",101,5121,4)
^3
"KRN",101,5121,15)
D EXIT^GMRCSLMA("R")
"KRN",101,5121,20)
D SF^GMRCASF(""),ENTRY^GMRCSLMA("LH")
"KRN",101,5121,99)
57471,48369
"KRN",101,5131,-1)
0^28
"KRN",101,5131,0)
GMRCACT RESET MENU^Reset Menu Definition^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5131,4)
^^^
"KRN",101,5131,20)
S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"KRN",101,5131,26)

"KRN",101,5131,99)
57526,63133
"KRN",101,5132,-1)
0^35
"KRN",101,5132,0)
GMRCACTM HIDDEN ACTIONS^Hidden Actions for List Manager^^M^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5132,4)
26
"KRN",101,5132,10,0)
^101.01PA^25^18
"KRN",101,5132,10,1,0)
4277^+^11^
"KRN",101,5132,10,1,"^")
GMRCACT NEXT SCREEN
"KRN",101,5132,10,2,0)
4278^-^12^
"KRN",101,5132,10,2,"^")
GMRCACT PREVIOUS SCREEN
"KRN",101,5132,10,3,0)
5134^FS^13^
"KRN",101,5132,10,3,"^")
GMRCACT FIRST SCREEN
"KRN",101,5132,10,4,0)
5135^LS^14^
"KRN",101,5132,10,4,"^")
GMRCACT LAST SCREEN
"KRN",101,5132,10,5,0)
5154^GO^16^
"KRN",101,5132,10,5,"^")
GMRCACT GOTO PAGE
"KRN",101,5132,10,6,0)
5155^UP^21^
"KRN",101,5132,10,6,"^")
GMRCACT UP ONE LINE
"KRN",101,5132,10,7,0)
5156^DN^22^
"KRN",101,5132,10,7,"^")
GMRCACT DOWN A LINE
"KRN",101,5132,10,10,0)
5157^SL^36^
"KRN",101,5132,10,10,"^")
GMRCACT SEARCH LIST
"KRN",101,5132,10,11,0)
4280^RD^17^
"KRN",101,5132,10,11,"^")
GMRCACT REDISPLAY
"KRN",101,5132,10,12,0)
5158^PS^26^
"KRN",101,5132,10,12,"^")
GMRCACT PRINT SCREEN
"KRN",101,5132,10,13,0)
5160^PT^27^
"KRN",101,5132,10,13,"^")
GMRCACT PRINT LIST
"KRN",101,5132,10,16,0)
5159^CWAD^33^
"KRN",101,5132,10,16,"^")
GMRCACT CWAD DISPLAY
"KRN",101,5132,10,20,0)
4279^EX^37^
"KRN",101,5132,10,20,"^")
GMRCACT QUIT
"KRN",101,5132,10,21,0)
5150^^15^^O
"KRN",101,5132,10,21,"^")
GMRCB BLANK LINE1
"KRN",101,5132,10,22,0)
5151^^25^^O
"KRN",101,5132,10,22,"^")
GMRCB BLANK LINE2
"KRN",101,5132,10,23,0)
5161^^35^^O
"KRN",101,5132,10,23,"^")
GMRCB BLANK LINE3
"KRN",101,5132,10,24,0)
5162^^28^^O
"KRN",101,5132,10,24,"^")
GMRCB BLANK LINE4
"KRN",101,5132,10,25,0)
5163^^38^^O
"KRN",101,5132,10,25,"^")
GMRCB BLANK LINE5
"KRN",101,5132,28)
Select Action: 
"KRN",101,5132,99)
57790,48417
"KRN",101,5134,-1)
0^19
"KRN",101,5134,0)
GMRCACT FIRST SCREEN^First Screen^^X^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5134,10,0)
^101.01PA^2^2
"KRN",101,5134,10,1,0)
5131^^2^
"KRN",101,5134,10,1,"^")
GMRCACT RESET MENU
"KRN",101,5134,10,2,0)
2763^^1^
"KRN",101,5134,10,2,"^")
VALM FIRST SCREEN
"KRN",101,5134,99)
57596,55659
"KRN",101,5135,-1)
0^21
"KRN",101,5135,0)
GMRCACT LAST SCREEN^Last Screen^^X^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5135,10,0)
^101.01PA^2^2
"KRN",101,5135,10,1,0)
5131^^2^
"KRN",101,5135,10,1,"^")
GMRCACT RESET MENU
"KRN",101,5135,99)
57596,55659
"KRN",101,5136,-1)
0^34
"KRN",101,5136,0)
GMRCACTM DISPLAY ACTIONS^Display menu^^M^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5136,1,0)
^^1^1^2980716^^^^
"KRN",101,5136,1,1,0)
Menu of display actions which users can use to process through the display.
"KRN",101,5136,4)
26^5
"KRN",101,5136,10,0)
^101.01PA^27^13
"KRN",101,5136,10,15,0)
2759^+^1^
"KRN",101,5136,10,15,1)
Select Action: 
"KRN",101,5136,10,15,"^")
VALM NEXT SCREEN
"KRN",101,5136,10,16,0)
2760^-^2^
"KRN",101,5136,10,16,"^")
VALM PREVIOUS SCREEN
"KRN",101,5136,10,17,0)
2763^FS^3^
"KRN",101,5136,10,17,"^")
VALM FIRST SCREEN
"KRN",101,5136,10,19,0)
2764^UP^11^
"KRN",101,5136,10,19,"^")
VALM UP ONE LINE
"KRN",101,5136,10,20,0)
2765^DN^12^
"KRN",101,5136,10,20,"^")
VALM DOWN A LINE
"KRN",101,5136,10,21,0)
2783^GO^13^
"KRN",101,5136,10,21,"^")
VALM GOTO PAGE
"KRN",101,5136,10,22,0)
2773^SL^14^
"KRN",101,5136,10,22,"^")
VALM SEARCH LIST
"KRN",101,5136,10,23,0)
2768^PS^22^
"KRN",101,5136,10,23,"^")
VALM PRINT SCREEN
"KRN",101,5136,10,24,0)
2769^PT^23^^^Print Data
"KRN",101,5136,10,24,"^")
VALM PRINT LIST
"KRN",101,5136,10,25,0)
2767^Q^24^^^Close
"KRN",101,5136,10,25,"^")
VALM QUIT
"KRN",101,5136,10,26,0)
5150^^5^^O
"KRN",101,5136,10,26,"^")
GMRCB BLANK LINE1
"KRN",101,5136,10,27,0)
5151^^15^^O
"KRN",101,5136,10,27,"^")
GMRCB BLANK LINE2
"KRN",101,5136,26)
D PHDR^GMRCSLDT
"KRN",101,5136,28)
Select Action: 
"KRN",101,5136,99)
57706,47006
"KRN",101,5150,-1)
0^37
"KRN",101,5150,0)
GMRCB BLANK LINE1^^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5150,1,0)
^^1^1^2980714^
"KRN",101,5150,1,1,0)
Displays a blank line.  (Item Text is 3 spaces.) Use to get whitespace.
"KRN",101,5151,-1)
0^38
"KRN",101,5151,0)
GMRCB BLANK LINE2^^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5151,1,0)
^^1^1^2980714^
"KRN",101,5151,1,1,0)
Displays a blank line. (Item text is 3 spaces.) Use to get whitespace.
"KRN",101,5154,-1)
0^20
"KRN",101,5154,0)
GMRCACT GOTO PAGE^Go to Page^^X^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5154,10,0)
^101.01PA^2^2
"KRN",101,5154,10,1,0)
5131^^2^
"KRN",101,5154,10,1,"^")
GMRCACT RESET MENU
"KRN",101,5154,10,2,0)
2783^^1^
"KRN",101,5154,10,2,"^")
VALM GOTO PAGE
"KRN",101,5154,99)
57596,55660
"KRN",101,5155,-1)
0^32
"KRN",101,5155,0)
GMRCACT UP ONE LINE^Up a Line^^X^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5155,10,0)
^101.01PA^2^2
"KRN",101,5155,10,1,0)
5131^^2^
"KRN",101,5155,10,1,"^")
GMRCACT RESET MENU
"KRN",101,5155,10,2,0)
2764^^1^
"KRN",101,5155,10,2,"^")
VALM UP ONE LINE
"KRN",101,5155,99)
57596,55659
"KRN",101,5156,-1)
0^18
"KRN",101,5156,0)
GMRCACT DOWN A LINE^Down a Line^^X^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5156,10,0)
^101.01PA^2^2
"KRN",101,5156,10,1,0)
5131^^2^
"KRN",101,5156,10,1,"^")
GMRCACT RESET MENU
"KRN",101,5156,10,2,0)
2765^^1^
"KRN",101,5156,10,2,"^")
VALM DOWN A LINE
"KRN",101,5156,99)
57596,55659
"KRN",101,5157,-1)
0^29
"KRN",101,5157,0)
GMRCACT SEARCH LIST^Search List^^X^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5157,10,0)
^101.01PA^2^2
"KRN",101,5157,10,1,0)
5131^^2^
"KRN",101,5157,10,1,"^")
GMRCACT RESET MENU
"KRN",101,5157,10,2,0)
2773^^1^
"KRN",101,5157,10,2,"^")
VALM SEARCH LIST
"KRN",101,5157,99)
57596,55660
"KRN",101,5158,-1)
0^25
"KRN",101,5158,0)
GMRCACT PRINT SCREEN^Print Screen^^X^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5158,10,0)
^101.01PA^2^2
"KRN",101,5158,10,1,0)
5131^^2^
"KRN",101,5158,10,1,"^")
GMRCACT RESET MENU
"KRN",101,5158,10,2,0)
2768^^1^
"KRN",101,5158,10,2,"^")
VALM PRINT SCREEN
"KRN",101,5158,99)
57539,86369
"KRN",101,5159,-1)
0^56
"KRN",101,5159,0)
GMRCACT CWAD DISPLAY^Display CWAD Info^^X^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5159,10,0)
^101.01PA^2^2
"KRN",101,5159,10,1,0)
5131^^2^
"KRN",101,5159,10,1,"^")
GMRCACT RESET MENU
"KRN",101,5159,10,2,0)
4732^^1^
"KRN",101,5159,10,2,"^")
TIU ACTION CWAD DISPLAY
"KRN",101,5159,15)
D EXIT^GMRCSLMA("R")
"KRN",101,5159,99)
57790,48348
"KRN",101,5160,-1)
0^24
"KRN",101,5160,0)
GMRCACT PRINT LIST^Print List^^X^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5160,10,0)
^101.01PA^2^2
"KRN",101,5160,10,1,0)
5131^^2^
"KRN",101,5160,10,1,"^")
GMRCACT RESET MENU
"KRN",101,5160,10,2,0)
2769^^1^
"KRN",101,5160,10,2,"^")
VALM PRINT LIST
"KRN",101,5160,99)
57562,38923
"KRN",101,5161,-1)
0^39
"KRN",101,5161,0)
GMRCB BLANK LINE3^^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5161,1,0)
^^1^1^2980714^
"KRN",101,5161,1,1,0)
Displays a blank line. (Item text is 3 spaces.) Use to get whitespace.
"KRN",101,5162,-1)
0^40
"KRN",101,5162,0)
GMRCB BLANK LINE4^^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5162,1,0)
^^1^1^2980716^^
"KRN",101,5162,1,1,0)
Displays a blank line. (Item text is 3 spaces.) Use to get whitespace.
"KRN",101,5163,-1)
0^41
"KRN",101,5163,0)
GMRCB BLANK LINE5^^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5163,1,0)
^^1^1^2980716^^
"KRN",101,5163,1,1,0)
Displays a blank line.  (Item Text is 3 spaces.) Use to get whitespace.
"KRN",101,5163,99)
57540,853
"KRN",409.61,157,-1)
0^3
"KRN",409.61,157,0)
GMRC CONSULT TRACKING^1^1^80^5^16^1^1^^GMRCACTM USER REVIEW SCREEN^CONSULT TRACKING^1^^1
"KRN",409.61,157,1)
^GMRCACTM HIDDEN ACTIONS
"KRN",409.61,157,"ARRAY")
 ^TMP("GMRCR",$J,"LIST")
"KRN",409.61,157,"COL",0)
^409.621^5^5
"KRN",409.61,157,"COL",1,0)
CONSULT NO^1^3^^
"KRN",409.61,157,"COL",2,0)
DATE^5^9^Requested
"KRN",409.61,157,"COL",3,0)
STATUS^16^3^St^
"KRN",409.61,157,"COL",4,0)
NO^20^7^   No.^R
"KRN",409.61,157,"COL",5,0)
SRV/PROC^29^49^Consult/Procedure Request^
"KRN",409.61,157,"COL","B","CONSULT NO",1)

"KRN",409.61,157,"COL","B","DATE",2)

"KRN",409.61,157,"COL","B","NO",4)

"KRN",409.61,157,"COL","B","SRV/PROC",5)

"KRN",409.61,157,"COL","B","STATUS",3)

"KRN",409.61,157,"FNL")
D CLRTRK^GMRCCLR,CLEAR^VALM1,KILL^VALM10(),EXIT^GMRCSTLM
"KRN",409.61,157,"HDR")
D HDR^GMRCSLM
"KRN",409.61,157,"HLP")
D HELP^GMRCSLM
"KRN",409.61,157,"INIT")
K GMRCOER D AD^GMRCSLM1,INIT^GMRCSLM,HDR^GMRCSLM
"KRN",409.61,162,-1)
0^1
"KRN",409.61,162,0)
GMRC DETAILED DISPLAY^2^1^80^5^19^1^1^^GMRCACTM DISPLAY ACTIONS^Consult Detailed Display^1^^1
"KRN",409.61,162,1)
^GMRCACTM DISPLAY ACTIONS
"KRN",409.61,162,"ARRAY")
 ^TMP("GMRCR",$J,"DTLIST")
"KRN",409.61,162,"COL",0)
^409.621
"KRN",409.61,162,"EXP")

"KRN",409.61,162,"FNL")
D EXIT^GMRCSLDT S VALMBCK="R"
"KRN",409.61,162,"HDR")
D HDR^GMRCSLDT
"KRN",409.61,162,"HLP")
D HELP^GMRCSLDT
"KRN",409.61,162,"INIT")

"KRN",409.61,275,-1)
0^4
"KRN",409.61,275,0)
GMRC ALERT ACTION^1^1^80^5^16^1^1^^GMRCACTM ALERT BASIC ACTIONS^Consult/Request Alerts^4^^1
"KRN",409.61,275,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,275,"ARRAY")
 ^TMP("GMRCR",$J,"CS")
"KRN",409.61,275,"COL",0)
^409.621^5^5
"KRN",409.61,275,"COL",1,0)
CONSULT NO^1^3^
"KRN",409.61,275,"COL",2,0)
DATE^5^9^Requested
"KRN",409.61,275,"COL",3,0)
STATUS^16^3^St
"KRN",409.61,275,"COL",4,0)
NO^20^7^   No.
"KRN",409.61,275,"COL",5,0)
SRV/PROC^29^49^Consult/Procedure Request
"KRN",409.61,275,"COL","B","CONSULT NO",1)

"KRN",409.61,275,"COL","B","DATE",2)

"KRN",409.61,275,"COL","B","NO",4)

"KRN",409.61,275,"COL","B","SRV/PROC",5)

"KRN",409.61,275,"COL","B","STATUS",3)

"KRN",409.61,275,"FNL")
D CLRTRK^GMRCCLR,CLEAR^VALM1,KILL^VALM10()
"KRN",409.61,275,"HDR")
D HDR^GMRCALRT
"KRN",409.61,275,"HLP")
D HELP^GMRCALRT
"KRN",409.61,275,"INIT")
D INIT^GMRCALRT,HDR^GMRCALRT
"KRN",409.61,278,-1)
0^2
"KRN",409.61,278,0)
GMRC RESULTS DISPLAY^2^^80^5^19^1^1^^GMRCACTM DISPLAY ACTIONS^Results Display^1^^1
"KRN",409.61,278,1)
^GMRCACTM DISPLAY ACTIONS
"KRN",409.61,278,"ARRAY")
 ^TMP("GMRCR",$J,"DTLIST")
"KRN",409.61,278,"FNL")
D EXIT^GMRCMER S VALMBCK="R"
"KRN",409.61,278,"HDR")
D HDR^GMRCMER
"KRN",409.61,278,"HLP")
D HELP^GMRCMER
"KRN",409.61,278,"INIT")
D INIT^GMRCMER
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",6,.401)
.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"ORD",6,.401,0)
SORT TEMPLATE
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
4^2990428^18
"PKG",128,22,1,"PAH",1,1,0)
^^1^1^2990618
"PKG",128,22,1,"PAH",1,1,1,0)
See National Patch Module for details of enhancements.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
45
"RTN","GMRC513U")
1^32
"RTN","GMRCA1")
0^5^B15821563
"RTN","GMRCA1",1,0)
GMRCA1 ;SLC/DLT,DCM - Actions taken from Review Screens ;6/29/98  23:50
"RTN","GMRCA1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCA1",3,0)
DC(GMRCO,GMRCA) ;Discontinue/Cancel(Deny) logic
"RTN","GMRCA1",4,0)
 ;GMRCO = File 123 IEN of consult
"RTN","GMRCA1",5,0)
 ;GMRCA = Action to take: 6=DISCONTINUED, 19=CANCELLED
"RTN","GMRCA1",6,0)
 ;GMRCOM=comments array
"RTN","GMRCA1",7,0)
 I '$G(GMRCA) S GMRCMSG="This Action not defined!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCA1",8,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCA1",9,0)
 D DC^GMRCADC(GMRCO,GMRCA)
"RTN","GMRCA1",10,0)
 D END
"RTN","GMRCA1",11,0)
 Q
"RTN","GMRCA1",12,0)
 ;
"RTN","GMRCA1",13,0)
COMMENT(GMRCO) ;Add a comment without changing the status
"RTN","GMRCA1",14,0)
 N GMRCA
"RTN","GMRCA1",15,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCA1",16,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCA1",17,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",18,0)
 D COMMENT^GMRCACMT(+GMRCO)
"RTN","GMRCA1",19,0)
 Q
"RTN","GMRCA1",20,0)
 ;
"RTN","GMRCA1",21,0)
RC(GMRCO) ;Service tracking request has been received.
"RTN","GMRCA1",22,0)
 K GMRCQUT,GMRCQIT,GMRCSEL,GMRCAGN
"RTN","GMRCA1",23,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCA1",24,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",25,0)
 ;
"RTN","GMRCA1",26,0)
 N GMRCDA,GMRCIFN
"RTN","GMRCA1",27,0)
 S GMRC(0)=^GMR(123,GMRCO,0)
"RTN","GMRCA1",28,0)
 S DFN=$P(GMRC(0),"^",2)
"RTN","GMRCA1",29,0)
 I $S($P(GMRC(0),"^",12)=2:1,$P(^(0),"^",12)=1:1,$P(^(0),"^",12)=13:1,1:0) D  S GMRCQUT=1 D END Q
"RTN","GMRCA1",30,0)
 .S GMRCMSG="This consult has already been "_$S($P(GMRC(0),"^",12)=2:"Completed",$P(^(0),"^",12)=13:"Cancelled",1:"Discontinued")_"."
"RTN","GMRCA1",31,0)
 .S GMRCMSG(1)=" No Receive action may be taken now."
"RTN","GMRCA1",32,0)
 .D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCA1",33,0)
 .K GMRCMSG
"RTN","GMRCA1",34,0)
 .Q
"RTN","GMRCA1",35,0)
 I $P(^GMR(123.5,$P(GMRC(0),"^",5),0),"^",2)=9 S GMRCMSG=$P(^(0),"^",1)_" is an INACTIVE service. No Receive action is possible",GMRCMSG(1)="for this consult on this Service!" D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCA1",36,0)
 I $P(GMRC(0),"^",12)'=5 S GMRCMSG="The receive action may only be taken when the consult has a pending status."  D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCA1",37,0)
 ;
"RTN","GMRCA1",38,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCA1",39,0)
 S GETPROV="Who received it?" D GETPROV^GMRCAU K GETPROV I $D(GMRCQIT) D END S GMRCQIT="Q",GMRCQUT=1 Q
"RTN","GMRCA1",40,0)
 S GETDT="Date/Time Actually Received" D GETDT^GMRCAU K GETDT I $D(GMRCQIT) W !!,$C(7),"Consult not updated with Received action.",!,"Press <ENTER> To Exit: " R X:DTIME D END S GMRCQUT=1 Q
"RTN","GMRCA1",41,0)
 ;The activity date is stored in GMRCAD
"RTN","GMRCA1",42,0)
 S GMRCA=21 ;for "Received"
"RTN","GMRCA1",43,0)
 I $P(GMRC(0),"^",12)=5 S GMRCSTS=6,$P(GMRC(0),"^",12)=GMRCSTS
"RTN","GMRCA1",44,0)
 E  S GMRCSTS=$P(GMRC(0),"^",12)
"RTN","GMRCA1",45,0)
 D STATUS^GMRCP
"RTN","GMRCA1",46,0)
 D AUDIT^GMRCP
"RTN","GMRCA1",47,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCWARD),"SC",GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCA1",48,0)
 D END
"RTN","GMRCA1",49,0)
 Q
"RTN","GMRCA1",50,0)
 ;
"RTN","GMRCA1",51,0)
RT(GMRCO) ;Results Display logic
"RTN","GMRCA1",52,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCA1",53,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCA1",54,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",55,0)
 D RT^GMRCART(GMRCO)
"RTN","GMRCA1",56,0)
 D END
"RTN","GMRCA1",57,0)
 Q
"RTN","GMRCA1",58,0)
 ;
"RTN","GMRCA1",59,0)
PS(GMRCO) ;Print Service Copy (CPRS entry point)
"RTN","GMRCA1",60,0)
 K GMRCQUT,GMRCQIT,GMRCSEL
"RTN","GMRCA1",61,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCA1",62,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",63,0)
 S GMRC(0)=^GMR(123,GMRCO,0)
"RTN","GMRCA1",64,0)
 D EN^GMRCP5(GMRCO)
"RTN","GMRCA1",65,0)
 D END
"RTN","GMRCA1",66,0)
 Q
"RTN","GMRCA1",67,0)
 ;
"RTN","GMRCA1",68,0)
END ;kill off variables and exit
"RTN","GMRCA1",69,0)
 I '$D(GMRC("NMBR")) K GMRCSEL,GMRCO
"RTN","GMRCA1",70,0)
 K GMRC(0),GMRCA,GMRCACTM,GMRCAGN,GMRCDFN,GMRCENTR,GMRCFL,GMRCIEN,GMRCMSG,GMRCOM,GMRCO,GMRCORFN,GMRCORN,GMRCORTX,GMRCRTFL,GMRCSEL,GMRCSTS,GMRCTRLC,GMRCEND,GMRCSA,GMRCSR,GMRCBM,GMRCTM,GMRCADUZ,ORIFN,OREND,SF,STS
"RTN","GMRCA1",71,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCA1",72,0)
 K DTOUT,DIROUT,DUOUT
"RTN","GMRCA1",73,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCA1",74,0)
 Q
"RTN","GMRCA2")
0^40^B6378536
"RTN","GMRCA2",1,0)
GMRCA2 ;SLC/KCM,DLT - Select prompt for processing actions ;9/8/98  03:37
"RTN","GMRCA2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCA2",3,0)
SELECT(GMRCO) ; Select the consult to process
"RTN","GMRCA2",4,0)
 ;This utility checks the GMRCO variable against the selection list
"RTN","GMRCA2",5,0)
 ;  Input variable used:
"RTN","GMRCA2",6,0)
 ;          BLK, LNCT, GMRCO
"RTN","GMRCA2",7,0)
 ;          GMRC("NMBR")
"RTN","GMRCA2",8,0)
 ;  Output variables returned:
"RTN","GMRCA2",9,0)
 ;          GMRCQUT=1 if no consult was selected
"RTN","GMRCA2",10,0)
 ;          GMRCQUT is not defined on return when selection made
"RTN","GMRCA2",11,0)
 ;          GMRCO=    consult selected from list
"RTN","GMRCA2",12,0)
 K GMRCQUT,GMRCSEL
"RTN","GMRCA2",13,0)
 N GMRCAGN
"RTN","GMRCA2",14,0)
 I '$L($G(GMRCO)) D  Q:$D(GMRCQUT)  G:$D(GMRCAGN) SELECT
"RTN","GMRCA2",15,0)
 .;use the highlighted number if defined
"RTN","GMRCA2",16,0)
 .I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR")
"RTN","GMRCA2",17,0)
 .I '$D(GMRCSEL),$D(LNCT),LNCT=1 S GMRCSEL=LNCT
"RTN","GMRCA2",18,0)
 .I $S('+$G(GMRCSEL):1,+GMRCSEL<1:1,+GMRCSEL>BLK:1,GMRCSEL="":1,1:0) K GMRCSEL D:+$G(GMRC("NMBR")) AGAIN^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCA2",19,0)
 .I '+$G(GMRCSEL) D SEL I $S($D(DTOUT):1,$D(DIROUT):1,$D(GMRCQUT):1,'+GMRCSEL:1,1:0) K GMRCSEL S GMRCQUT=1 Q
"RTN","GMRCA2",20,0)
 .I $S(+GMRCSEL<1:1,GMRCSEL>BLK:1,1:0) W !,"Select a consult listed in the number range 1 to "_BLK S GMRCAGN=1 Q
"RTN","GMRCA2",21,0)
 .S GMRCO=$O(^TMP("GMRCR",$J,"CS","AD",GMRCSEL,GMRCSEL,0))
"RTN","GMRCA2",22,0)
 .I '+GMRCO D
"RTN","GMRCA2",23,0)
 .. S GMRCQUT=1
"RTN","GMRCA2",24,0)
 .. W !,$C(7),"Select a consult by entering its listed number between 1 and "_LNCT_"."
"RTN","GMRCA2",25,0)
 .. K GMRCO,GMRCSEL
"RTN","GMRCA2",26,0)
 . Q
"RTN","GMRCA2",27,0)
 Q
"RTN","GMRCA2",28,0)
 ;
"RTN","GMRCA2",29,0)
SEL ;Select order number(s)   exit: GMRCSEL
"RTN","GMRCA2",30,0)
 I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR") Q
"RTN","GMRCA2",31,0)
 I '$D(^TMP("GMRCR",$J,"CS","AD")) W !,"No orders to select.",! S GMRCQUT=1,GMRCSEL="" Q
"RTN","GMRCA2",32,0)
 I '$O(^TMP("GMRCR",$J,"CS","AD")),BLK=1 S GMRCSEL=BLK Q
"RTN","GMRCA2",33,0)
 S GMRCSEL="" W !,"CHOOSE No. 1-",BLK,": " R X:DTIME S:X="^^" DIROUT=1 I '$T!(X["^") S (DTOUT,GMRCQUT)=1 Q
"RTN","GMRCA2",34,0)
 I X["?" D SELHELP G SEL
"RTN","GMRCA2",35,0)
 I X="" S GMRCQUT=1 Q
"RTN","GMRCA2",36,0)
 I X'?.3N W $C(7)," ??  Enter the number from the far left of the list." G SEL
"RTN","GMRCA2",37,0)
 I $S(X>BLK:1,X<1:1,1:0) D SELHELP G SEL
"RTN","GMRCA2",38,0)
 S GMRCSEL=X
"RTN","GMRCA2",39,0)
 Q
"RTN","GMRCA2",40,0)
SELHELP ;Help to select a valid entry
"RTN","GMRCA2",41,0)
 W !,"Select a request by typing the number from the left column and pressing <ENTER>.",!
"RTN","GMRCA2",42,0)
 Q
"RTN","GMRCA2",43,0)
UP ;Convert lower to upper case   entry: X   exit: X
"RTN","GMRCA2",44,0)
 F %=1:1:$L(X) I $E(X,%)?1L S X=$E(X,1,%-1)_$C($A(X,%)-32)_$E(X,%+1,99)
"RTN","GMRCA2",45,0)
 Q
"RTN","GMRCAAC")
0^11^B6998457
"RTN","GMRCAAC",1,0)
GMRCAAC ;SLC/DLT - Administrative Complete action consult logic ;7/16/98  01:47
"RTN","GMRCAAC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCAAC",3,0)
COMP(GMRCO) ;Clerk action to Complete an order
"RTN","GMRCAAC",4,0)
 ;GMRCO is the selected consult
"RTN","GMRCAAC",5,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCAAC",6,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCAAC",7,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCAAC",8,0)
 ;
"RTN","GMRCAAC",9,0)
 N GMRC,GMRCSTS,GMRCQUT
"RTN","GMRCAAC",10,0)
 S GMRC(0)=$G(^GMR(123,+GMRCO,0)) Q:GMRC(0)=""
"RTN","GMRCAAC",11,0)
 ;
"RTN","GMRCAAC",12,0)
 ;Completion action restricted if status is 1,2,or 13
"RTN","GMRCAAC",13,0)
 S GMRCSTS=$P(GMRC(0),"^",12)
"RTN","GMRCAAC",14,0)
 I $S(GMRCSTS<3:1,GMRCSTS=13:1,1:0) D  Q
"RTN","GMRCAAC",15,0)
 . N GMRCMSG
"RTN","GMRCAAC",16,0)
 . S GMRCMSG="This order has already been "_$S(GMRCSTS=1:"discontinued",GMRCSTS=2:"completed",1:"cancelled")_"!"
"RTN","GMRCAAC",17,0)
 . D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCAAC",18,0)
 . S GMRCQUT=1
"RTN","GMRCAAC",19,0)
 . D END
"RTN","GMRCAAC",20,0)
 ;
"RTN","GMRCAAC",21,0)
 ;Get the provider, activity date, and significant findings
"RTN","GMRCAAC",22,0)
 N DFN,ORIFN,ORGY,GMRCSF,GMRCSTS,GMRCA,GMRCDR,GMRCORNP,GMRCAD,GMRCADUZ
"RTN","GMRCAAC",23,0)
 S ORGY="",(GMRCIFN,ORIFN)=$P(GMRC(0),"^",3),GMRCORVP=$P(GMRC(0),"^",2)_";DPT("
"RTN","GMRCAAC",24,0)
 S DFN=+GMRCORVP
"RTN","GMRCAAC",25,0)
 N GETPROV D GETPROV^GMRCAU I $G(GMRCQIT)="Q" D END Q
"RTN","GMRCAAC",26,0)
 N GETDT D GETDT^GMRCAU I $G(GMRCQIT)="Q" D END Q
"RTN","GMRCAAC",27,0)
 S GMRCSFO=$P(GMRC(0),"^",19)
"RTN","GMRCAAC",28,0)
 S GMRCSF=$$GETSIGF^GMRCASF(GMRCSFO) I GMRCSF=0 D END Q
"RTN","GMRCAAC",29,0)
 ;
"RTN","GMRCAAC",30,0)
 ;Update status, last action and significant findings
"RTN","GMRCAAC",31,0)
 S GMRCSTS=2,GMRCA=10
"RTN","GMRCAAC",32,0)
 S GMRCDR="8////^S X=GMRCSTS;9////^S X=GMRCA;15////^S X=GMRCSF"
"RTN","GMRCAAC",33,0)
 D STATUS^GMRCP
"RTN","GMRCAAC",34,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG) Q
"RTN","GMRCAAC",35,0)
 ;Update the Activity Log for an audit trail
"RTN","GMRCAAC",36,0)
 S GMRCOM=1 D AUDIT^GMRCP
"RTN","GMRCAAC",37,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCAAC",38,0)
 ;
"RTN","GMRCAAC",39,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCAAC",40,0)
 S GMRCADUZ=""
"RTN","GMRCAAC",41,0)
 I $P(^GMR(123,GMRCO,0),"^",14) S GMRCADUZ($P(^(0),"^",14))=""
"RTN","GMRCAAC",42,0)
 S GMRCORTX="Completed Consult "_$$ORTX^GMRCAU(GMRCO)_$S(GMRCSF="Y":" with Sig Findings",GMRCSF="N":" with no Sig Findings",1:"")
"RTN","GMRCAAC",43,0)
 D MSG^GMRCP($P(^GMR(123,GMRCO,0),"^",2),GMRCORTX,+GMRCO,23,.GMRCADUZ,0)
"RTN","GMRCAAC",44,0)
 Q
"RTN","GMRCAAC",45,0)
 ;
"RTN","GMRCAAC",46,0)
NOUPD ;Exit without making an update
"RTN","GMRCAAC",47,0)
 S GMRCMSG="Completion activity ignored."
"RTN","GMRCAAC",48,0)
 D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCAAC",49,0)
 Q
"RTN","GMRCAAC",50,0)
END K DUOUT,X,Y,GMRCPL,GMRCPLI,GMRCURG,GMRCURGI,GMRCPRI,XQORM
"RTN","GMRCAAC",51,0)
 I '$D(GMRCNM) K GMRCVP
"RTN","GMRCAAC",52,0)
 K GMRCDT,GMRCAD,GMRCL,GMRCTYPE
"RTN","GMRCAAC",53,0)
 I '$D(GMRCO) S (GMRCO,ORIFN)=""
"RTN","GMRCAAC",54,0)
 K GMRCIFN,GMRCMSG,GMRCORTX,GMRCSA,GMRCSTS,GMRCADUZ,STS
"RTN","GMRCAAC",55,0)
 Q
"RTN","GMRCACMT")
0^28^B21785856
"RTN","GMRCACMT",1,0)
GMRCACMT ;SLC/DLT,DCM - Comment Action and alerting ;6/2/98  12:12
"RTN","GMRCACMT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCACMT",3,0)
COMMENT(GMRCO) ;Add a comment without changing the status
"RTN","GMRCACMT",4,0)
 K GMRCQIT,GMRCQUT N GMRCA
"RTN","GMRCACMT",5,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCACMT",6,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCAD=GMRCNOW
"RTN","GMRCACMT",7,0)
 S GMRCOM=1,GMRCA=20,GMRCPROV=$P(^GMR(123,GMRCO,0),"^",14) D AUDIT^GMRCP
"RTN","GMRCACMT",8,0)
 ;GMRCOM=1 defined the variable and tells AUDIT^GMRCP that the word-processing logic should be executed. If an actual comment is added, $P(GMRCOM,"^",2)=1 (send alert), if not GMRCOM=1 and no '^' exists (do not send alert)
"RTN","GMRCACMT",9,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG),END Q
"RTN","GMRCACMT",10,0)
 ;continue if no lock problems occurred
"RTN","GMRCACMT",11,0)
 I $P(GMRCOM,"^",2) D PROCALRT("",1,20)
"RTN","GMRCACMT",12,0)
 D END
"RTN","GMRCACMT",13,0)
 Q
"RTN","GMRCACMT",14,0)
 ;
"RTN","GMRCACMT",15,0)
PROCALRT(GMRCORTX,GMRCDELR,ACTION) ;Process alert for comments
"RTN","GMRCACMT",16,0)
 ;If GMRCDELR=1, the ordering provider can be deleted from the list.
"RTN","GMRCACMT",17,0)
 N GMRCADUZ,GMRCANS,NOTIF,GMRCQIT
"RTN","GMRCACMT",18,0)
 S GMRCANS=$$READ("Y","Do You Wish To Send An Alert With This Comment","N","Enter Y to continue with recipient prompts. Otherwise, enter N.",1)
"RTN","GMRCACMT",19,0)
 I (GMRCANS[U)!(GMRCANS=0) D END Q
"RTN","GMRCACMT",20,0)
 ;
"RTN","GMRCACMT",21,0)
 D WHOTO
"RTN","GMRCACMT",22,0)
 I $G(GMRCQIT) D END Q  ;User "^" at requesting provider.
"RTN","GMRCACMT",23,0)
 S NOTIF=$S(ACTION=20:27,1:23)
"RTN","GMRCACMT",24,0)
 ; Use NEW SERVICE CONSULT/REQUEST (27) for the ADD COMMENT action to
"RTN","GMRCACMT",25,0)
 ;     prevent the forced PAO entries that occur with the
"RTN","GMRCACMT",26,0)
 ;     CONSULT/REQUEST RESOLUTION (23) notification.
"RTN","GMRCACMT",27,0)
 D SENDMSG(NOTIF,+GMRCO)
"RTN","GMRCACMT",28,0)
 Q
"RTN","GMRCACMT",29,0)
 ;
"RTN","GMRCACMT",30,0)
SENDMSG(NOTIF,GMRCO) ;Send the alert
"RTN","GMRCACMT",31,0)
 N GMRCDFN
"RTN","GMRCACMT",32,0)
 I '$D(GMRCADUZ) S GMRCADUZ=""
"RTN","GMRCACMT",33,0)
 W !,"Processing Alerts..."
"RTN","GMRCACMT",34,0)
 S GMRCDFN=$P($G(^GMR(123,+GMRCO,0)),"^",2)
"RTN","GMRCACMT",35,0)
 S GMRCORTX=$S($L(GMRCORTX):GMRCORTX,1:"Comment Added to Consult ")_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCACMT",36,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,NOTIF,.GMRCADUZ,0)
"RTN","GMRCACMT",37,0)
 Q
"RTN","GMRCACMT",38,0)
 ;
"RTN","GMRCACMT",39,0)
END ;kill off variables and exit
"RTN","GMRCACMT",40,0)
 K GMRC,GMRCA,GMRCMSG,GMRCOM,GMRCO,GMRCORTX,GMRCERR,GMRCERMS,GMRCQUT,GMRCUT
"RTN","GMRCACMT",41,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCACMT",42,0)
 K DTOUT,DIROUT,DUOUT,DIRUT
"RTN","GMRCACMT",43,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCACMT",44,0)
 Q
"RTN","GMRCACMT",45,0)
 ;
"RTN","GMRCACMT",46,0)
WHOTO ;Get the users who should receive an alert
"RTN","GMRCACMT",47,0)
 ;Asks about requesting provider first, then prompts for additional users
"RTN","GMRCACMT",48,0)
 ;Returns GMRCADUZ array of users to send an alert to and GMRCQIT if "^"
"RTN","GMRCACMT",49,0)
 N GMRCRP,GMRCANS
"RTN","GMRCACMT",50,0)
 S GMRCRP=$P($G(^GMR(123,+GMRCO,0)),U,14) ;requesting provider entry
"RTN","GMRCACMT",51,0)
 I +GMRCRP S GMRCRP=$P($G(^VA(200,+GMRCRP,0)),U,1) ;provider name
"RTN","GMRCACMT",52,0)
 ;GMRCRP is now the requestor name or null
"RTN","GMRCACMT",53,0)
 I $L(GMRCRP) D  I GMRCANS[U S GMRCQIT=1 Q
"RTN","GMRCACMT",54,0)
 . S GMRCANS=$$READ("Y","Send Alert To Requesting Provider "_GMRCRP,"N","Enter Y to send an alert to the ordering provider, otherwise enter N.",1)
"RTN","GMRCACMT",55,0)
 . S:GMRCANS=1 GMRCADUZ($P(^GMR(123,+GMRCO,0),"^",14))=""
"RTN","GMRCACMT",56,0)
 . Q
"RTN","GMRCACMT",57,0)
 ;
"RTN","GMRCACMT",58,0)
ANDTO ;Ask for additional recipients
"RTN","GMRCACMT",59,0)
 D NAMELIST("Send Alert to: ",.GMRCADUZ,GMRCDELR)
"RTN","GMRCACMT",60,0)
 Q
"RTN","GMRCACMT",61,0)
 ;
"RTN","GMRCACMT",62,0)
NAMELIST(GMRCP,GMRCOLD,GMRCDELR) ;manage the list of recipients
"RTN","GMRCACMT",63,0)
 ;
"RTN","GMRCACMT",64,0)
 ; GMRCP - Prompt
"RTN","GMRCACMT",65,0)
 ; GMRCOLD - Original list with ordering provider.
"RTN","GMRCACMT",66,0)
 ; GMRCDELR - 1 means the original list may have names deleted
"RTN","GMRCACMT",67,0)
 ; Returns final list in GMRCOLD array
"RTN","GMRCACMT",68,0)
 ;
"RTN","GMRCACMT",69,0)
 N GMRCNEW,GMRCNT,GMRCDUZ,GMRCUSER,GMRCQ,GMRCADD,DIC,X,Y
"RTN","GMRCACMT",70,0)
 ;
"RTN","GMRCACMT",71,0)
 M GMRCNEW=GMRCOLD
"RTN","GMRCACMT",72,0)
 I GMRCDELR=1 K GMRCOLD S GMRCOLD="" ;Remove mandatory users from GMRCOLD
"RTN","GMRCACMT",73,0)
 S GMRCNT=0 F  D  Q:(GMRCUSER[U)
"RTN","GMRCACMT",74,0)
 .S GMRCUSER=$$READ("FAO;3;46",$S(GMRCNT:"And ",1:"")_GMRCP,"","^D NAMEHELP^GMRCACMT")
"RTN","GMRCACMT",75,0)
 .S:'$L(GMRCUSER) GMRCUSER=U Q:(GMRCUSER[U)
"RTN","GMRCACMT",76,0)
 .I ($E(GMRCUSER,1)="-") S GMRCADD=0,GMRCUSER=$E(GMRCUSER,2,$L(GMRCUSER))
"RTN","GMRCACMT",77,0)
 .E  S GMRCADD=1
"RTN","GMRCACMT",78,0)
 .;
"RTN","GMRCACMT",79,0)
 .S X=GMRCUSER,DIC=200,DIC(0)="EMQ" D ^DIC
"RTN","GMRCACMT",80,0)
 .;
"RTN","GMRCACMT",81,0)
 .I (Y>0) D  I 1
"RTN","GMRCACMT",82,0)
 ..;W $E($P(Y,U,2),$L(GMRCUSER)+1,$L($P(Y,U,2)))
"RTN","GMRCACMT",83,0)
 ..;
"RTN","GMRCACMT",84,0)
 ..I GMRCADD D
"RTN","GMRCACMT",85,0)
 ...I $D(GMRCNEW(+Y)) W " already in the list." Q
"RTN","GMRCACMT",86,0)
 ...S GMRCNEW(+Y)="" W " added to the list." S GMRCNT=GMRCNT+1
"RTN","GMRCACMT",87,0)
 ..;
"RTN","GMRCACMT",88,0)
 ..I 'GMRCADD D
"RTN","GMRCACMT",89,0)
 ...I $D(GMRCOLD(+Y)) W " can't delete this name from the list." Q
"RTN","GMRCACMT",90,0)
 ...I '$D(GMRCNEW(+Y)) W " not currently in the list." Q
"RTN","GMRCACMT",91,0)
 ...K GMRCNEW(+Y) S GMRCNT=GMRCNT-1 W " deleted from the list."
"RTN","GMRCACMT",92,0)
 .;
"RTN","GMRCACMT",93,0)
 .E  I $L(GMRCUSER) W "  Name not found."
"RTN","GMRCACMT",94,0)
 ;
"RTN","GMRCACMT",95,0)
 M GMRCOLD=GMRCNEW
"RTN","GMRCACMT",96,0)
 Q
"RTN","GMRCACMT",97,0)
 ;
"RTN","GMRCACMT",98,0)
READ(GMRC0,GMRCA,GMRCB,GMRCH,GMRCL) ;read logic
"RTN","GMRCACMT",99,0)
 ;
"RTN","GMRCACMT",100,0)
 ;  GMRC0 -> DIR(0) --- Type of read
"RTN","GMRCACMT",101,0)
 ;  GMRCA -> DIR("A") - Prompt
"RTN","GMRCACMT",102,0)
 ;  GMRCB -> DIR("B") - Default Answer
"RTN","GMRCACMT",103,0)
 ;  GMRCH -> DIR("?") - Help text or ^Execute code
"RTN","GMRCACMT",104,0)
 ;  GMRCL -> Number of blank lines to put before Prompt
"RTN","GMRCACMT",105,0)
 ;
"RTN","GMRCACMT",106,0)
 ;  Returns "^" or answer
"RTN","GMRCACMT",107,0)
 ;
"RTN","GMRCACMT",108,0)
 N GMRCLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRCACMT",109,0)
 Q:'$L($G(GMRC0)) U
"RTN","GMRCACMT",110,0)
 S DIR(0)=GMRC0
"RTN","GMRCACMT",111,0)
 S:$L($G(GMRCA)) DIR("A")=GMRCA
"RTN","GMRCACMT",112,0)
 S:$L($G(GMRCB)) DIR("B")=GMRCB
"RTN","GMRCACMT",113,0)
 S:$L($G(GMRCH)) DIR("?")=GMRCH
"RTN","GMRCACMT",114,0)
 F GMRCLINE=1:1:($G(GMRCL)-1) W !
"RTN","GMRCACMT",115,0)
 D ^DIR
"RTN","GMRCACMT",116,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","GMRCACMT",117,0)
 Q Y
"RTN","GMRCACMT",118,0)
 ;
"RTN","GMRCACMT",119,0)
 ;
"RTN","GMRCACMT",120,0)
NAMEHELP ;Help for the recipient list logic
"RTN","GMRCACMT",121,0)
 N GMRCDUZ
"RTN","GMRCACMT",122,0)
 W !,"Enter the name of the user to send the alert to,"
"RTN","GMRCACMT",123,0)
 W !," or put a '-' in front of a name to delete from the list."
"RTN","GMRCACMT",124,0)
 W !
"RTN","GMRCACMT",125,0)
 W !,"  Example:"
"RTN","GMRCACMT",126,0)
 W !,"     SMITH,FRED  ->  to add Fred to the list."
"RTN","GMRCACMT",127,0)
 W !,"     -SMITH,FRED ->  to delete Fred from the list."
"RTN","GMRCACMT",128,0)
 W !,"Already selected: "
"RTN","GMRCACMT",129,0)
 W !
"RTN","GMRCACMT",130,0)
 S GMRCDUZ=0 F  S GMRCDUZ=$O(GMRCNEW(GMRCDUZ)) Q:'GMRCDUZ  D
"RTN","GMRCACMT",131,0)
 .W !,?5,$P(^VA(200,GMRCDUZ,0),U,1)
"RTN","GMRCACMT",132,0)
 .W:$D(GMRCOLD(GMRCDUZ)) "  <mandatory>"
"RTN","GMRCACMT",133,0)
 W !
"RTN","GMRCACMT",134,0)
 Q
"RTN","GMRCACMT",135,0)
 ;
"RTN","GMRCACTM")
0^47^B3098073
"RTN","GMRCACTM",1,0)
GMRCACTM ; SLC/DLT,DCM - Set GMRCACTM with action menu based on Service ;10/6/98  17:15
"RTN","GMRCACTM",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCACTM",3,0)
CPRS(GMRCPM) ;Entry point for setting appropriate menu actions for CPRS user
"RTN","GMRCACTM",4,0)
 ;GMRCPM=a list of File 123 IEN's to check for menu actions.
"RTN","GMRCACTM",5,0)
 ;       Passed in as '300;303;295;309;313'
"RTN","GMRCACTM",6,0)
 ;Menu access is passed out in ORFLG as, for example,
"RTN","GMRCACTM",7,0)
 ;2=Extended menu actions allowed - If ORFLG(DUZ)>1 then extended menu actions are allowed
"RTN","GMRCACTM",8,0)
 I '$L(GMRCPM) S ORFLG=1 Q
"RTN","GMRCACTM",9,0)
 K ORFLG
"RTN","GMRCACTM",10,0)
 N I,GMRCSS,GMRCIEN
"RTN","GMRCACTM",11,0)
 F I=1:1 S ORFLG=1,GMRCIEN=$P(GMRCPM,";",I) Q:GMRCIEN=""  D
"RTN","GMRCACTM",12,0)
 .S ORFLG(GMRCIEN)=1 ;set default answer to read only
"RTN","GMRCACTM",13,0)
 .S GMRCSS=+$P($G(^GMR(123,+GMRCIEN,0)),"^",5)
"RTN","GMRCACTM",14,0)
 .Q:'+$G(GMRCSS)
"RTN","GMRCACTM",15,0)
 .;when service is defined, check for service user 
"RTN","GMRCACTM",16,0)
 .D EN
"RTN","GMRCACTM",17,0)
 .S ORFLG(GMRCIEN)=ORFLG
"RTN","GMRCACTM",18,0)
 .Q
"RTN","GMRCACTM",19,0)
 Q
"RTN","GMRCACTM",20,0)
 ;
"RTN","GMRCACTM",21,0)
EN ;Set GMRCACTM with appropriate menu of actions given user characteristics
"RTN","GMRCACTM",22,0)
 ;If ORFLG is DEFINED then GMRCACTM is returned as a set of codes:
"RTN","GMRCACTM",23,0)
 ;    1 = GMRCACTM USER REVIEW SCREEN - simple actions
"RTN","GMRCACTM",24,0)
 ;    2 = GMRCACTM SERVICE ACTION menu  - all actions possible for
"RTN","GMRCACTM",25,0)
 ;        clinical user in service
"RTN","GMRCACTM",26,0)
 ;    3 = GMRCACTM ADMIN ACTION menu - administrative user
"RTN","GMRCACTM",27,0)
 ;    4 = GMRCACTM TRK MEDICINE CONSULTS menu - all actions that the user of the medicine package can take.
"RTN","GMRCACTM",28,0)
 ; initialize GMRCACTM for read only
"RTN","GMRCACTM",29,0)
 S GMRCACTM="GMRCACTM USER REVIEW SCREEN"
"RTN","GMRCACTM",30,0)
 ; medicine options will get the medicine interface
"RTN","GMRCACTM",31,0)
 I $D(XQY0),$E(XQY0,1,2)="MC" S GMRCACTM="GMRCACTM MEDICINE PKG MENU" Q
"RTN","GMRCACTM",32,0)
 ;
"RTN","GMRCACTM",33,0)
 ; if service and entry aren't defined, assume read only access
"RTN","GMRCACTM",34,0)
 I '$D(XQADATA),$S('+$G(GMRCSS):1,1:0) D  Q
"RTN","GMRCACTM",35,0)
 .I $D(ORFLG) S ORFLG(GMRCIEN)=1 K GMRCACTM
"RTN","GMRCACTM",36,0)
 .Q
"RTN","GMRCACTM",37,0)
 ;
"RTN","GMRCACTM",38,0)
 ;Check first for local variations of the action menu. 
"RTN","GMRCACTM",39,0)
 ;using locally developed options
"RTN","GMRCACTM",40,0)
 ;N GMRCOPT,LOCALMNU
"RTN","GMRCACTM",41,0)
 ;I +$G(GMRCSS) D
"RTN","GMRCACTM",42,0)
 ;. S GMRCOPT=$P($G(^GMR(123.5,+GMRCSS,123)),"^",10)
"RTN","GMRCACTM",43,0)
 ;. S LOCALMNU=$P($G(^GMR(123.5,+GMRCSS,123)),"^",3)
"RTN","GMRCACTM",44,0)
 ;. I +$G(^ORD(101,+LOCALMNU,0)) D
"RTN","GMRCACTM",45,0)
 ;.. S GMRCACTM=$P($G(ORD(101,+LOCALMNU,0)),"^",1)
"RTN","GMRCACTM",46,0)
 ;.. I $D(ORFLG) S ORFLG=2 K GMRCACTM
"RTN","GMRCACTM",47,0)
 ;. Q
"RTN","GMRCACTM",48,0)
 ;
"RTN","GMRCACTM",49,0)
 ;Get the users service update level
"RTN","GMRCACTM",50,0)
 N GMRCFLG
"RTN","GMRCACTM",51,0)
 S GMRCFLG=$$VALID^GMRCAU(+GMRCSS,"")
"RTN","GMRCACTM",52,0)
 ;
"RTN","GMRCACTM",53,0)
 ;If ORFLG is all that should be returned, than set and exit
"RTN","GMRCACTM",54,0)
 I $D(ORFLG) D  Q
"RTN","GMRCACTM",55,0)
 . K GMRCACTM
"RTN","GMRCACTM",56,0)
 . I GMRCFLG=0 S ORFLG=1 Q
"RTN","GMRCACTM",57,0)
 . S ORFLG=GMRCFLG Q
"RTN","GMRCACTM",58,0)
 ;
"RTN","GMRCACTM",59,0)
 ;Process the GMRCFLG value to get the GMRCACTM defined.
"RTN","GMRCACTM",60,0)
 I GMRCFLG>0 D SETACTM Q
"RTN","GMRCACTM",61,0)
 Q
"RTN","GMRCACTM",62,0)
 ;
"RTN","GMRCACTM",63,0)
SETACTM ;Set GMRCACTM with local update menu or the GMRCACTM SERVICE ACTION MENU
"RTN","GMRCACTM",64,0)
 S GMRCACTM=$S($P($G(^GMR(123.5,GMRCSS,123)),"^",3):$P(^ORD(101,$P(^(123),"^",3),0),"^"),1:"GMRCACTM SERVICE ACTION MENU")
"RTN","GMRCACTM",65,0)
 Q
"RTN","GMRCACTM",66,0)
 ;
"RTN","GMRCAFRD")
0^43^B29295543
"RTN","GMRCAFRD",1,0)
GMRCAFRD ;SLC/DLT,DCM - Forward Req (FR) Action from Review Screen ;7/16/98  01:48
"RTN","GMRCAFRD",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCAFRD",3,0)
FR(GMRCO) ;Forward Request to a new service
"RTN","GMRCAFRD",4,0)
 N ORVP
"RTN","GMRCAFRD",5,0)
 W !!,"Forward Request To Another Service For Action."
"RTN","GMRCAFRD",6,0)
 W !,"Select the service to send the consult to.",!
"RTN","GMRCAFRD",7,0)
 S:$D(GMRCSS) GMRCSSS=GMRCSS
"RTN","GMRCAFRD",8,0)
 N GMRCPL,GMRCPR,GMRCURG,GMRCDG,GMRCFF,GMRCORNP,GMRCAD,GMRCTO,GMRCADUZ
"RTN","GMRCAFRD",9,0)
 K GMRCQUT,GMRCSEL
"RTN","GMRCAFRD",10,0)
 I '$L($G(GMRCO)) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCAFRD",11,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",12,0)
 ;
"RTN","GMRCAFRD",13,0)
 I $P(^GMR(123,GMRCO,0),"^",12)<3 S GMRCMSG="NO ACTION POSSIBLE. This Consult Has Already Been Completed Or Discontinued." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",14,0)
 I $P(^GMR(123,GMRCO,0),"^",12)=13 S GMRCMSG="NO ACTION POSSIBLE. This Consult Has Already Been Cancelled." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",15,0)
 I $P(^GMR(123,GMRCO,0),"^",12)=9 D  Q:+$G(GMRCQUT)
"RTN","GMRCAFRD",16,0)
 .S GMRCMSG="Invalid action. This consult has partial results."
"RTN","GMRCAFRD",17,0)
 .S GMRCMSG(1)="Remove the associated results before forwarding."
"RTN","GMRCAFRD",18,0)
 .D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",19,0)
 ;
"RTN","GMRCAFRD",20,0)
 I $D(IOBM),$D(IOTM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCAFRD",21,0)
 I $P(^GMR(123,GMRCO,0),"^",16) W !!,"This is a SERVICE ENTERED order stub.  Please send the written consult to the",!,"Service, in addition to the automated forwarding!"
"RTN","GMRCAFRD",22,0)
 S DFN=+$P(^GMR(123,GMRCO,0),"^",2)
"RTN","GMRCAFRD",23,0)
 S GMRCTO=1,GMRCASV="Forward Consult To Which Service/Specialty: "
"RTN","GMRCAFRD",24,0)
 D ASRV^GMRCASV K GMRCASV I $S($D(DTOUT):1,$D(DIROUT):1,$D(GMRCQUT):1,1:0) D END Q
"RTN","GMRCAFRD",25,0)
 I 'GMRCDG S GMRCMSG="No Service Was Selected. Consult Was Not Forwarded To Any Service!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",26,0)
 S GMRCFF=$P(^GMR(123,GMRCO,0),"^",5) I GMRCFF=+GMRCDG S GMRCMSG="The Forwarding Service Cannot Forward A Consult To Itself!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",27,0)
 S GETPROV="Who is responsible for Forwarding the Consult?"
"RTN","GMRCAFRD",28,0)
 D GETPROV^GMRCAU I '$D(GMRCORNP) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",29,0)
 N GMRCSS,GMRCSSNM,GMRCA,GMRCMSG
"RTN","GMRCAFRD",30,0)
 D DEFAULT
"RTN","GMRCAFRD",31,0)
 S GMRCSS=+GMRCDG
"RTN","GMRCAFRD",32,0)
 I +GMRCSS,'$D(^GMR(123.5,+GMRCSS,0)) S GMRCMSG="Error in Service Chosen - SERVICE Does Not Exist!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",33,0)
 S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSS,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSS,0)),U,1))
"RTN","GMRCAFRD",34,0)
 D URG I $D(GMRCEND),GMRCEND D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",35,0)
 S GMRCA=17,DIE="^GMR(123,",DA=GMRCO,ORSTS=5
"RTN","GMRCAFRD",36,0)
 S DR="1////^S X=GMRCSS;5////^S X=GMRCURGI;8////^S X=ORSTS;9////^S X=GMRCA;.1///@"
"RTN","GMRCAFRD",37,0)
 L +^GMR(123,GMRCO):2 I '$T K DIE,DA,DR S GMRCMSG="Another User Is Accessing This Record. UPDATE WAS UNSUCCESSFUL.",GMRCMSG(1)="Try Again Later." D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",38,0)
 D ^DIE L -^GMR(123,GMRCO) K DIE,DA,DR
"RTN","GMRCAFRD",39,0)
 S GMRCOM=1 D AUDIT^GMRCP ;GMRCORNP is the responsible provider here
"RTN","GMRCAFRD",40,0)
 ;
"RTN","GMRCAFRD",41,0)
FRMSG ; Common logic used by GUI and List Manager to process the HL7 message
"RTN","GMRCAFRD",42,0)
 ; to update the order in OE/RR and then forward an alert to recipients
"RTN","GMRCAFRD",43,0)
 ; is passed in as the DUZ instead of the responsible provider
"RTN","GMRCAFRD",44,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),"XX",$G(DUZ),$G(VISIT),.GMRCOM)
"RTN","GMRCAFRD",45,0)
 S GMRCADUZ=""
"RTN","GMRCAFRD",46,0)
 S GMRCORNP=$P(^GMR(123,GMRCO,0),"^",14) ;This is the original provider that ordered the consult
"RTN","GMRCAFRD",47,0)
 I +$G(GMRCORNP) S GMRCADUZ(+GMRCORNP)="" ;alert original provider of forward
"RTN","GMRCAFRD",48,0)
 S GMRCORTX="Forwarded consult "_$$ORTX^GMRCAU(+GMRCO)_" ("_GMRCURG_")"
"RTN","GMRCAFRD",49,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,27,.GMRCADUZ,1) ;GMRCO=IEN of consult from file 123; 27 is notification entry from file ORD(100.9
"RTN","GMRCAFRD",50,0)
 K GMRCOM
"RTN","GMRCAFRD",51,0)
 S GMRCDEV=$P($G(^GMR(123.5,GMRCSS,123)),"^",9)
"RTN","GMRCAFRD",52,0)
 I GMRCDEV D PRNT^GMRCUTL1(GMRCSS,+GMRCO)
"RTN","GMRCAFRD",53,0)
 D END
"RTN","GMRCAFRD",54,0)
 Q
"RTN","GMRCAFRD",55,0)
URG ;Get the default urgency
"RTN","GMRCAFRD",56,0)
 N X,Y,XQORM,DIROUT,DTOUT,DIRUT,DUOUT
"RTN","GMRCAFRD",57,0)
 I $P(^GMR(123,+GMRCO,0),"^",18)["I" D
"RTN","GMRCAFRD",58,0)
 .I GMRCTYPE="GMRCOR CONSULT" S X="GMRCURGENCYM CSLT - INPATIENT"
"RTN","GMRCAFRD",59,0)
 .S X="GMRCURGENCYM REQ - INPATIENT"
"RTN","GMRCAFRD",60,0)
 E  S X="GMRCURGENCYM - OUTPATIENT"
"RTN","GMRCAFRD",61,0)
 I '$D(GMRCURG) S GMRCURGI=$O(^ORD(101,"B","GMRCURGENCY - ROUTINE","")) S:+GMRCURGI GMRCURG=$P($G(^ORD(101,+GMRCURGI,0)),"^",2)
"RTN","GMRCAFRD",62,0)
 S Y=$O(^ORD(101,"B",X,""))
"RTN","GMRCAFRD",63,0)
 S XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Urgency: ",XQORM("NO^^")=""
"RTN","GMRCAFRD",64,0)
 S:$L(GMRCURG) XQORM("B")=GMRCURG D EN^XQORM I X="^"!($D(DIROUT)) K XQORM S GMRCEND=1 Q
"RTN","GMRCAFRD",65,0)
 K XQORM(0),XQORM("A"),XQORM("B"),XQORM("NO^^") S XQORM=""
"RTN","GMRCAFRD",66,0)
 I '$D(Y) S GMRCEND=1 Q
"RTN","GMRCAFRD",67,0)
 I $D(Y(1)) S GMRCURG=$P(Y(1),"^",3),GMRCURGI=$P(Y(1),"^",2)
"RTN","GMRCAFRD",68,0)
 Q
"RTN","GMRCAFRD",69,0)
DEFAULT ;Set up defaults for editing to be equal to the existing data.
"RTN","GMRCAFRD",70,0)
 D DEM^GMRCU
"RTN","GMRCAFRD",71,0)
 N GMRC,GMRCDIC,GMRCPLI,GMRCPRI
"RTN","GMRCAFRD",72,0)
 Q:'$D(GMRCO)  S (GMRCSS,GMRCSSNM,GMRCPL,GMRCPR,GMRCPRI,GMRCURG)=""
"RTN","GMRCAFRD",73,0)
 S GMRCOM=0,GMRC(0)=$S($D(^GMR(123,+GMRCO,0)):^(0),1:"")
"RTN","GMRCAFRD",74,0)
 S GMRCSS=$P(GMRC(0),"^",5) I +GMRCSS,$D(^GMR(123.5,+GMRCSS,0)) S GMRCSSNM=$S($L($P($G(^GMR(123.5,+GMRCSS,0)),U,1)):$P(^(0),U,1),1:"")
"RTN","GMRCAFRD",75,0)
 S GMRCPLI=$P(GMRC(0),"^",10) I GMRCPLI S GMRCPL=$P($G(^ORD(101,GMRCPLI,0)),"^",2)
"RTN","GMRCAFRD",76,0)
 S GMRCURGI=$P(GMRC(0),"^",9) I GMRCURGI S GMRCURG=$P($G(^ORD(101,GMRCURGI,0)),"^",2)
"RTN","GMRCAFRD",77,0)
 S GMRCPRI=$P(GMRC(0),"^",8),GMRCDIC=$P(GMRCPRI,";",2) I $L(GMRCDIC) S GMRCDIC="^"_GMRCDIC_$P(GMRCPRI,";")_",0)",GMRCPR=$S($D(@(GMRCDIC)):$P(^(0),"^",2),1:"")
"RTN","GMRCAFRD",78,0)
TYPE ;This entry point is used when the only default needed is the GMRCTYPE
"RTN","GMRCAFRD",79,0)
 ;Called by GMRCGUIA to get variables ready for FRMSG call.
"RTN","GMRCAFRD",80,0)
 S GMRCTYPE=$P($G(^GMR(123,+GMRCO,0)),"^",17),GMRCTYPE=$S('GMRCTYPE:"GMRCOR CONSULT",1:$P($G(^ORD(101,GMRCTYPE,0)),"^"))
"RTN","GMRCAFRD",81,0)
 Q
"RTN","GMRCAFRD",82,0)
END ;Kill off variables and exit
"RTN","GMRCAFRD",83,0)
 K GETPROV,GMRCDG,GMRCDEV,GMRCEND,GMRCFF,GMRCOM,GMRCIFN,GMRCO,GMRCORNP
"RTN","GMRCAFRD",84,0)
 K GMRCTYPE,GMRCORTX,GMRCPL,GMRCPR,GMRCSEL,GMRCURG,GMRCADUZ,Y
"RTN","GMRCAFRD",85,0)
 K DTOUT,DIROUT,DUOUT
"RTN","GMRCAFRD",86,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCAFRD",87,0)
 Q
"RTN","GMRCALRT")
0^48^B7437207
"RTN","GMRCALRT",1,0)
GMRCALRT ;SLC/DCM - LIST MANAGER ALERT ACTION INTERFACE ; 18-OCT-1995
"RTN","GMRCALRT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCALRT",3,0)
EN(GMRCDAT,GMRCDTA) ; -- main entry point for GMRC ALERT ACTION
"RTN","GMRCALRT",4,0)
 ;Process an alert for a new consult through List Manager
"RTN","GMRCALRT",5,0)
 ;GMRCDTA=XQAID from CPRS interface
"RTN","GMRCALRT",6,0)
 ;GMRCDAT=XQADATA from CPRS interface = IFN of consult from file 123
"RTN","GMRCALRT",7,0)
 K GMRCQIT,GMRCOER,GMRCNOTF,GMRCCORY
"RTN","GMRCALRT",8,0)
 S GMRCALFL=$S($D(XQAID)&($D(XQADATA)):1,1:0)
"RTN","GMRCALRT",9,0)
 D EN^GMRCALOR(GMRCDTA,GMRCDAT)
"RTN","GMRCALRT",10,0)
 S GMRCNOTF=+$P(GMRCDTA,",",3)
"RTN","GMRCALRT",11,0)
 I $D(GMRCQIT) S XQAKILL=$$XQAKILL^ORB3F1(GMRCNOTF) D DEL^ORB3FUP1(.GMRCCORY,XQAID),EXIT Q
"RTN","GMRCALRT",12,0)
 D INIT,HDR
"RTN","GMRCALRT",13,0)
 N GMRCACTM
"RTN","GMRCALRT",14,0)
 I '+GMRCO S GMRCACTM=$O(^ORD(101,"B","GMRCACTM ALERT BASIC ACTIONS",0))_";ORD(101,"
"RTN","GMRCALRT",15,0)
 E  N ORFLG D
"RTN","GMRCALRT",16,0)
 . D CPRS^GMRCACTM(+GMRCO) ;Get users update status for the Consult entry
"RTN","GMRCALRT",17,0)
 . S GMRCACTM=$S(ORFLG(+GMRCO)>1:$O(^ORD(101,"B","GMRCACTM ALERT SERVICE ACTIONS",0))_";ORD(101,",1:$O(^ORD(101,"B","GMRCACTM ALERT BASIC ACTIONS",0))_";ORD(101,")
"RTN","GMRCALRT",18,0)
 I '+GMRCACTM K ^TMP("GMRC",$J,"CURRENT","MENU")
"RTN","GMRCALRT",19,0)
 E  S ^TMP("GMRC",$J,"CURRENT","MENU")=GMRCACTM,XQORM("HIJACK")=^("MENU")
"RTN","GMRCALRT",20,0)
 S GMRCOER=0
"RTN","GMRCALRT",21,0)
 D EN^VALM("GMRC ALERT ACTION")
"RTN","GMRCALRT",22,0)
 S XQAKILL=$$XQAKILL^ORB3F1(GMRCNOTF) D DEL^ORB3FUP1(.GMRCCORY,XQAID)
"RTN","GMRCALRT",23,0)
 D EXIT
"RTN","GMRCALRT",24,0)
 Q
"RTN","GMRCALRT",25,0)
 ;
"RTN","GMRCALRT",26,0)
HDR ; -- header code
"RTN","GMRCALRT",27,0)
 N GMRVSTR,X
"RTN","GMRCALRT",28,0)
 S GMRCPTN=$P(^DPT(DFN,0),"^",1)
"RTN","GMRCALRT",29,0)
 S GMRVSTR="WT" D EN6^GMRVUTL S GMRCWT=$P(X,U,8)
"RTN","GMRCALRT",30,0)
 D DEM^GMRCU S:'$D(GMRCWRD) GMRCWRD=GMRCWARD
"RTN","GMRCALRT",31,0)
 ;S VALMHDR(1)=$E(GMRCPTN,1,28)_$S($L(GMRCPTN)<28:$E(TAB,1,30-$L(GMRCPTN)),1:"  ")_GMRCSSN_$E(TAB,1,3)_GMRCWRD_$E(TAB,1,8-$L(GMRCWRD))_GMRCDOB_$E(TAB,1,10-$L(GMRCDOB))_" ("_GMRCAGE_")"_$E(TAB,1,4)_"Wt (lb): "_GMRCWT
"RTN","GMRCALRT",32,0)
 S VALMHDR(1)=$E(GMRCPTN,1,30)_$S($L(GMRCPTN)<30:$E(TAB,1,30-$L(GMRCPTN)),1:" ")_GMRCSSN_$E(TAB,1,3)_GMRCDOB_$E(TAB,1,10-$L(GMRCDOB))_" ("_GMRCAGE_")"_$E(TAB,1,4)_"Wt (lb):"_GMRCWT
"RTN","GMRCALRT",33,0)
 I $D(GMRCWRD),$L(GMRCWRD) S VALMHDR(2)="Ward: "_GMRCWRD
"RTN","GMRCALRT",34,0)
 Q
"RTN","GMRCALRT",35,0)
 ;
"RTN","GMRCALRT",36,0)
INIT ; -- init variables and list array
"RTN","GMRCALRT",37,0)
 K ^TMP("GMRCR",$J,"LIST")
"RTN","GMRCALRT",38,0)
 S DSPLINE=0,VALMAR="^TMP(""GMRCR"",$J,""LIST"")"
"RTN","GMRCALRT",39,0)
 S GMRCSN=$P(^DPT(DFN,0),"^",9),GMRCSSN=$E(GMRCSN,1,3)_"-"_$E(GMRCSN,4,5)_"-"_$E(GMRCSN,6,9)
"RTN","GMRCALRT",40,0)
 F LINE=1:1:LNCT S DSPLINE=$O(^TMP("GMRCR",$J,"CS",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCALRT",41,0)
 S VALMCNT=LNCT
"RTN","GMRCALRT",42,0)
 K DSPLINE,DATA,LINE
"RTN","GMRCALRT",43,0)
 Q
"RTN","GMRCALRT",44,0)
 ;
"RTN","GMRCALRT",45,0)
HELP ; -- help code
"RTN","GMRCALRT",46,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCALRT",47,0)
 Q
"RTN","GMRCALRT",48,0)
 ;
"RTN","GMRCALRT",49,0)
EXIT ; -- exit code
"RTN","GMRCALRT",50,0)
 K ^TMP("GMRCR",$J),^TMP("GMRCS",$J)
"RTN","GMRCALRT",51,0)
 K GMRCALFL,GMRCAID,GMRCQIT,VA,XQAKILL
"RTN","GMRCALRT",52,0)
 D ^GMRCREXT
"RTN","GMRCALRT",53,0)
 Q
"RTN","GMRCALRT",54,0)
 ;
"RTN","GMRCALRT",55,0)
EXPND ; -- expand code
"RTN","GMRCALRT",56,0)
 Q
"RTN","GMRCALRT",57,0)
 ;
"RTN","GMRCART")
0^44^B32452056
"RTN","GMRCART",1,0)
GMRCART ;SLC/DCM,DLT - Result display logic ;6/29/98  23:50
"RTN","GMRCART",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCART",3,0)
RT(GMRCO) ;Result Display logic - called from GMRCA1
"RTN","GMRCART",4,0)
 N GMRCCT,GMRCTMP,GMRCSR,GMRCTUFN,GMRCSTS,GMRCMSG
"RTN","GMRCART",5,0)
 ;
"RTN","GMRCART",6,0)
 S GMRCSR=$P($G(^GMR(123,+GMRCO,0)),"^",15),GMRCTUFN=$P(^(0),"^",20)
"RTN","GMRCART",7,0)
 S GMRCSTS=$P($G(^GMR(123,+GMRCO,0)),"^",12)
"RTN","GMRCART",8,0)
 I '$$RESOLUS^GMRCAU(GMRCSTS),('+GMRCSR&('GMRCTUFN)) S GMRCMSG="No results available for review." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCART",9,0)
 ;
"RTN","GMRCART",10,0)
 W !,"Compiling Result Display..."
"RTN","GMRCART",11,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCART",12,0)
 K ^TMP("GMRCR",$J,"DT") S GMRCCT=1
"RTN","GMRCART",13,0)
 S XQORM("A")="Select Action: "
"RTN","GMRCART",14,0)
 S:$D(VALMAR) GMRCVAL=VALMAR
"RTN","GMRCART",15,0)
 S GMRCTMP="^TMP(""GMRCR"",$J,""DT"")"
"RTN","GMRCART",16,0)
 S GMRCDVL="",$P(GMRCDVL,"-",41)=""
"RTN","GMRCART",17,0)
 ;
"RTN","GMRCART",18,0)
 D GETRSLT(GMRCTMP)
"RTN","GMRCART",19,0)
 ;
"RTN","GMRCART",20,0)
 D EN^VALM("GMRC RESULTS DISPLAY")
"RTN","GMRCART",21,0)
 S:$D(GMRCVAL) VALMAR=GMRCVAL S:$D(LNCT) VALMCNT=LNCT
"RTN","GMRCART",22,0)
 D KILL^VALM10()
"RTN","GMRCART",23,0)
 K OREND,ORAGE,ORIO,ORDOB,ORFT,ORHI,ORIFN,ORNP,ORL,ORPD,ORPNM,ORPV,ORSEQ,ORSEX,ORWARD,ORDG
"RTN","GMRCART",24,0)
 K GMRCDVL,GMRCLCT,GMRCRPT,GMRCTUFN,GMRCVAL,MCFILE,MCPROC,GMRCX,GMRCTO,GMRCPRNM
"RTN","GMRCART",25,0)
 D END
"RTN","GMRCART",26,0)
 Q
"RTN","GMRCART",27,0)
 ;
"RTN","GMRCART",28,0)
GETRSLT(TMPGLOB) ;load the results into global defined in TMPGLOB
"RTN","GMRCART",29,0)
 ;used for GUI formated results and list manager
"RTN","GMRCART",30,0)
 N GMRCCTS,SF,TAB
"RTN","GMRCART",31,0)
 S TAB="",$P(TAB," ",31)=""
"RTN","GMRCART",32,0)
 S GMRCDVL="",$P(GMRCDVL,"-",41)=""
"RTN","GMRCART",33,0)
 K @TMPGLOB
"RTN","GMRCART",34,0)
 S GMRCCT=1
"RTN","GMRCART",35,0)
 I $L($P(^GMR(123,GMRCO,0),"^",19)) S SF=$P(^(0),"^",19),@TMPGLOB@(GMRCCT,0)="Significant Findings: "_$S(SF="Y":"**Yes**",SF="N":"No",1:"Unknown"),GMRCCT=GMRCCT+1
"RTN","GMRCART",36,0)
 ;S @TMPGLOB@(GMRCCT,0)=GMRCDVL_GMRCDVL,GMRCCT=GMRCCT+1 ;GMRCDVL_GMRCDVL
"RTN","GMRCART",37,0)
 D PRINT^GMRCTIUP(GMRCO,GMRCCT,1)
"RTN","GMRCART",38,0)
 S GMRCCTS=GMRCCT ;save the line count before printing med and TIU notes
"RTN","GMRCART",39,0)
 D GETMCAR
"RTN","GMRCART",40,0)
 D GETRES
"RTN","GMRCART",41,0)
 I GMRCCT=GMRCCTS D  ;check if count changed for notes or med results
"RTN","GMRCART",42,0)
 . S:+$L($G(SF)) @TMPGLOB@(GMRCCT,0)=GMRCDVL_GMRCDVL,GMRCCT=GMRCCT+1 ;GMRCDVL_GMRCDVL
"RTN","GMRCART",43,0)
 . S @TMPGLOB@(GMRCCT,0)="No TIU results or Medicine results available for this consult"
"RTN","GMRCART",44,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCART",45,0)
 ;
"RTN","GMRCART",46,0)
 D GETCOM
"RTN","GMRCART",47,0)
 I GMRCCT>2 S @TMPGLOB@(GMRCCT,0)="",$P(@TMPGLOB@(GMRCCT,0),"=",81)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",48,0)
 Q
"RTN","GMRCART",49,0)
 ;
"RTN","GMRCART",50,0)
GETMCAR ;load the medicine results into TMPGLOB
"RTN","GMRCART",51,0)
 Q:'$O(^TMP("GMRCR",$J,"MCAR",0))
"RTN","GMRCART",52,0)
 N ND,ND1
"RTN","GMRCART",53,0)
 S ND=0 F  S ND=$O(^TMP("GMRCR",$J,"MCAR",ND)) Q:ND=""!(ND?1A.E)  D
"RTN","GMRCART",54,0)
 .S @TMPGLOB@(GMRCCT,0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",55,0)
 .S @TMPGLOB@(GMRCCT,0)=TAB_"Medicine Package Report",GMRCCT=GMRCCT+1
"RTN","GMRCART",56,0)
 .S ND1=0 F  S ND1=$O(^TMP("GMRCR",$J,"MCAR",ND,ND1)) Q:ND1=""  S @TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"MCAR",ND,ND1,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",57,0)
 .Q
"RTN","GMRCART",58,0)
 K ^TMP("GMRCR",$J,"MCAR")
"RTN","GMRCART",59,0)
 Q
"RTN","GMRCART",60,0)
 ;
"RTN","GMRCART",61,0)
GETRES ;load the TIU notes into TMPGLOB
"RTN","GMRCART",62,0)
 Q:'+$O(^TMP("GMRCR",$J,"RES",0))
"RTN","GMRCART",63,0)
 ;
"RTN","GMRCART",64,0)
 N ND,ND1
"RTN","GMRCART",65,0)
 S ND=0 F  S ND=$O(^TMP("GMRCR",$J,"RES",ND)) Q:(ND="")!(ND?1A.E)  D
"RTN","GMRCART",66,0)
 . I $D(^TMP("GMRCR",$J,"RES",ND,"TEXT","GMRCRPT")) D
"RTN","GMRCART",67,0)
 . . S @TMPGLOB@(GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",68,0)
 . . S @TMPGLOB@(GMRCCT,0)=$E(GMRCDVL,1,80-$L(^TMP("GMRCR",$J,"RES",ND,"TEXT","GMRCRPT"))\2)_^("GMRCRPT")_$E(GMRCDVL,1,80-$L(^("GMRCRPT"))\2)
"RTN","GMRCART",69,0)
 . . S GMRCCT=GMRCCT+1
"RTN","GMRCART",70,0)
 . S:'$D(^TMP("GMRCR",$J,"RES",ND,"TEXT","GMRCRPT")) @TMPGLOB@(GMRCCT,0)=GMRCDVL_GMRCDVL,GMRCCT=GMRCCT+1
"RTN","GMRCART",71,0)
 . S:$O(^TMP("GMRCR",$J,"RES",ND,"TEXT",0)) @TMPGLOB@(GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",72,0)
 . S ND1=0 F  S ND1=$O(^TMP("GMRCR",$J,"RES",ND,"TEXT",ND1)) Q:ND1?1A.E!(ND1="")  S @TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"RES",ND,"TEXT",ND1,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",73,0)
 . I $O(^TMP("GMRCR",$J,"RES",ND,"ADD",0)) S ND1=0 F  S ND1=$O(^TMP("GMRCR",$J,"RES",ND,"ADD",ND1)) Q:ND1=""   D
"RTN","GMRCART",74,0)
 . . S @TMPGLOB@(GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",75,0)
 . . S @TMPGLOB@(GMRCCT,0)=TAB_"ADDENDUM TO REPORT",GMRCCT=GMRCCT+1
"RTN","GMRCART",76,0)
 . . S ND2=0 F  S ND2=$O(^TMP("GMRCR",$J,"RES",ND,"ADD",ND1,ND2)) Q:ND2=""!(ND2?1A.E)  S @TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"RES",ND,"ADD",ND1,ND2,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",77,0)
 . . Q
"RTN","GMRCART",78,0)
 . Q
"RTN","GMRCART",79,0)
 K ^TMP("GMRCR",$J,"RES")
"RTN","GMRCART",80,0)
 Q
"RTN","GMRCART",81,0)
 ;
"RTN","GMRCART",82,0)
GETCOM ;Get the comments for resolution actions
"RTN","GMRCART",83,0)
 S GMRCSTS=$P($G(^GMR(123,+GMRCO,0)),"^",12)
"RTN","GMRCART",84,0)
 Q:'$$RESOLUS^GMRCAU(+GMRCSTS) 
"RTN","GMRCART",85,0)
 ;
"RTN","GMRCART",86,0)
 ;Loop thru actions to find the resolution type actions
"RTN","GMRCART",87,0)
 N ND,ND1,ND2
"RTN","GMRCART",88,0)
 S ND="" F  S ND=$O(^GMR(123,+GMRCO,40,"B",ND)) Q:ND=""  S ND1=$O(^GMR(123,+GMRCO,40,"B",ND,"")) D
"RTN","GMRCART",89,0)
 . ;
"RTN","GMRCART",90,0)
 . ;Check for resulting action types:complete,sig finding,dc,cancel
"RTN","GMRCART",91,0)
 . N GMRCAIEN
"RTN","GMRCART",92,0)
 . S GMRCAIEN=$P($G(^GMR(123,+GMRCO,40,ND1,0)),"^",2)
"RTN","GMRCART",93,0)
 . I '$$RESOLUA^GMRCAU(GMRCAIEN) Q
"RTN","GMRCART",94,0)
 . ;
"RTN","GMRCART",95,0)
 . ;save the action header info in case there are comments
"RTN","GMRCART",96,0)
 . N GMRCAHDR,GMRCPROV,GMRCENBY,GMRCENDT
"RTN","GMRCART",97,0)
 . D SAVEHDR
"RTN","GMRCART",98,0)
 . ;
"RTN","GMRCART",99,0)
 . ;check for comments, print header on first pass
"RTN","GMRCART",100,0)
 . S ND2=0
"RTN","GMRCART",101,0)
 . F  S ND2=$O(^GMR(123,GMRCO,40,ND1,1,ND2)) Q:ND2=""  D
"RTN","GMRCART",102,0)
 . . I +$G(GMRCAHDR) D GETHDR ;GMRCAHDR will =1 on first pass
"RTN","GMRCART",103,0)
 . . S @TMPGLOB@(GMRCCT,0)=^GMR(123,GMRCO,40,ND1,1,ND2,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",104,0)
 . . Q
"RTN","GMRCART",105,0)
 . Q
"RTN","GMRCART",106,0)
 Q
"RTN","GMRCART",107,0)
 ;
"RTN","GMRCART",108,0)
SAVEHDR ;Save the action header info to print later if there are comments
"RTN","GMRCART",109,0)
 S GMRCAHDR=1 ;flag to print action header on first pass of comments
"RTN","GMRCART",110,0)
 ;save the provider, entered by and date
"RTN","GMRCART",111,0)
 S GMRCPROV=$P(^GMR(123,GMRCO,40,ND1,0),"^",4),GMRCENBY=$P(^(0),"^",5)
"RTN","GMRCART",112,0)
 S GMRCENDT=$$FMTE^XLFDT($P($G(^GMR(123,GMRCO,40,ND1,0)),"^",3))
"RTN","GMRCART",113,0)
 Q
"RTN","GMRCART",114,0)
 ;
"RTN","GMRCART",115,0)
GETHDR ;Print the comment header if the action had a comment
"RTN","GMRCART",116,0)
 S @TMPGLOB@(GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",117,0)
 S @TMPGLOB@(GMRCCT,0)=$$CENTER^GMRCP5D("("_$P($G(^GMR(123.1,GMRCAIEN,0)),"^",8)_" Comment)"),GMRCCT=GMRCCT+1
"RTN","GMRCART",118,0)
 S @TMPGLOB@(GMRCCT,0)="      Entered by: "_$S($L(GMRCENBY):$P(^VA(200,GMRCENBY,0),"^",1),1:"")_" - "_GMRCENDT,GMRCCT=GMRCCT+1
"RTN","GMRCART",119,0)
 I +GMRCPROV S @TMPGLOB@(GMRCCT,0)="      Responsible Clinician: "_$P($G(^VA(200,GMRCPROV,0)),"^",1),GMRCCT=GMRCCT+1
"RTN","GMRCART",120,0)
 K GMRCAHDR
"RTN","GMRCART",121,0)
 Q
"RTN","GMRCART",122,0)
 ; 
"RTN","GMRCART",123,0)
END ;kill off variables and exit
"RTN","GMRCART",124,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCART",125,0)
 K DTOUT,DIROUT,DUOUT
"RTN","GMRCART",126,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCART",127,0)
 Q
"RTN","GMRCASF")
0^27^B11232167
"RTN","GMRCASF",1,0)
GMRCASF ;SLC/DLT - Significant Findings Action ;9/8/98  03:40
"RTN","GMRCASF",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCASF",3,0)
SF(GMRCO) ;Evaluate Significant Findings and update accordingly
"RTN","GMRCASF",4,0)
 ;GMRCO is the selected consult
"RTN","GMRCASF",5,0)
 N GMRCQIT
"RTN","GMRCASF",6,0)
 I '$L($G(GMRCO)) D SELECT^GMRCA2(.GMRCO)  I $D(GMRCQUT) D END Q
"RTN","GMRCASF",7,0)
 I '+($G(GMRCO)) D END Q
"RTN","GMRCASF",8,0)
 ;
"RTN","GMRCASF",9,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCASF",10,0)
 N GMRC,GMRCSTS,GMRCSF,GMRCSFO,GMRCORTX,GMRCDR
"RTN","GMRCASF",11,0)
 S GMRC(0)=$G(^GMR(123,+GMRCO,0)) Q:GMRC(0)=""
"RTN","GMRCASF",12,0)
 ;
"RTN","GMRCASF",13,0)
 S GMRCSFO=$P(GMRC(0),"^",19)
"RTN","GMRCASF",14,0)
 W !!,"Current Significant Findings = "_$S(GMRCSFO="U":"Unknown",GMRCSFO="Y":"Yes",GMRCSFO="N":"No",1:"not entered yet"),!!
"RTN","GMRCASF",15,0)
 S GMRCSF=$$GETSIGF(GMRCSFO)
"RTN","GMRCASF",16,0)
 I GMRCSF=0 D END Q
"RTN","GMRCASF",17,0)
 ; If no change in old and new value ask if should continue
"RTN","GMRCASF",18,0)
 I GMRCSF=GMRCSFO D  I 'Y D END Q
"RTN","GMRCASF",19,0)
 . W !,"The old and new Significant Findings are the same."
"RTN","GMRCASF",20,0)
 . N DIR,DA,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRCASF",21,0)
 . S DIR("A")="Do you want to proceed with this action"
"RTN","GMRCASF",22,0)
 . S DIR(0)="Y"
"RTN","GMRCASF",23,0)
 . S DIR("B")="NO"
"RTN","GMRCASF",24,0)
 . D ^DIR
"RTN","GMRCASF",25,0)
 . I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) S Y=0 Q
"RTN","GMRCASF",26,0)
 . I Y=0 Q
"RTN","GMRCASF",27,0)
 ;
"RTN","GMRCASF",28,0)
 ;Update last action and sig findings but don't change the status
"RTN","GMRCASF",29,0)
 S GMRCSTS=$P(GMRC(0),"^",12),GMRCA=4
"RTN","GMRCASF",30,0)
 S GMRCDR="8////^S X=GMRCSTS;9////^S X=GMRCA;15////^S X=GMRCSF"
"RTN","GMRCASF",31,0)
 D STATUS^GMRCP
"RTN","GMRCASF",32,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG),END Q
"RTN","GMRCASF",33,0)
 ;
"RTN","GMRCASF",34,0)
 S GMRCOM=1 D AUDIT^GMRCP
"RTN","GMRCASF",35,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG),END Q
"RTN","GMRCASF",36,0)
 ;
"RTN","GMRCASF",37,0)
 ;GMRCOM=1 tells AUDIT^GMRCP to do the word-processing logic
"RTN","GMRCASF",38,0)
 ;If an actual comment is added, $P(GMRCOM,"^",2)=1 (send alert),
"RTN","GMRCASF",39,0)
 ; if not GMRCOM=1 and no '^' exists (do not send alert)
"RTN","GMRCASF",40,0)
 D SETORTX
"RTN","GMRCASF",41,0)
 I GMRCSTS=2 D SENDALRT(GMRCORTX) Q
"RTN","GMRCASF",42,0)
 I +$P(GMRCOM,"^",2) D
"RTN","GMRCASF",43,0)
 . W !,"An alert with the following text will be sent if recipients are selected: "
"RTN","GMRCASF",44,0)
 . W !,"     "_GMRCORTX_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCASF",45,0)
 . W !
"RTN","GMRCASF",46,0)
 . I GMRCSTS'=2 W !,"or the alert will be sent when the order is completed.",!
"RTN","GMRCASF",47,0)
 . D PROCALRT^GMRCACMT(GMRCORTX,1,4)
"RTN","GMRCASF",48,0)
 . ;For consults not completed, the original provider may be deleted from
"RTN","GMRCASF",49,0)
 . ;the recipient list for the alert.
"RTN","GMRCASF",50,0)
 D END
"RTN","GMRCASF",51,0)
 Q
"RTN","GMRCASF",52,0)
 ;
"RTN","GMRCASF",53,0)
SETORTX ;Set prefix text for the alert
"RTN","GMRCASF",54,0)
 S GMRCORTX=$S(GMRCSF="N":"No ",GMRCSF="Y":"",1:"Unknown ")
"RTN","GMRCASF",55,0)
 S GMRCORTX=GMRCORTX_"Sig Findings for "_$P($G(^ORD(100.01,+GMRCSTS,0)),"^",2)_" consult " Q
"RTN","GMRCASF",56,0)
 Q
"RTN","GMRCASF",57,0)
 ;
"RTN","GMRCASF",58,0)
SENDALRT(GMRCORTX) ;Send to the requesting provider
"RTN","GMRCASF",59,0)
 N GMRCRP,GMRCADUZ,GMRCDELR
"RTN","GMRCASF",60,0)
 S GMRCRP=$P($G(^GMR(123,+GMRCO,0)),U,14) ;requesting clinician
"RTN","GMRCASF",61,0)
 I +GMRCRP S GMRCADUZ(+GMRCRP)=""
"RTN","GMRCASF",62,0)
 W !,"Alert will be sent to Requesting Provider: "_$P($G(^VA(200,+GMRCRP,0)),U,1)
"RTN","GMRCASF",63,0)
 S GMRCDELR=0
"RTN","GMRCASF",64,0)
 D ANDTO^GMRCACMT
"RTN","GMRCASF",65,0)
 D SENDMSG^GMRCACMT(23,+GMRCO)
"RTN","GMRCASF",66,0)
 ;Sig Findings uses the CONSULT/REQUEST RESOLUTION (23) notification
"RTN","GMRCASF",67,0)
 Q
"RTN","GMRCASF",68,0)
 ;
"RTN","GMRCASF",69,0)
GETSIGF(GMRCSFO) ;Get the significant findings
"RTN","GMRCASF",70,0)
 ;GMRCSFO is the old significant findings value
"RTN","GMRCASF",71,0)
 N DIR,DA,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRCASF",72,0)
 S DIR(0)="123,15"
"RTN","GMRCASF",73,0)
 S DIR("B")=GMRCSFO
"RTN","GMRCASF",74,0)
 S:DIR("B")="" DIR("B")="unknown"
"RTN","GMRCASF",75,0)
 S DIR("A")="Are there significant findings? (Y/N/U)"
"RTN","GMRCASF",76,0)
 D ^DIR
"RTN","GMRCASF",77,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q 0
"RTN","GMRCASF",78,0)
 Q Y
"RTN","GMRCASF",79,0)
 ;
"RTN","GMRCASF",80,0)
END ;cleanup variables
"RTN","GMRCASF",81,0)
 K GMRCO,GMRCA,GMRCMSG,GMRCOM,GMRCSEL,GMRCERR,GMRCERMS
"RTN","GMRCASF",82,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCASF",83,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCASF",84,0)
 Q
"RTN","GMRCAU")
0^9^B15406844
"RTN","GMRCAU",1,0)
GMRCAU ;SLC/DLT - Action Utilities  ;9/8/98  03:33
"RTN","GMRCAU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCAU",3,0)
GETPROV K GMRCORNP N DIR S DIR(0)="123.02,3"
"RTN","GMRCAU",4,0)
 S DIR("A")=$S($D(GETPROV):GETPROV,1:"Responsible Clinician") 
"RTN","GMRCAU",5,0)
 D ^DIR K DIR I $D(DTOUT)!$D(DIROUT)!(X="^") S GMRCQIT="Q" Q
"RTN","GMRCAU",6,0)
 G:Y<1 GETPROV S GMRCORNP=+Y
"RTN","GMRCAU",7,0)
 Q
"RTN","GMRCAU",8,0)
GETDT ;Get actual activity date
"RTN","GMRCAU",9,0)
 K GMRCQIT
"RTN","GMRCAU",10,0)
 D NOW^%DTC S (X,GMRCDT)=% D REGDTM^GMRCU S GMRCAD=X
"RTN","GMRCAU",11,0)
 S DIR(0)="123.02,2",DIR("A")=$S($D(GETDT):GETDT,1:"Date/Time of Actual Activity"),DIR("B")="NOW" D ^DIR K DIR I $D(DIRUT) S GMRCQIT="Q" Q
"RTN","GMRCAU",12,0)
 I X="NOW" K GMRCAD,Y Q
"RTN","GMRCAU",13,0)
 S GMRCAD=Y K X,Y,DIRUT,DUOUT
"RTN","GMRCAU",14,0)
 Q
"RTN","GMRCAU",15,0)
ORTX(GMRCO) ;Get the abbreviated text for alert displays
"RTN","GMRCAU",16,0)
 ;GMRCO is the consult entry from 123
"RTN","GMRCAU",17,0)
 N GMRCSVC,GMRCSSNM,GMRCPROC,GMRCORTX
"RTN","GMRCAU",18,0)
 S GMRCSSNM=$$SVC(GMRCO)
"RTN","GMRCAU",19,0)
 S GMRCPROC=$$PROC(GMRCO)
"RTN","GMRCAU",20,0)
 S GMRCORTX=$S($L(GMRCPROC):($E(GMRCSSNM,1,10)_" "_$E(GMRCPROC,1,10)),1:$E(GMRCSSNM,1,20))
"RTN","GMRCAU",21,0)
 Q GMRCORTX
"RTN","GMRCAU",22,0)
 ;
"RTN","GMRCAU",23,0)
SVC(GMRCO) ;Get abbreviated service text
"RTN","GMRCAU",24,0)
 S GMRCSVC=$P(^GMR(123,+GMRCO,0),"^",5),GMRCSSNM=""
"RTN","GMRCAU",25,0)
 I +GMRCSVC S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSVC,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSVC,0)),U,1))
"RTN","GMRCAU",26,0)
 Q GMRCSSNM
"RTN","GMRCAU",27,0)
PROC(GMRCO) ;Get abbreviated procedure text
"RTN","GMRCAU",28,0)
 S GMRCPROC=$P(^GMR(123,+GMRCO,0),"^",8)
"RTN","GMRCAU",29,0)
 I +GMRCPROC S GMRCPROC=$S($L($G(^ORD(101,+GMRCPROC,.1))):^(.1),1:$P($G(^ORD(101,+GMRCPROC,0)),"^",2))
"RTN","GMRCAU",30,0)
 Q GMRCPROC
"RTN","GMRCAU",31,0)
 ;
"RTN","GMRCAU",32,0)
LMTX(GMRCO) ;Get the text for list manager displays
"RTN","GMRCAU",33,0)
 ;GMRCO is the consult entry from 123
"RTN","GMRCAU",34,0)
 N GMRCSVC,GMRCSSNM,GMRCREQ,GMRCORTX
"RTN","GMRCAU",35,0)
 S GMRCSVC=$P(^GMR(123,+GMRCO,0),"^",5),GMRCSSNM=""
"RTN","GMRCAU",36,0)
 I +GMRCSVC S GMRCSSNM=$P($G(^GMR(123.5,+GMRCSVC,0)),U,1)
"RTN","GMRCAU",37,0)
 S GMRCREQ=$P(^GMR(123,+GMRCO,0),"^",8)
"RTN","GMRCAU",38,0)
 I +GMRCREQ S GMRCREQ=$S($L($G(^ORD(101,+GMRCREQ,.1))):^(.1),1:$P($G(^ORD(101,+GMRCPROC,0)),"^",2))
"RTN","GMRCAU",39,0)
 S GMRCORTX=$S($L(GMRCPROC):($E(GMRCSSNM,1,10)_" "_$E(GMRCREQ,1,10)),1:$E(GMRCSSNM,1,20))
"RTN","GMRCAU",40,0)
 Q GMRCORTX
"RTN","GMRCAU",41,0)
 ;
"RTN","GMRCAU",42,0)
 ;
"RTN","GMRCAU",43,0)
VALID(GMRCSS,GMRCO) ;Check to see if user is an update user
"RTN","GMRCAU",44,0)
 ;The value returned is the equivalent of this set of codes:
"RTN","GMRCAU",45,0)
 ;    0 = not an update user
"RTN","GMRCAU",46,0)
 ;    2 = update user
"RTN","GMRCAU",47,0)
 ;    3 = administrative update user
"RTN","GMRCAU",48,0)
 ;
"RTN","GMRCAU",49,0)
 N GMRCUPD
"RTN","GMRCAU",50,0)
 I '+$G(GMRCSS) Q 0
"RTN","GMRCAU",51,0)
 I $D(^GMR(123.5,+GMRCSS,123.33,"B",DUZ)) Q 3
"RTN","GMRCAU",52,0)
 I $D(^GMR(123.5,+GMRCSS,123.3,"B",DUZ)) Q 2
"RTN","GMRCAU",53,0)
 I DUZ=$P($G(^GMR(123.5,+GMRCSS,123)),"^",8) Q 2
"RTN","GMRCAU",54,0)
 ;
"RTN","GMRCAU",55,0)
 S GMRCUPD=0
"RTN","GMRCAU",56,0)
 I $D(^GMR(123.5,+GMRCSS,123.1)) D TEAM(.GMRCUPD) Q:+GMRCUPD GMRCUPD
"RTN","GMRCAU",57,0)
 I $D(^GMR(123.5,+GMRCSS,123.2)) D LOC(.GMRCUPD) Q:+GMRCUPD GMRCUPD
"RTN","GMRCAU",58,0)
 Q 0
"RTN","GMRCAU",59,0)
 ;
"RTN","GMRCAU",60,0)
LOC(GMRCUPD) ;Check for the DUZ in the NOTIFICATION BY PT LOCATION multiple
"RTN","GMRCAU",61,0)
 N GMRCL,GMRCTM
"RTN","GMRCAU",62,0)
 S GMRCL=0 ;Check if DUZ is associated with any location/ward
"RTN","GMRCAU",63,0)
 F  S GMRCL=$O(^GMR(123.5,+GMRCSS,123.2,GMRCL))  Q:'GMRCL!+GMRCUPD  D  Q:+GMRCUPD
"RTN","GMRCAU",64,0)
 . ;Get user and/or team assigned to location
"RTN","GMRCAU",65,0)
 . S GMRCL(0)=$G(^GMR(123.5,+GMRCSS,123.2,+GMRCL,0))
"RTN","GMRCAU",66,0)
 . I $P(GMRCL(0),"^",2)=DUZ S GMRCUPD=2 Q
"RTN","GMRCAU",67,0)
 . I $P(GMRCL(0),"^",3) S GMRCTM=$P(GMRCL(0),"^",3) D CHKTM
"RTN","GMRCAU",68,0)
 Q
"RTN","GMRCAU",69,0)
 ;
"RTN","GMRCAU",70,0)
TEAM(GMRCUPD) ;Check for the DUZ in the SERVICE TEAM TO NOTIFY multiple
"RTN","GMRCAU",71,0)
 N GMRCTM
"RTN","GMRCAU",72,0)
 S GMRCTM="",GMRCUPD=0
"RTN","GMRCAU",73,0)
 F  S GMRCTM=$O(^GMR(123.5,GMRCSS,123.1,"B",GMRCTM)) Q:GMRCTM=""!+GMRCUPD   D CHKTM Q:+GMRCUPD
"RTN","GMRCAU",74,0)
 Q
"RTN","GMRCAU",75,0)
 ;
"RTN","GMRCAU",76,0)
CHKTM ;Gets the list of users on a team and checks for DUZ in list
"RTN","GMRCAU",77,0)
 ;Input:  GMRCTM must be set to the Order Team entry number
"RTN","GMRCAU",78,0)
 ;Output: GMRCUPD will be returned with 2 (update) if DUZ gets a match
"RTN","GMRCAU",79,0)
 N ND,GMRCLST
"RTN","GMRCAU",80,0)
 S GMRCLST=""
"RTN","GMRCAU",81,0)
 D TEAMPROV^ORQPTQ1(.GMRCLST,GMRCTM)
"RTN","GMRCAU",82,0)
 I $P(GMRCLST(1),"^",2)="No providers found." Q
"RTN","GMRCAU",83,0)
 S ND=0
"RTN","GMRCAU",84,0)
 F  S ND=$O(GMRCLST(ND)) Q:ND=""  I $P(GMRCLST(ND),"^",1)=DUZ S GMRCUPD=2 Q
"RTN","GMRCAU",85,0)
 Q
"RTN","GMRCAU",86,0)
 ;  old logic
"RTN","GMRCAU",87,0)
 ;Check the update users without notification for a service
"RTN","GMRCAU",88,0)
 I +$D(GMRCSS),$D(^GMR(123.5,+GMRCSS,123.3,"B",DUZ)) Q 2  ;update user
"RTN","GMRCAU",89,0)
 ;
"RTN","GMRCAU",90,0)
 I +$D(GMRCSS),$D(^GMR(123.5,+GMRCSS,123.33,"B",DUZ)) Q 3  ;admin user
"RTN","GMRCAU",91,0)
 ;
"RTN","GMRCAU",92,0)
 ;Check the users who receive notifications
"RTN","GMRCAU",93,0)
 N X
"RTN","GMRCAU",94,0)
 I '+GMRCSS Q 0
"RTN","GMRCAU",95,0)
 D EN^GMRCT(GMRCSS)
"RTN","GMRCAU",96,0)
 I $D(GMRCADUZ(DUZ)) S X=1
"RTN","GMRCAU",97,0)
 E  S X=0
"RTN","GMRCAU",98,0)
 K GMRCADUZ Q X
"RTN","GMRCAU",99,0)
 Q 0
"RTN","GMRCAU",100,0)
 ;
"RTN","GMRCAU",101,0)
COMPLETE(GMRCA) ;Determine if the action is a complete action (10,13,14)
"RTN","GMRCAU",102,0)
 S GMRCA=$G(GMRCA)
"RTN","GMRCAU",103,0)
 Q $S(GMRCA=13:1,GMRCA=14:1,GMRCA=10:1,1:0)
"RTN","GMRCAU",104,0)
 ;   10=administrative complete, 13=ADDENDUM ADDED, 14=New Note
"RTN","GMRCAU",105,0)
 ;
"RTN","GMRCAU",106,0)
RESOLUA(GMRCA) ;Determine if action has resolution info for clinician
"RTN","GMRCAU",107,0)
 ;Action value is based on value in ^ORD(100.01,"
"RTN","GMRCAU",108,0)
 ;Returns 1 for consult resolution, 0 for pending resolution
"RTN","GMRCAU",109,0)
 S GMRCA=$G(GMRCA)
"RTN","GMRCAU",110,0)
 Q $S(GMRCA=4:1,GMRCA=6:1,GMRCA=10:1,GMRCA=11:1,GMRCA=12:1,GMRCA=13:1,GMRCA=14:1,GMRCA=19:1,1:0)
"RTN","GMRCAU",111,0)
 ;    4=Sig Findings, 6=discontinued, 10=administrative complete
"RTN","GMRCAU",112,0)
 ;    11=Edit/resubmit
"RTN","GMRCAU",113,0)
 ;    12=Disassociate result, 13=Addendum Added, 14=New Note
"RTN","GMRCAU",114,0)
 ;    19=cancelled
"RTN","GMRCAU",115,0)
 ;
"RTN","GMRCAU",116,0)
RESOLUS(GMRCSTS) ;Determine status indicates the consult has a resolution
"RTN","GMRCAU",117,0)
 ;Status value is based on values in ^ORD(100.01,"
"RTN","GMRCAU",118,0)
 ;Returns 1 for consult resolution, 0 for pending resolution
"RTN","GMRCAU",119,0)
 S GMRCSTS=$G(GMRCSTS)
"RTN","GMRCAU",120,0)
 Q $S(GMRCSTS:1,GMRCSTS=2:1,GMRCSTS=13:1,1:0)
"RTN","GMRCAU",121,0)
 ;    1=dc,2=comp,13=canc
"RTN","GMRCAU",122,0)
 ;
"RTN","GMRCGUIA")
0^12^B32110464
"RTN","GMRCGUIA",1,0)
GMRCGUIA ;SLC/DCM - GUI actions for consults from the GUI interface ;7/16/98  01:51
"RTN","GMRCGUIA",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCGUIA",3,0)
NEW(DFN,GMRCDA,GMRCLOC,GMRCTYPE,GMRCSVC,GMRCPROV,GMRCURG,GMRCPLI,GMRCNP,GMRCATN,GMRCINOT,GMRCDIAG,GMRCRFQ) ;Add a new consult for a patient.
"RTN","GMRCGUIA",4,0)
 ;DFN=Patient ^DPT( file number
"RTN","GMRCGUIA",5,0)
 ;GMRCRFQ=Reason For Request, why the consult is being ordered. Passed in as
"RTN","GMRCGUIA",6,0)
 ;    an array
"RTN","GMRCGUIA",7,0)
 ;GMRCDIAG=Povisional diagnosis; what is suspected to be the problem
"RTN","GMRCGUIA",8,0)
 ;GMRCTYPE=Request type -Consult or Procedure
"RTN","GMRCGUIA",9,0)
 ;GMRCLOC=Patient location.
"RTN","GMRCGUIA",10,0)
 ;GMRCDA=Date Time of Request
"RTN","GMRCGUIA",11,0)
 ;GMRCSVC=To Service; consulting service
"RTN","GMRCGUIA",12,0)
 ;GMRCLOC=Hospital Location ordering consult
"RTN","GMRCGUIA",13,0)
 ;GMRCPR=If a procedure, the procedure ordered (pointer to file 101)
"RTN","GMRCGUIA",14,0)
 ;GMRCURG=Urgency of request (stat, routine, etc) from file 101
"RTN","GMRCGUIA",15,0)
 ;GMRCPLI=Place of consultation (bedside, consultants choice, etc.) from file 101
"RTN","GMRCGUIA",16,0)
 ;GMRCPROV=Sending Provider
"RTN","GMRCGUIA",17,0)
 ;GMRCATN=if consult is to go to a specific provider, this provider is identified here.
"RTN","GMRCGUIA",18,0)
 ;GMRCINOT=Service provided as Inpatient or Outpatient
"RTN","GMRCGUIA",19,0)
 N DIC,DLAYGO,Y,DIE,GMRCADUZ,X,GMRCO,DR
"RTN","GMRCGUIA",20,0)
 S DIC="^GMR(123,",DIC(0)="L",X="""N""",DLAYGO=123 D ^DIC K DLAYGO
"RTN","GMRCGUIA",21,0)
 S (DA,GMRCO)=+Y,GMRCSTS=5,GMRCA=1,DIE=DIC
"RTN","GMRCGUIA",22,0)
 L +^GMR(123,GMRC0)
"RTN","GMRCGUIA",23,0)
 S DR=".02////^S X=DFN;.04////^S X=GMRCLOC;1////^S X=GMRCSVC;3////^S X=GMRCDA;4////^S X=GMRCPR;5////^S X=GMRCURG;6////^S X=GMRCPLI"_$S(GMRCATN]"":"7////^S X=GMRCATN",1:"")
"RTN","GMRCGUIA",24,0)
 D ^DIE
"RTN","GMRCGUIA",25,0)
 S DR="8////^S X=GMRCSTS;9////^S X=GMRCA;10////^S X=GMRCPROV;11////^S X=GMRCATN;13////^S X=GMRCTYPE;14////^S X=GMRCINOT"_$S($D(GMRCDIAG):"30:////^S X=GMRCDIAG",1:"")
"RTN","GMRCGUIA",26,0)
 D ^DIE L -^GMR(123,GMRCO)
"RTN","GMRCGUIA",27,0)
 I $O(GMRCRFQ(0)) D REASON^GMRCGUIB(GMRCO,GMRCRFQ,GMRCDA)
"RTN","GMRCGUIA",28,0)
 D EN^GMRCHL7(DFN,GMRCDA,GMRCTYPE,$G(GMRCRB),"NW",DUZ,$G(VISIT),"")
"RTN","GMRCGUIA",29,0)
 D EXIT
"RTN","GMRCGUIA",30,0)
 Q
"RTN","GMRCGUIA",31,0)
 ;
"RTN","GMRCGUIA",32,0)
RC(GMRCO,GMRCORNP,GMRCAD) ;Receive the consult into the service
"RTN","GMRCGUIA",33,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIA",34,0)
 ;GMRCORNP - Name of the person who actually 'Received'the consult into the service.
"RTN","GMRCGUIA",35,0)
 ;GMRCDUZ - DUZ of person entering the consult into the service as being 'RECEIVED'.
"RTN","GMRCGUIA",36,0)
 ;GMRCAD - Actual date time that the consult was received into the service.
"RTN","GMRCGUIA",37,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIA",38,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIA",39,0)
 N DFN,GMRCSTS,GMRCDUZ,GMRCNOW,GMRCERR,GMRCERMS
"RTN","GMRCGUIA",40,0)
 S GMRCERR=0,GMRCERMS="",GMRCDUZ=DUZ,GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",41,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIA",42,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",43,0)
 S GMRCSTS=6,GMRCA=21
"RTN","GMRCGUIA",44,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",45,0)
 D AUDIT^GMRCP
"RTN","GMRCGUIA",46,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","")
"RTN","GMRCGUIA",47,0)
 D EXIT
"RTN","GMRCGUIA",48,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",49,0)
 ;
"RTN","GMRCGUIA",50,0)
DC(GMRCO,GMRCORNP,GMRCAD,GMRCACTM,GMRCOM) ;Discontinue or Deny a consult
"RTN","GMRCGUIA",51,0)
 ;GMRCO - Internal file number of consult from File 123
"RTN","GMRCGUIA",52,0)
 ;GMRCORNP - Provider who Discontinued or Denied consult
"RTN","GMRCGUIA",53,0)
 ;GMRCAD - Date/Time Consult was denied.
"RTN","GMRCGUIA",54,0)
 ;GMRCNOW - Current date/time
"RTN","GMRCGUIA",55,0)
 ;GMRCACTM - If consult is 'CANCELLED'(old DENY) passed in as 'DY'; if consult is Discontinued passed in as 'DC'.
"RTN","GMRCGUIA",56,0)
 ;GMRCERR=Error Flag: 0 if no error occurred, 1 if was an error
"RTN","GMRCGUIA",57,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIA",58,0)
 ;GMRCDUZ - DUZ of person entering the action
"RTN","GMRCGUIA",59,0)
 ;GMRCOM - Array containing explanation of why consult was denied. Passed as the following form :
"RTN","GMRCGUIA",60,0)
 ;     ARRAY(1)="xxx xxx xxx",ARRAY(2)="XXX XXX",ARRAY(3)="XXX XXX xx", etc.
"RTN","GMRCGUIA",61,0)
 ;     Comment is a required field when consult is denied or discontinued.
"RTN","GMRCGUIA",62,0)
 ;
"RTN","GMRCGUIA",63,0)
 N GMRCDUZ,DFN,GMRCNOW,GMRCSTS,GMRCERR,GMRCERMS,GMRCADUZ,GMRCTRLC
"RTN","GMRCGUIA",64,0)
 S GMRCERR=0,GMRCERMS=""
"RTN","GMRCGUIA",65,0)
 S GMRCDUZ=DUZ,GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",66,0)
 K GMRCQUT
"RTN","GMRCGUIA",67,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIA",68,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",69,0)
 I '$D(GMRCOM) S GMRCERR=1,GMRCERMS="Comments are required for this action." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",70,0)
 S GMRCSTS=$P(^ORD(100.01,$P(^GMR(123,GMRCO,0),"^",12),0),U,2)
"RTN","GMRCGUIA",71,0)
 I GMRCSTS="dc" S GMRCERR=1,GMRCERMS="Order Has Already Been Discontinued." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",72,0)
 I GMRCSTS="ca" S GMRCERR=1,GMRCERMS="Order Has Already Been Cancelled." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",73,0)
 I GMRCSTS="comp" S GMRCERR=1,GMRCERMS="Order Has Already Been Completed." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",74,0)
 S GMRCA=$S(GMRCACTM="DC":6,1:19),GMRCSTS=$S(GMRCA=6:1,1:13)
"RTN","GMRCGUIA",75,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",76,0)
 I GMRCACTM="DC" D PRNT^GMRCUTL1("",GMRCO)
"RTN","GMRCGUIA",77,0)
 S DA=$$SETDA^GMRCGUIB D SETCOM^GMRCGUIB(.GMRCOM)
"RTN","GMRCGUIA",78,0)
 S GMRCTRLC=$S(GMRCACTM="DC":"OD",1:"OC")
"RTN","GMRCGUIA",79,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),GMRCTRLC,GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCGUIA",80,0)
 S GMRCORTX=$S(GMRCACTM="DY":"Cancelled",1:"Discontinued")_" consult "_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIA",81,0)
 S GMRCFL=1,GMRCADUZ=""
"RTN","GMRCGUIA",82,0)
 I GMRCFL,+$P($G(^GMR(123,+GMRCO,0)),"^",14),$P(^(0),"^",14)'=DUZ S GMRCADUZ($P(^(0),"^",14))=""
"RTN","GMRCGUIA",83,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,$S(GMRCA=6:23,1:30),.GMRCADUZ,GMRCFL) ;send notification
"RTN","GMRCGUIA",84,0)
 D EXIT
"RTN","GMRCGUIA",85,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",86,0)
 ;
"RTN","GMRCGUIA",87,0)
FR(GMRCO,GMRCSS,GMRCORNP,GMRCATTN,GMRCURGI,GMRCOM) ;Forward consult/request to another service
"RTN","GMRCGUIA",88,0)
 N DR,GMRCDUZ,GMRCAD,GMRCNOW,GMRCFF,GMRCFR,GMRCERR,GMRCERMS,GMRCADUZ,GMRCURG
"RTN","GMRCGUIA",89,0)
 S GMRCERR=0,GMRCERMS=""
"RTN","GMRCGUIA",90,0)
 S GMRCFF=$P(^GMR(123,GMRCO,0),U,5),DFN=$P(^GMR(123,+GMRCO,0),U,2)
"RTN","GMRCGUIA",91,0)
 S GMRCDUZ=DUZ,GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",92,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW  ; Actual date time that the consult was forwarded from the service
"RTN","GMRCGUIA",93,0)
 S GMRCA=17,GMRCSTS=5,GMRCFR=$P($G(^GMR(123,+GMRCO,0)),"^",5) ;Get old service before stuffing new service into record
"RTN","GMRCGUIA",94,0)
 S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCGUIA",95,0)
 S DR="1////^S X=$G(GMRCSS);5////^S X=$G(GMRCURGI);8////^S X=$G(GMRCSTS);9////^S X=$G(GMRCA);.1///@"_$S($L($G(GMRCATTN)):";7////^S X=GMRCATTN",1:"")
"RTN","GMRCGUIA",96,0)
 L +^GMR(123,GMRCO):3 I '$T K DIE,DA,DR S GMRCERR=1,GMRCERMS="Data Not Filed - File In Use By Another User." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",97,0)
 D ^DIE L -^GMR(123,GMRCO) K DIE,DA,DR
"RTN","GMRCGUIA",98,0)
 S DA=$$SETDA^GMRCGUIB D SETCOM^GMRCGUIB(.GMRCOM)
"RTN","GMRCGUIA",99,0)
 S GMRCURG=$P($G(^ORD(101,+GMRCURGI,0)),"^",2)
"RTN","GMRCGUIA",100,0)
 D DEM^GMRCU ;sets GMRCRB and other variables
"RTN","GMRCGUIA",101,0)
 D TYPE^GMRCAFRD ;sets GMRCTYPE
"RTN","GMRCGUIA",102,0)
 D FRMSG^GMRCAFRD ;create XX HL7 message for OE/RR and send alert 
"RTN","GMRCGUIA",103,0)
 D EXIT
"RTN","GMRCGUIA",104,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",105,0)
 ;
"RTN","GMRCGUIA",106,0)
RT(GMRCO,TMPGLOB) ;Set ^TMP("GMRCR",$J,"DT", with results from med and TIU
"RTN","GMRCGUIA",107,0)
 ;GMRCO=IEN of consult from file 123
"RTN","GMRCGUIA",108,0)
 ;Set TMPGLOB to a ^TMP global other than ^TMP("GMRCR",$J,"MCAR", or ^TMP("GMRCR",$J,"RES", i.e., S TMPGLOB="^TMP(""GMRCR"",$J,""RT"")"'
"RTN","GMRCGUIA",109,0)
 Q:'$D(GMRCO)
"RTN","GMRCGUIA",110,0)
 K @TMPGLOB
"RTN","GMRCGUIA",111,0)
 S GMRCDVL="",$P(GMRCDVL,"-",41)=""
"RTN","GMRCGUIA",112,0)
 S GMRCSR=$P(^GMR(123,+GMRCO,0),"^",15),GMRCTUFN=$P(^(0),"^",20)
"RTN","GMRCGUIA",113,0)
 S GMRCRTFL=$S('+GMRCSR&('GMRCTUFN):1,1:0)
"RTN","GMRCGUIA",114,0)
 ;
"RTN","GMRCGUIA",115,0)
 D GETRSLT^GMRCART(TMPGLOB)
"RTN","GMRCGUIA",116,0)
 ;
"RTN","GMRCGUIA",117,0)
 D EXIT
"RTN","GMRCGUIA",118,0)
 Q
"RTN","GMRCGUIA",119,0)
EXIT ;kill off variables for exit from actions
"RTN","GMRCGUIA",120,0)
 K GMRCA,GMRCDVL,GMRCSR,GMRCRTFL,GMRCFL,GMRCORNP,GMRCQUT,GMRCSTS,GMRCTUFN
"RTN","GMRCGUIA",121,0)
 K GMRCRTFL,GMRCADUZ,GMRCORTX
"RTN","GMRCGUIA",122,0)
 Q
"RTN","GMRCGUIB")
0^13^B16436783
"RTN","GMRCGUIB",1,0)
GMRCGUIB ;SLC/DCM - GUI actions for consults from the GUI interface -- file actions taken ;4/30/98  09:49
"RTN","GMRCGUIB",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCGUIB",3,0)
SETDA() ;set DA of where audit actions are to be filed
"RTN","GMRCGUIB",4,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCGUIB",5,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCGUIB",6,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCGUIB",7,0)
 Q DA
"RTN","GMRCGUIB",8,0)
REASON(GMRCFN,GMRCRQ,GMRCDT) ;Load the reason for the request into ^GMR(123,GMRCO,20
"RTN","GMRCGUIB",9,0)
 ;GMRCFN=File 123 IFN; GMRCRQ=Array containing Reason For Request
"RTN","GMRCGUIB",10,0)
 ;GMRCDT=Date time of entry
"RTN","GMRCGUIB",11,0)
 S ^GMR(123,GMRCFN,20,0)="^^^"_GMRCDT_"^"
"RTN","GMRCGUIB",12,0)
 S L=0,LN=1 F  S L=$O(GMRCRQ(L)) Q:L=""  S ^GMR(123,GMRCFN,20,LN,0)=GMRCRQ(L),LN=LN+1
"RTN","GMRCGUIB",13,0)
 S LN=LN-1,$P(^GMR(123,GMRCFN,20,0),"^",3)=LN
"RTN","GMRCGUIB",14,0)
 K LN,L
"RTN","GMRCGUIB",15,0)
 Q
"RTN","GMRCGUIB",16,0)
SETCOM(COMMENT) ;Set comment array into tracking actions
"RTN","GMRCGUIB",17,0)
 N GMRCNOW,DR,DIE
"RTN","GMRCGUIB",18,0)
 S GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",19,0)
 S DIE="^GMR(123,GMRCO,40,",DA(1)=GMRCO,DR=".01////^S X=GMRCNOW;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=$G(GMRCORNP);4////^S X=DUZ;6////^S X=$G(GMRCFR);8////^S X=$G(GMRCFF)"
"RTN","GMRCGUIB",20,0)
 D ^DIE
"RTN","GMRCGUIB",21,0)
 S ^GMR(123,GMRCO,40,DA,1,0)="^^^^"_GMRCAD_"^"
"RTN","GMRCGUIB",22,0)
 S (GMRCND,GMRCND1)=0 F  S GMRCND1=$O(COMMENT(GMRCND1)) Q:GMRCND1=""  S GMRCND=GMRCND+1,^GMR(123,GMRCO,40,DA,1,GMRCND,0)=COMMENT(GMRCND)
"RTN","GMRCGUIB",23,0)
 S $P(^GMR(123,GMRCO,40,DA,1,0),"^",3)=GMRCND,$P(^(0),"^",4)=GMRCND,^GMR(123,GMRCO,40,"B",GMRCNOW,DA)=""
"RTN","GMRCGUIB",24,0)
 K GMRCND,GMRCND1
"RTN","GMRCGUIB",25,0)
 Q
"RTN","GMRCGUIB",26,0)
CMT(GMRCO,GMRCOM,GMRCADUZ,GMRCWHN,GMRCWHO) ;add comment to consult record
"RTN","GMRCGUIB",27,0)
 ; GMRCO = IEN from file 123
"RTN","GMRCGUIB",28,0)
 ; GMRCOM = array of comments in format GMRCOM(1)="xxxx", GMRCOM(2)="xxx"
"RTN","GMRCGUIB",29,0)
 ; GMRCADUZ= array of alert recipients as GMRCADUZ(DUZ)="" (optional)
"RTN","GMRCGUIB",30,0)
 ; GMRCWHO= IEN from file 200 who's responsible activity (optional)
"RTN","GMRCGUIB",31,0)
 ; GMRCWHN= date time of activity in FM format
"RTN","GMRCGUIB",32,0)
 ;
"RTN","GMRCGUIB",33,0)
 N DA,GMRCA,GMRCAD,GMRCORTX,GMRCDFN
"RTN","GMRCGUIB",34,0)
 S DA=$$SETDA ; get next activity tracking entry
"RTN","GMRCGUIB",35,0)
 S GMRCA=20,GMRCAD=GMRCWHN S:$G(GMRCWHO) GMRCORNP=GMRCWHO
"RTN","GMRCGUIB",36,0)
 D SETCOM(.GMRCOM)
"RTN","GMRCGUIB",37,0)
 Q:'$D(GMRCADUZ)
"RTN","GMRCGUIB",38,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCGUIB",39,0)
 S GMRCORTX="Comment Added to Consult "
"RTN","GMRCGUIB",40,0)
 S GMRCORTX=GMRCORTX_$$GET1^DIQ(123.5,$P(^GMR(123,+GMRCO,0),U,5),.01)
"RTN","GMRCGUIB",41,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,27,.GMRCADUZ,0)
"RTN","GMRCGUIB",42,0)
 Q
"RTN","GMRCGUIB",43,0)
SFILE(GMRCO,GMRCA,GMRCSF,GMRCORNP,GMRCDUZ,GMRCOM,GMRCALF,GMRCATO) ;Process various file update functions from the GUI for a consult
"RTN","GMRCGUIB",44,0)
 ;Enter here to file Significant Findings in Record
"RTN","GMRCGUIB",45,0)
 ;GMRCO=File 123 IEN of the consult record
"RTN","GMRCGUIB",46,0)
 ;GMRCSF=Significant Findings flag: 'Y'= significant finding
"RTN","GMRCGUIB",47,0)
 ;                                : 'N'= no significant finding
"RTN","GMRCGUIB",48,0)
 ;                                : 'U'=unknown significant finding
"RTN","GMRCGUIB",49,0)
 ;GMRCOM=An array contining comments
"RTN","GMRCGUIB",50,0)
 ;GMRCALF=Flag to signal that alerts are to be sent; 'N'=NO, 'Y'=YES
"RTN","GMRCGUIB",51,0)
 ;GMRCATO=Who alerts are to be sent to; a comma delimited string of DUZ's
"RTN","GMRCGUIB",52,0)
 ;GMRCORNP=Provider Responsible for action
"RTN","GMRCGUIB",53,0)
 ;GMRCDUZ=Person actually doing the action
"RTN","GMRCGUIB",54,0)
 N GMRCERR,GMRCERMS
"RTN","GMRCGUIB",55,0)
 L +^GMR(123,GMRCO):5 I '$T S GMRCERR=1,GMRCERMS="Record Locked. File Update Not Accomplished." Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",56,0)
 S GMRCERR=0,GMRCERMS="",DR="",GMRCORTX=""
"RTN","GMRCGUIB",57,0)
 N GMRCADUZ S GMRCADUZ=""
"RTN","GMRCGUIB",58,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCAD=GMRCNOW,GMRCSTS=$P(^GMR(123,+GMRCO,0),"^",12),GMRCDFN=$P(^(0),"^",2),GMRCDUZ=DUZ
"RTN","GMRCGUIB",59,0)
 I +$G(GMRCA),GMRCA=10 D
"RTN","GMRCGUIB",60,0)
 .S GMRCSTS=2
"RTN","GMRCGUIB",61,0)
 .S DR="8////^S X=GMRCSTS;9////^S X=GMRCA"
"RTN","GMRCGUIB",62,0)
 .S GMRCORTX="Completed Consult "_$$ORTX^GMRCAU(+GMRCO)_$S(GMRCSF="Y":" with Sig Findings",GMRCSF="N":" with no Sig Findings",1:"")
"RTN","GMRCGUIB",63,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",64,0)
 .Q
"RTN","GMRCGUIB",65,0)
 I $G(GMRCALF)=1 D
"RTN","GMRCGUIB",66,0)
 .N I
"RTN","GMRCGUIB",67,0)
 .F I=1:1  S X=$P(GMRCATO,";",I) Q:X=""  S GMRCADUZ(X)=""
"RTN","GMRCGUIB",68,0)
 .Q
"RTN","GMRCGUIB",69,0)
 I $L(GMRCA),GMRCA=4 S DR=DR_$S($L(DR):";",1:"")_"9////^S X=GMRCA;15////^S X=GMRCSF" D
"RTN","GMRCGUIB",70,0)
 .S GMRCORTX=$S(GMRCSF="Y":"Sig Findings ",GMRCSF="N":"No Sig Findings ",1:"Unknown Sig Findings ")_"for consult "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",71,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",72,0)
 .Q
"RTN","GMRCGUIB",73,0)
 I $L(DR) S DIE="^GMR(123,",DA=GMRCO D ^DIE K DIE,DR
"RTN","GMRCGUIB",74,0)
 I $D(GMRCOM),$O(GMRCOM(0)) D
"RTN","GMRCGUIB",75,0)
 .N DA
"RTN","GMRCGUIB",76,0)
 .S DA=$$SETDA()
"RTN","GMRCGUIB",77,0)
 .D SETCOM(.GMRCOM)
"RTN","GMRCGUIB",78,0)
 .Q
"RTN","GMRCGUIB",79,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCGUIB",80,0)
 I +$G(GMRCALF) D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,$S(GMRCA=20:27,1:23),.GMRCADUZ,0)
"RTN","GMRCGUIB",81,0)
 I $S(GMRCA=10:1,1:0) D EN^GMRCHL7($P(^GMR(123,GMRCO,0),"^",2),GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCGUIB",82,0)
 K DIE,DR,DA,GMRCDT,GMRCNOW,GMRCAD,GMRCORNP,GMRCDUZ,GMRCRSLT,GMRCSTS,GMRCADUZ,GMRCORTX,GMRCDFN
"RTN","GMRCGUIB",83,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIC")
0^50^B59555671
"RTN","GMRCGUIC",1,0)
GMRCGUIC ;SLC/DCM,JFR - GUI actions for editing consults; 12/17/98 14:19
"RTN","GMRCGUIC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCGUIC",3,0)
SENDCOMT(GMRCO,ND1) ;Get comments
"RTN","GMRCGUIC",4,0)
 N NDX,NDY,CMTDT,SENDR,TYPE
"RTN","GMRCGUIC",5,0)
 S NDX=0,CMTDT="",SENDR=""
"RTN","GMRCGUIC",6,0)
 S NDX=0 F  S NDX=$O(^GMR(123,GMRCO,40,NDX)) Q:NDX?1A.E!(NDX="")  S TYPE=$P(^GMR(123,GMRCO,40,NDX,0),"^",2) I $S(TYPE=19:1,TYPE=20:1,1:0) S TYPE(TYPE,NDX)=""
"RTN","GMRCGUIC",7,0)
 I $O(TYPE(19,0)) S @GLOBAL@(ND1,0)="~DENY COMMENT",ND1=ND1+1 D
"RTN","GMRCGUIC",8,0)
 .S NDX=0 F  S NDX=$O(TYPE(19,NDX)) Q:NDX=""   D
"RTN","GMRCGUIC",9,0)
 ..S CMTDT=$$FMTE^XLFDT($P(^GMR(123,GMRCO,40,NDX,0),"^",1)),SENDR=$S($L($P(^GMR(123,GMRCO,40,NDX,0),"^",4)):$P(^VA(200,$P(^(0),"^",4),0),"^",1),1:"Missing Data")
"RTN","GMRCGUIC",10,0)
 ..S @GLOBAL@(ND1,0)="t"_"CANCELLED: "_CMTDT_" BY: "_SENDR,ND1=ND1+1,NDY=0
"RTN","GMRCGUIC",11,0)
 ..S NDY=0 F  S NDY=$O(^GMR(123,GMRCO,40,NDX,1,NDY)) Q:NDY=""  S @GLOBAL@(ND1,0)="t"_^GMR(123,GMRCO,40,NDX,1,NDY,0),ND1=ND1+1
"RTN","GMRCGUIC",12,0)
 ..S @GLOBAL@(ND1,0)="t",$P(@GLOBAL@(ND1,0),"-",81)="",ND1=ND1+1
"RTN","GMRCGUIC",13,0)
 ..Q
"RTN","GMRCGUIC",14,0)
 .Q
"RTN","GMRCGUIC",15,0)
 S NDX=0 F  S NDX=$O(TYPE(20,NDX)) Q:NDX=""  S @GLOBAL@(ND1,0)="~ADDED COMMENT",ND1=ND1+1 D
"RTN","GMRCGUIC",16,0)
 .S CMTDT=$$FMTE^XLFDT($P(^GMR(123,GMRCO,40,NDX,0),"^",1)),SENDR=$S($L($P(^GMR(123,GMRCO,40,NDX,0),"^",4)):$P(^VA(200,$P(^GMR(123,GMRCO,40,NDX,0),"^",4),0),"^",1),1:"UNKNOWN")
"RTN","GMRCGUIC",17,0)
 .S @GLOBAL@(ND1,0)="t"_"COMMENT on "_CMTDT_" BY: "_SENDR,ND1=ND1+1
"RTN","GMRCGUIC",18,0)
 .S NDY=0 F  S NDY=$O(^GMR(123,GMRCO,40,NDX,1,NDY)) Q:NDY=""  S @GLOBAL@(ND,0)="t"_^GMR(123,GMRCO,40,NDX,1,NDY,0),ND1=ND1+1
"RTN","GMRCGUIC",19,0)
 .S @GLOBAL@(ND1,0)="t",$P(@GLOBAL@(ND1,0),"-",81)="",ND1=ND1+1
"RTN","GMRCGUIC",20,0)
 .Q
"RTN","GMRCGUIC",21,0)
 Q
"RTN","GMRCGUIC",22,0)
 ;
"RTN","GMRCGUIC",23,0)
RFQ(GMRCO,MSG,ND,NOW) ;File Reason For Request field 20
"RTN","GMRCGUIC",24,0)
 N GMRCND,GMRCNT
"RTN","GMRCGUIC",25,0)
 S GMRCND=$O(^GMR(123,GMRCO,20,0)) I GMRCND="" S GMRCFLD(20)="Reason For Request: No Previous Value^20" Q
"RTN","GMRCGUIC",26,0)
 M ^TMP("GMRCFLD20",$J,20)=^GMR(123,GMRCO,20) ;JFR 12/18
"RTN","GMRCGUIC",27,0)
 S GMRCFLD(20)=$NAME(^TMP("GMRCFLD20",$J,20))
"RTN","GMRCGUIC",28,0)
 K ^GMR(123,GMRCO,20)
"RTN","GMRCGUIC",29,0)
 S ^GMR(123,GMRCO,20,0)="^^^^"_DT_"^"
"RTN","GMRCGUIC",30,0)
 S GMRCND="",GMRCNT=1 F  S GMRCND=$O(@MSG@(ND,GMRCND)) Q:GMRCND=""  S ^GMR(123,GMRCO,20,GMRCNT,0)=@MSG@(ND,GMRCND),GMRCNT=GMRCNT+1
"RTN","GMRCGUIC",31,0)
 S $P(^GMR(123,GMRCO,20,0),"^",3)=GMRCNT-1,$P(^(0),"^",4)=GMRCNT-1
"RTN","GMRCGUIC",32,0)
 Q
"RTN","GMRCGUIC",33,0)
FILE(GMRCO,MSG,GMRCLM) ;File Edit changes
"RTN","GMRCGUIC",34,0)
 ;GMRCO=Record IEN,  GMRCCOM=Comment Array
"RTN","GMRCGUIC",35,0)
 ;MSG=^TMP global where the data resides, i.e., MSG="^TMP(""GMRCR"",$J)"
"RTN","GMRCGUIC",36,0)
 ;    Data is stored in subscripted nodes: ^TMP("GMRCR",$J,1)="GMRCSS^2"
"RTN","GMRCGUIC",37,0)
 ;    Word processing data is stored in second subscripted node:
"RTN","GMRCGUIC",38,0)
 ;    ^TMP("GMRCR",$J,9,1)="This is word processing data."
"RTN","GMRCGUIC",39,0)
 ;GMRCSS=To Service     GMRCPROC=procedure/Request Type
"RTN","GMRCGUIC",40,0)
 ;GMRCURG=Urgency       GMRCPL=Place Of Consultation
"RTN","GMRCGUIC",41,0)
 ;GMRCATN=Attention To  GMRCINO=Service is In/Out Patient
"RTN","GMRCGUIC",42,0)
 ;GMRCDIAG=Provisional Diagnosis  .GMRCRFQ=Reason For Request array
"RTN","GMRCGUIC",43,0)
 ;GMRCREQ=Procedure or Request; i.e., GMRCRQT=1727=^ORD(101,1727,0)='Procedure';GMRCRQT=1296=^ORD(101,1296,0)='Consult'
"RTN","GMRCGUIC",44,0)
 ;GMRCITM=Item ordered for field .1 (stored in ^GMR(123,GMRCO,1.11,
"RTN","GMRCGUIC",45,0)
 ;GMRCLM=coming from List Manager instead of the GUI
"RTN","GMRCGUIC",46,0)
 ;
"RTN","GMRCGUIC",47,0)
 I '$D(GMRCO)!('+GMRCO) Q
"RTN","GMRCGUIC",48,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCGUIC",49,0)
 S GMRCMSG="",GMRCNOD=0
"RTN","GMRCGUIC",50,0)
 F  S GMRCNOD=$O(@MSG@(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=@MSG@(GMRCNOD) D
"RTN","GMRCGUIC",51,0)
 .I $P(GMRCMSG,"^",1)="COMMENT" D COMMENT^GMRCGUIU(GMRCO,MSG,GMRCNOD,$P(GMRCMSG,"^",2)) Q
"RTN","GMRCGUIC",52,0)
 .I $P(GMRCMSG,"^",1)="GMRCRFQ" D RFQ(GMRCO,MSG,GMRCNOD,GMRCDT) Q
"RTN","GMRCGUIC",53,0)
 .I $P(GMRCMSG,"^",1)="GMRCSS" S GMRCSS=$P(GMRCMSG,"^",2),GMRCFLD(1)=$P(^GMR(123.5,$P(^GMR(123,GMRCO,0),"^",5),0),"^",1)_"^1" Q
"RTN","GMRCGUIC",54,0)
 .I $P(GMRCMSG,"^",1)="GMRCITM" S GMRCITM=$P(GMRCMSG,"^",2),GMRCFLD(.1)=^GMR(123,GMRCO,1.11)_"^.1" Q
"RTN","GMRCGUIC",55,0)
 .;I $P(MSG,"^",1)="GMRCPROC" S GMRCFLD(4)=$S(+$P(^GMR(123,+GMRCO,0),"^",8):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",8),0),"^",2),1:"")_"^4" D  Q
"RTN","GMRCGUIC",56,0)
 .I $P(GMRCMSG,"^",1)="GMRCPROC" S GMRCFLD(4)=+$P(^GMR(123,+GMRCO,0),"^",8)_"^4" D  Q
"RTN","GMRCGUIC",57,0)
 ..S GMRCPROC=$S($L($P(GMRCMSG,"^",2)):$P(GMRCMSG,"^",2),1:1296) I $L($P(^GMR(123,GMRCO,0),"^",8)),$P(GMRCMSG,"^",2)="" S GMRCPROC="DELETE"
"RTN","GMRCGUIC",58,0)
 ..Q
"RTN","GMRCGUIC",59,0)
 .I $P(GMRCMSG,"^",1)="GMRCURG" S GMRCURG=$P(GMRCMSG,"^",2),GMRCFLD(5)=$S(+$P(^GMR(123,+GMRCO,0),"^",9):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",9),0),"^",2),1:"")_"^"_$P(^GMR(123,+GMRCO,0),"^",9) Q
"RTN","GMRCGUIC",60,0)
 .I $P(GMRCMSG,"^",1)="GMRCPL" D  Q
"RTN","GMRCGUIC",61,0)
 ..S GMRCPL=$P(GMRCMSG,"^",2) I '+GMRCPL D
"RTN","GMRCGUIC",62,0)
 ...S GMRCPL="GMRCPLACE - "_$S(GMRCPL="C":"ON CALL",GMRCPL="B":"BEDSIDE",GMRCPL="E":"EMERGENCY ROOM",1:GMRCPL),GMRCPL=$O(^ORD(101,"B",GMRCPL,0))
"RTN","GMRCGUIC",63,0)
 ..S GMRCFLD(6)=$S(+$P(^GMR(123,+GMRCO,0),"^",10):$P($P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",10),0),"^",1)," - ",2),1:"")_"^6"
"RTN","GMRCGUIC",64,0)
 ..Q
"RTN","GMRCGUIC",65,0)
 .I $P(GMRCMSG,"^",1)="GMRCATN" S GMRCATN=$P(GMRCMSG,"^",2),GMRCFLD(7)=$S(+$P(^GMR(123,+GMRCO,0),"^",11):$P(^VA(200,+$P(^GMR(123,+GMRCO,0),"^",11),0),"^",1),1:"")_"^7" Q
"RTN","GMRCGUIC",66,0)
 .I $P(GMRCMSG,"^",1)="GMRCREQ" S GMRCREQ=$P(GMRCMSG,"^",2),GMRCFLD(13)=$S(+$P(^GMR(123,+GMRCO,0),"^",17):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",17),0),"^",2),1:"")_"^13" Q
"RTN","GMRCGUIC",67,0)
 .I $P(GMRCMSG,"^",1)="GMRCION" S GMRCION=$P(GMRCMSG,"^",2),GMRCFLD(14)=$S($P(^GMR(123,+GMRCO,0),"^",18)="I":"Inpatient",$P(^(0),"^",18)="O":"Outpatient",1:"")_"^14" Q
"RTN","GMRCGUIC",68,0)
 .I $P(GMRCMSG,"^",1)="GMRCDIAG" S GMRCDIAG=$P(GMRCMSG,"^",2),GMRCFLD(30)=$S($D(^GMR(123,+GMRCO,30)):^(30),1:"No Previous Value")_"^30" Q
"RTN","GMRCGUIC",69,0)
 .Q
"RTN","GMRCGUIC",70,0)
 S:'$D(GMRCLM) GMRCGUIF=1
"RTN","GMRCGUIC",71,0)
 D EN^GMRCEDT3(GMRCO)
"RTN","GMRCGUIC",72,0)
 S DR=$$SETDA^GMRCGUIU($G(GMRCSS),$G(GMRCPROC),$G(GMRCURG),$G(GMRCPL),$G(GMRCATN),$G(GMRCRQT),$G(GMRCION),$G(GMRCDIAG)) I $L(DR) D
"RTN","GMRCGUIC",73,0)
 .S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCGUIC",74,0)
 .L +^GMR(123,GMRCO)
"RTN","GMRCGUIC",75,0)
 .D ^DIE
"RTN","GMRCGUIC",76,0)
 .S DR="8////^S X=5;9////^S X=11"
"RTN","GMRCGUIC",77,0)
 .D ^DIE
"RTN","GMRCGUIC",78,0)
 .L -^GMR(123,GMRCO)
"RTN","GMRCGUIC",79,0)
 .K DIE,DR,DA
"RTN","GMRCGUIC",80,0)
 .Q
"RTN","GMRCGUIC",81,0)
 S DFN=$P(^GMR(123,+GMRCO,0),"^",2),GMRCPROV=$P(^(0),"^",14),GMRCTYPE=$P(^(0),"^",17),GMRCTRLC="XX",VISIT="",RMBED=""
"RTN","GMRCGUIC",82,0)
 D EN^GMRCHL7(DFN,+GMRCO,GMRCTYPE,RMBED,GMRCTRLC,GMRCPROV,VISIT,.GMRCOM)
"RTN","GMRCGUIC",83,0)
 S GMRCSVC=$S($G(GMRCSS):GMRCSS,1:$P(^GMR(123,+GMRCO,0),U,5))
"RTN","GMRCGUIC",84,0)
 S GMRCORTX="Resubmitted consult "_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIC",85,0)
 S GMRCORTX=GMRCORTX_$S($G(GMRCURG):" ("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",+$P(^GMR(123,+GMRCO,0),U,9):"( "_$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),U,9),0),"^",2)_" )",1:"")
"RTN","GMRCGUIC",86,0)
 S GMRCFL=1
"RTN","GMRCGUIC",87,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,27,.GMRCADUZ,GMRCFL) ;Send notification of NEW consult
"RTN","GMRCGUIC",88,0)
 D PRNT^GMRCUTL1(+$P(^GMR(123,+GMRCO,0),U,5),+GMRCO) ;send 513 to service
"RTN","GMRCGUIC",89,0)
 ;Next line gets rid of alert
"RTN","GMRCGUIC",90,0)
 I $D(XQAID),$L(XQAID) D
"RTN","GMRCGUIC",91,0)
 . N GMRCCORY
"RTN","GMRCGUIC",92,0)
 . S XQAKILL=$$XQAKILL^ORB3F1 D DEL^ORB3FUP1(.GMRCCORY,XQAID)
"RTN","GMRCGUIC",93,0)
 D GUIC^GMRCGUIU
"RTN","GMRCGUIC",94,0)
 Q
"RTN","GMRCGUIC",95,0)
SEND(GMRCO,GLOBAL) ;Get data fields to send to GUI for editing consult
"RTN","GMRCGUIC",96,0)
 ;GMRCO=record being edited GLOBAL=Global Referece, i.e., "^TMP("GMRCR",$J)"
"RTN","GMRCGUIC",97,0)
 K @GLOBAL
"RTN","GMRCGUIC",98,0)
 N ND,GMRCSX,TYPE
"RTN","GMRCGUIC",99,0)
 S ND=1,GMRCSX=""
"RTN","GMRCGUIC",100,0)
 I '$D(GMRCO)!('+GMRCO) Q
"RTN","GMRCGUIC",101,0)
 S GMRCSS=$P(^GMR(123,+GMRCO,0),"^",5),GMRCPROC=$P(^(0),"^",8),GMRCURG=$P(^(0),"^",9),GMRCPL=$P(^(0),"^",10),GMRCATN=$P(^(0),"^",11),GMRCINO=$P(^(0),"^",18),GMRCREQ=$P(^GMR(123,GMRCO,0),"^",17),GMRCDIAG=$G(^GMR(123,+GMRCO,30))
"RTN","GMRCGUIC",102,0)
 S GMRCPROV=$S($P(^GMR(123,+GMRCO,0),"^",14)]"":$P(^VA(200,$P(^GMR(123,+GMRCO,0),"^",14),0),"^",1),1:"")
"RTN","GMRCGUIC",103,0)
 S @GLOBAL@(ND,0)="~SERVICE",ND=ND+1
"RTN","GMRCGUIC",104,0)
 I +GMRCSS S GMRCSX=$P(^GMR(123.5,GMRCSS,0),"^",1),@GLOBAL@(ND,0)="d"_GMRCSX_"^"_GMRCSS_"^",ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",105,0)
 E  S @GLOBAL@(ND,0)="d"_"^^",ND=ND+1
"RTN","GMRCGUIC",106,0)
 S @GLOBAL@(ND,0)="~PROCEDURE",ND=ND+1
"RTN","GMRCGUIC",107,0)
 I $L(GMRCPROC),+GMRCPROC D
"RTN","GMRCGUIC",108,0)
 .S GMRCSX=$$UP^XLFSTR($$GET1^DIQ(101,+GMRCPROC,1))
"RTN","GMRCGUIC",109,0)
 .S GMRCSY=$S($L(GMRCSX):$$FIND1^DIC(101.43,,"QX",GMRCSX,"S.PROC"),1:"")
"RTN","GMRCGUIC",110,0)
 .I +GMRCSY D
"RTN","GMRCGUIC",111,0)
 ..S @GLOBAL@(ND,0)="d"_GMRCSY_"^"_GMRCSX_"^"_GMRCPROC,ND=ND+1
"RTN","GMRCGUIC",112,0)
 ..Q
"RTN","GMRCGUIC",113,0)
 E  S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",114,0)
 S @GLOBAL@(ND,0)="~TYPE",ND=ND+1
"RTN","GMRCGUIC",115,0)
 I +GMRCREQ S GMRCSX=$P($P(^ORD(101,GMRCREQ,0),"^",1),"GMRCOR ",2),@GLOBAL@(ND,0)="d"_$E(GMRCSX,1)_"^"_GMRCSX_"^"_GMRCREQ,ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",116,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",117,0)
 S @GLOBAL@(ND,0)="~CATEGORY",ND=ND+1
"RTN","GMRCGUIC",118,0)
 I $L(GMRCINO) D  S ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",119,0)
 .S @GLOBAL@(ND,0)="d"_GMRCINO_"^"_$S(GMRCINO="I":"INPATIENT",1:"OUTPATIENT")_"^"
"RTN","GMRCGUIC",120,0)
 .S @GLOBAL@(ND,0)=@GLOBAL@(ND,0)_$S(GMRCINO="I":$O(^ORD(101,"B","GMRCURGENCYM CSLT - INPATIENT",0)),1:$O(^ORD(101,"B","GMRCURGENCYM - OUTPATIENT",0)))
"RTN","GMRCGUIC",121,0)
 .Q
"RTN","GMRCGUIC",122,0)
 E  S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",123,0)
 S @GLOBAL@(ND,0)="~DIAGNOSIS",ND=ND+1
"RTN","GMRCGUIC",124,0)
 I $L(GMRCDIAG) S @GLOBAL@(ND,0)="d"_GMRCDIAG,ND=ND+1
"RTN","GMRCGUIC",125,0)
 E  S @GLOBAL@(ND,0)="d"
"RTN","GMRCGUIC",126,0)
 S @GLOBAL@(ND,0)="~PLACE",ND=ND+1
"RTN","GMRCGUIC",127,0)
 I +GMRCPL D  S ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",128,0)
 .S GMRCSX=$P($P(^ORD(101,GMRCPL,0),"^",1),"GMRCPLACE - ",2),GMRCSX=$S(GMRCSX="ON CALL":"CONSULTANTS CHOICE",1:GMRCSX),@GLOBAL@(ND,0)="d"_$E(GMRCSX,1)_"^"_GMRCSX_"^"_GMRCPL
"RTN","GMRCGUIC",129,0)
 .Q
"RTN","GMRCGUIC",130,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",131,0)
 S @GLOBAL@(ND,0)="~ATTENTION",ND=ND+1
"RTN","GMRCGUIC",132,0)
 I +GMRCATN S GMRCSX=$P(^VA(200,GMRCATN,0),"^",1),@GLOBAL@(ND,0)="d"_GMRCATN_"^"_GMRCSX_"^"_GMRCATN,ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",133,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",134,0)
 S @GLOBAL@(ND,0)="~URGENCY",ND=ND+1
"RTN","GMRCGUIC",135,0)
 I +GMRCURG S GMRCSX=$P($P(^ORD(101,GMRCURG,0),"^",1),"GMRCURGENCY - ",2),GMRCURGY=$O(^ORD(101.42,"S.GMRCO",GMRCSX,0)) I $L(GMRCSX) D
"RTN","GMRCGUIC",136,0)
 .S GMRCSY=$O(^ORD(101.42,"B",GMRCSX,0))
"RTN","GMRCGUIC",137,0)
 .S @GLOBAL@(ND,0)="d"_GMRCSY_"^"_GMRCSX_"^"_GMRCURG,ND=ND+1
"RTN","GMRCGUIC",138,0)
 .S GMRCSX="" K GMRCSY
"RTN","GMRCGUIC",139,0)
 .Q
"RTN","GMRCGUIC",140,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",141,0)
 ;Get reason for request
"RTN","GMRCGUIC",142,0)
 S @GLOBAL@(ND,0)="~REASON",ND=ND+1
"RTN","GMRCGUIC",143,0)
 I $O(^GMR(123,+GMRCO,20,0)) S NDX=0 F  S NDX=$O(^GMR(123,+GMRCO,20,NDX)) Q:NDX=""  S @GLOBAL@(ND,0)="t"_^GMR(123,+GMRCO,20,NDX,0),ND=ND+1
"RTN","GMRCGUIC",144,0)
 E  S @GLOBAL@(ND,0)="~REASON",ND=ND+1,@GLOBAL@(ND,0)="tREASON "
"RTN","GMRCGUIC",145,0)
 ;Get Comments, including Deny Comments
"RTN","GMRCGUIC",146,0)
 D SENDCOMT(GMRCO,.ND)
"RTN","GMRCGUIC",147,0)
 D GUIC^GMRCGUIU
"RTN","GMRCGUIC",148,0)
 Q
"RTN","GMRCGUIU")
0^51^B5871399
"RTN","GMRCGUIU",1,0)
GMRCGUIU ;SLC/DCM - Kill off variables from GUI routines; 12/18/98 14:19
"RTN","GMRCGUIU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCGUIU",3,0)
GUIC ;Kill variables from GMRCGUIC
"RTN","GMRCGUIU",4,0)
 K GMRC(0),GMRCA,GMRCATN,GMRCD,GMRCDD,GMRCDIAG,GMRCDT,GMRCED,GMRCEDCM,GMRCFL,GMRCFLD,GMRCION,GMRCLNO,GMRCNATO,GMRCNT,GMRCORTX,GMRCPL,GMRCPROC,GMRCRQT,GMRCS38,GMRCSS,GMRCSVC,GMRCTRLC,GMRCTYPE,GMRCURG,GMRCX,LN,GMRCADUZ,ORDG,RMBED,VISIT
"RTN","GMRCGUIU",5,0)
 K GMRCITM,GMRCMSG,GMRCND1,GMRCNOD,GMRCPROV,GMRCOUNT,GMRCGUIF,GMRCREQ
"RTN","GMRCGUIU",6,0)
 K GMRCSS,GMRCPROC,GMRCURG,GMRCURGY,GMRCPL,GMRCATN,GMRCINO,GMRCREQ,GMRCDIAG,GMRCPROV,ND,NDX
"RTN","GMRCGUIU",7,0)
 K XQAKILL
"RTN","GMRCGUIU",8,0)
 Q
"RTN","GMRCGUIU",9,0)
SETDA(GMRCSS,GMRCPROC,GMRCURG,GMRCPL,GMRCATN,GMRCRQT,GMRCION,GMRCDIAG)  ;Set DA in ^GMR(123,GMRCO,40
"RTN","GMRCGUIU",10,0)
 N X
"RTN","GMRCGUIU",11,0)
 S X=""
"RTN","GMRCGUIU",12,0)
 I +GMRCSS S X="1////^S X=+GMRCSS;.1///@;"
"RTN","GMRCGUIU",13,0)
 I +GMRCPROC S X=X_"4////^S X=GMRCPROC;.1///@;"
"RTN","GMRCGUIU",14,0)
 I +GMRCURG S X=X_"5////^S X=GMRCURG;"
"RTN","GMRCGUIU",15,0)
 I +GMRCPL S X=X_"6////^S X=GMRCPL;"
"RTN","GMRCGUIU",16,0)
 I +GMRCATN S X=X_"7////^S X=GMRCATN;"
"RTN","GMRCGUIU",17,0)
 I $G(GMRCATN)="@" S X=X_"7///@;"
"RTN","GMRCGUIU",18,0)
 I $L(GMRCION) S X=X_"14///^S X=GMRCION;"
"RTN","GMRCGUIU",19,0)
 I $L(GMRCDIAG) D 
"RTN","GMRCGUIU",20,0)
 . I GMRCDIAG="@" S X=X_"30///@;" Q
"RTN","GMRCGUIU",21,0)
 . S X=X_"30////^S X=GMRCDIAG;"
"RTN","GMRCGUIU",22,0)
 I $L(X) S X=$E(X,1,$L(X)-1)
"RTN","GMRCGUIU",23,0)
 Q X
"RTN","GMRCGUIU",24,0)
 ;
"RTN","GMRCGUIU",25,0)
COMMENT(GMRCO,MSG,ND,GMRCDA)    ;File comments from GUI edits
"RTN","GMRCGUIU",26,0)
 N Y
"RTN","GMRCGUIU",27,0)
 S GMRCDA=$$ADDCM^GMRCEDT4(GMRCO),GMRCA=20
"RTN","GMRCGUIU",28,0)
 D AUDIT0^GMRCEDT4(GMRCDA,GMRCO)
"RTN","GMRCGUIU",29,0)
 S Y=$$FMTE^XLFDT(DT,"1D"),GMRCFLD(40)="COMMENT ADDED: "_Y_"^"_GMRCDA
"RTN","GMRCGUIU",30,0)
 S GMRCND="",GMRCNT=1 F  S GMRCND=$O(@MSG@(ND,GMRCND)) Q:GMRCND=""  S ^GMR(123,GMRCO,40,GMRCDA,1,GMRCNT,0)=@MSG@(ND,GMRCND),GMRCNT=GMRCNT+1
"RTN","GMRCGUIU",31,0)
 S ^GMR(123,GMRCO,40,GMRCDA,1,0)="^^"_(GMRCNT-1)_"^"_(GMRCNT-1)_"^"_GMRCDT_"^"
"RTN","GMRCGUIU",32,0)
 Q
"RTN","GMRCMER")
0^26^B2227423
"RTN","GMRCMER",1,0)
GMRCMER ;SLC/DCM - Print Medicine Results in List Manager Format ;4/30/98  10:05
"RTN","GMRCMER",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCMER",3,0)
 ;
"RTN","GMRCMER",4,0)
EN ; -- main entry point for GMRC ASSOCIATE RESULTS
"RTN","GMRCMER",5,0)
 D EN^VALM("GMRC ASSOCIATE RESULTS")
"RTN","GMRCMER",6,0)
 Q
"RTN","GMRCMER",7,0)
 ;
"RTN","GMRCMER",8,0)
HDR ; -- header code uses Detailed Display header to format VALMHDR
"RTN","GMRCMER",9,0)
 D HDR^GMRCSLDT
"RTN","GMRCMER",10,0)
 Q
"RTN","GMRCMER",11,0)
 ;
"RTN","GMRCMER",12,0)
INIT ; -- init variables and list array
"RTN","GMRCMER",13,0)
 K ^TMP("GMRCR",$J,"DTLIST")
"RTN","GMRCMER",14,0)
 S DSPLINE=0,VARMAR="^TMP(""GMRCR"",$J,""DTLIST"")"
"RTN","GMRCMER",15,0)
 F LINE=1:1:GMRCCT S DSPLINE=$O(^TMP("GMRCR",$J,"DT",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCMER",16,0)
 S VALMCNT=LINE-1
"RTN","GMRCMER",17,0)
 K DSPLINE,DATA,LINE
"RTN","GMRCMER",18,0)
 Q
"RTN","GMRCMER",19,0)
 ;
"RTN","GMRCMER",20,0)
HELP ; -- help code for display actions
"RTN","GMRCMER",21,0)
 D HELP^GMRCSLDT
"RTN","GMRCMER",22,0)
 Q
"RTN","GMRCMER",23,0)
 ;
"RTN","GMRCMER",24,0)
EXIT ; -- exit code
"RTN","GMRCMER",25,0)
 K ^TMP("GMRCR",$J,"DT")
"RTN","GMRCMER",26,0)
 S:$D(GMRCLCT) VALMCNT=GMRCLCT
"RTN","GMRCMER",27,0)
 K GLOBAL,GMRCMODE,GMRCND,GMRCSGAD,GMRCCSIG,GMRCCSDT,GMRCSIGT,GMRCSR,GMRCSIGM,GMRCCTIT,GMRCLCT,GMRCADD,GMRCADDT,GMRCSDT,GMRCSIG,GMRCTUFN,ND,ND1
"RTN","GMRCMER",28,0)
 Q
"RTN","GMRCMER",29,0)
 ;
"RTN","GMRCP")
0^41^B10716462
"RTN","GMRCP",1,0)
GMRCP ;SLC/DLT,DCM - Message audit and status process ;7/16/98  01:52
"RTN","GMRCP",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCP",3,0)
 ;Processing action on Generic Requests/Consults from OE/RR
"RTN","GMRCP",4,0)
MSG(GMRCDFN,GMRCALRM,GMRCIFN,ORN,GMRCADUZ,FLG) ;send alert notification information to OERR for notification or update
"RTN","GMRCP",5,0)
 ;GMRCDFN=patient's DFN           GMRCORFN=OR file # ^OR(100,GMRCORFN
"RTN","GMRCP",6,0)
 ;GMRCALRM=alert message to be displayed with alert
"RTN","GMRCP",7,0)
 ;GMRCIFN=internal file number of consult in file 123
"RTN","GMRCP",8,0)
 ;GMRCADUZ=set in call to EN^GMRCT=array of providers who will be alerted
"RTN","GMRCP",9,0)
 ;FLG=1 if need to get list of service's providers, 0 if service dc'd.
"RTN","GMRCP",10,0)
 ;ORN=IFN from file ^ORD(100.9, for consult notification action
"RTN","GMRCP",11,0)
 N GMRCSS,GMRCORFN
"RTN","GMRCP",12,0)
 S GMRCORFN=$P(^GMR(123,GMRCIFN,0),"^",3)
"RTN","GMRCP",13,0)
 S GMRCSS=$P($G(^GMR(123,+GMRCIFN,0)),"^",5) I FLG,GMRCSS D EN^GMRCT(GMRCSS)
"RTN","GMRCP",14,0)
 I FLG,$P(^GMR(123,+GMRCIFN,0),"^",11) S GMRCADUZ($P(^(0),"^",11))=""
"RTN","GMRCP",15,0)
 S:'$D(GMRCADUZ) GMRCADUZ=""
"RTN","GMRCP",16,0)
 D EN^ORB3(ORN,GMRCDFN,GMRCORFN,.GMRCADUZ,GMRCALRM,GMRCIFN)
"RTN","GMRCP",17,0)
 Q
"RTN","GMRCP",18,0)
AUDIT ;Build processing activity audit trail multiple.
"RTN","GMRCP",19,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCP",20,0)
AUDIT0 ;alternate entry with date already defined
"RTN","GMRCP",21,0)
 L +^GMR(123,+GMRCO,40):5 I '$T S GMRCUT=1,GMRCERR=1,GMRCERMS="Activity Trail Not filed - Consult In Use By Another User." L -^GMR(123,+GMRCO,40)  Q
"RTN","GMRCP",22,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^"
"RTN","GMRCP",23,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCP",24,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCP",25,0)
AUDIT1 ;entry when the DA is not incremented (INCOMPLETE RPT writeovers)
"RTN","GMRCP",26,0)
 S GMRCORNP=$G(GMRCORNP) S:'$D(GMRCOM) GMRCOM=0
"RTN","GMRCP",27,0)
 S GMRCDEV=$G(GMRCDEV),GMRCFF=$G(GMRCFF),GMRCPA=$G(GMRCPA)
"RTN","GMRCP",28,0)
 S GMRCAD=$S('$D(GMRCAD):GMRCDT,1:GMRCAD)
"RTN","GMRCP",29,0)
 S GMRCRSLT=$G(GMRCRSLT) ;Added result with GMRC*3.0*4
"RTN","GMRCP",30,0)
 S DIE="^GMR(123,"_+GMRCO_",40,",DA(1)=+GMRCO
"RTN","GMRCP",31,0)
 I '$D(^GMR(123,DA(1),40,DA,0)) D
"RTN","GMRCP",32,0)
 . S DR=".01////^S X=GMRCDT;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=GMRCORNP;4////^S X=DUZ;6////^S X=GMRCFF;7////^S X=GMRCPA;8////^S X=GMRCDEV;9////^S X=GMRCRSLT"
"RTN","GMRCP",33,0)
 E  D
"RTN","GMRCP",34,0)
 . ;DR string on .01 allows write over, rather than forced new entry
"RTN","GMRCP",35,0)
 . S DR=".01///^S X=GMRCDT;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=GMRCORNP;4////^S X=DUZ;6////^S X=GMRCFF;7////^S X=GMRCPA;8////^S X=GMRCDEV;9////^S X=GMRCRSLT"
"RTN","GMRCP",36,0)
 ;Added result to the DR string
"RTN","GMRCP",37,0)
 D ^DIE
"RTN","GMRCP",38,0)
 ;Enter comment
"RTN","GMRCP",39,0)
 I +$G(GMRCOM) S GMRCOM(0)=DA D
"RTN","GMRCP",40,0)
 . W !,"Enter COMMENT..."
"RTN","GMRCP",41,0)
 . N DIC,DWPK,DWLW,DIWESUB
"RTN","GMRCP",42,0)
 . S DIC=DIE_DA_",1,",DWPK=1,DWLW=74
"RTN","GMRCP",43,0)
 . S DIWESUB="COMMENTS" D EN^DIWE
"RTN","GMRCP",44,0)
 . I $P($G(^GMR(123.1,+$P(^GMR(123,+GMRCO,40,DA,0),U,2),0)),U)="ADDED COMMENT",'$O(^GMR(123,+GMRCO,40,DA,0)) D  Q
"RTN","GMRCP",45,0)
 .. S DA(1)=+GMRCO,DIK="^GMR(123,"_DA(1)_",40," D ^DIK K DIK
"RTN","GMRCP",46,0)
 .. Q
"RTN","GMRCP",47,0)
 . I $D(^GMR(123,+GMRCO,40,DA,0)),$O(^GMR(123,+GMRCO,40,DA,0)) S $P(GMRCOM,"^",2)=1
"RTN","GMRCP",48,0)
 . Q
"RTN","GMRCP",49,0)
 L -^GMR(123,+GMRCO,40)
"RTN","GMRCP",50,0)
 K DIE,DA,DR,GMRCDEV,GMRCFF,GMRCPA,X,% Q
"RTN","GMRCP",51,0)
 ;
"RTN","GMRCP",52,0)
STATUS ;Update the status for the Request/Consultation File
"RTN","GMRCP",53,0)
 K GMRCQUT
"RTN","GMRCP",54,0)
 Q:'$D(GMRCSTS)!('$D(GMRCA))
"RTN","GMRCP",55,0)
 S DIE=123,DA=+GMRCO
"RTN","GMRCP",56,0)
 I $D(GMRCDR),$L(GMRCDR) S DR=GMRCDR
"RTN","GMRCP",57,0)
 E  S DR="8////^S X=GMRCSTS;9////^S X=GMRCA"
"RTN","GMRCP",58,0)
 L +^GMR(123,GMRCO):2 I '$T S GMRCQUT=1,GMRCERR=1,GMRCERMS="Unable to update status and last action - Consult In Use By Another User." Q
"RTN","GMRCP",59,0)
 D ^DIE
"RTN","GMRCP",60,0)
 L -^GMR(123,+GMRCO)
"RTN","GMRCP",61,0)
 K DIE,DA,DR,GMRCDR
"RTN","GMRCP",62,0)
 Q
"RTN","GMRCP5")
0^1^B44529925
"RTN","GMRCP5",1,0)
GMRCP5 ;SLC/DCM,RJS - Print Consult form 513 (main entry) ;5/14/98  11:09
"RTN","GMRCP5",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;Dec 27, 1997
"RTN","GMRCP5",3,0)
 ;
"RTN","GMRCP5",4,0)
TIUEN(GMRCIEN) ;Entry point for TIU to print 513
"RTN","GMRCP5",5,0)
 ;
"RTN","GMRCP5",6,0)
 N GMRCPLEN,GMRCTASK,GMRCX
"RTN","GMRCP5",7,0)
 ;
"RTN","GMRCP5",8,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5",9,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",10,0)
 ;
"RTN","GMRCP5",11,0)
 Q:'+GMRCIEN  D PRNT^GMRCP5A(GMRCIEN,1,0,"",0)
"RTN","GMRCP5",12,0)
 ;
"RTN","GMRCP5",13,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5",14,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",15,0)
 Q
"RTN","GMRCP5",16,0)
 ;
"RTN","GMRCP5",17,0)
GUI(ROOT,GMRCIFN) ;Entry point into routine for the GUI
"RTN","GMRCP5",18,0)
 ;
"RTN","GMRCP5",19,0)
 ; GMRCIFN = IFN of the record from file 123.
"RTN","GMRCP5",20,0)
 ;
"RTN","GMRCP5",21,0)
 N GMRCCPY,GMRCPLEN,GMRCX
"RTN","GMRCP5",22,0)
 ;
"RTN","GMRCP5",23,0)
 S GMRCPLEN=99998
"RTN","GMRCP5",24,0)
 S GMRCCPY="W"
"RTN","GMRCP5",25,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5",26,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",27,0)
 ;
"RTN","GMRCP5",28,0)
 D PRNT^GMRCP5A(GMRCIFN,0,0,GMRCCPY,GMRCPLEN)
"RTN","GMRCP5",29,0)
 ;
"RTN","GMRCP5",30,0)
 S ROOT=$NA(^TMP("GMRC",$J,"SF513"))
"RTN","GMRCP5",31,0)
 ;
"RTN","GMRCP5",32,0)
 K ^TMP("GMRC",$J,"OUTPUT")
"RTN","GMRCP5",33,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",34,0)
 Q
"RTN","GMRCP5",35,0)
 ;
"RTN","GMRCP5",36,0)
EN(GMRCIFN,GMRCCPY,GMRCDEV,GMRCSTAT) ;Entry point into routine -GMRCIFN=IFN from file 123
"RTN","GMRCP5",37,0)
 ;GMRCIFN = IFN of the record from file 123.
"RTN","GMRCP5",38,0)
 ;
"RTN","GMRCP5",39,0)
 N GMRCPLEN,GMRCTASK
"RTN","GMRCP5",40,0)
 ;
"RTN","GMRCP5",41,0)
 S GMRCSTAT=0
"RTN","GMRCP5",42,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5",43,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",44,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCP5",45,0)
 ;
"RTN","GMRCP5",46,0)
 I $D(GMRCDEV) D  Q
"RTN","GMRCP5",47,0)
 .S GMRCTASK=$$QUEUE(GMRCIFN,GMRCCPY,GMRCDEV)
"RTN","GMRCP5",48,0)
 .I GMRCTASK S GMRCSTAT="0^Queued as task # "_GMRCTASK
"RTN","GMRCP5",49,0)
 .E  S GMRCSTAT="-1^Not Queued"
"RTN","GMRCP5",50,0)
 ;
"RTN","GMRCP5",51,0)
 I '$D(GMRCCPY) S GMRCCPY=$$CCOPY Q:(GMRCCPY=U)
"RTN","GMRCP5",52,0)
 Q:'$$DEVICE
"RTN","GMRCP5",53,0)
 ;
"RTN","GMRCP5",54,0)
 I $D(IO("Q")) D  Q
"RTN","GMRCP5",55,0)
 .S GMRCTASK=$$QUEUE(GMRCIFN,GMRCCPY)
"RTN","GMRCP5",56,0)
 .I GMRCTASK S GMRCSTAT="0^Queued as task # "_GMRCTASK
"RTN","GMRCP5",57,0)
 .E  S GMRCSTAT="-1^Not Queued"
"RTN","GMRCP5",58,0)
 .W "  ",$P(GMRCSTAT,U,2) H 2
"RTN","GMRCP5",59,0)
 ;
"RTN","GMRCP5",60,0)
 D PRNT^GMRCP5A(GMRCIFN,0,0,GMRCCPY,0)
"RTN","GMRCP5",61,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5",62,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",63,0)
 ;
"RTN","GMRCP5",64,0)
 Q
"RTN","GMRCP5",65,0)
 ;
"RTN","GMRCP5",66,0)
SEL ;Select the consult/request to print
"RTN","GMRCP5",67,0)
 K GMRCQUT,DTOUT,DIRUOUT,GMRCSEL
"RTN","GMRCP5",68,0)
 I '$D(^TMP("GMRCR",$J,"CS","AD")) W $C(7),!,"No Orders To Print!",! S GMRCQUT=1 Q
"RTN","GMRCP5",69,0)
 I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR") I $S(GMRCSEL<1:1,GMRCSEL>BLK:1,1:0) K GMRCSEL D AGAIN^GMRCSLMV(GMRC("NMBR"))
"RTN","GMRCP5",70,0)
 I '$O(^TMP("GMRCR",$J,"CS","AD")),BLK=1 S GMRCSEL=BLK
"RTN","GMRCP5",71,0)
 I $S('$D(GMRCSEL):1,'$L(GMRCSEL):1,1:0) D SEL^GMRCA2 I $D(DTOUT)!($D(DIRUOUT)) S GMRCQUT=1 Q
"RTN","GMRCP5",72,0)
 I $S(GMRCSEL<1:1,GMRCSEL>BLK:1,GMRCSEL="":1,1:0) W $C(7),!,"Select A Number In The Range 1 To "_BLK G SEL
"RTN","GMRCP5",73,0)
 I GMRCSEL="" S GMRCQUT=1 Q
"RTN","GMRCP5",74,0)
 S GMRCND=$O(^TMP("GMRCR",$J,"CS","AD",GMRCSEL,GMRCSEL,0))
"RTN","GMRCP5",75,0)
 I $S('$L(GMRCND):1,1:0) S GMRCMSG="The Consult to print is not defined in the list to select from!" D EXAC^GMRCADC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCP5",76,0)
 Q
"RTN","GMRCP5",77,0)
 ;
"RTN","GMRCP5",78,0)
QUEUE(GMRCIFN,GMRCCPY,GMRCDEV) ;
"RTN","GMRCP5",79,0)
 ;
"RTN","GMRCP5",80,0)
 N ZTCPU,ZTDESC,ZTDTH,ZTIO,ZTPAR,ZTPRE,ZTPRI,ZTRTN
"RTN","GMRCP5",81,0)
 N ZTSAVE,ZTSK,ZTUCI
"RTN","GMRCP5",82,0)
 ;
"RTN","GMRCP5",83,0)
 S ZTDESC="CONSULT/REQUEST PACKAGE PRINT FORM 513"
"RTN","GMRCP5",84,0)
 ;
"RTN","GMRCP5",85,0)
 I $D(GMRCDEV) S ZTIO=GMRCDEV
"RTN","GMRCP5",86,0)
 E  S ZTIO=ION
"RTN","GMRCP5",87,0)
 ;
"RTN","GMRCP5",88,0)
 S ZTDTH=$H
"RTN","GMRCP5",89,0)
 S ZTRTN="PRNT^GMRCP5A("_(+GMRCIFN)_",0,1,"""_(GMRCCPY)_""",0)"
"RTN","GMRCP5",90,0)
 D ^%ZTLOAD
"RTN","GMRCP5",91,0)
 D:'$D(GMRCDEV) ^%ZISC
"RTN","GMRCP5",92,0)
 ;
"RTN","GMRCP5",93,0)
 Q $G(ZTSK)
"RTN","GMRCP5",94,0)
 ;
"RTN","GMRCP5",95,0)
CCOPY() ; Determine if this is a "Chart" copy or a "Working" copy
"RTN","GMRCP5",96,0)
 ;
"RTN","GMRCP5",97,0)
 N GMRCSTAT,GMRCX,GMRCDEF
"RTN","GMRCP5",98,0)
 ;
"RTN","GMRCP5",99,0)
 ;  GMRCDEF=1   CHART
"RTN","GMRCP5",100,0)
 ;  GMRCDEF=0   WORKING
"RTN","GMRCP5",101,0)
 ;
"RTN","GMRCP5",102,0)
 S GMRCSTAT=$G(^GMR(123,GMRCIFN,0)) Q:'$L(GMRCSTAT) ""
"RTN","GMRCP5",103,0)
 S GMRCSTAT=$P(GMRCSTAT,U,12)
"RTN","GMRCP5",104,0)
 S GMRCDEF=(GMRCSTAT=2)
"RTN","GMRCP5",105,0)
 ;
"RTN","GMRCP5",106,0)
 F  D  Q:$L(GMRCX)
"RTN","GMRCP5",107,0)
 .;
"RTN","GMRCP5",108,0)
 .W !,$$COPY(GMRCDEF)_" Copy (Y/N)? Y//"
"RTN","GMRCP5",109,0)
 .R GMRCX:DTIME E  S GMRCX=U
"RTN","GMRCP5",110,0)
 .Q:(GMRCX[U)
"RTN","GMRCP5",111,0)
 .;
"RTN","GMRCP5",112,0)
 .S:'$L(GMRCX) GMRCX="Y"
"RTN","GMRCP5",113,0)
 .S GMRCX=$E(GMRCX,1)
"RTN","GMRCP5",114,0)
 .S GMRCX=$TR(GMRCX,"ynwc","YNWC")
"RTN","GMRCP5",115,0)
 .;
"RTN","GMRCP5",116,0)
 .I '("YNWC"[GMRCX) S GMRCX="?"
"RTN","GMRCP5",117,0)
 .;
"RTN","GMRCP5",118,0)
 .I GMRCX["?" D  S GMRCX="" Q
"RTN","GMRCP5",119,0)
 ..W !
"RTN","GMRCP5",120,0)
 ..W !,"    Type 'Y' To Print A '"_$$COPY(GMRCDEF)_"' Copy Of The Form 513,"
"RTN","GMRCP5",121,0)
 ..W !," or Type 'N' To Print A '"_$$COPY('GMRCDEF)_"' Copy Of The Form 513,"
"RTN","GMRCP5",122,0)
 ..W !," or Type 'C' To Print A 'Chart' Copy Of The Form 513,"
"RTN","GMRCP5",123,0)
 ..W !," or Type 'W' To Print A 'Working' Copy Of The Form 513."
"RTN","GMRCP5",124,0)
 ..W !
"RTN","GMRCP5",125,0)
 ;
"RTN","GMRCP5",126,0)
 I (GMRCX="Y") Q $E($$COPY(GMRCDEF),1)
"RTN","GMRCP5",127,0)
 I (GMRCX="N") Q $E($$COPY('GMRCDEF),1)
"RTN","GMRCP5",128,0)
 Q GMRCX
"RTN","GMRCP5",129,0)
 ;
"RTN","GMRCP5",130,0)
COPY(X) Q:X "Chart" Q "Working"
"RTN","GMRCP5",131,0)
 ;
"RTN","GMRCP5",132,0)
DEVICE() ;Ask output device / set up output device print parameters
"RTN","GMRCP5",133,0)
 N POP,%ZIS,%IS
"RTN","GMRCP5",134,0)
 S POP=0,%ZIS="MQ" D ^%ZIS
"RTN","GMRCP5",135,0)
 Q $S(POP:0,IO="":0,1:1)
"RTN","GMRCP5",136,0)
 ;
"RTN","GMRCP5",137,0)
 ;
"RTN","GMRCP5",138,0)
SETUP ;
"RTN","GMRCP5",139,0)
 ;
"RTN","GMRCP5",140,0)
 N LINE,%ZIS,%IS,POP,IOP
"RTN","GMRCP5",141,0)
 ;
"RTN","GMRCP5",142,0)
 W !!,"Print consults printer setup page.",!
"RTN","GMRCP5",143,0)
 K IOP S %ZIS="MQ" D ^%ZIS Q:POP
"RTN","GMRCP5",144,0)
 ;
"RTN","GMRCP5",145,0)
 I $D(IO("Q")) D  Q
"RTN","GMRCP5",146,0)
 .;
"RTN","GMRCP5",147,0)
 .N ZTCPU,ZTDESC,ZTDTH,ZTIO,ZTPAR,ZTPRE,ZTPRI,ZTRTN
"RTN","GMRCP5",148,0)
 .N ZTSAVE,ZTSK,ZTUCI
"RTN","GMRCP5",149,0)
 .;
"RTN","GMRCP5",150,0)
 .S ZTDESC="CONSULT/REQUEST PACKAGE PRINTER TEST PAGE"
"RTN","GMRCP5",151,0)
 .S ZTIO=ION,ZTDTH=$H,ZTRTN="SETPRNT^GMRCP5"
"RTN","GMRCP5",152,0)
 .;
"RTN","GMRCP5",153,0)
 .D ^%ZTLOAD,^%ZISC
"RTN","GMRCP5",154,0)
 .;
"RTN","GMRCP5",155,0)
 .I ZTSK W !!,"Queued as task #",ZTSK
"RTN","GMRCP5",156,0)
 .E  W !!,"  not queued."
"RTN","GMRCP5",157,0)
 ;
"RTN","GMRCP5",158,0)
SETPRNT ;
"RTN","GMRCP5",159,0)
 N LINE
"RTN","GMRCP5",160,0)
 U IO D
"RTN","GMRCP5",161,0)
 .W @IOF,1
"RTN","GMRCP5",162,0)
 .W !,2
"RTN","GMRCP5",163,0)
 .W !,3,"           *******CONSULTS PRINT SETUP PAGE*******"
"RTN","GMRCP5",164,0)
 .W !,4
"RTN","GMRCP5",165,0)
 .W !,5,"     Print Device: ",$G(ION)
"RTN","GMRCP5",166,0)
 .W !,6,"    Terminal Type: ",$G(IOST)
"RTN","GMRCP5",167,0)
 .W !,7," Defined lines per page for this device: ",+$G(IOSL)
"RTN","GMRCP5",168,0)
 .W !,8,"   Defined margin width for this device: ",+$G(IOM)
"RTN","GMRCP5",169,0)
 .W !,9
"RTN","GMRCP5",170,0)
 .W !,10,"   There should be numbers listed down the lefthand side of"
"RTN","GMRCP5",171,0)
 .W !,11," this page all the way to the bottom. The number at the"
"RTN","GMRCP5",172,0)
 .W !,12," bottom of the page is the number of lines the PRINTER"
"RTN","GMRCP5",173,0)
 .W !,13," thinks there are on a page. The COMPUTER thinks there are ",+$G(IOSL)
"RTN","GMRCP5",174,0)
 .W !,14," lines on a page. The number at the bottom of the page needs to"
"RTN","GMRCP5",175,0)
 .W !,15," be EQUAL to ",+$G(IOSL)," so the consults program can print"
"RTN","GMRCP5",176,0)
 .W !,16," without running off the end of the page. If the number at the"
"RTN","GMRCP5",177,0)
 .W !,17," bottom of the page is NOT EQUAL to ",+$G(IOSL)," then have"
"RTN","GMRCP5",178,0)
 .W !,18," someone in IRM adjust the"
"RTN","GMRCP5",179,0)
 .W !,19
"RTN","GMRCP5",180,0)
 .W !,20," DEVICE file (file 3.5) *PAGE LENGTH field (#11)"
"RTN","GMRCP5",181,0)
 .W !,21,"           for device: ",$G(ION)
"RTN","GMRCP5",182,0)
 .W !,22
"RTN","GMRCP5",183,0)
 .W !,23," and the TERMINAL TYPE file (file 3.2) PAGE LENGTH field (#3)"
"RTN","GMRCP5",184,0)
 .W !,24,"    for terminal type: ",$G(IOST)
"RTN","GMRCP5",185,0)
 .W !,25
"RTN","GMRCP5",186,0)
 .W !,26," to be a value EQUAL to the number at the bottom of the page."
"RTN","GMRCP5",187,0)
 .F LINE=27:1:100 W !,LINE
"RTN","GMRCP5",188,0)
 U IO(0) D ^%ZISC
"RTN","GMRCP5",189,0)
 ;
"RTN","GMRCP5",190,0)
 I $G(ZTSK) D KILL^%ZTLOAD
"RTN","GMRCP5",191,0)
 ;
"RTN","GMRCP5",192,0)
 Q
"RTN","GMRCP5",193,0)
 ;
"RTN","GMRCP513")
0^7^B42632
"RTN","GMRCP513",1,0)
GMRCP513 ;SLC/DCM - Print Consult form 513 ;4/30/98  09:36
"RTN","GMRCP513",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCP513",3,0)
TIUEN(GMRCIEN) ;Call TIUEN^GMRCP5 with the proper parameters so that the Consult
"RTN","GMRCP513",4,0)
 ;Form 513 can be printed by TIU
"RTN","GMRCP513",5,0)
 D TIUEN^GMRCP5(GMRCIEN)
"RTN","GMRCP513",6,0)
 Q
"RTN","GMRCP5A")
0^2^B49354696
"RTN","GMRCP5A",1,0)
GMRCP5A ;SLC/DCM,RJS - Print Consult form 513 (Gather Data - TIU Results) ;7/15/98  13:00
"RTN","GMRCP5A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;Dec 27, 1997
"RTN","GMRCP5A",3,0)
 ;
"RTN","GMRCP5A",4,0)
PRNT(GMRCIFN,TIUFLG,GMRCQUED,GMRCCPY,GMRCGUI) ;
"RTN","GMRCP5A",5,0)
 ;
"RTN","GMRCP5A",6,0)
 ; Input Arguments:
"RTN","GMRCP5A",7,0)
 ;
"RTN","GMRCP5A",8,0)
 ;  GMRCIFN: IEN of the Consult/Request in file 123
"RTN","GMRCP5A",9,0)
 ;   TIUFLG: Called from TIU ?  1=yes 0=no
"RTN","GMRCP5A",10,0)
 ; GMRCQUED: Queued job ?  1=yes 0=no
"RTN","GMRCP5A",11,0)
 ;  GMRCCPY: Chart Copy ? C=Chart Copy  W=Working Copy  null=Not Applicable
"RTN","GMRCP5A",12,0)
 ;  GMRCGUI: Called from the GUI. (Only produce output in a formatted global.)
"RTN","GMRCP5A",13,0)
 ;
"RTN","GMRCP5A",14,0)
 N GMRCSIG,GMRCSDT,GMRCCSIG,GMRCSIGT,GMRCADDS
"RTN","GMRCP5A",15,0)
 ;
"RTN","GMRCP5A",16,0)
 I GMRCGUI D FORMAT(80),ASSMBL^GMRCP5C(GMRCGUI,80) Q
"RTN","GMRCP5A",17,0)
 ;
"RTN","GMRCP5A",18,0)
 I 'TIUFLG,'GMRCQUED W @IOF I '$$CRT^GMRCP5C,$L($G(IO(0))),'(IO=IO(0)) U IO(0) W !,"PRINTING... "
"RTN","GMRCP5A",19,0)
 ;
"RTN","GMRCP5A",20,0)
 U IO D FORMAT(IOM),ASSMBL^GMRCP5C(IOSL,IOM),PRINT^GMRCP5C(IOSL,IOM)
"RTN","GMRCP5A",21,0)
 ;
"RTN","GMRCP5A",22,0)
 I 'TIUFLG,'$$CRT^GMRCP5C U IO(0) D ^%ZISC
"RTN","GMRCP5A",23,0)
 ;
"RTN","GMRCP5A",24,0)
 I $G(GMRCQUED),$G(ZTSK) D KILL^%ZTLOAD
"RTN","GMRCP5A",25,0)
 ;
"RTN","GMRCP5A",26,0)
 Q
"RTN","GMRCP5A",27,0)
 ;
"RTN","GMRCP5A",28,0)
FORMAT(PAGEWID) ;
"RTN","GMRCP5A",29,0)
 ;
"RTN","GMRCP5A",30,0)
 N %I,CMT,COUNT,D0,DFN,DIC,DIQ2,DR,GLOBAL,GMRC400,GMRCADD,GMRCADDT,GMRCAGE,GMRCCSDT
"RTN","GMRCP5A",31,0)
 N GMRCCTIT,GMRCDFN,GMRCDOB,GMRCDVL,GMRCELIG,GMRCEQL,GMRCERR,GMRCFAC,GMRCFP
"RTN","GMRCP5A",32,0)
 N GMRCFTR,GMRCLAST,GMRCMODE,GMRCND,GMRCNDX,GMRCNT,GMRCPG,GMRCPGR,GMRCPNM,GMRCPRNM
"RTN","GMRCP5A",33,0)
 N GMRCPTR,GMRCQSTR,GMRCQSTT,GMRCR0,GMRCR1,GMRCR2,GMRCRB,GMRCRD,GMRCRPT,GMRCSG,GMRCSGAD,GMRCSIGM
"RTN","GMRCP5A",34,0)
 N GMRCSN,GMRCSR,GMRCSVC,GMRCTO,GMRCUL,GMRCWARD,GMRCWLI,GMRCX,LN,MCFILE,MCPROC
"RTN","GMRCP5A",35,0)
 N ND,ND1,ND2,NDS,ORACTION,SEX,TAB,X,Y
"RTN","GMRCP5A",36,0)
 ;
"RTN","GMRCP5A",37,0)
 S GMRCFTR=13,GMRCFP=0,GMRCPG=0
"RTN","GMRCP5A",38,0)
 S GMRCRD=$G(^GMR(123,GMRCIFN,0)),(DFN,GMRCDFN)=$P(GMRCRD,U,2)
"RTN","GMRCP5A",39,0)
 Q:'(DFN)
"RTN","GMRCP5A",40,0)
 D ELIG^VADPT S GMRCELIG=$P(VAEL(6),U,2) K VAEL
"RTN","GMRCP5A",41,0)
 S GMRCDVL="",$P(GMRCDVL,"-",PAGEWID+1)=""
"RTN","GMRCP5A",42,0)
 S GMRCEQL="",$P(GMRCEQL,"=",PAGEWID+1)=""
"RTN","GMRCP5A",43,0)
 S GMRCUL="",$P(GMRCUL,"_",40)=""
"RTN","GMRCP5A",44,0)
 S DFN=GMRCDFN D DEM^GMRCU
"RTN","GMRCP5A",45,0)
 ;
"RTN","GMRCP5A",46,0)
 S GMRCFAC=+$P(GMRCRD,U,21)
"RTN","GMRCP5A",47,0)
 I 'GMRCFAC S GMRCFAC=+$G(DUZ(2))
"RTN","GMRCP5A",48,0)
 I 'GMRCFAC S GMRCFAC=+$$SITE^VASITE()
"RTN","GMRCP5A",49,0)
 I +GMRCFAC S GMRCFAC=$$GET1^DIQ(4,+GMRCFAC,.01)
"RTN","GMRCP5A",50,0)
 E  S GMRCFAC="" Q
"RTN","GMRCP5A",51,0)
 ;
"RTN","GMRCP5A",52,0)
 I +$P(GMRCRD,U,20),(TIUFLG)!($P(GMRCRD,U,12)=2) D PRINT^GMRCTIUP(GMRCIFN,0,0)
"RTN","GMRCP5A",53,0)
 ;
"RTN","GMRCP5A",54,0)
 K GMRCSG I $D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",55,0)
 .;
"RTN","GMRCP5A",56,0)
 .S GMRCR0=0 F  Q:$D(GMRCSG)  S GMRCR0=$O(^TMP("GMRCR",$J,"RES",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5A",57,0)
 ..F GMRCV="GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT" S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCV))
"RTN","GMRCP5A",58,0)
 ..Q:'$L($G(GMRCSIG))
"RTN","GMRCP5A",59,0)
 ..F GMRCV="GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT" S GMRCSG(GMRCV)=@GMRCV
"RTN","GMRCP5A",60,0)
 ;
"RTN","GMRCP5A",61,0)
 D INIT^GMRCP5B(.GMRCSG) ; Build Header, Footer, Request, and Primary Diagnosis Segments
"RTN","GMRCP5A",62,0)
 ;
"RTN","GMRCP5A",63,0)
 I $L($G(GMRCCPY)) D
"RTN","GMRCP5A",64,0)
 .D BLD("RES",1,1,0,$$CENTER($S(GMRCCPY="C":"C H A R T   C O P Y",1:"W O R K I N G   C O P Y")))
"RTN","GMRCP5A",65,0)
 I ($P(GMRCRD,U,19)="Y") D
"RTN","GMRCP5A",66,0)
 .D BLD("RES",1,1,0,$$CENTER("******* Significant Findings *******"))
"RTN","GMRCP5A",67,0)
 I ($P(GMRCRD,U,19)="N") D
"RTN","GMRCP5A",68,0)
 .D BLD("RES",1,1,0,$$CENTER("******* No Significant Findings *******"))
"RTN","GMRCP5A",69,0)
 I ($P(GMRCRD,U,19)="U") D
"RTN","GMRCP5A",70,0)
 .D BLD("RES",1,1,0,$$CENTER("******* Unknown Significant Findings *******"))
"RTN","GMRCP5A",71,0)
 ;
"RTN","GMRCP5A",72,0)
 I $P(GMRCRD,U,12)=1  D BLD("RES",1,2,0,$$CENTER("**** REQUEST CANCELLED    REQUEST CANCELLED ****"))
"RTN","GMRCP5A",73,0)
 I '$D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",74,0)
 .I $L($G(GMRCRPT)) D BLD("RES",1,2,0,$$CENTER(" No Consultation Results for "_GMRCRPT_" available."))
"RTN","GMRCP5A",75,0)
 .I '$L($G(GMRCRPT)) D BLD("RES",1,2,0,$$CENTER(" No Consultation Results available."))
"RTN","GMRCP5A",76,0)
 ;
"RTN","GMRCP5A",77,0)
 I $D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",78,0)
 .;
"RTN","GMRCP5A",79,0)
 .S (GMRCNT,GMRCR0)=0 F  S GMRCR0=$O(^TMP("GMRCR",$J,"RES",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5A",80,0)
 ..N GMRCCSDT,GMRCCSGM,GMRCCSIG,GMRCCTIT,GMRCRPT,GMRCSDT,GMRCSIG,GMRCSIGM,GMRCSIGT,GMRCV
"RTN","GMRCP5A",81,0)
 ..;
"RTN","GMRCP5A",82,0)
 ..F GMRCV="GMRCCSDT","GMRCCSGM","GMRCCSIG","GMRCCTIT","GMRCRPT","GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT" D
"RTN","GMRCP5A",83,0)
 ...S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCV))
"RTN","GMRCP5A",84,0)
 ..;
"RTN","GMRCP5A",85,0)
 ..S GMRCNDX=$O(^TMP("GMRC",$J,"OUTPUT","RES"," "),-1)+1
"RTN","GMRCP5A",86,0)
 ..I $L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Consultation Results #"_GMRCR0_" for "_GMRCRPT_" continued.")
"RTN","GMRCP5A",87,0)
 ..I '$L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Consultation Results #"_GMRCR0_" continued.")
"RTN","GMRCP5A",88,0)
 ..D SUB("H","RES",GMRCNDX," ")
"RTN","GMRCP5A",89,0)
 ..I $L($G(GMRCSIG)) D
"RTN","GMRCP5A",90,0)
 ...D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",91,0)
 ...I (GMRCSIGM="electronic") S GMRCX=" Results Signature: "_GMRCSIG_" /es/ "_$$EXDT($G(GMRCSDT))
"RTN","GMRCP5A",92,0)
 ...I '(GMRCSIGM="electronic") S GMRCX=" Results Signature: "_GMRCSIG_" /chart/ " S:$L($G(GMRCSDT)) GMRCX=GMRCX_$$EXDT(GMRCSDT)
"RTN","GMRCP5A",93,0)
 ...D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5A",94,0)
 ...D:$L($G(GMRCSIGT)) SUB("F","RES",GMRCNDX,"                    "_GMRCSIGT)
"RTN","GMRCP5A",95,0)
 ..I $L($G(GMRCCSIG)) D
"RTN","GMRCP5A",96,0)
 ...D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",97,0)
 ...I (GMRCCSGM="electronic") S GMRCX=" Results CoSignature: "_GMRCCSIG_" /es/ "_$$EXDT($G(GMRCCSDT))
"RTN","GMRCP5A",98,0)
 ...I '(GMRCCSGM="electronic") S GMRCX=" Results CoSignature: "_GMRCCSIG_" /chart/ " S:$L($G(GMRCCSDT)) GMRCX=GMRCX_$$EXDT(GMRCCSDT)
"RTN","GMRCP5A",99,0)
 ...D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5A",100,0)
 ...D:$L($G(GMRCCTIT)) SUB("F","RES",GMRCNDX,"                      "_GMRCCTIT)
"RTN","GMRCP5A",101,0)
 ..;extra signers
"RTN","GMRCP5A",102,0)
 .. I $D(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA")) D
"RTN","GMRCP5A",103,0)
 ... D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",104,0)
 ... D SUB("F","RES",GMRCNDX," Concurrent Signatures: ")
"RTN","GMRCP5A",105,0)
 ... N XTRA S XTRA=0 F  S XTRA=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA)) Q:'XTRA  D
"RTN","GMRCP5A",106,0)
 .... D SUB("F","RES",GMRCNDX,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA,0))
"RTN","GMRCP5A",107,0)
 .... D SUB("F","RES",GMRCNDX,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA,1))
"RTN","GMRCP5A",108,0)
 ..;
"RTN","GMRCP5A",109,0)
 ..I GMRCNT D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",110,0)
 ..I $L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("CONSULTATION NOTE #"_GMRCR0_" FOR "_GMRCRPT))
"RTN","GMRCP5A",111,0)
 ..I '$L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("CONSULTATION NOTE #"_GMRCR0))
"RTN","GMRCP5A",112,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",113,0)
 ..I $D(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",0,0)) D  I 1
"RTN","GMRCP5A",114,0)
 ...D BLD("RES",GMRCNDX,1,0,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",0,0))
"RTN","GMRCP5A",115,0)
 ..E  I '$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","")) D
"RTN","GMRCP5A",116,0)
 ...D BLD("RES",1,1,0,$$CENTER("CONSULTATION NOTE TEXT NOT AVAILABLE"))
"RTN","GMRCP5A",117,0)
 ..S GMRCR1=0 F  S GMRCR1=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCR1)) Q:'GMRCR1  D
"RTN","GMRCP5A",118,0)
 ...D BLD("RES",GMRCNDX,1,0,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCR1,0))
"RTN","GMRCP5A",119,0)
 ..;
"RTN","GMRCP5A",120,0)
 ..;  GET ADDENDUMS TO THIS NOTE
"RTN","GMRCP5A",121,0)
 ..;
"RTN","GMRCP5A",122,0)
 ..I +$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",0)) D ADDEND^GMRCP5D(GMRCIFN,GMRCR0,GMRCNDX,GMRCRD,PAGEWID)
"RTN","GMRCP5A",123,0)
 ;
"RTN","GMRCP5A",124,0)
 D FORMAT^GMRCP5D(GMRCIFN,GMRCRD,PAGEWID) ;  GET SERVICE REPORTS AND COMMENTS
"RTN","GMRCP5A",125,0)
 ;
"RTN","GMRCP5A",126,0)
 Q
"RTN","GMRCP5A",127,0)
 ;
"RTN","GMRCP5A",128,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5A",129,0)
 ;
"RTN","GMRCP5A",130,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5A",131,0)
 Q:'$L(X) ""
"RTN","GMRCP5A",132,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5A",133,0)
 I (X[".") S DATE=$P(X,".",1),TIME=1
"RTN","GMRCP5A",134,0)
 E  S DATE=X,TIME=0
"RTN","GMRCP5A",135,0)
 S Y=$E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_($E(DATE,1,3)+1700)
"RTN","GMRCP5A",136,0)
 I TIME D
"RTN","GMRCP5A",137,0)
 .S TIME=X#1*10000+10000\1
"RTN","GMRCP5A",138,0)
 .S HR=$E(TIME,2,3)
"RTN","GMRCP5A",139,0)
 .S MN=$E(TIME,4,5)
"RTN","GMRCP5A",140,0)
 .S PD="am" S:(HR=12) PD="pm" S:(HR>12) HR=HR-12,PD="pm" S:(HR=0) HR=12
"RTN","GMRCP5A",141,0)
 .S Y=Y_" "_HR_":"_MN_PD
"RTN","GMRCP5A",142,0)
 Q Y
"RTN","GMRCP5A",143,0)
 ;
"RTN","GMRCP5A",144,0)
CENTER(X) ;
"RTN","GMRCP5A",145,0)
 ;
"RTN","GMRCP5A",146,0)
 N TEXT,COL
"RTN","GMRCP5A",147,0)
 S COL=35-($L(X)\2) Q:(COL<1) X
"RTN","GMRCP5A",148,0)
 S $E(TEXT,COL)=X
"RTN","GMRCP5A",149,0)
 Q TEXT
"RTN","GMRCP5A",150,0)
 ;
"RTN","GMRCP5A",151,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5A",152,0)
 ;
"RTN","GMRCP5A",153,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5A",154,0)
 N LINECNT
"RTN","GMRCP5A",155,0)
 ;
"RTN","GMRCP5A",156,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5A",157,0)
 ;
"RTN","GMRCP5A",158,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5A",159,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5A",160,0)
 ;
"RTN","GMRCP5A",161,0)
 S GMRCLAST=SUB
"RTN","GMRCP5A",162,0)
 Q
"RTN","GMRCP5A",163,0)
 ;
"RTN","GMRCP5A",164,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5A",165,0)
 ;
"RTN","GMRCP5A",166,0)
 N NEXT
"RTN","GMRCP5A",167,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5A",168,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5A",169,0)
 Q
"RTN","GMRCP5A",170,0)
 ;
"RTN","GMRCP5A",171,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5A",172,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5A",173,0)
 ;
"RTN","GMRCP5B")
0^3^B31916321
"RTN","GMRCP5B",1,0)
GMRCP5B ;SLC/DCM,RJS - Print Consult form 513 (Gather Data - Footers, Provisional Diagnosis and Reason For Request) ;6/24/98  13:06
"RTN","GMRCP5B",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;Dec 27, 1997
"RTN","GMRCP5B",3,0)
 ;
"RTN","GMRCP5B",4,0)
 Q
"RTN","GMRCP5B",5,0)
 ;
"RTN","GMRCP5B",6,0)
INIT(GMRCSG) ; Initialize the form
"RTN","GMRCP5B",7,0)
 ;
"RTN","GMRCP5B",8,0)
 D HDR^GMRCP5D,FTR(.GMRCSG),REQUEST,PDIAG Q
"RTN","GMRCP5B",9,0)
 ;
"RTN","GMRCP5B",10,0)
REQUEST ;
"RTN","GMRCP5B",11,0)
 N GMRCX
"RTN","GMRCP5B",12,0)
 ;
"RTN","GMRCP5B",13,0)
 I $L($T(OUTPTPR^SDUTL3)) D
"RTN","GMRCP5B",14,0)
 .S GMRCX=$P($$OUTPTPR^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",15,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"Primary Care Provider: "_GMRCX)
"RTN","GMRCP5B",16,0)
 ;
"RTN","GMRCP5B",17,0)
 I $L($T(OUTPTTM^SDUTL3)) D
"RTN","GMRCP5B",18,0)
 .S GMRCX=$P($$OUTPTTM^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",19,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"            Care Team: "_GMRCX)
"RTN","GMRCP5B",20,0)
 ;
"RTN","GMRCP5B",21,0)
 I $O(^TMP("GMRC",$J,"OUTPUT","REQ",0)) D BLD("REQ",1,1,0,"")
"RTN","GMRCP5B",22,0)
 ;
"RTN","GMRCP5B",23,0)
 D SUB("H","REQ",1,"Reason For Request continued.")
"RTN","GMRCP5B",24,0)
 D SUB("H","REQ",1," ")
"RTN","GMRCP5B",25,0)
 ;
"RTN","GMRCP5B",26,0)
 D BLD("REQ",1,1,0,"REASON FOR REQUEST: (Complaints and findings)")
"RTN","GMRCP5B",27,0)
 I '$O(^GMR(123,GMRCIFN,20,0)) D BLD("REQ",1,1,0,"") I 1
"RTN","GMRCP5B",28,0)
 E  D
"RTN","GMRCP5B",29,0)
 .N LN S LN=0 F  S LN=$O(^GMR(123,GMRCIFN,20,LN)) Q:LN=""  D
"RTN","GMRCP5B",30,0)
 ..D BLD("REQ",1,1,0,^GMR(123,GMRCIFN,20,LN,0))
"RTN","GMRCP5B",31,0)
 ;
"RTN","GMRCP5B",32,0)
 Q
"RTN","GMRCP5B",33,0)
PDIAG ;
"RTN","GMRCP5B",34,0)
 ;
"RTN","GMRCP5B",35,0)
 D BLD("PDIAG",1,1,0,"PROVISIONAL DIAG: "_$G(^GMR(123,GMRCIFN,30)))
"RTN","GMRCP5B",36,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",37,0)
 ;
"RTN","GMRCP5B",38,0)
 S GMRCQSTR=$P(GMRCRD,U,14)
"RTN","GMRCP5B",39,0)
 S:'GMRCQSTR GMRCQSTR=$$GET1^DIQ(100,+$P(GMRCRD,U,3),1)
"RTN","GMRCP5B",40,0)
 S GMRCX=$G(^VA(200,+GMRCQSTR,.13))
"RTN","GMRCP5B",41,0)
 S GMRCPGR=$P(GMRCX,U,7) S:'$L(GMRCPGR) GMRCPGR=$P(GMRCX,U,8)
"RTN","GMRCP5B",42,0)
 S:$L(GMRCPGR) GMRCPGR="(Pager: "_GMRCPGR_")"
"RTN","GMRCP5B",43,0)
 I '$L(GMRCPGR) S GMRCPGR=$P(GMRCX,U,2) S:$L(GMRCPGR) GMRCPGR="(Phone: "_GMRCPGR_")"
"RTN","GMRCP5B",44,0)
 ;
"RTN","GMRCP5B",45,0)
 S GMRCQSTT=$P($G(^VA(200,+GMRCQSTR,20)),U,3)
"RTN","GMRCP5B",46,0)
 S:'$L(GMRCQSTT) GMRCQSTT=$$GET1^DIQ(200,GMRCQSTR,8)
"RTN","GMRCP5B",47,0)
 S GMRCQSTR=$P($G(^VA(200,+GMRCQSTR,0)),U,1)
"RTN","GMRCP5B",48,0)
 ;
"RTN","GMRCP5B",49,0)
 D BLD("PDIAG",1,1,0,"REQUESTED BY: "_GMRCPGR)
"RTN","GMRCP5B",50,0)
 D BLD("PDIAG",1,0,35,"|PLACE:")
"RTN","GMRCP5B",51,0)
 D BLD("PDIAG",1,0,59,"|URGENCY:")
"RTN","GMRCP5B",52,0)
 ;
"RTN","GMRCP5B",53,0)
 D BLD("PDIAG",1,1,0,$E(GMRCQSTR,1,37))
"RTN","GMRCP5B",54,0)
 D BLD("PDIAG",1,0,35,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,10),0)),U,2),1,20))
"RTN","GMRCP5B",55,0)
 D BLD("PDIAG",1,0,59,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,9),0)),U,2),1,18))
"RTN","GMRCP5B",56,0)
 ;
"RTN","GMRCP5B",57,0)
 I $L(GMRCQSTT) D
"RTN","GMRCP5B",58,0)
 .D BLD("PDIAG",1,1,0,GMRCQSTT)
"RTN","GMRCP5B",59,0)
 .D BLD("PDIAG",1,0,35,"|")
"RTN","GMRCP5B",60,0)
 .D BLD("PDIAG",1,0,59,"|")
"RTN","GMRCP5B",61,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",62,0)
 ;
"RTN","GMRCP5B",63,0)
 Q
"RTN","GMRCP5B",64,0)
 ;
"RTN","GMRCP5B",65,0)
FTR(GMRCSG) ;Footer of form 513
"RTN","GMRCP5B",66,0)
 ;
"RTN","GMRCP5B",67,0)
 N GMRCRMBD,GMRCFAC1,GMRCLOC,GMRCX,SUB,GMRCX,VAIN,VAPA,VAERR
"RTN","GMRCP5B",68,0)
 ;
"RTN","GMRCP5B",69,0)
 D ADD^VADPT,INP^VADPT
"RTN","GMRCP5B",70,0)
 ;
"RTN","GMRCP5B",71,0)
 S (GMRCLOC,GMRCRMBD)=""
"RTN","GMRCP5B",72,0)
 S GMRCLOC=$P($G(VAIN(4)),U,2)
"RTN","GMRCP5B",73,0)
 S GMRCRMBD=$G(VAIN(5))
"RTN","GMRCP5B",74,0)
 S:'$L(GMRCLOC) GMRCLOC=$P($G(^SC(+$P($G(^GMR(123,+GMRCIFN,0)),U,4),0)),U,1)
"RTN","GMRCP5B",75,0)
 S:'$L(GMRCLOC) GMRCLOC=GMRCUL
"RTN","GMRCP5B",76,0)
 ;
"RTN","GMRCP5B",77,0)
 D BLD("FTR",0,1,0,GMRCEQL)
"RTN","GMRCP5B",78,0)
 D BLD("FTR",1,1,0,GMRCEQL)
"RTN","GMRCP5B",79,0)
 ;
"RTN","GMRCP5B",80,0)
 I ($G(GMRCSG("GMRCSIGM"))="electronic") D  I 1
"RTN","GMRCP5B",81,0)
 .D BLD("FTR",0,1,0,"SIGNATURE & TITLE: ")
"RTN","GMRCP5B",82,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG"))_" /es/")
"RTN","GMRCP5B",83,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",84,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",85,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",86,0)
 E  D
"RTN","GMRCP5B",87,0)
 .D BLD("FTR",0,1,0,"AUTHOR & TITLE: ")
"RTN","GMRCP5B",88,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG")))
"RTN","GMRCP5B",89,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",90,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",91,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",92,0)
 ;
"RTN","GMRCP5B",93,0)
 S GMRCFAC1=+$G(DUZ(2))
"RTN","GMRCP5B",94,0)
 S:'GMRCFAC1 GMRCFAC1=+$$SITE^VASITE()
"RTN","GMRCP5B",95,0)
 S GMRCFAC1=$$GET1^DIQ(4,+GMRCFAC1,.01)
"RTN","GMRCP5B",96,0)
 ;
"RTN","GMRCP5B",97,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",98,0)
 D BLD("FTR",0,1,0,"ID #:"_$E(GMRCUL,1,8))
"RTN","GMRCP5B",99,0)
 D BLD("FTR",0,0,12,"|ORGANIZATION:"_$J($E(GMRCFAC1,1,17),17))
"RTN","GMRCP5B",100,0)
 D BLD("FTR",0,0,45,"|REG #:"_$E(GMRCUL,1,4))
"RTN","GMRCP5B",101,0)
 D BLD("FTR",0,0,58,"|LOC: "_$E($G(GMRCLOC),1,11))
"RTN","GMRCP5B",102,0)
 ;
"RTN","GMRCP5B",103,0)
 I $L(GMRCRMBD) D  I 1
"RTN","GMRCP5B",104,0)
 .D BLD("FTR",0,1,12,"|")
"RTN","GMRCP5B",105,0)
 .D BLD("FTR",0,0,45,"|")
"RTN","GMRCP5B",106,0)
 .D BLD("FTR",0,0,58,"|RM/BD: "_GMRCRMBD)
"RTN","GMRCP5B",107,0)
 ;
"RTN","GMRCP5B",108,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",109,0)
 ;
"RTN","GMRCP5B",110,0)
 F SUB=0,1 D
"RTN","GMRCP5B",111,0)
 .D BLD("FTR",SUB,1,0,$P($G(^DPT(GMRCDFN,0)),U,1)_"  "_GMRCELIG)
"RTN","GMRCP5B",112,0)
 .I 'SUB D BLD("FTR",SUB,0,45,"CONSULTATION SHEET")
"RTN","GMRCP5B",113,0)
 .I SUB D BLD("FTR",SUB,0,45,"CONSULTATION SHEET  (Continued)")
"RTN","GMRCP5B",114,0)
 .D BLD("FTR",SUB,1,0,GMRCSN)
"RTN","GMRCP5B",115,0)
 .D BLD("FTR",SUB,0,20,$$EXDT(GMRCDOB))
"RTN","GMRCP5B",116,0)
 .D BLD("FTR",SUB,0,45,"Standard Form 513 (Rev 9-77)")
"RTN","GMRCP5B",117,0)
 ;
"RTN","GMRCP5B",118,0)
 ;                                  ADDRESS LINES 1-3
"RTN","GMRCP5B",119,0)
 F GMRCX=1,2,3 D:$L(VAPA(GMRCX)) BLD("FTR",0,1,0,VAPA(GMRCX))
"RTN","GMRCP5B",120,0)
 ;
"RTN","GMRCP5B",121,0)
 ;         CITY              STATE                ZIP CODE
"RTN","GMRCP5B",122,0)
 S GMRCX=VAPA(4)_"   "_$P(VAPA(5),U,2)_"      "_VAPA(6)
"RTN","GMRCP5B",123,0)
 ;
"RTN","GMRCP5B",124,0)
 I $L(VAPA(8)) S GMRCX=GMRCX_"      Phone: "_VAPA(8)   ; TELEPHONE (IF AVAILABLE)
"RTN","GMRCP5B",125,0)
 ;
"RTN","GMRCP5B",126,0)
 D BLD("FTR",0,1,0,GMRCX)
"RTN","GMRCP5B",127,0)
 ;
"RTN","GMRCP5B",128,0)
 Q
"RTN","GMRCP5B",129,0)
 ;
"RTN","GMRCP5B",130,0)
CONSRQ(GMRCRQ) ;
"RTN","GMRCP5B",131,0)
 ;
"RTN","GMRCP5B",132,0)
 N ORND,ORFL,REF
"RTN","GMRCP5B",133,0)
 I '$L(GMRCRQ) Q "Consult"
"RTN","GMRCP5B",134,0)
 S ORND=$P(GMRCRQ,";",1),ORFL=$P(GMRCRQ,";",2),REF=U_ORFL_ORND_",0)"
"RTN","GMRCP5B",135,0)
 S GMRCRQ=$P($G(@(REF)),U,2)
"RTN","GMRCP5B",136,0)
 Q:$L(GMRCRQ) GMRCRQ Q "Consult"
"RTN","GMRCP5B",137,0)
 ;
"RTN","GMRCP5B",138,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5B",139,0)
 ;
"RTN","GMRCP5B",140,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5B",141,0)
 Q:'$L(X) ""
"RTN","GMRCP5B",142,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5B",143,0)
 I (X[".") S DATE=$P(X,".",1),TIME=1
"RTN","GMRCP5B",144,0)
 E  S DATE=X,TIME=0
"RTN","GMRCP5B",145,0)
 S Y=$E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_($E(DATE,1,3)+1700)
"RTN","GMRCP5B",146,0)
 I TIME D
"RTN","GMRCP5B",147,0)
 .S TIME=X#1*10000+10000\1
"RTN","GMRCP5B",148,0)
 .S HR=$E(TIME,2,3)
"RTN","GMRCP5B",149,0)
 .S MN=$E(TIME,4,5)
"RTN","GMRCP5B",150,0)
 .S PD="am" S:(HR=12) PD="pm" S:(HR>12) HR=HR-12,PD="pm" S:(HR=0) HR=12
"RTN","GMRCP5B",151,0)
 .S Y=Y_" "_HR_":"_MN_PD
"RTN","GMRCP5B",152,0)
 Q Y
"RTN","GMRCP5B",153,0)
 ;
"RTN","GMRCP5B",154,0)
PRCMT(CMT) ;
"RTN","GMRCP5B",155,0)
 ;
"RTN","GMRCP5B",156,0)
 Q $P($G(^GMR(123.1,+CMT,0)),U,8)
"RTN","GMRCP5B",157,0)
 ;
"RTN","GMRCP5B",158,0)
 ;
"RTN","GMRCP5B",159,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5B",160,0)
 ;
"RTN","GMRCP5B",161,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5B",162,0)
 N LINECNT
"RTN","GMRCP5B",163,0)
 ;
"RTN","GMRCP5B",164,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5B",165,0)
 ;
"RTN","GMRCP5B",166,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5B",167,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5B",168,0)
 ;
"RTN","GMRCP5B",169,0)
 S GMRCLAST=SUB
"RTN","GMRCP5B",170,0)
 Q
"RTN","GMRCP5B",171,0)
 ;
"RTN","GMRCP5B",172,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5B",173,0)
 ;
"RTN","GMRCP5B",174,0)
 N NEXT
"RTN","GMRCP5B",175,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5B",176,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5B",177,0)
 Q
"RTN","GMRCP5B",178,0)
 ;
"RTN","GMRCP5B",179,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5B",180,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5B",181,0)
 ;
"RTN","GMRCP5C")
0^4^B49791242
"RTN","GMRCP5C",1,0)
GMRCP5C ;SLC/DCM,RJS - Print Consult form 513 (Assemble Segments And Print) ;4/30/98  09:41
"RTN","GMRCP5C",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;Dec 27, 1997
"RTN","GMRCP5C",3,0)
 ;
"RTN","GMRCP5C",4,0)
 Q
"RTN","GMRCP5C",5,0)
 ;
"RTN","GMRCP5C",6,0)
ASSMBL(PAGELEN,PAGEWID) ;
"RTN","GMRCP5C",7,0)
 ;
"RTN","GMRCP5C",8,0)
 N GMRCHDR,GMRCPG,SUB,GMRCPAGE,GMRCDVL
"RTN","GMRCP5C",9,0)
 ;
"RTN","GMRCP5C",10,0)
 S GMRCDVL="",$P(GMRCDVL,"-",PAGEWID+1)=""
"RTN","GMRCP5C",11,0)
 S ^TMP("GMRC",$J,"SF513")=$G(PAGELEN)
"RTN","GMRCP5C",12,0)
 S GMRCPG=1,GMRCHDR=""
"RTN","GMRCP5C",13,0)
 D CLRZONE(0)
"RTN","GMRCP5C",14,0)
 D MERGE("HDR",0,1)
"RTN","GMRCP5C",15,0)
 D MERGE("FTR",0,5)
"RTN","GMRCP5C",16,0)
 ;
"RTN","GMRCP5C",17,0)
 ;REQ    add reason for request segment
"RTN","GMRCP5C",18,0)
 ;
"RTN","GMRCP5C",19,0)
 D FORMAT("REQ",PAGELEN,PAGEWID,2)
"RTN","GMRCP5C",20,0)
 ;
"RTN","GMRCP5C",21,0)
 ;PDIAG  add provisional diagnosis segment
"RTN","GMRCP5C",22,0)
 ;
"RTN","GMRCP5C",23,0)
 D FORMAT("PDIAG",PAGELEN,PAGEWID,$$SIZE("PDIAG",1)+1)
"RTN","GMRCP5C",24,0)
 ;
"RTN","GMRCP5C",25,0)
 ;RES    add tiu results segment
"RTN","GMRCP5C",26,0)
 ;
"RTN","GMRCP5C",27,0)
 D FORMAT("RES",PAGELEN,PAGEWID,6)
"RTN","GMRCP5C",28,0)
 ;
"RTN","GMRCP5C",29,0)
 ;ADD    add addendum segment
"RTN","GMRCP5C",30,0)
 ;
"RTN","GMRCP5C",31,0)
 D FORMAT("ADD",PAGELEN,PAGEWID,4)
"RTN","GMRCP5C",32,0)
 ;
"RTN","GMRCP5C",33,0)
 ;SREP   add service report segment
"RTN","GMRCP5C",34,0)
 ;
"RTN","GMRCP5C",35,0)
 D FORMAT("SREP",PAGELEN,PAGEWID,5)
"RTN","GMRCP5C",36,0)
 ;
"RTN","GMRCP5C",37,0)
 ;COM    add comments segment
"RTN","GMRCP5C",38,0)
 ;
"RTN","GMRCP5C",39,0)
 D FORMAT("COM",PAGELEN,PAGEWID,5)
"RTN","GMRCP5C",40,0)
 ;
"RTN","GMRCP5C",41,0)
 I $D(GMRCPAGE(300000)) D OUTPUT(GMRCPG)
"RTN","GMRCP5C",42,0)
 ;
"RTN","GMRCP5C",43,0)
 Q
"RTN","GMRCP5C",44,0)
 ;
"RTN","GMRCP5C",45,0)
FORMAT(SUB,PAGELEN,PAGEWID,OFFSET) ;
"RTN","GMRCP5C",46,0)
 ;
"RTN","GMRCP5C",47,0)
 N LN,NDX
"RTN","GMRCP5C",48,0)
 ;
"RTN","GMRCP5C",49,0)
 I $$CHKPAGE("",0,PAGELEN,OFFSET) D CLRZONE(2)
"RTN","GMRCP5C",50,0)
 I $O(^TMP("GMRC",$J,"OUTPUT",SUB,0)),$D(GMRCPAGE(300000)),'(SUB="RES") D BLDPAGE(3,GMRCDVL,PAGEWID)
"RTN","GMRCP5C",51,0)
 ;
"RTN","GMRCP5C",52,0)
 S NDX=0 F  S NDX=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX)) Q:'NDX  D
"RTN","GMRCP5C",53,0)
 .I $$CHKPAGE(SUB,NDX,PAGELEN,OFFSET) D CLRZONE(2)
"RTN","GMRCP5C",54,0)
 .D NEWSUB("F",SUB,NDX,PAGEWID)
"RTN","GMRCP5C",55,0)
 .S LN=0 F  S LN=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,LN)) Q:'LN  D
"RTN","GMRCP5C",56,0)
 ..I $$CHKPAGE(SUB,NDX,PAGELEN,2)
"RTN","GMRCP5C",57,0)
 ..D BLDPAGE(3,$G(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,LN,0)),PAGEWID,$G(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,LN,1)),SUB,NDX)
"RTN","GMRCP5C",58,0)
 .D BLDPAGE(3," ",PAGEWID,"",SUB,NDX)
"RTN","GMRCP5C",59,0)
 .D ADDFTR(SUB,NDX,PAGEWID)
"RTN","GMRCP5C",60,0)
 ;
"RTN","GMRCP5C",61,0)
 Q
"RTN","GMRCP5C",62,0)
 ;
"RTN","GMRCP5C",63,0)
NEWSUB(ZONE,SUB,NDX,PAGEWID) ;
"RTN","GMRCP5C",64,0)
 ;
"RTN","GMRCP5C",65,0)
 N FLN,NZONE
"RTN","GMRCP5C",66,0)
 ;
"RTN","GMRCP5C",67,0)
 S:(ZONE="H") NZONE=2
"RTN","GMRCP5C",68,0)
 S:(ZONE="F") NZONE=4
"RTN","GMRCP5C",69,0)
 Q:'$G(NZONE)
"RTN","GMRCP5C",70,0)
 D CLRZONE(NZONE)
"RTN","GMRCP5C",71,0)
 ;
"RTN","GMRCP5C",72,0)
 S FLN=0 F  S FLN=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,FLN)) Q:'FLN  D
"RTN","GMRCP5C",73,0)
 .D BLDPAGE(NZONE,$G(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,FLN,0)),PAGEWID,$G(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,FLN,1)),SUB,NDX)
"RTN","GMRCP5C",74,0)
 Q
"RTN","GMRCP5C",75,0)
 ;
"RTN","GMRCP5C",76,0)
ADDFTR(SUB,NDX,PAGEWID) ;
"RTN","GMRCP5C",77,0)
 ;
"RTN","GMRCP5C",78,0)
 N FLN
"RTN","GMRCP5C",79,0)
 D CLRZONE(4)
"RTN","GMRCP5C",80,0)
 S FLN=0 F  S FLN=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,"F",FLN)) Q:'FLN  D
"RTN","GMRCP5C",81,0)
 .D BLDPAGE(3,$G(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,"F",FLN,0)),PAGEWID,$G(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,"F",FLN,1)),SUB,NDX)
"RTN","GMRCP5C",82,0)
 Q
"RTN","GMRCP5C",83,0)
 ;
"RTN","GMRCP5C",84,0)
NEWPAGE(SUB,NDX) ;
"RTN","GMRCP5C",85,0)
 ;
"RTN","GMRCP5C",86,0)
 N GMRCHDR
"RTN","GMRCP5C",87,0)
 ;
"RTN","GMRCP5C",88,0)
 D OUTPUT(GMRCPG)
"RTN","GMRCP5C",89,0)
 ;
"RTN","GMRCP5C",90,0)
 S GMRCPG=GMRCPG+1
"RTN","GMRCP5C",91,0)
 D MERGE("HDR",1,1)
"RTN","GMRCP5C",92,0)
 D MERGE("FTR",1,5)
"RTN","GMRCP5C",93,0)
 ;
"RTN","GMRCP5C",94,0)
 I $L(SUB) D NEWSUB("H",SUB,NDX,PAGEWID)
"RTN","GMRCP5C",95,0)
 Q
"RTN","GMRCP5C",96,0)
 ;
"RTN","GMRCP5C",97,0)
CHKPAGE(SUB,NDX,PAGELEN,OFFSET) ;
"RTN","GMRCP5C",98,0)
 ;
"RTN","GMRCP5C",99,0)
 I ($$ROOM(PAGELEN)<OFFSET) D NEWPAGE(SUB,NDX) Q 1
"RTN","GMRCP5C",100,0)
 Q 0
"RTN","GMRCP5C",101,0)
 ;
"RTN","GMRCP5C",102,0)
SIZE(SUB,NDX) ;
"RTN","GMRCP5C",103,0)
 ;
"RTN","GMRCP5C",104,0)
 Q $O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5C",105,0)
 ;
"RTN","GMRCP5C",106,0)
ROOM(LEN) ;
"RTN","GMRCP5C",107,0)
 ;
"RTN","GMRCP5C",108,0)
 N LN,SIZE
"RTN","GMRCP5C",109,0)
 S LN=0 F SIZE=0:1 S LN=$O(GMRCPAGE(LN)) Q:'LN
"RTN","GMRCP5C",110,0)
 Q (LEN-SIZE-1)
"RTN","GMRCP5C",111,0)
 ;
"RTN","GMRCP5C",112,0)
MERGE(SUB,NDX,ZONE) ;
"RTN","GMRCP5C",113,0)
 ;
"RTN","GMRCP5C",114,0)
 N LN
"RTN","GMRCP5C",115,0)
 S LN=0 F  S LN=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,LN)) Q:'LN  D
"RTN","GMRCP5C",116,0)
 .D BLDPAGE(ZONE,$G(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,LN,0)),PAGEWID,$G(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,LN,1)),SUB,NDX)
"RTN","GMRCP5C",117,0)
 Q
"RTN","GMRCP5C",118,0)
 ;
"RTN","GMRCP5C",119,0)
BLDPAGE(ZONE,TEXT,PAGEWID,RUNTIME,SUB,NDX) ;
"RTN","GMRCP5C",120,0)
 ;
"RTN","GMRCP5C",121,0)
 N GMRCX,GMRCL,GMRCR1,GMRCR2,PTR,WORD
"RTN","GMRCP5C",122,0)
 ;
"RTN","GMRCP5C",123,0)
 I ($L(TEXT)<PAGEWID) D ADDLN(ZONE,TEXT,$G(RUNTIME)) Q
"RTN","GMRCP5C",124,0)
 ;
"RTN","GMRCP5C",125,0)
 F PTR=1:1 Q:(PTR>$L(TEXT," "))  I ($L($P(TEXT," ",PTR))>PAGEWID) D
"RTN","GMRCP5C",126,0)
 .S WORD=$P(TEXT," ",PTR)
"RTN","GMRCP5C",127,0)
 .S WORD=$E(WORD,1,PAGEWID)_" "_$E(WORD,(PAGEWID+1),$L(WORD))
"RTN","GMRCP5C",128,0)
 .S $P(TEXT," ",PTR)=WORD,PTR=1
"RTN","GMRCP5C",129,0)
 ;
"RTN","GMRCP5C",130,0)
 F PTR=2:1:$L(TEXT," ") Q:'$L(TEXT)  I ($L($P(TEXT," ",1,PTR))>PAGEWID) D
"RTN","GMRCP5C",131,0)
 .I (ZONE=3),$$CHKPAGE(SUB,NDX,PAGELEN,2)
"RTN","GMRCP5C",132,0)
 .S (GMRCR1,GMRCR2)=""
"RTN","GMRCP5C",133,0)
 .I $L(RUNTIME) D
"RTN","GMRCP5C",134,0)
 ..S GMRCL=$L($P(TEXT," ",1,PTR-1))
"RTN","GMRCP5C",135,0)
 ..F GMRCX=1:2:$L(RUNTIME,",") D
"RTN","GMRCP5C",136,0)
 ...I ($P(RUNTIME,",",GMRCX+1)>GMRCL) D  I 1
"RTN","GMRCP5C",137,0)
 ....S:$L(GMRCR2) GMRCR2=GMRCR2_","
"RTN","GMRCP5C",138,0)
 ....S GMRCR2=GMRCR2_$P(RUNTIME,",",GMRCX)_","_($P(RUNTIME,",",GMRCX+1)-GMRCL)
"RTN","GMRCP5C",139,0)
 ...E  D
"RTN","GMRCP5C",140,0)
 ....S:$L(GMRCR1) GMRCR1=GMRCR1_","
"RTN","GMRCP5C",141,0)
 ....S GMRCR1=GMRCR1_$P(RUNTIME,",",GMRCX,GMRCX+1)
"RTN","GMRCP5C",142,0)
 .D ADDLN(ZONE,$P(TEXT," ",1,PTR-1),GMRCR1)
"RTN","GMRCP5C",143,0)
 .S TEXT=$P(TEXT," ",PTR,$L(TEXT," ")),PTR=1,RUNTIME=GMRCR2
"RTN","GMRCP5C",144,0)
 I $L(TEXT) S:(ZONE=3) GMRCX=$$CHKPAGE($G(SUB),$G(NDX),PAGELEN,2) D ADDLN(ZONE,TEXT,$G(RUNTIME))
"RTN","GMRCP5C",145,0)
 Q
"RTN","GMRCP5C",146,0)
 ;
"RTN","GMRCP5C",147,0)
ADDLN(ZONE,TEXT,RUNTIME) ;
"RTN","GMRCP5C",148,0)
 ;
"RTN","GMRCP5C",149,0)
 N NEXTLN
"RTN","GMRCP5C",150,0)
 I '$D(GMRCPAGE(ZONE*100000)) S GMRCPAGE(ZONE*100000,0)=TEXT Q
"RTN","GMRCP5C",151,0)
 S NEXTLN=$O(GMRCPAGE(ZONE*100000+99999),-1)+1
"RTN","GMRCP5C",152,0)
 S GMRCPAGE(NEXTLN,0)=TEXT
"RTN","GMRCP5C",153,0)
 S:$L($G(RUNTIME)) GMRCPAGE(NEXTLN,1)=RUNTIME
"RTN","GMRCP5C",154,0)
 Q
"RTN","GMRCP5C",155,0)
 ;
"RTN","GMRCP5C",156,0)
OUTPUT(GMRCPG) ;
"RTN","GMRCP5C",157,0)
 ;
"RTN","GMRCP5C",158,0)
 N LN,LN1,NEXT,ZONE,VAR,PTR
"RTN","GMRCP5C",159,0)
 S LN=0 F  S LN=$O(GMRCPAGE(LN)) Q:'LN  I $O(GMRCPAGE(LN,0)) D
"RTN","GMRCP5C",160,0)
 .S LN1=0 F  S LN1=$O(GMRCPAGE(LN,LN1)) Q:'LN1  D
"RTN","GMRCP5C",161,0)
 ..S VAR=$G(GMRCPAGE(LN,LN1)) Q:'$L(VAR)
"RTN","GMRCP5C",162,0)
 ..S PTR=$P(VAR,",",2),VAR=$P(VAR,",",1)
"RTN","GMRCP5C",163,0)
 ..I PTR,$L(VAR),($D(@VAR)#2) S $E(GMRCPAGE(LN,0),PTR+1,PTR+1+$L(@VAR))=@VAR
"RTN","GMRCP5C",164,0)
 ;
"RTN","GMRCP5C",165,0)
 S NEXT=$O(^TMP("GMRC",$J,"SF513"," "),-1)+1
"RTN","GMRCP5C",166,0)
 M ^TMP("GMRC",$J,"SF513",NEXT)=GMRCPAGE
"RTN","GMRCP5C",167,0)
 F ZONE=1,2,3,5 D CLRZONE(ZONE)
"RTN","GMRCP5C",168,0)
 Q
"RTN","GMRCP5C",169,0)
 ;
"RTN","GMRCP5C",170,0)
CLRZONE(ZONE) ;
"RTN","GMRCP5C",171,0)
 ;
"RTN","GMRCP5C",172,0)
 ; Zone 1 = Header
"RTN","GMRCP5C",173,0)
 ; Zone 2 = SubHeader (Continuation Information)
"RTN","GMRCP5C",174,0)
 ; Zone 3 = Body of the Consult
"RTN","GMRCP5C",175,0)
 ; Zone 4 = SubFooter (Signature Information)
"RTN","GMRCP5C",176,0)
 ; Zone 5 = Footer
"RTN","GMRCP5C",177,0)
 ;
"RTN","GMRCP5C",178,0)
 I '$G(ZONE) K GMRCPAGE Q
"RTN","GMRCP5C",179,0)
 N LN,STLN,ENDLN
"RTN","GMRCP5C",180,0)
 S STLN=100000*ZONE,ENDLN=STLN+99999
"RTN","GMRCP5C",181,0)
 S LN=STLN D  F  S LN=$O(GMRCPAGE(LN)) Q:'LN  Q:(LN>ENDLN)  D
"RTN","GMRCP5C",182,0)
 .K GMRCPAGE(LN)
"RTN","GMRCP5C",183,0)
 Q
"RTN","GMRCP5C",184,0)
 ;
"RTN","GMRCP5C",185,0)
PRINT(PAGELEN,PAGEWID) ; Print the Consult
"RTN","GMRCP5C",186,0)
 ;
"RTN","GMRCP5C",187,0)
 N GMRCPAGE,LN,LN1,VAR,PAGE,PAUSE,PTR,ROOM,LNCNT
"RTN","GMRCP5C",188,0)
 ;
"RTN","GMRCP5C",189,0)
 S PAGE=0 F  S PAGE=$O(^TMP("GMRC",$J,"SF513",PAGE)) Q:'PAGE  D  Q:(PAUSE[U)
"RTN","GMRCP5C",190,0)
 .W:(PAGE>1) @IOF
"RTN","GMRCP5C",191,0)
 .K GMRCPAGE M GMRCPAGE=^TMP("GMRC",$J,"SF513",PAGE)
"RTN","GMRCP5C",192,0)
 .S ROOM=$$ROOM(PAGELEN)
"RTN","GMRCP5C",193,0)
 .I (ROOM<100) F LN=1:1:ROOM D BLDPAGE(3," ",PAGEWID)
"RTN","GMRCP5C",194,0)
 .S GMRCPG=PAGE_" of "_$O(^TMP("GMRC",$J,"SF513"," "),-1)
"RTN","GMRCP5C",195,0)
 .S LN=0 F LNCNT=0:1 S LN=$O(GMRCPAGE(LN)) Q:'LN  D
"RTN","GMRCP5C",196,0)
 ..S LN1=0 F  S LN1=$O(GMRCPAGE(LN,LN1)) Q:'LN1  D
"RTN","GMRCP5C",197,0)
 ...S VAR=$G(GMRCPAGE(LN,LN1)) Q:'$L(VAR)
"RTN","GMRCP5C",198,0)
 ...S PTR=$P(VAR,",",2),VAR=$P(VAR,",",1)
"RTN","GMRCP5C",199,0)
 ...I PTR,$L(VAR),($D(@VAR)#2) D
"RTN","GMRCP5C",200,0)
 ....S $E(GMRCPAGE(LN,0),PTR+1,PTR+1+$L(@VAR))=@VAR
"RTN","GMRCP5C",201,0)
 ..W !,$G(GMRCPAGE(LN,0))
"RTN","GMRCP5C",202,0)
 .;
"RTN","GMRCP5C",203,0)
 .S PAUSE=0
"RTN","GMRCP5C",204,0)
 .S:$O(^TMP("GMRC",$J,"SF513",PAGE)) PAUSE=PAUSE+1
"RTN","GMRCP5C",205,0)
 .S:$O(^TMP("GMRC",$J,"SF513",PAGE),-1) PAUSE=PAUSE+10
"RTN","GMRCP5C",206,0)
 .S PAUSE=$$PAUSE(PAUSE,PAGE)
"RTN","GMRCP5C",207,0)
 .S:(PAUSE["-") PAGE=PAGE-2
"RTN","GMRCP5C",208,0)
 ;
"RTN","GMRCP5C",209,0)
 Q
"RTN","GMRCP5C",210,0)
 ;
"RTN","GMRCP5C",211,0)
PAUSE(PF,PG) ; Pause After Each Screen for CRT's
"RTN","GMRCP5C",212,0)
 ;
"RTN","GMRCP5C",213,0)
 N X,C
"RTN","GMRCP5C",214,0)
 Q:'$$CRT ""
"RTN","GMRCP5C",215,0)
 ;
"RTN","GMRCP5C",216,0)
 W !,"  Press:  "
"RTN","GMRCP5C",217,0)
 ;
"RTN","GMRCP5C",218,0)
 I (PF=00) W "<Enter> To Quit                             (^) To Quit : "
"RTN","GMRCP5C",219,0)
 I (PF=01) W "<Enter> For Next Page                       (^) To Quit : "
"RTN","GMRCP5C",220,0)
 I (PF=10) W "<Enter> To Quit       (-) For Previous Page (^) To Quit : "
"RTN","GMRCP5C",221,0)
 I (PF=11) W "<Enter> For Next Page (-) For Previous Page (^) To Quit : "
"RTN","GMRCP5C",222,0)
 ;
"RTN","GMRCP5C",223,0)
 R X:DTIME E  W " (timeout)" Q U
"RTN","GMRCP5C",224,0)
 W !
"RTN","GMRCP5C",225,0)
 Q X
"RTN","GMRCP5C",226,0)
 ;
"RTN","GMRCP5C",227,0)
CRT() ; IS THE PRINT DEVICE A CRT ?
"RTN","GMRCP5C",228,0)
 Q:TIUFLG 0 Q ($E(IOST,1,2)="C-")
"RTN","GMRCP5C",229,0)
 ;
"RTN","GMRCP5D")
0^10^B49856228
"RTN","GMRCP5D",1,0)
GMRCP5D ;SLC/DCM,RJS - Print Consult form 513 (Gather Data - Addendums, Headers, Service reports and Comments) ;7/15/98  13:00;
"RTN","GMRCP5D",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;Dec 27, 1997
"RTN","GMRCP5D",3,0)
 ;
"RTN","GMRCP5D",4,0)
FORMAT(GMRCIFN,GMRCRD,PAGEWID) ;
"RTN","GMRCP5D",5,0)
 ;
"RTN","GMRCP5D",6,0)
 I $L($P(GMRCRD,U,15)) D
"RTN","GMRCP5D",7,0)
 .S GMRCTO=$P(GMRCRD,U,5),GMRCSR=$P(GMRCRD,U,15),ORACTION=8
"RTN","GMRCP5D",8,0)
 .I $E($P(GMRCSR,";",2),1,2)="MC" D  Q:'MCPROC
"RTN","GMRCP5D",9,0)
 ..S MCFILE=$P(GMRCSR,";",2),MCFILE=$P(MCFILE,",")
"RTN","GMRCP5D",10,0)
 ..S MCPROC=$O(^MCAR(697.2,"C",MCFILE,"")) Q:'MCPROC
"RTN","GMRCP5D",11,0)
 .;
"RTN","GMRCP5D",12,0)
 .S GMRCPRNM=$P($G(^MCAR(697.2,MCPROC,0)),U,8)
"RTN","GMRCP5D",13,0)
 .;
"RTN","GMRCP5D",14,0)
 .S GMRCX=$G(^GMR(123.5,+GMRCTO,20))
"RTN","GMRCP5D",15,0)
 .;
"RTN","GMRCP5D",16,0)
 .;
"RTN","GMRCP5D",17,0)
 .I $O(^TMP("GMRCR",$J,"MCAR",0)) D
"RTN","GMRCP5D",18,0)
 ..S GMRCSVC=$P($G(^GMR(123.5,+$P(GMRCRD,U,5),0)),U,1)
"RTN","GMRCP5D",19,0)
 ..S:$L(GMRCSVC) GMRCSVC=GMRCSVC_" "
"RTN","GMRCP5D",20,0)
 ..;
"RTN","GMRCP5D",21,0)
 ..S GMRCR0=0 F  S GMRCR0=$O(^TMP("GMRCR",$J,"MCAR",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5D",22,0)
 ...D SUB("H","SREP",1,GMRCSVC_"Service Report #"_GMRCR0_" continued.")
"RTN","GMRCP5D",23,0)
 ...D SUB("H","SREP",1," ")
"RTN","GMRCP5D",24,0)
 ...D BLD("SREP",1,1,0,$$CENTER(GMRCSVC_"Service Report #"_GMRCR0))
"RTN","GMRCP5D",25,0)
 ...D BLD("SREP",1,1,0,"")
"RTN","GMRCP5D",26,0)
 ...S LN=0 F  S LN=$O(^TMP("GMRCR",$J,"MCAR",GMRCR0,LN)) Q:'LN  D
"RTN","GMRCP5D",27,0)
 ....D BLD("SREP",1,1,0,$G(^TMP("GMRCR",$J,"MCAR",GMRCR0,LN,0)))
"RTN","GMRCP5D",28,0)
 ;
"RTN","GMRCP5D",29,0)
 S GMRCR0=0 F  S GMRCR0=$O(^GMR(123,GMRCIFN,40,GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5D",30,0)
 .N GMRCR1,GMRC400,CMT,USER,GMRCDT,RPRV
"RTN","GMRCP5D",31,0)
 .S GMRCR1=+$O(^GMR(123,GMRCIFN,40,GMRCR0,0)) Q:'GMRCR1
"RTN","GMRCP5D",32,0)
 .S GMRC400=$G(^GMR(123,GMRCIFN,40,GMRCR0,0))
"RTN","GMRCP5D",33,0)
 .S CMT=$$PRCMT^GMRCP5B(+$P(GMRC400,U,2)) Q:'$L(CMT)
"RTN","GMRCP5D",34,0)
 .S GMRCDT=$P(GMRC400,U,3) S:'GMRCDT GMRCDT=$P(GMRC400,U,1)
"RTN","GMRCP5D",35,0)
 .S GMRCDT=$$EXDT(GMRCDT)
"RTN","GMRCP5D",36,0)
 .;
"RTN","GMRCP5D",37,0)
 .S RPRV=$$GET1^DIQ(200,+$P(GMRC400,U,4),.01)
"RTN","GMRCP5D",38,0)
 .S:($L(RPRV)) RPRV="Responsible Provider: "_RPRV
"RTN","GMRCP5D",39,0)
 .S USER=$$GET1^DIQ(200,+$P(GMRC400,U,5),.01)
"RTN","GMRCP5D",40,0)
 .S USER="Entered by: "_USER_" - "_GMRCDT
"RTN","GMRCP5D",41,0)
 .D SUB("H","COM",GMRCR0,CMT_" Comment ("_USER_") continued.")
"RTN","GMRCP5D",42,0)
 .D SUB("H","COM",GMRCR0," ")
"RTN","GMRCP5D",43,0)
 .D BLD("COM",GMRCR0,1,0,"")
"RTN","GMRCP5D",44,0)
 .D BLD("COM",GMRCR0,1,0,$$CENTER("("_CMT_" Comment)"))
"RTN","GMRCP5D",45,0)
 .D BLD("COM",GMRCR0,1,5,USER)
"RTN","GMRCP5D",46,0)
 .D:($L(RPRV)) BLD("COM",GMRCR0,1,5,RPRV)
"RTN","GMRCP5D",47,0)
 .;
"RTN","GMRCP5D",48,0)
 .S GMRCR2=0 F  S GMRCR2=$O(^GMR(123,GMRCIFN,40,GMRCR0,GMRCR1,GMRCR2)) Q:'GMRCR2  D
"RTN","GMRCP5D",49,0)
 ..D BLD("COM",GMRCR0,1,0,$G(^GMR(123,GMRCIFN,40,GMRCR0,GMRCR1,GMRCR2,0)))
"RTN","GMRCP5D",50,0)
 ;
"RTN","GMRCP5D",51,0)
 Q
"RTN","GMRCP5D",52,0)
 ;
"RTN","GMRCP5D",53,0)
ADDEND(GMRCIFN,GMRCR0,GMRCNDX,GMRCRD,PAGEWID) ;
"RTN","GMRCP5D",54,0)
 ;
"RTN","GMRCP5D",55,0)
 N GMRCADD,GMRCNDX,GMRCR1,GMRCV,TEXT,GMRCX
"RTN","GMRCP5D",56,0)
 ;
"RTN","GMRCP5D",57,0)
 S GMRCADD=0 F  S GMRCADD=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD)) Q:'GMRCADD  D
"RTN","GMRCP5D",58,0)
 .N GMRCSGNM,GMRCNMDT,GMRCTIT,GMRCMODE,GMRCCSDT,GMRCCTIT,GMRCCSGM
"RTN","GMRCP5D",59,0)
 .;
"RTN","GMRCP5D",60,0)
 .F GMRCV="GMRCSGNM","GMRCNMDT","GMRCTIT","GMRCMODE" D
"RTN","GMRCP5D",61,0)
 ..S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCV))
"RTN","GMRCP5D",62,0)
 .;
"RTN","GMRCP5D",63,0)
 . F GMRCV="GMRCCSDT","GMRCCTIT","GMRCCSGM","GMRCCSIG" D
"RTN","GMRCP5D",64,0)
 .. S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCV))
"RTN","GMRCP5D",65,0)
 .S GMRCNDX=$O(^TMP("GMRC",$J,"OUTPUT","RES"," "),-1)+1
"RTN","GMRCP5D",66,0)
 .I $L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Addendum #"_GMRCADD_" To Consult Note #"_GMRCR0_" for "_GMRCRPT_" continued.")
"RTN","GMRCP5D",67,0)
 .I '$L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Addendum #"_GMRCADD_" To Consult Note #"_GMRCR0_" continued.")
"RTN","GMRCP5D",68,0)
 .D SUB("H","RES",GMRCNDX," ")
"RTN","GMRCP5D",69,0)
 .I $L($G(GMRCSGNM)) D
"RTN","GMRCP5D",70,0)
 ..D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5D",71,0)
 ..I (GMRCMODE="electronic") S GMRCX=" Addendum Signature: "_GMRCSGNM_" /es/ "_$$EXDT($G(GMRCNMDT))
"RTN","GMRCP5D",72,0)
 ..I '(GMRCMODE="electronic") S GMRCX=" Addendum Author: "_GMRCSGNM S:$L($G(GMRCNMDT)) GMRCX=GMRCX_" Last edited: "_$$EXDT(GMRCNMDT)
"RTN","GMRCP5D",73,0)
 ..D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5D",74,0)
 ..D:$L($G(GMRCTIT)) SUB("F","RES",GMRCNDX,"                     "_GMRCTIT)
"RTN","GMRCP5D",75,0)
 .I $L($G(GMRCCSDT)) D
"RTN","GMRCP5D",76,0)
 ..D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5D",77,0)
 ..I (GMRCCSGM="electronic") S GMRCX=" Addendum CoSignature: "_GMRCCSIG_" /es/ "_$$EXDT(GMRCCSDT)
"RTN","GMRCP5D",78,0)
 ..I '(GMRCCSGM="electronic") S GMRCX=" Addendum CoSignature: "_GMRCCSIG_" /chart/ "_$$EXDT(GMRCCSDT)
"RTN","GMRCP5D",79,0)
 ..D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5D",80,0)
 ..D:$L($G(GMRCCTIT)) SUB("F","RES",GMRCNDX,"                       "_GMRCCTIT)
"RTN","GMRCP5D",81,0)
 .D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5D",82,0)
 .I $L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("ADDENDUM #"_GMRCADD_" TO CONSULT NOTE #"_GMRCR0_" FOR "_GMRCRPT))
"RTN","GMRCP5D",83,0)
 .I '$L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("ADDENDUM #"_GMRCADD_" TO CONSULT NOTE #"_GMRCR0))
"RTN","GMRCP5D",84,0)
 .D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5D",85,0)
 .S GMRCR1=0 F  S GMRCR1=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCR1)) Q:'GMRCR1  D
"RTN","GMRCP5D",86,0)
 ..D BLD("RES",GMRCNDX,1,0,$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCR1,0)))
"RTN","GMRCP5D",87,0)
 Q
"RTN","GMRCP5D",88,0)
 ;
"RTN","GMRCP5D",89,0)
HDR ; Header code for form 513
"RTN","GMRCP5D",90,0)
 ;
"RTN","GMRCP5D",91,0)
 N PG,GMRCFROM
"RTN","GMRCP5D",92,0)
 ;
"RTN","GMRCP5D",93,0)
 F PG=0,1 D
"RTN","GMRCP5D",94,0)
 .D BLD("HDR",PG,1,0,GMRCDVL)
"RTN","GMRCP5D",95,0)
 .D BLD("HDR",PG,1,6,"MEDICAL RECORD")
"RTN","GMRCP5D",96,0)
 .D BLD("HDR",PG,0,29,"|")
"RTN","GMRCP5D",97,0)
 .D BLD("HDR",PG,0,36,"CONSULTATION SHEET")
"RTN","GMRCP5D",98,0)
 .I PG D BLD("HDR",PG,0,60,"Page ","GMRCPG,65") I 1
"RTN","GMRCP5D",99,0)
 .E  I '$G(GMRCGUI) D BLD("HDR",PG,0,60,"Page ","GMRCPG,65")
"RTN","GMRCP5D",100,0)
 .;
"RTN","GMRCP5D",101,0)
 .D BLD("HDR",PG,1,0,GMRCDVL)
"RTN","GMRCP5D",102,0)
 .D BLD("HDR",PG,1,0,"Consult Request: "_$$CONSRQ(GMRCIFN))
"RTN","GMRCP5D",103,0)
 .D BLD("HDR",PG,0,55,"|Consult No.: "_GMRCIFN)
"RTN","GMRCP5D",104,0)
 .;
"RTN","GMRCP5D",105,0)
 D BLD("HDR",1,1,0,GMRCEQL)
"RTN","GMRCP5D",106,0)
 D BLD("HDR",0,1,0,GMRCDVL)
"RTN","GMRCP5D",107,0)
 ;
"RTN","GMRCP5D",108,0)
 I $G(CMT) D BLD("HDR",0,1,27,"("_$$PRCMT^GMRCP5B(CMT)_")") Q
"RTN","GMRCP5D",109,0)
 ;
"RTN","GMRCP5D",110,0)
 S GMRCFROM=$P($G(^SC(+$P(GMRCRD,U,6),0)),U,1)
"RTN","GMRCP5D",111,0)
 ;
"RTN","GMRCP5D",112,0)
 I '$L(GMRCFROM) D
"RTN","GMRCP5D",113,0)
 .N VAIN
"RTN","GMRCP5D",114,0)
 .D INP^VADPT
"RTN","GMRCP5D",115,0)
 .S GMRCFROM=$P($G(VAIN(4)),U,2)
"RTN","GMRCP5D",116,0)
 .I $L($G(VAIN(5))) S GMRCFROM=GMRCFROM_" (Rm/Bd: "_$G(VAIN(5))_" )"
"RTN","GMRCP5D",117,0)
 ;
"RTN","GMRCP5D",118,0)
 D BLD("HDR",0,1,0,"To: "_$P($G(^GMR(123.5,+$P(GMRCRD,U,5),0)),U,1))
"RTN","GMRCP5D",119,0)
 ;I $L($G(^GMR(123,+GMRCIFN,1.11))) D
"RTN","GMRCP5D",120,0)
 . N SERV S SERV=$$UP^XLFSTR($P($G(^GMR(123.5,+$P(GMRCRD,U,5),0)),U,1))
"RTN","GMRCP5D",121,0)
 . N TYPE S TYPE=$$UP^XLFSTR(^GMR(123,+GMRCIFN,1.11)) I TYPE'=SERV D  Q
"RTN","GMRCP5D",122,0)
 .. D BLD("HDR",0,1,0,"Type: "_TYPE) Q
"RTN","GMRCP5D",123,0)
 .. D BLD("HDR",0,0,49,"Type: "_$E(TYPE,1,23)) Q
"RTN","GMRCP5D",124,0)
 D BLD("HDR",0,1,5,"From: "_GMRCFROM)
"RTN","GMRCP5D",125,0)
 D BLD("HDR",0,0,49,"|Requested: "_$$EXDT($P(GMRCRD,U,7)))
"RTN","GMRCP5D",126,0)
 ;
"RTN","GMRCP5D",127,0)
 D BLD("HDR",0,1,0,GMRCDVL)
"RTN","GMRCP5D",128,0)
 D BLD("HDR",0,1,0,"Requesting Facility: "_$E(GMRCFAC,1,22))
"RTN","GMRCP5D",129,0)
 I $P(GMRCRD,U,11) D BLD("HDR",0,0,45,"|ATTENTION: "_$E($P($G(^VA(200,+$P(GMRCRD,U,11),0)),U,1),1,21))
"RTN","GMRCP5D",130,0)
 D BLD("HDR",0,1,0,GMRCEQL)
"RTN","GMRCP5D",131,0)
 ;
"RTN","GMRCP5D",132,0)
 Q
"RTN","GMRCP5D",133,0)
 ;
"RTN","GMRCP5D",134,0)
CENTER(X) ;
"RTN","GMRCP5D",135,0)
 ;
"RTN","GMRCP5D",136,0)
 N TEXT,COL
"RTN","GMRCP5D",137,0)
 S COL=35-($L(X)\2) Q:(COL<1) X
"RTN","GMRCP5D",138,0)
 S $E(TEXT,COL)=X
"RTN","GMRCP5D",139,0)
 Q TEXT
"RTN","GMRCP5D",140,0)
 ;
"RTN","GMRCP5D",141,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5D",142,0)
 ;
"RTN","GMRCP5D",143,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5D",144,0)
 N LINECNT
"RTN","GMRCP5D",145,0)
 ;
"RTN","GMRCP5D",146,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5D",147,0)
 ;
"RTN","GMRCP5D",148,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5D",149,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5D",150,0)
 ;
"RTN","GMRCP5D",151,0)
 S GMRCLAST=SUB
"RTN","GMRCP5D",152,0)
 Q
"RTN","GMRCP5D",153,0)
 ;
"RTN","GMRCP5D",154,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5D",155,0)
 ;
"RTN","GMRCP5D",156,0)
 N NEXT
"RTN","GMRCP5D",157,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5D",158,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5D",159,0)
 Q
"RTN","GMRCP5D",160,0)
 ;
"RTN","GMRCP5D",161,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5D",162,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5D",163,0)
 ;
"RTN","GMRCP5D",164,0)
CONSRQ(IFN) ;
"RTN","GMRCP5D",165,0)
 ;
"RTN","GMRCP5D",166,0)
 N PTR,LINK,REF,GMRCRQ
"RTN","GMRCP5D",167,0)
 I +$P(^GMR(123,+IFN,0),U,8) D
"RTN","GMRCP5D",168,0)
 . S GMRCRQ=$P(^GMR(123,+IFN,0),U,8)
"RTN","GMRCP5D",169,0)
 . S PTR=$P(GMRCRQ,";",1),LINK=$P(GMRCRQ,";",2),REF=U_LINK_PTR_",0)"
"RTN","GMRCP5D",170,0)
 . S GMRCRQ=$P($G(@(REF)),U,2)
"RTN","GMRCP5D",171,0)
 . I '$L(GMRCRQ) S GMRCRQ="Procedure"
"RTN","GMRCP5D",172,0)
 I $L($G(GMRCRQ)) Q GMRCRQ
"RTN","GMRCP5D",173,0)
 I $L($G(^GMR(123,IFN,1.11))) D
"RTN","GMRCP5D",174,0)
 . N SERV,TYPE
"RTN","GMRCP5D",175,0)
 . S SERV=$$UP^XLFSTR($$GET1^DIQ(123.5,$P(^GMR(123,IFN,0),U,5),.01))
"RTN","GMRCP5D",176,0)
 . S TYPE=$$UP^XLFSTR(^GMR(123,IFN,1.11)) I TYPE'=SERV D
"RTN","GMRCP5D",177,0)
 . I TYPE'=SERV S GMRCRQ=$E(^GMR(123,IFN,1.11),1,36)
"RTN","GMRCP5D",178,0)
 Q:$L($G(GMRCRQ)) GMRCRQ Q "Consult"
"RTN","GMRCP5D",179,0)
 ;
"RTN","GMRCP5D",180,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5D",181,0)
 ;
"RTN","GMRCP5D",182,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5D",183,0)
 Q:'$L(X) ""
"RTN","GMRCP5D",184,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5D",185,0)
 I (X[".") S DATE=$P(X,".",1),TIME=1
"RTN","GMRCP5D",186,0)
 E  S DATE=X,TIME=0
"RTN","GMRCP5D",187,0)
 S Y=$E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_($E(DATE,1,3)+1700)
"RTN","GMRCP5D",188,0)
 I TIME D
"RTN","GMRCP5D",189,0)
 .S TIME=X#1*10000+10000\1
"RTN","GMRCP5D",190,0)
 .S HR=$E(TIME,2,3)
"RTN","GMRCP5D",191,0)
 .S MN=$E(TIME,4,5)
"RTN","GMRCP5D",192,0)
 .S PD="am" S:(HR=12) PD="pm" S:(HR>12) HR=HR-12,PD="pm" S:(HR=0) HR=12
"RTN","GMRCP5D",193,0)
 .S Y=Y_" "_HR_":"_MN_PD
"RTN","GMRCP5D",194,0)
 Q Y
"RTN","GMRCP5D",195,0)
 ;
"RTN","GMRCR06")
1^42
"RTN","GMRCREXT")
0^45^B2145943
"RTN","GMRCREXT",1,0)
GMRCREXT ;SLC/DCM - clean-up all variables and ^TMP globals upon exit ;7/16/98  03:49
"RTN","GMRCREXT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCREXT",3,0)
 K ^TMP("GMRCR",$J),^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCREXT",4,0)
 K DFN,BLK,C,CDT,CNT,TAB,LNCT,CTRLCOL,D1,DATA,GMRCDT,GMRCND,GMRCNO,GMRCDT1,GMRCDT2,GMRCSEX,GMRCPNM,GMRCSSN,SEX,GMRCPTN,GMRCERR,GMRCWLI,GMRCPTR,GMRCSVCP,GMRCWRD,GMRCWT,GMRCDFN
"RTN","GMRCREXT",5,0)
 K GMRCRB,GMRCAGE,GMRCCT,GMRCSN,GMRCSSNM,GMRCDOB,GMRCDGT,GMRCDOB,GMRCGRP,GMRCWRD,GMRCNUL,GMRCQUIT,GMRCELIG,GMRCNUL,GMRCOER,GMRCSEL,GMRCOK
"RTN","GMRCREXT",6,0)
 K VAEL,VADM,VAERR
"RTN","GMRCREXT",7,0)
 K GMRCBM,GMRCTM,GMRCNUL,GMRCAD,GMRCXMF,GMRC,GMRCO,GMRCND
"RTN","GMRCREXT",8,0)
 Q
"RTN","GMRCSLDT")
0^21^B9536985
"RTN","GMRCSLDT",1,0)
GMRCSLDT ;SLC/DCM - Get a consults detailed tracking history formated for List Manager ;9/8/98  03:29
"RTN","GMRCSLDT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCSLDT",3,0)
 ;
"RTN","GMRCSLDT",4,0)
HDR ;Header code for detailed display.(also used for results display)
"RTN","GMRCSLDT",5,0)
 D HDR1^GMRCSLM
"RTN","GMRCSLDT",6,0)
 S GMRCX="Consult No.: "_GMRCO D HDR2^GMRCSLM(GMRCX)
"RTN","GMRCSLDT",7,0)
 Q
"RTN","GMRCSLDT",8,0)
 ;
"RTN","GMRCSLDT",9,0)
EN ;Select a consult for detailed display of information.
"RTN","GMRCSLDT",10,0)
 K GMRCQUT,GMRCQIT,GMRCSEL
"RTN","GMRCSLDT",11,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) Q
"RTN","GMRCSLDT",12,0)
 I '+$G(GMRCO) S GMRCQUT=1 Q
"RTN","GMRCSLDT",13,0)
 ;
"RTN","GMRCSLDT",14,0)
 S GMRCND=GMRCO
"RTN","GMRCSLDT",15,0)
 ;S GMRCDT=$O(^TMP("GMRCR",$J,"CS","AD",GMRCNO,0))
"RTN","GMRCSLDT",16,0)
 ;S GMRCND=$O(^TMP("GMRCR",$J,"CS","AD",GMRCNO,GMRCDT,0))
"RTN","GMRCSLDT",17,0)
 W !!,"Compiling Detailed Display..."
"RTN","GMRCSLDT",18,0)
 D LMFMT(GMRCND)
"RTN","GMRCSLDT",19,0)
 D EN^VALM("GMRC DETAILED DISPLAY")
"RTN","GMRCSLDT",20,0)
 Q
"RTN","GMRCSLDT",21,0)
 ;
"RTN","GMRCSLDT",22,0)
LMFMT(GMRCND) ;Build the ^TMP("GMRCR",$J,"DT", global and format the header variables and set the data into List Manager for display of detailed data.
"RTN","GMRCSLDT",23,0)
 N DFN,GMRCAGE,GMRCDOB,GMRCPNM,GMRCSSN,GMRCSS,GMRCSSN,VALMHDR
"RTN","GMRCSLDT",24,0)
 S:'$D(TAB) TAB="",$P(TAB," ",30)=""
"RTN","GMRCSLDT",25,0)
 S DFN=$P(^GMR(123,GMRCND,0),"^",2) D DEM^GMRCU
"RTN","GMRCSLDT",26,0)
 S GMRCSS=$P(^GMR(123,GMRCND,0),"^",5) S GMRCSSN=$S(GMRCSS]"":$P($G(^GMR(123.5,GMRCSS,0)),"^",1),1:"Unknown Location")
"RTN","GMRCSLDT",27,0)
 D DT^GMRCSLM2(+GMRCND)
"RTN","GMRCSLDT",28,0)
 I $D(GMRCQUT) Q
"RTN","GMRCSLDT",29,0)
 K ^TMP("GMRCR",$J,"DTLIST") S DSPLINE=0,VALMAR="^TMP(""GMRCR"",$J,""DTLIST"")"
"RTN","GMRCSLDT",30,0)
 F LINE=1:1:GMRCCT S DSPLINE=$O(^TMP("GMRCR",$J,"DT",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCSLDT",31,0)
 S VALMCNT=LINE-1,XQORM("A")="Select Action: "
"RTN","GMRCSLDT",32,0)
 K DSPLINE,LINE,DATA
"RTN","GMRCSLDT",33,0)
 Q
"RTN","GMRCSLDT",34,0)
 ;
"RTN","GMRCSLDT",35,0)
PHDR ; -- protocol header code called from the display action protocol menus
"RTN","GMRCSLDT",36,0)
 ;S VALMSG=$$MSG
"RTN","GMRCSLDT",37,0)
 D SHOW^VALM
"RTN","GMRCSLDT",38,0)
 S XQORM("#")=$O(^ORD(101,"B","GMRC SELECT ITEM",0))_"^1:"_VALMCNT
"RTN","GMRCSLDT",39,0)
 S XQORM("A")="Select Action: "
"RTN","GMRCSLDT",40,0)
 S XQORM("KEY","EX")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLDT",41,0)
 S XQORM("KEY","Q")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLDT",42,0)
 S XQORM("KEY","CLOSE")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLDT",43,0)
 S XQORM("KEY","NX")=$O(^ORD(101,"B","GMRCACT NEXT SCREEN",0))_"^1"
"RTN","GMRCSLDT",44,0)
 S XQORM("KEY","NEXT")=$O(^ORD(101,"B","GMRCACT NEXT SCREEN",0))_"^1"
"RTN","GMRCSLDT",45,0)
 K GMRCNMBR
"RTN","GMRCSLDT",46,0)
 Q
"RTN","GMRCSLDT",47,0)
HELP ; -- display help code
"RTN","GMRCSLDT",48,0)
 N X S VALMBCK="" D FULL^VALM1 S VALMBCK="R"
"RTN","GMRCSLDT",49,0)
 W !!,"Use the actions listed to scroll up and down, to view the data; if you want",!,"to search the data for a particular string, enter SL.  You may print the"
"RTN","GMRCSLDT",50,0)
 W !,"data, either the entire list or just the current screen, by entering PT or PS",!,"respectively.  Enter Q when finished to return to the chart."
"RTN","GMRCSLDT",51,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","GMRCSLDT",52,0)
 Q
"RTN","GMRCSLDT",53,0)
 ;
"RTN","GMRCSLDT",54,0)
EXIT K ^TMP("GMRCR",$J,"DT"),^TMP("GMRCR",$J,"DTLIST"),GMRCCT
"RTN","GMRCSLDT",55,0)
 ;D KILL^VALM10(GMRCO)
"RTN","GMRCSLDT",56,0)
 K GMRCWT
"RTN","GMRCSLDT",57,0)
 Q
"RTN","GMRCSLM")
0^29^B34554551
"RTN","GMRCSLM",1,0)
GMRCSLM ;SLC/DCM,JFR - List Manager Main routine for consult tracking list ;7/16/98  01:58
"RTN","GMRCSLM",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCSLM",3,0)
EN ; -- main entry point for GMRC CONSULT TRACKING
"RTN","GMRCSLM",4,0)
 K GMRCOER
"RTN","GMRCSLM",5,0)
 S GMRCEN=1 K GMRCQUT
"RTN","GMRCSLM",6,0)
 D SP K GMRCEN I $D(GMRCQUT) K GMRCQUT Q
"RTN","GMRCSLM",7,0)
 D EN^VALM("GMRC CONSULT TRACKING")
"RTN","GMRCSLM",8,0)
 Q
"RTN","GMRCSLM",9,0)
 ;
"RTN","GMRCSLM",10,0)
HDR ; -- header code
"RTN","GMRCSLM",11,0)
 D HDR1 ;format line 1 of header
"RTN","GMRCSLM",12,0)
 D:$L(GMRCWT) HDR2("")
"RTN","GMRCSLM",13,0)
 Q
"RTN","GMRCSLM",14,0)
 ;
"RTN","GMRCSLM",15,0)
HDR1 ;format VALMHDR(1) with patient information
"RTN","GMRCSLM",16,0)
 N GMRCX,GMRCX1,GMRCX2,GMRCX3,TIUCWAD,GMRVSTR,X
"RTN","GMRCSLM",17,0)
 ;Expects DFN
"RTN","GMRCSLM",18,0)
 S GMRVSTR="WT" D EN6^GMRVUTL 
"RTN","GMRCSLM",19,0)
 S GMRCWT="Wt.(lb): "_$S($L($P(X,U,8)):$P(X,U,8),1:"No Entry")
"RTN","GMRCSLM",20,0)
 D DEM^GMRCU ;returns GMRCPNM,GMRCSN,GMRCAGE,SEX,GMRCWARD,GMRCRB,GMRCDOB,GMRCWLI
"RTN","GMRCSLM",21,0)
 S GMRCX1=GMRCPNM_"   "_GMRCSN
"RTN","GMRCSLM",22,0)
 ;
"RTN","GMRCSLM",23,0)
 S GMRCLOC=+$G(^DIC(42,+GMRCWLI,44))_";SC(" I 'GMRCLOC,'$D(XQAID) S GMRCLOC=""
"RTN","GMRCSLM",24,0)
 S GMRCX2="" I +$G(GMRCLOC) D
"RTN","GMRCSLM",25,0)
 . N L S L=$G(^SC(+GMRCLOC,0)),GMRCX2=$P(L,U,2)
"RTN","GMRCSLM",26,0)
 . S:'$L(GMRCX2) GMRCX2=$E($P(L,U),1,4)
"RTN","GMRCSLM",27,0)
 S:$L($G(GMRCRB)) GMRCX2=GMRCX2_"/"_GMRCRB
"RTN","GMRCSLM",28,0)
 ;
"RTN","GMRCSLM",29,0)
 S GMRCX=GMRCX1_$J(GMRCX2,40+($L(GMRCX2)\2)-$L(GMRCX1))
"RTN","GMRCSLM",30,0)
 S GMRCX3=" "_GMRCDOB_" ("_GMRCAGE_")"
"RTN","GMRCSLM",31,0)
 S TIUCWAD=$$CWAD^ORQPT2(+DFN) S:TIUCWAD]"" GMRCX3=GMRCX3_"   <"_TIUCWAD_">"
"RTN","GMRCSLM",32,0)
 S VALMHDR(1)=GMRCX_$J(GMRCX3,79-$L(GMRCX))
"RTN","GMRCSLM",33,0)
 K VALMHDR(2)
"RTN","GMRCSLM",34,0)
 Q
"RTN","GMRCSLM",35,0)
HDR2(GMRCX) ;format VALMHDR(2) with patient weight
"RTN","GMRCSLM",36,0)
 S VALMHDR(2)=$G(GMRCX)_$J($G(GMRCWT),79-$L($G(GMRCX)))
"RTN","GMRCSLM",37,0)
 Q
"RTN","GMRCSLM",38,0)
 ;
"RTN","GMRCSLM",39,0)
INIT ; -- init variables and list array
"RTN","GMRCSLM",40,0)
 K ^TMP("GMRCR",$J,"LIST")
"RTN","GMRCSLM",41,0)
 S DSPLINE=0,DATA="",VALMAR="^TMP(""GMRCR"",$J,""LIST"")"
"RTN","GMRCSLM",42,0)
 F LINE=1:1:LNCT S DSPLINE=$O(^TMP("GMRCR",$J,"CS",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCSLM",43,0)
 S VALMCNT=LNCT,VALMPGE=1,XQORM("A")="Select Action: "
"RTN","GMRCSLM",44,0)
 K DSPLINE,DATA,LINE
"RTN","GMRCSLM",45,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCSLM",46,0)
 Q
"RTN","GMRCSLM",47,0)
 ;
"RTN","GMRCSLM",48,0)
HELP ; -- help code
"RTN","GMRCSLM",49,0)
 N X,DX,DY D FULL^VALM1
"RTN","GMRCSLM",50,0)
 W !!,"Enter the display number of the item you wish to act on, or select an action."
"RTN","GMRCSLM",51,0)
 W !!,"If you'd like another view of the consults, enter CV."
"RTN","GMRCSLM",52,0)
 W !!,"Status key:",!?5,"'a' - active",?27,"'c' - complete",?50,"'dc' - discontinued",!?5,"'p' - pending",?27,"'x' - cancelled",?50,"'pr' - partial results",!?5,"'s' - scheduled",?27,"'e' - expired"
"RTN","GMRCSLM",53,0)
 W !!,"Enter ?? to see a list of actions available for navigating the list."
"RTN","GMRCSLM",54,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","GMRCSLM",55,0)
 S VALMBCK="R"
"RTN","GMRCSLM",56,0)
 ; S VALMSG=$$MSG
"RTN","GMRCSLM",57,0)
 S (DX,DY)=0 X ^%ZOSF("XY")
"RTN","GMRCSLM",58,0)
 D EXIT^GMRCSLMA("R")
"RTN","GMRCSLM",59,0)
 Q
"RTN","GMRCSLM",60,0)
 ;
"RTN","GMRCSLM",61,0)
EXIT ; -- exit code
"RTN","GMRCSLM",62,0)
 K ^TMP("GMRCR",$J,"LIST")
"RTN","GMRCSLM",63,0)
 K VALMCNT,VALMBCK,VALMPGE
"RTN","GMRCSLM",64,0)
 D ^GMRCREXT
"RTN","GMRCSLM",65,0)
 Q
"RTN","GMRCSLM",66,0)
 ;
"RTN","GMRCSLM",67,0)
PHYEN ;Entry Point When Provider's service is known and only needs to look at consults for that service
"RTN","GMRCSLM",68,0)
 Q:'$D(DUZ)  Q:'$D(^VA(200,DUZ,5))  Q:'$L(^VA(200,DUZ,5))
"RTN","GMRCSLM",69,0)
 S DIC="^DIC(49,",DIC(0)="MNO",X=^VA(200,DUZ,5) D ^DIC K DIC S GMRCSSNM=$S($L($P(Y,"^",2)):$P(Y,"^",2),1:"") I $L(GMRCSSNM) S GMRCSS=$O(^GMR(123.5,"B",GMRCSSNM,0))
"RTN","GMRCSLM",70,0)
 S GMRCFL=1 D SP I $D(GMRCQUT),GMRCQUT=1 Q
"RTN","GMRCSLM",71,0)
 D SPD I $D(GMRCQUT) D END,EXIT Q
"RTN","GMRCSLM",72,0)
 K GMRCFL
"RTN","GMRCSLM",73,0)
 D AD^GMRCSLM1
"RTN","GMRCSLM",74,0)
 I GMRCSSNM'["MEDICINE" D EN^VALM("GMRC CONSULT TRACKING"),END,EXIT Q
"RTN","GMRCSLM",75,0)
 D EN^VALM("GMRC TRK MEDICINE CONSULTS"),END,EXIT Q
"RTN","GMRCSLM",76,0)
 Q
"RTN","GMRCSLM",77,0)
SP ;;Select a new patient and return DFN and GMRCSSNM to display consults and requested Service.
"RTN","GMRCSLM",78,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCSLM",79,0)
 K GMRCQUT S GMRCDFN1=$S($D(DFN):DFN,1:0)
"RTN","GMRCSLM",80,0)
 D SELPT^GMRCS I $S($D(GMRCQUT):1,'$D(DFN):1,1:0) S GMRCQUT=1,DFN=GMRCDFN1 G SPK
"RTN","GMRCSLM",81,0)
 I $D(Y),Y<0&(X["^") S GMRCQUT=1 G SPK
"RTN","GMRCSLM",82,0)
 I $D(Y),Y<0 S DFN=GMRCDFN1 S GMRCQUT=1 G SPK
"RTN","GMRCSLM",83,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLM",84,0)
 S GMRCWRD=GMRCWARD
"RTN","GMRCSLM",85,0)
 I $D(GMRCFL) D SPK Q
"RTN","GMRCSLM",86,0)
 D ASRV^GMRCASV I $S($D(GMRCQUT):1,$D(DTOUT):1,$D(DUOUT):1,1:0) K DTOUT,DIROUT,DUOUT S (GMRCQUT,GMRCQIT)=1 Q
"RTN","GMRCSLM",87,0)
 S GMRCSS=GMRCDG,GMRCSSNM=$P(^GMR(123.5,GMRCSS,0),"^",1) S GMRCSTCK=""
"RTN","GMRCSLM",88,0)
 D EN^GMRCMENU
"RTN","GMRCSLM",89,0)
SPD ;Enter a date range for serching consults;  null entry selects all consults and does not exclude by date
"RTN","GMRCSLM",90,0)
 D ^GMRCSPD Q:$D(GMRCQUT)
"RTN","GMRCSLM",91,0)
 I $D(GMRCEN) D SPK Q  ;GMRCEN defined if branched to here from EN^GMRCSLM
"RTN","GMRCSLM",92,0)
 S GMRCOER=0
"RTN","GMRCSLM",93,0)
 D AD^GMRCSLM1 ;Do not delete. Needed to get new Pt. data into ^TMP("GMRCR",
"RTN","GMRCSLM",94,0)
 S VALMCNT=LNCT,VALMBCK="R",VALMPGE=1 K GMRCDFN1
"RTN","GMRCSLM",95,0)
 Q
"RTN","GMRCSLM",96,0)
SPQ ;New patient has not been selected - keep current patient
"RTN","GMRCSLM",97,0)
 I '$D(DFN),GMRCDFN1<1 S GMRCQUT=1 K GMRCDFN1 Q
"RTN","GMRCSLM",98,0)
 S DFN=GMRCDFN1 Q:DFN<1  W " "_GMRCPNM K GMRCDFN1
"RTN","GMRCSLM",99,0)
 S VALMBCK="R",GMRCQUT=1 K GMRCDFN1
"RTN","GMRCSLM",100,0)
SPK ;Kill variables
"RTN","GMRCSLM",101,0)
 ;I $D(GMRCTM),$D(GMRCBM),$D(IOSTBM) S IOTM=GMRCTM,IOBM=IOSTBM
"RTN","GMRCSLM",102,0)
 K GMRCDFN1,GMRCBM,GMRCTM
"RTN","GMRCSLM",103,0)
 Q
"RTN","GMRCSLM",104,0)
SS ;Select A New Service or ALL SERVICES to Display Patient Consults
"RTN","GMRCSLM",105,0)
 K GMRCQUT,GMRCVP S GMRCOER=0
"RTN","GMRCSLM",106,0)
 D FULL^VALM1
"RTN","GMRCSLM",107,0)
 D ASRV^GMRCASV I $D(GMRCQUT),GMRCQUT=1 Q
"RTN","GMRCSLM",108,0)
 S GMRCSS=GMRCDG,GMRCSSNM=$P(^GMR(123.5,GMRCSS,0),"^",1)
"RTN","GMRCSLM",109,0)
 D AD^GMRCSLM1,INIT,HDR
"RTN","GMRCSLM",110,0)
 S VALMBCK="R",VALMCNT=LNCT
"RTN","GMRCSLM",111,0)
 D EN^GMRCACTM,EN^GMRCMENU
"RTN","GMRCSLM",112,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLM",113,0)
 Q
"RTN","GMRCSLM",114,0)
STS ;Select a status for view. i.e., only active, pendings, DC'd, etc.
"RTN","GMRCSLM",115,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCSLM",116,0)
 S GMRCERR=0
"RTN","GMRCSLM",117,0)
 N DIR,X,Y
"RTN","GMRCSLM",118,0)
 S DIR(0)="SAOM^dc:Discontinued;c:Complete;p:Pending;a:Active;pr:Partial Results;x:Cancelled"
"RTN","GMRCSLM",119,0)
 S $P(DIR(0),U,2)="al:All Status's;"_$P(DIR(0),U,2) 
"RTN","GMRCSLM",120,0)
 S DIR("A")="Only Display Consults With Status of: "
"RTN","GMRCSLM",121,0)
 S DIR("B")="All Status's"
"RTN","GMRCSLM",122,0)
 I $G(GMRCSTCK) D
"RTN","GMRCSLM",123,0)
 . S DIR("A")="Another Status to display: "
"RTN","GMRCSLM",124,0)
 . K DIR("B")
"RTN","GMRCSLM",125,0)
 D ^DIR
"RTN","GMRCSLM",126,0)
 I $D(DUOUT)!($D(DTOUT))!('$L(Y)) G END
"RTN","GMRCSLM",127,0)
 D STCK($$LOW^XLFSTR(Y)) I $G(GMRCSTCK)="" D:$D(GMRC("NMBR"))  G END
"RTN","GMRCSLM",128,0)
 . D RESET^GMRCSLMV(GMRC("NMBR"))
"RTN","GMRCSLM",129,0)
 . K GMRC("NMBR")
"RTN","GMRCSLM",130,0)
 . Q
"RTN","GMRCSLM",131,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLM",132,0)
 G STS
"RTN","GMRCSLM",133,0)
STCK(RES)     ;change code to status
"RTN","GMRCSLM",134,0)
 N CODE
"RTN","GMRCSLM",135,0)
 I RES="al" S GMRCSTCK="" Q
"RTN","GMRCSLM",136,0)
 I RES="dc" S CODE=1
"RTN","GMRCSLM",137,0)
 I RES="c" S CODE=2
"RTN","GMRCSLM",138,0)
 I RES="p" S CODE=5
"RTN","GMRCSLM",139,0)
 I RES="a" S CODE=6
"RTN","GMRCSLM",140,0)
 I RES="pr" S CODE=9
"RTN","GMRCSLM",141,0)
 I RES="x" S CODE=13
"RTN","GMRCSLM",142,0)
 I $D(GMRCSTCK)  I $$FND(CODE) W $C(7),!,"Already selected" Q
"RTN","GMRCSLM",143,0)
 I +$G(GMRCSTCK) S GMRCSTCK=GMRCSTCK_","_CODE Q
"RTN","GMRCSLM",144,0)
 S GMRCSTCK=CODE
"RTN","GMRCSLM",145,0)
 Q
"RTN","GMRCSLM",146,0)
FND(CD) ;status already selected?
"RTN","GMRCSLM",147,0)
 I GMRCSTCK=CD Q 1
"RTN","GMRCSLM",148,0)
 I $F(GMRCSTCK,(CD_",")) Q 1
"RTN","GMRCSLM",149,0)
 I $E(GMRCSTCK,$L(GMRCSTCK))=CD Q 1
"RTN","GMRCSLM",150,0)
 Q 0
"RTN","GMRCSLM",151,0)
END K DIR,GMRCERR,Y
"RTN","GMRCSLM",152,0)
 Q
"RTN","GMRCSLM1")
0^30^B43489370
"RTN","GMRCSLM1",1,0)
GMRCSLM1 ;SLC/DCM - Gather data and format ^TMP global for consult tracking Silent call for use by List Manager and GUI ;9/8/98  03:37
"RTN","GMRCSLM1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCSLM1",3,0)
 ;USING LIST MANAGER.
"RTN","GMRCSLM1",4,0)
 G AD
"RTN","GMRCSLM1",5,0)
SVC(NODE) ;Check for a valid service
"RTN","GMRCSLM1",6,0)
 K GMRCDEAV
"RTN","GMRCSLM1",7,0)
 I '$D(^GMR(123,NODE,0)) Q 0
"RTN","GMRCSLM1",8,0)
 I '+$P(^GMR(123,NODE,0),"^",5) Q 0
"RTN","GMRCSLM1",9,0)
 I '$D(^TMP("GMRCS",$J,$P(^GMR(123,NODE,0),"^",5))) Q 0
"RTN","GMRCSLM1",10,0)
 Q 1
"RTN","GMRCSLM1",11,0)
AD ;Main entry point. Loop through AD x-ref in file 123; Find consults that have been released to requested service
"RTN","GMRCSLM1",12,0)
 ;;DFN and GMRCSSNM must be defined when this entry point is called
"RTN","GMRCSLM1",13,0)
 ;;DFN=Internal File Number of Patient in ^DPT
"RTN","GMRCSLM1",14,0)
 ;;GMRCSSNM=Service Name of a Hospital Service from file ^GMR(123.5
"RTN","GMRCSLM1",15,0)
 ;;If GMRCSSNM is not defined or is null, then no records will be found.
"RTN","GMRCSLM1",16,0)
 ;;GMRCOER must be passed so that proper formatting for GUI or List Manager can be performed.  GMRCOER is passed as 0 for List Manager, 1 for GUI.
"RTN","GMRCSLM1",17,0)
 ;;GMRCDT1 and GMRCDT2 are passed in as start and stop dates for the lookup. If GMRCDT1="" or GMRCDT1="ALL", then all dates are searched.
"RTN","GMRCSLM1",18,0)
 ;;  ***********************************************************
"RTN","GMRCSLM1",19,0)
 K ^TMP("GMRCR",$J,"CS"),GMRCNUL
"RTN","GMRCSLM1",20,0)
 I $D(GMRCSSS) S (GMRCDG,GMRCSS)=GMRCSSS,GMRCSSNM=($P($G(^GMR(123.5,+GMRCSS,0)),"^",1)) D SERV1^GMRCASV K GMRCSSS ;reset after forward
"RTN","GMRCSLM1",21,0)
 S TAB="",$P(TAB," ",41)="",BLK=0,LNCT=1 S:'$D(GMRCOER) GMRCOER=0
"RTN","GMRCSLM1",22,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,"AD",DFN,GMRCD)) Q:'GMRCD  S GMRCDA=0 F  S GMRCDA=$O(^GMR(123,"AD",DFN,GMRCD,GMRCDA)) Q:'GMRCDA  I $$SVC(GMRCDA) D SET
"RTN","GMRCSLM1",23,0)
 D END Q
"RTN","GMRCSLM1",24,0)
SET ;;Format entries into a word processing 'TMP("GMRCR",$J,"CS",' global that List Manager can display
"RTN","GMRCSLM1",25,0)
 ;;GMRCOER is a variable that signals that data is being formatted for the OE/RR GUI; this data is formatted differently than the data for List Manager.
"RTN","GMRCSLM1",26,0)
 ;;GMRCOER=0 : Data is List Manager formatted.
"RTN","GMRCSLM1",27,0)
 ;;GMRCOER=1 : Data is OE/RR GUI formatted.
"RTN","GMRCSLM1",28,0)
 S:'$D(TAB) TAB="",$P(TAB," ",30)=""
"RTN","GMRCSLM1",29,0)
 S GMRCIFN=$G(GMRCDA) I '$L(GMRCIFN),$D(XQADATA) S (GMRCDA,GMRCIFN)=+XQADATA
"RTN","GMRCSLM1",30,0)
 S GMRCSEX=$S($P(^DPT(DFN,0),"^",2)="M":"MALE",1:"FEMALE")
"RTN","GMRCSLM1",31,0)
 I '$D(^GMR(123,+GMRCIFN,0)) S GMRCQUT=1 Q
"RTN","GMRCSLM1",32,0)
 S PROC="",GMRC(0)=^GMR(123,GMRCIFN,0)
"RTN","GMRCSLM1",33,0)
 I $D(GMRCSTCK),GMRCSTCK'="" N STATUS,TITLE D  Q:'STATUS
"RTN","GMRCSLM1",34,0)
 . N I
"RTN","GMRCSLM1",35,0)
 . F I=1:1 S STATUS=$P(GMRCSTCK,",",I) Q:STATUS=$P(GMRC(0),"^",12)  Q:'STATUS
"RTN","GMRCSLM1",36,0)
 . Q
"RTN","GMRCSLM1",37,0)
 I $D(GMRCVP),GMRCVP'=$P(GMRC(0),"^",8) Q
"RTN","GMRCSLM1",38,0)
 S (GMRCFMDT,X)=$P(GMRC(0),"^",7) I GMRCDT1'="ALL",$P(X,".",1)<GMRCDT1!($P(X,".",1)>GMRCDT2) Q
"RTN","GMRCSLM1",39,0)
 S BLK=BLK+1,^TMP("GMRCR",$J,"CS","AD",BLK,LNCT,GMRCDA)=""
"RTN","GMRCSLM1",40,0)
 D REGDTM^GMRCU S CDT=$P(X," ")
"RTN","GMRCSLM1",41,0)
 S PROC=$S($$GET1^DIQ(101,+$P(GMRC(0),U,17),.01)["CONS":"Consult",1:"")
"RTN","GMRCSLM1",42,0)
 I PROC'="Consult" S PROC=$$GET1^DIQ(101,+$P(GMRC(0),"^",8),1)
"RTN","GMRCSLM1",43,0)
 S:PROC="" PROC="Consult"
"RTN","GMRCSLM1",44,0)
 S TO=+$P(GMRC(0),"^",5)
"RTN","GMRCSLM1",45,0)
 I +TO S TOD=$S($P($G(^GMR(123.5,+TO,0)),"^",2)=9:1,1:0)
"RTN","GMRCSLM1",46,0)
 I '$D(TOD) S TOD=0
"RTN","GMRCSLM1",47,0)
 S TO=$S(+TO:$P($G(^GMR(123.5,+TO,0)),"^",1),1:"")
"RTN","GMRCSLM1",48,0)
 S TO=$S(TOD:"<",1:"")_TO
"RTN","GMRCSLM1",49,0)
 S TO=$S(GMRCOER:TO,1:$E(TO,1,40))_$S(TOD:">",1:"")
"RTN","GMRCSLM1",50,0)
 I '$L(TO) S TO="**Unknown Service**"
"RTN","GMRCSLM1",51,0)
 S STS=$P(GMRC(0),"^",12) I +STS,$D(^ORD(100.01,+STS,0)) S:'+GMRCOER STS=$P(^ORD(100.01,+STS,.1),"^",1) I +GMRCOER S STS=$S(GMRCOER=1:$P(^ORD(100.01,+STS,0),"^",1),1:$P(^ORD(100.01,+STS,.1),"^",1))
"RTN","GMRCSLM1",52,0)
 I $S(STS="":1,'$D(^ORD(100.01,+$P(GMRC(0),"^",12),0)):1,1:0) S STS=99,$P(GMRC(0),"^",12)=STS,STS=$S(GMRCOER=1:$P(^ORD(100.01,5,0),"^",1),1:$P(^ORD(100.01,+STS,.1),"^",1))
"RTN","GMRCSLM1",53,0)
 D SERVPROC
"RTN","GMRCSLM1",54,0)
 I 'GMRCOER S ^TMP("GMRCR",$J,"CS",LNCT,0)=BLK_$E(TAB,1,(4-$L(BLK)))_CDT_"  "_$E(STS,1,3)_$S(STS?1A:"  ",STS?2A:" ",1:"")_" "_$J(GMRCDA,7)_" "_$S($P(GMRC(0),"^",19)="Y":"*",1:" ")_TITLE,LNCT=LNCT+1 Q
"RTN","GMRCSLM1",55,0)
 I GMRCOER S ^TMP("GMRCR",$J,"CS",LNCT,0)=GMRCDA_"^"_GMRCFMDT_"^"_STS_"^"_TO_"^"_PROC_"^"_$S($P(GMRC(0),"^",19)="Y":"*",1:"")_"^"_TITLE,LNCT=LNCT+1 K STSOER Q
"RTN","GMRCSLM1",56,0)
 Q
"RTN","GMRCSLM1",57,0)
END I LNCT<2 S (BLK,LNCT,GMRCNUL)=1,GMRCNPM="< PATIENT DOES NOT HAVE ANY CONSULTS/REQUESTS "_$S($D(GMRCPRNM):"FOR "_GMRCPRNM,1:"")_" ON FILE. >",GMRCNPM=$E(TAB,1,(80-$L(GMRCNPM))\80)_GMRCNPM,^TMP("GMRCR",$J,"CS",LNCT,0)=GMRCNPM D
"RTN","GMRCSLM1",58,0)
 .I GMRCDT1'="ALL",$D(GMRCDT1)&($D(GMRCDT2)) S LNCT=LNCT+1,^TMP("GMRCR",$J,"CS",LNCT,0)="Between Dates: "_$$FMTE^XLFDT(GMRCDT1)_" and "_$$FMTE^XLFDT(GMRCDT2)
"RTN","GMRCSLM1",59,0)
 .I $D(GMRCSTCK),$L(GMRCSTCK) S LNCT=LNCT+1,^TMP("GMRCR",$J,"CS",LNCT,0)="With Status: " S STS="" F I=1:1 S STS=$P(GMRCSTCK,",",I) Q:STS=""  S ^TMP("GMRCR",$J,"CS",LNCT,0)=^(0)_$P($G(^ORD(100.01,+STS,0)),"^",1)_" "
"RTN","GMRCSLM1",60,0)
 .Q
"RTN","GMRCSLM1",61,0)
 E  S (BLK,LNCT)=LNCT-1,^TMP("GMRCR",$J,"CS",0)="^^^"_LNCT
"RTN","GMRCSLM1",62,0)
 I $D(GMRCALFL) S (BLK,LNCT)=1
"RTN","GMRCSLM1",63,0)
 K TO,TOD,END,FLG,GMRC(0),GMRCD,GMRCDG,GMRCIFN,GMRCFMDT,GMRCNPM,GMRCWARD,I,PROC,STS,URG
"RTN","GMRCSLM1",64,0)
 Q
"RTN","GMRCSLM1",65,0)
OER(DFN,GMRCDG,GMRCDT1,GMRCDT2,GMRCSTCK,GMRCOER) ;;GUI interface for CPRS
"RTN","GMRCSLM1",66,0)
 ;;DFN=Patient internal file number
"RTN","GMRCSLM1",67,0)
 ;;GMRCDG:  Internal file number of consult service (from file ^GMR(123.5,)
"RTN","GMRCSLM1",68,0)
 ;;GMRCDT1:  Beginning date for lookup
"RTN","GMRCSLM1",69,0)
 ;;GMRCDT2:  Ending date for lookup
"RTN","GMRCSLM1",70,0)
 ;;GMRCSTCK: IEN from OER Status File [^OER(100.01)] to screen results
"RTN","GMRCSLM1",71,0)
 ;;     so that only consults with a desired status are displayed
"RTN","GMRCSLM1",72,0)
 ;;     Can be sent as a set of statuses: i.e., 6,5,2
"RTN","GMRCSLM1",73,0)
 ;;      (GMRCSTCK=GMRC STATUS CHECK)
"RTN","GMRCSLM1",74,0)
 ;;GMRCOER=0 if request is from CONSULTS; GMRCOER=1 if request is for CPRS List Manager, 2 if for CPRS GUI
"RTN","GMRCSLM1",75,0)
 I GMRCDT1="" S GMRCDT1="ALL"
"RTN","GMRCSLM1",76,0)
 I GMRCDG="" S GMRCDG=$O(^GMR(123.5,"B","ALL SERVICES",0))
"RTN","GMRCSLM1",77,0)
 S:'$D(GMRCOER) GMRCOER=1
"RTN","GMRCSLM1",78,0)
 D SERV1^GMRCASV,AD
"RTN","GMRCSLM1",79,0)
 K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCSLM1",80,0)
 Q
"RTN","GMRCSLM1",81,0)
SERVPROC ; Build contents of SERV/PROC field for List Manager
"RTN","GMRCSLM1",82,0)
 S TITLE=""
"RTN","GMRCSLM1",83,0)
 S TYPE=""
"RTN","GMRCSLM1",84,0)
 S OTXT=$P($G(^GMR(123,GMRCDA,1.11)),"^")
"RTN","GMRCSLM1",85,0)
 I OTXT="" D BUILD2
"RTN","GMRCSLM1",86,0)
 I OTXT'="" D BUILD1
"RTN","GMRCSLM1",87,0)
 Q
"RTN","GMRCSLM1",88,0)
BUILD1 ;OTXT does contain information
"RTN","GMRCSLM1",89,0)
 N FLG,BADFLG,TPROC,TTO
"RTN","GMRCSLM1",90,0)
 S TPROC=$$UP^XLFSTR(PROC),TTO=$$UP^XLFSTR(TO)
"RTN","GMRCSLM1",91,0)
 S TITLE=OTXT,OTXT=$$UP^XLFSTR(OTXT)
"RTN","GMRCSLM1",92,0)
 S BADFLG=0
"RTN","GMRCSLM1",93,0)
 I PROC="Consult" S FLG=1,TYPE="Cons"
"RTN","GMRCSLM1",94,0)
 I PROC'="Consult" S FLG=0,TYPE="Proc"
"RTN","GMRCSLM1",95,0)
 S LEN=$L(TITLE)
"RTN","GMRCSLM1",96,0)
 I TO="" S TO="No Service"
"RTN","GMRCSLM1",97,0)
 I LEN<30,FLG=1,OTXT'=TTO S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",98,0)
 I LEN<30,FLG=1,OTXT=TTO S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",99,0)
 I TO["<" S BADFLG=1
"RTN","GMRCSLM1",100,0)
 S ABBRS=$$SVC^GMRCAU(GMRCDA),ABBRP=$$PROC^GMRCAU(GMRCDA)
"RTN","GMRCSLM1",101,0)
 I LEN<30,FLG=0,TPROC'=OTXT,TTO'=TPROC S TITLE=TITLE_" "_PROC_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",102,0)
 I LEN<30,FLG=0,TPROC=OTXT,TTO'=TPROC S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",103,0)
 I LEN<30,FLG=0,TPROC=OTXT,TTO=TPROC S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",104,0)
 I LEN>30,FLG=1,TTO'=OTXT S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",105,0)
 I LEN>30,FLG=1,TTO=OTXT S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",106,0)
 I LEN>30,FLG=0,TPROC'=OTXT,TTO'=TPROC S TITLE=TITLE_" "_ABBRP_" "_TYPE Q
"RTN","GMRCSLM1",107,0)
 I LEN>30,FLG=0,TTO'=OTXT,BADFLG=0 S TITLE=TITLE_" "_ABBRS_" "_TYPE Q
"RTN","GMRCSLM1",108,0)
 I LEN>30,FLG=0,TTO'=OTXT,BADFLG=1 S TITLE=TITLE_" "_"<"_ABBRS_">"_TYPE Q
"RTN","GMRCSLM1",109,0)
 Q
"RTN","GMRCSLM1",110,0)
BUILD2 ;OTXT contains no information
"RTN","GMRCSLM1",111,0)
 N FLG,TPROC,TTO
"RTN","GMRCSLM1",112,0)
 S TPROC=$$UP^XLFSTR(PROC),TTO=$$UP^XLFSTR(TO)
"RTN","GMRCSLM1",113,0)
 I PROC="Consult" S TITLE=TO,LEN=$L(TITLE),FLG=1,TYPE="Cons"
"RTN","GMRCSLM1",114,0)
 I PROC'="Consult" S TITLE=PROC,LEN=$L(TITLE),FLG=0,TYPE="Proc"
"RTN","GMRCSLM1",115,0)
 I FLG=1 S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",116,0)
 I FLG=0,TTO=TPROC S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",117,0)
 I FLG=0,TTO'=TPROC S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",118,0)
 Q
"RTN","GMRCSLM2")
0^22^B39147567
"RTN","GMRCSLM2",1,0)
GMRCSLM2 ;SLC/DCM - List Manager routine - Detailed consult display and printing ;7/16/98  02:00
"RTN","GMRCSLM2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27,1997
"RTN","GMRCSLM2",3,0)
DT(GMRCO) ;;Entry point to set-up detailed display.
"RTN","GMRCSLM2",4,0)
 ;;Pass in GMRCO as +GMRCO - a number only. GMRCO=IEN from of consult from file 123
"RTN","GMRCSLM2",5,0)
 ;;Results are placed in ^TMP("GMRCR",$J,"DT",
"RTN","GMRCSLM2",6,0)
 ;;Pass in variable GMRCOER=2 if calling from the GUI, GMRCOER=1 if call is from CPRS consults tab
"RTN","GMRCSLM2",7,0)
 ;;Pass in variable GMRCOER=0 (or as <UNDEFINED>) if call is from consults routines
"RTN","GMRCSLM2",8,0)
 K GMRCQUT
"RTN","GMRCSLM2",9,0)
 N DFN,GMRCD,GMRCDA,ORIFN,GMRCSF S GMRCDVDL="",$P(GMRCDVDL,"-",80)=""
"RTN","GMRCSLM2",10,0)
 I $S('GMRCO:1,'$D(^GMR(123,+GMRCO,0)):1,1:0) D:$S('$D(GMRCOER):1,'GMRCOER:1,1:0)  S GMRCQUT=1 Q
"RTN","GMRCSLM2",11,0)
 .S GMRCMSG="The consult entry selected for the Detailed Display is unknown." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG
"RTN","GMRCSLM2",12,0)
 .Q
"RTN","GMRCSLM2",13,0)
 K ^TMP("GMRCR",$J,"DT") S TAB="",$P(TAB," ",30)="",GMRCCT=1
"RTN","GMRCSLM2",14,0)
 S GMRCO(0)=^GMR(123,+GMRCO,0),ORIFN=$P(GMRCO(0),"^",3),DFN=$P(GMRCO(0),"^",2)
"RTN","GMRCSLM2",15,0)
 S X="SDUTL3" X ^%ZOSF("TEST") I  D
"RTN","GMRCSLM2",16,0)
 .N PR S PR=$$OUTPTPR^SDUTL3(DFN) I $L(PR) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current PC Provider:   "_$P(PR,"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",17,0)
 .S PR=$$OUTPTTM^SDUTL3(DFN) I $L(PR) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current PC Team:       "_$P(PR,"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",18,0)
 .Q
"RTN","GMRCSLM2",19,0)
 N VAIN,VAEL
"RTN","GMRCSLM2",20,0)
 D INP^VADPT S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current Pat. Status:   "_$S(+VAIN(8):"Inpatient",1:"Outpatient"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",21,0)
 I $D(VAIN(4)),$L($P(VAIN(4),"^",2)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Ward:"_$E(TAB,1,18)_$P(VAIN(4),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",22,0)
 D ELIG^VADPT
"RTN","GMRCSLM2",23,0)
 I $L($P(VAEL(6),"^",2)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Eligibility:"_$E(TAB,1,11)_$P(VAEL(6),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",24,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",25,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Order Information",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",26,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="To Service:"_$E(TAB,1,12)_$P($G(^GMR(123.5,+$P(GMRCO(0),"^",5),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",27,0)
 I $P(GMRCO(0),"^",11) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Attention:"_$E(TAB,1,13)_$P($G(^VA(200,$P(GMRCO(0),"^",11),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",28,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="From Service:"_$E(TAB,1,10)_$P($G(^SC(+$P(GMRCO(0),"^",6),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",29,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Requesting Provider: "_$E(TAB,1,2)_$S($P(GMRCO(0),"^",14)]"":$P($G(^VA(200,$P(GMRCO(0),"^",14),0)),"^",1),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",30,0)
 I $L($P(GMRCO(0),"^",18)) D
"RTN","GMRCSLM2",31,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Service is to be rendered on an "_$S($P(GMRCO(0),"^",18)="I":"INPATIENT",1:"OUTPATIENT")_" basis",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",32,0)
 .Q
"RTN","GMRCSLM2",33,0)
 I $P(GMRCO(0),"^",10) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Place:"_$E(TAB,1,17)_$P($G(^ORD(101,+$P(GMRCO(0),"^",10),0)),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",34,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Urgency:"_$E(TAB,1,15)_$S($L($P(GMRCO(0),"^",9)):$P($G(^ORD(101,+$P(GMRCO(0),"^",9),0)),"^",2),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",35,0)
 S X="ORX8" X ^%ZOSF("TEST") I  D
"RTN","GMRCSLM2",36,0)
 .S GMRCOITM=$$OI^ORX8(ORIFN)
"RTN","GMRCSLM2",37,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Orderable Item:"_$E(TAB,1,8)_$P(GMRCOITM,U,2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",38,0)
 .Q
"RTN","GMRCSLM2",39,0)
 S GMRCPRNM=$P(GMRCO(0),"^",8),GMRCPROC=$S(+GMRCPRNM:$P($G(^ORD(101,+GMRCPRNM,0)),"^",2),1:"Consult Request")
"RTN","GMRCSLM2",40,0)
 I $L(GMRCPROC) D
"RTN","GMRCSLM2",41,0)
 .S GMRCTYPE=$S(+$P(GMRCO(0),"^",17):$P(^ORD(101,+$P(GMRCO(0),"^",17),0),"^"),1:"")
"RTN","GMRCSLM2",42,0)
 .S GMRCTYPE=$S(GMRCTYPE="GMRCOR REQUEST":"Procedure",1:"Request Type")
"RTN","GMRCSLM2",43,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCTYPE_":"_$E(TAB,1,22-$L(GMRCTYPE))_GMRCPROC,GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",44,0)
 .Q
"RTN","GMRCSLM2",45,0)
 S GMRCD=$G(^GMR(123,+GMRCO,30)) I $L(GMRCD) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Provisional Diagnosis: "_GMRCD,GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",46,0)
 I $D(^GMR(123,+GMRCO,20,0)) D
"RTN","GMRCSLM2",47,0)
 .I $O(^GMR(123,+GMRCO,20,1)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Reason For Request:",GMRCCT=GMRCCT+1 D  Q
"RTN","GMRCSLM2",48,0)
 ..S LN=0 F  S LN=$O(^GMR(123,+GMRCO,20,LN)) Q:LN=""  S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^(LN,0),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",49,0)
 ..Q
"RTN","GMRCSLM2",50,0)
 .S FLG=1,LINE="Reason For Request:"_$E(TAB,1,4) D WPSET^GMRCUTIL("^GMR(123,+GMRCO,20)","^TMP(""GMRCR"",$J,""DT"")",LINE,.GMRCCT,TAB,FLG)
"RTN","GMRCSLM2",51,0)
 .Q
"RTN","GMRCSLM2",52,0)
 S GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"DT",GMRCCT,0)=" ",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",53,0)
 ;get status, last action, and significant findings
"RTN","GMRCSLM2",54,0)
 S STS=$P(GMRCO(0),"^",12),^TMP("GMRCR",$J,"DT",GMRCCT,0)="Status:  "_$E(TAB,1,14)_$S($D(^ORD(100.01,+STS,0)):$P(^(0),"^",1),1:$P(^ORD(100.01,6,0),"^",1)),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",55,0)
 S GMRCA=$P(^GMR(123,+GMRCO,0),"^",13),^TMP("GMRCR",$J,"DT",GMRCCT,0)="Last Action:"_$E(TAB,1,11)_$S(+GMRCA:$P($G(^GMR(123.1,GMRCA,0)),"^",1),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",56,0)
 I $L($P(GMRCO(0),"^",19)) D
"RTN","GMRCSLM2",57,0)
 .S GMRCSF=$P(GMRCO(0),"^",19)
"RTN","GMRCSLM2",58,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Significant Findings:  "_$S(GMRCSF="Y":"YES",GMRCSF="N":"NO",1:"Unknown")
"RTN","GMRCSLM2",59,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",60,0)
 .Q
"RTN","GMRCSLM2",61,0)
 D ACTLOG^GMRCSLM4(+GMRCO)
"RTN","GMRCSLM2",62,0)
 D GETRSLTS^GMRCTIUP(GMRCO,.GMRCAR) ;GMRCAR=Array results from TIU and Medicine Package is returned in
"RTN","GMRCSLM2",63,0)
 I $O(GMRCAR(0)) S GMRCND=0 F  S GMRCND=$O(GMRCAR(GMRCND)) Q:GMRCND=""  D
"RTN","GMRCSLM2",64,0)
 .I $E($P(GMRCND,";",2),1,4)="MCAR" S GMRCSR=GMRCND D  Q
"RTN","GMRCSLM2",65,0)
 ..S MCFILE=$P(GMRCSR,";",2),MCFILE=$P(MCFILE,","),MCPROC=$O(^MCAR(697.2,"C",MCFILE,"")) Q:'MCPROC  S GMRCPRNM=$P(^MCAR(697.2,MCPROC,0),"^",8)
"RTN","GMRCSLM2",66,0)
 ..D EN^GMRCSLM3(+GMRCO,GMRCSR,.GMRCCT)
"RTN","GMRCSLM2",67,0)
 ..S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",68,0)
 ..Q
"RTN","GMRCSLM2",69,0)
 .I $E($P(GMRCND,";",2),1,3)="TIU" S DR=".01;.05;.09;1201;1202;1204;1208;1302;1501",GMRCTUFN=$P(GMRCND,";",1) D
"RTN","GMRCSLM2",70,0)
 ..S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",71,0)
 ..D EXTRACT^TIULQ(GMRCTUFN,"LOCAL",.GMRCERR,DR)
"RTN","GMRCSLM2",72,0)
 ..I '$O(LOCAL("")) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="No TIU results exist for Note # "_GMRCTUFN_".",GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"DT",GMRCCT,0)="The Note has been DELETED from TIU!!",GMRCCT=GMRCCT+1 Q
"RTN","GMRCSLM2",73,0)
 ..; I '$L($G(LOCAL(GMRCTUFN,1501,"E"))) D TIU^GMRCSLMU(GMRCTUFN,.GMRCCT,.LOCAL) K LOCAL Q
"RTN","GMRCSLM2",74,0)
 ..K GMRCCNM
"RTN","GMRCSLM2",75,0)
 ..S GMRCTUFN=$P(GMRCND,";",1)
"RTN","GMRCSLM2",76,0)
 ..S:$L(LOCAL(GMRCTUFN,.01,"E")) GMRCCNM=LOCAL(GMRCTUFN,.01,"E"),^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"-",80-$L(GMRCCNM)\2)="",^(0)=^(0)_" "_GMRCCNM_" "_^(0),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",77,0)
 ..K LOCAL
"RTN","GMRCSLM2",78,0)
 ..D DSPLAY^GMRCTIU(GMRCTUFN,.GMRCCT)
"RTN","GMRCSLM2",79,0)
 ..S GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",80,0)
 ..K DR
"RTN","GMRCSLM2",81,0)
 ..Q
"RTN","GMRCSLM2",82,0)
 .Q
"RTN","GMRCSLM2",83,0)
 I $S('$D(GMRCOER):1,'GMRCOER:1,1:0),$D(VALMAR) D CLEAN^VALM10
"RTN","GMRCSLM2",84,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"=",80)="",^(0)=$E(^(0),1,36)_" END "_$E(^(0),43,80)
"RTN","GMRCSLM2",85,0)
DTQ K X,LN,PL,TO,WP,FLG,SEX,STS,URG,WRD,BKLN,DATA,WRD,PROC,LINE,GMRC(0),GMRC(40),GMRCD,GMRCDVDL,GMRCO,GMRCAR,GMRCRB,GMRCLA,GMRCSR,GMRCTO,MCFILE,MCPROC,DSPLINE,GMRCLA1,GMRCPRNM,GMRCPROC,GMRCTYPE,GMRCWARD
"RTN","GMRCSLM2",86,0)
 I $D(GMRCOER),'GMRCOER D:$D(VALMEVL) KILL^VALM10() D:$D(VALMAR) CLEAN^VALM10
"RTN","GMRCSLM2",87,0)
 Q
"RTN","GMRCSLM3")
0^23^B20107255
"RTN","GMRCSLM3",1,0)
GMRCSLM3 ;SLC/DCM - Extract medicine results for consult tracking ;7/16/98  02:01
"RTN","GMRCSLM3",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCSLM3",3,0)
EN(GMRCSEL,GMRCSR,COUNT) ;;This entry point is used to collect consult data from the Medicine Package.
"RTN","GMRCSLM3",4,0)
 ;GMRCSR="^MCAR(x," file IEN where result to associate is stored 
"RTN","GMRCSLM3",5,0)
 ;in $P(^GMR(123,IEN,0),"^",15)
"RTN","GMRCSLM3",6,0)
 ;                1=Called from RT^GMRCA1 or DT^GMRCSLM2 routine
"RTN","GMRCSLM3",7,0)
 ;Consult/Request Tracking
"RTN","GMRCSLM3",8,0)
 ;GMRCSEL: The IEN of the consult from file 123.
"RTN","GMRCSLM3",9,0)
 ;COUNT:   The current position in ^TMP where data is to be placed.
"RTN","GMRCSLM3",10,0)
 D ENDT,EXIT Q
"RTN","GMRCSLM3",11,0)
 ;
"RTN","GMRCSLM3",12,0)
ENDT Q:'$D(GMRCSEL)  Q:'$D(GMRCSEL)
"RTN","GMRCSLM3",13,0)
 S ORIFN=$P(^GMR(123,GMRCSEL,0),"^",3),ORACTION=8
"RTN","GMRCSLM3",14,0)
 S ^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCSLM3",15,0)
 S X="MCOR" X ^%ZOSF("TEST") I '$T S ^TMP("GMRCR",$J,"DT",COUNT,0)="Medicine package not installed.  Online results are not available.",COUNT=COUNT+1
"RTN","GMRCSLM3",16,0)
 I 'GMRCSR S ^TMP("GMRCR",$J,"DT",COUNT,0)="No Medicine results are available for review",COUNT=COUNT+1 Q
"RTN","GMRCSLM3",17,0)
 S GMRCRTIT=$G(GMRCPRNM)_" SUMMARY REPORT",GMRCH="",$P(GMRCH,"-",(77-$L(GMRCRTIT))\2)="",^TMP("GMRCR",$J,"DT",COUNT,0)=GMRCH_" "_GMRCRTIT_" "_GMRCH,COUNT=COUNT+1,^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCSLM3",18,0)
 D PRINT^MCOR I '$D(^TMP("MC",$J)) S ^TMP("GMRCR",$J,"DT",COUNT,0)="No results are available for review.",COUNT=COUNT+1
"RTN","GMRCSLM3",19,0)
 ;GMRCFT=Field Type of D (Diagnosis, I (Indications), S (Summary)
"RTN","GMRCSLM3",20,0)
SET S GMRCFT="D" I $D(^TMP("MC",$J,"D")) S ^TMP("GMRCR",$J,"DT",COUNT,0)=$E(TAB,1,34)_"DIAGNOSIS",COUNT=COUNT+1 D SETFLD
"RTN","GMRCSLM3",21,0)
 S GMRCFT="I" I $D(^TMP("MC",$J,"I")) S ^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1,^TMP("GMRCR",$J,"DT",COUNT,0)="INDICATIONS:",COUNT=COUNT+1 D SETFLD
"RTN","GMRCSLM3",22,0)
 I $D(^TMP("MC",$J,"S")) D SUM
"RTN","GMRCSLM3",23,0)
 Q
"RTN","GMRCSLM3",24,0)
EXIT K GMRCH,GMRCX,GMRCFT,GMRCFLD,GMRCSUM,GMRCFLDN,GMRCSUMP,GMRCRTIT,GMRCPRNM,GMRCFLDP,MCC,MCK,MCMFLD,MCMUP
"RTN","GMRCSLM3",25,0)
 K ^TMP("MC",$J)
"RTN","GMRCSLM3",26,0)
 Q
"RTN","GMRCSLM3",27,0)
SETFLD S GMRCFLD=0,GMRCFLDP="" F  S GMRCFLD=$O(^TMP("MC",$J,GMRCFT,GMRCFLD)) Q:GMRCFLD=""  S GMRCFLD(0)=^(GMRCFLD) D
"RTN","GMRCSLM3",28,0)
 .S GMRCFLDN=$P(GMRCFLD(0),"^",2) Q:GMRCFLDN[";W"
"RTN","GMRCSLM3",29,0)
 .I GMRCFLDP=GMRCFLDN S COUNT=COUNT-1,^TMP("GMRCR",$J,"DT",COUNT,0)=^TMP("GMRCR",$J,"DT",COUNT,0)_", "
"RTN","GMRCSLM3",30,0)
 .E  S GMRCFLDP=GMRCFLDN,^TMP("GMRCR",$J,"DT",COUNT,0)=GMRCFLDP_":"_$E(TAB,1,18-$L(GMRCFLDP))
"RTN","GMRCSLM3",31,0)
 .I $L($P(GMRCFLD(0),"^",1))>45 S ^TMP("GMRCR",$J,"DT",COUNT,0)=^TMP("GMRCR",$J,"DT",COUNT,0)_$P(GMRCFLD(0),"^",1),COUNT=COUNT+1 Q
"RTN","GMRCSLM3",32,0)
 .I $L($P(GMRCFLD(0),"^",1))'>77 S ^TMP("GMRCR",$J,"DT",COUNT,0)=^TMP("GMRCR",$J,"DT",COUNT,0)_$P(GMRCFLD(0),"^",1)
"RTN","GMRCSLM3",33,0)
 .S COUNT=COUNT+1 Q
"RTN","GMRCSLM3",34,0)
 Q
"RTN","GMRCSLM3",35,0)
SUM ;
"RTN","GMRCSLM3",36,0)
 S GMRCSUM=$P(^TMP("MC",$J,"S"),"^",1),GMRCSUMP=$P(^TMP("MC",$J,"S"),"^",2)
"RTN","GMRCSLM3",37,0)
 I $L(GMRCSUM)!($L(GMRCSUMP)) S ^TMP("GMRCR",$J,"DT",COUNT,0)="SUMMARY:"
"RTN","GMRCSLM3",38,0)
 I $L(GMRCSUM) S ^TMP("GMRCR",$J,"DT",COUNT,0)=^TMP("GMRCR",$J,"DT",COUNT,0)_$E(TAB,1,11)_GMRCSUM,COUNT=COUNT+1
"RTN","GMRCSLM3",39,0)
 I $L(GMRCSUMP) S ^TMP("GMRCR",$J,"DT",COUNT,0)="SUMMARY PROCEDURE: "_GMRCSUMP,COUNT=COUNT+1
"RTN","GMRCSLM3",40,0)
 Q
"RTN","GMRCSLM3",41,0)
AREN(GMRCSEL,GMRCSR) ;Entry point for display of Medicine Results when associating a result with a consult - List Manager display set-up.
"RTN","GMRCSLM3",42,0)
 ;GMRCSR=^MCAR(191, file IEN where result to associate is stored
"RTN","GMRCSLM3",43,0)
 ;GMRCSEL=File ^GMR(123, IEN of consult to associate with medicine result
"RTN","GMRCSLM3",44,0)
 S COUNT=1,TAB="",TAB=$P(TAB," ",30)
"RTN","GMRCSLM3",45,0)
 S X="MCOR" X ^%ZOSF("TEST") I '$T S ^TMP("GMRCR",$J,"DT",COUNT,0)="Medicine Package is not installed. Online results are not available.",COUNT=COUNT+1 G END
"RTN","GMRCSLM3",46,0)
 I 'GMRCSR S ^TMP("GMRCR",$J,"DT",COUNT,0)="No Medicine results are available for review.",COUNT=COUNT+1
"RTN","GMRCSLM3",47,0)
 S ORIFN=$P(^GMR(123,GMRCSEL,0),"^",3),ORACTION=8
"RTN","GMRCSLM3",48,0)
 S GMRCPRNM=$P(^GMR(123,GMRCSEL,0),"^",8),GMRCPRNM="^"_$P(GMRCPRNM,";",2)_$P(GMRCPRNM,";",1)_",0)",GMRCPRNM=$P(@(GMRCPRNM),"^",2) I GMRCPRNM?1A.L S GMRCPRNM=$TR(GMRCPRNM,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMRCSLM3",49,0)
 I +GMRCSR D PRINT^MCOR I $D(^TMP("MC",$J)) S ^TMP("GMRCR",$J,"DT",COUNT,0)=TAB_"MEDICINE RESULTS",COUNT=COUNT+1,^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1 D SET
"RTN","GMRCSLM3",50,0)
 S ^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCSLM3",51,0)
END S GMRCCT=COUNT-1
"RTN","GMRCSLM3",52,0)
 K COUNT,GMRCH,GMRCFT,GMRCFLD,GMRCSUM,GMRCFLDN,GMRCSUMP,GMRCRTIT,GMRCPRNM,GMRCFLDP,MCC,MCK,MCMFLD,MCMUP
"RTN","GMRCSLM3",53,0)
 K ^TMP("MC",$J)
"RTN","GMRCSLM3",54,0)
 Q
"RTN","GMRCSLM4")
0^24^B19847518
"RTN","GMRCSLM4",1,0)
GMRCSLM4 ;SLC/DCM - List Manager routine - Activity Log Detailed Display ;1/28/99 10:30
"RTN","GMRCSLM4",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27,1997
"RTN","GMRCSLM4",3,0)
ACTLOG(GMRCO) ;Print activity log
"RTN","GMRCSLM4",4,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",5,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Activity"_$E(TAB,1,17)_"Date/Time"_$E(TAB,1,6)_"Responsible Clin"_$E(TAB,1,4)_"Entered By",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",6,0)
 N GMRCD,GMRCDA
"RTN","GMRCSLM4",7,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDA="" F  S GMRCDA=$O(^GMR(123,+GMRCO,40,"B",GMRCD,GMRCDA)) Q:'GMRCDA  D BLDALN(GMRCO,GMRCDA)
"RTN","GMRCSLM4",8,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",9,0)
 Q
"RTN","GMRCSLM4",10,0)
 ;
"RTN","GMRCSLM4",11,0)
BLDALN(GMRCO,GMRCDA) ;Build Activity Log Lines for an activity
"RTN","GMRCSLM4",12,0)
 ; GMRCO=  consult internal entry number
"RTN","GMRCSLM4",13,0)
 ; GMRCDA= activity internal entry number
"RTN","GMRCSLM4",14,0)
 N GMRCACT,GMRCSLN,XDT1,XDT2,FLG,LN,LINE,DASH,X,GMRCX,GMRCDEV
"RTN","GMRCSLM4",15,0)
 S GMRCDA(0)=^GMR(123,+GMRCO,40,GMRCDA,0)
"RTN","GMRCSLM4",16,0)
 S GMRCACT=$P(GMRCDA(0),"^",2)
"RTN","GMRCSLM4",17,0)
 D BLDLN1
"RTN","GMRCSLM4",18,0)
 D BLDLN2
"RTN","GMRCSLM4",19,0)
 D BLDCMTS
"RTN","GMRCSLM4",20,0)
 Q
"RTN","GMRCSLM4",21,0)
 ;
"RTN","GMRCSLM4",22,0)
BLDLN1 ;Build the first line for the activity
"RTN","GMRCSLM4",23,0)
 ;GMRCX is scratch pad variable
"RTN","GMRCSLM4",24,0)
 S GMRCX=$P($G(^GMR(123.1,+GMRCACT,0)),"^",1)
"RTN","GMRCSLM4",25,0)
 S:'$L(GMRCX) GMRCX=GMRCACT_" action?"
"RTN","GMRCSLM4",26,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCX
"RTN","GMRCSLM4",27,0)
 ;
"RTN","GMRCSLM4",28,0)
 ;Add to line for Printed to (action 22) when device name <13 characters
"RTN","GMRCSLM4",29,0)
 I GMRCACT=22 D
"RTN","GMRCSLM4",30,0)
 . N ION,IOP,%ZIS,POP
"RTN","GMRCSLM4",31,0)
 . S IOP="`"_+$P(GMRCDA(0),"^",8)
"RTN","GMRCSLM4",32,0)
 . S %ZIS="N" D ^%ZIS S GMRCDEV=ION
"RTN","GMRCSLM4",33,0)
 . D HOME^%ZIS
"RTN","GMRCSLM4",34,0)
 . I '$L(GMRCDEV) S GMRCDEV=$P(GMRCDA(0),"^",8)
"RTN","GMRCSLM4",35,0)
 . I $L(GMRCDEV)<13 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_" "_GMRCDEV K GMRCDEV
"RTN","GMRCSLM4",36,0)
 ;
"RTN","GMRCSLM4",37,0)
 ;Add on generic fields that apply to every activity
"RTN","GMRCSLM4",38,0)
 ;Date/time of Actual Activity, Who's Responsible for Activity,
"RTN","GMRCSLM4",39,0)
 ;and Who entered activity
"RTN","GMRCSLM4",40,0)
 S X=$P(GMRCDA(0),"^",3) D REGDTM^GMRCU S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$S($D(^TMP("GMRCR",$J,"DT",GMRCCT,0)):^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,25-$L(^(0)))_X,1:X)
"RTN","GMRCSLM4",41,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,40-$L(^(0)))_$S($P(GMRCDA(0),"^",4):$E($P($G(^VA(200,$P(GMRCDA(0),"^",4),0)),"^"),1,18),1:$E(TAB,1,19))
"RTN","GMRCSLM4",42,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,60-$L(^(0)))_$S($P(GMRCDA(0),"^",5):$E($P($G(^VA(200,$P(GMRCDA(0),"^",5),0)),"^"),1,19),1:$E(TAB,1,19))
"RTN","GMRCSLM4",43,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",44,0)
 Q
"RTN","GMRCSLM4",45,0)
 ;
"RTN","GMRCSLM4",46,0)
BLDLN2 ;SECOND line for activity
"RTN","GMRCSLM4",47,0)
 ;Get Incomplete Report and Complete result # for second line of action
"RTN","GMRCSLM4",48,0)
 N GMRCSLN S GMRCSLN="" ;saved SECOND line
"RTN","GMRCSLM4",49,0)
 I +$P(GMRCDA(0),"^",9) D
"RTN","GMRCSLM4",50,0)
 . S GMRCSLN=$E(TAB,1,5)_"Note# "_+$P(GMRCDA(0),"^",9)
"RTN","GMRCSLM4",51,0)
 ;
"RTN","GMRCSLM4",52,0)
 ;If GMRCDEV is defined, than print the device name on the second line
"RTN","GMRCSLM4",53,0)
 I GMRCACT=22,$D(GMRCDEV) D
"RTN","GMRCSLM4",54,0)
 . S GMRCSLN=$E(TAB,1,5)_$E(GMRCDEV,1,17) K GMRCDEV
"RTN","GMRCSLM4",55,0)
 ;
"RTN","GMRCSLM4",56,0)
 ;Build line for forwarded to (action 17)
"RTN","GMRCSLM4",57,0)
 I GMRCACT=17 D
"RTN","GMRCSLM4",58,0)
 . S GMRCX=$P($G(^GMR(123.5,+$P(GMRCDA(0),"^",6),0)),"^")
"RTN","GMRCSLM4",59,0)
 . S:'$L(GMRCX) GMRCX=$P(GMRCDA(0),"^",6)_" ??"
"RTN","GMRCSLM4",60,0)
 . S GMRCSLN=$E(TAB,1,5)_GMRCX
"RTN","GMRCSLM4",61,0)
 ;
"RTN","GMRCSLM4",62,0)
 ; Check if the entry date and specified actual date are different
"RTN","GMRCSLM4",63,0)
 S XDT1=$P(GMRCDA(0),"^",1),XDT2=$P(GMRCDA(0),"^",3),GMRCX=0
"RTN","GMRCSLM4",64,0)
 S:XDT2>XDT1 X=XDT1,XDT1=XDT2,XDT2=X
"RTN","GMRCSLM4",65,0)
 S GMRCDIF=$$FMDIFF^XLFDT(XDT1,XDT2,3)
"RTN","GMRCSLM4",66,0)
 I $L(GMRCDIF) D
"RTN","GMRCSLM4",67,0)
 . I +$P(GMRCDIF," ",1)>0 S GMRCX=1 Q  ;Check Days
"RTN","GMRCSLM4",68,0)
 . S GMRCDIF=$P(GMRCDIF," ",2)
"RTN","GMRCSLM4",69,0)
 . I +$P(GMRCDIF,":",1)>0 S GMRCX=1 Q  ;Check Hours
"RTN","GMRCSLM4",70,0)
 . I +$P(GMRCDIF,":",2)>1 S GMRCX=1 Q  ;Check Minutes
"RTN","GMRCSLM4",71,0)
 . Q
"RTN","GMRCSLM4",72,0)
 I GMRCX D
"RTN","GMRCSLM4",73,0)
 . S X=$P(GMRCDA(0),"^",1) D REGDTM^GMRCU
"RTN","GMRCSLM4",74,0)
 . S GMRCSLN=$E(GMRCSLN_TAB,1,25)_X_" (entered)"
"RTN","GMRCSLM4",75,0)
 . Q
"RTN","GMRCSLM4",76,0)
 ;
"RTN","GMRCSLM4",77,0)
 I $L(GMRCSLN) D
"RTN","GMRCSLM4",78,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCSLN
"RTN","GMRCSLM4",79,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",80,0)
 . Q
"RTN","GMRCSLM4",81,0)
 Q
"RTN","GMRCSLM4",82,0)
 ;
"RTN","GMRCSLM4",83,0)
BLDCMTS ;Build lines for Comment activity.
"RTN","GMRCSLM4",84,0)
 I GMRCACT=11 D BLDCMT Q
"RTN","GMRCSLM4",85,0)
 ;
"RTN","GMRCSLM4",86,0)
 ;Build lines for general comments on any activity
"RTN","GMRCSLM4",87,0)
 I $D(^GMR(123,+GMRCO,40,+GMRCDA,1)) D  Q
"RTN","GMRCSLM4",88,0)
 . S LN=$O(^GMR(123,+GMRCO,40,+GMRCDA,1,0)) Q:'+LN
"RTN","GMRCSLM4",89,0)
 . ;Check for edited fields generated text with lines <75 characters
"RTN","GMRCSLM4",90,0)
 . I $G(^GMR(123,+GMRCO,40,+GMRCDA,1,LN,0))["EDITED FIELDS" D BLDCMT Q
"RTN","GMRCSLM4",91,0)
 . D BLDCMT
"RTN","GMRCSLM4",92,0)
 . Q
"RTN","GMRCSLM4",93,0)
 . I $L($G(^GMR(123,+GMRCO,40,+GMRCDA,1,LN,0)))'>75 D BLDCMT Q
"RTN","GMRCSLM4",94,0)
 . ;Use utilities for long line formating
"RTN","GMRCSLM4",95,0)
 . S FLG=1,LINE="     "
"RTN","GMRCSLM4",96,0)
 . D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDA,1)","^TMP(""GMRCR"",$J,""DT"")",LINE,.GMRCCT,TAB,FLG)
"RTN","GMRCSLM4",97,0)
 . D BLDASH
"RTN","GMRCSLM4",98,0)
 . Q
"RTN","GMRCSLM4",99,0)
 Q
"RTN","GMRCSLM4",100,0)
 ;
"RTN","GMRCSLM4",101,0)
BLDCMT ;Build comment lines
"RTN","GMRCSLM4",102,0)
 ;DASH is 1 or "" for print dash line after comment
"RTN","GMRCSLM4",103,0)
 S LN=0
"RTN","GMRCSLM4",104,0)
 F  S LN=$O(^GMR(123,+GMRCO,40,+GMRCDA,1,LN)) Q:'+LN  D
"RTN","GMRCSLM4",105,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^GMR(123,+GMRCO,40,GMRCDA,1,LN,0) ;$P(^GMR(123,+GMRCO,40,GMRCDA,1,LN,0),"^",1)
"RTN","GMRCSLM4",106,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",107,0)
 . Q
"RTN","GMRCSLM4",108,0)
 ;D BLDASH
"RTN","GMRCSLM4",109,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",110,0)
 Q
"RTN","GMRCSLM4",111,0)
 ;
"RTN","GMRCSLM4",112,0)
BLDASH ;Build separater line with dashes
"RTN","GMRCSLM4",113,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",114,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",115,0)
 Q
"RTN","GMRCSLMA")
0^46^B13215523
"RTN","GMRCSLMA",1,0)
GMRCSLMA ;SLC/DLT - List Manager protocol entry, exit actions ;9/8/98  03:34
"RTN","GMRCSLMA",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCSLMA",3,0)
 ;Variables used in entry and exit actions
"RTN","GMRCSLMA",4,0)
 ; GMRCALFL is 1 flags the action is executing from an alert
"RTN","GMRCSLMA",5,0)
 ;        set logic is GMRCALFL=$S($D(XQAID)&($D(XQADATA):1,1:0)
"RTN","GMRCSLMA",6,0)
 ; VALMBCK="R" to refresh screen
"RTN","GMRCSLMA",7,0)
 ;        =NULL to clear bottom portion of screen and prompt for action
"RTN","GMRCSLMA",8,0)
 ;        =Q to exit List manager
"RTN","GMRCSLMA",9,0)
 ; GMRC("NMBR") = the currently highlighed entry in the list
"RTN","GMRCSLMA",10,0)
 ; BLK=
"RTN","GMRCSLMA",11,0)
 ; LNCT= Set to 1 if the GMRCALFL flag is 1
"RTN","GMRCSLMA",12,0)
 ; GMRCQUT= if defined than exit list manager?
"RTN","GMRCSLMA",13,0)
 ; GMRCEN = defined if branched to date range prompt by EN^GMRCSLM
"RTN","GMRCSLMA",14,0)
 ; GMRCOER= used to indicate whether CPRS or consults initiated action
"RTN","GMRCSLMA",15,0)
 ;         0 for Consults List Manager
"RTN","GMRCSLMA",16,0)
 ;         1 for GUI
"RTN","GMRCSLMA",17,0)
 ;         2 for CPRS Consults tab to Detailed Display
"RTN","GMRCSLMA",18,0)
 ; ^TMP("GMRC",$J,"CURRENT","MENU"))= the action menu for user
"RTN","GMRCSLMA",19,0)
 ;        based on the service by EN^GMRCMENU
"RTN","GMRCSLMA",20,0)
 ;Entry points called:
"RTN","GMRCSLMA",21,0)
 ;  AD^GMRCSLM1  ;Loop through AD cross-reference doing SET
"RTN","GMRCSLMA",22,0)
 ;  SET^GMRCSLM1 ;Format entries into ^TMP("GMRCR",$J,"CS"
"RTN","GMRCSLMA",23,0)
 ;  INIT^GMRCSLM ;Initialize variables and list array
"RTN","GMRCSLMA",24,0)
 ;  END^GMRCSLM1 ;Resets BLK and LNCT and kills variables
"RTN","GMRCSLMA",25,0)
 ;  HDR^GMRCSLM  ;Reset the VALMHDR values
"RTN","GMRCSLMA",26,0)
 ;  AGAIN^GMRCSLMV(GMRC("NMBR")) ;Reset the video attribute only, do not redisplay
"RTN","GMRCSLMA",27,0)
 ;  RESET^GMRCSLMV(GMRC("NMBR")) ;turn reverse video off when another item is selected
"RTN","GMRCSLMA",28,0)
 ;
"RTN","GMRCSLMA",29,0)
ENTRY(TYPE) ; -- Entry action for list manager actions
"RTN","GMRCSLMA",30,0)
 ;Actions: RT,DT
"RTN","GMRCSLMA",31,0)
 ;TYPE="" when the list and header have no change
"RTN","GMRCSLMA",32,0)
 ;TYPE["L"
"RTN","GMRCSLMA",33,0)
 ;    Assumes Rebuild the list due to change in the list information
"RTN","GMRCSLMA",34,0)
 ;    Use for GMRCACT CANCEL REQUEST, GMRCACT DISCONTINUE
"RTN","GMRCSLMA",35,0)
 ;            GMRCACT COMPLETE
"RTN","GMRCSLMA",36,0)
 ;TYPE["H"
"RTN","GMRCSLMA",37,0)
 ;    Assumes need to rebuild the header too due to change in the list
"RTN","GMRCSLMA",38,0)
 ;        manager used while processing the action
"RTN","GMRCSLMA",39,0)
 ;    Use for GMRCACT COMPLETE, DD, RT, since it goes to TIU
"RTN","GMRCSLMA",40,0)
 S VALMBCK="R"
"RTN","GMRCSLMA",41,0)
 ;Q:$D(GMRCQUT)
"RTN","GMRCSLMA",42,0)
 ;
"RTN","GMRCSLMA",43,0)
 I $D(GMRCALFL) D  Q  ;Processing from an alert, quit
"RTN","GMRCSLMA",44,0)
 . K ^TMP("GMRCR",$J,"CS"),GMRCDA
"RTN","GMRCSLMA",45,0)
 . S BLK=0,LNCT=1
"RTN","GMRCSLMA",46,0)
 . S VALMBCK="R"
"RTN","GMRCSLMA",47,0)
 . D SET^GMRCSLM1
"RTN","GMRCSLMA",48,0)
 . D INIT^GMRCSLM
"RTN","GMRCSLMA",49,0)
 . ;D END^GMRCSLM1 ;cancel,receive
"RTN","GMRCSLMA",50,0)
 . Q
"RTN","GMRCSLMA",51,0)
 ;
"RTN","GMRCSLMA",52,0)
 ;Processing from Consults action
"RTN","GMRCSLMA",53,0)
 I $G(TYPE)["L" D AD^GMRCSLM1,INIT^GMRCSLM S VALMBG=1
"RTN","GMRCSLMA",54,0)
 I $G(TYPE)["H" D HDR^GMRCSLM,INIT^GMRCSLM
"RTN","GMRCSLMA",55,0)
 Q
"RTN","GMRCSLMA",56,0)
 ;alert logic not flushed out
"RTN","GMRCSLMA",57,0)
 ;. I $G(TYPE)["L" D
"RTN","GMRCSLMA",58,0)
 ;. . ; rebuild the list
"RTN","GMRCSLMA",59,0)
 ;. . K ^TMP("GMRCR",$J,"CS")
"RTN","GMRCSLMA",60,0)
 ;. . D SET^GMRCSLM1
"RTN","GMRCSLMA",61,0)
 ;. . D INIT^GMRCSLM
"RTN","GMRCSLMA",62,0)
 ;. I $G(TYPE)["H" D HDR^GMRCSLM,INIT^GMRCSLM
"RTN","GMRCSLMA",63,0)
 ;. I $G(TYPE)["L" D END^GMRCSLM1 ;cancel,receive
"RTN","GMRCSLMA",64,0)
 ;. Q
"RTN","GMRCSLMA",65,0)
 ;
"RTN","GMRCSLMA",66,0)
EXIT(LINE) ; -- Exit action for list manager to refresh screen and reset the menu
"RTN","GMRCSLMA",67,0)
 ;Actions using this: RT,DT
"RTN","GMRCSLMA",68,0)
 ;LINE contains "A" Re-highlight line on list
"RTN","GMRCSLMA",69,0)
 ;LINE contains "R" Remove highlight on list
"RTN","GMRCSLMA",70,0)
 ;Used by GMRCACT CANCEL REQUEST,GMRCACT COMMENT ORDERS
"RTN","GMRCSLMA",71,0)
 I "A"[LINE,$D(GMRC("NMBR")) D AGAIN^GMRCSLMV(GMRC("NMBR")) ;DD entry and RD exit action
"RTN","GMRCSLMA",72,0)
 I "R"[LINE,$D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLMA",73,0)
 S VALMBCK="R"
"RTN","GMRCSLMA",74,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCSLMA",75,0)
 S VALMBG=1
"RTN","GMRCSLMA",76,0)
 K GMRCSEL,GMRCO,GMRCND
"RTN","GMRCSLMA",77,0)
 Q
"RTN","GMRCSLMA",78,0)
 ;
"RTN","GMRCSLMA",79,0)
PHDR ; -- protocol header code called from the protocol action menus
"RTN","GMRCSLMA",80,0)
 ;S VALMSG=$$MSG
"RTN","GMRCSLMA",81,0)
 D SHOW^VALM
"RTN","GMRCSLMA",82,0)
 S XQORM("#")=$O(^ORD(101,"B","GMRC SELECT ITEM",0))_"^1:"_VALMCNT
"RTN","GMRCSLMA",83,0)
 S XQORM("A")="Select: "
"RTN","GMRCSLMA",84,0)
 S XQORM("KEY","EX")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLMA",85,0)
 S XQORM("KEY","Q")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLMA",86,0)
 S XQORM("KEY","CLOSE")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLMA",87,0)
 S XQORM("KEY","NX")=$O(^ORD(101,"B","GMRCACT NEXT SCREEN",0))_"^1"
"RTN","GMRCSLMA",88,0)
 S XQORM("KEY","NEXT")=$O(^ORD(101,"B","GMRCACT NEXT SCREEN",0))_"^1"
"RTN","GMRCSLMA",89,0)
 S XQORM("KEY","PS")=$O(^ORD(101,"B","GMRCACT PRINT CONSULT FORM",0))_"^1"
"RTN","GMRCSLMA",90,0)
 S XQORM("KEY","CM")=$O(^ORD(101,"B","GMRCACT COMMENT ORDERS",0))_"^1"
"RTN","GMRCSLMA",91,0)
 K GMRCNMBR
"RTN","GMRCSLMA",92,0)
 Q
"RTN","GMRCSLMA",93,0)
 ;I '+$G(OVRRIDE),$$VALID^GMRCAU(+$G(GMRCSS)) D  ;set 2.5 mnem's into XQORM("KEY")
"RTN","GMRCSLMA",94,0)
 ;. S XQORM("KEY","AC")="$O(^ORD(101,"B","GMRCACT ADMIN COMPLETE",0)_"^1"
"RTN","GMRCSLMA",95,0)
 ;. S XQORM("KEY","DY")=$O(^ORD(101,"B","GMRCACT CANCEL",0))_"^1"
"RTN","GMRCSLMA",96,0)
 ;. S XQORM("KEY","ED")=$O(^ORD(101,"B","GMRC CHANGE ORDERS",0))_"^1"
"RTN","GMRCSLMA",97,0)
 Q
"RTN","GMRCSLMA",98,0)
MSG() ; -- LMgr message bar
"RTN","GMRCSLMA",99,0)
 Q "Enter the number of the item you wish to act on, or select an action."
"RTN","GMRCSLMA",100,0)
 ;
"RTN","GMRCSLMA",101,0)
MARGIN ; -- Reset bottom margin if menu display off
"RTN","GMRCSLMA",102,0)
 N BM S BM=$S(VALMMENU:17,1:21) Q:BM=VALM("BM")  ; no change
"RTN","GMRCSLMA",103,0)
 S VALM("BM")=BM,VALM("LINES")=VALM("BM")-VALM("TM")+1,VALMBCK="R"
"RTN","GMRCSLMA",104,0)
 Q
"RTN","GMRCSLMA",105,0)
 ;
"RTN","GMRCSLMA",106,0)
SELEXIT ; -- Exit action for list manager when selection criteria changed
"RTN","GMRCSLMA",107,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCSLMA",108,0)
 S VALMBCK="R"
"RTN","GMRCSLMA",109,0)
 Q:($D(GMRCQUT)!$D(GMRCQUIT))  ;status exit using GMRCQUIT??
"RTN","GMRCSLMA",110,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLMA",111,0)
 D AD^GMRCSLM1
"RTN","GMRCSLMA",112,0)
 D INIT^GMRCSLM ;from select patient, select service
"RTN","GMRCSLMA",113,0)
 D HDR^GMRCSLM  ;from select patient, select date range
"RTN","GMRCSLMA",114,0)
 K GMRCSEL,GMRCO,GMRCND
"RTN","GMRCSLMA",115,0)
 Q
"RTN","GMRCSLMA",116,0)
 ;
"RTN","GMRCSLMU")
0^25^B7703750
"RTN","GMRCSLMU",1,0)
GMRCSLMU ;SLC/DCM - Utilities for displaying consults in List manager ;4/30/98  10:04
"RTN","GMRCSLMU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27,1997
"RTN","GMRCSLMU",3,0)
 ;;
"RTN","GMRCSLMU",4,0)
TIU(GMRCPTR,LINECT,LOCAL) ; Enter here to get status info in consult unreleeased by TIU
"RTN","GMRCSLMU",5,0)
 S DVLL=80-$L($G(LOCAL(GMRCPTR,.01,"E")))\2-2,^TMP("GMRCR",$J,"DT",LINECT,0)=$E(GMRCDVDL,1,DVLL)_$G(LOCAL(GMRCPTR,.01,"E"))_$E(GMRCDVDL,1,DVLL),LINECT=LINECT+1,^TMP("GMRCR",$J,"DT",LINECT,0)="" K DVLL
"RTN","GMRCSLMU",6,0)
 S ^TMP("GMRCR",$J,"DT",LINECT,0)="Source Information",LINECT=LINECT+1,^TMP("GMRCR",$J,"DT",LINECT,0)="",LINECT=LINECT+1
"RTN","GMRCSLMU",7,0)
 S ^TMP("GMRCR",$J,"DT",LINECT,0)="Document Status: "_LOCAL(GMRCPTR,.05,"E"),LINECT=LINECT+1
"RTN","GMRCSLMU",8,0)
 S ^TMP("GMRCR",$J,"DT",LINECT,0)="  Entry Date: "_$E($P($G(LOCAL(GMRCPTR,1201,"E")),":",1,2)_TAB,1,30)_"Author: "_$E(LOCAL(GMRCPTR,1202,"E"),1,30),LINECT=LINECT+1
"RTN","GMRCSLMU",9,0)
 S ^TMP("GMRCR",$J,"DT",LINECT,0)="  Expected Signer: "_$E(LOCAL(GMRCPTR,1204,"E")_TAB,1,22)_$E(TAB,1,5)_"Expected Cosigner: "_$S($L($G(LOCAL(GMRCPTR,1302,"E"))):LOCAL(GMRCPTR,1302,"E"),1:"None"),LINECT=LINECT+1
"RTN","GMRCSLMU",10,0)
 S ^TMP("GMRCR",$J,"DT",LINECT,0)="  Entered By: "_$E(LOCAL(GMRCPTR,1302,"E")_TAB,1,30)_"  TIU Document #: "_GMRCPTR,LINECT=LINECT+1
"RTN","GMRCSLMU",11,0)
 S ^TMP("GMRCR",$J,"DT",LINECT,0)="     Urgency: "_$S($L($G(LOCAL(GMRCPTR,.09,"E"))):LOCAL(GMRCPTR,.09,"E"),1:"None"),LINECT=LINECT+1
"RTN","GMRCSLMU",12,0)
 S ^TMP("GMRCR",$J,"DT",LINECT,0)="",LINECT=LINECT+1
"RTN","GMRCSLMU",13,0)
 S ^TMP("GMRCR",$J,"DT",LINECT,0)="You may not VIEW this "_$S($L($G(LOCAL(GMRCPTR,.05,"E"))):LOCAL(GMRCPTR,.05,"E")_" ",1:"UNSIGNED ")_$G(LOCAL(GMRCPTR,.01,"E"))_" consult.",LINECT=LINECT+1
"RTN","GMRCSLMU",14,0)
 S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="",LINECT=LINECT+1
"RTN","GMRCSLMU",15,0)
 Q
"RTN","GMRCSLMV")
0^31^B1565781
"RTN","GMRCSLMV",1,0)
GMRCSLMV ;SLC/DCM - Set Video attributes for list manager screens ;9/8/98  03:48
"RTN","GMRCSLMV",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCSLMV",3,0)
SET(GMRCNBR) ;Check For Valid input and set inverse video on selected item.
"RTN","GMRCSLMV",4,0)
 S GMRCNBR=+$P(GMRCNBR,",")
"RTN","GMRCSLMV",5,0)
 I GMRCNBR<1!(GMRCNBR>VALMCNT) W !,$C(7),GMRCNBR_" is not a valid selection. Choose a number between 1 and "_VALMCNT Q
"RTN","GMRCSLMV",6,0)
 I $D(GMRC("NMBR")) D RESET(GMRC("NMBR"))
"RTN","GMRCSLMV",7,0)
 S GMRC("NMBR")=GMRCNBR
"RTN","GMRCSLMV",8,0)
 K ^TMP("VALM VIDEO",$J,VALMEVL,GMRCNBR)
"RTN","GMRCSLMV",9,0)
 D CNTRL^VALM10(GMRCNBR,1,80,IORVON,IORVOFF)
"RTN","GMRCSLMV",10,0)
 D WRITE^VALM10(GMRCNBR)
"RTN","GMRCSLMV",11,0)
 S VALMBCK=""
"RTN","GMRCSLMV",12,0)
 Q
"RTN","GMRCSLMV",13,0)
RESET(NUMBR) ;turn reverse video off when another item is selected
"RTN","GMRCSLMV",14,0)
 K ^TMP("VALM VIDEO",$J,VALMEVL,NUMBR)
"RTN","GMRCSLMV",15,0)
 D CNTRL^VALM10(NUMBR,1,80,IOINORM,IOINORM)
"RTN","GMRCSLMV",16,0)
 D WRITE^VALM10(NUMBR)
"RTN","GMRCSLMV",17,0)
 S VALMBCK="" K GMRCSEL
"RTN","GMRCSLMV",18,0)
 Q
"RTN","GMRCSLMV",19,0)
AGAIN(NMBR) ;RESET THE VIDEO ATTRIBUTE ONLY, DO NOT REDISPLAY
"RTN","GMRCSLMV",20,0)
 Q:'$D(NMBR)  Q:NMBR=""
"RTN","GMRCSLMV",21,0)
 K ^TMP("VALM VIDEO",$J,VALMEVL,NMBR)
"RTN","GMRCSLMV",22,0)
 D CNTRL^VALM10(NMBR,1,80,IORVON,IORVOFF)
"RTN","GMRCSLMV",23,0)
 S VALMBCK=""
"RTN","GMRCSLMV",24,0)
 Q
"RTN","GMRCSTSU")
0^37^B14345379
"RTN","GMRCSTSU",1,0)
GMRCSTSU ;SLC/DLT - Change status based on current order status ;7/16/98  03:43
"RTN","GMRCSTSU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCSTSU",3,0)
CPRSUPD(GMRCO) ;Update CPRS order with new status
"RTN","GMRCSTSU",4,0)
 ;GMRCO=IEN from file 123
"RTN","GMRCSTSU",5,0)
 Q
"RTN","GMRCSTSU",6,0)
 N DFN,CTRLCODE,GMRCSTS,GMRCPROV,GMRCORFN,ORSTS,ORIFN
"RTN","GMRCSTSU",7,0)
 S GMRCSTS=$P(^GMR(123,+GMRCO,0),"^",12),GMRCORFN=$P(^(0),"^",3),DFN=$P(^(0),"^",2),GMRCPROV=$P(^(0),"^",14)
"RTN","GMRCSTSU",8,0)
 ;S CTRLCODE=$S(GMRCSTS=5:"ZU",GMRCSTS=6:"ZU",1:"ZR")
"RTN","GMRCSTSU",9,0)
 ;S DIE="^GMR(123,",DA=GMRCO,DR=".03////^S X=""@"""
"RTN","GMRCSTSU",10,0)
 ;D ^DIE
"RTN","GMRCSTSU",11,0)
 K GMRCSTS,DIE,DA,DR
"RTN","GMRCSTSU",12,0)
 Q
"RTN","GMRCSTSU",13,0)
 ;D EN^GMRCHL7(DFN,+GMRCO,"","",CTRLCODE,GMRCPROV,"","") ;Send CPRS an HL-7 message about status of purge - can/can't purge record
"RTN","GMRCSTSU",14,0)
 Q
"RTN","GMRCSTSU",15,0)
END Q
"RTN","GMRCSTSU",16,0)
END1 K DA,GMRCDT,GMRCPCNT,GMRCIDT,GMRCTRLC,GMRCOM
"RTN","GMRCSTSU",17,0)
 K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCSTSU",18,0)
 Q
"RTN","GMRCSTSU",19,0)
 ;
"RTN","GMRCSTSU",20,0)
TIURSL ;Get TIU results to update the Consults package
"RTN","GMRCSTSU",21,0)
 ;One time run to get the information TIU has into the consults package.
"RTN","GMRCSTSU",22,0)
 ;
"RTN","GMRCSTSU",23,0)
 F PASS=1,2 D LOOP
"RTN","GMRCSTSU",24,0)
 Q
"RTN","GMRCSTSU",25,0)
 ;
"RTN","GMRCSTSU",26,0)
LOOP ;LOOP Thru TIU entries to populate the 50th node.
"RTN","GMRCSTSU",27,0)
 S TIUDA=0,TIUEDT=2980500,GMRCY=0
"RTN","GMRCSTSU",28,0)
 F  S TIUEDT=$O(^TIU(8925,"F",TIUEDT)) Q:'TIUEDT  D
"RTN","GMRCSTSU",29,0)
 . S TIUDA=$O(^TIU(8925,"F",TIUEDT,"")) Q:'TIUDA
"RTN","GMRCSTSU",30,0)
 . Q:'$D(^TIU(8925,TIUDA,14))
"RTN","GMRCSTSU",31,0)
 . S GMRCO=$P($G(^TIU(8925,TIUDA,14)),"^",5)
"RTN","GMRCSTSU",32,0)
 . Q:$P(GMRCO,";",2)'="GMR(123,"
"RTN","GMRCSTSU",33,0)
 . Q:'$D(^GMR(123,+GMRCO,0))
"RTN","GMRCSTSU",34,0)
 . I PASS=1 K ^GMR(123,+GMRCO,50) Q
"RTN","GMRCSTSU",35,0)
 . ;PASS 2 ADD
"RTN","GMRCSTSU",36,0)
 . S GMRCVDA=TIUDA_";TIU(8925,"
"RTN","GMRCSTSU",37,0)
 . D ADDRSLT^GMRCTIUA(+GMRCO,GMRCVDA)
"RTN","GMRCSTSU",38,0)
 Q
"RTN","GMRCSTSU",39,0)
 ;
"RTN","GMRCSTSU",40,0)
ONETIME ;One time run to load the file 123 consult entry multiple results
"RTN","GMRCSTSU",41,0)
 ;with the TIU Narrative Result
"RTN","GMRCSTSU",42,0)
 ;
"RTN","GMRCSTSU",43,0)
 N ZTSK
"RTN","GMRCSTSU",44,0)
 S ZTSK=$$QUEUE("ONETIMER^GMRCSTSU","One time run to load the file 123 consult entry multiple results and rebuild cross-references")
"RTN","GMRCSTSU",45,0)
 I ZTSK W !,"One time load Queued to run. Task#",ZTSK
"RTN","GMRCSTSU",46,0)
 E  W !,"One Time load failed to queue."
"RTN","GMRCSTSU",47,0)
 Q
"RTN","GMRCSTSU",48,0)
 ;
"RTN","GMRCSTSU",49,0)
ONETIMER ;
"RTN","GMRCSTSU",50,0)
 D XREF
"RTN","GMRCSTSU",51,0)
 D NWXREF
"RTN","GMRCSTSU",52,0)
 S GMRCDT=2970100,GMRCY=0
"RTN","GMRCSTSU",53,0)
 F  S GMRCDT=$O(^GMR(123,"B",GMRCDT))  Q:'GMRCDT  D
"RTN","GMRCSTSU",54,0)
 . S GMRCO=0 F  S GMRCO=$O(^GMR(123,"B",GMRCDT,GMRCO)) Q:'GMRCO  D
"RTN","GMRCSTSU",55,0)
 .. I '$D(^GMR(123,+GMRCO,50)),+$P($G(^GMR(123,+GMRCO,0)),"^",20) S GMRCY=$$LOAD^GMRCTIUA(GMRCO)
"RTN","GMRCSTSU",56,0)
 ;
"RTN","GMRCSTSU",57,0)
 Q
"RTN","GMRCSTSU",58,0)
XREF ;re-create cross references for specific fields in files
"RTN","GMRCSTSU",59,0)
 N SVC 
"RTN","GMRCSTSU",60,0)
 D BMES^XPDUTL("Re-indexing APC cross reference for service entries ")
"RTN","GMRCSTSU",61,0)
 K ^GMR(123.5,"APC")
"RTN","GMRCSTSU",62,0)
 S SVC=0
"RTN","GMRCSTSU",63,0)
 F  S SVC=$O(^GMR(123.5,SVC)) Q:'SVC  D
"RTN","GMRCSTSU",64,0)
 . S DA(1)=SVC
"RTN","GMRCSTSU",65,0)
 . S DIK="^GMR(123.5,"_DA(1)_",10,"
"RTN","GMRCSTSU",66,0)
 . S DIK(1)=".01^APC"
"RTN","GMRCSTSU",67,0)
 . D ENALL^DIK
"RTN","GMRCSTSU",68,0)
 D BMES^XPDUTL("Re-indexing AC cross reference for sub-service entries ")
"RTN","GMRCSTSU",69,0)
 S SVC=0
"RTN","GMRCSTSU",70,0)
 F  S SVC=$O(^GMR(123.5,SVC)) Q:'SVC  D
"RTN","GMRCSTSU",71,0)
 . K ^GMR(123.5,SVC,10,"AC")
"RTN","GMRCSTSU",72,0)
 . S DA(1)=SVC
"RTN","GMRCSTSU",73,0)
 . S DIK="^GMR(123.5,"_DA(1)_",10,"
"RTN","GMRCSTSU",74,0)
 . S DIK(1)=".01^AC"
"RTN","GMRCSTSU",75,0)
 . D ENALL^DIK
"RTN","GMRCSTSU",76,0)
 Q
"RTN","GMRCSTSU",77,0)
 ;
"RTN","GMRCSTSU",78,0)
 ;
"RTN","GMRCSTSU",79,0)
NWXREF ;Create new cross references for specific fields in file 123
"RTN","GMRCSTSU",80,0)
 N DIK
"RTN","GMRCSTSU",81,0)
 D BMES^XPDUTL("Creating new G cross-reference on Sending Provider for consults in 123 ...")
"RTN","GMRCSTSU",82,0)
 S DIK="^GMR(123,"
"RTN","GMRCSTSU",83,0)
 S DIK(1)="10^G"
"RTN","GMRCSTSU",84,0)
 D ENALL^DIK
"RTN","GMRCSTSU",85,0)
 ;
"RTN","GMRCSTSU",86,0)
 D BMES^XPDUTL("Creating new H cross-reference on FROM location for consults in 123 ...")
"RTN","GMRCSTSU",87,0)
 S DIK="^GMR(123,"
"RTN","GMRCSTSU",88,0)
 S DIK(1)="2^H"
"RTN","GMRCSTSU",89,0)
 D ENALL^DIK
"RTN","GMRCSTSU",90,0)
 ;
"RTN","GMRCSTSU",91,0)
 D BMES^XPDUTL("Creating new R cross-reference on consult results in file 123 ...")
"RTN","GMRCSTSU",92,0)
 N GMRCO,DIK,DA
"RTN","GMRCSTSU",93,0)
 S GMRCO=0
"RTN","GMRCSTSU",94,0)
 F  S GMRCO=$O(^GMR(123,GMRCO)) Q:'GMRCO  D
"RTN","GMRCSTSU",95,0)
 . S DA(1)=GMRCO
"RTN","GMRCSTSU",96,0)
 . S DIK="^GMR(123,"_DA(1)_",50,"
"RTN","GMRCSTSU",97,0)
 . S DIK(1)=".01^R"
"RTN","GMRCSTSU",98,0)
 . D ENALL^DIK
"RTN","GMRCSTSU",99,0)
 Q
"RTN","GMRCSTSU",100,0)
 ;
"RTN","GMRCSTSU",101,0)
QUEUE(ZTRTN,ZTDESC,ZTDTH,ZTIO) ;
"RTN","GMRCSTSU",102,0)
 ;
"RTN","GMRCSTSU",103,0)
 ; ZTRTN -- ROUTINE TO RUN (MANDATORY)
"RTN","GMRCSTSU",104,0)
 ; ZTDESC - DESCRIPTION OF THE TASK (OPTIONAL)
"RTN","GMRCSTSU",105,0)
 ; ZTDTH -- TIME TO RUN (OPTIONAL - DEFAULT = NOW)
"RTN","GMRCSTSU",106,0)
 ; ZTIO --- DEVICE TO SEND OUTPUT TO (OPTIONAL)
"RTN","GMRCSTSU",107,0)
 ;
"RTN","GMRCSTSU",108,0)
 N ZTCPU,ZTPAR,ZTPRE,ZTPRI
"RTN","GMRCSTSU",109,0)
 N ZTSAVE,ZTSK,ZTUCI
"RTN","GMRCSTSU",110,0)
 ;
"RTN","GMRCSTSU",111,0)
 Q:'$L($G(ZTRTN)) 0
"RTN","GMRCSTSU",112,0)
 S:'$L($G(ZTDESC)) ZTDESC="CONSULT/REQUEST PACKAGE TASK"
"RTN","GMRCSTSU",113,0)
 S:'$L($G(ZTIO)) ZTIO=""
"RTN","GMRCSTSU",114,0)
 S:'$L($G(ZTDTH)) ZTDTH=$H
"RTN","GMRCSTSU",115,0)
 D ^%ZTLOAD
"RTN","GMRCSTSU",116,0)
 ;
"RTN","GMRCSTSU",117,0)
 Q $G(ZTSK)
"RTN","GMRCSTSU",118,0)
 ;
"RTN","GMRCTIU")
0^8^B12058070
"RTN","GMRCTIU",1,0)
GMRCTIU ;SLC/DCM - TIU utilities for exchanging info with Consults ;9/8/98  04:35
"RTN","GMRCTIU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCTIU",3,0)
GET(GMRCO,GMRCTUFN,GMRCTUST,GMRCAUTH) ;Receive the IEN of TIU file for a patient from TIU; also recieve TIU status update.
"RTN","GMRCTIU",4,0)
 ;GMRCO=IFN from file 123
"RTN","GMRCTIU",5,0)
 ;GMRCTUFN=TIU IFN
"RTN","GMRCTIU",6,0)
 ;GMRCTUST=TIU status of report
"RTN","GMRCTIU",7,0)
 ;GMRCAUTH=Author of Document
"RTN","GMRCTIU",8,0)
 N GMRCA,GMRCSTS,GMRCDFN,GMRCAD
"RTN","GMRCTIU",9,0)
 S GMRCA=$S($G(GMRCTUST)["INCOMPLETE":9,1:10),GMRCSTS=$S(GMRCA=10:2,1:9)
"RTN","GMRCTIU",10,0)
 I '+$G(GMRCA) S GMRCA=99,GMRCSTS=99
"RTN","GMRCTIU",11,0)
 D:+$G(GMRCA) STATUS^GMRCTIU1
"RTN","GMRCTIU",12,0)
 K GMRCOM,GMRCND,GMRCORNP,GMRCORTX,GMRCSA,GMRCSTS
"RTN","GMRCTIU",13,0)
 Q
"RTN","GMRCTIU",14,0)
 ;
"RTN","GMRCTIU",15,0)
DSPLAY(GMRCTUFN,LINECT) ;Get TIU results narrative and get it ready for display
"RTN","GMRCTIU",16,0)
 ;GMRCTUFN=TIU IEN of results record     LINECT=line count for list manager
"RTN","GMRCTIU",17,0)
 ;K VALMAR
"RTN","GMRCTIU",18,0)
 N ND,GMRCARR
"RTN","GMRCTIU",19,0)
 D RPC^TIUSRV(.GMRCARR,GMRCTUFN)
"RTN","GMRCTIU",20,0)
 S ND=0
"RTN","GMRCTIU",21,0)
 F  S ND=$O(@GMRCARR@(ND)) Q:ND=""  S ^TMP("GMRCR",$J,"DT",LINECT,0)=@GMRCARR@(ND,0),LINECT=LINECT+1
"RTN","GMRCTIU",22,0)
 ;D CLEAN^VALM10
"RTN","GMRCTIU",23,0)
 K @GMRCARR,RESFL,GMRCTIUY
"RTN","GMRCTIU",24,0)
 S:LINECT>1 LINECT=LINECT-1
"RTN","GMRCTIU",25,0)
 Q
"RTN","GMRCTIU",26,0)
ENTER(GMRCO) ; Complete a consult with TIU note
"RTN","GMRCTIU",27,0)
 N XQADATA,XQA,XQAID,XQAROU,XQFLG,XQAKILL
"RTN","GMRCTIU",28,0)
 D ENTER^GMRCTIUE(GMRCO)
"RTN","GMRCTIU",29,0)
 Q
"RTN","GMRCTIU",30,0)
 ;
"RTN","GMRCTIU",31,0)
ADDEND(GMRCO) ; Make an addendum to a consult result
"RTN","GMRCTIU",32,0)
 N XQADATA,XQA,XQAID,XQAROU,XQFLG,XQAKILL
"RTN","GMRCTIU",33,0)
 D ADDEND^GMRCTIUE(GMRCO)
"RTN","GMRCTIU",34,0)
 Q
"RTN","GMRCTIU",35,0)
 ;
"RTN","GMRCTIU",36,0)
SEND(DFN,OVRRIDE) ;Get the patients consult list and return in ^TMP for TIU
"RTN","GMRCTIU",37,0)
 ;DFN=Patient's Internal file number from file 2
"RTN","GMRCTIU",38,0)
 ;OVRRIDE=BOOLEAN flag to override user validation
"RTN","GMRCTIU",39,0)
 N GMRCI,TAB
"RTN","GMRCTIU",40,0)
 Q:DFN=""!(DFN<1)
"RTN","GMRCTIU",41,0)
 S TAB="",$P(TAB," ",30)=""
"RTN","GMRCTIU",42,0)
 K ^TMP("GMRCR",$J,"TIU")
"RTN","GMRCTIU",43,0)
 D GETCONSL(DFN,2,$G(OVRRIDE)) ;2=returns TIU format in ^TMP array
"RTN","GMRCTIU",44,0)
 Q
"RTN","GMRCTIU",45,0)
 ;
"RTN","GMRCTIU",46,0)
RPCLIST(GMRCY,DFN) ;Get the patients consult list and return in GMRCY for GUI
"RTN","GMRCTIU",47,0)
 N GMRCI
"RTN","GMRCTIU",48,0)
 I '+$G(DFN) S GMRCY(0)=0
"RTN","GMRCTIU",49,0)
 D GETCONSL(DFN,1) ;1=returns GUI format in GMRCY array
"RTN","GMRCTIU",50,0)
 ; The consults will be returned from GETCONSL in the GMRCY array.
"RTN","GMRCTIU",51,0)
 S GMRCY(0)=+$G(GMRCI)
"RTN","GMRCTIU",52,0)
 Q
"RTN","GMRCTIU",53,0)
GETCONSL(DFN,ORIGIN,OVRRIDE) ;Get the patients consults
"RTN","GMRCTIU",54,0)
 ;ORIGIN is whether the the request is for GUI=1 or LM=2.
"RTN","GMRCTIU",55,0)
 ;The logic loops through the "F" cross-reference to find consults
"RTN","GMRCTIU",56,0)
 ;The output will be formated in GMRCY for the GUI if ORIGIN is 1.
"RTN","GMRCTIU",57,0)
 ;The output will be formated in ^TMP("GMRCR",$J,"TIU" if ORIGIN is 2.
"RTN","GMRCTIU",58,0)
 ;
"RTN","GMRCTIU",59,0)
 N GMRCQIT,GMRC,GMRCDA,GMRCDT,GMRCEDT,GMRCYR,GMRCSP,GMRCST,GMRCSTS
"RTN","GMRCTIU",60,0)
 N GMRCTIU,GMRCTIUC,GMRCSS,GMRCSVC,GMRCPROC,GMRCNOTE,Y
"RTN","GMRCTIU",61,0)
 S GMRCYR=$$FMADD^XLFDT(DT,-365),GMRCDA="",GMRCI=0
"RTN","GMRCTIU",62,0)
 F  S GMRCDA=$O(^GMR(123,"F",DFN,GMRCDA),-1) Q:+GMRCDA'>0  D  Q:+$G(GMRCQIT)
"RTN","GMRCTIU",63,0)
 . S GMRC(0)=$G(^GMR(123,GMRCDA,0))
"RTN","GMRCTIU",64,0)
 . S GMRCST=$P(GMRC(0),U,12)
"RTN","GMRCTIU",65,0)
 . I $S(GMRCST=5:0,GMRCST=6:0,GMRCST=9:0,GMRCST=2:0,1:1) Q
"RTN","GMRCTIU",66,0)
 . S GMRCDT=+GMRC(0) I GMRCDT<GMRCYR S GMRCQIT=1 Q
"RTN","GMRCTIU",67,0)
 . S GMRCSS=$P(GMRC(0),U,5)
"RTN","GMRCTIU",68,0)
 . I '+$G(OVRRIDE) Q:'$$VALID^GMRCAU(GMRCSS,GMRCDA) 
"RTN","GMRCTIU",69,0)
 . S GMRCTIUC=0
"RTN","GMRCTIU",70,0)
 . D GETLIST^GMRCTIUL(GMRCDA,0,1,.GMRCTIUC)
"RTN","GMRCTIU",71,0)
 . I ORIGIN=1 D BLDGMRCY Q
"RTN","GMRCTIU",72,0)
 . I ORIGIN=2 D BLDTMP Q
"RTN","GMRCTIU",73,0)
 . Q
"RTN","GMRCTIU",74,0)
 Q
"RTN","GMRCTIU",75,0)
 ;
"RTN","GMRCTIU",76,0)
BLDGMRCY ;Build the GMRCY array of existing consults
"RTN","GMRCTIU",77,0)
 S GMRCSTS=$P($G(^ORD(100.01,+GMRCST,0)),"^",1)
"RTN","GMRCTIU",78,0)
 S GMRCSS=$P(GMRC(0),U,5),GMRCSVC=$P($G(^GMR(123.5,GMRCSS,0)),U)
"RTN","GMRCTIU",79,0)
 S GMRCPROC=$P($G(^ORD(101,+$P(GMRC(0),U,8),0)),U,2)
"RTN","GMRCTIU",80,0)
 S GMRCI=+$G(GMRCI)+1
"RTN","GMRCTIU",81,0)
 S GMRCY(GMRCI)=GMRCDA_U_GMRCDT_U_GMRCSVC_U_GMRCPROC_U_GMRCSTS_U_+GMRCTIUC(0)
"RTN","GMRCTIU",82,0)
 Q
"RTN","GMRCTIU",83,0)
BLDTMP ;Build TMP global for TIU
"RTN","GMRCTIU",84,0)
 S GMRCSTS=$G(^ORD(100.01,+GMRCST,.1))
"RTN","GMRCTIU",85,0)
 S GMRCSP=$$ORTX^GMRCAU(GMRCDA)
"RTN","GMRCTIU",86,0)
 S GMRCNOTE=$S(GMRCTIUC(0)=1:" note",1:" notes")
"RTN","GMRCTIU",87,0)
 S GMRCEDT=$$FMTE^XLFDT(GMRCDT,"D")
"RTN","GMRCTIU",88,0)
 S GMRCI=GMRCI+1
"RTN","GMRCTIU",89,0)
 S ^TMP("GMRCR",$J,"TIU",GMRCI,0)=$J(GMRCI,3)_"> "_$E(GMRCEDT_TAB,1,12)_" C#"_$E(GMRCDA_TAB,1,9)_$E(GMRCSP_TAB,1,21)_$E(GMRCSTS_TAB,1,4)_$E(+GMRCTIUC(0)_GMRCNOTE_TAB,1,10)
"RTN","GMRCTIU",90,0)
 S ^TMP("GMRCR",$J,"TIU","B",GMRCI,GMRCDA)=""
"RTN","GMRCTIU",91,0)
 Q
"RTN","GMRCTIU1")
0^14^B23177260
"RTN","GMRCTIU1",1,0)
GMRCTIU1 ;SLC/JER - More CT/TIU interface modules ;5/19/98  12:46
"RTN","GMRCTIU1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCTIU1",3,0)
ROLLBACK(DA,TIUDA) ; Roll-back a CT record when result is deleted or reassigned
"RTN","GMRCTIU1",4,0)
 ;Disassociate Note logic
"RTN","GMRCTIU1",5,0)
 ;The action removes the association of a TIU note with a consult.
"RTN","GMRCTIU1",6,0)
 ;The new CPRS status will change to "ACTIVE", unless one of the
"RTN","GMRCTIU1",7,0)
 ;remaining notes has a completed status. 
"RTN","GMRCTIU1",8,0)
 ;This action should send an alert to the service notification users.
"RTN","GMRCTIU1",9,0)
 N DIE,DR,GMRCSTS,GMRCA,GMRCO,GMRCOM,GMRCORNP,GMRCDFN,GMRCNODE,GMRCLIST,GMRCD0,GMRCD1,GMRCSF,GMRCADUZ,MSGTOSRV,GMRCATX,GMRCORTX
"RTN","GMRCTIU1",10,0)
 S GMRCNODE=$G(^GMR(123,+DA,0))
"RTN","GMRCTIU1",11,0)
 ;
"RTN","GMRCTIU1",12,0)
 I ($P(GMRCNODE,U,20)=TIUDA) S DIE="^GMR(123,",DR="16///@" D ^DIE
"RTN","GMRCTIU1",13,0)
 S GMRCD0=DA,GMRCD1=0 F  S GMRCD1=$O(^GMR(123,GMRCD0,50,GMRCD1)) Q:'GMRCD1  D
"RTN","GMRCTIU1",14,0)
 .N DA,DIK
"RTN","GMRCTIU1",15,0)
 .Q:'(TIUDA=+$G(^GMR(123,GMRCD0,50,GMRCD1,0)))
"RTN","GMRCTIU1",16,0)
 .S DA(1)=GMRCD0,DA=GMRCD1
"RTN","GMRCTIU1",17,0)
 .S DIK="^GMR(123,"_DA(1)_",50,"
"RTN","GMRCTIU1",18,0)
 .D ^DIK
"RTN","GMRCTIU1",19,0)
 ;
"RTN","GMRCTIU1",20,0)
 S GMRCA=12,GMRCO=DA
"RTN","GMRCTIU1",21,0)
 D GETLIST^GMRCTIUL(DA,2,1,.GMRCLIST)
"RTN","GMRCTIU1",22,0)
 S GMRCSTS=9
"RTN","GMRCTIU1",23,0)
 I '$G(GMRCLIST(0)) S GMRCSTS=6
"RTN","GMRCTIU1",24,0)
 E  S GMRCD0="" F  S GMRCD0=$O(^TMP("GMRC50",$J,GMRCD0)) Q:'$L(GMRCD0)  D
"RTN","GMRCTIU1",25,0)
 .Q:(+GMRCD0=TIUDA)
"RTN","GMRCTIU1",26,0)
 .S GMRCD1=0 F  S GMRCD1=$O(^TMP("GMRC50",$J,GMRCD0,GMRCD1)) Q:'GMRCD1  D
"RTN","GMRCTIU1",27,0)
 ..S:($P($G(^TMP("GMRC50",$J,GMRCD0,GMRCD1)),U,6)="completed") GMRCSTS=2
"RTN","GMRCTIU1",28,0)
 Q:$G(NOSAVE)
"RTN","GMRCTIU1",29,0)
 D STATUS^GMRCP
"RTN","GMRCTIU1",30,0)
 K ^TMP("GMRC50",$J),^TMP("GMRC50R",$J)
"RTN","GMRCTIU1",31,0)
 ;
"RTN","GMRCTIU1",32,0)
 S GMRCOM=0,MSGTOSRV=0,GMRCRSLT=TIUDA_";TIU(8925," D AUDIT^GMRCP
"RTN","GMRCTIU1",33,0)
 ;
"RTN","GMRCTIU1",34,0)
 ;Build message information if status has changed or sig finding="Y"
"RTN","GMRCTIU1",35,0)
 S GMRCSF=$P(GMRCNODE,U,19)
"RTN","GMRCTIU1",36,0)
 I ($P(GMRCNODE,U,12)=$P($G(^GMR(123,GMRCO,0)),U,12)) D  Q:GMRCATX=""
"RTN","GMRCTIU1",37,0)
 . S GMRCATX="" Q:GMRCSF'="Y"
"RTN","GMRCTIU1",38,0)
 . S GMRCATX="*Removed consult note for "
"RTN","GMRCTIU1",39,0)
 E  S GMRCATX=$S((GMRCSF="Y"):"*",1:"")_"Reactivated consult, removed note for ",MSGTOSRV=1
"RTN","GMRCTIU1",40,0)
 S GMRCORNP=$P(GMRCNODE,U,14),GMRCDFN=$P(GMRCNODE,U,2)
"RTN","GMRCTIU1",41,0)
 S GMRCORTX=$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCTIU1",42,0)
 S GMRCORTX=GMRCATX_GMRCORTX
"RTN","GMRCTIU1",43,0)
 S:GMRCORNP GMRCADUZ(GMRCORNP)=""
"RTN","GMRCTIU1",44,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,23,.GMRCADUZ,MSGTOSRV)
"RTN","GMRCTIU1",45,0)
 Q:($P(GMRCNODE,U,12)=$P($G(^GMR(123,+GMRCO,0)),U,12))
"RTN","GMRCTIU1",46,0)
 ;
"RTN","GMRCTIU1",47,0)
 ;On status change, send "SC" (status change) HL7 msg to update order
"RTN","GMRCTIU1",48,0)
 D EN^GMRCHL7(GMRCDFN,+GMRCO,$G(GMRCTYPE),$G(GMRCRB),"SC",GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCTIU1",49,0)
 Q
"RTN","GMRCTIU1",50,0)
 ;
"RTN","GMRCTIU1",51,0)
STATUS ;Update the status of a consult that has a TIU result
"RTN","GMRCTIU1",52,0)
 N GMRCAD,GMRCATX,GMRCOA,GMRCOSTS,GMRCOTFN,GMRC,GMRCSF,GMRCLAE,GMRCRSLT,GMRCADUZ
"RTN","GMRCTIU1",53,0)
 D GETOLD
"RTN","GMRCTIU1",54,0)
 S GMRCORNP=$G(GMRCAUTH) ;author
"RTN","GMRCTIU1",55,0)
 S GMRCRSLT=GMRCTUFN_";TIU(8925,"
"RTN","GMRCTIU1",56,0)
 ;
"RTN","GMRCTIU1",57,0)
 ;Evaluate whether a complete action is actually an addendum or New note
"RTN","GMRCTIU1",58,0)
 I GMRCA=10 S GMRCA=$$EVALACT(GMRCOSTS,+GMRCO,GMRCRSLT)
"RTN","GMRCTIU1",59,0)
 ;
"RTN","GMRCTIU1",60,0)
 ;Update the status and last activity field
"RTN","GMRCTIU1",61,0)
 ;Do not change the status if already completed
"RTN","GMRCTIU1",62,0)
 I GMRCOSTS=2,GMRCSTS=9 S GMRCSTS=2
"RTN","GMRCTIU1",63,0)
 D STATUS^GMRCP
"RTN","GMRCTIU1",64,0)
 ;
"RTN","GMRCTIU1",65,0)
 ;Update activity log
"RTN","GMRCTIU1",66,0)
 D AUDIT
"RTN","GMRCTIU1",67,0)
 ;
"RTN","GMRCTIU1",68,0)
 ;Update the last TIU entry modified and add result to result multiple
"RTN","GMRCTIU1",69,0)
 D ADD^GMRCTIUA(GMRCTUFN,GMRCO)
"RTN","GMRCTIU1",70,0)
 ;
"RTN","GMRCTIU1",71,0)
 ;Update order
"RTN","GMRCTIU1",72,0)
 S GMRCORNP=$P(^GMR(123,+GMRCO,0),"^",14)
"RTN","GMRCTIU1",73,0)
 D EN^GMRCHL7(GMRCDFN,+GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCTIU1",74,0)
 ;
"RTN","GMRCTIU1",75,0)
 ;Send a message
"RTN","GMRCTIU1",76,0)
 I $$COMPLETE(GMRCA) D
"RTN","GMRCTIU1",77,0)
 .S GMRCATX=$S((GMRCSF="Y"):"*",1:"")_$S(GMRCA=14:"New Note for ",GMRCA=13:"Addendum Added for ",1:"")
"RTN","GMRCTIU1",78,0)
 .S GMRCORTX=GMRCATX_"Completed Consult "_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCTIU1",79,0)
 .I $P(GMRC(0),"^",14) S GMRCADUZ($P(GMRC(0),"^",14))=""
"RTN","GMRCTIU1",80,0)
 .D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,23,.GMRCADUZ,0)
"RTN","GMRCTIU1",81,0)
 .Q
"RTN","GMRCTIU1",82,0)
 ;
"RTN","GMRCTIU1",83,0)
 Q
"RTN","GMRCTIU1",84,0)
 ;
"RTN","GMRCTIU1",85,0)
GETOLD ;save the old values of status, and the last activity data
"RTN","GMRCTIU1",86,0)
 ;to determine how to update status and TIU activity log
"RTN","GMRCTIU1",87,0)
 S GMRC(0)=$G(^GMR(123,+GMRCO,0))
"RTN","GMRCTIU1",88,0)
 S GMRCDFN=$P(GMRC(0),"^",2)
"RTN","GMRCTIU1",89,0)
 S GMRCSF=$P(GMRC(0),U,19)
"RTN","GMRCTIU1",90,0)
 S GMRCOSTS=$P(GMRC(0),"^",12) ;status before activity
"RTN","GMRCTIU1",91,0)
 S GMRCLAE=+$P($G(^GMR(123,+GMRCO,40,0)),U,3) ;last activity entry
"RTN","GMRCTIU1",92,0)
 S GMRC(40)=$G(^GMR(123,+GMRCO,40,+GMRCLAE,0))
"RTN","GMRCTIU1",93,0)
 S GMRCOADT=+$P(GMRC(40),U,1) ;last activity entry date
"RTN","GMRCTIU1",94,0)
 S GMRCOA=$P(GMRC(40),"^",2) ;last activity
"RTN","GMRCTIU1",95,0)
 S GMRCOTFN=$P(GMRC(40),"^",9) ;last result
"RTN","GMRCTIU1",96,0)
 Q
"RTN","GMRCTIU1",97,0)
 ;
"RTN","GMRCTIU1",98,0)
AUDIT ;Determine appropriate update activity.
"RTN","GMRCTIU1",99,0)
 ;Quit if new activity is same as previous "Incomplete Rpt" activity
"RTN","GMRCTIU1",100,0)
 I GMRCOTFN=GMRCRSLT,GMRCOA=9,GMRCOA=GMRCA,GMRCOSTS=GMRCSTS Q
"RTN","GMRCTIU1",101,0)
 ;
"RTN","GMRCTIU1",102,0)
 S GMRCOM=0
"RTN","GMRCTIU1",103,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCTIU1",104,0)
 ;Check for overwrite of incomplete rpt activity if the new
"RTN","GMRCTIU1",105,0)
 ;activity occurs within 15 minutes of the last.
"RTN","GMRCTIU1",106,0)
 S GMRCOADT=$$FMADD^XLFDT(GMRCOADT,0,0,15)
"RTN","GMRCTIU1",107,0)
 I GMRCOTFN=GMRCRSLT,GMRCOA=9,$$COMPLETE(GMRCA),GMRCDT<GMRCOADT D AUDIT1 Q
"RTN","GMRCTIU1",108,0)
 D AUDIT^GMRCP Q
"RTN","GMRCTIU1",109,0)
 Q
"RTN","GMRCTIU1",110,0)
 ;
"RTN","GMRCTIU1",111,0)
AUDIT1 ;overwrite last activity
"RTN","GMRCTIU1",112,0)
 L +^GMR(123,+GMRCO,40):5 I '$T S GMRCUT=1,GMRCERR=1,GMRCERMS="Activity Trail Not filed - Consult In Use By Another User." L -^GMR(123,+GMRCO,40)  Q
"RTN","GMRCTIU1",113,0)
 S DA=$P(^GMR(123,+GMRCO,40,0),"^",3)
"RTN","GMRCTIU1",114,0)
 D AUDIT1^GMRCP
"RTN","GMRCTIU1",115,0)
 Q
"RTN","GMRCTIU1",116,0)
 ;
"RTN","GMRCTIU1",117,0)
COMPLETE(GMRCA) ;Determine if the action is a complete action (10,13,14)
"RTN","GMRCTIU1",118,0)
 Q $S(GMRCA=13:1,GMRCA=14:1,GMRCA=10:1,1:0)
"RTN","GMRCTIU1",119,0)
 ;
"RTN","GMRCTIU1",120,0)
EVALACT(GMRCOSTS,GMRCO,GMRCRSLT) ;Evaluate complete action based on prev results and sts
"RTN","GMRCTIU1",121,0)
 N EVALA,GMRCLAE
"RTN","GMRCTIU1",122,0)
 I '$D(^GMR(123,+GMRCO,50)) Q 10
"RTN","GMRCTIU1",123,0)
 I GMRCOSTS'=2 Q 10
"RTN","GMRCTIU1",124,0)
 I '$D(^GMR(123,+GMRCO,50,"B",GMRCRSLT)) Q 14
"RTN","GMRCTIU1",125,0)
 S EVALA=0,GMRCLAE=+$P($G(^GMR(123,+GMRCO,40,0)),U,3)+1
"RTN","GMRCTIU1",126,0)
 F  S GMRCLAE=$O(^GMR(123,+GMRCO,40,GMRCLAE),-1) Q:'GMRCLAE  D  Q:+EVALA
"RTN","GMRCTIU1",127,0)
 . S GMRCLAE(40)=^GMR(123,+GMRCO,40,GMRCLAE,0)
"RTN","GMRCTIU1",128,0)
 . I $P(GMRCLAE(40),U,9)=GMRCRSLT D
"RTN","GMRCTIU1",129,0)
 .. I $P(GMRCLAE(40),U,2)=9 S EVALA=14 Q
"RTN","GMRCTIU1",130,0)
 .. I $$COMPLETE($P(GMRCLAE(40),U,2)) S EVALA=13 Q
"RTN","GMRCTIU1",131,0)
 I +EVALA Q EVALA
"RTN","GMRCTIU1",132,0)
 Q 10
"RTN","GMRCTIU1",133,0)
 ;
"RTN","GMRCTIU3")
0^16^B8728862
"RTN","GMRCTIU3",1,0)
GMRCTIU3 ;SLC/DCM - Extract medicine results for consults tracking ;7/16/98  02:09
"RTN","GMRCTIU3",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCTIU3",3,0)
EN(GMRCO,ORIFN,GLOBAL,COUNT) ;;This entry point is used to collect consult data from the Medicine Package.
"RTN","GMRCTIU3",4,0)
 ;Consult/Request Tracking
"RTN","GMRCTIU3",5,0)
 ;GMRCSEL: The IEN of the consult from file 123.
"RTN","GMRCTIU3",6,0)
 ;COUNT:   The current position in ^TMP where data is to be placed.
"RTN","GMRCTIU3",7,0)
 D ENDT,EXIT Q
"RTN","GMRCTIU3",8,0)
 ;
"RTN","GMRCTIU3",9,0)
ENDT ;Get Medicine Results for diaplay
"RTN","GMRCTIU3",10,0)
 S @GLOBAL@(COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCTIU3",11,0)
 S GMRCRTIT=$G(GMRCPRNM)_" SUMMARY REPORT",GMRCH="",$P(GMRCH,"-",(77-$L(GMRCRTIT))\2)="",@GLOBAL@(COUNT,0)=GMRCH_" "_GMRCRTIT_" "_GMRCH,COUNT=COUNT+1,@GLOBAL@(COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCTIU3",12,0)
 D PRINT^MCOR I '$D(^TMP("MC",$J)) S @GLOBAL@(PTR,COUNT,0)="No results are available for review.",COUNT=COUNT+1
"RTN","GMRCTIU3",13,0)
 ;GMRCFT=Field Type of D (Diagnosis, I (Indications), S (Summary)
"RTN","GMRCTIU3",14,0)
SET S GMRCFT="D" I $D(^TMP("MC",$J,"D")) S @GLOBAL@(COUNT,0)=$E(TAB,1,34)_"DIAGNOSIS",COUNT=COUNT+1 D SETFLD
"RTN","GMRCTIU3",15,0)
 S GMRCFT="I" I $D(^TMP("MC",$J,"I")) S @GLOBAL@(COUNT,0)="",COUNT=COUNT+1,@GLOBAL@(COUNT,0)="INDICATIONS:",COUNT=COUNT+1 D SETFLD
"RTN","GMRCTIU3",16,0)
 I $D(^TMP("MC",$J,"S")) D SUM
"RTN","GMRCTIU3",17,0)
 Q
"RTN","GMRCTIU3",18,0)
EXIT K GMRCH,GMRCX,GMRCSR,GMRCFT,GMRCFLD,GMRCSUM,GMRCFLDN,GMRCSUMP,GMRCRTIT,GMRCPRNM,GMRCFLDP,MCC,MCK,MCMFLD,MCMUP
"RTN","GMRCTIU3",19,0)
 K ^TMP("MC",$J)
"RTN","GMRCTIU3",20,0)
 Q
"RTN","GMRCTIU3",21,0)
SETFLD S GMRCFLD=0,GMRCFLDP="" F  S GMRCFLD=$O(^TMP("MC",$J,GMRCFT,GMRCFLD)) Q:GMRCFLD=""  S GMRCFLD(0)=^(GMRCFLD) D
"RTN","GMRCTIU3",22,0)
 .S GMRCFLDN=$P(GMRCFLD(0),"^",2) Q:GMRCFLDN[";W"
"RTN","GMRCTIU3",23,0)
 .I GMRCFLDP=GMRCFLDN S COUNT=COUNT-1,@GLOBAL@(COUNT,0)=@GLOBAL@(COUNT,0)_", "
"RTN","GMRCTIU3",24,0)
 .E  S GMRCFLDP=GMRCFLDN,@GLOBAL@(COUNT,0)=GMRCFLDP_":"_$E(TAB,1,18-$L(GMRCFLDP))
"RTN","GMRCTIU3",25,0)
 .I $L($P(GMRCFLD(0),"^",1))>45 S @GLOBAL@(COUNT,0)=@GLOBAL@(COUNT,0)_$P(GMRCFLD(0),"^",1),COUNT=COUNT+1 Q
"RTN","GMRCTIU3",26,0)
 .I $L($P(GMRCFLD(0),"^",1))'>77 S @GLOBAL@(COUNT,0)=@GLOBAL@(COUNT,0)_$P(GMRCFLD(0),"^",1)
"RTN","GMRCTIU3",27,0)
 .S COUNT=COUNT+1 Q
"RTN","GMRCTIU3",28,0)
 Q
"RTN","GMRCTIU3",29,0)
SUM ;
"RTN","GMRCTIU3",30,0)
 S GMRCSUM=$P(^TMP("MC",$J,"S"),"^",1),GMRCSUMP=$P(^TMP("MC",$J,"S"),"^",2)
"RTN","GMRCTIU3",31,0)
 I $L(GMRCSUM)!($L(GMRCSUMP)) S @GLOBAL@(COUNT,0)="SUMMARY:"
"RTN","GMRCTIU3",32,0)
 I $L(GMRCSUM) S @GLOBAL@(COUNT,0)=@GLOBAL@(COUNT,0)_$E(TAB,1,11)_GMRCSUM,COUNT=COUNT+1
"RTN","GMRCTIU3",33,0)
 I $L(GMRCSUMP) S @GLOBAL@(COUNT,0)="SUMMARY PROCEDURE: "_GMRCSUMP,COUNT=COUNT+1
"RTN","GMRCTIU3",34,0)
 Q
"RTN","GMRCTIU3",35,0)
END S GMRCCT=COUNT-1
"RTN","GMRCTIU3",36,0)
 K COUNT,GMRCH,GMRCFT,GMRCFLD,GMRCSUM,GMRCFLDN,GMRCSUMP,GMRCRTIT,GMRCPRNM,GMRCFLDP,MCC,MCK,MCMFLD,MCMUP
"RTN","GMRCTIU3",37,0)
 Q
"RTN","GMRCTIUA")
0^17^B3771284
"RTN","GMRCTIUA",1,0)
GMRCTIUA ;SLC/DCM,DLT - Add the TIU note to the results multiple ;4/30/98  11:13
"RTN","GMRCTIUA",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCTIUA",3,0)
ADD(TIUDA,GMRCO) ;Add a new note from TIU to the associated results
"RTN","GMRCTIUA",4,0)
 ;multiple and update the TIU NARRATIVE RESULT field as the last note
"RTN","GMRCTIUA",5,0)
 ;modified.
"RTN","GMRCTIUA",6,0)
 ;
"RTN","GMRCTIUA",7,0)
 ;Input parameters:
"RTN","GMRCTIUA",8,0)
 ;    TIUDA = pointer value to TIU(8925, not in variable pointer format
"RTN","GMRCTIUA",9,0)
 ;    GMRCO = consult entry from 123 to get the result
"RTN","GMRCTIUA",10,0)
 ;
"RTN","GMRCTIUA",11,0)
 N GMRCY S GMRCY=0
"RTN","GMRCTIUA",12,0)
 I '$D(^GMR(123,+GMRCO,50)),+$P(^GMR(123,+GMRCO,0),"^",20) S GMRCY=$$LOAD(GMRCO)
"RTN","GMRCTIUA",13,0)
 Q:GMRCY  ;The consult is locked
"RTN","GMRCTIUA",14,0)
 S GMRCY=$$UPDATE(TIUDA,GMRCO)
"RTN","GMRCTIUA",15,0)
 Q
"RTN","GMRCTIUA",16,0)
 ;
"RTN","GMRCTIUA",17,0)
LOAD(GMRCO) ;function to load the result from field 16 into the 50th node
"RTN","GMRCTIUA",18,0)
 N RSLT16,DR,DA,DIE,GMRCQUT
"RTN","GMRCTIUA",19,0)
 S GMRCQUT=0
"RTN","GMRCTIUA",20,0)
 S RSLT16=$P(^GMR(123,+GMRCO,0),"^",20)_";TIU(8925,"
"RTN","GMRCTIUA",21,0)
 D ADDRSLT(GMRCO,RSLT16)
"RTN","GMRCTIUA",22,0)
 Q GMRCQUT
"RTN","GMRCTIUA",23,0)
 ;
"RTN","GMRCTIUA",24,0)
UPDATE(TIUDA,GMRCO) ;Update the TIU Narrative Result last updated
"RTN","GMRCTIUA",25,0)
 N GMRCVDA,DR,DA,DIE,GMRCQUT
"RTN","GMRCTIUA",26,0)
 S GMRCQUT=0
"RTN","GMRCTIUA",27,0)
 S DIE="^GMR(123,",DA=GMRCO,DR="16////"_TIUDA D ^DIE
"RTN","GMRCTIUA",28,0)
 ;
"RTN","GMRCTIUA",29,0)
 ;Add result to the result multiple
"RTN","GMRCTIUA",30,0)
 S GMRCVDA=TIUDA_";TIU(8925,"
"RTN","GMRCTIUA",31,0)
 D ADDRSLT(GMRCO,GMRCVDA)
"RTN","GMRCTIUA",32,0)
 Q GMRCQUT
"RTN","GMRCTIUA",33,0)
 ;
"RTN","GMRCTIUA",34,0)
ADDRSLT(GMRCO,RESULT) ;Add a result to the Associated Results multiple
"RTN","GMRCTIUA",35,0)
 Q:$O(^GMR(123,GMRCO,50,"B",RESULT,0))
"RTN","GMRCTIUA",36,0)
 L +^GMR(123,+GMRCO,50):5 E  D  Q
"RTN","GMRCTIUA",37,0)
 . S GMRCQUT=1,GMRCMSG="Result did NOT get associated with consult."
"RTN","GMRCTIUA",38,0)
 . S GMRCMSG(1)="Consult in use by another user. Try again later."
"RTN","GMRCTIUA",39,0)
 . D EXAC^GMRCADC(.GMRCMSG) K GMRCMSG
"RTN","GMRCTIUA",40,0)
 ;Check if this result has already been added to the results multiple
"RTN","GMRCTIUA",41,0)
 ;If it is already defined then quit processing this consult
"RTN","GMRCTIUA",42,0)
 ;
"RTN","GMRCTIUA",43,0)
 ;Get the next DA entry for a new result and add the result.
"RTN","GMRCTIUA",44,0)
 S DA=$$ADD50(GMRCO)
"RTN","GMRCTIUA",45,0)
 S DIE="^GMR(123,"_+GMRCO_",50,",DA(1)=+GMRCO,DR=".01////^S X=RESULT"
"RTN","GMRCTIUA",46,0)
 D ^DIE
"RTN","GMRCTIUA",47,0)
 L -^GMR(123,+GMRCO,50)
"RTN","GMRCTIUA",48,0)
 Q
"RTN","GMRCTIUA",49,0)
 ;
"RTN","GMRCTIUA",50,0)
ADD50(GMRCO) ;Add a field 50 node if does not exist; add a new multiple to 50 if it already exists. Returns DA of added node if successful.
"RTN","GMRCTIUA",51,0)
 N DA
"RTN","GMRCTIUA",52,0)
 S:'$D(^GMR(123,+GMRCO,50,0)) ^(0)="^123.03V^^"
"RTN","GMRCTIUA",53,0)
 S DA=$S(+$P(^GMR(123,+GMRCO,50,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCTIUA",54,0)
 S $P(^GMR(123,+GMRCO,50,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCTIUA",55,0)
 Q DA
"RTN","GMRCTIUA",56,0)
 ;
"RTN","GMRCTIUE")
0^18^B25549514
"RTN","GMRCTIUE",1,0)
GMRCTIUE ;SLC/DCM,DLT - Complete/Update TIU notes ;7/16/98  02:10
"RTN","GMRCTIUE",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCTIUE",3,0)
ENTER(GMRCO) ; Enter a note in TIU for the consult result
"RTN","GMRCTIUE",4,0)
 ;If consult from list is defined in GMRCO, than use it.
"RTN","GMRCTIUE",5,0)
 K GMRCQUT N TIUDA,TIUCLASS
"RTN","GMRCTIUE",6,0)
 I '$L($G(GMRCO)) D SELECT^GMRCA2(.GMRCO)
"RTN","GMRCTIUE",7,0)
 Q:$D(GMRCQUT)!'$L($G(GMRCO))
"RTN","GMRCTIUE",8,0)
 D CHKSTS I $G(GMRCQUT) D EDEX Q
"RTN","GMRCTIUE",9,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCTIUE",10,0)
 ;
"RTN","GMRCTIUE",11,0)
 ;If service administrative user, than use administrative complete logic
"RTN","GMRCTIUE",12,0)
 I $$SAUSER D COMP^GMRCAAC(+GMRCO),EDEX Q
"RTN","GMRCTIUE",13,0)
 ;
"RTN","GMRCTIUE",14,0)
 ;Assume the user is a clinical user
"RTN","GMRCTIUE",15,0)
 ;Get list of notes If no new notes, add new then quit
"RTN","GMRCTIUE",16,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCTIUE",17,0)
 I '$$GETLIST(GMRCDFN,GMRCO,.GMRCTIUC) D NEW,EDEX Q
"RTN","GMRCTIUE",18,0)
 ;
"RTN","GMRCTIUE",19,0)
 ;If TIU Document already exists, use single record edit, and quit
"RTN","GMRCTIUE",20,0)
 S GMRCVF="TIU(8925,"
"RTN","GMRCTIUE",21,0)
 I GMRCTIUC(GMRCVF)=1 D  Q
"RTN","GMRCTIUE",22,0)
 . S GMRCTUFN=$$SINGLE(GMRCVF)
"RTN","GMRCTIUE",23,0)
 . I +GMRCTUFN D EDITNOTE(GMRCTUFN)
"RTN","GMRCTIUE",24,0)
 . D EDEX
"RTN","GMRCTIUE",25,0)
 . Q
"RTN","GMRCTIUE",26,0)
 ;
"RTN","GMRCTIUE",27,0)
 ;Show the list of multiple tiu results for selection
"RTN","GMRCTIUE",28,0)
 D SHOWTIU^GMRCTIUL
"RTN","GMRCTIUE",29,0)
 ;
"RTN","GMRCTIUE",30,0)
 ;Select a note from the list and then get the TIU internal entry
"RTN","GMRCTIUE",31,0)
 S GMRCSELR=$$SELR^GMRCTIUL(.GMRCTIUC)
"RTN","GMRCTIUE",32,0)
 I $D(GMRCQUT) D EDEX Q
"RTN","GMRCTIUE",33,0)
 I '+(GMRCSELR) D  D EDEX Q
"RTN","GMRCTIUE",34,0)
 . ;didn't select existing note, allow a new entry
"RTN","GMRCTIUE",35,0)
 . N DIR,X,Y
"RTN","GMRCTIUE",36,0)
 . S DIR(0)="Y",DIR("A")="Would you like to enter a new note"
"RTN","GMRCTIUE",37,0)
 . S DIR("B")="N" D ^DIR
"RTN","GMRCTIUE",38,0)
 . I Y<1 K DTOUT,DUOUT,X,Y Q
"RTN","GMRCTIUE",39,0)
 . D NEW
"RTN","GMRCTIUE",40,0)
 S GMRCTUFN=$$GETTUFN(GMRCSELR)
"RTN","GMRCTIUE",41,0)
 ;
"RTN","GMRCTIUE",42,0)
 I +GMRCTUFN D EDITNOTE(GMRCTUFN)
"RTN","GMRCTIUE",43,0)
 ;
"RTN","GMRCTIUE",44,0)
 D EDEX
"RTN","GMRCTIUE",45,0)
 Q
"RTN","GMRCTIUE",46,0)
 ;
"RTN","GMRCTIUE",47,0)
SAUSER() Q ''$D(^GMR(123.5,+$P($G(^GMR(123,+GMRCO,0)),"^",5),123.33,"B",DUZ))
"RTN","GMRCTIUE",48,0)
 ;
"RTN","GMRCTIUE",49,0)
CHKSTS ;Check the order status before allowing entry of a note
"RTN","GMRCTIUE",50,0)
 N STATUS S STATUS=$P($G(^GMR(123,+GMRCO,0)),"^",12)
"RTN","GMRCTIUE",51,0)
 I $S(STATUS=1:1,STATUS=13:1,1:0) D
"RTN","GMRCTIUE",52,0)
 . W !,"This order has been "
"RTN","GMRCTIUE",53,0)
 . W $S(STATUS=1:"DISCONTINUED",1:"CANCELLED")
"RTN","GMRCTIUE",54,0)
 . W ".  A note cannot be entered."
"RTN","GMRCTIUE",55,0)
 . D PAUSE S GMRCQUT=1
"RTN","GMRCTIUE",56,0)
 Q
"RTN","GMRCTIUE",57,0)
 ;
"RTN","GMRCTIUE",58,0)
EDITNOTE(GMRCTUFN) ;use TIU LM for an existing note
"RTN","GMRCTIUE",59,0)
 I +$D(^TIU(8925,+GMRCTUFN,0)) D  Q
"RTN","GMRCTIUE",60,0)
 . D EXSTNOTE^TIUBR1(+GMRCDFN,+GMRCTUFN)
"RTN","GMRCTIUE",61,0)
 ;
"RTN","GMRCTIUE",62,0)
 ; link is missing
"RTN","GMRCTIUE",63,0)
 W !,"A note #"_+GMRCTUFN_" is linked to the consult,"
"RTN","GMRCTIUE",64,0)
 W !,"  but the note is no longer in TIU!"
"RTN","GMRCTIUE",65,0)
 D PAUSE
"RTN","GMRCTIUE",66,0)
 Q
"RTN","GMRCTIUE",67,0)
 ;
"RTN","GMRCTIUE",68,0)
SINGLE(GMRCVF) ;Get the single result entry from the list for the file type
"RTN","GMRCTIUE",69,0)
 N RSLT,GMRCVP
"RTN","GMRCTIUE",70,0)
 S RSLT="",GMRCVP=0
"RTN","GMRCTIUE",71,0)
 F  S RSLT=$O(^TMP("GMRC50",$J,RSLT)) Q:RSLT=""  D  Q:+GMRCVP
"RTN","GMRCTIUE",72,0)
 . I $P(RSLT,";",2)=GMRCVF S GMRCVP=RSLT
"RTN","GMRCTIUE",73,0)
 Q +GMRCVP
"RTN","GMRCTIUE",74,0)
 ;
"RTN","GMRCTIUE",75,0)
GETTUFN(GMRCSELR) ;Get the result entry from the selected entry
"RTN","GMRCTIUE",76,0)
 N RSLT
"RTN","GMRCTIUE",77,0)
 S RSLT=$O(^TMP("GMRC50R",$J,GMRCSELR,""))
"RTN","GMRCTIUE",78,0)
 Q RSLT
"RTN","GMRCTIUE",79,0)
 ;
"RTN","GMRCTIUE",80,0)
NEW ;Enter a new result through TIU if implemented or old Completion logic
"RTN","GMRCTIUE",81,0)
 S TIUCLASS=+$$CLASS
"RTN","GMRCTIUE",82,0)
 I TIUCLASS'>0 D  Q
"RTN","GMRCTIUE",83,0)
 . W !!,$C(7),"Consult Resulting through TIU is not yet implemented."
"RTN","GMRCTIUE",84,0)
 . W !,"Proceeding with Administrative Complete."
"RTN","GMRCTIUE",85,0)
 . D COMP^GMRCAAC(+GMRCO)
"RTN","GMRCTIUE",86,0)
 ;
"RTN","GMRCTIUE",87,0)
 D MAIN^TIUEDIT(TIUCLASS,.TIUDA,GMRCDFN,"","","","",1)
"RTN","GMRCTIUE",88,0)
 ;
"RTN","GMRCTIUE",89,0)
 ;If TIU returns TIUDA, than update file 123
"RTN","GMRCTIUE",90,0)
 ;I +$G(TIUDA),$D(^TIU(8925,+$G(TIUDA),0)) D ADD^GMRCTIUA(+TIUDA,GMRCO)
"RTN","GMRCTIUE",91,0)
 Q
"RTN","GMRCTIUE",92,0)
 ;
"RTN","GMRCTIUE",93,0)
CLASS() ; What is the TIU Class (or Document Class) for CONSULTS
"RTN","GMRCTIUE",94,0)
 N GMRCY
"RTN","GMRCTIUE",95,0)
 S GMRCY=+$O(^TIU(8925.1,"B","CONSULTS",0))
"RTN","GMRCTIUE",96,0)
 I +GMRCY>0,$S($P($G(^TIU(8925.1,+GMRCY,0)),U,4)="CL":0,$P($G(^(0)),U,4)="DC":0,1:1) S GMRCY=0
"RTN","GMRCTIUE",97,0)
 Q GMRCY
"RTN","GMRCTIUE",98,0)
 ;
"RTN","GMRCTIUE",99,0)
GETLIST(GMRCDFN,GMRCO,GMRCLIST) ;
"RTN","GMRCTIUE",100,0)
 ;
"RTN","GMRCTIUE",101,0)
 N GMRCVF
"RTN","GMRCTIUE",102,0)
 ;
"RTN","GMRCTIUE",103,0)
 D GETLIST^GMRCTIUL(GMRCO,2,1,.GMRCTIUC)
"RTN","GMRCTIUE",104,0)
 S GMRCVF="TIU(8925,"
"RTN","GMRCTIUE",105,0)
 Q +$G(GMRCTIUC(GMRCVF))
"RTN","GMRCTIUE",106,0)
 ;
"RTN","GMRCTIUE",107,0)
ADDEND(GMRCO) ; Make an addendum action for a selected consult
"RTN","GMRCTIUE",108,0)
 N TIUDA,GMRCTX,GMRCDFN,GMRCADUZ,RSLTINFO,GMRCACT,GMRCTIUC
"RTN","GMRCTIUE",109,0)
 K GMRCQUT
"RTN","GMRCTIUE",110,0)
 I '$L($G(GMRCO)) D SELECT^GMRCA2(.GMRCO)
"RTN","GMRCTIUE",111,0)
 Q:$D(GMRCQUT)!'+($G(GMRCO))
"RTN","GMRCTIUE",112,0)
 ;
"RTN","GMRCTIUE",113,0)
 ;If service administrative user, then QUIT.
"RTN","GMRCTIUE",114,0)
 I $$SAUSER D EXAC^GMRCADC("You do not have the ability to edit this note.") Q
"RTN","GMRCTIUE",115,0)
 ;
"RTN","GMRCTIUE",116,0)
 ;Assume the user is a clinical user
"RTN","GMRCTIUE",117,0)
 ;
"RTN","GMRCTIUE",118,0)
 ;Get list of notes for this consult. if no notes, then quit.
"RTN","GMRCTIUE",119,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCTIUE",120,0)
 I '$$GETLIST(GMRCDFN,+GMRCO,.GMRCTIUC) D  Q
"RTN","GMRCTIUE",121,0)
 . W !,"This consult does not yet have an associated note."
"RTN","GMRCTIUE",122,0)
 . W !,"  Use the Complete action to enter a new note."
"RTN","GMRCTIUE",123,0)
 . D PAUSE,EDEX
"RTN","GMRCTIUE",124,0)
 ;
"RTN","GMRCTIUE",125,0)
 ;If TIU Document already exists, use single record edit, and quit
"RTN","GMRCTIUE",126,0)
 S GMRCVF="TIU(8925,"
"RTN","GMRCTIUE",127,0)
 I GMRCTIUC(GMRCVF)=1 D  Q
"RTN","GMRCTIUE",128,0)
 . S GMRCTUFN=$$SINGLE(GMRCVF)
"RTN","GMRCTIUE",129,0)
 . Q:'+GMRCTUFN
"RTN","GMRCTIUE",130,0)
 . D SHOWTIU^GMRCTIUL
"RTN","GMRCTIUE",131,0)
 . N GMRCVP,RSLTINFO,AUTHOR
"RTN","GMRCTIUE",132,0)
 . S GMRCVP=+GMRCTUFN_";"_GMRCVF
"RTN","GMRCTIUE",133,0)
 . S RSLTIEN=$O(^TMP("GMRC50",$J,GMRCVP,0))
"RTN","GMRCTIUE",134,0)
 . S RSLTINFO=$G(^TMP("GMRC50",$J,GMRCVP,RSLTIEN))
"RTN","GMRCTIUE",135,0)
 . I $P(RSLTINFO,"^",6)="completed" D ADDEND1(+GMRCTUFN) Q
"RTN","GMRCTIUE",136,0)
 . I (DUZ=+$P(RSLTINFO,"^",4)) D EDITNOTE(+GMRCTUFN) Q
"RTN","GMRCTIUE",137,0)
 . W !,"You may not addend to the incomplete associated note."
"RTN","GMRCTIUE",138,0)
 . W !,"You are not the author of the existing note."
"RTN","GMRCTIUE",139,0)
 . I $$READ^GMRCACMT("Y","Do you want to add a new note ","YES") D NEW
"RTN","GMRCTIUE",140,0)
 . D EDEX
"RTN","GMRCTIUE",141,0)
 . Q
"RTN","GMRCTIUE",142,0)
 ;
"RTN","GMRCTIUE",143,0)
 ;Show the list of multiple tiu results for selection
"RTN","GMRCTIUE",144,0)
 D SHOWTIU^GMRCTIUL
"RTN","GMRCTIUE",145,0)
 ;
"RTN","GMRCTIUE",146,0)
 ;Select a note from the list and then get the TIU internal entry
"RTN","GMRCTIUE",147,0)
 S GMRCSELR=$$SELR^GMRCTIUL(.GMRCTIUC)
"RTN","GMRCTIUE",148,0)
 I $D(GMRCQUT)!'+(GMRCSELR) D EDEX Q
"RTN","GMRCTIUE",149,0)
 S GMRCTUFN=$$GETTUFN(GMRCSELR)
"RTN","GMRCTIUE",150,0)
 ;
"RTN","GMRCTIUE",151,0)
 I +GMRCTUFN D ADDEND1(+GMRCTUFN) Q  ; *** SLC/JER 7/7 ***
"RTN","GMRCTIUE",152,0)
 ;
"RTN","GMRCTIUE",153,0)
 D EDEX
"RTN","GMRCTIUE",154,0)
 Q
"RTN","GMRCTIUE",155,0)
ADDEND1(TIUDA) ;Add an addendum
"RTN","GMRCTIUE",156,0)
 ;
"RTN","GMRCTIUE",157,0)
 D FULL^VALM1,ADDEND1^TIURA1
"RTN","GMRCTIUE",158,0)
 Q
"RTN","GMRCTIUE",159,0)
 ;
"RTN","GMRCTIUE",160,0)
EDEX K GMRCDFN,GMRCO,GMRCQUT,GMRCTUFN,GMRCSEL
"RTN","GMRCTIUE",161,0)
 Q
"RTN","GMRCTIUE",162,0)
 ;
"RTN","GMRCTIUE",163,0)
PAUSE ; Pause for user
"RTN","GMRCTIUE",164,0)
 ;
"RTN","GMRCTIUE",165,0)
 N X W !,"Press <RETURN> to continue: " R X:DTIME E  W " (timeout)"
"RTN","GMRCTIUE",166,0)
 Q
"RTN","GMRCTIUE",167,0)
 ;
"RTN","GMRCTIUL")
0^19^B15841263
"RTN","GMRCTIUL",1,0)
GMRCTIUL ;SLC/DCM,DLT - Get list of existing results for consults ;5/01/98  10:09
"RTN","GMRCTIUL",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCTIUL",3,0)
GETLIST(GMRCO,GETWHAT,TYPE,GMRCNT) ;Get the count and list of results
"RTN","GMRCTIUL",4,0)
 ;Input variables:
"RTN","GMRCTIUL",5,0)
 ;GMRCO=consult entry from 123
"RTN","GMRCTIUL",6,0)
 ;GETWHAT=how much to return
"RTN","GMRCTIUL",7,0)
 ;       0 = count only returned
"RTN","GMRCTIUL",8,0)
 ;       1 = count + ^TMP internal values from TIU
"RTN","GMRCTIUL",9,0)
 ;       2 = count + ^TMP internal values from TIU
"RTN","GMRCTIUL",10,0)
 ;                 + ^TMP display format array
"RTN","GMRCTIUL",11,0)
 ;TYPE=what type of results to return
"RTN","GMRCTIUL",12,0)
 ;       0=all types
"RTN","GMRCTIUL",13,0)
 ;       1=TIU only
"RTN","GMRCTIUL",14,0)
 ;       2=Medicine results only
"RTN","GMRCTIUL",15,0)
 ;returns GMRCNT() = result count
"RTN","GMRCTIUL",16,0)
 ;        ^TMP("GMRC50",$J,GMRCRVP,GMRCRIEN)=summary data from source
"RTN","GMRCTIUL",17,0)
 ;             where GMRCRVP is the variable pointer value
"RTN","GMRCTIUL",18,0)
 ;             where GMRCRIEN is the entry in the 50th node
"RTN","GMRCTIUL",19,0)
 ;        ^TMP("GMRC50R",$J,GMRCRIEN)= external list for review
"RTN","GMRCTIUL",20,0)
 N COUNT,GMRCRIEN,TAB
"RTN","GMRCTIUL",21,0)
 K ^TMP("GMRC50",$J),^TMP("GMRC50R",$J),GMRCNT
"RTN","GMRCTIUL",22,0)
 S (COUNT,GMRCRIEN)=0,GMRCNT(0)=COUNT
"RTN","GMRCTIUL",23,0)
 S TAB="",$P(TAB," ",30)=""
"RTN","GMRCTIUL",24,0)
 ;Get results from the result multiple
"RTN","GMRCTIUL",25,0)
 F  S GMRCRIEN=$O(^GMR(123,+GMRCO,50,GMRCRIEN)) Q:'GMRCRIEN  D  I $G(GMRCQUT) K GMRCQUT Q
"RTN","GMRCTIUL",26,0)
 . S GMRCRVP=$P($G(^GMR(123,+GMRCO,50,+GMRCRIEN,0)),"^",1) I GMRCRVP="" S GMRCQUT=1 Q
"RTN","GMRCTIUL",27,0)
 . D UPDCNT
"RTN","GMRCTIUL",28,0)
 . Q
"RTN","GMRCTIUL",29,0)
 ;Get TIU NARRATIVE RESULT if the result multiple is not loaded yet
"RTN","GMRCTIUL",30,0)
 I COUNT=0,'$D(^GMR(123,+GMRCO,50)),+$P(^GMR(123,+GMRCO,0),"^",20) D
"RTN","GMRCTIUL",31,0)
 . S GMRCRVP=$P($G(^GMR(123,+GMRCO,0)),"^",20)_";TIU(8925,"
"RTN","GMRCTIUL",32,0)
 . D UPDCNT
"RTN","GMRCTIUL",33,0)
 . Q
"RTN","GMRCTIUL",34,0)
 S GMRCNT(0)=COUNT
"RTN","GMRCTIUL",35,0)
 Q
"RTN","GMRCTIUL",36,0)
 ;
"RTN","GMRCTIUL",37,0)
UPDCNT ;Update count of existing results for the consult and build array
"RTN","GMRCTIUL",38,0)
 S GMRCVF=$P(GMRCRVP,";",2)
"RTN","GMRCTIUL",39,0)
 I '$G(GMRCNT(GMRCVF)) S GMRCNT(GMRCVF)=0
"RTN","GMRCTIUL",40,0)
 S COUNT=COUNT+1
"RTN","GMRCTIUL",41,0)
 S GMRCNT(GMRCVF)=GMRCNT(GMRCVF)+1
"RTN","GMRCTIUL",42,0)
 I +GETWHAT,TYPE=1 D TIUTMP(+GETWHAT)
"RTN","GMRCTIUL",43,0)
 Q
"RTN","GMRCTIUL",44,0)
 ;
"RTN","GMRCTIUL",45,0)
TIUTMP(GETWHAT) ;build ^TMP array for results based on TIU when type=1
"RTN","GMRCTIUL",46,0)
 I '$D(^TIU(8925,+$G(GMRCRVP),0)) D  Q
"RTN","GMRCTIUL",47,0)
 .W !,"Associated note ",+$G(GMRCRVP)," is no longer defined in TIU."
"RTN","GMRCTIUL",48,0)
 .S COUNT=COUNT-1
"RTN","GMRCTIUL",49,0)
 .S GMRCNT(GMRCVF)=GMRCNT(GMRCVF)-1
"RTN","GMRCTIUL",50,0)
 S ^TMP("GMRC50",$J,GMRCRVP,COUNT)=$$RESOLVE^TIUSRVLO(+GMRCRVP)
"RTN","GMRCTIUL",51,0)
 Q:GETWHAT=1  ;get internal value global
"RTN","GMRCTIUL",52,0)
 N GMRCRDAT,GMRCDOCT,GMRCEDT,GMRCAUTH,GMRCSTS,GMRCTX
"RTN","GMRCTIUL",53,0)
 S GMRCRDAT=^TMP("GMRC50",$J,GMRCRVP,COUNT)
"RTN","GMRCTIUL",54,0)
 S GMRCDOCT=$E($P(GMRCRDAT,"^",1),1,19)
"RTN","GMRCTIUL",55,0)
 S GMRCEDT=$$FMTE^XLFDT(GMRCRDAT,"D") 
"RTN","GMRCTIUL",56,0)
 S GMRCAUTH=$E($P($G(^VA(200,+$P(GMRCRDAT,"^",4),0)),U,1),1,12)
"RTN","GMRCTIUL",57,0)
 S GMRCSTS=$E($P(GMRCRDAT,"^",6),1,5)
"RTN","GMRCTIUL",58,0)
 S GMRCTX=$J(COUNT,3)_"> "_$E(GMRCDOCT_TAB,1,20)_$E("#"_+GMRCRVP_TAB,1,9)_$E(GMRCEDT_TAB,1,13)_$E(GMRCAUTH_TAB,1,14)_$E(GMRCSTS_TAB,1,6)_$E("#"_+$P(GMRCRDAT,"^",9)_TAB,1,10)
"RTN","GMRCTIUL",59,0)
 S ^TMP("GMRC50R",$J,COUNT,GMRCRVP)=GMRCTX
"RTN","GMRCTIUL",60,0)
 Q
"RTN","GMRCTIUL",61,0)
 ;
"RTN","GMRCTIUL",62,0)
PROCTMP ;build ^TMP array for procedure results when type note=1
"RTN","GMRCTIUL",63,0)
 Q:TYPE=1
"RTN","GMRCTIUL",64,0)
 Q
"RTN","GMRCTIUL",65,0)
 ;
"RTN","GMRCTIUL",66,0)
SHOWTIU ;Display the current TIU results available
"RTN","GMRCTIUL",67,0)
 N GMRCVP,GMRCRCT
"RTN","GMRCTIUL",68,0)
 W !,"Notes associated with this consult:",!
"RTN","GMRCTIUL",69,0)
 W !," No.  Document Title       TIU    Entered      Author        Sts  Consult"
"RTN","GMRCTIUL",70,0)
 S GMRCRCT=0
"RTN","GMRCTIUL",71,0)
 F  S GMRCRCT=$O(^TMP("GMRC50R",$J,GMRCRCT)) Q:'+GMRCRCT  D
"RTN","GMRCTIUL",72,0)
 . S GMRCRVP=$O(^TMP("GMRC50R",$J,GMRCRCT,""))
"RTN","GMRCTIUL",73,0)
 . W !,^TMP("GMRC50R",$J,GMRCRCT,GMRCRVP)
"RTN","GMRCTIUL",74,0)
 Q
"RTN","GMRCTIUL",75,0)
SELR(GMRCRCT) ;Select a note from the list
"RTN","GMRCTIUL",76,0)
 ;Input GMRCNT=array with the count of TIU notes
"RTN","GMRCTIUL",77,0)
 I '+$G(GMRCRCT("TIU(8925,")),'+$O(^TMP("GMRC50R",$J,0)) S GMRCMSG="No results available" D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q 0
"RTN","GMRCTIUL",78,0)
 ;Select a note
"RTN","GMRCTIUL",79,0)
 N DIR,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRCTIUL",80,0)
 S DIR("A")="Select an existing note"
"RTN","GMRCTIUL",81,0)
 S DIR(0)="NO^1:"_GMRCRCT("TIU(8925,")
"RTN","GMRCTIUL",82,0)
 D ^DIR
"RTN","GMRCTIUL",83,0)
 Q +Y
"RTN","GMRCTIUL",84,0)
LN1 ;Used by filemanager print template to format line
"RTN","GMRCTIUL",85,0)
 S:'$G(COUNT) COUNT=1
"RTN","GMRCTIUL",86,0)
 S GMRCVF="TIU(8925,",GMRCNT(GMRCVF)=1,TAB=" "
"RTN","GMRCTIUL",87,0)
 S GMRCRVP=+($G(^GMR(123,D0,50,D1,0)))
"RTN","GMRCTIUL",88,0)
 Q:'GMRCRVP
"RTN","GMRCTIUL",89,0)
 N GMRCDOCT,GMRCEDT
"RTN","GMRCTIUL",90,0)
 S GMRCRDAT=$$RESOLVE^TIUSRVLO(+GMRCRVP)
"RTN","GMRCTIUL",91,0)
 S GMRCDOCT=$E($P(GMRCRDAT,"^",1),1,19)
"RTN","GMRCTIUL",92,0)
 S GMRCEDT=$$FMTE^XLFDT(GMRCRDAT,"D")
"RTN","GMRCTIUL",93,0)
 S GMRCTX=$E("#"_+GMRCRVP_TAB,1,9)_$E(GMRCDOCT_TAB,1,22)_$E(GMRCEDT_TAB,1,13)_$P(GMRCRDAT,U,3)
"RTN","GMRCTIUL",94,0)
 W GMRCTX
"RTN","GMRCTIUL",95,0)
 Q
"RTN","GMRCTIUL",96,0)
LN2 ;Used by Fileman to write second line
"RTN","GMRCTIUL",97,0)
 N GMRCAUTH,GMRCSTS
"RTN","GMRCTIUL",98,0)
 S GMRCAUTH=$E($P($G(^VA(200,+$P(GMRCRDAT,"^",4),0)),U,1),1,12)
"RTN","GMRCTIUL",99,0)
 S GMRCSTS=$E($P(GMRCRDAT,"^",6),1,5)
"RTN","GMRCTIUL",100,0)
 S GMRCTX=$E(TAB,1,5)_$E("Author: "_GMRCAUTH_TAB,1,16)_$E(GMRCSTS_TAB,1,8)_$E("#"_+$P(GMRCRDAT,"^",9)_TAB,1,10)
"RTN","GMRCTIUL",101,0)
 W GMRCTX
"RTN","GMRCTIUL",102,0)
 Q
"RTN","GMRCTIUL",103,0)
 ;
"RTN","GMRCTIUP")
0^20^B53267990
"RTN","GMRCTIUP",1,0)
GMRCTIUP ;SLC/DCM - TIU utilities for exchanging info with Consults ;7/16/98  02:11
"RTN","GMRCTIUP",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCTIUP",3,0)
HDR(GMRCTUPR,GMRCGLB,COUNT,FROM) ;Get Source info for header of display
"RTN","GMRCTIUP",4,0)
 ;and place data in ^TMP( global. Do Not Show Any Results
"RTN","GMRCTIUP",5,0)
 ;GMRCTUPR=TIU record being sought
"RTN","GMRCTIUP",6,0)
 ;GMRCGLOB=Global where data goes - i.e., ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,LINECT,0)
"RTN","GMRCTIUP",7,0)
 ;COUNT=Count of where current line is to go in ^TMP( global
"RTN","GMRCTIUP",8,0)
 ;FROM=flag to tell whether to add Addendum TIU # or not 0=NO, Otherwise addendum number
"RTN","GMRCTIUP",9,0)
 N DR,GMRCTMP
"RTN","GMRCTIUP",10,0)
 S:'$D(FROM) FROM=""
"RTN","GMRCTIUP",11,0)
 S DR=".01;.05;.09;1201;1202;1204;1208;1302",GMRCERR=""
"RTN","GMRCTIUP",12,0)
 D EXTRACT^TIULQ(GMRCPTR,"LOCAL",.GMRCERR,DR)
"RTN","GMRCTIUP",13,0)
 S @GMRCGLB@(COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCTIUP",14,0)
 S @GMRCGLB@(COUNT,0)="Source Information",COUNT=COUNT+1,@GMRCGLB@(COUNT,0)=""
"RTN","GMRCTIUP",15,0)
 S @GMRCGLB@(COUNT,0)="  Document Status: "_LOCAL(GMRCPTR,.05,"E"),COUNT=COUNT+1
"RTN","GMRCTIUP",16,0)
 S @GMRCGLB@(COUNT,0)="       Entry Date: "_$E($P($G(LOCAL(GMRCPTR,1201,"E")),":",1,2)_TAB,1,30)_"        Author: "_$E(LOCAL(GMRCPTR,1202,"E"),1,30),COUNT=COUNT+1
"RTN","GMRCTIUP",17,0)
 S @GMRCGLB@(COUNT,0)="  Expected Signer: "_$E(LOCAL(GMRCPTR,1204,"E")_TAB,1,22)_$E(TAB,1,5)_"Expected Cosigner: "_$S($L($G(LOCAL(GMRCPTR,1208,"E"))):LOCAL(GMRCPTR,1208,"E"),1:"None"),COUNT=COUNT+1
"RTN","GMRCTIUP",18,0)
 S @GMRCGLB@(COUNT,0)="       Entered By: "_$E(LOCAL(GMRCPTR,1302,"E")_TAB,1,30)_"TIU Document #: "_GMRCTUPR,COUNT=COUNT+1
"RTN","GMRCTIUP",19,0)
 S @GMRCGLB@(COUNT,0)=$S(+FROM:"  TIU Addendum Document #: "_FROM,1:"")_$S(+FROM:$E(TAB,1,10),1:"     ")_"     Urgency: "_$S($L($G(LOCAL(GMRCPTR,.09,"E"))):LOCAL(GMRCPTR,.09,"E"),1:"None"),COUNT=COUNT+1
"RTN","GMRCTIUP",20,0)
 S @GMRCGLB@(COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCTIUP",21,0)
 ;S GMRCTMP=$G(LOCAL(GMRCPTR,.05,"E")) S GMRCTMP=$S($L(GMRCTMP)&(GMRCTMP'="COMPLETED"):GMRCTMP,GMRCTMP="COMPLETED":"UNVERIFIED",1:"UNSIGNED")
"RTN","GMRCTIUP",22,0)
 ;S @GMRCGLB@(COUNT,0)="You may not VIEW this "_GMRCTMP_" "_$G(LOCAL(GMRCPTR,.01,"E"))_" consult"_$S(+FROM:" Addendum",1:"")_".",COUNT=COUNT+1
"RTN","GMRCTIUP",23,0)
 ;S @GMRCGLB@(COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCTIUP",24,0)
 K LOCAL
"RTN","GMRCTIUP",25,0)
 Q
"RTN","GMRCTIUP",26,0)
PRINT(GMRCO,LINECT,GMRCRT) ;get TIU results and prepare them for printing on the 513
"RTN","GMRCTIUP",27,0)
 ;GMRCRT=Flag from RT^GMRCA1 indicating that result request is from there: GMRCRT=0 means 'NO', GRMRCRT=1 means 'YES" (and ES is appended to TIU main result); also, 
"RTN","GMRCTIUP",28,0)
 ;    No result is passed back to print on the 513 if GMRCRT=0.
"RTN","GMRCTIUP",29,0)
 ;GMRCTUFN=IEN of the TIU result from file 8925
"RTN","GMRCTIUP",30,0)
 ;GMRCSIG=signature block name of signer : GMRCSDT=date result was signed
"RTN","GMRCTIUP",31,0)
 ;GMRCSIGT=signers block title : GMRCTUFN=TIU IEN of the result record
"RTN","GMRCTIUP",32,0)
 ;GMRCCSIG=cosigners block name : GMRCCSDT=date cosigner signed
"RTN","GMRCTIUP",33,0)
 ;GMRCCTIT=cosigners block title : GMRCSIGM=Signature mode (E:ELECTRONIC/C:CHART)
"RTN","GMRCTIUP",34,0)
 N GMRCTUFN,TAB
"RTN","GMRCTIUP",35,0)
 S:'$D(GMRCRT) GMRCRT=0
"RTN","GMRCTIUP",36,0)
 D GETRSLTS(GMRCO,.GMRCAR) ;I $D(GMRCQUT) D:$D(GMRCMSG) EXAC^GMRCADC(GMRCMSG) K GMRCMSG,GMRCRT Q
"RTN","GMRCTIUP",37,0)
 S GLOBAL="^TMP(""GMRCR"",$J,""GMRCTIU"")",TAB="",$P(TAB," ",31)=""
"RTN","GMRCTIUP",38,0)
 K ^TMP("GMRCR",$J,"RES"),^TMP("GMRCR",$J,"MCAR")
"RTN","GMRCTIUP",39,0)
 S (GMRCND,GMRCPTR)="" F  K @GLOBAL S GMRCND=$O(GMRCAR(GMRCND)) Q:GMRCND=""  S GMRCPKG=$P(GMRCND,";",2),GMRCPTR=$P(GMRCND,";",1) D
"RTN","GMRCTIUP",40,0)
 .S DR=".01;1204;1501;1502;1503;1504;1505;1506;1507;1508;1509;1510;1511;1601;1602;1603;1604;1605"
"RTN","GMRCTIUP",41,0)
 .I $E(GMRCPKG,1,3)="TIU" D EXTRACT^TIULQ(GMRCPTR,GLOBAL,.GMRCERR,DR,"",1,"") D
"RTN","GMRCTIUP",42,0)
 ..I '$O(@GLOBAL@(GMRCPTR,"TEXT",0)) S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="No Results Exist For TIU Record # "_GMRCPTR_"." Q
"RTN","GMRCTIUP",43,0)
 ..;I +$G(GMRCRT) D HDR(GMRCPTR,"^TMP(""GMRCR"",$J,""RES"",GMRCPTR,""TEXT"")",.LINECT,0)
"RTN","GMRCTIUP",44,0)
 ..S GMRCSIG=$G(@GLOBAL@(GMRCPTR,1503)),GMRCCSIG=$G(@GLOBAL@(GMRCPTR,1509))
"RTN","GMRCTIUP",45,0)
 ..S:$L(GMRCCSIG)&(GMRCRT) GMRCCSIG=$S($G(@GLOBAL@(GMRCPTR,1511))="electronic":"Signature: /es/",1:"")_GMRCCSIG
"RTN","GMRCTIUP",46,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCSIG")=$S($L(GMRCSIG):GMRCSIG,1:$G(@GLOBAL@(GMRCPTR,1204)))
"RTN","GMRCTIUP",47,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCSDT")=$G(@GLOBAL@(GMRCPTR,1501))
"RTN","GMRCTIUP",48,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCSIGT")=$G(@GLOBAL@(GMRCPTR,1504))
"RTN","GMRCTIUP",49,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCSIGM")=$G(@GLOBAL@(GMRCPTR,1505))
"RTN","GMRCTIUP",50,0)
 ..;get xtra signers
"RTN","GMRCTIUP",51,0)
 ..N XTRA,LINE S (XTRA,LINE)=0 F  S XTRA=$O(@GLOBAL@(GMRCPTR,"EXTRASGNR",XTRA)) Q:'XTRA  D
"RTN","GMRCTIUP",52,0)
 ...S LINE=LINE+1
"RTN","GMRCTIUP",53,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCXTRA",LINE,0)=$$FMTE^XLFDT(@GLOBAL@(GMRCPTR,"EXTRASGNR",XTRA,"DATE"))_$$REPEAT^XLFSTR(" ",7)_^("NAME")
"RTN","GMRCTIUP",54,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCXTRA",LINE,1)=$$REPEAT^XLFSTR(" ",28)_$G(@GLOBAL@(GMRCPTR,"EXTRASGNR",XTRA,"TITLE"))
"RTN","GMRCTIUP",55,0)
 ..;cosig info
"RTN","GMRCTIUP",56,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCCSIG")=GMRCCSIG
"RTN","GMRCTIUP",57,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCCSDT")=$G(@GLOBAL@(GMRCPTR,1507))
"RTN","GMRCTIUP",58,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCCTIT")=$G(@GLOBAL@(GMRCPTR,1510))
"RTN","GMRCTIUP",59,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCCSGM")=$G(@GLOBAL@(GMRCPTR,1511))
"RTN","GMRCTIUP",60,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCRPT")=$G(@GLOBAL@(GMRCPTR,.01))
"RTN","GMRCTIUP",61,0)
 ..I $O(@GLOBAL@(GMRCPTR,"TEXT",0)) D
"RTN","GMRCTIUP",62,0)
 ...S ND=0 F  S ND=$O(@GLOBAL@(GMRCPTR,"TEXT",ND)) Q:ND=""  S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)=@GLOBAL@(GMRCPTR,"TEXT",ND,0),LINECT=LINECT+1 ;S:'$D(NDS) NDS=ND
"RTN","GMRCTIUP",63,0)
 ...I GMRCRT S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="",LINECT=LINECT+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="Signature: /es/"_GMRCSIG_"         Date: "_$G(@GLOBAL@(GMRCPTR,1501)),LINECT=LINECT+1 K NDS
"RTN","GMRCTIUP",64,0)
 ...I GMRCRT,$D(@GLOBAL@(GMRCPTR,1509)),$L(^(1509)) S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="Co-signature: /es/ "_@GLOBAL@(GMRCPTR,1509)_"    Date:  "_$G(@GLOBAL@(GMRCPTR,1507))
"RTN","GMRCTIUP",65,0)
 ...Q
"RTN","GMRCTIUP",66,0)
 ..I $O(@GLOBAL@(GMRCPTR,"ZADD",0)) S GMRCADD=0 F  S GMRCADD=$O(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD)) Q:GMRCADD=""  D
"RTN","GMRCTIUP",67,0)
 ...S ND1=1
"RTN","GMRCTIUP",68,0)
 ...I '$L(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1502,"E")) ;D UNSIGN(GMRCADD,"^TMP(""GMRCR"",$J,""RES"",GMRCPTR,""ADD"",GMRCADD)",ND1,GMRCPTR) K GMRCTXT Q
"RTN","GMRCTIUP",69,0)
 ...S ND=0 F  S ND=$O(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,"TEXT",ND)) Q:ND=""  S ND1=ND1+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)=@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,"TEXT",ND,0)
"RTN","GMRCTIUP",70,0)
 ...S ND1=ND1+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)=""
"RTN","GMRCTIUP",71,0)
 ...I +GMRCRT D
"RTN","GMRCTIUP",72,0)
 ....S ND1=ND1+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)="Signature: "_$S(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1505,"E")="electronic":"/es/ ",1:"")_@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1503,"E")
"RTN","GMRCTIUP",73,0)
 ....S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)=^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)_$S(GMRCRT=1:"    Date:  "_$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1501,"E")),1:"")
"RTN","GMRCTIUP",74,0)
 ....I $L($G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1507,"E"))) D
"RTN","GMRCTIUP",75,0)
 .....S ND1=ND1+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)="Co-signature: /es/ "_(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1508,"E"))_"    Date:  "_(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1507,"E"))
"RTN","GMRCTIUP",76,0)
 ....Q
"RTN","GMRCTIUP",77,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCSGNM")=$S(GMRCRT=1:"/es/",1:"")_$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1502,"E"))
"RTN","GMRCTIUP",78,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCTIT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1504,"E"))
"RTN","GMRCTIUP",79,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCNMDT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1501,"E"))
"RTN","GMRCTIUP",80,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCTIT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1504,"E"))
"RTN","GMRCTIUP",81,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCTIT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1504,"E"))
"RTN","GMRCTIUP",82,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCMODE")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1505,"E"))
"RTN","GMRCTIUP",83,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCCSIG")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1509,"E"))
"RTN","GMRCTIUP",84,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCCSDT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1507,"I"))
"RTN","GMRCTIUP",85,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCCTIT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1510,"E"))
"RTN","GMRCTIUP",86,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCCSGM")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1511,"E"))
"RTN","GMRCTIUP",87,0)
 ...Q
"RTN","GMRCTIUP",88,0)
 ..I +$G(GMRCRT) D HDR(GMRCPTR,"^TMP(""GMRCR"",$J,""RES"",GMRCPTR,""TEXT"")",.LINECT,0)
"RTN","GMRCTIUP",89,0)
 ..Q
"RTN","GMRCTIUP",90,0)
 .I $E(GMRCPKG,1,4)="MCAR" S GMRCSR=GMRCND,MCFILE=$P(GMRCSR,";",2),MCFILE=$P(MCFILE,","),MCPROC=$O(^MCAR(697.2,"C",MCFILE,"")) Q:'MCPROC  D
"RTN","GMRCTIUP",91,0)
 ..S GMRCPRNM=$P(^MCAR(697.2,MCPROC,0),"^",8),ORIFN=$P(^GMR(123,GMRCO,0),"^",3),ORACTION=8,MCGLOBAL="^TMP(""GMRCR"",$J,""MCAR"","_GMRCPTR_")"
"RTN","GMRCTIUP",92,0)
 ..D EN^GMRCTIU3(GMRCO,ORIFN,MCGLOBAL,LINECT) K ^TMP("MC",$J)
"RTN","GMRCTIUP",93,0)
 ..Q
"RTN","GMRCTIUP",94,0)
 .Q
"RTN","GMRCTIUP",95,0)
 K DR,GLOGAL,GMRCSR,GMRCAR,GMRCPKG,GMRCPRNM,MCFILE,MCPROC,ORACTION,ORIFN,MCGLOBAL,ND,ND1
"RTN","GMRCTIUP",96,0)
 Q
"RTN","GMRCTIUP",97,0)
GETNOTE(GMRCO,FILE) ;Get the last result added to the record - this is found in $P(^(0),"^",20)
"RTN","GMRCTIUP",98,0)
 ;Function returns last note added to record.
"RTN","GMRCTIUP",99,0)
 ;If it does not contain the file pointer, it is assumed that
"RTN","GMRCTIUP",100,0)
 ;it pointed to the TIU file 8925
"RTN","GMRCTIUP",101,0)
 ;GMRCO=file 123 IEN
"RTN","GMRCTIUP",102,0)
 ;FILE='MCAR' to get last medicine result pointer
"RTN","GMRCTIUP",103,0)
 ;FILE='TIU' to get last TIU result pointer
"RTN","GMRCTIUP",104,0)
 N X
"RTN","GMRCTIUP",105,0)
 I FILE="TIU" S X=$P(^GMR(123,GMRCO,0),"^",20) I $L(X),'$L($P(X,";",2)) S X=X_";TIU(8925,"
"RTN","GMRCTIUP",106,0)
 I FILE="MCAR" S X=$P(^GMR(123,GMRCO,0),"^",15)
"RTN","GMRCTIUP",107,0)
 Q X
"RTN","GMRCTIUP",108,0)
GETRSLTS(GMRCO,ARRAY) ;Get the results from record and return it in array 'ARRAY')
"RTN","GMRCTIUP",109,0)
 ;Looks for results in $P(^(0),"^",20),$P(^(0),"^",15) and Field 50 multiple
"RTN","GMRCTIUP",110,0)
 ;GMRCO=File 123 IEN
"RTN","GMRCTIUP",111,0)
 ;ARRAY=array to return results pointers in
"RTN","GMRCTIUP",112,0)
 ;ARRAY will be returned as ARRAY("IEN;FILE"), as e.g., "1289;^TIU(8925,"
"RTN","GMRCTIUP",113,0)
 N X
"RTN","GMRCTIUP",114,0)
 S X=$$GETNOTE(GMRCO,"TIU") I $L(X) S:$P(X,";",2)="" X=X_";TIU(8925," S ARRAY(X)=""
"RTN","GMRCTIUP",115,0)
 S X=$$GETNOTE(GMRCO,"MCAR") I $L(X) S ARRAY(X)=""
"RTN","GMRCTIUP",116,0)
 S X="" F  S X=$O(^GMR(123,GMRCO,50,"B",X)) Q:X?1A.E!(X="")  S ARRAY(X)=""
"RTN","GMRCTIUP",117,0)
 Q
"RTN","GMRCUTIL")
0^33^B10352521
"RTN","GMRCUTIL",1,0)
GMRCUTIL ;SLC/DCM - Utilities for formatting word procesing fields and setting into ^TMP("GMRCR" globals for use by List Manager routines ;4/30/98  10:47
"RTN","GMRCUTIL",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCUTIL",3,0)
GSET(LN,GLOB,J1,FLG) ;Set the word processing formatted local array WP() fields into the ^TMP Global.
"RTN","GMRCUTIL",4,0)
 ;  LN:  Line in the ^TMP global where the data is to be placed.  LN is
"RTN","GMRCUTIL",5,0)
 ;       incremented and passed back to the calling routine so that it
"RTN","GMRCUTIL",6,0)
 ;       can set data into the next global node as needed.
"RTN","GMRCUTIL",7,0)
 ;  GLB: The ^TMP global where the data is to be placed.(i.e.,
"RTN","GMRCUTIL",8,0)
 ;       ^TMP("GMRCR",$J,"CS").
"RTN","GMRCUTIL",9,0)
 ;  J1:  The last entry in the WP array.  It is passed back to the
"RTN","GMRCUTIL",10,0)
 ;       calling routine so that WP(J1) can be concatenated to the next
"RTN","GMRCUTIL",11,0)
 ;       line, if necessary
"RTN","GMRCUTIL",12,0)
 ;  FLG: If the first line of the the data in WP needs to be formatted
"RTN","GMRCUTIL",13,0)
 ;       differently than succeeding lines, FLG signals this fact by
"RTN","GMRCUTIL",14,0)
 ;       being passed as FLG=1; otherwise, FLG is passed as FLG=0.
"RTN","GMRCUTIL",15,0)
 S (J,J1)=0 F  S J=$O(WP(J)) Q:J=""  S DTA=$S('FLG:$E(TAB,1,17)_WP(J),1:WP(J)) S @GLOB@(LN,0)=DTA,LN=LN+1,J1=J,FLG=0
"RTN","GMRCUTIL",16,0)
 K J,DTA
"RTN","GMRCUTIL",17,0)
 Q
"RTN","GMRCUTIL",18,0)
WPFMT(LINE,GMRCSL) ;FORMAT GLOBALS TO PRINT OUT IN A WORD PROCESSING FORMAT
"RTN","GMRCUTIL",19,0)
 ;  LINE:  The line of text that needs to be broken into 80 column
"RTN","GMRCUTIL",20,0)
 ;      or less lines for printing on the screen.
"RTN","GMRCUTIL",21,0)
 ;  GMRCSL:  This is the desired line length, to break LINE into; i.e.
"RTN","GMRCUTIL",22,0)
 ;      60, 70, or 80 columns (or smaller/larger) for screen display.
"RTN","GMRCUTIL",23,0)
  K WP S WP="" Q:LINE?1.80P  F LIN=1:1 D  S WP(LIN)=$E(BKLN,1,$L(BKLN)-1) Q:'$L(LINE)
"RTN","GMRCUTIL",24,0)
 .S (BKLN,WRD)="" F I=1:1 S WRD=$P(LINE," ",1) Q:($L(BKLN)+$L(WRD)+1)>GMRCSL  S BKLN=BKLN_WRD_" ",LINE=$P(LINE," ",2,256),WRD="" Q:$P(LINE," ",1,30)=""
"RTN","GMRCUTIL",25,0)
 .I $L(LINE),'$L(BKLN) S BKLN=$E(LINE,1,GMRCSL),LINE=$E(LINE,$L(BKLN),$L(LINE))
"RTN","GMRCUTIL",26,0)
 .Q
"RTN","GMRCUTIL",27,0)
 K I,LIN,BKLN,WRD Q
"RTN","GMRCUTIL",28,0)
 ;
"RTN","GMRCUTIL",29,0)
WPSET(GLOBAL,TMPGBL,LINE,LNO,TAB,FLG) ;Set the lines into a the ^TMP global in word-processing format.
"RTN","GMRCUTIL",30,0)
 ;  GLOBAL:  Global where data is comming from.
"RTN","GMRCUTIL",31,0)
 ;  TMPGBL:  Global where formatted data is being placed
"RTN","GMRCUTIL",32,0)
 ;  LINE:    Line is passed because it may contain some data already.
"RTN","GMRCUTIL",33,0)
 ;           If it does, it is concatenated to the data from GLOBAL.
"RTN","GMRCUTIL",34,0)
 ;  LNO:     This is a counter to where the next line of data should
"RTN","GMRCUTIL",35,0)
 ;           be set in TMPGLOBAL.  It is incremented and passed back
"RTN","GMRCUTIL",36,0)
 ;           to the calling routine so it knows where the next piece
"RTN","GMRCUTIL",37,0)
 ;           of data is to be placed in TMPGBL.
"RTN","GMRCUTIL",38,0)
 ;  TAB:     A string of spaces concatenated to the data in TMPGBL
"RTN","GMRCUTIL",39,0)
 ;           that acts like a tab character. TAB is passed to GSET.
"RTN","GMRCUTIL",40,0)
 ;  FLG:     If the first line of data is not tabbed, then FLG is
"RTN","GMRCUTIL",41,0)
 ;           passed as FLG=1 and no tab character is concatenated to
"RTN","GMRCUTIL",42,0)
 ;           this line.  If FLG=0, then the data is tabbed.
"RTN","GMRCUTIL",43,0)
 N LN
"RTN","GMRCUTIL",44,0)
 S (LN,LN1,J1)=0 F  S LN=$O(@(GLOBAL)@(LN)) Q:LN=""!(LN?1A.E)  S LINE=LINE_@(GLOBAL)@(LN,0) D
"RTN","GMRCUTIL",45,0)
 .I @(GLOBAL)@(LN,0)?1.240" " D WPFMT(LINE,$S('FLG:60,1:70)),GSET(.LNO,TMPGBL,.J1,.FLG) S @(TMPGBL)@(LNO,0)=@(GLOBAL)@(LN,0),LNO=LNO+1 S LINE="" Q
"RTN","GMRCUTIL",46,0)
 .I $O(@(GLOBAL)@(LN)),$O(@(GLOBAL)@(LN))'?1A S LN1=$O(@(GLOBAL)@(LN)) I $S((@(GLOBAL)@(LN1,0))?1.240" ":1,(@(GLOBAL)@(LN1,0))="":1,1:0) D WPFMT(LINE,$S('FLG:60,1:70)),GSET(.LNO,TMPGBL,.J1,.FLG) S LN=LN1,LINE="" Q
"RTN","GMRCUTIL",47,0)
 .I FLG,$L(LINE)<79,$O(@(GLOBAL)@(LN))]"",$O(@(GLOBAL)@(LN))'?1A.E S LN=$O(@(GLOBAL)@(LN)),LINE=LINE_" "_@(GLOBAL)@(LN,0) D WPFMT(LINE,79),GSET(.LNO,TMPGBL,.J1,.FLG) D
"RTN","GMRCUTIL",48,0)
 ..I $O(@(GLOBAL)@(LN))?1A.E S LINE="" Q
"RTN","GMRCUTIL",49,0)
 ..I $O(@(GLOBAL)@(LN))]"",$D(WP(J1)),$L(WP(J1))<60 S LINE=WP(J1)_" ",LNO=LNO-1 Q
"RTN","GMRCUTIL",50,0)
 ..I $D(WP(J1)),$L(WP(J1))>60 S LINE=WP(J1),LNO=LNO-1 Q
"RTN","GMRCUTIL",51,0)
 ..S LINE="" Q
"RTN","GMRCUTIL",52,0)
 .Q:LINE=""
"RTN","GMRCUTIL",53,0)
 .I $L(LINE)>70,FLG S LINE(0)=$E(LINE,1,$F(LINE," ",69)-1),LINE=$E(LINE,$F(LINE," ",69),$L(LINE)),@(TMPGBL)@(LNO,0)=LINE(0),FLG=$S($L(LINE(0)):0,1:1),LNO=LNO+1
"RTN","GMRCUTIL",54,0)
 .D WPFMT(LINE,$S('FLG:60,1:70)),GSET(.LNO,TMPGBL,.J1,.FLG) I $O(@(GLOBAL)@(LN))]"",$D(WP(J1)),$L(WP(J1))<60 S LINE=WP(J1)_" ",LNO=LNO-1,FLG=0
"RTN","GMRCUTIL",55,0)
 .E  S LINE=""
"RTN","GMRCUTIL",56,0)
 .Q
"RTN","GMRCUTIL",57,0)
 K J1,LN1,WP Q
"RTN","GMRCUTL1")
0^6^B2487353
"RTN","GMRCUTL1",1,0)
GMRCUTL1 ;SLC/DCM - General Utilities ;7/08/98  14:31
"RTN","GMRCUTL1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4**;DEC 27, 1997
"RTN","GMRCUTL1",3,0)
ACTM ;;Set correct variables to complete, discontinue, etc. a consult
"RTN","GMRCUTL1",4,0)
 K GMRCQUT
"RTN","GMRCUTL1",5,0)
 S:'+$G(GMRCA) GMRCA=$O(^GMR(123.1,"B",GMRCACTM,""))
"RTN","GMRCUTL1",6,0)
 S GMRCACTM=$P($G(^GMR(123.1,+GMRCA,0)),"^")
"RTN","GMRCUTL1",7,0)
 S ORSTS=$S(GMRCA:$P(^GMR(123.1,GMRCA,0),"^",2),1:0)
"RTN","GMRCUTL1",8,0)
 I 'GMRCA S GMRCQUT=1
"RTN","GMRCUTL1",9,0)
 Q
"RTN","GMRCUTL1",10,0)
PRNT(SRVCIFN,GMRCO) ;print form 513 to a printer when new consult is entered
"RTN","GMRCUTL1",11,0)
 N ORVP,GMRCDEV,GMRCQUED
"RTN","GMRCUTL1",12,0)
 I '$G(SRVCIFN) S SRVCIFN=+$P(^GMR(123,GMRCO,0),U,5)
"RTN","GMRCUTL1",13,0)
 Q:'$D(^GMR(123.5,SRVCIFN,123))  Q:'$P(^GMR(123.5,SRVCIFN,123),"^",9)
"RTN","GMRCUTL1",14,0)
 S IOP="`"_$P(^GMR(123.5,SRVCIFN,123),"^",9)
"RTN","GMRCUTL1",15,0)
 S %ZIS="N" D ^%ZIS I POP D HOME^%ZIS Q
"RTN","GMRCUTL1",16,0)
 S GMRCDEV=ION,GMRCQUED=1
"RTN","GMRCUTL1",17,0)
 S ZTRTN="PRNT^GMRCP5A("_(+GMRCO)_","_(+$G(TIUFLG))_",1,"""_$G(GMRCCPY,"W")_""",0)"
"RTN","GMRCUTL1",18,0)
 S ZTDESC="CONSULT/REQUEST PACKAGE PRINT FORM 513 FOR NEW CONSULT"
"RTN","GMRCUTL1",19,0)
 S ZTIO=GMRCDEV,ZTDTH=$H
"RTN","GMRCUTL1",20,0)
 D ^%ZTLOAD
"RTN","GMRCUTL1",21,0)
 D PRNTAUDT
"RTN","GMRCUTL1",22,0)
 D HOME^%ZIS
"RTN","GMRCUTL1",23,0)
 K GMRCQUED,GMRCDEV1
"RTN","GMRCUTL1",24,0)
 Q
"RTN","GMRCUTL1",25,0)
PRNTAUDT ;Update the last activity field in 123 and Processing Activity multiple
"RTN","GMRCUTL1",26,0)
 ;Printed To activity updates last activity taken for consult
"RTN","GMRCUTL1",27,0)
 N GMRCOM,GMRCORNP,GMRCFF,GMRCPA,GMRCAD
"RTN","GMRCUTL1",28,0)
 S GMRCA=22
"RTN","GMRCUTL1",29,0)
 S DIE="^GMR(123,",DA=+GMRCO,DR="9////^S X=GMRCA"
"RTN","GMRCUTL1",30,0)
 L +^GMR(123,GMRCO):5
"RTN","GMRCUTL1",31,0)
 D ^DIE
"RTN","GMRCUTL1",32,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCUTL1",33,0)
 ;Update activity other than HL7 original msg received
"RTN","GMRCUTL1",34,0)
 D AUDIT^GMRCP
"RTN","GMRCUTL1",35,0)
 Q
"RTN","GMRCUTL1",36,0)
END K GMRCDEV,GMRCDEV1,GMRCOREC,GMRCFMT
"RTN","GMRCUTL1",37,0)
 Q
"RTN","GMRCYP4")
0^38^B3699758
"RTN","GMRCYP4",1,0)
GMRCYP4 ;SLC/DLT - Consult patch 4 pre-init ;7/16/98  09:52
"RTN","GMRCYP4",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4**;DEC 27, 1997
"RTN","GMRCYP4",3,0)
 ;   (Sub-sections copied from GMRCPRE for GMRC*3.0)
"RTN","GMRCYP4",4,0)
EN ;entry point for patch 4 clean-up
"RTN","GMRCYP4",5,0)
 ; -- Start over with Request Action Types in 123.1
"RTN","GMRCYP4",6,0)
 S $P(^GMR(123.5,0),"^",2)="123.5"
"RTN","GMRCYP4",7,0)
 N DIU
"RTN","GMRCYP4",8,0)
 ;
"RTN","GMRCYP4",9,0)
 D STATUS(1,100)
"RTN","GMRCYP4",10,0)
 S DIU=123.1 S DIU(0)="DT" D EN^DIU2
"RTN","GMRCYP4",11,0)
 ;
"RTN","GMRCYP4",12,0)
 D STATUS(25,100)
"RTN","GMRCYP4",13,0)
 S DIU=123 S DIU(0)="" D EN^DIU2
"RTN","GMRCYP4",14,0)
 ;
"RTN","GMRCYP4",15,0)
 D STATUS(50,100)
"RTN","GMRCYP4",16,0)
 S DIU=123.5 S DIU(0)="" D EN^DIU2
"RTN","GMRCYP4",17,0)
 ;
"RTN","GMRCYP4",18,0)
 ; -- Remove the menu items on the protocol menus
"RTN","GMRCYP4",19,0)
 D RMVITEMS("GMRCACTM SERVICE ACTION MENU")
"RTN","GMRCYP4",20,0)
 ;
"RTN","GMRCYP4",21,0)
 ; -- remove data in 6th piece of zero node in ^GMR(123.5,
"RTN","GMRCYP4",22,0)
 D OLDATA
"RTN","GMRCYP4",23,0)
 Q
"RTN","GMRCYP4",24,0)
 ;
"RTN","GMRCYP4",25,0)
CHGNAME(GMRCOLD,GMRCNEW) ;Use the old name to find the protocol and update its name.
"RTN","GMRCYP4",26,0)
 N DA,DIE,X,Y,DR
"RTN","GMRCYP4",27,0)
 S DA=$O(^ORD(101,"B",GMRCOLD,"")) Q:'DA
"RTN","GMRCYP4",28,0)
 I $O(^ORD(101,"B",GMRCNEW,0)) D BMES^XPDUTL("Protocol exists: "_$G(GMRCNEW)) Q
"RTN","GMRCYP4",29,0)
 D BMES^XPDUTL("Change Protocol Name from: "_$G(GMRCOLD)_" to: "_$G(GMRCNEW))
"RTN","GMRCYP4",30,0)
 S DIE="^ORD(101,",DR=".01///^S X=GMRCNEW"
"RTN","GMRCYP4",31,0)
 D ^DIE
"RTN","GMRCYP4",32,0)
 Q
"RTN","GMRCYP4",33,0)
RMVITEMS(GMRCMENU) ; -- Remove the menu items on the protocol menus
"RTN","GMRCYP4",34,0)
 N DA,X,Y,DIE,DIC,DIK,GMRCD0
"RTN","GMRCYP4",35,0)
 ;
"RTN","GMRCYP4",36,0)
 S GMRCD0=$O(^ORD(101,"B",GMRCMENU,"")) Q:'GMRCD0
"RTN","GMRCYP4",37,0)
 D BMES^XPDUTL("Remove menu from: "_$G(GMRCMENU))
"RTN","GMRCYP4",38,0)
 S DA=0 F TOTL=0:1 S DA=$O(^ORD(101,GMRCD0,10,DA)) Q:'DA
"RTN","GMRCYP4",39,0)
 S DA=0 F CURR=0:1 S DA=$O(^ORD(101,GMRCD0,10,DA)) Q:'DA  D
"RTN","GMRCYP4",40,0)
 . S DA(0)=GMRCD0,DIK="^ORD(101,"_GMRCD0_",10," D ^DIK
"RTN","GMRCYP4",41,0)
 . D:TOTL STATUS(((CURR/TOTL)*50)+50,100)
"RTN","GMRCYP4",42,0)
 Q
"RTN","GMRCYP4",43,0)
 ;
"RTN","GMRCYP4",44,0)
STATUS(CURRENT,XPDIDTOT) ;
"RTN","GMRCYP4",45,0)
 ;
"RTN","GMRCYP4",46,0)
 I '$D(XPDIDVT) N XPDIDVT
"RTN","GMRCYP4",47,0)
 S XPDIDVT=$G(XPDIDVT)
"RTN","GMRCYP4",48,0)
 D UPDATE^XPDID(CURRENT)
"RTN","GMRCYP4",49,0)
 ;
"RTN","GMRCYP4",50,0)
 Q
"RTN","GMRCYP4",51,0)
 ;
"RTN","GMRCYP4",52,0)
OLDATA ; get rid of data from previous version field
"RTN","GMRCYP4",53,0)
 N IEN
"RTN","GMRCYP4",54,0)
 S IEN=0 F  S IEN=$O(^GMR(123.5,IEN)) Q:'IEN  D
"RTN","GMRCYP4",55,0)
 . S $P(^GMR(123.5,IEN,0),U,6)=""
"RTN","GMRCYP4",56,0)
 Q
"SEC","^DD",123,123,20,9)

"SEC","^DD",123,123,40,8)

"SEC","^DIC",123.5,123.5,0,"DEL")
@
"VER")
8.0^21.0
"^DD",123,123,0)
FIELD^^.1^28
"^DD",123,123,0,"DDA")
N
"^DD",123,123,0,"DT")
2981103
"^DD",123,123,0,"ID",.02)
S %I=Y,Y=$S('$D(^(0)):"",$D(^DPT(+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(2,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",123,123,0,"IX","AC",123,.03)

"^DD",123,123,0,"IX","AD",123,.02)

"^DD",123,123,0,"IX","AD1",123,3)

"^DD",123,123,0,"IX","AE",123,1)

"^DD",123,123,0,"IX","AE1",123,3)

"^DD",123,123,0,"IX","AE2",123,8)

"^DD",123,123,0,"IX","B",123,.01)

"^DD",123,123,0,"IX","C",123,1)

"^DD",123,123,0,"IX","D",123,8)

"^DD",123,123,0,"IX","E",123,3)

"^DD",123,123,0,"IX","F",123,.02)

"^DD",123,123,0,"IX","G",123,10)

"^DD",123,123,0,"IX","H",123,2)

"^DD",123,123,0,"IX","R",123.03,.01)

"^DD",123,123,0,"NM","REQUEST/CONSULTATION")

"^DD",123,123,0,"PT",691,1001)

"^DD",123,123,0,"PT",691.1,1001)

"^DD",123,123,0,"PT",691.5,1001)

"^DD",123,123,0,"PT",691.6,1001)

"^DD",123,123,0,"PT",691.7,1001)

"^DD",123,123,0,"PT",691.8,1001)

"^DD",123,123,0,"PT",694,1001)

"^DD",123,123,0,"PT",698,1001)

"^DD",123,123,0,"PT",698.1,1001)

"^DD",123,123,0,"PT",698.2,1001)

"^DD",123,123,0,"PT",698.3,1001)

"^DD",123,123,0,"PT",699,1001)

"^DD",123,123,0,"PT",699.5,1001)

"^DD",123,123,0,"PT",700,1001)

"^DD",123,123,0,"PT",701,1001)

"^DD",123,123,0,"PT",8925,1405)

"^DD",123,123,0,"VRPK")
GMRC
"^DD",123,123,.001,0)
NUMBER^NJ8,0^^ ^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",123,123,.001,3)
Type a Number between 0 and 99999999, 0 Decimal Digits
"^DD",123,123,.001,"DT")
2910604
"^DD",123,123,.01,0)
FILE ENTRY DATE^RDX^^0;1^S %DT="ETXR" D ^%DT S X=$P($H,",",2),Y=Y_"."_$E(0,1,2-$L(X\3600))_(X\3600)_$E(0,1,2-$L(X#3600\60))_(X#3600\60)_$E(0,1,2-$L(X#60))_(X#60),Y=+Y,X=Y K:Y<1 X
"^DD",123,123,.01,1,0)
^.1
"^DD",123,123,.01,1,1,0)
123^B
"^DD",123,123,.01,1,1,1)
S ^GMR(123,"B",$E(X,1,30),DA)=""
"^DD",123,123,.01,1,1,2)
K ^GMR(123,"B",$E(X,1,30),DA)
"^DD",123,123,.01,3)
This is the date/time of the entry of the consultation/request.
"^DD",123,123,.01,21,0)
^^2^2^2970911^^^^
"^DD",123,123,.01,21,1,0)
Date of actual entry of consultation request into the file.
"^DD",123,123,.01,21,2,0)
Transparent to user.
"^DD",123,123,.02,0)
PATIENT NAME^RP2'^DPT(^0;2^Q
"^DD",123,123,.02,1,0)
^.1^^-1
"^DD",123,123,.02,1,1,0)
123^AD^MUMPS
"^DD",123,123,.02,1,1,1)
I $P(^GMR(123,DA,0),"^",7) S GMRCD=9999999-$P(^GMR(123,DA,0),"^",7),^GMR(123,"AD",X,GMRCD,DA)="" K GMRCD
"^DD",123,123,.02,1,1,2)
I $P(^GMR(123,DA,0),"^",7) S GMRCD=9999999-$P(^GMR(123,DA,0),"^",7) K ^GMR(123,"AD",X,GMRCD,DA),GMRCD
"^DD",123,123,.02,1,1,"%D",0)
^^2^2^2910715^^
"^DD",123,123,.02,1,1,"%D",1,0)
The "AD" cross-reference allows look up of patient consults in reverse
"^DD",123,123,.02,1,1,"%D",2,0)
chronological "DATE OF REQUEST" order.
"^DD",123,123,.02,1,1,"DT")
2910715
"^DD",123,123,.02,1,3,0)
123^F
"^DD",123,123,.02,1,3,1)
S ^GMR(123,"F",$E(X,1,30),DA)=""
"^DD",123,123,.02,1,3,2)
K ^GMR(123,"F",$E(X,1,30),DA)
"^DD",123,123,.02,1,3,"DT")
2920204
"^DD",123,123,.02,3)
Enter the name of a patient or the last 4 digits of the SSN.
"^DD",123,123,.02,21,0)
^^2^2^2981103^^^^
"^DD",123,123,.02,21,1,0)
This is the Patient who the consult or request was ordered for.
"^DD",123,123,.02,21,2,0)
Enter the patient's name, or the last four digits of the SSN.
"^DD",123,123,.02,"DT")
2981103
"^DD",123,123,.03,0)
OE/RR FILE NUMBER^P100'^OR(100,^0;3^Q
"^DD",123,123,.03,1,0)
^.1
"^DD",123,123,.03,1,1,0)
123^AC
"^DD",123,123,.03,1,1,1)
S ^GMR(123,"AC",$E(X,1,30),DA)=""
"^DD",123,123,.03,1,1,2)
K ^GMR(123,"AC",$E(X,1,30),DA)
"^DD",123,123,.03,1,1,"%D",0)
^^2^2^2910927^^
"^DD",123,123,.03,1,1,"%D",1,0)
This cross-reference allows determining the request entry in 123 based on
"^DD",123,123,.03,1,1,"%D",2,0)
the ORIFN from OE/RR.
"^DD",123,123,.03,1,1,"DT")
2910826
"^DD",123,123,.03,3)
Enter the File 100 internal entry number of this record.
"^DD",123,123,.03,21,0)
^^3^3^2981103^^^^
"^DD",123,123,.03,21,1,0)
This is the internal entry number of the order in the Orders File (100).
"^DD",123,123,.03,21,2,0)
The consult sends CPRS information about the consult which is stored in
"^DD",123,123,.03,21,3,0)
File 100. This is the IEN of the consult in that file.
"^DD",123,123,.03,"DT")
2981103
"^DD",123,123,.04,0)
PATIENT LOCATION^P44'^SC(^0;4^Q
"^DD",123,123,.04,3)
Enter the Hospital Location of this patient.
"^DD",123,123,.04,21,0)
^^2^2^2970911^^^
"^DD",123,123,.04,21,1,0)
This is the location of the patient when the consult/request order was
"^DD",123,123,.04,21,2,0)
placed.
"^DD",123,123,.04,"DT")
2910529
"^DD",123,123,.05,0)
ORDERING FACILITY^P4'^DIC(4,^0;21^Q
"^DD",123,123,.05,3)
If this is a consult/request sent to another Institution, then this is the SENDING hospital/institution.
"^DD",123,123,.05,21,0)
^^5^5^2970911^^^^
"^DD",123,123,.05,21,1,0)
This field contains the number, from file 4, of the institution/hospital
"^DD",123,123,.05,21,2,0)
that is requesting the consult.  This field is mandatory if the consult/
"^DD",123,123,.05,21,3,0)
request is being sent to another hospital/institution, so that routing
"^DD",123,123,.05,21,4,0)
information can be obtained in order to return the results to the sending
"^DD",123,123,.05,21,5,0)
hospital/institution.
"^DD",123,123,.05,"DT")
2960502
"^DD",123,123,.06,0)
FOREIGN CONSULT FILE NUMBER^NJ12,0^^0;22^K:+X'=X!(X>999999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",123,123,.06,3)
Type a Number between 1 and 999999999999, 0 Decimal Digits
"^DD",123,123,.06,21,0)
^^6^6^2970911^^
"^DD",123,123,.06,21,1,0)
This is the ^GMR(123, file number of the consult from a foreign database.
"^DD",123,123,.06,21,2,0)
It is stored here so that when the consult is returned in an HL-7
"^DD",123,123,.06,21,3,0)
message, it can be located at the sending facility.  Also, if the sending
"^DD",123,123,.06,21,4,0)
facility needs to send updated consult information to the receiving
"^DD",123,123,.06,21,5,0)
facility, this number will reference the consult number there so that
"^DD",123,123,.06,21,6,0)
the data can be added/ammended and tracking information can be updated.
"^DD",123,123,.06,"DT")
2970911
"^DD",123,123,.1,0)
DISPLAY TEXT OF ITEM ORDERED^F^^1.11;1^K:$L(X)>80!($L(X)<1) X
"^DD",123,123,.1,3)
Enter the display text the user selected to place the order.
"^DD",123,123,.1,21,0)
^^4^4^2990603^^^
"^DD",123,123,.1,21,1,0)
This is the display text of the item ordered.  If the order was placed
"^DD",123,123,.1,21,2,0)
using a quick order, then the Display text is the text from the Order
"^DD",123,123,.1,21,3,0)
Dialog File.  If the order was placed by selecting an Orderable Item, 
"^DD",123,123,.1,21,4,0)
then the text is the Print Name from the Orderable Item file.
"^DD",123,123,.1,"DT")
2980712
"^DD",123,123,1,0)
TO SERVICE^RP123.5^GMR(123.5,^0;5^Q
"^DD",123,123,1,1,0)
^.1
"^DD",123,123,1,1,1,0)
123^C
"^DD",123,123,1,1,1,1)
S ^GMR(123,"C",$E(X,1,30),DA)=""
"^DD",123,123,1,1,1,2)
K ^GMR(123,"C",$E(X,1,30),DA)
"^DD",123,123,1,1,1,"%D",0)
^^2^2^2920129^
"^DD",123,123,1,1,1,"%D",1,0)
This cross reference allows searching for all consults/requests by specific
"^DD",123,123,1,1,1,"%D",2,0)
service/specialty.
"^DD",123,123,1,1,1,"DT")
2920129
"^DD",123,123,1,1,2,0)
123^AE^MUMPS
"^DD",123,123,1,1,2,1)
I $P(^GMR(123,DA,0),"^",12),$P(^GMR(123,DA,0),"^",7) S GMRCD=9999999-$P(^GMR(123,DA,0),"^",7),^GMR(123,"AE",X,$P(^GMR(123,DA,0),"^",12),GMRCD,DA)=""
"^DD",123,123,1,1,2,2)
I $P(^GMR(123,DA,0),"^",12),$P(^GMR(123,DA,0),"^",7) S GMRCD=9999999-$P(^GMR(123,DA,0),"^",7) K ^GMR(123,"AE",X,$P(^GMR(123,DA,0),"^",12),GMRCD,DA),GMRCD
"^DD",123,123,1,1,2,"%D",0)
^^2^2^2920218^^^^
"^DD",123,123,1,1,2,"%D",1,0)
This cross-reference allows lookup by Service, OE/RR status, and Date of 
"^DD",123,123,1,1,2,"%D",2,0)
Request.
"^DD",123,123,1,1,2,"DT")
2920218
"^DD",123,123,1,3)
Enter the name of the service that will complete the consult.
"^DD",123,123,1,21,0)
^^2^2^2970911^^^^
"^DD",123,123,1,21,1,0)
This is the "TO" service/specialty.  This service is responsible for
"^DD",123,123,1,21,2,0)
completion of the consult/request.
"^DD",123,123,1,"DT")
2920515
"^DD",123,123,2,0)
FROM^P44'^SC(^0;6^Q
"^DD",123,123,2,1,0)
^.1
"^DD",123,123,2,1,1,0)
123^H
"^DD",123,123,2,1,1,1)
S ^GMR(123,"H",$E(X,1,30),DA)=""
"^DD",123,123,2,1,1,2)
K ^GMR(123,"H",$E(X,1,30),DA)
"^DD",123,123,2,1,1,"%D",0)
^^2^2^2980712^
"^DD",123,123,2,1,1,"%D",1,0)
This cross-reference allows the location that sent the consult to track
"^DD",123,123,2,1,1,"%D",2,0)
what happened to their consults.
"^DD",123,123,2,1,1,"DT")
2980712
"^DD",123,123,2,3)
Enter the hospital location that is sending the order.
"^DD",123,123,2,21,0)
^^2^2^2970911^^^^
"^DD",123,123,2,21,1,0)
This field represents the location that sent the order to the receiving 
"^DD",123,123,2,21,2,0)
location.
"^DD",123,123,2,"DT")
2980712
"^DD",123,123,3,0)
DATE OF REQUEST^RD^^0;7^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",123,123,3,1,0)
^.1
"^DD",123,123,3,1,1,0)
123^AE1^MUMPS
"^DD",123,123,3,1,1,1)
I $P(^GMR(123,DA,0),"^",12),$P(^GMR(123,DA,0),"^",5) S GMRCD=9999999-X,^GMR(123,"AE",$P(^GMR(123,DA,0),"^",5),$P(^GMR(123,DA,0),"^",12),GMRCD,DA)="" K GMRCD
"^DD",123,123,3,1,1,2)
I $P(^GMR(123,DA,0),"^",12),$P(^GMR(123,DA,0),"^",5) S GMRCD=9999999-X K ^GMR(123,"AE",$P(^GMR(123,DA,0),"^",5),$P(^GMR(123,DA,0),"^",12),GMRCD,DA),GMRCD
"^DD",123,123,3,1,1,"%D",0)
^^2^2^2920218^
"^DD",123,123,3,1,1,"%D",1,0)
This cross reference provides lookup on consults by Service, OE/RR status
"^DD",123,123,3,1,1,"%D",2,0)
and Inverted Date of Request.
"^DD",123,123,3,1,1,"DT")
2920218
"^DD",123,123,3,1,2,0)
123^AD1^MUMPS
"^DD",123,123,3,1,2,1)
I $P(^GMR(123,DA,0),"^",2) S ^GMR(123,"AD",$P(^GMR(123,DA,0),"^",2),9999999-X,DA)=""
"^DD",123,123,3,1,2,2)
I $P(^GMR(123,DA,0),"^",2) K ^GMR(123,"AD",$P(^GMR(123,DA,0),"^",2),9999999-X,DA)
"^DD",123,123,3,1,2,"%D",0)
^^1^1^2911217^
"^DD",123,123,3,1,2,"%D",1,0)
This cross-reference provides consults by patient by inverted order date.
"^DD",123,123,3,1,2,"DT")
2911217
"^DD",123,123,3,1,3,0)
123^E
"^DD",123,123,3,1,3,1)
S ^GMR(123,"E",$E(X,1,30),DA)=""
"^DD",123,123,3,1,3,2)
K ^GMR(123,"E",$E(X,1,30),DA)
"^DD",123,123,3,1,3,"%D",0)
^^1^1^2920129^
"^DD",123,123,3,1,3,"%D",1,0)
This cross reference allows searching for consults based on Date of Request.
"^DD",123,123,3,1,3,"DT")
2920129
"^DD",123,123,3,3)
Enter the date/time this order was released from CPRS.
"^DD",123,123,3,21,0)
^^3^3^2970911^^^^
"^DD",123,123,3,21,1,0)
This is the date and time the order was released from OE/RR.
"^DD",123,123,3,21,2,0)
If the TO service entered the order stub through the Add Order (AD)
"^DD",123,123,3,21,3,0)
action, this is the service-specified request date.
"^DD",123,123,3,"DT")
2920218
"^DD",123,123,4,0)
PROCEDURE/REQUEST TYPE^V^^0;8^Q
"^DD",123,123,4,1,0)
^.1^^0
"^DD",123,123,4,3)
Enter the type of procedure being requested (e.g., EKG, UGI, etc.).
"^DD",123,123,4,21,0)
^^2^2^2970911^^^^
"^DD",123,123,4,21,1,0)
This is the Protocol entry that was selected from OE/RR Add New Orders menus
"^DD",123,123,4,21,2,0)
to place the order.
"^DD",123,123,4,"DT")
2911216
"^DD",123,123,4,"V",0)
^.12P^1^1
"^DD",123,123,4,"V",1,0)
101^Enter Order Item^1^O^n^n
"^DD",123,123,5,0)
URGENCY^P101'^ORD(101,^0;9^Q
"^DD",123,123,5,3)
Enter the urgency for this order (STAT, ROUTINE, NEXT AVAILABLE, EMERGENCY, TODAY, WITHIN 24 HOURS, WITHIN 48 HOURS, WITHIN 72 HOURS, etc.)
"^DD",123,123,5,21,0)
^^4^4^2970911^^^^
"^DD",123,123,5,21,1,0)
This field describes the urgency of the consult. Urgencies are sent in the
"^DD",123,123,5,21,2,0)
PROTOCOL File (#101) as: STAT, EMERGENCY, INPATIENT, NEXT AVAILABLE, NOW,
"^DD",123,123,5,21,3,0)
ROUTINE, TODAY, WITHIN 24 HOURS, WITHIN 48 HOURS, WITHIN 72 HOURS,
"^DD",123,123,5,21,4,0)
WITHIN 1 WEEK, WITHIN 1 MONTH. 
"^DD",123,123,5,"DT")
2970709
"^DD",123,123,6,0)
PLACE OF CONSULTATION^P101'^ORD(101,^0;10^Q
"^DD",123,123,6,3)
Type The Place Of Consultation: Bedside, Consultant's Choice, On Call, Emergency Room, EKG Lab.
"^DD",123,123,6,21,0)
^^7^7^2981112^^^^
"^DD",123,123,6,21,1,0)
This is the place where the consultation will take place.  Choose from:
"^DD",123,123,6,21,2,0)

"^DD",123,123,6,21,3,0)
    B - Bedside
"^DD",123,123,6,21,4,0)
    C - Consultant's Choice
"^DD",123,123,6,21,5,0)
    E - Emergency Room
"^DD",123,123,6,21,6,0)
    O - On Call
"^DD",123,123,6,21,7,0)
    EKG - EKG Lab
"^DD",123,123,6,"DT")
2970611
"^DD",123,123,7,0)
ATTENTION^P200'^VA(200,^0;11^Q
"^DD",123,123,7,3)
Enter the name of the Consult Service provider to be alerted about the consult.
"^DD",123,123,7,21,0)
^^4^4^2970911^^^^
"^DD",123,123,7,21,1,0)
Enter the name of a person you would like to alert about the consult.
"^DD",123,123,7,21,2,0)
This person will be sent a notification that a new consult exists.
"^DD",123,123,7,21,3,0)
In order for the person to see this type of notification, the person
"^DD",123,123,7,21,4,0)
must be set up to receive "New service consult" notifications.
"^DD",123,123,7,"DT")
2910605
"^DD",123,123,8,0)
CPRS STATUS^P100.01'^ORD(100.01,^0;12^Q
"^DD",123,123,8,1,0)
^.1
"^DD",123,123,8,1,1,0)
123^D
"^DD",123,123,8,1,1,1)
S ^GMR(123,"D",$E(X,1,30),DA)=""
"^DD",123,123,8,1,1,2)
K ^GMR(123,"D",$E(X,1,30),DA)
"^DD",123,123,8,1,1,"%D",0)
^^1^1^2920129^
"^DD",123,123,8,1,1,"%D",1,0)
This cross-reference allows searching based on the OE/RR status.
"^DD",123,123,8,1,1,"DT")
2920129
"^DD",123,123,8,1,2,0)
123^AE2^MUMPS
"^DD",123,123,8,1,2,1)
I $P(^GMR(123,DA,0),"^",7),$P(^GMR(123,DA,0),"^",5) S GMRCD=9999999-$P(^GMR(123,DA,0),"^",7),^GMR(123,"AE",$P(^GMR(123,DA,0),"^",5),X,GMRCD,DA)="" K GMRCD
"^DD",123,123,8,1,2,2)
I $P(^GMR(123,DA,0),"^",7),$P(^GMR(123,DA,0),"^",5) S GMRCD=9999999-$P(^GMR(123,DA,0),"^",7) K ^GMR(123,"AE",$P(^GMR(123,DA,0),"^",5),X,GMRCD,DA),GMRCD
"^DD",123,123,8,1,2,"%D",0)
^^2^2^2971118^^
"^DD",123,123,8,1,2,"%D",1,0)
This cross reference is used for services to see all consults by service,
"^DD",123,123,8,1,2,"%D",2,0)
OE/RR status and Date of Request.
"^DD",123,123,8,1,2,"DT")
2920218
"^DD",123,123,8,3)
Enter the CPRS STATUS of this consult (e.g., pending, active, complete, etc.).
"^DD",123,123,8,21,0)
^^3^3^2970911^^^
"^DD",123,123,8,21,1,0)
This is the current CPRS status of the consult or request order.
"^DD",123,123,8,21,2,0)
The Action Types which may be taken from the "Select Action: " prompt
"^DD",123,123,8,21,3,0)
update the status in this file as well as in the Orders File (100).
"^DD",123,123,8,"DT")
2970911
"^DD",123,123,9,0)
LAST ACTION TAKEN^P123.1'^GMR(123.1,^0;13^Q
"^DD",123,123,9,3)
Enter the last action taken on the consult (From file 123.1).
"^DD",123,123,9,21,0)
^^2^2^2970911^^^
"^DD",123,123,9,21,1,0)
This is the last Action Type taken that updated the activity tracking
"^DD",123,123,9,21,2,0)
audit trail.
"^DD",123,123,9,"DT")
2911206
"^DD",123,123,10,0)
SENDING PROVIDER^RP200'^VA(200,^0;14^Q
"^DD",123,123,10,1,0)
^.1
"^DD",123,123,10,1,1,0)
123^G
"^DD",123,123,10,1,1,1)
S ^GMR(123,"G",$E(X,1,30),DA)=""
"^DD",123,123,10,1,1,2)
K ^GMR(123,"G",$E(X,1,30),DA)
"^DD",123,123,10,1,1,"%D",0)
^^1^1^2980616^^
"^DD",123,123,10,1,1,"%D",1,0)
This index allows look-up of consults by sending provider. 
"^DD",123,123,10,1,1,"DT")
2980616
"^DD",123,123,10,3)
Enter the name of the Ordering Provider.
"^DD",123,123,10,21,0)
^^1^1^2970911^^^^
"^DD",123,123,10,21,1,0)
This is the provider who originated the order.
"^DD",123,123,10,"DT")
2980616
"^DD",123,123,11,0)
RESULT^V^^0;15^Q
"^DD",123,123,11,3)
Enter the record number for the result in the MEDICINE PACKAGE that contains the results for this consult.
"^DD",123,123,11,21,0)
^^3^3^2970911^^^^
"^DD",123,123,11,21,1,0)
This is a variable pointer used by the GMRC MEDICINE PKG INTERFACE option
"^DD",123,123,11,21,2,0)
to associate results in the Medicine Procedure Files with a consult/request
"^DD",123,123,11,21,3,0)
order.
"^DD",123,123,11,"DT")
2911206
"^DD",123,123,11,"V",0)
^.12P^15^14
"^DD",123,123,11,"V",2,0)
691^Select ECHO report^2^ECHO
"^DD",123,123,11,"V",3,0)
691.1^Select CATH report^3^CATH
"^DD",123,123,11,"V",4,0)
691.5^Select ECG report^4^ECG^n^n
"^DD",123,123,11,"V",5,0)
691.6^Select HOLTER result^5^HOLTER^n^n
"^DD",123,123,11,"V",6,0)
691.7^Select ETT report^6^ETT^n^n
"^DD",123,123,11,"V",7,0)
691.8^Select EP report^7^EP^n^n
"^DD",123,123,11,"V",8,0)
694^Select HEM report^8^HEM^n^n
"^DD",123,123,11,"V",9,0)
698^Select GEN IMP report^9^G^n^n
"^DD",123,123,11,"V",10,0)
698.1^Select V LEAD IMPLANT^10^V^n^n
"^DD",123,123,11,"V",11,0)
698.2^Select A LEAD IMPLANT^11^A^n^n
"^DD",123,123,11,"V",12,0)
698.3^Select SURVEILLANCE report^12^PS^n^n
"^DD",123,123,11,"V",13,0)
699^Select ENDOSCOPY report^13^ENDO^n^n
"^DD",123,123,11,"V",14,0)
700^Select PFT report^14^PFT^n^n
"^DD",123,123,11,"V",15,0)
701^Select RHEUMATOLOGY report^15^RHEUM^n^n
"^DD",123,123,12,0)
MODE OF ENTRY^S^1:SERVICE FORCED ENTRY;^0;16^Q
"^DD",123,123,12,3)
Enter '1' if this is a service-entered consult.
"^DD",123,123,12,21,0)
^^4^4^2980425^^^^
"^DD",123,123,12,21,1,0)
When a consult or request is entered by the service, rather than through
"^DD",123,123,12,21,2,0)
CPRS order processing, this field will be set to "1" to indicate the
"^DD",123,123,12,21,3,0)
Service forced the entry.  This forcing means there is no electronic
"^DD",123,123,12,21,4,0)
signature related to the order.
"^DD",123,123,12,"DT")
2980425
"^DD",123,123,13,0)
REQUEST TYPE^P101'^ORD(101,^0;17^Q
"^DD",123,123,13,3)
Enter whether this is a GMRCOR CONSULT or a GMRCOR REQUEST.
"^DD",123,123,13,21,0)
^^5^5^2970611^^^^
"^DD",123,123,13,21,1,0)
This field should either be the pointer to the GMRCOR CONSULT protocol or
"^DD",123,123,13,21,2,0)
a pointer to the GMRCOR REQUEST protocol.   This field will indicate 
"^DD",123,123,13,21,3,0)
whether the order is a consult or procedure request order.  Based on this
"^DD",123,123,13,21,4,0)
fields value, the Consultation Body Header alters to indicate "Consult
"^DD",123,123,13,21,5,0)
Type: " or "Procedure Request: ".
"^DD",123,123,13,"DT")
2910824
"^DD",123,123,14,0)
SERVICE RENDERED AS IN OR OUT^S^I:inpatient;O:outpatient;^0;18^Q
"^DD",123,123,14,3)
Type I if the service is on an inpatient basis, O if outpatient.
"^DD",123,123,14,21,0)
^^4^4^2981112^^^^
"^DD",123,123,14,21,1,0)
This field allows the ordering person to indicate if the service is to
"^DD",123,123,14,21,2,0)
be rendered on an outpatient or inpatient basis.  This is to alleviate
"^DD",123,123,14,21,3,0)
the confusion if patient is currently an inpatient/outpatient but is
"^DD",123,123,14,21,4,0)
just about to be discharged/admitted and become a outpatient/inpatient.
"^DD",123,123,14,"DT")
2910925
"^DD",123,123,15,0)
SIGNIFICANT FINDINGS^S^Y:yes;N:no;U:unknown;^0;19^Q
"^DD",123,123,15,3)
Enter a value to indicate if significant findings are in the results.
"^DD",123,123,15,21,0)
^^4^4^2980423^^
"^DD",123,123,15,21,1,0)
If significant findings are noted in the consult results, then this field
"^DD",123,123,15,21,2,0)
may be marked "Yes", and appropriate comments may be entered in the
"^DD",123,123,15,21,3,0)
"Comment" field. "Unknown" is the default. "No" may also be specified to
"^DD",123,123,15,21,4,0)
indicate the results do not include significant findings.
"^DD",123,123,15,"DT")
2980423
"^DD",123,123,16,0)
TIU RESULT NARRATIVE^P8925'^TIU(8925,^0;20^Q
"^DD",123,123,16,3)
Enter the File 8925 internal entry number where the TIU narrative for this consult is stored.
"^DD",123,123,16,21,0)
^^2^2^2970911^^^^
"^DD",123,123,16,21,1,0)
Pointer to the Text Integration Utilities file (#8925) where consult/request
"^DD",123,123,16,21,2,0)
results narrative is stored.
"^DD",123,123,16,"DT")
2960514
"^DD",123,123,20,0)
REASON FOR REQUEST^123.01^^20;0
"^DD",123,123,20,21,0)
^^1^1^2970915^^^^
"^DD",123,123,20,21,1,0)
This is the reason for requesting the Consult or Procedure Request.
"^DD",123,123,30,0)
PROVISIONAL DIAGNOSIS^F^^30;1^K:$L(X)>180!($L(X)<2) X
"^DD",123,123,30,3)
Enter a Provisional Diagnosis, 2 to 180 characters in length.
"^DD",123,123,30,21,0)
^^2^2^2970911^^^^
"^DD",123,123,30,21,1,0)
This is the Provisional Diagnosis the ordering clinician would specify
"^DD",123,123,30,21,2,0)
on the Consult Form 513.
"^DD",123,123,30,"DT")
2970522
"^DD",123,123,40,0)
REQUEST PROCESSING ACTIVITY^123.02DA^^40;0
"^DD",123,123,40,21,0)
^^1^1^2980425^^^^
"^DD",123,123,40,21,1,0)
Maintains history of processing actions.
"^DD",123,123,40,"DT")
2910507
"^DD",123,123,50,0)
ASSOCIATED RESULTS^123.03V^^50;0
"^DD",123,123.01,0)
REASON FOR REQUEST SUB-FIELD^^.01^1
"^DD",123,123.01,0,"DT")
2910605
"^DD",123,123.01,0,"NM","REASON FOR REQUEST")

"^DD",123,123.01,0,"UP")
123
"^DD",123,123.01,.01,0)
REASON FOR REQUEST^W^^0;1^Q
"^DD",123,123.01,.01,3)
Enter the reason this consult is being requested.
"^DD",123,123.01,.01,21,0)
^^1^1^2970915^^^^
"^DD",123,123.01,.01,21,1,0)
This is the reason for requesting the Consult or Procedure Request.
"^DD",123,123.01,.01,"DT")
2910605
"^DD",123,123.02,0)
REQUEST PROCESSING ACTIVITY SUB-FIELD^^10^11
"^DD",123,123.02,0,"DT")
2980425
"^DD",123,123.02,0,"IX","B",123.02,.01)

"^DD",123,123.02,0,"NM","REQUEST PROCESSING ACTIVITY")

"^DD",123,123.02,0,"UP")
123
"^DD",123,123.02,.01,0)
DATE/TIME OF ACTION ENTRY^RD^^0;1^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",123,123.02,.01,.1)
ACTIVITY ENTRY DATE
"^DD",123,123.02,.01,1,0)
^.1
"^DD",123,123.02,.01,1,1,0)
123.02^B
"^DD",123,123.02,.01,1,1,1)
S ^GMR(123,DA(1),40,"B",$E(X,1,30),DA)=""
"^DD",123,123.02,.01,1,1,2)
K ^GMR(123,DA(1),40,"B",$E(X,1,30),DA)
"^DD",123,123.02,.01,3)
Enter the Date/Time you are entering this activity.
"^DD",123,123.02,.01,21,0)
^^2^2^2960129^^
"^DD",123,123.02,.01,21,1,0)
This is the actual date and time the activity tracking update was added
"^DD",123,123.02,.01,21,2,0)
to the REQUEST PROCESSING ACTIVITY multiple.
"^DD",123,123.02,.01,"DT")
2911208
"^DD",123,123.02,1,0)
ACTIVITY^P123.1'^GMR(123.1,^0;2^Q
"^DD",123,123.02,1,3)
Enter the activity being updated (From file 123.1)
"^DD",123,123.02,1,21,0)
^^1^1^2970611^^
"^DD",123,123.02,1,21,1,0)
This is the activity that is being updated.
"^DD",123,123.02,1,"DT")
2910604
"^DD",123,123.02,2,0)
DATE/TIME OF ACTUAL ACTIVITY^DX^^0;3^S %DT="ETXR",%DT(0)="-NOW" D ^%DT K %DT(0) S X=Y K:Y<1 X
"^DD",123,123.02,2,.1)

"^DD",123,123.02,2,3)
ENTER BOTH DATE AND TIME.  FUTURE DATE/TIME NOT PERMITTED.
"^DD",123,123.02,2,21,0)
^^2^2^2970611^^^^
"^DD",123,123.02,2,21,1,0)
The Date and time the actual activity was done.  This may be different 
"^DD",123,123.02,2,21,2,0)
than the DATE/TIME OF ACTION ENTRY for certain actions.
"^DD",123,123.02,2,"DT")
2920617
"^DD",123,123.02,3,0)
WHO'S RESPONSIBLE FOR ACTIVITY^RP200'^VA(200,^0;4^Q
"^DD",123,123.02,3,3)
Enter the name of the provider responsible for the activity.
"^DD",123,123.02,3,21,0)
^^1^1^2970611^^^^
"^DD",123,123.02,3,21,1,0)
The clinician or service person responsible for the activity.
"^DD",123,123.02,3,"DT")
2920227
"^DD",123,123.02,4,0)
WHO ENTERED ACTIVITY^RP200'^VA(200,^0;5^Q
"^DD",123,123.02,4,"DT")
2910507
"^DD",123,123.02,5,0)
COMMENT^123.25^^1;0
"^DD",123,123.02,5,21,0)
^^2^2^2970611^^^
"^DD",123,123.02,5,21,1,0)
A comment may be added here which would be associated with the Action
"^DD",123,123.02,5,21,2,0)
Type selected at the "Select Action: " prompt.
"^DD",123,123.02,5,"DT")
2910507
"^DD",123,123.02,6,0)
FORWARDED FROM^P123.5'^GMR(123.5,^0;6^Q
"^DD",123,123.02,6,3)
Enter the name of the Hospital Service which is forwarding the consult.
"^DD",123,123.02,6,21,0)
^^2^2^2970611^^^
"^DD",123,123.02,6,21,1,0)
This is the Service which forwarded the Consult to the new TO SERVICE.
"^DD",123,123.02,6,21,2,0)
It is maintained for an audit trail.
"^DD",123,123.02,6,"DT")
2910925
"^DD",123,123.02,7,0)
PREVIOUSLY ASSIGNED TO^P200'^VA(200,^0;7^Q
"^DD",123,123.02,7,3)
Enter the name of the provider who was previously assigned this consult.
"^DD",123,123.02,7,21,0)
^^1^1^2970611^^
"^DD",123,123.02,7,21,1,0)
This field is not used in this version.
"^DD",123,123.02,7,"DT")
2911208
"^DD",123,123.02,8,0)
PRINTED TO^P3.5'^%ZIS(1,^0;8^Q
"^DD",123,123.02,8,3)
Enter the name of the Printer Device which printed the consult.
"^DD",123,123.02,8,21,0)
^^3^3^2970611^^
"^DD",123,123.02,8,21,1,0)
This is the printer that the CONSULT FORM 513 was printed to upon the
"^DD",123,123.02,8,21,2,0)
orders release from OE/RR or when the Consult/Request order is forwarded
"^DD",123,123.02,8,21,3,0)
from one service to another.
"^DD",123,123.02,8,"DT")
2920510
"^DD",123,123.02,9,0)
RESULT^V^^0;9^Q
"^DD",123,123.02,9,3)
Enter the associated result.
"^DD",123,123.02,9,21,0)
^^1^1^2980414^^
"^DD",123,123.02,9,21,1,0)
This is the result that was updated when this activity occurred.
"^DD",123,123.02,9,"DT")
2980414
"^DD",123,123.02,9,"V",0)
^.12P^1^1
"^DD",123,123.02,9,"V",1,0)
8925^Note^1^TIU^n^n
"^DD",123,123.02,10,0)
ACTION METHOD^S^1:Consult Actions;2:Order Actions;3:GUI Actions;4:TIU Interface;^0;10^Q
"^DD",123,123.02,10,3)
Enter the number that indicates how the action originated.
"^DD",123,123.02,10,21,0)
^^2^2^2980425^^
"^DD",123,123.02,10,21,1,0)
The action method will identify how the user performed the action, from a
"^DD",123,123.02,10,21,2,0)
consults menu, Order entry menu, a GUI menu, or a TIU interface.
"^DD",123,123.02,10,"DT")
2980425
"^DD",123,123.03,0)
ASSOCIATED RESULTS SUB-FIELD^^.01^1
"^DD",123,123.03,0,"DT")
2980320
"^DD",123,123.03,0,"IX","B",123.03,.01)

"^DD",123,123.03,0,"NM","ASSOCIATED RESULTS")

"^DD",123,123.03,0,"UP")
123
"^DD",123,123.03,.01,0)
ASSOCIATED RESULTS^MV^^0;1^Q
"^DD",123,123.03,.01,1,0)
^.1
"^DD",123,123.03,.01,1,1,0)
123.03^B
"^DD",123,123.03,.01,1,1,1)
S ^GMR(123,DA(1),50,"B",$E(X,1,30),DA)=""
"^DD",123,123.03,.01,1,1,2)
K ^GMR(123,DA(1),50,"B",$E(X,1,30),DA)
"^DD",123,123.03,.01,1,1,3)
Required Index for Variable Pointer
"^DD",123,123.03,.01,1,2,0)
123^R
"^DD",123,123.03,.01,1,2,1)
S ^GMR(123,"R",$E(X,1,30),DA(1),DA)=""
"^DD",123,123.03,.01,1,2,2)
K ^GMR(123,"R",$E(X,1,30),DA(1),DA)
"^DD",123,123.03,.01,1,2,"DT")
2980622
"^DD",123,123.03,.01,3)
Enter the associated result.
"^DD",123,123.03,.01,21,0)
^^2^2^2980320^
"^DD",123,123.03,.01,21,1,0)
This multiple allows one or more results to be associated with a consult.
"^DD",123,123.03,.01,21,2,0)
The results are primarily stored in the TIU DOCUMENT file (8925).
"^DD",123,123.03,.01,"DT")
2980622
"^DD",123,123.03,.01,"V",0)
^.12P^1^1
"^DD",123,123.03,.01,"V",1,0)
8925^Note^1^TIU^n^n
"^DD",123,123.25,0)
COMMENT SUB-FIELD^^.01^1
"^DD",123,123.25,0,"NM","COMMENT")

"^DD",123,123.25,0,"UP")
123.02
"^DD",123,123.25,.01,0)
COMMENT^WL^^0;1^Q
"^DD",123,123.25,.01,3)
Enter the comment that explains the activity.
"^DD",123,123.25,.01,21,0)
^^3^3^2970611^^^^
"^DD",123,123.25,.01,21,1,0)
This is a word-processing comment which you may add to provide additional
"^DD",123,123.25,.01,21,2,0)
information in reference to the Action Type selected at the "Select
"^DD",123,123.25,.01,21,3,0)
Action: " prompt.
"^DD",123,123.25,.01,22)

"^DD",123,123.25,.01,"DT")
2920608
"^DD",123.1,123.1,0)
FIELD^^7^8
"^DD",123.1,123.1,0,"DDA")
N
"^DD",123.1,123.1,0,"DT")
2980701
"^DD",123.1,123.1,0,"IX","AC",123.1,1)

"^DD",123.1,123.1,0,"IX","B",123.1,.01)

"^DD",123.1,123.1,0,"IX","D",123.1,5)

"^DD",123.1,123.1,0,"NM","REQUEST ACTION TYPES")

"^DD",123.1,123.1,0,"PT",101,6)

"^DD",123.1,123.1,0,"PT",123,9)

"^DD",123.1,123.1,0,"PT",123.02,1)

"^DD",123.1,123.1,0,"VRPK")
GMRC
"^DD",123.1,123.1,.001,0)
NUMBER^NJ6,0^^ ^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",123.1,123.1,.001,3)
Enter a number between your sites prefix_000 and your sites prefix_999.
"^DD",123.1,123.1,.001,21,0)
^^1^1^2971205^
"^DD",123.1,123.1,.001,21,1,0)
The internal entry number of the Request Action Type.
"^DD",123.1,123.1,.001,"DT")
2971205
"^DD",123.1,123.1,.01,0)
ACTION TYPE^RFX^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>80!($L(X)<3)!'(X'?1P.E)!(X'?.ANP) X
"^DD",123.1,123.1,.01,1,0)
^.1^^-1
"^DD",123.1,123.1,.01,1,1,0)
123.1^B
"^DD",123.1,123.1,.01,1,1,1)
S ^GMR(123.1,"B",$E(X,1,30),DA)=""
"^DD",123.1,123.1,.01,1,1,2)
K ^GMR(123.1,"B",$E(X,1,30),DA)
"^DD",123.1,123.1,.01,3)
ENTER THE ACTION NAME. ANSWER MUST BE 3-80 CHARACTERS IN LENGTH
"^DD",123.1,123.1,.01,21,0)
^^6^6^2970911^^^^
"^DD",123.1,123.1,.01,21,1,0)
This file contains the tracking actions which may be taken to track
"^DD",123.1,123.1,.01,21,2,0)
a Consult or Request order from its entry in CPRS through its
"^DD",123.1,123.1,.01,21,3,0)
resolution.
"^DD",123.1,123.1,.01,21,4,0)
 
"^DD",123.1,123.1,.01,21,5,0)
This file also contains relationships of CPRS statuses which are the
"^DD",123.1,123.1,.01,21,6,0)
result of the action taken.
"^DD",123.1,123.1,.01,"DT")
2910529
"^DD",123.1,123.1,1,0)
RELATED OE/RR STATUS^P100.01'^ORD(100.01,^0;2^Q
"^DD",123.1,123.1,1,1,0)
^.1
"^DD",123.1,123.1,1,1,1,0)
123.1^AC
"^DD",123.1,123.1,1,1,1,1)
S ^GMR(123.1,"AC",$E(X,1,30),DA)=""
"^DD",123.1,123.1,1,1,1,2)
K ^GMR(123.1,"AC",$E(X,1,30),DA)
"^DD",123.1,123.1,1,1,1,"%D",0)
^^3^3^2920608^^^
"^DD",123.1,123.1,1,1,1,"%D",1,0)
This cross-reference is used when the call to RESULT^GMRCR returns an
"^DD",123.1,123.1,1,1,1,"%D",2,0)
OE/RR status.  This OE/RR status is used to determine the action type to
"^DD",123.1,123.1,1,1,1,"%D",3,0)
use to update activity tracking.
"^DD",123.1,123.1,1,1,1,"DT")
2910529
"^DD",123.1,123.1,1,3)
This is the CPRS Status used to update the order in CPRS.
"^DD",123.1,123.1,1,21,0)
^^2^2^2970911^^^^
"^DD",123.1,123.1,1,21,1,0)
This is the CPRS status which will be used to update the order in OE/RR
"^DD",123.1,123.1,1,21,2,0)
when this action is taken.
"^DD",123.1,123.1,1,"DT")
2970911
"^DD",123.1,123.1,3,0)
DISABLED MESSAGE^F^^0;4^K:$L(X)>40!($L(X)<1) X
"^DD",123.1,123.1,3,3)
Enter the message that will display when this action is disabled, 1-40 characters.
"^DD",123.1,123.1,3,21,0)
^^2^2^2970911^^^^
"^DD",123.1,123.1,3,21,1,0)
This field displays a 'DISABLED' message when this CPRS status has been
"^DD",123.1,123.1,3,21,2,0)
disabled.
"^DD",123.1,123.1,3,"DT")
2920225
"^DD",123.1,123.1,4,0)
HL7 CONTROL CODE FROM CONSULTS^F^^0;5^K:$L(X)>2!($L(X)<1) X
"^DD",123.1,123.1,4,3)
Enter 2 character HL7 code related to the action.
"^DD",123.1,123.1,4,21,0)
^^12^12^2971112^
"^DD",123.1,123.1,4,21,1,0)
This field indicates what HL7 control code is passed to CPRS from
"^DD",123.1,123.1,4,21,2,0)
Consults.
"^DD",123.1,123.1,4,21,3,0)
    Example: 
"^DD",123.1,123.1,4,21,4,0)
             "SN"=Service entered, backdoor consult, automatically
"^DD",123.1,123.1,4,21,5,0)
released from CPRS, though signatures may still be required depending on
"^DD",123.1,123.1,4,21,6,0)
nature of order
"^DD",123.1,123.1,4,21,7,0)
             "OD"=Discontinued
"^DD",123.1,123.1,4,21,8,0)
             "OC"=Denied by service (Cancelled)
"^DD",123.1,123.1,4,21,9,0)
             "SC"=Service status update (generic status change) for active
"^DD",123.1,123.1,4,21,10,0)
and partial results
"^DD",123.1,123.1,4,21,11,0)
             "XX"=Forwarded
"^DD",123.1,123.1,4,21,12,0)
             "RE"=Completed
"^DD",123.1,123.1,4,"DT")
2971112
"^DD",123.1,123.1,5,0)
HL7 CONTROL CODE FROM CPRS^F^^0;6^K:$L(X)>2!($L(X)<1) X
"^DD",123.1,123.1,5,1,0)
^.1
"^DD",123.1,123.1,5,1,1,0)
123.1^D
"^DD",123.1,123.1,5,1,1,1)
S ^GMR(123.1,"D",$E(X,1,30),DA)=""
"^DD",123.1,123.1,5,1,1,2)
K ^GMR(123.1,"D",$E(X,1,30),DA)
"^DD",123.1,123.1,5,1,1,"%D",0)
^^2^2^2971112^
"^DD",123.1,123.1,5,1,1,"%D",1,0)
This cross-reference allows Consults to convert an order control from
"^DD",123.1,123.1,5,1,1,"%D",2,0)
HL7 Table 0119 to a Consult activity for tracking.
"^DD",123.1,123.1,5,1,1,"DT")
2971112
"^DD",123.1,123.1,5,3)
Enter the HL7 Control code passed from CPRS for this action.
"^DD",123.1,123.1,5,21,0)
^^5^5^2971112^
"^DD",123.1,123.1,5,21,1,0)
This field indicates what HL7 control code is passed from CPRS to
"^DD",123.1,123.1,5,21,2,0)
Consults.
"^DD",123.1,123.1,5,21,3,0)
    Example: "NW"=New consult entered and released through CPRS
"^DD",123.1,123.1,5,21,4,0)
             "CA"=Cancelled via the orders tab
"^DD",123.1,123.1,5,21,5,0)
             "DC"=Discontinued
"^DD",123.1,123.1,5,"DT")
2971112
"^DD",123.1,123.1,6,0)
HL7 TABLE 38 ORDER STATUS^F^^0;7^K:$L(X)>2!($L(X)<1) X
"^DD",123.1,123.1,6,3)
Enter the 1-2 character code from HL7 Table 0038
"^DD",123.1,123.1,6,21,0)
^^2^2^2971114^
"^DD",123.1,123.1,6,21,1,0)
This field is for documenting purposes and contains the related Table 38
"^DD",123.1,123.1,6,21,2,0)
order status from HL7 for each activity.
"^DD",123.1,123.1,6,"DT")
2971114
"^DD",123.1,123.1,7,0)
ACTION PRINT NAME^F^^0;8^K:$L(X)>30!($L(X)<1) X
"^DD",123.1,123.1,7,3)
Enter the text to appear before comments on the 513
"^DD",123.1,123.1,7,21,0)
^^1^1^2980624^
"^DD",123.1,123.1,7,21,1,0)
This field is used on the 513 Form as a header for comments.
"^DD",123.1,123.1,7,"DT")
2980624
"^DD",123.5,123.5,0)
FIELD^^101^24
"^DD",123.5,123.5,0,"DDA")
N
"^DD",123.5,123.5,0,"DT")
2990423
"^DD",123.5,123.5,0,"IX","AC1",123.5,.01)

"^DD",123.5,123.5,0,"IX","APC",123.51,.01)

"^DD",123.5,123.5,0,"IX","APR",123.5101,.01)

"^DD",123.5,123.5,0,"IX","B",123.5,.01)

"^DD",123.5,123.5,0,"IX","C",123.5,123.06)

"^DD",123.5,123.5,0,"IX","D",123.52,.01)

"^DD",123.5,123.5,0,"NM","REQUEST SERVICES")

"^DD",123.5,123.5,0,"PT",101,6)

"^DD",123.5,123.5,0,"PT",123,1)

"^DD",123.5,123.5,0,"PT",123.02,6)

"^DD",123.5,123.5,0,"PT",123.21,.01)

"^DD",123.5,123.5,0,"PT",123.51,.01)

"^DD",123.5,123.5,0,"PT",123.92,.01)

"^DD",123.5,123.5,0,"PT",123.99,.02)

"^DD",123.5,123.5,0,"VRPK")
GMRC
"^DD",123.5,123.5,.01,0)
SERVICE NAME^RF^^0;1^K:$L(X)>63!($L(X)<2)!'(X'?1P.E) X
"^DD",123.5,123.5,.01,1,0)
^.1
"^DD",123.5,123.5,.01,1,1,0)
123.5^B
"^DD",123.5,123.5,.01,1,1,1)
S ^GMR(123.5,"B",$E(X,1,63),DA)=""
"^DD",123.5,123.5,.01,1,1,2)
K ^GMR(123.5,"B",$E(X,1,63),DA)
"^DD",123.5,123.5,.01,1,1,"%D",0)
^^2^2^2971217^^^
"^DD",123.5,123.5,.01,1,1,"%D",1,0)
This is the regular cross-reference for this file allowing look-up by
"^DD",123.5,123.5,.01,1,1,"%D",2,0)
Service Name.
"^DD",123.5,123.5,.01,1,2,0)
123.5^AC1^MUMPS
"^DD",123.5,123.5,.01,1,2,1)
D SETAC^GMRCDDX
"^DD",123.5,123.5,.01,1,2,2)
D KILLAC^GMRCDDX
"^DD",123.5,123.5,.01,1,2,3)
This cross-reference is what helps maintain the alphabetical look-up of services.
"^DD",123.5,123.5,.01,1,2,"%D",0)
^^5^5^2971103^
"^DD",123.5,123.5,.01,1,2,"%D",1,0)
This cross-reference calls the GMRCDDX routine to set and kill "AC"
"^DD",123.5,123.5,.01,1,2,"%D",2,0)
cross-references that are defined for DD 123.51 (Sub-Service/Specialty
"^DD",123.5,123.5,.01,1,2,"%D",3,0)
multiple),.01 field.  The ACP cross reference helps identify all entries
"^DD",123.5,123.5,.01,1,2,"%D",4,0)
in file 123.5 which have the service being edited as a child.  For each
"^DD",123.5,123.5,.01,1,2,"%D",5,0)
occurrence as a child, the "AC" cross-reference is updated.
"^DD",123.5,123.5,.01,1,2,"DT")
2971103
"^DD",123.5,123.5,.01,3)
Type the name of a service or specialty that can receive consults.
"^DD",123.5,123.5,.01,21,0)
^^3^3^2990119^^^^
"^DD",123.5,123.5,.01,21,1,0)
This is the Name of a service or specialty which may receive consult/
"^DD",123.5,123.5,.01,21,2,0)
requests.  This may also be a name which represents a group of services
"^DD",123.5,123.5,.01,21,3,0)
or specialties.
"^DD",123.5,123.5,.01,"DT")
2971103
"^DD",123.5,123.5,1.1,0)
SYNONYM^123.52^^2;0
"^DD",123.5,123.5,1.1,21,0)
^^4^4^2970911^^^^
"^DD",123.5,123.5,1.1,21,1,0)
This multiple field identifies the commonly known names and abbreviations
"^DD",123.5,123.5,1.1,21,2,0)
for the Service named in the .01 Name field.  Synonyms identified here
"^DD",123.5,123.5,1.1,21,3,0)
are used in the look-up of services at 'Select Service/Specialty: '
"^DD",123.5,123.5,1.1,21,4,0)
prompts.
"^DD",123.5,123.5,1.11,0)
PRINT NAME^F^^.1;1^K:$L(X)>7!($L(X)<1) X
"^DD",123.5,123.5,1.11,.1)
ABBREVIATED PRINT NAME
"^DD",123.5,123.5,1.11,3)
Answer must be 1-7 characters in length.
"^DD",123.5,123.5,1.11,21,0)
^^5^5^2970911^^^^
"^DD",123.5,123.5,1.11,21,1,0)
This is a commonly known Abbreviation for this Service/Specialty.  
"^DD",123.5,123.5,1.11,21,2,0)
This name is used to build Consult Notifications when a consult/request
"^DD",123.5,123.5,1.11,21,3,0)
is ordered in OE/RR.
"^DD",123.5,123.5,1.11,21,4,0)
  
"^DD",123.5,123.5,1.11,21,5,0)
If not defined, the NAME (.01) is used.
"^DD",123.5,123.5,1.11,"DT")
2920423
"^DD",123.5,123.5,2,0)
SERVICE USAGE^S^1:GROUPER ONLY;2:TRACKING ONLY;9:DISABLED;^0;2^Q
"^DD",123.5,123.5,2,3)
Enter '1' if the service is Grouper Only, 2 if the service is to be used for TRACKING Only, and 9 to DISABLE the service.
"^DD",123.5,123.5,2,21,0)
^^24^24^2980720^
"^DD",123.5,123.5,2,21,1,0)
Whenever a value is defined in the SERVICE USAGE field, the Service
"^DD",123.5,123.5,2,21,2,0)
entry will NOT be selectable to send consults TO in the OE/RR ordering
"^DD",123.5,123.5,2,21,3,0)
process.  
"^DD",123.5,123.5,2,21,4,0)
  
"^DD",123.5,123.5,2,21,5,0)
Service Usages cause functioning as follows:
"^DD",123.5,123.5,2,21,6,0)
GROUPER ONLY - Allows a service to be used for grouping other 
"^DD",123.5,123.5,2,21,7,0)
services together for review purposes, and aids in defining the 
"^DD",123.5,123.5,2,21,8,0)
service hierarchy (e.g., ALL SERVICES, INPATIENT SERVICES, OUTSIDE
"^DD",123.5,123.5,2,21,9,0)
SERVICES).  During the order process, a user selecting a grouper only
"^DD",123.5,123.5,2,21,10,0)
service will be shown the service hierarchy under that service grouper.
"^DD",123.5,123.5,2,21,11,0)
A Grouper ONLY service should never be a "TO" Service on a consult.
"^DD",123.5,123.5,2,21,12,0)
  
"^DD",123.5,123.5,2,21,13,0)
TRACKING ONLY - Allows a service to be defined in a hierarchy,
"^DD",123.5,123.5,2,21,14,0)
but will not allow users ordering consults in OE/RR to be able to see
"^DD",123.5,123.5,2,21,15,0)
or select a service marked for TRACKING ONLY.  (e.g., Psychology
"^DD",123.5,123.5,2,21,16,0)
may be defined with its Service Usage blank, and its Sub-specialty
"^DD",123.5,123.5,2,21,17,0)
multiple defined with services of which some or all may be "TRACKING
"^DD",123.5,123.5,2,21,18,0)
ONLY" services.  This hierarchy facilitates the situation when a
"^DD",123.5,123.5,2,21,19,0)
service, such as Psychology, prefers a common location for all related
"^DD",123.5,123.5,2,21,20,0)
consults to be sent to. A Tracking user at the common location then 
"^DD",123.5,123.5,2,21,21,0)
"Forwards" the request to one of the sub-service TRACKING ONLY services
"^DD",123.5,123.5,2,21,22,0)
for completion.)
"^DD",123.5,123.5,2,21,23,0)
 
"^DD",123.5,123.5,2,21,24,0)
DISABLED - Disabled services are not selectable for ordering or tracking.
"^DD",123.5,123.5,2,"DT")
2920206
"^DD",123.5,123.5,3,0)
DISABLE MESSAGE^F^^0;3^K:$L(X)>80!($L(X)<1) X
"^DD",123.5,123.5,3,3)
Enter a message that will display if/when this service is DISABLED, 1-80 characters in length.
"^DD",123.5,123.5,3,21,0)
^^2^2^2970911^^
"^DD",123.5,123.5,3,21,1,0)
If a service is disabled, a DISABLED message will be displayed on
"^DD",123.5,123.5,3,21,2,0)
the screen.
"^DD",123.5,123.5,3,"DT")
2910613
"^DD",123.5,123.5,5,0)
CREATOR^P200'^VA(200,^0;5^Q
"^DD",123.5,123.5,5,3)
Type in the name of the person creating the new service entry.
"^DD",123.5,123.5,5,21,0)
^^1^1^2971007^^^^
"^DD",123.5,123.5,5,21,1,0)
This field identifies who created the service entry.
"^DD",123.5,123.5,5,"DT")
2910528
"^DD",123.5,123.5,10,0)
SUB-SERVICE^123.51P^^10;0
"^DD",123.5,123.5,10,20,0)
^.3LA^^0
"^DD",123.5,123.5,10,21,0)
^^4^4^2970911^^^^
"^DD",123.5,123.5,10,21,1,0)
This is the set of services or specialties that may be grouped under
"^DD",123.5,123.5,10,21,2,0)
the Service/Specialty.  A member of this sub-service may also be defined
"^DD",123.5,123.5,10,21,3,0)
to have its own sub-service/specialties. There is no limit to the
"^DD",123.5,123.5,10,21,4,0)
depth of the hierarchy beneath ALL SERVICES.
"^DD",123.5,123.5,10,"DT")
2910710
"^DD",123.5,123.5,20,0)
ENTRY ACTION^K^^20;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",123.5,123.5,20,3)
ENTER STANDARD MUMPS CODE
"^DD",123.5,123.5,20,8.5)
@
"^DD",123.5,123.5,20,9)
@
"^DD",123.5,123.5,20,21,0)
^^2^2^2970911^^^^
"^DD",123.5,123.5,20,21,1,0)
This field contains MUMPS code that will be executed when someone
"^DD",123.5,123.5,20,21,2,0)
enters this option for CPRS Detailed and Results displays.
"^DD",123.5,123.5,20,"DT")
2910724
"^DD",123.5,123.5,101,0)
PROCEDURE TYPE^123.5101P^^101;0
"^DD",123.5,123.5,101,"V",0)
^.12P
"^DD",123.5,123.5,123.01,0)
OE/RR DISPLAY GROUP^P100.98'^ORD(100.98,^123;1^Q
"^DD",123.5,123.5,123.01,3)
Enter the CPRS display group that this service belongs to.
"^DD",123.5,123.5,123.01,21,0)
^^2^2^2970911^^^^
"^DD",123.5,123.5,123.01,21,1,0)
The display group will automatically default to CONSULTS if there is no
"^DD",123.5,123.5,123.01,21,2,0)
other display group defined as a sub-group of CONSULTS.
"^DD",123.5,123.5,123.01,"DT")
2910821
"^DD",123.5,123.5,123.011,0)
SERVICE UPDATE OPTION^P19'^DIC(19,^123;10^Q
"^DD",123.5,123.5,123.011,3)
Enter the Protocol Action Menu to assign to a user for selecting actions from the Consult/Request screen.
"^DD",123.5,123.5,123.011,21,0)
8^^11^11^2970911^^^^
"^DD",123.5,123.5,123.011,21,1,0)
This field provides security by defining who can actually perform tracking 
"^DD",123.5,123.5,123.011,21,2,0)
activities for a service/specialty's consults, based on the Option used.
"^DD",123.5,123.5,123.011,21,3,0)
  
"^DD",123.5,123.5,123.011,21,4,0)
This field works in conjunction with the PROTOCOL ACTION MENU BY OPTION
"^DD",123.5,123.5,123.011,21,5,0)
field.
"^DD",123.5,123.5,123.011,21,6,0)
If an option is identified here, and the user selects this option to
"^DD",123.5,123.5,123.011,21,7,0)
review consults/requests, the user will be given access to the Protocol
"^DD",123.5,123.5,123.011,21,8,0)
action menu defined in the PROTOCOL ACTION MENU BY OPTION field.  
"^DD",123.5,123.5,123.011,21,9,0)
If this option was not used to access the consult/request tracking data,
"^DD",123.5,123.5,123.011,21,10,0)
the user will only see the actions defined in the
"^DD",123.5,123.5,123.011,21,11,0)
GMRCACTM USER REVIEW SCREEN protocol menu.
"^DD",123.5,123.5,123.011,"DT")
2920212
"^DD",123.5,123.5,123.02,0)
PROTOCOL MENU OF REQUEST ITEMS^P101'^ORD(101,^123;2^Q
"^DD",123.5,123.5,123.02,3)
Enter the PROCEDURE to be associated with this service.
"^DD",123.5,123.5,123.02,21,0)
^^5^5^2970911^^^^
"^DD",123.5,123.5,123.02,21,1,0)
This field is being used primarily for the Medicine Package Interface to
"^DD",123.5,123.5,123.02,21,2,0)
link the Medicine Service to a Protocol Menu representing the Procedure
"^DD",123.5,123.5,123.02,21,3,0)
Types of the Medicine Package.  The GMRC MEDICINE PKG INTERFACE option
"^DD",123.5,123.5,123.02,21,4,0)
uses this entry to determine the service and the type of results the 
"^DD",123.5,123.5,123.02,21,5,0)
Medicine Personnel may be associating results with.
"^DD",123.5,123.5,123.02,"DT")
2920225
"^DD",123.5,123.5,123.03,0)
PROTOCOL ACTION MENU BY USERS^P101'^ORD(101,^123;3^Q
"^DD",123.5,123.5,123.03,3)
Enter GMRCACTM USER REVIEW SCREEN or GMRCACTM SERVICE ACTION MENU to determine what actions can be taken by the user.
"^DD",123.5,123.5,123.03,21,0)
^^12^12^2970911^^^^
"^DD",123.5,123.5,123.03,21,1,0)
This is the Protocol menu of actions in the Protocol file which may be
"^DD",123.5,123.5,123.03,21,2,0)
used by users identified in the "Service Individual to Notify,"
"^DD",123.5,123.5,123.03,21,3,0)
"Service Teams to Notify," and "Update Users w/o Notification" fields
"^DD",123.5,123.5,123.03,21,4,0)
for a Service.  
"^DD",123.5,123.5,123.03,21,5,0)
 
"^DD",123.5,123.5,123.03,21,6,0)
Two generic protocol action menus are exported, GMRCACTM USER REVIEW 
"^DD",123.5,123.5,123.03,21,7,0)
SCREEN and GMRCACTM SERVICE ACTION MENU.  The GMRCACTM USER REVIEW SCREEN is
"^DD",123.5,123.5,123.03,21,8,0)
the default protocol menu of actions which will be used when no other
"^DD",123.5,123.5,123.03,21,9,0)
protocol is defined.  This default menu of actions contains inquiry only 
"^DD",123.5,123.5,123.03,21,10,0)
kinds of actions.  The GMRCACTM SERVICE ACTION MENU contains actions
"^DD",123.5,123.5,123.03,21,11,0)
which allow the consult/request to be tracked to its final resolution
"^DD",123.5,123.5,123.03,21,12,0)
of Denied, Discontinued, or Completed.
"^DD",123.5,123.5,123.03,"DT")
2920515
"^DD",123.5,123.5,123.04,0)
PROTOCOL ACTION MENU BY OPTION^P101'^ORD(101,^123;4^Q
"^DD",123.5,123.5,123.04,.1)

"^DD",123.5,123.5,123.04,3)
Enter the Protocol Action that may be used by a person to perform actions on the Consults screen.
"^DD",123.5,123.5,123.04,21,0)
^^27^27^2970911^^^^
"^DD",123.5,123.5,123.04,21,1,0)
This is the menu of protocol actions in the Protocol File that may be
"^DD",123.5,123.5,123.04,21,2,0)
used when the option named in the SERVICE UPDATE OPTION field 
"^DD",123.5,123.5,123.04,21,3,0)
is the option used to review the consults/requests.
"^DD",123.5,123.5,123.04,21,4,0)
  
"^DD",123.5,123.5,123.04,21,5,0)
This field is only used when the IRM service wants to establish
"^DD",123.5,123.5,123.04,21,6,0)
security BY SERVICE via site-specific options.
"^DD",123.5,123.5,123.04,21,7,0)
  
"^DD",123.5,123.5,123.04,21,8,0)
If neither the PROTOCOL ACTION MENU BY OPTION or the SERVICE UPDATE
"^DD",123.5,123.5,123.04,21,9,0)
OPTION are used to specify service security, then the PROTOCOL ACTION MENU 
"^DD",123.5,123.5,123.04,21,10,0)
BY KEY and SERVICE UPDATE SECURITY KEY are checked to establish the correct
"^DD",123.5,123.5,123.04,21,11,0)
menu of actions allowed for the user BY SERVICE.
"^DD",123.5,123.5,123.04,21,12,0)
 
"^DD",123.5,123.5,123.04,21,13,0)
The "GMRCACTM USER REVIEW SCREEN" protocol menu of actions will 
"^DD",123.5,123.5,123.04,21,14,0)
be used for all users as a default.  This default menu of actions
"^DD",123.5,123.5,123.04,21,15,0)
contains inquiry only kinds of actions.
"^DD",123.5,123.5,123.04,21,16,0)
 
"^DD",123.5,123.5,123.04,21,17,0)
Sites that are using the Medicine Package to enter procedure results may
"^DD",123.5,123.5,123.04,21,18,0)
specify GMRCACTM MEDICINE PKG MENU as the Protocol Action Menu By Option
"^DD",123.5,123.5,123.04,21,19,0)
field and the GMRC MEDICINE PKG INTERFACE option as the Security Update
"^DD",123.5,123.5,123.04,21,20,0)
Optifor field.  This should only be specified on those services that are
"^DD",123.5,123.5,123.04,21,21,0)
linked to a "GMRCR " protocol via the FILE LINK field in the Protocol 
"^DD",123.5,123.5,123.04,21,22,0)
File.  The exported Medicine sub-services are already defined for use with
"^DD",123.5,123.5,123.04,21,23,0)
the GMRC MEDICINE PKG INTERFACE option.
"^DD",123.5,123.5,123.04,21,24,0)
 
"^DD",123.5,123.5,123.04,21,25,0)
Pharmacy Services should specify GMRCACTM PHARMACY PKG MENU in the
"^DD",123.5,123.5,123.04,21,26,0)
Protocol Action Menu By Option field and the GMRC PHARMACY TPN CONSULTS
"^DD",123.5,123.5,123.04,21,27,0)
option in the Service Update Option field.
"^DD",123.5,123.5,123.04,"DT")
2920422
"^DD",123.5,123.5,123.06,0)
RELATED TREATING SPECIALTY^P45.7'^DIC(45.7,^123;6^Q
"^DD",123.5,123.5,123.06,1,0)
^.1
"^DD",123.5,123.5,123.06,1,1,0)
123.5^C
"^DD",123.5,123.5,123.06,1,1,1)
S ^GMR(123.5,"C",$E(X,1,30),DA)=""
"^DD",123.5,123.5,123.06,1,1,2)
K ^GMR(123.5,"C",$E(X,1,30),DA)
"^DD",123.5,123.5,123.06,1,1,"%D",0)
^^4^4^2920608^^
"^DD",123.5,123.5,123.06,1,1,"%D",1,0)
The "C" cross-reference enables look-up of information based on the 
"^DD",123.5,123.5,123.06,1,1,"%D",2,0)
RELATED TREATING SPECIALTY.
"^DD",123.5,123.5,123.06,1,1,"%D",3,0)
This cross-reference is used to allow an individual to specify a Treating
"^DD",123.5,123.5,123.06,1,1,"%D",4,0)
Specialty in the "TO" field when Requesting a Consult or Generic Request.
"^DD",123.5,123.5,123.06,1,1,"DT")
2910530
"^DD",123.5,123.5,123.06,3)
Enter the related Treating Specialty from the FACILITY TREATING SPECIALTY File.
"^DD",123.5,123.5,123.06,21,0)
^^2^2^2970911^^^
"^DD",123.5,123.5,123.06,21,1,0)
This field may be defined for use in Fileman reporting 
"^DD",123.5,123.5,123.06,21,2,0)
 via the Relational Jumping capabilities.
"^DD",123.5,123.5,123.06,"DT")
2920528
"^DD",123.5,123.5,123.07,0)
RELATED SERVICE/SECTION^P49'^DIC(49,^123;7^Q
"^DD",123.5,123.5,123.07,3)
Enter the RELATED SERVICE/SECTION from the SERVICE/SECTION File.
"^DD",123.5,123.5,123.07,"DT")
2910710
"^DD",123.5,123.5,123.08,0)
SERVICE INDIVIDUAL TO NOTIFY^P200'^VA(200,^123;8^Q
"^DD",123.5,123.5,123.08,3)
Enter the name of the individual in the Service who will receive a default notification of any action taken on a consult.
"^DD",123.5,123.5,123.08,21,0)
^^11^11^2970911^^^^
"^DD",123.5,123.5,123.08,21,1,0)
A user may be identified in this field as having primary responsibility for
"^DD",123.5,123.5,123.08,21,2,0)
receiving consults and tracking them through to completion or 
"^DD",123.5,123.5,123.08,21,3,0)
discontinuance.  This individual will receive a "NEW SERVICE CONSULT"
"^DD",123.5,123.5,123.08,21,4,0)
notification type when a new order is released to the service
"^DD",123.5,123.5,123.08,21,5,0)
through CPRS.  The notification will appear in the following
"^DD",123.5,123.5,123.08,21,6,0)
format:
"^DD",123.5,123.5,123.08,21,7,0)
  NIVEK,ALP (N8976): New Psychology Consult ordered
"^DD",123.5,123.5,123.08,21,8,0)
  JONES,GEO (J4552): New Psychology consult forwarded - Stat
"^DD",123.5,123.5,123.08,21,9,0)
  
"^DD",123.5,123.5,123.08,21,10,0)
The user must have the "NEW SERVICE CONSULT/REQUEST" notification type
"^DD",123.5,123.5,123.08,21,11,0)
enabled.
"^DD",123.5,123.5,123.08,"DT")
2920515
"^DD",123.5,123.5,123.09,0)
SERVICE PRINTER^P3.5'^%ZIS(1,^123;9^Q
"^DD",123.5,123.5,123.09,3)
Enter the name of the Service/Section's Printing Device, or the nearest Printer.
"^DD",123.5,123.5,123.09,21,0)
^^10^10^2970911^^^^
"^DD",123.5,123.5,123.09,21,1,0)
This field allows the service/specialty to identify a device that 
"^DD",123.5,123.5,123.09,21,2,0)
will be used for printing Consult Forms (513) 'automatically' at the 
"^DD",123.5,123.5,123.09,21,3,0)
service when the consult/request order is released by CPRS.
"^DD",123.5,123.5,123.09,21,4,0)
  
"^DD",123.5,123.5,123.09,21,5,0)
If the device is not defined, the Consult Form will print at the location
"^DD",123.5,123.5,123.09,21,6,0)
where the order was placed, bypassing the electronic relay functionality.
"^DD",123.5,123.5,123.09,21,7,0)
The order text in CPRS for an order to a service with no device is
"^DD",123.5,123.5,123.09,21,8,0)
prefixed with ">>."  This indicates to the ordering clerks/clinician
"^DD",123.5,123.5,123.09,21,9,0)
that the consult form needs manual processing or a call to the service to
"^DD",123.5,123.5,123.09,21,10,0)
have the service use the "PS" action to print the service copy.
"^DD",123.5,123.5,123.09,"DT")
2910716
"^DD",123.5,123.5,123.1,0)
SERVICE TEAM(S) TO NOTIFY^123.53P^^123.1;0
"^DD",123.5,123.5,123.1,21,0)
^^2^2^2990205^^^^
"^DD",123.5,123.5,123.1,21,1,0)
A service can have teams of users associated with the Service.  Any users
"^DD",123.5,123.5,123.1,21,2,0)
defined in a team related to the Service will receive Notifications.
"^DD",123.5,123.5,123.1,"DT")
2920605
"^DD",123.5,123.5,123.2,0)
NOTIFICATION BY PT LOCATION^123.54AV^^123.2;0
"^DD",123.5,123.5,123.2,21,0)
^^5^5^2970911^^^^
"^DD",123.5,123.5,123.2,21,1,0)
A service may send notifications about new consults to an individual or
"^DD",123.5,123.5,123.2,21,2,0)
teams, depending on the patient's location.  Each hospital/ward location
"^DD",123.5,123.5,123.2,21,3,0)
for patients may be defined here.  For each location, an individual or 
"^DD",123.5,123.5,123.2,21,4,0)
team(s) may be specified to receive notifications for orders based 
"^DD",123.5,123.5,123.2,21,5,0)
on the patient's location at the time the order was placed.
"^DD",123.5,123.5,123.2,"DT")
2920515
"^DD",123.5,123.5,123.3,0)
UPDATE USERS W/O NOTIFICATIONS^123.55P^^123.3;0
"^DD",123.5,123.5,123.3,21,0)
^^4^4^2970911^^^^
"^DD",123.5,123.5,123.3,21,1,0)
Service users who are able to perform update tracking actions,
"^DD",123.5,123.5,123.3,21,2,0)
but DO NOT receive "NEW SERVICE CONSULT" notifications, should be defined
"^DD",123.5,123.5,123.3,21,3,0)
here.  The update tracking capabilities are based on the Protocol
"^DD",123.5,123.5,123.3,21,4,0)
Action Menu by Users field.
"^DD",123.5,123.5,123.33,0)
ADMINISTRATIVE USERS W/O NOTIF^123.555P^^123.33;0
"^DD",123.5,123.5,123.4,0)
RELATED HOSPITAL LOCATION^123.56P^^123.4;0
"^DD",123.5,123.5,123.4,"DT")
2910710
"^DD",123.5,123.5,123.5,0)
SPECIAL UPDATES INDIVIDUAL^P200'^VA(200,^0;4^Q
"^DD",123.5,123.5,123.5,3)
This is the individual who can perform special updates for this particular service. 
"^DD",123.5,123.5,123.5,21,0)
^^9^9^2990603^^
"^DD",123.5,123.5,123.5,21,1,0)
This individual will have privileges to perform group status updates for
"^DD",123.5,123.5,123.5,21,2,0)
this service or any of the entries in the SUB-SERVICE/SPECIALTY field. 
"^DD",123.5,123.5,123.5,21,3,0)
 
"^DD",123.5,123.5,123.5,21,4,0)
It is recommended that this individual be a responsible service update
"^DD",123.5,123.5,123.5,21,5,0)
user or a Clinical Application Coordinator. If given the option GMRCSTSU,
"^DD",123.5,123.5,123.5,21,6,0)
the user will be able to choose all requests within a date range that are
"^DD",123.5,123.5,123.5,21,7,0)
pending, active or both and update the request to discontinued or
"^DD",123.5,123.5,123.5,21,8,0)
complete. This will also update the related order in CPRS to the same
"^DD",123.5,123.5,123.5,21,9,0)
status.
"^DD",123.5,123.5,123.5,"DT")
2990423
"^DD",123.5,123.51,0)
SUB-SERVICE SUB-FIELD^^2^2
"^DD",123.5,123.51,0,"DT")
2910612
"^DD",123.5,123.51,0,"IX","AC",123.51,.01)

"^DD",123.5,123.51,0,"IX","B",123.51,.01)

"^DD",123.5,123.51,0,"NM","SUB-SERVICE")

"^DD",123.5,123.51,0,"UP")
123.5
"^DD",123.5,123.51,.01,0)
SUB-SERVICE/SPECIALTY^MP123.5^GMR(123.5,^0;1^Q
"^DD",123.5,123.51,.01,1,0)
^.1
"^DD",123.5,123.51,.01,1,1,0)
123.51^B
"^DD",123.5,123.51,.01,1,1,1)
S ^GMR(123.5,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.51,.01,1,1,2)
K ^GMR(123.5,DA(1),10,"B",$E(X,1,30),DA)
"^DD",123.5,123.51,.01,1,2,0)
123.5^APC^MUMPS
"^DD",123.5,123.51,.01,1,2,1)
S ^GMR(123.5,"APC",$E(X,1,30),DA(1),DA)=""
"^DD",123.5,123.51,.01,1,2,2)
K ^GMR(123.5,"APC",$E(X,1,30),DA(1),DA)
"^DD",123.5,123.51,.01,1,2,"%D",0)
^^3^3^2971103^^
"^DD",123.5,123.51,.01,1,2,"%D",1,0)
This cross-reference is used to find the parents of a given service. This
"^DD",123.5,123.51,.01,1,2,"%D",2,0)
helps identify AC cross-references that need to be updated when the .01
"^DD",123.5,123.51,.01,1,2,"%D",3,0)
name changes, and helps manage forwarding to services.
"^DD",123.5,123.51,.01,1,2,"DT")
2971103
"^DD",123.5,123.51,.01,1,3,0)
123.51^AC^MUMPS
"^DD",123.5,123.51,.01,1,3,1)
I $L($P($G(^GMR(123.5,X,0)),U)) S ^GMR(123.5,DA(1),10,"AC",$P($G(^GMR(123.5,X,0)),U),DA)=""
"^DD",123.5,123.51,.01,1,3,2)
I $L($P($G(^GMR(123.5,X,0)),U)) K ^GMR(123.5,DA(1),10,"AC",$P($G(^GMR(123.5,X,0)),U),DA)
"^DD",123.5,123.51,.01,1,3,"%D",0)
^^2^2^2971103^^
"^DD",123.5,123.51,.01,1,3,"%D",1,0)
This cross-reference is used to build a hierarchical listing of the
"^DD",123.5,123.51,.01,1,3,"%D",2,0)
services alphabetically.
"^DD",123.5,123.51,.01,1,3,"DT")
2971103
"^DD",123.5,123.51,.01,3)
Enter the name of the Service which is to be a SUB-service of the parent service.
"^DD",123.5,123.51,.01,21,0)
^^7^7^2970911^^^^
"^DD",123.5,123.51,.01,21,1,0)
This is the menu of sub-service/specialties that are grouped under this
"^DD",123.5,123.51,.01,21,2,0)
Service.  The sub-service/specialty entries must each be defined as 
"^DD",123.5,123.51,.01,21,3,0)
entries in this file.
"^DD",123.5,123.51,.01,21,4,0)
  
"^DD",123.5,123.51,.01,21,5,0)
There is no limit on how deep the hierarchy of services may be defined.
"^DD",123.5,123.51,.01,21,6,0)
The only requirement is that the "ALL SERVICES" entry be at the top of
"^DD",123.5,123.51,.01,21,7,0)
the hierarchy.
"^DD",123.5,123.51,.01,23,0)
3^^3^3^2970911^^^^
"^DD",123.5,123.51,.01,23,1,0)
This file is similar to the Option File and Protocol File.  The same
"^DD",123.5,123.51,.01,23,2,0)
concepts for setting up options should be used to define the Service/
"^DD",123.5,123.51,.01,23,3,0)
Specialty entries.
"^DD",123.5,123.51,.01,"DT")
2971103
"^DD",123.5,123.51,2,0)
MNEMONIC^F^^0;2^K:$L(X)>4!($L(X)<1) X
"^DD",123.5,123.51,2,3)
Enter a 1 to 4-character mnemonic that can be used to refer to this service.
"^DD",123.5,123.51,2,21,0)
^^3^3^2970911^^^
"^DD",123.5,123.51,2,21,1,0)
This is a mnemonic associated with the service being entered as a sub-
"^DD",123.5,123.51,2,21,2,0)
service.  For example, if the service is Pulmonary, PU could be
"^DD",123.5,123.51,2,21,3,0)
could be defined as the mnemonic.
"^DD",123.5,123.51,2,"DT")
2910528
"^DD",123.5,123.5101,0)
PROCEDURE TYPE SUB-FIELD^^.01^1
"^DD",123.5,123.5101,0,"DT")
2981215
"^DD",123.5,123.5101,0,"IX","B",123.5101,.01)

"^DD",123.5,123.5101,0,"NM","PROCEDURE TYPE")

"^DD",123.5,123.5101,0,"UP")
123.5
"^DD",123.5,123.5101,.01,0)
PROCEDURE TYPE^M*P101'^ORD(101,^0;1^S DIC("S")="I $E(^(0),1,5)=""GMRCR""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.5,123.5101,.01,1,0)
^.1
"^DD",123.5,123.5101,.01,1,1,0)
123.5101^B
"^DD",123.5,123.5101,.01,1,1,1)
S ^GMR(123.5,DA(1),101,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.5101,.01,1,1,2)
K ^GMR(123.5,DA(1),101,"B",$E(X,1,30),DA)
"^DD",123.5,123.5101,.01,1,2,0)
123.5^APR
"^DD",123.5,123.5101,.01,1,2,1)
S ^GMR(123.5,"APR",$E(X,1,30),DA(1),DA)=""
"^DD",123.5,123.5101,.01,1,2,2)
K ^GMR(123.5,"APR",$E(X,1,30),DA(1),DA)
"^DD",123.5,123.5101,.01,1,2,"%D",0)
^^2^2^2980907^
"^DD",123.5,123.5101,.01,1,2,"%D",1,0)
This cross reference is used to find all services which process a procedure
"^DD",123.5,123.5101,.01,1,2,"%D",2,0)
type.
"^DD",123.5,123.5101,.01,1,2,"DT")
2980907
"^DD",123.5,123.5101,.01,3)
Select the procedure that can be processed by this service.
"^DD",123.5,123.5101,.01,12)
Only Procedures may be chosen.
"^DD",123.5,123.5101,.01,12.1)
S DIC("S")="I $E(^(0),1,5)=""GMRCR"""
"^DD",123.5,123.5101,.01,21,0)
^^4^4^2981215^^^^
"^DD",123.5,123.5101,.01,21,1,0)
This multiple allows procedures to be associated with the services that
"^DD",123.5,123.5101,.01,21,2,0)
are responsible for processing the procedure.  If multiple services
"^DD",123.5,123.5101,.01,21,3,0)
process a particular procedure, the ordering physician must specify which
"^DD",123.5,123.5101,.01,21,4,0)
service the procedure should go to.
"^DD",123.5,123.5101,.01,"DT")
2981215
"^DD",123.5,123.52,0)
SYNONYM SUB-FIELD^^.01^1
"^DD",123.5,123.52,0,"DT")
2910926
"^DD",123.5,123.52,0,"IX","B",123.52,.01)

"^DD",123.5,123.52,0,"NM","SYNONYM")

"^DD",123.5,123.52,0,"UP")
123.5
"^DD",123.5,123.52,.01,0)
SYNONYM^MF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>45!($L(X)<2) X
"^DD",123.5,123.52,.01,1,0)
^.1
"^DD",123.5,123.52,.01,1,1,0)
123.52^B
"^DD",123.5,123.52,.01,1,1,1)
S ^GMR(123.5,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.52,.01,1,1,2)
K ^GMR(123.5,DA(1),2,"B",$E(X,1,30),DA)
"^DD",123.5,123.52,.01,1,2,0)
123.5^D
"^DD",123.5,123.52,.01,1,2,1)
S ^GMR(123.5,"D",$E(X,1,30),DA(1),DA)=""
"^DD",123.5,123.52,.01,1,2,2)
K ^GMR(123.5,"D",$E(X,1,30),DA(1),DA)
"^DD",123.5,123.52,.01,1,2,"%D",0)
^^2^2^2920608^^
"^DD",123.5,123.52,.01,1,2,"%D",1,0)
This cross-reference allows SYNONYMS to be used to find the Service to
"^DD",123.5,123.52,.01,1,2,"%D",2,0)
send a consult to.
"^DD",123.5,123.52,.01,1,2,"DT")
2910926
"^DD",123.5,123.52,.01,3)
This is the common name/abbreviation for the Service, 2-45 characters in length.
"^DD",123.5,123.52,.01,21,0)
^^4^4^2970911^^
"^DD",123.5,123.52,.01,21,1,0)
This multiple field identifies the commonly known names and abbreviations
"^DD",123.5,123.52,.01,21,2,0)
for the Service named in the .01 Name field.  Synonyms identified here
"^DD",123.5,123.52,.01,21,3,0)
are used in the look-up of services at 'Select Service/Specialty: '
"^DD",123.5,123.52,.01,21,4,0)
prompts.
"^DD",123.5,123.52,.01,"DT")
2910926
"^DD",123.5,123.53,0)
SERVICE TEAM(S) TO NOTIFY SUB-FIELD^^.01^1
"^DD",123.5,123.53,0,"DT")
2971024
"^DD",123.5,123.53,0,"IX","B",123.53,.01)

"^DD",123.5,123.53,0,"NM","SERVICE TEAM(S) TO NOTIFY")

"^DD",123.5,123.53,0,"UP")
123.5
"^DD",123.5,123.53,.01,0)
SERVICE TEAM TO NOTIFY^P100.21'^OR(100.21,^0;1^Q
"^DD",123.5,123.53,.01,1,0)
^.1
"^DD",123.5,123.53,.01,1,1,0)
123.53^B
"^DD",123.5,123.53,.01,1,1,1)
S ^GMR(123.5,DA(1),123.1,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.53,.01,1,1,2)
K ^GMR(123.5,DA(1),123.1,"B",$E(X,1,30),DA)
"^DD",123.5,123.53,.01,3)
Enter the name of the Service Team that is to receive notifications of any actions taken on a consult.
"^DD",123.5,123.53,.01,21,0)
^^9^9^2990205^^^^
"^DD",123.5,123.53,.01,21,1,0)
A team of users may be identified (from the TEAM FILE, #404.51) who will
"^DD",123.5,123.53,.01,21,2,0)
receive a "NEW SERVICE CONSULT" notification when a new order is 
"^DD",123.5,123.53,.01,21,3,0)
released to the service through OE/RR.  The notification will appear in
"^DD",123.5,123.53,.01,21,4,0)
the following format:
"^DD",123.5,123.53,.01,21,5,0)
   NIVEK,ALP (N8796): New Psychology Consult ordered
"^DD",123.5,123.53,.01,21,6,0)
The individuals on the teams must have the "NEW SERVICE CONSULT/REQUEST"
"^DD",123.5,123.53,.01,21,7,0)
notification type turned "ON".
"^DD",123.5,123.53,.01,21,8,0)
  
"^DD",123.5,123.53,.01,21,9,0)
Team members will be able to perform update tracking capabilities.
"^DD",123.5,123.53,.01,"DT")
2971024
"^DD",123.5,123.54,0)
NOTIFICATION BY PT LOCATION SUB-FIELD^^2^3
"^DD",123.5,123.54,0,"DT")
2971025
"^DD",123.5,123.54,0,"IX","B",123.54,.01)

"^DD",123.5,123.54,0,"NM","NOTIFICATION BY PT LOCATION")

"^DD",123.5,123.54,0,"UP")
123.5
"^DD",123.5,123.54,.01,0)
NOTIFICATION BY PT LOCATION^MV^^0;1^Q
"^DD",123.5,123.54,.01,1,0)
^.1
"^DD",123.5,123.54,.01,1,1,0)
123.54^B
"^DD",123.5,123.54,.01,1,1,1)
S ^GMR(123.5,DA(1),123.2,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.54,.01,1,1,2)
K ^GMR(123.5,DA(1),123.2,"B",$E(X,1,30),DA)
"^DD",123.5,123.54,.01,1,1,3)
Required Index for Variable Pointer
"^DD",123.5,123.54,.01,3)
Enter the name of the individual on this service/location who is to receive notifications when any action is taken on a consult.
"^DD",123.5,123.54,.01,21,0)
^^7^7^2970611^^^^
"^DD",123.5,123.54,.01,21,1,0)
Enter a ward location or hospital location which the service wishes to
"^DD",123.5,123.54,.01,21,2,0)
assign a service individual or team to.
"^DD",123.5,123.54,.01,21,3,0)
 
"^DD",123.5,123.54,.01,21,4,0)
When a consult or request is ordered, notifications to the receiving
"^DD",123.5,123.54,.01,21,5,0)
service will check to see if the patients location is defined here.
"^DD",123.5,123.54,.01,21,6,0)
If defined, notifications will be sent to the specified individual and/or
"^DD",123.5,123.54,.01,21,7,0)
members of the specified team.
"^DD",123.5,123.54,.01,"DT")
2920603
"^DD",123.5,123.54,.01,"V",0)
^.12P^2^2
"^DD",123.5,123.54,.01,"V",1,0)
42^Enter Ward Location^1^W^n^n
"^DD",123.5,123.54,.01,"V",2,0)
44^Enter Hospital Location^2^H^n^n
"^DD",123.5,123.54,1,0)
INDIVIDUAL TO NOTIFY^P200'^VA(200,^0;2^Q
"^DD",123.5,123.54,1,3)
Enter the individual's name who is responsible for receiving notifications of actions on consults at this location.
"^DD",123.5,123.54,1,21,0)
^^6^6^2970611^^^^
"^DD",123.5,123.54,1,21,1,0)
This is the Individual that is assigned to this location for this 
"^DD",123.5,123.54,1,21,2,0)
Service.  When a consult/request order for this Service is released
"^DD",123.5,123.54,1,21,3,0)
from OE/RR for a patient at this location, this individual will 
"^DD",123.5,123.54,1,21,4,0)
receive the new order notification.
"^DD",123.5,123.54,1,21,5,0)
Enter the individual who should receive notifications when a consult 
"^DD",123.5,123.54,1,21,6,0)
order is released from OE/RR FOR this service, FROM this location.
"^DD",123.5,123.54,1,"DT")
2920603
"^DD",123.5,123.54,2,0)
TEAM TO NOTIFY^P100.21'^OR(100.21,^0;3^Q
"^DD",123.5,123.54,2,3)
Enter the name of the TEAM at this location which is to receive notifications of any actions taken on a consult.
"^DD",123.5,123.54,2,21,0)
^^1^1^2970611^^^^
"^DD",123.5,123.54,2,21,1,0)
This is the Team that is assigned to this location for the Service.
"^DD",123.5,123.54,2,"DT")
2971025
"^DD",123.5,123.55,0)
UPDATE USERS W/O NOTIFICATIONS SUB-FIELD^^.01^1
"^DD",123.5,123.55,0,"DT")
2920515
"^DD",123.5,123.55,0,"IX","B",123.55,.01)

"^DD",123.5,123.55,0,"NM","UPDATE USERS W/O NOTIFICATIONS")

"^DD",123.5,123.55,0,"UP")
123.5
"^DD",123.5,123.55,.01,0)
UPDATE USERS W/O NOTIFICATIONS^MP200'^VA(200,^0;1^Q
"^DD",123.5,123.55,.01,1,0)
^.1
"^DD",123.5,123.55,.01,1,1,0)
123.55^B
"^DD",123.5,123.55,.01,1,1,1)
S ^GMR(123.5,DA(1),123.3,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.55,.01,1,1,2)
K ^GMR(123.5,DA(1),123.3,"B",$E(X,1,30),DA)
"^DD",123.5,123.55,.01,3)
Enter the name of individual who can do update tracking, but who will not get a notification.
"^DD",123.5,123.55,.01,21,0)
^^4^4^2970611^^^
"^DD",123.5,123.55,.01,21,1,0)
Service users who should be able to perform update tracking capabilities,
"^DD",123.5,123.55,.01,21,2,0)
but DO NOT receive "NEW SERVICE CONSULT" notifications should be defined
"^DD",123.5,123.55,.01,21,3,0)
here.  The update tracking capabilities will be based on the Protocol
"^DD",123.5,123.55,.01,21,4,0)
Action Menu By Users field.
"^DD",123.5,123.55,.01,"DT")
2920515
"^DD",123.5,123.555,0)
ADMINISTRATIVE USERS W/O NOTIF SUB-FIELD^^.01^1
"^DD",123.5,123.555,0,"DT")
2980421
"^DD",123.5,123.555,0,"IX","B",123.555,.01)

"^DD",123.5,123.555,0,"NM","ADMINISTRATIVE USERS W/O NOTIF")

"^DD",123.5,123.555,0,"UP")
123.5
"^DD",123.5,123.555,.01,0)
ADMINISTRATIVE USERS W/O NOTIF^MP200'^VA(200,^0;1^Q
"^DD",123.5,123.555,.01,1,0)
^.1
"^DD",123.5,123.555,.01,1,1,0)
123.555^B
"^DD",123.5,123.555,.01,1,1,1)
S ^GMR(123.5,DA(1),123.33,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.555,.01,1,1,2)
K ^GMR(123.5,DA(1),123.33,"B",$E(X,1,30),DA)
"^DD",123.5,123.555,.01,3)
Enter the administrative users name.
"^DD",123.5,123.555,.01,21,0)
^^3^3^2980421^
"^DD",123.5,123.555,.01,21,1,0)
This multiple allows the administrative users for a service to be
"^DD",123.5,123.555,.01,21,2,0)
identified.  Administrative users update actions may be different from the
"^DD",123.5,123.555,.01,21,3,0)
service update users' actions.
"^DD",123.5,123.555,.01,"DT")
2980421
"^DD",123.5,123.56,0)
RELATED HOSPITAL LOCATION SUB-FIELD^^.01^1
"^DD",123.5,123.56,0,"DT")
2910530
"^DD",123.5,123.56,0,"IX","B",123.56,.01)

"^DD",123.5,123.56,0,"NM","RELATED HOSPITAL LOCATION")

"^DD",123.5,123.56,0,"UP")
123.5
"^DD",123.5,123.56,.01,0)
RELATED HOSPITAL LOCATION^MP44'^SC(^0;1^Q
"^DD",123.5,123.56,.01,1,0)
^.1
"^DD",123.5,123.56,.01,1,1,0)
123.56^B
"^DD",123.5,123.56,.01,1,1,1)
S ^GMR(123.5,DA(1),123.4,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.56,.01,1,1,2)
K ^GMR(123.5,DA(1),123.4,"B",$E(X,1,30),DA)
"^DD",123.5,123.56,.01,"DT")
2910821
"^DIC",123,123,0)
REQUEST/CONSULTATION^123D
"^DIC",123,123,0,"GL")
^GMR(123,
"^DIC",123,123,"%",0)
^1.005^1^1
"^DIC",123,123,"%",1,0)
GMRC
"^DIC",123,123,"%","B","GMRC",1)

"^DIC",123,123,"%D",0)
^^7^7^2921119^^^^
"^DIC",123,123,"%D",1,0)
This file contains consult and request orders originating primarily via
"^DIC",123,123,"%D",2,0)
the OE/RR ordering process.  Once the order exists in this file,
"^DIC",123,123,"%D",3,0)
receiving service users perform update tracking activities.  An audit
"^DIC",123,123,"%D",4,0)
trail of the update tracking activities is maintained in this file.
"^DIC",123,123,"%D",5,0)
  
"^DIC",123,123,"%D",6,0)
The only associating of results to a consult or request, for this 
"^DIC",123,123,"%D",7,0)
version, is based on Medicine Package procedure results.
"^DIC",123,"B","REQUEST/CONSULTATION",123)

"^DIC",123.1,123.1,0)
REQUEST ACTION TYPES^123.1
"^DIC",123.1,123.1,0,"GL")
^GMR(123.1,
"^DIC",123.1,123.1,"%D",0)
^^6^6^2921119^^^^
"^DIC",123.1,123.1,"%D",1,0)
This file identifies the action types which may be used by a service to 
"^DIC",123.1,123.1,"%D",2,0)
track activity related to a consult or request.
"^DIC",123.1,123.1,"%D",3,0)
  
"^DIC",123.1,123.1,"%D",4,0)
Certain action types may have a "GMRCACT " protocol entry in the Protocol
"^DIC",123.1,123.1,"%D",5,0)
File (101) which corresponds to the action type.  Two actions should not 
"^DIC",123.1,123.1,"%D",6,0)
point to the same protocol.
"^DIC",123.1,"B","REQUEST ACTION TYPES",123.1)

"^DIC",123.5,123.5,0)
REQUEST SERVICES^123.5
"^DIC",123.5,123.5,0,"GL")
^GMR(123.5,
"^DIC",123.5,123.5,"%D",0)
^^11^11^2980521^^^^
"^DIC",123.5,123.5,"%D",1,0)
This file allows services and specialties to be grouped in a hierarchy 
"^DIC",123.5,123.5,"%D",2,0)
representing the sites services available.  This grouping capability
"^DIC",123.5,123.5,"%D",3,0)
may be used with Review screens to filter out consults to a 
"^DIC",123.5,123.5,"%D",4,0)
service, sub-service, specialty, or sub-specialty of consults/requests.
"^DIC",123.5,123.5,"%D",5,0)
  
"^DIC",123.5,123.5,"%D",6,0)
The main entry in this file is the "ALL SERVICES" entry.  Other entries
"^DIC",123.5,123.5,"%D",7,0)
should be subordinate in its hierarchy.
"^DIC",123.5,123.5,"%D",8,0)
 
"^DIC",123.5,123.5,"%D",9,0)
The "ALL SERVICES" entry is used to display the hierarchy of the hospital
"^DIC",123.5,123.5,"%D",10,0)
services when the Clinician ordering a consult is prompted for
"^DIC",123.5,123.5,"%D",11,0)
"Select TO Service/Specialty:" to send the consult to.
"^DIC",123.5,"B","REQUEST SERVICES",123.5)

**END**
**END**
