Released TIU*1*150 SEQ #142
Extracted from mail message
**KIDS**:TIU*1.0*150^

**INSTALL NAME**
TIU*1.0*150
"BLD",3949,0)
TIU*1.0*150^TEXT INTEGRATION UTILITIES^0^3030329^y
"BLD",3949,1,0)
^^2^2^3030109^^
"BLD",3949,1,1,0)
The description of this build is found in the National Patch Module under
"BLD",3949,1,2,0)
patch TIU*1*150.
"BLD",3949,4,0)
^9.64PA^^
"BLD",3949,"KRN",0)
^9.67PA^8989.52^19
"BLD",3949,"KRN",.4,0)
.4
"BLD",3949,"KRN",.401,0)
.401
"BLD",3949,"KRN",.402,0)
.402
"BLD",3949,"KRN",.403,0)
.403
"BLD",3949,"KRN",.5,0)
.5
"BLD",3949,"KRN",.84,0)
.84
"BLD",3949,"KRN",3.6,0)
3.6
"BLD",3949,"KRN",3.8,0)
3.8
"BLD",3949,"KRN",9.2,0)
9.2
"BLD",3949,"KRN",9.8,0)
9.8
"BLD",3949,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",3949,"KRN",9.8,"NM",1,0)
TIUQRY^^0^B26805200
"BLD",3949,"KRN",9.8,"NM",2,0)
TIUQRYL^^0^B7381149
"BLD",3949,"KRN",9.8,"NM","B","TIUQRY",1)

"BLD",3949,"KRN",9.8,"NM","B","TIUQRYL",2)

"BLD",3949,"KRN",19,0)
19
"BLD",3949,"KRN",19.1,0)
19.1
"BLD",3949,"KRN",101,0)
101
"BLD",3949,"KRN",409.61,0)
409.61
"BLD",3949,"KRN",771,0)
771
"BLD",3949,"KRN",870,0)
870
"BLD",3949,"KRN",8989.51,0)
8989.51
"BLD",3949,"KRN",8989.52,0)
8989.52
"BLD",3949,"KRN",8994,0)
8994
"BLD",3949,"KRN","B",.4,.4)

"BLD",3949,"KRN","B",.401,.401)

"BLD",3949,"KRN","B",.402,.402)

"BLD",3949,"KRN","B",.403,.403)

"BLD",3949,"KRN","B",.5,.5)

"BLD",3949,"KRN","B",.84,.84)

"BLD",3949,"KRN","B",3.6,3.6)

"BLD",3949,"KRN","B",3.8,3.8)

"BLD",3949,"KRN","B",9.2,9.2)

"BLD",3949,"KRN","B",9.8,9.8)

"BLD",3949,"KRN","B",19,19)

"BLD",3949,"KRN","B",19.1,19.1)

"BLD",3949,"KRN","B",101,101)

"BLD",3949,"KRN","B",409.61,409.61)

"BLD",3949,"KRN","B",771,771)

"BLD",3949,"KRN","B",870,870)

"BLD",3949,"KRN","B",8989.51,8989.51)

"BLD",3949,"KRN","B",8989.52,8989.52)

"BLD",3949,"KRN","B",8994,8994)

"BLD",3949,"QUES",0)
^9.62^^
"BLD",3949,"REQB",0)
^9.611^1^1
"BLD",3949,"REQB",1,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",3949,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",1)

"MBREQ")
0
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
150^3030329^11
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3030329
"PKG",193,22,1,"PAH",1,1,1,0)
The description of this build is found in the National Patch Module under
"PKG",193,22,1,"PAH",1,1,2,0)
patch TIU*1*150.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","TIUQRY")
0^1^B26805200
"RTN","TIUQRY",1,0)
TIUQRY ; SLC/JER/CAM - Queries for Documents Across Patients ;3/27/03  16:15
"RTN","TIUQRY",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**150**;Jun 20, 1997
"RTN","TIUQRY",3,0)
QUERY(TIUY,QRY,PATIENT) ; Execute Query
"RTN","TIUQRY",4,0)
 N TIUPRM0,TIUPRM1,TIUPRM3,FLAGA,FLAGV S FLAGA=0,FLAGV=0
"RTN","TIUQRY",5,0)
 D SETPARM^TIULE
"RTN","TIUQRY",6,0)
 I '+$G(PATIENT("Patient.DFN")) S @TIUY@(0,"Documents")="0^ Patient not specified" Q
"RTN","TIUQRY",7,0)
 I '$O(QRY("Status",0)) D STATUS(.QRY)
"RTN","TIUQRY",8,0)
 I '$O(QRY("Title",0)),'$O(QRY("Class",0)) S @TIUY@(0,"Documents")="0^ Title or Class not specified" Q
"RTN","TIUQRY",9,0)
 I $O(QRY("Author",0)) S FLAGA=1
"RTN","TIUQRY",10,0)
 I $O(QRY("Location",0)) S FLAGV=1
"RTN","TIUQRY",11,0)
 D CHECKADD(.QRY)
"RTN","TIUQRY",12,0)
 D GATHER(TIUY,.QRY,.PATIENT,FLAGA,FLAGV)
"RTN","TIUQRY",13,0)
 K @TIUY@("INDX")
"RTN","TIUQRY",14,0)
 Q
"RTN","TIUQRY",15,0)
 ;
"RTN","TIUQRY",16,0)
GATHER(TIUY,QRY,PATIENT,FLAGA,FLAGV) ; Find/sort records for the list
"RTN","TIUQRY",17,0)
 N DFN,EARLY,LATE,RANGE,TIUC
"RTN","TIUQRY",18,0)
 S TIUC=0
"RTN","TIUQRY",19,0)
 S RANGE=$O(QRY("Reference",""))
"RTN","TIUQRY",20,0)
 S DFN=+$G(PATIENT("Patient.DFN"))
"RTN","TIUQRY",21,0)
 S EARLY=9999999-$P(RANGE,":")
"RTN","TIUQRY",22,0)
 S LATE=9999999-$P(RANGE,":",2)
"RTN","TIUQRY",23,0)
 I $O(QRY("Title",0)) D
"RTN","TIUQRY",24,0)
 .N GVN S GVN=$NA(^TIU(8925,"APT",DFN))
"RTN","TIUQRY",25,0)
 .N TIUT S TIUT=0
"RTN","TIUQRY",26,0)
 .F  S TIUT=$O(QRY("Title",TIUT)) Q:+TIUT'>0  D
"RTN","TIUQRY",27,0)
 ..N TIUS S TIUS=0
"RTN","TIUQRY",28,0)
 ..F  S TIUS=$O(QRY("Status",TIUS)) Q:+TIUS'>0  D
"RTN","TIUQRY",29,0)
 ...N TIUJ S TIUJ=LATE
"RTN","TIUQRY",30,0)
 ...F  S TIUJ=$O(@GVN@(TIUT,TIUS,TIUJ)) Q:+TIUJ'>0!(+TIUJ>EARLY)  D
"RTN","TIUQRY",31,0)
 ....N TIUDA
"RTN","TIUQRY",32,0)
 ....S TIUDA=0 F  S TIUDA=$O(@GVN@(TIUT,TIUS,TIUJ,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUQRY",33,0)
 .....I FLAGA=0,FLAGV=0 D FOUNDTL(TIUY,TIUDA,.QRY,.PATIENT,.TIUC)
"RTN","TIUQRY",34,0)
 .....I FLAGA=1,FLAGV=0,$$AUTHOR(TIUDA,.QRY) D FOUNDTL(TIUY,TIUDA,.QRY,.PATIENT,.TIUC)
"RTN","TIUQRY",35,0)
 .....I FLAGA=0,FLAGV=1,$$VISIT(TIUDA,.QRY) D FOUNDTL(TIUY,TIUDA,.QRY,.PATIENT,.TIUC)
"RTN","TIUQRY",36,0)
 .....I FLAGA=1,FLAGV=1,$$AUTHOR(TIUDA,.QRY),$$VISIT(TIUDA,.QRY) D FOUNDTL(TIUY,TIUDA,.QRY,.PATIENT,.TIUC)
"RTN","TIUQRY",37,0)
 I $O(QRY("Class",0)) D
"RTN","TIUQRY",38,0)
 .N TIUCC S TIUCC=0
"RTN","TIUQRY",39,0)
 .F  S TIUCC=$O(QRY("Class",TIUCC)) Q:TIUCC'>0  D STATCHK(TIUCC,.QRY,.TIUC,.DFN,.EARLY,.LATE,.FLAGA)
"RTN","TIUQRY",40,0)
 S @TIUY@(0,"Documents")=TIUC
"RTN","TIUQRY",41,0)
 Q
"RTN","TIUQRY",42,0)
 ;
"RTN","TIUQRY",43,0)
ACLSB(TIUCC,QRY,TIUC,DFN,EARLY,LATE,FLAGA) ; Using the ACLSB cross reference for a status of > 5 
"RTN","TIUQRY",44,0)
 N TIUAUTH S TIUAUTH=0
"RTN","TIUQRY",45,0)
 F  S TIUAUTH=$O(^TIU(8925,"ACLSB",TIUCC,TIUAUTH)) Q:(TIUAUTH'>0)  D
"RTN","TIUQRY",46,0)
 .Q:(FLAGA=1)&'$$AUTHDOC(TIUAUTH,.QRY)
"RTN","TIUQRY",47,0)
 .N GVN S GVN=$NA(^TIU(8925,"ACLSB",TIUCC,TIUAUTH,DFN))
"RTN","TIUQRY",48,0)
 .N TIUD S TIUD=LATE
"RTN","TIUQRY",49,0)
 .F  S TIUD=$O(@GVN@(TIUD)) Q:TIUD'>0!(TIUD>EARLY)  D
"RTN","TIUQRY",50,0)
 ..N TIUDA S TIUDA=0
"RTN","TIUQRY",51,0)
 ..F  S TIUDA=$O(@GVN@(TIUD,TIUDA)) Q:TIUDA'>0  D
"RTN","TIUQRY",52,0)
 ...I FLAGV=0,$$STAT(TIUDA,.QRY) D FOUNDDC(TIUY,TIUDA,.QRY,.PATIENT,.TIUC)
"RTN","TIUQRY",53,0)
 ...I FLAGV=1,$$VISIT(TIUDA,.QRY),$$STAT(TIUDA,.QRY) D FOUNDDC(TIUY,TIUDA,.QRY,.PATIENT,.TIUC)
"RTN","TIUQRY",54,0)
 Q
"RTN","TIUQRY",55,0)
 ;
"RTN","TIUQRY",56,0)
ACLAU(TIUCC,QRY,TIUC,DFN,EARLY,LATE,FLAGA) ; Using the ACLAU cross reference for a status of < 6
"RTN","TIUQRY",57,0)
 N TIUAUTH S TIUAUTH=0
"RTN","TIUQRY",58,0)
 F  S TIUAUTH=$O(^TIU(8925,"ACLAU",TIUCC,TIUAUTH)) Q:(TIUAUTH'>0)  D
"RTN","TIUQRY",59,0)
 .Q:(FLAGA=1)&'$$AUTHDOC(TIUAUTH,.QRY)
"RTN","TIUQRY",60,0)
 .N GVN S GVN=$NA(^TIU(8925,"ACLAU",TIUCC,TIUAUTH,DFN))
"RTN","TIUQRY",61,0)
 .N TIUD S TIUD=LATE
"RTN","TIUQRY",62,0)
 .F  S TIUD=$O(@GVN@(TIUD)) Q:TIUD'>0!(TIUD>EARLY)  D
"RTN","TIUQRY",63,0)
 ..N TIUDA S TIUDA=0
"RTN","TIUQRY",64,0)
 ..F  S TIUDA=$O(@GVN@(TIUD,TIUDA)) Q:TIUDA'>0  D
"RTN","TIUQRY",65,0)
 ...I FLAGV=0,$$STAT(TIUDA,.QRY) D FOUNDDC(TIUY,TIUDA,.QRY,.PATIENT,.TIUC)
"RTN","TIUQRY",66,0)
 ...I FLAGV=1,$$VISIT(TIUDA,.QRY),$$STAT(TIUDA,.QRY) D FOUNDDC(TIUY,TIUDA,.QRY,.PATIENT,.TIUC)
"RTN","TIUQRY",67,0)
 Q
"RTN","TIUQRY",68,0)
 ;
"RTN","TIUQRY",69,0)
STATCHK(TIUCC,QRY,TIUC,DFN,EARLY,LATE,FLAGA) ; Check status(es) entered by user. Cross ref used depends on status of doc.
"RTN","TIUQRY",70,0)
 N TIUS S TIUS=0
"RTN","TIUQRY",71,0)
 F  S TIUS=$O(QRY("Status",TIUS)) Q:TIUS'>0  D
"RTN","TIUQRY",72,0)
 .I TIUS>5 D ACLSB(TIUCC,.QRY,.TIUC,.DFN,.EARLY,.LATE,.FLAGA)
"RTN","TIUQRY",73,0)
 .I TIUS<6 D ACLAU(TIUCC,.QRY,.TIUC,.DFN,.EARLY,.LATE,.FLAGA)
"RTN","TIUQRY",74,0)
 Q
"RTN","TIUQRY",75,0)
 ;
"RTN","TIUQRY",76,0)
FOUNDTL(TIUY,TIUDA,QRY,PATIENT,TIUC) ;Sort by title, resolves document found
"RTN","TIUQRY",77,0)
 I TIUT=81,'$$DADINTYP(TIUDA,.QRY) Q
"RTN","TIUQRY",78,0)
 D RESOLVE^TIUQRYL(TIUY,TIUDA,.QRY,.PATIENT)
"RTN","TIUQRY",79,0)
 S @TIUY@("INDX",TIUDA)="",TIUC=TIUC+1
"RTN","TIUQRY",80,0)
 Q
"RTN","TIUQRY",81,0)
 ;
"RTN","TIUQRY",82,0)
FOUNDDC(TIUY,TIUDA,QRY,PATIENT,TIUC) ;Sort by document, resolves document found
"RTN","TIUQRY",83,0)
 I $D(@TIUY@("INDX",TIUDA)) Q  ; Don't set up if already exists
"RTN","TIUQRY",84,0)
 D RESOLVE^TIUQRYL(TIUY,TIUDA,.QRY,.PATIENT)
"RTN","TIUQRY",85,0)
 S @TIUY@("INDX",TIUDA)="",TIUC=TIUC+1
"RTN","TIUQRY",86,0)
 Q
"RTN","TIUQRY",87,0)
 ;
"RTN","TIUQRY",88,0)
STAT(TIUDA1,QRY) ; Determines status of document then checks to see if
"RTN","TIUQRY",89,0)
 ; status is included in the status list selected for query.
"RTN","TIUQRY",90,0)
 ; TIUS=Status of document
"RTN","TIUQRY",91,0)
 N TIUS1,CHECK,TIUS S TIUS1=0,CHECK="",TIUS=0
"RTN","TIUQRY",92,0)
 ; CHECK returned as 1 if the status was selected in query.
"RTN","TIUQRY",93,0)
 S TIUS1=$P($G(^TIU(8925,TIUDA1,0)),U,5)
"RTN","TIUQRY",94,0)
 F  S TIUS=$O(QRY("Status",TIUS)) Q:TIUS'>0  I TIUS=TIUS1 S CHECK=1
"RTN","TIUQRY",95,0)
 Q CHECK
"RTN","TIUQRY",96,0)
 ;
"RTN","TIUQRY",97,0)
AUTHDOC(TIUAUTH1,QRY) ; Checks to see if the author of the note being evaluated is
"RTN","TIUQRY",98,0)
 ; included in the author list selected for query.
"RTN","TIUQRY",99,0)
 N CHECK,TIUAUTH2
"RTN","TIUQRY",100,0)
 ; CHECK returned as 1 if the author was selected in query.
"RTN","TIUQRY",101,0)
 S CHECK="",TIUAUTH2=0
"RTN","TIUQRY",102,0)
 F  S TIUAUTH2=$O(QRY("Author",TIUAUTH2)) Q:TIUAUTH2'>0!+CHECK  I TIUAUTH2=TIUAUTH1 S CHECK=1
"RTN","TIUQRY",103,0)
 Q CHECK
"RTN","TIUQRY",104,0)
 ;
"RTN","TIUQRY",105,0)
AUTHOR(TIUDA1,QRY) ; Determines author of document then checks to see if author
"RTN","TIUQRY",106,0)
 ; is included in the author list selected for query.
"RTN","TIUQRY",107,0)
 N TIUAUTH,TIUAUTH1,CHECK S TIUAUTH=0,TIUAUTH1=0,CHECK=""
"RTN","TIUQRY",108,0)
 S TIUAUTH1=$P($G(^TIU(8925,TIUDA1,12)),U,2)
"RTN","TIUQRY",109,0)
 F  S TIUAUTH=$O(QRY("Author",TIUAUTH)) Q:TIUAUTH'>0!+CHECK  I TIUAUTH=TIUAUTH1 S CHECK=1
"RTN","TIUQRY",110,0)
 Q CHECK
"RTN","TIUQRY",111,0)
 ;
"RTN","TIUQRY",112,0)
VISIT(TIUDA1,QRY) ; Checks location of visit then checks to see if location is included
"RTN","TIUQRY",113,0)
 ; in the location list selected for query.
"RTN","TIUQRY",114,0)
 N TIUVST,TIUVST1,CHECK S TIUVST=0,TIUVST1=0,CHECK=0
"RTN","TIUQRY",115,0)
 S TIUVST1=$P($G(^TIU(8925,TIUDA1,12)),U,5)
"RTN","TIUQRY",116,0)
 F  S TIUVST=$O(QRY("Location",TIUVST)) Q:TIUVST'>0!+CHECK  I TIUVST=TIUVST1 S CHECK=1
"RTN","TIUQRY",117,0)
 Q CHECK
"RTN","TIUQRY",118,0)
 ;
"RTN","TIUQRY",119,0)
DADINTYP(TIUDA,QRY) ; Evaluates whether addendum's parent belongs is among
"RTN","TIUQRY",120,0)
 ;                 the selected types
"RTN","TIUQRY",121,0)
 N TIUI,TIUDTYP,TIUY S (TIUI,TIUY)=0
"RTN","TIUQRY",122,0)
 S TIUDTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIUQRY",123,0)
 F  S TIUI=$O(QRY("Title",TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIUQRY",124,0)
 . S:TIUI=TIUDTYP TIUY=1
"RTN","TIUQRY",125,0)
 Q TIUY
"RTN","TIUQRY",126,0)
 ;
"RTN","TIUQRY",127,0)
CHECKADD(QRY) ; Assures that Addendum is included in the list of types
"RTN","TIUQRY",128,0)
 S QRY("Title",81)=""
"RTN","TIUQRY",129,0)
 Q
"RTN","TIUQRY",130,0)
 ;
"RTN","TIUQRY",131,0)
STATUS(QRY) ; Gets status(es)
"RTN","TIUQRY",132,0)
 N TIUI,TIUS,STATUS S (TIUI,TIUS)=0
"RTN","TIUQRY",133,0)
 S STATUS=""
"RTN","TIUQRY",134,0)
 F  S STATUS=$O(^TIU(8925.6,"B",STATUS)) Q:STATUS=""  D
"RTN","TIUQRY",135,0)
 .S TIUS=0
"RTN","TIUQRY",136,0)
 .F  S TIUS=$O(^TIU(8925.6,"B",STATUS,TIUS)) Q:+TIUS'>0  D
"RTN","TIUQRY",137,0)
 ..S:($P(^TIU(8925.6,+TIUS,0),U,4)'="DEF") QRY("Status",TIUS)=""
"RTN","TIUQRY",138,0)
 Q
"RTN","TIUQRYL")
0^2^B7381149
"RTN","TIUQRYL",1,0)
TIUQRYL ; SLC/JER - Library calls for Query ;11-OCT-2002 16:56
"RTN","TIUQRYL",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**150**;Jun 20, 1997
"RTN","TIUQRYL",3,0)
RESOLVE(TIUY,DA,QRY,PATIENT) ; Resolve to external data
"RTN","TIUQRYL",4,0)
 N TIUR0,TIUR12,TIUR13,TIUR14,TIUR17,TIUR150
"RTN","TIUQRYL",5,0)
 N IDPARENT,DOC
"RTN","TIUQRYL",6,0)
 S TIUR0=$G(^TIU(8925,+DA,0)),TIUR12=$G(^TIU(8925,+DA,12))
"RTN","TIUQRYL",7,0)
 S TIUR13=$G(^TIU(8925,+DA,13)),TIUR14=$G(^(14)),TIUR17=$G(^(17))
"RTN","TIUQRYL",8,0)
 S TIUR150=$G(^TIU(8925,+DA,150))
"RTN","TIUQRYL",9,0)
 S IDPARENT=+$G(^TIU(8925,+DA,21))
"RTN","TIUQRYL",10,0)
 M @TIUY@("DOC:"_DA)=PATIENT
"RTN","TIUQRYL",11,0)
 S (DOC,@TIUY@("DOC:"_DA,"Document.Title"))=$$PNAME^TIULC1(+TIUR0)
"RTN","TIUQRYL",12,0)
 S:DOC="Addendum" @TIUY@("DOC:"_DA,"Document.Title")=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUR0,U,6),0)))
"RTN","TIUQRYL",13,0)
 ; ** If prefix becomes an issue, remove comments and finish implementation **
"RTN","TIUQRYL",14,0)
 ; If IDNotes (TIU*1.0*100) installed, use $$PREFIX^TIULA2 to evaluate
"RTN","TIUQRYL",15,0)
 ; which prefix to use:
"RTN","TIUQRYL",16,0)
 ; - keep prefix display in earlier CPRS versions and LM
"RTN","TIUQRYL",17,0)
 ; - omit in newer TreeView versions
"RTN","TIUQRYL",18,0)
 ;I $L($T(PREFIX^TIULA2)) D  I 1
"RTN","TIUQRYL",19,0)
 ;. S PREFIX=$$PREFIX^TIULA2(DA,1)  ; 1=include ID Child indicator
"RTN","TIUQRYL",20,0)
 ;. I PREFIX["<" S IDSORT=$$IDSORT^TIUSRVLO(DA)
"RTN","TIUQRYL",21,0)
 ;. I +$G(SHOWADD)=0 S DOC=PREFIX_DOC
"RTN","TIUQRYL",22,0)
 ; otherwise, only show addendum indicator (+)
"RTN","TIUQRYL",23,0)
 ; - keep prefix display in earlier CPRS versions and LM
"RTN","TIUQRYL",24,0)
 ; - omit in newer TreeView versions
"RTN","TIUQRYL",25,0)
 ;E  D
"RTN","TIUQRYL",26,0)
 ;. I +$$HASADDEN^TIULC1(DA) S PREFIX="+ "
"RTN","TIUQRYL",27,0)
 ;. I +$G(SHOWADD)=0,(+$$HASADDEN^TIULC1(DA)) S DOC=PREFIX_DOC
"RTN","TIUQRYL",28,0)
 ;I +$$URGENCY^TIURM(+DA)=1 S DOC=$S(DOC["+":"*",1:"* ")_DOC
"RTN","TIUQRYL",29,0)
 ; **
"RTN","TIUQRYL",30,0)
 S @TIUY@("DOC:"_DA,"Document.Reference")=+TIUR13
"RTN","TIUQRYL",31,0)
 S @TIUY@("DOC:"_DA,"Document.Status")=$$LOWER^TIULS($P($G(^TIU(8925.6,+$P(TIUR0,U,5),0)),U))
"RTN","TIUQRYL",32,0)
 S @TIUY@("DOC:"_DA,"Document.Author")=$S(+$P(TIUR12,U,2):$$PERSNAME^TIULC1($P(TIUR12,U,2)),1:"")
"RTN","TIUQRYL",33,0)
 S @TIUY@("DOC:"_DA,"Document.Cosigner")=$S(+$P(TIUR12,U,8):$$PERSNAME^TIULC1($P(TIUR12,U,8)),1:"")
"RTN","TIUQRYL",34,0)
 Q
"RTN","TIUQRYL",35,0)
 ;
"RTN","TIUQRYL",36,0)
SETDAD(TIUY,DA,QRY,PATIENT) ; Set parent in return array
"RTN","TIUQRYL",37,0)
 N DADA,TIUD0,TIUD21
"RTN","TIUQRYL",38,0)
 ; Exclude components
"RTN","TIUQRYL",39,0)
 Q:'+$$ISDOC(DA)
"RTN","TIUQRYL",40,0)
 S TIUD0=$G(^TIU(8925,DA,0)),TIUD21=$G(^(21))
"RTN","TIUQRYL",41,0)
 S DADA=$S(+$P(TIUD0,U,6):+$P(TIUD0,U,6),+TIUD21:+TIUD21,1:0)
"RTN","TIUQRYL",42,0)
 Q:+DADA'>0
"RTN","TIUQRYL",43,0)
 Q:+$D(@TIUY@("INDX",DADA))
"RTN","TIUQRYL",44,0)
 Q:+$D(^TIU(8925,DADA,0))=0
"RTN","TIUQRYL",45,0)
 D RESOLVE(TIUY,DADA,.QRY,.PATIENT)
"RTN","TIUQRYL",46,0)
 S @TIUY@("INDX",DADA)=""
"RTN","TIUQRYL",47,0)
 I +$G(SHOWADD) D SETKIDS(TIUY,DADA,.QRY,.PATIENT)
"RTN","TIUQRYL",48,0)
 I +$$HASDAD^TIUSRVLI(DADA) D SETDAD(TIUY,DADA,.QRY,.PATIENT)
"RTN","TIUQRYL",49,0)
 Q
"RTN","TIUQRYL",50,0)
 ;
"RTN","TIUQRYL",51,0)
SETKIDS(TIUY,DA,QRY,PATIENT) ; Set children in return array
"RTN","TIUQRYL",52,0)
 N KIDA S KIDA=0
"RTN","TIUQRYL",53,0)
 ; Begin with addenda
"RTN","TIUQRYL",54,0)
 F  S KIDA=$O(^TIU(8925,"DAD",DA,KIDA)) Q:+KIDA'>0  D
"RTN","TIUQRYL",55,0)
 . Q:'+$$ISDOC(KIDA)
"RTN","TIUQRYL",56,0)
 . Q:+$D(@TIUY@("INDX",KIDA))
"RTN","TIUQRYL",57,0)
 . D RESOLVE(TIUY,KIDA,.QRY,.PATIENT)
"RTN","TIUQRYL",58,0)
 . S @TIUY@("INDX",KIDA)=""
"RTN","TIUQRYL",59,0)
 ; Next do ID entries
"RTN","TIUQRYL",60,0)
 S KIDA=0
"RTN","TIUQRYL",61,0)
 F  S KIDA=$O(^TIU(8925,"GDAD",DA,KIDA)) Q:+KIDA'>0  D
"RTN","TIUQRYL",62,0)
 . Q:+$D(@TIUY@("INDX",KIDA))
"RTN","TIUQRYL",63,0)
 . D RESOLVE(TIUY,KIDA,.QRY,.PATIENT)
"RTN","TIUQRYL",64,0)
 . S @TIUY@("INDX",KIDA)=""
"RTN","TIUQRYL",65,0)
 . I +$$HASKIDS^TIUSRVLI(KIDA) D SETKIDS(TIUY,KIDA,.QRY,.PATIENT)
"RTN","TIUQRYL",66,0)
 Q
"RTN","TIUQRYL",67,0)
ISDOC(DA) ; Evaluate whether a given record is a document
"RTN","TIUQRYL",68,0)
 N TIUY,TIUTYP
"RTN","TIUQRYL",69,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUQRYL",70,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="DOC":1,1:0)
"RTN","TIUQRYL",71,0)
 Q TIUY
"VER")
8.0^22.0
**END**
**END**
