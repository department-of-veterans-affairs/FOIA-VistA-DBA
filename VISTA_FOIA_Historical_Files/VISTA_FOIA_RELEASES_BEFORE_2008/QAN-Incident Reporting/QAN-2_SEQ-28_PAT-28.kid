Released QAN*2*28 SEQ #28
Extracted from mail message
**KIDS**:QAN*2.0*28^

**INSTALL NAME**
QAN*2.0*28
"BLD",2213,0)
QAN*2.0*28^INCIDENT REPORTING^0^3000118^y
"BLD",2213,4,0)
^9.64PA^^
"BLD",2213,"ABNS",0)
^9.66A^^
"BLD",2213,"ABPKG")
n^n
"BLD",2213,"KRN",0)
^9.67PA^19^18
"BLD",2213,"KRN",.4,0)
.4
"BLD",2213,"KRN",.4,"NM",0)
^9.68A^^
"BLD",2213,"KRN",.401,0)
.401
"BLD",2213,"KRN",.402,0)
.402
"BLD",2213,"KRN",.403,0)
.403
"BLD",2213,"KRN",.5,0)
.5
"BLD",2213,"KRN",.84,0)
.84
"BLD",2213,"KRN",3.6,0)
3.6
"BLD",2213,"KRN",3.8,0)
3.8
"BLD",2213,"KRN",9.2,0)
9.2
"BLD",2213,"KRN",9.8,0)
9.8
"BLD",2213,"KRN",9.8,"NM",0)
^9.68A^7^6
"BLD",2213,"KRN",9.8,"NM",1,0)
QANBENE0^^0^B25881552
"BLD",2213,"KRN",9.8,"NM",2,0)
QANBENE1^^0^B19569999
"BLD",2213,"KRN",9.8,"NM",3,0)
QANBENE2^^0^B27405253
"BLD",2213,"KRN",9.8,"NM",5,0)
QANCDNT^^0^B64771493
"BLD",2213,"KRN",9.8,"NM",6,0)
QANBENE^^0^B12892483
"BLD",2213,"KRN",9.8,"NM",7,0)
QANQUCK^^0^B18599562
"BLD",2213,"KRN",9.8,"NM","B","QANBENE",6)

"BLD",2213,"KRN",9.8,"NM","B","QANBENE0",1)

"BLD",2213,"KRN",9.8,"NM","B","QANBENE1",2)

"BLD",2213,"KRN",9.8,"NM","B","QANBENE2",3)

"BLD",2213,"KRN",9.8,"NM","B","QANCDNT",5)

"BLD",2213,"KRN",9.8,"NM","B","QANQUCK",7)

"BLD",2213,"KRN",19,0)
19
"BLD",2213,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",2213,"KRN",19,"NM",1,0)
QAN INCIDENT REPORT^^0
"BLD",2213,"KRN",19,"NM","B","QAN INCIDENT REPORT",1)

"BLD",2213,"KRN",19.1,0)
19.1
"BLD",2213,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",2213,"KRN",101,0)
101
"BLD",2213,"KRN",409.61,0)
409.61
"BLD",2213,"KRN",771,0)
771
"BLD",2213,"KRN",869.2,0)
869.2
"BLD",2213,"KRN",870,0)
870
"BLD",2213,"KRN",8994,0)
8994
"BLD",2213,"KRN","B",.4,.4)

"BLD",2213,"KRN","B",.401,.401)

"BLD",2213,"KRN","B",.402,.402)

"BLD",2213,"KRN","B",.403,.403)

"BLD",2213,"KRN","B",.5,.5)

"BLD",2213,"KRN","B",.84,.84)

"BLD",2213,"KRN","B",3.6,3.6)

"BLD",2213,"KRN","B",3.8,3.8)

"BLD",2213,"KRN","B",9.2,9.2)

"BLD",2213,"KRN","B",9.8,9.8)

"BLD",2213,"KRN","B",19,19)

"BLD",2213,"KRN","B",19.1,19.1)

"BLD",2213,"KRN","B",101,101)

"BLD",2213,"KRN","B",409.61,409.61)

"BLD",2213,"KRN","B",771,771)

"BLD",2213,"KRN","B",869.2,869.2)

"BLD",2213,"KRN","B",870,870)

"BLD",2213,"KRN","B",8994,8994)

"BLD",2213,"QUES",0)
^9.62^^
"BLD",2213,"REQB",0)
^9.611^2^2
"BLD",2213,"REQB",1,0)
QAN*2.0*26^1
"BLD",2213,"REQB",2,0)
DG*5.3*170^1
"BLD",2213,"REQB","B","DG*5.3*170",2)

"BLD",2213,"REQB","B","QAN*2.0*26",1)

"KRN",19,5262,-1)
0^1
"KRN",19,5262,0)
QAN INCIDENT REPORT^Brief Incident Enter/Edit^^R^^^^^^^^INCIDENT REPORTING^^1^1
"KRN",19,5262,1,0)
^^2^2^2911101^^^^
"KRN",19,5262,1,1,0)
This option allows the input of data for the sighting of an original 
"KRN",19,5262,1,2,0)
incident at the time of the incident.
"KRN",19,5262,15)
D CLEAN^QANVAL
"KRN",19,5262,20)
D CLEAN^QANVAL
"KRN",19,5262,25)
QANCDNT
"KRN",19,5262,"U")
BRIEF INCIDENT ENTER/EDIT
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",371,-1)
1^1
"PKG",371,0)
INCIDENT REPORTING^QAN^This package is designed to track a hospital incident.
"PKG",371,20,0)
^9.402P^^
"PKG",371,22,0)
^9.49I^1^1
"PKG",371,22,1,0)
2.0^2921015^2950914
"PKG",371,22,1,"PAH",1,0)
28^3000118
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","QANBENE")
0^6^B12892483
"RTN","QANBENE",1,0)
QANBENE ;HISC/GJC-Special incidents invol. a beneficiary ;3/3/92 [ 09/15/95  7:51 AM ]
"RTN","QANBENE",2,0)
 ;;2.0;Incident Reporting;**1,18,23,26,28**;08/07/1992
"RTN","QANBENE",3,0)
 ;
"RTN","QANBENE",4,0)
 D KILL^QANBENE0,^QAQDATE I QAQQUIT D K^QAQDATE W !!,$C(7),"Invalid date range, no report will be produced." Q
"RTN","QANBENE",5,0)
 S (PAGE,QANCONT,QANQUIT)=0
"RTN","QANBENE",6,0)
 S Y=QAQNBEG D DD^%DT S QANDATE(0)=Y
"RTN","QANBENE",7,0)
 S Y=QAQNEND D DD^%DT S QANDATE(1)=Y
"RTN","QANBENE",8,0)
 S QANLWLT=QAQNBEG-.0000001,QANUPLT=QAQNEND_".9999999"
"RTN","QANBENE",9,0)
 D DIV^QANRPT1
"RTN","QANBENE",10,0)
 S QANSITE(0)=$S($G(^QA(740,1,0))]"":$P(^(0),U),1:"")
"RTN","QANBENE",11,0)
 I QANSITE(0)']"" W !!,$C(7),"Site Parameters file incomplete, contact your site manager." D KILL^QANBENE0 Q
"RTN","QANBENE",12,0)
 S QANSITE=$$PRIM^VASITE(DT),QANSITE=$$SITE^VASITE(DT,QANSITE)
"RTN","QANBENE",13,0)
 S QANSITE(1)=$P(QANSITE,U,3)
"RTN","QANBENE",14,0)
 S QANSITE=$P(QANSITE,U,2)
"RTN","QANBENE",15,0)
 I $G(QANDVFLG)=1 S QANSITE=$$NAME^VASITE(DT)
"RTN","QANBENE",16,0)
 S QANHEAD(0)="Summary of Incidents Involving Patients (RCS 10-0073)"
"RTN","QANBENE",17,0)
 S QANHEAD(1)="For the period "_QANDATE(0)_" to "_QANDATE(1)
"RTN","QANBENE",18,0)
 S QANHEAD(2)="Site Name: "_QANSITE_"          FTS#:____________________"
"RTN","QANBENE",19,0)
 ;/*** SET UP TABS ***/
"RTN","QANBENE",20,0)
 S QANTAB(1)=$J(((5/80)*IOM),2,0),QANTAB(2)=$J(((10/80)*IOM),2,0),QANTAB(3)=$J(((25/80)*IOM),2,0),QANTAB(4)=$J(((27/80)*IOM),2,0),QANTAB(5)=$J(((45/80)*IOM),2,0),QANTAB(6)=$J(((55/80)*IOM),2,0)
"RTN","QANBENE",21,0)
 ;/*** SET UP TABS ***/
"RTN","QANBENE",22,0)
 ;D DIV^QANRPT1
"RTN","QANBENE",23,0)
 K DIR S DIR(0)="FAO^1:1^K:""BCO""'[X X",DIR("A")="Select Incident Status (B/C/O): ",DIR("?")="Enter ""O"" to select open cases, ""C"" for closed cases, or ""B"" for both open and closed cases" D ^DIR K DIR
"RTN","QANBENE",24,0)
 I $D(DIRUT) D KILL^QANBENE0 Q
"RTN","QANBENE",25,0)
 S QANFLG("IR STAT")=$S("B"[Y:"013","C"[Y:"0",1:"13") ;set IR Status flag
"RTN","QANBENE",26,0)
EN2 ;Call to ^QANBENE0
"RTN","QANBENE",27,0)
 D EN1^QANBENE0
"RTN","QANBENE",28,0)
 Q
"RTN","QANBENE",29,0)
VALID ;Validate as a reportable incident.
"RTN","QANBENE",30,0)
 S QANSWCH=0
"RTN","QANBENE",31,0)
 I $D(^QA(742.1,"BUPPER","PATIENT ABUSE",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",32,0)
 I $D(^QA(742.1,"BUPPER","DEATH",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",33,0)
 I $D(^QA(742.1,"BUPPER","INFORMED CONSENT-FAIL. TO OBTAIN",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",34,0)
 I $D(^QA(742.1,"BUPPER","FALL",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",35,0)
 I $D(^QA(742.1,"BUPPER","HOMICIDE",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",36,0)
 I $D(^QA(742.1,"BUPPER","MEDICATION ERROR",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",37,0)
 I $D(^QA(742.1,"BUPPER","MISSING PATIENT",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",38,0)
 I $D(^QA(742.1,"BUPPER","ASSAULT-PATIENT TO PATIENT",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",39,0)
 I $D(^QA(742.1,"BUPPER","INFORMED CONSENT, FAIL. TO OBTAIN",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",40,0)
 I $D(^QA(742.1,"BUPPER","ASSAULT-PATIENT/STAFF",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",41,0)
 I $D(^QA(742.1,"BUPPER","ASSAULT, PATIENT TO PATIENT",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",42,0)
 I $D(^QA(742.1,"BUPPER","ASSAULT, PATIENT/STAFF",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",43,0)
 I $D(^QA(742.1,"BUPPER","FIRE, PATIENT INVOLVED IN",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",44,0)
 I $D(^QA(742.1,"BUPPER","INJURY NOT OTHERWISE LISTED",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",45,0)
 I $D(^QA(742.1,"BUPPER","FIRE-PATIENT INVOLVED IN",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",46,0)
 I $D(^QA(742.1,"BUPPER","SEXUAL ASSAULT",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",47,0)
 I $D(^QA(742.1,"BUPPER","SUICIDE ATTEMPT",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",48,0)
 I $D(^QA(742.1,"BUPPER","SUICIDE",QAN("INC"))) S QANSWCH=1 Q
"RTN","QANBENE",49,0)
 I $D(^QA(742.1,"BUPPER","TRANSFUSION ERROR",QAN("INC"))) S QANSWCH=1
"RTN","QANBENE",50,0)
 Q
"RTN","QANBENE0")
0^1^B25881552
"RTN","QANBENE0",1,0)
QANBENE0 ;HISC/GJC-SPECIAL INCIDENTS INVOL. A BENEFICIARY ;4/13/93  08:24
"RTN","QANBENE0",2,0)
 ;;2.0;Incident Reporting;**18,26,28**;08/07/1992
"RTN","QANBENE0",3,0)
 ;
"RTN","QANBENE0",4,0)
EN1 ;/*** Catagorize incidents ***/
"RTN","QANBENE0",5,0)
 K DIR S DIR(0)="FAO^1:1^K:""ACDINO""'[X X",DIR("A")="Select Ward type (A/C/D/I/N/O): "
"RTN","QANBENE0",6,0)
 S DIR("?",1)="Enter ""A"" to generate separate reports for Domiciliaries, NHCU'S, "
"RTN","QANBENE0",7,0)
 S DIR("?",2)="Inpatients and Outpatients."
"RTN","QANBENE0",8,0)
 S DIR("?",3)="Enter ""C"" to generate a report of combined data for Domiciliaries, NHCU'S, "
"RTN","QANBENE0",9,0)
 S DIR("?",4)="Inpatients and Outpatients."
"RTN","QANBENE0",10,0)
 S DIR("?",5)="Enter ""D"" for Domiciliary, ""I"" for Inpatients other than Domiciliary or "
"RTN","QANBENE0",11,0)
 S DIR("?")="NHCU, ""N"" for NHCU units, or ""O"" for Outpatients."
"RTN","QANBENE0",12,0)
 D ^DIR K DIR
"RTN","QANBENE0",13,0)
 I $D(DIRUT) D KILL Q
"RTN","QANBENE0",14,0)
 S QANFLG("WARD")=Y
"RTN","QANBENE0",15,0)
TASK ;Call to %ZTLOAD
"RTN","QANBENE0",16,0)
 S Y=DT X ^DD("DD") S TODAY=Y
"RTN","QANBENE0",17,0)
 K IOP,%ZIS S %ZIS("A")="Print on device: ",%ZIS="MQ" W ! D ^%ZIS W !!
"RTN","QANBENE0",18,0)
 G:POP KILL
"RTN","QANBENE0",19,0)
 I $D(IO("Q")) S ZTRTN="START^QANBENE0",ZTDESC="Generate Special Incident Reports For A Beneficiary." D QLOOP,^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!"),! G EXIT
"RTN","QANBENE0",20,0)
START ;IO requests
"RTN","QANBENE0",21,0)
 U IO
"RTN","QANBENE0",22,0)
 I QANFLG("WARD")="A" S QANFLG("WARD A")="D^I^N^O"
"RTN","QANBENE0",23,0)
 I $D(QANFLG("WARD A")),(QANFLG("WARD A")="D^I^N^O") F QAN=1:1:$L(QANFLG("WARD A"),"^") Q:QANQUIT  S QANFLG("WARD")=$P(QANFLG("WARD A"),"^",QAN) Q:QANFLG("WARD")']""  D
"RTN","QANBENE0",24,0)
 . W @IOF
"RTN","QANBENE0",25,0)
 . S PAGE=0
"RTN","QANBENE0",26,0)
 . K ^TMP("QANBEN",$J),QANCOUNT
"RTN","QANBENE0",27,0)
 . D GO D:'QANQUIT HDH^QANBENE3 Q:QANQUIT
"RTN","QANBENE0",28,0)
 G:QANQUIT EXIT
"RTN","QANBENE0",29,0)
 I '$D(QANFLG("WARD A")) D GO
"RTN","QANBENE0",30,0)
EXIT ;
"RTN","QANBENE0",31,0)
 W ! D ^%ZISC,HOME^%ZIS
"RTN","QANBENE0",32,0)
KILL ;Kill and quit.
"RTN","QANBENE0",33,0)
 K %ZIS,D,DIC,DIRUT,I,PAGE,POP
"RTN","QANBENE0",34,0)
 K QAN,QAN742,QAN7424,QANAA,QANAB,QANBB,QANBENE,QANCC,QANCONT
"RTN","QANBENE0",35,0)
 K QANCOUNT,QANDATE,QAN1DIV,QANDIV,QANDTH,QANDV,QANDVFLG
"RTN","QANBENE0",36,0)
 K QANFLG,QANHEAD,QANHLOC,QANINPT,QANLBL,QANLP,QANLWLT
"RTN","QANBENE0",37,0)
 K QANPTTY,QANQUIT,QANSLEV,QANSTAT,QANTAB,QANUPLT,QANWARD
"RTN","QANBENE0",38,0)
 K QANINVST,QANSITE,QANSWCH,QANWHICH
"RTN","QANBENE0",39,0)
 K QAQNBEG,QAQNEND
"RTN","QANBENE0",40,0)
 K TODAY,X,Y,ZTDESC,ZTRTN,ZTSAVE,ZTSK
"RTN","QANBENE0",41,0)
 D K^QAQDATE
"RTN","QANBENE0",42,0)
 K ^TMP("QANBEN",$J)
"RTN","QANBENE0",43,0)
 Q
"RTN","QANBENE0",44,0)
GO ;Set up variables.
"RTN","QANBENE0",45,0)
 S QANLP=QANLWLT
"RTN","QANBENE0",46,0)
 F  S QANLP=$O(^QA(742.4,"BDT",QANLP)) Q:QANLP'>0!(QANLP>QANUPLT)  D
"RTN","QANBENE0",47,0)
 . S QANLP(1)=0
"RTN","QANBENE0",48,0)
 . F  S QANLP(1)=$O(^QA(742.4,"BDT",QANLP,QANLP(1))) Q:QANLP(1)'>0  D
"RTN","QANBENE0",49,0)
 . . I $G(^QA(742.4,QANLP(1),0))]"" D LGIC I QANQUIT S QANQUIT=0 Q
"RTN","QANBENE0",50,0)
 . . S QANLP(2)=0
"RTN","QANBENE0",51,0)
 . . F  S QANLP(2)=$O(^QA(742,"BCS",QANLP(1),QANLP(2))) Q:QANLP(2)'>0  D
"RTN","QANBENE0",52,0)
 . . . I $G(^QA(742,QANLP(2),0)) D LGIC1
"RTN","QANBENE0",53,0)
 . . . I QANQUIT S QANQUIT=0 Q
"RTN","QANBENE0",54,0)
 . . . S ^TMP("QANBEN",$J,"BEN",QANDIV,QANWARD,QANLP(1),QANLP(2))=""
"RTN","QANBENE0",55,0)
 S QANHEAD(3)=$S(QANFLG("WARD")="I":"INPATIENTS",QANFLG("WARD")="D":"DOMICILIARY",QANFLG("WARD")="N":"NHCU",QANFLG("WARD")="O":"OUTPATIENTS",1:"ALL INCIDENTS REGARDLESS OF LOCATION")
"RTN","QANBENE0",56,0)
 I $G(QANDVFLG)'=1 D HDR
"RTN","QANBENE0",57,0)
 D EN1^QANBENE1
"RTN","QANBENE0",58,0)
 Q
"RTN","QANBENE0",59,0)
LGIC ;Set up valid incidents
"RTN","QANBENE0",60,0)
 S QAN7424=^QA(742.4,QANLP(1),0),QAN("INC")=$P(QAN7424,U,2)
"RTN","QANBENE0",61,0)
 Q:QAN("INC")'<200  ;Quit if NOT a National incident.
"RTN","QANBENE0",62,0)
 D VALID^QANBENE I 'QANSWCH S QANQUIT=1 Q  ;Quit if NOT a valid incident
"RTN","QANBENE0",63,0)
 S QANSTAT=+$P(QAN7424,U,8),QANBENE=+$P(QAN7424,U,17)
"RTN","QANBENE0",64,0)
 I 'QANBENE!(QANFLG("IR STAT")'[QANSTAT) S QANQUIT=1 Q
"RTN","QANBENE0",65,0)
 S QANDIV=$P(QAN7424,U,22)
"RTN","QANBENE0",66,0)
 I $G(QANDIV)']"" S QANDIV=0
"RTN","QANBENE0",67,0)
 I $G(QAN1DIV)]"" I QAN1DIV'=QANDIV S QANQUIT=1 Q
"RTN","QANBENE0",68,0)
 I '$D(^QA(740,1,"QAN2","B",QANDIV)) S QANDIV=0
"RTN","QANBENE0",69,0)
 I $G(QANDVFLG)'=1 S QANDIV=0
"RTN","QANBENE0",70,0)
 Q
"RTN","QANBENE0",71,0)
HDR ;Header generator.
"RTN","QANBENE0",72,0)
 S PAGE=PAGE+1 W @IOF,!?69,TODAY,!?69,"Page: ",PAGE,!!
"RTN","QANBENE0",73,0)
 W ?(IOM-$L(QANHEAD(0))\2),QANHEAD(0),!,?(IOM-$L(QANHEAD(1))\2),QANHEAD(1),!
"RTN","QANBENE0",74,0)
 ;For integrated sites this part of the header should display the name
"RTN","QANBENE0",75,0)
 ;of the integration group, i.e. Central Iowa, rather than the name of
"RTN","QANBENE0",76,0)
 ;the primary instiution, i.e. Des Moines.  Will make that change when
"RTN","QANBENE0",77,0)
 ;it's determined where the name of the integrated group is stored.
"RTN","QANBENE0",78,0)
 W !?(IOM-$L(QANHEAD(2))\2),QANHEAD(2),!
"RTN","QANBENE0",79,0)
 W !?(IOM-$L(QANHEAD(3))\2),QANHEAD(3)
"RTN","QANBENE0",80,0)
 I $G(QANDVFLG)=1,($G(QANHEAD(4))]"") W !?(IOM-$L(QANHEAD(4))\2),QANHEAD(4)
"RTN","QANBENE0",81,0)
 W !!?QANTAB(5),"Total",?QANTAB(6),"Resulted in"
"RTN","QANBENE0",82,0)
 W !?QANTAB(2),"Incident",?QANTAB(4),"Severity",?QANTAB(5),"Number",?QANTAB(6),"Investigation",!?QANTAB(2),"--------",?QANTAB(4),"--------",?QANTAB(5),"------",?QANTAB(6),"-------------"
"RTN","QANBENE0",83,0)
 I QANCONT,$D(QANLBL) W !!?QANTAB(2),QANLBL_" (cont)"
"RTN","QANBENE0",84,0)
 Q
"RTN","QANBENE0",85,0)
LGIC1 ;Sorting wards into categories.
"RTN","QANBENE0",86,0)
 Q:$D(^QA(742,"BPRS",-1,QANLP(2)))  ;Quit if a deleted patient
"RTN","QANBENE0",87,0)
 S QAN742=^QA(742,QANLP(2),0)
"RTN","QANBENE0",88,0)
 S QANPTTY=+$P(QAN742,U,5),QANWARD=+$P(QAN742,U,6),QANSLEV=+$P(QAN742,U,10)
"RTN","QANBENE0",89,0)
 I $G(QANWARD)'>0 S QANQUIT=1 Q
"RTN","QANBENE0",90,0)
 I '$D(^SC(QANWARD)) S QANQUIT=1 Q
"RTN","QANBENE0",91,0)
 D WARD
"RTN","QANBENE0",92,0)
 Q
"RTN","QANBENE0",93,0)
QLOOP ;Save variables for %ZTLOAD.
"RTN","QANBENE0",94,0)
 F I="^TMP(""QANBEN"",$J,","PAGE","TODAY","QAN*","QAQ*" S ZTSAVE(I)=""
"RTN","QANBENE0",95,0)
 Q
"RTN","QANBENE0",96,0)
WARD ;determine if record should be included in report
"RTN","QANBENE0",97,0)
 S QANWARD=$G(^SC(QANWARD,42)) D
"RTN","QANBENE0",98,0)
 . I $G(QANWARD)']"" S QANWARD="O" Q
"RTN","QANBENE0",99,0)
 . I $G(QANWARD) S QANWARD=$P(^DIC(42,QANWARD,0),U,3)
"RTN","QANBENE0",100,0)
 . I $G(QANWARD)]"" S QANWARD=$S($G(QANWARD)="D":"D",$G(QANWARD)="NH":"N",1:"I") Q
"RTN","QANBENE0",101,0)
 . I $G(QANWARD)']"" S QANWARD="O"
"RTN","QANBENE0",102,0)
 S QANXXX=$S(QANFLG("WARD")="C":1,QANFLG("WARD")="A":1,QANFLG("WARD")=QANWARD:1,$G(QANFLG("WARD A")):1,1:0)
"RTN","QANBENE0",103,0)
 I QANXXX<1 S QANQUIT=1 Q
"RTN","QANBENE0",104,0)
 Q
"RTN","QANBENE0",105,0)
TALLY ;create and increment globals for report
"RTN","QANBENE0",106,0)
 S QANCOUNT("SLEV",QANAA,QANLBL,QANSLEV)=$G(QANCOUNT("SLEV",QANAA,QANLBL,QANSLEV))+1
"RTN","QANBENE0",107,0)
 I $G(QANINVST)>1 S QANCOUNT("INV",QANAA,QANLBL,QANSLEV)=$G(QANCOUNT("INV",QANAA,QANLBL,QANSLEV))+1
"RTN","QANBENE0",108,0)
 Q
"RTN","QANBENE1")
0^2^B19569999
"RTN","QANBENE1",1,0)
QANBENE1 ;HISC/GJC-Special incidents invol. a beneficiary ;3/3/92
"RTN","QANBENE1",2,0)
 ;;2.0;Incident Reporting;**1,8,11,18,26,28**;08/07/1992
"RTN","QANBENE1",3,0)
 ;
"RTN","QANBENE1",4,0)
EN1 ;Format of the print for our Beneficiary Report.
"RTN","QANBENE1",5,0)
 S QANWHICH=$S(QANFLG("WARD")="D":"Domiciliary",QANFLG("WARD")="NH":"NHCU",QANFLG("WARD")="I":"Inpatient",QANFLG("WARD")="O":"Outpatient",1:"total")
"RTN","QANBENE1",6,0)
 Q:QANQUIT
"RTN","QANBENE1",7,0)
 I '$D(^TMP("QANBEN",$J,"BEN")) D PRINT^QANBENE3 Q
"RTN","QANBENE1",8,0)
 Q:QANQUIT
"RTN","QANBENE1",9,0)
 S QANAA=""
"RTN","QANBENE1",10,0)
 F  S QANAA=$O(^TMP("QANBEN",$J,"BEN",QANAA)) Q:QANAA']""  D
"RTN","QANBENE1",11,0)
 . S QANBB=""
"RTN","QANBENE1",12,0)
 . F  S QANBB=$O(^TMP("QANBEN",$J,"BEN",QANAA,QANBB)) Q:QANBB']""  D
"RTN","QANBENE1",13,0)
 . . S QANLP(1)=0
"RTN","QANBENE1",14,0)
 . . F  S QANLP(1)=$O(^TMP("QANBEN",$J,"BEN",QANAA,QANBB,QANLP(1))) Q:QANLP(1)'>0  D INC
"RTN","QANBENE1",15,0)
 I '$D(^TMP("QANBEN",$J,"BEN")) W !!,"There exist zero (0) "_QANWHICH_" incidents for this date range."
"RTN","QANBENE1",16,0)
 D EN1^QANBENE2 ;Prints out the data.
"RTN","QANBENE1",17,0)
 Q
"RTN","QANBENE1",18,0)
INC ;Checks for appropriate incident data.
"RTN","QANBENE1",19,0)
 K QANLBL S QAN7424=$G(^QA(742.4,QANLP(1),0)) Q:QAN7424']""
"RTN","QANBENE1",20,0)
 S QANINPT=$P(QAN7424,U,2),QANINVST=+$P(QAN7424,U,11)
"RTN","QANBENE1",21,0)
 I $D(^QA(742.1,"BUPPER","PATIENT ABUSE",QANINPT)) D PROVE Q
"RTN","QANBENE1",22,0)
 I $D(^QA(742.1,"BUPPER","DEATH",QANINPT)) D DEATH Q
"RTN","QANBENE1",23,0)
 I $D(^QA(742.1,"BUPPER","FALL",QANINPT)) S QANLBL="FALLS"
"RTN","QANBENE1",24,0)
 I $D(^QA(742.1,"BUPPER","INFORMED CONSENT-FAIL. TO OBTAIN",QANINPT)) S QANLBL="INFORMED"
"RTN","QANBENE1",25,0)
 I $D(^QA(742.1,"BUPPER","INFORMED CONSENT, FAIL. TO OBTAIN",QANINPT)) S QANLBL="INFORMED"
"RTN","QANBENE1",26,0)
 I $D(^QA(742.1,"BUPPER","HOMICIDE",QANINPT)) S QANLBL="HOMICIDE"
"RTN","QANBENE1",27,0)
 I $D(^QA(742.1,"BUPPER","MEDICATION ERROR",QANINPT)) S QANLBL="MED ERR"
"RTN","QANBENE1",28,0)
 I $D(^QA(742.1,"BUPPER","MISSING PATIENT",QANINPT)) S QANLBL="MISSING PAT"
"RTN","QANBENE1",29,0)
 I $D(^QA(742.1,"BUPPER","ASSAULT-PATIENT TO PATIENT",QANINPT)) S QANLBL="ASSAULT PAT/PAT"
"RTN","QANBENE1",30,0)
 I $D(^QA(742.1,"BUPPER","ASSAULT, PATIENT TO PATIENT",QANINPT)) S QANLBL="ASSAULT PAT/PAT"
"RTN","QANBENE1",31,0)
 I $D(^QA(742.1,"BUPPER","ASSAULT-PATIENT/STAFF",QANINPT)) S QANLBL="ASSAULT PAT/STAFF"
"RTN","QANBENE1",32,0)
 I $D(^QA(742.1,"BUPPER","ASSAULT, PATIENT/STAFF",QANINPT)) S QANLBL="ASSAULT PAT/STAFF"
"RTN","QANBENE1",33,0)
 I $D(^QA(742.1,"BUPPER","INJURY NOT OTHERWISE LISTED",QANINPT)) S QANLBL="OTHER"
"RTN","QANBENE1",34,0)
 I $D(^QA(742.1,"BUPPER","FIRE-PATIENT INVOLVED IN",QANINPT)) S QANLBL="FIRE"
"RTN","QANBENE1",35,0)
 I $D(^QA(742.1,"BUPPER","FIRE, PATIENT INVOLVED IN",QANINPT)) S QANLBL="FIRE"
"RTN","QANBENE1",36,0)
 I $D(^QA(742.1,"BUPPER","SEXUAL ASSAULT",QANINPT)) S QANLBL="SEX"
"RTN","QANBENE1",37,0)
 I $D(^QA(742.1,"BUPPER","SUICIDE ATTEMPT",QANINPT)) S QANLBL="SUI ATT"
"RTN","QANBENE1",38,0)
 I $D(^QA(742.1,"BUPPER","SUICIDE",QANINPT)) S QANLBL="SUICIDE"
"RTN","QANBENE1",39,0)
 I $D(^QA(742.1,"BUPPER","TRANSFUSION ERROR",QANINPT)) S QANLBL="TRANS ERR"
"RTN","QANBENE1",40,0)
 Q:$G(QANLBL)']""  ;Not a valid label
"RTN","QANBENE1",41,0)
 F QANLP(2)=0:0 S QANLP(2)=$O(^TMP("QANBEN",$J,"BEN",QANAA,QANBB,QANLP(1),QANLP(2))) Q:QANLP(2)'>0  D
"RTN","QANBENE1",42,0)
 . S QANSLEV=$P(^QA(742,QANLP(2),0),U,10) Q:$G(QANSLEV)']""
"RTN","QANBENE1",43,0)
 . I $G(QANLBL)]"" D TALLY^QANBENE0
"RTN","QANBENE1",44,0)
 I '$D(^TMP("QANBEN",$J,"BEN")) W !!,"There exist zero (0) incidents within this data range." Q
"RTN","QANBENE1",45,0)
 Q
"RTN","QANBENE1",46,0)
DEATH ;Tracking Deaths.
"RTN","QANBENE1",47,0)
 F QANLP(2)=0:0 S QANLP(2)=$O(^TMP("QANBEN",$J,"BEN",QANAA,QANBB,QANLP(1),QANLP(2))) Q:QANLP(2)'>0  D
"RTN","QANBENE1",48,0)
 . S QANSLEV=$P(^QA(742,QANLP(2),0),U,10) Q:'$G(QANSLEV)
"RTN","QANBENE1",49,0)
 . D DEATH1
"RTN","QANBENE1",50,0)
 . Q:$G(QANDTH)']""
"RTN","QANBENE1",51,0)
 . D:$G(QANLBL)]"" TALLY^QANBENE0
"RTN","QANBENE1",52,0)
 Q
"RTN","QANBENE1",53,0)
DEATH1 ;Tracking Deaths.
"RTN","QANBENE1",54,0)
 S QANDTH=$P(QAN7424,U,14) Q:QANDTH']""
"RTN","QANBENE1",55,0)
 Q:$D(^QA(742.14,"BUPPER","OTHER",QANDTH))
"RTN","QANBENE1",56,0)
 Q:$D(^QA(742.14,"BUPPER","WITHIN 24 HOURS OF ADMISSION (EX. DOA'S AND TERMINALS)",QANDTH))
"RTN","QANBENE1",57,0)
 I $D(^QA(742.14,"BUPPER","CONJUNCTION WITH A PROCEDURE",QANDTH)) S QANLBL="DEATH-CON"
"RTN","QANBENE1",58,0)
 I $D(^QA(742.14,"BUPPER","DURING INDUCTION OF ANES.",QANDTH)) S QANLBL="DEATH-ANESTH"
"RTN","QANBENE1",59,0)
 I $D(^QA(742.14,"BUPPER","FAILURE TO DIAGNOSE OR TREAT",QANDTH)) S QANLBL="DEATH-FAIL"
"RTN","QANBENE1",60,0)
 I $D(^QA(742.14,"BUPPER","ON MEDICAL CENTER GROUNDS",QANDTH)) S QANLBL="DEATH-MED CEN"
"RTN","QANBENE1",61,0)
 I $D(^QA(742.14,"BUPPER","OPERATING ROOM",QANDTH)) S QANLBL="DEATH-OR"
"RTN","QANBENE1",62,0)
 I $D(^QA(742.14,"BUPPER","RECOVERY ROOM",QANDTH)) S QANLBL="DEATH-RR"
"RTN","QANBENE1",63,0)
 I $D(^QA(742.14,"BUPPER","CASES ACCEPTED BY M.E.",QANDTH)) S QANLBL="DEATH-M.E."
"RTN","QANBENE1",64,0)
 I $D(^QA(742.14,"BUPPER","EQUIPMENT MALFUNCTION",QANDTH)) S QANLBL="DEATH-EQ"
"RTN","QANBENE1",65,0)
 I $D(^QA(742.14,"BUPPER","WITHIN 48 HOURS OF SURGERY",QANDTH)) S QANLBL="DEATH-48"
"RTN","QANBENE1",66,0)
 Q
"RTN","QANBENE1",67,0)
PROVE ;Sets Patient Abuse Array.
"RTN","QANBENE1",68,0)
 S QANAB=+$P(QAN7424,U,16),QANLBL=$S(QANAB=1:"PATIENT ABUSE/PROVEN",1:"PATIENT ABUSE/ALLEGED")
"RTN","QANBENE1",69,0)
 F QANLP(2)=0:0 S QANLP(2)=$O(^TMP("QANBEN",$J,"BEN",QANAA,QANBB,QANLP(1),QANLP(2))) Q:QANLP(2)'>0  D
"RTN","QANBENE1",70,0)
 . S QANSLEV=$P(^QA(742,QANLP(2),0),U,10)
"RTN","QANBENE1",71,0)
 . Q:$G(QANLBL)']""!('$G(QANSLEV))
"RTN","QANBENE1",72,0)
 . D TALLY^QANBENE0
"RTN","QANBENE1",73,0)
 Q
"RTN","QANBENE2")
0^3^B27405253
"RTN","QANBENE2",1,0)
QANBENE2 ;HISC/GJC-Special incidents invol. a beneficiary ;3/3/92
"RTN","QANBENE2",2,0)
 ;;2.0;Incident Reporting;**1,26,28**;08/07/1992
"RTN","QANBENE2",3,0)
 ;
"RTN","QANBENE2",4,0)
EN1 ;sort through divisions, if integrated
"RTN","QANBENE2",5,0)
 I $G(QANDVFLG)=1 D  Q
"RTN","QANBENE2",6,0)
 . S QANCC=""
"RTN","QANBENE2",7,0)
 . F  S QANCC=$O(^TMP("QANBEN",$J,"BEN",QANCC)) Q:QANCC']""  D
"RTN","QANBENE2",8,0)
 . . D INST^QANRPT1(QANCC,.QANDV)
"RTN","QANBENE2",9,0)
 . . S QANHEAD(4)="REPORT FOR DIVISION: "_QANDV
"RTN","QANBENE2",10,0)
 . . D HDH Q:QANQUIT
"RTN","QANBENE2",11,0)
 . . D EN2 Q:QANQUIT
"RTN","QANBENE2",12,0)
 I $G(QANQUIT)=1 Q
"RTN","QANBENE2",13,0)
 I $G(QANDVFLG)'=1 S (QANCC,QANDIV)=0,QANDV="Unknown"
"RTN","QANBENE2",14,0)
EN2 ;Format of the print for our Beneficiary Report.
"RTN","QANBENE2",15,0)
 S QANLBL="PATIENT ABUSE/ALLEGED"
"RTN","QANBENE2",16,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",17,0)
 W !!?QANTAB(1),"(1)",?QANTAB(2),"Alleged Patient Abuse" D STNDRD Q:QANQUIT
"RTN","QANBENE2",18,0)
 S QANLBL="PATIENT ABUSE/PROVEN"
"RTN","QANBENE2",19,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",20,0)
 W !!?QANTAB(1),"(2)",?QANTAB(2),"Proven Patient Abuse" D SPECIAL^QANBENE3 Q:QANQUIT
"RTN","QANBENE2",21,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",22,0)
 W !!?QANTAB(1),"(3)",?QANTAB(2),"Deaths" D DEATH Q:QANQUIT
"RTN","QANBENE2",23,0)
 S QANLBL="INFORMED"
"RTN","QANBENE2",24,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",25,0)
 W !!?QANTAB(1),"(4)",?QANTAB(2),"Failure to Obtain",!?QANTAB(2),"Informed Consent" D RGLAR Q:QANQUIT
"RTN","QANBENE2",26,0)
 S QANLBL="FALLS"
"RTN","QANBENE2",27,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",28,0)
 W !!?QANTAB(1),"(5)",?QANTAB(2),"Falls" D STNDRD Q:QANQUIT
"RTN","QANBENE2",29,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",30,0)
 S QANLBL="HOMICIDE"
"RTN","QANBENE2",31,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",32,0)
 W !!?QANTAB(1),"(6)",?QANTAB(2),"Homicide" D RGLAR2 Q:QANQUIT
"RTN","QANBENE2",33,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",34,0)
 S QANLBL="MED ERR"
"RTN","QANBENE2",35,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",36,0)
 W !!?QANTAB(1),"(7)",?QANTAB(2),"Medication Errors" D STNDRD Q:QANQUIT
"RTN","QANBENE2",37,0)
 I PAGE,($E(IOST)'="C") D PRINT^QANBENE3
"RTN","QANBENE2",38,0)
 D:$Y>(IOSL-8) HDH Q:QANQUIT
"RTN","QANBENE2",39,0)
 S QANLBL="MISSING PAT"
"RTN","QANBENE2",40,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",41,0)
 W !!?QANTAB(1),"(8)",?QANTAB(2),"Missing Patient" D STNDRD Q:QANQUIT
"RTN","QANBENE2",42,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",43,0)
 S QANLBL="ASSAULT PAT/PAT"
"RTN","QANBENE2",44,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",45,0)
 W !!?QANTAB(1),"(9)",?QANTAB(2),"Patient on Patient",!?QANTAB(2),"Assault" D STNDRD Q:QANQUIT
"RTN","QANBENE2",46,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",47,0)
 D EN1^QANBENE3 Q:QANQUIT
"RTN","QANBENE2",48,0)
 Q
"RTN","QANBENE2",49,0)
DEATH ;Prints for deaths.
"RTN","QANBENE2",50,0)
 S QANLBL="DEATH-OR"
"RTN","QANBENE2",51,0)
 W !?QANTAB(3),"In Operating Room",?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,3),0),?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,3),0)
"RTN","QANBENE2",52,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",53,0)
 S QANLBL="DEATH-RR"
"RTN","QANBENE2",54,0)
 W !?QANTAB(3),"In Recovery Room",?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,3),0),?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,3),0)
"RTN","QANBENE2",55,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",56,0)
 S QANLBL="DEATH-ANESTH" W !?QANTAB(3),"During induction"
"RTN","QANBENE2",57,0)
 W !?QANTAB(3)," of anesthesia",?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,3),0),?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,3),0)
"RTN","QANBENE2",58,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",59,0)
 S QANLBL="DEATH-48" W !?QANTAB(3),"Within 48 hrs. of"
"RTN","QANBENE2",60,0)
 W !?QANTAB(3)," surgery",?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,3),0),?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,3),0)
"RTN","QANBENE2",61,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",62,0)
 S QANLBL="DEATH-CON" W !?QANTAB(3),"In conjunction with"
"RTN","QANBENE2",63,0)
 W !?QANTAB(3)," a procedure",?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,3),0),?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,3),0)
"RTN","QANBENE2",64,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",65,0)
 S QANLBL="DEATH-EQ" W !?QANTAB(3),"Equipment mal-"
"RTN","QANBENE2",66,0)
 W !?QANTAB(3)," function",?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,3),0),?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,3),0)
"RTN","QANBENE2",67,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",68,0)
 S QANLBL="DEATH-FAIL" W !?QANTAB(3),"Due to failure to"
"RTN","QANBENE2",69,0)
 W !?QANTAB(3)," diagnose or treat",?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,3),0),?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,3),0)
"RTN","QANBENE2",70,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",71,0)
 S QANLBL="DEATH-M.E." W !?QANTAB(3),"Cases accepted by",!?QANTAB(3)," Medical Examiner"
"RTN","QANBENE2",72,0)
 W ?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,3),0),?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,3),0)
"RTN","QANBENE2",73,0)
 S QANLBL="DEATH-MED CEN" W !?QANTAB(3),"On medical center",!?QANTAB(3)," grounds while not"
"RTN","QANBENE2",74,0)
 W !?QANTAB(3)," being treated",?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,3),0),?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,3),0)
"RTN","QANBENE2",75,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",76,0)
 Q
"RTN","QANBENE2",77,0)
RGLAR ;Regular w/o Severity Levels.
"RTN","QANBENE2",78,0)
 W ?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,2),0),?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,2),0)
"RTN","QANBENE2",79,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",80,0)
 Q
"RTN","QANBENE2",81,0)
RGLAR2 ;Regular w/o severity levels - (homicide & suicide)
"RTN","QANBENE2",82,0)
 W ?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,3),0),?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,3),0)
"RTN","QANBENE2",83,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",84,0)
 Q
"RTN","QANBENE2",85,0)
STNDRD ;Printing 'Severity Level'
"RTN","QANBENE2",86,0)
 W !?QANTAB(3),"Severity Level 0",?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,0),0)
"RTN","QANBENE2",87,0)
 W ?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,0),0)
"RTN","QANBENE2",88,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",89,0)
 W !?QANTAB(3),"Severity Level 1",?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,1),0)
"RTN","QANBENE2",90,0)
 W ?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,1),0)
"RTN","QANBENE2",91,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",92,0)
 W !?QANTAB(3),"Severity Level 2",?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,2),0)
"RTN","QANBENE2",93,0)
 W ?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,2),0)
"RTN","QANBENE2",94,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",95,0)
 W !?QANTAB(3),"Severity Level 3",?QANTAB(5),$G(QANCOUNT("SLEV",QANCC,QANLBL,3),0)
"RTN","QANBENE2",96,0)
 W ?QANTAB(6),$G(QANCOUNT("INV",QANCC,QANLBL,3),0)
"RTN","QANBENE2",97,0)
 D:$Y>(IOSL-4) HDH Q:QANQUIT
"RTN","QANBENE2",98,0)
 Q
"RTN","QANBENE2",99,0)
HDH ;End of screen interface.
"RTN","QANBENE2",100,0)
 Q:QANQUIT
"RTN","QANBENE2",101,0)
 I $E(IOST)="C" K DIR S DIR(0)="E" D ^DIR K DIR S:+Y=0 QANQUIT=1
"RTN","QANBENE2",102,0)
 Q:QANQUIT
"RTN","QANBENE2",103,0)
 D HDR^QANBENE0
"RTN","QANBENE2",104,0)
 Q
"RTN","QANCDNT")
0^5^B64771493
"RTN","QANCDNT",1,0)
QANCDNT ;HISC/GJC-Initial sighting of an incident ;10/9/92
"RTN","QANCDNT",2,0)
 ;;2.0;Incident Reporting;**1,9,14,27,26,28**;08/07/1992
"RTN","QANCDNT",3,0)
 ;
"RTN","QANCDNT",4,0)
 N QANQFLG
"RTN","QANCDNT",5,0)
 D NEWREC ;I $G(QANLOCK)=1 L -^QA(742.4) S QANLOCK=0 Q
"RTN","QANCDNT",6,0)
 D DIV
"RTN","QANCDNT",7,0)
 I $G(QANQFLG)=1 D DEL Q
"RTN","QANCDNT",8,0)
 D DIE
"RTN","QANCDNT",9,0)
 Q
"RTN","QANCDNT",10,0)
NEWREC  ;create new record number
"RTN","QANCDNT",11,0)
 ;record number will be in the format XXX.YYnnnn where XXX is the
"RTN","QANCDNT",12,0)
 ;three digit station number, YY is the 2 digit year and nnnn is
"RTN","QANCDNT",13,0)
 ;the sequence number (and is also the IEN of file 742.4)
"RTN","QANCDNT",14,0)
 N EE,QANCNT,QANLIST,QANNO,QANQFLG
"RTN","QANCDNT",15,0)
 K QANLOCK
"RTN","QANCDNT",16,0)
 S (QANFLAG,QANXIT,QANOUT)=0,QANST=$S($D(^QA(740,1,0))#2:$P(^(0),"^"),1:""),QANST1=$S($D(^DIC(4,QANST,99))#2:$P(^(99),"^"),1:QANST)
"RTN","QANCDNT",17,0)
 S QANDUZ=$S($D(DUZ):DUZ,1:""),QANTTL=$P(^VA(200,QANDUZ,0),U,9)
"RTN","QANCDNT",18,0)
 ;set QANDT variable as "." concatonated with 2 digit year so that
"RTN","QANCDNT",19,0)
 ;years 2000-2009 don't have leading zeroes.
"RTN","QANCDNT",20,0)
 S QANDT=$S($D(DT):$E(DT,2,3),1:""),QANDT="."_QANDT
"RTN","QANCDNT",21,0)
 S QANINCR=+$P($G(^QA(742.4,0)),U,3)+1 ;Grab the new IEN
"RTN","QANCDNT",22,0)
 F  Q:$D(^QA(742.4,QANINCR,0))=0  S QANINCR=QANINCR+1
"RTN","QANCDNT",23,0)
 S QANCODE(0)=QANDT_QANINCR
"RTN","QANCDNT",24,0)
 I $L(QANINCR)<4 S QANCODE(0)=QANDT_$E("000",1,(4-$L(QANINCR)))_QANINCR
"RTN","QANCDNT",25,0)
 S QANCODE(1)=QANST1_QANCODE(0)
"RTN","QANCDNT",26,0)
 S QANCHK=$O(^QA(742.4,"B",QANCODE(1),0)) I +QANCHK,$D(^(QANCHK))#2 D  Q
"RTN","QANCDNT",27,0)
 . W !!,$C(7),"CASE NUMBER VIOLATION, CONTACT YOUR QA COORDINATOR!!"
"RTN","QANCDNT",28,0)
 . S QANXIT=1
"RTN","QANCDNT",29,0)
 . K QANST,QANST1,QANDT,QANCODE,QANINCR,QANFLAG,QANOUT,QANDUZ,QANCHK,QANTTL
"RTN","QANCDNT",30,0)
 I $G(QANXIT)=1 Q
"RTN","QANCDNT",31,0)
 K DIC,DD,DO,DLAYGO,DINUM S (DIC,DIE)="^QA(742.4,",DIC(0)="L",X=QANCODE(1)
"RTN","QANCDNT",32,0)
 D FILE^DICN
"RTN","QANCDNT",33,0)
 K DIC,DD,DO,DLAYGO,DINUM
"RTN","QANCDNT",34,0)
 L +^QA(742.4,+Y):3 I '$T W !!,"Another user is editing this incident." S QANLOCK=1 Q
"RTN","QANCDNT",35,0)
 S QANBFLG=1 ;set brief flag so that if this subroutine was called
"RTN","QANCDNT",36,0)
 ;from full incident edit you do not re-lock the record when you
"RTN","QANCDNT",37,0)
 ;get back to full incident edit.
"RTN","QANCDNT",38,0)
 Q:+Y<1  S QANIEN=+Y
"RTN","QANCDNT",39,0)
 S QANHOME=$G(^QA(742.4,QANIEN,0)),$P(QANHOME,U,5)=QANDUZ,$P(QANHOME,U,6)=QANTTL,$P(QANHOME,U,15)=1,$P(QANHOME,U,8)=1
"RTN","QANCDNT",40,0)
 K DA,DIK S DIK="^QA(742.4,",DA=QANIEN,^QA(742.4,QANIEN,0)=QANHOME D IX1^DIK K DA,DIK
"RTN","QANCDNT",41,0)
 Q
"RTN","QANCDNT",42,0)
DIV ;check to see if station is multi-divisional for Incid Reporting.  If
"RTN","QANCDNT",43,0)
 ;so, and there are hosp locations in file 740 (node "QAN2") then
"RTN","QANCDNT",44,0)
 ;prompt user for Division.
"RTN","QANCDNT",45,0)
 I $P($G(^QA(740,1,"QAN")),U,5)=1 S TEMPY=$G(Y) D  S Y=$G(TEMPY)
"RTN","QANCDNT",46,0)
 . W !!,"DIVISION: "
"RTN","QANCDNT",47,0)
 . S QANCNT=0 S QANLIST="S EE=0 F  S EE=$O(^QA(740,1,""QAN2"",EE)) Q:EE'>0  W !?5,EE,?10,$P(^DIC(4,$P(^QA(740,1,""QAN2"",EE,0),U),0),U) S QANCNT=QANCNT+1"
"RTN","QANCDNT",48,0)
LIST . S QANCNT=0 X QANLIST
"RTN","QANCDNT",49,0)
 . I $G(QANCNT)<1 W !?5,"There are no divisions entered in your QA Site Parameter File (#704).",!?5,"Ask your IRM support person to edit this file.  If your site"
"RTN","QANCDNT",50,0)
 . I $G(QANCNT)<1 W !?5,"is entered in file #740 as a MULTI-DIVISIONAL INCID REP FACILITY you need",!?5,"entries in the IR HOSPITAL DIVISION multiple."
"RTN","QANCDNT",51,0)
 . S DIR(0)="NA"
"RTN","QANCDNT",52,0)
 . S DIR("A")="Enter the number of your choice: "
"RTN","QANCDNT",53,0)
 . S DIR("?")="Choose the number of your division."
"RTN","QANCDNT",54,0)
 . S DIR("??")="^S X=QANCNT X QANLIST"
"RTN","QANCDNT",55,0)
 . D ^DIR
"RTN","QANCDNT",56,0)
 . I $G(Y)']""!($G(Y)="^") D
"RTN","QANCDNT",57,0)
 . . W !!?5,"You must enter a Division.",!
"RTN","QANCDNT",58,0)
 . . D ^DIR
"RTN","QANCDNT",59,0)
 . . I $G(Y)']""!($G(Y)="^") S QANQFLG=1 Q
"RTN","QANCDNT",60,0)
 . I $G(QANQFLG)=1 Q
"RTN","QANCDNT",61,0)
 . I '$G(^QA(740,1,"QAN2",+Y,0)) W !,"Enter the number of your choice." S QANCNT=0 G LIST
"RTN","QANCDNT",62,0)
 . S QANNO=+Y
"RTN","QANCDNT",63,0)
 . S DIE="^QA(742.4,",DR="52///^S X=$P(^DIC(4,+^QA(740,1,""QAN2"",QANNO,0),0),U)"
"RTN","QANCDNT",64,0)
 . S DA=QANIEN
"RTN","QANCDNT",65,0)
 . D ^DIE I $D(Y)>0 S QANCNT=0 G LIST
"RTN","QANCDNT",66,0)
 Q
"RTN","QANCDNT",67,0)
DIE S DIE="^QA(742.4,",DA=QANIEN,DR=".02;.03;.04;S X=X"
"RTN","QANCDNT",68,0)
 D ^DIE K DIE,DR I $D(Y) D DEL Q:QANXIT
"RTN","QANCDNT",69,0)
 S QANST=$P(^QA(742.4,QANIEN,0),U,2) I "12"[$P(^QA(742.1,QANST,0),U,2) S $P(^QA(742.4,QANIEN,0),U,9)=DT,QAQADICT=742.4,QAQAFLD=".1",X=DT D ENSET^QAQAXREF
"RTN","QANCDNT",70,0)
 K ^UTILITY($J,"QAN PAT") F  D PAT Q:QANXIT!(QANOUT)  ;get the patient
"RTN","QANCDNT",71,0)
 Q:QANXIT
"RTN","QANCDNT",72,0)
SC1 ;
"RTN","QANCDNT",73,0)
 K Y S DIE="^QA(742.4,",DA=QANIEN,DR=".05;@1;.08;S X=X" D ^DIE K DIE,DR I $D(Y) Q:QANXIT
"RTN","QANCDNT",74,0)
 K QAUDIT S QAUDIT("FILE")="742.4^50",QAUDIT("DA")=QANIEN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Open an incident record" D ^QAQAUDIT
"RTN","QANCDNT",75,0)
 S DIE="^QA(742.4,",DR=".09///"_1,DA=QANIEN D ^DIE ; Set 'Local Case' flag to open.
"RTN","QANCDNT",76,0)
 I $G(QANFFLG)<1 D DISP
"RTN","QANCDNT",77,0)
 I $G(QANFFLG)<0 L -^QA(742.4,QANIEN) ;if this subroutine has not
"RTN","QANCDNT",78,0)
 ;been called from the full incident edit, then unlock incident report.
"RTN","QANCDNT",79,0)
 ;D ^QANBRIF ;transmit message to local mail group
"RTN","QANCDNT",80,0)
 Q
"RTN","QANCDNT",81,0)
DEL ;Delete incident.
"RTN","QANCDNT",82,0)
 K DIK S DIK="^QA(742.4,",DA=QANIEN W !!,$C(7),"Insufficient data entered for an incident, deleting!!" D ^DIK K DA,DIK S QANXIT=1
"RTN","QANCDNT",83,0)
 Q
"RTN","QANCDNT",84,0)
PAT ;Patient data.
"RTN","QANCDNT",85,0)
 K DIC S DIC="^DPT(",DIC(0)="QEAMNZ",DIC("A")="Select Patient: ",DIC("W")="W "" "",$P(^(0),U,9)",D="B^BS5"
"RTN","QANCDNT",86,0)
 D MIX^DIC1 K DIC S:+Y<1&($G(QANFLAG)) QANOUT=1
"RTN","QANCDNT",87,0)
 D:+Y<1&('$G(QANFLAG)) DEL^QANCDNT Q:QANXIT!(QANOUT)
"RTN","QANCDNT",88,0)
 F  D  Q:"-12"[%
"RTN","QANCDNT",89,0)
 . W !?5,$G(Y(0,0))_" OK?"
"RTN","QANCDNT",90,0)
 . S %=1 D YN^DICN Q:"-12"[%
"RTN","QANCDNT",91,0)
 . W " Confirm that this is the correct patient."
"RTN","QANCDNT",92,0)
 D:%=-1&('$G(QANFLAG)) DEL^QANCDNT Q:QANXIT!(QANOUT)
"RTN","QANCDNT",93,0)
 I %=-1,($G(QANFLAG)) S QANXIT=1 Q
"RTN","QANCDNT",94,0)
 I %=2 W " ??" G PAT
"RTN","QANCDNT",95,0)
 D PRIOR I QANXIT D  Q
"RTN","QANCDNT",96,0)
 . I '$G(QANFLAG) K DA,DIK S DA=QANIEN,DIK="^QA(742.4," D ^DIK K DA,DIK
"RTN","QANCDNT",97,0)
 I $D(^UTILITY($J,"QAN PAT",+Y)) W !!,$C(7),$P(^DPT(+Y,0),U)_" has been previously entered for this incident." K Y G PAT
"RTN","QANCDNT",98,0)
 I $D(^DPT(+Y,.35)),$P(^DPT(+Y,.35),U)]"",($P(^DPT(+Y,.35),U)<$P(^QA(742.4,QANIEN,0),U,3)) W !!,$C(7),"The date of death for patient: "_$P(^DPT(+Y,0),U)_" precedes the incident date." K Y G PAT
"RTN","QANCDNT",99,0)
 I $G(QANXIT)!($G(QANOUT)) D DEL Q
"RTN","QANCDNT",100,0)
 S QANPIEN=+Y,QANZERO=Y(0),QANAME=Y(0,0),QANSSN=$P(QANZERO,U,9),^UTILITY($J,"QAN PAT",+Y)=""
"RTN","QANCDNT",101,0)
 S QANDOB=$P(^DPT(QANPIEN,0),U,3)
"RTN","QANCDNT",102,0)
 I QANDOB]"" S X=DT,X1=X,X2=QANDOB,X="" D:X2 ^%DTC S X=X\365.25,QANAGE=X
"RTN","QANCDNT",103,0)
 S QANPSDO(0)=Y(0),QANPSDO(0,0)=Y(0,0)
"RTN","QANCDNT",104,0)
 S QANPID=$E($P(Y(0,0),",",2))_$E($P(Y(0,0)," ",2))_$E($P(Y(0,0),","))_$E(QANSSN,6,9)
"RTN","QANCDNT",105,0)
 D ADMDT^QANUTL1
"RTN","QANCDNT",106,0)
 K DIC,DD,DO,DINUM,DLAYGO S DLAYGO=742,DIC="^QA(742,",DIC(0)="L",X=QANPIEN D FILE^DICN K DIC,DD,DO,DINUM,DLAYGO
"RTN","QANCDNT",107,0)
 I +Y=-1,('$G(QANFLAG)) D DEL Q
"RTN","QANCDNT",108,0)
 I +Y=-1,($G(QANFLAG)) S QANXIT=1 Q  ;Something is wrong, exit.
"RTN","QANCDNT",109,0)
 S QANDFN=+Y
"RTN","QANCDNT",110,0)
 L +^QA(742,QANDFN):10 I '$T W !!,"Another user is editing this patient incident." Q
"RTN","QANCDNT",111,0)
 S $P(^QA(742,QANDFN,0),U,2,6)=QANPID_U_QANIEN_U_QANADMDT_U_QANINPAT_U_QANWARD
"RTN","QANCDNT",112,0)
 S $P(^QA(742,QANDFN,0),U,7)=QANTRSP,$P(^QA(742,QANDFN,0),U,12)=1
"RTN","QANCDNT",113,0)
 S DIK="^QA(742,",DA=QANDFN D IX1^DIK K DA,DIK
"RTN","QANCDNT",114,0)
 L -^QA(742,QANDFN)
"RTN","QANCDNT",115,0)
 S QANFLAG=1 ;D:'$D(QANF) BULL^QANUTL3
"RTN","QANCDNT",116,0)
 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Open a patient record" D ^QAQAUDIT
"RTN","QANCDNT",117,0)
 Q
"RTN","QANCDNT",118,0)
PRIOR ;
"RTN","QANCDNT",119,0)
 S QANTST(1)=$G(^QA(742.4,QANIEN,0))
"RTN","QANCDNT",120,0)
 S QANTST("INC")=$P(QANTST(1),U,2),QANTST("DATE")=$P(QANTST(1),U,3)
"RTN","QANCDNT",121,0)
 F QAN99=0:0 S QAN99=$O(^QA(742,"AA",+Y,QAN99)) Q:QAN99'>0!(QANXIT)  S QANPRS=+$O(^QA(742,"AA",+Y,QAN99,"")) I QANPRS>0,($P(^QA(742,QANPRS,0),U,12)'<0) S QANTST(2)=$G(^QA(742.4,QAN99,0)) D PRIOR1
"RTN","QANCDNT",122,0)
 K QAN99,QANPRS,QANTST
"RTN","QANCDNT",123,0)
 Q
"RTN","QANCDNT",124,0)
PRIOR1 ;
"RTN","QANCDNT",125,0)
 I (QANTST("INC")=$P(QANTST(2),U,2)),(QANTST("DATE")=$P(QANTST(2),U,3)) D
"RTN","QANCDNT",126,0)
 . W !!,$C(7),"Patient "_$P(^DPT(+Y,0),U)_" has a duplicate incident on record."
"RTN","QANCDNT",127,0)
 . W:'$G(QANFLAG) !,"Deleting the incident."
"RTN","QANCDNT",128,0)
 . W:$G(QANFLAG) !,"Exiting!"
"RTN","QANCDNT",129,0)
 . S QANXIT=1
"RTN","QANCDNT",130,0)
 Q
"RTN","QANCDNT",131,0)
DISP ;display to user what has been entered and ask if it is okay
"RTN","QANCDNT",132,0)
 N QANCC,QANEE
"RTN","QANCDNT",133,0)
 W @IOF
"RTN","QANCDNT",134,0)
 S QAN74240=^QA(742.4,QANIEN,0)
"RTN","QANCDNT",135,0)
 W !!!,"Incident Report: "_$P(QAN74240,U)
"RTN","QANCDNT",136,0)
 S Y=$P(QAN74240,U,3) D DD^%DT
"RTN","QANCDNT",137,0)
 W ?35,"Date of Incident: "_Y
"RTN","QANCDNT",138,0)
 W !,"Patient: "
"RTN","QANCDNT",139,0)
 S QANCC=0 F  S QANCC=$O(^QA(742,"BCS",QANIEN,QANCC)) Q:QANCC'>0  D
"RTN","QANCDNT",140,0)
 . W ?10,$P(^DPT($P(^QA(742,QANCC,0),U),0),U),!
"RTN","QANCDNT",141,0)
 W !,"Incident Type: "
"RTN","QANCDNT",142,0)
 I $P(QAN74240,U,2)]"" W $P(^QA(742.1,$P(QAN74240,U,2),0),U)
"RTN","QANCDNT",143,0)
 W !,"Incident Location: "
"RTN","QANCDNT",144,0)
 I $P(QAN74240,U,4)]"" W $P(^QA(742.5,$P(QAN74240,U,4),0),U)
"RTN","QANCDNT",145,0)
 W !,"Was the Incident Witnessed?: "_$S($P(QAN74240,U,7)=1:"Yes",$P(QAN74240,U,7)=0:"No",1:"")
"RTN","QANCDNT",146,0)
 W !,"Incident Description: "
"RTN","QANCDNT",147,0)
 S QANEE=0 F  S QANEE=$O(^QA(742.4,QANIEN,1,QANEE)) Q:QANEE'>0  D
"RTN","QANCDNT",148,0)
 . W !?3,^QA(742.4,QANIEN,1,QANEE,0)
"RTN","QANCDNT",149,0)
 W !!
"RTN","QANCDNT",150,0)
 S DIR("A")="Is this information correct?"
"RTN","QANCDNT",151,0)
 S DIR("B")="Yes"
"RTN","QANCDNT",152,0)
 S DIR("?")="Enter 'Yes' or 'No'."
"RTN","QANCDNT",153,0)
 S DIR(0)="YAO"
"RTN","QANCDNT",154,0)
 S DIR("?",1)="Enter 'Yes' if the information displayed is correct."
"RTN","QANCDNT",155,0)
 S DIR("?",2)="Enter 'No' if you need to edit this information."
"RTN","QANCDNT",156,0)
 D ^DIR
"RTN","QANCDNT",157,0)
GOEDIT ;
"RTN","QANCDNT",158,0)
 ;if info is not right, use code from QANEDIT to edit just the fields
"RTN","QANCDNT",159,0)
 ;in a brief incident.  There must be at least one patient/report.
"RTN","QANCDNT",160,0)
 I Y=0 S QANOUT=0 D
"RTN","QANCDNT",161,0)
 . D DIE^QANEDIT
"RTN","QANCDNT",162,0)
 . I $O(^QA(742,"BCS",QANIEN,0))']"" D
"RTN","QANCDNT",163,0)
 . . W !!,"No patients on this Incident Report - deleting Report."
"RTN","QANCDNT",164,0)
 . . S DIK="^QA(742.4,",DA=QANIEN D ^DIK K DIK
"RTN","QANCDNT",165,0)
 . . ;also need to remove entry from QA Audit file (#740.5)
"RTN","QANCDNT",166,0)
 . . ;get most recent entry for 742 and 742.4 and if matches
"RTN","QANCDNT",167,0)
 . . ;this entry, delete
"RTN","QANCDNT",168,0)
 . . F QANFILE=742,742.4 D DIKAUDIT^QANEDIT(QANFILE) K QANFILE
"RTN","QANCDNT",169,0)
 I $G(^QA(742.4,QANIEN,0))]"" D
"RTN","QANCDNT",170,0)
 . D ^QANBRIF ;transmit message to local mail group
"RTN","QANCDNT",171,0)
 . S QANCC=0
"RTN","QANCDNT",172,0)
 . F  S QANCC=$O(^QA(742,"BCS",QANIEN,QANCC)) Q:QANCC'>0  D
"RTN","QANCDNT",173,0)
 . . S QANPTNUM=$P(^QA(742,QANCC,0),U)
"RTN","QANCDNT",174,0)
 . . S QANODE=^DPT(QANPTNUM,0)
"RTN","QANCDNT",175,0)
 . . S QANAME=$P(QANODE,U)
"RTN","QANCDNT",176,0)
 . . S QANSSN=$P(QANODE,U,9)
"RTN","QANCDNT",177,0)
 . . D:'$D(QANF) BULL^QANUTL3
"RTN","QANCDNT",178,0)
 Q
"RTN","QANQUCK")
0^7^B18599562
"RTN","QANQUCK",1,0)
QANQUCK ;HISC/GJC-Intial sighting of an Incident for a QA person ;10/9/92
"RTN","QANQUCK",2,0)
 ;;2.0;Incident Reporting;**1,9,14,27,26,28**;08/07/1992
"RTN","QANQUCK",3,0)
 ;
"RTN","QANQUCK",4,0)
 K QANLOCK
"RTN","QANQUCK",5,0)
 D NEWREC^QANCDNT
"RTN","QANQUCK",6,0)
 D DIV^QANCDNT
"RTN","QANQUCK",7,0)
 I $G(QANQFLG)=1 Q
"RTN","QANQUCK",8,0)
 S QANDEATH=$O(^QA(742.1,"BUPPER","DEATH",0)),QANSUI=$O(^QA(742.1,"BUPPER","SUICIDE",0)),QANHOMCD=$O(^QA(742.1,"BUPPER","HOMICIDE",0))
"RTN","QANQUCK",9,0)
 S QANPTAB=$O(^QA(742.1,"BUPPER","PATIENT ABUSE",0))
"RTN","QANQUCK",10,0)
 S DIE="^QA(742.4,",DA=QANIEN,DR=".02;I X'=QANDEATH S Y=""@1"";.15;@1;.03;S X=X" D ^DIE K DIE,DR I $D(Y) D DEL D:QANXIT KILL Q
"RTN","QANQUCK",11,0)
 S QANLTTR=$P(^QA(742.4,QANIEN,0),U,2)
"RTN","QANQUCK",12,0)
 S QANST=$P(^QA(742.4,QANIEN,0),U,2) I "12"[$P(^QA(742.1,QANST,0),U,2) S $P(^QA(742.4,QANIEN,0),U,9)=DT,QAQADICT=742.4,QAQAFLD=".1",X=DT D ENSET^QAQAXREF
"RTN","QANQUCK",13,0)
 K QAUDIT S QAUDIT("FILE")="742.4^50",QAUDIT("DA")=QANIEN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Open an incident record" D ^QAQAUDIT
"RTN","QANQUCK",14,0)
 S DIE="^QA(742.4,",DR=".09///"_3,DA=QANIEN D ^DIE ; Set 'Local Case' flag to brief.
"RTN","QANQUCK",15,0)
 ;Get the patient.
"RTN","QANQUCK",16,0)
 K ^UTILITY($J,"QAN PAT") F  D PAT Q:QANXIT!(QANOUT)
"RTN","QANQUCK",17,0)
 L -^QA(742.4,QANIEN) ;unlock record - it was locked in NEWREC^QANCDNT
"RTN","QANQUCK",18,0)
KILL K D0,DA,QANADMDT,QANAGE,QANAME,QANCHK,QANCODE,QANDFN,QANDOB,QANDT,QANDUZ
"RTN","QANQUCK",19,0)
 K QANFLAG,QANHOMCD,QANHOME,QANIEN,QANINCR,QANINPAT,QANLTTR,QANOUT
"RTN","QANQUCK",20,0)
 K QANPTAB,QANPID,QANPIEN,QANPSDO,QANSSN,QANSUI,QANDEATH,QANST,QANST1
"RTN","QANQUCK",21,0)
 K QANTRSP,QANTTL,QANWARD,QANXIT,QANZERO,QAQADICT,QAQAFLD,QUES,VAERR,X
"RTN","QANQUCK",22,0)
 K QANPRS,X1,X2,Y,QANCODE,QANBFLG
"RTN","QANQUCK",23,0)
 Q
"RTN","QANQUCK",24,0)
DEL ;
"RTN","QANQUCK",25,0)
 K DIK S DIK="^QA(742.4,",DA=QANIEN W !!,$C(7),"Insufficient data entered for an incident, deleting!!" D ^DIK K DA,DIK S QANXIT=1
"RTN","QANQUCK",26,0)
 Q
"RTN","QANQUCK",27,0)
PAT ;Patient data.
"RTN","QANQUCK",28,0)
 K DIC S DIC="^DPT(",DIC(0)="QEAMNZ",DIC("A")="Select Patient: ",DIC("W")="W "" "",$P(^(0),U,9)",D="B^BS5"
"RTN","QANQUCK",29,0)
 D MIX^DIC1 K DIC S:+Y<1&(QANFLAG) QANOUT=1
"RTN","QANQUCK",30,0)
 D:+Y<1&('QANFLAG) DEL^QANCDNT Q:QANXIT!(QANOUT)
"RTN","QANQUCK",31,0)
 F  D  Q:"-12"[%
"RTN","QANQUCK",32,0)
 . W !?5,$G(Y(0,0))_" OK?"
"RTN","QANQUCK",33,0)
 . S %=1 D YN^DICN Q:"-12"[%
"RTN","QANQUCK",34,0)
 . W " Confirm that this is the correct patient."
"RTN","QANQUCK",35,0)
 D:%=-1&('QANFLAG) DEL^QANQUCK Q:QANXIT!(QANOUT)
"RTN","QANQUCK",36,0)
 I %=-1,(QANFLAG) S QANXIT=1 Q
"RTN","QANQUCK",37,0)
 I %=2 W " ??" G PAT
"RTN","QANQUCK",38,0)
 D PRIOR^QANCDNT I QANXIT D  Q
"RTN","QANQUCK",39,0)
 . I 'QANFLAG K DA,DIK S DA=QANIEN,DIK="^QA(742.4," D ^DIK K DA,DIK
"RTN","QANQUCK",40,0)
 I $D(^UTILITY($J,"QAN PAT",+Y)) W !!,$C(7),$P(^DPT(+Y,0),U)_" has been previously entered for this incident." K Y G PAT
"RTN","QANQUCK",41,0)
 I $D(^DPT(+Y,.35)),$P(^DPT(+Y,.35),U)]"",($P(^DPT(+Y,.35),U)<$P(^QA(742.4,QANIEN,0),U,3)) W !!,$C(7),"The date of death for patient: "_$P(^DPT(+Y,0),U)_" precedes the incident date." K Y G PAT
"RTN","QANQUCK",42,0)
 S QANPIEN=+Y,QANZERO=Y(0),QANAME=Y(0,0),QANSSN=$P(QANZERO,U,9),^UTILITY($J,"QAN PAT",+Y)=""
"RTN","QANQUCK",43,0)
 S QANDOB=$P(^DPT(QANPIEN,0),U,3)
"RTN","QANQUCK",44,0)
 I QANDOB]"" S X=DT,X1=X,X2=QANDOB,X="" D:X2 ^%DTC S X=X\365.25,QANAGE=X
"RTN","QANQUCK",45,0)
 S QANPSDO(0)=Y(0),QANPSDO(0,0)=Y(0,0)
"RTN","QANQUCK",46,0)
 S QANPID=$E($P(Y(0,0),",",2))_$E($P(Y(0,0)," ",2))_$E($P(Y(0,0),","))_$E(QANSSN,6,9)
"RTN","QANQUCK",47,0)
 D ADMDT^QANUTL1
"RTN","QANQUCK",48,0)
 ;L +^QA(742):10 I '$T W !!,"Another user is editing this file." Q
"RTN","QANQUCK",49,0)
 K DIC,DD,DO,DINUM,DLAYGO S DLAYGO=742,DIC="^QA(742,",DIC(0)="L",X=QANPIEN D FILE^DICN K DIC,DD,DO,DINUM,DLAYGO
"RTN","QANQUCK",50,0)
 I +Y=-1,('QANFLAG) D DEL Q
"RTN","QANQUCK",51,0)
 I +Y=-1,(QANFLAG) S QANXIT=1 Q  ;Something is wrong, exit.
"RTN","QANQUCK",52,0)
 S QANDFN=+Y
"RTN","QANQUCK",53,0)
 ;L -^QA(742)
"RTN","QANQUCK",54,0)
 L +^QA(742,QANDFN):10 I '$T W !!,"Another user is editing this patient incident." Q
"RTN","QANQUCK",55,0)
 S $P(^QA(742,QANDFN,0),U,2,6)=QANPID_U_QANIEN_U_QANADMDT_U_QANINPAT_U_QANWARD
"RTN","QANQUCK",56,0)
 S $P(^QA(742,QANDFN,0),U,7)=QANTRSP,$P(^QA(742,QANDFN,0),U,12)=1
"RTN","QANQUCK",57,0)
 S DIK="^QA(742,",DA=QANDFN D IX1^DIK K DA,DIK
"RTN","QANQUCK",58,0)
 I (QANSUI=QANLTTR)!(QANDEATH=QANLTTR)!(QANHOMCD=QANLTTR) K DA,DIE,DR S DIE="^QA(742,",DA=QANDFN,DR=".1///^S X=3" D ^DIE K DA,DIE,DR
"RTN","QANQUCK",59,0)
 I (QANSUI'=QANLTTR),(QANDEATH'=QANLTTR),(QANHOMCD'=QANLTTR) K DA,DIE,DR S DIE="^QA(742,",DR=".1",DA=QANDFN D ^DIE K DA,DIE,DR
"RTN","QANQUCK",60,0)
 L -^QA(742,QANDFN)
"RTN","QANQUCK",61,0)
 S QANFLAG=1
"RTN","QANQUCK",62,0)
 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Open a patient record" D ^QAQAUDIT
"RTN","QANQUCK",63,0)
 Q
"VER")
8.0^22.0
**END**
**END**
