Released TIU*1*176 SEQ #160
Extracted from mail message
**KIDS**:TIU*1.0*176^

**INSTALL NAME**
TIU*1.0*176
"BLD",4655,0)
TIU*1.0*176^TEXT INTEGRATION UTILITIES^0^3040121^y
"BLD",4655,4,0)
^9.64PA^^
"BLD",4655,"KRN",0)
^9.67PA^8989.52^19
"BLD",4655,"KRN",.4,0)
.4
"BLD",4655,"KRN",.401,0)
.401
"BLD",4655,"KRN",.402,0)
.402
"BLD",4655,"KRN",.403,0)
.403
"BLD",4655,"KRN",.5,0)
.5
"BLD",4655,"KRN",.84,0)
.84
"BLD",4655,"KRN",3.6,0)
3.6
"BLD",4655,"KRN",3.8,0)
3.8
"BLD",4655,"KRN",9.2,0)
9.2
"BLD",4655,"KRN",9.8,0)
9.8
"BLD",4655,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",4655,"KRN",9.8,"NM",1,0)
TIUBR1^^0^B62404152
"BLD",4655,"KRN",9.8,"NM",2,0)
TIUSRVR3^^0^B16084172
"BLD",4655,"KRN",9.8,"NM",3,0)
TIUPRPN8^^0^B25768921
"BLD",4655,"KRN",9.8,"NM",4,0)
TIURT^^0^B42873505
"BLD",4655,"KRN",9.8,"NM","B","TIUBR1",1)

"BLD",4655,"KRN",9.8,"NM","B","TIUPRPN8",3)

"BLD",4655,"KRN",9.8,"NM","B","TIURT",4)

"BLD",4655,"KRN",9.8,"NM","B","TIUSRVR3",2)

"BLD",4655,"KRN",19,0)
19
"BLD",4655,"KRN",19,"NM",0)
^9.68A^^
"BLD",4655,"KRN",19.1,0)
19.1
"BLD",4655,"KRN",101,0)
101
"BLD",4655,"KRN",409.61,0)
409.61
"BLD",4655,"KRN",771,0)
771
"BLD",4655,"KRN",870,0)
870
"BLD",4655,"KRN",8989.51,0)
8989.51
"BLD",4655,"KRN",8989.52,0)
8989.52
"BLD",4655,"KRN",8994,0)
8994
"BLD",4655,"KRN","B",.4,.4)

"BLD",4655,"KRN","B",.401,.401)

"BLD",4655,"KRN","B",.402,.402)

"BLD",4655,"KRN","B",.403,.403)

"BLD",4655,"KRN","B",.5,.5)

"BLD",4655,"KRN","B",.84,.84)

"BLD",4655,"KRN","B",3.6,3.6)

"BLD",4655,"KRN","B",3.8,3.8)

"BLD",4655,"KRN","B",9.2,9.2)

"BLD",4655,"KRN","B",9.8,9.8)

"BLD",4655,"KRN","B",19,19)

"BLD",4655,"KRN","B",19.1,19.1)

"BLD",4655,"KRN","B",101,101)

"BLD",4655,"KRN","B",409.61,409.61)

"BLD",4655,"KRN","B",771,771)

"BLD",4655,"KRN","B",870,870)

"BLD",4655,"KRN","B",8989.51,8989.51)

"BLD",4655,"KRN","B",8989.52,8989.52)

"BLD",4655,"KRN","B",8994,8994)

"BLD",4655,"QUES",0)
^9.62^^
"BLD",4655,"REQB",0)
^9.611^1^1
"BLD",4655,"REQB",1,0)
TIU*1.0*123^2
"BLD",4655,"REQB","B","TIU*1.0*123",1)

"MBREQ")
0
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
176^3040121
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","TIUBR1")
0^1^B62404152
"RTN","TIUBR1",1,0)
TIUBR1 ;SLC/JER - Enter TIU Browse with DFN and TIUDA ;8/21/01 [1/21/04 8:09am]
"RTN","TIUBR1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**31,100,123,176**;Jul 20, 1997
"RTN","TIUBR1",3,0)
 ; Move LOADSIG, XTRASIG, LOADFOR, LOADREC from TIUBR. **100**
"RTN","TIUBR1",4,0)
 ;
"RTN","TIUBR1",5,0)
LOADREC(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load ^TMP
"RTN","TIUBR1",6,0)
 ;Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUBR1",7,0)
 ;Optional TIUGWHOL = 1 if we're mid-load for browse, and we're already
"RTN","TIUBR1",8,0)
 ;                    loading the whole note after the selected child,
"RTN","TIUBR1",9,0)
 ;                    so DON'T load the whole note again.
"RTN","TIUBR1",10,0)
 N TIUKID,TIUI,CANSEE,TIUPARNT,TIUPNAME,TIUPDATE
"RTN","TIUBR1",11,0)
 N TIUGPRNT,TIUPDATA,TIUHASKD
"RTN","TIUBR1",12,0)
 S TIUI=0
"RTN","TIUBR1",13,0)
 ; ---- If user cannot view TIUDA, say so,
"RTN","TIUBR1",14,0)
 ;      [load the rest of the ID note], & quit: ----
"RTN","TIUBR1",15,0)
 S CANSEE=$S(+$$ISCOMP^TIUBR(TIUDA)>0:1,1:$$CANDO^TIULP(+TIUDA,"VIEW"))
"RTN","TIUBR1",16,0)
 I +CANSEE'>0 D  Q
"RTN","TIUBR1",17,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",18,0)
 . S @VALMAR@(TIUL,0)=$P(CANSEE,U,2)
"RTN","TIUBR1",19,0)
 . I $P(TIUGDATA,U,2)!$P(TIUGDATA,U,3) D IDREST(TIUDA,.TIUL,TIUGDATA,.TIUGWHOL)
"RTN","TIUBR1",20,0)
 ; ---- Load text of TIUDA: ----
"RTN","TIUBR1",21,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUBR1",22,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",23,0)
 . S @VALMAR@(TIUL,0)=$G(^TIU(8925,+TIUDA,"TEXT",+TIUI,0))
"RTN","TIUBR1",24,0)
 ; ---- If TIUDA is a COMPONENT, QUIT
"RTN","TIUBR1",25,0)
 Q:+$$ISCOMP^TIUBR(TIUDA)
"RTN","TIUBR1",26,0)
 ; ---- If TIUDA **IS** an addendum, load addm signature,
"RTN","TIUBR1",27,0)
 ;         load original document, quit: ----
"RTN","TIUBR1",28,0)
 I +$$ISADDNDM^TIULC1(+TIUDA) D  Q
"RTN","TIUBR1",29,0)
 . N TIULINE S $P(TIULINE,"=",79)=""
"RTN","TIUBR1",30,0)
 . D LOADSIG(TIUDA,.TIUL)
"RTN","TIUBR1",31,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",32,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIULINE
"RTN","TIUBR1",33,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",34,0)
 . S TIUPARNT=+$P(^TIU(8925,+TIUDA,0),U,6)
"RTN","TIUBR1",35,0)
 . S TIUPNAME=$$PNAME^TIULC1(+^TIU(8925,TIUPARNT,0))
"RTN","TIUBR1",36,0)
 . S TIUPDATE=+$G(^TIU(8925,TIUPARNT,13))
"RTN","TIUBR1",37,0)
 . S TIUPDATE=$$DATE^TIULS(TIUPDATE,"MM/DD/YY")
"RTN","TIUBR1",38,0)
 . S TIUPDATA=$$IDDATA^TIURECL1(TIUPARNT)
"RTN","TIUBR1",39,0)
 . S TIUHASKD=$P(TIUPDATA,U,2),TIUGPRNT=+$P(TIUPDATA,U,3)
"RTN","TIUBR1",40,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",41,0)
 . I 'TIUHASKD,'TIUGPRNT D
"RTN","TIUBR1",42,0)
 . . S @VALMAR@(TIUL,0)=" --- Original Document ---"
"RTN","TIUBR1",43,0)
 . . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",44,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",45,0)
 . . S @VALMAR@(TIUL,0)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUBR1",46,0)
 . . D LOADREC(TIUPARNT,.TIUL,TIUGDATA)
"RTN","TIUBR1",47,0)
 . I TIUHASKD D
"RTN","TIUBR1",48,0)
 . . S @VALMAR@(TIUL,0)=" --- Addended Interdisciplinary Note ---"
"RTN","TIUBR1",49,0)
 . . D LOADID^TIUGBR(TIUPARNT,.TIUL,TIUPDATA,1)
"RTN","TIUBR1",50,0)
 . I TIUGPRNT D
"RTN","TIUBR1",51,0)
 . . S @VALMAR@(TIUL,0)=" --- Original Interdisciplinary Entry ---"
"RTN","TIUBR1",52,0)
 . . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",53,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",54,0)
 . . S @VALMAR@(TIUL,0)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUBR1",55,0)
 . . D LOADREC(TIUPARNT,.TIUL,TIUGDATA)
"RTN","TIUBR1",56,0)
 . . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",57,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",58,0)
 . . S @VALMAR@(TIUL,0)=" --- Interdisciplinary Note ---"
"RTN","TIUBR1",59,0)
 . . D LOADID^TIUGBR(TIUGPRNT,.TIUL,TIUPDATA,1)
"RTN","TIUBR1",60,0)
 ; ---- Load components of TIUDA: ----
"RTN","TIUBR1",61,0)
 S TIUKID=0
"RTN","TIUBR1",62,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUBR1",63,0)
 . I +$$ISADDNDM^TIULC1(TIUKID)'>0 D LOADREC(TIUKID,.TIUL,TIUGDATA)
"RTN","TIUBR1",64,0)
 ; ---- Load signature of TIUDA if TIUDA is not addm
"RTN","TIUBR1",65,0)
 ;           or comp: ----
"RTN","TIUBR1",66,0)
 I '$$ISCOMP^TIUBR(TIUDA) D LOADSIG(TIUDA,.TIUL)
"RTN","TIUBR1",67,0)
 ; ---- Load addenda of TIUDA: ----
"RTN","TIUBR1",68,0)
 S TIUKID=0
"RTN","TIUBR1",69,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUBR1",70,0)
 . ; If an addendum has focus, don't show it again unless
"RTN","TIUBR1",71,0)
 . ; loading whole ID note:
"RTN","TIUBR1",72,0)
 . I '$G(TIUGWHOL),+TIUKID=+$G(^TMP("TIU FOCUS",$J)) Q
"RTN","TIUBR1",73,0)
 . I +$$ISADDNDM^TIULC1(TIUKID) D LOADADD^TIUBR(TIUKID,.TIUL)
"RTN","TIUBR1",74,0)
 ; ---- Load the rest of the ID note display: ----
"RTN","TIUBR1",75,0)
 I $P(TIUGDATA,U,2)!$P(TIUGDATA,U,3) D IDREST(TIUDA,.TIUL,TIUGDATA,.TIUGWHOL)
"RTN","TIUBR1",76,0)
 Q
"RTN","TIUBR1",77,0)
 ;
"RTN","TIUBR1",78,0)
IDREST(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load rest of ID note display
"RTN","TIUBR1",79,0)
 N IDDAD
"RTN","TIUBR1",80,0)
 S IDDAD=+$P(TIUGDATA,U,3)
"RTN","TIUBR1",81,0)
 ; ---- If Browsed Record is an ID child, & this cycle hasn't begun
"RTN","TIUBR1",82,0)
 ;      loading the whole note, then load the whole ID Note after
"RTN","TIUBR1",83,0)
 ;      the browsed child: ----
"RTN","TIUBR1",84,0)
 I IDDAD,'$G(TIUGWHOL) D  Q
"RTN","TIUBR1",85,0)
 . S TIUGWHOL=1
"RTN","TIUBR1",86,0)
 . N TIULINE S $P(TIULINE,"=",79)=""
"RTN","TIUBR1",87,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",88,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIULINE
"RTN","TIUBR1",89,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",90,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" --- Interdisciplinary Note ---"
"RTN","TIUBR1",91,0)
 . D LOADID^TIUGBR(IDDAD,.TIUL,TIUGDATA,TIUGWHOL)
"RTN","TIUBR1",92,0)
 ; ---- If Browsed Record is an ID parent, & this cycle has
"RTN","TIUBR1",93,0)
 ;      just loaded the parent entry, OR
"RTN","TIUBR1",94,0)
 ;      If Browsed Record is an ID child, & this cycle has begun
"RTN","TIUBR1",95,0)
 ;      loading the whole ID note, and is currently loading the first
"RTN","TIUBR1",96,0)
 ;      entry of the whole note,
"RTN","TIUBR1",97,0)
 ;      Then load kids: ----
"RTN","TIUBR1",98,0)
 I $P(TIUGDATA,U,2)&(TIUDA=+TIUGDATA)!(IDDAD&$G(TIUGWHOL)&(TIUDA=IDDAD)) D
"RTN","TIUBR1",99,0)
 . D LOADKIDS^TIUBR(TIUDA,.TIUL,TIUGDATA,$G(TIUGWHOL)) K TIUGWHOL
"RTN","TIUBR1",100,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",101,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="                      << Interdisciplinary Note - End >>"
"RTN","TIUBR1",102,0)
 Q
"RTN","TIUBR1",103,0)
EXSTNOTE(DFN,TIUDA) ; Sample/display existing notes
"RTN","TIUBR1",104,0)
 N TIU,TIUPRM0,TIUPRM1,TIUSEE,TIUOUT,TIUY,TIUQUIT
"RTN","TIUBR1",105,0)
 D SETPARM^TIULE
"RTN","TIUBR1",106,0)
 Q:TIUDA'>0
"RTN","TIUBR1",107,0)
 D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUBR1",108,0)
 I $D(TIU) D
"RTN","TIUBR1",109,0)
 . S TIUSEE=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUBR1",110,0)
 . I 'TIUSEE D  Q
"RTN","TIUBR1",111,0)
 . . W !!,$C(7),$P(TIUSEE,U,2),!
"RTN","TIUBR1",112,0)
 . . W:$$READ^TIUU("FOA","Press RETURN to continue...") ""
"RTN","TIUBR1",113,0)
 . D EN^VALM("TIU BROWSE FOR CLINICIAN")
"RTN","TIUBR1",114,0)
 . K ^TMP("TIUVIEW",$J)
"RTN","TIUBR1",115,0)
 . S:$D(TIUQUIT) TIUOUT=1
"RTN","TIUBR1",116,0)
 Q
"RTN","TIUBR1",117,0)
 ;
"RTN","TIUBR1",118,0)
LOADSIG(DA,TIUL) ; Get signature and co-signature blocks
"RTN","TIUBR1",119,0)
 N DIC,DIQ,DR,TIUSIG,TIUESIG1,TIUESIG2,TIUSIG1,TIUSIG2,TIUS1,TIUS2
"RTN","TIUBR1",120,0)
 N TIUSNM,TIUSTTL,TIUS1DT,TIUS2DT,TIUSDT
"RTN","TIUBR1",121,0)
 Q:'$D(^TIU(8925,DA,15))
"RTN","TIUBR1",122,0)
 S DIC=8925,DIQ="TIUSIG(",DIQ(0)="IE",DR="1204;1208;1501:1505;1507:1513;1601:1605"
"RTN","TIUBR1",123,0)
 D EN^DIQ1 I '$D(TIUSIG) Q
"RTN","TIUBR1",124,0)
 S TIUS1=$S(TIUSIG(8925,DA,1505,"I")="E":"/es/ ",TIUSIG(8925,DA,1505,"I")="C":"/s/ ",1:"")_$G(TIUSIG(8925,DA,1503,"E"))
"RTN","TIUBR1",125,0)
 S TIUS2=$S(TIUSIG(8925,DA,1511,"I")="E":"/es/ ",TIUSIG(8925,DA,1511,"I")="C":"/s/ ",1:"")_$G(TIUSIG(8925,DA,1509,"E"))
"RTN","TIUBR1",126,0)
 S TIUESIG1=$G(TIUSIG(8925,DA,1204,"I"))
"RTN","TIUBR1",127,0)
 S TIUSIG1=$G(TIUSIG(8925,DA,1502,"I"))
"RTN","TIUBR1",128,0)
 S TIUS1DT=$S(+$G(TIUSIG(8925,DA,1501,"I")):"Signed: "_$$DATE^TIULS($G(TIUSIG(8925,DA,1501,"I")),"MM/DD/CCYY HR:MIN"),1:"")
"RTN","TIUBR1",129,0)
 S TIUESIG2=$G(TIUSIG(8925,DA,1208,"I"))
"RTN","TIUBR1",130,0)
 S TIUS2DT=$S(+$G(TIUSIG(8925,DA,1507,"I")):"Cosigned: "_$$DATE^TIULS($G(TIUSIG(8925,DA,1507,"I")),"MM/DD/CCYY HR:MIN"),1:"")
"RTN","TIUBR1",131,0)
 S TIUSIG2=$G(TIUSIG(8925,DA,1508,"I"))
"RTN","TIUBR1",132,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR1",133,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUS1
"RTN","TIUBR1",134,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=$G(TIUSIG(8925,DA,1504,"E"))
"RTN","TIUBR1",135,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUS1DT
"RTN","TIUBR1",136,0)
 I $G(TIUSIG(8925,DA,1505,"I"))="C" D
"RTN","TIUBR1",137,0)
 . N TIUONCH
"RTN","TIUBR1",138,0)
 . S TIUONCH=$G(TIUSIG(8925,DA,1512,"E")) I '$L(TIUONCH) S TIUONCH=$G(TIUSIG(8925,DA,1513,"E"))
"RTN","TIUBR1",139,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="Marked signed on chart by: "_TIUONCH
"RTN","TIUBR1",140,0)
 I TIUSIG1]"",(TIUSIG1'=TIUESIG1) D LOADFOR(TIUSIG1,TIUESIG1,.TIUL)
"RTN","TIUBR1",141,0)
 I +$G(TIUSIG(8925,DA,1507,"I"))>0 D
"RTN","TIUBR1",142,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR1",143,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUS2
"RTN","TIUBR1",144,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=$G(TIUSIG(8925,DA,1510,"E"))
"RTN","TIUBR1",145,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUS2DT
"RTN","TIUBR1",146,0)
 . I $G(TIUSIG(8925,DA,1511,"I"))="C" D
"RTN","TIUBR1",147,0)
 . . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="Marked cosigned on chart by: "_$G(TIUSIG(8925,DA,1513,"E"))
"RTN","TIUBR1",148,0)
 I TIUSIG2]"",(TIUSIG2'=TIUESIG2) D LOADFOR(TIUSIG2,TIUESIG2,.TIUL)
"RTN","TIUBR1",149,0)
XTRA I +$O(^TIU(8925.7,"B",DA,0)) D XTRASIG(DA,.TIUL)
"RTN","TIUBR1",150,0)
 I +$G(TIUSIG(8925,DA,1601,"I")) D
"RTN","TIUBR1",151,0)
 . N TIUMODE
"RTN","TIUBR1",152,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",153,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",154,0)
 . S @VALMAR@(TIUL,0)=$$DATE^TIULS(TIUSIG(8925,DA,1601,"I"),"MM/DD/CCYY HR:MIN")_"  AMENDMENT FILED:"
"RTN","TIUBR1",155,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="",TIUL=+$G(TIUL)+1
"RTN","TIUBR1",156,0)
 . S TIUMODE=$S(+$G(TIUSIG(8925,DA,1603,"I")):"/es/ ",1:" /s/ ")
"RTN","TIUBR1",157,0)
 . S @VALMAR@(TIUL,0)=TIUMODE_$S($G(TIUSIG(8925,DA,1604,"E"))]"":$G(TIUSIG(8925,DA,1604,"E")),1:$G(TIUSIG(8925,DA,1602,"E")))
"RTN","TIUBR1",158,0)
 . I $L($G(TIUSIG(8925,DA,1605,"E"))) D
"RTN","TIUBR1",159,0)
 . . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=$G(TIUSIG(8925,DA,1605,"E"))
"RTN","TIUBR1",160,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=$P($G(TIUPRM1),U,5)
"RTN","TIUBR1",161,0)
 Q
"RTN","TIUBR1",162,0)
XTRASIG(TIUDA,TIUL) ; Load additional signature blocks
"RTN","TIUBR1",163,0)
 N TIUI,DA,DR,DIC,DIQ,TIUXTRA S TIUI=0
"RTN","TIUBR1",164,0)
 S DIC="^TIU(8925.7,",DIQ="TIUXTRA"
"RTN","TIUBR1",165,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR1",166,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="Receipt Acknowledged By:"
"RTN","TIUBR1",167,0)
 F  S TIUI=$O(^TIU(8925.7,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUBR1",168,0)
 . N TIUX,TIUSGNR,TIUSDT
"RTN","TIUBR1",169,0)
 . S DA=TIUI,DR=".03:.08",DIQ(0)="IE" D EN^DIQ1 Q:+$D(TIUXTRA)'>9
"RTN","TIUBR1",170,0)
 . S TIUSGNR=$S($L($G(TIUXTRA(8925.7,DA,.06,"E"))):"/es/ "_$G(TIUXTRA(8925.7,DA,.06,"E")),1:"     "_$G(TIUXTRA(8925.7,DA,.03,"E")))
"RTN","TIUBR1",171,0)
 . S TIUSDT=$S(+$G(TIUXTRA(8925.7,DA,.04,"I")):$$DATE^TIULS(TIUXTRA(8925.7,DA,.04,"I"),"MM/DD/CCYY HR:MIN"),1:"* AWAITING SIGNATURE *")
"RTN","TIUBR1",172,0)
 . S TIUX=$$SETSTR^VALM1(TIUSDT,$G(TIUX),1,38)
"RTN","TIUBR1",173,0)
 . S TIUX=$$SETSTR^VALM1(TIUSGNR,$G(TIUX),25,55)
"RTN","TIUBR1",174,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUX,TIUX=""
"RTN","TIUBR1",175,0)
 . S TIUX=$$SETSTR^VALM1($G(TIUXTRA(8925.7,DA,.07,"E")),$G(TIUX),30,50)
"RTN","TIUBR1",176,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUX
"RTN","TIUBR1",177,0)
 Q
"RTN","TIUBR1",178,0)
LOADFOR(TIUS1,TIUES1,TIUL) ; Apply "for" block
"RTN","TIUBR1",179,0)
 N TIUESN1,TIUEST1,TIUFORN,TIUFORT
"RTN","TIUBR1",180,0)
 S TIUESN1="for "_$$SIGNAME^TIULS(TIUES1),TIUEST1=$$SIGTITL^TIULS(TIUES1)
"RTN","TIUBR1",181,0)
 I +$G(TIUS1),($G(TIUS1)'=$G(TIUES1)) S TIUFORN=$$SETSTR^VALM1(TIUESN1,$G(TIUFORN),1,50),TIUFORT=$$SETSTR^VALM1(TIUEST1,$G(TIUFORT),1,50)
"RTN","TIUBR1",182,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUFORN
"RTN","TIUBR1",183,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUFORT
"RTN","TIUBR1",184,0)
 Q
"RTN","TIUPRPN8")
0^3^B25768921
"RTN","TIUPRPN8",1,0)
TIUPRPN8 ;SLC/MAM - Print SF 509-Progress Notes, Cont ;1/24/01 [10/14/03 1:52pm]
"RTN","TIUPRPN8",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,176**;Jun 20, 1997
"RTN","TIUPRPN8",3,0)
 ; 10/00 New rtn, created by moving SIGBLK here from TIUPRPN1
"RTN","TIUPRPN8",4,0)
 ;
"RTN","TIUPRPN8",5,0)
SIGBLK(TIUFOOT,TIUMISC,TIUCONT1,TIUCONT,TIUSIG,TIUROOT) ; Print signature block info
"RTN","TIUPRPN8",6,0)
 ; Requires array TIUFOOT, requires TIUMISC
"RTN","TIUPRPN8",7,0)
 ; Requires TIUCONT1
"RTN","TIUPRPN8",8,0)
 ; Receives TIUCONT by ref (req'd)
"RTN","TIUPRPN8",9,0)
 ; Receives array TIUSIG by ref, required.
"RTN","TIUPRPN8",10,0)
 ; Requires TIUROOT
"RTN","TIUPRPN8",11,0)
 N TIUDA,TIUFLAG
"RTN","TIUPRPN8",12,0)
 S TIUCONT=1,TIUDA=$P(TIUMISC,U,3),TIUFLAG=$P(TIUMISC,U)
"RTN","TIUPRPN8",13,0)
 ;S TIUGROOT=$NA(^TMP("TIULQ",$J,TIUDA))
"RTN","TIUPRPN8",14,0)
 I '+TIUSIG("SIGNDATE") D  Q:'TIUCONT
"RTN","TIUPRPN8",15,0)
 . W "**DRAFT COPY - DRAFT COPY -- ABOVE NOTE IS UNSIGNED--"
"RTN","TIUPRPN8",16,0)
 . W " DRAFT COPY - DRAFT COPY**",!
"RTN","TIUPRPN8",17,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT))
"RTN","TIUPRPN8",18,0)
 ;I TIUSIG("SIGNEDBY")]"",(+TIUSIG("SIGNEDBY")'=+TIUSIG("AUTHOR"))  D
"RTN","TIUPRPN8",19,0)
 ;. W ?21,"Author:      ",$P(TIUSIG("AUTHOR"),";",2),!
"RTN","TIUPRPN8",20,0)
 I +TIUSIG("SIGNDATE") D  Q:'TIUCONT
"RTN","TIUPRPN8",21,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",22,0)
 . W ?18,"Signed by:",$S($P(TIUSIG("SIGNMODE"),";")="C":" /s/  ",1:" /es/ "),?34,$S(TIUSIG("SIGNNAME")]"":TIUSIG("SIGNNAME"),1:$P(TIUSIG("SIGNEDBY"),";",2))
"RTN","TIUPRPN8",23,0)
 . I $L(TIUSIG("SIGTITL"))>45 D
"RTN","TIUPRPN8",24,0)
 . . N TIUFT
"RTN","TIUPRPN8",25,0)
 . . D WRAP^TIUFLD(TIUSIG("SIGTITL"),45)
"RTN","TIUPRPN8",26,0)
 . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",27,0)
 . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",28,0)
 . I $L(TIUSIG("SIGTITL"))<46,TIUSIG("SIGTITL")]"" W !?34,TIUSIG("SIGTITL")
"RTN","TIUPRPN8",29,0)
 . W !?34,$$DATE^TIULS(+TIUSIG("SIGNDATE"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",30,0)
 . I '+$G(TIUFLAG)!($E(IOST)="C") D
"RTN","TIUPRPN8",31,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U) W !?34,"Analog Pager: ",$P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U)
"RTN","TIUPRPN8",32,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U,2) W !?34,"Digital Pager: ",$P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U,2)
"RTN","TIUPRPN8",33,0)
 I $P(TIUSIG("SIGNMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",34,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",35,0)
 . N TIUONCH
"RTN","TIUPRPN8",36,0)
 . S TIUONCH=$P(TIUSIG("SIGCHRT"),";",2)
"RTN","TIUPRPN8",37,0)
 . I TIUONCH']"" S TIUONCH=$P(TIUSIG("COSCHRT"),";",2)
"RTN","TIUPRPN8",38,0)
 . W !?2,"Marked signed on chart by:",?34,$G(TIUONCH)
"RTN","TIUPRPN8",39,0)
 I TIUSIG("SIGNEDBY")]"",(+TIUSIG("SIGNEDBY")'=+TIUSIG("AUTHOR"))  D
"RTN","TIUPRPN8",40,0)
 . N TIUSIGTL
"RTN","TIUPRPN8",41,0)
 . W !?34,"for ",$P(TIUSIG("AUTHOR"),";",2)
"RTN","TIUPRPN8",42,0)
 . S TIUSIGTL=$$GET1^DIQ(200,$P(TIUSIG("AUTHOR"),";",1),20.3)
"RTN","TIUPRPN8",43,0)
 . I $D(TIUSIGTL) D
"RTN","TIUPRPN8",44,0)
 . . N TIUFT
"RTN","TIUPRPN8",45,0)
 . . D WRAP^TIUFLD(TIUSIGTL,45)
"RTN","TIUPRPN8",46,0)
 . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",47,0)
 . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",48,0)
 I $G(@TIUROOT@(.05,"E"))="UNCOSIGNED" D
"RTN","TIUPRPN8",49,0)
 . W !?34,"**REQUIRES COSIGNATURE**",!
"RTN","TIUPRPN8",50,0)
 ;I +$G(TIUADD) S TIUGROOT=$NA(^TMP("TIULQ",$J,TIUDA,"ZADD",TIUADD))
"RTN","TIUPRPN8",51,0)
 I +$D(@TIUROOT@("EXTRASGNR")) D  Q:'TIUCONT  ;**100** added the quit
"RTN","TIUPRPN8",52,0)
 . N TIUI S TIUI=0
"RTN","TIUPRPN8",53,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",54,0)
 . W !?4,"Receipt Acknowledged By:"
"RTN","TIUPRPN8",55,0)
 . F  S TIUI=$O(@TIUROOT@("EXTRASGNR",TIUI)) Q:'TIUI  D
"RTN","TIUPRPN8",56,0)
 . . I +$G(@TIUROOT@("EXTRASGNR",TIUI,"DATE"))'>0 Q
"RTN","TIUPRPN8",57,0)
 . . I TIUI>1 S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",58,0)
 . . W !?29,"/es/ ",$G(@TIUROOT@("EXTRASGNR",TIUI,"NAME"))
"RTN","TIUPRPN8",59,0)
 . . I $L($G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE")))>45 D
"RTN","TIUPRPN8",60,0)
 . . . N TIUFT
"RTN","TIUPRPN8",61,0)
 . . . D WRAP^TIUFLD($G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE")),45)
"RTN","TIUPRPN8",62,0)
 . . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",63,0)
 . . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",64,0)
 . . I $L($G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE")))<46 W !?34,$G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE"))
"RTN","TIUPRPN8",65,0)
 . . W !?34,$$DATE^TIULS($G(@TIUROOT@("EXTRASGNR",TIUI,"DATE")),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",66,0)
 . . I '+$G(TIUFLAG)!($E(IOST)="C") D
"RTN","TIUPRPN8",67,0)
 . . . N BEEP
"RTN","TIUPRPN8",68,0)
 . . . S BEEP=$$BEEP^TIULC1(+$G(@TIUROOT@("EXTRASGNR",TIUI,"EXTRA")))
"RTN","TIUPRPN8",69,0)
 . . . I +BEEP W !?34,"Analog Pager:  ",$P(BEEP,U)
"RTN","TIUPRPN8",70,0)
 . . . I +$P(BEEP,U,2) W !?34,"Digital Pager: ",$P(BEEP,U,2)
"RTN","TIUPRPN8",71,0)
 . ;K @TIUROOT@("EXTRASGNR") ;**100** commented out
"RTN","TIUPRPN8",72,0)
 ;I +TIUSIG("COSGDATE"),(+TIUSIG("COSGEDBY")'=+TIUSIG("SIGNEDBY")) D  Q:'TIUCONT
"RTN","TIUPRPN8",73,0)
 I +TIUSIG("COSGDATE") D  Q:'TIUCONT
"RTN","TIUPRPN8",74,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",75,0)
 . W !!?16,"Cosigned by:",$S($P(TIUSIG("COSGMODE"),";")="C":" /s/  ",1:" /es/ "),?34,$S(TIUSIG("COSGNAME")]"":TIUSIG("COSGNAME"),1:$P(TIUSIG("COSGEDBY"),";",2))
"RTN","TIUPRPN8",76,0)
 . I $L(TIUSIG("COSGTITL"))>45 D
"RTN","TIUPRPN8",77,0)
 . . N TIUFT
"RTN","TIUPRPN8",78,0)
 . . D WRAP^TIUFLD(TIUSIG("COSGTITL"),45)
"RTN","TIUPRPN8",79,0)
 . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",80,0)
 . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",81,0)
 . I $L(TIUSIG("COSGTITL"))<46 W !?34,TIUSIG("COSGTITL")
"RTN","TIUPRPN8",82,0)
 . W !?34,$$DATE^TIULS(+TIUSIG("COSGDATE"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",83,0)
 . I '+$G(TIUFLAG)!($E(IOST)="C") D
"RTN","TIUPRPN8",84,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U) W !?34,"Analog Pager: ",$P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U)
"RTN","TIUPRPN8",85,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U,2) W !?34,"Digital Pager: ",$P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U,2)
"RTN","TIUPRPN8",86,0)
 ;I +TIUSIG("COSCHRT"),$P(TIUSIG("COSGMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",87,0)
 I $P(TIUSIG("COSGMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",88,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",89,0)
 . W !,"Marked cosigned on chart by:",?34,$P(TIUSIG("COSCHRT"),";",2)
"RTN","TIUPRPN8",90,0)
 W !
"RTN","TIUPRPN8",91,0)
 ;K TIUCONT1 ; kills the cont on next page msgs since no longer in middle
"RTN","TIUPRPN8",92,0)
 ;of a note.  **100** moved down to amend code
"RTN","TIUPRPN8",93,0)
AMEND ; signature blocks of amender
"RTN","TIUPRPN8",94,0)
 ;N TIUY S TIUY=4 ;I don't think we need TIUY anymore **100**
"RTN","TIUPRPN8",95,0)
 I '$G(@TIUROOT@(1601,"I")) K TIUCONT1 Q
"RTN","TIUPRPN8",96,0)
 S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT))
"RTN","TIUPRPN8",97,0)
 K TIUCONT1 Q:'TIUCONT
"RTN","TIUPRPN8",98,0)
 I +$G(@TIUROOT@(1601,"I")) D
"RTN","TIUPRPN8",99,0)
 . W !!?12,"Amendment Filed:",?34,$$DATE^TIULS(@TIUROOT@(1601,"I"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",100,0)
 . I $G(@TIUROOT@(1603,"E"))']"" D
"RTN","TIUPRPN8",101,0)
 . . W !!?29 F TIUI=1:1:40 W "_"
"RTN","TIUPRPN8",102,0)
 . . W !?29,$$SIGNAME^TIULS(@TIUROOT@(1602,"I"))
"RTN","TIUPRPN8",103,0)
 . . W !?29,$$SIGTITL^TIULS(@TIUROOT@(1602,"I"))
"RTN","TIUPRPN8",104,0)
 . I $G(@TIUROOT@(1604,"E"))]"" D
"RTN","TIUPRPN8",105,0)
 . . W !?29,"/es/",?34,@TIUROOT@(1604,"E")
"RTN","TIUPRPN8",106,0)
 . . W !?34,@TIUROOT@(1605,"E")
"RTN","TIUPRPN8",107,0)
 Q
"RTN","TIUPRPN8",108,0)
 ;
"RTN","TIURT")
0^4^B42873505
"RTN","TIURT",1,0)
TIURT ; SLC/JER,MAM - Sign On Chart, etc. ;14-MAR-2001 09:52:41 [1/5/04 11:30am]
"RTN","TIURT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**71,58,100,176**;Jun 20, 1997
"RTN","TIURT",3,0)
SIGNCHRT ; Mark signed on chart
"RTN","TIURT",4,0)
 N TIUCHNG,TIUI,TIUY,Y,DIROUT
"RTN","TIURT",5,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURT",6,0)
 S TIUI=0
"RTN","TIURT",7,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURT",8,0)
 . N TIU,DFN,TIUDA,TIUDATA,RSTRCTD
"RTN","TIURT",9,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURT",10,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURT",11,0)
 . I RSTRCTD D  Q
"RTN","TIURT",12,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURT",13,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURT",14,0)
 . D EN^VALM("TIU SIGN ON CHART")
"RTN","TIURT",15,0)
 ; -- Update or Rebuild list: --
"RTN","TIURT",16,0)
 S TIUCHNG("UPDATE")=1
"RTN","TIURT",17,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURT",18,0)
 S VALMBCK="R"
"RTN","TIURT",19,0)
 Q
"RTN","TIURT",20,0)
SIGCHRT1(TIUDA) ; Single record sign on chart
"RTN","TIURT",21,0)
 N SIGMSG D FULL^VALM1
"RTN","TIURT",22,0)
 D OC(TIUDA,.SIGMSG)
"RTN","TIURT",23,0)
 W !,$G(SIGMSG(1)),!,$G(SIGMSG(2)),! H $S($D(SIGMSG(0)):+SIGMSG(0),1:3)
"RTN","TIURT",24,0)
 Q
"RTN","TIURT",25,0)
OC(DA,MSG) ; Mark signed on chart. Edit on-chart signatures.
"RTN","TIURT",26,0)
 N SIGNER,DIE,DR,Y,TIUSTAT,COSIGNER,TIUDA,COSMODE,SIGMODE
"RTN","TIURT",27,0)
 N SIGNAME,COSNAME,SIGTITL,COSTITL,TIU0,TIU12,TIU15,TIU16
"RTN","TIURT",28,0)
 N TIUSFLDS,TIUCFLDS,TIUPSIG,NTIU15
"RTN","TIURT",29,0)
 S MSG=$$READ^TIUU("YO","Mark this Document 'Signed on chart'/Edit Marked Signature(s)","NO","^D OCSIG^TIUDIRH") ; P71 wording
"RTN","TIURT",30,0)
 I 'MSG S TIUCHNG=0 G OCX
"RTN","TIURT",31,0)
 S TIUCHNG=1
"RTN","TIURT",32,0)
 S TIU0=$G(^TIU(8925,+DA,0)),TIU12=$G(^(12)),TIU15=$G(^(15))
"RTN","TIURT",33,0)
 S SIGNER=$$PERSNAME^TIULC1(+$P(TIU12,U,4))
"RTN","TIURT",34,0)
 S COSIGNER=$$PERSNAME^TIULC1(+$P(TIU12,U,8))
"RTN","TIURT",35,0)
 S SIGMODE=$P(TIU15,U,5),COSMODE=$P(TIU15,U,11)
"RTN","TIURT",36,0)
 S TIUSTAT=$$STATUS^TIULC(DA)
"RTN","TIURT",37,0)
 ; P71. Input transform kills null Sig Blk Title but accepts @
"RTN","TIURT",38,0)
 S TIUSFLDS="1501//NOW;1502//"_SIGNER_";S SIGNAME=$$SIGNAME^TIULS(X),SIGTITL=$$SIGTITL^TIULS(X) S:SIGTITL="""" SIGTITL=""@"";1503///^S X=SIGNAME;1504///^S X=SIGTITL;1505////C" ; user edit Signature flds
"RTN","TIURT",39,0)
 S TIUCFLDS="1507//NOW;1508//"_COSIGNER_";S COSNAME=$$SIGNAME^TIULS(X),COSTITL=$$SIGTITL^TIULS(X) S:COSTITL="""" COSTITL=""@"";1509///^S X=COSNAME;1510///^S X=COSTITL;1511////C" ; user edit Co-signature flds
"RTN","TIURT",40,0)
 I TIUSTAT="completed",(SIGMODE="C") S DR=TIUSFLDS ; user edit sig
"RTN","TIURT",41,0)
 I TIUSTAT="completed"&(COSMODE="C") S DR=TIUCFLDS ; user edit co-sig
"RTN","TIURT",42,0)
 I TIUSTAT="uncosigned"&(SIGMODE'="C") S DR=TIUCFLDS ; new co-signature
"RTN","TIURT",43,0)
 I $S(TIUSTAT="unsigned":1,COSMODE="C"&(SIGMODE="C"):1,SIGMODE="C"&(TIUSTAT="uncosigned"):1,1:0) D
"RTN","TIURT",44,0)
 . N TIUWHO
"RTN","TIURT",45,0)
 . I (COSIGNER]""),(SIGNER'=COSIGNER) S TIUWHO=$P($$READ^TIUU("SO^S:signer;C:cosigner;B:both","Which signatures are on chart?","both"),U)
"RTN","TIURT",46,0)
 . E  S TIUWHO="S"
"RTN","TIURT",47,0)
 . ; TIUWHO=S if expsigner=expcosigner or if there is no expcosigner,
"RTN","TIURT",48,0)
 . ; or if user answered S.
"RTN","TIURT",49,0)
 . I $S('$L(TIUWHO):1,"SCB"'[$P(TIUWHO,U):1,1:0) Q
"RTN","TIURT",50,0)
 . I TIUWHO="S" S DR=TIUSFLDS
"RTN","TIURT",51,0)
 . I TIUWHO="C" S DR=TIUCFLDS_";1513////"_DUZ
"RTN","TIURT",52,0)
 . I TIUWHO="B" S DR=TIUSFLDS_";"_TIUCFLDS_";1513////"_DUZ
"RTN","TIURT",53,0)
 I TIUSTAT="uncosigned" S DR=DR_";1513////"_DUZ
"RTN","TIURT",54,0)
 I $D(DR) S DR=DR_";1512////"_DUZ
"RTN","TIURT",55,0)
 I '$D(DR) D  G OCX
"RTN","TIURT",56,0)
 . S MSG(1)="  No signatures available to mark 'Signed on chart' or edit"
"RTN","TIURT",57,0)
 . S TIU16=$G(^TIU(8925,DA,16))
"RTN","TIURT",58,0)
 . I (TIUSTAT="amended"),'$P(TIU16,U,3) S MSG(1)="  'Chart' amendment signatures are automatic; can't edit",MSG(0)="5HANG"
"RTN","TIURT",59,0)
 S DIE=8925 D ^DIE S NTIU15=$G(^TIU(8925,+DA,15))
"RTN","TIURT",60,0)
 D OCDELETE(DA,TIU15,.NTIU15,.MSG)
"RTN","TIURT",61,0)
 ; If user left docmt co-signed but not signed, then stuff signer
"RTN","TIURT",62,0)
 ; with cosigner data (and P71 - avoid ^(15)):
"RTN","TIURT",63,0)
 I $P(NTIU15,U,7),'$P(NTIU15,U) D STUFFSIG(DA,.NTIU15)
"RTN","TIURT",64,0)
 ; P71 If user left docmt signed but uncosigned, and entered expected 
"RTN","TIURT",65,0)
 ; cosigner for signer, then stuff cosigner with signer data:
"RTN","TIURT",66,0)
 I $P(NTIU15,U),'$P(NTIU15,U,7),$P(NTIU15,U,2)=$P(TIU12,U,8) D STUFFCOS(DA,.NTIU15)
"RTN","TIURT",67,0)
 S TIUDA=DA D UPDATE^TIUU
"RTN","TIURT",68,0)
 ; P71 Do alert AFTER status update so alert to cosigner=signer is
"RTN","TIURT",69,0)
 ; deleted if complete:
"RTN","TIURT",70,0)
 S DR=".05///"_$$STATUS^TIULC(+DA),DIE=8925 D ^DIE
"RTN","TIURT",71,0)
 S TIU0=$G(^TIU(8925,DA,0))
"RTN","TIURT",72,0)
 D SEND^TIUALRT(+DA)
"RTN","TIURT",73,0)
 D SIGNIRT^TIUDIRT(+DA)
"RTN","TIURT",74,0)
 ; post-signature action
"RTN","TIURT",75,0)
 S TIUPSIG=$$POSTSIGN^TIULC1(+TIU0)
"RTN","TIURT",76,0)
 I +$L(TIUPSIG),(+$P(TIU0,U,5)>6) X TIUPSIG
"RTN","TIURT",77,0)
OCX I $D(MSG)<10 S MSG(1)="  On chart signature data NOT changed."
"RTN","TIURT",78,0)
 Q
"RTN","TIURT",79,0)
 ;
"RTN","TIURT",80,0)
OCDELETE(DA,TIU15,NTIU15,MSG) ; Clean up data if signers/dates deleted or
"RTN","TIURT",81,0)
 ;                         partially deleted
"RTN","TIURT",82,0)
 N TIUSFLDS,TIUCFLDS,DR,DIE,X,Y
"RTN","TIURT",83,0)
 S TIUSFLDS="1501///@;1502///@;1503///@;1504///@;1505///@"
"RTN","TIURT",84,0)
 S TIUCFLDS="1507///@;1508///@;1509///@;1510///@;1511///@"
"RTN","TIURT",85,0)
 D  ; If user altered sign flds and they are deleted or partially
"RTN","TIURT",86,0)
 . ;  deleted, then delete sign flds:
"RTN","TIURT",87,0)
 . I $P(NTIU15,U)=$P(TIU15,U),$P(NTIU15,U,2)=$P(TIU15,U,2) Q
"RTN","TIURT",88,0)
 . S MSG(1)=$S($P(NTIU15,U)&'$P(TIU15,U):"  Marked 'Signed on chart'",1:"  On chart signature edited")
"RTN","TIURT",89,0)
 . I $P(NTIU15,U)=""!($P(NTIU15,U,2)="") D
"RTN","TIURT",90,0)
 . . S DR=TIUSFLDS,DIE=8925 D ^DIE S NTIU15=$G(^TIU(8925,+DA,15))
"RTN","TIURT",91,0)
 . . S MSG(1)=$S('(($P(NTIU15,U)="")&($P(NTIU15,U,2)="")):"  Incomplete on chart signature. Deleted.",1:"  On chart signature deleted.")
"RTN","TIURT",92,0)
 D  ; If user altered co-sign flds and they are deleted or partially
"RTN","TIURT",93,0)
 . ;  deleted, then delete co-sign flds:
"RTN","TIURT",94,0)
 . I $P(NTIU15,U,7)=$P(TIU15,U,7),$P(NTIU15,U,8)=$P(TIU15,U,8) Q
"RTN","TIURT",95,0)
 . S MSG(2)=$S($P(NTIU15,U,7)&'$P(TIU15,U,8):"  Marked 'Cosigned on chart'",1:"  On chart co-signature edited")
"RTN","TIURT",96,0)
 . I $P(NTIU15,U,7)=""!($P(NTIU15,U,8)="") D
"RTN","TIURT",97,0)
 . . S DR=TIUCFLDS,DIE=8925 D ^DIE S NTIU15=$G(^TIU(8925,+DA,15))
"RTN","TIURT",98,0)
 . . S MSG(2)=$S('(($P(NTIU15,U,7)="")&($P(NTIU15,U,8)="")):"  Incomplete on chart co-signature. Deleted.",1:"  On chart co-signature deleted.")
"RTN","TIURT",99,0)
 D  ; If user deleted sign flds, but docmt is cosigned, then
"RTN","TIURT",100,0)
 . ;  stuff sign data with co-sign data:
"RTN","TIURT",101,0)
 . I $P(NTIU15,U)=$P(TIU15,U),$P(NTIU15,U,2)=$P(TIU15,U,2) Q
"RTN","TIURT",102,0)
 . I $P(NTIU15,U)="",$P(NTIU15,U,7)'="" D STUFFSIG(DA,.NTIU15) S MSG(1)="  On chart signer deleted, auto-replaced with cosigner.",MSG(0)="4HANG"
"RTN","TIURT",103,0)
 D  ; If user deleted co-sign flds, and docmt is signed, and
"RTN","TIURT",104,0)
 . ;           signer = deleted cosigner, then delete sign flds:
"RTN","TIURT",105,0)
 . I $P(NTIU15,U,7)=$P(TIU15,U,7),$P(NTIU15,U,8)=$P(TIU15,U,8) Q
"RTN","TIURT",106,0)
 . I $P(NTIU15,U,7)="",$P(NTIU15,U),$P(NTIU15,U,2)=$P(TIU15,U,8) S DR=TIUSFLDS,DIE=8925 D ^DIE S NTIU15=$G(^TIU(8925,+DA,15)) S MSG(2)="  On chart signatures deleted."
"RTN","TIURT",107,0)
 Q
"RTN","TIURT",108,0)
 ;
"RTN","TIURT",109,0)
STUFFSIG(DA,TIU15) ; Stuff sig flds w/ TIU15 co-sig flds
"RTN","TIURT",110,0)
 ; TIU15 must be current when received, is returned updated.
"RTN","TIURT",111,0)
 N TIUSTUFF,DR,DIE,X,Y
"RTN","TIURT",112,0)
 S TIUSTUFF="1501////"_$$NOW^TIULC_";1502////^S X=$P(TIU15,U,8);1503////^S X=$P(TIU15,U,9);1504////^S X=$P(TIU15,U,10);1505////C" ; stuff Signer data w/ Cosigner data
"RTN","TIURT",113,0)
 S DR=TIUSTUFF,DIE=8925 D ^DIE S TIU15=$G(^TIU(8925,+DA,15))
"RTN","TIURT",114,0)
 ; Editing 1501 resets ACLEC xref even tho' it's cosigned, so until that can be fixed, rekill ACLEC by resetting 1507:
"RTN","TIURT",115,0)
 S DR="1507////"_$$NOW^TIULC,DIE=8925 D ^DIE S TIU15=$G(^TIU(8925,+DA,15))
"RTN","TIURT",116,0)
 Q
"RTN","TIURT",117,0)
 ;
"RTN","TIURT",118,0)
STUFFCOS(DA,TIU15) ; Stuff co-sig flds w/ TIU15 sig flds
"RTN","TIURT",119,0)
 ; TIU15 must be current when received, is returned updated.
"RTN","TIURT",120,0)
 N TIUCTUFF,DR,DIE,X,Y
"RTN","TIURT",121,0)
 S TIUCTUFF="1507////"_$$NOW^TIULC_";1508////^S X=$P(TIU15,U,2);1509////^S X=$P(TIU15,U,3);1510////^S X=$P(TIU15,U,4);1511////C"
"RTN","TIURT",122,0)
 S DR=TIUCTUFF,DIE=8925 D ^DIE S TIU15=$G(^TIU(8925,+DA,15))
"RTN","TIURT",123,0)
 Q
"RTN","TIURT",124,0)
 ;
"RTN","TIUSRVR3")
0^2^B16084172
"RTN","TIUSRVR3",1,0)
TIUSRVR3 ; SLC/JER - Load Signatures for record-wise GET ;4/12/01 [1/21/04 10:23am]
"RTN","TIUSRVR3",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,176**;Jun 20, 1997
"RTN","TIUSRVR3",3,0)
 ; Created 4/12/01 by splitting TIUSRVR2
"RTN","TIUSRVR3",4,0)
LOADSIG(DA,TIUL) ; Get signature and co-signature blocks
"RTN","TIUSRVR3",5,0)
 N DIC,DIQ,DR,TIUSIG,TIUESIG1,TIUESIG2,TIUSIG1,TIUSIG2,TIUS1,TIUS2
"RTN","TIUSRVR3",6,0)
 N TIUSNM,TIUSTTL,TIUS1DT,TIUS2DT,TIUSDT
"RTN","TIUSRVR3",7,0)
 Q:'$D(^TIU(8925,DA,15))
"RTN","TIUSRVR3",8,0)
 S DIC=8925,DIQ="TIUSIG(",DIQ(0)="IE",DR="1204;1208;1501:1505;1507:1513;1601:1605"
"RTN","TIUSRVR3",9,0)
 D EN^DIQ1 I '$D(TIUSIG) Q
"RTN","TIUSRVR3",10,0)
 S TIUS1=$S(TIUSIG(8925,DA,1505,"I")="E":"/es/ ",TIUSIG(8925,DA,1505,"I")="C":"/s/ ",1:"")_$G(TIUSIG(8925,DA,1503,"E"))
"RTN","TIUSRVR3",11,0)
 S TIUS2=$S(TIUSIG(8925,DA,1511,"I")="E":"/es/ ",TIUSIG(8925,DA,1511,"I")="C":"/s/ ",1:"")_$G(TIUSIG(8925,DA,1509,"E"))
"RTN","TIUSRVR3",12,0)
 S TIUESIG1=$G(TIUSIG(8925,DA,1204,"I"))
"RTN","TIUSRVR3",13,0)
 S TIUSIG1=$G(TIUSIG(8925,DA,1502,"I"))
"RTN","TIUSRVR3",14,0)
 S TIUS1DT=$S(+$G(TIUSIG(8925,DA,1501,"I")):"Signed: "_$$DATE^TIULS($G(TIUSIG(8925,DA,1501,"I")),"MM/DD/CCYY HR:MIN"),1:"")
"RTN","TIUSRVR3",15,0)
 S TIUESIG2=$G(TIUSIG(8925,DA,1208,"I"))
"RTN","TIUSRVR3",16,0)
 S TIUS2DT=$S(+$G(TIUSIG(8925,DA,1507,"I")):"Cosigned: "_$$DATE^TIULS($G(TIUSIG(8925,DA,1507,"I")),"MM/DD/CCYY HR:MIN"),1:"")
"RTN","TIUSRVR3",17,0)
 S TIUSIG2=$G(TIUSIG(8925,DA,1508,"I"))
"RTN","TIUSRVR3",18,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=" "
"RTN","TIUSRVR3",19,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUS1
"RTN","TIUSRVR3",20,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=$G(TIUSIG(8925,DA,1504,"E"))
"RTN","TIUSRVR3",21,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUS1DT
"RTN","TIUSRVR3",22,0)
 I $G(TIUSIG(8925,DA,1505,"I"))="C" D
"RTN","TIUSRVR3",23,0)
 . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="Marked signed on chart by: "_$G(TIUSIG(8925,DA,1512,"E"))
"RTN","TIUSRVR3",24,0)
 I TIUSIG1]"",(TIUSIG1'=TIUESIG1) D LOADFOR(TIUSIG1,TIUESIG1,.TIUL)
"RTN","TIUSRVR3",25,0)
 I +$G(TIUSIG(8925,DA,1507,"I"))>0 D
"RTN","TIUSRVR3",26,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=" "
"RTN","TIUSRVR3",27,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUS2
"RTN","TIUSRVR3",28,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$G(TIUSIG(8925,DA,1510,"E"))
"RTN","TIUSRVR3",29,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUS2DT
"RTN","TIUSRVR3",30,0)
 . I $G(TIUSIG(8925,DA,1511,"I"))="C" D
"RTN","TIUSRVR3",31,0)
 . . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="Marked cosigned on chart by: "_$G(TIUSIG(8925,DA,1513,"E"))
"RTN","TIUSRVR3",32,0)
 I TIUSIG2]"",(TIUSIG2'=TIUESIG2) D LOADFOR(TIUSIG2,TIUESIG2,.TIUL)
"RTN","TIUSRVR3",33,0)
XTRA I +$O(^TIU(8925.7,"B",DA,0)) D XTRASIG(DA,.TIUL)
"RTN","TIUSRVR3",34,0)
 I +$G(TIUSIG(8925,DA,1601,"I")) D
"RTN","TIUSRVR3",35,0)
 . N TIUMODE,TIUY
"RTN","TIUSRVR3",36,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR3",37,0)
 . S TIUY=$$DATE^TIULS(TIUSIG(8925,DA,1601,"I"),"MM/DD/CCYY HR:MIN")
"RTN","TIUSRVR3",38,0)
 . S TIUY=TIUY_"  AMENDMENT FILED:"
"RTN","TIUSRVR3",39,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR3",40,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR3",41,0)
 . S TIUMODE=$S(+$G(TIUSIG(8925,DA,1603,"I")):"/es/ ",1:" /s/ ")
"RTN","TIUSRVR3",42,0)
 . S TIUY=$S($G(TIUSIG(8925,DA,1604,"E"))]"":$G(TIUSIG(8925,DA,1604,"E")),1:$G(TIUSIG(8925,DA,1602,"E")))
"RTN","TIUSRVR3",43,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUMODE_TIUY
"RTN","TIUSRVR3",44,0)
 . I $L($G(TIUSIG(8925,DA,1605,"E"))) D
"RTN","TIUSRVR3",45,0)
 . . S TIUL=TIUL+1,@TIUARR@(TIUL)=$G(TIUSIG(8925,DA,1605,"E"))
"RTN","TIUSRVR3",46,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$P($G(TIUPRM1),U,5)
"RTN","TIUSRVR3",47,0)
 Q
"RTN","TIUSRVR3",48,0)
XTRASIG(TIUDA,TIUL) ; Load additional signature blocks
"RTN","TIUSRVR3",49,0)
 N TIUI S TIUI=0
"RTN","TIUSRVR3",50,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR3",51,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)="Receipt Acknowledged By:"
"RTN","TIUSRVR3",52,0)
 F  S TIUI=$O(^TIU(8925.7,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR3",53,0)
 . N DA,DIC,DR,DIQ,TIUX,TIUXTRA,TIUSGNR,TIUSDT
"RTN","TIUSRVR3",54,0)
 . S DIC="^TIU(8925.7,",DIQ="TIUXTRA",DA=TIUI,DR=".03:.08",DIQ(0)="IE"
"RTN","TIUSRVR3",55,0)
 . D EN^DIQ1 Q:+$D(TIUXTRA)'>9
"RTN","TIUSRVR3",56,0)
 . S TIUSGNR=$S($L($G(TIUXTRA(8925.7,DA,.06,"E"))):"/es/ "_$G(TIUXTRA(8925.7,DA,.06,"E")),1:"     "_$G(TIUXTRA(8925.7,DA,.03,"E")))
"RTN","TIUSRVR3",57,0)
 . S TIUSDT=$S(+$G(TIUXTRA(8925.7,DA,.04,"I")):$$DATE^TIULS(TIUXTRA(8925.7,DA,.04,"I"),"MM/DD/CCYY HR:MIN"),1:"* AWAITING SIGNATURE *")
"RTN","TIUSRVR3",58,0)
 . S TIUX=""
"RTN","TIUSRVR3",59,0)
 . S TIUX=$$SETSTR^VALM1(TIUSDT,TIUX,1,38)
"RTN","TIUSRVR3",60,0)
 . S TIUX=$$SETSTR^VALM1(TIUSGNR,$G(TIUX),25,55)
"RTN","TIUSRVR3",61,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUX,TIUX=""
"RTN","TIUSRVR3",62,0)
 . S TIUX=$$SETSTR^VALM1($G(TIUXTRA(8925.7,DA,.07,"E")),$G(TIUX),30,50)
"RTN","TIUSRVR3",63,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUX
"RTN","TIUSRVR3",64,0)
 Q
"RTN","TIUSRVR3",65,0)
LOADFOR(TIUS1,TIUES1,TIUL) ; Apply "for" block(s)
"RTN","TIUSRVR3",66,0)
 N TIUESN1,TIUEST1,TIUFORN,TIUFORT
"RTN","TIUSRVR3",67,0)
 S TIUESN1="for "_$$SIGNAME^TIULS(TIUES1),TIUEST1=$$SIGTITL^TIULS(TIUES1)
"RTN","TIUSRVR3",68,0)
 I +$G(TIUS1),($G(TIUS1)'=$G(TIUES1)) S TIUFORN=$$SETSTR^VALM1(TIUESN1,$G(TIUFORN),1,50),TIUFORT=$$SETSTR^VALM1(TIUEST1,$G(TIUFORT),1,50)
"RTN","TIUSRVR3",69,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUFORN
"RTN","TIUSRVR3",70,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUFORT
"RTN","TIUSRVR3",71,0)
 Q
"VER")
8.0^22.0
**END**
**END**
