Released ECX*3*23 SEQ #22
Extracted from mail message
**KIDS**:ECX*3.0*23^

**INSTALL NAME**
ECX*3.0*23
"BLD",1863,0)
ECX*3.0*23^DSS EXTRACTS^0^2990423^y
"BLD",1863,4,0)
^9.64PA^727.1^1
"BLD",1863,4,727.1,0)
727.1
"BLD",1863,4,727.1,2,0)
^9.641^727.1^1
"BLD",1863,4,727.1,2,727.1,0)
EXTRACT DEFINITIONS  (File-top level)
"BLD",1863,4,727.1,2,727.1,1,0)
^9.6411^12^1
"BLD",1863,4,727.1,2,727.1,1,12,0)
MAX. LINES PER MESSAGE
"BLD",1863,4,727.1,222)
y^n^p^^n^^n^o^n
"BLD",1863,4,"APDD",727.1,727.1)

"BLD",1863,4,"APDD",727.1,727.1,12)

"BLD",1863,4,"B",727.1,727.1)

"BLD",1863,"INIT")
ECX323PT
"BLD",1863,"KRN",0)
^9.67PA^19^18
"BLD",1863,"KRN",.4,0)
.4
"BLD",1863,"KRN",.401,0)
.401
"BLD",1863,"KRN",.402,0)
.402
"BLD",1863,"KRN",.403,0)
.403
"BLD",1863,"KRN",.5,0)
.5
"BLD",1863,"KRN",.84,0)
.84
"BLD",1863,"KRN",3.6,0)
3.6
"BLD",1863,"KRN",3.8,0)
3.8
"BLD",1863,"KRN",9.2,0)
9.2
"BLD",1863,"KRN",9.8,0)
9.8
"BLD",1863,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",1863,"KRN",9.8,"NM",1,0)
ECXTRANS^^0^B33026478
"BLD",1863,"KRN",9.8,"NM",2,0)
ECXUTL2^^0^B16449219
"BLD",1863,"KRN",9.8,"NM",3,0)
ECX323PT^^0^B3006763
"BLD",1863,"KRN",9.8,"NM","B","ECX323PT",3)

"BLD",1863,"KRN",9.8,"NM","B","ECXTRANS",1)

"BLD",1863,"KRN",9.8,"NM","B","ECXUTL2",2)

"BLD",1863,"KRN",19,0)
19
"BLD",1863,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",1863,"KRN",19,"NM",1,0)
ECX SET MAX LINES^^0
"BLD",1863,"KRN",19,"NM",2,0)
ECX TRANSMISSION^^2
"BLD",1863,"KRN",19,"NM","B","ECX SET MAX LINES",1)

"BLD",1863,"KRN",19,"NM","B","ECX TRANSMISSION",2)

"BLD",1863,"KRN",19.1,0)
19.1
"BLD",1863,"KRN",101,0)
101
"BLD",1863,"KRN",409.61,0)
409.61
"BLD",1863,"KRN",771,0)
771
"BLD",1863,"KRN",869.2,0)
869.2
"BLD",1863,"KRN",870,0)
870
"BLD",1863,"KRN",8994,0)
8994
"BLD",1863,"KRN","B",.4,.4)

"BLD",1863,"KRN","B",.401,.401)

"BLD",1863,"KRN","B",.402,.402)

"BLD",1863,"KRN","B",.403,.403)

"BLD",1863,"KRN","B",.5,.5)

"BLD",1863,"KRN","B",.84,.84)

"BLD",1863,"KRN","B",3.6,3.6)

"BLD",1863,"KRN","B",3.8,3.8)

"BLD",1863,"KRN","B",9.2,9.2)

"BLD",1863,"KRN","B",9.8,9.8)

"BLD",1863,"KRN","B",19,19)

"BLD",1863,"KRN","B",19.1,19.1)

"BLD",1863,"KRN","B",101,101)

"BLD",1863,"KRN","B",409.61,409.61)

"BLD",1863,"KRN","B",771,771)

"BLD",1863,"KRN","B",869.2,869.2)

"BLD",1863,"KRN","B",870,870)

"BLD",1863,"KRN","B",8994,8994)

"BLD",1863,"QUES",0)
^9.62^^
"BLD",1863,"REQB",0)
^9.611^1^1
"BLD",1863,"REQB",1,0)
ECX*3.0*14^2
"BLD",1863,"REQB","B","ECX*3.0*14",1)

"FIA",727.1)
EXTRACT DEFINITIONS
"FIA",727.1,0)
^ECX(727.1,
"FIA",727.1,0,0)
727.1
"FIA",727.1,0,1)
y^n^p^^n^^n^o^n
"FIA",727.1,0,10)

"FIA",727.1,0,11)

"FIA",727.1,0,"RLRO")

"FIA",727.1,0,"VR")
3.0^ECX
"FIA",727.1,727.1)
1
"FIA",727.1,727.1,12)

"INIT")
ECX323PT
"KRN",19,10162,-1)
2^2
"KRN",19,10162,0)
ECX TRANSMISSION^Transmission Management^^M^11714^ECXMGR^^^^^^513
"KRN",19,10162,10,0)
^19.01PI^5^5
"KRN",19,10162,10,5,0)
11338^M^1
"KRN",19,10162,10,5,"^")
ECX SET MAX LINES
"KRN",19,10162,"U")
TRANSMISSION MANAGEMENT
"KRN",19,11338,-1)
0^1
"KRN",19,11338,0)
ECX SET MAX LINES^Set Maximum Line Count for Transmission^^R^^ECXMGR^^^^^^
"KRN",19,11338,1,0)
^^8^8^2990416^^^
"KRN",19,11338,1,1,0)
This option allows the DSS Site Manager to set the maximum number
"KRN",19,11338,1,2,0)
of lines per transmission message for any extract type.
"KRN",19,11338,1,3,0)
 
"KRN",19,11338,1,4,0)
The default value is 200 lines per message.  Certain extracts,
"KRN",19,11338,1,5,0)
such as CLI and ADM, are known to require fewer lines per message
"KRN",19,11338,1,6,0)
(i.e., 100 to 150).  It may be possible to set some extracts to
"KRN",19,11338,1,7,0)
line counts greater than 200, but caution must be exercised.
"KRN",19,11338,1,8,0)
Messages which are larger than 32 Kbytes will be rejected by AAC.
"KRN",19,11338,25)
SETMAX^ECXUTL2
"KRN",19,11338,99.1)
57821,64934
"KRN",19,11338,"U")
SET MAXIMUM LINE COUNT FOR TRA
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",513,-1)
1^1
"PKG",513,0)
DSS EXTRACTS^ECX^Decision Support System. (DSS)
"PKG",513,20,0)
^9.402P^^
"PKG",513,22,0)
^9.49I^1^1
"PKG",513,22,1,0)
3.0^2971222^2980112^11714
"PKG",513,22,1,"PAH",1,0)
23^2990423^11714
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ECX323PT")
0^3^B3006763
"RTN","ECX323PT",1,0)
ECX323PT ;ALB/JAP - PATCH ECX*3*23 Post-Install ; February 26, 1999
"RTN","ECX323PT",2,0)
 ;;3.0;DSS EXTRACTS;**23**;Dec 22, 1997
"RTN","ECX323PT",3,0)
 ;
"RTN","ECX323PT",4,0)
POST ;Entry point
"RTN","ECX323PT",5,0)
 ;update field #12 in each file #727.1 record with default value
"RTN","ECX323PT",6,0)
 N DIC,DIE,DA,DR,X,Y,IEN,ECX,ECXX,HEAD,MAX
"RTN","ECX323PT",7,0)
 D MES^XPDUTL("Updating EXTRACT DEFINITIONS file (#727.1) with default")
"RTN","ECX323PT",8,0)
 D MES^XPDUTL("value for new MAX. LINES PER MESSAGE field (#12)...")
"RTN","ECX323PT",9,0)
 D MES^XPDUTL(" ")
"RTN","ECX323PT",10,0)
 F ECX=1:1 S ECXX=$P($T(TEXT+ECX),";;",2) Q:ECXX="QUIT"  D
"RTN","ECX323PT",11,0)
 .S IEN=$P(ECXX,U,1),MAX=$P(ECXX,U,2),HEAD=$P(ECXX,U,3)
"RTN","ECX323PT",12,0)
 .K X,Y S DIC="^ECX(727.1,",DIC(0)="XOM",X=HEAD D ^DIC
"RTN","ECX323PT",13,0)
 .I Y=-1 D  Q
"RTN","ECX323PT",14,0)
 ..D MES^XPDUTL("   WARNING: Could not update entry #"_IEN_" for "_HEAD_" extract.")
"RTN","ECX323PT",15,0)
 ..D MES^XPDUTL("            Please consult with NVS for DSS EXTRACTS support.")
"RTN","ECX323PT",16,0)
 ..D MES^XPDUTL(" ")
"RTN","ECX323PT",17,0)
 .S (DA,IEN)=+Y,DIE=DIC,DR="12///^S X=MAX" D ^DIE
"RTN","ECX323PT",18,0)
 .D MES^XPDUTL("   Setting record #"_IEN_" for the "_HEAD_" extract with a")
"RTN","ECX323PT",19,0)
 .D MES^XPDUTL("   default value of "_MAX_" in field #12.")
"RTN","ECX323PT",20,0)
 .D MES^XPDUTL(" ")
"RTN","ECX323PT",21,0)
 Q
"RTN","ECX323PT",22,0)
 ;
"RTN","ECX323PT",23,0)
TEXT ;field #12 defaults for file #727.1 records
"RTN","ECX323PT",24,0)
 ;;1^100^ADM
"RTN","ECX323PT",25,0)
 ;;2^150^CLI
"RTN","ECX323PT",26,0)
 ;;3^200^NOS
"RTN","ECX323PT",27,0)
 ;;4^200^NUR
"RTN","ECX323PT",28,0)
 ;;5^200^DEN
"RTN","ECX323PT",29,0)
 ;;7^200^MOV
"RTN","ECX323PT",30,0)
 ;;8^200^UDP
"RTN","ECX323PT",31,0)
 ;;9^200^PRE
"RTN","ECX323PT",32,0)
 ;;10^200^SUR
"RTN","ECX323PT",33,0)
 ;;12^200^LAB
"RTN","ECX323PT",34,0)
 ;;13^200^RAD
"RTN","ECX323PT",35,0)
 ;;14^200^ECS
"RTN","ECX323PT",36,0)
 ;;15^200^IVP
"RTN","ECX323PT",37,0)
 ;;16^200^TRT
"RTN","ECX323PT",38,0)
 ;;17^200^PAS
"RTN","ECX323PT",39,0)
 ;;18^200^LAR
"RTN","ECX323PT",40,0)
 ;;19^200^ECQ
"RTN","ECX323PT",41,0)
 ;;20^150^PRO
"RTN","ECX323PT",42,0)
 ;;QUIT
"RTN","ECXTRANS")
0^1^B33026478
"RTN","ECXTRANS",1,0)
ECXTRANS ;ALB/GTS,JAP,BIR/DMA-Extract from Local Editing Files and Transmit ; [ 11/26/96  2:13 PM ]
"RTN","ECXTRANS",2,0)
 ;;3.0;DSS EXTRACTS;**2,9,12,8,13,14,23**;Dec 22, 1997
"RTN","ECXTRANS",3,0)
EN ;entry point from option
"RTN","ECXTRANS",4,0)
 N ECDA,ECRE,ECTMP,ECCHK,ECDIVVR,ECXDIQ,JJ,SS,OUT,DIR,DUOUT,DTOUT,DIRUT,DIC,X,Y
"RTN","ECXTRANS",5,0)
 I $G(^ECX(728,1,"QUEUE"))'?1"DM"1U D  Q
"RTN","ECXTRANS",6,0)
 .W !,"You have not defined a proper transmission queue"
"RTN","ECXTRANS",7,0)
 .W !,"for entry number 1 in the DSS EXTRACTS file (#728)."
"RTN","ECXTRANS",8,0)
 .W !,"No transmission allowed."
"RTN","ECXTRANS",9,0)
 .D PAUSE
"RTN","ECXTRANS",10,0)
 S ECXQUEUE=$G(^ECX(728,1,"QUEUE"))
"RTN","ECXTRANS",11,0)
 ;** check divisions for transmission
"RTN","ECXTRANS",12,0)
 S ECCHK=$$DIV4^XUSER(.ECTMP,DUZ)
"RTN","ECXTRANS",13,0)
 I 'ECCHK D  Q
"RTN","ECXTRANS",14,0)
 .W !,"You do not have any divisions defined in your user set up and cannot transmit."
"RTN","ECXTRANS",15,0)
 .S DIR(0)="FAO^1:1",DIR("A")="Hit Return to continue." D ^DIR K DIR,X,Y
"RTN","ECXTRANS",16,0)
 W !!,"Your user setup will only allow you to transmit extracts from the"
"RTN","ECXTRANS",17,0)
 W !," following divisions:",!
"RTN","ECXTRANS",18,0)
 S ECDIVVR=""
"RTN","ECXTRANS",19,0)
 F  S ECDIVVR=$O(ECTMP(ECDIVVR)) Q:'(+ECDIVVR)  D
"RTN","ECXTRANS",20,0)
 .K ECXDIC S DA=ECDIVVR,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01"
"RTN","ECXTRANS",21,0)
 .D EN^DIQ1 W !,"   ",$G(ECXDIC(4,DA,.01,"I")) K DIC,DIQ,DA,DR,ECXDIC
"RTN","ECXTRANS",22,0)
 W !!,"If you can't select an extract, it is probably from another division.",!
"RTN","ECXTRANS",23,0)
 D PAUSE Q:OUT
"RTN","ECXTRANS",24,0)
 S ECRE="",DIC="^ECX(727,",DIC(0)="AEQM",DIC("A")="Transmit which extract: "
"RTN","ECXTRANS",25,0)
 S DIC("S")="I '$D(^ECX(727,+Y,""L"")),'$D(^ECX(727,+Y,""PURG"")),$D(ECTMP(+$P($G(^ECX(727,+Y,""DIV"")),U,1)))"
"RTN","ECXTRANS",26,0)
 D ^DIC
"RTN","ECXTRANS",27,0)
 I Y<0 W !! Q
"RTN","ECXTRANS",28,0)
 ;get data on extract
"RTN","ECXTRANS",29,0)
 S DR="1;2;3;4;5;6;15",(ECDA,DA)=+Y,DIQ(0)="E",DIQ="ECXDIQ" D EN^DIQ1
"RTN","ECXTRANS",30,0)
 ;get max. line count for extract type
"RTN","ECXTRANS",31,0)
 S ECXMAX=0,X=$O(^ECX(727.1,"C",ECXDIQ(727,ECDA,6,"E"),0)) S:X ECXMAX=+$P(^ECX(727.1,X,0),U,11) S:'ECXMAX ECXMAX=200
"RTN","ECXTRANS",32,0)
 W !!,ECXDIQ(727,ECDA,6,"E")_" Extract (#"_ECDA_")",?42,"Records:    ",ECXDIQ(727,ECDA,5,"E")
"RTN","ECXTRANS",33,0)
 W !,"Generated on: ",ECXDIQ(727,ECDA,1,"E"),?42,"Start date: ",ECXDIQ(727,ECDA,3,"E")
"RTN","ECXTRANS",34,0)
 W !,"Division:     ",$E(ECXDIQ(727,ECDA,15,"E"),1,26),?42,"End date:   ",ECXDIQ(727,ECDA,4,"E")
"RTN","ECXTRANS",35,0)
 W !!,"MailMan transmission of the "_ECXDIQ(727,ECDA,2,"E")_" extract is set to a"
"RTN","ECXTRANS",36,0)
 W !,"limit of "_ECXMAX_" lines per message.  Each line holds one extract record."
"RTN","ECXTRANS",37,0)
 I $G(^ECX(727,ECDA,"TR")) S ECX=^("TR") D  Q:OUT
"RTN","ECXTRANS",38,0)
 .S OUT=0
"RTN","ECXTRANS",39,0)
 .W !!,"This extract was transmitted on ",$TR($$FMTE^XLFDT(ECX,"5DF")," ","0")
"RTN","ECXTRANS",40,0)
 .K ECX S DIR(0)="Y",DIR("A")="Do you want to retransmit " D ^DIR K DIR
"RTN","ECXTRANS",41,0)
 .I 'Y S OUT=1 Q
"RTN","ECXTRANS",42,0)
 .K ^ECX(727,ECDA,"TR")
"RTN","ECXTRANS",43,0)
 .S ECRE="re"
"RTN","ECXTRANS",44,0)
 S ECTYPE=$P(^ECX(727,ECDA,0),U,3),ECIEN=+$O(^ECX(727.1,"AC",ECTYPE,0)),ECPIECE=$P(^ECX(727.1,ECIEN,0),U,10)
"RTN","ECXTRANS",45,0)
 I ECPIECE>0,$P($G(^ECX(728,1,7.1)),U,ECPIECE)]"" D  Q
"RTN","ECXTRANS",46,0)
 .D MES^XPDUTL(" ")
"RTN","ECXTRANS",47,0)
 .D MES^XPDUTL("An "_ECTYPE_" Extract is currently running or scheduled to run.")
"RTN","ECXTRANS",48,0)
 .D MES^XPDUTL("Please wait until that job has completed before attempting")
"RTN","ECXTRANS",49,0)
 .D MES^XPDUTL("this transmission.")
"RTN","ECXTRANS",50,0)
 .D MES^XPDUTL(" ")
"RTN","ECXTRANS",51,0)
 .D PAUSE
"RTN","ECXTRANS",52,0)
 S ZTSK=$G(^ECX(727,ECDA,"Q")) I ZTSK D STAT^%ZTLOAD I ZTSK(0) I ZTSK(1)<3 D  Q
"RTN","ECXTRANS",53,0)
 .W !!,"Task ",ZTSK," is already queued to transmit this extract."
"RTN","ECXTRANS",54,0)
 .K ZTSK
"RTN","ECXTRANS",55,0)
 .D PAUSE
"RTN","ECXTRANS",56,0)
 S ZTSAVE("ECDA")="",ZTSAVE("ECXQUEUE")="",ZTSAVE("ECRE")="",ZTSAVE("ECXMAX")="",ZTRTN="START^ECXTRANS",ZTIO="",ZTDESC="Transmission of extract # "_ECDA
"RTN","ECXTRANS",57,0)
 W !! D ^%ZTLOAD
"RTN","ECXTRANS",58,0)
 I $D(ZTSK) D
"RTN","ECXTRANS",59,0)
 .W !,"Request queued as Task #",ZTSK,"."
"RTN","ECXTRANS",60,0)
 .S ^ECX(727,ECDA,"Q")=ZTSK K ZTSK
"RTN","ECXTRANS",61,0)
 .D PAUSE
"RTN","ECXTRANS",62,0)
 Q
"RTN","ECXTRANS",63,0)
START ; entry point from task
"RTN","ECXTRANS",64,0)
 N DIC,DIQ,DA,DR,ECXDIC
"RTN","ECXTRANS",65,0)
 S:$P(^ECX(727,ECDA,0),U,3)'="Prosthetics" ECINST=$P(^ECX(728,1,0),U)
"RTN","ECXTRANS",66,0)
 S:$P(^ECX(727,ECDA,0),U,3)="Prosthetics" ECINST=$P(^("DIV"),U)
"RTN","ECXTRANS",67,0)
 S DA=ECINST,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99"
"RTN","ECXTRANS",68,0)
 D EN^DIQ1 S ECINST=$G(ECXDIC(4,DA,99,"I"))
"RTN","ECXTRANS",69,0)
 S ECF=^ECX(727,ECDA,"FILE"),ECHEAD=^("HEAD"),ECGRP=^("GRP"),ECED=$P(^(0),U,5),ECPACK=$P(^(0),U,3)
"RTN","ECXTRANS",70,0)
 S ECVER=$G(^("VER")) S:'ECVER ECVER=1 S ECVER=$$RJ^XLFSTR(ECVER,3,0)
"RTN","ECXTRANS",71,0)
 ;all setup extracts for all sites to go to queue DMU - Judy Sine 2/16/95
"RTN","ECXTRANS",72,0)
 I ECPACK["(setup)" S ECXQUEUE="DMU"
"RTN","ECXTRANS",73,0)
 ;all LAR extracts for fy96/fy97 for test sites go to queue DMW;BTSO/AAC 11/18/97
"RTN","ECXTRANS",74,0)
 I ECHEAD="LAR",+ECED<2971001 S ECXQUEUE="DMW"
"RTN","ECXTRANS",75,0)
 K ^TMP($J) S ECHD(1)=ECINST_ECHEAD_$$ECXYM^ECXUTL(ECED)_ECVER,ECRN=0,ECMSN=1,ECMIN=2,ECLN=ECMIN
"RTN","ECXTRANS",76,0)
 ;* check for and concat nodes 0 and 1 into one message line
"RTN","ECXTRANS",77,0)
 F J=0:0 S J=$O(^ECX(ECF,"AC",ECDA,J)) Q:'J  Q:$$S^%ZTLOAD  I $D(^ECX(ECF,J,0)) D
"RTN","ECXTRANS",78,0)
 .S ^TMP($J,ECMSN,ECLN,0)=$P(^ECX(ECF,J,0),U,4,100)
"RTN","ECXTRANS",79,0)
 .I $D(^ECX(ECF,J,1)) S ^TMP($J,ECMSN,ECLN,0)=^TMP($J,ECMSN,ECLN,0)_U_$P(^ECX(ECF,J,1),U,1,100)
"RTN","ECXTRANS",80,0)
 .S ^TMP($J,ECMSN,ECLN,0)=^TMP($J,ECMSN,ECLN,0)_U_"~"
"RTN","ECXTRANS",81,0)
 .S ECLN=ECLN+1,ECRN=ECRN+1 I ECLN>ECXMAX,$O(^ECX(ECF,"AC",ECDA,J)) S ECLN=ECMIN,ECMSN=ECMSN+1
"RTN","ECXTRANS",82,0)
 ;quit if user stopped task
"RTN","ECXTRANS",83,0)
 I $$S^%ZTLOAD D CLEAN Q
"RTN","ECXTRANS",84,0)
 S TIME=$P($$HTE^XLFDT($H),":",1,2)
"RTN","ECXTRANS",85,0)
 ; send message to mail group 'DSS-ECGRP'
"RTN","ECXTRANS",86,0)
 S ECXLNCNT=9
"RTN","ECXTRANS",87,0)
 F ECMS=1:1:ECMSN D SEND
"RTN","ECXTRANS",88,0)
 S XMSUB=ECINST_" - "_ECPACK_" EXTRACT FOR DSS",XMDUZ="DSS SYSTEM"
"RTN","ECXTRANS",89,0)
 K XMY S XMY("G.DSS-"_ECGRP_"@"_^XMB("NETNAME"))=""
"RTN","ECXTRANS",90,0)
 S ^TMP($J,"LOC",1,0)="The DSS "_ECPACK_" extract (#"_ECDA_") was "_ECRE_"transmitted on "_$P(TIME,"@")_" at "_$P(TIME,"@",2)_". "
"RTN","ECXTRANS",91,0)
 S ^TMP($J,"LOC",3,0)=" "
"RTN","ECXTRANS",92,0)
 S ^TMP($J,"LOC",4,0)="Maximum number of lines (records) per message: "_ECXMAX
"RTN","ECXTRANS",93,0)
 S ^TMP($J,"LOC",5,0)=" "
"RTN","ECXTRANS",94,0)
 S ^TMP($J,"LOC",6,0)="A total of "_ECRN_" records were written."
"RTN","ECXTRANS",95,0)
 S ^TMP($J,"LOC",7,0)="A total of "_ECMSN_" messages were sent."
"RTN","ECXTRANS",96,0)
 S ^TMP($J,"LOC",8,0)="    Message numbers :"
"RTN","ECXTRANS",97,0)
 S XMTEXT="^TMP($J,""LOC"","
"RTN","ECXTRANS",98,0)
 D ^XMD
"RTN","ECXTRANS",99,0)
 S ^ECX(727,ECDA,"TR")=DT
"RTN","ECXTRANS",100,0)
 D CLEAN
"RTN","ECXTRANS",101,0)
 Q
"RTN","ECXTRANS",102,0)
 ;
"RTN","ECXTRANS",103,0)
SEND ;send individual messages
"RTN","ECXTRANS",104,0)
 N ECXDD,DA,DIC,DIE,DINUM,X,XMDUZ,XMTEXT,XMSUB,XMY,XMZ
"RTN","ECXTRANS",105,0)
 S XMSUB="("_ECGRP_") "_ECINST_" - "_ECPACK_" DSS EXTRACT, MESSAGE "_ECMS_" OF "_ECMSN
"RTN","ECXTRANS",106,0)
 S XMDUZ="DSS SYSTEM"
"RTN","ECXTRANS",107,0)
 F J=1:1:ECMIN-1 S ^TMP($J,ECMS,J,0)=ECHD(J)
"RTN","ECXTRANS",108,0)
 S XMY("XXX@Q-"_ECXQUEUE_".VA.GOV")=""
"RTN","ECXTRANS",109,0)
 S XMTEXT="^TMP($J,ECMS,"
"RTN","ECXTRANS",110,0)
 D ^XMD
"RTN","ECXTRANS",111,0)
 S ^TMP($J,"LOC",ECXLNCNT,0)=XMZ,ECXLNCNT=ECXLNCNT+1
"RTN","ECXTRANS",112,0)
 ;store msg # in extract log
"RTN","ECXTRANS",113,0)
 D FIELD^DID(727,301,,"SPECIFIER","ECXDD")
"RTN","ECXTRANS",114,0)
 S DA(1)=ECDA,DIC(0)="L",DIC("P")=ECXDD("SPECIFIER")
"RTN","ECXTRANS",115,0)
 S DIC="^ECX(727,"_DA(1)_",1,",X=XMZ,DINUM=X
"RTN","ECXTRANS",116,0)
 K DD,DO D FILE^DICN
"RTN","ECXTRANS",117,0)
 Q
"RTN","ECXTRANS",118,0)
 ;
"RTN","ECXTRANS",119,0)
CLEAN ;clean-up
"RTN","ECXTRANS",120,0)
 S ZTREQ="@"
"RTN","ECXTRANS",121,0)
 K ^TMP($J),^ECX(727,ECDA,"Q"),XMDUZ,XMTEXT,XMSUB,XMY,XMZ,ECXMAX
"RTN","ECXTRANS",122,0)
 D ^ECXKILL
"RTN","ECXTRANS",123,0)
 I $$S^%ZTLOAD K ZTREQ S ZTSTOP=1
"RTN","ECXTRANS",124,0)
 Q
"RTN","ECXTRANS",125,0)
 ;
"RTN","ECXTRANS",126,0)
PAUSE ;pause screen
"RTN","ECXTRANS",127,0)
 S OUT=0
"RTN","ECXTRANS",128,0)
 I $E(IOST)="C" D
"RTN","ECXTRANS",129,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXTRANS",130,0)
 .S DIR(0)="E" W ! D ^DIR K DIR
"RTN","ECXTRANS",131,0)
 I 'Y S OUT=1
"RTN","ECXTRANS",132,0)
 W !!
"RTN","ECXTRANS",133,0)
 Q
"RTN","ECXUTL2")
0^2^B16449219
"RTN","ECXUTL2",1,0)
ECXUTL2 ;ALB/JAP - Utilities for DSS Extracts (cont.) ;Aug 5, 1998
"RTN","ECXUTL2",2,0)
 ;;3.0;DSS EXTRACTS;**8,13,23**;Dec 22, 1997
"RTN","ECXUTL2",3,0)
 ;
"RTN","ECXUTL2",4,0)
ECXDEF(ECXHEAD,ECXPACK,ECXGRP,ECXFILE,ECXRTN,ECXPIECE,ECXVER) ;variables specific to extract from file #727.1
"RTN","ECXUTL2",5,0)
 ;   input 
"RTN","ECXUTL2",6,0)
 ;   ECXHEAD = extract header code
"RTN","ECXUTL2",7,0)
 ;   all other formal list parameters passed by reference
"RTN","ECXUTL2",8,0)
 ;   output
"RTN","ECXUTL2",9,0)
 ;   ECXPACK = type field (#7)
"RTN","ECXUTL2",10,0)
 ;   ECXGRP  = group field (#9)
"RTN","ECXUTL2",11,0)
 ;   ECXFILE = file number field (#1)
"RTN","ECXUTL2",12,0)
 ;   ECXRTN  = routine field (#4)
"RTN","ECXUTL2",13,0)
 ;   ECXPIECE= running piece field (#11)
"RTN","ECXUTL2",14,0)
 ;   ECXVER  = dss version
"RTN","ECXUTL2",15,0)
 ;
"RTN","ECXUTL2",16,0)
 N ECXIEN,ECXARR,DIC,DA,DR,DIQ
"RTN","ECXUTL2",17,0)
 S (ECXPACK,ECXGRP,ECXFILE,ECXRTN,ECXPIECE,ECXVER)=""
"RTN","ECXUTL2",18,0)
 S ECXIEN=+$O(^ECX(727.1,"C",ECXHEAD,0)) I ECXIEN=0 D  Q
"RTN","ECXUTL2",19,0)
 .D MES^XPDUTL(" ")
"RTN","ECXUTL2",20,0)
 .D MES^XPDUTL(" It appears that you may have a problem with File #727.1 --")
"RTN","ECXUTL2",21,0)
 .D MES^XPDUTL(" ")
"RTN","ECXUTL2",22,0)
 .D MES^XPDUTL(" The "_ECHEAD_" Extract is not properly defined.")
"RTN","ECXUTL2",23,0)
 .D MES^XPDUTL(" ")
"RTN","ECXUTL2",24,0)
 .D MES^XPDUTL(" Contact National VISTA Support for further assistance.")
"RTN","ECXUTL2",25,0)
 .D MES^XPDUTL(" ")
"RTN","ECXUTL2",26,0)
 .I $E(IOST)="C" D
"RTN","ECXUTL2",27,0)
 ..S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXUTL2",28,0)
 ..S DIR(0)="E" W ! D ^DIR K DIR
"RTN","ECXUTL2",29,0)
 .W !!
"RTN","ECXUTL2",30,0)
 S DIC="^ECX(727.1,",DA=ECXIEN,DR=".01;1;4;7;9;11",DIQ="ECXARR"
"RTN","ECXUTL2",31,0)
 D EN^DIQ1
"RTN","ECXUTL2",32,0)
 S ECXPACK=ECXARR(727.1,ECXIEN,7)
"RTN","ECXUTL2",33,0)
 S ECXGRP=ECXARR(727.1,ECXIEN,9)
"RTN","ECXUTL2",34,0)
 S ECXFILE=ECXARR(727.1,ECXIEN,1)
"RTN","ECXUTL2",35,0)
 S ECXRTN="START^"_ECXARR(727.1,ECXIEN,4)
"RTN","ECXUTL2",36,0)
 S ECXPIECE=ECXARR(727.1,ECXIEN,11)
"RTN","ECXUTL2",37,0)
 ;version of dss/tsi in Austin as specified by btso
"RTN","ECXUTL2",38,0)
 S ECXVER=7
"RTN","ECXUTL2",39,0)
 Q
"RTN","ECXUTL2",40,0)
 ;
"RTN","ECXUTL2",41,0)
SETMAX ;set maximum number of lines/message for extract type
"RTN","ECXUTL2",42,0)
 N DIC,DIE,DA,DR,DTOUT,DUOUT,X,Y,OUT
"RTN","ECXUTL2",43,0)
 W !
"RTN","ECXUTL2",44,0)
 S OUT=0
"RTN","ECXUTL2",45,0)
 F  Q:OUT  Q:$D(DUOUT)!($D(DTOUT))  D
"RTN","ECXUTL2",46,0)
 .W !
"RTN","ECXUTL2",47,0)
 .S DIC="^ECX(727.1,",DIC(0)="AEOMQZ" D ^DIC
"RTN","ECXUTL2",48,0)
 .Q:$D(DUOUT)!($D(DTOUT))  S:Y=-1 OUT=1 Q:OUT
"RTN","ECXUTL2",49,0)
 .S DIE=DIC,DA=+Y,DR="12" D ^DIE
"RTN","ECXUTL2",50,0)
 .Q:$D(DUOUT)!($D(DTOUT))
"RTN","ECXUTL2",51,0)
 W !!
"RTN","ECXUTL2",52,0)
 Q
"RTN","ECXUTL2",53,0)
 ;
"RTN","ECXUTL2",54,0)
PRIMARY(ECXDFN,ECXDATE,ECXPREFX) ;determine patient's pc team and pc provider
"RTN","ECXUTL2",55,0)
 ; input
"RTN","ECXUTL2",56,0)
 ; ECXDFN    = file #2 ien (required)
"RTN","ECXUTL2",57,0)
 ; ECXDATE   = date of interest (required)
"RTN","ECXUTL2",58,0)
 ; ECXPREFX  = prefix for provider data (optional)
"RTN","ECXUTL2",59,0)
 ;             defaults to "2" if not specified otherwise
"RTN","ECXUTL2",60,0)
 ; output
"RTN","ECXUTL2",61,0)
 ; ECXPRIME  = pc team ien^prefix_pc provider ien^pc provider person class
"RTN","ECXUTL2",62,0)
 ;
"RTN","ECXUTL2",63,0)
 N ECPTTM,ECPTPR,ECCLAS,ECPRIME
"RTN","ECXUTL2",64,0)
 S:'$D(ECXPREFX) ECXPREFX=2 S:(+ECXPREFX=0) ECXPREFX=2
"RTN","ECXUTL2",65,0)
 S ECPTTM=+$$OUTPTTM^ECXUTL3(ECXDFN,ECXDATE) S:ECPTTM=0 ECPTTM=""
"RTN","ECXUTL2",66,0)
 S ECPTPR=+$$OUTPTPR^ECXUTL3(ECXDFN,ECXDATE)
"RTN","ECXUTL2",67,0)
 S ECCLAS="" I ECPTPR>0 S ECCLAS=$$PRVCLASS^ECXUTL(ECPTPR,ECXDATE)
"RTN","ECXUTL2",68,0)
 S:ECPTPR=0 ECPTPR="" S:ECPTPR]"" ECPTPR=ECXPREFX_ECPTPR
"RTN","ECXUTL2",69,0)
 S ECXPRIME=ECPTTM_U_ECPTPR_U_ECCLAS
"RTN","ECXUTL2",70,0)
 Q ECXPRIME
"RTN","ECXUTL2",71,0)
 ;
"RTN","ECXUTL2",72,0)
INP(ECXDFN,ECXDATE) ; check for inpatient status
"RTN","ECXUTL2",73,0)
 ; input
"RTN","ECXUTL2",74,0)
 ; ECXDFN  = file #2 ien (required)
"RTN","ECXUTL2",75,0)
 ; ECXDATE = date of interest (required)
"RTN","ECXUTL2",76,0)
 ; output
"RTN","ECXUTL2",77,0)
 ; ECXINP  = patient status^movment #^current treat. spec.^admission date/time^current ward^discharge date/time
"RTN","ECXUTL2",78,0)
 ;           where patient status = 3 for inpatient
"RTN","ECXUTL2",79,0)
 ;                                = 1 for outpatient
"RTN","ECXUTL2",80,0)
 ;
"RTN","ECXUTL2",81,0)
 N DFN,VAIP,ECA,ECADM,ECMN,ECTS,ECWARD,ECDC,ECXINP
"RTN","ECXUTL2",82,0)
 S DFN=ECXDFN
"RTN","ECXUTL2",83,0)
 S ECA=1,(ECMN,ECTS,ECADM,ECWARD,ECDC,ECXINP)=""
"RTN","ECXUTL2",84,0)
 K VAIP S VAIP("D")=ECXDATE D IN5^VADPT
"RTN","ECXUTL2",85,0)
 S ECMN=$G(VAIP(1))
"RTN","ECXUTL2",86,0)
 I ECMN D
"RTN","ECXUTL2",87,0)
 .S ECA=3
"RTN","ECXUTL2",88,0)
 .S ECTS=$P($G(^DIC(45.7,+VAIP(8),0)),U,2) S:ECTS=0 ECTS=""
"RTN","ECXUTL2",89,0)
 .S ECADM=+$G(VAIP(13,1)) S:ECADM=0 ECADM=""
"RTN","ECXUTL2",90,0)
 .S ECWARD=+$G(VAIP(5)) S:ECWARD=0 ECWARD=""
"RTN","ECXUTL2",91,0)
 .S ECDC=+$G(VAIP(17,1)) S:ECDC=0 ECDC=""
"RTN","ECXUTL2",92,0)
 S ECXINP=ECA_U_ECMN_U_ECTS_U_ECADM_U_ECWARD_U_ECDC
"RTN","ECXUTL2",93,0)
 Q ECXINP
"RTN","ECXUTL2",94,0)
 ;
"RTN","ECXUTL2",95,0)
VISN19(ECXDFN,ECXPAYOR,ECXSAI) ;visn 19 sharing agreement data
"RTN","ECXUTL2",96,0)
 ; input  ECXDFN = patient file ien
"RTN","ECXUTL2",97,0)
 ; output ECXPAYOR, ECXSAI (passed by reference)
"RTN","ECXUTL2",98,0)
 ;
"RTN","ECXUTL2",99,0)
 N I,JJ,ALIAS,INSUR,TOT
"RTN","ECXUTL2",100,0)
 S (ECXPAYOR,ECXSAI)=""
"RTN","ECXUTL2",101,0)
 I $D(^DPT(ECXDFN,.01)) S JJ=0 D
"RTN","ECXUTL2",102,0)
 .F  S JJ=$O(^DPT(ECXDFN,.01,JJ)) Q:JJ=""  S ALIAS=$P(^(JJ,0),U,1) D  Q:ECXPAYOR]""
"RTN","ECXUTL2",103,0)
 ..S ECXPAYOR=$S(ALIAS="CAT C":ALIAS,ALIAS="CATEGORY C":ALIAS,ALIAS="CHAMPVA":ALIAS,ALIAS="CHAMPUS":ALIAS,ALIAS="TRICARE":ALIAS,ALIAS="SHARING AGREEMENT":ALIAS,1:"")
"RTN","ECXUTL2",104,0)
 I ECXPAYOR]"",$D(^DPT(ECXDFN,.312)) S (J,JJ)=0 D
"RTN","ECXUTL2",105,0)
 .F  S JJ=$O(^DPT(ECXDFN,.312,JJ)) Q:+JJ=0  S I=$P(^(JJ,0),U,1),J=J+1,INSUR(J)=$P($G(^DIC(36,I,0)),U,1)
"RTN","ECXUTL2",106,0)
 .S TOT=$O(INSUR(99),-1)
"RTN","ECXUTL2",107,0)
 .I TOT=1 S ECXSAI=INSUR(1) Q
"RTN","ECXUTL2",108,0)
 .I TOT=2 S ECXSAI=$E(INSUR(1),1,14)_","_$E(INSUR(2),1,14) Q
"RTN","ECXUTL2",109,0)
 .I TOT=3 S ECXSAI=$E(INSUR(1),1,9)_","_$E(INSUR(2),1,9)_","_$E(INSUR(3),1,9) Q
"RTN","ECXUTL2",110,0)
 .I TOT>3 S ECXSAI=$E(INSUR(1),1,9)_","_$E(INSUR(2),1,9)_","_$E(INSUR(3),1,9)_"M"
"RTN","ECXUTL2",111,0)
 Q
"VER")
8.0^21.0
"^DD",727.1,727.1,12,0)
MAX. LINES PER MESSAGE^RNJ3,0^^0;11^K:+X'=X!(X>500)!(X<2)!(X?.E1"."1N.N) X
"^DD",727.1,727.1,12,3)
Type a Number between 2 and 500, 0 Decimal Digits
"^DD",727.1,727.1,12,21,0)
^^10^10^2990326^^
"^DD",727.1,727.1,12,21,1,0)
This number is the maximum number of lines per transmission message
"^DD",727.1,727.1,12,21,2,0)
allowed for this extract type.
"^DD",727.1,727.1,12,21,3,0)
  
"^DD",727.1,727.1,12,21,4,0)
A default value of 200 is usually acceptable for most extracts.
"^DD",727.1,727.1,12,21,5,0)
However, for some (e.g., CLI, ADM) lower values are recommended.
"^DD",727.1,727.1,12,21,6,0)
 
"^DD",727.1,727.1,12,21,7,0)
It may be possible in some cases to set a value greater than 200,
"^DD",727.1,727.1,12,21,8,0)
thus reducing the total number of transmission messages needed for
"^DD",727.1,727.1,12,21,9,0)
the extract.  However, if the transmission message becomes larger
"^DD",727.1,727.1,12,21,10,0)
than 32 Kbytes, it will be rejected by AAC.
"^DD",727.1,727.1,12,"DT")
2990327
**END**
**END**
