EMERGENCY Released SD*5.3*485 SEQ #394
Extracted from mail message
**KIDS**:SD*5.3*485^

**INSTALL NAME**
SD*5.3*485
"BLD",6551,0)
SD*5.3*485^SCHEDULING^0^3061003^y
"BLD",6551,1,0)
^^2^2^3060531^
"BLD",6551,1,1,0)
patch corrects a problem in calculating the patients ENROLLMENT
"BLD",6551,1,2,0)
STATUS on the EWL PATIENT file.
"BLD",6551,4,0)
^9.64PA^409.3^1
"BLD",6551,4,409.3,0)
409.3
"BLD",6551,4,409.3,2,0)
^9.641^409.3^1
"BLD",6551,4,409.3,2,409.3,0)
SD WAIT LIST  (File-top level)
"BLD",6551,4,409.3,2,409.3,1,0)
^9.6411^27.2^2
"BLD",6551,4,409.3,2,409.3,1,27.1,0)
EWL ENROLLEE DATE USED
"BLD",6551,4,409.3,2,409.3,1,27.2,0)
EWL ENROLLEE DATABASE FILE
"BLD",6551,4,409.3,222)
y^y^p^^^^n^^n
"BLD",6551,4,409.3,224)

"BLD",6551,4,"APDD",409.3,409.3)

"BLD",6551,4,"APDD",409.3,409.3,27.1)

"BLD",6551,4,"APDD",409.3,409.3,27.2)

"BLD",6551,4,"B",409.3,409.3)

"BLD",6551,6.3)
2
"BLD",6551,"ABPKG")
n
"BLD",6551,"INI")

"BLD",6551,"KRN",0)
^9.67PA^8989.52^19
"BLD",6551,"KRN",.4,0)
.4
"BLD",6551,"KRN",.401,0)
.401
"BLD",6551,"KRN",.402,0)
.402
"BLD",6551,"KRN",.403,0)
.403
"BLD",6551,"KRN",.5,0)
.5
"BLD",6551,"KRN",.84,0)
.84
"BLD",6551,"KRN",3.6,0)
3.6
"BLD",6551,"KRN",3.8,0)
3.8
"BLD",6551,"KRN",9.2,0)
9.2
"BLD",6551,"KRN",9.8,0)
9.8
"BLD",6551,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",6551,"KRN",9.8,"NM",1,0)
SDWLE11^^0^B7184572
"BLD",6551,"KRN",9.8,"NM",2,0)
SDWLRP1^^0^B62309635
"BLD",6551,"KRN",9.8,"NM",3,0)
SDWLRP4^^0^B42653534
"BLD",6551,"KRN",9.8,"NM",4,0)
SDWLE111^^0^B13857185
"BLD",6551,"KRN",9.8,"NM","B","SDWLE11",1)

"BLD",6551,"KRN",9.8,"NM","B","SDWLE111",4)

"BLD",6551,"KRN",9.8,"NM","B","SDWLRP1",2)

"BLD",6551,"KRN",9.8,"NM","B","SDWLRP4",3)

"BLD",6551,"KRN",19,0)
19
"BLD",6551,"KRN",19,"NM",0)
^9.68A^^
"BLD",6551,"KRN",19.1,0)
19.1
"BLD",6551,"KRN",101,0)
101
"BLD",6551,"KRN",409.61,0)
409.61
"BLD",6551,"KRN",771,0)
771
"BLD",6551,"KRN",870,0)
870
"BLD",6551,"KRN",8989.51,0)
8989.51
"BLD",6551,"KRN",8989.52,0)
8989.52
"BLD",6551,"KRN",8994,0)
8994
"BLD",6551,"KRN","B",.4,.4)

"BLD",6551,"KRN","B",.401,.401)

"BLD",6551,"KRN","B",.402,.402)

"BLD",6551,"KRN","B",.403,.403)

"BLD",6551,"KRN","B",.5,.5)

"BLD",6551,"KRN","B",.84,.84)

"BLD",6551,"KRN","B",3.6,3.6)

"BLD",6551,"KRN","B",3.8,3.8)

"BLD",6551,"KRN","B",9.2,9.2)

"BLD",6551,"KRN","B",9.8,9.8)

"BLD",6551,"KRN","B",19,19)

"BLD",6551,"KRN","B",19.1,19.1)

"BLD",6551,"KRN","B",101,101)

"BLD",6551,"KRN","B",409.61,409.61)

"BLD",6551,"KRN","B",771,771)

"BLD",6551,"KRN","B",870,870)

"BLD",6551,"KRN","B",8989.51,8989.51)

"BLD",6551,"KRN","B",8989.52,8989.52)

"BLD",6551,"KRN","B",8994,8994)

"BLD",6551,"QUES",0)
^9.62^^
"BLD",6551,"REQB",0)
^9.611^3^3
"BLD",6551,"REQB",1,0)
SD*5.3*263^1
"BLD",6551,"REQB",2,0)
SD*5.3*273^1
"BLD",6551,"REQB",3,0)
SD*5.3*417^1
"BLD",6551,"REQB","B","SD*5.3*263",1)

"BLD",6551,"REQB","B","SD*5.3*273",2)

"BLD",6551,"REQB","B","SD*5.3*417",3)

"FIA",409.3)
SD WAIT LIST
"FIA",409.3,0)
^SDWL(409.3,
"FIA",409.3,0,0)
409.3IP
"FIA",409.3,0,1)
y^y^p^^^^n^^n
"FIA",409.3,0,10)

"FIA",409.3,0,11)

"FIA",409.3,0,"RLRO")

"FIA",409.3,0,"VR")
5.3^SD
"FIA",409.3,409.3)
1
"FIA",409.3,409.3,27.1)

"FIA",409.3,409.3,27.2)

"MBREQ")
0
"PKG",48,-1)
1^1
"PKG",48,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",48,20,0)
^9.402P^^
"PKG",48,22,0)
^9.49I^1^1
"PKG",48,22,1,0)
5.3^2930813^2960613
"PKG",48,22,1,"PAH",1,0)
485^3061003
"PKG",48,22,1,"PAH",1,1,0)
^^2^2^3061003
"PKG",48,22,1,"PAH",1,1,1,0)
patch corrects a problem in calculating the patients ENROLLMENT
"PKG",48,22,1,"PAH",1,1,2,0)
STATUS on the EWL PATIENT file.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SDWLE11")
0^1^B7184572^B4195699
"RTN","SDWLE11",1,0)
SDWLE11 ;;IOFO BAY PINES/TEH - WAITING LIST-ENTER/EDIT - WAIT LIST TYPE/INSTUTITION;06/12/2002 ; 20 Aug 2002  2:10 PM
"RTN","SDWLE11",2,0)
 ;;5.3;scheduling;**263,485**;AUG 13 1993;Build 2
"RTN","SDWLE11",3,0)
 ;
"RTN","SDWLE11",4,0)
 ;
"RTN","SDWLE11",5,0)
 ;******************************************************************
"RTN","SDWLE11",6,0)
 ;                             CHANGE LOG
"RTN","SDWLE11",7,0)
 ;                                               
"RTN","SDWLE11",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLE11",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLE11",10,0)
 ;  05/09/2006                SD*5.3*485                 CORRECT ENROLLMENT STATUS. 
"RTN","SDWLE11",11,0)
 ;   
"RTN","SDWLE11",12,0)
 ;   
"RTN","SDWLE11",13,0)
 ;      
"RTN","SDWLE11",14,0)
NEW ;ADD NEW PATIENT
"RTN","SDWLE11",15,0)
 K DIC,DIR,DR,DIE N %H,SDWLDS,SDWLE,SDWLNEW,SDWLRNED,SDWLX,SDWLY
"RTN","SDWLE11",16,0)
 S DIC(0)="LX",X=SDWLDFN,DIC="^SDWL(409.3," D FILE^DICN S (SDWLDA,DA)=+Y
"RTN","SDWLE11",17,0)
 S SDWLNEW=1 K DIC
"RTN","SDWLE11",18,0)
 L ^SDWL(409.3,SDWLDA)
"RTN","SDWLE11",19,0)
 S DIE="^SDWL(409.3,",DR="1////^S X=DT" D ^DIE
"RTN","SDWLE11",20,0)
 ;
"RTN","SDWLE11",21,0)
 ;DETERMINE ENROLLEE STATUS
"RTN","SDWLE11",22,0)
 ;
"RTN","SDWLE11",23,0)
 ;SDWLE=1 = NEW ENROLLEE
"RTN","SDWLE11",24,0)
 ;SDWLE=2 = ESTABLISHED
"RTN","SDWLE11",25,0)
 ;SDWLE=3 = PRIOR ENROLLEE
"RTN","SDWLE11",26,0)
 ;SDWLE=4 = UNDETERMINED
"RTN","SDWLE11",27,0)
 ;
"RTN","SDWLE11",28,0)
EN S SDWLDE=+$H,SDWLE=1,(SDWLEE,SDWLRNED,SDWLDB)=0 D SB1
"RTN","SDWLE11",29,0)
 G SB0:SDWLE=2
"RTN","SDWLE11",30,0)
 S SDWLRNE=$$ENROLL^EASWTAPI(SDWLDFN) G SB0:$P(SDWLRNE,U,4)="A" S SDWLRNED=$P(SDWLRNE,U,3)
"RTN","SDWLE11",31,0)
 I SDWLRNED S X=SDWLRNED D H^%DTC S SDWLDS=%H S SDWLDE=+$H,SDWLDET=SDWLDE-SDWLDS,SDWLDB=2 I SDWLDET<366 S SDWLE=1
"RTN","SDWLE11",32,0)
 I $D(SDWLDET),SDWLDET>365 S SDWLE=3
"RTN","SDWLE11",33,0)
 I 'SDWLRNE S SDWLE=4
"RTN","SDWLE11",34,0)
SB0 I $D(SDWLRNE),$P(SDWLRNE,U,4)="A" D
"RTN","SDWLE11",35,0)
 .I $D(SDWLEE),SDWLEE>730!(SDWLEE=730) S SDWLE=4 Q
"RTN","SDWLE11",36,0)
 .I 'SDWLEE S SDWLE=4 Q
"RTN","SDWLE11",37,0)
 S SDWLRNE=$S(SDWLE=1:"N",SDWLE=2:"E",SDWLE=3:"P",SDWLE=4:"U",1:"U")
"RTN","SDWLE11",38,0)
 ;-Code here for filling in 409.3
"RTN","SDWLE11",39,0)
 S DR="27////^S X=SDWLRNE",DIE="^SDWL(409.3,",DA=SDWLDA D ^DIE
"RTN","SDWLE11",40,0)
 ;SAVE ENROLLEE CALCULATION DATE
"RTN","SDWLE11",41,0)
 S DR="27.1////^S X=$S(SDWLRNED:SDWLRNED,$D(SDWLD):SDWLD,1:"""")" D ^DIE
"RTN","SDWLE11",42,0)
 ;SAVE DATABASE FILE
"RTN","SDWLE11",43,0)
 S DR="27.2////^S X=SDWLDB" D ^DIE
"RTN","SDWLE11",44,0)
 S DR="9////^S X=DUZ" D ^DIE
"RTN","SDWLE11",45,0)
 K SDWLRNE,SDWLD,SDWLDE,SDWLEE,SDWLDET,DIC,DIR,DR,DIE,X
"RTN","SDWLE11",46,0)
 Q
"RTN","SDWLE11",47,0)
SB1 I '$D(^DGCN(391.91,"B",SDWLDFN)) N SDWLDB S SDWLE=3 Q
"RTN","SDWLE11",48,0)
 S SDWLX="" F  S SDWLX=$O(^DGCN(391.91,"B",SDWLDFN,SDWLX)) Q:SDWLX=""  D
"RTN","SDWLE11",49,0)
 .S SDWLY=$G(^DGCN(391.91,SDWLX,0)) D
"RTN","SDWLE11",50,0)
 ..;CHECK FOR VALID TF
"RTN","SDWLE11",51,0)
 ..I $$TF^XUAF4(+$P(SDWLY,U,2)) D
"RTN","SDWLE11",52,0)
 ...;GET LIST OF DATES FOR TF
"RTN","SDWLE11",53,0)
 ...S SDWLD=$P(SDWLY,U,3) I SDWLD S SDWLDTF(9999999-SDWLD)=SDWLX
"RTN","SDWLE11",54,0)
 ;FIND LAST TREATMENT DATE
"RTN","SDWLE11",55,0)
 I '$D(SDWLDTF) Q
"RTN","SDWLE11",56,0)
 S SDWLDTF=$O(SDWLDTF(0)) I SDWLDTF S (SDWLD,X)=9999999-SDWLDTF D H^%DTC S SDWLEE=SDWLDE-%H,SDWLDB=1 I SDWLEE<730 S SDWLE=2
"RTN","SDWLE11",57,0)
 I $D(SDWLEE),SDWLEE>730!(SDWLEE=730) S SDWLE=3
"RTN","SDWLE11",58,0)
 K SDWLDTF
"RTN","SDWLE11",59,0)
END Q
"RTN","SDWLE111")
0^4^B13857185^B13272665
"RTN","SDWLE111",1,0)
SDWLE111 ;;IOFO BAY PINES/TEH - WAITING LIST-ENTER/EDIT - WAIT LIST TYPE/INSTUTITION;20 Aug 2002
"RTN","SDWLE111",2,0)
 ;;5.3;scheduling;**263,273,280,394,417,485**;AUG 13 1993;Build 2
"RTN","SDWLE111",3,0)
 ;
"RTN","SDWLE111",4,0)
 ;
"RTN","SDWLE111",5,0)
 ;
"RTN","SDWLE111",6,0)
 ;******************************************************************
"RTN","SDWLE111",7,0)
 ;                         CHANGE LOG
"RTN","SDWLE111",8,0)
 ;                                         
"RTN","SDWLE111",9,0)
 ;   DATE                      PATCH              DESCRIPTION
"RTN","SDWLE111",10,0)
 ;   ----                      -----              -----------
"RTN","SDWLE111",11,0)
 ;10/01/2002                                     263        Logical Order Change   
"RTN","SDWLE111",12,0)
 ;12/02/2002                 273           line EN2+19 add '/' 
"RTN","SDWLE111",13,0)
 ;12/10/2004                                     SD*5.3*394     Add Service Connection prompts   
"RTN","SDWLE111",14,0)
 ;01/11/2005                 417           Permit MultiplePanels      
"RTN","SDWLE111",15,0)
 ;02/16/2005                 417           New logic for WAIT LIST TYPE Prompt. See Table in Release Notes.
"RTN","SDWLE111",16,0)
 ;
"RTN","SDWLE111",17,0)
 ;ASK WAIT LIST TYPE
"RTN","SDWLE111",18,0)
 ;
"RTN","SDWLE111",19,0)
EN ;
"RTN","SDWLE111",20,0)
 N SDWLPRP S (SDWLFLG,SDWLPRP)=0
"RTN","SDWLE111",21,0)
 D GETTM
"RTN","SDWLE111",22,0)
 I 'SDWLTEM S SDWLPRP=1
"RTN","SDWLE111",23,0)
 I SDWLTEM,'SDWLPOS S SDWLPRP=0
"RTN","SDWLE111",24,0)
 I $D(SDWLTY) W !,"Wait List Type: ",$$EXTERNAL^DILFD(409.3,4,,SDWLTY) W "//  (No Editing)" S SDWLTYE=SDWLTY G EN10
"RTN","SDWLE111",25,0)
 ;10/01/2002 - TEH
"RTN","SDWLE111",26,0)
EN0 ;
"RTN","SDWLE111",27,0)
 I 'SDWLPRP D
"RTN","SDWLE111",28,0)
 .S DIR(0)="SO^1:PCMM TEAM ASSIGNMENT;2:PCMM POSITION ASSIGNMENT;3:SERVICE/SPECIALTY;4:SPECIFIC CLINIC"
"RTN","SDWLE111",29,0)
 .S DIR("L",1)="     Select Wait List Type: "
"RTN","SDWLE111",30,0)
 .S DIR("L",2)=""
"RTN","SDWLE111",31,0)
 .S DIR("L",3)="   1. PCMM TEAM ASSIGNMENT"
"RTN","SDWLE111",32,0)
 .S DIR("L",4)="   2. PCMM POSITION ASSIGNMENT"
"RTN","SDWLE111",33,0)
 .S DIR("L",5)="   3. SERVICE/SPECIALTY"
"RTN","SDWLE111",34,0)
 .S DIR("L")="   4. SPECIFIC CLINIC"
"RTN","SDWLE111",35,0)
 .S SDWLFLG=1
"RTN","SDWLE111",36,0)
 G EN9:SDWLFLG
"RTN","SDWLE111",37,0)
EN1 I SDWLPRP D
"RTN","SDWLE111",38,0)
 .S DIR(0)="SO^1:PCMM TEAM ASSIGNMENT;2:SERVICE/SPECIALTY;3:SPECIFIC CLINIC"
"RTN","SDWLE111",39,0)
 .S DIR("L",1)="     Select Wait List Type: "
"RTN","SDWLE111",40,0)
 .S DIR("L",2)=""
"RTN","SDWLE111",41,0)
 .S DIR("L",3)="   1. PCMM TEAM ASSIGNMENT"
"RTN","SDWLE111",42,0)
 .S DIR("L",4)="   2. SERVICE/SPECIALTY"
"RTN","SDWLE111",43,0)
 .S DIR("L")="   3. SPECIFIC CLINIC"
"RTN","SDWLE111",44,0)
 .S SDWLFLG=0
"RTN","SDWLE111",45,0)
EN9 D ^DIR I X="" W " Required or '^' to Quit" G EN
"RTN","SDWLE111",46,0)
 I $D(DUOUT) S SDWLERR=1 G END
"RTN","SDWLE111",47,0)
 S SDWLTYE=+Y I 'SDWLFLG D
"RTN","SDWLE111",48,0)
 .S SDWLTYE=$S(+Y=1:1,+Y=2:3,+Y=3:4,1:0)
"RTN","SDWLE111",49,0)
 I 'SDWLTYE W "  Invalid Entry." G EN
"RTN","SDWLE111",50,0)
 S DIE="^SDWL(409.3,",DR="4///^S X=SDWLTYE" D ^DIE
"RTN","SDWLE111",51,0)
 ;
"RTN","SDWLE111",52,0)
EN10 ;SERVICE CONNECTION - SD*5.3*394
"RTN","SDWLE111",53,0)
 ;
"RTN","SDWLE111",54,0)
 D ^SDWLSC
"RTN","SDWLE111",55,0)
 ;
"RTN","SDWLE111",56,0)
 ;ASK INSTITUTION (FILE 4)
"RTN","SDWLE111",57,0)
 ;
"RTN","SDWLE111",58,0)
 I SDWLTYE=2,$D(SDWLCPT),SDWLCPT S (SDWLINE,SDWLIN)=$P($G(^SCTM(404.51,+SDWLCPT,0)),U,7) G END
"RTN","SDWLE111",59,0)
 I SDWLTYE=2 S SDWLI=0 F  S SDWLI=$O(^SCTM(404.57,SDWLI)) Q:SDWLI<1  D  G END
"RTN","SDWLE111",60,0)
 .S SDWLL=+$P($G(^SCTM(404.57,SDWLI,0)),U,2),SDWLINL=+$P($G(^SCTM(404.51,+SDWLL,0)),U,7),SDWLINL(+SDWLINL)=""
"RTN","SDWLE111",61,0)
 K DUOUT S SDWLERR=0 W !
"RTN","SDWLE111",62,0)
 I $D(SDWLIN) D
"RTN","SDWLE111",63,0)
 .S X=$S($D(SDWLIN):$$EXTERNAL^DILFD(409.32,.02,,SDWLIN),1:""),SDWLINE=SDWLIN D
"RTN","SDWLE111",64,0)
 ..W !,"Select Institution: ",X," //  (No Editing)" S SDWLERR=1
"RTN","SDWLE111",65,0)
 I SDWLERR S SDWLERR=0 G END
"RTN","SDWLE111",66,0)
 I SDWLTYE=1 S DIC("S")="I $D(^SCTM(404.51,""AINST"",+Y))"
"RTN","SDWLE111",67,0)
 I SDWLTYE=2 S DIC("S")="I $D(SDWLINL(+Y))"
"RTN","SDWLE111",68,0)
 I SDWLTYE=4 S DIC("S")="I $D(^SDWL(409.32,""ACT"",+Y))"
"RTN","SDWLE111",69,0)
 I SDWLTYE=3 S DIC("S")="I $D(^SDWL(409.31,""E"",+Y))"
"RTN","SDWLE111",70,0)
 S DIC("S")=DIC("S")_",$$GET1^DIQ(4,+Y_"","",11,""I"")=""N"",$$TF^XUAF4(+Y)"
"RTN","SDWLE111",71,0)
 S DIC(0)="AEQNM",DIC="4",DIC("A")="Select Institution: " D ^DIC I Y<0,'$D(DUOUT) S SDWLERR=1 W "Required or '^' to Quit."
"RTN","SDWLE111",72,0)
 I $D(DUOUT) S SDWLERR=1 Q
"RTN","SDWLE111",73,0)
 G EN10:SDWLERR
"RTN","SDWLE111",74,0)
 I Y>0 D 
"RTN","SDWLE111",75,0)
 .K DIC,DIC("A"),DIC("S"),DIC(0),DIC("B") S (SDWLIN,SDWLINE)=+Y,DIE="^SDWL(409.3,"
"RTN","SDWLE111",76,0)
 .I '$D(DUOUT),Y>0 S DR="2////^S X=SDWLIN",DIE="^SDWL(409.3,",DA=SDWLDA D ^DIE
"RTN","SDWLE111",77,0)
 I $D(DUOUT) S SDWLERR=1
"RTN","SDWLE111",78,0)
END Q
"RTN","SDWLE111",79,0)
 ;
"RTN","SDWLE111",80,0)
 ;
"RTN","SDWLE111",81,0)
GETTM ;CHECK WAIT LIST FOR TEAM ASSIGNMENT.
"RTN","SDWLE111",82,0)
 Q:SDWLTEM  Q:'$D(SDWLDFN)  N SDWLDA1,SDWLX
"RTN","SDWLE111",83,0)
 S SDWLDA1=0 F  S SDWLDA1=$O(^SDWL(409.3,"B",SDWLDFN,SDWLDA1)) Q:SDWLDA1<1  D
"RTN","SDWLE111",84,0)
 .S SDWLX=$G(^SDWL(409.3,SDWLDA1,0)) I $P(SDWLX,U,17)="O",$P(SDWLX,U,6) S SDWLTEM=1
"RTN","SDWLE111",85,0)
 K SDWLDA1
"RTN","SDWLRP1")
0^2^B62309635^B52288379
"RTN","SDWLRP1",1,0)
SDWLRP1 ;;IOFO BAY PINES/TEH - WAITING LIST - RPC;06/28/2002 ; 26 Aug 2002  1:25 PM
"RTN","SDWLRP1",2,0)
 ;;5.3;scheduling;**263,273,485**;AUG 13 1993;Build 2
"RTN","SDWLRP1",3,0)
 ;
"RTN","SDWLRP1",4,0)
 ;
"RTN","SDWLRP1",5,0)
 ;******************************************************************
"RTN","SDWLRP1",6,0)
 ;                             CHANGE LOG
"RTN","SDWLRP1",7,0)
 ;                                               
"RTN","SDWLRP1",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLRP1",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLRP1",10,0)
 ;       2/21/03                                   SD*5.3*273                    Line new+12 added "/"
"RTN","SDWLRP1",11,0)
OUTPUT(SDWLOUT,SDWLDFN) ;-FULL
"RTN","SDWLRP1",12,0)
 ; input:
"RTN","SDWLRP1",13,0)
 ;   DFN = Patient
"RTN","SDWLRP1",14,0)
 ;     Lookup uses Wait List data file (409.3) and returns the following data.
"RTN","SDWLRP1",15,0)
 ;     
"RTN","SDWLRP1",16,0)
 ; output:
"RTN","SDWLRP1",17,0)
 ;   SCOUT = location of data = ^TMP("SDWLG",$J,i,0)
"RTN","SDWLRP1",18,0)
 ;   for i=1:number of records returned: 
"RTN","SDWLRP1",19,0)
 ;
"RTN","SDWLRP1",20,0)
 ;         Field  Location               Description
"RTN","SDWLRP1",21,0)
 ;
"RTN","SDWLRP1",22,0)
 ;               1               2                       ORIGINATION DATE
"RTN","SDWLRP1",23,0)
 ;               2               3                       INSTITUTION
"RTN","SDWLRP1",24,0)
 ;               3               4                       CLINIC
"RTN","SDWLRP1",25,0)
 ;               4               5                       WAIT LIST TYPE
"RTN","SDWLRP1",26,0)
 ;               5               6                       SPECIFIC TEAM
"RTN","SDWLRP1",27,0)
 ;               5.1             22                      MARKED OPEN (SPECIFIC TEAM)
"RTN","SDWLRP1",28,0)
 ;               6               7                       SPECIFIC POSITION
"RTN","SDWLRP1",29,0)
 ;               6.1             23                      MARKED OPEN (SPEICIFIC POSITION)
"RTN","SDWLRP1",30,0)
 ;               7               8                       SERVICE /SPECIALTY
"RTN","SDWLRP1",31,0)
 ;               8               9                       SPECIFIC CLINIC
"RTN","SDWLRP1",32,0)
 ;               9               10                      ORIGINATING USER
"RTN","SDWLRP1",33,0)
 ;               10              11                      PRIORITY
"RTN","SDWLRP1",34,0)
 ;               11              12                      REQUESTED BY
"RTN","SDWLRP1",35,0)
 ;               12              13                      PROVIDER
"RTN","SDWLRP1",36,0)
 ;               22              16                      DESIRED DATE OF APPT
"RTN","SDWLRP1",37,0)
 ;               23              17                      CURRENT STATUS
"RTN","SDWLRP1",38,0)
 ;               25              18                      COMMENTS
"RTN","SDWLRP1",39,0)
 ;               27              20                      NEW ENROLLE
"RTN","SDWLRP1",40,0)
 ;
"RTN","SDWLRP1",41,0)
 ;
"RTN","SDWLRP1",42,0)
 N DIERR,SDWLDAX
"RTN","SDWLRP1",43,0)
 I '$D(^SDWL(409.3,"B",SDWLDFN)) S SDWLRES=-1 Q  ;- No Entry in Wait List file.
"RTN","SDWLRP1",44,0)
 S SDWLDA="" F  S SDWLDA=$O(^SDWL(409.3,"B",SDWLDFN,SDWLDA)) Q:SDWLDA<1  D
"RTN","SDWLRP1",45,0)
 .S SDWLDAX="`"_SDWLDA
"RTN","SDWLRP1",46,0)
 .D FIND^DIC(409.3,,".01;1;2;3;4;5;5.1;6;6.1;7;8;9;10;11;12;15;22;23;25","PS",.SDWLDAX)
"RTN","SDWLRP1",47,0)
 I $G(DIERR) D CLEAN^DILF S SDWLRES=-1 Q
"RTN","SDWLRP1",48,0)
 K SDWLOUT S SDWLOUT=$NA(^TMP("DILIST",$J))
"RTN","SDWLRP1",49,0)
 Q
"RTN","SDWLRP1",50,0)
OUTPUT1(SDWLOUT,SDWLDFN) ;
"RTN","SDWLRP1",51,0)
 ;Brief Output - for Wait List.
"RTN","SDWLRP1",52,0)
 ; input:
"RTN","SDWLRP1",53,0)
 ;   DFN = Patient
"RTN","SDWLRP1",54,0)
 ;     Lookup uses Wait List data file (409.3) and returns the following data.
"RTN","SDWLRP1",55,0)
 ;     
"RTN","SDWLRP1",56,0)
 ; output:
"RTN","SDWLRP1",57,0)
 ;   SWDLRES = On/Not on Wait list^Number of IENs^IEN;IEN;IEN;IEN.....
"RTN","SDWLRP1",58,0)
 ;            1     0            ^      2       ^1;2
"RTN","SDWLRP1",59,0)
 ;     
"RTN","SDWLRP1",60,0)
 ;
"RTN","SDWLRP1",61,0)
 S SDWLCNT=0,SDWLIEN=""
"RTN","SDWLRP1",62,0)
 I '$D(^SDWL(409.3,"B",SDWLDFN)) S SDWLRES=$NA(^TMP("SDWLRP1",$J)),^TMP("SDWLRP1",$J,1)=-1
"RTN","SDWLRP1",63,0)
 S SDWLDA=""  F  S SDWLDA=$O(^SDWL(409.3,"B",SDWLDFN,SDWLDA)) Q:SDWLDA<1  D
"RTN","SDWLRP1",64,0)
 .I $P(^SDWL(409.3,SDWLDA,0),U,17)["C" Q
"RTN","SDWLRP1",65,0)
 .S SDWLCNT=SDWLCNT+1
"RTN","SDWLRP1",66,0)
 .S ^TMP("SDWLRP1",$J,SDWLCNT)=SDWLDA_"^"_$G(^SDWL(409.3,SDWLDA,0))
"RTN","SDWLRP1",67,0)
 S SDWLOUT=$NA(^TMP("SDWLRP1",$J))
"RTN","SDWLRP1",68,0)
 K SDWLDFN,SDWLDA,SDWLCNT,SDWLIEN
"RTN","SDWLRP1",69,0)
 Q
"RTN","SDWLRP1",70,0)
OUTPUT3(SDWLOUT,SDWLDFN) ;Disposition Data
"RTN","SDWLRP1",71,0)
 ; 
"RTN","SDWLRP1",72,0)
 ;  input:
"RTN","SDWLRP1",73,0)
 ;    DFN = Patient Internal ID
"RTN","SDWLRP1",74,0)
 ;    
"RTN","SDWLRP1",75,0)
 ;  output: Subscript 'DIS'
"RTN","SDWLRP1",76,0)
 ;    Date Dsipositioned^Disposition by^Disposition  
"RTN","SDWLRP1",77,0)
 ;
"RTN","SDWLRP1",78,0)
 N SDWLRES,SDWLDFN,SDWLDA,DIERR
"RTN","SDWLRP1",79,0)
 I '$D(^SDWL(409.3,"B",SDWLDFN)) S SDWLRES=-1 Q  ;- No Entry in Wait List file.
"RTN","SDWLRP1",80,0)
 S SDWLDA="" F  S SDWLDA=$O(^SDWL(409.3,"B",SDWLDFN,SDWLDA)) Q:SDWLDA<1  D
"RTN","SDWLRP1",81,0)
 .S SDWLDAX="`"_SDWLDA
"RTN","SDWLRP1",82,0)
 .D FIND^DIC(409.3,,"19;20;21","PS",.SDWLDAX)
"RTN","SDWLRP1",83,0)
 I $G(DIERR) D CLEAN^DILF S SDWLRES=-1 Q
"RTN","SDWLRP1",84,0)
 K SDWLOUT S SDWLOUT="^TMP(""DILIST"","_$J_")",SDWLRES=1
"RTN","SDWLRP1",85,0)
 Q
"RTN","SDWLRP1",86,0)
INPUT(SDWLRES,SDWLSTR) ;
"RTN","SDWLRP1",87,0)
 ;
"RTN","SDWLRP1",88,0)
 ;     
"RTN","SDWLRP1",89,0)
 ; Input:
"RTN","SDWLRP1",90,0)
 ;   SDWLSTR = location of data = ^TMP("SDWLG",$J,i,0)
"RTN","SDWLRP1",91,0)
 ;   (R) = Required Field
"RTN","SDWLRP1",92,0)
 ;   (O) = Optional
"RTN","SDWLRP1",93,0)
 ;   
"RTN","SDWLRP1",94,0)
 ;    .01    2           3                     5                  6                    
"RTN","SDWLRP1",95,0)
 ;  DFN (R)^TYPE (R)^SPECIFIC TEAM (O)^SPECIFIC POSITION (O)^ORGINATING USER (R)
"RTN","SDWLRP1",96,0)
 ;     1     2           3                     4                  5
"RTN","SDWLRP1",97,0)
 ;
"RTN","SDWLRP1",98,0)
 ;  Output:
"RTN","SDWLRP1",99,0)
 ;               SDWLRES  =  0      Failed
"RTN","SDWLRP1",100,0)
 ;               SDWLRES  =  1^IEN  Saved to ^SDWL(409.3,IEN,0)            
"RTN","SDWLRP1",101,0)
 ;
"RTN","SDWLRP1",102,0)
 ;
"RTN","SDWLRP1",103,0)
 N DIERR,%H,SDWLF,SDWLFLD,SDWLFLG,SDWLI,SDWLIN,SDWLMSG,SDWLRNED,SDWLTP,SDWLVAL,SDWLX,SDWLY,X,Y
"RTN","SDWLRP1",104,0)
 K ^TMP("SDWLIN",$J),^TMP("SDWLOUT",$J),^TMP("DIERR",$J)
"RTN","SDWLRP1",105,0)
 I '$G(SDWLSTR) S SDWLRES="-1^Data String Missing" Q
"RTN","SDWLRP1",106,0)
 D NEW
"RTN","SDWLRP1",107,0)
 D FDA I SDWLRES<0 D DEL Q
"RTN","SDWLRP1",108,0)
 ;D VAL I SDWLRES<0 D DEL Q
"RTN","SDWLRP1",109,0)
 D SET I SDWLRES<0 D DEL Q
"RTN","SDWLRP1",110,0)
 D CLEAN^DILF K ^TMP("SDWLIN",$J),^TMP("SDWLOUT",$J)
"RTN","SDWLRP1",111,0)
 Q
"RTN","SDWLRP1",112,0)
NEW ;Get IEN from ^SDWL(409.3,IEN,0).
"RTN","SDWLRP1",113,0)
 ;
"RTN","SDWLRP1",114,0)
 N DA,DIC,DIE,DIK,DR
"RTN","SDWLRP1",115,0)
 I $P(SDWLSTR,U,4) D
"RTN","SDWLRP1",116,0)
 .S SDWLTP=+$P(SDWLSTR,U,4)
"RTN","SDWLRP1",117,0)
 .S SDWLIN=$P($G(^SCTM(404.51,+$P(^SCTM(404.57,SDWLTP,0),U,2),0)),U,7)
"RTN","SDWLRP1",118,0)
 I $P(SDWLSTR,U,3) D
"RTN","SDWLRP1",119,0)
 .S SDWLIN=$P($G(^SCTM(404.51,+$P(SDWLSTR,U,3),0)),U,7)
"RTN","SDWLRP1",120,0)
 S SDWLDFN=+$P(SDWLSTR,U,1)
"RTN","SDWLRP1",121,0)
 S DIC(0)="LX",X=$P(SDWLSTR,U,1),DIC="^SDWL(409.3," D FILE^DICN I Y<0 S SDWLRES="-1^IEN failed" Q
"RTN","SDWLRP1",122,0)
 S SDWLDFN=$P(Y,U,2),SDWLDA=+Y,SDWLDUZ=$P(SDWLSTR,U,9)
"RTN","SDWLRP1",123,0)
 S DIE="^SDWL(409.3,",DA=SDWLDA
"RTN","SDWLRP1",124,0)
 S DR="1///^S X=DT" D ^DIE
"RTN","SDWLRP1",125,0)
 S DR="2////^S X=SDWLIN" D ^DIE
"RTN","SDWLRP1",126,0)
 S DR="23///^S X=""O""",DIE="^SDWL(409.3," D ^DIE
"RTN","SDWLRP1",127,0)
 ;
"RTN","SDWLRP1",128,0)
 ;DETERMINE ENROLLEE STATUS
"RTN","SDWLRP1",129,0)
 ;
"RTN","SDWLRP1",130,0)
 ;SDWLE=1 = NEW ENROLLEE
"RTN","SDWLRP1",131,0)
 ;SDWLE=2 = ESTABLISHED
"RTN","SDWLRP1",132,0)
 ;SDWLE=3 = PRIOR ENROLLEE
"RTN","SDWLRP1",133,0)
 ;SDWLE=4 = UNDETERMINED
"RTN","SDWLRP1",134,0)
 ;
"RTN","SDWLRP1",135,0)
 S SDWLDE=+$H,SDWLE=0,(SDWLEE,SDWLRNED,SDWLDB)=0 D SB1
"RTN","SDWLRP1",136,0)
 G SB0:SDWLE=2
"RTN","SDWLRP1",137,0)
 S SDWLRNE=$$ENROLL^EASWTAPI(SDWLDFN) G SB0:$P(SDWLRNE,U,4)="A" S SDWLRNED=$P(SDWLRNE,U,3)
"RTN","SDWLRP1",138,0)
 I SDWLRNED S X=SDWLRNED D H^%DTC S SDWLDS=%H S SDWLDE=+$H,SDWLDET=SDWLDE-SDWLDS,SDWLDB=2 I SDWLDET<366 S SDWLE=1
"RTN","SDWLRP1",139,0)
 I $D(SDWLDET),SDWLDET>365 S SDWLE=3
"RTN","SDWLRP1",140,0)
 I 'SDWLRNE S SDWLE=4
"RTN","SDWLRP1",141,0)
SB0 I $D(SDWLRNE),$P(SDWLRNE,U,4)="A" D
"RTN","SDWLRP1",142,0)
 .I 'SDWLRNE,SDWLEE>730!(SDWLEE=730) S SDWLE=4 Q
"RTN","SDWLRP1",143,0)
 .I 'SDWLEE S SDWLE=4 Q
"RTN","SDWLRP1",144,0)
 S SDWLRNE=$S(SDWLE=1:"N",SDWLE=2:"E",SDWLE=3:"P",SDWLE=4:"U",1:"U")
"RTN","SDWLRP1",145,0)
 ;-Code here for filling in 409.3
"RTN","SDWLRP1",146,0)
 S DR="27////^S X=SDWLRNE",DIE="^SDWL(409.3,",DA=SDWLDA D ^DIE
"RTN","SDWLRP1",147,0)
 S DR="9////^S X=DUZ" D ^DIE
"RTN","SDWLRP1",148,0)
 S DR="27.1////^S X=$S(SDWLRNED,SDWLRNED,$D(SDWLD):SDWLD,1:"""")" D ^DIE
"RTN","SDWLRP1",149,0)
 S DR="27.2////^S X=SDWLDB" D ^DIE
"RTN","SDWLRP1",150,0)
 K SDWLRNE,SDWLD,SDWLDE,SDWLEE,SDWLDET,DIC,DIR,DR,DIE,SDWLDS,SDWLE
"RTN","SDWLRP1",151,0)
 Q
"RTN","SDWLRP1",152,0)
SB1 I '$D(^DGCN(391.91,"B",SDWLDFN)) N SDWLDB S SDWLE=3 Q
"RTN","SDWLRP1",153,0)
 S SDWLX="" F  S SDWLX=$O(^DGCN(391.91,"B",SDWLDFN,SDWLX)) Q:SDWLX=""  D
"RTN","SDWLRP1",154,0)
 .S SDWLY=$G(^DGCN(391.91,SDWLX,0)) D
"RTN","SDWLRP1",155,0)
 ..;CHECK FOR TREATING FACILITY
"RTN","SDWLRP1",156,0)
 ..I $$TF^XUAF4(+$P(SDWLY,U,2)) D
"RTN","SDWLRP1",157,0)
 ...;SORT FOR LAST TREATMENT DATE
"RTN","SDWLRP1",158,0)
 ...S SDWLD=$P(SDWLY,U,3) I SDWLD S SDWLDTF(9999999-SDWLD)=SDWLX
"RTN","SDWLRP1",159,0)
 I '$D(SDWLDTF) Q
"RTN","SDWLRP1",160,0)
 S SDWLDTF=$O(SDWLDTF(0)) I SDWLDTF S (SDWLD,X)=9999999-SDWLDTF D H^%DTC S SDWLEE=SDWLDE-%H,SDWLDB=1 I SDWLEE<730 S SDWLE=2
"RTN","SDWLRP1",161,0)
 I $D(SDWLEE),SDWLEE>730!(SDWLEE=730) S SDWLE=3
"RTN","SDWLRP1",162,0)
 K SDWLDTF
"RTN","SDWLRP1",163,0)
 Q
"RTN","SDWLRP1",164,0)
FDA ;Get data from SDWLSTR string and set FDA.
"RTN","SDWLRP1",165,0)
 S SDWLF=409.3
"RTN","SDWLRP1",166,0)
 S SDWLVAL="" F SDWLI=2:1:7 S SDWLVAL=$P(SDWLSTR,"^",SDWLI) D
"RTN","SDWLRP1",167,0)
 .S SDWLFLD=SDWLI D
"RTN","SDWLRP1",168,0)
 ..S SDWLFLD=$S(SDWLFLD=2:4,SDWLFLD=3:5,SDWLFLD=4:6,SDWLFLD=5:9,SDWLFLD=7:15,1:25)
"RTN","SDWLRP1",169,0)
 .S SDWLFLG="F",SDWLIEN=$$IENS^DILF(SDWLDA) ;,SDWLVAL=$$EXTERNAL^DILFD(SDWLF,SDWLFLD,,SDWLVAL,"SDWLMSG")
"RTN","SDWLRP1",170,0)
 .I $D(SDWLMSG) M SDWLRES=SDWLMSG S SDWLRES=-1 Q
"RTN","SDWLRP1",171,0)
 .D FDA^DILF(SDWLF,SDWLIEN,SDWLFLD,"",SDWLVAL,"^TMP(""SDWLIN"",$J)")
"RTN","SDWLRP1",172,0)
 .S SDWLRES=1 M SDWLRES("SDWLIN")=^TMP("SDWLIN",$J)
"RTN","SDWLRP1",173,0)
 Q
"RTN","SDWLRP1",174,0)
VAL ;Validate fields
"RTN","SDWLRP1",175,0)
 ;
"RTN","SDWLRP1",176,0)
 N DIERR
"RTN","SDWLRP1",177,0)
 D VALS^DIE(,"^TMP(""SDWLIN"",$J)","^TMP(""SDWLOUT"",$J)","SDWLMSG")
"RTN","SDWLRP1",178,0)
 I $G(SDWLMSG("DIERR")) S SDWLRES=-1 Q
"RTN","SDWLRP1",179,0)
 M SDWLRES("SDWLOUT")=^TMP("SDWLOUT",$J)
"RTN","SDWLRP1",180,0)
 Q
"RTN","SDWLRP1",181,0)
 ;
"RTN","SDWLRP1",182,0)
SET ;Input data to file ^SDWL(409.3,IEN,0).
"RTN","SDWLRP1",183,0)
 D UPDATE^DIE(,"^TMP(""SDWLIN"",$J)","SDWLMSG")
"RTN","SDWLRP1",184,0)
 I $G(SDWLMSG("DIERR")) S SDWLRES=-1 Q
"RTN","SDWLRP1",185,0)
 S SDWLRES=1_"^"_$G(SDWLDA)
"RTN","SDWLRP1",186,0)
 Q
"RTN","SDWLRP1",187,0)
DEL S DA=SDWLDA,DIK="^SDWL(409.3," D ^DIK
"RTN","SDWLRP1",188,0)
 S SDWLRES="-1^Entry "_SDWLDA_" Deleted"
"RTN","SDWLRP1",189,0)
 Q
"RTN","SDWLRP1",190,0)
INPUTDP(SDWLRES,SDWLSTR) ;Set disposition in Wait List Patient file
"RTN","SDWLRP1",191,0)
 ;
"RTN","SDWLRP1",192,0)
 ;
"RTN","SDWLRP1",193,0)
 ;
"RTN","SDWLRP1",194,0)
 ;       Input:
"RTN","SDWLRP1",195,0)
 ;       
"RTN","SDWLRP1",196,0)
 ;               SDWLSTR=Patient DFN^Disposition^User DUZ^Wait List IEN
"RTN","SDWLRP1",197,0)
 ;               
"RTN","SDWLRP1",198,0)
 ;       Ouput:
"RTN","SDWLRP1",199,0)
 ;       
"RTN","SDWLRP1",200,0)
 ;           SDWLRES=-1 Failed
"RTN","SDWLRP1",201,0)
 ;           SDWKRES=1^IEN for Wait List File (409.3)
"RTN","SDWLRP1",202,0)
 ;
"RTN","SDWLRP1",203,0)
 N SDWLDFN,SDWLDISP,SDWLDUZ,SDWLDA,SDWLDDT
"RTN","SDWLRP1",204,0)
 I '$G(SDWLSTR) S SDWLRES="-1^Data String Missing" Q
"RTN","SDWLRP1",205,0)
 I '$G(^SDWL(409.3,SDWLDA,0)) S SDWLRES="-1^Missing Patient IEN" Q
"RTN","SDWLRP1",206,0)
 I '$D(^SDWL(409.3,"B",SDWLDFN)) S SDWLRES="-1^Missing Wait List data file" Q
"RTN","SDWLRP1",207,0)
 D FDA1 I SDWLRES<0 D DEL1 Q
"RTN","SDWLRP1",208,0)
 D VAL1 I SDWLRES<0 D DEL1 Q
"RTN","SDWLRP1",209,0)
 D SET1 I SDWLRES<0 D DEL1 Q
"RTN","SDWLRP1",210,0)
 D CLEAN^DILF K ^TMP("SDWLIN",$J),^TMP("SDWLOUT",$J)
"RTN","SDWLRP1",211,0)
 Q
"RTN","SDWLRP1",212,0)
FDA1 ;
"RTN","SDWLRP1",213,0)
 S SDWLDFN=$P(SDWLSTR,U,1),SDWLDISP=$P(SDWLSTR,U,2),SDWLDUZ=$P(SDWLSTR,U,3),SDWLDA=$P(SDWLSTR,U,4),SDWLDDT=DT
"RTN","SDWLRP1",214,0)
 S SDWLIEN=$$IENS^DILF(SDWLDA)
"RTN","SDWLRP1",215,0)
 F SDWLI=1:1:4 S SDWLVAL=$S(SDWLI=1:SDWLDISP,SDWLI=2:SDWLDUZ,SDWLI=3:SDWLDDT,SDWLI=4:"C"),SDWLFLD=$S(SDWLI=1:21,SDWLI=2:20,SDWLI=3:19,SDWLI=4:23) D
"RTN","SDWLRP1",216,0)
 .S SDWLVAL=$$EXTERNAL^DILFD(SDWLF,SDWLFLD,,SDWLVAL,"SDWLMSG")
"RTN","SDWLRP1",217,0)
 .I $D(SDWLMSG) M SDWLRES=SDWLMSG S SDWLRES=-1 Q
"RTN","SDWLRP1",218,0)
 .D FDA^DILF(SDWLF,SDWLIEN,SDWLFLD,"",SDWLVAL,"^TMP(""SDWLIN"",$J)")
"RTN","SDWLRP1",219,0)
 .S SDWLRES=1 M SDWLRES("SDWLIN")=^TMP("SDWLIN",$J)
"RTN","SDWLRP1",220,0)
 Q
"RTN","SDWLRP1",221,0)
VAL1 ;
"RTN","SDWLRP1",222,0)
 N DIERR
"RTN","SDWLRP1",223,0)
 D VALS^DIE(,"^TMP(""SDWLIN"",$J)","^TMP(""SDWLOUT"",$J)","SDWLMSG")
"RTN","SDWLRP1",224,0)
 I $G(SDWLMSG("DIERR")) S SDWLRES=-1 Q
"RTN","SDWLRP1",225,0)
 M SDWLRES("SDWLOUT")=^TMP("SDWLOUT",$J)
"RTN","SDWLRP1",226,0)
 Q
"RTN","SDWLRP1",227,0)
SET1 ;
"RTN","SDWLRP1",228,0)
 D UPDATE^DIE(,"^TMP(""SDWLOUT"",$J)","SDWLMSG")
"RTN","SDWLRP1",229,0)
 I $G(SDWLMSG("DIERR")) S SDWLRES=-1 Q
"RTN","SDWLRP1",230,0)
 S SDWLRES=1
"RTN","SDWLRP1",231,0)
 Q
"RTN","SDWLRP1",232,0)
DEL1 ;
"RTN","SDWLRP1",233,0)
 S DA(1)=SDWLDA,DIK="^SDWL("_DA(1)_",""DIS""," F DA=19,20,21,23 D ^DIK
"RTN","SDWLRP1",234,0)
 S SDWLRES="-1^"_"Disposition Nodes Deleted."
"RTN","SDWLRP1",235,0)
 Q
"RTN","SDWLRP4")
0^3^B42653534^B36581660
"RTN","SDWLRP4",1,0)
SDWLRP4 ;IOFO BAY PINES/TEH - WAITING LIST - MERGE RPC;06/28/2002 ; 26 Aug 2002  1:25 PM
"RTN","SDWLRP4",2,0)
 ;;5.3;scheduling;**263,485**;AUG 13 1993;Build 2
"RTN","SDWLRP4",3,0)
 ;
"RTN","SDWLRP4",4,0)
INPUT(SDWLRES,SDWLSTR) ;
"RTN","SDWLRP4",5,0)
 ;
"RTN","SDWLRP4",6,0)
 ;     
"RTN","SDWLRP4",7,0)
 ; Input:
"RTN","SDWLRP4",8,0)
 ;   SDWLSTR = location of data = ^TMP("SDWLG",$J,i,0)
"RTN","SDWLRP4",9,0)
 ;   (R) = Required Field
"RTN","SDWLRP4",10,0)
 ;   (O) = Optional
"RTN","SDWLRP4",11,0)
 ;   
"RTN","SDWLRP4",12,0)
 ;   .01                2             3        4          5           9               10        11           23       22
"RTN","SDWLRP4",13,0)
 ;  SSN (R)^ORIGINATING DATE^INSTITUTION^TYPE (R)^^TYPE MOD^ORGINATING USER (R)^PRIORITY^REQUEST BY^CURRENT STATUS^DESIRED DATE
"RTN","SDWLRP4",14,0)
 ;    1              2                3        4        6/7/8/9       10               11       12              17    16   
"RTN","SDWLRP4",15,0)
 ;
"RTN","SDWLRP4",16,0)
 ;  Output:
"RTN","SDWLRP4",17,0)
 ;               SDWLRES  =  -1^MESSAGE      Failed
"RTN","SDWLRP4",18,0)
 ;               SDWLRES  =  1^IEN  Saved to ^SDWL(409.3,IEN,0)            
"RTN","SDWLRP4",19,0)
 ;
"RTN","SDWLRP4",20,0)
 ;
"RTN","SDWLRP4",21,0)
 K ^TMP("SDWLIN",$J),^TMP("SDWLOUT",$J),^TMP("DIERR",$J),D
"RTN","SDWLRP4",22,0)
 I '$G(SDWLSTR) S SDWLRES="-1^Data String Missing^Failed" Q
"RTN","SDWLRP4",23,0)
 I $P(SDWLSTR,U)="" S SDWLRES="-1^No SSN^Failed" Q
"RTN","SDWLRP4",24,0)
 I $P(SDWLSTR,U,3)="" S SDWLRES="-1^No Insitution^Failed" Q
"RTN","SDWLRP4",25,0)
 I $P(SDWLSTR,U,4)="" S SDWLRES="-1^No Type^Failed" Q
"RTN","SDWLRP4",26,0)
 I $P(SDWLSTR,U,6)="",$P(SDWLSTR,U,7)="",$P(SDWLSTR,U,8)="",$P(SDWLSTR,U,9)="" S SDWLRES="-1^No Type Modifier^Failed" Q
"RTN","SDWLRP4",27,0)
 I $P(SDWLSTR,U,11)'="",$$DCHK($P(SDWLSTR,U,11))<1 S SDWLRES="-1^Invalid Date^Failed" Q
"RTN","SDWLRP4",28,0)
 S $P(SDWLSTR,U)=$TR($P(SDWLSTR,U),"-","")
"RTN","SDWLRP4",29,0)
 D NEW
"RTN","SDWLRP4",30,0)
 I $P(SDWLRES,U,1)<0 Q
"RTN","SDWLRP4",31,0)
 D FDA I SDWLRES<0 D DEL Q
"RTN","SDWLRP4",32,0)
 D SET I SDWLRES<0 D DEL Q
"RTN","SDWLRP4",33,0)
 D CLEAN^DILF K ^TMP("SDWLIN",$J),^TMP("SDWLOUT",$J)
"RTN","SDWLRP4",34,0)
 Q
"RTN","SDWLRP4",35,0)
NEW ;Get IEN from ^SDWL(409.3,IEN,0).
"RTN","SDWLRP4",36,0)
 N SDWLTP,SDWL6,SDWL6P,SDWL7,SDWL7P,SDWL8,SDWL8P,SDWL9,SDWL9P,SDWLMOD,SDWLTP,SDWLIN,SDWLDFN
"RTN","SDWLRP4",37,0)
 N SDWLPRI,SDWLODUZ,SDWLRBY
"RTN","SDWLRP4",38,0)
 S SDWLRES=""
"RTN","SDWLRP4",39,0)
 I $P(SDWLSTR,U,4) D
"RTN","SDWLRP4",40,0)
 .S SDWLTP=+$P(SDWLSTR,U,4),(SDWL6,SDWL7,SDWL8,SDWL9)="",SDWLMOD=0 D
"RTN","SDWLRP4",41,0)
 ..I SDWLTP=1 S SDWL6=$P(SDWLSTR,U,6),SDWL6=$O(^SCTM(404.51,"B",SDWL6,"")) I SDWL6'="" S SDWL6P=$O(^SCTM(404.51,"B",SDWL6,0)),SDWLMOD=1
"RTN","SDWLRP4",42,0)
 ..I SDWLTP=2 S SDWL7=$P(SDWLSTR,U,7),SDWL7=$O(^SCTM(404.57,"B",SDWL7,"")) I SDWL7'="" S SDWL7P=$O(^SCTM(404.57,"B",SDWL7,0)),SDWLMOD=1
"RTN","SDWLRP4",43,0)
 ..I SDWLTP=3 S SDWL8=$P(SDWLSTR,U,8),SDWL80="" F  S SDWL80=$O(^DIC(40.7,"B",SDWL8,SDWL80))  Q:SDWL80=""  D
"RTN","SDWLRP4",44,0)
 ...I $D(^SDWL(409.31,"B",SDWL80)) S SDWL8=$O(^SDWL(409.31,"B",SDWL80,0)),$P(SDWLSTR,U,8)=SDWL8,SDWLMOD=1
"RTN","SDWLRP4",45,0)
 ..I SDWLTP=4 S SDWL9=$P(SDWLSTR,U,9),SDWL90="" F SDWL90=$O(^SC("B",SDWL9,SDWL90)) Q:SDWL90=""  D
"RTN","SDWLRP4",46,0)
 ...I $D(^SDWL(409.32,"B",SDWL90)) S SDWL9=$O(^SDWL(409.32,"B",SDWL90,0)),$P(SDWLSTR,U,9)=SDWL9,SDWLMOD=1
"RTN","SDWLRP4",47,0)
 I 'SDWLMOD S SDWLRES="-1^No Type Mod found^Failed" Q
"RTN","SDWLRP4",48,0)
 S SDWLIN=$P(SDWLSTR,U,3) I SDWLIN="" S SDWLRES="-1^No Institution^Failed" Q
"RTN","SDWLRP4",49,0)
 S SDWLIN=$O(^DIC(4,"B",SDWLIN,0)) I SDWLIN="" S SDWLRES="-1^Invalid Institution^Failed" Q
"RTN","SDWLRP4",50,0)
 S SDWLDFN=$P(SDWLSTR,U,1) S D="SSN",DIC(0)="MNZ",X=SDWLDFN,D="SSN",DIC=2 D IX^DIC I Y<0 S SDWLRES="-1^SSN failed" Q
"RTN","SDWLRP4",51,0)
 S SDWLDFN=+Y
"RTN","SDWLRP4",52,0)
 I SDWLDFN="" S SDWLRES="-1^Invalid SSN^Failed" Q
"RTN","SDWLRP4",53,0)
 I $$DUP(SDWLDFN) S SDWLRES="-1^Duplicate^Failed" Q
"RTN","SDWLRP4",54,0)
 S SDWLPRI=$S($P(SDWLSTR,U,11)="":"A",1:"F")
"RTN","SDWLRP4",55,0)
 S SDWLODUZ=.5,SDWLRBY=2
"RTN","SDWLRP4",56,0)
 I SDWLTP=1!(SDWLTP=2) S SDWLPRI="A",SDWLRBY=""
"RTN","SDWLRP4",57,0)
 S SDWLSTRN=SDWLTP_"^"_SDWLPRI_"^"_SDWLODUZ_"^"_SDWLRBY_"^"_SDWL6_"^"_SDWL7_"^"_SDWL8_"^"_SDWL9
"RTN","SDWLRP4",58,0)
 S DIC(0)="LX",X=SDWLDFN,DIC="^SDWL(409.3," D FILE^DICN I Y<0 S SDWLRES="-1^IEN failed^Failed" Q
"RTN","SDWLRP4",59,0)
 S SDWLDFN=$P(Y,U,2),SDWLDA=+Y,SDWLDUZ=$P(SDWLSTR,U,9)
"RTN","SDWLRP4",60,0)
 S DIE="^SDWL(409.3,",DA=SDWLDA
"RTN","SDWLRP4",61,0)
 I SDWLPRI="F" D
"RTN","SDWLRP4",62,0)
 .S DR="22///"_$P(SDWLSTR,U,11) D ^DIE
"RTN","SDWLRP4",63,0)
 I SDWLPRI="A",SDWLTP=3!(SDWLTP=4) D
"RTN","SDWLRP4",64,0)
 .S DR="22///^S X=DT" D ^DIE
"RTN","SDWLRP4",65,0)
 S DR="1////^S X=DT" D ^DIE
"RTN","SDWLRP4",66,0)
 S DR="2////^S X=SDWLIN" D ^DIE
"RTN","SDWLRP4",67,0)
 S DR="23////^S X=""O""",DIE="^SDWL(409.3," D ^DIE K DIE,DR,DA
"RTN","SDWLRP4",68,0)
 ;
"RTN","SDWLRP4",69,0)
 ;SET DATE OF DEATH
"RTN","SDWLRP4",70,0)
 ;
"RTN","SDWLRP4",71,0)
 S X=$$GET1^DIQ(2,SDWLDFN_",",".351") I X'="" D
"RTN","SDWLRP4",72,0)
 .S DA=SDWLDA
"RTN","SDWLRP4",73,0)
 .S DR="19////^S X=DT",DIE="^SDWL(409.3," D ^DIE
"RTN","SDWLRP4",74,0)
 .S DR="20////^S X=DUZ" D ^DIE
"RTN","SDWLRP4",75,0)
 .S DR="23////^S X=""C""" D ^DIE
"RTN","SDWLRP4",76,0)
 .S DR="21////^S X=""D""" D ^DIE K DIE,DR,DA
"RTN","SDWLRP4",77,0)
 ;
"RTN","SDWLRP4",78,0)
 ;DETERMINE ENROLLEE STATUS
"RTN","SDWLRP4",79,0)
 ;
"RTN","SDWLRP4",80,0)
 ;SDWLE=1 = NEW ENROLLEE
"RTN","SDWLRP4",81,0)
 ;SDWLE=2 = ESTABLISHED
"RTN","SDWLRP4",82,0)
 ;SDWLE=3 = PRIOR ENROLLEE
"RTN","SDWLRP4",83,0)
 ;SDWLE=4 = UNDETERMINED
"RTN","SDWLRP4",84,0)
 ;
"RTN","SDWLRP4",85,0)
 S SDWLDE=+$H,SDWLE=0,(SDWLEE,SDWLRNED,SDWLDB)=0 D SB1
"RTN","SDWLRP4",86,0)
 G SB0:SDWLE=2
"RTN","SDWLRP4",87,0)
 S SDWLRNE=$$ENROLL^EASWTAPI(SDWLDFN) G SB0:$P(SDWLRNE,U,4)="A" S SDWLRNED=$P(SDWLRNE,U,3)
"RTN","SDWLRP4",88,0)
 I SDWLRNED S X=SDWLRNED D H^%DTC S SDWLDS=%H S SDWLDE=+$H,SDWLDET=SDWLDE-SDWLDS I SDWLDET<366 S SDWLE=1
"RTN","SDWLRP4",89,0)
 I $D(SDWLDET),SDWLDET>365 S SDWLE=3
"RTN","SDWLRP4",90,0)
 I 'SDWLRNE S SDWLE=4
"RTN","SDWLRP4",91,0)
SB0 I $D(SDWLRNE),$P(SDWLRNE,U,4)="A" D
"RTN","SDWLRP4",92,0)
 .I 'SDWLEE.SDWLEE>730!(SDWLEE=730) S SDWLE=4 Q
"RTN","SDWLRP4",93,0)
 .I 'SDWLEE S SDWLE=4 Q
"RTN","SDWLRP4",94,0)
 S SDWLRNE=$S(SDWLE=1:"N",SDWLE=2:"E",SDWLE=3:"P",SDWLE=4:"U",1:"U")
"RTN","SDWLRP4",95,0)
 ;-Code here for filling in 409.3
"RTN","SDWLRP4",96,0)
 S DR="27////^S X=SDWLRNE",DIE="^SDWL(409.3,",DA=SDWLDA D ^DIE
"RTN","SDWLRP4",97,0)
 S DR="27.1////^S X=$S(SDWLRNED:SDWLRNED,$D(SDWLD:SDWLD,1:"""")" D ^DIE
"RTN","SDWLRP4",98,0)
 S DR="27.2////^S X=SDWLDB" D ^DIE
"RTN","SDWLRP4",99,0)
 S DR="9////^S X=DUZ" D ^DIE K DIE,DA,DR,%H
"RTN","SDWLRP4",100,0)
 K SDWLRNE,SDWLD,SDWLDE,SDWLEE,SDWLDET,DIC,DIR,DR,DIE,SDWLDS,SDWLE,SDWLRNED
"RTN","SDWLRP4",101,0)
 Q
"RTN","SDWLRP4",102,0)
SB1 I '$D(^DGCN(391.91,"B",SDWLDFN)) N SDWLDB S SDWLE=3 Q
"RTN","SDWLRP4",103,0)
 S SDWLX="" F  S SDWLX=$O(^DGCN(391.91,"B",SDWLDFN,SDWLX)) Q:SDWLX=""  D
"RTN","SDWLRP4",104,0)
 .S SDWLY=$G(^DGCN(391.91,SDWLX,0)) D
"RTN","SDWLRP4",105,0)
 ..;CHECK FOR TREATING FACILITY
"RTN","SDWLRP4",106,0)
 ..I $$TF^XUAF4(+$P(SDWLY,U,2)) D
"RTN","SDWLRP4",107,0)
 ...;SORT FOR LAST TREATMENT DATE
"RTN","SDWLRP4",108,0)
 ...S SDWLD=$P(SDWLY,U,3) I SDWLD S SDWLDTF(9999999-SDWLD)=SDWLX
"RTN","SDWLRP4",109,0)
 I '$D(SDWLDTF) Q
"RTN","SDWLRP4",110,0)
 S SDWLDTF=$O(SDWLDTF(0)) I SDWLDTF S (SDWLD,X)=9999999-SDWLDTF D H^%DTC S SDWLEE=SDWLDE-%H,SDWLDB=1 I SDWLEE<730 S SDWLE=2
"RTN","SDWLRP4",111,0)
 I $D(SDWLEE),SDWLEE>730 S SDWLE=3
"RTN","SDWLRP4",112,0)
 K SDWLDTF
"RTN","SDWLRP4",113,0)
 Q
"RTN","SDWLRP4",114,0)
FDA ;Get data from SDWLSTR string and set FDA.
"RTN","SDWLRP4",115,0)
 S SDWLF=409.3
"RTN","SDWLRP4",116,0)
 S SDWLVAL="" F SDWLI=1,2,3,4,5,6,7,8 S SDWLVAL=$P(SDWLSTRN,"^",SDWLI) D
"RTN","SDWLRP4",117,0)
 .S SDWLFLD=SDWLI D
"RTN","SDWLRP4",118,0)
 ..S SDWLFLD=$S(SDWLFLD=1:4,SDWLFLD=2:10,SDWLFLD=3:9,SDWLFLD=4:11,SDWLFLD=5:5,SDWLFLD=6:6,SDWLFLD=7:7,SDWLFLD=8:8)
"RTN","SDWLRP4",119,0)
 .S SDWLFLG="F",SDWLIEN=$$IENS^DILF(SDWLDA) ;,SDWLVAL=$$EXTERNAL^DILFD(SDWLF,SDWLFLD,,SDWLVAL,"SDWLMSG")
"RTN","SDWLRP4",120,0)
 .I $D(SDWLMSG) M SDWLRES=SDWLMSG S SDWLRES=-1 Q
"RTN","SDWLRP4",121,0)
 .D FDA^DILF(SDWLF,SDWLIEN,SDWLFLD,"",SDWLVAL,"^TMP(""SDWLIN"",$J)")
"RTN","SDWLRP4",122,0)
 .S SDWLRES=1 M SDWLRES("SDWLIN")=^TMP("SDWLIN",$J)
"RTN","SDWLRP4",123,0)
 Q
"RTN","SDWLRP4",124,0)
VAL ;Validate fields
"RTN","SDWLRP4",125,0)
 ;
"RTN","SDWLRP4",126,0)
 D VALS^DIE(,"^TMP(""SDWLIN"",$J)","^TMP(""SDWLOUT"",$J)","SDWLMSG")
"RTN","SDWLRP4",127,0)
 I $G(SDWLMSG("DIERR")) S SDWLRES=-1 Q
"RTN","SDWLRP4",128,0)
 M SDWLRES("SDWLOUT")=^TMP("SDWLOUT",$J)
"RTN","SDWLRP4",129,0)
 Q
"RTN","SDWLRP4",130,0)
 ;
"RTN","SDWLRP4",131,0)
SET ;Input data to file ^SDWL(409.3,IEN,0)
"RTN","SDWLRP4",132,0)
 D UPDATE^DIE(,"^TMP(""SDWLIN"",$J)","SDWLMSG")
"RTN","SDWLRP4",133,0)
 I $G(SDWLMSG("DIERR")) S SDWLRES=-1 Q
"RTN","SDWLRP4",134,0)
 K DIC,DA
"RTN","SDWLRP4",135,0)
 S SDWLRES=1_"^"_$G(SDWLDA)
"RTN","SDWLRP4",136,0)
 Q
"RTN","SDWLRP4",137,0)
DEL S DA=SDWLDA,DIK="^SDWL(409.3," D ^DIK K DIK,DA
"RTN","SDWLRP4",138,0)
 S SDWLRES="-1^Entry "_SDWLDA_" Deleted"
"RTN","SDWLRP4",139,0)
 Q
"RTN","SDWLRP4",140,0)
DUP(IEN) ;Duplicate Check
"RTN","SDWLRP4",141,0)
 ;if institution, wait list type, and wait list modifier are the same it's a duplicate
"RTN","SDWLRP4",142,0)
 ;SDWLV1  :  IEN in 409.3
"RTN","SDWLRP4",143,0)
 ;SDWLV2  :  Zero node of 409.3
"RTN","SDWLRP4",144,0)
 ;SDWLV3  :  Wait List Type Modifier value passed in
"RTN","SDWLRP4",145,0)
 ;SDWLV4  :  Wait List Type Modifier value in current record
"RTN","SDWLRP4",146,0)
 ;SDWLIN  :  Institution value passed in checked against piece 3 of current record
"RTN","SDWLRP4",147,0)
 ;SDWLSTR :  Incoming value string
"RTN","SDWLRP4",148,0)
 ;           Wait List Type piece 4 of SDWLSTR (incoming value) checked against piece 5
"RTN","SDWLRP4",149,0)
 ;           of SDWLV2 (zero node of current record
"RTN","SDWLRP4",150,0)
 N SDWLV1,SDWLV2,SDWLV3,SDWLV4,SDWLV5
"RTN","SDWLRP4",151,0)
 S (SDWLV1,SDWLV5)=0
"RTN","SDWLRP4",152,0)
 F  S SDWLV1=$O(^SDWL(409.3,"B",IEN,SDWLV1)) Q:('SDWLV1!SDWLV5)  D
"RTN","SDWLRP4",153,0)
 . S SDWLV2=$G(^SDWL(409.3,SDWLV1,0)) Q:SDWLV2=""
"RTN","SDWLRP4",154,0)
 . S SDWLV3=$S($P(SDWLSTR,U,4)=1:SDWL6,$P(SDWLSTR,U,4)=2:SDWL7,$P(SDWLSTR,U,4)=3:SDWL8,$P(SDWLSTR,U,4)=4:SDWL9,1:0)
"RTN","SDWLRP4",155,0)
 . S SDWLV4=$S($P(SDWLV2,U,5)=1:$P(SDWLV2,U,6),$P(SDWLV2,U,5)=2:$P(SDWLV2,U,7),$P(SDWLV2,U,5)=3:$P(SDWLV2,U,8),$P(SDWLV2,U,5)=4:$P(SDWLV2,U,9),1:0)
"RTN","SDWLRP4",156,0)
 . I $P(SDWLV2,U,3)=SDWLIN,$P(SDWLSTR,U,4)=$P(SDWLV2,U,5),SDWLV3=SDWLV4 S SDWLV5=1 Q
"RTN","SDWLRP4",157,0)
 Q SDWLV5
"RTN","SDWLRP4",158,0)
DCHK(VALID) ;Check for valid DESIRED DATE
"RTN","SDWLRP4",159,0)
 N X
"RTN","SDWLRP4",160,0)
 S X=VALID,%DT="X" D ^%DT
"RTN","SDWLRP4",161,0)
 Q Y
"VER")
8.0^22.0
"^DD",409.3,409.3,27.1,0)
EWL ENROLLEE DATE USED^D^^1;3^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",409.3,409.3,27.1,21,0)
^^2^2^3060725^
"^DD",409.3,409.3,27.1,21,1,0)
This field contains the actual date used to calculate the number of days 
"^DD",409.3,409.3,27.1,21,2,0)
between the current date and the last treatment or enrollment date. 
"^DD",409.3,409.3,27.1,"DT")
3060509
"^DD",409.3,409.3,27.2,0)
EWL ENROLLEE DATABASE FILE^S^0:NONE;1:TREATING FACILITY;2:PATIENT ENROLLMENT;3:OUTPATIENT ENCOUNTER;4:KLF DOWNLOAD;^1;4^Q
"^DD",409.3,409.3,27.2,21,0)
^^4^4^3060725^
"^DD",409.3,409.3,27.2,21,1,0)
This field is used to track the file used to obtain either the last 
"^DD",409.3,409.3,27.2,21,2,0)
treatment date (TREATING FACILITY file #391.52) or the enrollment date 
"^DD",409.3,409.3,27.2,21,3,0)
(PATIENT ENROLLMENT file #27.11). It is used internally only for audit 
"^DD",409.3,409.3,27.2,21,4,0)
purposes.
"^DD",409.3,409.3,27.2,"DT")
3060522
"BLD",6551,6)
^394
**END**
**END**
