KIDS Distribution saved on Mar 02, 1999@22:10:05
GMRC*3*1
**KIDS**:GMRC*3.0*1^

**INSTALL NAME**
GMRC*3.0*1
"BLD",910,0)
GMRC*3.0*1^CONSULT/REQUEST TRACKING^0^2990226^y
"BLD",910,4,0)
^9.64PA^^0
"BLD",910,"ABPKG")
n
"BLD",910,"KRN",0)
^9.67PA^19^18
"BLD",910,"KRN",.4,0)
.4
"BLD",910,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",910,"KRN",.401,0)
.401
"BLD",910,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",910,"KRN",.402,0)
.402
"BLD",910,"KRN",.402,"NM",0)
^9.68A^2^1
"BLD",910,"KRN",.402,"NM",2,0)
GMRC SETUP REQUEST SERVICE    FILE #123.5^123.5^0
"BLD",910,"KRN",.402,"NM","B","GMRC SETUP REQUEST SERVICE    FILE #123.5",2)

"BLD",910,"KRN",.403,0)
.403
"BLD",910,"KRN",.5,0)
.5
"BLD",910,"KRN",.84,0)
.84
"BLD",910,"KRN",3.6,0)
3.6
"BLD",910,"KRN",3.8,0)
3.8
"BLD",910,"KRN",9.2,0)
9.2
"BLD",910,"KRN",9.8,0)
9.8
"BLD",910,"KRN",9.8,"NM",0)
^9.68A^110^90
"BLD",910,"KRN",9.8,"NM",1,0)
GMRC101^^0^B13640482
"BLD",910,"KRN",9.8,"NM",2,0)
GMRC101C^^0^B32451649
"BLD",910,"KRN",9.8,"NM",3,0)
GMRC101H^^0^B5309472
"BLD",910,"KRN",9.8,"NM",4,0)
GMRC513U^^0^B19541550
"BLD",910,"KRN",9.8,"NM",6,0)
GMRCA1^^0^B53384206
"BLD",910,"KRN",9.8,"NM",9,0)
GMRCACTM^^0^B10100575
"BLD",910,"KRN",9.8,"NM",10,0)
GMRCADC^^0^B9945997
"BLD",910,"KRN",9.8,"NM",12,0)
GMRCAFRD^^0^B29928045
"BLD",910,"KRN",9.8,"NM",14,0)
GMRCALOR^^0^B3286280
"BLD",910,"KRN",9.8,"NM",15,0)
GMRCALRT^^0^B6655026
"BLD",910,"KRN",9.8,"NM",16,0)
GMRCAR^^0^B25724595
"BLD",910,"KRN",9.8,"NM",18,0)
GMRCASV^^0^B41871581
"BLD",910,"KRN",9.8,"NM",19,0)
GMRCAU^^0^B1824313
"BLD",910,"KRN",9.8,"NM",20,0)
GMRCCLR^^0^B4154103
"BLD",910,"KRN",9.8,"NM",21,0)
GMRCCPRS^^0^B1748171
"BLD",910,"KRN",9.8,"NM",22,0)
GMRCDDX^^0^B924910
"BLD",910,"KRN",9.8,"NM",23,0)
GMRCDPCK^^0^B6518193
"BLD",910,"KRN",9.8,"NM",24,0)
GMRCEDIT^^0^B12253787
"BLD",910,"KRN",9.8,"NM",25,0)
GMRCEDT1^^0^B70913364
"BLD",910,"KRN",9.8,"NM",26,0)
GMRCEDT2^^0^B5912146
"BLD",910,"KRN",9.8,"NM",27,0)
GMRCEDT3^^0^B13067742
"BLD",910,"KRN",9.8,"NM",28,0)
GMRCEDT4^^0^B1312916
"BLD",910,"KRN",9.8,"NM",29)
^^^
"BLD",910,"KRN",9.8,"NM",29,0)
GMRCFP^^1^
"BLD",910,"KRN",9.8,"NM",30,0)
GMRCGUIA^^0^B44457474
"BLD",910,"KRN",9.8,"NM",31,0)
GMRCHK^^0^B122123
"BLD",910,"KRN",9.8,"NM",32,0)
GMRCHL7^^0^B24806616
"BLD",910,"KRN",9.8,"NM",33,0)
GMRCHL72^^0^B12738788
"BLD",910,"KRN",9.8,"NM",34,0)
GMRCHL7A^^0^B29368224
"BLD",910,"KRN",9.8,"NM",35,0)
GMRCHL7B^^0^B10745880
"BLD",910,"KRN",9.8,"NM",36,0)
GMRCHL7U^^0^B19842862
"BLD",910,"KRN",9.8,"NM",37,0)
GMRCMCP^^0^B10072711
"BLD",910,"KRN",9.8,"NM",39,0)
GMRCMENU^^0^B412814
"BLD",910,"KRN",9.8,"NM",40,0)
GMRCMER^^0^B2240294
"BLD",910,"KRN",9.8,"NM",41,0)
GMRCMP^^0^B4744488
"BLD",910,"KRN",9.8,"NM",42,0)
GMRCMSS^^0^B2221889
"BLD",910,"KRN",9.8,"NM",43,0)
GMRCMU^^0^B1149949
"BLD",910,"KRN",9.8,"NM",44)
^^^
"BLD",910,"KRN",9.8,"NM",44,0)
GMRCNTEG^^1^
"BLD",910,"KRN",9.8,"NM",45,0)
GMRCP^^0^B8176663
"BLD",910,"KRN",9.8,"NM",48,0)
GMRCP513^^0^B70113
"BLD",910,"KRN",9.8,"NM",50,0)
GMRCPC^^0^B2519908
"BLD",910,"KRN",9.8,"NM",51,0)
GMRCPH^^0^B6032429
"BLD",910,"KRN",9.8,"NM",52,0)
GMRCPOR^^0^B6316657
"BLD",910,"KRN",9.8,"NM",53)
^^^
"BLD",910,"KRN",9.8,"NM",53,0)
GMRCPOR1^^1^
"BLD",910,"KRN",9.8,"NM",56,0)
GMRCPP^^0^B1271172
"BLD",910,"KRN",9.8,"NM",57,0)
GMRCPR^^0^B1322803
"BLD",910,"KRN",9.8,"NM",58,0)
GMRCPR0^^0^B14516464
"BLD",910,"KRN",9.8,"NM",60,0)
GMRCPREF^^0^B6098689
"BLD",910,"KRN",9.8,"NM",61,0)
GMRCPRP^^0^B14430951
"BLD",910,"KRN",9.8,"NM",62,0)
GMRCPRPS^^0^B2594480
"BLD",910,"KRN",9.8,"NM",63,0)
GMRCPS^^0^B6637966
"BLD",910,"KRN",9.8,"NM",64,0)
GMRCPSEL^^0^B2587182
"BLD",910,"KRN",9.8,"NM",65,0)
GMRCPURG^^0^B239961
"BLD",910,"KRN",9.8,"NM",66,0)
GMRCPX^^0^B465264
"BLD",910,"KRN",9.8,"NM",67,0)
GMRCPZ^^0^B6983852
"BLD",910,"KRN",9.8,"NM",68,0)
GMRCQC^^0^B2582558
"BLD",910,"KRN",9.8,"NM",69,0)
GMRCQCST^^0^B25872332
"BLD",910,"KRN",9.8,"NM",70,0)
GMRCR^^0^B16404947
"BLD",910,"KRN",9.8,"NM",72,0)
GMRCR06^^0^B4536466
"BLD",910,"KRN",9.8,"NM",74,0)
GMRCRA^^0^B5426735
"BLD",910,"KRN",9.8,"NM",75,0)
GMRCREXT^^0^B1712931
"BLD",910,"KRN",9.8,"NM",77,0)
GMRCS^^0^B5030003
"BLD",910,"KRN",9.8,"NM",79,0)
GMRCSL^^0^B1737920
"BLD",910,"KRN",9.8,"NM",80,0)
GMRCSLDT^^0^B7506061
"BLD",910,"KRN",9.8,"NM",81,0)
GMRCSLM^^0^B28935805
"BLD",910,"KRN",9.8,"NM",82,0)
GMRCSLM1^^0^B28422109
"BLD",910,"KRN",9.8,"NM",83,0)
GMRCSLM2^^0^B38237294
"BLD",910,"KRN",9.8,"NM",84,0)
GMRCSLM3^^0^B19595111
"BLD",910,"KRN",9.8,"NM",85,0)
GMRCSLMV^^0^B1750101
"BLD",910,"KRN",9.8,"NM",86,0)
GMRCSPD^^0^B7129328
"BLD",910,"KRN",9.8,"NM",87,0)
GMRCSRVS^^0^B8911604
"BLD",910,"KRN",9.8,"NM",88,0)
GMRCSSP^^0^B2794125
"BLD",910,"KRN",9.8,"NM",89,0)
GMRCST^^0^B1413232
"BLD",910,"KRN",9.8,"NM",90,0)
GMRCSTAT^^0^B2840946
"BLD",910,"KRN",9.8,"NM",91,0)
GMRCSTLM^^0^B12955714
"BLD",910,"KRN",9.8,"NM",92,0)
GMRCSTU^^0^B48371932
"BLD",910,"KRN",9.8,"NM",93,0)
GMRCT^^0^B4579878
"BLD",910,"KRN",9.8,"NM",94,0)
GMRCTIU^^0^B60787590
"BLD",910,"KRN",9.8,"NM",95,0)
GMRCTIU1^^0^B5535296
"BLD",910,"KRN",9.8,"NM",97,0)
GMRCU^^0^B8633278
"BLD",910,"KRN",9.8,"NM",100,0)
GMRCUTIL^^0^B10352521
"BLD",910,"KRN",9.8,"NM",101,0)
GMRCUTL1^^0^B5112124
"BLD",910,"KRN",9.8,"NM",102)
^^^
"BLD",910,"KRN",9.8,"NM",102,0)
GMRCXMF^^1^
"BLD",910,"KRN",9.8,"NM",103)
^^^
"BLD",910,"KRN",9.8,"NM",103,0)
GMRCXQ^^0^B303846
"BLD",910,"KRN",9.8,"NM",104,0)
GMRCA2^^0^B1995936
"BLD",910,"KRN",9.8,"NM",105)
^^^
"BLD",910,"KRN",9.8,"NM",105,0)
GMRCPRE^^1^
"BLD",910,"KRN",9.8,"NM",106)
^^^
"BLD",910,"KRN",9.8,"NM",106,0)
GMRCPOS^^0^B2386476
"BLD",910,"KRN",9.8,"NM",107,0)
GMRCPOS1^^0^B5483561
"BLD",910,"KRN",9.8,"NM",108,0)
GMRCPOST^^0^B6171659
"BLD",910,"KRN",9.8,"NM",109)
^^^
"BLD",910,"KRN",9.8,"NM",109,0)
GMRCQCK^^1^
"BLD",910,"KRN",9.8,"NM",110)
^^^
"BLD",910,"KRN",9.8,"NM",110,0)
GMRC11PS^^1^
"BLD",910,"KRN",9.8,"NM","B","GMRC101",1)

"BLD",910,"KRN",9.8,"NM","B","GMRC101C",2)

"BLD",910,"KRN",9.8,"NM","B","GMRC101H",3)

"BLD",910,"KRN",9.8,"NM","B","GMRC11PS",110)

"BLD",910,"KRN",9.8,"NM","B","GMRC513U",4)

"BLD",910,"KRN",9.8,"NM","B","GMRCA1",6)

"BLD",910,"KRN",9.8,"NM","B","GMRCA2",104)

"BLD",910,"KRN",9.8,"NM","B","GMRCACTM",9)

"BLD",910,"KRN",9.8,"NM","B","GMRCADC",10)

"BLD",910,"KRN",9.8,"NM","B","GMRCAFRD",12)

"BLD",910,"KRN",9.8,"NM","B","GMRCALOR",14)

"BLD",910,"KRN",9.8,"NM","B","GMRCALRT",15)

"BLD",910,"KRN",9.8,"NM","B","GMRCAR",16)

"BLD",910,"KRN",9.8,"NM","B","GMRCASV",18)

"BLD",910,"KRN",9.8,"NM","B","GMRCAU",19)

"BLD",910,"KRN",9.8,"NM","B","GMRCCLR",20)

"BLD",910,"KRN",9.8,"NM","B","GMRCCPRS",21)

"BLD",910,"KRN",9.8,"NM","B","GMRCDDX",22)

"BLD",910,"KRN",9.8,"NM","B","GMRCDPCK",23)

"BLD",910,"KRN",9.8,"NM","B","GMRCEDIT",24)

"BLD",910,"KRN",9.8,"NM","B","GMRCEDT1",25)

"BLD",910,"KRN",9.8,"NM","B","GMRCEDT2",26)

"BLD",910,"KRN",9.8,"NM","B","GMRCEDT3",27)

"BLD",910,"KRN",9.8,"NM","B","GMRCEDT4",28)

"BLD",910,"KRN",9.8,"NM","B","GMRCFP",29)

"BLD",910,"KRN",9.8,"NM","B","GMRCGUIA",30)

"BLD",910,"KRN",9.8,"NM","B","GMRCHK",31)

"BLD",910,"KRN",9.8,"NM","B","GMRCHL7",32)

"BLD",910,"KRN",9.8,"NM","B","GMRCHL72",33)

"BLD",910,"KRN",9.8,"NM","B","GMRCHL7A",34)

"BLD",910,"KRN",9.8,"NM","B","GMRCHL7B",35)

"BLD",910,"KRN",9.8,"NM","B","GMRCHL7U",36)

"BLD",910,"KRN",9.8,"NM","B","GMRCMCP",37)

"BLD",910,"KRN",9.8,"NM","B","GMRCMENU",39)

"BLD",910,"KRN",9.8,"NM","B","GMRCMER",40)

"BLD",910,"KRN",9.8,"NM","B","GMRCMP",41)

"BLD",910,"KRN",9.8,"NM","B","GMRCMSS",42)

"BLD",910,"KRN",9.8,"NM","B","GMRCMU",43)

"BLD",910,"KRN",9.8,"NM","B","GMRCNTEG",44)

"BLD",910,"KRN",9.8,"NM","B","GMRCP",45)

"BLD",910,"KRN",9.8,"NM","B","GMRCP513",48)

"BLD",910,"KRN",9.8,"NM","B","GMRCPC",50)

"BLD",910,"KRN",9.8,"NM","B","GMRCPH",51)

"BLD",910,"KRN",9.8,"NM","B","GMRCPOR",52)

"BLD",910,"KRN",9.8,"NM","B","GMRCPOR1",53)

"BLD",910,"KRN",9.8,"NM","B","GMRCPOS",106)

"BLD",910,"KRN",9.8,"NM","B","GMRCPOS1",107)

"BLD",910,"KRN",9.8,"NM","B","GMRCPOST",108)

"BLD",910,"KRN",9.8,"NM","B","GMRCPP",56)

"BLD",910,"KRN",9.8,"NM","B","GMRCPR",57)

"BLD",910,"KRN",9.8,"NM","B","GMRCPR0",58)

"BLD",910,"KRN",9.8,"NM","B","GMRCPRE",105)

"BLD",910,"KRN",9.8,"NM","B","GMRCPREF",60)

"BLD",910,"KRN",9.8,"NM","B","GMRCPRP",61)

"BLD",910,"KRN",9.8,"NM","B","GMRCPRPS",62)

"BLD",910,"KRN",9.8,"NM","B","GMRCPS",63)

"BLD",910,"KRN",9.8,"NM","B","GMRCPSEL",64)

"BLD",910,"KRN",9.8,"NM","B","GMRCPURG",65)

"BLD",910,"KRN",9.8,"NM","B","GMRCPX",66)

"BLD",910,"KRN",9.8,"NM","B","GMRCPZ",67)

"BLD",910,"KRN",9.8,"NM","B","GMRCQC",68)

"BLD",910,"KRN",9.8,"NM","B","GMRCQCK",109)

"BLD",910,"KRN",9.8,"NM","B","GMRCQCST",69)

"BLD",910,"KRN",9.8,"NM","B","GMRCR",70)

"BLD",910,"KRN",9.8,"NM","B","GMRCR06",72)

"BLD",910,"KRN",9.8,"NM","B","GMRCRA",74)

"BLD",910,"KRN",9.8,"NM","B","GMRCREXT",75)

"BLD",910,"KRN",9.8,"NM","B","GMRCS",77)

"BLD",910,"KRN",9.8,"NM","B","GMRCSL",79)

"BLD",910,"KRN",9.8,"NM","B","GMRCSLDT",80)

"BLD",910,"KRN",9.8,"NM","B","GMRCSLM",81)

"BLD",910,"KRN",9.8,"NM","B","GMRCSLM1",82)

"BLD",910,"KRN",9.8,"NM","B","GMRCSLM2",83)

"BLD",910,"KRN",9.8,"NM","B","GMRCSLM3",84)

"BLD",910,"KRN",9.8,"NM","B","GMRCSLMV",85)

"BLD",910,"KRN",9.8,"NM","B","GMRCSPD",86)

"BLD",910,"KRN",9.8,"NM","B","GMRCSRVS",87)

"BLD",910,"KRN",9.8,"NM","B","GMRCSSP",88)

"BLD",910,"KRN",9.8,"NM","B","GMRCST",89)

"BLD",910,"KRN",9.8,"NM","B","GMRCSTAT",90)

"BLD",910,"KRN",9.8,"NM","B","GMRCSTLM",91)

"BLD",910,"KRN",9.8,"NM","B","GMRCSTU",92)

"BLD",910,"KRN",9.8,"NM","B","GMRCT",93)

"BLD",910,"KRN",9.8,"NM","B","GMRCTIU",94)

"BLD",910,"KRN",9.8,"NM","B","GMRCTIU1",95)

"BLD",910,"KRN",9.8,"NM","B","GMRCU",97)

"BLD",910,"KRN",9.8,"NM","B","GMRCUTIL",100)

"BLD",910,"KRN",9.8,"NM","B","GMRCUTL1",101)

"BLD",910,"KRN",9.8,"NM","B","GMRCXMF",102)

"BLD",910,"KRN",9.8,"NM","B","GMRCXQ",103)

"BLD",910,"KRN",19,0)
19
"BLD",910,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",910,"KRN",19,"NM",1)
^^^
"BLD",910,"KRN",19,"NM",1,0)
GMRC SITE PARAMETERS^^1
"BLD",910,"KRN",19,"NM","B","GMRC SITE PARAMETERS",1)

"BLD",910,"KRN",19.1,0)
19.1
"BLD",910,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",910,"KRN",101,0)
101
"BLD",910,"KRN",101,"NM",0)
^9.68A^^0
"BLD",910,"KRN",409.61,0)
409.61
"BLD",910,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",910,"KRN",771,0)
771
"BLD",910,"KRN",771,"NM",0)
^9.68A^^
"BLD",910,"KRN",869.2,0)
869.2
"BLD",910,"KRN",870,0)
870
"BLD",910,"KRN",8994,0)
8994
"BLD",910,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",910,"KRN","B",.4,.4)

"BLD",910,"KRN","B",.401,.401)

"BLD",910,"KRN","B",.402,.402)

"BLD",910,"KRN","B",.403,.403)

"BLD",910,"KRN","B",.5,.5)

"BLD",910,"KRN","B",.84,.84)

"BLD",910,"KRN","B",3.6,3.6)

"BLD",910,"KRN","B",3.8,3.8)

"BLD",910,"KRN","B",9.2,9.2)

"BLD",910,"KRN","B",9.8,9.8)

"BLD",910,"KRN","B",19,19)

"BLD",910,"KRN","B",19.1,19.1)

"BLD",910,"KRN","B",101,101)

"BLD",910,"KRN","B",409.61,409.61)

"BLD",910,"KRN","B",771,771)

"BLD",910,"KRN","B",869.2,869.2)

"BLD",910,"KRN","B",870,870)

"BLD",910,"KRN","B",8994,8994)

"BLD",910,"QUES",0)
^9.62^^
"BLD",910,"REQB",0)
^9.611^^
"KRN",.402,763,-1)
0^2
"KRN",.402,763,0)
GMRC SETUP REQUEST SERVICE^2980108.1219^^123.5^^^2980130
"KRN",.402,763,"DIAB",1,1,123.51,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.52,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.53,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.55,0)
ALL
"KRN",.402,763,"DIAB",3,0,123.5,0)
1.11;"ABBREVIATED PRINT NAME (Optional)"
"KRN",.402,763,"DR",1,123.5)
.01;123.01///^S X="CONSULTS";1.11ABBREVIATED PRINT NAME (Optional)~;1.1;2;123.09;123.03;123.3;123.08;123.1;10;123.5;
"KRN",.402,763,"DR",2,123.51)
.01:2
"KRN",.402,763,"DR",2,123.52)
.01
"KRN",.402,763,"DR",2,123.53)
.01
"KRN",.402,763,"DR",2,123.55)
.01
"KRN",19,7057,-1)
1^1
"KRN",19,7057,0)
GMRC SITE PARAMETERS
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
1^2990226^1322
"PKG",128,22,1,"PAH",1,1,0)
^^171^171^2990302
"PKG",128,22,1,"PAH",1,1,1,0)
Consult/Request Tracking and Resulting Package. Version 3.0.
"PKG",128,22,1,"PAH",1,1,2,0)
 
"PKG",128,22,1,"PAH",1,1,3,0)
This build represents the starting point for tracking NOIS for Version
"PKG",128,22,1,"PAH",1,1,4,0)
3.0.  All of the routines that were distributed in the released 3.0
"PKG",128,22,1,"PAH",1,1,5,0)
version of CONSULT/REQUEST TRACKING were inadvertantly distributed with
"PKG",128,22,1,"PAH",1,1,6,0)
 "3.0T9;CONSULT/REQUEST TRACKING" in the second line, rather than
"PKG",128,22,1,"PAH",1,1,7,0)
 "3.0;CONSULT/REQUEST TRACKING"
"PKG",128,22,1,"PAH",1,1,8,0)
 
"PKG",128,22,1,"PAH",1,1,9,0)
 All of the routines are redistributed in this build with the following
"PKG",128,22,1,"PAH",1,1,10,0)
version and patch information in the second line:
"PKG",128,22,1,"PAH",1,1,11,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;
"PKG",128,22,1,"PAH",1,1,12,0)
 
"PKG",128,22,1,"PAH",1,1,13,0)
The following routines also have added changes which correct errors found
"PKG",128,22,1,"PAH",1,1,14,0)
in the interim at test sites and reported on local NOIS, as opposed to the
"PKG",128,22,1,"PAH",1,1,15,0)
National NOIS system.  The local test site NOIS's that have been resolved
"PKG",128,22,1,"PAH",1,1,16,0)
in this build will not be made part of the National NOIS system.  Any
"PKG",128,22,1,"PAH",1,1,17,0)
local NOIS that is not fixed in this build, will move to the National NOIS
"PKG",128,22,1,"PAH",1,1,18,0)
system, and the National Patch Module management process.
"PKG",128,22,1,"PAH",1,1,19,0)
 
"PKG",128,22,1,"PAH",1,1,20,0)
   GMRC513U - Used to error when the patients location was not defined in
"PKG",128,22,1,"PAH",1,1,21,0)
              the order 
"PKG",128,22,1,"PAH",1,1,22,0)
   GMRCADC -  Corrects the loop for Selecting an item from an alert
"PKG",128,22,1,"PAH",1,1,23,0)
   GMRCQCST - Fixes an STS+5^GMRCQCST error by initializing the counter.
"PKG",128,22,1,"PAH",1,1,24,0)
   GMRCSLDT - Fixes DOB display in header.
"PKG",128,22,1,"PAH",1,1,25,0)
   GMRCSLM1 - Changes the status displayed in List manager to 99 (No
"PKG",128,22,1,"PAH",1,1,26,0)
              status) if its not defined in the consult record.
"PKG",128,22,1,"PAH",1,1,27,0)
   GMRCT -    Removed logic that was stopping notifications to be sent to
"PKG",128,22,1,"PAH",1,1,28,0)
              the notification users, logic matches 2.5 now.
"PKG",128,22,1,"PAH",1,1,29,0)
 
"PKG",128,22,1,"PAH",1,1,30,0)
 The following routines were changed to call one location for message
"PKG",128,22,1,"PAH",1,1,31,0)
 handling which now displays the message, and asks the user to press
"PKG",128,22,1,"PAH",1,1,32,0)
 return to continue.  This was in response to sites saying they could not
"PKG",128,22,1,"PAH",1,1,33,0)
 see the message being returned because it scrolled off too fast.
"PKG",128,22,1,"PAH",1,1,34,0)
   GMRC101C
"PKG",128,22,1,"PAH",1,1,35,0)
   GMRCA1
"PKG",128,22,1,"PAH",1,1,36,0)
   GMRCADC
"PKG",128,22,1,"PAH",1,1,37,0)
   GMRCAFRD
"PKG",128,22,1,"PAH",1,1,38,0)
   GMRCAR
"PKG",128,22,1,"PAH",1,1,39,0)
   GMRCASV
"PKG",128,22,1,"PAH",1,1,40,0)
   GMRCEDT1
"PKG",128,22,1,"PAH",1,1,41,0)
   GMRCEDT2
"PKG",128,22,1,"PAH",1,1,42,0)
   GMRCMCP
"PKG",128,22,1,"PAH",1,1,43,0)
   GMRCP513
"PKG",128,22,1,"PAH",1,1,44,0)
   GMRCPR0
"PKG",128,22,1,"PAH",1,1,45,0)
   GMRCR
"PKG",128,22,1,"PAH",1,1,46,0)
   GMRCR06
"PKG",128,22,1,"PAH",1,1,47,0)
   GMRCSLDT
"PKG",128,22,1,"PAH",1,1,48,0)
   GMRCSLM
"PKG",128,22,1,"PAH",1,1,49,0)
   GMRCSLM2
"PKG",128,22,1,"PAH",1,1,50,0)
   GMRCSLM3
"PKG",128,22,1,"PAH",1,1,51,0)
   GMRCSSP
"PKG",128,22,1,"PAH",1,1,52,0)
   GMRCSTU
"PKG",128,22,1,"PAH",1,1,53,0)
   GMRCTIU
"PKG",128,22,1,"PAH",1,1,54,0)
 
"PKG",128,22,1,"PAH",1,1,55,0)
The following routine added clean-up of variables:
"PKG",128,22,1,"PAH",1,1,56,0)
   GMRCHL7
"PKG",128,22,1,"PAH",1,1,57,0)
   GMRCHL7A
"PKG",128,22,1,"PAH",1,1,58,0)
   GMRCMER
"PKG",128,22,1,"PAH",1,1,59,0)
   GMRCP
"PKG",128,22,1,"PAH",1,1,60,0)
   GMRCTIU
"PKG",128,22,1,"PAH",1,1,61,0)
 
"PKG",128,22,1,"PAH",1,1,62,0)
The following routine was deleted from site in error when V1 was
"PKG",128,22,1,"PAH",1,1,63,0)
installed:
"PKG",128,22,1,"PAH",1,1,64,0)
   GMRCA2
"PKG",128,22,1,"PAH",1,1,65,0)
 
"PKG",128,22,1,"PAH",1,1,66,0)
The following routine has the latest purge logic for removing the order
"PKG",128,22,1,"PAH",1,1,67,0)
from CPRS, but leaves the consult in the Consult package:
"PKG",128,22,1,"PAH",1,1,68,0)
   GMRCPURG
"PKG",128,22,1,"PAH",1,1,69,0)
 
"PKG",128,22,1,"PAH",1,1,70,0)
The following routine has changes to support the GUI Consults application:
"PKG",128,22,1,"PAH",1,1,71,0)
   GMRCGUIA
"PKG",128,22,1,"PAH",1,1,72,0)
 
"PKG",128,22,1,"PAH",1,1,73,0)
This patch also contains one input template:
"PKG",128,22,1,"PAH",1,1,74,0)
   GMRC SETUP REQUEST SERVICE for FILE #123.5 which had an extra field as
"PKG",128,22,1,"PAH",1,1,75,0)
   its last prompt, which should not have been in the list.
"PKG",128,22,1,"PAH",1,1,76,0)
 
"PKG",128,22,1,"PAH",1,1,77,0)
 
"PKG",128,22,1,"PAH",1,1,78,0)
 ROUTINE SUMMARY:
"PKG",128,22,1,"PAH",1,1,79,0)
 ================
"PKG",128,22,1,"PAH",1,1,80,0)
 The following is a list of the routine(s) included in this patch.  The
"PKG",128,22,1,"PAH",1,1,81,0)
 second line of each of these routine(s) will look like:
"PKG",128,22,1,"PAH",1,1,82,0)
 
"PKG",128,22,1,"PAH",1,1,83,0)
     <tab>;;3.0;CONSULTS/REQUEST TRACKING;**1**;JAN 12, 1998
"PKG",128,22,1,"PAH",1,1,84,0)
 
"PKG",128,22,1,"PAH",1,1,85,0)
                            CHECK^XTSUMBLD results
"PKG",128,22,1,"PAH",1,1,86,0)
 Routine name         Before Patch          After Patch         Patch List
"PKG",128,22,1,"PAH",1,1,87,0)
 ============         ============          ===========         ==========
"PKG",128,22,1,"PAH",1,1,88,0)
 GMRC101                   8413793              8413793             1
"PKG",128,22,1,"PAH",1,1,89,0)
 GMRC101C                 18401713             18676779             1
"PKG",128,22,1,"PAH",1,1,90,0)
 GMRC101H                  2966584              2966584             1
"PKG",128,22,1,"PAH",1,1,91,0)
 GMRC513U                 13170437             12667767             1
"PKG",128,22,1,"PAH",1,1,92,0)
 GMRCA1                   19694805             21176193             1
"PKG",128,22,1,"PAH",1,1,93,0)
 GMRCA2                        N/A              1578391             1
"PKG",128,22,1,"PAH",1,1,94,0)
 GMRCACTM                  6258472              6258472             1
"PKG",128,22,1,"PAH",1,1,95,0)
 GMRCADC                   6541482              6388044             1
"PKG",128,22,1,"PAH",1,1,96,0)
 GMRCAFRD                 15372394             17106062             1
"PKG",128,22,1,"PAH",1,1,97,0)
 GMRCALOR                  2588991              2588991             1
"PKG",128,22,1,"PAH",1,1,98,0)
 GMRCALRT                  4230024              4230024             1
"PKG",128,22,1,"PAH",1,1,99,0)
 GMRCAR                   14909687             17439366             1
"PKG",128,22,1,"PAH",1,1,100,0)
 GMRCASV                  14952702             16419292             1
"PKG",128,22,1,"PAH",1,1,101,0)
 GMRCAU                    1632657              1632657             1
"PKG",128,22,1,"PAH",1,1,102,0)
 GMRCCLR                   3864606              3864606             1
"PKG",128,22,1,"PAH",1,1,103,0)
 GMRCCPRS                  1830089              1830089             1
"PKG",128,22,1,"PAH",1,1,104,0)
 GMRCDDX                    639606               639606             1
"PKG",128,22,1,"PAH",1,1,105,0)
 GMRCDPCK                  5953294              5953294             1
"PKG",128,22,1,"PAH",1,1,106,0)
 GMRCEDIT                  8745771              8745771             1
"PKG",128,22,1,"PAH",1,1,107,0)
 GMRCEDT1                 41636279             42298856             1
"PKG",128,22,1,"PAH",1,1,108,0)
 GMRCEDT2                  4798079              4364666             1
"PKG",128,22,1,"PAH",1,1,109,0)
 GMRCEDT3                 11149403             11149403             1
"PKG",128,22,1,"PAH",1,1,110,0)
 GMRCEDT4                  1160301              1160301             1
"PKG",128,22,1,"PAH",1,1,111,0)
 GMRCFP                    3129592              3129592             1
"PKG",128,22,1,"PAH",1,1,112,0)
 GMRCGUIA                 11746652             16311788             1
"PKG",128,22,1,"PAH",1,1,113,0)
 GMRCHK                     103936               103936             1
"PKG",128,22,1,"PAH",1,1,114,0)
 GMRCHL7                  11366432             11227877             1
"PKG",128,22,1,"PAH",1,1,115,0)
 GMRCHL72                 10268678             10268678             1
"PKG",128,22,1,"PAH",1,1,116,0)
 GMRCHL7A                 15539062             15549800             1
"PKG",128,22,1,"PAH",1,1,117,0)
 GMRCHL7B                  6319284              6319284             1
"PKG",128,22,1,"PAH",1,1,118,0)
 GMRCHL7U                  9344818              9344818             1
"PKG",128,22,1,"PAH",1,1,119,0)
 GMRCMCP                   7084708              7495076             1
"PKG",128,22,1,"PAH",1,1,120,0)
 GMRCMENU                   322309               322309             1
"PKG",128,22,1,"PAH",1,1,121,0)
 GMRCMER                   1693402              1692437             1
"PKG",128,22,1,"PAH",1,1,122,0)
 GMRCMP                    3361738              3361738             1
"PKG",128,22,1,"PAH",1,1,123,0)
 GMRCMSS                   1854144              1854144             1
"PKG",128,22,1,"PAH",1,1,124,0)
 GMRCMU                     928617               928617             1
"PKG",128,22,1,"PAH",1,1,125,0)
 GMRCNTEG                  3709091              3709091             1
"PKG",128,22,1,"PAH",1,1,126,0)
 GMRCP                     5045467              5045493             1
"PKG",128,22,1,"PAH",1,1,127,0)
 GMRCP513                 37240108             36405539             1
"PKG",128,22,1,"PAH",1,1,128,0)
 GMRCPC                    1890933              1890933             1
"PKG",128,22,1,"PAH",1,1,129,0)
 GMRCPH                    3981291              3981291             1
"PKG",128,22,1,"PAH",1,1,130,0)
 GMRCPOR                   5323056              5323056             1
"PKG",128,22,1,"PAH",1,1,131,0)
 GMRCPOR1                     2773                 2773             1
"PKG",128,22,1,"PAH",1,1,132,0)
 GMRCPP                     855172               855172             1
"PKG",128,22,1,"PAH",1,1,133,0)
 GMRCPR                     926638               926638             1
"PKG",128,22,1,"PAH",1,1,134,0)
 GMRCPR0                   9262745              9410954             1
"PKG",128,22,1,"PAH",1,1,135,0)
 GMRCPREF                  5325580              5325580             1
"PKG",128,22,1,"PAH",1,1,136,0)
 GMRCPRP                  11879566             11879566             1
"PKG",128,22,1,"PAH",1,1,137,0)
 GMRCPRPS                  2793058              2793058             1
"PKG",128,22,1,"PAH",1,1,138,0)
 GMRCPS                    5339380              5339380             1
"PKG",128,22,1,"PAH",1,1,139,0)
 GMRCPSEL                  2393689              2393689             1
"PKG",128,22,1,"PAH",1,1,140,0)
 GMRCPURG                 17580800             20913126             1
"PKG",128,22,1,"PAH",1,1,141,0)
 GMRCPX                     239159               239159             1
"PKG",128,22,1,"PAH",1,1,142,0)
 GMRCPZ                    5085859              5085859             1
"PKG",128,22,1,"PAH",1,1,143,0)
 GMRCQC                    1818487              1818487             1
"PKG",128,22,1,"PAH",1,1,144,0)
 GMRCQCST                 19101320             19226914             1
"PKG",128,22,1,"PAH",1,1,145,0)
 GMRCR                     7488448              8370696             1
"PKG",128,22,1,"PAH",1,1,146,0)
 GMRCR06                   2960366              3275332             1
"PKG",128,22,1,"PAH",1,1,147,0)
 GMRCRA                    4195804              4195804             1
"PKG",128,22,1,"PAH",1,1,148,0)
 GMRCREXT                  1810492              1810492             1
"PKG",128,22,1,"PAH",1,1,149,0)
 GMRCS                     3962816              3962816             1
"PKG",128,22,1,"PAH",1,1,150,0)
 GMRCSL                    1522448              1522448             1
"PKG",128,22,1,"PAH",1,1,151,0)
 GMRCSLDT                  6489744              6700981             1
"PKG",128,22,1,"PAH",1,1,152,0)
 GMRCSLM                  12065220             12065330             1
"PKG",128,22,1,"PAH",1,1,153,0)
 GMRCSLM1                 16808468             15946873             1
"PKG",128,22,1,"PAH",1,1,154,0)
 GMRCSLM2                 23538324             24019338             1
"PKG",128,22,1,"PAH",1,1,155,0)
 GMRCSLM3                 13045869             13938903             1
"PKG",128,22,1,"PAH",1,1,156,0)
 GMRCSLMV                  1499320              1499320             1
"PKG",128,22,1,"PAH",1,1,157,0)
 GMRCSPD                   5582555              5582555             1
"PKG",128,22,1,"PAH",1,1,158,0)
 GMRCSRVS                 17464043             17464043             1
"PKG",128,22,1,"PAH",1,1,159,0)
 GMRCSSP                   2367305              2429041             1
"PKG",128,22,1,"PAH",1,1,160,0)
 GMRCST                     906358               906358             1
"PKG",128,22,1,"PAH",1,1,161,0)
 GMRCSTAT                  2263491              2263491             1
"PKG",128,22,1,"PAH",1,1,162,0)
 GMRCSTLM                 10254158             10254158             1
"PKG",128,22,1,"PAH",1,1,163,0)
 GMRCSTU                  29686934             29955625             1
"PKG",128,22,1,"PAH",1,1,164,0)
 GMRCT                     3616444              3367975             1
"PKG",128,22,1,"PAH",1,1,165,0)
 GMRCTIU                  21744331             21928765             1
"PKG",128,22,1,"PAH",1,1,166,0)
 GMRCTIU1                  3453903              3453903             1
"PKG",128,22,1,"PAH",1,1,167,0)
 GMRCU                     4219990              4219990             1
"PKG",128,22,1,"PAH",1,1,168,0)
 GMRCUTIL                  7303115              7303115             1
"PKG",128,22,1,"PAH",1,1,169,0)
 GMRCUTL1                  3455205              3455205             1
"PKG",128,22,1,"PAH",1,1,170,0)
 GMRCXMF                   5910209              5910209             1
"PKG",128,22,1,"PAH",1,1,171,0)
 GMRCXQ                     326583               326583             1
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
90
"RTN","GMRC101")
0^1^B13640482
"RTN","GMRC101",1,0)
GMRC101 ;SLC/DLT - Create Protocol entries for OE/RR ADD orders screens ;5/20/98  14:20
"RTN","GMRC101",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRC101",3,0)
EN ;Entry to build Consult types for Add menus
"RTN","GMRC101",4,0)
 W !,"There are 2 types of Protocols used by the Consult Package on 'Add Orders'",!,"menus in OE/RR."
"RTN","GMRC101",5,0)
EN1 K DIR,DA S GMRCEND=0,DIR(0)="S^1:CONSULT TYPE;2:PROCEDURE REQUEST",DIR("A")="Select Protocol Type",DIR("??")="^D HELP^GMRC101"
"RTN","GMRC101",6,0)
 D ^DIR K DIR S GMRCEND=$S($D(DTOUT):1,$D(DUOUT):1,$D(DIROUT):1,1:0) I GMRCEND G END
"RTN","GMRC101",7,0)
 I Y=1 D CONSULT G:GMRCEND=2 EN1 D END Q
"RTN","GMRC101",8,0)
 I Y=2 D PROCDURE G:GMRCEND=2 EN1 D END Q
"RTN","GMRC101",9,0)
 Q
"RTN","GMRC101",10,0)
CONSULT ;entry to create a Consult Type
"RTN","GMRC101",11,0)
 S GMRCPFX="GMRCT ",GMRCDESC="Consult Type",GMRCDEFN="GMRCT SAMPLE CONSULT TYPE"
"RTN","GMRC101",12,0)
 W !!,"NOTE: All Consult Types in the Protocol file are prefixed with ""GMRCT "".",!,"For A Fast Lookup Of Consult Type Protocols, Type ""GMRCT"" At The Prompt.",!
"RTN","GMRC101",13,0)
 D SETDEF I GMRCEND Q
"RTN","GMRC101",14,0)
 D EN^GMRC101C
"RTN","GMRC101",15,0)
 Q
"RTN","GMRC101",16,0)
PROCDURE ;entry to create a Procedure Request
"RTN","GMRC101",17,0)
 S GMRCPFX="GMRCR ",GMRCDESC="Procedure Request",GMRCDEFN="GMRCR SAMPLE PROCEDURE"
"RTN","GMRC101",18,0)
 W !!,"NOTE: All Procedure/Requests in the Protocol file are prefixed with ""GMRCR "".",!,"For A Fast Look-up Of Procedures, Type 'GMRCR' At The Prompt.",!
"RTN","GMRC101",19,0)
 D SETDEF I GMRCEND Q
"RTN","GMRC101",20,0)
 D EN^GMRC101C
"RTN","GMRC101",21,0)
 Q
"RTN","GMRC101",22,0)
SETDEF ;Set GMRCDEF once to hold for filling in ORDEF for protocol processing.
"RTN","GMRC101",23,0)
 S GMRCDEF=$O(^ORD(101,"B",GMRCDEFN,"")) I 'GMRCDEF W !!,"Missing Sample Protocol "_GMRCDEFN,! S GMRCEND=1 Q
"RTN","GMRC101",24,0)
 Q
"RTN","GMRC101",25,0)
END K GMRCACT,GMRCEND,GMRCDEFN,GMRCDEF,GMRCDESC,GMRCPFX,GMRCPRF
"RTN","GMRC101",26,0)
 K ORPKG,DIROUT,DUOUT,DTOUT,Y
"RTN","GMRC101",27,0)
 Q
"RTN","GMRC101",28,0)
HELP ;?? help for DIR to define types of consults
"RTN","GMRC101",29,0)
 W @IOF
"RTN","GMRC101",30,0)
 W !,"Protocols defined in this option and Added to Add New Order menus, will have"
"RTN","GMRC101",31,0)
 W !,"orders created in OE/RR based on the protocols definition."
"RTN","GMRC101",32,0)
 W !,"(e.g. Item Text: TPN, and Related Consult Service/Specialty: Pharmacy Service"
"RTN","GMRC101",33,0)
 W !,"  creates a ""Pharmacy Service TPN"" order in OE/RR if the TPN protocol is"
"RTN","GMRC101",34,0)
 W !,"  selected from the Add New Orders menu in OE/RR"
"RTN","GMRC101",35,0)
 W !!,"CONSULT TYPES are names of consults which are very common, such as: "
"RTN","GMRC101",36,0)
 W !,"     ""TPN"" Consult for Hyperalimentation Pharmacy consult"
"RTN","GMRC101",37,0)
 W !,"     ""Physical Therapy"" Consult for RMS"
"RTN","GMRC101",38,0)
 W !,"  Once the commonly known consults are defined here, they may also be added"
"RTN","GMRC101",39,0)
 W !,"  to OE/RR Add New Orders menus for ease of ordering."
"RTN","GMRC101",40,0)
 W !,"  Consult Type protocols are always prefixed with ""GMRCT """
"RTN","GMRC101",41,0)
 W !!,"PROCEDURE REQUESTS are names of procedures, tests, or other requests"
"RTN","GMRC101",42,0)
 W !,"  which are very common, such as: "
"RTN","GMRC101",43,0)
 W !,"    ""EKG: Portable"""
"RTN","GMRC101",44,0)
 W !,"  Once the commonly known procedures which may be ordered without a consult"
"RTN","GMRC101",45,0)
 W !,"  are defined here, they may also be added to OE/RR Add New Orders menus for"
"RTN","GMRC101",46,0)
 W !,"  ease of ordering."
"RTN","GMRC101",47,0)
 W !,"  Procedure Request protocols are always prefixed with ""GMRCR """
"RTN","GMRC101",48,0)
 W !! R "Press RETURN to continue: ",X:$S($D(DTIME):DTIME,1:300)
"RTN","GMRC101",49,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIROUT) D END S GMRCEND=1 Q
"RTN","GMRC101C")
0^2^B32451649
"RTN","GMRC101C",1,0)
GMRC101C ;SLC/DLT,DCM - Create Protocol entries for OE/RR ADD orders screens (Continued) ;5/21/98  13:53
"RTN","GMRC101C",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRC101C",3,0)
DEFAULT ;default variable setting depending on protocol type
"RTN","GMRC101C",4,0)
 S OREA=$S(GMRCPFX="GMRCT ":"S GMRCEN=""C"" D EN^GMRCP",1:"S GMRCEN=""R"" D EN^GMRCP")
"RTN","GMRC101C",5,0)
 S ORPKG=$$PACKAGE^GMRCR I ORPKG="" S GMRCMSG="Missing package entry for CONSULT/REQUEST TRACKING" D EXAC^GMRCADC(GMRCMSG) S GMRCEND=1 Q
"RTN","GMRC101C",6,0)
 S ORFL="",ORDEF=GMRCDEF
"RTN","GMRC101C",7,0)
 Q
"RTN","GMRC101C",8,0)
EN ;Loop logic to process consult types/procedure request
"RTN","GMRC101C",9,0)
 K DIR S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you want to select an existing "_GMRCDESC_" protocol" D ^DIR K DIR S GMRCEND=$S($D(DTOUT):1,$D(DUOUT):1,$D(DIROUT):1,1:0)
"RTN","GMRC101C",10,0)
 I GMRCEND D END Q
"RTN","GMRC101C",11,0)
 I Y=1 G EN1
"RTN","GMRC101C",12,0)
 F  D ADD S GMRCTRLC="UPD" Q:GMRCEND
"RTN","GMRC101C",13,0)
 Q
"RTN","GMRC101C",14,0)
EN1 ;get a GMRCT or GMRCR prefixed protocol
"RTN","GMRC101C",15,0)
 S DIC=101,DIC(0)="AEMQZ",DIC("A")="'"_GMRCPFX_"' prefixed PROTOCOL NAME: ",DIC("S")="I X["""_$E(GMRCPFX,1,$L(GMRCPFX)-1)_"""" D ^DIC K DIC I Y<0 S GMRCEND=1 D END Q
"RTN","GMRC101C",16,0)
 I GMRCPFX="GMRCT ",Y(0)'?1"GMRCT ".E W !,"Select a 'GMRCT ' prefixed protocol",! G EN1
"RTN","GMRC101C",17,0)
 I GMRCPFX="GMRCR ",Y(0)'?1"GMRCR ".E W !,"Select a 'GMRCR ' prefixed protocol",! G EN1
"RTN","GMRC101C",18,0)
 D DEFAULT S ORDA=+Y,ORDANM=$P(Y(0),"^",1) D SETUP,ASK I GMRCEND D END Q
"RTN","GMRC101C",19,0)
 S GMRCTRLC="MUP",GMRCACT="UPD"
"RTN","GMRC101C",20,0)
 D BUILD,END W ! G EN
"RTN","GMRC101C",21,0)
ADD ;Enter a new protocol
"RTN","GMRC101C",22,0)
 K ORDA,ITEMTXT,ORDANM D DEFAULT Q:GMRCEND  D ASK I GMRCEND D END Q
"RTN","GMRC101C",23,0)
 S GMRCTRLC="MAD",GMRCACT="REP"
"RTN","GMRC101C",24,0)
 D BUILD,END
"RTN","GMRC101C",25,0)
 Q
"RTN","GMRC101C",26,0)
ASK ;Ask for Item Text and Related Service
"RTN","GMRC101C",27,0)
 D ITEMTXT Q:GMRCEND
"RTN","GMRC101C",28,0)
 I $D(GMRCSS),$L(GMRCSS) S DIR("B")=GMRCSS
"RTN","GMRC101C",29,0)
ASK1 ;Ask for Relate Service
"RTN","GMRC101C",30,0)
 K DA,X S DIR(0)="PO^123.5:EMZ",DIR("A")="RELATED CONSULT SERVICE/SPECIALTY" D ^DIR K DIR I $D(X),X="@" W !,$C(7),"You Cannot Delete This Entry, ONLY CHANGE IT!",! D  G ASK1
"RTN","GMRC101C",31,0)
 .I $D(GMRCSS),$L(GMRCSS) S DIR("B")=GMRCSS
"RTN","GMRC101C",32,0)
 .Q
"RTN","GMRC101C",33,0)
 S GMRCEND=$S($D(DTOUT):1,$D(DUOUT):1,$D(DIROUT):1,Y<0:1,1:0) I GMRCEND D END Q
"RTN","GMRC101C",34,0)
 S:+Y>0 ORFL=+Y_";GMR(123.5,"
"RTN","GMRC101C",35,0)
 Q:GMRCEND
"RTN","GMRC101C",36,0)
 I $P(^GMR(123.5,+Y,0),"^",2)=9 W !,$C(7),$P(^(0),"^",1)_" Has Been Deactivated.",!,"You Cannot Add A Procedure To A Deactivated Service!",! G ASK1
"RTN","GMRC101C",37,0)
 I ORFL="" W !!,"  Each "_GMRCDESC_" will have a related consult service associated with it.",!,"  If no service is identified the service will be prompted for during the",!,"  add orders process.",!
"RTN","GMRC101C",38,0)
 Q
"RTN","GMRC101C",39,0)
ITEMTXT ;Ask for item text
"RTN","GMRC101C",40,0)
 K DIR,DA I $D(ORDA),$L(ITEMTXT) S DIR("B")=ITEMTXT
"RTN","GMRC101C",41,0)
 I '$D(ORDA) W !! S DIR("A")="Enter the new protocols ITEM TEXT"
"RTN","GMRC101C",42,0)
 K REJECT S DIR(0)="101,1" D ^DIR K DIR S GMRCEND=$S($D(DTOUT):1,$D(DUOUT):1,$D(DIROUT):1,1:0) K DIROUT,DUOUT,DTOUT Q:GMRCEND  I Y="" S GMRCEND=2 Q
"RTN","GMRC101C",43,0)
 I $E(Y,1)'?1A W !!,"The ITEM TEXT should begin with an alphabetic character.  Please re-enter." G ITEMTXT
"RTN","GMRC101C",44,0)
 I $D(ORDA),ORDA,Y=ITEMTXT S (GMRCTXT,ORTXT)=Y Q
"RTN","GMRC101C",45,0)
 S GMRCTXT=$O(^ORD(101,"C",Y,"")) I GMRCTXT D  I $D(REJECT) K REJECT G ITEMTXT
"RTN","GMRC101C",46,0)
 .S GMRCY=Y W !,"** "_Y_" is already being used by "
"RTN","GMRC101C",47,0)
 .S GMRCTXT="" F  S GMRCTXT=$O(^ORD(101,"C",Y,GMRCTXT)) Q:GMRCTXT=""  S TXT=$P($G(^ORD(101,GMRCTXT,0)),"^",1) W:((78-$X)'>$L(TXT)) ! W ?25," "_TXT I TXT?1"GMRCT ".E S REJECT=1
"RTN","GMRC101C",48,0)
 .I $D(REJECT) W !,"This is a duplicate name.  Please re-enter a unique item text." Q
"RTN","GMRC101C",49,0)
 .I '$D(ORDA) S DIR(0)="Y",DIR("A")="Do you really want to add '"_GMRCPFX_GMRCY_"' as a new "_GMRCDESC_" Protocol",DIR("B")="NO" D ^DIR K DIR I Y=0 S REJECT=1
"RTN","GMRC101C",50,0)
 .S Y=GMRCY
"RTN","GMRC101C",51,0)
 .Q
"RTN","GMRC101C",52,0)
 I $D(ORDA),$P(^ORD(101,ORDA,0),"^",1)'=GMRCPFX_Y D ACCESS I $D(GMRC101) W !,"The Protocol name "_$P(^ORD(101,ORDA,0),"^",1),!,"     WILL NOT be changed to match ITEM TEXT due to Package Code dependencies!",!
"RTN","GMRC101C",53,0)
 S ORTXT=Y I '$D(GMRC101) S ORDANM=GMRCPFX_ORTXT
"RTN","GMRC101C",54,0)
 Q
"RTN","GMRC101C",55,0)
SETUP ;Get the Itemtext and service name
"RTN","GMRC101C",56,0)
 Q:'$D(ORDA)  Q:'ORDA
"RTN","GMRC101C",57,0)
 S ITEMTXT=$P(^ORD(101,ORDA,0),"^",2)
"RTN","GMRC101C",58,0)
 S GMRCSS=+$P($G(^ORD(101,ORDA,5)),"^",1),GMRCSS=$P($G(^GMR(123.5,GMRCSS,0)),"^",1)
"RTN","GMRC101C",59,0)
 Q
"RTN","GMRC101C",60,0)
ACCESS ;Check for Protocol Item with GMRC101 security restricting name change of the Protocols .01 field.
"RTN","GMRC101C",61,0)
 Q:'$D(ORDA)
"RTN","GMRC101C",62,0)
 N DIC,X,Y
"RTN","GMRC101C",63,0)
 S DIC=19.1,DIC(0)="FMX",X="GMRC101" D ^DIC Q:(+Y<1)
"RTN","GMRC101C",64,0)
 S:$D(^ORD(101,ORDA,3,"B",+Y)) GMRC101=1
"RTN","GMRC101C",65,0)
 Q
"RTN","GMRC101C",66,0)
BUILD ;Logic to update file 101
"RTN","GMRC101C",67,0)
 S (GMRCPRO,ORDANM)=$TR(ORDANM,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),GMRCTXT=$S(GMRCTXT="":ORTXT,1:GMRCTXT),GMRCSV=ORFL,GMRCSS=ORFL
"RTN","GMRC101C",68,0)
 D EN3^GMRCPREF
"RTN","GMRC101C",69,0)
 S DA=$S($G(DA):DA,$G(ORDA):ORDA,1:"") I '$L(DA) W !!,$C(7),GMRCPRO_" Was Not Added To The Protocol Or Orderable Item File!",! Q
"RTN","GMRC101C",70,0)
 S DIE="^ORD(101,",DR=1.1 D ^DIE D
"RTN","GMRC101C",71,0)
 .S ND=0 F I=1:1 S ND=$O(^ORD(101,DA,2,ND)) Q:ND?1A.E!(ND="")  S GMRCSYN(I)=^ORD(101,DA,2,ND,0)
"RTN","GMRC101C",72,0)
 .Q
"RTN","GMRC101C",73,0)
 K DIR D:GMRCTRLC'="MAD"  I $S($D(DTOUT):1,$D(DUOUT):1,$D(DIROUT):1,1:0) D END S GMRCEND=1 Q
"RTN","GMRC101C",74,0)
 .I $S('$L($P(^ORD(101,DA,0),"^",3)):1,+$P(^(0),"^",3)=0:1,1:0) S DIR(0)="Y",DIR("A")="Do You Want To DISABLE This Protocol" D ^DIR K DIR D:Y=1  Q
"RTN","GMRC101C",75,0)
 ..S DR="2////^S X=""1 No Longer Used""" D ^DIE S GMRCTRLC="MDC"
"RTN","GMRC101C",76,0)
 ..Q
"RTN","GMRC101C",77,0)
 .I $L($P(^ORD(101,DA,0),"^",3)),+$P(^(0),"^",3)=1 S DIR(0)="Y",DIR("A")="Do You Want To ACTIVATE This Disabled Protocol" D ^DIR K DIR D:Y=1  Q
"RTN","GMRC101C",78,0)
 ..S DR="2////^S X=0" D ^DIE
"RTN","GMRC101C",79,0)
 ..Q
"RTN","GMRC101C",80,0)
 .Q
"RTN","GMRC101C",81,0)
 D EN^GMRC101H(GMRCACT,GMRCTRLC,DA,GMRCTXT,.GMRCSYN,GMRCPFX)
"RTN","GMRC101C",82,0)
 D MSG^XQOR("GMRC ORDERABLE ITEM UPDATE",.GMRCMSG)
"RTN","GMRC101C",83,0)
 I $E(GMRCPRO,1,6)="GMRCR " D
"RTN","GMRC101C",84,0)
 .S GMRCPROI=$O(^ORD(101,"B",GMRCPRO,0)) Q:'GMRCPROI
"RTN","GMRC101C",85,0)
 .D GMRCR^GMRCMU
"RTN","GMRC101C",86,0)
 K DIC,DIE,DIR,DR,ORDA,ORDANM,ORDEF,OREA,ORFL,ORPKG,ORTXT
"RTN","GMRC101C",87,0)
 Q
"RTN","GMRC101C",88,0)
END ;Clean-up logic
"RTN","GMRC101C",89,0)
 K I,GMRC101,GMRCMSG,GMRCPRO,GMRCPROI,GMRCSS,GMRCSYN,GMRCSV,GMRCTRLC,GMRCTXT,GMRCY,ITEMTXT,ND
"RTN","GMRC101C",90,0)
 K ORDA,ORDANM,ORDEF,OREA,ORFL,ORPKG,ORTXT
"RTN","GMRC101C",91,0)
 K DIROUT,DUOUT,DTOUT,TXT,Y
"RTN","GMRC101C",92,0)
 Q
"RTN","GMRC101H")
0^3^B5309472
"RTN","GMRC101H",1,0)
GMRC101H ;SLC/DCM - SET UP HL-7 MESSAGE TO UPDATE OERR ORDERABLE ITEMS FILE WITH NEW CONSULT TYPE ;5/20/98  14:20
"RTN","GMRC101H",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRC101H",3,0)
EN(ELC,RLECODE,ORDA,ORNAME,GMRCARRY,GMRCPRFX) ;entry point to set up HL-7 message to update orderable items file - file 101.43
"RTN","GMRC101H",4,0)
 ;ELC=message type - MFN or UPD
"RTN","GMRC101H",5,0)
 ;RLECODE=record level event code from table 180
"RTN","GMRC101H",6,0)
 ;DA=IEN of procedure in ^ORD(101
"RTN","GMRC101H",7,0)
 ;ORNAME=procedure name
"RTN","GMRC101H",8,0)
 ;GMRCARRY=array of synonyms for procedure
"RTN","GMRC101H",9,0)
 ;GMRCPRFX=prefix from ^ORD(101, i.e., "GMRCR " or "GMRCT "
"RTN","GMRC101H",10,0)
 S MSH=$$MSH^GMRCHL7,$P(MSH,"|",3)=$S(GMRCPRFX="GMRCR ":"PROCEDURES",1:"CONSULTS"),$P(MSH,"|",9)=ELC
"RTN","GMRC101H",11,0)
 S MFI=$$MFI(ELC)
"RTN","GMRC101H",12,0)
 S MFE=$$MFE(RLECODE,ORDA,ORNAME,GMRCPRFX)
"RTN","GMRC101H",13,0)
 D ZSY(.GMRCARRY)
"RTN","GMRC101H",14,0)
 D BUILD
"RTN","GMRC101H",15,0)
 K HLQ,MFE,MSH,MFI,MSG,MSGND,ND,ND1,ND2,ZSY,SEP1,SEP2,SEP3,SEP4,SEP5
"RTN","GMRC101H",16,0)
 Q
"RTN","GMRC101H",17,0)
BUILD ;build the HL-7 array into its export form
"RTN","GMRC101H",18,0)
 S ND=1,MSG="GMRCMSG"
"RTN","GMRC101H",19,0)
 S @(MSG_"("_ND_")")=MSH,ND=ND+1
"RTN","GMRC101H",20,0)
 S @(MSG_"("_ND_")")=MFI,ND=ND+1
"RTN","GMRC101H",21,0)
 S @(MSG_"("_ND_")")=MFE,ND=ND+1
"RTN","GMRC101H",22,0)
 I $O(ZSY(0)) D
"RTN","GMRC101H",23,0)
 .S ND1=0 F  S ND1=$O(ZSY(ND1)) Q:ND1=""  S @(MSG_"("_ND_")")=ZSY(ND1),ND=ND+1
"RTN","GMRC101H",24,0)
 .K ND1
"RTN","GMRC101H",25,0)
 .Q
"RTN","GMRC101H",26,0)
 K ND
"RTN","GMRC101H",27,0)
 Q
"RTN","GMRC101H",28,0)
 ;
"RTN","GMRC101H",29,0)
MFI(MTP) ;set MFI HL-7 segment
"RTN","GMRC101H",30,0)
 N X
"RTN","GMRC101H",31,0)
 S MFI="MFI|101^Protocol^99DD||"_$S(MTP="MFN":"REP",1:"UPD")_"|||NE"
"RTN","GMRC101H",32,0)
 Q MFI
"RTN","GMRC101H",33,0)
 ;
"RTN","GMRC101H",34,0)
MFE(RSPLVL,ORXDA,GMRCPRNO,PFX) ;set MFE HL-7 segment
"RTN","GMRC101H",35,0)
 N X
"RTN","GMRC101H",36,0)
 S X="MFE|"_RSPLVL_"|||^^^"_ORXDA_"^"_GMRCPRNO_"^99"_$S(PFX="GMRCR ":"PRO",1:"CON")
"RTN","GMRC101H",37,0)
 Q X
"RTN","GMRC101H",38,0)
ZSY(ARRAY) ;set ZSY segment of the HL-7 segment; contains synonyms
"RTN","GMRC101H",39,0)
 S ND1="",ND2=1
"RTN","GMRC101H",40,0)
 F  S ND1=$O(ARRAY(ND1)) Q:ND1=""  S ZSY(ND2)="ZSY|"_ND2_"|"_ARRAY(ND1)_"|",ND2=ND2+1
"RTN","GMRC101H",41,0)
 K ND,ND1
"RTN","GMRC101H",42,0)
 Q
"RTN","GMRC101H",43,0)
SVC(SVCIEN,SVCNAME,EVCODE) ;format an HL-7 message that defines a new service
"RTN","GMRC101H",44,0)
 ;SVCIEN=Service IEN from file 123.5
"RTN","GMRC101H",45,0)
 ;SVCNAME=Service name, i.e., Medicine
"RTN","GMRC101H",46,0)
 ;EVCODE=record level event code from HL-7 table 180
"RTN","GMRC101H",47,0)
 K GMRCMSG
"RTN","GMRC101H",48,0)
 S MSH=$$MSH^GMRCHL7,$P(MSH,"|",9)="MFN"
"RTN","GMRC101H",49,0)
 S MFI="MFI|123.5^Request Services^99DD||"_$S(EVCODE="MUP":"UPD",1:"REP")_"|||NE"
"RTN","GMRC101H",50,0)
 S MFE="MFE|"_EVCODE_"|||^^^"_SVCIEN_"^"_SVCNAME_"^99CON"
"RTN","GMRC101H",51,0)
 I $L($O(^GMR(123.5,SVCIEN,2,"B",""))) D
"RTN","GMRC101H",52,0)
 .S ND="",ND1=0 F  S ND=$O(^GMR(123.5,SVCIEN,2,"B",ND)) Q:ND=""  S ND1=ND1+1,GMRCARRY(ND1)=ND
"RTN","GMRC101H",53,0)
 .D ZSY(.GMRCARRY)
"RTN","GMRC101H",54,0)
 .Q
"RTN","GMRC101H",55,0)
 D BUILD
"RTN","GMRC101H",56,0)
 K GMRCARRY,ND,ND1,HLQ,MSG,MSH,MFI,MFE,SEP1,SEP2,SEP3,SEP4,SEP5,ZSY
"RTN","GMRC101H",57,0)
 Q
"RTN","GMRC11PS")
1^110
"RTN","GMRC513U")
0^4^B19541550
"RTN","GMRC513U",1,0)
GMRC513U ;SLC/DCM - SF513 Utilities ;5/20/98  14:20
"RTN","GMRC513U",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRC513U",3,0)
DEV ;Ask output device / set up output device print parameters
"RTN","GMRC513U",4,0)
 S POP=0,%ZIS="MQ"
"RTN","GMRC513U",5,0)
 D ^%ZIS I $S(POP:1,IO="":1,1:0) S GMRCQIT=1
"RTN","GMRC513U",6,0)
 Q
"RTN","GMRC513U",7,0)
INIT ;Initialize essential variables
"RTN","GMRC513U",8,0)
 S GMRCDVL="",$P(GMRCDVL,"-",IOM+1)="",GMRCUL="",$P(GMRCUL,"_",40)="",PG=0
"RTN","GMRC513U",9,0)
 S LNFD="",$P(LNFD,"!",50)=""
"RTN","GMRC513U",10,0)
 S DFN=GMRCDFN D DEM^GMRCU
"RTN","GMRC513U",11,0)
 S GMRCFAC=$P($G(^GMR(123,GMRCIFN,0)),"^",21)
"RTN","GMRC513U",12,0)
 I '+GMRCFAC S GMRCFAC=+($$SITE^VASITE())
"RTN","GMRC513U",13,0)
 N DIC,X,Y
"RTN","GMRC513U",14,0)
 I +GMRCFAC S X=GMRCFAC,DIC(0)="MOS",DIC(0)="^DIC(4," D ^DIC K DIC S GMRCFAC=$P(Y,U,2)
"RTN","GMRC513U",15,0)
 Q
"RTN","GMRC513U",16,0)
HDR ; Header code for form 513
"RTN","GMRC513U",17,0)
 W !,GMRCDVL,!,?6,"MEDICAL RECORD",?29,"|",?36,"CONSULTATION SHEET" W:$D(GMRCCTP) ?72,"Page ",PG
"RTN","GMRC513U",18,0)
 W !,GMRCDVL
"RTN","GMRC513U",19,0)
 W !,"Consult Request: " S GMRCRQ=$P(GMRCRD,"^",8) D  W ?55,"| Consult No.: ",GMRCIFN
"RTN","GMRC513U",20,0)
 .I '$L(GMRCRQ) W "Consult" Q
"RTN","GMRC513U",21,0)
 .S ORND=$P(GMRCRQ,";",1),ORFL=$P(GMRCRQ,";",2),REF="^"_ORFL_ORND_",0)" W $P(@(REF),"^",2)
"RTN","GMRC513U",22,0)
 .Q
"RTN","GMRC513U",23,0)
 I PG>1,$D(GMRCCTP),'$D(CMD) W !,GMRCDVL Q
"RTN","GMRC513U",24,0)
 W !,GMRCDVL I $D(GMRCCTP),$D(CMT),$L(CMT) W !?27,$S(CMT=20:"(Added Comments)",CMT=19:"(Cancel Comment)",1:"(Continuation of Report)"),! Q
"RTN","GMRC513U",25,0)
 W !,"To: ",$S($P(GMRCRD,"^",5)]"":$S($D(^GMR(123.5,$P(GMRCRD,"^",5),0)):$E($P(^(0),"^",1),1,28),1:""),1:"")
"RTN","GMRC513U",26,0)
 W ?29,"|From: ",$S(+$P(GMRCRD,"^",6):$E($P($G(^SC(+$P(GMRCRD,"^",6),0)),"^",1),1,22),1:"")
"RTN","GMRC513U",27,0)
 W ?56,"| Requested: " S GMRCRDT=$P(GMRCRD,"^",7) W $E(GMRCRDT,4,5)_"/"_$E(GMRCRDT,6,7)_"/"_($E(GMRCRDT,1,3)+1700)
"RTN","GMRC513U",28,0)
 W !,GMRCDVL
"RTN","GMRC513U",29,0)
 W "Requesting Facility: ",GMRCFAC I $P(GMRCRD,"^",11) W ?50,"| ATTENTION: "_$E($P(^VA(200,$P(GMRCRD,"^",11),0),"^",1),1,30)
"RTN","GMRC513U",30,0)
 W !,GMRCDVL
"RTN","GMRC513U",31,0)
 W !,"REASON FOR REQUEST: (Complaints and findings)" D:$O(^GMR(123,GMRCIFN,20,0))  W:'$O(^GMR(123,GMRCIFN,20,0)) ! W !,GMRCDVL
"RTN","GMRC513U",32,0)
 .S GLOB="^GMR(123,"_GMRCIFN_",20)",TMPGLOB="GMRCTMP",FLG=1,LINE="",TAB=""
"RTN","GMRC513U",33,0)
 .D WPSET^GMRCUTIL(GLOB,TMPGLOB,LINE,1,TAB,FLG)
"RTN","GMRC513U",34,0)
 .S LN=0 F  S LN=$O(GMRCTMP(LN)) Q:LN=""  W !,GMRCTMP(LN,0) D
"RTN","GMRC513U",35,0)
 ..I 'GMRCQUED,IOST'["P-",$Y>21 R !,"Press <ENTER> To Continue: ",GMRCANS:DTIME W @IOF Q
"RTN","GMRC513U",36,0)
 ..I PG'>1,$Y'<(IOSL-GMRCFTR) S:PG=0 PG=1 D FTR^GMRCP513 W @IOF S PG=PG+1,GMRCCTP=1,LRFC=1 D HDR W !?25,"REASON FOR REQUEST (CONTINUED)",! Q
"RTN","GMRC513U",37,0)
 ..I PG>1,$Y'<(IOSL-7) D FTR1^GMRCP513 W @IOF S PG=PG+1,LRFC=1 D HDR W !?25,"REASON FOR REQUEST (CONTINUED)",! Q
"RTN","GMRC513U",38,0)
 ..Q
"RTN","GMRC513U",39,0)
 .Q
"RTN","GMRC513U",40,0)
 W !,"PROVISIONAL DIAG: ",$S($D(^GMR(123,GMRCIFN,30)):^(30),1:""),!,GMRCDVL
"RTN","GMRC513U",41,0)
 S GMRCPGR="" D  I GMRCQSTR]"" S GMRCQSTR=$P(^VA(200,GMRCQSTR,0),"^",1)
"RTN","GMRC513U",42,0)
 .I $P(GMRCRD,"^",14)]"" S GMRCQSTR=$P(GMRCRD,"^",14) I $D(^VA(200,$P(GMRCRD,"^",14),.13)) D  Q
"RTN","GMRC513U",43,0)
 ..S GMRCPGR=$S($P(^VA(200,$P(GMRCRD,"^",14),.13),"^",7)]"":$P(^(.13),"^",7),$P(^(.13),"^",8)]"":$P(^(.13),"^",8),1:"") Q
"RTN","GMRC513U",44,0)
 .S GMRCQSTR=$P(GMRCRD,"^",3) I GMRCQSTR]"",+GMRCQSTR S GMRCQSTR=$P($G(^OR(100,+GMRCQSTR,0)),"^",4) Q
"RTN","GMRC513U",45,0)
 .S GMRCQSTR=""
"RTN","GMRC513U",46,0)
 .Q
"RTN","GMRC513U",47,0)
 W !,"REQUESTED BY: ",$S(GMRCPGR]"":"("_GMRCPGR_")",1:""),?30,"| APPROVED:",?40," | PLACE:",?64,"| URGENCY:" W ! W:GMRCQSTR'=0 GMRCQSTR W ?30,"| ",$E(GMRCUL,1,9),?40," | "_$S($P(GMRCRD,"^",10)]"":$P(^ORD(101,$P(GMRCRD,"^",10),0),"^",2),1:"")
"RTN","GMRC513U",48,0)
 W ?64,"| "_$S($P(GMRCRD,"^",9)]"":$E($P(^ORD(101,$P(GMRCRD,"^",9),0),"^",2),1,14),1:"")
"RTN","GMRC513U",49,0)
 W !,GMRCDVL,!?31,"CONSULTATION REPORT",!,GMRCDVL,!
"RTN","GMRC513U",50,0)
 I $D(GMRCCPY) W ?$S(GMRCCPY="C":31,1:28),$S(GMRCCPY="C":"C H A R T   C O P Y",1:"W O R K I N G   C O P Y"),!
"RTN","GMRC513U",51,0)
 Q
"RTN","GMRC513U",52,0)
EXIT ;Kill off variables set in this routine
"RTN","GMRC513U",53,0)
 I $S('$D(TIUFLG):1,'TIUFLG:1,1:0) D ^%ZISC
"RTN","GMRC513U",54,0)
 K %DT,ADDRS,CITY,CMT,CNO,COUNT,FLG,GLOB,GMRA,GMRARXN,GMRCAGN,GMRCQUED,GMRCSS,GMRCTYP,LINE,LN,LNFD,ND,ND1,ND2,ORACTION,PG,VAPA
"RTN","GMRC513U",55,0)
 K GMRCADD,GMRCCPY,GMRCCTP,GMRCDFN,GMRCDVL,GMRCFAC,GMRCFAC1,GMRCLOC,GMRCPGR,GMRCPNM,GMRCQIT,GMRCQSTR,GMRCRD,GMRCRDT,GMRCRB,GMRCRQ,GMRCTMP,GMRCUL,ORFL,ORND,PHONE,POP,REF,SEX,STATE,TIUFLG,TMPGLOB,ZIP
"RTN","GMRC513U",56,0)
 K GMRCELIG,GMRCPTN,GMRCSDT,GMRCSEX,GMRCSEL,GMRCSN,GMRCSIG,GMRCSSNM,GMRCSTCK,GMRCWARD,GMRCWT,GMRCTUFN
"RTN","GMRC513U",57,0)
 K ZTDESC,ZTRTN,ZTSAVE,ZTSK,ZTIO
"RTN","GMRC513U",58,0)
 K ^TMP("GMRCR",$J,"DT"),^TMP("GMRCR",$J,"RES")
"RTN","GMRC513U",59,0)
 Q
"RTN","GMRCA1")
0^6^B53384206
"RTN","GMRCA1",1,0)
GMRCA1 ;SLC/DLT,DCM - Actions taken from Review Screens ;5/28/98  10:57
"RTN","GMRCA1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCA1",3,0)
DC(GMRCO,GMRCA) ;Discontinue/Cancel(Deny) logic
"RTN","GMRCA1",4,0)
 ;GMRCO = File 123 IEN of consult
"RTN","GMRCA1",5,0)
 ;GMRCA = Action to take: 6=DISCONTINUED, 19=CANCELLED
"RTN","GMRCA1",6,0)
 ;GMRCOM=comments array
"RTN","GMRCA1",7,0)
 I '$G(GMRCA) W !!,"Action not defined!" S GMRCQUT=1 Q
"RTN","GMRCA1",8,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCA1",9,0)
 D DC^GMRCADC(GMRCO,GMRCA),END
"RTN","GMRCA1",10,0)
 Q
"RTN","GMRCA1",11,0)
COMMENT(GMRCO) ;Add a comment without changing the status
"RTN","GMRCA1",12,0)
 K GMRCQIT,GMRCQUT N GMRCA,GMRC123
"RTN","GMRCA1",13,0)
 I '$L(GMRCO) D  I $D(GMRCQUT) D END Q
"RTN","GMRCA1",14,0)
 .I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR") I $S(GMRCSEL<1:1,GMRCSEL>BLK:1,GMRCSEL="":1,1:0) K GMRCSEL D AGAIN^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCA1",15,0)
 .I '+$G(GMRCSEL) D SEL^GMRCA2 I $S($D(DTOUT):1,$D(DIROUT):1,'$L(GMRCSEL):1,'+GMRCSEL:1,1:0) D END S GMRCQIT=1 Q
"RTN","GMRCA1",16,0)
 .S GMRCO=$O(^TMP("GMRCR",$J,"CS","AD",GMRCSEL,GMRCSEL,0)) I GMRCO="" K GMRCO S GMRCQUT=1 Q
"RTN","GMRCA1",17,0)
 .Q
"RTN","GMRCA1",18,0)
 I '$L(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",19,0)
 ;S GMRC123=$G(^GMR(123,GMRCO,0))
"RTN","GMRCA1",20,0)
 ;I $S($P(GMRC123,"^",12)=2:1,$P(GMRC123,"^",12)=1:1,$P(GMRC123,"^",12)=13:1,1:0) D  S GMRCQUT=1 D END Q
"RTN","GMRCA1",21,0)
 ;.S GMRCMSG="This Consult Has Been "_$S($P(GMRC123,"^",12)=2:"Completed",$P(GMRC123,"^",12)=13:"Cancelled",1:"Discontinued")_". Adding A Comment Is Not Allowed." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1
"RTN","GMRCA1",22,0)
 ;.Q
"RTN","GMRCA1",23,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCA1",24,0)
 S GMRCOM=1,ORSTS="" S GMRCA=20 D AUDIT^GMRCP
"RTN","GMRCA1",25,0)
 ;GMRCOM=1 defined the variable and tells AUDIT^GMRCP that the word-processing logic should be executed. If an actual comment is added, $P(COMMENT,"^",2)=1 (send alert), if not COMMENT=1 and no '^' exists (do not send alert)
"RTN","GMRCA1",26,0)
 I +$P(GMRCOM,"^",2) D
"RTN","GMRCA1",27,0)
 . K ORBADUZ
"RTN","GMRCA1",28,0)
 . N GMRCANS
"RTN","GMRCA1",29,0)
 . F  R !,"Do You Wish To Send An Alert With This Comment? N// ",GMRCANS:DTIME Q:$S('$T:1,GMRCANS="":1,GMRCANS["^":1,1:0)  S GMRCANS=$TR(GMRCANS,"yesno","YESNO") D:"YESNO"'[GMRCANS  Q:"YESNO"[GMRCANS
"RTN","GMRCA1",30,0)
 . . W !!,$C(7),"Type 'Y' To Send An Alert, 'N' To Not Send An Alert",!
"RTN","GMRCA1",31,0)
 . . S GMRCANS="" Q
"RTN","GMRCA1",32,0)
 . I $S(GMRCANS="":1,"NO"[GMRCANS:1,GMRCANS["^":1,1:0) D END Q
"RTN","GMRCA1",33,0)
 . I GMRCANS["Y" D WHOTO
"RTN","GMRCA1",34,0)
 . I $O(ORBADUZ(0)) D
"RTN","GMRCA1",35,0)
 . . S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCA1",36,0)
 . . S GMRCORTX="Comment Added to Consult "_$S(+$P(^GMR(123,+GMRCO,0),"^",5):$P(^GMR(123.5,$P(^(0),"^",5),0),"^",1),1:"")
"RTN","GMRCA1",37,0)
 . . D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,27,.ORBADUZ,0)
"RTN","GMRCA1",38,0)
 . . Q
"RTN","GMRCA1",39,0)
 . Q
"RTN","GMRCA1",40,0)
 D END
"RTN","GMRCA1",41,0)
 Q
"RTN","GMRCA1",42,0)
WHOTO ;Get the users who should receive an alert
"RTN","GMRCA1",43,0)
 ;Asks about requesting provider first, then prompts for additional users
"RTN","GMRCA1",44,0)
 ;Returns ORBADUZ array of users to send an alert to
"RTN","GMRCA1",45,0)
 N GMRCRP,GMRCEND ;First the pointer value for the requestor, then requestor name
"RTN","GMRCA1",46,0)
 S GMRCRP=$P($G(^GMR(123,+GMRCO,0)),U,14)
"RTN","GMRCA1",47,0)
 I +GMRCRP S GMRCRP=$P($G(^VA(200,+GMRCRP,0)),U,1)
"RTN","GMRCA1",48,0)
 ;GMRCRP is now the requestor name or null
"RTN","GMRCA1",49,0)
 I $L(GMRCRP) D  Q:GMRCEND
"RTN","GMRCA1",50,0)
 . W !,"Send Alert To Requesting Provider "_$P(^VA(200,$P(^GMR(123,GMRCO,0),"^",14),0),"^",1)_": Y// "
"RTN","GMRCA1",51,0)
 . R GMRCANS:DTIME S GMRCEND=$S('$T:1,GMRCANS["^":1,1:0) Q:GMRCEND
"RTN","GMRCA1",52,0)
 . S:GMRCANS="" GMRCANS="Y" S GMRCANS=$TR(GMRCANS,"yesno","YESNO")
"RTN","GMRCA1",53,0)
 . I GMRCANS["Y" S ORBADUZ($P(^GMR(123,+GMRCO,0),"^",14))=""
"RTN","GMRCA1",54,0)
 . Q
"RTN","GMRCA1",55,0)
 S DIC=200,DIC(0)="AEMQ",DIC("A")=$S($L(GMRCRP):"And Send Alert To: ",1:"Send Alert To: ")
"RTN","GMRCA1",56,0)
 F  D ^DIC Q:Y<0  S ORBADUZ($P(Y,"^",1))="",DIC("A")="And Send Alert To: "
"RTN","GMRCA1",57,0)
 K DIC,DTOUT,DUOUT,DIROUT
"RTN","GMRCA1",58,0)
 Q
"RTN","GMRCA1",59,0)
 ;
"RTN","GMRCA1",60,0)
RC(GMRCO) ;Service tracking request has been received.
"RTN","GMRCA1",61,0)
 N GMRCDA,GMRCIFN
"RTN","GMRCA1",62,0)
RC1 K GMRCQUT,GMRCQIT,GMRCSEL,GMRCAGN
"RTN","GMRCA1",63,0)
 I '+GMRCO D  Q:$D(GMRCQIT)  I $D(GMRCAGN) G RC1
"RTN","GMRCA1",64,0)
 .I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR") I $S(GMRCSEL<1:1,GMRCSEL>BLK:1,1:0) K GMRCSEL D AGAIN^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCA1",65,0)
 .I '+$G(GMRCSEL) D SEL^GMRCA2 I $S($D(DTOUT):1,$D(DIROUT):1,'GMRCSEL:1,$D(GMRCQUT):1,$D(GMRCQIT):1,1:0) D END S GMRCQIT="",GMRCQUT=1 Q
"RTN","GMRCA1",66,0)
 .I '+$G(GMRCSEL) K GMRCSEL S GMRCQUT=1 Q
"RTN","GMRCA1",67,0)
 .I $S(+GMRCSEL<1:1,GMRCSEL>BLK:1,1:0) W !,"Select A Consult Number In The Range 1 to "_BLK S GMRCAGN=1 Q
"RTN","GMRCA1",68,0)
 .S GMRCO=$O(^TMP("GMRCR",$J,"CS","AD",GMRCSEL,GMRCSEL,0))
"RTN","GMRCA1",69,0)
 .Q
"RTN","GMRCA1",70,0)
 S GMRC(0)=^GMR(123,GMRCO,0),DFN=$P(GMRC(0),"^",2)
"RTN","GMRCA1",71,0)
 I $P(GMRC(0),"^",12)<3 S GMRCMSG="No Action Possible: This order has already been completed or discontinued!" D EXAC^GMRCADC(GMRCMSG) D END S GMRCQUT=1 Q
"RTN","GMRCA1",72,0)
 ;an active status does'nt mean received was entered ;I $P(GMRC(0),"^",12)=6 S GMRCMSG="This Consult Has Been Received By The Service And Has An Active Status." D EXAC^GMRCADC(GMRCMSG) G END
"RTN","GMRCA1",73,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCA1",74,0)
 S GETPROV="Who received it?" D GETPROV^GMRCAU K GETPROV I $D(GMRCQIT) D END S GMRCQIT="Q",GMRCQUT=1 Q
"RTN","GMRCA1",75,0)
 S GETDT="Date/Time Actually Received" D GETDT^GMRCAU K GETDT I $D(GMRCQIT) W !!,$C(7),"Consult not updated with Received action.",!,"Press <ENTER> To Exit: " R X:DTIME D END S GMRCQUT=1 Q
"RTN","GMRCA1",76,0)
 ;The activity date is stored in GMRCAD
"RTN","GMRCA1",77,0)
 S GMRCA=21 ;for "Received"
"RTN","GMRCA1",78,0)
 ;A status of other than 5 for Pending, indicates a historical update
"RTN","GMRCA1",79,0)
 ;of the receipt of the consult, which will not update the status
"RTN","GMRCA1",80,0)
 I $P(GMRC(0),"^",12)=5 S GMRCSTS=6,$P(GMRC(0),"^",12)=GMRCSTS
"RTN","GMRCA1",81,0)
 E  S GMRCSTS=$P(GMRC(0),"^",12)
"RTN","GMRCA1",82,0)
 D STATUS^GMRCP,AUDIT^GMRCP
"RTN","GMRCA1",83,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCWARD),"SC",GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCA1",84,0)
 D END
"RTN","GMRCA1",85,0)
 Q
"RTN","GMRCA1",86,0)
RT(GMRCO) ;Results Display logic
"RTN","GMRCA1",87,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCA1",88,0)
 N GMRCCT,LNCT
"RTN","GMRCA1",89,0)
 I '$L(GMRCO) D  I $D(GMRCQUT) D END Q
"RTN","GMRCA1",90,0)
 .I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR") I $S(GMRCSEL<1:1,GMRCSEL>BLK:1,1:0) K GMRCSEL D AGAIN^GMRCSLMV(GMRC("NMBR")) Q
"RTN","GMRCA1",91,0)
 .I '+$G(GMRCSEL) D SEL^GMRCA2 I $S($D(DTOUT):1,$D(DIROUT):1,'GMRCSEL:1,1:0) D END S GMRCQIT="" Q
"RTN","GMRCA1",92,0)
 .S GMRCO=$O(^TMP("GMRCR",$J,"CS","AD",+GMRCSEL,+GMRCSEL,0)),XQADATA=GMRCO
"RTN","GMRCA1",93,0)
 .Q
"RTN","GMRCA1",94,0)
 I '$L(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",95,0)
 N GMRCPRNM,ORACTION,XQADATA,OREND,ORVP
"RTN","GMRCA1",96,0)
 S GMRCSR=$P(^GMR(123,+GMRCO,0),"^",15),GMRCTUFN=$P(^(0),"^",20) I '+GMRCSR&('GMRCTUFN) S GMRCMSG="No results are available for review." D EXAC^GMRCADC(GMRCMSG) D END S GMRCQUT=1 Q
"RTN","GMRCA1",97,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCA1",98,0)
 K ^TMP("GMRCR",$J,"DT")
"RTN","GMRCA1",99,0)
 S:$D(VALMAR) GMRCVAL=VALMAR
"RTN","GMRCA1",100,0)
 I $E($P(GMRCSR,";",2),1,2)="MC" S MCFILE=$P(GMRCSR,";",2),MCFILE=$P(MCFILE,","),MCPROC=$O(^MCAR(697.2,"C",MCFILE,"")) Q:'MCPROC
"RTN","GMRCA1",101,0)
 I +GMRCSR D AREN^GMRCSLM3(GMRCO,GMRCSR)
"RTN","GMRCA1",102,0)
 I +GMRCTUFN D
"RTN","GMRCA1",103,0)
 .S:'$D(GMRCCT) GMRCCT=1
"RTN","GMRCA1",104,0)
 .I +GMRCSR,$O(^TMP("GMRCR",$J,"DT",0)) S ^(0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCA1",105,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$E(TAB,1,30)_"TIU CONSULT REPORT",GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCA1",106,0)
 .D PRINT^GMRCTIU(GMRCTUFN,GMRCCT,1)
"RTN","GMRCA1",107,0)
 .S ND=0 F  S ND=$O(^TMP("GMRCR",$J,"RES",ND)) Q:(ND="")!(ND?1A.E)  S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"RES",ND,0),GMRCCT=GMRCCT+1
"RTN","GMRCA1",108,0)
 .I ND="ADD" S ND=0 F  S ND=$O(^TMP("GMRCR",$J,"RES","ADD",ND)) Q:ND=""  S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"DT",GMRCCT,0)=TAB_" ADDENDUM ",GMRCCT=GMRCCT+1 D
"RTN","GMRCA1",109,0)
 ..S ND1=0 F  S ND1=$O(^TMP("GMRCR",$J,"RES","ADD",ND,ND1)) Q:ND1=""  S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"RES","ADD",ND,ND1,0),GMRCCT=GMRCCT+1
"RTN","GMRCA1",110,0)
 ..Q
"RTN","GMRCA1",111,0)
 .K ^TMP("GMRCR",$J,"RES")
"RTN","GMRCA1",112,0)
 .Q
"RTN","GMRCA1",113,0)
 I '$O(^TMP("GMRCR",$J,"DT",0)) S GMRCCT=1,^TMP("GMRCR",$J,"DT",GMRCCT,0)="  No Medicine Or TIU Results Exist For This Consult"
"RTN","GMRCA1",114,0)
 D EN^VALM("GMRC RESULTS DISPLAY")
"RTN","GMRCA1",115,0)
 S:$D(GMRCVAL) VALMAR=GMRCVAL S:$D(LNCT) VALMCNT=LNCT
"RTN","GMRCA1",116,0)
 D KILL^VALM10()
"RTN","GMRCA1",117,0)
 K ^TMP("GMRCR",$J,"DT")
"RTN","GMRCA1",118,0)
 K ORACTION,XQADATA,OREND,ORAGE,ORIO,ORDOB,ORFT,ORHI,ORIFN,ORNP,ORL,ORPD,ORPNM,ORPV,ORSEQ,ORSEX,ORWARD,ORDG
"RTN","GMRCA1",119,0)
 K GMRCLCT,GMRCTUFN,GMRCVAL,MCFILE,MCPROC,GMRCX,GMRCTO,GMRCPRNM
"RTN","GMRCA1",120,0)
 D END
"RTN","GMRCA1",121,0)
 Q
"RTN","GMRCA1",122,0)
PS(GMRCO) ;Print Service Copy
"RTN","GMRCA1",123,0)
 K GMRCQUT,GMRCQIT,GMRCSEL
"RTN","GMRCA1",124,0)
 I '+GMRCO D  Q:$D(GMRCQIT)
"RTN","GMRCA1",125,0)
 .I '$D(^TMP("GMRCR",$J,"CS","AD")) W $C(7),!,"No Orders Exist To Print!",! S GMRCQIT=1 Q
"RTN","GMRCA1",126,0)
 .I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR") I $S(GMRCSEL<1:1,GMRCSEL>BLK:1,1:0) K GMRCSEL D AGAIN^GMRCSLMV(GMRC("NMBR"))
"RTN","GMRCA1",127,0)
 .I '+$G(GMRCSEL),'$O(^TMP("GMRCR",$J,"CS","AD")),BLK=1 S GMRCSEL=BLK
"RTN","GMRCA1",128,0)
 .I '+$G(GMRCSEL)  D SEL^GMRCA2 I $S($D(DTOUT):1,$D(DIROUT):1,'GMRCSEL:1,1:0) D END S GMRCQIT="" Q
"RTN","GMRCA1",129,0)
 .S GMRCO=$O(^TMP("GMRCR",$J,"CS","AD",GMRCSEL,GMRCSEL,0))
"RTN","GMRCA1",130,0)
 .Q
"RTN","GMRCA1",131,0)
 S GMRC(0)=^GMR(123,GMRCO,0)
"RTN","GMRCA1",132,0)
 D EN^GMRCP513(GMRCO)
"RTN","GMRCA1",133,0)
 D END
"RTN","GMRCA1",134,0)
 Q
"RTN","GMRCA1",135,0)
END ;kill off variables and exit
"RTN","GMRCA1",136,0)
 K GMRC(0),GMRCA,GMRCACTM,GMRCAGN,GMRCDFN,GMRCIEN,GMRCMSG,GMRCOM,GMRCO,GMRCORFN,GMRCORN,GMRCORTX,GMRCSEL,GMRCSTS,GMRCTRLC,GMRCEND,GMRCSA,GMRCSR,GMRCBM,GMRCTM,ORBADUZ,ORIFN,OREND,STS
"RTN","GMRCA1",137,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCA1",138,0)
 K DTOUT,DIROUT,DUOUT
"RTN","GMRCA1",139,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCA1",140,0)
 Q
"RTN","GMRCA2")
0^104^B1995936
"RTN","GMRCA2",1,0)
GMRCA2 ;SLC/KCM,DLT - Select prompt for processing actions ;5/20/98  14:20
"RTN","GMRCA2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCA2",3,0)
SEL ;Select order number(s)   exit: GMRCSEL
"RTN","GMRCA2",4,0)
 I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR") Q
"RTN","GMRCA2",5,0)
 I '$D(^TMP("GMRCR",$J,"CS","AD")) W !,"No orders to select.",! S GMRCQUT=1,GMRCSEL="" Q
"RTN","GMRCA2",6,0)
 I '$O(^TMP("GMRCR",$J,"CS","AD")),BLK=1 S GMRCSEL=BLK Q
"RTN","GMRCA2",7,0)
 S GMRCSEL="" W !,"CHOOSE No. 1-",BLK,": " R X:DTIME S:X="^^" DIROUT=1 I '$T!(X["^") S (DTOUT,GMRCQUT)=1 Q
"RTN","GMRCA2",8,0)
 I X["?" D SELHELP G SEL
"RTN","GMRCA2",9,0)
 I X="" S GMRCQUT=1 Q
"RTN","GMRCA2",10,0)
 I X'?.3N W $C(7)," ??  Enter The Consult Number At Far Left Of Display." G SEL
"RTN","GMRCA2",11,0)
 I $S(X>BLK:1,X<1:1,1:0) D SELHELP G SEL
"RTN","GMRCA2",12,0)
 S GMRCSEL=X
"RTN","GMRCA2",13,0)
 Q
"RTN","GMRCA2",14,0)
SELHELP ;Help to select a valid entry
"RTN","GMRCA2",15,0)
 W !,"Select a request by typing the number in the left column and pressing <ENTER>.",!
"RTN","GMRCA2",16,0)
 Q
"RTN","GMRCA2",17,0)
UP ;Convert lower to upper case   entry: X   exit: X
"RTN","GMRCA2",18,0)
 F %=1:1:$L(X) I $E(X,%)?1L S X=$E(X,1,%-1)_$C($A(X,%)-32)_$E(X,%+1,99)
"RTN","GMRCA2",19,0)
 Q
"RTN","GMRCACTM")
0^9^B10100575
"RTN","GMRCACTM",1,0)
GMRCACTM ;SLC/DLT,DCM - Set GMRCACTM with action menu based on Service ;5/20/98  14:20
"RTN","GMRCACTM",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCACTM",3,0)
CPRS(GMRCPM) ;Entry point for setting appropriate menu actions for CPRS user
"RTN","GMRCACTM",4,0)
 ;GMRCPM=a list of File 123 IEN's to check for menu actions.
"RTN","GMRCACTM",5,0)
 ;       Passed in as '300;303;295;309;313'
"RTN","GMRCACTM",6,0)
 ;Menu access is passed out in ORFLG as, for example,
"RTN","GMRCACTM",7,0)
 ;ORFLG(300)=2; ORFLG(303)=1; ORFLG(309)=3
"RTN","GMRCACTM",8,0)
 I '$L(GMRCPM) S ORFLG=1 Q
"RTN","GMRCACTM",9,0)
 K ORFLG
"RTN","GMRCACTM",10,0)
 F I=1:1 S ORFLG=1,GMRCIEN=$P(GMRCPM,";",I) Q:GMRCIEN=""  D
"RTN","GMRCACTM",11,0)
 .S GMRCSS=$P($G(^GMR(123,GMRCIEN,0)),"^",5) Q:'$L(GMRCSS)  S GMRCSSNM=$P(^GMR(123.5,GMRCSS,0),"^",1)
"RTN","GMRCACTM",12,0)
 .D EN
"RTN","GMRCACTM",13,0)
 .S ORFLG(GMRCIEN)=ORFLG
"RTN","GMRCACTM",14,0)
 .Q
"RTN","GMRCACTM",15,0)
 K GMRCSS,GMRCSSNM,GMRCIEN
"RTN","GMRCACTM",16,0)
 Q
"RTN","GMRCACTM",17,0)
EN ;Set GMRCACTM with appropriate menu of actions given user characteristics
"RTN","GMRCACTM",18,0)
 ;If ORFLG is DEFINED then GMRCACTM is returned as a set of codes:
"RTN","GMRCACTM",19,0)
 ;    1: equivalent to GMRCACTM USER REVIEW SCREEN - simple actions
"RTN","GMRCACTM",20,0)
 ;    2: equivalent to GMRCACTM SERVICE ACTION menu  - sll actions possible to a service user
"RTN","GMRCACTM",21,0)
 ;    3: equivalent to GMRCACTM TRK MEDICINE CONSULTS menu - all actions that the user of the medicine package can take.
"RTN","GMRCACTM",22,0)
 S GMRCACTM="GMRCACTM USER REVIEW SCREEN"
"RTN","GMRCACTM",23,0)
 I $D(XQY0),$E(XQY0,1,2)="MC" S GMRCACTM="GMRCACTM MEDICINE PKG MENU" Q
"RTN","GMRCACTM",24,0)
 I '$D(GMRCSS),$D(GMRCSSNM),$L(GMRCSSNM) S GMRCSS=$O(^GMR(123.5,"B",GMRCSSNM,0))
"RTN","GMRCACTM",25,0)
 I '$D(XQADATA),$S('$D(GMRCSS):1,'GMRCSS:1,1:0)  S:$D(ORFLG) ORFLG=1 K:$D(ORFLG) GMRCACTM Q
"RTN","GMRCACTM",26,0)
 N GMRCOPT,GMRCUSER
"RTN","GMRCACTM",27,0)
 I $D(GMRCSS),+GMRCSS S GMRCSSNM=$P($G(^GMR(123.5,GMRCSS,0)),"^",1),GMRCUSER=$P($G(^GMR(123.5,GMRCSS,123)),"^",8),GMRCOPT=$P($G(^GMR(123.5,GMRCSS,123)),"^",10)
"RTN","GMRCACTM",28,0)
 I $D(GMRCOPT),+GMRCOPT,$D(XQY),+XQY=GMRCOPT S GMRCACTM=$P($G(^GMR(123.5,GMRCSS,123)),"^",3) D   D KILL Q
"RTN","GMRCACTM",29,0)
 .I +GMRCACTM S GMRCACTM=$S($P($G(^GMR(123.5,GMRCSS,123)),"^",3):$P(^ORD(101,$P(^(123),"^",3),0),"^"),1:"GMRCACTM USER REVIEW SCREEN")
"RTN","GMRCACTM",30,0)
 .I $D(ORFLG) S ORFLG=$S(GMRCACTM="GMRCACTM SERVICE ACTION MENU":2,1:1) K GMRCACTM
"RTN","GMRCACTM",31,0)
 .Q
"RTN","GMRCACTM",32,0)
 I $D(GMRCUSER),GMRCUSER=DUZ D SETACTM D:$D(ORFLG)  D KILL Q
"RTN","GMRCACTM",33,0)
 .S ORFLG=$S(GMRCACTM="GMRCACTM SERVICE ACTION MENU":2,1:1) K GMRCACTM
"RTN","GMRCACTM",34,0)
 .Q
"RTN","GMRCACTM",35,0)
 I $D(GMRCSS),+GMRCSS,$D(^GMR(123.5,GMRCSS,123.3,"B",DUZ)) D SETACTM D:$D(ORFLG)  D KILL Q
"RTN","GMRCACTM",36,0)
 .S ORFLG=$S(GMRCACTM="GMRCACTM SERVICE ACTION MENU":2,1:1) K GMRCACTM
"RTN","GMRCACTM",37,0)
 .Q
"RTN","GMRCACTM",38,0)
 K GMRCUSER I $D(GMRCSS),+GMRCSS S GMRCTM="" F  S GMRCTM=$O(^GMR(123.5,GMRCSS,123.1,"B",GMRCTM)) Q:GMRCTM=""  S GMRCLST="" D TEAMPROV^ORQPTQ1(.GMRCLST,GMRCTM) D  Q:$D(GMRCUSER)  K GMRCLST,GMRCER
"RTN","GMRCACTM",39,0)
 .I $P(GMRCLST(1),"^",2)="No providers found." Q
"RTN","GMRCACTM",40,0)
 .S ND=0 F  S ND=$O(GMRCLST(ND)) Q:ND=""  I $P(GMRCLST(ND),"^",1)=DUZ S GMRCUSER=DUZ D SETACTM Q
"RTN","GMRCACTM",41,0)
 .I $D(ORFLG) S ORFLG=$S('$D(GMRCACTM):1,GMRCACTM="GMRCACTM SERVICE ACTION MENU":2,1:1) K GMRCACTM
"RTN","GMRCACTM",42,0)
 .Q
"RTN","GMRCACTM",43,0)
 D KILL
"RTN","GMRCACTM",44,0)
 Q
"RTN","GMRCACTM",45,0)
SETACTM ;Set GMRCACTM with local update menu or the GMRCACTM SERVICE ACTION MENU
"RTN","GMRCACTM",46,0)
 S GMRCACTM=$S($P($G(^GMR(123.5,GMRCSS,123)),"^",3):$P(^ORD(101,$P(^(123),"^",3),0),"^"),1:"GMRCACTM SERVICE ACTION MENU")
"RTN","GMRCACTM",47,0)
 Q
"RTN","GMRCACTM",48,0)
KILL ;kill off variables
"RTN","GMRCACTM",49,0)
 K GMRCLST,GMRCKEY,GMRCOPT,GMRCUSER,GMRCTM,GMRCTM,GMRCLST,GMRCER
"RTN","GMRCACTM",50,0)
 Q
"RTN","GMRCADC")
0^10^B9945997
"RTN","GMRCADC",1,0)
GMRCADC ;SLC/DLT,DCM - Discontinue Action taken from List Manager ;5/20/98  14:20
"RTN","GMRCADC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCADC",3,0)
EXAC(MSG) ;Exit message asking for user to press <ENTER>; EXAC=Exit Action
"RTN","GMRCADC",4,0)
 W $C(7),!,MSG I $O(MSG(0)) S ND=0 F  S ND=$O(MSG(ND)) Q:ND=""  W !,MSG(ND)
"RTN","GMRCADC",5,0)
 W !,"Press <ENTER> to exit: " R X:DTIME W !!
"RTN","GMRCADC",6,0)
 Q
"RTN","GMRCADC",7,0)
DC(GMRCO,GMRCA) ;Discontinue a consult logic from DC^GMRCA1
"RTN","GMRCADC",8,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCADC",9,0)
 N GMRCDA,GMRCACTM,GMRCSS,GMRCSSNM,GMRCPROC
"RTN","GMRCADC",10,0)
DC1 ;Get a consult if not defined in GMRCO, then continue
"RTN","GMRCADC",11,0)
 I '+GMRCO D  I $D(GMRCQUT) Q
"RTN","GMRCADC",12,0)
 .I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR")
"RTN","GMRCADC",13,0)
 .I '$D(GMRCSEL),$D(LNCT),LNCT=1 S GMRCSEL=LNCT
"RTN","GMRCADC",14,0)
 .I '$D(GMRCSEL) D SEL^GMRCA2 I $S($D(DTOUT):1,$D(DIROUT):1,'+GMRCSEL:1,1:0) S GMRCQUT=1 K DTOUT,DIROUT,DUOUT Q
"RTN","GMRCADC",15,0)
 .S GMRCO=$O(^TMP("GMRCR",$J,"CS","AD",GMRCSEL,GMRCSEL,0))
"RTN","GMRCADC",16,0)
 .I '+GMRCO S GMRCQUT=1 Q
"RTN","GMRCADC",17,0)
 .Q
"RTN","GMRCADC",18,0)
 S GMRC(0)=^GMR(123,GMRCO,0),GMRCDA=GMRCO
"RTN","GMRCADC",19,0)
 S DFN=$P(GMRC(0),"^",2)
"RTN","GMRCADC",20,0)
 I $D(GMRCA),+GMRCA S GMRCACTM=$S(GMRCA=6:"Discontinued",GMRCA=19:"Cancelled",1:$P($G(GMR(123.1,+GMRCA,0)),"^",1))
"RTN","GMRCADC",21,0)
 D PROC I $D(GMRCQUT) S GMRCQUT=1 Q
"RTN","GMRCADC",22,0)
 S GMRCTRLC=$S(GMRCA=19:"OC",1:"OD")
"RTN","GMRCADC",23,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),GMRCTRLC,GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCADC",24,0)
 Q
"RTN","GMRCADC",25,0)
PROC ;;Process discontinue logic
"RTN","GMRCADC",26,0)
 I $P(GMRC(0),"^",12)=1 S GMRCMSG="This order has already been discontinued!" D EXAC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",27,0)
 I $P(GMRC(0),"^",12)=2 S GMRCMSG="This order has already been completed!" D EXAC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",28,0)
 I $P(GMRC(0),"^",12)=13 S GMRCMSG="This order has already been cancelled!" D EXAC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",29,0)
 S GMRCDFN=$P(GMRC(0),"^",2),GMRCORVP=GMRCDFN_";DPT("
"RTN","GMRCADC",30,0)
 K GETPROV D GETPROV^GMRCAU I $D(DIROUT)!$D(DTOUT)!$D(DUOUT) S GMRCQUT=1 Q
"RTN","GMRCADC",31,0)
 K GETDT D GETDT^GMRCAU I $D(DIROUT)!$D(DTOUT)!$D(DUOUT) S GMRCQUT=1 Q
"RTN","GMRCADC",32,0)
 S GMRCSTS=$S(GMRCA=6:1,1:13),$P(GMRC(0),"^",12)=GMRCSTS
"RTN","GMRCADC",33,0)
 S GMRCOM=1 D STATUS^GMRCP,AUDIT^GMRCP
"RTN","GMRCADC",34,0)
 S GMRCSS=$P(^GMR(123,+GMRCO,0),"^",5),GMRCSSNM=""
"RTN","GMRCADC",35,0)
 I +GMRCSS S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSS,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSS,0)),U,1))
"RTN","GMRCADC",36,0)
 S GMRCPROC=$P(^GMR(123,+GMRCO,0),"^",8)
"RTN","GMRCADC",37,0)
 I +GMRCPROC S GMRCPROC=$S($L($G(^ORD(101,+GMRCPROC,.1))):^(.1),1:$P($G(^ORD(101,+GMRCPROC,0)),"^",2))
"RTN","GMRCADC",38,0)
 S GMRCORTX=$S($L(GMRCPROC):($E(GMRCSSNM,1,10)_" "_$E(GMRCPROC,1,10)),1:$E(GMRCSSNM,1,20))
"RTN","GMRCADC",39,0)
 S GMRCORTX=$S($L($G(GMRCACTM)):GMRCACTM,+GMRCA:$P(^GMR(123.1,GMRCA,0),U,1),1:"ACTION UNKNOWN FOR")_" consult "_GMRCORTX
"RTN","GMRCADC",40,0)
 I $P(^GMR(123,GMRCO,0),"^",14)]"" S ORBADUZ($P(^(0),"^",14))=""
"RTN","GMRCADC",41,0)
 I $O(ORBADUZ(0)) D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,$S(GMRCA=6:23,1:30),.ORBADUZ,1) ;send notification info to routine to be sent to OERR
"RTN","GMRCADC",42,0)
 Q
"RTN","GMRCAFRD")
0^12^B29928045
"RTN","GMRCAFRD",1,0)
GMRCAFRD ;SLC/DLT,DCM - Forward Req (FR) Action from Review Screen ;5/20/98  14:20
"RTN","GMRCAFRD",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCAFRD",3,0)
FR(GMRCO) ;Forward Request to a new service
"RTN","GMRCAFRD",4,0)
 N ORVP
"RTN","GMRCAFRD",5,0)
 K GMRCQIT,GMRCQUT
"RTN","GMRCAFRD",6,0)
 W !!,"Forward Request To Another Service For Action.",!
"RTN","GMRCAFRD",7,0)
 S:$D(GMRCSS) GMRCSSS=GMRCSS
"RTN","GMRCAFRD",8,0)
 N GMRCORVP,GMRCIFN,GMRCPL,GMRCPR,GMRCURG,GMRCDG,GMRCFF,GMRCORNP,GMRCTO,GMRCPROC,GMRCSS,GMRCSSNM
"RTN","GMRCAFRD",9,0)
 I '$L(GMRCO) D  I $D(GMRCQUT) D END Q
"RTN","GMRCAFRD",10,0)
 .I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR")
"RTN","GMRCAFRD",11,0)
 .I '$D(GMRCSEL),$D(LNCT),LNCT=1 S GMRCSEL=LNCT
"RTN","GMRCAFRD",12,0)
 .I '$D(GMRCSEL) D SEL^GMRCA2 I $S($D(DTOUT):1,$D(DIROUT):1,$D(GMRCQUT):1,$D(GMRCQIT):1,'+GMRCSEL:1,1:0) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",13,0)
 .I '$L(GMRCSEL) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",14,0)
 .S GMRCO=$O(^TMP("GMRCR",$J,"CS","AD",GMRCSEL,GMRCSEL,0)) I '+GMRCO D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",15,0)
 .Q
"RTN","GMRCAFRD",16,0)
 I '+GMRCO S GMRCMSG="??  No Consult was selected!!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",17,0)
 I $P(^GMR(123,GMRCO,0),"^",12)<3 S GMRCMSG="NO ACTION POSSIBLE. This Consult Has Already Been Completed Or Discontinued." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",18,0)
 I $P(^GMR(123,GMRCO,0),"^",12)=13 S GMRCMSG="NO ACTION POSSIBLE. This Consult Has Already Been Cancelled." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",19,0)
 I $D(IOBM),$D(IOTM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCAFRD",20,0)
 I $P(^GMR(123,GMRCO,0),"^",16) W !!,"This is a SERVICE ENTERED order stub.  Please send the written consult to the",!,"Service, in addition to the automated forwarding!"
"RTN","GMRCAFRD",21,0)
 S DFN=+$P(^GMR(123,GMRCO,0),"^",2)
"RTN","GMRCAFRD",22,0)
 S GMRCTO=1,GMRCASV="Forward Consult To Which Service/Specialty: "
"RTN","GMRCAFRD",23,0)
 D ASRV^GMRCASV K GMRCASV I $S($D(DTOUT):1,$D(DIROUT):1,$D(GMRCQUT):1,1:0) D END Q
"RTN","GMRCAFRD",24,0)
 I 'GMRCDG S GMRCMSG="No Service Was Selected. Consult Was Not Forwarded To Any Service!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",25,0)
 S GMRCFF=$P(^GMR(123,GMRCO,0),"^",5) I GMRCFF=+GMRCDG S GMRCMSG="The Forwarding Service Cannot Forward A Consult To Itself!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",26,0)
 S GETPROV="Who is responsible for Forwarding the Consult?"
"RTN","GMRCAFRD",27,0)
 D GETPROV^GMRCAU I '$D(GMRCORNP) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",28,0)
 D DEFAULT
"RTN","GMRCAFRD",29,0)
 S GMRCSS=+GMRCDG
"RTN","GMRCAFRD",30,0)
 I +GMRCSS,'$D(^GMR(123.5,+GMRCSS,0)) S GMRCMSG="Error in Service Chosen - SERVICE Does Not Exist!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",31,0)
 S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSS,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSS,0)),U,1))
"RTN","GMRCAFRD",32,0)
 D URG I $D(GMRCEND),GMRCEND D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",33,0)
 S GMRCA=17,DIE="^GMR(123,",DA=GMRCO,ORSTS=5
"RTN","GMRCAFRD",34,0)
 S DR="1////^S X=GMRCSS;5////^S X=GMRCURGI;8////^S X=ORSTS;9////^S X=GMRCA"
"RTN","GMRCAFRD",35,0)
 L +^GMR(123,GMRCO):2 I '$T K DIE,DA,DR S GMRCMSG="Another User Is Accessing This Record. UPDATE WAS UNSUCCESSFUL.",GMRCMSG(1)="Try Again Later." D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",36,0)
 D ^DIE L -^GMR(123,GMRCO) K DIE,DA,DR
"RTN","GMRCAFRD",37,0)
 S GMRCOM=1 D AUDIT^GMRCP
"RTN","GMRCAFRD",38,0)
 S GMRCPROC=$P(^GMR(123,+GMRCO,0),"^",8)
"RTN","GMRCAFRD",39,0)
 I +GMRCPROC S GMRCPROC=$S($L($G(^ORD(101,+GMRCPROC,.1))):^(.1),1:$P($G(^ORD(101,+GMRCPROC,0)),U,2))
"RTN","GMRCAFRD",40,0)
 S GMRCORTX=$S($L(GMRCPROC):($E(GMRCSSNM,1,10)_" "_$E(GMRCPROC,1,10)),1:$E(GMRCSSNM,1,20))
"RTN","GMRCAFRD",41,0)
 S GMRCORTX="Forwarded consult "_GMRCORTX_" ("_GMRCURG_")"
"RTN","GMRCAFRD",42,0)
 ;S GMRCORTX="New "_$E(GMRCSSNM,1,10)_" "_$S($L(GMRCPROC):$E(GMRCPROC,1,10),1:"")_" consult forwarded ("_GMRCURG_")"
"RTN","GMRCAFRD",43,0)
 S GMRCORNP=$P(^GMR(123,GMRCO,0),"^",14) ;This is the original provider that ordered the consult
"RTN","GMRCAFRD",44,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),"XX",$G(GMRCORNP),$G(VISIT),.GMRCOM)
"RTN","GMRCAFRD",45,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,27,"",1) ;GMRCO=IEN of consult from file 123; 27 is alert action from file ORD(100.9
"RTN","GMRCAFRD",46,0)
 K GMRCOM
"RTN","GMRCAFRD",47,0)
 S GMRCDEV=$P($G(^GMR(123.5,GMRCSS,123)),"^",9)
"RTN","GMRCAFRD",48,0)
 I GMRCDEV D PRNT^GMRCUTL1(GMRCSS,+GMRCO)
"RTN","GMRCAFRD",49,0)
 D END
"RTN","GMRCAFRD",50,0)
 Q
"RTN","GMRCAFRD",51,0)
URG ;Get the default urgency
"RTN","GMRCAFRD",52,0)
 D DEM^GMRCU
"RTN","GMRCAFRD",53,0)
 I $P(^GMR(123,+GMRCO,0),"^",18)["I" D
"RTN","GMRCAFRD",54,0)
 .I GMRCTYPE="GMRCOR CONSULT" S X="GMRCURGENCYM CSLT - INPATIENT"
"RTN","GMRCAFRD",55,0)
 .S X="GMRCURGENCYM REQ - INPATIENT"
"RTN","GMRCAFRD",56,0)
 E  S X="GMRCURGENCYM - OUTPATIENT"
"RTN","GMRCAFRD",57,0)
 I '$D(GMRCURG) S GMRCURGI=$O(^ORD(101,"B","GMRCURGENCY - ROUTINE","")) S:+GMRCURGI GMRCURG=$P($G(^ORD(101,+GMRCURGI,0)),"^",2)
"RTN","GMRCAFRD",58,0)
 S Y=$O(^ORD(101,"B",X,""))
"RTN","GMRCAFRD",59,0)
 S XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Urgency: ",XQORM("NO^^")=""
"RTN","GMRCAFRD",60,0)
 S:$L(GMRCURG) XQORM("B")=GMRCURG D ^XQORM I X="^"!($D(DIROUT)) K XQORM S GMRCEND=1 Q
"RTN","GMRCAFRD",61,0)
 K XQORM(0),XQORM("A"),XQORM("B"),XQORM("NO^^") S XQORM=""
"RTN","GMRCAFRD",62,0)
 I '$D(Y) S GMRCEND=1 Q
"RTN","GMRCAFRD",63,0)
 I $D(Y(1)) S GMRCURG=$P(Y(1),"^",3),GMRCURGI=$P(Y(1),"^",2)
"RTN","GMRCAFRD",64,0)
 Q
"RTN","GMRCAFRD",65,0)
DEFAULT ;Set up defaults for editing to be equal to the existing data.
"RTN","GMRCAFRD",66,0)
 Q:'$D(GMRCO)  S (GMRCSS,GMRCSSNM,GMRCPL,GMRCPR,GMRCPRI,GMRCURG)=""
"RTN","GMRCAFRD",67,0)
 S GMRCOM=0,GMRC(0)=$S($D(^GMR(123,+GMRCO,0)):^(0),1:"")
"RTN","GMRCAFRD",68,0)
 S GMRCSS=$P(GMRC(0),"^",5) I +GMRCSS,$D(^GMR(123.5,+GMRCSS,0)) S GMRCSSNM=$S($L($P($G(^GMR(123.5,+GMRCSS,0)),U,1)):$P(^(0),U,1),1:"")
"RTN","GMRCAFRD",69,0)
 I +GMRCSS S GMRC(123)=$S($D(^GMR(123.5,+GMRCSS,123)):^(123),1:"")
"RTN","GMRCAFRD",70,0)
 S GMRCPLI=$P(GMRC(0),"^",10) I GMRCPLI S GMRCPL=$P($G(^ORD(101,GMRCPLI,0)),"^",2)
"RTN","GMRCAFRD",71,0)
 S GMRCURGI=$P(GMRC(0),"^",9) I GMRCURGI S GMRCURG=$P($G(^ORD(101,GMRCURGI,0)),"^",2)
"RTN","GMRCAFRD",72,0)
 S GMRCPRI=$P(GMRC(0),"^",8),GMRCDIC=$P(GMRCPRI,";",2) I $L(GMRCDIC) S GMRCDIC="^"_GMRCDIC_$P(GMRCPRI,";")_",0)",GMRCPR=$S($D(@(GMRCDIC)):$P(^(0),"^",2),1:"")
"RTN","GMRCAFRD",73,0)
 S GMRCTYPE=$P($G(^GMR(123,+GMRCO,0)),"^",17),GMRCTYPE=$S('GMRCTYPE:"GMRCOR CONSULT",1:$P($G(^ORD(101,GMRCTYPE,0)),"^"))
"RTN","GMRCAFRD",74,0)
 Q
"RTN","GMRCAFRD",75,0)
END ;Kill off variables and exit
"RTN","GMRCAFRD",76,0)
 K GETPROV,GMRCDG,GMRCEND,GMRCFF,GMRCOM,GMRCIFN,GMRCO,GMRCORNP,GMRCORTX,GMRCORVP,GMRCPL,GMRCPR,GMRCSEL,GMRCTX,GMRCURG,PKG,ORBADUZ,ORBPMSG,ORCHART,ORIFN,ORPRES,ORPX,Y
"RTN","GMRCAFRD",77,0)
 K DTOUT,DIROUT,DUOUT
"RTN","GMRCAFRD",78,0)
 K GMRC(123),XQORM
"RTN","GMRCAFRD",79,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCAFRD",80,0)
 Q
"RTN","GMRCALOR")
0^14^B3286280
"RTN","GMRCALOR",1,0)
GMRCALOR ;SLC/DCM - Process a consult from an alert notification ;5/20/98  14:20
"RTN","GMRCALOR",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCALOR",3,0)
EN(XQDFN,XQCON) ;process alert from notification screen - entry point to main routine
"RTN","GMRCALOR",4,0)
 ;XQDFN=XQAID       XQCON=XQADATA from CPRS alerts
"RTN","GMRCALOR",5,0)
 I +$G(XQCON)<1 S GMRCQIT=1 Q
"RTN","GMRCALOR",6,0)
 K XQAKILL,^TMP("GMRCR",$J,"CS"),^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCALOR",7,0)
 S DFN=$P(XQDFN,",",2)
"RTN","GMRCALOR",8,0)
 S (GMRCO,GMRCDA)=$S(XQCON=+XQCON:XQCON,$P(XQCON,";",3)?.N1",GMRC".E:+$P(XQCON,";",3),XQCON?1N.N1",GMRC".E:+XQCON,$P(XQCON,"|",2)]"":+$P(XQCON,"|",2),1:$P($P(XQCON,";",3),",",1))
"RTN","GMRCALOR",9,0)
 S GMRCSS=$S($P(^GMR(123,GMRCDA,0),"^",5)]"":$P(^(0),"^",5),1:"")
"RTN","GMRCALOR",10,0)
 I $L(GMRCSS) S ^TMP("GMRCS",$J,GMRCSS)=$S(+GMRCSS:$P(^GMR(123.5,GMRCSS,0),"^",1),1:$O(^GMR(123.5,"B",GMRCSS,0)))
"RTN","GMRCALOR",11,0)
 I $S('$L(GMRCSS):1,^TMP("GMRCS",$J,GMRCSS)="":1,1:0) S ^TMP("GMRCS",$J,1)="Unknown"
"RTN","GMRCALOR",12,0)
 S TAB="",$P(TAB," ",30)="",BLK=0,LNCT=1,GMRCD=0,GMRCDT1="ALL",GMRCDT2=DT S:'$D(GMRCOER) GMRCOER=0
"RTN","GMRCALOR",13,0)
 K ^TMP("GMRCR",$J,"CS")
"RTN","GMRCALOR",14,0)
 D SET^GMRCSLM1,END^GMRCSLM1
"RTN","GMRCALOR",15,0)
 K GMRCWARD,GMRCAD,GMRCSSNM
"RTN","GMRCALOR",16,0)
 Q
"RTN","GMRCALOR",17,0)
 ;
"RTN","GMRCALOR",18,0)
GUI(XQDFN,XQCON) ;entry point for getting consult info for GUI interface
"RTN","GMRCALOR",19,0)
 K ^TMP("GMRCR",$J,"CS")
"RTN","GMRCALOR",20,0)
 S DFN=$P(XQDFN,",",2),GMRCDA=$P($P(XQCON,";",2),",")
"RTN","GMRCALOR",21,0)
 S TAB="",$P(TAB," ",30)="",BLK=0,LNCT=1,GMRCD=0,GMRCDT1="ALL",GMRCDT2=0,GMRCOER=1
"RTN","GMRCALOR",22,0)
 D SET^GMRCSLM1,END^GMRCSLM1
"RTN","GMRCALOR",23,0)
 Q
"RTN","GMRCALRT")
0^15^B6655026
"RTN","GMRCALRT",1,0)
GMRCALRT ;SLC/DCM - LIST MANAGER ALERT ACTION INTERFACE ;5/20/98  14:20
"RTN","GMRCALRT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCALRT",3,0)
EN(GMRCDAT,GMRCDTA) ; -- main entry point for GMRC ALLERT ACTION
"RTN","GMRCALRT",4,0)
 ;Process an alert for a new consult through List Manager
"RTN","GMRCALRT",5,0)
 ;GMRCDTA=XQAID from CPRS interface
"RTN","GMRCALRT",6,0)
 ;GMRCDAT=XQADATA from CPRS interface = IFN of consult from file 123
"RTN","GMRCALRT",7,0)
 K GMRCQIT,GMRCOER
"RTN","GMRCALRT",8,0)
 S GMRCALFL=$S($D(XQAID)&($D(XQADATA)):1,1:0)
"RTN","GMRCALRT",9,0)
 D EN^GMRCALOR(GMRCDTA,GMRCDAT)
"RTN","GMRCALRT",10,0)
 I $D(GMRCQIT) S XQAKILL=$$XQAKILL^ORB3F1 D DEL^ORB3FUP1(.ORY,XQAID),EXIT Q
"RTN","GMRCALRT",11,0)
 D INIT,HDR
"RTN","GMRCALRT",12,0)
 N GMRCACTM
"RTN","GMRCALRT",13,0)
 I '+GMRCO S GMRCACTM=$O(^ORD(101,"B","GMRCACTM ALERT BASIC ACTIONS",0))_";ORD(101,"
"RTN","GMRCALRT",14,0)
 E  N ORFLG D
"RTN","GMRCALRT",15,0)
 . D CPRS^GMRCACTM(+GMRCO) ;Get users update status for the Consult entry
"RTN","GMRCALRT",16,0)
 . S GMRCACTM=$S(ORFLG(+GMRCO)=2:$O(^ORD(101,"B","GMRCACTM ALERT SERVICE ACTIONS",0))_";ORD(101,",1:$O(^ORD(101,"B","GMRCACTM ALERT BASIC ACTIONS",0))_";ORD(101,")
"RTN","GMRCALRT",17,0)
 I '+GMRCACTM K ^TMP("GMRC",$J,"CURRENT","MENU")
"RTN","GMRCALRT",18,0)
 E  S ^TMP("GMRC",$J,"CURRENT","MENU")=GMRCACTM,XQORM("HIJACK")=^("MENU")
"RTN","GMRCALRT",19,0)
 S GMRCOER=0
"RTN","GMRCALRT",20,0)
 D EN^VALM("GMRC ALLERT ACTION")
"RTN","GMRCALRT",21,0)
 S XQAKILL=$$XQAKILL^ORB3F1 D DEL^ORB3FUP1(.ORY,XQAID)
"RTN","GMRCALRT",22,0)
 D EXIT
"RTN","GMRCALRT",23,0)
 Q
"RTN","GMRCALRT",24,0)
 ;
"RTN","GMRCALRT",25,0)
HDR ; -- header code
"RTN","GMRCALRT",26,0)
 S GMRCPTN=$P(^DPT(DFN,0),"^",1)
"RTN","GMRCALRT",27,0)
 D EN4^GMRVUTL S GMRCWT=$S(X]"":X,1:"")
"RTN","GMRCALRT",28,0)
 D DEM^GMRCU S:'$D(GMRCWRD) GMRCWRD=GMRCWARD
"RTN","GMRCALRT",29,0)
 S VALMHDR(1)=GMRCPTN_$E(TAB,1,25-$L(GMRCPTN))_GMRCSSN_$E(TAB,1,3)_GMRCWRD_$E(TAB,1,8-$L(GMRCWRD))_GMRCDOB_$E(TAB,1,10-$L(GMRCDOB))_" ("_GMRCAGE_")"_$E(TAB,1,4)_"Wt (lb): "_GMRCWT
"RTN","GMRCALRT",30,0)
 Q
"RTN","GMRCALRT",31,0)
 ;
"RTN","GMRCALRT",32,0)
INIT ; -- init variables and list array
"RTN","GMRCALRT",33,0)
 K ^TMP("GMRCR",$J,"LIST")
"RTN","GMRCALRT",34,0)
 S DSPLINE=0,VALMAR="^TMP(""GMRCR"",$J,""LIST"")"
"RTN","GMRCALRT",35,0)
 S GMRCSN=$P(^DPT(DFN,0),"^",9),GMRCSSN=$E(GMRCSN,1,3)_"-"_$E(GMRCSN,4,5)_"-"_$E(GMRCSN,6,9)
"RTN","GMRCALRT",36,0)
 F LINE=1:1:LNCT S DSPLINE=$O(^TMP("GMRCR",$J,"CS",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCALRT",37,0)
 S VALMCNT=LNCT
"RTN","GMRCALRT",38,0)
 K DSPLINE,DATA,LINE
"RTN","GMRCALRT",39,0)
 Q
"RTN","GMRCALRT",40,0)
 ;
"RTN","GMRCALRT",41,0)
HELP ; -- help code
"RTN","GMRCALRT",42,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCALRT",43,0)
 Q
"RTN","GMRCALRT",44,0)
 ;
"RTN","GMRCALRT",45,0)
EXIT ; -- exit code
"RTN","GMRCALRT",46,0)
 K ^TMP("GMRCR",$J),^TMP("GMRCS",$J)
"RTN","GMRCALRT",47,0)
 K GMRCALFL,GMRCAID,GMRCQIT,VA,XQAKILL
"RTN","GMRCALRT",48,0)
 D ^GMRCREXT
"RTN","GMRCALRT",49,0)
 Q
"RTN","GMRCALRT",50,0)
 ;
"RTN","GMRCALRT",51,0)
EXPND ; -- expand code
"RTN","GMRCALRT",52,0)
 Q
"RTN","GMRCALRT",53,0)
 ;
"RTN","GMRCAR")
0^16^B25724595
"RTN","GMRCAR",1,0)
GMRCAR ;SLC/DLT - Associate Results (AR) Action taken from Review Screen ;5/20/98  14:20
"RTN","GMRCAR",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCAR",3,0)
AR ;Associate results with request
"RTN","GMRCAR",4,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCAR",5,0)
 I '$D(GMRCSEL) D SEL^GMRCA2 I $D(DTOUT)!$D(DIROUT) S GMRCQIT="" Q
"RTN","GMRCAR",6,0)
 I 'GMRCSEL G END
"RTN","GMRCAR",7,0)
 S GMRCO=$O(^TMP("GMRCR",$J,"CS","AD",GMRCSEL,GMRCSEL,0)),GMRC(0)=^GMR(123,GMRCO,0)
"RTN","GMRCAR",8,0)
 I $P(GMRC(0),"^",12)=1 W !!,"THIS ORDER HAS BEEN DISCONTINUED, PLEASE SELECT OR ADD ANOTHER ORDER!",!! G END
"RTN","GMRCAR",9,0)
 S GMRCQIT="" Q
"RTN","GMRCAR",10,0)
ARMED ;Entry to associate results with a consult/request
"RTN","GMRCAR",11,0)
 I '$D(^DD(690,0,"VR")) S GMRCMSG="Medicine Package Not Installed. Can't Associate Results." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q
"RTN","GMRCAR",12,0)
 I ^DD(690,0,"VR")'>2.0 S GMRCMSG="**Version 2.2 of Medicine required to associate results with Consults**" D EXAC^GMRCADC(GMRCMSG) K GMRCMSG S GMRCQUT=1 Q
"RTN","GMRCAR",13,0)
 I $D(XQY0),$E(XQY0,1,2)="MC" G AR
"RTN","GMRCAR",14,0)
 D SEL^GMRCA2 I 'GMRCSEL G END
"RTN","GMRCAR",15,0)
 I $D(IOTM),$D(IOBM) D FULL^VALM1
"RTN","GMRCAR",16,0)
 S GMRCO=$O(^TMP("GMRCR",$J,"CS","AD",GMRCSEL,GMRCSEL,0)),GMRC(0)=^GMR(123,GMRCO,0)
"RTN","GMRCAR",17,0)
 S GMRCPROC=$P(GMRC(0),"^",8) I GMRCPROC]"" S GMRCPROC=$G(^ORD(101,+GMRCPROC,.1)) I GMRCPROC]"" S GMRCPROC=$O(^MCAR(697.2,"B",GMRCPROC,0)) I GMRCPROC]"" S GMRCPROC=$P(^MCAR(697.2,GMRCPROC,0),"^",8),GMRCPRNM=GMRCPROC
"RTN","GMRCAR",18,0)
 I GMRCPROC="" S GMRCMSG="No Procedure Was Ordered With This Consult - Cannot Associate Results." D EXAC^GMRCADC(GMRCMSG) S GMRCQIT=1 G END
"RTN","GMRCAR",19,0)
 S GMRCSR=$P(GMRC(0),"^",15) I $E($P(GMRCSR,";",2),1,2)="MC" S MCFILE=$P(GMRCSR,";",2),MCFILE=$P(MCFILE,","),MCPROC=$O(^MCAR(697.2,"C",MCFILE,"")) I GMRCPROC]"" S GMRCPRNM=$P(^MCAR(697.2,MCPROC,0),"^",8)
"RTN","GMRCAR",20,0)
 I $P(GMRC(0),"^",12)=1 S GMRCMSG="THIS ORDER HAS BEEN DISCONTINUED, PLEASE SELECT OR ADD ANOTHER ORDER!" D EXAC^GMRCADC(GMRCMSG) S GMRCQUT=1 G END
"RTN","GMRCAR",21,0)
 S GMRCGL=$O(^MCAR(697.2,"BA",GMRCPRNM,"")) I 'GMRCGL S GMRCMSG="PROBLEM FINDING THE MEDICINE PROCEDURE GIVEN "_GMRCPRNM D EXAC^GMRCADC(GMRCMSG) G END
"RTN","GMRCAR",22,0)
 S GMRCGL=$P(^MCAR(697.2,GMRCGL,0),"^",2)
"RTN","GMRCAR",23,0)
 I '$L(GMRCGL) S GMRCMSG="A PROBLEM HAS BEEN FOUND IN FILE 697.2 DEFINING THE LOCATION OF THE RESULTS!!" D EXAC^GMRCADC(GMRCMSG) S GMRCQUT=1 G END
"RTN","GMRCAR",24,0)
 I +$P(GMRC(0),"^",15) D  G ORSTS
"RTN","GMRCAR",25,0)
 .S GMRCSR=$P(GMRC(0),"^",15),DIC="^"_$P(GMRCSR,";",2)_$P(GMRCSR,";")_",0)"
"RTN","GMRCAR",26,0)
 .I '$D(@DIC) S GMRCMSG="This request is currently associated with results no longer available" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAR",27,0)
 .S X=$P(@DIC,"^",1) D REGDTM^GMRCU S X1=X
"RTN","GMRCAR",28,0)
 .S X=$P(^GMR(123,GMRCO,0),"^",7) D REGDTM^GMRCU
"RTN","GMRCAR",29,0)
 .S GMRCMSG="The "_GMRCPRNM_" results entered on "_X1_" are associated "
"RTN","GMRCAR",30,0)
 .S GMRCMSG(1)="  with this request ordered on "_X
"RTN","GMRCAR",31,0)
 .D EXAC^GMRCADC(.GMRCMSG) K GMRCMSG
"RTN","GMRCAR",32,0)
LKUP ;look up on procedure file using "C" cross-reference
"RTN","GMRCAR",33,0)
 S GMRCDIC="^"_GMRCGL_",""C"","_DFN_")" I '$D(@GMRCDIC) S GMRCMSG="No "_GMRCPRNM_" results available for "_$P(^DPT(DFN,0),"^") D EXAC^GMRCADC(GMRCMSG) G END
"RTN","GMRCAR",34,0)
 S DIC="^"_GMRCGL_",",DIC(0)="XEZ",D="C",X=$P(^DPT(DFN,0),"^"),DIC("S")="I $P(^(0),U,2)=DFN" W !,"Results for "_$P(^DPT(DFN,0),"^")
"RTN","GMRCAR",35,0)
 D MIX^DIC1 G:+Y<0 END
"RTN","GMRCAR",36,0)
 S GMRCSR=+Y_";"_GMRCGL_",",GMRCSRDT=Y(0,0)
"RTN","GMRCAR",37,0)
 N GMRCEND S GMRCEND=0 W ! S DIR(0)="Y",DIR("A")="Do you want to review these results first",DIR("B")="Y" D ^DIR K DIR I Y D  G:GMRCEND END
"RTN","GMRCAR",38,0)
 .W @IOF S GMRCSRS=GMRCSR D AREN^GMRCSLM3(GMRCO,GMRCSR),EN^GMRCMER S GMRCSR=GMRCSRS
"RTN","GMRCAR",39,0)
 .I GMRCCT=1 S GMRCEND=1 Q
"RTN","GMRCAR",40,0)
 .W !! S DIR(0)="Y",DIR("A")="Are these the right results to be associated with the selected request",DIR("B")="N" D ^DIR K DIR S:$D(DIROUT)!$D(DTOUT)!(X="^") GMRCEND=1
"RTN","GMRCAR",41,0)
 .I Y=0 K GMRCSR S GMRCEND=1
"RTN","GMRCAR",42,0)
 I GMRCEND K GMRCEND G END
"RTN","GMRCAR",43,0)
 I '$D(GMRCSR) K GMRCEND W ! G LKUP
"RTN","GMRCAR",44,0)
 I '+GMRCSR G END
"RTN","GMRCAR",45,0)
ORSTS ;Check if status needs update to complete
"RTN","GMRCAR",46,0)
 I $P(GMRC(0),"^",12)=2 W !,"This request is already completed, no updating performed for this request",!,"Press the <ENTER> key to EXIT " R X:DTIME G END
"RTN","GMRCAR",47,0)
 W ! S DIR(0)="Y",DIR("A")="Shall I update the order status to complete",DIR("B")="N",DIR("?")="Type 'Y' for 'YES' or 'N' for 'NO' and press <ENTER> key." D ^DIR K DIR I $D(DTOUT)!$D(DIROUT)!$D(DUOUT) G END
"RTN","GMRCAR",48,0)
 S ORSTS=$S(Y:2,1:9)
"RTN","GMRCAR",49,0)
 I $P(^GMR(123,GMRCO,0),"^",12)=ORSTS&(+$P(^GMR(123,GMRCO,0),"^",15)) G END
"RTN","GMRCAR",50,0)
 S GETPROV="Clinician responsible for results" D GETPROV^GMRCAU I '$D(GMRCORNP) S GMRCQIT="" G END
"RTN","GMRCAR",51,0)
 S GMRCSVSS=GMRCSVCN D RESULT^GMRCR S GMRCSS=GMRCSVSS K GMRCSVSS,ORIFN
"RTN","GMRCAR",52,0)
 S GMRCVP=$O(^ORD(101,"B","GMRCR "_GMRCPROC,0)) I GMRCVP]"" S GMRCVP=GMRCVP_";ORD(101," D AD^GMRCSLM1,INIT^GMRCSLM
"RTN","GMRCAR",53,0)
END ;
"RTN","GMRCAR",54,0)
 K ORIFN,GMRCO,GMRCEND,GMRCGL,GMRCDIC,GMRCMSG,GMRCVP,DIC,D,GMRCSR,GMRCSRDT,GMRCSRS,GMRCTM,GMRCBM,X,X1
"RTN","GMRCAR",55,0)
 K GMRCO,GMRC(0),GMRCSR,MCFILE,MCPROC,GMRCPROC,GMRCPRNM
"RTN","GMRCAR",56,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCAR",57,0)
 Q
"RTN","GMRCASV")
0^18^B41871581
"RTN","GMRCASV",1,0)
GMRCASV ;SLC/KCM,DLT - Build ^TMP("GMRCS" of Svc(s)/Specialties ;5/20/98  14:20
"RTN","GMRCASV",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCASV",3,0)
ASRV ;Ask for service/specialty group {output} GMRCDG,GMRCBUF,GMRCACT,^TMP("GMRCS",$J,^TMP("GMRCSLIST",$J
"RTN","GMRCASV",4,0)
 K GMRCQUT
"RTN","GMRCASV",5,0)
 N GMRCSEL
"RTN","GMRCASV",6,0)
 D SERV0 D:GMRCDG SERV1
"RTN","GMRCASV",7,0)
 K W,X,Y Q
"RTN","GMRCASV",8,0)
SERV0 ;Assume that the lookup must begin with ALL SERVICES, or value of GMRCSVNM
"RTN","GMRCASV",9,0)
 ;GMRCASV=the ask prompt text
"RTN","GMRCASV",10,0)
 ;GMRCSVNM=text to use for default name
"RTN","GMRCASV",11,0)
 S GMRCDG=0
"RTN","GMRCASV",12,0)
 S:$G(GMRCASV)["Forward" GMRCTO=1
"RTN","GMRCASV",13,0)
 F  D ASKPRMPT S:X["^^" DIROUT=1 S:X["^" GMRCQUT=1 Q:X["^"  D @$S(X["?":"LISTALL",1:"LKUP") D:($L($G(GMRCSVNM))&GMRCDG) LISTSRV Q:GMRCDG
"RTN","GMRCASV",14,0)
 Q
"RTN","GMRCASV",15,0)
ASKPRMPT ;Write the prompt and do the Read to get the user text entered in X
"RTN","GMRCASV",16,0)
 W !!,$S($D(GMRCASV):GMRCASV,1:"Select Service/Specialty: ")_$S($L($G(GMRCSVNM)):GMRCSVNM,1:"ALL SERVICES")_"// "
"RTN","GMRCASV",17,0)
 R X:DTIME
"RTN","GMRCASV",18,0)
 I '$T S X="^"
"RTN","GMRCASV",19,0)
 I X'["^" S X=$S($G(GMRCASV)["Forward"&('$L(X)):"^",'$L(X):"ALL SERVICES",1:X) Q
"RTN","GMRCASV",20,0)
 Q
"RTN","GMRCASV",21,0)
SERV1 ;Create selected SERVICE ^TMP array of service information
"RTN","GMRCASV",22,0)
 ;If GMRCTO=1 then the BILD section will not include disabled or tracking services which the user cannot send to.
"RTN","GMRCASV",23,0)
 N GMRCDGT
"RTN","GMRCASV",24,0)
 S GMRCBUF=GMRCDG
"RTN","GMRCASV",25,0)
 I GMRCBUF>0 D
"RTN","GMRCASV",26,0)
 . K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCASV",27,0)
 . S GMRCDGT=0,GMRCSEL="BILD" D EN
"RTN","GMRCASV",28,0)
 . S GMRCGRP("NAM")=^GMR(123.5,GMRCBUF,0)
"RTN","GMRCASV",29,0)
 . S (GMRCDG,GMRCGRP("ROOT"))=GMRCBUF
"RTN","GMRCASV",30,0)
 . S GMRCGRP("NAM")=$S($L($P(GMRCGRP("NAM"),"^",3)):$P(GMRCGRP("NAM"),"^",3),1:$E($P(GMRCGRP("NAM"),"^"),1,5))
"RTN","GMRCASV",31,0)
 K GMRCSEQ,GMRCBUF
"RTN","GMRCASV",32,0)
 Q
"RTN","GMRCASV",33,0)
LKUP ;Ask the user for the service; use the value of x for lookup; branch to list on ??
"RTN","GMRCASV",34,0)
 S DIC="^GMR(123.5,",DIC(0)="MNEQZ",DIC("W")="W ""   "",$P(Y,""^"",2)"
"RTN","GMRCASV",35,0)
 D ^DIC K DIC I '$D(Y(0)) D LISTALL Q
"RTN","GMRCASV",36,0)
 N W,GMRCEXCL I +$G(GMRCTO) D
"RTN","GMRCASV",37,0)
 . S W=Y(0),GMRCDG=+Y
"RTN","GMRCASV",38,0)
 . S GMRCEXCL=0 D EXCLUDE
"RTN","GMRCASV",39,0)
 . I GMRCEXCL=1 S GMRCSVNM=Y(0,0),GMRCEXCL=0 Q
"RTN","GMRCASV",40,0)
 . K GMRCSVNM ;Service selected is not a grouper for lookup
"RTN","GMRCASV",41,0)
 . I GMRCEXCL=9 S GMRCMSG="You have selected a disabled service!" D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",42,0)
 . N GMRCDAD D CHECKDAD
"RTN","GMRCASV",43,0)
 . I GMRCEXCL=90 S GMRCMSG="You have selected a service that is not part of the ALL SERVICES heirarchy!",GMRCMSG(1)="Contact Consult ADPAC" D EXAC^GMRCADC(.GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",44,0)
 . I GMRCEXCL=9 S GMRCMSG="You have selected a service whose parent is disabled!" D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",45,0)
 . I GMRCEXCL=2 S GMRCMSG="You have selected a service whose parent is a tracking service!",GMRCMSG(1)="You do not have authorization to send consults to this service." D EXAC^GMRCADC(.GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",46,0)
 I +$G(GMRCEXCL) S Y=0,GMRCDG=0
"RTN","GMRCASV",47,0)
 S:Y>0 GMRCDG=+Y ;falls to here when service is a grouper or not excluded
"RTN","GMRCASV",48,0)
 Q
"RTN","GMRCASV",49,0)
LISTALL ;display LIST of Services in their heirarchy beginning with ALL SERVICES
"RTN","GMRCASV",50,0)
 S GMRCDG=$O(^GMR(123.5,"B","ALL SERVICES",0)) Q:'GMRCDG
"RTN","GMRCASV",51,0)
 S GMRCSEL="DISP" W @IOF D EN
"RTN","GMRCASV",52,0)
 S GMRCDG=0 W !
"RTN","GMRCASV",53,0)
 Q
"RTN","GMRCASV",54,0)
LISTSRV ;display LIST of sub-services beginning with a selected service
"RTN","GMRCASV",55,0)
 S GMRC1=0,GMRCDG=$O(^GMR(123.5,"B",GMRCSVNM,0)) Q:'GMRCDG
"RTN","GMRCASV",56,0)
 S GMRCSEL="DISP" W @IOF D EN
"RTN","GMRCASV",57,0)
 S GMRCDG=0 W !
"RTN","GMRCASV",58,0)
 Q
"RTN","GMRCASV",59,0)
EN ;Setup Specialty groups   entry: GMRCDG,GMRCSEL   exit: GMRCGRP if GMRCSEL="BILD"
"RTN","GMRCASV",60,0)
 N GMRCSTK,PARENT,GMRCUSG,GMRCEXCL
"RTN","GMRCASV",61,0)
 S GMRCSTK=0,PARENT=0 ;beginning service logic
"RTN","GMRCASV",62,0)
 D @GMRCSEL Q:$D(DUOUT)!$D(DIROUT)
"RTN","GMRCASV",63,0)
EN1 ;GMRCSTK is used to manage the level of stacks under beginning service
"RTN","GMRCASV",64,0)
 S GMRCSTK=1,GMRCSTK(GMRCSTK)=GMRCDG_"^0",GMRCSTK(0)=0,GMRCMEM=0,GMRCNAM=""
"RTN","GMRCASV",65,0)
 F  S GMRCNAM=$O(^GMR(123.5,+GMRCSTK(GMRCSTK),10,"AC",GMRCNAM)) D  D @$S(+GMRCMEM'>0:"POP",1:"PROC") Q:GMRCSTK<1
"RTN","GMRCASV",66,0)
 . I $G(GMRCEXCL) S GMRCMEM=0 Q  ;Exclude children of excluded parent
"RTN","GMRCASV",67,0)
 . I '$L(GMRCNAM) S GMRCMEM=0 ;No more 10th node children
"RTN","GMRCASV",68,0)
 . E  S GMRCMEM=$O(^GMR(123.5,+GMRCSTK(GMRCSTK),10,"AC",GMRCNAM,""))
"RTN","GMRCASV",69,0)
 K DUOUT,GMRCMEM,GMRCNAM,GMRCSTK,GMRCSEL
"RTN","GMRCASV",70,0)
 Q
"RTN","GMRCASV",71,0)
POP ;Go back one level in service stack heirarchy and initialize exclude
"RTN","GMRCASV",72,0)
 S GMRCSTK=GMRCSTK-1,GMRCMEM=$P(GMRCSTK(GMRCSTK),"^",2),GMRCNAM=$P(GMRCSTK(GMRCSTK),"^",3),GMRCEXCL=0
"RTN","GMRCASV",73,0)
 Q
"RTN","GMRCASV",74,0)
PROC ;GMRCMEM is the member ien in the 10th node being processed
"RTN","GMRCASV",75,0)
 ;GMRCDG is the ien of file 123.5 being processed
"RTN","GMRCASV",76,0)
 ;GMRCNAM is the services name
"RTN","GMRCASV",77,0)
 S $P(GMRCSTK(GMRCSTK),"^",2)=GMRCMEM
"RTN","GMRCASV",78,0)
 S $P(GMRCSTK(GMRCSTK),"^",3)=GMRCNAM
"RTN","GMRCASV",79,0)
 S GMRCDG=$P(^GMR(123.5,+GMRCSTK(GMRCSTK),10,GMRCMEM,0),"^",1)
"RTN","GMRCASV",80,0)
 S PARENT=+GMRCSTK(GMRCSTK)
"RTN","GMRCASV",81,0)
 S W=$G(^GMR(123.5,GMRCDG,0))
"RTN","GMRCASV",82,0)
 I $G(GMRCTO)=1 S GMRCEXCL=0 D EXCLUDE S:GMRCEXCL=1 GMRCEXCL=0 ;Includes grouper only
"RTN","GMRCASV",83,0)
 D:'+$G(GMRCEXCL) @GMRCSEL G:($D(DUOUT)!$D(DIROUT)) EXIT
"RTN","GMRCASV",84,0)
 ;Initialize a stack level entry to process children of the multiple
"RTN","GMRCASV",85,0)
 S GMRCSTK=GMRCSTK+1,GMRCSTK(GMRCSTK)=GMRCDG_"^0",GMRCMEM=0,GMRCNAM=""
"RTN","GMRCASV",86,0)
 Q
"RTN","GMRCASV",87,0)
DISP ;Display individual entries alphabetically for each service as processed
"RTN","GMRCASV",88,0)
 I $Y>(IOSL-4) D READ S:$D(DUOUT)!($D(DIROUT)) GMRCSTK=0 G:GMRCSTK=0 EXIT W @IOF
"RTN","GMRCASV",89,0)
 S W=$G(^GMR(123.5,GMRCDG,0))
"RTN","GMRCASV",90,0)
 S GMRCUSG=$P(W,"^",2)
"RTN","GMRCASV",91,0)
 W !,?((GMRCSTK*2)),$S(GMRCUSG=9:"<",1:"")_$P(W,"^")_$S(GMRCUSG=9:">",1:"")_"  "_$S(GMRCUSG=1:"(Grouper Only)",GMRCUSG=2:"(Tracking Only)",GMRCUSG=9:"<Disabled>",1:"")
"RTN","GMRCASV",92,0)
 Q
"RTN","GMRCASV",93,0)
BILD ;The following logic will build an array for review for GUI
"RTN","GMRCASV",94,0)
 ;GMRCDGT=sequential number,GMRCDG=service pointer,
"RTN","GMRCASV",95,0)
 ;W=^GMR(123.5,GMRCDG,0),1st piece is name, 2nd piece usage
"RTN","GMRCASV",96,0)
 ;If GMRCTO=1 then services that only consults can be sent to will be
"RTN","GMRCASV",97,0)
 ;included with the exception of "grouper only" which keeps the
"RTN","GMRCASV",98,0)
 ;heirarchy in order.
"RTN","GMRCASV",99,0)
 N CHILD
"RTN","GMRCASV",100,0)
 S W=$G(^GMR(123.5,GMRCDG,0))
"RTN","GMRCASV",101,0)
 S ^TMP("GMRCS",$J,GMRCDG)=$P(W,"^")
"RTN","GMRCASV",102,0)
 S GMRCDGT=GMRCDGT+1
"RTN","GMRCASV",103,0)
 S CHILD=$O(^GMR(123.5,GMRCDG,10,0)) S CHILD=$S(+CHILD:"+",1:"")
"RTN","GMRCASV",104,0)
 S ^TMP("GMRCSLIST",$J,GMRCDGT)=GMRCDG_U_$P(W,"^")_U_PARENT_U_CHILD_U_$P(W,"^",2)
"RTN","GMRCASV",105,0)
 Q
"RTN","GMRCASV",106,0)
EXCLUDE ;This logic excludes services the user cannot send a consult to.
"RTN","GMRCASV",107,0)
 ;If GMRCTO=1 the user is forwarding or sending a consult
"RTN","GMRCASV",108,0)
 ;W=zeroth node of service,GMRCDG=ien of service,GMRCO=ien of consult (optional)
"RTN","GMRCASV",109,0)
 Q:'$L($G(W))
"RTN","GMRCASV",110,0)
 S GMRCEXCL=+$P(W,"^",2) ;Include grouper for heirarchy building only
"RTN","GMRCASV",111,0)
 I GMRCEXCL=2 D  ;tracking service exclusion check
"RTN","GMRCASV",112,0)
 . N GMRCSRV I +$G(GMRCO) S GMRCSRV=$P($G(^GMR(123,+GMRCO,0)),"^",5) I $D(^GMR(123.5,"APC",+GMRCDG,+GMRCSRV)) S GMRCEXCL=0 Q  ;Checks if parent is the consults current service
"RTN","GMRCASV",113,0)
 . I $D(^GMR(123.5,+GMRCDG,123.3,"B",DUZ)) S GMRCEXCL=0  ;Assumes user updates selected service
"RTN","GMRCASV",114,0)
 . Q
"RTN","GMRCASV",115,0)
 Q
"RTN","GMRCASV",116,0)
CHECKDAD ;Check the service usage statuses for a selected services parents
"RTN","GMRCASV",117,0)
 ;There are two passes, one to get any user accessable parent
"RTN","GMRCASV",118,0)
 ;and the second pass is through the GMRCDAD array to check the parents usage
"RTN","GMRCASV",119,0)
 ;The GMRCEXCL value is returned for exclusion due to parent
"RTN","GMRCASV",120,0)
 S GMRCDAD=""
"RTN","GMRCASV",121,0)
 ;FIRST PASS
"RTN","GMRCASV",122,0)
 F  S GMRCDAD=$O(^GMR(123.5,"APC",+GMRCDG,GMRCDAD)) Q:GMRCDAD=""  D  I $P($G(GMRCDAD(+GMRCDAD)),U,2)="OK" S GMRCEXCL="OK"
"RTN","GMRCASV",123,0)
 . S GMRCDAD(+GMRCDAD)=$P(^GMR(123.5,+GMRCDAD,0),U,2) ;dads service usage
"RTN","GMRCASV",124,0)
 . I $P($G(^GMR(123.5,+GMRCDAD,0)),U,1)="ALL SERVICES" S $P(GMRCDAD(GMRCDAD),U,2,3)="OK^ALL" Q  ;If one of the dad's is all services, than OK to send to if not previously excluded.
"RTN","GMRCASV",125,0)
 . I GMRCDAD(+GMRCDAD)=1 S $P(GMRCDAD(+GMRCDAD),"^",2)="OK" Q  ;Groupers Only are OK!
"RTN","GMRCASV",126,0)
 . I $D(^GMR(123.5,+GMRCDAD,123.3,"B",DUZ)) S $P(GMRCDAD(GMRCDAD),U,2,3)="OK^Update access" Q
"RTN","GMRCASV",127,0)
 . Q
"RTN","GMRCASV",128,0)
 I GMRCEXCL="OK" S GMRCEXCL=0 Q  ;There is a parent which user has access to.
"RTN","GMRCASV",129,0)
 ;Second Pass of the GMRCDAD array (multiple parents)
"RTN","GMRCASV",130,0)
 S GMRCDAD=$O(GMRCDAD("")) I 'GMRCDAD S GMRCEXCL=90 Q  ;Not part of heirarchy; missing dad
"RTN","GMRCASV",131,0)
 ;Use first parent found in heirarchy.
"RTN","GMRCASV",132,0)
 S GMRCEXCL=+GMRCDAD(GMRCDAD)
"RTN","GMRCASV",133,0)
 Q
"RTN","GMRCASV",134,0)
READ ;;Hold screen
"RTN","GMRCASV",135,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","GMRCASV",136,0)
 W ! I $D(IOSL),$Y<(IOSL-4) G READ
"RTN","GMRCASV",137,0)
 N X W !?5,"Press RETURN to continue, ^ to exit: " R X:DTIME S:X="^" DUOUT=1 S:'$T!(X="^^") DIROUT=1
"RTN","GMRCASV",138,0)
 K X Q
"RTN","GMRCASV",139,0)
EXIT ;Kill off variables and quit
"RTN","GMRCASV",140,0)
 K DIROUT,DUOUT,DTOUT,DIRUT
"RTN","GMRCASV",141,0)
 Q
"RTN","GMRCAU")
0^19^B1824313
"RTN","GMRCAU",1,0)
GMRCAU ;SLC/DLT - Action Utilities ;5/20/98  14:20
"RTN","GMRCAU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCAU",3,0)
GETPROV K GMRCORNP S DIR(0)="123.02,3",DIR("A")=$S($D(GETPROV):GETPROV,1:"Responsible Clinician") D ^DIR K DIR I $D(DTOUT)!$D(DIROUT)!(X="^") S GMRCQIT="Q" Q
"RTN","GMRCAU",4,0)
 G:Y<1 GETPROV S GMRCORNP=+Y
"RTN","GMRCAU",5,0)
 Q
"RTN","GMRCAU",6,0)
GETDT ;Get actual activity date
"RTN","GMRCAU",7,0)
 K GMRCQIT
"RTN","GMRCAU",8,0)
 D NOW^%DTC S (X,GMRCDT)=% D REGDTM^GMRCU S GMRCAD=X
"RTN","GMRCAU",9,0)
 S DIR(0)="123.02,2",DIR("A")=$S($D(GETDT):GETDT,1:"Date/Time of Actual Activity"),DIR("B")="NOW" D ^DIR K DIR I $D(DIRUT) S GMRCQIT="Q" Q
"RTN","GMRCAU",10,0)
 I X="NOW" K GMRCAD,Y Q
"RTN","GMRCAU",11,0)
 S GMRCAD=Y K X,Y,DIRUT,DUOUT
"RTN","GMRCAU",12,0)
 Q
"RTN","GMRCCLR")
0^20^B4154103
"RTN","GMRCCLR",1,0)
GMRCCLR ;SLC/DLT - Kill-off all variables used for consults tracking. ;5/20/98  14:20
"RTN","GMRCCLR",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCCLR",3,0)
CLRTRK ;SLC-IRMFO/DCM; Kill-off all variables used to display consults
"RTN","GMRCCLR",4,0)
 K ^TMP("GMRCR",$J),^TMP("GMRCS",$J)
"RTN","GMRCCLR",5,0)
 K ^TMP("GMRC",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCCLR",6,0)
 K X,BLK,CDT,CNT,DA,DFN,D0,J1,NO,PL,TO,WP,FLG,LIN,POP,SEX,STS,TAB,BKLN,DATA,PROC,URG,WRD,LINE,LNCT,GMRC(0),GMRC(40),GMRCD,GMRCCT,GMRCD1,GMRCO,GMRCRB,GMRCSEX,GMRCDT,LASTA,LINE,ORIFN,GMRCDA,GMRCDG,GMRCDOB,GMRCLA,GMRCND,GMRCNO,GMRCSN
"RTN","GMRCCLR",7,0)
 K DSPLINE,CTRLCOL,GMRCDGT,GMRCDT1,GMRCDT2,GMRCGRP,GMRCIFN,GMRCLA1,GMRCAGE,GMRCDGT,GMRCHDR,GMRCPNM,GMRCPRT,GMRCQUT,GMRCSSN,GMRCPTN,GMRCSVC,GMRCPRNM,GMRCPROC,GMRCSSNM,GMRCWARD,ORACTION
"RTN","GMRCCLR",8,0)
 K GMRCA,GMRCFMDT,GMRCOR,GMRCWT,GMRCOPT,GMRCSS,GMRCACTM,GMRCWRD,GMRCNUL,GMRCVP,GMRCQIT,GMRCORNP,GMRCUSER,GMRCORVP,GMRCOER,GMRCXMF,GMRCSEL,GMRC
"RTN","GMRCCLR",9,0)
 Q
"RTN","GMRCCPRS")
0^21^B1748171
"RTN","GMRCCPRS",1,0)
GMRCCPRS ;SLC/DCM - Routine To Give Actions For Consults From The OE/RR Menu's ;9/14/98  13:39
"RTN","GMRCCPRS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCCPRS",3,0)
EN(GMRCDA) ;Entry point into routine. GMRCDA= File 123 IEN of consult to display.
"RTN","GMRCCPRS",4,0)
 ;GMRCDA=IEN of consult from file 123
"RTN","GMRCCPRS",5,0)
 N DFN
"RTN","GMRCCPRS",6,0)
 S DFN=$P(^GMR(123,GMRCDA,0),"^",2),GMRCSS=$S($P(^GMR(123,GMRCDA,0),"^",5)]"":$P(^(0),"^",5),1:"Unknown"),^TMP("GMRCS",$J,GMRCDA)=$S(+GMRCSS:$P(^GMR(123.5,GMRCSS,0),"^",1),1:GMRCSS)
"RTN","GMRCCPRS",7,0)
 S TAB="",$P(TAB," ",30)="",BLK=0,LNCT=1,GMRCD=0,GMRCDT1="ALL",GMRCDT2=DT S:'$D(GMRCOER) GMRCOER=0
"RTN","GMRCCPRS",8,0)
 K ^TMP("GMRCR",$J,"CS")
"RTN","GMRCCPRS",9,0)
 D EN^GMRCMENU
"RTN","GMRCCPRS",10,0)
 D SET^GMRCSLM1,INIT^GMRCALRT,HDR^GMRCALRT,END^GMRCSLM1
"RTN","GMRCCPRS",11,0)
 D EN^VALM("GMRC ALLERT ACTION")
"RTN","GMRCCPRS",12,0)
 K GMRCELIG,GMRCFSS,GMRCSS
"RTN","GMRCCPRS",13,0)
 Q
"RTN","GMRCDDX")
0^22^B924910
"RTN","GMRCDDX",1,0)
GMRCDDX ;SLC/DLT - AC cross-referenc logic for 123.5, field .01 ;6/01/98  13:25
"RTN","GMRCDDX",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCDDX",3,0)
SETAC ;Logic to set the heirarchy alphabetic cross reference on the menu item
"RTN","GMRCDDX",4,0)
 ;multiple based on the child-parent relationships in file 123.5
"RTN","GMRCDDX",5,0)
 ;The ACP cross-reference is used to find cross-reference entries that
"RTN","GMRCDDX",6,0)
 ;need to have the AC alphabetic cross-reference updated.
"RTN","GMRCDDX",7,0)
 ;The value in X will be used to create a new AC cross-reference.
"RTN","GMRCDDX",8,0)
 N GMRCC S GMRCC=DA,GMRCP=""
"RTN","GMRCDDX",9,0)
 N DA
"RTN","GMRCDDX",10,0)
 F  S GMRCP=$O(^GMR(123.5,"ACP",GMRCC,GMRCP)) Q:'GMRCP  S DA(1)=$O(^(GMRCP),"") Q:'DA(1)  D
"RTN","GMRCDDX",11,0)
 . S ^GMR(123.5,DA(1),10,"AC",$E(X,1,63),DA)=""
"RTN","GMRCDDX",12,0)
 . Q
"RTN","GMRCDDX",13,0)
 Q
"RTN","GMRCDDX",14,0)
KILLAC ;Logic to kill the AC cross-reference entry with the name defined in
"RTN","GMRCDDX",15,0)
 ;the value of x.
"RTN","GMRCDDX",16,0)
 N GMRCC S GMRCC=DA,GMRCP=""
"RTN","GMRCDDX",17,0)
 N DA
"RTN","GMRCDDX",18,0)
 F  S GMRCP=$O(^GMR(123.5,"ACP",GMRCC,GMRCP)) Q:'GMRCP  S DA(1)=$O(^(GMRCP),"") Q:'DA(1)  D
"RTN","GMRCDDX",19,0)
 . K ^GMR(123.5,DA(1),10,"AC",$E(X,1,63),DA)
"RTN","GMRCDDX",20,0)
 . Q
"RTN","GMRCDDX",21,0)
 Q
"RTN","GMRCDPCK")
0^23^B6518193
"RTN","GMRCDPCK",1,0)
GMRCDPCK ;SLC/DCM - Check for a duplicate Consult/Request that has a status of active, pending or scheduled ;5/20/98  14:20
"RTN","GMRCDPCK",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCDPCK",3,0)
EN(PTN,GMRCPRC,GMRCSVC) ;Main entry point
"RTN","GMRCDPCK",4,0)
 ;PTN=DFN, Patient IEN from ^DPT(
"RTN","GMRCDPCK",5,0)
 ;GMRCPRC=PROCEDURE, FROM PROTOCOL FILE - ^ORD(101,GMRCPRC
"RTN","GMRCDPCK",6,0)
 ;GMRCSVC=Service Name - i.e., 'MEDICINE' (this is not the IEN from file 123.5.
"RTN","GMRCDPCK",7,0)
 Q:GMRCSVC=""
"RTN","GMRCDPCK",8,0)
 K GMRCQUT N STS
"RTN","GMRCDPCK",9,0)
 S GMRCTO=$O(^GMR(123.5,"B",GMRCSVC,0)),GMRCDUP=0
"RTN","GMRCDPCK",10,0)
 S X1=DT,X2=-365 D C^%DTC S GMRCMDT=9999999-X ;Only look back 12 months for duplicates
"RTN","GMRCDPCK",11,0)
 F STS=5,6,8 S GMRCDATE=0 D
"RTN","GMRCDPCK",12,0)
 .F  S GMRCDATE=$O(^GMR(123,"AE",GMRCTO,STS,GMRCDATE)) Q:GMRCDATE>GMRCMDT!(GMRCDATE="")  S GMRCIEN=$O(^GMR(123,"AE",GMRCTO,STS,GMRCDATE,0)),GMRC(0)=^GMR(123,GMRCIEN,0) D
"RTN","GMRCDPCK",13,0)
 ..I $P(GMRC(0),"^",2)=PTN,$P(GMRC(0),"^",8)=GMRCPRC S Y=9999999-GMRCDATE X ^DD("DD") S GMRCDUP=GMRCDUP+1 D
"RTN","GMRCDPCK",14,0)
 ...W $C(7),!!,"A"_$S(GMRCDUP>1:"n Other",1:"")_" Consult/Request Order For an ",$S($D(^ORD(101,+GMRCPRI,.1)):^(.1),GMRCPR]"":GMRCPR,1:"")," Exists.",!!?10,"Date Ordered: ",$P(Y,"@",1),$S($P(Y,"@",2):" At "_$P(Y,"@",2),1:"")
"RTN","GMRCDPCK",15,0)
 ...W !?10,"Current Status: ",$S(STS=5:"Pending",STS=6:"Active",STS=8:"Scheduled: ",1:"No Status")
"RTN","GMRCDPCK",16,0)
 ...W !?10,"Ordering Provider: ",$S($P(GMRC(0),"^",14)]"":$P(^VA(200,$P(GMRC(0),"^",14),0),"^",1),1:"Unknown")
"RTN","GMRCDPCK",17,0)
 ...S GMRC(0)=""
"RTN","GMRCDPCK",18,0)
 ...Q
"RTN","GMRCDPCK",19,0)
 ..Q
"RTN","GMRCDPCK",20,0)
 .Q
"RTN","GMRCDPCK",21,0)
 I GMRCDUP>1 W !!,"Multiple Orders ("_GMRCDUP_") For a/an "_$S($D(^ORD(101,+GMRCPRI,.1)):^(.1),GMRCPR]"":GMRCPR,1:"")_" Exist."
"RTN","GMRCDPCK",22,0)
 I GMRCDUP W !!,"Do You Want To Continue - And Complete - This Order Anyway? N// " R Y:DTIME I $S(Y="":1,Y["N":1,Y["n":1,1:0) S GMRCQUT=1
"RTN","GMRCDPCK",23,0)
 K GMRC(0),GMRCDATE,GMRCDUP,GMRCIEN,GMRCMDT,GMRCTO
"RTN","GMRCEDIT")
0^24^B12253787
"RTN","GMRCEDIT",1,0)
GMRCEDIT ;SLC/DCM - EDIT A CANCELLED CONSULT - MAIN DRIVER ;5/20/98  14:20
"RTN","GMRCEDIT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCEDIT",3,0)
EN(XQCON,XQDFN) ; -- main entry point for GMRCEDIT
"RTN","GMRCEDIT",4,0)
 ;XQDFN=XQAID   XQCON=XQADATA from CPRS alerts
"RTN","GMRCEDIT",5,0)
 S DFN=$P(XQDFN,",",2),GMRCDA=$S(XQCON=+XQCON:+XQCON,+$P($P(XQCON,",",2),";",2):+$P($P(XQCON,",",2),";",2),XQCON?1N.N1",GMRC".E:+XQCON,1:$P($P(XQCON,";",3),",",1))
"RTN","GMRCEDIT",6,0)
 I '+GMRCDA S XQAKILL=$$XQAKILL^ORB3F1 D DEL^ORB3FUP1(.ORY,XQDFN),EXIT Q
"RTN","GMRCEDIT",7,0)
 S GMRCDAP=GMRCDA I +$P(^GMR(123,+GMRCDA,0),"^",5)
"RTN","GMRCEDIT",8,0)
  S GMRCOK=$P(^ORD(100.01,$P(^GMR(123,+GMRCDA,0),"^",12),0),"^",1),GMRCOK=$S(GMRCOK["CANCELLED":1,1:0)
"RTN","GMRCEDIT",9,0)
 I '$D(GMRCOK) S XQAKILL=$$XQAKILL^ORB3F1 D DEL^ORB3FUP1(.ORY,XQDFN),EXIT Q
"RTN","GMRCEDIT",10,0)
 S GMRCPNM=$P(^DPT(DFN,0),"^",1),GMRCPROV=$P(^GMR(123,GMRCDA,0),"^",14) I +GMRCPROV S GMRCPROV=$P(^VA(200,GMRCPROV,0),"^",1)
"RTN","GMRCEDIT",11,0)
 D EN^VALM("GMRC EDIT CONSULT")  ;********* CALL TO LIST MANAGER
"RTN","GMRCEDIT",12,0)
 I $S($D(GMRCRSUB):1,$P(^GMR(123,GMRCDAP,0),"^",12)=5:1,1:0),$O(GMRCFLD(0)) D EN^GMRCEDT3(GMRCDAP)
"RTN","GMRCEDIT",13,0)
 I $O(GMRCFLD(0)),'$D(GMRCRSUB) W !,$C(7),"This Consult Has Not Been Resubmitted!!",!,"Resubmit Or All Edits Will Be Lost!!",!!,"Do You Wish To Resubmit The Consult Now? Y// " D
"RTN","GMRCEDIT",14,0)
 .R GMRCANS:DTIME I $S(GMRCANS="":1,"Yy"[GMRCANS:1,1:0) S $P(^GMR(123,GMRCDAP,0),"^",12)=5 D EN^GMRCEDT2(GMRCDAP,$G(CMDA)),EN^GMRCEDT3(GMRCDAP) Q
"RTN","GMRCEDIT",15,0)
 .I $S('$T:1,GMRCANS["^":1,"Nn"[GMRCANS:1,1:0) D
"RTN","GMRCEDIT",16,0)
 ..S GMRCND=0,DR="" F  S GMRCND=$O(GMRCFLD(GMRCND)) Q:GMRCND=""  D
"RTN","GMRCEDIT",17,0)
 ...I GMRCND'=20,GMRCND'=40 S $P(^GMR(123,GMRCO,0),"^",$P(GMRCFLD(GMRCND),"^",2))=$P(GMRCFLD(GMRCND),"^")
"RTN","GMRCEDIT",18,0)
 ...I GMRCND=20 K ^GMR(123,+GMRCDAP,20) M ^GMR(123,GMRCDAP,20)=GMRCFLD(GMRCND)
"RTN","GMRCEDIT",19,0)
 ...I GMRCND=40 S DA=$P(GMRCFLD(GMRCND),"^",2),DA(1)=GMRCDAP,DIK="^GMR(123,"_DA(1)_",40," D ^DIK K DA,DIK
"RTN","GMRCEDIT",20,0)
 ...Q
"RTN","GMRCEDIT",21,0)
 ..Q
"RTN","GMRCEDIT",22,0)
 .Q
"RTN","GMRCEDIT",23,0)
 S XQAKILL=$$XQAKILL^ORB3F1 D DEL^ORB3FUP1(.ORY,XQDFN)
"RTN","GMRCEDIT",24,0)
 D END
"RTN","GMRCEDIT",25,0)
 Q
"RTN","GMRCEDIT",26,0)
 ;
"RTN","GMRCEDIT",27,0)
HDR ; -- header code
"RTN","GMRCEDIT",28,0)
 S VALMHDR(1)="Edit Consult for Patient "_GMRCPNM_"  Consult Number: "_GMRCDA
"RTN","GMRCEDIT",29,0)
 S VALMHDR(2)="Sending Provider: "_GMRCPROV
"RTN","GMRCEDIT",30,0)
 Q
"RTN","GMRCEDIT",31,0)
 ;
"RTN","GMRCEDIT",32,0)
INIT ; -- init variables and list array
"RTN","GMRCEDIT",33,0)
 K ^TMP("GMRCR",$J,"EDLIST")
"RTN","GMRCEDIT",34,0)
 S DSPLINE=0,DATA="",VALMAR="^TMP(""GMRCR"",$J,""EDLIST"")"
"RTN","GMRCEDIT",35,0)
 F LINE=1:1:GMRCLNO S DSPLINE=$O(^TMP("GMRCR",$J,"ED",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCEDIT",36,0)
 S VALMCNT=GMRCLNO,VALMPGE=1,XQORM("A")="Select Action: "
"RTN","GMRCEDIT",37,0)
 K DSPLINE,DATA,LINE
"RTN","GMRCEDIT",38,0)
 Q
"RTN","GMRCEDIT",39,0)
 ;
"RTN","GMRCEDIT",40,0)
HELP ; -- help code
"RTN","GMRCEDIT",41,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCEDIT",42,0)
 Q
"RTN","GMRCEDIT",43,0)
 ;
"RTN","GMRCEDIT",44,0)
EXIT ;
"RTN","GMRCEDIT",45,0)
 ;Don't kill anything here
"RTN","GMRCEDIT",46,0)
 Q
"RTN","GMRCEDIT",47,0)
END ; -- exit code
"RTN","GMRCEDIT",48,0)
 K ^TMP("GMRCR",$J,"EDLIST"),^TMP("GMRCR",$J,"ED")
"RTN","GMRCEDIT",49,0)
 K CMDA,DFN,DIC,DIE,DR,DA,FLDA,FLDNM,GMRCA,GMRCATN,GMRCD,GMRCDD,GMRCANS,GMRCDIAG,GMRCED,GMRCEDCM,GMRCIND,GMRCINO,GMRCKEEP,GMRCLNO,GMRCND,GMRCND1,GMRCO,GMRCOK,GMRCPC,GMRCPL,GMRCPR,GMRCPNM,GMRCPROC,GMRCPROV,GMRCREQ,GMRCRQT
"RTN","GMRCEDIT",50,0)
 K GMRCFLD,GMRCOUNT,GMRCRSUB,GMRCSS,GMRCURG,GMRCDA,GMRCDAP,GMRCDA1,ND,TRKDA,XQAKILL
"RTN","GMRCEDIT",51,0)
 Q
"RTN","GMRCEDIT",52,0)
 ;
"RTN","GMRCEDIT",53,0)
EXPND ; -- expand code
"RTN","GMRCEDIT",54,0)
 Q
"RTN","GMRCEDIT",55,0)
 ;
"RTN","GMRCEDT1")
0^25^B70913364
"RTN","GMRCEDT1",1,0)
GMRCEDT1 ;SLC/DCM - EDIT A CONSULT AND RE-SEND AS NEW ;6/01/98  13:26
"RTN","GMRCEDT1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCEDT1",3,0)
EN(GMRCO) ;GMRCO=IEN of consult from file 123
"RTN","GMRCEDT1",4,0)
 ;GMRCSS=To Service       GMRCPROC=Procedure Request Type
"RTN","GMRCEDT1",5,0)
 ;GMRCURG=Urgency         GMRCPL=Place Of Consultation
"RTN","GMRCEDT1",6,0)
 ;GMRCATN=Attention       GMRCINO=Service is In/Out Patient
"RTN","GMRCEDT1",7,0)
 ;GMRCPNM=Patient Name    GMRCDIAG=Provisional Diagnosis
"RTN","GMRCEDT1",8,0)
 N GMRCTMP
"RTN","GMRCEDT1",9,0)
 K ^TMP("GMRCR",$J,"ED") S GMRCLNO=1
"RTN","GMRCEDT1",10,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDD="" F  S GMRCDD=$O(^GMR(123,GMRCO,40,"B",GMRCD,GMRCDD)) Q:'GMRCDD  D
"RTN","GMRCEDT1",11,0)
 .I $P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",2)=19 S LN=0 D
"RTN","GMRCEDT1",12,0)
 ..S GMRCTMP(GMRCLNO,0)="Cancelled By (NOT EDITABLE): "_$P(^VA(200,$P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",5),0),"^",1),GMRCLNO=GMRCLNO+1,GMRCTMP(GMRCLNO,0)="Cancelled Comment (NOT EDITABLE):",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",13,0)
 ..S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  I $L(^GMR(123,+GMRCO,40,GMRCDD,1,LN,0))>75 S FLG=1 D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDD,1)","^TMP(""GMRCR"",$J,""ED"")","",.GMRCLNO,"",FLG)
"RTN","GMRCEDT1",14,0)
 ..I '$D(FLG) S LN=0 F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  S GMRCTMP(GMRCLNO,0)=^(LN,0),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",15,0)
 ..S GMRCTMP(GMRCLNO,0)="",$P(^(0),"-",79)="",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",16,0)
 ..Q
"RTN","GMRCEDT1",17,0)
 .Q
"RTN","GMRCEDT1",18,0)
 S GMRCSS=$P(^GMR(123,+GMRCO,0),"^",5),GMRCPROC=$P(^(0),"^",8),GMRCURG=$P(^(0),"^",9),GMRCPL=$P(^(0),"^",10),GMRCATN=$P(^(0),"^",11),GMRCINO=$P(^(0),"^",18),GMRCDIAG=$S($D(^GMR(123,+GMRCO,30)):^(30),1:"")
"RTN","GMRCEDT1",19,0)
 S GMRCRQT=$P(^GMR(123,+GMRCO,0),"^",17) S:GMRCRQT]"" GMRCREQ=$P(^ORD(101,+GMRCRQT,0),"^",1) S GMRCREQ=$S('$L(GMRCRQT):"",GMRCREQ="GMRCOR REQUEST":"Procedure",1:"Consult")
"RTN","GMRCEDT1",20,0)
 S GMRCTMP(GMRCLNO,0)="Request Type: "_GMRCREQ,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",21,0)
 I $L(GMRCRQT),$P(^ORD(101,+GMRCRQT,0),"^",1)="GMRCOR REQUEST" S GMRCTMP(GMRCLNO,0)="Procedure: "_$S($P(^GMR(123,GMRCO,0),"^",8)]"":$P(^ORD(101,+$P(^GMR(123,GMRCO,0),"^",8),0),"^",2),1:"None Listed"),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",22,0)
 S GMRCTMP(GMRCLNO,0)="To Service: "_$S(GMRCSS]"":$P(^GMR(123.5,GMRCSS,0),"^",1),1:"Unknown"),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",23,0)
 S GMRCTMP(GMRCLNO,0)="Procedure/Request Type: "_$S(+GMRCPROC:$P(^ORD(101,+GMRCPROC,0),"^",2),1:""),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",24,0)
 S GMRCTMP(GMRCLNO,0)="Urgency: "_$S(+GMRCURG:$P($G(^ORD(101,+GMRCURG,0)),"^",2),1:""),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",25,0)
 S GMRCTMP(GMRCLNO,0)="Place Of Consultation: "_$S(+GMRCPL:$P(^ORD(101,GMRCPL,0),"^",2),1:""),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",26,0)
 S GMRCTMP(GMRCLNO,0)="Attention (Consultant): "_$S(GMRCATN]"":$P($G(^VA(200,GMRCATN,0)),"^",1),1:""),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",27,0)
 S GMRCTMP(GMRCLNO,0)="Sending Provider (Not Editable):"_$S($P(^GMR(123,+GMRCO,0),"^",14)]"":$P(^VA(200,$P(^GMR(123,+GMRCO,0),"^",14),0),"^",1),1:""),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",28,0)
 S GMRCTMP(GMRCLNO,0)="Service Rendered As In or Out: "_$S(GMRCINO="I":"INPATIENT",GMRCINO="O":"OUTPATIENT",1:""),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",29,0)
 S GMRCTMP(GMRCLNO,0)="Reason For Request:",GMRCLNO=GMRCLNO+1 I $D(^GMR(123,+GMRCO,20)) D
"RTN","GMRCEDT1",30,0)
 .S ND=0 F  S ND=$O(^GMR(123,+GMRCO,20,ND)) Q:ND=""  S GMRCTMP(GMRCLNO,0)=^GMR(123,+GMRCO,20,ND,0),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",31,0)
 .Q
"RTN","GMRCEDT1",32,0)
 S GMRCTMP(GMRCLNO,0)="Provisional Diagnosis: "_GMRCDIAG,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",33,0)
 S GMRCTMP(GMRCLNO,0)="",GMRCLNO=GMRCLNO+1,GMRCTMP(GMRCLNO,0)="COMMENT(S): ",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",34,0)
 S GMRCD=0,GMRCEDCM=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDD="",GMRCDD=$O(^GMR(123,+GMRCO,40,"B",GMRCD,GMRCDD)) Q:'GMRCDD  D
"RTN","GMRCEDT1",35,0)
 .I $P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",2)=20 S LN=0,GMRCEDCM=GMRCEDCM+1,GMRCED(GMRCEDCM)=GMRCDD D
"RTN","GMRCEDT1",36,0)
 ..S GMRCTMP(GMRCLNO,0)="",GMRCLNO=GMRCLNO+1,GMRCTMP(GMRCLNO,0)="Comment #"_GMRCEDCM,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",37,0)
 ..S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  I $L(^GMR(123,+GMRCO,40,GMRCDD,1,LN,0))>75 S FLG=1 D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDD,1)","^TMP(""GMRCR"",$J,""ED"")","",.GMRCLNO,"",FLG) Q
"RTN","GMRCEDT1",38,0)
 ..S LN=0 F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  S GMRCTMP(GMRCLNO,0)=^(LN,0),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",39,0)
 ..Q
"RTN","GMRCEDT1",40,0)
 .Q
"RTN","GMRCEDT1",41,0)
 S GMRCTMP(GMRCLNO,0)=""
"RTN","GMRCEDT1",42,0)
 M ^TMP("GMRCR",$J,"ED")=GMRCTMP
"RTN","GMRCEDT1",43,0)
 K FLG,GMRCTMP
"RTN","GMRCEDT1",44,0)
 Q
"RTN","GMRCEDT1",45,0)
EDITFLD(GMRCO) ;edit a specific field in file 123.
"RTN","GMRCEDT1",46,0)
 ;GMRCO=IEN of consult record in file 123
"RTN","GMRCEDT1",47,0)
EDT I $P(^GMR(123,GMRCDA,0),"^",12)'=13 W $C(7) D  S GMRCRSUB=1 Q
"RTN","GMRCEDT1",48,0)
 .S GMRCACT=$P(^GMR(123,GMRCDA,0),"^",12) S GMRCMSG="The Consult's Status Is No Longer 'CANCELLED'. An Action Has Already Been",GMRCMSG(1)="Taken On It. No Further Action Is Necessary Or Possile." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG
"RTN","GMRCEDT1",49,0)
 .Q
"RTN","GMRCEDT1",50,0)
 W !!!,"Edit which Field: " R X:DTIME I $S('$T:1,X="":1,X["^":1,1:0) Q
"RTN","GMRCEDT1",51,0)
 I X?1.2"?" W !,"Enter the NAME of the field that you want to edit." G EDT
"RTN","GMRCEDT1",52,0)
 I $L(X) S X=$$ULC^GMRCHL7A(X),(FLDA,FLDNM)="" D
"RTN","GMRCEDT1",53,0)
 .S FLDNM=$S("ATTENTION"[X:"ATTENTION","PATIENT LOCATION"[X:"PATIENT LOCATION","PLACE OF CONSULTATION"[X:"PLACE OF CONSULTATION","PROCEDURE/REQUEST TYPE"[X:"PROCEDURE/REQUEST TYPE","PROVISIONAL DIAGNOSIS"[X:"PROVISIONAL DIAGNOSIS",1:"")
"RTN","GMRCEDT1",54,0)
 .I '$L(FLDNM) S FLDNM=$S("TO SERVICE"[X:"TO SERVICE","COMMENT"[X:"COMMENT","REQUEST TYPE"[X:"REQUEST TYPE","SERVICE RENDERED AS IN OR OUT"[X:"SERVICE RENDERED AS IN OR OUT","TO SERVICE"[X:"TO SERVICE","URGENCY"[X:"URGENCY",1:"")
"RTN","GMRCEDT1",55,0)
 .I '$L(FLDNM) S FLDNM=$S("REASON FOR REQUEST"[X:"REASON FOR REQUEST",1:"")
"RTN","GMRCEDT1",56,0)
 .W:$L(FLDNM) $E(FLDNM,$L(X)+1,$L(FLDNM)),!
"RTN","GMRCEDT1",57,0)
 .S FLDA=$S(FLDNM="ATTENTION":7,FLDNM="PATIENT LOCATION":.04,FLDNM="PLACE OF CONSULTATION":6,FLDNM="PROCEDURE/REQUEST TYPE":4,FLDNM="PROVISIONAL DIAGNOSIS":30,FLDNM="REASON FOR REQUEST":20,FLDNM="COMMENT":40,1:"") Q:+FLDA
"RTN","GMRCEDT1",58,0)
 .S FLDA=$S(FLDNM="REQUEST TYPE":13,FLDNM="SERVICE RENDERED AS IN OR OUT":14,FLDNM="TO SERVICE":1,FLDNM="URGENCY":5,1:"")
"RTN","GMRCEDT1",59,0)
 .Q
"RTN","GMRCEDT1",60,0)
 I '+FLDA W $C(7)," ??",!,"Enter the NAME of the Field you wish to Edit as displayed on the screen",! G EDT
"RTN","GMRCEDT1",61,0)
 I $S(FLDA=.04:1,FLDA=1:1,FLDA=4:1,FLDA=5:1,FLDA=6:1,FLDA=7:1,FLDA=13:1,FLDA=14:1,FLDA=30:1,1:0),'$D(GMRCFLD(FLDA)) S GMRCPC=$P($P(^DD(123,FLDA,0),"^",4),";",2) D
"RTN","GMRCEDT1",62,0)
 .I FLDA=1 S GMRCFLD(FLDA)=$S(+$P(^GMR(123,+GMRCO,0),"^",5):$P(^GMR(123.5,+$P(^GMR(123,+GMRCO,0),"^",5),0),"^",1),1:"")_"^"_FLDA Q
"RTN","GMRCEDT1",63,0)
 .I FLDA=4 S GMRCFLD(FLDA)=$S(+$P(^GMR(123,+GMRCO,0),"^",8):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",8),0),"^",2),1:"")_"^"_FLDA Q
"RTN","GMRCEDT1",64,0)
 .I FLDA=5 S GMRCFLD(FLDA)=$S(+$P(^GMR(123,+GMRCO,0),"^",9):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",9),0),"^",2),1:"")_"^"_$P(^GMR(123,+GMRCO,0),"^",9) Q
"RTN","GMRCEDT1",65,0)
 .I FLDA=6 S GMRCFLD(FLDA)=$S(+$P(^GMR(123,+GMRCO,0),"^",10):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",10),0),"^",2),1:"")_"^"_FLDA Q
"RTN","GMRCEDT1",66,0)
 .I FLDA=7 S GMRCFLD(FLDA)=$S(+$P(^GMR(123,+GMRCO,0),"^",11):$P(^VA(200,+$P(^GMR(123,+GMRCO,0),"^",11),0),"^",1),1:"")_"^"_FLDA Q
"RTN","GMRCEDT1",67,0)
 .I FLDA=13 S GMRCFLD(FLDA)=$S(+$P(^GMR(123,+GMRCO,0),"^",17):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",17),0),"^",2),1:"")_"^"_FLDA Q
"RTN","GMRCEDT1",68,0)
 .I FLDA=14 S GMRCFLD(FLDA)=$S($P(^GMR(123,+GMRCO,0),"^",18)="I":"Inpatient",$P(^(0),"^",18)="O":"Outpatient",1:"")_"^"_FLDA Q
"RTN","GMRCEDT1",69,0)
 .I FLDA=30 S GMRCFLD(FLDA)=$S($D(^GMR(123,+GMRCO,30)):^(30),1:"")_"^"_FLDA
"RTN","GMRCEDT1",70,0)
 .Q
"RTN","GMRCEDT1",71,0)
 I FLDA=4 S DIC=101,DIC(0)="AEMQZ",DIC("A")="Procedure/Request Type: ",DIC("S")="I X[""GMRCR"",+$P(^ORD(101,+Y,0),""^"",3)'=1" D ^DIC K DIC D:+Y>0  K:+Y<0 GMRCFLD(FLDA) K Y D EN(+GMRCO),INIT^GMRCEDIT Q
"RTN","GMRCEDT1",72,0)
 .S $P(^GMR(123,+GMRCO,0),"^",8)=+Y_";ORD(101,"
"RTN","GMRCEDT1",73,0)
 .Q
"RTN","GMRCEDT1",74,0)
 I FLDA=13 D  D EN(+GMRCO) Q
"RTN","GMRCEDT1",75,0)
 .F  W !!,"Request Types: CONSULT",!,?15,"REQUEST",!! R "Consult/Request Type: ",X:$S($D(DTIME):DTIME,1:120) Q:$S('$T:1,X="":1,X["^":1,1:0)  S X=$TR(X,"consultrequest","CONSULTRQUEST") D  Q:+X
"RTN","GMRCEDT1",76,0)
 ..I "CONSULT"'[X&("REQUEST"'[X) W $C(7),"  ??",!,"Consult Types Are 'CONSULT' or 'REQUEST'" Q
"RTN","GMRCEDT1",77,0)
 ..S X="GMRCOR "_X S:+($O(^ORD(101,"B",X,0))) X=$O(^ORD(101,"B",X,0)) I X'=+X S X=$O(^ORD(101,"B",X)),X=$O(^ORD(101,"B",X,0))
"RTN","GMRCEDT1",78,0)
 ..I '+X W "  ??",!,"Consult Types are 'CONSULT' or 'REQUEST'" Q
"RTN","GMRCEDT1",79,0)
 ..I +X S $P(^GMR(123,+GMRCO,0),"^",GMRCPC)=X_";ORD(101," Q
"RTN","GMRCEDT1",80,0)
 ..Q
"RTN","GMRCEDT1",81,0)
 .Q
"RTN","GMRCEDT1",82,0)
 I FLDA=5 S DIC=101,DIC(0)="X",X="GMRCURGENCYM - OUTPATIENT" D ^DIC K DIC D:+Y  W:Y<0 $C(7)," ??" G:Y<0 EDT D EN(+GMRCO),INIT^GMRCEDIT Q
"RTN","GMRCEDT1",83,0)
 .S XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Urgency: ",XQORM("^^NO")=0 D ^XQORM K XQORM(0),XQORM("A"),XQORM("^^NO")
"RTN","GMRCEDT1",84,0)
 .I +Y S GMRCURG=$P(Y(1),"^",2),$P(^GMR(123,+GMRCO,0),"^",9)=GMRCURG
"RTN","GMRCEDT1",85,0)
 .D EN(+GMRCO),INIT^GMRCEDIT
"RTN","GMRCEDT1",86,0)
 .Q
"RTN","GMRCEDT1",87,0)
 S DIE="^GMR(123,"
"RTN","GMRCEDT1",88,0)
 I $S(FLDA=20:1,FLDA=40:1,1:0) D WP
"RTN","GMRCEDT1",89,0)
 I FLDA'=20&(FLDA'=40) S DA=+GMRCO,DR=FLDA D ^DIE S GMRCPR=X,DR=FLDA_"////^S X=GMRCPR" D ^DIE K DIE
"RTN","GMRCEDT1",90,0)
 D EN(+GMRCO),INIT^GMRCEDIT
"RTN","GMRCEDT1",91,0)
 Q
"RTN","GMRCEDT1",92,0)
WP ;edit comment and request word processing fields
"RTN","GMRCEDT1",93,0)
 K DIC
"RTN","GMRCEDT1",94,0)
 S DIE="^GMR(123,"
"RTN","GMRCEDT1",95,0)
 S DT=$$NOW^XLFDT
"RTN","GMRCEDT1",96,0)
 S DIC=DIE_+GMRCO_",40,",DWPK=1,DWLW=74
"RTN","GMRCEDT1",97,0)
 I FLDA=40 S GMRCA=20 D  Q:GMRCQUT  S DIWESUB="COMMENTS"
"RTN","GMRCEDT1",98,0)
 .S GMRCQUT=0
"RTN","GMRCEDT1",99,0)
 .I GMRCEDCM=0 S CMDA=$$ADDCM^GMRCEDT4(+GMRCO),GMRCFLD(FLDA)="COMMENT ADDED: "_DT_"^"_CMDA D AUDIT0^GMRCEDT4(CMDA,+GMRCO) S DIC=DIC_CMDA_",1,",GMRCQUT=0 Q
"RTN","GMRCEDT1",100,0)
 .I GMRCEDCM>0 D  Q:GMRCQUT
"RTN","GMRCEDT1",101,0)
 ..F  W !,"Type The Comment Number To Edit Or Type 0 (Zero) To Add A NEW Comment",!!,"Comment: " R X:DTIME S GMRCQUT=$S('$T:1,X["^":1,1:0) Q:GMRCQUT  D  I $D(CMDA),CMDA>0 Q
"RTN","GMRCEDT1",102,0)
 ...I X=0 S CMDA=$$ADDCM^GMRCEDT4(+GMRCO) D AUDIT0^GMRCEDT4(CMDA,+GMRCO) S DIC=DIC_CMDA_",1,",DTOUT=0,Y=$$FMTE^DILIBF(DT,"5U"),GMRCFLD(FLDA)="COMMENT ADDED: "_Y_"^"_CMDA Q
"RTN","GMRCEDT1",103,0)
 ...I $D(GMRCED(X)) S CMDA=GMRCED(X),GMRCFLD(FLDA)="COMMENT EDITED: "_$P(^GMR(123,+GMRCO,40,CMDA,0),"^",1),DIC=DIC_CMDA_",1," Q
"RTN","GMRCEDT1",104,0)
 ...I '$D(GMRCED(X)) W $C(27)," ??"
"RTN","GMRCEDT1",105,0)
 ...Q
"RTN","GMRCEDT1",106,0)
 ..Q
"RTN","GMRCEDT1",107,0)
 .Q
"RTN","GMRCEDT1",108,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCEDT1",109,0)
 I $D(FLDA),FLDA=20 S DIC=DIE_(+GMRCO)_",20,",DWPK=1,DWLW=74 I '$D(GMRCFLD(FLDA)) S GMRCFLD(FLDA)="REASON FOR REQUEST" M GMRCFLD(FLDA)=^GMR(123,+GMRCO,20)
"RTN","GMRCEDT1",110,0)
 D EN^DIWE
"RTN","GMRCEDT1",111,0)
 I FLDA=40,$D(^GMR(123,+GMRCO,40,CMDA,0)),$P($G(^GMR(123.1,+$P(^GMR(123,+GMRCO,40,CMDA,0),U,2),0)),U)="ADDED COMMENT",'$O(^GMR(123,+GMRCO,40,CMDA,0)) D
"RTN","GMRCEDT1",112,0)
 .I $D(CMDA),'$O(^GMR(123,+GMRCO,40,CMDA,0)) S DA=40,DA(1)=CMDA,DIK="^GMR(123,"_DA(1)_",40," D ^DIK K DIK,GMRCFLD(FLDA)
"RTN","GMRCEDT1",113,0)
 .Q
"RTN","GMRCEDT1",114,0)
 S VALMBCK="R"
"RTN","GMRCEDT1",115,0)
 Q
"RTN","GMRCEDT2")
0^26^B5912146
"RTN","GMRCEDT2",1,0)
GMRCEDT2 ;SLC/DCM - RESUBMIT A CANCELLED CONSULT ;5/20/98  14:20
"RTN","GMRCEDT2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCEDT2",3,0)
EN(GMRCO,COMNO) ;entry point into the routine
"RTN","GMRCEDT2",4,0)
 ;COMNO=CMDA from ^GMRCEDT2=comments array IEN from ^GMR(123,IEN,40,
"RTN","GMRCEDT2",5,0)
 ;GMRCO=IEN of the consult from file 123
"RTN","GMRCEDT2",6,0)
 I $S($P(^GMR(123,GMRCO,0),"^",12)=5:1,$D(GMRCRSUB):1,1:0) D  S:'$D(GMRCSUB) GMRCRSUB=1 Q
"RTN","GMRCEDT2",7,0)
 .S GMRCMSG="***     Consult Has Already Been Resubmitted   ***",GMRCMSG(1)="***  No Further Action Is Required Or Allowed ***" D EXAC^GMRCADC(.GMRCMSG)
"RTN","GMRCEDT2",8,0)
 .Q
"RTN","GMRCEDT2",9,0)
 W !,"Resubmitting Consult ... One moment please ..."
"RTN","GMRCEDT2",10,0)
 S DT=$$NOW^XLFDT
"RTN","GMRCEDT2",11,0)
 S DFN=$P(^GMR(123,+GMRCO,0),"^",2),GMRCPROV=$P(^(0),"^",14),GMRCTYPE=$P(^(0),"^",17),GMRCTRLC="XX",VISIT="",RMBED=""
"RTN","GMRCEDT2",12,0)
 S $P(^GMR(123,+GMRCO,0),"^",12)=5,GMRCRSUB=1
"RTN","GMRCEDT2",13,0)
 I +COMNO S GMRCOM=1 S GMRCOM(0)=COMNO
"RTN","GMRCEDT2",14,0)
 D EN^GMRCHL7(DFN,+GMRCO,GMRCTYPE,RMBED,GMRCTRLC,GMRCPROV,VISIT,.GMRCOM) ;update CPRS about consult/request
"RTN","GMRCEDT2",15,0)
 S GMRCURG=$P(^GMR(123,+GMRCO,0),"^",9)
"RTN","GMRCEDT2",16,0)
 I +$P(^GMR(123,+GMRCO,0),"^",11) S ORBADUZ($P(^(0),"^",11))=""
"RTN","GMRCEDT2",17,0)
 S GMRCSVC=$P(^GMR(123,+GMRCO,0),"^",5),GMRCSSNM=""
"RTN","GMRCEDT2",18,0)
 I +GMRCSVC D
"RTN","GMRCEDT2",19,0)
 . D EN^GMRCT(GMRCSVC)
"RTN","GMRCEDT2",20,0)
 . S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSVC,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSVC,0)),U,1))
"RTN","GMRCEDT2",21,0)
 S GMRCPROC=$P(^GMR(123,+GMRCO,0),"^",8)
"RTN","GMRCEDT2",22,0)
 I +GMRCPROC S GMRCPROC=$S($L($G(^ORD(101,+GMRCPROC,.1))):^(.1),1:$P($G(^ORD(101,+GMRCPROC,0)),"^",2))
"RTN","GMRCEDT2",23,0)
 S GMRCORTX=$S($L(GMRCPROC):($E(GMRCSSNM,1,10)_" "_$E(GMRCPROC,1,10)),1:$E(GMRCSSNM,1,20))
"RTN","GMRCEDT2",24,0)
 S GMRCORTX="Resubmitted consult "_GMRCORTX_$S(+GMRCURG:" ("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",1:"")
"RTN","GMRCEDT2",25,0)
 I $O(ORBADUZ(0)) D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,27,.ORBADUZ,1) ;Send notification of NEW consult
"RTN","GMRCEDT2",26,0)
 K GMRCPROV,GMRCTYPE,GMRCTRLC,VISIT,RMBED,GMRCOM,GMRCURG,GMRCSVC,GMRCSVC,GMRCORTX,ORBADUZ
"RTN","GMRCEDT2",27,0)
 Q
"RTN","GMRCEDT3")
0^27^B13067742
"RTN","GMRCEDT3",1,0)
GMRCEDT3 ;SLC/DCM - For a Cancelled Consult - File edited data for tracking consult. ;5/20/98  14:20
"RTN","GMRCEDT3",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCEDT3",3,0)
EN(GMRCDA) W !,"Filing Tracking Data..."
"RTN","GMRCEDT3",4,0)
 I '$D(^GMR(123,GMRCDA,40,0)) S ^GMR(123,GMRCDA,40,0)="123.02^^"
"RTN","GMRCEDT3",5,0)
 S DA=$S(+$P(^GMR(123,GMRCDA,40,0),"^",3):$P(^(0),"^",3)+1,1:1),$P(^(0),"^",3,4)=DA_"^"_DA D
"RTN","GMRCEDT3",6,0)
 .S ^GMR(123,GMRCDA,40,DA,0)=DT_"^"_$O(^GMR(123.1,"B","EDIT/RESUBMITTED",0))_"^"_DT_"^"_DUZ_"^"_DUZ D
"RTN","GMRCEDT3",7,0)
 .S ^GMR(123,GMRCDA,40,DA,1,0)="^^^^"_DT_"^" D
"RTN","GMRCEDT3",8,0)
 ..S GMRCOUNT=1,GMRCND=0,^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="-------------------------------- EDITED FIELDS ---------------------------------",GMRCOUNT=GMRCOUNT+1
"RTN","GMRCEDT3",9,0)
 ..F  S GMRCND=$O(GMRCFLD(GMRCND)) Q:GMRCND=""  S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=$P(^DD(123,GMRCND,0),"^",1)_": " D  S GMRCOUNT=GMRCOUNT+1
"RTN","GMRCEDT3",10,0)
 ...I GMRCND=1 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="To Service: "_$S(+$P(GMRCFLD(GMRCND),"^",1):$P(^GMR(123.5,$P(GMRCFLD(GMRCND),"^",1),0),"^",1),1:"No Previous Value") Q
"RTN","GMRCEDT3",11,0)
 ...I GMRCND=4 S GMRCIND=$P(^GMR(123,GMRCDA,0),"^",8),GMRCIND="^"_$P(GMRCIND,";",2)_$P(GMRCIND,";",1)_",0)",^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=^(0)_$P(@(GMRCIND),"^",2) Q
"RTN","GMRCEDT3",12,0)
 ...I GMRCND=14 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=^(0)_$S($P(GMRCFLD(GMRCND),"^",1)="I":"Inpatient",$P(GMRCFLD(GMRCND),"^",1)="O":"Outpatient",1:"No Previous Value") Q
"RTN","GMRCEDT3",13,0)
 ...I $S(GMRCND=5:1,GMRCND=6:1,GMRCND=13:1,1:0) S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=^(0)_$S($P(GMRCFLD(GMRCND),"^",1)]"":$P(^ORD(101,$P(GMRCFLD(GMRCND),"^",2),0),"^",2),1:"No Previous Value") Q
"RTN","GMRCEDT3",14,0)
 ...I $S(GMRCND=7:1,GMRCND=10:1,1:0) S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=^(0)_$S($L($P(GMRCFLD(GMRCND),"^",1)):$P(^VA(200,$P(GMRCFLD(GMRCND),"^",1),0),"^",1),1:"") Q
"RTN","GMRCEDT3",15,0)
 ...I GMRCND=20 S GMRCND1=0,GMRCOUNT=GMRCOUNT+1 F  S GMRCND1=$O(GMRCFLD(GMRCND,GMRCND1)) Q:GMRCND1=""  S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=GMRCFLD(GMRCND,GMRCND1,0),GMRCOUNT=GMRCOUNT+1
"RTN","GMRCEDT3",16,0)
 ...Q:GMRCND=20
"RTN","GMRCEDT3",17,0)
 ...I GMRCND=30 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=$P(^DD(123,GMRCND,0),"^",1)_": "_GMRCFLD(GMRCND) Q
"RTN","GMRCEDT3",18,0)
 ...I GMRCND=40 S ^GMR(123,+GMRCDA,40,DA,1,GMRCOUNT,0)=$P(GMRCFLD(GMRCND),"^",1) Q
"RTN","GMRCEDT3",19,0)
 ...I GMRCND=5 S GMRCAT="^"_$P(^DD(123,GMRCND,0),"^",3)_+GMRCFLD(GMRCND)_",0)" S ^GMR(123,GMRCND,40,DA,1,GMRCOUNT,0)=$P(@(GMRCAT),"^",2) Q
"RTN","GMRCEDT3",20,0)
 ...I $P(GMRCFLD(GMRCND),"^",1)'=$P(^GMR(123,+GMRCDA,0),"^",$P(GMRCFLD(GMRCND),"^",2)) S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=$S($P(GMRCFLD(GMRCND),"^",1)]"":$P(GMRCFLD(GMRCND),"^",1),1:"No Previous Value")
"RTN","GMRCEDT3",21,0)
 ...Q
"RTN","GMRCEDT3",22,0)
 ..Q
"RTN","GMRCEDT3",23,0)
 .S $P(^GMR(123,GMRCDA,40,DA,1,0),"^",3)=GMRCOUNT-1,$P(^(0),"^",4)=GMRCOUNT-1,^GMR(123,+GMRCDA,40,"B",DT,DA)=""
"RTN","GMRCEDT3",24,0)
 .Q
"RTN","GMRCEDT3",25,0)
 K GMRCIND,GMRCND
"RTN","GMRCEDT3",26,0)
 Q
"RTN","GMRCEDT4")
0^28^B1312916
"RTN","GMRCEDT4",1,0)
GMRCEDT4 ;SLC/DCM - CONSULT UTILITIES FOR EDITING A FIELD ;5/20/98  14:20
"RTN","GMRCEDT4",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCEDT4",3,0)
ADDCM(GMRCO) ;set up to add a comment when none exists or to add a new comment
"RTN","GMRCEDT4",4,0)
 N X
"RTN","GMRCEDT4",5,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^" S X=$S($P(^GMR(123,GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1),$P(^GMR(123,GMRCO,40,0),"^",3,4)=X_"^"_X
"RTN","GMRCEDT4",6,0)
 Q X
"RTN","GMRCEDT4",7,0)
AUDIT0(DA,GMRCDA) ;Add the necessary tracking information to word processing fields
"RTN","GMRCEDT4",8,0)
 N DIE
"RTN","GMRCEDT4",9,0)
 S DIE="^GMR(123,"_GMRCDA_",40,",DA(1)=GMRCDA,DR=".01////^S X=DT;1////^S X=GMRCA;2////^S X=DT;3////^S X=DUZ;4////^S X=DUZ"
"RTN","GMRCEDT4",10,0)
 D ^DIE
"RTN","GMRCEDT4",11,0)
 S @(DIE_"""B"","_DT_","_DA_")")=""
"RTN","GMRCEDT4",12,0)
 Q
"RTN","GMRCFP")
1^29
"RTN","GMRCGUIA")
0^30^B44457474
"RTN","GMRCGUIA",1,0)
GMRCGUIA ;SLC/DCM - GUI actions for consults from the GUI interface -- file actions taken ;5/20/98  14:20
"RTN","GMRCGUIA",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCGUIA",3,0)
SETDA() ;set DA of where audit actions are to be filed
"RTN","GMRCGUIA",4,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCGUIA",5,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCGUIA",6,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCGUIA",7,0)
 Q DA
"RTN","GMRCGUIA",8,0)
REASON(GMRCFN,GMRCRQ,GMRCDT) ;Load the reason for the request into ^GMR(123,GMRCO,20
"RTN","GMRCGUIA",9,0)
 ;GMRCFN=File 123 IFN; GMRCRQ=Array containing Reason For Request
"RTN","GMRCGUIA",10,0)
 ;GMRCDT=Date time of entry
"RTN","GMRCGUIA",11,0)
 S ^GMR(123,GMRCFN,20,0)="^^^"_GMRCDT_"^"
"RTN","GMRCGUIA",12,0)
 S L=0,LN=1 F  S L=$O(GMRCRQ(L)) Q:L=""  S ^GMR(123,GMRCFN,20,LN,0)=GMRCRQ(L),LN=LN+1
"RTN","GMRCGUIA",13,0)
 S LN=LN-1,$P(^GMR(123,GMRCFN,20,0),"^",3)=LN
"RTN","GMRCGUIA",14,0)
 K LN,LN
"RTN","GMRCGUIA",15,0)
 Q
"RTN","GMRCGUIA",16,0)
SETCOM(COMMENT) ;Set comment array into tracking actions
"RTN","GMRCGUIA",17,0)
 S ^GMR(123,GMRCO,40,DA,0)=GMRCNOW_"^"_GMRCA_"^"_GMRCAD_"^"_GMRCORNP_"^"_GMRCDUZ
"RTN","GMRCGUIA",18,0)
 I GMRCA=17 S ^GMR(123,GMRCO,40,DA,0)=^GMR(123,GMRCO,40,DA,0)_"^"_GMRCFF
"RTN","GMRCGUIA",19,0)
 S ^GMR(123,GMRCO,40,DA,1,0)="^^^^"_GMRCAD_"^"
"RTN","GMRCGUIA",20,0)
 S (GMRCND,GMRCND1)=0 F  S GMRCND1=$O(COMMENT(GMRCND1)) Q:GMRCND1=""  S GMRCND=GMRCND+1,^GMR(123,GMRCO,40,DA,1,GMRCND,0)=COMMENT(GMRCND)
"RTN","GMRCGUIA",21,0)
 S $P(^GMR(123,GMRCO,40,DA,1,0),"^",3)=GMRCND,$P(^(0),"^",4)=GMRCND,^GMR(123,GMRCO,40,"B",GMRCNOW,DA)=""
"RTN","GMRCGUIA",22,0)
 Q
"RTN","GMRCGUIA",23,0)
 ;
"RTN","GMRCGUIA",24,0)
NEW(DFN,GMRCDA,GMRCLOC,GMRCTYPE,GMRCSVC,GMRCPROV,GMRCURG,GMRCPLI,GMRCNP,GMRCATN,GMRCINOT,GMRCDIAG,GMRCRFQ) ;Add a new consult for a patient.
"RTN","GMRCGUIA",25,0)
 ;DFN=Patient ^DPT( file number
"RTN","GMRCGUIA",26,0)
 ;GMRCRFQ=Reason For Request, why the consult is being ordered. Passed in as
"RTN","GMRCGUIA",27,0)
 ;    an array
"RTN","GMRCGUIA",28,0)
 ;GMRCDIAG=Povisional diagnosis; what is suspected to be the problem
"RTN","GMRCGUIA",29,0)
 ;GMRCTYPE=Request type -Consult or Procedure
"RTN","GMRCGUIA",30,0)
 ;GMRCLOC=Patient location.
"RTN","GMRCGUIA",31,0)
 ;GMRCDA=Date Time of Request
"RTN","GMRCGUIA",32,0)
 ;GMRCSVC=To Service; consulting service
"RTN","GMRCGUIA",33,0)
 ;GMRCLOC=Hospital Location ordering consult
"RTN","GMRCGUIA",34,0)
 ;GMRCPR=If a procedure, the procedure ordered (pointer to file 101)
"RTN","GMRCGUIA",35,0)
 ;GMRCURG=Urgency of request (stat, routine, etc) from file 101
"RTN","GMRCGUIA",36,0)
 ;GMRCPLI=Place of consultation (bedside, consultants choice, etc.) from file 101
"RTN","GMRCGUIA",37,0)
 ;GMRCPROV=Sending Provider
"RTN","GMRCGUIA",38,0)
 ;GMRCATN=if consult is to go to a specific provider, this provider is identified here.
"RTN","GMRCGUIA",39,0)
 ;GMRCINOT=Service provided as Inpatient or Outpatient
"RTN","GMRCGUIA",40,0)
 S DIC="^GMR(123,",DIC(0)="L",X="""N""",DLAYGO=123 D ^DIC K DLAYGO
"RTN","GMRCGUIA",41,0)
 S (DA,GMRCO)=+Y,GMRCSTS=5,GMRCA=1,DIE=DIC
"RTN","GMRCGUIA",42,0)
 L +^GMR(123,GMRC0)
"RTN","GMRCGUIA",43,0)
 S DR=".02////^S X=DFN;.04////^S X=GMRCLOC;1////^S X=GMRCSVC;3////^S X=GMRCDA;4////^S X=GMRCPR;5////^S X=GMRCURG;6////^S X=GMRCPLI"_$S(GMRCATN]"":"7////^S X=GMRCATN",1:"")
"RTN","GMRCGUIA",44,0)
 D ^DIE
"RTN","GMRCGUIA",45,0)
 S DR="8////^S X=GMRCSTS;9////^S X=GMRCA;10////^S X=GMRCPROV;11////^S X=GMRCATN;13////^S X=GMRCTYPE;14////^S X=GMRCINOT"_$S($D(GMRCDIAG):"30:////^S X=GMRCDIAG",1:"")
"RTN","GMRCGUIA",46,0)
 D ^DIE L -^GMR(123,GMRCO)
"RTN","GMRCGUIA",47,0)
 I $O(GMRCRFQ(0)) D REASON(GMRCDA,GMRCRFQ,GMRCDA)
"RTN","GMRCGUIA",48,0)
 D EN^GMRCHL7(DFN,GMRCDA,GMRCTYP,$G(GMRCRB),"NW",DUZ,$G(VISIT),"")
"RTN","GMRCGUIA",49,0)
 Q
"RTN","GMRCGUIA",50,0)
RC(GMRCO,GMRCORNP,GMRCAD,GMRCERR) ;Receive the consult into the service
"RTN","GMRCGUIA",51,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIA",52,0)
 ;GMRCORNP - Name of the person who actually 'Received'the consult into the service.
"RTN","GMRCGUIA",53,0)
 ;GMRCDUZ - DUZ of person entering the consult into the service as being 'RECEIVED'.
"RTN","GMRCGUIA",54,0)
 ;GMRCAD - Actual date time that the consult was received into the service.
"RTN","GMRCGUIA",55,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIA",56,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIA",57,0)
 N DFN,GMRCSTS,GMRCDUZ,GMRCNOW
"RTN","GMRCGUIA",58,0)
 S GMRCERR=0,GMRCERMS="",GMRCDUZ=DUZ,GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",59,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIA",60,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",61,0)
 S GMRCSTS=6,GMRCA=21
"RTN","GMRCGUIA",62,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",63,0)
 D AUDIT^GMRCP
"RTN","GMRCGUIA",64,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","")
"RTN","GMRCGUIA",65,0)
 D EXIT
"RTN","GMRCGUIA",66,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",67,0)
 ;
"RTN","GMRCGUIA",68,0)
DC(GMRCO,GMRCORNP,GMRCAD,GMRCACTM,GMRCOM,GMRCERR,GMRCERMS) ;Discontinue or Deny a consult
"RTN","GMRCGUIA",69,0)
 ;GMRCO - Internal file number of consult from File 123
"RTN","GMRCGUIA",70,0)
 ;GMRCORNP - Provider who Discontinued or Denied consult
"RTN","GMRCGUIA",71,0)
 ;GMRCAD - Date/Time Consult was denied.
"RTN","GMRCGUIA",72,0)
 ;GMRCNOW - Current date/time
"RTN","GMRCGUIA",73,0)
 ;GMRCACTM - If consult is 'DENIED' passed in as 'DY'; if consult is Discontinued passed in as 'DC'.
"RTN","GMRCGUIA",74,0)
 ;GMRCERR=Error Flag: 0 if no error occurred, 1 if was an error
"RTN","GMRCGUIA",75,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIA",76,0)
 ;GMRCDUZ - DUZ of person entering the action
"RTN","GMRCGUIA",77,0)
 ;GMRCOM - Array containing explanation of why consult was denied. Passed as the following form :
"RTN","GMRCGUIA",78,0)
 ;     ARRAY(1)="xxx xxx xxx",ARRAY(2)="XXX XXX",ARRAY(3)="XXX XXX xx", etc.
"RTN","GMRCGUIA",79,0)
 ;     Comment is a required field when consult is denied or discontinued.
"RTN","GMRCGUIA",80,0)
 N GMRCDUZ,DFN,GMRCNOW,GMRCSTS
"RTN","GMRCGUIA",81,0)
 S GMRCDUZ=DUZ,GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",82,0)
 K GMRCQUT
"RTN","GMRCGUIA",83,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIA",84,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",85,0)
 I '$D(GMRCOM) S GMRCERR=1,GMRCERMS="Comments are required for this action." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",86,0)
 S GMRCSTS=$P(^ORD(100.01,$P(^GMR(123,GMRCO,0),"^",12),0),U,2)
"RTN","GMRCGUIA",87,0)
 I GMRCSTS="dc" S GMRCERR=1,GMRCERMS="Order Has Already Been Discontinued." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",88,0)
 I GMRCSTS="ca" S GMRCERR=1,GMRCERMS="Order Has Already Been Cancelled." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",89,0)
 I GMRCSTS="comp" S GMRCERR=1,GMRCERMS="Order Has Already Been Completed." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",90,0)
 S GMRCA=$S(GMRCACTM="DC":6,GMRCACTM="DY":19,1:""),GMRCSTS=$S(GMRCA=6:1,19:13)
"RTN","GMRCGUIA",91,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",92,0)
 S DA=$$SETDA D SETCOM(.GMRCOM)
"RTN","GMRCGUIA",93,0)
 S GMRCTRLC=$S(GMRCACTM="DC":"OD",GMRCACTM="DY":"OC",1:"")
"RTN","GMRCGUIA",94,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),GMRCTRLC,GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCGUIA",95,0)
 D EXIT
"RTN","GMRCGUIA",96,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",97,0)
 ;
"RTN","GMRCGUIA",98,0)
FR(GMRCO,GMRCSS,GMRCORNP,GMRCATTN,GMRCURGI,GMRCOM,GMRCERR,GMRCERMS) ;Forward consult/request to another service
"RTN","GMRCGUIA",99,0)
 N GMRCDUZ,GMRCAD,GMRCNOW,GMRCFF
"RTN","GMRCGUIA",100,0)
 S GMRCFF=$P(^GMR(123,GMRCO,0),U,5),GMRCDUZ=DUZ,GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",101,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW  ; Actual date time that the consult was forwarded from the service
"RTN","GMRCGUIA",102,0)
 S GMRCA=17,GMRCSTS=5
"RTN","GMRCGUIA",103,0)
 S DT=$$NOW^XLFDT
"RTN","GMRCGUIA",104,0)
 S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCGUIA",105,0)
 S DR="1////^S X=GMRCSS;5////^S X=GMRCURGI;8////^S X=GMRCSTS;9////^S X=GMRCA"_$S($L(GMRCATTN):";7////^S X=GMRCATTN",1:"")
"RTN","GMRCGUIA",106,0)
 L +^GMR(123,GMRCO):3 I '$T K DIE,DA,DR S GMRCERR=1,GMRCERMS="Data Not Filed - File In Use By Another User." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",107,0)
 D ^DIE L -^GMR(123,GMRCO) K DIE,DA,DR
"RTN","GMRCGUIA",108,0)
 S DA=$$SETDA D SETCOM(.GMRCOM)
"RTN","GMRCGUIA",109,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",110,0)
 ;
"RTN","GMRCGUIA",111,0)
RT(GMRCO,TMPGLOB) ;Set ^TMP("GMRCR",$J,"DT", with results from med and TIU
"RTN","GMRCGUIA",112,0)
 ;GMRCO=IEN of consult from file 123
"RTN","GMRCGUIA",113,0)
 ;Set TMPGLOB to a ^TMP global other than ^TMP("GMRCR",$J,"DT", or ^TMP("GMRCR",$J,"RES", i.e., 'S TMPGLOB="^TMP(""GMRCR"",$J,""RT"")"'
"RTN","GMRCGUIA",114,0)
 Q:'$D(GMRCO)
"RTN","GMRCGUIA",115,0)
 K @TMPGLOB
"RTN","GMRCGUIA",116,0)
 S GMRCCT=0
"RTN","GMRCGUIA",117,0)
 S GMRCSR=$P(^GMR(123,+GMRCO,0),"^",15),GMRCTUFN=$P(^(0),"^",20)
"RTN","GMRCGUIA",118,0)
 I +GMRCSR D AREN^GMRCSLM3(GMRCO,GMRCSR) D
"RTN","GMRCGUIA",119,0)
 .S TAB="",$P(TAB," ",35)=""
"RTN","GMRCGUIA",120,0)
 .S GMRCCT=GMRCCT+1,@TMPGLOB@(GMRCCT,0)=$E(TAB,1,31)_"Medicine Results"
"RTN","GMRCGUIA",121,0)
 .S ND=0 F  S ND=$O(^TMP("GMRCR",$J,"DT",ND)) Q:ND=""  S GMRCCT=GMRCCT+1,@TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"DT",ND,0)
"RTN","GMRCGUIA",122,0)
 .K ^TMP("GMRCR",$J,"DT")
"RTN","GMRCGUIA",123,0)
 .S:+GMRCTUFN GMRCCT=GMRCCT+1,@TMPGLOB@(GMRCCT,0)=""
"RTN","GMRCGUIA",124,0)
 .Q
"RTN","GMRCGUIA",125,0)
 I +GMRCTUFN D
"RTN","GMRCGUIA",126,0)
 .I +GMRCSR S @TMPGLOB@(GMRCCT,0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCGUIA",127,0)
 .S TAB="",$P(TAB," ",35)=""
"RTN","GMRCGUIA",128,0)
 .S GMRCCT=GMRCCT+1,@TMPGLOB@(GMRCCT,0)=$E(TAB,1,30)_"TIU CONSULT REPORT"
"RTN","GMRCGUIA",129,0)
 .D PRINT^GMRCTIU(GMRCTUFN,1,1)
"RTN","GMRCGUIA",130,0)
 .S ND=0 F  S ND=$O(^TMP("GMRCR",$J,"RES",ND)) Q:(ND?1A.E)!(ND="")  S GMRCCT=GMRCCT+1,@TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"RES",ND,0)
"RTN","GMRCGUIA",131,0)
 .I ND="ADD" S ND=0 F  S ND=$O(^TMP("GMRCR",$J,"RES","ADD",ND)) Q:ND=""  S @TMPGLOB@(GMRCCT,0)="",GMRCCT=GMRCCT+1,@TMPGLOB@(GMRCCT,0)=$E(TAB,1,30)_" ADDENDUM",GMRCCT=GMRCCT+1 D
"RTN","GMRCGUIA",132,0)
 ..S ND1=0 F  S ND1=$O(^TMP("GMRCR",$J,"RES","ADD",ND,ND1)) Q:ND1=""  S @TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"RES","ADD",ND,ND1,0),GMRCCT=GMRCCT+1
"RTN","GMRCGUIA",133,0)
 ..Q
"RTN","GMRCGUIA",134,0)
 .K ^TMP("GMRCR",$J,"RES")
"RTN","GMRCGUIA",135,0)
 .Q
"RTN","GMRCGUIA",136,0)
 I GMRCCT=0,'$O(@TMPGLOB@(0)) S @TMPGLOB@(1,0)="  No Medicine Or TIU Results Exist For This Consult"
"RTN","GMRCGUIA",137,0)
 K GMRCSR,GMRCCT,ND,ND1,TAB
"RTN","GMRCGUIA",138,0)
 D EXIT
"RTN","GMRCGUIA",139,0)
 Q
"RTN","GMRCGUIA",140,0)
EXIT ;kill off variables for exit from actions
"RTN","GMRCGUIA",141,0)
 K GMRCA,GMRCMODE,GMRCND,GMRCND1,GMRCORNP,GMRCQUT,GMRCCSDT,GMRCCSIG,GMRCSIG,GMRCSTS,GMRCSIGM,GMRCSDT,GMRCTUFN,GMRCCTIT,GMRCCSDT,GMRCSIGT
"RTN","GMRCGUIA",142,0)
 Q
"RTN","GMRCHK")
0^31^B122123
"RTN","GMRCHK",1,0)
GMRCHK ;SLC/DLT - GMRC CHECK FOR PROGRAMMER ACCESS ;5/20/98  14:20
"RTN","GMRCHK",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCHK",3,0)
 I $D(DUZ)>10,$D(DUZ(0)),DUZ(0)="@"
"RTN","GMRCHK",4,0)
 E  W !,"PROGRAMMER ACCESS REQUIRED" K DIFQ Q
"RTN","GMRCHK",5,0)
 Q
"RTN","GMRCHL7")
0^32^B24806616
"RTN","GMRCHL7",1,0)
GMRCHL7 ;SLC/DCM - HL-7 formatting routine for consult information to be passed to OER ;5/20/98  14:20
"RTN","GMRCHL7",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCHL7",3,0)
 ;;Format the HL-7 Message header
"RTN","GMRCHL7",4,0)
 Q
"RTN","GMRCHL7",5,0)
INIT S HLQ=""""""
"RTN","GMRCHL7",6,0)
 S SEP1="|",SEP2="^",SEP3="~",SEP4="\",SEP5="&"
"RTN","GMRCHL7",7,0)
 Q
"RTN","GMRCHL7",8,0)
MSH(X) ;Format MSH segment of HL-7 message.
"RTN","GMRCHL7",9,0)
 ;FROM=GMRC CONSULTS - the sending application
"RTN","GMRCHL7",10,0)
 N X
"RTN","GMRCHL7",11,0)
 I '$D(HLQ) D INIT
"RTN","GMRCHL7",12,0)
 S X="MSH|^~\&|CONSULTS|"_$S($G(DUZ(2))]"":DUZ(2),$P($G(^XTV(8989.3,1,"XUS")),"^",17):$P(^("XUS"),"^",17),1:"")_"|||||ORM"
"RTN","GMRCHL7",13,0)
 Q X
"RTN","GMRCHL7",14,0)
PID(GMRCIEN) ;Format the HL-7 PID segment
"RTN","GMRCHL7",15,0)
 ;GMRCIEN=IEN of consult from File 123
"RTN","GMRCHL7",16,0)
 N X
"RTN","GMRCHL7",17,0)
 S GMRCDPT=$P(^GMR(123,GMRCIEN,0),"^",2)
"RTN","GMRCHL7",18,0)
 S GMRCPTN=$P($G(^DPT(GMRCDPT,0)),"^")
"RTN","GMRCHL7",19,0)
 S X="PID|||"_+GMRCDPT_"||"_GMRCPTN
"RTN","GMRCHL7",20,0)
 K GMRCDPT,GMRCPTN
"RTN","GMRCHL7",21,0)
 Q X
"RTN","GMRCHL7",22,0)
PV1(GMRCIEN,RMBED,VISIT) ;Format the HL-7 PV1 segment
"RTN","GMRCHL7",23,0)
 N GMRCSTS,SEP1,X,Y
"RTN","GMRCHL7",24,0)
 S HOSPLOC=$P(^GMR(123,GMRCIEN,0),"^",4)
"RTN","GMRCHL7",25,0)
 S VISIT=$$HL7DT(VISIT),GMRCSTS=$S($P(^GMR(123,GMRCIEN,0),"^",18)]"":$P(^(0),"^",18),HOSPLOC]"":"I",1:"O")
"RTN","GMRCHL7",26,0)
 S X="PV1"_"||"_GMRCSTS_"|"_$S(HOSPLOC]"":HOSPLOC,1:"")_"^"_$S(RMBED]"":RMBED,1:"")_"|"_$S(VISIT]"":VISIT,1:"")
"RTN","GMRCHL7",27,0)
 K Y,HOSPLOC,VISIT,GMRCSTS
"RTN","GMRCHL7",28,0)
 Q X
"RTN","GMRCHL7",29,0)
NTE(NTE,ND) ;Format the HL-7 NTE segment
"RTN","GMRCHL7",30,0)
 Q:'$D(NTE)  Q:'$O(NTE(0))
"RTN","GMRCHL7",31,0)
 S GMRCND=1,GMRCND1=0 D
"RTN","GMRCHL7",32,0)
 .S GMRCND1=$O(NTE(GMRCND1)),@(MSG_"("_ND_")")=NTE(GMRCND1)
"RTN","GMRCHL7",33,0)
 .F  S GMRCND1=$O(NTE(GMRCND1)) Q:GMRCND1=""  I NTE(GMRCND1)]"" S @(MSG_"("_ND_","_GMRCND_")")=NTE(GMRCND1),GMRCND=GMRCND+1
"RTN","GMRCHL7",34,0)
 .Q
"RTN","GMRCHL7",35,0)
 Q
"RTN","GMRCHL7",36,0)
EN(PATID,GMRCIEN,GMRCRTYP,RMBED,ORCTRL,GMRCPLCR,VISIT,GMRCOM) ;;Main entry point
"RTN","GMRCHL7",37,0)
 ;PATID=DFN - Patients internal entry number from ^DPT(
"RTN","GMRCHL7",38,0)
 ;GMRCIEN=IEN of consult, from File 123
"RTN","GMRCHL7",39,0)
 ;RMBED=Hospital Room/Bed if patient is hospitalized
"RTN","GMRCHL7",40,0)
 ;ORCTRL=Code from HL-7 table 119 (Appendix A) Order Control Codes
"RTN","GMRCHL7",41,0)
 ;VISIT=Visit as a DATE/TIME in Fileman Format.
"RTN","GMRCHL7",42,0)
 ;GMRCPROV=Provider - IEN from file 200
"RTN","GMRCHL7",43,0)
 ;GMRCRTYP=consult type: GMRC REQUEST or GMRC CONSULT
"RTN","GMRCHL7",44,0)
 ;GMRCPLCR=who is entering the order ; usually passed as DUZ for new order, "" for existing order
"RTN","GMRCHL7",45,0)
 ;GMRCOM=comment array flag: 1 if there is comment array, 0 otherwise
"RTN","GMRCHL7",46,0)
 ;GMRCOM(0)=DA of where comment is located: ^GMR(123,IEN,40,DA,
"RTN","GMRCHL7",47,0)
 Q:'$L(ORCTRL)
"RTN","GMRCHL7",48,0)
 N MSG,MSH,PID,PV1,ORC,NTE,OBR,OBX,GMRCA,GMRCURGI,GMRCPLI,GMRCPR,GMRCSS,GMRCTYPE,ORCPLCR
"RTN","GMRCHL7",49,0)
 S MSH="",MSH=$$MSH(MSH)
"RTN","GMRCHL7",50,0)
 S PID=$$PID(GMRCIEN)
"RTN","GMRCHL7",51,0)
 I ORCTRL'="Z@" S PV1=$$PV1(GMRCIEN,RMBED,VISIT)
"RTN","GMRCHL7",52,0)
 D ORC(GMRCIEN,ORCTRL,GMRCPLCR) I ORCTRL="Z@" S ORC=$P(ORC,SEP1,1,4)
"RTN","GMRCHL7",53,0)
 D:ORCTRL'="Z@" OBR^GMRCHL72(GMRCIEN,$G(GMRCAUTH)) ;GMRCAUTH=principle results interpreter
"RTN","GMRCHL7",54,0)
 I $S(ORCTRL="SN":1,ORCTRL="RE":1,ORCTRL="XX":1,1:0) D OBX^GMRCHL72(GMRCIEN)
"RTN","GMRCHL7",55,0)
 I $S(ORCTRL="OC":1,ORCTRL="OD":1,ORCTRL="XX":1,ORCTRL="SC":1,1:0),$G(GMRCOM(0)) D NTE^GMRCHL72(GMRCIEN,.GMRCOM,ORCTRL)
"RTN","GMRCHL7",56,0)
 D BLD(MSH,PID,$G(PV1),$G(ORC),$G(OBR),.OBX,.NTE,ORCTRL)
"RTN","GMRCHL7",57,0)
 D MSG^XQOR("GMRC EVSEND OR",.GMRCMSG)
"RTN","GMRCHL7",58,0)
 K GMRCND,GMRCND1,GMRCMSG,GMRCNOD,GMRCORFN,GMRCPLI,GMRCPRI,HL7DT,HLQ,J,ND,ND1,ND2,NOTIFY,OBXND,OBXNO,ORCACT,ORCDT,ORURG,SEP1,SEP2,SEP3,SEP4,SEP5
"RTN","GMRCHL7",59,0)
 Q
"RTN","GMRCHL7",60,0)
BLD(MSH,PID,PV1,ORC,OBR,OBX,NTE,CTRLCD) ;Build the HL-7 message global to pass to OR
"RTN","GMRCHL7",61,0)
 S MSG="GMRCMSG",ND=1
"RTN","GMRCHL7",62,0)
 K @(MSG)
"RTN","GMRCHL7",63,0)
 F J="MSH","PID","PV1" I @J]"" S @(MSG_"("_ND_")")=@J,ND=ND+1
"RTN","GMRCHL7",64,0)
 I ORC]"" S @(MSG_"("_ND_")")=ORC,ND=ND+1 I CTRLCD="XX",$D(NTE),$O(NTE(0)) D NTE(.NTE,ND) S ND=ND+1
"RTN","GMRCHL7",65,0)
 I OBR]"" S @(MSG_"("_ND_")")=OBR,ND=ND+1
"RTN","GMRCHL7",66,0)
 I $O(OBX("")) S OBXND=0 D
"RTN","GMRCHL7",67,0)
 .S OBXND=$O(OBX(OBXND)) Q:OBXND=""  S @(MSG_"("_ND_")")=OBX(OBXND)
"RTN","GMRCHL7",68,0)
 .S GMRCND1=0 F  S GMRCND1=$O(OBX(OBXND,GMRCND1)) Q:GMRCND1=""  S @(MSG_"("_ND_","_GMRCND1_")")=OBX(OBXND,GMRCND1)
"RTN","GMRCHL7",69,0)
 .S ND=ND+1,OBXND=$O(OBX(OBXND)) I OBXND]"" S @(MSG_"("_ND_")")=OBX(OBXND)
"RTN","GMRCHL7",70,0)
 .Q
"RTN","GMRCHL7",71,0)
 I CTRLCD'="XX",$D(NTE),$O(NTE(0)) D NTE(.NTE,ND) S ND=ND+1
"RTN","GMRCHL7",72,0)
 Q
"RTN","GMRCHL7",73,0)
HL7DT(DATE) ;Convert Fileman Date to HL-7 Date
"RTN","GMRCHL7",74,0)
 N X
"RTN","GMRCHL7",75,0)
 S X="" I DATE S X=17000000+$P(DATE,".",1)_$P(DATE,".",2)
"RTN","GMRCHL7",76,0)
 Q X
"RTN","GMRCHL7",77,0)
FMDATE(DATE) ;Convert HL-7 formatted date to a Fileman formatted date
"RTN","GMRCHL7",78,0)
 N X
"RTN","GMRCHL7",79,0)
 S X="" I DATE S X=($E(DATE,1,8)-17000000)_$S($L($E(DATE,9)):"."_$E(DATE,9,14),1:"")
"RTN","GMRCHL7",80,0)
 Q X
"RTN","GMRCHL7",81,0)
ORC(GMRCIEN,GMRCTRL,ORCPLCR) ;Build the ORC segment of the HL-7 message
"RTN","GMRCHL7",82,0)
 ;GMRCTRL=Order Control Code (table 119)
"RTN","GMRCHL7",83,0)
 ;GMRCIEN=File 123 IEN
"RTN","GMRCHL7",84,0)
 ;ORPLCR=GMRCPLCR - the person entering the order
"RTN","GMRCHL7",85,0)
 K ORC
"RTN","GMRCHL7",86,0)
 N GMRCURG,ORCACT,ORCDT,ORCPRV,ORCDT,ORIEN,ORCSTS
"RTN","GMRCHL7",87,0)
 S ORCDT=$P(^GMR(123,GMRCIEN,0),"^",7),ORCPRV=$P(^GMR(123,GMRCIEN,0),"^",14),ORURG=$P(^(0),"^",9),ORURG=$S(ORURG]"":$P(^ORD(101,ORURG,0),"^",1),1:"") S:ORURG]"" ORURG=$P(ORURG," - ",2)
"RTN","GMRCHL7",88,0)
 S ORURG=$S(ORURG="EMERGENCY":"STAT",ORURG="NOW":"STAT",ORURG="OUTPATIENT":"ROUTINE",1:ORURG)
"RTN","GMRCHL7",89,0)
 S:ORURG="" GMRCURG="" I ORURG]"" S GMRCURG=$O(^ORD(101.42,"B",ORURG,0)),GMRCURG=$S(+GMRCURG:$P(^ORD(101.42,GMRCURG,0),"^",2),1:"")
"RTN","GMRCHL7",90,0)
 S ORCDT=$$HL7DT(ORCDT)
"RTN","GMRCHL7",91,0)
 S STS=$P(^GMR(123,GMRCIEN,0),"^",12)
"RTN","GMRCHL7",92,0)
 S ORCACT=$P($G(^ORD(100.01,+STS,0)),U,1) S:'$L(ORCACT) ORCACT="NO STATUS"
"RTN","GMRCHL7",93,0)
 S ORIEN=$P(^GMR(123,GMRCIEN,0),"^",3)
"RTN","GMRCHL7",94,0)
 S ORCSTS=$S(STS=1:"DC",STS=2:"CM",STS=5:"IP",STS=6:"SC",STS=9:"A",STS=12:"RP",STS=13:"CA",1:"IP")
"RTN","GMRCHL7",95,0)
 ;References to GMRCXMF refer to foreign facility sending of messages
"RTN","GMRCHL7",96,0)
 ;Need to work out details of when to use which ien: local or foreign processing
"RTN","GMRCHL7",97,0)
 I $D(GMRCXMF),$P(^GMR(123,GMRCIEN,0),"^",22) S GMRCOFN=GMRCIEN N GMRCIEN S GMRCIEN=$P(^(0),"^",22)
"RTN","GMRCHL7",98,0)
 S ORC="ORC|"_GMRCTRL_"|"_$S(ORIEN]"":ORIEN_";1^OR",1:"")_"|"_GMRCIEN_"^"_"GMRC"_"||"_ORCSTS_"||"_$S(GMRCURG]"":"^^^^^"_GMRCURG,1:"")_"|||"_ORCPLCR_"||"_ORCPRV_"|||"_ORCDT_"|^^^^"_ORCACT_"^99OTH"
"RTN","GMRCHL7",99,0)
 K GMRCURG,STS
"RTN","GMRCHL7",100,0)
 Q
"RTN","GMRCHL72")
0^33^B12738788
"RTN","GMRCHL72",1,0)
GMRCHL72 ;SLC/DCM - HL-7 formatting routine for consult information to be passed to OER, formates OBX and NTE segments ;5/20/98  14:20
"RTN","GMRCHL72",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCHL72",3,0)
OBX(GMRCIFN) ;Build the OBX segment of the HL-7 message
"RTN","GMRCHL72",4,0)
 ;GMRCIFN=GMRCIEN - the internal file # of the record from file 123
"RTN","GMRCHL72",5,0)
 S OBXSEGNO=0
"RTN","GMRCHL72",6,0)
 I ORCTRL'="RT",$D(^GMR(123,GMRCIFN,20,0)) S GMRCND=0,GMRCND1=0,OBXSEGNO=OBXSEGNO+1 D
"RTN","GMRCHL72",7,0)
 .S GMRCND=$O(^GMR(123,GMRCIFN,20,GMRCND)),OBX(OBXSEGNO)="OBX|"_OBXSEGNO_"|TX|2000.02^REASON FOR REQUEST^AS4||"_^GMR(123,GMRCIFN,20,GMRCND,0),GMRCND1=GMRCND1+1
"RTN","GMRCHL72",8,0)
 .F  S GMRCND=$O(^GMR(123,GMRCIFN,20,GMRCND)) Q:GMRCND=""  S OBX(OBXSEGNO,GMRCND1)=^GMR(123,GMRCIFN,20,GMRCND,0),GMRCND1=GMRCND1+1
"RTN","GMRCHL72",9,0)
 .Q
"RTN","GMRCHL72",10,0)
 I $D(^GMR(123,GMRCIFN,30)) S OBXSEGNO=OBXSEGNO+1,OBX(OBXSEGNO)="OBX|"_OBXSEGNO_"|TX|^PROVISIONAL DIAGNOSIS^||"_$G(^GMR(123,GMRCIFN,30))
"RTN","GMRCHL72",11,0)
 Q
"RTN","GMRCHL72",12,0)
 ;
"RTN","GMRCHL72",13,0)
NTE(GMRCFN,GMRCND,GMRCTRL) ;Build the NTE segment of the HL7 message
"RTN","GMRCHL72",14,0)
 ;GMRCND=GMRCOM, an array. GMRCND = flag that a comment exists.
"RTN","GMRCHL72",15,0)
 ;GMRCND(0)= DA = the internal entry in node 40: ^GMR(123,IEN,40,DA
"RTN","GMRCHL72",16,0)
 ;GMRCTRL=HL7 control code from table 119
"RTN","GMRCHL72",17,0)
 Q:'$D(GMRCND(0))  S ND=GMRCND(0)
"RTN","GMRCHL72",18,0)
 S ND2=1,NTE(ND2)="NTE|16|L|"
"RTN","GMRCHL72",19,0)
 I $S($P(^GMR(123,GMRCFN,40,ND,0),"^",2)=6:1,$P(^(0),"^",2)=20:1,$P(^(0),"^",2)=7:1,$P(^(0),"^",2)=5:1,GMRCTRL="XX":1,1:0) D
"RTN","GMRCHL72",20,0)
 .S ND1=0,ND1=$O(^GMR(123,GMRCFN,40,ND,1,ND1)) Q:ND1=""  S NTE(ND2)=NTE(ND2)_^GMR(123,GMRCFN,40,ND,1,ND1,0),ND2=ND2+1
"RTN","GMRCHL72",21,0)
 .F  S ND1=$O(^GMR(123,GMRCFN,40,ND,1,ND1)) Q:ND1=""  S NTE(ND2)=^GMR(123,GMRCFN,40,ND,1,ND1,0),ND2=ND2+1
"RTN","GMRCHL72",22,0)
 .Q
"RTN","GMRCHL72",23,0)
 I $P(NTE(1),"|",4)="",$S(GMRCTRL="OD":1,GMRCTRL="OC":1,1:0) S $P(NTE(1),"|",4)=$P(^GMR(123.1,$P(^GMR(123,GMRCFN,40,ND,0),"^",2),0),"^",1)_$S($P(^(0),"^",2)]"":" BY SERVICE",1:"")
"RTN","GMRCHL72",24,0)
 I $P(NTE(1),"|",4)="",GMRCTRL="XX" S $P(NTE(1),"|",4)=$P(^GMR(123.1,$P(^GMR(123,GMRCFN,40,ND,0),"^",2),0),"^",1)_" "_$S($P(^GMR(123,GMRCFN,40,ND,0),"^",6)]"":$P(^GMR(123.5,$P(^GMR(123,GMRCFN,40,ND,0),"^",6),0),"^",1),1:GMRCSSNM)
"RTN","GMRCHL72",25,0)
 K N,ND1,ND2
"RTN","GMRCHL72",26,0)
 Q
"RTN","GMRCHL72",27,0)
OBR(GMRCIEN,RESBY) ;Build the OBR segment of the HL-7 message
"RTN","GMRCHL72",28,0)
 ;GMRCIEN=IEN of the consult from file 123
"RTN","GMRCHL72",29,0)
 ;NOTIFY=Person who is notified when consult is ordered/completed
"RTN","GMRCHL72",30,0)
 ;RESBY=Person entering/interpreting result & signing report- GMRCPROV
"RTN","GMRCHL72",31,0)
 K OBR
"RTN","GMRCHL72",32,0)
 I +$P(^GMR(123,GMRCIEN,0),"^",5)'>0,$S($D(GMRCSSNM):1,+GMRCGRP("ROOT"):1,1:0) S $P(^(0),"^",5)=$S(+GMRCGRP("ROOT"):GMRCGRP("ROOT"),1:$O(^GMR(123.5,"B",GMRCSSNM,0)))
"RTN","GMRCHL72",33,0)
 S STS=$P(^GMR(123,GMRCIEN,0),"^",12),RESTATUS=$S(STS=1:"X",STS=2:"F",STS=5:"O",STS=6:"I",STS=8:"S",STS=9:"R",1:"X")
"RTN","GMRCHL72",34,0)
 S SERVID=$P(^GMR(123,GMRCIEN,0),"^",5),ORCDT=$P(^(0),"^",7),CONLOC=$P(^(0),"^",10) I CONLOC]"" S CONLOC=$S($P(^ORD(101,CONLOC,0),"^",1)["BEDSIDE":"B",$P(^(0),"^",1)["EMERGENCY":"E",1:"OC")
"RTN","GMRCHL72",35,0)
 S NOTIFY=$P(^GMR(123,GMRCIEN,0),"^",11),CONSVC=$S(+SERVID]"":$P($G(^GMR(123.5,+SERVID,0)),"^",1),1:"")
"RTN","GMRCHL72",36,0)
 S HL7DT=$$HL7DT^GMRCHL7(ORCDT)
"RTN","GMRCHL72",37,0)
 S OBR="OBR||||^^^"_SERVID_"^"_CONSVC_"^99CON|||"_HL7DT_"|||||||||||"_CONLOC_"|"_NOTIFY_"|||"_HL7DT_"|||"_RESTATUS_$S(RESBY]"":"|||||||"_RESBY,1:"")
"RTN","GMRCHL72",38,0)
 K STS,RESTATUS,SERVID,ORCDT,CONLOC,CONSVC,HL7DT
"RTN","GMRCHL72",39,0)
 Q
"RTN","GMRCHL7A")
0^34^B29368224
"RTN","GMRCHL7A",1,0)
GMRCHL7A ;SLC/DCM - Receive HL-7 Message from OERR and break it into its components and store it in File 123 ;8/31/98  14:36
"RTN","GMRCHL7A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCHL7A",3,0)
ULC(X) ;Translate lower case to upper case
"RTN","GMRCHL7A",4,0)
 S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMRCHL7A",5,0)
 Q X
"RTN","GMRCHL7A",6,0)
ORC(GMRCORC) ;Get fields from ORC segment and set into GMRC variables
"RTN","GMRCHL7A",7,0)
 ;GMRCTRLC=ORC control code from HL7 Table 119
"RTN","GMRCHL7A",8,0)
 ;GMRCURGI=priority/urgency     GMRCPLCR=who entered the order
"RTN","GMRCHL7A",9,0)
 ;GMRCORNP=provider             GMRCNATO=nature of order
"RTN","GMRCHL7A",10,0)
 ;GMRCAD=date of request        GMRCOCR=order request reason
"RTN","GMRCHL7A",11,0)
 ;GMRCORFN=oe/rr file number    GMRCO=file 123 IEN - if not a new order
"RTN","GMRCHL7A",12,0)
 ;GMRCS38=order status - taken from Table 38, HL7 standard
"RTN","GMRCHL7A",13,0)
 S GMRCTRLC=$P(GMRCORC,SEP1,2),GMRCORFN=$P(GMRCORC,SEP1,3),GMRCORFN=$P($P(GMRCORFN,SEP2,1),";",1),GMRCAPP=$P($P(GMRCORC,SEP1,3),SEP2,2)
"RTN","GMRCHL7A",14,0)
 S GMRCS38=$P(GMRCORC,SEP1,6),GMRCURGI=$P($P(GMRCORC,SEP1,8),SEP2,6),GMRCPLCR=$P(GMRCORC,SEP1,11),GMRCORNP=$P(GMRCORC,SEP1,13)
"RTN","GMRCHL7A",15,0)
 S GMRCURGI=$S(GMRCURGI="S":"STAT",GMRCURGI="R":"ROUTINE",GMRCURGI="ZT":"TODAY",GMRCURGI="Z24":"WITHIN 24 HOURS",GMRCURGI="Z48":"WITHIN 48 HOURS",GMRCURGI="Z72":"WITHIN 72 HOURS",1:GMRCURGI) D  S:$L(GMRCURGI) GMRCURGI="GMRCURGENCY - "_GMRCURGI
"RTN","GMRCHL7A",16,0)
 .I $E(GMRCURGI,1)="Z" S GMRCURGI=$S(GMRCURGI="ZW":"WITHIN 1 WEEK",GMRCURGI="ZM":"WITHIN 1 MONTH",GMRCURGI="ZN":"NEXT AVAILABLE",GMRCURGI="ZT":"TODAY",1:"")
"RTN","GMRCHL7A",17,0)
 .Q
"RTN","GMRCHL7A",18,0)
 I GMRCURGI]"" S GMRCURGI=$O(^ORD(101,"B",GMRCURGI,0))
"RTN","GMRCHL7A",19,0)
 S GMRCO=+$P($P(GMRCORC,SEP1,4),SEP2,1)
"RTN","GMRCHL7A",20,0)
 S GMRCODT=$P(GMRCORC,SEP1,16),GMRCAD=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",21,0)
 S GMRCOCR=$P(GMRCORC,SEP1,17),GMRCNATO=$P(GMRCOCR,SEP2,5)
"RTN","GMRCHL7A",22,0)
 K GMRCOCR
"RTN","GMRCHL7A",23,0)
 Q
"RTN","GMRCHL7A",24,0)
OBR(GMRCOBR) ;Get fields from OBR segment and set into GMRC variables
"RTN","GMRCHL7A",25,0)
 ;GMRCTYPE=GMRC consult or GMRC request    GMRCSS=To Service
"RTN","GMRCHL7A",26,0)
 ;GMRCPLI=place of consultation            GMRCODT=observation date/time
"RTN","GMRCHL7A",27,0)
 ;GMRCATN=person to alert (attention)      GMRCSTDT=status change date/time
"RTN","GMRCHL7A",28,0)
 ;GMRCS123=results status (table 123)         GMRCINTR=results interpreter
"RTN","GMRCHL7A",29,0)
 ;GMRCPRI=procedure from file ^ORD(101,    GMRCXMF=foreign consult service
"RTN","GMRCHL7A",30,0)
 ;                                          a flag that tells the HL7 routine that
"RTN","GMRCHL7A",31,0)
 ;                                          consults does not need to return ORDER ENTRY/RESULTS REPORTING a file
"RTN","GMRCHL7A",32,0)
 ;                                          IEN for file 123. See routine ^GMRCXMF
"RTN","GMRCHL7A",33,0)
 S GMRCPR=$P($P(GMRCOBR,SEP1,5),SEP2,6),GMRCTYPE=$S(GMRCPR="99PRO":"GMRCOR REQUEST",1:"GMRCOR CONSULT"),GMRCTYPE=$O(^ORD(101,"B",GMRCTYPE,0))
"RTN","GMRCHL7A",34,0)
 S GMRCSS=$S($D(GMRCXMF):$O(^GMR(123.5,"B",$P($P(GMRCOBR,SEP1,5),SEP2,5),0)),GMRCPR="99CON":$P($P(GMRCOBR,SEP1,5),SEP2,4),$D(GMRCSS):GMRCSS,1:"")
"RTN","GMRCHL7A",35,0)
 S GMRCPRI="" I GMRCPR["99PRO" S GMRCPRI=$P($P(GMRCOBR,SEP1,5),SEP2,5),GMRCPRI=$$ULC(GMRCPRI),GMRCPRI="GMRCR "_GMRCPRI,GMRCPRI=$O(^ORD(101,"B",GMRCPRI,"")),GMRCPRI=$S(+GMRCPRI:GMRCPRI_";ORD(101,",1:"") D
"RTN","GMRCHL7A",36,0)
 .S GMRCSS=$S($D(^ORD(101,+GMRCPRI,5))&(+GMRCPRI>0):+^(5),1:"")
"RTN","GMRCHL7A",37,0)
 .Q
"RTN","GMRCHL7A",38,0)
 S GMRCODT=$P(GMRCOBR,SEP1,7) I GMRCODT]"" S GMRCODT=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",39,0)
 S GMRCPLI=$P(GMRCOBR,SEP1,19) I GMRCPLI]"" S GMRCPLI="GMRCPLACE - "_$S(GMRCPLI="C":"ON CALL",GMRCPLI="B":"BEDSIDE",GMRCPLI="E":"EMERGENCY ROOM",1:GMRCPLI),GMRCPLI=$O(^ORD(101,"B",GMRCPLI,0))
"RTN","GMRCHL7A",40,0)
 S GMRCATN=$P(GMRCOBR,SEP1,20),GMRCSTDT=$P(GMRCOBR,SEP1,23),GMRCSTDT=$$FMDATE^GMRCHL7(GMRCSTDT)
"RTN","GMRCHL7A",41,0)
 S GMRCS123=$P(GMRCOBR,SEP1,26),GMRCINTR=$P(GMRCOBR,SEP1,33)
"RTN","GMRCHL7A",42,0)
 Q
"RTN","GMRCHL7A",43,0)
OBX(GMRCOBX) ;Get fields from OBX segment and set into GMRC variables
"RTN","GMRCHL7A",44,0)
 ;GMRCVTYP=Value type from table 123 - i.e. TX(text), ST(string data),etc.
"RTN","GMRCHL7A",45,0)
 ;GMRCOID=observation id identifying value in seg. 5
"RTN","GMRCHL7A",46,0)
 ;GMRCVAL=observation value coded by segment 3
"RTN","GMRCHL7A",47,0)
 ;GMRCPRDG=provisional diagnosis
"RTN","GMRCHL7A",48,0)
 S GMRCMSG=MSG(GMRCOBX)
"RTN","GMRCHL7A",49,0)
 S GMRCVTYP=$P(GMRCMSG,SEP1,3),GMRCOID=$P($P(GMRCMSG,SEP1,4),SEP2,2),GMRCVAL=$P(GMRCOID,SEP2,3)
"RTN","GMRCHL7A",50,0)
 I GMRCOID="REASON FOR REQUEST" D
"RTN","GMRCHL7A",51,0)
 .S GMRCSUB=$P(GMRCMSG,SEP1,5),GMRCRFQ(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",52,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,LN)) Q:LN=""  S GMRCRFQ(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",53,0)
 .Q
"RTN","GMRCHL7A",54,0)
 I GMRCOID="PROVISIONAL DIAGNOSIS" S GMRCPRDG=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",55,0)
 I GMRCOID["COMMENT" D
"RTN","GMRCHL7A",56,0)
 .S GMRCSUB=$P(GMRCMSG,SEP1,5),GMRCCMT(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",57,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,NL)) Q:LN=""  S GMRCCMT(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",58,0)
 .Q
"RTN","GMRCHL7A",59,0)
 K LN
"RTN","GMRCHL7A",60,0)
 Q
"RTN","GMRCHL7A",61,0)
EN(MSG) ;Entry point to routine
"RTN","GMRCHL7A",62,0)
 ;MSG = local array which contains the HL-7 segments
"RTN","GMRCHL7A",63,0)
 ;GMRCSEND=sending application   GMRCFAC=sending facility
"RTN","GMRCHL7A",64,0)
 ;GMRCMTP=message type
"RTN","GMRCHL7A",65,0)
 ;M XQORMS=MSG  ;DEBUGGING AID CAN BE REMOVED BEFORE RELEASE
"RTN","GMRCHL7A",66,0)
 N DFN,GMRCACT,GMRCADD,GMRCFAC,GMRCMTP,GMRCPNM,GMRCO,GMRCOCR,GMRCORNP,GMRCORFN,GMRCPLCR,GMRCRB,GMRCSEND,GMRCSTS,GMRCTRLC,GMRCWARD,ORIFN,GMRCTRLC,GMRCAD,ORC
"RTN","GMRCHL7A",67,0)
 S GMRCMSG="",GMRCNOD=0 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) I $E(GMRCMSG,1,3)="MSH" D INIT^GMRCHL7U(GMRCMSG) D  Q
"RTN","GMRCHL7A",68,0)
 .S GMRCSEND=$P(GMRCMSG,SEP1,3),GMRCFAC=$P(GMRCMSG,SEP1,4),GMRCMTP=$P(GMRCMSG,SEP1,9)
"RTN","GMRCHL7A",69,0)
 .Q
"RTN","GMRCHL7A",70,0)
 S GMRCMSG="",GMRCNOD=0
"RTN","GMRCHL7A",71,0)
 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) D
"RTN","GMRCHL7A",72,0)
 .I $E(GMRCMSG,1,3)="PID" D PID^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",73,0)
 .I $E(GMRCMSG,1,3)="PV1" D PV1^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",74,0)
 .I $E(GMRCMSG,1,3)="ORC" D ORC(GMRCMSG)
"RTN","GMRCHL7A",75,0)
 .I $E(GMRCMSG,1,3)="OBR" D OBR(GMRCMSG) Q
"RTN","GMRCHL7A",76,0)
 .I $E(GMRCMSG,1,3)="OBX" D OBX(GMRCNOD) Q
"RTN","GMRCHL7A",77,0)
 .I $E(GMRCMSG,1,3)="NTE" D NTE^GMRCHL7U(.MSG,GMRCNOD,GMRCO,GMRCTRLC) Q
"RTN","GMRCHL7A",78,0)
 .I $E(GMRCMSG,1,3)="ZXX" S GMRCOFN=+$P(GMRCMSG,SEP1,2) K GMG(GMRCNOD) Q
"RTN","GMRCHL7A",79,0)
 .Q
"RTN","GMRCHL7A",80,0)
 ;Note, ZXX is not used yet; planned for future sharing consults with foreign facilities.
"RTN","GMRCHL7A",81,0)
 I '$D(GMRCTRLC) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",82,0)
 I GMRCTRLC="Z@" D CPRSPURG^GMRCPURG(+GMRCO),EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",83,0)
 I GMRCTRLC="NW" D NEW^GMRCHL7B D:'$D(GMRCXMF) RETURN^GMRCHL7U(GMRCO,GMRCTRLC) I $D(GMRCXMF) D
"RTN","GMRCHL7A",84,0)
 .;Set GMRCO=to the file number at this site for a new consult/request before sending HL-7 message to ORDER ENTRY/RESULTS REPORTING
"RTN","GMRCHL7A",85,0)
 .S GMRCNOD=0 F  S GMRCNOD=$O(@GMRCMSG(ND)) Q:GMRCNOD=""  I $P(@(GMRCMSG(NOD)),"|",1)="ORC" S $P(@(GMRCMSG(GMRCNOD)),"|",3)=$G(GMRCO) Q
"RTN","GMRCHL7A",86,0)
 .Q
"RTN","GMRCHL7A",87,0)
 I '$D(GMRCO) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",88,0)
 I $S(GMRCTRLC="CA":1,GMRCTRLC="DC":1,1:0) D DC^GMRCHL7B(GMRCO,GMRCTRLC),RETURN^GMRCHL7U(GMRCO,GMRCTRLC)
"RTN","GMRCHL7A",89,0)
 I GMRCTRLC="NA" D RTN(GMRCORFN,GMRCO)
"RTN","GMRCHL7A",90,0)
 I GMRCTRLC="XX" D MODIFY^GMRCHL7B ;Not currently returned by ORDER ENTRY/RESULTS REPORTING
"RTN","GMRCHL7A",91,0)
 ; If consults sends an XX, ORDER ENTRY/RESULTS REPORTING returns an NA.
"RTN","GMRCHL7A",92,0)
 D EXIT^GMRCHL7U
"RTN","GMRCHL7A",93,0)
 Q
"RTN","GMRCHL7A",94,0)
RTN(GMRCORN,DA) ;Put ^OR(100, ien for order into ^GMR(123,
"RTN","GMRCHL7A",95,0)
 S DIE="^GMR(123,",DR=".03////^S X=GMRCORN"
"RTN","GMRCHL7A",96,0)
 L +^GMR(123,DA) D ^DIE L -^GMR(123,DA)
"RTN","GMRCHL7A",97,0)
 K DIE,DR
"RTN","GMRCHL7A",98,0)
 Q
"RTN","GMRCHL7B")
0^35^B10745880
"RTN","GMRCHL7B",1,0)
GMRCHL7B ;SLC/DCM - Process order parameters from ^GMRCHL7A and place data into ^GMR(123 global. ;5/20/98  14:20
"RTN","GMRCHL7B",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCHL7B",3,0)
NEW ;Add new order
"RTN","GMRCHL7B",4,0)
 ;GMRCO=^GMR(123,IFN, the new file number in file ^GMR(123,
"RTN","GMRCHL7B",5,0)
 ;GMRCORFN=OE/RR file number       GMRCWARD=ward patient is on
"RTN","GMRCHL7B",6,0)
 ;GMRCSS=service consult sent to   GMRCAD=date/time of request
"RTN","GMRCHL7B",7,0)
 ;GMRCPRI=procedure/request        GMRCURGI=urgency
"RTN","GMRCHL7B",8,0)
 ;GMRCATN=attention                GMRCSTS=oe/er status of consult
"RTN","GMRCHL7B",9,0)
 ;GMRCORNP=patient's provider      GMRCTYPE=request type (request or consult)
"RTN","GMRCHL7B",10,0)
 ;GMRCRFQ=reason for request array - word processing fields
"RTN","GMRCHL7B",11,0)
 S DIC="^GMR(123,",DIC(0)="L",X="""N""",DLAYGO=123 D ^DIC K DLAYGO Q:Y<1
"RTN","GMRCHL7B",12,0)
 S (DA,GMRCO)=+Y,GMRCSTS=5,GMRCA=1,DIE=DIC
"RTN","GMRCHL7B",13,0)
 L +^GMR(123,GMRCO)
"RTN","GMRCHL7B",14,0)
 S DR=".02////^S X=DFN;.03////^S X=GMRCORFN;.04////^S X=GMRCWARD;.05////^S X=GMRCFAC;.06////^S X=$G(GMRCOFN);1////^S X=GMRCSS;2////^S X=$G(GMRCWARD);3////^S X=GMRCAD;4////^S X=GMRCPRI;5////^S X=GMRCURGI"_$S(GMRCATN]"":";7////^S X=GMRCATN",1:"")
"RTN","GMRCHL7B",15,0)
 D ^DIE
"RTN","GMRCHL7B",16,0)
 S DR="6////^S X=GMRCPLI;8////^S X=GMRCSTS;9////^S X=GMRCA;10////^S X=GMRCORNP;13////^S X=GMRCTYPE"_$S($D(GMRCPRDG):";30////^S X=GMRCPRDG",1:"")
"RTN","GMRCHL7B",17,0)
 D ^DIE L -^GMR(123,GMRCO)
"RTN","GMRCHL7B",18,0)
 I $O(GMRCRFQ(0)) D REASON
"RTN","GMRCHL7B",19,0)
 S GMRCA=1 D AUDIT0^GMRCHL7U
"RTN","GMRCHL7B",20,0)
 I $D(GMRCXMF),$D(GMRCOFN) S $P(^GMR(123,GMRCO,0),"^",21)=GMRCOFN
"RTN","GMRCHL7B",21,0)
 I $D(GMRCACTN) S ORBADUZ(GMRCACTN)=""
"RTN","GMRCHL7B",22,0)
 D ALERT^GMRCHL7U(DFN,GMRCSS,GMRCPRI,GMRCO,GMRCURGI,"")
"RTN","GMRCHL7B",23,0)
 D PRNT^GMRCUTL1(GMRCSS,GMRCO) ;contains print audit update
"RTN","GMRCHL7B",24,0)
 D EXIT
"RTN","GMRCHL7B",25,0)
 Q
"RTN","GMRCHL7B",26,0)
DC(DA,ACTRL) ;Discontinue request from OERR
"RTN","GMRCHL7B",27,0)
 ;Denied request also gets this action. Deny request updates status to dc
"RTN","GMRCHL7B",28,0)
 ;DA=IEN of record in file ^GMR(123
"RTN","GMRCHL7B",29,0)
 ;ACTRL=GMRCCTRL=control code defining action -
"RTN","GMRCHL7B",30,0)
 ;         DC control code = action DC for discontinued
"RTN","GMRCHL7B",31,0)
 ;         CA control code = action DY for denied
"RTN","GMRCHL7B",32,0)
 ;Update the last action taken, order status, and processing activity
"RTN","GMRCHL7B",33,0)
 Q:'$L(DA)
"RTN","GMRCHL7B",34,0)
 S GMRCACT=$O(^GMR(123.1,"D",ACTRL,0))
"RTN","GMRCHL7B",35,0)
 S GMRCSTS=$P(^GMR(123.1,GMRCACT,0),"^",2)
"RTN","GMRCHL7B",36,0)
 S DIE="^GMR(123,",DA=+GMRCO
"RTN","GMRCHL7B",37,0)
 S DR="8////^S X=GMRCSTS;9////^S X=GMRCACT"
"RTN","GMRCHL7B",38,0)
 D ^DIE
"RTN","GMRCHL7B",39,0)
 D AUDIT0^GMRCHL7U
"RTN","GMRCHL7B",40,0)
 D EXIT Q
"RTN","GMRCHL7B",41,0)
MODIFY ;Change an order/request when an HL7 'XX' code is received
"RTN","GMRCHL7B",42,0)
 ;This is currently not used.
"RTN","GMRCHL7B",43,0)
 ;    When Consults sends an XX, CPRS returns NA with a new order ien.
"RTN","GMRCHL7B",44,0)
 ;GMRCACT=processing activity - from file ^GMR(123.1,
"RTN","GMRCHL7B",45,0)
 S DIE="^GMR(123,",DA=+GMRCO
"RTN","GMRCHL7B",46,0)
 S GMRCWARD=$G(GMRCWARD),GMRCPRI=$G(GMRCPRI),GMRCURGI=$G(GMRCURGI),GMRCSTS=$G(GMRCSTS),GMRCTYPE=$G(GMRCTYPE),GMRCSS=$G(GMRCSS)
"RTN","GMRCHL7B",47,0)
 S GMRCACT=$O(^GMR(123.1,"D",GMRCTRLC,0))
"RTN","GMRCHL7B",48,0)
 S GMRCSTS=$P(^GMR(123.1,GMRCACT,0),"^",2)
"RTN","GMRCHL7B",49,0)
 S DIE=123,DR=$S(GMRCWARD]"":".04////^S X=GMRCWARD;",1:"")_$S(GMRCSS]"":"1////^S X=GMRCSS;",1:"")_$S(GMRCURGI]"":"5////^S X=GMRCURGI;",1:"")_$S(GMRCSTS]"":"8////^S X=GMRCSTS;",1:"")_";9////^S X=GMRCACT"
"RTN","GMRCHL7B",50,0)
 D ^DIE
"RTN","GMRCHL7B",51,0)
 D AUDIT0^GMRCHL7U
"RTN","GMRCHL7B",52,0)
 D EXIT Q
"RTN","GMRCHL7B",53,0)
REASON ;load the reason for request into ^GMR(123,IFN,20
"RTN","GMRCHL7B",54,0)
 S ^GMR(123,GMRCO,20,0)="^^^"_$S($D(GMRCDA):GMRCDA,1:DT)_"^"
"RTN","GMRCHL7B",55,0)
 S L=0,LN=1 F  S L=$O(GMRCRFQ(L)) Q:L=""  S ^GMR(123,GMRCO,20,LN,0)=GMRCRFQ(L),LN=LN+1
"RTN","GMRCHL7B",56,0)
 S LN=LN-1,$P(^GMR(123,GMRCO,20,0),"^",3)=LN
"RTN","GMRCHL7B",57,0)
 K L,LN
"RTN","GMRCHL7B",58,0)
 Q
"RTN","GMRCHL7B",59,0)
COMMENT(GMRCARY) ;add comments to the record.  Add the comment header, then the comment lines, and lastly, the number of comment lines to the header
"RTN","GMRCHL7B",60,0)
 ;GMRCARY= GMRCNTC array
"RTN","GMRCHL7B",61,0)
 S LN=0,^GMR(123,GMRCO,40,DA,1,0)="^^^^"_$P(GMRCDA,".",1)_"^"
"RTN","GMRCHL7B",62,0)
 F  S LN=$O(GMRCARY(LN)) Q:LN=""  S ^GMR(123,+GMRCO,40,DA,1,LN,0)=GMRCARY(LN),LN1=LN
"RTN","GMRCHL7B",63,0)
 S $P(^GMR(123,+GMRCO,40,DA,1,0),"^",3,4)=LN1_"^"_LN1
"RTN","GMRCHL7B",64,0)
 K LN,LN1 Q
"RTN","GMRCHL7B",65,0)
 Q
"RTN","GMRCHL7B",66,0)
EXIT ;kill off all variables
"RTN","GMRCHL7B",67,0)
 K DA,DIC,DIE,DR
"RTN","GMRCHL7B",68,0)
 Q
"RTN","GMRCHL7U")
0^36^B19842862
"RTN","GMRCHL7U",1,0)
GMRCHL7U ;SLC/DCM - Utilities associated with HL7 messages ;5/20/98  14:20
"RTN","GMRCHL7U",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCHL7U",3,0)
INIT(MSH) ;break out MSH segment separaters and set other neeed variables
"RTN","GMRCHL7U",4,0)
 ;MSH = MSH segment of the HL-7 message
"RTN","GMRCHL7U",5,0)
 N X
"RTN","GMRCHL7U",6,0)
 S (SEP1,SEP2,SEP3,SEP4,SEP5)=""
"RTN","GMRCHL7U",7,0)
 S SEP1=$E(MSH,4),X=$P(MSH,SEP1,2)
"RTN","GMRCHL7U",8,0)
 S SEP2=$E(X,1),SEP3=$E(X,2),SEP4=$E(X,3),SEP5=$E(X,4)
"RTN","GMRCHL7U",9,0)
 Q
"RTN","GMRCHL7U",10,0)
PID(GMRCPID) ;Get fields from PID segment and set into GMRC variables.
"RTN","GMRCHL7U",11,0)
 S DFN=$P(GMRCPID,SEP1,4),GMRCPNM=$P(GMRCPID,SEP1,6)
"RTN","GMRCHL7U",12,0)
 Q
"RTN","GMRCHL7U",13,0)
NTE(MSG,GMRCNTE,GMRCNODE,CTRLCODE) ;set NTE segments of HL-7 message into variables and globals
"RTN","GMRCHL7U",14,0)
 ;MSG = whole HL-7 array.
"RTN","GMRCHL7U",15,0)
 ;GMRCNTE = Node in array where NTE message begins
"RTN","GMRCHL7U",16,0)
 ;CTRLCODE = segment 1 of the ORC segment of HL-7 message
"RTN","GMRCHL7U",17,0)
 ;GMRCNODE = IEN of entry int file ^GMR(123,
"RTN","GMRCHL7U",18,0)
 N GMRCACT ;not sure why this is newed here
"RTN","GMRCHL7U",19,0)
 S GMRCAD=$G(GMRCAD),GMRCORNP=$G(GMRCORNP),GMRCFF=$G(GMRCFF),GMRCPA=$G(GMRCPA),GMRCDEV=$G(GMRCDEV)
"RTN","GMRCHL7U",20,0)
 S GMRCACT=$S(CTRLCODE="CA":19,CTRLCODE="DC":6,CTRLCODE="NW":1,1:$O(^GMR(123.1,"D",CTRLCODE,0)))
"RTN","GMRCHL7U",21,0)
 S GMRCNTC(1)=$P(MSG(GMRCNTE),SEP1,4)
"RTN","GMRCHL7U",22,0)
 S LN=0,LN1=2 F  S LN=$O(MSG(GMRCNTE,LN)) Q:LN=""  S GMRCNTC(LN1)=MSG(GMRCNTE,LN),LN1=LN1+1
"RTN","GMRCHL7U",23,0)
 K LN,LN1
"RTN","GMRCHL7U",24,0)
 Q
"RTN","GMRCHL7U",25,0)
PV1(GMRCPV1) ;Get fields from PV1 segment of HL-7 message and set into GMRC variables
"RTN","GMRCHL7U",26,0)
 ;GMRCRB = patients room/bed            GMRCWARD=patients ward
"RTN","GMRCHL7U",27,0)
 N X
"RTN","GMRCHL7U",28,0)
 S X=$P(GMRCPV1,SEP1,3),ORSTS=$S(X]"":X,1:"")
"RTN","GMRCHL7U",29,0)
 S X=$P(GMRCPV1,SEP1,4),GMRCWARD=$S($P(X,SEP2,1)]"":$P(X,SEP2,1),1:""),VISIT=$S($P(GMRCPV1,SEP1,20)]"":$P(GMRCPV1,SEP1,20),1:"")
"RTN","GMRCHL7U",30,0)
 S GMRCRB=$S($P(X,SEP2,2)]"":$P(X,SEP2,2),1:"")
"RTN","GMRCHL7U",31,0)
 S:VISIT]"" GMRCVSIT=$$FMDATE^GMRCHL7(VISIT)
"RTN","GMRCHL7U",32,0)
 Q
"RTN","GMRCHL7U",33,0)
RETURN(GMRCIEN,GMRCTRLC) ;return IEN of record in ^GMR(123,IEN, to OERR
"RTN","GMRCHL7U",34,0)
 ;GMRCIEN = internal record number of record in ^GMR(123,
"RTN","GMRCHL7U",35,0)
 ;GMRCTRLC=Control code from HL-7 Table 119
"RTN","GMRCHL7U",36,0)
 N MSH,PID,ORC
"RTN","GMRCHL7U",37,0)
 S SEP1="|",GMRCORCC=$S(GMRCTRLC="NW":"OK",GMRCTRLC="DC":"DR",1:"OK")
"RTN","GMRCHL7U",38,0)
 S MSH=$$MSH^GMRCHL7($G(X)) S $P(MSH,SEP1,9)="ORR"
"RTN","GMRCHL7U",39,0)
 S PID=$$PID^GMRCHL7(GMRCIEN)
"RTN","GMRCHL7U",40,0)
 D ORC^GMRCHL7(GMRCIEN,GMRCORCC,"") S ORC=$P(ORC,"|",1,4)
"RTN","GMRCHL7U",41,0)
 D BLD^GMRCHL7(MSH,PID,"",ORC,"","","",GMRCTRLC)
"RTN","GMRCHL7U",42,0)
 D MSG^XQOR("GMRC EVSEND OR",.GMRCMSG)
"RTN","GMRCHL7U",43,0)
 K GMRCORCC
"RTN","GMRCHL7U",44,0)
 Q
"RTN","GMRCHL7U",45,0)
FILE(GMRCO,DR) ;File data into ^GMR(123,IEN,40 using ^DIE
"RTN","GMRCHL7U",46,0)
 N DIE,DA
"RTN","GMRCHL7U",47,0)
 ;GMRCO = IEN of record from file ^GMR(123,
"RTN","GMRCHL7U",48,0)
 ;DR = DR string required by ^DIE
"RTN","GMRCHL7U",49,0)
 L +^GMR(123,+GMRCO,40) S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^"
"RTN","GMRCHL7U",50,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1),DA(1)=+GMRCO
"RTN","GMRCHL7U",51,0)
 S DIE="^GMR(123,"_GMRCO_",40,"
"RTN","GMRCHL7U",52,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCHL7U",53,0)
 D ^DIE
"RTN","GMRCHL7U",54,0)
 I $D(GMRCNTC) D COMMENT^GMRCHL7B(.GMRCNTC)
"RTN","GMRCHL7U",55,0)
 I $D(GMRCCMT) D COMMENT^GMRCHL7B(.GMRCCMT)
"RTN","GMRCHL7U",56,0)
 L -^GMR(123,+GMRCO,40)
"RTN","GMRCHL7U",57,0)
 Q
"RTN","GMRCHL7U",58,0)
EXIT ;Kill variables and exit
"RTN","GMRCHL7U",59,0)
 K HLQ,J,LN,ND,ND1,ND2,SEP1,SEP2,SEP3,SEP4,SEP5
"RTN","GMRCHL7U",60,0)
 K GMRCA,GMRCACT,GMRCAD,GMRCAP,GMRCAPP,GMRCATN,GMRCDA,GMRCDEV,GMRCFAC,GMRCFF,GMRCINTR,GMRCMTP,GMRCMSG,GMRCMSH,GMRCNOD,GMRCNTC,GMRCODT,GMRCOID,GMRCORFN,GMRCPA,GMRCPLCR,GMRCPLI,GMRCPNM,GMRCPR,GMRCPRI,GMRCFQ
"RTN","GMRCHL7U",61,0)
 K GMRCPRDG,GMRCSEND,GMRCSTDT,GMRCSTS,GMRCSUB,GMRCURGI,GMRCVAL,GMRCVTYP,GMRCWARD,GMRCPRV,GMRCTYPE,GMRCND,GMRCND1,VISIT
"RTN","GMRCHL7U",62,0)
 K GMRCRB,GMRCPRA,GMRCRFQ,MSH,OBXND,PID,GMRCORPV
"RTN","GMRCHL7U",63,0)
 K:'$D(GMRCXMF) GMRCTRLC,GMRCSS,GMRCO,GMRCORNP
"RTN","GMRCHL7U",64,0)
 Q
"RTN","GMRCHL7U",65,0)
AUDIT0 ;place activity audit tracking info into global ^GMR(123,IEN,40,
"RTN","GMRCHL7U",66,0)
 ;GMRCACT=processing activity (from ^GMR(123.1,
"RTN","GMRCHL7U",67,0)
 ;GMRCDA=date/time file entered     GMRCAD=date/time activity took place
"RTN","GMRCHL7U",68,0)
 ;GMRCORNP=name of provider         GMRCFF=forwared from (if forwarded)
"RTN","GMRCHL7U",69,0)
 ;GMRCPA=provider previously assigned
"RTN","GMRCHL7U",70,0)
 ;GMRCDEV=device printed to        GMRCCMT=comment array from OBX segment
"RTN","GMRCHL7U",71,0)
 S X="NOW" D NOW^%DTC S GMRCDA=%
"RTN","GMRCHL7U",72,0)
 L +^GMR(123,+GMRCO,40) S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,+GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCHL7U",73,0)
 S GMRCAD=$S($D(GMRCAD):GMRCAD,1:GMRCDA),GMRCORNP=$G(GMRCORNP),GMRCFF=$G(GMRCFF),GMRCPA=$G(GMRCPA),GMRCDEV=$G(GMRCDEV),GMRCPLCR=$G(GMRCPLCR)
"RTN","GMRCHL7U",74,0)
 ;Use the Control code from CPRS in 123.1 to determine the action.
"RTN","GMRCHL7U",75,0)
 ;If action undefined, then use "ADDED COMMENT", entry 20.
"RTN","GMRCHL7U",76,0)
 S GMRCACT=$O(^GMR(123.1,"D",GMRCTRLC,0))
"RTN","GMRCHL7U",77,0)
 S:'GMRCACT GMRCACT=20
"RTN","GMRCHL7U",78,0)
 S DR=".01////^S X=GMRCDA;1////^S X=GMRCACT;2////^S X=GMRCAD"_$S(GMRCORNP]"":";3////^S X=GMRCORNP",1:"")_";4////^S X=GMRCPLCR"_$S(GMRCFF]"":";7////^S X=GMRCPA",1:"")_$S(GMRCPA]"":";8////^S X=GMRCPA",1:"")_$S(GMRCDEV]"":";8////^S X=GMRCDEV",1:"")
"RTN","GMRCHL7U",79,0)
 D FILE(GMRCO,DR)
"RTN","GMRCHL7U",80,0)
 L -^GMR(123,+GMRCO,40)
"RTN","GMRCHL7U",81,0)
 Q
"RTN","GMRCHL7U",82,0)
ALERT(GMRCDFN,GMRCSS,GMRCPR,GMRCFN,GMRCURG,GMRCORA) ;generate an alert when receiving a consult
"RTN","GMRCHL7U",83,0)
 ;GMRCDFN=patient DFN from file 2
"RTN","GMRCHL7U",84,0)
 ;GMRCSS=Service
"RTN","GMRCHL7U",85,0)
 ;GMRCPR=procedure being ordered
"RTN","GMRCHL7U",86,0)
 ;GMRCFN=File 123 IEN
"RTN","GMRCHL7U",87,0)
 ;GMRCURG=urgency of request from protocol file
"RTN","GMRCHL7U",88,0)
 ;ORBADUZ=array of those who receive alerts
"RTN","GMRCHL7U",89,0)
 ;GMRCORA=action to take on alert: 27 is for new alert
"RTN","GMRCHL7U",90,0)
 S GMRCSSNM=""
"RTN","GMRCHL7U",91,0)
 I +GMRCSS S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSS,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSS,0)),U,1))
"RTN","GMRCHL7U",92,0)
 S GMRCORTX="New consult "_GMRCSSNM_$S(+GMRCPR:" "_$P($G(^ORD(101,+GMRCPR,0)),"^",2)_" ",1:" ")_$S(+GMRCURG:"("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",1:"")
"RTN","GMRCHL7U",93,0)
 S:'$D(GMRCORA) GMRCORA=27 S:GMRCORA="" GMRCORA=27
"RTN","GMRCHL7U",94,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,GMRCFN,GMRCORA,"",1)
"RTN","GMRCHL7U",95,0)
 K ORBADUZ,GMRCORTX
"RTN","GMRCHL7U",96,0)
 Q
"RTN","GMRCMCP")
0^37^B10072711
"RTN","GMRCMCP",1,0)
GMRCMCP ;SLC/DLT - List Manager Format Routine To Collect Medicine Package Consults and format them for display by List Manager. ;5/20/98  14:20
"RTN","GMRCMCP",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCMCP",3,0)
EN ;;Main List Manager Entry Point To Medicine Package Interface
"RTN","GMRCMCP",4,0)
 S GMRCFL=1 K GMRCQUT,Y,GMRCOER
"RTN","GMRCMCP",5,0)
 I +$P($G(^GMR(123.9,1,0)),"^",2) D   Q:$D(GMRCQUT)
"RTN","GMRCMCP",6,0)
 .S DIC="^GMR(123.9,1,123,",DIC("P")=$P(^DD(123.9,2,0),"^",2),DIC("A")="SELECT Division/Site Medical Service: ",DIC(0)="AEMQZ",DA=2,DA(1)=.01
"RTN","GMRCMCP",7,0)
 .D ^DIC K DIC,DA I $S($D(DTOUT):1,$D(DUOUT):1,Y<1:1,1:0) S GMRCQUT=1 K GMRCFL,DIROUT,DTOUT,DUOUT Q
"RTN","GMRCMCP",8,0)
 .S (GMRCSS,GMRCSVCN)=$P(Y,"^",2),GMRCSSNM=$P(^GMR(123.5,GMRCSS,0),"^",1)
"RTN","GMRCMCP",9,0)
 .Q
"RTN","GMRCMCP",10,0)
 E  S GMRCSVCN=2,GMRCSSNM="MEDICINE",GMRCSS=$O(^GMR(123.5,"B",GMRCSSNM,"")) I 'GMRCSS D EXIT S GMRCQUT=1 Q
"RTN","GMRCMCP",11,0)
 S GMRCDG=GMRCSVCN D SERV1^GMRCASV
"RTN","GMRCMCP",12,0)
 S Y=$P(^GMR(123.5,GMRCSS,0),"^") I '$L(Y) S GMRCQUT=1 Q
"RTN","GMRCMCP",13,0)
 D SELPR^GMRCS I $D(GMRCQUT),GMRCQUT D EXIT Q
"RTN","GMRCMCP",14,0)
 S Y=$P($G(^GMR(123.5,GMRCSS,123)),"^",2) I '$L(Y) D EXIT S GMRCMSG=GMRCSSNM_" Has No Procedures Associated With It!! STOPPING..." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG S GMRCQUT=1 Q
"RTN","GMRCMCP",15,0)
 S GMRCPRNM=$E($P(^ORD(101,GMRCPR,0),"^",1),7,99),GMRCFLG=1
"RTN","GMRCMCP",16,0)
 I $D(GMRCFL1) Q
"RTN","GMRCMCP",17,0)
SP ;Select a patient
"RTN","GMRCMCP",18,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCMCP",19,0)
 D SP^GMRCSLM I $D(GMRCQUT) D EXIT Q
"RTN","GMRCMCP",20,0)
 I $D(GMRCPRNM) S GMRC=$O(^ORD(101,"B","GMRCR "_GMRCPRNM,0)),GMRCTYPE="GMRCOR REQUEST"
"RTN","GMRCMCP",21,0)
 E  I $D(GMRCPR) S GMRC=GMRCPR,GMRCTYPE="GMRCOR REQUEST"
"RTN","GMRCMCP",22,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCMCP",23,0)
 I $D(GMRC)=1!($D(GMRC)=11),+GMRC D
"RTN","GMRCMCP",24,0)
 .S GMRCVP=GMRC_";ORD(101,",GMRCNM=$S($D(^ORD(101,GMRC,0)):$P(^(0),"^",2),1:"")
"RTN","GMRCMCP",25,0)
 .Q
"RTN","GMRCMCP",26,0)
 I $D(GMRC)=1!($D(GMRC)=11),+GMRC D
"RTN","GMRCMCP",27,0)
 .S ^TMP("GMRCS",$J,GMRCSS)=GMRCSSNM
"RTN","GMRCMCP",28,0)
DT K GMRCQUT,GMRCQIT
"RTN","GMRCMCP",29,0)
 S %DT="AEP",%DT("A")="List From Start Date: ALL DATES// " D ^%DT I Y<1&(X="^") S GMRCQUT=1 D EXIT Q
"RTN","GMRCMCP",30,0)
 S GMRCDT1=$S(Y>1:$P(Y,"^",1),Y<0:"ALL",1:"") S:Y>0 Y=$P(Y,".",1) W:GMRCDT1="ALL" "ALL CONSULTS"
"RTN","GMRCMCP",31,0)
 S GMRCDT2=0 I GMRCDT1'="ALL" S %DT="AEP",%DT("A")="List To End Date: " F  D ^%DT S GMRCDT2=$S(Y<0:0,1:$P(Y,"^",1)) S:Y>0 Y=$P(Y,".",1) Q:Y>0  I Y<0&(X="^") D EXIT S GMRCQUT=1 Q
"RTN","GMRCMCP",32,0)
 Q:($D(GMRCQUT))
"RTN","GMRCMCP",33,0)
 D AD^GMRCSLM1
"RTN","GMRCMCP",34,0)
EXIT ;Kill off variables
"RTN","GMRCMCP",35,0)
 I $D(IOTM),$D(IOBM) S VALMBCK="R"
"RTN","GMRCMCP",36,0)
 K DOC,GMRCBM,GMRCDFNS,GMRCFL1,GMRCFL,GMRCFLG,GMRCQUIT,GMRCRB,GMRCSNM,GMRCSSS,GMRCSTCK,GMRCSVCP,GMRCTYPE,GMRCTM,GMRCTX,GMRCWD,GMRCDG
"RTN","GMRCMCP",37,0)
 Q
"RTN","GMRCMCP",38,0)
SPEN ;Entry point for List Manager to select only a patient, not dates or procedures
"RTN","GMRCMCP",39,0)
 S GMRCFL=1
"RTN","GMRCMCP",40,0)
 D SP
"RTN","GMRCMCP",41,0)
 D EXIT Q
"RTN","GMRCMCP",42,0)
 Q
"RTN","GMRCMCP",43,0)
ENP ;Entry point to select only a new procedure
"RTN","GMRCMCP",44,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCMCP",45,0)
 S GMRCFL1=1
"RTN","GMRCMCP",46,0)
 D EN G:'$D(GMRCPR) EXIT
"RTN","GMRCMCP",47,0)
 S (GMRCVP,GMRC)=GMRCPR_";ORD(101,",GMRCNM=$S($D(^ORD(101,GMRC,0)):$P(^(0),"^",2),1:"")
"RTN","GMRCMCP",48,0)
 D DT
"RTN","GMRCMCP",49,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCMCP",50,0)
 D EXIT
"RTN","GMRCMCP",51,0)
 Q
"RTN","GMRCMENU")
0^39^B412814
"RTN","GMRCMENU",1,0)
GMRCMENU ;SLC/DCM - Select List Manager menu for user characteristics ;5/20/98  14:20
"RTN","GMRCMENU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCMENU",3,0)
EN ;Find user access characteristics and set up variables for menu's
"RTN","GMRCMENU",4,0)
 ;to be displayed by XQORM
"RTN","GMRCMENU",5,0)
 ;GMRCACTM=protocol name of action menu for user
"RTN","GMRCMENU",6,0)
 ;^TMP("GMRC",$J,"CURRENT","MENU") is the hijack protocol
"RTN","GMRCMENU",7,0)
 D EN^GMRCACTM
"RTN","GMRCMENU",8,0)
 S ^TMP("GMRC",$J,"CURRENT","MENU")=$O(^ORD(101,"B",GMRCACTM,0))_";ORD(101,"
"RTN","GMRCMENU",9,0)
 S XQORM("HIJACK")=^TMP("GMRC",$J,"CURRENT","MENU"),XQORM(0)="3AD"
"RTN","GMRCMENU",10,0)
 S GMRCOPT=""
"RTN","GMRCMENU",11,0)
 Q
"RTN","GMRCMER")
0^40^B2240294
"RTN","GMRCMER",1,0)
GMRCMER ;SLC/DCM - Print Medicine Results in List Manager Format ;5/20/98  14:20
"RTN","GMRCMER",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCMER",3,0)
EN ; -- main entry point for GMRC ASSOCIATE RESULTS
"RTN","GMRCMER",4,0)
 D EN^VALM("GMRC ASSOCIATE RESULTS")
"RTN","GMRCMER",5,0)
 Q
"RTN","GMRCMER",6,0)
 ;
"RTN","GMRCMER",7,0)
HDR ; -- header code
"RTN","GMRCMER",8,0)
 S GMRCPRNM=$P(^GMR(123,GMRCO,0),"^",8) I GMRCPRNM]"" S GMRCPRNM="^"_$P(GMRCPRNM,";",2)_$P(GMRCPRNM,";",1)_",0)",GMRCPRNM=$P(@(GMRCPRNM),"^",2)
"RTN","GMRCMER",9,0)
 S VALMHDR(1)=GMRCPNM_"     "_GMRCSSN_"          "_GMRCPRNM_" Summary Report"
"RTN","GMRCMER",10,0)
 Q
"RTN","GMRCMER",11,0)
 ;
"RTN","GMRCMER",12,0)
INIT ; -- init variables and list array
"RTN","GMRCMER",13,0)
 K ^TMP("GMRCR",$J,"DTLIST")
"RTN","GMRCMER",14,0)
 S DSPLINE=0,VARMAR="^TMP(""GMRCR"",$J,""DTLIST"")"
"RTN","GMRCMER",15,0)
 F LINE=1:1:GMRCCT S DSPLINE=$O(^TMP("GMRCR",$J,"DT",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCMER",16,0)
 S VALMCNT=LINE-1
"RTN","GMRCMER",17,0)
 K DSPLINE,DATA,LINE
"RTN","GMRCMER",18,0)
 Q
"RTN","GMRCMER",19,0)
 ;
"RTN","GMRCMER",20,0)
HELP ; -- help code
"RTN","GMRCMER",21,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCMER",22,0)
 Q
"RTN","GMRCMER",23,0)
 ;
"RTN","GMRCMER",24,0)
EXIT ; -- exit code
"RTN","GMRCMER",25,0)
 K ^TMP("GMRCR",$J,"DT")
"RTN","GMRCMER",26,0)
 S:$D(GMRCLCT) VALMCNT=GMRCLCT
"RTN","GMRCMER",27,0)
 K GMRCLCT
"RTN","GMRCMER",28,0)
 Q
"RTN","GMRCMER",29,0)
 ;
"RTN","GMRCMER",30,0)
EXPND ; -- expand code
"RTN","GMRCMER",31,0)
 Q
"RTN","GMRCMER",32,0)
 ;
"RTN","GMRCMP")
0^41^B4744488
"RTN","GMRCMP",1,0)
GMRCMP ;SLC/DCM - List Manager routine: Medical Service and sub-specialty consults ;5/20/98  14:20
"RTN","GMRCMP",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCMP",3,0)
EN ; -- main entry point for GMRC TRK MEDICINE CONSULTS
"RTN","GMRCMP",4,0)
 K GMRCQUT
"RTN","GMRCMP",5,0)
 D EN^GMRCMCP I $D(GMRCQUT) D EXIT Q
"RTN","GMRCMP",6,0)
 D EN^VALM("GMRC TRK MEDICINE CONSULTS")
"RTN","GMRCMP",7,0)
 D EXIT
"RTN","GMRCMP",8,0)
 Q
"RTN","GMRCMP",9,0)
 ;
"RTN","GMRCMP",10,0)
HDR ; -- header code
"RTN","GMRCMP",11,0)
 D HDR^GMRCSLM
"RTN","GMRCMP",12,0)
 Q
"RTN","GMRCMP",13,0)
 ;
"RTN","GMRCMP",14,0)
INIT ; -- init variables and list array
"RTN","GMRCMP",15,0)
 D KILL^VALM10(),CLEAR^VALM1
"RTN","GMRCMP",16,0)
 K ^TMP("GMRCR",$J,"LIST")
"RTN","GMRCMP",17,0)
 S DSPLINE=0,VALMAR="^TMP(""GMRCR"",$J,""LIST"")"
"RTN","GMRCMP",18,0)
 S GMRCSN=$P(^DPT(DFN,0),"^",9),GMRCSSN=$E(GMRCSN,1,3)_"-"_$E(GMRCSN,4,5)_"-"_$E(GMRCSN,6,9)
"RTN","GMRCMP",19,0)
 F LINE=1:1:LNCT S DSPLINE=$O(^TMP("GMRCR",$J,"CS",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCMP",20,0)
 S VALMCNT=LNCT,VALMPGE=1,XQORM("A")="Select Action: "
"RTN","GMRCMP",21,0)
 K DATA,DSPLINE,LINE
"RTN","GMRCMP",22,0)
 Q
"RTN","GMRCMP",23,0)
 ;
"RTN","GMRCMP",24,0)
HELP ; -- help code
"RTN","GMRCMP",25,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCMP",26,0)
 Q
"RTN","GMRCMP",27,0)
 ;
"RTN","GMRCMP",28,0)
EXIT ; -- exit code
"RTN","GMRCMP",29,0)
 K DFN,BLK,CDT,GMRC,GMRCDT1,GMRCDT2,GMRCAGE,GMRCDT1,GMRCDT2,GMRCND,GMRCNO,GMRCPTN,GMRCDOB,GMRCNM,GMRCNM,GMRCPNM,GMRCPRNM,GMRCSEX,GMRCSN,GMRCSSN,GMRCSSNM,LNCT,SEX,TAB
"RTN","GMRCMP",30,0)
 K GMRCDT,GMRCSA,GMRCSVCN,GMRCVP,GMRCFL,GMRCWT,GMRCWRD,GMRCVP,GMRCTM,GMRCBM,GMRCFL,GMRCSS,GMRCFLG,GMRCPR,GMRCRB,GMRCTYPE,GMRCWARD,GMRCNM,GMRCSS,GMRCSSNM,GMRCSVCN,GMRCWARD,GMRCWRD
"RTN","GMRCMP",31,0)
 K GMRCACTM,GMRCSTCK,GMRCOER
"RTN","GMRCMP",32,0)
 Q
"RTN","GMRCMP",33,0)
 ;
"RTN","GMRCMP",34,0)
EXPND ; -- expand code
"RTN","GMRCMP",35,0)
 Q
"RTN","GMRCMP",36,0)
 ;
"RTN","GMRCMSS")
0^42^B2221889
"RTN","GMRCMSS",1,0)
GMRCMSS ;SLC/DLT,DCM - Setup Request Services ;5/20/98  14:20
"RTN","GMRCMSS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCMSS",3,0)
EN ;entry to setup service
"RTN","GMRCMSS",4,0)
 S DIC="^GMR(123.5,",DIC(0)="AELMQZ",DIC("A")="Select Service/Specialty: ",DLAYGO=123.5,GMRCFLG=0 F  D ^DIC Q:Y<1  D EDIT S DIC(0)="AELMQZ"
"RTN","GMRCMSS",5,0)
 I GMRCFLG,$P(^GMR(123.5,1,10,0),"^",4)>30 W !,"<REINDEXING>  One Moment Please..." D
"RTN","GMRCMSS",6,0)
 .S DIK="^GMR(123.5,",DIK(1)=".01^B",DA=1,DA(1)=10 D IX^DIK
"RTN","GMRCMSS",7,0)
 .Q
"RTN","GMRCMSS",8,0)
 D END Q
"RTN","GMRCMSS",9,0)
EDIT S (DA,GMRCS)=+Y,GMRCS(0)=Y(0,0) I $D(^GMR(123,+Y,123)) S GMRCS(123)=^GMR(123,+Y,123)
"RTN","GMRCMSS",10,0)
 S DIE=DIC S DR="[GMRC SETUP REQUEST SERVICE]" D ^DIE K DIE W !
"RTN","GMRCMSS",11,0)
 Q:$O(^GMR(123.5,1,10,"B",GMRCS,0))
"RTN","GMRCMSS",12,0)
 S GMRCMN=$G(^GMR(123.5,GMRCS,2,1,0)),GMRCFLG=1
"RTN","GMRCMSS",13,0)
 S DIE="^GMR(123.5,1,10,",DA=GMRCS,DA(1)=GMRCS,DR=".01////"_GMRCS_";2////"_GMRCMN D ^DIE K DIE,DA,DR
"RTN","GMRCMSS",14,0)
 Q
"RTN","GMRCMSS",15,0)
END K DA,DIC,DIE,DIK,DLAYGO,GMRCFLG,GMRCS,GMRCMN,DR,Y
"RTN","GMRCMSS",16,0)
 Q
"RTN","GMRCMU")
0^43^B1149949
"RTN","GMRCMU",1,0)
GMRCMU ;SLC/DLT - Add protocols to GMRC protocol menus ;5/20/98  14:20
"RTN","GMRCMU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCMU",3,0)
GMRCR ;Check if protocol is already an entry in GMRCR REQUEST TYPES, add if not.
"RTN","GMRCMU",4,0)
 K DIC S DA(1)=$O(^ORD(101,"B","GMRCRM REQUEST TYPES",0)) G:'DA(1) END
"RTN","GMRCMU",5,0)
 I $D(^ORD(101,DA(1),10,"B",GMRCPROI)) G END
"RTN","GMRCMU",6,0)
 W !!,"Filing ",GMRCPRO," as an item in GMRCR REQUEST TYPES Protocol Menu"
"RTN","GMRCMU",7,0)
 W !,"    enabling use of this item when ""Procedure..."" is selected on Add menus"
"RTN","GMRCMU",8,0)
 S SEQ=$P(^ORD(101,DA(1),10,0),"^",3)+1
"RTN","GMRCMU",9,0)
 S DIC="^ORD(101,"_DA(1)_",10,",DIC(0)="L"
"RTN","GMRCMU",10,0)
 S DLAYGO=101,X=GMRCPRO D ^DIC
"RTN","GMRCMU",11,0)
 W !!?6,"< Protocol filed. >",! G END
"RTN","GMRCMU",12,0)
END K DA,DLAYGO,DIC,X,SEQ,SYN Q
"RTN","GMRCNTEG")
1^44
"RTN","GMRCP")
0^45^B8176663
"RTN","GMRCP",1,0)
GMRCP ;SLC/DLT,DCM - Process OE/RR actions ;5/20/98  14:20
"RTN","GMRCP",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCP",3,0)
 ;Processing action on Generic Requests/Consults from OE/RR
"RTN","GMRCP",4,0)
MSG(GMRCDFN,GMRCALRM,GMRCIFN,ORN,ORBADUZ,FLG) ;send alert notification information to OERR for notification or update
"RTN","GMRCP",5,0)
 ;GMRCDFN=patient's DFN           GMRCORFN=OR file # ^OR(100,GMRCORFN
"RTN","GMRCP",6,0)
 ;GMRCALRM=alert message to be displayed with alert
"RTN","GMRCP",7,0)
 ;GMRCIFN=internal file number of consult in file 123
"RTN","GMRCP",8,0)
 ;ORBADUZ=set in call to EN^GMRCT=array of providers who will be alerted
"RTN","GMRCP",9,0)
 ;FLG=1 if need to get list of providers, 0 if ORBADUZ is passed in.
"RTN","GMRCP",10,0)
 ;ORN=IFN from file ^ORD(100.9, for consult notification action
"RTN","GMRCP",11,0)
 N GMRCSS,GMRCORFN
"RTN","GMRCP",12,0)
 S GMRCORFN=$P(^GMR(123,GMRCIFN,0),"^",3)
"RTN","GMRCP",13,0)
 S GMRCSS=$P($G(^GMR(123,+GMRCIFN,0)),"^",5) I FLG,GMRCSS D EN^GMRCT(GMRCSS)
"RTN","GMRCP",14,0)
 I FLG,$P(^GMR(123,+GMRCIFN,0),"^",11) S ORBADUZ($P(^(0),"^",11))=""
"RTN","GMRCP",15,0)
 Q:'$O(ORBADUZ(0))
"RTN","GMRCP",16,0)
 D EN^ORB3(ORN,GMRCDFN,GMRCORFN,.ORBADUZ,GMRCALRM,GMRCIFN)
"RTN","GMRCP",17,0)
 Q
"RTN","GMRCP",18,0)
AUDIT ;Build processing activity audit trail multiple.
"RTN","GMRCP",19,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCP",20,0)
AUDIT0 L +^GMR(123,+GMRCO,40):5 I '$T S GMRCUT=1,GMRCERR=1,GMRCERMS="Activity Trail Not filed - Consult In Use By Another User." L -^GMR(123,+GMRCO,40)  Q
"RTN","GMRCP",21,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^"
"RTN","GMRCP",22,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCP",23,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCP",24,0)
 S GMRCORNP=$G(GMRCORNP) S:'$D(GMRCOM) GMRCOM=0
"RTN","GMRCP",25,0)
 S GMRCDEV=$G(GMRCDEV),GMRCFF=$G(GMRCFF),GMRCPA=$G(GMRCPA),GMRCAD=$S('$D(GMRCAD):GMRCDT,1:GMRCAD)
"RTN","GMRCP",26,0)
 S DIE="^GMR(123,"_+GMRCO_",40,",DA(1)=+GMRCO,DR=".01////^S X=GMRCDT;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=GMRCORNP;4////^S X=DUZ;6////^S X=GMRCFF;7////^S X=GMRCPA;8////^S X=GMRCDEV"
"RTN","GMRCP",27,0)
 D ^DIE
"RTN","GMRCP",28,0)
 I +$G(GMRCOM) S GMRCOM(0)=DA D
"RTN","GMRCP",29,0)
 .W !,"Enter COMMENT:" H 2
"RTN","GMRCP",30,0)
 .N DIC S DIC=DIE_DA_",1,",DWPK=1,DWLW=74
"RTN","GMRCP",31,0)
 .S DIWESUB="COMMENTS" D EN^DIWE
"RTN","GMRCP",32,0)
 .I $P($G(^GMR(123.1,+$P(^GMR(123,+GMRCO,40,DA,0),U,2),0)),U)="ADDED COMMENT",'$O(^GMR(123,+GMRCO,40,DA,0)) D  Q
"RTN","GMRCP",33,0)
 ..S DA(1)=+GMRCO,DIK="^GMR(123,"_DA(1)_",40," D ^DIK K DIK
"RTN","GMRCP",34,0)
 ..Q
"RTN","GMRCP",35,0)
 .I $D(^GMR(123,+GMRCO,40,DA,0)),$O(^GMR(123,+GMRCO,40,DA,0)) S $P(GMRCOM,"^",2)=1
"RTN","GMRCP",36,0)
 .Q
"RTN","GMRCP",37,0)
 L -^GMR(123,+GMRCO,40)
"RTN","GMRCP",38,0)
 K DIE,DA,DR,GMRCDEV,GMRCFF,GMRCPA,X,% Q
"RTN","GMRCP",39,0)
STATUS ;Update the status for the Request/Consultation File
"RTN","GMRCP",40,0)
 K GMRCQUT
"RTN","GMRCP",41,0)
 Q:'$D(GMRCSTS)!('$D(GMRCA))
"RTN","GMRCP",42,0)
 S DIE=123,DA=+GMRCO
"RTN","GMRCP",43,0)
 I $D(GMRCDR),$L(GMRCDR) S DR=GMRCDR
"RTN","GMRCP",44,0)
 E  S DR="8////^S X=GMRCSTS;9////^S X=GMRCA"
"RTN","GMRCP",45,0)
 L +^GMR(123,GMRCO):2 I '$T S GMRCQUT=1,GMRCERR=1,GMRCERMS="Unable to update status and last action - Consult In Use By Another User." Q
"RTN","GMRCP",46,0)
 D ^DIE
"RTN","GMRCP",47,0)
 L -^GMR(123,+GMRCO)
"RTN","GMRCP",48,0)
 K DIE,DA,DR,GMRCDR
"RTN","GMRCP",49,0)
 Q
"RTN","GMRCP513")
0^48^B70113
"RTN","GMRCP513",1,0)
GMRCP513 ;SLC/DCM - Print Consult Form 513 ;9/14/98  13:03
"RTN","GMRCP513",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCP513",3,0)
 ;
"RTN","GMRCP513",4,0)
 ;  This routine is to be replaced by GMRCP5 which is available
"RTN","GMRCP513",5,0)
 ;   in patch GMRC*3*4
"RTN","GMRCP513",6,0)
 ;
"RTN","GMRCP513",7,0)
TIUEN(GMRCIEN) ;Entry point for TIU to print 513
"RTN","GMRCP513",8,0)
SEL ;Select the consult/request to print
"RTN","GMRCP513",9,0)
FTR ;Footer of form 513
"RTN","GMRCP513",10,0)
FTR1 ;
"RTN","GMRCP513",11,0)
FILL ;Add lines to the end of the page before printing footer
"RTN","GMRCP513",12,0)
EN(GMRCIFN) ;Entry point into routine -GMRCIFN=IFN from file 123
"RTN","GMRCP513",13,0)
EN1 ;
"RTN","GMRCP513",14,0)
PRNT(GMRCIFN) ;^TMP("GMRCR",$J,"RES") holds results.
"RTN","GMRCP513",15,0)
EXIT ;Kill off variables set in this routine
"RTN","GMRCP513",16,0)
 ;
"RTN","GMRCPC")
0^50^B2519908
"RTN","GMRCPC",1,0)
GMRCPC ;SLC/DCM - List Manager Routine: Collect and display pending consults by service only - ALL SERVICES not accepted ;5/20/98  14:20
"RTN","GMRCPC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPC",3,0)
EN ;;SLC/DCM; GMRC List Manager Routine -- main entry point for GMRC PENDING CONSULTS
"RTN","GMRCPC",4,0)
 I $D(GMRCEACT),$L(GMRCEACT) S GMRCSVCP=GMRCEACT,GMRCSVC=$O(^GMR(123.5,"B",GMRCSVCP,0))
"RTN","GMRCPC",5,0)
 I $S('$D(GMRCEACT):1,'$L(GMRCEACT):1,'$L(GMRCSVC):1,1:0) D EN^GMRCSTLM I $D(GMRCQUT) D EXIT Q
"RTN","GMRCPC",6,0)
 D EN^VALM("GMRC PENDING CONSULTS")
"RTN","GMRCPC",7,0)
 ;
"RTN","GMRCPC",8,0)
HDR ; -- header code
"RTN","GMRCPC",9,0)
 Q:$D(GMRCQUT)!'$D(GMRCCT)
"RTN","GMRCPC",10,0)
 S VALMHDR(1)="SERVICE CONSULTS PENDING RESOLUTION"
"RTN","GMRCPC",11,0)
 S VALMHDR(2)="To Service:  "_GMRCSVCP
"RTN","GMRCPC",12,0)
 Q
"RTN","GMRCPC",13,0)
 ;
"RTN","GMRCPC",14,0)
INIT ; -- init variables and list array
"RTN","GMRCPC",15,0)
 K ^TMP("GMRCR",$J,"LIST")
"RTN","GMRCPC",16,0)
 S DSPLINE=0,VALMAR="^TMP(""GMRCR"",$J,""LIST"")"
"RTN","GMRCPC",17,0)
 F LINE=1:1:GMRCCT S DSPLINE=$O(^TMP("GMRCR",$J,"CP",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCPC",18,0)
 S VALMCNT=GMRCCT,VALMBCK="R"
"RTN","GMRCPC",19,0)
 K DATA,LINE,DSPLINE
"RTN","GMRCPC",20,0)
 Q
"RTN","GMRCPC",21,0)
 ;
"RTN","GMRCPC",22,0)
HELP ; -- help code
"RTN","GMRCPC",23,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCPC",24,0)
 Q
"RTN","GMRCPC",25,0)
 ;
"RTN","GMRCPC",26,0)
EXIT ; -- exit code
"RTN","GMRCPC",27,0)
 K CNT,CTRLCOL,GMRCCT,GMRCQUT,GMRCSVC,GMRCSVCP,VALMHDR
"RTN","GMRCPC",28,0)
 Q
"RTN","GMRCPC",29,0)
 ;
"RTN","GMRCPC",30,0)
EXPND ; -- expand code
"RTN","GMRCPC",31,0)
 Q
"RTN","GMRCPC",32,0)
 ;
"RTN","GMRCPH")
0^51^B6032429
"RTN","GMRCPH",1,0)
GMRCPH ;SLC/DLT - Process XQORM HELPS ;5/20/98  14:20
"RTN","GMRCPH",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPH",3,0)
URGHELP ;Process help for Urgency prompt when adding consults/requests
"RTN","GMRCPH",4,0)
 W !!,"Select one of the urgencies below to indicate how soon the results are needed"
"RTN","GMRCPH",5,0)
 D DISP^XQORM1 W !!
"RTN","GMRCPH",6,0)
 Q
"RTN","GMRCPH",7,0)
PLHELP ;Process help for Place of Consultation
"RTN","GMRCPH",8,0)
 W !!,"Select the prefered place to see the patient for this consult/request"
"RTN","GMRCPH",9,0)
 D DISP^XQORM1 W !!
"RTN","GMRCPH",10,0)
 Q
"RTN","GMRCPH",11,0)
TYPEHELP ;Process help for Type of Consult
"RTN","GMRCPH",12,0)
 W !!,"The Specialty chosen for this consult has specified common consult types they"
"RTN","GMRCPH",13,0)
 W !,"process.  You may select one of these types to furthur define the type of"
"RTN","GMRCPH",14,0)
 W !,"Consult for this patient.  This is an optional prompt."
"RTN","GMRCPH",15,0)
 D DISP^XQORM1 W !!
"RTN","GMRCPH",16,0)
 Q
"RTN","GMRCPH",17,0)
PROCHELP ;Process help for Procedure which may be selected
"RTN","GMRCPH",18,0)
 W !!,"Select a procedure from the list of procedures below."
"RTN","GMRCPH",19,0)
 W !!,"This is the list of common procedures/tests/treatments which may be ordered."
"RTN","GMRCPH",20,0)
 W !,"The procedure will print on a computer generated Consult Form, but will be "
"RTN","GMRCPH",21,0)
 W !,"processed as a direct order for the procedure."
"RTN","GMRCPH",22,0)
 D DISP^XQORM1 W !!
"RTN","GMRCPH",23,0)
 Q
"RTN","GMRCPH",24,0)
MEDHELP ;Process Medicine Procedure Types help
"RTN","GMRCPH",25,0)
 W !!,"Select a Procedure Type from the list of Medicine Procedures below."
"RTN","GMRCPH",26,0)
 W !!,"Once you have selected a Procedure Type, its related Service will"
"RTN","GMRCPH",27,0)
 W !,"be determined in the Consult/Request Tracking system.  All consults"
"RTN","GMRCPH",28,0)
 W !,"and requests for this service will be displayed.  When ""AR"", associate"
"RTN","GMRCPH",29,0)
 W !,"results is selected, the only results you will be able to select from"
"RTN","GMRCPH",30,0)
 W !,"are those results related to the Procedure Type selected here."
"RTN","GMRCPH",31,0)
 D DISP^XQORM1 W !!
"RTN","GMRCPH",32,0)
 Q
"RTN","GMRCPOR")
0^52^B6316657
"RTN","GMRCPOR",1,0)
GMRCPOR ;SLC/DCM,DLT - Get DOC,LOC,TS in interactive defaults ;5/20/98  14:20
"RTN","GMRCPOR",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPOR",3,0)
DEM ;Similiar to load of variables done by ORUDPA
"RTN","GMRCPOR",4,0)
 ;;Call from ^GMRCR0
"RTN","GMRCPOR",5,0)
 S ORVP=DFN_";DPT(",VA200=1
"RTN","GMRCPOR",6,0)
 K VAINDT D OERR^VADPT S GMRCPNM=VADM(1),GMRCSN=VA("PID"),GMRCDOB=$P(VADM(3),"^",2),GMRCAGE=VADM(4),SEX=$P(VADM(5),"^")
"RTN","GMRCPOR",7,0)
 S ORTS=+VAIN(3),ORTS=$S(ORTS:ORTS,1:""),ORNP=+VAIN(2),ORWARD=VAIN(4),GMRCWARD=$P(VAIN(4),"^",2),(GMRCRB,ORL(1))=VAIN(5),(ORL,ORL(0),ORL(2))=""
"RTN","GMRCPOR",8,0)
 I ORNP,'$D(^VA(200,ORNP,0)) S ORNP=""
"RTN","GMRCPOR",9,0)
 S ORPV="" I ORNP,$D(^XUSEC("PROVIDER",ORNP)) S ORPV=ORNP
"RTN","GMRCPOR",10,0)
 S ORATTEND=ORNP
"RTN","GMRCPOR",11,0)
 I $P(ORWARD,"^")?1N.N S X=+ORWARD I $D(^DIC(42,+X,44)) S X=$P(^(44),"^") I X,$D(^SC(X,0)) S ORL=X_";SC(",ORL(0)=$S($L($P(^(0),"^",2)):$P(^(0),"^",2),1:$E($P(^(0),"^"),1,4)),ORL(2)=ORL
"RTN","GMRCPOR",12,0)
 D DOC,LOC,DOC1
"RTN","GMRCPOR",13,0)
 K O,ORL(0),DIC,VA,VAIN,VADM,VAERR,Y
"RTN","GMRCPOR",14,0)
 Q
"RTN","GMRCPOR",15,0)
DOC ;Get the requesting clinician
"RTN","GMRCPOR",16,0)
 S DOC=""
"RTN","GMRCPOR",17,0)
 I ORNP,$D(^VA(200,+ORNP,0)) S X=$P(^(0),"^") S:$P(^ORD(100.99,1,0),"^",15) DOC=X
"RTN","GMRCPOR",18,0)
 I $D(ORATTEND),$D(^VA(200,+ORATTEND,0)) S X=$P(^(0),"^") W !!,"Primary Care Physician is "_X,!
"RTN","GMRCPOR",19,0)
 Q
"RTN","GMRCPOR",20,0)
DOC1 ;Display Requesting Clinician
"RTN","GMRCPOR",21,0)
 W !,?5,"Requesting CLINICIAN : ",$S($L(DOC):DOC,1:"****** missing required information ******")
"RTN","GMRCPOR",22,0)
 Q
"RTN","GMRCPOR",23,0)
LOC ;GET PT. LOCATION
"RTN","GMRCPOR",24,0)
 D INP^VADPT,SDE^VADPT
"RTN","GMRCPOR",25,0)
 D:$L(VAIN(4)) LOC1 S (CT,C)=0,O=1 I $O(^UTILITY("VAEN",$J,0)) W !!,"Currently enrolled in the following clinics: ",!
"RTN","GMRCPOR",26,0)
 S I=0 F  S I=$O(^UTILITY("VAEN",$J,I)) Q:I'>0  S CT=CT+1 W:(CT#2) !?17 W:'(CT#2) ?47 W $P(^UTILITY("VAEN",$J,I,"E"),"^") S C=C+1,C(1)=$P(^("E"),"^") S:C'=1 C=-1
"RTN","GMRCPOR",27,0)
 K I,VAIN
"RTN","GMRCPOR",28,0)
 Q
"RTN","GMRCPOR",29,0)
LOC1 ;Check for patient location
"RTN","GMRCPOR",30,0)
 W !!,?5,"Patient Location     : "_$P(VAIN(4),"^",2) I '$L(VAIN(4)) W "****** missing required information ******"
"RTN","GMRCPOR",31,0)
 Q
"RTN","GMRCPOR1")
1^53
"RTN","GMRCPOS")
0^106^B2386476
"RTN","GMRCPOS",1,0)
GMRCPOS ;SLC/DLT - Consult postinit file maintenance ;10/28/98  14:31
"RTN","GMRCPOS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPOS",3,0)
EN ; -- postinit
"RTN","GMRCPOS",4,0)
 N DA,DIK,ACTION,SITE
"RTN","GMRCPOS",5,0)
 ; Move the PREINIT actions from temporary storage in XTMP("GMRC"
"RTN","GMRCPOS",6,0)
 ; to the CONSULTS PARAMETERS FILE 123.9 for future clean-up
"RTN","GMRCPOS",7,0)
 S DA(1)=$O(^GMR(123.9,0)) I 'DA(1) S SITE=+$$SITE^VASITE,^GMR(123.9,1,0)=SITE,^GMR(123.9,"B",SITE,1)="",DA(1)=1
"RTN","GMRCPOS",8,0)
 ;
"RTN","GMRCPOS",9,0)
 S:'$D(^GMR(123.9,DA(1),"OLD",0)) ^GMR(123.9,DA(1),"OLD",0)="^123.9999^"
"RTN","GMRCPOS",10,0)
 S ACTION=0 F  S ACTION=$O(^XTMP("GMRC","PREINIT",ACTION)) Q:'ACTION  D
"RTN","GMRCPOS",11,0)
 .S ^GMR(123.9,DA(1),"OLD",+ACTION,0)=$P($G(^XTMP("GMRC","PREINIT",ACTION)),U,1,3)
"RTN","GMRCPOS",12,0)
 .S $P(^GMR(123.9,DA(1),"OLD",0),U,3)=$P(^GMR(123.9,DA(1),"OLD",0),U,3)+1
"RTN","GMRCPOS",13,0)
 .S $P(^GMR(123.9,DA(1),"OLD",0),U,4)=+ACTION
"RTN","GMRCPOS",14,0)
 ;
"RTN","GMRCPOS",15,0)
 ; -- Re-index Request Action Types in 123.1
"RTN","GMRCPOS",16,0)
 S DIK="^GMR(123.1," D IXALL^DIK
"RTN","GMRCPOS",17,0)
 ; -- Re-index old Request Action Types in 123.9
"RTN","GMRCPOS",18,0)
 S DA(1)=$O(^GMR(123.9,0)) Q:'DA(1)
"RTN","GMRCPOS",19,0)
 S DIK="^GMR(123.9,"_DA(1)_",""OLD"",",DIK(1)=.01
"RTN","GMRCPOS",20,0)
 D ENALL^DIK ;only executes the SET logic
"RTN","GMRCPOS",21,0)
 ; -- RJS -- RECREATE 63 CHARACTER 'B' CROSS REFERENCE
"RTN","GMRCPOS",22,0)
 S DIK="^GMR(123.5,",DIK(1)=".01^B"
"RTN","GMRCPOS",23,0)
 D ENALL^DIK ;only executes the SET logic
"RTN","GMRCPOS",24,0)
 ; -- CREATE NEW CROSS REFERENCE FOR APC and AC on sub-file (10th node)
"RTN","GMRCPOS",25,0)
 K DA S DIK(1)="10^APC^AC",DA(1)=0
"RTN","GMRCPOS",26,0)
 F  S DA(1)=$O(^GMR(123.5,DA(1))) Q:'DA(1)  D
"RTN","GMRCPOS",27,0)
 . S DIK="^GMR(123.5,"_DA(1)_",10,"
"RTN","GMRCPOS",28,0)
 . S DIK(1)=".01^APC^AC" D ENALL^DIK
"RTN","GMRCPOS",29,0)
 Q
"RTN","GMRCPOS1")
0^107^B5483561
"RTN","GMRCPOS1",1,0)
GMRCPOS1 ;SLC/DCM - Post init to move Services from file 123.5 to the orderable items file, 101.43, and orderables in file 101 to file 101.43 ;10/28/98  14:31
"RTN","GMRCPOS1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPOS1",3,0)
EN ;Entry point
"RTN","GMRCPOS1",4,0)
 D SVC,ITEMS
"RTN","GMRCPOS1",5,0)
 Q
"RTN","GMRCPOS1",6,0)
SVC ;;get services from file 123.5, format them into an HL-7 message and send the message to OE/RR to update file 101.43
"RTN","GMRCPOS1",7,0)
 S GMRCSSN="",GMRCSRN=0,RLEVCODE="MAD"
"RTN","GMRCPOS1",8,0)
 F  S GMRCSSN=$O(^GMR(123.5,"B",GMRCSSN)) Q:GMRCSSN=""  S GMRCSRN=$O(^GMR(123.5,"B",GMRCSSN,0)) I $P(^GMR(123.5,GMRCSRN,0),"^",2)'=1,GMRCSSN'="ALL SERVICES" D
"RTN","GMRCPOS1",9,0)
 .I $P(^GMR(123.5,GMRCSRN,0),"^",2)=9 S GMRCDC(GMRCSSN)=GMRCSRN
"RTN","GMRCPOS1",10,0)
 .D SVC^GMRCPOST(GMRCSRN,GMRCSSN,RLEVCODE)
"RTN","GMRCPOS1",11,0)
 .D MSG^XQOR("GMRC ORDERABLE ITEM UPDATE",.GMRCMSG)
"RTN","GMRCPOS1",12,0)
 .K GMRCMSG
"RTN","GMRCPOS1",13,0)
 .Q
"RTN","GMRCPOS1",14,0)
 S GMRCSSN="",GMRCSRN=0,RLEVCODE="MDC"
"RTN","GMRCPOS1",15,0)
 F  S GMRCSSN=$O(GMRCDC(GMRCSSN)) Q:GMRCSSN=""  S GMRCSRN=GMRCDC(GMRCSSN) D
"RTN","GMRCPOS1",16,0)
 .D SVC^GMRCPOST(GMRCSRN,GMRCSSN,RLEVCODE)
"RTN","GMRCPOS1",17,0)
 .D MSG^XQOR("GMRC ORDERABLE ITEM UPDATE",.GMRCMSG)
"RTN","GMRCPOS1",18,0)
 .K GMRCMSG
"RTN","GMRCPOS1",19,0)
 .Q
"RTN","GMRCPOS1",20,0)
 K GMRCLCN,GMRCLSSN,GMRCSS,GMRCSSN,GMRCSRN,I,RLEVCODE,X
"RTN","GMRCPOS1",21,0)
 Q
"RTN","GMRCPOS1",22,0)
ITEMS ;create an HL-7 message to move orderable items into the orderable items file - file 123.43 - and send it to oerr
"RTN","GMRCPOS1",23,0)
 S GMRCMSTP="MFN",GMRCRELC="MAD"
"RTN","GMRCPOS1",24,0)
 F PFX="GMRCR " D  ;,"GMRCT " D
"RTN","GMRCPOS1",25,0)
 .S GMRCPFX=PFX F  S GMRCPFX=$O(^ORD(101,"B",GMRCPFX)) Q:$E(GMRCPFX,1,$L(PFX))'=PFX  S ORIEN=$O(^ORD(101,"B",GMRCPFX,0)) D  K GMRCARRY,GMRCMSG
"RTN","GMRCPOS1",26,0)
 ..S GMRCPF1=$E(GMRCPFX,$L(PFX)+1,$L(GMRCPFX))
"RTN","GMRCPOS1",27,0)
 ..Q:$E(GMRCPF1,1,6)="SAMPLE"
"RTN","GMRCPOS1",28,0)
 ..S NO=0,NO1=1 F  S NO=$O(^ORD(101,ORIEN,2,NO)) Q:NO?1A.E!(NO="")  S SYN=^ORD(101,ORIEN,2,NO,0),GMRCARRY(NO1)=SYN,NO1=NO1+1
"RTN","GMRCPOS1",29,0)
 ..D ITEMS^GMRCPOST(GMRCMSTP,GMRCRELC,ORIEN,GMRCPF1,.GMRCARRY,PFX)
"RTN","GMRCPOS1",30,0)
 ..D MSG^XQOR("GMRC ORDERABLE ITEM UPDATE",.GMRCMSG)
"RTN","GMRCPOS1",31,0)
 ..Q
"RTN","GMRCPOS1",32,0)
 .Q
"RTN","GMRCPOS1",33,0)
 K GMRCMSTP,GMRCPF1,GMRCPFX,GMRCRELC,NO,NO1,ORIEN,PFX,SYN
"RTN","GMRCPOS1",34,0)
 Q
"RTN","GMRCPOST")
0^108^B6171659
"RTN","GMRCPOST",1,0)
GMRCPOST ;SLC/DCM - Post init driver routine ;10/28/98  14:31
"RTN","GMRCPOST",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPOST",3,0)
 D EN^GMRCPOS1
"RTN","GMRCPOST",4,0)
 Q
"RTN","GMRCPOST",5,0)
EN S ND=0 I '$O(^GMR(123.5,ND)) S DIE=123.5,DA=1,DR=".01////^S X=""ALL SERVICES""" D ^DIE K DIE,DA,DR
"RTN","GMRCPOST",6,0)
 K ND
"RTN","GMRCPOST",7,0)
 Q
"RTN","GMRCPOST",8,0)
SVC(SVCIEN,SVCNAME,EVCODE) ;build HL7 message for conversion
"RTN","GMRCPOST",9,0)
 K GMRCMSG
"RTN","GMRCPOST",10,0)
 S MSH="MSH|^~\&|CONSULTS|"_$S($G(DUZ(2))]"":DUZ(2),1:+$$SITE^VASITE())_"|||||MFN"
"RTN","GMRCPOST",11,0)
 S MFI="MFI|123.5^Request Services^99DD||"_$S(EVCODE="MUD":"REP",1:"UPD")_"|||NE"
"RTN","GMRCPOST",12,0)
 S MFE="MFE|"_EVCODE_"|||^^^"_SVCIEN_"^"_SVCNAME_"^99CON"
"RTN","GMRCPOST",13,0)
 I $L($O(^GMR(123.5,SVCIEN,2,"B",""))) D
"RTN","GMRCPOST",14,0)
 .S ND1="",ND2=0 F  S ND1=$O(^GMR(123.5,SVCIEN,2,"B",ND1)) Q:ND1=""  S ND2=ND2+1,GMRCARRY(ND2)=ND1
"RTN","GMRCPOST",15,0)
 .D ZSY(.GMRCARRY)
"RTN","GMRCPOST",16,0)
 .Q
"RTN","GMRCPOST",17,0)
 I +$P(^GMR(123.5,SVCIEN,0),"^",2),$P(^(0),"^",2)'=9 S ZCS="ZCS|"_$P(^(0),"^",2)
"RTN","GMRCPOST",18,0)
 D BUILD
"RTN","GMRCPOST",19,0)
 K MSH,MFI,MFE,GMRCARRY,ZSY,ZCS
"RTN","GMRCPOST",20,0)
 Q
"RTN","GMRCPOST",21,0)
 ;
"RTN","GMRCPOST",22,0)
BUILD ;build the HL-7 array into its export form
"RTN","GMRCPOST",23,0)
 S ND=1,MSG="GMRCMSG"
"RTN","GMRCPOST",24,0)
 S @(MSG_"("_ND_")")=MSH,ND=ND+1
"RTN","GMRCPOST",25,0)
 S @(MSG_"("_ND_")")=MFI,ND=ND+1
"RTN","GMRCPOST",26,0)
 S @(MSG_"("_ND_")")=MFE,ND=ND+1
"RTN","GMRCPOST",27,0)
 S:$D(ZCS) @(MSG_"("_ND_")")=ZCS,ND=ND+1
"RTN","GMRCPOST",28,0)
 S ND1=0 F  S ND1=$O(ZSY(ND1)) Q:ND1=""  S @(MSG_"("_ND_")")=ZSY(ND1),ND=ND+1
"RTN","GMRCPOST",29,0)
 Q
"RTN","GMRCPOST",30,0)
 ;
"RTN","GMRCPOST",31,0)
MFI(MTP) ;s MFI HL-7 segment
"RTN","GMRCPOST",32,0)
 N X
"RTN","GMRCPOST",33,0)
 S MFI="MFI|101^Protocol^99DD||"_$S(MTP="MFN":"REP",1:"UPD")_"|||NE"
"RTN","GMRCPOST",34,0)
 Q MFI
"RTN","GMRCPOST",35,0)
 ;
"RTN","GMRCPOST",36,0)
MFE(RSPLVL,ORXDA,GMRCPRNO,PFX) ;set MFE HL=7 segment
"RTN","GMRCPOST",37,0)
 N X
"RTN","GMRCPOST",38,0)
 S X="MFE|"_RSPLVL_"|||^^^"_ORXDA_"^"_GMRCPRNO_"^99"_$S(PFX="GMRCR ":"PRO",1:"CON")
"RTN","GMRCPOST",39,0)
 Q X
"RTN","GMRCPOST",40,0)
 ;
"RTN","GMRCPOST",41,0)
ZSY(ARRAY)  ;set ZSY segment of the HL-7 segment; contains synonyms
"RTN","GMRCPOST",42,0)
 S ND1="",ND2=1
"RTN","GMRCPOST",43,0)
 F  S ND1=$O(ARRAY(ND1)) Q:ND1=""  S ZSY(ND2)="ZSY|"_ND2_"|"_ARRAY(ND1)_"|",ND2=ND2+1
"RTN","GMRCPOST",44,0)
 K ND1,ND2
"RTN","GMRCPOST",45,0)
 Q
"RTN","GMRCPOST",46,0)
 ;
"RTN","GMRCPOST",47,0)
ITEMS(ELC,RLECODE,ORDA,ORNAME,GMRCARRY,GMRCPRFX) ;entry point to set up HL-7 message to update orderable items file - file 101.43 in Post INIT
"RTN","GMRCPOST",48,0)
 S MSH="MSH|^~\&|"_$S(GMRCPRFX="GMRCR ":"PROCEDURES",1:"CONSULTS")_"|"_+$$SITE^VASITE_"|||||"_ELC
"RTN","GMRCPOST",49,0)
 S MFI=$$MFI(ELC)
"RTN","GMRCPOST",50,0)
 S MFE=$$MFE(RLECODE,ORDA,ORNAME,GMRCPRFX)
"RTN","GMRCPOST",51,0)
 D ZSY(.GMRCARRY)
"RTN","GMRCPOST",52,0)
 D BUILD
"RTN","GMRCPOST",53,0)
 K HLQ,MFE,MSH,MFI,MSG,MSGND,ND,ND1,ND2,ZSY
"RTN","GMRCPOST",54,0)
 Q
"RTN","GMRCPOST",55,0)
 ;
"RTN","GMRCPP")
0^56^B1271172
"RTN","GMRCPP",1,0)
GMRCPP ;SLC/DCM - Print GMRC consult/request tracking protocols - List Manager routine ;5/20/98  14:20
"RTN","GMRCPP",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPP",3,0)
EN ; -- main entry point for GMRC PRINT CONSULT PROTOCOLS
"RTN","GMRCPP",4,0)
 D EN^VALM("GMRC PRINT CONSULT PROTOCOLS")
"RTN","GMRCPP",5,0)
 Q
"RTN","GMRCPP",6,0)
 ;
"RTN","GMRCPP",7,0)
HDR ; -- header code
"RTN","GMRCPP",8,0)
 S VALMHDR(1)="                          CONSULT PROTOCOLS."
"RTN","GMRCPP",9,0)
 S VALMHDR(2)="Protocol File (#101)"
"RTN","GMRCPP",10,0)
 Q
"RTN","GMRCPP",11,0)
 ;
"RTN","GMRCPP",12,0)
INIT ; -- init variables and list array
"RTN","GMRCPP",13,0)
 K ^TMP("GMRCR",$J,"PCL")
"RTN","GMRCPP",14,0)
 S DSPLINE=0,VALMAR="^TMP(""GMRCR"",$J,""PLIST"")"
"RTN","GMRCPP",15,0)
 F LINE=1:1:GMRCCT S DSPLINE=$O(^TMP("GMRCR",$J,"PRL",DSPLINE)) Q:DSPLINE=""  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCPP",16,0)
 S VALMCNT=GMRCCT
"RTN","GMRCPP",17,0)
 K DATA,LINE,DSPLINE
"RTN","GMRCPP",18,0)
 Q
"RTN","GMRCPP",19,0)
 ;
"RTN","GMRCPP",20,0)
HELP ; -- help code
"RTN","GMRCPP",21,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCPP",22,0)
 Q
"RTN","GMRCPP",23,0)
 ;
"RTN","GMRCPP",24,0)
EXIT ; -- exit code
"RTN","GMRCPP",25,0)
 K ^TMP("GMRCR",$J,"PRL")
"RTN","GMRCPP",26,0)
 K GMRCCT,TAB
"RTN","GMRCPP",27,0)
 Q
"RTN","GMRCPP",28,0)
 ;
"RTN","GMRCPP",29,0)
EXPND ; -- expand code
"RTN","GMRCPP",30,0)
 Q
"RTN","GMRCPP",31,0)
 ;
"RTN","GMRCPR")
0^57^B1322803
"RTN","GMRCPR",1,0)
GMRCPR ;SLC/DCM - GMRC List Manager Routine - Get information for abbreviated print of GMRC protocols and format for List Manager ;5/20/98  14:20
"RTN","GMRCPR",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPR",3,0)
EN ; -- main entry point for GMRC PRINT ABBREV PROTOCOLS
"RTN","GMRCPR",4,0)
 D EN^VALM("GMRC PRINT ABBREV PROTOCOLS")
"RTN","GMRCPR",5,0)
 Q
"RTN","GMRCPR",6,0)
 ;
"RTN","GMRCPR",7,0)
HDR ; -- header code
"RTN","GMRCPR",8,0)
 S VALMHDR(1)=TAB_"GMRC PROTOCOL LIST"
"RTN","GMRCPR",9,0)
 S VALMHDR(2)="Consults/Request Tracking Protocols from file #101"
"RTN","GMRCPR",10,0)
 Q
"RTN","GMRCPR",11,0)
 ;
"RTN","GMRCPR",12,0)
INIT ; -- init variables and list array
"RTN","GMRCPR",13,0)
 S DSPLINE=0,VALMAR="^TMP(""GMRCR"",$J,""PSLIST"")"
"RTN","GMRCPR",14,0)
 F LINE=1:1:GMRCCT S DSPLINE=$O(^TMP("GMRCR",$J,"PRS",DSPLINE)) Q:DSPLINE=""  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCPR",15,0)
 K DATA,LINE,DSPLINE
"RTN","GMRCPR",16,0)
 S VALMCNT=30
"RTN","GMRCPR",17,0)
 Q
"RTN","GMRCPR",18,0)
 ;
"RTN","GMRCPR",19,0)
HELP ; -- help code
"RTN","GMRCPR",20,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCPR",21,0)
 Q
"RTN","GMRCPR",22,0)
 ;
"RTN","GMRCPR",23,0)
EXIT ; -- exit code
"RTN","GMRCPR",24,0)
 K ^TMP("GMRCR",$J,"PRS")
"RTN","GMRCPR",25,0)
 K TAB,GMRCCT
"RTN","GMRCPR",26,0)
 Q
"RTN","GMRCPR",27,0)
 ;
"RTN","GMRCPR",28,0)
EXPND ; -- expand code
"RTN","GMRCPR",29,0)
 Q
"RTN","GMRCPR",30,0)
 ;
"RTN","GMRCPR0")
0^58^B14516464
"RTN","GMRCPR0",1,0)
GMRCPR0 ;SLC/DLT - Data Entry Prompt int actions ;5/20/98  14:20
"RTN","GMRCPR0",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPR0",3,0)
ASK ;ASK FOR TO, PROCEDURE,URGENCY, AND PLACE OF CONSULT
"RTN","GMRCPR0",4,0)
 I $D(GMRCPR),'$D(GMRCPRI) S GMRCPRI=+GMRCPR_";ORD(101,",GMRCORSV=$S(+^ORD(101,+GMRCPR,5):+^(5),1:GMRCSS),GMRCSRVC=$P(^GMR(123.5,GMRCORSV,0),"^",1) K GMRCORSV
"RTN","GMRCPR0",5,0)
 I $S('$D(GMRCPR):1,GMRCPR="":1,1:0) D PROC Q:GMRCEND  S GMRCORSV=^ORD(101,+GMRCPRI,5),GMRCORSV=+GMRCORSV,GMRCSRVC=$P(^GMR(123.5,GMRCORSV,0),"^",1) K GMRCORSV
"RTN","GMRCPR0",6,0)
 I '$D(GMRCSRVC) S GMRCSRVC=GMRCSSNM
"RTN","GMRCPR0",7,0)
ASK1 I $L(GMRCWARD) S GMRCIOPT="I"
"RTN","GMRCPR0",8,0)
 E  S GMRCIOPT="O"
"RTN","GMRCPR0",9,0)
 S DIR(0)="123,14",DIR("A")="Service rendered on (I)npatient or (O)utpatient basis?",DIR("B")=GMRCIOPT D ^DIR K DIR I $D(DTOUT)!($D(DUOUT))!($D(DIROUT)) S GMRCEND=1 K DTOUT,DUOUT,DIROUT Q
"RTN","GMRCPR0",10,0)
 S GMRCIOPT=Y
"RTN","GMRCPR0",11,0)
 I GMRCIOPT="I" S X="GMRCURGENCYM REQ - INPATIENT"
"RTN","GMRCPR0",12,0)
 E  S X="GMRCURGENCYM - OUTPATIENT"
"RTN","GMRCPR0",13,0)
 S DIC=101,DIC(0)="X" D ^DIC K DIC Q:Y<0
"RTN","GMRCPR0",14,0)
 S XQORM("??")="D URGHELP^GMRCPH",XQORM=+Y_";ORD(101,",XQORM(0)="1A\"
"RTN","GMRCPR0",15,0)
 S XQORM("A")="URGENCY: ",XQORM("NO^^")=""
"RTN","GMRCPR0",16,0)
 S GMRCURG1=$G(^DISV(DUZ,"XQORM",XQORM,1)) I '$L(GMRCURG1) K GMRCURG1
"RTN","GMRCPR0",17,0)
 I $D(GMRCURG1) S GMRCURG1=$$UP^XLFSTR(GMRCURG1) I $O(^XUTL("XQORM",XQORM,"B",GMRCURG1,0)) S XQORM("B")=^DISV(DUZ,"XQORM",XQORM,1)
"RTN","GMRCPR0",18,0)
 F  D  Q:Y  I $D(GMRCEND),GMRCEND Q
"RTN","GMRCPR0",19,0)
 .K GMRCURG1
"RTN","GMRCPR0",20,0)
 .D ^XQORM I X="^"!($D(DIROUT)) S GMRCEND=1 K DIROUT,DTOUT,DUOUT Q
"RTN","GMRCPR0",21,0)
 .I Y<0 S GMRCMSG="The URGENCY is a required response." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG
"RTN","GMRCPR0",22,0)
 .Q
"RTN","GMRCPR0",23,0)
 I $D(GMRCEND),GMRCEND Q
"RTN","GMRCPR0",24,0)
 I $D(Y(1)) S GMRCURG=$P(Y(1),"^",3),GMRCURGI=$P(Y(1),"^",2)
"RTN","GMRCPR0",25,0)
 I GMRCIOPT="I" S X="GMRCPLACEM - INPATIENT"
"RTN","GMRCPR0",26,0)
 E  S X="GMRCPLACEM - OUTPATIENT"
"RTN","GMRCPR0",27,0)
 S DIC=101,DIC(0)="X" D ^DIC Q:Y<0
"RTN","GMRCPR0",28,0)
 K XQORM S XQORM("??")="D PLHELP^GMRCPH",XQORM=+Y_";ORD(101,",XQORM(0)="1A\"
"RTN","GMRCPR0",29,0)
 S XQORM("A")="PLACE OF CONSULTATION: "
"RTN","GMRCPR0",30,0)
 S XQORM("B")=$P($G(^XUTL("XQORM",XQORM,1.1,0)),U,3),XQORM("NO^^")=""
"RTN","GMRCPR0",31,0)
 D ^XQORM I X="^"!($D(DIROUT)) K XQORM,DIROUT,DTOUT,DUOUT S GMRCEND=1 Q
"RTN","GMRCPR0",32,0)
 I Y<0 D  Q:+$G(GMRCEND)
"RTN","GMRCPR0",33,0)
 .W $C(7),!!,"  The PLACE OF CONSULTATION is a required response!",!
"RTN","GMRCPR0",34,0)
 .D ^XQORM K XQORM I X="^"!($D(DIROUT))!(Y<1) K DIROUT,DTOUT,DUOUT S GMRCEND=1 Q
"RTN","GMRCPR0",35,0)
 K XQORM I $D(Y(1)) S GMRCPL=$P(Y(1),"^",3),GMRCPLI=$P(Y(1),"^",2)
"RTN","GMRCPR0",36,0)
 Q
"RTN","GMRCPR0",37,0)
TO ;Get Service from File Link field
"RTN","GMRCPR0",38,0)
 S GMRCSS=$P($G(^ORD(101,+GMRCPRI,5)),"^")
"RTN","GMRCPR0",39,0)
 I '+GMRCSS D ASKTO Q:GMRCEND
"RTN","GMRCPR0",40,0)
 I +GMRCSS S GMRCSS=+GMRCSS,GMRCSSNM=$P($G(^GMR(123.5,GMRCSS,.1)),"^") I '$L(GMRCSSNM) S GMRCSSNM=$P($G(^GMR(123.5,GMRCSS,0)),"^",1)
"RTN","GMRCPR0",41,0)
 S ORTO=$O(^ORD(100.98,"B","CONSULTS",""))
"RTN","GMRCPR0",42,0)
 Q
"RTN","GMRCPR0",43,0)
ASKTO ;Ask for service when file link not defined in protocol file
"RTN","GMRCPR0",44,0)
 D SERV^GMRCPS I 'GMRCDG S GMRCEND=1 Q
"RTN","GMRCPR0",45,0)
 S GMRCSS=GMRCDG
"RTN","GMRCPR0",46,0)
 Q
"RTN","GMRCPR0",47,0)
PROC ;Use XQORM to select procedure
"RTN","GMRCPR0",48,0)
 S GMRCEND=0 N XQORM
"RTN","GMRCPR0",49,0)
 S DIC=101,X="GMRCRM REQUEST TYPES",DIC(0)="X" D ^DIC Q:Y<0
"RTN","GMRCPR0",50,0)
 S XQORM("??")="D PROCHELP^GMRCPH",XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Select PROCEDURE: ",XQORM("NO^^")="" I $D(GMRCPR),$L(GMRCPR) S XQORM("B")=GMRCPR
"RTN","GMRCPR0",51,0)
 D ^XQORM K XQORM I X="^"!('$L(X))!($D(DIROUT)) S (GMRCQUT,GMRCEND)=1 K DIROUT,DTOUT,DUOUT Q
"RTN","GMRCPR0",52,0)
 I $D(Y(1)) S (GMRCVP,GMRCPRI)=$P(Y(1),"^",2)_";ORD(101,",GMRCPR=$S($D(^ORD(101,$P(Y(1),"^",2),.1)):$P(^(.1),"^"),1:"") I '$L(GMRCPR) S GMRCPR=$P(Y(1),"^",3)
"RTN","GMRCPR0",53,0)
 S X=$S($D(^ORD(101,+GMRCPRI,20)):$P(^(20)," D ",1),1:"") X:X]"" X S GMRCEN=$S($G(GMRCEN)]"":GMRCEN,1:""),GMRCTYPE=$S(GMRCEN="R":"GMRCOR REQUEST",1:"GMRCOR CONSULT")
"RTN","GMRCPR0",54,0)
 Q
"RTN","GMRCPRE")
1^105
"RTN","GMRCPREF")
0^60^B6098689
"RTN","GMRCPREF",1,0)
GMRCPREF ;SLC/DCM - Setup package/procedure protocols ;5/20/98  14:20
"RTN","GMRCPREF",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPREF",3,0)
A ;Setup package and procedure
"RTN","GMRCPREF",4,0)
 K ORDR I $D(ORDA),ORDA,$D(^ORD(101,ORDA)),$P(^(ORDA,0),"^",12)=ORPKG S ORIN=ORDA,ORNAME=$P(^(0),"^") G A1
"RTN","GMRCPREF",5,0)
 S X=$S($D(ORDANM):ORDANM,1:$$GET1^DIQ(9.4,+ORPKG_",",1)_+ORFL_" "_X),X=$E(X,1,63)
"RTN","GMRCPREF",6,0)
 I $D(^ORD(101,"B",X)) S Y=$O(^(X,0)),ORNAME=X,ORDR="" I $D(^ORD(101,Y,0)) W !,X_" PROTOCOL Updated",! S:ORTXT'=$P(^(0),"^",2) ORDR="1///"_ORTXT
"RTN","GMRCPREF",7,0)
 I '$D(^ORD(101,"B",X)) S ORNAME=X,DIC(0)="XZL",(DLAYGO,DIC)=101 D ^DIC S:Y'<1 ORNAME=$P(Y,"^",2) W:Y>0 !,ORNAME_" PROTOCOL Created" I Y<1 W $C(7),!,"Unable to create "_ORNAME_" as an entry in the PROTOCOL file." Q
"RTN","GMRCPREF",8,0)
 ;
"RTN","GMRCPREF",9,0)
A1 ;Entry point given a protocol ien
"RTN","GMRCPREF",10,0)
 S:'$D(ORIN) ORIN=+Y I '$D(ORDA) S %X="^ORD(101,"_ORDEF_",",%Y="^ORD(101,"_+Y_"," D %XY^%RCR S:ORTXT=$P(^ORD(101,+Y,0),"^",2) ORDR="" S $P(^ORD(101,+Y,0),"^",1)=ORNAME
"RTN","GMRCPREF",11,0)
 I $D(OREA),$L(OREA) S ^ORD(101,ORIN,20)=OREA
"RTN","GMRCPREF",12,0)
 S:'$D(ORDR) ORDR=".01////"_$S($D(ORDANM):ORDANM,1:ORNAME)_$S($D(ORTXT):";1////"_ORTXT,1:"") S:$D(ORFL) ORDR=ORDR_";6////^S X=ORFL" I $L(ORDR) S DR=ORDR,DA=ORIN,DIE="^ORD(101," D ^DIE
"RTN","GMRCPREF",13,0)
 Q
"RTN","GMRCPREF",14,0)
 ;
"RTN","GMRCPREF",15,0)
EN3 ;On the fly protocol setup
"RTN","GMRCPREF",16,0)
 Q:'$D(ORPKG)!('$D(ORDEF))!('$D(ORFL))  Q:'ORPKG!('ORDEF)
"RTN","GMRCPREF",17,0)
 Q:'$D(^ORD(101,ORDEF,0))
"RTN","GMRCPREF",18,0)
 Q:'$L($$GET1^DIQ(9.4,+ORPKG_",",.01))
"RTN","GMRCPREF",19,0)
 I ORFL Q:'$D(@("^"_$P(ORFL,";",2)_+ORFL_",0)"))  S:'$D(ORTXT) ORTXT=$P(^(0),"^")
"RTN","GMRCPREF",20,0)
 Q:'$D(ORTXT)  S X=ORTXT D A
"RTN","GMRCPREF",21,0)
 K ORDA,ORDANM,ORDEF,ORDR,OREA,ORIN,ORNAME,ORTXT,ORIN,%X,%Y
"RTN","GMRCPREF",22,0)
 Q
"RTN","GMRCPRP")
0^61^B14430951
"RTN","GMRCPRP",1,0)
GMRCPRP ;SLC/DCM - Set protocol information into ^TMP global for print and display by List Manager ;5/20/98  14:20
"RTN","GMRCPRP",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPRP",3,0)
ENL ;;List manager entry point
"RTN","GMRCPRP",4,0)
 W !,"Compiling Report: Please Wait..."
"RTN","GMRCPRP",5,0)
EN ;Entry point
"RTN","GMRCPRP",6,0)
 K ^TMP("GMRCR",$J,"PRL"),ERMSG
"RTN","GMRCPRP",7,0)
 S FILE="101",FIELDS=".01;1;1.1;1.11;3.5;4;6;10*;12",FLAGS="EZ",TARGET="TMP",MSG="ERROR",TAB="",$P(TAB," ",50)="",GMRCCT=1
"RTN","GMRCPRP",8,0)
 S GMRCBXRF="GMRC"
"RTN","GMRCPRP",9,0)
 F  S GMRCBXRF=$O(^ORD(101,"B",GMRCBXRF)) Q:GMRCBXRF'["GMRC"!(GMRCBXRF="")  W "." S IENS=0,IENS=$O(^ORD(101,"B",GMRCBXRF,IENS)) D GETS^DIQ(FILE,IENS,FIELDS,FLAGS,"TMP","ERMSG") D
"RTN","GMRCPRP",10,0)
 .S GMRCPRNM=$E(TMP(FILE,IENS_",",.01,"E"),1,39),GMRCTXT=$S($D(TMP(FILE,IENS_",",1,"E")):$E(TMP(FILE,IENS_",",1,"E"),1,39),1:"")
"RTN","GMRCPRP",11,0)
 .S GMRCSYN=$S($D(TMP(FILE,IENS_",",1.1,"E")):TMP(FILE,IENS_",",1.1,"E"),1:""),GMRCPKG=$S($D(TMP(FILE,IENS_",",12,"E")):TMP(FILE,IENS_",",12,"E"),1:"")
"RTN","GMRCPRP",12,0)
 .S GMRCTYP=$S($D(TMP(FILE,IENS_",",4,"E")):TMP(FILE,IENS_",",4,"E"),1:"")
"RTN","GMRCPRP",13,0)
 .S GMRCFILK=$S($D(TMP(FILE,IENS_",",6,"E")):TMP(FILE,IENS_",",6,"E"),1:"")
"RTN","GMRCPRP",14,0)
 .S GMRCNM=$S($D(TMP(FILE,IENS_",",1.11,"E")):TMP(FILE,IENS_",",1.11,"E"),1:"")
"RTN","GMRCPRP",15,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=GMRCPRNM_$E(TAB,1,40-$L(GMRCPRNM))_$E(GMRCTXT,1,39),GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"PRL",GMRCCT,0)="Type:"_$E(TAB,1,8)_GMRCTYP_$E(TAB,1,27-$L(GMRCTYP))_"Print Name: "_GMRCNM,GMRCCT=GMRCCT+1
"RTN","GMRCPRP",16,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)="Package:"_$E(TAB,1,5)_GMRCPKG_$E(TAB,1,27-$L(GMRCPKG))_"File Link:   "_GMRCFILK,GMRCCT=GMRCCT+1
"RTN","GMRCPRP",17,0)
 .I $O(TMP(FILE,IENS_",",3.5,0))?1N.N S GLOB="TMP("_FILE_","""_IENS_","""_",3.5)" D
"RTN","GMRCPRP",18,0)
 ..S LINE="Description: " D WPSET^GMRCUTIL(GLOB,"^TMP(""GMRCR"",$J,""PRL"")",LINE,.GMRCCT,TAB,1)
"RTN","GMRCPRP",19,0)
 ..Q
"RTN","GMRCPRP",20,0)
 .I $O(TMP(FILE,IENS_",",3.5,0))="E" S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)="Description:",GMRCCT=GMRCCT+1
"RTN","GMRCPRP",21,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)="Synonyms:"_$E(TAB,1,13)_$S($D(TMP(FILE,IENS_",",1.1,"E")):TMP(FILE,IENS_",",1.1,"E"),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCPRP",22,0)
 .I $O(TMP(FILE_".01",""))="" S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)="Menu Items:",GMRCCT=GMRCCT+1
"RTN","GMRCPRP",23,0)
 .I $O(TMP(FILE_".01",""))]"" S GMRCSUB="",GMRCITM="Menu Items:  " F  S GMRCSUB=$O(TMP(FILE_".01",GMRCSUB)) Q:GMRCSUB=""  D
"RTN","GMRCPRP",24,0)
 ..I $D(TMP(FILE_".01",GMRCSUB,.01,"E")) S GMRCITM=$S('$L(GMRCITM):$E(TAB,1,13)_GMRCITM,1:GMRCITM)_TMP(FILE_".01",GMRCSUB,.01,"E"),GMRCMNE=TMP(FILE_".01",GMRCSUB,2,"E"),GMRCNO=$J(TMP(FILE_".01",GMRCSUB,3,"E"),3,0)
"RTN","GMRCPRP",25,0)
 ..I '$D(TMP(FILE_".01",GMRCSUB,.01,"E")),$L($O(ERMSG(0))) S GMRCITM=$E(TAB,1,13)_"Deleted Protocol: "_$G(ERMSG("DIERR",2,"PARAM",1)) K ERRMSG
"RTN","GMRCPRP",26,0)
 ..S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=$E(GMRCITM_TAB,1,45)_GMRCNO_"   "_GMRCMNE,GMRCCT=GMRCCT+1,GMRCITM=""
"RTN","GMRCPRP",27,0)
 ..Q
"RTN","GMRCPRP",28,0)
 .K TMP S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCPRP",29,0)
 .Q
"RTN","GMRCPRP",30,0)
 S GMRCCT=GMRCCT-1
"RTN","GMRCPRP",31,0)
QUIT ;Kill off local globals and exit
"RTN","GMRCPRP",32,0)
 K CNT,FLG,LNO,LN1,IENS,FILE,FLAGS,FIELDS,GLOB,LINE,ERMSG,GMRCNM,GMRCNO,GMRCND,GMRCSYN,GMRCITM,GMRCMNE,GMRCPKG,GMRCSUB,GMRCFILK,GMRCTXT,GMRCTYP,GMRDCFLN,GMRCBXRF,GMRCPRNM,TARGET
"RTN","GMRCPRP",33,0)
 Q
"RTN","GMRCPRPS")
0^62^B2594480
"RTN","GMRCPRPS",1,0)
GMRCPRPS ;SLC/DCM - List Manager GMRC Routine -- List GMRC (Consults/Request) Protocols in abbreviated form. ;5/20/98  14:20
"RTN","GMRCPRPS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPRPS",3,0)
ENL ;List Manager Entry Point
"RTN","GMRCPRPS",4,0)
 K ^TMP("GMRCR",$J,"PRS"),TMP
"RTN","GMRCPRPS",5,0)
 W !,"Building Report: Please Wait..."
"RTN","GMRCPRPS",6,0)
 S FILE="101",FIELDS=".01;1",FLAGS="EZ",TARGET="TMP",MSG="ERROR",TAB="",$P(TAB," ",30)=" ",GMRCCT=1,GMRCBXRF="GMRC"
"RTN","GMRCPRPS",7,0)
 F  S GMRCBXRF=$O(^ORD(101,"B",GMRCBXRF)) Q:$E(GMRCBXRF,1,4)'["GMRC"!(GMRCBXRF="")  S IENS=0,IENS=$O(^ORD(101,"B",GMRCBXRF,IENS)) D GETS^DIQ(FILE,IENS,FIELDS,FLAGS,"TMP","ERMSG") D
"RTN","GMRCPRPS",8,0)
 .S GMRCPNM=TMP(FILE,IENS_",",.01,"E"),GMRCTXT=TMP(FILE,IENS_",",1,"E")
"RTN","GMRCPRPS",9,0)
 .S ^TMP("GMRCR",$J,"PRS",GMRCCT,0)=$E(GMRCPNM,1,39)_" "_$E(TAB,1,39-$L(GMRCPNM))_$E(GMRCTXT,1,40),GMRCCT=GMRCCT+1
"RTN","GMRCPRPS",10,0)
 .K TMP Q
"RTN","GMRCPRPS",11,0)
 S GMRCCT=GMRCCT-1
"RTN","GMRCPRPS",12,0)
QUIT ;Kill off variables
"RTN","GMRCPRPS",13,0)
 K ERMSG,FILE,FIELDS,FLAGS,TARGET,MSG,IENS,GMRCBXRF,GMRCPNM,GMRCTXT
"RTN","GMRCPRPS",14,0)
 Q
"RTN","GMRCPS")
0^63^B6637966
"RTN","GMRCPS",1,0)
GMRCPS ;SLC/KCM,DLT -Select Service/specialty to send Consult to ;5/20/98  14:20
"RTN","GMRCPS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPS",3,0)
ASRV W ! D SERV D:GMRCDG SERV1
"RTN","GMRCPS",4,0)
 Q
"RTN","GMRCPS",5,0)
SERV ;Select from Hierarchy of services defined in 123.5
"RTN","GMRCPS",6,0)
 K X N GMRC1 S GMRCSTXT="Service/Specialty",GMRCSTXT(0)="ALL SERVICES",GMRCDG=0,GMRC1=0
"RTN","GMRCPS",7,0)
 F  W !,"Select 'TO' Service/Specialty: " R X:DTIME S:'$L(X)&(GMRC1=0) X="^" S:X["^^" DIROUT=1 Q:X["^"  S:GMRC1=1&('$L(X)) X="?" S:GMRC1=1 GMRC1=0 D @$S(X["?":"LSRV",1:"LKUP") I GMRCDG S GMRCDGT=GMRCDG Q
"RTN","GMRCPS",8,0)
 I 'GMRCDG S GMRCACT("D")="Redisplay Screen"
"RTN","GMRCPS",9,0)
 K GMRCSTXT,DUOUT,DIROUT Q
"RTN","GMRCPS",10,0)
SERV1 ;
"RTN","GMRCPS",11,0)
 S GMRCBUF=GMRCDG
"RTN","GMRCPS",12,0)
 I GMRCBUF>0 K GMRCGRP S GMRCSEL="BILD" D EN^GMRCASV S GMRCGRP("NAM")=^GMR(123.5,GMRCBUF,0),GMRCGRP("ROOT")=GMRCBUF,GMRCGRP("NAM")=$S($L($P(GMRCGRP("NAM"),"^",3)):$P(GMRCGRP("NAM"),"^",3),1:$E($P(GMRCGRP("NAM"),"^"),1,5))
"RTN","GMRCPS",13,0)
 I $P(^GMR(123.5,GMRCBUF,0),"^",1)'="ALL SERVICES"
"RTN","GMRCPS",14,0)
 K GMRCDG,GMRCSEQ,GMRCBUF Q
"RTN","GMRCPS",15,0)
LKUP S DIC="^GMR(123.5,",DIC(0)="MNEQZ",DIC("W")="W ""   "",$P(Y,""^"",2)",DIC("S")="I +$P(^(0),U,2)<2" D ^DIC K DIC I '$D(Y(0)) D LSRV Q
"RTN","GMRCPS",16,0)
 I $P(Y(0),"^",2)=1 S GMRCSTXT(0)=Y(0,0),GMRCDG=+Y,GMRC1=1 D LSRV1 Q
"RTN","GMRCPS",17,0)
 S:+Y>0 GMRCDG=+Y
"RTN","GMRCPS",18,0)
 Q
"RTN","GMRCPS",19,0)
LSRV S GMRC1=0,GMRCDG=$O(^GMR(123.5,"B",GMRCSTXT(0),0)) Q:'GMRCDG
"RTN","GMRCPS",20,0)
LSRV1 I X'["??" W @IOF,GMRCSTXT(0) F I=0:0 S I=$O(^GMR(123.5,GMRCDG,10,I)) Q:I'>0  Q:$D(DUOUT)  D
"RTN","GMRCPS",21,0)
 .I $D(^GMR(123.5,GMRCDG,10,I,0)) D  Q:$D(DUOUT)  I $D(^GMR(123.5,+^(0),0)),$P(^GMR(123.5,+^GMR(123.5,GMRCDG,10,I,0),0),U,2)<9 W !,?2,$P(^(0),U)
"RTN","GMRCPS",22,0)
 ..I $Y>(IOSL-4) D READ^GMRCASV W:'$D(DUOUT) @IOF
"RTN","GMRCPS",23,0)
 I X["??" S GMRCSTXT(0)="ALL SERVICES",GMRCSEL="DISP" W @IOF D EN^GMRCASV
"RTN","GMRCPS",24,0)
 S GMRCDG=0 I GMRCSTXT(0)'="ALL SERVICES" S GMRCSTXT(0)="ALL SERVICES"
"RTN","GMRCPS",25,0)
 K DUOUT,DIROUT W !
"RTN","GMRCPS",26,0)
 Q
"RTN","GMRCPSEL")
0^64^B2587182
"RTN","GMRCPSEL",1,0)
GMRCPSEL ;SLC/DCM - Select Range Of Items From List ;5/20/98  14:20
"RTN","GMRCPSEL",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPSEL",3,0)
SEL ;Entry point into select option
"RTN","GMRCPSEL",4,0)
 I '$D(^TMP("GMRCR",$J,"CS","AD")) W !,"No Consult Orders Exist To Select From.",! S GMRCSEL="",GMRCQUIT=1 Q
"RTN","GMRCPSEL",5,0)
 I '$O(^TMP("GMRCR",$J,"CS","AD")),BLK=1 S GMRCSEL=BLK Q
"RTN","GMRCPSEL",6,0)
 S GMRCSEL="" W !,"Choose No. 1-"_BLK_": " R X:DTIME S:X="^^" DIROUT=1 I '$T!(X["^") S (DTOUT,GMRCQUT)=1 Q
"RTN","GMRCPSEL",7,0)
 I X["?" D SELHELP G SEL
"RTN","GMRCPSEL",8,0)
 I X="" S GMRCQUT=1 Q
"RTN","GMRCPSEL",9,0)
 I $S(X'?.N1",".N.E:1,X<0:1,X>BLK:1,1:0) D SELHELP G SEL
"RTN","GMRCPSEL",10,0)
 S GMRCSEL=X
"RTN","GMRCPSEL",11,0)
 Q
"RTN","GMRCPSEL",12,0)
SELHELP ;Help to select a valid entry
"RTN","GMRCPSEL",13,0)
 W !,"Select a request by typing the number in the left column and pressing <ENTER>",!,"or by selecting a range of numbers in the left column, separated by commas.",!
"RTN","GMRCPSEL",14,0)
 Q
"RTN","GMRCPURG")
0^65^B239961
"RTN","GMRCPURG",1,0)
GMRCPURG ;SLC/DLT,DCM - Purge orders from the Order File 100 ;10/21/98  09:07
"RTN","GMRCPURG",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPURG",3,0)
CPRSPURG(GMRCO) ;Purge File 100 record number from file 123 upon request from ORDER ENTRY/RESULTS REPORTING
"RTN","GMRCPURG",4,0)
 ;Called from GMRCHL7A when HL-7 control code is GMRCTRLC="Z@"
"RTN","GMRCPURG",5,0)
 ;GMRCO=IEN from file 123 which is to have file 100 pointer deleted
"RTN","GMRCPURG",6,0)
 ;
"RTN","GMRCPURG",7,0)
 Q  ; This functionality will be introduced with a later patch
"RTN","GMRCPURG",8,0)
 ;
"RTN","GMRCPX")
0^66^B465264
"RTN","GMRCPX",1,0)
GMRCPX ;SLC/DCM - Select a new pharmacy patient for list manager consult tracking display ;5/20/98  14:20
"RTN","GMRCPX",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPX",3,0)
EN ; -- main entry point for GMRC PHARMACY SELECT PATIENT
"RTN","GMRCPX",4,0)
 K GMRCQUT
"RTN","GMRCPX",5,0)
 D ^GMRCSSP I $D(GMRCQUT) Q
"RTN","GMRCPX",6,0)
 D AD^GMRCSLM1
"RTN","GMRCPX",7,0)
 D INIT,HDR
"RTN","GMRCPX",8,0)
 Q
"RTN","GMRCPX",9,0)
 ;
"RTN","GMRCPX",10,0)
HDR ; -- header code
"RTN","GMRCPX",11,0)
 D HDR^GMRCSLM
"RTN","GMRCPX",12,0)
 Q
"RTN","GMRCPX",13,0)
 ;
"RTN","GMRCPX",14,0)
INIT ; -- init variables and list array
"RTN","GMRCPX",15,0)
 D INIT^GMRCPZ
"RTN","GMRCPX",16,0)
 Q
"RTN","GMRCPX",17,0)
 ;
"RTN","GMRCPX",18,0)
HELP ; -- help code
"RTN","GMRCPX",19,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCPX",20,0)
 Q
"RTN","GMRCPX",21,0)
 ;
"RTN","GMRCPX",22,0)
EXIT ; -- exit code
"RTN","GMRCPX",23,0)
 K GMRCWRD,GMRCWT,GMRCA,GMRCSNM,GMRCSSS,GMRCTX,GMRCQUIT,GMRCSTCK
"RTN","GMRCPX",24,0)
 Q
"RTN","GMRCPX",25,0)
 ;
"RTN","GMRCPX",26,0)
EXPND ; -- expand code
"RTN","GMRCPX",27,0)
 Q
"RTN","GMRCPX",28,0)
 ;
"RTN","GMRCPZ")
0^67^B6983852
"RTN","GMRCPZ",1,0)
GMRCPZ ;SLC/DCM - GMRC List Manager Routine -- Main menu actions for Pharmacy consults request tracking ;5/20/98  14:20
"RTN","GMRCPZ",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCPZ",3,0)
EN ; -- main entry point for GMRC PHARMACY TRK MAIN MENU
"RTN","GMRCPZ",4,0)
 K ^TMP("GMRCR",$J),GMRCOER
"RTN","GMRCPZ",5,0)
 D ^GMRCSSP I $D(GMRCQUT) K GMRCQUT,DFN Q
"RTN","GMRCPZ",6,0)
 D EN^VALM("GMRC PHARMACY TRK MAIN MENU")
"RTN","GMRCPZ",7,0)
 Q
"RTN","GMRCPZ",8,0)
 ;
"RTN","GMRCPZ",9,0)
HDR ; -- header code
"RTN","GMRCPZ",10,0)
 Q:DFN<1
"RTN","GMRCPZ",11,0)
 D HDR^GMRCSLM
"RTN","GMRCPZ",12,0)
 Q
"RTN","GMRCPZ",13,0)
 S GMRCPTN=$P(^DPT(DFN,0),"^",1),GMRCSSNM=$$LOWER^VALM1(GMRCSSNM),VALMHDR(1)="Patient Name: "_GMRCPTN_$E(TAB,1,38-$L(GMRCPTN))_"Service: "_GMRCSSNM
"RTN","GMRCPZ",14,0)
 ;
"RTN","GMRCPZ",15,0)
INIT ; -- init variables and list array
"RTN","GMRCPZ",16,0)
 K ^TMP("GMRCR",$J,"LIST")
"RTN","GMRCPZ",17,0)
 S DSPLINE=0,VALMAR="^TMP(""GMRCR"",$J,""LIST"")"
"RTN","GMRCPZ",18,0)
 S GMRCSN=$P(^DPT(DFN,0),"^",9),GMRCSSN=$E(GMRCSN,1,3)_"-"_$E(GMRCSN,4,5)_"-"_$E(GMRCSN,6,9)
"RTN","GMRCPZ",19,0)
 F LINE=1:1:LNCT S DSPLINE=$O(^TMP("GMRCR",$J,"CS",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCPZ",20,0)
 S VALMCNT=LNCT,XQORM("A")="Select Action: "
"RTN","GMRCPZ",21,0)
 K DSPLINE,LINE,DATA
"RTN","GMRCPZ",22,0)
 Q
"RTN","GMRCPZ",23,0)
 ;
"RTN","GMRCPZ",24,0)
HELP ; -- help code
"RTN","GMRCPZ",25,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCPZ",26,0)
 Q
"RTN","GMRCPZ",27,0)
 ;
"RTN","GMRCPZ",28,0)
EXIT ; -- exit code
"RTN","GMRCPZ",29,0)
 K BLK,CDT,CNT,LNCT,CTRLCOL,DFN,TAB,DFNS,SEX,LNCT,GMRCCT,GMRCDT,GMRCND,GMRCNO,GMRCRB,GMRCDT1,GMRCDT2,GMRCSEX,GMRCSN,GMRCAGE,GMRCDOB,GMRCPNM,GMRCQUT,GMRCPTN,GMRCSSN,GMRCSSNM,GMRCSVCN
"RTN","GMRCPZ",30,0)
 K TO,PL,PROC,SEX,STS,POP,URG,LASTA,ORIOSL,ORPK,ZTDESC,IOTM,IOBM,GMRCQIT,GMRC,GMRCTITL,GMRCTM,GMRCVP,GMRCWARD,GMRCTYPE,GMRCSEL,GMRCTC,GMRCO,GMRCIFN,GMRCT,GMRCSS
"RTN","GMRCPZ",31,0)
 K GMRCH,GMRCHDR,GMRCRPG,GMRCDG,GMRCDGT,GMRCNPG,GMRCACTM,GMRCNM,GMRCPRT,GMRC1,GMRC2,GMRCA,GETPROV,GMRCNAME,GMRCGRP,GMRCDA,GMRCDTM,GMRCACT,GMRCD,GMRCWRD,GMRCWT
"RTN","GMRCPZ",32,0)
 K ORIFN,GMRCDFNS,GMRCFL,GMRCS1,GMRCS2,GMRCDT1,GMRCDT2,GMRCQUIT
"RTN","GMRCPZ",33,0)
 Q
"RTN","GMRCPZ",34,0)
 ;
"RTN","GMRCPZ",35,0)
EXPND ; -- expand code
"RTN","GMRCPZ",36,0)
 Q
"RTN","GMRCPZ",37,0)
 ;
"RTN","GMRCQC")
0^68^B2582558
"RTN","GMRCQC",1,0)
GMRCQC ;SLC/DCM - GMRC List Manager routine to print Consults pending resolution for QC purposes ;5/20/98  14:20
"RTN","GMRCQC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCQC",3,0)
EN ; -- main entry point for GMRC QC CON PENDING RESOLUTION
"RTN","GMRCQC",4,0)
 K GMRCQUT
"RTN","GMRCQC",5,0)
 S DIC="^GMR(123.5,",DIC(0)="AEMQ",DIC("A")="Select Service/Specialty: ",DIC("S")="I $P(^(0),U,2)'=9"
"RTN","GMRCQC",6,0)
 D ^DIC K DIC I $S(Y<1:1,$D(DUOUT):1,$D(DTOUT):1,1:0) S (GMRCQIT,GMRCQUT)=1 K DUOUT,DTOUT,DIROUT Q
"RTN","GMRCQC",7,0)
 S (GMRCSVCP,GMRCSVC)=$P(Y,"^",2),GMRCSVCN=+Y
"RTN","GMRCQC",8,0)
 D EN^VALM("GMRC QC CON PENDING RESOLUTION")
"RTN","GMRCQC",9,0)
 Q
"RTN","GMRCQC",10,0)
 ;
"RTN","GMRCQC",11,0)
HDR ; -- header code
"RTN","GMRCQC",12,0)
 S VALMHDR(1)="CONSULTS/REQUESTS PENDING RESOLUTION"
"RTN","GMRCQC",13,0)
 S VALMHDR(2)="Service: "_GMRCSVCP
"RTN","GMRCQC",14,0)
 Q
"RTN","GMRCQC",15,0)
 ;
"RTN","GMRCQC",16,0)
INIT ; -- init variables and list array
"RTN","GMRCQC",17,0)
 K ^TMP("GMRCR",$J,"QCLIST")
"RTN","GMRCQC",18,0)
 S DSPLINE=0,VALMAR="^TMP(""GMRCR"",$J,""QCLIST"")"
"RTN","GMRCQC",19,0)
 F LINE=1:1:GMRCCT S DSPLINE=$O(^TMP("GMRCR",$J,"CP",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCQC",20,0)
 S VALMCNT=GMRCCT,VALMBCK="R"
"RTN","GMRCQC",21,0)
 K DATA,DSPLINE,LINE
"RTN","GMRCQC",22,0)
 Q
"RTN","GMRCQC",23,0)
 ;
"RTN","GMRCQC",24,0)
HELP ; -- help code
"RTN","GMRCQC",25,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCQC",26,0)
 Q
"RTN","GMRCQC",27,0)
 ;
"RTN","GMRCQC",28,0)
EXIT ; -- exit code
"RTN","GMRCQC",29,0)
 K ^TMP("GMRCR",$J,"CP"),^TMP("GMRCR",$J,"QCLIST")
"RTN","GMRCQC",30,0)
 K GMRCCT,GMRCSVCP,GMRCQUT,GMRCSVTT
"RTN","GMRCQC",31,0)
 Q
"RTN","GMRCQC",32,0)
 ;
"RTN","GMRCQC",33,0)
EXPND ; -- expand code
"RTN","GMRCQC",34,0)
 Q
"RTN","GMRCQC",35,0)
 ;
"RTN","GMRCQCK")
1^109
"RTN","GMRCQCST")
0^69^B25872332
"RTN","GMRCQCST",1,0)
GMRCQCST ;SLC/DCM - Gather all consults for QC that do not have status of discontinued,complete, or expired ;5/21/98  10:53
"RTN","GMRCQCST",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCQCST",3,0)
STS(SRV) ;;Set partial statistics into the ^TMP global for printing
"RTN","GMRCQCST",4,0)
 ;;SRV=Service being worked on
"RTN","GMRCQCST",5,0)
 ;;STS=OERR status of order (3=hold, 4=flagged, 5=pending, etc.)
"RTN","GMRCQCST",6,0)
 S GMRCTOTS=0
"RTN","GMRCQCST",7,0)
 I GMRCSVCP'="ALL SERVICES" S ^TMP("GMRCR",$J,"CP",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCQCST",8,0)
 F K=3,4,5,6,7,8,9,11,99 I $G(GMRCTOT(SRV,K))>0 D
"RTN","GMRCQCST",9,0)
 .S ^TMP("GMRCR",$J,"CP",GMRCCT,0)="Consults "_$S(K=3:"On Hold:    ",K=4:"Flagged:    ",K=5:"Pending:    ",K=6:"Active:     ",K=7:"Expired:    ",K=8:"Scheduled:  ",K=9:"Incomplete: ",K=11:"Unreleased: ",1:"No Status:  ")
"RTN","GMRCQCST",10,0)
 .S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=^TMP("GMRCR",$J,"CP",GMRCCT,0)_$J(GMRCTOT(SRV,K),4,0),GMRCCT=GMRCCT+1,GMRCTOTS=GMRCTOTS+GMRCTOT(SRV,K)
"RTN","GMRCQCST",11,0)
 .Q
"RTN","GMRCQCST",12,0)
 S ^TMP("GMRCR",$J,"CP",GMRCCT,0)="Totals for Service:  "_$J(GMRCTOTS,4,0),GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"CP",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCQCST",13,0)
 Q
"RTN","GMRCQCST",14,0)
EN ;Use fileman to get service
"RTN","GMRCQCST",15,0)
 K GMRCQUT
"RTN","GMRCQCST",16,0)
 S DIC="^GMR(123.5,",DIC(0)="AEMQ",DIC("A")="Select Service/Specialty: ",DIC("S")="I $P(^(0),U,2)'=9"
"RTN","GMRCQCST",17,0)
 D ^DIC K DIC I Y<1!($D(DUOUT)) S GMRCQUT=1 K DIROUT,DUOUT,DTOUT Q
"RTN","GMRCQCST",18,0)
 S (GMRCSVCP,GMRCSVC)=$P(Y,"^",2),GMRCSVCN=+Y
"RTN","GMRCQCST",19,0)
EN1 ;Collect all consults for service chosen, excluding status discontinued
"RTN","GMRCQCST",20,0)
 K ^TMP("GMRCR",$J,"CP")
"RTN","GMRCQCST",21,0)
 S TAB="",$P(TAB," ",30)="",GMRCCT=1,GMRCSND=GMRCSVC,GMRCTOT=0,GMRCTOT(3)=0,GMRCTOT(4)=0,GMRCTOT(5)=0,GMRCTOT(6)=0,GMRCTOT(7)=0,GMRCTOT(8)=0,GMRCTOT(9)=0,GMRCTOT(11)=0,GMRCTOT(99)=0
"RTN","GMRCQCST",22,0)
 S GMRCSVTT=0
"RTN","GMRCQCST",23,0)
 I "ALL SERVICES"[GMRCSVC F  S GMRCSVC=$O(^GMR(123.5,"B",GMRCSVC)) Q:GMRCSVC=""  S GMRCSVCN=0,GMRCSVCN=$O(^GMR(123.5,"B",GMRCSVC,GMRCSVCN)) I $P(^GMR(123.5,GMRCSVCN,0),"^",2)'=9 D  D STS(GMRCSVCN)
"RTN","GMRCQCST",24,0)
 .S ^TMP("GMRCR",$J,"CP",GMRCCT,0)="SERVICE: "_$P(^GMR(123.5,GMRCSVCN,0),"^",1),GMRCCT=GMRCCT+1 D PROC(GMRCSVCN) S ^TMP("GMRCR",$J,"CP",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCQCST",25,0)
 .Q
"RTN","GMRCQCST",26,0)
 I "ALL SERVICES"'[GMRCSVC S ^TMP("GMRCR",$J,"CP",GMRCCT,0)="SERVICE: "_GMRCSVC,GMRCCT=GMRCCT+1 D PROC(GMRCSVCN),STS(GMRCSVCN) D KILL S GMRCCT=GMRCCT-1 Q
"RTN","GMRCQCST",27,0)
 S ^TMP("GMRCR",$J,"CP",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCQCST",28,0)
 S ^TMP("GMRCR",$J,"CP",GMRCCT,0)="SUMMARY STATISTICS (ALL SERVICES)",GMRCCT=GMRCCT+1 D
"RTN","GMRCQCST",29,0)
 .F I=3,4,5,6,7,8,9,11,99 I GMRCTOT(I)>0 S ^TMP("GMRCR",$J,"CP",GMRCCT,0)="Total Consults/Requests " D
"RTN","GMRCQCST",30,0)
 ..S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=^TMP("GMRCR",$J,"CP",GMRCCT,0)_$S(I=3:"On Hold:     ",I=4:"Flagged:    ",I=5:"Pending:    ",I=6:"Active:     ",I=7:"Expired:    ",I=8:"Scheduled:  ",I=9:"Incomplete: ",I=11:"Unreleased: ",1:"No Status:  ")
"RTN","GMRCQCST",31,0)
 ..S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=^TMP("GMRCR",$J,"CP",GMRCCT,0)_$J(GMRCTOT(I),4,0),GMRCCT=GMRCCT+1
"RTN","GMRCQCST",32,0)
 ..Q
"RTN","GMRCQCST",33,0)
 .Q
"RTN","GMRCQCST",34,0)
 S ^TMP("GMRCR",$J,"CP",GMRCCT,0)="Total Pending Resolution For All Services: "_GMRCTOT,GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"CP",GMRCCT,0)=""
"RTN","GMRCQCST",35,0)
 S GMRCCT=GMRCCT-1
"RTN","GMRCQCST",36,0)
 D KILL
"RTN","GMRCQCST",37,0)
 Q
"RTN","GMRCQCST",38,0)
PROC(GMRCSRV) ;Set status' info into the ^TMP global
"RTN","GMRCQCST",39,0)
 F I=3,4,5,6,7,8,9,11,99 S GMRCXDT=0,GMRCTOT(GMRCSRV,I)=0 F  S GMRCXDT=$O(^GMR(123,"AE",GMRCSRV,I,GMRCXDT)) Q:GMRCXDT=""  D
"RTN","GMRCQCST",40,0)
 .S GMRCPT=0 F  S GMRCPT=$O(^GMR(123,"AE",GMRCSRV,I,GMRCXDT,GMRCPT)) Q:GMRCPT=""  D  S GMRCTOT=GMRCTOT+1,GMRCTOT(I)=GMRCTOT(I)+1,GMRCTOT(GMRCSRV,I)=GMRCTOT(GMRCSRV,I)+1
"RTN","GMRCQCST",41,0)
 ..S X=9999999-GMRCXDT D REGDTM^GMRCU S GMRCDT=$P(X," ",1)
"RTN","GMRCQCST",42,0)
 ..S GMRCDLA=$P(X," ",1),GMRCD(0)=^GMR(123,GMRCPT,0) S GMRCPTN=$P(^DPT($P(GMRCD(0),"^",2),0),"^",1),GMRCPTN=$P(GMRCPTN,",",1)_","_$E($P(GMRCPTN,",",2),1)_".",GMRCPTSN="("_$E($P(^(0),"^",9),6,9)_")"
"RTN","GMRCQCST",43,0)
 ..S GMRCD=0,GMRCD=$O(^GMR(123,GMRCPT,40,"B",GMRCD)) I GMRCD]"" S GMRCDA="",GMRCDA=$O(^GMR(123,+GMRCPT,40,"B",GMRCD,GMRCDA)) I GMRCDA]"" S GMRCDA(0)=^GMR(123,GMRCPT,40,GMRCDA,0) D
"RTN","GMRCQCST",44,0)
 ...S GMRCDLA=$E($P($G(^GMR(123.1,$P(GMRCDA(0),"^",2),0)),"^"),1,20)
"RTN","GMRCQCST",45,0)
 ...Q
"RTN","GMRCQCST",46,0)
 ..S GMRCLOC=$P(GMRCD(0),"^",4) S:+GMRCLOC GMRCLOC=$P(^SC(GMRCLOC,0),"^",1)
"RTN","GMRCQCST",47,0)
 ..S STS=$S(I=1:"Discontinued",I=3:"Hold",I=4:"Flagged",I=5:"Pending",I=6:"Active",I=7:"Expired",I=11:"Unreleased",1:"No Status")
"RTN","GMRCQCST",48,0)
 ..S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=STS_$E(TAB,1,10-$L(STS)+1)_GMRCDLA_$E(TAB,1,18-$L(GMRCDLA))_GMRCDT_" "_GMRCPTN_" "_GMRCPTSN_$E(TAB,1,10-$L(GMRCPTN)+5)_GMRCLOC,GMRCCT=GMRCCT+1
"RTN","GMRCQCST",49,0)
 ..Q
"RTN","GMRCQCST",50,0)
 .Q
"RTN","GMRCQCST",51,0)
 Q
"RTN","GMRCQCST",52,0)
KILL ;Kill all variables
"RTN","GMRCQCST",53,0)
 K I,K,Y,STS,TAB,GMRCT,GMRCD,GMRCDA,GMRCDT,GMRCPT,GMRCND,GMRCDLA,GMRCTM,GMRCBM,GMRCPTN,GMRCTOT,GMRCTOTS,GMRCPTSN,GMRCSND,GMRCSVC,GMRCSRV,GMRCSVCN,GMRCLOC,GMRCSVCN,GMRCXDT Q
"RTN","GMRCQCST",54,0)
 Q
"RTN","GMRCR")
0^70^B16404947
"RTN","GMRCR",1,0)
GMRCR ;SLC/DLT - Driver for reviewing patient consult/requests - Used by Medicine Package to link Consults to Medicine results ;9/18/98  16:26
"RTN","GMRCR",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCR",3,0)
EN ;Entry point for medicine results entry by procedure or consult type
"RTN","GMRCR",4,0)
 ;Required variables:
"RTN","GMRCR",5,0)
 ;  GMRCPRNM = name of procedure file with results.
"RTN","GMRCR",6,0)
 ;  DFN = patient file (2) ien
"RTN","GMRCR",7,0)
 ;Optional variables:
"RTN","GMRCR",8,0)
 ;  GMRCSR = variable pointer for results
"RTN","GMRCR",9,0)
 ;  ORSTS = order status
"RTN","GMRCR",10,0)
 ;  GMRCI = 0 or undefined, assume interactive
"RTN","GMRCR",11,0)
 ;          1, assume non-interactive - not operational currently
"RTN","GMRCR",12,0)
 ;Returned variables:
"RTN","GMRCR",13,0)
 ;  ORIFN = Pointer to the consult order in file 100
"RTN","GMRCR",14,0)
 ;  GMRCO = Pointer to the Request/Consultation entry in file 123.5
"RTN","GMRCR",15,0)
 ;
"RTN","GMRCR",16,0)
 K DTOUT,DUOUT,ORIFN,GMRCO,GMRCX
"RTN","GMRCR",17,0)
 I '$D(GMRCPNM) D DEM^GMRCU
"RTN","GMRCR",18,0)
 I $D(GMRCPRNM) S GMRC=$O(^ORD(101,"B","GMRCR "_GMRCPRNM,0)),GMRCTYPE="GMRCOR REQUEST"
"RTN","GMRCR",19,0)
 E  I $D(GMRCPR) S GMRC=GMRCPR,GMRCTYPE="GMRCOR REQUEST"
"RTN","GMRCR",20,0)
 I $D(GMRCCT) S GMRC=GMRCCT,GMRCTYPE="GMRCOR CONSULT"
"RTN","GMRCR",21,0)
 I $D(GMRC)=1!($D(GMRC)=11),+GMRC D
"RTN","GMRCR",22,0)
 .S GMRCVP=GMRC_";ORD(101,",GMRCNM=$S($D(^ORD(101,GMRC,0)):$P(^(0),"^",2),1:"")
"RTN","GMRCR",23,0)
 .S GMRCSS=$P($G(^ORD(101,+GMRCVP,5)),"^"),GMRCSS=+GMRCSS
"RTN","GMRCR",24,0)
EN1 ;Entry point for
"RTN","GMRCR",25,0)
 Q  I 'GMRCSS D ASRV^GMRCASV D  Q:GMRCEND  S GMRCSS=+GMRCDG I 'GMRCDG S GMRCEND=1 K GMRCSS Q
"RTN","GMRCR",26,0)
 .I $D(DTOUT)!($D(DIROUT)) S GMRCEND=1 K DTOUT,DIROUT,DIRUT,DUOUT Q
"RTN","GMRCR",27,0)
 .Q
"RTN","GMRCR",28,0)
 E  S GMRCDG=GMRCSS D SERV1^GMRCASV
"RTN","GMRCR",29,0)
 I '$D(ORTKG) S ORTKG=$$PACKAGE I ORTKG="" S GMRCMSG="Missing package entry for CONSULT/REQUEST TRACKING" D EXAC^GMRCADC(GMRCMSG) K GMRCMSG S GMRCEND=1 Q
"RTN","GMRCR",30,0)
 ;old code? D TEAM^GMRCASV
"RTN","GMRCR",31,0)
 S GMRCSSNM=$P(^GMR(123.5,GMRCSS,0),"^",1)
"RTN","GMRCR",32,0)
 ;old codeN GMRCQIT
"RTN","GMRCR",33,0)
 ;old code? S ORVP=DFN_";DPT(",GMRCGRP=0
"RTN","GMRCR",34,0)
 ;old code? K ^TMP("GMRCR",$J)
"RTN","GMRCR",35,0)
 K GMRCOER,GMRCQUT
"RTN","GMRCR",36,0)
 S GMRCEN=1
"RTN","GMRCR",37,0)
 D EN^GMRCMENU ; used to be D EN^GMRCACTM
"RTN","GMRCR",38,0)
 S GMRCOER=0
"RTN","GMRCR",39,0)
 D AD^GMRCSLM1 ; used to be D AD^GMRCRA
"RTN","GMRCR",40,0)
 D EN^VALM("GMRC CONSULT TRACKING")
"RTN","GMRCR",41,0)
 D KILL
"RTN","GMRCR",42,0)
 Q
"RTN","GMRCR",43,0)
KILL ; Kill variables, but don't kill GMRCO and ORIFN if from MC option
"RTN","GMRCR",44,0)
 ;K VALMCNT,VALMBCK,VALMPGE
"RTN","GMRCR",45,0)
 ;K ^TMP("GMRCR",$J,"CS"),^TMP("GMRCS",$J)
"RTN","GMRCR",46,0)
 K X,Y,Z,DTOUT,DUOUT,DIROUT
"RTN","GMRCR",47,0)
 K GMRC,GMRCA,GMRCACT,GMRCACTM,GMRCAGE,GMRCCT,GMRCCTX,GMRCDG,GMRCDGT
"RTN","GMRCR",48,0)
 K GMRCDOB,GMRCDTM,GMRCGRP,GMRCH,GMRCHDR,GMRCIFN,GMRCLFG,GMRCNM,GMRCNPG
"RTN","GMRCR",49,0)
 K GMRCPNM,GMRCRB,GMRCWARD,GMRCSN,GMRCRPG,GMRCNPG,GMRCTITL,GMRCX,GMRCHDR,GMRCH,GMRCDTM
"RTN","GMRCR",50,0)
 K GMRCSTS,GMRCTYPE,GMRCVP,GMRCEND,GMRCTO,GMRCURG,GMRCL,GMRCDT,GMRCDIC
"RTN","GMRCR",51,0)
 K VA,VAIN,VAINDT,VADM,VAEL,VAPA,VAERR,VAROOT
"RTN","GMRCR",52,0)
 K O,OREND,ORINDX,ORNS,POP,SEX,W,XQORSPEW
"RTN","GMRCR",53,0)
 I $D(XQY0),$E(XQY0,1,2)="MC" S:'$D(GMRCO) (ORIFN,GMRCO)="" Q
"RTN","GMRCR",54,0)
 K ORIFN,GMRCO,GMRCSR
"RTN","GMRCR",55,0)
 Q
"RTN","GMRCR",56,0)
RESULT ;Entry point to set up variable pointer to results and update OE/RR status
"RTN","GMRCR",57,0)
 Q
"RTN","GMRCR",58,0)
 Q:'$D(GMRCSR)  Q:'$D(GMRCO)  S (GMRCSS,GMRCSSNM,GMRCNM,GMRC,GMRCVP)=""
"RTN","GMRCR",59,0)
 S GMRCOM=0,GMR(0)=$S($D(^GMR(123,+GMRCO,0)):^(0),1:""),GMRCSS=$P(GMR(0),"^",5) I GMRCSS,$D(^GMR(123.5,GMRCSS,0)) S GMRCSSNM=$S($L($P(^GMR(123.5,GMRCSS,0),"^",9)):$P(^(0),"^",9),1:$P(^(0),"^"))
"RTN","GMRCR",60,0)
 S GMRCVP=$P(GMR(0),"^",8) I +GMRCVP S DIC="^"_$P(GMRCVP,";",2)_$P(GMRCVP,";")_",0)" I $L(DIC),$D(@DIC) S GMRCNM=@(DIC),GMRCNM=$P(GMRCNM,"^",2)
"RTN","GMRCR",61,0)
 I '$D(ORSTS) S ORSTS=6 ;Assume order entry status of active
"RTN","GMRCR",62,0)
 S GMRCA=$O(^GMR(123.1,"AC",+ORSTS,"")) I 'GMRCA S GMRCA=9
"RTN","GMRCR",63,0)
 S DIE=123,DA=GMRCO,DR="11////^S X=GMRCSR;8////^S X=ORSTS;9////^S X=GMRCA"
"RTN","GMRCR",64,0)
 L +^GMR(123,GMRCO) I '$T S GMRCMSG="Consult/Request Is Being Used By Another User.",GMRCMSG(1)="RESULT UPDATE WAS UNSUCCESSFUL!  Try Again Later" D EXAC^GMRCADC(.GMRCMSG) K GMRCO,ORIFN,GMRCMSG D KILL Q
"RTN","GMRCR",65,0)
 D ^DIE K DIE,DA,DR
"RTN","GMRCR",66,0)
 L -^GMR(123,GMRCO) D AUDIT^GMRCP
"RTN","GMRCR",67,0)
 S:'$D(ORIFN) ORIFN=$P(^GMR(123,+GMRCO,0),"^",3)
"RTN","GMRCR",68,0)
 S GMRCORNP=$P(GMR(0),"^",14),GMRCTYPE=$P(GMR(0),"^",17)
"RTN","GMRCR",69,0)
 I $L($P(GMR(0),"^",14)) S ORBADUZ($P(GMR(0),"^",14))=""
"RTN","GMRCR",70,0)
 I ORIFN D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCR",71,0)
 K GMR,GMRCSS,GMRCORVP,GMRCVP,GMRCNM,DIC,GMRCPR
"RTN","GMRCR",72,0)
 Q
"RTN","GMRCR",73,0)
 ;
"RTN","GMRCR",74,0)
PACKAGE() ;  Returns the package entry number for 'CONSULT/REQUEST TRACKING"
"RTN","GMRCR",75,0)
 Q $$FIND1^DIC(9.4,,"QX","CONSULT/REQUEST TRACKING")
"RTN","GMRCR",76,0)
 ;
"RTN","GMRCR06")
0^72^B4536466
"RTN","GMRCR06",1,0)
GMRCR06 ;SLC/DLT - Complete a consult/request. Temporary routine until TIU interface becomes functional ;5/20/98  14:20
"RTN","GMRCR06",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCR06",3,0)
END K DUOUT,X,Y,GMRCPL,GMRCPLI,GMRCURG,GMRCURGI,GMRCPRI,XQORM
"RTN","GMRCR06",4,0)
 I '$D(GMRCNM) K GMRCVP
"RTN","GMRCR06",5,0)
 K GMRCDT,GMRCAD,GMRCL,GMRCTYPE
"RTN","GMRCR06",6,0)
 I '$D(GMRCO) S (GMRCO,ORIFN)=""
"RTN","GMRCR06",7,0)
 Q
"RTN","GMRCR06",8,0)
6 ;Complete an order ; temporary routine until TIU interface is complete
"RTN","GMRCR06",9,0)
 N ORIFN
"RTN","GMRCR06",10,0)
 S GMRC(0)=^GMR(123,GMRCO,0)
"RTN","GMRCR06",11,0)
 S STS=$P(GMRC(0),"^",12) I $S(STS<3:1,STS=7:1,1:0) S GMRCMSG="This order has already been completed or discontinued!" D EXAC^GMRCADC(GMRCMSG) S GMRCQUT=1 G END6
"RTN","GMRCR06",12,0)
 S ORGY="",(GMRCIFN,ORIFN)=$P(GMRC(0),"^",3),GMRCORVP=$P(GMRC(0),"^",2)_";DPT("
"RTN","GMRCR06",13,0)
 K GETPROV D GETPROV^GMRCAU I $D(DIROUT)!$D(DTOUT)!$D(DUOUT) G END
"RTN","GMRCR06",14,0)
 K GETDT D GETDT^GMRCAU I $D(DIRUT) G END
"RTN","GMRCR06",15,0)
 K DIR S DIR(0)="YA",DIR("A")="Are there significant findings? (Y/N)"
"RTN","GMRCR06",16,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","GMRCR06",17,0)
 S $P(^GMR(123,+GMRCO,0),"^",19)=$E(Y(0))
"RTN","GMRCR06",18,0)
 I +$G(Y) S $P(^TMP("GMRCR",$J,GMRCSEL,0),"^",19)="Y"
"RTN","GMRCR06",19,0)
 S $P(GMRC(0),"^",12)=2,GMRCSTS=2
"RTN","GMRCR06",20,0)
 D STATUS^GMRCP S GMRCSA=GMRCA S GMRCOM=1 D AUDIT^GMRCP
"RTN","GMRCR06",21,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCR06",22,0)
 I $P(^GMR(123,GMRCO,0),"^",14) S ORBADUZ($P(^(0),"^",14))=""
"RTN","GMRCR06",23,0)
 S GMRCORTX="Completed Consult "_$S($P(^GMR(123,GMRCO,0),"^",8)]"":": "_$P(^ORD(101,+$P(^GMR(123,GMRCO,0),"^",8),0),"^",2),1:"")
"RTN","GMRCR06",24,0)
 I $O(ORBADUZ(0)) D MSG^GMRCP($P(^GMR(123,GMRCO,0),"^",2),GMRCORTX,+GMRCO,23,.ORBADUZ,0)
"RTN","GMRCR06",25,0)
END6 K GMRCIFN,GMRCMSG,GMRCORTX,GMRCSA,GMRCSTS,ORBADUZ,STS
"RTN","GMRCR06",26,0)
 Q
"RTN","GMRCRA")
0^74^B5426735
"RTN","GMRCRA",1,0)
GMRCRA ;SLC/DLT - Build ^TMP("GMRCR",$J, array of consults ;5/20/98  14:20
"RTN","GMRCRA",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCRA",3,0)
AD ;Loop thru AD cross reference
"RTN","GMRCRA",4,0)
 D PRE
"RTN","GMRCRA",5,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,"AD",DFN,GMRCD)) Q:'GMRCD!($D(GMRCQIT))  S GMRCDA=0 F  S GMRCDA=$O(^GMR(123,"AD",DFN,GMRCD,GMRCDA)) Q:'GMRCDA!($D(GMRCQIT))  D ADBUILD Q:$D(GMRCQIT)
"RTN","GMRCRA",6,0)
 S GMRCTC=GMRCT
"RTN","GMRCRA",7,0)
 Q
"RTN","GMRCRA",8,0)
ADBUILD ;Check for Service Match
"RTN","GMRCRA",9,0)
 I $P(^GMR(123,GMRCDA,0),"^",5),'$D(^TMP("GMRCS",$J,$P(^(0),"^",5))) Q
"RTN","GMRCRA",10,0)
 D BUILD Q
"RTN","GMRCRA",11,0)
AESS ;Build array based on service (variable GMRCSS) and single patient
"RTN","GMRCRA",12,0)
 D PRE
"RTN","GMRCRA",13,0)
 I '$D(^TMP("GMRCS",$J)) Q:'$D(GMRC1)  D:GMRC1 AECONT Q
"RTN","GMRCRA",14,0)
 E  S GMRCTO="" F  S GMRCTO=$O(^TMP("GMRCS",$J,GMRCTO)) Q:GMRCTO=""  S GMRC1=GMRCTO D AECONT
"RTN","GMRCRA",15,0)
 S GMRCTC=GMRCT S GMRCT=$S(GMRCT:1,1:0) ;INITIALIZE COUNT TO 1 FOR HDR
"RTN","GMRCRA",16,0)
 Q
"RTN","GMRCRA",17,0)
AECONT S GMRC2=0 F  S GMRC2=$O(^GMR(123,"AE",GMRC1,DFN,GMRC2)) Q:'GMRC2!($D(GMRCQIT))  S GMRCDA=0 F  S GMRCDA=$O(^GMR(123,"AE",GMRC1,DFN,GMRC2,GMRCDA)) Q:'GMRCDA!($D(GMRCQIT))  D BUILD Q:$D(GMRCQIT)
"RTN","GMRCRA",18,0)
 Q
"RTN","GMRCRA",19,0)
BUILD ;Build array
"RTN","GMRCRA",20,0)
 Q:$P(^GMR(123,GMRCDA,0),"^",12)=11  ;Do not include unreleased orders
"RTN","GMRCRA",21,0)
 S GMRCT=GMRCT+1,^TMP("GMRCR",$J,GMRCT,0)=^GMR(123,GMRCDA,0)
"RTN","GMRCRA",22,0)
 S:$D(^GMR(123,GMRCDA,30)) ^TMP("GMRCR",$J,GMRCT,30)=^(30)
"RTN","GMRCRA",23,0)
 S ^TMP("GMRCR",$J,GMRCT,"DA")=GMRCDA
"RTN","GMRCRA",24,0)
 Q
"RTN","GMRCRA",25,0)
PRE ;Setup for creating array of consults
"RTN","GMRCRA",26,0)
 S (GMRCTC,GMRCT,GMRC2,GMRCDA)=0,GMRC1=GMRCSS K GMRC,^TMP("GMRCR",$J)
"RTN","GMRCRA",27,0)
 Q
"RTN","GMRCRA",28,0)
END K GMRCD,GMRCDA,%T,DIC,GMRC,GMRCLO,GMRCPNM,GMRCRB,GMRCWARD,GMRCDOB,DIC,X,Y,VA,VAIN,VAINDT,VADM,VAEL,VAPA,VAERR,GMRCSN,GMRC0,GMRC1,GMRC2
"RTN","GMRCREXT")
0^75^B1712931
"RTN","GMRCREXT",1,0)
GMRCREXT ;SLC/DCM - clean-up all variables and ^TMP globals upon exit. ;5/20/98  14:20
"RTN","GMRCREXT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCREXT",3,0)
 K ^TMP("GMRCR",$J),^TMP("GMRCS",$J)
"RTN","GMRCREXT",4,0)
 K DFN,BLK,C,CDT,CNT,TAB,LNCT,CTRLCOL,D1,DATA,GMRCDT,GMRCND,GMRCNO,GMRCDT1,GMRCDT2,GMRCSEX,GMRCPNM,GMRCSSN,SEX,GMRCPTN,GMRCSVCP,GMRCWRD,GMRCWT,GMRCDFN
"RTN","GMRCREXT",5,0)
 K GMRCRB,GMRCAGE,GMRCCT,GMRCSN,GMRCSSNM,GMRCDOB,GMRCDGT,GMRCDOB,GMRCGRP,GMRCWRD,GMRCNUL,GMRCQUIT,GMRCELIG,GMRCNUL,GMRCOER,GMRCSEL,GMRCOK
"RTN","GMRCREXT",6,0)
 K GMRCBM,GMRCTM,GMRCNUL,GMRCAD,GMRCXMF,GMRC
"RTN","GMRCREXT",7,0)
 Q
"RTN","GMRCS")
0^77^B5030003
"RTN","GMRCS",1,0)
GMRCS ;SLC/DLT - Review consults by Patient and Service ;5/20/98  14:20
"RTN","GMRCS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCS",3,0)
SELCT ;Select a Consult Type from the protocol file
"RTN","GMRCS",4,0)
 S DIC=101,DIC(0)="AEMQZ",DIC("A")="Select Consult Type: ",DIC("B")="GMRCT TPN" D ^DIC K DIC Q:Y<0  S GMRCCT=+7
"RTN","GMRCS",5,0)
 Q
"RTN","GMRCS",6,0)
SELPT K DIC S DIC=2,DIC("A")="Select Patient: ",DIC(0)="AEQM" D ^DIC K DIC S DFN=+Y
"RTN","GMRCS",7,0)
 I X="^"!(Y=-1) S GMRCQUT=1 K DFN Q
"RTN","GMRCS",8,0)
 D DEM^GMRCU
"RTN","GMRCS",9,0)
 Q
"RTN","GMRCS",10,0)
SELPR ;Get Procedure
"RTN","GMRCS",11,0)
 K GMRCPRNM,GMRCQUT
"RTN","GMRCS",12,0)
 S Y=$O(^ORD(101,"B","GMRCRM MEDICINE REQUEST TYPES",0)) Q:Y=""
"RTN","GMRCS",13,0)
 S XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Select Procedure: ",XQORM("NO^^")=""
"RTN","GMRCS",14,0)
 D EN^XQORM K XQORM I Y<0 S GMRCQUT=1 K GMRCPR,GMRCPRNM,GMRCCT Q
"RTN","GMRCS",15,0)
 S GMRCPR=$P(Y(1),"^",2)
"RTN","GMRCS",16,0)
 Q
"RTN","GMRCS",17,0)
EXIT ;Exit action logic
"RTN","GMRCS",18,0)
 K GMRCA,GMRCACT,GMRCACTM,GMRCAGE,GMRCCT,GMRCCTX,GMRCDG,GMRCDGT,GMRCDOB,GMRCDTM,GMRCGRP,GMRCH,GMRCHDR,GMRCIFN,GMRCLFG,GMRCNM,GMRCNPG,GMRCPG,GMRCPNM,GMRCPR,GMRCRB,GMRCRPG
"RTN","GMRCS",19,0)
 K GMRCSN,GMRCSS,GMRCSSNM,GMRCTC,GMRCTITL,GMRCTM,GMRCTYPE,GMRCVP,GMRCWARD,SEX,VAROOT,W
"RTN","GMRCS",20,0)
 K DFN,HEAD,GMRCEND,GMRCORNP,GMRCORVP,GETPROV,GMRCDEV,GMRCDIC,GMRCPLI,GMRCPRI,GMRCURGI,GMRCGL,GMRCSR,GMRCSRDT,GMRCSRS,GMRCORVP,LASTA,MCBRANCH,MCC,MCK,MCPROC
"RTN","GMRCS",21,0)
 K O,ORGY,ORL,ORNP,ORNS,OREND,ORIOSL,ORPK,ORTKG,ORTO,ORTX,ORSTS,ORACTION,ORANSI,ORATTEND,ORI,ORSSN,ORTIT,ORTS,ORINDX,Z,ZTDESC
"RTN","GMRCS",22,0)
 Q
"RTN","GMRCSL")
0^79^B1737920
"RTN","GMRCSL",1,0)
GMRCSL ;SLC/DLT - Active Consults by Service ;5/20/98  14:20
"RTN","GMRCSL",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCSL",3,0)
 S U="^",DIC="^GMR(123.5,",DIC(0)="AEMQF",DIC("A")="Select Service/Specialty: " D ^DIC K DIC G:Y=-1 END S FR=$P(Y,"^",2)_",?",TO=FR
"RTN","GMRCSL",4,0)
 S DIS(0)="I ""5689""[$P(^GMR(123,D0,0),U,12)"
"RTN","GMRCSL",5,0)
 S DIC=123,BY="[GMRC CONSULTS LIST]",DHD="[GMRC CONSULTS LIST HEADER]",FLDS="[GMRC CONSULTS LIST]",L=0 D EN1^DIP
"RTN","GMRCSL",6,0)
END K DIC,BY,DHD,FLDS,FR,TO,DIS,L Q
"RTN","GMRCSL",7,0)
DT ;FORMAT DATE AND PRINT
"RTN","GMRCSL",8,0)
 S GMRCX=X N X S X=$P(GMRCX,U,7) D REGDTM^GMRCU W ?26," "_X K X
"RTN","GMRCSL",9,0)
 S GMRCPAT=$P(GMRCX,U,2)
"RTN","GMRCSL",10,0)
 K GMRCX Q
"RTN","GMRCSL",11,0)
PAT ;Get VA("BID")
"RTN","GMRCSL",12,0)
 S DFN=GMRCPAT D DEM^VADPT W ?45,$E(VADM(1),1,15),?62,VA("BID")_" " K VA,VAERR,VADM,DFN,GMRCPAT
"RTN","GMRCSL",13,0)
 Q
"RTN","GMRCSL",14,0)
 Q
"RTN","GMRCSLDT")
0^80^B7506061
"RTN","GMRCSLDT",1,0)
GMRCSLDT ;SLC/DCM - Get consult number for detailed tracking history for a single consult then call routine to format it.  List Manager formatted ;5/20/98  14:20
"RTN","GMRCSLDT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCSLDT",3,0)
HDR ;Header code for detailed display.
"RTN","GMRCSLDT",4,0)
 D EN4^GMRVUTL S GMRCWT=$G(X) D DEM^VADPT S GMRCDOB=$P($G(VADM(3)),"^",2) K VADM
"RTN","GMRCSLDT",5,0)
 S VALMHDR(1)="CONSULT DETAILED DISPLAY"_TAB_"Consult No.: "_GMRCND,VALMHDR(2)=$P(^DPT(DFN,0),"^",1)_$E(TAB,1,5)_GMRCSSN_$E(TAB,1,5)_"DOB: "_GMRCDOB_" ("_GMRCAGE_")"_$E(TAB,1,2)_"Wt. (lb): "_$S($L(GMRCWT):GMRCWT,1:"No Entry")
"RTN","GMRCSLDT",6,0)
 Q
"RTN","GMRCSLDT",7,0)
EN ;Select a consult for detailed display of information.
"RTN","GMRCSLDT",8,0)
 K GMRCQUT
"RTN","GMRCSLDT",9,0)
 I '$O(^TMP("GMRCR",$J,"CS","AD",0)) S GMRCMSG="No Consults Exist For A Detailed Display!" D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q
"RTN","GMRCSLDT",10,0)
 I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR")
"RTN","GMRCSLDT",11,0)
 I $D(GMRCSEL) S GMRCNO=GMRCSEL
"RTN","GMRCSLDT",12,0)
 I '$D(GMRCSEL),LNCT=1 S GMRCNO=LNCT
"RTN","GMRCSLDT",13,0)
 I '$D(GMRCSEL),LNCT>1 W !,"Select Consult Number: " R GMRCNO:DTIME I $S('$T:1,GMRCNO="":1,GMRCNO?1"^".E:1,1:0) S GMRCQUT=1 Q
"RTN","GMRCSLDT",14,0)
 I $S(GMRCNO<1:1,GMRCNO>BLK:1,GMRCNO'=+GMRCNO:1,GMRCNO?1P.E:1,1:0) W !,"Type A Number From 1 To "_BLK,! K GMRCNO,GMRCSEL G EN
"RTN","GMRCSLDT",15,0)
 S GMRCDT=$O(^TMP("GMRCR",$J,"CS","AD",GMRCNO,0)),GMRCND=$O(^TMP("GMRCR",$J,"CS","AD",GMRCNO,GMRCDT,0))
"RTN","GMRCSLDT",16,0)
 W !!,"Compiling Report..."
"RTN","GMRCSLDT",17,0)
 D LMFMT(GMRCND)
"RTN","GMRCSLDT",18,0)
 D EN^VALM("GMRC DETAILED DISPLAY")
"RTN","GMRCSLDT",19,0)
 Q
"RTN","GMRCSLDT",20,0)
LMFMT(GMRCND) ;Build the ^TMP("GMRCR",$J,"DT", global and format the header variables and set the data into List Manager for display of detailed data.
"RTN","GMRCSLDT",21,0)
 N DFN,GMRCAGE,GMRCDOB,GMRCPNM,GMRCSSN,GMRCSS,GMRCSSN,VALMHDR
"RTN","GMRCSLDT",22,0)
 S:'$D(TAB) TAB="",$P(TAB," ",30)=""
"RTN","GMRCSLDT",23,0)
 S DFN=$P(^GMR(123,GMRCND,0),"^",2) D DEM^GMRCU
"RTN","GMRCSLDT",24,0)
 S GMRCSS=$P(^GMR(123,GMRCND,0),"^",5) S GMRCSSN=$S(GMRCSS]"":$P($G(^GMR(123.5,GMRCSS,0)),"^",1),1:"Unknown Location")
"RTN","GMRCSLDT",25,0)
 D DT^GMRCSLM2(+GMRCND)
"RTN","GMRCSLDT",26,0)
 I $D(GMRCQUT) Q
"RTN","GMRCSLDT",27,0)
 K ^TMP("GMRCR",$J,"DTLIST") S DSPLINE=0,VALMAR="^TMP(""GMRCR"",$J,""DTLIST"")"
"RTN","GMRCSLDT",28,0)
 F LINE=1:1:GMRCCT S DSPLINE=$O(^TMP("GMRCR",$J,"DT",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCSLDT",29,0)
 S VALMCNT=GMRCCT-1,XQORM("A")="Select Action: "
"RTN","GMRCSLDT",30,0)
 K DSPLINE,LINE,DATA
"RTN","GMRCSLDT",31,0)
 Q
"RTN","GMRCSLDT",32,0)
EXIT K ^TMP("GMRCR",$J,"DT"),GMRCCT
"RTN","GMRCSLDT",33,0)
 D KILL^VALM10(GMRCNO)
"RTN","GMRCSLDT",34,0)
 K GMRCWT
"RTN","GMRCSLDT",35,0)
 Q
"RTN","GMRCSLM")
0^81^B28935805
"RTN","GMRCSLM",1,0)
GMRCSLM ;SLC/DCM - GMRC List Manager Routine - Main routine for consult tracking, list consults pending resolution ;5/20/98  14:20
"RTN","GMRCSLM",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCSLM",3,0)
EN ; -- main entry point for GMRC CONSULT TRACKING
"RTN","GMRCSLM",4,0)
 K GMRCOER
"RTN","GMRCSLM",5,0)
 S GMRCEN=1 K GMRCQUT
"RTN","GMRCSLM",6,0)
 D SP K GMRCEN I $D(GMRCQUT) K GMRCQUT Q
"RTN","GMRCSLM",7,0)
 D EN^VALM("GMRC CONSULT TRACKING")
"RTN","GMRCSLM",8,0)
 Q
"RTN","GMRCSLM",9,0)
 ;
"RTN","GMRCSLM",10,0)
HDR ; -- header code
"RTN","GMRCSLM",11,0)
 I $S('$D(TAB):1,'$L(TAB):1,1:0) S TAB="",$P(TAB," ",32)=""
"RTN","GMRCSLM",12,0)
 S GMRCPTN=$P(^DPT(DFN,0),"^",1)
"RTN","GMRCSLM",13,0)
 D EN4^GMRVUTL S GMRCWT=X
"RTN","GMRCSLM",14,0)
 D DEM^VADPT
"RTN","GMRCSLM",15,0)
 S GMRCSN=$P(VADM(2),"^",1),GMRCSSN=$P(VADM(2),"^",2)
"RTN","GMRCSLM",16,0)
 S VALMHDR(1)=$E(VADM(1),1,25)_$E(TAB,1,25-$L(VADM(1)))_GMRCSSN_$E(TAB,1,3)_$G(GMRCWRD)_$E(TAB,1,5-$L($G(GMRCWRD)))_$P(VADM(3),"^",2)_$E(TAB,1,10-$L($P(VADM(3),"^",2)))_$S($L(VADM(4)):" ("_VADM(4)_")",1:"")_$E(TAB,1,4)_"Wt (lb): "_GMRCWT
"RTN","GMRCSLM",17,0)
 K VADM
"RTN","GMRCSLM",18,0)
 Q
"RTN","GMRCSLM",19,0)
 ;
"RTN","GMRCSLM",20,0)
INIT ; -- init variables and list array
"RTN","GMRCSLM",21,0)
 K ^TMP("GMRCR",$J,"LIST")
"RTN","GMRCSLM",22,0)
 S DSPLINE=0,DATA="",VALMAR="^TMP(""GMRCR"",$J,""LIST"")"
"RTN","GMRCSLM",23,0)
 F LINE=1:1:LNCT S DSPLINE=$O(^TMP("GMRCR",$J,"CS",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCSLM",24,0)
 S VALMCNT=LNCT,VALMPGE=1,XQORM("A")="Select Action: "
"RTN","GMRCSLM",25,0)
 K DSPLINE,DATA,LINE
"RTN","GMRCSLM",26,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCSLM",27,0)
 Q
"RTN","GMRCSLM",28,0)
 ;
"RTN","GMRCSLM",29,0)
HELP ; -- help code
"RTN","GMRCSLM",30,0)
 Q
"RTN","GMRCSLM",31,0)
 ;
"RTN","GMRCSLM",32,0)
EXIT ; -- exit code
"RTN","GMRCSLM",33,0)
 K ^TMP("GMRCR",$J,"LIST")
"RTN","GMRCSLM",34,0)
 K VALMCNT,VALMBCK,VALMPGE
"RTN","GMRCSLM",35,0)
 D ^GMRCREXT
"RTN","GMRCSLM",36,0)
 Q
"RTN","GMRCSLM",37,0)
 ;
"RTN","GMRCSLM",38,0)
EXPND ; -- expand code
"RTN","GMRCSLM",39,0)
 Q
"RTN","GMRCSLM",40,0)
 ;
"RTN","GMRCSLM",41,0)
PHYEN ;Entry Point When Provider's service is known and only needs to look at consults for that service
"RTN","GMRCSLM",42,0)
 Q:'$D(DUZ)  Q:'$D(^VA(200,DUZ,5))  Q:'$L(^VA(200,DUZ,5))
"RTN","GMRCSLM",43,0)
 S DIC="^DIC(49,",DIC(0)="MNO",X=^VA(200,DUZ,5) D ^DIC K DIC S GMRCSSNM=$S($L($P(Y,"^",2)):$P(Y,"^",2),1:"") I $L(GMRCSSNM) S GMRCSS=$O(^GMR(123.5,"B",GMRCSSNM,0))
"RTN","GMRCSLM",44,0)
 S GMRCFL=1 D SP I $D(GMRCQUT),GMRCQUT=1 Q
"RTN","GMRCSLM",45,0)
 D SPD I $D(GMRCQUT) D END,EXIT Q
"RTN","GMRCSLM",46,0)
 K GMRCFL
"RTN","GMRCSLM",47,0)
 D AD^GMRCSLM1
"RTN","GMRCSLM",48,0)
 I GMRCSSNM'["MEDICINE" D EN^VALM("GMRC CONSULT TRACKING"),END,EXIT Q
"RTN","GMRCSLM",49,0)
 D EN^VALM("GMRC TRK MEDICINE CONSULTS"),END,EXIT Q
"RTN","GMRCSLM",50,0)
 Q
"RTN","GMRCSLM",51,0)
SP ;;Select a new patient and return DFN and GMRCSSNM to display consults and requested Service.
"RTN","GMRCSLM",52,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCSLM",53,0)
 K GMRCQUT S GMRCDFN1=$S($D(DFN):DFN,1:0)
"RTN","GMRCSLM",54,0)
 D SELPT^GMRCS I $S($D(GMRCQUT):1,'$D(DFN):1,1:0) S GMRCQUT=1,DFN=GMRCDFN1 G SPK
"RTN","GMRCSLM",55,0)
 I $D(Y),Y<0&(X["^") S GMRCQUT=1 G SPK
"RTN","GMRCSLM",56,0)
 I $D(Y),Y<0 S DFN=GMRCDFN1 S GMRCQUT=1 G SPK
"RTN","GMRCSLM",57,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLM",58,0)
 S GMRCWRD=GMRCWARD
"RTN","GMRCSLM",59,0)
 I $D(GMRCFL) D SPK Q
"RTN","GMRCSLM",60,0)
 D ASRV^GMRCASV I $S($D(GMRCQUT):1,$D(DTOUT):1,$D(DUOUT):1,1:0) K DTOUT,DIROUT,DUOUT S (GMRCQUT,GMRCQIT)=1 Q
"RTN","GMRCSLM",61,0)
 S GMRCSS=GMRCDG,GMRCSSNM=$P(^GMR(123.5,GMRCSS,0),"^",1)
"RTN","GMRCSLM",62,0)
 D EN^GMRCMENU
"RTN","GMRCSLM",63,0)
SPD ;Enter a date range for serching consults;  null entry selects all consults and does not exclude by date
"RTN","GMRCSLM",64,0)
 D ^GMRCSPD Q:$D(GMRCQUT)
"RTN","GMRCSLM",65,0)
 I $D(GMRCEN) D SPK Q  ;GMRCEN defined if branched to here from EN^GMRCSLM
"RTN","GMRCSLM",66,0)
 S GMRCOER=0
"RTN","GMRCSLM",67,0)
 D AD^GMRCSLM1 ;Do not delete. Needed to get new Pt. data into ^TMP("GMRCR",
"RTN","GMRCSLM",68,0)
 S VALMCNT=LNCT,VALMBCK="R",VALMPGE=1 K GMRCDFN1
"RTN","GMRCSLM",69,0)
 Q
"RTN","GMRCSLM",70,0)
SPQ ;New patient has not been selected - keep current patient
"RTN","GMRCSLM",71,0)
 I '$D(DFN),GMRCDFN1<1 S GMRCQUT=1 K GMRCDFN1 Q
"RTN","GMRCSLM",72,0)
 S DFN=GMRCDFN1 Q:DFN<1  W " "_GMRCPNM K GMRCDFN1
"RTN","GMRCSLM",73,0)
 S VALMBCK="R",GMRCQUT=1 K GMRCDFN1
"RTN","GMRCSLM",74,0)
SPK ;Kill variables
"RTN","GMRCSLM",75,0)
 ;I $D(GMRCTM),$D(GMRCBM),$D(IOSTBM) S IOTM=GMRCTM,IOBM=IOSTBM
"RTN","GMRCSLM",76,0)
 K GMRCDFN1,GMRCBM,GMRCTM
"RTN","GMRCSLM",77,0)
 Q
"RTN","GMRCSLM",78,0)
SS ;Select A New Service or ALL SERVICES For The Patient To Display Patient Consults
"RTN","GMRCSLM",79,0)
 K GMRCQUT,GMRCVP S GMRCOER=0
"RTN","GMRCSLM",80,0)
 D FULL^VALM1
"RTN","GMRCSLM",81,0)
 D ASRV^GMRCASV I $D(GMRCQUT),GMRCQUT=1 Q
"RTN","GMRCSLM",82,0)
 S GMRCSS=GMRCDG,GMRCSSNM=$P(^GMR(123.5,GMRCSS,0),"^",1)
"RTN","GMRCSLM",83,0)
 D AD^GMRCSLM1,INIT,HDR
"RTN","GMRCSLM",84,0)
 S VALMBCK="R",VALMCNT=LNCT
"RTN","GMRCSLM",85,0)
 D EN^GMRCACTM,EN^GMRCMENU
"RTN","GMRCSLM",86,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLM",87,0)
 Q
"RTN","GMRCSLM",88,0)
STS ;Select a status for view. I.e., only active consults, pending consults, deceased consults, etc.
"RTN","GMRCSLM",89,0)
 S GMRCERR=0
"RTN","GMRCSLM",90,0)
 S DIR(0)="FU",DIR("A")="Only Display Consults With Status Of",DIR("B")="All Status's"
"RTN","GMRCSLM",91,0)
 S INDX=1,STS="",(UPCASEST,LCASEST)="",DIR("?")="EXAMPLES:  A,P,C  or  a,p,c  or  DC"
"RTN","GMRCSLM",92,0)
 F I=1,2,5,6,13 S STSL=$S(I=1:"dc",I=2:"c",I=5:"p",I=6:"a",1:"x"),GMRCARY(STSL)=I,DIR("?",INDX)=STSL_"  "_$S(I=1:"Discontinued",I=2:"Complete",I=5:"Pending",I=6:"Active",1:"Cancelled") D
"RTN","GMRCSLM",93,0)
 .S UPCASEST=UPCASEST_$S(STSL?1L:$C($A(STSL)-32),1:"DC"),LCASEST=LCASEST_STSL,INDX=INDX+1
"RTN","GMRCSLM",94,0)
 .Q
"RTN","GMRCSLM",95,0)
 S DIR("?",INDX)="Type The Letter/Character Status Or Status's To View, Separated By Commas"
"RTN","GMRCSLM",96,0)
 D ^DIR I ($S($E(Y,1)="a":"A",$E(Y,1)="A":"A",1:"")_$TR($E(Y,2,$L(Y)),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz"))["All" S Y="All Status's"
"RTN","GMRCSLM",97,0)
 I $S(Y["All Status's":1,Y="^":1,1:0) S GMRCSTCK="" D:$D(GMRC("NMBR"))  G END
"RTN","GMRCSLM",98,0)
 .D RESET^GMRCSLMV(GMRC("NMBR"))
"RTN","GMRCSLM",99,0)
 .K GMRC("NMBR")
"RTN","GMRCSLM",100,0)
 .Q
"RTN","GMRCSLM",101,0)
 S GMRCSTCK=Y,UPCASEST=UPCASEST_",",LCASEST=LCASEST_","
"RTN","GMRCSLM",102,0)
 S GMRCSTSK=$TR(Y,UPCASEST,LCASEST),GMRCSTCK="" F J=1:1 S X=$P(GMRCSTSK,",",J) Q:X=""  S:'$D(GMRCARY(X)) GMRCERR=1 Q:GMRCERR  S GMRCSTCK=GMRCSTCK_GMRCARY(X)_","
"RTN","GMRCSLM",103,0)
 I GMRCERR W !!,$C(7),"ERR IN ENTRY. "_X_" IS NOT A VALID STATUS CODE.",! D END G STS
"RTN","GMRCSLM",104,0)
 S GMRCSTCK=$E(GMRCSTCK,1,$L(GMRCSTCK)-1)
"RTN","GMRCSLM",105,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLM",106,0)
END K DIR,GMRCARY,GMRCERR,GMRCSTSK,INDX,J,LCASEST,STS,STSN,STSL,UPCASEST
"RTN","GMRCSLM",107,0)
 Q
"RTN","GMRCSLM1")
0^82^B28422109
"RTN","GMRCSLM1",1,0)
GMRCSLM1 ;SLC/DCM - Gather data and format ^TMP global for consult tracking, silent call for use by List Manager and GUI ;5/26/98  09:35
"RTN","GMRCSLM1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCSLM1",3,0)
 ;USING LIST MANAGER.
"RTN","GMRCSLM1",4,0)
 G AD
"RTN","GMRCSLM1",5,0)
SVC(NODE) ;Check for a valid service
"RTN","GMRCSLM1",6,0)
 K GMRCDEAV
"RTN","GMRCSLM1",7,0)
 I '$D(^GMR(123,NODE,0)) Q 0
"RTN","GMRCSLM1",8,0)
 I '+$P(^GMR(123,NODE,0),"^",5) Q 0
"RTN","GMRCSLM1",9,0)
 I '$D(^TMP("GMRCS",$J,$P(^GMR(123,NODE,0),"^",5))) Q 0
"RTN","GMRCSLM1",10,0)
 ;I $P(^GMR(123.5,$P(^GMR(123,NODE,0),"^",5),0),"^",2)=9 S GMRCDEAV=1 Q 1
"RTN","GMRCSLM1",11,0)
 Q 1
"RTN","GMRCSLM1",12,0)
REL(NODE) ;Check to make sure that order has been released.
"RTN","GMRCSLM1",13,0)
 ;N STS S STS=$P(^GMR(123,NODE,0),"^",12)
"RTN","GMRCSLM1",14,0)
 ;I $S(STS=7:1,STS=12:1,STS=13:1,1:0) Q 0
"RTN","GMRCSLM1",15,0)
 Q 1
"RTN","GMRCSLM1",16,0)
AD ;Loop through AD x-ref in file 123; Find consults that have been released to requested service
"RTN","GMRCSLM1",17,0)
 ;;DFN and GMRCSSNM must be defined when this entry point is called
"RTN","GMRCSLM1",18,0)
 ;;DFN=Internal File Number of Patient in ^DPT
"RTN","GMRCSLM1",19,0)
 ;;GMRCSSNM=Service Name of a Hospital Service from file ^GMR(123.5
"RTN","GMRCSLM1",20,0)
 ;;If GMRCSSNM is not defined or is null, then no records will be found.
"RTN","GMRCSLM1",21,0)
 ;;GMRCOER must be passed so that proper formatting for GUI or List Manager can be performed.  GMRCOER is passed as 0 for List Manager, 1 for GUI.
"RTN","GMRCSLM1",22,0)
 ;;GMRCDT1 and GMRCDT2 are passed in as start and stop dates for the lookup. If GMRCDT1="" or GMRCDT1="ALL", then all dates are searched.
"RTN","GMRCSLM1",23,0)
 ;;  ***********************************************************
"RTN","GMRCSLM1",24,0)
 K ^TMP("GMRCR",$J,"CS"),GMRCNUL
"RTN","GMRCSLM1",25,0)
 I $D(GMRCSSS) S (GMRCDG,GMRCSS)=GMRCSSS,GMRCSSNM=($P($G(^GMR(123.5,+GMRCSS,0)),"^",1)) D SERV1^GMRCASV K GMRCSSS ;reset after forward
"RTN","GMRCSLM1",26,0)
 S TAB="",$P(TAB," ",30)="",BLK=0,LNCT=1 S:'$D(GMRCOER) GMRCOER=0
"RTN","GMRCSLM1",27,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,"AD",DFN,GMRCD)) Q:'GMRCD  S GMRCDA=0 F  S GMRCDA=$O(^GMR(123,"AD",DFN,GMRCD,GMRCDA)) Q:'GMRCDA  I $$SVC(GMRCDA),$$REL(GMRCDA) D SET
"RTN","GMRCSLM1",28,0)
 D END Q
"RTN","GMRCSLM1",29,0)
SET ;;Format entries into a word processing 'TMP("GMRCR",$J,"CS",' global that List Manager can display
"RTN","GMRCSLM1",30,0)
 ;;GMRCOER is a variable that signals that data is being formatted for the OE/RR GUI; this data is formatted differently than the data for List Manager.
"RTN","GMRCSLM1",31,0)
 ;;GMRCOER=0 : Data is List Manager formatted.
"RTN","GMRCSLM1",32,0)
 ;;GMRCOER=1 : Data is OE/RR GUI formatted.
"RTN","GMRCSLM1",33,0)
 S:'$D(TAB) TAB="",$P(TAB," ",30)=""
"RTN","GMRCSLM1",34,0)
 S GMRCIFN=GMRCDA I '$L(GMRCIFN),$D(XQADATA) S (GMRCDA,GMRCIFN)=+XQADATA
"RTN","GMRCSLM1",35,0)
 S GMRCSEX=$S($P(^DPT(DFN,0),"^",2)="M":"MALE",1:"FEMALE")
"RTN","GMRCSLM1",36,0)
 I '$D(^GMR(123,GMRCIFN)) S GMRCQUT=1 Q
"RTN","GMRCSLM1",37,0)
 S PROC="",GMRC(0)=^GMR(123,GMRCIFN,0)
"RTN","GMRCSLM1",38,0)
 I $D(GMRCSTCK),GMRCSTCK'="" N STATUS D  Q:'STATUS
"RTN","GMRCSLM1",39,0)
 . N I
"RTN","GMRCSLM1",40,0)
 . F I=1:1 S STATUS=$P(GMRCSTCK,",",I) Q:STATUS=$P(GMRC(0),"^",12)  Q:'STATUS
"RTN","GMRCSLM1",41,0)
 . Q
"RTN","GMRCSLM1",42,0)
 I $D(GMRCVP),GMRCVP'=$P(GMRC(0),"^",8) Q
"RTN","GMRCSLM1",43,0)
 S (GMRCFMDT,X)=$P(GMRC(0),"^",7) I GMRCDT1'="ALL",$P(X,".",1)<GMRCDT1!($P(X,".",1)>GMRCDT2) Q
"RTN","GMRCSLM1",44,0)
 S BLK=BLK+1,^TMP("GMRCR",$J,"CS","AD",BLK,LNCT,GMRCDA)=""
"RTN","GMRCSLM1",45,0)
 D REGDTM^GMRCU S CDT=$P(X," ")
"RTN","GMRCSLM1",46,0)
 S PROC=$P(GMRC(0),"^",8) I PROC'="" S PROC="^"_$P(PROC,";",2)_$P(PROC,";")_",0)" S:$D(PROC) PROC=$P(@PROC,"^",2)
"RTN","GMRCSLM1",47,0)
 S:PROC="" PROC="Consult"
"RTN","GMRCSLM1",48,0)
 S:$L($P(GMRC(0),"^",5)) TOD=$S($P(^GMR(123.5,$P(GMRC(0),"^",5),0),"^",2)=9:1,1:0)
"RTN","GMRCSLM1",49,0)
 I '$D(TOD) S TOD=0
"RTN","GMRCSLM1",50,0)
 S TO=$P(GMRC(0),"^",5),TO=$S(+TO:$P($G(^GMR(123.5,TO,0)),"^",1),1:""),TO=$S(TOD:"<",1:"")_TO,TO=$S(GMRCOER:TO,1:$E(TO,1,40))_$S(TOD:">",1:"") I '$L(TO) S TO="Unknown"
"RTN","GMRCSLM1",51,0)
 S STS=$P(GMRC(0),"^",12) I +STS,$D(^ORD(100.01,+STS,0)) S STS=$P(^ORD(100.01,+STS,.1),"^",1)
"RTN","GMRCSLM1",52,0)
 I $S(STS="":1,'$D(^ORD(100.01,+$P(GMRC(0),"^",12),0)):1,1:0) S STS=99,$P(GMRC(0),"^",12)=STS,STS=$S(GMRCOER=1:$P(^ORD(100.01,5,0),"^",1),1:$P(^ORD(100.01,+STS,.1),"^",1))
"RTN","GMRCSLM1",53,0)
 I 'GMRCOER S ^TMP("GMRCR",$J,"CS",LNCT,0)=$J(BLK,3)_$E(TAB,1,10)_CDT_"  "_$E(STS,1,16)_$S(STS?1A:"  ",STS?2A:" ",1:"  ")_$S($P(GMRC(0),"^",19)="Y":"*",1:" ")_TO_$E(TAB,1,26-$L(TO))_" "_PROC,LNCT=LNCT+1 Q
"RTN","GMRCSLM1",54,0)
 I GMRCOER S ^TMP("GMRCR",$J,"CS",LNCT,0)=GMRCDA_"^"_GMRCFMDT_"^"_STS_"^"_TO_"^"_PROC,LNCT=LNCT+1 K STSOER Q
"RTN","GMRCSLM1",55,0)
 Q
"RTN","GMRCSLM1",56,0)
END I LNCT<2 S (BLK,LNCT)=1,GMRCNUL=1,GMRCNPM="< PATIENT DOES NOT HAVE ANY CONSULTS/REQUESTS "_$S($D(GMRCPRNM):"FOR "_GMRCPRNM,1:"")_" ON FILE. >",GMRCNPM=$E(TAB,1,(80-$L(GMRCNPM))\80)_GMRCNPM,^TMP("GMRCR",$J,"CS",LNCT,0)=GMRCNPM D:$D(GMRCSTCK)
"RTN","GMRCSLM1",57,0)
 .Q:'$L(GMRCSTCK)
"RTN","GMRCSLM1",58,0)
 .S LNCT=LNCT+1,^TMP("GMRCR",$J,"CS",LNCT,0)="Status' Checked: " S STS="" F I=1:1 S STS=$P(GMRCSTCK,",",I) Q:STS=""  S ^TMP("GMRCR",$J,"CS",LNCT,0)=^(0)_$P($G(^ORD(100.01,+STS,0)),"^",1)_"  "
"RTN","GMRCSLM1",59,0)
 .Q
"RTN","GMRCSLM1",60,0)
 E  S (BLK,LNCT)=LNCT-1,^TMP("GMRCR",$J,"CS",0)="^^^"_LNCT
"RTN","GMRCSLM1",61,0)
 I $D(GMRCALFL) S (BLK,LNCT)=1
"RTN","GMRCSLM1",62,0)
 K TO,TOD,END,FLG,GMRC(0),GMRCD,GMRCDG,GMRCIFN,GMRCFNDT,GMRCNPM,GMRCWARD,I,PROC,STS,URG
"RTN","GMRCSLM1",63,0)
 Q
"RTN","GMRCSLM1",64,0)
OER(DFN,GMRCDG,GMRCDT1,GMRCDT2,GMRCSTCK) ;;GUI interface for CPRS
"RTN","GMRCSLM1",65,0)
 ;;DFN=Patient internal file number
"RTN","GMRCSLM1",66,0)
 ;;GMRCDG:  Internal file number of consult service (from file ^GMR(123.5,)
"RTN","GMRCSLM1",67,0)
 ;;GMRCDT1:  Beginning date for lookup
"RTN","GMRCSLM1",68,0)
 ;;GMRCDT2:  Ending date for lookup
"RTN","GMRCSLM1",69,0)
 ;;GMRCSTCK: IEN from OER Status File [^OER(100.01)] to screen results
"RTN","GMRCSLM1",70,0)
 ;;     so that only consults with a desired status are displayed
"RTN","GMRCSLM1",71,0)
 ;;     Can be sent as a set of statuses: i.e., 6,5,2
"RTN","GMRCSLM1",72,0)
 ;;      (GMRCSTCK=GMRC STATUS CHECK)
"RTN","GMRCSLM1",73,0)
 I GMRCDT1="" S GMRCDT1="ALL"
"RTN","GMRCSLM1",74,0)
 I GMRCDG="" S GMRCDG=$O(^GMR(123.5,"B","ALL SERVICES",0))
"RTN","GMRCSLM1",75,0)
 S GMRCOER=1
"RTN","GMRCSLM1",76,0)
 D SERV1^GMRCASV,AD
"RTN","GMRCSLM1",77,0)
 K ^TMP("GMRCS",$J)
"RTN","GMRCSLM1",78,0)
 Q
"RTN","GMRCSLM2")
0^83^B38237294
"RTN","GMRCSLM2",1,0)
GMRCSLM2 ;SLC/DCM - GMRC List Manager routine - Detailed consult display and printing for consults tracking. ;5/20/98  14:20
"RTN","GMRCSLM2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCSLM2",3,0)
DT(GMRCO) ;;Entry point to set-up detailed display.
"RTN","GMRCSLM2",4,0)
 ;;Pass in GMRCO as +GMRCO - a number only. GMRCO=IEN from of consult from file 123
"RTN","GMRCSLM2",5,0)
 ;;Results are placed in ^TMP("GMRCR",$J,"DT",
"RTN","GMRCSLM2",6,0)
 Q:'$D(^GMR(123,+GMRCO,0))  K GMRCQUT
"RTN","GMRCSLM2",7,0)
 N DFN,GMRCD,GMRCDA S GMRCDVDL="",$P(GMRCDVDL,"-",80)=""
"RTN","GMRCSLM2",8,0)
 I $S('GMRCO:1,'$D(^GMR(123,GMRCO,0)):1,1:0) D:$S('$D(GMRCOER):1,'GMRCOER:1,1:0)  S GMRCQUT=1 Q
"RTN","GMRCSLM2",9,0)
 .S GMRCMSG="Cannot List The Detailed Display Data At This Time.",GMRCMSG(1)="View The Detailed Display Data Through The Consults Package." D EXAC^GMRCADC(.GMRCMSG) K GMRCMSG
"RTN","GMRCSLM2",10,0)
 .Q
"RTN","GMRCSLM2",11,0)
 K ^TMP("GMRCR",$J,"DT") S TAB="",$P(TAB," ",30)="",GMRCCT=1
"RTN","GMRCSLM2",12,0)
 S GMRCO(0)=^GMR(123,+GMRCO,0),ORIFN=$P(GMRCO(0),"^",3),DFN=$P(GMRCO(0),"^",2)
"RTN","GMRCSLM2",13,0)
 D INP^VADPT S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current Inpatient/Outpatient: "_$S(+VAIN(8):"Inpatient",1:"Outpatient"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",14,0)
 I $D(VAIN(4)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Ward:"_$E(TAB,1,18)_$P(VAIN(4),"^",2),GMRCCT=GMRCCT+1 K VAIN
"RTN","GMRCSLM2",15,0)
 D ELIG^VADPT S GMRCELIG=$P(VAEL(6),"^",2),^TMP("GMRCR",$J,"DT",GMRCCT,0)="Eligibility:"_$E(TAB,1,11)
"RTN","GMRCSLM2",16,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="To Service:"_$E(TAB,1,12)_$P($G(^GMR(123.5,+$P(GMRCO(0),"^",5),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",17,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="From Service:"_$E(TAB,1,10)_$P($G(^SC(+$P(GMRCO(0),"^",6),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",18,0)
 S GMRCPRNM=$P(GMRCO(0),"^",8),GMRCPROC=$S(+GMRCPRNM:$P($G(^ORD(101,+GMRCPRNM,0)),"^",2),1:"")
"RTN","GMRCSLM2",19,0)
 I $L(GMRCPROC) D
"RTN","GMRCSLM2",20,0)
 .S GMRCTYPE=$S(+$P(GMRCO(0),"^",17):$P(^ORD(101,+$P(GMRCO(0),"^",17),0),"^"),1:"")
"RTN","GMRCSLM2",21,0)
 .S GMRCTYPE=$S(GMRCTYPE="GMRCOR REQUEST":"Procedure Type",1:"Consult Type")
"RTN","GMRCSLM2",22,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCTYPE_":"_$E(TAB,1,22-$L(GMRCTYPE))_GMRCPROC,GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",23,0)
 .Q
"RTN","GMRCSLM2",24,0)
 S GMRCD=$G(^GMR(123,+GMRCO,30)) I $L(GMRCD) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Provisional Diagnosis: "_GMRCD,GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",25,0)
 I $D(^GMR(123,+GMRCO,20,0)) S FLG=1,LINE="Reason For Request:"_$E(TAB,1,4) D WPSET^GMRCUTIL("^GMR(123,+GMRCO,20)","^TMP(""GMRCR"",$J,""DT"")",LINE,.GMRCCT,TAB,FLG)
"RTN","GMRCSLM2",26,0)
 S STS=$P(GMRCO(0),"^",12),^TMP("GMRCR",$J,"DT",GMRCCT,0)="Status:  "_$E(TAB,1,14)_$S($D(^ORD(100.01,+STS,0)):$P(^(0),"^",1),1:$P(^ORD(100.01,6,0),"^",1)),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",27,0)
 S GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"DT",GMRCCT,0)=" ",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",28,0)
 I $L($P(GMRCO(0),"^",18)) D
"RTN","GMRCSLM2",29,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Service is to be rendered on an "_$S($P(GMRCO(0),"^",18)="I":"INPATIENT",1:"OUTPATIENT")_" basis",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",30,0)
 .Q
"RTN","GMRCSLM2",31,0)
 I $P(GMRCO(0),"^",11) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="ATTENTION:"_$E(TAB,1,12)_$P($G(^VA(200,$P(GMRCO(0),"^",11),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",32,0)
 I $P(GMRCO(0),"^",10) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Place:"_$E(TAB,1,16)_$P($G(^ORD(101,+$P(GMRCO(0),"^",10),0)),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",33,0)
 I $P(GMRCO(0),"^",9) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Urgency:"_$E(TAB,1,14)_$P($G(^ORD(101,+$P(GMRCO(0),"^",9),0)),"^",2) S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",34,0)
 I $L($P(GMRCO(0),"^",19)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Significant Findings: "_$P(GMRCO(0),"^",19),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",35,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",36,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Request Activity"_$E(TAB,1,6)_"Date/Time"_$E(TAB,1,7)_"Ordering Clinician"_$E(TAB,1,2)_"Entered By",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",37,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDA="" F  S GMRCDA=$O(^GMR(123,+GMRCO,40,"B",GMRCD,GMRCDA)) Q:'GMRCDA  D
"RTN","GMRCSLM2",38,0)
 .S GMRCDA(0)=^GMR(123,+GMRCO,40,GMRCDA,0)
"RTN","GMRCSLM2",39,0)
 .I $P(GMRCDA(0),"^",2)=22,$P(GMRCDA(0),"^",8) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^GMR(123.1,22,0)_" "_$E($P($G(^%ZIS(1,$P(GMRCDA(0),"^",8),0)),"^"),1,5) Q
"RTN","GMRCSLM2",40,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$S($P(GMRCDA(0),"^",2)]"":$E($P($G(^GMR(123.1,$P(GMRCDA(0),"^",2),0)),"^"),1,16),1:$E(TAB,1,22))
"RTN","GMRCSLM2",41,0)
 .S X=$P(GMRCDA(0),"^",3) D REGDTM^GMRCU S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$S($D(^TMP("GMRCR",$J,"DT",GMRCCT,0)):^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,22-$L(^(0)))_X,1:X)
"RTN","GMRCSLM2",42,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,38-$L(^(0)))_$S($P(GMRCDA(0),"^",4):$E($P($G(^VA(200,$P(GMRCDA(0),"^",4),0)),"^"),1,19),1:$E(TAB,1,18))
"RTN","GMRCSLM2",43,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,58-$L(^(0)))_$S($P(GMRCDA(0),"^",5):$E($P($G(^VA(200,$P(GMRCDA(0),"^",5),0)),"^"),1,19),1:$E(TAB,1,18))
"RTN","GMRCSLM2",44,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",45,0)
 .I $P(GMRCDA(0),"^",2)=17,$P(GMRCDA(0),"^",6) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$E(TAB,1,5)_$P($G(^GMR(123.5,$P(GMRCDA(0),"^",6),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",46,0)
 .I $P(GMRCDA(0),"^",2)=11 S LN=0 D  Q
"RTN","GMRCSLM2",47,0)
 ..F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDA,1,LN)) Q:LN=""  S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$P(^(LN,0),"^",1),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",48,0)
 ..S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",49,0)
 ..Q
"RTN","GMRCSLM2",50,0)
 .I $D(^GMR(123,+GMRCO,40,GMRCDA,1)) S LN=0,LINE="     " D  Q
"RTN","GMRCSLM2",51,0)
 ..S LN=$O(^GMR(123,+GMRCO,40,GMRCDA,1,LN)) Q:LN=""!(LN?1A.E)  I ^GMR(123,+GMRCO,40,GMRCDA,1,LN,0)'["EDITED FIELDS",$L(^(0))>75 D
"RTN","GMRCSLM2",52,0)
 ...S FLG=1 D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDA,1)","^TMP(""GMRCR"",$J,""DT"")",LINE,.GMRCCT,TAB,FLG)
"RTN","GMRCSLM2",53,0)
 ...Q
"RTN","GMRCSLM2",54,0)
 ..I $S(^GMR(123,+GMRCO,40,GMRCDA,1,LN,0)["EDITED FIELDS":1,$L(^(0))'>75:1,1:0)  D
"RTN","GMRCSLM2",55,0)
 ...S LN=0 F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDA,1,LN)) Q:LN=""!(LN?1A.E)  S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^(LN,0),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",56,0)
 ...S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",57,0)
 ...Q
"RTN","GMRCSLM2",58,0)
 ..S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCDVDL,GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",59,0)
 ..Q
"RTN","GMRCSLM2",60,0)
 .Q
"RTN","GMRCSLM2",61,0)
 I $L($P(^GMR(123,+GMRCO,0),"^",15)) D
"RTN","GMRCSLM2",62,0)
 .S GMRCTO=$P(^GMR(123,+GMRCO,0),"^",5),GMRCSR=$P(^(0),"^",15),ORACTION=8
"RTN","GMRCSLM2",63,0)
 .I $E($P(GMRCSR,";",2),1,2)="MC" S MCFILE=$P(GMRCSR,";",2),MCFILE=$P(MCFILE,","),MCPROC=$O(^MCAR(697.2,"C",MCFILE,"")) Q:'MCPROC  S GMRCPRNM=$P(^MCAR(697.2,MCPROC,0),"^",8)
"RTN","GMRCSLM2",64,0)
 .D EN^GMRCSLM3(+GMRCO,.GMRCCT)
"RTN","GMRCSLM2",65,0)
 .Q
"RTN","GMRCSLM2",66,0)
 I +$P(^GMR(123,+GMRCO,0),"^",20),$P(^(0),"^",12)=2 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"-",80)="",^(0)=$E(^(0),1,29)_" TIU CONSULT REPORT "_$E(^(0),49,80),GMRCCT=GMRCCT+1 D
"RTN","GMRCSLM2",67,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",68,0)
 .S GMRCTUFN=$P(^GMR(123,+GMRCO,0),"^",20)
"RTN","GMRCSLM2",69,0)
 .D DSPLAY^GMRCTIU(GMRCTUFN,.GMRCCT)
"RTN","GMRCSLM2",70,0)
 .S GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"DT",GMRCCT,0)=""
"RTN","GMRCSLM2",71,0)
 .D CLEAN^VALM10
"RTN","GMRCSLM2",72,0)
 .Q
"RTN","GMRCSLM2",73,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"=",80)="",^(0)=$E(^(0),1,36)_" END "_$E(^(0),43,80)
"RTN","GMRCSLM2",74,0)
DTQ K X,LN,PL,TO,WP,FLG,SEX,STS,URG,WRD,BKLN,DATA,WRD,PROC,LINE,GMRC(0),GMRC(40),GMRCD,GMRCDVDL,GMRCO,GMRCRB,GMRCLA,GMRCTO,MCFILE,MCPROC,DSPLINE,GMRCLA1,GMRCPRNM,GMRCPROC,GMRCTYPE,GMRCWARD
"RTN","GMRCSLM2",75,0)
 I $D(GMRCOER),'GMRCOER D KILL^VALM10(),CLEAN^VALM10
"RTN","GMRCSLM2",76,0)
 Q
"RTN","GMRCSLM3")
0^84^B19595111
"RTN","GMRCSLM3",1,0)
GMRCSLM3 ;SLC/DCM - Extract medicine results for consults tracking ;9/14/98  13:03
"RTN","GMRCSLM3",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCSLM3",3,0)
EN(GMRCSEL,COUNT) ;;This entry point is used to collect consult data from the Medicine Package.
"RTN","GMRCSLM3",4,0)
 ;Consult/Request Tracking
"RTN","GMRCSLM3",5,0)
 ;GMRCSEL: The IEN of the consult from file 123.
"RTN","GMRCSLM3",6,0)
 ;COUNT:   The current position in ^TMP where data is to be placed.
"RTN","GMRCSLM3",7,0)
 D ENDT,EXIT Q
"RTN","GMRCSLM3",8,0)
 ;
"RTN","GMRCSLM3",9,0)
ENDT Q:'$D(GMRCSEL)  S GMRCSR=$P(^GMR(123,GMRCSEL,0),"^",15)
"RTN","GMRCSLM3",10,0)
 Q:'$D(GMRCSEL)  S ORIFN=$P(^GMR(123,GMRCSEL,0),"^",3)
"RTN","GMRCSLM3",11,0)
 S ^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCSLM3",12,0)
 S X="MCOR" X ^%ZOSF("TEST") I '$T S ^TMP("GMRCR",$J,"DT",COUNT,0)="Medicine package not installed.  Online results are not available.",COUNT=COUNT+1
"RTN","GMRCSLM3",13,0)
 I 'GMRCSR S ^TMP("GMRCR",$J,"DT",COUNT,0)="No Medicine results are available for review",COUNT=COUNT+1 Q
"RTN","GMRCSLM3",14,0)
 S GMRCRTIT=$G(GMRCPRNM)_" SUMMARY REPORT",GMRCH="",$P(GMRCH,"-",(77-$L(GMRCRTIT))\2)="",^TMP("GMRCR",$J,"DT",COUNT,0)=GMRCH_" "_GMRCRTIT_" "_GMRCH,COUNT=COUNT+1,^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCSLM3",15,0)
 D PRINT^MCOR I '$D(^TMP("MC",$J)) S ^TMP("GMRCR",$J,"DT",COUNT,0)="No results are available for review.",COUNT=COUNT+1
"RTN","GMRCSLM3",16,0)
 ;GMRCFT=Field Type of D (Diagnosis, I (Indications), S (Summary)
"RTN","GMRCSLM3",17,0)
SET S GMRCFT="D" I $D(^TMP("MC",$J,"D")) S ^TMP("GMRCR",$J,"DT",COUNT,0)=$E(TAB,1,34)_"DIAGNOSIS",COUNT=COUNT+1 D SETFLD
"RTN","GMRCSLM3",18,0)
 S GMRCFT="I" I $D(^TMP("MC",$J,"I")) S ^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1,^TMP("GMRCR",$J,"DT",COUNT,0)="INDICATIONS:",COUNT=COUNT+1 D SETFLD
"RTN","GMRCSLM3",19,0)
 I $D(^TMP("MC",$J,"S")) D SUM
"RTN","GMRCSLM3",20,0)
 Q
"RTN","GMRCSLM3",21,0)
EXIT K GMRCH,GMRCX,GMRCSR,GMRCFT,GMRCFLD,GMRCSUM,GMRCFLDN,GMRCSUMP,GMRCRTIT,GMRCPRNM,GMRCFLDP,MCC,MCK,MCMFLD,MCMUP
"RTN","GMRCSLM3",22,0)
 K ^TMP("MC",$J)
"RTN","GMRCSLM3",23,0)
 Q
"RTN","GMRCSLM3",24,0)
SETFLD S GMRCFLD=0,GMRCFLDP="" F  S GMRCFLD=$O(^TMP("MC",$J,GMRCFT,GMRCFLD)) Q:GMRCFLD=""  S GMRCFLD(0)=^(GMRCFLD) D
"RTN","GMRCSLM3",25,0)
 .S GMRCFLDN=$P(GMRCFLD(0),"^",2) Q:GMRCFLDN[";W"
"RTN","GMRCSLM3",26,0)
 .I GMRCFLDP=GMRCFLDN S COUNT=COUNT-1,^TMP("GMRCR",$J,"DT",COUNT,0)=^TMP("GMRCR",$J,"DT",COUNT,0)_", "
"RTN","GMRCSLM3",27,0)
 .E  S GMRCFLDP=GMRCFLDN,^TMP("GMRCR",$J,"DT",COUNT,0)=GMRCFLDP_":"_$E(TAB,1,18-$L(GMRCFLDP))
"RTN","GMRCSLM3",28,0)
 .I $L($P(GMRCFLD(0),"^",1))>45 S ^TMP("GMRCR",$J,"DT",COUNT,0)=^TMP("GMRCR",$J,"DT",COUNT,0)_$P(GMRCFLD(0),"^",1),COUNT=COUNT+1 Q
"RTN","GMRCSLM3",29,0)
 .I $L($P(GMRCFLD(0),"^",1))'>77 S ^TMP("GMRCR",$J,"DT",COUNT,0)=^TMP("GMRCR",$J,"DT",COUNT,0)_$P(GMRCFLD(0),"^",1)
"RTN","GMRCSLM3",30,0)
 .S COUNT=COUNT+1 Q
"RTN","GMRCSLM3",31,0)
 Q
"RTN","GMRCSLM3",32,0)
SUM ;
"RTN","GMRCSLM3",33,0)
 S GMRCSUM=$P(^TMP("MC",$J,"S"),"^",1),GMRCSUMP=$P(^TMP("MC",$J,"S"),"^",2)
"RTN","GMRCSLM3",34,0)
 I $L(GMRCSUM)!($L(GMRCSUMP)) S ^TMP("GMRCR",$J,"DT",COUNT,0)="SUMMARY:"
"RTN","GMRCSLM3",35,0)
 I $L(GMRCSUM) S ^TMP("GMRCR",$J,"DT",COUNT,0)=^TMP("GMRCR",$J,"DT",COUNT,0)_$E(TAB,1,11)_GMRCSUM,COUNT=COUNT+1
"RTN","GMRCSLM3",36,0)
 I $L(GMRCSUMP) S ^TMP("GMRCR",$J,"DT",COUNT,0)="SUMMARY PROCEDURE: "_GMRCSUMP,COUNT=COUNT+1
"RTN","GMRCSLM3",37,0)
 Q
"RTN","GMRCSLM3",38,0)
AREN(GMRCSEL,GMRCSR) ;Entry point for display of Medicine Results when associating a result with a consult - List Manager display set-up.
"RTN","GMRCSLM3",39,0)
 ;GMRCSR=^MCAR(191, file IEN where result to associate is stored
"RTN","GMRCSLM3",40,0)
 ;GMRCSEL=File ^GMR(123, IEN of consult to associate with medicine result
"RTN","GMRCSLM3",41,0)
 S COUNT=1,TAB="",TAB=$P(TAB," ",30)
"RTN","GMRCSLM3",42,0)
 S X="MCOR" X ^%ZOSF("TEST") I '$T S ^TMP("GMRCR",$J,"DT",COUNT,0)="Medicine Package is not installed. Online results are not available.",COUNT=COUNT+1 G END
"RTN","GMRCSLM3",43,0)
 I 'GMRCSR S ^TMP("GMRCR",$J,"DT",COUNT,0)="No Medicine results are available for review.",COUNT=COUNT+1
"RTN","GMRCSLM3",44,0)
 S ORIFN=$P(^GMR(123,GMRCSEL,0),"^",3),ORACTION=8
"RTN","GMRCSLM3",45,0)
 S GMRCPRNM=$P(^GMR(123,GMRCSEL,0),"^",8),GMRCPRNM="^"_$P(GMRCPRNM,";",2)_$P(GMRCPRNM,";",1)_",0)",GMRCPRNM=$P(@(GMRCPRNM),"^",2) I GMRCPRNM?1A.L S GMRCPRNM=$TR(GMRCPRNM,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMRCSLM3",46,0)
 I +GMRCSR D PRINT^MCOR I $D(^TMP("MC",$J)) S ^TMP("GMRCR",$J,"DT",COUNT,0)=TAB_"MEDICINE RESULTS",COUNT=COUNT+1,^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1 D SET
"RTN","GMRCSLM3",47,0)
 S ^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCSLM3",48,0)
END S GMRCCT=COUNT-1
"RTN","GMRCSLM3",49,0)
 K COUNT,GMRCH,GMRCFT,GMRCFLD,GMRCSUM,GMRCFLDN,GMRCSUMP,GMRCRTIT,GMRCPRNM,GMRCFLDP,MCC,MCK,MCMFLD,MCMUP
"RTN","GMRCSLM3",50,0)
 K ^TMP("MC",$J)
"RTN","GMRCSLM3",51,0)
 Q
"RTN","GMRCSLMV")
0^85^B1750101
"RTN","GMRCSLMV",1,0)
GMRCSLMV ;SLC/DCM - Set Video attributes for list manager screens ;5/20/98  14:21
"RTN","GMRCSLMV",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCSLMV",3,0)
SET(GMRCNBR) ;Check For Valid input and set inverse video on selected item.
"RTN","GMRCSLMV",4,0)
 S GMRCNBR=+$P(GMRCNBR,",")
"RTN","GMRCSLMV",5,0)
 I GMRCNBR<1!(GMRCNBR>VALMCNT) W !,$C(7),GMRCNBR_" is not a valid selection. Choose a number between 1 and "_VALMCNT Q
"RTN","GMRCSLMV",6,0)
 I $D(GMRC("NMBR")) D RESET(GMRC("NMBR"))
"RTN","GMRCSLMV",7,0)
 S GMRC("NMBR")=GMRCNBR
"RTN","GMRCSLMV",8,0)
 K ^TMP("VALM VIDEO",$J,VALMEVL,GMRCNBR)
"RTN","GMRCSLMV",9,0)
 D CNTRL^VALM10(GMRCNBR,1,80,IORVON,IORVOFF)
"RTN","GMRCSLMV",10,0)
 D WRITE^VALM10(GMRCNBR)
"RTN","GMRCSLMV",11,0)
 S XQORM("A")="Select Consult: ",VALMBCK=""
"RTN","GMRCSLMV",12,0)
 Q
"RTN","GMRCSLMV",13,0)
RESET(NUMBR) ;turn reverse video off when another item is selected
"RTN","GMRCSLMV",14,0)
 K ^TMP("VALM VIDEO",$J,VALMEVL,NUMBR)
"RTN","GMRCSLMV",15,0)
 D CNTRL^VALM10(NUMBR,1,80,IOINORM,IOINORM)
"RTN","GMRCSLMV",16,0)
 D WRITE^VALM10(NUMBR)
"RTN","GMRCSLMV",17,0)
 S VALMBCK="" K GMRCSEL
"RTN","GMRCSLMV",18,0)
 Q
"RTN","GMRCSLMV",19,0)
AGAIN(NMBR) ;RESET THE VIDEO ATTRIBUTE ONLY, DO NOT REDISPLAY
"RTN","GMRCSLMV",20,0)
 Q:'$D(NMBR)  Q:NMBR=""
"RTN","GMRCSLMV",21,0)
 K ^TMP("VALM VIDEO",$J,VALMEVL,NMBR)
"RTN","GMRCSLMV",22,0)
 D CNTRL^VALM10(NMBR,1,80,IORVON,IORVOFF)
"RTN","GMRCSLMV",23,0)
 S XQORM("A")="Select Consult: "
"RTN","GMRCSLMV",24,0)
 S VALMBCK=""
"RTN","GMRCSLMV",25,0)
 Q
"RTN","GMRCSPD")
0^86^B7129328
"RTN","GMRCSPD",1,0)
GMRCSPD ;SLC/DCM - Change Date Ranges For Displaying Consults/Requests In Consults Tracking Module ;5/20/98  14:21
"RTN","GMRCSPD",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCSPD",3,0)
 K GMRCQUT,DTOUT,DUOUT,DIROUT
"RTN","GMRCSPD",4,0)
 ;I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCSPD",5,0)
 I $D(GMRCDT1)&($D(GMRCDT2)) D DTSAV
"RTN","GMRCSPD",6,0)
 F  S %DT("A")="List From Starting Date: ",%DT("B")="ALL DATES" D CHECK Q:$D(DTOUT)  S GMRCDT1=$S($D(Y):Y,1:"") I $D(GMRCDT1),$S($D(DTOUT):1,GMRCDT1="ALL":1,GMRCDT1?1.7N.".".N:1,1:0) S:$D(DTOUT) GMRCQUT=1 K DTOUT,DUOUT,DIROUT Q
"RTN","GMRCSPD",7,0)
 K %DT I $D(DTOUT) D:$D(GMRCDTS1) DTRES S:'$D(GMRCDT1) GMRCDT1="" S GMRCQUT=1 K DTOUT,DUOUT,DIROUT Q
"RTN","GMRCSPD",8,0)
 S GMRCDT2=0 I GMRCDT1'="ALL" S %DT="AEPT",%DT("A")="List To This Ending Date: " F  D ^%DT G:X="^"&(Y<0) EXIT W:Y=""!(Y<0) $C(7),"??"  I Y>0 S GMRCDT2=+Y S:GMRCDT1>GMRCDT2 Y=GMRCDT1,GMRCDT1=GMRCDT2,GMRCDT2=Y Q
"RTN","GMRCSPD",9,0)
EXIT I $S(GMRCDT1="":1,GMRCDT2=0&(X="^"):1,1:0) D:$D(GMRCDT1) DTRES S GMRCQUT=1
"RTN","GMRCSPD",10,0)
 I GMRCDT1="",$D(GMRCDTS1) D DTRES
"RTN","GMRCSPD",11,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSPD",12,0)
 K %DT,GMRCDTS1,GMRCDTS2
"RTN","GMRCSPD",13,0)
 Q
"RTN","GMRCSPD",14,0)
DTSAV ;Save old dates in case user '^'s out.
"RTN","GMRCSPD",15,0)
 I $D(GMRCDT1),$S(GMRCDT1>0:1,GMRCDT1="ALL":1,1:0) S GMRCDTS1=GMRCDT1,GMRCDT1=""
"RTN","GMRCSPD",16,0)
 I $D(GMRCDT2),GMRCDT2>0 S GMRCDTS2=GMRCDT1,GMRCDT2=""
"RTN","GMRCSPD",17,0)
 Q
"RTN","GMRCSPD",18,0)
DTRES ;Restore old date in case user '^' out.
"RTN","GMRCSPD",19,0)
 I $D(GMRCDTS1) S GMRCDT1=GMRCDTS1
"RTN","GMRCSPD",20,0)
 I $D(GMRCDTS2) S GMRCDT2=GMRCDTS2
"RTN","GMRCSPD",21,0)
 K GMRCDTS1,GMRCDTS2 Q
"RTN","GMRCSPD",22,0)
CHECK ;Check for valid date/time inplut
"RTN","GMRCSPD",23,0)
 W !,%DT("A")_" "_%DT("B")_"//" R X:DTIME I '$T!(X["^") S DTOUT=1 Q
"RTN","GMRCSPD",24,0)
 S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMRCSPD",25,0)
 I X'="","TODAY"[X S X="NOW"
"RTN","GMRCSPD",26,0)
 I X'="",X?."?" S %DT="SPT" D HELP^%DTC K %DT Q
"RTN","GMRCSPD",27,0)
 I X["^" S DTOUT=1 Q
"RTN","GMRCSPD",28,0)
 I $S(X="T":0,%DT("B")[X:1,X="":1,1:0) S X="ALL" W "  ALL DATES" S Y="ALL" Q
"RTN","GMRCSPD",29,0)
 I $S(X?1.2N1"/"1.2N1"/"1.4N:1,"NOW"[X:1,X?1"T-".N."@".N:1,X?1"T-".N0.1"D"0.1"W"0.1"M":1,X?.7N1".".N:1,"NOON"[X:1,"MIDNIGHT"[X:1,1:0) S %DT="EPT" D ^%DT Q
"RTN","GMRCSPD",30,0)
 I X?1.8A." ".N.","." "1.4N.1"@".N D  Q
"RTN","GMRCSPD",31,0)
 .S %DT="PTS" D ^%DT
"RTN","GMRCSPD",32,0)
 .W "  "_Y
"RTN","GMRCSPD",33,0)
 .Q
"RTN","GMRCSPD",34,0)
 W $C(7),"??" S Y=-1 Q
"RTN","GMRCSPD",35,0)
 ;K %DT
"RTN","GMRCSPD",36,0)
 Q
"RTN","GMRCSRVS")
0^87^B8911604
"RTN","GMRCSRVS",1,0)
GMRCSRVS ;SLC/DCM - Add/Edit services in File 123.5. ;5/28/98  10:51
"RTN","GMRCSRVS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCSRVS",3,0)
 ;
"RTN","GMRCSRVS",4,0)
EN ;set up services entry point
"RTN","GMRCSRVS",5,0)
 ;GMRCOLDU=Service Usage field. If changed, GMRCOLDU shows the change (See ^DD(123.5,2,0) for field description).
"RTN","GMRCSRVS",6,0)
 S DIC="^GMR(123.5,",DLAYGO=123.5,DIC(0)="AELMQZ",DIC("A")="Select Service/Specialty:"
"RTN","GMRCSRVS",7,0)
 D ^DIC I $S(Y<0:1,$D(DTOUT):1,$D(DUOUT):1,1:0) D END K GMRCMSG,DTOUT,DUOUT Q
"RTN","GMRCSRVS",8,0)
 D
"RTN","GMRCSRVS",9,0)
 .S (DA,GMRCSRVC)=+Y,GMRCOSNM=$P(Y,"^",2),(GMRCOLDU,GMRCOLDS)=""
"RTN","GMRCSRVS",10,0)
 .S GMRCACT=$S('$O(^GMR(123.5,+Y,0)):"MAD",1:"MUP"),GMRCOLDU=$P(^(0),"^",2),GMRCOLDN=$P(^(0),"^",1) S ND=0,GMRCOLDS="" F  S ND=$O(^GMR(123.5,+Y,2,ND)) Q:ND?1A.E!(ND="")  S GMRCOLDS=GMRCOLDS_^GMR(123.5,+Y,2,ND,0)_"^"
"RTN","GMRCSRVS",11,0)
 .S DIE=DIC,DR="[GMRC SETUP REQUEST SERVICE]"
"RTN","GMRCSRVS",12,0)
 .D ^DIE
"RTN","GMRCSRVS",13,0)
 .Q
"RTN","GMRCSRVS",14,0)
 S GMRCACT=$S($P(^GMR(123.5,GMRCSRVC,0),"^",2)=9:"MDC",$P(^(0),"^",2)=1:"MDC",1:GMRCACT) D
"RTN","GMRCSRVS",15,0)
 .S GMRCSSNM=$P(^GMR(123.5,GMRCSRVC,0),"^",1)
"RTN","GMRCSRVS",16,0)
 .I GMRCACT'="MAD",GMRCSSNM'=GMRCOSNM S GMRCACT="MUP"
"RTN","GMRCSRVS",17,0)
 .I $S(GMRCACT'="MAD":1,GMRCACT'="MUP":1,1:0),$L(GMRCOLDU),GMRCOLDU=$P(^GMR(123.5,GMRCSRVC,0),"^",2) S GMRCACT="NOACT"
"RTN","GMRCSRVS",18,0)
 .I $S(GMRCACT="MUP":1,GMRCACT="NOACT":1,1:0),GMRCOLDN'=$P(^GMR(123.5,GMRCSRVC,0),"^",1) S GMRCACT="MUP"
"RTN","GMRCSRVS",19,0)
 .S ND=0 F  S ND=$O(^GMR(123.5,GMRCSRVC,2,ND)) Q:ND?1A.E!(ND="")  I GMRCOLDS'=""&(^GMR(123.5,GMRCSRVC,2,ND,0)'=""),GMRCOLDS'[^GMR(123.5,GMRCSRVC,2,ND,0) S GMRCACT="MUP" Q
"RTN","GMRCSRVS",20,0)
 .I $S(GMRCACT="MAD":1,GMRCACT="MUP":1,GMRCACT="MDC":1,1:0) D SVC^GMRC101H(GMRCSRVC,GMRCSSNM,GMRCACT),MSG^XQOR("GMRC ORDERABLE ITEM UPDATE",.GMRCMSG)
"RTN","GMRCSRVS",21,0)
 .D PTRCLN^GMRCU
"RTN","GMRCSRVS",22,0)
 .Q
"RTN","GMRCSRVS",23,0)
 K GMRCMSG,GMRCSSNM,GMRCSRVS,GMRCOLDN,GMRCOLDS,GMRCOLDU,ND
"RTN","GMRCSRVS",24,0)
 ;Ask to continue...
"RTN","GMRCSRVS",25,0)
 ;
"RTN","GMRCSRVS",26,0)
 N GMRC0,GMRCA,GMRCB,GMRCH,GMRCL
"RTN","GMRCSRVS",27,0)
 S GMRC0="YA",GMRCA="Add/Edit Another Service? ",GMRCB="N"
"RTN","GMRCSRVS",28,0)
 S GMRCH="Enter 'YES' to add/edit another service, or 'NO' to exit."
"RTN","GMRCSRVS",29,0)
 S GMRCL=2
"RTN","GMRCSRVS",30,0)
 I '+$$READ(GMRC0,GMRCA,GMRCB,GMRCH,GMRCL) D END Q
"RTN","GMRCSRVS",31,0)
 G EN
"RTN","GMRCSRVS",32,0)
 ;
"RTN","GMRCSRVS",33,0)
END K DIC,DIE,DTOUT,DUOUT,DA,DR,FL,GMRCACT,GMRCANS,GMRCMSG,GMRCREA,GMRCSRVC,GMRCSSNM,REVCODE,RLEVCODE,Y
"RTN","GMRCSRVS",34,0)
 Q
"RTN","GMRCSRVS",35,0)
 ;
"RTN","GMRCSRVS",36,0)
READ(GMRC0,GMRCA,GMRCB,GMRCH,GMRCL) ;
"RTN","GMRCSRVS",37,0)
 ;
"RTN","GMRCSRVS",38,0)
 ;  GMRC0 -> DIR(0) --- Type of read
"RTN","GMRCSRVS",39,0)
 ;  GMRCA -> DIR("A") - Prompt
"RTN","GMRCSRVS",40,0)
 ;  GMRCB -> DIR("B") - Default Answer
"RTN","GMRCSRVS",41,0)
 ;  GMRCH -> DIR("?") - Help text or ^Execute code
"RTN","GMRCSRVS",42,0)
 ;  GMRCL -> Number of blank lines to put before Prompt
"RTN","GMRCSRVS",43,0)
 ;
"RTN","GMRCSRVS",44,0)
 ;  Returns "^" or answer
"RTN","GMRCSRVS",45,0)
 ;
"RTN","GMRCSRVS",46,0)
 N GMRCLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRCSRVS",47,0)
 Q:'$L($G(GMRC0)) U
"RTN","GMRCSRVS",48,0)
 S DIR(0)=GMRC0
"RTN","GMRCSRVS",49,0)
 S:$L($G(GMRCA)) DIR("A")=GMRCA
"RTN","GMRCSRVS",50,0)
 S:$L($G(GMRCB)) DIR("B")=GMRCB
"RTN","GMRCSRVS",51,0)
 S:$L($G(GMRCH)) DIR("?")=GMRCH
"RTN","GMRCSRVS",52,0)
 F GMRCLINE=1:1:($G(GMRCL)-1) W !
"RTN","GMRCSRVS",53,0)
 D ^DIR
"RTN","GMRCSRVS",54,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","GMRCSRVS",55,0)
 Q Y
"RTN","GMRCSRVS",56,0)
 ;
"RTN","GMRCSSP")
0^88^B2794125
"RTN","GMRCSSP",1,0)
GMRCSSP ;SLC/DCM - List Manager Format Routine To Collect Pharmacy TPN Consults that are Not Completed Or Have Been Discontinued ;5/20/98  14:21
"RTN","GMRCSSP",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCSSP",3,0)
EN ;;Main entry point for List Manager Interface
"RTN","GMRCSSP",4,0)
 K GMRCQUT S GMRCDFNS=$S('$D(DFN):0,1:DFN),GMRCFL=1
"RTN","GMRCSSP",5,0)
 D SP^GMRCSLM I $S($D(GMRCQUT):1,'$D(DFN):1,1:0) D QUIT S GMRCQUT=1 Q
"RTN","GMRCSSP",6,0)
 K ^TMP("GMRCS",$J)
"RTN","GMRCSSP",7,0)
 S GMRCSSNM="PHARMACY SERVICE",GMRCSVCN=$O(^GMR(123.5,"B",GMRCSSNM,0)) I GMRCSVCN="" S GMRCQUT=1 S GMRCMSG="Pharmacy Service Does Not Exist In The Consults Service File!" D EXAC^GMRCADC(GMRCMSG),QUIT Q
"RTN","GMRCSSP",8,0)
 S ^TMP("GMRCS",$J,GMRCSVCN)=GMRCSSNM
"RTN","GMRCSSP",9,0)
 D ^GMRCSPD I $D(GMRCQUT) D QUIT Q  ;Get date ranges
"RTN","GMRCSSP",10,0)
 D AD^GMRCSLM1
"RTN","GMRCSSP",11,0)
QUIT ;;Kill off variables and quit
"RTN","GMRCSSP",12,0)
 I $D(GMRCTM),$D(GMRCBM),$D(IOSTBM) S IOTM=GMRCTM,IOBM=GMRCBM K GMRCTM,GMRCBM
"RTN","GMRCSSP",13,0)
 K DFN1,GMRCDFNS,GMRCMSG,ORIFN,DFNS,GMRCFL,GMRCS1,GMRCS2
"RTN","GMRCSSP",14,0)
 Q
"RTN","GMRCST")
0^89^B1413232
"RTN","GMRCST",1,0)
GMRCST ;SLC/DCM - Statistics on how how long to complete consult/requests for a service ;5/20/98  14:21
"RTN","GMRCST",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCST",3,0)
EN ; -- main entry point for GMRC REQUEST COMPLETE STAT
"RTN","GMRCST",4,0)
 D ODT^GMRCSTU Q:$D(GMRCQUT)
"RTN","GMRCST",5,0)
 D EN^VALM("GMRC REQUEST COMPLETE STAT")
"RTN","GMRCST",6,0)
 Q
"RTN","GMRCST",7,0)
 ;
"RTN","GMRCST",8,0)
HDR ; -- header code
"RTN","GMRCST",9,0)
 S VALMHDR(1)="Number Of Days To Complete A Consult For Services Statistics."
"RTN","GMRCST",10,0)
 S VALMHDR(2)=""
"RTN","GMRCST",11,0)
 Q
"RTN","GMRCST",12,0)
 ;
"RTN","GMRCST",13,0)
INIT ; -- init variables and list array
"RTN","GMRCST",14,0)
 K ^TMP("GMRCR",$J,"STLIST")
"RTN","GMRCST",15,0)
 S DSPLINE=0,VALMAR="^TMP(""GMRCR"",$J,""STLIST"")"
"RTN","GMRCST",16,0)
 F LINE=1:1:GMRCCT S DATA=^TMP("GMRCR",$J,"PRL",LINE,0) Q:DSPLINE=""  D SET^VALM10(LINE,DATA)
"RTN","GMRCST",17,0)
 S VALMCNT=GMRCCT,VALMBCK="R"
"RTN","GMRCST",18,0)
 K DATA,DSPLINE,LINE
"RTN","GMRCST",19,0)
 Q
"RTN","GMRCST",20,0)
 ;
"RTN","GMRCST",21,0)
HELP ; -- help code
"RTN","GMRCST",22,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCST",23,0)
 Q
"RTN","GMRCST",24,0)
 ;
"RTN","GMRCST",25,0)
EXIT ; -- exit code
"RTN","GMRCST",26,0)
 K ^TMP("GMRCR",$J,"STLIST"),^TMP("GMRCR",$J,"PRL")
"RTN","GMRCST",27,0)
 K GMRCCT,GMRCSVC
"RTN","GMRCST",28,0)
 Q
"RTN","GMRCST",29,0)
 ;
"RTN","GMRCST",30,0)
EXPND ; -- expand code
"RTN","GMRCST",31,0)
 Q
"RTN","GMRCST",32,0)
 ;
"RTN","GMRCSTAT")
0^90^B2840946
"RTN","GMRCSTAT",1,0)
GMRCSTAT ;SLC/DCM - List Manager Ancilliary routine - Restrict display of consults to a given status or satuses on List Manager Screen ;5/20/98  14:21
"RTN","GMRCSTAT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCSTAT",3,0)
 ;;This routine calles the appropriate routines to prompt for the status of consults to be printed in List Manager and call routines to collect that data
"RTN","GMRCSTAT",4,0)
 ;;and reformat the List Manager global to print the data on the CRT.
"RTN","GMRCSTAT",5,0)
EN ; -- main entry point for GMRCACTM CHANGE STATUS VIEW
"RTN","GMRCSTAT",6,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCSTAT",7,0)
 S GMRCQUIT=0
"RTN","GMRCSTAT",8,0)
 D STS^GMRCSLM Q:GMRCQUIT  D AD^GMRCSLM1
"RTN","GMRCSTAT",9,0)
 D INIT,HDR
"RTN","GMRCSTAT",10,0)
 I $D(IOTM),$D(IOBM) S VALMBCK="R"
"RTN","GMRCSTAT",11,0)
 D EXIT
"RTN","GMRCSTAT",12,0)
 Q
"RTN","GMRCSTAT",13,0)
 ;
"RTN","GMRCSTAT",14,0)
HDR ; -- header code
"RTN","GMRCSTAT",15,0)
 D HDR^GMRCSLM
"RTN","GMRCSTAT",16,0)
 Q
"RTN","GMRCSTAT",17,0)
 ;
"RTN","GMRCSTAT",18,0)
INIT ; -- init variables and list array
"RTN","GMRCSTAT",19,0)
 K ^TMP("GMRCR",$J,"LIST")
"RTN","GMRCSTAT",20,0)
 S DSPLINE=0,VALMAR="^TMP(""GMRCR"",$J,""LIST"")"
"RTN","GMRCSTAT",21,0)
 F LINE=1:1:LNCT S DSPLINE=$O(^TMP("GMRCR",$J,"CS",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCSTAT",22,0)
 S VALMBCK="R",VALMPGE=1,VALMBG=1,VALMLST=LNCT
"RTN","GMRCSTAT",23,0)
 S VALMCNT=LNCT
"RTN","GMRCSTAT",24,0)
 K DSPLINE,DATA,LINE
"RTN","GMRCSTAT",25,0)
 Q
"RTN","GMRCSTAT",26,0)
 ;
"RTN","GMRCSTAT",27,0)
EXIT ;Kill off local variables and exit
"RTN","GMRCSTAT",28,0)
 Q
"RTN","GMRCSTLM")
0^91^B12955714
"RTN","GMRCSTLM",1,0)
GMRCSTLM ;SLC/DCM - List Manager Format Routine - Get Active Consults by service - pending,active,scheduled,incomplete,etc. ;5/20/98  14:21
"RTN","GMRCSTLM",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCSTLM",3,0)
EN ;Entry point into routine
"RTN","GMRCSTLM",4,0)
 K GMRCQUT S GMRCCT=0
"RTN","GMRCSTLM",5,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCSTLM",6,0)
 S U="^",DIC="^GMR(123.5,",DIC(0)="AEMQ",DIC("A")="Select Service/Specialty: " D ^DIC K DIC I Y<1!($D(DUOUT)) S GMRCQUT=1,VALMBCK="Q" G EXIT
"RTN","GMRCSTLM",7,0)
 S GMRCSVC=+Y,GMRCSVCP=$P(Y,"^",2) K ^TMP("GMRCR",$J,"CP")
"RTN","GMRCSTLM",8,0)
 Q
"RTN","GMRCSTLM",9,0)
 ;;
"RTN","GMRCSTLM",10,0)
ENOR(GMRCSVC) ;Entry point for GUI interface.
"RTN","GMRCSTLM",11,0)
 ;GMRCSVC:  Service for which consults are to be displayed.  ALL SERVICES not allowed here.
"RTN","GMRCSTLM",12,0)
 N GMRCDA
"RTN","GMRCSTLM",13,0)
 S TAB="",$P(TAB," ",30)="",GMRCCT=1,GMRCTOT=0,GMRCTOT(3)=0,GMRCTOT(4)=0,GMRCTOT(5)=0,GMRCTOT(6)=0,GMRCTOT(8)=0,GMRCTOT(9)=0,GMRCTOT(11)=0,GMRCTOT(99)=0
"RTN","GMRCSTLM",14,0)
 S GMRCWT=0 F I=3,4,5,6,8,9,11,99 S GMRCXDT=0 F  S GMRCXDT=$O(^GMR(123,"AE",GMRCSVC,I,GMRCXDT)) Q:GMRCXDT=""  D
"RTN","GMRCSTLM",15,0)
 .S GMRCPT=0 F  S GMRCPT=$O(^GMR(123,"AE",GMRCSVC,I,GMRCXDT,GMRCPT)) Q:GMRCPT=""  D  S GMRCTOT=GMRCTOT+1,GMRCTOT(I)=GMRCTOT(I)+1
"RTN","GMRCSTLM",16,0)
 ..S X=9999999-GMRCXDT D REGDTM^GMRCU S GMRCDT=$P(X," ",1)
"RTN","GMRCSTLM",17,0)
 ..S GMRCDLA=$P(X," ",1),GMRCD(0)=^GMR(123,GMRCPT,0),GMRCPTN=$P(^DPT($P(GMRCD(0),"^",2),0),"^",1),GMRCPTN=$P(GMRCPTN,",",1)_","_$E($P(GMRCPTN,",",2),1)_".",GMRCPTSN="("_$E($P(^(0),"^",9),6,9)_")"
"RTN","GMRCSTLM",18,0)
 ..S GMRCD=0,GMRCD=$O(^GMR(123,GMRCPT,40,"B",GMRCD)) I GMRCD]"" S GMRCDA="",GMRCDA=$O(^GMR(123,+GMRCPT,40,"B",GMRCD,GMRCDA)) I +GMRCDA S GMRCDA(0)=^GMR(123,GMRCPT,40,GMRCDA,0) D
"RTN","GMRCSTLM",19,0)
 ...S GMRCDLA=$E($P($G(^GMR(123.1,$P(GMRCDA(0),"^",2),0)),"^"),1,20) Q
"RTN","GMRCSTLM",20,0)
 ..S GMRCLOC=$P(GMRCD(0),"^",4) S:$L(GMRCLOC) GMRCLOC=$P($G(^SC(GMRCLOC,0)),"^",1)
"RTN","GMRCSTLM",21,0)
 ..S STS=$S(I=2:"Hold",I=4:"Flagged",I=5:"Pending",I=6:"Active",I=8:"Scheduled",I=9:"Incomplete",I=11:"Unreleased",1:"No Status")
"RTN","GMRCSTLM",22,0)
 ..S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=STS_$E(TAB,1,10-$L(STS)+1)_GMRCDLA_$E(TAB,1,18-$L(GMRCDLA))_GMRCDT_" "_GMRCPTN_" "_GMRCPTSN_$E(TAB,1,12-$L(GMRCPTN)+5)_GMRCLOC,GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",23,0)
 .Q
"RTN","GMRCSTLM",24,0)
 F I=3,4,5,6,8,9,11,99 I GMRCTOT(I)>0 S ^TMP("GMRCR",$J,"CP",GMRCCT,0)="Total Requests " D  S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",25,0)
 .S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=^TMP("GMRCR",$J,"CP",GMRCCT,0)_$S(I=3:"On Hold:   ",I=4:"Flagged:   ",I=5:"Pending:   ",I=6:"Active:    ",I=8:"Scheduled: ",I=9:"Incomplete:",I=11:"Unreleased:",I=99:"No Status: ",1:"")_$J(GMRCTOT(I),4,0)
"RTN","GMRCSTLM",26,0)
 .Q
"RTN","GMRCSTLM",27,0)
 S ^TMP("GMRCR",$J,"CP",GMRCCT,0)="Total Requests Pending Resolution: "_$J(GMRCTOT,4,0)
"RTN","GMRCSTLM",28,0)
EXIT I $D(IOBM),$D(IOTM) S VALMBCK="R"
"RTN","GMRCSTLM",29,0)
 K I,FR,TAB,DIC,STS,GMRCBM,GMRCD,GMRCO,GMRCDA,GMRCDT,GMRCPT,GMRCTM,GMRCPTN,GMRCPTSN,GMRCDLA,GMRCXDT,GMRCLOC,GMRCTOT,GMRCQUIT,GMRCSTCK,GMRCOER,GMRCSVCN
"RTN","GMRCSTLM",30,0)
 K DIROUT,DTOUT,DUOUT
"RTN","GMRCSTLM",31,0)
 Q
"RTN","GMRCSTU")
0^92^B48371932
"RTN","GMRCSTU",1,0)
GMRCSTU ;SLC/DCM - Statistic Utilities for Consult/Request Package ;9/14/98  13:07
"RTN","GMRCSTU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCSTU",3,0)
SQRT(X) ;calculate the square root of number X
"RTN","GMRCSTU",4,0)
 ;
"RTN","GMRCSTU",5,0)
 Q X**.5
"RTN","GMRCSTU",6,0)
 ;
"RTN","GMRCSTU",7,0)
GETDT(GMRCO) ;get the date that the consult/request was accepted by service
"RTN","GMRCSTU",8,0)
 N ND
"RTN","GMRCSTU",9,0)
 S ND=0 F  S ND=$O(^GMR(123,GMRCO,40,ND)) Q:ND?1A.E!(ND="")  D
"RTN","GMRCSTU",10,0)
 .S:$P(^GMR(123,GMRCO,40,ND,0),"^",2)=21 GMRCDA=$P(^(0),"^",1) S:$P(^GMR(123,GMRCO,40,ND,0),"^",2)=1 GMRCDA(1)=$P(^(0),"^",1) S:$P(^GMR(123,GMRCO,40,ND,0),"^",3)=15 GMRCDA(15)=$P(^(0),"^",3)
"RTN","GMRCSTU",11,0)
 .Q
"RTN","GMRCSTU",12,0)
 S GMRCCDT=$S($D(GMRCDA)#1:GMRCDA,$D(GMRCDA(1)):GMRCDA(1),$D(GMRCDA(15)):GMRCDA(15),1:$P(^GMR(123,GMRCO,0),"^",1))
"RTN","GMRCSTU",13,0)
 I '$D(GMRCDA),$D(GMRCDA(0)) S GMRCCDT=$S(+GMRCDA(0):GMRCDA(0),1:"")
"RTN","GMRCSTU",14,0)
 M TIMES=GMRCDA K GMRCDA
"RTN","GMRCSTU",15,0)
 Q
"RTN","GMRCSTU",16,0)
ODT ;Find the mean, standard deviation of how long to complete a consult from when it is accepted in the service to when it is complete
"RTN","GMRCSTU",17,0)
 K ^TMP("GMRCS",$J),GMRCQUT
"RTN","GMRCSTU",18,0)
 D ASRV^GMRCASV Q:$D(GMRCQUT)  I '$O(^TMP("GMRCS",$J,0)) S GMRCQUT=1 Q
"RTN","GMRCSTU",19,0)
 S ND=1 F  S ND=$O(^TMP("GMRCS",$J,ND)) Q:ND=""  S GMRCSVC(ND)="0^0^0^0^0^0",GMRCSVC(ND,"I")="0^0^0^0^0",GMRCSVC(ND,"O")="0^0^0^0^0"
"RTN","GMRCSTU",20,0)
 D ^GMRCSPD I $D(GMRCQUT) D KILL Q
"RTN","GMRCSTU",21,0)
 W !,"Compiling."
"RTN","GMRCSTU",22,0)
 S (ND,GMRCND)=0 F  S ND=$O(GMRCSVC(ND)) Q:ND=""  S GMRCDT="" F  S GMRCDT=$O(^GMR(123,"AE",ND,2,GMRCDT)) Q:GMRCDT=""  S GMRCO=0,GMRCO=$O(^GMR(123,"AE",ND,2,GMRCDT,GMRCO)) D GETDT(GMRCO) D
"RTN","GMRCSTU",23,0)
 .S GMRCO="" F  S GMRCO=$O(^GMR(123,"AE",ND,2,GMRCDT,GMRCO)) Q:GMRCO=""  D  W:'(GMRCND#25) "."
"RTN","GMRCSTU",24,0)
 ..I $S(GMRCDT1="ALL":1,GMRCCDT'<GMRCDT1&(GMRCCDT'>GMRCDT2):1,1:0) D  W:'(GMRCND#100) "."
"RTN","GMRCSTU",25,0)
 ...S ND1=0 F  S ND1=$O(^GMR(123,GMRCO,40,ND1)) Q:ND1?1A.E  I $P(^GMR(123,GMRCO,40,ND1,0),"^",2)=10 D  Q
"RTN","GMRCSTU",26,0)
 ....S X1=$P(^GMR(123,GMRCO,40,ND1,0),"^",3),X2=GMRCCDT D ^%DTC
"RTN","GMRCSTU",27,0)
 ....S $P(GMRCSVC(ND),"^",1)=+$P(GMRCSVC(ND),"^",1)+X,$P(GMRCSVC(ND),"^",2)=+$P(GMRCSVC(ND),"^",2)+1,$P(GMRCSVC(ND),"^",3)=$P(GMRCSVC(ND),"^",3)+(X*X)
"RTN","GMRCSTU",28,0)
 ....I $P(^GMR(123,GMRCO,0),"^",18)="I" S $P(GMRCSVC(ND,"I"),"^",1)=$P(GMRCSVC(ND,"I"),"^",1)+X,$P(GMRCSVC(ND,"I"),"^",2)=$P(GMRCSVC(ND,"I"),"^",2)+1,$P(GMRCSVC(ND,"I"),"^",3)=$P(GMRCSVC(ND,"I"),"^",3)+(X*X) Q
"RTN","GMRCSTU",29,0)
  ....I $P(^GMR(123,GMRCO,0),"^",18)="O" S $P(GMRCSVC(ND,"O"),"^",1)=$P(GMRCSVC(ND,"O"),"^",1)+X,$P(GMRCSVC(ND,"O"),"^",2)=$P(GMRCSVC(ND,"O"),"^",2)+1,$P(GMRCSVC(ND,"O"),"^",3)=$P(GMRCSVC(ND,"O"),"^",3)+(X*X)
"RTN","GMRCSTU",30,0)
 ....Q
"RTN","GMRCSTU",31,0)
 ...Q
"RTN","GMRCSTU",32,0)
 ..S GMRCND=GMRCND+1 Q
"RTN","GMRCSTU",33,0)
 .Q
"RTN","GMRCSTU",34,0)
 S ND=0 F  S ND=$O(GMRCSVC(ND)) Q:ND=""  I $P(GMRCSVC(ND),"^",1)>0 D
"RTN","GMRCSTU",35,0)
 .S $P(GMRCSVC(ND),"^",4)=$P(GMRCSVC(ND),"^",1)/$P(GMRCSVC(ND),"^",2) D:$P(GMRCSVC(ND),"^",2)>1  I $P(GMRCSVC(ND),"^",2)'>1 S $P(GMRCSVC(ND),"^",5)="N<2"
"RTN","GMRCSTU",36,0)
 ..S VAR=$P(GMRCSVC(ND),"^",3),SUMX=$P(GMRCSVC(ND),"^",1),SUMX=SUMX*SUMX/$P(GMRCSVC(ND),"^",2),VAR=(VAR-SUMX)/($P(GMRCSVC(ND),"^",2)-1),$P(GMRCSVC(ND),"^",5)=$$SQRT(VAR)
"RTN","GMRCSTU",37,0)
 ..Q
"RTN","GMRCSTU",38,0)
 .I $P(GMRCSVC(ND,"I"),"^",2)>0 S $P(GMRCSVC(ND,"I"),"^",4)=$P(GMRCSVC(ND,"I"),"^",1)/$P(GMRCSVC(ND,"I"),"^",2) D
"RTN","GMRCSTU",39,0)
 ..I $P(GMRCSVC(ND,"I"),"^",2)<2 S $P(GMRCSVC(ND,"I"),"^",5)="N<2" Q
"RTN","GMRCSTU",40,0)
 ..S VAR=$P(GMRCSVC(ND,"I"),"^",3),SUMX=$P(GMRCSVC(ND,"I"),"^",1),SUMX=SUMX*SUMX/$P(GMRCSVC(ND,"I"),"^",2),VAR=(VAR-SUMX)/($P(GMRCSVC(ND,"I"),"^",2)-1),$P(GMRCSVC(ND,"I"),"^",5)=$$SQRT(VAR)
"RTN","GMRCSTU",41,0)
 ..I $P(GMRCSVC(ND,"O"),"^",2)<2 S $P(GMRCSVC(ND,"O"),"^",5)="N<2" Q
"RTN","GMRCSTU",42,0)
 .I $P(GMRCSVC(ND,"O"),"^",2)>0 S $P(GMRCSVC(ND,"O"),"^",4)=$P(GMRCSVC(ND,"O"),"^",1)/$P(GMRCSVC(ND,"O"),"^",2) D
"RTN","GMRCSTU",43,0)
 ..I $P(GMRCSVC(ND,"O"),"^",2)<2 S $P(GMRCSVC(ND,"O"),"^",5)="N<2" Q
"RTN","GMRCSTU",44,0)
 ..S VAR=$P(GMRCSVC(ND,"O"),"^",3),SUMX=$P(GMRCSVC(ND,"O"),"^",1),SUMX=SUMX*SUMX/$P(GMRCSVC(ND,"O"),"^",2),VAR=(VAR-SUMX)/($P(GMRCSVC(ND,"O"),"^",2)-1),$P(GMRCSVC(ND,"O"),"^",5)=$$SQRT(VAR)
"RTN","GMRCSTU",45,0)
 ..Q
"RTN","GMRCSTU",46,0)
 .Q
"RTN","GMRCSTU",47,0)
 K ^TMP("GMRCR",$J,"PRL")
"RTN","GMRCSTU",48,0)
 S GMRCCT=1,GMRCEDT1=$$FMTE^XLFDT(GMRCDT1),GMRCEDT2=$$FMTE^XLFDT(GMRCDT2),TAB="",$P(TAB," ",30)=""
"RTN","GMRCSTU",49,0)
 S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=$E(TAB,1,20)_"Consult/Request Completion Time Statistics",GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"PRL",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSTU",50,0)
 S ND=0 F  S ND=$O(GMRCSVC(ND)) Q:ND=""  D
"RTN","GMRCSTU",51,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)="SERVICE: "_$P(^GMR(123.5,ND,0),"^",1),GMRCCT=GMRCCT+1
"RTN","GMRCSTU",52,0)
 .I GMRCEDT1'="ALL" S Y=GMRCEDT1 X ^DD("DD") S GMRCEDT1=$P(Y,"@",1) K %,%DT,%H,%I
"RTN","GMRCSTU",53,0)
 .I GMRCEDT2=0 S X="NOW" D NOW^%DTC S Y=% K %,%DT,%H,%I X ^DD("DD") S GMRCEDT2=$P(Y,"@",1)
"RTN","GMRCSTU",54,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)="FROM: "_GMRCEDT1_"   TO: "_GMRCEDT2,GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"PRL",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSTU",55,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)="Total Number Of Consults Completed: "_$P(GMRCSVC(ND),"^",2),GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"PRL",GMRCCT,0)="Mean Days To Complete: "_$J($P(GMRCSVC(ND),"^",4),4,1)
"RTN","GMRCSTU",56,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=^TMP("GMRCR",$J,"PRL",GMRCCT,0)_$E(TAB,1,50-$L(^(0)))_"Standard Deviation: "_$S($P(GMRCSVC(ND),"^",5)=+$P(GMRCSVC(ND),"^",5):$J($P(GMRCSVC(ND),"^",5),4,1),1:$P(GMRCSVC(ND),"^",5)),GMRCCT=GMRCCT+1
"RTN","GMRCSTU",57,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)="Total INPATIENT Consults: "_$P(GMRCSVC(ND,"I"),"^",2),GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"PRL",GMRCCT,0)="Mean Days To Complete: "_$J($P(GMRCSVC(ND,"I"),"^",4),4,1)
"RTN","GMRCSTU",58,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=^TMP("GMRCR",$J,"PRL",GMRCCT,0)_$E(TAB,1,50-$L(^(0)))_"Standard Deviation: "_$S($P(GMRCSVC(ND,"I"),"^",5)=+$P(GMRCSVC(ND,"I"),"^",5):$J($P(GMRCSVC(ND,"I"),"^",5),4,1),1:$P(GMRCSVC(ND,"I"),"^",5))
"RTN","GMRCSTU",59,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSTU",60,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)="Total OUTPATIENT Consults: "_$P(GMRCSVC(ND,"O"),"^",2),GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"PRL",GMRCCT,0)="Mean Days To Complete: "_$J($P(GMRCSVC(ND,"O"),"^",4),4,1)
"RTN","GMRCSTU",61,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)=^TMP("GMRCR",$J,"PRL",GMRCCT,0)_$E(TAB,1,50-$L(^(0)))_"Standard Deviation: "_$S($P(GMRCSVC(ND,"O"),"^",5)=+$P(GMRCSVC(ND,"O"),"^",5):$J($P(GMRCSVC(ND,"O"),"^",5),4,1),1:$P(GMRCSVC(ND,"O"),"^",5))
"RTN","GMRCSTU",62,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSTU",63,0)
 .I +$P(GMRCSVC(ND),"^",6)>0 S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)="No. With Unresolved Accepted in Service Times: "_$J($P(GMRCSVC(ND),"^",6),3)_"  (Not Included In Statistics)",GMRCCT=GMRCCT+1
"RTN","GMRCSTU",64,0)
 .S ^TMP("GMRCR",$J,"PRL",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSTU",65,0)
 .Q
"RTN","GMRCSTU",66,0)
 S GMRCCT=GMRCCT-1
"RTN","GMRCSTU",67,0)
KILL ;kill variables and exit
"RTN","GMRCSTU",68,0)
 K ^TMP("GMRCS",$J)
"RTN","GMRCSTU",69,0)
 K GMRCCDT,GMRCDG,GMRCDGT,GMRCDT,GMRCDT1,GMRCDT2,GMRCEDT1,GMRCEDT2,GMRCGRP,GMRCND,GMRCO,ND,ND1,SUMX,X,VAR ;,GMRCSVC
"RTN","GMRCSTU",70,0)
 Q
"RTN","GMRCSTU",71,0)
PRNT ;print statistics to a printer
"RTN","GMRCSTU",72,0)
 Q:'$D(^TMP("GMRCR",$J,"PRL",2,0))
"RTN","GMRCSTU",73,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCSTU",74,0)
 K GMRCQUT
"RTN","GMRCSTU",75,0)
 S POP=0,%ZIS="MQ" D ^%ZIS I POP S GMRCMSG="Printer Busy. Try Again Later." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG S GMRCQUT=1 Q
"RTN","GMRCSTU",76,0)
 I $D(IO("Q")) M ^XTMP("GMRCR","$"_$J,"PRL")=^TMP("GMRCR",$J,"PRL") S ZTRTN="PRNTQ^GMRCSTU",ZTDESC="CONSULT/REQUEST PACKAGE PRINT COMPLETION TIME STATISTICS",ZTSAVE("J")="$"_$J D ^%ZTLOAD,^%ZISC S VALMBCK="R" Q
"RTN","GMRCSTU",77,0)
 U IO
"RTN","GMRCSTU",78,0)
 S A="" F  S A=$O(^TMP("GMRCR",$J,"PRL",A)) Q:A=""  W ^TMP("GMRCR",$J,"PRL",A,0),! I IOST["C-",$Y>20 R "Press <ENTER> To Continue, '^' To Quit: ",GMRCANS:DTIME Q:'$T!(GMRCANS["^")  W @IOF
"RTN","GMRCSTU",79,0)
 I IOST["C-",$Y>1 R !,"Press <ENTER> To Continue, '^' To Quit: ",GMRCANS:DTIME
"RTN","GMRCSTU",80,0)
 U IO(0) D ^%ZISC
"RTN","GMRCSTU",81,0)
 S VALMBCK="R"
"RTN","GMRCSTU",82,0)
 K GMRCANS,GMRCBM,GMRCTM,A
"RTN","GMRCSTU",83,0)
 Q
"RTN","GMRCSTU",84,0)
PRNTQ ;Print Queued report from ^XTMP global then kill off ^XTMP
"RTN","GMRCSTU",85,0)
 U IO
"RTN","GMRCSTU",86,0)
 S A="" F  S A=$O(^XTMP("GMRCR",J,"PRL",A)) Q:A=""  W ^XTMP("GMRCR",J,"PRL",A,0),!
"RTN","GMRCSTU",87,0)
 K ^XTMP("GMRCR",J,"PRL"),A,J
"RTN","GMRCSTU",88,0)
 D ^%ZISC
"RTN","GMRCSTU",89,0)
 Q
"RTN","GMRCT")
0^93^B4579878
"RTN","GMRCT",1,0)
GMRCT ;SLC/DLT - Get DUZ's of users for notification to service ;5/20/98  14:21
"RTN","GMRCT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCT",3,0)
EN(GMRCSS) ;Get who is to be notified for alert action and place them in array ORBADUZ
"RTN","GMRCT",4,0)
 K ORBADUZ
"RTN","GMRCT",5,0)
 N GMRCU,GMRCTM,GMRCTMI,GMRCLST,GMRCER,GMRCHL,GMRCSSI,GMRCU,GMRCWL
"RTN","GMRCT",6,0)
 I $D(^GMR(123.5,GMRCSS,123)),$P(^GMR(123.5,GMRCSS,123),"^",8) S ORBADUZ($P(^(123),"^",8))=""
"RTN","GMRCT",7,0)
 I $D(^GMR(123.5,GMRCSS,123.1)) D TEAM
"RTN","GMRCT",8,0)
 I $D(^GMR(123.5,GMRCSS,123.2)),+$G(GMRCO) D LOC
"RTN","GMRCT",9,0)
 Q
"RTN","GMRCT",10,0)
LOC ;Find the patients location and match to location assignments
"RTN","GMRCT",11,0)
 S GMRCWL="",GMRCHL=""
"RTN","GMRCT",12,0)
 I +$G(GMRCO) S GMRCHL=$P(^GMR(123,+GMRCO,0),"^",4) I GMRCHL S GMRCWL=$G(^SC(GMRCHL,42)) S:GMRCWL GMRCWL=GMRCWL_";DIC(42," S GMRCHL=GMRCHL_";SC("
"RTN","GMRCT",13,0)
 E  S:+$G(GMRCWLI) GMRCWL=GMRCWLI_";DIC(42," S:+$G(GMRCHLI) GMRCHL=GMRCHLI_";SC("
"RTN","GMRCT",14,0)
 I +GMRCWL S GMRCSSI=$O(^GMR(123.5,GMRCSS,123.2,"B",GMRCWL,"")) I GMRCSSI D LOC1
"RTN","GMRCT",15,0)
 I +GMRCHL S GMRCSSI=$O(^GMR(123.5,GMRCSS,123.2,"B",GMRCHL,"")) I GMRCSSI D LOC1
"RTN","GMRCT",16,0)
 Q
"RTN","GMRCT",17,0)
LOC1 ;Get user and/or team assigned to location
"RTN","GMRCT",18,0)
 I $P(^GMR(123.5,GMRCSS,123.2,GMRCSSI,0),"^",2) S ORBADUZ($P(^(0),"^",2))=""
"RTN","GMRCT",19,0)
 I $P(^GMR(123.5,GMRCSS,123.2,GMRCSSI,0),"^",3) S GMRCTMI=$P(^(0),"^",3) D TEAM1
"RTN","GMRCT",20,0)
 Q
"RTN","GMRCT",21,0)
TEAM ;Loop through Teams to send all users notifications
"RTN","GMRCT",22,0)
 S GMRCTM=0 F  S GMRCTM=$O(^GMR(123.5,GMRCSS,123.1,GMRCTM)) Q:'+GMRCTM  S GMRCTMI=$P($G(^GMR(123.5,GMRCSS,123.1,GMRCTM,0)),"^") I GMRCTMI D TEAM1
"RTN","GMRCT",23,0)
 Q
"RTN","GMRCT",24,0)
TEAM1 ;Get user DUZ's from Team pointed to in File
"RTN","GMRCT",25,0)
 S GMRCLST="" D TEAMPROV^ORQPTQ1(.GMRCLST,GMRCTMI)
"RTN","GMRCT",26,0)
 Q:$S('$O(GMRCLST(0)):1,$P(GMRCLST(1),"^",2)="No providers found.":1,1:0)
"RTN","GMRCT",27,0)
 S GMRCU=0 F  S GMRCU=$O(GMRCLST(GMRCU)) Q:GMRCU=""  S ORBADUZ($P(GMRCLST(GMRCU),"^",1))=""
"RTN","GMRCT",28,0)
 K GMRCLST
"RTN","GMRCT",29,0)
 Q
"RTN","GMRCTIU")
0^94^B60787590
"RTN","GMRCTIU",1,0)
GMRCTIU ;SLC/DCM - TIU utilities for exchanging info with TIU and Consults/Requests ;5/20/98  14:21
"RTN","GMRCTIU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCTIU",3,0)
GET(GMRCO,GMRCTUFN,GMRCTUST) ;Receive the IEN of TIU file for a patient from TIU; also recieve TIU status update.
"RTN","GMRCTIU",4,0)
 ;GMRCO=IFN from file 123            GMRCTUFN=TIU IFN
"RTN","GMRCTIU",5,0)
 ;GMRCTUST=TIU status of report
"RTN","GMRCTIU",6,0)
 Q:$P(^GMR(123,GMRCO,0),"^",12)=2
"RTN","GMRCTIU",7,0)
 N GMRCA,GMRCSTS,GMRCDFN,GMRCSVC,GMRCSSNM,GMRCPROC
"RTN","GMRCTIU",8,0)
 I GMRCTUFN]"",'$P(^GMR(123,GMRCO,0),"^",20) S $P(^(0),"^",20)=GMRCTUFN
"RTN","GMRCTIU",9,0)
 I $L(GMRCTUST) S GMRCA=$S(GMRCTUST["INCOMPLETE":9,1:10),GMRCSTS=$S(GMRCA=10:2,1:9) D STATUS^GMRCP
"RTN","GMRCTIU",10,0)
 I +GMRCA D STATUS^GMRCTIU1
"RTN","GMRCTIU",11,0)
 K GMRCOM,GMRCND,GMRCDTC,GMRCORNP,GMRCORTX,GMRCSA,GMRCSTS,ORBADUZ
"RTN","GMRCTIU",12,0)
 Q
"RTN","GMRCTIU",13,0)
SEND(GMRCDFN) ;Create ^TMP( global list of active consults on a patient to pass to TIU
"RTN","GMRCTIU",14,0)
 ;GMRCDFN=Patient's DFN from file 2
"RTN","GMRCTIU",15,0)
 N INC
"RTN","GMRCTIU",16,0)
 Q:GMRCDFN=""!(GMRCDFN<1)
"RTN","GMRCTIU",17,0)
 D NOW^%DTC S GMRCFYR=%-10000
"RTN","GMRCTIU",18,0)
 S GMRCND=0,TAB="",$P(TAB," ",30)=""
"RTN","GMRCTIU",19,0)
 K ^TMP("GMRCR",$J,"TIU"),GMRCTMP S INC=1
"RTN","GMRCTIU",20,0)
 F  S GMRCND=$O(^GMR(123,"F",GMRCDFN,GMRCND)) Q:GMRCND=""  D
"RTN","GMRCTIU",21,0)
 .S GMRCDT=$P(^GMR(123,GMRCND,0),"^",1) Q:GMRCFYR>GMRCDT
"RTN","GMRCTIU",22,0)
 .I $S($P(^GMR(123,GMRCND,0),"^",12)=6:1,$P(^(0),"^",12)=9:1,$P(^(0),"^",12)=5:1,1:0) D
"RTN","GMRCTIU",23,0)
 ..S GMRCRDT=9999999-GMRCDT S:$D(GMRCTMP(GMRCRDT)) GMRCRDT=GMRCRDT+("."_$E("0000000",1,$L($P(GMRCRDT,".",2))-1)_INC),INC=INC+1 S GMRCTMP(GMRCRDT)=GMRCND
"RTN","GMRCTIU",24,0)
 ..Q
"RTN","GMRCTIU",25,0)
 .Q
"RTN","GMRCTIU",26,0)
 S GMRCRDT="",GMRCND=0,GMRCLN=0
"RTN","GMRCTIU",27,0)
 F  S GMRCRDT=$O(GMRCTMP(GMRCRDT)) Q:GMRCRDT=""  D
"RTN","GMRCTIU",28,0)
 .S GMRCND=GMRCTMP(GMRCRDT),GMRC(0)=^GMR(123,GMRCND,0),GMRCDT=$P(GMRC(0),"^",1)
"RTN","GMRCTIU",29,0)
 .S GMRCPROC=$P(GMRC(0),"^",8) I GMRCPROC]"" S GMRCPROC=$P(^ORD(101,+GMRCPROC,0),"^",2)
"RTN","GMRCTIU",30,0)
 .S GMRCSVC=$P(GMRC(0),"^",5) I GMRCSVC]"" S GMRCSVC=$P(^GMR(123.5,GMRCSVC,0),"^",1)
"RTN","GMRCTIU",31,0)
 .D DT^DILF("ET",GMRCDT,.Y,"","GMRCHELP") I Y>0 S GMRCEDT=Y(0)
"RTN","GMRCTIU",32,0)
 .S GMRCLN=GMRCLN+1,^TMP("GMRCR",$J,"TIU",GMRCLN,0)=$J(GMRCLN,4)_">  "_$E(GMRCEDT_TAB,1,20)_$E(GMRCND_TAB,1,8)_$E(GMRCSVC_TAB,1,18)_$E(GMRCPROC,1,35),^TMP("GMRCR",$J,"TIU","B",GMRCLN,GMRCND)=""
"RTN","GMRCTIU",33,0)
 I '$O(^TMP("GMRCR",$J,"TIU",0)) S ^TMP("GMRCR",$J,"TIU",1,0)="No Consults For "_$P(^DPT(GMRCDFN,0),"^",1)_" On Record."
"RTN","GMRCTIU",34,0)
 K GMRCTMP,GMRCND,GMRC,GMRCDT,GMRCRDT,GMRCEDT,GMRCFYR,GMRCLCT,GMRCLN,GMRCPROC,GMRCSVC
"RTN","GMRCTIU",35,0)
 Q
"RTN","GMRCTIU",36,0)
DSPLAY(GMRCTUFN,LINECT) ;Get TIU results narrative and get it ready for display
"RTN","GMRCTIU",37,0)
 ;GMRCTUFN=TIU IEN of results record     LINECT=line count for list manager
"RTN","GMRCTIU",38,0)
 K VALMAR
"RTN","GMRCTIU",39,0)
 D GET^TIUSRV(GMRCTUFN,1)
"RTN","GMRCTIU",40,0)
 S ND=0 D
"RTN","GMRCTIU",41,0)
 .F  S ND=$O(^TMP("TIUAUDIT",$J,ND)) Q:ND=""  S ^TMP("GMRCR",$J,"DT",LINECT,0)=^TMP("TIUAUDIT",$J,ND,0),LINECT=LINECT+1
"RTN","GMRCTIU",42,0)
 .Q
"RTN","GMRCTIU",43,0)
 D CLEAN^VALM10
"RTN","GMRCTIU",44,0)
 K ^TMP("TIUAUDIT",$J),ND,RESFL,GMRCTIUY
"RTN","GMRCTIU",45,0)
 S:LINECT>1 LINECT=LINECT-1
"RTN","GMRCTIU",46,0)
 Q
"RTN","GMRCTIU",47,0)
PRINT(GMRCTUFN,LINECT,GMRCRT) ;get TIU results and prepare them for printing on the 513
"RTN","GMRCTIU",48,0)
 ;GMRCRT=Flag from RT^GMRCA1 indicating that result request is from there: GMRCRT=0 means 'NO', GRMRCRT=1 means 'YES" (and ES is appended to TIU main result)
"RTN","GMRCTIU",49,0)
 ;GMRCTUFN=IEN of the TIU result from file 8925
"RTN","GMRCTIU",50,0)
 ;GMRCSIG=signature block name of signer   GMRCSDT=date result was signed
"RTN","GMRCTIU",51,0)
 ;GMRCSIGT=signers block title             GMRCTUFN=TIU IEN of the result record
"RTN","GMRCTIU",52,0)
 ;GMRCCSIG=cosigners block name            GMRCCSDT=date cosigner signed
"RTN","GMRCTIU",53,0)
 ;GMRCCTIT=cosigners block title           GMRCSIGM=Signature mode (E:ELECTRONIC/C:CHART)
"RTN","GMRCTIU",54,0)
 S GLOBAL="^TMP(""GMRCR"",$J,""GMRCTIU"")",DR="1501;1502;1503;1504;1505;1506;1507;1508;1509;1510;1511;1601;1602;1603;1604;1605"
"RTN","GMRCTIU",55,0)
 K @GLOBAL,^TMP("GMRCR",$J,"RES")
"RTN","GMRCTIU",56,0)
 D EXTRACT^TIULQ(GMRCTUFN,GLOBAL,.GMRCERR,DR,"",1,"")
"RTN","GMRCTIU",57,0)
 S GMRCSIG=$G(@GLOBAL@(GMRCTUFN,1503)),GMRCSDT=$G(@GLOBAL@(GMRCTUFN,1501)),GMRCSDT=$P(GMRCSDT,"@",1),GMRCSIGT=$G(@GLOBAL@(GMRCTUFN,1504))
"RTN","GMRCTIU",58,0)
 S GMRCCSIG=$G(@GLOBAL@(GMRCTUFN,1509)),GMRCCSDT=$G(@GLOBAL@(GMRCTUFN,1507)),GMRCCSDT=$P(GMRCCSDT,"@",1),GMRCCTIT=$G(@GLOBAL@(GMRCTUFN,1510)),GMRCMODE=$G(@GLOBAL@(GMRCTUFN,1611))
"RTN","GMRCTIU",59,0)
 S:$L(GMRCCSIG) GMRCCSIG=$S(@GLOBAL@(GMRCTUFN,1511)="electronic":" /es/",1:"")_GMRCCSIG
"RTN","GMRCTIU",60,0)
 S GMRCSIGM=$G(@GLOBAL@(GMRCTUFN,1505))
"RTN","GMRCTIU",61,0)
 I $O(@GLOBAL@(GMRCTUFN,"TEXT",0)) D
"RTN","GMRCTIU",62,0)
 .S ND=0 F  S ND=$O(@GLOBAL@(GMRCTUFN,"TEXT",ND)) Q:ND=""  S ^TMP("GMRCR",$J,"RES",LINECT,0)=@GLOBAL@(GMRCTUFN,"TEXT",ND,0),LINECT=LINECT+1
"RTN","GMRCTIU",63,0)
 .I GMRCRT S ^TMP("GMRCR",$J,"RES",LINECT,0)="",LINECT=LINECT+1,^TMP("GMRCR",$J,"RES",LINECT,0)="/es/"_GMRCSIG_"         Date: "_GMRCSDT,LINECT=LINECT+1
"RTN","GMRCTIU",64,0)
 .Q
"RTN","GMRCTIU",65,0)
 I $O(@GLOBAL@(GMRCTUFN,"ZADD",0)) S GMRCADD=0 F  S GMRCADD=$O(@GLOBAL@(GMRCTUFN,"ZADD",GMRCADD)) Q:GMRCADD=""  D
"RTN","GMRCTIU",66,0)
 .I '$L(@GLOBAL@(GMRCTUFN,"ZADD",GMRCADD,1502,"E")) Q
"RTN","GMRCTIU",67,0)
 .S ND=0,ND1=0 F  S ND=$O(@GLOBAL@(GMRCTUFN,"ZADD",GMRCADD,"TEXT",ND)) Q:ND=""  S ND1=ND1+1,^TMP("GMRCR",$J,"RES","ADD",GMRCADD,ND1,0)=@GLOBAL@(GMRCTUFN,"ZADD",GMRCADD,"TEXT",ND,0)
"RTN","GMRCTIU",68,0)
 .S ND1=ND1+1,^TMP("GMRCR",$J,"RES","ADD",GMRCADD,ND1,0)="",ND1=ND1+1,^TMP("GMRCR",$J,"RES","ADD",GMRCADD,ND1,0)="Signature: "_$S(@GLOBAL@(GMRCTUFN,"ZADD",GMRCADD,1505,"E")="electronic":"/es/",1:"")_@GLOBAL@(GMRCTUFN,"ZADD",GMRCADD,1503,"E")
"RTN","GMRCTIU",69,0)
 .S ^TMP("GMRCR",$J,"RES","ADD",GMRCADD,ND1,0)=^TMP("GMRCR",$J,"RES","ADD",GMRCADD,ND1,0)_"      "_$G(@GLOBAL@(GMRCTUFN,"ZADD",GMRCADD,1501,"E"))
"RTN","GMRCTIU",70,0)
 .S GMRCSGAD(GMRCADD)="/es/"_@GLOBAL@(GMRCTUFN,"ZADD",GMRCADD,1503,"E"),GMRCADDT(GMRCADD)=@GLOBAL@(GMRCTUFN,"ZADD",GMRCADD,1501,"E")
"RTN","GMRCTIU",71,0)
 .Q
"RTN","GMRCTIU",72,0)
 K ^TMP("GMRCR",$J,"GMRCTIU")
"RTN","GMRCTIU",73,0)
 K ND,ND1,DR
"RTN","GMRCTIU",74,0)
 Q
"RTN","GMRCTIU",75,0)
ENTER(GMRCO) ; Call TIU utilities to enter results
"RTN","GMRCTIU",76,0)
 K GMRCQUT N TIUDA,TIUCLASS
"RTN","GMRCTIU",77,0)
 I '$L(GMRCO) D  I $D(GMRCQUT) Q
"RTN","GMRCTIU",78,0)
 . I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR")
"RTN","GMRCTIU",79,0)
 . I '$D(GMRCSEL) D SEL^GMRCA2
"RTN","GMRCTIU",80,0)
 . I $S($D(DTOUT):1,$D(DIROUT):1,'GMRCSEL:1,1:0) S GMRCQUT=1 K DTOUT,DIROUT,DUOUT Q
"RTN","GMRCTIU",81,0)
 . S GMRCO=$O(^TMP("GMRCR",$J,"CS","AD",+GMRCSEL,+GMRCSEL,0))
"RTN","GMRCTIU",82,0)
 . I '+GMRCO D  Q
"RTN","GMRCTIU",83,0)
 . . S GMRCQUT=1
"RTN","GMRCTIU",84,0)
 . . W !,$C(7),"Not A Valid Consult Number. Enter A Number Between 1 and "
"RTN","GMRCTIU",85,0)
 . . W LNCT,".",!,"Or Type '^' To Quit."
"RTN","GMRCTIU",86,0)
 . . W !,"Press <ENTER> To Continue: " R X:DTIME
"RTN","GMRCTIU",87,0)
 . . K GMRCO
"RTN","GMRCTIU",88,0)
 . . Q
"RTN","GMRCTIU",89,0)
 . Q
"RTN","GMRCTIU",90,0)
 I $S($P(^GMR(123,GMRCO,0),"^",12)=1:1,$P(^(0),"^",12)=2:1,$P(^(0),"^",12)=7:1,$P(^(0),"^",12)=13:1,1:0) D  S GMRCQUT=1 G EDEX
"RTN","GMRCTIU",91,0)
 .W !!,$C(7),"No Action Possible: This Order Has "_$S($P(^GMR(123,GMRCO,0),"^",12)=1:"Been DISCONTINUED",$P(^(0),"^",12)=2:"Been COMPLETED",$P(^(0),"^",12)=13:"CANCELLED",1:"CANCELLED")
"RTN","GMRCTIU",92,0)
 .R !,"Press <RETURN> To Continue...",GMRCANS:DTIME
"RTN","GMRCTIU",93,0)
 .Q
"RTN","GMRCTIU",94,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCTIU",95,0)
 S GMRCDFN=$P(^GMR(123,GMRCO,0),"^",2),GMRCTUFN=$P(^(0),"^",20)
"RTN","GMRCTIU",96,0)
 ;If TIU Document already exists, use single record edit, and quit
"RTN","GMRCTIU",97,0)
 I +GMRCTUFN,+$D(^TIU(8925,+GMRCTUFN,0)) D  G EDEX
"RTN","GMRCTIU",98,0)
 . N TIUDA,TIUPRM0,TIUPRM1 S TIUDA=GMRCTUFN
"RTN","GMRCTIU",99,0)
 . D EDIT1^TIURA
"RTN","GMRCTIU",100,0)
 ;interface code making a call to TIU for entering consults results
"RTN","GMRCTIU",101,0)
 S TIUCLASS=+$$CLASS
"RTN","GMRCTIU",102,0)
 I TIUCLASS'>0 D  G EDEX
"RTN","GMRCTIU",103,0)
 . W !!,$C(7),"Consult Resulting through TIU is not yet implemented."
"RTN","GMRCTIU",104,0)
 . W !,"That's okay though, You can still mark the Consult as Complete."
"RTN","GMRCTIU",105,0)
 . D 6^GMRCR06
"RTN","GMRCTIU",106,0)
 D MAIN^TIUEDIT(TIUCLASS,.TIUDA,GMRCDFN,"","","","",1)
"RTN","GMRCTIU",107,0)
 I +$G(TIUDA),$D(^TIU(8925,+$G(TIUDA),0)),'+$P($G(^GMR(123,+GMRCO,0)),U,20) D
"RTN","GMRCTIU",108,0)
 . N DR,DA,DIE S DIE="^GMR(123,",DA=GMRCO,DR="16////"_TIUDA D ^DIE
"RTN","GMRCTIU",109,0)
EDEX K GMRCDFN,GMRCO,GMRCQUT,GMRCTUFN,GMRCQUT,GMRCSEL
"RTN","GMRCTIU",110,0)
 Q
"RTN","GMRCTIU",111,0)
CLASS() ; What is the TIU Class (or Document Class) for CONSULTS
"RTN","GMRCTIU",112,0)
 N GMRCY
"RTN","GMRCTIU",113,0)
 S GMRCY=+$O(^TIU(8925.1,"B","CONSULTS",0))
"RTN","GMRCTIU",114,0)
 I +GMRCY>0,$S($P($G(^TIU(8925.1,+GMRCY,0)),U,4)="CL":0,$P($G(^(0)),U,4)="DC":0,1:1) S GMRCY=0
"RTN","GMRCTIU",115,0)
 Q GMRCY
"RTN","GMRCTIU",116,0)
ADDEND(GMRCO) ; Make an addendum to a consult result
"RTN","GMRCTIU",117,0)
 N TIUDA,GMRCTX,GMRCDFN,ORBADUZ
"RTN","GMRCTIU",118,0)
 K GMRCQUT
"RTN","GMRCTIU",119,0)
 I '$L(GMRCO) D  I $D(GMRCQUT) Q
"RTN","GMRCTIU",120,0)
 . I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR")
"RTN","GMRCTIU",121,0)
 . I '$D(GMRCSEL) D SEL^GMRCA2
"RTN","GMRCTIU",122,0)
 . I $S($D(DTOUT):1,$D(DIROUT):1,'GMRCSEL:1,1:0) S GMRCQUT=1 K DTOUT,DIROUT,DUOUT Q
"RTN","GMRCTIU",123,0)
 . S GMRCO=$O(^TMP("GMRCR",$J,"CS","AD",+GMRCSEL,+GMRCSEL,0))
"RTN","GMRCTIU",124,0)
 . I '+GMRCO D  Q
"RTN","GMRCTIU",125,0)
 . . S GMRCQUT=1
"RTN","GMRCTIU",126,0)
 . . W !,$C(7),"Not A Valid Consult Number. Enter A Number Between 1 and "
"RTN","GMRCTIU",127,0)
 . . W LNCT,".",!,"Or Type '^' To Quit."
"RTN","GMRCTIU",128,0)
 . . W !,"Press <ENTER> To continue: " R X:DTIME
"RTN","GMRCTIU",129,0)
 . . K GMRCO
"RTN","GMRCTIU",130,0)
 . . Q
"RTN","GMRCTIU",131,0)
 . Q
"RTN","GMRCTIU",132,0)
 I '+$G(GMRCO) Q
"RTN","GMRCTIU",133,0)
 S TIUDA=+$P($G(^GMR(123,+GMRCO,0)),U,20)
"RTN","GMRCTIU",134,0)
 I +TIUDA'>0 D  Q
"RTN","GMRCTIU",135,0)
 . N GMRCANS
"RTN","GMRCTIU",136,0)
 . W !,$C(7),"This consult does not yet have a result."
"RTN","GMRCTIU",137,0)
 . R !,"Press <RETURN> To Continue...",GMRCANS:DTIME
"RTN","GMRCTIU",138,0)
 D ADDEND1^TIURA1
"RTN","GMRCTIU",139,0)
 N GMRCSVC,GMRCSSNM,GMRCPROC
"RTN","GMRCTIU",140,0)
 S GMRCSVC=$P(^GMR(123,+GMRCO,0),"^",5),GMRCSSNM=""
"RTN","GMRCTIU",141,0)
 I +GMRCSVC S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSVC,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSVC,0)),U,1))
"RTN","GMRCTIU",142,0)
 S GMRCPROC=$P(^GMR(123,+GMRCO,0),"^",8)
"RTN","GMRCTIU",143,0)
 I +GMRCPROC S GMRCPROC=$S($L($G(^ORD(101,+GMRCPROC,.1))):^(.1),1:$P($G(^ORD(101,+GMRCPROC,0)),"^",2))
"RTN","GMRCTIU",144,0)
 S GMRCORTX=$S($L(GMRCPROC):($E(GMRCSSNM,1,10)_" "_$E(GMRCPROC,1,10)),1:$E(GMRCSSNM,1,20))
"RTN","GMRCTIU",145,0)
 S GMRCORTX="Addendum Added to consult "_GMRCORTX
"RTN","GMRCTIU",146,0)
 ;S GMRCORTX="Consult"_$S(+$P(^GMR(123,GMRCO,0),"^",8):" "_$P(^ORD(101,+$P(^(0),"^",8),0),"^",2),1:"")_" To "_$P(^GMR(123.5,$P(^GMR(123,GMRCO,0),"^",5),0),"^",1)_" Has An Addendum."
"RTN","GMRCTIU",147,0)
 I $P(^GMR(123,GMRCO,0),"^",14) S ORBADUZ($P(^(0),"^",14))="",GMRCDFN=$P(^GMR(123,GMRCO,0),"^",2)
"RTN","GMRCTIU",148,0)
 I $O(ORBADUZ(0)) D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,23,.ORBADUZ,0)
"RTN","GMRCTIU",149,0)
 Q
"RTN","GMRCTIU",150,0)
RPCLIST(GMRCY,DFN) ; Get active and pending requests for CPRS
"RTN","GMRCTIU",151,0)
 N GMRC0,GMRCDA,GMRCI,GMRCJ,GMRCTMP,GMRCYR
"RTN","GMRCTIU",152,0)
 G:+$G(DFN)'>0 RPCOUT
"RTN","GMRCTIU",153,0)
 S GMRCYR=$$FMADD^XLFDT(DT,-365),GMRCDA=""
"RTN","GMRCTIU",154,0)
 F  S GMRCDA=$O(^GMR(123,"F",DFN,GMRCDA),-1) Q:+GMRCDA'>0  D
"RTN","GMRCTIU",155,0)
 . N GMRCST,GMRCDT,GMRCSVC,GMRCPROC
"RTN","GMRCTIU",156,0)
 . S GMRC0=$G(^GMR(123,GMRCDA,0)),GMRCST=$P(GMRC0,U,12)
"RTN","GMRCTIU",157,0)
 . I $S(GMRCST=5:0,GMRCST=6:0,GMRCST=9:0,1:1) Q
"RTN","GMRCTIU",158,0)
 . S GMRCSS=$P(GMRC0,U,5),GMRCSVC=$P($G(^GMR(123.5,GMRCSS,0)),U) I '$$VALID^GMRCTIU1(GMRCSS,GMRCDA) Q
"RTN","GMRCTIU",159,0)
 . S GMRCDT=+GMRC0 Q:GMRCDT<GMRCYR
"RTN","GMRCTIU",160,0)
 . S GMRCPROC=$P($G(^ORD(101,+$P(GMRC0,U,8),0)),U,2)
"RTN","GMRCTIU",161,0)
 . S GMRCI=+$G(GMRCI)+1
"RTN","GMRCTIU",162,0)
 . S GMRCY(GMRCI)=GMRCDA_U_GMRCDT_U_GMRCSVC_U_GMRCPROC
"RTN","GMRCTIU",163,0)
RPCOUT S GMRCY(0)=+$G(GMRCI)
"RTN","GMRCTIU",164,0)
 Q
"RTN","GMRCTIU1")
0^95^B5535296
"RTN","GMRCTIU1",1,0)
GMRCTIU1 ;SLC/JER - More CT/TIU interface modules ;5/20/98  14:21
"RTN","GMRCTIU1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCTIU1",3,0)
ROLLBACK(DA) ; Roll-back a CT record when result is deleted or reassigned
"RTN","GMRCTIU1",4,0)
 ;The action is "STATUS CHANGE", and the new CPRS status is "ACTIVE"
"RTN","GMRCTIU1",5,0)
 ;This SC change should send a note to the service notification users.
"RTN","GMRCTIU1",6,0)
 N DIE,DR,GMRCSTS,GMRCA,GMRCO,GMRCOM,GMRCORNP,GMRCDFN
"RTN","GMRCTIU1",7,0)
 S DIE="^GMR(123,",DR="16///@" D ^DIE
"RTN","GMRCTIU1",8,0)
 S GMRCA=3,GMRCO=DA,GMRCSTS=6 D STATUS^GMRCP
"RTN","GMRCTIU1",9,0)
 S GMRCOM=0,GMRCSA=GMRCA D AUDIT^GMRCP
"RTN","GMRCTIU1",10,0)
 S GMRCORNP=$P(^GMR(123,+GMRCO,0),U,14),GMRCDFN=$P(^(0),U,2)
"RTN","GMRCTIU1",11,0)
 D EN^GMRCHL7(GMRCDFN,+GMRCO,$G(GMRCTYPE),$G(GMRCRB),"SC",GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCTIU1",12,0)
 Q
"RTN","GMRCTIU1",13,0)
VALID(GMRCSS,GMRCO) ;Check to see if user is authorized to enter TIU result for a consult.
"RTN","GMRCTIU1",14,0)
 N X
"RTN","GMRCTIU1",15,0)
 I '+GMRCSS Q 0
"RTN","GMRCTIU1",16,0)
 D EN^GMRCT(GMRCSS)
"RTN","GMRCTIU1",17,0)
 I $D(ORBADUZ(DUZ)) S X=1
"RTN","GMRCTIU1",18,0)
 E  S X=0
"RTN","GMRCTIU1",19,0)
 K ORBADUZ
"RTN","GMRCTIU1",20,0)
 Q X
"RTN","GMRCTIU1",21,0)
STATUS ;Update the status of a consult that has a TIU result
"RTN","GMRCTIU1",22,0)
 S GMRCDTC="",GMRCFLG=0 D  Q:GMRCFLG
"RTN","GMRCTIU1",23,0)
 .F  S GMRCDTC=$O(^GMR(123,GMRCO,40,"B",GMRCDTC)) Q:GMRCDTC=""  S GMRCND=0,GMRCND=$O(^GMR(123,GMRCO,40,"B",GMRCDTC,GMRCND)) I $P(^GMR(123,GMRCO,40,GMRCND,0),"^",2)=GMRCA S GMRCFLG=1 Q
"RTN","GMRCTIU1",24,0)
 S GMRCDFN=$P(^GMR(123,GMRCO,0),"^",2)
"RTN","GMRCTIU1",25,0)
 I GMRCA=10 D
"RTN","GMRCTIU1",26,0)
 .S GMRCSVC=$P(^GMR(123,+GMRCO,0),"^",5),GMRCSSNM=""
"RTN","GMRCTIU1",27,0)
 .I +GMRCSVC S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSVC,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSVC,0)),U,1))
"RTN","GMRCTIU1",28,0)
 .S GMRCPROC=$P(^GMR(123,+GMRCO,0),"^",8)
"RTN","GMRCTIU1",29,0)
 .I +GMRCPROC S GMRCPROC=$S($L($G(^ORD(101,+GMRCPROC,.1))):^(.1),1:$P($G(^ORD(101,+GMRCPROC,0)),"^",2))
"RTN","GMRCTIU1",30,0)
 .S GMRCORTX=$S($L(GMRCPROC):($E(GMRCSSNM,1,10)_" "_$E(GMRCPROC,1,10)),1:$E(GMRCSSNM,1,20))
"RTN","GMRCTIU1",31,0)
 .S GMRCORTX="Completed Consult "_GMRCORTX
"RTN","GMRCTIU1",32,0)
 .I $P(^GMR(123,GMRCO,0),"^",14) S ORBADUZ($P(^(0),"^",14))=""
"RTN","GMRCTIU1",33,0)
 .D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,23,.ORBADUZ,0)
"RTN","GMRCTIU1",34,0)
 .Q
"RTN","GMRCTIU1",35,0)
 S GMRCOM=0,GMRCSA=GMRCA D AUDIT^GMRCP
"RTN","GMRCTIU1",36,0)
 S GMRCORNP=$P(^GMR(123,+GMRCO,0),"^",14)
"RTN","GMRCTIU1",37,0)
 D EN^GMRCHL7(GMRCDFN,+GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.CMRCOM)
"RTN","GMRCTIU1",38,0)
 Q
"RTN","GMRCU")
0^97^B8633278
"RTN","GMRCU",1,0)
GMRCU ;SLC/DLT - Consult/Request Utilities ;5/20/98  14:21
"RTN","GMRCU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCU",3,0)
MTIM ;CONVERT TIME from X=2890313.1304 INTO X=13:04
"RTN","GMRCU",4,0)
 S X=$P(X,".",2) Q:'$L(X)
"RTN","GMRCU",5,0)
 S X=$S(X:$E(X,1,2)_$E("00",0,2-$L($E(X,1,2)))_":"_$E(X,3,4)_$E("00",0,2-$L($E(X,3,4))),1:"")
"RTN","GMRCU",6,0)
 Q
"RTN","GMRCU",7,0)
REGDT ; Receives X in internal date.time, and returns X in MM/DD/YY format
"RTN","GMRCU",8,0)
 S X=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")
"RTN","GMRCU",9,0)
 Q
"RTN","GMRCU",10,0)
REGDTM ;Receives X in internal date.time, and returns X in MM/DD/YY TT:TT
"RTN","GMRCU",11,0)
 N T
"RTN","GMRCU",12,0)
 S T=$P(X,".",2),X=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")_" "_$S(T:$E(T,1,2)_$E("00",0,2-$L($E(T,1,2)))_":"_$E(T,3,4)_$E("00",0,2-$L($E(T,3,4))),1:"")
"RTN","GMRCU",13,0)
 Q
"RTN","GMRCU",14,0)
SIDT ; Receives X as internal date/time and returns X in DD MMM YY
"RTN","GMRCU",15,0)
 N MON,MM
"RTN","GMRCU",16,0)
 S X=$P(X,".") I 'X S X="" Q
"RTN","GMRCU",17,0)
 S MON="JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC"
"RTN","GMRCU",18,0)
 S MM=$E(X,4,5),MM=$S(MM:$P(MON,U,MM),1:"")
"RTN","GMRCU",19,0)
 S X=$E(X,6,7)_" "_MM_" "_$E(X,2,3)
"RTN","GMRCU",20,0)
 Q
"RTN","GMRCU",21,0)
FMHL7DTM ; Recieves X as internal date/time and returns X in CCYYMMDDHHMM
"RTN","GMRCU",22,0)
 N T
"RTN","GMRCU",23,0)
 S T=$P(X,".",2)
"RTN","GMRCU",24,0)
 S T=$S(T:$E(T,1,2)_$E("00",0,2-$L($E(T,1,2)))_$E(T,3,4)_$E("00",0,2-$L($E(T,3,4))),1:"0000")
"RTN","GMRCU",25,0)
 S X=($E($P(X,"."),1,3)+1700)_$E($P(X,"."),4,7)_T
"RTN","GMRCU",26,0)
 Q
"RTN","GMRCU",27,0)
HL7FMDTM ; Recieves X as CCYYMMDDHHMM and returns X as internal date/time
"RTN","GMRCU",28,0)
 N DATE,TIME
"RTN","GMRCU",29,0)
 S DATE=$E(X,1,8),TIME=$E(X,9,12)
"RTN","GMRCU",30,0)
 S DATE=DATE-17000000,X=DATE_"."_TIME
"RTN","GMRCU",31,0)
 Q
"RTN","GMRCU",32,0)
DEM ; Gets Demographic Data from VADPT
"RTN","GMRCU",33,0)
 ; Receives: DFN
"RTN","GMRCU",34,0)
 ; Returns: GMRCPNM,GMRCSN,GMRCDOB,SEX,GMRCWARD,GMRCRB,GMRCAGE
"RTN","GMRCU",35,0)
 ; and GMRCWLI,GMRCHLI
"RTN","GMRCU",36,0)
 K VAINDT,VAHOW D OERR^VADPT
"RTN","GMRCU",37,0)
 S GMRCPNM=VADM(1)
"RTN","GMRCU",38,0)
 S GMRCSN=$S($D(VA("PID")):VA("PID"),1:$P(VADM(2),"^",2))
"RTN","GMRCU",39,0)
 S GMRCAGE=VADM(4),SEX=$P(VADM(5),"^")
"RTN","GMRCU",40,0)
 S GMRCWARD=$P(VAIN(4),"^",2),GMRCRB=VAIN(5),GMRCWLI=$P(VAIN(4),"^",1)
"RTN","GMRCU",41,0)
 S GMRCDOB=$P(VADM(3),"^",2)
"RTN","GMRCU",42,0)
 K VA,VAIN,VADM,VAERR
"RTN","GMRCU",43,0)
 Q
"RTN","GMRCU",44,0)
MD ; Format physician names ;4/4/89  11:39 ;
"RTN","GMRCU",45,0)
 ; Recieves: IFN for New Person file as PR and desired name length, as NML
"RTN","GMRCU",46,0)
 ; Returns: Lastname,FI to specified length as PR
"RTN","GMRCU",47,0)
 N PRFI,PRLN,PRNM
"RTN","GMRCU",48,0)
 S PRNM=$S(PR:$S($D(^VA(200,+PR,0)):$P(^(0),"^"),1:"UNKNOWN"),1:"UNKNOWN")
"RTN","GMRCU",49,0)
 I PRNM?1A.A." ".A1",".A.E S PRLN=$P(PRNM,","),PRFI=$E($P(PRNM,",",2),1) I $L(PRLN)>(NML-2) S PRLN=$E(PRLN,1,(NML-2))
"RTN","GMRCU",50,0)
 S PR=$S(PRNM="UNKNOWN":PRNM,1:PRLN_","_PRFI)
"RTN","GMRCU",51,0)
 Q
"RTN","GMRCU",52,0)
NAME ; Format names ;6/30/89  11:20 ;
"RTN","GMRCU",53,0)
 ; Recieves: FILE (3 for User, 16 for Person, 6 for Provider)
"RTN","GMRCU",54,0)
 ;           IFN (Internal file # for above file),
"RTN","GMRCU",55,0)
 ;           NML (Desired length for name to be returned)
"RTN","GMRCU",56,0)
 ;           FNF (Flag to specify first name format: 0 for FI, 1 for FN)
"RTN","GMRCU",57,0)
 ; Returns: Lastname,First(name/initial) to specified length as NM
"RTN","GMRCU",58,0)
 ;
"RTN","GMRCU",59,0)
 N DIC,RAWNM,LN,FN,FA,NI,CH,X,Y
"RTN","GMRCU",60,0)
 S DIC=FILE,DIC(0)="NXZ",X=IFN D ^DIC S RAWNM=$S($D(Y(0,0)):Y(0,0),1:"UNKNOWN")
"RTN","GMRCU",61,0)
 S LN=$P(RAWNM,","),FN=$P(RAWNM,",",2)
"RTN","GMRCU",62,0)
 S FA=0 I $L(FN) F NI=1:1 S CH=$E(FN,NI) Q:CH?1A  S FA=NI
"RTN","GMRCU",63,0)
 I FA S FN=$E(FN,FA+1,$L(FN))
"RTN","GMRCU",64,0)
 I 'FNF S FN=$E(FN,1)
"RTN","GMRCU",65,0)
 S NM=$S($L(FN):LN_","_FN,1:LN),NM=$E(NM,1,NML)
"RTN","GMRCU",66,0)
 K FILE,IFN,NML,FNF
"RTN","GMRCU",67,0)
 Q
"RTN","GMRCU",68,0)
PTRCLN ;Clean out subservice 'B' X-reference of deleted entries
"RTN","GMRCU",69,0)
 S I=0 F  S I=$O(^GMR(123.5,I)) Q:I<1  I $D(^(I,10,0)) S J=0 F  S J=$O(^GMR(123.5,I,10,J)) Q:J<1  S ENTRY=+^(J,0) I '$D(^GMR(123.5,ENTRY,0)) K ^GMR(123.5,I,10,J,0),^GMR(123.5,I,10,"B",ENTRY) D
"RTN","GMRCU",70,0)
 .S CNT=$P(^GMR(123.5,I,10,0),"^",4),$P(^(0),"^",4)=CNT-1
"RTN","GMRCU",71,0)
 K CNT,ENTRY,I,J Q
"RTN","GMRCUTIL")
0^100^B10352521
"RTN","GMRCUTIL",1,0)
GMRCUTIL ;SLC/DCM - Utilities for formatting word procesing fields and setting into ^TMP("GMRCR" globals for use by List Manager routines ;5/20/98  14:21
"RTN","GMRCUTIL",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCUTIL",3,0)
GSET(LN,GLOB,J1,FLG) ;Set the word processing formatted local array WP() fields into the ^TMP Global.
"RTN","GMRCUTIL",4,0)
 ;  LN:  Line in the ^TMP global where the data is to be placed.  LN is
"RTN","GMRCUTIL",5,0)
 ;       incremented and passed back to the calling routine so that it
"RTN","GMRCUTIL",6,0)
 ;       can set data into the next global node as needed.
"RTN","GMRCUTIL",7,0)
 ;  GLB: The ^TMP global where the data is to be placed.(i.e.,
"RTN","GMRCUTIL",8,0)
 ;       ^TMP("GMRCR",$J,"CS").
"RTN","GMRCUTIL",9,0)
 ;  J1:  The last entry in the WP array.  It is passed back to the
"RTN","GMRCUTIL",10,0)
 ;       calling routine so that WP(J1) can be concatenated to the next
"RTN","GMRCUTIL",11,0)
 ;       line, if necessary
"RTN","GMRCUTIL",12,0)
 ;  FLG: If the first line of the the data in WP needs to be formatted
"RTN","GMRCUTIL",13,0)
 ;       differently than succeeding lines, FLG signals this fact by
"RTN","GMRCUTIL",14,0)
 ;       being passed as FLG=1; otherwise, FLG is passed as FLG=0.
"RTN","GMRCUTIL",15,0)
 S (J,J1)=0 F  S J=$O(WP(J)) Q:J=""  S DTA=$S('FLG:$E(TAB,1,17)_WP(J),1:WP(J)) S @GLOB@(LN,0)=DTA,LN=LN+1,J1=J,FLG=0
"RTN","GMRCUTIL",16,0)
 K J,DTA
"RTN","GMRCUTIL",17,0)
 Q
"RTN","GMRCUTIL",18,0)
WPFMT(LINE,GMRCSL) ;FORMAT GLOBALS TO PRINT OUT IN A WORD PROCESSING FORMAT
"RTN","GMRCUTIL",19,0)
 ;  LINE:  The line of text that needs to be broken into 80 column
"RTN","GMRCUTIL",20,0)
 ;      or less lines for printing on the screen.
"RTN","GMRCUTIL",21,0)
 ;  GMRCSL:  This is the desired line length, to break LINE into; i.e.
"RTN","GMRCUTIL",22,0)
 ;      60, 70, or 80 columns (or smaller/larger) for screen display.
"RTN","GMRCUTIL",23,0)
  K WP S WP="" Q:LINE?1.80P  F LIN=1:1 D  S WP(LIN)=$E(BKLN,1,$L(BKLN)-1) Q:'$L(LINE)
"RTN","GMRCUTIL",24,0)
 .S (BKLN,WRD)="" F I=1:1 S WRD=$P(LINE," ",1) Q:($L(BKLN)+$L(WRD)+1)>GMRCSL  S BKLN=BKLN_WRD_" ",LINE=$P(LINE," ",2,256),WRD="" Q:$P(LINE," ",1,30)=""
"RTN","GMRCUTIL",25,0)
 .I $L(LINE),'$L(BKLN) S BKLN=$E(LINE,1,GMRCSL),LINE=$E(LINE,$L(BKLN),$L(LINE))
"RTN","GMRCUTIL",26,0)
 .Q
"RTN","GMRCUTIL",27,0)
 K I,LIN,BKLN,WRD Q
"RTN","GMRCUTIL",28,0)
 ;
"RTN","GMRCUTIL",29,0)
WPSET(GLOBAL,TMPGBL,LINE,LNO,TAB,FLG) ;Set the lines into a the ^TMP global in word-processing format.
"RTN","GMRCUTIL",30,0)
 ;  GLOBAL:  Global where data is comming from.
"RTN","GMRCUTIL",31,0)
 ;  TMPGBL:  Global where formatted data is being placed
"RTN","GMRCUTIL",32,0)
 ;  LINE:    Line is passed because it may contain some data already.
"RTN","GMRCUTIL",33,0)
 ;           If it does, it is concatenated to the data from GLOBAL.
"RTN","GMRCUTIL",34,0)
 ;  LNO:     This is a counter to where the next line of data should
"RTN","GMRCUTIL",35,0)
 ;           be set in TMPGLOBAL.  It is incremented and passed back
"RTN","GMRCUTIL",36,0)
 ;           to the calling routine so it knows where the next piece
"RTN","GMRCUTIL",37,0)
 ;           of data is to be placed in TMPGBL.
"RTN","GMRCUTIL",38,0)
 ;  TAB:     A string of spaces concatenated to the data in TMPGBL
"RTN","GMRCUTIL",39,0)
 ;           that acts like a tab character. TAB is passed to GSET.
"RTN","GMRCUTIL",40,0)
 ;  FLG:     If the first line of data is not tabbed, then FLG is
"RTN","GMRCUTIL",41,0)
 ;           passed as FLG=1 and no tab character is concatenated to
"RTN","GMRCUTIL",42,0)
 ;           this line.  If FLG=0, then the data is tabbed.
"RTN","GMRCUTIL",43,0)
 N LN
"RTN","GMRCUTIL",44,0)
 S (LN,LN1,J1)=0 F  S LN=$O(@(GLOBAL)@(LN)) Q:LN=""!(LN?1A.E)  S LINE=LINE_@(GLOBAL)@(LN,0) D
"RTN","GMRCUTIL",45,0)
 .I @(GLOBAL)@(LN,0)?1.240" " D WPFMT(LINE,$S('FLG:60,1:70)),GSET(.LNO,TMPGBL,.J1,.FLG) S @(TMPGBL)@(LNO,0)=@(GLOBAL)@(LN,0),LNO=LNO+1 S LINE="" Q
"RTN","GMRCUTIL",46,0)
 .I $O(@(GLOBAL)@(LN)),$O(@(GLOBAL)@(LN))'?1A S LN1=$O(@(GLOBAL)@(LN)) I $S((@(GLOBAL)@(LN1,0))?1.240" ":1,(@(GLOBAL)@(LN1,0))="":1,1:0) D WPFMT(LINE,$S('FLG:60,1:70)),GSET(.LNO,TMPGBL,.J1,.FLG) S LN=LN1,LINE="" Q
"RTN","GMRCUTIL",47,0)
 .I FLG,$L(LINE)<79,$O(@(GLOBAL)@(LN))]"",$O(@(GLOBAL)@(LN))'?1A.E S LN=$O(@(GLOBAL)@(LN)),LINE=LINE_" "_@(GLOBAL)@(LN,0) D WPFMT(LINE,79),GSET(.LNO,TMPGBL,.J1,.FLG) D
"RTN","GMRCUTIL",48,0)
 ..I $O(@(GLOBAL)@(LN))?1A.E S LINE="" Q
"RTN","GMRCUTIL",49,0)
 ..I $O(@(GLOBAL)@(LN))]"",$D(WP(J1)),$L(WP(J1))<60 S LINE=WP(J1)_" ",LNO=LNO-1 Q
"RTN","GMRCUTIL",50,0)
 ..I $D(WP(J1)),$L(WP(J1))>60 S LINE=WP(J1),LNO=LNO-1 Q
"RTN","GMRCUTIL",51,0)
 ..S LINE="" Q
"RTN","GMRCUTIL",52,0)
 .Q:LINE=""
"RTN","GMRCUTIL",53,0)
 .I $L(LINE)>70,FLG S LINE(0)=$E(LINE,1,$F(LINE," ",69)-1),LINE=$E(LINE,$F(LINE," ",69),$L(LINE)),@(TMPGBL)@(LNO,0)=LINE(0),FLG=$S($L(LINE(0)):0,1:1),LNO=LNO+1
"RTN","GMRCUTIL",54,0)
 .D WPFMT(LINE,$S('FLG:60,1:70)),GSET(.LNO,TMPGBL,.J1,.FLG) I $O(@(GLOBAL)@(LN))]"",$D(WP(J1)),$L(WP(J1))<60 S LINE=WP(J1)_" ",LNO=LNO-1,FLG=0
"RTN","GMRCUTIL",55,0)
 .E  S LINE=""
"RTN","GMRCUTIL",56,0)
 .Q
"RTN","GMRCUTIL",57,0)
 K J1,LN1,WP Q
"RTN","GMRCUTL1")
0^101^B5112124
"RTN","GMRCUTL1",1,0)
GMRCUTL1 ;SLC/DCM - Utilities to used by List Manager interface ;5/20/98  14:21
"RTN","GMRCUTL1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCUTL1",3,0)
ACTM ;;Set correct variables to complete, discontinue, etc. a consult
"RTN","GMRCUTL1",4,0)
 K GMRCQUT
"RTN","GMRCUTL1",5,0)
 S:'+$G(GMRCA) GMRCA=$O(^GMR(123.1,"B",GMRCACTM,""))
"RTN","GMRCUTL1",6,0)
 S GMRCACTM=$P($G(^GMR(123.1,+GMRCA,0)),"^")
"RTN","GMRCUTL1",7,0)
 S ORSTS=$S(GMRCA:$P(^GMR(123.1,GMRCA,0),"^",2),1:0)
"RTN","GMRCUTL1",8,0)
 I 'GMRCA S GMRCQUT=1
"RTN","GMRCUTL1",9,0)
 Q
"RTN","GMRCUTL1",10,0)
PRNT(SRVCIFN,GMRCO) ;print form 513 to a printer when new consult is entered
"RTN","GMRCUTL1",11,0)
 N ORVP
"RTN","GMRCUTL1",12,0)
 Q:'$L(SRVCIFN)
"RTN","GMRCUTL1",13,0)
 Q:'$D(^GMR(123.5,SRVCIFN,123))  Q:'$P(^GMR(123.5,SRVCIFN,123),"^",9)
"RTN","GMRCUTL1",14,0)
 S GMRCDEV=$P(^GMR(123.5,SRVCIFN,123),"^",9) Q:'$D(^%ZIS(1,+GMRCDEV,0))
"RTN","GMRCUTL1",15,0)
 I +GMRCDEV D  G END
"RTN","GMRCUTL1",16,0)
 .S GMRCDEV1=$P(^%ZIS(1,GMRCDEV,0),"^"),GMRCQUED=1
"RTN","GMRCUTL1",17,0)
 .S ZTRTN="PRNT^GMRCP513(GMRCO)",ZTDESC="CONSULT/REQUEST PACKAGE PRINT FORM 513 FOR NEW CONSULT",ZTSAVE("GMRCQUED")="",ZTSAVE("GMRCO")="",ZTIO=GMRCDEV1,ZTDTH=$H
"RTN","GMRCUTL1",18,0)
 .S ZTSAVE("GMRCIFN")="",ZTSAVE("TIUFLG")="",ZTSAVE("GMRCQUED")="",ZTSAVE("^TMP(""GMRCR"",$J,""RES"")")="" S:$D(GMRCCPY) ZTSAVE("GMRCCPY")=""
"RTN","GMRCUTL1",19,0)
 .D ^%ZTLOAD
"RTN","GMRCUTL1",20,0)
 .D PRNTAUDT
"RTN","GMRCUTL1",21,0)
 .Q
"RTN","GMRCUTL1",22,0)
 K GMRCQUED,GMRCDEV1
"RTN","GMRCUTL1",23,0)
 Q
"RTN","GMRCUTL1",24,0)
 ;CODE BEYOND THIS POINT IS TO BE USED IF THE CPRS PRINT TEMPLATE FUNCTIONALITY IS REDONE.
"RTN","GMRCUTL1",25,0)
 I +$P($G(^GMR(123.9,1,0)),"^",3) D  G END
"RTN","GMRCUTL1",26,0)
 .N X,GMRSARAY,ORTKG
"RTN","GMRCUTL1",27,0)
 .S ORTKG=$O(^DIC(9.4,"B","CONSULT/REQUEST TRACKING","")) Q:'ORTKG
"RTN","GMRCUTL1",28,0)
 .S X=^GMR(123,GMRCO,0),ORVP=$P(X,"^",2)_";DPT("
"RTN","GMRCUTL1",29,0)
 .S GMRCOREC($P(X,"^",2))=$P(X,"^",3)_";1",GMRSARAY(ORTKG,$P(X,"^",3))=GMRCDEV_"^1",GMRCFMT="^^^1^"
"RTN","GMRCUTL1",30,0)
 .D PRINT^ORPR02(ORVP,.GMRCOREC,.GMRSARAY,"",GMRCFMT)
"RTN","GMRCUTL1",31,0)
 .D PRNTAUDT
"RTN","GMRCUTL1",32,0)
 .Q
"RTN","GMRCUTL1",33,0)
 Q
"RTN","GMRCUTL1",34,0)
PRNTAUDT ;Update the last activity field in 123 and Processing Activity multiple
"RTN","GMRCUTL1",35,0)
 ;Printed To activity updates last activity taken for consult
"RTN","GMRCUTL1",36,0)
 N GMRCOM,GMRCORNP,GMRCFF,GMRCPA,GMRCAD
"RTN","GMRCUTL1",37,0)
 S GMRCA=22
"RTN","GMRCUTL1",38,0)
 S DIE="^GMR(123,",DA=+GMRCO,DR="9////^S X=GMRCA"
"RTN","GMRCUTL1",39,0)
 L +^GMR(123,GMRCO)
"RTN","GMRCUTL1",40,0)
 D ^DIE
"RTN","GMRCUTL1",41,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCUTL1",42,0)
 ;Update activity other than HL7 original msg received
"RTN","GMRCUTL1",43,0)
 D AUDIT^GMRCP
"RTN","GMRCUTL1",44,0)
 Q
"RTN","GMRCUTL1",45,0)
END K GMRCDEV,GMRCDEV1,GMRCOREC,GMRCFMT
"RTN","GMRCUTL1",46,0)
 Q
"RTN","GMRCXMF")
1^102
"RTN","GMRCXQ")
0^103^B303846
"RTN","GMRCXQ",1,0)
GMRCXQ ;SLC/DLT/DCM - ROUTINE TO ALLOW FOLLOW-UP ON LEGACY ALERTS;3/2/99 15:30
"RTN","GMRCXQ",2,0)
 ;;3.0;CONSULTS/REQUEST TRACKING;**1**;DEC 27, 1997
"RTN","GMRCXQ",3,0)
EN D RPTCON^ORB3FUP2  ; redirect follow-up action v 3.0 action
"RTN","GMRCXQ",4,0)
 ;to new entry point
"RTN","GMRCXQ",5,0)
 S XQAKILL=$$XQAKILL^ORB3F1 D DEL^ORB3FUP1(.ORY,XQAID)
"RTN","GMRCXQ",6,0)
 Q
"VER")
8.0^21.0
**END**
**END**
