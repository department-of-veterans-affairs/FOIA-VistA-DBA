Released OR*3*185 SEQ #166
Extracted from mail message
**KIDS**:OR*3.0*185^

**INSTALL NAME**
OR*3.0*185
"BLD",4351,0)
OR*3.0*185^ORDER ENTRY/RESULTS REPORTING^0^3030425^y
"BLD",4351,4,0)
^9.64PA^^
"BLD",4351,"ABPKG")
n
"BLD",4351,"KRN",0)
^9.67PA^8989.52^19
"BLD",4351,"KRN",.4,0)
.4
"BLD",4351,"KRN",.401,0)
.401
"BLD",4351,"KRN",.402,0)
.402
"BLD",4351,"KRN",.403,0)
.403
"BLD",4351,"KRN",.5,0)
.5
"BLD",4351,"KRN",.84,0)
.84
"BLD",4351,"KRN",3.6,0)
3.6
"BLD",4351,"KRN",3.8,0)
3.8
"BLD",4351,"KRN",9.2,0)
9.2
"BLD",4351,"KRN",9.8,0)
9.8
"BLD",4351,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4351,"KRN",9.8,"NM",1,0)
ORWDXM1^^0^B67129440
"BLD",4351,"KRN",9.8,"NM",2,0)
ORWDXM3^^0^B30815680
"BLD",4351,"KRN",9.8,"NM","B","ORWDXM1",1)

"BLD",4351,"KRN",9.8,"NM","B","ORWDXM3",2)

"BLD",4351,"KRN",19,0)
19
"BLD",4351,"KRN",19.1,0)
19.1
"BLD",4351,"KRN",101,0)
101
"BLD",4351,"KRN",409.61,0)
409.61
"BLD",4351,"KRN",771,0)
771
"BLD",4351,"KRN",870,0)
870
"BLD",4351,"KRN",8989.51,0)
8989.51
"BLD",4351,"KRN",8989.52,0)
8989.52
"BLD",4351,"KRN",8994,0)
8994
"BLD",4351,"KRN","B",.4,.4)

"BLD",4351,"KRN","B",.401,.401)

"BLD",4351,"KRN","B",.402,.402)

"BLD",4351,"KRN","B",.403,.403)

"BLD",4351,"KRN","B",.5,.5)

"BLD",4351,"KRN","B",.84,.84)

"BLD",4351,"KRN","B",3.6,3.6)

"BLD",4351,"KRN","B",3.8,3.8)

"BLD",4351,"KRN","B",9.2,9.2)

"BLD",4351,"KRN","B",9.8,9.8)

"BLD",4351,"KRN","B",19,19)

"BLD",4351,"KRN","B",19.1,19.1)

"BLD",4351,"KRN","B",101,101)

"BLD",4351,"KRN","B",409.61,409.61)

"BLD",4351,"KRN","B",771,771)

"BLD",4351,"KRN","B",870,870)

"BLD",4351,"KRN","B",8989.51,8989.51)

"BLD",4351,"KRN","B",8989.52,8989.52)

"BLD",4351,"KRN","B",8994,8994)

"BLD",4351,"QUES",0)
^9.62^^
"BLD",4351,"REQB",0)
^9.611^1^1
"BLD",4351,"REQB",1,0)
OR*3.0*178^2
"BLD",4351,"REQB","B","OR*3.0*178",1)

"MBREQ")
0
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
185^3030425
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ORWDXM1")
0^1^B67129440
"RTN","ORWDXM1",1,0)
ORWDXM1 ; SLC/KCM - Order Dialogs, Menus;2/19/03
"RTN","ORWDXM1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,131,132,141,178,185**;Dec 17, 1997
"RTN","ORWDXM1",3,0)
BLDQRSP(LST,ORIT,FLDS) ; Build responses for an order
"RTN","ORWDXM1",4,0)
 ; LST=QuickLevel^ResponseID(ORIT;$H)^Dialog^Type^FormID^DGrp
"RTN","ORWDXM1",5,0)
 ; LST(n)=verify text or rejection text
"RTN","ORWDXM1",6,0)
 ; ORIT= ptr to 101.41 for quick order, 100 for copy
"RTN","ORWDXM1",7,0)
 ;       1   2    3    4   5   6    7    8        11-20
"RTN","ORWDXM1",8,0)
 ; FLDS=DFN^LOC^ORNP^INPT^SEX^AGE^EVENT^SC%^^^Key Variables...
"RTN","ORWDXM1",9,0)
 ; ORIT=+ORIT: ptr to 101.41, $E(ORIT)=C: copy $E(ORIT)=X: change
"RTN","ORWDXM1",10,0)
 ; !! SHOULD ALSO CHECK for PRE-CPRS ORDERS (treat as text?)
"RTN","ORWDXM1",11,0)
 K ^TMP("ORWDXMQ",$J)
"RTN","ORWDXM1",12,0)
 N ORWMODE ; 0:Dialog,Quick 1:copy order 2:change order
"RTN","ORWDXM1",13,0)
 N TEMPCAT ; patient category from DPT file
"RTN","ORWDXM1",14,0)
 N ISXFER ; If it is transfer order   
"RTN","ORWDXM1",15,0)
 S ORWMODE=0,ISXFER=""
"RTN","ORWDXM1",16,0)
 S:$E(ORIT)="C" ORWMODE=1 S:$E(ORIT)="T" ORWMODE=1,ISXFER=";T" ;treat xfer as copy for now
"RTN","ORWDXM1",17,0)
 S:$E(ORIT)="X" ORWMODE=2
"RTN","ORWDXM1",18,0)
 I ORWMODE S ORIT=$E(ORIT,2,999)
"RTN","ORWDXM1",19,0)
 S LST(0)=""
"RTN","ORWDXM1",20,0)
 D CHKDSBL^ORWDXM3(.LST,ORIT,ORWMODE) Q:+LST(0)=8  ;disable
"RTN","ORWDXM1",21,0)
 D CHKVACT^ORWDXM3(.LST,ORIT,ORWMODE,$P(FLDS,U,3)) Q:+LST(0)=8  ;action
"RTN","ORWDXM1",22,0)
 I ORWMODE=1 D CHKCOPY^ORWDXM3(.LST,ORIT,FLDS) Q:+LST(0)=8  ;no copy
"RTN","ORWDXM1",23,0)
 I ORWMODE=2 D BLD4CHG^ORWDXM3(.LST,ORIT,FLDS) Q  ;change
"RTN","ORWDXM1",24,0)
 I 'ORWMODE,($P(^ORD(101.41,+ORIT,0),U,4)="D"),'($O(^DIC(9.4,"C","OR",0))[$P(^ORD(101.41,+ORIT,0),U,7)) S LST(0)="0^0^"_$$DLGINFO^ORWDXM3(ORIT,ORWMODE_ISXFER) Q
"RTN","ORWDXM1",25,0)
 ;radilogy specific variables
"RTN","ORWDXM1",26,0)
 N ORIMTYPE
"RTN","ORWDXM1",27,0)
 ;lab specific variables
"RTN","ORWDXM1",28,0)
 N LRFZX,LRFSAMP,LRFSPEC,LRFDATE,LRFURG,LRFSCH
"RTN","ORWDXM1",29,0)
 N ORTIME,ORCOLLCT,ORMAX,ORTEST,ORIMTIME,ORSMAX,ORSTMS,ORSCH
"RTN","ORWDXM1",30,0)
 ;pharmacy specific variables
"RTN","ORWDXM1",31,0)
 N PSJNOPC,ORMORE,ORINPT,ORXNP,ORSCHED,ORQTY,ORNOUNS,ORXNP,OREFILLS
"RTN","ORWDXM1",32,0)
 N ORCOMPLX,ORQTY,ORCOPAY,ORDRUG,ORWPSPIK,ORWPSWRG,ORSD,ORDSUP,ORWP94
"RTN","ORWDXM1",33,0)
 ;dietetics specific variables
"RTN","ORWDXM1",34,0)
 N ORPARAM,ORNPO,ORTIME,ORMEAL,ORTRAY,ORDATE
"RTN","ORWDXM1",35,0)
 ;consults specific variables
"RTN","ORWDXM1",36,0)
 N GMRCNOPD,GMRCNOAT,GMRCREAF
"RTN","ORWDXM1",37,0)
 ; setup general environment
"RTN","ORWDXM1",38,0)
 N ORTYPE,ORVP,ORL,ORNP,ORSEX,ORAGE,ORWARD,OREVENT,ORDIV,ORSC,KEYVAR
"RTN","ORWDXM1",39,0)
 N ORDG,ORDIALOG,ORCAT,FIRST,ORQUIT,X,ORTRAIL,ORLEAD,RSPREF,AUTOACK
"RTN","ORWDXM1",40,0)
 N OREVNTYP
"RTN","ORWDXM1",41,0)
 S ORWP94=$O(^ORD(101.41,"AB","PS MEDS",0))>0
"RTN","ORWDXM1",42,0)
 S ORVP=$P(FLDS,U,1)_";DPT(",ORNP=+$P(FLDS,U,3),ORSC=$P(FLDS,U,8)
"RTN","ORWDXM1",43,0)
 S ORL=$P(FLDS,U,2)_";SC(",ORL(2)=ORL
"RTN","ORWDXM1",44,0)
 S ORSEX=$P(FLDS,U,5),ORAGE=$P(FLDS,U,6),ORTYPE="Q",FIRST=1
"RTN","ORWDXM1",45,0)
 I $P(FLDS,U,4),$G(^SC(+ORL,42)) S ORWARD=+^SC(+ORL,42)
"RTN","ORWDXM1",46,0)
 I $L($P(FLDS,U,7))  D
"RTN","ORWDXM1",47,0)
 . S OREVENT=$P(FLDS,U,7)
"RTN","ORWDXM1",48,0)
 . S OREVNTYP=$P(OREVENT,";",2)
"RTN","ORWDXM1",49,0)
 . S OREVENT("TS")=$P(OREVENT,";",3)
"RTN","ORWDXM1",50,0)
 . S OREVENT("EFFECTIVE")=$P(OREVENT,";",4)
"RTN","ORWDXM1",51,0)
 . S OREVENT=+$P(OREVENT,";",1)
"RTN","ORWDXM1",52,0)
 I 'ORWMODE D
"RTN","ORWDXM1",53,0)
 . D SETKEYV^ORWDXM3($P(FLDS,U,11,20)) ; from menu path
"RTN","ORWDXM1",54,0)
 . S KEYVAR=$$KEYVAR^ORWDXM3(ORIT) ; from entry action
"RTN","ORWDXM1",55,0)
 . D SETKEYV^ORWDXM3(KEYVAR)
"RTN","ORWDXM1",56,0)
 K ^TMP("ORWORD",$J)
"RTN","ORWDXM1",57,0)
 ; initialize return record based on auto-accept
"RTN","ORWDXM1",58,0)
 I ORWMODE S LST(0)="2^"_ORIT ;verify on copy 
"RTN","ORWDXM1",59,0)
 E  S LST(0)=+$P($G(^ORD(101.41,ORIT,5)),U,8)_U_ORIT
"RTN","ORWDXM1",60,0)
 S TEMPCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWDXM1",61,0)
 I $L($G(OREVNTYP)) D
"RTN","ORWDXM1",62,0)
 . S ORCAT=$S(OREVNTYP="A":"I",OREVNTYP="T":"I",OREVNTYP="O":TEMPCAT,OREVNTYP="M":TEMPCAT,OREVNTYP="C":TEMPCAT,1:"O") I $G(OREVENT) D
"RTN","ORWDXM1",63,0)
 .. N X S X=$$EVT^OREVNTX(OREVENT),X=$P($G(^ORD(100.5,+X,0)),U,7)
"RTN","ORWDXM1",64,0)
 .. I OREVNTYP="T",X,X<4 S ORCAT="O" ;To pass=outpt
"RTN","ORWDXM1",65,0)
 .. I OREVNTYP="D",X=41 S ORCAT="I" ;From ASIH=inpt
"RTN","ORWDXM1",66,0)
 E  S ORCAT=TEMPCAT
"RTN","ORWDXM1",67,0)
 D SETUP^ORWDXM4 Q:+LST(0)=8
"RTN","ORWDXM1",68,0)
 S X=$S($G(ORWP94):"OR GTX START DATE/TIME",1:"OR GTX START DATE")
"RTN","ORWDXM1",69,0)
 I ORWMODE,(ORDG=+$O(^ORD(100.98,"B","O RX",0))) K ORDIALOG($$PTR^ORCD(X),1)
"RTN","ORWDXM1",70,0)
 ; pharmacy uses ORCAT to know which package the order goes to
"RTN","ORWDXM1",71,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSO OERR",0)) S ORCAT="O"
"RTN","ORWDXM1",72,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSJ OR PAT OE",0)) D
"RTN","ORWDXM1",73,0)
 . I ORCAT="O" S ORWPSWRG="" ; not auto-ack, pt not inpt
"RTN","ORWDXM1",74,0)
 . S ORCAT="I"
"RTN","ORWDXM1",75,0)
 I ORCAT="O",$D(OREVENT("EFFECTIVE")),(ORDG=+$O(^ORD(100.98,"B","O RX",0))) D
"RTN","ORWDXM1",76,0)
 . S ORDIALOG($O(^ORD(101.41,"B",X,0)),1)=OREVENT("EFFECTIVE")
"RTN","ORWDXM1",77,0)
 I ORDIALOG=$O(^ORD(101.41,"B","RA OERR EXAM",0))         D RA^ORWDXM2 G XENV
"RTN","ORWDXM1",78,0)
 I ORDIALOG=$O(^ORD(101.41,"B","LR OTHER LAB TESTS",0))   D LR^ORWDXM2 G XENV
"RTN","ORWDXM1",79,0)
 I ORDIALOG=$O(^ORD(101.41,"B","FHW1",0))                 D DO^ORWDXM2 G XENV
"RTN","ORWDXM1",80,0)
 I ORDIALOG=$O(^ORD(101.41,"B","FHW2",0))                 D EL^ORWDXM2 G XENV
"RTN","ORWDXM1",81,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSJ OR PAT OE",0))        D UD^ORWDXM2 G XENV
"RTN","ORWDXM1",82,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE",0)) D IV^ORWDXM2 G XENV
"RTN","ORWDXM1",83,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSO OERR",0))             D OP^ORWDXM2 G XENV
"RTN","ORWDXM1",84,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSO SUPPLY",0))           D OP^ORWDXM2 G XENV
"RTN","ORWDXM1",85,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PS MEDS",0))              D PS^ORWDPS3 G XENV
"RTN","ORWDXM1",86,0)
 I ORDIALOG=$O(^ORD(101.41,"B","GMRAOR ALLERGY ENTER/EDIT",0)) S ORQUIT=1
"RTN","ORWDXM1",87,0)
XENV ;    end case
"RTN","ORWDXM1",88,0)
 Q:+LST(0)=8
"RTN","ORWDXM1",89,0)
 I $G(ORQUIT) S LST(0)="0^0^"_$$DLGINFO^ORWDXM3(ORIT,ORWMODE_ISXFER)_"^"_$G(KEYVAR) Q
"RTN","ORWDXM1",90,0)
 N SEQ,DA,XCODE,MUSTASK,PROMPT,INST,KEY,IVFID
"RTN","ORWDXM1",91,0)
 S IVFID=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE",0))
"RTN","ORWDXM1",92,0)
 S AUTOACK=$S($D(ORWPSWRG):0,1:1)
"RTN","ORWDXM1",93,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:'SEQ  D
"RTN","ORWDXM1",94,0)
 . S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORWDXM1",95,0)
 . . ; skip if this is a child prompt
"RTN","ORWDXM1",96,0)
 . . I $P(^ORD(101.41,+ORDIALOG,10,DA,0),U,11) Q
"RTN","ORWDXM1",97,0)
 . . ; set default for prompt, see if needs to be interactive
"RTN","ORWDXM1",98,0)
 . . S PROMPT=$P(^ORD(101.41,+ORDIALOG,10,DA,0),U,2)
"RTN","ORWDXM1",99,0)
 . . D SETITEM(DA,PROMPT,1,.MUSTASK)
"RTN","ORWDXM1",100,0)
 . . I MUSTASK S AUTOACK=0 Q
"RTN","ORWDXM1",101,0)
 . . ; iterate through the child items if parent and editonly
"RTN","ORWDXM1",102,0)
 . . Q:'$D(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT))
"RTN","ORWDXM1",103,0)
 . . N CSEQ,CDA,CPROMPT,INST,ORQUIT
"RTN","ORWDXM1",104,0)
 . . S CSEQ=0 F  S CSEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT,CSEQ)) Q:'CSEQ  D  Q:$G(ORQUIT)
"RTN","ORWDXM1",105,0)
 . . . S CDA=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT,CSEQ,0))
"RTN","ORWDXM1",106,0)
 . . . S CPROMPT=$P(^ORD(101.41,+ORDIALOG,10,CDA,0),U,2)
"RTN","ORWDXM1",107,0)
 . . . ; if required and no instances then need interaction
"RTN","ORWDXM1",108,0)
 . . . I $P(^ORD(101.41,+ORDIALOG,10,CDA,0),U,6),ORDIALOG'=IVFID,'$O(ORDIALOG(CPROMPT,0)) S AUTOACK=0
"RTN","ORWDXM1",109,0)
 . . . S INST=0 F  S INST=$O(ORDIALOG(CPROMPT,INST)) Q:'INST  D
"RTN","ORWDXM1",110,0)
 . . . . ; set default for each child prompt, if necessary
"RTN","ORWDXM1",111,0)
 . . . . D SETITEM(CDA,CPROMPT,INST,.MUSTASK)
"RTN","ORWDXM1",112,0)
 . . . . ; if no val and child prmpt required then need interaction
"RTN","ORWDXM1",113,0)
 . . . . I MUSTASK,$P(^ORD(101.41,+ORDIALOG,10,CDA,0),U,6) S AUTOACK=0
"RTN","ORWDXM1",114,0)
 N IVDLG
"RTN","ORWDXM1",115,0)
 S IVDLG=$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORWDXM1",116,0)
 I $$ISMED(ORIT),(ORDIALOG'=IVDLG),(ORCAT="I") D
"RTN","ORWDXM1",117,0)
 . F P="PATIENT INSTRUCTIONS","START DATE/TIME","DAYS SUPPLY","QUANTITY","REFILLS","ROUTING","SERVICE CONNECTED" K ORDIALOG($$PTR(P),1)
"RTN","ORWDXM1",118,0)
 S KEY=$S(ORWMODE:"C",1:"")_ORIT_"-"_$P($H,",",2),SEQ=0
"RTN","ORWDXM1",119,0)
 S PROMPT=0 F  S PROMPT=$O(ORDIALOG(PROMPT)) Q:'PROMPT  D
"RTN","ORWDXM1",120,0)
 . I '$D(^ORD(101.41,ORDIALOG,10,"D",PROMPT)) K ORDIALOG(PROMPT) Q 
"RTN","ORWDXM1",121,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:'INST  D
"RTN","ORWDXM1",122,0)
 . . S SEQ=SEQ+1,^TMP("ORWDXMQ",$J,KEY,SEQ,0)=U_PROMPT_U_INST
"RTN","ORWDXM1",123,0)
 . . ; save word processing value
"RTN","ORWDXM1",124,0)
 . . I $E(ORDIALOG(PROMPT,0))="W",$L(ORDIALOG(PROMPT,INST)) D
"RTN","ORWDXM1",125,0)
 . . .  M ^TMP("ORWDXMQ",$J,KEY,SEQ,2)=@ORDIALOG(PROMPT,INST)
"RTN","ORWDXM1",126,0)
 . . ; save other types of values
"RTN","ORWDXM1",127,0)
 . . E  S ^TMP("ORWDXMQ",$J,KEY,SEQ,1)=ORDIALOG(PROMPT,INST)
"RTN","ORWDXM1",128,0)
 I AUTOACK D
"RTN","ORWDXM1",129,0)
 . I ORWMODE S AUTOACK=2
"RTN","ORWDXM1",130,0)
 . I 'ORWMODE,($P(^ORD(101.41,ORIT,0),U,8)!'LST(0)) S AUTOACK=2
"RTN","ORWDXM1",131,0)
 I $L($G(OREVNTYP)) D
"RTN","ORWDXM1",132,0)
 . I ('AUTOACK),("A,O,T,M"[OREVNTYP),($$ISMED(ORIT)) D
"RTN","ORWDXM1",133,0)
 . . I $$VALQO^ORWDXM3(ORIT) S AUTOACK=2
"RTN","ORWDXM1",134,0)
 I AUTOACK=2 D VERTXT^ORWDXM2
"RTN","ORWDXM1",135,0)
 S LST(0)=AUTOACK_U_KEY_U_$$DLGINFO^ORWDXM3(ORIT,ORWMODE_ISXFER)_"^"_$G(KEYVAR)
"RTN","ORWDXM1",136,0)
 I $P(LST(0),U,4)="D" S $P(LST(0),U,4)="Q"
"RTN","ORWDXM1",137,0)
 I ORWMODE=1 S $P(LST(0),U,4)="C"
"RTN","ORWDXM1",138,0)
 K ^TMP("ORWORD",$J)
"RTN","ORWDXM1",139,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J)
"RTN","ORWDXM1",140,0)
 Q
"RTN","ORWDXM1",141,0)
SETITEM(DA,PROMPT,INST,MUSTASK) ; set default value & return if must prompt
"RTN","ORWDXM1",142,0)
 N EDITONLY,Y,XCODE
"RTN","ORWDXM1",143,0)
 S MUSTASK=0,EDITONLY=0
"RTN","ORWDXM1",144,0)
 I $D(^TMP("ORWDHTM",$J,ORDIALOG,PROMPT)) D
"RTN","ORWDXM1",145,0)
 . I $E(ORDIALOG(PROMPT,0))="W" D
"RTN","ORWDXM1",146,0)
 . . S ^TMP("ORWORD",$J,PROMPT,INST,1,0)=^TMP("ORWDHTM",$J,ORDIALOG,PROMPT)
"RTN","ORWDXM1",147,0)
 . . S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")"
"RTN","ORWDXM1",148,0)
 . E  S ORDIALOG(PROMPT,INST)=^TMP("ORWDHTM",$J,ORDIALOG,PROMPT)
"RTN","ORWDXM1",149,0)
 I $D(^TMP("ORWDHTM",$J,ORIT,PROMPT)) D
"RTN","ORWDXM1",150,0)
 . S ORDIALOG(PROMPT,INST)=^TMP("ORWDHTM",$J,ORIT,PROMPT)
"RTN","ORWDXM1",151,0)
 . ; NEED TO CLEAN UP ^TMP("ORWDHTM") after processing order set!!!
"RTN","ORWDXM1",152,0)
 ;
"RTN","ORWDXM1",153,0)
 ; skip if a value already exists for this prompt and not WP
"RTN","ORWDXM1",154,0)
 Q:$D(ORDIALOG(PROMPT,INST))&($E(ORDIALOG(PROMPT,0))'="W")
"RTN","ORWDXM1",155,0)
 ; execute default action if no value in QO, checking EDITONLY afterwards
"RTN","ORWDXM1",156,0)
 I '$D(ORDIALOG(PROMPT,INST)) D
"RTN","ORWDXM1",157,0)
 . I $E(ORDIALOG(PROMPT,0))="W",$D(^ORD(101.41,+ORDIALOG,10,DA,8))>9 D
"RTN","ORWDXM1",158,0)
 . . M ^TMP("ORWORD",$J,PROMPT,INST)=^ORD(101.41,+ORDIALOG,10,DA,8)
"RTN","ORWDXM1",159,0)
 . . S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")"
"RTN","ORWDXM1",160,0)
 . E  D
"RTN","ORWDXM1",161,0)
 . . S XCODE=$$SUBCODE($G(^ORD(101.41,+ORDIALOG,10,DA,7)))
"RTN","ORWDXM1",162,0)
 . . I $L(XCODE) X XCODE S:$D(Y) ORDIALOG(PROMPT,INST)=Y
"RTN","ORWDXM1",163,0)
 Q:$G(EDITONLY)
"RTN","ORWDXM1",164,0)
 I 'ORWMODE,$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,8) Q
"RTN","ORWDXM1",165,0)
 I ORWMODE,($P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,9)'["W"),'$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,6)!$D(ORDIALOG(PROMPT,INST)) Q
"RTN","ORWDXM1",166,0)
 I 'ORWMODE,LST(0),$D(ORDIALOG(PROMPT,INST)),($E(ORDIALOG(PROMPT,0))="W") Q
"RTN","ORWDXM1",167,0)
 I 'ORWMODE,LST(0),'$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,6) Q
"RTN","ORWDXM1",168,0)
 S XCODE=$$SUBCODE($G(^ORD(101.41,+ORDIALOG,10,DA,3)))
"RTN","ORWDXM1",169,0)
 I $L(XCODE) X XCODE Q:'$T
"RTN","ORWDXM1",170,0)
 S MUSTASK=1
"RTN","ORWDXM1",171,0)
 Q
"RTN","ORWDXM1",172,0)
SUBCODE(X) ; substitute code
"RTN","ORWDXM1",173,0)
 I X["$$REQDCOMM^ORCDLR" Q "I $$LRRQCM^ORWDXM2"
"RTN","ORWDXM1",174,0)
 I X["$$ASKSAMP^ORCDLR" Q "I $$LRASMP^ORWDXM2"
"RTN","ORWDXM1",175,0)
 I X["$$SCHEDULD^ORCDRA1" Q "I $$SCHEDULD^ORWDXM2"
"RTN","ORWDXM1",176,0)
 I X["(^PSX(550,""C"")" Q "S Y=$E($$DEFPICK^ORWDPS32) K:'$L(Y) Y"
"RTN","ORWDXM1",177,0)
 Q X
"RTN","ORWDXM1",178,0)
PTR(NAME) ; -- Returns pointer to OR GTX NAME
"RTN","ORWDXM1",179,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORWDXM1",180,0)
 ;
"RTN","ORWDXM1",181,0)
ISMED(IFN) ; return 1 if it use a pharmacy order dlg
"RTN","ORWDXM1",182,0)
 N PKG
"RTN","ORWDXM1",183,0)
 I 'ORWMODE S PKG=$P($G(^ORD(101.41,IFN,0)),U,7)
"RTN","ORWDXM1",184,0)
 E  S PKG=$P($G(^OR(100,+IFN,0)),U,14)
"RTN","ORWDXM1",185,0)
 Q $$NMSP^ORCD(PKG)="PS"
"RTN","ORWDXM3")
0^2^B30815680
"RTN","ORWDXM3",1,0)
ORWDXM3 ; SLC/KCM/JLI - Quick Orders ;10:42 AM 6/20/2002
"RTN","ORWDXM3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,131,132,141,185**;Dec 17, 1997
"RTN","ORWDXM3",3,0)
 ;
"RTN","ORWDXM3",4,0)
KEYVAR(DLG)  ; Parse entry action for key variables & return in string
"RTN","ORWDXM3",5,0)
 ; RV=CollTp^Samp^Spec^CollDt^Urg^Sched^NoComm^NoDiag^NoProv^NoRsn
"RTN","ORWDXM3",6,0)
 N XCODE,RV,POS,Z
"RTN","ORWDXM3",7,0)
 S XCODE=$G(^ORD(101.41,DLG,3)),RV=""
"RTN","ORWDXM3",8,0)
 I '$L(XCODE) Q ""
"RTN","ORWDXM3",9,0)
 S POS=$F(XCODE,"LRFZX=")    I POS S $P(RV,U,1)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",10,0)
 S POS=$F(XCODE,"LRFSAMP=")  I POS S $P(RV,U,2)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",11,0)
 S POS=$F(XCODE,"LRFSPEC=")  I POS S $P(RV,U,3)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",12,0)
 S POS=$F(XCODE,"LRFDATE=")  I POS S $P(RV,U,4)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",13,0)
 S POS=$F(XCODE,"LRFURG=")   I POS S $P(RV,U,5)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",14,0)
 S POS=$F(XCODE,"LRFSCH=")   I POS S $P(RV,U,6)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",15,0)
 S POS=$F(XCODE,"PSJNOPC=")  I POS S $P(RV,U,7)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",16,0)
 S POS=$F(XCODE,"GMRCNOPD=") I POS S $P(RV,U,8)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",17,0)
 S POS=$F(XCODE,"GMRCNOAT=") I POS S $P(RV,U,9)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",18,0)
 S POS=$F(XCODE,"GMRCREAF=") I POS S $P(RV,U,10)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",19,0)
 S POS=$F(XCODE,"ORFORGET=") I POS D
"RTN","ORWDXM3",20,0)
 . ; need to change this so that it is executed in SETKEYV so
"RTN","ORWDXM3",21,0)
 . ; that it is executed each time menu is revisited
"RTN","ORWDXM3",22,0)
 . N ORFORGET S ORFORGET=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",23,0)
 . I ORFORGET K ^TMP("ORECALL",$J,+ORFORGET)
"RTN","ORWDXM3",24,0)
 . E  K ^TMP("ORECALL",$J)
"RTN","ORWDXM3",25,0)
 Q RV
"RTN","ORWDXM3",26,0)
VALUE(STR,BEG) ; Return value of "var=" (copied from ORCONVRT)
"RTN","ORWDXM3",27,0)
 N X,Y,I S X=$E(STR,BEG,999),Y=""
"RTN","ORWDXM3",28,0)
 S:$E(X)="""" X=$E(X,2,999) ; strip leading "
"RTN","ORWDXM3",29,0)
 F I=1:1:$L(X) S Z=$E(X,I) Q:(Z=",")!(Z=" ")!(Z="""")  S Y=Y_Z
"RTN","ORWDXM3",30,0)
 Q $TR(Y,U,"")
"RTN","ORWDXM3",31,0)
 ;
"RTN","ORWDXM3",32,0)
SETKEYV(X)      ; Set the key variables based on contents of X
"RTN","ORWDXM3",33,0)
 I $L($P(X,U,1))  S LRFZX=$P(X,U,1)
"RTN","ORWDXM3",34,0)
 I $L($P(X,U,2))  S LRFSAMP=$P(X,U,2)
"RTN","ORWDXM3",35,0)
 I $L($P(X,U,3))  S LRFSPEC=$P(X,U,3)
"RTN","ORWDXM3",36,0)
 I $L($P(X,U,4))  S LRFDATE=$P(X,U,4)
"RTN","ORWDXM3",37,0)
 I $L($P(X,U,5))  S LRFURG=$P(X,U,5)
"RTN","ORWDXM3",38,0)
 I $L($P(X,U,6))  S LRFSCH=$P(X,U,6)
"RTN","ORWDXM3",39,0)
 I $L($P(X,U,7))  S PSJNOPC=$P(X,U,7)
"RTN","ORWDXM3",40,0)
 I $L($P(X,U,8))  S GMRCNOPD=$P(X,U,8)
"RTN","ORWDXM3",41,0)
 I $L($P(X,U,9))  S GMRCNOAT=$P(X,U,9)
"RTN","ORWDXM3",42,0)
 I $L($P(X,U,10)) S GMRCREAF=$P(X,U,10)
"RTN","ORWDXM3",43,0)
 Q
"RTN","ORWDXM3",44,0)
DLGINFO(IEN,MODE)    ; return information about a dialog
"RTN","ORWDXM3",45,0)
 ; IEN=DlgIEN or ORIFN, MODE=0:Dlg,1:Copy,2:Change
"RTN","ORWDXM3",46,0)
 ; RESULT=DlgIEN^DlgType^FormID^DGrp
"RTN","ORWDXM3",47,0)
 ; If MODE="1;T",don't check "PS MEDS" for transfer order
"RTN","ORWDXM3",48,0)
 ; PSMDGP=1: Unit/Dose  Group
"RTN","ORWDXM3",49,0)
 ; PSMDGP=2: OutPatient Group
"RTN","ORWDXM3",50,0)
 N X0,DLGIEN,TYP,FID,DGRP,PSMDGP,ISXF
"RTN","ORWDXM3",51,0)
 S PSMDGP=0,ISXF=""
"RTN","ORWDXM3",52,0)
 S ISXF=$P(MODE,";",2)
"RTN","ORWDXM3",53,0)
 S MODE=+MODE
"RTN","ORWDXM3",54,0)
 S DLGIEN=IEN I MODE,(ISXF'="T") D
"RTN","ORWDXM3",55,0)
 . S DLGIEN=+$P($G(^OR(100,+IEN,0)),U,5)
"RTN","ORWDXM3",56,0)
 . I $P(^ORD(101.41,DLGIEN,0),U)="PS MEDS" D
"RTN","ORWDXM3",57,0)
 . . N PTCAT S PTCAT=$P($G(^OR(100,+IEN,0)),U,12)
"RTN","ORWDXM3",58,0)
 . . I PTCAT="I" S DLGIEN=$O(^ORD(101.41,"B","PSJ OR PAT OE",0)),PSMDGP=1
"RTN","ORWDXM3",59,0)
 . . I PTCAT="O" S DLGIEN=$O(^ORD(101.41,"B","PSO OERR",0)),PSMDGP=2
"RTN","ORWDXM3",60,0)
 I MODE,(ISXF="T") S DLGIEN=+$P($G(^OR(100,+IEN,0)),U,5)
"RTN","ORWDXM3",61,0)
 S X0=$G(^ORD(101.41,DLGIEN,0)),TYP=$P(X0,U,4),DGRP=$P(X0,U,5)
"RTN","ORWDXM3",62,0)
 I MODE S DGRP=+$P($G(^OR(100,+IEN,0)),U,11)
"RTN","ORWDXM3",63,0)
 ;JD NEW START 11/13/02
"RTN","ORWDXM3",64,0)
 I DLGIEN=$O(^ORD(101.41,"B","PSJ OR PAT OE",0)) S PSMDGP=1
"RTN","ORWDXM3",65,0)
 I DLGIEN=$O(^ORD(101.41,"B","PSO OERR",0)) S PSMDGP=2
"RTN","ORWDXM3",66,0)
 ;JD NEW END 11/13/02
"RTN","ORWDXM3",67,0)
 ; for copy or change, if the base dialog has changed, use it's info 
"RTN","ORWDXM3",68,0)
 I MODE,$G(ORDIALOG),(+DLGIEN'=+ORDIALOG),(PSMDGP=0) D
"RTN","ORWDXM3",69,0)
 . S DLGIEN=+ORDIALOG,DGRP=$P(^ORD(101.41,+ORDIALOG,0),U,5)
"RTN","ORWDXM3",70,0)
 D FORMID^ORWDXM(.FID,DLGIEN)
"RTN","ORWDXM3",71,0)
 Q DLGIEN_U_TYP_U_FID_U_DGRP
"RTN","ORWDXM3",72,0)
 ;
"RTN","ORWDXM3",73,0)
CHKDSBL(LST,ID,MODE)  ; return message if dialog disabled
"RTN","ORWDXM3",74,0)
 ; ID=DlgIEN or ORIFN, MODE=0:Dialog,1:Copy,2:Change
"RTN","ORWDXM3",75,0)
 ; LST=QL_REJECT + disabled message or unchanged
"RTN","ORWDXM3",76,0)
 S DLGIEN=+ID I MODE S DLGIEN=+$P($G(^OR(100,+ID,0)),U,5)
"RTN","ORWDXM3",77,0)
 S X0=$G(^ORD(101.41,DLGIEN,0)),X=$P(X0,U,3)
"RTN","ORWDXM3",78,0)
 I '$L(X),($P(X0,U,4)="Q") D  ; check default dialog
"RTN","ORWDXM3",79,0)
 . S DLGIEN=+$$DEFDLG^ORWDXQ($P(X0,U,5))
"RTN","ORWDXM3",80,0)
 . S X=$P($G(^ORD(101.41,DLGIEN,0)),U,3)
"RTN","ORWDXM3",81,0)
 I $L(X) D
"RTN","ORWDXM3",82,0)
 . I MODE D GETTXT^ORWORR(.LST,ID) S LST(.6)="",LST(.7)="Cannot "_$S(MODE=1:"Copy",1:"Change")_" -"
"RTN","ORWDXM3",83,0)
 . S LST(0)="8^0",LST(.5)="Dialog Disabled:  "_X
"RTN","ORWDXM3",84,0)
 Q
"RTN","ORWDXM3",85,0)
CHKVACT(LST,ID,MODE,ORNP)  ; return message if action not valid
"RTN","ORWDXM3",86,0)
 ; ID=DlgIEN or ORIFN, MODE=0:Dialog,1:Copy,2:Change
"RTN","ORWDXM3",87,0)
 ; LST=QL_REJECT + invalid action message or unchanged
"RTN","ORWDXM3",88,0)
 Q:'MODE  ; not an action on an order
"RTN","ORWDXM3",89,0)
 N X,ACT S ACT=$S(MODE=1:"RW",MODE=2:"XX",1:"")
"RTN","ORWDXM3",90,0)
 D VALID^ORWDXA(.X,ID,ACT,ORNP)
"RTN","ORWDXM3",91,0)
 I $L(X) D GETTXT^ORWORR(.LST,ID) D
"RTN","ORWDXM3",92,0)
 . S LST(0)="8^0",LST(.5)=X,LST(.6)="",LST(.7)="Cannot "_$S(MODE=1:"Copy",1:"Change")_" -"
"RTN","ORWDXM3",93,0)
 Q
"RTN","ORWDXM3",94,0)
CHKCOPY(LST,ID,FLDS)  ; return message if can't copy this order
"RTN","ORWDXM3",95,0)
 ; ID=ORIFN;ACT FLDS=EventType in 7th piece
"RTN","ORWDXM3",96,0)
 ; LST=QL_REJECT + cannot copy message or unchanged
"RTN","ORWDXM3",97,0)
 I "^A^D^T^"'[(U_$E($P(FLDS,U,7))_U) Q             ; not event delayed
"RTN","ORWDXM3",98,0)
 N PKG S PKG=$P($G(^OR(100,+ID,0)),U,14)
"RTN","ORWDXM3",99,0)
 S PKG=$$NMSP^ORCD(PKG) I PKG="OR"!(PKG="PS") Q    ; xfer meds, generics
"RTN","ORWDXM3",100,0)
 N ORWCAT S ORWCAT=$P($G(^OR(100,+ID,0)),U,12)
"RTN","ORWDXM3",101,0)
 I ORWCAT="I",("^A^T^"[(U_$E($P(FLDS,U,7))_U)) Q   ; admit, xfer inpt
"RTN","ORWDXM3",102,0)
 I ORWCAT="O",$E($P(FLDS,U,7))="D" Q               ; discharge outpt
"RTN","ORWDXM3",103,0)
 D GETTXT^ORWORR(.LST,ID)
"RTN","ORWDXM3",104,0)
 I ORWCAT="I" S LST(.5)="inpatient order to outpatient -"
"RTN","ORWDXM3",105,0)
 I ORWCAT="O" S LST(.5)="outpatient order to inpatient -"
"RTN","ORWDXM3",106,0)
 S:$D(LST(.5)) LST(.5)="Cannot copy the following "_LST(.5)
"RTN","ORWDXM3",107,0)
 S LST(0)="8^0",LST(.7)=""
"RTN","ORWDXM3",108,0)
 Q
"RTN","ORWDXM3",109,0)
BLD4CHG(LST,ID,FLDS)  ; build responses for an edit
"RTN","ORWDXM3",110,0)
 ; ID=ORIFN;ACT FLDS=unused right now
"RTN","ORWDXM3",111,0)
 ; LST(0)=Qlvl^RespID(XOrderID)^DlgIEN^DlgType^FormID^DGrp
"RTN","ORWDXM3",112,0)
 N OIDX,OI,CNT
"RTN","ORWDXM3",113,0)
 S (OI,OIDX,CNT)=0
"RTN","ORWDXM3",114,0)
 S:$D(^OR(100,+ID,4.5,"ID","ORDERABLE")) OIDX=$O(^OR(100,+ID,4.5,"ID","ORDERABLE",0))
"RTN","ORWDXM3",115,0)
 I $D(^OR(100,+ID,4.5,OIDX)) D
"RTN","ORWDXM3",116,0)
 . F  S CNT=$O(^OR(100,+ID,4.5,OIDX,CNT)) Q:'CNT  D
"RTN","ORWDXM3",117,0)
 . . S OI=^(CNT) D VALDOI
"RTN","ORWDXM3",118,0)
 I +LST(0)=8 S LST(.5)="You can not change this order." Q
"RTN","ORWDXM3",119,0)
 S LST(0)="0^X"_ID_U_$$DLGINFO(+ID,2)
"RTN","ORWDXM3",120,0)
 S $P(LST(0),U,4)="X"
"RTN","ORWDXM3",121,0)
 Q
"RTN","ORWDXM3",122,0)
VALDOI ; Validate the Orderable Items
"RTN","ORWDXM3",123,0)
 N ORQUIT,ORPS
"RTN","ORWDXM3",124,0)
 I $G(^ORD(101.43,OI,.1)),^(.1)'>$$NOW^XLFDT D
"RTN","ORWDXM3",125,0)
 . S ORQUIT=1
"RTN","ORWDXM3",126,0)
 . S LST(0)="8^0"
"RTN","ORWDXM3",127,0)
 I $D(ORQUIT) Q:ORQUIT
"RTN","ORWDXM3",128,0)
 S ORPS=$G(^ORD(101.43,+OI,"PS"))
"RTN","ORWDXM3",129,0)
 I $P(ORPS,U,1,4)="0^0^0^0" S LST(0)="8^0"
"RTN","ORWDXM3",130,0)
 Q
"RTN","ORWDXM3",131,0)
VALQO(IFN) ;Check to see if it's a good QO med
"RTN","ORWDXM3",132,0)
 ;If it's an IV QO: check if infusion rate entered
"RTN","ORWDXM3",133,0)
 ;If it's an UD QO: check if dosage entered
"RTN","ORWDXM3",134,0)
 ;regular order treated as good QO
"RTN","ORWDXM3",135,0)
 ;
"RTN","ORWDXM3",136,0)
 I $P($G(^ORD(101.41,IFN,0)),U,4)'="Q" Q 1
"RTN","ORWDXM3",137,0)
 N ODP,INFUID,DSAGEID,SUCC
"RTN","ORWDXM3",138,0)
 S SUCC=0
"RTN","ORWDXM3",139,0)
 S ODP=$P($G(^ORD(101.41,IFN,0)),U,7)
"RTN","ORWDXM3",140,0)
 S ODP=$$GET1^DIQ(9.4,+ODP_",",1)
"RTN","ORWDXM3",141,0)
 ;check infusion rate for IV QO
"RTN","ORWDXM3",142,0)
 I ODP="PSIV" D
"RTN","ORWDXM3",143,0)
 . S INFUID=$O(^ORD(101.41,"B","OR GTX INFUSION RATE",0))
"RTN","ORWDXM3",144,0)
 . I $D(ORDIALOG(INFUID,1)) S SUCC=1
"RTN","ORWDXM3",145,0)
 ;check dosage for UD QO
"RTN","ORWDXM3",146,0)
 I (ODP="PSJ")!(ODP="PSO") D
"RTN","ORWDXM3",147,0)
 . S DSAGEID=$O(^ORD(101.41,"B","OR GTX INSTRUCTIONS",0))
"RTN","ORWDXM3",148,0)
 . I $D(ORDIALOG(DSAGEID,1)) S SUCC=1
"RTN","ORWDXM3",149,0)
 Q SUCC
"VER")
8.0^22.0
**END**
**END**
