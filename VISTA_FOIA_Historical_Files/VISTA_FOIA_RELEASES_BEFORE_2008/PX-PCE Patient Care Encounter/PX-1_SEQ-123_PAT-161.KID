Released PX*1*161 SEQ #123
Extracted from mail message
**KIDS**:PX*1.0*161^

**INSTALL NAME**
PX*1.0*161
"BLD",6041,0)
PX*1.0*161^PCE PATIENT CARE ENCOUNTER^0^3050412^y
"BLD",6041,1,0)
^^3^3^3050224^
"BLD",6041,1,1,0)
Change Date action gives wrong century with future 2 digit year entry.
"BLD",6041,1,2,0)
 
"BLD",6041,1,3,0)
Uparrowing at patient expired prompt causes indefined error.
"BLD",6041,4,0)
^9.64PA^^
"BLD",6041,"ABPKG")
n
"BLD",6041,"KRN",0)
^9.67PA^8989.52^19
"BLD",6041,"KRN",.4,0)
.4
"BLD",6041,"KRN",.4,"NM",0)
^9.68A^^
"BLD",6041,"KRN",.401,0)
.401
"BLD",6041,"KRN",.401,"NM",0)
^9.68A^^
"BLD",6041,"KRN",.402,0)
.402
"BLD",6041,"KRN",.402,"NM",0)
^9.68A^^
"BLD",6041,"KRN",.403,0)
.403
"BLD",6041,"KRN",.403,"NM",0)
^9.68A^^
"BLD",6041,"KRN",.5,0)
.5
"BLD",6041,"KRN",.5,"NM",0)
^9.68A^^
"BLD",6041,"KRN",.84,0)
.84
"BLD",6041,"KRN",.84,"NM",0)
^9.68A^^
"BLD",6041,"KRN",3.6,0)
3.6
"BLD",6041,"KRN",3.6,"NM",0)
^9.68A^^
"BLD",6041,"KRN",3.8,0)
3.8
"BLD",6041,"KRN",3.8,"NM",0)
^9.68A^^
"BLD",6041,"KRN",9.2,0)
9.2
"BLD",6041,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",6041,"KRN",9.8,0)
9.8
"BLD",6041,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6041,"KRN",9.8,"NM",1,0)
PXCE^^0^B63618125
"BLD",6041,"KRN",9.8,"NM",2,0)
PXCEDATE^^0^B2790458
"BLD",6041,"KRN",9.8,"NM",3,0)
PXCEPAT^^0^B30169766
"BLD",6041,"KRN",9.8,"NM","B","PXCE",1)

"BLD",6041,"KRN",9.8,"NM","B","PXCEDATE",2)

"BLD",6041,"KRN",9.8,"NM","B","PXCEPAT",3)

"BLD",6041,"KRN",19,0)
19
"BLD",6041,"KRN",19,"NM",0)
^9.68A^^
"BLD",6041,"KRN",19.1,0)
19.1
"BLD",6041,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6041,"KRN",101,0)
101
"BLD",6041,"KRN",101,"NM",0)
^9.68A^^
"BLD",6041,"KRN",409.61,0)
409.61
"BLD",6041,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",6041,"KRN",771,0)
771
"BLD",6041,"KRN",771,"NM",0)
^9.68A^^
"BLD",6041,"KRN",870,0)
870
"BLD",6041,"KRN",870,"NM",0)
^9.68A^^
"BLD",6041,"KRN",8989.51,0)
8989.51
"BLD",6041,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",6041,"KRN",8989.52,0)
8989.52
"BLD",6041,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",6041,"KRN",8994,0)
8994
"BLD",6041,"KRN",8994,"NM",0)
^9.68A^^
"BLD",6041,"KRN","B",.4,.4)

"BLD",6041,"KRN","B",.401,.401)

"BLD",6041,"KRN","B",.402,.402)

"BLD",6041,"KRN","B",.403,.403)

"BLD",6041,"KRN","B",.5,.5)

"BLD",6041,"KRN","B",.84,.84)

"BLD",6041,"KRN","B",3.6,3.6)

"BLD",6041,"KRN","B",3.8,3.8)

"BLD",6041,"KRN","B",9.2,9.2)

"BLD",6041,"KRN","B",9.8,9.8)

"BLD",6041,"KRN","B",19,19)

"BLD",6041,"KRN","B",19.1,19.1)

"BLD",6041,"KRN","B",101,101)

"BLD",6041,"KRN","B",409.61,409.61)

"BLD",6041,"KRN","B",771,771)

"BLD",6041,"KRN","B",870,870)

"BLD",6041,"KRN","B",8989.51,8989.51)

"BLD",6041,"KRN","B",8989.52,8989.52)

"BLD",6041,"KRN","B",8994,8994)

"BLD",6041,"QUES",0)
^9.62^^
"BLD",6041,"REQB",0)
^9.611^1^1
"BLD",6041,"REQB",1,0)
PX*1.0*160^2
"BLD",6041,"REQB","B","PX*1.0*160",1)

"MBREQ")
0
"PKG",413,-1)
1^1
"PKG",413,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter (VA Parent package)^
"PKG",413,20,0)
^9.402P^^
"PKG",413,22,0)
^9.49I^1^1
"PKG",413,22,1,0)
1.0^2960812^2960913^12537
"PKG",413,22,1,"PAH",1,0)
161^3050412
"PKG",413,22,1,"PAH",1,1,0)
^^3^3^3050412
"PKG",413,22,1,"PAH",1,1,1,0)
Change Date action gives wrong century with future 2 digit year entry.
"PKG",413,22,1,"PAH",1,1,2,0)
 
"PKG",413,22,1,"PAH",1,1,3,0)
Uparrowing at patient expired prompt causes indefined error.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PXCE")
0^1^B63618125
"RTN","PXCE",1,0)
PXCE ;ISL/dee - Main routine for PCE's user interface ; 3/27/01 12:17pm
"RTN","PXCE",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**25,47,52,64,75,78,147,151,161**;Aug 12, 1996
"RTN","PXCE",3,0)
 ;
"RTN","PXCE",4,0)
 ;PXCEKEYS is a set of letters that enable the user
"RTN","PXCE",5,0)
 ;  to enter certain fields
"RTN","PXCE",6,0)
 ;  "P" is included if the user holds the AK.PROVIDER key.
"RTN","PXCE",7,0)
 ;  "C" should be included by the option if the user should be
"RTN","PXCE",8,0)
 ;    asked for the Provider Narrative Categories on V CPT, V POV,
"RTN","PXCE",9,0)
 ;    and V TREATMENT files.  As well as for  other fields that are
"RTN","PXCE",10,0)
 ;    not ask of the normal user.
"RTN","PXCE",11,0)
 ;  "S" is for the superviser.  If they have "S" then they will be 
"RTN","PXCE",12,0)
 ;    given "C" and "D" by the program.
"RTN","PXCE",13,0)
 ;  "V" is for view only
"RTN","PXCE",14,0)
 ; And if it:
"RTN","PXCE",15,0)
 ;  includes "D" to delete any V-File
"RTN","PXCE",16,0)
 ;  includes "d" to only delete V-File entries this user created
"RTN","PXCE",17,0)
 ;
"RTN","PXCE",18,0)
 I '$D(PXCEKEYS)#2 N PXCEKEYS S PXCEKEYS=""
"RTN","PXCE",19,0)
 S:PXCEKEYS'["D" PXCEKEYS=PXCEKEYS_"D"
"RTN","PXCE",20,0)
 G START
"RTN","PXCE",21,0)
 ; -- main entry point for PCE's user interface
"RTN","PXCE",22,0)
EN1(PXCEKEYS) ;Does not checks for provider
"RTN","PXCE",23,0)
 G START1
"RTN","PXCE",24,0)
EN(PXCEKEYS) ;Checks for provider
"RTN","PXCE",25,0)
 ;
"RTN","PXCE",26,0)
START ;
"RTN","PXCE",27,0)
 ;Key for provider (P)
"RTN","PXCE",28,0)
 I PXCEKEYS'["P",$O(^VA(200,"AK.PROVIDER",$P(^VA(200,DUZ,0),"^"),""))=DUZ S PXCEKEYS=PXCEKEYS_"P"
"RTN","PXCE",29,0)
START1 ;
"RTN","PXCE",30,0)
 ;If they have the Key for superviser (S) make sure that they also
"RTN","PXCE",31,0)
 ;  have C and D.
"RTN","PXCE",32,0)
 I PXCEKEYS["S" S:PXCEKEYS'["C" PXCEKEYS=PXCEKEYS_"C" S:PXCEKEYS'["D" PXCEKEYS=PXCEKEYS_"D"
"RTN","PXCE",33,0)
 ;
"RTN","PXCE",34,0)
 K I,X,SDB,XQORNOD,SDFN,SDCLN,DA,DR,DIE,DNM,DQ,%B
"RTN","PXCE",35,0)
 N PXCEVIEW,SDAMTYP
"RTN","PXCE",36,0)
 N PXCEPAT,PXCEHLOC
"RTN","PXCE",37,0)
 N PXCEDBEG,PXCEDEND,PXCE9BEG,PXCE9END,SDBEG,SDEND
"RTN","PXCE",38,0)
 N PXCEDBP,PXCEDBHL,PXCEDEP,PXCEDEHL
"RTN","PXCE",39,0)
 N PXCECONT
"RTN","PXCE",40,0)
 N PXCESOR,PXCEPKG
"RTN","PXCE",41,0)
 I $G(DFN)'>0 N DFN
"RTN","PXCE",42,0)
 ;
"RTN","PXCE",43,0)
 S PXCEVIEW="^"_$S("~V~A~"["~"_$P(^PX(815,1,"LM"),"^",2)_"~":$P(^PX(815,1,"LM"),"^",2),1:"V")_"^"
"RTN","PXCE",44,0)
 S PXCESOR=$$SOURCE^PXAPIUTL("PXCE DATA ENTRY")
"RTN","PXCE",45,0)
 S PXCEPKG=$$PKG2IEN^VSIT("PX")
"RTN","PXCE",46,0)
 ;
"RTN","PXCE",47,0)
 K DIRUT
"RTN","PXCE",48,0)
 D SETUP Q:$D(DIRUT)
"RTN","PXCE",49,0)
 ;
"RTN","PXCE",50,0)
 F  D  Q:$D(PXCEVIEW)'=1!'$D(PXCECONT)
"RTN","PXCE",51,0)
 . K PXCECONT
"RTN","PXCE",52,0)
 . I PXCEKEYS["V" D
"RTN","PXCE",53,0)
 .. I PXCEVIEW["A" D
"RTN","PXCE",54,0)
 ... D EN^VALM("PXCE SDAM VIEW ONLY")
"RTN","PXCE",55,0)
 .. E  D EN^VALM("PXCE VIEW ONLY")
"RTN","PXCE",56,0)
 . E  I PXCEVIEW["A" D
"RTN","PXCE",57,0)
 .. D EN^VALM("PXCE SDAM MENU")
"RTN","PXCE",58,0)
 . E  D EN^VALM("PXCE MAIN MENU")
"RTN","PXCE",59,0)
 D FULL^VALM1
"RTN","PXCE",60,0)
 D EXITALL
"RTN","PXCE",61,0)
 Q
"RTN","PXCE",62,0)
 ;
"RTN","PXCE",63,0)
SETUP ;
"RTN","PXCE",64,0)
 N DIR,DA,X,Y,PXRES
"RTN","PXCE",65,0)
 N PXCEUSEL,X1,X2
"RTN","PXCE",66,0)
 I $G(DFN)>0 S PXCEUSEL=DFN_"^DPT("
"RTN","PXCE",67,0)
 E  S DIR(0)="815,201",DIR("A")="Select Patient or Clinic name" D ^DIR K DIR,DA Q:$D(DIRUT)  S PXCEUSEL=Y
"RTN","PXCE",68,0)
 S X1=DT,X2=$S($P(^PX(815,1,"LM"),"^",3)]"":$P(^PX(815,1,"LM"),"^",3),1:-30) D C^%DTC
"RTN","PXCE",69,0)
 S PXCEDBP=X
"RTN","PXCE",70,0)
 S X1=DT,X2=$S($P(^PX(815,1,"LM"),"^",4)]"":$P(^PX(815,1,"LM"),"^",4),1:0) D C^%DTC
"RTN","PXCE",71,0)
 S PXCEDEP=X
"RTN","PXCE",72,0)
 S X1=DT,X2=$S($P(^PX(815,1,"LM"),"^",5)]"":$P(^PX(815,1,"LM"),"^",5),1:-7) D C^%DTC
"RTN","PXCE",73,0)
 S PXCEDBHL=X
"RTN","PXCE",74,0)
 S X1=DT,X2=$S($P(^PX(815,1,"LM"),"^",6)]"":$P(^PX(815,1,"LM"),"^",6),1:0) D C^%DTC
"RTN","PXCE",75,0)
 S PXCEDEHL=X
"RTN","PXCE",76,0)
 I PXCEUSEL["DPT(" S $P(PXCEVIEW,"^",1)="P" S SDAMTYP="P"
"RTN","PXCE",77,0)
 I PXCEUSEL["SC(" S $P(PXCEVIEW,"^",1)="H" S SDAMTYP="C" D  I 'PXRES G SETUP
"RTN","PXCE",78,0)
 .S PXRES=$$CLNCK^SDUTL2(+PXCEUSEL,1)
"RTN","PXCE",79,0)
 .I 'PXRES W !,?5,"Clinic MUST be corrected before continuing."
"RTN","PXCE",80,0)
 D SETDATES
"RTN","PXCE",81,0)
 I PXCEUSEL["DPT(" S PXCEPAT=+PXCEUSEL,FSEL=1 D NEWPAT1^PXCEPAT K FSEL G:$D(DIRUT) SETUP
"RTN","PXCE",82,0)
 I PXCEUSEL["SC(" S PXCEHLOC=+PXCEUSEL D NEWHOSL1^PXCENEW
"RTN","PXCE",83,0)
 Q
"RTN","PXCE",84,0)
 ;
"RTN","PXCE",85,0)
SETDATES ;
"RTN","PXCE",86,0)
 I PXCEVIEW["H" D
"RTN","PXCE",87,0)
 . S PXCEDBEG=PXCEDBHL
"RTN","PXCE",88,0)
 . S PXCEDEND=PXCEDEHL
"RTN","PXCE",89,0)
 E  D
"RTN","PXCE",90,0)
 . S PXCEDBEG=PXCEDBP
"RTN","PXCE",91,0)
 . S PXCEDEND=PXCEDEP
"RTN","PXCE",92,0)
 D DATE9S^PXCEDATE
"RTN","PXCE",93,0)
 Q
"RTN","PXCE",94,0)
 ;
"RTN","PXCE",95,0)
HDR ; -- header code
"RTN","PXCE",96,0)
 K VALMHDR,PXLNX,PXPCP
"RTN","PXCE",97,0)
 S PXLNX=1,PXPCP=""
"RTN","PXCE",98,0)
 ;
"RTN","PXCE",99,0)
 ;PATIENT
"RTN","PXCE",100,0)
 I PXCEVIEW["P" D
"RTN","PXCE",101,0)
 . S PXPCP=$$PCLINE^SDPPTEM(PXCEPAT,DT)
"RTN","PXCE",102,0)
 . S VALMHDR(PXLNX)=$E(PXCEPAT("NAME"),1,26)
"RTN","PXCE",103,0)
 . S VALMHDR(PXLNX)=$E(VALMHDR(PXLNX)_$E("    ",1,(27-$L(VALMHDR(PXLNX))))_PXCEPAT("SSN")_"                                           ",1,40)
"RTN","PXCE",104,0)
 E  S VALMHDR(PXLNX)="                                        "
"RTN","PXCE",105,0)
 ;LOCATION
"RTN","PXCE",106,0)
 S VALMHDR(PXLNX)=VALMHDR(PXLNX)_"Clinic:  "_$S($G(PXCEHLOC)&(PXCEVIEW'["P^A"):$P(^SC(PXCEHLOC,0),"^"),1:"All")
"RTN","PXCE",107,0)
 S PXLNX=PXLNX+1
"RTN","PXCE",108,0)
 I $L(PXPCP) S VALMHDR(PXLNX)=PXPCP,PXLNX=PXLNX+1
"RTN","PXCE",109,0)
 ;
"RTN","PXCE",110,0)
 ;DATE
"RTN","PXCE",111,0)
 S VALMHDR(PXLNX)=$E("Date range:  "_$$FMTE^XLFDT(PXCEDBEG,5)_" to "_$$FMTE^XLFDT(PXCEDEND,5)_$J("",40),1,40)
"RTN","PXCE",112,0)
 ;
"RTN","PXCE",113,0)
 ;Credit Stop
"RTN","PXCE",114,0)
 S:PXCEVIEW["A" VALMHDR(PXLNX)=VALMHDR(PXLNX)_$P($G(SDAMLIST),"^",2)
"RTN","PXCE",115,0)
 S PXLNX=PXLNX+1
"RTN","PXCE",116,0)
 ;
"RTN","PXCE",117,0)
 ;CHECK IF GAF NEEDED
"RTN","PXCE",118,0)
 I PXCEVIEW'["P",$$MHCLIN^SDUTL2(PXCEHLOC) S VALMHDR(PXLNX)=$$SETSTR^VALM1("* - New GAF Score Required","",25,80)
"RTN","PXCE",119,0)
 I PXCEVIEW["P" D
"RTN","PXCE",120,0)
 .S VALMHDR(PXLNX)=$$SETSTR^VALM1("* - New GAF Score Required","",25,80)
"RTN","PXCE",121,0)
 .N PXCEHLC,PXCESTA
"RTN","PXCE",122,0)
 .K PXCEHIT
"RTN","PXCE",123,0)
 .S PXCESTA=$$ELSTAT^SDUTL2(PXCEPAT)
"RTN","PXCE",124,0)
 .S PXCEZZ=0
"RTN","PXCE",125,0)
 .F  S PXCEZZ=$O(^TMP("PXCEIDX",$J,PXCEZZ)) Q:PXCEZZ'>0  D  Q:$D(PXCEHIT)
"RTN","PXCE",126,0)
 ..S PXCEHLC=+$P($G(^AUPNVSIT(^TMP("PXCEIDX",$J,PXCEZZ),0)),"^",22)
"RTN","PXCE",127,0)
 ..I $$MHCLIN^SDUTL2(PXCEHLC),'$$COLLAT^SDUTL2(PXCESTA) D
"RTN","PXCE",128,0)
 ...S PXCEGAF=$$NEWGAF^SDUTL2($S($D(SDFN):SDFN,$D(PXCEPAT):PXCEPAT,1:""))
"RTN","PXCE",129,0)
 ...S PXCEGST=$P(PXCEGAF,"^")
"RTN","PXCE",130,0)
 ...I PXCEGST D
"RTN","PXCE",131,0)
 ....S PXCEGDT=$$FMTE^XLFDT($P(PXCEGAF,"^",3),"5M"),PXCEGSC=$P(PXCEGAF,"^",2),PXCEGPR=$P(PXCEGAF,"^",4)
"RTN","PXCE",132,0)
 ....S VALMHDR(PXLNX)="GAF Date: "_PXCEGDT_"  GAF Score:"_PXCEGSC_"   NEW REQ",PXCEHIT=1
"RTN","PXCE",133,0)
 ;
"RTN","PXCE",134,0)
 S VALMSG="+ Next Screen   - Prev Screen   ?? More Actions"
"RTN","PXCE",135,0)
 Q
"RTN","PXCE",136,0)
 ;
"RTN","PXCE",137,0)
INIT ; -- init variables and list array
"RTN","PXCE",138,0)
 D MAKELIST^PXCENEW
"RTN","PXCE",139,0)
 Q
"RTN","PXCE",140,0)
 ;
"RTN","PXCE",141,0)
EXIT ; -- exit code
"RTN","PXCE",142,0)
 D FULL^VALM1
"RTN","PXCE",143,0)
 D CLEAN^VALM10
"RTN","PXCE",144,0)
 K ^TMP("PXCE",$J)
"RTN","PXCE",145,0)
 K ^TMP("PXCEIDX",$J)
"RTN","PXCE",146,0)
 D FNL^PXCESDAM
"RTN","PXCE",147,0)
 Q
"RTN","PXCE",148,0)
 ;
"RTN","PXCE",149,0)
EXITALL ; Exit of whole program
"RTN","PXCE",150,0)
 D PATKILL^PXCEPAT
"RTN","PXCE",151,0)
 D KVA^VADPT
"RTN","PXCE",152,0)
 Q
"RTN","PXCE",153,0)
 ;
"RTN","PXCE",154,0)
DONE ; -- exit action for protocol
"RTN","PXCE",155,0)
 S:'$D(VALMBCK) VALMBCK="R"
"RTN","PXCE",156,0)
 S VALMSG="+ Next Screen   - Prev Screen   ?? More Actions"
"RTN","PXCE",157,0)
 Q
"RTN","PXCE",158,0)
 ;
"RTN","PXCE",159,0)
EXPND ; -- expand code
"RTN","PXCE",160,0)
 D EN^PXCEEXP
"RTN","PXCE",161,0)
 Q
"RTN","PXCE",162,0)
 ;
"RTN","PXCE",163,0)
SEL1(HELP,PXCEADD) ; Select 1 visit
"RTN","PXCE",164,0)
 ; If the $GET(PXCEADD) is non zero then will 
"RTN","PXCE",165,0)
 ;   add to the prompt "add a new encounter"
"RTN","PXCE",166,0)
 N X,Y,MAX
"RTN","PXCE",167,0)
 S MAX=+$G(^TMP("PXCEIDX",$J,0)) I MAX'>0 Q "^"
"RTN","PXCE",168,0)
 S Y=$P($P(XQORNOD(0),"^",4),"=",2)
"RTN","PXCE",169,0)
 I Y]"" D
"RTN","PXCE",170,0)
 . I (+Y'=Y)!(+Y>MAX)!(+Y<1)!(Y#1'=0) D
"RTN","PXCE",171,0)
 .. W !,$C(7),"Selection '",Y,"' is not a valid choice."
"RTN","PXCE",172,0)
 .. D PAUSE^PXCEHELP
"RTN","PXCE",173,0)
 .. S Y="^"
"RTN","PXCE",174,0)
 E  I '$G(PXCEADD) D
"RTN","PXCE",175,0)
 . N DIR,DA
"RTN","PXCE",176,0)
 . S DIR(0)="NAO^1:"_MAX_":0",DIR("A")="Select Encounter"
"RTN","PXCE",177,0)
 . S:MAX>1 DIR("A")=DIR("A")_" (1-"_MAX_"): "
"RTN","PXCE",178,0)
 . S:MAX'>1 DIR("A")=DIR("A")_": ",DIR("B")=1
"RTN","PXCE",179,0)
 . S DIR("?")="Enter the number of the Encounter you wish to "
"RTN","PXCE",180,0)
 . S DIR("?")=DIR("?")_$S($L(HELP):HELP,1:"act on")
"RTN","PXCE",181,0)
 . D ^DIR I $D(DTOUT)!(X="") S Y="^"
"RTN","PXCE",182,0)
 E  D
"RTN","PXCE",183,0)
 . N DIR,DA
"RTN","PXCE",184,0)
ASKLOOP . S DIR(0)="FAO^1:"_$L(MAX)
"RTN","PXCE",185,0)
 . S DIR("A")="Enter 1-"_MAX_" to Edit, or 'A' to Add: "
"RTN","PXCE",186,0)
 . S DIR("?")="Enter the number of the Encounter you wish "
"RTN","PXCE",187,0)
 . S DIR("?")=DIR("?")_$S($L(HELP):HELP,1:"act on")_" or A to "
"RTN","PXCE",188,0)
 . S DIR("?")=DIR("?")_$S($L(HELP):HELP,1:"act on")_" add a new Encounter"
"RTN","PXCE",189,0)
 . D ^DIR
"RTN","PXCE",190,0)
 . K DIR,DA
"RTN","PXCE",191,0)
 . I $D(DIRUT)!(X="") S Y="^" Q
"RTN","PXCE",192,0)
 . I "Aa"[Y S Y="A" Q
"RTN","PXCE",193,0)
 . G:Y<1!(Y>MAX) ASKLOOP
"RTN","PXCE",194,0)
 Q Y
"RTN","PXCE",195,0)
 ;
"RTN","PXCE",196,0)
GAF ;;
"RTN","PXCE",197,0)
 N PXCEVIEN,PXDFN,PXDSS,PXELIG,PXDATA
"RTN","PXCE",198,0)
 I $G(PXCEHLOC),'$$MHCLIN^SDUTL2(PXCEHLOC) D  G SKIP
"RTN","PXCE",199,0)
 . S DIR(0)="FOA"
"RTN","PXCE",200,0)
 . S DIR("A",1)=" This is not a Mental Health Clinic, a GAF Score may not be entered."
"RTN","PXCE",201,0)
 . S DIR("A")=" Press any key to continue: "
"RTN","PXCE",202,0)
 . D ^DIR K DIR
"RTN","PXCE",203,0)
 ;
"RTN","PXCE",204,0)
 I $D(^TMP("PXCEIDX",$J)) D GETVIEN^PXCEAE
"RTN","PXCE",205,0)
 I $D(^TMP("SDAMIDX",$J)) S PXCEVIEN=$$SELAPPM^PXCESDAM
"RTN","PXCE",206,0)
 I '($G(PXCEVIEN)]"")!($G(PXCEVIEN)=-1) D  S VALMBCK="R" Q
"RTN","PXCE",207,0)
 . S DIR(0)="FAO"
"RTN","PXCE",208,0)
 . I '($G(PXCEVIEN)]"") S DIR("A",1)="Nothing to select."
"RTN","PXCE",209,0)
 . I $G(PXCEVIEN)=-1 S DIR("A",1)="No selections made."
"RTN","PXCE",210,0)
 . S DIR("A")="Press any key to continue."
"RTN","PXCE",211,0)
 . D ^DIR K DIR
"RTN","PXCE",212,0)
 S PXDFN=$P($G(^AUPNVSIT(PXCEVIEN,0)),"^",5)
"RTN","PXCE",213,0)
 S PXDSS=$P($G(^AUPNVSIT(PXCEVIEN,0)),"^",8)
"RTN","PXCE",214,0)
 S PXDATA=$G(^DPT(PXDFN,"S",$P(^AUPNVSIT(PXCEVIEN,0),U),0))
"RTN","PXCE",215,0)
 S PXELIG=$$ELSTAT^SDUTL2(PXDFN)
"RTN","PXCE",216,0)
 I $$MHCLIN^SDUTL2("",PXDSS),'($$COLLAT^SDUTL2(PXELIG)!$P(PXDATA,U,11)) D
"RTN","PXCE",217,0)
 . S PXGAF=$$NEWGAF^SDUTL2(PXDFN)
"RTN","PXCE",218,0)
 . D FULL^VALM1
"RTN","PXCE",219,0)
 . W !
"RTN","PXCE",220,0)
 . I +$P(PXGAF,U,5)>0 W !,"Warning: Patient is deceased."
"RTN","PXCE",221,0)
 . W !,"Current GAF: "_+$P(PXGAF,U,2)
"RTN","PXCE",222,0)
 . W $S($P(PXGAF,U,3)>0:", from "_$$FMTE^XLFDT($P(PXGAF,U,3),"D"),1:", Date Unavailable")
"RTN","PXCE",223,0)
 . D EN^SDGAF(PXDFN)
"RTN","PXCE",224,0)
 E  D
"RTN","PXCE",225,0)
 . S DIR(0)="FOA"
"RTN","PXCE",226,0)
 . S DIR("A",1)="A GAF Score is not required for this appointment!"
"RTN","PXCE",227,0)
 . S DIR("A")="Press any key to continue: "
"RTN","PXCE",228,0)
 . D ^DIR K DIR
"RTN","PXCE",229,0)
 ;
"RTN","PXCE",230,0)
SKIP S VALMBCK="R"
"RTN","PXCE",231,0)
GAFQ Q
"RTN","PXCE",232,0)
 ;
"RTN","PXCEDATE")
0^2^B2790458
"RTN","PXCEDATE",1,0)
PXCEDATE ;ISL/dee - Used for things related to Date and Time ;6/20/96
"RTN","PXCEDATE",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**47,161**;Aug 12, 1996
"RTN","PXCEDATE",3,0)
 ;; ;
"RTN","PXCEDATE",4,0)
 Q
"RTN","PXCEDATE",5,0)
 ;
"RTN","PXCEDATE",6,0)
NEWDATE ;
"RTN","PXCEDATE",7,0)
 D ASKDATE(.PXCEDBEG,.PXCEDEND)
"RTN","PXCEDATE",8,0)
 D DATE9S
"RTN","PXCEDATE",9,0)
 D MAKELIST^PXCENEW
"RTN","PXCEDATE",10,0)
 Q
"RTN","PXCEDATE",11,0)
 ;
"RTN","PXCEDATE",12,0)
ASKDATE(DBEG,DEND) ;
"RTN","PXCEDATE",13,0)
 N NEWDBEG,NEWDEND
"RTN","PXCEDATE",14,0)
 S NEWDBEG=$P($$EDATE("",DBEG),".")
"RTN","PXCEDATE",15,0)
 Q:NEWDBEG<0
"RTN","PXCEDATE",16,0)
 S NEWDEND=$P($$LDATE("",DEND),".")
"RTN","PXCEDATE",17,0)
 Q:NEWDEND<0
"RTN","PXCEDATE",18,0)
 S DBEG=$S(NEWDBEG>0:NEWDBEG,1:DBEG)
"RTN","PXCEDATE",19,0)
 S DEND=$S(NEWDEND>0:NEWDEND,1:DEND)
"RTN","PXCEDATE",20,0)
 I DEND<DBEG S NEWDBEG=DEND,DEND=DBEG,DBEG=NEWDBEG
"RTN","PXCEDATE",21,0)
 ;D DATE9S  This must be called by the caller if it is wanted.
"RTN","PXCEDATE",22,0)
 Q
"RTN","PXCEDATE",23,0)
 ;
"RTN","PXCEDATE",24,0)
EDATE(PRMPT,DFLT) ; Get early date
"RTN","PXCEDATE",25,0)
 N %DT,X,Y
"RTN","PXCEDATE",26,0)
 S %DT="AEX"
"RTN","PXCEDATE",27,0)
 S %DT("A")=" Start "_$S($L($G(PRMPT)):PRMPT_" ",1:"")_"Date: "
"RTN","PXCEDATE",28,0)
 S %DT("B")=$S($L($G(DFLT)):$$FMTE^XLFDT(DFLT,5),1:"T-30")
"RTN","PXCEDATE",29,0)
 D ^%DT
"RTN","PXCEDATE",30,0)
 Q Y
"RTN","PXCEDATE",31,0)
 ;
"RTN","PXCEDATE",32,0)
LDATE(PRMPT,DFLT) ; Get late date
"RTN","PXCEDATE",33,0)
 N %DT,X,Y
"RTN","PXCEDATE",34,0)
 S %DT="AEX"
"RTN","PXCEDATE",35,0)
 S %DT("A")="Ending "_$S($L($G(PRMPT)):PRMPT_" ",1:"")_"Date: "
"RTN","PXCEDATE",36,0)
 S %DT("B")=$S($L($G(DFLT)):$$FMTE^XLFDT(DFLT,5),1:"TODAY")
"RTN","PXCEDATE",37,0)
 D ^%DT
"RTN","PXCEDATE",38,0)
 Q Y
"RTN","PXCEDATE",39,0)
 ;
"RTN","PXCEDATE",40,0)
DATE9S ;
"RTN","PXCEDATE",41,0)
 S PXCE9END=9999999-PXCEDEND
"RTN","PXCEDATE",42,0)
 S PXCE9BEG=9999999-PXCEDBEG+.999999
"RTN","PXCEDATE",43,0)
 S SDBEG=PXCEDBEG
"RTN","PXCEDATE",44,0)
 S SDEND=PXCEDEND
"RTN","PXCEDATE",45,0)
 Q
"RTN","PXCEDATE",46,0)
 ;
"RTN","PXCEDATE",47,0)
DATE(INDATE) ;Change internal date to an external date.
"RTN","PXCEDATE",48,0)
 N OUTDATE,AT
"RTN","PXCEDATE",49,0)
 Q:INDATE'>0 ""
"RTN","PXCEDATE",50,0)
 S OUTDATE=$$FMTE^XLFDT(INDATE,5)
"RTN","PXCEDATE",51,0)
 S AT=$F(OUTDATE,"@")
"RTN","PXCEDATE",52,0)
 Q $E(OUTDATE,1,(AT-2))_"  "_$P($E(OUTDATE,AT,99),":",1,2)
"RTN","PXCEDATE",53,0)
 ;
"RTN","PXCEPAT")
0^3^B30169766
"RTN","PXCEPAT",1,0)
PXCEPAT ;ISL/dee,ISA/KWP - Creates the List Manager display of visit for a patient ; 6/3/03 10:47am
"RTN","PXCEPAT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**1,5,14,30,70,147,160,161**;Aug 12, 1996
"RTN","PXCEPAT",3,0)
 Q
"RTN","PXCEPAT",4,0)
 ;
"RTN","PXCEPAT",5,0)
NEWPAT2 ;Entry point of changing patient from Update Encounter
"RTN","PXCEPAT",6,0)
 N PXCENEWP
"RTN","PXCEPAT",7,0)
 D PATIENT(.PXCENEWP)
"RTN","PXCEPAT",8,0)
 Q:PXCENEWP'>0
"RTN","PXCEPAT",9,0)
 D PATKILL
"RTN","PXCEPAT",10,0)
 S PXCEPAT=+PXCENEWP
"RTN","PXCEPAT",11,0)
NEWPAT1 ;Entry point for initial selection of patient
"RTN","PXCEPAT",12,0)
 D PATINFO(.PXCEPAT) Q:$D(DIRUT)
"RTN","PXCEPAT",13,0)
 I $P(PXCEVIEW,"^",1)'="P" D
"RTN","PXCEPAT",14,0)
 . S $P(PXCEVIEW,"^",1)="P"
"RTN","PXCEPAT",15,0)
 . D SETDATES^PXCE
"RTN","PXCEPAT",16,0)
 S SDAMTYP="P"
"RTN","PXCEPAT",17,0)
 I PXCEVIEW["A" K PXCEHLOC
"RTN","PXCEPAT",18,0)
 Q
"RTN","PXCEPAT",19,0)
 ;
"RTN","PXCEPAT",20,0)
NEWPAT ; -- init variables and list array
"RTN","PXCEPAT",21,0)
 N PXCENEWP
"RTN","PXCEPAT",22,0)
 D PATIENT(.PXCENEWP)
"RTN","PXCEPAT",23,0)
 I PXCENEWP'>0,("~H~P~"'[("~"_$P(PXCEVIEW,"^")_"~")) S VALMQUIT=1 Q
"RTN","PXCEPAT",24,0)
 I PXCENEWP'>0 Q
"RTN","PXCEPAT",25,0)
 D PATKILL
"RTN","PXCEPAT",26,0)
 S PXCEPAT=+PXCENEWP
"RTN","PXCEPAT",27,0)
 D NEWPAT1 Q:$D(DIRUT)
"RTN","PXCEPAT",28,0)
 D MAKELIST^PXCENEW
"RTN","PXCEPAT",29,0)
 Q
"RTN","PXCEPAT",30,0)
 ;
"RTN","PXCEPAT",31,0)
MAKELIST ;
"RTN","PXCEPAT",32,0)
 N PXCEDATE,PXCELOC,PXCESTAT,PXCEDT,PXCEIEN,PXCEVSIT,PXCEPRIM
"RTN","PXCEPAT",33,0)
 D CHGCAP^VALM("LOCATION","Clinic")
"RTN","PXCEPAT",34,0)
 K VALMHDR S VALMBCK="R"
"RTN","PXCEPAT",35,0)
 S PXCEDT=PXCE9END
"RTN","PXCEPAT",36,0)
 D CLEAN^VALM10
"RTN","PXCEPAT",37,0)
 K ^TMP("PXCEIDX",$J)
"RTN","PXCEPAT",38,0)
 S VALMBG=1
"RTN","PXCEPAT",39,0)
 S VALMCNT=0
"RTN","PXCEPAT",40,0)
 F  S PXCEDT=$O(^AUPNVSIT("AA",PXCEPAT,PXCEDT)) Q:PXCEDT'>0!(PXCEDT>PXCE9BEG)  D
"RTN","PXCEPAT",41,0)
 . S PXCEIEN=""
"RTN","PXCEPAT",42,0)
 . F  S PXCEIEN=$O(^AUPNVSIT("AA",PXCEPAT,PXCEDT,PXCEIEN)) Q:PXCEIEN'>0  D
"RTN","PXCEPAT",43,0)
 .. S PXCEVSIT=^AUPNVSIT(PXCEIEN,0)
"RTN","PXCEPAT",44,0)
 .. I $D(PXCEHLOC),$P(PXCEVSIT,"^",22)'=PXCEHLOC Q
"RTN","PXCEPAT",45,0)
 .. S PXCEPRIM=$P($G(^AUPNVSIT(PXCEIEN,150)),"^",3)
"RTN","PXCEPAT",46,0)
 .. ;+do not show encounter if the encounter type is S,C or null
"RTN","PXCEPAT",47,0)
 .. Q:"SC"[PXCEPRIM
"RTN","PXCEPAT",48,0)
 .. I PXCEKEYS'["S",PXCEKEYS'["V","A"=PXCEPRIM Q  ;+let supervisor and viewer see ancillary encounters
"RTN","PXCEPAT",49,0)
 .. I PXCEKEYS'["V",$$DISPOSIT^PXUTL1(PXCEPAT,+PXCEVSIT,PXCEIEN) Q  ;+let viewer see disposition
"RTN","PXCEPAT",50,0)
 .. S VALMCNT=VALMCNT+1
"RTN","PXCEPAT",51,0)
 .. S Y=$P(PXCEVSIT,"^",1)
"RTN","PXCEPAT",52,0)
 .. S PXCEDATE=$$DATE^PXCEDATE($P(PXCEVSIT,"^",1))
"RTN","PXCEPAT",53,0)
 .. S PXCEDATE=$E(PXCEDATE,1,18)_$J("",(19-$L(PXCEDATE)))
"RTN","PXCEPAT",54,0)
 .. I $P(PXCEVSIT,"^",7)="E" D
"RTN","PXCEPAT",55,0)
 ... S PXCELOC="  Historical Encounter at "
"RTN","PXCEPAT",56,0)
 ... I $P(PXCEVSIT,"^",6)]"" D
"RTN","PXCEPAT",57,0)
 .... N PXCEDELF
"RTN","PXCEPAT",58,0)
 .... S PXCESTAT=$E($$EXTERNAL^DILFD(9000010,.06,"",$P(PXCEVSIT,"^",6),"PXCEDILF"),1,30)
"RTN","PXCEPAT",59,0)
 ... E  S PXCESTAT=$E($P($G(^AUPNVSIT(PXCEIEN,21)),"^"),1,30)
"RTN","PXCEPAT",60,0)
 .. E  D
"RTN","PXCEPAT",61,0)
 ... S PXCELOC=$S($P(PXCEVSIT,"^",22)>0:$P(^SC($P(PXCEVSIT,"^",22),0),"^"),$P(PXCEVSIT,"^",7)="E":"   Historical",1:"")
"RTN","PXCEPAT",62,0)
 ... S PXCELOC=$E(PXCELOC,1,26)_$J("",(28-$L(PXCELOC)))
"RTN","PXCEPAT",63,0)
 ... S PXCESTAT=$P($$STATUS^SDPCE(PXCEIEN),"^",2)
"RTN","PXCEPAT",64,0)
 .. S ^TMP("PXCE",$J,VALMCNT,0)=$J(VALMCNT,4)_" "_PXCEDATE_PXCELOC_PXCESTAT
"RTN","PXCEPAT",65,0)
 .. S ^TMP("PXCEIDX",$J,VALMCNT)=PXCEIEN
"RTN","PXCEPAT",66,0)
 S ^TMP("PXCEIDX",$J,0)=VALMCNT
"RTN","PXCEPAT",67,0)
 I VALMCNT'>0 D
"RTN","PXCEPAT",68,0)
 . S ^TMP("PXCE",$J,1,0)=" "
"RTN","PXCEPAT",69,0)
 . S ^TMP("PXCE",$J,2,0)="    No encounter found that satisfy the above criteria."
"RTN","PXCEPAT",70,0)
 . S VALMCNT=2
"RTN","PXCEPAT",71,0)
 Q
"RTN","PXCEPAT",72,0)
 ;
"RTN","PXCEPAT",73,0)
SDSALONE ;Get the patient for standalone from the appointment/hospital
"RTN","PXCEPAT",74,0)
 ;location screen
"RTN","PXCEPAT",75,0)
 Q:$G(PXCEPAT)>0
"RTN","PXCEPAT",76,0)
 D PATIENT(.PXCEPAT)
"RTN","PXCEPAT",77,0)
 I PXCEPAT>0 D PATINFO(.PXCEPAT) S PXCEJPAT=1
"RTN","PXCEPAT",78,0)
 Q
"RTN","PXCEPAT",79,0)
 ;
"RTN","PXCEPAT",80,0)
SDKALONE ;Kill the patient info if it was created above
"RTN","PXCEPAT",81,0)
 Q:'$D(PXCEJPAT)
"RTN","PXCEPAT",82,0)
 D PATKILL
"RTN","PXCEPAT",83,0)
 K PXCEJPAT
"RTN","PXCEPAT",84,0)
 Q
"RTN","PXCEPAT",85,0)
 ;
"RTN","PXCEPAT",86,0)
JUSTDFN ;Just set DFN for other packages.
"RTN","PXCEPAT",87,0)
 Q
"RTN","PXCEPAT",88,0)
 Q:$G(DFN)>0
"RTN","PXCEPAT",89,0)
 N X,Y,DIC,DA
"RTN","PXCEPAT",90,0)
 S DIC=2,DIC(0)="AEMQ"
"RTN","PXCEPAT",91,0)
 D ^DIC
"RTN","PXCEPAT",92,0)
 I +Y>0 S DFN=+Y,PXCEJDFN=1
"RTN","PXCEPAT",93,0)
 Q
"RTN","PXCEPAT",94,0)
 ;
"RTN","PXCEPAT",95,0)
JUSTDFNK ;Kill DFN if it was set above
"RTN","PXCEPAT",96,0)
 I $G(PXCEJDFN) K DFN,PXCEJDFN
"RTN","PXCEPAT",97,0)
 I $G(PXCEPAT)>0 S DFN=PXCEPAT
"RTN","PXCEPAT",98,0)
 Q
"RTN","PXCEPAT",99,0)
 ;
"RTN","PXCEPAT",100,0)
PATIENT(PXCEDATA) ; Select a patient
"RTN","PXCEPAT",101,0)
 N X,Y,DIC,DA,DFN
"RTN","PXCEPAT",102,0)
 D FULL^VALM1
"RTN","PXCEPAT",103,0)
 S DIC=2,DIC(0)="AEMQ" D ^DIC
"RTN","PXCEPAT",104,0)
 S PXCEDATA=+Y
"RTN","PXCEPAT",105,0)
PAT1 S %=1 W !,"   ...OK" D YN^DICN I %=0 W "   Answer With 'Yes' or 'No'" G PAT1
"RTN","PXCEPAT",106,0)
 I %'=1!$D(DIRUT) S (Y,PXCEDATA)=-1
"RTN","PXCEPAT",107,0)
 I +Y>0 S DFN=+Y D 2^VADPT I +VADM(6) D  S:$D(DIRUT) PXCEDATA=-1
"RTN","PXCEPAT",108,0)
 . K DIR S DIR(0)="E",DIR("A")="Enter RETURN to continue or '^' to exit"
"RTN","PXCEPAT",109,0)
 . S DIR("A",1)="WARNING "_VADM(7) D ^DIR
"RTN","PXCEPAT",110,0)
 Q
"RTN","PXCEPAT",111,0)
 ;
"RTN","PXCEPAT",112,0)
PATINFO(PXCEDATA) ;
"RTN","PXCEPAT",113,0)
 Q:$G(PXCEDATA)'>0
"RTN","PXCEPAT",114,0)
 S (DFN,SDFN,ORVP)=PXCEDATA
"RTN","PXCEPAT",115,0)
 D:$G(PXCECAT)="SIT"!($G(PXCECAT)="HIST")!($G(PXCECAT)="AEP")!$G(FSEL) DTHINFO
"RTN","PXCEPAT",116,0)
 I $D(DIRUT),$G(FSEL) D PATKILL Q
"RTN","PXCEPAT",117,0)
 ;D 2^VADPT I +VADM(6) D  K DIR I $D(DIRUT) D:$G(PXCECAT)'="SIT"&($G(PXCECAT)'="HIST")&($G(PXCECAT)'="AEP") PATKILL Q
"RTN","PXCEPAT",118,0)
 ;. S DIR(0)="E",DIR("A")="Enter RETURN to continue or '^' to Quit"
"RTN","PXCEPAT",119,0)
 ;. S DIR("A",2)="WARNING "_VADM(7),DIR("A",1)=" ",DIR("A",3)=" " D ^DIR
"RTN","PXCEPAT",120,0)
 N Y
"RTN","PXCEPAT",121,0)
 S Y=PXCEDATA
"RTN","PXCEPAT",122,0)
 ;Set IHS patient variables
"RTN","PXCEPAT",123,0)
 D START^AUPNPAT
"RTN","PXCEPAT",124,0)
 D PATNAME(.PXCEDATA)
"RTN","PXCEPAT",125,0)
 N VAERR,VAROOT,PXCEVA,PXCEINDX
"RTN","PXCEPAT",126,0)
 S VAROOT="PXCEVA"
"RTN","PXCEPAT",127,0)
 D ELIG^VADPT
"RTN","PXCEPAT",128,0)
 S PXCEDATA("ELIG")=$P($G(PXCEVA(1)),"^",1,99)
"RTN","PXCEPAT",129,0)
 S PXCEINDX=""
"RTN","PXCEPAT",130,0)
 F  S PXCEINDX=$O(PXCEVA(1,PXCEINDX)) Q:'PXCEINDX  S PXCEDATA("ELIG",PXCEINDX)=$P(PXCEVA(1,PXCEINDX),"^",1,99)
"RTN","PXCEPAT",131,0)
 Q
"RTN","PXCEPAT",132,0)
 ;
"RTN","PXCEPAT",133,0)
DTHINFO ;DEATH WARNING
"RTN","PXCEPAT",134,0)
 D 2^VADPT K DIR I +VADM(6) D  K DIR
"RTN","PXCEPAT",135,0)
 . S DIR(0)="E",DIR("A")="Enter RETURN to continue or '^' to Quit"
"RTN","PXCEPAT",136,0)
 . S DIR("A",2)="WARNING "_VADM(7),DIR("A",1)=" ",DIR("A",3)=" " D ^DIR
"RTN","PXCEPAT",137,0)
 Q
"RTN","PXCEPAT",138,0)
PATNAME(PXCEDATA) ;
"RTN","PXCEPAT",139,0)
 S PXCEDATA("NAME")=$P($G(^DPT(+PXCEDATA,0)),"^",1)
"RTN","PXCEPAT",140,0)
 N VAPTYP,VA,VAERR,DFN
"RTN","PXCEPAT",141,0)
 S DFN=+PXCEDATA
"RTN","PXCEPAT",142,0)
 D PID^VADPT6
"RTN","PXCEPAT",143,0)
 I 'VAERR S PXCEDATA("SSN")=VA("PID"),PXCEDATA("SSN_BRIEF")=VA("BID")
"RTN","PXCEPAT",144,0)
 E  S (PXCEDATA("SSN"),PXCEDATA("SSN_BRIEF"))=""
"RTN","PXCEPAT",145,0)
 Q
"RTN","PXCEPAT",146,0)
 ;
"RTN","PXCEPAT",147,0)
PATKILL ;
"RTN","PXCEPAT",148,0)
 K PXCEPAT,DFN,SDFN,ORVP
"RTN","PXCEPAT",149,0)
 ; Kill IHS patient variables
"RTN","PXCEPAT",150,0)
 D KILL^AUPNPAT
"RTN","PXCEPAT",151,0)
 Q
"RTN","PXCEPAT",152,0)
 ;
"RTN","PXCEPAT",153,0)
APPOINT(DFN,DATETIME,HOSLOC) ;See if there is an appointment.
"RTN","PXCEPAT",154,0)
 ;Input:
"RTN","PXCEPAT",155,0)
 ;  DFN       ien of the patient
"RTN","PXCEPAT",156,0)
 ;  DATETIME  the date and time of the appointment
"RTN","PXCEPAT",157,0)
 ;  HOSLOC    optional, is the Hospital Location (#44)
"RTN","PXCEPAT",158,0)
 ;Returns the clinic ien or -1 if no appointement.
"RTN","PXCEPAT",159,0)
 ;
"RTN","PXCEPAT",160,0)
 N VASD,HL,INDEX,VAERR
"RTN","PXCEPAT",161,0)
 K ^UTILITY("VASD",$J)
"RTN","PXCEPAT",162,0)
 S VASD("T")=DATETIME
"RTN","PXCEPAT",163,0)
 S VASD("F")=DATETIME-.00000001
"RTN","PXCEPAT",164,0)
 S VASD("W")=129 ;1)Active/Kept 2)Inpatient appts. only 9)No action taken
"RTN","PXCEPAT",165,0)
 S:$G(HOSLOC) VASD("C",HOSLOC)=""
"RTN","PXCEPAT",166,0)
 D SDA^VADPT
"RTN","PXCEPAT",167,0)
 I VAERR S HL=-1 G QAPPOINT
"RTN","PXCEPAT",168,0)
 S INDEX=$O(^UTILITY("VASD",$J,0))
"RTN","PXCEPAT",169,0)
 I INDEX>0 S HL=$P(^UTILITY("VASD",$J,INDEX,"I"),"^",2)
"RTN","PXCEPAT",170,0)
 E  S HL=-1
"RTN","PXCEPAT",171,0)
QAPPOINT K ^UTILITY("VASD",$J)
"RTN","PXCEPAT",172,0)
 Q HL
"RTN","PXCEPAT",173,0)
 ;
"VER")
8.0^22.0
"BLD",6041,6)
^SEQ #123
**END**
**END**
