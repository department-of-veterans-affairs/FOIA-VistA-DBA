Released PRC*5.1*74 SEQ #64
Extracted from mail message
**KIDS**:PRC*5.1*74^

**INSTALL NAME**
PRC*5.1*74
"BLD",3912,0)
PRC*5.1*74^IFCAP^0^3040406^y
"BLD",3912,1,0)
^^6^6^3040326^^^^
"BLD",3912,1,1,0)
This patch will ensure that the "D" cross reference for the PROCUREMENT
"BLD",3912,1,2,0)
& ACCOUNTING TRANSACTIONS file (#442) gets updated when amending a P.O.
"BLD",3912,1,3,0)
with multiple edits.
"BLD",3912,1,4,0)

"BLD",3912,1,5,0)
There is also a Post-Install routine that removes a non-namespaced
"BLD",3912,1,6,0)
global introduced by PRC*5.1*76.  The name of the global is ^NIXON.
"BLD",3912,4,0)
^9.64PA^^
"BLD",3912,"INID")
y^y
"BLD",3912,"INIT")
START^PRC5174
"BLD",3912,"KRN",0)
^9.67PA^8989.52^19
"BLD",3912,"KRN",.4,0)
.4
"BLD",3912,"KRN",.401,0)
.401
"BLD",3912,"KRN",.402,0)
.402
"BLD",3912,"KRN",.403,0)
.403
"BLD",3912,"KRN",.5,0)
.5
"BLD",3912,"KRN",.84,0)
.84
"BLD",3912,"KRN",3.6,0)
3.6
"BLD",3912,"KRN",3.8,0)
3.8
"BLD",3912,"KRN",9.2,0)
9.2
"BLD",3912,"KRN",9.8,0)
9.8
"BLD",3912,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",3912,"KRN",9.8,"NM",1,0)
PRCHAMYA^^0^B42592874
"BLD",3912,"KRN",9.8,"NM",2,0)
PRCHDP8^^0^B21560805
"BLD",3912,"KRN",9.8,"NM",3,0)
PRCB1A3^^0^B19207496
"BLD",3912,"KRN",9.8,"NM","B","PRCB1A3",3)

"BLD",3912,"KRN",9.8,"NM","B","PRCHAMYA",1)

"BLD",3912,"KRN",9.8,"NM","B","PRCHDP8",2)

"BLD",3912,"KRN",19,0)
19
"BLD",3912,"KRN",19.1,0)
19.1
"BLD",3912,"KRN",101,0)
101
"BLD",3912,"KRN",409.61,0)
409.61
"BLD",3912,"KRN",771,0)
771
"BLD",3912,"KRN",870,0)
870
"BLD",3912,"KRN",8989.51,0)
8989.51
"BLD",3912,"KRN",8989.52,0)
8989.52
"BLD",3912,"KRN",8994,0)
8994
"BLD",3912,"KRN","B",.4,.4)

"BLD",3912,"KRN","B",.401,.401)

"BLD",3912,"KRN","B",.402,.402)

"BLD",3912,"KRN","B",.403,.403)

"BLD",3912,"KRN","B",.5,.5)

"BLD",3912,"KRN","B",.84,.84)

"BLD",3912,"KRN","B",3.6,3.6)

"BLD",3912,"KRN","B",3.8,3.8)

"BLD",3912,"KRN","B",9.2,9.2)

"BLD",3912,"KRN","B",9.8,9.8)

"BLD",3912,"KRN","B",19,19)

"BLD",3912,"KRN","B",19.1,19.1)

"BLD",3912,"KRN","B",101,101)

"BLD",3912,"KRN","B",409.61,409.61)

"BLD",3912,"KRN","B",771,771)

"BLD",3912,"KRN","B",870,870)

"BLD",3912,"KRN","B",8989.51,8989.51)

"BLD",3912,"KRN","B",8989.52,8989.52)

"BLD",3912,"KRN","B",8994,8994)

"BLD",3912,"PRE")
PRC5174
"BLD",3912,"QUES",0)
^9.62^^
"BLD",3912,"REQB",0)
^9.611^2^2
"BLD",3912,"REQB",1,0)
PRC*5.1*59^1
"BLD",3912,"REQB",2,0)
PRC*5.1*76^1
"BLD",3912,"REQB","B","PRC*5.1*59",1)

"BLD",3912,"REQB","B","PRC*5.1*76",2)

"INIT")
START^PRC5174
"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
74^3040406
"PKG",455,22,1,"PAH",1,1,0)
^^6^6^3040406
"PKG",455,22,1,"PAH",1,1,1,0)
This patch will ensure that the "D" cross reference for the PROCUREMENT
"PKG",455,22,1,"PAH",1,1,2,0)
& ACCOUNTING TRANSACTIONS file (#442) gets updated when amending a P.O.
"PKG",455,22,1,"PAH",1,1,3,0)
with multiple edits.
"PKG",455,22,1,"PAH",1,1,4,0)

"PKG",455,22,1,"PAH",1,1,5,0)
There is also a Post-Install routine that removes a non-namespaced
"PKG",455,22,1,"PAH",1,1,6,0)
global introduced by PRC*5.1*76.  The name of the global is ^NIXON.
"PRE")
PRC5174
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PRC5174")
0^^B2213253
"RTN","PRC5174",1,0)
PRC5174 ;WISC/TN-IFCAP Post init routine for PRC*5.1*74 ;03/26/04
"RTN","PRC5174",2,0)
 ;;5.1;IFCAP;**74**;Oct 20, 2000
"RTN","PRC5174",3,0)
 ;---------------------------------------------------------
"RTN","PRC5174",4,0)
 ;This post-install routine removes a non-namespaced global
"RTN","PRC5174",5,0)
 ;introduced by PRC*5.1*76
"RTN","PRC5174",6,0)
 ;
"RTN","PRC5174",7,0)
 ;There is also an environmental check for CoreFLS
"RTN","PRC5174",8,0)
 ;---------------------------------------------------------
"RTN","PRC5174",9,0)
 N X S X="PRCLOP4" X ^%ZOSF("TEST")
"RTN","PRC5174",10,0)
 I $T,$$SYS^PRCLOP4>0 D  S XPDQUIT=1 Q
"RTN","PRC5174",11,0)
 . N PRCT S PRCT(1)="IFCAP has been shut down, so no further IFCAP patches"
"RTN","PRC5174",12,0)
 . S PRCT(2)="  should be installed." D MES^XPDUTL(.PRCT)
"RTN","PRC5174",13,0)
 ;
"RTN","PRC5174",14,0)
 QUIT  ;End environmental check
"RTN","PRC5174",15,0)
 ;
"RTN","PRC5174",16,0)
 ;---------------------------------------------------------
"RTN","PRC5174",17,0)
START ;Remove a non-namespaced global introduced by PRC*5.1*76
"RTN","PRC5174",18,0)
 ;---------------------------------------------------------
"RTN","PRC5174",19,0)
 NEW TEXT,CNT
"RTN","PRC5174",20,0)
 ;
"RTN","PRC5174",21,0)
 S CNT=0
"RTN","PRC5174",22,0)
 S TEXT=">>> Checking for non-namespaced global ^NIXON"
"RTN","PRC5174",23,0)
 DO MES^XPDUTL(TEXT)
"RTN","PRC5174",24,0)
 ;
"RTN","PRC5174",25,0)
 I '$D(^NIXON) D  QUIT
"RTN","PRC5174",26,0)
 . S TEXT=">>> Global ^NIXON does not exist on your system"
"RTN","PRC5174",27,0)
 . DO MES^XPDUTL(TEXT)
"RTN","PRC5174",28,0)
 . DO BMES^XPDUTL(">>> ALL DONE!")
"RTN","PRC5174",29,0)
 ;
"RTN","PRC5174",30,0)
 F  S CNT=$O(^NIXON(CNT)) Q:'CNT  KILL ^NIXON(CNT)
"RTN","PRC5174",31,0)
 ;
"RTN","PRC5174",32,0)
 S TEXT=">>> Global ^NIXON has been removed from your system"
"RTN","PRC5174",33,0)
 DO MES^XPDUTL(TEXT)
"RTN","PRC5174",34,0)
 DO BMES^XPDUTL(">>> ALL DONE!")
"RTN","PRC5174",35,0)
 ;
"RTN","PRC5174",36,0)
 QUIT
"RTN","PRCB1A3")
0^3^B19207496
"RTN","PRCB1A3",1,0)
PRCB1A3 ;WIOFO/DWA - CONTROL POINT LISTING W/COST CENTERS ;3/3/04 03:04 AM
"RTN","PRCB1A3",2,0)
 ;;5.1;IFCAP;**76,74**;Oct 20, 2000
"RTN","PRCB1A3",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCB1A3",4,0)
 Q  ;invalid entry
"RTN","PRCB1A3",5,0)
 ;
"RTN","PRCB1A3",6,0)
EN1 ; entry point for CONTROL POINT LISTING W/COST CENTERS
"RTN","PRCB1A3",7,0)
 N L,DIC,FLDS,BY,DHD
"RTN","PRCB1A3",8,0)
 S L=0,DIC="^PRC(420,",FLDS="[PRCB CTRLPT]",BY=".01,1,1"
"RTN","PRCB1A3",9,0)
 ;S DIS(0)="I $P(^PRC(420,D0,1,D1,0),""^"",19)'=1"
"RTN","PRCB1A3",10,0)
 S DHD="CONTROL POINT LISTING W/ COST CENTERS          PRINTED BY: "_$$USER^PRCPUREP(DUZ)
"RTN","PRCB1A3",11,0)
 D EN1^DIP
"RTN","PRCB1A3",12,0)
 Q
"RTN","PRCB1A3",13,0)
 ;
"RTN","PRCB1A3",14,0)
EN2 ; entry point for CONTROL POINT LISTING W/COST CENTER EXCEPTIONS
"RTN","PRCB1A3",15,0)
 N STN,CP,CC,ACC,ACT,FUND,CPNAME,I,PAGE,LNCT,TODAY,EXC,CNT,RECORD
"RTN","PRCB1A3",16,0)
 N CP1,CP2,FUND1,L,LN,LN1,SCREEN,DEV,ABORT,FLG,STN1,%ZIS,ZTDESC
"RTN","PRCB1A3",17,0)
 N ZTRTN,ZTSAVE,X,Y,PAGE1
"RTN","PRCB1A3",18,0)
 D NOW^%DTC S Y=% D DD^%DT S TODAY=Y KILL ^XTMP($J)
"RTN","PRCB1A3",19,0)
 S (STN,CP,CC,ACC,ACT,FUND)=0,DEV=$J
"RTN","PRCB1A3",20,0)
 F  S STN=$O(^PRC(420,STN)) Q:'STN  D
"RTN","PRCB1A3",21,0)
 . S CP=0 F  S CP=$O(^PRC(420,STN,1,CP)) Q:'CP!(CP=9999)  D
"RTN","PRCB1A3",22,0)
 . . S RECORD=$G(^PRC(420,STN,1,CP,0)) I RECORD="" Q
"RTN","PRCB1A3",23,0)
 . . S FUND=$P(RECORD,"^",2) I 'FUND Q
"RTN","PRCB1A3",24,0)
 . . S FUND=$P($G(^PRCD(420.3,FUND,0)),"^")
"RTN","PRCB1A3",25,0)
 . . I (".0160.0162.0152.")'[("."_$E(FUND,1,4)_".") Q
"RTN","PRCB1A3",26,0)
 . . S CPNAME=$P(RECORD,"^")                ; format, nnn(n) xxxxx xxxx
"RTN","PRCB1A3",27,0)
 . . S ACT=$P(RECORD,"^",19)                ; 1=inactive
"RTN","PRCB1A3",28,0)
 . . S ACC=$P($G(^PRC(420,STN,1,CP,5)),"^",3)   ; pointer to ^PRCD(420.131,
"RTN","PRCB1A3",29,0)
 . . S:'ACC ACC="NONE" D
"RTN","PRCB1A3",30,0)
 . . . S:ACC'="NONE" ACC=$P($G(^PRCD(420.131,ACC,0)),"^")
"RTN","PRCB1A3",31,0)
 . . . Q
"RTN","PRCB1A3",32,0)
 . . S (CC,I)=0 F  S CC=$O(^PRC(420,STN,1,CP,2,CC)) Q:'CC  D
"RTN","PRCB1A3",33,0)
 . . . D PROCESS
"RTN","PRCB1A3",34,0)
 . . . I 'EXC Q
"RTN","PRCB1A3",35,0)
 . . . S I=$G(I)+1
"RTN","PRCB1A3",36,0)
 . . . S ^XTMP($J,"PRCCPE",STN,FUND,CP,I)=ACT_"^"_CPNAME_"^"_CC_"^"_ACC
"RTN","PRCB1A3",37,0)
 . . . Q
"RTN","PRCB1A3",38,0)
 . . Q
"RTN","PRCB1A3",39,0)
 . Q
"RTN","PRCB1A3",40,0)
 ;
"RTN","PRCB1A3",41,0)
 S %ZIS="Q"
"RTN","PRCB1A3",42,0)
 D ^%ZIS Q:POP
"RTN","PRCB1A3",43,0)
 I $D(IO("Q")) D  Q
"RTN","PRCB1A3",44,0)
 . S ZTRTN="QUEUE^PRCB1A3"
"RTN","PRCB1A3",45,0)
 . S ZTDESC="CONTROL POINT LISTING W/EXCEPTIONS"
"RTN","PRCB1A3",46,0)
 . S ZTSAVE("TODAY")=""
"RTN","PRCB1A3",47,0)
 . S ZTSAVE("DUZ")=""
"RTN","PRCB1A3",48,0)
 . S ZTSAVE("DEV")=""
"RTN","PRCB1A3",49,0)
 . D ^%ZTLOAD
"RTN","PRCB1A3",50,0)
 . D HOME^%ZIS
"RTN","PRCB1A3",51,0)
 . KILL ZTST,IO("Q")
"RTN","PRCB1A3",52,0)
 ;
"RTN","PRCB1A3",53,0)
QUEUE U IO
"RTN","PRCB1A3",54,0)
 S (ABORT,PAGE,PAGE1,SCREEN)=0,LN1=45
"RTN","PRCB1A3",55,0)
 I $E(IOST,1,2)="C-" S SCREEN=1
"RTN","PRCB1A3",56,0)
 I SCREEN S LN1=17
"RTN","PRCB1A3",57,0)
 D HDR
"RTN","PRCB1A3",58,0)
 I SCREEN,IOSL>24 S PAGE1=1
"RTN","PRCB1A3",59,0)
 ;
"RTN","PRCB1A3",60,0)
 S (STN,STN1,CP,CC,ACC,ACT,FUND,FLG)=0
"RTN","PRCB1A3",61,0)
 S (CP1,CP2,FUND1)=""
"RTN","PRCB1A3",62,0)
 F  S STN=$O(^XTMP(DEV,"PRCCPE",STN)) Q:'STN  Q:ABORT  D
"RTN","PRCB1A3",63,0)
 . S FUND=0
"RTN","PRCB1A3",64,0)
 . F  S FUND=$O(^XTMP(DEV,"PRCCPE",STN,FUND)) Q:'FUND  Q:ABORT  D
"RTN","PRCB1A3",65,0)
 . . S CP=0
"RTN","PRCB1A3",66,0)
 . . F  S CP=$O(^XTMP(DEV,"PRCCPE",STN,FUND,CP)) Q:'CP  Q:ABORT  D
"RTN","PRCB1A3",67,0)
 . . . S CNT=0
"RTN","PRCB1A3",68,0)
 . . . F  S CNT=$O(^XTMP(DEV,"PRCCPE",STN,FUND,CP,CNT)) Q:'CNT  Q:ABORT  D
"RTN","PRCB1A3",69,0)
 . . . . S RECORD=^XTMP(DEV,"PRCCPE",STN,FUND,CP,CNT)
"RTN","PRCB1A3",70,0)
 . . . . S STATUS=$P(RECORD,U)
"RTN","PRCB1A3",71,0)
 . . . . I STATUS=0 S STATUS="(ACTIVE)"
"RTN","PRCB1A3",72,0)
 . . . . I STATUS=1 S STATUS="(INACTIVE)"
"RTN","PRCB1A3",73,0)
 . . . . S CP1=$E($P(RECORD,U,2),1,20)
"RTN","PRCB1A3",74,0)
 . . . . S CC=$P(RECORD,U,3)
"RTN","PRCB1A3",75,0)
 . . . . S CC=$G(^PRCD(420.1,CC,0))
"RTN","PRCB1A3",76,0)
 . . . . S CC=$E($P(CC,U),1,45)
"RTN","PRCB1A3",77,0)
 . . . . S ACC=$P(RECORD,U,4)
"RTN","PRCB1A3",78,0)
 . . . . I STN'=STN1 S FUND1=FUND W !!,STN,?6,FUND S LN=LN+1
"RTN","PRCB1A3",79,0)
 . . . . I FUND'=FUND1 S CP2=CP1 W !!,?7,FUND,!,?9,CP1," ",STATUS S LN=LN+1
"RTN","PRCB1A3",80,0)
 . . . . I CP1'=CP2 W !!,?9,CP1," ",STATUS S LN=LN+1
"RTN","PRCB1A3",81,0)
 . . . . W !,?13,CC,?60,ACC S LN=LN+1
"RTN","PRCB1A3",82,0)
 . . . . I STN'=STN1 S STN1=STN
"RTN","PRCB1A3",83,0)
 . . . . I FUND'=FUND1 S FUND1=FUND
"RTN","PRCB1A3",84,0)
 . . . . I CP1'=CP2 S CP2=CP1
"RTN","PRCB1A3",85,0)
 . . . . I LN>LN1 D HDR:'PAGE1 Q:ABORT 
"RTN","PRCB1A3",86,0)
 ;
"RTN","PRCB1A3",87,0)
 I 'ABORT W !!,"<End of Report>" R:SCREEN X:100
"RTN","PRCB1A3",88,0)
 D ^%ZISC
"RTN","PRCB1A3",89,0)
 Q
"RTN","PRCB1A3",90,0)
 ;
"RTN","PRCB1A3",91,0)
 ;--------------------------------------------------------------------
"RTN","PRCB1A3",92,0)
PROCESS ; determine if exception exists
"RTN","PRCB1A3",93,0)
 S EXC=0
"RTN","PRCB1A3",94,0)
 ;
"RTN","PRCB1A3",95,0)
 I $E(FUND,1,4)="0160" D
"RTN","PRCB1A3",96,0)
 . I CC<820100 S EXC=1
"RTN","PRCB1A3",97,0)
 . I CC>836400,CC<860100 S EXC=1
"RTN","PRCB1A3",98,0)
 . I CC>860300,CC<875000 S EXC=1
"RTN","PRCB1A3",99,0)
 . I CC>875200,CC<895900 S EXC=1
"RTN","PRCB1A3",100,0)
 . I CC>895900,CC<899100 S EXC=1
"RTN","PRCB1A3",101,0)
 . I CC>899600 S EXC=1
"RTN","PRCB1A3",102,0)
 . I CC=824300 S EXC=1
"RTN","PRCB1A3",103,0)
 . Q
"RTN","PRCB1A3",104,0)
 ;
"RTN","PRCB1A3",105,0)
 I $E(FUND,1,4)="0152" D
"RTN","PRCB1A3",106,0)
 . I CC<800100 S EXC=1
"RTN","PRCB1A3",107,0)
 . I CC>808300,CC<840100 S EXC=1
"RTN","PRCB1A3",108,0)
 . I CC>847000,CC<860500 S EXC=1
"RTN","PRCB1A3",109,0)
 . I CC>861700,CC<864900 S EXC=1
"RTN","PRCB1A3",110,0)
 . I CC>866000,CC<895000 S EXC=1
"RTN","PRCB1A3",111,0)
 . I CC>895900 S EXC=1
"RTN","PRCB1A3",112,0)
 . I CC=863100 S EXC=0
"RTN","PRCB1A3",113,0)
 . Q
"RTN","PRCB1A3",114,0)
 ;
"RTN","PRCB1A3",115,0)
 I $E(FUND,1,4)="0162" D
"RTN","PRCB1A3",116,0)
 . I CC<850100 S EXC=1
"RTN","PRCB1A3",117,0)
 . I CC>857500,CC<860400 S EXC=1
"RTN","PRCB1A3",118,0)
 . I CC>860400,CC<862100 S EXC=1
"RTN","PRCB1A3",119,0)
 . I CC>862300 S EXC=1
"RTN","PRCB1A3",120,0)
 . I CC=824300 S EXC=0
"RTN","PRCB1A3",121,0)
 . Q
"RTN","PRCB1A3",122,0)
 ;
"RTN","PRCB1A3",123,0)
 Q
"RTN","PRCB1A3",124,0)
 ;
"RTN","PRCB1A3",125,0)
 ;--------------------------------------------------------------
"RTN","PRCB1A3",126,0)
HDR ;PRINT THE HEADER
"RTN","PRCB1A3",127,0)
 I SCREEN,PAGE R !!,"Hit <RETURN> to continue, '^' to Exit ",X:100
"RTN","PRCB1A3",128,0)
 ;
"RTN","PRCB1A3",129,0)
 I SCREEN,X["^" S ABORT=1 Q
"RTN","PRCB1A3",130,0)
 ;
"RTN","PRCB1A3",131,0)
 S PAGE=$G(PAGE)+1
"RTN","PRCB1A3",132,0)
 W #
"RTN","PRCB1A3",133,0)
 W "CONTROL POINT LISTING W/EXCEPTIONS          "
"RTN","PRCB1A3",134,0)
 W "PRINTED BY: "_$$USER^PRCPUREP(DUZ)
"RTN","PRCB1A3",135,0)
 W !,"                                            "_TODAY
"RTN","PRCB1A3",136,0)
 W "     PAGE ",PAGE
"RTN","PRCB1A3",137,0)
 W !!,"STA#  FUND"
"RTN","PRCB1A3",138,0)
 W !,"         CONTROL POINT                                      ACC"
"RTN","PRCB1A3",139,0)
 W !,"             COST CENTER"
"RTN","PRCB1A3",140,0)
 W ! F L=1:1:80 W "-"
"RTN","PRCB1A3",141,0)
 S LN=8
"RTN","PRCB1A3",142,0)
 Q
"RTN","PRCHAMYA")
0^1^B42592874
"RTN","PRCHAMYA",1,0)
PRCHAMYA ;WISC/DJM-MOVING AMENDMENT INFO FROM 443.6 TO 442 ;3/23/95  2:01 PM
"RTN","PRCHAMYA",2,0)
V ;;5.1;IFCAP;**6,21,59,74**;Oct 20, 2000
"RTN","PRCHAMYA",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHAMYA",4,0)
CHECK(PRCHPO,PRCHAM,FLAG) ;CHECK OUT EACH 'CHANGES' ENTRY.  IF THE OLD DATA AND THE NEW DATA
"RTN","PRCHAMYA",5,0)
 ;ARE THE SAME REMOVE THE 'CHANGES' ENTRY.
"RTN","PRCHAMYA",6,0)
 ;'PRCHPO' IS THE RECORD IN FILE 443.6 THAT WAS JUST OBLIGATED.
"RTN","PRCHAMYA",7,0)
 ;'PRCHAM' IS THE AMENDMENT ,IN 'PRCHPO', THAT WAS JUST OBLIGATED.
"RTN","PRCHAMYA",8,0)
 ;'FLAG' IS AN ERROR FLAG.  FOR NOW 'FLAG' WILL ONLY RETURN 1.
"RTN","PRCHAMYA",9,0)
 N PRCI,CERT,CHANGS,PRCI,DIQ,DIC,PRCJ,J1,J2,J3,J4,DR,VAL,DIE,FX,PRCHTOTQ,PRCHXXXX,%X,%Y,HOLD,NEW,PRCSUM,PRCSIG,ROUTINE,ITEM,DISCNT,PROMPT,DIR,CHECK,DA,FIELD,FLAG,PRCJ1,PRCJ2,VAL1,EXIT,DIWL,DIWR,DIWF,TYPAM,VALFLG,PPFLG,LINE,ITEM1
"RTN","PRCHAMYA",10,0)
 K PRCHNORE
"RTN","PRCHAMYA",11,0)
 S PRCI=0,DIQ(0)="I",VALFLG=0
"RTN","PRCHAMYA",12,0)
 ;LEAVE 'CHANGES' ENTRY 1 (THE ORGINAL VALUE OF THE 'NET AMOUNT' FIELD) ALONE.
"RTN","PRCHAMYA",13,0)
 ;THIS ENTRY MUST STAY IN THE 'CHANGES' MULTIPLE BECAUSE IT IS NEEDED
"RTN","PRCHAMYA",14,0)
 ;TO BE ABLE TO UPDATE THE FUND CONTROL POINT BALANCE AFTER THIS
"RTN","PRCHAMYA",15,0)
 ;AMENDMENT IS OBLIGATED/SIGNED OFF.
"RTN","PRCHAMYA",16,0)
 F  S PRCI=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,PRCI)) G:PRCI'>0 COPY S DA=PRCHPO,DIC=443.6 D:PRCI>1
"RTN","PRCHAMYA",17,0)
 .S PRCJ=$G(^PRC(443.6,PRCHPO,6,PRCHAM,3,PRCI,0))
"RTN","PRCHAMYA",18,0)
 .S J1=$P(PRCJ,U,3)
"RTN","PRCHAMYA",19,0)
 .S J2=$P(J1,":",2),J3=$P($P(J1,";",2),":"),J4=$P(J1,";")
"RTN","PRCHAMYA",20,0)
 .Q:$P(J3,".")=442
"RTN","PRCHAMYA",21,0)
 .K DR
"RTN","PRCHAMYA",22,0)
 .I J2>0 S DR=J2,DR(J3)=J4,DA(J3)=$P(PRCJ,U,4)
"RTN","PRCHAMYA",23,0)
 .I J2="" S DR=J4
"RTN","PRCHAMYA",24,0)
 .I $P(PRCJ,U,7)>0 S DIC=J3,DA=$P(PRCJ,U,7)
"RTN","PRCHAMYA",25,0)
 .S DIQ="FIELD" D EN^DIQ1
"RTN","PRCHAMYA",26,0)
 .I J2=40,J4=1 K ^UTILITY($J,"W"),^TMP($J,"W") S EXIT=0,VAL1=0,DIWL=1,DIWR=80,DIWF="C80|",PRCJ1=$P(PRCJ,U,4),PRCJ1(PRCJ1)="" D  G FIX:EXIT=1,REMOVE
"RTN","PRCHAMYA",27,0)
 ..F  S VAL1=$O(FIELD(443.61,PRCJ1,1,VAL1)) Q:VAL1'>0  S X=$G(FIELD(443.61,PRCJ1,1,VAL1)) D ^DIWP
"RTN","PRCHAMYA",28,0)
 ..S %X="^UTILITY($J,""W"",",%Y="^TMP($J,""W""," D %XY^%RCR
"RTN","PRCHAMYA",29,0)
 ..S VAL1=0 K ^UTILITY($J,"W")
"RTN","PRCHAMYA",30,0)
 ..F  S VAL1=$O(^PRC(443.6,PRCHPO,6,PRCHAM,3,PRCI,1,VAL1)) Q:VAL1'>0  S X=(^(VAL1,0)) D ^DIWP
"RTN","PRCHAMYA",31,0)
 ..I ^TMP($J,"W",1)'=^UTILITY($J,"W",1) S EXIT=1 Q
"RTN","PRCHAMYA",32,0)
 ..S VAL1=0 F  S VAL1=$O(^TMP($J,"W",1,VAL1)) Q:VAL1'>0  I $G(^TMP($J,"W",1,VAL1,0))'=$G(^UTILITY($J,"W",1,VAL1,0)) S EXIT=1 Q
"RTN","PRCHAMYA",33,0)
 ..Q
"RTN","PRCHAMYA",34,0)
 .S VAL=$G(FIELD($S(J3>0:J3,1:443.6),$S(J3["443.6":$P(PRCJ,U,4),J3["441.7":$P(PRCJ,U,7),1:PRCHPO),J4,"I"))
"RTN","PRCHAMYA",35,0)
 .S CHECK=^PRC(443.6,PRCHPO,6,PRCHAM,3,PRCI,1,1,0)
"RTN","PRCHAMYA",36,0)
 .I CHECK'=VAL,VAL'="" D  G FIX
"RTN","PRCHAMYA",37,0)
 ..;
"RTN","PRCHAMYA",38,0)
 ..;Update contract changes (See MEM-0596-70183)
"RTN","PRCHAMYA",39,0)
 ..I $P($P(PRCJ,U,2,3),":")="23^4;443.61" D  ;
"RTN","PRCHAMYA",40,0)
 ...KILL ^PRC(442,PRCHPO,2,"AC",CHECK,$P(PRCJ,U,4))
"RTN","PRCHAMYA",41,0)
 ...S ^PRC(442,PRCHPO,2,"AC",VAL,$P(PRCJ,U,4))=""
"RTN","PRCHAMYA",42,0)
 .;
"RTN","PRCHAMYA",43,0)
 .I CHECK'=VAL,VAL="" S TYPAM=$P($G(PRCJ),U,2)
"RTN","PRCHAMYA",44,0)
 .S VALFLG=0
"RTN","PRCHAMYA",45,0)
 .S PPFLG=0
"RTN","PRCHAMYA",46,0)
 .I $G(TYPAM)=28,(VAL="") S VALFLG=1
"RTN","PRCHAMYA",47,0)
 .I $G(TYPAM)=33,(VAL="") S PPFLG=1
"RTN","PRCHAMYA",48,0)
 .I $G(TYPAM) I TYPAM=28!(TYPAM=29)!(TYPAM=37) G FIX
"RTN","PRCHAMYA",49,0)
REMOVE .S DR=".01///@",DIE="^PRC(443.6,"_PRCHPO_",6,"_PRCHAM_",3,",DA(2)=PRCHPO,DA(1)=PRCHAM,DA=PRCI D ^DIE Q
"RTN","PRCHAMYA",50,0)
FIX .S J3=$S(J3=443.61:442.01,J3=443.66:442.06,J3=443.67:442.07,J3=443.624:442.15,J3=443.63:442.03,J3=441.7:442.8,1:"")
"RTN","PRCHAMYA",51,0)
 .S FX=J4_";"_J3_":"_J2,$P(^PRC(443.6,PRCHPO,6,PRCHAM,3,PRCI,0),U,3)=FX
"RTN","PRCHAMYA",52,0)
COPY ;THIS STEP WILL COPY THE P.O. FROM 443.6 BACK TO 442.
"RTN","PRCHAMYA",53,0)
 ;FIRST GET THE PRESENT 'TOTAL AMOUNT' FIELD, #91.
"RTN","PRCHAMYA",54,0)
 ;THIS VALUE IS NEEDED TO CALCULATE THE AMOUNT CHANGED.  THIS CHANGE
"RTN","PRCHAMYA",55,0)
 ;WILL BE ENTERED INTO THE 'AMOUNT CHANGED' FIELD, FIELD 50 - SUBFIELD
"RTN","PRCHAMYA",56,0)
 ;2, FOR THIS AMENDMENT.
"RTN","PRCHAMYA",57,0)
 ;LATER ON, WITHIN THESE ROUTINES, THE 'TOTAL AMOUNT' FIELD WILL BE
"RTN","PRCHAMYA",58,0)
 ;UPDATED.  THUS, SAVING IT HERE.
"RTN","PRCHAMYA",59,0)
 S PRCHTOTQ=$P(^PRC(442,PRCHPO,0),U,15)
"RTN","PRCHAMYA",60,0)
 K PRCHXXXX S %X="^PRC(443.6,"_PRCHPO_",",%Y="^PRC(442,"_PRCHPO_","
"RTN","PRCHAMYA",61,0)
C2 ;ENTER HERE TO COPY NEW P.O. BACK INTO 442.  BOTH %X AND %Y NEED TO
"RTN","PRCHAMYA",62,0)
 ;BE SET WHEN USING THIS ENTRY POINT.  'PRCHPO' NEEDS TO BE SET TO THE
"RTN","PRCHAMYA",63,0)
 ;RECORD THAT IS TO BE COPIED.
"RTN","PRCHAMYA",64,0)
 I $G(VALFLG) K ^PRC(442,PRCHPO,15) S VALFLG=0
"RTN","PRCHAMYA",65,0)
 I $G(PPFLG) K ^PRC(442,PRCHPO,5) S PPFLG=0
"RTN","PRCHAMYA",66,0)
 ;
"RTN","PRCHAMYA",67,0)
 ;Delete current PO item description in file 442, so that it is
"RTN","PRCHAMYA",68,0)
 ;properly updated with an amended item description from file 443.6
"RTN","PRCHAMYA",69,0)
 ;See NOIS CTX-0296-70401 
"RTN","PRCHAMYA",70,0)
 I J2=40,J4=1 D  ;
"RTN","PRCHAMYA",71,0)
 . S ITEM1=""
"RTN","PRCHAMYA",72,0)
 . F  S ITEM1=$O(PRCJ1(ITEM1)) Q:'ITEM1  D  ;
"RTN","PRCHAMYA",73,0)
 . . S LINE=0 F  S LINE=$O(^PRC(442,PRCHPO,2,ITEM1,1,LINE)) Q:'LINE  D  ;
"RTN","PRCHAMYA",74,0)
 . . . I $D(^PRC(442,PRCHPO,2,ITEM1,1,LINE,0)) D  ;  
"RTN","PRCHAMYA",75,0)
 . . . . KILL ^PRC(442,PRCHPO,2,ITEM1,1,LINE,0)
"RTN","PRCHAMYA",76,0)
 ;
"RTN","PRCHAMYA",77,0)
 S HOLD=$G(^PRC(442,PRCHPO,6,0)) D %XY^%RCR
"RTN","PRCHAMYA",78,0)
 ;
"RTN","PRCHAMYA",79,0)
 ;The copy from 443.6 to 442 is done.  If an item does not have a
"RTN","PRCHAMYA",80,0)
 ;contract number, but it has an AC cross reference then remove it.
"RTN","PRCHAMYA",81,0)
 ;See NOIS: MEM-0596-70183
"RTN","PRCHAMYA",82,0)
 I $D(^PRC(442,PRCHPO,2,"AC")) D  ;
"RTN","PRCHAMYA",83,0)
 . NEW CONTRACT
"RTN","PRCHAMYA",84,0)
 . S CONTRACT=""
"RTN","PRCHAMYA",85,0)
 . F  S CONTRACT=$O(^PRC(442,PRCHPO,2,"AC",CONTRACT)) Q:CONTRACT=""  D
"RTN","PRCHAMYA",86,0)
 . . I '$D(^PRC(443.6,PRCHPO,2,"AC",CONTRACT)) D
"RTN","PRCHAMYA",87,0)
 . . . KILL ^PRC(442,PRCHPO,2,"AC",CONTRACT)
"RTN","PRCHAMYA",88,0)
 ;
"RTN","PRCHAMYA",89,0)
 ;There has been a change in vendor.  Update the files.
"RTN","PRCHAMYA",90,0)
 ;See NOIS FGH-1202-32075
"RTN","PRCHAMYA",91,0)
 N NEWVEN,OLDVEN,NODE,AMEND
"RTN","PRCHAMYA",92,0)
 S NEWVEN=$G(FIELD(443.6,PRCHPO,5,"I"))
"RTN","PRCHAMYA",93,0)
 I NEWVEN D  ;
"RTN","PRCHAMYA",94,0)
 . S AMEND=$P(^PRC(443.6,PRCHPO,6,0),U,3)
"RTN","PRCHAMYA",95,0)
 . S NODE=$O(^PRC(443.6,PRCHPO,6,AMEND,3,"AC",31,5,""))
"RTN","PRCHAMYA",96,0)
 . S OLDVEN=^PRC(443.6,PRCHPO,6,AMEND,3,NODE,1,1,0)
"RTN","PRCHAMYA",97,0)
 . I OLDVEN KILL ^PRC(442,"D",OLDVEN,PRCHPO)
"RTN","PRCHAMYA",98,0)
 . S DA=PRCHPO,DR="5////"_NEWVEN,DIE="^PRC(442,"
"RTN","PRCHAMYA",99,0)
 . D ^DIE
"RTN","PRCHAMYA",100,0)
 ;
"RTN","PRCHAMYA",101,0)
 ;There has been a change in Purchase Order number.
"RTN","PRCHAMYA",102,0)
 ;See NOIS LOM-0302-62930
"RTN","PRCHAMYA",103,0)
 I $P(PRCJ,U,2)=32 D  ;
"RTN","PRCHAMYA",104,0)
 . NEW CP,NEWPO,VENDOR
"RTN","PRCHAMYA",105,0)
 . S NEWPO=$P($G(^PRC(443.6,PRCHPO,23)),U,4)
"RTN","PRCHAMYA",106,0)
 . Q:NEWPO=""
"RTN","PRCHAMYA",107,0)
 . S VENDOR=$P($G(^PRC(443.6,PRCHPO,1)),U)
"RTN","PRCHAMYA",108,0)
 . S CP=$P(PRC("CP")," ")          ;Control point
"RTN","PRCHAMYA",109,0)
 . S ^PRC(442,"D",VENDOR,NEWPO)="" ;Set up "D" X-ref for PO display
"RTN","PRCHAMYA",110,0)
 . S ^PRC(442,"E",CP,NEWPO)=""     ;Set up "E" X-ref for PO display
"RTN","PRCHAMYA",111,0)
 . S CP=PRC("SITE")_CP             ;Station & control point
"RTN","PRCHAMYA",112,0)
 . ;
"RTN","PRCHAMYA",113,0)
 . ;Get items from PO to setup item master file history
"RTN","PRCHAMYA",114,0)
 . NEW CNT,ITEM,ITEMNUM
"RTN","PRCHAMYA",115,0)
 . S ITEMNUM=0
"RTN","PRCHAMYA",116,0)
 . F  S ITEMNUM=$O(^PRC(443.6,PRCHPO,2,ITEMNUM)) Q:'ITEMNUM  D
"RTN","PRCHAMYA",117,0)
 . . S ITEM=$P(^PRC(443.6,PRCHPO,2,ITEMNUM,0),U,5)
"RTN","PRCHAMYA",118,0)
 . . QUIT:ITEM=""
"RTN","PRCHAMYA",119,0)
 . . S ^PRC(441,ITEM,4,CP,1,NEWPO,0)=NEWPO
"RTN","PRCHAMYA",120,0)
 . . S ^PRC(441,ITEM,4,CP,1,"AC",9999999-PRC("PODT"),NEWPO)=""
"RTN","PRCHAMYA",121,0)
 . . S $P(^PRC(441,ITEM,4,CP,1,0),U,3)=NEWPO
"RTN","PRCHAMYA",122,0)
 . . S CNT=$P(^PRC(441,ITEM,4,CP,1,0),U,4)
"RTN","PRCHAMYA",123,0)
 . . S $P(^PRC(441,ITEM,4,CP,1,0),U,4)=CNT+1
"RTN","PRCHAMYA",124,0)
 ;
"RTN","PRCHAMYA",125,0)
 I HOLD]"" S $P(HOLD,U,3)=PRCHAM,$P(HOLD,U,4)=$P(HOLD,U,4)+1,$P(HOLD,U,2)=$P(^DD(442,50,0),U,2),^PRC(442,PRCHPO,6,0)=HOLD
"RTN","PRCHAMYA",126,0)
 S NEW=$G(^PRC(443.6,PRCHPO,23))
"RTN","PRCHAMYA",127,0)
 S PRCSUM=$$SUM^PRCUESIG(PRCHPO_"^"_$$STRING^PRCHES5(^PRC(442,PRCHPO,0),^PRC(442,PRCHPO,1),^PRC(442,PRCHPO,12)))
"RTN","PRCHAMYA",128,0)
 S PRCSIG="" D RECODE^PRCHES5(PRCHPO,PRCSUM,.PRCSIG) S ROUTINE="PRCHAMYA"
"RTN","PRCHAMYA",129,0)
 G:PRCSIG<1 QQ K PRCSUM
"RTN","PRCHAMYA",130,0)
 ;AFTER MOVING INTO 442 NOW UPDATE ANY ZERO NODE OF A MULTIPLE FIELD
"RTN","PRCHAMYA",131,0)
 ;FROM THE 'DD'
"RTN","PRCHAMYA",132,0)
 S ITEM=$G(^PRC(442,PRCHPO,2,0)),$P(ITEM,U,2)=$P(^DD(442,40,0),U,2),^PRC(442,PRCHPO,2,0)=ITEM
"RTN","PRCHAMYA",133,0)
 S DISCNT=$G(^PRC(442,PRCHPO,3,0)) I DISCNT]"" S $P(DISCNT,U,2)=$P(^DD(442,14,0),U,2),^PRC(442,PRCHPO,3,0)=DISCNT
"RTN","PRCHAMYA",134,0)
 S PROMPT=$G(^PRC(442,PRCHPO,5,0)) I PROMPT]"" S $P(PROMPT,U,2)=$P(^DD(442,9.2,0),U,2),^PRC(442,PRCHPO,5,0)=PROMPT
"RTN","PRCHAMYA",135,0)
 S CHANGS=$G(^PRC(442,PRCHPO,6,0)) I CHANGS]"" S $P(CHANGS,U,2)=$P(^DD(442,50,0),U,2),^PRC(442,PRCHPO,6,0)=CHANGS
"RTN","PRCHAMYA",136,0)
 S CHANGS=$G(^PRC(442,PRCHPO,6,PRCHAM,3,0)) I CHANGS]"" S $P(CHANGS,U,2)=$P(^DD(442.07,14,0),U,2),^PRC(442,PRCHPO,6,PRCHAM,3,0)=CHANGS
"RTN","PRCHAMYA",137,0)
 S CERT=$G(^PRC(442,PRCHPO,15,0)) I CERT]"" S $P(CERT,U,2)=$P(^DD(442,24,0),U,2),^PRC(442,PRCHPO,15,0)=CERT
"RTN","PRCHAMYA",138,0)
 I NEW]""&($P(NEW,U,4)>0)&($P(NEW,U,4)'=PRCHPO) S PRCHXXXX=PRCHPO,PRCHPO=$P(NEW,U,4),%X="^PRC(443.6,"_PRCHPO_",",%Y="^PRC(442,"_PRCHPO_"," G C2
"RTN","PRCHAMYA",139,0)
 S PRCHPO=$S($D(PRCHXXXX):PRCHXXXX,1:PRCHPO)
"RTN","PRCHAMYA",140,0)
 S DA(1)=PRCHPO,N=0,DIK(1)=".01^C" F  S N=$O(^PRC(442,DA(1),2,N)) Q:'N  D
"RTN","PRCHAMYA",141,0)
 .S DA=N,DIK="^PRC(442,"_DA(1)_",2," D EN^DIK
"RTN","PRCHAMYA",142,0)
 K DA,DIK,N
"RTN","PRCHAMYA",143,0)
 G ^PRCHAMYB
"RTN","PRCHAMYA",144,0)
QQ W !!,$$ERR^PRCHQQ(ROUTINE,PRCSIG) W:PRCSIG=0!(PRCSIG=-3) !,"Notify Application Coordinator!"  S DIR(0)="EAO",DIR("A")="Press <Return> to continue " D ^DIR S FLAG=1 Q
"RTN","PRCHDP8")
0^2^B21560805
"RTN","PRCHDP8",1,0)
PRCHDP8 ;WISC/DJM-PRINT AMENDMENT,ROUTINE #4 ;6/23/94  8:44 AM ;5/13/94  10:37 AM
"RTN","PRCHDP8",2,0)
V ;;5.1;IFCAP;**74**;Oct 20, 2000
"RTN","PRCHDP8",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHDP8",4,0)
 ;
"RTN","PRCHDP8",5,0)
E24 ;SOURCE CODE Edit PRINT
"RTN","PRCHDP8",6,0)
 N CHANGE,OLD,NEW,LCNT,DATA
"RTN","PRCHDP8",7,0)
 D LCNT^PRCHDP9(.LCNT)
"RTN","PRCHDP8",8,0)
 S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",24,8,0)) Q:CHANGE'>0
"RTN","PRCHDP8",9,0)
 S OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$P(^PRCD(420.8,OLD,0),U)
"RTN","PRCHDP8",10,0)
 S NEW=$P(^PRC(442,PRCHPO,1),U,7),NEW=$P(^PRCD(420.8,NEW,0),U)
"RTN","PRCHDP8",11,0)
 D LINE^PRCHDP9(.LCNT,2) S DATA="Source Code was changed from "_OLD_" to "_NEW D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP8",12,0)
 Q
"RTN","PRCHDP8",13,0)
 ;
"RTN","PRCHDP8",14,0)
E30 ;F.C.P. Edit PRINT
"RTN","PRCHDP8",15,0)
 N CHANGE,OLD,FCP,LCNT,DATA
"RTN","PRCHDP8",16,0)
 S CHANGE=0 D LCNT^PRCHDP9(.LCNT)
"RTN","PRCHDP8",17,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,1,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDP8",18,0)
 .S OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDP8",19,0)
 .S FCP=$P(^PRC(442,PRCHPO,0),U,3)
"RTN","PRCHDP8",20,0)
 .D LINE^PRCHDP9(.LCNT,2) S DATA="The FUND CONTROL POINT of "_OLD D DATA^PRCHDP9(.LCNT,DATA)
"RTN","PRCHDP8",21,0)
 .S DATA="has been changed to "_FCP
"RTN","PRCHDP8",22,0)
 .D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP8",23,0)
 Q
"RTN","PRCHDP8",24,0)
 ;
"RTN","PRCHDP8",25,0)
E31 ;Change VENDOR PRINT
"RTN","PRCHDP8",26,0)
 N CHANGE,OLD,VEN,LCNT,DATA,CNT,CNT1,CNT2,AA
"RTN","PRCHDP8",27,0)
 S CHANGE=0,CNT=0,CNT2=0 D LCNT^PRCHDP9(.LCNT)
"RTN","PRCHDP8",28,0)
 ;
"RTN","PRCHDP8",29,0)
 ;Check for multiple vendor changes
"RTN","PRCHDP8",30,0)
 F  S CNT=$O(^PRC(442,PRCHPO,6,CNT)) Q:'CNT  D
"RTN","PRCHDP8",31,0)
 . S CNT1=0
"RTN","PRCHDP8",32,0)
 . F  S CNT1=$O(^PRC(442,PRCHPO,6,CNT,3,CNT1)) Q:'CNT1  D
"RTN","PRCHDP8",33,0)
 . . S TYPE=$G(^PRC(442,PRCHPO,6,CNT,3,CNT1,0))
"RTN","PRCHDP8",34,0)
 . . S TYPE=$P(TYPE,U,2) I TYPE'=31 Q
"RTN","PRCHDP8",35,0)
 . . S VEN=$G(^PRC(442,PRCHPO,6,CNT,3,CNT1,1,1,0))
"RTN","PRCHDP8",36,0)
 . . Q:VEN=""
"RTN","PRCHDP8",37,0)
 . . S CNT2=CNT2+1,AA(CNT)=VEN ;Count/track vendor changes
"RTN","PRCHDP8",38,0)
 ;
"RTN","PRCHDP8",39,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,5,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDP8",40,0)
 .;Print vendor amendments.
"RTN","PRCHDP8",41,0)
 .I CNT2>1 D E31A Q
"RTN","PRCHDP8",42,0)
 .S OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$P(^PRC(440,OLD,0),U)
"RTN","PRCHDP8",43,0)
 .S VEN=$P(^PRC(442,PRCHPO,1),U),VEN=$P(^PRC(440,VEN,0),U)
"RTN","PRCHDP8",44,0)
 .D LINE^PRCHDP9(.LCNT,2) S DATA="Vendor "_OLD_" has been changed to "_VEN
"RTN","PRCHDP8",45,0)
 .D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP8",46,0)
 Q
"RTN","PRCHDP8",47,0)
 ;
"RTN","PRCHDP8",48,0)
E31A ;Print multiple vendor changes.
"RTN","PRCHDP8",49,0)
 S OLD=$P(^PRC(440,AA(PRCHAM),0),U)
"RTN","PRCHDP8",50,0)
 S VEN=$O(AA(PRCHAM))
"RTN","PRCHDP8",51,0)
 I VEN="" S VEN=$P(^PRC(442,PRCHPO,1),U)
"RTN","PRCHDP8",52,0)
 E  S VEN=AA(VEN)
"RTN","PRCHDP8",53,0)
 S VEN=$P(^PRC(440,VEN,0),U)
"RTN","PRCHDP8",54,0)
 ;
"RTN","PRCHDP8",55,0)
 D LINE^PRCHDP9(.LCNT,2)
"RTN","PRCHDP8",56,0)
 S DATA="Vendor "_OLD_" has been changed to "_VEN
"RTN","PRCHDP8",57,0)
 D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP8",58,0)
 Q
"RTN","PRCHDP8",59,0)
 ;
"RTN","PRCHDP8",60,0)
E32 ;REPLACE P.O. NUMBER PRINT
"RTN","PRCHDP8",61,0)
 N CHANGE,NPO,OPO,LCNT,DATA
"RTN","PRCHDP8",62,0)
 S CHANGE=0 D LCNT^PRCHDP9(.LCNT)
"RTN","PRCHDP8",63,0)
 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,28,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDP8",64,0)
 .S NPO=$P(^PRC(442,PRCHPO,23),U,4),NPO=$P(^PRC(442,NPO,0),U)
"RTN","PRCHDP8",65,0)
 .S OPO=$P(^PRC(442,PRCHPO,0),U)
"RTN","PRCHDP8",66,0)
 .D LINE^PRCHDP9(.LCNT,2) S DATA="Purchase Order number "_OPO_" has been changed to "_NPO
"RTN","PRCHDP8",67,0)
 .D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP8",68,0)
 Q
"RTN","PRCHDP8",69,0)
 ;
"RTN","PRCHDP8",70,0)
E33 ;PROMPT PAYMENT Edit PRINT
"RTN","PRCHDP8",71,0)
 ;N CHANGE,CHANGES,FIELD,OLD,PAY,LCNT,DATA,PCT,PCT1,PCT2,DAYS,DAYS1,DAYS2,TERMS,NPCT,NDAYS1
"RTN","PRCHDP8",72,0)
 S FIELD=0 K PAY D LCNT^PRCHDP9(.LCNT)
"RTN","PRCHDP8",73,0)
 F  S FIELD=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD)) Q:FIELD'>0  D
"RTN","PRCHDP8",74,0)
 .S CHANGE=0 F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,FIELD,CHANGE)) Q:CHANGE'>0  D
"RTN","PRCHDP8",75,0)
 ..S CHANGES=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,0),OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0)
"RTN","PRCHDP8",76,0)
 ..S:FIELD=.01 PCT2=OLD S:FIELD=1 DAYS2=OLD
"RTN","PRCHDP8",77,0)
 ..S PAY=$P(CHANGES,U,4) Q:$D(PAY(PAY))  S PAY(PAY)=1
"RTN","PRCHDP8",78,0)
 ..I FIELD'=1 S DAYS=0 F  S DAYS=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",33,1,DAYS)) Q:DAYS'>0  S DAYS1=$P(^PRC(442,PRCHPO,6,PRCHAM,3,DAYS,0),U,4) I DAYS1=PAY D  Q
"RTN","PRCHDP8",79,0)
 ...S DAYS2=^PRC(442,PRCHPO,6,PRCHAM,3,DAYS,1,1,0) Q
"RTN","PRCHDP8",80,0)
 ..I FIELD'=.01 S PCT=0 F  S PCT=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",33,.01,PCT)) Q:PCT'>0  S PCT1=$P(^PRC(442,PRCHPO,6,PRCHAM,3,PCT,0),U,4) I PCT1=PAY D  Q
"RTN","PRCHDP8",81,0)
 ...S PCT2=^PRC(442,PRCHPO,6,PRCHAM,3,PCT,1,1,0) Q
"RTN","PRCHDP8",82,0)
 ..S TERMS=^PRC(442,PRCHPO,5,PAY,0),NPCT=$P(TERMS,U),NDAYS1=$P(TERMS,U,2)
"RTN","PRCHDP8",83,0)
 ..D LINE^PRCHDP9(.LCNT,2)
"RTN","PRCHDP8",84,0)
 ..S DAYS2=$G(DAYS2),PCT2=$G(PCT2)
"RTN","PRCHDP8",85,0)
 ..I DAYS2'=0,PCT2'=0 S DATA="Prompt Payment "_PCT2_$S(PCT2=+PCT2:"%",1:"")_"/"_DAYS2_$S(DAYS2=+DAYS2:" days",1:"") D
"RTN","PRCHDP8",86,0)
 ...S DATA=DATA_" has been changed to "_NPCT_$S(NPCT=+NPCT:"%",1:"")_"/"_NDAYS1_$S(NDAYS1=+NDAYS1:" days",1:"")
"RTN","PRCHDP8",87,0)
 ...D DATA^PRCHDP9(.LCNT,DATA) Q
"RTN","PRCHDP8",88,0)
 ..I DAYS2=0,PCT2=0 S DATA="  *ADDED THROUGH AMENDMENT*" D DATA^PRCHDP9(.LCNT,DATA) D
"RTN","PRCHDP8",89,0)
 ...S DATA="Prompt Payment "_NPCT_$S(NPCT=+NPCT:"%",1:"")_"/"_NDAYS1_$S(NDAYS1=+NDAYS1:" days",1:"")_" has been added"
"RTN","PRCHDP8",90,0)
 ...D DATA^PRCHDP9(.LCNT,DATA) Q
"RTN","PRCHDP8",91,0)
 ..Q
"RTN","PRCHDP8",92,0)
 .Q
"RTN","PRCHDP8",93,0)
 D LCNT1^PRCHDP9(LCNT)
"RTN","PRCHDP8",94,0)
 Q
"VER")
8.0^22.0
**END**
**END**
