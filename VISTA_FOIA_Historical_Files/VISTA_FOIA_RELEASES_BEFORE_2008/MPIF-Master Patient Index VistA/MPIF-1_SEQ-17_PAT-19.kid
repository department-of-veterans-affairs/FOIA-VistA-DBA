Released MPIF*1*19 SEQ #17
Extracted from mail message
**KIDS**:MPIF*1.0*19^

**INSTALL NAME**
MPIF*1.0*19
"BLD",1362,0)
MPIF*1.0*19^MASTER PATIENT INDEX VISTA^0^3011017^y
"BLD",1362,4,0)
^9.64PA^^
"BLD",1362,"ABNS",0)
^9.66A^^
"BLD",1362,"ABPKG")
n^n^
"BLD",1362,"KRN",0)
^9.67PA^19^17
"BLD",1362,"KRN",.4,0)
.4
"BLD",1362,"KRN",.401,0)
.401
"BLD",1362,"KRN",.402,0)
.402
"BLD",1362,"KRN",.403,0)
.403
"BLD",1362,"KRN",.5,0)
.5
"BLD",1362,"KRN",.84,0)
.84
"BLD",1362,"KRN",3.6,0)
3.6
"BLD",1362,"KRN",3.8,0)
3.8
"BLD",1362,"KRN",9.2,0)
9.2
"BLD",1362,"KRN",9.8,0)
9.8
"BLD",1362,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1362,"KRN",9.8,"NM",1,0)
MPIFDEL^^0^B17416260
"BLD",1362,"KRN",9.8,"NM","B","MPIFDEL",1)

"BLD",1362,"KRN",19,0)
19
"BLD",1362,"KRN",19.1,0)
19.1
"BLD",1362,"KRN",101,0)
101
"BLD",1362,"KRN",409.61,0)
409.61
"BLD",1362,"KRN",771,0)
771
"BLD",1362,"KRN",870,0)
870
"BLD",1362,"KRN",8994,0)
8994
"BLD",1362,"KRN","B",.4,.4)

"BLD",1362,"KRN","B",.401,.401)

"BLD",1362,"KRN","B",.402,.402)

"BLD",1362,"KRN","B",.403,.403)

"BLD",1362,"KRN","B",.5,.5)

"BLD",1362,"KRN","B",.84,.84)

"BLD",1362,"KRN","B",3.6,3.6)

"BLD",1362,"KRN","B",3.8,3.8)

"BLD",1362,"KRN","B",9.2,9.2)

"BLD",1362,"KRN","B",9.8,9.8)

"BLD",1362,"KRN","B",19,19)

"BLD",1362,"KRN","B",19.1,19.1)

"BLD",1362,"KRN","B",101,101)

"BLD",1362,"KRN","B",409.61,409.61)

"BLD",1362,"KRN","B",771,771)

"BLD",1362,"KRN","B",870,870)

"BLD",1362,"KRN","B",8994,8994)

"BLD",1362,"QUES",0)
^9.62^^
"BLD",1362,"REQB",0)
^9.611^1^1
"BLD",1362,"REQB",1,0)
MPIF*1.0*9^1
"BLD",1362,"REQB","B","MPIF*1.0*9",1)

"MBREQ")
0
"PKG",282,-1)
1^1
"PKG",282,0)
MASTER PATIENT INDEX VISTA^MPIF^Master Patient Index VistA side
"PKG",282,20,0)
^9.402P^^
"PKG",282,22,0)
^9.49I^1^1
"PKG",282,22,1,0)
1.0^2990428
"PKG",282,22,1,"PAH",1,0)
19^3011017^12596
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","MPIFDEL")
0^1^B17416260
"RTN","MPIFDEL",1,0)
MPIFDEL ;SF/MJM,CMC-DELETE PATIENT FROM MPI ;JUL 14, 1998
"RTN","MPIFDEL",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**1,3,9,19**;30 Apr 99
"RTN","MPIFDEL",3,0)
 ;
"RTN","MPIFDEL",4,0)
 ;Integration Agreements Utilized:
"RTN","MPIFDEL",5,0)
 ; ^DPT(         - IA #2070
"RTN","MPIFDEL",6,0)
 ; $$EN^VAFCPID  - IA #3015
"RTN","MPIFDEL",7,0)
 ; START^RGHLLOG - IA #2796
"RTN","MPIFDEL",8,0)
 ; EXC^RGHLLOG   - IA #2796
"RTN","MPIFDEL",9,0)
 ; STOP^RGHLLOG  - IA #2796
"RTN","MPIFDEL",10,0)
 ; $$DELALLTF^VAFCTFU  - IA #2988
"RTN","MPIFDEL",11,0)
 ; $$EN^VAFCPID  - IA #3015
"RTN","MPIFDEL",12,0)
 ;
"RTN","MPIFDEL",13,0)
INTER ;
"RTN","MPIFDEL",14,0)
 ;Entry point for Inactivate Patient from MPI option [MPIF PAT INACT]
"RTN","MPIFDEL",15,0)
 ;No input or output variables ^DPT
"RTN","MPIFDEL",16,0)
 N DIC,DA,DFN,HL,ERROR,CNT,HLRST,ICN,DATE,MPIFCMOR,DTOUT,DUTOUT
"RTN","MPIFDEL",17,0)
 S ERROR=""
"RTN","MPIFDEL",18,0)
 S DIC=2,DIC(0)="QEAM" D ^DIC Q:+Y<0  S DFN=+Y
"RTN","MPIFDEL",19,0)
 S ICN=$P($$MPINODE^MPIFAPI(DFN),"^")
"RTN","MPIFDEL",20,0)
 I ICN=""!(ICN=-1) W !,"** Patient Does NOT have an ICN **" Q
"RTN","MPIFDEL",21,0)
 S MPIFCMOR=+$$LKUP^XUAF4(+$$GETVCCI^MPIF001(DFN))
"RTN","MPIFDEL",22,0)
 I MPIFCMOR=0 W !,"*** Could NOT Inactivate Patient from MPI: Coordinating Master of Record is Not Defined ***" Q
"RTN","MPIFDEL",23,0)
 I $$PAT^MPIFNQ(DFN)'=+$P($$SITE^VASITE,"^",3) W !,"*** Could NOT Inactivate Patient from MPI: Coordinating Master of record site is '"_$$CMOR2^MPIF001(DFN)_"'. You MUST be the CMOR ***" Q
"RTN","MPIFDEL",24,0)
 S ICN=$$GETICN^MPIF001(DFN)
"RTN","MPIFDEL",25,0)
 ;ask user if they are sure
"RTN","MPIFDEL",26,0)
 N DIR,Y S DIR(0)="Y",DIR("B")="No"
"RTN","MPIFDEL",27,0)
 S DIR("A")="Are you sure you want to Inactivate this Patient?"
"RTN","MPIFDEL",28,0)
 D ^DIR
"RTN","MPIFDEL",29,0)
 K DIR
"RTN","MPIFDEL",30,0)
 Q:$D(DTOUT)!($D(DUTOUT))!('Y)
"RTN","MPIFDEL",31,0)
 D HL7(DFN,.ERROR)
"RTN","MPIFDEL",32,0)
 I ERROR="" D DELETE(DFN) S ERROR=$$DELALLTF^VAFCTFU(+ICN),ERROR=""
"RTN","MPIFDEL",33,0)
 I ERROR=""!(ERROR=0) W !,"*** Inactivated on YOUR system, message sent to MPI to Inactivate ***"
"RTN","MPIFDEL",34,0)
 I ERROR'="" W !,"Error Occurred - "_ERROR
"RTN","MPIFDEL",35,0)
 Q
"RTN","MPIFDEL",36,0)
 ;
"RTN","MPIFDEL",37,0)
HL7(DFN,ERROR) ; create HL7 message
"RTN","MPIFDEL",38,0)
 ; check if no subscribers
"RTN","MPIFDEL",39,0)
 N SUB,HL,CNT,ICN,%,HLDATE
"RTN","MPIFDEL",40,0)
 K HLL
"RTN","MPIFDEL",41,0)
 Q:$E($$GETICN^MPIF001(DFN),1,3)=$P($$SITE^VASITE(),"^",3)
"RTN","MPIFDEL",42,0)
 ; ^ don't generate HL7 message if local ICN
"RTN","MPIFDEL",43,0)
 S SUB=$P($G(^DPT(DFN,"MPI")),"^",5)
"RTN","MPIFDEL",44,0)
 I SUB'="" D GET^HLSUB(SUB,"","MPIF A29 SERVER",.HLL) I $D(HLL) S ERROR="Attempted to Inactivate an ICN and Patient is Shared.  Can't Inactivate patient DFN= "_DFN Q
"RTN","MPIFDEL",45,0)
 S ICN=+$$ICN^MPIFNQ(DFN)
"RTN","MPIFDEL",46,0)
 D NOW^%DTC S HLDATE=$$HLDATE^HLFNC(%,"DT")
"RTN","MPIFDEL",47,0)
 S HL=0,CNT=0
"RTN","MPIFDEL",48,0)
 D INIT^HLFNC2("MPIF A29 SERVER",.HL)
"RTN","MPIFDEL",49,0)
 I HL S ERROR="ERROR = "_HL_" During INIT^HLFNC2 for MPIF A29 Server for Patient DFN= "_DFN D EXC(DFN,ERROR,220)
"RTN","MPIFDEL",50,0)
 S CNT=CNT+1,HLA("HLS",CNT)="EVN"_HL("FS")_"A29"_HL("FS")_HLDATE_HL("FS")_HL("FS")_""_HL("FS")
"RTN","MPIFDEL",51,0)
 S CNT=CNT+1,HLA("HLS",CNT)=$$EN^VAFCPID(DFN,"2,3,5")
"RTN","MPIFDEL",52,0)
 ; message only goes to MPI Link
"RTN","MPIFDEL",53,0)
 D GENERATE^HLMA("MPIF A29 SERVER","LM",1,.HLRST,"",.HL)
"RTN","MPIFDEL",54,0)
 I 'HLRST S ERROR="Error During Generate for MPIF A29 Server Error= "_HLRST_" for dfn "_DFN D EXC(DFN,ERROR,220)
"RTN","MPIFDEL",55,0)
 Q
"RTN","MPIFDEL",56,0)
 ;
"RTN","MPIFDEL",57,0)
PAT1 ;entry point for tasked job from .01 in Patient file for ZZ patients
"RTN","MPIFDEL",58,0)
 N ERR
"RTN","MPIFDEL",59,0)
 S ERR=""
"RTN","MPIFDEL",60,0)
 D PAT(DA,.ERR)
"RTN","MPIFDEL",61,0)
 S ZTREQ="@"
"RTN","MPIFDEL",62,0)
 Q
"RTN","MPIFDEL",63,0)
 ;
"RTN","MPIFDEL",64,0)
PAT(DFN,ERROR) ;Programmer API to Delete MPI entry and remove ICN data from DPT
"RTN","MPIFDEL",65,0)
 S ERROR=""
"RTN","MPIFDEL",66,0)
 I $G(DFN)="" S ERROR="DFN not defined" Q
"RTN","MPIFDEL",67,0)
 I +$$PAT^MPIFNQ(DFN)'=+$P($$SITE^VASITE,"^",3) S ERROR="Attempt to Inactivate Patient, DFN= "_DFN_" this site is not the CMOR for this patient" D EXC(DFN,ERROR,226) Q
"RTN","MPIFDEL",68,0)
 D HL7(DFN,.ERROR)
"RTN","MPIFDEL",69,0)
 I ERROR="" S ERROR=$$DELALLTF^VAFCTFU(+$$GETICN^MPIF001(DFN)),ERROR="" D DELETE(DFN)
"RTN","MPIFDEL",70,0)
 Q
"RTN","MPIFDEL",71,0)
DELETE(DFN) ;
"RTN","MPIFDEL",72,0)
 N DA,DIE,X,Y,DR
"RTN","MPIFDEL",73,0)
 Q:DFN=""
"RTN","MPIFDEL",74,0)
 S DA=DFN,DIE="^DPT(",DR="991.01///@;991.02///@;991.03///@;991.04///@"
"RTN","MPIFDEL",75,0)
 D ^DIE
"RTN","MPIFDEL",76,0)
 Q
"RTN","MPIFDEL",77,0)
 ;
"RTN","MPIFDEL",78,0)
EXC(DFN,ERROR,TYPE) ; subscribers, log exception
"RTN","MPIFDEL",79,0)
 D START^RGHLLOG(0)
"RTN","MPIFDEL",80,0)
 D EXC^RGHLLOG(TYPE,ERROR,$G(DFN))
"RTN","MPIFDEL",81,0)
 D STOP^RGHLLOG(0)
"RTN","MPIFDEL",82,0)
 Q
"RTN","MPIFDEL",83,0)
 ;
"RTN","MPIFDEL",84,0)
ZZSET(DA,NAME) ;this entry point checks to see if .01 of Patient file entry
"RTN","MPIFDEL",85,0)
 ;starts with at least two Zs
"RTN","MPIFDEL",86,0)
 ;if it does and an ICN is present, it will be inactivated
"RTN","MPIFDEL",87,0)
 ;
"RTN","MPIFDEL",88,0)
 Q:$E(NAME,1,2)'="ZZ"
"RTN","MPIFDEL",89,0)
 ;task inactivation off
"RTN","MPIFDEL",90,0)
 I +$$GETICN^MPIF001(DA)>0 D
"RTN","MPIFDEL",91,0)
 .S ZTRTN="PAT1^MPIFDEL",ZTDESC="Inactivate ICN for 'ZZ'd patient"
"RTN","MPIFDEL",92,0)
 .S ZTIO="",ZTSAVE("DA")=DA,ZTSAVE("NAME")=NAME
"RTN","MPIFDEL",93,0)
 .S ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT,0,0,1,0)
"RTN","MPIFDEL",94,0)
 .D ^%ZTLOAD
"RTN","MPIFDEL",95,0)
 .K ZTRTN,ZTDESC,ZTIO,ZTSAVE,ZTDTH,ZTREQ
"RTN","MPIFDEL",96,0)
 Q
"RTN","MPIFDEL",97,0)
ZZKILL(DA,NAME) ;This entry point checks if there is an ICN present, if so
"RTN","MPIFDEL",98,0)
 ;if will be inactivated, following the inactivate rules
"RTN","MPIFDEL",99,0)
 N ERR S ERR=""
"RTN","MPIFDEL",100,0)
 I +$$GETICN^MPIF001(DA)>0 D PAT(DA,.ERR)
"RTN","MPIFDEL",101,0)
 Q
"VER")
8.0^22.0
**END**
**END**
