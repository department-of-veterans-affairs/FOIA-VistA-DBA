Released SD*5.3*490 SEQ #396
Extracted from mail message
**KIDS**:SD*5.3*490^

**INSTALL NAME**
SD*5.3*490
"BLD",6826,0)
SD*5.3*490^SCHEDULING^0^3061003^y
"BLD",6826,1,0)
^^2^2^3060714^
"BLD",6826,1,1,0)
Fixes to the Display Clinic Availability grid and the Set Up a Clinic 
"BLD",6826,1,2,0)
menu option.
"BLD",6826,4,0)
^9.64PA^^
"BLD",6826,6.3)
4
"BLD",6826,"ABPKG")
n
"BLD",6826,"KRN",0)
^9.67PA^8989.52^19
"BLD",6826,"KRN",.4,0)
.4
"BLD",6826,"KRN",.401,0)
.401
"BLD",6826,"KRN",.402,0)
.402
"BLD",6826,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",6826,"KRN",.403,0)
.403
"BLD",6826,"KRN",.5,0)
.5
"BLD",6826,"KRN",.84,0)
.84
"BLD",6826,"KRN",3.6,0)
3.6
"BLD",6826,"KRN",3.8,0)
3.8
"BLD",6826,"KRN",9.2,0)
9.2
"BLD",6826,"KRN",9.8,0)
9.8
"BLD",6826,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",6826,"KRN",9.8,"NM",2,0)
SDM1^^0^B40309214
"BLD",6826,"KRN",9.8,"NM",3,0)
SDCLAV1^^0^B39056960
"BLD",6826,"KRN",9.8,"NM",4,0)
SDCLAV0^^0^B6584983
"BLD",6826,"KRN",9.8,"NM","B","SDCLAV0",4)

"BLD",6826,"KRN",9.8,"NM","B","SDCLAV1",3)

"BLD",6826,"KRN",9.8,"NM","B","SDM1",2)

"BLD",6826,"KRN",19,0)
19
"BLD",6826,"KRN",19.1,0)
19.1
"BLD",6826,"KRN",101,0)
101
"BLD",6826,"KRN",409.61,0)
409.61
"BLD",6826,"KRN",771,0)
771
"BLD",6826,"KRN",870,0)
870
"BLD",6826,"KRN",8989.51,0)
8989.51
"BLD",6826,"KRN",8989.52,0)
8989.52
"BLD",6826,"KRN",8994,0)
8994
"BLD",6826,"KRN","B",.4,.4)

"BLD",6826,"KRN","B",.401,.401)

"BLD",6826,"KRN","B",.402,.402)

"BLD",6826,"KRN","B",.403,.403)

"BLD",6826,"KRN","B",.5,.5)

"BLD",6826,"KRN","B",.84,.84)

"BLD",6826,"KRN","B",3.6,3.6)

"BLD",6826,"KRN","B",3.8,3.8)

"BLD",6826,"KRN","B",9.2,9.2)

"BLD",6826,"KRN","B",9.8,9.8)

"BLD",6826,"KRN","B",19,19)

"BLD",6826,"KRN","B",19.1,19.1)

"BLD",6826,"KRN","B",101,101)

"BLD",6826,"KRN","B",409.61,409.61)

"BLD",6826,"KRN","B",771,771)

"BLD",6826,"KRN","B",870,870)

"BLD",6826,"KRN","B",8989.51,8989.51)

"BLD",6826,"KRN","B",8989.52,8989.52)

"BLD",6826,"KRN","B",8994,8994)

"BLD",6826,"QUES",0)
^9.62^^
"BLD",6826,"REQB",0)
^9.611^4^3
"BLD",6826,"REQB",2,0)
SD*5.3*478^1
"BLD",6826,"REQB",3,0)
SD*5.3*463^1
"BLD",6826,"REQB",4,0)
SD*5.3*439^1
"BLD",6826,"REQB","B","SD*5.3*439",4)

"BLD",6826,"REQB","B","SD*5.3*463",3)

"BLD",6826,"REQB","B","SD*5.3*478",2)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
490^3061003
"PKG",16,22,1,"PAH",1,1,0)
^^2^2^3061003
"PKG",16,22,1,"PAH",1,1,1,0)
Fixes to the Display Clinic Availability grid and the Set Up a Clinic 
"PKG",16,22,1,"PAH",1,1,2,0)
menu option.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","SDCLAV0")
0^4^B6584983^B6456733
"RTN","SDCLAV0",1,0)
SDCLAV0 ;ALB/LDB - OUTPUT PATTERNS (cont.) ; 05 Mar 99 11:31 AM
"RTN","SDCLAV0",2,0)
 ;;5.3;Scheduling;**184,439,490**;Aug 13, 1993;Build 4
"RTN","SDCLAV0",3,0)
 I 'VAUTC F SDC=0:0 S SDC=$O(VAUTC(SDC)) Q:SDC'>0  S SDV=VAUTC(SDC) D:VAUTD!($D(VAUTD(+$P(^SC(SDC,0),"^",15))))!('$P(^(0),"^",15)&$D(VAUTD($P(^DG(43,1,"GL"),"^",3)))) S1
"RTN","SDCLAV0",4,0)
 I VAUTC F SDC=0:0 S SDC=$O(^SC(SDC)) Q:'SDC  I $P(^(SDC,0),"^",3)="C" D:VAUTD!($D(VAUTD(+$P(^(0),"^",15))))!('$P(^(0),"^",15)&$D(VAUTD($P(^DG(43,1,"GL"),"^",3)))) S1
"RTN","SDCLAV0",5,0)
 I $D(^UTILITY($J,"SDNMS")) D S2^SDCLAV1
"RTN","SDCLAV0",6,0)
 S DGTCH="CLINIC AVAILABILITY REPORT^CLINIC^PAGE#" D:$E(IOST,1,2)="P-" TP^DGUTL K SDBD,SDCI,SDED D END^SDCLAV Q
"RTN","SDCLAV0",7,0)
S1 S SD=^SC(SDC,0),D=$S($P(SD,"^",15):$P(SD,"^",15),1:$P(^DG(43,1,"GL"),"^",3)),SD5=0,SDNM=$P(SD,"^")
"RTN","SDCLAV0",8,0)
 S $P(^UTILITY($J,"SDNMS",D,SDNM),"^",3)=SDC
"RTN","SDCLAV0",9,0)
 Q
"RTN","SDCLAV0",10,0)
NM ;called by SDCLAV1
"RTN","SDCLAV0",11,0)
 F SDAP1=0:0 S SDAP1=$O(^SC(SDC,"S",SDAP,1,SDAP1)) Q:SDAP1'>0  D NM1
"RTN","SDCLAV0",12,0)
 K M1,SDN1,SDN2,SDN3,SDC3,SDAP1  ; SD*5.3*439 added Kill of local vars
"RTN","SDCLAV0",13,0)
 Q
"RTN","SDCLAV0",14,0)
NM1 S SDN1=+^SC(SDC,"S",SDAP,1,SDAP1,0),M1=$P(^(0),"^",2),SDC3=$P(^(0),"^",9),SDN2=$P(^DPT(+SDN1,0),"^"),SDN3=$P(^(0),"^",9),SDN3=$S(SDN3="":"UNKNOWN",1:SDN3) I $D(SDCI) D NM2 Q
"RTN","SDCLAV0",15,0)
 ; SD*5.3*439 added quit if clinic in "S" node not = to selected clinic
"RTN","SDCLAV0",16,0)
 I '$D(SDCI),$D(^DPT(SDN1,"S",SDAP,0)),$P(^(0),"^",2)'["C",$P(^(0),"^",2)'="N",$P(^(0),"^",2)'="NA" Q:$P(^(0),U,1)'=SDC  D NM2 Q
"RTN","SDCLAV0",17,0)
 Q
"RTN","SDCLAV0",18,0)
 ;SD*5.3*490 do not display appts prior to clinic start date
"RTN","SDCLAV0",19,0)
NM2 Q:$P(SDAP,".",1)<$O(^SC(SDC,"T",0))  ;SD*5.3*490
"RTN","SDCLAV0",20,0)
 S:$D(^DPT(SDN1,"S",SDAP,0)) ^UTILITY($J,"SDNMS",D,SDV,SDAP,SDN2,SDN3)=M1_$S(($P(^DPT(SDN1,"S",SDAP,0),"^",2)["C"):"^*",SDC3="C":"^*",($P(^(0),"^",2)="N"):"^**",($P(^(0),"^",2)="NA"):"^**",1:"")
"RTN","SDCLAV0",21,0)
 S:$D(^DPT(SDN1,"S",SDAP,0)) $P(^UTILITY($J,"SDNMS",D,SDV,SDAP,SDN2,SDN3),"^",3)=$S($P(^DPT(SDN1,"S",SDAP,0),"^",7)=4:"***",1:"")
"RTN","SDCLAV0",22,0)
 Q
"RTN","SDCLAV1")
0^3^B39056960^B38646255
"RTN","SDCLAV1",1,0)
SDCLAV1 ;ALB/LDB - OUTPUT PATTERNS (cont.) ; 9/1/00 10:57am
"RTN","SDCLAV1",2,0)
 ;;5.3;Scheduling;**140,167,168,76,383,463,490**;Aug 13, 1993;Build 4
"RTN","SDCLAV1",3,0)
 ;
"RTN","SDCLAV1",4,0)
 ;PATCH 383 STOPPED REPORT FROM CREATING AVAILIBILTY-TEH
"RTN","SDCLAV1",5,0)
 ;
"RTN","SDCLAV1",6,0)
S2 N I1,SC,SDAV,SDMED,SI,SL,SM,SS,STARTDAY,SDDD,YCNT,SDFRST
"RTN","SDCLAV1",7,0)
 S P=0 F D=0:0 S D=$O(^UTILITY($J,"SDNMS",D)) Q:D'>0!(SDUP)  S SDV="",SDZ2=SDBD F X5=0:0 S SDV=$O(^UTILITY($J,"SDNMS",D,SDV)) Q:SDV=""!SDUP  S SDC=$P(^UTILITY($J,"SDNMS",D,SDV),"^",3) D S ;Q:SDUP  ;D WR ;,SS
"RTN","SDCLAV1",8,0)
 Q
"RTN","SDCLAV1",9,0)
S1 S SD=^SC(SDC,0),D=$S($P(SD,"^",15):$P(SD,"^",15),1:$P(^DG(43,1,"GL"),"^",3)),SD5=0,SDNM=$P(SD,"^")
"RTN","SDCLAV1",10,0)
 S $P(^UTILITY($J,"SDNMS",D,SDNM),"^",3)=SDC Q
"RTN","SDCLAV1",11,0)
S I '$D(^SC(SDC,"SL")) D SDM,HDR W !!,"THIS CLINIC DOES NOT HAVE APPT. LENGTH" Q
"RTN","SDCLAV1",12,0)
 S (SDZ,SDZ2)=SDBD D SDM,HDR,TIME S SDZ=SDBD-1,SD0=0,SDMED=SDED+.9
"RTN","SDCLAV1",13,0)
 N X,SDSOH S SC=+SDC,SL=^SC(SC,"SL"),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),X=$P(SL,U,6),SI=$S(X="":4,X<3:4,X:X,1:4),X=SDBD,SDSOH=$P(SL,"^",8),SM=$S($E(X,4,5)[12:$E(X,1,3)+1_"01",1:$E(X,1,3)_$E(X,4,5)+1)_"00",SDZ=SDBD
"RTN","SDCLAV1",14,0)
 ;F Z1=1:1 S SDZ1=SDZ,SDZ=$O(^SC(+SDC,"ST",SDZ)) Q:SDZ'>0!(SDZ>(SDED))!(SDUP)  D SDM D:$E(SDZ,2,5)=$E(SDZ1,2,5) MON I $E(SDZ,2,5)'=$E(SDZ1,2,5) Q:SDUP  D A Q:SDUP  D 3 Q:SDUP  D WR Q:SDUP  D:SD0!($E(IOST,1,2)="C-") 3 Q:SDUP  D HDR,TIME,MON
"RTN","SDCLAV1",15,0)
LOOP D SDM D:0&$E(SDZ,2,5)=$E(SDZ1,2,5) MON I $E(SDZ,2,5)'=$E(SDZ1,2,5) I 'SDUP D X1 I 'SDUP D A I 'SDUP D:SD0!($E(IOST,1,2)="C-") 3 I 'SDUP D WR I 'SDUP,$E(IOST,1,2)="C-" D 3
"RTN","SDCLAV1",16,0)
 I 'SDUP I X<SDED S (X,SDZ2)=$S($E(X,4,5)=12:$E(X,1,3)+1_"01",1:$E(X,1,5)+1)_"01",SDZ=X D SDM,HDR,TIME G LOOP
"RTN","SDCLAV1",17,0)
 Q
"RTN","SDCLAV1",18,0)
SS Q:SDUP  S SDZ=SDZ1,SD5=1
"RTN","SDCLAV1",19,0)
 ;D WR Q:SDUP  D:$E(IOST,1,2)="C-" 3 Q:SDUP  D A D:$E(IOST,1,2)="C-" 3 Q
"RTN","SDCLAV1",20,0)
 D A Q:SDUP  D 3 Q:SDUP  D WR Q:SDUP  D:$E(IOST,1,2)="C-" 3 Q
"RTN","SDCLAV1",21,0)
MON Q:'$D(^SC(+SDC,"ST",SDZ,1))  S SDPT=^SC(+SDC,"ST",SDZ,1) D SDPT1
"RTN","SDCLAV1",22,0)
 Q
"RTN","SDCLAV1",23,0)
SDPT1 I YCNT+6>IOSL D:$E(IOST,1,2)="C-" 3 Q:SDUP  D HDR,TIME
"RTN","SDCLAV1",24,0)
 W !,SDPT S SDAP=SDZ-1 F Z=1:1 S SDAP=$O(^SC(SDC,"S",SDAP)) Q:SDAP'>0!(SDAP>(SDZ+.9999))!SDUP  D NM^SDCLAV0
"RTN","SDCLAV1",25,0)
 D YCNT
"RTN","SDCLAV1",26,0)
 Q
"RTN","SDCLAV1",27,0)
TIME S Z5=$P(^SC(+SDC,"SL"),U,3),SDT=$S(Z5:Z5,1:8),Z5=$P(^("SL"),U,6),SDI=$S(Z5="":4,Z5<3:4,Z5:Z5,1:4)
"RTN","SDCLAV1",28,0)
 W !!," TIME",?SDI+SDI-1 F Z6=SDT:1:65\(SDI+SDI)+SDT W $E("|"_$S('Z6:0,1:(Z6-1#12+1))_"                 ",1,SDI+SDI)
"RTN","SDCLAV1",29,0)
 W !," DATE",?SDI+SDI-1,"|" K J F Z7=0:1:6 I $D(^SC(+SDC,"T"_Z7)) S J(Z7)=""
"RTN","SDCLAV1",30,0)
 S YCNT=YCNT+3
"RTN","SDCLAV1",31,0)
 F Z8=1:1:65\(SDI+SDI) W $J("|",SDI+SDI)
"RTN","SDCLAV1",32,0)
 Q
"RTN","SDCLAV1",33,0)
WR N X S (Y3,X1,SDC1,SD0)=0,C=SDZ2
"RTN","SDCLAV1",34,0)
 F S8=C:0 S SDC1=SDC1+1,C=$O(^UTILITY($J,"SDNMS",D,SDV,C)) Q:C'>0!(C>SDMED&('SD5))!SDUP  S SD0=1 D:SDC1=1 HDR1 S X=C D DW^%DTC S Y=C X ^DD("DD") S Y1=$P(Y,"@"),Y2=$P(Y,"@",2),X9=X W:Y1'=Y3 !!,?1,X9,?11,Y1 D WR1 Q:SDUP
"RTN","SDCLAV1",35,0)
 Q:SDUP  I 'SD0 D HDR1 W !!,"No appointments scheduled"
"RTN","SDCLAV1",36,0)
 D:SD0 A1^SDCLAV S SDZ2=SDZ Q
"RTN","SDCLAV1",37,0)
WR1 S X4="" F X1=0:0 S X4=$O(^UTILITY($J,"SDNMS",D,SDV,C,X4)) Q:X4=""!SDUP  S X6="" F X2=0:0 S X6=$O(^UTILITY($J,"SDNMS",D,SDV,C,X4,X6)) Q:X6=""  D W1
"RTN","SDCLAV1",38,0)
 Q
"RTN","SDCLAV1",39,0)
HDR N X D NOW^%DTC S Y=$E(%,1,12) X ^DD("DD") S YCNT=1 W @IOF,!?52,Y D:$E(IOST,1,2)="P-" PG^SDCLAV
"RTN","SDCLAV1",40,0)
 I $D(^DG(43,1,"GL")),$P(^("GL"),"^",2) W !?30,$P(^DG(40.8,D,0),"^")
"RTN","SDCLAV1",41,0)
 W !?30,SDV,!?30,SDM,"  ",($E(SDZ,1,3)+1700) S YCNT=4 Q
"RTN","SDCLAV1",42,0)
HDR1 S SDZ2=$S(SDZ2=0:SDBD,SDZ2>SDED:SDED,1:SDZ2) W !!,?30,SDV,!,?30,$P(SDM1,"^",+$E(SDZ2,4,5)),"  ",($E(SDZ2,1,3)+1700) S YCNT=YCNT+3 Q
"RTN","SDCLAV1",43,0)
SDM S SDM1="JANUARY^FEBRUARY^MARCH^APRIL^MAY^JUNE^JULY^AUGUST^SEPTEMBER^OCTOBER^NOVEMBER^DECEMBER",SDM=$P(SDM1,"^",+($E(SDZ,4,5))) Q
"RTN","SDCLAV1",44,0)
W S SDUT=^UTILITY($J,"SDNMS",D,SDV,C,X4,X6) S D1="" F D8=2,3 S D1=$S($P(SDUT,"^",D8)]"":$P(SDUT,"^",D8),1:"")_D1
"RTN","SDCLAV1",45,0)
 W D1 Q
"RTN","SDCLAV1",46,0)
W1 S X=C X ^DD("FUNC",2,1) D TAB W:T ?10 W:'T ?11 W X,?20,X4,?51,X6 D MIN W ?61,"("_M1_") MINUTES" D W S Y3=Y1,X1=X9 I YCNT+6>IOSL D 3 Q:SDUP  D HDR1,DAT
"RTN","SDCLAV1",47,0)
 Q
"RTN","SDCLAV1",48,0)
3 N X I $E(IOST,1,2)="C-" F X=$Y:1:IOSL-6 W ! D YCNT
"RTN","SDCLAV1",49,0)
 I  R !!,"PRESS RETURN TO CONTINUE OR ^ TO QUIT  ",SDU:DTIME S:SDU="^"!('$T) SDUP=1
"RTN","SDCLAV1",50,0)
 I YCNT+6'<IOSL,'SDUP W @IOF,! S YCNT=1 D:$E(IOST,1,2)="P-" PG^SDCLAV Q
"RTN","SDCLAV1",51,0)
 Q
"RTN","SDCLAV1",52,0)
A N X D:YCNT+13>IOSL 3 Q:SDUP  D INAC^SDCLAV W !!!,"FOR CLINIC AVAILABILITY PATTERNS:"
"RTN","SDCLAV1",53,0)
 W !!?4,"0-9 and j-z",?15," --denote available slots where j=10,k=11...z=26",!?12,"A-W",?15," --denote overbooks with A being the first slot to be overbooked",!?18,"and B being the second for that same time, etc."
"RTN","SDCLAV1",54,0)
 W !?6,"*,$,!,@,#",?15," --denote overbooks or appts. that fall outside of a clinic's",!?18,"regular hours" S YCNT=YCNT+8 Q
"RTN","SDCLAV1",55,0)
TAB W ! S:$L(X)>7 T=1 S:$L(X)<8 T=0 D YCNT Q
"RTN","SDCLAV1",56,0)
MIN S M1=+^UTILITY($J,"SDNMS",D,SDV,C,X4,X6) Q
"RTN","SDCLAV1",57,0)
DAT I $E($O(^UTILITY($J,"SDNMS",D,SDV,C)),2,7)=$E(C,2,7) W !,?1,X1,?11,Y1 D YCNT
"RTN","SDCLAV1",58,0)
 Q
"RTN","SDCLAV1",59,0)
X1 S X1=X\100_$P("31^28^31^30^31^30^31^31^30^31^30^31",U,$E(X,4,5))
"RTN","SDCLAV1",60,0)
 S X1=$$LEAP(X1) I X1>SDED S X1=SDED
"RTN","SDCLAV1",61,0)
 S SDMED=X1+.9,SDAP=X-.01 F  S SDAP=$O(^SC(SDC,"S",SDAP)) Q:SDAP'>0!(SDAP>(X1+.9999))!SDUP  D NM^SDCLAV0
"RTN","SDCLAV1",62,0)
 D DOW S SDDD=Y
"RTN","SDCLAV1",63,0)
WW ;
"RTN","SDCLAV1",64,0)
 I '$D(^SC(+SC,"ST",X,1)),$$CHKDT() S Y=SDDD#7 G L:'$D(J(Y)),H:$D(^HOLIDAY(X))&('SDSOH) S SS=+$O(^SC(+SC,"T"_Y,X)) G L:SS'>0,L:^(SS,1)="" D
"RTN","SDCLAV1",65,0)
 .S ^SC(+SC,"ST",$P(X,"."),1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(X,6,7)_$J("",SI+SI-6)_^(1),^(0)=$P(X,".")
"RTN","SDCLAV1",66,0)
 ;SD*5.3*490 added GOTO command so dates prior to clinic start date no
"RTN","SDCLAV1",67,0)
 ;longer display on grid
"RTN","SDCLAV1",68,0)
 S SDAV=1 D:X>SM WM I $D(^SC(+SC,"ST",X,1)),^(1)["["!(^(1)["CANCELLED")!($D(^HOLIDAY(X))) G:X<$O(^SC(+SC,"T",0)) L W !,$E(^SC(+SC,"ST",X,1),1,80) D YCNT S:'$D(^HOLIDAY(X))&('SDAV) SDAV=1
"RTN","SDCLAV1",69,0)
 I YCNT+6>IOSL D 3 Q:SDUP  D HDR
"RTN","SDCLAV1",70,0)
L S X=X+1,SDDD=SDDD+1
"RTN","SDCLAV1",71,0)
 G WW:X'>X1 Q
"RTN","SDCLAV1",72,0)
 ;
"RTN","SDCLAV1",73,0)
 ;
"RTN","SDCLAV1",74,0)
 ;
"RTN","SDCLAV1",75,0)
WM W !?36 S Y=$E(X,1,5)_"00",SM=$S($E(X,4,5)[12:$E(X,1,3)+1_"01",1:$E(X,1,3)_$E(X,4,5)+1)_"00" D YCNT
"RTN","SDCLAV1",76,0)
DT W $$FMTE^XLFDT(Y) Q
"RTN","SDCLAV1",77,0)
 ;
"RTN","SDCLAV1",78,0)
DOW S Y=$$DOW^XLFDT(X,1) Q
"RTN","SDCLAV1",79,0)
YCNT S YCNT=YCNT+1 Q
"RTN","SDCLAV1",80,0)
 ;
"RTN","SDCLAV1",81,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDCLAV1",82,0)
DIFF S X1=SDRE,X2=X D ^%DTC S SDDD=SDDD+X,X=SDRE,X1=X\100_28 Q
"RTN","SDCLAV1",83,0)
H S ^SC(+SC,"ST",X,1)="   "_$E(X,6,7)_"    "_$P(^(X,0),U,2),^(0)=X G WW
"RTN","SDCLAV1",84,0)
 ;
"RTN","SDCLAV1",85,0)
LEAP(SDEOM) ;Check for leap year, adjust if indicated
"RTN","SDCLAV1",86,0)
 ;Input: SDEOM=end of month date to adjust for leap year
"RTN","SDCLAV1",87,0)
 Q:$E(SDEOM,4,5)'="02" SDEOM  ; only adjust February
"RTN","SDCLAV1",88,0)
 N SDLEAP
"RTN","SDCLAV1",89,0)
 S SDLEAP=$$FMADD^XLFDT(SDEOM,1)
"RTN","SDCLAV1",90,0)
 Q $S($E(SDLEAP,4,5)="02":SDLEAP,1:SDEOM)
"RTN","SDCLAV1",91,0)
CHKDT() ;
"RTN","SDCLAV1",92,0)
 N Y,RET,SDFA
"RTN","SDCLAV1",93,0)
 I '$D(SDFRST(D,+SC)) D
"RTN","SDCLAV1",94,0)
 .; Create array of days that have a current template.
"RTN","SDCLAV1",95,0)
 .N %H,X,SDFMTDAY,SDAYCNT,SDAYI,SDST,SDAYCHK,SDAYNAM,SDAYNUM
"RTN","SDCLAV1",96,0)
 .S %H=$H
"RTN","SDCLAV1",97,0)
 .D YX^%DTC S SDFMTDAY=X
"RTN","SDCLAV1",98,0)
 .S SDAYCNT=0
"RTN","SDCLAV1",99,0)
 .F SDAYI=0:1:6 D
"RTN","SDCLAV1",100,0)
 ..Q:'$D(^SC(+SC,"T"_SDAYI))
"RTN","SDCLAV1",101,0)
 ..I $O(^SC(+SC,"T"_SDAYI,""),-1)'<SDFMTDAY S SDFRST(D,+SC,SDAYI)="",SDAYCNT=SDAYCNT+1
"RTN","SDCLAV1",102,0)
 .; Calculate first available date for each day that has current template.
"RTN","SDCLAV1",103,0)
 .S SDST=0,SDAYCHK=0
"RTN","SDCLAV1",104,0)
 .F  S SDST=$O(^SC(+SC,"ST",SDST)) Q:SDST=""!(SDAYCHK=SDAYCNT)  D
"RTN","SDCLAV1",105,0)
 ..S SDAYNAM=$E($G(^SC(+SC,"ST",SDST,1)),1,2)
"RTN","SDCLAV1",106,0)
 ..S SDAYNUM=$S(SDAYNAM="MO":1,SDAYNAM="TU":2,SDAYNAM="WE":3,SDAYNAM="TH":4,SDAYNAM="FR":5,SDAYNAM="SA":6,SDAYNAM="SU":0,1:"")
"RTN","SDCLAV1",107,0)
 ..Q:SDAYNUM=""
"RTN","SDCLAV1",108,0)
 ..Q:$G(SDFRST(D,+SC,SDAYNUM))'=""
"RTN","SDCLAV1",109,0)
 ..Q:'$D(^SC(+SC,"T"_SDAYNUM))
"RTN","SDCLAV1",110,0)
 ..S SDFRST(D,+SC,SDAYNUM)=SDST,SDAYCHK=SDAYCHK+1
"RTN","SDCLAV1",111,0)
 ; Get first avail date from array for particular day of week
"RTN","SDCLAV1",112,0)
 S Y=SDDD#7,RET=0
"RTN","SDCLAV1",113,0)
 S SDFA=$G(SDFRST(D,+SC,Y))
"RTN","SDCLAV1",114,0)
 I SDFA'="" D
"RTN","SDCLAV1",115,0)
 .S SDFA=$S(+$H>SDFA:+$H,1:SDFA)
"RTN","SDCLAV1",116,0)
 .I X'<SDFA S RET=1
"RTN","SDCLAV1",117,0)
 Q RET
"RTN","SDM1")
0^2^B40309214^B34209967
"RTN","SDM1",1,0)
SDM1 ;SF/GFT - MAKE APPOINTMENT ; 3/29/05 12:35pm [5/5/05 9:41am]
"RTN","SDM1",2,0)
 ;;5.3;Scheduling;**32,167,168,80,223,263,273,408,327,478,490**;Aug 13, 1993;Build 4
"RTN","SDM1",3,0)
1 L  Q:$D(SDXXX)  S CCXN=0 K MXOK,COV,SDPROT Q:DFN<0  S SC=+SC
"RTN","SDM1",4,0)
 S X1=DT,SDEDT=365 S:$D(^SC(SC,"SDP")) SDEDT=$P(^SC(SC,"SDP"),"^",2)
"RTN","SDM1",5,0)
 S X2=SDEDT D C^%DTC S SDEDT=X D WRT
"RTN","SDM1",6,0)
 I $D(^SC(SC,"SI")),$O(^("SI",0))>0 W !,*7,?8,"**** SPECIAL INSTRUCTIONS ****",! S %I=0 F %=0:1 S %I=$O(^SC(SC,"SI",%I)) Q:%I'>0  W ^(%I,0) W:% ! I '%,$O(^SC(SC,"SI",%I))>0 S POP=0 D SPIN Q:POP
"RTN","SDM1",7,0)
 I $D(SDINA),SDINA>DT D IN W !,?8,@SDMSG K SDMSG
"RTN","SDM1",8,0)
 G:SDMM RDTY^SDMM
"RTN","SDM1",9,0)
 ;
"RTN","SDM1",10,0)
ADT S:'$D(SDW) SDW=""
"RTN","SDM1",11,0)
 S SDSOH=$S('$D(^SC(SC,"SL")):0,$P(^("SL"),"^",8)']"":0,1:1),CCX=""
"RTN","SDM1",12,0)
 S SDONCE=$G(SDONCE)+1  ;Prevent repetitive iteration
"RTN","SDM1",13,0)
 S X=$S(SDONCE<2:$G(SDSDATE),1:"")  ;Use default date/time if specified as 'desired date'  
"RTN","SDM1",14,0)
 I 'X R !,"DATE/TIME: ",X:DTIME G:X="M"!(X="m") MORDIS^SDM0 I "^"[X D WL(SC) Q   ;sd/327
"RTN","SDM1",15,0)
 ;
"RTN","SDM1",16,0)
 I X="D"!(X="d") S X=$$REDDT() G:X>0 MORD2^SDM0 S X="" W "  ??",! G ADT
"RTN","SDM1",17,0)
 I X?1"?".E D  G ADT
"RTN","SDM1",18,0)
 .W !,"Enter a date/time for the appointment"
"RTN","SDM1",19,0)
 .W:$D(SD) " or a space to choose the same date/time as the patient you have just previously scheduled into this clinic"
"RTN","SDM1",20,0)
 .W ".",!,"You may also select 'M' to display the next month's availability or"
"RTN","SDM1",21,0)
 .W !,"'D' to specify an earlier or later date to begin the availability display."
"RTN","SDM1",22,0)
 I X=" ",$D(SD),SD S Y=SD D AT^SDUTL W Y S Y=SD G OVR
"RTN","SDM1",23,0)
 I $E($P(X,"@",2),1,4)?1.4"0" K %DT S X=$P(X,"@"),X=$S($L(X):X,1:"T"),%DT="XF" D ^%DT G ADT:Y'>0 S X1=Y,X2=-1 D C^%DTC S X=X_.24
"RTN","SDM1",24,0)
 K %DT S %DT="TXEF" D ^%DT
"RTN","SDM1",25,0)
 ;SD*5.3*408  verify that day hasn't been canceled via "SET UP A CLINIC"
"RTN","SDM1",26,0)
 I $G(^SC(+SC,"ST",$P(Y,"."),1))'="",^SC(+SC,"ST",$P(Y,"."),1)'["[" D  G ADT
"RTN","SDM1",27,0)
 .W !,"There is no availability for this date/time.",!
"RTN","SDM1",28,0)
 I $P(Y,".",2)=24 S X1=$P(Y,"."),X2=1 D C^%DTC S Y=X_".000001"
"RTN","SDM1",29,0)
OVR I $D(^HOLIDAY($P(Y,"."),0)),'SDSOH W *7,?50,$P(^(0),U,2),"??" K SDSDATE G ADT
"RTN","SDM1",30,0)
 I $D(SDINA),$P(Y,".")'<SDINA,$S('$D(SDRE):1,SDRE>$P(Y,".")!('SDRE):1,1:0) D IN W !,*7,@SDMSG K SDMSG K SDSDATE G ADT
"RTN","SDM1",31,0)
 I Y#1=0 K SDSDATE G 1
"RTN","SDM1",32,0)
 I $P(Y,".")'<SDEDT W !,*7,"EXCEEDS MAXIMUM DAYS FOR FUTURE APPOINTMENT!!",*7 K SDSDATE G ADT
"RTN","SDM1",33,0)
 ;
"RTN","SDM1",34,0)
EN1 S (TMPD,X,SD)=Y,SM=0 D DOW  ;SD/478
"RTN","SDM1",35,0)
 F S=$P(SD,"."):0 S S=+$O(^DPT(DFN,"S",S)) Q:$P(S,".")-($P(SD,"."))  S I=+^(S,0) G ^SDM2:$P(^(0),U,2)'["C"
"RTN","SDM1",36,0)
 ;
"RTN","SDM1",37,0)
PRECAN I $D(^DPT(DFN,"S",SD,0)),$P(^(0),U,2)["P" S %=1 W !,"THIS TIME WAS PREVIOUSLY CANCELLED BY THE PATIENT",!,"ARE YOU SURE THAT YOU WANT TO PROCEED" D YN^DICN W:'% !,"ANSWER WITH (Y)ES OR (N)O" I (%-1) K SDSDATE G ADT
"RTN","SDM1",38,0)
 W !
"RTN","SDM1",39,0)
 ;SD*5.3*490 - AVCHK/AVCHK1 to check against pat DOB and clinic avail dt
"RTN","SDM1",40,0)
S N POP S POP=0 D AVCHK G:POP 1
"RTN","SDM1",41,0)
 N POP S POP=0 D AVCHK1 G:POP 1
"RTN","SDM1",42,0)
 I '$D(^SC(SC,"ST",$P(SD,"."),1)) S SS=+$O(^SC(+SC,"T"_Y,SD)) G XW:SS'>0,XW:^(SS,1)="" S ^SC(+SC,"ST",$P(SD,"."),1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(SD,6,7)_$J("",SI+SI-6)_^(1),^(0)=$P(SD,".")
"RTN","SDM1",43,0)
 ;
"RTN","SDM1",44,0)
LEN I $P(SL,U,2)]"" W !,"LENGTH OF APPOINTMENT (IN MINUTES): ",+SL,"// " R S:DTIME I S]"" G:$L(S)>3 LEN Q:U[S  S POP=0 D L G LEN:POP,S:S\5*5'=S,S:S>360,S:S<5 S SL=S_U_$P(SL,U,2,99)
"RTN","SDM1",45,0)
 ;
"RTN","SDM1",46,0)
SC S SDLOCK=$S('$D(SDLOCK):1,1:SDLOCK+1) G:SDLOCK>9 LOCK
"RTN","SDM1",47,0)
 L ^SC(SC,"ST",$P(SD,"."),1):5 G:'$T SC
"RTN","SDM1",48,0)
 S SDLOCK=0,S=^SC(SC,"ST",$P(SD,"."),1)
"RTN","SDM1",49,0)
 S I=SD#1-SB*100,ST=I#1*SI\.6+($P(I,".")*SI),SS=SL*HSI/60*SDDIF+ST+ST
"RTN","SDM1",50,0)
 G X:(I<1!'$F(S,"["))&(S'["CAN")
"RTN","SDM1",51,0)
 I SM<7 S %=$F(S,"[",SS-1) S:'%!($P(SL,"^",6)<3) %=999 I $F(S,"]",SS)'<%!(SDDIF=2&$E(S,ST+ST+1,SS-1)["[") S SM=7
"RTN","SDM1",52,0)
 ;
"RTN","SDM1",53,0)
SP I ST+ST>$L(S),$L(S)<80 S S=S_" " G SP
"RTN","SDM1",54,0)
 S SDNOT=1   ;SD*5.3*490 naked Do added below
"RTN","SDM1",55,0)
 F I=ST+ST:SDDIF:SS-SDDIF S ST=$E(S,I+1) S:ST="" ST=" " S Y=$E(STR,$F(STR,ST)-2) G C:S["CAN"!(ST="X"&($D(^SC(+SC,"ST",$P(SD,"."),"CAN")))),X:Y="" S:Y'?1NL&(SM<6) SM=6 S ST=$E(S,I+2,999) D  S:ST="" ST=" " S S=$E(S,1,I)_Y_ST
"RTN","SDM1",56,0)
 .Q:ST'=""
"RTN","SDM1",57,0)
 .Q:+SL'>+^SC(SC,"SL")
"RTN","SDM1",58,0)
 .S ST="   "
"RTN","SDM1",59,0)
 .Q
"RTN","SDM1",60,0)
 Q:SDMM  G OK^SDM1A:SM#9=0,^SDM3:$P(SL,U,7)]""&('$D(MXOK))
"RTN","SDM1",61,0)
 ;
"RTN","SDM1",62,0)
E G:'$D(^XUSEC("SDOB",DUZ)) NOOB
"RTN","SDM1",63,0)
 S %=2 W *7,!,$E($T(@SM),5,99),"...OK" D YN^DICN
"RTN","SDM1",64,0)
 I '% W !,"RESPOND YES OR NO" G E
"RTN","SDM1",65,0)
 S SM=9 G SC:'(%-1) K SDSDATE G 1
"RTN","SDM1",66,0)
 ;
"RTN","SDM1",67,0)
LOCK Q:SDMM  W !,*7,"ANOTHER USER HAS LOCKED THIS DATE - TRY AGAIN LATER" Q
"RTN","SDM1",68,0)
 ;
"RTN","SDM1",69,0)
6 ;;OVERBOOK!
"RTN","SDM1",70,0)
7 ;;THAT TIME IS NOT WITHIN SCHEDULED PERIOD!
"RTN","SDM1",71,0)
C S POP=1 W !,*7,"CAN'T BOOK WITHIN A CANCELLED TIME PERIOD!",!
"RTN","SDM1",72,0)
 Q:SDMM  K SDSDATE G 1
"RTN","SDM1",73,0)
 ;
"RTN","SDM1",74,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDM1",75,0)
 ;
"RTN","SDM1",76,0)
DOW S %=$E(X,1,3),Y=$E(X,4,5),Y=Y>2&'(%#4)+$E("144025036146",Y)
"RTN","SDM1",77,0)
 F %=%:-1:281 S Y=%#4=1+1+Y
"RTN","SDM1",78,0)
 S Y=$E(X,6,7)+Y#7 Q
"RTN","SDM1",79,0)
 ;
"RTN","SDM1",80,0)
X I SDMM S POP=1 Q
"RTN","SDM1",81,0)
 G:I<1 XW
"RTN","SDM1",82,0)
 S:Y'?1NL&(SM<6) SM=6
"RTN","SDM1",83,0)
 G OK^SDM1A:SM#9=0,^SDM3:$P(SL,U,7)]""&('$D(MXOK))
"RTN","SDM1",84,0)
XW W *7,"  WHEN??" K SDSDATE G 1
"RTN","SDM1",85,0)
 ;
"RTN","SDM1",86,0)
AVCHK ;added SD*5.3*490
"RTN","SDM1",87,0)
 I '$D(VADM) Q:'DFN  S VADM(3)=$P(^DPT(DFN,0),U,3)
"RTN","SDM1",88,0)
 Q:$P(X,".",1)=$P(VADM(3),U,1)
"RTN","SDM1",89,0)
 I $P(X,".",1)<$P(VADM(3),U,1) W *7,!!,"That date is prior to the patient's date of birth.",!! S POP=1 K SDSDATE Q
"RTN","SDM1",90,0)
 Q
"RTN","SDM1",91,0)
 ;
"RTN","SDM1",92,0)
AVCHK1 ;added SD*5.3*490
"RTN","SDM1",93,0)
 S AVDT=0,AVDT=$O(^SC(+SC,"T",AVDT)) Q:'AVDT
"RTN","SDM1",94,0)
 I $P(X,".",1)<AVDT W *7,!!,"That date is prior to the clinic's availability date.",!! S POP=1 K SDSDATE,AVDT Q
"RTN","SDM1",95,0)
 Q
"RTN","SDM1",96,0)
 ;
"RTN","SDM1",97,0)
NOOB W !,"NO OPEN SLOTS THEN",*7 K SDSDATE G 1
"RTN","SDM1",98,0)
 ;
"RTN","SDM1",99,0)
WRT W !,+SL," MINUTE APPOINTMENTS "
"RTN","SDM1",100,0)
 W $S($P(SL,U,2)["V":"(VARIABLE LENGTH)",1:"") Q
"RTN","SDM1",101,0)
 ;
"RTN","SDM1",102,0)
L S SDSL=$S($P(SL,"^",6)]"":60/$P(SL,"^",6),1:"") Q:'SDSL
"RTN","SDM1",103,0)
 I S\(SDSL)*(SDSL)'=S W *7,!,"Appt. length must = or be a multiple of the increment minutes per hour (",SDSL,")",! S POP=1
"RTN","SDM1",104,0)
 Q
"RTN","SDM1",105,0)
 ;
"RTN","SDM1",106,0)
IN S SDHY=$S($D(Y):Y,1:""),Y=SDINA D DTS^SDUTL S Y1=Y,Y=SDRE
"RTN","SDM1",107,0)
 D:Y DTS^SDUTL
"RTN","SDM1",108,0)
 S SDMSG="""*** Note: Clinic is scheduled to be inactivated on "","_""""_Y1_""""_$S(SDRE:",!,?10,"_""" and reactivated on "","_""""_Y_"""",1:""),Y=SDHY K Y1,SDHY
"RTN","SDM1",109,0)
 Q
"RTN","SDM1",110,0)
 ;
"RTN","SDM1",111,0)
SPIN W !,"There are more special instructions. Do you want to display them"
"RTN","SDM1",112,0)
 S %=2 D YN^DICN
"RTN","SDM1",113,0)
 I '% W !,"Enter Y to see the remaining special instructions, or N if you don't wish to see them" G SPIN
"RTN","SDM1",114,0)
 I (%-1) S POP=1 Q
"RTN","SDM1",115,0)
 W !,^SC(SC,"SI",%I,0),! Q
"RTN","SDM1",116,0)
 ;
"RTN","SDM1",117,0)
REDDT() ;Prompt for availability redisplay date
"RTN","SDM1",118,0)
 N %DT,X,Y
"RTN","SDM1",119,0)
 S %DT="AEX"
"RTN","SDM1",120,0)
 S %DT("A")="DATE TO BEGIN THE RE-DISPLAY OF CLINIC AVAILABILITY: "
"RTN","SDM1",121,0)
 W ! D ^%DT
"RTN","SDM1",122,0)
 Q Y
"RTN","SDM1",123,0)
WL(SC) ;Wait List Hook/teh patch 263 ;SD/327 passed 'SC'
"RTN","SDM1",124,0)
 Q:$G(SC)'>0
"RTN","SDM1",125,0)
 I '$D(^SC(SC)) Q
"RTN","SDM1",126,0)
 I $D(SC) S SDWLFLG=0 D
"RTN","SDM1",127,0)
 .I $D(^SDWL(409.32,"B",+SC)) S SDWLFLG=1
"RTN","SDM1",128,0)
 .I 'SDWLFLG S SDWLDSS=$P($G(^SC(+SC,0)),U,7) I $D(^SDWL(409.31,"B",SDWLDSS)) S SDWLFLG=2 D
"RTN","SDM1",129,0)
 ..I SDWLFLG=1 S SDWLSC=$O(^SDWL(409.32,"B",+SC,0)) I $P(^SDWL(409.32,SDWLSC,0),U,4) S SDWLFLG=0
"RTN","SDM1",130,0)
 .I SDWLFLG=2 S SDWLDS=$O(^SDWL(409.31,"E",DUZ(2),0)) I $D(^SDWL(409.31,SDWLDSS,"I",+SDWLDS,0)),$P(^(0),U,4) S SDWLFLG=0
"RTN","SDM1",131,0)
 .I SDWLFLG D
"RTN","SDM1",132,0)
 ..K SDWLSC,SDWLDSS,SDWLDS,SDWLFLG
"RTN","SDM1",133,0)
 ..S SDWLOPT=1,SDWLERR=0 D OPT^SDWLE D EN^SDWLKIL
"RTN","SDM1",134,0)
 Q
"RTN","SDM1",135,0)
 ;
"VER")
8.0^22.0
"BLD",6826,6)
^396
**END**
**END**
