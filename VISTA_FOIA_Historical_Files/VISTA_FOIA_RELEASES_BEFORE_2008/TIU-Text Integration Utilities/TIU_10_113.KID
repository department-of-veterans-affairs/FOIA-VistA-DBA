KIDS Distribution saved on Jan 29, 2004@09:01:54
TIU*1.0*113 CREATED 01/29/04
**KIDS**:TIU*1.0*113^

**INSTALL NAME**
TIU*1.0*113
"BLD",3182,0)
TIU*1.0*113^TEXT INTEGRATION UTILITIES^0^3040129^y
"BLD",3182,1,0)
^^2^2^3031002^
"BLD",3182,1,1,0)
The description on this patch may be found in the National Patch Module
"BLD",3182,1,2,0)
under TIU*1*113.
"BLD",3182,4,0)
^9.64PA^8925.8^3
"BLD",3182,4,8925,0)
8925
"BLD",3182,4,8925,2,0)
^9.641^8925^1
"BLD",3182,4,8925,2,8925,0)
TIU DOCUMENT  (File-top level)
"BLD",3182,4,8925,2,8925,1,0)
^9.6411^1301^4
"BLD",3182,4,8925,2,8925,1,.01,0)
DOCUMENT TYPE
"BLD",3182,4,8925,2,8925,1,.05,0)
STATUS
"BLD",3182,4,8925,2,8925,1,1212,0)
DIVISION
"BLD",3182,4,8925,2,8925,1,1301,0)
REFERENCE DATE
"BLD",3182,4,8925,222)
y^n^p^^^^n
"BLD",3182,4,8925.4,0)
8925.4
"BLD",3182,4,8925.4,2,0)
^9.641^8925.4^1
"BLD",3182,4,8925.4,2,8925.4,0)
TIU UPLOAD LOG  (File-top level)
"BLD",3182,4,8925.4,2,8925.4,1,0)
^9.6411^.05^2
"BLD",3182,4,8925.4,2,8925.4,1,.05,0)
BUFFER FILE POINTER
"BLD",3182,4,8925.4,2,8925.4,1,.09,0)
DIVISION
"BLD",3182,4,8925.4,222)
y^n^p^^^^n
"BLD",3182,4,8925.8,0)
8925.8
"BLD",3182,4,8925.8,222)
n^n^f^^n^^y^o^n
"BLD",3182,4,8925.8,224)
I Y=13
"BLD",3182,4,"APDD",8925,8925)

"BLD",3182,4,"APDD",8925,8925,.01)

"BLD",3182,4,"APDD",8925,8925,.05)

"BLD",3182,4,"APDD",8925,8925,1212)

"BLD",3182,4,"APDD",8925,8925,1301)

"BLD",3182,4,"APDD",8925.4,8925.4)

"BLD",3182,4,"APDD",8925.4,8925.4,.05)

"BLD",3182,4,"APDD",8925.4,8925.4,.09)

"BLD",3182,4,"B",8925,8925)

"BLD",3182,4,"B",8925.4,8925.4)

"BLD",3182,4,"B",8925.8,8925.8)

"BLD",3182,"ABPKG")
n
"BLD",3182,"INI")

"BLD",3182,"INIT")
BUILD^TIUP113
"BLD",3182,"KRN",0)
^9.67PA^19^17
"BLD",3182,"KRN",.4,0)
.4
"BLD",3182,"KRN",.4,"NM",0)
^9.68A^8^8
"BLD",3182,"KRN",.4,"NM",1,0)
TIU PRINT AUTHOR STATS    FILE #8925^8925^0
"BLD",3182,"KRN",.4,"NM",2,0)
TIU PRINT AUTHOR STATS HEADER    FILE #8925^8925^0
"BLD",3182,"KRN",.4,"NM",3,0)
TIU PRINT REL/UNV    FILE #8925^8925^0
"BLD",3182,"KRN",.4,"NM",4,0)
TIU PRINT REL/UNV HEADER    FILE #8925^8925^0
"BLD",3182,"KRN",.4,"NM",5,0)
TIU PRINT SERVICE STATS    FILE #8925^8925^0
"BLD",3182,"KRN",.4,"NM",6,0)
TIU PRINT SERVICE STATS HEADER    FILE #8925^8925^0
"BLD",3182,"KRN",.4,"NM",7,0)
TIU PRINT TRANS STATS    FILE #8925^8925^0
"BLD",3182,"KRN",.4,"NM",8,0)
TIU PRINT TRANS STATS HEADER    FILE #8925^8925^0
"BLD",3182,"KRN",.4,"NM","B","TIU PRINT AUTHOR STATS    FILE #8925",1)

"BLD",3182,"KRN",.4,"NM","B","TIU PRINT AUTHOR STATS HEADER    FILE #8925",2)

"BLD",3182,"KRN",.4,"NM","B","TIU PRINT REL/UNV    FILE #8925",3)

"BLD",3182,"KRN",.4,"NM","B","TIU PRINT REL/UNV HEADER    FILE #8925",4)

"BLD",3182,"KRN",.4,"NM","B","TIU PRINT SERVICE STATS    FILE #8925",5)

"BLD",3182,"KRN",.4,"NM","B","TIU PRINT SERVICE STATS HEADER    FILE #8925",6)

"BLD",3182,"KRN",.4,"NM","B","TIU PRINT TRANS STATS    FILE #8925",7)

"BLD",3182,"KRN",.4,"NM","B","TIU PRINT TRANS STATS HEADER    FILE #8925",8)

"BLD",3182,"KRN",.401,0)
.401
"BLD",3182,"KRN",.402,0)
.402
"BLD",3182,"KRN",.402,"NM",0)
^9.68A^6^4
"BLD",3182,"KRN",.402,"NM",1,0)
TIU ENTER/EDIT CONSULT RESULT    FILE #8925^8925^0
"BLD",3182,"KRN",.402,"NM",2,0)
TIU ENTER/EDIT DS    FILE #8925^8925^0
"BLD",3182,"KRN",.402,"NM",3,0)
TIU ENTER/EDIT PROGRESS NOTE    FILE #8925^8925^0
"BLD",3182,"KRN",.402,"NM",6,0)
TIU ENTER/EDIT CLINPROC RESULT    FILE #8925^8925^0
"BLD",3182,"KRN",.402,"NM","B","TIU ENTER/EDIT CLINPROC RESULT    FILE #8925",6)

"BLD",3182,"KRN",.402,"NM","B","TIU ENTER/EDIT CONSULT RESULT    FILE #8925",1)

"BLD",3182,"KRN",.402,"NM","B","TIU ENTER/EDIT DS    FILE #8925",2)

"BLD",3182,"KRN",.402,"NM","B","TIU ENTER/EDIT PROGRESS NOTE    FILE #8925",3)

"BLD",3182,"KRN",.403,0)
.403
"BLD",3182,"KRN",.5,0)
.5
"BLD",3182,"KRN",.84,0)
.84
"BLD",3182,"KRN",3.6,0)
3.6
"BLD",3182,"KRN",3.8,0)
3.8
"BLD",3182,"KRN",9.2,0)
9.2
"BLD",3182,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",3182,"KRN",9.8,0)
9.8
"BLD",3182,"KRN",9.8,"NM",0)
^9.68A^40^36
"BLD",3182,"KRN",9.8,"NM",1,0)
TIUEDI3^^0^B37719807
"BLD",3182,"KRN",9.8,"NM",2,0)
TIUELST^^0^B33141590
"BLD",3182,"KRN",9.8,"NM",4,0)
TIULA^^0^B43272352
"BLD",3182,"KRN",9.8,"NM",5,0)
TIULA1^^0^B21656000
"BLD",3182,"KRN",9.8,"NM",6,0)
TIULC1^^0^B48292992
"BLD",3182,"KRN",9.8,"NM",7,0)
TIULV^^0^B31297101
"BLD",3182,"KRN",9.8,"NM",8,0)
TIUPEFIX^^0^B41040237
"BLD",3182,"KRN",9.8,"NM",10,0)
TIUPEVNT^^0^B39544163
"BLD",3182,"KRN",9.8,"NM",12,0)
TIUPUTCN^^0^B29625276
"BLD",3182,"KRN",9.8,"NM",13,0)
TIUPUTPN^^0^B23447967
"BLD",3182,"KRN",9.8,"NM",14,0)
TIUPUTU^^0^B17104342
"BLD",3182,"KRN",9.8,"NM",15,0)
TIUR1^^0^B14639571
"BLD",3182,"KRN",9.8,"NM",16,0)
TIUR2^^0^B57493092
"BLD",3182,"KRN",9.8,"NM",17,0)
TIURC1^^0^B47421093
"BLD",3182,"KRN",9.8,"NM",18,0)
TIURD1^^0^B63370691
"BLD",3182,"KRN",9.8,"NM",19,0)
TIURD2^^0^B69802772
"BLD",3182,"KRN",9.8,"NM",20,0)
TIURD3^^0^B65352875
"BLD",3182,"KRN",9.8,"NM",21,0)
TIURDIV^^0^B58639766
"BLD",3182,"KRN",9.8,"NM",22,0)
TIURE^^0^B28436113
"BLD",3182,"KRN",9.8,"NM",23,0)
TIURECL1^^0^B34751928
"BLD",3182,"KRN",9.8,"NM",24,0)
TIURH^^0^B3848537
"BLD",3182,"KRN",9.8,"NM",25,0)
TIURM^^0^B23864201
"BLD",3182,"KRN",9.8,"NM",26,0)
TIURM1^^0^B39918877
"BLD",3182,"KRN",9.8,"NM",27,0)
TIURPTT1^^0^B29551790
"BLD",3182,"KRN",9.8,"NM",28,0)
TIURTIT1^^0^B29661319
"BLD",3182,"KRN",9.8,"NM",29,0)
TIUSRV^^0^B69167379
"BLD",3182,"KRN",9.8,"NM",30,0)
TIUSRVP^^0^B62427817
"BLD",3182,"KRN",9.8,"NM",31,0)
TIUSRVP1^^0^B34664018
"BLD",3182,"KRN",9.8,"NM",32,0)
TIUTHLP^^0^B8070243
"BLD",3182,"KRN",9.8,"NM",33,0)
TIUTSK^^0^B11141260
"BLD",3182,"KRN",9.8,"NM",35,0)
TIUCPFIX^^0^B57761436
"BLD",3182,"KRN",9.8,"NM",36,0)
TIUPUTCP^^0^B70011947
"BLD",3182,"KRN",9.8,"NM",37,0)
TIUR^^0^B33478636
"BLD",3182,"KRN",9.8,"NM",38,0)
TIUPUTC^^0^B28233192
"BLD",3182,"KRN",9.8,"NM",39,0)
TIUP113^^0^B65597915
"BLD",3182,"KRN",9.8,"NM",40,0)
TIUP113P^^0^B8136391
"BLD",3182,"KRN",9.8,"NM","B","TIUCPFIX",35)

"BLD",3182,"KRN",9.8,"NM","B","TIUEDI3",1)

"BLD",3182,"KRN",9.8,"NM","B","TIUELST",2)

"BLD",3182,"KRN",9.8,"NM","B","TIULA",4)

"BLD",3182,"KRN",9.8,"NM","B","TIULA1",5)

"BLD",3182,"KRN",9.8,"NM","B","TIULC1",6)

"BLD",3182,"KRN",9.8,"NM","B","TIULV",7)

"BLD",3182,"KRN",9.8,"NM","B","TIUP113",39)

"BLD",3182,"KRN",9.8,"NM","B","TIUP113P",40)

"BLD",3182,"KRN",9.8,"NM","B","TIUPEFIX",8)

"BLD",3182,"KRN",9.8,"NM","B","TIUPEVNT",10)

"BLD",3182,"KRN",9.8,"NM","B","TIUPUTC",38)

"BLD",3182,"KRN",9.8,"NM","B","TIUPUTCN",12)

"BLD",3182,"KRN",9.8,"NM","B","TIUPUTCP",36)

"BLD",3182,"KRN",9.8,"NM","B","TIUPUTPN",13)

"BLD",3182,"KRN",9.8,"NM","B","TIUPUTU",14)

"BLD",3182,"KRN",9.8,"NM","B","TIUR",37)

"BLD",3182,"KRN",9.8,"NM","B","TIUR1",15)

"BLD",3182,"KRN",9.8,"NM","B","TIUR2",16)

"BLD",3182,"KRN",9.8,"NM","B","TIURC1",17)

"BLD",3182,"KRN",9.8,"NM","B","TIURD1",18)

"BLD",3182,"KRN",9.8,"NM","B","TIURD2",19)

"BLD",3182,"KRN",9.8,"NM","B","TIURD3",20)

"BLD",3182,"KRN",9.8,"NM","B","TIURDIV",21)

"BLD",3182,"KRN",9.8,"NM","B","TIURE",22)

"BLD",3182,"KRN",9.8,"NM","B","TIURECL1",23)

"BLD",3182,"KRN",9.8,"NM","B","TIURH",24)

"BLD",3182,"KRN",9.8,"NM","B","TIURM",25)

"BLD",3182,"KRN",9.8,"NM","B","TIURM1",26)

"BLD",3182,"KRN",9.8,"NM","B","TIURPTT1",27)

"BLD",3182,"KRN",9.8,"NM","B","TIURTIT1",28)

"BLD",3182,"KRN",9.8,"NM","B","TIUSRV",29)

"BLD",3182,"KRN",9.8,"NM","B","TIUSRVP",30)

"BLD",3182,"KRN",9.8,"NM","B","TIUSRVP1",31)

"BLD",3182,"KRN",9.8,"NM","B","TIUTHLP",32)

"BLD",3182,"KRN",9.8,"NM","B","TIUTSK",33)

"BLD",3182,"KRN",19,0)
19
"BLD",3182,"KRN",19,"NM",0)
^9.68A^11^11
"BLD",3182,"KRN",19,"NM",1,0)
TIU DS LINE COUNT BY AUTHOR^^0
"BLD",3182,"KRN",19,"NM",2,0)
TIU DS LINE COUNT BY SERVICE^^0
"BLD",3182,"KRN",19,"NM",3,0)
TIU DS LINE COUNT BY TRANSCR^^0
"BLD",3182,"KRN",19,"NM",4,0)
TIU RELEASED/UNVERIFIED REPORT^^0
"BLD",3182,"KRN",19,"NM",5,0)
TIU REVIEW FILING EVENTS^^0
"BLD",3182,"KRN",19,"NM",6,0)
TIU UNSIGNED/UNCOSIGNED REPORT^^0^
"BLD",3182,"KRN",19,"NM",7,0)
TIU UPLOAD MENU^^0
"BLD",3182,"KRN",19,"NM",8,0)
TIU MAIN MENU MRT^^2
"BLD",3182,"KRN",19,"NM",9,0)
TIU MAIN MENU MGR^^2
"BLD",3182,"KRN",19,"NM",10,0)
TIU UPLOAD DOCUMENTS^^0
"BLD",3182,"KRN",19,"NM",11,0)
TIU UPLOAD HELP^^0
"BLD",3182,"KRN",19,"NM","B","TIU DS LINE COUNT BY AUTHOR",1)

"BLD",3182,"KRN",19,"NM","B","TIU DS LINE COUNT BY SERVICE",2)

"BLD",3182,"KRN",19,"NM","B","TIU DS LINE COUNT BY TRANSCR",3)

"BLD",3182,"KRN",19,"NM","B","TIU MAIN MENU MGR",9)

"BLD",3182,"KRN",19,"NM","B","TIU MAIN MENU MRT",8)

"BLD",3182,"KRN",19,"NM","B","TIU RELEASED/UNVERIFIED REPORT",4)

"BLD",3182,"KRN",19,"NM","B","TIU REVIEW FILING EVENTS",5)

"BLD",3182,"KRN",19,"NM","B","TIU UNSIGNED/UNCOSIGNED REPORT",6)

"BLD",3182,"KRN",19,"NM","B","TIU UPLOAD DOCUMENTS",10)

"BLD",3182,"KRN",19,"NM","B","TIU UPLOAD HELP",11)

"BLD",3182,"KRN",19,"NM","B","TIU UPLOAD MENU",7)

"BLD",3182,"KRN",19.1,0)
19.1
"BLD",3182,"KRN",101,0)
101
"BLD",3182,"KRN",409.61,0)
409.61
"BLD",3182,"KRN",409.61,"NM",0)
^9.68A^13^13
"BLD",3182,"KRN",409.61,"NM",1,0)
TIU REVIEW BY PATIENT & TITLE^^0
"BLD",3182,"KRN",409.61,"NM",2,0)
TIU REVIEW BY TITLE^^0
"BLD",3182,"KRN",409.61,"NM",3,0)
TIU REVIEW DS CLINICIAN^^0
"BLD",3182,"KRN",409.61,"NM",4,0)
TIU REVIEW FILING EVENTS^^0
"BLD",3182,"KRN",409.61,"NM",5,0)
TIU REVIEW PN CLINICIAN^^0
"BLD",3182,"KRN",409.61,"NM",6,0)
TIU REVIEW SCREEN CLINICIAN^^0
"BLD",3182,"KRN",409.61,"NM",7,0)
TIU REVIEW SCREEN DS UNSIGNED^^0
"BLD",3182,"KRN",409.61,"NM",8,0)
TIU REVIEW SCREEN MGR^^0
"BLD",3182,"KRN",409.61,"NM",9,0)
TIU REVIEW SCREEN MRT^^0
"BLD",3182,"KRN",409.61,"NM",10,0)
TIU REVIEW SCREEN PN UNSIGNED^^0
"BLD",3182,"KRN",409.61,"NM",11,0)
TIU REVIEW SCREEN READ ONLY^^0
"BLD",3182,"KRN",409.61,"NM",12,0)
TIU SEARCH LIST MGR^^0
"BLD",3182,"KRN",409.61,"NM",13,0)
TIU SEARCH LIST MRT^^0
"BLD",3182,"KRN",409.61,"NM","B","TIU REVIEW BY PATIENT & TITLE",1)

"BLD",3182,"KRN",409.61,"NM","B","TIU REVIEW BY TITLE",2)

"BLD",3182,"KRN",409.61,"NM","B","TIU REVIEW DS CLINICIAN",3)

"BLD",3182,"KRN",409.61,"NM","B","TIU REVIEW FILING EVENTS",4)

"BLD",3182,"KRN",409.61,"NM","B","TIU REVIEW PN CLINICIAN",5)

"BLD",3182,"KRN",409.61,"NM","B","TIU REVIEW SCREEN CLINICIAN",6)

"BLD",3182,"KRN",409.61,"NM","B","TIU REVIEW SCREEN DS UNSIGNED",7)

"BLD",3182,"KRN",409.61,"NM","B","TIU REVIEW SCREEN MGR",8)

"BLD",3182,"KRN",409.61,"NM","B","TIU REVIEW SCREEN MRT",9)

"BLD",3182,"KRN",409.61,"NM","B","TIU REVIEW SCREEN PN UNSIGNED",10)

"BLD",3182,"KRN",409.61,"NM","B","TIU REVIEW SCREEN READ ONLY",11)

"BLD",3182,"KRN",409.61,"NM","B","TIU SEARCH LIST MGR",12)

"BLD",3182,"KRN",409.61,"NM","B","TIU SEARCH LIST MRT",13)

"BLD",3182,"KRN",771,0)
771
"BLD",3182,"KRN",870,0)
870
"BLD",3182,"KRN",8994,0)
8994
"BLD",3182,"KRN","B",.4,.4)

"BLD",3182,"KRN","B",.401,.401)

"BLD",3182,"KRN","B",.402,.402)

"BLD",3182,"KRN","B",.403,.403)

"BLD",3182,"KRN","B",.5,.5)

"BLD",3182,"KRN","B",.84,.84)

"BLD",3182,"KRN","B",3.6,3.6)

"BLD",3182,"KRN","B",3.8,3.8)

"BLD",3182,"KRN","B",9.2,9.2)

"BLD",3182,"KRN","B",9.8,9.8)

"BLD",3182,"KRN","B",19,19)

"BLD",3182,"KRN","B",19.1,19.1)

"BLD",3182,"KRN","B",101,101)

"BLD",3182,"KRN","B",409.61,409.61)

"BLD",3182,"KRN","B",771,771)

"BLD",3182,"KRN","B",870,870)

"BLD",3182,"KRN","B",8994,8994)

"BLD",3182,"PRE")
TIUEN113
"BLD",3182,"QUES",0)
^9.62^^0
"BLD",3182,"REQB",0)
^9.611^11^10
"BLD",3182,"REQB",1,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",3182,"REQB",2,0)
TIU*1.0*72^2
"BLD",3182,"REQB",3,0)
TIU*1.0*75^2
"BLD",3182,"REQB",4,0)
TIU*1.0*118^2
"BLD",3182,"REQB",5,0)
TIU*1.0*124^2
"BLD",3182,"REQB",6,0)
TIU*1.0*131^2
"BLD",3182,"REQB",7,0)
TIU*1.0*145^2
"BLD",3182,"REQB",8,0)
TIU*1.0*152^2
"BLD",3182,"REQB",10,0)
TIU*1.0*167^2
"BLD",3182,"REQB",11,0)
DG*5.3*534^2
"BLD",3182,"REQB","B","DG*5.3*534",11)

"BLD",3182,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",1)

"BLD",3182,"REQB","B","TIU*1.0*118",4)

"BLD",3182,"REQB","B","TIU*1.0*124",5)

"BLD",3182,"REQB","B","TIU*1.0*131",6)

"BLD",3182,"REQB","B","TIU*1.0*145",7)

"BLD",3182,"REQB","B","TIU*1.0*152",8)

"BLD",3182,"REQB","B","TIU*1.0*167",10)

"BLD",3182,"REQB","B","TIU*1.0*72",2)

"BLD",3182,"REQB","B","TIU*1.0*75",3)

"DATA",8925.8,13,0)
DIVISION^ADIV^Division
"DATA",8925.8,13,2)
S Y=$$GETDIV^TIULA1
"FIA",8925)
TIU DOCUMENT
"FIA",8925,0)
^TIU(8925,
"FIA",8925,0,0)
8925IPs
"FIA",8925,0,1)
y^n^p^^^^n
"FIA",8925,0,10)

"FIA",8925,0,11)

"FIA",8925,0,"RLRO")

"FIA",8925,0,"VR")
1.0^TIU
"FIA",8925,8925)
1
"FIA",8925,8925,.01)

"FIA",8925,8925,.05)

"FIA",8925,8925,1212)

"FIA",8925,8925,1301)

"FIA",8925.4)
TIU UPLOAD LOG
"FIA",8925.4,0)
^TIU(8925.4,
"FIA",8925.4,0,0)
8925.4D
"FIA",8925.4,0,1)
y^n^p^^^^n
"FIA",8925.4,0,10)

"FIA",8925.4,0,11)

"FIA",8925.4,0,"RLRO")

"FIA",8925.4,0,"VR")
1.0^TIU
"FIA",8925.4,8925.4)
1
"FIA",8925.4,8925.4,.05)

"FIA",8925.4,8925.4,.09)

"FIA",8925.8)
TIU SEARCH CATEGORIES
"FIA",8925.8,0)
^TIU(8925.8,
"FIA",8925.8,0,0)
8925.8
"FIA",8925.8,0,1)
n^n^f^^n^^y^o^n
"FIA",8925.8,0,10)

"FIA",8925.8,0,11)
I Y=13
"FIA",8925.8,0,"RLRO")

"FIA",8925.8,0,"VR")
1.0^TIU
"FIA",8925.8,8925.8)
0
"INIT")
BUILD^TIUP113
"IX",8925,8925,"ADIV",0)
8925^ADIV^Index on DIVISION, DOCUMENT TYPE, STATUS, and REFERENCE DATE^R^^R^IR^I^8925^^^^^S
"IX",8925,8925,"ADIV",.1,0)
^^2^2^3030418^
"IX",8925,8925,"ADIV",.1,1,0)
This Regular New style-type, multi- field cross-reference is optimized for
"IX",8925,8925,"ADIV",.1,2,0)
searching division, document type, status, and reference date range.
"IX",8925,8925,"ADIV",1)
S ^TIU(8925,"ADIV",X(1),X(2),X(3),X(4),DA)=""
"IX",8925,8925,"ADIV",2)
K ^TIU(8925,"ADIV",X(1),X(2),X(3),X(4),DA)
"IX",8925,8925,"ADIV",2.5)
K ^TIU(8925,"ADIV")
"IX",8925,8925,"ADIV",11.1,0)
^.114IA^4^4
"IX",8925,8925,"ADIV",11.1,1,0)
1^F^8925^1212^^1^F
"IX",8925,8925,"ADIV",11.1,1,3)

"IX",8925,8925,"ADIV",11.1,2,0)
2^F^8925^.01^^2^F
"IX",8925,8925,"ADIV",11.1,2,3)

"IX",8925,8925,"ADIV",11.1,3,0)
3^F^8925^.05^^3^F
"IX",8925,8925,"ADIV",11.1,3,3)

"IX",8925,8925,"ADIV",11.1,4,0)
4^F^8925^1301^^4^F
"IX",8925,8925,"ADIV",11.1,4,2)
S X=9999999-X
"IX",8925,8925,"ADIV",11.1,4,3)
S X=9999999-X
"KRN",.4,671,-1)
0^3
"KRN",.4,671,0)
TIU PRINT REL/UNV^3030418.1135^^8925^^^3040128
"KRN",.4,671,"DCL","8925^.1")
&
"KRN",.4,671,"DXS",1,9.2)
S DIP(2)=$S($D(^TIU(8925,D0,12)):^(12),1:"") S X="LAST,FI MI",DIP(1)=$G(X) S X=$P($G(^VA(200,+$P(DIP(2),U,2),0)),U)
"KRN",.4,671,"DXS",2,"P")
priority
"KRN",.4,671,"DXS",2,"R")
routine
"KRN",.4,671,"F",1)
.02~-9000001,^AUPNPAT(^^S I(0,0)=D0 S DIP(1)=$S($D(^TIU(8925,D0,0)):^(0),1:"") S X=$P(DIP(1),U,2),X=X S D(0)=+X;Z;".02:"~
"KRN",.4,671,"F",2)
-9000001,-2,^DPT(^^S I(100,0)=D0 S DIP(101)=$S($D(^AUPNPAT(D0,0)):^(0),1:"") S X=$P(DIP(101),U,1),X=X S D(0)=+X;Z;".01:"~-9000001,-2,.09;"SSN"~
"KRN",.4,671,"F",3)
S DIP(1)=$S($D(^TIU(8925,D0,0)):^(0),1:"") S X=$P(DIP(1),U,7) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;"ADM DATE";Z;"NUMDATE(EPISODE BEGIN DATE/TIME)"~
"KRN",.4,671,"F",4)
S DIP(1)=$S($D(^TIU(8925,D0,0)):^(0),1:"") S X=$P(DIP(1),U,8) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;"DIS DATE";Z;"NUMDATE(EPISODE END DATE/TIME)"~
"KRN",.4,671,"F",5)
X DXS(1,9.2) S X1=DIP(1) X "S X=$$NAME^TIULS(X,X1)" W X K DIP;L15;"DICTATED BY";Z;"TIU NAME FORMAT("LAST,FI MI",AUTHOR)"~.09~.1~.01;L8;""~
"KRN",.4,671,"H")
[TIU PRINT REL/UNV HEADER]
"KRN",.4,671,"IOM")
132
"KRN",.4,671,"LAST")

"KRN",.4,671,"ROU")
^TIUPREL
"KRN",.4,671,"ROUOLD")
TIUPREL
"KRN",.4,671,"STATS","DITTO",1)

"KRN",.4,671,"STATS","S",1)
0
"KRN",.4,671,"T",93)
8^1^0^F^
"KRN",.4,672,-1)
0^1
"KRN",.4,672,0)
TIU PRINT AUTHOR STATS^3030418.1131^@^8925^^@^3030624
"KRN",.4,672,"DCL","8925^.1")
+
"KRN",.4,672,"DCL","8925^0")
+
"KRN",.4,672,"DXS",1,9.2)
S DIP(2)=$S($D(^TIU(8925,D0,12)):^(12),1:"") S X="LAST,FI MI",DIP(1)=$G(X) S X=$P($G(^VA(200,+$P(DIP(2),U,2),0)),U)
"KRN",.4,672,"DXS",2,9)
X DXS(2,9.2) S DIP(101)=$S($D(^AUPNPAT(D0,0)):^(0),1:"") S X=$P($G(^DPT(+$P(DIP(101),U,1),0)),U),X1=DIP(1) X "S X=$$NAME^TIULS(X,X1)" S X=X S D0=I(0,0)
"KRN",.4,672,"DXS",2,9.2)
S I(0,0)=$G(D0),DIP(2)=$S($D(^TIU(8925,D0,0)):^(0),1:"") S X="LAST,FI MI",DIP(1)=$G(X),DIP(3)=$G(X),D0=$P(DIP(2),U,2) S:'D0!'$D(^AUPNPAT(+D0,0)) D0=-1
"KRN",.4,672,"DXS",3,9.2)
S DIP(3)=$S($D(^TIU(8925,D0,0)):^(0),1:""),DIP(1)=$S($D(^TIU(8925,D0,13)):^(13),1:"") S X=$P(DIP(1),U,7),DIP(2)=$G(X) S X=$P(DIP(3),U,8)
"KRN",.4,672,"DXS",4,9.2)
S DIP(1)=$S($D(^TIU(8925,D0,12)):^(12),1:""),DIP(3)=$S($D(^TIU(8925,D0,13)):^(13),1:"") S X=$P(DIP(1),U,1),DIP(2)=$G(X) S X=$P(DIP(3),U,7)
"KRN",.4,672,"DXS",5,9.2)
S DIP(3)=$S($D(^TIU(8925,D0,12)):^(12),1:""),DIP(1)=$S($D(^TIU(8925,D0,15)):^(15),1:"") S X=$P(DIP(1),U,1),DIP(2)=$G(X) S X=$P(DIP(3),U,1)
"KRN",.4,672,"DXS",6,9)
S DIP(1)=$S($D(^TIU(8925,D0,15)):^(15),1:"") S X=$P(DIP(1),U,7),DIP(2)=$G(X) S X=$P(DIP(1),U,1),X1=DIP(2) D ^XUWORKDY
"KRN",.4,672,"F",1)
X DXS(1,9.2) S X1=DIP(1) X "S X=$$NAME^TIULS(X,X1)" W X K DIP;N;L15;"Author";Z;"TIU NAME FORMAT("LAST,FI MI",AUTHOR)"~.1;C17;R8;"Line Count"~
"KRN",.4,672,"F",2)
S DIP(1)=$S($D(^TIU(8925,D0,13)):^(13),1:"") S X=$P(DIP(1),U,1),X=$P(X,".",1) S Y=X D DT K DIP;L11;C28;"Ref Date";d;Z;"DATE(REFERENCE DATE)"~
"KRN",.4,672,"F",3)
X DXS(2,9) W X K DIP;L15;C42;"Patient";Z;"TIU NAME FORMAT("LAST,FI MI",PATIENT)"~
"KRN",.4,672,"F",4)
X DXS(3,9.2) S X1=DIP(2) D ^XUWORKDY;C59;R3;"Disch-Dict";;Z;"XUWORKDAY(DICTATION DATE,EPISODE END DATE/TIME)";+~
"KRN",.4,672,"F",5)
X DXS(4,9.2) S X1=DIP(2) D ^XUWORKDY;C75;R3;"Dict-Transcr";;Z;"XUWORKDAY(ENTRY DATE,DICTATION DATE)";+~
"KRN",.4,672,"F",6)
X DXS(5,9.2) S X1=DIP(2) D ^XUWORKDY;C90;R3;"Transcr-Sign";;Z;"XUWORKDAY(SIGNATURE DATE,ENTRY DATE)";+~
"KRN",.4,672,"F",7)
X DXS(6,9);C105;R3;"Sign-Cosign";;Z;"XUWORKDAY(COSIGNATURE DATE,SIGNATURE DATE)";+~.01;C120;L8;X~
"KRN",.4,672,"H")
[TIU PRINT AUTHOR STATS HEADER]
"KRN",.4,672,"IOM")
132
"KRN",.4,672,"LAST")

"KRN",.4,672,"ROU")
^TIUSTA
"KRN",.4,672,"ROUOLD")
TIUSTA
"KRN",.4,672,"STATS","DITTO",1)

"KRN",.4,672,"STATS","N",2)
0
"KRN",.4,672,"STATS","N",3)
0
"KRN",.4,672,"STATS","N",4)
0
"KRN",.4,672,"STATS","N",5)
0
"KRN",.4,672,"STATS","N",6)
0
"KRN",.4,672,"STATS","S",2)
0
"KRN",.4,672,"STATS","S",3)
0
"KRN",.4,672,"STATS","S",4)
0
"KRN",.4,672,"STATS","S",5)
0
"KRN",.4,672,"STATS","S",6)
0
"KRN",.4,672,"T",16)
8^2^1^F^
"KRN",.4,672,"T",58)
3^3^1^C^
"KRN",.4,672,"T",74)
3^4^1^C^
"KRN",.4,672,"T",89)
3^5^1^C^
"KRN",.4,672,"T",104)
3^6^1^C^
"KRN",.4,673,-1)
0^7
"KRN",.4,673,0)
TIU PRINT TRANS STATS^3030418.1133^@^8925^^@^3030919
"KRN",.4,673,"DCL","8925^.1")
+
"KRN",.4,673,"DCL","8925^0")
+
"KRN",.4,673,"DXS",1,9)
X DXS(1,9.2) S DIP(101)=$S($D(^AUPNPAT(D0,0)):^(0),1:"") S X=$P($G(^DPT(+$P(DIP(101),U,1),0)),U),X1=DIP(1) X "S X=$$NAME^TIULS(X,X1)" S X=X S D0=I(0,0)
"KRN",.4,673,"DXS",1,9.2)
S I(0,0)=$G(D0),DIP(2)=$S($D(^TIU(8925,D0,0)):^(0),1:"") S X="LAST,FI MI",DIP(1)=$G(X),DIP(3)=$G(X),D0=$P(DIP(2),U,2) S:'D0!'$D(^AUPNPAT(+D0,0)) D0=-1
"KRN",.4,673,"DXS",2,9.2)
S DIP(3)=$S($D(^TIU(8925,D0,0)):^(0),1:""),DIP(1)=$S($D(^TIU(8925,D0,13)):^(13),1:"") S X=$P(DIP(1),U,7),DIP(2)=$G(X) S X=$P(DIP(3),U,8)
"KRN",.4,673,"DXS",3,9.2)
S DIP(1)=$S($D(^TIU(8925,D0,12)):^(12),1:""),DIP(3)=$S($D(^TIU(8925,D0,13)):^(13),1:"") S X=$P(DIP(1),U,1),DIP(2)=$G(X) S X=$P(DIP(3),U,7)
"KRN",.4,673,"DXS",4,9.2)
S DIP(3)=$S($D(^TIU(8925,D0,12)):^(12),1:""),DIP(1)=$S($D(^TIU(8925,D0,15)):^(15),1:"") S X=$P(DIP(1),U,1),DIP(2)=$G(X) S X=$P(DIP(3),U,1)
"KRN",.4,673,"DXS",5,9)
S DIP(1)=$S($D(^TIU(8925,D0,15)):^(15),1:"") S X=$P(DIP(1),U,7),DIP(2)=$G(X) S X=$P(DIP(1),U,1),X1=DIP(2) D ^XUWORKDY
"KRN",.4,673,"F",1)
1302;N;L15;"Transciber"~.1;C17;R8;"Line Count"~
"KRN",.4,673,"F",2)
S DIP(1)=$S($D(^TIU(8925,D0,13)):^(13),1:"") S X=$P(DIP(1),U,1),X=$P(X,".",1) S Y=X D DT K DIP;L11;C28;"Ref Date";d;Z;"DATE(REFERENCE DATE)"~
"KRN",.4,673,"F",3)
X DXS(1,9) W X K DIP;L15;C42;"Patient";Z;"TIU NAME FORMAT("LAST,FI MI",PATIENT)"~
"KRN",.4,673,"F",4)
X DXS(2,9.2) S X1=DIP(2) D ^XUWORKDY;C59;R3;"Disch-Dict";;Z;"XUWORKDAY(DICTATION DATE,EPISODE END DATE/TIME)";+~
"KRN",.4,673,"F",5)
X DXS(3,9.2) S X1=DIP(2) D ^XUWORKDY;C75;R3;"Dict-Transcr";;Z;"XUWORKDAY(ENTRY DATE,DICTATION DATE)";+~
"KRN",.4,673,"F",6)
X DXS(4,9.2) S X1=DIP(2) D ^XUWORKDY;C90;R3;"Transcr-Sign";;Z;"XUWORKDAY(SIGNATURE DATE,ENTRY DATE)";+~
"KRN",.4,673,"F",7)
X DXS(5,9);C105;R3;"Sign-Cosign";;Z;"XUWORKDAY(COSIGNATURE DATE,SIGNATURE DATE)";+~.01;C120;L8;X~
"KRN",.4,673,"H")
[TIU PRINT TRANS STATS HEADER]
"KRN",.4,673,"IOM")
132
"KRN",.4,673,"LAST")

"KRN",.4,673,"ROU")
^TIUSTT
"KRN",.4,673,"ROUOLD")
TIUSTT
"KRN",.4,673,"STATS","DITTO",1)

"KRN",.4,673,"STATS","N",2)
0
"KRN",.4,673,"STATS","N",3)
0
"KRN",.4,673,"STATS","N",4)
0
"KRN",.4,673,"STATS","N",5)
0
"KRN",.4,673,"STATS","N",6)
0
"KRN",.4,673,"STATS","S",2)
0
"KRN",.4,673,"STATS","S",3)
0
"KRN",.4,673,"STATS","S",4)
0
"KRN",.4,673,"STATS","S",5)
0
"KRN",.4,673,"STATS","S",6)
0
"KRN",.4,673,"T",16)
8^2^1^F^
"KRN",.4,673,"T",58)
3^3^1^C^
"KRN",.4,673,"T",74)
3^4^1^C^
"KRN",.4,673,"T",89)
3^5^1^C^
"KRN",.4,673,"T",104)
3^6^1^C^
"KRN",.4,674,-1)
0^5
"KRN",.4,674,0)
TIU PRINT SERVICE STATS^3030418.1132^@^8925^^@^3040128
"KRN",.4,674,"DCL","8925^.1")
+
"KRN",.4,674,"DCL","8925^0")
+
"KRN",.4,674,"DXS",1,9)
X DXS(1,9.2) S DIP(101)=$S($D(^AUPNPAT(D0,0)):^(0),1:"") S X=$P($G(^DPT(+$P(DIP(101),U,1),0)),U),X1=DIP(1) X "S X=$$NAME^TIULS(X,X1)" S X=X S D0=I(0,0)
"KRN",.4,674,"DXS",1,9.2)
S I(0,0)=$G(D0),DIP(2)=$S($D(^TIU(8925,D0,0)):^(0),1:"") S X="LAST,FI MI",DIP(1)=$G(X),DIP(3)=$G(X),D0=$P(DIP(2),U,2) S:'D0!'$D(^AUPNPAT(+D0,0)) D0=-1
"KRN",.4,674,"DXS",2,9.2)
S DIP(3)=$S($D(^TIU(8925,D0,0)):^(0),1:""),DIP(1)=$S($D(^TIU(8925,D0,13)):^(13),1:"") S X=$P(DIP(1),U,7),DIP(2)=$G(X) S X=$P(DIP(3),U,8)
"KRN",.4,674,"DXS",3,9.2)
S DIP(1)=$S($D(^TIU(8925,D0,12)):^(12),1:""),DIP(3)=$S($D(^TIU(8925,D0,13)):^(13),1:"") S X=$P(DIP(1),U,1),DIP(2)=$G(X) S X=$P(DIP(3),U,7)
"KRN",.4,674,"DXS",4,9.2)
S DIP(3)=$S($D(^TIU(8925,D0,12)):^(12),1:""),DIP(1)=$S($D(^TIU(8925,D0,15)):^(15),1:"") S X=$P(DIP(1),U,1),DIP(2)=$G(X) S X=$P(DIP(3),U,1)
"KRN",.4,674,"DXS",5,9)
S DIP(1)=$S($D(^TIU(8925,D0,15)):^(15),1:"") S X=$P(DIP(1),U,7),DIP(2)=$G(X) S X=$P(DIP(1),U,1),X1=DIP(2) D ^XUWORKDY
"KRN",.4,674,"F",1)
1404;N;L15;"Service"~.1;C17;R8;"Line Count"~
"KRN",.4,674,"F",2)
S DIP(1)=$S($D(^TIU(8925,D0,13)):^(13),1:"") S X=$P(DIP(1),U,1),X=$P(X,".",1) S Y=X D DT K DIP;L11;C28;"Ref Date";d;Z;"DATE(REFERENCE DATE)"~
"KRN",.4,674,"F",3)
X DXS(1,9) W X K DIP;L15;C42;"Patient";Z;"TIU NAME FORMAT("LAST,FI MI",PATIENT)"~
"KRN",.4,674,"F",4)
X DXS(2,9.2) S X1=DIP(2) D ^XUWORKDY;C59;R3;"Disch-Dict";;Z;"XUWORKDAY(DICTATION DATE,EPISODE END DATE/TIME)";+~
"KRN",.4,674,"F",5)
X DXS(3,9.2) S X1=DIP(2) D ^XUWORKDY;C75;R3;"Dict-Transcr";;Z;"XUWORKDAY(ENTRY DATE,DICTATION DATE)";+~
"KRN",.4,674,"F",6)
X DXS(4,9.2) S X1=DIP(2) D ^XUWORKDY;C90;R3;"Transcr-Sign";;Z;"XUWORKDAY(SIGNATURE DATE,ENTRY DATE)";+~
"KRN",.4,674,"F",7)
X DXS(5,9);C105;R3;"Sign-Cosign";;Z;"XUWORKDAY(COSIGNATURE DATE,SIGNATURE DATE)";+~.01;C120;L8;X~
"KRN",.4,674,"H")
[TIU PRINT SERVICE STATS HEADER]
"KRN",.4,674,"IOM")
132
"KRN",.4,674,"LAST")

"KRN",.4,674,"ROU")
^TIUSTS
"KRN",.4,674,"ROUOLD")
TIUSTS
"KRN",.4,674,"STATS","DITTO",1)

"KRN",.4,674,"STATS","N",2)
0
"KRN",.4,674,"STATS","N",3)
0
"KRN",.4,674,"STATS","N",4)
0
"KRN",.4,674,"STATS","N",5)
0
"KRN",.4,674,"STATS","N",6)
0
"KRN",.4,674,"STATS","S",2)
0
"KRN",.4,674,"STATS","S",3)
0
"KRN",.4,674,"STATS","S",4)
0
"KRN",.4,674,"STATS","S",5)
0
"KRN",.4,674,"STATS","S",6)
0
"KRN",.4,674,"T",16)
8^2^1^F^
"KRN",.4,674,"T",58)
3^3^1^C^
"KRN",.4,674,"T",74)
3^4^1^C^
"KRN",.4,674,"T",89)
3^5^1^C^
"KRN",.4,674,"T",104)
3^6^1^C^
"KRN",.4,1091,-1)
0^8
"KRN",.4,1091,0)
TIU PRINT TRANS STATS HEADER^3010711.1201^@^8925^^@^3030919
"KRN",.4,1091,"F",1)
"DISCHARGE SUMMARY Line Count Statistics by TRANSCRIPTIONIST - "~1212;X~
"KRN",.4,1091,"F",2)
S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) S Y=X D DT K DIP;C100;L18;d;Z;"NOW"~"PAGE ";C122~
"KRN",.4,1091,"F",3)
S X=$S($D(DC)#2:DC,1:"") W X K DIP;X;Z;"PAGE"~"Line";C21~"Transcriber";C1~"Count";C20~"Ref Date";C28~"Patient";C42~"Disch-Dict";C59~"Dict-Transcr";C75~
"KRN",.4,1091,"F",4)
"Transcr-Sign";C90~"Sign-Cosign";C105~
"KRN",.4,1091,"F",5)
S X="-",DIP(1)=X,DIP(2)=X,X=$S($D(IOM):IOM,1:80) S X=X,X1=DIP(1) S %=X,X="" Q:X1=""  S $P(X,X1,%\$L(X1)+1)=X1,X=$E(X,1,%) W X K DIP;C1;Z;"DUP("-",IOM)"~
"KRN",.4,1091,"H")
@
"KRN",.4,1091,"SUB")
1
"KRN",.4,1093,-1)
0^4
"KRN",.4,1093,0)
TIU PRINT REL/UNV HEADER^3010711.12^@^8925^^@^3040128
"KRN",.4,1093,"F",1)
"Released/Unverified Report - "~1212;X~S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) S Y=X D DT K DIP;C100;L18;d;Z;"NOW"~"PAGE ";C122~
"KRN",.4,1093,"F",2)
S X=$S($D(DC)#2:DC,1:"") W X K DIP;X;Z;"PAGE"~"LINE";C94~"PATIENT";C1~"SSN";C33~"ADM DATE";C45~"DIS DATE";C56~"DICTATED BY";C67~"URGENCY";C84~
"KRN",.4,1093,"F",3)
"COUNT";C94~
"KRN",.4,1093,"F",4)
S X="-",DIP(1)=X,DIP(2)=X,X=$S($D(IOM):IOM,1:80) S X=X,X1=DIP(1) S %=X,X="" Q:X1=""  S $P(X,X1,%\$L(X1)+1)=X1,X=$E(X,1,%) W X K DIP;C1;Z;"DUP("-",IOM)"~
"KRN",.4,1093,"H")
@
"KRN",.4,1093,"SUB")
1
"KRN",.4,1094,-1)
0^2
"KRN",.4,1094,0)
TIU PRINT AUTHOR STATS HEADER^3010711.116^@^8925^^@^3030624
"KRN",.4,1094,"F",1)
"DISCHARGE SUMMARY Line Count Statistics by AUTHOR - "~1212;X~
"KRN",.4,1094,"F",2)
S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) S Y=X D DT K DIP;C100;L18;d;Z;"NOW"~"PAGE ";C122~
"KRN",.4,1094,"F",3)
S X=$S($D(DC)#2:DC,1:"") W X K DIP;X;Z;"PAGE"~"Line";C21~"Author";C1~"Count";C20~"Ref Date";C28~"Patient";C42~"Disch-Dict";C59~"Dict-Transcr";C75~
"KRN",.4,1094,"F",4)
"Transcr-Sign";C90~"Sign-Cosign";C105~
"KRN",.4,1094,"F",5)
S X="-",DIP(1)=X,DIP(2)=X,X=$S($D(IOM):IOM,1:80) S X=X,X1=DIP(1) S %=X,X="" Q:X1=""  S $P(X,X1,%\$L(X1)+1)=X1,X=$E(X,1,%) W X K DIP;C1;Z;"DUP("-",IOM)"~
"KRN",.4,1094,"H")
@
"KRN",.4,1094,"SUB")
1
"KRN",.4,1095,-1)
0^6
"KRN",.4,1095,0)
TIU PRINT SERVICE STATS HEADER^3010711.1201^@^8925^^@^3040128
"KRN",.4,1095,"F",1)
"DISCHARGE SUMMARY Line Count Statistics by SERVICE - "~1212;X~
"KRN",.4,1095,"F",2)
S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) S Y=X D DT K DIP;C100;L18;d;Z;"NOW"~"PAGE ";C122~
"KRN",.4,1095,"F",3)
S X=$S($D(DC)#2:DC,1:"") W X K DIP;X;Z;"PAGE"~"Line";C21~"Service";C1~"Count";C20~"Ref Date";C28~"Patient";C42~"Disch-Dict";C59~"Dict-Transcr";C75~
"KRN",.4,1095,"F",4)
"Transcr-Sign";C90~"Sign-Cosign";C105~
"KRN",.4,1095,"F",5)
S X="-",DIP(1)=X,DIP(2)=X,X=$S($D(IOM):IOM,1:80) S X=X,X1=DIP(1) S %=X,X="" Q:X1=""  S $P(X,X1,%\$L(X1)+1)=X1,X=$E(X,1,%) W X K DIP;C1;Z;"DUP("-",IOM)"~
"KRN",.4,1095,"H")
@
"KRN",.4,1095,"SUB")
1
"KRN",.402,915,-1)
0^2
"KRN",.402,915,0)
TIU ENTER/EDIT DS^3030418.1055^^8925^^^3031119
"KRN",.402,915,"AR",8925,254)
1^TIUEDS20
"KRN",.402,915,"DIAB",3,0,8925,1)
1202//^S X=$$PERSNAME^TIULC1(DUZ);REQ
"KRN",.402,915,"DIAB",6,0,8925,1)
1202//^S X=$S($G(TIUAUTH):$$PERSNAME^TIULC1(TIUAUTH),1:"");REQ
"KRN",.402,915,"DIAB",7,0,8925,3)
1209;REQ
"KRN",.402,915,"DIAB",8,0,8925,1)
1307;REQ
"KRN",.402,915,"DR",1,8925)
.02////^S X=DFN;.03////^S X=$P($G(TIU("VISIT")),U);I $P(^TIU(8925,+DA,0),U,7)]"" S Y="@1";.07////^S X=$P(TIU("EDT"),U);@1;I $P(^TIU(8925,+DA,0),U,8)]"" S Y="@2";.08////^S X=$P(TIU("LDT"),U);@2;.09//routine;
"KRN",.402,915,"DR",1,8925,1)
I +$G(^TIU(8925,+DA,15)) S Y="@3";I +$$PROVIDER^TIUPXAP1(DUZ,DT)'>0 S Y="@8";1202R~//^S X=$$PERSNAME^TIULC1(DUZ);S Y="@3";@8;1202R~//^S X=$S($G(TIUAUTH):$$PERSNAME^TIULC1(TIUAUTH),1:"");@3;1307R~;Q;
"KRN",.402,915,"DR",1,8925,2)
S TIUREFDT=$$REFDATE^TIULC1(.TIU,+X);I +$P(TIUREFDT,U,2)'>0 S Y="@4";.12////^S X=1;@4;1301////^S X=$P(TIUREFDT,U);I +$P($G(^TIU(8925,+DA,13)),U,2) S Y="@5";1302////^S X=DUZ;@5;I $P($G(^TIU(8925,+DA,13)),U,3)]"" S Y="@6";
"KRN",.402,915,"DR",1,8925,3)
1303////^S X="D";@6;I +$P($G(^TIU(8925,+DA,12)),U) S Y="@7";1201////^S X=$$NOW^TIULC;@7;I +$$PROVIDER^TIUPXAP1(DUZ,DT)'>0 S Y="@9";1209R~;S Y="@10";@9;1209;@10;1204////^S X=$$WHOSIGNS^TIULC1(DA);1208////^S X=$$WHOCOSIG^TIULC1(DA);
"KRN",.402,915,"DR",1,8925,4)
1506////^S X=$S(+$P($G(^TIU(8925,+DA,12)),U,4)=+$P($G(^TIU(8925,+DA,12)),U,9):0,1:1);1401////^S X=$G(TIU("AD#"));1402////^S X=$P(TIU("TS"),U);1404////^S X=$P($G(TIU("SVC")),U);1205////^S X=$P($G(TIU("LOC")),U);
"KRN",.402,915,"DR",1,8925,5)
1212////^S X=$P($G(TIU("INST")),U);
"KRN",.402,915,"ROU")
^TIUEDS
"KRN",.402,915,"ROUOLD")
TIUEDS
"KRN",.402,917,-1)
0^3
"KRN",.402,917,0)
TIU ENTER/EDIT PROGRESS NOTE^3030418.1057^^8925^^^3040122
"KRN",.402,917,"DIAB",1,0,8925,4)
AUTHOR/DICTATOR//^S X=$$PERSNAME^TIULC1($S($D(TIUAUTH):+TIUAUTH,1:+DUZ));T;REQ
"KRN",.402,917,"DIAB",4,0,8925,7)
EXPECTED COSIGNER//^S X=TIUDCSNR;REQ
"KRN",.402,917,"DIAB",5,0,8925,3)
REFERENCE DATE//^S X=$$DATE^TIULS($$NOW^XLFDT,"MM/DD/YY@HR:MIN");T
"KRN",.402,917,"DIAB",8,0,8925,7)
EXPECTED COSIGNER;REQ
"KRN",.402,917,"DR",1,8925)
.02////^S X=DFN;.03////^S X=$P($G(TIU("VISIT")),U);.07////^S X=$P($G(TIU("EDT")),U);.08////^S X=$P($G(TIU("LDT")),U);1401////^S X=$P($G(TIU("AD#")),U);I '+$G(TIUBY) S Y="@1";I +$P($G(^TIU(8925,+DA,12)),U,5) S Y="@13";
"KRN",.402,917,"DR",1,8925,1)
1205////^S X=$P($G(TIU("LOC")),U);1212////^S X=$P($G(TIU("INST")),U);@13;I +$G(^TIU(8925,+DA,13)) S Y="@14";1301////^S X=$$NOW^TIULC;@14;I +$P($G(^TIU(8925,+DA,12)),U,2) S Y="@1";1202////^S X=$S($D(TIUAUTH):+TIUAUTH,1:+$G(DUZ));@1;
"KRN",.402,917,"DR",1,8925,2)
I +$G(TIUBY) S Y="@2";I $P($G(^SC(+$G(TIU("LOC")),0)),U,3)="W" S Y="@3";1205////^S X=$P($G(TIU("LOC")),U);S Y="@4";@3;1205//^S X=$P($G(TIU("LOC")),U,2);@4;I +$P($G(^TIU(8925,+DA,12)),U,5) S Y="@16";1212////^S X=+$G(DUZ(2));
"KRN",.402,917,"DR",1,8925,3)
S Y="@17";@16;1212////^S X=+$$DIVISION^TIULC1(+$P($G(^TIU(8925,+DA,12)),U,5));@17;1301T~//^S X=$$DATE^TIULS($$NOW^XLFDT,"MM/DD/YY@HR:MIN");I +$$DATENOTE^TIULA3($$DATE^TIULS(X,"MM/DD/YY@HR:MIN:SEC"))'>0 S Y="@4";
"KRN",.402,917,"DR",1,8925,4)
1202R~T~//^S X=$$PERSNAME^TIULC1($S($D(TIUAUTH):+TIUAUTH,1:+DUZ));I +$G(TIUAUTH),(+$P(^TIU(8925,+DA,12),U,2)'=+$G(TIUAUTH)) S TIU("SVC")=$$PROVSVC^TIULV(+$P(^(12),U,2)),TIUAUTH=+$P(^TIU(8925,+DA,12),U,2);@2;
"KRN",.402,917,"DR",1,8925,5)
1204////^S X=$P($G(^TIU(8925,+DA,12)),U,2);S TIUESNR=X;I +$P($G(^TIU(8925,+DA,13)),U,2) S Y="@5";1302////^S X=DUZ;@5;I +$P($G(^TIU(8925,+DA,12)),U) S Y="@6";1201////^S X=$$NOW^TIULC;@6;
"KRN",.402,917,"DR",1,8925,6)
S TIURQCS=+$$REQCOSIG^TIULP(+$G(TIUTYP),+DA,+$G(TIUESNR));I 'TIURQCS,($L($P($G(^TIU(8925,+DA,12)),U,8))'>0) S Y="@7";I +TIURQCS S Y="@15";W !!,"No cosignature is required for this author.",!;1208///@;1506///@;S Y="@7";@15;
"KRN",.402,917,"DR",1,8925,7)
I +$$ISA^USRLM(DUZ,"TRANSCRIPTIONIST") S Y="@8";S TIUDCSNR=$$PERSNAME^TIULC1(+$P($G(TIUPREF),U,9));I TIUDCSNR="UNKNOWN" S Y="@11";1208R~//^S X=TIUDCSNR;K TIUDCSNR;S Y="@9";@11;1208R~;S Y="@9";@8;1208;@9;1506////1;@7;
"KRN",.402,917,"DR",1,8925,8)
I +$P($G(TIUPREF),U,8)'>0,($G(^TIU(8925,+DA,17))']"") S Y="@10";1701;@10;K TIUESNR,TIURQCS;I $P($G(^TIU(8925,+DA,13)),U,3)]"" S Y="@12";1303////^S X="D";@12;
"KRN",.402,917,"ROUOLD")
TIUEPN
"KRN",.402,1012,-1)
0^1
"KRN",.402,1012,0)
TIU ENTER/EDIT CONSULT RESULT^3030418.105^@^8925^^@^3040120
"KRN",.402,1012,"DIAB",1,0,8925,4)
1202//^S X=$$PERSNAME^TIULC1($S($D(TIUAUTH):+TIUAUTH,1:+DUZ));T;REQ
"KRN",.402,1012,"DIAB",1,0,8925,7)
1208//^S X=TIUDCSNR;REQ
"KRN",.402,1012,"DIAB",3,0,8925,3)
1301//^S X=$$DATE^TIULS($$NOW^XLFDT,"MM/DD/YY@HR:MIN");T
"KRN",.402,1012,"DIAB",5,0,8925,7)
1208;REQ
"KRN",.402,1012,"DIAB",12,0,8925,7)
1405////^S X=$$GETCNSLT^TIUCNSLT(DFN);T
"KRN",.402,1012,"DR",1,8925)
.02////^S X=DFN;.03////^S X=$P($G(TIU("VISIT")),U);.07////^S X=$P($G(TIU("EDT")),U);.08////^S X=$P($G(TIU("LDT")),U);I '+$G(TIUBY) S Y="@1";I +$P($G(^TIU(8925,+DA,12)),U,5) S Y="@13";1205////^S X=$P($G(TIU("LOC")),U);
"KRN",.402,1012,"DR",1,8925,1)
1212////^S X=$P($G(TIU("INST")),U);@13;I +$G(^TIU(8925,+DA,13)) S Y="@14";1301////^S X=$$NOW^TIULC;@14;I +$P($G(^TIU(8925,+DA,12)),U,2) S Y="@1";1202////^S X=$S($D(TIUAUTH):+TIUAUTH,1:+$G(DUZ));@1;I +$G(TIUBY) S Y="@2";
"KRN",.402,1012,"DR",1,8925,2)
I $P($G(^SC(+$G(TIU("LOC")),0)),U,3)="W" S Y="@3";1205////^S X=$P($G(TIU("LOC")),U);S Y="@4";@3;1205//^S X=$P($G(TIU("LOC")),U,2);@4;I +$P($G(^TIU(8925,+DA,12)),U,5) S Y="@15";1212////^S X=+$G(DUZ(2));S Y="@16";@15;
"KRN",.402,1012,"DR",1,8925,3)
1212////^S X=+$$DIVISION^TIULC1(+$P($G(^TIU(8925,+DA,12)),U,5));@16;1301T~//^S X=$$DATE^TIULS($$NOW^XLFDT,"MM/DD/YY@HR:MIN");I +$$DATENOTE^TIULA3($$DATE^TIULS(X,"MM/DD/YY@HR:MIN:SEC"))'>0 S Y="@4";
"KRN",.402,1012,"DR",1,8925,4)
1202R~T~//^S X=$$PERSNAME^TIULC1($S($D(TIUAUTH):+TIUAUTH,1:+DUZ));Q;I +$G(TIUAUTH),(+$P(^TIU(8925,+DA,12),U,2)'=+$G(TIUAUTH)) S TIU("SVC")=$$PROVSVC^TIULV(+$P(^(12),U,2)),TIUAUTH=+$P(^TIU(8925,+DA,12),U,2);@2;
"KRN",.402,1012,"DR",1,8925,5)
1204////^S X=$P($G(^TIU(8925,+DA,12)),U,2);S TIUESNR=X;I +$P($G(^TIU(8925,+DA,13)),U,2) S Y="@5";1302////^S X=DUZ;@5;I +$P($G(^TIU(8925,+DA,12)),U) S Y="@6";1201////^S X=$$NOW^TIULC;@6;
"KRN",.402,1012,"DR",1,8925,6)
I '+$$REQCOSIG^TIULP(+$G(TIUTYP),+DA,+$G(TIUESNR)),($L($P($G(^TIU(8925,+DA,12)),U,8))'>0) S Y="@7";I +$$ISA^USRLM(DUZ,"TRANSCRIPTIONIST") S Y="@8";S TIUDCSNR=$$PERSNAME^TIULC1(+$P($G(TIUPREF),U,9));I TIUDCSNR="UNKNOWN" S Y="@11";
"KRN",.402,1012,"DR",1,8925,7)
1208R~//^S X=TIUDCSNR;K TIUDCSNR;S Y="@9";@11;1208R~;S Y="@9";@8;1208;@9;1506////1;@7;1405T~////^S X=$$GETCNSLT^TIUCNSLT(DFN);I +X'>0 W !,"You may only enter a result for a valid Consult Request.",! S Y=0,TIUQUIT=1;
"KRN",.402,1012,"DR",1,8925,8)
I +$P($G(TIUPREF),U,8)'>0,($G(^TIU(8925,+DA,17))']"") S Y="@10";1701;@10;K TIUESNR;I $P($G(^TIU(8925,+DA,13)),U,3)]"" S Y="@12";1303////^S X="D";@12;
"KRN",.402,1386,-1)
0^6
"KRN",.402,1386,0)
TIU ENTER/EDIT CLINPROC RESULT^3030418.1053^^8925^^^3031106
"KRN",.402,1386,"DIAB",2,0,8925,4)
1202//^S X=$$PERSNAME^TIULC1($S($D(TIUAUTH):+TIUAUTH,1:+DUZ));T;REQ
"KRN",.402,1386,"DIAB",4,0,8925,7)
1208//^S X=TIUDCSNR;REQ
"KRN",.402,1386,"DIAB",7,0,8925,3)
1301//^S X=$$DATE^TIULS($$NOW^XLFDT,"MM/DD/YY@HR:MIN");T
"KRN",.402,1386,"DIAB",8,0,8925,7)
1208;REQ
"KRN",.402,1386,"DIAB",10,0,8925,11)
70201;REQ
"KRN",.402,1386,"DIAB",11,0,8925,11)
70202;REQ
"KRN",.402,1386,"DR",1,8925)
S DIE("NO^")="";.02////^S X=DFN;.03////^S X=$P($G(TIU("VISIT")),U);.07////^S X=$P($G(TIU("EDT")),U);.08////^S X=$P($G(TIU("LDT")),U);1401////^S X=$P($G(TIU("AD#")),U);I '+$G(TIUBY) S Y="@1";
"KRN",.402,1386,"DR",1,8925,1)
I +$P($G(^TIU(8925,+DA,12)),U,5) S Y="@13";1205////^S X=$P($G(TIU("LOC")),U);1212////^S X=$P($G(TIU("INST")),U);@13;I +$G(^TIU(8925,+DA,13)) S Y="@14";1301////^S X=$$NOW^TIULC;@14;I +$P($G(^TIU(8925,+DA,12)),U,2) S Y="@1";
"KRN",.402,1386,"DR",1,8925,2)
1202////^S X=$S($D(TIUAUTH):+TIUAUTH,1:+$G(DUZ));@1;I +$G(TIUBY) S Y="@2";I $P($G(^SC(+$G(TIU("LOC")),0)),U,3)="W" S Y="@3";1205////^S X=$P($G(TIU("LOC")),U);S Y="@4";@3;1205//^S X=$P($G(TIU("LOC")),U,2);@4;
"KRN",.402,1386,"DR",1,8925,3)
I +$P($G(^TIU(8925,+DA,12)),U,5) S Y="@16";1212////^S X=+$G(DUZ(2));S Y="@17";@16;1212////^S X=+$$DIVISION^TIULC1(+$P($G(^TIU(8925,+DA,12)),U,5));@17;1301T~//^S X=$$DATE^TIULS($$NOW^XLFDT,"MM/DD/YY@HR:MIN");
"KRN",.402,1386,"DR",1,8925,4)
I +$$DATENOTE^TIULA3($$DATE^TIULS(X,"MM/DD/YY@HR:MIN:SEC"))'>0 S Y="@4";1202R~T~//^S X=$$PERSNAME^TIULC1($S($D(TIUAUTH):+TIUAUTH,1:+DUZ));Q;
"KRN",.402,1386,"DR",1,8925,5)
I +$G(TIUAUTH),(+$P(^TIU(8925,+DA,12),U,2)'=+$G(TIUAUTH)) S TIU("SVC")=$$PROVSVC^TIULV(+$P(^(12),U,2)),TIUAUTH=+$P(^TIU(8925,+DA,12),U,2);@2;1204////^S X=$P($G(^TIU(8925,+DA,12)),U,2);S TIUESNR=X;
"KRN",.402,1386,"DR",1,8925,6)
I +$P($G(^TIU(8925,+DA,13)),U,2) S Y="@5";1302////^S X=DUZ;@5;I +$P($G(^TIU(8925,+DA,12)),U) S Y="@6";1201////^S X=$$NOW^TIULC;@6;I '+$$REQCOSIG^TIULP(+$G(TIUTYP),+DA,+$G(TIUESNR)),($L($P($G(^TIU(8925,+DA,12)),U,8))'>0) S Y="@7";
"KRN",.402,1386,"DR",1,8925,7)
I +$$ISA^USRLM(DUZ,"TRANSCRIPTIONIST") S Y="@8";S TIUDCSNR=$$PERSNAME^TIULC1(+$P($G(TIUPREF),U,9));I TIUDCSNR="UNKNOWN" S Y="@11";1208R~//^S X=TIUDCSNR;K TIUDCSNR;S Y="@9";@11;1208R~;S Y="@9";@8;1208;@9;1506////1;@7;
"KRN",.402,1386,"DR",1,8925,8)
S TIUCDA=+$P($G(^TIU(8925,+DA,14)),U,5);I TIUCDA S Y="@15";S TIUCVP=$$GETCNSLT^TIUCNSLT(DFN,1);I +TIUCVP'>0 W !,"You may only enter a result for a valid Clinical Procedure Request.",! S Y="@999",TIUQUIT=1;
"KRN",.402,1386,"DR",1,8925,9)
S TIUCPACT=$$CPACTM^GMRCCP(+TIUCVP);I TIUCPACT=2 W !,"Document cannot be edited.  Results are not available to interpret." S Y="@999",TIUQUIT=1;
"KRN",.402,1386,"DR",1,8925,10)
I TIUCPACT=3 W !,"Document cannot be entered.  An incomplete document already exists." S Y="@999",TIUQUIT=1;S TIUCDA=+TIUCVP;1405////^S X=TIUCVP;@15;I +$P($G(TIUPREF),U,8)'>0,($G(^TIU(8925,+DA,17))']"") S Y="@10";1701;@10;
"KRN",.402,1386,"DR",1,8925,11)
K TIUESNR;I $P($G(^TIU(8925,+DA,13)),U,3)]"" S Y="@12";1303////^S X="D";@12;I $$REQCPF^TIULP(+$G(TIUCDA)) S Y="@20";70201;70202;S Y="@999";@20;70201R~;70202R~;@999;K TIUCDA,TIUCVP,TIUCPACT;
"KRN",19,4762,-1)
2^8
"KRN",19,4762,0)
TIU MAIN MENU MRT^Text Integration Utilities (MRT)^^M^11^^^^^^y^193^^1^^^1
"KRN",19,4762,10,0)
^19.01IP^15^7
"KRN",19,4762,10,11,0)
5177^3^3
"KRN",19,4762,10,11,"^")
TIU REVIEW FILING EVENTS
"KRN",19,4762,10,13,0)
5248^5^5
"KRN",19,4762,10,13,"^")
TIU RELEASED/UNVERIFIED REPORT
"KRN",19,4762,10,15,0)
8613^7^7
"KRN",19,4762,10,15,"^")
TIU UNSIGNED/UNCOSIGNED REPORT
"KRN",19,4762,"U")
TEXT INTEGRATION UTILITIES (MR
"KRN",19,4763,-1)
2^9
"KRN",19,4763,0)
TIU MAIN MENU MGR^Text Integration Utilities (MIS Manager)^^M^11^^^^^^y^193^^1^^^1
"KRN",19,4763,10,0)
^19.01IP^13^6
"KRN",19,4763,10,13,0)
8613^6^6
"KRN",19,4763,10,13,"^")
TIU UNSIGNED/UNCOSIGNED REPORT
"KRN",19,4763,"U")
TEXT INTEGRATION UTILITIES (MI
"KRN",19,5140,-1)
0^10
"KRN",19,5140,0)
TIU UPLOAD DOCUMENTS^Upload Documents^^A^^^^^^^y^TEXT INTEGRATION UTILITIES^^1
"KRN",19,5140,1,0)
^19.06^4^4^3030612^^
"KRN",19,5140,1,1,0)
This option enables the user to upload transcribed ASCII documents
"KRN",19,5140,1,2,0)
in batch mode, either from remote microcomputers, using ASCII or
"KRN",19,5140,1,3,0)
KERMIT protocol upload, or from Host Files (i.e., DOS or VMS ASCII files)
"KRN",19,5140,1,4,0)
on the host system.
"KRN",19,5140,20)
D MAIN^TIUUPLD
"KRN",19,5140,99)
55420,26251
"KRN",19,5140,"U")
UPLOAD DOCUMENTS
"KRN",19,5141,-1)
0^11
"KRN",19,5141,0)
TIU UPLOAD HELP^Help for Upload Utility^^A^^^^^^^y^TEXT INTEGRATION UTILITIES^^1
"KRN",19,5141,1,0)
^^4^4^2950818^
"KRN",19,5141,1,1,0)
Displays information on the formats of headers for dictated documents that
"KRN",19,5141,1,2,0)
are transcribed off-line and uploaded into DHCP.  Also displays "blank"
"KRN",19,5141,1,3,0)
character, major delimiter and end of message signal as defined by your
"KRN",19,5141,1,4,0)
site.
"KRN",19,5141,20)
D MAIN^TIUTHLP
"KRN",19,5141,99)
55720,40354
"KRN",19,5141,"U")
HELP FOR UPLOAD UTILITY
"KRN",19,5142,-1)
0^7
"KRN",19,5142,0)
TIU UPLOAD MENU^Upload Menu^^M^^^^^^^^TEXT INTEGRATION UTILITIES^^1
"KRN",19,5142,1,0)
^^3^3^2950818^^
"KRN",19,5142,1,1,0)
This menu includes options to upload batches of documents, and to obtain
"KRN",19,5142,1,2,0)
help on the header formats for the various documents which have been
"KRN",19,5142,1,3,0)
defined for upload by your site.
"KRN",19,5142,10,0)
^19.01IP^4^2
"KRN",19,5142,10,3,0)
5141^2^2
"KRN",19,5142,10,3,"^")
TIU UPLOAD HELP
"KRN",19,5142,10,4,0)
5140^1^1
"KRN",19,5142,10,4,"^")
TIU UPLOAD DOCUMENTS
"KRN",19,5142,20)
D DIV^TIUTHLP
"KRN",19,5142,99)
59098,58421
"KRN",19,5142,"U")
UPLOAD MENU
"KRN",19,5177,-1)
0^5
"KRN",19,5177,0)
TIU REVIEW FILING EVENTS^Review Upload Filing Events^^A^^^^^^^n^TEXT INTEGRATION UTILITIES^^1^1
"KRN",19,5177,1,0)
^^6^6^3030418^
"KRN",19,5177,1,1,0)
This option allows the user to generate a list of all upload filing events
"KRN",19,5177,1,2,0)
(i.e., SUCCESSES, FILING ERRORS, or MISSING FIELD ERRORS) by division,
"KRN",19,5177,1,3,0)
status (e.g., RESOLVED, UNRESOLVED, or ALL), and by date range. The user
"KRN",19,5177,1,4,0)
can then act on selected errors to either print the corresponding error
"KRN",19,5177,1,5,0)
records, or resolve the error (e.g., correct the Patient SSN or Admission
"KRN",19,5177,1,6,0)
date), and retry the filer.  
"KRN",19,5177,15)
K TIUEDT,TIULDT
"KRN",19,5177,20)
K VALMY D EN^VALM("TIU REVIEW FILING EVENTS")
"KRN",19,5177,99)
55431,50702
"KRN",19,5177,"U")
REVIEW UPLOAD FILING EVENTS
"KRN",19,5248,-1)
0^4
"KRN",19,5248,0)
TIU RELEASED/UNVERIFIED REPORT^Released/Unverified Report^^P^^^^^^^y^TEXT INTEGRATION UTILITIES
"KRN",19,5248,1,0)
^^6^6^2960423^^^^
"KRN",19,5248,1,1,0)
This is a report that will give information on Documents for a specified
"KRN",19,5248,1,2,0)
time period that have been released from transcription but still aren't
"KRN",19,5248,1,3,0)
verified. 
"KRN",19,5248,1,4,0)
 
"KRN",19,5248,1,5,0)
This menu action can be eliminated if Transcription Release or MAS 
"KRN",19,5248,1,6,0)
Verification parameters are not enabled.
"KRN",19,5248,2)
y
"KRN",19,5248,60)
TIU(8925,
"KRN",19,5248,61)
1
"KRN",19,5248,62)
0
"KRN",19,5248,63)
[TIU PRINT REL/UNV]
"KRN",19,5248,64)
#@1212,1304;L7;S;C20,+1302;C3;"TRANSCRIPTIONIST: "
"KRN",19,5248,65)
?,?,@
"KRN",19,5248,66)
?,?,
"KRN",19,5248,67)

"KRN",19,5248,69)
I +$$REQVER^TIULC1(+$P(^TIU(8925,+D0,0),U),+D0),(+$P(^TIU(8925,D0,13),U,5)'>0)
"KRN",19,5248,99)
55581,69549
"KRN",19,5248,"U")
RELEASED/UNVERIFIED REPORT
"KRN",19,5272,-1)
0^1
"KRN",19,5272,0)
TIU DS LINE COUNT BY AUTHOR^AUTHOR Line Count Statistics^^P^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",19,5272,1,0)
^^2^2^2960508^^^^
"KRN",19,5272,1,1,0)
This option allows generation of statistical reports of line counts and
"KRN",19,5272,1,2,0)
timeliness data by AUTHOR (or Dictating practitioner).
"KRN",19,5272,60)
TIU(8925,
"KRN",19,5272,61)
1
"KRN",19,5272,62)
0
"KRN",19,5272,63)
[TIU PRINT AUTHOR STATS]
"KRN",19,5272,64)
#@1212,+@1202;S1,-@1301
"KRN",19,5272,65)
?,,?
"KRN",19,5272,66)
?,,?
"KRN",19,5272,67)

"KRN",19,5272,69)
I +$$BELONGS^TIULX(+D0,244)
"KRN",19,5272,"U")
AUTHOR LINE COUNT STATISTICS
"KRN",19,5274,-1)
0^3
"KRN",19,5274,0)
TIU DS LINE COUNT BY TRANSCR^TRANSCRIPTIONIST Line Count Statistics^^P^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",19,5274,1,0)
^^3^3^2960508^^
"KRN",19,5274,1,1,0)
This option allows generation of statistical reports of line counts and
"KRN",19,5274,1,2,0)
timeliness data by TRANSCRIPTIONIST (or the Person by whom the document
"KRN",19,5274,1,3,0)
was entered).
"KRN",19,5274,60)
TIU(8925,
"KRN",19,5274,61)
1
"KRN",19,5274,62)
0
"KRN",19,5274,63)
[TIU PRINT TRANS STATS]
"KRN",19,5274,64)
#@1212,+@1302;S1,-@1301
"KRN",19,5274,65)
?,,?
"KRN",19,5274,66)
?,,?
"KRN",19,5274,67)

"KRN",19,5274,69)
I +$$BELONGS^TIULX(+D0,244)
"KRN",19,5274,"U")
TRANSCRIPTIONIST LINE COUNT ST
"KRN",19,5275,-1)
0^2
"KRN",19,5275,0)
TIU DS LINE COUNT BY SERVICE^SERVICE Line Count Statistics^^P^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",19,5275,1,0)
^^3^3^2960508^^
"KRN",19,5275,1,1,0)
This option allows generation of statistical reports of line counts and
"KRN",19,5275,1,2,0)
timeliness data by SERVICE (e.g., Medical Service, Surgical Service,
"KRN",19,5275,1,3,0)
Psychiatry Service, etc.).
"KRN",19,5275,60)
TIU(8925,
"KRN",19,5275,61)
1
"KRN",19,5275,62)
0
"KRN",19,5275,63)
[TIU PRINT SERVICE STATS]
"KRN",19,5275,64)
#@1212,+@1404;S1,-@1301
"KRN",19,5275,65)
?,,?
"KRN",19,5275,66)
?,,?
"KRN",19,5275,67)

"KRN",19,5275,69)
I +$$BELONGS^TIULX(+D0,244)
"KRN",19,5275,"U")
SERVICE LINE COUNT STATISTICS
"KRN",19,8613,-1)
0^6
"KRN",19,8613,0)
TIU UNSIGNED/UNCOSIGNED REPORT^Unsigned/Uncosigned Report^^R^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",19,8613,1,0)
^^10^10^3010816^
"KRN",19,8613,1,1,0)
This is a report that will provide information on unsigned/uncosigned
"KRN",19,8613,1,2,0)
documents for one, multiple, or all divisions.
"KRN",19,8613,1,3,0)
 
"KRN",19,8613,1,4,0)
The report can be either Summary or Full:
"KRN",19,8613,1,5,0)
 
"KRN",19,8613,1,6,0)
- Summary lists the number of documents by (author's)
"KRN",19,8613,1,7,0)
  service/section
"KRN",19,8613,1,8,0)
 
"KRN",19,8613,1,9,0)
- Full lists detailed document information (such as author, patient,
"KRN",19,8613,1,10,0)
  patient SSN, etc.) by (author's) service/section.
"KRN",19,8613,25)
TIURDIV
"KRN",19,8613,"U")
UNSIGNED/UNCOSIGNED REPORT
"KRN",409.61,477,-1)
0^2
"KRN",409.61,477,0)
TIU REVIEW BY TITLE^1^^135^4^18^1^1^Progress Note^TIU ACTION MENU TITLE REVIEW^Progress Notes by Title
"KRN",409.61,477,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,477,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,477,"COL",0)
^409.621^14^10
"KRN",409.61,477,"COL",1,0)
NUMBER^1^4
"KRN",409.61,477,"COL",2,0)
STATUS^63^19^Status
"KRN",409.61,477,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,477,"COL",4,0)
REF DATE^53^8^Ref Date
"KRN",409.61,477,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,477,"COL",10,0)
LAST I/LAST 4^20^7^^^0
"KRN",409.61,477,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,477,"COL",12,0)
EXPECTED COSIGNER^109^15^Exp. Cos.
"KRN",409.61,477,"COL",13,0)
DOCUMENT TYPE^28^24^Document^^1
"KRN",409.61,477,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,477,"COL","AIDENT",0,10)

"KRN",409.61,477,"COL","AIDENT",1,13)

"KRN",409.61,477,"COL","B","AUTHOR",11)

"KRN",409.61,477,"COL","B","DIVISION",14)

"KRN",409.61,477,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,477,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,477,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,477,"COL","B","NUMBER",1)

"KRN",409.61,477,"COL","B","PATIENT NAME",3)

"KRN",409.61,477,"COL","B","REF DATE",4)

"KRN",409.61,477,"COL","B","SIG DATE",5)

"KRN",409.61,477,"COL","B","STATUS",2)

"KRN",409.61,477,"FNL")
D CLEAN^TIURTITL
"KRN",409.61,477,"HDR")
D HDR^TIURTITH
"KRN",409.61,477,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,477,"INIT")
D MAKELIST^TIURTITL(3)
"KRN",409.61,478,-1)
0^3
"KRN",409.61,478,0)
TIU REVIEW DS CLINICIAN^1^^135^4^17^1^1^Discharge Summary^TIU ACTION MENU CLINICIAN^Discharge Summaries
"KRN",409.61,478,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,478,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,478,"COL",0)
^409.621^14^10
"KRN",409.61,478,"COL",1,0)
NUMBER^1^4
"KRN",409.61,478,"COL",2,0)
STATUS^63^19^Status
"KRN",409.61,478,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,478,"COL",4,0)
REF DATE^53^8^Ref Date
"KRN",409.61,478,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,478,"COL",10,0)
LAST I/LAST 4^20^7^^^0
"KRN",409.61,478,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,478,"COL",12,0)
EXPECTED COSIGNER^109^15^Exp. Cos.
"KRN",409.61,478,"COL",13,0)
DOCUMENT TYPE^28^24^Document^^1
"KRN",409.61,478,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,478,"COL","AIDENT",0,10)

"KRN",409.61,478,"COL","AIDENT",1,13)

"KRN",409.61,478,"COL","B","AUTHOR",11)

"KRN",409.61,478,"COL","B","DIVISION",14)

"KRN",409.61,478,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,478,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,478,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,478,"COL","B","NUMBER",1)

"KRN",409.61,478,"COL","B","PATIENT NAME",3)

"KRN",409.61,478,"COL","B","REF DATE",4)

"KRN",409.61,478,"COL","B","SIG DATE",5)

"KRN",409.61,478,"COL","B","STATUS",2)

"KRN",409.61,478,"FNL")
D CLEAN^TIUR
"KRN",409.61,478,"HDR")
D HDR^TIURH
"KRN",409.61,478,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,478,"INIT")
D MAKELIST^TIUR(244)
"KRN",409.61,482,-1)
0^4
"KRN",409.61,482,0)
TIU REVIEW FILING EVENTS^1^^125^4^20^1^1^Event^TIU ACTION MENU UPLOAD EVENTS^Filing Events
"KRN",409.61,482,1)
^TIU HIDDEN ACTIONS
"KRN",409.61,482,"ARRAY")
 ^TMP("TIUERR",$J)
"KRN",409.61,482,"COL",0)
^409.621^9^8
"KRN",409.61,482,"COL",1,0)
NUMBER^1^4^^H
"KRN",409.61,482,"COL",3,0)
EVENT DATE/TIME^65^15^Event Date/time
"KRN",409.61,482,"COL",4,0)
RESOL DATE/TIME^82^15^Resol Date/time
"KRN",409.61,482,"COL",5,0)
USER NAME^99^16^User Name
"KRN",409.61,482,"COL",6,0)
DESCRIPTION^6^80
"KRN",409.61,482,"COL",7,0)
DOCUMENT TYPE^6^36^Document Type^^1
"KRN",409.61,482,"COL",8,0)
EVENT TYPE^44^19^Event Type
"KRN",409.61,482,"COL",9,0)
DIVISION^117^8^Division
"KRN",409.61,482,"COL","AIDENT",1,7)

"KRN",409.61,482,"COL","B","DESCRIPTION",6)

"KRN",409.61,482,"COL","B","DIVISION",9)

"KRN",409.61,482,"COL","B","DOCUMENT TYPE",7)

"KRN",409.61,482,"COL","B","EVENT DATE/TIME",3)

"KRN",409.61,482,"COL","B","EVENT TYPE",8)

"KRN",409.61,482,"COL","B","NUMBER",1)

"KRN",409.61,482,"COL","B","RESOL DATE/TIME",4)

"KRN",409.61,482,"COL","B","USER NAME",5)

"KRN",409.61,482,"FNL")
D CLEAN^TIUELST
"KRN",409.61,482,"HDR")
D HDR^TIUELST
"KRN",409.61,482,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,482,"INIT")
D MAKELIST^TIUELST
"KRN",409.61,483,-1)
0^5
"KRN",409.61,483,0)
TIU REVIEW PN CLINICIAN^1^^135^4^17^1^1^Progress Note^TIU ACTION MENU CLINICIAN^Progress Notes
"KRN",409.61,483,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,483,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,483,"COL",0)
^409.621^14^10
"KRN",409.61,483,"COL",1,0)
NUMBER^1^4
"KRN",409.61,483,"COL",2,0)
STATUS^63^19^Status
"KRN",409.61,483,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,483,"COL",4,0)
REF DATE^53^8^Ref Date
"KRN",409.61,483,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,483,"COL",10,0)
LAST I/LAST 4^20^7^^^0
"KRN",409.61,483,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,483,"COL",12,0)
EXPECTED COSIGNER^109^15^Exp. Cos.
"KRN",409.61,483,"COL",13,0)
DOCUMENT TYPE^28^24^Document^^1
"KRN",409.61,483,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,483,"COL","AIDENT",0,10)

"KRN",409.61,483,"COL","AIDENT",1,13)

"KRN",409.61,483,"COL","B","AUTHOR",11)

"KRN",409.61,483,"COL","B","DIVISION",14)

"KRN",409.61,483,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,483,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,483,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,483,"COL","B","NUMBER",1)

"KRN",409.61,483,"COL","B","PATIENT NAME",3)

"KRN",409.61,483,"COL","B","REF DATE",4)

"KRN",409.61,483,"COL","B","SIG DATE",5)

"KRN",409.61,483,"COL","B","STATUS",2)

"KRN",409.61,483,"FNL")
D CLEAN^TIUR
"KRN",409.61,483,"HDR")
D HDR^TIURH
"KRN",409.61,483,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,483,"INIT")
D MAKELIST^TIUR(3)
"KRN",409.61,486,-1)
0^6
"KRN",409.61,486,0)
TIU REVIEW SCREEN CLINICIAN^1^^135^4^17^1^1^Document^TIU ACTION MENU CLINICIAN^Clinical Documents^
"KRN",409.61,486,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,486,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,486,"COL",0)
^409.621^14^10
"KRN",409.61,486,"COL",1,0)
NUMBER^1^5^^
"KRN",409.61,486,"COL",2,0)
STATUS^70^10^Status
"KRN",409.61,486,"COL",3,0)
PATIENT NAME^6^14^Patient^^
"KRN",409.61,486,"COL",4,0)
REF DATE^60^8^Ref Date
"KRN",409.61,486,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,486,"COL",10,0)
LAST I/LAST 4^20^7^^^0
"KRN",409.61,486,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,486,"COL",12,0)
EXPECTED COSIGNER^109^15^Exp. Cos.
"KRN",409.61,486,"COL",13,0)
DOCUMENT TYPE^28^31^Document^^1
"KRN",409.61,486,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,486,"COL","AIDENT",0,10)

"KRN",409.61,486,"COL","AIDENT",1,13)

"KRN",409.61,486,"COL","B","AUTHOR",11)

"KRN",409.61,486,"COL","B","DIVISION",14)

"KRN",409.61,486,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,486,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,486,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,486,"COL","B","NUMBER",1)

"KRN",409.61,486,"COL","B","PATIENT NAME",3)

"KRN",409.61,486,"COL","B","REF DATE",4)

"KRN",409.61,486,"COL","B","SIG DATE",5)

"KRN",409.61,486,"COL","B","STATUS",2)

"KRN",409.61,486,"FNL")
D CLEAN^TIUR
"KRN",409.61,486,"HDR")
D HDR^TIURH
"KRN",409.61,486,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,486,"INIT")
D MAKELIST^TIUR(38)
"KRN",409.61,487,-1)
0^7
"KRN",409.61,487,0)
TIU REVIEW SCREEN DS UNSIGNED^1^^135^4^18^1^1^Discharge Summary^TIU ACTION MENU CLINICIAN^Discharge Summaries
"KRN",409.61,487,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,487,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,487,"COL",0)
^409.621^14^10
"KRN",409.61,487,"COL",1,0)
NUMBER^1^5
"KRN",409.61,487,"COL",2,0)
STATUS^70^10^Status
"KRN",409.61,487,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,487,"COL",4,0)
REF DATE^60^8^Ref Date
"KRN",409.61,487,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,487,"COL",10,0)
LAST I/LAST 4^20^7^^^0
"KRN",409.61,487,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,487,"COL",12,0)
EXPECTED COSIGNER^109^15^Exp. Cos.
"KRN",409.61,487,"COL",13,0)
DOCUMENT TYPE^28^31^Document^^1
"KRN",409.61,487,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,487,"COL","AIDENT",0,10)

"KRN",409.61,487,"COL","AIDENT",1,13)

"KRN",409.61,487,"COL","B","AUTHOR",11)

"KRN",409.61,487,"COL","B","DIVISION",14)

"KRN",409.61,487,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,487,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,487,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,487,"COL","B","NUMBER",1)

"KRN",409.61,487,"COL","B","PATIENT NAME",3)

"KRN",409.61,487,"COL","B","REF DATE",4)

"KRN",409.61,487,"COL","B","SIG DATE",5)

"KRN",409.61,487,"COL","B","STATUS",2)

"KRN",409.61,487,"FNL")
D CLEAN^TIUR
"KRN",409.61,487,"HDR")
D HDR^TIURH
"KRN",409.61,487,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,487,"INIT")
D MAKELIST^TIUR(244)
"KRN",409.61,488,-1)
0^8
"KRN",409.61,488,0)
TIU REVIEW SCREEN MGR^1^^153^4^18^1^1^Document^TIU ACTION MENU MGR REVIEW^CLINICAL DOCUMENTS
"KRN",409.61,488,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,488,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,488,"COL",0)
^409.621^13^12
"KRN",409.61,488,"COL",1,0)
NUMBER^1^5
"KRN",409.61,488,"COL",2,0)
STATUS^99^10^Status
"KRN",409.61,488,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,488,"COL",4,0)
DISCH DATE^72^8^Disch'd
"KRN",409.61,488,"COL",5,0)
DICT DATE^82^8^Dictated
"KRN",409.61,488,"COL",6,0)
LINE COUNT^92^5^Lines
"KRN",409.61,488,"COL",8,0)
ADMISSION DATE^62^8^Admitted
"KRN",409.61,488,"COL",9,0)
LAST I/LAST 4^20^8^^^1
"KRN",409.61,488,"COL",10,0)
AUTHOR^111^15^Author
"KRN",409.61,488,"COL",11,0)
ATTENDING^128^15^Attending
"KRN",409.61,488,"COL",12,0)
DOCUMENT TYPE^29^31^Document
"KRN",409.61,488,"COL",13,0)
DIVISION^145^8^Division
"KRN",409.61,488,"COL","AIDENT",1,9)

"KRN",409.61,488,"COL","B","ADMISSION DATE",8)

"KRN",409.61,488,"COL","B","ATTENDING",11)

"KRN",409.61,488,"COL","B","AUTHOR",10)

"KRN",409.61,488,"COL","B","DICT DATE",5)

"KRN",409.61,488,"COL","B","DISCH DATE",4)

"KRN",409.61,488,"COL","B","DIVISION",13)

"KRN",409.61,488,"COL","B","DOCUMENT TYPE",12)

"KRN",409.61,488,"COL","B","LAST I/LAST 4",9)

"KRN",409.61,488,"COL","B","LINE COUNT",6)

"KRN",409.61,488,"COL","B","NUMBER",1)

"KRN",409.61,488,"COL","B","PATIENT NAME",3)

"KRN",409.61,488,"COL","B","STATUS",2)

"KRN",409.61,488,"FNL")
D CLEAN^TIURM
"KRN",409.61,488,"HDR")
D HDR^TIURMH
"KRN",409.61,488,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,488,"INIT")
D MAKELIST^TIURM(38)
"KRN",409.61,489,-1)
0^9
"KRN",409.61,489,0)
TIU REVIEW SCREEN MRT^1^^153^4^18^1^1^Document^TIU ACTION MENU MRT REVIEW^CLINICAL DOCUMENTS
"KRN",409.61,489,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,489,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,489,"COL",0)
^409.621^13^12
"KRN",409.61,489,"COL",1,0)
NUMBER^1^5
"KRN",409.61,489,"COL",2,0)
STATUS^99^10^Status
"KRN",409.61,489,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,489,"COL",4,0)
DISCH DATE^72^8^Disch'd
"KRN",409.61,489,"COL",5,0)
DICT DATE^82^8^Dictated
"KRN",409.61,489,"COL",6,0)
LINE COUNT^92^5^Lines
"KRN",409.61,489,"COL",8,0)
ADMISSION DATE^62^8^Admitted
"KRN",409.61,489,"COL",9,0)
LAST I/LAST 4^20^8^^^1
"KRN",409.61,489,"COL",10,0)
AUTHOR^111^15^Author
"KRN",409.61,489,"COL",11,0)
ATTENDING^128^15^Attending
"KRN",409.61,489,"COL",12,0)
DOCUMENT TYPE^29^31^Document
"KRN",409.61,489,"COL",13,0)
DIVISION^145^8^Division
"KRN",409.61,489,"COL","AIDENT",1,9)

"KRN",409.61,489,"COL","B","ADMISSION DATE",8)

"KRN",409.61,489,"COL","B","ATTENDING",11)

"KRN",409.61,489,"COL","B","AUTHOR",10)

"KRN",409.61,489,"COL","B","DICT DATE",5)

"KRN",409.61,489,"COL","B","DISCH DATE",4)

"KRN",409.61,489,"COL","B","DIVISION",13)

"KRN",409.61,489,"COL","B","DOCUMENT TYPE",12)

"KRN",409.61,489,"COL","B","LAST I/LAST 4",9)

"KRN",409.61,489,"COL","B","LINE COUNT",6)

"KRN",409.61,489,"COL","B","NUMBER",1)

"KRN",409.61,489,"COL","B","PATIENT NAME",3)

"KRN",409.61,489,"COL","B","STATUS",2)

"KRN",409.61,489,"FNL")
D CLEAN^TIURM
"KRN",409.61,489,"HDR")
D HDR^TIURMH
"KRN",409.61,489,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,489,"INIT")
D MAKELIST^TIURM(38)
"KRN",409.61,490,-1)
0^10
"KRN",409.61,490,0)
TIU REVIEW SCREEN PN UNSIGNED^1^^135^4^18^1^1^Progress Note^TIU ACTION MENU CLINICIAN^Progress Notes
"KRN",409.61,490,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,490,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,490,"COL",0)
^409.621^14^10
"KRN",409.61,490,"COL",1,0)
NUMBER^1^5
"KRN",409.61,490,"COL",2,0)
STATUS^70^10^Status
"KRN",409.61,490,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,490,"COL",4,0)
REF DATE^60^8^Ref Date
"KRN",409.61,490,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,490,"COL",10,0)
LAST I/LAST 4^20^7^^^0
"KRN",409.61,490,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,490,"COL",12,0)
EXPECTED COSIGNER^109^15^Exp. Cos.
"KRN",409.61,490,"COL",13,0)
DOCUMENT TYPE^28^31^Document^^1
"KRN",409.61,490,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,490,"COL","AIDENT",0,10)

"KRN",409.61,490,"COL","AIDENT",1,13)

"KRN",409.61,490,"COL","B","AUTHOR",11)

"KRN",409.61,490,"COL","B","DIVISION",14)

"KRN",409.61,490,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,490,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,490,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,490,"COL","B","NUMBER",1)

"KRN",409.61,490,"COL","B","PATIENT NAME",3)

"KRN",409.61,490,"COL","B","REF DATE",4)

"KRN",409.61,490,"COL","B","SIG DATE",5)

"KRN",409.61,490,"COL","B","STATUS",2)

"KRN",409.61,490,"FNL")
D CLEAN^TIUR
"KRN",409.61,490,"HDR")
D HDR^TIURH
"KRN",409.61,490,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,490,"INIT")
D MAKELIST^TIUR(3)
"KRN",409.61,491,-1)
0^11
"KRN",409.61,491,0)
TIU REVIEW SCREEN READ ONLY^1^^135^4^18^1^1^Document^TIU ACTION MENU READ-ONLY^Clinical Documents
"KRN",409.61,491,1)
^TIU HIDDEN ACTIONS
"KRN",409.61,491,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,491,"COL",0)
^409.621^14^10
"KRN",409.61,491,"COL",1,0)
NUMBER^1^5
"KRN",409.61,491,"COL",2,0)
STATUS^70^10^Status
"KRN",409.61,491,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,491,"COL",4,0)
REF DATE^60^8^Ref Date
"KRN",409.61,491,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,491,"COL",10,0)
LAST I/LAST 4^20^7
"KRN",409.61,491,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,491,"COL",12,0)
EXPECTED COSIGNER^109^15^Exp. Cos.
"KRN",409.61,491,"COL",13,0)
DOCUMENT TYPE^28^31^Document
"KRN",409.61,491,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,491,"COL","B","AUTHOR",11)

"KRN",409.61,491,"COL","B","DIVISION",14)

"KRN",409.61,491,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,491,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,491,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,491,"COL","B","NUMBER",1)

"KRN",409.61,491,"COL","B","PATIENT NAME",3)

"KRN",409.61,491,"COL","B","REF DATE",4)

"KRN",409.61,491,"COL","B","SIG DATE",5)

"KRN",409.61,491,"COL","B","STATUS",2)

"KRN",409.61,491,"FNL")
D CLEAN^TIUR
"KRN",409.61,491,"HDR")
D HDR^TIURH
"KRN",409.61,491,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,491,"INIT")
D MAKELIST^TIUR(38)
"KRN",409.61,492,-1)
0^12
"KRN",409.61,492,0)
TIU SEARCH LIST MGR^1^^135^4^18^1^1^Document^TIU ACTION MENU MGR^CLINICAL DOCUMENTS
"KRN",409.61,492,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,492,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,492,"COL",0)
^409.621^14^10
"KRN",409.61,492,"COL",1,0)
NUMBER^1^5
"KRN",409.61,492,"COL",2,0)
STATUS^70^10^Status
"KRN",409.61,492,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,492,"COL",4,0)
REF DATE^60^8^Ref Date
"KRN",409.61,492,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,492,"COL",10,0)
LAST I/LAST 4^20^7^^^
"KRN",409.61,492,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,492,"COL",12,0)
EXPECTED COSIGNER^109^15^Exp. Cos.
"KRN",409.61,492,"COL",13,0)
DOCUMENT TYPE^28^31^Document^^1
"KRN",409.61,492,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,492,"COL","AIDENT",1,13)

"KRN",409.61,492,"COL","B","AUTHOR",11)

"KRN",409.61,492,"COL","B","DIVISION",14)

"KRN",409.61,492,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,492,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,492,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,492,"COL","B","NUMBER",1)

"KRN",409.61,492,"COL","B","PATIENT NAME",3)

"KRN",409.61,492,"COL","B","REF DATE",4)

"KRN",409.61,492,"COL","B","SIG DATE",5)

"KRN",409.61,492,"COL","B","STATUS",2)

"KRN",409.61,492,"FNL")
D CLEAN^TIUR
"KRN",409.61,492,"HDR")
D HDR^TIURH
"KRN",409.61,492,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,492,"INIT")
D MAKELIST^TIUR(38)
"KRN",409.61,493,-1)
0^13
"KRN",409.61,493,0)
TIU SEARCH LIST MRT^1^^135^4^18^1^1^Document^TIU ACTION MENU MRT^CLINICAL DOCUMENTS
"KRN",409.61,493,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,493,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,493,"COL",0)
^409.621^14^10
"KRN",409.61,493,"COL",1,0)
NUMBER^1^5
"KRN",409.61,493,"COL",2,0)
STATUS^70^10^Status
"KRN",409.61,493,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,493,"COL",4,0)
REF DATE^60^8^Ref Date
"KRN",409.61,493,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,493,"COL",10,0)
LAST I/LAST 4^20^7
"KRN",409.61,493,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,493,"COL",12,0)
EXPECTED COSIGNER^109^15^Exp. Cos.
"KRN",409.61,493,"COL",13,0)
DOCUMENT TYPE^28^31^Document^^1
"KRN",409.61,493,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,493,"COL","AIDENT",1,13)

"KRN",409.61,493,"COL","B","AUTHOR",11)

"KRN",409.61,493,"COL","B","DIVISION",14)

"KRN",409.61,493,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,493,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,493,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,493,"COL","B","NUMBER",1)

"KRN",409.61,493,"COL","B","PATIENT NAME",3)

"KRN",409.61,493,"COL","B","REF DATE",4)

"KRN",409.61,493,"COL","B","SIG DATE",5)

"KRN",409.61,493,"COL","B","STATUS",2)

"KRN",409.61,493,"FNL")
D CLEAN^TIUR
"KRN",409.61,493,"HDR")
D HDR^TIURH
"KRN",409.61,493,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,493,"INIT")
D MAKELIST^TIUR(38)
"KRN",409.61,541,-1)
0^1
"KRN",409.61,541,0)
TIU REVIEW BY PATIENT & TITLE^1^^135^4^18^1^1^Progress Note^TIU ACTION MENU PT/TTL REVIEW^Progress Notes
"KRN",409.61,541,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,541,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,541,"COL",0)
^409.621^14^10
"KRN",409.61,541,"COL",1,0)
NUMBER^1^4
"KRN",409.61,541,"COL",2,0)
STATUS^63^19^Status
"KRN",409.61,541,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,541,"COL",4,0)
REF DATE^53^8^Ref Date
"KRN",409.61,541,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,541,"COL",10,0)
LAST I/LAST 4^20^7^^^0
"KRN",409.61,541,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,541,"COL",12,0)
EXPECTED COSIGNER^109^15^Exp. Cos.
"KRN",409.61,541,"COL",13,0)
DOCUMENT TYPE^28^24^Document^^1
"KRN",409.61,541,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,541,"COL","AIDENT",0,10)

"KRN",409.61,541,"COL","AIDENT",1,13)

"KRN",409.61,541,"COL","B","AUTHOR",11)

"KRN",409.61,541,"COL","B","DIVISION",14)

"KRN",409.61,541,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,541,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,541,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,541,"COL","B","NUMBER",1)

"KRN",409.61,541,"COL","B","PATIENT NAME",3)

"KRN",409.61,541,"COL","B","REF DATE",4)

"KRN",409.61,541,"COL","B","SIG DATE",5)

"KRN",409.61,541,"COL","B","STATUS",2)

"KRN",409.61,541,"FNL")
D CLEAN^TIURPTTL
"KRN",409.61,541,"HDR")
D HDR^TIURH
"KRN",409.61,541,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,541,"INIT")
D MAKELIST^TIURPTTL(3)
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
113^3040129
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3040129
"PKG",193,22,1,"PAH",1,1,1,0)
The description on this patch may be found in the National Patch Module
"PKG",193,22,1,"PAH",1,1,2,0)
under TIU*1*113.
"PRE")
TIUEN113
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
37
"RTN","TIUCPFIX")
0^35^B57761436
"RTN","TIUCPFIX",1,0)
TIUCPFIX ; SLC/JER,RMO - Resolve Filing errors for CP Documents ;4/18/03
"RTN","TIUCPFIX",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**109,167,113**;Jun 20, 1997
"RTN","TIUCPFIX",3,0)
 ; This routine is a modified version of TIUPEFIX
"RTN","TIUCPFIX",4,0)
MAKE(SUCCESS,DFN,TITLE,TIU,TIUBUF,TIUPLDA) ; File new TIU Document
"RTN","TIUCPFIX",5,0)
 ; SUCCESS = (by ref) SUCCESS Returns TIU DOCUMENT # (PTR to 8925)
"RTN","TIUCPFIX",6,0)
 ;         = 0^Explanatory message if no SUCCESS
"RTN","TIUCPFIX",7,0)
 ; DFN     = Patient (#2)
"RTN","TIUCPFIX",8,0)
 ; TITLE   = Pointer to TIU Document Definition (#8925.1)
"RTN","TIUCPFIX",9,0)
 ; TIU     = Array of demographic and visit attributes
"RTN","TIUCPFIX",10,0)
 ; TIUBUF  = Record number (ien) of entry in TIU Buffer file (#8925.2)
"RTN","TIUCPFIX",11,0)
 ; TIUPLDA = Record number (ien) of entry in TIU Document file (#8925)  (Optional)
"RTN","TIUCPFIX",12,0)
 ;
"RTN","TIUCPFIX",13,0)
 ; -- first, get TIU Document record --
"RTN","TIUCPFIX",14,0)
 ;
"RTN","TIUCPFIX",15,0)
 N TIUDA,LDT,NEWREC,TIUX,TIUTYP,TIUDPRM,HAPPY,TIUCLASS,TIUDTYP,TIUPOST
"RTN","TIUCPFIX",16,0)
 N TIUDFLT,TIUREC,TIUCNNBR,TIUDNB,TIUDTP,TIUPSC,TIUQUIT
"RTN","TIUCPFIX",17,0)
 S SUCCESS=0 ; Initialize SUCCESS to false
"RTN","TIUCPFIX",18,0)
 I '$G(TIUPLDA) D  G MAKEQ:$G(TIUQUIT)
"RTN","TIUCPFIX",19,0)
 . I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,+$G(TIUTYPE)'>0:1,1:0) S SUCCESS="0^"_$$EZBLD^DIALOG(89250001) S TIUQUIT=1 Q
"RTN","TIUCPFIX",20,0)
 . ; If target file is not 8925 QUIT
"RTN","TIUCPFIX",21,0)
 . I +$G(^TIU(8925.1,+TIUTYPE,1))'=8925 S TIUQUIT=1 Q
"RTN","TIUCPFIX",22,0)
 . S TIUDTYP=$P($G(^TIU(8925.1,+TIUTYPE,0)),U,4)
"RTN","TIUCPFIX",23,0)
 . S TIUCLASS=$S(TIUDTYP="CL":+TIUTYPE,1:38)
"RTN","TIUCPFIX",24,0)
 . S TIUDFLT=$S(TIUCLASS'=TIUTYPE:TIUTYPE,1:"")
"RTN","TIUCPFIX",25,0)
 . I +$G(TITLE)'>0 S TITLE=$$ASKTITLE^TIULA3(TIUCLASS,TIUDFLT)
"RTN","TIUCPFIX",26,0)
 . I +TITLE'>0 S TIUQUIT=1 Q
"RTN","TIUCPFIX",27,0)
 ELSE  D
"RTN","TIUCPFIX",28,0)
 . S TITLE=+$G(^TIU(8925,+TIUPLDA,0))
"RTN","TIUCPFIX",29,0)
 S TIUTYP=TITLE,TIUTYP(1)=1_U_TITLE
"RTN","TIUCPFIX",30,0)
 D DOCPRM^TIULC1(TITLE,.TIUDPRM)
"RTN","TIUCPFIX",31,0)
 ;
"RTN","TIUCPFIX",32,0)
 ; -- second, load the header elements & text into TIUX array
"RTN","TIUCPFIX",33,0)
 ;
"RTN","TIUCPFIX",34,0)
 D LOADTIUX(.TIUX,TIUBUF)
"RTN","TIUCPFIX",35,0)
 ;
"RTN","TIUCPFIX",36,0)
 ;Set variables
"RTN","TIUCPFIX",37,0)
 I $G(TIUPLDA) D
"RTN","TIUCPFIX",38,0)
 . S TIUCNNBR=+$P($G(^TIU(8925,+TIUPLDA,14)),U,5)
"RTN","TIUCPFIX",39,0)
 ELSE  D
"RTN","TIUCPFIX",40,0)
 . S TIUCNNBR=$S(+$P($G(TIUX(1405)),"C.",2):+$P($G(TIUX(1405)),"C.",2),1:"")
"RTN","TIUCPFIX",41,0)
 . S:$G(TIUX(.001)) TIUPLDA=$G(TIUX(.001))
"RTN","TIUCPFIX",42,0)
 S TIUPSC=$G(TIUX(70201))
"RTN","TIUCPFIX",43,0)
 S TIUDTP=$G(TIUX(70202))
"RTN","TIUCPFIX",44,0)
 ;
"RTN","TIUCPFIX",45,0)
 ;Check consult associated with document
"RTN","TIUCPFIX",46,0)
 I '$$CHKCN^TIUPUTCP(TIUCNNBR,DFN,$G(TIUPLDA),.TIUDNB) S SUCCESS="0^"_$$EZBLD^DIALOG($G(TIUDNB)) G MAKEQ
"RTN","TIUCPFIX",47,0)
 ;
"RTN","TIUCPFIX",48,0)
 ;Check consult as it related to CP
"RTN","TIUCPFIX",49,0)
 I '$$CHKCP^TIUPUTCP(TIUCNNBR,$G(TIUPLDA),.TIUDNB) S SUCCESS="0^"_$$EZBLD^DIALOG($G(TIUDNB)) G MAKEQ
"RTN","TIUCPFIX",50,0)
 ;
"RTN","TIUCPFIX",51,0)
 ;If TIU document IEN is defined use it, otherwise call TIUEDI3
"RTN","TIUCPFIX",52,0)
 I $G(TIUPLDA) D
"RTN","TIUCPFIX",53,0)
 . S TIUDA=TIUPLDA
"RTN","TIUCPFIX",54,0)
 ELSE  D
"RTN","TIUCPFIX",55,0)
 . S TIUDA=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.NEWREC,.TIUDPRM)
"RTN","TIUCPFIX",56,0)
 I +TIUDA'>0 S SUCCESS="0^"_$$EZBLD^DIALOG(89250002) G MAKEQ
"RTN","TIUCPFIX",57,0)
 I +$$CANEDIT^TIUPUTU(TIUDA)'>0 D  G MAKEX
"RTN","TIUCPFIX",58,0)
 . D MAKEADD(.TIUADD,+TIUDA,TIUBUF) S SUCCESS=TIUADD
"RTN","TIUCPFIX",59,0)
 S SUCCESS=1
"RTN","TIUCPFIX",60,0)
 ;
"RTN","TIUCPFIX",61,0)
 D STUFREC(TIUDA,$G(DFN),,.TIU,$G(TIUPSC),$G(TIUDTP),$G(TIUPLDA))
"RTN","TIUCPFIX",62,0)
 ;
"RTN","TIUCPFIX",63,0)
 ; -- third, file the data in TIU Document record --
"RTN","TIUCPFIX",64,0)
 ;
"RTN","TIUCPFIX",65,0)
 K ^TIU(8925,+TIUDA,"TEMP"),TIUX(.01),TIUX(.02),TIUX(.03),TIUX(.05)
"RTN","TIUCPFIX",66,0)
 K TIUX(.13),TIUX(1205),TIUX(1211),TIUX(.001),TIUX(70201),TIUX(70202)
"RTN","TIUCPFIX",67,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUCPFIX",68,0)
 D FILE(.HAPPY,+TIUDA,.TIUX,TIUTYP)
"RTN","TIUCPFIX",69,0)
 D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUCPFIX",70,0)
 S TIUPOST=$$POSTFILE^TIULC1(TITLE)
"RTN","TIUCPFIX",71,0)
 S TIUREC("#")=TIUDA
"RTN","TIUCPFIX",72,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUCPFIX",73,0)
MAKEX D ALERTDEL^TIUPEVNT(+TIUBUF)
"RTN","TIUCPFIX",74,0)
 D RESOLVE^TIUPEVNT($S($D(XQADATA):+$P(XQADATA,";",3),1:$G(ERRDA)),1)
"RTN","TIUCPFIX",75,0)
 D BUFPURGE^TIUPUTC(+TIUBUF)
"RTN","TIUCPFIX",76,0)
 K ^TIU(8925,+TIUDA,"TEMP") W "Done."
"RTN","TIUCPFIX",77,0)
 I +$G(TIUDA),+$D(^TIU(8925,+$G(TIUDA),0)) D
"RTN","TIUCPFIX",78,0)
 . N TIU D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUCPFIX",79,0)
 . D EN^VALM("TIU BROWSE FOR MRT")
"RTN","TIUCPFIX",80,0)
MAKEQ Q
"RTN","TIUCPFIX",81,0)
LOADTIUX(TIUARR,TIUBUF) ; Load TIUX array with header and text
"RTN","TIUCPFIX",82,0)
 N TIUI,TIUHSIG,TIUBGN,TIULINE,X,Y,TYPE I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUCPFIX",83,0)
 S TIUHSIG=$P(TIUPRM0,U,10),TIUBGN=$P(TIUPRM0,U,12)
"RTN","TIUCPFIX",84,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925.2,+TIUBUF,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUCPFIX",85,0)
 . S TIULINE=$G(^TIU(8925.2,+TIUBUF,"TEXT",TIUI,0))
"RTN","TIUCPFIX",86,0)
 . I TIULINE[TIUHSIG D
"RTN","TIUCPFIX",87,0)
 . . N TIUD1,TIUD4
"RTN","TIUCPFIX",88,0)
 . . S X=$$STRIP^TIULS($P(TIULINE,":",2)),Y=$$WHATYPE^TIUPUTU(X)
"RTN","TIUCPFIX",89,0)
 . . I +Y'>0 D MAIN^TIUPEVNT(TIUBUF,1,3,X) Q
"RTN","TIUCPFIX",90,0)
 . . S TIUD1=$G(^TIU(8925.1,+Y,1)),TIUD4=$G(^TIU(8925.1,+Y,4))
"RTN","TIUCPFIX",91,0)
 . . S TYPE=+Y
"RTN","TIUCPFIX",92,0)
 . . F  D  Q:TIULINE[TIUBGN!(+TIUI'>0)
"RTN","TIUCPFIX",93,0)
 . . . N TIUN,TIUCAP,TIUFLD,TIUREQ S TIUREQ=0
"RTN","TIUCPFIX",94,0)
 . . . S TIUI=$O(^TIU(8925.2,+TIUBUF,"TEXT",TIUI)) Q:+TIUI'>0
"RTN","TIUCPFIX",95,0)
 . . . S TIULINE=$G(^TIU(8925.2,+TIUBUF,"TEXT",TIUI,0)) Q:TIULINE[TIUBGN
"RTN","TIUCPFIX",96,0)
 . . . S TIUCAP=$P(TIULINE,":") Q:TIUCAP']""
"RTN","TIUCPFIX",97,0)
 . . . S TIUN=$O(^TIU(8925.1,+TYPE,"HEAD","B",TIUCAP,0))
"RTN","TIUCPFIX",98,0)
 . . . Q:+TIUN'>0
"RTN","TIUCPFIX",99,0)
 . . . S TIUFLD=$P(^TIU(8925.1,+TYPE,"HEAD",+TIUN,0),U,3)
"RTN","TIUCPFIX",100,0)
 . . . Q:TIUFLD']""
"RTN","TIUCPFIX",101,0)
 . . . S TIUREQ=$P(^TIU(8925.1,+TYPE,"HEAD",+TIUN,0),U,7)
"RTN","TIUCPFIX",102,0)
 . . . S TIUARR(TIUFLD)=$$STRIP^TIULS($P(TIULINE,":",2,99))
"RTN","TIUCPFIX",103,0)
 . . . S:TIUFLD'=.001 TIUARR(TIUFLD)=$$TRNSFRM(+TYPE,TIUFLD,TIUARR(TIUFLD))
"RTN","TIUCPFIX",104,0)
 . . . I +TIUREQ,TIUARR(TIUFLD)="" S TIUARR(TIUFLD)="** REQUIRED FIELD MISSING FROM UPLOAD **"
"RTN","TIUCPFIX",105,0)
 . . . I $S(TIUFLD=.01:1,TIUFLD=.02:1,TIUFLD=.07:1,TIUFLD=1301:1,1:0) K TIUARR(TIUFLD)
"RTN","TIUCPFIX",106,0)
 . . I TIULINE[TIUBGN D
"RTN","TIUCPFIX",107,0)
 . . . N TIUJ S TIUJ=0
"RTN","TIUCPFIX",108,0)
 . . . F  D  Q:+TIUI'>0
"RTN","TIUCPFIX",109,0)
 . . . . S TIUI=$O(^TIU(8925.2,+TIUBUF,"TEXT",TIUI)) Q:+TIUI'>0
"RTN","TIUCPFIX",110,0)
 . . . . S TIUJ=TIUJ+1
"RTN","TIUCPFIX",111,0)
 . . . . S TIUARR("TEXT",TIUJ,0)=$G(^TIU(8925.2,+TIUBUF,"TEXT",TIUI,0))
"RTN","TIUCPFIX",112,0)
 Q
"RTN","TIUCPFIX",113,0)
STUFREC(DA,DFN,PARENT,TIU,TIUPSC,TIUDTP,TIUPLDA) ; Stuff fixed field data
"RTN","TIUCPFIX",114,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIURDT,TIUPSCI,TIUDTPI
"RTN","TIUCPFIX",115,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUCPFIX",116,0)
 I +$G(PARENT)'>0 D
"RTN","TIUCPFIX",117,0)
 . I '$G(TIUPLDA) D
"RTN","TIUCPFIX",118,0)
 . . S @FDARR@(.02)=$G(DFN),@FDARR@(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUCPFIX",119,0)
 . . S @FDARR@(.07)=$P(TIU("EDT"),U)
"RTN","TIUCPFIX",120,0)
 . . S @FDARR@(1401)=$P($G(TIU("AD#")),U),@FDARR@(1402)=$P($G(TIU("TS")),U)
"RTN","TIUCPFIX",121,0)
 . . S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUCPFIX",122,0)
 . . S @FDARR@(1205)=$S(+$P($G(TIU("LOC")),U):$P($G(TIU("LOC")),U),1:$P($G(TIU("VLOC")),U))
"RTN","TIUCPFIX",123,0)
 . . S @FDARR@(1212)=$S(+$P($G(TIU("INST")),U):$P($G(TIU("INST")),U),1:DUZ(2))
"RTN","TIUCPFIX",124,0)
 . . S @FDARR@(1404)=$P($G(TIU("SVC")),U)
"RTN","TIUCPFIX",125,0)
 . S @FDARR@(.05)=$S(+$$REQVER(+$P($G(TIUDPRM(0)),U,3)):4,1:5)
"RTN","TIUCPFIX",126,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U)
"RTN","TIUCPFIX",127,0)
 I +$G(PARENT)>0 D
"RTN","TIUCPFIX",128,0)
 . S @FDARR@(.02)=+$P(^TIU(8925,+PARENT,0),U,2)
"RTN","TIUCPFIX",129,0)
 . S @FDARR@(.03)=$P(^TIU(8925,+PARENT,0),U,3)
"RTN","TIUCPFIX",130,0)
 . S @FDARR@(.05)=$S(+$$REQVER(+$P($G(TIUDPRM(0)),U,3)):4,1:5)
"RTN","TIUCPFIX",131,0)
 . S @FDARR@(.06)=PARENT
"RTN","TIUCPFIX",132,0)
 . S @FDARR@(.07)=$P($G(TIU("EDT")),U),@FDARR@(.08)=$P($G(TIU("LDT")),U)
"RTN","TIUCPFIX",133,0)
 . S @FDARR@(1205)=$P($G(^TIU(8925,+PARENT,12)),U,5)
"RTN","TIUCPFIX",134,0)
 . S @FDARR@(1212)=$P($G(^TIU(8925,+PARENT,12)),U,12)
"RTN","TIUCPFIX",135,0)
 . S @FDARR@(1401)=$P($G(^TIU(8925,+PARENT,14)),U)
"RTN","TIUCPFIX",136,0)
 . S @FDARR@(1402)=$P($G(^TIU(8925,+PARENT,14)),U,2)
"RTN","TIUCPFIX",137,0)
 . S @FDARR@(1404)=$P($G(^TIU(8925,+PARENT,14)),U,4)
"RTN","TIUCPFIX",138,0)
 . S @FDARR@(1201)=$$NOW^XLFDT
"RTN","TIUCPFIX",139,0)
 I +$G(TIU("LDT")) S TIURDT=+$G(TIU("LDT"))
"RTN","TIUCPFIX",140,0)
 I +$G(TIU("LDT"))'>0 D
"RTN","TIUCPFIX",141,0)
 . S TIUDICDT=+$$IDATE^TIULC($G(TIUDICDT))
"RTN","TIUCPFIX",142,0)
 . I +TIUDICDT,($P(TIUDICDT,".",2)'>0) D
"RTN","TIUCPFIX",143,0)
 . . S TIUDICDT=$S($P(TIU("VSTR"),";",3)'="H":$P($G(TIU("EDT")),U),1:"")
"RTN","TIUCPFIX",144,0)
 . S TIURDT=$S(+$G(TIUDICDT)>0:+$G(TIUDICDT),1:+$$NOW^TIULC)
"RTN","TIUCPFIX",145,0)
 . S:+$G(TIUTYPE)=1 @FDARR@(.12)=1
"RTN","TIUCPFIX",146,0)
 . K TIUDICDT
"RTN","TIUCPFIX",147,0)
 I '$G(TIUPLDA) S @FDARR@(1301)=TIURDT
"RTN","TIUCPFIX",148,0)
 S @FDARR@(1303)="U"
"RTN","TIUCPFIX",149,0)
 I $G(TIUPSC)]"" D VAL^DIE(8925,DA,70201,,TIUPSC,.TIUPSCI)
"RTN","TIUCPFIX",150,0)
 S @FDARR@(70201)=$S($G(TIUPSCI):TIUPSCI,1:"")
"RTN","TIUCPFIX",151,0)
 I '$G(TIUPLDA)!($P($G(^TIU(8925,+$G(TIUPLDA),702)),U,2))="" D
"RTN","TIUCPFIX",152,0)
 . I $G(TIUDTP)]"" D VAL^DIE(8925,DA,70202,,TIUDTP,.TIUDTPI)
"RTN","TIUCPFIX",153,0)
 . S @FDARR@(70202)=$S($G(TIUDTPI):TIUDTPI,1:"")
"RTN","TIUCPFIX",154,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUCPFIX",155,0)
 Q
"RTN","TIUCPFIX",156,0)
REQVER(VPARM) ; Evaluate whether verification is required
"RTN","TIUCPFIX",157,0)
 Q $S(VPARM=1:1,VPARM=2:1,1:0)
"RTN","TIUCPFIX",158,0)
MAKEADD(TIUDADD,TIUDA,TIUBUF) ; Create an addendum record
"RTN","TIUCPFIX",159,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUCAN,TIUFPRIV,TIU,TIUX S TIUFPRIV=1
"RTN","TIUCPFIX",160,0)
 N TIUDTTL,TIUPOST,TIUREC
"RTN","TIUCPFIX",161,0)
 S TIUDTTL=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIUCPFIX",162,0)
 S TIUATYP=+$$WHATITLE^TIUPUTU("ADDENDUM")
"RTN","TIUCPFIX",163,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUCPFIX",164,0)
 D ^DIC
"RTN","TIUCPFIX",165,0)
 S TIUDADD=+Y
"RTN","TIUCPFIX",166,0)
 I +Y'>0 S TIUDADD=TIUDADD_"^Could not create addendum." Q
"RTN","TIUCPFIX",167,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUCPFIX",168,0)
 S TIU("DOCTYP")=TIUATYP_U_$$PNAME^TIULC1(TIUATYP)
"RTN","TIUCPFIX",169,0)
 D STUFREC(TIUDADD,DFN,+TIUDA,.TIU)
"RTN","TIUCPFIX",170,0)
 D LOADTIUX(.TIUX,TIUBUF)
"RTN","TIUCPFIX",171,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUCPFIX",172,0)
 M ^TIU(8925,+TIUDADD,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUCPFIX",173,0)
 D FILE(.SUCCESS,+TIUDADD,.TIUX,TIUATYP)
"RTN","TIUCPFIX",174,0)
 D MERGTEXT^TIUEDI1(+TIUDADD,.TIU)
"RTN","TIUCPFIX",175,0)
 S TIUPOST=$$POSTFILE^TIULC1(TIUDTTL)
"RTN","TIUCPFIX",176,0)
 S TIUREC("#")=TIUDADD
"RTN","TIUCPFIX",177,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUCPFIX",178,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUCPFIX",179,0)
 Q
"RTN","TIUCPFIX",180,0)
FILE(SUCCESS,TIUDA,TIUX,RTYPE) ; Call FM Filer to commit updates to DB
"RTN","TIUCPFIX",181,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG
"RTN","TIUCPFIX",182,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="KE"
"RTN","TIUCPFIX",183,0)
 M @FDARR=TIUX
"RTN","TIUCPFIX",184,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUCPFIX",185,0)
 I $D(TIUMSG)>9 D
"RTN","TIUCPFIX",186,0)
 . S SUCCESS=0_U_$G(TIUMSG("DIERR",1,"TEXT",1))
"RTN","TIUCPFIX",187,0)
 . D MAIN^TIUPEVNT(TIUBUF,2,"",$P($G(^TIU(8925.1,+RTYPE,0)),U),.FDA,.TIUMSG)
"RTN","TIUCPFIX",188,0)
 E  S SUCCESS=TIUDA
"RTN","TIUCPFIX",189,0)
 Q
"RTN","TIUCPFIX",190,0)
TRNSFRM(RTYPE,FLD,X) ; Executes Transform code for a given header field
"RTN","TIUCPFIX",191,0)
 N XFORM
"RTN","TIUCPFIX",192,0)
 S FLD=$O(^TIU(8925.1,+RTYPE,"HEAD","D",+FLD,0))
"RTN","TIUCPFIX",193,0)
 I +FLD'>0 G TRNSFRMX
"RTN","TIUCPFIX",194,0)
 S XFORM=$G(^TIU(8925.1,+RTYPE,"HEAD",+FLD,1))
"RTN","TIUCPFIX",195,0)
 I XFORM']"" G TRNSFRMX
"RTN","TIUCPFIX",196,0)
 X XFORM
"RTN","TIUCPFIX",197,0)
TRNSFRMX Q X
"RTN","TIUEDI3")
0^1^B37719807
"RTN","TIUEDI3",1,0)
TIUEDI3 ; SLC/MAM - Additional Edit Code ;4/18/03
"RTN","TIUEDI3",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,113**;Jun 20, 1997
"RTN","TIUEDI3",3,0)
 ;
"RTN","TIUEDI3",4,0)
GETRECNW(DFN,TIU,TIUTYP1,TIUNEW,TIUDPRM,TIUINQ,PERSON,EDIT) ; New GETREC.
"RTN","TIUEDI3",5,0)
 ;  Code rewritten from the old GETREC^TIUEDI1.
"RTN","TIUEDI3",6,0)
 ;  GETREC^TIUEDI1 now calls this code.
"RTN","TIUEDI3",7,0)
 ;  New parameters: Left out TIUCREAT since we always used it as 1.
"RTN","TIUEDI3",8,0)
 ;                  Added PERSON and EDIT. 
"RTN","TIUEDI3",9,0)
 ;  Can be called directly, or via GETREC^TIUEDI1 for
"RTN","TIUEDI3",10,0)
 ;backward compatibility. GETREC^TIUEDI1 uses OLD parameters.
"RTN","TIUEDI3",11,0)
 ;  There are 3 functional differences between GETRECNW and the old 
"RTN","TIUEDI3",12,0)
 ;GETREC: First, GETRECNW no longer does RETRY since there should no 
"RTN","TIUEDI3",13,0)
 ;longer be editable entries with no time in the visit field.
"RTN","TIUEDI3",14,0)
 ;Second, if user when creating new docmt is asked if user wants
"RTN","TIUEDI3",15,0)
 ;to edit existing docmt instead, and user says no, and user
"RTN","TIUEDI3",16,0)
 ;cannot create a new docmt, then user is no longer given the
"RTN","TIUEDI3",17,0)
 ;existing record to addend.  User must use a separate addend action.
"RTN","TIUEDI3",18,0)
 ;Third, because code is restructured, code no longer quits before
"RTN","TIUEDI3",19,0)
 ;creating a new docmt if GETRECNW is called with DUOUT, etc defined.
"RTN","TIUEDI3",20,0)
 ;So quit before calling GETRECNW if DUOUT, etc.
"RTN","TIUEDI3",21,0)
 ; Returns document record DA, where DA is:
"RTN","TIUEDI3",22,0)
 ;   new docmt for user to continue entering, or
"RTN","TIUEDI3",23,0)
 ;   existing docmt for user to edit or addend.
"RTN","TIUEDI3",24,0)
 ; If called by upload, DA is:
"RTN","TIUEDI3",25,0)
 ;   new docmt to continue entering, or
"RTN","TIUEDI3",26,0)
 ;   existing docmt for text replacement or addendum.
"RTN","TIUEDI3",27,0)
 ;
"RTN","TIUEDI3",28,0)
 ; Call with:
"RTN","TIUEDI3",29,0)
 ; DFN, TIU array, TIUTYP1 are REQUIRED.
"RTN","TIUEDI3",30,0)
 ;    [DFN] --> Patient IFN.
"RTN","TIUEDI3",31,0)
 ;    [TIU] --> Visit info array
"RTN","TIUEDI3",32,0)
 ;              References TIU("VSTR") = LOC;VDT;VTYP
"RTN","TIUEDI3",33,0)
 ;                         TIU("VISIT") = Visit File IFN
"RTN","TIUEDI3",34,0)
 ;                         TIU("LOC")
"RTN","TIUEDI3",35,0)
 ;                         TIU("VLOC")
"RTN","TIUEDI3",36,0)
 ;                         TIU("STOP") = mark to defer workload
"RTN","TIUEDI3",37,0)
 ; [TIUTYP1] --> Title info variable of form:
"RTN","TIUEDI3",38,0)
 ;              TIUTYP1 = 1^title DA^title Name, where the 1
"RTN","TIUEDI3",39,0)
 ;              is just style to imitate XQORNOD
"RTN","TIUEDI3",40,0)
 ; [TIUNEW] --> flag, passed back with
"RTN","TIUEDI3",41,0)
 ;              TIUNEW = 1 if returned docmt is new
"RTN","TIUEDI3",42,0)
 ;              TIUNEW = 0 if returned docmt already existed,
"RTN","TIUEDI3",43,0)
 ;              timeout, etc
"RTN","TIUEDI3",44,0)
 ;
"RTN","TIUEDI3",45,0)
 ;[TIUDPRM] --> Docmt param array where
"RTN","TIUEDI3",46,0)
 ;              $P($G(TIUDPRM(0)),U,10), = 1 if
"RTN","TIUEDI3",47,0)
 ;              more than ONE record/visit is allowed.
"RTN","TIUEDI3",48,0)
 ;              If TIUDPRM not received, don't worry about
"RTN","TIUEDI3",49,0)
 ;              creating multiple documents
"RTN","TIUEDI3",50,0)
 ; [TIUINQ] --> Ask user flag, where
"RTN","TIUEDI3",51,0)
 ;              TIUINQ = 1: ask re edit/addend existing docmt
"RTN","TIUEDI3",52,0)
 ;              (Interactive List Manager options, TRY docmt def)
"RTN","TIUEDI3",53,0)
 ;              TIUINQ = 0: don't ask (Upload & GUI options)
"RTN","TIUEDI3",54,0)
 ; [PERSON] --> IFN of person asking to edit/create docmt,
"RTN","TIUEDI3",55,0)
 ;              or for upload, = author of document
"RTN","TIUEDI3",56,0)
 ;              If not received, assumed to be DUZ.
"RTN","TIUEDI3",57,0)
 ;   [EDIT] --> flag, passed back with EDIT = 1 if returned
"RTN","TIUEDI3",58,0)
 ;              PREEXISTING docmt can be edited by PERSON. If
"RTN","TIUEDI3",59,0)
 ;              preexisting docmt returned and 'EDIT, then
"RTN","TIUEDI3",60,0)
 ;              docmt cannot be edited by person.
"RTN","TIUEDI3",61,0)
 N TIUVSTR,MULTOK,DA,TLFULL,XISONE
"RTN","TIUEDI3",62,0)
 N EDABLEDA,YESDOIT ;10/3/00
"RTN","TIUEDI3",63,0)
 N TIUTYPDA,TIUTYPNM
"RTN","TIUEDI3",64,0)
 I '$G(PERSON) S PERSON=DUZ
"RTN","TIUEDI3",65,0)
 S TIUVSTR=TIU("VSTR")
"RTN","TIUEDI3",66,0)
 ; -- If just testing a document definition (TRY) rather than
"RTN","TIUEDI3",67,0)
 ;    doing a real note, skip inquiry into existing notes: --
"RTN","TIUEDI3",68,0)
 I +$G(NOSAVE) S DA=$$CREATREC(DFN,.TIU,TIUTYP1),TIUNEW=1 G GETNWX
"RTN","TIUEDI3",69,0)
 ; --  MULTOK: More than ONE record/visit is OK (param permits,
"RTN","TIUEDI3",70,0)
 ;             or didn't care enough to send the parameter)
"RTN","TIUEDI3",71,0)
 ;     TLFULL: Only 1 docmt allowed, and it
"RTN","TIUEDI3",72,0)
 ;                already exists on this title/pt/vst --
"RTN","TIUEDI3",73,0)
 I '$D(TIUDPRM(0)) S MULTOK=1
"RTN","TIUEDI3",74,0)
 E  S MULTOK=+$P(TIUDPRM(0),U,10)
"RTN","TIUEDI3",75,0)
 S (TIUNEW,EDIT,DA,TLFULL,EDABLEDA)=0
"RTN","TIUEDI3",76,0)
 S TIUTYPDA=$P(TIUTYP1,U,2),TIUTYPNM=$P(TIUTYP1,U,3)
"RTN","TIUEDI3",77,0)
 S XISONE=$$EXIST(DFN,TIUTYPDA,TIUVSTR)
"RTN","TIUEDI3",78,0)
 I 'MULTOK,XISONE S TLFULL=1
"RTN","TIUEDI3",79,0)
 ; -- Find existing editable docmts for patient, title, & visit:--
"RTN","TIUEDI3",80,0)
 S EDABLEDA=+$$EXIST(DFN,TIUTYPDA,TIUVSTR,1,PERSON)
"RTN","TIUEDI3",81,0)
 ; -- If there are NO such docmts,
"RTN","TIUEDI3",82,0)
 ;    then create new if title not full,
"RTN","TIUEDI3",83,0)
 ;    or return existing [NONeditable] for addendum [if user wants]: --
"RTN","TIUEDI3",84,0)
 I 'EDABLEDA D  G GETNWX
"RTN","TIUEDI3",85,0)
 . I 'TLFULL S DA=$$CREATREC(DFN,.TIU,TIUTYP1),TIUNEW=1 Q
"RTN","TIUEDI3",86,0)
 . I +$G(TIUINQ) D  Q
"RTN","TIUEDI3",87,0)
 . . W !!,"There is already a ",TIUTYPNM,".",!
"RTN","TIUEDI3",88,0)
 . . W "Only ONE record of this type per Visit is allowed...",!
"RTN","TIUEDI3",89,0)
 . . S YESDOIT=+$$READ^TIUU("Y"," Would you like to addend the existing record","NO")
"RTN","TIUEDI3",90,0)
 . . I YESDOIT S DA=XISONE
"RTN","TIUEDI3",91,0)
 . I '+$G(TIUINQ) S DA=XISONE
"RTN","TIUEDI3",92,0)
 . Q
"RTN","TIUEDI3",93,0)
 ; -- If there ARE such docmts, then
"RTN","TIUEDI3",94,0)
 ;      If title is full, return existing docmt for edit.
"RTN","TIUEDI3",95,0)
 ;      If title is NOT full, return existing docmt for edit,
"RTN","TIUEDI3",96,0)
 ;        or ask user.
"RTN","TIUEDI3",97,0)
 I EDABLEDA D  G GETNWX
"RTN","TIUEDI3",98,0)
 . I TLFULL D:+$G(TIUINQ)  S DA=EDABLEDA,EDIT=1 Q
"RTN","TIUEDI3",99,0)
 . . W !!,"There is already a ",TIUTYPNM," which you may edit."
"RTN","TIUEDI3",100,0)
 . . W !,"Only ONE record of this type per Visit is allowed...",!
"RTN","TIUEDI3",101,0)
 . . W "Opening the existing record"
"RTN","TIUEDI3",102,0)
 . . S TIUCHNG("EXIST")=1
"RTN","TIUEDI3",103,0)
 . I 'TLFULL D  Q
"RTN","TIUEDI3",104,0)
 . . I '+$G(TIUINQ) S DA=EDABLEDA,EDIT=1 Q
"RTN","TIUEDI3",105,0)
 . . W !!,"There is already a ",TIUTYPNM," which you may edit."
"RTN","TIUEDI3",106,0)
 . . S YESDOIT=+$$INQUIRE ; "Create new anyway?"
"RTN","TIUEDI3",107,0)
 . . I $D(DUOUT)!$D(DTOUT)!$D(DIROUT) Q
"RTN","TIUEDI3",108,0)
 . . I YESDOIT S DA=$$CREATREC(DFN,.TIU,TIUTYP1),TIUNEW=1 Q
"RTN","TIUEDI3",109,0)
 . . W !!,"Okay, I'll open the existing record then!"
"RTN","TIUEDI3",110,0)
 . . S DA=EDABLEDA,EDIT=1,TIUCHNG("EXIST")=1
"RTN","TIUEDI3",111,0)
GETNWX ;
"RTN","TIUEDI3",112,0)
 I TIUNEW,'DA S TIUNEW=0
"RTN","TIUEDI3",113,0)
 Q +$G(DA)
"RTN","TIUEDI3",114,0)
 ;
"RTN","TIUEDI3",115,0)
EXIST(DFN,TIUTYPDA,TIUVSTR,REQEDIT,PERSON) ; If a docmt already
"RTN","TIUEDI3",116,0)
 ;EXISTS for the given patient, title, and visit, then return it.
"RTN","TIUEDI3",117,0)
 ; Ignore: - docmts of status deleted or retracted
"RTN","TIUEDI3",118,0)
 ;         - all docmts if run across a docmt w/ requesting pkg
"RTN","TIUEDI3",119,0)
 ;         - I REQEDIT, then also ignore docmts PERSON cannot edit.
"RTN","TIUEDI3",120,0)
 ; If there are more than one, get the smallest DA.
"RTN","TIUEDI3",121,0)
 ; Receives TIUVSTR = LOC;VDT;VTYP
"RTN","TIUEDI3",122,0)
 ; Needs TIUTYPDA = title DA
"RTN","TIUEDI3",123,0)
 ; REQEDIT & PERSON are optional
"RTN","TIUEDI3",124,0)
 N REQUEST,DA,TIUI,STATUS,RETRY
"RTN","TIUEDI3",125,0)
 S REQEDIT=+$G(REQEDIT)
"RTN","TIUEDI3",126,0)
 I '$G(PERSON) S PERSON=DUZ
"RTN","TIUEDI3",127,0)
 S (REQUEST,TIUI,DA)=0
"RTN","TIUEDI3",128,0)
LOOP ; -- Find existing docmt for given patient, title, & visit:--
"RTN","TIUEDI3",129,0)
 F  S TIUI=+$O(^TIU(8925,"APTLD",DFN,TIUTYPDA,TIUVSTR,TIUI)) Q:'TIUI  D  Q:REQUEST  Q:DA
"RTN","TIUEDI3",130,0)
 . ; -- If TIUI doesn't exist, reject it and keep looking: --
"RTN","TIUEDI3",131,0)
 . I '$D(^TIU(8925,TIUI,0)) D  Q
"RTN","TIUEDI3",132,0)
 . . K ^TIU(8925,"APTLD",DFN,TIUTYPDA,TIUVSTR,TIUI)
"RTN","TIUEDI3",133,0)
 . ; -- If TIUI has requesting package (e.g. Consults),
"RTN","TIUEDI3",134,0)
 . ;    then reject it and quit looking: --
"RTN","TIUEDI3",135,0)
 . I +$P($G(^TIU(8925,TIUI,14)),U,5) S REQUEST=1 Q  ; **22**
"RTN","TIUEDI3",136,0)
 . ; -- If TIUI has status deleted or retracted, reject it
"RTN","TIUEDI3",137,0)
 . ;    and keep looking: TIU*1*61 --
"RTN","TIUEDI3",138,0)
 . S STATUS=+$P($G(^TIU(8925,TIUI,0)),U,5)
"RTN","TIUEDI3",139,0)
 . I STATUS=14!(STATUS=15) Q
"RTN","TIUEDI3",140,0)
 . ; -- If OK so far, and record not required to be editable,
"RTN","TIUEDI3",141,0)
 . ;then grab existing record and stop looking: --
"RTN","TIUEDI3",142,0)
 . I 'REQEDIT S DA=TIUI Q
"RTN","TIUEDI3",143,0)
 . ; -- If REQEDIT & PERSON can edit existing record,
"RTN","TIUEDI3",144,0)
 . ;    then grab it and stop looking: --
"RTN","TIUEDI3",145,0)
 . N CANEDIT S CANEDIT=+$$CANDO^TIULP(TIUI,"EDIT RECORD",PERSON)
"RTN","TIUEDI3",146,0)
 . I +CANEDIT>0 S DA=TIUI
"RTN","TIUEDI3",147,0)
 ; -- If record not required to be editable & still haven't
"RTN","TIUEDI3",148,0)
 ;    found a record, check for records with no visit time: --
"RTN","TIUEDI3",149,0)
 ;    (Early anomaly with DSs at Boston)
"RTN","TIUEDI3",150,0)
 I +DA'>0,($P(TIUVSTR,";",3)="H"),(+$G(RETRY)'>0) D  G LOOP
"RTN","TIUEDI3",151,0)
 . S RETRY=1,$P(TIUVSTR,";",2)=$P($P(TIUVSTR,";",2),".")
"RTN","TIUEDI3",152,0)
EXISTEX ;
"RTN","TIUEDI3",153,0)
 Q +$G(DA)
"RTN","TIUEDI3",154,0)
 ;
"RTN","TIUEDI3",155,0)
CREATREC(DFN,TIU,TIUTYP1) ; Create document record - Returns DA
"RTN","TIUEDI3",156,0)
 ; Receives array TIU as in GETRECNW
"RTN","TIUEDI3",157,0)
 ; Needs var TIUTYP1 as in GETRECNW
"RTN","TIUEDI3",158,0)
 N DIC,DLAYGO,X,Y,TIUFPRIV,TIUVTYP,RETRY,TIUVSTR,TIUVISIT,DA
"RTN","TIUEDI3",159,0)
 N TIUTYPDA,TIUTYPNM
"RTN","TIUEDI3",160,0)
 S TIUTYPDA=$P(TIUTYP1,U,2),TIUTYPNM=$P(TIUTYP1,U,3)
"RTN","TIUEDI3",161,0)
 S TIUVSTR=TIU("VSTR")
"RTN","TIUEDI3",162,0)
 S DA=0,TIUFPRIV=1
"RTN","TIUEDI3",163,0)
 S (DIC,DLAYGO)=8925,DIC(0)="FL"
"RTN","TIUEDI3",164,0)
 S X=""""_"`"_TIUTYPDA_"""" D ^DIC
"RTN","TIUEDI3",165,0)
 I +Y'>0 W !,TIUTYPNM," record could not be created.",! G CREXIT
"RTN","TIUEDI3",166,0)
 ; -- Stuff patient, visit, parent doc type, status,
"RTN","TIUEDI3",167,0)
 ;    visit type, hosp loc, visit loc, division: --
"RTN","TIUEDI3",168,0)
 S DA=+Y
"RTN","TIUEDI3",169,0)
 N DIE,DR S DIE=8925
"RTN","TIUEDI3",170,0)
 S TIUVTYP=$P($G(TIUVSTR),";",3)
"RTN","TIUEDI3",171,0)
 S TIUVISIT=$S(+$G(TIU("VISIT")):+$G(TIU("VISIT")),1:"")
"RTN","TIUEDI3",172,0)
 S DR=".02////"_DFN_";.03////"_TIUVISIT_";.04////"_$$DOCCLASS^TIULC1(+$P(Y,U,2))_";.05///"_$$UP^XLFSTR($$STATUS^TIULC(DA))_";.13////"_TIUVTYP_";1205////"_$P($G(TIU("LOC")),U)_";1211////"_$P($G(TIU("VLOC")),U)_";1212////"_$P($G(TIU("INST")),U)
"RTN","TIUEDI3",173,0)
 D ^DIE
"RTN","TIUEDI3",174,0)
 ; -- [Mark record for deferred crediting of stop code (fld #.11)]: --
"RTN","TIUEDI3",175,0)
 I +$G(TIU("STOP")) D DEFER^TIUVSIT(DA,+$G(TIU("STOP")))
"RTN","TIUEDI3",176,0)
CREXIT Q +$G(DA)
"RTN","TIUEDI3",177,0)
 ;
"RTN","TIUEDI3",178,0)
INQUIRE() ; Ask user whether to create a new note anyway
"RTN","TIUEDI3",179,0)
 N TIUY,TIUPRMT
"RTN","TIUEDI3",180,0)
 S TIUY=0,TIUPRMT="Do you want to create a new record anyway"
"RTN","TIUEDI3",181,0)
 S TIUY=+$$READ^TIUU("Y",TIUPRMT,"NO")
"RTN","TIUEDI3",182,0)
 Q TIUY
"RTN","TIUEDI3",183,0)
 ;
"RTN","TIUELST")
0^2^B33141590
"RTN","TIUELST",1,0)
TIUELST ; SLC/JER - Review Filer Events ;9/24/03
"RTN","TIUELST",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**81,113**;Jun 20, 1997
"RTN","TIUELST",3,0)
EN ; Invoke List Manager
"RTN","TIUELST",4,0)
 D EN^VALM("TIU REVIEW FILING EVENTS")
"RTN","TIUELST",5,0)
 S VALMBCK="Q"
"RTN","TIUELST",6,0)
 Q
"RTN","TIUELST",7,0)
MAKELIST ; Build review screen list
"RTN","TIUELST",8,0)
 ; For Types 1;FILING ERRORS and
"RTN","TIUELST",9,0)
 ;           2;MISSING FIELD ERRORS,
"RTN","TIUELST",10,0)
 ;status is 0;UNRESOLVED or
"RTN","TIUELST",11,0)
 ;          1;RESOLVED or
"RTN","TIUELST",12,0)
 ;          2;UNRESOLVED/RESOLVED.
"RTN","TIUELST",13,0)
 ; For Types 0;SUCCESSFUL FILING EVENTS and
"RTN","TIUELST",14,0)
 ;           3;FILING EVENTS,
"RTN","TIUELST",15,0)
 ;status is "".
"RTN","TIUELST",16,0)
 N TIUI,TIUTMP,TYPE,STATUS,TIUK
"RTN","TIUELST",17,0)
DIVISION ; Select Division(s)
"RTN","TIUELST",18,0)
 D SELDIV^TIULA
"RTN","TIUELST",19,0)
 I SELDIV'>0 S VALMQUIT=1 Q
"RTN","TIUELST",20,0)
 I $D(TIUDI) D
"RTN","TIUELST",21,0)
 . S TIUK=0 F  S TIUK=$O(TIUDI(TIUK)) Q:'TIUK  D
"RTN","TIUELST",22,0)
 . . S TIUDI("ENTRIES")=$G(TIUDI("ENTRIES"))_TIUK_";"
"RTN","TIUELST",23,0)
 E  D
"RTN","TIUELST",24,0)
 . S TIUDI("ENTRIES")="ALL DIVISIONS"
"RTN","TIUELST",25,0)
 S TYPE=$$SELTYPE("FILING ERRORS")
"RTN","TIUELST",26,0)
 I +TYPE=1 S STATUS=$$SELRES("UNRESOLVED") ; 1: Filing errors
"RTN","TIUELST",27,0)
 I +TYPE=2 S STATUS=$$SELRES("UNRESOLVED") ; 2: Missing Field errors
"RTN","TIUELST",28,0)
 I +TYPE=0 S STATUS="" ; 0: Successful filing events
"RTN","TIUELST",29,0)
 I +TYPE=3 S STATUS="" ; 3: All filing events
"RTN","TIUELST",30,0)
 I '$D(STATUS) S STATUS=""
"RTN","TIUELST",31,0)
 I +$G(DIRUT) S VALMQUIT=1 Q
"RTN","TIUELST",32,0)
 S TIUEDT=$$EDATE^TIULA("Event","T-30")
"RTN","TIUELST",33,0)
 I TIUEDT'>0 S VALMQUIT=1 Q
"RTN","TIUELST",34,0)
 S TIULDT=$$LDATE^TIULA("Event")
"RTN","TIUELST",35,0)
 I TIULDT'>0 S VALMQUIT=1 Q
"RTN","TIUELST",36,0)
 ; If TIUEDT is NOT earlier than TIULDT, then swap
"RTN","TIUELST",37,0)
 I TIUEDT>TIULDT S TIUTMP=TIUEDT,TIUEDT=TIULDT,TIULDT=TIUTMP
"RTN","TIUELST",38,0)
 W !,"Searching for the events."
"RTN","TIUELST",39,0)
 D BUILD(TYPE,STATUS,TIUEDT,TIULDT,.TIUDI)
"RTN","TIUELST",40,0)
 K TIUDI,SELDIV
"RTN","TIUELST",41,0)
 Q
"RTN","TIUELST",42,0)
SELTYPE(DFLT) ; Select Event Type
"RTN","TIUELST",43,0)
 N PRMT,READTYPE,X,Y
"RTN","TIUELST",44,0)
 S PRMT="Select Event Type: "
"RTN","TIUELST",45,0)
 S READTYPE="SMA^F:Filing Errors;M:Missing Field Errors;S:Successes;A:All Events"
"RTN","TIUELST",46,0)
 S Y=$P($$READ^TIUU(READTYPE,PRMT,DFLT),U)
"RTN","TIUELST",47,0)
 S Y=$S(Y="S":"0;SUCCESSFUL FILING EVENTS",Y="F":"1;FILING ERRORS",Y="M":"2;MISSING FIELD ERRORS",1:"3;FILING EVENTS")
"RTN","TIUELST",48,0)
 Q Y
"RTN","TIUELST",49,0)
SELRES(DFLT) ; Select Resolution status
"RTN","TIUELST",50,0)
 N PRMT,READTYPE,X,Y
"RTN","TIUELST",51,0)
 S PRMT="Select Resolution Status: "
"RTN","TIUELST",52,0)
 S READTYPE="SAM^U:Unresolved Errors;R:Resolved Errors;B:Both Unresolved and Resolved"
"RTN","TIUELST",53,0)
 S Y=$P($$READ^TIUU(READTYPE,PRMT,DFLT),U)
"RTN","TIUELST",54,0)
 S Y=$S(Y="U":"0;UNRESOLVED",Y="R":"1;RESOLVED",1:"2;UNRESOLVED/RESOLVED")
"RTN","TIUELST",55,0)
 Q Y
"RTN","TIUELST",56,0)
 ;
"RTN","TIUELST",57,0)
BUILD(TIUTYP,STATUS,EARLY,LATE,DIVIFNS) ; Build List
"RTN","TIUELST",58,0)
 N TIUCNT,TIUI,TIUJ,TIUK,TIUP,TIUPICK,TIUREC,TIUSTAT,XREF
"RTN","TIUELST",59,0)
 S VALMCNT=0
"RTN","TIUELST",60,0)
 K ^TMP("TIUERR",$J),^TMP("TIUERRIDX",$J)
"RTN","TIUELST",61,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIUELST",62,0)
 I '$D(TIUPRM0)!'$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUELST",63,0)
 ; For type 3 ALL events, get types 0 for SUCCESSFUL, 1 for FILING ERROR,
"RTN","TIUELST",64,0)
 ;& 2 for MISSING FIELD ERROR.  For other types, just get that type:
"RTN","TIUELST",65,0)
 F TYPE=$S(+TIUTYP=3:0,1:+TIUTYP):1:$S(+TIUTYP=3:2,1:+TIUTYP) D
"RTN","TIUELST",66,0)
 . S TIUI=0 F  S TIUI=$O(^TIU(8925.4,"D",TYPE,TIUI)) Q:+TIUI'>0  D
"RTN","TIUELST",67,0)
 . . I +$G(^TIU(8925.4,+TIUI,0))'<EARLY,(+$G(^(0))'>LATE) D
"RTN","TIUELST",68,0)
 . . . ; If status is UNRESOLVED or RESOLVED, get only matching status;
"RTN","TIUELST",69,0)
 . . . I STATUS'="",+STATUS'=2 Q:+STATUS'=$P($G(^TIU(8925.4,+TIUI,0)),U,6)
"RTN","TIUELST",70,0)
 . . . I +$G(DIVIFNS("ENTRIES")),'$$ININST(+TIUI,.DIVIFNS) Q
"RTN","TIUELST",71,0)
 . . . N DIC,DIQ,DA,DR,TIUERR,EDT,RDT,DTYPE,EDESC,USER,ETYPE,INST,INSTA,TIUSTN
"RTN","TIUELST",72,0)
 . . . S DIQ="TIUERR",DIC=8925.4,DIQ(0)="IE",DA=TIUI
"RTN","TIUELST",73,0)
 . . . S DR=".01:.09" D EN^DIQ1
"RTN","TIUELST",74,0)
 . . . S USER=$$NAME^TIULS(TIUERR(8925.4,DA,.02,"E"),"LAST, FIRST")
"RTN","TIUELST",75,0)
 . . . S EDT=$$DATE^TIULS(TIUERR(8925.4,DA,.01,"I"),"MM/DD/YY HR:MIN")
"RTN","TIUELST",76,0)
 . . . S RDT=$$DATE^TIULS(TIUERR(8925.4,DA,.07,"I"),"MM/DD/YY HR:MIN")
"RTN","TIUELST",77,0)
 . . . S DTYPE=TIUERR(8925.4,DA,.03,"E")
"RTN","TIUELST",78,0)
 . . . S ETYPE=TIUERR(8925.4,DA,.08,"E"),EDESC=TIUERR(8925.4,DA,.04,"E")
"RTN","TIUELST",79,0)
 . . . S INSTA="",INST=TIUERR(8925.4,DA,.09,"I")
"RTN","TIUELST",80,0)
 . . . I INST D
"RTN","TIUELST",81,0)
 . . . . S TIUSTN=$$NS^XUAF4(INST)
"RTN","TIUELST",82,0)
 . . . . I $P(TIUSTN,U,2)]"" S INSTA=$P(TIUSTN,U,2)
"RTN","TIUELST",83,0)
 . . . S INSTA=$E(INSTA,1,8)
"RTN","TIUELST",84,0)
 . . . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUELST",85,0)
 . . . S TIUREC=$$SETFLD^VALM1(TIUCNT,"","NUMBER")
"RTN","TIUELST",86,0)
 . . . S TIUREC=$$SETFLD^VALM1(DTYPE,TIUREC,"DOCUMENT TYPE")
"RTN","TIUELST",87,0)
 . . . S TIUREC=$$SETFLD^VALM1(ETYPE,TIUREC,"EVENT TYPE")
"RTN","TIUELST",88,0)
 . . . S TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"EVENT DATE/TIME")
"RTN","TIUELST",89,0)
 . . . S TIUREC=$$SETFLD^VALM1(RDT,TIUREC,"RESOL DATE/TIME")
"RTN","TIUELST",90,0)
 . . . S TIUREC=$$SETFLD^VALM1(USER,TIUREC,"USER NAME")
"RTN","TIUELST",91,0)
 . . . S TIUREC=$$SETFLD^VALM1(INSTA,TIUREC,"DIVISION")
"RTN","TIUELST",92,0)
 . . . S VALMCNT=+$G(VALMCNT)+1
"RTN","TIUELST",93,0)
 . . . S ^TMP("TIUERR",$J,VALMCNT,0)=TIUREC
"RTN","TIUELST",94,0)
 . . . S ^TMP("TIUERR",$J,"IDX",VALMCNT,TIUCNT)=""
"RTN","TIUELST",95,0)
 . . . S ^TMP("TIUERR",$J,"PICK",TIUCNT,VALMCNT)=""
"RTN","TIUELST",96,0)
 . . . D FLDCTRL^VALM10(VALMCNT,"NUMBER",IOINHI,IOINORM)
"RTN","TIUELST",97,0)
 . . . S VALMCNT=+$G(VALMCNT)+1 W:VALMCNT#5'>0 "."
"RTN","TIUELST",98,0)
 . . . S ^TMP("TIUERR",$J,VALMCNT,0)=$$SETFLD^VALM1(EDESC,"","DESCRIPTION")
"RTN","TIUELST",99,0)
 . . . S ^TMP("TIUERR",$J,"IDX",VALMCNT,TIUCNT)=""
"RTN","TIUELST",100,0)
 . . . S ^TMP("TIUERR",$J,"PICK",TIUCNT,VALMCNT)=""
"RTN","TIUELST",101,0)
 . . . S ^TMP("TIUERRIDX",$J,TIUCNT)=VALMCNT_U_TIUI_U_$P(^TIU(8925.4,+TIUI,0),U,5)
"RTN","TIUELST",102,0)
 ;
"RTN","TIUELST",103,0)
 S ^TMP("TIUERR",$J,0)=+$G(TIUCNT)_U_TIUTYP_U_STATUS
"RTN","TIUELST",104,0)
 S ^TMP("TIUERR",$J,"#")=TIUPICK_"^1:"_+$G(TIUCNT)
"RTN","TIUELST",105,0)
 M ^TMP("TIUERR",$J,"DIV")=DIVIFNS
"RTN","TIUELST",106,0)
 I $D(VALMHDR)>9 D HDR
"RTN","TIUELST",107,0)
 I +$G(TIUCNT)'>0 D
"RTN","TIUELST",108,0)
 . S ^TMP("TIUERR",$J,1,0)="",VALMCNT=2
"RTN","TIUELST",109,0)
 . I +TIUTYP=1!(+TIUTYP=2) S STATUS=$$LOWER^TIULS($P(STATUS,";",2)),STATUS=STATUS_" "
"RTN","TIUELST",110,0)
 . S ^TMP("TIUERR",$J,2,0)="No "_STATUS_$$LOWER^TIULS($P(TIUTYP,";",2))_" found within date/time range"
"RTN","TIUELST",111,0)
 Q
"RTN","TIUELST",112,0)
ININST(TIUI,TIUDI) ; Evaluates whether a TIU UPLOAD LOG record
"RTN","TIUELST",113,0)
 ; is among the selected division(s)
"RTN","TIUELST",114,0)
 ; Input -- TIUI    TIU UPLOAD LOG file (#8925.4) IEN
"RTN","TIUELST",115,0)
 ;       -- TIUDI(  i.e. TIUDI(file #40.8 IEN)=Institution file
"RTN","TIUELST",116,0)
 ;                                          pointer for file #40.8 entry
"RTN","TIUELST",117,0)
 ; Output - TIUY    0= record not in selected division
"RTN","TIUELST",118,0)
 ;                  1= record in selected division
"RTN","TIUELST",119,0)
 N TIUIFP,TIUJ,TIUINST,TIUY S TIUY=0
"RTN","TIUELST",120,0)
 S TIUINST=+$P($G(^TIU(8925.4,+TIUI,0)),U,9)
"RTN","TIUELST",121,0)
 S TIUJ=0 F  S TIUJ=$O(TIUDI(TIUJ)) Q:'TIUJ!TIUY  D
"RTN","TIUELST",122,0)
 . S TIUIFP=$G(TIUDI(TIUJ))
"RTN","TIUELST",123,0)
 . I TIUIFP=TIUINST S TIUY=1
"RTN","TIUELST",124,0)
 Q TIUY
"RTN","TIUELST",125,0)
HDR ; Initialize header for review screen
"RTN","TIUELST",126,0)
 N BY,TIUX,SCREEN,STATUS,TITLE
"RTN","TIUELST",127,0)
 S TIUX=$G(^TMP("TIUERR",$J,0))
"RTN","TIUELST",128,0)
 ;TIU*1*81 status = 3rd, not 2nd piece of TIUX; hdr wrote UNRESOLVED instead of SUCCESSFUL
"RTN","TIUELST",129,0)
 S TYPE=$P(TIUX,U,2),STATUS=$P(TIUX,U,3)
"RTN","TIUELST",130,0)
 I +TYPE=0 S TITLE=$P(TYPE,";",2)
"RTN","TIUELST",131,0)
 I +TYPE=1!(+TYPE=2) D
"RTN","TIUELST",132,0)
 . S TITLE=$P(STATUS,";",2)
"RTN","TIUELST",133,0)
 . S TITLE=TITLE_" "_$P(TYPE,";",2)
"RTN","TIUELST",134,0)
 I +TYPE=3 S TITLE="ALL FILING EVENTS"
"RTN","TIUELST",135,0)
 I '$D(TITLE) S TITLE=""
"RTN","TIUELST",136,0)
 I +TIUEDT>1 S TITLE=TITLE_" from "_$$DATE^TIULS(TIUEDT,"MM/DD/YY")_" to "_$$DATE^TIULS(TIULDT,"MM/DD/YY")
"RTN","TIUELST",137,0)
 S VALMHDR(1)=$$CENTER^TIULS(TITLE)
"RTN","TIUELST",138,0)
 Q
"RTN","TIUELST",139,0)
CLEAN ; Clean up your mess!
"RTN","TIUELST",140,0)
 K ^TMP("TIUERR",$J),^TMP("TIUERRIDX",$J) D CLEAN^VALM10
"RTN","TIUELST",141,0)
 K VALMY
"RTN","TIUELST",142,0)
 Q
"RTN","TIUEN113")
0^^B3082104
"RTN","TIUEN113",1,0)
TIUEN113 ; SLC/JAK - Environment Check for TIU*1*113 ;28-AUG-2001 08:43
"RTN","TIUEN113",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**113**;Jun 20, 1997
"RTN","TIUEN113",3,0)
MAIN ; -- Control Unit
"RTN","TIUEN113",4,0)
 ; Check all Hospital Location entries for division and all
"RTN","TIUEN113",5,0)
 ; Medical Center Division entries for institution file pointer;
"RTN","TIUEN113",6,0)
 ; if not all data present, quit
"RTN","TIUEN113",7,0)
 ;
"RTN","TIUEN113",8,0)
 N CHKOK,TIULOC S CHKOK=1,TIULOC=0
"RTN","TIUEN113",9,0)
 W !!,"Checking DIVISION for all Hospital Location file (#44)"
"RTN","TIUEN113",10,0)
 W !,"entries <AND> INSTITUTION FILE POINTER for all Medical"
"RTN","TIUEN113",11,0)
 W !,"Center Division file (#40.8) entries..."
"RTN","TIUEN113",12,0)
 W !!
"RTN","TIUEN113",13,0)
 ;
"RTN","TIUEN113",14,0)
 F  S TIULOC=$O(^SC(TIULOC)) Q:'TIULOC!('CHKOK)  D
"RTN","TIUEN113",15,0)
 . N TIUDVHL
"RTN","TIUEN113",16,0)
 . S TIUDVHL=+$P($G(^SC(TIULOC,0)),U,15) I 'TIUDVHL S CHKOK=0 Q
"RTN","TIUEN113",17,0)
 I CHKOK=1 D
"RTN","TIUEN113",18,0)
 . N TIUDIV,TIUIFP S TIUDIV=0
"RTN","TIUEN113",19,0)
 . F  S TIUDIV=$O(^DG(40.8,TIUDIV)) Q:'TIUDIV!('CHKOK)  D
"RTN","TIUEN113",20,0)
 . . S TIUIFP=+$G(^DG(40.8,"ADV",TIUDIV)) I 'TIUIFP S CHKOK=0 Q
"RTN","TIUEN113",21,0)
 ;
"RTN","TIUEN113",22,0)
 I 'CHKOK D
"RTN","TIUEN113",23,0)
 . S XPDQUIT=1 ; kill transport global from ^XTMP
"RTN","TIUEN113",24,0)
 . W !,"Sorry...DIVISION cannot be determined for all Hospital"
"RTN","TIUEN113",25,0)
 . W !,"Location file (#44) entries <AND/OR> INSTITUTION FILE"
"RTN","TIUEN113",26,0)
 . W !,"POINTER cannot be determined for all Medical Center"
"RTN","TIUEN113",27,0)
 . W !,"Division file (#40.8) entries. Please review and correct"
"RTN","TIUEN113",28,0)
 . W !,"both files as necessary."
"RTN","TIUEN113",29,0)
 . W !!,"** ABORTING INSTALLATION **"
"RTN","TIUEN113",30,0)
 E  D
"RTN","TIUEN113",31,0)
 . W !,"** Files are OK **"
"RTN","TIUEN113",32,0)
 Q
"RTN","TIULA")
0^4^B43272352
"RTN","TIULA",1,0)
TIULA ; SLC/JER - Interactive Library functions ;9/29/03
"RTN","TIULA",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**79,113**;Jun 20, 1997
"RTN","TIULA",3,0)
PATIENT(TIUSSN) ; Select a patient
"RTN","TIULA",4,0)
 N X,DIC,Y S:$G(TIUSSN)]"" X=TIUSSN
"RTN","TIULA",5,0)
 S DIC=2,DIC(0)=$S($G(TIUSSN)']"":"AEMQ",1:"MX") D ^DIC
"RTN","TIULA",6,0)
 Q Y
"RTN","TIULA",7,0)
SELDIV ; Get document division(s)
"RTN","TIULA",8,0)
 ;
"RTN","TIULA",9,0)
 ; Output - SELDIV  -1= user ^ at prompt if multidivisional
"RTN","TIULA",10,0)
 ;                   0= institution file pointer missing for
"RTN","TIULA",11,0)
 ;                      division entry
"RTN","TIULA",12,0)
 ;                   1= successful division selection
"RTN","TIULA",13,0)
 ;          TIUDI(  undefined= user <cr> for all divisions or ^ at prompt
"RTN","TIULA",14,0)
 ;                             if multidivisional
"RTN","TIULA",15,0)
 ;                  defined= user selected one or more divisions if
"RTN","TIULA",16,0)
 ;                           multidivisional, or pre-selection of
"RTN","TIULA",17,0)
 ;                           division file entry if not multidivisional;
"RTN","TIULA",18,0)
 ;                           i.e.: TIUDI(file #40.8 ien)= Institution
"RTN","TIULA",19,0)
 ;                           file pointer for file #40.8 entry
"RTN","TIULA",20,0)
 N TIUI K SELDIV,TIUDI
"RTN","TIULA",21,0)
 ; -- Determine if facility is multidivisional
"RTN","TIULA",22,0)
 I $P($G(^DG(43,1,"GL")),U,2) D
"RTN","TIULA",23,0)
 . D DIVISION^VAUTOMA
"RTN","TIULA",24,0)
 . I Y<0 S SELDIV=-1 Q
"RTN","TIULA",25,0)
 . I VAUTD=1 S SELDIV=1 Q
"RTN","TIULA",26,0)
 . S TIUI=0 F  S TIUI=$O(VAUTD(TIUI)) Q:'TIUI  D ONE(TIUI)
"RTN","TIULA",27,0)
 E  D
"RTN","TIULA",28,0)
 . S TIUI=$$PRIM^VASITE D ONE(TIUI)
"RTN","TIULA",29,0)
 Q
"RTN","TIULA",30,0)
ONE(TIUI) ; Input - TIUI  Medical Center Division file (#40.8) IEN
"RTN","TIULA",31,0)
 N TIUIFP
"RTN","TIULA",32,0)
 S TIUIFP=$P($$SITE^VASITE(,TIUI),U) I TIUIFP>0 D
"RTN","TIULA",33,0)
 . S TIUDI(TIUI)=TIUIFP,SELDIV=1
"RTN","TIULA",34,0)
 E  D
"RTN","TIULA",35,0)
 . S SELDIV=0
"RTN","TIULA",36,0)
 Q
"RTN","TIULA",37,0)
 ;
"RTN","TIULA",38,0)
SELSVC(TIUSVCS) ;Select Services
"RTN","TIULA",39,0)
 ; Input  -- None
"RTN","TIULA",40,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIULA",41,0)
 ;           TIUSVCS  Service Selection Array
"RTN","TIULA",42,0)
 N TIUCNT,TIUSVCI,Y
"RTN","TIULA",43,0)
 S TIUCNT=0
"RTN","TIULA",44,0)
 F  Q:'$$ASKSVC(.TIUSVCS,TIUCNT,.TIUSVCI)  D
"RTN","TIULA",45,0)
 . S TIUSVCS(+TIUSVCI)=""
"RTN","TIULA",46,0)
 . S TIUCNT=TIUCNT+1
"RTN","TIULA",47,0)
 . S TIUSVCI=""
"RTN","TIULA",48,0)
 I $G(TIUSVCI)=-1 S Y=0 G SELSVCQ
"RTN","TIULA",49,0)
 I $G(TIUSVCI)="ALL" S TIUSVCS="ALL"
"RTN","TIULA",50,0)
 S Y=1
"RTN","TIULA",51,0)
SELSVCQ Q +$G(Y)
"RTN","TIULA",52,0)
 ;
"RTN","TIULA",53,0)
ASKSVC(TIUSVCS,TIUCNT,TIUSVCI) ;Ask Service
"RTN","TIULA",54,0)
 ; Input  -- TIUSVCS  Service Selection Array
"RTN","TIULA",55,0)
 ;           TIUCNT   Number of Services Selected    
"RTN","TIULA",56,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIULA",57,0)
 ;           TIUSVCI  Service/Section file (#49) IEN
"RTN","TIULA",58,0)
 N DIR,DTOUT,DUOUT,X,Y
"RTN","TIULA",59,0)
 S DIR(0)="PAO^49:AEMQ^K:'$$CHKSVC^TIULA(.TIUSVCS,+Y) X"
"RTN","TIULA",60,0)
 S DIR("PRE")="I X="""",'$G(TIUCNT),'$D(DTOUT) S TIUSVCI=""ALL"""
"RTN","TIULA",61,0)
 S DIR("A")="Select "_$S($G(TIUCNT):"another ",1:"")_"service: "_$S('$G(TIUCNT):"ALL// ",1:"")
"RTN","TIULA",62,0)
 I '$G(TIUCNT) S DIR("?")="   OR enter Return for ALL services." W !
"RTN","TIULA",63,0)
 D ^DIR
"RTN","TIULA",64,0)
 I Y>0 S TIUSVCI=+Y
"RTN","TIULA",65,0)
 I $D(DTOUT)!($D(DUOUT)) S TIUSVCI=-1
"RTN","TIULA",66,0)
 Q $S($G(TIUSVCI)>0:1,1:0)
"RTN","TIULA",67,0)
 ;
"RTN","TIULA",68,0)
CHKSVC(TIUSVCS,TIUSVCI) ;Check Selected Service
"RTN","TIULA",69,0)
 ; Input  -- TIUSVCS  Service Selection Array
"RTN","TIULA",70,0)
 ;           TIUSVCI  Service file (#49) IEN
"RTN","TIULA",71,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIULA",72,0)
 N Y
"RTN","TIULA",73,0)
 S Y=1
"RTN","TIULA",74,0)
 ;Check if Service has already been selected
"RTN","TIULA",75,0)
 I $D(TIUSVCS(TIUSVCI)) D EN^DDIOL("This Service has already been selected.","","!?5") S Y=0
"RTN","TIULA",76,0)
 Q +$G(Y)
"RTN","TIULA",77,0)
 ;
"RTN","TIULA",78,0)
SELSTAT(Y,PARM,DEF) ; Select Signature status
"RTN","TIULA",79,0)
 N I,XQORM,X,TIUY
"RTN","TIULA",80,0)
 S XQORM=+$O(^ORD(101,"B","TIU STATUS MENU",0))_";ORD(101,"
"RTN","TIULA",81,0)
 I +XQORM'>0 W !,"Status selection unavailable." S TIUY=-1 G STATX
"RTN","TIULA",82,0)
 S XQORM(0)=$G(PARM),XQORM("A")="Select Status: "
"RTN","TIULA",83,0)
 I $S(PARM="F":1,PARM="R":1,1:0) S X=DEF
"RTN","TIULA",84,0)
 S XQORM("B")=DEF D ^XQORM
"RTN","TIULA",85,0)
 S TIUY=$G(Y)
"RTN","TIULA",86,0)
 I +$G(Y)=1,(+$G(Y(1))=7) S Y=2,Y(2)="8^4843^amended^8"
"RTN","TIULA",87,0)
STATX Q TIUY
"RTN","TIULA",88,0)
SELSCRN(DEF) ; Select Review Screen
"RTN","TIULA",89,0)
 N DIC,XQORM,X
"RTN","TIULA",90,0)
 S DIC=101,DIC(0)="X",X="TIU REVIEW SCREEN MENU" D ^DIC
"RTN","TIULA",91,0)
 I +Y>0 D
"RTN","TIULA",92,0)
 . S XQORM=+Y_";ORD(101,",XQORM(0)="1A",XQORM("A")="Select Category: "
"RTN","TIULA",93,0)
 . S XQORM("S")="I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),U),24)) ^(24)"
"RTN","TIULA",94,0)
 . S XQORM("B")=DEF D ^XQORM
"RTN","TIULA",95,0)
 . I +Y,($D(Y)>9) D
"RTN","TIULA",96,0)
 . . S Y=$S(Y(1)["Author":"AAU",Y(1)["Patient":"APT",Y(1)["Spec":"ATS",Y(1)["Transcrip":"ATC",Y(1)["All":"ALL",Y(1)["Subject":"ASUB",Y(1)["Service":"ASVC",Y(1)["Location":"ALOC",1:"")
"RTN","TIULA",97,0)
 . . I +$G(Y(1))'>0,(X'="^^"),(X'="^") D  Q
"RTN","TIULA",98,0)
 . . . W !,"^^-jumps not allowed from this prompt." S Y=-1
"RTN","TIULA",99,0)
 . . S:Y'="ALL" Y=Y_U_$$SELPAR(Y)
"RTN","TIULA",100,0)
 . . S:Y="ALL" Y=Y_U_"ANY"
"RTN","TIULA",101,0)
 Q Y
"RTN","TIULA",102,0)
SELPAR(DEF) ; Select an author or patient or... 
"RTN","TIULA",103,0)
 N DIC,X,Y
"RTN","TIULA",104,0)
 I DEF="ASUB" S Y=$$ASKSUBJ^TIULA1 G SELPARX
"RTN","TIULA",105,0)
 S DIC=$S(DEF="APT":2,DEF="ATS":45.7,DEF="ASVC":123.5,1:200)
"RTN","TIULA",106,0)
 S DIC(0)="AEMQ"
"RTN","TIULA",107,0)
 S DIC("A")="Select "_$S(DEF="APT":"PATIENT",DEF="AAU":"AUTHOR",DEF="ATS":"TREATING SPECIALTY",DEF="ATC":"TRANSCRIPTIONIST",DEF="ASVC":"SERVICE",1:"ATTENDING PHYSICIAN")_": "
"RTN","TIULA",108,0)
 I DEF="ARP" S DIC("S")="I $$ISA^USRLA(+$G(Y),""PROVIDER"")"
"RTN","TIULA",109,0)
 D ^DIC K DIC("S") I +Y>0 D
"RTN","TIULA",110,0)
 . I $S(DEF="APT"&'$D(^TIU(8925,"C",+Y)):1,DEF="AAU"&'$D(^TIU(8925,"CA",+Y)):1,DEF="ARP"&'$D(^TIU(8925,"CR",+Y)):1,1:0) W !,"No entries for ",$P(Y,U,2) S Y=0
"RTN","TIULA",111,0)
SELPARX Q Y
"RTN","TIULA",112,0)
EDATE(PRMPT,STATUS,DFLT) ; Get early date
"RTN","TIULA",113,0)
 N X,Y,TIUPRMT,TIUDFLT
"RTN","TIULA",114,0)
 I $G(STATUS)=4 S Y=1 Q Y
"RTN","TIULA",115,0)
 S TIUPRMT=" Start "_$S($L($G(PRMPT)):PRMPT_" ",1:"")_"Date [Time]: "
"RTN","TIULA",116,0)
 S TIUDFLT=$S($L($G(DFLT)):DFLT,1:"T-30")
"RTN","TIULA",117,0)
 S Y=$$READ^TIUU("DOA^::AET",TIUPRMT,TIUDFLT)
"RTN","TIULA",118,0)
 Q Y
"RTN","TIULA",119,0)
LDATE(PRMPT,STATUS,DFLT) ; Get late date
"RTN","TIULA",120,0)
 N X,Y,TIUPRMT,TIUDFLT
"RTN","TIULA",121,0)
 I $G(STATUS)=4 S Y=9999999 Q Y
"RTN","TIULA",122,0)
 S TIUPRMT="Ending "_$S($L($G(PRMPT)):PRMPT_" ",1:"")_"Date [Time]: "
"RTN","TIULA",123,0)
 S TIUDFLT=$S($L($G(DFLT)):DFLT,1:"NOW")
"RTN","TIULA",124,0)
 S Y=$$READ^TIUU("DOA^::AET",TIUPRMT,TIUDFLT)
"RTN","TIULA",125,0)
 Q Y
"RTN","TIULA",126,0)
CATEGORY() ; Select Service Category
"RTN","TIULA",127,0)
 N DIR,X,Y
"RTN","TIULA",128,0)
 S DIR(0)="9000010,.07",DIR("A")="Select SERVICE CATEGORY"
"RTN","TIULA",129,0)
 D ^DIR
"RTN","TIULA",130,0)
 Q Y_U_Y(0)
"RTN","TIULA",131,0)
SELTYP(DA,RETURN,PARM,DFLT,TYPE,MODE,DCLASS,PICK) ; Select Document Types
"RTN","TIULA",132,0)
 N I,J,X,XQORM,CURTYP,Y
"RTN","TIULA",133,0)
 I '$D(RETURN) S RETURN=$NA(^TMP("TIUTYP",$J)) K @RETURN
"RTN","TIULA",134,0)
 ; TIUK is STATIC
"RTN","TIULA",135,0)
 ;I +MODE D DOCLIST^TIULA1(DA,.RETURN,PARM,DFLT) Q:+RETURN'<0
"RTN","TIULA",136,0)
 ; *** ADD CALL TO PERSONAL DOCUMENT LISTER HERE
"RTN","TIULA",137,0)
 N:'$D(TIUK) TIUK S TIUK=+$G(TIUK)
"RTN","TIULA",138,0)
 I $G(DFLT)="LAST" D
"RTN","TIULA",139,0)
 . S DFLT=$O(^DISV(DUZ,"XQORM",DA_";TIU(8925.1,",0))
"RTN","TIULA",140,0)
 . S DFLT=$S(+DFLT:$G(^DISV(DUZ,"XQORM",DA_";TIU(8925.1,",DFLT)),1:"")
"RTN","TIULA",141,0)
 I $G(TYPE)']"" S TYPE="DOC"
"RTN","TIULA",142,0)
 I $G(MODE)']"" S MODE=1 ; Default is ASK
"RTN","TIULA",143,0)
 S XQORM=DA_";TIU(8925.1,",XQORM(0)=$S(+$P($G(^TIU(8925.1,+DA,10,0)),U,3)=1:"F",1:$G(PARM,"AD"))
"RTN","TIULA",144,0)
 I XQORM(0)["D" S XQORM("H")="W !!,$$CENTER^TIULS(""--- ""_$P(^TIU(8925.1,+DA,0),U,3)_"" ---""),!"
"RTN","TIULA",145,0)
 I $S(XQORM(0)="F":1,XQORM(0)="R":1,1:0) S X=$S(DFLT]"":DFLT,1:"ALL")
"RTN","TIULA",146,0)
 S:$G(DFLT)]"" XQORM("B")=DFLT
"RTN","TIULA",147,0)
 S XQORM("A")="Select "_$S(XQORM(0)["D":"Document",1:$P(^TIU(8925.1,+DA,0),U,3))_$S($P(^TIU(8925.1,+DA,0),U,4)="DOC":" Component",1:" Type")_$S(+XQORM(0)'=1:"(s)",1:"")_": "
"RTN","TIULA",148,0)
 ; If screening inactive titles proves to be correct, remove comment
"RTN","TIULA",149,0)
 ; from the line below:
"RTN","TIULA",150,0)
 ; S XQORM("S")="I +$$CANPICK^TIULP(+$G(^TIU(8925.1,+DA(1),10,+DA,0)))>0"
"RTN","TIULA",151,0)
 D EN^XQORM
"RTN","TIULA",152,0)
 I +Y'>0,($D(@RETURN)'>9) S @RETURN=Y Q
"RTN","TIULA",153,0)
 I (PARM["A"),(+$G(@RETURN)'>0) M PICK=Y
"RTN","TIULA",154,0)
 S I=0 F  S I=$O(Y(I)) Q:+I'>0  D
"RTN","TIULA",155,0)
 . N TYPMATCH
"RTN","TIULA",156,0)
 . S J=+$P(Y(I),U,2),CURTYP=$P($G(^TIU(8925.1,+J,0)),U,4)
"RTN","TIULA",157,0)
 . I CURTYP="DC" S DCLASS=+$G(DCLASS)+1,DCLASS(DCLASS)=J
"RTN","TIULA",158,0)
 . I  I TYPE="DOC",(PARM["A"),(+$O(^TIU(8925.1,+J,10,0))'>0) W !!,"The Document Class ",$P(^TIU(8925.1,+J,0),U)," has no active titles at present..."
"RTN","TIULA",159,0)
 . S TYPMATCH=$$TYPMATCH^TIULA1(TYPE,CURTYP)
"RTN","TIULA",160,0)
 . I +TYPMATCH>0 D
"RTN","TIULA",161,0)
 . . S TIUK=+$G(TIUK)+1,@RETURN@(TIUK)=Y(I),@RETURN=TIUK
"RTN","TIULA",162,0)
 . I $S('+$G(TYPMATCH):1,CURTYP="CL":1,1:0),+$O(^TIU(8925.1,+J,10,0))>0 D SELTYP(+J,.RETURN,$S(MODE=1:$G(PARM),1:"F"),$S(MODE=1:"LAST",1:"ALL"),TYPE,MODE,.DCLASS,.PICK)
"RTN","TIULA",163,0)
 Q
"RTN","TIULA1")
0^5^B21656000
"RTN","TIULA1",1,0)
TIULA1 ; SLC/JER - More interactive functions ;4/18/03
"RTN","TIULA1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**75,113**;Jun 20, 1997
"RTN","TIULA1",3,0)
TRAVERSE(DA,RETURN,PARM,TYPE) ; Select Document Type(s)
"RTN","TIULA1",4,0)
 N C,I,XQORM,Y N:'$D(LEVEL) LEVEL S LEVEL=+$G(LEVEL)+1
"RTN","TIULA1",5,0)
 S:$G(TYPE)']"" TYPE="D"
"RTN","TIULA1",6,0)
 S XQORM=DA_";TIU(8925.1,",XQORM(0)=$S($L($G(PARM)):PARM,1:"AD")
"RTN","TIULA1",7,0)
 I XQORM(0)["D" S XQORM("H")="W !!,$$CENTER^TIULS(""--- ""_$P(^TIU(8925.1,+DA,0),U,3)_"" ---""),!"
"RTN","TIULA1",8,0)
 S XQORM("B")=$G(^DISV(DUZ,"XQORM",DA_";TIU(8925.1,",1))
"RTN","TIULA1",9,0)
 S XQORM("A")="Select "_$S(XQORM(0)["D":"Document",1:$P(^TIU(8925.1,+DA,0),U,3))_$S("CD"[$P(^TIU(8925.1,+DA,0),U,4):" Component",1:" Type")_$S(+XQORM(0)'=1:"(s)",1:"")_": "
"RTN","TIULA1",10,0)
 D EN^XQORM
"RTN","TIULA1",11,0)
 M RETURN(LEVEL)=Y
"RTN","TIULA1",12,0)
 S I=0 F  S I=$O(Y(I)) Q:+I'>0  D
"RTN","TIULA1",13,0)
 . S J=+$P(Y(I),U,2)
"RTN","TIULA1",14,0)
 . I $P(^TIU(8925.1,+J,0),U,4)'=TYPE,$D(^TIU(8925.1,+J,10))'<10 D TRAVERSE(+J,.RETURN,$G(PARM))
"RTN","TIULA1",15,0)
 Q
"RTN","TIULA1",16,0)
ASKSIG() ; Prompt for ES, return encrypted data
"RTN","TIULA1",17,0)
 N ESNAME,ESTITLE,Y S Y=0
"RTN","TIULA1",18,0)
 D SIG^XUSESIG I X1']"" S:'$D(X) X=0 D BADSIG^TIULG(X) G ASKX
"RTN","TIULA1",19,0)
 S ESNAME=$P($G(^VA(200,DUZ,20)),U,2),ESTITLE=$P($G(^(20)),U,3)
"RTN","TIULA1",20,0)
 S Y=1_U_ESNAME_U_ESTITLE
"RTN","TIULA1",21,0)
ASKX Q Y
"RTN","TIULA1",22,0)
ASKSUBJ() ; Handle query by subject
"RTN","TIULA1",23,0)
 N Y
"RTN","TIULA1",24,0)
 S Y=$$READ^TIUU("FO","Where SUBJECT CONTAINS")
"RTN","TIULA1",25,0)
 Q $$UPPER^TIULS(Y)
"RTN","TIULA1",26,0)
ASKLOC() ; Handle query by location
"RTN","TIULA1",27,0)
 N Y
"RTN","TIULA1",28,0)
 S Y=$$READ^TIUU("P^44:AEMQ","Select HOSPITAL LOCATION")
"RTN","TIULA1",29,0)
 Q Y
"RTN","TIULA1",30,0)
TYPMATCH(TYPE,CURTYP) ; Check for type match
"RTN","TIULA1",31,0)
 N TIUI,TIUY S TIUY=0
"RTN","TIULA1",32,0)
 I $L(TYPE,"!")=1,TYPE=CURTYP S TIUY=1
"RTN","TIULA1",33,0)
 E  F TIUI=1:1:$L(TYPE,"!") I $P(TYPE,"!",TIUI)=CURTYP S TIUY=1 Q
"RTN","TIULA1",34,0)
 Q TIUY
"RTN","TIULA1",35,0)
DOCLIST(CLASS,Y,PARM,DFLT) ; Get preferred documents for user
"RTN","TIULA1",36,0)
 N TIUDA,XQORM,X
"RTN","TIULA1",37,0)
 S TIUDA=+$O(^TIU(8925.98,"AC",DUZ,CLASS,0)),XQORM=TIUDA_";TIU(8925.98,"
"RTN","TIULA1",38,0)
 I +TIUDA'>0!(+$O(^XUTL("XQORM",XQORM,0))'>0) S Y=-1 Q
"RTN","TIULA1",39,0)
 I $G(DFLT)="LAST" D
"RTN","TIULA1",40,0)
 . S DFLT=$O(^DISV(DUZ,"XQORM",XQORM,0))
"RTN","TIULA1",41,0)
 . S DFLT=$S(+DFLT:$G(^DISV(DUZ,"XQORM",XQORM,DFLT)),1:"")
"RTN","TIULA1",42,0)
 S XQORM(0)=$S(+$P($G(^TIU(8925.98,+TIUDA,10,0)),U,3)=1:"F",1:PARM)
"RTN","TIULA1",43,0)
 S XQORM("B")=$S(+$P($G(^TIU(8925.98,+TIUDA,10,0)),U,3)=1:$P($G(^(0)),U,3),1:DFLT)
"RTN","TIULA1",44,0)
 I XQORM(0)'["A" S X=XQORM("B")
"RTN","TIULA1",45,0)
 S XQORM("A")=$S(CLASS=3:"",1:"Select ")_$S(CLASS=3:"TITLE",1:"Document")_$S(+XQORM(0)'=1:"(s)",1:"")_": "
"RTN","TIULA1",46,0)
 I XQORM(0)["D" D
"RTN","TIULA1",47,0)
 . N LISTNAME,PERSNAME S LISTNAME=$$PNAME^TIULC1(CLASS)
"RTN","TIULA1",48,0)
 . I $E(LISTNAME,$L(LISTNAME))="Y" D
"RTN","TIULA1",49,0)
 . . S LISTNAME=$E(LISTNAME,1,($L(LISTNAME)-1))_"IES"
"RTN","TIULA1",50,0)
 . I $E(LISTNAME,$L(LISTNAME))="y" D
"RTN","TIULA1",51,0)
 . . S LISTNAME=$E(LISTNAME,1,($L(LISTNAME)-1))_"ies"
"RTN","TIULA1",52,0)
 . S PERSNAME=$$PERSNAME^TIULC1(DUZ)
"RTN","TIULA1",53,0)
 . S LISTNAME=""""_"--- "_LISTNAME_" for "_PERSNAME_" ---"_""""
"RTN","TIULA1",54,0)
 . S XQORM("H")="W !!,$$CENTER^TIULS("_LISTNAME_"),!"
"RTN","TIULA1",55,0)
 S XQORM("S")="I $$CANPICK^TIULP(+$G(^TIU(8925.98,+DA(1),10,+DA,0)))"
"RTN","TIULA1",56,0)
 D EN^XQORM
"RTN","TIULA1",57,0)
 Q
"RTN","TIULA1",58,0)
SELCAT(Y,PARM,DFLT) ; Get preferred documents for user
"RTN","TIULA1",59,0)
 N TIUI,TIUDA,CATREC,CATLOOK,CATSCRN,CATVAL,XQORM,X ;P75 newed CATVAL
"RTN","TIULA1",60,0)
 S TIUI=0
"RTN","TIULA1",61,0)
 S XQORM="1;TIU(8925.8,"
"RTN","TIULA1",62,0)
 I $G(DFLT)="LAST" D
"RTN","TIULA1",63,0)
 . S DFLT=$O(^DISV(DUZ,"XQORM",XQORM,0))
"RTN","TIULA1",64,0)
 . S DFLT=$S(+DFLT:$G(^DISV(DUZ,"XQORM",XQORM,DFLT)),1:"")
"RTN","TIULA1",65,0)
 S XQORM(0)=$G(PARM,"1A")
"RTN","TIULA1",66,0)
 S XQORM("B")=$G(DFLT,"AUTHOR")
"RTN","TIULA1",67,0)
 I +$G(ORVP) S XQORM("S")="I $G(^XUTL(""XQORM"",XQORM,+$O(^XUTL(""XQORM"",XQORM,""B"",DA,0)),0))'[""Patient"""
"RTN","TIULA1",68,0)
 I XQORM(0)'["A" S X=XQORM("B")
"RTN","TIULA1",69,0)
 S XQORM("A")="Select SEARCH CATEGOR"_$S(+XQORM(0)'=1:"IES",1:"Y")_": "
"RTN","TIULA1",70,0)
 I XQORM(0)["D" S XQORM("H")="W !!,$$CENTER^TIULS(""--- Search Categories ---""),!"
"RTN","TIULA1",71,0)
 D EN^XQORM
"RTN","TIULA1",72,0)
 F  S TIUI=$O(Y(TIUI)) Q:+TIUI'>0  D
"RTN","TIULA1",73,0)
 . S TIUDA=+$P(Y(TIUI),U,2)
"RTN","TIULA1",74,0)
 . S CATREC=$G(^TIU(8925.8,TIUDA,0))
"RTN","TIULA1",75,0)
 . S CATSCRN=$G(^TIU(8925.8,TIUDA,1))
"RTN","TIULA1",76,0)
 . S CATLOOK=$G(^TIU(8925.8,TIUDA,2))
"RTN","TIULA1",77,0)
 . S CATVAL=-1 ;P75
"RTN","TIULA1",78,0)
 . I CATLOOK']"",+$P(CATREC,U,4) S CATVAL=$$DICLOOK(CATREC,CATSCRN)
"RTN","TIULA1",79,0)
 . I CATLOOK]"" S CATVAL=$$LOOK(CATLOOK)
"RTN","TIULA1",80,0)
 . I +CATVAL'=-1,$L(CATVAL) S Y(TIUI)=$P(CATREC,U,2)_U_CATVAL
"RTN","TIULA1",81,0)
 . E  K Y(TIUI) S Y=+$G(Y)-1
"RTN","TIULA1",82,0)
 Q
"RTN","TIULA1",83,0)
DICLOOK(CATEGORY,SCREEN) ; Call ^DIC to get category value
"RTN","TIULA1",84,0)
 N DIC,X,Y
"RTN","TIULA1",85,0)
 S DIC=+$P(CATEGORY,U,4),DIC(0)="AEMQZ"
"RTN","TIULA1",86,0)
 S DIC("A")="Select "_$P(CATEGORY,U)_": "
"RTN","TIULA1",87,0)
 I SCREEN]"" X SCREEN
"RTN","TIULA1",88,0)
 D ^DIC I +$G(DUOUT),(X="^^") S DIROUT=1
"RTN","TIULA1",89,0)
 Q Y
"RTN","TIULA1",90,0)
LOOK(LOOKUP) ; Execute LOOKUP CODE
"RTN","TIULA1",91,0)
 N X,Y
"RTN","TIULA1",92,0)
 X LOOKUP
"RTN","TIULA1",93,0)
 Q Y
"RTN","TIULA1",94,0)
GETVSIT(DFN) ; Visit selection code
"RTN","TIULA1",95,0)
 N X,Y
"RTN","TIULA1",96,0)
 I +$G(ORVP),'+$G(DFN) S DFN=+$G(ORVP)
"RTN","TIULA1",97,0)
 D MAIN^TIUVISIT(.Y,$G(DFN))
"RTN","TIULA1",98,0)
 S Y=$G(Y("VISIT"))
"RTN","TIULA1",99,0)
 I +Y,+$P(Y,U,2) S $P(Y,U,2)=$$DATE^TIULS($P(Y,U,2),"MM/DD/YY HR:MIN")
"RTN","TIULA1",100,0)
 Q Y
"RTN","TIULA1",101,0)
GETTERM(X) ; Get Lexicon term
"RTN","TIULA1",102,0)
 N DIC,USEX,Y
"RTN","TIULA1",103,0)
 S DIC=757.01,DIC(0)="AEMQZ",DIC("A")="Select PROBLEM: "
"RTN","TIULA1",104,0)
 D ^DIC
"RTN","TIULA1",105,0)
 I +Y'>0,(X]""),(X'=" "),(X'["^") D
"RTN","TIULA1",106,0)
 . S USEX=$$READ^TIUU("Y",">>>  Use "_X,"Yes")
"RTN","TIULA1",107,0)
 . I +USEX S Y=1_U_X
"RTN","TIULA1",108,0)
 Q Y
"RTN","TIULA1",109,0)
GETDIV() ; Get Institution Number and Name
"RTN","TIULA1",110,0)
 N TIUDIV,TIUSTN,Y
"RTN","TIULA1",111,0)
 S TIUDIV=$S($P($G(^DG(43,1,"GL")),U,2):$$MULTDIV,1:$$PRIM^VASITE)
"RTN","TIULA1",112,0)
 S TIUSTN=$$SITE^VASITE(,TIUDIV)
"RTN","TIULA1",113,0)
 I $P(TIUSTN,U)>0,($P(TIUSTN,U,2)]"") D
"RTN","TIULA1",114,0)
 . S Y=$P(TIUSTN,U)_U_$P(TIUSTN,U,2)
"RTN","TIULA1",115,0)
 E  D
"RTN","TIULA1",116,0)
 . S Y=-1
"RTN","TIULA1",117,0)
 Q Y
"RTN","TIULA1",118,0)
MULTDIV() ; User selects from active divisions
"RTN","TIULA1",119,0)
 N DIR,X,Y
"RTN","TIULA1",120,0)
 S DIR(0)="PA^40.8:EM"
"RTN","TIULA1",121,0)
 S DIR("A")="Select DIVISION: "
"RTN","TIULA1",122,0)
 S DIR("S")="I $$SITE^VASITE(,+Y)>0"
"RTN","TIULA1",123,0)
 D ^DIR
"RTN","TIULA1",124,0)
 Q +Y
"RTN","TIULC1")
0^6^B48292992
"RTN","TIULC1",1,0)
TIULC1 ; SLC/JER - More computational functions ;10/29/03
"RTN","TIULC1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,4,40,49,100,131,113**;Jun 20, 1997
"RTN","TIULC1",3,0)
 ; External References
"RTN","TIULC1",4,0)
 ;   DBIA 2324  $$ISA^USRLM
"RTN","TIULC1",5,0)
 ;
"RTN","TIULC1",6,0)
 ;                   **** WARNING ****
"RTN","TIULC1",7,0)
 ;
"RTN","TIULC1",8,0)
 ;  Any patch which makes ANY changes to this rtn must include a
"RTN","TIULC1",9,0)
 ;note in the patch desc reminding sites to update the Imaging
"RTN","TIULC1",10,0)
 ;Gateway.  See IA # 3622.
"RTN","TIULC1",11,0)
 ;  IN ADDITION, if changes are made to components used by Imaging,
"RTN","TIULC1",12,0)
        ;namely PNAME, backward compatibility may not be enough. If
"RTN","TIULC1",13,0)
 ;changes call additional rtns, TIU should consult with Imaging
"RTN","TIULC1",14,0)
 ;on need to add additional rtns to list of TIU rtns copied for
"RTN","TIULC1",15,0)
 ;Imaging Gateway.
"RTN","TIULC1",16,0)
 ;                         ****
"RTN","TIULC1",17,0)
 ;
"RTN","TIULC1",18,0)
ENCRYPT(X,X1,X2) ; Encrypt Text Strings
"RTN","TIULC1",19,0)
 D EN^XUSHSHP
"RTN","TIULC1",20,0)
 Q X
"RTN","TIULC1",21,0)
DECRYPT(X,X1,X2) ; Decrypt Text Strings
"RTN","TIULC1",22,0)
 D DE^XUSHSHP
"RTN","TIULC1",23,0)
 Q X
"RTN","TIULC1",24,0)
WHOSIGNS(DA) ; Evaluate who should be the expected signer
"RTN","TIULC1",25,0)
 N Y,TIU12
"RTN","TIULC1",26,0)
 S TIU12=$G(^TIU(8925,+DA,12))
"RTN","TIULC1",27,0)
 I $P(TIU12,U,2)'=$P(TIU12,U,9) S Y=$P(TIU12,U,2)
"RTN","TIULC1",28,0)
 E  S Y=$P(TIU12,U,9)
"RTN","TIULC1",29,0)
 Q Y
"RTN","TIULC1",30,0)
WHOCOSIG(DA) ; Evaluate who should be the expected cosigner
"RTN","TIULC1",31,0)
 N Y,TIU12
"RTN","TIULC1",32,0)
 S TIU12=$G(^TIU(8925,+DA,12))
"RTN","TIULC1",33,0)
 I $P(TIU12,U,2)=$P(TIU12,U,9) D
"RTN","TIULC1",34,0)
 . I $P(TIU12,U,8)]"" S Y="@"
"RTN","TIULC1",35,0)
 . E  S Y=""
"RTN","TIULC1",36,0)
 E  S Y=$P(TIU12,U,9)
"RTN","TIULC1",37,0)
 Q Y
"RTN","TIULC1",38,0)
 ;
"RTN","TIULC1",39,0)
HASADDEN(DA,IDKIDFLG) ; Evaluate whether a given record has addenda
"RTN","TIULC1",40,0)
 ; **100**:
"RTN","TIULC1",41,0)
 ; If +IDKIDFLG, check interdisciplinary kids of DA, as well as DA.
"RTN","TIULC1",42,0)
 N TIUI,TIUY,TIUJ,TIUK
"RTN","TIULC1",43,0)
 S (TIUI,TIUJ,TIUY)=0
"RTN","TIULC1",44,0)
 F  S TIUI=$O(^TIU(8925,"DAD",+DA,TIUI)) Q:+TIUI'>0  D  Q:TIUY
"RTN","TIULC1",45,0)
 . I $P($G(^TIU(8925.1,+$G(^TIU(8925,+TIUI,0)),0)),U)["ADDENDUM" S TIUY=1
"RTN","TIULC1",46,0)
 I TIUY!'$G(IDKIDFLG) G HASX
"RTN","TIULC1",47,0)
 ;**100** Check ID kids for addenda:
"RTN","TIULC1",48,0)
 F  S TIUJ=$O(^TIU(8925,"GDAD",+DA,TIUJ)) Q:+TIUJ'>0  D  Q:TIUY
"RTN","TIULC1",49,0)
 . S TIUK=0
"RTN","TIULC1",50,0)
 . F  S TIUK=$O(^TIU(8925,"DAD",TIUJ,TIUK)) Q:+TIUK'>0  D  Q:TIUY
"RTN","TIULC1",51,0)
 . . I $P($G(^TIU(8925.1,+$G(^TIU(8925,+TIUK,0)),0)),U)["ADDENDUM" S TIUY=1
"RTN","TIULC1",52,0)
HASX Q TIUY
"RTN","TIULC1",53,0)
 ;
"RTN","TIULC1",54,0)
ISADDNDM(DA) ; Evaluate whether a given record IS an addendum
"RTN","TIULC1",55,0)
 N TIUY S TIUY=0
"RTN","TIULC1",56,0)
 I $P($G(^TIU(8925.1,+$G(^TIU(8925,+DA,0)),0)),U)["ADDENDUM",+$P($G(^TIU(8925,+DA,0)),U,6)>0 S TIUY=1
"RTN","TIULC1",57,0)
 Q TIUY
"RTN","TIULC1",58,0)
PNAME(DA) ; Receives pointer to 8925.1, returns display name of
"RTN","TIULC1",59,0)
 ; document class
"RTN","TIULC1",60,0)
 N TIUY,TIUMOM S TIUMOM=0
"RTN","TIULC1",61,0)
 I +$G(DA)'>0 Q "UNKNOWN"
"RTN","TIULC1",62,0)
 S TIUMOM=$O(^TIU(8925.1,"AD",DA,TIUMOM))
"RTN","TIULC1",63,0)
 I $P($G(^TIU(8925.1,+DA,0)),U,4)="CO" S TIUMOM=0
"RTN","TIULC1",64,0)
 I +$P($G(^TIU(8925.1,+DA,0)),U,9)=0 S TIUMOM=0
"RTN","TIULC1",65,0)
 I +TIUMOM>0  D
"RTN","TIULC1",66,0)
 . S TIUY=$P($G(^TIU(8925.1,+TIUMOM,0)),U,3)
"RTN","TIULC1",67,0)
 . I TIUY']"" S TIUY=$$MIXED^TIULS($P($G(^TIU(8925.1,+TIUMOM,0)),U))
"RTN","TIULC1",68,0)
 I +TIUMOM'>0 D
"RTN","TIULC1",69,0)
 . S TIUY=$P($G(^TIU(8925.1,+DA,0)),U,3)
"RTN","TIULC1",70,0)
 . I TIUY']"" S TIUY=$$MIXED^TIULS($P($G(^TIU(8925.1,+DA,0)),U))
"RTN","TIULC1",71,0)
 Q TIUY
"RTN","TIULC1",72,0)
ABBREV(DA) ; Get abbreviaton for a document type or class
"RTN","TIULC1",73,0)
 Q $P($G(^TIU(8925.1,+DA,0)),U,2)
"RTN","TIULC1",74,0)
PERSNAME(USER) ; Receives pointer to 200, returns name field
"RTN","TIULC1",75,0)
 N X S X=$$GET1^DIQ(200,USER,.01)
"RTN","TIULC1",76,0)
 Q $S($L(X):X,1:"UNKNOWN")
"RTN","TIULC1",77,0)
BEEP(USER) ; Get beeper #'s 
"RTN","TIULC1",78,0)
 Q $P($G(^VA(200,+USER,.13)),U,7,8)
"RTN","TIULC1",79,0)
DOCPRM(TIUTYP,TIUDPRM,TIUDA) ; Get Document Parameters, support inheritance
"RTN","TIULC1",80,0)
 N TIUI,TIUDAD
"RTN","TIULC1",81,0)
 S (TIUDPRM(0),TIUDPRM(5))=""
"RTN","TIULC1",82,0)
 I $P($G(^TIU(8925.1,+TIUTYP,0)),U)["ADDENDUM",+$G(TIUDA) S TIUTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIULC1",83,0)
 S TIUI=+$O(^TIU(8925.95,"B",+TIUTYP,0))
"RTN","TIULC1",84,0)
 I +TIUI D  Q
"RTN","TIULC1",85,0)
 . S TIUDPRM(0)=$G(^TIU(8925.95,+TIUI,0))
"RTN","TIULC1",86,0)
 . I +$O(^TIU(8925.95,+TIUI,5,0)) D
"RTN","TIULC1",87,0)
 . . N TIUJ S TIUJ=0
"RTN","TIULC1",88,0)
 . . F  S TIUJ=$O(^TIU(8925.95,+TIUI,5,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIULC1",89,0)
 . . . S $P(TIUDPRM(5),U,TIUJ)=+$G(^TIU(8925.95,+TIUI,5,+TIUJ,0))
"RTN","TIULC1",90,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",91,0)
 I +TIUDAD D DOCPRM(TIUDAD,.TIUDPRM)
"RTN","TIULC1",92,0)
 Q
"RTN","TIULC1",93,0)
POSTFILE(TIUTYP) ; Get Post-filing Code, support inheritance
"RTN","TIULC1",94,0)
 N TIUPOST,TIUDAD
"RTN","TIULC1",95,0)
 S TIUPOST=$G(^TIU(8925.1,+TIUTYP,4.5))
"RTN","TIULC1",96,0)
 I TIUPOST]"" G POSTFILX
"RTN","TIULC1",97,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",98,0)
 I +TIUDAD S TIUPOST=$$POSTFILE(TIUDAD)
"RTN","TIULC1",99,0)
POSTFILX Q TIUPOST
"RTN","TIULC1",100,0)
FIXCODE(TIUTYP) ; Get Error Resolution Code, support inheritance
"RTN","TIULC1",101,0)
 N TIUFIX,TIUDAD
"RTN","TIULC1",102,0)
 S TIUFIX=$G(^TIU(8925.1,+TIUTYP,4.8))
"RTN","TIULC1",103,0)
 I TIUFIX]"" G FIXCODX
"RTN","TIULC1",104,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",105,0)
 ; Don't inherit PN code for consults: TIU*1*131
"RTN","TIULC1",106,0)
 I +TIUTYP=$$CLASS^TIUCNSLT,TIUDAD=3 G FIXCODX
"RTN","TIULC1",107,0)
 I +TIUDAD S TIUFIX=$$FIXCODE(TIUDAD)
"RTN","TIULC1",108,0)
FIXCODX Q TIUFIX
"RTN","TIULC1",109,0)
DOCCLASS(TIUTYP) ; Given a document type, find its parent document class
"RTN","TIULC1",110,0)
 Q +$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",111,0)
CLINDOC(TIUTYP,TIUDA) ; Given a document type, find the Clinical Document
"RTN","TIULC1",112,0)
 ;                 subclass to which it belongs
"RTN","TIULC1",113,0)
 N TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIULC1",114,0)
 I +$G(TIUDA),+$$ISADDNDM(TIUDA) S TIUTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIULC1",115,0)
 S TIUI=$O(^TIU(8925.1,"AD",+TIUTYP,TIUI))
"RTN","TIULC1",116,0)
 I +TIUI'>0 G CLINDOX
"RTN","TIULC1",117,0)
 I TIUI=38 S TIUY=TIUTYP
"RTN","TIULC1",118,0)
 I TIUI'=38 S TIUY=$$CLINDOC(TIUI)
"RTN","TIULC1",119,0)
CLINDOX Q TIUY
"RTN","TIULC1",120,0)
REQVER(TIUTYP,TIUDA) ; Does a given document type require verification
"RTN","TIULC1",121,0)
 N TIUDPRM,TIUY
"RTN","TIULC1",122,0)
 I +$G(TIUDA),+$$ISADDNDM(TIUDA) S TIUTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIULC1",123,0)
 D DOCPRM(TIUTYP,.TIUDPRM)
"RTN","TIULC1",124,0)
 I +$P($G(TIUDPRM(0)),U,3) S TIUY=1
"RTN","TIULC1",125,0)
 Q +$G(TIUY)
"RTN","TIULC1",126,0)
REFDATE(TIU,TIUDICDT) ; Identify Reference date
"RTN","TIULC1",127,0)
 N TIURDT
"RTN","TIULC1",128,0)
 I +$G(TIU("LDT")) S TIURDT=+$G(TIU("LDT"))_"^0"
"RTN","TIULC1",129,0)
 I +$G(TIU("LDT"))'>0 D
"RTN","TIULC1",130,0)
 . S TIURDT=$S(+$G(TIUDICDT):+$G(TIUDICDT),1:+$$NOW^TIULC)_"^1"
"RTN","TIULC1",131,0)
 . S TIU("LDT")=TIURDT_U_$$DATE^TIULS(TIURDT,"AMTH DD, CCYY@HR:MIN:SEC")
"RTN","TIULC1",132,0)
 Q TIURDT
"RTN","TIULC1",133,0)
WHATMPL(USER) ; What List Template should a given user get?
"RTN","TIULC1",134,0)
 N TIUY
"RTN","TIULC1",135,0)
 I +$$ISA^USRLM(USER,"PROVIDER") S TIUY="TIU BROWSE FOR CLINICIAN" G WHAX
"RTN","TIULC1",136,0)
 I +$$ISA^USRLM(USER,"MEDICAL RECORDS TECHNICIAN") S TIUY="TIU BROWSE FOR MRT" G WHAX
"RTN","TIULC1",137,0)
 I +$$ISA^USRLM(USER,"CHIEF, MIS") S TIUY="TIU BROWSE FOR MGR" G WHAX
"RTN","TIULC1",138,0)
 I +$$ISA^USRLM(USER,"MEDICAL STUDENT") S TIUY="TIU BROWSE FOR CLINICIAN" G WHAX
"RTN","TIULC1",139,0)
 S TIUY="TIU BROWSE FOR READ ONLY"
"RTN","TIULC1",140,0)
WHAX Q TIUY
"RTN","TIULC1",141,0)
SUPPVSIT(TIUTYP) ; Evaluate whether to suppress visit matching
"RTN","TIULC1",142,0)
 N TIUI,TIUY S TIUY=0
"RTN","TIULC1",143,0)
 I +$P($G(^TIU(8925.1,+TIUTYP,3)),U,3) S TIUY=1 G SUPPVSIX
"RTN","TIULC1",144,0)
 I $L($P($G(^TIU(8925.1,+TIUTYP,3)),U,3)),($P($G(^(3)),U,3)=0) S TIUY=0 G SUPPVSIX ; ** SLC/JER - NOIS NYC-1298-11472
"RTN","TIULC1",145,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925.1,"AD",+TIUTYP,TIUI)) Q:+TIUI'>0!(+TIUY>0)  D
"RTN","TIULC1",146,0)
 . S TIUY=+$$SUPPVSIT(+TIUI)
"RTN","TIULC1",147,0)
SUPPVSIX Q TIUY
"RTN","TIULC1",148,0)
PTNAME(DFN) ; Resolve Patient Name
"RTN","TIULC1",149,0)
 N TIUY S TIUY=$P($G(^DPT(DFN,0)),U)
"RTN","TIULC1",150,0)
 S:TIUY']"" TIUY="NAME UNKNOWN"
"RTN","TIULC1",151,0)
 Q TIUY
"RTN","TIULC1",152,0)
POSTSIGN(TIUTYP) ; Get Post-Signature Code, support inheritance
"RTN","TIULC1",153,0)
 N TIUPOST,TIUDAD
"RTN","TIULC1",154,0)
 S TIUPOST=$G(^TIU(8925.1,+TIUTYP,4.9))
"RTN","TIULC1",155,0)
 I TIUPOST]"" G POSTSIGX
"RTN","TIULC1",156,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",157,0)
 I +TIUDAD S TIUPOST=$$POSTSIGN(TIUDAD)
"RTN","TIULC1",158,0)
POSTSIGX Q TIUPOST
"RTN","TIULC1",159,0)
COMMIT(TIUTYP) ; Get Commitment action, support inheritance
"RTN","TIULC1",160,0)
 N TIUCOMM,TIUDAD
"RTN","TIULC1",161,0)
 S TIUCOMM=$G(^TIU(8925.1,+TIUTYP,4.1))
"RTN","TIULC1",162,0)
 I TIUCOMM]"" G COMMITX
"RTN","TIULC1",163,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",164,0)
 I +TIUDAD S TIUCOMM=$$COMMIT(TIUDAD)
"RTN","TIULC1",165,0)
COMMITX Q TIUCOMM
"RTN","TIULC1",166,0)
RELEASE(TIUTYP) ; Get Release Action, support inheritance
"RTN","TIULC1",167,0)
 N TIUREL,TIUDAD
"RTN","TIULC1",168,0)
 S TIUREL=$G(^TIU(8925.1,+TIUTYP,4.2))
"RTN","TIULC1",169,0)
 I TIUREL]"" G RELEASX
"RTN","TIULC1",170,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",171,0)
 I +TIUDAD S TIUREL=$$RELEASE(TIUDAD)
"RTN","TIULC1",172,0)
RELEASX Q TIUREL
"RTN","TIULC1",173,0)
VERIFY(TIUTYP) ; Get Verification action, support inheritance
"RTN","TIULC1",174,0)
 N TIUVER,TIUDAD
"RTN","TIULC1",175,0)
 S TIUVER=$G(^TIU(8925.1,+TIUTYP,4.3))
"RTN","TIULC1",176,0)
 I TIUVER]"" G VERIFYX
"RTN","TIULC1",177,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",178,0)
 I +TIUDAD S TIUVER=$$VERIFY(TIUDAD)
"RTN","TIULC1",179,0)
VERIFYX Q TIUVER
"RTN","TIULC1",180,0)
DELETE(TIUTYP) ; Get Delete Action, support inheritance
"RTN","TIULC1",181,0)
 N TIUDEL,TIUDAD
"RTN","TIULC1",182,0)
 S TIUDEL=$G(^TIU(8925.1,+TIUTYP,4.4))
"RTN","TIULC1",183,0)
 I TIUDEL]"" G DELETEX
"RTN","TIULC1",184,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",185,0)
 I +TIUDAD S TIUDEL=$$DELETE(TIUDAD)
"RTN","TIULC1",186,0)
DELETEX Q TIUDEL
"RTN","TIULC1",187,0)
REASSIGN(TIUTYP) ; Get Package Reassign Action, support inheritance
"RTN","TIULC1",188,0)
 N TIUREASS,TIUDAD
"RTN","TIULC1",189,0)
 S TIUREASS=$G(^TIU(8925.1,+TIUTYP,4.45))
"RTN","TIULC1",190,0)
 I TIUREASS]"" G REASSIX
"RTN","TIULC1",191,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",192,0)
 I +TIUDAD S TIUREASS=$$REASSIGN(TIUDAD)
"RTN","TIULC1",193,0)
REASSIX Q TIUREASS
"RTN","TIULC1",194,0)
DIVISION(TIULOC) ; Get Division
"RTN","TIULC1",195,0)
 ; Input  -- TIULOC  HOSPITAL LOCATION file (#44) IEN
"RTN","TIULC1",196,0)
 ; Output -- TIUIN   INSTITUTION file (#4) IEN^
"RTN","TIULC1",197,0)
 ;                   INSTITUTION file (#4) NAME
"RTN","TIULC1",198,0)
 N TIUDVHL,TIUSTN,TIUIN
"RTN","TIULC1",199,0)
 S TIUDVHL=$P($G(^SC(+TIULOC,0)),U,15)
"RTN","TIULC1",200,0)
 I +TIUDVHL D
"RTN","TIULC1",201,0)
 . S TIUSTN=$$SITE^VASITE(,TIUDVHL)
"RTN","TIULC1",202,0)
 . I $P(TIUSTN,U)>0,($P(TIUSTN,U,2)]"") D
"RTN","TIULC1",203,0)
 . . S TIUIN=$P(TIUSTN,U)_U_$P(TIUSTN,U,2)
"RTN","TIULC1",204,0)
 I '$G(TIUIN) D
"RTN","TIULC1",205,0)
 . S TIUIN=+$G(DUZ(2))_U_$P($$NS^XUAF4(+$G(DUZ(2))),U)
"RTN","TIULC1",206,0)
 Q TIUIN
"RTN","TIULV")
0^7^B31297101
"RTN","TIULV",1,0)
TIULV ; SLC/JER - Visit/Movement related library ; 4/18/03
"RTN","TIULV",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,30,55,45,52,148,156,152,113**;Jun 20, 1997
"RTN","TIULV",3,0)
PATPN(TIUY,DFN) ; Get minimum demographics for PN Print
"RTN","TIULV",4,0)
 N VADM,VAIP,VAIN,VA,VAPA
"RTN","TIULV",5,0)
 D OERR^VADPT
"RTN","TIULV",6,0)
 S TIUY("PNMP")=$E($G(VADM(1)),1,30)
"RTN","TIULV",7,0)
 S TIUY("SSN")=$G(VA("PID"))
"RTN","TIULV",8,0)
 S TIUY("DOB")="DOB:"_$$DATE^TIULS(+$G(VADM(3)),"MM/DD/CCYY")
"RTN","TIULV",9,0)
 D ADD^VADPT
"RTN","TIULV",10,0)
 I $G(VAPA(8))'="" S TIUY("PH#")="Ph:"_VAPA(8)
"RTN","TIULV",11,0)
 I $G(VAPA(8))="" S TIUY("PH#")="Ph: **UNKNOWN**"
"RTN","TIULV",12,0)
 S TIUY("INTNM")=$$NAME^VASITE ;Integration Name
"RTN","TIULV",13,0)
 S TIUY("SITE")=$P($$SITE^VASITE,U,2)
"RTN","TIULV",14,0)
 S TIUY("LOCP")="Pt Loc: "_$S(VAIN(4)]"":$P(VAIN(4),U,2)_"  "_VAIN(5),1:"OUTPATIENT")
"RTN","TIULV",15,0)
 Q
"RTN","TIULV",16,0)
 ;
"RTN","TIULV",17,0)
PATVADPT(TIUY,DFN,TIUMVN,TIUVSTR,TIUSDC) ; Extract MAS data
"RTN","TIULV",18,0)
 N VA,VADM,VAEL,VAERR,VAIP,TIUI,TIUWARD,X,Y,TIUTYPE,TIUFTS,TIUSS,VAPA
"RTN","TIULV",19,0)
 D DEM^VADPT
"RTN","TIULV",20,0)
 S TIUY("PNM")=$G(VADM(1)),TIUY("SSN")=$G(VA("PID"))
"RTN","TIULV",21,0)
 S TIUY("AGE")=$G(VADM(4)),TIUY("PID")="("_$E(TIUY("PNM"))_VA("BID")_")"
"RTN","TIULV",22,0)
 S TIUY("DOB")=$G(VADM(3))
"RTN","TIULV",23,0)
 D ADD^VADPT
"RTN","TIULV",24,0)
 I $G(VAPA(8))'="" S TIUY("PH#")=VAPA(8)
"RTN","TIULV",25,0)
 I $G(VAPA(8))="" S TIUY("PH#")="**UNKNOWN**"
"RTN","TIULV",26,0)
 S TIUY("SEX")=$G(VADM(5))
"RTN","TIULV",27,0)
 ; Below TIU*148
"RTN","TIULV",28,0)
 I +$G(VADM(12))>0 D 
"RTN","TIULV",29,0)
 . F TIUY("NUMRACE")=1:1:VADM(12) S TIUY("RACE",TIUY("NUMRACE"))=$G(VADM(12,TIUY("NUMRACE")))
"RTN","TIULV",30,0)
 S TIUY("RACENO")=+$G(VADM(12))
"RTN","TIULV",31,0)
 I +$G(VADM(12))=0 S TIUY("RACE")=$G(VADM(8))
"RTN","TIULV",32,0)
 I +$G(TIUSDC) S TIUY("STOP")=$G(TIUSDC)
"RTN","TIULV",33,0)
 I +$G(TIUD13(0)) S TIUY("REFDT")=+$G(TIUD13(0))
"RTN","TIULV",34,0)
 I +$G(TIUMVN),$D(^DGPM(+TIUMVN)) D
"RTN","TIULV",35,0)
 . ; N VLOC,VDT,TIUDIV
"RTN","TIULV",36,0)
 . N VLOC,VDT,TIUDIV
"RTN","TIULV",37,0)
 . S VAIP("E")=TIUMVN D 52^VADPT
"RTN","TIULV",38,0)
 . S TIUI=$S(+$G(VAIP(17,1)):17,1:14)
"RTN","TIULV",39,0)
 . S TIUY("CLAIM")=$G(VAEL(7)),TIUY("PMD")=$G(VAIP(TIUI,5))
"RTN","TIULV",40,0)
 . S TIUY("AMD")=$G(VAIP(18)),TIUY("TS")=$G(VAIP(TIUI,6))
"RTN","TIULV",41,0)
 . S TIUY("SVC")=+$$GET1^DIQ(45.7,+TIUY("TS"),2,"I",,"ERROR")
"RTN","TIULV",42,0)
 . S TIUY("SVC")=TIUY("SVC")_U_$$GET1^DIQ(49,+TIUY("SVC"),.01,"I",,"ERROR")
"RTN","TIULV",43,0)
 . S TIUY("WARD")=$$WARD($G(VAIP(17)))
"RTN","TIULV",44,0)
 . S (TIUY("ADDT"),TIUY("EDT"))=$G(VAIP(3))
"RTN","TIULV",45,0)
 . I +TIUY("WARD") S TIUY("LOC")=$G(^DIC(42,+TIUY("WARD"),44))
"RTN","TIULV",46,0)
 . I +$G(TIUY("LOC")) D
"RTN","TIULV",47,0)
 . . S TIUY("LOC")=TIUY("LOC")_U_$P($G(^SC(+TIUY("LOC"),0)),U)
"RTN","TIULV",48,0)
 . S TIUY("ADDX")=$G(VAIP(9)),TIUY("LDT")=$G(VAIP(17,1))
"RTN","TIULV",49,0)
 . S TIUY("AD#")=+$G(VAIP(13)),TIUY("MTYPE")=$G(VAIP(TIUI,3))
"RTN","TIULV",50,0)
 . S TIUDIV=$P($G(^DIC(42,+TIUY("WARD"),0)),U,11)
"RTN","TIULV",51,0)
 . I +TIUDIV S TIUY("DIV")=TIUDIV_U_$P($G(^DG(40.8,+TIUDIV,0)),U)
"RTN","TIULV",52,0)
 . S VDT=+VAIP(3)
"RTN","TIULV",53,0)
 . S VLOC=$G(^DIC(42,+$P($G(VAIP(13,4)),U),44))
"RTN","TIULV",54,0)
 . S TIUY("VSTR")=VLOC_";"_+TIUY("EDT")_";H"
"RTN","TIULV",55,0)
 . S TIUY("VLOC")=VLOC_U_$P($G(^SC(VLOC,0)),U)
"RTN","TIULV",56,0)
 . S:'+$G(TIUY("LOC")) TIUY("LOC")=TIUY("VLOC")
"RTN","TIULV",57,0)
 I $G(TIUVSTR)]"" S TIUY("VSTR")=TIUVSTR D VSIT(.TIUY,TIUVSTR)
"RTN","TIULV",58,0)
 I '+$G(TIUMVN),'+$G(TIUVSTR) D CURRENT(.TIUY,DFN)
"RTN","TIULV",59,0)
 ; D CURRENT(.TIUY,DFN)
"RTN","TIULV",60,0)
 I +$$PROVIDER^TIUPXAP1($S($D(TIUAUTH):+$G(TIUAUTH),1:DUZ),+$G(TIUY("EDT"))) D
"RTN","TIULV",61,0)
 . S TIUY("SVC")=$$PROVSVC(+$S($D(TIUAUTH):+$G(TIUAUTH),1:DUZ))
"RTN","TIULV",62,0)
 I +$G(TIUY("VSTR")),(+$O(^TIU(8925,"AVSTRV",+DFN,$G(TIUY("VSTR")),0))>0) D
"RTN","TIULV",63,0)
 . N TIUVSIT S TIUVSIT=+$O(^TIU(8925,"AVSTRV",+DFN,$G(TIUY("VSTR")),0))
"RTN","TIULV",64,0)
 . I $P($G(^AUPNVSIT(+TIUVSIT,0)),U,5)'=DFN K ^TIU(8925,"AVSTRV",+DFN,$G(TIUY("VSTR")),TIUVSIT) Q
"RTN","TIULV",65,0)
 . S TIUY("VISIT")=+TIUVSIT_U_+$G(^AUPNVSIT(+TIUVSIT,0))
"RTN","TIULV",66,0)
 ; if pt an inpt + doc class is pn- default to current inpt loc
"RTN","TIULV",67,0)
 S TIUTYPE=$S(+$P($G(TIUTYP(1)),U,2)>0:$P($G(TIUTYP(1)),U,2),1:+$G(TIUTYP))
"RTN","TIULV",68,0)
 I +TIUTYPE'>0 S TIUY("INST")=$$DIVISION^TIULC1(+TIUY("LOC")) Q
"RTN","TIULV",69,0)
 I +$G(TIUMVN),$D(^DPT(DFN,.1)),+$$ISPN^TIULX(TIUTYPE) D
"RTN","TIULV",70,0)
 . I $D(VAIP(14,4)) S TIUY("LOC")=$G(^DIC(42,+VAIP(14,4),44))_U_$P(VAIP(14,4),U,2)
"RTN","TIULV",71,0)
 S TIUY("INST")=$$DIVISION^TIULC1(+TIUY("LOC"))
"RTN","TIULV",72,0)
 Q
"RTN","TIULV",73,0)
WARD(DA) ; Compute ward at discharge
"RTN","TIULV",74,0)
 N %,D0,DIC,DIQ,DR,MOVE,X,Y
"RTN","TIULV",75,0)
 I +DA'>0 S Y=$G(VAIP(TIUI,4)) G WARDX
"RTN","TIULV",76,0)
 S DIC="^DGPM(",DIQ(0)="IE",DIQ="MOVE(",DR=200
"RTN","TIULV",77,0)
 D EN^DIQ1
"RTN","TIULV",78,0)
 S X=$G(MOVE(405,DA,200,"E")),DIC=42,DIC(0)="X" D ^DIC
"RTN","TIULV",79,0)
 I +Y'>0 S Y=""
"RTN","TIULV",80,0)
WARDX Q Y
"RTN","TIULV",81,0)
PROVSVC(TIUSER) ; Resolve user's Service
"RTN","TIULV",82,0)
 N TIUY
"RTN","TIULV",83,0)
 S TIUY=$P($G(^VA(200,+TIUSER,5)),U)
"RTN","TIULV",84,0)
 S:+TIUY TIUY=TIUY_U_$P(^DIC(49,+TIUY,0),U)
"RTN","TIULV",85,0)
 Q TIUY
"RTN","TIULV",86,0)
VSIT(TIUY,TIUVSTR) ; Get Visit related info
"RTN","TIULV",87,0)
 N DIC,DIQ,X,Y,DA,DR,VSIT,TIUCT,VAEL,VAERR
"RTN","TIULV",88,0)
 D ELIG^VADPT
"RTN","TIULV",89,0)
 I '$D(TIUY("EDT")) D
"RTN","TIULV",90,0)
 . S TIUY("EDT")=$P(TIUVSTR,";",2)_U_$$DATE^TIULS($P(TIUVSTR,";",2),"AMTH DD, CCYY@HR:MIN")
"RTN","TIULV",91,0)
 S TIUY("LDT")=$G(TIUY("LDT"))
"RTN","TIULV",92,0)
 S TIUCT=$P(TIUVSTR,";",3)
"RTN","TIULV",93,0)
 I TIUCT]"" S TIUY("CAT")=TIUCT_U_$S(TIUCT="A":"AMBULATORY",TIUCT="I":"IN HOSPITAL",TIUCT="H":"HOSPITALIZATION",TIUCT="T":"TELEPHONE",1:"EVENT (HISTORICAL)")
"RTN","TIULV",94,0)
 I TIUCT="E",+$G(TIUVSTR)'>0 Q
"RTN","TIULV",95,0)
 S TIUY("LVL")=$G(TIUY("LVL"))
"RTN","TIULV",96,0)
 S TIUY("ELG")=$G(VAEL(1))
"RTN","TIULV",97,0)
 S TIUY("VLOC")=+$G(TIUVSTR)_U_$P($G(^SC(+$G(TIUVSTR),0)),U)
"RTN","TIULV",98,0)
 I $G(TIUY("LOC"))']"" S TIUY("LOC")=$S($L($G(TIUD12)):$P($G(TIUD12),U,5),+$G(TIUDA):+$P($G(^TIU(8925,+$G(TIUDA),12)),U,5),1:+TIUY("VLOC"))
"RTN","TIULV",99,0)
 S:$P(TIUY("LOC"),U,2)']"" TIUY("LOC")=TIUY("LOC")_U_$P($G(^SC(+TIUY("LOC"),0)),U)
"RTN","TIULV",100,0)
 I '$D(TIUY("DIV")),+$G(TIUY("LOC")) D
"RTN","TIULV",101,0)
 . N TIUDIV,DIC,DR,DA,DIQ,X,Y
"RTN","TIULV",102,0)
 . S DIC=44,DIQ="TIUDIV",DIQ(0)="IE",DA=+TIUY("LOC"),DR="3.5" D EN^DIQ1
"RTN","TIULV",103,0)
 . I '+$G(TIUDIV(44,+DA,3.5,"I")) Q
"RTN","TIULV",104,0)
 . S TIUY("DIV")=TIUDIV(44,+DA,3.5,"I")_U_TIUDIV(44,+DA,3.5,"E")
"RTN","TIULV",105,0)
 I '$D(TIUY("DIV")),'+$G(TIUY("LOC")) D
"RTN","TIULV",106,0)
 . S TIUY("DIV")=+$O(^DG(40.8,"AD",+$G(DUZ(2)),0))
"RTN","TIULV",107,0)
 . S TIUY("DIV")=+TIUY("DIV")_U_$P($G(^DG(40.8,+$G(TIUY("DIV")),0)),U)
"RTN","TIULV",108,0)
 S TIUY("INS")=$G(TIUY("DIV"))
"RTN","TIULV",109,0)
 S TIUY("SC")=$G(TIUY("SC"))
"RTN","TIULV",110,0)
 Q
"RTN","TIULV",111,0)
CURRENT(TIUY,DFN) ; Get current INPATIENT data
"RTN","TIULV",112,0)
 N VAIN D INP^VADPT
"RTN","TIULV",113,0)
 S TIUY("AD#")=$G(VAIN(1)),TIUY("PMD")=$G(VAIN(2))
"RTN","TIULV",114,0)
 S TIUY("TS")=$G(VAIN(3)),TIUY("WARD")=$G(VAIN(4),"0^OUTPATIENT")
"RTN","TIULV",115,0)
 S TIUY("RB")=$G(VAIN(5))
"RTN","TIULV",116,0)
 I +TIUY("WARD") D
"RTN","TIULV",117,0)
 . N DIC,DIQ,DR,DA,TIUDIV,Y
"RTN","TIULV",118,0)
 . S DIC=42,DA=+TIUY("WARD"),DIQ="TIUDIV(",DIQ(0)="IE",DR=".015;44"
"RTN","TIULV",119,0)
 . D EN^DIQ1
"RTN","TIULV",120,0)
 . S TIUY("DIV")=$G(TIUDIV(42,DA,.015,"I"))_U_$G(TIUDIV(42,DA,.015,"E"))
"RTN","TIULV",121,0)
 . S TIUY("LOC")=$G(TIUDIV(42,DA,44,"I"))_U_$G(TIUDIV(42,DA,44,"E"))
"RTN","TIULV",122,0)
 S TIUY("LOC")=$G(TIUY("LOC"))
"RTN","TIULV",123,0)
 I '+$G(TIUY("DIV")) D
"RTN","TIULV",124,0)
 . N DIC,DIQ,DR,DA
"RTN","TIULV",125,0)
 . S DIC=4,DR=".01",DA=+$G(DUZ(2)),DIQ="TIUDIV1"
"RTN","TIULV",126,0)
 . D EN^DIQ1
"RTN","TIULV",127,0)
 . ;TIU*1*152 changed TIUDIV1(4,DUZ(2),.01) to $G(TIUDIV1(4,$G(DUZ(2)),.01))
"RTN","TIULV",128,0)
 . S TIUY("DIV")=+$G(DUZ(2))_U_$G(TIUDIV1(4,$G(DUZ(2)),.01))
"RTN","TIULV",129,0)
 Q
"RTN","TIUP113")
0^39^B65597915
"RTN","TIUP113",1,0)
TIUP113 ; SLC/JAK - Post-Install for TIU*1*113 ;12/01/03
"RTN","TIUP113",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**113**;Jun 20, 1997
"RTN","TIUP113",3,0)
BUILD ; -- Rebuild SEARCH CATEGORIES so DIVISION is selectable
"RTN","TIUP113",4,0)
 D KILL^TIUDD8
"RTN","TIUP113",5,0)
 Q
"RTN","TIUP113",6,0)
MAIN ; -- Control unit
"RTN","TIUP113",7,0)
 N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","TIUP113",8,0)
 W !!,"PATCH TIU*1*113"
"RTN","TIUP113",9,0)
 W !!,"Load the DIVISION field for TIU DOCUMENT file (#8925) entries.",!
"RTN","TIUP113",10,0)
 S ZTRTN="SETDIV^TIUP113",ZTIO="",ZTSAVE("DUZ")=""
"RTN","TIUP113",11,0)
 S ZTDESC="DIVISION field load for File #8925 - Patch 113"
"RTN","TIUP113",12,0)
 D ^%ZTLOAD
"RTN","TIUP113",13,0)
 I $G(ZTSK) D
"RTN","TIUP113",14,0)
 . W !!,"A task has been queued in the background and a bulletin will be sent"
"RTN","TIUP113",15,0)
 . W !,"to you upon completion of the task or if the task is stopped."
"RTN","TIUP113",16,0)
 . W !!,"The task number is "_$G(ZTSK)_"."
"RTN","TIUP113",17,0)
 Q
"RTN","TIUP113",18,0)
SETDIV ; -- Automatically set division for documents
"RTN","TIUP113",19,0)
 N TIUCNT,TIUDA,TIUS
"RTN","TIUP113",20,0)
 S ^XTMP("TIUP113","T0")=$$NOW^XLFDT
"RTN","TIUP113",21,0)
 ; Initialize re-start if check point exists
"RTN","TIUP113",22,0)
 I +$G(^XTMP("TIUP113","CHKPT")) D
"RTN","TIUP113",23,0)
 . S TIUDA=+$G(^XTMP("TIUP113","CHKPT"))
"RTN","TIUP113",24,0)
 E  D
"RTN","TIUP113",25,0)
 . ; Initialize if not re-start
"RTN","TIUP113",26,0)
 . S ^XTMP("TIUP113",0)=$$FMADD^XLFDT(DT,90)_U_DT
"RTN","TIUP113",27,0)
 . S ^XTMP("TIUP113","EX")=0 F TIUS=1,2 S ^XTMP("TIUP113","EX",TIUS)=0
"RTN","TIUP113",28,0)
 . S (TIUDA,^XTMP("TIUP113","CHKPT"))=0
"RTN","TIUP113",29,0)
 K ^XTMP("TIUP113","STOP")
"RTN","TIUP113",30,0)
 ;
"RTN","TIUP113",31,0)
 ; Loop thru TIU Document entries
"RTN","TIUP113",32,0)
 F  S TIUDA=$O(^TIU(8925,TIUDA)) Q:+TIUDA'>0!($G(ZTSTOP))  D
"RTN","TIUP113",33,0)
 . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUP113",34,0)
 . ; Register activity in the ^XTMP("TIUP113", array
"RTN","TIUP113",35,0)
 . S ^XTMP("TIUP113","CHKPT")=TIUDA
"RTN","TIUP113",36,0)
 . ; Check if user requested to stop task
"RTN","TIUP113",37,0)
 . I $G(TIUCNT)>1000 D
"RTN","TIUP113",38,0)
 . . I $$S^%ZTLOAD S ZTSTOP=1
"RTN","TIUP113",39,0)
 . . E  S TIUCNT=0
"RTN","TIUP113",40,0)
 . ;
"RTN","TIUP113",41,0)
 . I +$P($G(^TIU(8925,TIUDA,12)),U,12) Q
"RTN","TIUP113",42,0)
 . N TIUDTYP,TIUEX
"RTN","TIUP113",43,0)
 . S TIUDTYP=+$P($G(^TIU(8925,TIUDA,0)),U)
"RTN","TIUP113",44,0)
 . ; -- Ignore records of (document type) type=component
"RTN","TIUP113",45,0)
 . I TIUDTYP,$P($G(^TIU(8925.1,TIUDTYP,0)),U,4)="CO" Q
"RTN","TIUP113",46,0)
 . ; -- Check if hospital location and entry date/time don't exist
"RTN","TIUP113",47,0)
 . I '$D(^TIU(8925,TIUDA,12)) D SETEX(TIUDA,1) Q
"RTN","TIUP113",48,0)
 . ; -- Get IFP from HL's Division
"RTN","TIUP113",49,0)
 . N RESULT,TIUE,TIUHL,TIUDVHL,TIUIFP
"RTN","TIUP113",50,0)
 . S (TIUDVHL,TIUE,TIUHL,TIUIFP)=0
"RTN","TIUP113",51,0)
 . S TIUHL=+$P($G(^TIU(8925,TIUDA,12)),U,5) I TIUHL D
"RTN","TIUP113",52,0)
 . . S TIUDVHL=+$P($G(^SC(TIUHL,0)),U,15) I TIUDVHL D
"RTN","TIUP113",53,0)
 . . . S TIUE=+$P($G(^TIU(8925,TIUDA,12)),U) I TIUE D
"RTN","TIUP113",54,0)
 . . . . S TIUIFP=+$$SITE^VASITE(TIUE,TIUDVHL) I TIUIFP>0 S RESULT=TIUIFP
"RTN","TIUP113",55,0)
 . I 'TIUHL!('TIUDVHL)!('TIUE)!(TIUIFP<0) D
"RTN","TIUP113",56,0)
 . . D SETEX(TIUDA,1)
"RTN","TIUP113",57,0)
 . E  D
"RTN","TIUP113",58,0)
 . . D SETRSLT(TIUDA,RESULT)
"RTN","TIUP113",59,0)
 ;
"RTN","TIUP113",60,0)
SETCHKQ ; Send bulletin and re-set check point
"RTN","TIUP113",61,0)
 I $G(ZTSTOP) S ^XTMP("TIUP113","STOP")=$$NOW^XLFDT
"RTN","TIUP113",62,0)
 S ^XTMP("TIUP113","T1")=$$NOW^XLFDT
"RTN","TIUP113",63,0)
 S ^XTMP("TIUP113","EX")=+$G(^XTMP("TIUP113","EX",1))+(+$G(^XTMP("TIUP113","EX",2)))
"RTN","TIUP113",64,0)
 ;
"RTN","TIUP113",65,0)
 D MAIL^TIUP113P
"RTN","TIUP113",66,0)
 ;
"RTN","TIUP113",67,0)
 I '$G(ZTSTOP) S ^XTMP("TIUP113","CHKPT")=""
"RTN","TIUP113",68,0)
 Q
"RTN","TIUP113",69,0)
SETEX(TIUDA,TIUEX) ; -- Load ^XTMP with exception entries
"RTN","TIUP113",70,0)
 ; Input -- TIUDA  TIU Document file (#8925) IEN
"RTN","TIUP113",71,0)
 ;          TIUEX  Exception types:
"RTN","TIUP113",72,0)
 ;                 1=Cannot determine DIVISION from Hospital Location
"RTN","TIUP113",73,0)
 ;                 2=Attempted to load DIVISION data but entry in use
"RTN","TIUP113",74,0)
 ;                 (value=1) (see SETRSLT for value=2)
"RTN","TIUP113",75,0)
 S ^XTMP("TIUP113","EX",TIUEX,TIUDA)=""
"RTN","TIUP113",76,0)
 S ^XTMP("TIUP113","EX",TIUEX)=+$G(^XTMP("TIUP113","EX",TIUEX))+1
"RTN","TIUP113",77,0)
 Q
"RTN","TIUP113",78,0)
SETRSLT(TIUDA,RESULT) ; -- Set DIVISION data and ADIV x-ref
"RTN","TIUP113",79,0)
 ; Input -- TIUDA   TIU Document file (#8925) IEN
"RTN","TIUP113",80,0)
 ;          RESULT  Institution file (#4) IEN
"RTN","TIUP113",81,0)
 N DIE,DR,DA
"RTN","TIUP113",82,0)
 L +^TIU(8925,+TIUDA):5 E  D  Q
"RTN","TIUP113",83,0)
 . S ^XTMP("TIUP113","EX",2,TIUDA)=RESULT
"RTN","TIUP113",84,0)
 . S ^XTMP("TIUP113","EX",2)=+$G(^XTMP("TIUP113","EX",2))+1
"RTN","TIUP113",85,0)
 S DIE="^TIU(8925,",DA=+TIUDA,DR="1212////^S X=RESULT"
"RTN","TIUP113",86,0)
 D ^DIE
"RTN","TIUP113",87,0)
 L -^TIU(8925,+TIUDA)
"RTN","TIUP113",88,0)
 Q
"RTN","TIUP113",89,0)
UPDATE ; -- Exception entries
"RTN","TIUP113",90,0)
 W !,"If you did not receive a mail message which indicated the post-"
"RTN","TIUP113",91,0)
 W !,"install COMPLETED, you must invoke MAIN^TIUP113 from Programmer"
"RTN","TIUP113",92,0)
 W !,"mode before following the instructions below.",!
"RTN","TIUP113",93,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","TIUP113",94,0)
 N RESULT,TIUCHC,TIUDA,TIUDIV,TIUI,TIUJ,TIUK,TIUNOEX,TIUOUT,TIUS
"RTN","TIUP113",95,0)
 S TIUOUT=0 F TIUK=7,9,18 S DIR("A",TIUK)=""
"RTN","TIUP113",96,0)
 S DIR("A",1)="Below are listed the choices for what action(s) to take"
"RTN","TIUP113",97,0)
 S DIR("A",2)="on the exception entries. It is recommended you select"
"RTN","TIUP113",98,0)
 S DIR("A",3)="choice 3 and also possibly choice 2. The numbers can be"
"RTN","TIUP113",99,0)
 S DIR("A",4)="selected by commas, dashes, or a combination of both."
"RTN","TIUP113",100,0)
 S DIR("A",5)="You can invoke this entry point (>D UPDATE^TIUP113)"
"RTN","TIUP113",101,0)
 S DIR("A",6)="as often as you wish."
"RTN","TIUP113",102,0)
 S DIR("A",8)="CHOICES:"
"RTN","TIUP113",103,0)
 S DIR("A",10)="1- Exit and do not load Division for exception entries."
"RTN","TIUP113",104,0)
 S DIR("A",11)="2- For exception entries in which Division could not be"
"RTN","TIUP113",105,0)
 S DIR("A",12)="   determined from the Hospital Location, prompt me to"
"RTN","TIUP113",106,0)
 S DIR("A",13)="   select one Division and load entries with this"
"RTN","TIUP113",107,0)
 S DIR("A",14)="   Division. (type A)"
"RTN","TIUP113",108,0)
 S DIR("A",15)="3- For exception entries that were previously in use,"
"RTN","TIUP113",109,0)
 S DIR("A",16)="   try to load Division data again. (type B)"
"RTN","TIUP113",110,0)
 S DIR("A")="Select (a) NUMBER(S)"
"RTN","TIUP113",111,0)
 S DIR(0)="L^1:3" D ^DIR G EXIT:$D(DIRUT) S TIUCHC=Y
"RTN","TIUP113",112,0)
 I TIUCHC[1 Q
"RTN","TIUP113",113,0)
 I TIUCHC[2 N DIR,X,Y S DIR(0)="P^40.8" D ^DIR G EXIT:Y'>0!$D(DIRUT) D
"RTN","TIUP113",114,0)
 . S TIUDIV=+Y,TIUIFP=+$$SITE^VASITE(,TIUDIV),RESULT=TIUIFP
"RTN","TIUP113",115,0)
 F TIUI=1:1:($L(TIUCHC,",")-1) D
"RTN","TIUP113",116,0)
 . S TIUS=$P(TIUCHC,",",TIUI)
"RTN","TIUP113",117,0)
 . I TIUS=2 D NOEX(TIUS,1) I 'TIUNOEX D
"RTN","TIUP113",118,0)
 . . N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","TIUP113",119,0)
 . . S ZTRTN="TWOA^TIUP113",ZTIO=""
"RTN","TIUP113",120,0)
 . . S (ZTSAVE("DUZ"),ZTSAVE("RESULT"))=""
"RTN","TIUP113",121,0)
 . . S ZTDESC="Choice 2 UPDATE^TIUP113 - Patch 113"
"RTN","TIUP113",122,0)
 . . D ^%ZTLOAD
"RTN","TIUP113",123,0)
 . . I $G(ZTSK) D
"RTN","TIUP113",124,0)
 . . . W !!,"A task has been queued in the background for Choice 2."
"RTN","TIUP113",125,0)
 . . . W !,"The task number is "_$G(ZTSK)_"."
"RTN","TIUP113",126,0)
 . . Q
"RTN","TIUP113",127,0)
 . I TIUS=3 D THREEB(TIUS)
"RTN","TIUP113",128,0)
 Q
"RTN","TIUP113",129,0)
TWOA ; -- Load entries with selection
"RTN","TIUP113",130,0)
 ; Input -- RESULT  Institution file (#4) IEN
"RTN","TIUP113",131,0)
 N TIUCNT
"RTN","TIUP113",132,0)
 S TIUDA=0 D
"RTN","TIUP113",133,0)
 . F  S TIUDA=$O(^XTMP("TIUP113","EX",1,TIUDA)) Q:+TIUDA'>0!($G(ZTSTOP))  D
"RTN","TIUP113",134,0)
 . . D SETRSLT(TIUDA,RESULT)
"RTN","TIUP113",135,0)
 . . K ^XTMP("TIUP113","EX",1,TIUDA)
"RTN","TIUP113",136,0)
 . . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUP113",137,0)
 . . ; Check if user requested to stop task
"RTN","TIUP113",138,0)
 . . I $G(TIUCNT)>1000 D
"RTN","TIUP113",139,0)
 . . . I $$S^%ZTLOAD S ZTSTOP=1
"RTN","TIUP113",140,0)
 . . . E  S TIUCNT=0
"RTN","TIUP113",141,0)
 ;
"RTN","TIUP113",142,0)
 I '$G(ZTSTOP) S ^XTMP("TIUP113","EX",1)=0
"RTN","TIUP113",143,0)
 Q
"RTN","TIUP113",144,0)
THREEB(TIUS) ; -- Try to load locked entries
"RTN","TIUP113",145,0)
 ; Input --   TIUS  Choice 3
"RTN","TIUP113",146,0)
 S TIUDA=0 N RESULT D NOEX(TIUS,2) I 'TIUNOEX D
"RTN","TIUP113",147,0)
 . W !!,"...Choice 3 - UPDATING NOW....",!!
"RTN","TIUP113",148,0)
 . F  S TIUDA=$O(^XTMP("TIUP113","EX",2,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUP113",149,0)
 . . S RESULT=$G(^XTMP("TIUP113","EX",2,TIUDA))
"RTN","TIUP113",150,0)
 . . D SETRSLT(TIUDA,RESULT)
"RTN","TIUP113",151,0)
 . . I +$P($G(^TIU(8925,TIUDA,12)),U,12) K ^XTMP("TIUP113","EX",2,TIUDA)
"RTN","TIUP113",152,0)
 . S ^XTMP("TIUP113","EX",2)=0
"RTN","TIUP113",153,0)
 Q
"RTN","TIUP113",154,0)
NOEX(TIUS,TIUJ) ; -- No exceptions
"RTN","TIUP113",155,0)
 ; Input -- TIUS  Choice 2 or 3
"RTN","TIUP113",156,0)
 ;       -- TIUJ  Exception entry types A (1) or B (2)
"RTN","TIUP113",157,0)
 S TIUNOEX=0
"RTN","TIUP113",158,0)
 I +$G(^XTMP("TIUP113","EX",TIUJ))=0 D
"RTN","TIUP113",159,0)
 . W !,"Choice: ",TIUS,"-type ",$S(TIUJ=2:"B",1:"A")
"RTN","TIUP113",160,0)
 . W " has no exceptions."
"RTN","TIUP113",161,0)
 . S TIUNOEX=1
"RTN","TIUP113",162,0)
 Q
"RTN","TIUP113",163,0)
DEVICE ; -- Device Selection
"RTN","TIUP113",164,0)
 N TIUMSG,TIUOUT S TIUOUT=0
"RTN","TIUP113",165,0)
 S TIUMSG(1)="Remember to finish the post-install after review of"
"RTN","TIUP113",166,0)
 S TIUMSG(2)="the output by invoking UPDATE^TIUP113"
"RTN","TIUP113",167,0)
 D MES^XPDUTL(.TIUMSG)
"RTN","TIUP113",168,0)
 W !! S %ZIS="Q" D ^%ZIS I POP K POP S TIUOUT=1 G EXIT
"RTN","TIUP113",169,0)
 I $D(IO("Q")) D  Q
"RTN","TIUP113",170,0)
 . S ZTRTN="PRINT^TIUP113"
"RTN","TIUP113",171,0)
 . S ZTDESC="TIU*1*113 POST-INSTALL EXCEPTION LIST"
"RTN","TIUP113",172,0)
 . D ^%ZTLOAD W !,$S($D(ZTSK):"Request queued",1:"Request Cancelled!")
"RTN","TIUP113",173,0)
 . K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,%ZIS
"RTN","TIUP113",174,0)
 . D HOME^%ZIS
"RTN","TIUP113",175,0)
 U IO D PRINT,^%ZISC
"RTN","TIUP113",176,0)
 Q
"RTN","TIUP113",177,0)
PRINT ; -- Print job
"RTN","TIUP113",178,0)
 N TIUDA,TIUIFP,TIUOUT,TIUS,TIUST S TIUOUT=0
"RTN","TIUP113",179,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","TIUP113",180,0)
 F TIUS=1,2 Q:TIUOUT  S TIUDA=0 D
"RTN","TIUP113",181,0)
 . I TIUS=2 D ASK Q:TIUOUT
"RTN","TIUP113",182,0)
 . D HDR W !!,$P($T(EXHDR+TIUS),";",3)
"RTN","TIUP113",183,0)
 . I +$G(^XTMP("TIUP113","EX",TIUS))=0 W !?4,"No exceptions." Q
"RTN","TIUP113",184,0)
 . F  S TIUDA=$O(^XTMP("TIUP113","EX",TIUS,TIUDA)) Q:+TIUDA'>0!(TIUOUT)  D
"RTN","TIUP113",185,0)
 . . I $Y>(IOSL-4) D ASK Q:TIUOUT  D HDR W !!,$P($T(EXHDR+TIUS),";",3)
"RTN","TIUP113",186,0)
 . . W !?4,TIUDA
"RTN","TIUP113",187,0)
 . . S TIUST=$P($G(^TIU(8925,+TIUDA,0)),U,5) I TIUST>0 D
"RTN","TIUP113",188,0)
 . . . W "  ",$P($G(^TIU(8925.6,+TIUST,0)),U)
"RTN","TIUP113",189,0)
 . . I TIUS=2 D
"RTN","TIUP113",190,0)
 . . . S TIUIFP=$G(^XTMP("TIUP113","EX",2,TIUDA))
"RTN","TIUP113",191,0)
 . . . W ": ",$$GET1^DIQ(4,TIUIFP,.01)
"RTN","TIUP113",192,0)
 Q
"RTN","TIUP113",193,0)
ASK ; -- End of Page
"RTN","TIUP113",194,0)
 I IO=IO(0),$E(IOST)="C" D
"RTN","TIUP113",195,0)
 . W ! N DIR,X,Y S DIR(0)="E"
"RTN","TIUP113",196,0)
 . D ^DIR I $D(DUOUT)!$D(DTOUT) S TIUOUT=1
"RTN","TIUP113",197,0)
 Q
"RTN","TIUP113",198,0)
HDR ; -- Header
"RTN","TIUP113",199,0)
 N LNE,TIUNOW
"RTN","TIUP113",200,0)
 D NOW^%DTC S Y=% X ^DD("DD") S TIUNOW=Y
"RTN","TIUP113",201,0)
 W @IOF,"TIU*1*113 POST-INSTALL EXCEPTION LIST - Printed: ",TIUNOW
"RTN","TIUP113",202,0)
 W !!,"Listed below are TIU DOCUMENT entry numbers that did not get "
"RTN","TIUP113",203,0)
 W "DIVISION data",!,"loaded. If a division name is listed with an "
"RTN","TIUP113",204,0)
 W "entry number, the record was",!,"in use and the division data "
"RTN","TIUP113",205,0)
 W "could not be loaded."
"RTN","TIUP113",206,0)
 W ! S LNE="",$P(LNE,"-",(IOM-1))="" W LNE
"RTN","TIUP113",207,0)
 Q
"RTN","TIUP113",208,0)
EXHDR ; -- Exception entry headers
"RTN","TIUP113",209,0)
 ;;A. Cannot determine DIVISION from Hospital Location: 
"RTN","TIUP113",210,0)
 ;;B. Attempted to load DIVISION data but entry in use: 
"RTN","TIUP113",211,0)
 ;
"RTN","TIUP113",212,0)
EXIT ; -- Exits here if ^ at: DEVICE prompt,
"RTN","TIUP113",213,0)
 ; -- two UPDATE areas, or at End of Page
"RTN","TIUP113",214,0)
 I TIUOUT D
"RTN","TIUP113",215,0)
 . W $C(7),$C(7),!!,"OK...please remember to finish the post-install "
"RTN","TIUP113",216,0)
 . W "by: >D UPDATE^TIUP113"
"RTN","TIUP113",217,0)
 Q
"RTN","TIUP113P")
0^40^B8136391
"RTN","TIUP113P",1,0)
TIUP113P ; SLC/JAK - Post-Install for TIU*1*113 Cont. ;9/24/03
"RTN","TIUP113P",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**113**;Jun 20, 1997
"RTN","TIUP113P",3,0)
MAIL ; -- Send message to user who initiated post-install
"RTN","TIUP113P",4,0)
 N XMSUB,XMTEXT,XMDUZ,XMY,XMZ,XMMG
"RTN","TIUP113P",5,0)
 N TIUI,TIUK,TIUS,TIUTXT
"RTN","TIUP113P",6,0)
 S XMDUZ="PATCH TIU*1*113 DIVISION LOADING",XMY(.5)=""
"RTN","TIUP113P",7,0)
 S:$G(DUZ) XMY(DUZ)=""
"RTN","TIUP113P",8,0)
 F TIUK=3,5 S TIUTXT(TIUK)=""
"RTN","TIUP113P",9,0)
 S TIUTXT(1)="Task Started: "_$$FMTE^XLFDT($G(^XTMP("TIUP113","T0")))
"RTN","TIUP113P",10,0)
 S TIUTXT(2)="Task   Ended: "_$$FMTE^XLFDT($G(^XTMP("TIUP113","T1")))
"RTN","TIUP113P",11,0)
 I $G(^XTMP("TIUP113","STOP")) D
"RTN","TIUP113P",12,0)
 . S TIUTXT(4)="Task STOPPED: "_$$FMTE^XLFDT($G(^XTMP("TIUP113","STOP")))_"."
"RTN","TIUP113P",13,0)
 . S TIUTXT(6)="The post-install has not completed."
"RTN","TIUP113P",14,0)
 . S TIUTXT(7)="To restart invoke MAIN^TIUP113 from Programmer mode."
"RTN","TIUP113P",15,0)
 . S TIUTXT(8)="The task will continue from the last entry processed."
"RTN","TIUP113P",16,0)
 E  D
"RTN","TIUP113P",17,0)
 . F TIUK=9,13,16,20,24 S TIUTXT(TIUK)=""
"RTN","TIUP113P",18,0)
 . S TIUTXT(4)="Task and post-install COMPLETED successfully."
"RTN","TIUP113P",19,0)
 . S TIUTXT(6)="This patch post-install has reviewed all of the "_+$P($G(^TIU(8925,0)),U,4)
"RTN","TIUP113P",20,0)
 . S TIUTXT(7)="entries in the TIU DOCUMENT file, and has attempted to"
"RTN","TIUP113P",21,0)
 . S TIUTXT(8)="load each with DIVISION data."
"RTN","TIUP113P",22,0)
 . S TIUTXT(10)="There are "_+$G(^XTMP("TIUP113","EX"))_" total exception entries"
"RTN","TIUP113P",23,0)
 . S TIUTXT(11)="that could not be loaded with DIVISION data,"
"RTN","TIUP113P",24,0)
 . S TIUTXT(12)="however. Here's how they break down by types:",TIUI=13
"RTN","TIUP113P",25,0)
 . F TIUS=1,2 D
"RTN","TIUP113P",26,0)
 . . S TIUTXT(TIUI+TIUS)=$P($T(EXHDR+TIUS),";",3)_+$G(^XTMP("TIUP113","EX",TIUS))_" entry/entries"
"RTN","TIUP113P",27,0)
 . S TIUTXT(17)="Next, you can print the entries by type of exception so"
"RTN","TIUP113P",28,0)
 . S TIUTXT(18)="you can review them before continuing, or you can skip"
"RTN","TIUP113P",29,0)
 . S TIUTXT(19)="the printing and finish the post-install."
"RTN","TIUP113P",30,0)
 . S TIUTXT(21)="To print: invoke DEVICE^TIUP113 from Programmer mode"
"RTN","TIUP113P",31,0)
 . S TIUTXT(22)="          (instructions for finishing the post-install"
"RTN","TIUP113P",32,0)
 . S TIUTXT(23)="          are included in this call)"
"RTN","TIUP113P",33,0)
 . S TIUTXT(25)="To finish: invoke UPDATE^TIUP113 from Programmer mode"
"RTN","TIUP113P",34,0)
 S XMTEXT="TIUTXT(",XMSUB="PATCH TIU*1*113 Division Loading"
"RTN","TIUP113P",35,0)
 D ^XMD
"RTN","TIUP113P",36,0)
 Q
"RTN","TIUP113P",37,0)
EXHDR ; -- Exception entry headers
"RTN","TIUP113P",38,0)
 ;;A. Cannot determine DIVISION from Hospital Location: 
"RTN","TIUP113P",39,0)
 ;;B. Attempted to load DIVISION data but entry in use: 
"RTN","TIUPEFIX")
0^8^B41040237
"RTN","TIUPEFIX",1,0)
TIUPEFIX ; SLC/JER - Resolve Filing errors for TIU Documents ;4/18/03
"RTN","TIUPEFIX",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,21,100,167,113**;Jun 20, 1997
"RTN","TIUPEFIX",3,0)
MAKE(SUCCESS,DFN,TITLE,TIU,TIUBUF) ; File new TIU Document
"RTN","TIUPEFIX",4,0)
 ; SUCCESS = (by ref) SUCCESS Returns TIU DOCUMENT # (PTR to 8925)
"RTN","TIUPEFIX",5,0)
 ;         = 0^Explanatory message if no SUCCESS
"RTN","TIUPEFIX",6,0)
 ; DFN     = Patient (#2)
"RTN","TIUPEFIX",7,0)
 ; TITLE   = Pointer to TIU Document Definition (#8925.1)
"RTN","TIUPEFIX",8,0)
 ; TIU     = Array of demographic and visit attributes
"RTN","TIUPEFIX",9,0)
 ; TIUBUF  = Record number (ien) of entry in TIU Buffer file (#8925.2)
"RTN","TIUPEFIX",10,0)
 ;
"RTN","TIUPEFIX",11,0)
 ; -- first, get TIU Document record --
"RTN","TIUPEFIX",12,0)
 ;
"RTN","TIUPEFIX",13,0)
 N TIUDA,LDT,NEWREC,TIUX,TIUTYP,TIUDPRM,HAPPY,TIUCLASS,TIUDTYP,TIUPOST
"RTN","TIUPEFIX",14,0)
 N TIUDFLT,TIUREC
"RTN","TIUPEFIX",15,0)
 S SUCCESS=0 ; Initialize SUCCESS to false
"RTN","TIUPEFIX",16,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,+$G(TIUTYPE)'>0:1,1:0) S SUCCESS="0^"_$$EZBLD^DIALOG(89250001) Q
"RTN","TIUPEFIX",17,0)
 ; If target file is not 8925 QUIT
"RTN","TIUPEFIX",18,0)
 I +$G(^TIU(8925.1,+TIUTYPE,1))'=8925 Q
"RTN","TIUPEFIX",19,0)
 S TIUDTYP=$P($G(^TIU(8925.1,+TIUTYPE,0)),U,4)
"RTN","TIUPEFIX",20,0)
 S TIUCLASS=$S(TIUDTYP="CL":+TIUTYPE,1:38)
"RTN","TIUPEFIX",21,0)
 S TIUDFLT=$S(TIUCLASS'=TIUTYPE:TIUTYPE,1:"")
"RTN","TIUPEFIX",22,0)
 I +$G(TITLE)'>0 S TITLE=$$ASKTITLE^TIULA3(TIUCLASS,TIUDFLT)
"RTN","TIUPEFIX",23,0)
 Q:+TITLE'>0
"RTN","TIUPEFIX",24,0)
 S TIUTYP=TITLE,TIUTYP(1)=1_U_TITLE
"RTN","TIUPEFIX",25,0)
 D DOCPRM^TIULC1(TITLE,.TIUDPRM)
"RTN","TIUPEFIX",26,0)
 ;S TIUDA=$$GETREC^TIUEDI1(DFN,.TIU,1,.NEWREC,.TIUDPRM) ;10/27/00
"RTN","TIUPEFIX",27,0)
 S TIUDA=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.NEWREC,.TIUDPRM)
"RTN","TIUPEFIX",28,0)
 I +TIUDA'>0 S SUCCESS="0^"_$$EZBLD^DIALOG(89250002) Q
"RTN","TIUPEFIX",29,0)
 I +$$CANEDIT^TIUPUTU(TIUDA)'>0 D  G MAKEX
"RTN","TIUPEFIX",30,0)
 . D MAKEADD(.TIUADD,+TIUDA,TIUBUF) S SUCCESS=TIUADD
"RTN","TIUPEFIX",31,0)
 S SUCCESS=1
"RTN","TIUPEFIX",32,0)
 ;
"RTN","TIUPEFIX",33,0)
 ; -- second, load the header elements & text into TIUX array
"RTN","TIUPEFIX",34,0)
 ;
"RTN","TIUPEFIX",35,0)
 D STUFREC(TIUDA,$G(DFN),,.TIU)
"RTN","TIUPEFIX",36,0)
 D LOADTIUX(.TIUX,TIUBUF)
"RTN","TIUPEFIX",37,0)
 ;
"RTN","TIUPEFIX",38,0)
 ; -- third, file the data in TIU Document record --
"RTN","TIUPEFIX",39,0)
 ;
"RTN","TIUPEFIX",40,0)
 K ^TIU(8925,+TIUDA,"TEMP"),TIUX(.01),TIUX(.02),TIUX(.03),TIUX(.05)
"RTN","TIUPEFIX",41,0)
 K TIUX(.13),TIUX(1205),TIUX(1211)
"RTN","TIUPEFIX",42,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUPEFIX",43,0)
 D FILE(.HAPPY,+TIUDA,.TIUX,TIUTYP)
"RTN","TIUPEFIX",44,0)
 D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUPEFIX",45,0)
 S TIUPOST=$$POSTFILE^TIULC1(TITLE)
"RTN","TIUPEFIX",46,0)
 S TIUREC("#")=TIUDA
"RTN","TIUPEFIX",47,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPEFIX",48,0)
MAKEX D ALERTDEL^TIUPEVNT(+TIUBUF)
"RTN","TIUPEFIX",49,0)
 D RESOLVE^TIUPEVNT($S($D(XQADATA):+$P(XQADATA,";",3),1:$G(ERRDA)),1)
"RTN","TIUPEFIX",50,0)
 D BUFPURGE^TIUPUTC(+TIUBUF)
"RTN","TIUPEFIX",51,0)
 K ^TIU(8925,+TIUDA,"TEMP") W "Done."
"RTN","TIUPEFIX",52,0)
 I +$G(TIUDA),+$D(^TIU(8925,+$G(TIUDA),0)) D
"RTN","TIUPEFIX",53,0)
 . N TIU D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUPEFIX",54,0)
 . D EN^VALM("TIU BROWSE FOR MRT")
"RTN","TIUPEFIX",55,0)
 Q
"RTN","TIUPEFIX",56,0)
LOADTIUX(TIUARR,TIUBUF) ; Load TIUX array with header and text
"RTN","TIUPEFIX",57,0)
 N TIUI,TIUHSIG,TIUBGN,TIULINE,X,Y,TYPE I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUPEFIX",58,0)
 S TIUHSIG=$P(TIUPRM0,U,10),TIUBGN=$P(TIUPRM0,U,12)
"RTN","TIUPEFIX",59,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925.2,+TIUBUF,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUPEFIX",60,0)
 . S TIULINE=$G(^TIU(8925.2,+TIUBUF,"TEXT",TIUI,0))
"RTN","TIUPEFIX",61,0)
 . I TIULINE[TIUHSIG D
"RTN","TIUPEFIX",62,0)
 . . N TIUD1,TIUD4
"RTN","TIUPEFIX",63,0)
 . . S X=$$STRIP^TIULS($P(TIULINE,":",2)),Y=$$WHATYPE^TIUPUTU(X)
"RTN","TIUPEFIX",64,0)
 . . I +Y'>0 D MAIN^TIUPEVNT(TIUBUF,1,3,X) Q
"RTN","TIUPEFIX",65,0)
 . . S TIUD1=$G(^TIU(8925.1,+Y,1)),TIUD4=$G(^TIU(8925.1,+Y,4))
"RTN","TIUPEFIX",66,0)
 . . S TYPE=+Y
"RTN","TIUPEFIX",67,0)
 . . F  D  Q:TIULINE[TIUBGN!(+TIUI'>0)
"RTN","TIUPEFIX",68,0)
 . . . N TIUN,TIUCAP,TIUFLD,TIUREQ S TIUREQ=0
"RTN","TIUPEFIX",69,0)
 . . . S TIUI=$O(^TIU(8925.2,+TIUBUF,"TEXT",TIUI)) Q:+TIUI'>0
"RTN","TIUPEFIX",70,0)
 . . . S TIULINE=$G(^TIU(8925.2,+TIUBUF,"TEXT",TIUI,0)) Q:TIULINE[TIUBGN
"RTN","TIUPEFIX",71,0)
 . . . S TIUCAP=$P(TIULINE,":") Q:TIUCAP']""
"RTN","TIUPEFIX",72,0)
 . . . S TIUN=$O(^TIU(8925.1,+TYPE,"HEAD","B",TIUCAP,0))
"RTN","TIUPEFIX",73,0)
 . . . Q:+TIUN'>0
"RTN","TIUPEFIX",74,0)
 . . . S TIUFLD=$P(^TIU(8925.1,+TYPE,"HEAD",+TIUN,0),U,3)
"RTN","TIUPEFIX",75,0)
 . . . Q:TIUFLD']""
"RTN","TIUPEFIX",76,0)
 . . . S TIUREQ=$P(^TIU(8925.1,+TYPE,"HEAD",+TIUN,0),U,7)
"RTN","TIUPEFIX",77,0)
 . . . S TIUARR(TIUFLD)=$$STRIP^TIULS($P(TIULINE,":",2,99))
"RTN","TIUPEFIX",78,0)
 . . . S:TIUFLD'=.001 TIUARR(TIUFLD)=$$TRNSFRM(+TYPE,TIUFLD,TIUARR(TIUFLD))
"RTN","TIUPEFIX",79,0)
 . . . I +TIUREQ,TIUARR(TIUFLD)="" S TIUARR(TIUFLD)="** REQUIRED FIELD MISSING FROM UPLOAD **"
"RTN","TIUPEFIX",80,0)
 . . . I $S(TIUFLD=.01:1,TIUFLD=.02:1,TIUFLD=.07:1,TIUFLD=1301:1,1:0) K TIUARR(TIUFLD)
"RTN","TIUPEFIX",81,0)
 . . I TIULINE[TIUBGN D
"RTN","TIUPEFIX",82,0)
 . . . N TIUJ S TIUJ=0
"RTN","TIUPEFIX",83,0)
 . . . F  D  Q:+TIUI'>0
"RTN","TIUPEFIX",84,0)
 . . . . S TIUI=$O(^TIU(8925.2,+TIUBUF,"TEXT",TIUI)) Q:+TIUI'>0
"RTN","TIUPEFIX",85,0)
 . . . . S TIUJ=TIUJ+1
"RTN","TIUPEFIX",86,0)
 . . . . S TIUARR("TEXT",TIUJ,0)=$G(^TIU(8925.2,+TIUBUF,"TEXT",TIUI,0))
"RTN","TIUPEFIX",87,0)
 Q
"RTN","TIUPEFIX",88,0)
STUFREC(DA,DFN,PARENT,TIU) ; Stuff fixed field data
"RTN","TIUPEFIX",89,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIURDT
"RTN","TIUPEFIX",90,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPEFIX",91,0)
 I +$G(PARENT)'>0 D
"RTN","TIUPEFIX",92,0)
 . S @FDARR@(.02)=$G(DFN),@FDARR@(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUPEFIX",93,0)
 . S @FDARR@(.05)=$S(+$$REQVER(+$P($G(TIUDPRM(0)),U,3)):4,1:5)
"RTN","TIUPEFIX",94,0)
 . S @FDARR@(.07)=$P(TIU("EDT"),U)
"RTN","TIUPEFIX",95,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U),@FDARR@(1401)=$P($G(TIU("AD#")),U)
"RTN","TIUPEFIX",96,0)
 . S @FDARR@(1402)=$P($G(TIU("TS")),U),@FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPEFIX",97,0)
 . S @FDARR@(1205)=$S(+$P($G(TIU("LOC")),U):$P($G(TIU("LOC")),U),1:$P($G(TIU("VLOC")),U))
"RTN","TIUPEFIX",98,0)
 . S @FDARR@(1212)=$S(+$P($G(TIU("INST")),U):$P($G(TIU("INST")),U),1:DUZ(2))
"RTN","TIUPEFIX",99,0)
 . S @FDARR@(1404)=$P($G(TIU("SVC")),U)
"RTN","TIUPEFIX",100,0)
 I +$G(PARENT)>0 D
"RTN","TIUPEFIX",101,0)
 . S @FDARR@(.02)=+$P(^TIU(8925,+PARENT,0),U,2)
"RTN","TIUPEFIX",102,0)
 . S @FDARR@(.03)=$P(^TIU(8925,+PARENT,0),U,3)
"RTN","TIUPEFIX",103,0)
 . S @FDARR@(.05)=$S(+$$REQVER(+$P($G(TIUDPRM(0)),U,3)):4,1:5)
"RTN","TIUPEFIX",104,0)
 . S @FDARR@(.06)=PARENT
"RTN","TIUPEFIX",105,0)
 . S @FDARR@(.07)=$P($G(TIU("EDT")),U),@FDARR@(.08)=$P($G(TIU("LDT")),U)
"RTN","TIUPEFIX",106,0)
 . S @FDARR@(1205)=$P($G(^TIU(8925,+PARENT,12)),U,5)
"RTN","TIUPEFIX",107,0)
 . S @FDARR@(1212)=$P($G(^TIU(8925,+PARENT,12)),U,12)
"RTN","TIUPEFIX",108,0)
 . S @FDARR@(1401)=$P($G(^TIU(8925,+PARENT,14)),U)
"RTN","TIUPEFIX",109,0)
 . S @FDARR@(1402)=$P($G(^TIU(8925,+PARENT,14)),U,2)
"RTN","TIUPEFIX",110,0)
 . S @FDARR@(1404)=$P($G(^TIU(8925,+PARENT,14)),U,4)
"RTN","TIUPEFIX",111,0)
 S @FDARR@(1201)=$$NOW^XLFDT
"RTN","TIUPEFIX",112,0)
 I +$G(TIU("LDT")) S TIURDT=+$G(TIU("LDT"))
"RTN","TIUPEFIX",113,0)
 I +$G(TIU("LDT"))'>0 D
"RTN","TIUPEFIX",114,0)
 . S TIUDICDT=+$$IDATE^TIULC($G(TIUDICDT))
"RTN","TIUPEFIX",115,0)
 . I +TIUDICDT,($P(TIUDICDT,".",2)'>0) D
"RTN","TIUPEFIX",116,0)
 . . S TIUDICDT=$S($P(TIU("VSTR"),";",3)'="H":$P($G(TIU("EDT")),U),1:"")
"RTN","TIUPEFIX",117,0)
 . S TIURDT=$S(+$G(TIUDICDT)>0:+$G(TIUDICDT),1:+$$NOW^TIULC)
"RTN","TIUPEFIX",118,0)
 . S:+$G(TIUTYPE)=1 @FDARR@(.12)=1
"RTN","TIUPEFIX",119,0)
 . K TIUDICDT
"RTN","TIUPEFIX",120,0)
 S @FDARR@(1301)=TIURDT,@FDARR@(1303)="U"
"RTN","TIUPEFIX",121,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPEFIX",122,0)
 Q
"RTN","TIUPEFIX",123,0)
REQVER(VPARM) ; Evaluate whether verification is required
"RTN","TIUPEFIX",124,0)
 Q $S(VPARM=1:1,VPARM=2:1,1:0)
"RTN","TIUPEFIX",125,0)
MAKEADD(TIUDADD,TIUDA,TIUBUF) ; Create an addendum record
"RTN","TIUPEFIX",126,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUCAN,TIUFPRIV,TIU,TIUX S TIUFPRIV=1
"RTN","TIUPEFIX",127,0)
 N TIUDTTL,TIUPOST,TIUREC
"RTN","TIUPEFIX",128,0)
 S TIUDTTL=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIUPEFIX",129,0)
 S TIUATYP=+$$WHATITLE^TIUPUTU("ADDENDUM")
"RTN","TIUPEFIX",130,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUPEFIX",131,0)
 D ^DIC
"RTN","TIUPEFIX",132,0)
 S TIUDADD=+Y
"RTN","TIUPEFIX",133,0)
 I +Y'>0 S TIUDADD=TIUDADD_"^Could not create addendum." Q
"RTN","TIUPEFIX",134,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPEFIX",135,0)
 S TIU("DOCTYP")=TIUATYP_U_$$PNAME^TIULC1(TIUATYP)
"RTN","TIUPEFIX",136,0)
 D STUFREC(TIUDADD,DFN,+TIUDA,.TIU)
"RTN","TIUPEFIX",137,0)
 D LOADTIUX(.TIUX,TIUBUF)
"RTN","TIUPEFIX",138,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUPEFIX",139,0)
 M ^TIU(8925,+TIUDADD,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUPEFIX",140,0)
 D FILE(.SUCCESS,+TIUDADD,.TIUX,TIUATYP)
"RTN","TIUPEFIX",141,0)
 D MERGTEXT^TIUEDI1(+TIUDADD,.TIU)
"RTN","TIUPEFIX",142,0)
 S TIUPOST=$$POSTFILE^TIULC1(TIUDTTL)
"RTN","TIUPEFIX",143,0)
 S TIUREC("#")=TIUDADD
"RTN","TIUPEFIX",144,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPEFIX",145,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUPEFIX",146,0)
 Q
"RTN","TIUPEFIX",147,0)
FILE(SUCCESS,TIUDA,TIUX,RTYPE) ; Call FM Filer to commit updates to DB
"RTN","TIUPEFIX",148,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG
"RTN","TIUPEFIX",149,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="KE"
"RTN","TIUPEFIX",150,0)
 M @FDARR=TIUX
"RTN","TIUPEFIX",151,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPEFIX",152,0)
 I $D(TIUMSG)>9 D
"RTN","TIUPEFIX",153,0)
 . S SUCCESS=0_U_$G(TIUMSG(1,"TEXT",1))
"RTN","TIUPEFIX",154,0)
 . D MAIN^TIUPEVNT(TIUBUF,2,"",$P($G(^TIU(8925.1,+RTYPE,0)),U),.FDA,.TIUMSG)
"RTN","TIUPEFIX",155,0)
 E  S SUCCESS=TIUDA
"RTN","TIUPEFIX",156,0)
 Q
"RTN","TIUPEFIX",157,0)
TRNSFRM(RTYPE,FLD,X) ; Executes Transform code for a given header field
"RTN","TIUPEFIX",158,0)
 N XFORM
"RTN","TIUPEFIX",159,0)
 S FLD=$O(^TIU(8925.1,+RTYPE,"HEAD","D",+FLD,0))
"RTN","TIUPEFIX",160,0)
 I +FLD'>0 G TRNSFRMX
"RTN","TIUPEFIX",161,0)
 S XFORM=$G(^TIU(8925.1,+RTYPE,"HEAD",+FLD,1))
"RTN","TIUPEFIX",162,0)
 I XFORM']"" G TRNSFRMX
"RTN","TIUPEFIX",163,0)
 X XFORM
"RTN","TIUPEFIX",164,0)
TRNSFRMX Q X
"RTN","TIUPEVNT")
0^10^B39544163
"RTN","TIUPEVNT",1,0)
TIUPEVNT ; SLC/JER - Event logger for upload/filer ;7/18/03
"RTN","TIUPEVNT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,21,81,131,113**;Jun 20, 1997
"RTN","TIUPEVNT",3,0)
MAIN(BUFDA,ETYPE,ECODE,TIUTYPE,FDA,MSG) ; ---- Controls branching
"RTN","TIUPEVNT",4,0)
 N EVNTDA
"RTN","TIUPEVNT",5,0)
 ; ---- ETYPE = 1: Filing error event
"RTN","TIUPEVNT",6,0)
 ; ---- ETYPE = 2: Missing/incorrect field error event
"RTN","TIUPEVNT",7,0)
 ; ---- ETYPE = 0: Other event (no errors)
"RTN","TIUPEVNT",8,0)
 D LOG(BUFDA,ETYPE,$G(ECODE),$G(TIUTYPE),.EVNTDA,.FDA,.MSG)
"RTN","TIUPEVNT",9,0)
 I ETYPE=2 D FIELDS^TIUPEVN1(EVNTDA,.MSG)
"RTN","TIUPEVNT",10,0)
 Q
"RTN","TIUPEVNT",11,0)
LOG(BUFDA,ETYPE,ECODE,TIUTYPE,EVNTDA,FDA,MSG) ; ---- Register event in 
"RTN","TIUPEVNT",12,0)
 ;                                              TIU UPLOAD LOG file
"RTN","TIUPEVNT",13,0)
 ;                                              (#8925.4)
"RTN","TIUPEVNT",14,0)
 N BUFREC,ERRMSG,NEWBUF,DIC,DLAYGO,DIE,DA,DR,TIUK,TIUL,X,Y
"RTN","TIUPEVNT",15,0)
 S BUFREC=$G(^TIU(8925.2,+BUFDA,0))
"RTN","TIUPEVNT",16,0)
 S (DIC,DLAYGO)=8925.4,DIC(0)="MLX",X=""""_$$NOW^TIULC_"""" D ^DIC
"RTN","TIUPEVNT",17,0)
 Q:+Y'>0
"RTN","TIUPEVNT",18,0)
 ; ---- File upload log record
"RTN","TIUPEVNT",19,0)
 S DIE=DIC,(EVNTDA,DA)=+Y,ERRMSG=$$ERRMSG(ETYPE,ECODE,TIUTYPE,.FDA,.MSG)
"RTN","TIUPEVNT",20,0)
 S DR=".02////"_$P(BUFREC,U,2)_";.03////"_TIUTYPE_";.04////"_ERRMSG_";.06////"_$S(+ETYPE:0,1:"")_";.08////"_ETYPE_";.09////"_$S($G(TIUINST):TIUINST,1:DUZ(2))
"RTN","TIUPEVNT",21,0)
 D ^DIE K DA
"RTN","TIUPEVNT",22,0)
 I ETYPE'=1 Q
"RTN","TIUPEVNT",23,0)
 ; ---- Store Header of failed record in log
"RTN","TIUPEVNT",24,0)
 S ^TIU(8925.4,+EVNTDA,"HEAD",0)="^^^^"_DT_"^"
"RTN","TIUPEVNT",25,0)
 S TIUL=0 F TIUK=TIUFRST:1:$S($P(TIUPRM0,U,16)="C":TIUI,1:TIUFRST+1) D
"RTN","TIUPEVNT",26,0)
 . S TIUL=TIUL+1,^TIU(8925.4,+EVNTDA,"HEAD",TIUL,0)=$G(^TIU(8925.2,+BUFDA,"TEXT",TIUK,0))
"RTN","TIUPEVNT",27,0)
 S $P(^TIU(8925.4,+EVNTDA,"HEAD",0),U,3,4)=TIUL_U_TIUL
"RTN","TIUPEVNT",28,0)
 ; ---- Create a new buffer entry w/ uploaded data
"RTN","TIUPEVNT",29,0)
 S NEWBUF=$$MAKEBUF^TIUUPLD
"RTN","TIUPEVNT",30,0)
 I +NEWBUF>0 D
"RTN","TIUPEVNT",31,0)
 . N TIUJ,TIUL,TIUBLIN
"RTN","TIUPEVNT",32,0)
 . S ^TIU(8925.2,+NEWBUF,"TEXT",0)="^^^^"_DT_"^"
"RTN","TIUPEVNT",33,0)
 . S TIUJ=TIUFRST,TIUL=1
"RTN","TIUPEVNT",34,0)
 . S ^TIU(8925.2,+NEWBUF,"TEXT",TIUL,0)=$G(^TIU(8925.2,+BUFDA,"TEXT",TIUJ,0)) K ^TIU(8925.2,+BUFDA,"TEXT",TIUJ,0)
"RTN","TIUPEVNT",35,0)
 . F  S TIUJ=$O(^TIU(8925.2,+BUFDA,"TEXT",TIUJ)) Q:$S(+TIUJ'>0:1,($G(^TIU(8925.2,+BUFDA,"TEXT",TIUJ,0))[TIUHSIG):1,1:0)  D
"RTN","TIUPEVNT",36,0)
 . . S TIUL=TIUL+1
"RTN","TIUPEVNT",37,0)
 . . S ^TIU(8925.2,+NEWBUF,"TEXT",TIUL,0)=$G(^TIU(8925.2,+BUFDA,"TEXT",TIUJ,0)),TIUI=TIUJ
"RTN","TIUPEVNT",38,0)
 . . K ^TIU(8925.2,+BUFDA,"TEXT",TIUJ,0)
"RTN","TIUPEVNT",39,0)
 . S $P(^TIU(8925.2,+NEWBUF,"TEXT",0),U,3,4)=TIUL_U_TIUL
"RTN","TIUPEVNT",40,0)
 . ; ---- Stuff new buffer entry pointer into event log file
"RTN","TIUPEVNT",41,0)
 . S DIE=8925.4,DA=+EVNTDA,DR=".05////"_+NEWBUF D ^DIE
"RTN","TIUPEVNT",42,0)
 . ; ---- File the error log pointer in buffer file
"RTN","TIUPEVNT",43,0)
 . S ^TIU(8925.2,+NEWBUF,"ERR",0)="^8925.22PA^^",DLAYGO=8925.22
"RTN","TIUPEVNT",44,0)
 . S DA(1)=+NEWBUF,DIC="^TIU(8925.2,"_+DA(1)_",""ERR"",",DIC(0)="L"
"RTN","TIUPEVNT",45,0)
 . S X="`"_EVNTDA
"RTN","TIUPEVNT",46,0)
 . D ^DIC
"RTN","TIUPEVNT",47,0)
 . K DIC,DLAYGO
"RTN","TIUPEVNT",48,0)
 . ; ---- Send filing error alerts
"RTN","TIUPEVNT",49,0)
 . D ALERT(+NEWBUF,.ERRMSG,.EVNTDA)
"RTN","TIUPEVNT",50,0)
 Q
"RTN","TIUPEVNT",51,0)
ERRMSG(ETYPE,ECODE,TIUTYPE,FDA,MSG) ; ---- Set error messages
"RTN","TIUPEVNT",52,0)
 N DIC,DIE,DA,X,Y
"RTN","TIUPEVNT",53,0)
 I +ETYPE'>0 S Y="" G ERRMSX
"RTN","TIUPEVNT",54,0)
 S TIUTYPE=$S($G(TIUTITLE)]"":$G(TIUTITLE),1:$G(TIUTYPE))
"RTN","TIUPEVNT",55,0)
 I +$G(TIUREC("FILE"))=8925,($G(TIUHDR(.09))="PRIORITY"),($G(TIUTYPE)]"") S TIUTYPE="STAT "_$G(TIUTYPE)
"RTN","TIUPEVNT",56,0)
 ; ---- Set filing error message
"RTN","TIUPEVNT",57,0)
 I +ETYPE=1,+ECODE D  G ERRMSX
"RTN","TIUPEVNT",58,0)
 . S DIC=8925.3,DIC(0)="MXZ",X="`"_ECODE D ^DIC
"RTN","TIUPEVNT",59,0)
 . S Y="FILING ERROR: "_$G(TIUTYPE)_" "_$P(Y(0),U,2)
"RTN","TIUPEVNT",60,0)
 ; ---- If target file is 8925, get info on entry & set missing fld msg
"RTN","TIUPEVNT",61,0)
 I $G(MSG("DIERR",1,"PARAM","FILE"))=8925 D  G ERRMSX
"RTN","TIUPEVNT",62,0)
 . N TIU,DA S DA=+$O(FDA(8925,"")) D GETTIU^TIULD(.TIU,DA)
"RTN","TIUPEVNT",63,0)
 . S Y=$$NAME^TIULS(TIU("PNM"),"LAST,FI MI ")
"RTN","TIUPEVNT",64,0)
 . S:$G(TIUHDR("TIUTITLE"))]"" TIUTYPE=TIUHDR("TIUTITLE")
"RTN","TIUPEVNT",65,0)
 . S Y=Y_TIU("PID")_": "_$$DATE^TIULS(+TIU("EDT"),"MM/DD/YY ")_$G(TIUTYPE)_" is missing fields."
"RTN","TIUPEVNT",66,0)
 ; ---- Otherwise get message from FM Filer error msg array
"RTN","TIUPEVNT",67,0)
 S Y=$G(MSG("DIERR",1,"TEXT",1))
"RTN","TIUPEVNT",68,0)
ERRMSX Q Y
"RTN","TIUPEVNT",69,0)
ALERT(BUFDA,ERRMSG,EVNTDA) ; ---- Send alerts for filing errors
"RTN","TIUPEVNT",70,0)
 N BUFREC,XQA,XQAID,XQADATA,XQAMSG,XQAKILL,XQAROU,TIUI,TIUSUB,TYPE
"RTN","TIUPEVNT",71,0)
 S BUFREC=$G(^TIU(8925.2,+BUFDA,0))
"RTN","TIUPEVNT",72,0)
 ; ---- TIU*1*81 TIUHDR is newed in MAIN+11^TIUPUTC, set in
"RTN","TIUPEVNT",73,0)
 ;      GETREC^TIUPUTC1, so it exists for file errs.
"RTN","TIUPEVNT",74,0)
 S TYPE=+$$WHATITLE^TIUPUTU($G(TIUHDR("TIUTITLE")))
"RTN","TIUPEVNT",75,0)
 I TYPE'>0 S TYPE=+$G(TIUREC("TYPE"))
"RTN","TIUPEVNT",76,0)
 I TYPE N TIUDAD D WHOGETS^TIUPEVN1(.XQA,TYPE) ;TIU*1*81 New TIUDAD here, not in WHOGETS
"RTN","TIUPEVNT",77,0)
 ;  ---- If no 8925.95 (Document Parameter) recipients, get 8925.99
"RTN","TIUPEVNT",78,0)
 ;       (Site Parameter) recipients
"RTN","TIUPEVNT",79,0)
 I $D(XQA)'>9 D
"RTN","TIUPEVNT",80,0)
 . S TIUI=$O(^TIU(8925.99,"B",+$G(DUZ(2)),0)) S:+TIUI'>0 TIUI=+$O(^TIU(8925.99,0))
"RTN","TIUPEVNT",81,0)
 . S TIUSUB=0 F  S TIUSUB=$O(^TIU(8925.99,+TIUI,2,TIUSUB)) Q:TIUSUB'>0  D
"RTN","TIUPEVNT",82,0)
 . . S XQA($G(^TIU(8925.99,+TIUI,2,TIUSUB,0)))=""
"RTN","TIUPEVNT",83,0)
 Q:$D(XQA)'>9
"RTN","TIUPEVNT",84,0)
 S XQAID="TIUERR"_+BUFDA
"RTN","TIUPEVNT",85,0)
 S XQAMSG=ERRMSG
"RTN","TIUPEVNT",86,0)
 W:'$D(ZTQUEUED) !!,XQAMSG,!
"RTN","TIUPEVNT",87,0)
 S XQADATA=BUFDA_";"_ERRMSG_";"_EVNTDA_";"_$G(TIUREC("TYPE"))
"RTN","TIUPEVNT",88,0)
 S XQAROU="DISPLAY^TIUPEVNT"
"RTN","TIUPEVNT",89,0)
 D SETUP^XQALERT
"RTN","TIUPEVNT",90,0)
 Q
"RTN","TIUPEVNT",91,0)
DISPLAY ; ---- Alert followup action for filing errors
"RTN","TIUPEVNT",92,0)
 N DIC,INQUIRE,RETRY,DWPK,EVNTDA,TIU K XQAKILL,RESCODE,TIUTYPE,TIUDONE
"RTN","TIUPEVNT",93,0)
 N TIUEVNT,TIUSKIP,TIUBUF
"RTN","TIUPEVNT",94,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUPEVNT",95,0)
 ; Set EVNTDA for backward compatibility, TIUEVNT for PN resolve code
"RTN","TIUPEVNT",96,0)
 S (EVNTDA,TIUEVNT)=+$P(XQADATA,";",3)
"RTN","TIUPEVNT",97,0)
 ; Set TIUBUF for similarity w TIURE.  DON'T set BUFDA since
"RTN","TIUPEVNT",98,0)
 ; old code interprets that as set by TIURE only:
"RTN","TIUPEVNT",99,0)
 S TIUBUF=+XQADATA
"RTN","TIUPEVNT",100,0)
 I TIUEVNT D  I +$G(TIUDONE)!$G(TIUSKIP) G DISPX
"RTN","TIUPEVNT",101,0)
 . D WRITEHDR(TIUEVNT)
"RTN","TIUPEVNT",102,0)
 . S TIUTYPE=+$P(XQADATA,";",4)
"RTN","TIUPEVNT",103,0)
 . I TIUTYPE>0 S RESCODE=$$FIXCODE^TIULC1(TIUTYPE)
"RTN","TIUPEVNT",104,0)
 . ;E  S RESCODE="D GETPAT^TIUCHLP"
"RTN","TIUPEVNT",105,0)
 . I $G(RESCODE)]"" D  Q
"RTN","TIUPEVNT",106,0)
 . . W ! S INQUIRE=$$READ^TIUU("YO","Inquire to patient record","YES","^D INQRHELP^TIUPEVNT")
"RTN","TIUPEVNT",107,0)
 . . I $D(DIRUT) S TIUSKIP=1 Q
"RTN","TIUPEVNT",108,0)
 . . I +INQUIRE X RESCODE
"RTN","TIUPEVNT",109,0)
 . . ; Redundant if all RESCODEs do RESOLVE:
"RTN","TIUPEVNT",110,0)
 . . I +$G(TIUDONE),+$G(TIUEVNT) D RESOLVE(+$G(TIUEVNT))
"RTN","TIUPEVNT",111,0)
 . W !!,"Filing error resolution code could not be found for this document type.",!,"Please edit the buffered data directly and refile."
"RTN","TIUPEVNT",112,0)
 W !!,"You may now edit the buffered upload data in an attempt to resolve error:",!,$P(XQADATA,";",2),!
"RTN","TIUPEVNT",113,0)
 I '$$READ^TIUU("EA","Press RETURN to continue and edit the buffer or '^' to exit: ") G DISPX
"RTN","TIUPEVNT",114,0)
 S DIC="^TIU(8925.2,"_TIUBUF_",""TEXT"",",DWPK=1 D EN^DIWE
"RTN","TIUPEVNT",115,0)
 S RETRY=$$READ^TIUU("YO","Now would you like to retry the filer","YES","^D FIL^TIUDIRH")
"RTN","TIUPEVNT",116,0)
 I +RETRY D ALERTDEL(TIUBUF),RESOLVE(TIUEVNT,1),FILE^TIUUPLD(TIUBUF)
"RTN","TIUPEVNT",117,0)
DISPX K XQX1
"RTN","TIUPEVNT",118,0)
 Q
"RTN","TIUPEVNT",119,0)
WRITEHDR(EVNTDA) ; ---- Write header to screen
"RTN","TIUPEVNT",120,0)
 ;Write header, as stored in Upload Log event (NOT buffer record,
"RTN","TIUPEVNT",121,0)
 ;which can be edited w/o refiling)
"RTN","TIUPEVNT",122,0)
 N TIUI
"RTN","TIUPEVNT",123,0)
 S TIUI=0
"RTN","TIUPEVNT",124,0)
 W !!,"The header of the original, failed record looks like this:",!
"RTN","TIUPEVNT",125,0)
 F  S TIUI=$O(^TIU(8925.4,+EVNTDA,"HEAD",TIUI)) Q:+TIUI'>0  D
"RTN","TIUPEVNT",126,0)
 . W !,$G(^TIU(8925.4,+EVNTDA,"HEAD",TIUI,0))
"RTN","TIUPEVNT",127,0)
 Q
"RTN","TIUPEVNT",128,0)
ALERTDEL(DA) ; ---- Delete alerts associated with a given record
"RTN","TIUPEVNT",129,0)
 N XQA,XQAID,XQAKILL S XQAID="TIUERR"_+DA
"RTN","TIUPEVNT",130,0)
 F  D DELETEA^XQALERT S XQAID="TIUERR"_+DA Q:'$D(^VA(200,"AXQAN",XQAID))
"RTN","TIUPEVNT",131,0)
 Q
"RTN","TIUPEVNT",132,0)
RESOLVE(EVNTDA,ECHO) ; ---- Indicate resolution of error
"RTN","TIUPEVNT",133,0)
 N DA,DIE,DR,TIUI,RESTIME,X,Y
"RTN","TIUPEVNT",134,0)
 W:+$G(ECHO) !,"Filing Record/Resolving Error..."
"RTN","TIUPEVNT",135,0)
 S RESTIME=$$NOW^TIULC
"RTN","TIUPEVNT",136,0)
 S DIE="^TIU(8925.4,"
"RTN","TIUPEVNT",137,0)
 S DA=+$G(EVNTDA) Q:+DA'>0
"RTN","TIUPEVNT",138,0)
 ; ---- If already resolved, Quit. (Go on to next record)
"RTN","TIUPEVNT",139,0)
 I +$P(^TIU(8925.4,DA,0),U,6)>0 Q
"RTN","TIUPEVNT",140,0)
 ; ---- Mark error log record as resolved
"RTN","TIUPEVNT",141,0)
 S DR=".05///@;.06////1;.07////"_RESTIME_";1///@"
"RTN","TIUPEVNT",142,0)
 D ^DIE
"RTN","TIUPEVNT",143,0)
 Q
"RTN","TIUPEVNT",144,0)
INQRHELP ; Help for Upload Error Inquire to Patient Record prompt
"RTN","TIUPEVNT",145,0)
 W !,"Do you wish to be prompted for the data necessary to resolve the filing error?"
"RTN","TIUPEVNT",146,0)
 W !,"If not, answer NO to proceed and edit the buffered data directly without"
"RTN","TIUPEVNT",147,0)
 W !,"prompts, or enter '^' to come back and resolve the error later."
"RTN","TIUPEVNT",148,0)
 Q
"RTN","TIUPUTC")
0^38^B28233192
"RTN","TIUPUTC",1,0)
TIUPUTC ; SLC/JER - Document filer - captioned header ;7/1/03
"RTN","TIUPUTC",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,21,81,100,113**;Jun 20, 1997
"RTN","TIUPUTC",3,0)
 ;
"RTN","TIUPUTC",4,0)
MAIN ; ---- Controls branching.
"RTN","TIUPUTC",5,0)
 ;      Attempts to file upload documents in the target file.
"RTN","TIUPUTC",6,0)
 ;      Requires DA = IEN of 8925.2 upload buffer entry.
"RTN","TIUPUTC",7,0)
 N TIUDA,TIUBGN,TIUI,TIUHSIG,TIULIM,TIULCNT,TIULINE,TIUREC,TIUPOST
"RTN","TIUPUTC",8,0)
 N TIUTYPE,TIUINST K ^TMP("TIUPUTC",$J)
"RTN","TIUPUTC",9,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUPUTC",10,0)
 S TIUHSIG=$P(TIUPRM0,U,10),TIUBGN=$P(TIUPRM0,U,12)
"RTN","TIUPUTC",11,0)
 I TIUHSIG']"" D MAIN^TIUPEVNT(DA,1,1) Q
"RTN","TIUPUTC",12,0)
 I TIUBGN']"" D MAIN^TIUPEVNT(DA,1,7) Q
"RTN","TIUPUTC",13,0)
 ; ---- Strip controls when kermit:
"RTN","TIUPUTC",14,0)
 I $P(TIUPRM0,U,17)="k" D PREPROC(DA)
"RTN","TIUPUTC",15,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925.2,+DA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUPUTC",16,0)
 . S TIULINE=$G(^TIU(8925.2,+DA,"TEXT",TIUI,0))
"RTN","TIUPUTC",17,0)
 . I TIULINE[TIUHSIG D  Q
"RTN","TIUPUTC",18,0)
 . . ; ---- Hdr signal line.  GETREC^TIUPUTC1 resets TIUI to $TXT line:
"RTN","TIUPUTC",19,0)
 . . N TIUHDR,TIUFRST,TIUJ S TIUFRST=TIUI
"RTN","TIUPUTC",20,0)
 . . ; ---- If after first hdr signal, finish previous docmt
"RTN","TIUPUTC",21,0)
 . . ;      before going on w/ current docmt:
"RTN","TIUPUTC",22,0)
 . . I +$G(TIULCNT),$D(TIUREC("TROOT")),$D(@(TIUREC("TROOT")_"0)")) D FINISH
"RTN","TIUPUTC",23,0)
 . . K TIUREC D GETREC^TIUPUTC1(TIULINE,.TIUREC,.TIUHDR)
"RTN","TIUPUTC",24,0)
 . . I +$G(TIUREC("#"))'>0!($G(TIUREC("ROOT"))']"") Q
"RTN","TIUPUTC",25,0)
 . . D STUFREC(.TIUHDR,.TIUREC)
"RTN","TIUPUTC",26,0)
 . . S TIUREC("TROOT")=TIUREC("ROOT")_TIUREC("#")_","_TIUREC("TEXT")_","
"RTN","TIUPUTC",27,0)
 . . S:'$D(@(TIUREC("TROOT")_"0)")) @(TIUREC("TROOT")_"0)")="^^^^^"
"RTN","TIUPUTC",28,0)
 . . S TIULCNT=+$P(@(TIUREC("TROOT")_"0)"),U,4)
"RTN","TIUPUTC",29,0)
 . . F TIUJ=TIUFRST:1:TIUI D
"RTN","TIUPUTC",30,0)
 . . . ; ---- Delete header lines from buffer once filed;
"RTN","TIUPUTC",31,0)
 . . . ;      (TIUI was reset in GETREC^TIUPUTC1 to $TXT line):
"RTN","TIUPUTC",32,0)
 . . . K ^TIU(8925.2,+DA,"TEXT",TIUJ,0)
"RTN","TIUPUTC",33,0)
 . . I TIUREC("FILE")=8925,+$G(TIUREC("#")),+$G(TIUREC("BOILON")) D BOILRPLT(.TIUREC)
"RTN","TIUPUTC",34,0)
 . I TIULINE'[TIUHSIG,(TIULINE'[TIUBGN),(+$G(TIUREC("FILE"))=8925),+$G(TIUREC("BOILON")) D
"RTN","TIUPUTC",35,0)
 . . I TIULINE]"",$D(^TIU(8925.1,"B",$P(TIULINE,":"))) D  I 1
"RTN","TIUPUTC",36,0)
 . . . S TIULCNT=$$LOCATE(TIULINE,TIUREC("#"))
"RTN","TIUPUTC",37,0)
 . . E  S TIULCNT=+$G(TIULCNT)+.01
"RTN","TIUPUTC",38,0)
 . . S ^TIU(8925,+TIUREC("#"),"TEMP",TIULCNT,0)=TIULINE
"RTN","TIUPUTC",39,0)
 . . ; ---- Delete text line from buffer once xferred:
"RTN","TIUPUTC",40,0)
 . . K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",41,0)
 . I TIULINE'[TIUHSIG,(TIULINE'[TIUBGN),$D(TIUREC("TROOT")),$D(@(TIUREC("TROOT")_"0)")),(+$G(TIUREC("BOILON"))'>0) D
"RTN","TIUPUTC",42,0)
 . . S TIULCNT=+$G(TIULCNT)+1,@(TIUREC("TROOT")_TIULCNT_",0)")=TIULINE
"RTN","TIUPUTC",43,0)
 . . ; ---- Delete text line once xferred:
"RTN","TIUPUTC",44,0)
 . . K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",45,0)
 . . ; ---- Remove leading buffer garbage
"RTN","TIUPUTC",46,0)
 . I TIULINE'[TIUHSIG,(TIULINE'[TIUBGN),'$D(TIUREC("TROOT")),($G(TIUREC("#"))'=-1) K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",47,0)
 . I TIULINE[TIUBGN K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",48,0)
 ; ---- Finish last docmt in buffer file:
"RTN","TIUPUTC",49,0)
 I +$G(TIULCNT),$D(TIUREC("TROOT")),$D(@(TIUREC("TROOT")_"0)")) D FINISH
"RTN","TIUPUTC",50,0)
 I '+$O(^TIU(8925.2,+DA,"TEXT",0)) D BUFPURGE(DA)
"RTN","TIUPUTC",51,0)
 ; ---- Write upload results:
"RTN","TIUPUTC",52,0)
 I '$D(ZTQUEUED),$D(^TMP("TIUPUTC",$J)) D
"RTN","TIUPUTC",53,0)
 . W !!,"TOTALS FOR CURRENT BATCH:",!
"RTN","TIUPUTC",54,0)
 . W !?14,"TOTAL Document(s) RECEIVED: ",$J((+$G(^TMP("TIUPUTC",$J,"SUCC"))+$G(^("MISS"))+$G(^("FAIL"))),5),!
"RTN","TIUPUTC",55,0)
 . W !?18," Document(s) NOT FILED: ",$J(+$G(^TMP("TIUPUTC",$J,"FAIL")),5)
"RTN","TIUPUTC",56,0)
 . W !?3,"Document(s) FILED with MISSING FIELDS: ",$J(+$G(^TMP("TIUPUTC",$J,"MISS")),5),!
"RTN","TIUPUTC",57,0)
 K ^TMP("TIUPUTC",$J)
"RTN","TIUPUTC",58,0)
 Q
"RTN","TIUPUTC",59,0)
LOCATE(LINE,REC) ; ---- Locate line in boilerplate text
"RTN","TIUPUTC",60,0)
 N TIUJ,HIT,BTXT S (TIUJ,HIT)=0
"RTN","TIUPUTC",61,0)
 F  Q:+HIT  S TIUJ=$O(^TIU(8925,+REC,"TEMP",TIUJ)) Q:+TIUJ'>0!HIT  D
"RTN","TIUPUTC",62,0)
 . S BTXT=$G(^TIU(8925,+REC,"TEMP",TIUJ,0))
"RTN","TIUPUTC",63,0)
 . I BTXT[$P(LINE,":")_":" S HIT=1
"RTN","TIUPUTC",64,0)
 Q +$G(TIUJ)
"RTN","TIUPUTC",65,0)
 ;
"RTN","TIUPUTC",66,0)
STUFREC(HEADER,RECORD) ; ---- Stuffs record with known fixed fields;
"RTN","TIUPUTC",67,0)
 ;                      Checks for missing fields.
"RTN","TIUPUTC",68,0)
 N FDA,FDARR,IENS,FLAGS,TIUI,TIUMSG,TIUPC
"RTN","TIUPUTC",69,0)
 S IENS=""""_+RECORD("#")_","""
"RTN","TIUPUTC",70,0)
 S FDARR="FDA("_+RECORD("FILE")_","_IENS_")",FLAGS="KE"
"RTN","TIUPUTC",71,0)
 ; ---- Set up FDA Array:
"RTN","TIUPUTC",72,0)
 S TIUI=0
"RTN","TIUPUTC",73,0)
 F  S TIUI=$O(HEADER(TIUI)) Q:+TIUI'>0  D
"RTN","TIUPUTC",74,0)
 . S:TIUI'=.001 @FDARR@(TIUI)=$$TRNSFRM^TIULX(.RECORD,TIUI,HEADER(TIUI))
"RTN","TIUPUTC",75,0)
 I $D(FDA) D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTC",76,0)
 I $D(TIUMSG) D
"RTN","TIUPUTC",77,0)
 . ; ---- If FILE^DIC fails, log 8925.4 error w/ hdr info.  Create new
"RTN","TIUPUTC",78,0)
 . ;      8925.2 buffer entry with hdr, text, & 8925.4 log #.
"RTN","TIUPUTC",79,0)
 . ;      Kill most of old buffer. Send missing field alerts:
"RTN","TIUPUTC",80,0)
 . D MAIN^TIUPEVNT(DA,2,"",$P($G(^TIU(8925.1,+RECORD("TYPE"),0)),U),.FDA,.TIUMSG)
"RTN","TIUPUTC",81,0)
 . S ^TMP("TIUPUTC",$J,"MISS")=+$G(^TMP("TIUPUTC",$J,"MISS"))+1
"RTN","TIUPUTC",82,0)
 I '$D(TIUMSG) D
"RTN","TIUPUTC",83,0)
 . S ^TMP("TIUPUTC",$J,"SUCC")=+$G(^TMP("TIUPUTC",$J,"SUCC"))+1
"RTN","TIUPUTC",84,0)
 Q
"RTN","TIUPUTC",85,0)
BOILRPLT(TIUREC) ; ---- Execute/Interleave Boilerplates w/uploaded text
"RTN","TIUPUTC",86,0)
 N TIU
"RTN","TIUPUTC",87,0)
 D GETTIU^TIULD(.TIU,TIUREC("#"))
"RTN","TIUPUTC",88,0)
 D LOADDFLT^TIUEDI4(TIUREC("#"),TIUREC("TYPE")) ;100
"RTN","TIUPUTC",89,0)
 Q
"RTN","TIUPUTC",90,0)
SETROOT(LINECNT,RECORD) ; ---- Sets root of WP field
"RTN","TIUPUTC",91,0)
 S @(RECORD("TROOT")_"0)")="^^"_LINECNT_"^"_LINECNT_"^"_DT_"^^"
"RTN","TIUPUTC",92,0)
 Q
"RTN","TIUPUTC",93,0)
BUFPURGE(DA) ; ---- Call ^DIK to purge buffer record when all's well
"RTN","TIUPUTC",94,0)
 N DIK S DIK="^TIU(8925.2," D ^DIK
"RTN","TIUPUTC",95,0)
 Q
"RTN","TIUPUTC",96,0)
PREPROC(DA) ; ---- Strip controls & white space from headers
"RTN","TIUPUTC",97,0)
 N TIUI,TIUHLIN,X S (TIUI,TIUHLIN)=0
"RTN","TIUPUTC",98,0)
 F  S TIUI=$O(^TIU(8925.2,+DA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUPUTC",99,0)
 . S X=$G(^TIU(8925.2,+DA,"TEXT",TIUI,0))
"RTN","TIUPUTC",100,0)
 . S:X[TIUHSIG TIUHLIN=1 S:X[TIUBGN TIUHLIN=0
"RTN","TIUPUTC",101,0)
 . S:TIUHLIN ^TIU(8925.2,+DA,"TEXT",TIUI,0)=$$STRIP^TIULS(X)
"RTN","TIUPUTC",102,0)
 Q
"RTN","TIUPUTC",103,0)
DADTYPE(DA) ; ---- Get type of original document for addenda
"RTN","TIUPUTC",104,0)
 N TIUDAD,Y
"RTN","TIUPUTC",105,0)
 S TIUDAD=$P($G(^TIU(8925,DA,0)),U,6)
"RTN","TIUPUTC",106,0)
 S Y=+$G(^TIU(8925,+TIUDAD,0))
"RTN","TIUPUTC",107,0)
 Q Y
"RTN","TIUPUTC",108,0)
 ;
"RTN","TIUPUTC",109,0)
FINISH ; ---- Finish document: feedback, postfile code, merge boil,
"RTN","TIUPUTC",110,0)
 ;      log file event
"RTN","TIUPUTC",111,0)
 N ISADDNDM S ISADDNDM=0
"RTN","TIUPUTC",112,0)
 D SETROOT(TIULCNT,.TIUREC)
"RTN","TIUPUTC",113,0)
 S ISADDNDM=+$$ISADDNDM^TIULC1(TIUREC("#"))
"RTN","TIUPUTC",114,0)
 S TIUTYPE=$S(ISADDNDM:+$$DADTYPE(TIUREC("#")),1:TIUREC("TYPE"))
"RTN","TIUPUTC",115,0)
 I '$D(ZTQUEUED) W !,">>> ",$S(ISADDNDM:"Addendum",1:"Document")," Filed Successfully.",! ;TIU*1*81
"RTN","TIUPUTC",116,0)
 ; ---- TIU*1*81 Tell error handler that retrying filer was successful:
"RTN","TIUPUTC",117,0)
 S TIUDONE=1
"RTN","TIUPUTC",118,0)
 S TIUTYPE=$S(+$$ISADDNDM^TIULC1(TIUREC("#")):+$$DADTYPE(TIUREC("#")),1:TIUREC("TYPE"))
"RTN","TIUPUTC",119,0)
 S TIUPOST=$$POSTFILE^TIULC1(TIUTYPE)
"RTN","TIUPUTC",120,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPUTC",121,0)
 I TIUREC("FILE")=8925,+$G(TIUREC("BOILON")) D
"RTN","TIUPUTC",122,0)
 . N TIU D GETTIU^TIULD(.TIU,TIUREC("#"))
"RTN","TIUPUTC",123,0)
 . D MERGTEXT^TIUEDI1(TIUREC("#"),.TIU)
"RTN","TIUPUTC",124,0)
 . K ^TIU(8925,+TIUREC("#"),"TEMP")
"RTN","TIUPUTC",125,0)
 D MAIN^TIUPEVNT(DA,0,"",$P($G(^TIU(8925.1,+TIUREC("TYPE"),0)),U))
"RTN","TIUPUTC",126,0)
 Q
"RTN","TIUPUTC",127,0)
 ;
"RTN","TIUPUTCN")
0^12^B29625276
"RTN","TIUPUTCN",1,0)
TIUPUTCN ; SLC/JER -  Uploading Consult Results ;4/18/03
"RTN","TIUPUTCN",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**4,100,120,131,113**;Jun 20, 1997
"RTN","TIUPUTCN",3,0)
 ; External References in TIUPUTCN:
"RTN","TIUPUTCN",4,0)
 ;   DBIA 3472  $$CPPAT^GMRCCP
"RTN","TIUPUTCN",5,0)
LOOKUP ; Lookup Method for Consults document definition
"RTN","TIUPUTCN",6,0)
 ; Required: TIUSSN, TIUVDT,TIUCNNBR
"RTN","TIUPUTCN",7,0)
 N DA,DFN,TIU,TIUDAD,TIUDPRM,TIUEDIT,TIUEDT,TIULDT,TIUXCRP,TIUTYPE,TIUNEW
"RTN","TIUPUTCN",8,0)
 I $S('$D(TIUSSN):1,'$D(TIUVDT):1,$G(TIUSSN)?4N:1,$G(TIUSSN)']"":1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTCN",9,0)
 I TIUSSN?3N1P2N1P4N.E S TIUSSN=$TR(TIUSSN,"-/","")
"RTN","TIUPUTCN",10,0)
 I TIUSSN["?" S Y=-1 G LOOKUPX
"RTN","TIUPUTCN",11,0)
 I $G(TIUCNNBR)']"" S Y=-1 G LOOKUPX
"RTN","TIUPUTCN",12,0)
 S TIULOC=+$$ILOC(TIULOC)
"RTN","TIUPUTCN",13,0)
 I '$D(^SC(+$G(TIULOC),0)) S Y=-1 G LOOKUPX
"RTN","TIUPUTCN",14,0)
 S TIUINST=+$$DIVISION^TIULC1(TIULOC)
"RTN","TIUPUTCN",15,0)
 S TIUEDT=$$IDATE^TIULC(TIUVDT),TIULDT=$$FMADD^XLFDT(TIUEDT,1)
"RTN","TIUPUTCN",16,0)
 I +TIUEDT'>0 S Y=-1 Q
"RTN","TIUPUTCN",17,0)
 S TIUTYPE=$$WHATITLE(TIUTITLE)
"RTN","TIUPUTCN",18,0)
 I +TIUTYPE'>0 S Y=-1 Q
"RTN","TIUPUTCN",19,0)
 I $P($G(^SC(+TIULOC,0)),U,3)="W" D  I 1
"RTN","TIUPUTCN",20,0)
 . D MAIN^TIUMOVE(.TIU,.DFN,TIUSSN,TIUEDT,TIULDT,1,"LAST",0,TIULOC)
"RTN","TIUPUTCN",21,0)
 E  D MAIN^TIUVSIT(.TIU,.DFN,TIUSSN,TIUEDT,TIULDT,"LAST",0,TIULOC)
"RTN","TIUPUTCN",22,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTCN",23,0)
 I $P(+$G(TIU("EDT")),".")'=$P($$IDATE^TIULC(TIUVDT),".") S Y=-1 G LOOKUPX
"RTN","TIUPUTCN",24,0)
 ; Confirm that patient from transcribed Consult Request Number matches
"RTN","TIUPUTCN",25,0)
 ;pt from transcribed SSN:
"RTN","TIUPUTCN",26,0)
 I '$$CPPAT^GMRCCP(TIUCNNBR,DFN) S Y=-1 G LOOKUPX ; TIU*1*131
"RTN","TIUPUTCN",27,0)
 D DOCPRM^TIULC1(TIUTYPE,.TIUDPRM)
"RTN","TIUPUTCN",28,0)
 S TIUTYP(1)=1_U_TIUTYPE_U_$$PNAME^TIULC1(TIUTYPE)
"RTN","TIUPUTCN",29,0)
 S Y=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM)
"RTN","TIUPUTCN",30,0)
 I +Y'>0 G LOOKUPX
"RTN","TIUPUTCN",31,0)
 ; If record is not new, is not yet released, then delete
"RTN","TIUPUTCN",32,0)
 ;existing text to prepare for replacement:
"RTN","TIUPUTCN",33,0)
 I +$G(TIUNEW)'>0 D
"RTN","TIUPUTCN",34,0)
 . S TIUEDIT=$$CANEDIT(+Y)
"RTN","TIUPUTCN",35,0)
 . I +TIUEDIT>0,$D(^TIU(8925,+Y,"TEXT")) D DELTEXT(+Y)
"RTN","TIUPUTCN",36,0)
 . ; If already released, then make an addendum:
"RTN","TIUPUTCN",37,0)
 . I +TIUEDIT'>0 S TIUDAD=+Y,Y=$$MAKEADD
"RTN","TIUPUTCN",38,0)
 I +Y'>0 Q
"RTN","TIUPUTCN",39,0)
 ; Stuff transcribed look-up data, etc.: 
"RTN","TIUPUTCN",40,0)
 D STUFREC(Y,+$G(TIUDAD))
"RTN","TIUPUTCN",41,0)
 I +$G(TIUDAD) D SENDADD^TIUALRT(+Y)
"RTN","TIUPUTCN",42,0)
 ; Prevent STUFREC^TIUPUTC from overwriting unneeded fields with
"RTN","TIUPUTCN",43,0)
 ;possibly erroneous transcribed data:
"RTN","TIUPUTCN",44,0)
 K TIUHDR(.01),TIUHDR(.07),TIUHDR(1301)
"RTN","TIUPUTCN",45,0)
LOOKUPX Q
"RTN","TIUPUTCN",46,0)
ILOC(LOCATION) ; Get pointer to file 44
"RTN","TIUPUTCN",47,0)
 N DIC,X,Y
"RTN","TIUPUTCN",48,0)
 S DIC=44,DIC(0)="M",X=LOCATION D ^DIC
"RTN","TIUPUTCN",49,0)
 Q Y
"RTN","TIUPUTCN",50,0)
CANEDIT(DA) ; Check if document is not released yet
"RTN","TIUPUTCN",51,0)
 Q $S(+$P($G(^TIU(8925,+DA,0)),U,5)<4:1,1:0) ;TIU*1*131
"RTN","TIUPUTCN",52,0)
MAKEADD() ; Create an addendum record
"RTN","TIUPUTCN",53,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTCN",54,0)
 ; Get 8925.1 IEN for title "ADDENDUM"; DON'T require it to be consult
"RTN","TIUPUTCN",55,0)
 S TIUATYP=+$$WHATITLE^TIUPUTU("ADDENDUM")
"RTN","TIUPUTCN",56,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUPUTCN",57,0)
 D ^DIC
"RTN","TIUPUTCN",58,0)
 S DA=+Y
"RTN","TIUPUTCN",59,0)
 I +DA>0 S DIE=DIC,DR=".04////"_$$DOCCLASS^TIULC1(TIUATYP) D ^DIE
"RTN","TIUPUTCN",60,0)
 K TIUHDR(.01)
"RTN","TIUPUTCN",61,0)
 Q +DA
"RTN","TIUPUTCN",62,0)
STUFREC(DA,PARENT) ; Stuff look-up header data, etc.
"RTN","TIUPUTCN",63,0)
 ; Stuff look-up data, data derived from look-up data, and all other
"RTN","TIUPUTCN",64,0)
 ;necessary, known, nontranscribed data: pt, visit, visit-derived data,
"RTN","TIUPUTCN",65,0)
 ;entry dt/tm, ref date, capture meth, status (unreleased).
"RTN","TIUPUTCN",66,0)
 ; (Remaining transcribed header data is generically stuffed later
"RTN","TIUPUTCN",67,0)
 ;in MAIN^TIUPUTC, along with transcribed report text.)
"RTN","TIUPUTCN",68,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG
"RTN","TIUPUTCN",69,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTCN",70,0)
 I +$G(PARENT)'>0 D
"RTN","TIUPUTCN",71,0)
 . S @FDARR@(.02)=$G(DFN),@FDARR@(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUPUTCN",72,0)
 . S @FDARR@(.05)=3
"RTN","TIUPUTCN",73,0)
 . S @FDARR@(.07)=$P($G(TIU("EDT")),U)
"RTN","TIUPUTCN",74,0)
 . S @FDARR@(.08)=$P($G(TIU("LDT")),U)
"RTN","TIUPUTCN",75,0)
 . S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTCN",76,0)
 . S @FDARR@(1205)=$S(+$P($G(TIU("LOC")),U):$P($G(TIU("LOC")),U),1:$P($G(TIU("VLOC")),U))
"RTN","TIUPUTCN",77,0)
 . ;S @FDARR@(1211)=$P($G(TIU("VLOC")),U)
"RTN","TIUPUTCN",78,0)
 . S @FDARR@(1404)=$P($G(TIU("SVC")),U)
"RTN","TIUPUTCN",79,0)
 I +$G(PARENT)>0 D
"RTN","TIUPUTCN",80,0)
 . S @FDARR@(.02)=+$P($G(^TIU(8925,+PARENT,0)),U,2)
"RTN","TIUPUTCN",81,0)
 . S @FDARR@(.03)=+$P($G(^TIU(8925,+PARENT,0)),U,3),@FDARR@(.05)=3
"RTN","TIUPUTCN",82,0)
 . S @FDARR@(.06)=PARENT
"RTN","TIUPUTCN",83,0)
 . S @FDARR@(.07)=$P($G(^TIU(8925,+PARENT,0)),U,7)
"RTN","TIUPUTCN",84,0)
 . S @FDARR@(.08)=$P($G(^TIU(8925,+PARENT,0)),U,8)
"RTN","TIUPUTCN",85,0)
 . S @FDARR@(1205)=$P($G(^TIU(8925,+PARENT,12)),U,5)
"RTN","TIUPUTCN",86,0)
 . S @FDARR@(1404)=$P($G(^TIU(8925,+PARENT,14)),U,4)
"RTN","TIUPUTCN",87,0)
 . S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTCN",88,0)
 S @FDARR@(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUPUTCN",89,0)
 S @FDARR@(1212)=$P($G(TIU("INST")),U)
"RTN","TIUPUTCN",90,0)
 S @FDARR@(1301)=$S($G(TIUDDT)]"":$$IDATE^TIULC($G(TIUDDT)),1:"")
"RTN","TIUPUTCN",91,0)
 I @FDARR@(1301)'>0 S @FDARR@(1301)=$G(@FDARR@(.07))
"RTN","TIUPUTCN",92,0)
 S @FDARR@(1303)="U"
"RTN","TIUPUTCN",93,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPUTCN",94,0)
 Q
"RTN","TIUPUTCN",95,0)
DELTEXT(DA) ; Delete existing text in preparation for replacement
"RTN","TIUPUTCN",96,0)
 N DIE,DR,X,Y
"RTN","TIUPUTCN",97,0)
 S DIE=8925,DR="2///@" D ^DIE
"RTN","TIUPUTCN",98,0)
 Q
"RTN","TIUPUTCN",99,0)
WHATYPE(X) ; Identify document type
"RTN","TIUPUTCN",100,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTCN",101,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTCN",102,0)
 N DIC,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTCN",103,0)
 S DIC=8925.1,DIC(0)="M"
"RTN","TIUPUTCN",104,0)
 S DIC("S")="I +$O(^TIU(8925.1,+Y,""HEAD"",0))!+$O(^TIU(8295.1,+Y,""ITEM"",0))"
"RTN","TIUPUTCN",105,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTCN",106,0)
WHATYPX Q Y
"RTN","TIUPUTCN",107,0)
WHATITLE(X) ; Identify document title
"RTN","TIUPUTCN",108,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTCN",109,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTCN",110,0)
 N DIC,Y,TIUFPRIV,SCREEN,TIUCLASS S TIUFPRIV=1
"RTN","TIUPUTCN",111,0)
 S DIC=8925.1,DIC(0)="M",TIUCLASS=+$$CLASS^TIUCNSLT
"RTN","TIUPUTCN",112,0)
 S SCREEN="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"",+$$ISA^TIULX(+Y,"_TIUCLASS_"),+$$CANPICK^TIULP(+Y)"
"RTN","TIUPUTCN",113,0)
 S DIC("S")=SCREEN
"RTN","TIUPUTCN",114,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTCN",115,0)
WHATITX Q Y
"RTN","TIUPUTCN",116,0)
FOLLOWUP(TIUDA) ; Post-filing code for CONSULTS
"RTN","TIUPUTCN",117,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIU,DFN
"RTN","TIUPUTCN",118,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTCN",119,0)
 S @FDARR@(1204)=$$WHOSIGNS^TIULC1(TIUDA)
"RTN","TIUPUTCN",120,0)
 I +$P($G(^TIU(8925,TIUDA,12)),U,9),'+$P($G(^(12)),U,8) D
"RTN","TIUPUTCN",121,0)
 . S @FDARR@(1208)=$$WHOCOSIG^TIULC1(TIUDA)
"RTN","TIUPUTCN",122,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTCN",123,0)
 I +$P($G(^TIU(8925,+TIUDA,12)),U,8),(+$P($G(^TIU(8925,+TIUDA,12)),U,4)'=+$P($G(^(12)),U,8)) D
"RTN","TIUPUTCN",124,0)
 . S @FDARR@(1506)=1 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTCN",125,0)
 D RELEASE^TIUT(TIUDA,1)
"RTN","TIUPUTCN",126,0)
 D AUDIT^TIUEDI1(TIUDA,0,$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")"))
"RTN","TIUPUTCN",127,0)
 I +$P($G(^TIU(8925,+TIUDA,14)),U,5) D
"RTN","TIUPUTCN",128,0)
 . N TIUCDA,DA S TIUCDA=+$P($G(^TIU(8925,+TIUDA,14)),U,5)
"RTN","TIUPUTCN",129,0)
 . W !,$$PNAME^TIULC1(+$G(^TIU(8925,+TIUDA,0)))," #: ",TIUDA
"RTN","TIUPUTCN",130,0)
 . W " now Linked to Consult Request #: ",TIUCDA,".",!
"RTN","TIUPUTCN",131,0)
 . ; Post result in CT Pkg
"RTN","TIUPUTCN",132,0)
 . D GET^GMRCTIU(TIUCDA,TIUDA,"INCOMPLETE RPT")
"RTN","TIUPUTCN",133,0)
 I '$D(TIU("VSTR")) D
"RTN","TIUPUTCN",134,0)
 . N TIUD0,TIUD12,TIUVLOC,TIUHLOC,TIUEDT,TIULDT
"RTN","TIUPUTCN",135,0)
 . S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12))
"RTN","TIUPUTCN",136,0)
 . S DFN=+$P(TIUD0,U,2),TIUEDT=+$P(TIUD0,U,7)
"RTN","TIUPUTCN",137,0)
 . S TIULDT=$$FMADD^XLFDT(TIUEDT,1),TIUHLOC=+$P(TIUD12,U,5)
"RTN","TIUPUTCN",138,0)
 . S TIUVLOC=$S(+$P(TIUD12,U,11):+$P(TIUD12,U,11),1:+TIUHLOC)
"RTN","TIUPUTCN",139,0)
 . I $S(+DFN'>0:1,+TIUEDT'>0:1,+TIULDT'>0:1,+TIUVLOC'>0:1,1:0) Q
"RTN","TIUPUTCN",140,0)
 . D MAIN^TIUVSIT(.TIU,DFN,"",TIUEDT,TIULDT,"LAST",0,+TIUVLOC)
"RTN","TIUPUTCN",141,0)
 Q:'$D(TIU("VSTR"))
"RTN","TIUPUTCN",142,0)
 D QUE^TIUPXAP1 ; Get/file VISIT
"RTN","TIUPUTCN",143,0)
 Q
"RTN","TIUPUTCP")
0^36^B70011947
"RTN","TIUPUTCP",1,0)
TIUPUTCP ; SLC/JER,RMO - CP Look-up Method ;4/18/03
"RTN","TIUPUTCP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**109,113**;Jun 20, 1997
"RTN","TIUPUTCP",3,0)
 ; This routine is a modified version of TIUPUTCN
"RTN","TIUPUTCP",4,0)
LOOKUP ; Look-up code used by router/filer
"RTN","TIUPUTCP",5,0)
 ; Required: TIUSSN, TIUVDT, TIUCNNBR
"RTN","TIUPUTCP",6,0)
 N DA,DFN,TIU,TIUDAD,TIUDPRM,TIUEDIT,TIUEDT,TIULDT,TIUXCRP,TIUTYPE,TIUNEW,TIUDNB
"RTN","TIUPUTCP",7,0)
 I $S('$D(TIUSSN):1,'$D(TIUVDT):1,$G(TIUSSN)?4N:1,$G(TIUSSN)']"":1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTCP",8,0)
 I TIUSSN?3N1P2N1P4N.E S TIUSSN=$TR(TIUSSN,"-/","")
"RTN","TIUPUTCP",9,0)
 I TIUSSN["?" S Y=-1 G LOOKUPX
"RTN","TIUPUTCP",10,0)
 S TIULOC=+$$ILOC(TIULOC)
"RTN","TIUPUTCP",11,0)
 I '$D(^SC(+$G(TIULOC),0)) S Y=-1 G LOOKUPX
"RTN","TIUPUTCP",12,0)
 S TIUINST=+$$DIVISION^TIULC1(TIULOC)
"RTN","TIUPUTCP",13,0)
 S TIUEDT=$$IDATE^TIULC(TIUVDT),TIULDT=$$FMADD^XLFDT(TIUEDT,1)
"RTN","TIUPUTCP",14,0)
 I +TIUEDT'>0 S Y=-1 Q
"RTN","TIUPUTCP",15,0)
 S TIUTYPE=$$WHATITLE(TIUTITLE)
"RTN","TIUPUTCP",16,0)
 I +TIUTYPE'>0 S Y=-1 Q
"RTN","TIUPUTCP",17,0)
 I $P($G(^SC(+TIULOC,0)),U,3)="W" D  I 1
"RTN","TIUPUTCP",18,0)
 . D MAIN^TIUMOVE(.TIU,.DFN,TIUSSN,TIUEDT,TIULDT,1,"LAST",0,TIULOC)
"RTN","TIUPUTCP",19,0)
 E  D MAIN^TIUVSIT(.TIU,.DFN,TIUSSN,TIUEDT,TIULDT,"LAST",0,TIULOC)
"RTN","TIUPUTCP",20,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTCP",21,0)
 I $P(+$G(TIU("EDT")),".")'=$P($$IDATE^TIULC(TIUVDT),".") S Y=-1 G LOOKUPX
"RTN","TIUPUTCP",22,0)
 D DOCPRM^TIULC1(TIUTYPE,.TIUDPRM)
"RTN","TIUPUTCP",23,0)
 ;
"RTN","TIUPUTCP",24,0)
 ;Check consult associated with document
"RTN","TIUPUTCP",25,0)
 I '$$CHKCN($G(TIUCNNBR),DFN,$G(TIUPLDA),.TIUDNB) S Y=-1 G LOOKUPX
"RTN","TIUPUTCP",26,0)
 ;
"RTN","TIUPUTCP",27,0)
 ;Check status of consult as it relates to CP
"RTN","TIUPUTCP",28,0)
 I '$$CHKCP($G(TIUCNNBR),$G(TIUPLDA),.TIUDNB) S Y=-1 G LOOKUPX
"RTN","TIUPUTCP",29,0)
 S TIUTYP(1)=1_U_TIUTYPE_U_$$PNAME^TIULC1(TIUTYPE)
"RTN","TIUPUTCP",30,0)
 ;
"RTN","TIUPUTCP",31,0)
 ;If TIU document IEN is defined use it, otherwise call TIUEDI3
"RTN","TIUPUTCP",32,0)
 I $G(TIUPLDA)>0 D
"RTN","TIUPUTCP",33,0)
 . S Y=TIUPLDA
"RTN","TIUPUTCP",34,0)
 ELSE  D
"RTN","TIUPUTCP",35,0)
 . S Y=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM)
"RTN","TIUPUTCP",36,0)
 I +Y'>0 G LOOKUPX
"RTN","TIUPUTCP",37,0)
 ; If record is not new, has text and can be edited, then replace
"RTN","TIUPUTCP",38,0)
 ; existing text
"RTN","TIUPUTCP",39,0)
 I +$G(TIUNEW)'>0 D
"RTN","TIUPUTCP",40,0)
 . S TIUEDIT=$$CANEDIT(+Y)
"RTN","TIUPUTCP",41,0)
 . I +TIUEDIT>0,$D(^TIU(8925,+Y,"TEXT")) D DELTEXT(+Y)
"RTN","TIUPUTCP",42,0)
 . I +TIUEDIT'>0 S TIUDAD=+Y,Y=$$MAKEADD
"RTN","TIUPUTCP",43,0)
 I +Y'>0 Q
"RTN","TIUPUTCP",44,0)
 D STUFREC(Y,+$G(TIUDAD))
"RTN","TIUPUTCP",45,0)
 I +$G(TIUDAD) D SENDADD^TIUALRT(+Y)
"RTN","TIUPUTCP",46,0)
 ;Kill elements of TIUHDR so data is not filed twice
"RTN","TIUPUTCP",47,0)
 K TIUHDR(.01),TIUHDR(.07),TIUHDR(1301)
"RTN","TIUPUTCP",48,0)
 K TIUHDR(.001),TIUHDR(70201),TIUHDR(70202)
"RTN","TIUPUTCP",49,0)
LOOKUPX Q
"RTN","TIUPUTCP",50,0)
ILOC(LOCATION) ; Get pointer to file 44
"RTN","TIUPUTCP",51,0)
 N DIC,X,Y
"RTN","TIUPUTCP",52,0)
 S DIC=44,DIC(0)="M",X=LOCATION D ^DIC
"RTN","TIUPUTCP",53,0)
 Q Y
"RTN","TIUPUTCP",54,0)
CANEDIT(DA) ; Check if document is not released yet
"RTN","TIUPUTCP",55,0)
 Q $S(+$P($G(^TIU(8925,+DA,0)),U,5)<4:1,1:0) ;TIU*1*131
"RTN","TIUPUTCP",56,0)
 ;
"RTN","TIUPUTCP",57,0)
CHKCN(TIUCDA,DFN,TIUDA,TIUDNB) ;Check if Consult is associated with correct patient
"RTN","TIUPUTCP",58,0)
 ;and document
"RTN","TIUPUTCP",59,0)
 ; Input  -- TIUCDA   Request/Consult file (#123) IEN
"RTN","TIUPUTCP",60,0)
 ;           DFN      Patient file (#2) IEN
"RTN","TIUPUTCP",61,0)
 ;           TIUDA    TIU Document file (#8925) IEN  (Optional)
"RTN","TIUPUTCP",62,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIUPUTCP",63,0)
 ;           TIUDNB   Dialogue Number for Error Message  (Optional)
"RTN","TIUPUTCP",64,0)
 N OKF
"RTN","TIUPUTCP",65,0)
 ;
"RTN","TIUPUTCP",66,0)
 I $G(TIUCDA)']"" S TIUDNB=89250009 G CHKCNQ
"RTN","TIUPUTCP",67,0)
 ;
"RTN","TIUPUTCP",68,0)
 ;Check if the patient is associated with the consult
"RTN","TIUPUTCP",69,0)
 I '$$CPPAT^GMRCCP(TIUCDA,DFN) S TIUDNB=89250006 G CHKCNQ
"RTN","TIUPUTCP",70,0)
 ;
"RTN","TIUPUTCP",71,0)
 ;Check 0th node and consult if document IEN is defined
"RTN","TIUPUTCP",72,0)
 I $G(TIUDA)>0 D  G CHKCNQ:$G(TIUDNB)
"RTN","TIUPUTCP",73,0)
 . ;Check if 0th node of document is defined
"RTN","TIUPUTCP",74,0)
 . I $G(^TIU(8925,TIUDA,0))="" S TIUDNB=89250007 Q
"RTN","TIUPUTCP",75,0)
 . ;Check if consult is associated with the document
"RTN","TIUPUTCP",76,0)
 . I +$P($G(^TIU(8925,TIUDA,14)),U,5)'=TIUCDA S TIUDNB=89250008 Q
"RTN","TIUPUTCP",77,0)
 ;
"RTN","TIUPUTCP",78,0)
 ;Set success flag
"RTN","TIUPUTCP",79,0)
 S OKF=1
"RTN","TIUPUTCP",80,0)
 ;
"RTN","TIUPUTCP",81,0)
CHKCNQ Q +$G(OKF)
"RTN","TIUPUTCP",82,0)
 ;
"RTN","TIUPUTCP",83,0)
CHKCP(TIUCDA,TIUDA,TIUDNB) ;Check status of Consult as it relates to CP
"RTN","TIUPUTCP",84,0)
 ; Input  -- TIUCDA   Request/Consult file (#123) IEN
"RTN","TIUPUTCP",85,0)
 ;           TIUDA    TIU Document file (#8925) IEN  (Optional)
"RTN","TIUPUTCP",86,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIUPUTCP",87,0)
 ;           TIUDNB   Dialogue Number for Error Message  (Optional)
"RTN","TIUPUTCP",88,0)
 N OKF,TIUCPACT
"RTN","TIUPUTCP",89,0)
 S TIUCPACT=$$CPACTM^GMRCCP(TIUCDA)
"RTN","TIUPUTCP",90,0)
 I 'TIUCPACT S TIUDNB=89250010 G CHKCPQ
"RTN","TIUPUTCP",91,0)
 I TIUCPACT=2 S TIUDNB=89250011 G CHKCPQ
"RTN","TIUPUTCP",92,0)
 I TIUCPACT=3,$G(TIUDA)'>0 S TIUDNB=89250012 G CHKCPQ
"RTN","TIUPUTCP",93,0)
 ;
"RTN","TIUPUTCP",94,0)
 ;Set success flag
"RTN","TIUPUTCP",95,0)
 S OKF=1
"RTN","TIUPUTCP",96,0)
 ;
"RTN","TIUPUTCP",97,0)
CHKCPQ Q +$G(OKF)
"RTN","TIUPUTCP",98,0)
 ;
"RTN","TIUPUTCP",99,0)
MAKEADD() ; Create an addendum record
"RTN","TIUPUTCP",100,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTCP",101,0)
 S TIUATYP=+$$WHATITLE^TIUPUTU("ADDENDUM")
"RTN","TIUPUTCP",102,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUPUTCP",103,0)
 D ^DIC
"RTN","TIUPUTCP",104,0)
 S DA=+Y
"RTN","TIUPUTCP",105,0)
 I +DA>0 S DIE=DIC,DR=".04////"_$$DOCCLASS^TIULC1(TIUATYP) D ^DIE
"RTN","TIUPUTCP",106,0)
 K TIUHDR(.01)
"RTN","TIUPUTCP",107,0)
 Q +DA
"RTN","TIUPUTCP",108,0)
STUFREC(DA,PARENT) ; Stuff fixed field data
"RTN","TIUPUTCP",109,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIUPSCI,TIUDTPI
"RTN","TIUPUTCP",110,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTCP",111,0)
 I +$G(PARENT)'>0 D
"RTN","TIUPUTCP",112,0)
 . I '$G(TIUPLDA) D
"RTN","TIUPUTCP",113,0)
 . . S @FDARR@(.02)=$G(DFN),@FDARR@(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUPUTCP",114,0)
 . . S @FDARR@(.07)=$P($G(TIU("EDT")),U)
"RTN","TIUPUTCP",115,0)
 . . S @FDARR@(.08)=$P($G(TIU("LDT")),U)
"RTN","TIUPUTCP",116,0)
 . . S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTCP",117,0)
 . . S @FDARR@(1205)=$S(+$P($G(TIU("LOC")),U):$P($G(TIU("LOC")),U),1:$P($G(TIU("VLOC")),U))
"RTN","TIUPUTCP",118,0)
 . . S @FDARR@(1404)=$P($G(TIU("SVC")),U)
"RTN","TIUPUTCP",119,0)
 . I '$G(TIUPLDA)!('$P($G(^TIU(8925,+$G(TIUPLDA),13)),U,4)) S @FDARR@(.05)=3
"RTN","TIUPUTCP",120,0)
 I +$G(PARENT)>0 D
"RTN","TIUPUTCP",121,0)
 . S @FDARR@(.02)=+$P($G(^TIU(8925,+PARENT,0)),U,2)
"RTN","TIUPUTCP",122,0)
 . S @FDARR@(.03)=$P($G(^TIU(8925,+PARENT,0)),U,3)
"RTN","TIUPUTCP",123,0)
 . S @FDARR@(.05)=3
"RTN","TIUPUTCP",124,0)
 . S @FDARR@(.06)=PARENT
"RTN","TIUPUTCP",125,0)
 . S @FDARR@(.07)=$P($G(^TIU(8925,+PARENT,0)),U,7)
"RTN","TIUPUTCP",126,0)
 . S @FDARR@(.08)=$P($G(^TIU(8925,+PARENT,0)),U,8)
"RTN","TIUPUTCP",127,0)
 . S @FDARR@(1205)=$P($G(^TIU(8925,+PARENT,12)),U,5)
"RTN","TIUPUTCP",128,0)
 . S @FDARR@(1404)=$P($G(^TIU(8925,+PARENT,14)),U,4)
"RTN","TIUPUTCP",129,0)
 . S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTCP",130,0)
 I '$G(TIUPLDA) S @FDARR@(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUPUTCP",131,0)
 S @FDARR@(1212)=$P($G(TIU("INST")),U)
"RTN","TIUPUTCP",132,0)
 S @FDARR@(1301)=$S($G(TIUDDT)]"":$$IDATE^TIULC($G(TIUDDT)),1:"")
"RTN","TIUPUTCP",133,0)
 I @FDARR@(1301)'>0 S @FDARR@(1301)=$G(@FDARR@(.07))
"RTN","TIUPUTCP",134,0)
 S @FDARR@(1303)="U"
"RTN","TIUPUTCP",135,0)
 I $G(TIUPSC)]"" D VAL^DIE(8925,DA,70201,,TIUPSC,.TIUPSCI)
"RTN","TIUPUTCP",136,0)
 S @FDARR@(70201)=$S($G(TIUPSCI):TIUPSCI,1:"")
"RTN","TIUPUTCP",137,0)
 I '$G(TIUPLDA)!($P($G(^TIU(8925,+$G(TIUPLDA),702)),U,2))="" D
"RTN","TIUPUTCP",138,0)
 . I $G(TIUDTP)]"" D VAL^DIE(8925,DA,70202,,TIUDTP,.TIUDTPI)
"RTN","TIUPUTCP",139,0)
 . S @FDARR@(70202)=$S($G(TIUDTPI):TIUDTPI,1:"")
"RTN","TIUPUTCP",140,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPUTCP",141,0)
 Q
"RTN","TIUPUTCP",142,0)
DELTEXT(DA) ; Delete existing text in preparation for replacement
"RTN","TIUPUTCP",143,0)
 N DIE,DR,X,Y
"RTN","TIUPUTCP",144,0)
 S DIE=8925,DR="2///@" D ^DIE
"RTN","TIUPUTCP",145,0)
 Q
"RTN","TIUPUTCP",146,0)
WHATYPE(X) ; Identify document type
"RTN","TIUPUTCP",147,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTCP",148,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTCP",149,0)
 N DIC,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTCP",150,0)
 S DIC=8925.1,DIC(0)="M"
"RTN","TIUPUTCP",151,0)
 S DIC("S")="I +$O(^TIU(8925.1,+Y,""HEAD"",0))!+$O(^TIU(8295.1,+Y,""ITEM"",0))"
"RTN","TIUPUTCP",152,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTCP",153,0)
WHATYPX Q Y
"RTN","TIUPUTCP",154,0)
WHATITLE(X) ; Identify document title
"RTN","TIUPUTCP",155,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTCP",156,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTCP",157,0)
 N DIC,Y,TIUFPRIV,SCREEN,TIUCLASS S TIUFPRIV=1
"RTN","TIUPUTCP",158,0)
 S DIC=8925.1,DIC(0)="M",TIUCLASS=+$$CLASS^TIUCP
"RTN","TIUPUTCP",159,0)
 S SCREEN="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"",+$$ISA^TIULX(+Y,"_TIUCLASS_"),+$$CANPICK^TIULP(+Y)"
"RTN","TIUPUTCP",160,0)
 S DIC("S")=SCREEN
"RTN","TIUPUTCP",161,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTCP",162,0)
WHATITX Q Y
"RTN","TIUPUTCP",163,0)
FOLLOWUP(TIUDA) ; Post-filing code for CLINICAL PROCEDURES
"RTN","TIUPUTCP",164,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIU,DFN
"RTN","TIUPUTCP",165,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTCP",166,0)
 S @FDARR@(1204)=$$WHOSIGNS^TIULC1(TIUDA)
"RTN","TIUPUTCP",167,0)
 I +$P($G(^TIU(8925,TIUDA,12)),U,9),'+$P($G(^(12)),U,8) D
"RTN","TIUPUTCP",168,0)
 . S @FDARR@(1208)=$$WHOCOSIG^TIULC1(TIUDA)
"RTN","TIUPUTCP",169,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTCP",170,0)
 I +$P($G(^TIU(8925,+TIUDA,12)),U,8),(+$P($G(^TIU(8925,+TIUDA,12)),U,4)'=+$P($G(^(12)),U,8)) D
"RTN","TIUPUTCP",171,0)
 . S @FDARR@(1506)=1 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTCP",172,0)
 D RELEASE^TIUT(TIUDA,1)
"RTN","TIUPUTCP",173,0)
 D AUDIT^TIUEDI1(TIUDA,0,$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")"))
"RTN","TIUPUTCP",174,0)
 I +$P($G(^TIU(8925,+TIUDA,14)),U,5) D
"RTN","TIUPUTCP",175,0)
 . N TIUCDA,DA S TIUCDA=+$P($G(^TIU(8925,+TIUDA,14)),U,5)
"RTN","TIUPUTCP",176,0)
 . W !,$$PNAME^TIULC1(+$G(^TIU(8925,+TIUDA,0)))," #: ",TIUDA
"RTN","TIUPUTCP",177,0)
 . W " Linked to Consult Request #: ",TIUCDA,".",!
"RTN","TIUPUTCP",178,0)
 . ; Post result in CT Pkg
"RTN","TIUPUTCP",179,0)
 . D GET^GMRCTIU(TIUCDA,TIUDA,"INCOMPLETE RPT")
"RTN","TIUPUTCP",180,0)
 I '$D(TIU("VSTR")) D
"RTN","TIUPUTCP",181,0)
 . N TIUD0,TIUD12,TIUVLOC,TIUHLOC,TIUEDT,TIULDT
"RTN","TIUPUTCP",182,0)
 . S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12))
"RTN","TIUPUTCP",183,0)
 . S DFN=+$P(TIUD0,U,2),TIUEDT=+$P(TIUD0,U,7)
"RTN","TIUPUTCP",184,0)
 . S TIULDT=$$FMADD^XLFDT(TIUEDT,1),TIUHLOC=+$P(TIUD12,U,5)
"RTN","TIUPUTCP",185,0)
 . S TIUVLOC=$S(+$P(TIUD12,U,11):+$P(TIUD12,U,11),1:+TIUHLOC)
"RTN","TIUPUTCP",186,0)
 . I $S(+DFN'>0:1,+TIUEDT'>0:1,+TIULDT'>0:1,+TIUVLOC'>0:1,1:0) Q
"RTN","TIUPUTCP",187,0)
 . D MAIN^TIUVSIT(.TIU,DFN,"",TIUEDT,TIULDT,"LAST",0,+TIUVLOC)
"RTN","TIUPUTCP",188,0)
 Q:'$D(TIU("VSTR"))
"RTN","TIUPUTCP",189,0)
 D QUE^TIUPXAP1 ; Get/file VISIT
"RTN","TIUPUTCP",190,0)
 Q
"RTN","TIUPUTCP",191,0)
GETCP ; Help get Fields for CP Dictation/Error Resolution
"RTN","TIUPUTCP",192,0)
 N TIU,DFN,TIUY,TITLE,TIUBUF,TIUPLDA,TIUMVN,TIUVSTR
"RTN","TIUPUTCP",193,0)
 W ! S DFN=+$$PATIENT^TIULA G GETCPQ:+DFN'>0
"RTN","TIUPUTCP",194,0)
 S TIUBUF=$S(+$G(BUFDA):+$G(BUFDA),+$G(XQADATA):+$G(XQADATA),1:"")
"RTN","TIUPUTCP",195,0)
 ;If there is a buffer entry with a TIU Document Number, ask for document
"RTN","TIUPUTCP",196,0)
 I $G(TIUBUF),$$CHKUPL(TIUBUF) D  G GETCPQ:'$D(TIU)
"RTN","TIUPUTCP",197,0)
 . I $$ASKUPL(DFN,.TIUPLDA) D
"RTN","TIUPUTCP",198,0)
 . . ;If Patient Movement
"RTN","TIUPUTCP",199,0)
 . . I +$G(^TIU(8925,+TIUPLDA,14)) D
"RTN","TIUPUTCP",200,0)
 . . . S TIUMVN=+$G(^TIU(8925,+TIUPLDA,14))
"RTN","TIUPUTCP",201,0)
 . . ;Else set up Visit string
"RTN","TIUPUTCP",202,0)
 . . ELSE  D
"RTN","TIUPUTCP",203,0)
 . . . S TIUVSTR=$P($G(^TIU(8925,+TIUPLDA,12)),U,11)_";"_$P($G(^TIU(8925,+TIUPLDA,0)),U,7)_";"_$P($G(^TIU(8925,+TIUPLDA,0)),U,13)
"RTN","TIUPUTCP",204,0)
 . . ;Populate demographic and Visit information
"RTN","TIUPUTCP",205,0)
 . . D PATVADPT^TIULV(.TIU,DFN,$G(TIUMVN),$G(TIUVSTR))
"RTN","TIUPUTCP",206,0)
 ELSE  D  G GETCPQ:'$D(TIU)
"RTN","TIUPUTCP",207,0)
 . ;If there is no stub ask for Visit
"RTN","TIUPUTCP",208,0)
 . D ENPN^TIUVSIT(.TIU,+DFN,1)
"RTN","TIUPUTCP",209,0)
 . I '$D(TIU) Q
"RTN","TIUPUTCP",210,0)
 . S TIUY=$$CHEKPN^TIUCHLP(.TIU)
"RTN","TIUPUTCP",211,0)
 D MAKE^TIUCPFIX(.SUCCESS,DFN,.TITLE,.TIU,$G(TIUBUF),$G(TIUPLDA))
"RTN","TIUPUTCP",212,0)
 I +SUCCESS D
"RTN","TIUPUTCP",213,0)
 . S TIUDONE=1
"RTN","TIUPUTCP",214,0)
 ELSE  D
"RTN","TIUPUTCP",215,0)
 . W !!,"Please correct the buffered upload data.",!,$P(SUCCESS,U,2),!
"RTN","TIUPUTCP",216,0)
 . I $$READ^TIUU("FOA","Press RETURN to continue...") W ""
"RTN","TIUPUTCP",217,0)
GETCPQ Q
"RTN","TIUPUTCP",218,0)
 ;
"RTN","TIUPUTCP",219,0)
CHKUPL(TIUBUF) ;Check if Buffer Entry has TIU Document Number
"RTN","TIUPUTCP",220,0)
 ; Input  -- TIUBUF   TIU Upload Buffer file (#8925.2) IEN
"RTN","TIUPUTCP",221,0)
 ; Output -- 1=Yes and 0=No
"RTN","TIUPUTCP",222,0)
 N TIUX,Y
"RTN","TIUPUTCP",223,0)
 D LOADTIUX^TIUCPFIX(.TIUX,TIUBUF)
"RTN","TIUPUTCP",224,0)
 I $G(TIUX(.001)) S Y=1
"RTN","TIUPUTCP",225,0)
 Q +$G(Y)
"RTN","TIUPUTCP",226,0)
 ;
"RTN","TIUPUTCP",227,0)
ASKUPL(DFN,TIUPLDA) ;Ask TIU Document Number for Error Resolution
"RTN","TIUPUTCP",228,0)
 ; Input  -- DFN      Patient file (#2) IEN
"RTN","TIUPUTCP",229,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIUPUTCP",230,0)
 ;           TIUPLDA  TIU Document file (#8925) IEN
"RTN","TIUPUTCP",231,0)
 N D,DD,DIC,DINUM,DLAYGO,D0,X,Y
"RTN","TIUPUTCP",232,0)
 S DIC="^TIU(8925,",DIC(0)="EUVX",D="C"
"RTN","TIUPUTCP",233,0)
 S X=DFN
"RTN","TIUPUTCP",234,0)
 S DIC("S")="I $P(^(0),U,5)=1,+$$ISA^TIULX(+$P(^(0),U),+$$CLASS^TIUCP)"
"RTN","TIUPUTCP",235,0)
 S DIC("W")="D ID^TIUPUTCP(+Y)"
"RTN","TIUPUTCP",236,0)
 D IX^DIC
"RTN","TIUPUTCP",237,0)
 I Y>0 S TIUPLDA=+Y
"RTN","TIUPUTCP",238,0)
 Q $S($G(TIUPLDA)="":0,1:1)
"RTN","TIUPUTCP",239,0)
 ;
"RTN","TIUPUTCP",240,0)
ID(TIUDA) ;Display TIU Document Information for Error Resolution
"RTN","TIUPUTCP",241,0)
 ; Input  -- TIUDA    TIU Document file (#8925) IEN  (Optional)
"RTN","TIUPUTCP",242,0)
 ; Output -- None
"RTN","TIUPUTCP",243,0)
 W !?12,"Document #: ",TIUDA
"RTN","TIUPUTCP",244,0)
 W ?34,"Dated: ",$$DATE^TIULS(+$G(^TIU(8925,+TIUDA,13)),"MM/DD/CCYY@HR:MIN")
"RTN","TIUPUTCP",245,0)
 W ?60,"Consult #: ",+$P($G(^TIU(8925,+TIUDA,14)),U,5)
"RTN","TIUPUTCP",246,0)
 Q
"RTN","TIUPUTPN")
0^13^B23447967
"RTN","TIUPUTPN",1,0)
TIUPUTPN ; SLC/JER - PN Look-up Method ;4/18/03
"RTN","TIUPUTPN",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,21,100,131,113**;Jun 20, 1997
"RTN","TIUPUTPN",3,0)
LOOKUP ; Look-up code used by router/filer
"RTN","TIUPUTPN",4,0)
 ; Required: TIUSSN, TIUVDT
"RTN","TIUPUTPN",5,0)
 N DA,DFN,TIU,TIUDAD,TIUEDIT,TIUEDT,TIULDT,TIUXCRP,TIUTYPE,TIUNEW
"RTN","TIUPUTPN",6,0)
 N TIUDPRM
"RTN","TIUPUTPN",7,0)
 I $S('$D(TIUSSN):1,'$D(TIUVDT):1,$G(TIUSSN)?4N:1,$G(TIUSSN)']"":1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTPN",8,0)
 I TIUSSN?3N1P2N1P4N.E S TIUSSN=$TR(TIUSSN,"-/","")
"RTN","TIUPUTPN",9,0)
 I TIUSSN["?" S Y=-1 G LOOKUPX
"RTN","TIUPUTPN",10,0)
 S TIULOC=+$$ILOC(TIULOC)
"RTN","TIUPUTPN",11,0)
 I '$D(^SC(+$G(TIULOC),0)) S Y=-1 G LOOKUPX
"RTN","TIUPUTPN",12,0)
 S TIUINST=+$$DIVISION^TIULC1(TIULOC)
"RTN","TIUPUTPN",13,0)
 S TIUEDT=$$IDATE^TIULC(TIUVDT),TIULDT=$$FMADD^XLFDT(TIUEDT,1)
"RTN","TIUPUTPN",14,0)
 I +TIUEDT'>0 S Y=-1 Q
"RTN","TIUPUTPN",15,0)
 S TIUTYPE=$$WHATITLE(TIUTITLE)
"RTN","TIUPUTPN",16,0)
 I +TIUTYPE'>0 S Y=-1 Q
"RTN","TIUPUTPN",17,0)
 ; -- Abort upload if title is consult title:
"RTN","TIUPUTPN",18,0)
 I $$ISA^TIULX(+TIUTYPE,+$$CLASS^TIUCNSLT) S Y=-1 Q  ; TIU*1*131
"RTN","TIUPUTPN",19,0)
 D DOCPRM^TIULC1(+TIUTYPE,.TIUDPRM)
"RTN","TIUPUTPN",20,0)
 I $P($G(^SC(+TIULOC,0)),U,3)="W" D  I 1
"RTN","TIUPUTPN",21,0)
 . D MAIN^TIUMOVE(.TIU,.DFN,TIUSSN,TIUEDT,TIULDT,1,"LAST",0,TIULOC)
"RTN","TIUPUTPN",22,0)
 E  D MAIN^TIUVSIT(.TIU,.DFN,TIUSSN,TIUEDT,TIULDT,"LAST",0,TIULOC)
"RTN","TIUPUTPN",23,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTPN",24,0)
 I $P(+$G(TIU("EDT")),".")'=$P($$IDATE^TIULC(TIUVDT),".") S Y=-1 G LOOKUPX
"RTN","TIUPUTPN",25,0)
 S TIUTYP(1)=1_U_TIUTYPE_U_$$PNAME^TIULC1(TIUTYPE)
"RTN","TIUPUTPN",26,0)
 ;S Y=$$GETREC^TIUEDI1(DFN,.TIU,1,.TIUNEW,.TIUDPRM)
"RTN","TIUPUTPN",27,0)
 S Y=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM)
"RTN","TIUPUTPN",28,0)
 I +Y'>0 G LOOKUPX
"RTN","TIUPUTPN",29,0)
 ; If record is not new, has text and can be edited, then replace
"RTN","TIUPUTPN",30,0)
 ; existing text
"RTN","TIUPUTPN",31,0)
 I +$G(TIUNEW)'>0 D
"RTN","TIUPUTPN",32,0)
 . S TIUEDIT=$$CANEDIT(+Y)
"RTN","TIUPUTPN",33,0)
 . I +TIUEDIT>0,$D(^TIU(8925,+Y,"TEXT")) D DELTEXT(+Y)
"RTN","TIUPUTPN",34,0)
 . I +TIUEDIT'>0 S TIUDAD=+Y,Y=$$MAKEADD
"RTN","TIUPUTPN",35,0)
 I +Y'>0 Q
"RTN","TIUPUTPN",36,0)
 D STUFREC(Y,+$G(TIUDAD))
"RTN","TIUPUTPN",37,0)
 I +$G(TIUDAD) D SENDADD^TIUALRT(+Y)
"RTN","TIUPUTPN",38,0)
 K TIUHDR(.01),TIUHDR(.07),TIUHDR(1301)
"RTN","TIUPUTPN",39,0)
LOOKUPX Q
"RTN","TIUPUTPN",40,0)
ILOC(LOCATION) ; Get pointer to file 44
"RTN","TIUPUTPN",41,0)
 N DIC,X,Y
"RTN","TIUPUTPN",42,0)
 S DIC=44,DIC(0)="M",X=LOCATION D ^DIC
"RTN","TIUPUTPN",43,0)
 Q Y
"RTN","TIUPUTPN",44,0)
CANEDIT(DA) ; Check whether or not document is released
"RTN","TIUPUTPN",45,0)
 Q $S(+$P($G(^TIU(8925,+DA,0)),U,5)<4:1,1:0)
"RTN","TIUPUTPN",46,0)
MAKEADD() ; Create an addendum record
"RTN","TIUPUTPN",47,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTPN",48,0)
 S TIUATYP=+$$WHATITLE("ADDENDUM")
"RTN","TIUPUTPN",49,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUPUTPN",50,0)
 D ^DIC
"RTN","TIUPUTPN",51,0)
 S DA=+Y
"RTN","TIUPUTPN",52,0)
 I +DA>0 S DIE=DIC,DR=".04////"_$$DOCCLASS^TIULC1(TIUATYP) D ^DIE
"RTN","TIUPUTPN",53,0)
 K TIUHDR(.01)
"RTN","TIUPUTPN",54,0)
 Q +DA
"RTN","TIUPUTPN",55,0)
STUFREC(DA,PARENT) ; Stuff fixed field data
"RTN","TIUPUTPN",56,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG
"RTN","TIUPUTPN",57,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTPN",58,0)
 I +$G(PARENT)'>0 D
"RTN","TIUPUTPN",59,0)
 . S @FDARR@(.02)=$G(DFN),@FDARR@(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUPUTPN",60,0)
 . S @FDARR@(.05)=3
"RTN","TIUPUTPN",61,0)
 . S @FDARR@(.07)=$P($G(TIU("EDT")),U)
"RTN","TIUPUTPN",62,0)
 . S @FDARR@(.08)=$P($G(TIU("LDT")),U)
"RTN","TIUPUTPN",63,0)
 . S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTPN",64,0)
 . S @FDARR@(1205)=$S(+$P($G(TIU("LOC")),U):$P($G(TIU("LOC")),U),1:$P($G(TIU("VLOC")),U))
"RTN","TIUPUTPN",65,0)
 . ;S @FDARR@(1211)=$P($G(TIU("VLOC")),U)
"RTN","TIUPUTPN",66,0)
 . S @FDARR@(1404)=$P($G(TIU("SVC")),U)
"RTN","TIUPUTPN",67,0)
 I +$G(PARENT)>0 D
"RTN","TIUPUTPN",68,0)
 . S @FDARR@(.02)=+$P($G(^TIU(8925,+PARENT,0)),U,2)
"RTN","TIUPUTPN",69,0)
 . S @FDARR@(.03)=+$P($G(^TIU(8925,+PARENT,0)),U,3),@FDARR@(.05)=3
"RTN","TIUPUTPN",70,0)
 . S @FDARR@(.06)=PARENT
"RTN","TIUPUTPN",71,0)
 . S @FDARR@(.07)=$P($G(^TIU(8925,+PARENT,0)),U,7)
"RTN","TIUPUTPN",72,0)
 . S @FDARR@(.08)=$P($G(^TIU(8925,+PARENT,0)),U,8)
"RTN","TIUPUTPN",73,0)
 . S @FDARR@(1205)=$P($G(^TIU(8925,+PARENT,12)),U,5)
"RTN","TIUPUTPN",74,0)
 . S @FDARR@(1404)=$P($G(^TIU(8925,+PARENT,14)),U,4)
"RTN","TIUPUTPN",75,0)
 . S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTPN",76,0)
 S @FDARR@(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUPUTPN",77,0)
 S @FDARR@(1212)=$P($G(TIU("INST")),U)
"RTN","TIUPUTPN",78,0)
 S @FDARR@(1301)=$S($G(TIUDDT)]"":$$IDATE^TIULC($G(TIUDDT)),1:"")
"RTN","TIUPUTPN",79,0)
 I $S(@FDARR@(1301)'>0:1,$P(@FDARR@(1301),".",2)']"":1,1:0) D
"RTN","TIUPUTPN",80,0)
 . S @FDARR@(1301)=$S($P($G(TIU("VSTR")),";",3)="H":$$NOW^XLFDT,1:$G(@FDARR@(.07)))
"RTN","TIUPUTPN",81,0)
 S @FDARR@(1303)="U"
"RTN","TIUPUTPN",82,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPUTPN",83,0)
 Q
"RTN","TIUPUTPN",84,0)
DELTEXT(DA) ; Delete existing text in preparation for replacement
"RTN","TIUPUTPN",85,0)
 N DIE,DR,X,Y
"RTN","TIUPUTPN",86,0)
 S DIE=8925,DR="2///@" D ^DIE
"RTN","TIUPUTPN",87,0)
 Q
"RTN","TIUPUTPN",88,0)
WHATYPE(X) ; Identify document type
"RTN","TIUPUTPN",89,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTPN",90,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTPN",91,0)
 N DIC,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTPN",92,0)
 S DIC=8925.1,DIC(0)="M"
"RTN","TIUPUTPN",93,0)
 S DIC("S")="I $D(^TIU(8925.1,+Y,""HEAD""))!$D(^TIU(8295.1,+Y,""ITEM""))"
"RTN","TIUPUTPN",94,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTPN",95,0)
WHATYPX Q Y
"RTN","TIUPUTPN",96,0)
WHATITLE(X) ; Identify document title
"RTN","TIUPUTPN",97,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTPN",98,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTPN",99,0)
 N DIC,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTPN",100,0)
 S DIC=8925.1,DIC(0)="M"
"RTN","TIUPUTPN",101,0)
 S DIC("S")="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"""
"RTN","TIUPUTPN",102,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTPN",103,0)
WHATITX Q Y
"RTN","TIUPUTPN",104,0)
FOLLOWUP(TIUDA) ; Post-filing code for PROGRESS NOTES
"RTN","TIUPUTPN",105,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIU,DFN
"RTN","TIUPUTPN",106,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTPN",107,0)
 S @FDARR@(1204)=$$WHOSIGNS^TIULC1(TIUDA)
"RTN","TIUPUTPN",108,0)
 I +$P($G(^TIU(8925,TIUDA,12)),U,9),'+$P($G(^(12)),U,8) D
"RTN","TIUPUTPN",109,0)
 . S @FDARR@(1208)=$$WHOCOSIG^TIULC1(TIUDA)
"RTN","TIUPUTPN",110,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTPN",111,0)
 I +$P($G(^TIU(8925,+TIUDA,12)),U,8),(+$P($G(^TIU(8925,+TIUDA,12)),U,4)'=+$P($G(^(12)),U,8)) D
"RTN","TIUPUTPN",112,0)
 . S @FDARR@(1506)=1 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTPN",113,0)
 D RELEASE^TIUT(TIUDA,1)
"RTN","TIUPUTPN",114,0)
 D AUDIT^TIUEDI1(TIUDA,0,$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")"))
"RTN","TIUPUTPN",115,0)
 I '$D(TIU("VSTR")) D
"RTN","TIUPUTPN",116,0)
 . N TIUD0,TIUD12,TIUVLOC,TIUHLOC,TIUEDT,TIULDT
"RTN","TIUPUTPN",117,0)
 . S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12))
"RTN","TIUPUTPN",118,0)
 . S DFN=+$P(TIUD0,U,2),TIUEDT=+$P(TIUD0,U,7)
"RTN","TIUPUTPN",119,0)
 . S TIULDT=$$FMADD^XLFDT(TIUEDT,1),TIUHLOC=+$P(TIUD12,U,5)
"RTN","TIUPUTPN",120,0)
 . S TIUVLOC=$S(+$P(TIUD12,U,11):+$P(TIUD12,U,11),1:+TIUHLOC)
"RTN","TIUPUTPN",121,0)
 . I $S(+DFN'>0:1,+TIUEDT'>0:1,+TIULDT'>0:1,+TIUVLOC'>0:1,1:0) Q
"RTN","TIUPUTPN",122,0)
 . D MAIN^TIUVSIT(.TIU,DFN,"",TIUEDT,TIULDT,"LAST",0,+TIUVLOC)
"RTN","TIUPUTPN",123,0)
 Q:'$D(TIU("VSTR"))
"RTN","TIUPUTPN",124,0)
 D ENQ^TIUPXAP1 ; Get/file VISIT
"RTN","TIUPUTPN",125,0)
 Q
"RTN","TIUPUTU")
0^14^B17104342
"RTN","TIUPUTU",1,0)
TIUPUTU ; SLC/JER - Utilities for Filer/Router ;1/16/04
"RTN","TIUPUTU",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,100,120,113**;Jun 20, 1997
"RTN","TIUPUTU",3,0)
LOOKUP ; Look-up code used by router/filer
"RTN","TIUPUTU",4,0)
 ; Required: TIUSSN, TIUADT
"RTN","TIUPUTU",5,0)
 N DA,DFN,TIU,TIUDAD,TIUDPRM,TIUEDIT,TIUEDT,TIULDT,TIUXCRP S TIUXCRP=1
"RTN","TIUPUTU",6,0)
 I $S('$D(TIUSSN):1,'$D(TIUADT):1,$G(TIUSSN)?4N:1,$G(TIUSSN)']"":1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTU",7,0)
 I TIUSSN?3N1P2N1P4N.E S TIUSSN=$TR(TIUSSN,"-/","")
"RTN","TIUPUTU",8,0)
 I TIUSSN["?" S Y=-1 G LOOKUPX
"RTN","TIUPUTU",9,0)
 S TIUEDT=$$IDATE^TIULC(TIUADT),TIULDT=$$FMADD^XLFDT(TIUEDT,1)
"RTN","TIUPUTU",10,0)
 I +TIUEDT'>0 S Y=-1 Q
"RTN","TIUPUTU",11,0)
 D MAIN^TIUMOVE(.TIU,.DFN,TIUSSN,TIUEDT,TIULDT,1,"LAST",0)
"RTN","TIUPUTU",12,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTU",13,0)
 S TIUINST=+$$DIVISION^TIULC1(TIU("LOC"))
"RTN","TIUPUTU",14,0)
 I $P(+$G(TIU("EDT")),".")'=$P($$IDATE^TIULC(TIUADT),".") S Y=-1 G LOOKUPX
"RTN","TIUPUTU",15,0)
 I '+$G(TIU("LDT")),($G(TIUDICDT)]""),(+$$IDATE^TIULC(TIUDICDT)=-1) S Y=-1 Q
"RTN","TIUPUTU",16,0)
 D DOCPRM^TIULC1(RECORD("TYPE"),.TIUDPRM)
"RTN","TIUPUTU",17,0)
 S TIUTYP(1)=1_U_RECORD("TYPE")_U_$$PNAME^TIULC1(RECORD("TYPE"))
"RTN","TIUPUTU",18,0)
 S Y=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM)
"RTN","TIUPUTU",19,0)
 I +Y'>0 G LOOKUPX
"RTN","TIUPUTU",20,0)
 S TIUEDIT=$$CANEDIT(+Y)
"RTN","TIUPUTU",21,0)
 ; If record has text and can be edited, then replace existing text
"RTN","TIUPUTU",22,0)
 I +TIUEDIT>0,$D(^TIU(8925,+Y,"TEXT")) D DELTEXT(+Y)
"RTN","TIUPUTU",23,0)
 I +TIUEDIT'>0 S TIUDAD=+Y,Y=$$MAKEADD
"RTN","TIUPUTU",24,0)
 I +Y'>0 G LOOKUPX
"RTN","TIUPUTU",25,0)
 K TIUHDR(.07)
"RTN","TIUPUTU",26,0)
 D STUFREC(Y,+$G(TIUDAD))
"RTN","TIUPUTU",27,0)
 I +$G(TIUDAD) D SENDADD^TIUALRT(+Y)
"RTN","TIUPUTU",28,0)
LOOKUPX Q
"RTN","TIUPUTU",29,0)
CANEDIT(DA) ; Check whether or not document is released
"RTN","TIUPUTU",30,0)
 Q $S(+$P($G(^TIU(8925,+DA,13)),U,4):0,+$P($G(^(13)),U,5)>0:0,+$G(^(15)):0,1:1)
"RTN","TIUPUTU",31,0)
MAKEADD() ; Create an addendum record
"RTN","TIUPUTU",32,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTU",33,0)
 S TIUATYP=+$$WHATITLE("ADDENDUM")
"RTN","TIUPUTU",34,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUPUTU",35,0)
 D ^DIC
"RTN","TIUPUTU",36,0)
 S DA=+Y
"RTN","TIUPUTU",37,0)
 I +DA>0 S DIE=DIC,DR=".04////"_$$DOCCLASS^TIULC1(TIUATYP) D ^DIE
"RTN","TIUPUTU",38,0)
 Q +DA
"RTN","TIUPUTU",39,0)
STUFREC(DA,PARENT) ; Stuff fixed field data
"RTN","TIUPUTU",40,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIURDT
"RTN","TIUPUTU",41,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTU",42,0)
 I +$G(PARENT)'>0 D
"RTN","TIUPUTU",43,0)
 . S @FDARR@(.02)=$G(DFN),@FDARR@(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUPUTU",44,0)
 . S @FDARR@(.05)=3
"RTN","TIUPUTU",45,0)
 . S @FDARR@(.07)=$P(TIU("EDT"),U)
"RTN","TIUPUTU",46,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U),@FDARR@(1401)=TIU("AD#")
"RTN","TIUPUTU",47,0)
 . S @FDARR@(1402)=$P($G(TIU("TS")),U),@FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTU",48,0)
 I +$G(PARENT)>0 D
"RTN","TIUPUTU",49,0)
 . S @FDARR@(.02)=+$P(^TIU(8925,+PARENT,0),U,2)
"RTN","TIUPUTU",50,0)
 . S @FDARR@(.03)=+$P(^TIU(8925,+PARENT,0),U,3),@FDARR@(.05)=3
"RTN","TIUPUTU",51,0)
 . S @FDARR@(.06)=PARENT,@FDARR@(.08)=$P(TIU("LDT"),U)
"RTN","TIUPUTU",52,0)
 . S @FDARR@(1401)=$P(^TIU(8925,+PARENT,14),U)
"RTN","TIUPUTU",53,0)
 . S @FDARR@(1402)=$P(^TIU(8925,+PARENT,14),U,2)
"RTN","TIUPUTU",54,0)
 . S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTU",55,0)
 S @FDARR@(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUPUTU",56,0)
 S @FDARR@(1212)=$P($G(TIU("INST")),U)
"RTN","TIUPUTU",57,0)
 I +$G(TIU("LDT")) S TIURDT=+$G(TIU("LDT"))
"RTN","TIUPUTU",58,0)
 I +$G(TIU("LDT"))'>0 D
"RTN","TIUPUTU",59,0)
 . S TIUDICDT=+$$IDATE^TIULC($G(TIUDICDT))
"RTN","TIUPUTU",60,0)
 . S TIURDT=$S(+$G(TIUDICDT)>0:+$G(TIUDICDT),1:+$$NOW^TIULC)
"RTN","TIUPUTU",61,0)
 . S TIU("LDT")=TIURDT_U_$$DATE^TIULS(TIURDT,"AMTH DD, CCYY@HR:MIN:SEC")
"RTN","TIUPUTU",62,0)
 . S @FDARR@(.12)=1
"RTN","TIUPUTU",63,0)
 S @FDARR@(1301)=TIURDT,@FDARR@(1303)="U"
"RTN","TIUPUTU",64,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPUTU",65,0)
 Q
"RTN","TIUPUTU",66,0)
DELTEXT(DA) ; Delete existing text in preparation for replacement
"RTN","TIUPUTU",67,0)
 N DIE,DR,X,Y
"RTN","TIUPUTU",68,0)
 S DIE=8925,DR="2///@" D ^DIE
"RTN","TIUPUTU",69,0)
 Q
"RTN","TIUPUTU",70,0)
WHATYPE(X) ; Identify document type
"RTN","TIUPUTU",71,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTU",72,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTU",73,0)
 N DIC,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTU",74,0)
 S DIC=8925.1,DIC(0)="M"
"RTN","TIUPUTU",75,0)
 S DIC("S")="I +$O(^TIU(8925.1,+Y,""HEAD"",0))!+$O(^TIU(8925.1,+Y,""ITEM"",0))"
"RTN","TIUPUTU",76,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTU",77,0)
 Q Y
"RTN","TIUPUTU",78,0)
WHATYPE2(X) ; Identify document type
"RTN","TIUPUTU",79,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTU",80,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTU",81,0)
 N DIC,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTU",82,0)
 S DIC=8925.1,DIC(0)="M"
"RTN","TIUPUTU",83,0)
 S DIC("S")="I +$O(^TIU(8925.1,+Y,""HEAD"",0))!+$O(^TIU(8925.1,+Y,""ITEM"",0))"
"RTN","TIUPUTU",84,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTU",85,0)
 Q Y
"RTN","TIUPUTU",86,0)
WHATITLE(X) ; Identify document type
"RTN","TIUPUTU",87,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTU",88,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTU",89,0)
 N DIC,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTU",90,0)
 S DIC=8925.1,DIC(0)="M"
"RTN","TIUPUTU",91,0)
 S DIC("S")="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"""
"RTN","TIUPUTU",92,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTU",93,0)
 Q Y
"RTN","TIUPUTU",94,0)
FOLLOWUP(TIUDA) ; Post-filing code for Discharge Summaries
"RTN","TIUPUTU",95,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIU
"RTN","TIUPUTU",96,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTU",97,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPUTU",98,0)
 I $L($G(TIU("EDT"))) S @FDARR@(.07)=$P($G(TIU("EDT")),U)
"RTN","TIUPUTU",99,0)
 S @FDARR@(1204)=$$WHOSIGNS^TIULC1(TIUDA)
"RTN","TIUPUTU",100,0)
 S @FDARR@(1208)=$$WHOCOSIG^TIULC1(TIUDA)
"RTN","TIUPUTU",101,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTU",102,0)
 I +$P($G(^TIU(8925,+TIUDA,12)),U,4)'=+$P($G(^(12)),U,9) D
"RTN","TIUPUTU",103,0)
 . S @FDARR@(1506)=1 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTU",104,0)
 D ENQ^TIUPXAP1 ; In-line call to get/file the visit
"RTN","TIUPUTU",105,0)
 D RELEASE^TIUT(TIUDA,1),UPDTIRT^TIUDIRT(.TIU,TIUDA)
"RTN","TIUPUTU",106,0)
 D AUDIT^TIUEDI1(TIUDA,0,$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")"))
"RTN","TIUPUTU",107,0)
 Q
"RTN","TIUR")
0^37^B33478636
"RTN","TIUR",1,0)
TIUR ; SLC/JER - Integrated Document Review ;1/29/04
"RTN","TIUR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**74,79,58,100,113**;Jun 20, 1997
"RTN","TIUR",3,0)
 ; 11/30/00 Moved PUTLIST & ADDELMNT to TIUR1
"RTN","TIUR",4,0)
MAKELIST(TIUCLASS,TIUCHVW) ; Get Search Criteria
"RTN","TIUR",5,0)
 N DIRUT,DTOUT,DUOUT,TIUI,SCREEN,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIUR",6,0)
 N TIUDPRMT,TIUPICT,TIUOUT,STATWORD,STATIFN,NOWFLAG
"RTN","TIUR",7,0)
 K DIROUT
"RTN","TIUR",8,0)
 D INITRR^TIULRR(0)
"RTN","TIUR",9,0)
 ;  TIURPN used in Order Entry 2.5, OR OE/RR MENU CLIN:
"RTN","TIUR",10,0)
 I +$G(ORVP),(+$G(TIUCHVW)'>0) D EN^TIURPN(TIUCLASS,+ORVP) Q
"RTN","TIUR",11,0)
STATUS S STATUS=$S($D(TIUQUIK):$$SELSTAT^TIULA(.TIUSTAT,"F","UNSIGNED,UNCOSIGNED"),($D(ORVP)&'+$G(TIUCHVW)):$$SELSTAT^TIULA(.TIUSTAT,"F","COMPLETED"),1:$$SELSTAT^TIULA(.TIUSTAT,"A",$$DFLTSTAT^TIURM(DUZ)))
"RTN","TIUR",12,0)
 I +STATUS<0 S VALMQUIT=1 Q
"RTN","TIUR",13,0)
 S TIUI=0
"RTN","TIUR",14,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI  D
"RTN","TIUR",15,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIUR",16,0)
 . Q:'STATIFN
"RTN","TIUR",17,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIUR",18,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIUR",19,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIUR",20,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIUR",21,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIUR",22,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIUR",23,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIUR",24,0)
 N TIUDCL K TIUPICT
"RTN","TIUR",25,0)
 I $S(('$D(TIUQUIK)&'$D(ORVP)):1,($D(ORVP)&+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"A","LAST","DOC",0,.TIUDCL,.TIUPICT)
"RTN","TIUR",26,0)
 ; SELTYP sets array ^TMP("TIUTYP",$J);
"RTN","TIUR",27,0)
 ; SELTYP used to set data into TIUTYP array
"RTN","TIUR",28,0)
 ; Now TIUTYP just ="^TMP("TIUTYP",$J)"
"RTN","TIUR",29,0)
 I $S($D(TIUQUIK):1,($D(ORVP)&'+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"F","ALL","DOC",0)
"RTN","TIUR",30,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",31,0)
 I +$G(@TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIUR",32,0)
SCREEN ;
"RTN","TIUR",33,0)
 N TIUNAME
"RTN","TIUR",34,0)
 S TIUNAME=$P($G(^VA(200,+DUZ,0)),U)
"RTN","TIUR",35,0)
 I $D(TIUQUIK) D  I 1
"RTN","TIUR",36,0)
 . S SCREEN(1)="AAU^"_DUZ_U_TIUNAME
"RTN","TIUR",37,0)
 . S SCREEN(2)="ASUP^"_DUZ
"RTN","TIUR",38,0)
 . S SCREEN="ALL"
"RTN","TIUR",39,0)
 E  I $D(ORVP),'+$G(TIUCHVW) S SCREEN(1)="APT^"_+ORVP_U_$P($G(^DPT(+ORVP,0)),U) I 1
"RTN","TIUR",40,0)
 E  D SELCAT^TIULA1(.SCREEN,"A","AUTHOR")
"RTN","TIUR",41,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",42,0)
 I $D(SCREEN)'>9 K @TIUTYP G DOCTYPE
"RTN","TIUR",43,0)
 I $D(@TIUTYP)'>9 W !,$C(7),"You must select one or more TITLES..." G SCREEN
"RTN","TIUR",44,0)
 I $G(SCREEN(1))="ALL^ANY",+$G(ORVP) S SCREEN(1)="APT^"_+$G(ORVP)_U_$P($G(^DPT(+$G(ORVP),0)),U)
"RTN","TIUR",45,0)
 D CHECKADD
"RTN","TIUR",46,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIUR",47,0)
 S TIUDPRMT=$S(TIUCLASS=244:"Discharge",1:"Reference")
"RTN","TIUR",48,0)
 S TIUEDT=$S($D(TIUQUIK):1,$D(ORVP)&(+$G(TIUCHVW)'>0):$$FMADD^XLFDT(DT,$S($D(^DPT(+$G(ORVP),.1))'>0:-180,1:-30)),1:$P($$EDATE^TIULA(TIUDPRMT,"",TIUEDFLT),U))
"RTN","TIUR",49,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",50,0)
 I TIUEDT'>0 G SCREEN
"RTN","TIUR",51,0)
 S TIULDT=$S($D(TIUQUIK):9999999,$D(ORVP)&(+$G(TIUCHVW)'>0):+$$NOW^XLFDT,1:$P($$LDATE^TIULA(TIUDPRMT),U))
"RTN","TIUR",52,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",53,0)
 I TIULDT'>0 G ERLY
"RTN","TIUR",54,0)
 I TIUEDT>TIULDT D SWAP(.TIUEDT,.TIULDT)
"RTN","TIUR",55,0)
 I $L(TIULDT,".")=1 D EXPRANGE(.TIUEDT,.TIULDT)
"RTN","TIUR",56,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIUR",57,0)
 S NOWFLAG=$S(TIULDT-$$NOW^XLFDT<.0001:1,1:0)
"RTN","TIUR",58,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIUR",59,0)
 D BUILD(TIUCLASS,.STATUS,.SCREEN,TIUEDT,TIULDT,NOWFLAG) ;11/30/00 removed param TIUTYP since BUILD uses global now.
"RTN","TIUR",60,0)
 ; -- If attaching ID note & changed view,
"RTN","TIUR",61,0)
 ;    update video for line to be attached: --
"RTN","TIUR",62,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIUR",63,0)
 ;K @TIUTYP ;11/30/00 keep ^TMP("TIUTYP",$J) for rebuild
"RTN","TIUR",64,0)
 Q
"RTN","TIUR",65,0)
CHECKADD ; Checks whether Addendum is included in the list of types
"RTN","TIUR",66,0)
 N TIUI,HIT,NUMTYPS
"RTN","TIUR",67,0)
 S (TIUI,HIT)=0
"RTN","TIUR",68,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(^TMP("TIUTYP",$J,TIUI))["ADDENDUM" S HIT=1
"RTN","TIUR",69,0)
 S NUMTYPS=^TMP("TIUTYP",$J)
"RTN","TIUR",70,0)
 I +HIT'>0 S ^TMP("TIUTYP",$J,NUMTYPS+1)=+^TMP("TIUTYP",$J,NUMTYPS)+1_U_"81^Addendum^NOT PICKED",^TMP("TIUTYP",$J)=^TMP("TIUTYP",$J)+1
"RTN","TIUR",71,0)
 Q
"RTN","TIUR",72,0)
 ;
"RTN","TIUR",73,0)
SWAP(TIUX,TIUY) ; Swap variables
"RTN","TIUR",74,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIUR",75,0)
 Q
"RTN","TIUR",76,0)
EXPRANGE(TIUX,TIUY) ; Expand late date to include time
"RTN","TIUR",77,0)
 ;P74 If user entered date/time = T, then numerical date time is FIRST ^ PIECE ONLY of TIUX & TIUY.
"RTN","TIUR",78,0)
 I $P(TIUY,U)=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIUR",79,0)
 E  S TIUY=$P(TIUY,U)_"."_235959 ;P74 Add seconds
"RTN","TIUR",80,0)
 Q
"RTN","TIUR",81,0)
BUILD(TIUCLASS,STATUS,SCREEN,EARLY,LATE,NOWFLAG) ; Build List.
"RTN","TIUR",82,0)
 ;11/30/00 - removed param TYPES. 12/3 added param TIUCLASS
"RTN","TIUR",83,0)
 ; BUILD (GATHER) uses docmt type info from ^TMP("TIUTYP",$J)
"RTN","TIUR",84,0)
 N TIUDT,TIUI,TIUK
"RTN","TIUR",85,0)
 N TIUT,TIUTP,XREF,TIUS,TIUPREF
"RTN","TIUR",86,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ),(TIUK,VALMCNT)=0
"RTN","TIUR",87,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J)
"RTN","TIUR",88,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIUR",89,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIUR",90,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIUR",91,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIUR",92,0)
 S ^TMP("TIUR",$J,"RTN")="TIUR"
"RTN","TIUR",93,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUR",94,0)
 S EARLY=9999999-+$G(EARLY),LATE=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIUR",95,0)
 F  S TIUK=$O(SCREEN(TIUK)) Q:TIUK'>0  D
"RTN","TIUR",96,0)
 . I $G(SCREEN)'="ALL" S SCREEN=$G(TIUK)
"RTN","TIUR",97,0)
 . S XREF=$P(SCREEN(TIUK),U)
"RTN","TIUR",98,0)
 . I XREF'="ASUB" D
"RTN","TIUR",99,0)
 . . S TIUI=$S(XREF'="APRB":$P(SCREEN(TIUK),U,2),1:$$UPPER^TIULS($P(SCREEN(TIUK),U,3)))
"RTN","TIUR",100,0)
 . . D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF,SCREEN)
"RTN","TIUR",101,0)
 . I XREF="ASUB" D
"RTN","TIUR",102,0)
 . . S TIUI=$O(^TIU(8925,XREF,$P(SCREEN(TIUK),U,2)),-1)
"RTN","TIUR",103,0)
 . . F  S TIUI=$O(^TIU(8925,XREF,TIUI)) Q:TIUI=""!(TIUI'[$P(SCREEN(TIUK),U,2))  D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF,SCREEN)
"RTN","TIUR",104,0)
 D PUTLIST^TIUR2(TIUPREF,TIUCLASS,.STATUS,.SCREEN)
"RTN","TIUR",105,0)
 K ^TMP("TIUI",$J)
"RTN","TIUR",106,0)
 Q
"RTN","TIUR",107,0)
 ;
"RTN","TIUR",108,0)
CLEAN ; Clean up your mess!
"RTN","TIUR",109,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIUR",110,0)
 K VALMY
"RTN","TIUR",111,0)
 K ^TMP("TIUTYP",$J)
"RTN","TIUR",112,0)
 Q
"RTN","TIUR",113,0)
 ;
"RTN","TIUR",114,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIUR",115,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUSCRN,TMP,TIUEDT,TIULDT,TIUSTAT
"RTN","TIUR",116,0)
 N TIURBLD,TIUI,TIUCLASS,NOWFLAG
"RTN","TIUR",117,0)
 S TIURBLD=1
"RTN","TIUR",118,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIUR",119,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIUR",120,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIUR",121,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIUR",122,0)
 S TIUSCRN=$P(TIUR0,U,3,99),TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIUR",123,0)
 S TIUI=1
"RTN","TIUR",124,0)
 F  S TMP=$P(TIUSCRN,";",TIUI) Q:TMP=""  D
"RTN","TIUR",125,0)
 . S TIUSCRN(TIUI)=TMP,TIUI=TIUI+1
"RTN","TIUR",126,0)
 S TIUSCRN=$L(TIUSCRN,";")
"RTN","TIUR",127,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIUR",128,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIUR",129,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIUR",130,0)
 D BUILD(TIUCLASS,.STATUS,.TIUSCRN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIUR",131,0)
 ; Reexpand previously expanded items:
"RTN","TIUR",132,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIUR",133,0)
 D BREATHE^TIUROR1(1)
"RTN","TIUR",134,0)
 Q
"RTN","TIUR1")
0^15^B14639571
"RTN","TIUR1",1,0)
TIUR1  ; SLC/JER - Integrated Document Review ;1/29/04
"RTN","TIUR1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**79,100,113**;Jun 20, 1997
"RTN","TIUR1",3,0)
 ; 11/30/00 moved PUTLIST & ADDELMNT here from TIUR. 
"RTN","TIUR1",4,0)
 ; 12/12/00 moved PUTLIST, ADDELMNT, PARENT, EXPANDKD to TIUR2
"RTN","TIUR1",5,0)
GATHER(TIUI,TIUPREF,CLASS,STATIFNS,EARLY,LATE,XREF,SCREEN) ; Find/sort
"RTN","TIUR1",6,0)
 ; Uses title info from ^TMP("TIUTYP",$J) array, set in SELTYP^TIULA
"RTN","TIUR1",7,0)
 N TIUT,TIUTP,TIUS,TIUSTAT,TIUSFLD,TIUD0,TIUD12,TIUD13,TIUD15
"RTN","TIUR1",8,0)
 N TIUIFN,TIULD
"RTN","TIUR1",9,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIUR1",10,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIUR1",11,0)
 S TIUT=0 F  S TIUT=$O(^TMP("TIUTYP",$J,TIUT)) Q:+TIUT'>0  D
"RTN","TIUR1",12,0)
 . S TIUTP=+$P($G(^TMP("TIUTYP",$J,TIUT)),U,2) Q:TIUTP'>0
"RTN","TIUR1",13,0)
 . S TIUS=1 F  S TIUSTAT=$P(STATIFNS,";",TIUS) Q:'TIUSTAT  D
"RTN","TIUR1",14,0)
 . . S TIUS=TIUS+1
"RTN","TIUR1",15,0)
 . . S (TIUJ,TIULD)=LATE
"RTN","TIUR1",16,0)
 . . F  S TIUJ=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ)) Q:+TIUJ'>0!(+TIUJ>EARLY)  D
"RTN","TIUR1",17,0)
 . . . S TIUIFN=0
"RTN","TIUR1",18,0)
 . . . F  S TIUIFN=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ,TIUIFN)) Q:+TIUIFN'>0  D
"RTN","TIUR1",19,0)
 . . . . I ($P(TIUPRM0,U,6)="S"),(+$$CANDO^TIULP(TIUIFN,"VIEW")'>0) Q
"RTN","TIUR1",20,0)
 . . . . I +$G(ORVP),(+$P($G(^TIU(8925,+TIUIFN,0)),U,2)'=+$G(ORVP)) Q
"RTN","TIUR1",21,0)
 . . . . I TIUTP=81,(^TMP("TIUTYP",$J)>1),($P(^TMP("TIUTYP",$J,TIUT),U,4)="NOT PICKED"),(+$P($G(^TIU(8925,+TIUIFN,0)),U,5)>6) Q
"RTN","TIUR1",22,0)
 . . . . I TIUTP=81,(^TMP("TIUTYP",$J)>1),($P(^TMP("TIUTYP",$J,TIUT),U,4)="NOT PICKED"),'+$$DADINTYP(TIUIFN) Q
"RTN","TIUR1",23,0)
 . . . . S TIUQ=$$RESOLVE(TIUIFN,TIUSFLD)
"RTN","TIUR1",24,0)
 . . . . ; S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN)="",TIULD=TIUJ ; P113
"RTN","TIUR1",25,0)
 . . . . I SCREEN=1!(SCREEN="ALL") S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN)=1
"RTN","TIUR1",26,0)
 . . . . E  D
"RTN","TIUR1",27,0)
 . . . . . I $D(^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN)),$G(^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN))=(SCREEN-1) S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN)=SCREEN
"RTN","TIUR1",28,0)
 . . . . S TIULD=TIUJ
"RTN","TIUR1",29,0)
 I +$D(TIUQUIK),+$G(TIULD) D ADDSIGN(DUZ,CLASS,TIULD,TIUSFLD)
"RTN","TIUR1",30,0)
 Q
"RTN","TIUR1",31,0)
DADINTYP(TIUDA) ; addendum's parent belong? 12/1/00 Removed param TYPES
"RTN","TIUR1",32,0)
 N TIUI,TIUDTYP,TIUY S (TIUI,TIUY)=0
"RTN","TIUR1",33,0)
 S TIUDTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIUR1",34,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIUR1",35,0)
 . I +$P(^TMP("TIUTYP",$J,TIUI),U,2)=TIUDTYP S TIUY=1
"RTN","TIUR1",36,0)
 Q TIUY
"RTN","TIUR1",37,0)
RESOLVE(DA,DR) ; resolve sort field values
"RTN","TIUR1",38,0)
 N TIUD0,TIUD12,TIUD13,TIUD15,TIUY
"RTN","TIUR1",39,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIUR1",40,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIUR1",41,0)
 I DR=.01 S TIUY=$$PNAME^TIULC1(+TIUD0) G RESX
"RTN","TIUR1",42,0)
 I DR=.02 S TIUY=$$PTNAME^TIULC1(+$P(TIUD0,U,2)) G RESX
"RTN","TIUR1",43,0)
 I DR=.05 S TIUY=$P(TIUD0,U,5) G RESX
"RTN","TIUR1",44,0)
 I DR=1202 S TIUY=$$PERSNAME^TIULC1(+$P(TIUD12,U,2)) S:TIUY="UNKNOWN" TIUY="" G RESX
"RTN","TIUR1",45,0)
 I DR=1208 S TIUY=$$PERSNAME^TIULC1(+$P(TIUD12,U,8)) S:TIUY="UNKNOWN" TIUY="" G RESX
"RTN","TIUR1",46,0)
 I DR=1301 S TIUY=$P(TIUD13,U) G RESX
"RTN","TIUR1",47,0)
 ;I DR=1507,($P(TIUD0,U,5)=7),(+$P(TIUD15,U,7)'>0) S DR=1501
"RTN","TIUR1",48,0)
 I DR=1507,(($P(TIUD0,U,5)=7)!($P(TIUD0,U,5)=8)),(+$P(TIUD15,U,7)'>0) S DR=1501 ;TIU*1*100 amended notes were sorting at top w sortval=ZZZZEMPTY for sortfld=complete, even tho they had sign date and displayed it.
"RTN","TIUR1",49,0)
 I DR=1501 S TIUY=$P(TIUD15,U) G RESX
"RTN","TIUR1",50,0)
 I DR=1507 S TIUY=$P(TIUD15,U,7)
"RTN","TIUR1",51,0)
RESX I $G(TIUY)']"" S TIUY="ZZZZEMPTY"
"RTN","TIUR1",52,0)
 Q TIUY
"RTN","TIUR1",53,0)
 ;
"RTN","TIUR1",54,0)
ADDSIGN(USER,CLASS,DATE,SORTBY)   ; Get documents for which the user is the additional signer
"RTN","TIUR1",55,0)
 N TIUI,TIUY S TIUI=0
"RTN","TIUR1",56,0)
 D NEEDSIG^TIULX(.TIUY,USER,CLASS)
"RTN","TIUR1",57,0)
 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUR1",58,0)
 . N TIUDA,TIUD13,TIUQ,TIUJ
"RTN","TIUR1",59,0)
 . S TIUDA=+$G(@TIUY@(TIUI)),TIUD13=$G(^TIU(8925,TIUDA,13))
"RTN","TIUR1",60,0)
 . S TIUQ=$$RESOLVE(TIUDA,SORTBY),TIUJ=9999999-+TIUD13
"RTN","TIUR1",61,0)
 . ; S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)="" ; P113
"RTN","TIUR1",62,0)
 . S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)=1
"RTN","TIUR1",63,0)
 K @TIUY
"RTN","TIUR1",64,0)
 Q
"RTN","TIUR2")
0^16^B57493092
"RTN","TIUR2",1,0)
TIUR2  ; SLC/JER - Integrated Document Review ;1/29/04
"RTN","TIUR2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,113**;Jun 20, 1997
"RTN","TIUR2",3,0)
 ; 12/12/00 new rtn, from splitting TIUR1
"RTN","TIUR2",4,0)
REPLACE(TIUDA,SORTVAL,SORTFLD,DATTIM,EXPAND,FORGETAD) ; Fix ^TMP("TIUI",$J).
"RTN","TIUR2",5,0)
 ;Remove ID kid or addm records from ^TMP("TIUI",$J), and replace
"RTN","TIUR2",6,0)
 ;with parent record instead.
"RTN","TIUR2",7,0)
 ; Requires TIUDA, SORTVAL, SORTFLD, DATTIM.
"RTN","TIUR2",8,0)
 ; Passes back opt array EXPAND, where EXPAND(IFN)=""
"RTN","TIUR2",9,0)
 ; opt flag FORGETAD: don't expand parent for sake of addm
"RTN","TIUR2",10,0)
 N IDPRNT,ADDMPRNT,ADDMGPNT,PVAL,GPVAL,PDATTIM,GPDATTIM,NODE
"RTN","TIUR2",11,0)
 S IDPRNT=+$G(^TIU(8925,TIUDA,21)) ; ID parent
"RTN","TIUR2",12,0)
 I '$D(^TIU(8925,IDPRNT,0)) S IDPRNT=0
"RTN","TIUR2",13,0)
 I IDPRNT D
"RTN","TIUR2",14,0)
 . S PVAL=$$RESOLVE^TIUR1(IDPRNT,SORTFLD)
"RTN","TIUR2",15,0)
 . S PDATTIM=$S(^TMP("TIUR",$J,"RTN")="TIURM":+$G(^TIU(8925,IDPRNT,12)),1:+$G(^TIU(8925,IDPRNT,13))) ; rtn TIURM uses "F" XREF, whose date is ENTRY DT.
"RTN","TIUR2",16,0)
 . S PDATTIM=9999999-PDATTIM
"RTN","TIUR2",17,0)
 S ADDMPRNT=+$P($G(^TIU(8925,TIUDA,0)),U,6) ; assume TIUDA is not component
"RTN","TIUR2",18,0)
 I '$D(^TIU(8925,ADDMPRNT,0)) S ADDMPRNT=0
"RTN","TIUR2",19,0)
 I ADDMPRNT D
"RTN","TIUR2",20,0)
 . S PVAL=$$RESOLVE^TIUR1(ADDMPRNT,SORTFLD)
"RTN","TIUR2",21,0)
 . S PDATTIM=$S(^TMP("TIUR",$J,"RTN")="TIUR":+$G(^TIU(8925,ADDMPRNT,13)),1:+$G(^TIU(8925,ADDMPRNT,12)))
"RTN","TIUR2",22,0)
 . S PDATTIM=9999999-PDATTIM
"RTN","TIUR2",23,0)
 S EXPAND=+$G(EXPAND)
"RTN","TIUR2",24,0)
 ; -- If TIUDA is not an ID kid, not addm, just quit: --
"RTN","TIUR2",25,0)
 I 'IDPRNT,'ADDMPRNT Q
"RTN","TIUR2",26,0)
 ; -- Take kid or addm out of array:
"RTN","TIUR2",27,0)
 S NODE=^TMP("TIUI",$J,SORTVAL,DATTIM,TIUDA)
"RTN","TIUR2",28,0)
 K ^TMP("TIUI",$J,SORTVAL,DATTIM,TIUDA)
"RTN","TIUR2",29,0)
 ; -- If TIUDA is an ID kid, put its parent in array:
"RTN","TIUR2",30,0)
 I IDPRNT D  Q
"RTN","TIUR2",31,0)
 . I '$D(EXPAND(IDPRNT)) S EXPAND(IDPRNT)="",EXPAND=EXPAND+1
"RTN","TIUR2",32,0)
 . S ^TMP("TIUI",$J,PVAL,PDATTIM,IDPRNT)=NODE
"RTN","TIUR2",33,0)
 ; -- If TIUDA is an addendum, put its (g)parent in array:
"RTN","TIUR2",34,0)
 I ADDMPRNT D  Q
"RTN","TIUR2",35,0)
 . I '$G(FORGETAD),'$D(EXPAND(ADDMPRNT)) S EXPAND(ADDMPRNT)="",EXPAND=EXPAND+1
"RTN","TIUR2",36,0)
 . S ADDMGPNT=+$G(^TIU(8925,ADDMPRNT,21))
"RTN","TIUR2",37,0)
 . I '$D(^TIU(8925,ADDMGPNT,0)) S ADDMGPNT=0
"RTN","TIUR2",38,0)
 . I ADDMGPNT D  I 1
"RTN","TIUR2",39,0)
 . . S GPVAL=$$RESOLVE^TIUR1(ADDMGPNT,SORTFLD)
"RTN","TIUR2",40,0)
 . . S GPDATTIM=$S(^TMP("TIUR",$J,"RTN")="TIUR":+$G(^TIU(8925,ADDMGPNT,13)),1:+$G(^TIU(8925,ADDMGPNT,12)))
"RTN","TIUR2",41,0)
 . . S GPDATTIM=9999999-GPDATTIM
"RTN","TIUR2",42,0)
 . . I '$D(EXPAND(ADDMGPNT)) S EXPAND(ADDMGPNT)="",EXPAND=EXPAND+1
"RTN","TIUR2",43,0)
 . . S ^TMP("TIUI",$J,GPVAL,GPDATTIM,ADDMGPNT)=NODE
"RTN","TIUR2",44,0)
 . E  S ^TMP("TIUI",$J,PVAL,PDATTIM,ADDMPRNT)=NODE
"RTN","TIUR2",45,0)
 Q
"RTN","TIUR2",46,0)
 ;
"RTN","TIUR2",47,0)
SETLIST(TIUORDER,VALMCNT,SCREEN) ; Set items from ^TMP("TIUI",$J) into
"RTN","TIUR2",48,0)
 ;List Template list
"RTN","TIUR2",49,0)
 N SORTVAL,TIUDTM,TIUDA
"RTN","TIUR2",50,0)
 S SORTVAL=""
"RTN","TIUR2",51,0)
 F  S SORTVAL=$O(^TMP("TIUI",$J,SORTVAL),TIUORDER) Q:SORTVAL=""  D
"RTN","TIUR2",52,0)
 . S TIUDTM=0
"RTN","TIUR2",53,0)
 . F  S TIUDTM=$O(^TMP("TIUI",$J,SORTVAL,TIUDTM)) Q:'TIUDTM  D
"RTN","TIUR2",54,0)
 . . S TIUDA=0
"RTN","TIUR2",55,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,SORTVAL,TIUDTM,TIUDA)) Q:'TIUDA  D
"RTN","TIUR2",56,0)
 . . . ; D ADDELMNT(TIUDA,.VALMCNT) ; P113
"RTN","TIUR2",57,0)
 . . . I SCREEN=1!(SCREEN="ALL") D ADDELMNT(TIUDA,.VALMCNT)
"RTN","TIUR2",58,0)
 . . . I SCREEN>1,$G(^TMP("TIUI",$J,SORTVAL,TIUDTM,TIUDA))=SCREEN D ADDELMNT(TIUDA,.VALMCNT)
"RTN","TIUR2",59,0)
 Q
"RTN","TIUR2",60,0)
 ;
"RTN","TIUR2",61,0)
PUTLIST(TIUPREF,TIUCLASS,STATUS,SCREEN) ; Puts elements in List Template list
"RTN","TIUR2",62,0)
 N TIUJ,TIUQ,TIUDA,TIUPICK,TIUORDER,TIUEXPKD,TIUSFLD
"RTN","TIUR2",63,0)
 S VALMCNT=0
"RTN","TIUR2",64,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIUR2",65,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIUR2",66,0)
 S TIUORDER=$S($P(TIUPREF,U,4)="A":1,1:-1) ;A for ascending
"RTN","TIUR2",67,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIUR2",68,0)
 S TIUQ="" F  S TIUQ=$O(^TMP("TIUI",$J,TIUQ)) Q:TIUQ']""  D
"RTN","TIUR2",69,0)
 . S TIUJ=0 F  S TIUJ=$O(^TMP("TIUI",$J,TIUQ,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUR2",70,0)
 . . S TIUDA=0
"RTN","TIUR2",71,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUR2",72,0)
 . . . D REPLACE(TIUDA,TIUQ,TIUSFLD,TIUJ,.TIUEXPKD)
"RTN","TIUR2",73,0)
 D SETLIST(TIUORDER,.VALMCNT,SCREEN)
"RTN","TIUR2",74,0)
 S ^TMP("TIUR",$J,0)=+$G(VALMCNT)_U_STATUS("WORDS")
"RTN","TIUR2",75,0)
 S TIUJ=0,SCREEN="" F  S TIUJ=$O(SCREEN(TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUR2",76,0)
 . S SCREEN=$G(SCREEN)_$S(TIUJ>1:";",1:U)_SCREEN(TIUJ)
"RTN","TIUR2",77,0)
 S ^TMP("TIUR",$J,0)=^TMP("TIUR",$J,0)_$G(SCREEN)
"RTN","TIUR2",78,0)
 S ^TMP("TIUR",$J,"CLASS")=TIUCLASS
"RTN","TIUR2",79,0)
 S ^TMP("TIUR",$J,"#")=TIUPICK_"^1:"_+$G(VALMCNT)
"RTN","TIUR2",80,0)
 I $D(VALMHDR)>9 D HDR^TIURH
"RTN","TIUR2",81,0)
 I +$G(VALMCNT)'>0 D
"RTN","TIUR2",82,0)
 . S ^TMP("TIUR",$J,1,0)="",VALMCNT=2
"RTN","TIUR2",83,0)
 . S ^TMP("TIUR",$J,2,0)="     No records found to satisfy search criteria."
"RTN","TIUR2",84,0)
 . S ^TMP("TIUR",$J,"IDX",1,0)="" ; User can't select lines 1 or 2
"RTN","TIUR2",85,0)
 . S ^TMP("TIUR",$J,"IDX",2,0)=""
"RTN","TIUR2",86,0)
 I '$G(TIURBLD),$D(TIUEXPKD) D EXPANDKD(.TIUEXPKD,STATUS("WORDS"))
"RTN","TIUR2",87,0)
 Q
"RTN","TIUR2",88,0)
 ;
"RTN","TIUR2",89,0)
EXPANDKD(TIUEXPKD,STATWORD,CONTEXT) ; Expand items to show kids that meet
"RTN","TIUR2",90,0)
 ;search criteria.
"RTN","TIUR2",91,0)
 ; Requires array TIUEXPKD, requires VALMCNT
"RTN","TIUR2",92,0)
 ; Requires nonnull: STATWORD (from TIUR1) or CONTEXT (from TIUROR).
"RTN","TIUR2",93,0)
 N TIUEXP2,YESEXPD,LINENO,HELP,TIUTWO
"RTN","TIUR2",94,0)
 ; -- Expand only for status unsigned or uncosigned, & not for "ALL":
"RTN","TIUR2",95,0)
 I STATWORD]"" Q:((STATWORD["ALL")!((STATWORD'["UNSIGNED")&(STATWORD'["UNCOSIGNED")))
"RTN","TIUR2",96,0)
 I $G(CONTEXT) Q:((CONTEXT'=2)&(CONTEXT'=3))  ;unsigned, uncosigned
"RTN","TIUR2",97,0)
 I (5*TIUEXPKD+$G(VALMCNT))>50 D  Q:'YESEXPD
"RTN","TIUR2",98,0)
 . W !!,"      There are ",TIUEXPKD," items (Interdisciplinary Notes, Addenda) to expand",!,"        in a list of ",VALMCNT," items."
"RTN","TIUR2",99,0)
 . S HELP="NO saves time building the list, but 'hides' relevant items under their parent until you expand the parent yourself."
"RTN","TIUR2",100,0)
 . S YESEXPD=$$READ^TIUU("Y","  Shall I take the extra time to expand them before I list them","NO",HELP)
"RTN","TIUR2",101,0)
 D LOAD^TIUROR1(.TIUEXPKD,.TIUEXP2)
"RTN","TIUR2",102,0)
 D BREATHE^TIUROR1(1)
"RTN","TIUR2",103,0)
 ; Try again if not in list til expanded once:
"RTN","TIUR2",104,0)
 ; (Can't use BREATHE^TIUROR1 again since it COLLAPSES now.)
"RTN","TIUR2",105,0)
 Q:'$D(TIUEXP2)
"RTN","TIUR2",106,0)
 S TIUDA=0
"RTN","TIUR2",107,0)
 F  S TIUDA=$O(TIUEXP2(TIUDA)) Q:'TIUDA  D
"RTN","TIUR2",108,0)
 . S LINENO=$O(^TMP("TIUR",$J,"IEN",TIUDA,0))
"RTN","TIUR2",109,0)
 . Q:'LINENO
"RTN","TIUR2",110,0)
 . S TIUTWO(LINENO)=""
"RTN","TIUR2",111,0)
 S LINENO=VALMCNT+1
"RTN","TIUR2",112,0)
 F  S LINENO=$O(TIUTWO(LINENO),-1) Q:'LINENO  D
"RTN","TIUR2",113,0)
 . D BREATHE^TIURL1(LINENO,1)
"RTN","TIUR2",114,0)
 Q
"RTN","TIUR2",115,0)
 ;
"RTN","TIUR2",116,0)
ADDELMNT(TIUDA,TIUCNT,APPEND) ; Add each element to the list
"RTN","TIUR2",117,0)
 N PT,ADT,DDT,AUT,AMD,EDT,SDT,XDT,TIULST4,INSTA,TIUSTN
"RTN","TIUR2",118,0)
 N TIUREC,TIUD0,TIUD12,TIUD13,TIUD15,TIULI,STATX,DOC
"RTN","TIUR2",119,0)
 N PREFIX,TIUGDATA
"RTN","TIUR2",120,0)
 I '$D(^TIU(8925,TIUDA,0)) Q
"RTN","TIUR2",121,0)
 I $G(^TMP("TIUR",$J,2,0))="     No records found to satisfy search criteria." D
"RTN","TIUR2",122,0)
 . K ^TMP("TIUR",$J,2),^TMP("TIUR",$J,"IDX",2),^TMP("TIUR",$J,"IDX",1)
"RTN","TIUR2",123,0)
 . S TIUCNT=0
"RTN","TIUR2",124,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD12=$G(^TIU(8925,TIUDA,12))
"RTN","TIUR2",125,0)
 S TIUD13=$G(^TIU(8925,TIUDA,13)),TIUD15=$G(^TIU(8925,TIUDA,15))
"RTN","TIUR2",126,0)
 S DOC=$$PNAME^TIULC1(+TIUD0)
"RTN","TIUR2",127,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIUR2",128,0)
 S PREFIX=$$PREFIX^TIULA2(TIUDA,0)
"RTN","TIUR2",129,0)
 S PT=$$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FI MI")
"RTN","TIUR2",130,0)
 S TIULI=$E(PT)
"RTN","TIUR2",131,0)
 S PT=PREFIX_PT
"RTN","TIUR2",132,0)
 S TIULST4=$E($P($G(^DPT(+$P(TIUD0,U,2),0)),U,9),6,9)
"RTN","TIUR2",133,0)
 S TIULST4="("_TIULI_TIULST4_")"
"RTN","TIUR2",134,0)
 S ADT=$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/YY")
"RTN","TIUR2",135,0)
 S DDT=$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/YY")
"RTN","TIUR2",136,0)
 S AMD=$$PERSNAME^TIULC1($P(TIUD12,U,8)) S:AMD="UNKNOWN" AMD=""
"RTN","TIUR2",137,0)
 S AUT=$$PERSNAME^TIULC1($P(TIUD12,U,2)) S:AUT="UNKNOWN" AUT=""
"RTN","TIUR2",138,0)
 S AMD=$$NAME^TIULS(AMD,"LAST, FI MI")
"RTN","TIUR2",139,0)
 S AUT=$$NAME^TIULS(AUT,"LAST, FI MI")
"RTN","TIUR2",140,0)
 S EDT=$$DATE^TIULS($P(TIUD13,U),"MM/DD/YY")
"RTN","TIUR2",141,0)
 S SDT=$S(+$P(TIUD15,U,7):+$P(TIUD15,U,7),+$P(TIUD0,U,5)'<7:+$P(TIUD15,U),1:"")
"RTN","TIUR2",142,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIUR2",143,0)
 S STATX=$P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U)
"RTN","TIUR2",144,0)
 S INSTA=""
"RTN","TIUR2",145,0)
 I +$P(TIUD12,U,12)>0 D
"RTN","TIUR2",146,0)
 . S TIUSTN=$$NS^XUAF4($P(TIUD12,U,12))
"RTN","TIUR2",147,0)
 . I $P(TIUSTN,U,2)]"" S INSTA=$P(TIUSTN,U,2)
"RTN","TIUR2",148,0)
 S INSTA=$E(INSTA,1,8)
"RTN","TIUR2",149,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUR2",150,0)
 S TIUREC=$$SETFLD^VALM1(TIUCNT,"","NUMBER")
"RTN","TIUR2",151,0)
 S TIUREC=$$SETFLD^VALM1(PT,TIUREC,"PATIENT NAME")
"RTN","TIUR2",152,0)
 S TIUREC=$$SETFLD^VALM1(TIULST4,TIUREC,"LAST I/LAST 4")
"RTN","TIUR2",153,0)
 S TIUREC=$$SETFLD^VALM1(DOC,TIUREC,"DOCUMENT TYPE")
"RTN","TIUR2",154,0)
 S TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"REF DATE")
"RTN","TIUR2",155,0)
 S TIUREC=$$SETFLD^VALM1($$LOWER^TIULS(STATX),TIUREC,"STATUS")
"RTN","TIUR2",156,0)
 S TIUREC=$$SETFLD^VALM1(SDT,TIUREC,"SIG DATE")
"RTN","TIUR2",157,0)
 S TIUREC=$$SETFLD^VALM1(AUT,TIUREC,"AUTHOR")
"RTN","TIUR2",158,0)
 S TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"EXPECTED COSIGNER")
"RTN","TIUR2",159,0)
 S TIUREC=$$SETFLD^VALM1(INSTA,TIUREC,"DIVISION")
"RTN","TIUR2",160,0)
 S ^TMP("TIUR",$J,TIUCNT,0)=TIUREC
"RTN","TIUR2",161,0)
 S ^TMP("TIUR",$J,"IDX",TIUCNT,TIUCNT)="" W:TIUCNT#10'>0 "."
"RTN","TIUR2",162,0)
 S ^TMP("TIURIDX",$J,TIUCNT)=TIUCNT_U_TIUDA_U_PREFIX
"RTN","TIUR2",163,0)
 S ^TMP("TIUR",$J,"IEN",TIUDA,TIUCNT)="" ;MARGY 11/11/00
"RTN","TIUR2",164,0)
 S TIUGDATA=$$IDDATA^TIURECL1(TIUDA,TIUD0)
"RTN","TIUR2",165,0)
 I TIUGDATA S ^TMP("TIUR",$J,"IDDATA",TIUDA)=TIUGDATA
"RTN","TIUR2",166,0)
 I +$G(APPEND) D
"RTN","TIUR2",167,0)
 . D RESTORE^VALM10(TIUCNT)
"RTN","TIUR2",168,0)
 . D CNTRL^VALM10(TIUCNT,1,$G(VALM("RM")),IOINHI,IOINORM),HDR^TIURH
"RTN","TIUR2",169,0)
 . S VALMSG="** Item(s) #"_$$ITMLIST(TIUCNT,$G(VALMSG))_" Added **"
"RTN","TIUR2",170,0)
 . S $P(^TMP("TIUR",$J,0),U)=TIUCNT
"RTN","TIUR2",171,0)
 . S $P(^TMP("TIUR",$J,"#"),":",2)=TIUCNT
"RTN","TIUR2",172,0)
 . S VALMCNT=TIUCNT
"RTN","TIUR2",173,0)
 . I $D(VALMHDR)>9 D HDR^TIURH
"RTN","TIUR2",174,0)
 Q
"RTN","TIUR2",175,0)
ITMLIST(TIUITM,TIUMSG) ; Add Message
"RTN","TIUR2",176,0)
 N TIULIST
"RTN","TIUR2",177,0)
 I $E($G(TIUMSG),1,7)'="** Item" S TIULIST=TIUITM G ITMLISTX
"RTN","TIUR2",178,0)
 S TIULIST=$P($P($G(TIUMSG)," Added **"),"#",2)_" & "_TIUITM
"RTN","TIUR2",179,0)
ITMLISTX Q $G(TIULIST)
"RTN","TIUR2",180,0)
 Q
"RTN","TIURC1")
0^17^B47421093
"RTN","TIURC1",1,0)
TIURC1 ; SLC/JER - Additional Review screen actions ;4/18/03
"RTN","TIURC1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,113**;Jun 20, 1997
"RTN","TIURC1",3,0)
 ;9/28 split TIURC, with COPY to end going here to new rtn TIURC1
"RTN","TIURC1",4,0)
COPY ; Copy
"RTN","TIURC1",5,0)
 N DA,DIE,DR,TIU,TIUCHNG,TIUDATA,TIUI,TIUY,Y,DIROUT
"RTN","TIURC1",6,0)
 N TIUVIEW,TIULST,TIUNREC,TIUDAARY,OLDNREC
"RTN","TIURC1",7,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURC1",8,0)
 S TIUI=0
"RTN","TIURC1",9,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURC1",10,0)
 . N TIU,RSTRCTD
"RTN","TIURC1",11,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURC1",12,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURC1",13,0)
 . I RSTRCTD D  Q
"RTN","TIURC1",14,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURC1",15,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURC1",16,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURC1",17,0)
 . I +TIUVIEW'>0 D  Q
"RTN","TIURC1",18,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIURC1",19,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURC1",20,0)
 . S OLDNREC=$G(TIUNREC)
"RTN","TIURC1",21,0)
 . D EN^VALM("TIU COPY DOCUMENT") ;generates list TIUNREC of new recs
"RTN","TIURC1",22,0)
 . K ^TMP("TIUVIEW",$J)
"RTN","TIURC1",23,0)
 . I $G(TIUNREC)'=OLDNREC D
"RTN","TIURC1",24,0)
 . . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURC1",25,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURC1",26,0)
 I +$G(TIUNREC) D
"RTN","TIURC1",27,0)
 . N TIUI,TIUNDA,TIUITEM
"RTN","TIURC1",28,0)
 . F TIUI=1:1:$L($G(TIUNREC),",") D
"RTN","TIURC1",29,0)
 . . S TIUNDA=$P(TIUNREC,",",TIUI),TIUITEM=+$G(^TMP("TIUR",$J,0))
"RTN","TIURC1",30,0)
 . . D ADDELMNT^TIUR2(TIUNDA,+TIUITEM,1)
"RTN","TIURC1",31,0)
 ;I $G(TIULST)]"" S VALMSG="** Item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_" Copied; See end of list **"
"RTN","TIURC1",32,0)
 ;E  S VALMSG="** No changes made... **"
"RTN","TIURC1",33,0)
 S TIUCHNG("REFRESH")=1
"RTN","TIURC1",34,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURC1",35,0)
 S VALMBCK="R"
"RTN","TIURC1",36,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"copied")
"RTN","TIURC1",37,0)
 Q
"RTN","TIURC1",38,0)
COPY1 ; Copy a document
"RTN","TIURC1",39,0)
 N TIUOD0,TIUOD12,TIUD13,TIUOD14,TIUOD17,TIUI,TIUPAT,TIUTNM,TIUTYP
"RTN","TIURC1",40,0)
 N TIUDPRM,TIUPOP,TIUCOPY,TIUVSUPP,DUOUT,DIROUT,DTOUT,TIUASK
"RTN","TIURC1",41,0)
 S TIUPOP=0
"RTN","TIURC1",42,0)
 I +$$ISADDNDM^TIULC1(TIUDA) D  Q
"RTN","TIURC1",43,0)
 . W !,$C(7),"ADDENDA may not be copied."
"RTN","TIURC1",44,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC1",45,0)
 S TIUCOPY=$$CANDO^TIULP(TIUDA,"COPY RECORD")
"RTN","TIURC1",46,0)
 I +TIUCOPY'>0 D  Q
"RTN","TIURC1",47,0)
 . W !!,$C(7),$P(TIUCOPY,U,2),!
"RTN","TIURC1",48,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURC1",49,0)
 S TIUOD0=$G(^TIU(8925,+TIUDA,0)),TIUOD12=$G(^(12)),TIUD13=$G(^(13))
"RTN","TIURC1",50,0)
 S TIUOD14=$G(^TIU(8925,+TIUDA,14)),TIUOD17=$G(^TIU(8925,+TIUDA,17))
"RTN","TIURC1",51,0)
 S TIUTYP=+TIUOD0
"RTN","TIURC1",52,0)
 D FULL^VALM1
"RTN","TIURC1",53,0)
 I $$CHKTITLE(+TIUTYP) D  Q:$G(TIUOUT)=1
"RTN","TIURC1",54,0)
 . N TIUDOC0,TIUDCLS
"RTN","TIURC1",55,0)
 . S TIUDOC0=$G(^TIU(8925.1,TIUTYP,0))
"RTN","TIURC1",56,0)
 . W !
"RTN","TIURC1",57,0)
 . I $P(TIUDOC0,U,7)=13 D
"RTN","TIURC1",58,0)
 . . W !,$C(7),$P(TIUDOC0,U,3)," is an inactive title."
"RTN","TIURC1",59,0)
 . W !,"You must now select a new, active title BEFORE the note is copied:",!
"RTN","TIURC1",60,0)
 . S TIUDCLS=+$$CLINDOC^TIULC1(+TIUTYP,TIUDA),TIUTYP=0
"RTN","TIURC1",61,0)
 . D DOCSPICK^TIULA2(.TIUTYP,TIUDCLS,"1A","","","+$$CANPICK^TIULP(+Y),+$$CANENTR^TIULP(+Y)")
"RTN","TIURC1",62,0)
 . I TIUTYP'>0 S TIUOUT=1
"RTN","TIURC1",63,0)
 . E  D
"RTN","TIURC1",64,0)
 . . S TIUTYP=$P($G(TIUTYP(1)),U,2)
"RTN","TIURC1",65,0)
 . . I $$CHKTITLE(+TIUTYP) S TIUOUT=1
"RTN","TIURC1",66,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM,TIUDA)
"RTN","TIURC1",67,0)
 S TIUTNM=$$PNAME^TIULC1(+TIUTYP)
"RTN","TIURC1",68,0)
 S TIUTYP(1)="1^"_+TIUTYP_U_TIUTNM_U
"RTN","TIURC1",69,0)
 W !!,"Please Choose One or More Patients for whom the document should be copied:",!
"RTN","TIURC1",70,0)
 F  D  Q:+TIUPOP
"RTN","TIURC1",71,0)
 . D PATIENT^ORU1(.TIUPAT,1)
"RTN","TIURC1",72,0)
 . I +TIUPAT'>0 D  Q
"RTN","TIURC1",73,0)
 . . W !,$C(7),"No patient(s) selected..."
"RTN","TIURC1",74,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W !
"RTN","TIURC1",75,0)
 . . S TIUCHNG=0,TIUPOP=1
"RTN","TIURC1",76,0)
 . S TIUI=0 F  S TIUI=$O(TIUPAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIURC1",77,0)
 . . N DA,DR,DFN,TIU,TIULMETH,TIUVMETH,TIUPATNM
"RTN","TIURC1",78,0)
 . . S DFN=+TIUPAT(TIUI),TIUPATNM=$P(TIUPAT(TIUI),U,2)
"RTN","TIURC1",79,0)
 . . S TIUVSUPP=+$$SUPPVSIT^TIULC1(TIUTYP)
"RTN","TIURC1",80,0)
 . . I TIUVSUPP'>0 D  I 1
"RTN","TIURC1",81,0)
 . . . S TIULMETH=$$GETLMETH^TIUEDI1(TIUTYP)
"RTN","TIURC1",82,0)
 . . . I '$L(TIULMETH) D  S TIUOUT=1 Q
"RTN","TIURC1",83,0)
 . . . . W !,$C(7),"No Visit Linkage Method defined for "
"RTN","TIURC1",84,0)
 . . . . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIURC1",85,0)
 . . . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC1",86,0)
 . . . W !!,"For Patient ",TIUPATNM
"RTN","TIURC1",87,0)
 . . . X TIULMETH
"RTN","TIURC1",88,0)
 . . E  D EVENT^TIUSRVP1(.TIU,DFN)
"RTN","TIURC1",89,0)
 . . I '$D(TIU("VSTR")) W !,$C(7),"Patient & Visit required." H 2 Q
"RTN","TIURC1",90,0)
 . . S TIUVMETH=$$GETVMETH^TIUEDI1(TIUTYP)
"RTN","TIURC1",91,0)
 . . I '$L(TIUVMETH) D  S TIUOUT=1 Q
"RTN","TIURC1",92,0)
 . . . W !,$C(7),"No Validation Method defined for "
"RTN","TIURC1",93,0)
 . . . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIURC1",94,0)
 . . X TIUVMETH
"RTN","TIURC1",95,0)
 . . I $D(TIU),+$G(TIUASK) D
"RTN","TIURC1",96,0)
 . . . N TIUNEW,TIUITEM,DA,DR,DIE
"RTN","TIURC1",97,0)
 . . . ;S DA=$$GETREC^TIUEDI1(DFN,.TIU,1,.TIUNEW,.TIUDPRM) Q:+DA'>0
"RTN","TIURC1",98,0)
 . . . S DA=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM) Q:+DA'>0
"RTN","TIURC1",99,0)
 . . . I '+$G(TIUNEW) D  Q
"RTN","TIURC1",100,0)
 . . . . W !!,$C(7),"A ",$P(TIUTYP(1),U,3)," already exists for this visit."
"RTN","TIURC1",101,0)
 . . . . W !,"You may not use the copy function to overwrite an existing ",!,$$UPPER^TIULS($$STATUS^TIULC(DA))," ",$P(TIUTYP(1),U,3),".",!
"RTN","TIURC1",102,0)
 . . . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC1",103,0)
 . . . D COPY0(DA,TIUOD0,.TIU),COPY12(DA,TIUOD0,TIUOD12,.TIU),COPY13(DA,TIUD13)
"RTN","TIURC1",104,0)
 . . . D COPY14(DA,TIUOD14,.TIU),COPY17(DA,TIUOD17),COPYTEXT(TIUDA,DA)
"RTN","TIURC1",105,0)
 . . . I $D(^TIU(8925,DA,"TEMP")) D MERGTEXT^TIUEDI1(DA,.TIU) K ^TIU(8925,+DA,"TEMP")
"RTN","TIURC1",106,0)
 . . . S DR=".05///"_$$UPPER^TIULS($$STATUS^TIULC(DA)),DIE=8925 D ^DIE
"RTN","TIURC1",107,0)
 . . . S TIUCHNG=1,TIUNREC=$G(TIUNREC)_$S(+$G(TIUNREC):",",1:"")_DA
"RTN","TIURC1",108,0)
 . . . I +$D(^TIU(8925,+DA,"TEXT"))>9!(+$O(^TIU(8925,"DAD",+DA,0))>0) D
"RTN","TIURC1",109,0)
 . . . . N TIUDA,TIUCPYNG S TIUDA=+DA,TIUCPYNG=1 D EDIT1^TIURA
"RTN","TIURC1",110,0)
 . S TIUPOP='+$$AGAIN
"RTN","TIURC1",111,0)
 Q
"RTN","TIURC1",112,0)
CHKTITLE(TIUTYP) ; Title Status
"RTN","TIURC1",113,0)
 N TIUBAD S TIUBAD=0
"RTN","TIURC1",114,0)
 I +$$CANPICK^TIULP(+TIUTYP)'>0 S TIUBAD=1 I 1
"RTN","TIURC1",115,0)
 E  I +$$CANENTR^TIULP(+TIUTYP)'>0 S TIUBAD=1
"RTN","TIURC1",116,0)
 Q TIUBAD
"RTN","TIURC1",117,0)
AGAIN() ; Ask again?
"RTN","TIURC1",118,0)
 N TIUY W !
"RTN","TIURC1",119,0)
 S TIUY=$$READ^TIUU("Y","Copy this note again","No")
"RTN","TIURC1",120,0)
 Q TIUY
"RTN","TIURC1",121,0)
COPY0(DA,TIUD0,TIU) ; Copy 0-node
"RTN","TIURC1",122,0)
 N DR,DIE S DIE=8925
"RTN","TIURC1",123,0)
 S DR=".02////"_DFN_";.03////"_$P($G(TIU("VISIT")),U)_";.04////"_$P(TIUD0,U,4)_";.07////"_$P($G(TIU("EDT")),U)_";.08////"_$P($G(TIU("LDT")),U)_";.09////"_$P(TIUD0,U,9)
"RTN","TIURC1",124,0)
 I $P($G(TIUDPRM(0)),U,16),'$P($G(^TIU(8925,+DA,0)),U,11),$$WORKOK^TIUPXAP1(+DA) S DR=DR_";.11////1" ;set flag to collect workload
"RTN","TIURC1",125,0)
 D ^DIE
"RTN","TIURC1",126,0)
 Q
"RTN","TIURC1",127,0)
COPY12(DA,TIUD0,TIUD12,TIU) ; Copy 12-node
"RTN","TIURC1",128,0)
 N DR,DIE S DIE=8925
"RTN","TIURC1",129,0)
 S DR="1201////"_$$NOW^TIULC_";1202////"_+$G(DUZ)_";1203////"_$P(TIUD12,U,3)_";1204////"_$G(DUZ)_";1205////"_$P($G(TIU("LOC")),U)
"RTN","TIURC1",130,0)
 S DR=DR_";1206////"_$P(TIUD12,U,6)_";1207////"_$P(TIUD12,U,7)_";1209////"_$P(TIUD12,U,9)
"RTN","TIURC1",131,0)
 I +$$REQCOSIG^TIULP(+TIUD0,DA,+$G(DUZ)) S DR=DR_";1208////"_$P(TIUD12,U,8)
"RTN","TIURC1",132,0)
 S DR=DR_";1210////"_$P(TIUD12,U,10)_";1211////"_+$G(TIU("VLOC"))_";1212////"_$P($G(TIU("INST")),U)
"RTN","TIURC1",133,0)
 D ^DIE
"RTN","TIURC1",134,0)
 Q
"RTN","TIURC1",135,0)
COPY13(DA,TIUD13,TIU) ; Copy 13-node
"RTN","TIURC1",136,0)
 N DR,DIE S DIE=8925
"RTN","TIURC1",137,0)
 S DR="1301////"_$$NOW^TIULC_";1302////"_$G(DUZ)_";1303////O;1307////"_$P(TIUD13,U,7)
"RTN","TIURC1",138,0)
 D ^DIE
"RTN","TIURC1",139,0)
 Q
"RTN","TIURC1",140,0)
COPY14(DA,TIUD14,TIU) ; Copy 14-node
"RTN","TIURC1",141,0)
 N DR,DIE S DIE=8925
"RTN","TIURC1",142,0)
 S DR="1401////"_$P($G(TIU("AD#")),U)_";1402////"_$P($G(TIU("TS")),U)_";1403////"_$P(TIUD14,U,3)_";1404////"_$P(TIUD14,U,4)
"RTN","TIURC1",143,0)
 D ^DIE
"RTN","TIURC1",144,0)
 Q
"RTN","TIURC1",145,0)
COPY17(DA,TIUD17) ; Copy Subject
"RTN","TIURC1",146,0)
 N DR,DIE S DIE=8925
"RTN","TIURC1",147,0)
 I $G(TIUD17)']"" Q
"RTN","TIURC1",148,0)
 S DR="1701////^S X=$G(TIUD17)" D ^DIE
"RTN","TIURC1",149,0)
 Q
"RTN","TIURC1",150,0)
COPYTEXT(TIUDA,DA) ; Copy text
"RTN","TIURC1",151,0)
 N TIUC,TIUI,TIUJ,TIULINE
"RTN","TIURC1",152,0)
 I +$O(^TIU(8925,+TIUDA,"TEXT",0)) M ^TIU(8925,+DA,"TEMP")=^TIU(8925,+TIUDA,"TEXT")
"RTN","TIURC1",153,0)
 S (TIUC,TIULINE)=0,TIUJ=+$P($G(^TIU(8925,+DA,"TEMP",0)),U,3)
"RTN","TIURC1",154,0)
 F  S TIUC=$O(^TIU(8925,"DAD",TIUDA,TIUC)) Q:+TIUC'>0  D
"RTN","TIURC1",155,0)
 . I +$$ISADDNDM^TIULC1(TIUC) Q
"RTN","TIURC1",156,0)
 . S TIUI=0 F  S TIUI=$O(^TIU(8925,+TIUC,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIURC1",157,0)
 . . S TIUJ=+$G(TIUJ)+1
"RTN","TIURC1",158,0)
 . . S ^TIU(8925,+DA,"TEMP",TIUJ,0)=$G(^TIU(8925,+TIUC,"TEXT",TIUI,0))
"RTN","TIURC1",159,0)
 . . S ^TIU(8925,+DA,"TEMP",0)="^^"_TIUJ_"^"_TIUJ_"^"_DT_"^^"
"RTN","TIURC1",160,0)
 Q
"RTN","TIURD1")
0^18^B63370691
"RTN","TIURD1",1,0)
TIURD1 ; SLC/JER - Reassign actions ;4/18/03
"RTN","TIURD1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,7,61,113**;Jun 20, 1997
"RTN","TIURD1",3,0)
MOVEADD(TIUDA) ; Move an addendum to another document
"RTN","TIURD1",4,0)
 N DFN,TIUDAT,TIUSCRN,TIUMOVE,TIUTYP,TIUODA
"RTN","TIURD1",5,0)
 S TIUTYP=$$CLINDOC^TIULC1(+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0)))
"RTN","TIURD1",6,0)
 I +TIUTYP'>0 S TIUTYP=38
"RTN","TIURD1",7,0)
 S TIUTYP(1)="1^"_TIUTYP_U_$P(^TIU(8925.1,+TIUTYP,0),U)
"RTN","TIURD1",8,0)
 S DFN=+$$PATIENT^TIULA
"RTN","TIURD1",9,0)
 I +DFN'>0 D  Q
"RTN","TIURD1",10,0)
 . W !!,"No PATIENT Selected: Aborting Transaction, No Harm Done...",!
"RTN","TIURD1",11,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD1",12,0)
 . S TIUOUT=1
"RTN","TIURD1",13,0)
 ; --- If moving to different pt, keep retracted original ---
"RTN","TIURD1",14,0)
 I +$G(DFN)'=$P(TIUD0(0),U,2),(+$P(TIUD0(0),U,5)>5) D
"RTN","TIURD1",15,0)
 . W !,"Moving signed document to another Patient...A RETRACTED copy will be retained."
"RTN","TIURD1",16,0)
 . S TIUODA=TIUDA,TIUDA=+$$RETRACT^TIURD2(TIUDA)
"RTN","TIURD1",17,0)
 Q:+TIUDA'>0
"RTN","TIURD1",18,0)
 D SELPAT^TIULA2(.TIUDAT,TIUTYP,DFN)
"RTN","TIURD1",19,0)
 I +$G(TIUDAT)'>0,($D(TIUDAT)'>9) S TIUOUT=1 G ABORT
"RTN","TIURD1",20,0)
 S TIUDAT=+$G(TIUDAT(1))
"RTN","TIURD1",21,0)
 I +$$ISADDNDM^TIULC1(TIUDAT) D  G ABORT
"RTN","TIURD1",22,0)
 . W !!,$C(7),"You may not assign an addendum to an addendum...",!
"RTN","TIURD1",23,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIURD1",24,0)
 . S TIUOUT=1
"RTN","TIURD1",25,0)
 D FROMTO^TIURD4(TIUDA,TIUDAT)
"RTN","TIURD1",26,0)
 I +$G(TIUDAT)>0,$$READ^TIUU("YO","Is this Correct","YES") D  Q
"RTN","TIURD1",27,0)
 . N TIUDD0,TIUDD12,TIUDD14
"RTN","TIURD1",28,0)
 . S TIUDD0=$G(^TIU(8925,+TIUDAT,0)),TIUDD12=$G(^(12)),TIUDD14=$G(^(14))
"RTN","TIURD1",29,0)
 . S DR=".02////"_$P(TIUDD0,U,2)_";.03////"_$P(TIUDD0,U,3)_";.06////"_+TIUDAT_";.07////"_$P(TIUDD0,U,7)_";.08////"_$S(+$P(TIUDD0,U,8):$P(TIUDD0,U,8),1:"@")_";.13////"_$P(TIUDD0,U,13)
"RTN","TIURD1",30,0)
 . S DR=DR_";1401////"_$P(TIUDD14,U)_";1402////"_$P(TIUDD14,U,2)_";1404////"_$P(TIUDD14,U,4)_";1205////"_$P(TIUDD12,U,5)_";1211////"_$P(TIUDD12,U,11)_";1212////"_$P(TIUDD12,U,12)
"RTN","TIURD1",31,0)
 . S DIE=8925,DA=+TIUDA D ^DIE
"RTN","TIURD1",32,0)
 . K DR N TIUTYP
"RTN","TIURD1",33,0)
 . S DR=".05///"_$$STATUS^TIULC(+TIUDA) D ^DIE
"RTN","TIURD1",34,0)
 . S TIUD0(1)=$G(^TIU(8925,TIUDA,0)),TIUD12(1)=$G(^(12))
"RTN","TIURD1",35,0)
 . D AUDREASS^TIURB1(TIUDA,.TIUD0,.TIUD12)
"RTN","TIURD1",36,0)
 . I +$G(TIUODA) D AUDREASS^TIURB1(TIUODA,.TIUD0,.TIUD12)
"RTN","TIURD1",37,0)
 . D SEND^TIUALRT(TIUDA)
"RTN","TIURD1",38,0)
 . W "." S TIUCHNG=1
"RTN","TIURD1",39,0)
ABORT ; Recover on abort
"RTN","TIURD1",40,0)
 W !!,"Okay...No Harm done!"
"RTN","TIURD1",41,0)
 I +$G(TIUODA),+$G(TIUDA),$D(TIUD0(0)) D RECOVER^TIURD4(TIUODA,TIUDA,.TIUD0)
"RTN","TIURD1",42,0)
 S TIUCHNG=0
"RTN","TIURD1",43,0)
 Q
"RTN","TIURD1",44,0)
PROMOTE(TIUDA) ; Promote addendum
"RTN","TIURD1",45,0)
 N DA,DR,DIE,TIUADD0,TIUTYPE,TIUPTYPE,TIUOUT,TIUVTYPE,TIUODA
"RTN","TIURD1",46,0)
 S TIUADD0=$G(^TIU(8925,+TIUDA,0))
"RTN","TIURD1",47,0)
 S TIUTYPE=+$G(^TIU(8925,+$P(TIUADD0,U,6),0)),TIUPTYPE=$P($G(^(0)),U,4),TIUVTYPE=$P($G(^(0)),U,13)
"RTN","TIURD1",48,0)
 S DR=".01////"_TIUTYPE_";.04////"_TIUPTYPE_";.06///@;.13////"_TIUVTYPE
"RTN","TIURD1",49,0)
 S DA=+TIUDA,DIE=8925
"RTN","TIURD1",50,0)
 D ^DIE K DA,DR,DIE
"RTN","TIURD1",51,0)
 D REASSIGO^TIURD3
"RTN","TIURD1",52,0)
 I +$G(TIUOUT)>0 D  Q
"RTN","TIURD1",53,0)
 . N DIE,DA,DR
"RTN","TIURD1",54,0)
 . I +$G(TIUODA),+$G(TIUDA),$D(TIUD0(0)) D RECOVER^TIURD4(TIUODA,TIUDA,.TIUD0)
"RTN","TIURD1",55,0)
 . W !!,"Restoring Addendum to original state..."
"RTN","TIURD1",56,0)
 . S DIE=8925,DA=$S(+$G(TIUODA):TIUODA,1:TIUDA)
"RTN","TIURD1",57,0)
 . S DR=".01////^S X=+TIUADD0;.04////^S X=$P(TIUADD0,U,4);.06////^S X=$P(TIUADD0,U,6)"
"RTN","TIURD1",58,0)
 . S DR=DR_";.07////^S X=$P(TIUADD0,U,7);.08////^S X=$S(+$P(TIUADD0,U,8):+$P(TIUADD0,U,8),1:""@"")"
"RTN","TIURD1",59,0)
 . D ^DIE
"RTN","TIURD1",60,0)
 ; If promotion successful & addendum retracted, reset 0-node of retracted record
"RTN","TIURD1",61,0)
 I +$G(TIUODA) D
"RTN","TIURD1",62,0)
 . N DIE,DA,DR
"RTN","TIURD1",63,0)
 . S DIE=8925,DA=TIUODA
"RTN","TIURD1",64,0)
 . S DR=".01////^S X=+TIUADD0;.04////^S X=$P(TIUADD0,U,4);.06////^S X=$P(TIUADD0,U,6)"
"RTN","TIURD1",65,0)
 . D ^DIE
"RTN","TIURD1",66,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIURD1",67,0)
 W !!,"ADDENDUM Promoted to be an ORIGINAL ",$$PNAME^TIULC1(TIUTYPE) H 2
"RTN","TIURD1",68,0)
 S TIUCHNG=1,VALMBCK="Q"
"RTN","TIURD1",69,0)
 Q
"RTN","TIURD1",70,0)
REPLACE(TIUDA) ; Replace original with addendum
"RTN","TIURD1",71,0)
 N TIUODA,TIUCONT,TIUOS,TIUAS,TIUOODA,TIUOD0
"RTN","TIURD1",72,0)
 W !!,$C(7),"This is an IRREVERSIBLE action..."
"RTN","TIURD1",73,0)
 S TIUCONT=$$READ^TIUU("YA","Are you SURE you wish to continue? ","NO")
"RTN","TIURD1",74,0)
 I '+TIUCONT S TIUCHNG=0 W !,"No changes made." Q
"RTN","TIURD1",75,0)
 W !,"Okay, here we go then..."
"RTN","TIURD1",76,0)
 S TIUODA=+$P(^TIU(8925,TIUDA,0),U,6) Q:+TIUODA'>0
"RTN","TIURD1",77,0)
 S TIUOD0=$G(^TIU(8925,TIUODA,0))
"RTN","TIURD1",78,0)
 I +$P(TIUOD0,U,5)>5 D
"RTN","TIURD1",79,0)
 . W !!,"A RETRACTED copy of the signed ORIGINAL will be retained.",!
"RTN","TIURD1",80,0)
 . S TIUOODA=TIUODA,TIUODA=$$RETRACT^TIURD2(TIUODA,"",+$P(TIUOD0,U,5),"",1)
"RTN","TIURD1",81,0)
 ; Load Signature
"RTN","TIURD1",82,0)
 D LOADSB^TIURD4(TIUODA,TIUDA,.TIUOS,.TIUAS)
"RTN","TIURD1",83,0)
 ; Move non-WP flds from add to orig
"RTN","TIURD1",84,0)
 D SWAPFLDS(TIUODA,TIUDA,0)
"RTN","TIURD1",85,0)
 ; Move original into ^TIU(8925,+TIUODA,"TEMP")
"RTN","TIURD1",86,0)
 D BUFFER^TIUEDIU(TIUODA) W "."
"RTN","TIURD1",87,0)
 ; Replace ^TIU(8925,+TIUODA,"TEMP") w ^TIU(8925,+TIUDA,"TEXT")
"RTN","TIURD1",88,0)
 K ^TIU(8925,+TIUODA,"TEMP")
"RTN","TIURD1",89,0)
 M ^TIU(8925,+TIUODA,"TEMP")=^TIU(8925,+TIUDA,"TEXT") W "."
"RTN","TIURD1",90,0)
 ; File changes
"RTN","TIURD1",91,0)
 K ^TIU(8925,+TIUODA,"TEXT")
"RTN","TIURD1",92,0)
 D MERGTEXT^TIUEDI1(TIUODA) W "."
"RTN","TIURD1",93,0)
 K ^TIU(8925,+TIUODA,"TEMP")
"RTN","TIURD1",94,0)
 ; Swap signatures
"RTN","TIURD1",95,0)
 D SWAPSB^TIURD4(TIUODA,TIUDA,.TIUOS,.TIUAS)
"RTN","TIURD1",96,0)
 ; Update status of new original
"RTN","TIURD1",97,0)
 D UPDSTAT^TIURD4(TIUODA)
"RTN","TIURD1",98,0)
 ; Resend alerts
"RTN","TIURD1",99,0)
 D SEND^TIUALRT(TIUODA)
"RTN","TIURD1",100,0)
 ; Delete Addendum Record
"RTN","TIURD1",101,0)
 D DELETE^TIUEDIT(TIUDA,0,"",1) W "...Done."
"RTN","TIURD1",102,0)
 S TIUCHNG=2 S:+$G(TIUOODA) TIUCHNG=TIUCHNG_U_TIUODA
"RTN","TIURD1",103,0)
 Q
"RTN","TIURD1",104,0)
SWAPADD(TIUDA) ; Swap addendum with original
"RTN","TIURD1",105,0)
 N TIUODA,TIUCONT K ^TMP("TIUSWAP",$J)
"RTN","TIURD1",106,0)
 N TIUOS,TIUAS
"RTN","TIURD1",107,0)
 W !!,$C(7),"Don't worry...This is a REVERSIBLE action."
"RTN","TIURD1",108,0)
 S TIUCONT=$$READ^TIUU("YA","Even so, are you SURE you wish to continue? ","NO")
"RTN","TIURD1",109,0)
 I '+TIUCONT S TIUCHNG=0 W !,"No changes made." Q
"RTN","TIURD1",110,0)
 W !,"Okay, you can always swap 'em back"
"RTN","TIURD1",111,0)
 S TIUODA=+$P(^TIU(8925,TIUDA,0),U,6) Q:+TIUODA'>0
"RTN","TIURD1",112,0)
 D LOADSB^TIURD4(TIUODA,TIUDA,.TIUOS,.TIUAS)
"RTN","TIURD1",113,0)
 ; Swap the non-WP flds
"RTN","TIURD1",114,0)
 D SWAPFLDS(TIUODA,TIUDA,1)
"RTN","TIURD1",115,0)
 ; Move original into ^TIU(8925,+TIUODA,"TEMP")
"RTN","TIURD1",116,0)
 D BUFFER^TIUEDIU(TIUODA) W "."
"RTN","TIURD1",117,0)
 ; Move ^TIU(8925,+TIUODA,"TEMP") into ^TMP("TIUSWAP",$J)
"RTN","TIURD1",118,0)
 M ^TMP("TIUSWAP",$J)=^TIU(8925,+TIUODA,"TEMP") W "."
"RTN","TIURD1",119,0)
 ; Replace ^TIU(8925,+TIUODA,"TEMP") with ^TIU(8925,+TIUDA,"TEXT")
"RTN","TIURD1",120,0)
 K ^TIU(8925,+TIUODA,"TEMP")
"RTN","TIURD1",121,0)
 M ^TIU(8925,+TIUODA,"TEMP")=^TIU(8925,+TIUDA,"TEXT") W "."
"RTN","TIURD1",122,0)
 ; File changes to orig
"RTN","TIURD1",123,0)
 K ^TIU(8925,+TIUODA,"TEXT")
"RTN","TIURD1",124,0)
 D MERGTEXT^TIUEDI1(TIUODA) W "."
"RTN","TIURD1",125,0)
 K ^TIU(8925,+TIUODA,"TEMP")
"RTN","TIURD1",126,0)
 ; Merge ^TMP("TIUSWAP",$J) into ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIURD1",127,0)
 K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIURD1",128,0)
 M ^TIU(8925,+TIUDA,"TEMP")=^TMP("TIUSWAP",$J) W "."
"RTN","TIURD1",129,0)
 ; File changes to add
"RTN","TIURD1",130,0)
 K ^TIU(8925,+TIUDA,"TEXT")
"RTN","TIURD1",131,0)
 D MERGTEXT^TIUEDI1(TIUDA) W "."
"RTN","TIURD1",132,0)
 ; Swap signatures
"RTN","TIURD1",133,0)
 D SWAPSB^TIURD4(TIUODA,TIUDA,.TIUOS,.TIUAS)
"RTN","TIURD1",134,0)
 ; Update status of each record
"RTN","TIURD1",135,0)
 D UPDSTAT^TIURD4(TIUODA),UPDSTAT^TIURD4(TIUDA)
"RTN","TIURD1",136,0)
 ; Resend alerts
"RTN","TIURD1",137,0)
 D SEND^TIUALRT(TIUDA),SEND^TIUALRT(TIUODA)
"RTN","TIURD1",138,0)
 ; Clean up ^TIU(8925,+TIUDA,"TEMP" and ^TMP("TIUSWAP",$J)
"RTN","TIURD1",139,0)
 K ^TIU(8925,+TIUDA,"TEMP"),^TMP("TIUSWAP",$J) W "...Done." S TIUCHNG=1
"RTN","TIURD1",140,0)
 Q
"RTN","TIURD1",141,0)
SWAPFLDS(TIUODA,TIUADA,SWAP) ; Move Identifier fields
"RTN","TIURD1",142,0)
 N DA,DR,DIE,TIUOD12,TIUAD12,TIUOD13,TIUAD13,TIUOD15,TIUAD15
"RTN","TIURD1",143,0)
 S TIUOD12=$G(^TIU(8925,TIUODA,12)),TIUOD13=$G(^(13)),TIUOD15=$G(^(15))
"RTN","TIURD1",144,0)
 S TIUAD12=$G(^TIU(8925,TIUADA,12)),TIUAD13=$G(^(13)),TIUAD15=$G(^(15))
"RTN","TIURD1",145,0)
 S DR="1201////"_$S(+TIUAD12>0:+TIUAD12,1:"@")_";1202////"_$P(TIUAD12,U,2)
"RTN","TIURD1",146,0)
 S DR=DR_";1204////"_$P(TIUAD12,U,4)_";1208////"_$S($P(TIUAD12,U,8)]"":$P(TIUAD12,U,8),1:"@")_";1209////"_$S($P(TIUAD12,U,9)]"":$P(TIUAD12,U,9),1:"@")
"RTN","TIURD1",147,0)
 S DA=TIUODA,DIE="^TIU(8925," D ^DIE K DR
"RTN","TIURD1",148,0)
 S DR="1302////"_$P(TIUAD13,U,2)_";1303////"_$P(TIUAD13,U,3)_";1304////"_$S($P(TIUAD13,U,4)]"":$P(TIUAD13,U,4),1:"@")
"RTN","TIURD1",149,0)
 S DR=DR_";1305////"_$S($P(TIUAD13,U,5)]"":$P(TIUAD13,U,5),1:"@")_";1306////"_$S($P(TIUAD13,U,6)]"":$P(TIUAD13,U,6),1:"@")_";1307////"_$S($P(TIUAD13,U,7)]"":$P(TIUAD13,U,7),1:"@")
"RTN","TIURD1",150,0)
 S DA=TIUODA,DIE="^TIU(8925," D ^DIE K DR
"RTN","TIURD1",151,0)
 S DR="1501////"_$S($P(TIUAD15,U)]"":$P(TIUAD15,U),1:"@")_";1502////"_$S($P(TIUAD15,U,2)]"":$P(TIUAD15,U,2),1:"@")
"RTN","TIURD1",152,0)
 S DR=DR_";1505////"_$S($P(TIUAD15,U,5)]"":$P(TIUAD15,U,5),1:"@")_";1506////"_$S($P(TIUAD15,U,6)]"":$P(TIUAD15,U,6),1:"@")
"RTN","TIURD1",153,0)
 S DA=TIUODA,DIE="^TIU(8925," D ^DIE K DR
"RTN","TIURD1",154,0)
 S DR="1507////"_$S($P(TIUAD15,U,7)]"":$P(TIUAD15,U,7),1:"@")_";1508////"_$S($P(TIUAD15,U,8)]"":$P(TIUAD15,U,8),1:"@")
"RTN","TIURD1",155,0)
 S DR=DR_";1511////"_$S($P(TIUAD15,U,11)]"":$P(TIUAD15,U,11),1:"@")_";1512////"_$S($P(TIUAD15,U,12)]"":$P(TIUAD15,U,12),1:"@")_";1513////"_$S($P(TIUAD15,U,13)]"":$P(TIUAD15,U,13),1:"@")
"RTN","TIURD1",156,0)
 S DA=TIUODA,DIE="^TIU(8925," D ^DIE K DR
"RTN","TIURD1",157,0)
 I '+$G(SWAP) Q
"RTN","TIURD1",158,0)
 S DR="1201////"_$S(+TIUOD12>0:+TIUOD12,1:"@")_";1202////"_$P(TIUOD12,U,2)
"RTN","TIURD1",159,0)
 S DR=DR_";1204////"_$P(TIUOD12,U,4)_";1208////"_$S($P(TIUOD12,U,8)]"":$P(TIUOD12,U,8),1:"@")_";1209////"_$S($P(TIUOD12,U,9)]"":$P(TIUOD12,U,9),1:"@")
"RTN","TIURD1",160,0)
 S DA=TIUADA,DIE="^TIU(8925," D ^DIE K DR
"RTN","TIURD1",161,0)
 S DR="1302////"_$P(TIUOD13,U,2)_";1303////"_$P(TIUOD13,U,3)_";1304////"_$S($P(TIUOD13,U,4)]"":$P(TIUOD13,U,4),1:"@")
"RTN","TIURD1",162,0)
 S DR=DR_";1305////"_$S($P(TIUOD13,U,5)]"":$P(TIUOD13,U,5),1:"@")_";1306////"_$S($P(TIUOD13,U,6)]"":$P(TIUOD13,U,6),1:"@")_";1307////"_$S($P(TIUOD13,U,7)]"":$P(TIUOD13,U,7),1:"@")
"RTN","TIURD1",163,0)
 S DA=TIUADA,DIE="^TIU(8925," D ^DIE K DR
"RTN","TIURD1",164,0)
 S DR="1501////"_$S($P(TIUOD15,U)]"":$P(TIUOD15,U),1:"@")_";1502////"_$S($P(TIUOD15,U,2)]"":$P(TIUOD15,U,2),1:"@")
"RTN","TIURD1",165,0)
 S DR=DR_";1505////"_$S($P(TIUOD15,U,5)]"":$P(TIUOD15,U,5),1:"@")_";1506////"_$S($P(TIUOD15,U,6)]"":$P(TIUOD15,U,6),1:"@")
"RTN","TIURD1",166,0)
 S DA=TIUADA,DIE="^TIU(8925," D ^DIE K DR
"RTN","TIURD1",167,0)
 S DR="1507////"_$S($P(TIUOD15,U,7)]"":$P(TIUOD15,U,7),1:"@")_";1508////"_$S($P(TIUOD15,U,8)]"":$P(TIUOD15,U,8),1:"@")
"RTN","TIURD1",168,0)
 S DR=DR_";1511////"_$S($P(TIUOD15,U,11)]"":$P(TIUOD15,U,11),1:"@")_";1512////"_$S($P(TIUOD15,U,12)]"":$P(TIUOD15,U,12),1:"@")_";1513////"_$S($P(TIUOD15,U,13)]"":$P(TIUOD15,U,13),1:"@")
"RTN","TIURD1",169,0)
 S DA=TIUADA,DIE="^TIU(8925," D ^DIE K DR
"RTN","TIURD1",170,0)
 Q
"RTN","TIURD2")
0^19^B69802772
"RTN","TIURD2",1,0)
TIURD2 ; SLC/JER - Reassignment following signature ;4/18/03
"RTN","TIURD2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**61,100,109,113**;Jun 20, 1997
"RTN","TIURD2",3,0)
RETRACT(TIUDA,TIUDAD,COPYSTAT,NEWDAD,SKIPADD) ; Retract document
"RTN","TIURD2",4,0)
 N TIUOD0,TIUOD12,TIUOD13,TIUOD14,TIUOD15,TIUOD16,TIUOD17,TIUI,TIUPAT
"RTN","TIURD2",5,0)
 N TIUDPRM,TIUCOPY,TIUVSUPP,DUOUT,DIROUT,DTOUT,DA,DR,DFN,TIU,TIULMETH
"RTN","TIURD2",6,0)
 N TIUTYP,TIUVMETH,TIUPATNM,TIUNREC,DFN,TIUNDAD,TIUTNM
"RTN","TIURD2",7,0)
 S TIUOD0=$G(^TIU(8925,+TIUDA,0)),TIUOD12=$G(^(12)),TIUOD13=$G(^(13))
"RTN","TIURD2",8,0)
 S TIUOD14=$G(^TIU(8925,+TIUDA,14)),TIUOD15=$G(^(15)),TIUOD16=$G(^(16))
"RTN","TIURD2",9,0)
 S TIUOD17=$G(^TIU(8925,+TIUDA,17))
"RTN","TIURD2",10,0)
 S TIUTYP=+TIUOD0,^TMP("TIURTRCT",$J,TIUDA,0)=TIUOD0,COPYSTAT=$G(COPYSTAT,5)
"RTN","TIURD2",11,0)
 I $S(+COPYSTAT=14:1,+COPYSTAT=15:1,1:0) D STATUS(TIUDA) G RTADD
"RTN","TIURD2",12,0)
 I +$P(TIUOD0,U,5)'>5 D:+$G(NEWDAD) LINKADD(TIUDA,NEWDAD) G RETRAX
"RTN","TIURD2",13,0)
 I +COPYSTAT'<7,+$G(NEWDAD) D LINKADD(TIUDA,NEWDAD) G RETRAX
"RTN","TIURD2",14,0)
 D FULL^VALM1
"RTN","TIURD2",15,0)
 ; --- Initialize document parameters ---
"RTN","TIURD2",16,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM,TIUDA)
"RTN","TIURD2",17,0)
 S TIUTNM=$$PNAME^TIULC1(+TIUTYP)
"RTN","TIURD2",18,0)
 ; --- Identify the patient ---
"RTN","TIURD2",19,0)
 S DFN=+$P(TIUOD0,U,2)
"RTN","TIURD2",20,0)
 I +DFN'>0 D  G RETRAX
"RTN","TIURD2",21,0)
 . W !,$C(7),"No patient selected..."
"RTN","TIURD2",22,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W !
"RTN","TIURD2",23,0)
 S TIUPATNM=$$PTNAME^TIULC1(DFN)
"RTN","TIURD2",24,0)
 ; --- Get visit info ---
"RTN","TIURD2",25,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIURD2",26,0)
 I '$D(TIU("VSTR")) W !,$C(7),"Patient & Visit required." H 2 G RETRAX
"RTN","TIURD2",27,0)
 I $D(TIU) D
"RTN","TIURD2",28,0)
 . N TIUNEW,TIUITEM,DA,DR,DIE
"RTN","TIURD2",29,0)
 . S DA=$$GETREC^TIUSRVP(DFN,.TIU,TIUTYP,.TIUNEW) Q:+DA'>0
"RTN","TIURD2",30,0)
 . I '+$G(TIUNEW) D  Q
"RTN","TIURD2",31,0)
 . . W !!,$C(7),"A ",TIUTNM," already exists for this visit."
"RTN","TIURD2",32,0)
 . . W !,"You may not use the reassign function to overwrite an existing ",!,$$UPPER^TIULS($$STATUS^TIULC(DA))," ",TIUTNM,".",!
"RTN","TIURD2",33,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD2",34,0)
 . D REMVSIT(TIUDA,TIUOD0)
"RTN","TIURD2",35,0)
 . D COPY0(DA,TIUOD0,.TIU,$G(TIUDAD),COPYSTAT),COPY12(DA,TIUOD12,.TIU)
"RTN","TIURD2",36,0)
 . D COPY13(DA,TIUOD13,.TIU,COPYSTAT),COPY14(DA,TIUOD14,.TIU)
"RTN","TIURD2",37,0)
 . D COPYSGNR(TIUDA,DA,COPYSTAT)
"RTN","TIURD2",38,0)
 . I COPYSTAT>5 D COPY15(DA,TIUOD15)
"RTN","TIURD2",39,0)
 . I COPYSTAT>6,$L(TIUOD16) S ^TIU(8925,+DA,16)=TIUOD16
"RTN","TIURD2",40,0)
 . I +$$REQCOSIG^TIULP(+TIUTYP,TIUDA,+$P(TIUOD12,U,4)),(COPYSTAT<6) D
"RTN","TIURD2",41,0)
 . . N DIE,DR S DIE=8925
"RTN","TIURD2",42,0)
 . . S DR="1506////1" D ^DIE
"RTN","TIURD2",43,0)
 . D COPY17^TIURC1(DA,TIUOD17),COPYTEXT^TIURC1(TIUDA,DA)
"RTN","TIURD2",44,0)
 . I $D(^TIU(8925,DA,"TEMP")) D MERGTEXT^TIUEDI1(DA,.TIU) K ^TIU(8925,+DA,"TEMP")
"RTN","TIURD2",45,0)
 . S DR=".05///"_$$UPPER^TIULS($$STATUS^TIULC(DA))_";.1////^S X=$$LINECNT^TIULC(DA);1406////"_TIUDA
"RTN","TIURD2",46,0)
 . S DIE=8925 D ^DIE
"RTN","TIURD2",47,0)
 . D AUDIT^TIUEDI1(DA,0,$$CHKSUM^TIULC("^TIU(8925,"_+DA_",""TEXT"")"))
"RTN","TIURD2",48,0)
 . S ^TMP("TIURTRCT",$J,"NEW",DA)=""
"RTN","TIURD2",49,0)
 . S:'+$G(TIUDAD) TIUNDAD=DA
"RTN","TIURD2",50,0)
 . S TIUNREC=$G(TIUNREC)_$S(+$G(TIUNREC):",",1:"")_DA
"RTN","TIURD2",51,0)
 . D STATUS(TIUDA)
"RTN","TIURD2",52,0)
 ; If SKIPADD is TRUE, bypass retraction of addenda...
"RTN","TIURD2",53,0)
 I +$G(SKIPADD) G RETRAX
"RTN","TIURD2",54,0)
RTADD ; Retract all addenda
"RTN","TIURD2",55,0)
 N TIUDADD S TIUDADD=0
"RTN","TIURD2",56,0)
 F  S TIUDADD=$O(^TIU(8925,"DAD",TIUDA,TIUDADD)) Q:+TIUDADD'>0  D
"RTN","TIURD2",57,0)
 . I '$$ISADDNDM^TIULC1(TIUDADD) Q
"RTN","TIURD2",58,0)
 . D ADDENDEL^TIUALRT(TIUDADD)
"RTN","TIURD2",59,0)
 . S TIUNREC=$G(TIUNREC)_$S(+$G(TIUNREC):",",1:"")_$$RETRACT(TIUDADD,TIUDA,$G(COPYSTAT),$G(TIUNDAD))
"RTN","TIURD2",60,0)
RETRAX Q +$G(TIUNREC)
"RTN","TIURD2",61,0)
REMVSIT(DA,TIUOD0) ; Remove VISIT from Retracted Doc
"RTN","TIURD2",62,0)
 N DIE,DR,SVCAT,TIUPOP S TIUPOP=0
"RTN","TIURD2",63,0)
 S SVCAT=$P(TIUOD0,U,13)
"RTN","TIURD2",64,0)
 I +$$ISADDNDM^TIULC1(DA) D  Q:+TIUPOP
"RTN","TIURD2",65,0)
 . I +$P($G(^TIU(8925,+$P(TIUOD0,U,6),0)),U,3)>0 S TIUPOP=1 Q
"RTN","TIURD2",66,0)
 . S:SVCAT="" SVCAT=$P($G(^TIU(8925,+$P(TIUOD0,U,6),0)),U,13)
"RTN","TIURD2",67,0)
 I SVCAT="H" Q
"RTN","TIURD2",68,0)
 W !,"Removing RETRACTED ",TIUTNM," from original Visit..."
"RTN","TIURD2",69,0)
 S DIE=8925,DR=".03///@" D ^DIE
"RTN","TIURD2",70,0)
 Q
"RTN","TIURD2",71,0)
LINKADD(DA,TIUDAD) ; Link addendum (DA) to TIUDAD
"RTN","TIURD2",72,0)
 N DR,DIE
"RTN","TIURD2",73,0)
 S DIE=8925,DR=".06////^S X=TIUDAD" D ^DIE
"RTN","TIURD2",74,0)
 Q
"RTN","TIURD2",75,0)
COPY0(DA,TIUD0,TIU,TIUDAD,STATUS) ; Copy root node
"RTN","TIURD2",76,0)
 N DR,DIE S DIE=8925,STATUS=$G(STATUS,5)
"RTN","TIURD2",77,0)
 S DR=".02////"_DFN_";.03////"_$P(TIUD0,U,3)_";.04////"_$P(TIUD0,U,4)_";.05////"_STATUS_";.06////"_$P(TIUD0,U,6)_";.07////"_$P(TIUD0,U,7)_";.08////"_$P(TIUD0,U,8)_";.09////"_$P(TIUD0,U,9)_";.12////"_$P(TIUD0,U,12)_";.13////"_$P(TIUD0,U,13)
"RTN","TIURD2",78,0)
 I $P($G(TIUDPRM(0)),U,16),'$P($G(^TIU(8925,+DA,0)),U,11),$$WORKOK^TIUPXAP1(+DA) S DR=DR_";.11////1" ;set flag to collect workload
"RTN","TIURD2",79,0)
 D ^DIE
"RTN","TIURD2",80,0)
 Q
"RTN","TIURD2",81,0)
COPY12(DA,TIUD12,TIU) ; Copy 12-node
"RTN","TIURD2",82,0)
 N DR,DIE S DIE=8925
"RTN","TIURD2",83,0)
 S DR="1201////"_+$$NOW^XLFDT_";1202////"_+$P(TIUD12,U,2)_";1203////"_$P(TIUD12,U,3)_";1204////"_$P(TIUD12,U,4)_";1205////"_$P(TIUD12,U,5)
"RTN","TIURD2",84,0)
 S DR=DR_";1206////"_$P(TIUD12,U,6)_";1207////"_$P(TIUD12,U,7)_";1208////"_$P(TIUD12,U,8)_";1209////"_$P(TIUD12,U,9)
"RTN","TIURD2",85,0)
 S DR=DR_";1210////"_$P(TIUD12,U,10)_";1211////"_$P(TIUD12,U,11)_";1212////"_$P(TIUD12,U,12)
"RTN","TIURD2",86,0)
 D ^DIE
"RTN","TIURD2",87,0)
 Q
"RTN","TIURD2",88,0)
COPY13(DA,TIUD13,TIU,STATUS) ; Copy 13-node
"RTN","TIURD2",89,0)
 N DR,DIE,TIUDT,TIURDT S DIE=8925,TIUDT=$P(TIUD13,U)
"RTN","TIURD2",90,0)
 S TIURDT=$S(+$$ISDS^TIULX(+$G(^TIU(8925,DA,0))):+$$REFDATE^TIULC1(.TIU,TIUDT),1:TIUDT)
"RTN","TIURD2",91,0)
 S:'TIURDT TIURDT=TIUDT
"RTN","TIURD2",92,0)
 S DR="1301////"_TIURDT_";1302////"_$P(TIUD13,U,2)_";1303////O"
"RTN","TIURD2",93,0)
 S DR=DR_";1304////"_$S(STATUS<4:"@",1:TIUDT)
"RTN","TIURD2",94,0)
 S DR=DR_";1305////"_$S(STATUS<5:"@",1:TIUDT)
"RTN","TIURD2",95,0)
 S DR=DR_";1306////"_$S(STATUS<5:"@",+$P(TIUD13,U,6):$P(TIUD13,U,6),1:DUZ)
"RTN","TIURD2",96,0)
 S DR=DR_";1307////"_$P(TIUD13,U,7)
"RTN","TIURD2",97,0)
 D ^DIE
"RTN","TIURD2",98,0)
 Q
"RTN","TIURD2",99,0)
COPY14(DA,TIUD14,TIU) ; Copy 14-node
"RTN","TIURD2",100,0)
 N DR,DIE S DIE=8925
"RTN","TIURD2",101,0)
 S DR="1401////"_$P(TIUD14,U)_";1402////"_$P(TIUD14,U,2)
"RTN","TIURD2",102,0)
 S DR=DR_";1403////"_$P(TIUD14,U,3)_";1404////"_$P(TIUD14,U,4)
"RTN","TIURD2",103,0)
 S DR=DR_";1405////^S X=$P(TIUD14,U,5)"
"RTN","TIURD2",104,0)
 D ^DIE
"RTN","TIURD2",105,0)
 Q
"RTN","TIURD2",106,0)
COPYSGNR(TIUDA,TIUCDA,COPYSTAT) ; Copy Add'nal Signers
"RTN","TIURD2",107,0)
 N TIUSDA S TIUSDA=0
"RTN","TIURD2",108,0)
 F  S TIUSDA=$O(^TIU(8925.7,"B",TIUDA,TIUSDA)) Q:+TIUSDA'>0  D
"RTN","TIURD2",109,0)
 . N TIUSD0,DA,DR,DIC,DIE,DLAYGO
"RTN","TIURD2",110,0)
 . S TIUSD0=$G(^TIU(8925.7,TIUSDA,0))
"RTN","TIURD2",111,0)
 . S (DIC,DLAYGO)=8925.7,DIC(0)="LX",X=""""_"`"_TIUCDA_"""" D ^DIC Q:+Y'>0
"RTN","TIURD2",112,0)
 . S DA=+Y,DIE=DIC,DR=".02////^S X=0;.03////^S X=$P(TIUSD0,U,3)"
"RTN","TIURD2",113,0)
 . I COPYSTAT>5 D
"RTN","TIURD2",114,0)
 . . S DR=DR_";.04////^S X=$P(TIUSD0,U,4);.05////^S X=$P(TIUSD0,U,5)"
"RTN","TIURD2",115,0)
 . . S DR=DR_";.06////^S X=$P(TIUSD0,U,6);.07////^S X=$P(TIUSD0,U,7)"
"RTN","TIURD2",116,0)
 . . S DR=DR_";.08////^S X=$P(TIUSD0,U,8)"
"RTN","TIURD2",117,0)
 . D ^DIE
"RTN","TIURD2",118,0)
 Q
"RTN","TIURD2",119,0)
COPY15(DA,TIUD15) ; Copy 15-node
"RTN","TIURD2",120,0)
 N DR,DIE S DIE=8925
"RTN","TIURD2",121,0)
 S DR="1501////"_$P(TIUD15,U)_";1502////"_$P(TIUD15,U,2)_";1503////^S X=$P(TIUD15,U,3);1504////^S X=$P(TIUD15,U,4)"
"RTN","TIURD2",122,0)
 S DR=DR_";1505////"_$P(TIUD15,U,5)_";1506////"_$P(TIUD15,U,6)_";1507////"_$P(TIUD15,U,7)_";1508////"_$P(TIUD15,U,8)
"RTN","TIURD2",123,0)
 S DR=DR_";1509////^S X=$P(TIUD15,U,9);1510////^S X=$P(TIUD15,U,10);1511////"_$P(TIUD15,U,11)_";1512////"_$P(TIUD15,U,12)
"RTN","TIURD2",124,0)
 S DR=DR_";1513////"_$P(TIUD15,U,13)
"RTN","TIURD2",125,0)
 D ^DIE
"RTN","TIURD2",126,0)
 Q
"RTN","TIURD2",127,0)
STATUS(DA) ; Set original's status to "RETRACTED"
"RTN","TIURD2",128,0)
 N DIE,DR,DIC
"RTN","TIURD2",129,0)
 S DIE=8925,DR=".05///RETRACTED" D ^DIE
"RTN","TIURD2",130,0)
 D ALERTDEL^TIUALRT(DA),DELIRT^TIUDIRT(DA)
"RTN","TIURD2",131,0)
 Q
"RTN","TIURD2",132,0)
ATTACH(TIUDA,TIUDADD) ; Attach TIUDADD as addendum to TIUDA
"RTN","TIURD2",133,0)
 N DR,DIE,DA,TIUD0,TIUD12,TIUD14,TIUDADA
"RTN","TIURD2",134,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD14=$G(^(14))
"RTN","TIURD2",135,0)
 S DIE="^TIU(8925,",DA=TIUDADD
"RTN","TIURD2",136,0)
 S DR=".01////81;.02////^S X=$P(TIUD0,U,2);.03////^S X=$P(TIUD0,U,3);.04////^S X=$$DOCCLASS^TIULC1(81)"
"RTN","TIURD2",137,0)
 S DR=DR_";.06////^S X=TIUDA;.07////^S X=$P(TIUD0,U,7);.08////^S X=$P(TIUD0,U,8)"
"RTN","TIURD2",138,0)
 D ^DIE
"RTN","TIURD2",139,0)
 S DR="1205////^S X=$P(TIUD12,U,5);1211////^S X=$P(TIUD12,U,11);1212////^S X=$P(TIUD12,U,12)"
"RTN","TIURD2",140,0)
 D ^DIE
"RTN","TIURD2",141,0)
 S DR="1301////^S X="_$$REFDTA(TIUDA,TIUDADD,TIUD0)
"RTN","TIURD2",142,0)
 S DR=DR_";1401////^S X=$P(TIUD14,U);1402////^S X=$P(TIUD14,U,2)"
"RTN","TIURD2",143,0)
 D ^DIE
"RTN","TIURD2",144,0)
 ; If TIUDADD has addenda, re-attach them as addenda to TIUDA
"RTN","TIURD2",145,0)
 S TIUDADA=0
"RTN","TIURD2",146,0)
 F  S TIUDADA=$O(^TIU(8925,"DAD",TIUDADD,TIUDADA)) Q:+TIUDADA'>0  D
"RTN","TIURD2",147,0)
 . Q:'+$$ISADDNDM^TIULC1(TIUDADA)
"RTN","TIURD2",148,0)
 . D ATTACH(TIUDA,TIUDADA),SEND^TIUALRT(TIUDADA) W "."
"RTN","TIURD2",149,0)
 W !!,"Done." S TIUCHNG=1
"RTN","TIURD2",150,0)
 Q
"RTN","TIURD2",151,0)
REFDTO(TIUDA,TIU) ; Compute reference date
"RTN","TIURD2",152,0)
 N TIUY,TIUD12,TIUD13
"RTN","TIURD2",153,0)
 S TIUD12=$G(^TIU(8925,+TIUDA,12)),TIUD13=$G(^(13))
"RTN","TIURD2",154,0)
 S TIUY=+TIU("LDT")
"RTN","TIURD2",155,0)
 I TIUY>0 G REFDTOX
"RTN","TIURD2",156,0)
 I +$P(TIUD13,U,7) S TIUY=+$P(TIUD13,U,7) G REFDTOX
"RTN","TIURD2",157,0)
 S TIUY=+$P(TIUD12,U)
"RTN","TIURD2",158,0)
REFDTOX Q TIUY
"RTN","TIURD2",159,0)
REFDTA(TIUDA,TIUDADD,TIUD0) ; Compute reference date for addenda
"RTN","TIURD2",160,0)
 N TIUY,TIUDAD12,TIUDAD13
"RTN","TIURD2",161,0)
 S TIUDAD12=$G(^TIU(8925,+TIUDADD,12)),TIUDAD13=$G(^(13))
"RTN","TIURD2",162,0)
 S TIUY=+TIUDAD13
"RTN","TIURD2",163,0)
 I +$$ISDS^TIULX(+TIUD0)'>0 G REFDTAX
"RTN","TIURD2",164,0)
 I +$P(TIUDAD13,U) S TIUY=+$P(TIUDAD13,U) G REFDTAX
"RTN","TIURD2",165,0)
 I +$P(TIUDAD13,U,7) S TIUY=+$P(TIUDAD13,U,7) G REFDTAX
"RTN","TIURD2",166,0)
 S TIUY=+$P(TIUDAD12,U)
"RTN","TIURD2",167,0)
REFDTAX Q TIUY
"RTN","TIURD2",168,0)
UPDTADD(TIUDA) ; Addenda for reassigned original are updated
"RTN","TIURD2",169,0)
 I $$HASADDEN^TIULC1(+TIUDA) D
"RTN","TIURD2",170,0)
 . N DA
"RTN","TIURD2",171,0)
 . W !!,$C(7),"Addenda for this Document will now be updated..."
"RTN","TIURD2",172,0)
 . S DA=0 F  S DA=$O(^TIU(8925,"DAD",+TIUDA,DA)) Q:+DA'>0  D
"RTN","TIURD2",173,0)
 . . N DR,DIE,TIUD0,TIUD12,TIUD14
"RTN","TIURD2",174,0)
 . . I '+$$ISADDNDM^TIULC1(+DA) Q
"RTN","TIURD2",175,0)
 . . S TIUD0(0)=$G(^TIU(8925,+DA,0)),TIUD12(0)=$G(^(12))
"RTN","TIURD2",176,0)
 . . S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD14=$G(^(14))
"RTN","TIURD2",177,0)
 . . S DR=".02////"_$P(TIUD0,U,2)_";.03////"_$S($P(TIUD0,U,3)="":"@",1:$P(TIUD0,U,3))_";.04////"_$P(TIUD0,U,4)_";.07////"_$P(TIUD0,U,7)_";.08////"_$S(+$P(TIUD0,U,8):$P(TIUD0,U,8),1:"@")_";.13////"_$P(TIUD0,U,13)
"RTN","TIURD2",178,0)
 . . S DR=DR_";1401////"_$P(TIUD14,U)_";1402////"_$P(TIUD14,U,2)
"RTN","TIURD2",179,0)
 . . S DIE=8925 D ^DIE
"RTN","TIURD2",180,0)
 . . S DR="1205////"_$P(TIUD12,U,5)_";1211////"_$P(TIUD12,U,11)_";1212////"_$P(TIUD12,U,12)
"RTN","TIURD2",181,0)
 . . D ^DIE
"RTN","TIURD2",182,0)
 . . S DR="1301////^S X="_$$REFDTA^TIURD2(TIUDA,DA,TIUD0)
"RTN","TIURD2",183,0)
 . . D ^DIE W "."
"RTN","TIURD2",184,0)
 . . ; Remove and resend alerts
"RTN","TIURD2",185,0)
 . . D SEND^TIUALRT(DA)
"RTN","TIURD2",186,0)
 . . S TIUD0(1)=$G(^TIU(8925,+DA,0)),TIUD12(1)=$G(^(12))
"RTN","TIURD2",187,0)
 . . D AUDREASS^TIURB1(DA,.TIUD0,.TIUD12)
"RTN","TIURD2",188,0)
 . . ; If the addendum was retracted, post its audit trail info as well
"RTN","TIURD2",189,0)
 . . I +$P($G(^TIU(8925,DA,14)),U,6) D
"RTN","TIURD2",190,0)
 . . . D AUDREASS^TIURB1(+$P(^TIU(8925,DA,14),U,6),.TIUD0,.TIUD12)
"RTN","TIURD2",191,0)
 Q
"RTN","TIURD2",192,0)
VLOC(LOCDA)     ; Resolve location pointer
"RTN","TIURD2",193,0)
 Q $P($G(^SC(LOCDA,0)),U)
"RTN","TIURD2",194,0)
GETSIG() ; Challenge user for Electronic Signature, when appropriate
"RTN","TIURD2",195,0)
 N X,X1,X2,TIUY S TIUY=0
"RTN","TIURD2",196,0)
 D SIG^XUSESIG
"RTN","TIURD2",197,0)
 I X1']"" D  G GETSIGX
"RTN","TIURD2",198,0)
 . W !!,$C(7),$C(7),"You MUST Enter your CORRECT Electronic Signature to Complete this Task...",!
"RTN","TIURD2",199,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIURD2",200,0)
 S TIUY=1
"RTN","TIURD2",201,0)
GETSIGX Q +$G(TIUY)
"RTN","TIURD3")
0^20^B65352875
"RTN","TIURD3",1,0)
TIURD3  ; SLC/JER - Reassign actions ;4/18/03
"RTN","TIURD3",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**61,124,113**;Jun 20, 1997
"RTN","TIURD3",3,0)
REASSIGO ; Reassign an original Document
"RTN","TIURD3",4,0)
 N TIU,TIUASK,TIUDPRM
"RTN","TIURD3",5,0)
 W !!,"Please choose the correct PATIENT and CARE EPISODE:",!
"RTN","TIURD3",6,0)
 ; --- Get a patient ---
"RTN","TIURD3",7,0)
 S DFN=+$$PATIENT^TIULA
"RTN","TIURD3",8,0)
 ; --- If no pt. selected, QUIT ---
"RTN","TIURD3",9,0)
 I +$G(DFN)'>0 D  Q
"RTN","TIURD3",10,0)
 . S TIUOUT=1
"RTN","TIURD3",11,0)
 . W !!,"No PATIENT Selected: Aborting Transaction, No Harm Done...",!
"RTN","TIURD3",12,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",13,0)
 ; --- If moving to another pt keep retracted original ---
"RTN","TIURD3",14,0)
 I +$G(DFN)'=$P(TIUD0(0),U,2),(+$P(TIUD0(0),U,5)>5) D
"RTN","TIURD3",15,0)
 . W !!,"Moving signed document to another Patient...A RETRACTED copy will be retained.",!
"RTN","TIURD3",16,0)
 . S TIUODA=TIUDA,TIUDA=+$$RETRACT^TIURD2(TIUDA)
"RTN","TIURD3",17,0)
 I TIUDA'>0 D  Q
"RTN","TIURD3",18,0)
 . S TIUOUT=1
"RTN","TIURD3",19,0)
 . W !!,"Creation of a new Copy of the RETRACTED record failed...Contact IRM.",!
"RTN","TIURD3",20,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",21,0)
 ; --- Get Document Parameters for TIUTYPE
"RTN","TIURD3",22,0)
 D DOCPRM^TIULC1(TIUTYPE,.TIUDPRM)
"RTN","TIURD3",23,0)
 ; --- Get associated visit ---
"RTN","TIURD3",24,0)
 S TIULMETH=$$GETLMETH^TIUEDI1(TIUTYPE)
"RTN","TIURD3",25,0)
 I '$L(TIULMETH) D  Q
"RTN","TIURD3",26,0)
 . S TIUOUT=1
"RTN","TIURD3",27,0)
 . W !!,$C(7),"No Visit Linkage Method defined for "
"RTN","TIURD3",28,0)
 . W $$PNAME^TIULC1(TIUTYPE),".",!,"Please contact IRM...",!
"RTN","TIURD3",29,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",30,0)
 X TIULMETH
"RTN","TIURD3",31,0)
 I '$D(TIU) D  Q
"RTN","TIURD3",32,0)
 . S TIUOUT=1
"RTN","TIURD3",33,0)
 . W !!,$C(7),"Patient & Visit required: Aborting Transaction...No Harm Done.",!
"RTN","TIURD3",34,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",35,0)
 ; --- Validate Selection ---
"RTN","TIURD3",36,0)
 S TIUVMETH=$$GETVMETH^TIUEDI1(TIUTYPE)
"RTN","TIURD3",37,0)
 I '$L(TIUVMETH) D  Q
"RTN","TIURD3",38,0)
 . S TIUOUT=1
"RTN","TIURD3",39,0)
 . W !!,$C(7),"No Validation Method defined for "
"RTN","TIURD3",40,0)
 . W $$PNAME^TIULC1(TIUTYPE),".",!,"Please contact IRM...",!
"RTN","TIURD3",41,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",42,0)
 X TIUVMETH
"RTN","TIURD3",43,0)
 I +$G(TIUASK)'>0 D  Q
"RTN","TIURD3",44,0)
 . S TIUOUT=1
"RTN","TIURD3",45,0)
 . W !!,$C(7),"Okay, No Harm Done.",!
"RTN","TIURD3",46,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD3",47,0)
 ; --- If same Pt & Visit, abort transaction ---
"RTN","TIURD3",48,0)
 I +$G(TIU("VISIT"))=$P(TIUD0(0),U,3) D  Q:+$G(TIUOUT)
"RTN","TIURD3",49,0)
 . I +$G(TIUADD0),+$P($G(TIUDPRM(0)),U,10) Q
"RTN","TIURD3",50,0)
 . S TIUOUT=1
"RTN","TIURD3",51,0)
 . W !!,$C(7),$C(7),$C(7),"This ",$$PNAME^TIULC1(TIUTYPE)," is already associated with the selected visit...",!
"RTN","TIURD3",52,0)
 . W !,"No action taken.",!
"RTN","TIURD3",53,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",54,0)
 ; --- If valid Pt and Visit, Reassign the document ---
"RTN","TIURD3",55,0)
 I $L($G(TIU("VSTR"))) D
"RTN","TIURD3",56,0)
 . N DA,DR,DIE,TIUORIG,TIUOLD0
"RTN","TIURD3",57,0)
 . S TIUORIG=+$O(^TIU(8925,"APTLD",DFN,TIUTYPE,$G(TIU("VSTR")),0))
"RTN","TIURD3",58,0)
 . S TIUOLD0=$G(^TIU(8925,+TIUORIG,0))
"RTN","TIURD3",59,0)
 . ; If record exists and >1 documents/visit NOT allowed, offer
"RTN","TIURD3",60,0)
 . ; chance to attach record as addendum
"RTN","TIURD3",61,0)
 . I +TIUORIG,(+$P(TIUDPRM(0),U,10)'>0),(+$P(TIUOLD0,U,5)'>13) D  Q
"RTN","TIURD3",62,0)
 . . N TIUATT
"RTN","TIURD3",63,0)
 . . I TIUORIG=TIUDA D  Q
"RTN","TIURD3",64,0)
 . . . W !,$C(7),$C(7),$C(7),"This ",$$PNAME^TIULC1(TIUTYPE)," is already associated with the selected visit...",!
"RTN","TIURD3",65,0)
 . . . W !,"No action taken.",!
"RTN","TIURD3",66,0)
 . . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",67,0)
 . . W !!,$C(7),$C(7),$C(7),"This patient already has a "
"RTN","TIURD3",68,0)
 . . W $$UP^XLFSTR($$PNAME^TIULC1(TIUTYPE))," for the selected care"
"RTN","TIURD3",69,0)
 . . W !,"episode. Do you wish to make the current record an ADDENDUM of that ",!,$$UP^XLFSTR($$PNAME^TIULC1(TIUTYPE)),"?",!
"RTN","TIURD3",70,0)
 . . S TIUATT=$$READ^TIUU("YOA","   ...OK? ","YES")
"RTN","TIURD3",71,0)
 . . I +TIUATT'>0 D  Q
"RTN","TIURD3",72,0)
 . . . W !!,"All right. No harm done.",!
"RTN","TIURD3",73,0)
 . . . S TIUOUT=1
"RTN","TIURD3",74,0)
 . . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",75,0)
 . . D DELIRT^TIUDIRT($S(+$G(TIUODA):+TIUODA,1:+TIUDA))
"RTN","TIURD3",76,0)
 . . D ATTACH^TIURD2(+TIUORIG,TIUDA),SEND^TIUALRT(TIUDA) S TIUCHNG=1
"RTN","TIURD3",77,0)
 . ; --- Roll back old IRT data ---
"RTN","TIURD3",78,0)
 . D DELIRT^TIUDIRT($S(+$G(TIUODA):+TIUODA,1:+TIUDA))
"RTN","TIURD3",79,0)
 . ; --- Set up the ^DIE Call ---
"RTN","TIURD3",80,0)
 . S DR=$G(DR)_".02////"_DFN_";.03////"_$S(+$P($G(TIU("VISIT")),U):$P($G(TIU("VISIT")),U),1:"@")_";.07////"_$P($G(TIU("EDT")),U)_";.08////"_$S(+$G(TIU("LDT")):$P($G(TIU("LDT")),U),1:"@")_";.13////"_$P($G(TIU("VSTR")),";",3)
"RTN","TIURD3",81,0)
 . S DR=DR_";1205////"_$P($G(TIU("LOC")),U)_";1401////"_$S($L($G(TIU("AD#"))):+$G(TIU("AD#")),1:"@")_";1402////"_$P($G(TIU("TS")),U)_";1211////"_$P($G(TIU("VLOC")),U)_";1212////"_$P($G(TIU("INST")),U)
"RTN","TIURD3",82,0)
 . S:+$$ISDS^TIULX(TIUTYPE) DR=DR_";1301////^S X="_$$REFDTO^TIURD2(TIUDA,.TIU)
"RTN","TIURD3",83,0)
 . ; --- Don't ask author or cosigner for documents that have been signed ---
"RTN","TIURD3",84,0)
 . S:+$P($G(^TIU(8925,+TIUDA,0)),U,5)'>5 DR=DR_";1202;1204////^S X=$P(^TIU(8925,DA,12),U,2);I '+$P($G(^TIU(8925,+TIUDA,12)),U,8) S Y=0;1208"
"RTN","TIURD3",85,0)
 . ; --- Call ^DIE to affect the Reassignment ---
"RTN","TIURD3",86,0)
 . S DA=TIUDA,DIE=8925 D ^DIE
"RTN","TIURD3",87,0)
 . ; --- Post-reassignment Steps ---
"RTN","TIURD3",88,0)
 . ; 1. Package Reassign Action:
"RTN","TIURD3",89,0)
 . D PKGACT(TIUDA,.TIUD0,.TIUD12,.TIUD13,.TIUD14,.TIUOUT)
"RTN","TIURD3",90,0)
 . Q:+$G(TIUOUT)
"RTN","TIURD3",91,0)
 . W !!,$G(TIUNAME)," Reassigned.",!
"RTN","TIURD3",92,0)
 . ; 2. Attach document to new Visit
"RTN","TIURD3",93,0)
 . D QUE^TIUPXAP1
"RTN","TIURD3",94,0)
 . ; 3. Update Addenda to Document
"RTN","TIURD3",95,0)
 . D UPDTADD^TIURD2(TIUDA)
"RTN","TIURD3",96,0)
 . ; 4. Update IRT Record
"RTN","TIURD3",97,0)
 . D UPDTIRT^TIUDIRT(.TIU,+TIUDA)
"RTN","TIURD3",98,0)
 . ; 5. Send Signature Alerts
"RTN","TIURD3",99,0)
 . D SEND^TIUALRT(TIUDA)
"RTN","TIURD3",100,0)
 . ; 6. Audit Reassignment
"RTN","TIURD3",101,0)
 . S TIUD0(1)=$G(^TIU(8925,+TIUDA,0)),TIUD12(1)=$G(^(12))
"RTN","TIURD3",102,0)
 . D AUDREASS^TIURB1(TIUDA,.TIUD0,.TIUD12)
"RTN","TIURD3",103,0)
 . ; 7. If document was retracted, register audit trail for it
"RTN","TIURD3",104,0)
 . I +$G(TIUODA) D AUDREASS^TIURB1(TIUODA,.TIUD0,.TIUD12)
"RTN","TIURD3",105,0)
 . I +$P($G(TIUD0(0)),U,3) D WKLD(.TIUD0,.TIUD12)
"RTN","TIURD3",106,0)
 . ;Finally, collect workload for target visit as appropriate
"RTN","TIURD3",107,0)
 . I (+$P(^TIU(8925,+TIUDA,0),U,5)>6),+$P(^TIU(8925,+TIUDA,0),U,11) D
"RTN","TIURD3",108,0)
 . . I $P(+$G(TIU("EDT")),".")'>DT D  Q:'+TIUASK
"RTN","TIURD3",109,0)
 . . . W !!,"You may now edit the encounter data for the DESTINATION Visit...",!
"RTN","TIURD3",110,0)
 . . . W !,"Patient: ",$G(TIU("PNM")),!,"  Visit: ",$P($G(TIU("EDT")),U,2)," to ",$P($G(TIU("VLOC")),U,2)
"RTN","TIURD3",111,0)
 . . . W ! S TIUASK=+$$READ^TIUU("Y","Do you wish to do this now","NO")
"RTN","TIURD3",112,0)
 . . ;If no workload process using TIU's interview
"RTN","TIURD3",113,0)
 . . ;else, process using PCE's interview
"RTN","TIURD3",114,0)
 . . I '$$CHKVST^TIUPXAP2(+TIUDA) D  I 1
"RTN","TIURD3",115,0)
 . . . N TIUCONT,TIUPRMT
"RTN","TIURD3",116,0)
 . . . Q:$D(XWBOS)
"RTN","TIURD3",117,0)
 . . . I $P(+$P(^TIU(8925,+TIUDA,0),U,7),".")>DT D  Q
"RTN","TIURD3",118,0)
 . . . . W !!
"RTN","TIURD3",119,0)
 . . . . D QUE^TIUPXAP1
"RTN","TIURD3",120,0)
 . . . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",121,0)
 . . . ;W !!
"RTN","TIURD3",122,0)
 . . . ;need workload? if yes enter
"RTN","TIURD3",123,0)
 . . . I $$CHKWKL^TIUPXAP2(+TIUDA,.TIUDPRM) D CREDIT^TIUVSIT(TIUDA)
"RTN","TIURD3",124,0)
 . . E  D
"RTN","TIURD3",125,0)
 . . . ;need workload? if yes enter
"RTN","TIURD3",126,0)
 . . . I $$CHKWKL^TIUPXAP2(+TIUDA,.TIUDPRM) D EDTENC^TIUPXAP2(TIUDA)
"RTN","TIURD3",127,0)
 . S TIUCHNG=1 S:+$G(TIUODA) TIUCHNG=TIUCHNG_U_TIUDA
"RTN","TIURD3",128,0)
 . W ! I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",129,0)
 Q
"RTN","TIURD3",130,0)
 ;
"RTN","TIURD3",131,0)
WKLD(TIUD0,TIUD12) ; Allow user to clean up workload for visit from which document was removed
"RTN","TIURD3",132,0)
 N TIUVSIT,TIUWHAT,TIUERR,TIUDFN,TIUEDT,TIUHL
"RTN","TIURD3",133,0)
 I $S($P(TIUD0(0),U,13)="H":1,$P(TIUD0(0),U,13)="E":1,1:0) Q
"RTN","TIURD3",134,0)
 S TIUHL=$P(TIUD12(0),U,11)
"RTN","TIURD3",135,0)
 I $P($G(^SC(+TIUHL,0)),U,3)'="C" Q
"RTN","TIURD3",136,0)
 S TIUDFN=$P(TIUD0(0),U,2),TIUEDT=$P(TIUD0(0),U,7),TIUVSIT=$P(TIUD0(0),U,3)
"RTN","TIURD3",137,0)
 W !,"You may now clean up the encounter data for the ORIGINAL Visit...",!
"RTN","TIURD3",138,0)
 W !,"Patient: ",$$PTNAME^TIULC1(TIUDFN),!,"  Visit: ",$$DATE^TIULS(TIUEDT,"AMTH DD, CCYY@HR:MIN")," to ",$$VLOC^TIURD2(TIUHL)
"RTN","TIURD3",139,0)
 W ! I '+$$READ^TIUU("Y","Do you wish to do this now","NO") Q
"RTN","TIURD3",140,0)
 I $G(VALMAR)'="^TMP(""TIUR"",$J)" W !!,"Editing Encounter Data...",!
"RTN","TIURD3",141,0)
 S TIUWHAT=$S($$CHKAPPT^TIUPXAP2(TIUVSIT,TIUDFN,TIUEDT,TIUHL):"INTV",1:"ADDEDIT")
"RTN","TIURD3",142,0)
 S TIUERR=$$INTV^PXAPI(TIUWHAT,"TIU","TEXT INTEGRATION UTILITIES",.TIUVSIT,$S(+$G(TIUVSIT):"",1:TIUHL),TIUDFN,$S(+$G(TIUVSIT):"",1:TIUEDT))
"RTN","TIURD3",143,0)
 ;
"RTN","TIURD3",144,0)
 ;If an error is returned prompt to continue otherwise if a Visit
"RTN","TIURD3",145,0)
 ;IEN is returned and one is not already defined update the document
"RTN","TIURD3",146,0)
 ;I +TIUERR<0 D  I 1
"RTN","TIURD3",147,0)
 ;. W ! I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",148,0)
 ;E  I +$G(TIUVSIT),(+$G(TIUVSIT)'=$P($G(^TIU(8925,+TIUDA,0)),U,3)) D
"RTN","TIURD3",149,0)
 ;.  
"RTN","TIURD3",150,0)
 Q
"RTN","TIURD3",151,0)
PKGACT(TIUDA,TIUD0,TIUD12,TIUD13,TIUD14,TIUOUT) ; Get/Execute Package Reassign Action
"RTN","TIURD3",152,0)
 N TIUREASX,TIUPOP
"RTN","TIURD3",153,0)
 S TIUREASX=$$REASSIGN^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIURD3",154,0)
 I TIUREASX]"" D  Q:+$G(TIUPOP)
"RTN","TIURD3",155,0)
 . X TIUREASX
"RTN","TIURD3",156,0)
 . I +$G(TIUPOP) D  Q
"RTN","TIURD3",157,0)
 . . S TIUOUT=1
"RTN","TIURD3",158,0)
 . . D WHOABACK(TIUDA,TIUD0(0),TIUD12(0),TIUD13(0),TIUD14(0))
"RTN","TIURD3",159,0)
 . . W !!,$C(7),"Can't Reassign this document...",!
"RTN","TIURD3",160,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",161,0)
 . ; --- If original was retracted, call package Delete Action to roll-back ---
"RTN","TIURD3",162,0)
 . I +$G(TIUODA) D
"RTN","TIURD3",163,0)
 . . N TIUDA,TIUDELX
"RTN","TIURD3",164,0)
 . . S TIUDA=TIUODA
"RTN","TIURD3",165,0)
 . . S TIUDELX=$$DELETE^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIURD3",166,0)
 . . I TIUDELX]"" X TIUDELX
"RTN","TIURD3",167,0)
 Q
"RTN","TIURD3",168,0)
 ;
"RTN","TIURD3",169,0)
WHOABACK(DA,TIUD0,TIUD12,TIUD13,TIUD14) ; Undo Reassign when fails
"RTN","TIURD3",170,0)
 N DIE,DR S DIE=8925
"RTN","TIURD3",171,0)
 S DR=".02////"_$P(TIUD0,U,2)_";.03////"_$P(TIUD0,U,3)_";.07////"_$P(TIUD0,U,7)_";.08////"_$P(TIUD0,U,8)_";.13////"_$P(TIUD0,U,13)
"RTN","TIURD3",172,0)
 S DR=DR_";1205////"_$P(TIUD12,U,5)_";1401////"_$P(TIUD14,U)_";1402////"_$P(TIUD14,U,2)_";1211////"_$P(TIUD12,U,11)_";1212////"_$P(TIUD12,U,12)
"RTN","TIURD3",173,0)
 D ^DIE
"RTN","TIURD3",174,0)
 I +$P($G(^TIU(8925,+DA,0)),U,5)'>5 D
"RTN","TIURD3",175,0)
 . S DR="1202////"_$P(TIUD12,U,2)_";1305////"_$P(TIUD13,U,5)_";1306////"_$P(TIUD13,U,6)_";1208////"_$P(TIUD12,U,8)_";1209////"_$P(TIUD12,U,9)
"RTN","TIURD3",176,0)
 . S DIE=8925 D ^DIE
"RTN","TIURD3",177,0)
 Q
"RTN","TIURDIV")
0^21^B58639766
"RTN","TIURDIV",1,0)
TIURDIV ; SLC/JAK - Review unsig/uncosig Documents by DIVISION ;12/01/03
"RTN","TIURDIV",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**113**;Jun 20, 1997
"RTN","TIURDIV",3,0)
 ; Multidivisional Enhancements - from BUF/DCN - modified by SLC/JAK
"RTN","TIURDIV",4,0)
 ;
"RTN","TIURDIV",5,0)
BEGIN ; Select Division(s), Entry Date Range, Service, Type of Report
"RTN","TIURDIV",6,0)
 N TIUI,TIUSTDT,TIUENDT,TIUSVCS
"RTN","TIURDIV",7,0)
 D SELDIV^TIULA Q:SELDIV'>0
"RTN","TIURDIV",8,0)
 I $D(TIUDI) D
"RTN","TIURDIV",9,0)
 . S TIUI=0 F  S TIUI=$O(TIUDI(TIUI)) Q:'TIUI  D
"RTN","TIURDIV",10,0)
 . . S TIUDI("ENTRIES")=$G(TIUDI("ENTRIES"))_TIUI_";"
"RTN","TIURDIV",11,0)
 E  D
"RTN","TIURDIV",12,0)
 . S TIUDI("ENTRIES")="ALL DIVISIONS"
"RTN","TIURDIV",13,0)
 ;
"RTN","TIURDIV",14,0)
 ;Ask Date Range, exit if timeout, '^' or no selection
"RTN","TIURDIV",15,0)
 Q:'$$ASKRNG(.TIUSTDT,.TIUENDT)
"RTN","TIURDIV",16,0)
 ;
"RTN","TIURDIV",17,0)
 ;Select Service, exit if timeout, '^' or no selection
"RTN","TIURDIV",18,0)
 Q:'$$SELSVC^TIULA(.TIUSVCS)
"RTN","TIURDIV",19,0)
 ;
"RTN","TIURDIV",20,0)
 N DIR,DIRUT,DTOUT,DUOUT,TIURPT
"RTN","TIURDIV",21,0)
 S DIR(0)="S^F:FULL;S:SUMMARY",DIR("A")="Type of Report"
"RTN","TIURDIV",22,0)
 S DIR("?",1)="Summary lists the number of documents by author's"
"RTN","TIURDIV",23,0)
 S DIR("?",2)="service/section. Full lists detailed document"
"RTN","TIURDIV",24,0)
 S DIR("?",3)="information by author's service/section."
"RTN","TIURDIV",25,0)
 S DIR("?")="Enter ""^"", or a RETURN to quit."
"RTN","TIURDIV",26,0)
 D ^DIR Q:$D(DIRUT)  S TIURPT=Y
"RTN","TIURDIV",27,0)
 I TIURPT="F" W !!,"This report must be sent to a 132-column device.",!
"RTN","TIURDIV",28,0)
 ;
"RTN","TIURDIV",29,0)
DEV ; Device selection
"RTN","TIURDIV",30,0)
 S %ZIS="Q" W ! D ^%ZIS I POP K POP G EXIT
"RTN","TIURDIV",31,0)
 I TIURPT="F",IOM'>131 W !!,"You must select a 132-column device." G DEV
"RTN","TIURDIV",32,0)
 I $D(IO("Q")) D  G EXIT
"RTN","TIURDIV",33,0)
 . S ZTRTN="BUILD^TIURDIV"
"RTN","TIURDIV",34,0)
 . S ZTSAVE("TIUDI(")="",ZTSAVE("TIURPT")=""
"RTN","TIURDIV",35,0)
 . S ZTSAVE("TIUSTDT")="",ZTSAVE("TIUENDT")=""
"RTN","TIURDIV",36,0)
 . S ZTSAVE("TIUSVCS")="",ZTSAVE("TIUSVCS(")=""
"RTN","TIURDIV",37,0)
 . S ZTDESC="TIU UNSIG/UNCOSIG DOCS BY DIV"
"RTN","TIURDIV",38,0)
 . D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","TIURDIV",39,0)
 . K ZTSK,ZTDESC,ZTRTN,ZTSAVE,%ZIS,TIUDIV,TIURPT,TIUIFP
"RTN","TIURDIV",40,0)
 . D HOME^%ZIS
"RTN","TIURDIV",41,0)
 U IO D BUILD,^%ZISC
"RTN","TIURDIV",42,0)
 Q
"RTN","TIURDIV",43,0)
BUILD ; Build list
"RTN","TIURDIV",44,0)
 N TIUIFP,TIUK
"RTN","TIURDIV",45,0)
 K ^TMP("TIUD",$J)
"RTN","TIURDIV",46,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","TIURDIV",47,0)
 I +$G(TIUDI("ENTRIES")) D
"RTN","TIURDIV",48,0)
 . S TIUK=0 F  S TIUK=$O(TIUDI(TIUK)) Q:'TIUK  D
"RTN","TIURDIV",49,0)
 . . S TIUIFP=$G(TIUDI(TIUK))
"RTN","TIURDIV",50,0)
 . . D GATHER(TIUIFP,TIUSTDT,TIUENDT,.TIUSVCS)
"RTN","TIURDIV",51,0)
 E  D
"RTN","TIURDIV",52,0)
 . S TIUIFP=0
"RTN","TIURDIV",53,0)
 . F  S TIUIFP=$O(^TIU(8925,"ADIV",TIUIFP)) Q:+TIUIFP'>0  D
"RTN","TIURDIV",54,0)
 . . D GATHER(TIUIFP,TIUSTDT,TIUENDT,.TIUSVCS)
"RTN","TIURDIV",55,0)
 D PRINT(TIUSTDT,TIUENDT)
"RTN","TIURDIV",56,0)
 ;
"RTN","TIURDIV",57,0)
EXIT ; Clean up and exit
"RTN","TIURDIV",58,0)
 K SELDIV,TIUDI,TIUSTDT,TIUENDT,TIUSVCS K ^TMP("TIUD",$J)
"RTN","TIURDIV",59,0)
 Q
"RTN","TIURDIV",60,0)
GATHER(TIUIFP,TIUSTDT,TIUENDT,TIUSVCS) ; Find records for the list
"RTN","TIURDIV",61,0)
 ; Input   -- TIUIFP  INSTITUTION file (#4) IEN
"RTN","TIURDIV",62,0)
 ;            (0 = gather all divisions)
"RTN","TIURDIV",63,0)
 ;            TIUSTDT Start Date
"RTN","TIURDIV",64,0)
 ;            TIUENDT End Date
"RTN","TIURDIV",65,0)
 ;            TIUSVCS Service Selection Array
"RTN","TIURDIV",66,0)
 ; Output  -- None
"RTN","TIURDIV",67,0)
 N TIUDA,TIUJ,TIUS,TIUTP
"RTN","TIURDIV",68,0)
 S TIUTP=0
"RTN","TIURDIV",69,0)
 F  S TIUTP=$O(^TIU(8925,"ADIV",TIUIFP,TIUTP)) Q:+TIUTP'>0  D
"RTN","TIURDIV",70,0)
 . S TIUS=4
"RTN","TIURDIV",71,0)
 . F  S TIUS=$O(^TIU(8925,"ADIV",TIUIFP,TIUTP,TIUS)) Q:+TIUS'>0!(+TIUS>6)  D
"RTN","TIURDIV",72,0)
 . . S TIUJ=0
"RTN","TIURDIV",73,0)
 . . F  S TIUJ=$O(^TIU(8925,"ADIV",TIUIFP,TIUTP,TIUS,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIURDIV",74,0)
 . . . S TIUDA=0
"RTN","TIURDIV",75,0)
 . . . F  S TIUDA=$O(^TIU(8925,"ADIV",TIUIFP,TIUTP,TIUS,TIUJ,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIURDIV",76,0)
 . . . . D ADDELMNT(TIUDA,TIUSTDT,TIUENDT,.TIUSVCS)
"RTN","TIURDIV",77,0)
 Q
"RTN","TIURDIV",78,0)
 ;
"RTN","TIURDIV",79,0)
ADDELMNT(TIUDA,TIUSTDT,TIUENDT,TIUSVCS) ; Add each element to the list
"RTN","TIURDIV",80,0)
 ; Input  -- TIUDA   TIU DOCUMENT file (#8925) IEN
"RTN","TIURDIV",81,0)
 ;           TIUSTDT Start Date
"RTN","TIURDIV",82,0)
 ;           TIUENDT End Date
"RTN","TIURDIV",83,0)
 ;           TIUSVCS Service Selection Array
"RTN","TIURDIV",84,0)
 ; Output -- None
"RTN","TIURDIV",85,0)
 N TIUAU,TIUD12,TIUEDT,TIUIFP,TIUSVC
"RTN","TIURDIV",86,0)
 S TIUD12=$G(^TIU(8925,TIUDA,12))
"RTN","TIURDIV",87,0)
 S TIUEDT=+$P(TIUD12,U),TIUAU=+$P(TIUD12,U,2),TIUIFP=+$P(TIUD12,U,12)
"RTN","TIURDIV",88,0)
 ;Check Date Range
"RTN","TIURDIV",89,0)
 I TIUEDT,TIUEDT>TIUSTDT,TIUEDT<TIUENDT D
"RTN","TIURDIV",90,0)
 . S TIUSVC=$$PROVSVC^TIULV(TIUAU)
"RTN","TIURDIV",91,0)
 . ;Check Service
"RTN","TIURDIV",92,0)
 . I $G(TIUSVCS)="ALL"!($D(TIUSVCS(+TIUSVC))) D
"RTN","TIURDIV",93,0)
 . . S TIUAU=$$PERSNAME^TIULC1(TIUAU)
"RTN","TIURDIV",94,0)
 . . I $P(TIUSVC,U,2)]"" D
"RTN","TIURDIV",95,0)
 . . . S TIUSVC=$P(TIUSVC,U,2)
"RTN","TIURDIV",96,0)
 . . E  D
"RTN","TIURDIV",97,0)
 . . . S TIUSVC="UNKNOWN"
"RTN","TIURDIV",98,0)
 . . I TIUAU'="UNKNOWN" S TIUAU=$$NAME^TIULS(TIUAU,"LAST, FI MI")
"RTN","TIURDIV",99,0)
 . . S ^TMP("TIUD",$J,TIUIFP,TIUSVC,TIUAU,TIUEDT)=TIUDA
"RTN","TIURDIV",100,0)
 Q
"RTN","TIURDIV",101,0)
 ;
"RTN","TIURDIV",102,0)
PRINT(TIUSTDT,TIUENDT) ; Display/print the output
"RTN","TIURDIV",103,0)
 ; Input  -- TIUSTDT Start Date
"RTN","TIURDIV",104,0)
 ;           TIUENDT End Date
"RTN","TIURDIV",105,0)
 ; Output -- None
"RTN","TIURDIV",106,0)
 N GTCT,ICT,SCT,TIUAU,TIUDA,TIUECS,TIUEDT
"RTN","TIURDIV",107,0)
 N TIUIFP,TIULST4,TIUOUT,TIUPG,TIUPT,TIUSVC,TIUTP
"RTN","TIURDIV",108,0)
 S (GTCT(5),GTCT(6),TIUIFP,TIUPG,TIUOUT)=0
"RTN","TIURDIV",109,0)
 I '$D(^TMP("TIUD",$J)) W !!,"NO Unsigned/Uncosigned Documents!!" Q
"RTN","TIURDIV",110,0)
 F  S TIUIFP=$O(^TMP("TIUD",$J,TIUIFP)) Q:TIUIFP=""!(TIUOUT)  D HDR(TIUIFP,TIUSTDT,TIUENDT) D
"RTN","TIURDIV",111,0)
 . S (ICT(TIUIFP,5),ICT(TIUIFP,6))=0 S TIUSVC=""
"RTN","TIURDIV",112,0)
 . F  S TIUSVC=$O(^TMP("TIUD",$J,TIUIFP,TIUSVC)) Q:TIUSVC=""!(TIUOUT)  D
"RTN","TIURDIV",113,0)
 . . I $Y>(IOSL-5) D ASK Q:TIUOUT  D HDR(TIUIFP,TIUSTDT,TIUENDT)
"RTN","TIURDIV",114,0)
 . . D FHDR(TIUSVC):TIURPT="F"
"RTN","TIURDIV",115,0)
 . . S (SCT(TIUIFP,TIUSVC,5),SCT(TIUIFP,TIUSVC,6))=0 S TIUAU=""
"RTN","TIURDIV",116,0)
 . . F  S TIUAU=$O(^TMP("TIUD",$J,TIUIFP,TIUSVC,TIUAU)) Q:TIUAU=""!(TIUOUT)  D
"RTN","TIURDIV",117,0)
 . . . S TIUEDT=0
"RTN","TIURDIV",118,0)
 . . . F  S TIUEDT=$O(^TMP("TIUD",$J,TIUIFP,TIUSVC,TIUAU,TIUEDT)) Q:TIUEDT=""!(TIUOUT)  D
"RTN","TIURDIV",119,0)
 . . . . S TIUDA=+$G(^TMP("TIUD",$J,TIUIFP,TIUSVC,TIUAU,TIUEDT))
"RTN","TIURDIV",120,0)
 . . . . D PRTELMNT(TIUDA,TIUIFP,TIUSVC,TIUAU,TIUEDT,TIUSTDT,TIUENDT)
"RTN","TIURDIV",121,0)
 . . . . ;
"RTN","TIURDIV",122,0)
 . . Q:TIUOUT
"RTN","TIURDIV",123,0)
 . . I $Y>(IOSL-5) D ASK Q:TIUOUT  D HDR(TIUIFP,TIUSTDT,TIUENDT),FHDR(TIUSVC):TIURPT="F"
"RTN","TIURDIV",124,0)
 . . W !!," Totals for Service: ",$E(TIUSVC,1,25),"---"
"RTN","TIURDIV",125,0)
 . . W " UNSIGNED: ",$G(SCT(TIUIFP,TIUSVC,5))
"RTN","TIURDIV",126,0)
 . . W "  UNCOSIGNED: ",$G(SCT(TIUIFP,TIUSVC,6))
"RTN","TIURDIV",127,0)
 . Q:TIUOUT
"RTN","TIURDIV",128,0)
 . I $Y>(IOSL-5) D ASK Q:TIUOUT  D HDR(TIUIFP,TIUSTDT,TIUENDT)
"RTN","TIURDIV",129,0)
 . W !!,"Totals for Division: ",$E($P($$NS^XUAF4(TIUIFP),U),1,25),"---"
"RTN","TIURDIV",130,0)
 . W " UNSIGNED: ",$G(ICT(TIUIFP,5))
"RTN","TIURDIV",131,0)
 . W "  UNCOSIGNED: ",$G(ICT(TIUIFP,6))
"RTN","TIURDIV",132,0)
 . S GTCT(5)=GTCT(5)+ICT(TIUIFP,5),GTCT(6)=GTCT(6)+ICT(TIUIFP,6)
"RTN","TIURDIV",133,0)
 . D ASK Q:TIUOUT
"RTN","TIURDIV",134,0)
 Q:TIUOUT
"RTN","TIURDIV",135,0)
 S TIUIFP="ALL" D HDR(TIUIFP,TIUSTDT,TIUENDT)
"RTN","TIURDIV",136,0)
 W !!,"GRAND Totals (All Divisions)--- UNSIGNED: ",+$G(GTCT(5))
"RTN","TIURDIV",137,0)
 W "  UNCOSIGNED: ",+$G(GTCT(6))
"RTN","TIURDIV",138,0)
 Q
"RTN","TIURDIV",139,0)
PRTELMNT(TIUDA,TIUIFP,TIUSVC,TIUAU,TIUEDT,TIUSTDT,TIUENDT) ; Print each element
"RTN","TIURDIV",140,0)
 ; Input  -- TIUDA   TIU DOCUMENT file (#8925) IEN
"RTN","TIURDIV",141,0)
 ;           TIUIFP  INSTITUTION file (#4) IEN
"RTN","TIURDIV",142,0)
 ;           TIUSVC  SERVICE/SECTION file (#49) NAME
"RTN","TIURDIV",143,0)
 ;           TIUAU   AUTHOR/DICTATOR's NAME
"RTN","TIURDIV",144,0)
 ;           TIUEDT  Inverse REFERENCE DATE
"RTN","TIURDIV",145,0)
 ;           TIUSTDT Start Date
"RTN","TIURDIV",146,0)
 ;           TIUENDT End Date
"RTN","TIURDIV",147,0)
 ; Output -- None
"RTN","TIURDIV",148,0)
 N TIUD0,TIUD12,TIUS
"RTN","TIURDIV",149,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD12=$G(^TIU(8925,TIUDA,12))
"RTN","TIURDIV",150,0)
 S TIUS=+$P(TIUD0,U,5) I TIUS'=5,TIUS'=6 Q
"RTN","TIURDIV",151,0)
 S ICT(TIUIFP,TIUS)=ICT(TIUIFP,TIUS)+1
"RTN","TIURDIV",152,0)
 S SCT(TIUIFP,TIUSVC,TIUS)=SCT(TIUIFP,TIUSVC,TIUS)+1
"RTN","TIURDIV",153,0)
 I $Y>(IOSL-5) D ASK Q:TIUOUT  D HDR(TIUIFP,TIUSTDT,TIUENDT),FHDR(TIUSVC):TIURPT="F"
"RTN","TIURDIV",154,0)
 I TIURPT="F" D
"RTN","TIURDIV",155,0)
 . S TIUPT=+$P(TIUD0,U,2),TIULST4=$E($$GET1^DIQ(2,TIUPT,.09),6,9)
"RTN","TIURDIV",156,0)
 . S TIUTP=+$P(TIUD0,U),TIUECS=+$P(TIUD12,U,8)
"RTN","TIURDIV",157,0)
 . W !,$G(TIUAU)
"RTN","TIURDIV",158,0)
 . W ?17,$S(TIUPT:$E($$EXTERNAL^DILFD(8925,.02,"",TIUPT),1,15),1:"UNK")
"RTN","TIURDIV",159,0)
 . W ?34,$S(TIULST4]"":$G(TIULST4),1:"UNK")
"RTN","TIURDIV",160,0)
 . W ?41,$E($$EXTERNAL^DILFD(8925,.05,"",TIUS),1,10)
"RTN","TIURDIV",161,0)
 . W ?53,$S(TIUEDT>0:$$FMTE^XLFDT(TIUEDT,2),1:"UNK")
"RTN","TIURDIV",162,0)
 . W ?71,$G(TIUDA)
"RTN","TIURDIV",163,0)
 . W ?85,$S(TIUTP:$E($$EXTERNAL^DILFD(8925,.01,"",TIUTP),1,15),1:"UNK")
"RTN","TIURDIV",164,0)
 . W ?102,$S(TIUECS:$E($$EXTERNAL^DILFD(8925,1208,"",TIUECS),1,15),1:"")
"RTN","TIURDIV",165,0)
 . W ?119,$$PRNT(TIUDA)
"RTN","TIURDIV",166,0)
 Q
"RTN","TIURDIV",167,0)
ASK ; End of page
"RTN","TIURDIV",168,0)
 I IO=IO(0),$E(IOST)="C" D
"RTN","TIURDIV",169,0)
 . W ! N DIR,Y S DIR(0)="E" D ^DIR K DIR
"RTN","TIURDIV",170,0)
 . I Y=""!(Y=0) S TIUOUT=1
"RTN","TIURDIV",171,0)
 Q
"RTN","TIURDIV",172,0)
HDR(TIUIFP,TIUSTDT,TIUENDT) ; Page (Division) Header
"RTN","TIURDIV",173,0)
 ; Input   -- TIUIFP  INSTITUTION file (#4) IEN
"RTN","TIURDIV",174,0)
 ;            TIUSTDT Start Date
"RTN","TIURDIV",175,0)
 ;            TIUENDT End Date
"RTN","TIURDIV",176,0)
 ; Output  -- None
"RTN","TIURDIV",177,0)
 N LNE,TIUR,TIUINST,TIURNG
"RTN","TIURDIV",178,0)
 S TIUPG=(+$G(TIUPG))+1
"RTN","TIURDIV",179,0)
 D DT^DILF("ET","NOW",.TIUR)
"RTN","TIURDIV",180,0)
 S TIURNG=$$FMTE^XLFDT(TIUSTDT)_" thru "_$$FMTE^XLFDT(TIUENDT)
"RTN","TIURDIV",181,0)
 S TIUINST=$S(TIUIFP:$P($$NS^XUAF4(TIUIFP),U),1:"ALL DIVISIONS")
"RTN","TIURDIV",182,0)
 W @IOF,?26,"Unsigned and Uncosigned Documents "_TIURNG,?(IOM-10)
"RTN","TIURDIV",183,0)
 W "Page ",+$G(TIUPG),!,"PRINTED:",?26,"for ",TIUINST,!,TIUR(0)
"RTN","TIURDIV",184,0)
 W ! S LNE="",$P(LNE,"-",(IOM-1))="" W LNE
"RTN","TIURDIV",185,0)
 I TIURPT="F" D
"RTN","TIURDIV",186,0)
 . W !,"AUTHOR",?17,"PATIENT",?34,"LAST4",?41,"STATUS"
"RTN","TIURDIV",187,0)
 . W ?53,"ENTRY DATE",?71,"IEN",?85,"DOC TYPE"
"RTN","TIURDIV",188,0)
 . W ?102,"EXP COSIGNER",?119,"PARENT IEN",!,LNE
"RTN","TIURDIV",189,0)
 Q
"RTN","TIURDIV",190,0)
FHDR(TIUSVC) ; Service Header
"RTN","TIURDIV",191,0)
 ; Input   -- TIUSVC  SERVICE/SECTION file (#49) NAME
"RTN","TIURDIV",192,0)
 ; Output  -- None
"RTN","TIURDIV",193,0)
 W !!?10,"SERVICE: ",TIUSVC
"RTN","TIURDIV",194,0)
 Q
"RTN","TIURDIV",195,0)
PRNT(TIUDA) ; Does document have a parent?
"RTN","TIURDIV",196,0)
 ; Input  -- TIUDA    TIU Document file (#8925) IEN
"RTN","TIURDIV",197,0)
 ; Output -- TIUPRNT  Null= TIU Document file (#8925) entry does
"RTN","TIURDIV",198,0)
 ;                          not have a parent
"RTN","TIURDIV",199,0)
 ;                    Exists= TIU Document file (#8925) entry is
"RTN","TIURDIV",200,0)
 ;                            an addendum or ID child.
"RTN","TIURDIV",201,0)
 ;                            Value: Parent TIU Document file
"RTN","TIURDIV",202,0)
 ;                                   (#8925) IEN 
"RTN","TIURDIV",203,0)
 N ADDMPRNT,IDPRNT,TIUPRNT
"RTN","TIURDIV",204,0)
 S TIUPRNT=""
"RTN","TIURDIV",205,0)
 S ADDMPRNT=+$P($G(^TIU(8925,TIUDA,0)),U,6) ; Addm parent
"RTN","TIURDIV",206,0)
 I '$D(^TIU(8925,ADDMPRNT,0)) S ADDMPRNT=0
"RTN","TIURDIV",207,0)
 I ADDMPRNT D
"RTN","TIURDIV",208,0)
 . S TIUPRNT=ADDMPRNT
"RTN","TIURDIV",209,0)
 E  D
"RTN","TIURDIV",210,0)
 . S IDPRNT=+$G(^TIU(8925,TIUDA,21)) ; ID parent
"RTN","TIURDIV",211,0)
 . I '$D(^TIU(8925,IDPRNT,0)) S IDPRNT=0
"RTN","TIURDIV",212,0)
 . I IDPRNT D
"RTN","TIURDIV",213,0)
 . . S TIUPRNT=IDPRNT
"RTN","TIURDIV",214,0)
 Q TIUPRNT
"RTN","TIURDIV",215,0)
 ;
"RTN","TIURDIV",216,0)
ASKRNG(STDT,ENDT) ;Prompt for entry date range
"RTN","TIURDIV",217,0)
 ; Input  -- None
"RTN","TIURDIV",218,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIURDIV",219,0)
 ;           STDT  Start Date
"RTN","TIURDIV",220,0)
 ;           ENDT  End Date
"RTN","TIURDIV",221,0)
 N DIRUT,DTOUT,DUOUT,Y
"RTN","TIURDIV",222,0)
 W !!,"Please specify an Entry Date Range:",!
"RTN","TIURDIV",223,0)
 S STDT=+$$READ^TIUU("DA^:DT:E"," Start Entry Date: ")
"RTN","TIURDIV",224,0)
 I $D(DIRUT)!(STDT'>0) G ASKRNGQ
"RTN","TIURDIV",225,0)
 S ENDT=+$$READ^TIUU("DA^"_STDT_":DT:E","Ending Entry Date: ")_"."_235959
"RTN","TIURDIV",226,0)
 I $D(DIRUT)!(ENDT'>0) G ASKRNGQ
"RTN","TIURDIV",227,0)
 S Y=1
"RTN","TIURDIV",228,0)
ASKRNGQ Q +$G(Y)
"RTN","TIURE")
0^22^B28436113
"RTN","TIURE",1,0)
TIURE ; SLC/JER - Error handler actions ;9/25/03
"RTN","TIURE",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,21,81,131,113**;Jun 20, 1997
"RTN","TIURE",3,0)
PRINT ; Print Buffer record associated w/unresolved filing error
"RTN","TIURE",4,0)
 N TIUDA,TIUDATA,TIUI,DIROUT
"RTN","TIURE",5,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURE",6,0)
 S TIUI=0
"RTN","TIURE",7,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURE",8,0)
 . S TIUDATA=$G(^TMP("TIUERRIDX",$J,TIUI))
"RTN","TIURE",9,0)
 . S (TIUDA,TIUDA(TIUI))=+$P(TIUDATA,U,3) D RESTORE^TIULM(+$O(@VALMAR@("PICK",TIUI,0)))
"RTN","TIURE",10,0)
 . I +TIUDA'>0!'$D(^TIU(8925.2,+TIUDA,0))!+$P(^TIU(8925.4,+$P(TIUDATA,U,2),0),U,6) W !!,"Item #",+TIUI," is already resolved." K TIUDA(TIUI) H 3 Q
"RTN","TIURE",11,0)
 I $D(TIUDA)'<9 D
"RTN","TIURE",12,0)
 . S ZTRTN="PRINT1^TIURE",ZTDESC="Print Report Buffer"
"RTN","TIURE",13,0)
 . D CLEAR^VALM1,DEVICE^TIUPRDS
"RTN","TIURE",14,0)
 . S TIUI=$$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIURE",15,0)
 K VALMY S VALMBCK="R"
"RTN","TIURE",16,0)
 Q
"RTN","TIURE",17,0)
PRINT1 ; Print a single buffer record
"RTN","TIURE",18,0)
 N DIC,TIUI,FLDS,FR,TO,L,BY,IOP S TIUI=0
"RTN","TIURE",19,0)
 F  S TIUI=$O(TIUDA(TIUI)) Q:+TIUI'>0  D
"RTN","TIURE",20,0)
 . S IOP=$S($D(ZTIO):ZTIO,$D(ION):ION,1:"") Q:IOP']""
"RTN","TIURE",21,0)
 . S DIC="^TIU(8925.2,",FLDS="[TIU PRINT REPORT BUFFER]",L=0
"RTN","TIURE",22,0)
 . S BY=.01,(FR,TO)=+$G(^TIU(8925.2,+TIUDA(TIUI),0))
"RTN","TIURE",23,0)
 . D EN1^DIP
"RTN","TIURE",24,0)
 Q
"RTN","TIURE",25,0)
EDIT ; Edit Buffer record associated w/unresolved filing error
"RTN","TIURE",26,0)
 N TIUDA,BUFDA,TIUDATA,TIUI,DIROUT,TIUDI
"RTN","TIURE",27,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURE",28,0)
 S TIUI=0
"RTN","TIURE",29,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURE",30,0)
 . N VALMY
"RTN","TIURE",31,0)
 . S TIUDATA=$G(^TMP("TIUERRIDX",$J,TIUI))
"RTN","TIURE",32,0)
 . S BUFDA=+$P(TIUDATA,U,3)
"RTN","TIURE",33,0)
 . W !!,"Resolving Event #",TIUI
"RTN","TIURE",34,0)
 . S TIUDA=+$P(TIUDATA,U,2)
"RTN","TIURE",35,0)
 . D EN^VALM("TIU DISPLAY FILING EVENT")
"RTN","TIURE",36,0)
 . D RESTORE^TIULM(+$O(@VALMAR@("PICK",TIUI,0)))
"RTN","TIURE",37,0)
 W !,"Refreshing the list."
"RTN","TIURE",38,0)
 M TIUDI=^TMP("TIUERR",$J,"DIV")
"RTN","TIURE",39,0)
 D BUILD^TIUELST($P(^TMP("TIUERR",$J,0),U,2),$P(^(0),U,3),TIUEDT,TIULDT,.TIUDI)
"RTN","TIURE",40,0)
 K VALMY S:'$D(VALMBCK) VALMBCK="R"
"RTN","TIURE",41,0)
 Q
"RTN","TIURE",42,0)
EDIT1 ; Single record edit
"RTN","TIURE",43,0)
 ; Receives TIUDATA
"RTN","TIURE",44,0)
 N DIC,ERRDA,ERRTYPE,RETRY,DWPK K XQAKILL
"RTN","TIURE",45,0)
 D FULL^VALM1
"RTN","TIURE",46,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIURE",47,0)
 S ERRDA=+$P(TIUDATA,U,2),ERRTYPE=$P(^TIU(8925.4,+ERRDA,0),U,8)
"RTN","TIURE",48,0)
 I +ERRTYPE=0 W !!,"Item #",+TIUDATA," was a successful filing event." H 3 Q
"RTN","TIURE",49,0)
 I +ERRTYPE=1 D FILERR(ERRDA)
"RTN","TIURE",50,0)
 I +ERRTYPE=2 D FLDERR(ERRDA)
"RTN","TIURE",51,0)
 Q
"RTN","TIURE",52,0)
FILERR(ERRDA) ; Resolve filing errors
"RTN","TIURE",53,0)
 N TIUI,INQUIRE,BUFDA,TIUTYPE,RESCODE,TIUDONE
"RTN","TIURE",54,0)
 N TIUEVNT,TIUSKIP,ERR0,STATUS
"RTN","TIURE",55,0)
 ; Set TIUEVNT for PN resolve code:
"RTN","TIURE",56,0)
 S TIUEVNT=+ERRDA
"RTN","TIURE",57,0)
 S TIUI=0,ERR0=$G(^TIU(8925.4,TIUEVNT,0)),STATUS=$P(ERR0,U,6)
"RTN","TIURE",58,0)
 I STATUS=1 W !,"Error has already been resolved.",! Q
"RTN","TIURE",59,0)
 S BUFDA=+$P(ERR0,U,5) I +BUFDA'>0 Q
"RTN","TIURE",60,0)
 I TIUEVNT D  I +$G(TIUDONE)!$G(TIUSKIP) G FILEX
"RTN","TIURE",61,0)
 . D WRITEHDR^TIUPEVNT(TIUEVNT)
"RTN","TIURE",62,0)
 . S TIUTYPE=$P(ERR0,U,3)
"RTN","TIURE",63,0)
 . I $L(TIUTYPE) S TIUTYPE=+$$WHATYPE^TIUPUTPN(TIUTYPE)
"RTN","TIURE",64,0)
 . I TIUTYPE>0 S RESCODE=$$FIXCODE^TIULC1(+TIUTYPE)
"RTN","TIURE",65,0)
 . ;E  S RESCODE="D GETPAT^TIUCHLP"
"RTN","TIURE",66,0)
 . I $G(RESCODE)]"" D  Q
"RTN","TIURE",67,0)
 . . W ! S INQUIRE=$$READ^TIUU("YO","Inquire to patient record","YES","^D INQRHELP^TIUPEVNT")
"RTN","TIURE",68,0)
 . . I $D(DIRUT) S TIUSKIP=1 Q
"RTN","TIURE",69,0)
 . . I +INQUIRE X RESCODE
"RTN","TIURE",70,0)
 . W !!,"Filing error resolution code could not found for this document type.",!,"Please edit the buffered data directly and refile."
"RTN","TIURE",71,0)
 W !!,"You may now edit the buffered upload data in an attempt to resolve error:",!,$P(ERR0,U,4),!
"RTN","TIURE",72,0)
 I '$$READ^TIUU("EA","Press RETURN to continue and edit the buffer or '^' to exit: ") G FILEX
"RTN","TIURE",73,0)
 S DIC="^TIU(8925.2,"_+BUFDA_",""TEXT"",",DWPK=1 D EN^DIWE
"RTN","TIURE",74,0)
 S RETRY=$$READ^TIUU("YO","Now would you like to retry the filer","YES","^D FIL^TIUDIRH")
"RTN","TIURE",75,0)
 I +RETRY D
"RTN","TIURE",76,0)
 . D ALERTDEL^TIUPEVNT(+BUFDA),RESOLVE^TIUPEVNT(TIUEVNT)
"RTN","TIURE",77,0)
 . K TIUDONE
"RTN","TIURE",78,0)
 . D FILE^TIUUPLD(+BUFDA)
"RTN","TIURE",79,0)
 . I '$G(TIUDONE) W !,"Old error marked resolved; new error created.  New error may take several more",!,"seconds to file, and may not be within current date/time range.",! H 5
"RTN","TIURE",80,0)
FILEX S VALMBCK="Q" ;TIU*1*81 resolving twice creates errors so don't permit.
"RTN","TIURE",81,0)
 Q
"RTN","TIURE",82,0)
FLDERR(EVNTDA) ; Resolve field errors
"RTN","TIURE",83,0)
 N DIE,DA,DR,ERRDESC,EVNTDA1,EVNTREC,TIUFIX,ERR0,STATUS
"RTN","TIURE",84,0)
 S EVNTDA1=0
"RTN","TIURE",85,0)
 S ERR0=^TIU(8925.4,+EVNTDA,0),STATUS=$P(ERR0,U,6)
"RTN","TIURE",86,0)
 I STATUS=1 W "Error has already been resolved",! Q  ;TIU*1*81
"RTN","TIURE",87,0)
 S ERRDESC=$P(ERR0,U,4)
"RTN","TIURE",88,0)
 W !!,"You may now enter the correct information:",!
"RTN","TIURE",89,0)
 W !,ERRDESC
"RTN","TIURE",90,0)
 F  S EVNTDA1=$O(^TIU(8925.4,EVNTDA,1,EVNTDA1)) Q:+EVNTDA1'>0  D
"RTN","TIURE",91,0)
 . S EVNTREC=$G(^TIU(8925.4,EVNTDA,1,EVNTDA1,0)) Q:+EVNTREC'>0
"RTN","TIURE",92,0)
 . S DIE=$P(EVNTREC,U),DA=$P(EVNTREC,U,2)
"RTN","TIURE",93,0)
 . S DR=$P(EVNTREC,U,3)_"//"_$P(EVNTREC,U,4)
"RTN","TIURE",94,0)
 . I $$FIXED^TIUPEVN1(DIE,+DA,+DR) Q  ;P81 don't ask if already fixed; moved from TIUPEVNT
"RTN","TIURE",95,0)
 . D ^DIE
"RTN","TIURE",96,0)
 . ; P81 If missing field was just corrected, delete alert for that field:
"RTN","TIURE",97,0)
 . S TIUFIX=$$FIXED^TIUPEVN1(DIE,+DA,+DR) ; TIU*1*81 moved from TIUPEVNT
"RTN","TIURE",98,0)
 . I +TIUFIX=1 S XQAKILL=0,XQAID="TIUERR,"_+EVNTDA_","_+EVNTDA1 D DELETEA^XQALERT
"RTN","TIURE",99,0)
 . ; If entry is a TIU Document, do Post-filing action and SEND^TIUALRT
"RTN","TIURE",100,0)
 . I DIE="^TIU(8925," D
"RTN","TIURE",101,0)
 . . N TIUPOST,TIUREC,DR,DIE
"RTN","TIURE",102,0)
 . . S TIUPOST=$$POSTFILE^TIULC1(+$G(^TIU(8925,DA,0)))
"RTN","TIURE",103,0)
 . . S TIUREC("#")=DA
"RTN","TIURE",104,0)
 . . I TIUPOST]"" X TIUPOST I 1
"RTN","TIURE",105,0)
 . . D SEND^TIUALRT(DA)
"RTN","TIURE",106,0)
 D FLDRSLV^TIUPEVN1(EVNTDA) ; TIU*1*81 moved from TIUPEVNT
"RTN","TIURE",107,0)
 Q
"RTN","TIURECL1")
0^23^B34751928
"RTN","TIURECL1",1,0)
TIURECL1 ; SLC/PKR,JER - Expand/collapse LM views ;5/8/03
"RTN","TIURECL1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,113**;Jun 20, 1997
"RTN","TIURECL1",3,0)
 ; 7/6 Split TIURECL into TIURECL & TIURECL1, move RESOLVE to TIURECL1
"RTN","TIURECL1",4,0)
 ; 7/10 Move INSID, INSADD, VEXREQ, ISSUB to TIURECL1
"RTN","TIURECL1",5,0)
 ; 9/7 Move INSKIDS, INSADD, & associated modules to TIURECL2
"RTN","TIURECL1",6,0)
 ;=======================================================================
"RTN","TIURECL1",7,0)
ISSUB(CLASS1,CLASS2,LEVEL) ;Return true if CLASS2 is sub to CLASS1.
"RTN","TIURECL1",8,0)
 N IND,ISSUB
"RTN","TIURECL1",9,0)
 I LEVEL(CLASS1)'<LEVEL(CLASS2) Q 0
"RTN","TIURECL1",10,0)
 ;Check sublevel links between class1 and class2
"RTN","TIURECL1",11,0)
 S ISSUB=1
"RTN","TIURECL1",12,0)
 F IND=(CLASS1+1):1:(CLASS2-1) D
"RTN","TIURECL1",13,0)
 . I LEVEL(IND)=1 D  Q
"RTN","TIURECL1",14,0)
 .. S ISSUB=0
"RTN","TIURECL1",15,0)
 Q ISSUB
"RTN","TIURECL1",16,0)
 ;
"RTN","TIURECL1",17,0)
 ;======================================================================
"RTN","TIURECL1",18,0)
VEXREQ(VALMY) ;Check for valid expand/contract requests.
"RTN","TIURECL1",19,0)
 ; A list of documents to expand/contract is invalid if any docmt
"RTN","TIURECL1",20,0)
 ;is a sub docmt of another docmt on the list.
"RTN","TIURECL1",21,0)
 N END,START
"RTN","TIURECL1",22,0)
 S START=$O(VALMY(""))
"RTN","TIURECL1",23,0)
 S END=$O(VALMY(""),-1)
"RTN","TIURECL1",24,0)
 I START=END Q 1
"RTN","TIURECL1",25,0)
 ;
"RTN","TIURECL1",26,0)
 N ACTION,ACTIND,ACTJND,CIND,CN,IND,JND,LEVEL,MSG,TEXT,VALID
"RTN","TIURECL1",27,0)
 ;Build the level list.
"RTN","TIURECL1",28,0)
 F IND=START:1:END D
"RTN","TIURECL1",29,0)
 . S LEVEL(IND)=$L(@VALMAR@(IND,0),"|")
"RTN","TIURECL1",30,0)
 S VALID=1
"RTN","TIURECL1",31,0)
 S IND=""
"RTN","TIURECL1",32,0)
 F  S IND=$O(VALMY(IND)) Q:+IND'>0  D
"RTN","TIURECL1",33,0)
 . S TEXT(IND)=$G(@VALMAR@(IND,0))
"RTN","TIURECL1",34,0)
 . S ACTIND=$S(TEXT(IND)["+":"+ ",TEXT(IND)["-":"-",1:"")
"RTN","TIURECL1",35,0)
 . I ACTIND="" Q
"RTN","TIURECL1",36,0)
 . S ACTION(IND)=$S(TEXT(IND)["+":"expand ",TEXT(IND)["-":"collapse ",1:"")
"RTN","TIURECL1",37,0)
 . S JND=IND
"RTN","TIURECL1",38,0)
 . F  S JND=$O(VALMY(JND)) Q:+JND'>0  D
"RTN","TIURECL1",39,0)
 .. S TEXT(JND)=$G(@VALMAR@(JND,0))
"RTN","TIURECL1",40,0)
 .. S ACTJND=$S(TEXT(JND)["+":"+",TEXT(JND)["-":"-",1:"")
"RTN","TIURECL1",41,0)
 .. I ACTJND="" Q
"RTN","TIURECL1",42,0)
 .. S ACTION(JND)=$S(TEXT(JND)["+":"expand ",TEXT(JND)["-":"collapse ",1:"")
"RTN","TIURECL1",43,0)
 .. I $$ISSUB(IND,JND,.LEVEL) D
"RTN","TIURECL1",44,0)
 ... I ACTION(IND)'=ACTION(JND) D  Q
"RTN","TIURECL1",45,0)
 .... S CIND(IND)=$P(^TMP("TIURIDX",$J,IND),U,2)
"RTN","TIURECL1",46,0)
 .... S CN(IND)=$P(^TIU(8925,CIND(IND),0),U,1)
"RTN","TIURECL1",47,0)
 .... S CIND(JND)=$P(^TMP("TIURIDX",$J,JND),U,2)
"RTN","TIURECL1",48,0)
 .... S CN(JND)=$P(^TIU(8925,CIND(JND),0),U,1)
"RTN","TIURECL1",49,0)
 .... I '+$G(HUSH) D
"RTN","TIURECL1",50,0)
 ..... S MSG="You cannot "_ACTION(IND)_CN(IND)_" and "_ACTION(JND)_CN(JND)
"RTN","TIURECL1",51,0)
 ..... D MSG^VALM10(MSG)
"RTN","TIURECL1",52,0)
 ..... H 4
"RTN","TIURECL1",53,0)
 .... S VALID=0
"RTN","TIURECL1",54,0)
 Q VALID
"RTN","TIURECL1",55,0)
 ;======================================================================
"RTN","TIURECL1",56,0)
IDDATA(TIUDA,TIUD0,TIUD21) ; Return TIUGDATA:
"RTN","TIURECL1",57,0)
 ; TIUGDATA = 0 or
"RTN","TIURECL1",58,0)
 ;        = TIUDA^haskid^IDparent^prmsort, where
"RTN","TIURECL1",59,0)
 ;           TIUDA = note DA
"RTN","TIURECL1",60,0)
 ;          haskid = 1 if note has ID kid, else 0
"RTN","TIURECL1",61,0)
 ;        IDparent = parent DA if note has ID parent, else 0
"RTN","TIURECL1",62,0)
 ;         prmsort = 'TITLE' if entries ordered by title, else 'REFDT'
"RTN","TIURECL1",63,0)
 ;Note: TIUGDATA is nonzero if note is POSSIBLE DAD, or dad, or kid.
"RTN","TIURECL1",64,0)
 ; Requires TIUDA; TIUD0 & TIUD21 are optional
"RTN","TIURECL1",65,0)
 N HASIDKID,POSSPRNT,TIUDPRM,PRMSORT,TIUGDATA
"RTN","TIURECL1",66,0)
 I '$G(TIUD0) S TIUD0=^TIU(8925,TIUDA,0)
"RTN","TIURECL1",67,0)
 I '$D(TIUD21) S TIUD21=+$G(^TIU(8925,TIUDA,21))
"RTN","TIURECL1",68,0)
 S (TIUGDATA,POSSPRNT)=0
"RTN","TIURECL1",69,0)
 S HASIDKID=$$HASIDKID^TIUGBR(TIUDA)
"RTN","TIURECL1",70,0)
 I 'TIUD21,'HASIDKID S POSSPRNT=$$POSSPRNT^TIULP(+TIUD0) ;has bus rules
"RTN","TIURECL1",71,0)
 I TIUD21!HASIDKID!POSSPRNT D
"RTN","TIURECL1",72,0)
 . I 'TIUD21 D  I 1
"RTN","TIURECL1",73,0)
 . . D DOCPRM^TIULC1(+TIUD0,.TIUDPRM)
"RTN","TIURECL1",74,0)
 . . S PRMSORT=$S($P($G(TIUDPRM(0)),U,18):"TITLE",1:"REFDT")
"RTN","TIURECL1",75,0)
 . E  S PRMSORT=""
"RTN","TIURECL1",76,0)
 . S TIUGDATA=TIUDA_U_HASIDKID_U_TIUD21_U_PRMSORT
"RTN","TIURECL1",77,0)
 Q TIUGDATA
"RTN","TIURECL1",78,0)
 ;
"RTN","TIURECL1",79,0)
RESOLVE(DA,TSTART,FIRSTPFX,XIDDATA) ; Get document data for insertion
"RTN","TIURECL1",80,0)
 ;  Receives DA, TSTART, FIRSTPFX
"RTN","TIURECL1",81,0)
 ;    FIRSTPFX = $$INSPFIX of parent of inserted document.
"RTN","TIURECL1",82,0)
 ;  Returns line TSTART.
"RTN","TIURECL1",83,0)
 ;  Receives XIDDATA by ref, finds it, and passes it back.
"RTN","TIURECL1",84,0)
 N DIC,DIQ,DR,TIUR,PT,MOM,ADT,DDT,LCT,AUT,AMD,EDT,SDT,XDT,RMD,TIULST4
"RTN","TIURECL1",85,0)
 N TIUP,TIUD0,TIUD12,TIUD13,TIUD15,TIULI,STATX,DOC,TIUY,TIUI,TIUFLDS
"RTN","TIURECL1",86,0)
 N PREFIX,GETTL,GETPT,TIUD21,INSTA,TIUSTN
"RTN","TIURECL1",87,0)
 I '$D(^TIU(8925,DA,0)) S TIUY="Record #"_DA_" is missing." G RESOLVEX
"RTN","TIURECL1",88,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIURECL1",89,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIURECL1",90,0)
 S TIUD21=$G(^TIU(8925,+DA,21))
"RTN","TIURECL1",91,0)
 S XIDDATA=$$IDDATA(DA,TIUD0,TIUD21)
"RTN","TIURECL1",92,0)
 S PREFIX=$$PREFIX^TIULA2(DA),PREFIX=FIRSTPFX_PREFIX
"RTN","TIURECL1",93,0)
 S GETTL=$$GETTL(TIUD0,PREFIX)
"RTN","TIURECL1",94,0)
 ; Most screens have docmt title in 1st column, but some have pat nm:
"RTN","TIURECL1",95,0)
 S DOC=$S($D(VALMDDF("PATIENT NAME")):$P(GETTL,U),1:$P(GETTL,U,2)_$P(GETTL,U))
"RTN","TIURECL1",96,0)
 S TIUFLDS("DOCUMENT TYPE")="DOC"
"RTN","TIURECL1",97,0)
 S TIUFLDS("TITLE")="DOC"
"RTN","TIURECL1",98,0)
 S GETPT=$$GETPT(TIUD0,PREFIX)
"RTN","TIURECL1",99,0)
 S TIULI=$E(GETPT)
"RTN","TIURECL1",100,0)
 S PT=$P(GETPT,U,2)_$P(GETPT,U)
"RTN","TIURECL1",101,0)
 S TIUFLDS("PATIENT NAME")="PT"
"RTN","TIURECL1",102,0)
 S TIULST4=$E($P($G(^DPT(+$P(TIUD0,U,2),0)),U,9),6,9)
"RTN","TIURECL1",103,0)
 S TIULST4="("_TIULI_TIULST4_")"
"RTN","TIURECL1",104,0)
 S TIUFLDS("LAST I/LAST 4")="TIULST4"
"RTN","TIURECL1",105,0)
 S ADT=$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/YY")
"RTN","TIURECL1",106,0)
 S TIUFLDS("ADMISSION DATE")="ADT"
"RTN","TIURECL1",107,0)
 S DDT=$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/YY"),LCT=$P(TIUD0,U,10)
"RTN","TIURECL1",108,0)
 S TIUFLDS("DISCH DATE")="DDT"
"RTN","TIURECL1",109,0)
 S TIUFLDS("LINE COUNT")="AMD"
"RTN","TIURECL1",110,0)
 S AMD=$$PERSNAME^TIULC1($P(TIUD12,U,8)) S:AMD="UNKNOWN" AMD=""
"RTN","TIURECL1",111,0)
 S AUT=$$PERSNAME^TIULC1($P(TIUD12,U,2)) S:AUT="UNKNOWN" AUT=""
"RTN","TIURECL1",112,0)
 S AMD=$$NAME^TIULS(AMD,"LAST, FI MI")
"RTN","TIURECL1",113,0)
 S TIUFLDS("ATTENDING")="AMD"
"RTN","TIURECL1",114,0)
 S TIUFLDS("COSIGNER")="AMD"
"RTN","TIURECL1",115,0)
 I $D(^TMP("TIUR",$J,"CTXT")) S AUT=$$NAME^TIULS(AUT,"LAST,FI") I 1
"RTN","TIURECL1",116,0)
 E  S AUT=$$NAME^TIULS(AUT,"LAST, FI MI")
"RTN","TIURECL1",117,0)
 S TIUFLDS("AUTHOR")="AUT"
"RTN","TIURECL1",118,0)
 I $D(^TMP("TIUR",$J,"CTXT")) S EDT=$$DATE^TIULS($P(TIUD13,U),"MM/DD/YY HR:MIN") I 1
"RTN","TIURECL1",119,0)
 E  S EDT=$$DATE^TIULS($P(TIUD13,U),"MM/DD/YY")
"RTN","TIURECL1",120,0)
 S TIUFLDS("REF DATE")="EDT"
"RTN","TIURECL1",121,0)
 S XDT=$$DATE^TIULS($P(TIUD13,U,7),"MM/DD/YY")
"RTN","TIURECL1",122,0)
 S TIUFLDS("DICT DATE")="XDT"
"RTN","TIURECL1",123,0)
 S SDT=$S(+$P(TIUD15,U,7):+$P(TIUD15,U,7),+$P(TIUD0,U,5)'<7:+$P(TIUD15,U),1:"")
"RTN","TIURECL1",124,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIURECL1",125,0)
 S TIUFLDS("SIG DATE")="SDT"
"RTN","TIURECL1",126,0)
 S STATX=$$LOW^XLFSTR($P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U))
"RTN","TIURECL1",127,0)
 S TIUFLDS("STATUS")="STATX"
"RTN","TIURECL1",128,0)
 S INSTA=""
"RTN","TIURECL1",129,0)
 I +$P(TIUD12,U,12)>0 D
"RTN","TIURECL1",130,0)
 . S TIUSTN=$$NS^XUAF4($P(TIUD12,U,12))
"RTN","TIURECL1",131,0)
 . I $P(TIUSTN,U,2)]"" S INSTA=$P(TIUSTN,U,2)
"RTN","TIURECL1",132,0)
 S INSTA=$E(INSTA,1,8)
"RTN","TIURECL1",133,0)
 S TIUFLDS("DIVISION")="INSTA"
"RTN","TIURECL1",134,0)
 S (TIUI,TIUY)=""
"RTN","TIURECL1",135,0)
 S TIUY=$$SETFLD^VALM1(TSTART,TIUY,"NUMBER")
"RTN","TIURECL1",136,0)
 F  S TIUI=$O(TIUFLDS(TIUI)) Q:TIUI=""  D
"RTN","TIURECL1",137,0)
 . S:$D(VALMDDF(TIUI)) TIUY=$$SETFLD^VALM1(@TIUFLDS(TIUI),TIUY,TIUI)
"RTN","TIURECL1",138,0)
RESOLVEX Q TIUY
"RTN","TIURECL1",139,0)
 ;
"RTN","TIURECL1",140,0)
GETPT(TIUD0,PREFIX) ; Get patient column data; put updated prefix data
"RTN","TIURECL1",141,0)
 ;in second ^ piece
"RTN","TIURECL1",142,0)
 ;  Receives TIUDO, PREFIX.
"RTN","TIURECL1",143,0)
 ;  Returns (patient col data)^PREFIX
"RTN","TIURECL1",144,0)
 N TIUY
"RTN","TIURECL1",145,0)
 S TIUY=$$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FI MI")
"RTN","TIURECL1",146,0)
 I $D(PREFIX) S TIUY=TIUY_U_PREFIX
"RTN","TIURECL1",147,0)
 Q TIUY
"RTN","TIURECL1",148,0)
 ;
"RTN","TIURECL1",149,0)
GETTL(TIUD0,PREFIX) ; Get title column data; put updated prefix
"RTN","TIURECL1",150,0)
 ;data in second ^ piece.
"RTN","TIURECL1",151,0)
 ;  Receives TIUDO, PREFIX.
"RTN","TIURECL1",152,0)
 ;  Returns (title col data)^PREFIX
"RTN","TIURECL1",153,0)
 N TIUY
"RTN","TIURECL1",154,0)
 S TIUY=$$PNAME^TIULC1(+TIUD0)
"RTN","TIURECL1",155,0)
 I TIUY="Addendum" S TIUY="Addendum to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIURECL1",156,0)
 I $D(PREFIX) S TIUY=TIUY_U_PREFIX
"RTN","TIURECL1",157,0)
 Q TIUY
"RTN","TIURECL1",158,0)
 ;
"RTN","TIURECL1",159,0)
SETTLPT(STRING,DA,PREFIX) ; Set field TITLE or PATIENT into string,
"RTN","TIURECL1",160,0)
 ;with prefix as first chars of string.
"RTN","TIURECL1",161,0)
 ;  Receives STRING, DA, PREFIX:
"RTN","TIURECL1",162,0)
 ;    PREFIX = beginning chars of title/pt column, up to but not
"RTN","TIURECL1",163,0)
 ;             including title/pt itself.
"RTN","TIURECL1",164,0)
 ;  Returns STRING.
"RTN","TIURECL1",165,0)
 N PT,DOC,TIUD0
"RTN","TIURECL1",166,0)
 S TIUD0=^TIU(8925,DA,0)
"RTN","TIURECL1",167,0)
 I $D(VALMDDF("PATIENT NAME")) D  I 1
"RTN","TIURECL1",168,0)
 . S PT=$$GETPT(TIUD0,PREFIX)
"RTN","TIURECL1",169,0)
 . S PT=$P(PT,U,2)_$P(PT,U)
"RTN","TIURECL1",170,0)
 . S STRING=$$SETFLD^VALM1(PT,STRING,"PATIENT NAME")
"RTN","TIURECL1",171,0)
 E  D
"RTN","TIURECL1",172,0)
 . S DOC=$$GETTL(TIUD0,PREFIX)
"RTN","TIURECL1",173,0)
 . S DOC=$P(DOC,U,2)_$P(DOC,U)
"RTN","TIURECL1",174,0)
 . S STRING=$$SETFLD^VALM1(DOC,STRING,"TITLE")
"RTN","TIURECL1",175,0)
 Q STRING
"RTN","TIURH")
0^24^B3848537
"RTN","TIURH",1,0)
TIURH ; SLC/JER - Review Screen Header ;5/7/03
"RTN","TIURH",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**113**;Jun 20, 1997
"RTN","TIURH",3,0)
HDR ; Initialize header for clinician's review screen
"RTN","TIURH",4,0)
 N BY,TIUI,TIUX,SCREEN,STATUS,RANGE,TIUBY,TIUDOCS,XREF
"RTN","TIURH",5,0)
 S TIUX=$G(^TMP("TIUR",$J,0)),STATUS=$P(TIUX,U,2),SCREEN=$P(TIUX,U,3,99)
"RTN","TIURH",6,0)
 S VALM("TITLE")=$S($L(STATUS,",")>1:$S(VALM("ENTITY")="Document":"Clinical",1:""),1:STATUS)
"RTN","TIURH",7,0)
 I $G(XQY0)["MY UNSIGNED" S VALM("TITLE")="MY UNSIGNED"
"RTN","TIURH",8,0)
 S:$L(VALM("TITLE")) VALM("TITLE")=VALM("TITLE")_" "
"RTN","TIURH",9,0)
 S VALM("TITLE")=VALM("TITLE")_$S($L(VALM("ENTITY")):$$NTTNM(VALM("ENTITY")),1:"Document")_"s"
"RTN","TIURH",10,0)
 I +TIUEDT>1 S RANGE=" from "_$$DATE^TIULS(TIUEDT,"MM/DD/YY")_" to "_$$DATE^TIULS(TIULDT,"MM/DD/YY")
"RTN","TIURH",11,0)
 F TIUI=1:1:$L(SCREEN,";") D
"RTN","TIURH",12,0)
 . S XREF=$P($P(SCREEN,";",TIUI),U),XREF=$O(^TIU(8925.8,"C",XREF,0))
"RTN","TIURH",13,0)
 . I $D(TIUQUIK) D
"RTN","TIURH",14,0)
 . . S TIUBY=$G(TIUBY)_$S($G(TIUBY)]"":" or ",1:"")
"RTN","TIURH",15,0)
 . E  D
"RTN","TIURH",16,0)
 . . S TIUBY=$G(TIUBY)_$S($G(TIUBY)]"":" and ",1:"")
"RTN","TIURH",17,0)
 . S TIUBY=$G(TIUBY)_$P($G(^TIU(8925.8,+XREF,0)),U)
"RTN","TIURH",18,0)
 . S:$P($P(SCREEN,";",TIUI),U,3)]"" TIUBY=$G(TIUBY)_" ("_$P($P(SCREEN,";",TIUI),U,3)_")"
"RTN","TIURH",19,0)
 S BY="by "_TIUBY
"RTN","TIURH",20,0)
 ; I BY'["ALL",(BY'["SUBJECT") S BY=BY_" for "_$P($P(SCREEN,U,3),";")
"RTN","TIURH",21,0)
 S VALMHDR(1)=$$CENTER^TIULS(BY_$S($L(SCREEN,";")=1:$G(RANGE),1:""))
"RTN","TIURH",22,0)
 S TIUDOCS=$J(+$G(^TMP("TIUR",$J,0)),4)_" documents"
"RTN","TIURH",23,0)
 S VALMHDR(1)=$$SETSTR^VALM1(TIUDOCS,VALMHDR(1),(IOM-$L(TIUDOCS)),$L(TIUDOCS))
"RTN","TIURH",24,0)
 ; I $L($G(RANGE)) S VALMHDR(2)=$$CENTER^TIULS(RANGE)
"RTN","TIURH",25,0)
 Q
"RTN","TIURH",26,0)
NTTNM(NAME) ; Handle plural names appropriately
"RTN","TIURH",27,0)
 I "Yy"[$E(NAME,$L(NAME)) S NAME=$E(NAME,1,($L(NAME)-1))_"ie"
"RTN","TIURH",28,0)
 I NAME="Discharge Summarie" S NAME="Disch Summarie"
"RTN","TIURH",29,0)
 Q NAME
"RTN","TIURM")
0^25^B23864201
"RTN","TIURM",1,0)
TIURM ; SLC/JER - MIS Document Review ;9/24/03
"RTN","TIURM",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**74,79,58,100,113**;Jun 20, 1997
"RTN","TIURM",3,0)
 ;12/7/00 split TIURM into TIURM & TIURM1
"RTN","TIURM",4,0)
MAKELIST(TIUCLASS) ; Get Search Criteria
"RTN","TIURM",5,0)
 N DIRUT,DTOUT,DUOUT,TIUI,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIURM",6,0)
 N TIUDPRMT,STATWORD,STATIFN,NOWFLAG,TIUK
"RTN","TIURM",7,0)
 K DIROUT
"RTN","TIURM",8,0)
 D INITRR^TIULRR(0)
"RTN","TIURM",9,0)
DIVISION ; Select Division(s)
"RTN","TIURM",10,0)
 D SELDIV^TIULA
"RTN","TIURM",11,0)
 I SELDIV'>0 S VALMQUIT=1 Q
"RTN","TIURM",12,0)
 I $D(TIUDI) D
"RTN","TIURM",13,0)
 . S TIUK=0 F  S TIUK=$O(TIUDI(TIUK)) Q:'TIUK  D
"RTN","TIURM",14,0)
 . . S TIUDI("ENTRIES")=$G(TIUDI("ENTRIES"))_TIUK_";"
"RTN","TIURM",15,0)
 E  S TIUDI("ENTRIES")="ALL DIVISIONS"
"RTN","TIURM",16,0)
STATUS S STATUS=$S($D(TIUQUIK):$$SELSTAT^TIULA(.TIUSTAT,"F","UNSIGNED,UNCOSIGNED"),1:$$SELSTAT^TIULA(.TIUSTAT,"A",$$DFLTSTAT(DUZ)))
"RTN","TIURM",17,0)
 I +STATUS<0 S VALMQUIT=1 Q
"RTN","TIURM",18,0)
 S TIUI=0
"RTN","TIURM",19,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI  D
"RTN","TIURM",20,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIURM",21,0)
 . Q:'STATIFN
"RTN","TIURM",22,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIURM",23,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIURM",24,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIURM",25,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIURM",26,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIURM",27,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIURM",28,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIURM",29,0)
 N TIUDCL
"RTN","TIURM",30,0)
 ; -- Ask user for docmt types and set ^TMP("TIUTYP",$J):
"RTN","TIURM",31,0)
 D SELTYP^TIULA(TIUCLASS,.TIUTYP,"A","LAST","DOC",0,.TIUDCL)
"RTN","TIURM",32,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",33,0)
 I +$G(@TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIURM",34,0)
 D CHECKADD
"RTN","TIURM",35,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIURM",36,0)
 S TIUDPRMT="Entry"
"RTN","TIURM",37,0)
 S TIUEDT=$S($D(TIUQUIK):1,1:$$EDATE^TIULA(TIUDPRMT,"",TIUEDFLT))
"RTN","TIURM",38,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",39,0)
 I TIUEDT'>0 G DOCTYPE
"RTN","TIURM",40,0)
LATE S TIULDT=$S($D(TIUQUIK):9999999,1:$$LDATE^TIULA(TIUDPRMT))
"RTN","TIURM",41,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",42,0)
 I TIULDT'>0 G ERLY
"RTN","TIURM",43,0)
 I TIUEDT>TIULDT D SWAP(.TIUEDT,.TIULDT)
"RTN","TIURM",44,0)
 I $L(TIULDT,".")=1 D EXPRANGE(.TIUEDT,.TIULDT) ; P74.  Add late date time whether or not late date is same as early date.
"RTN","TIURM",45,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIURM",46,0)
 S NOWFLAG=$S(TIULDT-$$NOW^XLFDT<.0001:1,1:0)
"RTN","TIURM",47,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIURM",48,0)
 D BUILD(TIUCLASS,.STATUS,TIUEDT,TIULDT,NOWFLAG,.TIUDI)
"RTN","TIURM",49,0)
 ; -- If attaching ID note & changed view,
"RTN","TIURM",50,0)
 ;    update video for line to be attached: --
"RTN","TIURM",51,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIURM",52,0)
 K TIUDI,SELDIV
"RTN","TIURM",53,0)
 Q
"RTN","TIURM",54,0)
CHECKADD ; Checks whether Addendum is included in the list of types
"RTN","TIURM",55,0)
 N TIUI,HIT,NUMTYPS
"RTN","TIURM",56,0)
 S (TIUI,HIT)=0
"RTN","TIURM",57,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(^TMP("TIUTYP",$J,TIUI))["ADDENDUM" S HIT=1
"RTN","TIURM",58,0)
 S NUMTYPS=^TMP("TIUTYP",$J)
"RTN","TIURM",59,0)
 I +HIT'>0 S ^TMP("TIUTYP",$J,NUMTYPS+1)=+^TMP("TIUTYP",$J,NUMTYPS)+1_U_"81^Addendum^NOT PICKED",^TMP("TIUTYP",$J)=^TMP("TIUTYP",$J)+1
"RTN","TIURM",60,0)
 Q
"RTN","TIURM",61,0)
SWAP(TIUX,TIUY) ; Swap any two variables
"RTN","TIURM",62,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIURM",63,0)
 Q
"RTN","TIURM",64,0)
EXPRANGE(TIUX,TIUY) ; Expand late date to include time
"RTN","TIURM",65,0)
 ;P74 If user entered date/time = T, then numerical date time is FIRST ^ PIECE ONLY of TIUX & TIUY.
"RTN","TIURM",66,0)
 I $P(TIUY,U)=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIURM",67,0)
 E  S TIUY=$P(TIUY,U)_"."_235959 ;P74 Add seconds
"RTN","TIURM",68,0)
 Q
"RTN","TIURM",69,0)
BUILD(TIUCLASS,STATUS,EARLY,LATE,NOWFLAG,TIUDI) ; Build List
"RTN","TIURM",70,0)
 N TIUPREF
"RTN","TIURM",71,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIURM",72,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J)
"RTN","TIURM",73,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIURM",74,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIURM",75,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIURM",76,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIURM",77,0)
 S ^TMP("TIUR",$J,"RTN")="TIURM"
"RTN","TIURM",78,0)
 I '$D(TIUPRM0)!'$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURM",79,0)
 S EARLY=+$G(EARLY,0),LATE=+$G(LATE,3333333)
"RTN","TIURM",80,0)
 D GATHER^TIURM1(TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,.TIUDI)
"RTN","TIURM",81,0)
 D PUTLIST^TIURM1(TIUPREF,TIUCLASS,.STATUS,.TIUDI)
"RTN","TIURM",82,0)
 K ^TMP("TIUI",$J)
"RTN","TIURM",83,0)
 Q
"RTN","TIURM",84,0)
CLEAN ; Clean up your mess!
"RTN","TIURM",85,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIURM",86,0)
 K VALMY
"RTN","TIURM",87,0)
 K ^TMP("TIUTYP",$J)
"RTN","TIURM",88,0)
 Q
"RTN","TIURM",89,0)
URGENCY(TIUDA) ; What is the urgency of the current document
"RTN","TIURM",90,0)
 N TIUY,TIUD0,TIUDSTAT,TIUDURG
"RTN","TIURM",91,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUDSTAT=$P(TIUD0,U,5)
"RTN","TIURM",92,0)
 S TIUDURG=$P(TIUD0,U,9)
"RTN","TIURM",93,0)
 S TIUY=$S(TIUDSTAT<7:$S(TIUDURG="P":1,1:2),1:3)
"RTN","TIURM",94,0)
 Q TIUY
"RTN","TIURM",95,0)
DFLTSTAT(USER) ; Set default STATUS for current user
"RTN","TIURM",96,0)
 N TIUMIS,TIUMD,TIUY,TIUDPRM D DOCPRM^TIULC1(244,.TIUDPRM)
"RTN","TIURM",97,0)
 S TIUMIS=$$ISA^USRLM(DUZ,"MEDICAL INFORMATION SECTION")
"RTN","TIURM",98,0)
 I +TIUMIS,+$P($G(TIUDPRM(0)),U,3) S TIUY="UNVERIFIED" G DFLTX
"RTN","TIURM",99,0)
 I $$ISA^USRLM(DUZ,"PROVIDER") S TIUY="COMPLETED" G DFLTX
"RTN","TIURM",100,0)
 S TIUY="COMPLETED"
"RTN","TIURM",101,0)
DFLTX Q TIUY
"RTN","TIURM",102,0)
 ;
"RTN","TIURM",103,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIURM",104,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUEDT,TIULDT
"RTN","TIURM",105,0)
 N TIURBLD,TIUI,TIUCLASS,TIUDI
"RTN","TIURM",106,0)
 S TIURBLD=1
"RTN","TIURM",107,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIURM",108,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIURM",109,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIURM",110,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIURM",111,0)
 S TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIURM",112,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIURM",113,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIURM",114,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIURM",115,0)
 M TIUDI=^TMP("TIUR",$J,"DIV")
"RTN","TIURM",116,0)
 D BUILD(TIUCLASS,.STATUS,TIUEDT,TIULDT,NOWFLAG,.TIUDI)
"RTN","TIURM",117,0)
 ; Reexpand previously expanded items:
"RTN","TIURM",118,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIURM",119,0)
 D BREATHE^TIUROR1(1)
"RTN","TIURM",120,0)
 Q
"RTN","TIURM1")
0^26^B39918877
"RTN","TIURM1",1,0)
TIURM1 ; SLC/JER - MIS Document Review ;9/24/03
"RTN","TIURM1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,113**;Jun 20, 1997
"RTN","TIURM1",3,0)
GATHER(TIUPREF,CLASS,STATIFNS,EARLY,LATE,DIVIFNS) ; Find/sort
"RTN","TIURM1",4,0)
 ;records for the list
"RTN","TIURM1",5,0)
 N TIUDA,TIUSFLD,TIUI,TIUQ
"RTN","TIURM1",6,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURM1",7,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURM1",8,0)
 S TIUI=EARLY F  S TIUI=$O(^TIU(8925,"F",TIUI)) Q:+TIUI'>0!(+TIUI>LATE)  D
"RTN","TIURM1",9,0)
 . S TIUDA=0
"RTN","TIURM1",10,0)
 . F  S TIUDA=$O(^TIU(8925,"F",TIUI,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIURM1",11,0)
 . . ; Consider adding view check here
"RTN","TIURM1",12,0)
 . . I '$$INTYPES(TIUDA) Q
"RTN","TIURM1",13,0)
 . . I '$$INSTATUS(TIUDA,STATIFNS) Q
"RTN","TIURM1",14,0)
 . . I +$G(DIVIFNS("ENTRIES")),'$$ININST(TIUDA,.DIVIFNS) Q
"RTN","TIURM1",15,0)
 . . S TIUQ=$$RESOLVE^TIUR1(TIUDA,TIUSFLD)
"RTN","TIURM1",16,0)
 . . S ^TMP("TIUI",$J,TIUQ,(9999999-TIUI),TIUDA)=""
"RTN","TIURM1",17,0)
 Q
"RTN","TIURM1",18,0)
 ;
"RTN","TIURM1",19,0)
INTYPES(TIUDA) ; Evaluates whether a record is among the selected types
"RTN","TIURM1",20,0)
 N TIUI,TIUTYP,TIUY S (TIUI,TIUY)=0
"RTN","TIURM1",21,0)
 S TIUTYP=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIURM1",22,0)
 I TIUTYP=81 S TIUY=+$$DADINTYP(TIUDA) G INTYPX
"RTN","TIURM1",23,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIURM1",24,0)
 . I +$P(^TMP("TIUTYP",$J,TIUI),U,2)=TIUTYP S TIUY=1
"RTN","TIURM1",25,0)
INTYPX Q TIUY
"RTN","TIURM1",26,0)
 ;
"RTN","TIURM1",27,0)
INSTATUS(TIUDA,STATIFNS) ; Evaluates whether a record
"RTN","TIURM1",28,0)
 ;is among the selected statuses
"RTN","TIURM1",29,0)
 N TIUS,TIUSTAT,TIUSTATE,TIUY S TIUY=0
"RTN","TIURM1",30,0)
 S TIUSTATE=+$P($G(^TIU(8925,+TIUDA,0)),U,5)
"RTN","TIURM1",31,0)
 S TIUS=1 F  S TIUSTAT=$P(STATIFNS,";",TIUS) Q:'TIUSTAT!TIUY  D
"RTN","TIURM1",32,0)
 . S TIUS=TIUS+1
"RTN","TIURM1",33,0)
 . I TIUSTAT=TIUSTATE S TIUY=1
"RTN","TIURM1",34,0)
 Q TIUY
"RTN","TIURM1",35,0)
ININST(TIUDA,TIUDI) ; Evaluates whether a TIU DOCUMENT record
"RTN","TIURM1",36,0)
 ; is among the selected divisions
"RTN","TIURM1",37,0)
 ; Input -- TIUDA    TIU DOCUMENT file (#8925) IEN
"RTN","TIURM1",38,0)
 ;       -- TIUDI(   i.e. TIUDI(file #40.8 IEN)=Institution file
"RTN","TIURM1",39,0)
 ;                                           pointer for file #40.8 entry
"RTN","TIURM1",40,0)
 ; Output - TIUY     0= record not in selected division
"RTN","TIURM1",41,0)
 ;                   1= record in selected division
"RTN","TIURM1",42,0)
 N TIUIFP,TIUI,TIUINST,TIUY S TIUY=0
"RTN","TIURM1",43,0)
 S TIUINST=+$P($G(^TIU(8925,+TIUDA,12)),U,12)
"RTN","TIURM1",44,0)
 S TIUI=0 F  S TIUI=$O(TIUDI(TIUI)) Q:'TIUI!TIUY  D
"RTN","TIURM1",45,0)
 . S TIUIFP=$G(TIUDI(TIUI))
"RTN","TIURM1",46,0)
 . I TIUIFP=TIUINST S TIUY=1
"RTN","TIURM1",47,0)
 Q TIUY
"RTN","TIURM1",48,0)
DADINTYP(TIUDA) ; Evaluates whether addendum's parent is among
"RTN","TIURM1",49,0)
 ;                 the selected types
"RTN","TIURM1",50,0)
 N TIUI,TIUDTYP,TIUY S (TIUI,TIUY)=0
"RTN","TIURM1",51,0)
 S TIUDTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIURM1",52,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIURM1",53,0)
 . I +$P(^TMP("TIUTYP",$J,TIUI),U,2)=TIUDTYP S TIUY=1
"RTN","TIURM1",54,0)
 Q TIUY
"RTN","TIURM1",55,0)
 ;
"RTN","TIURM1",56,0)
PUTLIST(TIUPREF,TIUCLASS,STATUS,DIVIFNS) ; Expands list elements for LM Template
"RTN","TIURM1",57,0)
 N TIUJ,TIUQ,TIUDA,TIUPICK,TIUORDER,TIUEXPKD,TIUSFLD
"RTN","TIURM1",58,0)
 S VALMCNT=0
"RTN","TIURM1",59,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURM1",60,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURM1",61,0)
 S TIUORDER=$S($P(TIUPREF,U,4)="A":1,1:-1)
"RTN","TIURM1",62,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIURM1",63,0)
 S TIUQ="" F  S TIUQ=$O(^TMP("TIUI",$J,TIUQ)) Q:TIUQ']""  D
"RTN","TIURM1",64,0)
 . S TIUJ=0 F  S TIUJ=$O(^TMP("TIUI",$J,TIUQ,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIURM1",65,0)
 . . S TIUDA=0
"RTN","TIURM1",66,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)) Q:'TIUDA  D
"RTN","TIURM1",67,0)
 . . . D REPLACE^TIUR2(TIUDA,TIUQ,TIUSFLD,TIUJ,.TIUEXPKD)
"RTN","TIURM1",68,0)
 D SETLIST(TIUORDER,.VALMCNT)
"RTN","TIURM1",69,0)
 S ^TMP("TIUR",$J,0)=+$G(VALMCNT)_U_STATUS("WORDS")
"RTN","TIURM1",70,0)
 S ^TMP("TIUR",$J,"CLASS")=TIUCLASS
"RTN","TIURM1",71,0)
 S ^TMP("TIUR",$J,"#")=TIUPICK_"^1:"_+$G(VALMCNT)
"RTN","TIURM1",72,0)
 M ^TMP("TIUR",$J,"DIV")=DIVIFNS
"RTN","TIURM1",73,0)
 I $D(VALMHDR)>9 D HDR^TIURMH
"RTN","TIURM1",74,0)
 I +$G(VALMCNT)'>0 D
"RTN","TIURM1",75,0)
 . S ^TMP("TIUR",$J,1,0)="",VALMCNT=2
"RTN","TIURM1",76,0)
 . S ^TMP("TIUR",$J,2,0)="     No records found to satisfy search criteria."
"RTN","TIURM1",77,0)
 . S ^TMP("TIUR",$J,"IDX",1,0)="" ; User can't select lines 1 or 2
"RTN","TIURM1",78,0)
 . S ^TMP("TIUR",$J,"IDX",2,0)=""
"RTN","TIURM1",79,0)
 ; -- Expand to show kids that fit:
"RTN","TIURM1",80,0)
 I '$G(TIURBLD),$D(TIUEXPKD) D EXPANDKD^TIUR2(.STATUS,.TIUEXPKD)
"RTN","TIURM1",81,0)
 Q
"RTN","TIURM1",82,0)
SETLIST(TIUORDER,VALMCNT) ; Set items from ^TMP("TIUI",$J) into
"RTN","TIURM1",83,0)
 ;List Template list
"RTN","TIURM1",84,0)
 N SORTVAL,TIUDTM,TIUDA
"RTN","TIURM1",85,0)
 S SORTVAL=""
"RTN","TIURM1",86,0)
 F  S SORTVAL=$O(^TMP("TIUI",$J,SORTVAL),TIUORDER) Q:SORTVAL=""  D
"RTN","TIURM1",87,0)
 . S TIUDTM=0
"RTN","TIURM1",88,0)
 . F  S TIUDTM=$O(^TMP("TIUI",$J,SORTVAL,TIUDTM)) Q:'TIUDTM  D
"RTN","TIURM1",89,0)
 . . S TIUDA=0
"RTN","TIURM1",90,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,SORTVAL,TIUDTM,TIUDA)) Q:'TIUDA  D
"RTN","TIURM1",91,0)
 . . . D ADDELMNT(TIUDA,.VALMCNT)
"RTN","TIURM1",92,0)
 Q
"RTN","TIURM1",93,0)
 ;
"RTN","TIURM1",94,0)
ADDELMNT(DA,TIUCNT,APPEND) ; Add each element to the list
"RTN","TIURM1",95,0)
 N PT,ADT,DDT,AUT,AMD,EDT,LCT,SDT,TIULST4,INSTA,TIUSTN
"RTN","TIURM1",96,0)
 N TIUREC,TIUD0,TIUD12,TIUD13,TIUD15,STATX,TIULI,DOC ;P74 newed DOC
"RTN","TIURM1",97,0)
 N PREFIX,TIUGDATA
"RTN","TIURM1",98,0)
 I '$D(^TIU(8925,TIUDA,0)) Q
"RTN","TIURM1",99,0)
 I $G(^TMP("TIUR",$J,2,0))="     No records found to satisfy search criteria." D
"RTN","TIURM1",100,0)
 . K ^TMP("TIUR",$J,2),^TMP("TIUR",$J,"IDX",2),^TMP("TIUR",$J,"IDX",1)
"RTN","TIURM1",101,0)
 . S TIUCNT=0
"RTN","TIURM1",102,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIURM1",103,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIURM1",104,0)
 S DOC=$$PNAME^TIULC1(+TIUD0)
"RTN","TIURM1",105,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIURM1",106,0)
 S PREFIX=$$PREFIX^TIULA2(TIUDA,0)
"RTN","TIURM1",107,0)
 S PT=$$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FI MI")
"RTN","TIURM1",108,0)
 S TIULI=$E(PT)
"RTN","TIURM1",109,0)
 S PT=PREFIX_PT
"RTN","TIURM1",110,0)
 S TIULST4=$E($P($G(^DPT(+$P(TIUD0,U,2),0)),U,9),6,9)
"RTN","TIURM1",111,0)
 S TIULST4="("_TIULI_TIULST4_")"
"RTN","TIURM1",112,0)
 S ADT=$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/YY")
"RTN","TIURM1",113,0)
 S DDT=$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/YY")
"RTN","TIURM1",114,0)
 S AMD=$$PERSNAME^TIULC1($P(TIUD12,U,8)) S:AMD="UNKNOWN" AMD=""
"RTN","TIURM1",115,0)
 S AUT=$$PERSNAME^TIULC1($P(TIUD12,U,2)) S:AUT="UNKNOWN" AUT=""
"RTN","TIURM1",116,0)
 S AMD=$$NAME^TIULS(AMD,"LAST, FI MI")
"RTN","TIURM1",117,0)
 S AUT=$$NAME^TIULS(AUT,"LAST, FI MI")
"RTN","TIURM1",118,0)
 S EDT=$$DATE^TIULS($P(TIUD13,U,7),"MM/DD/YY")
"RTN","TIURM1",119,0)
 S SDT=$S(+$P(TIUD15,U,7):+$P(TIUD15,U,7),+$P(TIUD0,U,5)'<7:+$P(TIUD15,U),1:"")
"RTN","TIURM1",120,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIURM1",121,0)
 S STATX=$P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U)
"RTN","TIURM1",122,0)
 S LCT=$P(TIUD0,U,10)
"RTN","TIURM1",123,0)
 S INSTA=""
"RTN","TIURM1",124,0)
 I +$P(TIUD12,U,12)>0 D
"RTN","TIURM1",125,0)
 . S TIUSTN=$$NS^XUAF4($P(TIUD12,U,12))
"RTN","TIURM1",126,0)
 . I $P(TIUSTN,U,2)]"" S INSTA=$P(TIUSTN,U,2)
"RTN","TIURM1",127,0)
 S INSTA=$E(INSTA,1,8)
"RTN","TIURM1",128,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIURM1",129,0)
 S TIUREC=$$SETFLD^VALM1(TIUCNT,"","NUMBER")
"RTN","TIURM1",130,0)
 S TIUREC=$$SETFLD^VALM1(PT,TIUREC,"PATIENT NAME")
"RTN","TIURM1",131,0)
 S TIUREC=$$SETFLD^VALM1(TIULST4,TIUREC,"LAST I/LAST 4")
"RTN","TIURM1",132,0)
 S TIUREC=$$SETFLD^VALM1(DOC,TIUREC,"DOCUMENT TYPE")
"RTN","TIURM1",133,0)
 S TIUREC=$$SETFLD^VALM1(ADT,TIUREC,"ADMISSION DATE")
"RTN","TIURM1",134,0)
 S TIUREC=$$SETFLD^VALM1(DDT,TIUREC,"DISCH DATE")
"RTN","TIURM1",135,0)
 S TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"DICT DATE")
"RTN","TIURM1",136,0)
 S TIUREC=$$SETFLD^VALM1(LCT,TIUREC,"LINE COUNT")
"RTN","TIURM1",137,0)
 S TIUREC=$$SETFLD^VALM1($$LOWER^TIULS(STATX),TIUREC,"STATUS")
"RTN","TIURM1",138,0)
 S TIUREC=$$SETFLD^VALM1(AUT,TIUREC,"AUTHOR")
"RTN","TIURM1",139,0)
 S TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"ATTENDING")
"RTN","TIURM1",140,0)
 S TIUREC=$$SETFLD^VALM1(INSTA,TIUREC,"DIVISION")
"RTN","TIURM1",141,0)
 S ^TMP("TIUR",$J,TIUCNT,0)=TIUREC
"RTN","TIURM1",142,0)
 S ^TMP("TIUR",$J,"IDX",TIUCNT,TIUCNT)="" W "."
"RTN","TIURM1",143,0)
 S ^TMP("TIURIDX",$J,TIUCNT)=TIUCNT_U_DA_U_PREFIX
"RTN","TIURM1",144,0)
 S ^TMP("TIUR",$J,"IEN",DA,TIUCNT)=""
"RTN","TIURM1",145,0)
 S TIUGDATA=$$IDDATA^TIURECL1(DA,TIUD0)
"RTN","TIURM1",146,0)
 I TIUGDATA S ^TMP("TIUR",$J,"IDDATA",DA)=TIUGDATA
"RTN","TIURM1",147,0)
 I +$G(APPEND) D
"RTN","TIURM1",148,0)
 . D RESTORE^VALM10(TIUCNT)
"RTN","TIURM1",149,0)
 . D CNTRL^VALM10(TIUCNT,1,$G(VALM("RM")),IOINHI,IOINORM),HDR^TIURMH
"RTN","TIURM1",150,0)
 . S VALMSG="** Item #"_TIUCNT_" Added **"
"RTN","TIURM1",151,0)
 . S $P(^TMP("TIUR",$J,0),U)=TIUCNT
"RTN","TIURM1",152,0)
 . S $P(^TMP("TIUR",$J,"#"),":",2)=TIUCNT
"RTN","TIURM1",153,0)
 . S VALMCNT=TIUCNT
"RTN","TIURM1",154,0)
 . I $D(VALMHDR)>9 D HDR^TIURMH
"RTN","TIURM1",155,0)
 Q
"RTN","TIURPTT1")
0^27^B29551790
"RTN","TIURPTT1",1,0)
TIURPTT1 ; SLC/JER - Review Documents by PATIENT & TITLE ;4/18/03
"RTN","TIURPTT1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,113**;Jun 20, 1997
"RTN","TIURPTT1",3,0)
 ; 12/5/00 new rtn from splitting TIURPTTL
"RTN","TIURPTT1",4,0)
GATHER(TIUI,TIUPREF,CLASS,STATIFNS,EARLY,LATE,XREF) ; Find/sort records for the list
"RTN","TIURPTT1",5,0)
 N TIUT,TIUTP,TIUS,TIUSTAT,TIUSFLD,TIUJ,TIUQ,TIUIFN
"RTN","TIURPTT1",6,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURPTT1",7,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURPTT1",8,0)
 S TIUT=0 F  S TIUT=$O(TYPES(TIUT)) Q:+TIUT'>0  D
"RTN","TIURPTT1",9,0)
 . S TIUTP=+$P($G(TYPES(TIUT)),U,2) Q:TIUTP'>0
"RTN","TIURPTT1",10,0)
 . S TIUS=1 F  S TIUSTAT=$P(STATIFNS,";",TIUS) Q:'TIUSTAT  D
"RTN","TIURPTT1",11,0)
 . . S TIUS=TIUS+1
"RTN","TIURPTT1",12,0)
 . . S TIUJ=LATE F  S TIUJ=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ)) Q:+TIUJ'>0!(+TIUJ>EARLY)  D
"RTN","TIURPTT1",13,0)
 . . . S TIUIFN=0
"RTN","TIURPTT1",14,0)
 . . . F  S TIUIFN=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ,TIUIFN)) Q:+TIUIFN'>0  D
"RTN","TIURPTT1",15,0)
 . . . . ;Consider adding view check here
"RTN","TIURPTT1",16,0)
 . . . . I TIUTP=81,(+TYPES>1),($P(TYPES(TIUT),U,4)="NOT PICKED"),'+$$DADINTYP(TIUIFN,.TYPES) Q
"RTN","TIURPTT1",17,0)
 . . . . S TIUQ=$$RESOLVE^TIUR1(TIUIFN,TIUSFLD)
"RTN","TIURPTT1",18,0)
 . . . . S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN)=""
"RTN","TIURPTT1",19,0)
 Q
"RTN","TIURPTT1",20,0)
DADINTYP(TIUDA,TYPES) ; Evaluates whether addendum's parent belongs is among
"RTN","TIURPTT1",21,0)
 ;                 the selected types
"RTN","TIURPTT1",22,0)
 N TIUI,TIUDTYP,TIUY S (TIUI,TIUY)=0
"RTN","TIURPTT1",23,0)
 S TIUDTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIURPTT1",24,0)
 F  S TIUI=$O(TYPES(TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIURPTT1",25,0)
 . I +$P(TYPES(TIUI),U,2)=TIUDTYP S TIUY=1
"RTN","TIURPTT1",26,0)
 Q TIUY
"RTN","TIURPTT1",27,0)
PUTLIST(TIUPREF,TIUCLASS,STATUS,SCREEN) ; Adds list elements
"RTN","TIURPTT1",28,0)
 ;to LM Template array
"RTN","TIURPTT1",29,0)
 N TIUJ,TIUQ,TIUDA,TIUPICK,TIUORDER
"RTN","TIURPTT1",30,0)
 N TIUEXPKD,FORGETAD,TIUSFLD
"RTN","TIURPTT1",31,0)
 S VALMCNT=0
"RTN","TIURPTT1",32,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURPTT1",33,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURPTT1",34,0)
 S TIUORDER=$S($P(TIUPREF,U,4)="D":-1,1:1)
"RTN","TIURPTT1",35,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIURPTT1",36,0)
 S TIUQ="" F  S TIUQ=$O(^TMP("TIUI",$J,TIUQ)) Q:TIUQ']""  D
"RTN","TIURPTT1",37,0)
 . S TIUJ=0 F  S TIUJ=$O(^TMP("TIUI",$J,TIUQ,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIURPTT1",38,0)
 . . S TIUDA=0
"RTN","TIURPTT1",39,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIURPTT1",40,0)
 . . . S FORGETAD=1
"RTN","TIURPTT1",41,0)
 . . . ; Replace ID kids/addenda in ^TMP("TIUI",$J) with
"RTN","TIURPTT1",42,0)
 . . . ;their parents. Don't expand parent for sake of addm:
"RTN","TIURPTT1",43,0)
 . . . D REPLACE^TIUR2(TIUDA,TIUQ,TIUSFLD,TIUJ,.TIUEXPKD,FORGETAD)
"RTN","TIURPTT1",44,0)
 D SETLIST(TIUORDER,.VALMCNT)
"RTN","TIURPTT1",45,0)
 S ^TMP("TIUR",$J,0)=+$G(VALMCNT)_U_STATUS("WORDS")
"RTN","TIURPTT1",46,0)
 S TIUJ=0,SCREEN="" F  S TIUJ=$O(SCREEN(TIUJ)) Q:+TIUJ'>0  D
"RTN","TIURPTT1",47,0)
 . S SCREEN=$G(SCREEN)_$S(TIUJ>1:";",1:U)_SCREEN(TIUJ)
"RTN","TIURPTT1",48,0)
 S ^TMP("TIUR",$J,0)=^TMP("TIUR",$J,0)_$G(SCREEN)
"RTN","TIURPTT1",49,0)
 S ^TMP("TIUR",$J,"CLASS")=TIUCLASS
"RTN","TIURPTT1",50,0)
 S ^TMP("TIUR",$J,"#")=TIUPICK_"^1:"_+$G(VALMCNT)
"RTN","TIURPTT1",51,0)
 I $D(VALMHDR)>9 D HDR^TIURH
"RTN","TIURPTT1",52,0)
 I +$G(VALMCNT)'>0 D
"RTN","TIURPTT1",53,0)
 . S ^TMP("TIUR",$J,1,0)="",VALMCNT=2
"RTN","TIURPTT1",54,0)
 . S ^TMP("TIUR",$J,2,0)="     No records found to satisfy search criteria."
"RTN","TIURPTT1",55,0)
 ; -- Expand to show kids that fit:
"RTN","TIURPTT1",56,0)
 I '$G(TIURBLD),$D(TIUEXPKD) D EXPANDKD^TIUR2(.STATUS,.TIUEXPKD)
"RTN","TIURPTT1",57,0)
 Q
"RTN","TIURPTT1",58,0)
 ;
"RTN","TIURPTT1",59,0)
SETLIST(TIUORDER,VALMCNT) ; Set items from ^TMP("TIUI",$J) into
"RTN","TIURPTT1",60,0)
 ;List Template list
"RTN","TIURPTT1",61,0)
 N TIUSVAL,TIUDTM,TIUDA
"RTN","TIURPTT1",62,0)
 S TIUSVAL=""
"RTN","TIURPTT1",63,0)
 F  S TIUSVAL=$O(^TMP("TIUI",$J,TIUSVAL),TIUORDER) Q:TIUSVAL=""  D
"RTN","TIURPTT1",64,0)
 . S TIUDTM=0
"RTN","TIURPTT1",65,0)
 . F  S TIUDTM=$O(^TMP("TIUI",$J,TIUSVAL,TIUDTM)) Q:'TIUDTM  D
"RTN","TIURPTT1",66,0)
 . . S TIUDA=0
"RTN","TIURPTT1",67,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUSVAL,TIUDTM,TIUDA)) Q:'TIUDA  D
"RTN","TIURPTT1",68,0)
 . . . D ADDELMNT(TIUDA,.VALMCNT)
"RTN","TIURPTT1",69,0)
 Q
"RTN","TIURPTT1",70,0)
 ;
"RTN","TIURPTT1",71,0)
ADDELMNT(DA,TIUCNT,APPEND) ; Add each element to the list
"RTN","TIURPTT1",72,0)
 N PT,ADT,DDT,AUT,AMD,EDT,SDT,TIULST4
"RTN","TIURPTT1",73,0)
 N TIUREC,TIUD0,TIUD12,TIUD13,TIUD15,TIULI,STATX,DOC
"RTN","TIURPTT1",74,0)
 N PREFIX,TIUGDATA
"RTN","TIURPTT1",75,0)
 I '$D(^TIU(8925,DA,0)) Q
"RTN","TIURPTT1",76,0)
 I $G(^TMP("TIUR",$J,2,0))="     No records found to satisfy search criteria." D
"RTN","TIURPTT1",77,0)
 . K ^TMP("TIUR",$J,2),^TMP("TIUR",$J,"IDX",2),^TMP("TIUR",$J,"IDX",1) S TIUCNT=0
"RTN","TIURPTT1",78,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIURPTT1",79,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIURPTT1",80,0)
 S DOC=$$PNAME^TIULC1(+TIUD0)
"RTN","TIURPTT1",81,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIURPTT1",82,0)
 S PREFIX=$$PREFIX^TIULA2(DA,0)
"RTN","TIURPTT1",83,0)
 S PT=$$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FI MI")
"RTN","TIURPTT1",84,0)
 S TIULI=$E(PT)
"RTN","TIURPTT1",85,0)
 S PT=PREFIX_PT
"RTN","TIURPTT1",86,0)
 S TIULST4=$E($P($G(^DPT(+$P(TIUD0,U,2),0)),U,9),6,9)
"RTN","TIURPTT1",87,0)
 S TIULST4="("_TIULI_TIULST4_")"
"RTN","TIURPTT1",88,0)
 S ADT=$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/YY")
"RTN","TIURPTT1",89,0)
 S DDT=$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/YY")
"RTN","TIURPTT1",90,0)
 S AMD=$$PERSNAME^TIULC1($P(TIUD12,U,8)) S:AMD="UNKNOWN" AMD=""
"RTN","TIURPTT1",91,0)
 S AUT=$$PERSNAME^TIULC1($P(TIUD12,U,2)) S:AUT="UNKNOWN" AUT=""
"RTN","TIURPTT1",92,0)
 S AMD=$$NAME^TIULS(AMD,"LAST, FI MI")
"RTN","TIURPTT1",93,0)
 S AUT=$$NAME^TIULS(AUT,"LAST, FI MI")
"RTN","TIURPTT1",94,0)
 S EDT=$$DATE^TIULS($P(TIUD13,U),"MM/DD/YY")
"RTN","TIURPTT1",95,0)
 S SDT=$S(+$P(TIUD15,U,7):+$P(TIUD15,U,7),+$P(TIUD0,U,5)'<7:+$P(TIUD15,U),1:"")
"RTN","TIURPTT1",96,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIURPTT1",97,0)
 S STATX=$P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U)
"RTN","TIURPTT1",98,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIURPTT1",99,0)
 S TIUREC=$$SETFLD^VALM1(TIUCNT,"","NUMBER")
"RTN","TIURPTT1",100,0)
 S TIUREC=$$SETFLD^VALM1(PT,TIUREC,"PATIENT NAME")
"RTN","TIURPTT1",101,0)
 S TIUREC=$$SETFLD^VALM1(TIULST4,TIUREC,"LAST I/LAST 4")
"RTN","TIURPTT1",102,0)
 S TIUREC=$$SETFLD^VALM1(DOC,TIUREC,"DOCUMENT TYPE")
"RTN","TIURPTT1",103,0)
 S TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"REF DATE")
"RTN","TIURPTT1",104,0)
 S TIUREC=$$SETFLD^VALM1($$LOWER^TIULS(STATX),TIUREC,"STATUS")
"RTN","TIURPTT1",105,0)
 S TIUREC=$$SETFLD^VALM1(SDT,TIUREC,"SIG DATE")
"RTN","TIURPTT1",106,0)
 S TIUREC=$$SETFLD^VALM1(AUT,TIUREC,"AUTHOR")
"RTN","TIURPTT1",107,0)
 S TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"EXPECTED COSIGNER")
"RTN","TIURPTT1",108,0)
 S ^TMP("TIUR",$J,TIUCNT,0)=TIUREC
"RTN","TIURPTT1",109,0)
 S ^TMP("TIUR",$J,"IDX",TIUCNT,TIUCNT)="" W "."
"RTN","TIURPTT1",110,0)
 S ^TMP("TIURIDX",$J,TIUCNT)=TIUCNT_U_DA_U_PREFIX
"RTN","TIURPTT1",111,0)
 S ^TMP("TIUR",$J,"IEN",DA,TIUCNT)="" ;MARGY 11/11/00
"RTN","TIURPTT1",112,0)
 S TIUGDATA=$$IDDATA^TIURECL1(DA,TIUD0)
"RTN","TIURPTT1",113,0)
 I TIUGDATA S ^TMP("TIUR",$J,"IDDATA",DA)=TIUGDATA
"RTN","TIURPTT1",114,0)
 S VALMCNT=TIUCNT
"RTN","TIURPTT1",115,0)
 I +$G(APPEND) D
"RTN","TIURPTT1",116,0)
 . D RESTORE^VALM10(TIUCNT)
"RTN","TIURPTT1",117,0)
 . D CNTRL^VALM10(TIUCNT,1,$G(VALM("RM")),IOINHI,IOINORM),HDR^TIURH
"RTN","TIURPTT1",118,0)
 . S VALMSG="** Item #"_TIUCNT_" Added **"
"RTN","TIURPTT1",119,0)
 . S $P(^TMP("TIUR",$J,0),U)=TIUCNT
"RTN","TIURPTT1",120,0)
 . S $P(^TMP("TIUR",$J,"#"),":",2)=TIUCNT
"RTN","TIURPTT1",121,0)
 . S VALMCNT=TIUCNT
"RTN","TIURPTT1",122,0)
 . I $D(VALMHDR)>9 D HDR^TIURH
"RTN","TIURPTT1",123,0)
 Q
"RTN","TIURPTT1",124,0)
 ;
"RTN","TIURTIT1")
0^28^B29661319
"RTN","TIURTIT1",1,0)
TIURTIT1 ; SLC/JER - Review Documents by TITLE ;4/18/03
"RTN","TIURTIT1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,113**;Jun 20, 1997
"RTN","TIURTIT1",3,0)
 ; New rtn, created 12/6/00 when splitting TIURTITL
"RTN","TIURTIT1",4,0)
GATHER(TIUI,TIUPREF,CLASS,STATIFNS,EARLY,LATE,XREF) ; Find/sort records for the list
"RTN","TIURTIT1",5,0)
 N TIUT,TIUTP,TIUS,TIUSTAT,TIUSFLD,TIUJ,TIUIFN,TIUQ
"RTN","TIURTIT1",6,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURTIT1",7,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURTIT1",8,0)
 S TIUT=0 F  S TIUT=$O(TYPES(TIUT)) Q:+TIUT'>0  D
"RTN","TIURTIT1",9,0)
 . S TIUTP=+$P($G(TYPES(TIUT)),U,2) Q:TIUTP'>0
"RTN","TIURTIT1",10,0)
 . S TIUS=1 F  S TIUSTAT=$P(STATIFNS,";",TIUS) Q:'TIUSTAT  D
"RTN","TIURTIT1",11,0)
 . . S TIUS=TIUS+1
"RTN","TIURTIT1",12,0)
 . . S TIUJ=LATE F  S TIUJ=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ)) Q:+TIUJ'>0!(+TIUJ>EARLY)  D
"RTN","TIURTIT1",13,0)
 . . . S TIUIFN=0
"RTN","TIURTIT1",14,0)
 . . . F  S TIUIFN=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ,TIUIFN)) Q:+TIUIFN'>0  D
"RTN","TIURTIT1",15,0)
 . . . . ;Consider adding view check here
"RTN","TIURTIT1",16,0)
 . . . . I TIUTP=81,(+TYPES>1),($P(TYPES(TIUT),U,4)="NOT PICKED"),'+$$DADINTYP(TIUIFN,.TYPES) Q
"RTN","TIURTIT1",17,0)
 . . . . S TIUQ=$$RESOLVE^TIUR1(TIUIFN,TIUSFLD)
"RTN","TIURTIT1",18,0)
 . . . . S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN)=""
"RTN","TIURTIT1",19,0)
 Q
"RTN","TIURTIT1",20,0)
DADINTYP(TIUDA,TYPES) ; Evaluates whether addendum's parent is among
"RTN","TIURTIT1",21,0)
 ;                 the selected types
"RTN","TIURTIT1",22,0)
 N TIUI,TIUDTYP,TIUY S (TIUI,TIUY)=0
"RTN","TIURTIT1",23,0)
 S TIUDTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIURTIT1",24,0)
 F  S TIUI=$O(TYPES(TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIURTIT1",25,0)
 . I +$P(TYPES(TIUI),U,2)=TIUDTYP S TIUY=1
"RTN","TIURTIT1",26,0)
 Q TIUY
"RTN","TIURTIT1",27,0)
PUTLIST(TIUPREF,TIUCLASS,STATUS,SCREEN) ; Adds list elements to LM Template
"RTN","TIURTIT1",28,0)
 ;array
"RTN","TIURTIT1",29,0)
 N TIUJ,TIUQ,TIUDA,TIUPICK,TIUORDER,TIUSFLD
"RTN","TIURTIT1",30,0)
 N TIUEXPKD,FORGETAD
"RTN","TIURTIT1",31,0)
 S VALMCNT=0
"RTN","TIURTIT1",32,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURTIT1",33,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURTIT1",34,0)
 S TIUORDER=$S($P(TIUPREF,U,4)="D":-1,1:1)
"RTN","TIURTIT1",35,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIURTIT1",36,0)
 S TIUQ="" F  S TIUQ=$O(^TMP("TIUI",$J,TIUQ)) Q:TIUQ']""  D
"RTN","TIURTIT1",37,0)
 . S TIUJ=0 F  S TIUJ=$O(^TMP("TIUI",$J,TIUQ,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIURTIT1",38,0)
 . . S TIUDA=0
"RTN","TIURTIT1",39,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIURTIT1",40,0)
 . . . S FORGETAD=1
"RTN","TIURTIT1",41,0)
 . . . ; Replace ID kids/addenda in ^TMP("TIUI",$J) with
"RTN","TIURTIT1",42,0)
 . . . ;their parents. Don't expand parent for sake of addm:
"RTN","TIURTIT1",43,0)
 . . . D REPLACE^TIUR2(TIUDA,TIUQ,TIUSFLD,TIUJ,.TIUEXPKD,FORGETAD)
"RTN","TIURTIT1",44,0)
 D SETLIST(TIUORDER,.VALMCNT)
"RTN","TIURTIT1",45,0)
 S ^TMP("TIUR",$J,0)=+$G(VALMCNT)_U_STATUS("WORDS")
"RTN","TIURTIT1",46,0)
 S TIUJ=0,SCREEN="" F  S TIUJ=$O(SCREEN(TIUJ)) Q:+TIUJ'>0  D
"RTN","TIURTIT1",47,0)
 . S SCREEN=$G(SCREEN)_$S(TIUJ>1:";",1:U)_SCREEN(TIUJ)
"RTN","TIURTIT1",48,0)
 S ^TMP("TIUR",$J,0)=^TMP("TIUR",$J,0)_$G(SCREEN)
"RTN","TIURTIT1",49,0)
 S ^TMP("TIUR",$J,"CLASS")=TIUCLASS
"RTN","TIURTIT1",50,0)
 S ^TMP("TIUR",$J,"#")=TIUPICK_"^1:"_+$G(VALMCNT)
"RTN","TIURTIT1",51,0)
 I $D(VALMHDR)>9 D HDR^TIURTITH
"RTN","TIURTIT1",52,0)
 I +$G(VALMCNT)'>0 D
"RTN","TIURTIT1",53,0)
 . S ^TMP("TIUR",$J,1,0)="",VALMCNT=2
"RTN","TIURTIT1",54,0)
 . S ^TMP("TIUR",$J,2,0)="     No records found to satisfy search criteria."
"RTN","TIURTIT1",55,0)
 ; -- Expand to show kids that fit:
"RTN","TIURTIT1",56,0)
 I '$G(TIURBLD),$D(TIUEXPKD) D EXPANDKD^TIUR2(.STATUS,.TIUEXPKD)
"RTN","TIURTIT1",57,0)
 Q
"RTN","TIURTIT1",58,0)
 ;
"RTN","TIURTIT1",59,0)
SETLIST(TIUORDER,VALMCNT) ; Set items from ^TMP("TIUI",$J) into
"RTN","TIURTIT1",60,0)
 ;List Template list
"RTN","TIURTIT1",61,0)
 N TIUSVAL,TIUDTM,TIUDA
"RTN","TIURTIT1",62,0)
 S TIUSVAL=""
"RTN","TIURTIT1",63,0)
 F  S TIUSVAL=$O(^TMP("TIUI",$J,TIUSVAL),TIUORDER) Q:TIUSVAL=""  D
"RTN","TIURTIT1",64,0)
 . S TIUDTM=0
"RTN","TIURTIT1",65,0)
 . F  S TIUDTM=$O(^TMP("TIUI",$J,TIUSVAL,TIUDTM)) Q:'TIUDTM  D
"RTN","TIURTIT1",66,0)
 . . S TIUDA=0
"RTN","TIURTIT1",67,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUSVAL,TIUDTM,TIUDA)) Q:'TIUDA  D
"RTN","TIURTIT1",68,0)
 . . . D ADDELMNT(TIUDA,.VALMCNT)
"RTN","TIURTIT1",69,0)
 Q
"RTN","TIURTIT1",70,0)
 ;
"RTN","TIURTIT1",71,0)
ADDELMNT(DA,TIUCNT,APPEND) ; Add each element to the list
"RTN","TIURTIT1",72,0)
 N PT,ADT,DDT,AUT,AMD,EDT,SDT,TIULST4
"RTN","TIURTIT1",73,0)
 N TIUREC,TIUD0,TIUD12,TIUD13,TIUD15,TIULI,STATX,DOC
"RTN","TIURTIT1",74,0)
 N PREFIX,TIUGDATA
"RTN","TIURTIT1",75,0)
 I '$D(^TIU(8925,DA,0)) Q
"RTN","TIURTIT1",76,0)
 I $G(^TMP("TIUR",$J,2,0))="     No records found to satisfy search criteria." D
"RTN","TIURTIT1",77,0)
 . K ^TMP("TIUR",$J,2),^TMP("TIUR",$J,"IDX",2),^TMP("TIUR",$J,"IDX",1) S TIUCNT=0
"RTN","TIURTIT1",78,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIURTIT1",79,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIURTIT1",80,0)
 S DOC=$$PNAME^TIULC1(+TIUD0)
"RTN","TIURTIT1",81,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIURTIT1",82,0)
 S PREFIX=$$PREFIX^TIULA2(DA,0)
"RTN","TIURTIT1",83,0)
 S PT=$$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FI MI")
"RTN","TIURTIT1",84,0)
 S TIULI=$E(PT)
"RTN","TIURTIT1",85,0)
 S PT=PREFIX_PT
"RTN","TIURTIT1",86,0)
 S TIULST4=$E($P($G(^DPT(+$P(TIUD0,U,2),0)),U,9),6,9)
"RTN","TIURTIT1",87,0)
 S TIULST4="("_TIULI_TIULST4_")"
"RTN","TIURTIT1",88,0)
 S ADT=$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/YY")
"RTN","TIURTIT1",89,0)
 S DDT=$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/YY")
"RTN","TIURTIT1",90,0)
 S AMD=$$PERSNAME^TIULC1($P(TIUD12,U,8)) S:AMD="UNKNOWN" AMD=""
"RTN","TIURTIT1",91,0)
 S AUT=$$PERSNAME^TIULC1($P(TIUD12,U,2)) S:AUT="UNKNOWN" AUT=""
"RTN","TIURTIT1",92,0)
 S AMD=$$NAME^TIULS(AMD,"LAST, FI MI")
"RTN","TIURTIT1",93,0)
 S AUT=$$NAME^TIULS(AUT,"LAST, FI MI")
"RTN","TIURTIT1",94,0)
 S EDT=$$DATE^TIULS($P(TIUD13,U),"MM/DD/YY")
"RTN","TIURTIT1",95,0)
 S SDT=$S(+$P(TIUD15,U,7):+$P(TIUD15,U,7),+$P(TIUD0,U,5)'<7:+$P(TIUD15,U),1:"")
"RTN","TIURTIT1",96,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIURTIT1",97,0)
 S STATX=$P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U)
"RTN","TIURTIT1",98,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIURTIT1",99,0)
 S TIUREC=$$SETFLD^VALM1(TIUCNT,"","NUMBER")
"RTN","TIURTIT1",100,0)
 S TIUREC=$$SETFLD^VALM1(PT,TIUREC,"PATIENT NAME")
"RTN","TIURTIT1",101,0)
 S TIUREC=$$SETFLD^VALM1(TIULST4,TIUREC,"LAST I/LAST 4")
"RTN","TIURTIT1",102,0)
 S TIUREC=$$SETFLD^VALM1(DOC,TIUREC,"DOCUMENT TYPE")
"RTN","TIURTIT1",103,0)
 S TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"REF DATE")
"RTN","TIURTIT1",104,0)
 S TIUREC=$$SETFLD^VALM1($$LOWER^TIULS(STATX),TIUREC,"STATUS")
"RTN","TIURTIT1",105,0)
 S TIUREC=$$SETFLD^VALM1(SDT,TIUREC,"SIG DATE")
"RTN","TIURTIT1",106,0)
 S TIUREC=$$SETFLD^VALM1(AUT,TIUREC,"AUTHOR")
"RTN","TIURTIT1",107,0)
 S TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"EXPECTED COSIGNER")
"RTN","TIURTIT1",108,0)
 S ^TMP("TIUR",$J,TIUCNT,0)=TIUREC
"RTN","TIURTIT1",109,0)
 S ^TMP("TIUR",$J,"IDX",TIUCNT,TIUCNT)="" W "."
"RTN","TIURTIT1",110,0)
 S ^TMP("TIURIDX",$J,TIUCNT)=TIUCNT_U_DA_U_PREFIX
"RTN","TIURTIT1",111,0)
 S ^TMP("TIUR",$J,"IEN",DA,TIUCNT)="" ;MARGY 11/11/00
"RTN","TIURTIT1",112,0)
 S TIUGDATA=$$IDDATA^TIURECL1(DA,TIUD0)
"RTN","TIURTIT1",113,0)
 I TIUGDATA S ^TMP("TIUR",$J,"IDDATA",DA)=TIUGDATA
"RTN","TIURTIT1",114,0)
 S VALMCNT=TIUCNT
"RTN","TIURTIT1",115,0)
 I +$G(APPEND) D
"RTN","TIURTIT1",116,0)
 . D RESTORE^VALM10(TIUCNT)
"RTN","TIURTIT1",117,0)
 . D CNTRL^VALM10(TIUCNT,1,$G(VALM("RM")),IOINHI,IOINORM),HDR^TIURTITH
"RTN","TIURTIT1",118,0)
 . S VALMSG="** Item #"_TIUCNT_" Added **"
"RTN","TIURTIT1",119,0)
 . S $P(^TMP("TIUR",$J,0),U)=TIUCNT
"RTN","TIURTIT1",120,0)
 . S $P(^TMP("TIUR",$J,"#"),":",2)=TIUCNT
"RTN","TIURTIT1",121,0)
 . S VALMCNT=TIUCNT
"RTN","TIURTIT1",122,0)
 . I $D(VALMHDR)>9 D HDR^TIURTITH
"RTN","TIURTIT1",123,0)
 Q
"RTN","TIUSRV")
0^29^B69167379
"RTN","TIUSRV",1,0)
TIUSRV ; SLC/JER - Silent server functions ;4/18/03
"RTN","TIUSRV",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,19,28,87,61,100,109,113**;Jun 20, 1997
"RTN","TIUSRV",3,0)
RPC(TIUY,TIUDA,REASSIGN) ; RPC for DT
"RTN","TIUSRV",4,0)
 N VALMAR,TIUGDATA,TIUGWHOL K ^TMP("TIUAUDIT",$J)
"RTN","TIUSRV",5,0)
 S TIUY=$NA(^TMP("TIUAUDIT",$J))
"RTN","TIUSRV",6,0)
 D GET(TIUDA,1,+$G(REASSIGN))
"RTN","TIUSRV",7,0)
 K ^TMP("VALM VIDEO",$J)
"RTN","TIUSRV",8,0)
 Q
"RTN","TIUSRV",9,0)
GET(TIUDA,HUSH,REASSIGN) ; Build List
"RTN","TIUSRV",10,0)
 N TIUI,TIUL,TIUREC,TIUDADD,X,TIUCPF S (TIUDADD,TIUI)=0,HUSH=+$G(HUSH)
"RTN","TIUSRV",11,0)
 N DA,DIC,DIQ,DR,TIUNAME K ^TMP("TIUAUDIT",$J)
"RTN","TIUSRV",12,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUSRV",13,0)
 I '$D(IOINORM) S X="IOINORM;IOIHI;IORVON;IORVOFF;IOUON;IOUOFF;IOBON;IOBOFF" D ENDR^%ZISS
"RTN","TIUSRV",14,0)
 S:'$D(VALMAR) VALMAR="^TMP(""TIUAUDIT"",$J)"
"RTN","TIUSRV",15,0)
 S VALMEVL=+$G(VALMEVL)
"RTN","TIUSRV",16,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUSRV",17,0)
 ;Set a flag to indicate whether or not a Title is a member of the
"RTN","TIUSRV",18,0)
 ;Clinical Procedures Class (1=Yes and 0=No)
"RTN","TIUSRV",19,0)
 S TIUCPF=+$$ISA^TIULX(+$G(^TIU(8925,TIUDA,0)),+$$CLASS^TIUCP)
"RTN","TIUSRV",20,0)
 S DIC=8925,DIQ="TIUREC(",DA=TIUDA
"RTN","TIUSRV",21,0)
 S DR=".01;.02;.05;.07:.1;1201;1202;1204;1208;1212;1301;1302;1305;1306;1501;1502;1505;1507;1508;1511;1601:1602;1610:1612;1701"
"RTN","TIUSRV",22,0)
 ;If the document is a member of the Clinical Procedures Class, include the
"RTN","TIUSRV",23,0)
 ;Procedure Summary Code field and the Date/Time Performed field
"RTN","TIUSRV",24,0)
 I TIUCPF S DR=DR_";70201;70202"
"RTN","TIUSRV",25,0)
 D EN^DIQ1
"RTN","TIUSRV",26,0)
 S TIUI="" F  S TIUI=$O(TIUREC(8925,+TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",27,0)
 . I $G(TIUREC(8925,+TIUDA,TIUI))']"" S TIUREC(8925,+TIUDA,TIUI)="None"
"RTN","TIUSRV",28,0)
 . E  S TIUREC(8925,+TIUDA,TIUI)=$$UP^XLFSTR(TIUREC(8925,+TIUDA,TIUI))
"RTN","TIUSRV",29,0)
 I $D(TIUREC)>9 D
"RTN","TIUSRV",30,0)
 . D SOURCE(.TIUREC,HUSH,TIUCPF)
"RTN","TIUSRV",31,0)
 . D:'+$G(REASSIGN) PROBLEM(TIUDA),EDIT(TIUDA)
"RTN","TIUSRV",32,0)
 . D REASSIGN^TIUSRV1(TIUDA,+$G(REASSIGN)) Q:+$G(REASSIGN)
"RTN","TIUSRV",33,0)
 . D IDLINK^TIUSRV1(TIUDA)
"RTN","TIUSRV",34,0)
 . D SIGN(.TIUREC)
"RTN","TIUSRV",35,0)
 . I +$O(^TIU(8925.7,"B",TIUDA,0)) D XTRASIGN(TIUDA)
"RTN","TIUSRV",36,0)
 . I $D(^TIU(8925,+TIUDA,16)) D PRIVACY(.TIUREC)
"RTN","TIUSRV",37,0)
 . D BODY(TIUDA,.VALMCNT)
"RTN","TIUSRV",38,0)
 S:+$G(VALMCNT)<$G(VALM("LINES")) VALMCNT=$G(VALM("LINES"))
"RTN","TIUSRV",39,0)
 Q
"RTN","TIUSRV",40,0)
SOURCE(TIUREC,HUSH,TIUCPF) ; Source Info
"RTN","TIUSRV",41,0)
 N OFFSET,START
"RTN","TIUSRV",42,0)
 S OFFSET=2,START=1
"RTN","TIUSRV",43,0)
 W:'+$G(HUSH) !!,"Opening "_TIUREC(8925,+TIUDA,.01)_" record for review..."
"RTN","TIUSRV",44,0)
 D SET(START,1," Source Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",45,0)
 D SET(START+1,OFFSET," Reference Date: "_$G(TIUREC(8925,TIUDA,1301)))
"RTN","TIUSRV",46,0)
 D SET(START+2,OFFSET,"     Entry Date: "_$G(TIUREC(8925,TIUDA,1201)))
"RTN","TIUSRV",47,0)
 D SET(START+3,OFFSET,"Expected Signer: "_$G(TIUREC(8925,TIUDA,1204)))
"RTN","TIUSRV",48,0)
 D SET(START+4,OFFSET,"        Urgency: "_$G(TIUREC(8925,TIUDA,.09)))
"RTN","TIUSRV",49,0)
 D SET(START+5,OFFSET,"     Line Count: "_$G(TIUREC(8925,TIUDA,.1)))
"RTN","TIUSRV",50,0)
 D SET(START+6,OFFSET,"       Division: "_$G(TIUREC(8925,TIUDA,1212)))
"RTN","TIUSRV",51,0)
 D SET(START+7,OFFSET,"        Subject: "_$G(TIUREC(8925,TIUDA,1701)))
"RTN","TIUSRV",52,0)
 ;If the document is a member of the Clinical Procedures Class, include the
"RTN","TIUSRV",53,0)
 ;Procedure Summary Code field and the Date/Time Performed field
"RTN","TIUSRV",54,0)
 I $G(TIUCPF) D
"RTN","TIUSRV",55,0)
 . D BLANK(START+8)
"RTN","TIUSRV",56,0)
 . D SET(START+9,OFFSET,"Procedure Summary Code: "_$G(TIUREC(8925,TIUDA,70201)))
"RTN","TIUSRV",57,0)
 . D SET(START+10,OFFSET,"   Date/Time Performed: "_$G(TIUREC(8925,TIUDA,70202)))
"RTN","TIUSRV",58,0)
 S OFFSET=40
"RTN","TIUSRV",59,0)
 D SET(START+1,OFFSET,"            Author: "_$G(TIUREC(8925,TIUDA,1202)))
"RTN","TIUSRV",60,0)
 D SET(START+2,OFFSET,"        Entered By: "_$G(TIUREC(8925,TIUDA,1302)))
"RTN","TIUSRV",61,0)
 D SET(START+3,OFFSET," Expected Cosigner: "_$G(TIUREC(8925,TIUDA,1208)))
"RTN","TIUSRV",62,0)
 D SET(START+4,OFFSET,"   Document Status: "_$G(TIUREC(8925,TIUDA,.05)))
"RTN","TIUSRV",63,0)
 D SET(START+5,OFFSET,"    TIU Document #: "_+$G(TIUDA))
"RTN","TIUSRV",64,0)
 S VALMCNT=$S($G(TIUCPF):11,1:8)
"RTN","TIUSRV",65,0)
 Q
"RTN","TIUSRV",66,0)
PROBLEM(TIUDA) ; Problems
"RTN","TIUSRV",67,0)
 N TIUI,DR,DIC,DIQ,TIUCNT,TIUPROB,START S TIUI=0,START=VALMCNT+2
"RTN","TIUSRV",68,0)
 D BLANK(VALMCNT+1)
"RTN","TIUSRV",69,0)
 D SET(START,1," Associated Problems ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",70,0)
 I '+$O(^TIU(8925.9,"B",+TIUDA,0)) D SET(START,25,"No linked problems.")
"RTN","TIUSRV",71,0)
 F  S TIUI=$O(^TIU(8925.9,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",72,0)
 . S DA=TIUI,DR=".02;.05",DIC="^TIU(8925.9,",DIQ="TIUPROB"
"RTN","TIUSRV",73,0)
 . D EN^DIQ1 Q:$D(TIUPROB)'>9
"RTN","TIUSRV",74,0)
 . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUSRV",75,0)
 . D SET(START+1,19,$$MIXED^TIULS($G(TIUPROB(8925.9,TIUI,.05))))
"RTN","TIUSRV",76,0)
 . D SET(START+1,60,$G(TIUPROB(8925.9,TIUI,.02)))
"RTN","TIUSRV",77,0)
 . S START=START+1
"RTN","TIUSRV",78,0)
 S VALMCNT=START
"RTN","TIUSRV",79,0)
 Q
"RTN","TIUSRV",80,0)
EDIT(TIUDA) ; Edits
"RTN","TIUSRV",81,0)
 N TIUI,DR,DIC,DIQ,TIUCNT,TIUED,START,OFFSET S TIUI=0,START=VALMCNT+2
"RTN","TIUSRV",82,0)
 D BLANK(VALMCNT+1)
"RTN","TIUSRV",83,0)
 D SET(START,1," Edit Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",84,0)
 I '+$O(^TIU(8925.5,"B",+TIUDA,0)) D SET(START,22,"No edits since entry.")
"RTN","TIUSRV",85,0)
 F  S TIUI=$O(^TIU(8925.5,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",86,0)
 . S DA=TIUI,DR=".02:03",DIC="^TIU(8925.5,",DIQ="TIUED"
"RTN","TIUSRV",87,0)
 . D EN^DIQ1 Q:$D(TIUED)'>9!($G(TIUED(8925.5,TIUI,.02))']"")
"RTN","TIUSRV",88,0)
 . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUSRV",89,0)
 . S OFFSET=2
"RTN","TIUSRV",90,0)
 . D SET(START+1,OFFSET,"      Edit Date: "_$G(TIUED(8925.5,TIUI,.02)))
"RTN","TIUSRV",91,0)
 . S OFFSET=44
"RTN","TIUSRV",92,0)
 . D SET(START+1,OFFSET,"     Edited By: "_$G(TIUED(8925.5,TIUI,.03)))
"RTN","TIUSRV",93,0)
 . S START=START+1
"RTN","TIUSRV",94,0)
 S VALMCNT=START
"RTN","TIUSRV",95,0)
 Q
"RTN","TIUSRV",96,0)
SIGN(TIUREC) ; Signature
"RTN","TIUSRV",97,0)
 N OFFSET,START D BLANK(VALMCNT+1)
"RTN","TIUSRV",98,0)
 S OFFSET=2,START=VALMCNT+2
"RTN","TIUSRV",99,0)
 D SET(START,1," Signature Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",100,0)
 D SET(START+1,OFFSET,"    Signed Date: "_$G(TIUREC(8925,TIUDA,1501)))
"RTN","TIUSRV",101,0)
 D SET(START+3,OFFSET,"  Cosigned Date: "_$G(TIUREC(8925,TIUDA,1507)))
"RTN","TIUSRV",102,0)
 S OFFSET=40
"RTN","TIUSRV",103,0)
 D SET(START+1,OFFSET,"         Signed By: "_$G(TIUREC(8925,TIUDA,1502)))
"RTN","TIUSRV",104,0)
 D SET(START+2,OFFSET,"    Signature Mode: "_$G(TIUREC(8925,TIUDA,1505)))
"RTN","TIUSRV",105,0)
 D SET(START+3,OFFSET,"       Cosigned By: "_$G(TIUREC(8925,TIUDA,1508)))
"RTN","TIUSRV",106,0)
 D SET(START+4,OFFSET,"  Cosignature Mode: "_$G(TIUREC(8925,TIUDA,1511)))
"RTN","TIUSRV",107,0)
 S VALMCNT=START+4
"RTN","TIUSRV",108,0)
 Q
"RTN","TIUSRV",109,0)
XTRASIGN(TIUDA) ; Additional signers
"RTN","TIUSRV",110,0)
 N OFFSET,TIUI,DA,DR,DIC,DIQ,TIUCNT,TIUXTRA,START
"RTN","TIUSRV",111,0)
 S TIUI=0,START=VALMCNT+2
"RTN","TIUSRV",112,0)
 D BLANK(VALMCNT+1)
"RTN","TIUSRV",113,0)
 D SET(START,1," Receipt Acknowledged By ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",114,0)
 F  S TIUI=$O(^TIU(8925.7,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",115,0)
 . S DA=TIUI,DR=".03:.08",DIC="^TIU(8925.7,",DIQ="TIUXTRA"
"RTN","TIUSRV",116,0)
 . D EN^DIQ1 Q:$D(TIUXTRA)'>9
"RTN","TIUSRV",117,0)
 . S TIUCNT=+$G(TIUCNT)+1,OFFSET=2
"RTN","TIUSRV",118,0)
 . D SET(START+1,OFFSET,"    Signed Date: "_$G(TIUXTRA(8925.7,DA,.04)))
"RTN","TIUSRV",119,0)
 . S OFFSET=40
"RTN","TIUSRV",120,0)
 . D SET(START+1,OFFSET,"         Signed By: "_$G(TIUXTRA(8925.7,DA,.06)))
"RTN","TIUSRV",121,0)
 . D SET(START+2,2,"Expected Signer: "_$G(TIUXTRA(8925.7,DA,.03)))
"RTN","TIUSRV",122,0)
 . D SET(START+2,OFFSET,"    Signature Mode: "_$G(TIUXTRA(8925.7,DA,.08)))
"RTN","TIUSRV",123,0)
 . S (START,VALMCNT)=START+2
"RTN","TIUSRV",124,0)
 Q
"RTN","TIUSRV",125,0)
PRIVACY(TIUREC) ; Privacy Act
"RTN","TIUSRV",126,0)
 N OFFSET,START D BLANK(VALMCNT+1)
"RTN","TIUSRV",127,0)
 S OFFSET=2,START=VALMCNT+2
"RTN","TIUSRV",128,0)
 D SET(START,1," Privacy Act Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",129,0)
 D SET(START+1,OFFSET,"   Amended Date: "_$G(TIUREC(8925,TIUDA,1601)))
"RTN","TIUSRV",130,0)
 D SET(START+2,OFFSET,"   Deleted Date: "_$G(TIUREC(8925,TIUDA,1611)))
"RTN","TIUSRV",131,0)
 D SET(START+3,OFFSET,"         Reason: "_$G(TIUREC(8925,TIUDA,1612)))
"RTN","TIUSRV",132,0)
 S OFFSET=40
"RTN","TIUSRV",133,0)
 D SET(START+1,OFFSET,"        Amended By: "_$G(TIUREC(8925,TIUDA,1602)))
"RTN","TIUSRV",134,0)
 D SET(START+2,OFFSET,"        Deleted By: "_$G(TIUREC(8925,TIUDA,1610)))
"RTN","TIUSRV",135,0)
 S VALMCNT=START+3
"RTN","TIUSRV",136,0)
 Q
"RTN","TIUSRV",137,0)
BODY(TIUDA,TIUL) ; body of document
"RTN","TIUSRV",138,0)
 N CANSEE S CANSEE=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUSRV",139,0)
 S TIUL=+$G(TIUL)+1
"RTN","TIUSRV",140,0)
 D BLANK(TIUL) S TIUL=+$G(TIUL)+1
"RTN","TIUSRV",141,0)
 D SET(TIUL,1," Document Body ",$G(IORVON),$G(IORVOFF)) S TIUL=TIUL+1
"RTN","TIUSRV",142,0)
 D BLANK(TIUL)
"RTN","TIUSRV",143,0)
 I '+CANSEE D NOSEE(CANSEE,.TIUL) Q
"RTN","TIUSRV",144,0)
 ; D TEXT(TIUDA,.TIUL)
"RTN","TIUSRV",145,0)
 I '$D(TIUGDATA) S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIUSRV",146,0)
 D LOADREC^TIUBR1(TIUDA,.TIUL,TIUGDATA,$G(TIUGWHOL))
"RTN","TIUSRV",147,0)
 K ^TMP("TIU ADDENDUM",$J)
"RTN","TIUSRV",148,0)
 Q
"RTN","TIUSRV",149,0)
TEXT(TIUDA,TIUL) ; Get each component
"RTN","TIUSRV",150,0)
 ; 4/18/03 No longer called in TIU - now calls browse code
"RTN","TIUSRV",151,0)
 N TIUKID,TIUDADT,TIUI S TIUI=0
"RTN","TIUSRV",152,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",153,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRV",154,0)
 . S ^TMP("TIUAUDIT",$J,TIUL,0)=$G(^TIU(8925,+TIUDA,"TEXT",+TIUI,0))
"RTN","TIUSRV",155,0)
 I +$$ISADDNDM^TIULC1(+TIUDA) D  Q
"RTN","TIUSRV",156,0)
 . N TIULINE,TIUPARNT K ^TMP("TIU ADDENDUM",$J) S $P(TIULINE,"=",79)=""
"RTN","TIUSRV",157,0)
 . S ^TMP("TIU ADDENDUM",$J)=TIUDA
"RTN","TIUSRV",158,0)
 . D LOADSIG^TIUBR1(TIUDA,.TIUL)
"RTN","TIUSRV",159,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=""
"RTN","TIUSRV",160,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=TIULINE
"RTN","TIUSRV",161,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=""
"RTN","TIUSRV",162,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=" --- Original Document ---"
"RTN","TIUSRV",163,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=""
"RTN","TIUSRV",164,0)
 . S TIUPARNT=+$P(^TIU(8925,+TIUDA,0),U,6) D TEXT(TIUPARNT,.TIUL)
"RTN","TIUSRV",165,0)
 S TIUKID=0
"RTN","TIUSRV",166,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRV",167,0)
 . I +$$ISADDNDM^TIULC1(TIUKID)'>0 D TEXT(TIUKID,.TIUL)
"RTN","TIUSRV",168,0)
 I '$$ISCOMP(TIUDA) D LOADSIG^TIUBR1(TIUDA,.TIUL)
"RTN","TIUSRV",169,0)
 S TIUKID=0
"RTN","TIUSRV",170,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRV",171,0)
 . ; If acting on an addendum, don't show it again
"RTN","TIUSRV",172,0)
 . I +TIUKID=+$G(^TMP("TIU ADDENDUM",$J)) Q
"RTN","TIUSRV",173,0)
 . I +$$ISADDNDM^TIULC1(TIUKID) D LOADADD(TIUKID,.TIUL)
"RTN","TIUSRV",174,0)
 Q
"RTN","TIUSRV",175,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUSRV",176,0)
 N TIUY,TIUTYP
"RTN","TIUSRV",177,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUSRV",178,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUSRV",179,0)
 Q TIUY
"RTN","TIUSRV",180,0)
LOADADD(TIUDADD,TIUL) ; Load addenda
"RTN","TIUSRV",181,0)
 ; 4/18/03 No longer called in TIU - now calls browse code
"RTN","TIUSRV",182,0)
 N TIUDAUTH,TIUDATT,TIUJ,TIUSIG,TIUCSIG,CANSEE
"RTN","TIUSRV",183,0)
 S CANSEE=$$CANDO^TIULP(+TIUDADD,"VIEW")
"RTN","TIUSRV",184,0)
 S TIUJ=0,TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=" "
"RTN","TIUSRV",185,0)
 S TIUDADT=$$DATE^TIULS($P($G(^TIU(8925,+TIUDADD,13)),U),"MM/DD/YY")
"RTN","TIUSRV",186,0)
 S TIUL=TIUL+1,^TMP("TIUAUDIT",$J,TIUL,0)=TIUDADT_" ADDENDUM:"
"RTN","TIUSRV",187,0)
 I +CANSEE'>0 D  Q
"RTN","TIUSRV",188,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRV",189,0)
 . S ^TMP("TIUAUDIT",$J,TIUL,0)=$P(CANSEE,U,2)
"RTN","TIUSRV",190,0)
 F  S TIUJ=$O(^TIU(8925,+TIUDADD,"TEXT",TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUSRV",191,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRV",192,0)
 . S ^TMP("TIUAUDIT",$J,TIUL,0)=$G(^TIU(8925,+TIUDADD,"TEXT",TIUJ,0))
"RTN","TIUSRV",193,0)
 D LOADSIG^TIUBR1(TIUDADD,.TIUL)
"RTN","TIUSRV",194,0)
 Q
"RTN","TIUSRV",195,0)
NOSEE(CANSEE,TIUJ) ; When the user shouldn't see the data...
"RTN","TIUSRV",196,0)
 S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRV",197,0)
 D SET(TIUJ,2,$P(CANSEE,U,2))
"RTN","TIUSRV",198,0)
 Q
"RTN","TIUSRV",199,0)
SET(TIULINE,TIUCOL,TIUTEXT,ON,OFF) ; set display info in array
"RTN","TIUSRV",200,0)
 D:'$D(@VALMAR@(TIULINE,0)) BLANK(.TIULINE)
"RTN","TIUSRV",201,0)
 D SET^VALM10(.TIULINE,$$SETSTR^VALM1(.TIUTEXT,@VALMAR@(TIULINE,0),.TIUCOL,$L(TIUTEXT)))
"RTN","TIUSRV",202,0)
 D:$G(ON)]""!($G(OFF)]"") CNTRL^VALM10(.TIULINE,.TIUCOL,$L(TIUTEXT),$G(ON),$G(OFF))
"RTN","TIUSRV",203,0)
 W:'(TIULINE#5)&'+$G(HUSH) "."
"RTN","TIUSRV",204,0)
 Q
"RTN","TIUSRV",205,0)
 ;
"RTN","TIUSRV",206,0)
BLANK(TIULINE) ; blank line
"RTN","TIUSRV",207,0)
 D SET^VALM10(.TIULINE,$J("",80))
"RTN","TIUSRV",208,0)
 Q
"RTN","TIUSRVP")
0^30^B62427817
"RTN","TIUSRVP",1,0)
TIUSRVP ; SLC/JER - RPCs for CREATE & UPDATE ;4/18/03
"RTN","TIUSRVP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,7,19,28,47,89,104,100,115,109,167,113**;Jun 20, 1997
"RTN","TIUSRVP",3,0)
MAKE(SUCCESS,DFN,TITLE,VDT,VLOC,VSIT,TIUX,VSTR,SUPPRESS,NOASF) ; New Document
"RTN","TIUSRVP",4,0)
 N TIU,TIUDA,LDT,NEWREC S SUCCESS=0
"RTN","TIUSRVP",5,0)
 I +$G(VSIT) S VSTR=$$VSTRBLD(+VSIT)
"RTN","TIUSRVP",6,0)
 I $L($G(VSTR)) D
"RTN","TIUSRVP",7,0)
 . S VDT=$S(+$G(VDT):+$G(VDT),1:$P(VSTR,";",2)),LDT=$S(+$G(VDT):$$FMADD^XLFDT(VDT,"","",1),1:"")
"RTN","TIUSRVP",8,0)
 . S VLOC=$S(+$G(VLOC):+$G(VLOC),1:$P(VSTR,";"))
"RTN","TIUSRVP",9,0)
 . ; If the note is for a Ward Location, call MAIN^TIUMOVE
"RTN","TIUSRVP",10,0)
 . I $P($G(^SC(+VLOC,0)),U,3)="W" D MAIN^TIUMOVE(.TIU,DFN,"",VDT,LDT,1,"LAST",0,+VLOC) Q
"RTN","TIUSRVP",11,0)
 . ; Otherwise, call PATVADPT^TIULV
"RTN","TIUSRVP",12,0)
 . D PATVADPT^TIULV(.TIU,DFN,"",VSTR)
"RTN","TIUSRVP",13,0)
 I '+$G(VSIT),'$L($G(VSTR)),+$G(VDT),+$G(VLOC) D
"RTN","TIUSRVP",14,0)
 . S VDT=$G(VDT),LDT=$S(+$G(VDT):$$FMADD^XLFDT(VDT,"","",1),1:"")
"RTN","TIUSRVP",15,0)
 . ; If the note is for a Ward Location, call MAIN^TIUMOVE
"RTN","TIUSRVP",16,0)
 . I $P($G(^SC(+VLOC,0)),U,3)="W" D MAIN^TIUMOVE(.TIU,DFN,"",VDT,LDT,1,"LAST",0,+VLOC) Q
"RTN","TIUSRVP",17,0)
 . ; Otherwise, call MAIN^TIUVSIT
"RTN","TIUSRVP",18,0)
 . D MAIN^TIUVSIT(.TIU,DFN,"",VDT,LDT,"LAST",0,VLOC)
"RTN","TIUSRVP",19,0)
 I '+$G(TIU("VSTR")) D
"RTN","TIUSRVP",20,0)
 . D EVENT^TIUSRVP1(.TIU,DFN)
"RTN","TIUSRVP",21,0)
 S TIU("INST")=$$DIVISION^TIULC1(+TIU("LOC"))
"RTN","TIUSRVP",22,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,1:0) S SUCCESS="0^"_$$EZBLD^DIALOG(89250001) Q
"RTN","TIUSRVP",23,0)
 ; -- second, get/create TIU Document record --
"RTN","TIUSRVP",24,0)
 S TIUDA=$$GETREC(DFN,.TIU,TITLE,.NEWREC) I +TIUDA'>0 S SUCCESS="0^"_$$EZBLD^DIALOG(89250002) Q
"RTN","TIUSRVP",25,0)
 S SUCCESS=+TIUDA
"RTN","TIUSRVP",26,0)
 ; -- third, file data in TIU Document record --
"RTN","TIUSRVP",27,0)
 D STUFREC^TIUSRVP1(+TIUDA,.TIUX,DFN,,TITLE,.TIU)
"RTN","TIUSRVP",28,0)
 S:'+$G(NOASF) ^TIU(8925,"ASAVE",DUZ,TIUDA)=""
"RTN","TIUSRVP",29,0)
 K ^TIU(8925,+TIUDA,"TEMP") M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUSRVP",30,0)
 D SETXT0(TIUDA),FILE(.SUCCESS,+TIUDA,.TIUX,+$G(SUPPRESS))
"RTN","TIUSRVP",31,0)
 I +SUCCESS'>0 D DIK^TIURB2(TIUDA) Q
"RTN","TIUSRVP",32,0)
 I +$O(^TIU(8925,+TIUDA,"TEMP",0)) D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUSRVP",33,0)
 I +$G(TIU("STOP")) D DEFER^TIUVSIT(TIUDA,TIU("STOP")) I 1
"RTN","TIUSRVP",34,0)
 E  D QUE^TIUPXAP1
"RTN","TIUSRVP",35,0)
 I '+$G(SUPPRESS) D
"RTN","TIUSRVP",36,0)
 . D RELEASE^TIUT(TIUDA,1),UPDTIRT^TIUDIRT(.TIU,TIUDA)
"RTN","TIUSRVP",37,0)
 K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",38,0)
 Q
"RTN","TIUSRVP",39,0)
VSTRBLD(VSIT) ; Given a Visit Record, build Visit-Descriptor String
"RTN","TIUSRVP",40,0)
 N TIUY,VSIT0,VLOC,VDT,VSVCAT
"RTN","TIUSRVP",41,0)
 S VSIT0=$G(^AUPNVSIT(+VSIT,0)),VDT=+$P(VSIT0,U),VLOC=+$P(VSIT0,U,22)
"RTN","TIUSRVP",42,0)
 S VSVCAT=$P(VSIT0,U,7),TIUY=VLOC_";"_VDT_";"_VSVCAT
"RTN","TIUSRVP",43,0)
 Q TIUY
"RTN","TIUSRVP",44,0)
SETXT0(TIUDA) ; Set root node of "TEMP" WP-field
"RTN","TIUSRVP",45,0)
 N TIUC,TIUI S (TIUC,TIUI)=0
"RTN","TIUSRVP",46,0)
 F  S TIUI=$O(^TIU(8925,TIUDA,"TEMP",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVP",47,0)
 . S:$D(^TIU(8925,TIUDA,"TEMP",TIUI,0)) TIUC=TIUC+1
"RTN","TIUSRVP",48,0)
 S ^TIU(8925,TIUDA,"TEMP",0)="^^"_TIUC_U_TIUC_U_DT_"^^"
"RTN","TIUSRVP",49,0)
 Q
"RTN","TIUSRVP",50,0)
MAKEADD(TIUDADD,TIUDA,TIUX,SUPPRESS) ; Create addendum record
"RTN","TIUSRVP",51,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUCAN,TIUFPRIV,TIU S TIUFPRIV=1
"RTN","TIUSRVP",52,0)
 S TIUCAN=$$CANDO^TIULP(TIUDA,"MAKE ADDENDUM")
"RTN","TIUSRVP",53,0)
 I TIUCAN'>0 S TIUDADD="0^You may not MAKE AN ADDENDUM for this "_$$STATUS^TIULC(TIUDA)_" "_$$PNAME^TIULC1(+$G(^TIU(8925,+TIUDA,0))) Q
"RTN","TIUSRVP",54,0)
 S TIUATYP=+$$WHATITLE^TIUPUTU("ADDENDUM"),(DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUSRVP",55,0)
 D ^DIC S TIUDADD=+Y
"RTN","TIUSRVP",56,0)
 I +Y'>0 S TIUDADD=TIUDADD_"^Could not create addendum." Q
"RTN","TIUSRVP",57,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSRVP",58,0)
 S TIU("DOCTYP")=TIUATYP_U_$$PNAME^TIULC1(TIUATYP)
"RTN","TIUSRVP",59,0)
 D STUFREC^TIUSRVP1(+TIUDADD,.TIUX,DFN,+$G(TIUDA),TIUATYP,.TIU)
"RTN","TIUSRVP",60,0)
 K ^TIU(8925,+TIUDADD,"TEMP") M ^TIU(8925,+TIUDADD,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUSRVP",61,0)
 D SETXT0(+TIUDADD),FILE(.SUCCESS,+TIUDADD,.TIUX,+$G(SUPPRESS))
"RTN","TIUSRVP",62,0)
 I +SUCCESS'>0 D DIK^TIURB2(TIUDADD) Q
"RTN","TIUSRVP",63,0)
 I +$O(^TIU(8925,+TIUDADD,"TEMP",0)) D MERGTEXT^TIUEDI1(+TIUDADD,.TIU)
"RTN","TIUSRVP",64,0)
 I '+$G(SUPPRESS) D RELEASE^TIUT(+TIUDADD,1)
"RTN","TIUSRVP",65,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUSRVP",66,0)
 Q
"RTN","TIUSRVP",67,0)
UPDATE(SUCCESS,TIUDA,TIUX,SUPPRESS) ; Update existing TIU Document
"RTN","TIUSRVP",68,0)
 N TIU,TIUI,TIUC,TIUD0,TIUD12,TIUD15,TIUCPF,TITLE
"RTN","TIUSRVP",69,0)
 I $S(+$G(TIUDA)'>0:1,'$D(^TIU(8925,+TIUDA,0)):1,1:0) D  Q
"RTN","TIUSRVP",70,0)
 . S SUCCESS="0^ Cannot update a non-existent document..."
"RTN","TIUSRVP",71,0)
 I +$P($G(^TIU(8925,+TIUDA,0)),U,5)>6 D  Q
"RTN","TIUSRVP",72,0)
 . S SUCCESS="0^ TIU Document #"_TIUDA_" is already signed..."
"RTN","TIUSRVP",73,0)
 I $D(TIUX("TEXT")) D
"RTN","TIUSRVP",74,0)
 . K ^TIU(8925,+TIUDA,"TEMP") M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT")
"RTN","TIUSRVP",75,0)
 . S (TIUC,TIUI)=0
"RTN","TIUSRVP",76,0)
 . F  S TIUI=$O(^TIU(8925,+TIUDA,"TEMP",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVP",77,0)
 . . S TIUC=TIUC+1
"RTN","TIUSRVP",78,0)
 . I +TIUC>0 S ^TIU(8925,+TIUDA,"TEMP",0)="^^"_TIUC_U_TIUC_U_DT_"^^"
"RTN","TIUSRVP",79,0)
 . K TIUX("TEXT")
"RTN","TIUSRVP",80,0)
 I +$O(TIUX(""))'>0 S:+$G(SUPPRESS) SUCCESS=+TIUDA Q
"RTN","TIUSRVP",81,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD12=$G(^(12)),TITLE=+TIUD0
"RTN","TIUSRVP",82,0)
 ;Set a flag to indicate whether or not a Title is a member of the
"RTN","TIUSRVP",83,0)
 ;Clinical Procedures Class (1=Yes and 0=No)
"RTN","TIUSRVP",84,0)
 S TIUCPF=+$$ISA^TIULX(TITLE,+$$CLASS^TIUCP)
"RTN","TIUSRVP",85,0)
 D SETCOS(TIUDA,.TIUX,TIUD0,TIUD12)
"RTN","TIUSRVP",86,0)
 ; Title changed? Refile DC
"RTN","TIUSRVP",87,0)
 I +$G(TIUX(.01))>0,(+$G(TIUX(.01))'=+TIUD0) D
"RTN","TIUSRVP",88,0)
 . S TIUX(.04)=$$DOCCLASS^TIULC1(+$G(TIUX(.01)))
"RTN","TIUSRVP",89,0)
 D FILE(.SUCCESS,+TIUDA,.TIUX,+$G(SUPPRESS),TIUCPF)
"RTN","TIUSRVP",90,0)
 I +SUCCESS'>0 K ^TIU(8925,+TIUDA,"TEMP") Q
"RTN","TIUSRVP",91,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSRVP",92,0)
 I $D(^TIU(8925,+TIUDA,"TEMP")) D
"RTN","TIUSRVP",93,0)
 . K ^TIU(8925,+TIUDA,"TEXT")
"RTN","TIUSRVP",94,0)
 . D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUSRVP",95,0)
 . K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",96,0)
 . S:'+$G(SUCCESS) SUCCESS=+TIUDA
"RTN","TIUSRVP",97,0)
 ; If document is signed re-file /ES/
"RTN","TIUSRVP",98,0)
 S TIUD15=$G(^TIU(8925,+TIUDA,15))
"RTN","TIUSRVP",99,0)
 I +TIUD15 D
"RTN","TIUSRVP",100,0)
 . N TIUBY,DR,DIE,DA,X,Y S TIUBY=$P(TIUD15,U,2) Q:+TIUBY'>0
"RTN","TIUSRVP",101,0)
 . S DR="1503///^S X=$$SIGNAME^TIULS("_TIUBY_");1504///^S X=$$SIGTITL^TIULS("_TIUBY_")"
"RTN","TIUSRVP",102,0)
 . S DA=TIUDA,DIE=8925 D ^DIE
"RTN","TIUSRVP",103,0)
 ; Evaluate/send alerts
"RTN","TIUSRVP",104,0)
 I '+$G(SUPPRESS) D
"RTN","TIUSRVP",105,0)
 . I +$P(TIUD0,U,5)<5,'$D(TIUX(.05)) D UPDSTAT(TIUDA,+$G(TIUD0))
"RTN","TIUSRVP",106,0)
 . D SEND^TIUALRT(TIUDA),SENDID^TIUALRT1(TIUDA):+$G(^TIU(8925,+TIUDA,21))
"RTN","TIUSRVP",107,0)
 . D UPDTIRT^TIUDIRT(.TIU,TIUDA)
"RTN","TIUSRVP",108,0)
 Q
"RTN","TIUSRVP",109,0)
SETCOS(TIUDA,TIUX,TIUD0,TIUD12) ; Evaluate/set cosig req
"RTN","TIUSRVP",110,0)
 N TIUDAD,TIUEXS,TIUNCS,TIUEXCS,TIURCS,TIUATT,TIUTTL,TIUDAD0
"RTN","TIUSRVP",111,0)
 S TIUEXS=$S(+$G(TIUX(1202)):+$G(TIUX(1202)),1:$P(TIUD12,U,4))
"RTN","TIUSRVP",112,0)
 S TIUNCS=$S(+$G(TIUX(1208)):+$G(TIUX(1208)),+$G(TIUX(1209)):+$G(TIUX(1209)),1:0)
"RTN","TIUSRVP",113,0)
 I TIUNCS S TIUX(1506)=$S(TIUNCS=TIUEXS:0,1:1) G SETCOSX
"RTN","TIUSRVP",114,0)
 S TIUEXCS=$P(TIUD12,U,8),TIUATT=$P(TIUD12,U,9)
"RTN","TIUSRVP",115,0)
 S TIUDAD=+$P(TIUD0,U,6),TIUDAD0=$G(^TIU(8925,+TIUDAD,0))
"RTN","TIUSRVP",116,0)
 I +$$ISDS^TIULX($S(+TIUDAD:+TIUDAD0,1:+TIUD0)) D  G SETCOSX
"RTN","TIUSRVP",117,0)
 . S TIUX(1506)=$S(TIUEXS=TIUEXCS:0,1:1)
"RTN","TIUSRVP",118,0)
 S TIUTTL=$S(+$G(TIUX(.01)):+$G(TIUX(.01)),1:+TIUD0)
"RTN","TIUSRVP",119,0)
 S TIUX(1506)=+$$REQCOSIG^TIULP(TIUTTL,TIUDA,TIUEXS)
"RTN","TIUSRVP",120,0)
SETCOSX S:'TIUX(1506) TIUX(1208)="@"
"RTN","TIUSRVP",121,0)
 Q
"RTN","TIUSRVP",122,0)
UPDSTAT(DA,TITLE) ; Update the status on commitment
"RTN","TIUSRVP",123,0)
 N DR,DIE S DR=".05////"_$$STATUS^TIUSRVP1(DA,0,TITLE)
"RTN","TIUSRVP",124,0)
 I '+$P($G(^TIU(8925,DA,13)),U,4) S DR=DR_";1304////^S X=$$NOW^XLFDT"
"RTN","TIUSRVP",125,0)
 S DIE=8925 D ^DIE
"RTN","TIUSRVP",126,0)
 Q
"RTN","TIUSRVP",127,0)
GETREC(DFN,TIU,TITLE,TIUNEW) ; Get or create document record
"RTN","TIUSRVP",128,0)
 N DA,DIC,DIE,DLAYGO,DR,X,Y,TIUDPRM,TIUFPRIV,TIUHIT,TIUSCAT
"RTN","TIUSRVP",129,0)
 S (TIUHIT,DA)=0,TIUFPRIV=1,(DIC,DLAYGO)=8925,DIC(0)="FL"
"RTN","TIUSRVP",130,0)
 ; S DIC("S")="I +$G(DFN)=+$P(^TIU(8925,+Y,0),U,2),(+$G(TIU(""VISIT""))=+$P(^TIU(8925,+Y,0),U,3))"
"RTN","TIUSRVP",131,0)
 S X=""""_"`"_+TITLE_"""" D ^DIC K DIC("S")
"RTN","TIUSRVP",132,0)
 I +Y'>0 Q Y_U_" Insufficient data to create a new record."
"RTN","TIUSRVP",133,0)
 S DA=+Y,TIUNEW=+$P(Y,U,3) N DIE,DR,TIUVISIT S DIE=8925
"RTN","TIUSRVP",134,0)
 S TIUVISIT=$S(+$G(TIU("VISIT")):+$G(TIU("VISIT")),1:"")
"RTN","TIUSRVP",135,0)
 S TIUSCAT=$S(+$L($P($G(TIU("CAT")),U)):$P($G(TIU("CAT")),U),+$L($P($G(TIU("VSTR")),";",3)):$P($G(TIU("VSTR")),";",3),1:"")
"RTN","TIUSRVP",136,0)
 S DR=".04////"_$$DOCCLASS^TIULC1(+$P(Y,U,2))_";.13////"_TIUSCAT_";1205////"_$P($G(TIU("LOC")),U)_";1211////"_$P($G(TIU("VLOC")),U)_";1212////"_$P($G(TIU("INST")),U)
"RTN","TIUSRVP",137,0)
 D ^DIE
"RTN","TIUSRVP",138,0)
 Q +$G(DA)
"RTN","TIUSRVP",139,0)
FILE(SUCCESS,TIUDA,TIUX,SUPPRESS,TIUCPF) ; Call FM Filer & commit updates
"RTN","TIUSRVP",140,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIUCMMTX
"RTN","TIUSRVP",141,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS=""
"RTN","TIUSRVP",142,0)
 I +$G(TIUX(1202)) S TIUX(1204)=+$G(TIUX(1202))
"RTN","TIUSRVP",143,0)
 I +$G(TIUX(1209)) S TIUX(1208)=+$G(TIUX(1209))
"RTN","TIUSRVP",144,0)
 ;If the document is a member of the Clinical Procedures Class, set the
"RTN","TIUSRVP",145,0)
 ;Entered By field to the Author/Dictator field
"RTN","TIUSRVP",146,0)
 I $G(TIUCPF),+$G(TIUX(1202)) S TIUX(1302)=+$G(TIUX(1202))
"RTN","TIUSRVP",147,0)
 M @FDARR=TIUX
"RTN","TIUSRVP",148,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUSRVP",149,0)
 I $D(TIUMSG)>9 S SUCCESS=0_U_$G(TIUMSG("DIERR",1,"TEXT",1)) Q
"RTN","TIUSRVP",150,0)
 S SUCCESS=TIUDA
"RTN","TIUSRVP",151,0)
 I '+$G(SUPPRESS) D
"RTN","TIUSRVP",152,0)
 . N DA
"RTN","TIUSRVP",153,0)
 . S DA=TIUDA
"RTN","TIUSRVP",154,0)
 . S TIUCMMTX=$$COMMIT^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUSRVP",155,0)
 . I TIUCMMTX]"" X TIUCMMTX
"RTN","TIUSRVP",156,0)
 . K ^TIU(8925,"ASAVE",DUZ,TIUDA)
"RTN","TIUSRVP",157,0)
 Q
"RTN","TIUSRVP",158,0)
SIGN(ERR,TIUDA,TIUX) ; API for /es/
"RTN","TIUSRVP",159,0)
 N X,TIUACT,TIUSIGN,TIUD0,TIUD12,TIUSTAT,SIGNER,COSIGNER,VALID,XTRASGNR
"RTN","TIUSRVP",160,0)
 N TIUES S ERR=0
"RTN","TIUSRVP",161,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIUSRVP",162,0)
 S SIGNER=$P(TIUD12,U,4),COSIGNER=$P(TIUD12,U,8)
"RTN","TIUSRVP",163,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIUSRVP",164,0)
 S TIUSTAT=+$P(TIUD0,U,5)
"RTN","TIUSRVP",165,0)
 S TIUACT=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIUSRVP",166,0)
 S TIUSIGN=$$CANDO^TIULP(TIUDA,TIUACT)
"RTN","TIUSRVP",167,0)
 I +TIUSIGN'>0 S ERR="89250004^"_$P(TIUSIGN,U,2) Q
"RTN","TIUSRVP",168,0)
 S VALID=$$VALIDATE($$DECRYP^XUSRB1(TIUX))
"RTN","TIUSRVP",169,0)
 I +VALID'>0 S ERR="89250005^"_$$EZBLD^DIALOG(89250005) Q
"RTN","TIUSRVP",170,0)
 S TIUES=1_U_$P($G(^VA(200,+DUZ,20)),U,2,3)
"RTN","TIUSRVP",171,0)
 I '+$G(XTRASGNR) D ES^TIURS(TIUDA,TIUES)
"RTN","TIUSRVP",172,0)
 I +$G(XTRASGNR) D ADDSIG^TIURS1(TIUDA,XTRASGNR)
"RTN","TIUSRVP",173,0)
 I +$G(^TIU(8925,TIUDA,21)),(TIUACT="SIGNATURE") D AUDLINK^TIUGR1(TIUDA,"a",+$G(^(21)))
"RTN","TIUSRVP",174,0)
 Q
"RTN","TIUSRVP",175,0)
VALIDATE(X) ; Validate /es/-code
"RTN","TIUSRVP",176,0)
 N TIUY S TIUY=0
"RTN","TIUSRVP",177,0)
 D HASH^XUSHSHP I X]"",(X=$P($G(^VA(200,+DUZ,20)),U,4)) S TIUY=1
"RTN","TIUSRVP",178,0)
 Q TIUY
"RTN","TIUSRVP",179,0)
DELETE(ERR,TIUDA,TIURSN) ; API for record deletion
"RTN","TIUSRVP",180,0)
 N TIUDEL,TIUD0 S ERR=0,TIUDEL=$$CANDO^TIULP(TIUDA,"DELETE RECORD")
"RTN","TIUSRVP",181,0)
 I TIUDEL'>0 S ERR="89250003^"_$$EZBLD^DIALOG(89250003) Q
"RTN","TIUSRVP",182,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0))
"RTN","TIUSRVP",183,0)
 I +$P(TIUD0,U,5)'<6 D  Q
"RTN","TIUSRVP",184,0)
 . S TIURSN=$G(TIURSN,"A")
"RTN","TIUSRVP",185,0)
 . D DELTEXT^TIURB2(TIUDA,TIURSN)
"RTN","TIUSRVP",186,0)
 D DIK^TIURB2(TIUDA),DELAUDIT^TIUEDI1(TIUDA)
"RTN","TIUSRVP",187,0)
 Q
"RTN","TIUSRVP",188,0)
LOCK(ERR,TIUDA) ; Bid for lock on a TIU Document record
"RTN","TIUSRVP",189,0)
 L +^TIU(8925,+TIUDA):1 I  S ERR=0
"RTN","TIUSRVP",190,0)
 E  S ERR="1^ Another session has this record locked."
"RTN","TIUSRVP",191,0)
 Q
"RTN","TIUSRVP",192,0)
UNLOCK(ERR,TIUDA) ; Decrement Lock on a TIU Document record
"RTN","TIUSRVP",193,0)
 L -^TIU(8925,+TIUDA) S ERR=0
"RTN","TIUSRVP",194,0)
 Q
"RTN","TIUSRVP1")
0^31^B34664018
"RTN","TIUSRVP1",1,0)
TIUSRVP1 ; SLC/JER - More API's in support of PUT ;4/18/03
"RTN","TIUSRVP1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,59,89,100,109,167,113**;Jun 20, 1997
"RTN","TIUSRVP1",3,0)
SITEPARM(TIUY) ; Get site parameters for GUI
"RTN","TIUSRVP1",4,0)
 N TIUPRM0,TIUPRM1
"RTN","TIUSRVP1",5,0)
 D SETPARM^TIULE
"RTN","TIUSRVP1",6,0)
 S TIUY=TIUPRM0
"RTN","TIUSRVP1",7,0)
 Q
"RTN","TIUSRVP1",8,0)
DEFDOC(TIUY,HLOC,USER,TIUDT,TIUIEN) ; Get default primary provider
"RTN","TIUSRVP1",9,0)
 N TIUSPRM,TIUDDOC,TIUAUTH
"RTN","TIUSRVP1",10,0)
 D SITEPARM(.TIUSPRM)
"RTN","TIUSRVP1",11,0)
 S TIUDDOC=+$P(TIUSPRM,U,8)
"RTN","TIUSRVP1",12,0)
 S TIUAUTH=$S((+$G(USER)!('+$G(TIUIEN))):0,1:+$P($G(^TIU(8925,+$G(TIUIEN),12)),U,2))
"RTN","TIUSRVP1",13,0)
 S USER=$S(+$G(USER):+$G(USER),+$G(TIUAUTH):+$G(TIUAUTH),1:DUZ)
"RTN","TIUSRVP1",14,0)
 S TIUDT=$S(+$G(TIUDT):+$G(TIUDT),1:DT)
"RTN","TIUSRVP1",15,0)
 S TIUY=$S(TIUDDOC=1:$$DFLTDOC^TIUPXAPI(HLOC),TIUDDOC=2:$$CURDOC(USER),1:"0^")
"RTN","TIUSRVP1",16,0)
 Q
"RTN","TIUSRVP1",17,0)
CURDOC(USER,TIUDT) ; Is the current user a known Provider?
"RTN","TIUSRVP1",18,0)
 N TIUY,TIUPROV S TIUY="0^"
"RTN","TIUSRVP1",19,0)
 S USER=$S(+$G(USER):+$G(USER),1:DUZ)
"RTN","TIUSRVP1",20,0)
 S TIUDT=$S(+$G(TIUDT):+$G(TIUDT),1:DT)
"RTN","TIUSRVP1",21,0)
 S TIUPROV=$$PROVIDER^TIUPXAP1(USER,TIUDT)
"RTN","TIUSRVP1",22,0)
 I +TIUPROV S TIUY=USER_U_$$PERSNAME^TIULC1(USER)
"RTN","TIUSRVP1",23,0)
 Q TIUY
"RTN","TIUSRVP1",24,0)
ISAPROV(TIUY,USER,DATE) ; Is user a provider?
"RTN","TIUSRVP1",25,0)
 S USER=$G(USER,DUZ)
"RTN","TIUSRVP1",26,0)
 S DATE=$G(DATE,DT)
"RTN","TIUSRVP1",27,0)
 S TIUY=$$PROVIDER^TIUPXAP1(USER,DATE)
"RTN","TIUSRVP1",28,0)
 Q
"RTN","TIUSRVP1",29,0)
DOCPARM(TIUY,TIUDA,TIUTYP) ; Get document parameters for GUI
"RTN","TIUSRVP1",30,0)
 I '+$G(TIUTYP),+$G(TIUDA) S TIUTYP=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIUSRVP1",31,0)
 I '+$G(TIUTYP) S TIUY(0)="" Q
"RTN","TIUSRVP1",32,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUY,$G(TIUDA))
"RTN","TIUSRVP1",33,0)
 I '$D(TIUY) S TIUY(0)=""
"RTN","TIUSRVP1",34,0)
 Q
"RTN","TIUSRVP1",35,0)
CONSTUB(TIUDA,GMRCVP,DFN) ; Create a stub for a Consult Report
"RTN","TIUSRVP1",36,0)
 N DIE,DR,DA
"RTN","TIUSRVP1",37,0)
 D STUB(.TIUDA,"CONSULT REPORT",DFN)
"RTN","TIUSRVP1",38,0)
 I +TIUDA'>0 Q
"RTN","TIUSRVP1",39,0)
 S DIE=8925,DA=+TIUDA,DR="1405////^S X=GMRCVP"
"RTN","TIUSRVP1",40,0)
 D ^DIE
"RTN","TIUSRVP1",41,0)
 Q
"RTN","TIUSRVP1",42,0)
STUB(TIUDA,TIUTITL,DFN) ; Create a stub
"RTN","TIUSRVP1",43,0)
 N TIUVSIT,TIUFPRIV,DIC,DIE,DR,DA,DLAYGO,X,Y S TIUFPRIV=1
"RTN","TIUSRVP1",44,0)
 I +$G(TIUTITL)'>0 S TIUTITL=$$WHATITLE^TIUPUTU(TIUTITL)
"RTN","TIUSRVP1",45,0)
 I +TIUTITL'>0 S TIUDA=-1 Q
"RTN","TIUSRVP1",46,0)
 S (DIC,DLAYGO)=8925,DIC(0)="LF"
"RTN","TIUSRVP1",47,0)
 S X=""""_"`"_+TIUTITL_""""
"RTN","TIUSRVP1",48,0)
 D ^DIC S TIUDA=+Y Q:+Y'>0
"RTN","TIUSRVP1",49,0)
 D EVENT(.TIU,DFN) I $L($G(TIU("VSTR")))'>0 S TIUDA=-1 Q
"RTN","TIUSRVP1",50,0)
 S DIE=DIC,DA=TIUDA
"RTN","TIUSRVP1",51,0)
 S DR=".02////"_+DFN_";.03////"_$P($G(TIU("VISIT")),U)_";.04////"_+$$DOCCLASS^TIULC1(TIUTITL)_";.05///UNDICTATED;.13////E;1301////"_+$$NOW^XLFDT
"RTN","TIUSRVP1",52,0)
 D ^DIE
"RTN","TIUSRVP1",53,0)
 Q
"RTN","TIUSRVP1",54,0)
EVENT(TIUY,DFN) ; Create an Event-type Visit Entry
"RTN","TIUSRVP1",55,0)
 N VDT,VSTR,DGPM
"RTN","TIUSRVP1",56,0)
 S DGPM=$G(^DPT(DFN,.105))
"RTN","TIUSRVP1",57,0)
 I +DGPM'>0 D
"RTN","TIUSRVP1",58,0)
 . S VDT=$$NOW^XLFDT
"RTN","TIUSRVP1",59,0)
 . S VSTR=";"_VDT_";"_"E"
"RTN","TIUSRVP1",60,0)
 D PATVADPT^TIULV(.TIUY,+DFN,DGPM,$G(VSTR))
"RTN","TIUSRVP1",61,0)
 I $G(TIUY("LOC"))="",+DUZ D
"RTN","TIUSRVP1",62,0)
 .N TIUPREF,IDX
"RTN","TIUSRVP1",63,0)
 .S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUSRVP1",64,0)
 .S IDX=+$P(TIUPREF,U,2)
"RTN","TIUSRVP1",65,0)
 .I IDX S TIUY("LOC")=IDX_U_$P($G(^SC(IDX,0)),U,1)
"RTN","TIUSRVP1",66,0)
 Q
"RTN","TIUSRVP1",67,0)
GETPNAME(TIUY,TIUTYPE) ; Get Print Name of a Document
"RTN","TIUSRVP1",68,0)
 S TIUY=$$PNAME^TIULC1(TIUTYPE)
"RTN","TIUSRVP1",69,0)
 Q
"RTN","TIUSRVP1",70,0)
SAVED(TIUY,TIUDA) ; Was the document committed to the database?
"RTN","TIUSRVP1",71,0)
 N TIUD12,TIUD13,TIUEBY,TIUAUT,TIUECS S TIUY=1
"RTN","TIUSRVP1",72,0)
 S TIUD12=$G(^TIU(8925,TIUDA,12)),TIUD13=$G(^(13))
"RTN","TIUSRVP1",73,0)
 S TIUEBY=$P(TIUD13,U,2),TIUAUT=$P(TIUD12,U,2),TIUECS=$P(TIUD12,U,8)
"RTN","TIUSRVP1",74,0)
 I $D(^TIU(8925,"ASAVE",+DUZ,TIUDA)) D  Q
"RTN","TIUSRVP1",75,0)
 . S TIUY="0^You appear to have been disconnected..."
"RTN","TIUSRVP1",76,0)
 I DUZ'=TIUEBY,(TIUEBY'=TIUAUT),$D(^TIU(8925,"ASAVE",+TIUEBY,TIUDA)) D  Q
"RTN","TIUSRVP1",77,0)
 . S TIUY="0^The transcriber appears to have been disconnected..."
"RTN","TIUSRVP1",78,0)
 I DUZ'=TIUAUT,$D(^TIU(8925,"ASAVE",+TIUAUT,TIUDA)) D  Q
"RTN","TIUSRVP1",79,0)
 . S TIUY="0^The author appears to have been disconnected..."
"RTN","TIUSRVP1",80,0)
 I DUZ'=TIUECS,$D(^TIU(8925,"ASAVE",+TIUECS,TIUDA)) D  Q
"RTN","TIUSRVP1",81,0)
 . S TIUY="0^The expected cosigner appears to have been disconnected..."
"RTN","TIUSRVP1",82,0)
 Q
"RTN","TIUSRVP1",83,0)
STUFREC(TIUDA,TIUREC,DFN,PARENT,TITLE,TIU) ; load TIUREC for create
"RTN","TIUSRVP1",84,0)
 N TIUREQCS,TIUSCAT,TIUSTAT,TIUCPF
"RTN","TIUSRVP1",85,0)
 ;Set a flag to indicate whether or not a Title is a member of the
"RTN","TIUSRVP1",86,0)
 ;Clinical Procedures Class (1=Yes and 0=No)
"RTN","TIUSRVP1",87,0)
 S TIUCPF=+$$ISA^TIULX(TITLE,+$$CLASS^TIUCP)
"RTN","TIUSRVP1",88,0)
 S TIUSTAT=$$STATUS(TIUDA,+$G(SUPPRESS),$G(TITLE))
"RTN","TIUSRVP1",89,0)
 D REQCOS^TIUSRVA(.TIUREQCS,+TITLE,"",$S(+$G(TIUREC(1202)):+$G(TIUREC(1202)),1:DUZ))
"RTN","TIUSRVP1",90,0)
 I +$G(PARENT)'>0 D
"RTN","TIUSRVP1",91,0)
 . S TIUREC(.02)=$G(DFN),TIUREC(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUSRVP1",92,0)
 . S TIUREC(.05)=$S(+$G(TIUREC(.05)):+$G(TIUREC(.05)),+TIUSTAT:TIUSTAT,1:5)
"RTN","TIUSRVP1",93,0)
 . S TIUREC(.07)=$P($G(TIU("EDT")),U),TIUREC(.08)=$P($G(TIU("LDT")),U)
"RTN","TIUSRVP1",94,0)
 . S TIUREC(1401)=$P($G(TIU("AD#")),U)
"RTN","TIUSRVP1",95,0)
 . S TIUREC(1402)=$P($G(TIU("TS")),U)
"RTN","TIUSRVP1",96,0)
 . S TIUREC(1404)=$P($G(TIU("SVC")),U)
"RTN","TIUSRVP1",97,0)
 I +$G(PARENT)>0 D
"RTN","TIUSRVP1",98,0)
 . S TIUREC(.02)=+$P($G(^TIU(8925,+PARENT,0)),U,2)
"RTN","TIUSRVP1",99,0)
 . S TIUREC(.03)=+$P($G(^TIU(8925,+PARENT,0)),U,3)
"RTN","TIUSRVP1",100,0)
 . S TIUREC(.05)=$S(+$G(TIUREC(.05)):+$G(TIUREC(.05)),+TIUSTAT:TIUSTAT,1:5)
"RTN","TIUSRVP1",101,0)
 . S TIUREC(.06)=PARENT,TIUREC(.07)=$P(TIU("EDT"),U)
"RTN","TIUSRVP1",102,0)
 . S TIUREC(.08)=$P(TIU("LDT"),U)
"RTN","TIUSRVP1",103,0)
 . S TIUREC(1401)=$P($G(^TIU(8925,+PARENT,14)),U)
"RTN","TIUSRVP1",104,0)
 . S TIUREC(1402)=$P($G(^TIU(8925,+PARENT,14)),U,2)
"RTN","TIUSRVP1",105,0)
 . S TIUREC(1404)=$P($G(^TIU(8925,+PARENT,14)),U,4)
"RTN","TIUSRVP1",106,0)
 S TIUREC(.04)=$$DOCCLASS^TIULC1(TITLE)
"RTN","TIUSRVP1",107,0)
 S TIUSCAT=$S(+$L($P($G(TIU("CAT")),U)):$P($G(TIU("CAT")),U),+$L($P($G(TIU("VSTR")),";",3)):$P($G(TIU("VSTR")),";",3),1:"")
"RTN","TIUSRVP1",108,0)
 S TIUREC(.13)=TIUSCAT
"RTN","TIUSRVP1",109,0)
 ;If the document is a member of the Clinical Procedures Class, set the
"RTN","TIUSRVP1",110,0)
 ;Author/Dictator and the Expected Signer fields to Null
"RTN","TIUSRVP1",111,0)
 S (TIUREC(1202),TIUREC(1204))=$S(+$G(TIUREC(1202)):+$G(TIUREC(1202)),TIUCPF:"",1:+$G(DUZ))
"RTN","TIUSRVP1",112,0)
 S TIUREC(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUSRVP1",113,0)
 S TIUREC(1212)=$P($G(TIU("INST")),U)
"RTN","TIUSRVP1",114,0)
 S TIUREC(1211)=$P($G(TIU("VLOC")),U)
"RTN","TIUSRVP1",115,0)
 S TIUREC(1201)=$$NOW^XLFDT
"RTN","TIUSRVP1",116,0)
 S TIUREC(1301)=$S($G(TIUREC(1301))]"":$P(TIUREC(1301),U),1:$$NOW^XLFDT)
"RTN","TIUSRVP1",117,0)
 I +$$ISDS^TIULX(TITLE) D
"RTN","TIUSRVP1",118,0)
 . I +$G(TIU("LDT"))'>0 S TIUREC(.12)=1
"RTN","TIUSRVP1",119,0)
 . S TIUREC(.13)="H"
"RTN","TIUSRVP1",120,0)
 . D REFDT(.TIUREC)
"RTN","TIUSRVP1",121,0)
 ;If the document is a member of the Clinical Procedures Class, set the
"RTN","TIUSRVP1",122,0)
 ;Entered By field to Null
"RTN","TIUSRVP1",123,0)
 S TIUREC(1303)="R",TIUREC(1302)=$S(TIUCPF:"",1:$G(DUZ))
"RTN","TIUSRVP1",124,0)
 I $S(+$G(TIUREC(1208)):1,+$G(TIUREQCS):1,1:0) S TIUREC(1506)=1
"RTN","TIUSRVP1",125,0)
 Q
"RTN","TIUSRVP1",126,0)
REFDT(TIUX) ; Hack Ref Date/time for DS's
"RTN","TIUSRVP1",127,0)
 S TIUX(1301)=$S(+$G(TIU("LDT")):+$G(TIU("LDT")),1:$G(TIUX(1301)))
"RTN","TIUSRVP1",128,0)
 Q
"RTN","TIUSRVP1",129,0)
STATUS(TIUDA,SUPPRESS,TITLE) ; Compute the status of the current record
"RTN","TIUSRVP1",130,0)
 N TIUDPRM,TIUY
"RTN","TIUSRVP1",131,0)
 ; If the document is an addendum, compute status based on processing
"RTN","TIUSRVP1",132,0)
 ; requirements of the Parent document or its ancestors
"RTN","TIUSRVP1",133,0)
 I +$$ISADDNDM^TIULC1(TIUDA) D
"RTN","TIUSRVP1",134,0)
 . S TIUDA=$S(+$P(^TIU(8925,TIUDA,0),U,6):$P(^(0),U,6),1:TIUDA)
"RTN","TIUSRVP1",135,0)
 . S TITLE=+$G(^TIU(8925,TIUDA,0))
"RTN","TIUSRVP1",136,0)
 D DOCPRM^TIULC1(TITLE,.TIUDPRM,$G(TIUDA))
"RTN","TIUSRVP1",137,0)
 I +$P(TIUDPRM(0),U,2),+$G(SUPPRESS) S TIUY=3 G STATUX
"RTN","TIUSRVP1",138,0)
 S TIUY=$S(+$$REQVER^TIULC(+TIUDA,+$P($G(TIUDPRM(0)),U,3)):4,1:5)
"RTN","TIUSRVP1",139,0)
STATUX Q TIUY
"RTN","TIUSRVP1",140,0)
IDATTCH(TIUY,TIUDA,TIUDAD) ; Attach TIUDA as ID Child entry to TIUDAD
"RTN","TIUSRVP1",141,0)
 N TIUX
"RTN","TIUSRVP1",142,0)
 S TIUX(2101)=TIUDAD
"RTN","TIUSRVP1",143,0)
 D FILE^TIUSRVP(.TIUY,TIUDA,.TIUX,1)
"RTN","TIUSRVP1",144,0)
 D AUDLINK^TIUGR1(TIUDA,"a",TIUDAD)
"RTN","TIUSRVP1",145,0)
 D SENDID^TIUALRT1(TIUDA)
"RTN","TIUSRVP1",146,0)
 Q
"RTN","TIUSRVP1",147,0)
IDDTCH(TIUY,TIUDA) ; Detach TIUDA from its ID Parent
"RTN","TIUSRVP1",148,0)
 N TIUX,IDDAD
"RTN","TIUSRVP1",149,0)
 I '+$G(^TIU(8925,TIUDA,21)) D  Q
"RTN","TIUSRVP1",150,0)
 . S TIUY="0^Record #"_TIUDA_" is NOT an ID Entry."
"RTN","TIUSRVP1",151,0)
 S IDDAD=+$G(^TIU(8925,TIUDA,21))
"RTN","TIUSRVP1",152,0)
 S TIUX(2101)="@"
"RTN","TIUSRVP1",153,0)
 D FILE^TIUSRVP(.TIUY,TIUDA,.TIUX,1)
"RTN","TIUSRVP1",154,0)
 D AUDLINK^TIUGR1(TIUDA,"d",IDDAD)
"RTN","TIUSRVP1",155,0)
 D IDDEL^TIUALRT1(TIUDA)
"RTN","TIUSRVP1",156,0)
 Q
"RTN","TIUTHLP")
0^32^B8070243
"RTN","TIUTHLP",1,0)
TIUTHLP ; SLC/JER - Help for Transcription ;4/18/03
"RTN","TIUTHLP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**21,113**;Jun 20, 1997
"RTN","TIUTHLP",3,0)
MAIN ; Control branching
"RTN","TIUTHLP",4,0)
 N DIC,DTOUT,DUOUT,X,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUTHLP",5,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUTHLP",6,0)
 S DIC=8925.1,DIC(0)="AEMQZ",DIC("A")="Select DOCUMENT DEFINITION: "
"RTN","TIUTHLP",7,0)
 S DIC("B")=$G(^DISV(+DUZ,"^TIU(8925.1,"))
"RTN","TIUTHLP",8,0)
 D ^DIC I $D(DTOUT) W "   Timed out..." Q
"RTN","TIUTHLP",9,0)
 I +Y'>0 D  Q
"RTN","TIUTHLP",10,0)
 . I $D(DUOUT) Q
"RTN","TIUTHLP",11,0)
 . W !!,"Required information for UPLOAD help not set up for this document."
"RTN","TIUTHLP",12,0)
 I $P(TIUPRM0,U,16)="D" D DHDR(.Y,TIUPRM0,TIUPRM1)
"RTN","TIUTHLP",13,0)
 E  I $P(TIUPRM0,U,16)="C" D CHDR(.Y,TIUPRM0,TIUPRM1)
"RTN","TIUTHLP",14,0)
 E  W !!,"Required information for UPLOAD help not set up for this report type."
"RTN","TIUTHLP",15,0)
 Q
"RTN","TIUTHLP",16,0)
DHDR(TIUX,TIUPRM0,TIUPRM1) ; Display Delimited String Header
"RTN","TIUTHLP",17,0)
 N TIUA,TIUI,TIUHSIG,TIUESTR,TIUHSTR,TIULIM,TIUTYP,TIUITEM
"RTN","TIUTHLP",18,0)
 N TIUNODE
"RTN","TIUTHLP",19,0)
 S TIUHSIG=$P(TIUPRM0,U,10),TIULIM=$P(TIUPRM0,U,13),TIUTYP=$P(TIUX(0),U,2)
"RTN","TIUTHLP",20,0)
 S TIUA=+TIUX,TIUI=2,(TIUHSTR,TIUESTR)=TIUHSIG_TIULIM_TIUTYP
"RTN","TIUTHLP",21,0)
 F  S TIUI=$O(^TIU(8925.1,TIUA,"ITEM",TIUI)) Q:+TIUI'>0  D
"RTN","TIUTHLP",22,0)
 . S TIUNODE=$G(^TIU(8925.1,TIUA,"ITEM",TIUI,0))
"RTN","TIUTHLP",23,0)
 . S $P(TIUHSTR,TIULIM,TIUI)=$P(TIUNODE,U,2)
"RTN","TIUTHLP",24,0)
 . S $P(TIUESTR,TIULIM,TIUI)=$P(TIUNODE,U,5)
"RTN","TIUTHLP",25,0)
 W !!,"Header line example:"
"RTN","TIUTHLP",26,0)
 W !!,TIUESTR ;header string with example of data
"RTN","TIUTHLP",27,0)
 W !!,"Report format:"
"RTN","TIUTHLP",28,0)
 W !!,TIUHSTR ;Header string with data description
"RTN","TIUTHLP",29,0)
 D RESTHDR(.TIUX,TIUPRM0,TIUPRM1)
"RTN","TIUTHLP",30,0)
 Q
"RTN","TIUTHLP",31,0)
CHDR(TIUX,TIUPRM0,TIUPRM1) ; Display Captioned Header
"RTN","TIUTHLP",32,0)
 N TIUA,TIUI,TIUNODE
"RTN","TIUTHLP",33,0)
 S TIUA=+TIUX
"RTN","TIUTHLP",34,0)
 W !!,$P(TIUPRM0,U,10),":",?40,$P(TIUX(0),U)
"RTN","TIUTHLP",35,0)
 S TIUI=0
"RTN","TIUTHLP",36,0)
 F  S TIUI=$O(^TIU(8925.1,TIUA,"HEAD",TIUI)) Q:+TIUI'>0  D
"RTN","TIUTHLP",37,0)
 . S TIUNODE=$G(^TIU(8925.1,TIUA,"HEAD",TIUI,0))
"RTN","TIUTHLP",38,0)
 . W !,$P(TIUNODE,U)_":",?40,$S($P(TIUNODE,U,5)]"":$P(TIUNODE,U,5),1:"""field entry""")
"RTN","TIUTHLP",39,0)
 W !,$P(TIUPRM0,U,12)
"RTN","TIUTHLP",40,0)
 D RESTHDR(.TIUX,TIUPRM0,TIUPRM1)
"RTN","TIUTHLP",41,0)
 Q
"RTN","TIUTHLP",42,0)
RESTHDR(TIUX,TIUPRM0,TIUPRM1) ;Header info that is same for both types
"RTN","TIUTHLP",43,0)
 W !?2,$P(TIUX(0),U)," Text"
"RTN","TIUTHLP",44,0)
 W !,$P(TIUPRM0,U,11)
"RTN","TIUTHLP",45,0)
 W !!,"*** File should be ASCII with width no greater than 80 columns."
"RTN","TIUTHLP",46,0)
 W !,"*** Use ","""",$P(TIUPRM1,U,6),""""," for ","""BLANKS"""
"RTN","TIUTHLP",47,0)
 W " (word or phrase in dictation that isn't understood)."
"RTN","TIUTHLP",48,0)
 Q
"RTN","TIUTHLP",49,0)
DIV ; Display user log-on division
"RTN","TIUTHLP",50,0)
 W $C(7),!!,"You are currently logged into DIVISION: "
"RTN","TIUTHLP",51,0)
 W $P($$NS^XUAF4(+$G(DUZ(2))),U),!!,"If a hospital location cannot be"
"RTN","TIUTHLP",52,0)
 W " determined for an uploaded document,",!,"the document's division"
"RTN","TIUTHLP",53,0)
 W " may be loaded with your log-in division."
"RTN","TIUTHLP",54,0)
 Q
"RTN","TIUTSK")
0^33^B11141260
"RTN","TIUTSK",1,0)
TIUTSK ; SLC/JER - TIU's Nightly Daemon ;4/18/03
"RTN","TIUTSK",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,53,100,113**;Jun 20, 1997
"RTN","TIUTSK",3,0)
MAIN ; All records are read. DC date updated, Record purged, Alerts are 
"RTN","TIUTSK",4,0)
 ; generated if appropriate
"RTN","TIUTSK",5,0)
 N TIUDA,TIUPRM0,TIUPRM1,TIUDATE,TIUENTDT,TIUPDT,TIUODT
"RTN","TIUTSK",6,0)
 D SETPARM^TIULE
"RTN","TIUTSK",7,0)
 ; Traverse "FIX" X-ref to fix temporary reference dates & back-fill
"RTN","TIUTSK",8,0)
 ; Discharge Dates
"RTN","TIUTSK",9,0)
 S TIUDA="" F  S TIUDA=$O(^TIU(8925,"FIX",1,TIUDA)) Q:TIUDA'>0  D
"RTN","TIUTSK",10,0)
 . D UPDDCDT(TIUDA) ;Ref Date fixed/DC Date updated if missing
"RTN","TIUTSK",11,0)
 ; Traverse "F" X-ref to identify records for which the grace period
"RTN","TIUTSK",12,0)
 ; for purge has expired
"RTN","TIUTSK",13,0)
 S TIUPDT=$$FMADD^XLFDT(DT,-$P(TIUPRM0,U,4))
"RTN","TIUTSK",14,0)
 S TIUODT=$$FMADD^XLFDT(DT,-$P(TIUPRM0,U,5))
"RTN","TIUTSK",15,0)
 S TIUENTDT=0
"RTN","TIUTSK",16,0)
 ; Traverse "F" X-ref to identify records overdue for signature or purge
"RTN","TIUTSK",17,0)
 ; NOTE: Following VHA Directive 10-92-077, the purge is disabled until
"RTN","TIUTSK",18,0)
 ;       further notice **53**
"RTN","TIUTSK",19,0)
 F  S TIUENTDT=$O(^TIU(8925,"F",TIUENTDT)) Q:+TIUENTDT'>0!(TIUENTDT>TIUODT)  D
"RTN","TIUTSK",20,0)
 . S TIUDA=0 F  S TIUDA=$O(^TIU(8925,"F",+TIUENTDT,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUTSK",21,0)
 . . ; I (TIUPDT<$$FMADD^XLFDT(DT,-90)),+$$PURGE^TIULC(TIUDA) D PURGE(TIUDA) Purges old records (see NOTE above) **53**
"RTN","TIUTSK",22,0)
 . . I +$$OVERDUE^TIULC(TIUDA) D SEND^TIUALRT(TIUDA,1) ;Alert for overdue
"RTN","TIUTSK",23,0)
 ; If upload buffer rec older than 30 days, delete it & its alerts
"RTN","TIUTSK",24,0)
 S TIUDA=0 F  S TIUDA=$O(^TIU(8925.2,TIUDA)) Q:TIUDA'>0  D
"RTN","TIUTSK",25,0)
 . N TIUDATE
"RTN","TIUTSK",26,0)
 . S TIUDATE=$P($G(^TIU(8925.2,TIUDA,0)),U,3)
"RTN","TIUTSK",27,0)
 . Q:+TIUDATE'>0
"RTN","TIUTSK",28,0)
 . I $$FMDIFF^XLFDT(DT,TIUDATE)>30 D
"RTN","TIUTSK",29,0)
 . . N TIUEI S TIUEI=0
"RTN","TIUTSK",30,0)
 . . ; JOEL, 12/21/00:
"RTN","TIUTSK",31,0)
 . . F  S TIUEI=$O(^TIU(8925.2,TIUDA,"ERR",TIUEI)) Q:+TIUEI'>0  D
"RTN","TIUTSK",32,0)
 . . . N TIUEDA
"RTN","TIUTSK",33,0)
 . . . S TIUEDA=+$G(^TIU(8925.2,TIUDA,"ERR",TIUEI,0)) Q:+TIUEDA'>0
"RTN","TIUTSK",34,0)
 . . . D ALERTDEL^TIUPEVNT(TIUEDA)
"RTN","TIUTSK",35,0)
 . . D BUFPURGE^TIUPUTC(TIUDA)
"RTN","TIUTSK",36,0)
 Q
"RTN","TIUTSK",37,0)
UPDDCDT(TIUDA) ; If missing DC date & Patient Movement file has DC date,
"RTN","TIUTSK",38,0)
 ;         DC date updated.
"RTN","TIUTSK",39,0)
 N DFN,DIE,DR,TIU,TIUDAD,TIUDDT,TIUD0,TIUD14,TIUDGPM
"RTN","TIUTSK",40,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD14=$G(^TIU(8925,+TIUDA,14))
"RTN","TIUTSK",41,0)
 S TIUDGPM=+$P(TIUD14,U)
"RTN","TIUTSK",42,0)
 I +$P($G(^DGPM(+TIUDGPM,0)),U,17)'>0 D  Q
"RTN","TIUTSK",43,0)
 . I +$P(TIUD0,U,12)>0 Q
"RTN","TIUTSK",44,0)
 . S DIE=8925,DR=".12////1",DA=TIUDA D ^DIE
"RTN","TIUTSK",45,0)
 I TIUD0'="",'+$P(TIUD0,U,6),(($P(TIUD0,U,8)="")!(+$P(TIUD0,U,12)>0)) D
"RTN","TIUTSK",46,0)
 . D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUTSK",47,0)
 . I +$G(TIU("LDT"))>0 D
"RTN","TIUTSK",48,0)
 . . S TIUDAD=$P(TIUD0,U,6)
"RTN","TIUTSK",49,0)
 . . D FIXDC(TIUDA,TIUDAD,DFN,.TIU)
"RTN","TIUTSK",50,0)
 Q
"RTN","TIUTSK",51,0)
PURGE(DA) ; When purge criteria met, document and addenda purged
"RTN","TIUTSK",52,0)
 N DR,DIE,TIUTYP,TIUDA,X,Y S TIUDA=0
"RTN","TIUTSK",53,0)
 F  S TIUDA=+$O(^TIU(8925,"DAD",+DA,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUTSK",54,0)
 . I +$$ISADDNDM^TIULC1(TIUDA) D PURGE(TIUDA) I 1
"RTN","TIUTSK",55,0)
 . E  D DIK^TIURB2(TIUDA) ; Remove components entirely. 1/3/01 updated DIK^TIURB to DIK^TIURB2 - Margy
"RTN","TIUTSK",56,0)
 S DIE=8925,DR=".05///PURGED;1609////"_$$NOW^TIULC_";2///@" D ^DIE
"RTN","TIUTSK",57,0)
 S ^TIU(8925,+DA,"TEXT",0)="^^"_2_U_2_U_DT_"^^"
"RTN","TIUTSK",58,0)
 S ^TIU(8925,+DA,"TEXT",1,0)=" "
"RTN","TIUTSK",59,0)
 S ^TIU(8925,+DA,"TEXT",2,0)="  Document Purged on "_$$DATE^TIULS(DT,"MM/DD/YY")_"."
"RTN","TIUTSK",60,0)
 Q
"RTN","TIUTSK",61,0)
FIXDC(DA,PARENT,DFN,TIU) ; Stuff fixed field data
"RTN","TIUTSK",62,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG
"RTN","TIUTSK",63,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUTSK",64,0)
 I +$G(PARENT)'>0 D
"RTN","TIUTSK",65,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U)
"RTN","TIUTSK",66,0)
 . S @FDARR@(1402)=$P($G(TIU("TS")),U)
"RTN","TIUTSK",67,0)
 I +$G(PARENT)>0 D
"RTN","TIUTSK",68,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U)
"RTN","TIUTSK",69,0)
 . S @FDARR@(1401)=$P(^TIU(8925,+PARENT,14),U)
"RTN","TIUTSK",70,0)
 . S @FDARR@(1402)=$P(^TIU(8925,+PARENT,14),U,2)
"RTN","TIUTSK",71,0)
 S @FDARR@(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUTSK",72,0)
 S @FDARR@(1212)=$P($G(TIU("INST")),U)
"RTN","TIUTSK",73,0)
 S @FDARR@(.12)="@"
"RTN","TIUTSK",74,0)
 S @FDARR@(1301)=+$G(TIU("LDT"))
"RTN","TIUTSK",75,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUTSK",76,0)
 Q
"VER")
8.0^22.0
"^DD",8925,8925,.01,0)
DOCUMENT TYPE^RP8925.1'O^TIU(8925.1,^0;1^Q
"^DD",8925,8925,.01,1,0)
^.1
"^DD",8925,8925,.01,1,1,0)
8925^B
"^DD",8925,8925,.01,1,1,1)
S ^TIU(8925,"B",$E(X,1,30),DA)=""
"^DD",8925,8925,.01,1,1,2)
K ^TIU(8925,"B",$E(X,1,30),DA)
"^DD",8925,8925,.01,1,2,0)
8925^APT2^MUMPS
"^DD",8925,8925,.01,1,2,1)
I +$P(^TIU(8925,+DA,0),U,2),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"APT",+$P(^TIU(8925,+DA,0),U,2),+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-$P(^TIU(8925,+DA,13),U)),DA)=""
"^DD",8925,8925,.01,1,2,2)
I +$P(^TIU(8925,+DA,0),U,2),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"APT",+$P(^TIU(8925,+DA,0),U,2),+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-$P(^TIU(8925,+DA,13),U)),DA)
"^DD",8925,8925,.01,1,2,"%D",0)
^^2^2^2960502^^^^
"^DD",8925,8925,.01,1,2,"%D",1,0)
This MUMPS-type, multi-field cross-reference by PATIENT, DOCUMENT TYPE,
"^DD",8925,8925,.01,1,2,"%D",2,0)
STATUS, and INVERSE ENTRY/DICTATION DATE facilitates look-ups by patient.
"^DD",8925,8925,.01,1,2,"DT")
2940322
"^DD",8925,8925,.01,1,3,0)
8925^AAU2^MUMPS
"^DD",8925,8925,.01,1,3,1)
I +$P($G(^TIU(8925,+DA,12)),U,2),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"AAU",+$P($G(^TIU(8925,+DA,12)),U,2),+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)=""
"^DD",8925,8925,.01,1,3,2)
I +$P($G(^TIU(8925,+DA,12)),U,2),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"AAU",+$P($G(^TIU(8925,+DA,12)),U,2),+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)
"^DD",8925,8925,.01,1,3,"%D",0)
^^2^2^2940722^^
"^DD",8925,8925,.01,1,3,"%D",1,0)
This MUMPS-type, multi-field cross-reference by AUTHOR, DOCUMENT TYPE,
"^DD",8925,8925,.01,1,3,"%D",2,0)
STATUS, and INVERSE ENTRY/DICTATION DATE facilitates look-ups by author.
"^DD",8925,8925,.01,1,3,"DT")
2940322
"^DD",8925,8925,.01,1,4,0)
8925^ASUP2^MUMPS
"^DD",8925,8925,.01,1,4,1)
I +$P($G(^TIU(8925,+DA,12)),U,8),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ASUP",+$P($G(^TIU(8925,+DA,12)),U,8),+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)=""
"^DD",8925,8925,.01,1,4,2)
I +$P($G(^TIU(8925,+DA,12)),U,8),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ASUP",+$P($G(^TIU(8925,+DA,12)),U,8),+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)
"^DD",8925,8925,.01,1,4,"%D",0)
^^3^3^2950125^^^^
"^DD",8925,8925,.01,1,4,"%D",1,0)
This multi-field, MUMPS-type cross-reference by (EXPECTED COSIGNER),
"^DD",8925,8925,.01,1,4,"%D",2,0)
DOCUMENT TYPE, STATUS, INVERSE ENTRY/DICTATION DATE/TIME is
"^DD",8925,8925,.01,1,4,"%D",3,0)
used for look-ups and queries.
"^DD",8925,8925,.01,1,4,"DT")
2950125
"^DD",8925,8925,.01,1,5,0)
8925^AV2^MUMPS
"^DD",8925,8925,.01,1,5,1)
I $P($$DOCTYPE^TIULF(+DA),U)="DOC",+$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^(0)),U,3) S ^TIU(8925,"AV",+$P(^TIU(8925,+DA,0),U,2),+X,+$P(^TIU(8925,+DA,0),U,3),+DA)=""
"^DD",8925,8925,.01,1,5,2)
I +$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^(0)),U,3) K ^TIU(8925,"AV",+$P(^TIU(8925,+DA,0),U,2),+X,+$P(^TIU(8925,+DA,0),U,3),+DA)
"^DD",8925,8925,.01,1,5,"%D",0)
^^3^3^2950615^^
"^DD",8925,8925,.01,1,5,"%D",1,0)
This MUMPS-type, multi-field cross-reference by patient, document type,
"^DD",8925,8925,.01,1,5,"%D",2,0)
and visit number will allow for a candidate key to determine whether a
"^DD",8925,8925,.01,1,5,"%D",3,0)
given document exists for a particular patient visit.
"^DD",8925,8925,.01,1,5,"DT")
2950615
"^DD",8925,8925,.01,1,6,0)
8925^ATS2^MUMPS
"^DD",8925,8925,.01,1,6,1)
I +$P($G(^TIU(8925,+DA,14)),U,2),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ATS",+$P($G(^TIU(8925,+DA,14)),U,2),+X,+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)=""
"^DD",8925,8925,.01,1,6,2)
I +$P($G(^TIU(8925,+DA,14)),U,2),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ATS",+$P($G(^TIU(8925,+DA,14)),U,2),+X,+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)
"^DD",8925,8925,.01,1,6,"%D",0)
^^3^3^2941121^^
"^DD",8925,8925,.01,1,6,"%D",1,0)
This MUMPS-type, multi-field cross-reference by TREATING SPECIALTY,
"^DD",8925,8925,.01,1,6,"%D",2,0)
DOCUMENT TYPE, STATUS, and INVERSE ENTRY/DICTATION DATE facilitates
"^DD",8925,8925,.01,1,6,"%D",3,0)
look-ups by treating specialty.
"^DD",8925,8925,.01,1,6,"DT")
2940325
"^DD",8925,8925,.01,1,7,0)
8925^ATC2^MUMPS
"^DD",8925,8925,.01,1,7,1)
I +$P($G(^TIU(8925,+DA,13)),U,2),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ATC",+$P($G(^TIU(8925,+DA,13)),U,2),+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)=""
"^DD",8925,8925,.01,1,7,2)
I +$P($G(^TIU(8925,+DA,13)),U,2),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ATC",+$P($G(^TIU(8925,+DA,13)),U,2),+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)
"^DD",8925,8925,.01,1,7,"%D",0)
^^3^3^2940323^
"^DD",8925,8925,.01,1,7,"%D",1,0)
This MUMPS-type, multi-field cross-reference by TRANSCRIPTIONIST ID,
"^DD",8925,8925,.01,1,7,"%D",2,0)
DOCUMENT TYPE, STATUS, and INVERSE DICTATION DATE will facilitate look-ups
"^DD",8925,8925,.01,1,7,"%D",3,0)
by transcriptionist.
"^DD",8925,8925,.01,1,7,"DT")
2940323
"^DD",8925,8925,.01,1,8,0)
8925^ALL2^MUMPS
"^DD",8925,8925,.01,1,8,1)
I +$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ALL","ANY",+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)=""
"^DD",8925,8925,.01,1,8,2)
I +$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ALL","ANY",+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)
"^DD",8925,8925,.01,1,8,"%D",0)
^^3^3^2940325^
"^DD",8925,8925,.01,1,8,"%D",1,0)
This multi-field cross-reference is used for building the review screen
"^DD",8925,8925,.01,1,8,"%D",2,0)
across all categories (Author, Attending Physician, Patient,
"^DD",8925,8925,.01,1,8,"%D",3,0)
Transcriptionist, or treating specialty).
"^DD",8925,8925,.01,1,8,"DT")
2940325
"^DD",8925,8925,.01,1,9,0)
8925^AA2^MUMPS
"^DD",8925,8925,.01,1,9,1)
I $P($$DOCTYPE^TIULF(+DA),U)="DOC",$L($P(^TIU(8925,+DA,0),U,2)),(+$P(^(0),U,3)>0) S ^TIU(8925,"AA",+$P(^(0),U,2),+X,(9999999-$P(+^AUPNVSIT(+$P(^TIU(8925,+DA,0),U,3),0),".")),DA)=""
"^DD",8925,8925,.01,1,9,2)
I $L($P(^TIU(8925,+DA,0),U,2)),(+$P(^(0),U,3)>0) K ^TIU(8925,"AA",+$P(^(0),U,2),+X,(9999999-$P(+^AUPNVSIT(+$P(^TIU(8925,+DA,0),U,3),0),".")),DA)
"^DD",8925,8925,.01,1,9,"%D",0)
^^4^4^2950615^^^^
"^DD",8925,8925,.01,1,9,"%D",1,0)
 
"^DD",8925,8925,.01,1,9,"%D",2,0)
This multi-field, MUMPS-type cross-reference by patient, document type and
"^DD",8925,8925,.01,1,9,"%D",3,0)
inverse visit date is optimized for searches by entity, attribute, and
"^DD",8925,8925,.01,1,9,"%D",4,0)
time.
"^DD",8925,8925,.01,1,9,"DT")
2950615
"^DD",8925,8925,.01,1,10,0)
8925^ASUB2^MUMPS
"^DD",8925,8925,.01,1,10,1)
I $L($P($G(^TIU(8925,+DA,17)),U)),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) D ASUBS^TIUDD($P($G(^TIU(8925,+DA,17)),U),+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-+$G(^TIU(8925,+DA,13))),DA)
"^DD",8925,8925,.01,1,10,2)
I $L($P($G(^TIU(8925,+DA,17)),U)),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) D ASUBK^TIUDD($P($G(^TIU(8925,+DA,17)),U),+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-+$G(^TIU(8925,+DA,13))),DA)
"^DD",8925,8925,.01,1,10,"%D",0)
^^2^2^2950928^^^^
"^DD",8925,8925,.01,1,10,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for queries by
"^DD",8925,8925,.01,1,10,"%D",2,0)
subject.
"^DD",8925,8925,.01,1,10,"DT")
2950928
"^DD",8925,8925,.01,1,11,0)
8925^ASVC2^MUMPS
"^DD",8925,8925,.01,1,11,1)
I +$P($G(^TIU(8925,+DA,14)),U,4),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ASVC",+$P($G(^TIU(8925,+DA,14)),U,4),+X,+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)=""
"^DD",8925,8925,.01,1,11,2)
I +$P($G(^TIU(8925,+DA,14)),U,4),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ASVC",+$P($G(^TIU(8925,+DA,14)),U,4),+X,+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)
"^DD",8925,8925,.01,1,11,"%D",0)
^^2^2^2970709^^^^
"^DD",8925,8925,.01,1,11,"%D",1,0)
This MUMPS-type, multi-field cross-reference by SERVICE, DOCUMENT TYPE,
"^DD",8925,8925,.01,1,11,"%D",2,0)
STATUS, and INVERSE ENTRY/DICTATION DATE facilitates by SERVICE.
"^DD",8925,8925,.01,1,11,"DT")
2970709
"^DD",8925,8925,.01,1,12,0)
8925^AE2^MUMPS
"^DD",8925,8925,.01,1,12,1)
I $P($$DOCTYPE^TIULF(+DA),U)="DOC",+$P($G(^TIU(8925,+DA,0)),U,2),(+$P($G(^(0)),U,3)>0) S ^TIU(8925,"AE",+$P($G(^TIU(8925,+DA,0)),U,2),(9999999-$P(+^AUPNVSIT(+$P(^TIU(8925,+DA,0),U,3),0),".")),+X,+DA)=""
"^DD",8925,8925,.01,1,12,2)
I $L($P(^TIU(8925,+DA,0),U)),(+$P(^(0),U,3)>0) K ^TIU(8925,"AE",+$P($G(^TIU(8925,+DA,0)),U,2),(9999999-$P(+^AUPNVSIT(+$P(^TIU(8925,+DA,0),U,3),0),".")),+X,+DA)
"^DD",8925,8925,.01,1,12,"%D",0)
^^2^2^2991109^^^
"^DD",8925,8925,.01,1,12,"%D",1,0)
This multi-field, MUMPS-type Cross-reference by Patient, Inverse Date, and 
"^DD",8925,8925,.01,1,12,"%D",2,0)
Report Type is to optimize searching by entity, time, and attribute
"^DD",8925,8925,.01,1,12,"DT")
2991109
"^DD",8925,8925,.01,1,13,0)
8925^ALOC2^MUMPS
"^DD",8925,8925,.01,1,13,1)
I +$P($G(^TIU(8925,+DA,12)),U,5),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ALOC",+$P($G(^TIU(8925,+DA,12)),U,5),+X,+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)=""
"^DD",8925,8925,.01,1,13,2)
I +$P($G(^TIU(8925,+DA,12)),U,5),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ALOC",+$P($G(^TIU(8925,+DA,12)),U,5),+X,+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)
"^DD",8925,8925,.01,1,13,"%D",0)
^^2^2^2960710^^
"^DD",8925,8925,.01,1,13,"%D",1,0)
This MUMPS-type, multi-field cross-reference is optimized for searching 
"^DD",8925,8925,.01,1,13,"%D",2,0)
hospital location, document type, status, and date range.
"^DD",8925,8925,.01,1,13,"DT")
2950615
"^DD",8925,8925,.01,1,14,0)
8925^APRB2^MUMPS
"^DD",8925,8925,.01,1,14,1)
I +$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5),+$O(^TIU(8925.9,"B",+DA,0)) D APRBS^TIUDD(+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-+$G(^TIU(8925,+DA,13))),DA)
"^DD",8925,8925,.01,1,14,2)
I +$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5),+$O(^TIU(8925.9,"B",+DA,0)) D APRBK^TIUDD(+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-+$G(^TIU(8925,+DA,13))),DA)
"^DD",8925,8925,.01,1,14,"%D",0)
^^3^3^2950928^^^
"^DD",8925,8925,.01,1,14,"%D",1,0)
This MUMPS-type, multi-field cross-reference by Problem, Document Type,
"^DD",8925,8925,.01,1,14,"%D",2,0)
Status, and Inverse Reference Date facilitates query for documents by
"^DD",8925,8925,.01,1,14,"%D",3,0)
problem.
"^DD",8925,8925,.01,1,14,"DT")
2950928
"^DD",8925,8925,.01,1,15,0)
8925^AVSIT2^MUMPS
"^DD",8925,8925,.01,1,15,1)
I +$P(^TIU(8925,+DA,0),U,3),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"AVSIT",+$P(^TIU(8925,+DA,0),U,3),+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-$P(^TIU(8925,+DA,13),U)),DA)=""
"^DD",8925,8925,.01,1,15,2)
I +$P(^TIU(8925,+DA,0),U,3),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"AVSIT",+$P(^TIU(8925,+DA,0),U,3),+X,+$P(^TIU(8925,+DA,0),U,5),(9999999-$P(^TIU(8925,+DA,13),U)),DA)
"^DD",8925,8925,.01,1,15,"%D",0)
^^2^2^2951207^^^
"^DD",8925,8925,.01,1,15,"%D",1,0)
This MUMPS-type, multi-field cross-reference by VISIT, DOCUMENT TYPE,
"^DD",8925,8925,.01,1,15,"%D",2,0)
STATUS, and INVERSE ENTRY/DICTATION DATE facilitates look-ups by visit.
"^DD",8925,8925,.01,1,15,"DT")
2950907
"^DD",8925,8925,.01,1,16,0)
8925^APTCL2^MUMPS
"^DD",8925,8925,.01,1,16,1)
I +$P(^TIU(8925,+DA,0),U,2),+$P($G(^TIU(8925,+DA,13)),U) S ^TIU(8925,"APTCL",+$P(^TIU(8925,+DA,0),U,2),+$$CLINDOC^TIULC1(+X,+DA),(9999999-$P(^TIU(8925,+DA,13),U)),DA)=""
"^DD",8925,8925,.01,1,16,2)
I +$P(^TIU(8925,+DA,0),U,2),+$P($G(^TIU(8925,+DA,13)),U) K ^TIU(8925,"APTCL",+$P(^TIU(8925,+DA,0),U,2),+$$CLINDOC^TIULC1(+X,+DA),(9999999-$P(^TIU(8925,+DA,13),U)),DA)
"^DD",8925,8925,.01,1,16,"%D",0)
^^2^2^2960823^^^^
"^DD",8925,8925,.01,1,16,"%D",1,0)
This MUMPS-type, multi-field cross-reference by PATIENT, CLINICAL DOCUMENT
"^DD",8925,8925,.01,1,16,"%D",2,0)
CLASS, and INVERSE REFERENCE DATE facilitates look-ups by patient.
"^DD",8925,8925,.01,1,16,"DT")
2960823
"^DD",8925,8925,.01,1,17,0)
8925^APTCL382^MUMPS
"^DD",8925,8925,.01,1,17,1)
I +$P(^TIU(8925,+DA,0),U,2),+$P($G(^TIU(8925,+DA,13)),U) S ^TIU(8925,"APTCL",+$P(^TIU(8925,+DA,0),U,2),38,(9999999-$P(^TIU(8925,+DA,13),U)),DA)=""
"^DD",8925,8925,.01,1,17,2)
I +$P(^TIU(8925,+DA,0),U,2),+$P($G(^TIU(8925,+DA,13)),U) K ^TIU(8925,"APTCL",+$P(^TIU(8925,+DA,0),U,2),38,(9999999-$P(^TIU(8925,+DA,13),U)),DA)
"^DD",8925,8925,.01,1,17,"%D",0)
^^2^2^2960506^
"^DD",8925,8925,.01,1,17,"%D",1,0)
This MUMPS-type, multi-field cross-reference by PATIENT, ROOT CLASS, and
"^DD",8925,8925,.01,1,17,"%D",2,0)
INVERSE REFERENCE DATE facilitates look-ups by patient.
"^DD",8925,8925,.01,1,17,"DT")
2960506
"^DD",8925,8925,.01,1,18,0)
8925^ACLPT01^MUMPS
"^DD",8925,8925,.01,1,18,1)
D SACLPT^TIUDD0(.01,X)
"^DD",8925,8925,.01,1,18,2)
D KACLPT^TIUDD01(.01,X)
"^DD",8925,8925,.01,1,18,"%D",0)
^^3^3^2980630^^
"^DD",8925,8925,.01,1,18,"%D",1,0)
This multi-field, MUMPS-type cross-reference on CLASS, PATIENT, INVERSE
"^DD",8925,8925,.01,1,18,"%D",2,0)
REFERENCE DATE/TIME, and RECORD # is designed to support rapid queries by
"^DD",8925,8925,.01,1,18,"%D",3,0)
patient.
"^DD",8925,8925,.01,1,18,"DT")
2970617
"^DD",8925,8925,.01,1,19,0)
8925^ACLAU02^MUMPS
"^DD",8925,8925,.01,1,19,1)
D SACLAU^TIUDD0(.01,X),SACLAU1^TIUDD0(.01,X)
"^DD",8925,8925,.01,1,19,2)
D KACLAU^TIUDD01(.01,X),KACLAU1^TIUDD01(.01,X)
"^DD",8925,8925,.01,1,19,"%D",0)
^^4^4^2970617^
"^DD",8925,8925,.01,1,19,"%D",1,0)
This multi-field, MUMPS-type cross-reference on CLASS, AUTHOR (or ENTERED
"^DD",8925,8925,.01,1,19,"%D",2,0)
BY), PATIENT, INVERSE REFERENCE DATE/TIME, and RECORD # is designed to
"^DD",8925,8925,.01,1,19,"%D",3,0)
facilitate rapid access to the current users unsigned notes about a
"^DD",8925,8925,.01,1,19,"%D",4,0)
patient.
"^DD",8925,8925,.01,1,19,"DT")
2970617
"^DD",8925,8925,.01,1,20,0)
8925^ACLEC01^MUMPS
"^DD",8925,8925,.01,1,20,1)
D SACLEC^TIUDD0(.01,X)
"^DD",8925,8925,.01,1,20,2)
D KACLEC^TIUDD01(.01,X)
"^DD",8925,8925,.01,1,20,"%D",0)
^.101^3^3^3021106^^
"^DD",8925,8925,.01,1,20,"%D",1,0)
This multi-field, MUMPS-type Cross-reference on CLASS, EXPECTED COSIGNER,
"^DD",8925,8925,.01,1,20,"%D",2,0)
PATIENT, INVERSE REFERENCE DATE/TIME, and RECORD # is useful for finding
"^DD",8925,8925,.01,1,20,"%D",3,0)
the uncosigned notes by the current user for a given patient.
"^DD",8925,8925,.01,1,20,"DT")
2970617
"^DD",8925,8925,.01,1,21,0)
8925^ACLSB01^MUMPS
"^DD",8925,8925,.01,1,21,1)
D SACLSB^TIUDD0(.01,X)
"^DD",8925,8925,.01,1,21,2)
D KACLSB^TIUDD01(.01,X)
"^DD",8925,8925,.01,1,21,"%D",0)
^^3^3^2990122^^^^
"^DD",8925,8925,.01,1,21,"%D",1,0)
This cross-reference by CLASS, SIGNED BY, PATIENT, INVERSE REFERENCE
"^DD",8925,8925,.01,1,21,"%D",2,0)
DATE/TIME, and RECORD # will facilitate finding records signed by a given
"^DD",8925,8925,.01,1,21,"%D",3,0)
user about the current patient.
"^DD",8925,8925,.01,1,21,"DT")
2970617
"^DD",8925,8925,.01,1,22,0)
8925^APTLD01^MUMPS
"^DD",8925,8925,.01,1,22,1)
D SAPTLD^TIUDD0(.01,X)
"^DD",8925,8925,.01,1,22,2)
D KAPTLD^TIUDD01(.01,X)
"^DD",8925,8925,.01,1,22,"%D",0)
^^2^2^2970617^^^
"^DD",8925,8925,.01,1,22,"%D",1,0)
This MUMPS type Multi-field index by PT,TITLE,"LOC;VDT;VTYP",DA is used
"^DD",8925,8925,.01,1,22,"%D",2,0)
for optimizing checks for documents for a particular visit.
"^DD",8925,8925,.01,1,22,"DT")
2970617
"^DD",8925,8925,.01,2)
S Y(0)=Y S Y=$S($$PNAME^TIULC1(+Y)]"":$$PNAME^TIULC1(+Y),$P(^TIU(8925.1,+Y,0),U,3)]"":$P(^TIU(8925.1,+Y,0),U,3),1:Y)
"^DD",8925,8925,.01,2.1)
S Y=$S($$PNAME^TIULC1(+Y)]"":$$PNAME^TIULC1(+Y),$P(^TIU(8925.1,+Y,0),U,3)]"":$P(^TIU(8925.1,+Y,0),U,3),1:Y)
"^DD",8925,8925,.01,3)
Select the type of document.
"^DD",8925,8925,.01,21,0)
^^3^3^2991109^^^^
"^DD",8925,8925,.01,21,1,0)
This field points to the Tiu Document Definition file, whose entry defines
"^DD",8925,8925,.01,21,2,0)
the components of the document and various parameters for the document's
"^DD",8925,8925,.01,21,3,0)
behavior.
"^DD",8925,8925,.01,"DT")
3030418
"^DD",8925,8925,.05,0)
STATUS^P8925.6'^TIU(8925.6,^0;5^Q
"^DD",8925,8925,.05,1,0)
^.1
"^DD",8925,8925,.05,1,1,0)
8925^ASUP3^MUMPS
"^DD",8925,8925,.05,1,1,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,8),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ASUP",+$P(^TIU(8925,+DA,12),U,8),+$P(^TIU(8925,+DA,0),U),+X,(9999999-+$P(^TIU(8925,+DA,13),U)),+DA)=""
"^DD",8925,8925,.05,1,1,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,8),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ASUP",+$P(^TIU(8925,+DA,12),U,8),+$P(^TIU(8925,+DA,0),U),+X,(9999999-+$P(^TIU(8925,+DA,13),U)),+DA)
"^DD",8925,8925,.05,1,1,"%D",0)
^^3^3^2950125^^
"^DD",8925,8925,.05,1,1,"%D",1,0)
This MUMPS-type, multi-field cross-reference by (EXPECTED COSIGNER),
"^DD",8925,8925,.05,1,1,"%D",2,0)
DOCUMENT TYPE, STATUS, and INVERSE ENTRY/DICTATION DATE/TIME,
"^DD",8925,8925,.05,1,1,"%D",3,0)
will be used for look-ups and queries.
"^DD",8925,8925,.05,1,1,"DT")
2950125
"^DD",8925,8925,.05,1,2,0)
8925^AAU3^MUMPS
"^DD",8925,8925,.05,1,2,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,2),+$P($G(^TIU(8925,+DA,13)),U) S ^TIU(8925,"AAU",+$P(^TIU(8925,+DA,12),U,2),+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P(^TIU(8925,+DA,13),U)),+DA)=""
"^DD",8925,8925,.05,1,2,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,2),+$P($G(^TIU(8925,+DA,13)),U) K ^TIU(8925,"AAU",+$P(^TIU(8925,+DA,12),U,2),+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P(^TIU(8925,+DA,13),U)),+DA)
"^DD",8925,8925,.05,1,2,"%D",0)
^^3^3^2940722^^
"^DD",8925,8925,.05,1,2,"%D",1,0)
This MUMPS-type, multi-field cross-reference by AUTHOR/DICTATOR, DOCUMENT
"^DD",8925,8925,.05,1,2,"%D",2,0)
TYPE, STATUS, and INVERSE ENTRY/DICTATION DATE/TIME is used for look-ups
"^DD",8925,8925,.05,1,2,"%D",3,0)
and queries.
"^DD",8925,8925,.05,1,2,"DT")
2940322
"^DD",8925,8925,.05,1,3,0)
8925^APT3^MUMPS
"^DD",8925,8925,.05,1,3,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^TIU(8925,+DA,13)),U) S ^TIU(8925,"APT",+$P(^TIU(8925,+DA,0),U,2),+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P(^TIU(8925,+DA,13),U)),+DA)=""
"^DD",8925,8925,.05,1,3,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^TIU(8925,+DA,13)),U) K ^TIU(8925,"APT",+$P(^TIU(8925,+DA,0),U,2),+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P(^TIU(8925,+DA,13),U)),+DA)
"^DD",8925,8925,.05,1,3,"%D",0)
^^3^3^2950925^^^
"^DD",8925,8925,.05,1,3,"%D",1,0)
This MUMPS-type, multi-field cross-reference by PATIENT, DOCUMENT TYPE,
"^DD",8925,8925,.05,1,3,"%D",2,0)
STATUS, and INVERSE ENTRY/DICTATION DATE/TIME is used for look-ups and
"^DD",8925,8925,.05,1,3,"%D",3,0)
queries.
"^DD",8925,8925,.05,1,3,"DT")
2940322
"^DD",8925,8925,.05,1,4,0)
8925^ATC3^MUMPS
"^DD",8925,8925,.05,1,4,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,13)),U,2),+$P($G(^TIU(8925,+DA,13)),U) S ^TIU(8925,"ATC",+$P($G(^TIU(8925,+DA,13)),U,2),+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)=""
"^DD",8925,8925,.05,1,4,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,13)),U,2),+$P($G(^TIU(8925,+DA,13)),U) K ^TIU(8925,"ATC",+$P($G(^TIU(8925,+DA,13)),U,2),+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)
"^DD",8925,8925,.05,1,4,"%D",0)
^^3^3^2940323^
"^DD",8925,8925,.05,1,4,"%D",1,0)
This MUMPS-type, multi-field cross-reference by ENTERED BY, DOCUMENT TYPE,
"^DD",8925,8925,.05,1,4,"%D",2,0)
STATUS, and INVERSE ENTRY/DICTATION DATE/TIME is used for look-ups and
"^DD",8925,8925,.05,1,4,"%D",3,0)
queries.
"^DD",8925,8925,.05,1,4,"DT")
2940323
"^DD",8925,8925,.05,1,5,0)
8925^ATS3^MUMPS
"^DD",8925,8925,.05,1,5,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,14)),U,2),+$P($G(^TIU(8925,+DA,13)),U) S ^TIU(8925,"ATS",+$P($G(^TIU(8925,+DA,14)),U,2),+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)=""
"^DD",8925,8925,.05,1,5,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,14)),U,2),+$P($G(^TIU(8925,+DA,13)),U) K ^TIU(8925,"ATS",+$P($G(^TIU(8925,+DA,14)),U,2),+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)
"^DD",8925,8925,.05,1,5,"%D",0)
^^3^3^2941121^^
"^DD",8925,8925,.05,1,5,"%D",1,0)
This MUMPS-type, multi-field cross-reference by TREATING SPECIALTY,
"^DD",8925,8925,.05,1,5,"%D",2,0)
DOCUMENT TYPE, STATUS, and INVERSE ENTRY/DICTATION DATE/TIME is used for
"^DD",8925,8925,.05,1,5,"%D",3,0)
look-ups and queries.
"^DD",8925,8925,.05,1,5,"DT")
2940325
"^DD",8925,8925,.05,1,6,0)
8925^ALL3^MUMPS
"^DD",8925,8925,.05,1,6,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,13)),U) S ^TIU(8925,"ALL","ANY",+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P(^TIU(8925,+DA,13),U)),+DA)=""
"^DD",8925,8925,.05,1,6,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,13)),U) K ^TIU(8925,"ALL","ANY",+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P(^TIU(8925,+DA,13),U)),+DA)
"^DD",8925,8925,.05,1,6,"%D",0)
^^2^2^2940325^
"^DD",8925,8925,.05,1,6,"%D",1,0)
This MUMPS-type, multi-field cross-reference by DOCUMENT TYPE, STATUS, and
"^DD",8925,8925,.05,1,6,"%D",2,0)
INVERSE ENTRY/DICTATION DATE/TIME is used for queries and look-ups.
"^DD",8925,8925,.05,1,6,"DT")
2940325
"^DD",8925,8925,.05,1,7,0)
8925^ASUB3^MUMPS
"^DD",8925,8925,.05,1,7,1)
I +$P($G(^TIU(8925,+DA,0)),U),$L($P($G(^TIU(8925,+DA,17)),U)),+$P($G(^TIU(8925,+DA,13)),U) D ASUBS^TIUDD($P($G(^TIU(8925,+DA,17)),U),+$G(^TIU(8925,+DA,0)),+X,(9999999-+$G(^TIU(8925,+DA,13))),DA)
"^DD",8925,8925,.05,1,7,2)
I +$P($G(^TIU(8925,+DA,0)),U),$L($P($G(^TIU(8925,+DA,17)),U)),+$P($G(^TIU(8925,+DA,13)),U) D ASUBK^TIUDD($P($G(^TIU(8925,+DA,17)),U),+$G(^TIU(8925,+DA,0)),+X,(9999999-+$G(^TIU(8925,+DA,13))),DA)
"^DD",8925,8925,.05,1,7,"%D",0)
^^2^2^2950928^^^^
"^DD",8925,8925,.05,1,7,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used in queries by
"^DD",8925,8925,.05,1,7,"%D",2,0)
subject.
"^DD",8925,8925,.05,1,7,"DT")
2950928
"^DD",8925,8925,.05,1,8,0)
8925^ASVC3^MUMPS
"^DD",8925,8925,.05,1,8,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,14)),U,4),+$P($G(^TIU(8925,+DA,13)),U) S ^TIU(8925,"ASVC",+$P($G(^TIU(8925,+DA,14)),U,4),+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)=""
"^DD",8925,8925,.05,1,8,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,14)),U,4),+$P($G(^TIU(8925,+DA,13)),U) K ^TIU(8925,"ASVC",+$P($G(^TIU(8925,+DA,14)),U,4),+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)
"^DD",8925,8925,.05,1,8,"%D",0)
^^2^2^2941121^
"^DD",8925,8925,.05,1,8,"%D",1,0)
This MUMPS-type, multi-field cross-reference by SERVICE, TYPE, STATUS, and 
"^DD",8925,8925,.05,1,8,"%D",2,0)
INVERSE ENTRY/DICTATION DATE/TIME is used look-ups and 
"^DD",8925,8925,.05,1,8,"DT")
2941121
"^DD",8925,8925,.05,1,9,0)
8925^ALOC3^MUMPS
"^DD",8925,8925,.05,1,9,1)
I +$P($G(^TIU(8925,+DA,12)),U,5),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U) S ^TIU(8925,"ALOC",+$P($G(^TIU(8925,+DA,12)),U,5),+$P($G(^TIU(8925,+DA,0)),U),+X,(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)=""
"^DD",8925,8925,.05,1,9,2)
I +$P($G(^TIU(8925,+DA,12)),U,5),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U) K ^TIU(8925,"ALOC",+$P($G(^TIU(8925,+DA,12)),U,5),+$P($G(^TIU(8925,+DA,0)),U),+X,(9999999-$P($G(^TIU(8925,+DA,13)),U)),DA)
"^DD",8925,8925,.05,1,9,"%D",0)
^^2^2^2960710^^
"^DD",8925,8925,.05,1,9,"%D",1,0)
This MUMPS-type, multi-field cross-reference is optimized for searching 
"^DD",8925,8925,.05,1,9,"%D",2,0)
hospital location, document type, status, and date range.
"^DD",8925,8925,.05,1,9,"DT")
2950615
"^DD",8925,8925,.05,1,10,0)
8925^APRB3^MUMPS
"^DD",8925,8925,.05,1,10,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,13)),U),+$O(^TIU(8925.9,"B",+DA,0)) D APRBS^TIUDD(+$G(^TIU(8925,+DA,0)),+X,(9999999-+$G(^TIU(8925,+DA,13))),DA)
"^DD",8925,8925,.05,1,10,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,13)),U),+$O(^TIU(8925.9,"B",+DA,0)) D APRBK^TIUDD(+$G(^TIU(8925,+DA,0)),+X,(9999999-+$G(^TIU(8925,+DA,13))),DA)
"^DD",8925,8925,.05,1,10,"%D",0)
^^2^2^2950928^^
"^DD",8925,8925,.05,1,10,"%D",1,0)
This MUMPS-type, Multi-field index by PROBLEM, DOCUMENT TYPE, STATUS, and
"^DD",8925,8925,.05,1,10,"%D",2,0)
INVERSE DICTATION DATE/TIME facilitates queries by problem.
"^DD",8925,8925,.05,1,10,"DT")
2950928
"^DD",8925,8925,.05,1,11,0)
8925^AVSIT3^MUMPS
"^DD",8925,8925,.05,1,11,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,3),+$P($G(^TIU(8925,+DA,13)),U) S ^TIU(8925,"AVSIT",+$P(^TIU(8925,+DA,0),U,3),+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P(^TIU(8925,+DA,13),U)),+DA)=""
"^DD",8925,8925,.05,1,11,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,3),+$P($G(^TIU(8925,+DA,13)),U) K ^TIU(8925,"AVSIT",+$P(^TIU(8925,+DA,0),U,3),+$P(^TIU(8925,+DA,0),U),+X,(9999999-$P(^TIU(8925,+DA,13),U)),+DA)
"^DD",8925,8925,.05,1,11,"%D",0)
^^2^2^2951207^^^
"^DD",8925,8925,.05,1,11,"%D",1,0)
This MUMPS-type, multi-field cross-reference by VISIT, DOCUMENT TYPE,
"^DD",8925,8925,.05,1,11,"%D",2,0)
STATUS, and INVERSE ENTRY/DICTATION DATE facilitates look-ups by visit.
"^DD",8925,8925,.05,1,11,"DT")
2951207
"^DD",8925,8925,.05,1,12,0)
8925^ADCPT3^MUMPS
"^DD",8925,8925,.05,1,12,1)
I +$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,4) S ^TIU(8925,"ADCPT",+$P(^TIU(8925,+DA,0),U,2),+$P(^TIU(8925,+DA,0),U,4),+X,(9999999-$P(^TIU(8925,+DA,13),U)),DA)=""
"^DD",8925,8925,.05,1,12,2)
I +$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^TIU(8925,+DA,13)),U),+$P($G(^TIU(8925,+DA,0)),U,4) K ^TIU(8925,"ADCPT",+$P(^TIU(8925,+DA,0),U,2),+$P(^TIU(8925,+DA,0),U,4),+X,(9999999-$P(^TIU(8925,+DA,13),U)),DA)
"^DD",8925,8925,.05,1,12,"%D",0)
^^3^3^2950925^
"^DD",8925,8925,.05,1,12,"%D",1,0)
This MUMPS-type, multi-field cross-reference by PATIENT, DOCUMENT CLASS,
"^DD",8925,8925,.05,1,12,"%D",2,0)
STATUS, and INVERSE REFERENCE DATE facilitates look-ups by PATIENT AND
"^DD",8925,8925,.05,1,12,"%D",3,0)
DOCUMENT CLASS (e.g., all SIGNED Violence Postings for patient John Doe).
"^DD",8925,8925,.05,1,12,"DT")
2950925
"^DD",8925,8925,.05,1,13,0)
8925^ACLPT05^MUMPS
"^DD",8925,8925,.05,1,13,1)
D SACLPT^TIUDD0(.05,X)
"^DD",8925,8925,.05,1,13,2)
D KACLPT^TIUDD01(.05,X)
"^DD",8925,8925,.05,1,13,"%D",0)
^^13^13^2990318^
"^DD",8925,8925,.05,1,13,"%D",1,0)
This multi-field M-type cross-reference on CLASS, PATIENT, INVERSE REFERENCE
"^DD",8925,8925,.05,1,13,"%D",2,0)
DATE/TIME, and RECORD # supports rapid queries by patient.  The global set
"^DD",8925,8925,.05,1,13,"%D",3,0)
looks like ^TIU(8925,"ACLPT",<class>,<patient>,<inverse reference date/
"^DD",8925,8925,.05,1,13,"%D",4,0)
time>,<document IEN>)=""
"^DD",8925,8925,.05,1,13,"%D",5,0)
 
"^DD",8925,8925,.05,1,13,"%D",6,0)
The STATUS field is cross-referenced to catch cases where the status is
"^DD",8925,8925,.05,1,13,"%D",7,0)
not updated until after the SIGNATURE DATE/TIME is edited. Generally,
"^DD",8925,8925,.05,1,13,"%D",8,0)
documents are added to the ACLPT cross-reference when they are first
"^DD",8925,8925,.05,1,13,"%D",9,0)
signed, via the SIGNATURE DATE/TIME field.  However, they are added only
"^DD",8925,8925,.05,1,13,"%D",10,0)
if their status is already signed or higher.  Since Sign on Chart code
"^DD",8925,8925,.05,1,13,"%D",11,0)
does not update status until AFTER editing SIGNATURE DATE/TIME, SOC
"^DD",8925,8925,.05,1,13,"%D",12,0)
documents are omitted from the cross-reference. Adding this cross-
"^DD",8925,8925,.05,1,13,"%D",13,0)
reference to the status field corrects this problem.
"^DD",8925,8925,.05,1,13,"DT")
2990317
"^DD",8925,8925,.05,1,14,0)
8925^ACLEC06^MUMPS
"^DD",8925,8925,.05,1,14,1)
D SACLEC^TIUDD0(.05,X)
"^DD",8925,8925,.05,1,14,2)
D KACLEC^TIUDD01(.05,X)
"^DD",8925,8925,.05,1,14,"%D",0)
^.101^3^3^3030520^^^
"^DD",8925,8925,.05,1,14,"%D",1,0)
This multi-field, MUMPS-type cross reference on CLASS, EXPECTED COSIGNER, 
"^DD",8925,8925,.05,1,14,"%D",2,0)
PATIENT, INVERSE REFERENCE DATE/TIME, and RECORD # is useful for finding the 
"^DD",8925,8925,.05,1,14,"%D",3,0)
uncosigned notes by the current user for a given patient.
"^DD",8925,8925,.05,1,14,"DT")
3030122
"^DD",8925,8925,.05,1,15,0)
8925^ACLAU05^MUMPS
"^DD",8925,8925,.05,1,15,1)
D SACLAU^TIUDD0(.05,X),SACLAU1^TIUDD0(.05,X)
"^DD",8925,8925,.05,1,15,2)
D KACLAU^TIUDD01(.05,X),KACLAU1^TIUDD01(.05,X)
"^DD",8925,8925,.05,1,15,"%D",0)
^.101^3^3^3030520^^
"^DD",8925,8925,.05,1,15,"%D",1,0)
This multi-field, MUMPS-type cross reference on CLASS, AUTHOR (or ENTERED 
"^DD",8925,8925,.05,1,15,"%D",2,0)
BY), PATIENT, INVERSE REFERENCE DATE/TIME, and RECORD # is designed to 
"^DD",8925,8925,.05,1,15,"%D",3,0)
faciliate rapid access to the current users unsigned notes about a patient.
"^DD",8925,8925,.05,1,15,"DT")
3030122
"^DD",8925,8925,.05,3)
Enter the status of the document.
"^DD",8925,8925,.05,21,0)
^^1^1^2940318^
"^DD",8925,8925,.05,21,1,0)
This field is intended to accommodate the status of a given report.
"^DD",8925,8925,.05,"DT")
3030418
"^DD",8925,8925,1212,0)
DIVISION^P4'^DIC(4,^12;12^Q
"^DD",8925,8925,1212,3)
Enter the institution associated with the document.
"^DD",8925,8925,1212,21,0)
^^3^3^3030418^
"^DD",8925,8925,1212,21,1,0)
This field contains the institution associated with the document. It is 
"^DD",8925,8925,1212,21,2,0)
extracted from the document's hospital location if known; otherwise it is 
"^DD",8925,8925,1212,21,3,0)
extracted from the user's log-on division.
"^DD",8925,8925,1212,"DT")
3030418
"^DD",8925,8925,1301,0)
REFERENCE DATE^D^^13;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",8925,8925,1301,.1)
DATE/TIME OF NOTE
"^DD",8925,8925,1301,1,0)
^.1
"^DD",8925,8925,1301,1,1,0)
8925^AAU1^MUMPS
"^DD",8925,8925,1301,1,1,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"AAU",+$P(^TIU(8925,+DA,12),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,1,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"AAU",+$P(^TIU(8925,+DA,12),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,1,"%D",0)
^^2^2^2940722^^^
"^DD",8925,8925,1301,1,1,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups by
"^DD",8925,8925,1301,1,1,"%D",2,0)
author, document type, status, and date range.
"^DD",8925,8925,1301,1,1,"DT")
2940322
"^DD",8925,8925,1301,1,2,0)
8925^ASUP1^MUMPS
"^DD",8925,8925,1301,1,2,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,8),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ASUP",+$P(^TIU(8925,+DA,12),U,8),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,2,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,8),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ASUP",+$P(^TIU(8925,+DA,12),U,8),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,2,"%D",0)
^^3^3^2950125^^
"^DD",8925,8925,1301,1,2,"%D",1,0)
This MUMPS-type, multi-field cross-reference by EXPECTED COSIGNER),
"^DD",8925,8925,1301,1,2,"%D",2,0)
DOCUMENT TYPE, STATUS, and INVERSE ENTRY/DICTATION DATE/TIME will
"^DD",8925,8925,1301,1,2,"%D",3,0)
be used for look-ups and queries.
"^DD",8925,8925,1301,1,2,"DT")
2950125
"^DD",8925,8925,1301,1,3,0)
8925^APT1^MUMPS
"^DD",8925,8925,1301,1,3,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"APT",+$P(^TIU(8925,+DA,0),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,3,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"APT",+$P(^TIU(8925,+DA,0),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,3,"%D",0)
^^2^2^2950925^^^
"^DD",8925,8925,1301,1,3,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups by
"^DD",8925,8925,1301,1,3,"%D",2,0)
patient, document type, status, and date range.
"^DD",8925,8925,1301,1,3,"DT")
2940322
"^DD",8925,8925,1301,1,4,0)
8925^ATS1^MUMPS
"^DD",8925,8925,1301,1,4,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,14)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ATS",+$P(^TIU(8925,+DA,14),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,4,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,14)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ATS",+$P(^TIU(8925,+DA,14),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,4,"%D",0)
^^2^2^2941122^^
"^DD",8925,8925,1301,1,4,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups by
"^DD",8925,8925,1301,1,4,"%D",2,0)
Treating Specialty, document type, status, and date range.
"^DD",8925,8925,1301,1,4,"DT")
2940325
"^DD",8925,8925,1301,1,5,0)
8925^ATC1^MUMPS
"^DD",8925,8925,1301,1,5,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,13)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ATC",+$P(^TIU(8925,+DA,13),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,5,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,13)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ATC",+$P(^TIU(8925,+DA,13),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,5,"%D",0)
^^2^2^2940323^
"^DD",8925,8925,1301,1,5,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups by
"^DD",8925,8925,1301,1,5,"%D",2,0)
Entry person, document type, status, and date range.
"^DD",8925,8925,1301,1,5,"DT")
2940323
"^DD",8925,8925,1301,1,6,0)
8925^ALL1^MUMPS
"^DD",8925,8925,1301,1,6,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ALL","ANY",+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,6,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ALL","ANY",+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,6,"%D",0)
^^2^2^2940325^
"^DD",8925,8925,1301,1,6,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups by
"^DD",8925,8925,1301,1,6,"%D",2,0)
document type and date range.
"^DD",8925,8925,1301,1,6,"DT")
2940325
"^DD",8925,8925,1301,1,7,0)
8925^ASUB1^MUMPS
"^DD",8925,8925,1301,1,7,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,5),$L($P($G(^TIU(8925,+DA,17)),U)) D ASUBS^TIUDD($P($G(^TIU(8925,+DA,17)),U),+$G(^TIU(8925,+DA,0)),+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-+X),DA)
"^DD",8925,8925,1301,1,7,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,5),$L($P($G(^TIU(8925,+DA,17)),U)) D ASUBK^TIUDD($P($G(^TIU(8925,+DA,17)),U),+$G(^TIU(8925,+DA,0)),+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-+X),DA)
"^DD",8925,8925,1301,1,7,"%D",0)
^^2^2^2950928^^
"^DD",8925,8925,1301,1,7,"%D",1,0)
This MULTI-fields, MUMPS-type cross-reference is used for queries by
"^DD",8925,8925,1301,1,7,"%D",2,0)
subject.
"^DD",8925,8925,1301,1,7,"DT")
2950928
"^DD",8925,8925,1301,1,8,0)
8925^ASVC1^MUMPS
"^DD",8925,8925,1301,1,8,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,14)),U,4),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ASVC",+$P(^TIU(8925,+DA,14),U,4),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,8,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,14)),U,4),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ASVC",+$P(^TIU(8925,+DA,14),U,4),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,8,"%D",0)
^^2^2^2960710^^
"^DD",8925,8925,1301,1,8,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups SERVICE, 
"^DD",8925,8925,1301,1,8,"%D",2,0)
document type, status, and date 
"^DD",8925,8925,1301,1,8,"DT")
2941122
"^DD",8925,8925,1301,1,9,0)
8925^APRB1^MUMPS
"^DD",8925,8925,1301,1,9,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,5),+$O(^TIU(8925.9,"B",+DA,0)) D APRBS^TIUDD(+$G(^TIU(8925,+DA,0)),+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-+X),DA)
"^DD",8925,8925,1301,1,9,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,5),+$O(^TIU(8925.9,"B",+DA,0)) D APRBK^TIUDD(+$G(^TIU(8925,+DA,0)),+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-+X),DA)
"^DD",8925,8925,1301,1,9,"%D",0)
^^3^3^2950928^^
"^DD",8925,8925,1301,1,9,"%D",1,0)
This MUMPS-type, multi-field cross-reference by Problem, Document type,
"^DD",8925,8925,1301,1,9,"%D",2,0)
Status, and Inverse Reference Date/time is used to facilitate query by
"^DD",8925,8925,1301,1,9,"%D",3,0)
problem.
"^DD",8925,8925,1301,1,9,"DT")
2950928
"^DD",8925,8925,1301,1,10,0)
8925^AVSIT1^MUMPS
"^DD",8925,8925,1301,1,10,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,3),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"AVSIT",+$P(^TIU(8925,+DA,0),U,3),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),DA)=""
"^DD",8925,8925,1301,1,10,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,3),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"AVSIT",+$P(^TIU(8925,+DA,0),U,3),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),DA)
"^DD",8925,8925,1301,1,10,"%D",0)
^^2^2^2951207^^^^
"^DD",8925,8925,1301,1,10,"%D",1,0)
This MUMPS-type, multi-field cross-reference by VISIT, DOCUMENT TYPE,
"^DD",8925,8925,1301,1,10,"%D",2,0)
STATUS, and INVERSE ENTRY/DICTATION DATE facilitates look-ups by visit.
"^DD",8925,8925,1301,1,10,"DT")
2950925
"^DD",8925,8925,1301,1,11,0)
8925^ADCPT1^MUMPS
"^DD",8925,8925,1301,1,11,1)
I +$P($G(^TIU(8925,+DA,0)),U,4),+$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ADCPT",+$P(^TIU(8925,+DA,0),U,2),+$P(^TIU(8925,+DA,0),U,4),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),DA)=""
"^DD",8925,8925,1301,1,11,2)
I +$P($G(^TIU(8925,+DA,0)),U,4),+$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ADCPT",+$P(^TIU(8925,+DA,0),U,2),+$P(^TIU(8925,+DA,0),U,4),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),DA)
"^DD",8925,8925,1301,1,11,"%D",0)
^^3^3^2950925^
"^DD",8925,8925,1301,1,11,"%D",1,0)
This MUMPS-type, multi-field cross-reference by PATIENT, DOCUMENT CLASS,
"^DD",8925,8925,1301,1,11,"%D",2,0)
STATUS, and INVERSE REFERENCE DATE facilitates look-ups by PATIENT AND
"^DD",8925,8925,1301,1,11,"%D",3,0)
DOCUMENT CLASS (e.g., all SIGNED Violence Postings for patient John Doe).
"^DD",8925,8925,1301,1,11,"DT")
2950925
"^DD",8925,8925,1301,1,12,0)
8925^D
"^DD",8925,8925,1301,1,12,1)
S ^TIU(8925,"D",$E(X,1,30),DA)=""
"^DD",8925,8925,1301,1,12,2)
K ^TIU(8925,"D",$E(X,1,30),DA)
"^DD",8925,8925,1301,1,12,"%D",0)
^^2^2^2951215^
"^DD",8925,8925,1301,1,12,"%D",1,0)
This REGULAR FileMan Cross-reference by Reference Date/time is used
"^DD",8925,8925,1301,1,12,"%D",2,0)
for both look-ups and sorts.
"^DD",8925,8925,1301,1,12,"DT")
2951215
"^DD",8925,8925,1301,1,13,0)
8925^APTCL1^MUMPS
"^DD",8925,8925,1301,1,13,1)
I +$P(^TIU(8925,+DA,0),U),+$P($G(^TIU(8925,+DA,0)),U,2) S ^TIU(8925,"APTCL",+$P(^TIU(8925,+DA,0),U,2),+$$CLINDOC^TIULC1(+$P(^TIU(8925,+DA,0),U),+DA),(9999999-X),DA)=""
"^DD",8925,8925,1301,1,13,2)
I +$P(^TIU(8925,+DA,0),U),+$P($G(^TIU(8925,+DA,0)),U,2) K ^TIU(8925,"APTCL",+$P(^TIU(8925,+DA,0),U,2),+$$CLINDOC^TIULC1(+$P(^TIU(8925,+DA,0),U),+DA),(9999999-X),DA)
"^DD",8925,8925,1301,1,13,"%D",0)
^^2^2^2960823^^^^
"^DD",8925,8925,1301,1,13,"%D",1,0)
This MUMPS-type, multi-field cross-reference by PATIENT, CLINICAL DOCUMENT
"^DD",8925,8925,1301,1,13,"%D",2,0)
CLASS, and INVERSE REFERENCE DATE facilitates look-ups by patient.
"^DD",8925,8925,1301,1,13,"DT")
2960823
"^DD",8925,8925,1301,1,14,0)
8925^APTCL381^MUMPS
"^DD",8925,8925,1301,1,14,1)
I +$P(^TIU(8925,+DA,0),U),+$P($G(^TIU(8925,+DA,0)),U,2) S ^TIU(8925,"APTCL",+$P(^TIU(8925,+DA,0),U,2),38,(9999999-X),DA)=""
"^DD",8925,8925,1301,1,14,2)
I +$P(^TIU(8925,+DA,0),U),+$P($G(^TIU(8925,+DA,0)),U,2) K ^TIU(8925,"APTCL",+$P(^TIU(8925,+DA,0),U,2),38,(9999999-X),DA)
"^DD",8925,8925,1301,1,14,"%D",0)
^^2^2^2960506^
"^DD",8925,8925,1301,1,14,"%D",1,0)
This MUMPS-type, multi-field cross-reference by PATIENT, ROOT CLASS, and
"^DD",8925,8925,1301,1,14,"%D",2,0)
INVERSE REFERENCE DATE facilitates look-ups by patient.
"^DD",8925,8925,1301,1,14,"DT")
2960506
"^DD",8925,8925,1301,1,15,0)
8925^ALOC1^MUMPS
"^DD",8925,8925,1301,1,15,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,5),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ALOC",+$P(^TIU(8925,+DA,12),U,5),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,15,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,5),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ALOC",+$P(^TIU(8925,+DA,12),U,5),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,15,"%D",0)
^^2^2^2960710^^^
"^DD",8925,8925,1301,1,15,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups
"^DD",8925,8925,1301,1,15,"%D",2,0)
LOCATION, document type, status, and date
"^DD",8925,8925,1301,1,15,"DT")
2960710
"^DD",8925,8925,1301,1,16,0)
8925^ACLPT03^MUMPS
"^DD",8925,8925,1301,1,16,1)
D SACLPT^TIUDD0(1301,X)
"^DD",8925,8925,1301,1,16,2)
D KACLPT^TIUDD01(1301,X)
"^DD",8925,8925,1301,1,16,"%D",0)
^^3^3^2970617^
"^DD",8925,8925,1301,1,16,"%D",1,0)
This multi-field, MUMPS-type cross-reference on CLASS, PATIENT, INVERSE
"^DD",8925,8925,1301,1,16,"%D",2,0)
REFERENCE DATE/TIME, and RECORD # is designed to support rapid queries by
"^DD",8925,8925,1301,1,16,"%D",3,0)
patient.
"^DD",8925,8925,1301,1,16,"DT")
2970617
"^DD",8925,8925,1301,1,17,0)
8925^ACLAU01^MUMPS
"^DD",8925,8925,1301,1,17,1)
D SACLAU^TIUDD0(1301,X),SACLAU1^TIUDD0(1301,X)
"^DD",8925,8925,1301,1,17,2)
D KACLAU^TIUDD01(1301,X),KACLAU1^TIUDD01(1301,X)
"^DD",8925,8925,1301,1,17,"%D",0)
^^4^4^2970617^
"^DD",8925,8925,1301,1,17,"%D",1,0)
This multi-field, MUMPS-type cross-reference on CLASS, AUTHOR (or ENTERED
"^DD",8925,8925,1301,1,17,"%D",2,0)
BY), PATIENT, INVERSE REFERENCE DATE/TIME, and RECORD # is designed to
"^DD",8925,8925,1301,1,17,"%D",3,0)
facilitate rapid access to the current users unsigned notes about a
"^DD",8925,8925,1301,1,17,"%D",4,0)
patient.
"^DD",8925,8925,1301,1,17,"DT")
2970617
"^DD",8925,8925,1301,1,18,0)
8925^ACLEC02^MUMPS
"^DD",8925,8925,1301,1,18,1)
D SACLEC^TIUDD0(1301,X)
"^DD",8925,8925,1301,1,18,2)
D KACLEC^TIUDD01(1301,X)
"^DD",8925,8925,1301,1,18,"%D",0)
^^3^3^2970617^
"^DD",8925,8925,1301,1,18,"%D",1,0)
This multi-field, MUMPS-type Cross-reference on CLASS, EXPECTED COSIGNER,
"^DD",8925,8925,1301,1,18,"%D",2,0)
PATIENT, INVERSE REFERENCE DATE/TIME, and RECORD # is useful for finding
"^DD",8925,8925,1301,1,18,"%D",3,0)
the uncosigned notes by the current user for a given patient.
"^DD",8925,8925,1301,1,18,"DT")
2970617
"^DD",8925,8925,1301,1,19,0)
8925^ACLSB02^MUMPS
"^DD",8925,8925,1301,1,19,1)
D SACLSB^TIUDD0(1301,X)
"^DD",8925,8925,1301,1,19,2)
D KACLSB^TIUDD01(1301,X)
"^DD",8925,8925,1301,1,19,"%D",0)
^^3^3^2970617^
"^DD",8925,8925,1301,1,19,"%D",1,0)
This cross-reference by CLASS, SIGNED BY, PATIENT, INVERSE REFERENCE
"^DD",8925,8925,1301,1,19,"%D",2,0)
DATE/TIME, and RECORD # will facilitate finding records signed by a given
"^DD",8925,8925,1301,1,19,"%D",3,0)
user about the current patient.
"^DD",8925,8925,1301,1,19,"DT")
2970617
"^DD",8925,8925,1301,3)
This is the date (and time) by which the document will be referenced.
"^DD",8925,8925,1301,21,0)
^^6^6^2981103^^^^
"^DD",8925,8925,1301,21,1,0)
This is the Date (and time) by which the clinician will reference the 
"^DD",8925,8925,1301,21,2,0)
document.  For Progress Notes, this will likely be the date of the 
"^DD",8925,8925,1301,21,3,0)
provider's encounter with the patient.  For documents which have been 
"^DD",8925,8925,1301,21,4,0)
dictated, and transcribed (e.g., discharge summaries), it will correspond to 
"^DD",8925,8925,1301,21,5,0)
the dictation date of the record.  In all cases, this is the date by which 
"^DD",8925,8925,1301,21,6,0)
the document will be referenced and sorted.
"^DD",8925,8925,1301,"DT")
3030418
"^DD",8925.4,8925.4,.05,0)
BUFFER FILE POINTER^*P8925.2'^TIU(8925.2,^0;5^S DIC("S")="I $D(^TIU(8925.2,+Y,0))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",8925.4,8925.4,.05,3)
Enter the record # in the TIU UPLOAD BUFFER FILE (#8925.2)
"^DD",8925.4,8925.4,.05,12)
The buffer file record must exist at creation
"^DD",8925.4,8925.4,.05,12.1)
S DIC("S")="I $D(^TIU(8925.2,+Y,0))"
"^DD",8925.4,8925.4,.05,21,0)
^^3^3^3030418^
"^DD",8925.4,8925.4,.05,21,1,0)
 
"^DD",8925.4,8925.4,.05,21,2,0)
This is the record number in file #8925.2 (TIU UPLOAD BUFFER FILE) where
"^DD",8925.4,8925.4,.05,21,3,0)
the erroneous record(s) reside(s).
"^DD",8925.4,8925.4,.05,"DT")
2931215
"^DD",8925.4,8925.4,.09,0)
DIVISION^P4'^DIC(4,^0;9^Q
"^DD",8925.4,8925.4,.09,3)
Enter the institution associated with the upload filing event.
"^DD",8925.4,8925.4,.09,21,0)
^^4^4^3010709^
"^DD",8925.4,8925.4,.09,21,1,0)
This field contains the institution associated with the upload filing
"^DD",8925.4,8925.4,.09,21,2,0)
event. For TIU DOCUMENT file (#8925) entries, is extracted from the
"^DD",8925.4,8925.4,.09,21,3,0)
document's hospital location if known; otherwise it is extracted from 
"^DD",8925.4,8925.4,.09,21,4,0)
the user's log-on division.
"^DD",8925.4,8925.4,.09,"DT")
3010709
"^DD",8925.8,8925.8,0)
FIELD^^99^7
"^DD",8925.8,8925.8,0,"DT")
2950927
"^DD",8925.8,8925.8,0,"IX","AM",8925.8,99)

"^DD",8925.8,8925.8,0,"IX","AM1",8925.8,.03)

"^DD",8925.8,8925.8,0,"IX","B",8925.8,.01)

"^DD",8925.8,8925.8,0,"IX","C",8925.8,.02)

"^DD",8925.8,8925.8,0,"NM","TIU SEARCH CATEGORIES")

"^DD",8925.8,8925.8,0,"VRPK")
TEXT INTEGRATION UTILITIES
"^DD",8925.8,8925.8,.01,0)
SEARCH CATEGORY^RFO^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",8925.8,8925.8,.01,1,0)
^.1
"^DD",8925.8,8925.8,.01,1,1,0)
8925.8^B
"^DD",8925.8,8925.8,.01,1,1,1)
S ^TIU(8925.8,"B",$E(X,1,30),DA)=""
"^DD",8925.8,8925.8,.01,1,1,2)
K ^TIU(8925.8,"B",$E(X,1,30),DA)
"^DD",8925.8,8925.8,.01,2)
S Y(0)=Y S Y=$$MIXED^TIULS(Y)
"^DD",8925.8,8925.8,.01,2.1)
S Y=$$MIXED^TIULS(Y)
"^DD",8925.8,8925.8,.01,3)
Answer must be 3-30 characters in length.
"^DD",8925.8,8925.8,.01,21,0)
^^4^4^2950616^^
"^DD",8925.8,8925.8,.01,21,1,0)
These are the allowable categories by which you may query for documents 
"^DD",8925.8,8925.8,.01,21,2,0)
(e.g., PATIENT, AUTHOR, EXPECTED COSIGNER, TREATING SPECIALTY, HOSPITAL 
"^DD",8925.8,8925.8,.01,21,3,0)
LOCATION, SUBJECT, SERVICE, PROBLEM, PATIENT STATUS (i.e., 
"^DD",8925.8,8925.8,.01,21,4,0)
Inpatient/Outpatient), etc.).
"^DD",8925.8,8925.8,.01,"DT")
2950616
"^DD",8925.8,8925.8,.02,0)
CROSS-REFERENCE^FX^^0;2^K:$L(X)>10!($L(X)<1)!('$D(^TIU(8925,X))) X
"^DD",8925.8,8925.8,.02,1,0)
^.1
"^DD",8925.8,8925.8,.02,1,1,0)
8925.8^C
"^DD",8925.8,8925.8,.02,1,1,1)
S ^TIU(8925.8,"C",$E(X,1,30),DA)=""
"^DD",8925.8,8925.8,.02,1,1,2)
K ^TIU(8925.8,"C",$E(X,1,30),DA)
"^DD",8925.8,8925.8,.02,1,1,"%D",0)
^^2^2^2950927^
"^DD",8925.8,8925.8,.02,1,1,"%D",1,0)
This REGULAR FileMan cross-reference is used to map SEARCH CATEGORY to
"^DD",8925.8,8925.8,.02,1,1,"%D",2,0)
CROSS REFERENCE.
"^DD",8925.8,8925.8,.02,1,1,"DT")
2950927
"^DD",8925.8,8925.8,.02,3)
Answer must correspond to a valid x-ref in file 8925.
"^DD",8925.8,8925.8,.02,21,0)
^^9^9^2950616^^
"^DD",8925.8,8925.8,.02,21,1,0)
This is the cross-reference which will be searched to identify the 
"^DD",8925.8,8925.8,.02,21,2,0)
corrresponding documents.  It must have the structure:
"^DD",8925.8,8925.8,.02,21,3,0)

"^DD",8925.8,8925.8,.02,21,4,0)
^TIU(8925,"<X-REF NAME>",ENTITY,DOCTYP,STATUS,INVDATE,IEN)=""
"^DD",8925.8,8925.8,.02,21,6,0)
where ENTITY is the object of the search, DOCTYPE is the .01 field
"^DD",8925.8,8925.8,.02,21,7,0)
value of the record in 8925, STATUS is the value of the .05 field in
"^DD",8925.8,8925.8,.02,21,8,0)
8925, and inverse date is the inverted reference date (field 1301 in
"^DD",8925.8,8925.8,.02,21,9,0)
file 8925), computed as 9999999-REFDATE.
"^DD",8925.8,8925.8,.02,"DT")
2950927
"^DD",8925.8,8925.8,.03,0)
DISPLAY NAME^F^^0;3^K:$L(X)>30!($L(X)<3) X
"^DD",8925.8,8925.8,.03,1,0)
^.1
"^DD",8925.8,8925.8,.03,1,1,0)
8925.8^AM1^MUMPS
"^DD",8925.8,8925.8,.03,1,1,1)
D REDO^TIUDD8
"^DD",8925.8,8925.8,.03,1,1,2)
D REDO^TIUDD8
"^DD",8925.8,8925.8,.03,1,1,"%D",0)
^^2^2^2950927^
"^DD",8925.8,8925.8,.03,1,1,"%D",1,0)
This MUMPS-type cross-reference is used to update the timestamp on the
"^DD",8925.8,8925.8,.03,1,1,"%D",2,0)
search category selection menu when a DISPLAY NAME changes.
"^DD",8925.8,8925.8,.03,1,1,"DT")
2950927
"^DD",8925.8,8925.8,.03,3)
Answer must be 3-30 characters in length.
"^DD",8925.8,8925.8,.03,21,0)
^^2^2^2950616^
"^DD",8925.8,8925.8,.03,21,1,0)
This is the name of the Search Category as it will be displayed to the
"^DD",8925.8,8925.8,.03,21,2,0)
user on selection.
"^DD",8925.8,8925.8,.03,"DT")
2950927
"^DD",8925.8,8925.8,.04,0)
ASSOCIATED FILE^P1'^DIC(^0;4^Q
"^DD",8925.8,8925.8,.04,3)
Select the file to which the category will refer.
"^DD",8925.8,8925.8,.04,21,0)
^^3^3^2950927^
"^DD",8925.8,8925.8,.04,21,1,0)
This is the file on which a look-up will occur in the event that a
"^DD",8925.8,8925.8,.04,21,2,0)
category is selected (e.g., for category PATIENT, the file should be 2,
"^DD",8925.8,8925.8,.04,21,3,0)
and for category AUTHOR, the file should be 200).
"^DD",8925.8,8925.8,.04,"DT")
2950927
"^DD",8925.8,8925.8,1,0)
SCREEN^K^^1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8925.8,8925.8,1,3)
This is Standard MUMPS code.
"^DD",8925.8,8925.8,1,9)
@
"^DD",8925.8,8925.8,1,21,0)
^^2^2^2950927^
"^DD",8925.8,8925.8,1,21,1,0)
This is MUMPS code, which sets the special variable DIC("S"), prior to
"^DD",8925.8,8925.8,1,21,2,0)
invoking the look-up on the FILE identified with the category.
"^DD",8925.8,8925.8,1,"DT")
2950927
"^DD",8925.8,8925.8,2,0)
LOOK-UP CODE^K^^2;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8925.8,8925.8,2,3)
This is Standard MUMPS code.
"^DD",8925.8,8925.8,2,9)
@
"^DD",8925.8,8925.8,2,21,0)
^^2^2^2950927^
"^DD",8925.8,8925.8,2,21,1,0)
This code is invoked, if defined, and should behave like a call to ^DIC,
"^DD",8925.8,8925.8,2,21,2,0)
setting the variable Y as IFN^VALUE.
"^DD",8925.8,8925.8,2,"DT")
2950927
"^DD",8925.8,8925.8,99,0)
TIMESTAMP^F^^99;1^K:$L(X)>15!($L(X)<1) X
"^DD",8925.8,8925.8,99,1,0)
^.1
"^DD",8925.8,8925.8,99,1,1,0)
8925.8^AM^MUMPS
"^DD",8925.8,8925.8,99,1,1,1)
D SET^TIUDD8
"^DD",8925.8,8925.8,99,1,1,2)
D KILL^TIUDD8
"^DD",8925.8,8925.8,99,1,1,"%D",0)
^^2^2^2950630^^
"^DD",8925.8,8925.8,99,1,1,"%D",1,0)
This cross-reference invokes menu compilation in ^XUTL("XQORM",
"^DD",8925.8,8925.8,99,1,1,"%D",2,0)
DA;TIU(8925.8, when the TIMESTAMP field is modified.
"^DD",8925.8,8925.8,99,1,1,"DT")
2950630
"^DD",8925.8,8925.8,99,3)
Enter the $HOROLOG date/time of a change.
"^DD",8925.8,8925.8,99,21,0)
^^2^2^2950616^
"^DD",8925.8,8925.8,99,21,1,0)
This field stores the $HOROLOG-formatted date/time for a change to a
"^DD",8925.8,8925.8,99,21,2,0)
Search Categories entry.
"^DD",8925.8,8925.8,99,"DT")
2950616
"^DIC",8925.8,8925.8,0)
TIU SEARCH CATEGORIES^8925.8
"^DIC",8925.8,8925.8,0,"GL")
^TIU(8925.8,
"^DIC",8925.8,8925.8,"%D",0)
^^2^2^2950630^
"^DIC",8925.8,8925.8,"%D",1,0)
This file stores parameters which modify the processing requirements of
"^DIC",8925.8,8925.8,"%D",2,0)
individual document types, and their decendents.
"^DIC",8925.8,"B","TIU SEARCH CATEGORIES",8925.8)

**END**
**END**
