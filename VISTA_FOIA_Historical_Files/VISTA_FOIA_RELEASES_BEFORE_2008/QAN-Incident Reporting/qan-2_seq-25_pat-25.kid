Released QAN*2*25 SEQ #25
Extracted from mail message
**KIDS**:QAN*2.0*25^

**INSTALL NAME**
QAN*2.0*25
"BLD",764,0)
QAN*2.0*25^INCIDENT REPORTING^0^^y
"BLD",764,4,0)
^9.64PA^^
"BLD",764,"ABPKG")
n
"BLD",764,"KRN",0)
^9.67PA^19^18
"BLD",764,"KRN",.4,0)
.4
"BLD",764,"KRN",.401,0)
.401
"BLD",764,"KRN",.402,0)
.402
"BLD",764,"KRN",.403,0)
.403
"BLD",764,"KRN",.5,0)
.5
"BLD",764,"KRN",.84,0)
.84
"BLD",764,"KRN",3.6,0)
3.6
"BLD",764,"KRN",3.8,0)
3.8
"BLD",764,"KRN",9.2,0)
9.2
"BLD",764,"KRN",9.8,0)
9.8
"BLD",764,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",764,"KRN",9.8,"NM",1,0)
QANEWS0^^0^B5930291
"BLD",764,"KRN",9.8,"NM",2,0)
QANQTOT^^0^B23692118
"BLD",764,"KRN",9.8,"NM","B","QANEWS0",1)

"BLD",764,"KRN",9.8,"NM","B","QANQTOT",2)

"BLD",764,"KRN",19,0)
19
"BLD",764,"KRN",19.1,0)
19.1
"BLD",764,"KRN",101,0)
101
"BLD",764,"KRN",409.61,0)
409.61
"BLD",764,"KRN",771,0)
771
"BLD",764,"KRN",869.2,0)
869.2
"BLD",764,"KRN",870,0)
870
"BLD",764,"KRN",8994,0)
8994
"BLD",764,"KRN","B",.4,.4)

"BLD",764,"KRN","B",.401,.401)

"BLD",764,"KRN","B",.402,.402)

"BLD",764,"KRN","B",.403,.403)

"BLD",764,"KRN","B",.5,.5)

"BLD",764,"KRN","B",.84,.84)

"BLD",764,"KRN","B",3.6,3.6)

"BLD",764,"KRN","B",3.8,3.8)

"BLD",764,"KRN","B",9.2,9.2)

"BLD",764,"KRN","B",9.8,9.8)

"BLD",764,"KRN","B",19,19)

"BLD",764,"KRN","B",19.1,19.1)

"BLD",764,"KRN","B",101,101)

"BLD",764,"KRN","B",409.61,409.61)

"BLD",764,"KRN","B",771,771)

"BLD",764,"KRN","B",869.2,869.2)

"BLD",764,"KRN","B",870,870)

"BLD",764,"KRN","B",8994,8994)

"BLD",764,"QUES",0)
^9.62^^
"BLD",764,"REQB",0)
^9.611^^
"PKG",371,-1)
1^1
"PKG",371,0)
INCIDENT REPORTING^QAN^This package is designed to track a hospital incident.
"PKG",371,22,0)
^9.49I^1^1
"PKG",371,22,1,0)
2.0^2921015^2950914
"PKG",371,22,1,"PAH",1,0)
25
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","QANEWS0")
0^1^B5930291
"RTN","QANEWS0",1,0)
QANEWS0 ;HISC/GJC-GENERATE `EARLY WARNING SYSTEM' BULLETINS ;7/8/91  11:02
"RTN","QANEWS0",2,0)
 ;;2.0;Incident Reporting;**25**;08/07/1992
"RTN","QANEWS0",3,0)
EN1 ; *** MANUAL ENTRY POINT
"RTN","QANEWS0",4,0)
 S QANTASK=0
"RTN","QANEWS0",5,0)
 G EN
"RTN","QANEWS0",6,0)
EN2 ; *** TASKED ENTRY POINT
"RTN","QANEWS0",7,0)
 S QANTASK=1
"RTN","QANEWS0",8,0)
EN S QANZERO=$S($D(^QA(740,1,0))#2:^(0),1:0) I +QANZERO'>0 S QANERROR=1 D ERROR G EXIT
"RTN","QANEWS0",9,0)
 S QANSITE=$S($D(^DIC(4,+QANZERO,0))#2:$P(^(0),"^"),1:"") I QANSITE="" S QANERROR=2 D ERROR G EXIT
"RTN","QANEWS0",10,0)
 S QANSTNO=$S($D(^DIC(4,+QANZERO,99))#2:$P(^(99),"^"),1:"") I QANSTNO="" S QANERROR=3 D ERROR G EXIT
"RTN","QANEWS0",11,0)
 S QANSERV=$P(QANZERO,"^",2) I QANSERV="" S QANERROR=4 D ERROR G EXIT
"RTN","QANEWS0",12,0)
 S QANDOM=$P(QANZERO,"^",3) I QANDOM="" S QANERROR=5 D ERROR G EXIT
"RTN","QANEWS0",13,0)
 S QA=+$O(^DIC(4.2,"B",QANDOM,0)) I $S('$D(^DIC(4.2,QA,0))#2:1,$P(^(0),"^")'=QANDOM:1,1:0) S ERROR=6 D ERROR G EXIT
"RTN","QANEWS0",14,0)
 D:QANTASK MONTH,EN2^QANEWS
"RTN","QANEWS0",15,0)
 I 'QANTASK W !!,"Select the reporting period:" D EN1^QANEWS G:QAQQUIT EXIT
"RTN","QANEWS0",16,0)
 W:'QANTASK !!,"Finished."
"RTN","QANEWS0",17,0)
EXIT ;
"RTN","QANEWS0",18,0)
 K QA,QAN,QAN1,QANIN,QANOUT,ERROR,QANCLIN,QANCREV,QAND0,QAND1,QANDATE
"RTN","QANEWS0",19,0)
 K QANDOM,QANEWS,QANFIND,QANLEVL,QANQUIT,QANRFPR,QANSCRN,QANSERV,QANSITE
"RTN","QANEWS0",20,0)
 K QANERROR,QANTASK,QANSTNO,QANTEMP,QANVAL,QANZERO,^UTILITY($J)
"RTN","QANEWS0",21,0)
 D K^QAQDATE,KILL^XM,KILL^QAQDATE
"RTN","QANEWS0",22,0)
 Q
"RTN","QANEWS0",23,0)
ERROR ;
"RTN","QANEWS0",24,0)
 W *7,!!,"*** ",$P($T(ERR+QANERROR),";;",2)," ***",!!,*7
"RTN","QANEWS0",25,0)
 Q
"RTN","QANEWS0",26,0)
MONTH ;
"RTN","QANEWS0",27,0)
 S QANSY=$E(DT,1,3),QANSM=$E(DT,4,5)
"RTN","QANEWS0",28,0)
 I QANSM>1 S QANSM=QANSM-1
"RTN","QANEWS0",29,0)
 E  S QANSM=12,QANSY=QANSY-1
"RTN","QANEWS0",30,0)
 S QANSM=$E("0",1,2-$L(QANSM))_QANSM
"RTN","QANEWS0",31,0)
 S QAQNBEG=QANSY_QANSM_"01",Y=1700+QANSY,Y=(Y#4=0)&((Y#100)!(Y#400=0))
"RTN","QANEWS0",32,0)
 S QAQNEND=QANSY_QANSM_$P("31^28^31^30^31^30^31^31^30^31^30^31",U,+QANSM)+$S(+QANSM=2:Y,1:0)
"RTN","QANEWS0",33,0)
 K QANSY,QANSM
"RTN","QANEWS0",34,0)
 Q
"RTN","QANEWS0",35,0)
ERR ;;ERROR MESSAGES: REASONS EWS BULLETIN COULD NOT BE SENT
"RTN","QANEWS0",36,0)
 ;;SITE NOT FOUND IN QA SITE PARAMETERS FILE
"RTN","QANEWS0",37,0)
 ;;SITE NOT FOUND IN INSTITUTION FILE
"RTN","QANEWS0",38,0)
 ;;SITE NUMBER NOT FOUND IN INSTITUTION FILE
"RTN","QANEWS0",39,0)
 ;;EWS MAIL GROUP/SERVER NOT FOUND IN QA SITE PARAMETERS FILE
"RTN","QANEWS0",40,0)
 ;;EWS DOMAIN NOT FOUND IN QA SITE PARAMETERS FILE
"RTN","QANEWS0",41,0)
 ;;EWS DOMAIN NOT FOUND IN DOMAIN FILE
"RTN","QANQTOT")
0^2^B23692118
"RTN","QANQTOT",1,0)
QANQTOT ;GJC/HISC-QUARTERLY REPORT OF INVESTIGATIONS (REGIONAL) ;9/3/93  12:17
"RTN","QANQTOT",2,0)
 ;;2.0;Incident Reporting;**21,25**;08/07/1992
"RTN","QANQTOT",3,0)
 ;
"RTN","QANQTOT",4,0)
 I $G(DUZ)']"" D  Q
"RTN","QANQTOT",5,0)
 . W !!?12,*7,"This option CANNOT properly identify you, exiting."
"RTN","QANQTOT",6,0)
 . D EXIT
"RTN","QANQTOT",7,0)
 S (QANMSSG,QANXIT,QAQQUIT)=0
"RTN","QANQTOT",8,0)
 D QUART I QAQQUIT D EXIT Q
"RTN","QANQTOT",9,0)
 D CHECK ;Data for quarter exists OR global lock times out, exiting!
"RTN","QANQTOT",10,0)
 I QANXIT D EXIT Q
"RTN","QANQTOT",11,0)
 S QANBEG=QUBEG(QU)-.0000001,QANEND=QUEND(QU)_".9999999"
"RTN","QANQTOT",12,0)
 S QANDATE=QUBEG(QU),QANTODAY=DT
"RTN","QANQTOT",13,0)
 F QANDT=QANBEG:0 S QANDT=$O(^QA(742.4,"BDT",QANDT)) Q:(QANDT>QANEND)!(QANDT'>0)  D
"RTN","QANQTOT",14,0)
 . F QANIEN=0:0 S QANIEN=$O(^QA(742.4,"BDT",QANDT,QANIEN)) Q:QANIEN'>0  D:'$D(^QA(742.4,"ACS",2,QANIEN)) PATFND
"RTN","QANQTOT",15,0)
 I '$D(^UTILITY($J,"QAN IR/PAT")) D  Q
"RTN","QANQTOT",16,0)
 . W !!,*7,"No data found for the ",$S($G(QAQ2HED)]"":QAQ2HED,1:QUART),", exiting.",*7,!!
"RTN","QANQTOT",17,0)
 . D EXIT
"RTN","QANQTOT",18,0)
 F QANIEN=0:0 S QANIEN=$O(^UTILITY($J,"QAN IR/PAT",QANIEN)) Q:QANIEN'>0  D
"RTN","QANQTOT",19,0)
 . F QANPT=0:0 S QANPT=$O(^UTILITY($J,"QAN IR/PAT",QANIEN,QANPT)) Q:QANPT'>0  D TAB
"RTN","QANQTOT",20,0)
 D:'QANMSSG WAIT^DICD D ^QANQTTL ;Output of results.
"RTN","QANQTOT",21,0)
 D ^QANQSDT ;Generate a report based on the quarters data.
"RTN","QANQTOT",22,0)
EXIT ;Kill and quit
"RTN","QANQTOT",23,0)
 D KILL^XUSCLEAN K ^UTILITY($J,"QAN IR/PAT")
"RTN","QANQTOT",24,0)
 Q
"RTN","QANQTOT",25,0)
CHECK ;Check for existing quarterly data.
"RTN","QANQTOT",26,0)
 Q:'$D(^QA(742.6,"QDATE",QUBEG(QU)))  ;no data
"RTN","QANQTOT",27,0)
 N Y S Y=QUBEG(QU) X ^DD("DD")
"RTN","QANQTOT",28,0)
 W !?5,"Quarterly Summary Data exists for the quarter beginning: ",Y
"RTN","QANQTOT",29,0)
 W !?5,"Do you wish to delete this quarters data?",*7 K DIR S DIR(0)="Y"
"RTN","QANQTOT",30,0)
 S DIR("?",1)="Enter ""Y"" to delete existing data AND calculate new data,",DIR("?")="Enter ""N"" to exit without updating data." D ^DIR K DIR
"RTN","QANQTOT",31,0)
 I 'Y S QANXIT=1 Q
"RTN","QANQTOT",32,0)
 S QANMSSG=1 D WAIT^DICD
"RTN","QANQTOT",33,0)
 L +^QA(742.6):5 ;Lock our global.
"RTN","QANQTOT",34,0)
 I '$T S QANXIT=1 W !!,*7,"Another person is editing this file, try again later.",!!,*7 L -^QA(742.6) Q
"RTN","QANQTOT",35,0)
 K DIK S DIK="^QA(742.6," F DA=0:0 S DA=$O(^QA(742.6,"QDATE",QUBEG(QU),DA)) Q:DA'>0  D ^DIK
"RTN","QANQTOT",36,0)
 L -^QA(742.6) ;Unlock after update.
"RTN","QANQTOT",37,0)
 Q
"RTN","QANQTOT",38,0)
PATFND ;Find the proper patient's ien for the associated incident.
"RTN","QANQTOT",39,0)
 ;This subroutine is not referenced if $D(^QA(742.4,"ACS",2,QANIEN))
"RTN","QANQTOT",40,0)
 ;this indicates a deleted incident record.  Quit if the Bene Rpt flag
"RTN","QANQTOT",41,0)
 ;is not set to '1'.  Do not set utility if the patient record status
"RTN","QANQTOT",42,0)
 ;is 'deleted'.  PTCH 21 8/12/93
"RTN","QANQTOT",43,0)
 S QAN7424=$G(^QA(742.4,QANIEN,0))  Q:QAN7424']""!(+$P(QAN7424,U,17)'>0)
"RTN","QANQTOT",44,0)
 F QANPT=0:0 S QANPT=$O(^QA(742,"BCS",QANIEN,QANPT)) Q:QANPT'>0  D
"RTN","QANQTOT",45,0)
 . S:'$D(^QA(742,"BPRS",-1,QANPT)) ^UTILITY($J,"QAN IR/PAT",QANIEN,QANPT)=""
"RTN","QANQTOT",46,0)
 Q
"RTN","QANQTOT",47,0)
QUART ;Choose the quarter and the year.
"RTN","QANQTOT",48,0)
 W !!,"Enter Quarter Period and FY you wish to end with",!
"RTN","QANQTOT",49,0)
ENTERQ ;Enter the Quarter in question.
"RTN","QANQTOT",50,0)
 R !,"Enter Quarter and Year: ",QUART:DTIME S:'$T QUART="^" I (QUART="^")!(QUART="") S QAQQUIT=1 Q
"RTN","QANQTOT",51,0)
 I (QUART'?1N1P2N)&(QUART'?1N1P4N) W:$E(QUART)'="?" " ??",*7 W !!,"Enter Quarter Period in this format: 2nd quarter 1988 would be 2-88, 2/88, 2 88",! G ENTERQ
"RTN","QANQTOT",52,0)
 I ($E(QUART)>4)!($E(QUART)<1) W " ??",*7,!!,"Enter Quarter 1 to 4 only",! G ENTERQ
"RTN","QANQTOT",53,0)
 S QU=$E(QUART),YR=$E(QUART,3,6) K %DT S X=YR D ^%DT S YR=$E(Y,1,3)
"RTN","QANQTOT",54,0)
 S QUBEG(1)=YR-1_1001,QUBEG(2)=YR_"0101",QUBEG(3)=YR_"0401",QUBEG(4)=YR_"0701",QUEND(1)=YR-1_1231,QUEND(2)=YR_"0331",QUEND(3)=YR_"0630",QUEND(4)=YR_"0930",QUQUA(1)="FIRST",QUQUA(2)="SECOND",QUQUA(3)="THIRD",QUQUA(4)="FOURTH"
"RTN","QANQTOT",55,0)
 S QAQNBEG=QUBEG(QU),QAQNEND=QUEND(QU),QAQ2HED=QUQUA(QU)_" QUARTER FY "_(1700+YR)
"RTN","QANQTOT",56,0)
 Q
"RTN","QANQTOT",57,0)
TAB ;Setting up the variables for tabulation.
"RTN","QANQTOT",58,0)
 S QAN742=$G(^QA(742,QANPT,0)) Q:QAN742']""
"RTN","QANQTOT",59,0)
 S QAN7424=$G(^QA(742.4,QANIEN,0)) Q:QAN7424']""
"RTN","QANQTOT",60,0)
 S QANMED=$P($P(QAN7424,U),"."),QANINCD=$P(QAN7424,U,2)
"RTN","QANQTOT",61,0)
 S QANINVST=$S(+$P(QAN7424,U,11)=2:1,1:0),QANDTH=+$P(QAN7424,U,14)
"RTN","QANQTOT",62,0)
 S QANALPV=+$P(QAN7424,U,16),QANSVLV=+$P(QAN742,U,10)
"RTN","QANQTOT",63,0)
 D PATTYPE I $D(^QA(742.1,"BUPPER","DEATH",QANINCD)),QANDTH D DTH
"RTN","QANQTOT",64,0)
 D INVNON
"RTN","QANQTOT",65,0)
 Q
"RTN","QANQTOT",66,0)
DTH ;For Death
"RTN","QANQTOT",67,0)
 S QANDEATH=+$S($D(^QA(742.14,QANDTH,0)):$P(^(0),U,2),1:"") Q:'QANDEATH
"RTN","QANQTOT",68,0)
 I $D(QANARRY("QAN D",QANINCD,QANPTTY,QANDTH,QANINVST)) S QANARRY("QAN D",QANINCD,QANPTTY,QANDTH,QANINVST)=QANARRY("QAN D",QANINCD,QANPTTY,QANDTH,QANINVST)+1
"RTN","QANQTOT",69,0)
 E  S QANARRY("QAN D",QANINCD,QANPTTY,QANDTH,QANINVST)=1
"RTN","QANQTOT",70,0)
 Q
"RTN","QANQTOT",71,0)
INVNON ;Invest/Non Invest
"RTN","QANQTOT",72,0)
 I $D(QANARRY(QANINCD,QANALPV,QANPTTY,QANINVST)) S QANARRY(QANINCD,QANALPV,QANPTTY,QANINVST)=QANARRY(QANINCD,QANALPV,QANPTTY,QANINVST)+1
"RTN","QANQTOT",73,0)
 E  S QANARRY(QANINCD,QANALPV,QANPTTY,QANINVST)=1
"RTN","QANQTOT",74,0)
 I $D(QANARRY(QANINCD,QANALPV,QANPTTY,QANINVST,QANSVLV)) S QANARRY(QANINCD,QANALPV,QANPTTY,QANINVST,QANSVLV)=QANARRY(QANINCD,QANALPV,QANPTTY,QANINVST,QANSVLV)+1
"RTN","QANQTOT",75,0)
 E  S QANARRY(QANINCD,QANALPV,QANPTTY,QANINVST,QANSVLV)=1
"RTN","QANQTOT",76,0)
 Q
"RTN","QANQTOT",77,0)
PATTYPE ;Finds the appropriate patient type.
"RTN","QANQTOT",78,0)
 S QANWD=$P(QAN742,U,6),QANPTTY=$S(+$P(QAN742,U,5)=1:"I",1:"O")
"RTN","QANQTOT",79,0)
 Q:QANWD']""
"RTN","QANQTOT",80,0)
 I $D(^SC(QANWD,42)) D
"RTN","QANQTOT",81,0)
 . S QANWD(1)=+$G(^SC(QANWD,42)) Q:QANWD(1)'>0
"RTN","QANQTOT",82,0)
 . S QANWD(2)=$P(^DIC(42,QANWD(1),0),U,3)
"RTN","QANQTOT",83,0)
 . S QANPTTY=$S(QANWD(2)="NH":"N",QANWD(2)="D":"D",1:"I")
"RTN","QANQTOT",84,0)
 Q
"VER")
8.0^21.0
**END**
**END**
