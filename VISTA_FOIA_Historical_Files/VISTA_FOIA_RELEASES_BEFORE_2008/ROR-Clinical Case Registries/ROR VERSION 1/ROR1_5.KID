KIDS Distribution saved on Feb 08, 2006@08:30:30
Clinical Case Registries v1.5
**KIDS**:ROR 1.5^

**INSTALL NAME**
ROR 1.5
"BLD",5068,0)
ROR 1.5^CLINICAL CASE REGISTRIES^0^3060208^y
"BLD",5068,1,0)
^^3^3^3060125^
"BLD",5068,1,1,0)
Clinical Case Registries (CCR) V1.5 package. 
"BLD",5068,1,2,0)
This build can be used both for updating the CCR V1.0
"BLD",5068,1,3,0)
and for a "virgin" installation of the package.
"BLD",5068,4,0)
^9.64PA^799.6^19
"BLD",5068,4,798,0)
798
"BLD",5068,4,798,222)
y^y^f^^^^n
"BLD",5068,4,798.1,0)
798.1
"BLD",5068,4,798.1,222)
y^y^f^^n^^y^o^n
"BLD",5068,4,798.1,224)
I $E($P($G(^ROR(798.1,Y,0)),"^"),1,2)="VA"
"BLD",5068,4,798.2,0)
798.2
"BLD",5068,4,798.2,222)
y^y^f^^n^^y^o^n
"BLD",5068,4,798.2,224)
I $E($P($G(^ROR(798.2,Y,0)),"^"),1,2)="VA"
"BLD",5068,4,798.3,0)
798.3
"BLD",5068,4,798.3,222)
y^y^f^^^^n
"BLD",5068,4,798.4,0)
798.4
"BLD",5068,4,798.4,222)
y^y^f^^^^n
"BLD",5068,4,798.6,0)
798.6
"BLD",5068,4,798.6,222)
y^y^f^^y^^y^o^n
"BLD",5068,4,798.7,0)
798.7
"BLD",5068,4,798.7,222)
y^y^f^^^^n
"BLD",5068,4,798.8,0)
798.8
"BLD",5068,4,798.8,222)
y^y^f^^^^n^^n
"BLD",5068,4,798.8,224)

"BLD",5068,4,798.9,0)
798.9
"BLD",5068,4,798.9,222)
y^y^f^^n^^y^o^n
"BLD",5068,4,798.9,224)
I $E($P($G(^ROR(798.9,Y,0)),"^"),1,2)="VA"
"BLD",5068,4,799.1,0)
799.1
"BLD",5068,4,799.1,222)
y^y^f^^^^n^^
"BLD",5068,4,799.1,224)

"BLD",5068,4,799.2,0)
799.2
"BLD",5068,4,799.2,222)
y^y^f^^y^^y^o^n
"BLD",5068,4,799.31,0)
799.31
"BLD",5068,4,799.31,222)
y^y^f^^n^^y^o^n
"BLD",5068,4,799.33,0)
799.33
"BLD",5068,4,799.33,222)
y^y^f^^n^^y^o^n
"BLD",5068,4,799.34,0)
799.34
"BLD",5068,4,799.34,222)
y^y^f^^n^^y^o^n
"BLD",5068,4,799.4,0)
799.4
"BLD",5068,4,799.4,222)
y^y^f^^^^n
"BLD",5068,4,799.49,0)
799.49
"BLD",5068,4,799.49,222)
y^y^f^^n^^y^o^n
"BLD",5068,4,799.51,0)
799.51
"BLD",5068,4,799.51,222)
y^y^f^^^^n^^
"BLD",5068,4,799.51,224)

"BLD",5068,4,799.53,0)
799.53
"BLD",5068,4,799.53,222)
y^y^f^^^^n^^
"BLD",5068,4,799.53,224)

"BLD",5068,4,799.6,0)
799.6
"BLD",5068,4,799.6,222)
y^y^f^^y^^y^m^n
"BLD",5068,4,799.6,224)
I $E($G(^RORDATA(799.6,Y,0)),1,7)["ROR-1.5"
"BLD",5068,4,"B",798,798)

"BLD",5068,4,"B",798.1,798.1)

"BLD",5068,4,"B",798.2,798.2)

"BLD",5068,4,"B",798.3,798.3)

"BLD",5068,4,"B",798.4,798.4)

"BLD",5068,4,"B",798.6,798.6)

"BLD",5068,4,"B",798.7,798.7)

"BLD",5068,4,"B",798.8,798.8)

"BLD",5068,4,"B",798.9,798.9)

"BLD",5068,4,"B",799.1,799.1)

"BLD",5068,4,"B",799.2,799.2)

"BLD",5068,4,"B",799.31,799.31)

"BLD",5068,4,"B",799.33,799.33)

"BLD",5068,4,"B",799.34,799.34)

"BLD",5068,4,"B",799.4,799.4)

"BLD",5068,4,"B",799.49,799.49)

"BLD",5068,4,"B",799.51,799.51)

"BLD",5068,4,"B",799.53,799.53)

"BLD",5068,4,"B",799.6,799.6)

"BLD",5068,6.3)
21
"BLD",5068,"INI")
PRE^RORP000
"BLD",5068,"INIT")
POS^RORP000
"BLD",5068,"KRN",0)
^9.67PA^8989.52^19
"BLD",5068,"KRN",.4,0)
.4
"BLD",5068,"KRN",.4,"NM",0)
^9.68A^3^3
"BLD",5068,"KRN",.4,"NM",1,0)
ROR DATA ELEMENTS    FILE #799.2^799.2^0
"BLD",5068,"KRN",.4,"NM",2,0)
ROR LOG    FILE #798.7^798.7^0
"BLD",5068,"KRN",.4,"NM",3,0)
ROR PENDING ERRORS    FILE #798.3^798.3^0
"BLD",5068,"KRN",.4,"NM","B","ROR DATA ELEMENTS    FILE #799.2",1)

"BLD",5068,"KRN",.4,"NM","B","ROR LOG    FILE #798.7",2)

"BLD",5068,"KRN",.4,"NM","B","ROR PENDING ERRORS    FILE #798.3",3)

"BLD",5068,"KRN",.401,0)
.401
"BLD",5068,"KRN",.401,"NM",0)
^9.68A^3^3
"BLD",5068,"KRN",.401,"NM",1,0)
ROR DATA ELEMENTS    FILE #799.2^799.2^0
"BLD",5068,"KRN",.401,"NM",2,0)
ROR LOG    FILE #798.7^798.7^0
"BLD",5068,"KRN",.401,"NM",3,0)
ROR PENDING ERRORS    FILE #798.3^798.3^0
"BLD",5068,"KRN",.401,"NM","B","ROR DATA ELEMENTS    FILE #799.2",1)

"BLD",5068,"KRN",.401,"NM","B","ROR LOG    FILE #798.7",2)

"BLD",5068,"KRN",.401,"NM","B","ROR PENDING ERRORS    FILE #798.3",3)

"BLD",5068,"KRN",.402,0)
.402
"BLD",5068,"KRN",.402,"NM",0)
^9.68A^6^5
"BLD",5068,"KRN",.402,"NM",1,0)
RORHDT EDIT PARAMS    FILE #798.1^798.1^1^
"BLD",5068,"KRN",.402,"NM",3,0)
RORMNT EDIT LAB SEARCH    FILE #798.9^798.9^0
"BLD",5068,"KRN",.402,"NM",4,0)
RORMNT EDIT REG PARAMS    FILE #798.1^798.1^0
"BLD",5068,"KRN",.402,"NM",5,0)
RORHDT EDIT EXTRACTION    FILE #799.6^799.6^0
"BLD",5068,"KRN",.402,"NM",6,0)
RORHDT EDIT NATIONAL EXTRACT    FILE #799.6^799.6^0
"BLD",5068,"KRN",.402,"NM","B","RORHDT EDIT EXTRACTION    FILE #799.6",5)

"BLD",5068,"KRN",.402,"NM","B","RORHDT EDIT NATIONAL EXTRACT    FILE #799.6",6)

"BLD",5068,"KRN",.402,"NM","B","RORHDT EDIT PARAMS    FILE #798.1",1)

"BLD",5068,"KRN",.402,"NM","B","RORMNT EDIT LAB SEARCH    FILE #798.9",3)

"BLD",5068,"KRN",.402,"NM","B","RORMNT EDIT REG PARAMS    FILE #798.1",4)

"BLD",5068,"KRN",.403,0)
.403
"BLD",5068,"KRN",.5,0)
.5
"BLD",5068,"KRN",.5,"NM",0)
^9.68A^1^1
"BLD",5068,"KRN",.5,"NM",1,0)
RORPTSTATUS^^0
"BLD",5068,"KRN",.5,"NM","B","RORPTSTATUS",1)

"BLD",5068,"KRN",.84,0)
.84
"BLD",5068,"KRN",.84,"NM",0)
^9.68A^67^67
"BLD",5068,"KRN",.84,"NM",1,0)
7981008.001^^0^
"BLD",5068,"KRN",.84,"NM",2,0)
7981008.002^^0^
"BLD",5068,"KRN",.84,"NM",3,0)
7980000.001^^0
"BLD",5068,"KRN",.84,"NM",4,0)
7980000.002^^0
"BLD",5068,"KRN",.84,"NM",5,0)
7980000.003^^0
"BLD",5068,"KRN",.84,"NM",6,0)
7980000.004^^0
"BLD",5068,"KRN",.84,"NM",7,0)
7980000.005^^1^
"BLD",5068,"KRN",.84,"NM",8,0)
7980000.006^^0^
"BLD",5068,"KRN",.84,"NM",9,0)
7980000.007^^0
"BLD",5068,"KRN",.84,"NM",10,0)
7980000.008^^0
"BLD",5068,"KRN",.84,"NM",11,0)
7980000.009^^0
"BLD",5068,"KRN",.84,"NM",12,0)
7980000.01^^0
"BLD",5068,"KRN",.84,"NM",13,0)
7980000.011^^0
"BLD",5068,"KRN",.84,"NM",14,0)
7980000.012^^0
"BLD",5068,"KRN",.84,"NM",15,0)
7980000.015^^0
"BLD",5068,"KRN",.84,"NM",16,0)
7980000.016^^0
"BLD",5068,"KRN",.84,"NM",17,0)
7980000.017^^0
"BLD",5068,"KRN",.84,"NM",18,0)
7980000.018^^0
"BLD",5068,"KRN",.84,"NM",19,0)
7980000.02^^0
"BLD",5068,"KRN",.84,"NM",20,0)
7980000.021^^0
"BLD",5068,"KRN",.84,"NM",21,0)
7980000.022^^0
"BLD",5068,"KRN",.84,"NM",22,0)
7981000^^0
"BLD",5068,"KRN",.84,"NM",23,0)
7981000.002^^0
"BLD",5068,"KRN",.84,"NM",24,0)
7981001.001^^0
"BLD",5068,"KRN",.84,"NM",25,0)
7981001.002^^0
"BLD",5068,"KRN",.84,"NM",26,0)
7981002.001^^0
"BLD",5068,"KRN",.84,"NM",27,0)
7981002.002^^0
"BLD",5068,"KRN",.84,"NM",28,0)
7981003.001^^0
"BLD",5068,"KRN",.84,"NM",29,0)
7981003.002^^0
"BLD",5068,"KRN",.84,"NM",30,0)
7981004.001^^0
"BLD",5068,"KRN",.84,"NM",31,0)
7981004.002^^0
"BLD",5068,"KRN",.84,"NM",32,0)
7981005.001^^0
"BLD",5068,"KRN",.84,"NM",33,0)
7981005.002^^0
"BLD",5068,"KRN",.84,"NM",34,0)
7981006.001^^0
"BLD",5068,"KRN",.84,"NM",35,0)
7981006.002^^0
"BLD",5068,"KRN",.84,"NM",36,0)
7981007.001^^0
"BLD",5068,"KRN",.84,"NM",37,0)
7981007.002^^0
"BLD",5068,"KRN",.84,"NM",38,0)
7981009.001^^0
"BLD",5068,"KRN",.84,"NM",39,0)
7981009.002^^0
"BLD",5068,"KRN",.84,"NM",40,0)
7981010.001^^0
"BLD",5068,"KRN",.84,"NM",41,0)
7981010.002^^0
"BLD",5068,"KRN",.84,"NM",42,0)
7981011.001^^0
"BLD",5068,"KRN",.84,"NM",43,0)
7981011.002^^0
"BLD",5068,"KRN",.84,"NM",44,0)
7981012.001^^0
"BLD",5068,"KRN",.84,"NM",45,0)
7981012.002^^0
"BLD",5068,"KRN",.84,"NM",46,0)
7981013.001^^0
"BLD",5068,"KRN",.84,"NM",47,0)
7981013.002^^0
"BLD",5068,"KRN",.84,"NM",48,0)
7981014.001^^0
"BLD",5068,"KRN",.84,"NM",49,0)
7981014.002^^0
"BLD",5068,"KRN",.84,"NM",50,0)
7981995.001^^0
"BLD",5068,"KRN",.84,"NM",51,0)
7981996.001^^0
"BLD",5068,"KRN",.84,"NM",52,0)
7981997.001^^0
"BLD",5068,"KRN",.84,"NM",53,0)
7981997.002^^0
"BLD",5068,"KRN",.84,"NM",54,0)
7981998.001^^0
"BLD",5068,"KRN",.84,"NM",55,0)
7981999.001^^0
"BLD",5068,"KRN",.84,"NM",56,0)
7981999.002^^0
"BLD",5068,"KRN",.84,"NM",57,0)
7980000.023^^0
"BLD",5068,"KRN",.84,"NM",58,0)
7980000.024^^0
"BLD",5068,"KRN",.84,"NM",59,0)
7980000.025^^0
"BLD",5068,"KRN",.84,"NM",60,0)
7980000.026^^0
"BLD",5068,"KRN",.84,"NM",61,0)
7980000.027^^0
"BLD",5068,"KRN",.84,"NM",62,0)
7980000.019^^0
"BLD",5068,"KRN",.84,"NM",63,0)
7981016.001^^0
"BLD",5068,"KRN",.84,"NM",64,0)
7981016.002^^0
"BLD",5068,"KRN",.84,"NM",65,0)
7981015.001^^0
"BLD",5068,"KRN",.84,"NM",66,0)
7981015.002^^0
"BLD",5068,"KRN",.84,"NM",67,0)
7980000.013^^0
"BLD",5068,"KRN",.84,"NM","B",7980000.001,3)

"BLD",5068,"KRN",.84,"NM","B",7980000.002,4)

"BLD",5068,"KRN",.84,"NM","B",7980000.003,5)

"BLD",5068,"KRN",.84,"NM","B",7980000.004,6)

"BLD",5068,"KRN",.84,"NM","B",7980000.005,7)

"BLD",5068,"KRN",.84,"NM","B",7980000.006,8)

"BLD",5068,"KRN",.84,"NM","B",7980000.007,9)

"BLD",5068,"KRN",.84,"NM","B",7980000.008,10)

"BLD",5068,"KRN",.84,"NM","B",7980000.009,11)

"BLD",5068,"KRN",.84,"NM","B",7980000.01,12)

"BLD",5068,"KRN",.84,"NM","B",7980000.011,13)

"BLD",5068,"KRN",.84,"NM","B",7980000.012,14)

"BLD",5068,"KRN",.84,"NM","B",7980000.013,67)

"BLD",5068,"KRN",.84,"NM","B",7980000.015,15)

"BLD",5068,"KRN",.84,"NM","B",7980000.016,16)

"BLD",5068,"KRN",.84,"NM","B",7980000.017,17)

"BLD",5068,"KRN",.84,"NM","B",7980000.018,18)

"BLD",5068,"KRN",.84,"NM","B",7980000.019,62)

"BLD",5068,"KRN",.84,"NM","B",7980000.02,19)

"BLD",5068,"KRN",.84,"NM","B",7980000.021,20)

"BLD",5068,"KRN",.84,"NM","B",7980000.022,21)

"BLD",5068,"KRN",.84,"NM","B",7980000.023,57)

"BLD",5068,"KRN",.84,"NM","B",7980000.024,58)

"BLD",5068,"KRN",.84,"NM","B",7980000.025,59)

"BLD",5068,"KRN",.84,"NM","B",7980000.026,60)

"BLD",5068,"KRN",.84,"NM","B",7980000.027,61)

"BLD",5068,"KRN",.84,"NM","B",7981000,22)

"BLD",5068,"KRN",.84,"NM","B",7981000.002,23)

"BLD",5068,"KRN",.84,"NM","B",7981001.001,24)

"BLD",5068,"KRN",.84,"NM","B",7981001.002,25)

"BLD",5068,"KRN",.84,"NM","B",7981002.001,26)

"BLD",5068,"KRN",.84,"NM","B",7981002.002,27)

"BLD",5068,"KRN",.84,"NM","B",7981003.001,28)

"BLD",5068,"KRN",.84,"NM","B",7981003.002,29)

"BLD",5068,"KRN",.84,"NM","B",7981004.001,30)

"BLD",5068,"KRN",.84,"NM","B",7981004.002,31)

"BLD",5068,"KRN",.84,"NM","B",7981005.001,32)

"BLD",5068,"KRN",.84,"NM","B",7981005.002,33)

"BLD",5068,"KRN",.84,"NM","B",7981006.001,34)

"BLD",5068,"KRN",.84,"NM","B",7981006.002,35)

"BLD",5068,"KRN",.84,"NM","B",7981007.001,36)

"BLD",5068,"KRN",.84,"NM","B",7981007.002,37)

"BLD",5068,"KRN",.84,"NM","B",7981008.001,1)

"BLD",5068,"KRN",.84,"NM","B",7981008.002,2)

"BLD",5068,"KRN",.84,"NM","B",7981009.001,38)

"BLD",5068,"KRN",.84,"NM","B",7981009.002,39)

"BLD",5068,"KRN",.84,"NM","B",7981010.001,40)

"BLD",5068,"KRN",.84,"NM","B",7981010.002,41)

"BLD",5068,"KRN",.84,"NM","B",7981011.001,42)

"BLD",5068,"KRN",.84,"NM","B",7981011.002,43)

"BLD",5068,"KRN",.84,"NM","B",7981012.001,44)

"BLD",5068,"KRN",.84,"NM","B",7981012.002,45)

"BLD",5068,"KRN",.84,"NM","B",7981013.001,46)

"BLD",5068,"KRN",.84,"NM","B",7981013.002,47)

"BLD",5068,"KRN",.84,"NM","B",7981014.001,48)

"BLD",5068,"KRN",.84,"NM","B",7981014.002,49)

"BLD",5068,"KRN",.84,"NM","B",7981015.001,65)

"BLD",5068,"KRN",.84,"NM","B",7981015.002,66)

"BLD",5068,"KRN",.84,"NM","B",7981016.001,63)

"BLD",5068,"KRN",.84,"NM","B",7981016.002,64)

"BLD",5068,"KRN",.84,"NM","B",7981995.001,50)

"BLD",5068,"KRN",.84,"NM","B",7981996.001,51)

"BLD",5068,"KRN",.84,"NM","B",7981997.001,52)

"BLD",5068,"KRN",.84,"NM","B",7981997.002,53)

"BLD",5068,"KRN",.84,"NM","B",7981998.001,54)

"BLD",5068,"KRN",.84,"NM","B",7981999.001,55)

"BLD",5068,"KRN",.84,"NM","B",7981999.002,56)

"BLD",5068,"KRN",3.6,0)
3.6
"BLD",5068,"KRN",3.8,0)
3.8
"BLD",5068,"KRN",9.2,0)
9.2
"BLD",5068,"KRN",9.8,0)
9.8
"BLD",5068,"KRN",9.8,"NM",0)
^9.68A^221^214
"BLD",5068,"KRN",9.8,"NM",1,0)
RORRP013^^0^24923269
"BLD",5068,"KRN",9.8,"NM",2,0)
RORRP036^^0^9045878
"BLD",5068,"KRN",9.8,"NM",3,0)
RORRP037^^0^11590629
"BLD",5068,"KRN",9.8,"NM",4,0)
RORRP019^^0^40743189
"BLD",5068,"KRN",9.8,"NM",5,0)
RORRP024^^0^18900459
"BLD",5068,"KRN",9.8,"NM",6,0)
RORX001^^0^28863901
"BLD",5068,"KRN",9.8,"NM",7,0)
RORXU002^^0^52378499
"BLD",5068,"KRN",9.8,"NM",8,0)
RORXU005^^0^16280481
"BLD",5068,"KRN",9.8,"NM",9,0)
RORRP017^^0^9907674
"BLD",5068,"KRN",9.8,"NM",10,0)
RORRP012^^0^5905525
"BLD",5068,"KRN",9.8,"NM",11,0)
RORRP038^^0^24551181
"BLD",5068,"KRN",9.8,"NM",12,0)
RORTSK02^^0^26540777
"BLD",5068,"KRN",9.8,"NM",13,0)
RORTSK03^^0^6780184
"BLD",5068,"KRN",9.8,"NM",14,0)
RORRP035^^0^5557216
"BLD",5068,"KRN",9.8,"NM",15,0)
RORX008^^0^8730425
"BLD",5068,"KRN",9.8,"NM",16,0)
RORX008A^^0^27604999
"BLD",5068,"KRN",9.8,"NM",18,0)
RORP000A^^0^50265344
"BLD",5068,"KRN",9.8,"NM",19,0)
RORP000B^^0^67791275
"BLD",5068,"KRN",9.8,"NM",20,0)
ROR^^0^21431872
"BLD",5068,"KRN",9.8,"NM",21,0)
ROR01^^0^15808
"BLD",5068,"KRN",9.8,"NM",22,0)
ROR02^^0^8243
"BLD",5068,"KRN",9.8,"NM",23,0)
ROR10^^0^33339833
"BLD",5068,"KRN",9.8,"NM",24,0)
RORACK^^1^
"BLD",5068,"KRN",9.8,"NM",25,0)
RORACK01^^1^
"BLD",5068,"KRN",9.8,"NM",26,0)
RORAPI01^^0^7206554
"BLD",5068,"KRN",9.8,"NM",27,0)
RORDD^^0^33607447
"BLD",5068,"KRN",9.8,"NM",28,0)
RORDD01^^0^18102562
"BLD",5068,"KRN",9.8,"NM",29,0)
RORERR^^0^31347576
"BLD",5068,"KRN",9.8,"NM",30,0)
RORERR10^^1^
"BLD",5068,"KRN",9.8,"NM",31,0)
RORERR11^^1^
"BLD",5068,"KRN",9.8,"NM",32,0)
RORERR12^^1^
"BLD",5068,"KRN",9.8,"NM",33,0)
RORERR20^^0^65392976
"BLD",5068,"KRN",9.8,"NM",34,0)
ROREVT01^^0^5877686
"BLD",5068,"KRN",9.8,"NM",35,0)
ROREXPR^^0^25327319
"BLD",5068,"KRN",9.8,"NM",36,0)
ROREXT^^0^24189218
"BLD",5068,"KRN",9.8,"NM",37,0)
ROREXT01^^0^49949802
"BLD",5068,"KRN",9.8,"NM",38,0)
ROREXT02^^0^40742469
"BLD",5068,"KRN",9.8,"NM",39,0)
ROREXT03^^0^20585148
"BLD",5068,"KRN",9.8,"NM",40,0)
ROREXTUT^^0^39216710
"BLD",5068,"KRN",9.8,"NM",41,0)
RORHDT^^0^15352700
"BLD",5068,"KRN",9.8,"NM",42,0)
RORHDT01^^0^3904620
"BLD",5068,"KRN",9.8,"NM",43,0)
RORHDT02^^0^12578851
"BLD",5068,"KRN",9.8,"NM",44,0)
RORHDT03^^0^17815439
"BLD",5068,"KRN",9.8,"NM",45,0)
RORHDT04^^0^50817494
"BLD",5068,"KRN",9.8,"NM",46,0)
RORHDT05^^0^13039492
"BLD",5068,"KRN",9.8,"NM",47,0)
RORHDTAC^^0^8906685
"BLD",5068,"KRN",9.8,"NM",48,0)
RORHDTUT^^0^48671355
"BLD",5068,"KRN",9.8,"NM",49,0)
RORHL01^^0^7061029
"BLD",5068,"KRN",9.8,"NM",50,0)
RORHL02^^0^29938860
"BLD",5068,"KRN",9.8,"NM",51,0)
RORHL03^^0^34671095
"BLD",5068,"KRN",9.8,"NM",52,0)
RORHL031^^0^37995805
"BLD",5068,"KRN",9.8,"NM",53,0)
RORHL04^^0^31631249
"BLD",5068,"KRN",9.8,"NM",54,0)
RORHL05^^0^21912781
"BLD",5068,"KRN",9.8,"NM",55,0)
RORHL06^^0^22550285
"BLD",5068,"KRN",9.8,"NM",56,0)
RORHL07^^0^16768200
"BLD",5068,"KRN",9.8,"NM",57,0)
RORHL071^^0^16088753
"BLD",5068,"KRN",9.8,"NM",58,0)
RORHL08^^0^41390061
"BLD",5068,"KRN",9.8,"NM",59,0)
RORHL081^^0^40675935
"BLD",5068,"KRN",9.8,"NM",60,0)
RORHL09^^0^43916632
"BLD",5068,"KRN",9.8,"NM",61,0)
RORHL10^^0^39625132
"BLD",5068,"KRN",9.8,"NM",62,0)
RORHL11^^0^29514988
"BLD",5068,"KRN",9.8,"NM",63,0)
RORHL12^^0^9232656
"BLD",5068,"KRN",9.8,"NM",64,0)
RORHL121^^0^63479618
"BLD",5068,"KRN",9.8,"NM",65,0)
RORHL13^^0^16669898
"BLD",5068,"KRN",9.8,"NM",66,0)
RORHL14^^0^30458142
"BLD",5068,"KRN",9.8,"NM",67,0)
RORHL15^^0^36834138
"BLD",5068,"KRN",9.8,"NM",68,0)
RORHL16^^0^13477054
"BLD",5068,"KRN",9.8,"NM",69,0)
RORHL17^^0^29166670
"BLD",5068,"KRN",9.8,"NM",70,0)
RORHL21^^1^
"BLD",5068,"KRN",9.8,"NM",71,0)
RORHL7^^0^33346768
"BLD",5068,"KRN",9.8,"NM",72,0)
RORHL7A^^0^35053076
"BLD",5068,"KRN",9.8,"NM",73,0)
RORHLUT1^^0^6316864
"BLD",5068,"KRN",9.8,"NM",74,0)
RORICR01^^1^
"BLD",5068,"KRN",9.8,"NM",75,0)
RORICR02^^1^
"BLD",5068,"KRN",9.8,"NM",76,0)
RORICR03^^1^
"BLD",5068,"KRN",9.8,"NM",77,0)
RORICREX^^1^
"BLD",5068,"KRN",9.8,"NM",78,0)
RORICRUT^^1^
"BLD",5068,"KRN",9.8,"NM",79,0)
RORKIDS^^0^35787858
"BLD",5068,"KRN",9.8,"NM",80,0)
RORLOCK^^0^21824053
"BLD",5068,"KRN",9.8,"NM",81,0)
RORLOG^^0^46747985
"BLD",5068,"KRN",9.8,"NM",82,0)
RORLOG01^^0^13742298
"BLD",5068,"KRN",9.8,"NM",83,0)
RORNTEG^^0^19432116
"BLD",5068,"KRN",9.8,"NM",84,0)
RORNTEG0^^0^4347507
"BLD",5068,"KRN",9.8,"NM",85,0)
RORP000^^0^65292418
"BLD",5068,"KRN",9.8,"NM",86,0)
RORP008^^1^
"BLD",5068,"KRN",9.8,"NM",87,0)
RORPUT01^^0^36828175
"BLD",5068,"KRN",9.8,"NM",88,0)
RORREP01^^0^47906972
"BLD",5068,"KRN",9.8,"NM",89,0)
RORREP02^^0^52937868
"BLD",5068,"KRN",9.8,"NM",90,0)
RORRP007^^0^34852551
"BLD",5068,"KRN",9.8,"NM",91,0)
RORRP010^^0^11270311
"BLD",5068,"KRN",9.8,"NM",92,0)
RORRP011^^0^14118825
"BLD",5068,"KRN",9.8,"NM",93,0)
RORRP014^^0^14432703
"BLD",5068,"KRN",9.8,"NM",94,0)
RORRP015^^0^22373114
"BLD",5068,"KRN",9.8,"NM",95,0)
RORRP016^^0^18769051
"BLD",5068,"KRN",9.8,"NM",96,0)
RORRP018^^0^7897873
"BLD",5068,"KRN",9.8,"NM",97,0)
RORRP020^^0^23181298
"BLD",5068,"KRN",9.8,"NM",98,0)
RORRP021^^0^33183817
"BLD",5068,"KRN",9.8,"NM",99,0)
RORRP022^^0^4289383
"BLD",5068,"KRN",9.8,"NM",100,0)
RORRP023^^0^10243108
"BLD",5068,"KRN",9.8,"NM",101,0)
RORRP025^^0^32323014
"BLD",5068,"KRN",9.8,"NM",102,0)
RORRP026^^0^69411455
"BLD",5068,"KRN",9.8,"NM",103,0)
RORRP027^^0^51310426
"BLD",5068,"KRN",9.8,"NM",104,0)
RORRP029^^0^6656524
"BLD",5068,"KRN",9.8,"NM",105,0)
RORRP030^^0^3261693
"BLD",5068,"KRN",9.8,"NM",106,0)
RORRP031^^0^31717159
"BLD",5068,"KRN",9.8,"NM",107,0)
RORRP032^^0^32884612
"BLD",5068,"KRN",9.8,"NM",108,0)
RORRP033^^0^14303142
"BLD",5068,"KRN",9.8,"NM",109,0)
RORRP034^^0^12664578
"BLD",5068,"KRN",9.8,"NM",111,0)
RORRP1^^1^
"BLD",5068,"KRN",9.8,"NM",112,0)
RORRP10^^1^
"BLD",5068,"KRN",9.8,"NM",113,0)
RORRP2^^1^
"BLD",5068,"KRN",9.8,"NM",114,0)
RORRP3^^1^
"BLD",5068,"KRN",9.8,"NM",115,0)
RORRP4^^1^
"BLD",5068,"KRN",9.8,"NM",116,0)
RORRP5^^1^
"BLD",5068,"KRN",9.8,"NM",117,0)
RORRP6^^1^
"BLD",5068,"KRN",9.8,"NM",118,0)
RORRP7^^1^
"BLD",5068,"KRN",9.8,"NM",119,0)
RORRP8^^1^
"BLD",5068,"KRN",9.8,"NM",120,0)
RORRP9^^1^
"BLD",5068,"KRN",9.8,"NM",121,0)
RORSET01^^0^16165599
"BLD",5068,"KRN",9.8,"NM",122,0)
RORSETU1^^0^9739381
"BLD",5068,"KRN",9.8,"NM",123,0)
RORSETU2^^0^9293827
"BLD",5068,"KRN",9.8,"NM",124,0)
RORTSK^^0^23508484
"BLD",5068,"KRN",9.8,"NM",125,0)
RORTSK01^^0^48586132
"BLD",5068,"KRN",9.8,"NM",126,0)
RORTSK10^^0^40092056
"BLD",5068,"KRN",9.8,"NM",127,0)
RORTSK11^^0^20505407
"BLD",5068,"KRN",9.8,"NM",128,0)
RORTXT^^0^339606
"BLD",5068,"KRN",9.8,"NM",129,0)
RORUPD^^0^25273345
"BLD",5068,"KRN",9.8,"NM",130,0)
RORUPD01^^0^64834418
"BLD",5068,"KRN",9.8,"NM",131,0)
RORUPD04^^0^32325986
"BLD",5068,"KRN",9.8,"NM",132,0)
RORUPD05^^0^44214142
"BLD",5068,"KRN",9.8,"NM",133,0)
RORUPD06^^0^11384765
"BLD",5068,"KRN",9.8,"NM",134,0)
RORUPD07^^0^7767949
"BLD",5068,"KRN",9.8,"NM",135,0)
RORUPD08^^0^22389683
"BLD",5068,"KRN",9.8,"NM",136,0)
RORUPD09^^0^9474836
"BLD",5068,"KRN",9.8,"NM",137,0)
RORUPD50^^0^14024739
"BLD",5068,"KRN",9.8,"NM",138,0)
RORUPD51^^0^43538631
"BLD",5068,"KRN",9.8,"NM",139,0)
RORUPD52^^0^12529395
"BLD",5068,"KRN",9.8,"NM",140,0)
RORUPDUT^^0^47401581
"BLD",5068,"KRN",9.8,"NM",141,0)
RORUPEX^^0^14367646
"BLD",5068,"KRN",9.8,"NM",142,0)
RORUPP01^^0^14228263
"BLD",5068,"KRN",9.8,"NM",143,0)
RORUPP02^^0^13632896
"BLD",5068,"KRN",9.8,"NM",144,0)
RORUPR^^0^27398451
"BLD",5068,"KRN",9.8,"NM",145,0)
RORUPR1^^0^69715396
"BLD",5068,"KRN",9.8,"NM",146,0)
RORUTL01^^0^29781636
"BLD",5068,"KRN",9.8,"NM",147,0)
RORUTL02^^0^36876775
"BLD",5068,"KRN",9.8,"NM",148,0)
RORUTL03^^0^19858687
"BLD",5068,"KRN",9.8,"NM",149,0)
RORUTL04^^0^5896522
"BLD",5068,"KRN",9.8,"NM",150,0)
RORUTL05^^0^57340264
"BLD",5068,"KRN",9.8,"NM",151,0)
RORUTL06^^0^71698808
"BLD",5068,"KRN",9.8,"NM",152,0)
RORUTL07^^0^6858018
"BLD",5068,"KRN",9.8,"NM",153,0)
RORUTL08^^0^17942076
"BLD",5068,"KRN",9.8,"NM",154,0)
RORUTL09^^0^6692200
"BLD",5068,"KRN",9.8,"NM",155,0)
RORUTL10^^0^40383170
"BLD",5068,"KRN",9.8,"NM",156,0)
RORUTL11^^0^2472015
"BLD",5068,"KRN",9.8,"NM",157,0)
RORUTL14^^0^10147900
"BLD",5068,"KRN",9.8,"NM",158,0)
RORUTL15^^0^44452643
"BLD",5068,"KRN",9.8,"NM",159,0)
RORUTL16^^0^14440971
"BLD",5068,"KRN",9.8,"NM",160,0)
RORUTL17^^0^53165086
"BLD",5068,"KRN",9.8,"NM",161,0)
RORUTL18^^0^22624377
"BLD",5068,"KRN",9.8,"NM",162,0)
RORVM001^^0^1276605
"BLD",5068,"KRN",9.8,"NM",163,0)
RORX000^^0^4541569
"BLD",5068,"KRN",9.8,"NM",164,0)
RORX002^^0^20408394
"BLD",5068,"KRN",9.8,"NM",165,0)
RORX003^^0^21537399
"BLD",5068,"KRN",9.8,"NM",166,0)
RORX003A^^0^45547475
"BLD",5068,"KRN",9.8,"NM",167,0)
RORX004^^0^15147784
"BLD",5068,"KRN",9.8,"NM",168,0)
RORX005^^0^9729491
"BLD",5068,"KRN",9.8,"NM",169,0)
RORX005A^^0^28503229
"BLD",5068,"KRN",9.8,"NM",170,0)
RORX005B^^0^7236567
"BLD",5068,"KRN",9.8,"NM",171,0)
RORX005C^^0^36299826
"BLD",5068,"KRN",9.8,"NM",172,0)
RORX005U^^1^
"BLD",5068,"KRN",9.8,"NM",173,0)
RORX006^^0^10891321
"BLD",5068,"KRN",9.8,"NM",174,0)
RORX006A^^0^18261690
"BLD",5068,"KRN",9.8,"NM",175,0)
RORX006C^^0^20109049
"BLD",5068,"KRN",9.8,"NM",176,0)
RORX007^^0^48286128
"BLD",5068,"KRN",9.8,"NM",177,0)
RORX007A^^0^11759892
"BLD",5068,"KRN",9.8,"NM",178,0)
RORX009^^0^14460378
"BLD",5068,"KRN",9.8,"NM",179,0)
RORX009A^^0^60001463
"BLD",5068,"KRN",9.8,"NM",180,0)
RORX009C^^0^58939226
"BLD",5068,"KRN",9.8,"NM",181,0)
RORX010^^0^42705985
"BLD",5068,"KRN",9.8,"NM",182,0)
RORX011^^0^48518702
"BLD",5068,"KRN",9.8,"NM",183,0)
RORX012^^0^14019577
"BLD",5068,"KRN",9.8,"NM",184,0)
RORX012A^^0^65824765
"BLD",5068,"KRN",9.8,"NM",185,0)
RORX013^^0^7562823
"BLD",5068,"KRN",9.8,"NM",186,0)
RORX013A^^0^46112050
"BLD",5068,"KRN",9.8,"NM",187,0)
RORX013C^^0^11993633
"BLD",5068,"KRN",9.8,"NM",188,0)
RORX014^^0^9743721
"BLD",5068,"KRN",9.8,"NM",189,0)
RORX014A^^0^27835424
"BLD",5068,"KRN",9.8,"NM",190,0)
RORXU001^^0^13475252
"BLD",5068,"KRN",9.8,"NM",191,0)
RORXU003^^0^49999822
"BLD",5068,"KRN",9.8,"NM",192,0)
RORXU004^^0^860897
"BLD",5068,"KRN",9.8,"NM",193,0)
RORXU006^^0^40171673
"BLD",5068,"KRN",9.8,"NM",194,0)
RORXU007^^0^43659053
"BLD",5068,"KRN",9.8,"NM",195,0)
ROR11^^0^52722073
"BLD",5068,"KRN",9.8,"NM",198,0)
RORHIV03^^0^35616768
"BLD",5068,"KRN",9.8,"NM",199,0)
RORHIVUT^^0^835917
"BLD",5068,"KRN",9.8,"NM",202,0)
RORUPD62^^0^5521623
"BLD",5068,"KRN",9.8,"NM",203,0)
RORRP040^^0^22896887
"BLD",5068,"KRN",9.8,"NM",204,0)
RORTSK12^^0^9078558
"BLD",5068,"KRN",9.8,"NM",205,0)
RORRP041^^0^12442273
"BLD",5068,"KRN",9.8,"NM",206,0)
RORTMP^^0^2339215
"BLD",5068,"KRN",9.8,"NM",207,0)
RORTSK13^^0^33904309
"BLD",5068,"KRN",9.8,"NM",208,0)
RORTSK14^^0^6333918
"BLD",5068,"KRN",9.8,"NM",209,0)
RORX016A^^0^9199595
"BLD",5068,"KRN",9.8,"NM",210,0)
RORX016B^^0^8117035
"BLD",5068,"KRN",9.8,"NM",211,0)
RORX016C^^0^17593055
"BLD",5068,"KRN",9.8,"NM",212,0)
RORX016^^0^8402177
"BLD",5068,"KRN",9.8,"NM",213,0)
RORRP042^^0^12774243
"BLD",5068,"KRN",9.8,"NM",214,0)
RORX015C^^0^12085093
"BLD",5068,"KRN",9.8,"NM",215,0)
RORX015^^0^7302265
"BLD",5068,"KRN",9.8,"NM",216,0)
RORX015A^^0^24310638
"BLD",5068,"KRN",9.8,"NM",217,0)
RORUTL19^^0^2739501
"BLD",5068,"KRN",9.8,"NM",218,0)
RORHDT06^^0^18765135
"BLD",5068,"KRN",9.8,"NM",220,0)
RORPUT02^^0^22713364
"BLD",5068,"KRN",9.8,"NM",221,0)
RORBIN^^0^47206993
"BLD",5068,"KRN",9.8,"NM","B","ROR",20)

"BLD",5068,"KRN",9.8,"NM","B","ROR01",21)

"BLD",5068,"KRN",9.8,"NM","B","ROR02",22)

"BLD",5068,"KRN",9.8,"NM","B","ROR10",23)

"BLD",5068,"KRN",9.8,"NM","B","ROR11",195)

"BLD",5068,"KRN",9.8,"NM","B","RORACK",24)

"BLD",5068,"KRN",9.8,"NM","B","RORACK01",25)

"BLD",5068,"KRN",9.8,"NM","B","RORAPI01",26)

"BLD",5068,"KRN",9.8,"NM","B","RORBIN",221)

"BLD",5068,"KRN",9.8,"NM","B","RORDD",27)

"BLD",5068,"KRN",9.8,"NM","B","RORDD01",28)

"BLD",5068,"KRN",9.8,"NM","B","RORERR",29)

"BLD",5068,"KRN",9.8,"NM","B","RORERR10",30)

"BLD",5068,"KRN",9.8,"NM","B","RORERR11",31)

"BLD",5068,"KRN",9.8,"NM","B","RORERR12",32)

"BLD",5068,"KRN",9.8,"NM","B","RORERR20",33)

"BLD",5068,"KRN",9.8,"NM","B","ROREVT01",34)

"BLD",5068,"KRN",9.8,"NM","B","ROREXPR",35)

"BLD",5068,"KRN",9.8,"NM","B","ROREXT",36)

"BLD",5068,"KRN",9.8,"NM","B","ROREXT01",37)

"BLD",5068,"KRN",9.8,"NM","B","ROREXT02",38)

"BLD",5068,"KRN",9.8,"NM","B","ROREXT03",39)

"BLD",5068,"KRN",9.8,"NM","B","ROREXTUT",40)

"BLD",5068,"KRN",9.8,"NM","B","RORHDT",41)

"BLD",5068,"KRN",9.8,"NM","B","RORHDT01",42)

"BLD",5068,"KRN",9.8,"NM","B","RORHDT02",43)

"BLD",5068,"KRN",9.8,"NM","B","RORHDT03",44)

"BLD",5068,"KRN",9.8,"NM","B","RORHDT04",45)

"BLD",5068,"KRN",9.8,"NM","B","RORHDT05",46)

"BLD",5068,"KRN",9.8,"NM","B","RORHDT06",218)

"BLD",5068,"KRN",9.8,"NM","B","RORHDTAC",47)

"BLD",5068,"KRN",9.8,"NM","B","RORHDTUT",48)

"BLD",5068,"KRN",9.8,"NM","B","RORHIV03",198)

"BLD",5068,"KRN",9.8,"NM","B","RORHIVUT",199)

"BLD",5068,"KRN",9.8,"NM","B","RORHL01",49)

"BLD",5068,"KRN",9.8,"NM","B","RORHL02",50)

"BLD",5068,"KRN",9.8,"NM","B","RORHL03",51)

"BLD",5068,"KRN",9.8,"NM","B","RORHL031",52)

"BLD",5068,"KRN",9.8,"NM","B","RORHL04",53)

"BLD",5068,"KRN",9.8,"NM","B","RORHL05",54)

"BLD",5068,"KRN",9.8,"NM","B","RORHL06",55)

"BLD",5068,"KRN",9.8,"NM","B","RORHL07",56)

"BLD",5068,"KRN",9.8,"NM","B","RORHL071",57)

"BLD",5068,"KRN",9.8,"NM","B","RORHL08",58)

"BLD",5068,"KRN",9.8,"NM","B","RORHL081",59)

"BLD",5068,"KRN",9.8,"NM","B","RORHL09",60)

"BLD",5068,"KRN",9.8,"NM","B","RORHL10",61)

"BLD",5068,"KRN",9.8,"NM","B","RORHL11",62)

"BLD",5068,"KRN",9.8,"NM","B","RORHL12",63)

"BLD",5068,"KRN",9.8,"NM","B","RORHL121",64)

"BLD",5068,"KRN",9.8,"NM","B","RORHL13",65)

"BLD",5068,"KRN",9.8,"NM","B","RORHL14",66)

"BLD",5068,"KRN",9.8,"NM","B","RORHL15",67)

"BLD",5068,"KRN",9.8,"NM","B","RORHL16",68)

"BLD",5068,"KRN",9.8,"NM","B","RORHL17",69)

"BLD",5068,"KRN",9.8,"NM","B","RORHL21",70)

"BLD",5068,"KRN",9.8,"NM","B","RORHL7",71)

"BLD",5068,"KRN",9.8,"NM","B","RORHL7A",72)

"BLD",5068,"KRN",9.8,"NM","B","RORHLUT1",73)

"BLD",5068,"KRN",9.8,"NM","B","RORICR01",74)

"BLD",5068,"KRN",9.8,"NM","B","RORICR02",75)

"BLD",5068,"KRN",9.8,"NM","B","RORICR03",76)

"BLD",5068,"KRN",9.8,"NM","B","RORICREX",77)

"BLD",5068,"KRN",9.8,"NM","B","RORICRUT",78)

"BLD",5068,"KRN",9.8,"NM","B","RORKIDS",79)

"BLD",5068,"KRN",9.8,"NM","B","RORLOCK",80)

"BLD",5068,"KRN",9.8,"NM","B","RORLOG",81)

"BLD",5068,"KRN",9.8,"NM","B","RORLOG01",82)

"BLD",5068,"KRN",9.8,"NM","B","RORNTEG",83)

"BLD",5068,"KRN",9.8,"NM","B","RORNTEG0",84)

"BLD",5068,"KRN",9.8,"NM","B","RORP000",85)

"BLD",5068,"KRN",9.8,"NM","B","RORP000A",18)

"BLD",5068,"KRN",9.8,"NM","B","RORP000B",19)

"BLD",5068,"KRN",9.8,"NM","B","RORP008",86)

"BLD",5068,"KRN",9.8,"NM","B","RORPUT01",87)

"BLD",5068,"KRN",9.8,"NM","B","RORPUT02",220)

"BLD",5068,"KRN",9.8,"NM","B","RORREP01",88)

"BLD",5068,"KRN",9.8,"NM","B","RORREP02",89)

"BLD",5068,"KRN",9.8,"NM","B","RORRP007",90)

"BLD",5068,"KRN",9.8,"NM","B","RORRP010",91)

"BLD",5068,"KRN",9.8,"NM","B","RORRP011",92)

"BLD",5068,"KRN",9.8,"NM","B","RORRP012",10)

"BLD",5068,"KRN",9.8,"NM","B","RORRP013",1)

"BLD",5068,"KRN",9.8,"NM","B","RORRP014",93)

"BLD",5068,"KRN",9.8,"NM","B","RORRP015",94)

"BLD",5068,"KRN",9.8,"NM","B","RORRP016",95)

"BLD",5068,"KRN",9.8,"NM","B","RORRP017",9)

"BLD",5068,"KRN",9.8,"NM","B","RORRP018",96)

"BLD",5068,"KRN",9.8,"NM","B","RORRP019",4)

"BLD",5068,"KRN",9.8,"NM","B","RORRP020",97)

"BLD",5068,"KRN",9.8,"NM","B","RORRP021",98)

"BLD",5068,"KRN",9.8,"NM","B","RORRP022",99)

"BLD",5068,"KRN",9.8,"NM","B","RORRP023",100)

"BLD",5068,"KRN",9.8,"NM","B","RORRP024",5)

"BLD",5068,"KRN",9.8,"NM","B","RORRP025",101)

"BLD",5068,"KRN",9.8,"NM","B","RORRP026",102)

"BLD",5068,"KRN",9.8,"NM","B","RORRP027",103)

"BLD",5068,"KRN",9.8,"NM","B","RORRP029",104)

"BLD",5068,"KRN",9.8,"NM","B","RORRP030",105)

"BLD",5068,"KRN",9.8,"NM","B","RORRP031",106)

"BLD",5068,"KRN",9.8,"NM","B","RORRP032",107)

"BLD",5068,"KRN",9.8,"NM","B","RORRP033",108)

"BLD",5068,"KRN",9.8,"NM","B","RORRP034",109)

"BLD",5068,"KRN",9.8,"NM","B","RORRP035",14)

"BLD",5068,"KRN",9.8,"NM","B","RORRP036",2)

"BLD",5068,"KRN",9.8,"NM","B","RORRP037",3)

"BLD",5068,"KRN",9.8,"NM","B","RORRP038",11)

"BLD",5068,"KRN",9.8,"NM","B","RORRP040",203)

"BLD",5068,"KRN",9.8,"NM","B","RORRP041",205)

"BLD",5068,"KRN",9.8,"NM","B","RORRP042",213)

"BLD",5068,"KRN",9.8,"NM","B","RORRP1",111)

"BLD",5068,"KRN",9.8,"NM","B","RORRP10",112)

"BLD",5068,"KRN",9.8,"NM","B","RORRP2",113)

"BLD",5068,"KRN",9.8,"NM","B","RORRP3",114)

"BLD",5068,"KRN",9.8,"NM","B","RORRP4",115)

"BLD",5068,"KRN",9.8,"NM","B","RORRP5",116)

"BLD",5068,"KRN",9.8,"NM","B","RORRP6",117)

"BLD",5068,"KRN",9.8,"NM","B","RORRP7",118)

"BLD",5068,"KRN",9.8,"NM","B","RORRP8",119)

"BLD",5068,"KRN",9.8,"NM","B","RORRP9",120)

"BLD",5068,"KRN",9.8,"NM","B","RORSET01",121)

"BLD",5068,"KRN",9.8,"NM","B","RORSETU1",122)

"BLD",5068,"KRN",9.8,"NM","B","RORSETU2",123)

"BLD",5068,"KRN",9.8,"NM","B","RORTMP",206)

"BLD",5068,"KRN",9.8,"NM","B","RORTSK",124)

"BLD",5068,"KRN",9.8,"NM","B","RORTSK01",125)

"BLD",5068,"KRN",9.8,"NM","B","RORTSK02",12)

"BLD",5068,"KRN",9.8,"NM","B","RORTSK03",13)

"BLD",5068,"KRN",9.8,"NM","B","RORTSK10",126)

"BLD",5068,"KRN",9.8,"NM","B","RORTSK11",127)

"BLD",5068,"KRN",9.8,"NM","B","RORTSK12",204)

"BLD",5068,"KRN",9.8,"NM","B","RORTSK13",207)

"BLD",5068,"KRN",9.8,"NM","B","RORTSK14",208)

"BLD",5068,"KRN",9.8,"NM","B","RORTXT",128)

"BLD",5068,"KRN",9.8,"NM","B","RORUPD",129)

"BLD",5068,"KRN",9.8,"NM","B","RORUPD01",130)

"BLD",5068,"KRN",9.8,"NM","B","RORUPD04",131)

"BLD",5068,"KRN",9.8,"NM","B","RORUPD05",132)

"BLD",5068,"KRN",9.8,"NM","B","RORUPD06",133)

"BLD",5068,"KRN",9.8,"NM","B","RORUPD07",134)

"BLD",5068,"KRN",9.8,"NM","B","RORUPD08",135)

"BLD",5068,"KRN",9.8,"NM","B","RORUPD09",136)

"BLD",5068,"KRN",9.8,"NM","B","RORUPD50",137)

"BLD",5068,"KRN",9.8,"NM","B","RORUPD51",138)

"BLD",5068,"KRN",9.8,"NM","B","RORUPD52",139)

"BLD",5068,"KRN",9.8,"NM","B","RORUPD62",202)

"BLD",5068,"KRN",9.8,"NM","B","RORUPDUT",140)

"BLD",5068,"KRN",9.8,"NM","B","RORUPEX",141)

"BLD",5068,"KRN",9.8,"NM","B","RORUPP01",142)

"BLD",5068,"KRN",9.8,"NM","B","RORUPP02",143)

"BLD",5068,"KRN",9.8,"NM","B","RORUPR",144)

"BLD",5068,"KRN",9.8,"NM","B","RORUPR1",145)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL01",146)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL02",147)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL03",148)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL04",149)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL05",150)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL06",151)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL07",152)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL08",153)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL09",154)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL10",155)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL11",156)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL14",157)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL15",158)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL16",159)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL17",160)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL18",161)

"BLD",5068,"KRN",9.8,"NM","B","RORUTL19",217)

"BLD",5068,"KRN",9.8,"NM","B","RORVM001",162)

"BLD",5068,"KRN",9.8,"NM","B","RORX000",163)

"BLD",5068,"KRN",9.8,"NM","B","RORX001",6)

"BLD",5068,"KRN",9.8,"NM","B","RORX002",164)

"BLD",5068,"KRN",9.8,"NM","B","RORX003",165)

"BLD",5068,"KRN",9.8,"NM","B","RORX003A",166)

"BLD",5068,"KRN",9.8,"NM","B","RORX004",167)

"BLD",5068,"KRN",9.8,"NM","B","RORX005",168)

"BLD",5068,"KRN",9.8,"NM","B","RORX005A",169)

"BLD",5068,"KRN",9.8,"NM","B","RORX005B",170)

"BLD",5068,"KRN",9.8,"NM","B","RORX005C",171)

"BLD",5068,"KRN",9.8,"NM","B","RORX005U",172)

"BLD",5068,"KRN",9.8,"NM","B","RORX006",173)

"BLD",5068,"KRN",9.8,"NM","B","RORX006A",174)

"BLD",5068,"KRN",9.8,"NM","B","RORX006C",175)

"BLD",5068,"KRN",9.8,"NM","B","RORX007",176)

"BLD",5068,"KRN",9.8,"NM","B","RORX007A",177)

"BLD",5068,"KRN",9.8,"NM","B","RORX008",15)

"BLD",5068,"KRN",9.8,"NM","B","RORX008A",16)

"BLD",5068,"KRN",9.8,"NM","B","RORX009",178)

"BLD",5068,"KRN",9.8,"NM","B","RORX009A",179)

"BLD",5068,"KRN",9.8,"NM","B","RORX009C",180)

"BLD",5068,"KRN",9.8,"NM","B","RORX010",181)

"BLD",5068,"KRN",9.8,"NM","B","RORX011",182)

"BLD",5068,"KRN",9.8,"NM","B","RORX012",183)

"BLD",5068,"KRN",9.8,"NM","B","RORX012A",184)

"BLD",5068,"KRN",9.8,"NM","B","RORX013",185)

"BLD",5068,"KRN",9.8,"NM","B","RORX013A",186)

"BLD",5068,"KRN",9.8,"NM","B","RORX013C",187)

"BLD",5068,"KRN",9.8,"NM","B","RORX014",188)

"BLD",5068,"KRN",9.8,"NM","B","RORX014A",189)

"BLD",5068,"KRN",9.8,"NM","B","RORX015",215)

"BLD",5068,"KRN",9.8,"NM","B","RORX015A",216)

"BLD",5068,"KRN",9.8,"NM","B","RORX015C",214)

"BLD",5068,"KRN",9.8,"NM","B","RORX016",212)

"BLD",5068,"KRN",9.8,"NM","B","RORX016A",209)

"BLD",5068,"KRN",9.8,"NM","B","RORX016B",210)

"BLD",5068,"KRN",9.8,"NM","B","RORX016C",211)

"BLD",5068,"KRN",9.8,"NM","B","RORXU001",190)

"BLD",5068,"KRN",9.8,"NM","B","RORXU002",7)

"BLD",5068,"KRN",9.8,"NM","B","RORXU003",191)

"BLD",5068,"KRN",9.8,"NM","B","RORXU004",192)

"BLD",5068,"KRN",9.8,"NM","B","RORXU005",8)

"BLD",5068,"KRN",9.8,"NM","B","RORXU006",193)

"BLD",5068,"KRN",9.8,"NM","B","RORXU007",194)

"BLD",5068,"KRN",19,0)
19
"BLD",5068,"KRN",19,"NM",0)
^9.68A^23^23
"BLD",5068,"KRN",19,"NM",1,0)
ROR GUI^^0
"BLD",5068,"KRN",19,"NM",2,0)
ROR GUI MENU^^1^
"BLD",5068,"KRN",19,"NM",3,0)
ROR SETUP^^0
"BLD",5068,"KRN",19,"NM",4,0)
ROR TASK^^0
"BLD",5068,"KRN",19,"NM",5,0)
RORHDT CREATE^^0
"BLD",5068,"KRN",19,"NM",6,0)
RORHDT EDIT^^0
"BLD",5068,"KRN",19,"NM",7,0)
RORHDT EDIT REGISTRY^^1^
"BLD",5068,"KRN",19,"NM",8,0)
RORHDT EDIT TASK^^1^
"BLD",5068,"KRN",19,"NM",9,0)
RORHDT LOG^^0
"BLD",5068,"KRN",19,"NM",10,0)
RORHDT MAIN^^0
"BLD",5068,"KRN",19,"NM",11,0)
RORHDT START^^0
"BLD",5068,"KRN",19,"NM",12,0)
RORHDT STATUS^^0
"BLD",5068,"KRN",19,"NM",13,0)
RORHDT STOP^^0
"BLD",5068,"KRN",19,"NM",14,0)
RORICR VERSION COMPARISON^^0
"BLD",5068,"KRN",19,"NM",15,0)
RORMNT ACL REINDEX^^0
"BLD",5068,"KRN",19,"NM",16,0)
RORMNT AWAITING ACK^^1^
"BLD",5068,"KRN",19,"NM",17,0)
RORMNT EDIT LAB SEARCH^^0
"BLD",5068,"KRN",19,"NM",18,0)
RORMNT EDIT REG PARAMS^^0
"BLD",5068,"KRN",19,"NM",19,0)
RORMNT MAIN^^0
"BLD",5068,"KRN",19,"NM",20,0)
RORMNT PENDING ERRORS LIST^^0
"BLD",5068,"KRN",19,"NM",21,0)
RORMNT PENDING PATIENTS^^0
"BLD",5068,"KRN",19,"NM",22,0)
RORMNT PRINT LOGS^^0
"BLD",5068,"KRN",19,"NM",23,0)
RORHDT EDIT EXTRACTION^^0
"BLD",5068,"KRN",19,"NM","B","ROR GUI",1)

"BLD",5068,"KRN",19,"NM","B","ROR GUI MENU",2)

"BLD",5068,"KRN",19,"NM","B","ROR SETUP",3)

"BLD",5068,"KRN",19,"NM","B","ROR TASK",4)

"BLD",5068,"KRN",19,"NM","B","RORHDT CREATE",5)

"BLD",5068,"KRN",19,"NM","B","RORHDT EDIT",6)

"BLD",5068,"KRN",19,"NM","B","RORHDT EDIT EXTRACTION",23)

"BLD",5068,"KRN",19,"NM","B","RORHDT EDIT REGISTRY",7)

"BLD",5068,"KRN",19,"NM","B","RORHDT EDIT TASK",8)

"BLD",5068,"KRN",19,"NM","B","RORHDT LOG",9)

"BLD",5068,"KRN",19,"NM","B","RORHDT MAIN",10)

"BLD",5068,"KRN",19,"NM","B","RORHDT START",11)

"BLD",5068,"KRN",19,"NM","B","RORHDT STATUS",12)

"BLD",5068,"KRN",19,"NM","B","RORHDT STOP",13)

"BLD",5068,"KRN",19,"NM","B","RORICR VERSION COMPARISON",14)

"BLD",5068,"KRN",19,"NM","B","RORMNT ACL REINDEX",15)

"BLD",5068,"KRN",19,"NM","B","RORMNT AWAITING ACK",16)

"BLD",5068,"KRN",19,"NM","B","RORMNT EDIT LAB SEARCH",17)

"BLD",5068,"KRN",19,"NM","B","RORMNT EDIT REG PARAMS",18)

"BLD",5068,"KRN",19,"NM","B","RORMNT MAIN",19)

"BLD",5068,"KRN",19,"NM","B","RORMNT PENDING ERRORS LIST",20)

"BLD",5068,"KRN",19,"NM","B","RORMNT PENDING PATIENTS",21)

"BLD",5068,"KRN",19,"NM","B","RORMNT PRINT LOGS",22)

"BLD",5068,"KRN",19.1,0)
19.1
"BLD",5068,"KRN",19.1,"NM",0)
^9.68A^7^5
"BLD",5068,"KRN",19.1,"NM",1,0)
ROR VA HEPC ADMIN^^0
"BLD",5068,"KRN",19.1,"NM",2,0)
ROR VA HEPC USER^^0
"BLD",5068,"KRN",19.1,"NM",5,0)
ROR VA IRM^^0
"BLD",5068,"KRN",19.1,"NM",6,0)
ROR VA HIV ADMIN^^0
"BLD",5068,"KRN",19.1,"NM",7,0)
ROR VA HIV USER^^0
"BLD",5068,"KRN",19.1,"NM","B","ROR VA HEPC ADMIN",1)

"BLD",5068,"KRN",19.1,"NM","B","ROR VA HEPC USER",2)

"BLD",5068,"KRN",19.1,"NM","B","ROR VA HIV ADMIN",6)

"BLD",5068,"KRN",19.1,"NM","B","ROR VA HIV USER",7)

"BLD",5068,"KRN",19.1,"NM","B","ROR VA IRM",5)

"BLD",5068,"KRN",101,0)
101
"BLD",5068,"KRN",101,"NM",0)
^9.68A^7^7
"BLD",5068,"KRN",101,"NM",1,0)
ROR EVENT LAB^^0
"BLD",5068,"KRN",101,"NM",2,0)
ROR EVENT PTF^^0
"BLD",5068,"KRN",101,"NM",3,0)
ROR EVENT VISIT^^0
"BLD",5068,"KRN",101,"NM",4,0)
ROR-SITE-DRIVER^^0
"BLD",5068,"KRN",101,"NM",5,0)
ROR-SITE-SUBSCRIBER^^0
"BLD",5068,"KRN",101,"NM",6,0)
RORICR-SITE-DRIVER^^1^
"BLD",5068,"KRN",101,"NM",7,0)
RORICR-SITE-SUBSCRIBER^^1^
"BLD",5068,"KRN",101,"NM","B","ROR EVENT LAB",1)

"BLD",5068,"KRN",101,"NM","B","ROR EVENT PTF",2)

"BLD",5068,"KRN",101,"NM","B","ROR EVENT VISIT",3)

"BLD",5068,"KRN",101,"NM","B","ROR-SITE-DRIVER",4)

"BLD",5068,"KRN",101,"NM","B","ROR-SITE-SUBSCRIBER",5)

"BLD",5068,"KRN",101,"NM","B","RORICR-SITE-DRIVER",6)

"BLD",5068,"KRN",101,"NM","B","RORICR-SITE-SUBSCRIBER",7)

"BLD",5068,"KRN",409.61,0)
409.61
"BLD",5068,"KRN",771,0)
771
"BLD",5068,"KRN",771,"NM",0)
^9.68A^2^2
"BLD",5068,"KRN",771,"NM",1,0)
ROR AAC^^0
"BLD",5068,"KRN",771,"NM",2,0)
ROR SITE^^0
"BLD",5068,"KRN",771,"NM","B","ROR AAC",1)

"BLD",5068,"KRN",771,"NM","B","ROR SITE",2)

"BLD",5068,"KRN",870,0)
870
"BLD",5068,"KRN",870,"NM",0)
^9.68A^2^2
"BLD",5068,"KRN",870,"NM",1,0)
ROR SEND^^0
"BLD",5068,"KRN",870,"NM",2,0)
RORICR SND^^1^
"BLD",5068,"KRN",870,"NM","B","ROR SEND",1)

"BLD",5068,"KRN",870,"NM","B","RORICR SND",2)

"BLD",5068,"KRN",8989.51,0)
8989.51
"BLD",5068,"KRN",8989.51,"NM",0)
^9.68A^3^3
"BLD",5068,"KRN",8989.51,"NM",1,0)
ROR REPORT PARAMS TEMPLATE^^0
"BLD",5068,"KRN",8989.51,"NM",2,0)
ROR GUI PARAMETER^^0
"BLD",5068,"KRN",8989.51,"NM",3,0)
ROR VA HEPC GUI SETTINGS^^1^
"BLD",5068,"KRN",8989.51,"NM","B","ROR GUI PARAMETER",2)

"BLD",5068,"KRN",8989.51,"NM","B","ROR REPORT PARAMS TEMPLATE",1)

"BLD",5068,"KRN",8989.51,"NM","B","ROR VA HEPC GUI SETTINGS",3)

"BLD",5068,"KRN",8989.52,0)
8989.52
"BLD",5068,"KRN",8994,0)
8994
"BLD",5068,"KRN",8994,"NM",0)
^9.68A^78^78
"BLD",5068,"KRN",8994,"NM",1,0)
ROR LIST PARAMETER INSTANCES^^0
"BLD",5068,"KRN",8994,"NM",2,0)
ROR GUI PARAMETER GET^^0
"BLD",5068,"KRN",8994,"NM",3,0)
ROR GUI PARAMETER SET^^0
"BLD",5068,"KRN",8994,"NM",4,0)
ROR ACTIVATE INACTIVATE^^1^
"BLD",5068,"KRN",8994,"NM",5,0)
ROR ACTIVATE PATIENT GET^^1^
"BLD",5068,"KRN",8994,"NM",6,0)
ROR ACTIVITY DETAILS^^1^
"BLD",5068,"KRN",8994,"NM",7,0)
ROR ACTIVITY LOG^^1^
"BLD",5068,"KRN",8994,"NM",8,0)
ROR CLEAR RPC HANDLE^^1^
"BLD",5068,"KRN",8994,"NM",9,0)
ROR DRUG REPORT^^1^
"BLD",5068,"KRN",8994,"NM",10,0)
ROR EDIT PATIENT GET^^1^
"BLD",5068,"KRN",8994,"NM",11,0)
ROR ENTER EDIT PATIENT^^1^
"BLD",5068,"KRN",8994,"NM",12,0)
ROR GET CODE LIST^^1^
"BLD",5068,"KRN",8994,"NM",13,0)
ROR GET GUI PARAMS^^1^
"BLD",5068,"KRN",8994,"NM",14,0)
ROR GET REGISTRY INFO^^0
"BLD",5068,"KRN",8994,"NM",15,0)
ROR GET RPC HANDLE^^1^
"BLD",5068,"KRN",8994,"NM",16,0)
ROR GET SERVER TIME^^0
"BLD",5068,"KRN",8994,"NM",17,0)
ROR GET USER INFO^^0
"BLD",5068,"KRN",8994,"NM",18,0)
ROR GET USER NAME^^1^
"BLD",5068,"KRN",8994,"NM",19,0)
ROR GUI ACCESS^^0
"BLD",5068,"KRN",8994,"NM",20,0)
ROR GUI PARAMETER RENAME^^0
"BLD",5068,"KRN",8994,"NM",21,0)
ROR IDRUGS PATIENT SET^^1^
"BLD",5068,"KRN",8994,"NM",22,0)
ROR INV DRUGS^^1^
"BLD",5068,"KRN",8994,"NM",23,0)
ROR LIST COORDINATORS^^0
"BLD",5068,"KRN",8994,"NM",24,0)
ROR LIST DIVISIONS^^0
"BLD",5068,"KRN",8994,"NM",25,0)
ROR LIST DRUGS^^0
"BLD",5068,"KRN",8994,"NM",26,0)
ROR LIST GENERIC DRUGS^^0
"BLD",5068,"KRN",8994,"NM",27,0)
ROR LIST HOSPITAL LOCATIONS^^0
"BLD",5068,"KRN",8994,"NM",28,0)
ROR LIST ICD-9^^0
"BLD",5068,"KRN",8994,"NM",29,0)
ROR LIST ITEMS^^0
"BLD",5068,"KRN",8994,"NM",30,0)
ROR LIST LABORATORY TESTS^^0
"BLD",5068,"KRN",8994,"NM",31,0)
ROR LIST LOCAL DRUGS^^0
"BLD",5068,"KRN",8994,"NM",32,0)
ROR LIST LOCAL LAB TESTS^^0
"BLD",5068,"KRN",8994,"NM",33,0)
ROR LIST PATIENTS^^0
"BLD",5068,"KRN",8994,"NM",34,0)
ROR LIST REGISTRY USERS^^0
"BLD",5068,"KRN",8994,"NM",35,0)
ROR LIST STATES^^0
"BLD",5068,"KRN",8994,"NM",36,0)
ROR LIST VA DRUG CLASSES^^0
"BLD",5068,"KRN",8994,"NM",37,0)
ROR LIST VISTA USERS^^0
"BLD",5068,"KRN",8994,"NM",38,0)
ROR LOG GET ACCESS VIOLATIONS^^0
"BLD",5068,"KRN",8994,"NM",39,0)
ROR LOG GET LIST^^0
"BLD",5068,"KRN",8994,"NM",40,0)
ROR LOG GET MESSAGES^^0
"BLD",5068,"KRN",8994,"NM",41,0)
ROR LOG INFO^^0
"BLD",5068,"KRN",8994,"NM",42,0)
ROR LOG MESSAGE DETAILS^^0
"BLD",5068,"KRN",8994,"NM",43,0)
ROR PATIENT (IN)ACTIVATE^^1^
"BLD",5068,"KRN",8994,"NM",44,0)
ROR PATIENT CHECKS^^1^
"BLD",5068,"KRN",8994,"NM",45,0)
ROR PATIENT DELETE^^0
"BLD",5068,"KRN",8994,"NM",46,0)
ROR PATIENT GET DATA^^0
"BLD",5068,"KRN",8994,"NM",47,0)
ROR PATIENT SEARCH^^1^
"BLD",5068,"KRN",8994,"NM",48,0)
ROR PATIENT SELECTION RULES^^0
"BLD",5068,"KRN",8994,"NM",49,0)
ROR REG PARAMS GET^^1^
"BLD",5068,"KRN",8994,"NM",50,0)
ROR REPORT^^1^
"BLD",5068,"KRN",8994,"NM",51,0)
ROR REPORT RETRIEVE^^0
"BLD",5068,"KRN",8994,"NM",52,0)
ROR REPORT SCHEDULE^^0
"BLD",5068,"KRN",8994,"NM",53,0)
ROR REPORT STYLESHEET^^0
"BLD",5068,"KRN",8994,"NM",54,0)
ROR REPORTS AVAILABLE^^0
"BLD",5068,"KRN",8994,"NM",55,0)
ROR SET GUI PARAMS^^1^
"BLD",5068,"KRN",8994,"NM",56,0)
ROR STORE RPC HANDLE^^1^
"BLD",5068,"KRN",8994,"NM",57,0)
ROR TASK DELETE^^0
"BLD",5068,"KRN",8994,"NM",58,0)
ROR TASK INFO^^0
"BLD",5068,"KRN",8994,"NM",59,0)
ROR TASK LIST^^0
"BLD",5068,"KRN",8994,"NM",60,0)
ROR TASK VALIDATE RESCHEDULING^^0
"BLD",5068,"KRN",8994,"NM",61,0)
ROR UPDATE COORDINATORS^^0
"BLD",5068,"KRN",8994,"NM",62,0)
ROR UPDATE LOCAL DRUGS^^0
"BLD",5068,"KRN",8994,"NM",63,0)
ROR UPDATE LOCAL LAB TESTS^^0
"BLD",5068,"KRN",8994,"NM",64,0)
RORHEPC PATIENT CANCEL^^1^
"BLD",5068,"KRN",8994,"NM",65,0)
RORHEPC PATIENT LOAD^^0
"BLD",5068,"KRN",8994,"NM",66,0)
RORHEPC PATIENT SAVE^^0
"BLD",5068,"KRN",8994,"NM",67,0)
RORICR CDC CANCEL^^0
"BLD",5068,"KRN",8994,"NM",68,0)
RORICR CDC LOAD^^0
"BLD",5068,"KRN",8994,"NM",69,0)
RORICR CDC SAVE^^0
"BLD",5068,"KRN",8994,"NM",70,0)
RORICR PATIENT CANCEL^^1^
"BLD",5068,"KRN",8994,"NM",71,0)
RORICR PATIENT LOAD^^0
"BLD",5068,"KRN",8994,"NM",72,0)
RORICR PATIENT SAVE^^0
"BLD",5068,"KRN",8994,"NM",73,0)
ROR LIST LOCAL FIELDS^^0
"BLD",5068,"KRN",8994,"NM",74,0)
ROR UPDATE LOCAL FIELDS^^0
"BLD",5068,"KRN",8994,"NM",75,0)
ROR LIST SELECTION RULES^^0
"BLD",5068,"KRN",8994,"NM",76,0)
ROR PRODUCTION ACCOUNT^^0
"BLD",5068,"KRN",8994,"NM",77,0)
ROR PATIENT REGISTRY LABS^^0
"BLD",5068,"KRN",8994,"NM",78,0)
ROR LIST CPT^^0
"BLD",5068,"KRN",8994,"NM","B","ROR ACTIVATE INACTIVATE",4)

"BLD",5068,"KRN",8994,"NM","B","ROR ACTIVATE PATIENT GET",5)

"BLD",5068,"KRN",8994,"NM","B","ROR ACTIVITY DETAILS",6)

"BLD",5068,"KRN",8994,"NM","B","ROR ACTIVITY LOG",7)

"BLD",5068,"KRN",8994,"NM","B","ROR CLEAR RPC HANDLE",8)

"BLD",5068,"KRN",8994,"NM","B","ROR DRUG REPORT",9)

"BLD",5068,"KRN",8994,"NM","B","ROR EDIT PATIENT GET",10)

"BLD",5068,"KRN",8994,"NM","B","ROR ENTER EDIT PATIENT",11)

"BLD",5068,"KRN",8994,"NM","B","ROR GET CODE LIST",12)

"BLD",5068,"KRN",8994,"NM","B","ROR GET GUI PARAMS",13)

"BLD",5068,"KRN",8994,"NM","B","ROR GET REGISTRY INFO",14)

"BLD",5068,"KRN",8994,"NM","B","ROR GET RPC HANDLE",15)

"BLD",5068,"KRN",8994,"NM","B","ROR GET SERVER TIME",16)

"BLD",5068,"KRN",8994,"NM","B","ROR GET USER INFO",17)

"BLD",5068,"KRN",8994,"NM","B","ROR GET USER NAME",18)

"BLD",5068,"KRN",8994,"NM","B","ROR GUI ACCESS",19)

"BLD",5068,"KRN",8994,"NM","B","ROR GUI PARAMETER GET",2)

"BLD",5068,"KRN",8994,"NM","B","ROR GUI PARAMETER RENAME",20)

"BLD",5068,"KRN",8994,"NM","B","ROR GUI PARAMETER SET",3)

"BLD",5068,"KRN",8994,"NM","B","ROR IDRUGS PATIENT SET",21)

"BLD",5068,"KRN",8994,"NM","B","ROR INV DRUGS",22)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST COORDINATORS",23)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST CPT",78)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST DIVISIONS",24)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST DRUGS",25)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST GENERIC DRUGS",26)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST HOSPITAL LOCATIONS",27)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST ICD-9",28)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST ITEMS",29)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST LABORATORY TESTS",30)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST LOCAL DRUGS",31)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST LOCAL FIELDS",73)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST LOCAL LAB TESTS",32)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST PARAMETER INSTANCES",1)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST PATIENTS",33)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST REGISTRY USERS",34)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST SELECTION RULES",75)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST STATES",35)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST VA DRUG CLASSES",36)

"BLD",5068,"KRN",8994,"NM","B","ROR LIST VISTA USERS",37)

"BLD",5068,"KRN",8994,"NM","B","ROR LOG GET ACCESS VIOLATIONS",38)

"BLD",5068,"KRN",8994,"NM","B","ROR LOG GET LIST",39)

"BLD",5068,"KRN",8994,"NM","B","ROR LOG GET MESSAGES",40)

"BLD",5068,"KRN",8994,"NM","B","ROR LOG INFO",41)

"BLD",5068,"KRN",8994,"NM","B","ROR LOG MESSAGE DETAILS",42)

"BLD",5068,"KRN",8994,"NM","B","ROR PATIENT (IN)ACTIVATE",43)

"BLD",5068,"KRN",8994,"NM","B","ROR PATIENT CHECKS",44)

"BLD",5068,"KRN",8994,"NM","B","ROR PATIENT DELETE",45)

"BLD",5068,"KRN",8994,"NM","B","ROR PATIENT GET DATA",46)

"BLD",5068,"KRN",8994,"NM","B","ROR PATIENT REGISTRY LABS",77)

"BLD",5068,"KRN",8994,"NM","B","ROR PATIENT SEARCH",47)

"BLD",5068,"KRN",8994,"NM","B","ROR PATIENT SELECTION RULES",48)

"BLD",5068,"KRN",8994,"NM","B","ROR PRODUCTION ACCOUNT",76)

"BLD",5068,"KRN",8994,"NM","B","ROR REG PARAMS GET",49)

"BLD",5068,"KRN",8994,"NM","B","ROR REPORT",50)

"BLD",5068,"KRN",8994,"NM","B","ROR REPORT RETRIEVE",51)

"BLD",5068,"KRN",8994,"NM","B","ROR REPORT SCHEDULE",52)

"BLD",5068,"KRN",8994,"NM","B","ROR REPORT STYLESHEET",53)

"BLD",5068,"KRN",8994,"NM","B","ROR REPORTS AVAILABLE",54)

"BLD",5068,"KRN",8994,"NM","B","ROR SET GUI PARAMS",55)

"BLD",5068,"KRN",8994,"NM","B","ROR STORE RPC HANDLE",56)

"BLD",5068,"KRN",8994,"NM","B","ROR TASK DELETE",57)

"BLD",5068,"KRN",8994,"NM","B","ROR TASK INFO",58)

"BLD",5068,"KRN",8994,"NM","B","ROR TASK LIST",59)

"BLD",5068,"KRN",8994,"NM","B","ROR TASK VALIDATE RESCHEDULING",60)

"BLD",5068,"KRN",8994,"NM","B","ROR UPDATE COORDINATORS",61)

"BLD",5068,"KRN",8994,"NM","B","ROR UPDATE LOCAL DRUGS",62)

"BLD",5068,"KRN",8994,"NM","B","ROR UPDATE LOCAL FIELDS",74)

"BLD",5068,"KRN",8994,"NM","B","ROR UPDATE LOCAL LAB TESTS",63)

"BLD",5068,"KRN",8994,"NM","B","RORHEPC PATIENT CANCEL",64)

"BLD",5068,"KRN",8994,"NM","B","RORHEPC PATIENT LOAD",65)

"BLD",5068,"KRN",8994,"NM","B","RORHEPC PATIENT SAVE",66)

"BLD",5068,"KRN",8994,"NM","B","RORICR CDC CANCEL",67)

"BLD",5068,"KRN",8994,"NM","B","RORICR CDC LOAD",68)

"BLD",5068,"KRN",8994,"NM","B","RORICR CDC SAVE",69)

"BLD",5068,"KRN",8994,"NM","B","RORICR PATIENT CANCEL",70)

"BLD",5068,"KRN",8994,"NM","B","RORICR PATIENT LOAD",71)

"BLD",5068,"KRN",8994,"NM","B","RORICR PATIENT SAVE",72)

"BLD",5068,"KRN","B",.4,.4)

"BLD",5068,"KRN","B",.401,.401)

"BLD",5068,"KRN","B",.402,.402)

"BLD",5068,"KRN","B",.403,.403)

"BLD",5068,"KRN","B",.5,.5)

"BLD",5068,"KRN","B",.84,.84)

"BLD",5068,"KRN","B",3.6,3.6)

"BLD",5068,"KRN","B",3.8,3.8)

"BLD",5068,"KRN","B",9.2,9.2)

"BLD",5068,"KRN","B",9.8,9.8)

"BLD",5068,"KRN","B",19,19)

"BLD",5068,"KRN","B",19.1,19.1)

"BLD",5068,"KRN","B",101,101)

"BLD",5068,"KRN","B",409.61,409.61)

"BLD",5068,"KRN","B",771,771)

"BLD",5068,"KRN","B",870,870)

"BLD",5068,"KRN","B",8989.51,8989.51)

"BLD",5068,"KRN","B",8989.52,8989.52)

"BLD",5068,"KRN","B",8994,8994)

"BLD",5068,"PRE")
RORP000
"BLD",5068,"PRET")
PTR^RORP000
"BLD",5068,"QUES",0)
^9.62^^
"BLD",5068,"REQB",0)
^9.611^15^15
"BLD",5068,"REQB",1,0)
PSS*1.0*97^2
"BLD",5068,"REQB",2,0)
PSN*4.0*104^2
"BLD",5068,"REQB",3,0)
LA*5.2*69^2
"BLD",5068,"REQB",4,0)
PSN*4.0*79^2
"BLD",5068,"REQB",5,0)
SD*5.3*131^2
"BLD",5068,"REQB",6,0)
DG*5.3*631^2
"BLD",5068,"REQB",7,0)
PSS*1.0*101^2
"BLD",5068,"REQB",8,0)
PSS*1.0*105^2
"BLD",5068,"REQB",9,0)
DG*5.3*471^2
"BLD",5068,"REQB",10,0)
DG*5.3*415^2
"BLD",5068,"REQB",11,0)
HL*1.6*57^2
"BLD",5068,"REQB",12,0)
LR*5.2*222^2
"BLD",5068,"REQB",13,0)
LR*5.2*232^2
"BLD",5068,"REQB",14,0)
PSN*4.0*53^2
"BLD",5068,"REQB",15,0)
SD*5.3*254^2
"BLD",5068,"REQB","B","DG*5.3*415",10)

"BLD",5068,"REQB","B","DG*5.3*471",9)

"BLD",5068,"REQB","B","DG*5.3*631",6)

"BLD",5068,"REQB","B","HL*1.6*57",11)

"BLD",5068,"REQB","B","LA*5.2*69",3)

"BLD",5068,"REQB","B","LR*5.2*222",12)

"BLD",5068,"REQB","B","LR*5.2*232",13)

"BLD",5068,"REQB","B","PSN*4.0*104",2)

"BLD",5068,"REQB","B","PSN*4.0*53",14)

"BLD",5068,"REQB","B","PSN*4.0*79",4)

"BLD",5068,"REQB","B","PSS*1.0*101",7)

"BLD",5068,"REQB","B","PSS*1.0*105",8)

"BLD",5068,"REQB","B","PSS*1.0*97",1)

"BLD",5068,"REQB","B","SD*5.3*131",5)

"BLD",5068,"REQB","B","SD*5.3*254",15)

"DATA",798.1,1,0)
VA HEPC^^^Hepatitis C Registry^7300^1^^^^0^1^^^1
"DATA",798.1,1,1,0)
^798.13^8^5
"DATA",798.1,1,1,3,0)
VA HEPC PROBLEM
"DATA",798.1,1,1,5,0)
VA HEPC LAB
"DATA",798.1,1,1,6,0)
VA HEPC PTF
"DATA",798.1,1,1,7,0)
VA HEPC VPOV
"DATA",798.1,1,1,8,0)
VA HEPC 1.0 CONVERSION
"DATA",798.1,1,3,0)
^798.11S^^
"DATA",798.1,1,4)

"DATA",798.1,1,7)

"DATA",798.1,1,8,0)
^798.112I^1^1
"DATA",798.1,1,8,1,0)
*^^CH
"DATA",798.1,1,9)
^5^2^CCRAutoNotification@med.va.gov
"DATA",798.1,1,10,0)
^798.114P^^0
"DATA",798.1,1,11)
7^^
"DATA",798.1,1,18,0)
^798.118^2^2
"DATA",798.1,1,18,1,0)
ROR VA HEPC ADMIN
"DATA",798.1,1,18,2,0)
ROR VA HEPC USER
"DATA",798.1,1,19)
^^^
"DATA",798.1,1,21)
^^^
"DATA",798.1,1,22,0)
^798.122^^
"DATA",798.1,1,27)
1,2,3,4,5,6,7,9,10,11,12,13,14,15,16,17
"DATA",798.1,1,30,0)
^798.12P^^0
"DATA",798.1,2,0)
VA HIV^^^Human Immunodeficiency Virus Registry^7300^1^^^^0^1^GAVRILOV,SERGUEI@FORUM.VA.GOV^^1
"DATA",798.1,2,1,0)
^798.13^5^5
"DATA",798.1,2,1,1,0)
VA HIV PROBLEM
"DATA",798.1,2,1,2,0)
VA HIV PTF
"DATA",798.1,2,1,3,0)
VA HIV VPOV
"DATA",798.1,2,1,4,0)
VA HIV LAB
"DATA",798.1,2,1,5,0)
VA HIV 2.1 CONVERSION
"DATA",798.1,2,4)

"DATA",798.1,2,5)
$$POSTUPD^RORUPD62
"DATA",798.1,2,7)

"DATA",798.1,2,8,0)
^798.112I^1^1
"DATA",798.1,2,8,1,0)
*^^CH
"DATA",798.1,2,9)
^5^2^CCRAutoNotification@med.va.gov
"DATA",798.1,2,10,0)
^798.114P^^0
"DATA",798.1,2,11)
7^^
"DATA",798.1,2,18,0)
^798.118^2^2
"DATA",798.1,2,18,1,0)
ROR VA HIV USER
"DATA",798.1,2,18,2,0)
ROR VA HIV ADMIN
"DATA",798.1,2,19)
^^^^
"DATA",798.1,2,21)
^^^
"DATA",798.1,2,22,0)
^798.122^^
"DATA",798.1,2,27)
1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
"DATA",798.1,2,28,0)
^798.128PI^^
"DATA",798.1,2,29,0)
^798.129P^^
"DATA",798.1,2,30,0)
^798.12P^^0
"DATA",798.2,4,0)
VA HEPC VPOV^9000010.07^ICD-9 code in outpatient file^1
"DATA",798.2,4,1)
",V02.62,070.41,070.44,070.51,070.54,"[(","_{E:POV}_",")
"DATA",798.2,4,3,0)
^798.25^1^1^3050801^^^^
"DATA",798.2,4,3,1,0)
 
"DATA",798.2,6,0)
VA HEPC PTF^45^ICD-9 code in inpatient file^1
"DATA",798.2,6,1)
$$PTFRULE^RORUPD09(",V02.62,070.41,070.44,070.51,070.54,")
"DATA",798.2,6,4,0)
^798.26^11^11
"DATA",798.2,6,4,1,0)
101^E
"DATA",798.2,6,4,2,0)
102^E
"DATA",798.2,6,4,3,0)
103^E
"DATA",798.2,6,4,4,0)
104^E
"DATA",798.2,6,4,5,0)
105^E
"DATA",798.2,6,4,6,0)
106^E
"DATA",798.2,6,4,7,0)
107^E
"DATA",798.2,6,4,8,0)
108^E
"DATA",798.2,6,4,9,0)
109^E
"DATA",798.2,6,4,10,0)
110^E
"DATA",798.2,6,4,11,0)
111^E
"DATA",798.2,7,0)
VA HEPC PROBLEM^9000011^ICD-9 code in problem list^1
"DATA",798.2,7,1)
",V02.62,070.41,070.44,070.51,070.54,"[(","_{E:DIAGNOSIS}_",")
"DATA",798.2,8,0)
VA HEPC LAB^63^HepC Ab test positive^1
"DATA",798.2,8,1)
{LS:VA HEPC}
"DATA",798.2,11,0)
VA HEPC PTF HIST^45^ICD-9 codes in inpatient file^1
"DATA",798.2,11,1)
{SUM:VA HEPC PTF}>1
"DATA",798.2,12,0)
VA HEPC VISIT^9000010^ICD-9 code in outpatient file^1
"DATA",798.2,12,1)
{SUM:VA HEPC VPOV}>0
"DATA",798.2,12,4,0)
^798.26^^
"DATA",798.2,13,0)
VA HEPC VISIT HIST^9000010^ICD-9 codes in outpatient file^1
"DATA",798.2,13,1)
{SUM:VA HEPC VISIT}>1
"DATA",798.2,14,0)
VA HIV PTF^45^ICD-9 code in inpatient file^1
"DATA",798.2,14,1)
$$PTFRULE^RORUPD09(",V08.,042.,042.0,042.1,042.2,042.9,043.0,043.2,043.3,043.9,044.0,044.9,079.53,795.71,795.8,")
"DATA",798.2,14,4,0)
^798.26^11^11
"DATA",798.2,14,4,1,0)
101^E
"DATA",798.2,14,4,2,0)
102^E
"DATA",798.2,14,4,3,0)
103^E
"DATA",798.2,14,4,4,0)
104^E
"DATA",798.2,14,4,5,0)
105^E
"DATA",798.2,14,4,6,0)
106^E
"DATA",798.2,14,4,7,0)
107^E
"DATA",798.2,14,4,8,0)
108^E
"DATA",798.2,14,4,9,0)
109^E
"DATA",798.2,14,4,10,0)
110^E
"DATA",798.2,14,4,11,0)
111^E
"DATA",798.2,15,0)
VA HIV PROBLEM^9000011^ICD-9 code in problem list^1
"DATA",798.2,15,1)
",V08.,042.,042.0,042.1,042.2,042.9,043.0,043.2,043.3,043.9,044.0,044.9,079.53,795.71,795.8,"[(","_{E:DIAGNOSIS}_",")
"DATA",798.2,16,0)
VA HIV VPOV^9000010.07^ICD-9 code in outpatient file^1
"DATA",798.2,16,1)
",V08.,042.,042.0,042.1,042.2,042.9,043.0,043.2,043.3,043.9,044.0,044.9,079.53,795.71,795.8,"[(","_{E:POV}_",")
"DATA",798.2,16,3,0)
^798.25^1^1^3050419^^^^
"DATA",798.2,16,3,1,0)
 
"DATA",798.2,17,0)
VA HIV LAB^63^HIV Ab test positive^1
"DATA",798.2,17,1)
{LS:VA HIV}
"DATA",798.2,18,0)
VA HIV 2.1 CONVERSION^2^Included from old registry^1
"DATA",798.2,18,1)
0
"DATA",798.2,19,0)
VA HEPC 1.0 CONVERSION^2^Included from old registry^1
"DATA",798.2,19,1)
0
"DATA",798.6,4,0)
565^1
"DATA",798.6,5,0)
566^2
"DATA",798.9,3,0)
VA HEPC^0^1
"DATA",798.9,3,1,0)
^798.92^19^17
"DATA",798.9,3,1,2,0)
13955^^6
"DATA",798.9,3,1,3,0)
16128^^6
"DATA",798.9,3,1,4,0)
22327^^6
"DATA",798.9,3,1,6,0)
5198^^6
"DATA",798.9,3,1,7,0)
5199^^6
"DATA",798.9,3,1,8,0)
24011^^6
"DATA",798.9,3,1,9,0)
39008^^6
"DATA",798.9,3,1,10,0)
33462^^6
"DATA",798.9,3,1,11,0)
40726^^6
"DATA",798.9,3,1,12,0)
16129^^6
"DATA",798.9,3,1,13,0)
16936^^6
"DATA",798.9,3,1,14,0)
34162^^6
"DATA",798.9,3,1,15,0)
5010^^6
"DATA",798.9,3,1,16,0)
5012^^6
"DATA",798.9,3,1,17,0)
11259^^6
"DATA",798.9,3,1,18,0)
6422^^6
"DATA",798.9,3,1,19,0)
5011^^6
"DATA",798.9,4,0)
VA HIV^^1
"DATA",798.9,4,1,0)
^798.92^37^35
"DATA",798.9,4,1,1,0)
29327^^6
"DATA",798.9,4,1,4,0)
31201^^6
"DATA",798.9,4,1,5,0)
32571^^6
"DATA",798.9,4,1,6,0)
32602^^6
"DATA",798.9,4,1,7,0)
33866^^6
"DATA",798.9,4,1,8,0)
5223^^6
"DATA",798.9,4,1,9,0)
5224^^6
"DATA",798.9,4,1,10,0)
5225^^6
"DATA",798.9,4,1,11,0)
5220^^6
"DATA",798.9,4,1,12,0)
5221^^6
"DATA",798.9,4,1,13,0)
7917^^6
"DATA",798.9,4,1,14,0)
7918^^6
"DATA",798.9,4,1,15,0)
7919^^6
"DATA",798.9,4,1,16,0)
29893^^6
"DATA",798.9,4,1,17,0)
14092^^6
"DATA",798.9,4,1,18,0)
16974^^6
"DATA",798.9,4,1,19,0)
21007^^6
"DATA",798.9,4,1,20,0)
22356^^6
"DATA",798.9,4,1,21,0)
22357^^6
"DATA",798.9,4,1,22,0)
22358^^6
"DATA",798.9,4,1,23,0)
30361^^6
"DATA",798.9,4,1,24,0)
16975^^6
"DATA",798.9,4,1,25,0)
13499^^6
"DATA",798.9,4,1,26,0)
21009^^6
"DATA",798.9,4,1,27,0)
41143^^6
"DATA",798.9,4,1,28,0)
41144^^6
"DATA",798.9,4,1,29,0)
35437^^6
"DATA",798.9,4,1,30,0)
35438^^6
"DATA",798.9,4,1,31,0)
35439^^6
"DATA",798.9,4,1,32,0)
41145^^6
"DATA",798.9,4,1,33,0)
40732^^6
"DATA",798.9,4,1,34,0)
40733^^6
"DATA",798.9,4,1,35,0)
31073^^6
"DATA",798.9,4,1,36,0)
33806^^6
"DATA",798.9,4,1,37,0)
33807^^6
"DATA",799.2,2,0)
2
"DATA",799.2,45,0)
45^2
"DATA",799.2,45,2,0)
^799.22I^13^13
"DATA",799.2,45,2,1,0)
DXLS^101^^E^2^79
"DATA",799.2,45,2,1,4.1)
3^1
"DATA",799.2,45,2,2,0)
ICD02^102^^E^2^79.16
"DATA",799.2,45,2,2,4.1)
1^2
"DATA",799.2,45,2,3,0)
ICD03^103^^E^2^79.17
"DATA",799.2,45,2,3,4.1)
2^2
"DATA",799.2,45,2,4,0)
ICD04^104^^E^2^79.18
"DATA",799.2,45,2,4,4.1)
3^2
"DATA",799.2,45,2,5,0)
ICD05^105^^E^2^79.19
"DATA",799.2,45,2,5,4.1)
4^2
"DATA",799.2,45,2,6,0)
ICD06^106^^E^2^79.201
"DATA",799.2,45,2,6,4.1)
5^2
"DATA",799.2,45,2,7,0)
ICD07^107^^E^2^79.21
"DATA",799.2,45,2,7,4.1)
6^2
"DATA",799.2,45,2,8,0)
ICD08^108^^E^2^79.22
"DATA",799.2,45,2,8,4.1)
7^2
"DATA",799.2,45,2,9,0)
ICD09^109^^E^2^79.23
"DATA",799.2,45,2,9,4.1)
8^2
"DATA",799.2,45,2,10,0)
ICD10^110^^E^2^79.24
"DATA",799.2,45,2,10,4.1)
9^2
"DATA",799.2,45,2,11,0)
PRINCIPAL DIAGNOSIS^111^^E^1^80
"DATA",799.2,45,2,12,0)
FACILITY^131^1^I^1^3
"DATA",799.2,45,2,13,0)
SUFFIX^132^1^I^1^5
"DATA",799.2,45,3,0)
^799.23I^2^1
"DATA",799.2,45,3,2,0)
2^DGPTFAPI^RPC^3157
"DATA",799.2,63,0)
63^2
"DATA",799.2,9000010,0)
9000010^2
"DATA",799.2,9000010,2,0)
^799.22I^1^1
"DATA",799.2,9000010,2,1,0)
ENCOUNTER LOCATION^129^1^EI^2^.06
"DATA",799.2,9000010,2,1,4.1)
2^INS
"DATA",799.2,9000010,2,1,4.2)
1^INS
"DATA",799.2,9000010,3,0)
^799.23I^2^1
"DATA",799.2,9000010,3,2,0)
2^VSIT^LOOKUP^1906
"DATA",799.2,9000010.07,0)
9000010.07^9000010
"DATA",799.2,9000010.07,2,0)
^799.22I^4^4
"DATA",799.2,9000010.07,2,1,0)
POV^112^^E^2^.01
"DATA",799.2,9000010.07,2,2,0)
MODIFIER^113^^I^2^.06
"DATA",799.2,9000010.07,2,2,4.2)
6
"DATA",799.2,9000010.07,2,3,0)
PRIMARY/SECONDARY^114^^I^2^.12
"DATA",799.2,9000010.07,2,3,4.2)
12
"DATA",799.2,9000010.07,2,4,0)
DATE OF INJURY^115^^I^2^.13
"DATA",799.2,9000010.07,2,4,4.2)
13
"DATA",799.2,9000010.07,3,0)
^799.23I^2^1
"DATA",799.2,9000010.07,3,2,0)
2^PXAPIIB^POV^1554
"DATA",799.2,9000011,0)
9000011^2
"DATA",799.2,9000011,2,0)
^799.22I^14^14
"DATA",799.2,9000011,2,1,0)
DIAGNOSIS^116^^E^2^.01
"DATA",799.2,9000011,2,1,4.1)
2^.01
"DATA",799.2,9000011,2,2,0)
DATE LAST MODIFIED^128^^EI^2^.03
"DATA",799.2,9000011,2,2,4.1)
2^.03
"DATA",799.2,9000011,2,2,4.2)
1^.03
"DATA",799.2,9000011,2,3,0)
PROVIDER NARRATIVE^117^^EI^2^.05
"DATA",799.2,9000011,2,3,4.1)
2^.05
"DATA",799.2,9000011,2,3,4.2)
1^.05
"DATA",799.2,9000011,2,4,0)
DATE ENTERED^118^1^EI^2^.08
"DATA",799.2,9000011,2,4,4.1)
2^.08
"DATA",799.2,9000011,2,4,4.2)
1^.08
"DATA",799.2,9000011,2,5,0)
DATE OF ONSET^119^^EI^2^.13
"DATA",799.2,9000011,2,5,4.1)
2^.13
"DATA",799.2,9000011,2,5,4.2)
1^.13
"DATA",799.2,9000011,2,6,0)
PROBLEM^120^^EI^2^1.01
"DATA",799.2,9000011,2,6,4.1)
2^1.01
"DATA",799.2,9000011,2,6,4.2)
1^1.01
"DATA",799.2,9000011,2,7,0)
CONDITION^121^1^I^2^1.02
"DATA",799.2,9000011,2,7,4.2)
1^1.02
"DATA",799.2,9000011,2,8,0)
DATE RESOLVED^122^^EI^2^1.07
"DATA",799.2,9000011,2,8,4.1)
2^1.07
"DATA",799.2,9000011,2,8,4.2)
1^1.07
"DATA",799.2,9000011,2,9,0)
DATE RECORDED^123^^EI^2^1.09
"DATA",799.2,9000011,2,9,4.1)
2^1.09
"DATA",799.2,9000011,2,9,4.2)
1^1.09
"DATA",799.2,9000011,2,10,0)
SERVICE CONNECTED^124^^I^2^1.1
"DATA",799.2,9000011,2,10,4.2)
1^1.1
"DATA",799.2,9000011,2,11,0)
AGENT ORANGE EXPOSURE^125^^I^2^1.11
"DATA",799.2,9000011,2,11,4.2)
1^1.11
"DATA",799.2,9000011,2,12,0)
IONIZING RADIATION EXPOSURE^126^^I^2^1.12
"DATA",799.2,9000011,2,12,4.2)
1^1.12
"DATA",799.2,9000011,2,13,0)
PERSIAN GULF EXPOSURE^127^^I^2^1.13
"DATA",799.2,9000011,2,13,4.2)
1^1.13
"DATA",799.2,9000011,2,14,0)
CLINIC^130^1^EI^2^1.08
"DATA",799.2,9000011,2,14,4.1)
2^1.08
"DATA",799.2,9000011,2,14,4.2)
1^1.08
"DATA",799.2,9000011,3,0)
^799.23I^2^1
"DATA",799.2,9000011,3,2,0)
2^GMPLEDT3^GETFLDS^2977
"DATA",799.31,1,0)
REPORT
"DATA",799.31,2,0)
PARAMETERS
"DATA",799.31,3,0)
PATIENTS
"DATA",799.31,4,0)
CAREONLY
"DATA",799.31,5,0)
PATIENT
"DATA",799.31,7,0)
COLSPAN
"DATA",799.31,8,0)
REGMEDS
"DATA",799.31,9,0)
NAME
"DATA",799.31,10,0)
DOB
"DATA",799.31,11,0)
DOD
"DATA",799.31,12,0)
COMPLETE
"DATA",799.31,13,0)
COUNT
"DATA",799.31,14,0)
DE_BEFORE
"DATA",799.31,15,0)
DATE
"DATA",799.31,16,0)
DE_DURING
"DATA",799.31,17,0)
HIV
"DATA",799.31,19,0)
DFN
"DATA",799.31,20,0)
ICN
"DATA",799.31,21,0)
ID
"DATA",799.31,23,0)
NEW
"DATA",799.31,24,0)
NOTSEEN
"DATA",799.31,25,0)
SELRULES
"DATA",799.31,26,0)
RULE
"DATA",799.31,27,0)
SSN
"DATA",799.31,28,0)
CSSN
"DATA",799.31,29,0)
AIDSTAT
"DATA",799.31,31,0)
AGE
"DATA",799.31,32,0)
ENTDT
"DATA",799.31,34,0)
PRIMELIG
"DATA",799.31,35,0)
RACE
"DATA",799.31,37,0)
REIMBLVL
"DATA",799.31,38,0)
RISK
"DATA",799.31,39,0)
SEX
"DATA",799.31,40,0)
DE_AFTER
"DATA",799.31,41,0)
UTIL
"DATA",799.31,43,0)
CLINICS
"DATA",799.31,44,0)
CLINIC
"DATA",799.31,45,0)
CUTOFF
"DATA",799.31,46,0)
DATE_RANGE
"DATA",799.31,47,0)
DIVISION
"DATA",799.31,48,0)
DIVISIONS
"DATA",799.31,49,0)
DRUGS
"DATA",799.31,50,0)
FIELDS
"DATA",799.31,51,0)
ICD9LST
"DATA",799.31,52,0)
ICD9
"DATA",799.31,53,0)
LABTESTS
"DATA",799.31,54,0)
LT
"DATA",799.31,55,0)
MAXUTNUM
"DATA",799.31,57,0)
MINRPNUM
"DATA",799.31,58,0)
OPTIONS
"DATA",799.31,59,0)
REGIEN
"DATA",799.31,61,0)
LOW
"DATA",799.31,62,0)
HIGH
"DATA",799.31,63,0)
START
"DATA",799.31,64,0)
END
"DATA",799.31,65,0)
PARAMETER
"DATA",799.31,66,0)
TASK_DESCR
"DATA",799.31,67,0)
REGNAME
"DATA",799.31,69,0)
COLUMN
"DATA",799.31,70,0)
TITLE
"DATA",799.31,71,0)
HEADER
"DATA",799.31,72,0)
DESCR
"DATA",799.31,73,0)
LAST4
"DATA",799.31,74,0)
TASK_NUMBER
"DATA",799.31,75,0)
UPDATED_UNTIL
"DATA",799.31,76,0)
EXTRACTED_UNTIL
"DATA",799.31,77,0)
WARD
"DATA",799.31,78,0)
ADMDT
"DATA",799.31,79,0)
LOS
"DATA",799.31,80,0)
LOSFYTD
"DATA",799.31,81,0)
CATEGORY
"DATA",799.31,82,0)
SUMMARY
"DATA",799.31,83,0)
RACES
"DATA",799.31,84,0)
RISK_FACTORS
"DATA",799.31,85,0)
RACE_SUMMARY
"DATA",799.31,86,0)
SEX_SUMMARY
"DATA",799.31,87,0)
REIMBLVL_SUMMARY
"DATA",799.31,88,0)
AGE_SUMMARY
"DATA",799.31,89,0)
SEEN
"DATA",799.31,90,0)
SEEN_SUMMARY
"DATA",799.31,91,0)
LSNDT
"DATA",799.31,92,0)
CPT
"DATA",799.31,93,0)
QNTY
"DATA",799.31,94,0)
TOTAL
"DATA",799.31,95,0)
UNIQUE
"DATA",799.31,96,0)
PATIENT_SUMMARY
"DATA",799.31,97,0)
PROCEDURE
"DATA",799.31,98,0)
PROCEDURES
"DATA",799.31,99,0)
GROUP
"DATA",799.31,100,0)
RESULT
"DATA",799.31,102,0)
REARSN
"DATA",799.31,103,0)
UTIL_CODES
"DATA",799.31,104,0)
INPATIENT
"DATA",799.31,105,0)
OUTPATIENTS
"DATA",799.31,106,0)
INPATIENTS
"DATA",799.31,107,0)
VISITS
"DATA",799.31,108,0)
STOPS
"DATA",799.31,109,0)
BEDSECTIONS
"DATA",799.31,110,0)
BEDSECTION
"DATA",799.31,111,0)
ITEM
"DATA",799.31,112,0)
STOP
"DATA",799.31,113,0)
CODE
"DATA",799.31,114,0)
STAYS
"DATA",799.31,115,0)
ND
"DATA",799.31,116,0)
NP
"DATA",799.31,117,0)
NSC
"DATA",799.31,118,0)
ALOS
"DATA",799.31,119,0)
MLOS
"DATA",799.31,120,0)
NV
"DATA",799.31,122,0)
GENERIC
"DATA",799.31,123,0)
AIDS
"DATA",799.31,124,0)
ALL
"DATA",799.31,125,0)
OLD
"DATA",799.31,126,0)
OUTPATIENT
"DATA",799.31,127,0)
PTF
"DATA",799.31,128,0)
RANGE
"DATA",799.31,129,0)
ROWSPAN
"DATA",799.31,130,0)
TABLE
"DATA",799.31,131,0)
TYPE
"DATA",799.31,132,0)
USE
"DATA",799.31,133,0)
VARXCLS
"DATA",799.31,134,0)
VALUE
"DATA",799.31,135,0)
WIDTH
"DATA",799.31,136,0)
NDS
"DATA",799.31,137,0)
HIGHUTIL
"DATA",799.31,138,0)
DAYS
"DATA",799.31,139,0)
NOBS
"DATA",799.31,140,0)
HU_VISITS
"DATA",799.31,141,0)
HU_STAYS
"DATA",799.31,142,0)
HU_DAYS
"DATA",799.31,143,0)
NO
"DATA",799.31,144,0)
NR
"DATA",799.31,145,0)
NDT
"DATA",799.31,146,0)
MAXNRPP
"DATA",799.31,147,0)
ORDERS
"DATA",799.31,148,0)
VARDUMP
"DATA",799.31,149,0)
MAXNP
"DATA",799.31,150,0)
NC
"DATA",799.31,151,0)
DIAG
"DATA",799.31,152,0)
NDC
"DATA",799.31,153,0)
PTICDL
"DATA",799.31,154,0)
LAB
"DATA",799.31,155,0)
PHARMACY
"DATA",799.31,156,0)
DRUG
"DATA",799.31,157,0)
VARXCL
"DATA",799.31,158,0)
AIDSNOARV
"DATA",799.31,159,0)
REGMEDSMRY
"DATA",799.31,160,0)
PTLIST
"DATA",799.31,161,0)
COMPLEX
"DATA",799.31,162,0)
BASIC
"DATA",799.31,163,0)
PTLRL
"DATA",799.31,164,0)
PTRXL
"DATA",799.31,165,0)
RXCOMB
"DATA",799.31,166,0)
RXCOMBLST
"DATA",799.31,167,0)
TBLDEF
"DATA",799.31,168,0)
NST
"DATA",799.31,169,0)
NSS
"DATA",799.31,170,0)
NPR
"DATA",799.31,171,0)
NDP
"DATA",799.31,172,0)
FOOTER
"DATA",799.31,173,0)
INVESTIG
"DATA",799.31,174,0)
NPBASIC
"DATA",799.31,175,0)
NPCOMPLEX
"DATA",799.31,176,0)
NPARV
"DATA",799.31,177,0)
NPHIV
"DATA",799.31,178,0)
NPAIDS
"DATA",799.31,179,0)
FILLTYPE
"DATA",799.31,180,0)
ORDER
"DATA",799.31,181,0)
FILLS
"DATA",799.31,182,0)
DOSES
"DATA",799.31,183,0)
NF
"DATA",799.31,184,0)
HU_FILLS
"DATA",799.31,185,0)
HU_DOSES
"DATA",799.31,186,0)
NRX
"DATA",799.31,187,0)
NOTES
"DATA",799.31,188,0)
AGE_BASE_DATE
"DATA",799.31,189,0)
ROOM-BED
"DATA",799.31,190,0)
DAYSPLY
"DATA",799.31,191,0)
HU_STOPS
"DATA",799.31,192,0)
RESULTS
"DATA",799.31,193,0)
DRUGS_FILLS
"DATA",799.31,194,0)
DRUGS_DOSES
"DATA",799.31,195,0)
AIDS_SUMMARY
"DATA",799.31,197,0)
ENTDT_SUMMARY
"DATA",799.31,198,0)
PRIMELIG_SUMMARY
"DATA",799.31,199,0)
ETHN
"DATA",799.31,200,0)
ETHN_SUMMARY
"DATA",799.31,201,0)
ETHNS
"DATA",799.31,202,0)
PENDING
"DATA",799.31,204,0)
TASK_COMMENT
"DATA",799.31,205,0)
OTHER_REGISTRIES
"DATA",799.31,206,0)
LOCAL_FIELDS
"DATA",799.31,207,0)
CONFIRMED
"DATA",799.31,208,0)
OPTIONAL_COLUMNS
"DATA",799.31,209,0)
LRGRANGES
"DATA",799.31,210,0)
LRGRANGE
"DATA",799.31,211,0)
CONFDT
"DATA",799.31,212,0)
SELDT
"DATA",799.31,213,0)
FIELD
"DATA",799.31,214,0)
SOURCE
"DATA",799.31,215,0)
UTIL_TYPES
"DATA",799.31,216,0)
DOB_SUMMARY
"DATA",799.31,217,0)
DOD_SUMMARY
"DATA",799.31,218,0)
CONFDT_SUMMARY
"DATA",799.31,219,0)
SELDT_SUMMARY
"DATA",799.31,221,0)
FORMULATIONS
"DATA",799.31,222,0)
IPNRX
"DATA",799.31,223,0)
OPNRX
"DATA",799.31,224,0)
HU_NRX
"DATA",799.31,225,0)
CPTLST
"DATA",799.31,226,0)
DATE_RANGE_2
"DATA",799.31,227,0)
RXNAME
"DATA",799.31,228,0)
LTNAME
"DATA",799.31,229,0)
DATE_RANGE_3
"DATA",799.31,230,0)
PTCPTL
"DATA",799.33,1,0)
Lab
"DATA",799.33,2,0)
Outpatient
"DATA",799.33,3,0)
Inpatient
"DATA",799.33,4,0)
Radiology
"DATA",799.33,5,0)
Patient
"DATA",799.33,6,0)
Pharmacy
"DATA",799.33,7,0)
Autopsy
"DATA",799.33,8,0)
Liver Biopsy
"DATA",799.33,9,0)
Surgical Pathology
"DATA",799.33,10,0)
Cytopathology
"DATA",799.33,11,0)
Microbiology
"DATA",799.33,12,0)
EKG
"DATA",799.33,13,0)
Allergy
"DATA",799.33,14,0)
IV
"DATA",799.33,15,0)
Vitals
"DATA",799.33,16,0)
Problem List
"DATA",799.34,1,0)
List of Registry Patients^1^1^1^^^^^1
"DATA",799.34,1,1)
14,20,32,70,100
"DATA",799.34,1,10.01)
$$REGPTLST^RORX001
"DATA",799.34,1,11,0)
^799.3411^1^1^3051004^^^
"DATA",799.34,1,11,1,0)
<PATIENTS CONFIRMED="1"/>
"DATA",799.34,1,12,0)
^799.3412^1^1^3051012^^^
"DATA",799.34,1,12,1,0)
<SM TABLE="PATIENTS" FIELD="NAME"/>
"DATA",799.34,2,0)
Current Inpatient List^1^1^2^^^^^1
"DATA",799.34,2,1)
14,70,100
"DATA",799.34,2,10.01)
$$INPTLST^RORX002
"DATA",799.34,2,12,0)
^799.3412^1^1^3051012^^^
"DATA",799.34,2,12,1,0)
<SM TABLE="PATIENTS" FIELD="NAME"/>
"DATA",799.34,3,0)
General Utilization and Demographics^1^1^3^^^^^1
"DATA",799.34,3,1)
10,14,22,62,35,30,70,100
"DATA",799.34,3,10.01)
$$UTLDMG^RORX003
"DATA",799.34,3,11,0)
^799.3411^3^3^3051004^^
"DATA",799.34,3,11,1,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,3,11,2,0)
<OPTIONS COMPLETE="1"/>
"DATA",799.34,3,11,3,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"DATA",799.34,3,12,0)
^799.3412^1^1^3051012^^^
"DATA",799.34,3,12,1,0)
<SM TABLE="PATIENTS" FIELD="NAME"/>
"DATA",799.34,4,0)
Clinic Follow Up^1^1^4^^^^^1
"DATA",799.34,4,1)
10,14,22,60,66,50,70,100
"DATA",799.34,4,10.01)
$$CLNFLWUP^RORX004
"DATA",799.34,4,11,0)
^799.3411^3^3^3051206^^^
"DATA",799.34,4,11,1,0)
<CLINICS ALL="1"/>
"DATA",799.34,4,11,2,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,4,11,3,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1" SEEN="1"/>
"DATA",799.34,4,12,0)
^799.3412^1^1^3051206^^^^
"DATA",799.34,4,12,1,0)
<SM TABLE="PATIENTS" FIELD="NAME"/>
"DATA",799.34,5,0)
Inpatient Utilization^1^1^5^^^^^1
"DATA",799.34,5,1)
10,14,22,170,110,46,34,70,100
"DATA",799.34,5,10.01)
$$IPUTL^RORX005
"DATA",799.34,5,11,0)
^799.3411^4^4^3051004^^^
"DATA",799.34,5,11,1,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,5,11,2,0)
<DIVISIONS ALL="1"/>
"DATA",799.34,5,11,3,0)
<MAXUTNUM>10</MAXUTNUM>
"DATA",799.34,5,11,4,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"DATA",799.34,5,12,0)
^799.3412^5^5^3051012^^
"DATA",799.34,5,12,1,0)
<SM TABLE="BEDSECTION" FIELD="NAME"/>
"DATA",799.34,5,12,2,0)
<SM TABLE="HU_DAYS" FIELD="ND:DESC"/>
"DATA",799.34,5,12,3,0)
<SM TABLE="HU_STAYS" FIELD="NST:DESC"/>
"DATA",799.34,5,12,4,0)
<SM TABLE="NOBS" FIELD="NAME"/>
"DATA",799.34,5,12,5,0)
<SM TABLE="STAYS" FIELD="NST:DESC"/>
"DATA",799.34,6,0)
Lab Utilization^1^1^6^^^^^1
"DATA",799.34,6,1)
10,14,22,110,120,52,70,100
"DATA",799.34,6,10.01)
$$LABUTL^RORX006
"DATA",799.34,6,11,0)
^799.3411^5^5^3051004^^
"DATA",799.34,6,11,1,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,6,11,2,0)
<LABTESTS ALL="1"/>
"DATA",799.34,6,11,3,0)
<MAXUTNUM>10</MAXUTNUM>
"DATA",799.34,6,11,4,0)
<MINRPNUM>1</MINRPNUM>
"DATA",799.34,6,11,5,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"DATA",799.34,6,12,0)
^799.3412^3^3^3051012^^^
"DATA",799.34,6,12,1,0)
<SM TABLE="LABTESTS" FIELD="NAME"/>
"DATA",799.34,6,12,2,0)
<SM TABLE="PATIENTS" FIELD="NR:DESC"/>
"DATA",799.34,6,12,3,0)
<SM TABLE="RESULTS" FIELD="NR:DESC"/>
"DATA",799.34,7,0)
Radiology Utilization^1^1^7^^^^^1
"DATA",799.34,7,1)
10,14,22,110,120,70,100
"DATA",799.34,7,10.01)
$$RADUTL^RORX007
"DATA",799.34,7,11,0)
^799.3411^4^4^3051004^^
"DATA",799.34,7,11,1,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,7,11,2,0)
<MAXUTNUM>10</MAXUTNUM>
"DATA",799.34,7,11,3,0)
<MINRPNUM>1</MINRPNUM>
"DATA",799.34,7,11,4,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"DATA",799.34,7,12,0)
^799.3412^2^2^3051012^^^
"DATA",799.34,7,12,1,0)
<SM TABLE="PATIENTS" FIELD="TOTAL:DESC"/>
"DATA",799.34,7,12,2,0)
<SM TABLE="PROCEDURES" FIELD="NAME"/>
"DATA",799.34,9,0)
Pharmacy Prescription Utilization^1^1^9^^^^^1
"DATA",799.34,9,1)
10,14,22,170,26,110,46,54,44,90,70,100
"DATA",799.34,9,10.01)
$$RXUTIL^RORX009
"DATA",799.34,9,11,0)
^^4^4^3051012^
"DATA",799.34,9,11,1,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,9,11,2,0)
<DRUGS AGGR_GENERIC="1" ALL="1"/>
"DATA",799.34,9,11,3,0)
<MAXUTNUM>10</MAXUTNUM>
"DATA",799.34,9,11,4,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1" INPATIENT="1" OUTPATIENT="1"/>
"DATA",799.34,9,12,0)
^^3^3^3051012^
"DATA",799.34,9,12,1,0)
<SM TABLE="DRUGS" FIELD="NAME"/>
"DATA",799.34,9,12,2,0)
<SM TABLE="PATIENTS" FIELD="NAME"/>
"DATA",799.34,9,12,3,0)
<SM TABLE="HU_NRX" FIELD="NAME"/>
"DATA",799.34,10,0)
Registry Lab Tests by Range^1^^10^^^^^1
"DATA",799.34,10,1)
10,14,22,47,70,100
"DATA",799.34,10,10.01)
$$LRGRANGE^RORX010
"DATA",799.34,10,11,0)
^^2^2^3051206^
"DATA",799.34,10,11,1,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,10,11,2,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"DATA",799.34,10,12,0)
^799.3412^2^2^3051206^^^^
"DATA",799.34,10,12,1,0)
<SM TABLE="PATIENTS" FIELD="NAME"/>
"DATA",799.34,10,12,2,0)
<SM TABLE="PTLRL" FIELD="GROUP"/>
"DATA",799.34,11,0)
Patient Medication History^1^1^11^^^^^1
"DATA",799.34,11,1)
10,14,170,26,140,54,70,100
"DATA",799.34,11,10.01)
$$RXHIST^RORX011
"DATA",799.34,11,11,0)
^^3^3^3051006^
"DATA",799.34,11,11,1,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,11,11,2,0)
<DRUGS ALL="1"/>
"DATA",799.34,11,11,3,0)
<PATIENTS INPATIENT="1" OUTPATIENT="1"/>
"DATA",799.34,12,0)
Combined Meds and Labs^1^1^12^^^^^1
"DATA",799.34,12,1)
14,22,64,66,10,54,44,11,53,12,70,100
"DATA",799.34,12,10.01)
$$RXANDLAB^RORX012
"DATA",799.34,12,11,0)
^^5^5^3051025^
"DATA",799.34,12,11,1,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,12,11,2,0)
<DATE_RANGE_2 TYPE="YEAR"/>
"DATA",799.34,12,11,3,0)
<DATE_RANGE_3 TYPE="YEAR"/>
"DATA",799.34,12,11,4,0)
<DRUGS AGGR_GENERIC="1" ALL="1"/>
"DATA",799.34,12,11,5,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"DATA",799.34,12,12,0)
^^3^3^3051025^
"DATA",799.34,12,12,1,0)
<SM TABLE="DRUGS" FIELD="NAME"/>
"DATA",799.34,12,12,2,0)
<SM TABLE="LABTESTS" FIELD="NAME"/>
"DATA",799.34,12,12,3,0)
<SM TABLE="PATIENTS" FIELD="NAME"/>
"DATA",799.34,13,0)
Diagnoses^1^1^13^^^^^1
"DATA",799.34,13,1)
10,14,22,62,58,70,100
"DATA",799.34,13,10.01)
$$ICD9LST^RORX013
"DATA",799.34,13,11,0)
^799.3411^4^4^3051004^^
"DATA",799.34,13,11,1,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,13,11,2,0)
<ICD9LST ALL="1"/>
"DATA",799.34,13,11,3,0)
<OPTIONS COMPLETE="1"/>
"DATA",799.34,13,11,4,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"DATA",799.34,13,12,0)
^799.3412^3^3^3051012^^
"DATA",799.34,13,12,1,0)
<SM TABLE="ICD9LST" FIELD="CODE"/>
"DATA",799.34,13,12,2,0)
<SM TABLE="PATIENTS" FIELD="NAME"/>
"DATA",799.34,13,12,3,0)
<SM TABLE="PTICDL" FIELD="CODE"/>
"DATA",799.34,14,0)
Registry Medications^1^1^14^^^^^1
"DATA",799.34,14,1)
10,14,22,170,26,62,84,56,70,100
"DATA",799.34,14,10.01)
$$RXCOMB^RORX014
"DATA",799.34,14,11,0)
^799.3411^3^3^3051005^^^
"DATA",799.34,14,11,1,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,14,11,2,0)
<OPTIONS COMPLETE="1"/>
"DATA",799.34,14,11,3,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1" INPATIENT="1" OUTPATIENT="1"/>
"DATA",799.34,14,12,0)
^799.3412^3^3^3051012^^^
"DATA",799.34,14,12,1,0)
<SM TABLE="DRUGS" FIELD="NAME"/>
"DATA",799.34,14,12,2,0)
<SM TABLE="PATIENTS" FIELD="NAME"/>
"DATA",799.34,14,12,3,0)
<SM TABLE="RXCOMBLST" FIELD="NP:DESC"/>
"DATA",799.34,15,0)
Procedures^1^1^15^^^^^1
"DATA",799.34,15,1)
10,14,22,62,59,70,100
"DATA",799.34,15,10.01)
$$CPTLST^RORX015
"DATA",799.34,15,11,0)
^799.3411^4^4^3051012^^^
"DATA",799.34,15,11,1,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,15,11,2,0)
<CPTLST ALL="1"/>
"DATA",799.34,15,11,3,0)
<OPTIONS COMPLETE="1"/>
"DATA",799.34,15,11,4,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"DATA",799.34,15,12,0)
^799.3412^3^3^3051012^^^
"DATA",799.34,15,12,1,0)
<SM TABLE="CPTLST" FIELD="CODE"/>
"DATA",799.34,15,12,2,0)
<SM TABLE="PATIENTS" FIELD="NAME"/>
"DATA",799.34,15,12,3,0)
<SM TABLE="PTICDL" FIELD="CODE"/>
"DATA",799.34,16,0)
Outpatient Utilization^1^1^16^^^^^1
"DATA",799.34,16,1)
10,14,22,170,110,46,34,70,100
"DATA",799.34,16,10.01)
$$OPUTL^RORX016
"DATA",799.34,16,11,0)
^799.3411^4^4^3051004^^^
"DATA",799.34,16,11,1,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,16,11,2,0)
<DIVISIONS ALL="1"/>
"DATA",799.34,16,11,3,0)
<MAXUTNUM>10</MAXUTNUM>
"DATA",799.34,16,11,4,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"DATA",799.34,16,12,0)
^799.3412^3^3^3051012^^
"DATA",799.34,16,12,1,0)
<SM TABLE="CLINICS" FIELD="STOP"/>
"DATA",799.34,16,12,2,0)
<SM TABLE="HU_STOPS" FIELD="NSC:DESC"/>
"DATA",799.34,16,12,3,0)
<SM TABLE="STOPS" FIELD="NSC:DESC"/>
"DATA",799.34,17,0)
VERA Reimbursement Report^1^^8^^^^^1
"DATA",799.34,17,1)
10,14,22,24,28,84,56,70,100
"DATA",799.34,17,10.01)
$$ARVREIMB^RORX008
"DATA",799.34,17,11,0)
^799.3411^3^3^3051006^^^
"DATA",799.34,17,11,1,0)
<DATE_RANGE TYPE="YEAR"/>
"DATA",799.34,17,11,2,0)
<DRUGS INVESTIG="1"/>
"DATA",799.34,17,11,3,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"DATA",799.34,17,12,0)
^799.3412^2^2^3051012^^^
"DATA",799.34,17,12,1,0)
<SM TABLE="DRUGS" FIELD="NAME"/>
"DATA",799.34,17,12,2,0)
<SM TABLE="PATIENTS" FIELD="NAME"/>
"DATA",799.49,1,0)
CANDIDIASIS, B, T, OR L^1:Definitive^1
"DATA",799.49,1,1)
Candidiasis, bronchi, trachea, or lungs
"DATA",799.49,1,2,0)
^799.492^7^7^3030507^^
"DATA",799.49,1,2,1,0)
Definitive Diagnostic Method:
"DATA",799.49,1,2,2,0)
 
"DATA",799.49,1,2,3,0)
Gross inspection by endoscopy or autopsy, or 
"DATA",799.49,1,2,4,0)
microscopy (histology or cytology) on a specimen
"DATA",799.49,1,2,5,0)
obtained directly from the tissues affected
"DATA",799.49,1,2,6,0)
(including scrapings from the mucosal surface),
"DATA",799.49,1,2,7,0)
not from a culture.
"DATA",799.49,2,0)
CANDIDIASIS, ESOPHAGEAL^1:Definitive;2:Presumptive^2
"DATA",799.49,2,1)
Candidiasis, esophageal
"DATA",799.49,2,2,0)
^799.492^7^7^3030507^^
"DATA",799.49,2,2,1,0)
Definitive Diagnostic Method:
"DATA",799.49,2,2,2,0)
 
"DATA",799.49,2,2,3,0)
Gross inspection by endoscopy or autopsy, or 
"DATA",799.49,2,2,4,0)
microscopy (histology or cytology) on a specimen
"DATA",799.49,2,2,5,0)
obtained directly from the tissues affected
"DATA",799.49,2,2,6,0)
(including scrapings from the mucosal surface),
"DATA",799.49,2,2,7,0)
not from a culture.
"DATA",799.49,3,0)
CARCINOMA, INVASIVE CERVICAL^1:Definitive^3
"DATA",799.49,3,1)
Carcinoma, invasive cervical
"DATA",799.49,4,0)
COCCIDIOIDOMYCOSIS, DIS/EXTRAP^1:Definitive^4
"DATA",799.49,4,1)
Coccidioidomycosis, disseminated or extrapulmonary
"DATA",799.49,4,2,0)
^799.492^6^6^3030507^^
"DATA",799.49,4,2,1,0)
Definitive Diagnostic Method:
"DATA",799.49,4,2,2,0)
 
"DATA",799.49,4,2,3,0)
Microscopy (histology or cytology), culture, or 
"DATA",799.49,4,2,4,0)
detection of antigen in a specimen obtained
"DATA",799.49,4,2,5,0)
directly from the tissues affected or a fluid from
"DATA",799.49,4,2,6,0)
those tissues.
"DATA",799.49,5,0)
CRYPTOCOCCOSIS, EXTRAPULMONARY^1:Definitive^5
"DATA",799.49,5,1)
Cryptococcosis, extrapulmonary
"DATA",799.49,5,2,0)
^799.492^6^6^3030507^^
"DATA",799.49,5,2,1,0)
Definitive Diagnostic Method:
"DATA",799.49,5,2,2,0)
 
"DATA",799.49,5,2,3,0)
Microscopy (histology or cytology), culture, or 
"DATA",799.49,5,2,4,0)
detection of antigen in a specimen obtained
"DATA",799.49,5,2,5,0)
directly from the tissues affected or a fluid from
"DATA",799.49,5,2,6,0)
those tissues.
"DATA",799.49,6,0)
CRYPTOSPORIDIOSIS, CHRONIC^1:Definitive^6
"DATA",799.49,6,1)
Cryptosporidiosis, chronic intestinal (>1mo.Duration)
"DATA",799.49,6,2,0)
^799.492^2^2^3030507^^
"DATA",799.49,6,2,1,0)
Definitive Diagnostic Method: Microscopy
"DATA",799.49,6,2,2,0)
(histology or cytology).
"DATA",799.49,7,0)
CYTOMEGALOVIRUS DISEASE^1:Definitive^7
"DATA",799.49,7,1)
Cytomegalovirus disease (other than liver, spleen, or nodes)
"DATA",799.49,7,2,0)
^^2^2^3030507^
"DATA",799.49,7,2,1,0)
Definitive Diagnostic Method: Microscopy 
"DATA",799.49,7,2,2,0)
(histology or cytology).
"DATA",799.49,8,0)
CYTOMEGALOVIRUS RETINITIS^1:Definitive;2:Presumptive^8
"DATA",799.49,8,1)
Cytomegalovirus retinitis (with loss of vision)
"DATA",799.49,8,2,0)
^799.492^2^2^3030507^^
"DATA",799.49,8,2,1,0)
Definitive Diagnostic Method: Microscopy 
"DATA",799.49,8,2,2,0)
(histology or cytology).
"DATA",799.49,9,0)
HIV ENCEPHALOPATHY^1:Definitive^9
"DATA",799.49,9,1)
HIV encephalopathy
"DATA",799.49,9,2,0)
^799.492^15^15^3030507^^
"DATA",799.49,9,2,1,0)
Definitive Diagnostic Method:
"DATA",799.49,9,2,2,0)
 
"DATA",799.49,9,2,3,0)
NOTE: The method of diagnosis described here is 
"DATA",799.49,9,2,4,0)
not truly definitive but is sufficiently rigorous
"DATA",799.49,9,2,5,0)
for surveillance purposes.
"DATA",799.49,9,2,6,0)
  
"DATA",799.49,9,2,7,0)
Clinical findings of disabling cognitive and/or
"DATA",799.49,9,2,8,0)
motor dysfunction interfering with occupation or
"DATA",799.49,9,2,9,0)
activities of daily living, in the absence of a
"DATA",799.49,9,2,10,0)
concurrent illness or condition other than HIV
"DATA",799.49,9,2,11,0)
infection that could explain the findings.  
"DATA",799.49,9,2,12,0)
Methods to rule out such concurrent illnesses and
"DATA",799.49,9,2,13,0)
conditions must include cerebrospinal fluid
"DATA",799.49,9,2,14,0)
examination and either brain imaging (computed
"DATA",799.49,9,2,15,0)
tomography or magnetic resonance) or autopsy.
"DATA",799.49,10,0)
HERPES SIMPLEX^1:Definitive^10
"DATA",799.49,10,1)
Herpes simplex chronic ulcer(s) (>1mo.duration); or bronchitis, pneumonitis or esophagitis
"DATA",799.49,10,2,0)
^799.492^6^6^3030507^^
"DATA",799.49,10,2,1,0)
Definitive Diagnostic Method:
"DATA",799.49,10,2,2,0)
 
"DATA",799.49,10,2,3,0)
Microscopy (histology or cytology), culture, or 
"DATA",799.49,10,2,4,0)
detection of antigen in a specimen obtained
"DATA",799.49,10,2,5,0)
directly from the tissues affected or a fluid from
"DATA",799.49,10,2,6,0)
those tissues.
"DATA",799.49,11,0)
HISTOPLASMOSIS, DIS/EXTRAP^1:Definitive^11
"DATA",799.49,11,1)
Histoplasmosis, disseminated or extrapulmonary
"DATA",799.49,11,2,0)
^799.492^6^6^3030507^^
"DATA",799.49,11,2,1,0)
Definitive Diagnostic Method:
"DATA",799.49,11,2,2,0)
 
"DATA",799.49,11,2,3,0)
Microscopy (histology or cytology), culture, or 
"DATA",799.49,11,2,4,0)
detection of antigen in a specimen obtained
"DATA",799.49,11,2,5,0)
directly from the tissues affected or a fluid from
"DATA",799.49,11,2,6,0)
those tissues.
"DATA",799.49,12,0)
ISOSPORIASIS, CHRONIC INTEST^1:Definitive^12
"DATA",799.49,12,1)
Isosporiasis, chronic intestinal (>1mo.duration)
"DATA",799.49,12,2,0)
^799.492^2^2^3030507^^
"DATA",799.49,12,2,1,0)
Definitive Diagnostic Method: Microscopy
"DATA",799.49,12,2,2,0)
(histology or cytology).
"DATA",799.49,13,0)
KAPOSI'S SARCOMA^1:Definitive;2:Presumptive^13
"DATA",799.49,13,1)
Kaposi's sarcoma
"DATA",799.49,13,2,0)
^799.492^2^2^3030507^^
"DATA",799.49,13,2,1,0)
Definitive Diagnostic Method: Microscopy 
"DATA",799.49,13,2,2,0)
(histology or cytology).
"DATA",799.49,14,0)
LYMPHOMA, BURKITT'S^1:Definitive^14
"DATA",799.49,14,1)
Lymphoma, Burkitt's (or equivalent term)
"DATA",799.49,14,2,0)
^799.492^2^2^3030507^^
"DATA",799.49,14,2,1,0)
Definitive Diagnostic Method: Microscopy 
"DATA",799.49,14,2,2,0)
(histology or cytology).
"DATA",799.49,15,0)
LYMPHOMA, IMMUNOBLASTIC^1:Definitive^15
"DATA",799.49,15,1)
Lymphoma, immunoblastic (or equivalent term)
"DATA",799.49,15,2,0)
^799.492^2^2^3030507^^
"DATA",799.49,15,2,1,0)
Definitive Diagnostic Method: Microscopy 
"DATA",799.49,15,2,2,0)
(histology or cytology).
"DATA",799.49,16,0)
LYMPHOMA, PRIMARY IN BRAIN^1:Definitive^16
"DATA",799.49,16,1)
Lymphoma, primary in brain
"DATA",799.49,16,2,0)
^799.492^2^2^3030507^^
"DATA",799.49,16,2,1,0)
Definitive Diagnostic Method: Microscopy 
"DATA",799.49,16,2,2,0)
(histology or cytology).
"DATA",799.49,17,0)
MYCOBACTERIUM AVIUM COMPLEX^1:Definitive;2:Presumptive^17
"DATA",799.49,17,1)
Mycobacterium avium complex or M.kansasii, disseminated or extrapulmonary
"DATA",799.49,17,2,0)
^799.492^1^1^3030507^^
"DATA",799.49,17,2,1,0)
Definitive Diagnostic Method: Culture.
"DATA",799.49,18,0)
M. TUBERCULOSIS, PULMONARY^1:Definitive;2:Presumptive^18
"DATA",799.49,18,1)
M.Tuberculosis, pulmonary*
"DATA",799.49,19,0)
M TUBERCULOSIS, DIS/EXTRAP^1:Definitive;2:Presumptive^19
"DATA",799.49,19,1)
M.Tuberculosis, disseminated or extrapulmonary*
"DATA",799.49,19,2,0)
^799.492^1^1^3030507^^
"DATA",799.49,19,2,1,0)
Definitive Diagnostic Method: Culture.
"DATA",799.49,20,0)
MYCOBACTERIUM^1:Definitive;2:Presumptive^20
"DATA",799.49,20,1)
Mycobacterium, of other species or unidentified species, disseminated for extrapulmonary
"DATA",799.49,20,2,0)
^799.492^1^1^3030507^^
"DATA",799.49,20,2,1,0)
Definitive Diagnostic Method: Culture.
"DATA",799.49,21,0)
PNEUMOCYSTIS CARINII PNEUMONIA^1:Definitive;2:Presumptive^21
"DATA",799.49,21,1)
Pneumocystis carinii pneumonia
"DATA",799.49,21,2,0)
^799.492^2^2^3030507^^
"DATA",799.49,21,2,1,0)
Definitive Diagnostic Method: Microscopy 
"DATA",799.49,21,2,2,0)
(histology or cytology).
"DATA",799.49,22,0)
PNEUMONIA, RECURRENT IN 12 MO^1:Definitive;2:Presumptive^22
"DATA",799.49,22,1)
Pneumonia, recurrent, in 12mo. period
"DATA",799.49,23,0)
PROGRESSIVE MULTIFOCAL LEUKO^1:Definitive^23
"DATA",799.49,23,1)
Progressive multifocal leukoencephalopathy
"DATA",799.49,23,2,0)
^799.492^2^2^3030507^^
"DATA",799.49,23,2,1,0)
Definitive Diagnostic Method: Microscopy 
"DATA",799.49,23,2,2,0)
(histology or cytology).
"DATA",799.49,24,0)
SALMONELLA SEPTICEMIA, RECURR^1:Definitive^24
"DATA",799.49,24,1)
Salmonella septicemia, recurrent
"DATA",799.49,24,2,0)
^799.492^1^1^3030507^^
"DATA",799.49,24,2,1,0)
Definitive Diagnostic Method: Culture.
"DATA",799.49,25,0)
TOXOPLASMOSIS OF BRAIN^1:Definitive;2:Presumptive^25
"DATA",799.49,25,1)
Toxoplasmosis of brain
"DATA",799.49,25,2,0)
^799.492^2^2^3030507^^
"DATA",799.49,25,2,1,0)
Definitive Diagnostic Method: Microscopy 
"DATA",799.49,25,2,2,0)
(histology or cytology).
"DATA",799.49,26,0)
WASTING SYNDROME DUE TO HIV^1:Definitive^26
"DATA",799.49,26,1)
Wasting syndrome due to HIV
"DATA",799.49,26,2,0)
^799.492^15^15^3030507^^
"DATA",799.49,26,2,1,0)
Definitive Diagnostic Method:
"DATA",799.49,26,2,2,0)
 
"DATA",799.49,26,2,3,0)
NOTE:  The method of diagnosis described here is 
"DATA",799.49,26,2,4,0)
not truly definitive but is sufficiently rigorous
"DATA",799.49,26,2,5,0)
for surveillance purposes.
"DATA",799.49,26,2,6,0)
 
"DATA",799.49,26,2,7,0)
Findings of profound involuntary weight loss 
"DATA",799.49,26,2,8,0)
(more than 10% of baseline body weight) plus
"DATA",799.49,26,2,9,0)
either chronic diarrhea (>/2 loose stools per day
"DATA",799.49,26,2,10,0)
for >/30 days) or chronic weakness and documented
"DATA",799.49,26,2,11,0)
fever (for >/30 days, intermittent or constant) in
"DATA",799.49,26,2,12,0)
the absence of a concurrent illness or condition 
"DATA",799.49,26,2,13,0)
other than HIV infection that could explain the
"DATA",799.49,26,2,14,0)
findings (e.g., cancer, tuberculosis,
"DATA",799.49,26,2,15,0)
cryptosporidious, or other specific enteritis).
"DATA",799.6,2,0)
ROR-1.5-01-HEPC^1^3050401^^^5^^^1
"DATA",799.6,2,1,0)
^799.61P^16^16
"DATA",799.6,2,1,1,0)
7^2850101^3050401
"DATA",799.6,2,1,2,0)
1
"DATA",799.6,2,1,3,0)
2
"DATA",799.6,2,1,4,0)
3
"DATA",799.6,2,1,5,0)
4
"DATA",799.6,2,1,6,0)
5
"DATA",799.6,2,1,7,0)
6
"DATA",799.6,2,1,8,0)
8
"DATA",799.6,2,1,9,0)
9
"DATA",799.6,2,1,10,0)
10
"DATA",799.6,2,1,11,0)
11
"DATA",799.6,2,1,12,0)
12
"DATA",799.6,2,1,13,0)
13
"DATA",799.6,2,1,14,0)
14
"DATA",799.6,2,1,15,0)
15
"DATA",799.6,2,1,16,0)
16
"DATA",799.6,2,3,0)
^799.63^1^1
"DATA",799.6,2,3,1,0)
VA HEPC
"DATA",799.6,3,0)
ROR-1.5-02-HIV^1^3050401^^^5^^^1
"DATA",799.6,3,1,0)
^799.61P^2^2
"DATA",799.6,3,1,1,0)
7^2850101^3050401
"DATA",799.6,3,1,2,0)
11
"DATA",799.6,3,3,0)
^799.63^1^1
"DATA",799.6,3,3,1,0)
VA HIV
"FIA",798)
ROR REGISTRY RECORD
"FIA",798,0)
^RORDATA(798,
"FIA",798,0,0)
798PAs
"FIA",798,0,1)
y^y^f^^^^n
"FIA",798,0,10)

"FIA",798,0,11)

"FIA",798,0,"RLRO")

"FIA",798,0,"VR")
1.5^ROR
"FIA",798,798)
0
"FIA",798,798.01)
0
"FIA",798,798.02)
0
"FIA",798.1)
ROR REGISTRY PARAMETERS
"FIA",798.1,0)
^ROR(798.1,
"FIA",798.1,0,0)
798.1Is
"FIA",798.1,0,1)
y^y^f^^n^^y^o^n
"FIA",798.1,0,10)

"FIA",798.1,0,11)
I $E($P($G(^ROR(798.1,Y,0)),"^"),1,2)="VA"
"FIA",798.1,0,"RLRO")

"FIA",798.1,0,"VR")
1.5^ROR
"FIA",798.1,798.1)
0
"FIA",798.1,798.11)
0
"FIA",798.1,798.112)
0
"FIA",798.1,798.114)
0
"FIA",798.1,798.118)
0
"FIA",798.1,798.12)
0
"FIA",798.1,798.122)
0
"FIA",798.1,798.128)
0
"FIA",798.1,798.129)
0
"FIA",798.1,798.13)
0
"FIA",798.1,798.15)
0
"FIA",798.2)
ROR SELECTION RULE
"FIA",798.2,0)
^ROR(798.2,
"FIA",798.2,0,0)
798.2I
"FIA",798.2,0,1)
y^y^f^^n^^y^o^n
"FIA",798.2,0,10)

"FIA",798.2,0,11)
I $E($P($G(^ROR(798.2,Y,0)),"^"),1,2)="VA"
"FIA",798.2,0,"RLRO")

"FIA",798.2,0,"VR")
1.5^ROR
"FIA",798.2,798.2)
0
"FIA",798.2,798.25)
0
"FIA",798.2,798.26)
0
"FIA",798.3)
ROR PATIENT EVENTS
"FIA",798.3,0)
^RORDATA(798.3,
"FIA",798.3,0,0)
798.3P
"FIA",798.3,0,1)
y^y^f^^^^n
"FIA",798.3,0,10)

"FIA",798.3,0,11)

"FIA",798.3,0,"RLRO")

"FIA",798.3,0,"VR")
1.5^ROR
"FIA",798.3,798.3)
0
"FIA",798.3,798.31)
0
"FIA",798.3,798.32)
0
"FIA",798.4)
ROR PATIENT
"FIA",798.4,0)
^RORDATA(798.4,
"FIA",798.4,0,0)
798.4Ps
"FIA",798.4,0,1)
y^y^f^^^^n
"FIA",798.4,0,10)

"FIA",798.4,0,11)

"FIA",798.4,0,"RLRO")

"FIA",798.4,0,"VR")
1.5^ROR
"FIA",798.4,798.4)
0
"FIA",798.6)
ROR PHARMACY CODE
"FIA",798.6,0)
^ROR(798.6,
"FIA",798.6,0,0)
798.6P
"FIA",798.6,0,1)
y^y^f^^y^^y^o^n
"FIA",798.6,0,10)

"FIA",798.6,0,11)

"FIA",798.6,0,"RLRO")

"FIA",798.6,0,"VR")
1.5^ROR
"FIA",798.6,798.6)
0
"FIA",798.7)
ROR LOG
"FIA",798.7,0)
^RORDATA(798.7,
"FIA",798.7,0,0)
798.7Ds
"FIA",798.7,0,1)
y^y^f^^^^n
"FIA",798.7,0,10)

"FIA",798.7,0,11)

"FIA",798.7,0,"RLRO")

"FIA",798.7,0,"VR")
1.5^ROR
"FIA",798.7,798.7)
0
"FIA",798.7,798.73)
0
"FIA",798.7,798.74)
0
"FIA",798.7,798.744)
0
"FIA",798.8)
ROR TASK
"FIA",798.8,0)
^RORDATA(798.8,
"FIA",798.8,0,0)
798.8s
"FIA",798.8,0,1)
y^y^f^^^^n^^n
"FIA",798.8,0,10)

"FIA",798.8,0,11)

"FIA",798.8,0,"RLRO")

"FIA",798.8,0,"VR")
1.5^ROR
"FIA",798.8,798.8)
0
"FIA",798.8,798.83)
0
"FIA",798.8,798.87)
0
"FIA",798.8,798.872)
0
"FIA",798.8,798.873)
0
"FIA",798.9)
ROR LAB SEARCH
"FIA",798.9,0)
^ROR(798.9,
"FIA",798.9,0,0)
798.9
"FIA",798.9,0,1)
y^y^f^^n^^y^o^n
"FIA",798.9,0,10)

"FIA",798.9,0,11)
I $E($P($G(^ROR(798.9,Y,0)),"^"),1,2)="VA"
"FIA",798.9,0,"RLRO")

"FIA",798.9,0,"VR")
1.5^ROR
"FIA",798.9,798.9)
0
"FIA",798.9,798.92)
0
"FIA",799.1)
ROR LIST ITEM
"FIA",799.1,0)
^ROR(799.1,
"FIA",799.1,0,0)
799.1
"FIA",799.1,0,1)
y^y^f^^^^n^^
"FIA",799.1,0,10)

"FIA",799.1,0,11)

"FIA",799.1,0,"RLRO")

"FIA",799.1,0,"VR")
1.5^ROR
"FIA",799.1,799.1)
0
"FIA",799.2)
ROR METADATA
"FIA",799.2,0)
^ROR(799.2,
"FIA",799.2,0,0)
799.2I
"FIA",799.2,0,1)
y^y^f^^y^^y^o^n
"FIA",799.2,0,10)

"FIA",799.2,0,11)

"FIA",799.2,0,"RLRO")

"FIA",799.2,0,"VR")
1.5^ROR
"FIA",799.2,799.2)
0
"FIA",799.2,799.22)
0
"FIA",799.2,799.23)
0
"FIA",799.2,799.25)
0
"FIA",799.31)
ROR XML ITEM
"FIA",799.31,0)
^ROR(799.31,
"FIA",799.31,0,0)
799.31
"FIA",799.31,0,1)
y^y^f^^n^^y^o^n
"FIA",799.31,0,10)

"FIA",799.31,0,11)

"FIA",799.31,0,"RLRO")

"FIA",799.31,0,"VR")
1.5^ROR
"FIA",799.31,799.31)
0
"FIA",799.33)
ROR DATA AREA
"FIA",799.33,0)
^ROR(799.33,
"FIA",799.33,0,0)
799.33
"FIA",799.33,0,1)
y^y^f^^n^^y^o^n
"FIA",799.33,0,10)

"FIA",799.33,0,11)

"FIA",799.33,0,"RLRO")

"FIA",799.33,0,"VR")
1.5^ROR
"FIA",799.33,799.33)
0
"FIA",799.34)
ROR REPORT PARAMETERS
"FIA",799.34,0)
^ROR(799.34,
"FIA",799.34,0,0)
799.34I
"FIA",799.34,0,1)
y^y^f^^n^^y^o^n
"FIA",799.34,0,10)

"FIA",799.34,0,11)

"FIA",799.34,0,"RLRO")

"FIA",799.34,0,"VR")
1.5^ROR
"FIA",799.34,799.34)
0
"FIA",799.34,799.3411)
0
"FIA",799.34,799.3412)
0
"FIA",799.4)
ROR HIV RECORD
"FIA",799.4,0)
^RORDATA(799.4,
"FIA",799.4,0,0)
799.4sP
"FIA",799.4,0,1)
y^y^f^^^^n
"FIA",799.4,0,10)

"FIA",799.4,0,11)

"FIA",799.4,0,"RLRO")

"FIA",799.4,0,"VR")
1.5^ROR
"FIA",799.4,799.4)
0
"FIA",799.4,799.41)
0
"FIA",799.4,799.425)
0
"FIA",799.49)
ROR AIDS INDICATOR DISEASE
"FIA",799.49,0)
^ROR(799.49,
"FIA",799.49,0,0)
799.49I
"FIA",799.49,0,1)
y^y^f^^n^^y^o^n
"FIA",799.49,0,10)

"FIA",799.49,0,11)

"FIA",799.49,0,"RLRO")

"FIA",799.49,0,"VR")
1.5^ROR
"FIA",799.49,799.49)
0
"FIA",799.49,799.492)
0
"FIA",799.51)
ROR GENERIC DRUG
"FIA",799.51,0)
^ROR(799.51,
"FIA",799.51,0,0)
799.51
"FIA",799.51,0,1)
y^y^f^^^^n^^
"FIA",799.51,0,10)

"FIA",799.51,0,11)

"FIA",799.51,0,"RLRO")

"FIA",799.51,0,"VR")
1.5^ROR
"FIA",799.51,799.51)
0
"FIA",799.53)
ROR LOCAL FIELD
"FIA",799.53,0)
^ROR(799.53,
"FIA",799.53,0,0)
799.53I
"FIA",799.53,0,1)
y^y^f^^^^n^^
"FIA",799.53,0,10)

"FIA",799.53,0,11)

"FIA",799.53,0,"RLRO")

"FIA",799.53,0,"VR")
1.5^ROR
"FIA",799.53,799.53)
0
"FIA",799.6)
ROR HISTORICAL DATA EXTRACTION
"FIA",799.6,0)
^RORDATA(799.6,
"FIA",799.6,0,0)
799.6
"FIA",799.6,0,1)
y^y^f^^y^^y^m^n
"FIA",799.6,0,10)

"FIA",799.6,0,11)
I $E($G(^RORDATA(799.6,Y,0)),1,7)["ROR-1.5"
"FIA",799.6,0,"RLRO")

"FIA",799.6,0,"VR")
1.5^ROR
"FIA",799.6,799.6)
0
"FIA",799.6,799.61)
0
"FIA",799.6,799.63)
0
"FIA",799.6,799.64)
0
"FIA",799.6,799.641)
0
"FRV1",798.6,"4,0",2)
VA HEPC
"FRV1",798.6,"4,0",2,"F")
;ROR(798.1,
"FRV1",798.6,"5,0",2)
VA HIV
"FRV1",798.6,"5,0",2,"F")
;ROR(798.1,
"FRV1",799.2,"45,0",2)
2
"FRV1",799.2,"45,0",2,"F")
;ROR(799.2,
"FRV1",799.2,"63,0",2)
2
"FRV1",799.2,"63,0",2,"F")
;ROR(799.2,
"FRV1",799.2,"9000010,0",2)
2
"FRV1",799.2,"9000010,0",2,"F")
;ROR(799.2,
"FRV1",799.2,"9000010.07,0",2)
9000010
"FRV1",799.2,"9000010.07,0",2,"F")
;ROR(799.2,
"FRV1",799.2,"9000011,0",2)
2
"FRV1",799.2,"9000011,0",2,"F")
;ROR(799.2,
"INI")
PRE^RORP000
"INIT")
POS^RORP000
"IX",798,798,"ADELETE",0)
798^ADELETE^Deletes the data associated with the registry record^MU^^F^^I^798^^^^^A
"IX",798,798,"ADELETE",.1,0)
^^10^10^3060105^
"IX",798,798,"ADELETE",.1,1,0)
The "ADELETE" cross-reference is used to delete 
"IX",798,798,"ADELETE",.1,2,0)
the records of other files associated with the 
"IX",798,798,"ADELETE",.1,3,0)
main registry record being deleted from the ROR
"IX",798,798,"ADELETE",.1,4,0)
REGISTRY RECORD file (#798).
"IX",798,798,"ADELETE",.1,5,0)
 
"IX",798,798,"ADELETE",.1,6,0)
The cross-reference logic calls the DEL798^RORDD01
"IX",798,798,"ADELETE",.1,7,0)
procedure, which tries to delete the corresponding
"IX",798,798,"ADELETE",.1,8,0)
records from the ROR HIV RECORD (#799.4), ROR
"IX",798,798,"ADELETE",.1,9,0)
PATIENT (#798.4) and ROR PATIENT EVENTS (#798.3)
"IX",798,798,"ADELETE",.1,10,0)
files.
"IX",798,798,"ADELETE",1)
Q
"IX",798,798,"ADELETE",2)
D DEL798^RORDD01(DA,X1(1))
"IX",798,798,"ADELETE",2.4)
S X=($G(X2(1))="")
"IX",798,798,"ADELETE",11.1,0)
^.114IA^1^1
"IX",798,798,"ADELETE",11.1,1,0)
1^F^798^.01^^^F
"IX",798,798,"ADEM",0)
798^ADEM^Sets the date of last demographic update^MU^^F^^I^798^^^^^A
"IX",798,798,"ADEM",1)
D FILE^RORDD01(798,DA_",",4.1,$$NOW^XLFDT)
"IX",798,798,"ADEM",1.4)
S X=(X2(1)>0)
"IX",798,798,"ADEM",2)
Q
"IX",798,798,"ADEM",11.1,0)
^.114IA^1^1
"IX",798,798,"ADEM",11.1,1,0)
1^F^798^4^^^
"IX",798,798,"ALOC",0)
798^ALOC^Sets the date of last local data modification^MU^^F^^I^798^^^^^A
"IX",798,798,"ALOC",1)
D FILE^RORDD01(798,DA_",",5.1,$$NOW^XLFDT)
"IX",798,798,"ALOC",1.4)
S X=(X2(1)>0)
"IX",798,798,"ALOC",2)
Q
"IX",798,798,"ALOC",11.1,0)
^.114IA^1^1
"IX",798,798,"ALOC",11.1,1,0)
1^F^798^5^^^
"IX",798,798,"ARCP",0)
798^ARCP^Registry, Date Confirmed, Patient^R^^R^IR^I^798^^^^^S
"IX",798,798,"ARCP",.1,0)
^^15^15^3060203^
"IX",798,798,"ARCP",.1,1,0)
This index sorts registry patients by their 
"IX",798,798,"ARCP",.1,2,0)
confirmation dates. It has the following
"IX",798,798,"ARCP",.1,3,0)
structure: 
"IX",798,798,"ARCP",.1,4,0)
                     
"IX",798,798,"ARCP",.1,5,0)
  ^RORDATA(798,"ARCP",<Registry>,
"IX",798,798,"ARCP",.1,6,0)
    <Date Confirmed>,<Patient>,IEN) = ""
"IX",798,798,"ARCP",.1,7,0)
                     
"IX",798,798,"ARCP",.1,8,0)
The <Registry> is the registry IEN (IEN of the
"IX",798,798,"ARCP",.1,9,0)
registry parameters record in the ROR REGISTRY
"IX",798,798,"ARCP",.1,10,0)
PARAMETERS file) concatenated with the "#" so that
"IX",798,798,"ARCP",.1,11,0)
the LIST^DIC can be used to retrieve the records
"IX",798,798,"ARCP",.1,12,0)
associated with the specified registry.
"IX",798,798,"ARCP",.1,13,0)
                     
"IX",798,798,"ARCP",.1,14,0)
The <Patient> is the IEN of the patient's record
"IX",798,798,"ARCP",.1,15,0)
in the ROR PATIENT file (#798.4).
"IX",798,798,"ARCP",1)
S ^RORDATA(798,"ARCP",X(2),X(3),X(4),DA)=""
"IX",798,798,"ARCP",2)
K ^RORDATA(798,"ARCP",X(2),X(3),X(4),DA)
"IX",798,798,"ARCP",2.5)
K ^RORDATA(798,"ARCP")
"IX",798,798,"ARCP",11.1,0)
^.114IA^4^4
"IX",798,798,"ARCP",11.1,1,0)
1^F^798^.02^^^F
"IX",798,798,"ARCP",11.1,2,0)
2^C^^^^1
"IX",798,798,"ARCP",11.1,2,1.5)
S X=$S(X(1)'="":X(1)_"#",1:"")
"IX",798,798,"ARCP",11.1,3,0)
3^F^798^2^^2^F
"IX",798,798,"ARCP",11.1,4,0)
4^F^798^.01^^3^F
"IX",798,798,"ARD",0)
798^ARD^Registry & Date Entered^R^^R^IR^I^798^^^^^S
"IX",798,798,"ARD",.1,0)
^^2^2^3030714^
"IX",798,798,"ARD",.1,1,0)
This cross-reference can be used to search for
"IX",798,798,"ARD",.1,2,0)
recently added patients.
"IX",798,798,"ARD",1)
S ^RORDATA(798,"ARD",X(2),X(3),DA)=""
"IX",798,798,"ARD",2)
K ^RORDATA(798,"ARD",X(2),X(3),DA)
"IX",798,798,"ARD",2.5)
K ^RORDATA(798,"ARD")
"IX",798,798,"ARD",11.1,0)
^.114IA^4^3
"IX",798,798,"ARD",11.1,1,0)
1^F^798^.02^^^F
"IX",798,798,"ARD",11.1,1,4)

"IX",798,798,"ARD",11.1,3,0)
3^F^798^1^^2^F
"IX",798,798,"ARD",11.1,4,0)
2^C^^^^1
"IX",798,798,"ARD",11.1,4,1.5)
S X=$S(X(1)'="":X(1)_"#",1:"")
"IX",798,798,"ARP",0)
798^ARP^Registry & Patient^R^^R^IR^I^798^^^^^S
"IX",798,798,"ARP",.1,0)
^^13^13^3060203^
"IX",798,798,"ARP",.1,1,0)
This cross-reference lists the registry patients. 
"IX",798,798,"ARP",.1,2,0)
It has the following structure:
"IX",798,798,"ARP",.1,3,0)
 
"IX",798,798,"ARP",.1,4,0)
 ^RORDATA(798,"ARP",<Registry>,<Patient>,IEN)
"IX",798,798,"ARP",.1,5,0)
 
"IX",798,798,"ARP",.1,6,0)
The <Registry> is the registry IEN (IEN of the 
"IX",798,798,"ARP",.1,7,0)
registry parameters record in the ROR REGISTRY
"IX",798,798,"ARP",.1,8,0)
PARAMETERS file) concatenated with the "#" so that
"IX",798,798,"ARP",.1,9,0)
the LIST^DIC can be used to retrieve the records
"IX",798,798,"ARP",.1,10,0)
associated with the specified registry.
"IX",798,798,"ARP",.1,11,0)
 
"IX",798,798,"ARP",.1,12,0)
The <Patient> is the IEN of the patient's record 
"IX",798,798,"ARP",.1,13,0)
in the ROR PATIENT file.
"IX",798,798,"ARP",1)
S ^RORDATA(798,"ARP",X(2),X(3),DA)=""
"IX",798,798,"ARP",1.4)

"IX",798,798,"ARP",2)
K ^RORDATA(798,"ARP",X(2),X(3),DA)
"IX",798,798,"ARP",2.5)
K ^RORDATA(798,"ARP")
"IX",798,798,"ARP",11.1,0)
^.114IA^4^3
"IX",798,798,"ARP",11.1,1,0)
1^F^798^.02^^^
"IX",798,798,"ARP",11.1,3,0)
2^C^^^^1^F
"IX",798,798,"ARP",11.1,3,1.5)
S X=$S(X(1)'="":X(1)_"#",1:"")
"IX",798,798,"ARP",11.1,4,0)
3^F^798^.01^^2^F
"IX",798,798,"ASTATUS",0)
798^ASTATUS^Reacts on record status changes^MU^^R^^I^798^^^^^A
"IX",798,798,"ASTATUS",.1,0)
^^7^7^3050630^
"IX",798,798,"ASTATUS",.1,1,0)
This trigger reacts on status changes of the 
"IX",798,798,"ASTATUS",.1,2,0)
registry records (confirmed, deleted, etc.). 
"IX",798,798,"ASTATUS",.1,3,0)
 
"IX",798,798,"ASTATUS",.1,4,0)
According to the nature of the change, the 
"IX",798,798,"ASTATUS",.1,5,0)
$$RST798^RORDD01 function populates the
"IX",798,798,"ASTATUS",.1,6,0)
corresponding fields of the registry record (DATE
"IX",798,798,"ASTATUS",.1,7,0)
CONFIRMED, DATE DELETED, etc.).
"IX",798,798,"ASTATUS",1)
D RST798^RORDD01(1,DA,+$G(X1(1)),+$G(X2(1)))
"IX",798,798,"ASTATUS",1.4)

"IX",798,798,"ASTATUS",2)
D RST798^RORDD01(2,DA,+$G(X1(1)),+$G(X2(1)))
"IX",798,798,"ASTATUS",2.4)
S X=($G(X2(2))'="")
"IX",798,798,"ASTATUS",11.1,0)
^.114IA^2^2
"IX",798,798,"ASTATUS",11.1,1,0)
1^F^798^3^^^F
"IX",798,798,"ASTATUS",11.1,2,0)
2^F^798^.01^^^F
"IX",798,798,"KEY",0)
798^KEY^Uniqueness Index for Key 'A' of File #798^R^^R^IR^I^798^^^^^LS
"IX",798,798,"KEY",.1,0)
^^3^3^3060203^
"IX",798,798,"KEY",.1,1,0)
This index guarantees uniqueness of the patient 
"IX",798,798,"KEY",.1,2,0)
record in the particular registry and allows users
"IX",798,798,"KEY",.1,3,0)
to easily find this record.
"IX",798,798,"KEY",1)
S ^RORDATA(798,"KEY",X(1),X(2),DA)=""
"IX",798,798,"KEY",2)
K ^RORDATA(798,"KEY",X(1),X(2),DA)
"IX",798,798,"KEY",2.5)
K ^RORDATA(798,"KEY")
"IX",798,798,"KEY",11.1,0)
^.114IA^2^2
"IX",798,798,"KEY",11.1,1,0)
1^F^798^.01^^1
"IX",798,798,"KEY",11.1,2,0)
2^F^798^.02^^2
"IX",798,798.02,"B",0)
798.02^B^Uniqueness Index for Key 'B' of Subfile #798.02^R^^F^IR^I^798.02^^^^^LS
"IX",798,798.02,"B",1)
S ^RORDATA(798,DA(1),20,"B",X,DA)=""
"IX",798,798.02,"B",2)
K ^RORDATA(798,DA(1),20,"B",X,DA)
"IX",798,798.02,"B",2.5)
K ^RORDATA(798,DA(1),20,"B")
"IX",798,798.02,"B",11.1,0)
^.114IA^1^1
"IX",798,798.02,"B",11.1,1,0)
1^F^798.02^.01^^1
"IX",798.1,798.1,"B",0)
798.1^B^Uniqueness Index for Key 'A' of File #798.1^R^^F^IR^I^798.1^^^^^LS
"IX",798.1,798.1,"B",1)
S ^ROR(798.1,"B",X,DA)=""
"IX",798.1,798.1,"B",2)
K ^ROR(798.1,"B",X,DA)
"IX",798.1,798.1,"B",2.5)
K ^ROR(798.1,"B")
"IX",798.1,798.1,"B",11.1,0)
^.114IA^1^1
"IX",798.1,798.1,"B",11.1,1,0)
1^F^798.1^.01^^1
"IX",798.1,798.11,"B",0)
798.11^B^Uniqueness Index for Key 'A' of Subfile #798.11^R^^F^IR^I^798.11^^^^^LS
"IX",798.1,798.11,"B",1)
S ^ROR(798.1,DA(1),3,"B",X,DA)=""
"IX",798.1,798.11,"B",2)
K ^ROR(798.1,DA(1),3,"B",X,DA)
"IX",798.1,798.11,"B",2.5)
K ^ROR(798.1,DA(1),3,"B")
"IX",798.1,798.11,"B",11.1,0)
^.114IA^1^1
"IX",798.1,798.11,"B",11.1,1,0)
1^F^798.11^.01^^1
"IX",798.1,798.118,"B",0)
798.118^B^Uniqueness Index for Key 'A' of Subfile #798.118^R^^F^IR^I^798.118^^^^^LS
"IX",798.1,798.118,"B",1)
S ^ROR(798.1,DA(1),18,"B",X,DA)=""
"IX",798.1,798.118,"B",2)
K ^ROR(798.1,DA(1),18,"B",X,DA)
"IX",798.1,798.118,"B",2.5)
K ^ROR(798.1,DA(1),18,"B")
"IX",798.1,798.118,"B",11.1,0)
^.114IA^1^1
"IX",798.1,798.118,"B",11.1,1,0)
1^F^798.118^.01^^1
"IX",798.1,798.122,"B",0)
798.122^B^Uniqueness Index for Key 'A' of Subfile #798.122^R^^F^IR^I^798.122^^^^^LS
"IX",798.1,798.122,"B",1)
S ^ROR(798.1,DA(1),22,"B",X,DA)=""
"IX",798.1,798.122,"B",2)
K ^ROR(798.1,DA(1),22,"B",X,DA)
"IX",798.1,798.122,"B",2.5)
K ^ROR(798.1,DA(1),22,"B")
"IX",798.1,798.122,"B",11.1,0)
^.114IA^1^1
"IX",798.1,798.122,"B",11.1,1,0)
1^F^798.122^.01^^1
"IX",798.1,798.128,"G",0)
798.128^G^Lab Group and Local Test Name^R^^R^IR^I^798.128^^^^^LS
"IX",798.1,798.128,"G",1)
S ^ROR(798.1,DA(1),28,"G",X(1),X(2),DA)=""
"IX",798.1,798.128,"G",2)
K ^ROR(798.1,DA(1),28,"G",X(1),X(2),DA)
"IX",798.1,798.128,"G",2.5)
K ^ROR(798.1,DA(1),28,"G")
"IX",798.1,798.128,"G",11.1,0)
^.114IA^3^2
"IX",798.1,798.128,"G",11.1,1,0)
1^F^798.128^.02^^1^F
"IX",798.1,798.128,"G",11.1,1,2)

"IX",798.1,798.128,"G",11.1,1,3)

"IX",798.1,798.128,"G",11.1,3,0)
2^F^798.128^.01^^2^F
"IX",798.1,798.128,"G",11.1,3,3)

"IX",798.1,798.129,"G",0)
798.129^G^Drug Group and Local Drug Name^R^^R^IR^I^798.129^^^^^LS
"IX",798.1,798.129,"G",1)
S ^ROR(798.1,DA(1),29,"G",X(1),X(2),DA)=""
"IX",798.1,798.129,"G",2)
K ^ROR(798.1,DA(1),29,"G",X(1),X(2),DA)
"IX",798.1,798.129,"G",2.5)
K ^ROR(798.1,DA(1),29,"G")
"IX",798.1,798.129,"G",11.1,0)
^.114IA^3^2
"IX",798.1,798.129,"G",11.1,1,0)
1^F^798.129^.02^^1^F
"IX",798.1,798.129,"G",11.1,1,3)

"IX",798.1,798.129,"G",11.1,3,0)
2^F^798.129^.01^^2^F
"IX",798.1,798.129,"G",11.1,3,3)

"IX",798.1,798.13,"B",0)
798.13^B^Uniqueness Index for Key 'A' of Subfile #798.13^R^^F^IR^I^798.13^^^^^LS
"IX",798.1,798.13,"B",1)
S ^ROR(798.1,DA(1),1,"B",X,DA)=""
"IX",798.1,798.13,"B",2)
K ^ROR(798.1,DA(1),1,"B",X,DA)
"IX",798.1,798.13,"B",2.5)
K ^ROR(798.1,DA(1),1,"B")
"IX",798.1,798.13,"B",11.1,0)
^.114IA^1^1
"IX",798.1,798.13,"B",11.1,1,0)
1^F^798.13^.01^^1
"IX",798.2,798.2,"B",0)
798.2^B^Uniqueness Index for the "A" Key of File #798.2^R^^F^IR^I^798.2^^^^^LS
"IX",798.2,798.2,"B",1)
S ^ROR(798.2,"B",X,DA)=""
"IX",798.2,798.2,"B",2)
K ^ROR(798.2,"B",X,DA)
"IX",798.2,798.2,"B",2.5)
K ^ROR(798.2,"B")
"IX",798.2,798.2,"B",11.1,0)
^.114IA^1^1
"IX",798.2,798.2,"B",11.1,1,0)
1^F^798.2^.01^^1
"IX",798.2,798.26,"B",0)
798.26^B^Uniqueness Index for the "A" Key of Subfile #798.26^R^^F^IR^I^798.26^^^^^LS
"IX",798.2,798.26,"B",1)
S ^ROR(798.2,DA(1),4,"B",X,DA)=""
"IX",798.2,798.26,"B",2)
K ^ROR(798.2,DA(1),4,"B",X,DA)
"IX",798.2,798.26,"B",2.5)
K ^ROR(798.2,DA(1),4,"B")
"IX",798.2,798.26,"B",11.1,0)
^.114IA^1^1
"IX",798.2,798.26,"B",11.1,1,0)
1^F^798.26^.01^^1
"IX",798.3,798.31,"B",0)
798.31^B^Uniqueness Index for the "A" key of Subfile #798.31^R^^F^IR^I^798.31^^^^^LS
"IX",798.3,798.31,"B",1)
S ^RORDATA(798.3,DA(1),1,"B",X,DA)=""
"IX",798.3,798.31,"B",2)
K ^RORDATA(798.3,DA(1),1,"B",X,DA)
"IX",798.3,798.31,"B",2.5)
K ^RORDATA(798.3,DA(1),1,"B")
"IX",798.3,798.31,"B",11.1,0)
^.114IA^1^1
"IX",798.3,798.31,"B",11.1,1,0)
1^F^798.31^.01^^1
"IX",798.3,798.32,"AD",0)
798.32^AD^Data Area, Date^MU^^R^IR^I^798.32^^^^^S
"IX",798.3,798.32,"AD",1)
S ^RORDATA(798.3,DA(1),2,"AD",X(1),X(2)\1,DA)=""
"IX",798.3,798.32,"AD",2)
K ^RORDATA(798.3,DA(1),2,"AD",X(1),X(2)\1,DA)
"IX",798.3,798.32,"AD",2.5)
K ^RORDATA(798.3,DA(1),2,"AD")
"IX",798.3,798.32,"AD",11.1,0)
^.114IA^2^2
"IX",798.3,798.32,"AD",11.1,1,0)
1^F^798.32^1^^1^F
"IX",798.3,798.32,"AD",11.1,2,0)
2^F^798.32^2^^2^F
"IX",798.3,798.32,"AT",0)
798.32^AT^Data Area, Timestamp^R^^R^IR^I^798.32^^^^^S
"IX",798.3,798.32,"AT",1)
S ^RORDATA(798.3,DA(1),2,"AT",X(1),X(2),DA)=""
"IX",798.3,798.32,"AT",2)
K ^RORDATA(798.3,DA(1),2,"AT",X(1),X(2),DA)
"IX",798.3,798.32,"AT",2.5)
K ^RORDATA(798.3,DA(1),2,"AT")
"IX",798.3,798.32,"AT",11.1,0)
^.114IA^2^2
"IX",798.3,798.32,"AT",11.1,1,0)
1^F^798.32^1^^1^F
"IX",798.3,798.32,"AT",11.1,2,0)
2^F^798.32^.01^^2^F
"IX",798.7,798.7,"ARD",0)
798.7^ARD^Registry & Start date^R^^R^IR^W^798.73^^^^^S
"IX",798.7,798.7,"ARD",.1,0)
^^2^2^3060203^
"IX",798.7,798.7,"ARD",.1,1,0)
This index can be used to get a chronological list
"IX",798.7,798.7,"ARD",.1,2,0)
of logs associated with a particular registry.
"IX",798.7,798.7,"ARD",1)
S ^RORDATA(798.7,"ARD",X(1),X(2),DA(1),DA)=""
"IX",798.7,798.7,"ARD",2)
K ^RORDATA(798.7,"ARD",X(1),X(2),DA(1),DA)
"IX",798.7,798.7,"ARD",2.5)
K ^RORDATA(798.7,"ARD")
"IX",798.7,798.7,"ARD",11.1,0)
^.114IA^2^2
"IX",798.7,798.7,"ARD",11.1,1,0)
1^F^798.73^.01^^1^F
"IX",798.7,798.7,"ARD",11.1,2,0)
2^C^^^^2
"IX",798.7,798.7,"ARD",11.1,2,1.5)
S X=$P($G(^RORDATA(798.7,DA(1),0)),U)
"IX",798.8,798.87,"APSR",0)
798.87^APSR^Sort Elements^MU^^R^IR^I^798.87^^^^^S
"IX",798.8,798.87,"APSR",.1,0)
^^20^20^3030502^
"IX",798.8,798.87,"APSR",.1,1,0)
 
"IX",798.8,798.87,"APSR",.1,2,0)
 IEN  Element (int)   Parent IEN  Value
"IX",798.8,798.87,"APSR",.1,3,0)
 ---  --------------  ----------  ------------
"IX",798.8,798.87,"APSR",.1,4,0)
   1  REPORT    ( 1)          0
"IX",798.8,798.87,"APSR",.1,5,0)
   2   PATIENTS ( 3)          1
"IX",798.8,798.87,"APSR",.1,6,0)
   3    PATIENT ( 5)          2
"IX",798.8,798.87,"APSR",.1,7,0)
   4     NAME   ( 9)          3   "DOU, JOHN"
"IX",798.8,798.87,"APSR",.1,8,0)
   5     DOB    (10)          3   "1950/03/25"
"IX",798.8,798.87,"APSR",.1,9,0)
   6    PATIENT ( 5)          2
"IX",798.8,798.87,"APSR",.1,10,0)
   7     NAME   ( 9)          6   "SMITH, BOB"
"IX",798.8,798.87,"APSR",.1,11,0)
   8     DOB    (10)          6   "1935/10/05"
"IX",798.8,798.87,"APSR",.1,12,0)
 
"IX",798.8,798.87,"APSR",.1,13,0)
 
"IX",798.8,798.87,"APSR",.1,14,0)
        Parent  Element
"IX",798.8,798.87,"APSR",.1,15,0)
         IEN     (int)   IEN
"IX",798.8,798.87,"APSR",.1,16,0)
        ------  -------  ---
"IX",798.8,798.87,"APSR",.1,17,0)
 "APSR",  3,       9,     4
"IX",798.8,798.87,"APSR",.1,18,0)
 "APSR",  3,      10,     5
"IX",798.8,798.87,"APSR",.1,19,0)
 "APSR",  6,       9,     7
"IX",798.8,798.87,"APSR",.1,20,0)
 "APSR",  6,      10,     8
"IX",798.8,798.87,"APSR",1)
S ^RORDATA(798.8,DA(1),"RI","APSR",X(1),X(2),DA)=""
"IX",798.8,798.87,"APSR",1.4)
S X=(X(3)>0)
"IX",798.8,798.87,"APSR",2)
K ^RORDATA(798.8,DA(1),"RI","APSR",X(1),X(2),DA)
"IX",798.8,798.87,"APSR",2.4)

"IX",798.8,798.87,"APSR",2.5)
K ^RORDATA(798.8,DA(1),"RI","APSR")
"IX",798.8,798.87,"APSR",11.1,0)
^.114IA^4^3
"IX",798.8,798.87,"APSR",11.1,1,0)
1^F^798.87^.02^^1^F
"IX",798.8,798.87,"APSR",11.1,2,0)
2^F^798.87^.01^^2^F
"IX",798.8,798.87,"APSR",11.1,4,0)
3^F^798.87^.03^^^F
"IX",798.8,798.87,"APSV0",0)
798.87^APSV0^Preserves the sequence of the report elements.^MU^^F^IR^I^798.87^^^^^S
"IX",798.8,798.87,"APSV0",.1,0)
^^10^10^3030502^
"IX",798.8,798.87,"APSV0",.1,1,0)
The APSV0 index allows to render the report
"IX",798.8,798.87,"APSV0",.1,2,0)
elements into the XML tags in the same sequence as
"IX",798.8,798.87,"APSV0",.1,3,0)
those elements were created by the report builder.
"IX",798.8,798.87,"APSV0",.1,4,0)
 
"IX",798.8,798.87,"APSV0",.1,5,0)
The APSV0 and APSV1 indexes work together and the
"IX",798.8,798.87,"APSV0",.1,6,0)
entries of both indexes are created under the same
"IX",798.8,798.87,"APSV0",.1,7,0)
"APSV" subscript.
"IX",798.8,798.87,"APSV0",.1,8,0)
 
"IX",798.8,798.87,"APSV0",.1,9,0)
See the description of the APSV1 index for more 
"IX",798.8,798.87,"APSV0",.1,10,0)
details.
"IX",798.8,798.87,"APSV0",1)
S ^RORDATA(798.8,DA(1),"RI","APSV",+X(1),0," ",DA)=""
"IX",798.8,798.87,"APSV0",2)
K ^RORDATA(798.8,DA(1),"RI","APSV",+X(1),0," ",DA)
"IX",798.8,798.87,"APSV0",2.5)

"IX",798.8,798.87,"APSV0",11.1,0)
^.114IA^1^1
"IX",798.8,798.87,"APSV0",11.1,1,0)
1^F^798.87^.02^^^F
"IX",798.8,798.87,"APSV1",0)
798.87^APSV1^Sorts the XML report on the server^MU^^R^IR^I^798.87^^^^^S
"IX",798.8,798.87,"APSV1",.1,0)
^^161^161^3060203^
"IX",798.8,798.87,"APSV1",.1,1,0)
The APSV1 index allows to sort the XML reports on 
"IX",798.8,798.87,"APSV1",.1,2,0)
the server side. 
"IX",798.8,798.87,"APSV1",.1,3,0)
 
"IX",798.8,798.87,"APSV1",.1,4,0)
The APSV0 and APSV1 indexes work together and the
"IX",798.8,798.87,"APSV1",.1,5,0)
entries of both indexes are created under the same
"IX",798.8,798.87,"APSV1",.1,6,0)
"APSV" subscript.
"IX",798.8,798.87,"APSV1",.1,7,0)
 
"IX",798.8,798.87,"APSV1",.1,8,0)
The resulting index actually consists of several 
"IX",798.8,798.87,"APSV1",.1,9,0)
sub-indexes (lists). Each index sorts the items
"IX",798.8,798.87,"APSV1",.1,10,0)
that comprise different parts of the XML document.
"IX",798.8,798.87,"APSV1",.1,11,0)
 
"IX",798.8,798.87,"APSV1",.1,12,0)
The index has the following structure:
"IX",798.8,798.87,"APSV1",.1,13,0)
 
"IX",798.8,798.87,"APSV1",.1,14,0)
 ^RORDATA(798.8,Task,"RI",
"IX",798.8,798.87,"APSV1",.1,15,0)
    "APSV",List,Sort,ItemValue,ItemIEN) = ""
"IX",798.8,798.87,"APSV1",.1,16,0)
 
"IX",798.8,798.87,"APSV1",.1,17,0)
'Task' is the IEN of the main task record (it is
"IX",798.8,798.87,"APSV1",.1,18,0)
equal to the task number).
"IX",798.8,798.87,"APSV1",.1,19,0)
 
"IX",798.8,798.87,"APSV1",.1,20,0)
'List' is the IEN of the list.
"IX",798.8,798.87,"APSV1",.1,21,0)
 
"IX",798.8,798.87,"APSV1",.1,22,0)
'Sort' is the sorting mode. It is the internal 
"IX",798.8,798.87,"APSV1",.1,23,0)
value of the REPORT ELEMENT field (the IEN of the
"IX",798.8,798.87,"APSV1",.1,24,0)
XML element in the ROR XML ELEMENT file). Each
"IX",798.8,798.87,"APSV1",.1,25,0)
list can be sorted in different ways. The APSV0
"IX",798.8,798.87,"APSV1",.1,26,0)
index always uses 0 as the value of this
"IX",798.8,798.87,"APSV1",.1,27,0)
subscript.
"IX",798.8,798.87,"APSV1",.1,28,0)
 
"IX",798.8,798.87,"APSV1",.1,29,0)
'ItemValue' is the value of the list item. The
"IX",798.8,798.87,"APSV1",.1,30,0)
APSV0 index always uses " " as the value of this
"IX",798.8,798.87,"APSV1",.1,31,0)
subscript.
"IX",798.8,798.87,"APSV1",.1,32,0)
 
"IX",798.8,798.87,"APSV1",.1,33,0)
'ItemIEN' is the IEN of the list item.
"IX",798.8,798.87,"APSV1",.1,34,0)
 
"IX",798.8,798.87,"APSV1",.1,35,0)
To clarify, below is an example of some sample 
"IX",798.8,798.87,"APSV1",.1,36,0)
content of the REPORT ELEMENT multiple:
"IX",798.8,798.87,"APSV1",.1,37,0)
 
"IX",798.8,798.87,"APSV1",.1,38,0)
 IEN  Element (int)   Parent IEN  Value
"IX",798.8,798.87,"APSV1",.1,39,0)
 ---  --------------  ----------  ------------
"IX",798.8,798.87,"APSV1",.1,40,0)
   1  REPORT    ( 1)         0
"IX",798.8,798.87,"APSV1",.1,41,0)
   2   PATIENTS ( 3)         1
"IX",798.8,798.87,"APSV1",.1,42,0)
   3    PATIENT ( 5)         2
"IX",798.8,798.87,"APSV1",.1,43,0)
   4     NAME   ( 9)         3    "DOU, JOHN"
"IX",798.8,798.87,"APSV1",.1,44,0)
   5     DOB    (10)         3    "1950/03/25"
"IX",798.8,798.87,"APSV1",.1,45,0)
   6    PATIENT ( 5)         2   
"IX",798.8,798.87,"APSV1",.1,46,0)
   7     NAME   ( 9)         6    "SMITH, BOB"
"IX",798.8,798.87,"APSV1",.1,47,0)
   8     DOB    (10)         6    "1935/10/05"
"IX",798.8,798.87,"APSV1",.1,48,0)
 
"IX",798.8,798.87,"APSV1",.1,49,0)
      Table 1. Sample Report Elements
"IX",798.8,798.87,"APSV1",.1,50,0)
 
"IX",798.8,798.87,"APSV1",.1,51,0)
The element names are indented to emphasize the 
"IX",798.8,798.87,"APSV1",.1,52,0)
hierarchical structure of the document.
"IX",798.8,798.87,"APSV1",.1,53,0)
 
"IX",798.8,798.87,"APSV1",.1,54,0)
The numbers in parentheses after the element names
"IX",798.8,798.87,"APSV1",.1,55,0)
represent the internal values of the REPORT 
"IX",798.8,798.87,"APSV1",.1,56,0)
ELEMENT field (the IENs in the ROR XML ELEMENT
"IX",798.8,798.87,"APSV1",.1,57,0)
file).
"IX",798.8,798.87,"APSV1",.1,58,0)
 
"IX",798.8,798.87,"APSV1",.1,59,0)
Several lists can be isolated from this example:
"IX",798.8,798.87,"APSV1",.1,60,0)
 
"IX",798.8,798.87,"APSV1",.1,61,0)
  #   List      Items
"IX",798.8,798.87,"APSV1",.1,62,0)
 ---  -------   -------------------------------
"IX",798.8,798.87,"APSV1",.1,63,0)
  1   REPORT    PATIENTS
"IX",798.8,798.87,"APSV1",.1,64,0)
  2   PATIENTS  PATIENT, PATIENT
"IX",798.8,798.87,"APSV1",.1,65,0)
  3   PATIENT   NAME, DOB
"IX",798.8,798.87,"APSV1",.1,66,0)
  4   PATIENT   NAME, DOB
"IX",798.8,798.87,"APSV1",.1,67,0)
 
"IX",798.8,798.87,"APSV1",.1,68,0)
  5   PATIENTS  "DOU, JOHN", "SMITH, BOB"
"IX",798.8,798.87,"APSV1",.1,69,0)
  6   PATIENTS  "1935/10/05", "1950/03/25"
"IX",798.8,798.87,"APSV1",.1,70,0)
 
"IX",798.8,798.87,"APSV1",.1,71,0)
      Table 2. The Lists
"IX",798.8,798.87,"APSV1",.1,72,0)
 
"IX",798.8,798.87,"APSV1",.1,73,0)
The first four lists contain just the report
"IX",798.8,798.87,"APSV1",.1,74,0)
elements themselves. They are used to render the
"IX",798.8,798.87,"APSV1",.1,75,0)
elements into XML tags in the same sequence as the
"IX",798.8,798.87,"APSV1",.1,76,0)
elements were created by the report builder. For
"IX",798.8,798.87,"APSV1",.1,77,0)
example, the <DOB> tag will always follow the
"IX",798.8,798.87,"APSV1",.1,78,0)
<NAME> tag.
"IX",798.8,798.87,"APSV1",.1,79,0)
 
"IX",798.8,798.87,"APSV1",.1,80,0)
The logic of the APSV0 index handles these
"IX",798.8,798.87,"APSV1",.1,81,0)
sub-indexes. They always have 0 as the sorting
"IX",798.8,798.87,"APSV1",.1,82,0)
mode and " " as the item value.
"IX",798.8,798.87,"APSV1",.1,83,0)
 
"IX",798.8,798.87,"APSV1",.1,84,0)
The last two sub-indexes are handled by the logic
"IX",798.8,798.87,"APSV1",.1,85,0)
of the "APSV1" index. As illustrated in the
"IX",798.8,798.87,"APSV1",.1,86,0)
example, the lists are associated with the
"IX",798.8,798.87,"APSV1",.1,87,0)
PATIENTS element, they comprise the PATIENT
"IX",798.8,798.87,"APSV1",.1,88,0)
elements, and are sorted by the values of the NAME
"IX",798.8,798.87,"APSV1",.1,89,0)
and DOB elements. Three levels of the hierarchy
"IX",798.8,798.87,"APSV1",.1,90,0)
are covered by each of these sub-indexes.
"IX",798.8,798.87,"APSV1",.1,91,0)
 
"IX",798.8,798.87,"APSV1",.1,92,0)
Let us look at the corresponding index. The 
"IX",798.8,798.87,"APSV1",.1,93,0)
numbers in the first column indicate the 
"IX",798.8,798.87,"APSV1",.1,94,0)
corresponding lists from Table 2. The sub-indexes
"IX",798.8,798.87,"APSV1",.1,95,0)
are separated by empty lines:
"IX",798.8,798.87,"APSV1",.1,96,0)
 
"IX",798.8,798.87,"APSV1",.1,97,0)
  #         List  Sort   ItemValue     ItemIEN
"IX",798.8,798.87,"APSV1",.1,98,0)
 ---        ----  ----  -------------  -------
"IX",798.8,798.87,"APSV1",.1,99,0)
  1  "APSV",  1,    0,  " ",              2)
"IX",798.8,798.87,"APSV1",.1,100,0)
 
"IX",798.8,798.87,"APSV1",.1,101,0)
  2  "APSV",  2,    0,  " ",              3)
"IX",798.8,798.87,"APSV1",.1,102,0)
  2  "APSV",  2,    0,  " ",              6)
"IX",798.8,798.87,"APSV1",.1,103,0)
 
"IX",798.8,798.87,"APSV1",.1,104,0)
  5  "APSV",  2,    9,  "DOU, JOHN",      3)
"IX",798.8,798.87,"APSV1",.1,105,0)
  5  "APSV",  2,    9,  "SMITH, BOB",     6)
"IX",798.8,798.87,"APSV1",.1,106,0)
 
"IX",798.8,798.87,"APSV1",.1,107,0)
  6  "APSV",  2,   10,  "1935/10/05",     6)
"IX",798.8,798.87,"APSV1",.1,108,0)
  6  "APSV",  2,   10,  "1950/03/25",     3)
"IX",798.8,798.87,"APSV1",.1,109,0)
 
"IX",798.8,798.87,"APSV1",.1,110,0)
  3  "APSV",  3,    0,  " ",              4)
"IX",798.8,798.87,"APSV1",.1,111,0)
  3  "APSV",  3,    0,  " ",              5)
"IX",798.8,798.87,"APSV1",.1,112,0)
 
"IX",798.8,798.87,"APSV1",.1,113,0)
  4  "APSV",  6,    0,  " ",              7)
"IX",798.8,798.87,"APSV1",.1,114,0)
  4  "APSV",  6,    0,  " ",              8)
"IX",798.8,798.87,"APSV1",.1,115,0)
 
"IX",798.8,798.87,"APSV1",.1,116,0)
Let us look more closely at the first entry of the
"IX",798.8,798.87,"APSV1",.1,117,0)
sub-index #5 (also see Table 1):
"IX",798.8,798.87,"APSV1",.1,118,0)
 
"IX",798.8,798.87,"APSV1",.1,119,0)
 2  is the IEN of the REPORTS element in the
"IX",798.8,798.87,"APSV1",.1,120,0)
    REPORT ELEMENT multiple;
"IX",798.8,798.87,"APSV1",.1,121,0)
 
"IX",798.8,798.87,"APSV1",.1,122,0)
 9  is the sorting mode (the IEN of the NAME
"IX",798.8,798.87,"APSV1",.1,123,0)
    element in the ROR XML ELEMENT file);
"IX",798.8,798.87,"APSV1",.1,124,0)
 
"IX",798.8,798.87,"APSV1",.1,125,0)
 "DOU, JOHN"
"IX",798.8,798.87,"APSV1",.1,126,0)
    is the value of the NAME element;
"IX",798.8,798.87,"APSV1",.1,127,0)
 
"IX",798.8,798.87,"APSV1",.1,128,0)
 3  is the IEN of the corresponding PATIENT
"IX",798.8,798.87,"APSV1",.1,129,0)
    element in the REPORT ELEMENT multiple.
"IX",798.8,798.87,"APSV1",.1,130,0)
 
"IX",798.8,798.87,"APSV1",.1,131,0)
If the sort mode 9 (NAME) is used then the
"IX",798.8,798.87,"APSV1",.1,132,0)
resulting XML document will look like this:
"IX",798.8,798.87,"APSV1",.1,133,0)
 
"IX",798.8,798.87,"APSV1",.1,134,0)
 <REPORT>
"IX",798.8,798.87,"APSV1",.1,135,0)
  <PATIENTS>
"IX",798.8,798.87,"APSV1",.1,136,0)
   <PATIENT>
"IX",798.8,798.87,"APSV1",.1,137,0)
    <NAME>DOU, JOHN"</NAME>
"IX",798.8,798.87,"APSV1",.1,138,0)
    <DOB>950/03/25</DOB>
"IX",798.8,798.87,"APSV1",.1,139,0)
   </PATIENT>
"IX",798.8,798.87,"APSV1",.1,140,0)
   <PATIENT>
"IX",798.8,798.87,"APSV1",.1,141,0)
    <NAME>SMITH, BOB</NAME>
"IX",798.8,798.87,"APSV1",.1,142,0)
    <DOB>1935/10/05</DOB>
"IX",798.8,798.87,"APSV1",.1,143,0)
   </PATIENT>
"IX",798.8,798.87,"APSV1",.1,144,0)
  </PATIENTS>
"IX",798.8,798.87,"APSV1",.1,145,0)
 </REPORT>
"IX",798.8,798.87,"APSV1",.1,146,0)
 
"IX",798.8,798.87,"APSV1",.1,147,0)
If the sort mode 10 (DOB) is used, the resulting
"IX",798.8,798.87,"APSV1",.1,148,0)
XML document will look as follow:
"IX",798.8,798.87,"APSV1",.1,149,0)
 
"IX",798.8,798.87,"APSV1",.1,150,0)
 <REPORT>
"IX",798.8,798.87,"APSV1",.1,151,0)
  <PATIENTS>
"IX",798.8,798.87,"APSV1",.1,152,0)
   <PATIENT>
"IX",798.8,798.87,"APSV1",.1,153,0)
    <NAME>SMITH, BOB</NAME>
"IX",798.8,798.87,"APSV1",.1,154,0)
    <DOB>1935/10/05</DOB>
"IX",798.8,798.87,"APSV1",.1,155,0)
   </PATIENT>
"IX",798.8,798.87,"APSV1",.1,156,0)
   <PATIENT>
"IX",798.8,798.87,"APSV1",.1,157,0)
    <NAME>DOU, JOHN"</NAME>
"IX",798.8,798.87,"APSV1",.1,158,0)
    <DOB>950/03/25</DOB>
"IX",798.8,798.87,"APSV1",.1,159,0)
   </PATIENT>
"IX",798.8,798.87,"APSV1",.1,160,0)
  </PATIENTS>
"IX",798.8,798.87,"APSV1",.1,161,0)
 </REPORT>
"IX",798.8,798.87,"APSV1",1)
S ^RORDATA(798.8,DA(1),"RI","APSV",X(2),X(3),X(6),X(1))=""
"IX",798.8,798.87,"APSV1",1.4)
S X=(X(5)>0)
"IX",798.8,798.87,"APSV1",2)
K ^RORDATA(798.8,DA(1),"RI","APSV",X(2),X(3),X(6),X(1))
"IX",798.8,798.87,"APSV1",2.5)

"IX",798.8,798.87,"APSV1",11.1,0)
^.114IA^10^6
"IX",798.8,798.87,"APSV1",11.1,1,0)
1^F^798.87^.02^^4^F
"IX",798.8,798.87,"APSV1",11.1,2,0)
2^C^^^^1
"IX",798.8,798.87,"APSV1",11.1,2,1.5)
S X=$S(X(1)>0:$P($G(^RORDATA(798.8,DA(1),"RI",X(1),0)),U,2),1:"")
"IX",798.8,798.87,"APSV1",11.1,6,0)
6^C^^^30^3
"IX",798.8,798.87,"APSV1",11.1,6,1.5)
S X=$$SORTBY^RORDD01(X(5),X(4))
"IX",798.8,798.87,"APSV1",11.1,8,0)
3^F^798.87^.01^^2^F
"IX",798.8,798.87,"APSV1",11.1,9,0)
4^F^798.87^1^30^^F
"IX",798.8,798.87,"APSV1",11.1,10,0)
5^F^798.87^.03^^^
"IX",798.9,798.9,"B",0)
798.9^B^Uniqueness Index for the "A" Key of File #798.9^R^^F^IR^I^798.9^^^^^LS
"IX",798.9,798.9,"B",1)
S ^ROR(798.9,"B",X,DA)=""
"IX",798.9,798.9,"B",2)
K ^ROR(798.9,"B",X,DA)
"IX",798.9,798.9,"B",2.5)
K ^ROR(798.9,"B")
"IX",798.9,798.9,"B",11.1,0)
^.114IA^1^1
"IX",798.9,798.9,"B",11.1,1,0)
1^F^798.9^.01^^1
"IX",799.1,799.1,"KEY",0)
799.1^KEY^Uniqueness Index for the "A" Key of File #799.1^R^^R^IR^I^799.1^^^^^LS
"IX",799.1,799.1,"KEY",1)
S ^ROR(799.1,"KEY",X(1),X(2),X(3),DA)=""
"IX",799.1,799.1,"KEY",2)
K ^ROR(799.1,"KEY",X(1),X(2),X(3),DA)
"IX",799.1,799.1,"KEY",2.5)
K ^ROR(799.1,"KEY")
"IX",799.1,799.1,"KEY",11.1,0)
^.114IA^3^3
"IX",799.1,799.1,"KEY",11.1,1,0)
1^F^799.1^.02^^1
"IX",799.1,799.1,"KEY",11.1,2,0)
2^F^799.1^.03^^2
"IX",799.1,799.1,"KEY",11.1,3,0)
3^F^799.1^.04^^3
"IX",799.2,799.2,"DEC",0)
799.2^DEC^Global list of Data Element Codes.^R^^F^IR^W^799.22^^^^^LS
"IX",799.2,799.2,"DEC",1)
S ^ROR(799.2,"DEC",X,DA(1),DA)=""
"IX",799.2,799.2,"DEC",2)
K ^ROR(799.2,"DEC",X,DA(1),DA)
"IX",799.2,799.2,"DEC",2.5)
K ^ROR(799.2,"DEC")
"IX",799.2,799.2,"DEC",11.1,0)
^.114IA^1^1
"IX",799.2,799.2,"DEC",11.1,1,0)
1^F^799.22^.02^^1^F
"IX",799.2,799.22,"B",0)
799.22^B^Data element name uniqueness index.^R^^F^IR^I^799.22^^^^^LS
"IX",799.2,799.22,"B",1)
S ^ROR(799.2,DA(1),2,"B",$E(X,1,30),DA)=""
"IX",799.2,799.22,"B",2)
K ^ROR(799.2,DA(1),2,"B",$E(X,1,30),DA)
"IX",799.2,799.22,"B",2.5)
K ^ROR(799.2,DA(1),2,"B")
"IX",799.2,799.22,"B",11.1,0)
^.114IA^1^1
"IX",799.2,799.22,"B",11.1,1,0)
1^F^799.22^.01^30^1^F
"IX",799.31,799.31,"B",0)
799.31^B^Uniqueness Index for Key 'A' of File #799.31^R^^F^IR^I^799.31^^^^^LS
"IX",799.31,799.31,"B",1)
S ^ROR(799.31,"B",X,DA)=""
"IX",799.31,799.31,"B",2)
K ^ROR(799.31,"B",X,DA)
"IX",799.31,799.31,"B",2.5)
K ^ROR(799.31,"B")
"IX",799.31,799.31,"B",11.1,0)
^.114IA^1^1
"IX",799.31,799.31,"B",11.1,1,0)
1^F^799.31^.01^^1
"IX",799.34,799.34,"KEY",0)
799.34^KEY^Uniqueness Index for Key 'A' of File #799.34^R^^F^IR^I^799.34^^^^^LS
"IX",799.34,799.34,"KEY",1)
S ^ROR(799.34,"KEY",X,DA)=""
"IX",799.34,799.34,"KEY",2)
K ^ROR(799.34,"KEY",X,DA)
"IX",799.34,799.34,"KEY",2.5)
K ^ROR(799.34,"KEY")
"IX",799.34,799.34,"KEY",11.1,0)
^.114IA^1^1
"IX",799.34,799.34,"KEY",11.1,1,0)
1^F^799.34^.04^^1
"IX",799.4,799.41,"AD",0)
799.41^AD^Date of diagnosis^R^^R^IR^I^799.41^^^^^S
"IX",799.4,799.41,"AD",.1,0)
^^2^2^3030507^
"IX",799.4,799.41,"AD",.1,1,0)
This index sorts the AIDS indicator diseases by
"IX",799.4,799.41,"AD",.1,2,0)
the dates when they were diagnosed.
"IX",799.4,799.41,"AD",1)
S ^RORDATA(799.4,DA(1),10,"AD",X(2),DA)=""
"IX",799.4,799.41,"AD",1.4)
S X=(X(1)'="")
"IX",799.4,799.41,"AD",2)
K ^RORDATA(799.4,DA(1),10,"AD",X(2),DA)
"IX",799.4,799.41,"AD",2.5)
K ^RORDATA(799.4,DA(1),10,"AD")
"IX",799.4,799.41,"AD",11.1,0)
^.114IA^2^2
"IX",799.4,799.41,"AD",11.1,1,0)
1^F^799.41^.02^^^F
"IX",799.4,799.41,"AD",11.1,2,0)
2^F^799.41^.03^^1^F
"IX",799.51,799.51,"ARDG",0)
799.51^ARDG^Registry & Drug Group^R^^R^IR^I^799.51^^^^^S
"IX",799.51,799.51,"ARDG",1)
S ^ROR(799.51,"ARDG",X(2),X(3),DA)=""
"IX",799.51,799.51,"ARDG",2)
K ^ROR(799.51,"ARDG",X(2),X(3),DA)
"IX",799.51,799.51,"ARDG",2.5)
K ^ROR(799.51,"ARDG")
"IX",799.51,799.51,"ARDG",11.1,0)
^.114IA^3^3
"IX",799.51,799.51,"ARDG",11.1,1,0)
1^F^799.51^.02^^^F
"IX",799.51,799.51,"ARDG",11.1,2,0)
3^F^799.51^.04^^2^F
"IX",799.51,799.51,"ARDG",11.1,3,0)
2^C^^^^1
"IX",799.51,799.51,"ARDG",11.1,3,1.5)
S X=$S(X(1)'="":X(1)_"#",1:"")
"IX",799.51,799.51,"KEY",0)
799.51^KEY^Registry, Drug Group, Generic Drug^R^^R^IR^I^799.51^^^^^LS
"IX",799.51,799.51,"KEY",1)
S ^ROR(799.51,"KEY",X(1),X(2),X(3),DA)=""
"IX",799.51,799.51,"KEY",2)
K ^ROR(799.51,"KEY",X(1),X(2),X(3),DA)
"IX",799.51,799.51,"KEY",2.5)
K ^ROR(799.51,"KEY")
"IX",799.51,799.51,"KEY",11.1,0)
^.114IA^3^3
"IX",799.51,799.51,"KEY",11.1,1,0)
1^F^799.51^.02^^1
"IX",799.51,799.51,"KEY",11.1,2,0)
2^F^799.51^.03^^2
"IX",799.51,799.51,"KEY",11.1,3,0)
3^F^799.51^.04^^3
"IX",799.53,799.53,"KEY",0)
799.53^KEY^Uniqueness Index for Key 'A' of File #799.53^R^^R^IR^I^799.53^^^^^LS
"IX",799.53,799.53,"KEY",1)
S ^ROR(799.53,"KEY",X(1),X(2),DA)=""
"IX",799.53,799.53,"KEY",2)
K ^ROR(799.53,"KEY",X(1),X(2),DA)
"IX",799.53,799.53,"KEY",2.5)
K ^ROR(799.53,"KEY")
"IX",799.53,799.53,"KEY",11.1,0)
^.114IA^2^2
"IX",799.53,799.53,"KEY",11.1,1,0)
1^F^799.53^.03^^1
"IX",799.53,799.53,"KEY",11.1,2,0)
2^F^799.53^.01^^2
"IX",799.6,799.6,"ADNAUTO",0)
799.6^ADNAUTO^Activation Date & Name for automatic backpulls.^R^^R^IR^I^799.6^^^^^S
"IX",799.6,799.6,"ADNAUTO",.1,0)
^^6^6^3051031^
"IX",799.6,799.6,"ADNAUTO",.1,1,0)
This index references parameters of those
"IX",799.6,799.6,"ADNAUTO",.1,2,0)
automatic historical data extractions (TYPE =
"IX",799.6,799.6,"ADNAUTO",.1,3,0)
"Auto (HL7 messages)") that are active (ACTIVATION
"IX",799.6,799.6,"ADNAUTO",.1,4,0)
DATE > 0) but have not been completed yet (some
"IX",799.6,799.6,"ADNAUTO",.1,5,0)
records of the REGISTRY NAME multiple have no
"IX",799.6,799.6,"ADNAUTO",.1,6,0)
value in the COMPLETION DATE/TIME field).
"IX",799.6,799.6,"ADNAUTO",1)
S ^RORDATA(799.6,"ADNAUTO",X(1),$E(X(2),1,30),DA)=""
"IX",799.6,799.6,"ADNAUTO",1.4)
S X=(X(3)=1)&(X(4)>0)&($D(^RORDATA(799.6,DA,3,"ANC"))>1)
"IX",799.6,799.6,"ADNAUTO",2)
K ^RORDATA(799.6,"ADNAUTO",X(1),$E(X(2),1,30),DA)
"IX",799.6,799.6,"ADNAUTO",2.5)
K ^RORDATA(799.6,"ADNAUTO")
"IX",799.6,799.6,"ADNAUTO",11.1,0)
^.114IA^4^4
"IX",799.6,799.6,"ADNAUTO",11.1,1,0)
1^F^799.6^.07^^1^F
"IX",799.6,799.6,"ADNAUTO",11.1,2,0)
2^F^799.6^.01^30^2^F
"IX",799.6,799.6,"ADNAUTO",11.1,3,0)
3^F^799.6^.02^^^F
"IX",799.6,799.6,"ADNAUTO",11.1,4,0)
4^F^799.6^.07^^^F
"IX",799.6,799.6,"B",0)
799.6^B^Uniqueness Index for Key 'A' of File #799.6^R^^F^IR^I^799.6^^^^^LS
"IX",799.6,799.6,"B",1)
S ^RORDATA(799.6,"B",X,DA)=""
"IX",799.6,799.6,"B",2)
K ^RORDATA(799.6,"B",X,DA)
"IX",799.6,799.6,"B",2.5)
K ^RORDATA(799.6,"B")
"IX",799.6,799.6,"B",11.1,0)
^.114IA^1^1
"IX",799.6,799.6,"B",11.1,1,0)
1^F^799.6^.01^^1
"IX",799.6,799.61,"B",0)
799.61^B^Uniqueness Index for Key 'A' of Subfile #799.61^R^^F^IR^I^799.61^^^^^LS
"IX",799.6,799.61,"B",1)
S ^RORDATA(799.6,DA(1),1,"B",X,DA)=""
"IX",799.6,799.61,"B",2)
K ^RORDATA(799.6,DA(1),1,"B",X,DA)
"IX",799.6,799.61,"B",2.5)
K ^RORDATA(799.6,DA(1),1,"B")
"IX",799.6,799.61,"B",11.1,0)
^.114IA^1^1
"IX",799.6,799.61,"B",11.1,1,0)
1^F^799.61^.01^^1
"IX",799.6,799.63,"ANC",0)
799.63^ANC^Not completed registries^MU^^R^IR^I^799.63^^^^^S
"IX",799.6,799.63,"ANC",1)
D ANC7996^RORDD01(.DA,X(1),1)
"IX",799.6,799.63,"ANC",1.4)
S X=(X(2)'>0)
"IX",799.6,799.63,"ANC",2)
D ANC7996^RORDD01(.DA,X(1),0)
"IX",799.6,799.63,"ANC",2.5)
K ^RORDATA(799.6,DA(1),3,"ANC")
"IX",799.6,799.63,"ANC",11.1,0)
^.114IA^2^2
"IX",799.6,799.63,"ANC",11.1,1,0)
1^F^799.63^.01^30^1^F
"IX",799.6,799.63,"ANC",11.1,2,0)
2^F^799.63^.02^^^F
"IX",799.6,799.63,"B",0)
799.63^B^Uniqueness Index for Key 'A' of Subfile #799.63^R^^F^IR^I^799.63^^^^^LS
"IX",799.6,799.63,"B",1)
S ^RORDATA(799.6,DA(1),3,"B",X,DA)=""
"IX",799.6,799.63,"B",2)
K ^RORDATA(799.6,DA(1),3,"B",X,DA)
"IX",799.6,799.63,"B",2.5)
K ^RORDATA(799.6,DA(1),3,"B")
"IX",799.6,799.63,"B",11.1,0)
^.114IA^1^1
"IX",799.6,799.63,"B",11.1,1,0)
1^F^799.63^.01^^1
"IX",799.6,799.64,"ANC",0)
799.64^ANC^Not completed tasks^R^^R^IR^I^799.64^^^^^S
"IX",799.6,799.64,"ANC",1)
S ^RORDATA(799.6,DA(1),4,"ANC",X(1),DA)=""
"IX",799.6,799.64,"ANC",1.4)
S X=(X(2)'=3)
"IX",799.6,799.64,"ANC",2)
K ^RORDATA(799.6,DA(1),4,"ANC",X(1),DA)
"IX",799.6,799.64,"ANC",2.5)
K ^RORDATA(799.6,DA(1),4,"ANC")
"IX",799.6,799.64,"ANC",11.1,0)
^.114IA^2^2
"IX",799.6,799.64,"ANC",11.1,1,0)
1^F^799.64^.01^^1^F
"IX",799.6,799.64,"ANC",11.1,1,3)

"IX",799.6,799.64,"ANC",11.1,2,0)
2^F^799.64^.03^^^F
"IX",799.6,799.64,"ANC",11.1,2,3)

"IX",799.6,799.64,"B",0)
799.64^B^Uniqueness Index for Key 'A' of Subfile #799.64^R^^F^IR^I^799.64^^^^^LS
"IX",799.6,799.64,"B",1)
S ^RORDATA(799.6,DA(1),4,"B",X,DA)=""
"IX",799.6,799.64,"B",2)
K ^RORDATA(799.6,DA(1),4,"B",X,DA)
"IX",799.6,799.64,"B",2.5)
K ^RORDATA(799.6,DA(1),4,"B")
"IX",799.6,799.64,"B",11.1,0)
^.114IA^1^1
"IX",799.6,799.64,"B",11.1,1,0)
1^F^799.64^.01^^1
"KEY",798,798,"A",0)
798^A^P^100
"KEY",798,798,"A",2,0)
^.312IA^2^2
"KEY",798,798,"A",2,1,0)
.01^798^1
"KEY",798,798,"A",2,2,0)
.02^798^2
"KEY",798,798.02,"B",0)
798.02^B^S^654
"KEY",798,798.02,"B",2,0)
^.312IA^1^1
"KEY",798,798.02,"B",2,1,0)
.01^798.02^1
"KEY",798.1,798.1,"A",0)
798.1^A^S^488
"KEY",798.1,798.1,"A",2,0)
^.312IA^1^1
"KEY",798.1,798.1,"A",2,1,0)
.01^798.1^1
"KEY",798.1,798.11,"A",0)
798.11^A^S^682
"KEY",798.1,798.11,"A",2,0)
^.312IA^1^1
"KEY",798.1,798.11,"A",2,1,0)
.01^798.11^1
"KEY",798.1,798.118,"A",0)
798.118^A^S^683
"KEY",798.1,798.118,"A",2,0)
^.312IA^1^1
"KEY",798.1,798.118,"A",2,1,0)
.01^798.118^1
"KEY",798.1,798.122,"A",0)
798.122^A^S^684
"KEY",798.1,798.122,"A",2,0)
^.312IA^1^1
"KEY",798.1,798.122,"A",2,1,0)
.01^798.122^1
"KEY",798.1,798.128,"G",0)
798.128^G^P^247
"KEY",798.1,798.128,"G",2,0)
^.312IA^2^2
"KEY",798.1,798.128,"G",2,1,0)
.02^798.128^1
"KEY",798.1,798.128,"G",2,2,0)
.01^798.128^2
"KEY",798.1,798.129,"G",0)
798.129^G^P^258
"KEY",798.1,798.129,"G",2,0)
^.312IA^2^2
"KEY",798.1,798.129,"G",2,1,0)
.02^798.129^1
"KEY",798.1,798.129,"G",2,2,0)
.01^798.129^2
"KEY",798.1,798.13,"A",0)
798.13^A^S^681
"KEY",798.1,798.13,"A",2,0)
^.312IA^1^1
"KEY",798.1,798.13,"A",2,1,0)
.01^798.13^1
"KEY",798.2,798.2,"A",0)
798.2^A^S^103
"KEY",798.2,798.2,"A",2,0)
^.312IA^1^1
"KEY",798.2,798.2,"A",2,1,0)
.01^798.2^1
"KEY",798.2,798.26,"A",0)
798.26^A^S^104
"KEY",798.2,798.26,"A",2,0)
^.312IA^1^1
"KEY",798.2,798.26,"A",2,1,0)
.01^798.26^1
"KEY",798.3,798.31,"A",0)
798.31^A^S^162
"KEY",798.3,798.31,"A",2,0)
^.312IA^1^1
"KEY",798.3,798.31,"A",2,1,0)
.01^798.31^1
"KEY",798.9,798.9,"A",0)
798.9^A^S^117
"KEY",798.9,798.9,"A",2,0)
^.312IA^1^1
"KEY",798.9,798.9,"A",2,1,0)
.01^798.9^1
"KEY",799.1,799.1,"A",0)
799.1^A^P^143
"KEY",799.1,799.1,"A",2,0)
^.312IA^3^3
"KEY",799.1,799.1,"A",2,1,0)
.02^799.1^1
"KEY",799.1,799.1,"A",2,2,0)
.03^799.1^2
"KEY",799.1,799.1,"A",2,3,0)
.04^799.1^3
"KEY",799.2,799.22,"A",0)
799.22^A^S^159
"KEY",799.2,799.22,"A",2,0)
^.312IA^1^1
"KEY",799.2,799.22,"A",2,1,0)
.02^799.22^1
"KEY",799.2,799.22,"B",0)
799.22^B^S^160
"KEY",799.2,799.22,"B",2,0)
^.312IA^1^1
"KEY",799.2,799.22,"B",2,1,0)
.01^799.22^1
"KEY",799.31,799.31,"A",0)
799.31^A^S^685
"KEY",799.31,799.31,"A",2,0)
^.312IA^1^1
"KEY",799.31,799.31,"A",2,1,0)
.01^799.31^1
"KEY",799.34,799.34,"A",0)
799.34^A^P^301
"KEY",799.34,799.34,"A",2,0)
^.312IA^1^1
"KEY",799.34,799.34,"A",2,1,0)
.04^799.34^1
"KEY",799.51,799.51,"A",0)
799.51^A^S^305
"KEY",799.51,799.51,"A",2,0)
^.312IA^3^3
"KEY",799.51,799.51,"A",2,1,0)
.02^799.51^1
"KEY",799.51,799.51,"A",2,2,0)
.03^799.51^2
"KEY",799.51,799.51,"A",2,3,0)
.04^799.51^3
"KEY",799.53,799.53,"A",0)
799.53^A^P^655
"KEY",799.53,799.53,"A",2,0)
^.312IA^2^2
"KEY",799.53,799.53,"A",2,1,0)
.03^799.53^1
"KEY",799.53,799.53,"A",2,2,0)
.01^799.53^2
"KEY",799.6,799.6,"A",0)
799.6^A^S^671
"KEY",799.6,799.6,"A",2,0)
^.312IA^1^1
"KEY",799.6,799.6,"A",2,1,0)
.01^799.6^1
"KEY",799.6,799.61,"A",0)
799.61^A^S^686
"KEY",799.6,799.61,"A",2,0)
^.312IA^1^1
"KEY",799.6,799.61,"A",2,1,0)
.01^799.61^1
"KEY",799.6,799.63,"A",0)
799.63^A^S^672
"KEY",799.6,799.63,"A",2,0)
^.312IA^1^1
"KEY",799.6,799.63,"A",2,1,0)
.01^799.63^1
"KEY",799.6,799.64,"A",0)
799.64^A^S^687
"KEY",799.6,799.64,"A",2,0)
^.312IA^1^1
"KEY",799.6,799.64,"A",2,1,0)
.01^799.64^1
"KEYPTR",798,798,"A")
798^KEY
"KEYPTR",798,798.02,"B")
798.02^B
"KEYPTR",798.1,798.1,"A")
798.1^B
"KEYPTR",798.1,798.11,"A")
798.11^B
"KEYPTR",798.1,798.118,"A")
798.118^B
"KEYPTR",798.1,798.122,"A")
798.122^B
"KEYPTR",798.1,798.128,"G")
798.128^G
"KEYPTR",798.1,798.129,"G")
798.129^G
"KEYPTR",798.1,798.13,"A")
798.13^B
"KEYPTR",798.2,798.2,"A")
798.2^B
"KEYPTR",798.2,798.26,"A")
798.26^B
"KEYPTR",798.3,798.31,"A")
798.31^B
"KEYPTR",798.9,798.9,"A")
798.9^B
"KEYPTR",799.1,799.1,"A")
799.1^KEY
"KEYPTR",799.2,799.22,"A")
799.2^DEC
"KEYPTR",799.2,799.22,"B")
799.22^B
"KEYPTR",799.31,799.31,"A")
799.31^B
"KEYPTR",799.34,799.34,"A")
799.34^KEY
"KEYPTR",799.51,799.51,"A")
799.51^KEY
"KEYPTR",799.53,799.53,"A")
799.53^KEY
"KEYPTR",799.6,799.6,"A")
799.6^B
"KEYPTR",799.6,799.61,"A")
799.61^B
"KEYPTR",799.6,799.63,"A")
799.63^B
"KEYPTR",799.6,799.64,"A")
799.64^B
"KRN",.4,2183,-1)
0^2
"KRN",.4,2183,0)
ROR LOG^3040608.1408^^798.7^^@^3060202
"KRN",.4,2183,"%D",0)
^.4001^2^2^3040608^^^
"KRN",.4,2183,"%D",1,0)
This template is used by the [RORMNT PRINT LOGS] option to print 
"KRN",.4,2183,"%D",2,0)
messages from the log files.
"KRN",.4,2183,"DXS")
2
"KRN",.4,2183,"DXS",1,9)
X DXS(1,9.2) S X=X S Y=X,X=DIP(3),X=X S X=X_Y_")",DIP(4)=$G(X) S X=1,DIP(5)=$G(X) S X="",X=$S(DIP(2):DIP(4),DIP(5):X)
"KRN",.4,2183,"DXS",1,9.2)
S DIP(1)=$S($D(^RORDATA(798.7,D0,2,D1,0)):^(0),1:"") S X=$P(DIP(1),U,4),X=X S X=X'="",DIP(2)=$G(X) S X=" (",DIP(3)=$G(X) S X=$P(DIP(1),U,4)
"KRN",.4,2183,"F",1)
4,.01;S1;C1~4,1~4,3;"PATIENT NAME (DFN)"~4,X DXS(1,9) W X K DIP;X;Z;"$S(INTERNAL(PATIENT)'="":" ("_INTERNAL(PATIENT)_")",1:"")"~4,2;C4~4,4,.01;C4~
"KRN",.4,2183,"H")
CLINICAL REGISTRIES LOG FILE(S)
"KRN",.4,2303,-1)
0^1
"KRN",.4,2303,0)
ROR DATA ELEMENTS^3020404.1407^^799.2^^@^3050512
"KRN",.4,2303,"F",1)
2,.02;R4;"Code"~2,.01;L25;"Data Name"~2,S DIP(1)=$S($D(^ROR(799.2,D0,0)):^(0),1:"") S X=$P(DIP(1),U,1) W X K DIP;L;"File";Z;"FILE"~
"KRN",.4,2303,"F",2)
2,6;L;"Field Number"~2,2;"Req"~2,1;"API"~
"KRN",.4,2303,"F",3)
2,S DIP(1)=$S($D(^ROR(799.2,D0,2,D1,0)):^(0),1:"") S X=$P(DIP(1),U,4),X=X W X K DIP;"VT";Z;"INTERNAL(VALUE TYPE)"~2,4.1;L20;"External Data"~
"KRN",.4,2303,"F",4)
2,4.2;L20;"Internal Data"~
"KRN",.4,2303,"H")
ROR METADATA LIST
"KRN",.4,2312,-1)
0^3
"KRN",.4,2312,0)
ROR PENDING ERRORS^3020717.1342^^798.3^^@^3060202
"KRN",.4,2312,"%D",0)
^^4^4^3020801^
"KRN",.4,2312,"%D",1,0)
This template is used by the [RORMNT PENDING 
"KRN",.4,2312,"%D",2,0)
ERRORS LIST] menu option to print a list of 
"KRN",.4,2312,"%D",3,0)
patients with erroneous data (based on content of
"KRN",.4,2312,"%D",4,0)
the ERROR multiples).
"KRN",.4,2312,"F",2)
.01~0;"DFN"~1,.01~
"KRN",.4,2312,"H")
LIST OF PENDING PATIENT ERRORS
"KRN",.401,1513,-1)
0^2
"KRN",.401,1513,0)
ROR LOG^3011102.1204^^798.7^^@^3060202
"KRN",.401,1513,2,0)
^.4014^3^3
"KRN",.401,1513,2,1,0)
798.7^0^NUMBER^@^^^^^^2
"KRN",.401,1513,2,1,"IX")
^RORDATA(798.7,^RORDATA(798.7,^1
"KRN",.401,1513,2,1,"QCON")
I D0'=""
"KRN",.401,1513,2,1,"SER")
0^0
"KRN",.401,1513,2,1,"TXT")
NUMBER not null
"KRN",.401,1513,2,2,0)
798.7^.01^START DATE/TIME^^;S1;"LOG DATE/TIME: "^^^^^1
"KRN",.401,1513,2,2,"ASK")
1
"KRN",.401,1513,2,2,"F")
3050718.999999^Jul 19,2005^Jul 19,2005
"KRN",.401,1513,2,2,"GET")
S DISX(2)=$P($G(^RORDATA(798.7,D0,0)),U)
"KRN",.401,1513,2,2,"IX")
^RORDATA(798.7,"B",^RORDATA(798.7,^2
"KRN",.401,1513,2,2,"QCON")
I DISX(2)]]3050718.999999
"KRN",.401,1513,2,2,"SER")
1.7333^0.6341
"KRN",.401,1513,2,2,"T")
z^
"KRN",.401,1513,2,2,"TXT")
START DATE/TIME from Jul 19,2005
"KRN",.401,1513,2,3,0)
798.74^.01^DATE/TIME^^^^^^^1
"KRN",.401,1513,2,3,1,0)
^.40141^1^1
"KRN",.401,1513,2,3,1,1,0)
798.7^2
"KRN",.401,1513,2,3,1,"B",798.7,1)

"KRN",.401,1513,2,3,"GET")
S DISX(3)=$P($G(^RORDATA(798.7,D0,2,D1,0)),U)
"KRN",.401,1513,2,3,"QCON")
I DISX(3)'=""
"KRN",.401,1513,2,3,"TXT")
DATE/TIME not null
"KRN",.401,1513,2,"B",798.7,1)

"KRN",.401,1513,2,"B",798.7,2)

"KRN",.401,1513,2,"B",798.74,3)

"KRN",.401,1513,"%D",0)
^.4012^2^2^3020403^^
"KRN",.401,1513,"%D",1,0)
This template is used by the [RORMNT PRINT LOGS] option to print 
"KRN",.401,1513,"%D",2,0)
messages from the log files.
"KRN",.401,1513,"DIPT")
ROR LOG
"KRN",.401,1518,-1)
0^1
"KRN",.401,1518,0)
ROR DATA ELEMENTS^3020404.1303^^799.2^^@^3050512
"KRN",.401,1518,2,0)
^.4014^1^1
"KRN",.401,1518,2,1,0)
799.22^.02^CODE^^^^^^^2
"KRN",.401,1518,2,1,1,0)
^.40141^1^1
"KRN",.401,1518,2,1,1,1,0)
799.2^2
"KRN",.401,1518,2,1,1,"B",799.2,1)

"KRN",.401,1518,2,1,"GET")
S DISX(1)=$P($G(^ROR(799.2,D0,2,D1,0)),U,2) S:DISX(1)]"" DISX(1)=+DISX(1)
"KRN",.401,1518,2,1,"IX")
^ROR(799.2,"DEC",^ROR(799.2,^2
"KRN",.401,1518,2,1,"QCON")
I DISX(1)'=""
"KRN",.401,1518,2,1,"TXT")
CODE not null
"KRN",.401,1518,2,"B",799.22,1)

"KRN",.401,1518,"DIPT")
ROR DATA ELEMENTS
"KRN",.401,1520,-1)
0^3
"KRN",.401,1520,0)
ROR PENDING ERRORS^3020717.1339^^798.3^^@^3060202
"KRN",.401,1520,2,0)
^.4014^4^4
"KRN",.401,1520,2,1,0)
798.31^2^COUNTER^-^;S^^^^^2
"KRN",.401,1520,2,1,1,0)
^.40141^1^1
"KRN",.401,1520,2,1,1,1,0)
798.3^1
"KRN",.401,1520,2,1,1,"B",798.3,1)

"KRN",.401,1520,2,1,"GET")
S DISX(1)=$P($G(^RORDATA(798.3,D0,1,D1,0)),U,3) S:DISX(1)]"" DISX(1)=+DISX(1)
"KRN",.401,1520,2,1,"QCON")
I DISX(1)'=""
"KRN",.401,1520,2,1,"TXT")
COUNTER not null
"KRN",.401,1520,2,2,0)
798.3^^""^"^;S^^^^^4
"KRN",.401,1520,2,2,"CM")
S X="" I D0>0 S DISX(2)=X
"KRN",.401,1520,2,2,"F")
?z^@
"KRN",.401,1520,2,2,"GET")
S X="" I D0>0 S DISX(2)=X
"KRN",.401,1520,2,2,"QCON")
I DISX(2)=""
"KRN",.401,1520,2,2,"T")
@^@
"KRN",.401,1520,2,2,"TXT")
"""" is null
"KRN",.401,1520,2,3,0)
798.3^^PATIENT NAME^".01^^^^^^4
"KRN",.401,1520,2,3,"CM")
S Y(1)=$S($D(^RORDATA(798.3,D0,0)):^(0),1:"") S X=$S('$D(^DPT(+$P(Y(1),U,1),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(3)=X
"KRN",.401,1520,2,3,"GET")
S Y(1)=$S($D(^RORDATA(798.3,D0,0)):^(0),1:"") S X=$S('$D(^DPT(+$P(Y(1),U,1),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(3)=X
"KRN",.401,1520,2,3,"IX")
^RORDATA(798.3,"B",^RORDATA(798.3,^2
"KRN",.401,1520,2,3,"PTRIX")
^DPT("B",
"KRN",.401,1520,2,3,"QCON")
I DISX(3)'=""
"KRN",.401,1520,2,3,"SER")
0.0000^0.0000
"KRN",.401,1520,2,3,"TXT")
PATIENT NAME not null
"KRN",.401,1520,2,4,0)
798.3^0^NUMBER^^^^^^^2
"KRN",.401,1520,2,4,"IX")
^RORDATA(798.3,^RORDATA(798.3,^1
"KRN",.401,1520,2,4,"QCON")
I D0'=""
"KRN",.401,1520,2,4,"SER")
0^0
"KRN",.401,1520,2,4,"TXT")
NUMBER not null
"KRN",.401,1520,2,"B",798.3,2)

"KRN",.401,1520,2,"B",798.3,3)

"KRN",.401,1520,2,"B",798.3,4)

"KRN",.401,1520,2,"B",798.31,1)

"KRN",.401,1520,"%D",0)
^^5^5^3020801^
"KRN",.401,1520,"%D",1,0)
This template is used by the [RORMNT PENDING 
"KRN",.401,1520,"%D",2,0)
ERRORS LIST] menu option to sort and group a list
"KRN",.401,1520,"%D",3,0)
of patients with erroneous data by error counter 
"KRN",.401,1520,"%D",4,0)
(value of the COUNTER field). Patients with higher
"KRN",.401,1520,"%D",5,0)
counters are printed first.
"KRN",.402,2099,-1)
0^4
"KRN",.402,2099,0)
RORMNT EDIT REG PARAMS^3030424.1422^^798.1^^@^3060202
"KRN",.402,2099,"%D",0)
^.4021^2^2^3030424^^^
"KRN",.402,2099,"%D",1,0)
This template is used by the [RORMNT EDIT REG PARAMS] menu option to
"KRN",.402,2099,"%D",2,0)
review/edit the registry parameters.
"KRN",.402,2099,"DIAB",1,1,798.11,0)
ALL
"KRN",.402,2099,"DIAB",1,1,798.114,0)
ALL
"KRN",.402,2099,"DR",1,798.1)
1;2;7;8;8.1;11;14;15.1;15.9;13.2;25;13.1;
"KRN",.402,2099,"DR",2,798.11)
.01
"KRN",.402,2099,"DR",2,798.114)
.01
"KRN",.402,2102,-1)
0^3
"KRN",.402,2102,0)
RORMNT EDIT LAB SEARCH^3020305.102^^798.9^^@^3060202
"KRN",.402,2102,"DR",1,798.9)
2;1;
"KRN",.402,2102,"DR",2,798.92)
.01;1;2;
"KRN",.402,2198,-1)
0^5
"KRN",.402,2198,0)
RORHDT EDIT EXTRACTION^3051220.0941^@^799.6^^@^3060109
"KRN",.402,2198,"DIAB",1,1,799.63,0)
REGISTRY NAME;REQ
"KRN",.402,2198,"DIAB",2,0,799.6,0)
START DATE;REQ
"KRN",.402,2198,"DIAB",3,0,799.6,0)
END DATE;REQ
"KRN",.402,2198,"DIAB",4,0,799.6,0)
PATIENTS PER BATCH//750;REQ
"KRN",.402,2198,"DIAB",5,0,799.6,0)
OUTPUT DIRECTORY;REQ
"KRN",.402,2198,"DIAB",6,0,799.6,0)
BASE FILE NAME//ROR;REQ
"KRN",.402,2198,"DR",1,799.6)
.02///2;.03R~;.04R~;.05R~//750;2R~;.08R~//ROR;3;1;
"KRN",.402,2198,"DR",2,799.61)
.01;.02;.03;
"KRN",.402,2198,"DR",2,799.63)
.01R~;.02;
"KRN",.402,2199,-1)
0^6
"KRN",.402,2199,0)
RORHDT EDIT NATIONAL EXTRACT^3051220.0945^@^799.6^^@^3060109
"KRN",.402,2199,"DIAB",1,0,799.6,0)
OUTPUT DIRECTORY;REQ
"KRN",.402,2199,"DR",1,799.6)
2R~;
"KRN",.402,2200,-1)
1^1
"KRN",.402,2200,0)
RORHDT EDIT PARAMS    FILE #798.1
"KRN",.5,221,-1)
0^1
"KRN",.5,221,0)
RORPTSTATUS
"KRN",.5,221,1)
S X=$S(X>0:+$P($G(^RORDATA(798,+X,0)),U),1:0),X=$S(X'>0:9,$P($G(^RORDATA(798.4,X,1)),U,4)>0:2,1:1)
"KRN",.5,221,3)
1
"KRN",.5,221,9)
Returns patient's status (1-Alive, 2-Dead, 9-Unknown)
"KRN",.84,7980000.001,-1)
0^3
"KRN",.84,7980000.001,0)
7980000.001^1^^CLINICAL CASE REGISTRIES^Empty TASK PARAMETERS field
"KRN",.84,7980000.001,2,0)
^^3^3^3021213^
"KRN",.84,7980000.001,2,1,0)
You must enter registry name(s) into the TASK PARAMETERS field
"KRN",.84,7980000.001,2,2,0)
during scheduling the task. If several names are entered, they
"KRN",.84,7980000.001,2,3,0)
should be separated by commas.
"KRN",.84,7980000.001,5,0)
^.841^1^1
"KRN",.84,7980000.001,5,1,0)
ROR^TASK
"KRN",.84,7980000.001,5,"B","ROR",1)

"KRN",.84,7980000.002,-1)
0^4
"KRN",.84,7980000.002,0)
7980000.002^2^y^CLINICAL CASE REGISTRIES^HL7 Message Status (XML)
"KRN",.84,7980000.002,2,0)
^.844^23^23^3050509^^^
"KRN",.84,7980000.002,2,1,0)
<MESSAGE_STATUS>
"KRN",.84,7980000.002,2,2,0)
  <DESCRIPTION>
"KRN",.84,7980000.002,2,3,0)
    Message ID....... |ID|
"KRN",.84,7980000.002,2,4,0)
    Message status... |STATUS|
"KRN",.84,7980000.002,2,5,0)
    Status updated... |UPDATED|
"KRN",.84,7980000.002,2,6,0)
    Error message.... |ERRMSG|
"KRN",.84,7980000.002,2,7,0)
    Error type....... |ERRTYPE|
"KRN",.84,7980000.002,2,8,0)
    # of retries..... |RETRIES|
"KRN",.84,7980000.002,2,9,0)
    Queue position... |QPOS|
"KRN",.84,7980000.002,2,10,0)
    # Open failed.... |OPENFAIL|
"KRN",.84,7980000.002,2,11,0)
    ACK timeout...... |ACK|
"KRN",.84,7980000.002,2,12,0)
  </DESCRIPTION>
"KRN",.84,7980000.002,2,13,0)
  <MSGID>|ID|</MSGID>
"KRN",.84,7980000.002,2,14,0)
  <STATUS>|STATUS|</STATUS>
"KRN",.84,7980000.002,2,15,0)
  <STATUS_CODE>|STATCODE|</STATUS_CODE>
"KRN",.84,7980000.002,2,16,0)
  <STATUS_UPDATED>|STATUPD|</STATUS_UPDATED>
"KRN",.84,7980000.002,2,17,0)
  <ERRMSG>|ERRMSG|</ERRMSG>
"KRN",.84,7980000.002,2,18,0)
  <ERRTYPE>|ERRTYPE|</ERRTYPE>
"KRN",.84,7980000.002,2,19,0)
  <RETRIES>|RETRIES|</RETRIES>
"KRN",.84,7980000.002,2,20,0)
  <QPOS>|QPOS|</QPOS>
"KRN",.84,7980000.002,2,21,0)
  <OPENFAIL>|OPENFAIL|</OPENFAIL>
"KRN",.84,7980000.002,2,22,0)
  <ACKTO>|ACK|</ACKTO>
"KRN",.84,7980000.002,2,23,0)
</MESSAGE_STATUS>
"KRN",.84,7980000.002,3,0)
^.845^9^9
"KRN",.84,7980000.002,3,1,0)
ID
"KRN",.84,7980000.002,3,2,0)
STATUS
"KRN",.84,7980000.002,3,3,0)
UPDATED
"KRN",.84,7980000.002,3,4,0)
ERRMSG
"KRN",.84,7980000.002,3,5,0)
RETRIES
"KRN",.84,7980000.002,3,6,0)
QPOS
"KRN",.84,7980000.002,3,7,0)
OPENFAIL
"KRN",.84,7980000.002,3,8,0)
ACK
"KRN",.84,7980000.002,3,9,0)
ERRTYPE
"KRN",.84,7980000.002,5,0)
^.841^2^1
"KRN",.84,7980000.002,5,2,0)
ROR10^NOTIFY
"KRN",.84,7980000.002,5,"B","ROR10",2)

"KRN",.84,7980000.003,-1)
0^5
"KRN",.84,7980000.003,0)
7980000.003^1^^CLINICAL CASE REGISTRIES^Access Violation Message
"KRN",.84,7980000.003,2,0)
^.844^2^2^3030708^^^
"KRN",.84,7980000.003,2,1,0)
YOU ARE NOT ALLOWED TO ACCESS THE CLINICAL CASE REGISTRIES FILES!
"KRN",.84,7980000.003,2,2,0)
SEE YOUR REGISTRY COORDINATOR FOR THE PROPER SECURITY KEYS.
"KRN",.84,7980000.003,5,0)
^.841^1^1
"KRN",.84,7980000.003,5,1,0)
RORDD^ACCESS
"KRN",.84,7980000.003,5,"B","RORDD",1)

"KRN",.84,7980000.004,-1)
0^6
"KRN",.84,7980000.004,0)
7980000.004^2^y^CLINICAL CASE REGISTRIES^HL7 Message Status (Text)
"KRN",.84,7980000.004,2,0)
^.844^9^9^3050509^^^^
"KRN",.84,7980000.004,2,1,0)
  Message ID....... |ID|
"KRN",.84,7980000.004,2,2,0)
  Message status... |STATUS|
"KRN",.84,7980000.004,2,3,0)
  Status updated... |UPDATED|
"KRN",.84,7980000.004,2,4,0)
  Error message.... |ERRMSG|
"KRN",.84,7980000.004,2,5,0)
  Error type....... |ERRTYPE|
"KRN",.84,7980000.004,2,6,0)
  # of retries..... |RETRIES|
"KRN",.84,7980000.004,2,7,0)
  Queue position... |QPOS|
"KRN",.84,7980000.004,2,8,0)
  # Open failed.... |OPENFAIL|
"KRN",.84,7980000.004,2,9,0)
  ACK timeout...... |ACK|
"KRN",.84,7980000.004,3,0)
^.845^9^9
"KRN",.84,7980000.004,3,1,0)
ID
"KRN",.84,7980000.004,3,2,0)
STATUS
"KRN",.84,7980000.004,3,3,0)
UPDATED
"KRN",.84,7980000.004,3,4,0)
ERRMSG
"KRN",.84,7980000.004,3,5,0)
RETRIES
"KRN",.84,7980000.004,3,6,0)
QPOS
"KRN",.84,7980000.004,3,7,0)
OPENFAIL
"KRN",.84,7980000.004,3,8,0)
ACK
"KRN",.84,7980000.004,3,9,0)
ERRTYPE
"KRN",.84,7980000.004,5,0)
^.841^2^2
"KRN",.84,7980000.004,5,1,0)
RORUTL05^MSG7STS
"KRN",.84,7980000.004,5,2,0)
ROR10^NOTIFY
"KRN",.84,7980000.004,5,"B","ROR10",2)

"KRN",.84,7980000.004,5,"B","RORUTL05",1)

"KRN",.84,7980000.006,-1)
0^8
"KRN",.84,7980000.006,0)
7980000.006^1^y^CLINICAL CASE REGISTRIES^Incompatible GUI
"KRN",.84,7980000.006,2,0)
^^2^2^3051109^
"KRN",.84,7980000.006,2,1,0)
You are using the CCR GUI version |CV|. It is incompatible with this
"KRN",.84,7980000.006,2,2,0)
server. The version not less than |RV| is required.
"KRN",.84,7980000.006,3,0)
^.845^2^2
"KRN",.84,7980000.006,3,1,0)
CV^Current GUI version
"KRN",.84,7980000.006,3,2,0)
RV^Required GUI version
"KRN",.84,7980000.006,5,0)
^.841^1^1
"KRN",.84,7980000.006,5,1,0)
RORRP013^ACREGLST
"KRN",.84,7980000.006,5,"B","RORRP013",1)

"KRN",.84,7980000.007,-1)
0^9
"KRN",.84,7980000.007,0)
7980000.007^3^^CLINICAL CASE REGISTRIES^Re-index the ACL xref
"KRN",.84,7980000.007,2,0)
^.844^6^6^3030606^^^
"KRN",.84,7980000.007,2,1,0)
The "ACL" cross-reference of the ROR REGISTRY PARAMETERS file (#798.1)
"KRN",.84,7980000.007,2,2,0)
should be rebuilt after changes in the allocation of the security keys
"KRN",.84,7980000.007,2,3,0)
associated with any registry. Usually, this is done by the nightly task
"KRN",.84,7980000.007,2,4,0)
(the [ROR TASK] option).  However, if you want the changes to be in effect
"KRN",.84,7980000.007,2,5,0)
immediately, you should rebuild this cross-reference manually.
"KRN",.84,7980000.007,2,6,0)
Enter either 'Y' or 'N'.
"KRN",.84,7980000.007,5,0)
^.841^1^1
"KRN",.84,7980000.007,5,1,0)
RORVM001^RNDXACL
"KRN",.84,7980000.007,5,"B","RORVM001",1)

"KRN",.84,7980000.008,-1)
0^10
"KRN",.84,7980000.008,0)
7980000.008^3^^CLINICAL CASE REGISTRIES^Schedule the registry setup?
"KRN",.84,7980000.008,2,0)
^^18^18^3030609^
"KRN",.84,7980000.008,2,1,0)
  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
"KRN",.84,7980000.008,2,2,0)
  After the software is installed, the registry must be
"KRN",.84,7980000.008,2,3,0)
  populated with the patients that have HIV/AIDS related data.
"KRN",.84,7980000.008,2,4,0)
  The registry setup task populates the registry and performs
"KRN",.84,7980000.008,2,5,0)
  other implementation steps. If you are installing the 
"KRN",.84,7980000.008,2,6,0)
  software for the first time, you must answer YES.
"KRN",.84,7980000.008,2,7,0)
 
"KRN",.84,7980000.008,2,8,0)
  When the initial registry population is complete, you will
"KRN",.84,7980000.008,2,9,0)
  received a VistA alert. Only after that you can add the name
"KRN",.84,7980000.008,2,10,0)
  of the registry (VA ICR) to the nightly task (the [ROR TASK]
"KRN",.84,7980000.008,2,11,0)
  option) parameter.
"KRN",.84,7980000.008,2,12,0)
 
"KRN",.84,7980000.008,2,13,0)
  If you are reinstalling the software and initial registry
"KRN",.84,7980000.008,2,14,0)
  population has been done already, the answer depends on the
"KRN",.84,7980000.008,2,15,0)
  reason for the reinstallation and the instructions, which 
"KRN",.84,7980000.008,2,16,0)
  you have probably been given.
"KRN",.84,7980000.008,2,17,0)
  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
"KRN",.84,7980000.008,2,18,0)
  Enter either 'Y' or 'N'.
"KRN",.84,7980000.008,5,0)
^.841^1^1
"KRN",.84,7980000.008,5,1,0)
RORSETU1
"KRN",.84,7980000.008,5,"B","RORSETU1",1)

"KRN",.84,7980000.009,-1)
0^11
"KRN",.84,7980000.009,0)
7980000.009^3^^CLINICAL CASE REGISTRIES^Maximum number of subtasks?
"KRN",.84,7980000.009,2,0)
^^6^6^3030606^
"KRN",.84,7980000.009,2,1,0)
  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
"KRN",.84,7980000.009,2,2,0)
  During the initial registry population performed by the
"KRN",.84,7980000.009,2,3,0)
  registry setup task several registry update subtask can be
"KRN",.84,7980000.009,2,4,0)
  scheduled to speed up the process.
"KRN",.84,7980000.009,2,5,0)
  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
"KRN",.84,7980000.009,2,6,0)
  Enter a number between 0 and 10, 0 decimal digits.
"KRN",.84,7980000.009,5,0)
^.841^1^1
"KRN",.84,7980000.009,5,1,0)
RORSETU1
"KRN",.84,7980000.009,5,"B","RORSETU1",1)

"KRN",.84,7980000.01,-1)
0^12
"KRN",.84,7980000.01,0)
7980000.01^3^^CLINICAL CASE REGISTRIES^Suspend the task(s)?
"KRN",.84,7980000.01,2,0)
^^13^13^3030606^
"KRN",.84,7980000.01,2,1,0)
  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
"KRN",.84,7980000.01,2,2,0)
  If you answer YES to this question, registry update subtasks
"KRN",.84,7980000.01,2,3,0)
  that populate the registry will be suspended during the peak
"KRN",.84,7980000.01,2,4,0)
  weekday hours to conserve the CPU resources.
"KRN",.84,7980000.01,2,5,0)
 
"KRN",.84,7980000.01,2,6,0)
  The tasks will not be suspended on weekends and holidays.
"KRN",.84,7980000.01,2,7,0)
  If the initial registry update runs in the single-task mode,
"KRN",.84,7980000.01,2,8,0)
  it will never be suspended.
"KRN",.84,7980000.01,2,9,0)
 
"KRN",.84,7980000.01,2,10,0)
  Two additional prompts will be displayed asking you to enter
"KRN",.84,7980000.01,2,11,0)
  start and end time of the suspension.
"KRN",.84,7980000.01,2,12,0)
  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
"KRN",.84,7980000.01,2,13,0)
  Enter either 'Y' or 'N'.
"KRN",.84,7980000.01,5,0)
^.841^1^1
"KRN",.84,7980000.01,5,1,0)
RORSETU1
"KRN",.84,7980000.01,5,"B","RORSETU1",1)

"KRN",.84,7980000.011,-1)
0^13
"KRN",.84,7980000.011,0)
7980000.011^3^^CLINICAL CASE REGISTRIES^Suspension start time?
"KRN",.84,7980000.011,2,0)
^^7^7^3030606^
"KRN",.84,7980000.011,2,1,0)
  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
"KRN",.84,7980000.011,2,2,0)
  Registry update subtasks will be suspended after this time 
"KRN",.84,7980000.011,2,3,0)
  every day except the weekends and holidays. However, they 
"KRN",.84,7980000.011,2,4,0)
  will be checking for a stop request every hour during the
"KRN",.84,7980000.011,2,5,0)
  suspension.
"KRN",.84,7980000.011,2,6,0)
  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
"KRN",.84,7980000.011,2,7,0)
  Enter time of the day (e.g. 8AM).
"KRN",.84,7980000.011,5,0)
^.841^1^1
"KRN",.84,7980000.011,5,1,0)
RORSETU1
"KRN",.84,7980000.011,5,"B","RORSETU1",1)

"KRN",.84,7980000.012,-1)
0^14
"KRN",.84,7980000.012,0)
7980000.012^3^^CLINICAL CASE REGISTRIES^Suspension end time?
"KRN",.84,7980000.012,2,0)
^^6^6^3030606^
"KRN",.84,7980000.012,2,1,0)
  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
"KRN",.84,7980000.012,2,2,0)
  The registry update subtasks will be resumed at this time 
"KRN",.84,7980000.012,2,3,0)
  every day. The suspension end time must be later than the
"KRN",.84,7980000.012,2,4,0)
  suspension start time.
"KRN",.84,7980000.012,2,5,0)
  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
"KRN",.84,7980000.012,2,6,0)
  Enter time of the day (e.g. 5PM).
"KRN",.84,7980000.012,5,0)
^.841^1^1
"KRN",.84,7980000.012,5,1,0)
RORSETU1
"KRN",.84,7980000.012,5,"B","RORSETU1",1)

"KRN",.84,7980000.013,-1)
0^67
"KRN",.84,7980000.013,0)
7980000.013^1^^CLINICAL CASE REGISTRIES^Empty TASK PARAMETERS field
"KRN",.84,7980000.013,2,0)
^^2^2^3050510^
"KRN",.84,7980000.013,2,1,0)
You must enter the name of the HL7 event driver protocol into
"KRN",.84,7980000.013,2,2,0)
the TASK PARAMETERS field during scheduling the task.
"KRN",.84,7980000.013,5,0)
^.841^1^1
"KRN",.84,7980000.013,5,1,0)
ROREXT^TASK
"KRN",.84,7980000.013,5,"B","ROREXT",1)

"KRN",.84,7980000.015,-1)
0^15
"KRN",.84,7980000.015,0)
7980000.015^2^y^CLINICAL CASE REGISTRIES^Access Violation Alert
"KRN",.84,7980000.015,2,0)
^.844^6^6^3031028^^
"KRN",.84,7980000.015,2,1,0)
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
"KRN",.84,7980000.015,2,2,0)
An attempt of unauthorized access to the Clinical Case Registries data
"KRN",.84,7980000.015,2,3,0)
has been made on |DATETIME|.
"KRN",.84,7980000.015,2,4,0)
 
"KRN",.84,7980000.015,2,5,0)
Violator: |USERNAME| (DUZ=|DUZ|)
"KRN",.84,7980000.015,2,6,0)
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
"KRN",.84,7980000.015,3,0)
^.845^4^3
"KRN",.84,7980000.015,3,2,0)
USERNAME
"KRN",.84,7980000.015,3,3,0)
DATETIME
"KRN",.84,7980000.015,3,4,0)
DUZ
"KRN",.84,7980000.015,5,0)
^.841^1^1
"KRN",.84,7980000.015,5,1,0)
RORLOG^ACVIOLTN
"KRN",.84,7980000.015,5,"B","RORLOG",1)

"KRN",.84,7980000.016,-1)
0^16
"KRN",.84,7980000.016,0)
7980000.016^2^y^CLINICAL CASE REGISTRIES^List of Risk factors
"KRN",.84,7980000.016,2,0)
^.844^13^13^3030917^^^^
"KRN",.84,7980000.016,2,1,0)
<RISK ID="1" COUNT="|1|">Sex with Male</RISK>
"KRN",.84,7980000.016,2,2,0)
<RISK ID="2" COUNT="|2|">Sex with Female</RISK>
"KRN",.84,7980000.016,2,3,0)
<RISK ID="3" COUNT="|3|">Injected Nonprescription Drug(s)</RISK>
"KRN",.84,7980000.016,2,4,0)
<RISK ID="4" COUNT="|4|">Received Clotting Factor for Hemophilia/Coagulation Disorder</RISK>
"KRN",.84,7980000.016,2,5,0)
<RISK ID="5" COUNT="|5|">Heterosexual Relations with Bisexual Male</RISK>
"KRN",.84,7980000.016,2,6,0)
<RISK ID="6" COUNT="|6|">Heterosexual Relations with Intravenous Drug user</RISK>
"KRN",.84,7980000.016,2,7,0)
<RISK ID="7" COUNT="|7|">Heterosexual Relations with Person with Hemophilia/Coagulation Disorder</RISK>
"KRN",.84,7980000.016,2,8,0)
<RISK ID="8" COUNT="|8|">Heterosexual Relations with Transfusion Recipient with HIV</RISK>
"KRN",.84,7980000.016,2,9,0)
<RISK ID="9" COUNT="|9|">Heterosexual Relations with Transplant Recipient with HIV</RISK>
"KRN",.84,7980000.016,2,10,0)
<RISK ID="10" COUNT="|10|">Heterosexual Relations with Person with AIDS/HIV infection</RISK>
"KRN",.84,7980000.016,2,11,0)
<RISK ID="11" COUNT="|11|">Received Transfusions Other than Clotting Factor</RISK>
"KRN",.84,7980000.016,2,12,0)
<RISK ID="12" COUNT="|12|">Received Transplant or Artificial Insemination</RISK>
"KRN",.84,7980000.016,2,13,0)
<RISK ID="13" COUNT="|13|">Worked in Healthcare or Laboratory</RISK>
"KRN",.84,7980000.017,-1)
0^17
"KRN",.84,7980000.017,0)
7980000.017^2^y^CLINICAL CASE REGISTRIES^List of Utilization Types
"KRN",.84,7980000.017,2,0)
^^11^11^3050419^
"KRN",.84,7980000.017,2,1,0)
<UTIL ID="A" COUNT="|A|">Allergy</UTIL>
"KRN",.84,7980000.017,2,2,0)
<UTIL ID="C" COUNT="|C|">Cytopathology</UTIL>
"KRN",.84,7980000.017,2,3,0)
<UTIL ID="I" COUNT="|I|">Inpatient Data</UTIL>
"KRN",.84,7980000.017,2,4,0)
<UTIL ID="IP" COUNT="|IP|">Inpatient Pharmacy</UTIL>
"KRN",.84,7980000.017,2,5,0)
<UTIL ID="IV" COUNT="|IV|">IV Drugs</UTIL>
"KRN",.84,7980000.017,2,6,0)
<UTIL ID="L" COUNT="|L|">Laboratory</UTIL>
"KRN",.84,7980000.017,2,7,0)
<UTIL ID="M" COUNT="|M|">Microbiology</UTIL>
"KRN",.84,7980000.017,2,8,0)
<UTIL ID="O" COUNT="|O|">Outpatient Clinic Stop</UTIL>
"KRN",.84,7980000.017,2,9,0)
<UTIL ID="OP" COUNT="|OP|">Outpatient Pharmacy</UTIL>
"KRN",.84,7980000.017,2,10,0)
<UTIL ID="R" COUNT="|R|">Radiology</UTIL>
"KRN",.84,7980000.017,2,11,0)
<UTIL ID="SP" COUNT="|SP|">Surgical Pathology</UTIL>
"KRN",.84,7980000.017,3,0)
^.845^11^11
"KRN",.84,7980000.017,3,1,0)
A
"KRN",.84,7980000.017,3,2,0)
C
"KRN",.84,7980000.017,3,3,0)
I
"KRN",.84,7980000.017,3,4,0)
IP
"KRN",.84,7980000.017,3,5,0)
IV
"KRN",.84,7980000.017,3,6,0)
L
"KRN",.84,7980000.017,3,7,0)
M
"KRN",.84,7980000.017,3,8,0)
O
"KRN",.84,7980000.017,3,9,0)
OP
"KRN",.84,7980000.017,3,10,0)
R
"KRN",.84,7980000.017,3,11,0)
SP
"KRN",.84,7980000.018,-1)
0^18
"KRN",.84,7980000.018,0)
7980000.018^2^^CLINICAL CASE REGISTRIES^Report options
"KRN",.84,7980000.018,2,0)
^^73^73^3051125^
"KRN",.84,7980000.018,2,1,0)
AGGR_GENERIC
"KRN",.84,7980000.018,2,2,0)
        Aggregate by Generic Names
"KRN",.84,7980000.018,2,3,0)
 
"KRN",.84,7980000.018,2,4,0)
AGGR_FORMUL,AGGR_FORCED
"KRN",.84,7980000.018,2,5,0)
        Aggregate by Individual Formulations
"KRN",.84,7980000.018,2,6,0)
 
"KRN",.84,7980000.018,2,7,0)
        Aggregate by Individual Formulations (enforced because of investigational medications)
"KRN",.84,7980000.018,2,8,0)
 
"KRN",.84,7980000.018,2,9,0)
BASIC,COMPLEX
"KRN",.84,7980000.018,2,10,0)
        Basic Care
"KRN",.84,7980000.018,2,11,0)
        Complex Care
"KRN",.84,7980000.018,2,12,0)
        Both Basic and Complex Care
"KRN",.84,7980000.018,2,13,0)
 
"KRN",.84,7980000.018,2,14,0)
CAREONLY
"KRN",.84,7980000.018,2,15,0)
        Treated only
"KRN",.84,7980000.018,2,16,0)
 
"KRN",.84,7980000.018,2,17,0)
COMPLETE
"KRN",.84,7980000.018,2,18,0)
        Complete Report
"KRN",.84,7980000.018,2,19,0)
 
"KRN",.84,7980000.018,2,20,0)
CONFIRMED,PENDING
"KRN",.84,7980000.018,2,21,0)
        Confirmed
"KRN",.84,7980000.018,2,22,0)
        Pending
"KRN",.84,7980000.018,2,23,0)
        Both Confirmed and Pending
"KRN",.84,7980000.018,2,24,0)
 
"KRN",.84,7980000.018,2,25,0)
DE_BEFORE,DE_DURING,DE_AFTER
"KRN",.84,7980000.018,2,26,0)
        Added before the date range
"KRN",.84,7980000.018,2,27,0)
        Added during the date range
"KRN",.84,7980000.018,2,28,0)
        Added before and during the date range
"KRN",.84,7980000.018,2,29,0)
        Added after the date range
"KRN",.84,7980000.018,2,30,0)
        Added before and after the date range 
"KRN",.84,7980000.018,2,31,0)
        Added during and after the date range
"KRN",.84,7980000.018,2,32,0)
        Added on any date
"KRN",.84,7980000.018,2,33,0)
 
"KRN",.84,7980000.018,2,34,0)
GENERIC,FORMULATIONS
"KRN",.84,7980000.018,2,35,0)
        Generic Medications
"KRN",.84,7980000.018,2,36,0)
        Individual Formulations
"KRN",.84,7980000.018,2,37,0)
        Generic Medications and Individual Formulations
"KRN",.84,7980000.018,2,38,0)
 
"KRN",.84,7980000.018,2,39,0)
INPATIENT,OUTPATIENT
"KRN",.84,7980000.018,2,40,0)
        Inpatient
"KRN",.84,7980000.018,2,41,0)
        Outpatient
"KRN",.84,7980000.018,2,42,0)
        Both Inpatients and Outpatients
"KRN",.84,7980000.018,2,43,0)
 
"KRN",.84,7980000.018,2,44,0)
LAB
"KRN",.84,7980000.018,2,45,0)
        Selected lab tests were preformed
"KRN",.84,7980000.018,2,46,0)
 
"KRN",.84,7980000.018,2,47,0)
NOLAB
"KRN",.84,7980000.018,2,48,0)
        No selected lab tests were performed
"KRN",.84,7980000.018,2,49,0)
 
"KRN",.84,7980000.018,2,50,0)
NOPHARM
"KRN",.84,7980000.018,2,51,0)
        Did not receive selected medication(s)
"KRN",.84,7980000.018,2,52,0)
 
"KRN",.84,7980000.018,2,53,0)
NOTSEEN,SEEN
"KRN",.84,7980000.018,2,54,0)
        Not Seen
"KRN",.84,7980000.018,2,55,0)
        Seen
"KRN",.84,7980000.018,2,56,0)
        Both Seen and Not Seen
"KRN",.84,7980000.018,2,57,0)
 
"KRN",.84,7980000.018,2,58,0)
PHARM
"KRN",.84,7980000.018,2,59,0)
        Received selected medication(s)
"KRN",.84,7980000.018,2,60,0)
 
"KRN",.84,7980000.018,2,61,0)
PTLIST
"KRN",.84,7980000.018,2,62,0)
        List of Patients
"KRN",.84,7980000.018,2,63,0)
 
"KRN",.84,7980000.018,2,64,0)
REGMEDS,INVESTIG
"KRN",.84,7980000.018,2,65,0)
        Registry Medications
"KRN",.84,7980000.018,2,66,0)
        Investigational Medications
"KRN",.84,7980000.018,2,67,0)
        Registry and Investigational Medications
"KRN",.84,7980000.018,2,68,0)
 
"KRN",.84,7980000.018,2,69,0)
REGMEDSMRY
"KRN",.84,7980000.018,2,70,0)
        Summary Registry Meds Usage Table
"KRN",.84,7980000.018,2,71,0)
 
"KRN",.84,7980000.018,2,72,0)
SUMMARY
"KRN",.84,7980000.018,2,73,0)
        Summary
"KRN",.84,7980000.018,5,0)
^.841^1^1
"KRN",.84,7980000.018,5,1,0)
RORXU002^OPTXT
"KRN",.84,7980000.018,5,"B","RORXU002",1)

"KRN",.84,7980000.019,-1)
0^62
"KRN",.84,7980000.019,0)
7980000.019^2^^CLINICAL CASE REGISTRIES^Utilization options
"KRN",.84,7980000.019,2,0)
^^35^35^3050909^
"KRN",.84,7980000.019,2,1,0)
ALL
"KRN",.84,7980000.019,2,2,0)
        Any utilization
"KRN",.84,7980000.019,2,3,0)
 
"KRN",.84,7980000.019,2,4,0)
A
"KRN",.84,7980000.019,2,5,0)
        Allergy
"KRN",.84,7980000.019,2,6,0)
 
"KRN",.84,7980000.019,2,7,0)
C
"KRN",.84,7980000.019,2,8,0)
        Cytopathology
"KRN",.84,7980000.019,2,9,0)
 
"KRN",.84,7980000.019,2,10,0)
I
"KRN",.84,7980000.019,2,11,0)
        Inpatient
"KRN",.84,7980000.019,2,12,0)
 
"KRN",.84,7980000.019,2,13,0)
IP,OP,IV
"KRN",.84,7980000.019,2,14,0)
        Pharmacy (inpatient)
"KRN",.84,7980000.019,2,15,0)
        Pharmacy (outpatient)
"KRN",.84,7980000.019,2,16,0)
        Pharmacy (inpatient and outpatient)
"KRN",.84,7980000.019,2,17,0)
        Pharmacy (IV)
"KRN",.84,7980000.019,2,18,0)
        Pharmacy (inpatient and IV)
"KRN",.84,7980000.019,2,19,0)
        Pharmacy (outpatient and IV)
"KRN",.84,7980000.019,2,20,0)
        Pharmacy
"KRN",.84,7980000.019,2,21,0)
 
"KRN",.84,7980000.019,2,22,0)
L
"KRN",.84,7980000.019,2,23,0)
        Laboratory
"KRN",.84,7980000.019,2,24,0)
 
"KRN",.84,7980000.019,2,25,0)
M
"KRN",.84,7980000.019,2,26,0)
        Microbiology
"KRN",.84,7980000.019,2,27,0)
 
"KRN",.84,7980000.019,2,28,0)
O
"KRN",.84,7980000.019,2,29,0)
        Outpatient
"KRN",.84,7980000.019,2,30,0)
 
"KRN",.84,7980000.019,2,31,0)
R
"KRN",.84,7980000.019,2,32,0)
        Radiology
"KRN",.84,7980000.019,2,33,0)
 
"KRN",.84,7980000.019,2,34,0)
SP
"KRN",.84,7980000.019,2,35,0)
        Surgical Pathology
"KRN",.84,7980000.02,-1)
0^19
"KRN",.84,7980000.02,0)
7980000.02^1^^CLINICAL CASE REGISTRIES^Registry has not been populated
"KRN",.84,7980000.02,2,0)
^^4^4^3040113^
"KRN",.84,7980000.02,2,1,0)
The registry must be populated by the registry setup option [ROR 
"KRN",.84,7980000.02,2,2,0)
SETUP]. Only when the initial population of the registry is complete
"KRN",.84,7980000.02,2,3,0)
you can add its name to the list of the registries to be updated by
"KRN",.84,7980000.02,2,4,0)
the nightly task.
"KRN",.84,7980000.02,5,0)
^.841^1^1
"KRN",.84,7980000.02,5,1,0)
RORUTL02^ARLST
"KRN",.84,7980000.02,5,"B","RORUTL02",1)

"KRN",.84,7980000.021,-1)
0^20
"KRN",.84,7980000.021,0)
7980000.021^2^y^CLINICAL CASE REGISTRIES^Registry Status Notification (1)
"KRN",.84,7980000.021,2,0)
^^16^16^3040115^
"KRN",.84,7980000.021,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7980000.021,2,2,0)
<REGISTRY_INFO>
"KRN",.84,7980000.021,2,3,0)
<STATION>
"KRN",.84,7980000.021,2,4,0)
  <NUMBER>|STNUM|</NUMBER>
"KRN",.84,7980000.021,2,5,0)
  <NAME>|STNAME|</NAME>
"KRN",.84,7980000.021,2,6,0)
</STATION>
"KRN",.84,7980000.021,2,7,0)
<REGISTRY>|REGISTRY|</REGISTRY>
"KRN",.84,7980000.021,2,8,0)
<DATE>|DATE|</DATE>
"KRN",.84,7980000.021,2,9,0)
<UPDATED_UNTIL>|UPDATED_UNTIL|</UPDATED_UNTIL>
"KRN",.84,7980000.021,2,10,0)
<EXTRACTED_UNTIL>|EXTRACTED_UNTIL|</EXTRACTED_UNTIL>
"KRN",.84,7980000.021,2,11,0)
<RETRIES>|RETRIES|</RETRIES>
"KRN",.84,7980000.021,2,12,0)
<DTACKMIN>|DTACKMIN|</DTACKMIN>
"KRN",.84,7980000.021,2,13,0)
<DTACKMAX>|DTACKMAX|</DTACKMAX>
"KRN",.84,7980000.021,2,14,0)
<NPT>|NPT|</NPT>
"KRN",.84,7980000.021,2,15,0)
<NPA>|NPA|</NPA>
"KRN",.84,7980000.021,2,16,0)
<NPP>|NPP|</NPP>
"KRN",.84,7980000.021,3,0)
^.845^12^4
"KRN",.84,7980000.021,3,5,0)
RETRIES^
"KRN",.84,7980000.021,3,9,0)
REGISTRY
"KRN",.84,7980000.021,3,10,0)
STNAME
"KRN",.84,7980000.021,3,12,0)
STNUM
"KRN",.84,7980000.021,5,0)
^.841^1^1
"KRN",.84,7980000.021,5,1,0)
RORSETU3^SENDINFO
"KRN",.84,7980000.021,5,"B","RORSETU3",1)

"KRN",.84,7980000.022,-1)
0^21
"KRN",.84,7980000.022,0)
7980000.022^2^^CLINICAL CASE REGISTRIES^Registry Status Notification (2)
"KRN",.84,7980000.022,2,0)
^^1^1^3040115^
"KRN",.84,7980000.022,2,1,0)
</REGISTRY_INFO>
"KRN",.84,7980000.022,5,0)
^.841^1^1
"KRN",.84,7980000.022,5,1,0)
RORSETU3^SENDINFO
"KRN",.84,7980000.022,5,"B","RORSETU3",1)

"KRN",.84,7980000.023,-1)
0^57
"KRN",.84,7980000.023,0)
7980000.023^2^y^CLINICAL CASE REGISTRIES^HL7 Problem (Text Header)
"KRN",.84,7980000.023,2,0)
^^25^25^3050721^
"KRN",.84,7980000.023,2,1,0)
HL7 batch messages created by the Clinical Case Registries 
"KRN",.84,7980000.023,2,2,0)
have not been transmitted after |NOR| attempt(s). The CCR
"KRN",.84,7980000.023,2,3,0)
software will NOT extract any new data from the |REGISTRY|
"KRN",.84,7980000.023,2,4,0)
registry until all messages listed below are successfully
"KRN",.84,7980000.023,2,5,0)
sent!
"KRN",.84,7980000.023,2,6,0)
 
"KRN",.84,7980000.023,2,7,0)
Please follow these steps to troubleshoot the problem as soon 
"KRN",.84,7980000.023,2,8,0)
as possible:
"KRN",.84,7980000.023,2,9,0)
 
"KRN",.84,7980000.023,2,10,0)
 1. Check that the HL7 logical link, associated with 
"KRN",.84,7980000.023,2,11,0)
    the registry is not disabled. Start the link if
"KRN",.84,7980000.023,2,12,0)
    necessary.
"KRN",.84,7980000.023,2,13,0)
 
"KRN",.84,7980000.023,2,14,0)
 2. It is possible that the message queue got stuck.
"KRN",.84,7980000.023,2,15,0)
    Please try to restart the link.
"KRN",.84,7980000.023,2,16,0)
 
"KRN",.84,7980000.023,2,17,0)
 3. Contact the group that supports the local Vitria 
"KRN",.84,7980000.023,2,18,0)
    Interface Engine and coordinate troubleshooting
"KRN",.84,7980000.023,2,19,0)
    efforts with them.
"KRN",.84,7980000.023,2,20,0)
 
"KRN",.84,7980000.023,2,21,0)
 4. If nothing helps and you continue getting this
"KRN",.84,7980000.023,2,22,0)
    message, then call the Help Desk or create a
"KRN",.84,7980000.023,2,23,0)
    Remedy Help Desk ticket.
"KRN",.84,7980000.023,2,24,0)
 
"KRN",.84,7980000.023,2,25,0)
List of messages in question:
"KRN",.84,7980000.023,3,0)
^.845^2^2
"KRN",.84,7980000.023,3,1,0)
REGISTRY
"KRN",.84,7980000.023,3,2,0)
NOR
"KRN",.84,7980000.023,5,0)
^.841^1^1
"KRN",.84,7980000.023,5,1,0)
ROR11^NOTIFY
"KRN",.84,7980000.023,5,"B","ROR11",1)

"KRN",.84,7980000.024,-1)
0^58
"KRN",.84,7980000.024,0)
7980000.024^2^^CLINICAL CASE REGISTRIES^HL7 Problem (Text Footer)
"KRN",.84,7980000.024,5,0)
^.841^1^1
"KRN",.84,7980000.024,5,1,0)
ROR11^NOTIFY
"KRN",.84,7980000.024,5,"B","ROR11",1)

"KRN",.84,7980000.025,-1)
0^59
"KRN",.84,7980000.025,0)
7980000.025^2^y^CLINICAL CASE REGISTRIES^HL7 Problem (XML Header)
"KRN",.84,7980000.025,2,0)
^^15^15^3050721^
"KRN",.84,7980000.025,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7980000.025,2,2,0)
<HL7_PROBLEM>
"KRN",.84,7980000.025,2,3,0)
<DESCRIPTION>
"KRN",.84,7980000.025,2,4,0)
  HL7 batch messages generated at |STNAME| have not been
"KRN",.84,7980000.025,2,5,0)
  transmitted after |NOR| attempts. Please troubleshoot
"KRN",.84,7980000.025,2,6,0)
  this problem as soon as possible!
"KRN",.84,7980000.025,2,7,0)
 
"KRN",.84,7980000.025,2,8,0)
  Please bear in mind, that no new data will be extracted
"KRN",.84,7980000.025,2,9,0)
  from the affected registries until all HL7 messages
"KRN",.84,7980000.025,2,10,0)
  listed in this notification are successfully sent.
"KRN",.84,7980000.025,2,11,0)
</DESCRIPTION> 
"KRN",.84,7980000.025,2,12,0)
<STATION>
"KRN",.84,7980000.025,2,13,0)
  <NUMBER>|STNUM|</NUMBER>
"KRN",.84,7980000.025,2,14,0)
  <NAME>|STNAME|</NAME>
"KRN",.84,7980000.025,2,15,0)
</STATION>
"KRN",.84,7980000.025,3,0)
^.845^12^3
"KRN",.84,7980000.025,3,10,0)
STNAME
"KRN",.84,7980000.025,3,11,0)
NOR
"KRN",.84,7980000.025,3,12,0)
STNUM
"KRN",.84,7980000.025,5,0)
^.841^2^2
"KRN",.84,7980000.025,5,1,0)
RORUTL05^MSG7STS
"KRN",.84,7980000.025,5,2,0)
ROR11^NOTIFY
"KRN",.84,7980000.025,5,"B","ROR11",2)

"KRN",.84,7980000.025,5,"B","RORUTL05",1)

"KRN",.84,7980000.026,-1)
0^60
"KRN",.84,7980000.026,0)
7980000.026^2^^CLINICAL CASE REGISTRIES^HL7 Problem (XML Footer)
"KRN",.84,7980000.026,2,0)
^^1^1^3050509^
"KRN",.84,7980000.026,2,1,0)
</HL7_PROBLEM>
"KRN",.84,7980000.026,5,0)
^.841^1^1
"KRN",.84,7980000.026,5,1,0)
ROR11^NOTIFY
"KRN",.84,7980000.026,5,"B","ROR11",1)

"KRN",.84,7980000.027,-1)
0^61
"KRN",.84,7980000.027,0)
7980000.027^2^y^CLINICAL CASE REGISTRIES^HL7 Problem (Local Alert)
"KRN",.84,7980000.027,2,0)
^.844^7^7^3050509^^^
"KRN",.84,7980000.027,2,1,0)
HL7 batch messages created by the Clinical Case Registries
"KRN",.84,7980000.027,2,2,0)
|NOR| day(s) ago have not been transmitted yet. The CCR
"KRN",.84,7980000.027,2,3,0)
software will not create/send any new HL7 messages for the
"KRN",.84,7980000.027,2,4,0)
|REGISTRY| registry until the messages are successfully sent!
"KRN",.84,7980000.027,2,5,0)
 
"KRN",.84,7980000.027,2,6,0)
See the CCR logs for message status details and recommended 
"KRN",.84,7980000.027,2,7,0)
troubleshooting steps.
"KRN",.84,7980000.027,3,0)
^.845^2^2
"KRN",.84,7980000.027,3,1,0)
REGISTRY
"KRN",.84,7980000.027,3,2,0)
NOR
"KRN",.84,7980000.027,5,0)
^.841^1^1
"KRN",.84,7980000.027,5,1,0)
ROR10^ALERT
"KRN",.84,7980000.027,5,"B","ROR10",1)

"KRN",.84,7981000,-1)
0^22
"KRN",.84,7981000,0)
7981000^2^^CLINICAL CASE REGISTRIES^Default XSL stylesheet
"KRN",.84,7981000,2,0)
^.844^112^112^3050912^^^
"KRN",.84,7981000,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981000,2,2,0)
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
"KRN",.84,7981000,2,3,0)
<xsl:output method="html" indent="no" encoding="iso-8859-1"/>
"KRN",.84,7981000,2,4,0)
<xsl:strip-space elements="*"/>
"KRN",.84,7981000,2,5,0)
 
"KRN",.84,7981000,2,6,0)
<xsl:template match="/">
"KRN",.84,7981000,2,7,0)
 <HTML>
"KRN",.84,7981000,2,8,0)
  <HEAD>
"KRN",.84,7981000,2,9,0)
   <TITLE>Clinical Case Registries Report</TITLE>
"KRN",.84,7981000,2,10,0)
  </HEAD>
"KRN",.84,7981000,2,11,0)
  <BODY>
"KRN",.84,7981000,2,12,0)
   <TABLE BORDER="1" WIDTH="100%" CELLSPACING="1">
"KRN",.84,7981000,2,13,0)
    <TR><TD ALIGN="CENTER" BGCOLOR="YELLOW">
"KRN",.84,7981000,2,14,0)
     <B>UNDER CONSTRUCTION</B>
"KRN",.84,7981000,2,15,0)
    </TD></TR>
"KRN",.84,7981000,2,16,0)
    <TR><TD>
"KRN",.84,7981000,2,17,0)
     <UL>
"KRN",.84,7981000,2,18,0)
      <xsl:apply-templates/>
"KRN",.84,7981000,2,19,0)
     </UL>
"KRN",.84,7981000,2,20,0)
    </TD></TR>
"KRN",.84,7981000,2,21,0)
   </TABLE>
"KRN",.84,7981000,2,22,0)
  </BODY>
"KRN",.84,7981000,2,23,0)
 </HTML>
"KRN",.84,7981000,2,24,0)
</xsl:template>
"KRN",.84,7981000,2,25,0)
 
"KRN",.84,7981000,2,26,0)
<xsl:template name="open">
"KRN",.84,7981000,2,27,0)
 <xsl:param name="slash"/>
"KRN",.84,7981000,2,28,0)
 <FONT color="blue">&lt;</FONT><FONT><xsl:attribute name="color">
"KRN",.84,7981000,2,29,0)
  <xsl:choose>
"KRN",.84,7981000,2,30,0)
   <xsl:when test="xsl:*">#990099</xsl:when>
"KRN",.84,7981000,2,31,0)
   <xsl:otherwise>#990000</xsl:otherwise>
"KRN",.84,7981000,2,32,0)
  </xsl:choose>
"KRN",.84,7981000,2,33,0)
 </xsl:attribute><xsl:value-of select="name(.)"/></FONT><xsl:apply-templates select="@*"/><FONT color="blue"><xsl:value-of select="$slash"/>&gt;</FONT>
"KRN",.84,7981000,2,34,0)
</xsl:template>
"KRN",.84,7981000,2,35,0)
 
"KRN",.84,7981000,2,36,0)
<xsl:template name="close">
"KRN",.84,7981000,2,37,0)
 <FONT color="blue">&lt;/</FONT><FONT><xsl:attribute name="color">
"KRN",.84,7981000,2,38,0)
  <xsl:choose>
"KRN",.84,7981000,2,39,0)
   <xsl:when test="xsl:*">#990099</xsl:when>
"KRN",.84,7981000,2,40,0)
   <xsl:otherwise>#990000</xsl:otherwise>
"KRN",.84,7981000,2,41,0)
  </xsl:choose>
"KRN",.84,7981000,2,42,0)
 </xsl:attribute><xsl:value-of select="name(.)"/></FONT><FONT color="blue">&gt;</FONT>
"KRN",.84,7981000,2,43,0)
</xsl:template>
"KRN",.84,7981000,2,44,0)
 
"KRN",.84,7981000,2,45,0)
<!-- Template for pis not handled elsewhere -->
"KRN",.84,7981000,2,46,0)
<xsl:template match="processing-instruction()">
"KRN",.84,7981000,2,47,0)
 <FONT color="blue">&lt;?<xsl:value-of select="name(.)"/> <xsl:value-of select="."/>?&gt;</FONT><BR/>
"KRN",.84,7981000,2,48,0)
</xsl:template>
"KRN",.84,7981000,2,49,0)
 
"KRN",.84,7981000,2,50,0)
<!-- Template for attributes not handled elsewhere -->
"KRN",.84,7981000,2,51,0)
<xsl:template match="@*">
"KRN",.84,7981000,2,52,0)
 <FONT color="#990000"><xsl:text> </xsl:text><xsl:value-of select="name(.)"/></FONT>
"KRN",.84,7981000,2,53,0)
 <FONT color="blue">="</FONT><B><xsl:value-of select="."/></B><FONT color="blue">"</FONT>
"KRN",.84,7981000,2,54,0)
</xsl:template>
"KRN",.84,7981000,2,55,0)
 
"KRN",.84,7981000,2,56,0)
<!-- Template for text nodes -->
"KRN",.84,7981000,2,57,0)
<xsl:template match="text()">
"KRN",.84,7981000,2,58,0)
 <xsl:choose>
"KRN",.84,7981000,2,59,0)
  <xsl:when test="name(.) = '#cdata-section'">
"KRN",.84,7981000,2,60,0)
   <xsl:call-template name="cdata"/>
"KRN",.84,7981000,2,61,0)
  </xsl:when>
"KRN",.84,7981000,2,62,0)
  <xsl:otherwise>
"KRN",.84,7981000,2,63,0)
   <B><xsl:value-of select="."/></B><BR/>
"KRN",.84,7981000,2,64,0)
  </xsl:otherwise>
"KRN",.84,7981000,2,65,0)
 </xsl:choose>
"KRN",.84,7981000,2,66,0)
</xsl:template>
"KRN",.84,7981000,2,67,0)
  
"KRN",.84,7981000,2,68,0)
<!-- Template for comment nodes -->
"KRN",.84,7981000,2,69,0)
<xsl:template match="comment()">
"KRN",.84,7981000,2,70,0)
 <FONT color="blue">&lt;!--</FONT><BR/>
"KRN",.84,7981000,2,71,0)
 <FONT color="#888888"><SMALL><PRE><xsl:value-of select="."/></PRE></SMALL></FONT><BR/>
"KRN",.84,7981000,2,72,0)
 <FONT color="blue">--&gt;</FONT><BR/>
"KRN",.84,7981000,2,73,0)
</xsl:template>
"KRN",.84,7981000,2,74,0)
 
"KRN",.84,7981000,2,75,0)
<!-- Template for cdata nodes -->
"KRN",.84,7981000,2,76,0)
<xsl:template name="cdata">
"KRN",.84,7981000,2,77,0)
 <FONT color="blue">&lt;![CDATA[</FONT><BR/>
"KRN",.84,7981000,2,78,0)
 <SMALL><PRE><xsl:value-of select="."/></PRE></SMALL><BR/>
"KRN",.84,7981000,2,79,0)
 <FONT color="blue">]]&gt;</FONT><BR/>
"KRN",.84,7981000,2,80,0)
</xsl:template>
"KRN",.84,7981000,2,81,0)
  
"KRN",.84,7981000,2,82,0)
<!-- Template for elements with comment, pi and/or cdata children
"KRN",.84,7981000,2,83,0)
<xsl:template match="*[comment() or processing-instruction() or cdata()]">
"KRN",.84,7981000,2,84,0)
 <xsl:call-template name="open">
"KRN",.84,7981000,2,85,0)
 <UL>
"KRN",.84,7981000,2,86,0)
  <xsl:apply-templates/>
"KRN",.84,7981000,2,87,0)
 </UL>
"KRN",.84,7981000,2,88,0)
 <xsl:call-template name="close"><BR/>
"KRN",.84,7981000,2,89,0)
</xsl:template> -->
"KRN",.84,7981000,2,90,0)
 
"KRN",.84,7981000,2,91,0)
<!-- Template for elements with only text children -->
"KRN",.84,7981000,2,92,0)
<xsl:template match="*[text() and not(comment() or processing-instruction() or *)]">
"KRN",.84,7981000,2,93,0)
 <xsl:call-template name="open"/><B><xsl:value-of select="."/></B><xsl:call-template name="close"/><BR/>
"KRN",.84,7981000,2,94,0)
</xsl:template>
"KRN",.84,7981000,2,95,0)
 
"KRN",.84,7981000,2,96,0)
<!-- Template for elements with element children -->
"KRN",.84,7981000,2,97,0)
<xsl:template match="*[*]">
"KRN",.84,7981000,2,98,0)
 <xsl:call-template name="open"/>
"KRN",.84,7981000,2,99,0)
 <UL>
"KRN",.84,7981000,2,100,0)
  <xsl:apply-templates/>
"KRN",.84,7981000,2,101,0)
 </UL>
"KRN",.84,7981000,2,102,0)
 <xsl:call-template name="close"/><BR/>
"KRN",.84,7981000,2,103,0)
</xsl:template>
"KRN",.84,7981000,2,104,0)
 
"KRN",.84,7981000,2,105,0)
<!-- Template for elements not handled elsewhere (leaf nodes) -->
"KRN",.84,7981000,2,106,0)
<xsl:template match="*">
"KRN",.84,7981000,2,107,0)
 <xsl:call-template name="open">
"KRN",.84,7981000,2,108,0)
  <xsl:with-param name="slash" select="'/'"/>
"KRN",.84,7981000,2,109,0)
 </xsl:call-template><BR/>
"KRN",.84,7981000,2,110,0)
</xsl:template>
"KRN",.84,7981000,2,111,0)
 
"KRN",.84,7981000,2,112,0)
</xsl:stylesheet>
"KRN",.84,7981000,5,0)
^.841^1^1
"KRN",.84,7981000,5,1,0)
RORRP011^GETXSL
"KRN",.84,7981000,5,"B","RORRP011",1)

"KRN",.84,7981000.002,-1)
0^23
"KRN",.84,7981000.002,0)
7981000.002^2^^CLINICAL CASE REGISTRIES^Default XSL Stylesheet (CSV)
"KRN",.84,7981000.002,2,0)
^.844^15^15^3050912^^^
"KRN",.84,7981000.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981000.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981000.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981000.002,2,4,0)
>
"KRN",.84,7981000.002,2,5,0)
 
"KRN",.84,7981000.002,2,6,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981000.002,2,7,0)
 
"KRN",.84,7981000.002,2,8,0)
<xsl:output method="text" encoding="iso-8859-1"/>
"KRN",.84,7981000.002,2,9,0)
<xsl:strip-space elements="*"/>
"KRN",.84,7981000.002,2,10,0)
 
"KRN",.84,7981000.002,2,11,0)
<xsl:template match="/">
"KRN",.84,7981000.002,2,12,0)
 <xsl:apply-templates select="/REPORT"/> 
"KRN",.84,7981000.002,2,13,0)
</xsl:template>
"KRN",.84,7981000.002,2,14,0)
  
"KRN",.84,7981000.002,2,15,0)
</xsl:stylesheet>
"KRN",.84,7981001.001,-1)
0^24
"KRN",.84,7981001.001,0)
7981001.001^2^^CLINICAL CASE REGISTRIES^List of Registry Patients (HTML)
"KRN",.84,7981001.001,2,0)
^.844^73^73^3051025^^
"KRN",.84,7981001.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981001.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981001.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981001.001,2,4,0)
>
"KRN",.84,7981001.001,2,5,0)
 
"KRN",.84,7981001.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981001.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981001.001,2,8,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,7981001.001,2,9,0)
 
"KRN",.84,7981001.001,2,10,0)
<xsl:template match="/">
"KRN",.84,7981001.001,2,11,0)
 <html>
"KRN",.84,7981001.001,2,12,0)
  <head>
"KRN",.84,7981001.001,2,13,0)
   <title>List of Registry Patients</title>
"KRN",.84,7981001.001,2,14,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981001.001,2,15,0)
  </head>
"KRN",.84,7981001.001,2,16,0)
  <body>
"KRN",.84,7981001.001,2,17,0)
   <h1>List of Registry Patients</h1>
"KRN",.84,7981001.001,2,18,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981001.001,2,19,0)
   <div style="page-break-before:always">
"KRN",.84,7981001.001,2,20,0)
    <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981001.001,2,21,0)
   </div>
"KRN",.84,7981001.001,2,22,0)
  </body>
"KRN",.84,7981001.001,2,23,0)
 </html>
"KRN",.84,7981001.001,2,24,0)
</xsl:template>
"KRN",.84,7981001.001,2,25,0)
 
"KRN",.84,7981001.001,2,26,0)
<!--[ COLUMN HEADERS ]--> 
"KRN",.84,7981001.001,2,27,0)
 
"KRN",.84,7981001.001,2,28,0)
<xsl:template match="COLUMN[@NAME='SELDT']">
"KRN",.84,7981001.001,2,29,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981001.001,2,30,0)
  <xsl:with-param name="title" select="'Selection Date'"/>
"KRN",.84,7981001.001,2,31,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981001.001,2,32,0)
 </xsl:call-template>
"KRN",.84,7981001.001,2,33,0)
</xsl:template>
"KRN",.84,7981001.001,2,34,0)
 
"KRN",.84,7981001.001,2,35,0)
<xsl:template match="COLUMN[@NAME='CONFDT']">
"KRN",.84,7981001.001,2,36,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981001.001,2,37,0)
  <xsl:with-param name="title" select="'Confirmation Date'"/>
"KRN",.84,7981001.001,2,38,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981001.001,2,39,0)
 </xsl:call-template>
"KRN",.84,7981001.001,2,40,0)
</xsl:template>
"KRN",.84,7981001.001,2,41,0)
 
"KRN",.84,7981001.001,2,42,0)
<xsl:template match="COLUMN[@NAME='SELRULES']">
"KRN",.84,7981001.001,2,43,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981001.001,2,44,0)
  <xsl:with-param name="title" select="'Reasons'"/>
"KRN",.84,7981001.001,2,45,0)
  <xsl:with-param name="sort" select="''"/>                   
"KRN",.84,7981001.001,2,46,0)
 </xsl:call-template>
"KRN",.84,7981001.001,2,47,0)
</xsl:template>
"KRN",.84,7981001.001,2,48,0)
 
"KRN",.84,7981001.001,2,49,0)
<!--[ CELL VALUES ]--> 
"KRN",.84,7981001.001,2,50,0)
 
"KRN",.84,7981001.001,2,51,0)
<xsl:template match="PATIENT/SELDT">
"KRN",.84,7981001.001,2,52,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981001.001,2,53,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981001.001,2,54,0)
 </xsl:call-template>
"KRN",.84,7981001.001,2,55,0)
</xsl:template>
"KRN",.84,7981001.001,2,56,0)
 
"KRN",.84,7981001.001,2,57,0)
<xsl:template match="PATIENT/CONFDT">
"KRN",.84,7981001.001,2,58,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981001.001,2,59,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981001.001,2,60,0)
 </xsl:call-template>
"KRN",.84,7981001.001,2,61,0)
</xsl:template>
"KRN",.84,7981001.001,2,62,0)
 
"KRN",.84,7981001.001,2,63,0)
<xsl:template match="PATIENT/SELRULES">
"KRN",.84,7981001.001,2,64,0)
 <td class="aLeft">
"KRN",.84,7981001.001,2,65,0)
  <xsl:for-each select="RULE">
"KRN",.84,7981001.001,2,66,0)
   <xsl:value-of select="@DESCR"/>
"KRN",.84,7981001.001,2,67,0)
   <xsl:if test="@DESCR=''"><xsl:text>&#160;</xsl:text></xsl:if>
"KRN",.84,7981001.001,2,68,0)
   <br/>
"KRN",.84,7981001.001,2,69,0)
  </xsl:for-each>
"KRN",.84,7981001.001,2,70,0)
 </td>
"KRN",.84,7981001.001,2,71,0)
</xsl:template>
"KRN",.84,7981001.001,2,72,0)
 
"KRN",.84,7981001.001,2,73,0)
</xsl:stylesheet>
"KRN",.84,7981001.002,-1)
0^25
"KRN",.84,7981001.002,0)
7981001.002^2^^CLINICAL CASE REGISTRIES^List of Registry Patients (CSV)
"KRN",.84,7981001.002,2,0)
^.844^14^14^3051207^^^^
"KRN",.84,7981001.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981001.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981001.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981001.002,2,4,0)
>
"KRN",.84,7981001.002,2,5,0)
 
"KRN",.84,7981001.002,2,6,0)
<xsl:import  href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981001.002,2,7,0)
<xsl:include href="template://report/997/2"/>  <!-- Patients -->
"KRN",.84,7981001.002,2,8,0)
 
"KRN",.84,7981001.002,2,9,0)
<xsl:template match="/">
"KRN",.84,7981001.002,2,10,0)
 <xsl:text>List of Registry Patients</xsl:text>
"KRN",.84,7981001.002,2,11,0)
 <xsl:apply-templates select="/REPORT/PATIENTS"/> 
"KRN",.84,7981001.002,2,12,0)
</xsl:template>
"KRN",.84,7981001.002,2,13,0)
  
"KRN",.84,7981001.002,2,14,0)
</xsl:stylesheet>
"KRN",.84,7981002.001,-1)
0^26
"KRN",.84,7981002.001,0)
7981002.001^2^^CLINICAL CASE REGISTRIES^Current Inpatient List (HTML)
"KRN",.84,7981002.001,2,0)
^.844^42^42^3051025^^^^
"KRN",.84,7981002.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981002.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981002.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981002.001,2,4,0)
>
"KRN",.84,7981002.001,2,5,0)
 
"KRN",.84,7981002.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   -->
"KRN",.84,7981002.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981002.001,2,8,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,7981002.001,2,9,0)
 
"KRN",.84,7981002.001,2,10,0)
<xsl:template match="/">
"KRN",.84,7981002.001,2,11,0)
 <html>
"KRN",.84,7981002.001,2,12,0)
  <head>
"KRN",.84,7981002.001,2,13,0)
   <title>Current Inpatient List</title>
"KRN",.84,7981002.001,2,14,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981002.001,2,15,0)
  </head>
"KRN",.84,7981002.001,2,16,0)
  <body>
"KRN",.84,7981002.001,2,17,0)
   <h1>Current Inpatient List</h1>
"KRN",.84,7981002.001,2,18,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981002.001,2,19,0)
   <div style="page-break-before:always">
"KRN",.84,7981002.001,2,20,0)
    <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981002.001,2,21,0)
   </div>
"KRN",.84,7981002.001,2,22,0)
  </body>
"KRN",.84,7981002.001,2,23,0)
 </html>
"KRN",.84,7981002.001,2,24,0)
</xsl:template>
"KRN",.84,7981002.001,2,25,0)
 
"KRN",.84,7981002.001,2,26,0)
<!--[ COLUMN HEADERS ]--> 
"KRN",.84,7981002.001,2,27,0)
 
"KRN",.84,7981002.001,2,28,0)
<xsl:template match="COLUMN[@NAME='ROOM-BED']">
"KRN",.84,7981002.001,2,29,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981002.001,2,30,0)
  <xsl:with-param name="title" select="'Room-Bed'"/>
"KRN",.84,7981002.001,2,31,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981002.001,2,32,0)
 </xsl:call-template>
"KRN",.84,7981002.001,2,33,0)
</xsl:template>
"KRN",.84,7981002.001,2,34,0)
 
"KRN",.84,7981002.001,2,35,0)
<xsl:template match="COLUMN[@NAME='WARD']">
"KRN",.84,7981002.001,2,36,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981002.001,2,37,0)
  <xsl:with-param name="title" select="'Ward'"/>
"KRN",.84,7981002.001,2,38,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981002.001,2,39,0)
 </xsl:call-template>
"KRN",.84,7981002.001,2,40,0)
</xsl:template>
"KRN",.84,7981002.001,2,41,0)
 
"KRN",.84,7981002.001,2,42,0)
</xsl:stylesheet>
"KRN",.84,7981002.002,-1)
0^27
"KRN",.84,7981002.002,0)
7981002.002^2^^CLINICAL CASE REGISTRIES^Current Inpatient List (CSV)
"KRN",.84,7981002.002,2,0)
^.844^27^27^3050912^^
"KRN",.84,7981002.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981002.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981002.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981002.002,2,4,0)
>
"KRN",.84,7981002.002,2,5,0)
 
"KRN",.84,7981002.002,2,6,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981002.002,2,7,0)
 
"KRN",.84,7981002.002,2,8,0)
<xsl:template match="/">
"KRN",.84,7981002.002,2,9,0)
 <xsl:text>Current Inpatient List</xsl:text>
"KRN",.84,7981002.002,2,10,0)
 <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981002.002,2,11,0)
</xsl:template>
"KRN",.84,7981002.002,2,12,0)
 
"KRN",.84,7981002.002,2,13,0)
<!--[ COLUMN HEADERS ]--> 
"KRN",.84,7981002.002,2,14,0)
 
"KRN",.84,7981002.002,2,15,0)
<xsl:template match="COLUMN[@NAME='ROOM-BED']">
"KRN",.84,7981002.002,2,16,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981002.002,2,17,0)
  <xsl:with-param name="title" select="'Room-Bed'"/>
"KRN",.84,7981002.002,2,18,0)
 </xsl:call-template>
"KRN",.84,7981002.002,2,19,0)
</xsl:template>
"KRN",.84,7981002.002,2,20,0)
 
"KRN",.84,7981002.002,2,21,0)
<xsl:template match="COLUMN[@NAME='WARD']">
"KRN",.84,7981002.002,2,22,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981002.002,2,23,0)
  <xsl:with-param name="title" select="'Ward'"/>
"KRN",.84,7981002.002,2,24,0)
 </xsl:call-template>
"KRN",.84,7981002.002,2,25,0)
</xsl:template>
"KRN",.84,7981002.002,2,26,0)
 
"KRN",.84,7981002.002,2,27,0)
</xsl:stylesheet>
"KRN",.84,7981003.001,-1)
0^28
"KRN",.84,7981003.001,0)
7981003.001^2^^CLINICAL CASE REGISTRIES^General Utiliz. and Demogr. (HTML)
"KRN",.84,7981003.001,2,0)
^.844^292^292^3051006^^^^
"KRN",.84,7981003.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981003.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981003.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981003.001,2,4,0)
>
"KRN",.84,7981003.001,2,5,0)
 
"KRN",.84,7981003.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981003.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981003.001,2,8,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->            
"KRN",.84,7981003.001,2,9,0)
 
"KRN",.84,7981003.001,2,10,0)
<xsl:template match="/">
"KRN",.84,7981003.001,2,11,0)
 <xsl:variable name="sum" select="/REPORT/SUMMARY"/>
"KRN",.84,7981003.001,2,12,0)
 <xsl:variable name="wide_summaries" 
"KRN",.84,7981003.001,2,13,0)
      select="$sum/RISK_FACTORS|$sum/RACE_SUMMARY|$sum/ETHN_SUMMARY|
"KRN",.84,7981003.001,2,14,0)
              $sum/UTIL_CODES"/>
"KRN",.84,7981003.001,2,15,0)
 <xsl:variable name="narrow_summaries"
"KRN",.84,7981003.001,2,16,0)
      select="$sum/AGE_SUMMARY|$sum/SEX_SUMMARY|
"KRN",.84,7981003.001,2,17,0)
              $sum/DOB_SUMMARY|$sum/DOD_SUMMARY|
"KRN",.84,7981003.001,2,18,0)
              $sum/SELDT_SUMMARY|$sum/CONFDT_SUMMARY"/>
"KRN",.84,7981003.001,2,19,0)
 <html>
"KRN",.84,7981003.001,2,20,0)
  <head>
"KRN",.84,7981003.001,2,21,0)
   <title>General Utilization and Demographics</title>
"KRN",.84,7981003.001,2,22,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981003.001,2,23,0)
  </head>
"KRN",.84,7981003.001,2,24,0)
  <body>
"KRN",.84,7981003.001,2,25,0)
   <h1>General Utilization and Demographics</h1>
"KRN",.84,7981003.001,2,26,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981003.001,2,27,0)
   <xsl:choose>
"KRN",.84,7981003.001,2,28,0)
    <xsl:when test="/REPORT/PATIENTS/*[1]">
"KRN",.84,7981003.001,2,29,0)
     <div style="page-break-before:always">
"KRN",.84,7981003.001,2,30,0)
      <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981003.001,2,31,0)
     </div>
"KRN",.84,7981003.001,2,32,0)
    </xsl:when>
"KRN",.84,7981003.001,2,33,0)
    <xsl:otherwise>
"KRN",.84,7981003.001,2,34,0)
     <xsl:call-template name="TableNoData"/>
"KRN",.84,7981003.001,2,35,0)
    </xsl:otherwise>
"KRN",.84,7981003.001,2,36,0)
   </xsl:choose>
"KRN",.84,7981003.001,2,37,0)
   <xsl:if test="$sum/*[1]">
"KRN",.84,7981003.001,2,38,0)
    <div class="reportSummary">
"KRN",.84,7981003.001,2,39,0)
     <xsl:if test="$wide_summaries">
"KRN",.84,7981003.001,2,40,0)
      <div style="float:left; width:68%; margin-right:1%">
"KRN",.84,7981003.001,2,41,0)
       <xsl:apply-templates select="$wide_summaries"/>
"KRN",.84,7981003.001,2,42,0)
      </div>
"KRN",.84,7981003.001,2,43,0)
     </xsl:if>
"KRN",.84,7981003.001,2,44,0)
     <xsl:if test="$narrow_summaries">
"KRN",.84,7981003.001,2,45,0)
      <div style="float:left; width:30%">
"KRN",.84,7981003.001,2,46,0)
       <xsl:apply-templates select="$narrow_summaries"/>
"KRN",.84,7981003.001,2,47,0)
      </div>
"KRN",.84,7981003.001,2,48,0)
     </xsl:if>
"KRN",.84,7981003.001,2,49,0)
    </div>
"KRN",.84,7981003.001,2,50,0)
   </xsl:if>
"KRN",.84,7981003.001,2,51,0)
  </body>
"KRN",.84,7981003.001,2,52,0)
 </html>
"KRN",.84,7981003.001,2,53,0)
</xsl:template>
"KRN",.84,7981003.001,2,54,0)
 
"KRN",.84,7981003.001,2,55,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981003.001,2,56,0)
 
"KRN",.84,7981003.001,2,57,0)
<xsl:template name="SummaryLine">
"KRN",.84,7981003.001,2,58,0)
 <xsl:param name="line" select="."/>
"KRN",.84,7981003.001,2,59,0)
 <td class="aLeft"><xsl:value-of select="$line"/></td>
"KRN",.84,7981003.001,2,60,0)
 <td>
"KRN",.84,7981003.001,2,61,0)
  <xsl:value-of select="$line/@COUNT"/>
"KRN",.84,7981003.001,2,62,0)
  <xsl:if test="$line/@COUNT=''">&#160;</xsl:if>
"KRN",.84,7981003.001,2,63,0)
 </td>
"KRN",.84,7981003.001,2,64,0)
</xsl:template>
"KRN",.84,7981003.001,2,65,0)
 
"KRN",.84,7981003.001,2,66,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981003.001,2,67,0)
 
"KRN",.84,7981003.001,2,68,0)
<xsl:template match="COLUMN[@NAME='RISK']">
"KRN",.84,7981003.001,2,69,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.001,2,70,0)
  <xsl:with-param name="title" select="'Risk Factors'"/>
"KRN",.84,7981003.001,2,71,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981003.001,2,72,0)
 </xsl:call-template>
"KRN",.84,7981003.001,2,73,0)
</xsl:template>
"KRN",.84,7981003.001,2,74,0)
 
"KRN",.84,7981003.001,2,75,0)
<xsl:template match="COLUMN[@NAME='UTIL']">
"KRN",.84,7981003.001,2,76,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.001,2,77,0)
  <xsl:with-param name="title" select="'Utilization'"/>
"KRN",.84,7981003.001,2,78,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981003.001,2,79,0)
 </xsl:call-template>
"KRN",.84,7981003.001,2,80,0)
</xsl:template>
"KRN",.84,7981003.001,2,81,0)
 
"KRN",.84,7981003.001,2,82,0)
<!--[ SUMMARY TABLES ]--> 
"KRN",.84,7981003.001,2,83,0)
 
"KRN",.84,7981003.001,2,84,0)
<xsl:template match="SUMMARY/AGE_SUMMARY">
"KRN",.84,7981003.001,2,85,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,86,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,87,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,88,0)
   <caption>Age Summary</caption>
"KRN",.84,7981003.001,2,89,0)
   <thead>
"KRN",.84,7981003.001,2,90,0)
    <tr>
"KRN",.84,7981003.001,2,91,0)
     <th>Age</th>
"KRN",.84,7981003.001,2,92,0)
     <th width="30">Count<br/>(Value)</th>
"KRN",.84,7981003.001,2,93,0)
    </tr>
"KRN",.84,7981003.001,2,94,0)
   </thead>
"KRN",.84,7981003.001,2,95,0)
   <tbody>
"KRN",.84,7981003.001,2,96,0)
    <xsl:for-each select="$summary/AGE">
"KRN",.84,7981003.001,2,97,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,98,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,99,0)
   </tbody>
"KRN",.84,7981003.001,2,100,0)
  </table>
"KRN",.84,7981003.001,2,101,0)
 </xsl:if>
"KRN",.84,7981003.001,2,102,0)
</xsl:template>
"KRN",.84,7981003.001,2,103,0)
 
"KRN",.84,7981003.001,2,104,0)
<xsl:template match="SUMMARY/CONFDT_SUMMARY">
"KRN",.84,7981003.001,2,105,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,106,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,107,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,108,0)
   <caption>Confirmation Date Summary</caption>
"KRN",.84,7981003.001,2,109,0)
   <thead>
"KRN",.84,7981003.001,2,110,0)
    <tr>
"KRN",.84,7981003.001,2,111,0)
     <th>Confirmation Date</th>
"KRN",.84,7981003.001,2,112,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,113,0)
    </tr>
"KRN",.84,7981003.001,2,114,0)
   </thead>
"KRN",.84,7981003.001,2,115,0)
   <tbody>
"KRN",.84,7981003.001,2,116,0)
    <xsl:for-each select="$summary/CONFDT">
"KRN",.84,7981003.001,2,117,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,118,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,119,0)
   </tbody>
"KRN",.84,7981003.001,2,120,0)
  </table>
"KRN",.84,7981003.001,2,121,0)
 </xsl:if>
"KRN",.84,7981003.001,2,122,0)
</xsl:template>
"KRN",.84,7981003.001,2,123,0)
 
"KRN",.84,7981003.001,2,124,0)
<xsl:template match="SUMMARY/DOB_SUMMARY">
"KRN",.84,7981003.001,2,125,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,126,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,127,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,128,0)
   <caption>Date of Birth Summary</caption>
"KRN",.84,7981003.001,2,129,0)
   <thead>
"KRN",.84,7981003.001,2,130,0)
    <tr>
"KRN",.84,7981003.001,2,131,0)
     <th>Date of Birth</th>
"KRN",.84,7981003.001,2,132,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,133,0)
    </tr>
"KRN",.84,7981003.001,2,134,0)
   </thead>
"KRN",.84,7981003.001,2,135,0)
   <tbody>
"KRN",.84,7981003.001,2,136,0)
    <xsl:for-each select="$summary/DOB">
"KRN",.84,7981003.001,2,137,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,138,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,139,0)
   </tbody>
"KRN",.84,7981003.001,2,140,0)
  </table>
"KRN",.84,7981003.001,2,141,0)
 </xsl:if>
"KRN",.84,7981003.001,2,142,0)
</xsl:template>
"KRN",.84,7981003.001,2,143,0)
 
"KRN",.84,7981003.001,2,144,0)
<xsl:template match="SUMMARY/DOD_SUMMARY">
"KRN",.84,7981003.001,2,145,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,146,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,147,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,148,0)
   <caption>Date of Death Summary</caption>
"KRN",.84,7981003.001,2,149,0)
   <thead>
"KRN",.84,7981003.001,2,150,0)
    <tr>
"KRN",.84,7981003.001,2,151,0)
     <th>Date of Death</th>
"KRN",.84,7981003.001,2,152,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,153,0)
    </tr>
"KRN",.84,7981003.001,2,154,0)
   </thead>
"KRN",.84,7981003.001,2,155,0)
   <tbody>
"KRN",.84,7981003.001,2,156,0)
    <xsl:for-each select="$summary/DOD">
"KRN",.84,7981003.001,2,157,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,158,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,159,0)
   </tbody>
"KRN",.84,7981003.001,2,160,0)
  </table>
"KRN",.84,7981003.001,2,161,0)
 </xsl:if>
"KRN",.84,7981003.001,2,162,0)
</xsl:template>
"KRN",.84,7981003.001,2,163,0)
 
"KRN",.84,7981003.001,2,164,0)
<xsl:template match="SUMMARY/ETHN_SUMMARY">
"KRN",.84,7981003.001,2,165,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,166,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,167,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,168,0)
   <caption>Ethnicity Summary</caption>
"KRN",.84,7981003.001,2,169,0)
   <thead>
"KRN",.84,7981003.001,2,170,0)
    <tr>
"KRN",.84,7981003.001,2,171,0)
     <th>Ethnicity</th>
"KRN",.84,7981003.001,2,172,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,173,0)
    </tr>
"KRN",.84,7981003.001,2,174,0)
   </thead>
"KRN",.84,7981003.001,2,175,0)
   <tbody>
"KRN",.84,7981003.001,2,176,0)
    <xsl:for-each select="$summary/ETHN">
"KRN",.84,7981003.001,2,177,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,178,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,179,0)
   </tbody>
"KRN",.84,7981003.001,2,180,0)
  </table>
"KRN",.84,7981003.001,2,181,0)
 </xsl:if>
"KRN",.84,7981003.001,2,182,0)
</xsl:template>
"KRN",.84,7981003.001,2,183,0)
 
"KRN",.84,7981003.001,2,184,0)
<xsl:template match="SUMMARY/RACE_SUMMARY">
"KRN",.84,7981003.001,2,185,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,186,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,187,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,188,0)
   <caption>Race Summary</caption>
"KRN",.84,7981003.001,2,189,0)
   <thead>
"KRN",.84,7981003.001,2,190,0)
    <tr>
"KRN",.84,7981003.001,2,191,0)
     <th>Race</th>
"KRN",.84,7981003.001,2,192,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,193,0)
    </tr>
"KRN",.84,7981003.001,2,194,0)
   </thead>
"KRN",.84,7981003.001,2,195,0)
   <tbody>
"KRN",.84,7981003.001,2,196,0)
    <xsl:for-each select="$summary/RACE">
"KRN",.84,7981003.001,2,197,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,198,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,199,0)
   </tbody>
"KRN",.84,7981003.001,2,200,0)
  </table>
"KRN",.84,7981003.001,2,201,0)
 </xsl:if>
"KRN",.84,7981003.001,2,202,0)
</xsl:template>
"KRN",.84,7981003.001,2,203,0)
 
"KRN",.84,7981003.001,2,204,0)
<xsl:template match="SUMMARY/RISK_FACTORS">
"KRN",.84,7981003.001,2,205,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,206,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,207,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,208,0)
   <caption>Risk Factors</caption>
"KRN",.84,7981003.001,2,209,0)
   <thead>
"KRN",.84,7981003.001,2,210,0)
    <tr>
"KRN",.84,7981003.001,2,211,0)
     <th width="30">Code</th>
"KRN",.84,7981003.001,2,212,0)
     <th>Description</th>
"KRN",.84,7981003.001,2,213,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,214,0)
    </tr>
"KRN",.84,7981003.001,2,215,0)
   </thead>
"KRN",.84,7981003.001,2,216,0)
   <tbody>
"KRN",.84,7981003.001,2,217,0)
    <xsl:for-each select="$summary/RISK">
"KRN",.84,7981003.001,2,218,0)
     <tr>
"KRN",.84,7981003.001,2,219,0)
      <td align="center"><xsl:value-of select="@ID"/></td>
"KRN",.84,7981003.001,2,220,0)
      <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.001,2,221,0)
     </tr>
"KRN",.84,7981003.001,2,222,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,223,0)
   </tbody>
"KRN",.84,7981003.001,2,224,0)
  </table>
"KRN",.84,7981003.001,2,225,0)
 </xsl:if>
"KRN",.84,7981003.001,2,226,0)
</xsl:template>
"KRN",.84,7981003.001,2,227,0)
 
"KRN",.84,7981003.001,2,228,0)
<xsl:template match="SUMMARY/SELDT_SUMMARY">
"KRN",.84,7981003.001,2,229,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,230,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,231,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,232,0)
   <caption>Selection Date Summary</caption>
"KRN",.84,7981003.001,2,233,0)
   <thead>
"KRN",.84,7981003.001,2,234,0)
    <tr>
"KRN",.84,7981003.001,2,235,0)
     <th>Selection Date</th>
"KRN",.84,7981003.001,2,236,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,237,0)
    </tr>
"KRN",.84,7981003.001,2,238,0)
   </thead>
"KRN",.84,7981003.001,2,239,0)
   <tbody>
"KRN",.84,7981003.001,2,240,0)
    <xsl:for-each select="$summary/SELDT">
"KRN",.84,7981003.001,2,241,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,242,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,243,0)
   </tbody>
"KRN",.84,7981003.001,2,244,0)
  </table>
"KRN",.84,7981003.001,2,245,0)
 </xsl:if>
"KRN",.84,7981003.001,2,246,0)
</xsl:template>
"KRN",.84,7981003.001,2,247,0)
 
"KRN",.84,7981003.001,2,248,0)
<xsl:template match="SUMMARY/SEX_SUMMARY">
"KRN",.84,7981003.001,2,249,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,250,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,251,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,252,0)
   <caption>Sex Summary</caption>
"KRN",.84,7981003.001,2,253,0)
   <thead>
"KRN",.84,7981003.001,2,254,0)
    <tr>
"KRN",.84,7981003.001,2,255,0)
     <th>Sex</th>
"KRN",.84,7981003.001,2,256,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,257,0)
    </tr>
"KRN",.84,7981003.001,2,258,0)
   </thead>
"KRN",.84,7981003.001,2,259,0)
   <tbody>
"KRN",.84,7981003.001,2,260,0)
    <xsl:for-each select="$summary/SEX">
"KRN",.84,7981003.001,2,261,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,262,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,263,0)
   </tbody>
"KRN",.84,7981003.001,2,264,0)
  </table>
"KRN",.84,7981003.001,2,265,0)
 </xsl:if>
"KRN",.84,7981003.001,2,266,0)
</xsl:template>
"KRN",.84,7981003.001,2,267,0)
 
"KRN",.84,7981003.001,2,268,0)
<xsl:template match="SUMMARY/UTIL_CODES">
"KRN",.84,7981003.001,2,269,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,270,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,271,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,272,0)
   <caption>Utilization</caption>
"KRN",.84,7981003.001,2,273,0)
   <thead>
"KRN",.84,7981003.001,2,274,0)
    <tr>
"KRN",.84,7981003.001,2,275,0)
     <th width="30">Code</th>
"KRN",.84,7981003.001,2,276,0)
     <th>Description</th>
"KRN",.84,7981003.001,2,277,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,278,0)
    </tr>
"KRN",.84,7981003.001,2,279,0)
   </thead>
"KRN",.84,7981003.001,2,280,0)
   <tbody>
"KRN",.84,7981003.001,2,281,0)
    <xsl:for-each select="$summary/UTIL">
"KRN",.84,7981003.001,2,282,0)
     <tr>
"KRN",.84,7981003.001,2,283,0)
      <td align="center"><xsl:value-of select="@ID"/></td>
"KRN",.84,7981003.001,2,284,0)
      <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.001,2,285,0)
     </tr>
"KRN",.84,7981003.001,2,286,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,287,0)
   </tbody>
"KRN",.84,7981003.001,2,288,0)
  </table>
"KRN",.84,7981003.001,2,289,0)
 </xsl:if>
"KRN",.84,7981003.001,2,290,0)
</xsl:template>
"KRN",.84,7981003.001,2,291,0)
 
"KRN",.84,7981003.001,2,292,0)
</xsl:stylesheet>
"KRN",.84,7981003.002,-1)
0^29
"KRN",.84,7981003.002,0)
7981003.002^2^^CLINICAL CASE REGISTRIES^General Utiliz. and Demogr. (CSV)
"KRN",.84,7981003.002,2,0)
^.844^185^185^3051006^^
"KRN",.84,7981003.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981003.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981003.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981003.002,2,4,0)
>
"KRN",.84,7981003.002,2,5,0)
 
"KRN",.84,7981003.002,2,6,0)
<xsl:import  href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981003.002,2,7,0)
<xsl:include href="template://report/997/2"/>  <!-- Patients -->
"KRN",.84,7981003.002,2,8,0)
 
"KRN",.84,7981003.002,2,9,0)
<xsl:template match="/">
"KRN",.84,7981003.002,2,10,0)
 <xsl:text>General Utilization and Demographics (Patients)</xsl:text>
"KRN",.84,7981003.002,2,11,0)
 <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981003.002,2,12,0)
 <xsl:value-of select="$FILESWITCH"/>
"KRN",.84,7981003.002,2,13,0)
 <xsl:text>General Utilization and Demographics (Summary)</xsl:text>
"KRN",.84,7981003.002,2,14,0)
 <xsl:call-template name="ReportSummary"/>
"KRN",.84,7981003.002,2,15,0)
</xsl:template>
"KRN",.84,7981003.002,2,16,0)
 
"KRN",.84,7981003.002,2,17,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981003.002,2,18,0)
 
"KRN",.84,7981003.002,2,19,0)
<xsl:template name="SummaryLine">
"KRN",.84,7981003.002,2,20,0)
 <xsl:param name="line" select="."/>
"KRN",.84,7981003.002,2,21,0)
 <xsl:value-of select="$line/@ID"/>
"KRN",.84,7981003.002,2,22,0)
 <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981003.002,2,23,0)
 <xsl:value-of select="$line"/>
"KRN",.84,7981003.002,2,24,0)
 <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981003.002,2,25,0)
 <xsl:value-of select="$line/@COUNT"/>
"KRN",.84,7981003.002,2,26,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,27,0)
</xsl:template>
"KRN",.84,7981003.002,2,28,0)
 
"KRN",.84,7981003.002,2,29,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981003.002,2,30,0)
 
"KRN",.84,7981003.002,2,31,0)
<xsl:template match="COLUMN[@NAME='RISK']">
"KRN",.84,7981003.002,2,32,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.002,2,33,0)
  <xsl:with-param name="title" select="'Risk Factors'"/>
"KRN",.84,7981003.002,2,34,0)
 </xsl:call-template>
"KRN",.84,7981003.002,2,35,0)
</xsl:template>
"KRN",.84,7981003.002,2,36,0)
 
"KRN",.84,7981003.002,2,37,0)
<xsl:template match="COLUMN[@NAME='UTIL']">
"KRN",.84,7981003.002,2,38,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.002,2,39,0)
  <xsl:with-param name="title" select="'Utilization'"/>
"KRN",.84,7981003.002,2,40,0)
 </xsl:call-template>
"KRN",.84,7981003.002,2,41,0)
</xsl:template>
"KRN",.84,7981003.002,2,42,0)
 
"KRN",.84,7981003.002,2,43,0)
<!--[ SUMMARY TABLES ]--> 
"KRN",.84,7981003.002,2,44,0)
 
"KRN",.84,7981003.002,2,45,0)
<xsl:template match="SUMMARY/AGE_SUMMARY">
"KRN",.84,7981003.002,2,46,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,47,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,48,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,49,0)
  <xsl:text>[Age Summary]</xsl:text>
"KRN",.84,7981003.002,2,50,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,51,0)
  <xsl:text>,Age,Count (Value)</xsl:text>
"KRN",.84,7981003.002,2,52,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,53,0)
  <xsl:for-each select="$summary/AGE">
"KRN",.84,7981003.002,2,54,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,55,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,56,0)
 </xsl:if>
"KRN",.84,7981003.002,2,57,0)
</xsl:template>
"KRN",.84,7981003.002,2,58,0)
 
"KRN",.84,7981003.002,2,59,0)
<xsl:template match="SUMMARY/CONFDT_SUMMARY">
"KRN",.84,7981003.002,2,60,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,61,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,62,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,63,0)
  <xsl:text>[Confirmation Date Summary]</xsl:text>
"KRN",.84,7981003.002,2,64,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,65,0)
  <xsl:text>,Confirmation Date,Count</xsl:text>
"KRN",.84,7981003.002,2,66,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,67,0)
  <xsl:for-each select="$summary/CONFDT">
"KRN",.84,7981003.002,2,68,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,69,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,70,0)
 </xsl:if>
"KRN",.84,7981003.002,2,71,0)
</xsl:template>
"KRN",.84,7981003.002,2,72,0)
 
"KRN",.84,7981003.002,2,73,0)
<xsl:template match="SUMMARY/DOB_SUMMARY">
"KRN",.84,7981003.002,2,74,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,75,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,76,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,77,0)
  <xsl:text>[Date of Birth Summary]</xsl:text>
"KRN",.84,7981003.002,2,78,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,79,0)
  <xsl:text>,Date of Birth,Count</xsl:text>
"KRN",.84,7981003.002,2,80,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,81,0)
  <xsl:for-each select="$summary/DOB">
"KRN",.84,7981003.002,2,82,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,83,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,84,0)
 </xsl:if>
"KRN",.84,7981003.002,2,85,0)
</xsl:template>
"KRN",.84,7981003.002,2,86,0)
 
"KRN",.84,7981003.002,2,87,0)
<xsl:template match="SUMMARY/DOD_SUMMARY">
"KRN",.84,7981003.002,2,88,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,89,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,90,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,91,0)
  <xsl:text>[Date of Death Summary]</xsl:text>
"KRN",.84,7981003.002,2,92,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,93,0)
  <xsl:text>,Date of Death,Count</xsl:text>
"KRN",.84,7981003.002,2,94,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,95,0)
  <xsl:for-each select="$summary/DOD">
"KRN",.84,7981003.002,2,96,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,97,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,98,0)
 </xsl:if>
"KRN",.84,7981003.002,2,99,0)
</xsl:template>
"KRN",.84,7981003.002,2,100,0)
 
"KRN",.84,7981003.002,2,101,0)
<xsl:template match="SUMMARY/ETHN_SUMMARY">
"KRN",.84,7981003.002,2,102,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,103,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,104,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,105,0)
  <xsl:text>[Ethnicity Summary]</xsl:text>
"KRN",.84,7981003.002,2,106,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,107,0)
  <xsl:text>,Ethnicity,Count</xsl:text>
"KRN",.84,7981003.002,2,108,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,109,0)
  <xsl:for-each select="$summary/ETHN">
"KRN",.84,7981003.002,2,110,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,111,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,112,0)
 </xsl:if>
"KRN",.84,7981003.002,2,113,0)
</xsl:template>
"KRN",.84,7981003.002,2,114,0)
 
"KRN",.84,7981003.002,2,115,0)
<xsl:template match="SUMMARY/RACE_SUMMARY">
"KRN",.84,7981003.002,2,116,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,117,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,118,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,119,0)
  <xsl:text>[Race Summary]</xsl:text>
"KRN",.84,7981003.002,2,120,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,121,0)
  <xsl:text>,Race,Count</xsl:text>
"KRN",.84,7981003.002,2,122,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,123,0)
  <xsl:for-each select="$summary/RACE">
"KRN",.84,7981003.002,2,124,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,125,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,126,0)
 </xsl:if>
"KRN",.84,7981003.002,2,127,0)
</xsl:template>
"KRN",.84,7981003.002,2,128,0)
 
"KRN",.84,7981003.002,2,129,0)
<xsl:template match="SUMMARY/RISK_FACTORS">
"KRN",.84,7981003.002,2,130,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,131,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,132,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,133,0)
  <xsl:text>[Risk Factors]</xsl:text>
"KRN",.84,7981003.002,2,134,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,135,0)
  <xsl:text>Code,Description,Count</xsl:text>
"KRN",.84,7981003.002,2,136,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,137,0)
  <xsl:for-each select="$summary/RISK">
"KRN",.84,7981003.002,2,138,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,139,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,140,0)
 </xsl:if>
"KRN",.84,7981003.002,2,141,0)
</xsl:template>
"KRN",.84,7981003.002,2,142,0)
 
"KRN",.84,7981003.002,2,143,0)
<xsl:template match="SUMMARY/SELDT_SUMMARY">
"KRN",.84,7981003.002,2,144,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,145,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,146,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,147,0)
  <xsl:text>[Selection Date Summary]</xsl:text>
"KRN",.84,7981003.002,2,148,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,149,0)
  <xsl:text>,Selection Date,Count</xsl:text>
"KRN",.84,7981003.002,2,150,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,151,0)
  <xsl:for-each select="$summary/SELDT">
"KRN",.84,7981003.002,2,152,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,153,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,154,0)
 </xsl:if>
"KRN",.84,7981003.002,2,155,0)
</xsl:template>
"KRN",.84,7981003.002,2,156,0)
 
"KRN",.84,7981003.002,2,157,0)
<xsl:template match="SUMMARY/SEX_SUMMARY">
"KRN",.84,7981003.002,2,158,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,159,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,160,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,161,0)
  <xsl:text>[Sex Summary]</xsl:text>
"KRN",.84,7981003.002,2,162,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,163,0)
  <xsl:text>,Sex,Count</xsl:text>
"KRN",.84,7981003.002,2,164,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,165,0)
  <xsl:for-each select="$summary/SEX">
"KRN",.84,7981003.002,2,166,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,167,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,168,0)
 </xsl:if>
"KRN",.84,7981003.002,2,169,0)
</xsl:template>
"KRN",.84,7981003.002,2,170,0)
 
"KRN",.84,7981003.002,2,171,0)
<xsl:template match="SUMMARY/UTIL_CODES">
"KRN",.84,7981003.002,2,172,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,173,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,174,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,175,0)
  <xsl:text>[Utilization]</xsl:text>
"KRN",.84,7981003.002,2,176,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,177,0)
  <xsl:text>Code,Description,Count</xsl:text>
"KRN",.84,7981003.002,2,178,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,179,0)
  <xsl:for-each select="$summary/UTIL">
"KRN",.84,7981003.002,2,180,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,181,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,182,0)
 </xsl:if>
"KRN",.84,7981003.002,2,183,0)
</xsl:template>
"KRN",.84,7981003.002,2,184,0)
 
"KRN",.84,7981003.002,2,185,0)
</xsl:stylesheet>
"KRN",.84,7981004.001,-1)
0^30
"KRN",.84,7981004.001,0)
7981004.001^2^^CLINICAL CASE REGISTRIES^Clinic Follow Up (HTML)
"KRN",.84,7981004.001,2,0)
^.844^55^55^3051127^^^^
"KRN",.84,7981004.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981004.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981004.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981004.001,2,4,0)
>
"KRN",.84,7981004.001,2,5,0)
 
"KRN",.84,7981004.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981004.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981004.001,2,8,0)
 
"KRN",.84,7981004.001,2,9,0)
<xsl:template match="/">
"KRN",.84,7981004.001,2,10,0)
 <html>
"KRN",.84,7981004.001,2,11,0)
  <head>
"KRN",.84,7981004.001,2,12,0)
   <title>Clinic Follow Up</title>
"KRN",.84,7981004.001,2,13,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981004.001,2,14,0)
  </head>
"KRN",.84,7981004.001,2,15,0)
  <body>
"KRN",.84,7981004.001,2,16,0)
   <h1>Clinic Follow Up</h1>
"KRN",.84,7981004.001,2,17,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981004.001,2,18,0)
   <div style="page-break-before:always">
"KRN",.84,7981004.001,2,19,0)
    <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981004.001,2,20,0)
   </div>
"KRN",.84,7981004.001,2,21,0)
  </body>
"KRN",.84,7981004.001,2,22,0)
 </html>
"KRN",.84,7981004.001,2,23,0)
</xsl:template>
"KRN",.84,7981004.001,2,24,0)
 
"KRN",.84,7981004.001,2,25,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981004.001,2,26,0)
 
"KRN",.84,7981004.001,2,27,0)
<xsl:template match="COLUMN[@NAME='LSNDT']">
"KRN",.84,7981004.001,2,28,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981004.001,2,29,0)
  <xsl:with-param name="title" select="'Last Seen Date'"/>
"KRN",.84,7981004.001,2,30,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981004.001,2,31,0)
 </xsl:call-template>
"KRN",.84,7981004.001,2,32,0)
</xsl:template>
"KRN",.84,7981004.001,2,33,0)
 
"KRN",.84,7981004.001,2,34,0)
<xsl:template match="COLUMN[@NAME='SEEN']">
"KRN",.84,7981004.001,2,35,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981004.001,2,36,0)
  <xsl:with-param name="title" select="'Seen'"/>
"KRN",.84,7981004.001,2,37,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981004.001,2,38,0)
 </xsl:call-template>
"KRN",.84,7981004.001,2,39,0)
</xsl:template>
"KRN",.84,7981004.001,2,40,0)
 
"KRN",.84,7981004.001,2,41,0)
<!--[ CELL VALUES ]-->
"KRN",.84,7981004.001,2,42,0)
 
"KRN",.84,7981004.001,2,43,0)
<xsl:template match="PATIENT/LSNDT">
"KRN",.84,7981004.001,2,44,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981004.001,2,45,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981004.001,2,46,0)
 </xsl:call-template>
"KRN",.84,7981004.001,2,47,0)
</xsl:template>
"KRN",.84,7981004.001,2,48,0)
 
"KRN",.84,7981004.001,2,49,0)
<xsl:template match="PATIENT/SEEN">
"KRN",.84,7981004.001,2,50,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981004.001,2,51,0)
  <xsl:with-param name="yesno" select="1"/>
"KRN",.84,7981004.001,2,52,0)
 </xsl:call-template>
"KRN",.84,7981004.001,2,53,0)
</xsl:template>
"KRN",.84,7981004.001,2,54,0)
 
"KRN",.84,7981004.001,2,55,0)
</xsl:stylesheet>
"KRN",.84,7981004.002,-1)
0^31
"KRN",.84,7981004.002,0)
7981004.002^2^^CLINICAL CASE REGISTRIES^Clinic Follow Up (CSV)
"KRN",.84,7981004.002,2,0)
^.844^41^41^3050912^^^
"KRN",.84,7981004.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981004.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981004.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981004.002,2,4,0)
>
"KRN",.84,7981004.002,2,5,0)
 
"KRN",.84,7981004.002,2,6,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981004.002,2,7,0)
 
"KRN",.84,7981004.002,2,8,0)
<xsl:template match="/">
"KRN",.84,7981004.002,2,9,0)
 <xsl:text>Clinic Follow Up</xsl:text>
"KRN",.84,7981004.002,2,10,0)
 <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981004.002,2,11,0)
</xsl:template>
"KRN",.84,7981004.002,2,12,0)
 
"KRN",.84,7981004.002,2,13,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981004.002,2,14,0)
 
"KRN",.84,7981004.002,2,15,0)
<xsl:template match="COLUMN[@NAME='LSNDT']">
"KRN",.84,7981004.002,2,16,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981004.002,2,17,0)
  <xsl:with-param name="title" select="'Last Seen Date'"/>
"KRN",.84,7981004.002,2,18,0)
 </xsl:call-template>
"KRN",.84,7981004.002,2,19,0)
</xsl:template>
"KRN",.84,7981004.002,2,20,0)
 
"KRN",.84,7981004.002,2,21,0)
<xsl:template match="COLUMN[@NAME='SEEN']">
"KRN",.84,7981004.002,2,22,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981004.002,2,23,0)
  <xsl:with-param name="title" select="'Seen'"/>
"KRN",.84,7981004.002,2,24,0)
 </xsl:call-template>
"KRN",.84,7981004.002,2,25,0)
</xsl:template>
"KRN",.84,7981004.002,2,26,0)
 
"KRN",.84,7981004.002,2,27,0)
<!--[ CELL VALUES ]-->
"KRN",.84,7981004.002,2,28,0)
 
"KRN",.84,7981004.002,2,29,0)
<xsl:template match="PATIENT/LSNDT">
"KRN",.84,7981004.002,2,30,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981004.002,2,31,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981004.002,2,32,0)
 </xsl:call-template>
"KRN",.84,7981004.002,2,33,0)
</xsl:template>
"KRN",.84,7981004.002,2,34,0)
 
"KRN",.84,7981004.002,2,35,0)
<xsl:template match="PATIENT/SEEN">
"KRN",.84,7981004.002,2,36,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981004.002,2,37,0)
  <xsl:with-param name="yesno" select="1"/>
"KRN",.84,7981004.002,2,38,0)
 </xsl:call-template>
"KRN",.84,7981004.002,2,39,0)
</xsl:template>
"KRN",.84,7981004.002,2,40,0)
 
"KRN",.84,7981004.002,2,41,0)
</xsl:stylesheet>
"KRN",.84,7981005.001,-1)
0^32
"KRN",.84,7981005.001,0)
7981005.001^2^^CLINICAL CASE REGISTRIES^Inpatient Utilization (HTML)
"KRN",.84,7981005.001,2,0)
^^194^194^3050916^
"KRN",.84,7981005.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981005.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981005.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981005.001,2,4,0)
>
"KRN",.84,7981005.001,2,5,0)
 
"KRN",.84,7981005.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981005.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981005.001,2,8,0)
 
"KRN",.84,7981005.001,2,9,0)
<xsl:template match="/">
"KRN",.84,7981005.001,2,10,0)
 <html>
"KRN",.84,7981005.001,2,11,0)
  <head>
"KRN",.84,7981005.001,2,12,0)
   <title>Inpatient Utilization</title>
"KRN",.84,7981005.001,2,13,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981005.001,2,14,0)
  </head>
"KRN",.84,7981005.001,2,15,0)
  <body>
"KRN",.84,7981005.001,2,16,0)
   <h1>Inpatient Utilization</h1>
"KRN",.84,7981005.001,2,17,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981005.001,2,18,0)
   <xsl:choose>
"KRN",.84,7981005.001,2,19,0)
    <xsl:when test="REPORT/INPATIENTS">
"KRN",.84,7981005.001,2,20,0)
     <div style="page-break-before:always">
"KRN",.84,7981005.001,2,21,0)
      <xsl:call-template name="InpatientSummary"/>
"KRN",.84,7981005.001,2,22,0)
      <xsl:apply-templates select="REPORT/INPATIENTS/*[@TABLE]"/>
"KRN",.84,7981005.001,2,23,0)
     </div>
"KRN",.84,7981005.001,2,24,0)
    </xsl:when>
"KRN",.84,7981005.001,2,25,0)
    <xsl:otherwise>
"KRN",.84,7981005.001,2,26,0)
     <xsl:call-template name="TableNoData"/>
"KRN",.84,7981005.001,2,27,0)
    </xsl:otherwise>
"KRN",.84,7981005.001,2,28,0)
   </xsl:choose>
"KRN",.84,7981005.001,2,29,0)
   <xsl:if test="REPORT/HIGHUTIL">
"KRN",.84,7981005.001,2,30,0)
    <div style="page-break-before:always">
"KRN",.84,7981005.001,2,31,0)
     <h2>Highest Utilization</h2>
"KRN",.84,7981005.001,2,32,0)
     <xsl:apply-templates select="REPORT/HIGHUTIL/*"/>
"KRN",.84,7981005.001,2,33,0)
    </div>
"KRN",.84,7981005.001,2,34,0)
   </xsl:if>
"KRN",.84,7981005.001,2,35,0)
  </body>
"KRN",.84,7981005.001,2,36,0)
 </html>
"KRN",.84,7981005.001,2,37,0)
</xsl:template>
"KRN",.84,7981005.001,2,38,0)
 
"KRN",.84,7981005.001,2,39,0)
<xsl:template match="HIGHUTIL/HU_DAYS">
"KRN",.84,7981005.001,2,40,0)
 <h3><xsl:call-template name="HUPatientsHeader"/> by number of days</h3>
"KRN",.84,7981005.001,2,41,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981005.001,2,42,0)
</xsl:template>
"KRN",.84,7981005.001,2,43,0)
 
"KRN",.84,7981005.001,2,44,0)
<xsl:template match="HIGHUTIL/HU_STAYS">
"KRN",.84,7981005.001,2,45,0)
 <h3><xsl:call-template name="HUPatientsHeader"/> by number of stays</h3>
"KRN",.84,7981005.001,2,46,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981005.001,2,47,0)
</xsl:template>
"KRN",.84,7981005.001,2,48,0)
 
"KRN",.84,7981005.001,2,49,0)
<xsl:template match="INPATIENTS/BEDSECTIONS">
"KRN",.84,7981005.001,2,50,0)
 <h3>Distribution of Utilization among Bed Sections</h3>
"KRN",.84,7981005.001,2,51,0)
 <div>
"KRN",.84,7981005.001,2,52,0)
  Because of hospital stays split among multiple bed sections,
"KRN",.84,7981005.001,2,53,0)
  information by bed section may not match the totals for complete
"KRN",.84,7981005.001,2,54,0)
  hospital stays presented in the summary and highest utilization tables.
"KRN",.84,7981005.001,2,55,0)
 </div>
"KRN",.84,7981005.001,2,56,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981005.001,2,57,0)
</xsl:template>
"KRN",.84,7981005.001,2,58,0)
 
"KRN",.84,7981005.001,2,59,0)
<xsl:template match="INPATIENTS/NOBS">
"KRN",.84,7981005.001,2,60,0)
 <h3>Occurrences of Missing Bed Section ID</h3>
"KRN",.84,7981005.001,2,61,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981005.001,2,62,0)
</xsl:template>
"KRN",.84,7981005.001,2,63,0)
 
"KRN",.84,7981005.001,2,64,0)
<xsl:template match="INPATIENTS/STAYS">
"KRN",.84,7981005.001,2,65,0)
 <br clear="both"/>
"KRN",.84,7981005.001,2,66,0)
 <xsl:call-template name="DataGrid">
"KRN",.84,7981005.001,2,67,0)
  <xsl:with-param name="divstyle" select="'width:50%'"/>
"KRN",.84,7981005.001,2,68,0)
 </xsl:call-template>
"KRN",.84,7981005.001,2,69,0)
</xsl:template>
"KRN",.84,7981005.001,2,70,0)
 
"KRN",.84,7981005.001,2,71,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981005.001,2,72,0)
 
"KRN",.84,7981005.001,2,73,0)
<xsl:template name="InpatientSummary">
"KRN",.84,7981005.001,2,74,0)
 <xsl:variable name="IP" select="/REPORT/INPATIENTS"/>
"KRN",.84,7981005.001,2,75,0)
 <table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981005.001,2,76,0)
  <thead>
"KRN",.84,7981005.001,2,77,0)
   <tr>
"KRN",.84,7981005.001,2,78,0)
    <th width="16%">Number of Patients</th>
"KRN",.84,7981005.001,2,79,0)
    <th width="16%">Number of Stays</th>
"KRN",.84,7981005.001,2,80,0)
    <th width="16%">Number of Days</th>
"KRN",.84,7981005.001,2,81,0)
    <th width="16%">Median Length of Stay (MLOS)</th>
"KRN",.84,7981005.001,2,82,0)
    <th width="16%">Average Length of Stay</th>
"KRN",.84,7981005.001,2,83,0)
    <th width="16%">Number of Short Stays</th>
"KRN",.84,7981005.001,2,84,0)
   </tr>
"KRN",.84,7981005.001,2,85,0)
  </thead>
"KRN",.84,7981005.001,2,86,0)
  <tbody>
"KRN",.84,7981005.001,2,87,0)
   <tr>
"KRN",.84,7981005.001,2,88,0)
    <td><xsl:value-of select="$IP/NP"/></td>
"KRN",.84,7981005.001,2,89,0)
    <td><xsl:value-of select="$IP/NST"/></td>
"KRN",.84,7981005.001,2,90,0)
    <td><xsl:value-of select="$IP/ND"/></td>
"KRN",.84,7981005.001,2,91,0)
    <td><xsl:value-of select="$IP/MLOS"/></td>
"KRN",.84,7981005.001,2,92,0)
    <td><xsl:value-of select="$IP/ALOS"/></td>
"KRN",.84,7981005.001,2,93,0)
    <td><xsl:value-of select="$IP/NSS"/></td>
"KRN",.84,7981005.001,2,94,0)
   </tr>
"KRN",.84,7981005.001,2,95,0)
  </tbody>
"KRN",.84,7981005.001,2,96,0)
 </table>
"KRN",.84,7981005.001,2,97,0)
</xsl:template>
"KRN",.84,7981005.001,2,98,0)
 
"KRN",.84,7981005.001,2,99,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981005.001,2,100,0)
 
"KRN",.84,7981005.001,2,101,0)
<xsl:template match="TBLDEF[@NAME='NOBS']/COLUMN[@NAME='DATE']">
"KRN",.84,7981005.001,2,102,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.001,2,103,0)
  <xsl:with-param name="title" select="'Movement Date'"/>
"KRN",.84,7981005.001,2,104,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981005.001,2,105,0)
 </xsl:call-template>
"KRN",.84,7981005.001,2,106,0)
</xsl:template>
"KRN",.84,7981005.001,2,107,0)
 
"KRN",.84,7981005.001,2,108,0)
<xsl:template match="COLUMN[@NAME='MLOS']">
"KRN",.84,7981005.001,2,109,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.001,2,110,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981005.001,2,111,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981005.001,2,112,0)
 </xsl:call-template>
"KRN",.84,7981005.001,2,113,0)
</xsl:template>
"KRN",.84,7981005.001,2,114,0)
 
"KRN",.84,7981005.001,2,115,0)
<xsl:template match="COLUMN[@NAME='NAME']">
"KRN",.84,7981005.001,2,116,0)
 <xsl:variable name="tblname" select="../@NAME"/>
"KRN",.84,7981005.001,2,117,0)
 <xsl:choose>
"KRN",.84,7981005.001,2,118,0)
  <xsl:when test="$tblname='BEDSECTIONS'">
"KRN",.84,7981005.001,2,119,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.001,2,120,0)
    <xsl:with-param name="title" select="'Bed Section'"/>
"KRN",.84,7981005.001,2,121,0)
   </xsl:call-template> 
"KRN",.84,7981005.001,2,122,0)
  </xsl:when>
"KRN",.84,7981005.001,2,123,0)
  <xsl:when test="contains($tblname,'HU_') or ($tblname='NOBS')">
"KRN",.84,7981005.001,2,124,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.001,2,125,0)
    <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981005.001,2,126,0)
   </xsl:call-template> 
"KRN",.84,7981005.001,2,127,0)
  </xsl:when>
"KRN",.84,7981005.001,2,128,0)
  <xsl:otherwise>
"KRN",.84,7981005.001,2,129,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.001,2,130,0)
    <xsl:with-param name="title" select="'Name'"/>
"KRN",.84,7981005.001,2,131,0)
   </xsl:call-template> 
"KRN",.84,7981005.001,2,132,0)
  </xsl:otherwise>
"KRN",.84,7981005.001,2,133,0)
 </xsl:choose>
"KRN",.84,7981005.001,2,134,0)
</xsl:template>
"KRN",.84,7981005.001,2,135,0)
 
"KRN",.84,7981005.001,2,136,0)
<xsl:template match="COLUMN[@NAME='ND']">
"KRN",.84,7981005.001,2,137,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.001,2,138,0)
  <xsl:with-param name="title" select="'Number of Days'"/>
"KRN",.84,7981005.001,2,139,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981005.001,2,140,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981005.001,2,141,0)
 </xsl:call-template>
"KRN",.84,7981005.001,2,142,0)
</xsl:template>
"KRN",.84,7981005.001,2,143,0)
 
"KRN",.84,7981005.001,2,144,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981005.001,2,145,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.001,2,146,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981005.001,2,147,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981005.001,2,148,0)
 </xsl:call-template>
"KRN",.84,7981005.001,2,149,0)
</xsl:template>
"KRN",.84,7981005.001,2,150,0)
 
"KRN",.84,7981005.001,2,151,0)
<xsl:template match="COLUMN[@NAME='NSS']">
"KRN",.84,7981005.001,2,152,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.001,2,153,0)
  <xsl:with-param name="title" select="'Number of Short Stays'"/>
"KRN",.84,7981005.001,2,154,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981005.001,2,155,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981005.001,2,156,0)
 </xsl:call-template>
"KRN",.84,7981005.001,2,157,0)
</xsl:template>
"KRN",.84,7981005.001,2,158,0)
 
"KRN",.84,7981005.001,2,159,0)
<xsl:template match="COLUMN[@NAME='NST']">
"KRN",.84,7981005.001,2,160,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.001,2,161,0)
  <xsl:with-param name="title" select="'Number of Stays'"/>
"KRN",.84,7981005.001,2,162,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981005.001,2,163,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981005.001,2,164,0)
 </xsl:call-template>
"KRN",.84,7981005.001,2,165,0)
</xsl:template>
"KRN",.84,7981005.001,2,166,0)
 
"KRN",.84,7981005.001,2,167,0)
<xsl:template match="COLUMN[@NAME='PTF']">
"KRN",.84,7981005.001,2,168,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.001,2,169,0)
  <xsl:with-param name="title" select="'PTF#'"/>
"KRN",.84,7981005.001,2,170,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981005.001,2,171,0)
 </xsl:call-template>
"KRN",.84,7981005.001,2,172,0)
</xsl:template>
"KRN",.84,7981005.001,2,173,0)
 
"KRN",.84,7981005.001,2,174,0)
<!--[ CELL VALUES ]-->
"KRN",.84,7981005.001,2,175,0)
 
"KRN",.84,7981005.001,2,176,0)
<xsl:template match="NOBS/PATIENT/DATE">
"KRN",.84,7981005.001,2,177,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981005.001,2,178,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981005.001,2,179,0)
 </xsl:call-template>
"KRN",.84,7981005.001,2,180,0)
</xsl:template>
"KRN",.84,7981005.001,2,181,0)
 
"KRN",.84,7981005.001,2,182,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981005.001,2,183,0)
 
"KRN",.84,7981005.001,2,184,0)
<xsl:template match="PARAMETERS/MAXUTNUM">
"KRN",.84,7981005.001,2,185,0)
 <tr>
"KRN",.84,7981005.001,2,186,0)
  <th scope="row">MaxUtil:&#160;</th>
"KRN",.84,7981005.001,2,187,0)
  <td>
"KRN",.84,7981005.001,2,188,0)
   <xsl:value-of select="."/>
"KRN",.84,7981005.001,2,189,0)
   (maximum number of patients with highest utilization to display)
"KRN",.84,7981005.001,2,190,0)
  </td>
"KRN",.84,7981005.001,2,191,0)
 </tr>
"KRN",.84,7981005.001,2,192,0)
</xsl:template>
"KRN",.84,7981005.001,2,193,0)
 
"KRN",.84,7981005.001,2,194,0)
</xsl:stylesheet>
"KRN",.84,7981005.002,-1)
0^33
"KRN",.84,7981005.002,0)
7981005.002^2^^CLINICAL CASE REGISTRIES^Inpatient Utilization (CSV)
"KRN",.84,7981005.002,2,0)
^.844^97^97^3050914^^
"KRN",.84,7981005.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981005.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981005.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981005.002,2,4,0)
>
"KRN",.84,7981005.002,2,5,0)
 
"KRN",.84,7981005.002,2,6,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981005.002,2,7,0)
 
"KRN",.84,7981005.002,2,8,0)
<xsl:variable name="UTILIZATION_HEADER"
"KRN",.84,7981005.002,2,9,0)
     select="'Inpatient Utilization'"/>
"KRN",.84,7981005.002,2,10,0)
 
"KRN",.84,7981005.002,2,11,0)
<xsl:template match="/">
"KRN",.84,7981005.002,2,12,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981005.002,2,13,0)
  <xsl:with-param name="data" select="REPORT/INPATIENTS/STAYS"/>
"KRN",.84,7981005.002,2,14,0)
  <xsl:with-param name="subttl" select="'Stays'"/>
"KRN",.84,7981005.002,2,15,0)
 </xsl:call-template>
"KRN",.84,7981005.002,2,16,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981005.002,2,17,0)
  <xsl:with-param name="data" select="REPORT/INPATIENTS/BEDSECTIONS"/>
"KRN",.84,7981005.002,2,18,0)
  <xsl:with-param name="subttl"
"KRN",.84,7981005.002,2,19,0)
       select="'Distribution of Utilization among Bed Sections'"/>
"KRN",.84,7981005.002,2,20,0)
 </xsl:call-template>
"KRN",.84,7981005.002,2,21,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981005.002,2,22,0)
  <xsl:with-param name="data" select="REPORT/INPATIENTS/NOBS"/>
"KRN",.84,7981005.002,2,23,0)
  <xsl:with-param name="subttl"
"KRN",.84,7981005.002,2,24,0)
       select="'Occurrences of Missing Bed Section ID'"/>
"KRN",.84,7981005.002,2,25,0)
 </xsl:call-template>
"KRN",.84,7981005.002,2,26,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981005.002,2,27,0)
  <xsl:with-param name="data" select="REPORT/HIGHUTIL/HU_STAYS"/>
"KRN",.84,7981005.002,2,28,0)
  <xsl:with-param name="subttl" select="'Highest Number of Stays'"/>
"KRN",.84,7981005.002,2,29,0)
 </xsl:call-template>
"KRN",.84,7981005.002,2,30,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981005.002,2,31,0)
  <xsl:with-param name="data" select="REPORT/HIGHUTIL/HU_DAYS"/>
"KRN",.84,7981005.002,2,32,0)
  <xsl:with-param name="subttl" select="'Highest Number of Days'"/>
"KRN",.84,7981005.002,2,33,0)
 </xsl:call-template>
"KRN",.84,7981005.002,2,34,0)
</xsl:template>
"KRN",.84,7981005.002,2,35,0)
 
"KRN",.84,7981005.002,2,36,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981005.002,2,37,0)
 
"KRN",.84,7981005.002,2,38,0)
<xsl:template match="TBLDEF[@NAME='NOBS']/COLUMN[@NAME='DATE']">
"KRN",.84,7981005.002,2,39,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.002,2,40,0)
  <xsl:with-param name="title" select="'Movement Date'"/>
"KRN",.84,7981005.002,2,41,0)
 </xsl:call-template>
"KRN",.84,7981005.002,2,42,0)
</xsl:template>
"KRN",.84,7981005.002,2,43,0)
 
"KRN",.84,7981005.002,2,44,0)
<xsl:template match="COLUMN[@NAME='NAME']">
"KRN",.84,7981005.002,2,45,0)
 <xsl:variable name="tblname" select="../@NAME"/>
"KRN",.84,7981005.002,2,46,0)
 <xsl:choose>
"KRN",.84,7981005.002,2,47,0)
  <xsl:when test="$tblname='BEDSECTIONS'">
"KRN",.84,7981005.002,2,48,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.002,2,49,0)
    <xsl:with-param name="title" select="'Bed Section'"/>
"KRN",.84,7981005.002,2,50,0)
   </xsl:call-template> 
"KRN",.84,7981005.002,2,51,0)
  </xsl:when>
"KRN",.84,7981005.002,2,52,0)
  <xsl:when test="contains($tblname,'HU_') or ($tblname='NOBS')">
"KRN",.84,7981005.002,2,53,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.002,2,54,0)
    <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981005.002,2,55,0)
   </xsl:call-template> 
"KRN",.84,7981005.002,2,56,0)
  </xsl:when>
"KRN",.84,7981005.002,2,57,0)
  <xsl:otherwise>
"KRN",.84,7981005.002,2,58,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.002,2,59,0)
    <xsl:with-param name="title" select="'Name'"/>
"KRN",.84,7981005.002,2,60,0)
   </xsl:call-template> 
"KRN",.84,7981005.002,2,61,0)
  </xsl:otherwise>
"KRN",.84,7981005.002,2,62,0)
 </xsl:choose>
"KRN",.84,7981005.002,2,63,0)
</xsl:template>
"KRN",.84,7981005.002,2,64,0)
 
"KRN",.84,7981005.002,2,65,0)
<xsl:template match="COLUMN[@NAME='ND']">
"KRN",.84,7981005.002,2,66,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.002,2,67,0)
  <xsl:with-param name="title" select="'Number of Days'"/>
"KRN",.84,7981005.002,2,68,0)
 </xsl:call-template>
"KRN",.84,7981005.002,2,69,0)
</xsl:template>
"KRN",.84,7981005.002,2,70,0)
 
"KRN",.84,7981005.002,2,71,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981005.002,2,72,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.002,2,73,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981005.002,2,74,0)
 </xsl:call-template>
"KRN",.84,7981005.002,2,75,0)
</xsl:template>
"KRN",.84,7981005.002,2,76,0)
 
"KRN",.84,7981005.002,2,77,0)
<xsl:template match="COLUMN[@NAME='NSS']">
"KRN",.84,7981005.002,2,78,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.002,2,79,0)
  <xsl:with-param name="title" select="'Number of Short Stays'"/>
"KRN",.84,7981005.002,2,80,0)
 </xsl:call-template>
"KRN",.84,7981005.002,2,81,0)
</xsl:template>
"KRN",.84,7981005.002,2,82,0)
 
"KRN",.84,7981005.002,2,83,0)
<xsl:template match="COLUMN[@NAME='NST']">
"KRN",.84,7981005.002,2,84,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981005.002,2,85,0)
  <xsl:with-param name="title" select="'Number of Stays'"/>
"KRN",.84,7981005.002,2,86,0)
 </xsl:call-template>
"KRN",.84,7981005.002,2,87,0)
</xsl:template>
"KRN",.84,7981005.002,2,88,0)
 
"KRN",.84,7981005.002,2,89,0)
<!--[ CELL VALUES ]-->
"KRN",.84,7981005.002,2,90,0)
 
"KRN",.84,7981005.002,2,91,0)
<xsl:template match="NOBS/PATIENT/DATE">
"KRN",.84,7981005.002,2,92,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981005.002,2,93,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981005.002,2,94,0)
 </xsl:call-template>
"KRN",.84,7981005.002,2,95,0)
</xsl:template>
"KRN",.84,7981005.002,2,96,0)
 
"KRN",.84,7981005.002,2,97,0)
</xsl:stylesheet>
"KRN",.84,7981006.001,-1)
0^34
"KRN",.84,7981006.001,0)
7981006.001^2^^CLINICAL CASE REGISTRIES^Laboratory Utilization (HTML)
"KRN",.84,7981006.001,2,0)
^.844^163^163^3050919^^^
"KRN",.84,7981006.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981006.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981006.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981006.001,2,4,0)
>
"KRN",.84,7981006.001,2,5,0)
 
"KRN",.84,7981006.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981006.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981006.001,2,8,0)
<xsl:include href="template://report/995/1"/>  <!-- Lab Data -->
"KRN",.84,7981006.001,2,9,0)
 
"KRN",.84,7981006.001,2,10,0)
<xsl:template match="/">
"KRN",.84,7981006.001,2,11,0)
 <html>
"KRN",.84,7981006.001,2,12,0)
  <head>
"KRN",.84,7981006.001,2,13,0)
   <title>Laboratory Utilization</title>
"KRN",.84,7981006.001,2,14,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981006.001,2,15,0)
  </head>
"KRN",.84,7981006.001,2,16,0)
  <body>
"KRN",.84,7981006.001,2,17,0)
   <h1>Laboratory Utilization</h1>
"KRN",.84,7981006.001,2,18,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981006.001,2,19,0)
   <xsl:choose>
"KRN",.84,7981006.001,2,20,0)
    <xsl:when test="REPORT/*[@TABLE]">
"KRN",.84,7981006.001,2,21,0)
     <div style="page-break-before:always">
"KRN",.84,7981006.001,2,22,0)
      <xsl:call-template name="CategorySummary"/>
"KRN",.84,7981006.001,2,23,0)
      <xsl:apply-templates select="REPORT/RESULTS"/>
"KRN",.84,7981006.001,2,24,0)
      <xsl:apply-templates select="REPORT/LABTESTS"/>
"KRN",.84,7981006.001,2,25,0)
      <xsl:apply-templates select="REPORT/PATIENTS"/>
"KRN",.84,7981006.001,2,26,0)
     </div>
"KRN",.84,7981006.001,2,27,0)
    </xsl:when>
"KRN",.84,7981006.001,2,28,0)
    <xsl:otherwise>
"KRN",.84,7981006.001,2,29,0)
     <xsl:call-template name="TableNoData"/>
"KRN",.84,7981006.001,2,30,0)
    </xsl:otherwise>
"KRN",.84,7981006.001,2,31,0)
   </xsl:choose>
"KRN",.84,7981006.001,2,32,0)
  </body>
"KRN",.84,7981006.001,2,33,0)
 </html>
"KRN",.84,7981006.001,2,34,0)
</xsl:template>
"KRN",.84,7981006.001,2,35,0)
 
"KRN",.84,7981006.001,2,36,0)
<!--[ TABLES ]-->
"KRN",.84,7981006.001,2,37,0)
 
"KRN",.84,7981006.001,2,38,0)
<xsl:template match="REPORT/LABTESTS">
"KRN",.84,7981006.001,2,39,0)
 <xsl:variable name="minrpnum" select="/REPORT/PARAMETERS/MINRPNUM"/>
"KRN",.84,7981006.001,2,40,0)
 <h3>
"KRN",.84,7981006.001,2,41,0)
  Laboratory tests performed
"KRN",.84,7981006.001,2,42,0)
  <xsl:choose>
"KRN",.84,7981006.001,2,43,0)
   <xsl:when test="$minrpnum>1">
"KRN",.84,7981006.001,2,44,0)
    <xsl:value-of select="$minrpnum"/> times or more
"KRN",.84,7981006.001,2,45,0)
   </xsl:when>
"KRN",.84,7981006.001,2,46,0)
   <xsl:otherwise>at least once</xsl:otherwise>
"KRN",.84,7981006.001,2,47,0)
  </xsl:choose>
"KRN",.84,7981006.001,2,48,0)
 </h3>
"KRN",.84,7981006.001,2,49,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981006.001,2,50,0)
</xsl:template>
"KRN",.84,7981006.001,2,51,0)
 
"KRN",.84,7981006.001,2,52,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981006.001,2,53,0)
 <h3><xsl:call-template name="HUPatientsHeader"/> by number of results</h3>
"KRN",.84,7981006.001,2,54,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981006.001,2,55,0)
</xsl:template>
"KRN",.84,7981006.001,2,56,0)
 
"KRN",.84,7981006.001,2,57,0)
<xsl:template match="REPORT/RESULTS">
"KRN",.84,7981006.001,2,58,0)
 <br clear="both"/>
"KRN",.84,7981006.001,2,59,0)
 <xsl:call-template name="DataGrid">
"KRN",.84,7981006.001,2,60,0)
  <xsl:with-param name="divstyle" select="'width:50%'"/>
"KRN",.84,7981006.001,2,61,0)
 </xsl:call-template>
"KRN",.84,7981006.001,2,62,0)
</xsl:template>
"KRN",.84,7981006.001,2,63,0)
 
"KRN",.84,7981006.001,2,64,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981006.001,2,65,0)
 
"KRN",.84,7981006.001,2,66,0)
<xsl:template name="CategorySummary">
"KRN",.84,7981006.001,2,67,0)
 <table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981006.001,2,68,0)
  <thead>
"KRN",.84,7981006.001,2,69,0)
   <tr>
"KRN",.84,7981006.001,2,70,0)
    <th width="25%">Number of Patients</th>
"KRN",.84,7981006.001,2,71,0)
    <th width="25%">Number of Orders</th>
"KRN",.84,7981006.001,2,72,0)
    <th width="25%">Number of Results</th>
"KRN",.84,7981006.001,2,73,0)
    <th width="25%">Number of Different Tests</th>
"KRN",.84,7981006.001,2,74,0)
   </tr>
"KRN",.84,7981006.001,2,75,0)
  </thead>
"KRN",.84,7981006.001,2,76,0)
  <tbody>
"KRN",.84,7981006.001,2,77,0)
   <tr>
"KRN",.84,7981006.001,2,78,0)
    <td><xsl:value-of select="/REPORT/NP"/></td>
"KRN",.84,7981006.001,2,79,0)
    <td><xsl:value-of select="/REPORT/NO"/></td>
"KRN",.84,7981006.001,2,80,0)
    <td><xsl:value-of select="/REPORT/NR"/></td>
"KRN",.84,7981006.001,2,81,0)
    <td><xsl:value-of select="/REPORT/NDT"/></td>
"KRN",.84,7981006.001,2,82,0)
   </tr>
"KRN",.84,7981006.001,2,83,0)
  </tbody>
"KRN",.84,7981006.001,2,84,0)
 </table>
"KRN",.84,7981006.001,2,85,0)
</xsl:template>
"KRN",.84,7981006.001,2,86,0)
 
"KRN",.84,7981006.001,2,87,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981006.001,2,88,0)
 
"KRN",.84,7981006.001,2,89,0)
<xsl:template match="COLUMN[@NAME='MAXNP']">
"KRN",.84,7981006.001,2,90,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.001,2,91,0)
  <xsl:with-param name="title"
"KRN",.84,7981006.001,2,92,0)
       select="'Number of Patients with Max. Utilization'"/>
"KRN",.84,7981006.001,2,93,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981006.001,2,94,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981006.001,2,95,0)
 </xsl:call-template>
"KRN",.84,7981006.001,2,96,0)
</xsl:template>
"KRN",.84,7981006.001,2,97,0)
 
"KRN",.84,7981006.001,2,98,0)
<xsl:template match="COLUMN[@NAME='MAXNRPP']">
"KRN",.84,7981006.001,2,99,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.001,2,100,0)
  <xsl:with-param name="title"
"KRN",.84,7981006.001,2,101,0)
       select="'Maximum Number of Results per Patient'"/>
"KRN",.84,7981006.001,2,102,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981006.001,2,103,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981006.001,2,104,0)
 </xsl:call-template>
"KRN",.84,7981006.001,2,105,0)
</xsl:template>
"KRN",.84,7981006.001,2,106,0)
 
"KRN",.84,7981006.001,2,107,0)
<xsl:template match="COLUMN[@NAME='NDT']">
"KRN",.84,7981006.001,2,108,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.001,2,109,0)
  <xsl:with-param name="title" select="'Number of Different Tests'"/>
"KRN",.84,7981006.001,2,110,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981006.001,2,111,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981006.001,2,112,0)
 </xsl:call-template>
"KRN",.84,7981006.001,2,113,0)
</xsl:template>
"KRN",.84,7981006.001,2,114,0)
 
"KRN",.84,7981006.001,2,115,0)
<xsl:template match="COLUMN[@NAME='NO']">
"KRN",.84,7981006.001,2,116,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.001,2,117,0)
  <xsl:with-param name="title" select="'Number of Orders'"/>
"KRN",.84,7981006.001,2,118,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981006.001,2,119,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981006.001,2,120,0)
 </xsl:call-template>
"KRN",.84,7981006.001,2,121,0)
</xsl:template>
"KRN",.84,7981006.001,2,122,0)
 
"KRN",.84,7981006.001,2,123,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981006.001,2,124,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.001,2,125,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981006.001,2,126,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981006.001,2,127,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981006.001,2,128,0)
 </xsl:call-template>
"KRN",.84,7981006.001,2,129,0)
</xsl:template>
"KRN",.84,7981006.001,2,130,0)
 
"KRN",.84,7981006.001,2,131,0)
<xsl:template match="COLUMN[@NAME='NR']">
"KRN",.84,7981006.001,2,132,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.001,2,133,0)
  <xsl:with-param name="title" select="'Number of Results'"/>
"KRN",.84,7981006.001,2,134,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981006.001,2,135,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981006.001,2,136,0)
 </xsl:call-template>
"KRN",.84,7981006.001,2,137,0)
</xsl:template>
"KRN",.84,7981006.001,2,138,0)
 
"KRN",.84,7981006.001,2,139,0)
 
"KRN",.84,7981006.001,2,140,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981006.001,2,141,0)
 
"KRN",.84,7981006.001,2,142,0)
<xsl:template match="PARAMETERS/MAXUTNUM">
"KRN",.84,7981006.001,2,143,0)
 <tr>
"KRN",.84,7981006.001,2,144,0)
  <th scope="row">MaxUtil:&#160;</th>
"KRN",.84,7981006.001,2,145,0)
  <td>
"KRN",.84,7981006.001,2,146,0)
   <xsl:value-of select="."/>
"KRN",.84,7981006.001,2,147,0)
   (maximum number of patients with highest utilization to display)
"KRN",.84,7981006.001,2,148,0)
  </td>
"KRN",.84,7981006.001,2,149,0)
 </tr>
"KRN",.84,7981006.001,2,150,0)
</xsl:template>
"KRN",.84,7981006.001,2,151,0)
 
"KRN",.84,7981006.001,2,152,0)
<xsl:template match="PARAMETERS/MINRPNUM">
"KRN",.84,7981006.001,2,153,0)
 <tr>
"KRN",.84,7981006.001,2,154,0)
  <th scope="row">MinTest:&#160;</th>
"KRN",.84,7981006.001,2,155,0)
  <td>
"KRN",.84,7981006.001,2,156,0)
   <xsl:value-of select="."/>
"KRN",.84,7981006.001,2,157,0)
   (minimum number of times a Lab test should be performed
"KRN",.84,7981006.001,2,158,0)
   to be included in the report)
"KRN",.84,7981006.001,2,159,0)
  </td>
"KRN",.84,7981006.001,2,160,0)
 </tr>
"KRN",.84,7981006.001,2,161,0)
</xsl:template>
"KRN",.84,7981006.001,2,162,0)
 
"KRN",.84,7981006.001,2,163,0)
</xsl:stylesheet>
"KRN",.84,7981006.002,-1)
0^35
"KRN",.84,7981006.002,0)
7981006.002^2^^CLINICAL CASE REGISTRIES^Laboratory Utilization (CSV)
"KRN",.84,7981006.002,2,0)
^.844^66^66^3050919^^^
"KRN",.84,7981006.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981006.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981006.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981006.002,2,4,0)
>
"KRN",.84,7981006.002,2,5,0)
 
"KRN",.84,7981006.002,2,6,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981006.002,2,7,0)
 
"KRN",.84,7981006.002,2,8,0)
<xsl:variable name="UTILIZATION_HEADER"                                         
"KRN",.84,7981006.002,2,9,0)
     select="'Laboratory Utilization'"/>
"KRN",.84,7981006.002,2,10,0)
 
"KRN",.84,7981006.002,2,11,0)
<xsl:template match="/">
"KRN",.84,7981006.002,2,12,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981006.002,2,13,0)
  <xsl:with-param name="data" select="REPORT/RESULTS"/>
"KRN",.84,7981006.002,2,14,0)
  <xsl:with-param name="subttl" select="'Results'"/>
"KRN",.84,7981006.002,2,15,0)
 </xsl:call-template>
"KRN",.84,7981006.002,2,16,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981006.002,2,17,0)
  <xsl:with-param name="data" select="REPORT/LABTESTS"/>
"KRN",.84,7981006.002,2,18,0)
  <xsl:with-param name="subttl" select="'Laboratory Tests'"/>
"KRN",.84,7981006.002,2,19,0)
 </xsl:call-template>
"KRN",.84,7981006.002,2,20,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981006.002,2,21,0)
  <xsl:with-param name="data" select="REPORT/PATIENTS"/>
"KRN",.84,7981006.002,2,22,0)
  <xsl:with-param name="subttl" select="'Patients with Highest Utilization'"/>
"KRN",.84,7981006.002,2,23,0)
 </xsl:call-template>
"KRN",.84,7981006.002,2,24,0)
</xsl:template>
"KRN",.84,7981006.002,2,25,0)
 
"KRN",.84,7981006.002,2,26,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981006.002,2,27,0)
 
"KRN",.84,7981006.002,2,28,0)
<xsl:template match="COLUMN[@NAME='MAXNP']">
"KRN",.84,7981006.002,2,29,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.002,2,30,0)
  <xsl:with-param name="title"
"KRN",.84,7981006.002,2,31,0)
       select="'Number of Patients with Max. Utilization'"/>
"KRN",.84,7981006.002,2,32,0)
 </xsl:call-template>
"KRN",.84,7981006.002,2,33,0)
</xsl:template>
"KRN",.84,7981006.002,2,34,0)
 
"KRN",.84,7981006.002,2,35,0)
<xsl:template match="COLUMN[@NAME='MAXNRPP']">
"KRN",.84,7981006.002,2,36,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.002,2,37,0)
  <xsl:with-param name="title"
"KRN",.84,7981006.002,2,38,0)
       select="'Maximum Number of Results per Patient'"/>
"KRN",.84,7981006.002,2,39,0)
 </xsl:call-template>
"KRN",.84,7981006.002,2,40,0)
</xsl:template>
"KRN",.84,7981006.002,2,41,0)
 
"KRN",.84,7981006.002,2,42,0)
<xsl:template match="COLUMN[@NAME='NDT']">
"KRN",.84,7981006.002,2,43,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.002,2,44,0)
  <xsl:with-param name="title" select="'Number of Different Tests'"/>
"KRN",.84,7981006.002,2,45,0)
 </xsl:call-template>
"KRN",.84,7981006.002,2,46,0)
</xsl:template>
"KRN",.84,7981006.002,2,47,0)
 
"KRN",.84,7981006.002,2,48,0)
<xsl:template match="COLUMN[@NAME='NO']">
"KRN",.84,7981006.002,2,49,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.002,2,50,0)
  <xsl:with-param name="title" select="'Number of Orders'"/>
"KRN",.84,7981006.002,2,51,0)
 </xsl:call-template>
"KRN",.84,7981006.002,2,52,0)
</xsl:template>
"KRN",.84,7981006.002,2,53,0)
 
"KRN",.84,7981006.002,2,54,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981006.002,2,55,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.002,2,56,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981006.002,2,57,0)
 </xsl:call-template>
"KRN",.84,7981006.002,2,58,0)
</xsl:template>
"KRN",.84,7981006.002,2,59,0)
 
"KRN",.84,7981006.002,2,60,0)
<xsl:template match="COLUMN[@NAME='NR']">
"KRN",.84,7981006.002,2,61,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.002,2,62,0)
  <xsl:with-param name="title" select="'Number of Results'"/>
"KRN",.84,7981006.002,2,63,0)
 </xsl:call-template>
"KRN",.84,7981006.002,2,64,0)
</xsl:template>
"KRN",.84,7981006.002,2,65,0)
 
"KRN",.84,7981006.002,2,66,0)
</xsl:stylesheet>
"KRN",.84,7981007.001,-1)
0^36
"KRN",.84,7981007.001,0)
7981007.001^2^^CLINICAL CASE REGISTRIES^Radiology Utilization (HTML)
"KRN",.84,7981007.001,2,0)
^^123^123^3051127^
"KRN",.84,7981007.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981007.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981007.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981007.001,2,4,0)
>
"KRN",.84,7981007.001,2,5,0)
 
"KRN",.84,7981007.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981007.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981007.001,2,8,0)
 
"KRN",.84,7981007.001,2,9,0)
<xsl:template match="/">
"KRN",.84,7981007.001,2,10,0)
 <html>
"KRN",.84,7981007.001,2,11,0)
  <head>
"KRN",.84,7981007.001,2,12,0)
   <title>Radiology Utilization</title>
"KRN",.84,7981007.001,2,13,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981007.001,2,14,0)
  </head>
"KRN",.84,7981007.001,2,15,0)
  <body>
"KRN",.84,7981007.001,2,16,0)
   <h1>Radiology Utilization</h1>
"KRN",.84,7981007.001,2,17,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981007.001,2,18,0)
   <div style="page-break-before:always">
"KRN",.84,7981007.001,2,19,0)
    <xsl:call-template name="CategorySummary"/>
"KRN",.84,7981007.001,2,20,0)
    <xsl:apply-templates select="REPORT/PROCEDURES"/>
"KRN",.84,7981007.001,2,21,0)
    <xsl:apply-templates select="REPORT/PATIENTS"/>
"KRN",.84,7981007.001,2,22,0)
   </div>
"KRN",.84,7981007.001,2,23,0)
  </body>
"KRN",.84,7981007.001,2,24,0)
 </html>
"KRN",.84,7981007.001,2,25,0)
</xsl:template>
"KRN",.84,7981007.001,2,26,0)
 
"KRN",.84,7981007.001,2,27,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981007.001,2,28,0)
 <h3><xsl:call-template name="HUPatientsHeader"/> by number of procedures</h3>
"KRN",.84,7981007.001,2,29,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981007.001,2,30,0)
</xsl:template>
"KRN",.84,7981007.001,2,31,0)
 
"KRN",.84,7981007.001,2,32,0)
<xsl:template match="REPORT/PROCEDURES">
"KRN",.84,7981007.001,2,33,0)
 <xsl:variable name="minrpnum" select="/REPORT/PARAMETERS/MINRPNUM"/>
"KRN",.84,7981007.001,2,34,0)
 <h3>
"KRN",.84,7981007.001,2,35,0)
  Procedures performed
"KRN",.84,7981007.001,2,36,0)
  <xsl:choose>
"KRN",.84,7981007.001,2,37,0)
   <xsl:when test="$minrpnum>1">
"KRN",.84,7981007.001,2,38,0)
    <xsl:value-of select="$minrpnum"/> times or more
"KRN",.84,7981007.001,2,39,0)
   </xsl:when>
"KRN",.84,7981007.001,2,40,0)
   <xsl:otherwise>at least once</xsl:otherwise>
"KRN",.84,7981007.001,2,41,0)
  </xsl:choose>
"KRN",.84,7981007.001,2,42,0)
 </h3>
"KRN",.84,7981007.001,2,43,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981007.001,2,44,0)
</xsl:template>
"KRN",.84,7981007.001,2,45,0)
 
"KRN",.84,7981007.001,2,46,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981007.001,2,47,0)
 
"KRN",.84,7981007.001,2,48,0)
<xsl:template name="CategorySummary">
"KRN",.84,7981007.001,2,49,0)
 <table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981007.001,2,50,0)
  <thead>
"KRN",.84,7981007.001,2,51,0)
   <tr>
"KRN",.84,7981007.001,2,52,0)
    <th width="33%">Number of Patients</th>
"KRN",.84,7981007.001,2,53,0)
    <th width="33%">Number of Procedures</th>
"KRN",.84,7981007.001,2,54,0)
    <th width="33%">Number of Different Procedures</th>
"KRN",.84,7981007.001,2,55,0)
   </tr>
"KRN",.84,7981007.001,2,56,0)
  </thead>
"KRN",.84,7981007.001,2,57,0)
  <tbody>
"KRN",.84,7981007.001,2,58,0)
   <tr>
"KRN",.84,7981007.001,2,59,0)
    <td><xsl:value-of select="/REPORT/NP"/></td>
"KRN",.84,7981007.001,2,60,0)
    <td><xsl:value-of select="/REPORT/NPR"/></td>
"KRN",.84,7981007.001,2,61,0)
    <td><xsl:value-of select="/REPORT/NDP"/></td>
"KRN",.84,7981007.001,2,62,0)
   </tr>
"KRN",.84,7981007.001,2,63,0)
  </tbody>
"KRN",.84,7981007.001,2,64,0)
 </table>
"KRN",.84,7981007.001,2,65,0)
</xsl:template>
"KRN",.84,7981007.001,2,66,0)
 
"KRN",.84,7981007.001,2,67,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981007.001,2,68,0)
 
"KRN",.84,7981007.001,2,69,0)
<xsl:template match="COLUMN[@NAME='CPT']">
"KRN",.84,7981007.001,2,70,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.001,2,71,0)
  <xsl:with-param name="title" select="'CPT'"/>
"KRN",.84,7981007.001,2,72,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981007.001,2,73,0)
 </xsl:call-template>
"KRN",.84,7981007.001,2,74,0)
</xsl:template>
"KRN",.84,7981007.001,2,75,0)
 
"KRN",.84,7981007.001,2,76,0)
<xsl:template match="COLUMN[@NAME='PATIENTS']">
"KRN",.84,7981007.001,2,77,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.001,2,78,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981007.001,2,79,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981007.001,2,80,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981007.001,2,81,0)
 </xsl:call-template>
"KRN",.84,7981007.001,2,82,0)
</xsl:template>
"KRN",.84,7981007.001,2,83,0)
 
"KRN",.84,7981007.001,2,84,0)
<xsl:template match="COLUMN[@NAME='TOTAL']">
"KRN",.84,7981007.001,2,85,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.001,2,86,0)
  <xsl:with-param name="title" select="'Number of Procedures'"/>
"KRN",.84,7981007.001,2,87,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981007.001,2,88,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981007.001,2,89,0)
 </xsl:call-template>
"KRN",.84,7981007.001,2,90,0)
</xsl:template>
"KRN",.84,7981007.001,2,91,0)
 
"KRN",.84,7981007.001,2,92,0)
<xsl:template match="COLUMN[@NAME='UNIQUE']">
"KRN",.84,7981007.001,2,93,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.001,2,94,0)
  <xsl:with-param name="title" select="'Number of Different Procedures'"/>
"KRN",.84,7981007.001,2,95,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981007.001,2,96,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981007.001,2,97,0)
 </xsl:call-template>
"KRN",.84,7981007.001,2,98,0)
</xsl:template>
"KRN",.84,7981007.001,2,99,0)
 
"KRN",.84,7981007.001,2,100,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981007.001,2,101,0)
 
"KRN",.84,7981007.001,2,102,0)
<xsl:template match="PARAMETERS/MAXUTNUM">
"KRN",.84,7981007.001,2,103,0)
 <tr>
"KRN",.84,7981007.001,2,104,0)
  <th scope="row">MaxUtil:&#160;</th>
"KRN",.84,7981007.001,2,105,0)
  <td>
"KRN",.84,7981007.001,2,106,0)
   <xsl:value-of select="."/>
"KRN",.84,7981007.001,2,107,0)
   (maximum number of patients with highest utilization to display)
"KRN",.84,7981007.001,2,108,0)
  </td>
"KRN",.84,7981007.001,2,109,0)
 </tr>
"KRN",.84,7981007.001,2,110,0)
</xsl:template>
"KRN",.84,7981007.001,2,111,0)
 
"KRN",.84,7981007.001,2,112,0)
<xsl:template match="PARAMETERS/MINRPNUM">
"KRN",.84,7981007.001,2,113,0)
 <tr>
"KRN",.84,7981007.001,2,114,0)
  <th scope="row">MinProc:&#160;</th>
"KRN",.84,7981007.001,2,115,0)
  <td>
"KRN",.84,7981007.001,2,116,0)
   <xsl:value-of select="."/>
"KRN",.84,7981007.001,2,117,0)
   (minimum number of times a procedure should be performed
"KRN",.84,7981007.001,2,118,0)
   to be included in the report)
"KRN",.84,7981007.001,2,119,0)
  </td>
"KRN",.84,7981007.001,2,120,0)
 </tr>
"KRN",.84,7981007.001,2,121,0)
</xsl:template>
"KRN",.84,7981007.001,2,122,0)
 
"KRN",.84,7981007.001,2,123,0)
</xsl:stylesheet>
"KRN",.84,7981007.002,-1)
0^37
"KRN",.84,7981007.002,0)
7981007.002^2^^CLINICAL CASE REGISTRIES^Radiology Utilization (CSV)
"KRN",.84,7981007.002,2,0)
^^48^48^3050919^
"KRN",.84,7981007.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981007.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981007.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981007.002,2,4,0)
>
"KRN",.84,7981007.002,2,5,0)
 
"KRN",.84,7981007.002,2,6,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981007.002,2,7,0)
 
"KRN",.84,7981007.002,2,8,0)
<xsl:variable name="UTILIZATION_HEADER"                                         
"KRN",.84,7981007.002,2,9,0)
     select="'Radiology Utilization'"/>
"KRN",.84,7981007.002,2,10,0)
 
"KRN",.84,7981007.002,2,11,0)
<xsl:template match="/">
"KRN",.84,7981007.002,2,12,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981007.002,2,13,0)
  <xsl:with-param name="data" select="REPORT/PROCEDURES"/>
"KRN",.84,7981007.002,2,14,0)
  <xsl:with-param name="subttl" select="'Procedures'"/>
"KRN",.84,7981007.002,2,15,0)
 </xsl:call-template>
"KRN",.84,7981007.002,2,16,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981007.002,2,17,0)
  <xsl:with-param name="data" select="REPORT/PATIENTS"/>
"KRN",.84,7981007.002,2,18,0)
  <xsl:with-param name="subttl" select="'Patients with highest utilization'"/>
"KRN",.84,7981007.002,2,19,0)
 </xsl:call-template>
"KRN",.84,7981007.002,2,20,0)
</xsl:template>
"KRN",.84,7981007.002,2,21,0)
 
"KRN",.84,7981007.002,2,22,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981007.002,2,23,0)
 
"KRN",.84,7981007.002,2,24,0)
<xsl:template match="COLUMN[@NAME='CPT']">
"KRN",.84,7981007.002,2,25,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.002,2,26,0)
  <xsl:with-param name="title" select="'CPT'"/>
"KRN",.84,7981007.002,2,27,0)
 </xsl:call-template>
"KRN",.84,7981007.002,2,28,0)
</xsl:template>
"KRN",.84,7981007.002,2,29,0)
 
"KRN",.84,7981007.002,2,30,0)
<xsl:template match="COLUMN[@NAME='PATIENTS']">
"KRN",.84,7981007.002,2,31,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.002,2,32,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981007.002,2,33,0)
 </xsl:call-template>
"KRN",.84,7981007.002,2,34,0)
</xsl:template>
"KRN",.84,7981007.002,2,35,0)
 
"KRN",.84,7981007.002,2,36,0)
<xsl:template match="COLUMN[@NAME='TOTAL']">
"KRN",.84,7981007.002,2,37,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.002,2,38,0)
  <xsl:with-param name="title" select="'Number of Procedures'"/>
"KRN",.84,7981007.002,2,39,0)
 </xsl:call-template>
"KRN",.84,7981007.002,2,40,0)
</xsl:template>
"KRN",.84,7981007.002,2,41,0)
 
"KRN",.84,7981007.002,2,42,0)
<xsl:template match="COLUMN[@NAME='UNIQUE']">
"KRN",.84,7981007.002,2,43,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.002,2,44,0)
  <xsl:with-param name="title" select="'Number of Different Procedures'"/>
"KRN",.84,7981007.002,2,45,0)
 </xsl:call-template>
"KRN",.84,7981007.002,2,46,0)
</xsl:template>
"KRN",.84,7981007.002,2,47,0)
 
"KRN",.84,7981007.002,2,48,0)
</xsl:stylesheet>
"KRN",.84,7981008.001,-1)
0^1
"KRN",.84,7981008.001,0)
7981008.001^2^^CLINICAL CASE REGISTRIES^VERA Reimbursement Report (HTML)
"KRN",.84,7981008.001,2,0)
^^117^117^3051006^
"KRN",.84,7981008.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981008.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981008.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981008.001,2,4,0)
>
"KRN",.84,7981008.001,2,5,0)
 
"KRN",.84,7981008.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981008.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981008.001,2,8,0)
<xsl:import  href="template://report/996/1"/>  <!-- Pharmacy -->
"KRN",.84,7981008.001,2,9,0)
 
"KRN",.84,7981008.001,2,10,0)
<xsl:template match="/">
"KRN",.84,7981008.001,2,11,0)
 <html>
"KRN",.84,7981008.001,2,12,0)
  <head>
"KRN",.84,7981008.001,2,13,0)
   <title>VERA Reimbursement Report</title>
"KRN",.84,7981008.001,2,14,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981008.001,2,15,0)
  </head>
"KRN",.84,7981008.001,2,16,0)
  <body>
"KRN",.84,7981008.001,2,17,0)
   <h1>VERA Reimbursement Report</h1>
"KRN",.84,7981008.001,2,18,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981008.001,2,19,0)
   <div style="page-break-before:always">
"KRN",.84,7981008.001,2,20,0)
    <xsl:call-template name="ReportSummary"/>
"KRN",.84,7981008.001,2,21,0)
    <xsl:apply-templates select="/REPORT/DRUGS"/>
"KRN",.84,7981008.001,2,22,0)
    <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981008.001,2,23,0)
   </div>
"KRN",.84,7981008.001,2,24,0)
  </body>
"KRN",.84,7981008.001,2,25,0)
 </html>
"KRN",.84,7981008.001,2,26,0)
</xsl:template>
"KRN",.84,7981008.001,2,27,0)
 
"KRN",.84,7981008.001,2,28,0)
<xsl:template match="REPORT/DRUGS">
"KRN",.84,7981008.001,2,29,0)
 <h2>ARV Drugs</h2>
"KRN",.84,7981008.001,2,30,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981008.001,2,31,0)
</xsl:template>
"KRN",.84,7981008.001,2,32,0)
 
"KRN",.84,7981008.001,2,33,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981008.001,2,34,0)
 <h2>Patients</h2>
"KRN",.84,7981008.001,2,35,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981008.001,2,36,0)
</xsl:template>
"KRN",.84,7981008.001,2,37,0)
 
"KRN",.84,7981008.001,2,38,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981008.001,2,39,0)
 
"KRN",.84,7981008.001,2,40,0)
<xsl:template match="COLUMN[@NAME='AIDSTAT']">
"KRN",.84,7981008.001,2,41,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981008.001,2,42,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.001,2,43,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981008.001,2,44,0)
  <xsl:with-param name="title" select="'AIDS&#160;OI'"/>
"KRN",.84,7981008.001,2,45,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981008.001,2,46,0)
 </xsl:call-template>
"KRN",.84,7981008.001,2,47,0)
</xsl:template>
"KRN",.84,7981008.001,2,48,0)
 
"KRN",.84,7981008.001,2,49,0)
<xsl:template match="COLUMN[@NAME='ARV']">
"KRN",.84,7981008.001,2,50,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.001,2,51,0)
  <xsl:with-param name="title" select="'ARV Drugs'"/>
"KRN",.84,7981008.001,2,52,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981008.001,2,53,0)
 </xsl:call-template>
"KRN",.84,7981008.001,2,54,0)
</xsl:template>
"KRN",.84,7981008.001,2,55,0)
 
"KRN",.84,7981008.001,2,56,0)
<xsl:template match="COLUMN[@NAME='COMPLEX']">
"KRN",.84,7981008.001,2,57,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.001,2,58,0)
  <xsl:with-param name="title" select="'Complex Care'"/>
"KRN",.84,7981008.001,2,59,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981008.001,2,60,0)
 </xsl:call-template>
"KRN",.84,7981008.001,2,61,0)
</xsl:template>
"KRN",.84,7981008.001,2,62,0)
 
"KRN",.84,7981008.001,2,63,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981008.001,2,64,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.001,2,65,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981008.001,2,66,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981008.001,2,67,0)
 </xsl:call-template>
"KRN",.84,7981008.001,2,68,0)
</xsl:template>
"KRN",.84,7981008.001,2,69,0)
 
"KRN",.84,7981008.001,2,70,0)
<xsl:template match="COLUMN[@NAME='NPAIDS']">
"KRN",.84,7981008.001,2,71,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.001,2,72,0)
  <xsl:with-param name="title" select="'Number of AIDS OI Patients'"/>
"KRN",.84,7981008.001,2,73,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981008.001,2,74,0)
 </xsl:call-template>
"KRN",.84,7981008.001,2,75,0)
</xsl:template>
"KRN",.84,7981008.001,2,76,0)
 
"KRN",.84,7981008.001,2,77,0)
<xsl:template match="COLUMN[@NAME='NPHIV']">
"KRN",.84,7981008.001,2,78,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.001,2,79,0)
  <xsl:with-param name="title"
"KRN",.84,7981008.001,2,80,0)
                  select="'Number of HIV+ (no AIDS OI) Patients'"/>
"KRN",.84,7981008.001,2,81,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981008.001,2,82,0)
 </xsl:call-template>
"KRN",.84,7981008.001,2,83,0)
</xsl:template>
"KRN",.84,7981008.001,2,84,0)
 
"KRN",.84,7981008.001,2,85,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981008.001,2,86,0)
 
"KRN",.84,7981008.001,2,87,0)
<xsl:template match="PATIENT/ARV|PATIENT/COMPLEX|PATIENT/AIDSTAT">
"KRN",.84,7981008.001,2,88,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981008.001,2,89,0)
  <xsl:with-param name="yesno" select="1"/>
"KRN",.84,7981008.001,2,90,0)
 </xsl:call-template>
"KRN",.84,7981008.001,2,91,0)
</xsl:template>
"KRN",.84,7981008.001,2,92,0)
 
"KRN",.84,7981008.001,2,93,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981008.001,2,94,0)
 
"KRN",.84,7981008.001,2,95,0)
<xsl:template name="ReportSummary">
"KRN",.84,7981008.001,2,96,0)
 <xsl:param name="summary" select="/REPORT/SUMMARY"/>
"KRN",.84,7981008.001,2,97,0)
 <table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981008.001,2,98,0)
  <thead>
"KRN",.84,7981008.001,2,99,0)
   <tr>
"KRN",.84,7981008.001,2,100,0)
    <th width="25%">Number of Patients</th>
"KRN",.84,7981008.001,2,101,0)
    <th width="25%">Number of Basic Care Patients</th>
"KRN",.84,7981008.001,2,102,0)
    <th width="25%">Number of Complex Care Patients</th>
"KRN",.84,7981008.001,2,103,0)
    <th width="25%">Number of Patients Received ARV Drugs</th>
"KRN",.84,7981008.001,2,104,0)
   </tr>
"KRN",.84,7981008.001,2,105,0)
  </thead>
"KRN",.84,7981008.001,2,106,0)
  <tbody>
"KRN",.84,7981008.001,2,107,0)
   <tr>
"KRN",.84,7981008.001,2,108,0)
    <td><xsl:value-of select="$summary/NP"/></td>
"KRN",.84,7981008.001,2,109,0)
    <td><xsl:value-of select="$summary/NPBASIC"/></td>
"KRN",.84,7981008.001,2,110,0)
    <td><xsl:value-of select="$summary/NPCOMPLEX"/></td>
"KRN",.84,7981008.001,2,111,0)
    <td><xsl:value-of select="$summary/NPARV"/></td>
"KRN",.84,7981008.001,2,112,0)
   </tr>
"KRN",.84,7981008.001,2,113,0)
  </tbody>
"KRN",.84,7981008.001,2,114,0)
 </table>
"KRN",.84,7981008.001,2,115,0)
</xsl:template>
"KRN",.84,7981008.001,2,116,0)
 
"KRN",.84,7981008.001,2,117,0)
</xsl:stylesheet>
"KRN",.84,7981008.002,-1)
0^2
"KRN",.84,7981008.002,0)
7981008.002^2^^CLINICAL CASE REGISTRIES^VERA Reimbursement Report (CSV)
"KRN",.84,7981008.002,2,0)
^^72^72^3051006^
"KRN",.84,7981008.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981008.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981008.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981008.002,2,4,0)
>
"KRN",.84,7981008.002,2,5,0)
 
"KRN",.84,7981008.002,2,6,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981008.002,2,7,0)
 
"KRN",.84,7981008.002,2,8,0)
<xsl:template match="/">
"KRN",.84,7981008.002,2,9,0)
 <xsl:apply-templates select="/REPORT/DRUGS"/>
"KRN",.84,7981008.002,2,10,0)
 <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981008.002,2,11,0)
</xsl:template>
"KRN",.84,7981008.002,2,12,0)
 
"KRN",.84,7981008.002,2,13,0)
<xsl:template match="REPORT/DRUGS">
"KRN",.84,7981008.002,2,14,0)
 <xsl:text>VERA Reimbursement Report (ARV Drugs)</xsl:text>
"KRN",.84,7981008.002,2,15,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981008.002,2,16,0)
 <xsl:value-of select="$FILESWITCH"/>
"KRN",.84,7981008.002,2,17,0)
</xsl:template>
"KRN",.84,7981008.002,2,18,0)
 
"KRN",.84,7981008.002,2,19,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981008.002,2,20,0)
 <xsl:text>VERA Reimbursement Report (Patients)</xsl:text>
"KRN",.84,7981008.002,2,21,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981008.002,2,22,0)
 <xsl:value-of select="$FILESWITCH"/>
"KRN",.84,7981008.002,2,23,0)
</xsl:template>
"KRN",.84,7981008.002,2,24,0)
 
"KRN",.84,7981008.002,2,25,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981008.002,2,26,0)
 
"KRN",.84,7981008.002,2,27,0)
<xsl:template match="COLUMN[@NAME='AIDSTAT']">
"KRN",.84,7981008.002,2,28,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.002,2,29,0)
  <xsl:with-param name="title" select="'AIDS OI'"/>
"KRN",.84,7981008.002,2,30,0)
 </xsl:call-template>
"KRN",.84,7981008.002,2,31,0)
</xsl:template>
"KRN",.84,7981008.002,2,32,0)
 
"KRN",.84,7981008.002,2,33,0)
<xsl:template match="COLUMN[@NAME='ARV']">
"KRN",.84,7981008.002,2,34,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.002,2,35,0)
  <xsl:with-param name="title" select="'ARV Drugs'"/>
"KRN",.84,7981008.002,2,36,0)
 </xsl:call-template>
"KRN",.84,7981008.002,2,37,0)
</xsl:template>
"KRN",.84,7981008.002,2,38,0)
 
"KRN",.84,7981008.002,2,39,0)
<xsl:template match="COLUMN[@NAME='COMPLEX']">
"KRN",.84,7981008.002,2,40,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.002,2,41,0)
  <xsl:with-param name="title" select="'Complex Care'"/>
"KRN",.84,7981008.002,2,42,0)
 </xsl:call-template>
"KRN",.84,7981008.002,2,43,0)
</xsl:template>
"KRN",.84,7981008.002,2,44,0)
 
"KRN",.84,7981008.002,2,45,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981008.002,2,46,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.002,2,47,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981008.002,2,48,0)
 </xsl:call-template>
"KRN",.84,7981008.002,2,49,0)
</xsl:template>
"KRN",.84,7981008.002,2,50,0)
 
"KRN",.84,7981008.002,2,51,0)
<xsl:template match="COLUMN[@NAME='NPAIDS']">
"KRN",.84,7981008.002,2,52,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.002,2,53,0)
  <xsl:with-param name="title" select="'Number of AIDS OI Patients'"/>
"KRN",.84,7981008.002,2,54,0)
 </xsl:call-template>
"KRN",.84,7981008.002,2,55,0)
</xsl:template>
"KRN",.84,7981008.002,2,56,0)
 
"KRN",.84,7981008.002,2,57,0)
<xsl:template match="COLUMN[@NAME='NPHIV']">
"KRN",.84,7981008.002,2,58,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.002,2,59,0)
  <xsl:with-param name="title"
"KRN",.84,7981008.002,2,60,0)
                  select="'Number of HIV+ (no AIDS OI) Patients'"/>
"KRN",.84,7981008.002,2,61,0)
 </xsl:call-template>
"KRN",.84,7981008.002,2,62,0)
</xsl:template>
"KRN",.84,7981008.002,2,63,0)
 
"KRN",.84,7981008.002,2,64,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981008.002,2,65,0)
 
"KRN",.84,7981008.002,2,66,0)
<xsl:template match="PATIENT/ARV|PATIENT/COMPLEX|PATIENT/AIDSTAT">
"KRN",.84,7981008.002,2,67,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981008.002,2,68,0)
  <xsl:with-param name="yesno" select="1"/>
"KRN",.84,7981008.002,2,69,0)
 </xsl:call-template>
"KRN",.84,7981008.002,2,70,0)
</xsl:template>
"KRN",.84,7981008.002,2,71,0)
 
"KRN",.84,7981008.002,2,72,0)
</xsl:stylesheet>
"KRN",.84,7981009.001,-1)
0^38
"KRN",.84,7981009.001,0)
7981009.001^2^^CLINICAL CASE REGISTRIES^Pharmacy Prescription Utilization (HTML)
"KRN",.84,7981009.001,2,0)
^^217^217^3051216^
"KRN",.84,7981009.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981009.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981009.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981009.001,2,4,0)
>
"KRN",.84,7981009.001,2,5,0)
 
"KRN",.84,7981009.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981009.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981009.001,2,8,0)
<xsl:import  href="template://report/996/1"/>  <!-- Pharmacy -->
"KRN",.84,7981009.001,2,9,0)
 
"KRN",.84,7981009.001,2,10,0)
<xsl:template match="/">
"KRN",.84,7981009.001,2,11,0)
 <html>
"KRN",.84,7981009.001,2,12,0)
  <head>
"KRN",.84,7981009.001,2,13,0)
   <title>Pharmacy Prescription Utilization</title>
"KRN",.84,7981009.001,2,14,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981009.001,2,15,0)
  </head>
"KRN",.84,7981009.001,2,16,0)
  <body>
"KRN",.84,7981009.001,2,17,0)
   <h1>Pharmacy Prescription Utilization</h1>
"KRN",.84,7981009.001,2,18,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981009.001,2,19,0)
   <xsl:choose>
"KRN",.84,7981009.001,2,20,0)
    <xsl:when test="/REPORT/INPATIENTS/*[1]|/REPORT/OUTPATIENTS/*[1]">
"KRN",.84,7981009.001,2,21,0)
     <xsl:apply-templates select="/REPORT/OUTPATIENTS"/>
"KRN",.84,7981009.001,2,22,0)
     <xsl:apply-templates select="/REPORT/INPATIENTS"/>
"KRN",.84,7981009.001,2,23,0)
     <xsl:apply-templates select="/REPORT/SUMMARY"/>
"KRN",.84,7981009.001,2,24,0)
    </xsl:when>
"KRN",.84,7981009.001,2,25,0)
    <xsl:otherwise>
"KRN",.84,7981009.001,2,26,0)
     <xsl:call-template name="TableNoData"/>
"KRN",.84,7981009.001,2,27,0)
    </xsl:otherwise>
"KRN",.84,7981009.001,2,28,0)
   </xsl:choose>
"KRN",.84,7981009.001,2,29,0)
  </body>
"KRN",.84,7981009.001,2,30,0)
 </html>
"KRN",.84,7981009.001,2,31,0)
</xsl:template>
"KRN",.84,7981009.001,2,32,0)
 
"KRN",.84,7981009.001,2,33,0)
<xsl:template match="REPORT/INPATIENTS">
"KRN",.84,7981009.001,2,34,0)
 <div style="page-break-before:always">
"KRN",.84,7981009.001,2,35,0)
  <h2>Selected Inpatient Activity</h2>
"KRN",.84,7981009.001,2,36,0)
  <xsl:call-template name="InpatientSummary"/>
"KRN",.84,7981009.001,2,37,0)
  <xsl:apply-templates select="*"/>
"KRN",.84,7981009.001,2,38,0)
 </div>
"KRN",.84,7981009.001,2,39,0)
</xsl:template>
"KRN",.84,7981009.001,2,40,0)
 
"KRN",.84,7981009.001,2,41,0)
<xsl:template match="REPORT/OUTPATIENTS">
"KRN",.84,7981009.001,2,42,0)
 <div style="page-break-before:always">
"KRN",.84,7981009.001,2,43,0)
  <h2>Selected Outpatient Activity</h2>
"KRN",.84,7981009.001,2,44,0)
  <xsl:call-template name="OutpatientSummary"/>
"KRN",.84,7981009.001,2,45,0)
  <xsl:apply-templates select="*"/>
"KRN",.84,7981009.001,2,46,0)
 </div>
"KRN",.84,7981009.001,2,47,0)
</xsl:template>
"KRN",.84,7981009.001,2,48,0)
 
"KRN",.84,7981009.001,2,49,0)
<xsl:template match="REPORT/SUMMARY/HU_NRX">
"KRN",.84,7981009.001,2,50,0)
 <div style="page-break-before:always">
"KRN",.84,7981009.001,2,51,0)
  <h2>Highest Combined OP and IP Utilization Summary</h2>
"KRN",.84,7981009.001,2,52,0)
  <xsl:call-template name="DataGrid"/>
"KRN",.84,7981009.001,2,53,0)
 </div>
"KRN",.84,7981009.001,2,54,0)
</xsl:template>
"KRN",.84,7981009.001,2,55,0)
 
"KRN",.84,7981009.001,2,56,0)
<xsl:template match="INPATIENTS/*">
"KRN",.84,7981009.001,2,57,0)
 <xsl:variable name="name" select="name(.)"/>
"KRN",.84,7981009.001,2,58,0)
 <xsl:choose>
"KRN",.84,7981009.001,2,59,0)
  <xsl:when test="$name='DOSES'">
"KRN",.84,7981009.001,2,60,0)
   <br clear="both"/>
"KRN",.84,7981009.001,2,61,0)
   <xsl:call-template name="DataGrid">
"KRN",.84,7981009.001,2,62,0)
    <xsl:with-param name="divstyle" select="'width:50%'"/>
"KRN",.84,7981009.001,2,63,0)
   </xsl:call-template>
"KRN",.84,7981009.001,2,64,0)
  </xsl:when>
"KRN",.84,7981009.001,2,65,0)
  <xsl:when test="$name='DRUGS_DOSES'">
"KRN",.84,7981009.001,2,66,0)
   <h3>Inpatient Medications</h3>
"KRN",.84,7981009.001,2,67,0)
   <xsl:call-template name="DataGrid"/>
"KRN",.84,7981009.001,2,68,0)
  </xsl:when>
"KRN",.84,7981009.001,2,69,0)
  <xsl:when test="$name='HU_DOSES'">
"KRN",.84,7981009.001,2,70,0)
   <h3><xsl:call-template name="HUPatientsHeader"/> by number of doses</h3>
"KRN",.84,7981009.001,2,71,0)
   <xsl:call-template name="DataGrid"/>
"KRN",.84,7981009.001,2,72,0)
  </xsl:when>
"KRN",.84,7981009.001,2,73,0)
 </xsl:choose>
"KRN",.84,7981009.001,2,74,0)
</xsl:template>
"KRN",.84,7981009.001,2,75,0)
 
"KRN",.84,7981009.001,2,76,0)
<xsl:template match="OUTPATIENTS/*">
"KRN",.84,7981009.001,2,77,0)
 <xsl:variable name="name" select="name(.)"/>
"KRN",.84,7981009.001,2,78,0)
 <xsl:choose>
"KRN",.84,7981009.001,2,79,0)
  <xsl:when test="$name='FILLS'">
"KRN",.84,7981009.001,2,80,0)
   <br clear="both"/>
"KRN",.84,7981009.001,2,81,0)
   <xsl:call-template name="DataGrid">
"KRN",.84,7981009.001,2,82,0)
    <xsl:with-param name="divstyle" select="'width:50%'"/>
"KRN",.84,7981009.001,2,83,0)
   </xsl:call-template>
"KRN",.84,7981009.001,2,84,0)
  </xsl:when>
"KRN",.84,7981009.001,2,85,0)
  <xsl:when test="$name='DRUGS_FILLS'">
"KRN",.84,7981009.001,2,86,0)
   <h3>Outpatient Medications</h3>
"KRN",.84,7981009.001,2,87,0)
   <xsl:call-template name="DataGrid"/>
"KRN",.84,7981009.001,2,88,0)
  </xsl:when>
"KRN",.84,7981009.001,2,89,0)
  <xsl:when test="$name='HU_FILLS'">
"KRN",.84,7981009.001,2,90,0)
   <h3><xsl:call-template name="HUPatientsHeader"/> by number of fills</h3>
"KRN",.84,7981009.001,2,91,0)
   <xsl:call-template name="DataGrid"/>
"KRN",.84,7981009.001,2,92,0)
  </xsl:when>
"KRN",.84,7981009.001,2,93,0)
 </xsl:choose>
"KRN",.84,7981009.001,2,94,0)
</xsl:template>
"KRN",.84,7981009.001,2,95,0)
 
"KRN",.84,7981009.001,2,96,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981009.001,2,97,0)
 
"KRN",.84,7981009.001,2,98,0)
<xsl:template name="InpatientSummary">
"KRN",.84,7981009.001,2,99,0)
 <xsl:variable name="IP" select="."/>
"KRN",.84,7981009.001,2,100,0)
 <table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981009.001,2,101,0)
  <thead>
"KRN",.84,7981009.001,2,102,0)
   <tr>
"KRN",.84,7981009.001,2,103,0)
    <th width="33%">Number of Patients</th>
"KRN",.84,7981009.001,2,104,0)
    <th width="33%">Number of Doses</th>
"KRN",.84,7981009.001,2,105,0)
    <th width="33%">Number of Different Medications</th>
"KRN",.84,7981009.001,2,106,0)
   </tr>
"KRN",.84,7981009.001,2,107,0)
  </thead>
"KRN",.84,7981009.001,2,108,0)
  <tbody>
"KRN",.84,7981009.001,2,109,0)
   <tr>
"KRN",.84,7981009.001,2,110,0)
    <td><xsl:value-of select="$IP/NP"/></td>
"KRN",.84,7981009.001,2,111,0)
    <td><xsl:value-of select="$IP/IPNRX"/></td>
"KRN",.84,7981009.001,2,112,0)
    <td><xsl:value-of select="$IP/ND"/></td>
"KRN",.84,7981009.001,2,113,0)
   </tr>
"KRN",.84,7981009.001,2,114,0)
  </tbody>
"KRN",.84,7981009.001,2,115,0)
 </table>
"KRN",.84,7981009.001,2,116,0)
</xsl:template>
"KRN",.84,7981009.001,2,117,0)
 
"KRN",.84,7981009.001,2,118,0)
<xsl:template name="OutpatientSummary">
"KRN",.84,7981009.001,2,119,0)
 <xsl:variable name="OP" select="."/>
"KRN",.84,7981009.001,2,120,0)
 <table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981009.001,2,121,0)
  <thead>
"KRN",.84,7981009.001,2,122,0)
   <tr>
"KRN",.84,7981009.001,2,123,0)
    <th width="33%">Number of Patients</th>
"KRN",.84,7981009.001,2,124,0)
    <th width="33%">Number of Fills</th>
"KRN",.84,7981009.001,2,125,0)
    <th width="33%">Number of Different Medications</th>
"KRN",.84,7981009.001,2,126,0)
   </tr>
"KRN",.84,7981009.001,2,127,0)
  </thead>
"KRN",.84,7981009.001,2,128,0)
  <tbody>
"KRN",.84,7981009.001,2,129,0)
   <tr>
"KRN",.84,7981009.001,2,130,0)
    <td><xsl:value-of select="$OP/NP"/></td>
"KRN",.84,7981009.001,2,131,0)
    <td><xsl:value-of select="$OP/OPNRX"/></td>
"KRN",.84,7981009.001,2,132,0)
    <td><xsl:value-of select="$OP/ND"/></td>
"KRN",.84,7981009.001,2,133,0)
   </tr>
"KRN",.84,7981009.001,2,134,0)
  </tbody>
"KRN",.84,7981009.001,2,135,0)
 </table>
"KRN",.84,7981009.001,2,136,0)
</xsl:template>
"KRN",.84,7981009.001,2,137,0)
 
"KRN",.84,7981009.001,2,138,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981009.001,2,139,0)
 
"KRN",.84,7981009.001,2,140,0)
<xsl:template match="COLUMN[@NAME='IPNRX']">
"KRN",.84,7981009.001,2,141,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,142,0)
  <xsl:with-param name="title" select="'Number of Doses'"/>
"KRN",.84,7981009.001,2,143,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981009.001,2,144,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981009.001,2,145,0)
 </xsl:call-template> 
"KRN",.84,7981009.001,2,146,0)
</xsl:template>
"KRN",.84,7981009.001,2,147,0)
 
"KRN",.84,7981009.001,2,148,0)
<xsl:template match="COLUMN[@NAME='MAXNP']">
"KRN",.84,7981009.001,2,149,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,150,0)
  <xsl:with-param name="title"
"KRN",.84,7981009.001,2,151,0)
       select="'Number of Patients with Max. Utilization'"/>
"KRN",.84,7981009.001,2,152,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981009.001,2,153,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981009.001,2,154,0)
 </xsl:call-template>
"KRN",.84,7981009.001,2,155,0)
</xsl:template>
"KRN",.84,7981009.001,2,156,0)
 
"KRN",.84,7981009.001,2,157,0)
<xsl:template match="COLUMN[@NAME='MAXNRPP']">
"KRN",.84,7981009.001,2,158,0)
 <xsl:variable name="tblname" select="../@NAME"/>
"KRN",.84,7981009.001,2,159,0)
 <xsl:variable name="title">
"KRN",.84,7981009.001,2,160,0)
  <xsl:text>Maximum Number of </xsl:text>
"KRN",.84,7981009.001,2,161,0)
  <xsl:choose>
"KRN",.84,7981009.001,2,162,0)
   <xsl:when test="contains($tblname,'DOSE')">Doses</xsl:when>
"KRN",.84,7981009.001,2,163,0)
   <xsl:when test="contains($tblname,'FILL')">Fills</xsl:when>
"KRN",.84,7981009.001,2,164,0)
   <xsl:otherwise>Doses/Fills</xsl:otherwise>
"KRN",.84,7981009.001,2,165,0)
  </xsl:choose>
"KRN",.84,7981009.001,2,166,0)
  <xsl:text> per Patient</xsl:text>
"KRN",.84,7981009.001,2,167,0)
 </xsl:variable>
"KRN",.84,7981009.001,2,168,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,169,0)
  <xsl:with-param name="title" select="$title"/>
"KRN",.84,7981009.001,2,170,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981009.001,2,171,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981009.001,2,172,0)
 </xsl:call-template>
"KRN",.84,7981009.001,2,173,0)
</xsl:template>
"KRN",.84,7981009.001,2,174,0)
 
"KRN",.84,7981009.001,2,175,0)
<xsl:template match="TBLDEF[contains(@NAME,'HU_')]/COLUMN[@NAME='NAME']">
"KRN",.84,7981009.001,2,176,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,177,0)
  <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981009.001,2,178,0)
 </xsl:call-template>
"KRN",.84,7981009.001,2,179,0)
</xsl:template>
"KRN",.84,7981009.001,2,180,0)
 
"KRN",.84,7981009.001,2,181,0)
<xsl:template match="COLUMN[@NAME='ND']">
"KRN",.84,7981009.001,2,182,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,183,0)
  <xsl:with-param name="title" select="'Number of Different Medications'"/>
"KRN",.84,7981009.001,2,184,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981009.001,2,185,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981009.001,2,186,0)
 </xsl:call-template>
"KRN",.84,7981009.001,2,187,0)
</xsl:template>
"KRN",.84,7981009.001,2,188,0)
 
"KRN",.84,7981009.001,2,189,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981009.001,2,190,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,191,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981009.001,2,192,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981009.001,2,193,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981009.001,2,194,0)
 </xsl:call-template>
"KRN",.84,7981009.001,2,195,0)
</xsl:template>
"KRN",.84,7981009.001,2,196,0)
 
"KRN",.84,7981009.001,2,197,0)
<xsl:template match="COLUMN[@NAME='OPNRX']">
"KRN",.84,7981009.001,2,198,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,199,0)
  <xsl:with-param name="title" select="'Number of Fills'"/>
"KRN",.84,7981009.001,2,200,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981009.001,2,201,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981009.001,2,202,0)
 </xsl:call-template> 
"KRN",.84,7981009.001,2,203,0)
</xsl:template>
"KRN",.84,7981009.001,2,204,0)
 
"KRN",.84,7981009.001,2,205,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981009.001,2,206,0)
 
"KRN",.84,7981009.001,2,207,0)
<xsl:template match="PARAMETERS/MAXUTNUM">
"KRN",.84,7981009.001,2,208,0)
 <tr>
"KRN",.84,7981009.001,2,209,0)
  <th scope="row">MaxUtil:&#160;</th>
"KRN",.84,7981009.001,2,210,0)
  <td>
"KRN",.84,7981009.001,2,211,0)
   <xsl:value-of select="."/>
"KRN",.84,7981009.001,2,212,0)
   (maximum number of patients with highest utilization to display)
"KRN",.84,7981009.001,2,213,0)
  </td>
"KRN",.84,7981009.001,2,214,0)
 </tr>
"KRN",.84,7981009.001,2,215,0)
</xsl:template>
"KRN",.84,7981009.001,2,216,0)
 
"KRN",.84,7981009.001,2,217,0)
</xsl:stylesheet>
"KRN",.84,7981009.002,-1)
0^39
"KRN",.84,7981009.002,0)
7981009.002^2^^CLINICAL CASE REGISTRIES^Pharmacy Prescription Utilization (CSV)
"KRN",.84,7981009.002,2,0)
^^98^98^3051221^
"KRN",.84,7981009.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981009.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981009.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981009.002,2,4,0)
>
"KRN",.84,7981009.002,2,5,0)
 
"KRN",.84,7981009.002,2,6,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981009.002,2,7,0)
 
"KRN",.84,7981009.002,2,8,0)
<xsl:variable name="UTILIZATION_HEADER"                                         
"KRN",.84,7981009.002,2,9,0)
     select="'Pharmacy Prescription Utilization'"/>
"KRN",.84,7981009.002,2,10,0)
 
"KRN",.84,7981009.002,2,11,0)
<xsl:template match="/">
"KRN",.84,7981009.002,2,12,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,13,0)
  <xsl:with-param name="subttl" select="'Fills'"/>
"KRN",.84,7981009.002,2,14,0)
  <xsl:with-param name="data" select="REPORT/OUTPATIENTS/FILLS"/>
"KRN",.84,7981009.002,2,15,0)
 </xsl:call-template>
"KRN",.84,7981009.002,2,16,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,17,0)
  <xsl:with-param name="subttl" select="'Outpatient Medications'"/>
"KRN",.84,7981009.002,2,18,0)
  <xsl:with-param name="data" select="REPORT/OUTPATIENTS/DRUGS_FILLS"/>
"KRN",.84,7981009.002,2,19,0)
 </xsl:call-template>
"KRN",.84,7981009.002,2,20,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,21,0)
  <xsl:with-param name="subttl"
"KRN",.84,7981009.002,2,22,0)
       select="'Patients with Highest Utilization of Fills'"/>
"KRN",.84,7981009.002,2,23,0)
  <xsl:with-param name="data" select="REPORT/OUTPATIENTS/HU_FILLS"/>
"KRN",.84,7981009.002,2,24,0)
 </xsl:call-template>
"KRN",.84,7981009.002,2,25,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,26,0)
  <xsl:with-param name="subttl" select="'Doses'"/>
"KRN",.84,7981009.002,2,27,0)
  <xsl:with-param name="data" select="REPORT/INPATIENTS/DOSES"/>
"KRN",.84,7981009.002,2,28,0)
 </xsl:call-template>
"KRN",.84,7981009.002,2,29,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,30,0)
  <xsl:with-param name="subttl" select="'Inpatient Medications'"/>
"KRN",.84,7981009.002,2,31,0)
  <xsl:with-param name="data" select="REPORT/INPATIENTS/DRUGS_DOSES"/>
"KRN",.84,7981009.002,2,32,0)
 </xsl:call-template>
"KRN",.84,7981009.002,2,33,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,34,0)
  <xsl:with-param name="subttl"
"KRN",.84,7981009.002,2,35,0)
       select="'Patients with Highest Utilization of Doses'"/>
"KRN",.84,7981009.002,2,36,0)
  <xsl:with-param name="data" select="REPORT/INPATIENTS/HU_DOSES"/>
"KRN",.84,7981009.002,2,37,0)
 </xsl:call-template>
"KRN",.84,7981009.002,2,38,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,39,0)
  <xsl:with-param name="subttl"
"KRN",.84,7981009.002,2,40,0)
       select="'Summary'"/>
"KRN",.84,7981009.002,2,41,0)
  <xsl:with-param name="data" select="REPORT/SUMMARY/HU_NRX"/>
"KRN",.84,7981009.002,2,42,0)
 </xsl:call-template>
"KRN",.84,7981009.002,2,43,0)
</xsl:template>
"KRN",.84,7981009.002,2,44,0)
 
"KRN",.84,7981009.002,2,45,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981009.002,2,46,0)
 
"KRN",.84,7981009.002,2,47,0)
<xsl:template match="COLUMN[@NAME='MAXNP']">
"KRN",.84,7981009.002,2,48,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,49,0)
  <xsl:with-param name="title"
"KRN",.84,7981009.002,2,50,0)
       select="'Number of Patients with Max. Utilization'"/>
"KRN",.84,7981009.002,2,51,0)
 </xsl:call-template>
"KRN",.84,7981009.002,2,52,0)
</xsl:template>
"KRN",.84,7981009.002,2,53,0)
 
"KRN",.84,7981009.002,2,54,0)
<xsl:template match="TBLDEF[@NAME='DRUGS_DOSES']/COLUMN[@NAME='MAXNRPP']">
"KRN",.84,7981009.002,2,55,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,56,0)
  <xsl:with-param name="title"
"KRN",.84,7981009.002,2,57,0)
       select="'Maximum Number of Doses per Patient'"/>
"KRN",.84,7981009.002,2,58,0)
 </xsl:call-template>
"KRN",.84,7981009.002,2,59,0)
</xsl:template>
"KRN",.84,7981009.002,2,60,0)
 
"KRN",.84,7981009.002,2,61,0)
<xsl:template match="TBLDEF[@NAME='DRUGS_FILLS']/COLUMN[@NAME='MAXNRPP']">
"KRN",.84,7981009.002,2,62,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,63,0)
  <xsl:with-param name="title"
"KRN",.84,7981009.002,2,64,0)
       select="'Maximum Number of Fills per Patient'"/>
"KRN",.84,7981009.002,2,65,0)
 </xsl:call-template>
"KRN",.84,7981009.002,2,66,0)
</xsl:template>
"KRN",.84,7981009.002,2,67,0)
 
"KRN",.84,7981009.002,2,68,0)
<xsl:template match="TBLDEF[contains(@NAME,'HU_')]/COLUMN[@NAME='NAME']">
"KRN",.84,7981009.002,2,69,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,70,0)
  <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981009.002,2,71,0)
 </xsl:call-template>
"KRN",.84,7981009.002,2,72,0)
</xsl:template>
"KRN",.84,7981009.002,2,73,0)
 
"KRN",.84,7981009.002,2,74,0)
<xsl:template match="COLUMN[@NAME='ND']">
"KRN",.84,7981009.002,2,75,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,76,0)
  <xsl:with-param name="title" select="'Number of Different Meds'"/>
"KRN",.84,7981009.002,2,77,0)
 </xsl:call-template>
"KRN",.84,7981009.002,2,78,0)
</xsl:template>
"KRN",.84,7981009.002,2,79,0)
 
"KRN",.84,7981009.002,2,80,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981009.002,2,81,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,82,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981009.002,2,83,0)
 </xsl:call-template>
"KRN",.84,7981009.002,2,84,0)
</xsl:template>
"KRN",.84,7981009.002,2,85,0)
 
"KRN",.84,7981009.002,2,86,0)
<xsl:template match="COLUMN[@NAME='IPNRX']">
"KRN",.84,7981009.002,2,87,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,88,0)
  <xsl:with-param name="title" select="'Number of Doses'"/>
"KRN",.84,7981009.002,2,89,0)
 </xsl:call-template> 
"KRN",.84,7981009.002,2,90,0)
</xsl:template>
"KRN",.84,7981009.002,2,91,0)
 
"KRN",.84,7981009.002,2,92,0)
<xsl:template match="COLUMN[@NAME='OPNRX']">
"KRN",.84,7981009.002,2,93,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,94,0)
  <xsl:with-param name="title" select="'Number of Fills'"/>
"KRN",.84,7981009.002,2,95,0)
 </xsl:call-template> 
"KRN",.84,7981009.002,2,96,0)
</xsl:template>
"KRN",.84,7981009.002,2,97,0)
 
"KRN",.84,7981009.002,2,98,0)
</xsl:stylesheet>
"KRN",.84,7981010.001,-1)
0^40
"KRN",.84,7981010.001,0)
7981010.001^2^^CLINICAL CASE REGISTRIES^Registry Lab Tests by Range (HTML)
"KRN",.84,7981010.001,2,0)
^.844^94^94^3051019^^^^
"KRN",.84,7981010.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981010.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981010.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981010.001,2,4,0)
>
"KRN",.84,7981010.001,2,5,0)
 
"KRN",.84,7981010.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981010.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981010.001,2,8,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->            
"KRN",.84,7981010.001,2,9,0)
<xsl:include href="template://report/995/1"/>  <!-- Lab Data -->
"KRN",.84,7981010.001,2,10,0)
 
"KRN",.84,7981010.001,2,11,0)
<xsl:template match="/">
"KRN",.84,7981010.001,2,12,0)
 <html>
"KRN",.84,7981010.001,2,13,0)
  <head>
"KRN",.84,7981010.001,2,14,0)
   <title>Registry Lab Tests by Range</title>
"KRN",.84,7981010.001,2,15,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981010.001,2,16,0)
  </head>
"KRN",.84,7981010.001,2,17,0)
  <body>
"KRN",.84,7981010.001,2,18,0)
   <h1>Registry Lab Tests by Range</h1>
"KRN",.84,7981010.001,2,19,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981010.001,2,20,0)
   <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981010.001,2,21,0)
  </body>
"KRN",.84,7981010.001,2,22,0)
 </html>
"KRN",.84,7981010.001,2,23,0)
</xsl:template>
"KRN",.84,7981010.001,2,24,0)
 
"KRN",.84,7981010.001,2,25,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981010.001,2,26,0)
 <div style="page-break-before:always">
"KRN",.84,7981010.001,2,27,0)
  <xsl:call-template name="DataGrid">
"KRN",.84,7981010.001,2,28,0)
   <xsl:with-param name="scroll" select="descendant::LT[31]"/>
"KRN",.84,7981010.001,2,29,0)
  </xsl:call-template>
"KRN",.84,7981010.001,2,30,0)
 </div>
"KRN",.84,7981010.001,2,31,0)
</xsl:template>
"KRN",.84,7981010.001,2,32,0)
 
"KRN",.84,7981010.001,2,33,0)
<!--[ TABLE HEADER ]-->
"KRN",.84,7981010.001,2,34,0)
 
"KRN",.84,7981010.001,2,35,0)
<xsl:template match="TBLDEF[@NAME='PATIENTS']/@HEADER">
"KRN",.84,7981010.001,2,36,0)
 <xsl:variable name="PTLRL" select="../COLUMN[@NAME='PTLRL']"/>
"KRN",.84,7981010.001,2,37,0)
 <thead>
"KRN",.84,7981010.001,2,38,0)
  <tr>
"KRN",.84,7981010.001,2,39,0)
   <xsl:call-template name="BasicPatientHeader">
"KRN",.84,7981010.001,2,40,0)
    <xsl:with-param name="rowspan" select="2"/>
"KRN",.84,7981010.001,2,41,0)
   </xsl:call-template>
"KRN",.84,7981010.001,2,42,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981010.001,2,43,0)
    <xsl:with-param name="column" select="$PTLRL"/>
"KRN",.84,7981010.001,2,44,0)
    <xsl:with-param name="colspan" select="4"/>
"KRN",.84,7981010.001,2,45,0)
    <xsl:with-param name="title" select="'Laboratory Tests'"/>                                  
"KRN",.84,7981010.001,2,46,0)
    <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981010.001,2,47,0)
    <xsl:with-param name="width" select="'60%'"/>
"KRN",.84,7981010.001,2,48,0)
   </xsl:call-template>
"KRN",.84,7981010.001,2,49,0)
  </tr>
"KRN",.84,7981010.001,2,50,0)
  <tr>
"KRN",.84,7981010.001,2,51,0)
   <xsl:call-template name="BasicLRHeader">
"KRN",.84,7981010.001,2,52,0)
    <xsl:with-param name="group" select="1"/>
"KRN",.84,7981010.001,2,53,0)
   </xsl:call-template>
"KRN",.84,7981010.001,2,54,0)
  </tr>
"KRN",.84,7981010.001,2,55,0)
 </thead>
"KRN",.84,7981010.001,2,56,0)
</xsl:template>
"KRN",.84,7981010.001,2,57,0)
 
"KRN",.84,7981010.001,2,58,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981010.001,2,59,0)
 
"KRN",.84,7981010.001,2,60,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981010.001,2,61,0)
 <xsl:variable name="rowspan" select="count(PTLRL/LT)"/>
"KRN",.84,7981010.001,2,62,0)
 <tr>
"KRN",.84,7981010.001,2,63,0)
  <xsl:call-template name="BasicPatientData">
"KRN",.84,7981010.001,2,64,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981010.001,2,65,0)
  </xsl:call-template>
"KRN",.84,7981010.001,2,66,0)
  <xsl:for-each select="PTLRL/LT[1]">
"KRN",.84,7981010.001,2,67,0)
   <xsl:call-template name="BasicLRData">
"KRN",.84,7981010.001,2,68,0)
    <xsl:with-param name="group" select="1"/>
"KRN",.84,7981010.001,2,69,0)
   </xsl:call-template>
"KRN",.84,7981010.001,2,70,0)
  </xsl:for-each>
"KRN",.84,7981010.001,2,71,0)
 </tr>
"KRN",.84,7981010.001,2,72,0)
 <xsl:for-each select="PTLRL/LT[position()>1]">
"KRN",.84,7981010.001,2,73,0)
  <tr>
"KRN",.84,7981010.001,2,74,0)
   <xsl:call-template name="BasicLRData">
"KRN",.84,7981010.001,2,75,0)
    <xsl:with-param name="group" select="1"/>
"KRN",.84,7981010.001,2,76,0)
   </xsl:call-template>
"KRN",.84,7981010.001,2,77,0)
  </tr>
"KRN",.84,7981010.001,2,78,0)
 </xsl:for-each>
"KRN",.84,7981010.001,2,79,0)
</xsl:template>
"KRN",.84,7981010.001,2,80,0)
 
"KRN",.84,7981010.001,2,81,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981010.001,2,82,0)
 
"KRN",.84,7981010.001,2,83,0)
<xsl:template match="PARAMETERS/LRGRANGES">
"KRN",.84,7981010.001,2,84,0)
 <tr>
"KRN",.84,7981010.001,2,85,0)
  <th scope="row">Lab Results:&#160;</th>
"KRN",.84,7981010.001,2,86,0)
  <td>
"KRN",.84,7981010.001,2,87,0)
   <xsl:for-each select="LRGRANGE">
"KRN",.84,7981010.001,2,88,0)
    <xsl:value-of select="."/><br/>
"KRN",.84,7981010.001,2,89,0)
   </xsl:for-each>
"KRN",.84,7981010.001,2,90,0)
  </td>
"KRN",.84,7981010.001,2,91,0)
 </tr>
"KRN",.84,7981010.001,2,92,0)
</xsl:template>
"KRN",.84,7981010.001,2,93,0)
 
"KRN",.84,7981010.001,2,94,0)
</xsl:stylesheet>
"KRN",.84,7981010.002,-1)
0^41
"KRN",.84,7981010.002,0)
7981010.002^2^^CLINICAL CASE REGISTRIES^Registry Lab Tests by Range (CSV)
"KRN",.84,7981010.002,2,0)
^^57^57^3051207^
"KRN",.84,7981010.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981010.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981010.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981010.002,2,4,0)
>
"KRN",.84,7981010.002,2,5,0)
 
"KRN",.84,7981010.002,2,6,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981010.002,2,7,0)
 
"KRN",.84,7981010.002,2,8,0)
<xsl:template match="/">
"KRN",.84,7981010.002,2,9,0)
 <xsl:text>Registry Lab Tests by Range</xsl:text>
"KRN",.84,7981010.002,2,10,0)
 <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981010.002,2,11,0)
</xsl:template>
"KRN",.84,7981010.002,2,12,0)
 
"KRN",.84,7981010.002,2,13,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981010.002,2,14,0)
 <xsl:variable name="ptname" select="NAME"/>
"KRN",.84,7981010.002,2,15,0)
 <xsl:variable name="ssn" select="LAST4"/>
"KRN",.84,7981010.002,2,16,0)
 <xsl:variable name="dod" select="DOD"/>
"KRN",.84,7981010.002,2,17,0)
 <xsl:for-each select="PTLRL/LT">
"KRN",.84,7981010.002,2,18,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,19,0)
   <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981010.002,2,20,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,21,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,22,0)
   <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981010.002,2,23,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,24,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,25,0)
   <xsl:with-param name="value" select="$dod"/>
"KRN",.84,7981010.002,2,26,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981010.002,2,27,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,28,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,29,0)
   <xsl:with-param name="value" select="GROUP"/>
"KRN",.84,7981010.002,2,30,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,31,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,32,0)
   <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981010.002,2,33,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981010.002,2,34,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,35,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,36,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981010.002,2,37,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,38,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,39,0)
   <xsl:with-param name="value" select="RESULT"/>
"KRN",.84,7981010.002,2,40,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,41,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981010.002,2,42,0)
 </xsl:for-each>
"KRN",.84,7981010.002,2,43,0)
</xsl:template>
"KRN",.84,7981010.002,2,44,0)
 
"KRN",.84,7981010.002,2,45,0)
<xsl:template match="COLUMN[@NAME='GROUP']">
"KRN",.84,7981010.002,2,46,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981010.002,2,47,0)
  <xsl:with-param name="title" select="'Group'"/>
"KRN",.84,7981010.002,2,48,0)
 </xsl:call-template>
"KRN",.84,7981010.002,2,49,0)
</xsl:template>
"KRN",.84,7981010.002,2,50,0)
 
"KRN",.84,7981010.002,2,51,0)
<xsl:template match="COLUMN[@NAME='RESULT']">
"KRN",.84,7981010.002,2,52,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981010.002,2,53,0)
  <xsl:with-param name="title" select="'Result'"/>
"KRN",.84,7981010.002,2,54,0)
 </xsl:call-template>
"KRN",.84,7981010.002,2,55,0)
</xsl:template>
"KRN",.84,7981010.002,2,56,0)
 
"KRN",.84,7981010.002,2,57,0)
</xsl:stylesheet>
"KRN",.84,7981011.001,-1)
0^42
"KRN",.84,7981011.001,0)
7981011.001^2^^CLINICAL CASE REGISTRIES^Patient Medication History (HTML)
"KRN",.84,7981011.001,2,0)
^^115^115^3051119^
"KRN",.84,7981011.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981011.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981011.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981011.001,2,4,0)
>
"KRN",.84,7981011.001,2,5,0)
 
"KRN",.84,7981011.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981011.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981011.001,2,8,0)
<xsl:import  href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,7981011.001,2,9,0)
<xsl:include href="template://report/996/1"/>  <!-- Pharmacy -->
"KRN",.84,7981011.001,2,10,0)
 
"KRN",.84,7981011.001,2,11,0)
<xsl:template match="/">
"KRN",.84,7981011.001,2,12,0)
 <html>
"KRN",.84,7981011.001,2,13,0)
  <head>
"KRN",.84,7981011.001,2,14,0)
   <title>Patient Medication History</title>
"KRN",.84,7981011.001,2,15,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981011.001,2,16,0)
  </head>
"KRN",.84,7981011.001,2,17,0)
  <body>
"KRN",.84,7981011.001,2,18,0)
   <h1>Patient Medication History</h1>
"KRN",.84,7981011.001,2,19,0)
   <xsl:call-template name="ReportHeader"/> 
"KRN",.84,7981011.001,2,20,0)
   <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981011.001,2,21,0)
  </body>
"KRN",.84,7981011.001,2,22,0)
 </html>
"KRN",.84,7981011.001,2,23,0)
</xsl:template>
"KRN",.84,7981011.001,2,24,0)
 
"KRN",.84,7981011.001,2,25,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981011.001,2,26,0)
 <div style="page-break-before:always">
"KRN",.84,7981011.001,2,27,0)
  <h2><xsl:value-of select="NAME"/></h2>
"KRN",.84,7981011.001,2,28,0)
  <table width="50%" cellpadding="5" cellspacing="0">
"KRN",.84,7981011.001,2,29,0)
   <tr>
"KRN",.84,7981011.001,2,30,0)
    <th width="25%">SSN</th>
"KRN",.84,7981011.001,2,31,0)
    <th width="25%">Date of Birth</th>
"KRN",.84,7981011.001,2,32,0)
    <th width="25%">Age</th>
"KRN",.84,7981011.001,2,33,0)
    <th width="25%">Date of Death</th>
"KRN",.84,7981011.001,2,34,0)
   </tr>
"KRN",.84,7981011.001,2,35,0)
   <tr>
"KRN",.84,7981011.001,2,36,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,37,0)
     <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981011.001,2,38,0)
    </xsl:call-template>
"KRN",.84,7981011.001,2,39,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,40,0)
     <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981011.001,2,41,0)
     <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981011.001,2,42,0)
    </xsl:call-template>
"KRN",.84,7981011.001,2,43,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,44,0)
     <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981011.001,2,45,0)
    </xsl:call-template>
"KRN",.84,7981011.001,2,46,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,47,0)
     <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981011.001,2,48,0)
     <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981011.001,2,49,0)
    </xsl:call-template>
"KRN",.84,7981011.001,2,50,0)
   </tr>
"KRN",.84,7981011.001,2,51,0)
  </table>
"KRN",.84,7981011.001,2,52,0)
  <h3>Drug History</h3>
"KRN",.84,7981011.001,2,53,0)
  <xsl:apply-templates select="PTRXL"/>
"KRN",.84,7981011.001,2,54,0)
 </div>
"KRN",.84,7981011.001,2,55,0)
</xsl:template>
"KRN",.84,7981011.001,2,56,0)
 
"KRN",.84,7981011.001,2,57,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981011.001,2,58,0)
 
"KRN",.84,7981011.001,2,59,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981011.001,2,60,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,61,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981011.001,2,62,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981011.001,2,63,0)
 </xsl:call-template>
"KRN",.84,7981011.001,2,64,0)
</xsl:template>
"KRN",.84,7981011.001,2,65,0)
 
"KRN",.84,7981011.001,2,66,0)
<xsl:template match="COLUMN[@NAME='DAYSPLY']">
"KRN",.84,7981011.001,2,67,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,68,0)
  <xsl:with-param name="title" select="'Days Supply'"/>
"KRN",.84,7981011.001,2,69,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981011.001,2,70,0)
 </xsl:call-template>
"KRN",.84,7981011.001,2,71,0)
</xsl:template>
"KRN",.84,7981011.001,2,72,0)
 
"KRN",.84,7981011.001,2,73,0)
<xsl:template match="COLUMN[@NAME='FILLTYPE']">
"KRN",.84,7981011.001,2,74,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,75,0)
  <xsl:with-param name="title" select="'Fill Type'"/>
"KRN",.84,7981011.001,2,76,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981011.001,2,77,0)
 </xsl:call-template>
"KRN",.84,7981011.001,2,78,0)
</xsl:template>
"KRN",.84,7981011.001,2,79,0)
 
"KRN",.84,7981011.001,2,80,0)
<xsl:template match="COLUMN[@NAME='GENERIC']">
"KRN",.84,7981011.001,2,81,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,82,0)
  <xsl:with-param name="title" select="'Generic Name'"/>
"KRN",.84,7981011.001,2,83,0)
 </xsl:call-template>
"KRN",.84,7981011.001,2,84,0)
</xsl:template>
"KRN",.84,7981011.001,2,85,0)
 
"KRN",.84,7981011.001,2,86,0)
<xsl:template match="COLUMN[@NAME='ORDER']">
"KRN",.84,7981011.001,2,87,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,88,0)
  <xsl:with-param name="title" select="'Rx#'"/>
"KRN",.84,7981011.001,2,89,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981011.001,2,90,0)
  <xsl:with-param name="sort" select="'PTRXL=ORDER'"/>
"KRN",.84,7981011.001,2,91,0)
 </xsl:call-template>
"KRN",.84,7981011.001,2,92,0)
</xsl:template>
"KRN",.84,7981011.001,2,93,0)
 
"KRN",.84,7981011.001,2,94,0)
<xsl:template match="COLUMN[@NAME='TYPE']">
"KRN",.84,7981011.001,2,95,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,96,0)
  <xsl:with-param name="title" select="'Type'"/>
"KRN",.84,7981011.001,2,97,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981011.001,2,98,0)
 </xsl:call-template>
"KRN",.84,7981011.001,2,99,0)
</xsl:template>
"KRN",.84,7981011.001,2,100,0)
 
"KRN",.84,7981011.001,2,101,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981011.001,2,102,0)
 
"KRN",.84,7981011.001,2,103,0)
<xsl:template match="DRUG/DATE">
"KRN",.84,7981011.001,2,104,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,105,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981011.001,2,106,0)
 </xsl:call-template>
"KRN",.84,7981011.001,2,107,0)
</xsl:template>
"KRN",.84,7981011.001,2,108,0)
 
"KRN",.84,7981011.001,2,109,0)
<xsl:template match="DRUG/GENERIC">
"KRN",.84,7981011.001,2,110,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,111,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981011.001,2,112,0)
 </xsl:call-template>
"KRN",.84,7981011.001,2,113,0)
</xsl:template>
"KRN",.84,7981011.001,2,114,0)
 
"KRN",.84,7981011.001,2,115,0)
</xsl:stylesheet>
"KRN",.84,7981011.002,-1)
0^43
"KRN",.84,7981011.002,0)
7981011.002^2^^CLINICAL CASE REGISTRIES^Patient Medication History (CSV)
"KRN",.84,7981011.002,2,0)
^^86^86^3051119^
"KRN",.84,7981011.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981011.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981011.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981011.002,2,4,0)
>
"KRN",.84,7981011.002,2,5,0)
 
"KRN",.84,7981011.002,2,6,0)
<xsl:import  href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981011.002,2,7,0)
<xsl:include href="template://report/997/2"/>  <!-- Patients -->
"KRN",.84,7981011.002,2,8,0)
 
"KRN",.84,7981011.002,2,9,0)
<xsl:template match="/">
"KRN",.84,7981011.002,2,10,0)
 <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981011.002,2,11,0)
</xsl:template>
"KRN",.84,7981011.002,2,12,0)
 
"KRN",.84,7981011.002,2,13,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981011.002,2,14,0)
 <xsl:text>Patient Medication History</xsl:text>
"KRN",.84,7981011.002,2,15,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981011.002,2,16,0)
 <xsl:text>Patient Name,SSN,Date of Birth,Age,Date of Death</xsl:text>
"KRN",.84,7981011.002,2,17,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981011.002,2,18,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,19,0)
  <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981011.002,2,20,0)
 </xsl:call-template>
"KRN",.84,7981011.002,2,21,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,22,0)
  <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981011.002,2,23,0)
 </xsl:call-template>
"KRN",.84,7981011.002,2,24,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,25,0)
  <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981011.002,2,26,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981011.002,2,27,0)
 </xsl:call-template>
"KRN",.84,7981011.002,2,28,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,29,0)
  <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981011.002,2,30,0)
 </xsl:call-template>
"KRN",.84,7981011.002,2,31,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,32,0)
  <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981011.002,2,33,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981011.002,2,34,0)
 </xsl:call-template>
"KRN",.84,7981011.002,2,35,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981011.002,2,36,0)
 <xsl:apply-templates select="PTRXL"/>
"KRN",.84,7981011.002,2,37,0)
 <xsl:value-of select="$FILESWITCH"/>
"KRN",.84,7981011.002,2,38,0)
</xsl:template>
"KRN",.84,7981011.002,2,39,0)
 
"KRN",.84,7981011.002,2,40,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981011.002,2,41,0)
 
"KRN",.84,7981011.002,2,42,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981011.002,2,43,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.002,2,44,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981011.002,2,45,0)
 </xsl:call-template>
"KRN",.84,7981011.002,2,46,0)
</xsl:template>
"KRN",.84,7981011.002,2,47,0)
 
"KRN",.84,7981011.002,2,48,0)
<xsl:template match="COLUMN[@NAME='DAYSPLY']">
"KRN",.84,7981011.002,2,49,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.002,2,50,0)
  <xsl:with-param name="title" select="'Days Supply'"/>
"KRN",.84,7981011.002,2,51,0)
 </xsl:call-template>
"KRN",.84,7981011.002,2,52,0)
</xsl:template>
"KRN",.84,7981011.002,2,53,0)
 
"KRN",.84,7981011.002,2,54,0)
<xsl:template match="COLUMN[@NAME='FILLTYPE']">
"KRN",.84,7981011.002,2,55,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.002,2,56,0)
  <xsl:with-param name="title" select="'Fill Type'"/>
"KRN",.84,7981011.002,2,57,0)
 </xsl:call-template>
"KRN",.84,7981011.002,2,58,0)
</xsl:template>
"KRN",.84,7981011.002,2,59,0)
 
"KRN",.84,7981011.002,2,60,0)
<xsl:template match="COLUMN[@NAME='GENERIC']">
"KRN",.84,7981011.002,2,61,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.002,2,62,0)
  <xsl:with-param name="title" select="'Generic Name'"/>
"KRN",.84,7981011.002,2,63,0)
 </xsl:call-template>
"KRN",.84,7981011.002,2,64,0)
</xsl:template>
"KRN",.84,7981011.002,2,65,0)
 
"KRN",.84,7981011.002,2,66,0)
<xsl:template match="COLUMN[@NAME='ORDER']">
"KRN",.84,7981011.002,2,67,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.002,2,68,0)
  <xsl:with-param name="title" select="'Rx#'"/>
"KRN",.84,7981011.002,2,69,0)
 </xsl:call-template>
"KRN",.84,7981011.002,2,70,0)
</xsl:template>
"KRN",.84,7981011.002,2,71,0)
 
"KRN",.84,7981011.002,2,72,0)
<xsl:template match="COLUMN[@NAME='TYPE']">
"KRN",.84,7981011.002,2,73,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.002,2,74,0)
  <xsl:with-param name="title" select="'Type'"/>
"KRN",.84,7981011.002,2,75,0)
 </xsl:call-template>
"KRN",.84,7981011.002,2,76,0)
</xsl:template>
"KRN",.84,7981011.002,2,77,0)
 
"KRN",.84,7981011.002,2,78,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981011.002,2,79,0)
 
"KRN",.84,7981011.002,2,80,0)
<xsl:template match="DRUG/DATE">
"KRN",.84,7981011.002,2,81,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,82,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981011.002,2,83,0)
 </xsl:call-template>
"KRN",.84,7981011.002,2,84,0)
</xsl:template>
"KRN",.84,7981011.002,2,85,0)
 
"KRN",.84,7981011.002,2,86,0)
</xsl:stylesheet>
"KRN",.84,7981012.001,-1)
0^44
"KRN",.84,7981012.001,0)
7981012.001^2^^CLINICAL CASE REGISTRIES^Combined Meds and Labs Report (HTML)
"KRN",.84,7981012.001,2,0)
^^243^243^3051119^
"KRN",.84,7981012.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981012.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981012.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981012.001,2,4,0)
>
"KRN",.84,7981012.001,2,5,0)
 
"KRN",.84,7981012.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981012.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981012.001,2,8,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->            
"KRN",.84,7981012.001,2,9,0)
<xsl:include href="template://report/996/1"/>  <!-- Pharmacy -->
"KRN",.84,7981012.001,2,10,0)
<xsl:include href="template://report/995/1"/>  <!-- Lab Data -->
"KRN",.84,7981012.001,2,11,0)
 
"KRN",.84,7981012.001,2,12,0)
<xsl:key name="patient-drug" match="/REPORT/DRUGS/DRUG"  use="@ID"/>
"KRN",.84,7981012.001,2,13,0)
<xsl:key name="patient-lt"   match="/REPORT/LABTESTS/LT" use="@ID"/>
"KRN",.84,7981012.001,2,14,0)
 
"KRN",.84,7981012.001,2,15,0)
<xsl:template match="/">
"KRN",.84,7981012.001,2,16,0)
 <html>
"KRN",.84,7981012.001,2,17,0)
  <head>
"KRN",.84,7981012.001,2,18,0)
   <title>Combined Meds and Labs Report</title>
"KRN",.84,7981012.001,2,19,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981012.001,2,20,0)
  </head>
"KRN",.84,7981012.001,2,21,0)
  <body>
"KRN",.84,7981012.001,2,22,0)
   <h1>Combined Meds and Labs Report</h1>
"KRN",.84,7981012.001,2,23,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981012.001,2,24,0)
   <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981012.001,2,25,0)
   <xsl:apply-templates select="/REPORT/DRUGS"/>
"KRN",.84,7981012.001,2,26,0)
   <xsl:apply-templates select="/REPORT/LABTESTS"/>
"KRN",.84,7981012.001,2,27,0)
   <xsl:if test="not(/REPORT/DRUGS|/REPORT/LABTESTS|/REPORT/PATIENTS)">
"KRN",.84,7981012.001,2,28,0)
    <xsl:call-template name="TableNoData"/>
"KRN",.84,7981012.001,2,29,0)
   </xsl:if>
"KRN",.84,7981012.001,2,30,0)
  </body>
"KRN",.84,7981012.001,2,31,0)
 </html>
"KRN",.84,7981012.001,2,32,0)
</xsl:template>
"KRN",.84,7981012.001,2,33,0)
 
"KRN",.84,7981012.001,2,34,0)
<!--[ TABLES ]-->
"KRN",.84,7981012.001,2,35,0)
 
"KRN",.84,7981012.001,2,36,0)
<xsl:template match="REPORT/DRUGS">
"KRN",.84,7981012.001,2,37,0)
 <div style="page-break-before:always">
"KRN",.84,7981012.001,2,38,0)
  <h2>Medications</h2>
"KRN",.84,7981012.001,2,39,0)
  <xsl:choose>
"KRN",.84,7981012.001,2,40,0)
   <xsl:when test="DRUG[1]">
"KRN",.84,7981012.001,2,41,0)
    <div>
"KRN",.84,7981012.001,2,42,0)
    <xsl:call-template name="MakeScrollable">
"KRN",.84,7981012.001,2,43,0)
     <xsl:with-param name="condition" select="DRUG[31]"/>
"KRN",.84,7981012.001,2,44,0)
    </xsl:call-template>
"KRN",.84,7981012.001,2,45,0)
     <table class="dataGrid" cellpadding="5" cellspacing="0">
"KRN",.84,7981012.001,2,46,0)
      <thead>
"KRN",.84,7981012.001,2,47,0)
       <tr>
"KRN",.84,7981012.001,2,48,0)
        <xsl:call-template name="BasicPatientHeader">
"KRN",.84,7981012.001,2,49,0)
         <xsl:with-param name="tblname" select="'DRUGS'"/>
"KRN",.84,7981012.001,2,50,0)
        </xsl:call-template>
"KRN",.84,7981012.001,2,51,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,52,0)
         <xsl:with-param name="colname" select="'RXNAME'"/>
"KRN",.84,7981012.001,2,53,0)
         <xsl:with-param name="sort" select="'DRUGS=RXNAME'"/>
"KRN",.84,7981012.001,2,54,0)
         <xsl:with-param name="title" select="'Medication Name'"/>
"KRN",.84,7981012.001,2,55,0)
        </xsl:call-template>
"KRN",.84,7981012.001,2,56,0)
       </tr>
"KRN",.84,7981012.001,2,57,0)
      </thead>
"KRN",.84,7981012.001,2,58,0)
      <xsl:call-template name="DataGridFooter">
"KRN",.84,7981012.001,2,59,0)
       <xsl:with-param name="colspan" select="5"/>
"KRN",.84,7981012.001,2,60,0)
      </xsl:call-template>
"KRN",.84,7981012.001,2,61,0)
      <tbody>
"KRN",.84,7981012.001,2,62,0)
       <xsl:choose>
"KRN",.84,7981012.001,2,63,0)
        <xsl:when test="contains(',DOD,LAST4,NAME,',concat(',',@SORT,','))">
"KRN",.84,7981012.001,2,64,0)
         <xsl:for-each select="DRUG[generate-id(.)=generate-id(key('patient-drug',@ID))]">
"KRN",.84,7981012.001,2,65,0)
          <xsl:call-template name="PatientDrugData">
"KRN",.84,7981012.001,2,66,0)
           <xsl:with-param name="group" select="key('patient-drug',@ID)"/>
"KRN",.84,7981012.001,2,67,0)
          </xsl:call-template>
"KRN",.84,7981012.001,2,68,0)
         </xsl:for-each>
"KRN",.84,7981012.001,2,69,0)
        </xsl:when>
"KRN",.84,7981012.001,2,70,0)
        <xsl:otherwise> 
"KRN",.84,7981012.001,2,71,0)
         <xsl:for-each select="DRUG">
"KRN",.84,7981012.001,2,72,0)
          <tr>
"KRN",.84,7981012.001,2,73,0)
           <xsl:call-template name="PatientData"/>
"KRN",.84,7981012.001,2,74,0)
           <xsl:call-template name="DrugData"/>
"KRN",.84,7981012.001,2,75,0)
          </tr>
"KRN",.84,7981012.001,2,76,0)
         </xsl:for-each>
"KRN",.84,7981012.001,2,77,0)
        </xsl:otherwise>
"KRN",.84,7981012.001,2,78,0)
       </xsl:choose>
"KRN",.84,7981012.001,2,79,0)
      </tbody>
"KRN",.84,7981012.001,2,80,0)
     </table>
"KRN",.84,7981012.001,2,81,0)
    </div>
"KRN",.84,7981012.001,2,82,0)
   </xsl:when>
"KRN",.84,7981012.001,2,83,0)
   <xsl:otherwise>
"KRN",.84,7981012.001,2,84,0)
    <xsl:call-template name="TableNoData"/>
"KRN",.84,7981012.001,2,85,0)
   </xsl:otherwise>
"KRN",.84,7981012.001,2,86,0)
  </xsl:choose>
"KRN",.84,7981012.001,2,87,0)
 </div>
"KRN",.84,7981012.001,2,88,0)
</xsl:template>
"KRN",.84,7981012.001,2,89,0)
 
"KRN",.84,7981012.001,2,90,0)
<xsl:template match="REPORT/LABTESTS">
"KRN",.84,7981012.001,2,91,0)
 <div style="page-break-before:always">
"KRN",.84,7981012.001,2,92,0)
  <h2>Lab Results</h2>
"KRN",.84,7981012.001,2,93,0)
  <xsl:choose>
"KRN",.84,7981012.001,2,94,0)
   <xsl:when test="LT[1]">
"KRN",.84,7981012.001,2,95,0)
    <div>
"KRN",.84,7981012.001,2,96,0)
    <xsl:call-template name="MakeScrollable">
"KRN",.84,7981012.001,2,97,0)
     <xsl:with-param name="condition" select="LT[31]"/>
"KRN",.84,7981012.001,2,98,0)
    </xsl:call-template>
"KRN",.84,7981012.001,2,99,0)
     <table class="dataGrid" cellpadding="5" cellspacing="0">
"KRN",.84,7981012.001,2,100,0)
      <thead>
"KRN",.84,7981012.001,2,101,0)
       <tr>
"KRN",.84,7981012.001,2,102,0)
        <xsl:call-template name="BasicPatientHeader">
"KRN",.84,7981012.001,2,103,0)
         <xsl:with-param name="tblname" select="'LABTESTS'"/>
"KRN",.84,7981012.001,2,104,0)
        </xsl:call-template>
"KRN",.84,7981012.001,2,105,0)
        <xsl:call-template name="BasicLRHeader">
"KRN",.84,7981012.001,2,106,0)
         <xsl:with-param name="colname" select="'LTNAME'"/>
"KRN",.84,7981012.001,2,107,0)
         <xsl:with-param name="tblname" select="'LABTESTS'"/>
"KRN",.84,7981012.001,2,108,0)
        </xsl:call-template>
"KRN",.84,7981012.001,2,109,0)
       </tr>
"KRN",.84,7981012.001,2,110,0)
      </thead>
"KRN",.84,7981012.001,2,111,0)
      <xsl:call-template name="DataGridFooter">
"KRN",.84,7981012.001,2,112,0)
       <xsl:with-param name="colspan" select="7"/>
"KRN",.84,7981012.001,2,113,0)
      </xsl:call-template>
"KRN",.84,7981012.001,2,114,0)
      <tbody>
"KRN",.84,7981012.001,2,115,0)
       <xsl:choose>
"KRN",.84,7981012.001,2,116,0)
        <xsl:when test="contains(',DOD,LAST4,NAME,',concat(',',@SORT,','))">
"KRN",.84,7981012.001,2,117,0)
         <xsl:for-each select="LT[generate-id(.)=generate-id(key('patient-lt',@ID))]">
"KRN",.84,7981012.001,2,118,0)
          <xsl:call-template name="PatientLabData">
"KRN",.84,7981012.001,2,119,0)
           <xsl:with-param name="group" select="key('patient-lt',@ID)"/>
"KRN",.84,7981012.001,2,120,0)
          </xsl:call-template>
"KRN",.84,7981012.001,2,121,0)
         </xsl:for-each>
"KRN",.84,7981012.001,2,122,0)
        </xsl:when>
"KRN",.84,7981012.001,2,123,0)
        <xsl:otherwise>
"KRN",.84,7981012.001,2,124,0)
         <xsl:for-each select="LT">
"KRN",.84,7981012.001,2,125,0)
          <tr>
"KRN",.84,7981012.001,2,126,0)
           <xsl:call-template name="PatientData"/>
"KRN",.84,7981012.001,2,127,0)
           <xsl:call-template name="BasicLRData">
"KRN",.84,7981012.001,2,128,0)
            <xsl:with-param name="name" select="LTNAME"/>
"KRN",.84,7981012.001,2,129,0)
           </xsl:call-template>
"KRN",.84,7981012.001,2,130,0)
          </tr>
"KRN",.84,7981012.001,2,131,0)
         </xsl:for-each>
"KRN",.84,7981012.001,2,132,0)
        </xsl:otherwise>
"KRN",.84,7981012.001,2,133,0)
       </xsl:choose>
"KRN",.84,7981012.001,2,134,0)
      </tbody>
"KRN",.84,7981012.001,2,135,0)
     </table>
"KRN",.84,7981012.001,2,136,0)
    </div>
"KRN",.84,7981012.001,2,137,0)
   </xsl:when>
"KRN",.84,7981012.001,2,138,0)
   <xsl:otherwise>
"KRN",.84,7981012.001,2,139,0)
    <xsl:call-template name="TableNoData"/>
"KRN",.84,7981012.001,2,140,0)
   </xsl:otherwise>
"KRN",.84,7981012.001,2,141,0)
  </xsl:choose>
"KRN",.84,7981012.001,2,142,0)
 </div>
"KRN",.84,7981012.001,2,143,0)
</xsl:template>
"KRN",.84,7981012.001,2,144,0)
 
"KRN",.84,7981012.001,2,145,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981012.001,2,146,0)
 <div style="page-break-before:always">
"KRN",.84,7981012.001,2,147,0)
  <h2>Patients</h2>
"KRN",.84,7981012.001,2,148,0)
  <xsl:call-template name="DataGrid"/>
"KRN",.84,7981012.001,2,149,0)
 </div>
"KRN",.84,7981012.001,2,150,0)
</xsl:template>
"KRN",.84,7981012.001,2,151,0)
 
"KRN",.84,7981012.001,2,152,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981012.001,2,153,0)
 
"KRN",.84,7981012.001,2,154,0)
<xsl:template name="DrugData">
"KRN",.84,7981012.001,2,155,0)
 <xsl:param name="rowspan" select="'1'"/>
"KRN",.84,7981012.001,2,156,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981012.001,2,157,0)
  <xsl:with-param name="value" select="RXNAME"/>
"KRN",.84,7981012.001,2,158,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981012.001,2,159,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981012.001,2,160,0)
 </xsl:call-template>
"KRN",.84,7981012.001,2,161,0)
</xsl:template>
"KRN",.84,7981012.001,2,162,0)
 
"KRN",.84,7981012.001,2,163,0)
<xsl:template name="PatientData">
"KRN",.84,7981012.001,2,164,0)
 <xsl:param name="number" select="position()"/>
"KRN",.84,7981012.001,2,165,0)
 <xsl:param name="ref"/>
"KRN",.84,7981012.001,2,166,0)
 <xsl:param name="rowspan" select="1"/>
"KRN",.84,7981012.001,2,167,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981012.001,2,168,0)
  <xsl:with-param name="value" select="$number"/>
"KRN",.84,7981012.001,2,169,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981012.001,2,170,0)
 </xsl:call-template>
"KRN",.84,7981012.001,2,171,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981012.001,2,172,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981012.001,2,173,0)
  <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981012.001,2,174,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981012.001,2,175,0)
 </xsl:call-template>
"KRN",.84,7981012.001,2,176,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981012.001,2,177,0)
  <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981012.001,2,178,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981012.001,2,179,0)
 </xsl:call-template>
"KRN",.84,7981012.001,2,180,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981012.001,2,181,0)
  <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981012.001,2,182,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981012.001,2,183,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981012.001,2,184,0)
 </xsl:call-template>
"KRN",.84,7981012.001,2,185,0)
</xsl:template>
"KRN",.84,7981012.001,2,186,0)
 
"KRN",.84,7981012.001,2,187,0)
<xsl:template name="PatientDrugData">
"KRN",.84,7981012.001,2,188,0)
 <xsl:param name="group"/>
"KRN",.84,7981012.001,2,189,0)
 <xsl:param name="number" select="position()"/>
"KRN",.84,7981012.001,2,190,0)
 <xsl:variable name="rowspan" select="count($group)"/>
"KRN",.84,7981012.001,2,191,0)
 <xsl:for-each select="$group">
"KRN",.84,7981012.001,2,192,0)
  <tr>
"KRN",.84,7981012.001,2,193,0)
   <xsl:if test="position()=1">
"KRN",.84,7981012.001,2,194,0)
    <xsl:call-template name="PatientData">
"KRN",.84,7981012.001,2,195,0)
     <xsl:with-param name="number" select="$number"/>
"KRN",.84,7981012.001,2,196,0)
     <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981012.001,2,197,0)
    </xsl:call-template>
"KRN",.84,7981012.001,2,198,0)
   </xsl:if>
"KRN",.84,7981012.001,2,199,0)
   <xsl:call-template name="DrugData"/>
"KRN",.84,7981012.001,2,200,0)
  </tr>
"KRN",.84,7981012.001,2,201,0)
 </xsl:for-each>
"KRN",.84,7981012.001,2,202,0)
</xsl:template>
"KRN",.84,7981012.001,2,203,0)
 
"KRN",.84,7981012.001,2,204,0)
<xsl:template name="PatientLabData">
"KRN",.84,7981012.001,2,205,0)
 <xsl:param name="group"/>
"KRN",.84,7981012.001,2,206,0)
 <xsl:param name="number" select="position()"/>
"KRN",.84,7981012.001,2,207,0)
 <xsl:variable name="rowspan" select="count($group)"/>
"KRN",.84,7981012.001,2,208,0)
 <xsl:for-each select="$group">
"KRN",.84,7981012.001,2,209,0)
  <tr>
"KRN",.84,7981012.001,2,210,0)
   <xsl:if test="position()=1">
"KRN",.84,7981012.001,2,211,0)
    <xsl:call-template name="PatientData">
"KRN",.84,7981012.001,2,212,0)
     <xsl:with-param name="number" select="$number"/>
"KRN",.84,7981012.001,2,213,0)
     <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981012.001,2,214,0)
    </xsl:call-template>
"KRN",.84,7981012.001,2,215,0)
   </xsl:if>
"KRN",.84,7981012.001,2,216,0)
   <xsl:call-template name="BasicLRData">
"KRN",.84,7981012.001,2,217,0)
    <xsl:with-param name="name" select="LTNAME"/>
"KRN",.84,7981012.001,2,218,0)
   </xsl:call-template>
"KRN",.84,7981012.001,2,219,0)
  </tr>
"KRN",.84,7981012.001,2,220,0)
 </xsl:for-each>
"KRN",.84,7981012.001,2,221,0)
</xsl:template>
"KRN",.84,7981012.001,2,222,0)
 
"KRN",.84,7981012.001,2,223,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981012.001,2,224,0)
 
"KRN",.84,7981012.001,2,225,0)
<xsl:template match="PARAMETERS/DATE_RANGE">
"KRN",.84,7981012.001,2,226,0)
 <xsl:call-template name="DateRange">
"KRN",.84,7981012.001,2,227,0)
  <xsl:with-param name="title" select="'Meds'"/>
"KRN",.84,7981012.001,2,228,0)
 </xsl:call-template>
"KRN",.84,7981012.001,2,229,0)
</xsl:template>
"KRN",.84,7981012.001,2,230,0)
 
"KRN",.84,7981012.001,2,231,0)
<xsl:template match="PARAMETERS/DATE_RANGE_2">
"KRN",.84,7981012.001,2,232,0)
 <xsl:call-template name="DateRange">
"KRN",.84,7981012.001,2,233,0)
  <xsl:with-param name="title" select="'Labs'"/>
"KRN",.84,7981012.001,2,234,0)
 </xsl:call-template>
"KRN",.84,7981012.001,2,235,0)
</xsl:template>
"KRN",.84,7981012.001,2,236,0)
 
"KRN",.84,7981012.001,2,237,0)
<xsl:template match="PARAMETERS/DATE_RANGE_3">
"KRN",.84,7981012.001,2,238,0)
 <xsl:call-template name="DateRange">
"KRN",.84,7981012.001,2,239,0)
  <xsl:with-param name="title" select="'Utilization'"/>
"KRN",.84,7981012.001,2,240,0)
 </xsl:call-template>
"KRN",.84,7981012.001,2,241,0)
</xsl:template>
"KRN",.84,7981012.001,2,242,0)
 
"KRN",.84,7981012.001,2,243,0)
</xsl:stylesheet>
"KRN",.84,7981012.002,-1)
0^45
"KRN",.84,7981012.002,0)
7981012.002^2^^CLINICAL CASE REGISTRIES^Combined Meds and Labs Report (CSV)
"KRN",.84,7981012.002,2,0)
^^91^91^3051207^
"KRN",.84,7981012.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981012.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981012.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981012.002,2,4,0)
>
"KRN",.84,7981012.002,2,5,0)
 
"KRN",.84,7981012.002,2,6,0)
<xsl:import  href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981012.002,2,7,0)
<xsl:include href="template://report/997/2"/>  <!-- Patients -->
"KRN",.84,7981012.002,2,8,0)
 
"KRN",.84,7981012.002,2,9,0)
<xsl:template match="/">
"KRN",.84,7981012.002,2,10,0)
 <xsl:apply-templates select="REPORT/DRUGS"/>
"KRN",.84,7981012.002,2,11,0)
 <xsl:apply-templates select="REPORT/LABTESTS"/>
"KRN",.84,7981012.002,2,12,0)
 <xsl:apply-templates select="REPORT/PATIENTS"/>
"KRN",.84,7981012.002,2,13,0)
</xsl:template>
"KRN",.84,7981012.002,2,14,0)
 
"KRN",.84,7981012.002,2,15,0)
<xsl:template match="REPORT/DRUGS">
"KRN",.84,7981012.002,2,16,0)
 <xsl:text>Combined Meds and Labs Report (Medications)</xsl:text>
"KRN",.84,7981012.002,2,17,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,18,0)
 <xsl:text>Patient Name,SSN,Date of Death,Medication Name</xsl:text>
"KRN",.84,7981012.002,2,19,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,20,0)
 <xsl:for-each select="DRUG">
"KRN",.84,7981012.002,2,21,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,22,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981012.002,2,23,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,24,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,25,0)
   <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981012.002,2,26,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,27,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,28,0)
   <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981012.002,2,29,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981012.002,2,30,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,31,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,32,0)
   <xsl:with-param name="value" select="RXNAME"/>
"KRN",.84,7981012.002,2,33,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,34,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,35,0)
 </xsl:for-each>
"KRN",.84,7981012.002,2,36,0)
 <xsl:value-of select="$FILESWITCH"/>
"KRN",.84,7981012.002,2,37,0)
</xsl:template>
"KRN",.84,7981012.002,2,38,0)
 
"KRN",.84,7981012.002,2,39,0)
<xsl:template match="REPORT/LABTESTS">
"KRN",.84,7981012.002,2,40,0)
 <xsl:text>Combined Meds and Labs Report (Lab Results)</xsl:text>
"KRN",.84,7981012.002,2,41,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,42,0)
 <xsl:text>Patient Name,SSN,Date of Death,Date,Test Name,Result</xsl:text>
"KRN",.84,7981012.002,2,43,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,44,0)
 <xsl:for-each select="LT">
"KRN",.84,7981012.002,2,45,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,46,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981012.002,2,47,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,48,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,49,0)
   <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981012.002,2,50,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,51,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,52,0)
   <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981012.002,2,53,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981012.002,2,54,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,55,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,56,0)
   <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981012.002,2,57,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981012.002,2,58,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,59,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,60,0)
   <xsl:with-param name="value" select="LTNAME"/>
"KRN",.84,7981012.002,2,61,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,62,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,63,0)
   <xsl:with-param name="value" select="RESULT"/>
"KRN",.84,7981012.002,2,64,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,65,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,66,0)
 </xsl:for-each>
"KRN",.84,7981012.002,2,67,0)
 <xsl:value-of select="$FILESWITCH"/>
"KRN",.84,7981012.002,2,68,0)
</xsl:template>
"KRN",.84,7981012.002,2,69,0)
 
"KRN",.84,7981012.002,2,70,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981012.002,2,71,0)
 <xsl:text>Combined Meds and Labs Report (Patients)</xsl:text>
"KRN",.84,7981012.002,2,72,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,73,0)
 <xsl:text>Patient Name,SSN,Date of Death</xsl:text>
"KRN",.84,7981012.002,2,74,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,75,0)
 <xsl:for-each select="PATIENT">
"KRN",.84,7981012.002,2,76,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,77,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981012.002,2,78,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,79,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,80,0)
   <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981012.002,2,81,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,82,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,83,0)
   <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981012.002,2,84,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981012.002,2,85,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,86,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,87,0)
 </xsl:for-each>
"KRN",.84,7981012.002,2,88,0)
 <xsl:value-of select="$FILESWITCH"/>
"KRN",.84,7981012.002,2,89,0)
</xsl:template>
"KRN",.84,7981012.002,2,90,0)
 
"KRN",.84,7981012.002,2,91,0)
</xsl:stylesheet>
"KRN",.84,7981013.001,-1)
0^46
"KRN",.84,7981013.001,0)
7981013.001^2^^CLINICAL CASE REGISTRIES^Diagnoses (HTML)
"KRN",.84,7981013.001,2,0)
^.844^199^199^3051026^^
"KRN",.84,7981013.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981013.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981013.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981013.001,2,4,0)
>
"KRN",.84,7981013.001,2,5,0)
 
"KRN",.84,7981013.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981013.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981013.001,2,8,0)
 
"KRN",.84,7981013.001,2,9,0)
<xsl:template match="/">
"KRN",.84,7981013.001,2,10,0)
 <html>
"KRN",.84,7981013.001,2,11,0)
  <head>
"KRN",.84,7981013.001,2,12,0)
   <title>Diagnoses</title>
"KRN",.84,7981013.001,2,13,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981013.001,2,14,0)
  </head>
"KRN",.84,7981013.001,2,15,0)
  <body>
"KRN",.84,7981013.001,2,16,0)
   <h1>Diagnoses</h1>
"KRN",.84,7981013.001,2,17,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981013.001,2,18,0)
   <div style="page-break-before:always">
"KRN",.84,7981013.001,2,19,0)
    <xsl:call-template name="ReportSummary"/>
"KRN",.84,7981013.001,2,20,0)
    <xsl:apply-templates select="/REPORT/ICD9LST"/>
"KRN",.84,7981013.001,2,21,0)
   </div>
"KRN",.84,7981013.001,2,22,0)
   <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981013.001,2,23,0)
  </body>
"KRN",.84,7981013.001,2,24,0)
 </html>
"KRN",.84,7981013.001,2,25,0)
</xsl:template>
"KRN",.84,7981013.001,2,26,0)
 
"KRN",.84,7981013.001,2,27,0)
<xsl:template match="REPORT/ICD9LST">
"KRN",.84,7981013.001,2,28,0)
 <h2>ICD-9 Codes</h2>
"KRN",.84,7981013.001,2,29,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981013.001,2,30,0)
</xsl:template>
"KRN",.84,7981013.001,2,31,0)
 
"KRN",.84,7981013.001,2,32,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981013.001,2,33,0)
 <div style="page-break-before:always">
"KRN",.84,7981013.001,2,34,0)
  <h2>Patients</h2>
"KRN",.84,7981013.001,2,35,0)
  <xsl:call-template name="DataGrid">
"KRN",.84,7981013.001,2,36,0)
   <xsl:with-param name="scroll" select="descendant::ICD9[31]"/>
"KRN",.84,7981013.001,2,37,0)
  </xsl:call-template>
"KRN",.84,7981013.001,2,38,0)
 </div>
"KRN",.84,7981013.001,2,39,0)
 <div class="reportSummary">
"KRN",.84,7981013.001,2,40,0)
  <div style="float:left; width:30%">
"KRN",.84,7981013.001,2,41,0)
   <table cellpadding="3" cellspacing="0">
"KRN",.84,7981013.001,2,42,0)
    <caption>Source</caption>
"KRN",.84,7981013.001,2,43,0)
    <thead>
"KRN",.84,7981013.001,2,44,0)
     <tr>
"KRN",.84,7981013.001,2,45,0)
      <th width="30">Code</th>
"KRN",.84,7981013.001,2,46,0)
      <th>Description</th>
"KRN",.84,7981013.001,2,47,0)
     </tr>
"KRN",.84,7981013.001,2,48,0)
    </thead>
"KRN",.84,7981013.001,2,49,0)
    <tbody>
"KRN",.84,7981013.001,2,50,0)
     <tr>
"KRN",.84,7981013.001,2,51,0)
      <td align="center">I</td>
"KRN",.84,7981013.001,2,52,0)
      <td class="aLeft">Inpatient file</td>
"KRN",.84,7981013.001,2,53,0)
     </tr>
"KRN",.84,7981013.001,2,54,0)
     <tr>
"KRN",.84,7981013.001,2,55,0)
      <td align="center">O</td>
"KRN",.84,7981013.001,2,56,0)
      <td class="aLeft">Outpatient file</td>
"KRN",.84,7981013.001,2,57,0)
     </tr>
"KRN",.84,7981013.001,2,58,0)
     <tr>
"KRN",.84,7981013.001,2,59,0)
      <td align="center">PB</td>
"KRN",.84,7981013.001,2,60,0)
      <td class="aLeft">Problem list</td>
"KRN",.84,7981013.001,2,61,0)
     </tr>
"KRN",.84,7981013.001,2,62,0)
    </tbody>
"KRN",.84,7981013.001,2,63,0)
   </table>
"KRN",.84,7981013.001,2,64,0)
  </div>
"KRN",.84,7981013.001,2,65,0)
 </div>
"KRN",.84,7981013.001,2,66,0)
</xsl:template>
"KRN",.84,7981013.001,2,67,0)
 
"KRN",.84,7981013.001,2,68,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981013.001,2,69,0)
 
"KRN",.84,7981013.001,2,70,0)
<xsl:template match="HEADER/TBLDEF[@NAME='PATIENTS']/@HEADER">
"KRN",.84,7981013.001,2,71,0)
 <xsl:variable name="PTICDL" select="../COLUMN[@NAME='PTICDL']"/>
"KRN",.84,7981013.001,2,72,0)
 <thead>
"KRN",.84,7981013.001,2,73,0)
  <tr>
"KRN",.84,7981013.001,2,74,0)
   <xsl:apply-templates select="../COLUMN[@NAME!='PTICDL']">
"KRN",.84,7981013.001,2,75,0)
    <xsl:with-param name="rowspan" select="2"/>
"KRN",.84,7981013.001,2,76,0)
   </xsl:apply-templates>
"KRN",.84,7981013.001,2,77,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,78,0)
    <xsl:with-param name="column" select="$PTICDL"/>
"KRN",.84,7981013.001,2,79,0)
    <xsl:with-param name="title" select="'ICD-9'"/>                 
"KRN",.84,7981013.001,2,80,0)
    <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981013.001,2,81,0)
    <xsl:with-param name="width" select="'52%'"/>
"KRN",.84,7981013.001,2,82,0)
    <xsl:with-param name="colspan" select="4"/>
"KRN",.84,7981013.001,2,83,0)
   </xsl:call-template>
"KRN",.84,7981013.001,2,84,0)
  </tr>
"KRN",.84,7981013.001,2,85,0)
  <tr>
"KRN",.84,7981013.001,2,86,0)
   <xsl:apply-templates select="$PTICDL/*"/>
"KRN",.84,7981013.001,2,87,0)
  </tr>
"KRN",.84,7981013.001,2,88,0)
 </thead>
"KRN",.84,7981013.001,2,89,0)
</xsl:template>
"KRN",.84,7981013.001,2,90,0)
 
"KRN",.84,7981013.001,2,91,0)
<xsl:template match="COLUMN[@NAME='CODE']">
"KRN",.84,7981013.001,2,92,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,93,0)
  <xsl:with-param name="title" select="'Code'"/>
"KRN",.84,7981013.001,2,94,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981013.001,2,95,0)
 </xsl:call-template>
"KRN",.84,7981013.001,2,96,0)
</xsl:template>
"KRN",.84,7981013.001,2,97,0)
 
"KRN",.84,7981013.001,2,98,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981013.001,2,99,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,100,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981013.001,2,101,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981013.001,2,102,0)
 </xsl:call-template>
"KRN",.84,7981013.001,2,103,0)
</xsl:template>
"KRN",.84,7981013.001,2,104,0)
 
"KRN",.84,7981013.001,2,105,0)
<xsl:template match="COLUMN[@NAME='DIAG']">
"KRN",.84,7981013.001,2,106,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,107,0)
  <xsl:with-param name="title" select="'Diagnosis'"/>
"KRN",.84,7981013.001,2,108,0)
 </xsl:call-template>
"KRN",.84,7981013.001,2,109,0)
</xsl:template>
"KRN",.84,7981013.001,2,110,0)
 
"KRN",.84,7981013.001,2,111,0)
<xsl:template match="COLUMN[@NAME='NC']">
"KRN",.84,7981013.001,2,112,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,113,0)
  <xsl:with-param name="title" select="'Number of Codes'"/>
"KRN",.84,7981013.001,2,114,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981013.001,2,115,0)
 </xsl:call-template>
"KRN",.84,7981013.001,2,116,0)
</xsl:template>
"KRN",.84,7981013.001,2,117,0)
 
"KRN",.84,7981013.001,2,118,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981013.001,2,119,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,120,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981013.001,2,121,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981013.001,2,122,0)
 </xsl:call-template>
"KRN",.84,7981013.001,2,123,0)
</xsl:template>
"KRN",.84,7981013.001,2,124,0)
 
"KRN",.84,7981013.001,2,125,0)
<xsl:template match="COLUMN[@NAME='SOURCE']">
"KRN",.84,7981013.001,2,126,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,127,0)
  <xsl:with-param name="title" select="'Source'"/>
"KRN",.84,7981013.001,2,128,0)
 </xsl:call-template>
"KRN",.84,7981013.001,2,129,0)
</xsl:template>
"KRN",.84,7981013.001,2,130,0)
 
"KRN",.84,7981013.001,2,131,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981013.001,2,132,0)
 
"KRN",.84,7981013.001,2,133,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981013.001,2,134,0)
 <xsl:variable name="rowspan" select="count(PTICDL/ICD9)"/>
"KRN",.84,7981013.001,2,135,0)
 <tr>
"KRN",.84,7981013.001,2,136,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.001,2,137,0)
   <xsl:with-param name="value" select="position()"/>
"KRN",.84,7981013.001,2,138,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981013.001,2,139,0)
  </xsl:call-template>
"KRN",.84,7981013.001,2,140,0)
  <xsl:apply-templates select="*[name(.)!='PTICDL']">
"KRN",.84,7981013.001,2,141,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981013.001,2,142,0)
  </xsl:apply-templates>
"KRN",.84,7981013.001,2,143,0)
  <xsl:for-each select="PTICDL/ICD9[1]">
"KRN",.84,7981013.001,2,144,0)
   <xsl:call-template name="ICD9Data"/>
"KRN",.84,7981013.001,2,145,0)
  </xsl:for-each>
"KRN",.84,7981013.001,2,146,0)
 </tr>
"KRN",.84,7981013.001,2,147,0)
 <xsl:for-each select="PTICDL/ICD9[position()>1]">
"KRN",.84,7981013.001,2,148,0)
  <tr>
"KRN",.84,7981013.001,2,149,0)
   <xsl:call-template name="ICD9Data"/>
"KRN",.84,7981013.001,2,150,0)
  </tr>
"KRN",.84,7981013.001,2,151,0)
 </xsl:for-each>
"KRN",.84,7981013.001,2,152,0)
</xsl:template>
"KRN",.84,7981013.001,2,153,0)
 
"KRN",.84,7981013.001,2,154,0)
<xsl:template match="DIAG">
"KRN",.84,7981013.001,2,155,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981013.001,2,156,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981013.001,2,157,0)
 </xsl:call-template>
"KRN",.84,7981013.001,2,158,0)
</xsl:template>
"KRN",.84,7981013.001,2,159,0)
 
"KRN",.84,7981013.001,2,160,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981013.001,2,161,0)
 
"KRN",.84,7981013.001,2,162,0)
<xsl:template name="ICD9Data">
"KRN",.84,7981013.001,2,163,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981013.001,2,164,0)
  <xsl:with-param name="value" select="CODE"/>
"KRN",.84,7981013.001,2,165,0)
 </xsl:call-template>
"KRN",.84,7981013.001,2,166,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981013.001,2,167,0)
  <xsl:with-param name="value" select="DIAG"/>
"KRN",.84,7981013.001,2,168,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981013.001,2,169,0)
 </xsl:call-template>
"KRN",.84,7981013.001,2,170,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981013.001,2,171,0)
  <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981013.001,2,172,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981013.001,2,173,0)
 </xsl:call-template>
"KRN",.84,7981013.001,2,174,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981013.001,2,175,0)
  <xsl:with-param name="value" select="SOURCE"/>
"KRN",.84,7981013.001,2,176,0)
 </xsl:call-template>
"KRN",.84,7981013.001,2,177,0)
</xsl:template>
"KRN",.84,7981013.001,2,178,0)
 
"KRN",.84,7981013.001,2,179,0)
<xsl:template name="ReportSummary">
"KRN",.84,7981013.001,2,180,0)
 <xsl:param name="summary" select="/REPORT/SUMMARY"/>
"KRN",.84,7981013.001,2,181,0)
 <table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981013.001,2,182,0)
  <thead>
"KRN",.84,7981013.001,2,183,0)
   <tr>
"KRN",.84,7981013.001,2,184,0)
    <th width="33%">Number of Patients</th>
"KRN",.84,7981013.001,2,185,0)
    <th width="33%">Number of Codes</th>
"KRN",.84,7981013.001,2,186,0)
    <th width="33%">Number of Different Codes </th>
"KRN",.84,7981013.001,2,187,0)
   </tr>
"KRN",.84,7981013.001,2,188,0)
  </thead>
"KRN",.84,7981013.001,2,189,0)
  <tbody>
"KRN",.84,7981013.001,2,190,0)
   <tr>
"KRN",.84,7981013.001,2,191,0)
    <td><xsl:value-of select="$summary/NP"/></td>
"KRN",.84,7981013.001,2,192,0)
    <td><xsl:value-of select="$summary/NC"/></td>
"KRN",.84,7981013.001,2,193,0)
    <td><xsl:value-of select="$summary/NDC"/></td>
"KRN",.84,7981013.001,2,194,0)
   </tr>
"KRN",.84,7981013.001,2,195,0)
  </tbody>
"KRN",.84,7981013.001,2,196,0)
 </table>
"KRN",.84,7981013.001,2,197,0)
</xsl:template>
"KRN",.84,7981013.001,2,198,0)
 
"KRN",.84,7981013.001,2,199,0)
</xsl:stylesheet>
"KRN",.84,7981013.002,-1)
0^47
"KRN",.84,7981013.002,0)
7981013.002^2^^CLINICAL CASE REGISTRIES^Diagnoses (CSV)
"KRN",.84,7981013.002,2,0)
^^95^95^3050912^
"KRN",.84,7981013.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981013.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981013.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981013.002,2,4,0)
>
"KRN",.84,7981013.002,2,5,0)
 
"KRN",.84,7981013.002,2,6,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981013.002,2,7,0)
 
"KRN",.84,7981013.002,2,8,0)
<xsl:template match="/">
"KRN",.84,7981013.002,2,9,0)
 <xsl:apply-templates select="/REPORT/ICD9LST"/>
"KRN",.84,7981013.002,2,10,0)
 <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981013.002,2,11,0)
</xsl:template>
"KRN",.84,7981013.002,2,12,0)
 
"KRN",.84,7981013.002,2,13,0)
<xsl:template match="REPORT/ICD9LST">
"KRN",.84,7981013.002,2,14,0)
 <xsl:text>Diagnoses (ICD-9 Codes)</xsl:text>
"KRN",.84,7981013.002,2,15,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981013.002,2,16,0)
 <xsl:value-of select="$FILESWITCH"/>
"KRN",.84,7981013.002,2,17,0)
</xsl:template>
"KRN",.84,7981013.002,2,18,0)
 
"KRN",.84,7981013.002,2,19,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981013.002,2,20,0)
 <xsl:text>Diagnoses (Patients)</xsl:text>
"KRN",.84,7981013.002,2,21,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981013.002,2,22,0)
 <xsl:value-of select="$FILESWITCH"/>
"KRN",.84,7981013.002,2,23,0)
</xsl:template>
"KRN",.84,7981013.002,2,24,0)
 
"KRN",.84,7981013.002,2,25,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981013.002,2,26,0)
 <xsl:variable name="ptname" select="NAME"/>
"KRN",.84,7981013.002,2,27,0)
 <xsl:variable name="ssn" select="LAST4"/>
"KRN",.84,7981013.002,2,28,0)
 <xsl:variable name="dod" select="DOD"/>
"KRN",.84,7981013.002,2,29,0)
 <xsl:for-each select="PTICDL/ICD9">
"KRN",.84,7981013.002,2,30,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,31,0)
   <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981013.002,2,32,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,33,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,34,0)
   <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981013.002,2,35,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,36,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,37,0)
   <xsl:with-param name="value" select="$dod"/>
"KRN",.84,7981013.002,2,38,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981013.002,2,39,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,40,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,41,0)
   <xsl:with-param name="value" select="CODE"/>
"KRN",.84,7981013.002,2,42,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,43,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,44,0)
   <xsl:with-param name="value" select="DIAG"/>
"KRN",.84,7981013.002,2,45,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,46,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,47,0)
   <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981013.002,2,48,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981013.002,2,49,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,50,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,51,0)
   <xsl:with-param name="value" select="SOURCE"/>
"KRN",.84,7981013.002,2,52,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,53,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981013.002,2,54,0)
 </xsl:for-each>
"KRN",.84,7981013.002,2,55,0)
</xsl:template>
"KRN",.84,7981013.002,2,56,0)
 
"KRN",.84,7981013.002,2,57,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981013.002,2,58,0)
 
"KRN",.84,7981013.002,2,59,0)
<xsl:template match="COLUMN[@NAME='CODE']">
"KRN",.84,7981013.002,2,60,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.002,2,61,0)
  <xsl:with-param name="title" select="'Code'"/>
"KRN",.84,7981013.002,2,62,0)
 </xsl:call-template>
"KRN",.84,7981013.002,2,63,0)
</xsl:template>
"KRN",.84,7981013.002,2,64,0)
 
"KRN",.84,7981013.002,2,65,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981013.002,2,66,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.002,2,67,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981013.002,2,68,0)
 </xsl:call-template>
"KRN",.84,7981013.002,2,69,0)
</xsl:template>
"KRN",.84,7981013.002,2,70,0)
 
"KRN",.84,7981013.002,2,71,0)
<xsl:template match="COLUMN[@NAME='DIAG']">
"KRN",.84,7981013.002,2,72,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.002,2,73,0)
  <xsl:with-param name="title" select="'Diagnosis'"/>
"KRN",.84,7981013.002,2,74,0)
 </xsl:call-template>
"KRN",.84,7981013.002,2,75,0)
</xsl:template>
"KRN",.84,7981013.002,2,76,0)
 
"KRN",.84,7981013.002,2,77,0)
<xsl:template match="COLUMN[@NAME='NC']">
"KRN",.84,7981013.002,2,78,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.002,2,79,0)
  <xsl:with-param name="title" select="'Number of Codes'"/>
"KRN",.84,7981013.002,2,80,0)
 </xsl:call-template>
"KRN",.84,7981013.002,2,81,0)
</xsl:template>
"KRN",.84,7981013.002,2,82,0)
 
"KRN",.84,7981013.002,2,83,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981013.002,2,84,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.002,2,85,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981013.002,2,86,0)
 </xsl:call-template>
"KRN",.84,7981013.002,2,87,0)
</xsl:template>
"KRN",.84,7981013.002,2,88,0)
 
"KRN",.84,7981013.002,2,89,0)
<xsl:template match="COLUMN[@NAME='SOURCE']">
"KRN",.84,7981013.002,2,90,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.002,2,91,0)
  <xsl:with-param name="title" select="'Source'"/>
"KRN",.84,7981013.002,2,92,0)
 </xsl:call-template>
"KRN",.84,7981013.002,2,93,0)
</xsl:template>
"KRN",.84,7981013.002,2,94,0)
 
"KRN",.84,7981013.002,2,95,0)
</xsl:stylesheet>
"KRN",.84,7981014.001,-1)
0^48
"KRN",.84,7981014.001,0)
7981014.001^2^^CLINICAL CASE REGISTRIES^Registry Medications Report (HTML)
"KRN",.84,7981014.001,2,0)
^.844^122^122^3051005^^
"KRN",.84,7981014.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981014.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981014.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981014.001,2,4,0)
>
"KRN",.84,7981014.001,2,5,0)
 
"KRN",.84,7981014.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981014.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981014.001,2,8,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->            
"KRN",.84,7981014.001,2,9,0)
<xsl:include href="template://report/996/1"/>  <!-- Pharmacy -->
"KRN",.84,7981014.001,2,10,0)
 
"KRN",.84,7981014.001,2,11,0)
<xsl:variable name="complete" select="/REPORT/PARAMETERS/OPTIONS/@COMPLETE"/>
"KRN",.84,7981014.001,2,12,0)
 
"KRN",.84,7981014.001,2,13,0)
<xsl:template match="/">
"KRN",.84,7981014.001,2,14,0)
 <html>
"KRN",.84,7981014.001,2,15,0)
  <head>
"KRN",.84,7981014.001,2,16,0)
   <title>Registry Medications Report</title>
"KRN",.84,7981014.001,2,17,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981014.001,2,18,0)
   <style type="text/css">
"KRN",.84,7981014.001,2,19,0)
    td.DrugComb {
"KRN",.84,7981014.001,2,20,0)
     font-weight: bold;
"KRN",.84,7981014.001,2,21,0)
     text-align: left;
"KRN",.84,7981014.001,2,22,0)
     background-color: #EEEEEE;
"KRN",.84,7981014.001,2,23,0)
    }
"KRN",.84,7981014.001,2,24,0)
   </style>
"KRN",.84,7981014.001,2,25,0)
  </head>
"KRN",.84,7981014.001,2,26,0)
  <body>
"KRN",.84,7981014.001,2,27,0)
   <h1>Registry Medications Report</h1>
"KRN",.84,7981014.001,2,28,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981014.001,2,29,0)
   <div style="page-break-before:always">
"KRN",.84,7981014.001,2,30,0)
    <xsl:apply-templates select="/REPORT/RXCOMBLST"/>
"KRN",.84,7981014.001,2,31,0)
   </div>
"KRN",.84,7981014.001,2,32,0)
  </body>
"KRN",.84,7981014.001,2,33,0)
 </html>
"KRN",.84,7981014.001,2,34,0)
</xsl:template>
"KRN",.84,7981014.001,2,35,0)
 
"KRN",.84,7981014.001,2,36,0)
<xsl:template match="RXCOMBLST">
"KRN",.84,7981014.001,2,37,0)
 <xsl:call-template name="DataGrid">
"KRN",.84,7981014.001,2,38,0)
  <xsl:with-param name="scroll" select="*[31] or descendant::PATIENT[31]"/>
"KRN",.84,7981014.001,2,39,0)
 </xsl:call-template>
"KRN",.84,7981014.001,2,40,0)
</xsl:template>
"KRN",.84,7981014.001,2,41,0)
 
"KRN",.84,7981014.001,2,42,0)
<xsl:template match="HEADER/TBLDEF[@NAME='RXCOMBLST']/@HEADER">
"KRN",.84,7981014.001,2,43,0)
 <thead>
"KRN",.84,7981014.001,2,44,0)
  <xsl:choose>
"KRN",.84,7981014.001,2,45,0)
   <xsl:when test="$complete">
"KRN",.84,7981014.001,2,46,0)
    <tr>
"KRN",.84,7981014.001,2,47,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981014.001,2,48,0)
      <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981014.001,2,49,0)
      <xsl:with-param name="rowspan" select="2"/>
"KRN",.84,7981014.001,2,50,0)
      <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981014.001,2,51,0)
     </xsl:call-template>
"KRN",.84,7981014.001,2,52,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981014.001,2,53,0)
      <xsl:with-param name="title" select="'Combination of Drugs'"/>
"KRN",.84,7981014.001,2,54,0)
      <xsl:with-param name="colspan" select="3"/>
"KRN",.84,7981014.001,2,55,0)
      <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981014.001,2,56,0)
     </xsl:call-template>
"KRN",.84,7981014.001,2,57,0)
    </tr>
"KRN",.84,7981014.001,2,58,0)
    <tr>
"KRN",.84,7981014.001,2,59,0)
     <xsl:call-template name="BasicPatientHeader">
"KRN",.84,7981014.001,2,60,0)
      <xsl:with-param name="seqnum" select="0"/>
"KRN",.84,7981014.001,2,61,0)
     </xsl:call-template>
"KRN",.84,7981014.001,2,62,0)
    </tr>
"KRN",.84,7981014.001,2,63,0)
   </xsl:when>
"KRN",.84,7981014.001,2,64,0)
   <xsl:otherwise>
"KRN",.84,7981014.001,2,65,0)
    <tr>
"KRN",.84,7981014.001,2,66,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981014.001,2,67,0)
      <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981014.001,2,68,0)
      <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981014.001,2,69,0)
     </xsl:call-template>
"KRN",.84,7981014.001,2,70,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981014.001,2,71,0)
      <xsl:with-param name="title" select="'Combination of Drugs'"/>
"KRN",.84,7981014.001,2,72,0)
      <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981014.001,2,73,0)
     </xsl:call-template>
"KRN",.84,7981014.001,2,74,0)
    </tr>
"KRN",.84,7981014.001,2,75,0)
   </xsl:otherwise>
"KRN",.84,7981014.001,2,76,0)
  </xsl:choose>
"KRN",.84,7981014.001,2,77,0)
 </thead>
"KRN",.84,7981014.001,2,78,0)
</xsl:template>
"KRN",.84,7981014.001,2,79,0)
 
"KRN",.84,7981014.001,2,80,0)
<xsl:template match="RXCOMBLST/RXCOMB">
"KRN",.84,7981014.001,2,81,0)
 <xsl:choose>
"KRN",.84,7981014.001,2,82,0)
  <xsl:when test="$complete">
"KRN",.84,7981014.001,2,83,0)
   <xsl:variable name="rowspan" select="count(PATIENTS/PATIENT)+1"/>
"KRN",.84,7981014.001,2,84,0)
   <tr>
"KRN",.84,7981014.001,2,85,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981014.001,2,86,0)
     <xsl:with-param name="value" select="NP"/>
"KRN",.84,7981014.001,2,87,0)
     <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981014.001,2,88,0)
     <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981014.001,2,89,0)
    </xsl:call-template>
"KRN",.84,7981014.001,2,90,0)
    <td class="DrugComb" colspan="3">
"KRN",.84,7981014.001,2,91,0)
     <xsl:call-template name="DrugCombination"/>
"KRN",.84,7981014.001,2,92,0)
    </td>
"KRN",.84,7981014.001,2,93,0)
   </tr>
"KRN",.84,7981014.001,2,94,0)
   <xsl:for-each select="PATIENTS/PATIENT">
"KRN",.84,7981014.001,2,95,0)
    <tr>
"KRN",.84,7981014.001,2,96,0)
     <xsl:call-template name="BasicPatientData">
"KRN",.84,7981014.001,2,97,0)
      <xsl:with-param name="seqnum" select="0"/>
"KRN",.84,7981014.001,2,98,0)
     </xsl:call-template>
"KRN",.84,7981014.001,2,99,0)
    </tr>
"KRN",.84,7981014.001,2,100,0)
   </xsl:for-each>
"KRN",.84,7981014.001,2,101,0)
  </xsl:when>
"KRN",.84,7981014.001,2,102,0)
  <xsl:otherwise>
"KRN",.84,7981014.001,2,103,0)
   <tr>
"KRN",.84,7981014.001,2,104,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981014.001,2,105,0)
     <xsl:with-param name="value" select="NP"/>
"KRN",.84,7981014.001,2,106,0)
     <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981014.001,2,107,0)
    </xsl:call-template>
"KRN",.84,7981014.001,2,108,0)
    <td class="aLeft">
"KRN",.84,7981014.001,2,109,0)
     <xsl:call-template name="DrugCombination"/>
"KRN",.84,7981014.001,2,110,0)
    </td>
"KRN",.84,7981014.001,2,111,0)
   </tr>
"KRN",.84,7981014.001,2,112,0)
  </xsl:otherwise>
"KRN",.84,7981014.001,2,113,0)
 </xsl:choose>
"KRN",.84,7981014.001,2,114,0)
</xsl:template>
"KRN",.84,7981014.001,2,115,0)
 
"KRN",.84,7981014.001,2,116,0)
<xsl:template name="DrugCombination">
"KRN",.84,7981014.001,2,117,0)
 <xsl:for-each select="DRUGS/NAME">
"KRN",.84,7981014.001,2,118,0)
  <xsl:if test="position()>1">; </xsl:if><xsl:value-of select="."/>
"KRN",.84,7981014.001,2,119,0)
 </xsl:for-each>
"KRN",.84,7981014.001,2,120,0)
</xsl:template>
"KRN",.84,7981014.001,2,121,0)
 
"KRN",.84,7981014.001,2,122,0)
</xsl:stylesheet>
"KRN",.84,7981014.002,-1)
0^49
"KRN",.84,7981014.002,0)
7981014.002^2^^CLINICAL CASE REGISTRIES^Registry Medications Report (CSV)
"KRN",.84,7981014.002,2,0)
^^69^69^3051005^
"KRN",.84,7981014.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981014.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981014.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981014.002,2,4,0)
>
"KRN",.84,7981014.002,2,5,0)
 
"KRN",.84,7981014.002,2,6,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981014.002,2,7,0)
  
"KRN",.84,7981014.002,2,8,0)
<xsl:variable name="complete" select="/REPORT/PARAMETERS/OPTIONS/@COMPLETE"/>
"KRN",.84,7981014.002,2,9,0)
 
"KRN",.84,7981014.002,2,10,0)
<xsl:template match="/">
"KRN",.84,7981014.002,2,11,0)
 <xsl:text>Registry Medications Report</xsl:text>
"KRN",.84,7981014.002,2,12,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981014.002,2,13,0)
 <xsl:text>Number of Patients,Combination of Drugs</xsl:text>
"KRN",.84,7981014.002,2,14,0)
 <xsl:if test="$complete">
"KRN",.84,7981014.002,2,15,0)
  <xsl:text>,Patient Name,SSN,DOD</xsl:text>
"KRN",.84,7981014.002,2,16,0)
 </xsl:if>
"KRN",.84,7981014.002,2,17,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981014.002,2,18,0)
 <xsl:apply-templates select="/REPORT/RXCOMBLST/RXCOMB"/>
"KRN",.84,7981014.002,2,19,0)
 <xsl:if test="not(/REPORT/RXCOMBLST/RXCOMB[1])">
"KRN",.84,7981014.002,2,20,0)
  <xsl:call-template name="TableNoData"/>
"KRN",.84,7981014.002,2,21,0)
 </xsl:if>
"KRN",.84,7981014.002,2,22,0)
</xsl:template>
"KRN",.84,7981014.002,2,23,0)
 
"KRN",.84,7981014.002,2,24,0)
<xsl:template match="RXCOMBLST/RXCOMB">
"KRN",.84,7981014.002,2,25,0)
 <xsl:choose>
"KRN",.84,7981014.002,2,26,0)
  <xsl:when test="$complete">
"KRN",.84,7981014.002,2,27,0)
   <xsl:variable name="np" select="NP"/>
"KRN",.84,7981014.002,2,28,0)
   <xsl:variable name="drugs" select="DRUGS"/>
"KRN",.84,7981014.002,2,29,0)
   <xsl:for-each select="PATIENTS/PATIENT">
"KRN",.84,7981014.002,2,30,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,31,0)
     <xsl:with-param name="value" select="$np"/>
"KRN",.84,7981014.002,2,32,0)
    </xsl:call-template>
"KRN",.84,7981014.002,2,33,0)
    <xsl:call-template name="DrugCombination">
"KRN",.84,7981014.002,2,34,0)
     <xsl:with-param name="drugs" select="$drugs"/>
"KRN",.84,7981014.002,2,35,0)
    </xsl:call-template>
"KRN",.84,7981014.002,2,36,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,37,0)
     <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981014.002,2,38,0)
    </xsl:call-template>
"KRN",.84,7981014.002,2,39,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,40,0)
     <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981014.002,2,41,0)
    </xsl:call-template>
"KRN",.84,7981014.002,2,42,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,43,0)
     <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981014.002,2,44,0)
     <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981014.002,2,45,0)
    </xsl:call-template>
"KRN",.84,7981014.002,2,46,0)
    <xsl:value-of select="$CRLF"/>
"KRN",.84,7981014.002,2,47,0)
   </xsl:for-each>
"KRN",.84,7981014.002,2,48,0)
  </xsl:when>
"KRN",.84,7981014.002,2,49,0)
  <xsl:otherwise>
"KRN",.84,7981014.002,2,50,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,51,0)
    <xsl:with-param name="value" select="NP"/>
"KRN",.84,7981014.002,2,52,0)
   </xsl:call-template>
"KRN",.84,7981014.002,2,53,0)
   <xsl:call-template name="DrugCombination"/>
"KRN",.84,7981014.002,2,54,0)
   <xsl:value-of select="$CRLF"/>
"KRN",.84,7981014.002,2,55,0)
  </xsl:otherwise>
"KRN",.84,7981014.002,2,56,0)
 </xsl:choose>
"KRN",.84,7981014.002,2,57,0)
</xsl:template>
"KRN",.84,7981014.002,2,58,0)
 
"KRN",.84,7981014.002,2,59,0)
<xsl:template name="DrugCombination">
"KRN",.84,7981014.002,2,60,0)
 <xsl:param name="drugs" select="DRUGS"/>
"KRN",.84,7981014.002,2,61,0)
 <xsl:text>&quot;</xsl:text>
"KRN",.84,7981014.002,2,62,0)
 <xsl:for-each select="$drugs/NAME">
"KRN",.84,7981014.002,2,63,0)
  <xsl:if test="position()>1">; </xsl:if>
"KRN",.84,7981014.002,2,64,0)
  <xsl:call-template name="DoubleQuotes"/>
"KRN",.84,7981014.002,2,65,0)
 </xsl:for-each>
"KRN",.84,7981014.002,2,66,0)
 <xsl:text>&quot;,</xsl:text>
"KRN",.84,7981014.002,2,67,0)
</xsl:template>
"KRN",.84,7981014.002,2,68,0)
 
"KRN",.84,7981014.002,2,69,0)
</xsl:stylesheet>
"KRN",.84,7981015.001,-1)
0^65
"KRN",.84,7981015.001,0)
7981015.001^2^^CLINICAL CASE REGISTRIES^Procedures (HTML)
"KRN",.84,7981015.001,2,0)
^^195^195^3051026^
"KRN",.84,7981015.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981015.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981015.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981015.001,2,4,0)
>
"KRN",.84,7981015.001,2,5,0)
 
"KRN",.84,7981015.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981015.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981015.001,2,8,0)
 
"KRN",.84,7981015.001,2,9,0)
<xsl:template match="/">
"KRN",.84,7981015.001,2,10,0)
 <html>
"KRN",.84,7981015.001,2,11,0)
  <head>
"KRN",.84,7981015.001,2,12,0)
   <title>Procedures</title>
"KRN",.84,7981015.001,2,13,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981015.001,2,14,0)
  </head>
"KRN",.84,7981015.001,2,15,0)
  <body>
"KRN",.84,7981015.001,2,16,0)
   <h1>Procedures</h1>
"KRN",.84,7981015.001,2,17,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981015.001,2,18,0)
   <div style="page-break-before:always">
"KRN",.84,7981015.001,2,19,0)
    <xsl:call-template name="ReportSummary"/>
"KRN",.84,7981015.001,2,20,0)
    <xsl:apply-templates select="/REPORT/CPTLST"/>
"KRN",.84,7981015.001,2,21,0)
   </div>
"KRN",.84,7981015.001,2,22,0)
   <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981015.001,2,23,0)
  </body>
"KRN",.84,7981015.001,2,24,0)
 </html>
"KRN",.84,7981015.001,2,25,0)
</xsl:template>
"KRN",.84,7981015.001,2,26,0)
 
"KRN",.84,7981015.001,2,27,0)
<xsl:template match="REPORT/CPTLST">
"KRN",.84,7981015.001,2,28,0)
 <h2>CPT Codes</h2>
"KRN",.84,7981015.001,2,29,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981015.001,2,30,0)
</xsl:template>
"KRN",.84,7981015.001,2,31,0)
 
"KRN",.84,7981015.001,2,32,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981015.001,2,33,0)
 <div style="page-break-before:always">
"KRN",.84,7981015.001,2,34,0)
  <h2>Patients</h2>
"KRN",.84,7981015.001,2,35,0)
  <xsl:call-template name="DataGrid">
"KRN",.84,7981015.001,2,36,0)
   <xsl:with-param name="scroll" select="descendant::CPT[31]"/>
"KRN",.84,7981015.001,2,37,0)
  </xsl:call-template>
"KRN",.84,7981015.001,2,38,0)
 </div>
"KRN",.84,7981015.001,2,39,0)
 <div class="reportSummary">
"KRN",.84,7981015.001,2,40,0)
  <div style="float:left; width:30%">
"KRN",.84,7981015.001,2,41,0)
   <table cellpadding="3" cellspacing="0">
"KRN",.84,7981015.001,2,42,0)
    <caption>Source</caption>
"KRN",.84,7981015.001,2,43,0)
    <thead>
"KRN",.84,7981015.001,2,44,0)
     <tr>
"KRN",.84,7981015.001,2,45,0)
      <th width="30">Code</th>
"KRN",.84,7981015.001,2,46,0)
      <th>Description</th>
"KRN",.84,7981015.001,2,47,0)
     </tr>
"KRN",.84,7981015.001,2,48,0)
    </thead>
"KRN",.84,7981015.001,2,49,0)
    <tbody>
"KRN",.84,7981015.001,2,50,0)
     <tr>
"KRN",.84,7981015.001,2,51,0)
      <td align="center">I</td>
"KRN",.84,7981015.001,2,52,0)
      <td class="aLeft">Inpatient file</td>
"KRN",.84,7981015.001,2,53,0)
     </tr>
"KRN",.84,7981015.001,2,54,0)
     <tr>
"KRN",.84,7981015.001,2,55,0)
      <td align="center">O</td>
"KRN",.84,7981015.001,2,56,0)
      <td class="aLeft">Outpatient file</td>
"KRN",.84,7981015.001,2,57,0)
     </tr>
"KRN",.84,7981015.001,2,58,0)
    </tbody>
"KRN",.84,7981015.001,2,59,0)
   </table>
"KRN",.84,7981015.001,2,60,0)
  </div>
"KRN",.84,7981015.001,2,61,0)
 </div>
"KRN",.84,7981015.001,2,62,0)
</xsl:template>
"KRN",.84,7981015.001,2,63,0)
 
"KRN",.84,7981015.001,2,64,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981015.001,2,65,0)
 
"KRN",.84,7981015.001,2,66,0)
<xsl:template match="HEADER/TBLDEF[@NAME='PATIENTS']/@HEADER">
"KRN",.84,7981015.001,2,67,0)
 <xsl:variable name="PTCPTL" select="../COLUMN[@NAME='PTCPTL']"/>
"KRN",.84,7981015.001,2,68,0)
 <thead>
"KRN",.84,7981015.001,2,69,0)
  <tr>
"KRN",.84,7981015.001,2,70,0)
   <xsl:apply-templates select="../COLUMN[@NAME!='PTCPTL']">
"KRN",.84,7981015.001,2,71,0)
    <xsl:with-param name="rowspan" select="2"/>
"KRN",.84,7981015.001,2,72,0)
   </xsl:apply-templates>
"KRN",.84,7981015.001,2,73,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,74,0)
    <xsl:with-param name="column" select="$PTCPTL"/>
"KRN",.84,7981015.001,2,75,0)
    <xsl:with-param name="title" select="'CPT'"/>                 
"KRN",.84,7981015.001,2,76,0)
    <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981015.001,2,77,0)
    <xsl:with-param name="width" select="'52%'"/>
"KRN",.84,7981015.001,2,78,0)
    <xsl:with-param name="colspan" select="4"/>
"KRN",.84,7981015.001,2,79,0)
   </xsl:call-template>
"KRN",.84,7981015.001,2,80,0)
  </tr>
"KRN",.84,7981015.001,2,81,0)
  <tr>
"KRN",.84,7981015.001,2,82,0)
   <xsl:apply-templates select="$PTCPTL/*"/>
"KRN",.84,7981015.001,2,83,0)
  </tr>
"KRN",.84,7981015.001,2,84,0)
 </thead>
"KRN",.84,7981015.001,2,85,0)
</xsl:template>
"KRN",.84,7981015.001,2,86,0)
 
"KRN",.84,7981015.001,2,87,0)
<xsl:template match="COLUMN[@NAME='CODE']">
"KRN",.84,7981015.001,2,88,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,89,0)
  <xsl:with-param name="title" select="'Code'"/>
"KRN",.84,7981015.001,2,90,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981015.001,2,91,0)
 </xsl:call-template>
"KRN",.84,7981015.001,2,92,0)
</xsl:template>
"KRN",.84,7981015.001,2,93,0)
 
"KRN",.84,7981015.001,2,94,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981015.001,2,95,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,96,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981015.001,2,97,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981015.001,2,98,0)
 </xsl:call-template>
"KRN",.84,7981015.001,2,99,0)
</xsl:template>
"KRN",.84,7981015.001,2,100,0)
 
"KRN",.84,7981015.001,2,101,0)
<xsl:template match="COLUMN[@NAME='DESCR']">
"KRN",.84,7981015.001,2,102,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,103,0)
  <xsl:with-param name="title" select="'Short Name'"/>
"KRN",.84,7981015.001,2,104,0)
 </xsl:call-template>
"KRN",.84,7981015.001,2,105,0)
</xsl:template>
"KRN",.84,7981015.001,2,106,0)
 
"KRN",.84,7981015.001,2,107,0)
<xsl:template match="COLUMN[@NAME='NC']">
"KRN",.84,7981015.001,2,108,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,109,0)
  <xsl:with-param name="title" select="'Number of Codes'"/>
"KRN",.84,7981015.001,2,110,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981015.001,2,111,0)
 </xsl:call-template>
"KRN",.84,7981015.001,2,112,0)
</xsl:template>
"KRN",.84,7981015.001,2,113,0)
 
"KRN",.84,7981015.001,2,114,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981015.001,2,115,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,116,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981015.001,2,117,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981015.001,2,118,0)
 </xsl:call-template>
"KRN",.84,7981015.001,2,119,0)
</xsl:template>
"KRN",.84,7981015.001,2,120,0)
 
"KRN",.84,7981015.001,2,121,0)
<xsl:template match="COLUMN[@NAME='SOURCE']">
"KRN",.84,7981015.001,2,122,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,123,0)
  <xsl:with-param name="title" select="'Source'"/>
"KRN",.84,7981015.001,2,124,0)
 </xsl:call-template>
"KRN",.84,7981015.001,2,125,0)
</xsl:template>
"KRN",.84,7981015.001,2,126,0)
 
"KRN",.84,7981015.001,2,127,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981015.001,2,128,0)
 
"KRN",.84,7981015.001,2,129,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981015.001,2,130,0)
 <xsl:variable name="rowspan" select="count(PTCPTL/CPT)"/>
"KRN",.84,7981015.001,2,131,0)
 <tr>
"KRN",.84,7981015.001,2,132,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,133,0)
   <xsl:with-param name="value" select="position()"/>
"KRN",.84,7981015.001,2,134,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981015.001,2,135,0)
  </xsl:call-template>
"KRN",.84,7981015.001,2,136,0)
  <xsl:apply-templates select="*[name(.)!='PTCPTL']">
"KRN",.84,7981015.001,2,137,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981015.001,2,138,0)
  </xsl:apply-templates>
"KRN",.84,7981015.001,2,139,0)
  <xsl:for-each select="PTCPTL/CPT[1]">
"KRN",.84,7981015.001,2,140,0)
   <xsl:call-template name="CPTData"/>
"KRN",.84,7981015.001,2,141,0)
  </xsl:for-each>
"KRN",.84,7981015.001,2,142,0)
 </tr>
"KRN",.84,7981015.001,2,143,0)
 <xsl:for-each select="PTCPTL/CPT[position()>1]">
"KRN",.84,7981015.001,2,144,0)
  <tr>
"KRN",.84,7981015.001,2,145,0)
   <xsl:call-template name="CPTData"/>
"KRN",.84,7981015.001,2,146,0)
  </tr>
"KRN",.84,7981015.001,2,147,0)
 </xsl:for-each>
"KRN",.84,7981015.001,2,148,0)
</xsl:template>
"KRN",.84,7981015.001,2,149,0)
 
"KRN",.84,7981015.001,2,150,0)
<xsl:template match="DESCR">
"KRN",.84,7981015.001,2,151,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,152,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981015.001,2,153,0)
 </xsl:call-template>
"KRN",.84,7981015.001,2,154,0)
</xsl:template>
"KRN",.84,7981015.001,2,155,0)
 
"KRN",.84,7981015.001,2,156,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981015.001,2,157,0)
 
"KRN",.84,7981015.001,2,158,0)
<xsl:template name="CPTData">
"KRN",.84,7981015.001,2,159,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,160,0)
  <xsl:with-param name="value" select="CODE"/>
"KRN",.84,7981015.001,2,161,0)
 </xsl:call-template>
"KRN",.84,7981015.001,2,162,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,163,0)
  <xsl:with-param name="value" select="DESCR"/>
"KRN",.84,7981015.001,2,164,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981015.001,2,165,0)
 </xsl:call-template>
"KRN",.84,7981015.001,2,166,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,167,0)
  <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981015.001,2,168,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981015.001,2,169,0)
 </xsl:call-template>
"KRN",.84,7981015.001,2,170,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,171,0)
  <xsl:with-param name="value" select="SOURCE"/>
"KRN",.84,7981015.001,2,172,0)
 </xsl:call-template>
"KRN",.84,7981015.001,2,173,0)
</xsl:template>
"KRN",.84,7981015.001,2,174,0)
 
"KRN",.84,7981015.001,2,175,0)
<xsl:template name="ReportSummary">
"KRN",.84,7981015.001,2,176,0)
 <xsl:param name="summary" select="/REPORT/SUMMARY"/>
"KRN",.84,7981015.001,2,177,0)
 <table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981015.001,2,178,0)
  <thead>
"KRN",.84,7981015.001,2,179,0)
   <tr>
"KRN",.84,7981015.001,2,180,0)
    <th width="33%">Number of Patients</th>
"KRN",.84,7981015.001,2,181,0)
    <th width="33%">Number of Codes</th>
"KRN",.84,7981015.001,2,182,0)
    <th width="33%">Number of Different Codes </th>
"KRN",.84,7981015.001,2,183,0)
   </tr>
"KRN",.84,7981015.001,2,184,0)
  </thead>
"KRN",.84,7981015.001,2,185,0)
  <tbody>
"KRN",.84,7981015.001,2,186,0)
   <tr>
"KRN",.84,7981015.001,2,187,0)
    <td><xsl:value-of select="$summary/NP"/></td>
"KRN",.84,7981015.001,2,188,0)
    <td><xsl:value-of select="$summary/NC"/></td>
"KRN",.84,7981015.001,2,189,0)
    <td><xsl:value-of select="$summary/NDC"/></td>
"KRN",.84,7981015.001,2,190,0)
   </tr>
"KRN",.84,7981015.001,2,191,0)
  </tbody>
"KRN",.84,7981015.001,2,192,0)
 </table>
"KRN",.84,7981015.001,2,193,0)
</xsl:template>
"KRN",.84,7981015.001,2,194,0)
 
"KRN",.84,7981015.001,2,195,0)
</xsl:stylesheet>
"KRN",.84,7981015.002,-1)
0^66
"KRN",.84,7981015.002,0)
7981015.002^2^^CLINICAL CASE REGISTRIES^Procedures (CSV)
"KRN",.84,7981015.002,2,0)
^^95^95^3051026^
"KRN",.84,7981015.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981015.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981015.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981015.002,2,4,0)
>
"KRN",.84,7981015.002,2,5,0)
 
"KRN",.84,7981015.002,2,6,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981015.002,2,7,0)
 
"KRN",.84,7981015.002,2,8,0)
<xsl:template match="/">
"KRN",.84,7981015.002,2,9,0)
 <xsl:apply-templates select="/REPORT/CPTLST"/>
"KRN",.84,7981015.002,2,10,0)
 <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981015.002,2,11,0)
</xsl:template>
"KRN",.84,7981015.002,2,12,0)
 
"KRN",.84,7981015.002,2,13,0)
<xsl:template match="REPORT/CPTLST">
"KRN",.84,7981015.002,2,14,0)
 <xsl:text>Procedures (CPT Codes)</xsl:text>
"KRN",.84,7981015.002,2,15,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981015.002,2,16,0)
 <xsl:value-of select="$FILESWITCH"/>
"KRN",.84,7981015.002,2,17,0)
</xsl:template>
"KRN",.84,7981015.002,2,18,0)
 
"KRN",.84,7981015.002,2,19,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981015.002,2,20,0)
 <xsl:text>Diagnoses (Patients)</xsl:text>
"KRN",.84,7981015.002,2,21,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981015.002,2,22,0)
 <xsl:value-of select="$FILESWITCH"/>
"KRN",.84,7981015.002,2,23,0)
</xsl:template>
"KRN",.84,7981015.002,2,24,0)
 
"KRN",.84,7981015.002,2,25,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981015.002,2,26,0)
 <xsl:variable name="ptname" select="NAME"/>
"KRN",.84,7981015.002,2,27,0)
 <xsl:variable name="ssn" select="LAST4"/>
"KRN",.84,7981015.002,2,28,0)
 <xsl:variable name="dod" select="DOD"/>
"KRN",.84,7981015.002,2,29,0)
 <xsl:for-each select="PTCPTL/CPT">
"KRN",.84,7981015.002,2,30,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,31,0)
   <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981015.002,2,32,0)
  </xsl:call-template>
"KRN",.84,7981015.002,2,33,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,34,0)
   <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981015.002,2,35,0)
  </xsl:call-template>
"KRN",.84,7981015.002,2,36,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,37,0)
   <xsl:with-param name="value" select="$dod"/>
"KRN",.84,7981015.002,2,38,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981015.002,2,39,0)
  </xsl:call-template>
"KRN",.84,7981015.002,2,40,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,41,0)
   <xsl:with-param name="value" select="CODE"/>
"KRN",.84,7981015.002,2,42,0)
  </xsl:call-template>
"KRN",.84,7981015.002,2,43,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,44,0)
   <xsl:with-param name="value" select="DESCR"/>
"KRN",.84,7981015.002,2,45,0)
  </xsl:call-template>
"KRN",.84,7981015.002,2,46,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,47,0)
   <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981015.002,2,48,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981015.002,2,49,0)
  </xsl:call-template>
"KRN",.84,7981015.002,2,50,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,51,0)
   <xsl:with-param name="value" select="SOURCE"/>
"KRN",.84,7981015.002,2,52,0)
  </xsl:call-template>
"KRN",.84,7981015.002,2,53,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981015.002,2,54,0)
 </xsl:for-each>
"KRN",.84,7981015.002,2,55,0)
</xsl:template>
"KRN",.84,7981015.002,2,56,0)
 
"KRN",.84,7981015.002,2,57,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981015.002,2,58,0)
 
"KRN",.84,7981015.002,2,59,0)
<xsl:template match="COLUMN[@NAME='CODE']">
"KRN",.84,7981015.002,2,60,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.002,2,61,0)
  <xsl:with-param name="title" select="'Code'"/>
"KRN",.84,7981015.002,2,62,0)
 </xsl:call-template>
"KRN",.84,7981015.002,2,63,0)
</xsl:template>
"KRN",.84,7981015.002,2,64,0)
 
"KRN",.84,7981015.002,2,65,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981015.002,2,66,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.002,2,67,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981015.002,2,68,0)
 </xsl:call-template>
"KRN",.84,7981015.002,2,69,0)
</xsl:template>
"KRN",.84,7981015.002,2,70,0)
 
"KRN",.84,7981015.002,2,71,0)
<xsl:template match="COLUMN[@NAME='DESCR']">
"KRN",.84,7981015.002,2,72,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.002,2,73,0)
  <xsl:with-param name="title" select="'Short Name'"/>
"KRN",.84,7981015.002,2,74,0)
 </xsl:call-template>
"KRN",.84,7981015.002,2,75,0)
</xsl:template>
"KRN",.84,7981015.002,2,76,0)
 
"KRN",.84,7981015.002,2,77,0)
<xsl:template match="COLUMN[@NAME='NC']">
"KRN",.84,7981015.002,2,78,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.002,2,79,0)
  <xsl:with-param name="title" select="'Number of Codes'"/>
"KRN",.84,7981015.002,2,80,0)
 </xsl:call-template>
"KRN",.84,7981015.002,2,81,0)
</xsl:template>
"KRN",.84,7981015.002,2,82,0)
 
"KRN",.84,7981015.002,2,83,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981015.002,2,84,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.002,2,85,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981015.002,2,86,0)
 </xsl:call-template>
"KRN",.84,7981015.002,2,87,0)
</xsl:template>
"KRN",.84,7981015.002,2,88,0)
 
"KRN",.84,7981015.002,2,89,0)
<xsl:template match="COLUMN[@NAME='SOURCE']">
"KRN",.84,7981015.002,2,90,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.002,2,91,0)
  <xsl:with-param name="title" select="'Source'"/>
"KRN",.84,7981015.002,2,92,0)
 </xsl:call-template>
"KRN",.84,7981015.002,2,93,0)
</xsl:template>
"KRN",.84,7981015.002,2,94,0)
 
"KRN",.84,7981015.002,2,95,0)
</xsl:stylesheet>
"KRN",.84,7981016.001,-1)
0^63
"KRN",.84,7981016.001,0)
7981016.001^2^^CLINICAL CASE REGISTRIES^Outpatient Utilization (HTML)
"KRN",.84,7981016.001,2,0)
^^166^166^3050914^
"KRN",.84,7981016.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981016.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981016.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981016.001,2,4,0)
>
"KRN",.84,7981016.001,2,5,0)
 
"KRN",.84,7981016.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981016.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981016.001,2,8,0)
 
"KRN",.84,7981016.001,2,9,0)
<xsl:template match="/">
"KRN",.84,7981016.001,2,10,0)
 <html>
"KRN",.84,7981016.001,2,11,0)
  <head>
"KRN",.84,7981016.001,2,12,0)
   <title>Outpatient Utilization</title>
"KRN",.84,7981016.001,2,13,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981016.001,2,14,0)
  </head>
"KRN",.84,7981016.001,2,15,0)
  <body>
"KRN",.84,7981016.001,2,16,0)
   <h1>Outpatient Utilization</h1>
"KRN",.84,7981016.001,2,17,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981016.001,2,18,0)
   <xsl:choose>
"KRN",.84,7981016.001,2,19,0)
    <xsl:when test="REPORT/OUTPATIENTS">
"KRN",.84,7981016.001,2,20,0)
     <div style="page-break-before:always">
"KRN",.84,7981016.001,2,21,0)
      <xsl:call-template name="OutpatientSummary"/>
"KRN",.84,7981016.001,2,22,0)
      <xsl:apply-templates select="REPORT/OUTPATIENTS/*[@TABLE]"/>
"KRN",.84,7981016.001,2,23,0)
     </div>
"KRN",.84,7981016.001,2,24,0)
    </xsl:when>
"KRN",.84,7981016.001,2,25,0)
    <xsl:otherwise>
"KRN",.84,7981016.001,2,26,0)
     <xsl:call-template name="TableNoData"/>
"KRN",.84,7981016.001,2,27,0)
    </xsl:otherwise>
"KRN",.84,7981016.001,2,28,0)
   </xsl:choose>
"KRN",.84,7981016.001,2,29,0)
   <xsl:if test="REPORT/HIGHUTIL">
"KRN",.84,7981016.001,2,30,0)
    <div style="page-break-before:always">
"KRN",.84,7981016.001,2,31,0)
     <h2>Highest Utilization</h2>
"KRN",.84,7981016.001,2,32,0)
     <xsl:apply-templates select="REPORT/HIGHUTIL/*"/>
"KRN",.84,7981016.001,2,33,0)
    </div>
"KRN",.84,7981016.001,2,34,0)
   </xsl:if>
"KRN",.84,7981016.001,2,35,0)
  </body>
"KRN",.84,7981016.001,2,36,0)
 </html>
"KRN",.84,7981016.001,2,37,0)
</xsl:template>
"KRN",.84,7981016.001,2,38,0)
 
"KRN",.84,7981016.001,2,39,0)
<xsl:template match="HIGHUTIL/HU_STOPS">
"KRN",.84,7981016.001,2,40,0)
 <h3><xsl:call-template name="HUPatientsHeader"/> by number of stop codes</h3>
"KRN",.84,7981016.001,2,41,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981016.001,2,42,0)
</xsl:template>
"KRN",.84,7981016.001,2,43,0)
 
"KRN",.84,7981016.001,2,44,0)
<xsl:template match="OUTPATIENTS/CLINICS">
"KRN",.84,7981016.001,2,45,0)
 <h3>Distribution of Utilization among Clinics</h3>
"KRN",.84,7981016.001,2,46,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981016.001,2,47,0)
</xsl:template>
"KRN",.84,7981016.001,2,48,0)
 
"KRN",.84,7981016.001,2,49,0)
<xsl:template match="OUTPATIENTS/STOPS">
"KRN",.84,7981016.001,2,50,0)
 <br clear="both"/>
"KRN",.84,7981016.001,2,51,0)
 <xsl:call-template name="DataGrid">
"KRN",.84,7981016.001,2,52,0)
  <xsl:with-param name="divstyle" select="'width:50%'"/>
"KRN",.84,7981016.001,2,53,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,54,0)
</xsl:template>
"KRN",.84,7981016.001,2,55,0)
 
"KRN",.84,7981016.001,2,56,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981016.001,2,57,0)
 
"KRN",.84,7981016.001,2,58,0)
<xsl:template name="OutpatientSummary">
"KRN",.84,7981016.001,2,59,0)
 <xsl:variable name="OP" select="/REPORT/OUTPATIENTS"/>
"KRN",.84,7981016.001,2,60,0)
 <xsl:text>
"KRN",.84,7981016.001,2,61,0)
  A total of 1.00 visit is given for outpatient activity on a given date.
"KRN",.84,7981016.001,2,62,0)
  A 'stop' is credited for each entry of a stop code, while a 'visit' is
"KRN",.84,7981016.001,2,63,0)
  split among each stop credited on a given date. Thus, a single visit with
"KRN",.84,7981016.001,2,64,0)
  two stop codes credited will show as 0.5 visit for each stop code. 
"KRN",.84,7981016.001,2,65,0)
 </xsl:text>
"KRN",.84,7981016.001,2,66,0)
 <br/>
"KRN",.84,7981016.001,2,67,0)
 <table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981016.001,2,68,0)
  <thead>
"KRN",.84,7981016.001,2,69,0)
   <tr>
"KRN",.84,7981016.001,2,70,0)
    <th width="33%">Number of Patients</th>
"KRN",.84,7981016.001,2,71,0)
    <th width="33%">Number of Visits</th>
"KRN",.84,7981016.001,2,72,0)
    <th width="33%">Number of Stops</th>
"KRN",.84,7981016.001,2,73,0)
   </tr>
"KRN",.84,7981016.001,2,74,0)
  </thead>
"KRN",.84,7981016.001,2,75,0)
  <tbody>
"KRN",.84,7981016.001,2,76,0)
   <tr>
"KRN",.84,7981016.001,2,77,0)
    <td><xsl:value-of select="$OP/NP"/></td>
"KRN",.84,7981016.001,2,78,0)
    <td><xsl:value-of select="$OP/NV"/></td>
"KRN",.84,7981016.001,2,79,0)
    <td><xsl:value-of select="$OP/NSC"/></td>
"KRN",.84,7981016.001,2,80,0)
   </tr>
"KRN",.84,7981016.001,2,81,0)
  </tbody>
"KRN",.84,7981016.001,2,82,0)
 </table>
"KRN",.84,7981016.001,2,83,0)
</xsl:template>
"KRN",.84,7981016.001,2,84,0)
 
"KRN",.84,7981016.001,2,85,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981016.001,2,86,0)
 
"KRN",.84,7981016.001,2,87,0)
<xsl:template match="COLUMN[@NAME='NAME']">
"KRN",.84,7981016.001,2,88,0)
 <xsl:variable name="tblname" select="../@NAME"/>
"KRN",.84,7981016.001,2,89,0)
 <xsl:choose>
"KRN",.84,7981016.001,2,90,0)
  <xsl:when test="$tblname='CLINICS'">
"KRN",.84,7981016.001,2,91,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,92,0)
    <xsl:with-param name="title" select="'Clinic'"/>
"KRN",.84,7981016.001,2,93,0)
   </xsl:call-template> 
"KRN",.84,7981016.001,2,94,0)
  </xsl:when>
"KRN",.84,7981016.001,2,95,0)
  <xsl:when test="contains($tblname,'HU_')">
"KRN",.84,7981016.001,2,96,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,97,0)
    <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981016.001,2,98,0)
   </xsl:call-template> 
"KRN",.84,7981016.001,2,99,0)
  </xsl:when>
"KRN",.84,7981016.001,2,100,0)
  <xsl:otherwise>
"KRN",.84,7981016.001,2,101,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,102,0)
    <xsl:with-param name="title" select="'Name'"/>
"KRN",.84,7981016.001,2,103,0)
   </xsl:call-template> 
"KRN",.84,7981016.001,2,104,0)
  </xsl:otherwise>
"KRN",.84,7981016.001,2,105,0)
 </xsl:choose>
"KRN",.84,7981016.001,2,106,0)
</xsl:template>
"KRN",.84,7981016.001,2,107,0)
 
"KRN",.84,7981016.001,2,108,0)
<xsl:template match="COLUMN[@NAME='NDS']">
"KRN",.84,7981016.001,2,109,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,110,0)
  <xsl:with-param name="title" select="'Number of Different Stops'"/>
"KRN",.84,7981016.001,2,111,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981016.001,2,112,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981016.001,2,113,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,114,0)
</xsl:template>
"KRN",.84,7981016.001,2,115,0)
 
"KRN",.84,7981016.001,2,116,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981016.001,2,117,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,118,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981016.001,2,119,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981016.001,2,120,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,121,0)
</xsl:template>
"KRN",.84,7981016.001,2,122,0)
 
"KRN",.84,7981016.001,2,123,0)
<xsl:template match="COLUMN[@NAME='NSC']">
"KRN",.84,7981016.001,2,124,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,125,0)
  <xsl:with-param name="title" select="'Number of Stops'"/>
"KRN",.84,7981016.001,2,126,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981016.001,2,127,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981016.001,2,128,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,129,0)
</xsl:template>
"KRN",.84,7981016.001,2,130,0)
 
"KRN",.84,7981016.001,2,131,0)
<xsl:template match="COLUMN[@NAME='NV']">
"KRN",.84,7981016.001,2,132,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,133,0)
  <xsl:with-param name="title" select="'Number of Visits'"/>
"KRN",.84,7981016.001,2,134,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981016.001,2,135,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981016.001,2,136,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,137,0)
</xsl:template>
"KRN",.84,7981016.001,2,138,0)
 
"KRN",.84,7981016.001,2,139,0)
<xsl:template match="COLUMN[@NAME='STOP']">
"KRN",.84,7981016.001,2,140,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,141,0)
  <xsl:with-param name="title" select="'Stop Code'"/>
"KRN",.84,7981016.001,2,142,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981016.001,2,143,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,144,0)
</xsl:template>
"KRN",.84,7981016.001,2,145,0)
 
"KRN",.84,7981016.001,2,146,0)
<!--[ CELL VALUES ]-->
"KRN",.84,7981016.001,2,147,0)
 
"KRN",.84,7981016.001,2,148,0)
<xsl:template match="NOBS/PATIENT/DATE">
"KRN",.84,7981016.001,2,149,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981016.001,2,150,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981016.001,2,151,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,152,0)
</xsl:template>
"KRN",.84,7981016.001,2,153,0)
 
"KRN",.84,7981016.001,2,154,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981016.001,2,155,0)
 
"KRN",.84,7981016.001,2,156,0)
<xsl:template match="PARAMETERS/MAXUTNUM">
"KRN",.84,7981016.001,2,157,0)
 <tr>
"KRN",.84,7981016.001,2,158,0)
  <th scope="row">MaxUtil:&#160;</th>
"KRN",.84,7981016.001,2,159,0)
  <td>
"KRN",.84,7981016.001,2,160,0)
   <xsl:value-of select="."/>
"KRN",.84,7981016.001,2,161,0)
   (maximum number of patients with highest utilization to display)
"KRN",.84,7981016.001,2,162,0)
  </td>
"KRN",.84,7981016.001,2,163,0)
 </tr>
"KRN",.84,7981016.001,2,164,0)
</xsl:template>
"KRN",.84,7981016.001,2,165,0)
 
"KRN",.84,7981016.001,2,166,0)
</xsl:stylesheet>
"KRN",.84,7981016.002,-1)
0^64
"KRN",.84,7981016.002,0)
7981016.002^2^^CLINICAL CASE REGISTRIES^Outpatient Utilization (CSV)
"KRN",.84,7981016.002,2,0)
^.844^88^88^3050914^^
"KRN",.84,7981016.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981016.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981016.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981016.002,2,4,0)
>
"KRN",.84,7981016.002,2,5,0)
 
"KRN",.84,7981016.002,2,6,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981016.002,2,7,0)
 
"KRN",.84,7981016.002,2,8,0)
<xsl:variable name="UTILIZATION_HEADER"
"KRN",.84,7981016.002,2,9,0)
     select="'Outpatient Utilization'"/>
"KRN",.84,7981016.002,2,10,0)
 
"KRN",.84,7981016.002,2,11,0)
<xsl:template match="/">
"KRN",.84,7981016.002,2,12,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981016.002,2,13,0)
  <xsl:with-param name="data" select="REPORT/OUTPATIENTS/STOPS"/>
"KRN",.84,7981016.002,2,14,0)
  <xsl:with-param name="subttl" select="'Stops'"/>
"KRN",.84,7981016.002,2,15,0)
 </xsl:call-template>
"KRN",.84,7981016.002,2,16,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981016.002,2,17,0)
  <xsl:with-param name="data" select="REPORT/OUTPATIENTS/CLINICS"/>
"KRN",.84,7981016.002,2,18,0)
  <xsl:with-param name="subttl"
"KRN",.84,7981016.002,2,19,0)
       select="'Distribution of Utilization among Clinics'"/>
"KRN",.84,7981016.002,2,20,0)
 </xsl:call-template>
"KRN",.84,7981016.002,2,21,0)
 <xsl:call-template name="UtilizationSection">
"KRN",.84,7981016.002,2,22,0)
  <xsl:with-param name="data" select="REPORT/HIGHUTIL/HU_STOPS"/>
"KRN",.84,7981016.002,2,23,0)
  <xsl:with-param name="subttl" select="'Highest Utilization of Stop Codes'"/>
"KRN",.84,7981016.002,2,24,0)
 </xsl:call-template>
"KRN",.84,7981016.002,2,25,0)
</xsl:template>
"KRN",.84,7981016.002,2,26,0)
 
"KRN",.84,7981016.002,2,27,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981016.002,2,28,0)
 
"KRN",.84,7981016.002,2,29,0)
<xsl:template match="COLUMN[@NAME='NAME']">
"KRN",.84,7981016.002,2,30,0)
 <xsl:variable name="tblname" select="../@NAME"/>
"KRN",.84,7981016.002,2,31,0)
 <xsl:choose>
"KRN",.84,7981016.002,2,32,0)
  <xsl:when test="$tblname='CLINICS'">
"KRN",.84,7981016.002,2,33,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,34,0)
    <xsl:with-param name="title" select="'Clinic'"/>
"KRN",.84,7981016.002,2,35,0)
   </xsl:call-template> 
"KRN",.84,7981016.002,2,36,0)
  </xsl:when>
"KRN",.84,7981016.002,2,37,0)
  <xsl:when test="contains($tblname,'HU_')">
"KRN",.84,7981016.002,2,38,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,39,0)
    <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981016.002,2,40,0)
   </xsl:call-template> 
"KRN",.84,7981016.002,2,41,0)
  </xsl:when>
"KRN",.84,7981016.002,2,42,0)
  <xsl:otherwise>
"KRN",.84,7981016.002,2,43,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,44,0)
    <xsl:with-param name="title" select="'Name'"/>
"KRN",.84,7981016.002,2,45,0)
   </xsl:call-template> 
"KRN",.84,7981016.002,2,46,0)
  </xsl:otherwise>
"KRN",.84,7981016.002,2,47,0)
 </xsl:choose>
"KRN",.84,7981016.002,2,48,0)
</xsl:template>
"KRN",.84,7981016.002,2,49,0)
 
"KRN",.84,7981016.002,2,50,0)
<xsl:template match="COLUMN[@NAME='NDS']">
"KRN",.84,7981016.002,2,51,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,52,0)
  <xsl:with-param name="title" select="'Number of Different Stops'"/>
"KRN",.84,7981016.002,2,53,0)
 </xsl:call-template>
"KRN",.84,7981016.002,2,54,0)
</xsl:template>
"KRN",.84,7981016.002,2,55,0)
 
"KRN",.84,7981016.002,2,56,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981016.002,2,57,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,58,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981016.002,2,59,0)
 </xsl:call-template>
"KRN",.84,7981016.002,2,60,0)
</xsl:template>
"KRN",.84,7981016.002,2,61,0)
 
"KRN",.84,7981016.002,2,62,0)
<xsl:template match="COLUMN[@NAME='NSC']">
"KRN",.84,7981016.002,2,63,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,64,0)
  <xsl:with-param name="title" select="'Number of Stops'"/>
"KRN",.84,7981016.002,2,65,0)
 </xsl:call-template>
"KRN",.84,7981016.002,2,66,0)
</xsl:template>
"KRN",.84,7981016.002,2,67,0)
 
"KRN",.84,7981016.002,2,68,0)
<xsl:template match="COLUMN[@NAME='NV']">
"KRN",.84,7981016.002,2,69,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,70,0)
  <xsl:with-param name="title" select="'Number of Visits'"/>
"KRN",.84,7981016.002,2,71,0)
 </xsl:call-template>
"KRN",.84,7981016.002,2,72,0)
</xsl:template>
"KRN",.84,7981016.002,2,73,0)
 
"KRN",.84,7981016.002,2,74,0)
<xsl:template match="COLUMN[@NAME='STOP']">
"KRN",.84,7981016.002,2,75,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,76,0)
  <xsl:with-param name="title" select="'Stop Code'"/>
"KRN",.84,7981016.002,2,77,0)
 </xsl:call-template>
"KRN",.84,7981016.002,2,78,0)
</xsl:template>
"KRN",.84,7981016.002,2,79,0)
 
"KRN",.84,7981016.002,2,80,0)
<!--[ CELL VALUES ]-->
"KRN",.84,7981016.002,2,81,0)
 
"KRN",.84,7981016.002,2,82,0)
<xsl:template match="NOBS/PATIENT/DATE">
"KRN",.84,7981016.002,2,83,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981016.002,2,84,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981016.002,2,85,0)
 </xsl:call-template>
"KRN",.84,7981016.002,2,86,0)
</xsl:template>
"KRN",.84,7981016.002,2,87,0)
 
"KRN",.84,7981016.002,2,88,0)
</xsl:stylesheet>
"KRN",.84,7981995.001,-1)
0^50
"KRN",.84,7981995.001,0)
7981995.001^2^^CLINICAL CASE REGISTRIES^Lab data templates (HTML)
"KRN",.84,7981995.001,2,0)
^.844^92^92^3051207^^^
"KRN",.84,7981995.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981995.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981995.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981995.001,2,4,0)
>
"KRN",.84,7981995.001,2,5,0)
 
"KRN",.84,7981995.001,2,6,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981995.001,2,7,0)
 
"KRN",.84,7981995.001,2,8,0)
<xsl:template name="BasicLRHeader">
"KRN",.84,7981995.001,2,9,0)
 <xsl:param name="colname" select="'NAME'"/>
"KRN",.84,7981995.001,2,10,0)
 <xsl:param name="group" select="0"/>
"KRN",.84,7981995.001,2,11,0)
 <xsl:param name="tblname" select="'PTLRL'"/>
"KRN",.84,7981995.001,2,12,0)
 <xsl:if test="$group">
"KRN",.84,7981995.001,2,13,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981995.001,2,14,0)
   <xsl:with-param name="sort" select="concat($tblname,'=GROUP')"/>
"KRN",.84,7981995.001,2,15,0)
   <xsl:with-param name="title" select="'Group'"/>
"KRN",.84,7981995.001,2,16,0)
   <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981995.001,2,17,0)
  </xsl:call-template>
"KRN",.84,7981995.001,2,18,0)
 </xsl:if>
"KRN",.84,7981995.001,2,19,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981995.001,2,20,0)
  <xsl:with-param name="sort" select="concat($tblname,'=DATE')"/>
"KRN",.84,7981995.001,2,21,0)
  <xsl:with-param name="title" select="'Date'"/>    
"KRN",.84,7981995.001,2,22,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981995.001,2,23,0)
 </xsl:call-template>
"KRN",.84,7981995.001,2,24,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981995.001,2,25,0)
  <xsl:with-param name="sort" select="concat($tblname,'=',$colname)"/>
"KRN",.84,7981995.001,2,26,0)
  <xsl:with-param name="title" select="'Test Name'"/>    
"KRN",.84,7981995.001,2,27,0)
 </xsl:call-template>
"KRN",.84,7981995.001,2,28,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981995.001,2,29,0)
  <xsl:with-param name="sort" select="concat($tblname,'=RESULT')"/>
"KRN",.84,7981995.001,2,30,0)
  <xsl:with-param name="title" select="'Result'"/>
"KRN",.84,7981995.001,2,31,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981995.001,2,32,0)
 </xsl:call-template>
"KRN",.84,7981995.001,2,33,0)
</xsl:template>
"KRN",.84,7981995.001,2,34,0)
 
"KRN",.84,7981995.001,2,35,0)
<xsl:template name="BasicLRData">
"KRN",.84,7981995.001,2,36,0)
 <xsl:param name="group" select="0"/>
"KRN",.84,7981995.001,2,37,0)
 <xsl:param name="name" select="NAME"/>
"KRN",.84,7981995.001,2,38,0)
 <xsl:if test="$group">
"KRN",.84,7981995.001,2,39,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981995.001,2,40,0)
   <xsl:with-param name="value" select="GROUP"/>
"KRN",.84,7981995.001,2,41,0)
  </xsl:call-template>
"KRN",.84,7981995.001,2,42,0)
 </xsl:if>
"KRN",.84,7981995.001,2,43,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981995.001,2,44,0)
  <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981995.001,2,45,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981995.001,2,46,0)
 </xsl:call-template>
"KRN",.84,7981995.001,2,47,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981995.001,2,48,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981995.001,2,49,0)
  <xsl:with-param name="value" select="$name"/>
"KRN",.84,7981995.001,2,50,0)
 </xsl:call-template>
"KRN",.84,7981995.001,2,51,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981995.001,2,52,0)
  <xsl:with-param name="value" select="RESULT"/>
"KRN",.84,7981995.001,2,53,0)
 </xsl:call-template>
"KRN",.84,7981995.001,2,54,0)
</xsl:template>
"KRN",.84,7981995.001,2,55,0)
 
"KRN",.84,7981995.001,2,56,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981995.001,2,57,0)
 
"KRN",.84,7981995.001,2,58,0)
<xsl:template match="PARAMETERS/LABTESTS">
"KRN",.84,7981995.001,2,59,0)
 <tr>
"KRN",.84,7981995.001,2,60,0)
  <th scope="row">Lab Tests:&#160;</th>
"KRN",.84,7981995.001,2,61,0)
  <td>
"KRN",.84,7981995.001,2,62,0)
   <xsl:if test="@DESCR">
"KRN",.84,7981995.001,2,63,0)
    <xsl:value-of select="@DESCR"/><br/>
"KRN",.84,7981995.001,2,64,0)
   </xsl:if>
"KRN",.84,7981995.001,2,65,0)
   <xsl:if test=".='ALL'">ALL</xsl:if>
"KRN",.84,7981995.001,2,66,0)
   <xsl:apply-templates select="LT[@LOW|@HIGH]"/>
"KRN",.84,7981995.001,2,67,0)
   <xsl:apply-templates select="LT[not(@LOW|@HIGH)]"/>
"KRN",.84,7981995.001,2,68,0)
  </td>
"KRN",.84,7981995.001,2,69,0)
 </tr>
"KRN",.84,7981995.001,2,70,0)
</xsl:template>
"KRN",.84,7981995.001,2,71,0)
 
"KRN",.84,7981995.001,2,72,0)
<xsl:template match="PARAMETERS/LABTESTS/LT[@LOW|@HIGH]">
"KRN",.84,7981995.001,2,73,0)
 <xsl:variable name="low" select="@LOW"/>
"KRN",.84,7981995.001,2,74,0)
 <xsl:variable name="high" select="@HIGH"/>
"KRN",.84,7981995.001,2,75,0)
 <xsl:value-of select="."/>
"KRN",.84,7981995.001,2,76,0)
 <xsl:text> - results</xsl:text>
"KRN",.84,7981995.001,2,77,0)
 <xsl:if test="$low">
"KRN",.84,7981995.001,2,78,0)
  <xsl:value-of select="concat(' not less than ',$low)"/>
"KRN",.84,7981995.001,2,79,0)
 </xsl:if>
"KRN",.84,7981995.001,2,80,0)
 <xsl:if test="$high">
"KRN",.84,7981995.001,2,81,0)
  <xsl:if test="$low"> and</xsl:if>
"KRN",.84,7981995.001,2,82,0)
  <xsl:value-of select="concat(' not greater than ',$high)"/>
"KRN",.84,7981995.001,2,83,0)
 </xsl:if>
"KRN",.84,7981995.001,2,84,0)
 <br/>
"KRN",.84,7981995.001,2,85,0)
</xsl:template>
"KRN",.84,7981995.001,2,86,0)
 
"KRN",.84,7981995.001,2,87,0)
<xsl:template match="PARAMETERS/LABTESTS/LT[not(@LOW|@HIGH)]">
"KRN",.84,7981995.001,2,88,0)
 <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981995.001,2,89,0)
 <xsl:value-of select="."/>
"KRN",.84,7981995.001,2,90,0)
</xsl:template>
"KRN",.84,7981995.001,2,91,0)
 
"KRN",.84,7981995.001,2,92,0)
</xsl:stylesheet>
"KRN",.84,7981996.001,-1)
0^51
"KRN",.84,7981996.001,0)
7981996.001^2^^CLINICAL CASE REGISTRIES^Pharmacy data templates (HTML)
"KRN",.84,7981996.001,2,0)
^.844^63^63^3051025^^^
"KRN",.84,7981996.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981996.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981996.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981996.001,2,4,0)
 
"KRN",.84,7981996.001,2,5,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981996.001,2,6,0)
 
"KRN",.84,7981996.001,2,7,0)
<xsl:template
"KRN",.84,7981996.001,2,8,0)
     match="TBLDEF[starts-with(@NAME,'DRUGS') or @NAME='PTRXL']/COLUMN[@NAME='NAME']">
"KRN",.84,7981996.001,2,9,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981996.001,2,10,0)
  <xsl:with-param name="title" select="'Drug Name'"/>
"KRN",.84,7981996.001,2,11,0)
 </xsl:call-template>
"KRN",.84,7981996.001,2,12,0)
</xsl:template>
"KRN",.84,7981996.001,2,13,0)
 
"KRN",.84,7981996.001,2,14,0)
<!--[ PHARMACY REPORT PARAMETERS ]-->
"KRN",.84,7981996.001,2,15,0)
 
"KRN",.84,7981996.001,2,16,0)
<xsl:template match="PARAMETERS/DRUGS">
"KRN",.84,7981996.001,2,17,0)
 <tr>
"KRN",.84,7981996.001,2,18,0)
  <th scope="row">Meds:&#160;</th>
"KRN",.84,7981996.001,2,19,0)
  <td>
"KRN",.84,7981996.001,2,20,0)
   <dl>
"KRN",.84,7981996.001,2,21,0)
    <xsl:if test="@DESCR!=''">
"KRN",.84,7981996.001,2,22,0)
     <dt><xsl:value-of select="@DESCR"/></dt>
"KRN",.84,7981996.001,2,23,0)
    </xsl:if>
"KRN",.84,7981996.001,2,24,0)
    <xsl:if test=".='ALL'"><dt>ALL</dt></xsl:if>
"KRN",.84,7981996.001,2,25,0)
    <xsl:apply-templates select="GROUP"/>
"KRN",.84,7981996.001,2,26,0)
   </dl>
"KRN",.84,7981996.001,2,27,0)
  </td>
"KRN",.84,7981996.001,2,28,0)
 </tr>
"KRN",.84,7981996.001,2,29,0)
</xsl:template>
"KRN",.84,7981996.001,2,30,0)
 
"KRN",.84,7981996.001,2,31,0)
<xsl:template match="PARAMETERS/DRUGS/GROUP">
"KRN",.84,7981996.001,2,32,0)
 <dt><b><xsl:value-of select="@NAME"/></b></dt>
"KRN",.84,7981996.001,2,33,0)
 <dd><dl>
"KRN",.84,7981996.001,2,34,0)
  <xsl:if test="@DESCR!=''">
"KRN",.84,7981996.001,2,35,0)
   <dt><xsl:value-of select="@DESCR"/></dt>
"KRN",.84,7981996.001,2,36,0)
  </xsl:if>
"KRN",.84,7981996.001,2,37,0)
  <xsl:apply-templates select="*"/>
"KRN",.84,7981996.001,2,38,0)
 </dl></dd>
"KRN",.84,7981996.001,2,39,0)
</xsl:template>
"KRN",.84,7981996.001,2,40,0)
 
"KRN",.84,7981996.001,2,41,0)
<xsl:template match="PARAMETERS/DRUGS/GROUP/FORMULATIONS">
"KRN",.84,7981996.001,2,42,0)
 <dt><b>Individual Formulations</b></dt>
"KRN",.84,7981996.001,2,43,0)
 <dd><xsl:call-template name="ParamsDrugList"/></dd>
"KRN",.84,7981996.001,2,44,0)
</xsl:template>
"KRN",.84,7981996.001,2,45,0)
 
"KRN",.84,7981996.001,2,46,0)
<xsl:template match="PARAMETERS/DRUGS/GROUP/GENERIC">
"KRN",.84,7981996.001,2,47,0)
 <dt><b>Generic Names</b></dt>
"KRN",.84,7981996.001,2,48,0)
 <dd><xsl:call-template name="ParamsDrugList"/></dd>
"KRN",.84,7981996.001,2,49,0)
</xsl:template>
"KRN",.84,7981996.001,2,50,0)
 
"KRN",.84,7981996.001,2,51,0)
<xsl:template match="PARAMETERS/DRUGS/GROUP/VARXCLS">
"KRN",.84,7981996.001,2,52,0)
 <dt><b>VA Drug Classes</b></dt>
"KRN",.84,7981996.001,2,53,0)
 <dd><xsl:call-template name="ParamsDrugList"/></dd>
"KRN",.84,7981996.001,2,54,0)
</xsl:template>
"KRN",.84,7981996.001,2,55,0)
 
"KRN",.84,7981996.001,2,56,0)
<xsl:template name="ParamsDrugList">
"KRN",.84,7981996.001,2,57,0)
 <xsl:for-each select="*">
"KRN",.84,7981996.001,2,58,0)
  <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981996.001,2,59,0)
  <xsl:value-of select="."/>
"KRN",.84,7981996.001,2,60,0)
 </xsl:for-each>
"KRN",.84,7981996.001,2,61,0)
</xsl:template>
"KRN",.84,7981996.001,2,62,0)
 
"KRN",.84,7981996.001,2,63,0)
</xsl:stylesheet>
"KRN",.84,7981997.001,-1)
0^52
"KRN",.84,7981997.001,0)
7981997.001^2^^CLINICAL CASE REGISTRIES^Patient data templates (HTML)
"KRN",.84,7981997.001,2,0)
^.844^207^207^3050915^^
"KRN",.84,7981997.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981997.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981997.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981997.001,2,4,0)
 
"KRN",.84,7981997.001,2,5,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981997.001,2,6,0)
 
"KRN",.84,7981997.001,2,7,0)
<xsl:template name="BasicPatientHeader">
"KRN",.84,7981997.001,2,8,0)
 <xsl:param name="rowspan" select="1"/>
"KRN",.84,7981997.001,2,9,0)
 <xsl:param name="seqnum" select="1"/>
"KRN",.84,7981997.001,2,10,0)
 <xsl:param name="tblname" select="'PATIENTS'"/>
"KRN",.84,7981997.001,2,11,0)
 <xsl:if test="$seqnum">
"KRN",.84,7981997.001,2,12,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,13,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,14,0)
   <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981997.001,2,15,0)
   <xsl:with-param name="title" select="'#'"/>
"KRN",.84,7981997.001,2,16,0)
   <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981997.001,2,17,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,18,0)
 </xsl:if>
"KRN",.84,7981997.001,2,19,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,20,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,21,0)
  <xsl:with-param name="sort" select="concat($tblname,'=NAME')"/>
"KRN",.84,7981997.001,2,22,0)
  <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981997.001,2,23,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,24,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,25,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,26,0)
  <xsl:with-param name="sort" select="concat($tblname,'=LAST4')"/>
"KRN",.84,7981997.001,2,27,0)
  <xsl:with-param name="title" select="'SSN'"/>
"KRN",.84,7981997.001,2,28,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,29,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,30,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,31,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,32,0)
  <xsl:with-param name="sort" select="concat($tblname,'=DOD')"/>
"KRN",.84,7981997.001,2,33,0)
  <xsl:with-param name="title" select="'Date of Death'"/>
"KRN",.84,7981997.001,2,34,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,35,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,36,0)
</xsl:template>
"KRN",.84,7981997.001,2,37,0)
 
"KRN",.84,7981997.001,2,38,0)
<xsl:template name="BasicPatientData">
"KRN",.84,7981997.001,2,39,0)
 <xsl:param name="rowspan" select="1"/>
"KRN",.84,7981997.001,2,40,0)
 <xsl:param name="seqnum" select="1"/>
"KRN",.84,7981997.001,2,41,0)
 <xsl:if test="$seqnum">
"KRN",.84,7981997.001,2,42,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,43,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,44,0)
   <xsl:with-param name="value" select="position()"/>
"KRN",.84,7981997.001,2,45,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,46,0)
 </xsl:if>
"KRN",.84,7981997.001,2,47,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,48,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,49,0)
  <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981997.001,2,50,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981997.001,2,51,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,52,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,53,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,54,0)
  <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981997.001,2,55,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,56,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,57,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,58,0)
  <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981997.001,2,59,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,60,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,61,0)
</xsl:template>
"KRN",.84,7981997.001,2,62,0)
 
"KRN",.84,7981997.001,2,63,0)
<!--[ PATIENT TABLE HEADINGS ]-->
"KRN",.84,7981997.001,2,64,0)
 
"KRN",.84,7981997.001,2,65,0)
<xsl:template match="COLUMN[@NAME='ADMDT']">
"KRN",.84,7981997.001,2,66,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,67,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,68,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,69,0)
  <xsl:with-param name="title" select="'Admission Date'"/>
"KRN",.84,7981997.001,2,70,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,71,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,72,0)
</xsl:template>
"KRN",.84,7981997.001,2,73,0)
 
"KRN",.84,7981997.001,2,74,0)
<xsl:template match="COLUMN[@NAME='AGE']">
"KRN",.84,7981997.001,2,75,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,76,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,77,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,78,0)
  <xsl:with-param name="title" select="'Age'"/>                 
"KRN",.84,7981997.001,2,79,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981997.001,2,80,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,81,0)
</xsl:template>
"KRN",.84,7981997.001,2,82,0)
 
"KRN",.84,7981997.001,2,83,0)
<xsl:template match="COLUMN[@NAME='CONFDT']">
"KRN",.84,7981997.001,2,84,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,85,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,86,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,87,0)
  <xsl:with-param name="title" select="'Confirmation Date'"/>
"KRN",.84,7981997.001,2,88,0)
  <xsl:with-param name="sort" select="'PATIENTS=CONFDT:DESC'"/>
"KRN",.84,7981997.001,2,89,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,90,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,91,0)
</xsl:template>
"KRN",.84,7981997.001,2,92,0)
 
"KRN",.84,7981997.001,2,93,0)
<xsl:template match="COLUMN[@NAME='CSSN']">
"KRN",.84,7981997.001,2,94,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,95,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,96,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,97,0)
  <xsl:with-param name="title" select="'Coded SSN'"/>                      
"KRN",.84,7981997.001,2,98,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,99,0)
</xsl:template>
"KRN",.84,7981997.001,2,100,0)
 
"KRN",.84,7981997.001,2,101,0)
<xsl:template match="COLUMN[@NAME='DOB']">
"KRN",.84,7981997.001,2,102,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,103,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,104,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,105,0)
  <xsl:with-param name="title" select="'Date of Birth'"/>                  
"KRN",.84,7981997.001,2,106,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,107,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,108,0)
</xsl:template>
"KRN",.84,7981997.001,2,109,0)
 
"KRN",.84,7981997.001,2,110,0)
<xsl:template match="COLUMN[@NAME='ENTDT']">
"KRN",.84,7981997.001,2,111,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,112,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,113,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,114,0)
   <xsl:with-param name="title" select="'Date Entered'"/>
"KRN",.84,7981997.001,2,115,0)
  <xsl:with-param name="sort" select="'PATIENTS=ENTDT:DESC'"/>                      
"KRN",.84,7981997.001,2,116,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,117,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,118,0)
</xsl:template>
"KRN",.84,7981997.001,2,119,0)
 
"KRN",.84,7981997.001,2,120,0)
<xsl:template match="COLUMN[@NAME='ETHN']">
"KRN",.84,7981997.001,2,121,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,122,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,123,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,124,0)
  <xsl:with-param name="title" select="'Ethnicity'"/>
"KRN",.84,7981997.001,2,125,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981997.001,2,126,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,127,0)
</xsl:template>
"KRN",.84,7981997.001,2,128,0)
 
"KRN",.84,7981997.001,2,129,0)
<xsl:template match="COLUMN[@NAME='RACE']">
"KRN",.84,7981997.001,2,130,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,131,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,132,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,133,0)
  <xsl:with-param name="title" select="'Race'"/>
"KRN",.84,7981997.001,2,134,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981997.001,2,135,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,136,0)
</xsl:template>
"KRN",.84,7981997.001,2,137,0)
 
"KRN",.84,7981997.001,2,138,0)
<xsl:template match="COLUMN[@NAME='SELDT']">
"KRN",.84,7981997.001,2,139,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,140,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,141,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,142,0)
   <xsl:with-param name="title" select="'Selection Date'"/>
"KRN",.84,7981997.001,2,143,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,144,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,145,0)
</xsl:template>
"KRN",.84,7981997.001,2,146,0)
 
"KRN",.84,7981997.001,2,147,0)
<xsl:template match="COLUMN[@NAME='SEX']">
"KRN",.84,7981997.001,2,148,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,149,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,150,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,151,0)
  <xsl:with-param name="title" select="'Sex'"/>                 
"KRN",.84,7981997.001,2,152,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981997.001,2,153,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,154,0)
</xsl:template>
"KRN",.84,7981997.001,2,155,0)
 
"KRN",.84,7981997.001,2,156,0)
<!--[ PATIENT TABLE CELLS ]-->
"KRN",.84,7981997.001,2,157,0)
 
"KRN",.84,7981997.001,2,158,0)
<xsl:template match="PATIENT/ADMDT">
"KRN",.84,7981997.001,2,159,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,160,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,161,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,162,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,163,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,164,0)
</xsl:template>
"KRN",.84,7981997.001,2,165,0)
 
"KRN",.84,7981997.001,2,166,0)
<xsl:template match="PATIENT/CONFDT">
"KRN",.84,7981997.001,2,167,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,168,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,169,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,170,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,171,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,172,0)
</xsl:template>
"KRN",.84,7981997.001,2,173,0)
 
"KRN",.84,7981997.001,2,174,0)
<xsl:template match="PATIENT/DOB">
"KRN",.84,7981997.001,2,175,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,176,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,177,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,178,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,179,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,180,0)
</xsl:template>
"KRN",.84,7981997.001,2,181,0)
 
"KRN",.84,7981997.001,2,182,0)
<xsl:template match="PATIENT/ENTDT">
"KRN",.84,7981997.001,2,183,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,184,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,185,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,186,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,187,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,188,0)
</xsl:template>
"KRN",.84,7981997.001,2,189,0)
 
"KRN",.84,7981997.001,2,190,0)
<xsl:template match="PATIENT/RACES">
"KRN",.84,7981997.001,2,191,0)
 <td class="aLeft">
"KRN",.84,7981997.001,2,192,0)
  <xsl:for-each select="RACE">
"KRN",.84,7981997.001,2,193,0)
   <xsl:value-of select="."/>
"KRN",.84,7981997.001,2,194,0)
   <xsl:if test=".=''"><xsl:text>&#160;</xsl:text></xsl:if><br/>
"KRN",.84,7981997.001,2,195,0)
  </xsl:for-each>
"KRN",.84,7981997.001,2,196,0)
 </td>
"KRN",.84,7981997.001,2,197,0)
</xsl:template>
"KRN",.84,7981997.001,2,198,0)
 
"KRN",.84,7981997.001,2,199,0)
<xsl:template match="PATIENT/SELDT">
"KRN",.84,7981997.001,2,200,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,201,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,202,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,203,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,204,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,205,0)
</xsl:template>
"KRN",.84,7981997.001,2,206,0)
 
"KRN",.84,7981997.001,2,207,0)
</xsl:stylesheet>
"KRN",.84,7981997.002,-1)
0^53
"KRN",.84,7981997.002,0)
7981997.002^2^^CLINICAL CASE REGISTRIES^Patient data templates (CSV)
"KRN",.84,7981997.002,2,0)
^^154^154^3051207^
"KRN",.84,7981997.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981997.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981997.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981997.002,2,4,0)
 
"KRN",.84,7981997.002,2,5,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981997.002,2,6,0)
 
"KRN",.84,7981997.002,2,7,0)
<xsl:template name="BasicPatientData">
"KRN",.84,7981997.002,2,8,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,9,0)
  <xsl:with-param name="value" select="../NAME"/>
"KRN",.84,7981997.002,2,10,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,11,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,12,0)
  <xsl:with-param name="value" select="../LAST4"/>
"KRN",.84,7981997.002,2,13,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,14,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,15,0)
  <xsl:with-param name="value" select="../DOD"/>
"KRN",.84,7981997.002,2,16,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,17,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,18,0)
</xsl:template>
"KRN",.84,7981997.002,2,19,0)
 
"KRN",.84,7981997.002,2,20,0)
<!--[ PATIENT TABLE HEADINGS ]-->
"KRN",.84,7981997.002,2,21,0)
 
"KRN",.84,7981997.002,2,22,0)
<xsl:template match="COLUMN[@NAME='ADMDT']">
"KRN",.84,7981997.002,2,23,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,24,0)
  <xsl:with-param name="title" select="'Admission Date'"/>
"KRN",.84,7981997.002,2,25,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,26,0)
</xsl:template>
"KRN",.84,7981997.002,2,27,0)
 
"KRN",.84,7981997.002,2,28,0)
<xsl:template match="COLUMN[@NAME='AGE']">
"KRN",.84,7981997.002,2,29,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,30,0)
  <xsl:with-param name="title" select="'Age'"/>                 
"KRN",.84,7981997.002,2,31,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,32,0)
</xsl:template>
"KRN",.84,7981997.002,2,33,0)
 
"KRN",.84,7981997.002,2,34,0)
<xsl:template match="COLUMN[@NAME='CONFDT']">
"KRN",.84,7981997.002,2,35,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,36,0)
  <xsl:with-param name="title" select="'Confirmation Date'"/>
"KRN",.84,7981997.002,2,37,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,38,0)
</xsl:template>
"KRN",.84,7981997.002,2,39,0)
 
"KRN",.84,7981997.002,2,40,0)
<xsl:template match="COLUMN[@NAME='CSSN']">
"KRN",.84,7981997.002,2,41,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,42,0)
  <xsl:with-param name="title" select="'Coded SSN'"/>                      
"KRN",.84,7981997.002,2,43,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,44,0)
</xsl:template>
"KRN",.84,7981997.002,2,45,0)
 
"KRN",.84,7981997.002,2,46,0)
<xsl:template match="COLUMN[@NAME='DOB']">
"KRN",.84,7981997.002,2,47,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,48,0)
  <xsl:with-param name="title" select="'Date of Birth'"/>                  
"KRN",.84,7981997.002,2,49,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,50,0)
</xsl:template>
"KRN",.84,7981997.002,2,51,0)
 
"KRN",.84,7981997.002,2,52,0)
<xsl:template match="COLUMN[@NAME='ENTDT']">
"KRN",.84,7981997.002,2,53,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,54,0)
  <xsl:with-param name="title" select="'Date Entered'"/>
"KRN",.84,7981997.002,2,55,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,56,0)
</xsl:template>
"KRN",.84,7981997.002,2,57,0)
 
"KRN",.84,7981997.002,2,58,0)
<xsl:template match="COLUMN[@NAME='ETHN']">
"KRN",.84,7981997.002,2,59,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,60,0)
  <xsl:with-param name="title" select="'Ethnicity'"/>
"KRN",.84,7981997.002,2,61,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,62,0)
</xsl:template>
"KRN",.84,7981997.002,2,63,0)
 
"KRN",.84,7981997.002,2,64,0)
<xsl:template match="COLUMN[@NAME='PRIMELIG']">
"KRN",.84,7981997.002,2,65,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,66,0)
  <xsl:with-param name="title" select="'Primary Eligibility'"/>
"KRN",.84,7981997.002,2,67,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,68,0)
</xsl:template>
"KRN",.84,7981997.002,2,69,0)
 
"KRN",.84,7981997.002,2,70,0)
<xsl:template match="COLUMN[@NAME='RACE']">
"KRN",.84,7981997.002,2,71,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,72,0)
  <xsl:with-param name="title" select="'Race'"/>
"KRN",.84,7981997.002,2,73,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,74,0)
</xsl:template>
"KRN",.84,7981997.002,2,75,0)
 
"KRN",.84,7981997.002,2,76,0)
<xsl:template match="COLUMN[@NAME='SELDT']">
"KRN",.84,7981997.002,2,77,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,78,0)
  <xsl:with-param name="title" select="'Selection Date'"/>
"KRN",.84,7981997.002,2,79,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,80,0)
</xsl:template>
"KRN",.84,7981997.002,2,81,0)
 
"KRN",.84,7981997.002,2,82,0)
<xsl:template match="COLUMN[@NAME='SELRULES']">
"KRN",.84,7981997.002,2,83,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,84,0)
  <xsl:with-param name="title" select="'Reasons'"/>
"KRN",.84,7981997.002,2,85,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,86,0)
</xsl:template>
"KRN",.84,7981997.002,2,87,0)
 
"KRN",.84,7981997.002,2,88,0)
<xsl:template match="COLUMN[@NAME='SEX']">
"KRN",.84,7981997.002,2,89,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,90,0)
  <xsl:with-param name="title" select="'Sex'"/>                 
"KRN",.84,7981997.002,2,91,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,92,0)
</xsl:template>
"KRN",.84,7981997.002,2,93,0)
 
"KRN",.84,7981997.002,2,94,0)
<!--[ PATIENT TABLE CELLS ]-->
"KRN",.84,7981997.002,2,95,0)
 
"KRN",.84,7981997.002,2,96,0)
<xsl:template match="PATIENT/ADMDT">
"KRN",.84,7981997.002,2,97,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,98,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,99,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,100,0)
</xsl:template>
"KRN",.84,7981997.002,2,101,0)
 
"KRN",.84,7981997.002,2,102,0)
<xsl:template match="PATIENT/CONFDT">
"KRN",.84,7981997.002,2,103,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,104,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,105,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,106,0)
</xsl:template>
"KRN",.84,7981997.002,2,107,0)
 
"KRN",.84,7981997.002,2,108,0)
<xsl:template match="PATIENT/DOB">
"KRN",.84,7981997.002,2,109,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,110,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,111,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,112,0)
</xsl:template>
"KRN",.84,7981997.002,2,113,0)
 
"KRN",.84,7981997.002,2,114,0)
<xsl:template match="PATIENT/ENTDT">
"KRN",.84,7981997.002,2,115,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,116,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,117,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,118,0)
</xsl:template>
"KRN",.84,7981997.002,2,119,0)
 
"KRN",.84,7981997.002,2,120,0)
<xsl:template match="PATIENT/RACES">
"KRN",.84,7981997.002,2,121,0)
 <xsl:text>&quot;</xsl:text>
"KRN",.84,7981997.002,2,122,0)
 <xsl:for-each select="RACE">
"KRN",.84,7981997.002,2,123,0)
  <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981997.002,2,124,0)
  <xsl:call-template name="DoubleQuotes"/>
"KRN",.84,7981997.002,2,125,0)
 </xsl:for-each>
"KRN",.84,7981997.002,2,126,0)
 <xsl:text>&quot;</xsl:text>
"KRN",.84,7981997.002,2,127,0)
 <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981997.002,2,128,0)
</xsl:template>
"KRN",.84,7981997.002,2,129,0)
 
"KRN",.84,7981997.002,2,130,0)
<xsl:template match="PATIENT/SEEN">
"KRN",.84,7981997.002,2,131,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,132,0)
  <xsl:with-param name="yesno" select="1"/>
"KRN",.84,7981997.002,2,133,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,134,0)
</xsl:template>
"KRN",.84,7981997.002,2,135,0)
 
"KRN",.84,7981997.002,2,136,0)
<xsl:template match="PATIENT/SELDT">
"KRN",.84,7981997.002,2,137,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,138,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,139,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,140,0)
</xsl:template>
"KRN",.84,7981997.002,2,141,0)
 
"KRN",.84,7981997.002,2,142,0)
<xsl:template match="PATIENT/SELRULES">
"KRN",.84,7981997.002,2,143,0)
 <xsl:text>&quot;</xsl:text>
"KRN",.84,7981997.002,2,144,0)
 <xsl:for-each select="RULE">
"KRN",.84,7981997.002,2,145,0)
  <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981997.002,2,146,0)
  <xsl:call-template name="DoubleQuotes">
"KRN",.84,7981997.002,2,147,0)
   <xsl:with-param name="value" select="@DESCR"/>
"KRN",.84,7981997.002,2,148,0)
  </xsl:call-template>
"KRN",.84,7981997.002,2,149,0)
 </xsl:for-each>
"KRN",.84,7981997.002,2,150,0)
 <xsl:text>&quot;</xsl:text>
"KRN",.84,7981997.002,2,151,0)
 <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981997.002,2,152,0)
</xsl:template>
"KRN",.84,7981997.002,2,153,0)
 
"KRN",.84,7981997.002,2,154,0)
</xsl:stylesheet>
"KRN",.84,7981998.001,-1)
0^54
"KRN",.84,7981998.001,0)
7981998.001^2^^CLINICAL CASE REGISTRIES^CSS and Scripts
"KRN",.84,7981998.001,2,0)
^^147^147^3051025^
"KRN",.84,7981998.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981998.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981998.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981998.001,2,4,0)
>
"KRN",.84,7981998.001,2,5,0)
 
"KRN",.84,7981998.001,2,6,0)
<xsl:template name="StyleSheet">
"KRN",.84,7981998.001,2,7,0)
 
"KRN",.84,7981998.001,2,8,0)
 <script type="text/javascript">
"KRN",.84,7981998.001,2,9,0)
  function windowHeight()
"KRN",.84,7981998.001,2,10,0)
  {
"KRN",.84,7981998.001,2,11,0)
   var wh = 600;
"KRN",.84,7981998.001,2,12,0)
   if (parseInt(navigator.appVersion)>3) {
"KRN",.84,7981998.001,2,13,0)
    if (navigator.appName=="Netscape") {
"KRN",.84,7981998.001,2,14,0)
     wh = window.innerHeight; 
"KRN",.84,7981998.001,2,15,0)
    } 
"KRN",.84,7981998.001,2,16,0)
    if (navigator.appName.indexOf("Microsoft")!=-1) {
"KRN",.84,7981998.001,2,17,0)
     wh = document.body.offsetHeight;
"KRN",.84,7981998.001,2,18,0)
    }
"KRN",.84,7981998.001,2,19,0)
   }
"KRN",.84,7981998.001,2,20,0)
   return wh;
"KRN",.84,7981998.001,2,21,0)
  }
"KRN",.84,7981998.001,2,22,0)
 </script>
"KRN",.84,7981998.001,2,23,0)
 
"KRN",.84,7981998.001,2,24,0)
 <style type="text/css">  /* Default Style Sheet */
"KRN",.84,7981998.001,2,25,0)
 
"KRN",.84,7981998.001,2,26,0)
  body  { text-align: center }
"KRN",.84,7981998.001,2,27,0)
  table { border: 1px solid gray }
"KRN",.84,7981998.001,2,28,0)
  th    { border: 1px solid gray }
"KRN",.84,7981998.001,2,29,0)
  thead { background-color: #E0E0E0 }
"KRN",.84,7981998.001,2,30,0)
  tfoot { background-color: #E0E0E0; font-size: 0px; }
"KRN",.84,7981998.001,2,31,0)
 
"KRN",.84,7981998.001,2,32,0)
  td {
"KRN",.84,7981998.001,2,33,0)
   border: 1px solid gray;
"KRN",.84,7981998.001,2,34,0)
   text-align: center;
"KRN",.84,7981998.001,2,35,0)
   vertical-align: middle;
"KRN",.84,7981998.001,2,36,0)
  }
"KRN",.84,7981998.001,2,37,0)
 
"KRN",.84,7981998.001,2,38,0)
  table caption     { text-align: left; font-weight: bold; } 
"KRN",.84,7981998.001,2,39,0)
  table td.aBottom  { vertical-align: text-bottom }
"KRN",.84,7981998.001,2,40,0)
  table td.aLeft    { text-align: left }
"KRN",.84,7981998.001,2,41,0)
  table td.aTopLeft { vertical-align: top; text-align: left }
"KRN",.84,7981998.001,2,42,0)
  table td.aTop     { vertical-align: top }
"KRN",.84,7981998.001,2,43,0)
 
"KRN",.84,7981998.001,2,44,0)
  div.reportHeader {
"KRN",.84,7981998.001,2,45,0)
   clear: both;
"KRN",.84,7981998.001,2,46,0)
   width: 100%;
"KRN",.84,7981998.001,2,47,0)
   margin-bottom: 1%;
"KRN",.84,7981998.001,2,48,0)
  }
"KRN",.84,7981998.001,2,49,0)
 
"KRN",.84,7981998.001,2,50,0)
  div.reportHeader table { border: 0 }
"KRN",.84,7981998.001,2,51,0)
  div.reportHeader th { width: 6em }
"KRN",.84,7981998.001,2,52,0)
 
"KRN",.84,7981998.001,2,53,0)
  div.reportHeader td, div.reportHeader th {
"KRN",.84,7981998.001,2,54,0)
   border: 0;
"KRN",.84,7981998.001,2,55,0)
   text-align: left;
"KRN",.84,7981998.001,2,56,0)
   vertical-align:text-top;
"KRN",.84,7981998.001,2,57,0)
  }
"KRN",.84,7981998.001,2,58,0)
 
"KRN",.84,7981998.001,2,59,0)
  div.simpleContainer {
"KRN",.84,7981998.001,2,60,0)
   width:  100%;
"KRN",.84,7981998.001,2,61,0)
   border-top:    1px solid gray;
"KRN",.84,7981998.001,2,62,0)
   border-bottom: 1px solid gray;
"KRN",.84,7981998.001,2,63,0)
   clear: both;
"KRN",.84,7981998.001,2,64,0)
   overflow: visible;
"KRN",.84,7981998.001,2,65,0)
  }
"KRN",.84,7981998.001,2,66,0)
 
"KRN",.84,7981998.001,2,67,0)
  div.scrollableContainer {
"KRN",.84,7981998.001,2,68,0)
   width:  100%;
"KRN",.84,7981998.001,2,69,0)
   height: expression(windowHeight()-200);
"KRN",.84,7981998.001,2,70,0)
   border-top:    1px solid gray;
"KRN",.84,7981998.001,2,71,0)
   border-bottom: 1px solid gray;
"KRN",.84,7981998.001,2,72,0)
   clear: both;
"KRN",.84,7981998.001,2,73,0)
   overflow: auto;
"KRN",.84,7981998.001,2,74,0)
 
"KRN",.84,7981998.001,2,75,0)
   /* Non-standard (IE 5.5+ only) */
"KRN",.84,7981998.001,2,76,0)
   scrollbar-3dlight-color:    #606060;
"KRN",.84,7981998.001,2,77,0)
   scrollbar-arrow-color:      #000000;
"KRN",.84,7981998.001,2,78,0)
   scrollbar-base-color:       #C0C0C0;
"KRN",.84,7981998.001,2,79,0)
   scrollbar-darkshadow-color: #C0C0C0;
"KRN",.84,7981998.001,2,80,0)
   scrollbar-face-color:       #C0C0C0;
"KRN",.84,7981998.001,2,81,0)
   scrollbar-highlight-color:  #C0C0C0;
"KRN",.84,7981998.001,2,82,0)
   scrollbar-shadow-color:     #606060;
"KRN",.84,7981998.001,2,83,0)
  }
"KRN",.84,7981998.001,2,84,0)
 
"KRN",.84,7981998.001,2,85,0)
  table.dataGrid {
"KRN",.84,7981998.001,2,86,0)
   width: 100%;
"KRN",.84,7981998.001,2,87,0)
   border-top:    0px;
"KRN",.84,7981998.001,2,88,0)
   border-bottom: 0px;
"KRN",.84,7981998.001,2,89,0)
  }
"KRN",.84,7981998.001,2,90,0)
 
"KRN",.84,7981998.001,2,91,0)
  /* Fixes the table header in place */
"KRN",.84,7981998.001,2,92,0)
  table.dataGrid thead th, table.dataGrid thead td {
"KRN",.84,7981998.001,2,93,0)
   position: relative;
"KRN",.84,7981998.001,2,94,0)
   top: expression(parentNode.parentNode.parentNode.parentNode.scrollTop);
"KRN",.84,7981998.001,2,95,0)
  }
"KRN",.84,7981998.001,2,96,0)
 
"KRN",.84,7981998.001,2,97,0)
  table.dataGrid td { vertical-align: top }
"KRN",.84,7981998.001,2,98,0)
  table.dataGrid tfoot td { border-top: 0 }
"KRN",.84,7981998.001,2,99,0)
 
"KRN",.84,7981998.001,2,100,0)
  div.reportSummary {
"KRN",.84,7981998.001,2,101,0)
   clear: both;
"KRN",.84,7981998.001,2,102,0)
   width: 100%;
"KRN",.84,7981998.001,2,103,0)
   page-break-before: always;
"KRN",.84,7981998.001,2,104,0)
  }
"KRN",.84,7981998.001,2,105,0)
 
"KRN",.84,7981998.001,2,106,0)
  div.reportSummary table {
"KRN",.84,7981998.001,2,107,0)
   margin-top: 1ex;
"KRN",.84,7981998.001,2,108,0)
   width: 100%;
"KRN",.84,7981998.001,2,109,0)
  }
"KRN",.84,7981998.001,2,110,0)
 
"KRN",.84,7981998.001,2,111,0)
  /*--- Mozilla (Netscape) specific ---*/
"KRN",.84,7981998.001,2,112,0)
 
"KRN",.84,7981998.001,2,113,0)
  /* Any tbody which is a child of table element */
"KRN",.84,7981998.001,2,114,0)
  table.dataGrid > tbody {
"KRN",.84,7981998.001,2,115,0)
   overflow: auto;
"KRN",.84,7981998.001,2,116,0)
   height: 70%;
"KRN",.84,7981998.001,2,117,0)
  }
"KRN",.84,7981998.001,2,118,0)
 
"KRN",.84,7981998.001,2,119,0)
  /* Prevent scrollbar from hiding cell content */
"KRN",.84,7981998.001,2,120,0)
  td:last-child { padding-right: 18px; }
"KRN",.84,7981998.001,2,121,0)
 
"KRN",.84,7981998.001,2,122,0)
 </style>
"KRN",.84,7981998.001,2,123,0)
 
"KRN",.84,7981998.001,2,124,0)
 <style type="text/css" media="print">  /* Print Style Sheet */
"KRN",.84,7981998.001,2,125,0)
 
"KRN",.84,7981998.001,2,126,0)
  div.scrollableContainer {
"KRN",.84,7981998.001,2,127,0)
   overflow: visible;
"KRN",.84,7981998.001,2,128,0)
   border: 0px;
"KRN",.84,7981998.001,2,129,0)
  }
"KRN",.84,7981998.001,2,130,0)
 
"KRN",.84,7981998.001,2,131,0)
  a { text-decoration: none; color: black }
"KRN",.84,7981998.001,2,132,0)
  table.dataGrid { border: solid gray 1px }
"KRN",.84,7981998.001,2,133,0)
  tfoot { display: table-footer-group }
"KRN",.84,7981998.001,2,134,0)
  thead { display: table-header-group }
"KRN",.84,7981998.001,2,135,0)
 
"KRN",.84,7981998.001,2,136,0)
  table.dataGrid thead th, table.dataGrid thead td {
"KRN",.84,7981998.001,2,137,0)
   position: static;
"KRN",.84,7981998.001,2,138,0)
  }
"KRN",.84,7981998.001,2,139,0)
 
"KRN",.84,7981998.001,2,140,0)
  /*--- Mozilla (Netscape) specific ---*/
"KRN",.84,7981998.001,2,141,0)
  table.dataGrid > tbody { overflow: visible }
"KRN",.84,7981998.001,2,142,0)
 
"KRN",.84,7981998.001,2,143,0)
 </style>
"KRN",.84,7981998.001,2,144,0)
 
"KRN",.84,7981998.001,2,145,0)
</xsl:template>
"KRN",.84,7981998.001,2,146,0)
 
"KRN",.84,7981998.001,2,147,0)
</xsl:stylesheet>
"KRN",.84,7981999.001,-1)
0^55
"KRN",.84,7981999.001,0)
7981999.001^2^^CLINICAL CASE REGISTRIES^Common XSL templates (HTML)
"KRN",.84,7981999.001,2,0)
^^671^671^3051119^
"KRN",.84,7981999.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981999.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981999.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981999.001,2,4,0)
 
"KRN",.84,7981999.001,2,5,0)
<xsl:param name="REMOVE_URLS"/>
"KRN",.84,7981999.001,2,6,0)
 
"KRN",.84,7981999.001,2,7,0)
<xsl:output method="html" indent="yes" encoding="iso-8859-1"/>
"KRN",.84,7981999.001,2,8,0)
<xsl:strip-space elements="*"/>
"KRN",.84,7981999.001,2,9,0)
 
"KRN",.84,7981999.001,2,10,0)
<xsl:template match="REPORT/HEADER//*"></xsl:template>
"KRN",.84,7981999.001,2,11,0)
<xsl:template match="REPORT/PARAMETERS//*"></xsl:template>
"KRN",.84,7981999.001,2,12,0)
 
"KRN",.84,7981999.001,2,13,0)
<xsl:key name="TableDefs" match="/REPORT/HEADER/TBLDEF" use="@NAME"/>
"KRN",.84,7981999.001,2,14,0)
 
"KRN",.84,7981999.001,2,15,0)
<!--
"KRN",.84,7981999.001,2,16,0)
=========================================================================
"KRN",.84,7981999.001,2,17,0)
                                UTILITIES
"KRN",.84,7981999.001,2,18,0)
=========================================================================
"KRN",.84,7981999.001,2,19,0)
-->
"KRN",.84,7981999.001,2,20,0)
 
"KRN",.84,7981999.001,2,21,0)
<!-- Formats the value of table cell -->
"KRN",.84,7981999.001,2,22,0)
 
"KRN",.84,7981999.001,2,23,0)
<xsl:template name="CellValue">
"KRN",.84,7981999.001,2,24,0)
 <xsl:param name="fmdt" select="0"/>
"KRN",.84,7981999.001,2,25,0)
 <xsl:param name="value" select="."/>
"KRN",.84,7981999.001,2,26,0)
 <xsl:param name="yesno" select="0"/>
"KRN",.84,7981999.001,2,27,0)
 <xsl:choose>
"KRN",.84,7981999.001,2,28,0)
  <xsl:when test="string($value)=''">&#160;</xsl:when>
"KRN",.84,7981999.001,2,29,0)
  <xsl:when test="boolean($fmdt)">
"KRN",.84,7981999.001,2,30,0)
   <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,31,0)
    <xsl:with-param name="dt" select="$value"/>
"KRN",.84,7981999.001,2,32,0)
   </xsl:call-template>
"KRN",.84,7981999.001,2,33,0)
  </xsl:when>
"KRN",.84,7981999.001,2,34,0)
  <xsl:when test="boolean($yesno)">
"KRN",.84,7981999.001,2,35,0)
   <xsl:choose>
"KRN",.84,7981999.001,2,36,0)
    <xsl:when test="$value!=0">Yes</xsl:when>
"KRN",.84,7981999.001,2,37,0)
    <xsl:otherwise>No</xsl:otherwise>
"KRN",.84,7981999.001,2,38,0)
   </xsl:choose>
"KRN",.84,7981999.001,2,39,0)
  </xsl:when>
"KRN",.84,7981999.001,2,40,0)
  <xsl:otherwise><xsl:value-of select="$value"/></xsl:otherwise>
"KRN",.84,7981999.001,2,41,0)
 </xsl:choose>
"KRN",.84,7981999.001,2,42,0)
</xsl:template>
"KRN",.84,7981999.001,2,43,0)
 
"KRN",.84,7981999.001,2,44,0)
<!-- Converts the FileMan date/time in printable format -->
"KRN",.84,7981999.001,2,45,0)
 
"KRN",.84,7981999.001,2,46,0)
<xsl:template name="DateTime">
"KRN",.84,7981999.001,2,47,0)
 <xsl:param name="dt" select="."/>
"KRN",.84,7981999.001,2,48,0)
 <!--
"KRN",.84,7981999.001,2,49,0)
     Date (YYYMMDD)
"KRN",.84,7981999.001,2,50,0)
 -->
"KRN",.84,7981999.001,2,51,0)
 <xsl:variable name="date"
"KRN",.84,7981999.001,2,52,0)
               select="substring-before(concat($dt,'.'),'.')"/>
"KRN",.84,7981999.001,2,53,0)
 <xsl:if test="$date!=''">
"KRN",.84,7981999.001,2,54,0)
  <xsl:choose>
"KRN",.84,7981999.001,2,55,0)
   <xsl:when test="string-length($date)=7">
"KRN",.84,7981999.001,2,56,0)
    <xsl:variable name="year"
"KRN",.84,7981999.001,2,57,0)
                  select="string(number(substring($date,1,3))+1700)"/>
"KRN",.84,7981999.001,2,58,0)
    <xsl:variable name="month" select="substring($date,4,2)"/>
"KRN",.84,7981999.001,2,59,0)
    <xsl:variable name="day" select="substring($date,6,2)"/>
"KRN",.84,7981999.001,2,60,0)
    <xsl:choose>
"KRN",.84,7981999.001,2,61,0)
     <xsl:when test="$day!='00'">
"KRN",.84,7981999.001,2,62,0)
      <xsl:value-of select="concat($month,'/',$day,'/',$year)"/>
"KRN",.84,7981999.001,2,63,0)
     </xsl:when>
"KRN",.84,7981999.001,2,64,0)
     <xsl:when test="$month!='00'">
"KRN",.84,7981999.001,2,65,0)
      <xsl:value-of select="concat($month,'/',$year)"/>
"KRN",.84,7981999.001,2,66,0)
     </xsl:when>
"KRN",.84,7981999.001,2,67,0)
     <xsl:otherwise><xsl:value-of select="$year"/></xsl:otherwise>
"KRN",.84,7981999.001,2,68,0)
    </xsl:choose>
"KRN",.84,7981999.001,2,69,0)
   </xsl:when>
"KRN",.84,7981999.001,2,70,0)
   <xsl:otherwise>{error}</xsl:otherwise>
"KRN",.84,7981999.001,2,71,0)
  </xsl:choose>
"KRN",.84,7981999.001,2,72,0)
  <!--
"KRN",.84,7981999.001,2,73,0)
      Time (HHMMSS)
"KRN",.84,7981999.001,2,74,0)
  -->
"KRN",.84,7981999.001,2,75,0)
  <xsl:variable name="time"
"KRN",.84,7981999.001,2,76,0)
                select="concat(substring-after($dt,'.'),'000000')"/>
"KRN",.84,7981999.001,2,77,0)
  <xsl:if test="number($time)>0">
"KRN",.84,7981999.001,2,78,0)
   <xsl:text>@</xsl:text>
"KRN",.84,7981999.001,2,79,0)
   <xsl:value-of select="substring($time,1,2)"/>
"KRN",.84,7981999.001,2,80,0)
   <xsl:text>:</xsl:text>
"KRN",.84,7981999.001,2,81,0)
   <xsl:value-of select="substring($time,3,2)"/>
"KRN",.84,7981999.001,2,82,0)
  </xsl:if>
"KRN",.84,7981999.001,2,83,0)
 </xsl:if>
"KRN",.84,7981999.001,2,84,0)
</xsl:template>
"KRN",.84,7981999.001,2,85,0)
 
"KRN",.84,7981999.001,2,86,0)
<xsl:template name="HUPatientsHeader">
"KRN",.84,7981999.001,2,87,0)
 <xsl:value-of select="/REPORT/PARAMETERS/MAXUTNUM"/>
"KRN",.84,7981999.001,2,88,0)
 <xsl:text> patient(s) with highest utilization</xsl:text>
"KRN",.84,7981999.001,2,89,0)
</xsl:template>
"KRN",.84,7981999.001,2,90,0)
 
"KRN",.84,7981999.001,2,91,0)
<!-- Conditional hyperlink -->
"KRN",.84,7981999.001,2,92,0)
 
"KRN",.84,7981999.001,2,93,0)
<xsl:template name="HyperLink">
"KRN",.84,7981999.001,2,94,0)
 <xsl:param name="href" select="''"/>
"KRN",.84,7981999.001,2,95,0)
 <xsl:param name="keep" select="0"/>
"KRN",.84,7981999.001,2,96,0)
 <xsl:param name="name" select="''"/>
"KRN",.84,7981999.001,2,97,0)
 <xsl:param name="text" select="."/>
"KRN",.84,7981999.001,2,98,0)
 <xsl:choose>
"KRN",.84,7981999.001,2,99,0)
  <xsl:when test="$text=''"><xsl:text>&#160;</xsl:text></xsl:when>
"KRN",.84,7981999.001,2,100,0)
  <xsl:when test="boolean($keep) or not($REMOVE_URLS)">
"KRN",.84,7981999.001,2,101,0)
   <a>
"KRN",.84,7981999.001,2,102,0)
    <xsl:if test="$name!=''">
"KRN",.84,7981999.001,2,103,0)
     <xsl:attribute name="name">
"KRN",.84,7981999.001,2,104,0)
      <xsl:value-of select="$name"/>
"KRN",.84,7981999.001,2,105,0)
     </xsl:attribute>
"KRN",.84,7981999.001,2,106,0)
    </xsl:if>
"KRN",.84,7981999.001,2,107,0)
    <xsl:if test="$href!=''">
"KRN",.84,7981999.001,2,108,0)
     <xsl:attribute name="href">
"KRN",.84,7981999.001,2,109,0)
      <xsl:value-of select="$href"/>
"KRN",.84,7981999.001,2,110,0)
     </xsl:attribute>
"KRN",.84,7981999.001,2,111,0)
    </xsl:if>
"KRN",.84,7981999.001,2,112,0)
    <xsl:value-of select="$text"/>
"KRN",.84,7981999.001,2,113,0)
   </a>
"KRN",.84,7981999.001,2,114,0)
  </xsl:when>
"KRN",.84,7981999.001,2,115,0)
  <xsl:otherwise><xsl:value-of select="$text"/></xsl:otherwise>
"KRN",.84,7981999.001,2,116,0)
 </xsl:choose>
"KRN",.84,7981999.001,2,117,0)
</xsl:template>
"KRN",.84,7981999.001,2,118,0)
 
"KRN",.84,7981999.001,2,119,0)
<!-- Makes the parent container scrollable -->
"KRN",.84,7981999.001,2,120,0)
 
"KRN",.84,7981999.001,2,121,0)
<xsl:template name="MakeScrollable">
"KRN",.84,7981999.001,2,122,0)
 <xsl:param name="condition" select="0"/>
"KRN",.84,7981999.001,2,123,0)
 <xsl:choose>
"KRN",.84,7981999.001,2,124,0)
  <xsl:when test="$condition">
"KRN",.84,7981999.001,2,125,0)
   <xsl:attribute name="class">scrollableContainer</xsl:attribute>
"KRN",.84,7981999.001,2,126,0)
  </xsl:when>
"KRN",.84,7981999.001,2,127,0)
  <xsl:otherwise>
"KRN",.84,7981999.001,2,128,0)
   <xsl:attribute name="class">simpleContainer</xsl:attribute>
"KRN",.84,7981999.001,2,129,0)
  </xsl:otherwise>
"KRN",.84,7981999.001,2,130,0)
 </xsl:choose>
"KRN",.84,7981999.001,2,131,0)
</xsl:template>
"KRN",.84,7981999.001,2,132,0)
 
"KRN",.84,7981999.001,2,133,0)
<!-- Outputs content of the multivalued report parameter -->
"KRN",.84,7981999.001,2,134,0)
 
"KRN",.84,7981999.001,2,135,0)
<xsl:template name="ParamsList">
"KRN",.84,7981999.001,2,136,0)
 <xsl:param name="heading"/>
"KRN",.84,7981999.001,2,137,0)
 <xsl:param name="list" select="."/>
"KRN",.84,7981999.001,2,138,0)
 <tr>
"KRN",.84,7981999.001,2,139,0)
  <th scope="row">
"KRN",.84,7981999.001,2,140,0)
   <xsl:value-of select="concat($heading,':&#160;')"/>
"KRN",.84,7981999.001,2,141,0)
  </th>
"KRN",.84,7981999.001,2,142,0)
  <td>
"KRN",.84,7981999.001,2,143,0)
   <xsl:if test="$list/@DESCR">
"KRN",.84,7981999.001,2,144,0)
    <xsl:value-of select="$list/@DESCR"/><br/>
"KRN",.84,7981999.001,2,145,0)
   </xsl:if>
"KRN",.84,7981999.001,2,146,0)
   <xsl:if test="$list='ALL'">ALL</xsl:if>
"KRN",.84,7981999.001,2,147,0)
   <xsl:for-each select="$list/*">
"KRN",.84,7981999.001,2,148,0)
    <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981999.001,2,149,0)
    <xsl:value-of select="."/>
"KRN",.84,7981999.001,2,150,0)
   </xsl:for-each>
"KRN",.84,7981999.001,2,151,0)
  </td>
"KRN",.84,7981999.001,2,152,0)
 </tr>
"KRN",.84,7981999.001,2,153,0)
</xsl:template>
"KRN",.84,7981999.001,2,154,0)
 
"KRN",.84,7981999.001,2,155,0)
<!-- Outputs singular or plural form of the word -->
"KRN",.84,7981999.001,2,156,0)
 
"KRN",.84,7981999.001,2,157,0)
<xsl:template name="Plural">
"KRN",.84,7981999.001,2,158,0)
 <xsl:param name="qnty" select="0"/>
"KRN",.84,7981999.001,2,159,0)
 <xsl:param name="sq" select="0"/>
"KRN",.84,7981999.001,2,160,0)
 <xsl:param name="word" select="."/>
"KRN",.84,7981999.001,2,161,0)
 <xsl:if test="$sq=0">
"KRN",.84,7981999.001,2,162,0)
  <xsl:value-of select="$qnty"/><xsl:text>&#160;</xsl:text>
"KRN",.84,7981999.001,2,163,0)
 </xsl:if>
"KRN",.84,7981999.001,2,164,0)
 <xsl:choose>
"KRN",.84,7981999.001,2,165,0)
  <xsl:when test="$qnty=1">
"KRN",.84,7981999.001,2,166,0)
   <xsl:value-of select="substring-before($word,'^')"/>
"KRN",.84,7981999.001,2,167,0)
  </xsl:when>
"KRN",.84,7981999.001,2,168,0)
  <xsl:otherwise>
"KRN",.84,7981999.001,2,169,0)
   <xsl:value-of select="substring-after($word,'^')"/>
"KRN",.84,7981999.001,2,170,0)
  </xsl:otherwise>
"KRN",.84,7981999.001,2,171,0)
 </xsl:choose>
"KRN",.84,7981999.001,2,172,0)
</xsl:template>
"KRN",.84,7981999.001,2,173,0)
 
"KRN",.84,7981999.001,2,174,0)
<!-- Formats basic information about the report -->
"KRN",.84,7981999.001,2,175,0)
 
"KRN",.84,7981999.001,2,176,0)
<xsl:template name="ReportInfo">
"KRN",.84,7981999.001,2,177,0)
 <xsl:variable name="HDR" select="/REPORT/HEADER"/>
"KRN",.84,7981999.001,2,178,0)
 <table cellpadding="0" cellspacing="0">
"KRN",.84,7981999.001,2,179,0)
  <tr>
"KRN",.84,7981999.001,2,180,0)
   <th scope="row">Report&#160;Created:&#160;</th>
"KRN",.84,7981999.001,2,181,0)
   <td>
"KRN",.84,7981999.001,2,182,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,183,0)
     <xsl:with-param name="dt" select="$HDR/DATE"/>
"KRN",.84,7981999.001,2,184,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,185,0)
   </td>
"KRN",.84,7981999.001,2,186,0)
  </tr>
"KRN",.84,7981999.001,2,187,0)
  <tr>
"KRN",.84,7981999.001,2,188,0)
   <th scope="row">Task&#160;Number:&#160;</th>
"KRN",.84,7981999.001,2,189,0)
   <td>
"KRN",.84,7981999.001,2,190,0)
    <xsl:call-template name="CellValue">
"KRN",.84,7981999.001,2,191,0)
     <xsl:with-param name="value" select="$HDR/TASK_NUMBER"/>
"KRN",.84,7981999.001,2,192,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,193,0)
   </td>
"KRN",.84,7981999.001,2,194,0)
  </tr>
"KRN",.84,7981999.001,2,195,0)
  <tr>
"KRN",.84,7981999.001,2,196,0)
   <th scope="row">Last&#160;Registry&#160;Update:&#160;</th>
"KRN",.84,7981999.001,2,197,0)
   <td>
"KRN",.84,7981999.001,2,198,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,199,0)
     <xsl:with-param name="dt" select="$HDR/UPDATED_UNTIL"/>
"KRN",.84,7981999.001,2,200,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,201,0)
   </td>
"KRN",.84,7981999.001,2,202,0)
  </tr>
"KRN",.84,7981999.001,2,203,0)
  <tr>
"KRN",.84,7981999.001,2,204,0)
   <th scope="row">Last&#160;Data&#160;Extraction:&#160;</th>
"KRN",.84,7981999.001,2,205,0)
   <td>
"KRN",.84,7981999.001,2,206,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,207,0)
     <xsl:with-param name="dt" select="$HDR/EXTRACTED_UNTIL"/>
"KRN",.84,7981999.001,2,208,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,209,0)
   </td>
"KRN",.84,7981999.001,2,210,0)
  </tr>
"KRN",.84,7981999.001,2,211,0)
 </table>
"KRN",.84,7981999.001,2,212,0)
</xsl:template>
"KRN",.84,7981999.001,2,213,0)
 
"KRN",.84,7981999.001,2,214,0)
<!-- Default report summary -->
"KRN",.84,7981999.001,2,215,0)
 
"KRN",.84,7981999.001,2,216,0)
<xsl:template name="ReportSummary">
"KRN",.84,7981999.001,2,217,0)
 <xsl:variable name="SUMMARY" select="/REPORT/SUMMARY"/>
"KRN",.84,7981999.001,2,218,0)
 <xsl:if test="$SUMMARY/*[1]">
"KRN",.84,7981999.001,2,219,0)
  <div class="reportSummary">
"KRN",.84,7981999.001,2,220,0)
   <xsl:apply-templates select="$SUMMARY"/>
"KRN",.84,7981999.001,2,221,0)
  </div>
"KRN",.84,7981999.001,2,222,0)
 </xsl:if>
"KRN",.84,7981999.001,2,223,0)
</xsl:template>
"KRN",.84,7981999.001,2,224,0)
 
"KRN",.84,7981999.001,2,225,0)
<!-- Indicator of an empty table -->
"KRN",.84,7981999.001,2,226,0)
 
"KRN",.84,7981999.001,2,227,0)
<xsl:template name="TableNoData">
"KRN",.84,7981999.001,2,228,0)
 <table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981999.001,2,229,0)
   <tr><td>No data has been found.</td></tr>
"KRN",.84,7981999.001,2,230,0)
 </table>
"KRN",.84,7981999.001,2,231,0)
</xsl:template>
"KRN",.84,7981999.001,2,232,0)
 
"KRN",.84,7981999.001,2,233,0)
<!--
"KRN",.84,7981999.001,2,234,0)
=========================================================================
"KRN",.84,7981999.001,2,235,0)
                              REPORT HEADER
"KRN",.84,7981999.001,2,236,0)
=========================================================================
"KRN",.84,7981999.001,2,237,0)
-->
"KRN",.84,7981999.001,2,238,0)
 
"KRN",.84,7981999.001,2,239,0)
<xsl:template name="ReportHeader">
"KRN",.84,7981999.001,2,240,0)
 <xsl:variable name="mvplist" select="/REPORT/PARAMETERS/*[*[1]]"/>
"KRN",.84,7981999.001,2,241,0)
 <xsl:variable name="notecnt" select="count(/REPORT/HEADER/NOTES/*)"/>
"KRN",.84,7981999.001,2,242,0)
 <div class="reportHeader">
"KRN",.84,7981999.001,2,243,0)
  <table width="100%" cellpadding="0" cellspacing="0">
"KRN",.84,7981999.001,2,244,0)
   <tr>
"KRN",.84,7981999.001,2,245,0)
    <td style="text-align:left">
"KRN",.84,7981999.001,2,246,0)
     <table cellpadding="0" cellspacing="0">
"KRN",.84,7981999.001,2,247,0)
      <xsl:apply-templates select="/REPORT/PARAMETERS/*[not(*[1])]"/>
"KRN",.84,7981999.001,2,248,0)
     </table>
"KRN",.84,7981999.001,2,249,0)
    </td>
"KRN",.84,7981999.001,2,250,0)
    <td style="text-align:right; padding-left:3%; width:10%">
"KRN",.84,7981999.001,2,251,0)
     <xsl:call-template name="ReportInfo"/>
"KRN",.84,7981999.001,2,252,0)
    </td>
"KRN",.84,7981999.001,2,253,0)
   </tr>
"KRN",.84,7981999.001,2,254,0)
  </table>
"KRN",.84,7981999.001,2,255,0)
  <xsl:if test="$mvplist[1]">
"KRN",.84,7981999.001,2,256,0)
   <table style="width:100%; margin-top:1%" cellpadding="0" cellspacing="0">
"KRN",.84,7981999.001,2,257,0)
    <xsl:apply-templates select="$mvplist"/>
"KRN",.84,7981999.001,2,258,0)
   </table>
"KRN",.84,7981999.001,2,259,0)
  </xsl:if>
"KRN",.84,7981999.001,2,260,0)
  <xsl:if test="/REPORT//PATIENT[1]">
"KRN",.84,7981999.001,2,261,0)
   <div style="margin:10; color: red; font-weight: bold">
"KRN",.84,7981999.001,2,262,0)
    This report contains confidential patient information and must be
"KRN",.84,7981999.001,2,263,0)
    handled in accordance with established policies.
"KRN",.84,7981999.001,2,264,0)
   </div>
"KRN",.84,7981999.001,2,265,0)
  </xsl:if>
"KRN",.84,7981999.001,2,266,0)
  <xsl:if test="$notecnt>0">
"KRN",.84,7981999.001,2,267,0)
   <dl style="text-align:left">
"KRN",.84,7981999.001,2,268,0)
    <xsl:choose>
"KRN",.84,7981999.001,2,269,0)
     <xsl:when test="$notecnt>1">
"KRN",.84,7981999.001,2,270,0)
      <xsl:for-each select="/REPORT/HEADER/NOTES/*">
"KRN",.84,7981999.001,2,271,0)
       <dt>Note #<xsl:value-of select="position()"/>:</dt>
"KRN",.84,7981999.001,2,272,0)
       <dd><xsl:apply-templates select="."/></dd>
"KRN",.84,7981999.001,2,273,0)
      </xsl:for-each>
"KRN",.84,7981999.001,2,274,0)
     </xsl:when>
"KRN",.84,7981999.001,2,275,0)
     <xsl:otherwise>
"KRN",.84,7981999.001,2,276,0)
      <dt>Note:</dt>
"KRN",.84,7981999.001,2,277,0)
      <dd><xsl:apply-templates select="/REPORT/HEADER/NOTES/*"/></dd>
"KRN",.84,7981999.001,2,278,0)
     </xsl:otherwise>
"KRN",.84,7981999.001,2,279,0)
    </xsl:choose>
"KRN",.84,7981999.001,2,280,0)
   </dl>
"KRN",.84,7981999.001,2,281,0)
  </xsl:if>
"KRN",.84,7981999.001,2,282,0)
 </div>
"KRN",.84,7981999.001,2,283,0)
</xsl:template>
"KRN",.84,7981999.001,2,284,0)
 
"KRN",.84,7981999.001,2,285,0)
<xsl:template match="HEADER/NOTES/AGE">
"KRN",.84,7981999.001,2,286,0)
 Age of patients is calculated as of the date when the report is run
"KRN",.84,7981999.001,2,287,0)
 (<xsl:call-template name="DateTime"/>). If a patient died then the
"KRN",.84,7981999.001,2,288,0)
 age is calculated as of date of death.
"KRN",.84,7981999.001,2,289,0)
</xsl:template>
"KRN",.84,7981999.001,2,290,0)
 
"KRN",.84,7981999.001,2,291,0)
<xsl:template match="HEADER/NOTES/AGE_BASE_DATE">
"KRN",.84,7981999.001,2,292,0)
 Age of patients is calculated as of <xsl:call-template name="DateTime"/>,
"KRN",.84,7981999.001,2,293,0)
 which is the middle of the report date range. If a patient was born after
"KRN",.84,7981999.001,2,294,0)
 this date then the field will be empty. If a patient died before this
"KRN",.84,7981999.001,2,295,0)
 date then the age is calculated as of date of death.
"KRN",.84,7981999.001,2,296,0)
</xsl:template>
"KRN",.84,7981999.001,2,297,0)
 
"KRN",.84,7981999.001,2,298,0)
<xsl:template match="PARAMETERS/CLINICS">
"KRN",.84,7981999.001,2,299,0)
 <xsl:call-template name="ParamsList">
"KRN",.84,7981999.001,2,300,0)
  <xsl:with-param name="heading" select="'Clinics'"/>
"KRN",.84,7981999.001,2,301,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,302,0)
</xsl:template>
"KRN",.84,7981999.001,2,303,0)
 
"KRN",.84,7981999.001,2,304,0)
<xsl:template match="PARAMETERS/CPTLST">
"KRN",.84,7981999.001,2,305,0)
 <xsl:call-template name="ParamsList">
"KRN",.84,7981999.001,2,306,0)
  <xsl:with-param name="heading" select="'CPT'"/>
"KRN",.84,7981999.001,2,307,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,308,0)
</xsl:template>
"KRN",.84,7981999.001,2,309,0)
 
"KRN",.84,7981999.001,2,310,0)
<xsl:template name="DateRange" match="PARAMETERS/DATE_RANGE">
"KRN",.84,7981999.001,2,311,0)
 <xsl:param name="dtr" select="."/>
"KRN",.84,7981999.001,2,312,0)
 <xsl:param name="title" select="''"/>
"KRN",.84,7981999.001,2,313,0)
 <xsl:if test="($dtr/@START!='') and ($dtr/@END!='')">
"KRN",.84,7981999.001,2,314,0)
  <tr>
"KRN",.84,7981999.001,2,315,0)
   <th scope="row">
"KRN",.84,7981999.001,2,316,0)
    <xsl:if test="$title!=''">
"KRN",.84,7981999.001,2,317,0)
     <xsl:value-of select="concat($title,'&#160;')"/>
"KRN",.84,7981999.001,2,318,0)
    </xsl:if>
"KRN",.84,7981999.001,2,319,0)
    <xsl:text>Date&#160;Range:&#160;</xsl:text>
"KRN",.84,7981999.001,2,320,0)
   </th>
"KRN",.84,7981999.001,2,321,0)
   <td style="vertical-align:text-bottom">
"KRN",.84,7981999.001,2,322,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,323,0)
     <xsl:with-param name="dt" select="$dtr/@START"/>
"KRN",.84,7981999.001,2,324,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,325,0)
    <xsl:text>&#160;-&#160;</xsl:text>
"KRN",.84,7981999.001,2,326,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,327,0)
     <xsl:with-param name="dt" select="$dtr/@END"/>  
"KRN",.84,7981999.001,2,328,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,329,0)
   </td>
"KRN",.84,7981999.001,2,330,0)
  </tr>
"KRN",.84,7981999.001,2,331,0)
 </xsl:if>
"KRN",.84,7981999.001,2,332,0)
</xsl:template>
"KRN",.84,7981999.001,2,333,0)
 
"KRN",.84,7981999.001,2,334,0)
<!-- 
"KRN",.84,7981999.001,2,335,0)
<xsl:template name="DateRange" match="PARAMETERS/DATE_RANGE">
"KRN",.84,7981999.001,2,336,0)
 <xsl:param name="dtr" select="."/>
"KRN",.84,7981999.001,2,337,0)
 <xsl:param name="title" select="''"/>
"KRN",.84,7981999.001,2,338,0)
 <xsl:if test="$dtr/@START!=''">
"KRN",.84,7981999.001,2,339,0)
  <tr>
"KRN",.84,7981999.001,2,340,0)
   <th scope="row"><xsl:value-of select="$title"/> Start&#160;Date:&#160;</th>
"KRN",.84,7981999.001,2,341,0)
   <td style="vertical-align:text-bottom">
"KRN",.84,7981999.001,2,342,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,343,0)
     <xsl:with-param name="dt" select="$dtr/@START"/>
"KRN",.84,7981999.001,2,344,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,345,0)
   </td>
"KRN",.84,7981999.001,2,346,0)
  </tr>
"KRN",.84,7981999.001,2,347,0)
 </xsl:if>
"KRN",.84,7981999.001,2,348,0)
 <xsl:if test="$dtr/@END!=''">
"KRN",.84,7981999.001,2,349,0)
  <tr>
"KRN",.84,7981999.001,2,350,0)
   <th scope="row"><xsl:value-of select="$title"/> End&#160;Date:&#160;</th>
"KRN",.84,7981999.001,2,351,0)
   <td style="vertical-align:text-bottom">
"KRN",.84,7981999.001,2,352,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,353,0)
     <xsl:with-param name="dt" select="$dtr/@END"/>
"KRN",.84,7981999.001,2,354,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,355,0)
   </td>
"KRN",.84,7981999.001,2,356,0)
  </tr>
"KRN",.84,7981999.001,2,357,0)
 </xsl:if>
"KRN",.84,7981999.001,2,358,0)
</xsl:template>
"KRN",.84,7981999.001,2,359,0)
-->
"KRN",.84,7981999.001,2,360,0)
 
"KRN",.84,7981999.001,2,361,0)
<xsl:template match="PARAMETERS/DIVISIONS">
"KRN",.84,7981999.001,2,362,0)
 <xsl:call-template name="ParamsList">
"KRN",.84,7981999.001,2,363,0)
  <xsl:with-param name="heading" select="'Divisions'"/>
"KRN",.84,7981999.001,2,364,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,365,0)
</xsl:template>
"KRN",.84,7981999.001,2,366,0)
 
"KRN",.84,7981999.001,2,367,0)
<xsl:template match="PARAMETERS/ICD9LST">
"KRN",.84,7981999.001,2,368,0)
 <xsl:call-template name="ParamsList">
"KRN",.84,7981999.001,2,369,0)
  <xsl:with-param name="heading" select="'ICD-9'"/>
"KRN",.84,7981999.001,2,370,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,371,0)
</xsl:template>
"KRN",.84,7981999.001,2,372,0)
 
"KRN",.84,7981999.001,2,373,0)
<xsl:template match="PARAMETERS/LOCAL_FIELDS">
"KRN",.84,7981999.001,2,374,0)
 <xsl:call-template name="ParamsList">
"KRN",.84,7981999.001,2,375,0)
  <xsl:with-param name="heading" select="'Local Fields'"/>
"KRN",.84,7981999.001,2,376,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,377,0)
</xsl:template>
"KRN",.84,7981999.001,2,378,0)
 
"KRN",.84,7981999.001,2,379,0)
<xsl:template match="PARAMETERS/OPTIONS">
"KRN",.84,7981999.001,2,380,0)
 <tr>
"KRN",.84,7981999.001,2,381,0)
  <th scope="row">Options:&#160;</th>
"KRN",.84,7981999.001,2,382,0)
  <td><xsl:value-of select="."/></td>
"KRN",.84,7981999.001,2,383,0)
 </tr>
"KRN",.84,7981999.001,2,384,0)
</xsl:template>
"KRN",.84,7981999.001,2,385,0)
 
"KRN",.84,7981999.001,2,386,0)
<xsl:template match="PARAMETERS/OTHER_REGISTRIES">
"KRN",.84,7981999.001,2,387,0)
 <xsl:call-template name="ParamsList">
"KRN",.84,7981999.001,2,388,0)
  <xsl:with-param name="heading" select="'Other Registries'"/>
"KRN",.84,7981999.001,2,389,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,390,0)
</xsl:template>
"KRN",.84,7981999.001,2,391,0)
 
"KRN",.84,7981999.001,2,392,0)
<xsl:template match="PARAMETERS/PATIENTS">
"KRN",.84,7981999.001,2,393,0)
 <tr>
"KRN",.84,7981999.001,2,394,0)
  <th scope="row">Patients:&#160;</th>
"KRN",.84,7981999.001,2,395,0)
  <td><xsl:value-of select="."/></td>
"KRN",.84,7981999.001,2,396,0)
 </tr>
"KRN",.84,7981999.001,2,397,0)
</xsl:template>
"KRN",.84,7981999.001,2,398,0)
 
"KRN",.84,7981999.001,2,399,0)
<xsl:template match="PARAMETERS/REGNAME">
"KRN",.84,7981999.001,2,400,0)
 <tr>
"KRN",.84,7981999.001,2,401,0)
  <th scope="row">Registry:&#160;</th>
"KRN",.84,7981999.001,2,402,0)
  <td><xsl:value-of select="."/></td>
"KRN",.84,7981999.001,2,403,0)
 </tr>
"KRN",.84,7981999.001,2,404,0)
</xsl:template>
"KRN",.84,7981999.001,2,405,0)
 
"KRN",.84,7981999.001,2,406,0)
<xsl:template match="PARAMETERS/TASK_COMMENT">
"KRN",.84,7981999.001,2,407,0)
 <tr>
"KRN",.84,7981999.001,2,408,0)
  <th scope="row">Comment:&#160;</th>
"KRN",.84,7981999.001,2,409,0)
  <td><xsl:value-of select="."/></td>
"KRN",.84,7981999.001,2,410,0)
 </tr>
"KRN",.84,7981999.001,2,411,0)
</xsl:template>
"KRN",.84,7981999.001,2,412,0)
 
"KRN",.84,7981999.001,2,413,0)
<xsl:template match="PARAMETERS/UTIL_TYPES">
"KRN",.84,7981999.001,2,414,0)
 <tr>
"KRN",.84,7981999.001,2,415,0)
  <th scope="row">Utilization:&#160;</th>
"KRN",.84,7981999.001,2,416,0)
  <td><xsl:value-of select="."/></td>
"KRN",.84,7981999.001,2,417,0)
 </tr>
"KRN",.84,7981999.001,2,418,0)
</xsl:template>
"KRN",.84,7981999.001,2,419,0)
 
"KRN",.84,7981999.001,2,420,0)
<!--
"KRN",.84,7981999.001,2,421,0)
=========================================================================
"KRN",.84,7981999.001,2,422,0)
                       DEFAULT DATA GRID TEMPLATES
"KRN",.84,7981999.001,2,423,0)
=========================================================================
"KRN",.84,7981999.001,2,424,0)
-->
"KRN",.84,7981999.001,2,425,0)
 
"KRN",.84,7981999.001,2,426,0)
<xsl:template name="DataGrid" match="*[@TABLE!='']">
"KRN",.84,7981999.001,2,427,0)
 <xsl:param name="divstyle" select="''"/>
"KRN",.84,7981999.001,2,428,0)
 <xsl:param name="scroll" select="*[31]"/>
"KRN",.84,7981999.001,2,429,0)
 <xsl:variable name="tbldef" select="key('TableDefs',@TABLE)"/>
"KRN",.84,7981999.001,2,430,0)
 <xsl:choose>
"KRN",.84,7981999.001,2,431,0)
  <xsl:when test="*[1]">
"KRN",.84,7981999.001,2,432,0)
   <div>
"KRN",.84,7981999.001,2,433,0)
    <xsl:if test="$divstyle!=''">
"KRN",.84,7981999.001,2,434,0)
     <xsl:attribute name="style">
"KRN",.84,7981999.001,2,435,0)
      <xsl:value-of select="$divstyle"/>
"KRN",.84,7981999.001,2,436,0)
     </xsl:attribute>
"KRN",.84,7981999.001,2,437,0)
    </xsl:if>
"KRN",.84,7981999.001,2,438,0)
    <xsl:call-template name="MakeScrollable">
"KRN",.84,7981999.001,2,439,0)
     <xsl:with-param name="condition" select="$scroll"/>
"KRN",.84,7981999.001,2,440,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,441,0)
    <table class="dataGrid" cellpadding="5" cellspacing="0">
"KRN",.84,7981999.001,2,442,0)
     <xsl:apply-templates select="$tbldef/@HEADER"/>
"KRN",.84,7981999.001,2,443,0)
     <xsl:apply-templates select="$tbldef/@FOOTER"/>
"KRN",.84,7981999.001,2,444,0)
     <tbody>
"KRN",.84,7981999.001,2,445,0)
      <xsl:apply-templates select="*">
"KRN",.84,7981999.001,2,446,0)
       <xsl:with-param name="seqnum"
"KRN",.84,7981999.001,2,447,0)
            select="count($tbldef/COLUMN[@NAME='#'])"/>
"KRN",.84,7981999.001,2,448,0)
      </xsl:apply-templates>
"KRN",.84,7981999.001,2,449,0)
     </tbody>
"KRN",.84,7981999.001,2,450,0)
    </table>
"KRN",.84,7981999.001,2,451,0)
   </div>
"KRN",.84,7981999.001,2,452,0)
  </xsl:when>
"KRN",.84,7981999.001,2,453,0)
  <xsl:otherwise>
"KRN",.84,7981999.001,2,454,0)
   <xsl:call-template name="TableNoData"/>
"KRN",.84,7981999.001,2,455,0)
  </xsl:otherwise>
"KRN",.84,7981999.001,2,456,0)
 </xsl:choose>
"KRN",.84,7981999.001,2,457,0)
</xsl:template>
"KRN",.84,7981999.001,2,458,0)
 
"KRN",.84,7981999.001,2,459,0)
<!-- Default data grid header -->
"KRN",.84,7981999.001,2,460,0)
 
"KRN",.84,7981999.001,2,461,0)
<xsl:template match="HEADER/TBLDEF/@HEADER">
"KRN",.84,7981999.001,2,462,0)
 <thead>
"KRN",.84,7981999.001,2,463,0)
  <tr><xsl:apply-templates select="../COLUMN"/></tr>
"KRN",.84,7981999.001,2,464,0)
 </thead>
"KRN",.84,7981999.001,2,465,0)
</xsl:template>
"KRN",.84,7981999.001,2,466,0)
 
"KRN",.84,7981999.001,2,467,0)
<!-- Default column heading cell -->
"KRN",.84,7981999.001,2,468,0)
 
"KRN",.84,7981999.001,2,469,0)
<xsl:template name="ColumnHeader" match="HEADER/TBLDEF/COLUMN">
"KRN",.84,7981999.001,2,470,0)
 <xsl:param name="column" select="."/>
"KRN",.84,7981999.001,2,471,0)
 <xsl:param name="colname" select="$column/@NAME"/>
"KRN",.84,7981999.001,2,472,0)
 <xsl:param name="sortmode"/>
"KRN",.84,7981999.001,2,473,0)
 <xsl:param name="sort" 
"KRN",.84,7981999.001,2,474,0)
      select="concat($column/../@NAME,'=',$colname,$sortmode)"/>
"KRN",.84,7981999.001,2,475,0)
 <xsl:param name="title" select="$colname"/>
"KRN",.84,7981999.001,2,476,0)
 <xsl:param name="colspan" select="0"/>
"KRN",.84,7981999.001,2,477,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,478,0)
 <xsl:param name="style"/>
"KRN",.84,7981999.001,2,479,0)
 <xsl:param name="width"/>
"KRN",.84,7981999.001,2,480,0)
 <th scope="col">
"KRN",.84,7981999.001,2,481,0)
  <xsl:if test="$colspan>1">
"KRN",.84,7981999.001,2,482,0)
   <xsl:attribute name="colspan">
"KRN",.84,7981999.001,2,483,0)
    <xsl:value-of select="$colspan"/>
"KRN",.84,7981999.001,2,484,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,485,0)
  </xsl:if>
"KRN",.84,7981999.001,2,486,0)
  <xsl:if test="$rowspan>1">
"KRN",.84,7981999.001,2,487,0)
   <xsl:attribute name="rowspan">
"KRN",.84,7981999.001,2,488,0)
    <xsl:value-of select="$rowspan"/>
"KRN",.84,7981999.001,2,489,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,490,0)
  </xsl:if>
"KRN",.84,7981999.001,2,491,0)
  <xsl:if test="string($style)!=''">
"KRN",.84,7981999.001,2,492,0)
   <xsl:attribute name="style">
"KRN",.84,7981999.001,2,493,0)
    <xsl:value-of select="$style"/>
"KRN",.84,7981999.001,2,494,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,495,0)
  </xsl:if>
"KRN",.84,7981999.001,2,496,0)
  <xsl:if test="string($width)!=''">
"KRN",.84,7981999.001,2,497,0)
   <xsl:attribute name="width">
"KRN",.84,7981999.001,2,498,0)
    <xsl:value-of select="$width"/>
"KRN",.84,7981999.001,2,499,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,500,0)
  </xsl:if>
"KRN",.84,7981999.001,2,501,0)
  <xsl:choose>
"KRN",.84,7981999.001,2,502,0)
   <xsl:when test="$title=''">&#160;</xsl:when>
"KRN",.84,7981999.001,2,503,0)
   <xsl:when test="($sort!='') and not($REMOVE_URLS)">
"KRN",.84,7981999.001,2,504,0)
    <xsl:element name="a">
"KRN",.84,7981999.001,2,505,0)
     <xsl:attribute name="href">
"KRN",.84,7981999.001,2,506,0)
      <xsl:text>http://vista/report/sort?</xsl:text>
"KRN",.84,7981999.001,2,507,0)
      <xsl:value-of select="$sort"/>
"KRN",.84,7981999.001,2,508,0)
     </xsl:attribute>
"KRN",.84,7981999.001,2,509,0)
     <xsl:value-of select="$title"/>
"KRN",.84,7981999.001,2,510,0)
    </xsl:element>
"KRN",.84,7981999.001,2,511,0)
   </xsl:when>
"KRN",.84,7981999.001,2,512,0)
   <xsl:otherwise><xsl:value-of select="$title"/></xsl:otherwise>
"KRN",.84,7981999.001,2,513,0)
  </xsl:choose>
"KRN",.84,7981999.001,2,514,0)
 </th>
"KRN",.84,7981999.001,2,515,0)
</xsl:template>
"KRN",.84,7981999.001,2,516,0)
 
"KRN",.84,7981999.001,2,517,0)
<!-- Default Footer -->
"KRN",.84,7981999.001,2,518,0)
 
"KRN",.84,7981999.001,2,519,0)
<xsl:template name="DataGridFooter" match="TBLDEF/@FOOTER">
"KRN",.84,7981999.001,2,520,0)
 <xsl:param name="colspan"
"KRN",.84,7981999.001,2,521,0)
      select="count(..//COLUMN[not(child::COLUMN[1])])"/>
"KRN",.84,7981999.001,2,522,0)
 <tfoot><tr><td>
"KRN",.84,7981999.001,2,523,0)
  <xsl:if test="$colspan>1">
"KRN",.84,7981999.001,2,524,0)
   <xsl:attribute name="colspan">
"KRN",.84,7981999.001,2,525,0)
    <xsl:value-of select="$colspan"/>
"KRN",.84,7981999.001,2,526,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,527,0)
  </xsl:if>
"KRN",.84,7981999.001,2,528,0)
  <xsl:text>&#160;</xsl:text>
"KRN",.84,7981999.001,2,529,0)
 </td></tr></tfoot>
"KRN",.84,7981999.001,2,530,0)
</xsl:template>
"KRN",.84,7981999.001,2,531,0)
 
"KRN",.84,7981999.001,2,532,0)
<!-- Default data grid row -->
"KRN",.84,7981999.001,2,533,0)
 
"KRN",.84,7981999.001,2,534,0)
<xsl:template match="*[@TABLE!='']/*">
"KRN",.84,7981999.001,2,535,0)
 <xsl:param name="seqnum" select="0"/>
"KRN",.84,7981999.001,2,536,0)
 <tr>
"KRN",.84,7981999.001,2,537,0)
  <xsl:if test="$seqnum">
"KRN",.84,7981999.001,2,538,0)
   <td><xsl:value-of select="position()"/></td>
"KRN",.84,7981999.001,2,539,0)
  </xsl:if>
"KRN",.84,7981999.001,2,540,0)
  <xsl:apply-templates select="child::*"/>
"KRN",.84,7981999.001,2,541,0)
 </tr>
"KRN",.84,7981999.001,2,542,0)
</xsl:template>
"KRN",.84,7981999.001,2,543,0)
 
"KRN",.84,7981999.001,2,544,0)
<!-- Data grid cell -->
"KRN",.84,7981999.001,2,545,0)
 
"KRN",.84,7981999.001,2,546,0)
<xsl:template name="TableCell" match="*[@TABLE!='']/*/*">
"KRN",.84,7981999.001,2,547,0)
 <xsl:param name="class"/>
"KRN",.84,7981999.001,2,548,0)
 <xsl:param name="colspan" select="0"/>
"KRN",.84,7981999.001,2,549,0)
 <xsl:param name="fmdt" select="0"/>
"KRN",.84,7981999.001,2,550,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,551,0)
 <xsl:param name="style"/>
"KRN",.84,7981999.001,2,552,0)
 <xsl:param name="value" select="."/>
"KRN",.84,7981999.001,2,553,0)
 <xsl:param name="width"/>
"KRN",.84,7981999.001,2,554,0)
 <xsl:param name="yesno" select="0"/>
"KRN",.84,7981999.001,2,555,0)
 <td>
"KRN",.84,7981999.001,2,556,0)
  <xsl:if test="string($class)!=''">
"KRN",.84,7981999.001,2,557,0)
   <xsl:attribute name="class">
"KRN",.84,7981999.001,2,558,0)
    <xsl:value-of select="$class"/>
"KRN",.84,7981999.001,2,559,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,560,0)
  </xsl:if>
"KRN",.84,7981999.001,2,561,0)
  <xsl:if test="$colspan>1">
"KRN",.84,7981999.001,2,562,0)
   <xsl:attribute name="colspan">
"KRN",.84,7981999.001,2,563,0)
    <xsl:value-of select="$colspan"/>
"KRN",.84,7981999.001,2,564,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,565,0)
  </xsl:if>
"KRN",.84,7981999.001,2,566,0)
  <xsl:if test="$rowspan>1">
"KRN",.84,7981999.001,2,567,0)
   <xsl:attribute name="rowspan">
"KRN",.84,7981999.001,2,568,0)
    <xsl:value-of select="$rowspan"/>
"KRN",.84,7981999.001,2,569,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,570,0)
  </xsl:if>
"KRN",.84,7981999.001,2,571,0)
  <xsl:if test="string($style)!=''">
"KRN",.84,7981999.001,2,572,0)
   <xsl:attribute name="style">
"KRN",.84,7981999.001,2,573,0)
    <xsl:value-of select="$style"/>
"KRN",.84,7981999.001,2,574,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,575,0)
  </xsl:if>
"KRN",.84,7981999.001,2,576,0)
  <xsl:if test="string($width)!=''">
"KRN",.84,7981999.001,2,577,0)
   <xsl:attribute name="width">
"KRN",.84,7981999.001,2,578,0)
    <xsl:value-of select="$width"/>
"KRN",.84,7981999.001,2,579,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,580,0)
  </xsl:if>
"KRN",.84,7981999.001,2,581,0)
  <xsl:choose>
"KRN",.84,7981999.001,2,582,0)
   <xsl:when test="string($value)=''">&#160;</xsl:when>
"KRN",.84,7981999.001,2,583,0)
   <xsl:when test="boolean($fmdt)">
"KRN",.84,7981999.001,2,584,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,585,0)
     <xsl:with-param name="dt" select="$value"/>
"KRN",.84,7981999.001,2,586,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,587,0)
   </xsl:when>
"KRN",.84,7981999.001,2,588,0)
   <xsl:when test="boolean($yesno)">
"KRN",.84,7981999.001,2,589,0)
    <xsl:choose>
"KRN",.84,7981999.001,2,590,0)
     <xsl:when test="$value!=0">Yes</xsl:when>
"KRN",.84,7981999.001,2,591,0)
     <xsl:otherwise>No</xsl:otherwise>
"KRN",.84,7981999.001,2,592,0)
    </xsl:choose>
"KRN",.84,7981999.001,2,593,0)
   </xsl:when>
"KRN",.84,7981999.001,2,594,0)
   <xsl:otherwise><xsl:value-of select="$value"/></xsl:otherwise>
"KRN",.84,7981999.001,2,595,0)
  </xsl:choose>
"KRN",.84,7981999.001,2,596,0)
 </td>
"KRN",.84,7981999.001,2,597,0)
</xsl:template>
"KRN",.84,7981999.001,2,598,0)
 
"KRN",.84,7981999.001,2,599,0)
<!-- Default column headingds -->
"KRN",.84,7981999.001,2,600,0)
 
"KRN",.84,7981999.001,2,601,0)
<xsl:template match="TBLDEF/COLUMN[@NAME='#']">
"KRN",.84,7981999.001,2,602,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,603,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,604,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,605,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981999.001,2,606,0)
  <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981999.001,2,607,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,608,0)
</xsl:template>
"KRN",.84,7981999.001,2,609,0)
 
"KRN",.84,7981999.001,2,610,0)
<xsl:template match="COLUMN[@NAME='DATE']">                                    
"KRN",.84,7981999.001,2,611,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,612,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,613,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,614,0)
  <xsl:with-param name="title" select="'Date'"/>                               
"KRN",.84,7981999.001,2,615,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981999.001,2,616,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,617,0)
</xsl:template>
"KRN",.84,7981999.001,2,618,0)
 
"KRN",.84,7981999.001,2,619,0)
<xsl:template match="COLUMN[@NAME='DOD']">
"KRN",.84,7981999.001,2,620,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,621,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,622,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,623,0)
  <xsl:with-param name="title" select="'Date of Death'"/>
"KRN",.84,7981999.001,2,624,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981999.001,2,625,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,626,0)
</xsl:template>
"KRN",.84,7981999.001,2,627,0)
 
"KRN",.84,7981999.001,2,628,0)
<xsl:template match="COLUMN[@NAME='LAST4']">
"KRN",.84,7981999.001,2,629,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,630,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,631,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,632,0)
  <xsl:with-param name="title" select="'SSN'"/>
"KRN",.84,7981999.001,2,633,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981999.001,2,634,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,635,0)
</xsl:template>
"KRN",.84,7981999.001,2,636,0)
 
"KRN",.84,7981999.001,2,637,0)
<xsl:template match="COLUMN[@NAME='NAME']">
"KRN",.84,7981999.001,2,638,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,639,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,640,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,641,0)
  <xsl:with-param name="title" select="'Name'"/>
"KRN",.84,7981999.001,2,642,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,643,0)
</xsl:template>
"KRN",.84,7981999.001,2,644,0)
 
"KRN",.84,7981999.001,2,645,0)
<xsl:template match="TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='NAME']">
"KRN",.84,7981999.001,2,646,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,647,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,648,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,649,0)
  <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981999.001,2,650,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,651,0)
</xsl:template>
"KRN",.84,7981999.001,2,652,0)
 
"KRN",.84,7981999.001,2,653,0)
<!-- Default cells -->
"KRN",.84,7981999.001,2,654,0)
 
"KRN",.84,7981999.001,2,655,0)
<xsl:template match="PATIENT/DOD">
"KRN",.84,7981999.001,2,656,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,657,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981999.001,2,658,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981999.001,2,659,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,660,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,661,0)
</xsl:template>
"KRN",.84,7981999.001,2,662,0)
 
"KRN",.84,7981999.001,2,663,0)
<xsl:template match="*[@TABLE!='']/*/NAME">
"KRN",.84,7981999.001,2,664,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,665,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981999.001,2,666,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981999.001,2,667,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,668,0)
 </xsl:call-template>
"KRN",.84,7981999.001,2,669,0)
</xsl:template>
"KRN",.84,7981999.001,2,670,0)
 
"KRN",.84,7981999.001,2,671,0)
</xsl:stylesheet>
"KRN",.84,7981999.001,3,0)
^.845
"KRN",.84,7981999.002,-1)
0^56
"KRN",.84,7981999.002,0)
7981999.002^2^^CLINICAL CASE REGISTRIES^Common XSL templates (CSV)
"KRN",.84,7981999.002,2,0)
^.844^256^256^3051207^^^^
"KRN",.84,7981999.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981999.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981999.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981999.002,2,4,0)
>
"KRN",.84,7981999.002,2,5,0)
 
"KRN",.84,7981999.002,2,6,0)
<xsl:output method="text" encoding="iso-8859-1"/>
"KRN",.84,7981999.002,2,7,0)
<xsl:strip-space elements="*"/>
"KRN",.84,7981999.002,2,8,0)
 
"KRN",.84,7981999.002,2,9,0)
<xsl:variable name="CRLF"><xsl:text>&#13;&#10;</xsl:text></xsl:variable>
"KRN",.84,7981999.002,2,10,0)
<xsl:variable name="DELIMITER"><xsl:text>,</xsl:text></xsl:variable>
"KRN",.84,7981999.002,2,11,0)
<xsl:variable name="FILESWITCH"><xsl:text>&#127;</xsl:text></xsl:variable>
"KRN",.84,7981999.002,2,12,0)
 
"KRN",.84,7981999.002,2,13,0)
<xsl:key name="TableDefs" match="/REPORT/HEADER/TBLDEF" use="@NAME"/>
"KRN",.84,7981999.002,2,14,0)
 
"KRN",.84,7981999.002,2,15,0)
<xsl:template match="REPORT/HEADER//*"></xsl:template>
"KRN",.84,7981999.002,2,16,0)
<xsl:template match="REPORT/PARAMETERS//*"></xsl:template>
"KRN",.84,7981999.002,2,17,0)
 
"KRN",.84,7981999.002,2,18,0)
<!--
"KRN",.84,7981999.002,2,19,0)
=========================================================================
"KRN",.84,7981999.002,2,20,0)
                                UTILITIES
"KRN",.84,7981999.002,2,21,0)
=========================================================================
"KRN",.84,7981999.002,2,22,0)
-->
"KRN",.84,7981999.002,2,23,0)
 
"KRN",.84,7981999.002,2,24,0)
<!-- Converts the FileMan date/time in printable format -->
"KRN",.84,7981999.002,2,25,0)
 
"KRN",.84,7981999.002,2,26,0)
<xsl:template name="DateTime">
"KRN",.84,7981999.002,2,27,0)
 <xsl:param name="dt"/>
"KRN",.84,7981999.002,2,28,0)
 <!--
"KRN",.84,7981999.002,2,29,0)
     Date (YYYMMDD)
"KRN",.84,7981999.002,2,30,0)
 -->
"KRN",.84,7981999.002,2,31,0)
 <xsl:variable name="date"
"KRN",.84,7981999.002,2,32,0)
               select="substring-before(concat($dt,'.'),'.')"/>
"KRN",.84,7981999.002,2,33,0)
 <xsl:if test="$date!=''">
"KRN",.84,7981999.002,2,34,0)
  <xsl:choose>
"KRN",.84,7981999.002,2,35,0)
   <xsl:when test="string-length($date)=7">
"KRN",.84,7981999.002,2,36,0)
    <xsl:variable name="year" 
"KRN",.84,7981999.002,2,37,0)
                  select="string(number(substring($date,1,3))+1700)"/>
"KRN",.84,7981999.002,2,38,0)
    <xsl:variable name="month" select="substring($date,4,2)"/>
"KRN",.84,7981999.002,2,39,0)
    <xsl:variable name="day" select="substring($date,6,2)"/>
"KRN",.84,7981999.002,2,40,0)
    <xsl:choose>
"KRN",.84,7981999.002,2,41,0)
     <xsl:when test="$day!='00'">
"KRN",.84,7981999.002,2,42,0)
      <xsl:value-of select="concat($month,'/',$day,'/',$year)"/>
"KRN",.84,7981999.002,2,43,0)
     </xsl:when>
"KRN",.84,7981999.002,2,44,0)
     <xsl:when test="$month!='00'">
"KRN",.84,7981999.002,2,45,0)
      <xsl:value-of select="concat($month,'/',$year)"/>
"KRN",.84,7981999.002,2,46,0)
     </xsl:when>
"KRN",.84,7981999.002,2,47,0)
     <xsl:otherwise><xsl:value-of select="$year"/></xsl:otherwise>
"KRN",.84,7981999.002,2,48,0)
    </xsl:choose>
"KRN",.84,7981999.002,2,49,0)
   </xsl:when>
"KRN",.84,7981999.002,2,50,0)
   <xsl:otherwise>{error}</xsl:otherwise>
"KRN",.84,7981999.002,2,51,0)
  </xsl:choose>
"KRN",.84,7981999.002,2,52,0)
  <!--
"KRN",.84,7981999.002,2,53,0)
      Time (HHMMSS)
"KRN",.84,7981999.002,2,54,0)
  -->
"KRN",.84,7981999.002,2,55,0)
  <xsl:variable name="time"
"KRN",.84,7981999.002,2,56,0)
                select="concat(substring-after($dt,'.'),'000000')"/>
"KRN",.84,7981999.002,2,57,0)
  <xsl:if test="number($time)>0">
"KRN",.84,7981999.002,2,58,0)
   <xsl:text> </xsl:text>
"KRN",.84,7981999.002,2,59,0)
   <xsl:value-of select="substring($time,1,2)"/>
"KRN",.84,7981999.002,2,60,0)
   <xsl:text>:</xsl:text>
"KRN",.84,7981999.002,2,61,0)
   <xsl:value-of select="substring($time,3,2)"/>
"KRN",.84,7981999.002,2,62,0)
  </xsl:if>
"KRN",.84,7981999.002,2,63,0)
 </xsl:if>
"KRN",.84,7981999.002,2,64,0)
</xsl:template>
"KRN",.84,7981999.002,2,65,0)
 
"KRN",.84,7981999.002,2,66,0)
<!-- Doubles the double quotes in the provided string -->
"KRN",.84,7981999.002,2,67,0)
 
"KRN",.84,7981999.002,2,68,0)
<xsl:template name="DoubleQuotes">
"KRN",.84,7981999.002,2,69,0)
 <xsl:param name="value" select="."/>
"KRN",.84,7981999.002,2,70,0)
 <xsl:choose>
"KRN",.84,7981999.002,2,71,0)
  <xsl:when test="contains($value,'&quot;')">
"KRN",.84,7981999.002,2,72,0)
   <xsl:value-of select="substring-before($value,'&quot;')"/>
"KRN",.84,7981999.002,2,73,0)
   <xsl:text>&quot;&quot;</xsl:text>
"KRN",.84,7981999.002,2,74,0)
   <xsl:call-template name="DoubleQuotes">
"KRN",.84,7981999.002,2,75,0)
    <xsl:with-param name="value" 
"KRN",.84,7981999.002,2,76,0)
                    select="substring-after($value,'&quot;')"/>
"KRN",.84,7981999.002,2,77,0)
   </xsl:call-template>
"KRN",.84,7981999.002,2,78,0)
  </xsl:when>
"KRN",.84,7981999.002,2,79,0)
  <xsl:otherwise><xsl:value-of select="$value"/></xsl:otherwise>
"KRN",.84,7981999.002,2,80,0)
 </xsl:choose>
"KRN",.84,7981999.002,2,81,0)
</xsl:template>
"KRN",.84,7981999.002,2,82,0)
 
"KRN",.84,7981999.002,2,83,0)
<!-- Quotes the string if it contains commas or double quotes -->
"KRN",.84,7981999.002,2,84,0)
 
"KRN",.84,7981999.002,2,85,0)
<xsl:template name="Quote">
"KRN",.84,7981999.002,2,86,0)
 <xsl:param name="value" select="."/>
"KRN",.84,7981999.002,2,87,0)
 <xsl:choose>
"KRN",.84,7981999.002,2,88,0)
  <xsl:when test="contains($value,'&quot;')">
"KRN",.84,7981999.002,2,89,0)
   <xsl:text>&quot;</xsl:text>
"KRN",.84,7981999.002,2,90,0)
   <xsl:call-template name="DoubleQuotes">
"KRN",.84,7981999.002,2,91,0)
    <xsl:with-param name="value" select="$value"/>
"KRN",.84,7981999.002,2,92,0)
   </xsl:call-template>
"KRN",.84,7981999.002,2,93,0)
   <xsl:text>&quot;</xsl:text>
"KRN",.84,7981999.002,2,94,0)
  </xsl:when>
"KRN",.84,7981999.002,2,95,0)
  <xsl:when test="contains($value,$DELIMITER)">
"KRN",.84,7981999.002,2,96,0)
   <xsl:text>&quot;</xsl:text>
"KRN",.84,7981999.002,2,97,0)
   <xsl:value-of select="$value"/>
"KRN",.84,7981999.002,2,98,0)
   <xsl:text>&quot;</xsl:text>
"KRN",.84,7981999.002,2,99,0)
  </xsl:when>
"KRN",.84,7981999.002,2,100,0)
  <xsl:otherwise><xsl:value-of select="$value"/></xsl:otherwise>
"KRN",.84,7981999.002,2,101,0)
 </xsl:choose>
"KRN",.84,7981999.002,2,102,0)
</xsl:template> 
"KRN",.84,7981999.002,2,103,0)
 
"KRN",.84,7981999.002,2,104,0)
<!-- Default report summary -->
"KRN",.84,7981999.002,2,105,0)
 
"KRN",.84,7981999.002,2,106,0)
<xsl:template name="ReportSummary">
"KRN",.84,7981999.002,2,107,0)
 <xsl:variable name="SUMMARY" select="/REPORT/SUMMARY"/>
"KRN",.84,7981999.002,2,108,0)
 <xsl:if test="$SUMMARY/*[1]">
"KRN",.84,7981999.002,2,109,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981999.002,2,110,0)
  <xsl:apply-templates select="$SUMMARY"/>
"KRN",.84,7981999.002,2,111,0)
 </xsl:if>
"KRN",.84,7981999.002,2,112,0)
</xsl:template>
"KRN",.84,7981999.002,2,113,0)
 
"KRN",.84,7981999.002,2,114,0)
<!-- Empty table indicator -->
"KRN",.84,7981999.002,2,115,0)
 
"KRN",.84,7981999.002,2,116,0)
<xsl:template name="TableNoData">
"KRN",.84,7981999.002,2,117,0)
 <xsl:text>No data has been found.</xsl:text>
"KRN",.84,7981999.002,2,118,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981999.002,2,119,0)
</xsl:template>
"KRN",.84,7981999.002,2,120,0)
 
"KRN",.84,7981999.002,2,121,0)
<!-- Format the section of a utilization report -->
"KRN",.84,7981999.002,2,122,0)
 
"KRN",.84,7981999.002,2,123,0)
<xsl:template name="UtilizationSection">
"KRN",.84,7981999.002,2,124,0)
 <xsl:param name="data"/>
"KRN",.84,7981999.002,2,125,0)
 <xsl:param name="subttl"/>
"KRN",.84,7981999.002,2,126,0)
 <xsl:variable name="table" select="$data/@TABLE"/>
"KRN",.84,7981999.002,2,127,0)
 <xsl:if test="$data/*[1]">
"KRN",.84,7981999.002,2,128,0)
  <xsl:value-of select="$UTILIZATION_HEADER"/>
"KRN",.84,7981999.002,2,129,0)
  <xsl:value-of select="concat(' (',$subttl,')')"/>
"KRN",.84,7981999.002,2,130,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981999.002,2,131,0)
  <xsl:apply-templates select="$data"/>
"KRN",.84,7981999.002,2,132,0)
  <xsl:value-of select="$FILESWITCH"/>
"KRN",.84,7981999.002,2,133,0)
 </xsl:if>
"KRN",.84,7981999.002,2,134,0)
 
"KRN",.84,7981999.002,2,135,0)
</xsl:template>
"KRN",.84,7981999.002,2,136,0)
 
"KRN",.84,7981999.002,2,137,0)
<!--
"KRN",.84,7981999.002,2,138,0)
=========================================================================
"KRN",.84,7981999.002,2,139,0)
                       DEFAULT DATA GRID TEMPLATES
"KRN",.84,7981999.002,2,140,0)
=========================================================================
"KRN",.84,7981999.002,2,141,0)
-->
"KRN",.84,7981999.002,2,142,0)
 
"KRN",.84,7981999.002,2,143,0)
<xsl:template name="DataGrid" match="*[@TABLE!='']">
"KRN",.84,7981999.002,2,144,0)
 <xsl:variable name="tbldef" select="key('TableDefs',@TABLE)"/>
"KRN",.84,7981999.002,2,145,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981999.002,2,146,0)
 <xsl:choose>
"KRN",.84,7981999.002,2,147,0)
  <xsl:when test="*[1]">
"KRN",.84,7981999.002,2,148,0)
   <xsl:apply-templates select="$tbldef/@HEADER"/>
"KRN",.84,7981999.002,2,149,0)
   <xsl:apply-templates select="*"/>
"KRN",.84,7981999.002,2,150,0)
  </xsl:when>
"KRN",.84,7981999.002,2,151,0)
  <xsl:otherwise>
"KRN",.84,7981999.002,2,152,0)
   <xsl:call-template name="TableNoData"/>
"KRN",.84,7981999.002,2,153,0)
  </xsl:otherwise>
"KRN",.84,7981999.002,2,154,0)
 </xsl:choose>
"KRN",.84,7981999.002,2,155,0)
</xsl:template>
"KRN",.84,7981999.002,2,156,0)
 
"KRN",.84,7981999.002,2,157,0)
<!-- Default data grid header -->
"KRN",.84,7981999.002,2,158,0)
 
"KRN",.84,7981999.002,2,159,0)
<xsl:template match="HEADER/TBLDEF/@HEADER">
"KRN",.84,7981999.002,2,160,0)
 <xsl:apply-templates select="..//COLUMN[not(child::COLUMN[1])]"/>
"KRN",.84,7981999.002,2,161,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981999.002,2,162,0)
</xsl:template>
"KRN",.84,7981999.002,2,163,0)
 
"KRN",.84,7981999.002,2,164,0)
<!-- Default column heading cell -->
"KRN",.84,7981999.002,2,165,0)
 
"KRN",.84,7981999.002,2,166,0)
<xsl:template name="ColumnHeader" match="HEADER/TBLDEF/COLUMN">
"KRN",.84,7981999.002,2,167,0)
 <xsl:param name="column" select="."/>
"KRN",.84,7981999.002,2,168,0)
 <xsl:param name="title" select="$column/@NAME"/>
"KRN",.84,7981999.002,2,169,0)
 <xsl:if test="$title!='#'">
"KRN",.84,7981999.002,2,170,0)
  <xsl:call-template name="Quote">
"KRN",.84,7981999.002,2,171,0)
   <xsl:with-param name="value" select="$title"/>
"KRN",.84,7981999.002,2,172,0)
  </xsl:call-template>
"KRN",.84,7981999.002,2,173,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981999.002,2,174,0)
 </xsl:if>
"KRN",.84,7981999.002,2,175,0)
</xsl:template>
"KRN",.84,7981999.002,2,176,0)
 
"KRN",.84,7981999.002,2,177,0)
<!-- Default data grid row -->
"KRN",.84,7981999.002,2,178,0)
 
"KRN",.84,7981999.002,2,179,0)
<xsl:template match="*[@TABLE!='']/*">
"KRN",.84,7981999.002,2,180,0)
 <xsl:param name="seqnum" select="0"/>
"KRN",.84,7981999.002,2,181,0)
 <xsl:if test="$seqnum">
"KRN",.84,7981999.002,2,182,0)
  <xsl:value-of select="position()"/>
"KRN",.84,7981999.002,2,183,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981999.002,2,184,0)
 </xsl:if>
"KRN",.84,7981999.002,2,185,0)
 <xsl:apply-templates select="child::*"/>
"KRN",.84,7981999.002,2,186,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981999.002,2,187,0)
</xsl:template>
"KRN",.84,7981999.002,2,188,0)
 
"KRN",.84,7981999.002,2,189,0)
<!-- Data grid cell -->
"KRN",.84,7981999.002,2,190,0)
 
"KRN",.84,7981999.002,2,191,0)
<xsl:template name="TableCell" match="*[@TABLE!='']/*/*">
"KRN",.84,7981999.002,2,192,0)
 <xsl:param name="fmdt" select="0"/>
"KRN",.84,7981999.002,2,193,0)
 <xsl:param name="value" select="."/>
"KRN",.84,7981999.002,2,194,0)
 <xsl:param name="yesno" select="0"/>
"KRN",.84,7981999.002,2,195,0)
 <xsl:choose>
"KRN",.84,7981999.002,2,196,0)
  <xsl:when test="boolean($fmdt)">
"KRN",.84,7981999.002,2,197,0)
   <xsl:call-template name="DateTime">
"KRN",.84,7981999.002,2,198,0)
    <xsl:with-param name="dt" select="$value"/>
"KRN",.84,7981999.002,2,199,0)
   </xsl:call-template>
"KRN",.84,7981999.002,2,200,0)
  </xsl:when>
"KRN",.84,7981999.002,2,201,0)
  <xsl:when test="boolean($yesno)">
"KRN",.84,7981999.002,2,202,0)
   <xsl:choose>
"KRN",.84,7981999.002,2,203,0)
    <xsl:when test="$value!=0">Yes</xsl:when>
"KRN",.84,7981999.002,2,204,0)
    <xsl:otherwise>No</xsl:otherwise>
"KRN",.84,7981999.002,2,205,0)
   </xsl:choose>
"KRN",.84,7981999.002,2,206,0)
  </xsl:when>
"KRN",.84,7981999.002,2,207,0)
  <xsl:otherwise>
"KRN",.84,7981999.002,2,208,0)
   <xsl:call-template name="Quote">
"KRN",.84,7981999.002,2,209,0)
    <xsl:with-param name="value" select="$value"/>
"KRN",.84,7981999.002,2,210,0)
   </xsl:call-template>
"KRN",.84,7981999.002,2,211,0)
  </xsl:otherwise>
"KRN",.84,7981999.002,2,212,0)
 </xsl:choose>
"KRN",.84,7981999.002,2,213,0)
 <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981999.002,2,214,0)
</xsl:template>
"KRN",.84,7981999.002,2,215,0)
 
"KRN",.84,7981999.002,2,216,0)
<!-- Default column headers -->
"KRN",.84,7981999.002,2,217,0)
 
"KRN",.84,7981999.002,2,218,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981999.002,2,219,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.002,2,220,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981999.002,2,221,0)
 </xsl:call-template>
"KRN",.84,7981999.002,2,222,0)
</xsl:template>
"KRN",.84,7981999.002,2,223,0)
 
"KRN",.84,7981999.002,2,224,0)
<xsl:template match="COLUMN[@NAME='DOD']">
"KRN",.84,7981999.002,2,225,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.002,2,226,0)
  <xsl:with-param name="title" select="'Date of Death'"/>
"KRN",.84,7981999.002,2,227,0)
 </xsl:call-template>
"KRN",.84,7981999.002,2,228,0)
</xsl:template>
"KRN",.84,7981999.002,2,229,0)
 
"KRN",.84,7981999.002,2,230,0)
<xsl:template match="COLUMN[@NAME='LAST4']">
"KRN",.84,7981999.002,2,231,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.002,2,232,0)
  <xsl:with-param name="title" select="'SSN'"/>
"KRN",.84,7981999.002,2,233,0)
 </xsl:call-template>
"KRN",.84,7981999.002,2,234,0)
</xsl:template>
"KRN",.84,7981999.002,2,235,0)
 
"KRN",.84,7981999.002,2,236,0)
<xsl:template match="COLUMN[@NAME='NAME']">
"KRN",.84,7981999.002,2,237,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.002,2,238,0)
  <xsl:with-param name="title" select="'Name'"/>
"KRN",.84,7981999.002,2,239,0)
 </xsl:call-template>
"KRN",.84,7981999.002,2,240,0)
</xsl:template>
"KRN",.84,7981999.002,2,241,0)
 
"KRN",.84,7981999.002,2,242,0)
<xsl:template match="TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='NAME']">
"KRN",.84,7981999.002,2,243,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.002,2,244,0)
  <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981999.002,2,245,0)
 </xsl:call-template>
"KRN",.84,7981999.002,2,246,0)
</xsl:template>
"KRN",.84,7981999.002,2,247,0)
 
"KRN",.84,7981999.002,2,248,0)
<!-- Default cells -->
"KRN",.84,7981999.002,2,249,0)
 
"KRN",.84,7981999.002,2,250,0)
<xsl:template match="PATIENT/DOD">
"KRN",.84,7981999.002,2,251,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981999.002,2,252,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981999.002,2,253,0)
 </xsl:call-template>
"KRN",.84,7981999.002,2,254,0)
</xsl:template>
"KRN",.84,7981999.002,2,255,0)
 
"KRN",.84,7981999.002,2,256,0)
</xsl:stylesheet>
"KRN",.84,99001162,-1)
1^7
"KRN",.84,99001162,0)
7980000.005
"KRN",19,11321,-1)
0^10
"KRN",19,11321,0)
RORHDT MAIN^Historical Data Extraction^^M^^^^^^^^CLINICAL CASE REGISTRIES^^^
"KRN",19,11321,1,0)
^19.06^16^16^3060131^^
"KRN",19,11321,1,1,0)
 
"KRN",19,11321,1,2,0)
This is a top level management option for the historical data extraction
"KRN",19,11321,1,3,0)
that gathers historical data for each registry patient that exists on the
"KRN",19,11321,1,4,0)
ROR REGISTRY RECORD file (#798) and creates flat text files that can be
"KRN",19,11321,1,5,0)
FTP'd to a pre-defined area at the AAC. This is done independently of
"KRN",19,11321,1,6,0)
daily updates and extracts and requires some intervention of an IRM.
"KRN",19,11321,1,7,0)
 
"KRN",19,11321,1,8,0)
Each data extraction task will get the historical data patient by patient
"KRN",19,11321,1,9,0)
and write it to a flat text file in HL7 format. If any data errors are
"KRN",19,11321,1,10,0)
found they will be reported on log file, the task will then continue onto
"KRN",19,11321,1,11,0)
the next patient on the registry.
"KRN",19,11321,1,12,0)
 
"KRN",19,11321,1,13,0)
IRM's can check the status of the task using this user interface and view
"KRN",19,11321,1,14,0)
the log file if any errors have been found. The log will provide enough
"KRN",19,11321,1,15,0)
information for the IRM to fix the errors. After errors are fixed the task
"KRN",19,11321,1,16,0)
can be re-started via this interface.
"KRN",19,11321,2)
y
"KRN",19,11321,10,0)
^19.01IP^6^6
"KRN",19,11321,10,1,0)
11322^DS^10
"KRN",19,11321,10,1,"^")
RORHDT STATUS
"KRN",19,11321,10,3,0)
11324^ST^20
"KRN",19,11321,10,3,"^")
RORHDT START
"KRN",19,11321,10,4,0)
11325^TT^25
"KRN",19,11321,10,4,"^")
RORHDT STOP
"KRN",19,11321,10,5,0)
11326^ED^15
"KRN",19,11321,10,5,"^")
RORHDT EDIT
"KRN",19,11321,10,6,0)
11328^DL^30
"KRN",19,11321,10,6,"^")
RORHDT LOG
"KRN",19,11321,15)

"KRN",19,11321,20)

"KRN",19,11321,99)
60282,36285
"KRN",19,11321,200.9)
^
"KRN",19,11321,"U")
HISTORICAL DATA EXTRACTION
"KRN",19,11322,-1)
0^12
"KRN",19,11322,0)
RORHDT STATUS^Display Extraction Status^^R^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11322,1,0)
^^15^15^3060131^
"KRN",19,11322,1,1,0)
 
"KRN",19,11322,1,2,0)
This option displays the status of a selected data extraction. The 
"KRN",19,11322,1,3,0)
historical data extraction start and end dates, the output directory name,
"KRN",19,11322,1,4,0)
processed registries, and task table are displayed. For each task in the
"KRN",19,11322,1,5,0)
table the following information is displayed:
"KRN",19,11322,1,6,0)
 
"KRN",19,11322,1,7,0)
ID: Identificator of the task (sequential number). 
"KRN",19,11322,1,8,0)
 
"KRN",19,11322,1,9,0)
File name: Unique name based on site number and sequential number of the
"KRN",19,11322,1,10,0)
task.  This file will contain the extracted data when the task has run; it
"KRN",19,11322,1,11,0)
will reside in the designated output directory.
"KRN",19,11322,1,12,0)
 
"KRN",19,11322,1,13,0)
Task: Task number assigned by the Taskman for the data extraction task.
"KRN",19,11322,1,14,0)
 
"KRN",19,11322,1,15,0)
Status: Indicates the current status of the task.
"KRN",19,11322,2)
y
"KRN",19,11322,25)
STATUS^RORHDT
"KRN",19,11322,99)
58659,36996
"KRN",19,11322,"U")
DISPLAY EXTRACTION STATUS
"KRN",19,11323,-1)
0^5
"KRN",19,11323,0)
RORHDT CREATE^Create Extraction Tasks^^R^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11323,1,0)
^^4^4^3060131^
"KRN",19,11323,1,1,0)
 
"KRN",19,11323,1,2,0)
This option allows users to spread historical data processing over several
"KRN",19,11323,1,3,0)
tasks and thus avoid creating one large task that could use up too many 
"KRN",19,11323,1,4,0)
system resources by taking a long time to complete.
"KRN",19,11323,2)
y
"KRN",19,11323,25)
CREATE^RORHDT
"KRN",19,11323,99)
58659,37007
"KRN",19,11323,"U")
CREATE EXTRACTION TASKS
"KRN",19,11324,-1)
0^11
"KRN",19,11324,0)
RORHDT START^Start a Task^^R^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11324,1,0)
^^5^5^3011214^
"KRN",19,11324,1,1,0)
 
"KRN",19,11324,1,2,0)
This option displays data extraction tasks that were created with the
"KRN",19,11324,1,3,0)
'Create Extraction Tasks' option. Users can select a task and enter a date
"KRN",19,11324,1,4,0)
and time that they want the task to run. This option can be re-entered to
"KRN",19,11324,1,5,0)
re-schedule a previously scheduled task.
"KRN",19,11324,2)
y
"KRN",19,11324,25)
START^RORHDT
"KRN",19,11324,"U")
START A TASK
"KRN",19,11325,-1)
0^13
"KRN",19,11325,0)
RORHDT STOP^Stop a Task^^R^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11325,1,0)
^19.06^3^3^3011214^^
"KRN",19,11325,1,1,0)
 
"KRN",19,11325,1,2,0)
This option allows users to stop a running task or de-queue a task that 
"KRN",19,11325,1,3,0)
is scheduled to run in the future.
"KRN",19,11325,2)
y
"KRN",19,11325,25)
STOP^RORHDT
"KRN",19,11325,"U")
STOP A TASK
"KRN",19,11326,-1)
0^6
"KRN",19,11326,0)
RORHDT EDIT^Edit^^M^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11326,1,0)
^19.06^4^4^3051221^^^^
"KRN",19,11326,1,1,0)
 
"KRN",19,11326,1,2,0)
This option displays a submenu when selected. The submenu contains options
"KRN",19,11326,1,3,0)
that are used to create and edit the parameters of the historical data
"KRN",19,11326,1,4,0)
extraction.
"KRN",19,11326,2)
y
"KRN",19,11326,10,0)
^19.01IP^4^2
"KRN",19,11326,10,1,0)
11323^CT^10
"KRN",19,11326,10,1,"^")
RORHDT CREATE
"KRN",19,11326,10,4,0)
12477^EE
"KRN",19,11326,10,4,"^")
RORHDT EDIT EXTRACTION
"KRN",19,11326,99)
60282,36285
"KRN",19,11326,"U")
EDIT
"KRN",19,11328,-1)
0^9
"KRN",19,11328,0)
RORHDT LOG^Display Task Log^^R^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11328,1,0)
^19.06^4^4^3030610^^^
"KRN",19,11328,1,1,0)
 
"KRN",19,11328,1,2,0)
The 'Display Task Log' option lets users see a log of any running/finished
"KRN",19,11328,1,3,0)
data extraction task. If any errors have been found, they would be logged
"KRN",19,11328,1,4,0)
here. Any errors should be fixed and then the task re-started.
"KRN",19,11328,2)
y
"KRN",19,11328,25)
LOG^RORHDT
"KRN",19,11328,"U")
DISPLAY TASK LOG
"KRN",19,11336,-1)
0^4
"KRN",19,11336,0)
ROR TASK^Registry Update & Data Extraction^^R^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11336,1,0)
^19.06^35^35^3040617^^^
"KRN",19,11336,1,1,0)
 
"KRN",19,11336,1,2,0)
This option starts the registry update and data extraction task that
"KRN",19,11336,1,3,0)
processes registries defined by the TASK PARAMETERS field. The field must
"KRN",19,11336,1,4,0)
contain a list of registry names separated by commas.
"KRN",19,11336,1,5,0)
 
"KRN",19,11336,1,6,0)
The following task parameters are optional. They can be defined on the
"KRN",19,11336,1,7,0)
second page of the option scheduling form (as the pairs of the variable 
"KRN",19,11336,1,8,0)
names and values).
"KRN",19,11336,1,9,0)
 
"KRN",19,11336,1,10,0)
RORFLCLR, RORFLSET (Default: "")
"KRN",19,11336,1,11,0)
 
"KRN",19,11336,1,12,0)
These two parameters override the values of the flags that control the 
"KRN",19,11336,1,13,0)
processing. Add the flags to the RORFLCLR variable to clear them and to
"KRN",19,11336,1,14,0)
the RORFLSET variable to set them. Below are the possible values of the 
"KRN",19,11336,1,15,0)
parameters (can be combined):
"KRN",19,11336,1,16,0)
 
"KRN",19,11336,1,17,0)
  "E" - Use the event references (file #798.3)
"KRN",19,11336,1,18,0)
 
"KRN",19,11336,1,19,0)
RORMNTSK (Default: "2-3-AUTO")
"KRN",19,11336,1,20,0)
 
"KRN",19,11336,1,21,0)
Maximum number of the registry update subtasks. If this parameter is less
"KRN",19,11336,1,22,0)
than 2, all patients will be processed by the single main task. Otherwise,
"KRN",19,11336,1,23,0)
all patients can be distributed among several subtasks.
"KRN",19,11336,1,24,0)
 
"KRN",19,11336,1,25,0)
If "N-M-AUTO" is passed as the value of this parameter and difference
"KRN",19,11336,1,26,0)
between the end and start dates of the registry update is more than M days
"KRN",19,11336,1,27,0)
then N subtasks will be started. Otherwise, the single task will run.
"KRN",19,11336,1,28,0)
 
"KRN",19,11336,1,29,0)
RORSUSP (Default: "")
"KRN",19,11336,1,30,0)
 
"KRN",19,11336,1,31,0)
Suspension parameters of the registry update subtasks. The subtasks are
"KRN",19,11336,1,32,0)
not suspended by default. Parameter should contain start and end times of
"KRN",19,11336,1,33,0)
the suspension (in external format) separated by the "-". For example, the
"KRN",19,11336,1,34,0)
"7:00-18:00" value will suspend the subtasks from 7am until 6pm each day
"KRN",19,11336,1,35,0)
except weekends and holidays.
"KRN",19,11336,2)
n
"KRN",19,11336,25)
TASK^ROR
"KRN",19,11336,200.9)
y^y
"KRN",19,11336,"U")
REGISTRY UPDATE & DATA EXTRACT
"KRN",19,11363,-1)
0^19
"KRN",19,11363,0)
RORMNT MAIN^Clinical Case Registries Maintenance^^M^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11363,1,0)
^19.06^3^3^3060131^^
"KRN",19,11363,1,1,0)
 
"KRN",19,11363,1,2,0)
This menu contains miscellaneous maintenance options for the Clinical Case
"KRN",19,11363,1,3,0)
Registries package. Usually, they should be used only for troubleshooting.
"KRN",19,11363,2)
y
"KRN",19,11363,10,0)
^19.01IP^7^7
"KRN",19,11363,10,1,0)
11364^PLF
"KRN",19,11363,10,1,"^")
RORMNT PRINT LOGS
"KRN",19,11363,10,3,0)
11366^ERP
"KRN",19,11363,10,3,"^")
RORMNT EDIT REG PARAMS
"KRN",19,11363,10,4,0)
11372^ELS
"KRN",19,11363,10,4,"^")
RORMNT EDIT LAB SEARCH
"KRN",19,11363,10,5,0)
11556^PP
"KRN",19,11363,10,5,"^")
RORMNT PENDING PATIENTS
"KRN",19,11363,10,6,0)
11765^ACL
"KRN",19,11363,10,6,"^")
RORMNT ACL REINDEX
"KRN",19,11363,10,7,0)
11321^HDE
"KRN",19,11363,10,7,"^")
RORHDT MAIN
"KRN",19,11363,99)
60282,36285
"KRN",19,11363,200.9)
^y
"KRN",19,11363,"U")
CLINICAL CASE REGISTRIES MAINT
"KRN",19,11364,-1)
0^22
"KRN",19,11364,0)
RORMNT PRINT LOGS^Print Log Files^^P^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11364,1,0)
^^2^2^3060131^
"KRN",19,11364,1,1,0)
 
"KRN",19,11364,1,2,0)
This option can be used to print messages recorded by the CCR software.
"KRN",19,11364,2)
y
"KRN",19,11364,60)
RORDATA(798.7,
"KRN",19,11364,62)
0
"KRN",19,11364,63)
[ROR LOG]
"KRN",19,11364,64)
[ROR LOG]
"KRN",19,11364,65)

"KRN",19,11364,66)

"KRN",19,11364,"U")
PRINT LOG FILES
"KRN",19,11366,-1)
0^18
"KRN",19,11366,0)
RORMNT EDIT REG PARAMS^Edit Registry Parameters^^E^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11366,1,0)
^19.06^3^3^3020729^^^
"KRN",19,11366,1,1,0)
 
"KRN",19,11366,1,2,0)
This option can be used to edit registry parameters in the 'ROR REGISTRY 
"KRN",19,11366,1,3,0)
PARAMETERS' file.
"KRN",19,11366,2)
y
"KRN",19,11366,30)
ROR(798.1,
"KRN",19,11366,31)
AEMQ
"KRN",19,11366,50)
ROR(798.1,
"KRN",19,11366,51)
[RORMNT EDIT REG PARAMS]
"KRN",19,11366,"U")
EDIT REGISTRY PARAMETERS
"KRN",19,11372,-1)
0^17
"KRN",19,11372,0)
RORMNT EDIT LAB SEARCH^Edit Lab Search Criteria^^E^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11372,1,0)
^^3^3^3060131^
"KRN",19,11372,1,1,0)
This option is used to edit the Lab search criteria (stored in the ROR LAB
"KRN",19,11372,1,2,0)
SEARCH file (#798.9)) that are used by the registry update process to find
"KRN",19,11372,1,3,0)
patients with positive registry-specific Lab results.
"KRN",19,11372,2)
y
"KRN",19,11372,30)
ROR(798.9,
"KRN",19,11372,31)
AEMQ
"KRN",19,11372,50)
ROR(798.9,
"KRN",19,11372,51)
[RORMNT EDIT LAB SEARCH]
"KRN",19,11372,"U")
EDIT LAB SEARCH CRITERIA
"KRN",19,11555,-1)
0^20
"KRN",19,11555,0)
RORMNT PENDING ERRORS LIST^List of Pending Errors^^P^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11555,1,0)
^^9^9^3060131^
"KRN",19,11555,1,1,0)
 
"KRN",19,11555,1,2,0)
The option prints a report containing list of patients (referenced by the
"KRN",19,11555,1,3,0)
ERROR multiples of the ROR PATIENT EVENTS file (#798.3)) having erroneous
"KRN",19,11555,1,4,0)
data. The list is sorted by value of the COUNTER field (number of times
"KRN",19,11555,1,5,0)
that an error was recorded for a patient).
"KRN",19,11555,1,6,0)
 
"KRN",19,11555,1,7,0)
This report can be used to find patients ignored by the registry update
"KRN",19,11555,1,8,0)
(until someone fixes the error(s) and resets value of the COUNTER field to
"KRN",19,11555,1,9,0)
1).
"KRN",19,11555,2)
y
"KRN",19,11555,60)
RORDATA(798.3,
"KRN",19,11555,62)
0
"KRN",19,11555,63)
[ROR PENDING ERRORS]
"KRN",19,11555,64)
[ROR PENDING ERRORS]
"KRN",19,11555,65)

"KRN",19,11555,66)

"KRN",19,11555,"U")
LIST OF PENDING ERRORS
"KRN",19,11556,-1)
0^21
"KRN",19,11556,0)
RORMNT PENDING PATIENTS^Pending Patients^^M^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11556,1,0)
^^3^3^3060131^
"KRN",19,11556,1,1,0)
 
"KRN",19,11556,1,2,0)
This menu groups the options used for maintenance of the ROR PATIENT 
"KRN",19,11556,1,3,0)
EVENTS file (#798.3) containing event and error references.
"KRN",19,11556,2)
y
"KRN",19,11556,10,0)
^19.01IP^1^1
"KRN",19,11556,10,1,0)
11555^LPE
"KRN",19,11556,10,1,"^")
RORMNT PENDING ERRORS LIST
"KRN",19,11556,99)
60282,36285
"KRN",19,11556,"U")
PENDING PATIENTS
"KRN",19,11616,-1)
0^1
"KRN",19,11616,0)
ROR GUI^Broker Context^^B^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11616,1,0)
^19.06^2^2^3030714^^^^
"KRN",19,11616,1,1,0)
This option holds the references to the package RPC Broker Calls used by
"KRN",19,11616,1,2,0)
the GUI to create an application context (for security purposes).
"KRN",19,11616,99.1)
60102,47414
"KRN",19,11616,200.9)
^y
"KRN",19,11616,"RPC",0)
^19.05P^89^89
"KRN",19,11616,"RPC",10,0)
XWB GET VARIABLE VALUE
"KRN",19,11616,"RPC",14,0)
ROR LOG MESSAGE DETAILS
"KRN",19,11616,"RPC",16,0)
XUS GET USER INFO
"KRN",19,11616,"RPC",17,0)
XUS KEY CHECK
"KRN",19,11616,"RPC",29,0)
ROR REPORT RETRIEVE
"KRN",19,11616,"RPC",30,0)
ROR GUI ACCESS
"KRN",19,11616,"RPC",31,0)
ROR TASK INFO
"KRN",19,11616,"RPC",32,0)
ROR TASK LIST
"KRN",19,11616,"RPC",33,0)
ROR REPORT SCHEDULE
"KRN",19,11616,"RPC",34,0)
XWB IS RPC AVAILABLE
"KRN",19,11616,"RPC",35,0)
ROR GET REGISTRY INFO
"KRN",19,11616,"RPC",36,0)
ROR LIST REGISTRY USERS
"KRN",19,11616,"RPC",37,0)
ROR GUI PARAMETER GET
"KRN",19,11616,"RPC",38,0)
ROR GUI PARAMETER SET
"KRN",19,11616,"RPC",39,0)
ROR LOG GET ACCESS VIOLATIONS
"KRN",19,11616,"RPC",40,0)
ROR LOG GET LIST
"KRN",19,11616,"RPC",41,0)
ROR LOG GET MESSAGES
"KRN",19,11616,"RPC",42,0)
ROR REPORTS AVAILABLE
"KRN",19,11616,"RPC",43,0)
ROR TASK DELETE
"KRN",19,11616,"RPC",44,0)
ROR REPORT STYLESHEET
"KRN",19,11616,"RPC",45,0)
ROR LIST PATIENTS
"KRN",19,11616,"RPC",46,0)
ROR PATIENT SELECTION RULES
"KRN",19,11616,"RPC",47,0)
ROR LIST DIVISIONS
"KRN",19,11616,"RPC",48,0)
ROR LIST HOSPITAL LOCATIONS
"KRN",19,11616,"RPC",49,0)
ROR LIST ICD-9
"KRN",19,11616,"RPC",50,0)
ROR LIST LABORATORY TESTS
"KRN",19,11616,"RPC",51,0)
ROR LIST VA DRUG CLASSES
"KRN",19,11616,"RPC",52,0)
ROR LIST ITEMS
"KRN",19,11616,"RPC",53,0)
ROR LIST VISTA USERS
"KRN",19,11616,"RPC",54,0)
ROR UPDATE COORDINATORS
"KRN",19,11616,"RPC",55,0)
ROR LIST COORDINATORS
"KRN",19,11616,"RPC",56,0)
ROR LIST STATES
"KRN",19,11616,"RPC",57,0)
RORICR CDC LOAD
"KRN",19,11616,"RPC",58,0)
RORICR CDC SAVE
"KRN",19,11616,"RPC",59,0)
ROR LOG INFO
"KRN",19,11616,"RPC",60,0)
ROR GET USER INFO
"KRN",19,11616,"RPC",61,0)
ROR PATIENT GET DATA
"KRN",19,11616,"RPC",63,0)
ROR PATIENT DELETE
"KRN",19,11616,"RPC",64,0)
ROR LIST LOCAL LAB TESTS
"KRN",19,11616,"RPC",65,0)
ROR UPDATE LOCAL LAB TESTS
"KRN",19,11616,"RPC",66,0)
ROR UPDATE LOCAL DRUGS
"KRN",19,11616,"RPC",67,0)
ROR LIST LOCAL DRUGS
"KRN",19,11616,"RPC",68,0)
ROR LIST DRUGS
"KRN",19,11616,"RPC",69,0)
RORICR PATIENT LOAD
"KRN",19,11616,"RPC",70,0)
RORICR PATIENT SAVE
"KRN",19,11616,"RPC",72,0)
RORICR CDC CANCEL
"KRN",19,11616,"RPC",73,0)
ROR TASK VALIDATE RESCHEDULING
"KRN",19,11616,"RPC",74,0)
ROR LIST GENERIC DRUGS
"KRN",19,11616,"RPC",75,0)
RORHEPC PATIENT LOAD
"KRN",19,11616,"RPC",76,0)
RORHEPC PATIENT SAVE
"KRN",19,11616,"RPC",78,0)
VAFCTFU CONVERT DFN TO ICN
"KRN",19,11616,"RPC",79,0)
VAFCTFU CONVERT ICN TO DFN
"KRN",19,11616,"RPC",80,0)
ROR LIST PARAMETER INSTANCES
"KRN",19,11616,"RPC",81,0)
ROR GUI PARAMETER RENAME
"KRN",19,11616,"RPC",82,0)
DDR LISTER
"KRN",19,11616,"RPC",83,0)
ROR LIST LOCAL FIELDS
"KRN",19,11616,"RPC",84,0)
ROR LIST SELECTION RULES
"KRN",19,11616,"RPC",85,0)
ROR PRODUCTION ACCOUNT
"KRN",19,11616,"RPC",86,0)
ROR UPDATE LOCAL FIELDS
"KRN",19,11616,"RPC",87,0)
ROR GET SERVER TIME
"KRN",19,11616,"RPC",88,0)
ROR LIST CPT
"KRN",19,11616,"RPC",89,0)
ROR PATIENT REGISTRY LABS
"KRN",19,11616,"U")
BROKER CONTEXT
"KRN",19,11765,-1)
0^15
"KRN",19,11765,0)
RORMNT ACL REINDEX^Re-index the ACL cross-reference^^R^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11765,1,0)
^19.06^9^9^3030714^^
"KRN",19,11765,1,1,0)
 
"KRN",19,11765,1,2,0)
The 'Re-index the ACL cross-reference' option lets users re-index the
"KRN",19,11765,1,3,0)
"ACL" cross-reference of the ROR REGISTRY PARAMETERS file (#798.1). This
"KRN",19,11765,1,4,0)
cross-reference should be rebuilt after changes in the allocation of the
"KRN",19,11765,1,5,0)
security keys associated with any registry.
"KRN",19,11765,1,6,0)
 
"KRN",19,11765,1,7,0)
Usually, this is done by the nightly task (the [ROR TASK] option).  
"KRN",19,11765,1,8,0)
However, if you want the changes to be in effect immediately, you should
"KRN",19,11765,1,9,0)
rebuild this cross-reference manually.
"KRN",19,11765,2)
y
"KRN",19,11765,10.1)
Reindex the ACL xref
"KRN",19,11765,25)
RNDXACL^RORVM001
"KRN",19,11765,"U")
RE-INDEX THE ACL CROSS-REFEREN
"KRN",19,11776,-1)
0^14
"KRN",19,11776,0)
RORICR VERSION COMPARISON^ICR Version Comparison Report^^R^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11776,1,0)
^19.06^10^10^3030722^^^
"KRN",19,11776,1,1,0)
 
"KRN",19,11776,1,2,0)
This option schedules a task, which generates the version comparison
"KRN",19,11776,1,3,0)
report. The report is used during the installation of the Immunology Case
"KRN",19,11776,1,4,0)
Registry V.3.0 software.
"KRN",19,11776,1,5,0)
 
"KRN",19,11776,1,6,0)
The first part of the report details all living patients that exist within
"KRN",19,11776,1,7,0)
the V.2.1 patient list but are not in the V.3.0 list. The second part of
"KRN",19,11776,1,8,0)
the report details all living patients that exist in the V.3.0 list but do
"KRN",19,11776,1,9,0)
not appear in the V.2.1 list. The third part of the report will list all
"KRN",19,11776,1,10,0)
patients that are both in V.2.1 and V.3.0.
"KRN",19,11776,2)
y
"KRN",19,11776,25)
BEGIN^RORREP01
"KRN",19,11776,200.9)
^y
"KRN",19,11776,"U")
ICR VERSION COMPARISON REPORT
"KRN",19,11794,-1)
0^3
"KRN",19,11794,0)
ROR SETUP^Registry Setup^^R^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,11794,1,0)
^19.06^3^3^3030714^^
"KRN",19,11794,1,1,0)
  
"KRN",19,11794,1,2,0)
This option allows the user to enter parameters of the registry setup 
"KRN",19,11794,1,3,0)
process and schedule the task that will populate the registry.
"KRN",19,11794,2)
y
"KRN",19,11794,25)
RORSET01
"KRN",19,11794,200.9)
n^y
"KRN",19,11794,"U")
REGISTRY SETUP
"KRN",19,12477,-1)
0^23
"KRN",19,12477,0)
RORHDT EDIT EXTRACTION^Edit data extraction^^R^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",19,12477,1,0)
^^3^3^3060131^
"KRN",19,12477,1,1,0)
 
"KRN",19,12477,1,2,0)
This option allows users to edit parameters of manual historical data
"KRN",19,12477,1,3,0)
extraction in the ROR HISTORICAL DATA EXTRACTION file (#799.6).
"KRN",19,12477,2)
y
"KRN",19,12477,25)
EDITHDE^RORHDT
"KRN",19,12477,"U")
EDIT DATA EXTRACTION
"KRN",19,12484,-1)
1^2
"KRN",19,12484,0)
ROR GUI MENU
"KRN",19,12485,-1)
1^7
"KRN",19,12485,0)
RORHDT EDIT REGISTRY
"KRN",19,12486,-1)
1^8
"KRN",19,12486,0)
RORHDT EDIT TASK
"KRN",19,12487,-1)
1^16
"KRN",19,12487,0)
RORMNT AWAITING ACK
"KRN",19.1,414,-1)
0^1
"KRN",19.1,414,0)
ROR VA HEPC ADMIN^HepC registry administrator^l
"KRN",19.1,414,1,0)
^^1^1^3050908^
"KRN",19.1,414,1,1,0)
Hepatitis C registry administrator
"KRN",19.1,415,-1)
0^2
"KRN",19.1,415,0)
ROR VA HEPC USER^HepC registry user^l
"KRN",19.1,415,1,0)
^^1^1^3050908^
"KRN",19.1,415,1,1,0)
Hepatitis C registry user
"KRN",19.1,440,-1)
0^5
"KRN",19.1,440,0)
ROR VA IRM^Clinical Case Registry Support^l
"KRN",19.1,440,1,0)
^19.11^3^3^3021223^^^
"KRN",19.1,440,1,1,0)
This security key should be assigned to the IRM personnel designated to 
"KRN",19.1,440,1,2,0)
support the Clinical Case Registry application (patch installation, 
"KRN",19.1,440,1,3,0)
troubleshooting, etc).
"KRN",19.1,482,-1)
0^6
"KRN",19.1,482,0)
ROR VA HIV ADMIN^HIV registry administrator^l
"KRN",19.1,482,1,0)
^^1^1^3050908^
"KRN",19.1,482,1,1,0)
Human Immunodeficiency Virus reigstry administartor
"KRN",19.1,483,-1)
0^7
"KRN",19.1,483,0)
ROR VA HIV USER^HIV registry user^l
"KRN",19.1,483,1,0)
^^1^1^3050908^
"KRN",19.1,483,1,1,0)
Human Immunodeficiency Virus registry user
"KRN",101,5274,-1)
0^4
"KRN",101,5274,0)
ROR-SITE-DRIVER^Clinical Case Registries Client^^E^^^^^^^^
"KRN",101,5274,99)
60149,33585
"KRN",101,5274,770)
ROR SITE^^CSU^C09^25^^^AL^NE^2.4^
"KRN",101,5274,772)

"KRN",101,5274,775,0)
^101.0775PA^2^1
"KRN",101,5274,775,2,0)
5275
"KRN",101,5274,775,2,"^")
ROR-SITE-SUBSCRIBER
"KRN",101,5275,-1)
0^5
"KRN",101,5275,0)
ROR-SITE-SUBSCRIBER^Clinical Case Registries Server^^S^^^^^^^^
"KRN",101,5275,99)
60149,33585
"KRN",101,5275,770)
^ROR AAC^^C09^^^ROR SEND^^^^ACK
"KRN",101,5275,771)

"KRN",101,5275,773)
1^0^0
"KRN",101,5276,-1)
0^1
"KRN",101,5276,0)
ROR EVENT LAB^LAB RESULTS => ROR PENDING PATIENT^^A^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",101,5276,1,0)
^^12^12^3060202^
"KRN",101,5276,1,1,0)
This protocol is used by the Clinical Case Registries package to
"KRN",101,5276,1,2,0)
maintain references to patients who have lab results. The protocol 
"KRN",101,5276,1,3,0)
should be subscribed to the LR7O ALL EVSEND RESULTS protocol (this is
"KRN",101,5276,1,4,0)
done by the KIDS during the installation).
"KRN",101,5276,1,5,0)
 
"KRN",101,5276,1,6,0)
If at least one of the defined registries enables event protocols,
"KRN",101,5276,1,7,0)
this protocol will process the Lab events and create references in
"KRN",101,5276,1,8,0)
the ROR PATIENT EVENTS file (#798.3).
"KRN",101,5276,1,9,0)
                                 
"KRN",101,5276,1,10,0)
Otherwise, the protocol will be executed (if it is not disabled or
"KRN",101,5276,1,11,0)
unsubscribed manually) but will not call the processing routine 
"KRN",101,5276,1,12,0)
(LAB^ROREVT01).
"KRN",101,5276,20)
D:$D(^ROR(798.1,"AEP"))>1 LAB^ROREVT01
"KRN",101,5276,99)
60149,33585
"KRN",101,5278,-1)
0^3
"KRN",101,5278,0)
ROR EVENT VISIT^VISIT DATA => ROR PENDING PATIENT^^A^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",101,5278,1,0)
^^13^13^3060202^
"KRN",101,5278,1,1,0)
This protocol is used by the Clinical Case Registries package to 
"KRN",101,5278,1,2,0)
maintain references to patients who have new data in the V-files
"KRN",101,5278,1,3,0)
(VISIT, V POV, etc). The protocol should be subscribed to the PXK
"KRN",101,5278,1,4,0)
VISIT DATA EVENT protocol (this is done by the KIDS during the
"KRN",101,5278,1,5,0)
installation).
"KRN",101,5278,1,6,0)
 
"KRN",101,5278,1,7,0)
If at least one of the defined registries enables event protocols,
"KRN",101,5278,1,8,0)
this protocol will process the Lab events and create references in
"KRN",101,5278,1,9,0)
the ROR PATIENT EVENTS file (#798.3).
"KRN",101,5278,1,10,0)
                                 
"KRN",101,5278,1,11,0)
Otherwise, the protocol will be executed (if it is not disabled or
"KRN",101,5278,1,12,0)
unsubscribed manually) but will not call the processing routine 
"KRN",101,5278,1,13,0)
(VISIT^ROREVT01).
"KRN",101,5278,20)
D:$D(^ROR(798.1,"AEP"))>1 VISIT^ROREVT01
"KRN",101,5278,99)
60149,33585
"KRN",101,5279,-1)
0^2
"KRN",101,5279,0)
ROR EVENT PTF^ADMISSION DATA => ROR PENDING PATIENT^^A^^^^^^^^CLINICAL CASE REGISTRIES
"KRN",101,5279,1,0)
^^12^12^3060202^
"KRN",101,5279,1,1,0)
This protocol is used by the Clinical Case Registries package to 
"KRN",101,5279,1,2,0)
maintain references to patients who have new admissions. The protocol
"KRN",101,5279,1,3,0)
should be subscribed to the DGPM MOVEMENT EVENT protocol (this is
"KRN",101,5279,1,4,0)
done by the KIDS during the installation).
"KRN",101,5279,1,5,0)
 
"KRN",101,5279,1,6,0)
If at least one of the defined registries enables event protocols,
"KRN",101,5279,1,7,0)
this protocol will process the movement events and create references
"KRN",101,5279,1,8,0)
in the ROR PATIENT EVENTS file (#798.3).
"KRN",101,5279,1,9,0)
                                 
"KRN",101,5279,1,10,0)
Otherwise, the protocol will be executed (if it is not disabled or
"KRN",101,5279,1,11,0)
unsubscribed manually) but will not call the processing routine 
"KRN",101,5279,1,12,0)
(PTF^ROREVT01).
"KRN",101,5279,20)
D:$D(^ROR(798.1,"AEP"))>1 PTF^ROREVT01
"KRN",101,5279,99)
60149,33585
"KRN",101,5975,-1)
1^6
"KRN",101,5975,0)
RORICR-SITE-DRIVER
"KRN",101,5976,-1)
1^7
"KRN",101,5976,0)
RORICR-SITE-SUBSCRIBER
"KRN",771,58,-1)
0^2
"KRN",771,58,0)
ROR SITE^a^^^^^US
"KRN",771,58,"EC")
^~\&
"KRN",771,58,"FS")
|
"KRN",771,59,-1)
0^1
"KRN",771,59,0)
ROR AAC^a^^^^^US
"KRN",771,59,"EC")
^~\&
"KRN",771,59,"FS")
|
"KRN",870,35,-1)
0^1
"KRN",870,35,0)
ROR SEND^^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,35,200)
^^^30^600^^^^^R
"KRN",870,35,400)
10.224.187.9^7002^C^^10^^
"KRN",870,95,-1)
1^2
"KRN",870,95,0)
RORICR SND
"KRN",8989.5,14113,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::AIDS Defining Illness (1993)
"KRN",8989.5,14113,1)
CCR Predefined Report Template
"KRN",8989.5,14113,2,0)
^^362^362^3051121^
"KRN",8989.5,14113,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14113,2,2,0)
<PARAMS>
"KRN",8989.5,14113,2,3,0)
<ICD9LST>
"KRN",8989.5,14113,2,4,0)
<ICD9 ID="003.1">SALMONELLA SEPTICEMIA</ICD9>
"KRN",8989.5,14113,2,5,0)
<ICD9 ID="007.2">COCCIDIOSIS</ICD9>
"KRN",8989.5,14113,2,6,0)
<ICD9 ID="007.4">OTH PROTOZO INTES DIS, CRYPTO</ICD9>
"KRN",8989.5,14113,2,7,0)
<ICD9 ID="013.00">TB MENINGITIS-UNSPEC</ICD9>
"KRN",8989.5,14113,2,8,0)
<ICD9 ID="013.01">TB MENINGITIS-NO EXAM</ICD9>
"KRN",8989.5,14113,2,9,0)
<ICD9 ID="013.02">TB MENINGITIS-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,10,0)
<ICD9 ID="013.03">TB MENINGITIS-MICRO DX</ICD9>
"KRN",8989.5,14113,2,11,0)
<ICD9 ID="013.04">TB MENINGITIS-CULT DX</ICD9>
"KRN",8989.5,14113,2,12,0)
<ICD9 ID="013.05">TB MENINGITIS-HISTO DX</ICD9>
"KRN",8989.5,14113,2,13,0)
<ICD9 ID="013.06">TB MENINGITIS-OTH TEST</ICD9>
"KRN",8989.5,14113,2,14,0)
<ICD9 ID="013.10">TUBRCLMA MENINGES-UNSPEC</ICD9>
"KRN",8989.5,14113,2,15,0)
<ICD9 ID="013.11">TUBRCLMA MENING-NO EXAM</ICD9>
"KRN",8989.5,14113,2,16,0)
<ICD9 ID="013.12">TUBRCLMA MENIN-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,17,0)
<ICD9 ID="013.13">TUBRCLMA MENING-MICRO DX</ICD9>
"KRN",8989.5,14113,2,18,0)
<ICD9 ID="013.14">TUBRCLMA MENING-CULT DX</ICD9>
"KRN",8989.5,14113,2,19,0)
<ICD9 ID="013.15">TUBRCLMA MENING-HISTO DX</ICD9>
"KRN",8989.5,14113,2,20,0)
<ICD9 ID="013.16">TUBRCLMA MENING-OTH TEST</ICD9>
"KRN",8989.5,14113,2,21,0)
<ICD9 ID="013.20">TUBERCULOMA BRAIN-UNSPEC</ICD9>
"KRN",8989.5,14113,2,22,0)
<ICD9 ID="013.21">TUBRCLOMA BRAIN-NO EXAM</ICD9>
"KRN",8989.5,14113,2,23,0)
<ICD9 ID="013.22">TUBRCLMA BRAIN-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,24,0)
<ICD9 ID="013.23">TUBRCLOMA BRAIN-MICRO DX</ICD9>
"KRN",8989.5,14113,2,25,0)
<ICD9 ID="013.24">TUBRCLOMA BRAIN-CULT DX</ICD9>
"KRN",8989.5,14113,2,26,0)
<ICD9 ID="013.25">TUBRCLOMA BRAIN-HISTO DX</ICD9>
"KRN",8989.5,14113,2,27,0)
<ICD9 ID="013.26">TUBRCLOMA BRAIN-OTH TEST</ICD9>
"KRN",8989.5,14113,2,28,0)
<ICD9 ID="013.30">TB BRAIN ABSCESS-UNSPEC</ICD9>
"KRN",8989.5,14113,2,29,0)
<ICD9 ID="013.31">TB BRAIN ABSCESS-NO EXAM</ICD9>
"KRN",8989.5,14113,2,30,0)
<ICD9 ID="013.32">TB BRAIN ABSC-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,31,0)
<ICD9 ID="013.33">TB BRAIN ABSC-MICRO DX</ICD9>
"KRN",8989.5,14113,2,32,0)
<ICD9 ID="013.34">TB BRAIN ABSCESS-CULT DX</ICD9>
"KRN",8989.5,14113,2,33,0)
<ICD9 ID="013.35">TB BRAIN ABSC-HISTO DX</ICD9>
"KRN",8989.5,14113,2,34,0)
<ICD9 ID="013.36">TB BRAIN ABSC-OTH TEST</ICD9>
"KRN",8989.5,14113,2,35,0)
<ICD9 ID="013.40">TUBRCLMA SP CORD-UNSPEC</ICD9>
"KRN",8989.5,14113,2,36,0)
<ICD9 ID="013.41">TUBRCLMA SP CORD-NO EXAM</ICD9>
"KRN",8989.5,14113,2,37,0)
<ICD9 ID="013.42">TUBRCLMA SP CD-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,38,0)
<ICD9 ID="013.43">TUBRCLMA SP CRD-MICRO DX</ICD9>
"KRN",8989.5,14113,2,39,0)
<ICD9 ID="013.44">TUBRCLMA SP CORD-CULT DX</ICD9>
"KRN",8989.5,14113,2,40,0)
<ICD9 ID="013.45">TUBRCLMA SP CRD-HISTO DX</ICD9>
"KRN",8989.5,14113,2,41,0)
<ICD9 ID="013.46">TUBRCLMA SP CRD-OTH TEST</ICD9>
"KRN",8989.5,14113,2,42,0)
<ICD9 ID="013.50">TB SP CRD ABSCESS-UNSPEC</ICD9>
"KRN",8989.5,14113,2,43,0)
<ICD9 ID="013.51">TB SP CRD ABSC-NO EXAM</ICD9>
"KRN",8989.5,14113,2,44,0)
<ICD9 ID="013.52">TB SP CRD ABSC-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,45,0)
<ICD9 ID="013.53">TB SP CRD ABSC-MICRO DX</ICD9>
"KRN",8989.5,14113,2,46,0)
<ICD9 ID="013.54">TB SP CRD ABSC-CULT DX</ICD9>
"KRN",8989.5,14113,2,47,0)
<ICD9 ID="013.55">TB SP CRD ABSC-HISTO DX</ICD9>
"KRN",8989.5,14113,2,48,0)
<ICD9 ID="013.56">TB SP CRD ABSC-OTH TEST</ICD9>
"KRN",8989.5,14113,2,49,0)
<ICD9 ID="013.60">TB ENCEPHALITIS-UNSPEC</ICD9>
"KRN",8989.5,14113,2,50,0)
<ICD9 ID="013.61">TB ENCEPHALITIS-NO EXAM</ICD9>
"KRN",8989.5,14113,2,51,0)
<ICD9 ID="013.62">TB ENCEPHALIT-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,52,0)
<ICD9 ID="013.63">TB ENCEPHALITIS-MICRO DX</ICD9>
"KRN",8989.5,14113,2,53,0)
<ICD9 ID="013.64">TB ENCEPHALITIS-CULT DX</ICD9>
"KRN",8989.5,14113,2,54,0)
<ICD9 ID="013.65">TB ENCEPHALITIS-HISTO DX</ICD9>
"KRN",8989.5,14113,2,55,0)
<ICD9 ID="013.66">TB ENCEPHALITIS-OTH TEST</ICD9>
"KRN",8989.5,14113,2,56,0)
<ICD9 ID="013.80">CNS TB NEC-UNSPEC</ICD9>
"KRN",8989.5,14113,2,57,0)
<ICD9 ID="013.81">CNS TB NEC-NO EXAM</ICD9>
"KRN",8989.5,14113,2,58,0)
<ICD9 ID="013.82">CNS TB NEC-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,59,0)
<ICD9 ID="013.83">CNS TB NEC-MICRO DX</ICD9>
"KRN",8989.5,14113,2,60,0)
<ICD9 ID="013.84">CNS TB NEC-CULT DX</ICD9>
"KRN",8989.5,14113,2,61,0)
<ICD9 ID="013.85">CNS TB NEC-HISTO DX</ICD9>
"KRN",8989.5,14113,2,62,0)
<ICD9 ID="013.86">CNS TB NEC-OTH TEST</ICD9>
"KRN",8989.5,14113,2,63,0)
<ICD9 ID="013.90">CNS TB NOS-UNSPEC</ICD9>
"KRN",8989.5,14113,2,64,0)
<ICD9 ID="013.91">CNS TB NOS-NO EXAM</ICD9>
"KRN",8989.5,14113,2,65,0)
<ICD9 ID="013.92">CNS TB NOS-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,66,0)
<ICD9 ID="013.93">CNS TB NOS-MICRO DX</ICD9>
"KRN",8989.5,14113,2,67,0)
<ICD9 ID="013.94">CNS TB NOS-CULT DX</ICD9>
"KRN",8989.5,14113,2,68,0)
<ICD9 ID="013.95">CNS TB NOS-HISTO DX</ICD9>
"KRN",8989.5,14113,2,69,0)
<ICD9 ID="013.96">CNS TB NOS-OTH TEST</ICD9>
"KRN",8989.5,14113,2,70,0)
<ICD9 ID="014.00">TB PERITONITIS-UNSPEC</ICD9>
"KRN",8989.5,14113,2,71,0)
<ICD9 ID="014.01">TB PERITONITIS-NO EXAM</ICD9>
"KRN",8989.5,14113,2,72,0)
<ICD9 ID="014.02">TB PERITONITIS-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,73,0)
<ICD9 ID="014.03">TB PERITONITIS-MICRO DX</ICD9>
"KRN",8989.5,14113,2,74,0)
<ICD9 ID="014.04">TB PERITONITIS-CULT DX</ICD9>
"KRN",8989.5,14113,2,75,0)
<ICD9 ID="014.05">TB PERITONITIS-HISTO DX</ICD9>
"KRN",8989.5,14113,2,76,0)
<ICD9 ID="014.06">TB PERITONITIS-OTH TEST</ICD9>
"KRN",8989.5,14113,2,77,0)
<ICD9 ID="014.80">INTESTINAL TB NEC-UNSPEC</ICD9>
"KRN",8989.5,14113,2,78,0)
<ICD9 ID="014.81">INTESTIN TB NEC-NO EXAM</ICD9>
"KRN",8989.5,14113,2,79,0)
<ICD9 ID="014.82">INTEST TB NEC-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,80,0)
<ICD9 ID="014.83">INTESTIN TB NEC-MICRO DX</ICD9>
"KRN",8989.5,14113,2,81,0)
<ICD9 ID="014.84">INTESTIN TB NEC-CULT DX</ICD9>
"KRN",8989.5,14113,2,82,0)
<ICD9 ID="014.85">INTESTIN TB NEC-HISTO DX</ICD9>
"KRN",8989.5,14113,2,83,0)
<ICD9 ID="014.86">INTESTIN TB NEC-OTH TEST</ICD9>
"KRN",8989.5,14113,2,84,0)
<ICD9 ID="015.00">TB OF VERTEBRA-UNSPEC</ICD9>
"KRN",8989.5,14113,2,85,0)
<ICD9 ID="015.01">TB OF VERTEBRA-NO EXAM</ICD9>
"KRN",8989.5,14113,2,86,0)
<ICD9 ID="015.02">TB OF VERTEBRA-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,87,0)
<ICD9 ID="015.03">TB OF VERTEBRA-MICRO DX</ICD9>
"KRN",8989.5,14113,2,88,0)
<ICD9 ID="015.04">TB OF VERTEBRA-CULT DX</ICD9>
"KRN",8989.5,14113,2,89,0)
<ICD9 ID="015.05">TB OF VERTEBRA-HISTO DX</ICD9>
"KRN",8989.5,14113,2,90,0)
<ICD9 ID="015.06">TB OF VERTEBRA-OTH TEST</ICD9>
"KRN",8989.5,14113,2,91,0)
<ICD9 ID="015.10">TB OF HIP-UNSPEC</ICD9>
"KRN",8989.5,14113,2,92,0)
<ICD9 ID="015.11">TB OF HIP-NO EXAM</ICD9>
"KRN",8989.5,14113,2,93,0)
<ICD9 ID="015.12">TB OF HIP-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,94,0)
<ICD9 ID="015.13">TB OF HIP-MICRO DX</ICD9>
"KRN",8989.5,14113,2,95,0)
<ICD9 ID="015.14">TB OF HIP-CULT DX</ICD9>
"KRN",8989.5,14113,2,96,0)
<ICD9 ID="015.15">TB OF HIP-HISTO DX</ICD9>
"KRN",8989.5,14113,2,97,0)
<ICD9 ID="015.16">TB OF HIP-OTH TEST</ICD9>
"KRN",8989.5,14113,2,98,0)
<ICD9 ID="015.20">TB OF KNEE-UNSPEC</ICD9>
"KRN",8989.5,14113,2,99,0)
<ICD9 ID="015.21">TB OF KNEE-NO EXAM</ICD9>
"KRN",8989.5,14113,2,100,0)
<ICD9 ID="015.22">TB OF KNEE-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,101,0)
<ICD9 ID="015.23">TB OF KNEE-MICRO DX</ICD9>
"KRN",8989.5,14113,2,102,0)
<ICD9 ID="015.24">TB OF KNEE-CULT DX</ICD9>
"KRN",8989.5,14113,2,103,0)
<ICD9 ID="015.25">TB OF KNEE-HISTO DX</ICD9>
"KRN",8989.5,14113,2,104,0)
<ICD9 ID="015.26">TB OF KNEE-OTH TEST</ICD9>
"KRN",8989.5,14113,2,105,0)
<ICD9 ID="015.50">TB OF LIMB BONES-UNSPEC</ICD9>
"KRN",8989.5,14113,2,106,0)
<ICD9 ID="015.51">TB LIMB BONES-NO EXAM</ICD9>
"KRN",8989.5,14113,2,107,0)
<ICD9 ID="015.52">TB LIMB BONES-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,108,0)
<ICD9 ID="015.53">TB LIMB BONES-MICRO DX</ICD9>
"KRN",8989.5,14113,2,109,0)
<ICD9 ID="015.54">TB LIMB BONES-CULT DX</ICD9>
"KRN",8989.5,14113,2,110,0)
<ICD9 ID="015.55">TB LIMB BONES-HISTO DX</ICD9>
"KRN",8989.5,14113,2,111,0)
<ICD9 ID="015.56">TB LIMB BONES-OTH TEST</ICD9>
"KRN",8989.5,14113,2,112,0)
<ICD9 ID="015.60">TB OF MASTOID-UNSPEC</ICD9>
"KRN",8989.5,14113,2,113,0)
<ICD9 ID="015.61">TB OF MASTOID-NO EXAM</ICD9>
"KRN",8989.5,14113,2,114,0)
<ICD9 ID="015.62">TB OF MASTOID-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,115,0)
<ICD9 ID="015.63">TB OF MASTOID-MICRO DX</ICD9>
"KRN",8989.5,14113,2,116,0)
<ICD9 ID="015.64">TB OF MASTOID-CULT DX</ICD9>
"KRN",8989.5,14113,2,117,0)
<ICD9 ID="015.65">TB OF MASTOID-HISTO DX</ICD9>
"KRN",8989.5,14113,2,118,0)
<ICD9 ID="015.66">TB OF MASTOID-OTH TEST</ICD9>
"KRN",8989.5,14113,2,119,0)
<ICD9 ID="015.70">TB OF BONE NEC-UNSPEC</ICD9>
"KRN",8989.5,14113,2,120,0)
<ICD9 ID="015.71">TB OF BONE NEC-NO EXAM</ICD9>
"KRN",8989.5,14113,2,121,0)
<ICD9 ID="015.72">TB OF BONE NEC-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,122,0)
<ICD9 ID="015.73">TB OF BONE NEC-MICRO DX</ICD9>
"KRN",8989.5,14113,2,123,0)
<ICD9 ID="015.74">TB OF BONE NEC-CULT DX</ICD9>
"KRN",8989.5,14113,2,124,0)
<ICD9 ID="015.75">TB OF BONE NEC-HISTO DX</ICD9>
"KRN",8989.5,14113,2,125,0)
<ICD9 ID="015.76">TB OF BONE NEC-OTH TEST</ICD9>
"KRN",8989.5,14113,2,126,0)
<ICD9 ID="015.80">TB OF JOINT NEC-UNSPEC</ICD9>
"KRN",8989.5,14113,2,127,0)
<ICD9 ID="015.81">TB OF JOINT NEC-NO EXAM</ICD9>
"KRN",8989.5,14113,2,128,0)
<ICD9 ID="015.82">TB JOINT NEC-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,129,0)
<ICD9 ID="015.83">TB OF JOINT NEC-MICRO DX</ICD9>
"KRN",8989.5,14113,2,130,0)
<ICD9 ID="015.84">TB OF JOINT NEC-CULT DX</ICD9>
"KRN",8989.5,14113,2,131,0)
<ICD9 ID="015.85">TB OF JOINT NEC-HISTO DX</ICD9>
"KRN",8989.5,14113,2,132,0)
<ICD9 ID="015.86">TB OF JOINT NEC-OTH TEST</ICD9>
"KRN",8989.5,14113,2,133,0)
<ICD9 ID="015.90">TB BONE/JOINT NOS-UNSPEC</ICD9>
"KRN",8989.5,14113,2,134,0)
<ICD9 ID="015.91">TB BONE/JT NOS-NO EXAM</ICD9>
"KRN",8989.5,14113,2,135,0)
<ICD9 ID="015.92">TB BONE/JT NOS-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,136,0)
<ICD9 ID="015.93">TB BONE/JT NOS-MICRO DX</ICD9>
"KRN",8989.5,14113,2,137,0)
<ICD9 ID="015.94">TB BONE/JT NOS-CULT DX</ICD9>
"KRN",8989.5,14113,2,138,0)
<ICD9 ID="015.95">TB BONE/JT NOS-HISTO DX</ICD9>
"KRN",8989.5,14113,2,139,0)
<ICD9 ID="015.96">TB BONE/JT NOS-OTH TEST</ICD9>
"KRN",8989.5,14113,2,140,0)
<ICD9 ID="016.00">TB OF KIDNEY-UNSPEC</ICD9>
"KRN",8989.5,14113,2,141,0)
<ICD9 ID="016.01">TB OF KIDNEY-NO EXAM</ICD9>
"KRN",8989.5,14113,2,142,0)
<ICD9 ID="016.02">TB OF KIDNEY-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,143,0)
<ICD9 ID="016.03">TB OF KIDNEY-MICRO DX</ICD9>
"KRN",8989.5,14113,2,144,0)
<ICD9 ID="016.04">TB OF KIDNEY-CULT DX</ICD9>
"KRN",8989.5,14113,2,145,0)
<ICD9 ID="016.05">TB OF KIDNEY-HISTO DX</ICD9>
"KRN",8989.5,14113,2,146,0)
<ICD9 ID="016.06">TB OF KIDNEY-OTH TEST</ICD9>
"KRN",8989.5,14113,2,147,0)
<ICD9 ID="016.10">TB OF BLADDER-UNSPEC</ICD9>
"KRN",8989.5,14113,2,148,0)
<ICD9 ID="016.11">TB OF BLADDER-NO EXAM</ICD9>
"KRN",8989.5,14113,2,149,0)
<ICD9 ID="016.12">TB OF BLADDER-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,150,0)
<ICD9 ID="016.13">TB OF BLADDER-MICRO DX</ICD9>
"KRN",8989.5,14113,2,151,0)
<ICD9 ID="016.14">TB OF BLADDER-CULT DX</ICD9>
"KRN",8989.5,14113,2,152,0)
<ICD9 ID="016.15">TB OF BLADDER-HISTO DX</ICD9>
"KRN",8989.5,14113,2,153,0)
<ICD9 ID="016.16">TB OF BLADDER-OTH TEST</ICD9>
"KRN",8989.5,14113,2,154,0)
<ICD9 ID="016.20">TB OF URETER-UNSPEC</ICD9>
"KRN",8989.5,14113,2,155,0)
<ICD9 ID="016.21">TB OF URETER-NO EXAM</ICD9>
"KRN",8989.5,14113,2,156,0)
<ICD9 ID="016.22">TB OF URETER-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,157,0)
<ICD9 ID="016.23">TB OF URETER-MICRO DX</ICD9>
"KRN",8989.5,14113,2,158,0)
<ICD9 ID="016.24">TB OF URETER-CULT DX</ICD9>
"KRN",8989.5,14113,2,159,0)
<ICD9 ID="016.25">TB OF URETER-HISTO DX</ICD9>
"KRN",8989.5,14113,2,160,0)
<ICD9 ID="016.26">TB OF URETER-OTH TEST</ICD9>
"KRN",8989.5,14113,2,161,0)
<ICD9 ID="016.30">TB URINARY NEC-UNSPEC</ICD9>
"KRN",8989.5,14113,2,162,0)
<ICD9 ID="016.31">TB URINARY NEC-NO EXAM</ICD9>
"KRN",8989.5,14113,2,163,0)
<ICD9 ID="016.32">TB URINARY NEC-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,164,0)
<ICD9 ID="016.33">TB URINARY NEC-MICRO DX</ICD9>
"KRN",8989.5,14113,2,165,0)
<ICD9 ID="016.34">TB URINARY NEC-CULT DX</ICD9>
"KRN",8989.5,14113,2,166,0)
<ICD9 ID="016.35">TB URINARY NEC-HISTO DX</ICD9>
"KRN",8989.5,14113,2,167,0)
<ICD9 ID="016.36">TB URINARY NEC-OTH TEST</ICD9>
"KRN",8989.5,14113,2,168,0)
<ICD9 ID="016.40">TB EPIDIDYMIS-UNSPEC</ICD9>
"KRN",8989.5,14113,2,169,0)
<ICD9 ID="016.41">TB EPIDIDYMIS-NO EXAM</ICD9>
"KRN",8989.5,14113,2,170,0)
<ICD9 ID="016.42">TB EPIDIDYMIS-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,171,0)
<ICD9 ID="016.43">TB EPIDIDYMIS-MICRO DX</ICD9>
"KRN",8989.5,14113,2,172,0)
<ICD9 ID="016.44">TB EPIDIDYMIS-CULT DX</ICD9>
"KRN",8989.5,14113,2,173,0)
<ICD9 ID="016.45">TB EPIDIDYMIS-HISTO DX</ICD9>
"KRN",8989.5,14113,2,174,0)
<ICD9 ID="016.46">TB EPIDIDYMIS-OTH TEST</ICD9>
"KRN",8989.5,14113,2,175,0)
<ICD9 ID="016.50">TB MALE GENIT NEC-UNSPEC</ICD9>
"KRN",8989.5,14113,2,176,0)
<ICD9 ID="016.51">TB MALE GEN NEC-NO EXAM</ICD9>
"KRN",8989.5,14113,2,177,0)
<ICD9 ID="016.52">TB MALE GEN NEC-EX UNKN</ICD9>
"KRN",8989.5,14113,2,178,0)
<ICD9 ID="016.53">TB MALE GEN NEC-MICRO DX</ICD9>
"KRN",8989.5,14113,2,179,0)
<ICD9 ID="016.54">TB MALE GEN NEC-CULT DX</ICD9>
"KRN",8989.5,14113,2,180,0)
<ICD9 ID="016.55">TB MALE GEN NEC-HISTO DX</ICD9>
"KRN",8989.5,14113,2,181,0)
<ICD9 ID="016.56">TB MALE GEN NEC-OTH TEST</ICD9>
"KRN",8989.5,14113,2,182,0)
<ICD9 ID="016.60">TB OVARY TUBE-UNSPEC</ICD9>
"KRN",8989.5,14113,2,183,0)
<ICD9 ID="016.61">TB OVARY TUBE-NO EXAM</ICD9>
"KRN",8989.5,14113,2,184,0)
<ICD9 ID="016.62">TB OVARY/TUBE-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,185,0)
<ICD9 ID="016.63">TB OVARY TUBE-MICRO DX</ICD9>
"KRN",8989.5,14113,2,186,0)
<ICD9 ID="016.64">TB OVARY TUBE-CULT DX</ICD9>
"KRN",8989.5,14113,2,187,0)
<ICD9 ID="016.65">TB OVARY TUBE-HISTO DX</ICD9>
"KRN",8989.5,14113,2,188,0)
<ICD9 ID="016.66">TB OVARY TUBE-OTH TEST</ICD9>
"KRN",8989.5,14113,2,189,0)
<ICD9 ID="016.70">TB FEMALE GEN NEC-UNSPEC</ICD9>
"KRN",8989.5,14113,2,190,0)
<ICD9 ID="016.71">TB FEM GEN NEC-NO EXAM</ICD9>
"KRN",8989.5,14113,2,191,0)
<ICD9 ID="016.72">TB FEM GEN NEC-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,192,0)
<ICD9 ID="016.73">TB FEM GEN NEC-MICRO DX</ICD9>
"KRN",8989.5,14113,2,193,0)
<ICD9 ID="016.74">TB FEM GEN NEC-CULT DX</ICD9>
"KRN",8989.5,14113,2,194,0)
<ICD9 ID="016.75">TB FEM GEN NEC-HISTO DX</ICD9>
"KRN",8989.5,14113,2,195,0)
<ICD9 ID="016.76">TB FEM GEN NEC-OTH TEST</ICD9>
"KRN",8989.5,14113,2,196,0)
<ICD9 ID="016.90">GU TB NOS-UNSPEC</ICD9>
"KRN",8989.5,14113,2,197,0)
<ICD9 ID="016.91">GU TB NOS-NO EXAM</ICD9>
"KRN",8989.5,14113,2,198,0)
<ICD9 ID="016.92">GU TB NOS-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,199,0)
<ICD9 ID="016.93">GU TB NOS-MICRO DX</ICD9>
"KRN",8989.5,14113,2,200,0)
<ICD9 ID="016.94">GU TB NOS-CULT DX</ICD9>
"KRN",8989.5,14113,2,201,0)
<ICD9 ID="016.95">GU TB NOS-HISTO DX</ICD9>
"KRN",8989.5,14113,2,202,0)
<ICD9 ID="016.96">GU TB NOS-OTH TEST</ICD9>
"KRN",8989.5,14113,2,203,0)
<ICD9 ID="017.00">TB SKIN/SUBCUTAN-UNSPEC</ICD9>
"KRN",8989.5,14113,2,204,0)
<ICD9 ID="017.01">TB SKIN/SUBCUT-NO EXAM</ICD9>
"KRN",8989.5,14113,2,205,0)
<ICD9 ID="017.02">TB SKIN/SUBCUT-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,206,0)
<ICD9 ID="017.03">TB SKIN/SUBCUT-MICRO DX</ICD9>
"KRN",8989.5,14113,2,207,0)
<ICD9 ID="017.04">TB SKIN/SUBCUT-CULT DX</ICD9>
"KRN",8989.5,14113,2,208,0)
<ICD9 ID="017.05">TB SKIN/SUBCUT-HISTO DX</ICD9>
"KRN",8989.5,14113,2,209,0)
<ICD9 ID="017.06">TB SKIN/SUBCUT-OTH TEST</ICD9>
"KRN",8989.5,14113,2,210,0)
<ICD9 ID="017.10">ERYTHEMA NODOS TB-UNSPEC</ICD9>
"KRN",8989.5,14113,2,211,0)
<ICD9 ID="017.11">ERYTHEM NODOS TB-NO EXAM</ICD9>
"KRN",8989.5,14113,2,212,0)
<ICD9 ID="017.12">ERYTHEM NOD TB-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,213,0)
<ICD9 ID="017.13">ERYTHEM NOD TB-MICRO DX</ICD9>
"KRN",8989.5,14113,2,214,0)
<ICD9 ID="017.14">ERYTHEM NODOS TB-CULT DX</ICD9>
"KRN",8989.5,14113,2,215,0)
<ICD9 ID="017.15">ERYTHEM NOD TB-HISTO DX</ICD9>
"KRN",8989.5,14113,2,216,0)
<ICD9 ID="017.16">ERYTHEM NOD TB-OTH TEST</ICD9>
"KRN",8989.5,14113,2,217,0)
<ICD9 ID="017.20">TB PERIPH LYMPH-UNSPEC</ICD9>
"KRN",8989.5,14113,2,218,0)
<ICD9 ID="017.21">TB PERIPH LYMPH-NO EXAM</ICD9>
"KRN",8989.5,14113,2,219,0)
<ICD9 ID="017.22">TB PERIPH LYMPH-EXAM UNK</ICD9>
"KRN",8989.5,14113,2,220,0)
<ICD9 ID="017.23">TB PERIPH LYMPH-MICRO DX</ICD9>
"KRN",8989.5,14113,2,221,0)
<ICD9 ID="017.24">TB PERIPH LYMPH-CULT DX</ICD9>
"KRN",8989.5,14113,2,222,0)
<ICD9 ID="017.25">TB PERIPH LYMPH-HISTO DX</ICD9>
"KRN",8989.5,14113,2,223,0)
<ICD9 ID="017.26">TB PERIPH LYMPH-OTH TEST</ICD9>
"KRN",8989.5,14113,2,224,0)
<ICD9 ID="017.30">TB OF EYE-UNSPEC</ICD9>
"KRN",8989.5,14113,2,225,0)
<ICD9 ID="017.31">TB OF EYE-NO EXAM</ICD9>
"KRN",8989.5,14113,2,226,0)
<ICD9 ID="017.32">TB OF EYE-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,227,0)
<ICD9 ID="017.33">TB OF EYE-MICRO DX</ICD9>
"KRN",8989.5,14113,2,228,0)
<ICD9 ID="017.34">TB OF EYE-CULT DX</ICD9>
"KRN",8989.5,14113,2,229,0)
<ICD9 ID="017.35">TB OF EYE-HISTO DX</ICD9>
"KRN",8989.5,14113,2,230,0)
<ICD9 ID="017.36">TB OF EYE-OTH TEST</ICD9>
"KRN",8989.5,14113,2,231,0)
<ICD9 ID="017.40">TB OF EAR-UNSPEC</ICD9>
"KRN",8989.5,14113,2,232,0)
<ICD9 ID="017.41">TB OF EAR-NO EXAM</ICD9>
"KRN",8989.5,14113,2,233,0)
<ICD9 ID="017.42">TB OF EAR-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,234,0)
<ICD9 ID="017.43">TB OF EAR-MICRO DX</ICD9>
"KRN",8989.5,14113,2,235,0)
<ICD9 ID="017.44">TB OF EAR-CULT DX</ICD9>
"KRN",8989.5,14113,2,236,0)
<ICD9 ID="017.45">TB OF EAR-HISTO DX</ICD9>
"KRN",8989.5,14113,2,237,0)
<ICD9 ID="017.46">TB OF EAR-OTH TEST</ICD9>
"KRN",8989.5,14113,2,238,0)
<ICD9 ID="017.50">TB OF THYROID-UNSPEC</ICD9>
"KRN",8989.5,14113,2,239,0)
<ICD9 ID="017.51">TB OF THYROID-NO EXAM</ICD9>
"KRN",8989.5,14113,2,240,0)
<ICD9 ID="017.52">TB OF THYROID-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,241,0)
<ICD9 ID="017.53">TB OF THYROID-MICRO DX</ICD9>
"KRN",8989.5,14113,2,242,0)
<ICD9 ID="017.54">TB OF THYROID-CULT DX</ICD9>
"KRN",8989.5,14113,2,243,0)
<ICD9 ID="017.55">TB OF THYROID-HISTO DX</ICD9>
"KRN",8989.5,14113,2,244,0)
<ICD9 ID="017.56">TB OF THYROID-OTH TEST</ICD9>
"KRN",8989.5,14113,2,245,0)
<ICD9 ID="017.60">TB OF ADRENAL-UNSPEC</ICD9>
"KRN",8989.5,14113,2,246,0)
<ICD9 ID="017.61">TB OF ADRENAL-NO EXAM</ICD9>
"KRN",8989.5,14113,2,247,0)
<ICD9 ID="017.62">TB OF ADRENAL-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,248,0)
<ICD9 ID="017.63">TB OF ADRENAL-MICRO DX</ICD9>
"KRN",8989.5,14113,2,249,0)
<ICD9 ID="017.64">TB OF ADRENAL-CULT DX</ICD9>
"KRN",8989.5,14113,2,250,0)
<ICD9 ID="017.65">TB OF ADRENAL-HISTO DX</ICD9>
"KRN",8989.5,14113,2,251,0)
<ICD9 ID="017.66">TB OF ADRENAL-OTH TEST</ICD9>
"KRN",8989.5,14113,2,252,0)
<ICD9 ID="017.70">TB OF SPLEEN-UNSPEC</ICD9>
"KRN",8989.5,14113,2,253,0)
<ICD9 ID="017.71">TB OF SPLEEN-NO EXAM</ICD9>
"KRN",8989.5,14113,2,254,0)
<ICD9 ID="017.72">TB OF SPLEEN-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,255,0)
<ICD9 ID="017.73">TB OF SPLEEN-MICRO DX</ICD9>
"KRN",8989.5,14113,2,256,0)
<ICD9 ID="017.74">TB OF SPLEEN-CULT DX</ICD9>
"KRN",8989.5,14113,2,257,0)
<ICD9 ID="017.75">TB OF SPLEEN-HISTO DX</ICD9>
"KRN",8989.5,14113,2,258,0)
<ICD9 ID="017.76">TB OF SPLEEN-OTH TEST</ICD9>
"KRN",8989.5,14113,2,259,0)
<ICD9 ID="017.80">TB ESOPHAGUS-UNSPEC</ICD9>
"KRN",8989.5,14113,2,260,0)
<ICD9 ID="017.81">TB ESOPHAGUS-NO EXAM</ICD9>
"KRN",8989.5,14113,2,261,0)
<ICD9 ID="017.82">TB ESOPHAGUS-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,262,0)
<ICD9 ID="017.83">TB ESOPHAGUS-MICRO DX</ICD9>
"KRN",8989.5,14113,2,263,0)
<ICD9 ID="017.84">TB ESOPHAGUS-CULT DX</ICD9>
"KRN",8989.5,14113,2,264,0)
<ICD9 ID="017.85">TB ESOPHAGUS-HISTO DX</ICD9>
"KRN",8989.5,14113,2,265,0)
<ICD9 ID="017.86">TB ESOPHAGUS-OTH TEST</ICD9>
"KRN",8989.5,14113,2,266,0)
<ICD9 ID="017.90">TB OF ORGAN NEC-UNSPEC</ICD9>
"KRN",8989.5,14113,2,267,0)
<ICD9 ID="017.91">TB OF ORGAN NEC-NO EXAM</ICD9>
"KRN",8989.5,14113,2,268,0)
<ICD9 ID="017.92">TB ORGAN NEC-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,269,0)
<ICD9 ID="017.93">TB OF ORGAN NEC-MICRO DX</ICD9>
"KRN",8989.5,14113,2,270,0)
<ICD9 ID="017.94">TB OF ORGAN NEC-CULT DX</ICD9>
"KRN",8989.5,14113,2,271,0)
<ICD9 ID="017.95">TB OF ORGAN NEC-HISTO DX</ICD9>
"KRN",8989.5,14113,2,272,0)
<ICD9 ID="017.96">TB OF ORGAN NEC-OTH TEST</ICD9>
"KRN",8989.5,14113,2,273,0)
<ICD9 ID="018.00">ACUTE MILIARY TB-UNSPEC</ICD9>
"KRN",8989.5,14113,2,274,0)
<ICD9 ID="018.01">ACUTE MILIARY TB-NO EXAM</ICD9>
"KRN",8989.5,14113,2,275,0)
<ICD9 ID="018.02">AC MILIARY TB-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,276,0)
<ICD9 ID="018.03">AC MILIARY TB-MICRO DX</ICD9>
"KRN",8989.5,14113,2,277,0)
<ICD9 ID="018.04">ACUTE MILIARY TB-CULT DX</ICD9>
"KRN",8989.5,14113,2,278,0)
<ICD9 ID="018.05">AC MILIARY TB-HISTO DX</ICD9>
"KRN",8989.5,14113,2,279,0)
<ICD9 ID="018.06">AC MILIARY TB-OTH TEST</ICD9>
"KRN",8989.5,14113,2,280,0)
<ICD9 ID="018.80">MILIARY TB NEC-UNSPEC</ICD9>
"KRN",8989.5,14113,2,281,0)
<ICD9 ID="018.81">MILIARY TB NEC-NO EXAM</ICD9>
"KRN",8989.5,14113,2,282,0)
<ICD9 ID="018.82">MILIARY TB NEC-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,283,0)
<ICD9 ID="018.83">MILIARY TB NEC-MICRO DX</ICD9>
"KRN",8989.5,14113,2,284,0)
<ICD9 ID="018.84">MILIARY TB NEC-CULT DX</ICD9>
"KRN",8989.5,14113,2,285,0)
<ICD9 ID="018.85">MILIARY TB NEC-HISTO DX</ICD9>
"KRN",8989.5,14113,2,286,0)
<ICD9 ID="018.86">MILIARY TB NEC-OTH TEST</ICD9>
"KRN",8989.5,14113,2,287,0)
<ICD9 ID="018.90">MILIARY TB NOS-UNSPEC</ICD9>
"KRN",8989.5,14113,2,288,0)
<ICD9 ID="018.91">MILIARY TB NOS-NO EXAM</ICD9>
"KRN",8989.5,14113,2,289,0)
<ICD9 ID="018.92">MILIARY TB NOS-EXAM UNKN</ICD9>
"KRN",8989.5,14113,2,290,0)
<ICD9 ID="018.93">MILIARY TB NOS-MICRO DX</ICD9>
"KRN",8989.5,14113,2,291,0)
<ICD9 ID="018.94">MILIARY TB NOS-CULT DX</ICD9>
"KRN",8989.5,14113,2,292,0)
<ICD9 ID="018.95">MILIARY TB NOS-HISTO DX</ICD9>
"KRN",8989.5,14113,2,293,0)
<ICD9 ID="018.96">MILIARY TB NOS-OTH TEST</ICD9>
"KRN",8989.5,14113,2,294,0)
<ICD9 ID="031.0">PULMONARY MYCOBACTERIA</ICD9>
"KRN",8989.5,14113,2,295,0)
<ICD9 ID="031.1">CUTANEOUS MYCOBACTERIA</ICD9>
"KRN",8989.5,14113,2,296,0)
<ICD9 ID="031.2">DMAC, DISEASE DUE TO</ICD9>
"KRN",8989.5,14113,2,297,0)
<ICD9 ID="031.8">MYCOBACTERIAL DIS NEC</ICD9>
"KRN",8989.5,14113,2,298,0)
<ICD9 ID="031.9">MYCOBACTERIAL DIS NOS</ICD9>
"KRN",8989.5,14113,2,299,0)
<ICD9 ID="046.3">PROG MULTIFOC LEUKOENCEP</ICD9>
"KRN",8989.5,14113,2,300,0)
<ICD9 ID="046.8">CNS SLOW VIRUS INFEC NEC</ICD9>
"KRN",8989.5,14113,2,301,0)
<ICD9 ID="054.71">VISCERAL HERPES SIMPLEX</ICD9>
"KRN",8989.5,14113,2,302,0)
<ICD9 ID="078.5">CYTOMEGALOVIRAL DISEASE</ICD9>
"KRN",8989.5,14113,2,303,0)
<ICD9 ID="083.8">RICKETTSIOSES NEC</ICD9>
"KRN",8989.5,14113,2,304,0)
<ICD9 ID="112.4">CANDIDIASIS OF LUNG</ICD9>
"KRN",8989.5,14113,2,305,0)
<ICD9 ID="112.84">CANDIDAL ESOPHAGITIS</ICD9>
"KRN",8989.5,14113,2,306,0)
<ICD9 ID="114.1">PRIM CUTAN COCCIDIOID</ICD9>
"KRN",8989.5,14113,2,307,0)
<ICD9 ID="114.2">COCCIDIOIDAL MENINGITIS</ICD9>
"KRN",8989.5,14113,2,308,0)
<ICD9 ID="114.3">PROGRESS COCCIDIOID NEC</ICD9>
"KRN",8989.5,14113,2,309,0)
<ICD9 ID="115.01">HISTOPLASM CAPSUL MENING</ICD9>
"KRN",8989.5,14113,2,310,0)
<ICD9 ID="115.02">HISTOPLASM CAPSUL RETINA</ICD9>
"KRN",8989.5,14113,2,311,0)
<ICD9 ID="115.03">HISTOPLASM CAPS PERICARD</ICD9>
"KRN",8989.5,14113,2,312,0)
<ICD9 ID="115.04">HISTOPLASM CAPS ENDOCARD</ICD9>
"KRN",8989.5,14113,2,313,0)
<ICD9 ID="115.09">HISTOPLASMA CAPSULAT NEC</ICD9>
"KRN",8989.5,14113,2,314,0)
<ICD9 ID="115.11">HISTOPLASM DUBOIS MENING</ICD9>
"KRN",8989.5,14113,2,315,0)
<ICD9 ID="115.12">HISTOPLASM DUBOIS RETINA</ICD9>
"KRN",8989.5,14113,2,316,0)
<ICD9 ID="115.13">HISTOPLASM DUB PERICARD</ICD9>
"KRN",8989.5,14113,2,317,0)
<ICD9 ID="115.14">HISTOPLASM DUB ENDOCARD</ICD9>
"KRN",8989.5,14113,2,318,0)
<ICD9 ID="115.19">HISTOPLASMA DUBOISII NEC</ICD9>
"KRN",8989.5,14113,2,319,0)
<ICD9 ID="115.91">HISTOPLASMOSIS MENINGIT</ICD9>
"KRN",8989.5,14113,2,320,0)
<ICD9 ID="115.92">HISTOPLASMOSIS RETINITIS</ICD9>
"KRN",8989.5,14113,2,321,0)
<ICD9 ID="115.93">HISTOPLASMOSIS PERICARD</ICD9>
"KRN",8989.5,14113,2,322,0)
<ICD9 ID="115.94">HISTOPLASMOSIS ENDOCARD</ICD9>
"KRN",8989.5,14113,2,323,0)
<ICD9 ID="115.99">HISTOPLASMOSIS NEC</ICD9>
"KRN",8989.5,14113,2,324,0)
<ICD9 ID="117.5">CRYPTOCOCCOSIS</ICD9>
"KRN",8989.5,14113,2,325,0)
<ICD9 ID="130.0">TOXOPLASM MENINGOENCEPH</ICD9>
"KRN",8989.5,14113,2,326,0)
<ICD9 ID="136.3">PNEUMOCYSTOSIS</ICD9>
"KRN",8989.5,14113,2,327,0)
<ICD9 ID="136.8">INFECT/PARASITE DIS NEC</ICD9>
"KRN",8989.5,14113,2,328,0)
<ICD9 ID="176.0">KAPOSI'S SARCOMA, SKIN</ICD9>
"KRN",8989.5,14113,2,329,0)
<ICD9 ID="176.1">KAPOSI'S SARCOMA, SOFT TISSUE</ICD9>
"KRN",8989.5,14113,2,330,0)
<ICD9 ID="176.2">KAPOSI'S SARCOMA, PALATE</ICD9>
"KRN",8989.5,14113,2,331,0)
<ICD9 ID="176.3">KAPOSI'S SARCOMA, GI SITES</ICD9>
"KRN",8989.5,14113,2,332,0)
<ICD9 ID="176.4">KAPOSI'S SARCOMA, LUNG</ICD9>
"KRN",8989.5,14113,2,333,0)
<ICD9 ID="176.5">KAPOSI'S SARCOMA, LYMPH NODES</ICD9>
"KRN",8989.5,14113,2,334,0)
<ICD9 ID="176.8">KAPOSI'S SARCOMA, OTHER SITES</ICD9>
"KRN",8989.5,14113,2,335,0)
<ICD9 ID="176.9">KAPOSI'S SARCOMA, NOS</ICD9>
"KRN",8989.5,14113,2,336,0)
<ICD9 ID="180.0">MALIG NEO ENDOCERVIX</ICD9>
"KRN",8989.5,14113,2,337,0)
<ICD9 ID="180.1">MALIG NEO EXOCERVIX</ICD9>
"KRN",8989.5,14113,2,338,0)
<ICD9 ID="180.8">MALIG NEO CERVIX NEC</ICD9>
"KRN",8989.5,14113,2,339,0)
<ICD9 ID="180.9">MAL NEO CERVIX UTERI NOS</ICD9>
"KRN",8989.5,14113,2,340,0)
<ICD9 ID="200.20">BURKITT'S TUMOR UNSPEC</ICD9>
"KRN",8989.5,14113,2,341,0)
<ICD9 ID="200.21">BURKITT'S TUMOR HEAD</ICD9>
"KRN",8989.5,14113,2,342,0)
<ICD9 ID="200.22">BURKITT'S TUMOR THORAX</ICD9>
"KRN",8989.5,14113,2,343,0)
<ICD9 ID="200.23">BURKITT'S TUMOR ABDOM</ICD9>
"KRN",8989.5,14113,2,344,0)
<ICD9 ID="200.24">BURKITT'S TUMOR AXILLA</ICD9>
"KRN",8989.5,14113,2,345,0)
<ICD9 ID="200.25">BURKITT'S TUMOR INGUIN</ICD9>
"KRN",8989.5,14113,2,346,0)
<ICD9 ID="200.26">BURKITT'S TUMOR PELVIC</ICD9>
"KRN",8989.5,14113,2,347,0)
<ICD9 ID="200.27">BURKITT'S TUMOR SPLEEN</ICD9>
"KRN",8989.5,14113,2,348,0)
<ICD9 ID="200.28">BURKITT'S TUMOR MULT</ICD9>
"KRN",8989.5,14113,2,349,0)
<ICD9 ID="202.80">LYMPHOMA NEC UNSPEC SITE</ICD9>
"KRN",8989.5,14113,2,350,0)
<ICD9 ID="202.81">LYMPHOMAS NEC HEAD</ICD9>
"KRN",8989.5,14113,2,351,0)
<ICD9 ID="202.82">LYMPHOMAS NEC THORAX</ICD9>
"KRN",8989.5,14113,2,352,0)
<ICD9 ID="202.83">LYMPHOMAS NEC ABDOM</ICD9>
"KRN",8989.5,14113,2,353,0)
<ICD9 ID="202.84">LYMPHOMAS NEC AXILLA</ICD9>
"KRN",8989.5,14113,2,354,0)
<ICD9 ID="202.85">LYMPHOMAS NEC INGUIN</ICD9>
"KRN",8989.5,14113,2,355,0)
<ICD9 ID="202.86">LYMPHOMAS NEC PELVIC</ICD9>
"KRN",8989.5,14113,2,356,0)
<ICD9 ID="202.87">LYMPHOMAS NEC SPLEEN</ICD9>
"KRN",8989.5,14113,2,357,0)
<ICD9 ID="202.88">LYMPHOMAS NEC MULT</ICD9>
"KRN",8989.5,14113,2,358,0)
<ICD9 ID="484.1">PNEUM W CYTOMEG INCL DIS</ICD9>
"KRN",8989.5,14113,2,359,0)
</ICD9LST>
"KRN",8989.5,14113,2,360,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14113,2,361,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14113,2,362,0)
</PARAMS>
"KRN",8989.5,14115,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::Cirrhosis
"KRN",8989.5,14115,1)
CCR Predefined Report Template
"KRN",8989.5,14115,2,0)
^^9^9^3051121^
"KRN",8989.5,14115,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14115,2,2,0)
<PARAMS>
"KRN",8989.5,14115,2,3,0)
<ICD9LST>
"KRN",8989.5,14115,2,4,0)
<ICD9 ID="571.2">ALCOHOL CIRRHOSIS LIVER</ICD9>
"KRN",8989.5,14115,2,5,0)
<ICD9 ID="571.5">CIRRHOSIS OF LIVER NOS</ICD9>
"KRN",8989.5,14115,2,6,0)
</ICD9LST>
"KRN",8989.5,14115,2,7,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14115,2,8,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14115,2,9,0)
</PARAMS>
"KRN",8989.5,14116,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::ESLD
"KRN",8989.5,14116,1)
CCR Predefined Report Template
"KRN",8989.5,14116,2,0)
^^16^16^3051121^
"KRN",8989.5,14116,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14116,2,2,0)
<PARAMS>
"KRN",8989.5,14116,2,3,0)
<ICD9LST>
"KRN",8989.5,14116,2,4,0)
<ICD9 ID="456.0">ESOPHAG VARICES W BLEED</ICD9>
"KRN",8989.5,14116,2,5,0)
<ICD9 ID="456.1">ESOPH VARICES W/O BLEED</ICD9>
"KRN",8989.5,14116,2,6,0)
<ICD9 ID="456.20">BLEED ESOPH VAR OTH DIS</ICD9>
"KRN",8989.5,14116,2,7,0)
<ICD9 ID="456.21">ESOPH VARICE OTH DIS NOS</ICD9>
"KRN",8989.5,14116,2,8,0)
<ICD9 ID="456.8">VARICES OF OTHER SITES</ICD9>
"KRN",8989.5,14116,2,9,0)
<ICD9 ID="572.2">HEPATIC COMA</ICD9>
"KRN",8989.5,14116,2,10,0)
<ICD9 ID="572.3">PORTAL HYPERTENSION</ICD9>
"KRN",8989.5,14116,2,11,0)
<ICD9 ID="572.4">HEPATORENAL SYNDROME</ICD9>
"KRN",8989.5,14116,2,12,0)
<ICD9 ID="572.8">OTH SEQUELA, CHR LIV DIS</ICD9>
"KRN",8989.5,14116,2,13,0)
</ICD9LST>
"KRN",8989.5,14116,2,14,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14116,2,15,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14116,2,16,0)
</PARAMS>
"KRN",8989.5,14117,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::Hepatitis B
"KRN",8989.5,14117,1)
CCR Predefined Report Template
"KRN",8989.5,14117,2,0)
^^18^18^3051121^
"KRN",8989.5,14117,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14117,2,2,0)
<PARAMS>
"KRN",8989.5,14117,2,3,0)
<ICD9LST>
"KRN",8989.5,14117,2,4,0)
<ICD9 ID="070.2">HEPATITIS B WITH COMA</ICD9>
"KRN",8989.5,14117,2,5,0)
<ICD9 ID="070.20">VIR HEP B W/COMA, W/O DELTA</ICD9>
"KRN",8989.5,14117,2,6,0)
<ICD9 ID="070.21">VIRAL HEPATITIS B W COMA/DELTA</ICD9>
"KRN",8989.5,14117,2,7,0)
<ICD9 ID="070.22">CH HEP B W/ H. COMA W/O DELTA</ICD9>
"KRN",8989.5,14117,2,8,0)
<ICD9 ID="070.23">CH HEP B W/ H. COMA W/ DELTA</ICD9>
"KRN",8989.5,14117,2,9,0)
<ICD9 ID="070.3">HEPATITIS B W/O COMA</ICD9>
"KRN",8989.5,14117,2,10,0)
<ICD9 ID="070.30">VIR HEP B W/O COMA, W/O DELTA</ICD9>
"KRN",8989.5,14117,2,11,0)
<ICD9 ID="070.31">VIR HEP B W/O COMA, W/DELTA</ICD9>
"KRN",8989.5,14117,2,12,0)
<ICD9 ID="070.32">CH HEP B W/O H. COMA W/O DELTA</ICD9>
"KRN",8989.5,14117,2,13,0)
<ICD9 ID="070.33">CH HEP B W/O H. COMA W/ DELTA</ICD9>
"KRN",8989.5,14117,2,14,0)
<ICD9 ID="V02.61">HEPATITIS B CARRIER</ICD9>
"KRN",8989.5,14117,2,15,0)
</ICD9LST>
"KRN",8989.5,14117,2,16,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14117,2,17,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14117,2,18,0)
</PARAMS>
"KRN",8989.5,14118,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::Hepatitis C
"KRN",8989.5,14118,1)
CCR Predefined Report Template
"KRN",8989.5,14118,2,0)
^^12^12^3051121^
"KRN",8989.5,14118,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14118,2,2,0)
<PARAMS>
"KRN",8989.5,14118,2,3,0)
<ICD9LST>
"KRN",8989.5,14118,2,4,0)
<ICD9 ID="070.44">CH HEP C W/ COMA</ICD9>
"KRN",8989.5,14118,2,5,0)
<ICD9 ID="070.54">CH HEP C W/O COMA</ICD9>
"KRN",8989.5,14118,2,6,0)
<ICD9 ID="070.70">HPT C W/O HEPAT COMA NOS</ICD9>
"KRN",8989.5,14118,2,7,0)
<ICD9 ID="070.71">HPT C W HEPATIC COMA NOS</ICD9>
"KRN",8989.5,14118,2,8,0)
<ICD9 ID="V02.62">HEPATITIS C CARRIER</ICD9>
"KRN",8989.5,14118,2,9,0)
</ICD9LST>
"KRN",8989.5,14118,2,10,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14118,2,11,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14118,2,12,0)
</PARAMS>
"KRN",8989.5,14119,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::Tobacco Use
"KRN",8989.5,14119,1)
CCR Predefined Report Template
"KRN",8989.5,14119,2,0)
^^10^10^3051121^
"KRN",8989.5,14119,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14119,2,2,0)
<PARAMS>
"KRN",8989.5,14119,2,3,0)
<ICD9LST>
"KRN",8989.5,14119,2,4,0)
<ICD9 ID="305.1">TOBACCO USE DISORDER</ICD9>
"KRN",8989.5,14119,2,5,0)
<ICD9 ID="989.84">TOXIC EFFECT OF TOBACCO</ICD9>
"KRN",8989.5,14119,2,6,0)
<ICD9 ID="V15.82">HX-TOBACCO USE</ICD9>
"KRN",8989.5,14119,2,7,0)
</ICD9LST>
"KRN",8989.5,14119,2,8,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14119,2,9,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14119,2,10,0)
</PARAMS>
"KRN",8989.5,14120,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::Hypertension
"KRN",8989.5,14120,1)
CCR Predefined Report Template
"KRN",8989.5,14120,2,0)
^^44^44^3051121^
"KRN",8989.5,14120,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14120,2,2,0)
<PARAMS>
"KRN",8989.5,14120,2,3,0)
<ICD9LST>
"KRN",8989.5,14120,2,4,0)
<ICD9 ID="401.0">MALIGNANT HYPERTENSION</ICD9>
"KRN",8989.5,14120,2,5,0)
<ICD9 ID="401.1">BENIGN HYPERTENSION</ICD9>
"KRN",8989.5,14120,2,6,0)
<ICD9 ID="401.9">HYPERTENSION NOS</ICD9>
"KRN",8989.5,14120,2,7,0)
<ICD9 ID="402.00">HYP HEART DIS MALIGN W/O FAIL</ICD9>
"KRN",8989.5,14120,2,8,0)
<ICD9 ID="402.01">HYP HEART DIS MALIGN WITH FAIL</ICD9>
"KRN",8989.5,14120,2,9,0)
<ICD9 ID="402.10">HYP HEART DIS BENING W/0 FAIL</ICD9>
"KRN",8989.5,14120,2,10,0)
<ICD9 ID="402.11">HYP HEART DIS BENING WITH FAIL</ICD9>
"KRN",8989.5,14120,2,11,0)
<ICD9 ID="402.90">HYP HEART DIS UNSPECI W/O FAIL</ICD9>
"KRN",8989.5,14120,2,12,0)
<ICD9 ID="402.91">HYP HEART DIS UNSP WITH FAIL</ICD9>
"KRN",8989.5,14120,2,13,0)
<ICD9 ID="403.0">MAL HYPERTENS RENAL DIS</ICD9>
"KRN",8989.5,14120,2,14,0)
<ICD9 ID="403.00">MAL HYP REN W/O REN FAIL</ICD9>
"KRN",8989.5,14120,2,15,0)
<ICD9 ID="403.01">MAL HYP REN W RENAL FAIL</ICD9>
"KRN",8989.5,14120,2,16,0)
<ICD9 ID="403.1">BENIGN HYPERT RENAL DIS</ICD9>
"KRN",8989.5,14120,2,17,0)
<ICD9 ID="403.10">BEN HYP REN W/O REN FAIL</ICD9>
"KRN",8989.5,14120,2,18,0)
<ICD9 ID="403.11">BEN HYP RENAL W REN FAIL</ICD9>
"KRN",8989.5,14120,2,19,0)
<ICD9 ID="403.9">HYPERTENS RENAL DIS NOS</ICD9>
"KRN",8989.5,14120,2,20,0)
<ICD9 ID="403.90">HYP REN NOS W/O REN FAIL</ICD9>
"KRN",8989.5,14120,2,21,0)
<ICD9 ID="403.91">HYP REN NOS W REN FAIL</ICD9>
"KRN",8989.5,14120,2,22,0)
<ICD9 ID="404.0">MAL HYPERT HRT/RENAL DIS</ICD9>
"KRN",8989.5,14120,2,23,0)
<ICD9 ID="404.00">HYP HRT &amp; REN DIS MALIG W/O ME</ICD9>
"KRN",8989.5,14120,2,24,0)
<ICD9 ID="404.01">HYP HRT &amp; REN DIS MAL W/ HEART</ICD9>
"KRN",8989.5,14120,2,25,0)
<ICD9 ID="404.02">MAL HY HT/REN W REN FAIL</ICD9>
"KRN",8989.5,14120,2,26,0)
<ICD9 ID="404.03">HYP HRT &amp; REN MAL W/HRT &amp; RENL</ICD9>
"KRN",8989.5,14120,2,27,0)
<ICD9 ID="404.1">BEN HYPERT HRT/RENAL DIS</ICD9>
"KRN",8989.5,14120,2,28,0)
<ICD9 ID="404.10">HYP HRT &amp; REN DIS BENIGN W/O</ICD9>
"KRN",8989.5,14120,2,29,0)
<ICD9 ID="404.11">HYP HRT &amp; REN BENIGN W/ HEART</ICD9>
"KRN",8989.5,14120,2,30,0)
<ICD9 ID="404.12">BEN HY HT/REN W REN FAIL</ICD9>
"KRN",8989.5,14120,2,31,0)
<ICD9 ID="404.13">HYP HRT &amp; REN BEN W/HRT &amp; REN</ICD9>
"KRN",8989.5,14120,2,32,0)
<ICD9 ID="404.9">HYPERT HRT/RENAL DIS NOS</ICD9>
"KRN",8989.5,14120,2,33,0)
<ICD9 ID="404.90">HYP HRT &amp; REN DIS UNSPECIFIED</ICD9>
"KRN",8989.5,14120,2,34,0)
<ICD9 ID="404.91">HYP HRT &amp; REN UNSP W/HEART</ICD9>
"KRN",8989.5,14120,2,35,0)
<ICD9 ID="404.92">HY HT/REN NOS W REN FAIL</ICD9>
"KRN",8989.5,14120,2,36,0)
<ICD9 ID="404.93">HYP HRT &amp; REN UNS W/HRT &amp; REN</ICD9>
"KRN",8989.5,14120,2,37,0)
<ICD9 ID="405.01">MAL RENOVASC HYPERTENS</ICD9>
"KRN",8989.5,14120,2,38,0)
<ICD9 ID="405.09">MAL SECOND HYPERTEN NEC</ICD9>
"KRN",8989.5,14120,2,39,0)
<ICD9 ID="405.91">RENOVASC HYPERTENSION</ICD9>
"KRN",8989.5,14120,2,40,0)
<ICD9 ID="405.99">SECOND HYPERTENSION NEC</ICD9>
"KRN",8989.5,14120,2,41,0)
</ICD9LST>
"KRN",8989.5,14120,2,42,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14120,2,43,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14120,2,44,0)
</PARAMS>
"KRN",8989.5,14121,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::Diabetes Type I or II
"KRN",8989.5,14121,1)
CCR Predefined Report Template
"KRN",8989.5,14121,2,0)
^^47^47^3051121^
"KRN",8989.5,14121,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14121,2,2,0)
<PARAMS>
"KRN",8989.5,14121,2,3,0)
<ICD9LST>
"KRN",8989.5,14121,2,4,0)
<ICD9 ID="250.00">DMII WO CMP NT ST UNCNTR</ICD9>
"KRN",8989.5,14121,2,5,0)
<ICD9 ID="250.01">DMI WO CMP NT ST UNCNTRL</ICD9>
"KRN",8989.5,14121,2,6,0)
<ICD9 ID="250.02">DMII WO CMP UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,7,0)
<ICD9 ID="250.03">DMI WO CMP UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,8,0)
<ICD9 ID="250.10">DMII KETO NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,9,0)
<ICD9 ID="250.11">DMI KETO NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,10,0)
<ICD9 ID="250.12">DMII KETOACD UNCONTROLD</ICD9>
"KRN",8989.5,14121,2,11,0)
<ICD9 ID="250.13">DMI KETOACD UNCONTROLD</ICD9>
"KRN",8989.5,14121,2,12,0)
<ICD9 ID="250.20">DMII HPRSM NT ST UNCNTRL</ICD9>
"KRN",8989.5,14121,2,13,0)
<ICD9 ID="250.21">DMI HPRSM NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,14,0)
<ICD9 ID="250.22">DMII HPROSMLR UNCONTROLD</ICD9>
"KRN",8989.5,14121,2,15,0)
<ICD9 ID="250.23">DMI HPROSMLR UNCONTROLD</ICD9>
"KRN",8989.5,14121,2,16,0)
<ICD9 ID="250.30">DMII O CM NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,17,0)
<ICD9 ID="250.31">DMI O CM NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,18,0)
<ICD9 ID="250.32">DMII OTH COMA UNCONTROLD</ICD9>
"KRN",8989.5,14121,2,19,0)
<ICD9 ID="250.33">DMI OTH COMA UNCONTROLD</ICD9>
"KRN",8989.5,14121,2,20,0)
<ICD9 ID="250.40">DMII RENL NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,21,0)
<ICD9 ID="250.41">DMI RENL NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,22,0)
<ICD9 ID="250.42">DMII RENAL UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,23,0)
<ICD9 ID="250.43">DMI RENAL UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,24,0)
<ICD9 ID="250.50">DMII OPHTH NT ST UNCNTRL</ICD9>
"KRN",8989.5,14121,2,25,0)
<ICD9 ID="250.51">DMI OPHTH NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,26,0)
<ICD9 ID="250.52">DMII OPHTH UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,27,0)
<ICD9 ID="250.53">DMI OPHTH UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,28,0)
<ICD9 ID="250.60">DMII NEURO NT ST UNCNTRL</ICD9>
"KRN",8989.5,14121,2,29,0)
<ICD9 ID="250.61">DMI NEURO NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,30,0)
<ICD9 ID="250.62">DMII NEURO UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,31,0)
<ICD9 ID="250.63">DMI NEURO UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,32,0)
<ICD9 ID="250.70">DMII CIRC NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,33,0)
<ICD9 ID="250.71">DMI CIRC NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,34,0)
<ICD9 ID="250.72">DMII CIRC UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,35,0)
<ICD9 ID="250.73">DMI CIRC UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,36,0)
<ICD9 ID="250.80">DMII OTH NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,37,0)
<ICD9 ID="250.81">DMI OTH NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,38,0)
<ICD9 ID="250.82">DMII OTH UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,39,0)
<ICD9 ID="250.83">DMI OTH UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,40,0)
<ICD9 ID="250.90">DMII UNSPF NT ST UNCNTRL</ICD9>
"KRN",8989.5,14121,2,41,0)
<ICD9 ID="250.91">DMI UNSPF NT ST UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,42,0)
<ICD9 ID="250.92">DMII UNSPF UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,43,0)
<ICD9 ID="250.93">DMI UNSPF UNCNTRLD</ICD9>
"KRN",8989.5,14121,2,44,0)
</ICD9LST>
"KRN",8989.5,14121,2,45,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14121,2,46,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14121,2,47,0)
</PARAMS>
"KRN",8989.5,14122,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::Depression
"KRN",8989.5,14122,1)
CCR Predefined Report Template
"KRN",8989.5,14122,2,0)
^^33^33^3051121^
"KRN",8989.5,14122,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14122,2,2,0)
<PARAMS>
"KRN",8989.5,14122,2,3,0)
<ICD9LST>
"KRN",8989.5,14122,2,4,0)
<ICD9 ID="293.83">MOOD DISORDER OTHER DIS</ICD9>
"KRN",8989.5,14122,2,5,0)
<ICD9 ID="296.20">DEPRESS DISORDER-UNSPEC</ICD9>
"KRN",8989.5,14122,2,6,0)
<ICD9 ID="296.21">DEPRESS DISORDER-MILD</ICD9>
"KRN",8989.5,14122,2,7,0)
<ICD9 ID="296.22">DEPRESSIVE DISORDER-MOD</ICD9>
"KRN",8989.5,14122,2,8,0)
<ICD9 ID="296.23">DEPRESS DISORDER-SEV W/O PSYCH</ICD9>
"KRN",8989.5,14122,2,9,0)
<ICD9 ID="296.24">DEPR DISORDER-SEV W PSYCH</ICD9>
"KRN",8989.5,14122,2,10,0)
<ICD9 ID="296.25">DEPR DISORDER-PART REMISS</ICD9>
"KRN",8989.5,14122,2,11,0)
<ICD9 ID="296.26">DEPR DISORDER-FULL REMISS</ICD9>
"KRN",8989.5,14122,2,12,0)
<ICD9 ID="296.30">RECURR DEPR DISORDER-UNSP</ICD9>
"KRN",8989.5,14122,2,13,0)
<ICD9 ID="296.31">RECURR DEPR DISORDER-MILD</ICD9>
"KRN",8989.5,14122,2,14,0)
<ICD9 ID="296.32">RECURR DEPR DISORDER-MOD</ICD9>
"KRN",8989.5,14122,2,15,0)
<ICD9 ID="296.33">RECUR DEPR DISORDER-SEVERE</ICD9>
"KRN",8989.5,14122,2,16,0)
<ICD9 ID="296.34">REC DEPR DISORDER-PSYCHOTIC</ICD9>
"KRN",8989.5,14122,2,17,0)
<ICD9 ID="296.35">RECUR DEPR DISORDER-PART REM</ICD9>
"KRN",8989.5,14122,2,18,0)
<ICD9 ID="296.36">RECUR DEPR DISORDER-FULL REM</ICD9>
"KRN",8989.5,14122,2,19,0)
<ICD9 ID="296.50">BIPOL I CUR DEPRES NOS</ICD9>
"KRN",8989.5,14122,2,20,0)
<ICD9 ID="296.51">BIPOL I CUR DEPRESS-MILD</ICD9>
"KRN",8989.5,14122,2,21,0)
<ICD9 ID="296.52">BIPOL I CUR DEPRESS-MOD</ICD9>
"KRN",8989.5,14122,2,22,0)
<ICD9 ID="296.53">BIPOL I CURR DEP W/O PSY</ICD9>
"KRN",8989.5,14122,2,23,0)
<ICD9 ID="296.54">BIPOL I CURRNT DEP W PSY</ICD9>
"KRN",8989.5,14122,2,24,0)
<ICD9 ID="296.55">BIPOL I CUR DEP REM NOS</ICD9>
"KRN",8989.5,14122,2,25,0)
<ICD9 ID="296.56">BIPOL I CURRNT DEP REMIS</ICD9>
"KRN",8989.5,14122,2,26,0)
<ICD9 ID="309.0">ADJUSTMNT DIS W DEPRESSN</ICD9>
"KRN",8989.5,14122,2,27,0)
<ICD9 ID="309.1">PROLONG DEPRESSIVE REACT</ICD9>
"KRN",8989.5,14122,2,28,0)
<ICD9 ID="309.28">ADJUST DIS W ANXIETY/DEP</ICD9>
"KRN",8989.5,14122,2,29,0)
<ICD9 ID="311.">DEPRESSIVE DISORDER NEC</ICD9>
"KRN",8989.5,14122,2,30,0)
</ICD9LST>
"KRN",8989.5,14122,2,31,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14122,2,32,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14122,2,33,0)
</PARAMS>
"KRN",8989.5,14123,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::Acute or Chronic Renal Failure
"KRN",8989.5,14123,1)
CCR Predefined Report Template
"KRN",8989.5,14123,2,0)
^^13^13^3051121^
"KRN",8989.5,14123,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14123,2,2,0)
<PARAMS>
"KRN",8989.5,14123,2,3,0)
<ICD9LST>
"KRN",8989.5,14123,2,4,0)
<ICD9 ID="584.5">LOWER NEPHRON NEPHROSIS</ICD9>
"KRN",8989.5,14123,2,5,0)
<ICD9 ID="584.6">AC RENAL FAIL, CORT NECR</ICD9>
"KRN",8989.5,14123,2,6,0)
<ICD9 ID="584.7">AC REN FAIL, MEDULL NECR</ICD9>
"KRN",8989.5,14123,2,7,0)
<ICD9 ID="584.8">AC RENAL FAILURE NEC</ICD9>
"KRN",8989.5,14123,2,8,0)
<ICD9 ID="584.9">ACUTE RENAL FAILURE NOS</ICD9>
"KRN",8989.5,14123,2,9,0)
<ICD9 ID="585.">CHRONIC RENAL FAILURE</ICD9>
"KRN",8989.5,14123,2,10,0)
</ICD9LST>
"KRN",8989.5,14123,2,11,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14123,2,12,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14123,2,13,0)
</PARAMS>
"KRN",8989.5,14124,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::Ischemic Heart Disease
"KRN",8989.5,14124,1)
CCR Predefined Report Template
"KRN",8989.5,14124,2,0)
^^71^71^3051121^
"KRN",8989.5,14124,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14124,2,2,0)
<PARAMS>
"KRN",8989.5,14124,2,3,0)
<ICD9LST>
"KRN",8989.5,14124,2,4,0)
<ICD9 ID="410.0">AMI ANTEROLATERAL WALL</ICD9>
"KRN",8989.5,14124,2,5,0)
<ICD9 ID="410.00">AMI ANTEROLATERAL, UNSPEC</ICD9>
"KRN",8989.5,14124,2,6,0)
<ICD9 ID="410.01">AMI ANTEROLATERAL, INIT</ICD9>
"KRN",8989.5,14124,2,7,0)
<ICD9 ID="410.02">AMI ANTEROLATERAL, SUBSEQ</ICD9>
"KRN",8989.5,14124,2,8,0)
<ICD9 ID="410.1">AMI ANTERIOR WALL NEC</ICD9>
"KRN",8989.5,14124,2,9,0)
<ICD9 ID="410.10">AMI ANTERIOR WALL, UNSPEC</ICD9>
"KRN",8989.5,14124,2,10,0)
<ICD9 ID="410.11">AMI ANTERIOR WALL, INIT</ICD9>
"KRN",8989.5,14124,2,11,0)
<ICD9 ID="410.12">AMI ANTERIOR WALL, SUBSEQ</ICD9>
"KRN",8989.5,14124,2,12,0)
<ICD9 ID="410.2">AMI INFEROLATERAL WALL</ICD9>
"KRN",8989.5,14124,2,13,0)
<ICD9 ID="410.20">AMI INFEROLATERAL, UNSPEC</ICD9>
"KRN",8989.5,14124,2,14,0)
<ICD9 ID="410.21">AMI INFEROLATERAL, INIT</ICD9>
"KRN",8989.5,14124,2,15,0)
<ICD9 ID="410.22">AMI INFEROLATERAL, SUBSEQ</ICD9>
"KRN",8989.5,14124,2,16,0)
<ICD9 ID="410.3">AMI INFEROPOSTERIOR WALL</ICD9>
"KRN",8989.5,14124,2,17,0)
<ICD9 ID="410.30">AMI INFEROPOST, UNSPEC</ICD9>
"KRN",8989.5,14124,2,18,0)
<ICD9 ID="410.31">AMI INFEROPOST, INITIAL</ICD9>
"KRN",8989.5,14124,2,19,0)
<ICD9 ID="410.32">AMI INFEROPOST, SUBSEQ</ICD9>
"KRN",8989.5,14124,2,20,0)
<ICD9 ID="410.4">AMI INFERIOR WALL NEC</ICD9>
"KRN",8989.5,14124,2,21,0)
<ICD9 ID="410.40">AMI INFERIOR WALL, UNSPEC</ICD9>
"KRN",8989.5,14124,2,22,0)
<ICD9 ID="410.41">AMI INFERIOR WALL, INIT</ICD9>
"KRN",8989.5,14124,2,23,0)
<ICD9 ID="410.42">AMI INFERIOR WALL, SUBSEQ</ICD9>
"KRN",8989.5,14124,2,24,0)
<ICD9 ID="410.5">AMI LATERAL WALL NEC</ICD9>
"KRN",8989.5,14124,2,25,0)
<ICD9 ID="410.50">AMI LATERAL NEC, UNSPEC</ICD9>
"KRN",8989.5,14124,2,26,0)
<ICD9 ID="410.51">AMI LATERAL NEC, INITIAL</ICD9>
"KRN",8989.5,14124,2,27,0)
<ICD9 ID="410.52">AMI LATERAL NEC, SUBSEQ</ICD9>
"KRN",8989.5,14124,2,28,0)
<ICD9 ID="410.6">TRUE POSTERIOR INFARCT</ICD9>
"KRN",8989.5,14124,2,29,0)
<ICD9 ID="410.60">TRUE POST INFARCT, UNSPEC</ICD9>
"KRN",8989.5,14124,2,30,0)
<ICD9 ID="410.61">TRUE POST INFARCT, INIT</ICD9>
"KRN",8989.5,14124,2,31,0)
<ICD9 ID="410.62">TRUE POST INFARCT, SUBSEQ</ICD9>
"KRN",8989.5,14124,2,32,0)
<ICD9 ID="410.7">SUBENDOCARDIAL INFARCT</ICD9>
"KRN",8989.5,14124,2,33,0)
<ICD9 ID="410.70">SUBENDO INFARCT, UNSPEC</ICD9>
"KRN",8989.5,14124,2,34,0)
<ICD9 ID="410.71">SUBENDO INFARCT, INITIAL</ICD9>
"KRN",8989.5,14124,2,35,0)
<ICD9 ID="410.72">SUBENDO INFARCT, SUBSEQ</ICD9>
"KRN",8989.5,14124,2,36,0)
<ICD9 ID="410.8">MYOCARDIAL INFARCT NEC</ICD9>
"KRN",8989.5,14124,2,37,0)
<ICD9 ID="410.80">AMI NEC, UNSPECIFIED</ICD9>
"KRN",8989.5,14124,2,38,0)
<ICD9 ID="410.81">AMI NEC, INITIAL</ICD9>
"KRN",8989.5,14124,2,39,0)
<ICD9 ID="410.82">AMI NEC, SUBSEQUENT</ICD9>
"KRN",8989.5,14124,2,40,0)
<ICD9 ID="410.9">MYOCARDIAL INFARCT NOS</ICD9>
"KRN",8989.5,14124,2,41,0)
<ICD9 ID="410.90">AMI NOS, UNSPECIFIED</ICD9>
"KRN",8989.5,14124,2,42,0)
<ICD9 ID="410.91">AMI NOS, INITIAL</ICD9>
"KRN",8989.5,14124,2,43,0)
<ICD9 ID="410.92">AMI NOS, SUBSEQUENT</ICD9>
"KRN",8989.5,14124,2,44,0)
<ICD9 ID="411.0">POST MI SYNDROME</ICD9>
"KRN",8989.5,14124,2,45,0)
<ICD9 ID="411.1">INTERMED CORONARY SYND</ICD9>
"KRN",8989.5,14124,2,46,0)
<ICD9 ID="411.8">AC ISCHEMIC HRT DIS NEC</ICD9>
"KRN",8989.5,14124,2,47,0)
<ICD9 ID="411.81">AC CORONAR OCCL W/O MYO INFARC</ICD9>
"KRN",8989.5,14124,2,48,0)
<ICD9 ID="411.89">AC ISCHEMIC HRT DIS NEC</ICD9>
"KRN",8989.5,14124,2,49,0)
<ICD9 ID="412.">OLD MYOCARDIAL INFARCT</ICD9>
"KRN",8989.5,14124,2,50,0)
<ICD9 ID="413.0">ANGINA DECUBITUS</ICD9>
"KRN",8989.5,14124,2,51,0)
<ICD9 ID="413.1">PRINZMETAL ANGINA</ICD9>
"KRN",8989.5,14124,2,52,0)
<ICD9 ID="413.9">ANGINA PECTORIS NEC/NOS</ICD9>
"KRN",8989.5,14124,2,53,0)
<ICD9 ID="414.0">CORONARY ATHEROSCLEROSIS</ICD9>
"KRN",8989.5,14124,2,54,0)
<ICD9 ID="414.00">COR ATHEROSCL UNSP TYP-VES</ICD9>
"KRN",8989.5,14124,2,55,0)
<ICD9 ID="414.01">COR ATHEROSCL NATV C VSL</ICD9>
"KRN",8989.5,14124,2,56,0)
<ICD9 ID="414.02">COR ATHEROSCL AUTOL V BYP</ICD9>
"KRN",8989.5,14124,2,57,0)
<ICD9 ID="414.03">COR ATHEROSCL NONAUTO BIO BYP</ICD9>
"KRN",8989.5,14124,2,58,0)
<ICD9 ID="414.04">CORONARY ATHER/ART BYP GRFT</ICD9>
"KRN",8989.5,14124,2,59,0)
<ICD9 ID="414.05">CORONARY ATHER/UNSP TYP BYP GR</ICD9>
"KRN",8989.5,14124,2,60,0)
<ICD9 ID="414.06">COR ATH NATV ART TP HRT</ICD9>
"KRN",8989.5,14124,2,61,0)
<ICD9 ID="414.07">COR ATH BPS GRAFT TP HRT</ICD9>
"KRN",8989.5,14124,2,62,0)
<ICD9 ID="414.10">ANEURYSM OF HEART</ICD9>
"KRN",8989.5,14124,2,63,0)
<ICD9 ID="414.11">ANEURYSM OF CORONARY VESSELS</ICD9>
"KRN",8989.5,14124,2,64,0)
<ICD9 ID="414.12">DISSECTION OF CORONARY ARTERY</ICD9>
"KRN",8989.5,14124,2,65,0)
<ICD9 ID="414.19">OTHER ANEURYSM OF HEART</ICD9>
"KRN",8989.5,14124,2,66,0)
<ICD9 ID="414.8">CHR ISCHEMIC HRT DIS NEC</ICD9>
"KRN",8989.5,14124,2,67,0)
<ICD9 ID="414.9">CHR ISCHEMIC HRT DIS NOS</ICD9>
"KRN",8989.5,14124,2,68,0)
</ICD9LST>
"KRN",8989.5,14124,2,69,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14124,2,70,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14124,2,71,0)
</PARAMS>
"KRN",8989.5,14125,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::Schizophrenia
"KRN",8989.5,14125,1)
CCR Predefined Report Template
"KRN",8989.5,14125,2,0)
^^67^67^3051121^
"KRN",8989.5,14125,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14125,2,2,0)
<PARAMS>
"KRN",8989.5,14125,2,3,0)
<ICD9LST>
"KRN",8989.5,14125,2,4,0)
<ICD9 ID="295.00">SIMPL SCHIZOPHREN-UNSPEC</ICD9>
"KRN",8989.5,14125,2,5,0)
<ICD9 ID="295.01">SIMPL SCHIZOPHREN-SUBCHR</ICD9>
"KRN",8989.5,14125,2,6,0)
<ICD9 ID="295.02">SIMPLE SCHIZOPHREN-CHR</ICD9>
"KRN",8989.5,14125,2,7,0)
<ICD9 ID="295.03">SIMP SCHIZ-SUBCHR/EXACER</ICD9>
"KRN",8989.5,14125,2,8,0)
<ICD9 ID="295.04">SIMPL SCHIZO-CHR/EXACERB</ICD9>
"KRN",8989.5,14125,2,9,0)
<ICD9 ID="295.05">SIMPL SCHIZOPHREN-REMISS</ICD9>
"KRN",8989.5,14125,2,10,0)
<ICD9 ID="295.10">DISORGANIZED SCHIZO-UNSP</ICD9>
"KRN",8989.5,14125,2,11,0)
<ICD9 ID="295.11">DISORGANIZED SCHIZO-SUBCHRONIC</ICD9>
"KRN",8989.5,14125,2,12,0)
<ICD9 ID="295.12">DISORGANIZED SCHIZO-CHRONIC</ICD9>
"KRN",8989.5,14125,2,13,0)
<ICD9 ID="295.13">DISORG SCHIZO-SUBCHR/EXACERB</ICD9>
"KRN",8989.5,14125,2,14,0)
<ICD9 ID="295.14">DISORG SCHIZO-CHR/EXACERB</ICD9>
"KRN",8989.5,14125,2,15,0)
<ICD9 ID="295.15">DISORGANIZED SCHIZO-REMISS</ICD9>
"KRN",8989.5,14125,2,16,0)
<ICD9 ID="295.20">CATATONIC-UNSPEC</ICD9>
"KRN",8989.5,14125,2,17,0)
<ICD9 ID="295.21">CATATONIC-SUBCHRONIC</ICD9>
"KRN",8989.5,14125,2,18,0)
<ICD9 ID="295.22">CATATONIC-CHRONIC</ICD9>
"KRN",8989.5,14125,2,19,0)
<ICD9 ID="295.23">CATATONIC-SUBCHR/EXACERB</ICD9>
"KRN",8989.5,14125,2,20,0)
<ICD9 ID="295.24">CATATONIC-CHR/EXACERB</ICD9>
"KRN",8989.5,14125,2,21,0)
<ICD9 ID="295.25">CATATONIC-REMISSION</ICD9>
"KRN",8989.5,14125,2,22,0)
<ICD9 ID="295.30">PARANOID SCHIZO-UNSPEC</ICD9>
"KRN",8989.5,14125,2,23,0)
<ICD9 ID="295.31">PARANOID SCHIZO-SUBCHR</ICD9>
"KRN",8989.5,14125,2,24,0)
<ICD9 ID="295.32">PARANOID SCHIZO-CHRONIC</ICD9>
"KRN",8989.5,14125,2,25,0)
<ICD9 ID="295.33">PARAN SCHIZO-SUBCHR/EXAC</ICD9>
"KRN",8989.5,14125,2,26,0)
<ICD9 ID="295.34">PARAN SCHIZO-CHR/EXACERB</ICD9>
"KRN",8989.5,14125,2,27,0)
<ICD9 ID="295.35">PARANOID SCHIZO-REMISS</ICD9>
"KRN",8989.5,14125,2,28,0)
<ICD9 ID="295.40">SCHIZOPHRENIFORM DIS NOS</ICD9>
"KRN",8989.5,14125,2,29,0)
<ICD9 ID="295.41">SCHIZOPHRENIC DIS-SUBCHR</ICD9>
"KRN",8989.5,14125,2,30,0)
<ICD9 ID="295.42">SCHIZOPHREN DIS-CHRONIC</ICD9>
"KRN",8989.5,14125,2,31,0)
<ICD9 ID="295.43">SCHIZO DIS-SUBCHR/EXACER</ICD9>
"KRN",8989.5,14125,2,32,0)
<ICD9 ID="295.44">SCHIZOPHR DIS-CHR/EXACER</ICD9>
"KRN",8989.5,14125,2,33,0)
<ICD9 ID="295.45">SCHIZOPHRENIC DIS-REMISS</ICD9>
"KRN",8989.5,14125,2,34,0)
<ICD9 ID="295.50">LATENT SCHIZOPHREN-UNSP</ICD9>
"KRN",8989.5,14125,2,35,0)
<ICD9 ID="295.51">LAT SCHIZOPHREN-SUBCHR</ICD9>
"KRN",8989.5,14125,2,36,0)
<ICD9 ID="295.52">LATENT SCHIZOPHREN-CHR</ICD9>
"KRN",8989.5,14125,2,37,0)
<ICD9 ID="295.53">LAT SCHIZO-SUBCHR/EXACER</ICD9>
"KRN",8989.5,14125,2,38,0)
<ICD9 ID="295.54">LATENT SCHIZO-CHR/EXACER</ICD9>
"KRN",8989.5,14125,2,39,0)
<ICD9 ID="295.55">LAT SCHIZOPHREN-REMISS</ICD9>
"KRN",8989.5,14125,2,40,0)
<ICD9 ID="295.60">SCHIZOPHR DIS RESID NOS</ICD9>
"KRN",8989.5,14125,2,41,0)
<ICD9 ID="295.61">SCHIZOPH DIS RESID-SUBCH</ICD9>
"KRN",8989.5,14125,2,42,0)
<ICD9 ID="295.62">SCHIZOPHR DIS RESID-CHR</ICD9>
"KRN",8989.5,14125,2,43,0)
<ICD9 ID="295.63">SCHIZO RESID SUBCHR/EXAC</ICD9>
"KRN",8989.5,14125,2,44,0)
<ICD9 ID="295.64">SCHIZOPH RESID-CHRO/EXAC</ICD9>
"KRN",8989.5,14125,2,45,0)
<ICD9 ID="295.65">SCHIZOPH DIS RESID-REMIS</ICD9>
"KRN",8989.5,14125,2,46,0)
<ICD9 ID="295.70">SCHIZOAFFECTIVE DIS NOS</ICD9>
"KRN",8989.5,14125,2,47,0)
<ICD9 ID="295.71">SCHIZOAFFECTV DIS-SUBCHR</ICD9>
"KRN",8989.5,14125,2,48,0)
<ICD9 ID="295.72">SCHIZOAFFECTIVE DIS-CHR</ICD9>
"KRN",8989.5,14125,2,49,0)
<ICD9 ID="295.73">SCHIZOAFF DIS-SUBCH/EXAC</ICD9>
"KRN",8989.5,14125,2,50,0)
<ICD9 ID="295.74">SCHIZOAFFTV DIS-CHR/EXAC</ICD9>
"KRN",8989.5,14125,2,51,0)
<ICD9 ID="295.75">SCHIZOAFFECTVE DIS-REMIS</ICD9>
"KRN",8989.5,14125,2,52,0)
<ICD9 ID="295.80">SCHIZOPHRENIA OTH-UNSPEC</ICD9>
"KRN",8989.5,14125,2,53,0)
<ICD9 ID="295.81">SCHIZOPHRENIA OTH-SUBCHR</ICD9>
"KRN",8989.5,14125,2,54,0)
<ICD9 ID="295.82">SCHIZOPHRENIA OTH-CHR</ICD9>
"KRN",8989.5,14125,2,55,0)
<ICD9 ID="295.83">SCHIZO OTH-SUBCHR/EXACER</ICD9>
"KRN",8989.5,14125,2,56,0)
<ICD9 ID="295.84">SCHIZO OTH-CHR/EXACERB</ICD9>
"KRN",8989.5,14125,2,57,0)
<ICD9 ID="295.85">SCHIZOPHRENIA OTH-REMISS</ICD9>
"KRN",8989.5,14125,2,58,0)
<ICD9 ID="295.90">SCHIZOPHRENIA NOS-UNSPEC</ICD9>
"KRN",8989.5,14125,2,59,0)
<ICD9 ID="295.91">SCHIZOPHRENIA NOS-SUBCHR</ICD9>
"KRN",8989.5,14125,2,60,0)
<ICD9 ID="295.92">SCHIZOPHRENIA NOS-CHR</ICD9>
"KRN",8989.5,14125,2,61,0)
<ICD9 ID="295.93">SCHIZO NOS-SUBCHR/EXACER</ICD9>
"KRN",8989.5,14125,2,62,0)
<ICD9 ID="295.94">SCHIZO NOS-CHR/EXACERB</ICD9>
"KRN",8989.5,14125,2,63,0)
<ICD9 ID="295.95">SCHIZOPHRENIA NOS-REMISS</ICD9>
"KRN",8989.5,14125,2,64,0)
</ICD9LST>
"KRN",8989.5,14125,2,65,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14125,2,66,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14125,2,67,0)
</PARAMS>
"KRN",8989.5,14126,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::Bipolar - Mania
"KRN",8989.5,14126,1)
CCR Predefined Report Template
"KRN",8989.5,14126,2,0)
^^47^47^3051121^
"KRN",8989.5,14126,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14126,2,2,0)
<PARAMS>
"KRN",8989.5,14126,2,3,0)
<ICD9LST>
"KRN",8989.5,14126,2,4,0)
<ICD9 ID="296.00">BIPOL I SINGLE MANIC NOS</ICD9>
"KRN",8989.5,14126,2,5,0)
<ICD9 ID="296.01">BIPOL I SINGLE MANC-MILD</ICD9>
"KRN",8989.5,14126,2,6,0)
<ICD9 ID="296.02">BIPOL I SINGLE MANIC-MOD</ICD9>
"KRN",8989.5,14126,2,7,0)
<ICD9 ID="296.03">BIPOL I SING-SEV W/O PSY</ICD9>
"KRN",8989.5,14126,2,8,0)
<ICD9 ID="296.04">BIPO I SIN MAN-SEV W PSY</ICD9>
"KRN",8989.5,14126,2,9,0)
<ICD9 ID="296.05">BIPOL I SING MAN REM NOS</ICD9>
"KRN",8989.5,14126,2,10,0)
<ICD9 ID="296.06">BIPOL I SINGLE MANIC REM</ICD9>
"KRN",8989.5,14126,2,11,0)
<ICD9 ID="296.10">RECUR MANIC DIS-UNSPEC</ICD9>
"KRN",8989.5,14126,2,12,0)
<ICD9 ID="296.11">RECUR MANIC DIS-MILD</ICD9>
"KRN",8989.5,14126,2,13,0)
<ICD9 ID="296.12">RECUR MANIC DIS-MOD</ICD9>
"KRN",8989.5,14126,2,14,0)
<ICD9 ID="296.13">RECUR MANIC DIS-SEVERE</ICD9>
"KRN",8989.5,14126,2,15,0)
<ICD9 ID="296.14">RECUR MANIC-SEV W PSYCHO</ICD9>
"KRN",8989.5,14126,2,16,0)
<ICD9 ID="296.15">RECUR MANIC-PART REMISS</ICD9>
"KRN",8989.5,14126,2,17,0)
<ICD9 ID="296.16">RECUR MANIC-FULL REMISS</ICD9>
"KRN",8989.5,14126,2,18,0)
<ICD9 ID="296.40">BIPOL I CURRNT MANIC NOS</ICD9>
"KRN",8989.5,14126,2,19,0)
<ICD9 ID="296.41">BIPOL I CURNT MANIC-MILD</ICD9>
"KRN",8989.5,14126,2,20,0)
<ICD9 ID="296.42">BIPOL I CURRNT MANIC-MOD</ICD9>
"KRN",8989.5,14126,2,21,0)
<ICD9 ID="296.43">BIPOL I MANC-SEV W/O PSY</ICD9>
"KRN",8989.5,14126,2,22,0)
<ICD9 ID="296.44">BIPOL I MANIC-SEV W PSY</ICD9>
"KRN",8989.5,14126,2,23,0)
<ICD9 ID="296.45">BIPOL I CUR MAN PART REM</ICD9>
"KRN",8989.5,14126,2,24,0)
<ICD9 ID="296.46">BIPOL I CUR MAN FULL REM</ICD9>
"KRN",8989.5,14126,2,25,0)
<ICD9 ID="296.50">BIPOL I CUR DEPRES NOS</ICD9>
"KRN",8989.5,14126,2,26,0)
<ICD9 ID="296.51">BIPOL I CUR DEPRESS-MILD</ICD9>
"KRN",8989.5,14126,2,27,0)
<ICD9 ID="296.52">BIPOL I CUR DEPRESS-MOD</ICD9>
"KRN",8989.5,14126,2,28,0)
<ICD9 ID="296.53">BIPOL I CURR DEP W/O PSY</ICD9>
"KRN",8989.5,14126,2,29,0)
<ICD9 ID="296.54">BIPOL I CURRNT DEP W PSY</ICD9>
"KRN",8989.5,14126,2,30,0)
<ICD9 ID="296.55">BIPOL I CUR DEP REM NOS</ICD9>
"KRN",8989.5,14126,2,31,0)
<ICD9 ID="296.56">BIPOL I CURRNT DEP REMIS</ICD9>
"KRN",8989.5,14126,2,32,0)
<ICD9 ID="296.60">BIPOL I CURRNT MIXED NOS</ICD9>
"KRN",8989.5,14126,2,33,0)
<ICD9 ID="296.61">BIPOL I CURRNT MIX-MILD</ICD9>
"KRN",8989.5,14126,2,34,0)
<ICD9 ID="296.62">BIPOL I CURRNT MIXED-MOD</ICD9>
"KRN",8989.5,14126,2,35,0)
<ICD9 ID="296.63">BIPOL I CUR MIX W/O PSY</ICD9>
"KRN",8989.5,14126,2,36,0)
<ICD9 ID="296.64">BIPOL I CUR MIXED W PSY</ICD9>
"KRN",8989.5,14126,2,37,0)
<ICD9 ID="296.65">BIPOL I CUR MIX-PART REM</ICD9>
"KRN",8989.5,14126,2,38,0)
<ICD9 ID="296.66">BIPOL I CUR MIXED REMISS</ICD9>
"KRN",8989.5,14126,2,39,0)
<ICD9 ID="296.7">BIPOLOR I CURRENT NOS</ICD9>
"KRN",8989.5,14126,2,40,0)
<ICD9 ID="296.80">BIPOLAR DISORDER NOS</ICD9>
"KRN",8989.5,14126,2,41,0)
<ICD9 ID="296.81">ATYPICAL MANIC DISORDER</ICD9>
"KRN",8989.5,14126,2,42,0)
<ICD9 ID="296.82">ATYPICAL DEPRESSIVE DIS</ICD9>
"KRN",8989.5,14126,2,43,0)
<ICD9 ID="296.89">BIPOLAR DISORDER NEC</ICD9>
"KRN",8989.5,14126,2,44,0)
</ICD9LST>
"KRN",8989.5,14126,2,45,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14126,2,46,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14126,2,47,0)
</PARAMS>
"KRN",8989.5,14127,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::Alcohol
"KRN",8989.5,14127,1)
CCR Predefined Report Template
"KRN",8989.5,14127,2,0)
^^38^38^3051121^
"KRN",8989.5,14127,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14127,2,2,0)
<PARAMS>
"KRN",8989.5,14127,2,3,0)
<ICD9LST>
"KRN",8989.5,14127,2,4,0)
<ICD9 ID="291.0">DELIRIUM TREMENS</ICD9>
"KRN",8989.5,14127,2,5,0)
<ICD9 ID="291.1">ALCOHOL AMNESTIC DISORDR</ICD9>
"KRN",8989.5,14127,2,6,0)
<ICD9 ID="291.2">ALCOHOL PERSIST DEMENTIA</ICD9>
"KRN",8989.5,14127,2,7,0)
<ICD9 ID="291.3">ALCOH PSY DIS W HALLUCIN</ICD9>
"KRN",8989.5,14127,2,8,0)
<ICD9 ID="291.4">PATHOLOGIC ALCOHOL INTOX</ICD9>
"KRN",8989.5,14127,2,9,0)
<ICD9 ID="291.5">ALCOH PSYCH DIS W DELUS</ICD9>
"KRN",8989.5,14127,2,10,0)
<ICD9 ID="291.8">ALCOHOLIC PSYCHOSIS NEC</ICD9>
"KRN",8989.5,14127,2,11,0)
<ICD9 ID="291.81">ALCOHOL WITHDRAWAL</ICD9>
"KRN",8989.5,14127,2,12,0)
<ICD9 ID="291.89">ALCOHOL MENTAL DISOR NEC</ICD9>
"KRN",8989.5,14127,2,13,0)
<ICD9 ID="291.9">ALCOHOL MENTAL DISOR NOS</ICD9>
"KRN",8989.5,14127,2,14,0)
<ICD9 ID="303.00">AC ALCOHOL INTOX-UNSPEC</ICD9>
"KRN",8989.5,14127,2,15,0)
<ICD9 ID="303.01">AC ALCOHOL INTOX-CONTIN</ICD9>
"KRN",8989.5,14127,2,16,0)
<ICD9 ID="303.02">AC ALCOHOL INTOX-EPISOD</ICD9>
"KRN",8989.5,14127,2,17,0)
<ICD9 ID="303.03">AC ALCOHOL INTOX-REMISS</ICD9>
"KRN",8989.5,14127,2,18,0)
<ICD9 ID="303.90">ALCOH DEP NEC/NOS-UNSPEC</ICD9>
"KRN",8989.5,14127,2,19,0)
<ICD9 ID="303.91">ALCOH DEP NEC/NOS-CONTIN</ICD9>
"KRN",8989.5,14127,2,20,0)
<ICD9 ID="303.92">ALCOH DEP NEC/NOS-EPISOD</ICD9>
"KRN",8989.5,14127,2,21,0)
<ICD9 ID="303.93">ALCOH DEP NEC/NOS-REMISS</ICD9>
"KRN",8989.5,14127,2,22,0)
<ICD9 ID="305.00">ALCOHOL ABUSE-UNSPEC</ICD9>
"KRN",8989.5,14127,2,23,0)
<ICD9 ID="305.01">ALCOHOL ABUSE-CONTINUOUS</ICD9>
"KRN",8989.5,14127,2,24,0)
<ICD9 ID="305.02">ALCOHOL ABUSE-EPISODIC</ICD9>
"KRN",8989.5,14127,2,25,0)
<ICD9 ID="305.03">ALCOHOL ABUSE-IN REMISS</ICD9>
"KRN",8989.5,14127,2,26,0)
<ICD9 ID="357.5">ALCOHOLIC POLYNEUROPATHY</ICD9>
"KRN",8989.5,14127,2,27,0)
<ICD9 ID="425.5">ALCOHOLIC CARDIOMYOPATHY</ICD9>
"KRN",8989.5,14127,2,28,0)
<ICD9 ID="535.3">ALCOHOLIC GASTRITIS</ICD9>
"KRN",8989.5,14127,2,29,0)
<ICD9 ID="535.30">ALCOHOLIC GASTRITIS W/O HEMOR</ICD9>
"KRN",8989.5,14127,2,30,0)
<ICD9 ID="535.31">ALCOHOLIC GASTRITIS W HEMOR</ICD9>
"KRN",8989.5,14127,2,31,0)
<ICD9 ID="571.0">ALCOHOLIC FATTY LIVER</ICD9>
"KRN",8989.5,14127,2,32,0)
<ICD9 ID="571.1">AC ALCOHOLIC HEPATITIS</ICD9>
"KRN",8989.5,14127,2,33,0)
<ICD9 ID="571.2">ALCOHOL CIRRHOSIS LIVER</ICD9>
"KRN",8989.5,14127,2,34,0)
<ICD9 ID="571.3">ALCOHOL LIVER DAMAGE NOS</ICD9>
"KRN",8989.5,14127,2,35,0)
</ICD9LST>
"KRN",8989.5,14127,2,36,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14127,2,37,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14127,2,38,0)
</PARAMS>
"KRN",8989.5,14128,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::Substance use (non-alcohol)
"KRN",8989.5,14128,1)
CCR Predefined Report Template
"KRN",8989.5,14128,2,0)
^^102^102^3051121^
"KRN",8989.5,14128,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14128,2,2,0)
<PARAMS>
"KRN",8989.5,14128,2,3,0)
<ICD9LST>
"KRN",8989.5,14128,2,4,0)
<ICD9 ID="304.00">OPIOID DEPENDENCE UNSPECIFIED</ICD9>
"KRN",8989.5,14128,2,5,0)
<ICD9 ID="304.01">OPIOID DEPENDENCE CONT</ICD9>
"KRN",8989.5,14128,2,6,0)
<ICD9 ID="304.02">OPIOID DEPENDENCE EPISODIC</ICD9>
"KRN",8989.5,14128,2,7,0)
<ICD9 ID="304.03">OPIOID DEPENDENCE IN REMISSION</ICD9>
"KRN",8989.5,14128,2,8,0)
<ICD9 ID="304.09">OTHER OPIOID TYPE DEPEN, NEC</ICD9>
"KRN",8989.5,14128,2,9,0)
<ICD9 ID="304.10">SED,HYP,ANXIOLYT DEP-NOS</ICD9>
"KRN",8989.5,14128,2,10,0)
<ICD9 ID="304.11">SED,HYP,ANXIOLYT DEP-CON</ICD9>
"KRN",8989.5,14128,2,11,0)
<ICD9 ID="304.12">SED,HYP,ANXIOLYT DEP-EPI</ICD9>
"KRN",8989.5,14128,2,12,0)
<ICD9 ID="304.13">SED,HYP,ANXIOLYT DEP-REM</ICD9>
"KRN",8989.5,14128,2,13,0)
<ICD9 ID="304.14">PARALDEHYDE DEPENDENCE</ICD9>
"KRN",8989.5,14128,2,14,0)
<ICD9 ID="304.15">PLACIDYL, ETHCHLORUYNOL DEPEND</ICD9>
"KRN",8989.5,14128,2,15,0)
<ICD9 ID="304.16">VALIUM, DIAZEPAM DEPEND</ICD9>
"KRN",8989.5,14128,2,16,0)
<ICD9 ID="304.17">DORIDEN, GLUTETHIMIDE DEPEND</ICD9>
"KRN",8989.5,14128,2,17,0)
<ICD9 ID="304.18">BARBITURATE DEPENDENCE</ICD9>
"KRN",8989.5,14128,2,18,0)
<ICD9 ID="304.19">OTHER SEDATIVE OR HYPNOTIC</ICD9>
"KRN",8989.5,14128,2,19,0)
<ICD9 ID="304.20">COCAINE DEPEND-UNSPEC</ICD9>
"KRN",8989.5,14128,2,20,0)
<ICD9 ID="304.21">COCAINE DEPEND-CONTIN</ICD9>
"KRN",8989.5,14128,2,21,0)
<ICD9 ID="304.22">COCAINE DEPEND-EPISODIC</ICD9>
"KRN",8989.5,14128,2,22,0)
<ICD9 ID="304.23">COCAINE DEPEND-REMISS</ICD9>
"KRN",8989.5,14128,2,23,0)
<ICD9 ID="304.30">CANNABIS DEPENDENCE UNSPEC</ICD9>
"KRN",8989.5,14128,2,24,0)
<ICD9 ID="304.31">CANNABIS DEPENDENCE CONTINUOUS</ICD9>
"KRN",8989.5,14128,2,25,0)
<ICD9 ID="304.32">CANNABIS DEPENDENCE EPISODIC</ICD9>
"KRN",8989.5,14128,2,26,0)
<ICD9 ID="304.33">CANNABIS DEPENDENCE IN REMISS</ICD9>
"KRN",8989.5,14128,2,27,0)
<ICD9 ID="304.39">OTHER CANNABIS DEPEND, NEC</ICD9>
"KRN",8989.5,14128,2,28,0)
<ICD9 ID="304.40">AMPHETAMINE DEPENDENCE UNSPEC</ICD9>
"KRN",8989.5,14128,2,29,0)
<ICD9 ID="304.41">AMPHETAMINE DEPENDENCE CONT</ICD9>
"KRN",8989.5,14128,2,30,0)
<ICD9 ID="304.42">AMPHETAMINE DEPENDENCE EPISOD</ICD9>
"KRN",8989.5,14128,2,31,0)
<ICD9 ID="304.43">AMPHETAMINE DEPENDENCE IN REM</ICD9>
"KRN",8989.5,14128,2,32,0)
<ICD9 ID="304.49">OTHER PSYCHOSTIM DEPEND</ICD9>
"KRN",8989.5,14128,2,33,0)
<ICD9 ID="304.50">HALLUCINOGEN DEPENDENCE UNSPEC</ICD9>
"KRN",8989.5,14128,2,34,0)
<ICD9 ID="304.51">HALLUCINOGEN DEPENDENCE CONT</ICD9>
"KRN",8989.5,14128,2,35,0)
<ICD9 ID="304.52">HALLUCINOGEN DEPENDENCE EPISOD</ICD9>
"KRN",8989.5,14128,2,36,0)
<ICD9 ID="304.53">HALLUCINOGEN DEPENDENCE IN REM</ICD9>
"KRN",8989.5,14128,2,37,0)
<ICD9 ID="304.59">OTHER HALLUCINOGEN DEPEND</ICD9>
"KRN",8989.5,14128,2,38,0)
<ICD9 ID="304.60">DRUG DEPEND OTH-UNSPEC</ICD9>
"KRN",8989.5,14128,2,39,0)
<ICD9 ID="304.61">DRUG DEPEND OTH-CONTIN</ICD9>
"KRN",8989.5,14128,2,40,0)
<ICD9 ID="304.62">DRUG DEPEND OTH-EPISODIC</ICD9>
"KRN",8989.5,14128,2,41,0)
<ICD9 ID="304.63">DRUG DEPEND OTH-IN REM</ICD9>
"KRN",8989.5,14128,2,42,0)
<ICD9 ID="304.70">OPIOID+OTHER DEP-UNSPEC</ICD9>
"KRN",8989.5,14128,2,43,0)
<ICD9 ID="304.71">OPIOID+OTHER DEP-CONTIN</ICD9>
"KRN",8989.5,14128,2,44,0)
<ICD9 ID="304.72">OPIOID+OTHER DEP-EPISOD</ICD9>
"KRN",8989.5,14128,2,45,0)
<ICD9 ID="304.73">OPIOID+OTHER DEP-REMISS</ICD9>
"KRN",8989.5,14128,2,46,0)
<ICD9 ID="304.80">COMB DRUG DEP NEC-UNSPEC</ICD9>
"KRN",8989.5,14128,2,47,0)
<ICD9 ID="304.81">COMB DRUG DEP NEC-CONTIN</ICD9>
"KRN",8989.5,14128,2,48,0)
<ICD9 ID="304.82">COMB DRUG DEP NEC-EPISOD</ICD9>
"KRN",8989.5,14128,2,49,0)
<ICD9 ID="304.83">COMB DRUG DEP NEC-REMISS</ICD9>
"KRN",8989.5,14128,2,50,0)
<ICD9 ID="304.90">UNSPEC DRUG DEPEND NEC UNSPEC</ICD9>
"KRN",8989.5,14128,2,51,0)
<ICD9 ID="304.91">UNSPEC DRUG DEPEND CONTIN</ICD9>
"KRN",8989.5,14128,2,52,0)
<ICD9 ID="304.92">DRUG DEPEND NOS-EPISODIC</ICD9>
"KRN",8989.5,14128,2,53,0)
<ICD9 ID="304.93">DRUG DEPEND NOS-REMISS</ICD9>
"KRN",8989.5,14128,2,54,0)
<ICD9 ID="304.99">UNSPEC DRUG DEPEND, NEC</ICD9>
"KRN",8989.5,14128,2,55,0)
<ICD9 ID="305.20">CANNABIS ABUSE UNSPECIFIED</ICD9>
"KRN",8989.5,14128,2,56,0)
<ICD9 ID="305.21">CANNABIS ABUSE-CONTIN</ICD9>
"KRN",8989.5,14128,2,57,0)
<ICD9 ID="305.22">CANNABIS ABUSE-EPISODIC</ICD9>
"KRN",8989.5,14128,2,58,0)
<ICD9 ID="305.23">CANNABIS ABUSE-IN REMISS</ICD9>
"KRN",8989.5,14128,2,59,0)
<ICD9 ID="305.29">OTHER CANNABIS USE, NEC</ICD9>
"KRN",8989.5,14128,2,60,0)
<ICD9 ID="305.30">HALLUCINOG ABUSE-UNSPEC</ICD9>
"KRN",8989.5,14128,2,61,0)
<ICD9 ID="305.31">HALLUCINOG ABUSE-CONTIN</ICD9>
"KRN",8989.5,14128,2,62,0)
<ICD9 ID="305.32">HALLUCINOG ABUSE-EPISOD</ICD9>
"KRN",8989.5,14128,2,63,0)
<ICD9 ID="305.33">HALLUCINOG ABUSE-REMISS</ICD9>
"KRN",8989.5,14128,2,64,0)
<ICD9 ID="305.39">OTHER HALLUCINOGEN ABUSE, NEC</ICD9>
"KRN",8989.5,14128,2,65,0)
<ICD9 ID="305.40">SED,HYP,ANXIOLYTC AB-NOS</ICD9>
"KRN",8989.5,14128,2,66,0)
<ICD9 ID="305.41">SED,HYP,ANXIOLYTC AB-CON</ICD9>
"KRN",8989.5,14128,2,67,0)
<ICD9 ID="305.42">SED,HYP,ANXIOLYTC AB-EPI</ICD9>
"KRN",8989.5,14128,2,68,0)
<ICD9 ID="305.43">SED,HYP,ANXIOLYTC AB-REM</ICD9>
"KRN",8989.5,14128,2,69,0)
<ICD9 ID="305.44">PARALDEHYDE ABUSE</ICD9>
"KRN",8989.5,14128,2,70,0)
<ICD9 ID="305.45">PLACIDYL, ETHCHLORUYNOL ABUSE</ICD9>
"KRN",8989.5,14128,2,71,0)
<ICD9 ID="305.46">VALIUM, DIAZEPAM ABUSE</ICD9>
"KRN",8989.5,14128,2,72,0)
<ICD9 ID="305.47">DORIDEN, GLUTETHIMIDE ABUSE</ICD9>
"KRN",8989.5,14128,2,73,0)
<ICD9 ID="305.48">BARBITURATES ABUSE</ICD9>
"KRN",8989.5,14128,2,74,0)
<ICD9 ID="305.49">OTHER SEDATIVE OR HYPNOT, NEC</ICD9>
"KRN",8989.5,14128,2,75,0)
<ICD9 ID="305.50">OPIOID ABUSE UNSPECIFIED</ICD9>
"KRN",8989.5,14128,2,76,0)
<ICD9 ID="305.51">OPIOID ABUSE CONTINUOUS</ICD9>
"KRN",8989.5,14128,2,77,0)
<ICD9 ID="305.52">OPIOID ABUSE EPISODIC</ICD9>
"KRN",8989.5,14128,2,78,0)
<ICD9 ID="305.53">OPIOID ABUSE IN REMISSION</ICD9>
"KRN",8989.5,14128,2,79,0)
<ICD9 ID="305.59">OTHER OPIOID ABUSE, NEC</ICD9>
"KRN",8989.5,14128,2,80,0)
<ICD9 ID="305.6">COCAINE ABUSE-UNSPEC</ICD9>
"KRN",8989.5,14128,2,81,0)
<ICD9 ID="305.60">COCAINE ABUSE UNSPECIFIED</ICD9>
"KRN",8989.5,14128,2,82,0)
<ICD9 ID="305.61">COCAINE ABUSE-CONTINUOUS</ICD9>
"KRN",8989.5,14128,2,83,0)
<ICD9 ID="305.62">COCAINE ABUSE-EPISODIC</ICD9>
"KRN",8989.5,14128,2,84,0)
<ICD9 ID="305.63">COCAINE ABUSE-IN REMISS</ICD9>
"KRN",8989.5,14128,2,85,0)
<ICD9 ID="305.70">AMPHETAMINE ABUSE-UNSPECIFIED</ICD9>
"KRN",8989.5,14128,2,86,0)
<ICD9 ID="305.71">AMPHETAMINE ABUSE-CONTINUOUS</ICD9>
"KRN",8989.5,14128,2,87,0)
<ICD9 ID="305.72">AMPHETAMINE ABUSE-EPISODIC</ICD9>
"KRN",8989.5,14128,2,88,0)
<ICD9 ID="305.73">AMPHETAMINE ABUSE-REMISS</ICD9>
"KRN",8989.5,14128,2,89,0)
<ICD9 ID="305.79">OTHER SYMPATHOMIMETIC, NEC</ICD9>
"KRN",8989.5,14128,2,90,0)
<ICD9 ID="305.80">ANTIDEPRESS ABUSE-UNSPEC</ICD9>
"KRN",8989.5,14128,2,91,0)
<ICD9 ID="305.81">ANTIDEPRESS ABUSE-CONTIN</ICD9>
"KRN",8989.5,14128,2,92,0)
<ICD9 ID="305.82">ANTIDEPRESS ABUSE-EPISOD</ICD9>
"KRN",8989.5,14128,2,93,0)
<ICD9 ID="305.83">ANTIDEPRESS ABUSE-REMISS</ICD9>
"KRN",8989.5,14128,2,94,0)
<ICD9 ID="305.90">OTHER DRUG ABUSE-UNSPEC</ICD9>
"KRN",8989.5,14128,2,95,0)
<ICD9 ID="305.91">OTHER DRUG ABUSE-CONTIN</ICD9>
"KRN",8989.5,14128,2,96,0)
<ICD9 ID="305.92">OTHER DRUG ABUSE-EPISOD</ICD9>
"KRN",8989.5,14128,2,97,0)
<ICD9 ID="305.93">OTHER DRUG ABUSE-REMISS</ICD9>
"KRN",8989.5,14128,2,98,0)
<ICD9 ID="305.99">OTHER, MIXED, UNSPEC, NEC</ICD9>
"KRN",8989.5,14128,2,99,0)
</ICD9LST>
"KRN",8989.5,14128,2,100,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14128,2,101,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14128,2,102,0)
</PARAMS>
"KRN",8989.5,14129,0)
389;DIC(9.4,^ROR REPORT PARAMS TEMPLATE^13::HIV+ Codes
"KRN",8989.5,14129,1)
CCR Predefined Report Template
"KRN",8989.5,14129,2,0)
^^21^21^3051121^
"KRN",8989.5,14129,2,1,0)
<?xml version="1.0" encoding="UTF-8"?>
"KRN",8989.5,14129,2,2,0)
<PARAMS>
"KRN",8989.5,14129,2,3,0)
<ICD9LST>
"KRN",8989.5,14129,2,4,0)
<ICD9 ID="042.">HIV DISEASE</ICD9>
"KRN",8989.5,14129,2,5,0)
<ICD9 ID="042.0">HIV WITH SPECIFIED INFECTIONS</ICD9>
"KRN",8989.5,14129,2,6,0)
<ICD9 ID="042.1">HIV CAUSING OTHER SPEC INF</ICD9>
"KRN",8989.5,14129,2,7,0)
<ICD9 ID="042.2">HIV WITH SPEC MALIGNANT NEO</ICD9>
"KRN",8989.5,14129,2,8,0)
<ICD9 ID="042.9">HIV-AIDS UNSPECIFIED</ICD9>
"KRN",8989.5,14129,2,9,0)
<ICD9 ID="043.0">HIV CAUSING LYMPHADENOPATHY</ICD9>
"KRN",8989.5,14129,2,10,0)
<ICD9 ID="043.1">HIV CAUSING SPEC DISEASE-CNS</ICD9>
"KRN",8989.5,14129,2,11,0)
<ICD9 ID="043.2">HIV CAUSE OTH IMMUNE DIS</ICD9>
"KRN",8989.5,14129,2,12,0)
<ICD9 ID="043.3">HIV CAUSE OTHER SPEC DISORDERS</ICD9>
"KRN",8989.5,14129,2,13,0)
<ICD9 ID="043.9">HIV-ARC, UNSPECIFIED</ICD9>
"KRN",8989.5,14129,2,14,0)
<ICD9 ID="044.0">OTHER HIV CAUSE SPEC ACUTE INF</ICD9>
"KRN",8989.5,14129,2,15,0)
<ICD9 ID="044.9">HIV INFECTION UNSPECIFIED</ICD9>
"KRN",8989.5,14129,2,16,0)
<ICD9 ID="795.8">POSITIVE SERO/VIRAL HIV</ICD9>
"KRN",8989.5,14129,2,17,0)
<ICD9 ID="V08.">ASYMPT HIV STATUS</ICD9>
"KRN",8989.5,14129,2,18,0)
</ICD9LST>
"KRN",8989.5,14129,2,19,0)
<OPTIONS COMPLETE="1"/>
"KRN",8989.5,14129,2,20,0)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"KRN",8989.5,14129,2,21,0)
</PARAMS>
"KRN",8989.51,385,-1)
0^1
"KRN",8989.51,385,0)
ROR REPORT PARAMS TEMPLATE^CCR Report Parameters Template^1^^^
"KRN",8989.51,385,1)
W
"KRN",8989.51,385,6)
F
"KRN",8989.51,385,30,0)
^8989.513I^2^2
"KRN",8989.51,385,30,1,0)
1^200
"KRN",8989.51,385,30,2,0)
2^9.4
"KRN",8989.51,4760,-1)
0^2
"KRN",8989.51,4760,0)
ROR GUI PARAMETER^Clinical Case Registries GUI Parameter^1^GUI Parameter^^
"KRN",8989.51,4760,1)
W
"KRN",8989.51,4760,4,0)
^8989.514^2^2
"KRN",8989.51,4760,4,1,0)
GUI
"KRN",8989.51,4760,4,2,0)
SETTINGS
"KRN",8989.51,4760,4,"B","GUI",1)

"KRN",8989.51,4760,4,"B","SETTINGS",2)

"KRN",8989.51,4760,6)
F
"KRN",8989.51,4760,30,0)
^8989.513I^2^2
"KRN",8989.51,4760,30,1,0)
1^200
"KRN",8989.51,4760,30,2,0)
2^9.4
"KRN",8989.51,4765,-1)
1^3
"KRN",8989.51,4765,0)
ROR VA HEPC GUI SETTINGS
"KRN",8994,1416,-1)
0^42
"KRN",8994,1416,0)
ROR LOG MESSAGE DETAILS^EN3^RORRP7^2^A^^^1
"KRN",8994,1416,2,0)
^8994.02A^1^1
"KRN",8994,1416,2,1,0)
RORIEN^1^^1^1
"KRN",8994,1416,2,"B","RORIEN",1)

"KRN",8994,1416,2,"PARAMSEQ",1,1)

"KRN",8994,1746,-1)
0^51
"KRN",8994,1746,0)
ROR REPORT RETRIEVE^GETXML^RORRP011^2^R^^^1^1
"KRN",8994,1746,1,0)
^8994.01^2^2^3030620^^^^
"KRN",8994,1746,1,1,0)
The ROR REPORT RETRIEVE remote procedure returns an array that contains
"KRN",8994,1746,1,2,0)
the report (in XML format) generated by the task.
"KRN",8994,1746,2,0)
^8994.02A^4^4
"KRN",8994,1746,2,1,0)
TASK^1^^1^1
"KRN",8994,1746,2,1,1,0)
^^2^2^3030110^
"KRN",8994,1746,2,1,1,1,0)
Task number returned either by the ROR REPORT SCHEDULE or ROR TASK LIST
"KRN",8994,1746,2,1,1,2,0)
remote procedures.
"KRN",8994,1746,2,2,0)
FROM^1^^^2
"KRN",8994,1746,2,2,1,0)
^^24^24^3030110^
"KRN",8994,1746,2,2,1,1,0)
A string that indicates where to start/continue the rendering process. It 
"KRN",8994,1746,2,2,1,2,0)
contains three "^"-pieces:
"KRN",8994,1746,2,2,1,3,0)
 
"KRN",8994,1746,2,2,1,4,0)
  ^1: IEN of the report element
"KRN",8994,1746,2,2,1,5,0)
 
"KRN",8994,1746,2,2,1,6,0)
  ^2: Where exactly the rendering process has stopped
"KRN",8994,1746,2,2,1,7,0)
      (see the $$XMLREP^RORTSK10 function for details)
"KRN",8994,1746,2,2,1,8,0)
 
"KRN",8994,1746,2,2,1,9,0)
  ^3: IEN of the text line (if the 2nd piece = 3)
"KRN",8994,1746,2,2,1,10,0)
 
"KRN",8994,1746,2,2,1,11,0)
To continue the rendering from the point where it stopped during the
"KRN",8994,1746,2,2,1,12,0)
previous call of the remote procedure, just assign the non-empty value
"KRN",8994,1746,2,2,1,13,0)
returned in the RESULT[0] by the previous call.
"KRN",8994,1746,2,2,1,14,0)
 
"KRN",8994,1746,2,2,1,15,0)
By default (if $G(FROM)'>0), the rendering starts from the beginning of 
"KRN",8994,1746,2,2,1,16,0)
the report.
"KRN",8994,1746,2,2,1,17,0)
 
"KRN",8994,1746,2,2,1,18,0)
NOTE: 
"KRN",8994,1746,2,2,1,19,0)
 
"KRN",8994,1746,2,2,1,20,0)
Despite this description, you must not make any assumptions about
"KRN",8994,1746,2,2,1,21,0)
structure of this parameter (it can be changed at any time without
"KRN",8994,1746,2,2,1,22,0)
warning). The only exception is the IEN of the report element. You can
"KRN",8994,1746,2,2,1,23,0)
assign a positive value to this parameter before the call to start the
"KRN",8994,1746,2,2,1,24,0)
rendering from the corresponding element.
"KRN",8994,1746,2,3,0)
MAXSIZE^1^^^3
"KRN",8994,1746,2,3,1,0)
^^13^13^3030307^
"KRN",8994,1746,2,3,1,1,0)
Either the maximum number of lines to retrieve or the maximum size of the
"KRN",8994,1746,2,3,1,2,0)
output in bytes (append the "B" to the number). By default (if
"KRN",8994,1746,2,3,1,3,0)
$G(MAXSIZE)'>0,) the whole report (starting from the point indicated by
"KRN",8994,1746,2,3,1,4,0)
the FROM parameter if it is defined) is retrieved.
"KRN",8994,1746,2,3,1,5,0)
 
"KRN",8994,1746,2,3,1,6,0)
  Examples:
"KRN",8994,1746,2,3,1,7,0)
    500    Retrieve no more that 500 lines
"KRN",8994,1746,2,3,1,8,0)
    4096B  Retrieve no mor than 4Kb
"KRN",8994,1746,2,3,1,9,0)
 
"KRN",8994,1746,2,3,1,10,0)
NOTE: If the "B" suffix is used, the size of the retrieved
"KRN",8994,1746,2,3,1,11,0)
      portion of the document can be somewhat bigger than
"KRN",8994,1746,2,3,1,12,0)
      MAXSIZE! The last line of the chunk is not truncated
"KRN",8994,1746,2,3,1,13,0)
      even if the size will be bigger than MAXSIZE.
"KRN",8994,1746,2,4,0)
SORT^2^^^4
"KRN",8994,1746,2,4,1,0)
^^36^36^3030620^
"KRN",8994,1746,2,4,1,1,0)
The SORT list defines how the different parts of the report are sorted.
"KRN",8994,1746,2,4,1,2,0)
It should be defined as follow:
"KRN",8994,1746,2,4,1,3,0)
 
"KRN",8994,1746,2,4,1,4,0)
  SORT(i)="ParentElementName=SortElementName"
"KRN",8994,1746,2,4,1,5,0)
 
"KRN",8994,1746,2,4,1,6,0)
An optional D[ESC] modifier (the abbreviation of 'descending') can be
"KRN",8994,1746,2,4,1,7,0)
added after the SortElementName. They should be sepearted by the ':'.
"KRN",8994,1746,2,4,1,8,0)
 
"KRN",8994,1746,2,4,1,9,0)
For example, if the report has the following structure:
"KRN",8994,1746,2,4,1,10,0)
 
"KRN",8994,1746,2,4,1,11,0)
  <REPORT>
"KRN",8994,1746,2,4,1,12,0)
    <PATIENT>
"KRN",8994,1746,2,4,1,13,0)
      <NAME> ... </NAME>
"KRN",8994,1746,2,4,1,14,0)
      <DOB> ... </DOB>
"KRN",8994,1746,2,4,1,15,0)
      <SELRULES>
"KRN",8994,1746,2,4,1,16,0)
        <RULE>
"KRN",8994,1746,2,4,1,17,0)
          <NAME> ... </NAME>
"KRN",8994,1746,2,4,1,18,0)
          <DATE> ... </DATE>
"KRN",8994,1746,2,4,1,19,0)
        </RULE>
"KRN",8994,1746,2,4,1,20,0)
        ...
"KRN",8994,1746,2,4,1,21,0)
      </SELRULES>
"KRN",8994,1746,2,4,1,22,0)
    </PATIENT>
"KRN",8994,1746,2,4,1,23,0)
    ...
"KRN",8994,1746,2,4,1,24,0)
  </REPORT>
"KRN",8994,1746,2,4,1,25,0)
 
"KRN",8994,1746,2,4,1,26,0)
and the SORT parameter is defined by the client application as follow:
"KRN",8994,1746,2,4,1,27,0)
 
"KRN",8994,1746,2,4,1,28,0)
  with RPCBroker do begin     
"KRN",8994,1746,2,4,1,29,0)
    Param[3].PType := list; 
"KRN",8994,1746,2,4,1,30,0)
    Param[3].Mult[1] := 'REPORT=NAME';  
"KRN",8994,1746,2,4,1,31,0)
    Param[3].Mult[2] := 'SELRULES=DATE:D';
"KRN",8994,1746,2,4,1,32,0)
  end;
"KRN",8994,1746,2,4,1,33,0)
 
"KRN",8994,1746,2,4,1,34,0)
then the procedure will sort the patients by their names and the selection
"KRN",8994,1746,2,4,1,35,0)
rules for each patient will be sorted by the corresponding dates in 
"KRN",8994,1746,2,4,1,36,0)
descending order.
"KRN",8994,1746,2,"B","FROM",2)

"KRN",8994,1746,2,"B","MAXSIZE",3)

"KRN",8994,1746,2,"B","SORT",4)

"KRN",8994,1746,2,"B","TASK",1)

"KRN",8994,1746,2,"PARAMSEQ",1,1)

"KRN",8994,1746,2,"PARAMSEQ",2,2)

"KRN",8994,1746,2,"PARAMSEQ",3,3)

"KRN",8994,1746,2,"PARAMSEQ",4,4)

"KRN",8994,1746,3,0)
^8994.03^31^31^3030620^^^^
"KRN",8994,1746,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1746,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1746,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1746,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1746,3,5,0)
    
"KRN",8994,1746,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1746,3,7,0)
                          ^01: The last error code
"KRN",8994,1746,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1746,3,9,0)
                                                                      
"KRN",8994,1746,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1746,3,11,0)
                          ^01: Error code
"KRN",8994,1746,3,12,0)
                          ^02: Message
"KRN",8994,1746,3,13,0)
                          ^03: Place of the error
"KRN",8994,1746,3,14,0)
 
"KRN",8994,1746,3,15,0)
Otherwise, it contains either a string that indicates the place where 
"KRN",8994,1746,3,16,0)
the rendering stopped because the maximum number of lines (defined by the 
"KRN",8994,1746,3,17,0)
NUMBER parameter) had been processed or an empty string if the processing 
"KRN",8994,1746,3,18,0)
of the report was completed.
"KRN",8994,1746,3,19,0)
 
"KRN",8994,1746,3,20,0)
You should pass this value (if it is not empty) as the FROM parameter to
"KRN",8994,1746,3,21,0)
subsequent call of the remote procedure if you want to continue the
"KRN",8994,1746,3,22,0)
rendering from the point where it stopped.
"KRN",8994,1746,3,23,0)
 
"KRN",8994,1746,3,24,0)
The subsequent elements of the resulting array (starting from 1) contain
"KRN",8994,1746,3,25,0)
the lines of the report. An element can contain an XML tag, a single-line
"KRN",8994,1746,3,26,0)
value between opening and closing tags or a line of text.
"KRN",8994,1746,3,27,0)
 
"KRN",8994,1746,3,28,0)
NOTE: If the MAXSIZE parameter is not defined or not greater
"KRN",8994,1746,3,29,0)
      than zero (a request for the whole report), the new value
"KRN",8994,1746,3,30,0)
      for the FROM parameter is not returned in the Results[0]
"KRN",8994,1746,3,31,0)
      and the latter contains the first line of the report.
"KRN",8994,1749,-1)
0^52
"KRN",8994,1749,0)
ROR REPORT SCHEDULE^SCHEDREP^RORRP010^2^R^^^1^1
"KRN",8994,1749,1,0)
^8994.01^1^1^3031107^^^^
"KRN",8994,1749,1,1,0)
Schedules the report and returns the task information.
"KRN",8994,1749,2,0)
^8994.02A^5^5
"KRN",8994,1749,2,1,0)
REGIEN^1^^^2
"KRN",8994,1749,2,1,1,0)
^8994.021^2^2^3030220^^
"KRN",8994,1749,2,1,1,1,0)
Registry IEN (if $G(REGIEN)'>0 the task will not be associated with any
"KRN",8994,1749,2,1,1,2,0)
particular registry).
"KRN",8994,1749,2,2,0)
RPTCODE^1^^1^1
"KRN",8994,1749,2,2,1,0)
^8994.021^2^2^3030307^^^
"KRN",8994,1749,2,2,1,1,0)
Code of the report (value of the CODE field of the report descriptor in
"KRN",8994,1749,2,2,1,2,0)
the ROR REPORT file).
"KRN",8994,1749,2,3,0)
ZTDTH^1^^^3
"KRN",8994,1749,2,3,1,0)
^^2^2^3030110^
"KRN",8994,1749,2,3,1,1,0)
Date/time to start the task (external value). By default (if $G(ZDTH)=""),
"KRN",8994,1749,2,3,1,2,0)
the task will be scheduled to run after 3-second pause.
"KRN",8994,1749,2,4,0)
PARAMS^2^^^5
"KRN",8994,1749,2,4,1,0)
^^204^204^3031107^
"KRN",8994,1749,2,4,1,1,0)
A list of name-value pairs of task parameters: PARAMS(name)=value.
"KRN",8994,1749,2,4,1,2,0)
For example:
"KRN",8994,1749,2,4,1,3,0)
 
"KRN",8994,1749,2,4,1,4,0)
  with RPCBroker.Param[4] do
"KRN",8994,1749,2,4,1,5,0)
    begin
"KRN",8994,1749,2,4,1,6,0)
      PType :=list;
"KRN",8994,1749,2,4,1,7,0)
      Mult['"REGIEN"'] := RegInfo.IEN;
"KRN",8994,1749,2,4,1,8,0)
      Mult['"DATE_RANGE"'] := 'YEAR^2003';
"KRN",8994,1749,2,4,1,9,0)
      Mult['"PATIENTS"'] := 'INPATIENT,OUTPATIENT';
"KRN",8994,1749,2,4,1,10,0)
      Mult['"VADRUGCLS(1)"'] := 'IN140';
"KRN",8994,1749,2,4,1,11,0)
      Mult['"VADRUGCLS(2)"'] := 'IN150';
"KRN",8994,1749,2,4,1,12,0)
    end;
"KRN",8994,1749,2,4,1,13,0)
 
"KRN",8994,1749,2,4,1,14,0)
Accepted parameters:
"KRN",8994,1749,2,4,1,15,0)
 
"KRN",8994,1749,2,4,1,16,0)
  CD4OPT        CD4 options
"KRN",8994,1749,2,4,1,17,0)
                  ^01: Include CD4 (0/1)
"KRN",8994,1749,2,4,1,18,0)
                  ^02: Use range   (0/1)
"KRN",8994,1749,2,4,1,19,0)
                  ^03: Low
"KRN",8994,1749,2,4,1,20,0)
                  ^04: High
"KRN",8994,1749,2,4,1,21,0)
 
"KRN",8994,1749,2,4,1,22,0)
                Example (include all):
"KRN",8994,1749,2,4,1,23,0)
                  Mult['"CD4OPT"'] := '1';
"KRN",8994,1749,2,4,1,24,0)
 
"KRN",8994,1749,2,4,1,25,0)
                Example (use range):
"KRN",8994,1749,2,4,1,26,0)
                  Mult['"CD4OPT"'] := '1^1^5000000^9000000';
"KRN",8994,1749,2,4,1,27,0)
 
"KRN",8994,1749,2,4,1,28,0)
  CLINICS       Clinics included in the report
"KRN",8994,1749,2,4,1,29,0)
 
"KRN",8994,1749,2,4,1,30,0)
                Example 1 (all clinics):
"KRN",8994,1749,2,4,1,31,0)
                  Mult['"CLINICS"'] := 'ALL';
"KRN",8994,1749,2,4,1,32,0)
 
"KRN",8994,1749,2,4,1,33,0)
                Example 2 (selected clinics):
"KRN",8994,1749,2,4,1,34,0)
                  for i := 1 to Clinics.Count do
"KRN",8994,1749,2,4,1,35,0)
                    Mult['"CLINICS('+i+')"'] := Clinics[i-1].IEN;
"KRN",8994,1749,2,4,1,36,0)
 
"KRN",8994,1749,2,4,1,37,0)
  DATE_RANGE    Date Range
"KRN",8994,1749,2,4,1,38,0)
 
"KRN",8994,1749,2,4,1,39,0)
                  CUSTOM^StartDate^EndDate (FileMan)
"KRN",8994,1749,2,4,1,40,0)
                  CUTOFF^Cutoff
"KRN",8994,1749,2,4,1,41,0)
                  QUARTER^Quarter^Year^Fiscal
"KRN",8994,1749,2,4,1,42,0)
                  YEAR^Year^Fiscal
"KRN",8994,1749,2,4,1,43,0)
 
"KRN",8994,1749,2,4,1,44,0)
                Examples:
"KRN",8994,1749,2,4,1,45,0)
                  Mult['"DATE_RANGE"'] := 'CUSTOM^3021015^3030201';
"KRN",8994,1749,2,4,1,46,0)
                  Mult['"DATE_RANGE"'] := 'CUTOFF^25';   // 25 days
"KRN",8994,1749,2,4,1,47,0)
                  Mult['"DATE_RANGE"'] := 'CUTOFF^5W';   // 5 weeks
"KRN",8994,1749,2,4,1,48,0)
                  Mult['"DATE_RANGE"'] := 'QUARTER^2^2003';
"KRN",8994,1749,2,4,1,49,0)
                  Mult['"DATE_RANGE"'] := 'YEAR^2003^1'; // Fiscal 2003
"KRN",8994,1749,2,4,1,50,0)
 
"KRN",8994,1749,2,4,1,51,0)
  DIVISIONS     Divisions included in the report
"KRN",8994,1749,2,4,1,52,0)
 
"KRN",8994,1749,2,4,1,53,0)
                Example 1 (all divisions):
"KRN",8994,1749,2,4,1,54,0)
                  Mult['"DIVISIONS"'] := 'ALL';
"KRN",8994,1749,2,4,1,55,0)
 
"KRN",8994,1749,2,4,1,56,0)
                Example 2 (selected divisions):
"KRN",8994,1749,2,4,1,57,0)
                  for i := 1 to Divisions.Count do
"KRN",8994,1749,2,4,1,58,0)
                    Mult['"DIVISIONS('+i+')"'] := Divisions[i-1].IEN;
"KRN",8994,1749,2,4,1,59,0)
 
"KRN",8994,1749,2,4,1,60,0)
  DRUGS         Drugs included in the report:
"KRN",8994,1749,2,4,1,61,0)
 
"KRN",8994,1749,2,4,1,62,0)
    ALL           All drugs
"KRN",8994,1749,2,4,1,63,0)
    ARV           Drugs defined in the ROR GENERIC DRUG file and
"KRN",8994,1749,2,4,1,64,0)
                  the LOCAL DRUG NAME multiple of the file #798.1
"KRN",8994,1749,2,4,1,65,0)
    DISPENSED     Search and/or aggregate dispensed drugs
"KRN",8994,1749,2,4,1,66,0)
    GENERIC       Search and/or aggregate generic drugs
"KRN",8994,1749,2,4,1,67,0)
    VARXCLS       Drugs in the classes defined by
"KRN",8994,1749,2,4,1,68,0)
                  the VADRUGCLS parameter
"KRN",8994,1749,2,4,1,69,0)
 
"KRN",8994,1749,2,4,1,70,0)
                Example 1 (drugs from the registry parameters):
"KRN",8994,1749,2,4,1,71,0)
                  Mult['"DRUGS"'] := 'ARV,AGRDISP';
"KRN",8994,1749,2,4,1,72,0)
 
"KRN",8994,1749,2,4,1,73,0)
                Example 2 (selected drugs):
"KRN",8994,1749,2,4,1,74,0)
                  for i := 1 to Drugs.Count do
"KRN",8994,1749,2,4,1,75,0)
                    Mult['"DRUGS('+i+')"'] := Drugs[i-1].IEN;
"KRN",8994,1749,2,4,1,76,0)
 
"KRN",8994,1749,2,4,1,77,0)
  FIELDS        Additional fields included in the report
"KRN",8994,1749,2,4,1,78,0)
 
"KRN",8994,1749,2,4,1,79,0)
    ACTIVE        Active/Inactive status
"KRN",8994,1749,2,4,1,80,0)
    AIDSTAT       Clinical AIDS status
"KRN",8994,1749,2,4,1,81,0)
    ALIVE         Living status
"KRN",8994,1749,2,4,1,82,0)
    AGE           Patient age
"KRN",8994,1749,2,4,1,83,0)
    CSSN          Coded SSN
"KRN",8994,1749,2,4,1,84,0)
    DOB           Date of birth
"KRN",8994,1749,2,4,1,85,0)
    DOD           Date of death
"KRN",8994,1749,2,4,1,86,0)
    ENTDT         Date added to the registry
"KRN",8994,1749,2,4,1,87,0)
    ICN           Integration Control Number
"KRN",8994,1749,2,4,1,88,0)
    INADT         Date of inactivation
"KRN",8994,1749,2,4,1,89,0)
    INARSN        Reason for inactivation
"KRN",8994,1749,2,4,1,90,0)
    LAST4         Last 4 digits of the SSN
"KRN",8994,1749,2,4,1,91,0)
    PRIMELIG      Primary eligibility
"KRN",8994,1749,2,4,1,92,0)
    RACE          Race(s)
"KRN",8994,1749,2,4,1,93,0)
    READT         Date of reactivation
"KRN",8994,1749,2,4,1,94,0)
    REARSN        Reason for reactivation (supporting evidence)
"KRN",8994,1749,2,4,1,95,0)
    REIMBLVL      Reimbursement level
"KRN",8994,1749,2,4,1,96,0)
    RISK          Risk factors
"KRN",8994,1749,2,4,1,97,0)
    SELRULES      Reason(s) for addition to the registry
"KRN",8994,1749,2,4,1,98,0)
    SEX           Patient sex
"KRN",8994,1749,2,4,1,99,0)
    SSN           Full SSN
"KRN",8994,1749,2,4,1,100,0)
    UTIL          Utilization
"KRN",8994,1749,2,4,1,101,0)
 
"KRN",8994,1749,2,4,1,102,0)
                Example:
"KRN",8994,1749,2,4,1,103,0)
                  Mult['"FIELDS"'] := 'SSN,SEX,ENTDT,SELRULES';
"KRN",8994,1749,2,4,1,104,0)
 
"KRN",8994,1749,2,4,1,105,0)
  ICD9LST       List of ICD-9 codes included in the report
"KRN",8994,1749,2,4,1,106,0)
 
"KRN",8994,1749,2,4,1,107,0)
    ALL           Include all ICD-9 codes
"KRN",8994,1749,2,4,1,108,0)
 
"KRN",8994,1749,2,4,1,109,0)
                Example 1 (all codes):
"KRN",8994,1749,2,4,1,110,0)
                  Mult['"ICD9LST"'] := 'ALL';
"KRN",8994,1749,2,4,1,111,0)
 
"KRN",8994,1749,2,4,1,112,0)
                Example 2 (selected codes):
"KRN",8994,1749,2,4,1,113,0)
                  for i := 1 to ICD9.Count do
"KRN",8994,1749,2,4,1,114,0)
                    Mult['"ICD9LST('+i+')"'] := ICD9[i-1];
"KRN",8994,1749,2,4,1,115,0)
 
"KRN",8994,1749,2,4,1,116,0)
  LABTESTS      Lab tests included in the report
"KRN",8994,1749,2,4,1,117,0)
 
"KRN",8994,1749,2,4,1,118,0)
                Example 1 (all test):
"KRN",8994,1749,2,4,1,119,0)
                  Mult['"LABTESTS"'] := 'ALL';
"KRN",8994,1749,2,4,1,120,0)
 
"KRN",8994,1749,2,4,1,121,0)
                Example 2 (selected tests):
"KRN",8994,1749,2,4,1,122,0)
                  for i := 1 to LabTests.Count do
"KRN",8994,1749,2,4,1,123,0)
                    Mult['"LABTESTS('+i+')"'] := LabTests[i-1].IEN;
"KRN",8994,1749,2,4,1,124,0)
 
"KRN",8994,1749,2,4,1,125,0)
  MAXUTNUM      Number of patients with the highest utilization
"KRN",8994,1749,2,4,1,126,0)
                to be included in the report.
"KRN",8994,1749,2,4,1,127,0)
 
"KRN",8994,1749,2,4,1,128,0)
                Example:
"KRN",8994,1749,2,4,1,129,0)
                  Mult['"MAXUTNUM"'] := '5';
"KRN",8994,1749,2,4,1,130,0)
 
"KRN",8994,1749,2,4,1,131,0)
  MINRPNUM      Minimum number of times that the radiology procedure
"KRN",8994,1749,2,4,1,132,0)
                or Lab test is performed that is required for its
"KRN",8994,1749,2,4,1,133,0)
                inclusion in the report.
"KRN",8994,1749,2,4,1,134,0)
 
"KRN",8994,1749,2,4,1,135,0)
                Example:
"KRN",8994,1749,2,4,1,136,0)
                  Mult['"MINRPNUM"'] := '3';
"KRN",8994,1749,2,4,1,137,0)
 
"KRN",8994,1749,2,4,1,138,0)
  OPTIONS       Report options (separated by commas):
"KRN",8994,1749,2,4,1,139,0)
 
"KRN",8994,1749,2,4,1,140,0)
    AIDSNOARV     Include the list of registry patients with AIDS who
"KRN",8994,1749,2,4,1,141,0)
                  received no ARV drugs during the report time frame
"KRN",8994,1749,2,4,1,142,0)
    ARVLST        Include the list of ARV drugs, which were received
"KRN",8994,1749,2,4,1,143,0)
                  by registry patients during the report time frame
"KRN",8994,1749,2,4,1,144,0)
    ARVPTL        Include the list of registry patients who received
"KRN",8994,1749,2,4,1,145,0)
                  any ARV drugs during the report time frame
"KRN",8994,1749,2,4,1,146,0)
    CATSPLIT      Split by category
"KRN",8994,1749,2,4,1,147,0)
    COMPLETE      Include complete report
"KRN",8994,1749,2,4,1,148,0)
    LAB           Include Lab data
"KRN",8994,1749,2,4,1,149,0)
    PHARMACY      Include pharmacy data
"KRN",8994,1749,2,4,1,150,0)
    SUMMARY       Include summary
"KRN",8994,1749,2,4,1,151,0)
 
"KRN",8994,1749,2,4,1,152,0)
                Example:
"KRN",8994,1749,2,4,1,153,0)
                  Mult['"OPTIONS"'] := 'COMPLETE,SUMMARY';
"KRN",8994,1749,2,4,1,154,0)
 
"KRN",8994,1749,2,4,1,155,0)
  PATIENTS      Include the patients defined by the attributes
"KRN",8994,1749,2,4,1,156,0)
                (separated by commas) in the report:
"KRN",8994,1749,2,4,1,157,0)
 
"KRN",8994,1749,2,4,1,158,0)
    ACTIVE        Active registry patients
"KRN",8994,1749,2,4,1,159,0)
    AIDS          Patients with clinical AIDS status
"KRN",8994,1749,2,4,1,160,0)
    CAREONLY      Include only those patients who have
"KRN",8994,1749,2,4,1,161,0)
                  received care
"KRN",8994,1749,2,4,1,162,0)
    DE_AFTER      Patients added after the report end date
"KRN",8994,1749,2,4,1,163,0)
    DE_BEFORE     Patients added before the report start date
"KRN",8994,1749,2,4,1,164,0)
    DE_DURING     Patietns added during the report time frame
"KRN",8994,1749,2,4,1,165,0)
    HIV           Patients with the HIV+ status
"KRN",8994,1749,2,4,1,166,0)
    INACTIVE      Inactive registry patients
"KRN",8994,1749,2,4,1,167,0)
    INPATIENT     Inpatients
"KRN",8994,1749,2,4,1,168,0)
    NOTSEEN       Patients not seen in the time frame
"KRN",8994,1749,2,4,1,169,0)
    OUTPATIENT    Outpatients
"KRN",8994,1749,2,4,1,170,0)
    SEEN          Patients seen in the provided time frame
"KRN",8994,1749,2,4,1,171,0)
 
"KRN",8994,1749,2,4,1,172,0)
                Example:
"KRN",8994,1749,2,4,1,173,0)
                  Mult['"PATIENTS"'] := 'ACTIVE,NEW,INPATIENT';
"KRN",8994,1749,2,4,1,174,0)
 
"KRN",8994,1749,2,4,1,175,0)
  PTLST         List of selected patients
"KRN",8994,1749,2,4,1,176,0)
 
"KRN",8994,1749,2,4,1,177,0)
                Example:
"KRN",8994,1749,2,4,1,178,0)
                  for i := 1 to Patients.Count do
"KRN",8994,1749,2,4,1,179,0)
                    Mult[i] := 'PTLST('+i+')=' + Patients[i-1].IEN;
"KRN",8994,1749,2,4,1,180,0)
 
"KRN",8994,1749,2,4,1,181,0)
  REGIEN        Registry IEN
"KRN",8994,1749,2,4,1,182,0)
 
"KRN",8994,1749,2,4,1,183,0)
                Example:
"KRN",8994,1749,2,4,1,184,0)
                  Mult['"REGIEN"'] := RegInfo.IEN;
"KRN",8994,1749,2,4,1,185,0)
 
"KRN",8994,1749,2,4,1,186,0)
  TASK_DESCR    Description of the task that generates the report
"KRN",8994,1749,2,4,1,187,0)
 
"KRN",8994,1749,2,4,1,188,0)
  VADRUGCLS     VA drug classes included in the report
"KRN",8994,1749,2,4,1,189,0)
 
"KRN",8994,1749,2,4,1,190,0)
                Example:
"KRN",8994,1749,2,4,1,191,0)
                  Mult['"VADRUGCLS(1)"'] := 'IN140';
"KRN",8994,1749,2,4,1,192,0)
                  Mult['"VADRUGCLS(2)"'] := 'IN150';
"KRN",8994,1749,2,4,1,193,0)
 
"KRN",8994,1749,2,4,1,194,0)
  VIRAL_LOAD    Viral Load options
"KRN",8994,1749,2,4,1,195,0)
                  ^01: Include Viral Load (0/1)
"KRN",8994,1749,2,4,1,196,0)
                  ^02: Use range          (0/1)
"KRN",8994,1749,2,4,1,197,0)
                  ^03: Low
"KRN",8994,1749,2,4,1,198,0)
                  ^04: High
"KRN",8994,1749,2,4,1,199,0)
 
"KRN",8994,1749,2,4,1,200,0)
                Example (include all):
"KRN",8994,1749,2,4,1,201,0)
                  Mult['"VIRAL_LOAD"'] := '1';
"KRN",8994,1749,2,4,1,202,0)
 
"KRN",8994,1749,2,4,1,203,0)
                Example (use range):
"KRN",8994,1749,2,4,1,204,0)
                  Mult['"VIRAL_LOAD"'] := '1^1^3000^100000';
"KRN",8994,1749,2,5,0)
SCHCODE^1^^^4
"KRN",8994,1749,2,5,1,0)
^8994.021^1^1^3031107^^^^
"KRN",8994,1749,2,5,1,1,0)
Rescheduling code ("1D", "1M", "D@12:00", etc).
"KRN",8994,1749,2,"B","PARAMS",4)

"KRN",8994,1749,2,"B","REGIEN",1)

"KRN",8994,1749,2,"B","RPTCODE",2)

"KRN",8994,1749,2,"B","SCHCODE",5)

"KRN",8994,1749,2,"B","ZTDTH",3)

"KRN",8994,1749,2,"PARAMSEQ",1,2)

"KRN",8994,1749,2,"PARAMSEQ",2,1)

"KRN",8994,1749,2,"PARAMSEQ",3,3)

"KRN",8994,1749,2,"PARAMSEQ",4,5)

"KRN",8994,1749,2,"PARAMSEQ",5,4)

"KRN",8994,1749,3,0)
^8994.03^30^30^3031107^^^^
"KRN",8994,1749,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1749,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1749,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1749,3,4,0)
descriptors returned in the subsequent nodes of the Results array.
"KRN",8994,1749,3,5,0)
 
"KRN",8994,1749,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1749,3,7,0)
                          ^01: The last error code (LASTERR)
"KRN",8994,1749,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1749,3,9,0)
 
"KRN",8994,1749,3,10,0)
 
"KRN",8994,1749,3,11,0)
  Results[i]            Error Descriptor
"KRN",8994,1749,3,12,0)
                          ^01: Error code
"KRN",8994,1749,3,13,0)
                          ^02: Message
"KRN",8994,1749,3,14,0)
                          ^03: Place of the error
"KRN",8994,1749,3,15,0)
 
"KRN",8994,1749,3,16,0)
Error descriptors are returned in reverse chronological order (most recent
"KRN",8994,1749,3,17,0)
error first).                                                 
"KRN",8994,1749,3,18,0)
 
"KRN",8994,1749,3,19,0)
Otherwise, the Results[0] contains number of task descriptors returned in
"KRN",8994,1749,3,20,0)
the Results array (always 1) and number of elements that comprise a task
"KRN",8994,1749,3,21,0)
descriptor:
"KRN",8994,1749,3,22,0)
 
"KRN",8994,1749,3,23,0)
  Results[0]            Result Descriptor
"KRN",8994,1749,3,24,0)
                          ^01: 1
"KRN",8994,1749,3,25,0)
                          ^02: Number of elements that comprise a task
"KRN",8994,1749,3,26,0)
                               descriptor (TIN)
"KRN",8994,1749,3,27,0)
 
"KRN",8994,1749,3,28,0)
The subsequent nodes of the Results array (from 1 to TIN) contain the
"KRN",8994,1749,3,29,0)
information about the scheduled task (see the ROR TASK INFO remote 
"KRN",8994,1749,3,30,0)
procedure for more details).
"KRN",8994,1750,-1)
0^58
"KRN",8994,1750,0)
ROR TASK INFO^TASKINFO^RORRP010^2^R^^^1^1
"KRN",8994,1750,1,0)
^8994.01^2^2^3050217^^^^
"KRN",8994,1750,1,1,0)
The ROR TASK INFO remote procedure returns the information about the task
"KRN",8994,1750,1,2,0)
started from the GUI.
"KRN",8994,1750,2,0)
^8994.02A^1^1
"KRN",8994,1750,2,1,0)
TASK^1^^1^1
"KRN",8994,1750,2,1,1,0)
^8994.021^1^1^3050217^^^^
"KRN",8994,1750,2,1,1,1,0)
A valid task number should be assigned to the TASK parameter.
"KRN",8994,1750,2,"B","TASK",1)

"KRN",8994,1750,2,"PARAMSEQ",1,1)

"KRN",8994,1750,3,0)
^^43^43^3050217^
"KRN",8994,1750,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1750,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1750,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1750,3,4,0)
descriptors returned in the subsequent nodes of the Results array.
"KRN",8994,1750,3,5,0)
 
"KRN",8994,1750,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1750,3,7,0)
                          ^01: The last error code (LASTERR)
"KRN",8994,1750,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1750,3,9,0)
 
"KRN",8994,1750,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1750,3,11,0)
                          ^01: Error code
"KRN",8994,1750,3,12,0)
                          ^02: Message
"KRN",8994,1750,3,13,0)
                          ^03: Place of the error
"KRN",8994,1750,3,14,0)
 
"KRN",8994,1750,3,15,0)
Error descriptors are returned in reverse chronological order (most recent
"KRN",8994,1750,3,16,0)
error first).                                                 
"KRN",8994,1750,3,17,0)
 
"KRN",8994,1750,3,18,0)
Otherwise, the Results[0] contains number of task descriptors returned
"KRN",8994,1750,3,19,0)
in the Results array (always 1) and number of elements that comprise a
"KRN",8994,1750,3,20,0)
task descriptor:
"KRN",8994,1750,3,21,0)
 
"KRN",8994,1750,3,22,0)
  Results[0]            Result Descriptor
"KRN",8994,1750,3,23,0)
                          ^01: 1
"KRN",8994,1750,3,24,0)
                          ^02: Number of elements that comprise a task
"KRN",8994,1750,3,25,0)
                               descriptor (TIN)
"KRN",8994,1750,3,26,0)
 
"KRN",8994,1750,3,27,0)
The subsequent nodes of the Results array (from 1 to TIN) contain the
"KRN",8994,1750,3,28,0)
information about the scheduled task:
"KRN",8994,1750,3,29,0)
 
"KRN",8994,1750,3,30,0)
  Results[1]            Task Number
"KRN",8994,1750,3,31,0)
  Results[2]            Task Type           (internal^external)
"KRN",8994,1750,3,32,0)
  Results[3]            Registry            (IEN^Name)
"KRN",8994,1750,3,33,0)
  Results[4]            Report              (Code^Name)
"KRN",8994,1750,3,34,0)
  Results[5]            Task Description
"KRN",8994,1750,3,35,0)
  Results[6]            Task Status         (internal^external)
"KRN",8994,1750,3,36,0)
  Results[7]            Creation Time       (FileMan)
"KRN",8994,1750,3,37,0)
  Results[8]            User                (DUZ^Name)
"KRN",8994,1750,3,38,0)
  Results[9]            Completion Time     (FileMan)
"KRN",8994,1750,3,39,0)
  Results[10]           Progress Percentage
"KRN",8994,1750,3,40,0)
  Results[11]           Scheduled to Run at (FileMan)
"KRN",8994,1750,3,41,0)
  Results[12]           Task Log IEN
"KRN",8994,1750,3,42,0)
  Results[13]           Job Number
"KRN",8994,1750,3,43,0)
  Results[14]           User Comment
"KRN",8994,1751,-1)
0^59
"KRN",8994,1751,0)
ROR TASK LIST^TASKLIST^RORRP010^4^R^^^1^1
"KRN",8994,1751,1,0)
^8994.01^2^2^3050217^^
"KRN",8994,1751,1,1,0)
The ROR TASK LIST remote procedure returns a list of user's tasks 
"KRN",8994,1751,1,2,0)
scheduled from the GUI.
"KRN",8994,1751,2,0)
^8994.02A^5^3
"KRN",8994,1751,2,1,0)
REGIEN^1^^^1
"KRN",8994,1751,2,1,1,0)
^^5^5^3030220^
"KRN",8994,1751,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the 
"KRN",8994,1751,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1). 
"KRN",8994,1751,2,1,1,3,0)
 
"KRN",8994,1751,2,1,1,4,0)
The tasks associated with the provided registry will be returned by the 
"KRN",8994,1751,2,1,1,5,0)
procere. By default ($G(REGIEN)'>0), all tasks are returned.
"KRN",8994,1751,2,2,0)
TYPE^1^^^2
"KRN",8994,1751,2,2,1,0)
^^4^4^3030220^
"KRN",8994,1751,2,2,1,1,0)
The TYPE parameter defines which tasks (1-Generic, 2-Report) are returned
"KRN",8994,1751,2,2,1,2,0)
by the procedure. See the description of the TYPE field (.02) of the ROR
"KRN",8994,1751,2,2,1,3,0)
TASK file (#798.8) for more details.  By default ($G(TYPE)'>0), all tasks 
"KRN",8994,1751,2,2,1,4,0)
are retrieved.
"KRN",8994,1751,2,5,0)
USER^1^^^3
"KRN",8994,1751,2,5,1,0)
^8994.021^3^3^3050217^^
"KRN",8994,1751,2,5,1,1,0)
A user IEN (DUZ) can be assigned to the USER parameter. Only tasks
"KRN",8994,1751,2,5,1,2,0)
scheduled by this user are retrieved by the procedure. By default 
"KRN",8994,1751,2,5,1,3,0)
($G(USER)'>0), it utilizes the current user's DUZ.
"KRN",8994,1751,2,"B","REGIEN",1)

"KRN",8994,1751,2,"B","TYPE",2)

"KRN",8994,1751,2,"B","USER",5)

"KRN",8994,1751,2,"PARAMSEQ",1,1)

"KRN",8994,1751,2,"PARAMSEQ",2,2)

"KRN",8994,1751,2,"PARAMSEQ",3,5)

"KRN",8994,1751,3,0)
^^49^49^3050217^
"KRN",8994,1751,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1751,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1751,3,3,0)
case, the second piece of the Results[0] will contain number of the error 
"KRN",8994,1751,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1751,3,5,0)
 
"KRN",8994,1751,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1751,3,7,0)
                          ^01: The last error code
"KRN",8994,1751,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1751,3,9,0)
  
"KRN",8994,1751,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1751,3,11,0)
                          ^01: Error code
"KRN",8994,1751,3,12,0)
                          ^02: Message
"KRN",8994,1751,3,13,0)
                          ^03: Place of the error
"KRN",8994,1751,3,14,0)
 
"KRN",8994,1751,3,15,0)
Otherwise, the task descriptors are returned in the RESULTS array (see the
"KRN",8994,1751,3,16,0)
ROR TASK INFO remote procedure for details).
"KRN",8994,1751,3,17,0)
 
"KRN",8994,1751,3,18,0)
  Results[0]            Result Descriptor
"KRN",8994,1751,3,19,0)
                          ^01: Number of task descriptors returned
"KRN",8994,1751,3,20,0)
                               in the Results array (NTSK)
"KRN",8994,1751,3,21,0)
                          ^02: Number of nodes that make a single
"KRN",8994,1751,3,22,0)
                               task descriptor (TIN)
"KRN",8994,1751,3,23,0)
 
"KRN",8994,1751,3,24,0)
  Results[i]            Value returned by the $$TASKINFO^RORTSK
"KRN",8994,1751,3,25,0)
                        function. You can calculate the subscript
"KRN",8994,1751,3,26,0)
                        of the item TI (from 1 to TIN) of the task
"KRN",8994,1751,3,27,0)
                        TN (from 1 to NTSK) using the following
"KRN",8994,1751,3,28,0)
                        formula: i = (TN-1)*TIN+TI.
"KRN",8994,1751,3,29,0)
 
"KRN",8994,1751,3,30,0)
For example, if number of nodes returned by the $$TASKINFO^RORTSK function
"KRN",8994,1751,3,31,0)
for each task is 13 and the RESULTS array contains information about 3
"KRN",8994,1751,3,32,0)
tasks, the following nodes will be defined:
"KRN",8994,1751,3,33,0)
 
"KRN",8994,1751,3,34,0)
  Results[0]  = "3^14"
"KRN",8994,1751,3,35,0)
 
"KRN",8994,1751,3,36,0)
  Results[1]  = Task Number 1
"KRN",8994,1751,3,37,0)
  Results[2]  = Task Type 1 (internal^external)
"KRN",8994,1751,3,38,0)
  ...
"KRN",8994,1751,3,39,0)
  Results[14] = User Comment 1
"KRN",8994,1751,3,40,0)
 
"KRN",8994,1751,3,41,0)
  Results[15] = Task Number 2
"KRN",8994,1751,3,42,0)
  Results[16] = Task Type 2 (internal^external)
"KRN",8994,1751,3,43,0)
  ...
"KRN",8994,1751,3,44,0)
  Results[28] = User Comment 2
"KRN",8994,1751,3,45,0)
 
"KRN",8994,1751,3,46,0)
  Results[29] = Task Number 3
"KRN",8994,1751,3,47,0)
  Results[30] = Task Type 3 (internal^external)
"KRN",8994,1751,3,48,0)
  ...
"KRN",8994,1751,3,49,0)
  Results[42] = User Comment 3
"KRN",8994,1779,-1)
0^19
"KRN",8994,1779,0)
ROR GUI ACCESS^ACREGLST^RORRP013^2^P^^^1^1
"KRN",8994,1779,1,0)
^8994.01^2^2^3050519^^^^
"KRN",8994,1779,1,1,0)
The ROR ACCESS remote procedure returns a list of registries that the 
"KRN",8994,1779,1,2,0)
user has access to (the user has appropriate security keys).
"KRN",8994,1779,2,0)
^8994.02A^1^1
"KRN",8994,1779,2,1,0)
USER^1^^^1
"KRN",8994,1779,2,1,1,0)
^8994.021^2^2^3050519^^^^
"KRN",8994,1779,2,1,1,1,0)
User IEN in the NEW PERSON file. By default (if $G(USER)'>0), the DUZ is
"KRN",8994,1779,2,1,1,2,0)
used).
"KRN",8994,1779,2,"B","USER",1)

"KRN",8994,1779,2,"PARAMSEQ",1,1)

"KRN",8994,1779,3,0)
^^27^27^3050519^
"KRN",8994,1779,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1779,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1779,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1779,3,4,0)
descriptors returned in the subsequent nodes of the Results array.
"KRN",8994,1779,3,5,0)
 
"KRN",8994,1779,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1779,3,7,0)
                          ^01: The last error code (LASTERR)
"KRN",8994,1779,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1779,3,9,0)
     
"KRN",8994,1779,3,10,0)
                                                                      
"KRN",8994,1779,3,11,0)
  Results[i]            Error Descriptor
"KRN",8994,1779,3,12,0)
                          ^01: Error code
"KRN",8994,1779,3,13,0)
                          ^02: Message
"KRN",8994,1779,3,14,0)
                          ^03: Place of the error
"KRN",8994,1779,3,15,0)
                                                                      
"KRN",8994,1779,3,16,0)
Error descriptors are returned in reverse chronological order (most recent
"KRN",8994,1779,3,17,0)
error first).                                                 
"KRN",8994,1779,3,18,0)
 
"KRN",8994,1779,3,19,0)
Otherwise, the Results[0] number of accessible registries.
"KRN",8994,1779,3,20,0)
 
"KRN",8994,1779,3,21,0)
  Results[0]            Number of Accessible Registries
"KRN",8994,1779,3,22,0)
 
"KRN",8994,1779,3,23,0)
  Results[i]            Registry Descriptor
"KRN",8994,1779,3,24,0)
                          ^01: Registry IEN
"KRN",8994,1779,3,25,0)
                          ^02: Registry name
"KRN",8994,1779,3,26,0)
                          ^03: Administrator? (0 or 1)
"KRN",8994,1779,3,27,0)
                          ^04: Registry description
"KRN",8994,1780,-1)
0^57
"KRN",8994,1780,0)
ROR TASK DELETE^DELTASK^RORRP010^1^R^^^^1
"KRN",8994,1780,1,0)
^8994.01^1^1^3031202^^
"KRN",8994,1780,1,1,0)
The ROR TASK DELETE remote procedure completely deletes the task.
"KRN",8994,1780,2,0)
^8994.02A^1^1
"KRN",8994,1780,2,1,0)
TASK^1^^1^1
"KRN",8994,1780,2,1,1,0)
^8994.021^1^1^3031202^^
"KRN",8994,1780,2,1,1,1,0)
A valid task number should be assigned to the TASK parameter.
"KRN",8994,1780,2,"B","TASK",1)

"KRN",8994,1780,2,"PARAMSEQ",1,1)

"KRN",8994,1780,3,0)
^8994.03^15^15^3031202^^
"KRN",8994,1780,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1780,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1780,3,3,0)
case, the second piece of the Results[0] will contain number of the error 
"KRN",8994,1780,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1780,3,5,0)
 
"KRN",8994,1780,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1780,3,7,0)
                          ^01: The last error code
"KRN",8994,1780,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1780,3,9,0)
  
"KRN",8994,1780,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1780,3,11,0)
                          ^01: Error code
"KRN",8994,1780,3,12,0)
                          ^02: Message
"KRN",8994,1780,3,13,0)
                          ^03: Place of the error
"KRN",8994,1780,3,14,0)
 
"KRN",8994,1780,3,15,0)
Otherwise, zero is returned in the Results[0].
"KRN",8994,1781,-1)
0^39
"KRN",8994,1781,0)
ROR LOG GET LIST^LOGLIST^RORRP007^4^R^^^1^1
"KRN",8994,1781,1,0)
^8994.01^2^2^3051104^^^^
"KRN",8994,1781,1,1,0)
The ROR LOG GET LIST remote procedure returns a list of logs associated 
"KRN",8994,1781,1,2,0)
with the registry in the provided time frame.
"KRN",8994,1781,2,0)
^8994.02A^3^3
"KRN",8994,1781,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1781,2,1,1,0)
^8994.021^4^4^3030128^^
"KRN",8994,1781,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,1781,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1781,2,1,1,3,0)
The output list will contain log activities associated with the registry
"KRN",8994,1781,2,1,1,4,0)
defined by this parameter.
"KRN",8994,1781,2,2,0)
STDT^1^^^2
"KRN",8994,1781,2,2,1,0)
^8994.021^3^3^3030128^^^
"KRN",8994,1781,2,2,1,1,0)
The STDT parameter defines the start date for the search of the log 
"KRN",8994,1781,2,2,1,2,0)
activities. By default (if $G(STDT)'>0), the search starts from the 
"KRN",8994,1781,2,2,1,3,0)
earliest record of the ROR LOG file.
"KRN",8994,1781,2,3,0)
ENDT^1^^^3
"KRN",8994,1781,2,3,1,0)
^8994.021^3^3^3051104^^^^
"KRN",8994,1781,2,3,1,1,0)
The ENDT parameter defines the end date for the search of the log
"KRN",8994,1781,2,3,1,2,0)
activities. By default (if $G(ENDT)'>0), the search continues to the last
"KRN",8994,1781,2,3,1,3,0)
record of the ROR LOG file.
"KRN",8994,1781,2,"B","ENDT",3)

"KRN",8994,1781,2,"B","REGIEN",1)

"KRN",8994,1781,2,"B","STDT",2)

"KRN",8994,1781,2,"PARAMSEQ",1,1)

"KRN",8994,1781,2,"PARAMSEQ",2,2)

"KRN",8994,1781,2,"PARAMSEQ",3,3)

"KRN",8994,1781,3,0)
^^42^42^3051104^
"KRN",8994,1781,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1781,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1781,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1781,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1781,3,5,0)
  
"KRN",8994,1781,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1781,3,7,0)
                          ^01: The last error code
"KRN",8994,1781,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1781,3,9,0)
                                                                      
"KRN",8994,1781,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1781,3,11,0)
                          ^01: Error code
"KRN",8994,1781,3,12,0)
                          ^02: Message
"KRN",8994,1781,3,13,0)
                          ^03: Place of the error
"KRN",8994,1781,3,14,0)
 
"KRN",8994,1781,3,15,0)
Otherwise, the number of logs is returned in the Results[0] and the
"KRN",8994,1781,3,16,0)
subsequent nodes of the Results array contain the information extracted
"KRN",8994,1781,3,17,0)
from the ROR LOG file:
"KRN",8994,1781,3,18,0)
 
"KRN",8994,1781,3,19,0)
  Results[0]            Number of Logs
"KRN",8994,1781,3,20,0)
 
"KRN",8994,1781,3,21,0)
  Results[i]            Log Descriptor
"KRN",8994,1781,3,22,0)
                          ^01: "L"
"KRN",8994,1781,3,23,0)
                          ^02: Log IEN
"KRN",8994,1781,3,24,0)
                          ^03: Activity (ext)
"KRN",8994,1781,3,25,0)
                          ^04: Activity (int)
"KRN",8994,1781,3,26,0)
                          ^05: Start Date/Time (ext)
"KRN",8994,1781,3,27,0)
                          ^06: Contains messages (0/1)
"KRN",8994,1781,3,28,0)
                          ^07: Job Number
"KRN",8994,1781,3,29,0)
                          ^08: End Date/Time (ext)
"KRN",8994,1781,3,30,0)
                          ^09: Number of Processed Patients
"KRN",8994,1781,3,31,0)
                          ^10: Number of Patients with Errors
"KRN",8994,1781,3,32,0)
                          ^11: Processing Rate
"KRN",8994,1781,3,33,0)
                          ^12: Task Number (optional)
"KRN",8994,1781,3,34,0)
 
"KRN",8994,1781,3,35,0)
  Results[...]          Registry Descriptor (optional)
"KRN",8994,1781,3,36,0)
                          ^01: "R"
"KRN",8994,1781,3,37,0)
                          ^02: Registry IEN
"KRN",8994,1781,3,38,0)
                          ^03: Registry Name
"KRN",8994,1781,3,39,0)
 
"KRN",8994,1781,3,40,0)
  Results[i+n]          'End of Log' Marker
"KRN",8994,1781,3,41,0)
                          ^01: "L"
"KRN",8994,1781,3,42,0)
                          ^02: "END"
"KRN",8994,1783,-1)
0^40
"KRN",8994,1783,0)
ROR LOG GET MESSAGES^MSGLIST^RORRP007^4^R^^^1^1
"KRN",8994,1783,1,0)
^8994.01^2^2^3030228^^^
"KRN",8994,1783,1,1,0)
The ROR LOG GET MESSAGES remote procedure returns a list of messages from
"KRN",8994,1783,1,2,0)
the log defined by the parameter.
"KRN",8994,1783,2,0)
^8994.02A^2^1
"KRN",8994,1783,2,2,0)
LOGIEN^1^^1^1
"KRN",8994,1783,2,2,1,0)
^^2^2^3030228^
"KRN",8994,1783,2,2,1,1,0)
The LOGIEN parameter defines the log. It should contain a valid IEN of the
"KRN",8994,1783,2,2,1,2,0)
log record in the ROR LOG file.
"KRN",8994,1783,2,"B","LOGIEN",2)

"KRN",8994,1783,2,"PARAMSEQ",1,2)

"KRN",8994,1783,3,0)
^^40^40^3030425^
"KRN",8994,1783,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1783,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1783,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1783,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1783,3,5,0)
   
"KRN",8994,1783,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1783,3,7,0)
                          ^01: The last error code
"KRN",8994,1783,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1783,3,9,0)
                                                                       
"KRN",8994,1783,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1783,3,11,0)
                          ^01: Error code
"KRN",8994,1783,3,12,0)
                          ^02: Message
"KRN",8994,1783,3,13,0)
                          ^03: Place of the error
"KRN",8994,1783,3,14,0)
 
"KRN",8994,1783,3,15,0)
Otherwise, the number of messages is returned in the Results[0] and the
"KRN",8994,1783,3,16,0)
subsequent nodes of the Results array contain the messages:
"KRN",8994,1783,3,17,0)
 
"KRN",8994,1783,3,18,0)
  Results[0]            Number of Messages
"KRN",8994,1783,3,19,0)
 
"KRN",8994,1783,3,20,0)
  Results[i]            Message Descriptor
"KRN",8994,1783,3,21,0)
                          ^01: "M"
"KRN",8994,1783,3,22,0)
                          ^02: Message IENS
"KRN",8994,1783,3,23,0)
                          ^03: Type (external)
"KRN",8994,1783,3,24,0)
                          ^04: Type (internal)
"KRN",8994,1783,3,25,0)
                          ^05: Date/Time (external)
"KRN",8994,1783,3,26,0)
                          ^06: Has Additional Info (0/1)
"KRN",8994,1783,3,27,0)
                          ^07: Patient Name
"KRN",8994,1783,3,28,0)
                          ^08: Patient IEN (DFN)
"KRN",8994,1783,3,29,0)
 
"KRN",8994,1783,3,30,0)
  Results[i+1]          Message
"KRN",8994,1783,3,31,0)
                          ^01: "T"
"KRN",8994,1783,3,32,0)
                          ^02: Message Text
"KRN",8994,1783,3,33,0)
 
"KRN",8994,1783,3,34,0)
  Results[...]          Line of the ADDITIONAL INFO Text
"KRN",8994,1783,3,35,0)
                          ^01: "A"
"KRN",8994,1783,3,36,0)
                          ^02: Text
"KRN",8994,1783,3,37,0)
                          
"KRN",8994,1783,3,38,0)
  Results[i+n]          'End of Message' Marker
"KRN",8994,1783,3,39,0)
                          ^01: "M"
"KRN",8994,1783,3,40,0)
                          ^02: "END"
"KRN",8994,1784,-1)
0^2
"KRN",8994,1784,0)
ROR GUI PARAMETER GET^GETPARM^RORRP038^2^R^^^1^1
"KRN",8994,1784,1,0)
^8994.01^2^2^3041028^^^^
"KRN",8994,1784,1,1,0)
The ROR GUI PARAMETER GET remote procedure retrieves the value of the GUI
"KRN",8994,1784,1,2,0)
parameter.
"KRN",8994,1784,2,0)
^8994.02A^2^2
"KRN",8994,1784,2,1,0)
INSTANCE^1^91^1^1
"KRN",8994,1784,2,1,1,0)
^^3^3^3041028^
"KRN",8994,1784,2,1,1,1,0)
The INSTANCE parameter defines the instance name of the GUI parameter. It 
"KRN",8994,1784,2,1,1,2,0)
can also contain the parameter name as the second "^"-piece (by default, 
"KRN",8994,1784,2,1,1,3,0)
the "ROR GUI PARAMETER" is used).
"KRN",8994,1784,2,2,0)
ENTITY^1^30^^2
"KRN",8994,1784,2,2,1,0)
^8994.021^4^4^3041028^^^^
"KRN",8994,1784,2,2,1,1,0)
The ENTITY parameter defines the area(s) where the parameter value is
"KRN",8994,1784,2,2,1,2,0)
searched for. By default ($G(ENTITY)=""), the "ALL" value is used (see the
"KRN",8994,1784,2,2,1,3,0)
DBIA #2263 for more details). The other values that are used most often
"KRN",8994,1784,2,2,1,4,0)
are the "USR" (user settings) and the "PKG" (package settings).
"KRN",8994,1784,2,"B","ENTITY",2)

"KRN",8994,1784,2,"B","INSTANCE",1)

"KRN",8994,1784,2,"PARAMSEQ",1,1)

"KRN",8994,1784,2,"PARAMSEQ",2,2)

"KRN",8994,1784,3,0)
^8994.03^23^23^3041028^^
"KRN",8994,1784,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1784,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1784,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1784,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1784,3,5,0)
   
"KRN",8994,1784,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1784,3,7,0)
                          ^01: The last error code
"KRN",8994,1784,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1784,3,9,0)
                                                                       
"KRN",8994,1784,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1784,3,11,0)
                          ^01: Error code
"KRN",8994,1784,3,12,0)
                          ^02: Message
"KRN",8994,1784,3,13,0)
                          ^03: Place of the error
"KRN",8994,1784,3,14,0)
 
"KRN",8994,1784,3,15,0)
Otherwise, the Results[0] contains 0 and the subsequent node(s) of the
"KRN",8994,1784,3,16,0)
Results array contain the string(s) of parameter value:
"KRN",8994,1784,3,17,0)
 
"KRN",8994,1784,3,18,0)
  Results[0]            0
"KRN",8994,1784,3,19,0)
 
"KRN",8994,1784,3,20,0)
  Results[1]            Value of the single-line parameter or
"KRN",8994,1784,3,21,0)
                        the first line of the text value
"KRN",8994,1784,3,22,0)
 
"KRN",8994,1784,3,23,0)
  Results[...]          Subsequent lines of the text value
"KRN",8994,1785,-1)
0^3
"KRN",8994,1785,0)
ROR GUI PARAMETER SET^SETPARM^RORRP038^1^R^^^^1
"KRN",8994,1785,1,0)
^8994.01^3^3^3041028^^^^
"KRN",8994,1785,1,1,0)
The ROR GUI PARAMETER SET remote procedure stores the parameter value and
"KRN",8994,1785,1,2,0)
associates it with the provided entity (see the DBIA #2263 for more 
"KRN",8994,1785,1,3,0)
details).
"KRN",8994,1785,2,0)
^8994.02A^3^3
"KRN",8994,1785,2,1,0)
INSTANCE^1^91^1^1
"KRN",8994,1785,2,1,1,0)
^^3^3^3041028^
"KRN",8994,1785,2,1,1,1,0)
The INSTANCE parameter defines the instance name of the GUI parameter. It 
"KRN",8994,1785,2,1,1,2,0)
can also contain the parameter name as the second "^"-piece (by default, 
"KRN",8994,1785,2,1,1,3,0)
the "ROR GUI PARAMETER" is used).
"KRN",8994,1785,2,2,0)
ENTITY^1^30^^2
"KRN",8994,1785,2,2,1,0)
^^4^4^3030129^
"KRN",8994,1785,2,2,1,1,0)
The ENTITY parameter defines the context that the parameter value is
"KRN",8994,1785,2,2,1,2,0)
associated with. By default ($G(ENTITY)=""), the "USR" (user settings)
"KRN",8994,1785,2,2,1,3,0)
value is used (see the DBIA #2263 for more details). The other value that
"KRN",8994,1785,2,2,1,4,0)
is used most often is the "PKG" (package settings).
"KRN",8994,1785,2,3,0)
VALUE^2^^^3
"KRN",8994,1785,2,3,1,0)
^8994.021^25^25^3041028^^^
"KRN",8994,1785,2,3,1,1,0)
The VALUE parameter defines the value of the GUI parameter. It should be
"KRN",8994,1785,2,3,1,2,0)
either a literal (string value) or a list (text value). You can use the 
"KRN",8994,1785,2,3,1,3,0)
"@" value to delete the parameter.
"KRN",8994,1785,2,3,1,4,0)
 
"KRN",8994,1785,2,3,1,5,0)
 NOTE: The list (the Mult property) should not contain
"KRN",8994,1785,2,3,1,6,0)
       the 0 subscript (it will not be stored).
"KRN",8994,1785,2,3,1,7,0)
 
"KRN",8994,1785,2,3,1,8,0)
Example #1 (string value):
"KRN",8994,1785,2,3,1,9,0)
 
"KRN",8994,1785,2,3,1,10,0)
  RPCBroker.Param[0].Value := 'MAIN FORM POS';
"KRN",8994,1785,2,3,1,11,0)
  RPCBroker.Param[0].PType := literal;
"KRN",8994,1785,2,3,1,12,0)
  RPCBroker.Param[1].Value := '';
"KRN",8994,1785,2,3,1,13,0)
  RPCBroker.Param[1].PType := literal;
"KRN",8994,1785,2,3,1,14,0)
  RPCBroker.Param[2].Value := '5,5,400,250';
"KRN",8994,1785,2,3,1,15,0)
  RPCBroker.Param[2].PType := literal;
"KRN",8994,1785,2,3,1,16,0)
 
"KRN",8994,1785,2,3,1,17,0)
Example #2 (text value):
"KRN",8994,1785,2,3,1,18,0)
 
"KRN",8994,1785,2,3,1,19,0)
  RPCBroker.Param[0].Value := 'COM PORT SETTINGS';
"KRN",8994,1785,2,3,1,20,0)
  RPCBroker.Param[0].PType := literal;
"KRN",8994,1785,2,3,1,21,0)
  RPCBroker.Param[1].Value := 'PKG';
"KRN",8994,1785,2,3,1,22,0)
  RPCBroker.Param[1].PType := literal;
"KRN",8994,1785,2,3,1,23,0)
  RPCBroker.Param[2].Mult[1] := 'Port=COM1';
"KRN",8994,1785,2,3,1,24,0)
  RPCBroker.Param[2].Mult[2] := 'Baud=19200';
"KRN",8994,1785,2,3,1,25,0)
  RPCBroker.Param[2].PType := list;
"KRN",8994,1785,2,"B","ENTITY",2)

"KRN",8994,1785,2,"B","INSTANCE",1)

"KRN",8994,1785,2,"B","VALUE",3)

"KRN",8994,1785,2,"PARAMSEQ",1,1)

"KRN",8994,1785,2,"PARAMSEQ",2,2)

"KRN",8994,1785,2,"PARAMSEQ",3,3)

"KRN",8994,1785,3,0)
^8994.03^15^15^3041028^^
"KRN",8994,1785,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1785,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1785,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1785,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1785,3,5,0)
   
"KRN",8994,1785,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1785,3,7,0)
                          ^01: The last error code
"KRN",8994,1785,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1785,3,9,0)
                                                                       
"KRN",8994,1785,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1785,3,11,0)
                          ^01: Error code
"KRN",8994,1785,3,12,0)
                          ^02: Message
"KRN",8994,1785,3,13,0)
                          ^03: Place of the error
"KRN",8994,1785,3,14,0)
 
"KRN",8994,1785,3,15,0)
Otherwise, the Results[0] contains 0.
"KRN",8994,1786,-1)
0^38
"KRN",8994,1786,0)
ROR LOG GET ACCESS VIOLATIONS^AVLIST^RORRP013^4^A^^^1^1
"KRN",8994,1786,1,0)
^8994.01^2^2^3030220^^^^
"KRN",8994,1786,1,1,0)
The ROR LOG GET ACCESS VIOLATIONS remote procedure returns the list of
"KRN",8994,1786,1,2,0)
access violation events recorded in the provided time frame.
"KRN",8994,1786,2,0)
^8994.02A^3^2
"KRN",8994,1786,2,2,0)
STDT^1^^^1
"KRN",8994,1786,2,2,1,0)
^^3^3^3030130^
"KRN",8994,1786,2,2,1,1,0)
The STDT parameter defines the start date for the search of the events. By
"KRN",8994,1786,2,2,1,2,0)
default (if $G(STDT)'>0), the search starts from the earliest record of
"KRN",8994,1786,2,2,1,3,0)
the ROR LOG file.
"KRN",8994,1786,2,3,0)
ENDT^1^^^2
"KRN",8994,1786,2,3,1,0)
^8994.021^3^3^3030220^^^^
"KRN",8994,1786,2,3,1,1,0)
The ENDT parameter defines the end date for the search of the events. By
"KRN",8994,1786,2,3,1,2,0)
default (if $G(ENDT)'>0), the search continues to the last record of the
"KRN",8994,1786,2,3,1,3,0)
ROR LOG file.
"KRN",8994,1786,2,"B","ENDT",3)

"KRN",8994,1786,2,"B","STDT",2)

"KRN",8994,1786,2,"PARAMSEQ",1,2)

"KRN",8994,1786,2,"PARAMSEQ",2,3)

"KRN",8994,1786,3,0)
^^24^24^3030425^
"KRN",8994,1786,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1786,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1786,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1786,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1786,3,5,0)
    
"KRN",8994,1786,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1786,3,7,0)
                          ^01: The last error code
"KRN",8994,1786,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1786,3,9,0)
                                                                       
"KRN",8994,1786,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1786,3,11,0)
                          ^01: Error code
"KRN",8994,1786,3,12,0)
                          ^02: Message
"KRN",8994,1786,3,13,0)
                          ^03: Place of the error
"KRN",8994,1786,3,14,0)
  
"KRN",8994,1786,3,15,0)
Otherwise, the Results[0] contains number of access violation events and
"KRN",8994,1786,3,16,0)
the subsequent node(s) of the Results array contain the event descriptors:
"KRN",8994,1786,3,17,0)
 
"KRN",8994,1786,3,18,0)
  Results[0]            Number of Access Violations
"KRN",8994,1786,3,19,0)
 
"KRN",8994,1786,3,20,0)
  Results[i]            Access Violation Descriptor
"KRN",8994,1786,3,21,0)
                          ^01: Date/Time (internal)
"KRN",8994,1786,3,22,0)
                          ^02: User Name
"KRN",8994,1786,3,23,0)
                          ^03: User IEN
"KRN",8994,1786,3,24,0)
                          ^04: Message
"KRN",8994,1787,-1)
0^34
"KRN",8994,1787,0)
ROR LIST REGISTRY USERS^USERLIST^RORRP013^4^P^^^1^1
"KRN",8994,1787,1,0)
^8994.01^2^2^3030219^^^
"KRN",8994,1787,1,1,0)
The ROR GET REGISTRY USERS remote procedure returns the list of registry 
"KRN",8994,1787,1,2,0)
users (VistA users who have the appropriate security keys).
"KRN",8994,1787,2,0)
^8994.02A^1^1
"KRN",8994,1787,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1787,2,1,1,0)
^8994.021^2^2^3030219^^^
"KRN",8994,1787,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,1787,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1787,2,"B","REGIEN",1)

"KRN",8994,1787,2,"PARAMSEQ",1,1)

"KRN",8994,1787,3,0)
^^25^25^3030425^
"KRN",8994,1787,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1787,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1787,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1787,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1787,3,5,0)
   
"KRN",8994,1787,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1787,3,7,0)
                          ^01: The last error code
"KRN",8994,1787,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1787,3,9,0)
                                                                       
"KRN",8994,1787,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1787,3,11,0)
                          ^01: Error code
"KRN",8994,1787,3,12,0)
                          ^02: Message
"KRN",8994,1787,3,13,0)
                          ^03: Place of the error
"KRN",8994,1787,3,14,0)
 
"KRN",8994,1787,3,15,0)
Otherwise, the number of users is returned in the Results[0] and the
"KRN",8994,1787,3,16,0)
subsequent nodes of the Results array contain the user descriptors:
"KRN",8994,1787,3,17,0)
 
"KRN",8994,1787,3,18,0)
  Results[0]            Number of Users
"KRN",8994,1787,3,19,0)
 
"KRN",8994,1787,3,20,0)
  Results[i]            User Descriptor
"KRN",8994,1787,3,21,0)
                          ^01: User IEN (DUZ)
"KRN",8994,1787,3,22,0)
                          ^02: User Name
"KRN",8994,1787,3,23,0)
                          ^03: User          (0/1)
"KRN",8994,1787,3,24,0)
                          ^04: Administrator (0/1)
"KRN",8994,1787,3,25,0)
                          ^05: IRM           (0/1)
"KRN",8994,1788,-1)
0^14
"KRN",8994,1788,0)
ROR GET REGISTRY INFO^REGINFO^RORRP014^2^P^^^1^1
"KRN",8994,1788,1,0)
^8994.01^2^2^3050517^^^
"KRN",8994,1788,1,1,0)
The ROR GET REGISTRY INFO remote procedure returns basic information about
"KRN",8994,1788,1,2,0)
the registry.
"KRN",8994,1788,2,0)
^8994.02A^1^1
"KRN",8994,1788,2,1,0)
REGISTRY^1^^1^1
"KRN",8994,1788,2,1,1,0)
^8994.021^2^2^3050517^^^^
"KRN",8994,1788,2,1,1,1,0)
The REGISTRY parameter should contain either a registry IEN or a registry 
"KRN",8994,1788,2,1,1,2,0)
name.
"KRN",8994,1788,2,"B","REGISTRY",1)

"KRN",8994,1788,2,"PARAMSEQ",1,1)

"KRN",8994,1788,3,0)
^^45^45^3050517^
"KRN",8994,1788,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1788,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1788,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1788,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1788,3,5,0)
 
"KRN",8994,1788,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1788,3,7,0)
                          ^01: The last error code
"KRN",8994,1788,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1788,3,9,0)
 
"KRN",8994,1788,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1788,3,11,0)
                          ^01: Error code
"KRN",8994,1788,3,12,0)
                          ^02: Message
"KRN",8994,1788,3,13,0)
                          ^03: Place of the error
"KRN",8994,1788,3,14,0)
 
"KRN",8994,1788,3,15,0)
Otherwise, zero is returned in the Results[0] and the subsequent nodes of 
"KRN",8994,1788,3,16,0)
the Results array contain the registry information:
"KRN",8994,1788,3,17,0)
 
"KRN",8994,1788,3,18,0)
  Results[0]            0
"KRN",8994,1788,3,19,0)
 
"KRN",8994,1788,3,20,0)
  Results[1]            Registry
"KRN",8994,1788,3,21,0)
                          ^01: IEN
"KRN",8994,1788,3,22,0)
                          ^02: Name
"KRN",8994,1788,3,23,0)
 
"KRN",8994,1788,3,24,0)
  Results[2]            National (0/1)
"KRN",8994,1788,3,25,0)
 
"KRN",8994,1788,3,26,0)
  Results[3]            Registry Description
"KRN",8994,1788,3,27,0)
 
"KRN",8994,1788,3,28,0)
  Results[4]            Last Registry Update Date (FileMan)
"KRN",8994,1788,3,29,0)
 
"KRN",8994,1788,3,30,0)
  Results[5]            Last Data Extraction Date (FileMan)
"KRN",8994,1788,3,31,0)
 
"KRN",8994,1788,3,32,0)
  Results[6]            Number of Patients
"KRN",8994,1788,3,33,0)
 
"KRN",8994,1788,3,34,0)
  Results[7]            Number of Active Patients
"KRN",8994,1788,3,35,0)
 
"KRN",8994,1788,3,36,0)
  Results[8]            Registry Status
"KRN",8994,1788,3,37,0)
                          ^01: Internal value (0-Active, 1-Inactive)
"KRN",8994,1788,3,38,0)
                          ^02: External value
"KRN",8994,1788,3,39,0)
 
"KRN",8994,1788,3,40,0)
  Results[9]            reserved (former Awaiting Acknowledgement)
"KRN",8994,1788,3,41,0)
 
"KRN",8994,1788,3,42,0)
  Results[10]           Version Information
"KRN",8994,1788,3,43,0)
                          ^01: Package version
"KRN",8994,1788,3,44,0)
                          ^02: Latest patch number
"KRN",8994,1788,3,45,0)
                          ^03: Date of the latest patch (FileMan)
"KRN",8994,1789,-1)
0^54
"KRN",8994,1789,0)
ROR REPORTS AVAILABLE^RPAVAIL^RORRP011^2^R^^^1^1
"KRN",8994,1789,1,0)
^8994.01^2^2^3031103^^^^
"KRN",8994,1789,1,1,0)
The ROR REPORTS AVAILABLE remote procedure returns a list of reports (and 
"KRN",8994,1789,1,2,0)
their parameters) available for the registry.
"KRN",8994,1789,2,0)
^8994.02A^1^1
"KRN",8994,1789,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1789,2,1,1,0)
^8994.021^4^4^3031103^^^^
"KRN",8994,1789,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,1789,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1789,2,1,1,3,0)
The output list will contain reports available for the registry defined by
"KRN",8994,1789,2,1,1,4,0)
this parameter.
"KRN",8994,1789,2,"B","REGIEN",1)

"KRN",8994,1789,2,"PARAMSEQ",1,1)

"KRN",8994,1789,3,0)
^^45^45^3031103^
"KRN",8994,1789,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1789,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1789,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1789,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1789,3,5,0)
   
"KRN",8994,1789,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1789,3,7,0)
                          ^01: The last error code
"KRN",8994,1789,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1789,3,9,0)
                                                                       
"KRN",8994,1789,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1789,3,11,0)
                          ^01: Error code
"KRN",8994,1789,3,12,0)
                          ^02: Message
"KRN",8994,1789,3,13,0)
                          ^03: Place of the error
"KRN",8994,1789,3,14,0)
 
"KRN",8994,1789,3,15,0)
Otherwise, number of reports and number of nodes in each report descriptor
"KRN",8994,1789,3,16,0)
are returned in the Results[0] and the subsequent nodes of the Results
"KRN",8994,1789,3,17,0)
array contain the report parameters extracted from the ROR REPORT
"KRN",8994,1789,3,18,0)
PARAMETERS file (#799.12).
"KRN",8994,1789,3,19,0)
 
"KRN",8994,1789,3,20,0)
  Results[0]            Result Descriptor
"KRN",8994,1789,3,21,0)
                          ^01: Number of report descriptors returned
"KRN",8994,1789,3,22,0)
                               in the Results array (NREP)
"KRN",8994,1789,3,23,0)
                          ^02: Number of nodes that make a single
"KRN",8994,1789,3,24,0)
                               report descriptor (RPN)
"KRN",8994,1789,3,25,0)
 
"KRN",8994,1789,3,26,0)
  Results[1]            Report Name
"KRN",8994,1789,3,27,0)
  Results[2]            Background Processing (0/1)
"KRN",8994,1789,3,28,0)
  Results[3]            reserved
"KRN",8994,1789,3,29,0)
  Results[4]            Report Code
"KRN",8994,1789,3,30,0)
  Results[5]            Report Parameters IEN
"KRN",8994,1789,3,31,0)
  Results[6]            Inactivation Date (FileMan)
"KRN",8994,1789,3,32,0)
  Results[7]            National (0/1)
"KRN",8994,1789,3,33,0)
  Results[8]            List of parameter panels
"KRN",8994,1789,3,34,0)
  Results[9]            Report Builder ($$TAG^ROUTINE)
"KRN",8994,1789,3,35,0)
  Results[10]           Default parameters (NAME=VALUE),
"KRN",8994,1789,3,36,0)
                        separated by '<*>'
"KRN",8994,1789,3,37,0)
  Results[11]           Default sorting modes (TABLE=FIELD),
"KRN",8994,1789,3,38,0)
                        separated by '<*>'
"KRN",8994,1789,3,39,0)
                        
"KRN",8994,1789,3,40,0)
  Results[12]           Report Name
"KRN",8994,1789,3,41,0)
  Results[13]           Background Processing (0/1)
"KRN",8994,1789,3,42,0)
  ...
"KRN",8994,1789,3,43,0)
 
"KRN",8994,1789,3,44,0)
You can calculate the subscript of the item RI (from 1 to RPN) of the
"KRN",8994,1789,3,45,0)
report RN (from 1 to NREP) using the following formula: i = (RN-1)*RPN+RI.
"KRN",8994,1793,-1)
0^24
"KRN",8994,1793,0)
ROR LIST DIVISIONS^DIVLIST^RORRP015^4^R^^^1^1
"KRN",8994,1793,1,0)
^8994.01^2^2^3030226^^^
"KRN",8994,1793,1,1,0)
The ROR LIST DIVISIONS remote procedure returns a list of divisions 
"KRN",8994,1793,1,2,0)
defined in the MEDICAL CENTER DIVISION file (#40.8).
"KRN",8994,1793,2,0)
^8994.02A^4^4
"KRN",8994,1793,2,1,0)
PART^1^30^^1
"KRN",8994,1793,2,1,1,0)
^^1^1^3030225^
"KRN",8994,1793,2,1,1,1,0)
The partial match restriction.
"KRN",8994,1793,2,2,0)
FLAGS^1^^^2
"KRN",8994,1793,2,2,1,0)
^^4^4^3030225^
"KRN",8994,1793,2,2,1,1,0)
Flags that control the execution (can be combined):
"KRN",8994,1793,2,2,1,2,0)
 
"KRN",8994,1793,2,2,1,3,0)
  B  Backwards. Traverses the index in the opposite
"KRN",8994,1793,2,2,1,4,0)
     direction of normal traversal.
"KRN",8994,1793,2,3,0)
NUMBER^1^^^3
"KRN",8994,1793,2,3,1,0)
^^2^2^3030225^
"KRN",8994,1793,2,3,1,1,0)
Maximum number of entries to return. A value of "*" or no value in this 
"KRN",8994,1793,2,3,1,2,0)
parameter designates all entries.
"KRN",8994,1793,2,4,0)
FROM^1^^^4
"KRN",8994,1793,2,4,1,0)
^^13^13^3030226^
"KRN",8994,1793,2,4,1,1,0)
The index entry(s) from which to begin the list
"KRN",8994,1793,2,4,1,2,0)
  ^01: FromName
"KRN",8994,1793,2,4,1,3,0)
  ^02: FromIEN
"KRN",8994,1793,2,4,1,4,0)
 
"KRN",8994,1793,2,4,1,5,0)
For example, a FROM value of "VA" would list entries following VA. You can
"KRN",8994,1793,2,4,1,6,0)
use the 2-nd and 3-rd "^"- pieces of the @RESULTS@(0) node to continue the
"KRN",8994,1793,2,4,1,7,0)
listing in the subsequent procedure calls.
"KRN",8994,1793,2,4,1,8,0)
 
"KRN",8994,1793,2,4,1,9,0)
NOTE: The FROM value itself is not included in the
"KRN",8994,1793,2,4,1,10,0)
      resulting list.
"KRN",8994,1793,2,4,1,11,0)
 
"KRN",8994,1793,2,4,1,12,0)
See description of the LIST^DIC for more details about the PART, NUMBER
"KRN",8994,1793,2,4,1,13,0)
and FROM parameters.
"KRN",8994,1793,2,"B","FLAGS",2)

"KRN",8994,1793,2,"B","FROM",4)

"KRN",8994,1793,2,"B","NUMBER",3)

"KRN",8994,1793,2,"B","PART",1)

"KRN",8994,1793,2,"PARAMSEQ",1,1)

"KRN",8994,1793,2,"PARAMSEQ",2,2)

"KRN",8994,1793,2,"PARAMSEQ",3,3)

"KRN",8994,1793,2,"PARAMSEQ",4,4)

"KRN",8994,1793,3,0)
^^53^53^3030425^
"KRN",8994,1793,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1793,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1793,3,3,0)
case, the second piece of the Results[0] will contain number of the error 
"KRN",8994,1793,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1793,3,5,0)
  
"KRN",8994,1793,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1793,3,7,0)
                          ^01: The last error code
"KRN",8994,1793,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1793,3,9,0)
   
"KRN",8994,1793,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1793,3,11,0)
                          ^01: Error code
"KRN",8994,1793,3,12,0)
                          ^02: Message
"KRN",8994,1793,3,13,0)
                          ^03: Place of the error
"KRN",8994,1793,3,14,0)
 
"KRN",8994,1793,3,15,0)
Otherwise, number of divisions and the value of the FROM parameter for the
"KRN",8994,1793,3,16,0)
next procedure call are returned in the Results[0] and the subsequent
"KRN",8994,1793,3,17,0)
nodes of the global array contain the divisions.
"KRN",8994,1793,3,18,0)
 
"KRN",8994,1793,3,19,0)
  Results[0]          Result Descriptor
"KRN",8994,1793,3,20,0)
                        ^01: Number of divisions
"KRN",8994,1793,3,21,0)
                        ^02: FromName
"KRN",8994,1793,3,22,0)
                        ^03: FromIEN
"KRN",8994,1793,3,23,0)
 
"KRN",8994,1793,3,24,0)
  Results[i]          Division
"KRN",8994,1793,3,25,0)
                        ^01: IEN
"KRN",8994,1793,3,26,0)
                        ^02: Name
"KRN",8994,1793,3,27,0)
                        ^03: Facility Number
"KRN",8994,1793,3,28,0)
                        ^04: Institution IEN
"KRN",8994,1793,3,29,0)
 
"KRN",8994,1793,3,30,0)
Example:
"KRN",8994,1793,3,31,0)
 
"KRN",8994,1793,3,32,0)
  // Get the list of divisions (10 items at a time), which
"KRN",8994,1793,3,33,0)
  // names start with the 'S'
"KRN",8994,1793,3,34,0)
 
"KRN",8994,1793,3,35,0)
  repeat
"KRN",8994,1793,3,36,0)
    with RPCBroker do
"KRN",8994,1793,3,37,0)
      begin
"KRN",8994,1793,3,38,0)
        Param[0].Value := 'S';
"KRN",8994,1793,3,39,0)
        Param[0].PType := literal;
"KRN",8994,1793,3,40,0)
        Param[1].Value := '';
"KRN",8994,1793,3,41,0)
        Param[1].PType := literal;
"KRN",8994,1793,3,42,0)
        Param[2].Value := '10';
"KRN",8994,1793,3,43,0)
        Param[2].PType := literal;
"KRN",8994,1793,3,44,0)
        Param[3].Value := Piece(Results[0],'^',2,3);
"KRN",8994,1793,3,45,0)
        Param[3].PType := literal;
"KRN",8994,1793,3,46,0)
        Call;
"KRN",8994,1793,3,47,0)
      end;
"KRN",8994,1793,3,48,0)
 
"KRN",8994,1793,3,49,0)
    n := StrToIntDef(Piece(Results[0],'^'), 0);
"KRN",8994,1793,3,50,0)
    for i:=1 to n do
"KRN",8994,1793,3,51,0)
      // Process the division record (Results[i])
"KRN",8994,1793,3,52,0)
      ...
"KRN",8994,1793,3,53,0)
  until Piece(Results[0],'^',2) = '';
"KRN",8994,1794,-1)
0^27
"KRN",8994,1794,0)
ROR LIST HOSPITAL LOCATIONS^HLOCLIST^RORRP015^4^R^^^1^1
"KRN",8994,1794,1,0)
^8994.01^3^3^3041022^^^
"KRN",8994,1794,1,1,0)
The ROR LIST HOSPITAL LOCATIONS remote procedure returns a list of 
"KRN",8994,1794,1,2,0)
hospital locations (defined in the HOSPITAL LOCATION file), which conform
"KRN",8994,1794,1,3,0)
the criteria.
"KRN",8994,1794,2,0)
^8994.02A^6^6
"KRN",8994,1794,2,1,0)
PART^1^30^^3
"KRN",8994,1794,2,1,1,0)
^8994.021^1^1^3030226^^
"KRN",8994,1794,2,1,1,1,0)
The partial match restriction.
"KRN",8994,1794,2,2,0)
FLAGS^1^^^4
"KRN",8994,1794,2,2,1,0)
^^8^8^3030226^
"KRN",8994,1794,2,2,1,1,0)
Flags that control the execution (can be combined):
"KRN",8994,1794,2,2,1,2,0)
 
"KRN",8994,1794,2,2,1,3,0)
  A  Include active locations (default)
"KRN",8994,1794,2,2,1,4,0)
 
"KRN",8994,1794,2,2,1,5,0)
  B  Backwards. Traverses the index in the opposite
"KRN",8994,1794,2,2,1,6,0)
     direction of normal traversal.
"KRN",8994,1794,2,2,1,7,0)
 
"KRN",8994,1794,2,2,1,8,0)
  I  Include inactive locations
"KRN",8994,1794,2,3,0)
NUMBER^1^^^5
"KRN",8994,1794,2,3,1,0)
^8994.021^2^2^3030226^^
"KRN",8994,1794,2,3,1,1,0)
Maximum number of entries to return. A value of "*" or no value in this 
"KRN",8994,1794,2,3,1,2,0)
parameter designates all entries.
"KRN",8994,1794,2,4,0)
FROM^1^^^6
"KRN",8994,1794,2,4,1,0)
^^13^13^3030226^
"KRN",8994,1794,2,4,1,1,0)
The index entry(s) from which to begin the list
"KRN",8994,1794,2,4,1,2,0)
  ^01: FromName
"KRN",8994,1794,2,4,1,3,0)
  ^02: FromIEN
"KRN",8994,1794,2,4,1,4,0)
 
"KRN",8994,1794,2,4,1,5,0)
For example, a FROM value of "VA" would list entries following VA. You can
"KRN",8994,1794,2,4,1,6,0)
use the 2-nd and 3-rd "^"- pieces of the @RESULTS@(0) node to continue the
"KRN",8994,1794,2,4,1,7,0)
listing in the subsequent procedure calls.
"KRN",8994,1794,2,4,1,8,0)
 
"KRN",8994,1794,2,4,1,9,0)
NOTE: The FROM value itself is not included in the
"KRN",8994,1794,2,4,1,10,0)
      resulting list.
"KRN",8994,1794,2,4,1,11,0)
 
"KRN",8994,1794,2,4,1,12,0)
See description of the LIST^DIC for more details about the PART, NUMBER
"KRN",8994,1794,2,4,1,13,0)
and FROM parameters.
"KRN",8994,1794,2,5,0)
HLTYPES^1^^^1
"KRN",8994,1794,2,5,1,0)
^8994.021^14^14^3030226^^
"KRN",8994,1794,2,5,1,1,0)
List of location types separated by commas (internal values of the TYPE
"KRN",8994,1794,2,5,1,2,0)
field of the HOSPITAL LOCATION file):
"KRN",8994,1794,2,5,1,3,0)
 
"KRN",8994,1794,2,5,1,4,0)
  C   Clinic
"KRN",8994,1794,2,5,1,5,0)
  F   File Area
"KRN",8994,1794,2,5,1,6,0)
  I   Imaging
"KRN",8994,1794,2,5,1,7,0)
  M   Module
"KRN",8994,1794,2,5,1,8,0)
  N   Non-Clinic Stop
"KRN",8994,1794,2,5,1,9,0)
  OR  Operating Room
"KRN",8994,1794,2,5,1,10,0)
  W   Ward
"KRN",8994,1794,2,5,1,11,0)
  Z   Other Location
"KRN",8994,1794,2,5,1,12,0)
 
"KRN",8994,1794,2,5,1,13,0)
Only locations of the types defined by this parameter are selected by the 
"KRN",8994,1794,2,5,1,14,0)
remote procedure. By default ($G(HLTYPES)=""), all locations are selected.
"KRN",8994,1794,2,6,0)
DIVIEN^1^^^2
"KRN",8994,1794,2,6,1,0)
^8994.021^2^2^3041022^^^^
"KRN",8994,1794,2,6,1,1,0)
Division IEN. If this parameter is defined and greater than zero then only
"KRN",8994,1794,2,6,1,2,0)
the locations associated with this division are selected.
"KRN",8994,1794,2,"B","DIVIEN",6)

"KRN",8994,1794,2,"B","FLAGS",2)

"KRN",8994,1794,2,"B","FROM",4)

"KRN",8994,1794,2,"B","HLTYPES",5)

"KRN",8994,1794,2,"B","NUMBER",3)

"KRN",8994,1794,2,"B","PART",1)

"KRN",8994,1794,2,"PARAMSEQ",1,5)

"KRN",8994,1794,2,"PARAMSEQ",2,6)

"KRN",8994,1794,2,"PARAMSEQ",3,1)

"KRN",8994,1794,2,"PARAMSEQ",4,2)

"KRN",8994,1794,2,"PARAMSEQ",5,3)

"KRN",8994,1794,2,"PARAMSEQ",6,4)

"KRN",8994,1794,3,0)
^8994.03^33^33^3041022^^
"KRN",8994,1794,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1794,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1794,3,3,0)
case, the second piece of the Results[0] will contain number of the error 
"KRN",8994,1794,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1794,3,5,0)
  
"KRN",8994,1794,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1794,3,7,0)
                          ^01: The last error code
"KRN",8994,1794,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1794,3,9,0)
   
"KRN",8994,1794,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1794,3,11,0)
                          ^01: Error code
"KRN",8994,1794,3,12,0)
                          ^02: Message
"KRN",8994,1794,3,13,0)
                          ^03: Place of the error
"KRN",8994,1794,3,14,0)
 
"KRN",8994,1794,3,15,0)
Otherwise, number of hospital locations and the value of the FROM
"KRN",8994,1794,3,16,0)
parameter for the next procedure call are returned in the Results[0] and
"KRN",8994,1794,3,17,0)
the subsequent nodes of the global array contain the locations.
"KRN",8994,1794,3,18,0)
 
"KRN",8994,1794,3,19,0)
  Results[0]          Result Descriptor
"KRN",8994,1794,3,20,0)
                        ^01: Number of locations
"KRN",8994,1794,3,21,0)
                        ^02: FromName
"KRN",8994,1794,3,22,0)
                        ^03: FromIEN
"KRN",8994,1794,3,23,0)
 
"KRN",8994,1794,3,24,0)
  Results[i]          Hospital Location
"KRN",8994,1794,3,25,0)
                        ^01: IEN
"KRN",8994,1794,3,26,0)
                        ^02: Name
"KRN",8994,1794,3,27,0)
                        ^03: Location Type (internal)
"KRN",8994,1794,3,28,0)
                        ^04: Institution IEN
"KRN",8994,1794,3,29,0)
                        ^05: Division IEN
"KRN",8994,1794,3,30,0)
                        ^06: Active (0/1)
"KRN",8994,1794,3,31,0)
 
"KRN",8994,1794,3,32,0)
NOTE: The 6th "^"-piece of the location record (Active) is
"KRN",8994,1794,3,33,0)
      populated only if both "A" and "I" flags are used.
"KRN",8994,1795,-1)
0^28
"KRN",8994,1795,0)
ROR LIST ICD-9^ICD9LIST^RORRP016^4^R^^^1^1
"KRN",8994,1795,1,0)
^8994.01^2^2^3051107^^^^
"KRN",8994,1795,1,1,0)
The ROR LIST ICD-9 remote procedure returns a list of ICD-9 codes (defined
"KRN",8994,1795,1,2,0)
in the ICD DIAGNOSIS file), which conform the criteria.
"KRN",8994,1795,2,0)
^8994.02A^5^5
"KRN",8994,1795,2,1,0)
PART^1^30^^2
"KRN",8994,1795,2,1,1,0)
^8994.021^1^1^3050907^^
"KRN",8994,1795,2,1,1,1,0)
The partial match restriction.
"KRN",8994,1795,2,2,0)
FLAGS^1^^^3
"KRN",8994,1795,2,2,1,0)
^^19^19^3051107^
"KRN",8994,1795,2,2,1,1,0)
Flags that control the execution (can be combined):
"KRN",8994,1795,2,2,1,2,0)
 
"KRN",8994,1795,2,2,1,3,0)
  A  Exclude active codes
"KRN",8994,1795,2,2,1,4,0)
 
"KRN",8994,1795,2,2,1,5,0)
  B  Backwards. Traverses the index in the opposite
"KRN",8994,1795,2,2,1,6,0)
     direction of normal traversal
"KRN",8994,1795,2,2,1,7,0)
 
"KRN",8994,1795,2,2,1,8,0)
  D  Full search by description
"KRN",8994,1795,2,2,1,9,0)
 
"KRN",8994,1795,2,2,1,10,0)
  F  Exclude codes applicable to females only
"KRN",8994,1795,2,2,1,11,0)
 
"KRN",8994,1795,2,2,1,12,0)
  I  Exclude inactive codes
"KRN",8994,1795,2,2,1,13,0)
 
"KRN",8994,1795,2,2,1,14,0)
  K Search in description keywords
"KRN",8994,1795,2,2,1,15,0)
 
"KRN",8994,1795,2,2,1,16,0)
  M  Exclude codes applicable to males only
"KRN",8994,1795,2,2,1,17,0)
 
"KRN",8994,1795,2,2,1,18,0)
  P  Exclude codes that are not acceptable
"KRN",8994,1795,2,2,1,19,0)
     as primary diagnoses
"KRN",8994,1795,2,3,0)
NUMBER^1^^^4
"KRN",8994,1795,2,3,1,0)
^8994.021^2^2^3050907^^
"KRN",8994,1795,2,3,1,1,0)
Maximum number of entries to return. A value of "*" or no value in this 
"KRN",8994,1795,2,3,1,2,0)
parameter designates all entries.
"KRN",8994,1795,2,4,0)
FROM^1^^^5
"KRN",8994,1795,2,4,1,0)
^8994.021^13^13^3050907^^^^
"KRN",8994,1795,2,4,1,1,0)
The index entry(s) from which to begin the list
"KRN",8994,1795,2,4,1,2,0)
   ^01: FromName
"KRN",8994,1795,2,4,1,3,0)
   ^02: FromIEN
"KRN",8994,1795,2,4,1,4,0)
  
"KRN",8994,1795,2,4,1,5,0)
For example, a FROM value of "18" would list entries following 18. You can
"KRN",8994,1795,2,4,1,6,0)
use the 2-nd and 3-rd "^"- pieces of the Results[0] to continue the
"KRN",8994,1795,2,4,1,7,0)
listing in the subsequent procedure calls.
"KRN",8994,1795,2,4,1,8,0)
  
"KRN",8994,1795,2,4,1,9,0)
NOTE: The FROM value itself is not included in the
"KRN",8994,1795,2,4,1,10,0)
      resulting list.
"KRN",8994,1795,2,4,1,11,0)
  
"KRN",8994,1795,2,4,1,12,0)
See description of the LIST^DIC for more details about the PART, NUMBER 
"KRN",8994,1795,2,4,1,13,0)
and FROM parameters.
"KRN",8994,1795,2,5,0)
DATE^1^^^1
"KRN",8994,1795,2,5,1,0)
^8994.021^1^1^3051107^^
"KRN",8994,1795,2,5,1,1,0)
Date for the code set versioning.
"KRN",8994,1795,2,"B","DATE",5)

"KRN",8994,1795,2,"B","FLAGS",2)

"KRN",8994,1795,2,"B","FROM",4)

"KRN",8994,1795,2,"B","NUMBER",3)

"KRN",8994,1795,2,"B","PART",1)

"KRN",8994,1795,2,"PARAMSEQ",1,5)

"KRN",8994,1795,2,"PARAMSEQ",2,1)

"KRN",8994,1795,2,"PARAMSEQ",3,2)

"KRN",8994,1795,2,"PARAMSEQ",4,3)

"KRN",8994,1795,2,"PARAMSEQ",5,4)

"KRN",8994,1795,3,0)
^8994.03^32^32^3051107^^
"KRN",8994,1795,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1795,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1795,3,3,0)
case, the second piece of the Results[0] will contain number of the error 
"KRN",8994,1795,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1795,3,5,0)
  
"KRN",8994,1795,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1795,3,7,0)
                          ^01: The last error code
"KRN",8994,1795,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1795,3,9,0)
   
"KRN",8994,1795,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1795,3,11,0)
                          ^01: Error code
"KRN",8994,1795,3,12,0)
                          ^02: Message
"KRN",8994,1795,3,13,0)
                          ^03: Place of the error
"KRN",8994,1795,3,14,0)
 
"KRN",8994,1795,3,15,0)
Otherwise, number of ICD-9 codes and the value of the FROM parameter for
"KRN",8994,1795,3,16,0)
the next procedure call are returned in the Results[0] and the subsequent
"KRN",8994,1795,3,17,0)
nodes of the global array contain the codes.
"KRN",8994,1795,3,18,0)
  
"KRN",8994,1795,3,19,0)
  Results[0]          Result Descriptor
"KRN",8994,1795,3,20,0)
                        ^01: Number of codes
"KRN",8994,1795,3,21,0)
                        ^02: FromName
"KRN",8994,1795,3,22,0)
                        ^03: FromIEN
"KRN",8994,1795,3,23,0)
 
"KRN",8994,1795,3,24,0)
  Results[i]          ICD-9
"KRN",8994,1795,3,25,0)
                        ^01: IEN
"KRN",8994,1795,3,26,0)
                        ^02: Diagnosis
"KRN",8994,1795,3,27,0)
                        ^03: Code
"KRN",8994,1795,3,28,0)
                        ^04: Use only with Sex
"KRN",8994,1795,3,29,0)
                        ^05: Inactive (""/1)
"KRN",8994,1795,3,30,0)
                        ^06: Inactivation Date (FileMan)
"KRN",8994,1795,3,31,0)
 
"KRN",8994,1795,3,32,0)
  Results[i+1]        ICD-9 Description
"KRN",8994,1796,-1)
0^36
"KRN",8994,1796,0)
ROR LIST VA DRUG CLASSES^VACLSLST^RORRP017^4^R^^^1^1
"KRN",8994,1796,1,0)
^8994.01^3^3^3051004^^^
"KRN",8994,1796,1,1,0)
The ROR LIST VA DRUG CLASSES remote procedure returns a list of VA drug 
"KRN",8994,1796,1,2,0)
classes (defined in the VA DRUG CLASS file), which conform to the search
"KRN",8994,1796,1,3,0)
criteria.
"KRN",8994,1796,2,0)
^8994.02A^5^5
"KRN",8994,1796,2,1,0)
PARENT^1^^^1
"KRN",8994,1796,2,1,1,0)
^8994.021^1^1^3050929^^
"KRN",8994,1796,2,1,1,1,0)
Reserved
"KRN",8994,1796,2,2,0)
PART^1^30^^2
"KRN",8994,1796,2,2,1,0)
^8994.021^1^1^3050929^^
"KRN",8994,1796,2,2,1,1,0)
The partial match restriction.
"KRN",8994,1796,2,3,0)
FLAGS^1^^^3
"KRN",8994,1796,2,3,1,0)
^8994.021^4^4^3050929^^^
"KRN",8994,1796,2,3,1,1,0)
Flags that control the execution (can be combined):
"KRN",8994,1796,2,3,1,2,0)
 
"KRN",8994,1796,2,3,1,3,0)
  N  Search the classes by their names
"KRN",8994,1796,2,3,1,4,0)
     (by default, the search is performed by codes)
"KRN",8994,1796,2,4,0)
NUMBER^1^^^4
"KRN",8994,1796,2,4,1,0)
^8994.021^1^1^3051004^^^
"KRN",8994,1796,2,4,1,1,0)
Deprecated
"KRN",8994,1796,2,5,0)
FROM^1^^^5
"KRN",8994,1796,2,5,1,0)
^8994.021^1^1^3051004^^^^
"KRN",8994,1796,2,5,1,1,0)
Deprecated
"KRN",8994,1796,2,"B","FLAGS",3)

"KRN",8994,1796,2,"B","FROM",5)

"KRN",8994,1796,2,"B","NUMBER",4)

"KRN",8994,1796,2,"B","PARENT",1)

"KRN",8994,1796,2,"B","PART",2)

"KRN",8994,1796,2,"PARAMSEQ",1,1)

"KRN",8994,1796,2,"PARAMSEQ",2,2)

"KRN",8994,1796,2,"PARAMSEQ",3,3)

"KRN",8994,1796,2,"PARAMSEQ",4,4)

"KRN",8994,1796,2,"PARAMSEQ",5,5)

"KRN",8994,1796,3,0)
^8994.03^23^23^3051004^^^
"KRN",8994,1796,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1796,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1796,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1796,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1796,3,5,0)
   
"KRN",8994,1796,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1796,3,7,0)
                          ^01: The last error code
"KRN",8994,1796,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1796,3,9,0)
   
"KRN",8994,1796,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1796,3,11,0)
                          ^01: Error code
"KRN",8994,1796,3,12,0)
                          ^02: Message
"KRN",8994,1796,3,13,0)
                          ^03: Place of the error
"KRN",8994,1796,3,14,0)
  
"KRN",8994,1796,3,15,0)
Otherwise, number of drug classes is returned in the Results[0] and the
"KRN",8994,1796,3,16,0)
subsequent nodes of the global array contain the classes.
"KRN",8994,1796,3,17,0)
   
"KRN",8994,1796,3,18,0)
  Results[0]          Number of classes
"KRN",8994,1796,3,19,0)
 
"KRN",8994,1796,3,20,0)
  Results[i]          VA Drug Class
"KRN",8994,1796,3,21,0)
                        ^01: IEN
"KRN",8994,1796,3,22,0)
                        ^02: Classification
"KRN",8994,1796,3,23,0)
                        ^03: Code
"KRN",8994,1797,-1)
0^30
"KRN",8994,1797,0)
ROR LIST LABORATORY TESTS^LABTLIST^RORRP018^4^R^^^1^1
"KRN",8994,1797,1,0)
^8994.01^3^3^3030625^^^^
"KRN",8994,1797,1,1,0)
The ROR LIST LABORATORY TESTS remote procedure returns a list of 
"KRN",8994,1797,1,2,0)
laboratory tests (defined in the LABORATORY TEST file), which conform the 
"KRN",8994,1797,1,3,0)
criteria.
"KRN",8994,1797,2,0)
^8994.02A^5^5
"KRN",8994,1797,2,1,0)
SUBSCR^1^^^1
"KRN",8994,1797,2,1,1,0)
^^14^14^3030227^
"KRN",8994,1797,2,1,1,1,0)
List of test subscripts separated by commas (internal values of the 
"KRN",8994,1797,2,1,1,2,0)
SUBSCRIPT field of the LABORATORY TEST file):
"KRN",8994,1797,2,1,1,3,0)
 
"KRN",8994,1797,2,1,1,4,0)
  AU  Autopsy
"KRN",8994,1797,2,1,1,5,0)
  BB  Blood Bank
"KRN",8994,1797,2,1,1,6,0)
  CH  CHEM, HEM, TOX, SER, RIA, ETC.
"KRN",8994,1797,2,1,1,7,0)
  CY  Cytology
"KRN",8994,1797,2,1,1,8,0)
  EM  Electronic Microscopy
"KRN",8994,1797,2,1,1,9,0)
  MI  Microbiology
"KRN",8994,1797,2,1,1,10,0)
  SP  Surgical Pathology
"KRN",8994,1797,2,1,1,11,0)
  WK  Workload
"KRN",8994,1797,2,1,1,12,0)
  
"KRN",8994,1797,2,1,1,13,0)
Only tests of the types defined by this parameter are selected by the
"KRN",8994,1797,2,1,1,14,0)
remote procedure. By default ($G(SUBSCR)=""), all tests are selected.
"KRN",8994,1797,2,2,0)
PART^1^30^^2
"KRN",8994,1797,2,2,1,0)
^^1^1^3030227^
"KRN",8994,1797,2,2,1,1,0)
The partial match restriction.
"KRN",8994,1797,2,3,0)
FLAGS^1^^^3
"KRN",8994,1797,2,3,1,0)
^^7^7^3030625^
"KRN",8994,1797,2,3,1,1,0)
Flags that control the execution (can be combined):
"KRN",8994,1797,2,3,1,2,0)
 
"KRN",8994,1797,2,3,1,3,0)
  B  Backwards. Traverses the index in the opposite
"KRN",8994,1797,2,3,1,4,0)
     direction of normal traversal.
"KRN",8994,1797,2,3,1,5,0)
 
"KRN",8994,1797,2,3,1,6,0)
  P  Include panels (by default, the panels are
"KRN",8994,1797,2,3,1,7,0)
     excluded from the list)
"KRN",8994,1797,2,4,0)
NUMBER^1^^^4
"KRN",8994,1797,2,4,1,0)
^^2^2^3030227^
"KRN",8994,1797,2,4,1,1,0)
Maximum number of entries to return. A value of "*" or no value in this 
"KRN",8994,1797,2,4,1,2,0)
parameter designates all entries.
"KRN",8994,1797,2,5,0)
FROM^1^^^5
"KRN",8994,1797,2,5,1,0)
^8994.021^13^13^3030625^^
"KRN",8994,1797,2,5,1,1,0)
The index entry(s) from which to begin the list
"KRN",8994,1797,2,5,1,2,0)
  ^01: FromName
"KRN",8994,1797,2,5,1,3,0)
  ^02: FromIEN
"KRN",8994,1797,2,5,1,4,0)
  
"KRN",8994,1797,2,5,1,5,0)
For example, a FROM value of "BI" would list entries following BI. You can
"KRN",8994,1797,2,5,1,6,0)
use the 2-nd and 3-rd "^"- pieces of the Results[0] to continue the
"KRN",8994,1797,2,5,1,7,0)
listing in the subsequent procedure calls.
"KRN",8994,1797,2,5,1,8,0)
  
"KRN",8994,1797,2,5,1,9,0)
NOTE: The FROM value itself is not included in the
"KRN",8994,1797,2,5,1,10,0)
      resulting list.
"KRN",8994,1797,2,5,1,11,0)
  
"KRN",8994,1797,2,5,1,12,0)
See description of the LIST^DIC for more details about the PART, NUMBER
"KRN",8994,1797,2,5,1,13,0)
and FROM parameters.
"KRN",8994,1797,2,"B","FLAGS",3)

"KRN",8994,1797,2,"B","FROM",5)

"KRN",8994,1797,2,"B","NUMBER",4)

"KRN",8994,1797,2,"B","PART",2)

"KRN",8994,1797,2,"B","SUBSCR",1)

"KRN",8994,1797,2,"PARAMSEQ",1,1)

"KRN",8994,1797,2,"PARAMSEQ",2,2)

"KRN",8994,1797,2,"PARAMSEQ",3,3)

"KRN",8994,1797,2,"PARAMSEQ",4,4)

"KRN",8994,1797,2,"PARAMSEQ",5,5)

"KRN",8994,1797,3,0)
^8994.03^27^27^3030625^^
"KRN",8994,1797,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1797,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1797,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1797,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1797,3,5,0)
   
"KRN",8994,1797,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1797,3,7,0)
                          ^01: The last error code
"KRN",8994,1797,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1797,3,9,0)
    
"KRN",8994,1797,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1797,3,11,0)
                          ^01: Error code
"KRN",8994,1797,3,12,0)
                          ^02: Message
"KRN",8994,1797,3,13,0)
                          ^03: Place of the error
"KRN",8994,1797,3,14,0)
 
"KRN",8994,1797,3,15,0)
Otherwise, number of laboratory tests and the value of the FROM parameter
"KRN",8994,1797,3,16,0)
for the next procedure call are returned in the Results[0] and the
"KRN",8994,1797,3,17,0)
subsequent nodes of the global array contain the tests.
"KRN",8994,1797,3,18,0)
  
"KRN",8994,1797,3,19,0)
  Results[0]          Result Descriptor
"KRN",8994,1797,3,20,0)
                        ^01: Number of tests
"KRN",8994,1797,3,21,0)
                        ^02: FromName
"KRN",8994,1797,3,22,0)
                        ^03: FromIEN
"KRN",8994,1797,3,23,0)
 
"KRN",8994,1797,3,24,0)
  Results[i]          Laboratory Test
"KRN",8994,1797,3,25,0)
                        ^01: IEN
"KRN",8994,1797,3,26,0)
                        ^02: Test Name
"KRN",8994,1797,3,27,0)
                        ^03: Subscript (internal)
"KRN",8994,1798,-1)
0^41
"KRN",8994,1798,0)
ROR LOG INFO^LOGINFO^RORRP007^2^R^^^1^1
"KRN",8994,1798,1,0)
^8994.01^1^1^3051104^^^
"KRN",8994,1798,1,1,0)
The ROR LOG INFO remote procedure returns the log information.
"KRN",8994,1798,2,0)
^8994.02A^1^1
"KRN",8994,1798,2,1,0)
LOGIEN^1^^1^1
"KRN",8994,1798,2,1,1,0)
^8994.021^1^1^3051104^^^
"KRN",8994,1798,2,1,1,1,0)
The LOGIEN parameter defines the log.
"KRN",8994,1798,2,"B","LOGIEN",1)

"KRN",8994,1798,2,"PARAMSEQ",1,1)

"KRN",8994,1798,3,0)
^8994.03^22^22^3051104^^
"KRN",8994,1798,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1798,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1798,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1798,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1798,3,5,0)
    
"KRN",8994,1798,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1798,3,7,0)
                          ^01: The last error code
"KRN",8994,1798,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1798,3,9,0)
                                                                       
"KRN",8994,1798,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1798,3,11,0)
                          ^01: Error code
"KRN",8994,1798,3,12,0)
                          ^02: Message
"KRN",8994,1798,3,13,0)
                          ^03: Place of the error
"KRN",8994,1798,3,14,0)
 
"KRN",8994,1798,3,15,0)
Otherwise, either 0 (an invalid log IEN or the log does not exist) or 1 is
"KRN",8994,1798,3,16,0)
returned in the Results[0] and the subsequent nodes of the Results array
"KRN",8994,1798,3,17,0)
contain the log information.
"KRN",8994,1798,3,18,0)
 
"KRN",8994,1798,3,19,0)
  Results[0]            0 or 1
"KRN",8994,1798,3,20,0)
 
"KRN",8994,1798,3,21,0)
  Results[i]            See description of the ROR LOG GET LIST
"KRN",8994,1798,3,22,0)
                        remote procedure (if the Results[0] = 1)
"KRN",8994,1799,-1)
0^53
"KRN",8994,1799,0)
ROR REPORT STYLESHEET^GETXSL^RORRP011^4^R^^^1^1
"KRN",8994,1799,1,0)
^8994.01^3^3^3030307^
"KRN",8994,1799,1,1,0)
The ROR REPORT STYLESHEET remote procedure retrieves the XSL stylesheet 
"KRN",8994,1799,1,2,0)
associated with the report. If there is no stylesheet available, the 
"KRN",8994,1799,1,3,0)
default one is returned.
"KRN",8994,1799,2,0)
^8994.02A^2^2
"KRN",8994,1799,2,1,0)
RPTCODE^1^^1^1
"KRN",8994,1799,2,1,1,0)
^8994.021^2^2^3030307^^
"KRN",8994,1799,2,1,1,1,0)
Code of the report (value of the CODE field of the report descriptor in
"KRN",8994,1799,2,1,1,2,0)
the ROR REPORT file).
"KRN",8994,1799,2,2,0)
TYPE^1^^^2
"KRN",8994,1799,2,2,1,0)
^^5^5^3030307^
"KRN",8994,1799,2,2,1,1,0)
The TYPE parameter defines the type of requested stylesheet:
"KRN",8994,1799,2,2,1,2,0)
 
"KRN",8994,1799,2,2,1,3,0)
  1  Report preview (default)
"KRN",8994,1799,2,2,1,4,0)
  2  Comma-separated output
"KRN",8994,1799,2,2,1,5,0)
  3  Printer output
"KRN",8994,1799,2,"B","RPTCODE",1)

"KRN",8994,1799,2,"B","TYPE",2)

"KRN",8994,1799,2,"PARAMSEQ",1,1)

"KRN",8994,1799,2,"PARAMSEQ",2,2)

"KRN",8994,1799,3,0)
^^16^16^3030425^
"KRN",8994,1799,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1799,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1799,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1799,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1799,3,5,0)
     
"KRN",8994,1799,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1799,3,7,0)
                          ^01: The last error code
"KRN",8994,1799,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1799,3,9,0)
                                                                      
"KRN",8994,1799,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1799,3,11,0)
                          ^01: Error code
"KRN",8994,1799,3,12,0)
                          ^02: Message
"KRN",8994,1799,3,13,0)
                          ^03: Place of the error
"KRN",8994,1799,3,14,0)
 
"KRN",8994,1799,3,15,0)
Otherwise, the elements of the resulting array (starting from 0) contain
"KRN",8994,1799,3,16,0)
the lines of the XSL stylesheet.
"KRN",8994,1808,-1)
0^16
"KRN",8994,1808,0)
ROR GET SERVER TIME^GETSRVDT^RORRP012^2^P^^^1^1
"KRN",8994,1808,1,0)
^8994.01^2^2^3030425^
"KRN",8994,1808,1,1,0)
The ROR GET SERVER TIME remiote procedure returns the current date/time 
"KRN",8994,1808,1,2,0)
from the VistA server.
"KRN",8994,1808,3,0)
^8994.03^2^2^3030425^^
"KRN",8994,1808,3,1,0)
The current date/time from the VistA server (in internal FileMan format) 
"KRN",8994,1808,3,2,0)
is returned in the Results[1]. Results[0] always contains 0.
"KRN",8994,1809,-1)
0^60
"KRN",8994,1809,0)
ROR TASK VALIDATE RESCHEDULING^VALIDSCH^RORRP012^2^P^^^1^1
"KRN",8994,1809,1,0)
^8994.01^2^2^3030313^^^^
"KRN",8994,1809,1,1,0)
The ROR TASK VALIDATE RESCHEDULING remote procedure validates the 
"KRN",8994,1809,1,2,0)
rescheduling code and returns the next date/time to run.
"KRN",8994,1809,2,0)
^8994.02A^2^2
"KRN",8994,1809,2,1,0)
SCHCODE^1^^1^1
"KRN",8994,1809,2,1,1,0)
^^1^1^3030313^
"KRN",8994,1809,2,1,1,1,0)
Rescheduling code ("1D", "1M", "D@12:00", etc).
"KRN",8994,1809,2,2,0)
SCHDT^1^^^2
"KRN",8994,1809,2,2,1,0)
^^2^2^3030313^
"KRN",8994,1809,2,2,1,1,0)
Date when a task is scheduled to run for the first time (FileMan). By 
"KRN",8994,1809,2,2,1,2,0)
default (if $G(SCHDT)'>0), the current date/time is used.
"KRN",8994,1809,2,"B","SCHCODE",1)

"KRN",8994,1809,2,"B","SCHDT",2)

"KRN",8994,1809,2,"PARAMSEQ",1,1)

"KRN",8994,1809,2,"PARAMSEQ",2,2)

"KRN",8994,1809,3,0)
^^17^17^3030425^
"KRN",8994,1809,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1809,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1809,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1809,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1809,3,5,0)
  
"KRN",8994,1809,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1809,3,7,0)
                          ^01: The last error code
"KRN",8994,1809,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1809,3,9,0)
  
"KRN",8994,1809,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1809,3,11,0)
                          ^01: Error code
"KRN",8994,1809,3,12,0)
                          ^02: Message
"KRN",8994,1809,3,13,0)
                          ^03: Place of the error
"KRN",8994,1809,3,14,0)
 
"KRN",8994,1809,3,15,0)
Otherwise, either 1 (the rescheduling code is valid) or 0 (the code is not
"KRN",8994,1809,3,16,0)
valid) is returned in the Results[0]. If the code is valid then the next 
"KRN",8994,1809,3,17,0)
date/time to run the task (FileMan) is returned in the Results[1].
"KRN",8994,1810,-1)
0^33
"KRN",8994,1810,0)
ROR LIST PATIENTS^PTLIST^RORRP019^4^R^^^1^1
"KRN",8994,1810,1,0)
^8994.01^3^3^3050804^^^^
"KRN",8994,1810,1,1,0)
The ROR LIST PATIENTS remote procedure returns either a list patients from
"KRN",8994,1810,1,2,0)
the PATIENT file (#2) or a list of registry patients who conform the
"KRN",8994,1810,1,3,0)
provided criteria.
"KRN",8994,1810,2,0)
^8994.02A^6^6
"KRN",8994,1810,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1810,2,1,1,0)
^8994.021^2^2^3030320^^
"KRN",8994,1810,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,1810,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1810,2,2,0)
DATE^1^^^2
"KRN",8994,1810,2,2,1,0)
^^3^3^3050804^
"KRN",8994,1810,2,2,1,1,0)
Patients who were confirmed in the registry before the date defined by the
"KRN",8994,1810,2,2,1,2,0)
DATE parameter will be skipped by the query (if the FLAGS parameter
"KRN",8994,1810,2,2,1,3,0)
contains the 'C' flag).
"KRN",8994,1810,2,3,0)
PART^1^30^^3
"KRN",8994,1810,2,3,1,0)
^^11^11^3040803^
"KRN",8994,1810,2,3,1,1,0)
The PART parameter defines the search pattern. It can contain last 4 
"KRN",8994,1810,2,3,1,2,0)
digits of the patient's SSN, the first letter of the patient's last name
"KRN",8994,1810,2,3,1,3,0)
and last four digits of the SSN, the full SSN, or the beginning of the
"KRN",8994,1810,2,3,1,4,0)
patient name.
"KRN",8994,1810,2,3,1,5,0)
 
"KRN",8994,1810,2,3,1,6,0)
If the 'N' or 'P' flag is defined (see the FLAGS parameter), the PART
"KRN",8994,1810,2,3,1,7,0)
parameter should contain either the beginning of the patient name or an
"KRN",8994,1810,2,3,1,8,0)
empty string.
"KRN",8994,1810,2,3,1,9,0)
 
"KRN",8994,1810,2,3,1,10,0)
If this parameter is a number preceded by the '`' then a list containing
"KRN",8994,1810,2,3,1,11,0)
only the patient with this IEN is compiled.
"KRN",8994,1810,2,4,0)
FLAGS^1^^^4
"KRN",8994,1810,2,4,1,0)
^^17^17^3050512^
"KRN",8994,1810,2,4,1,1,0)
Flags that control the execution (can be combined):
"KRN",8994,1810,2,4,1,2,0)
  
"KRN",8994,1810,2,4,1,3,0)
  2  Search in the PATIENT file. By default, the     
"KRN",8994,1810,2,4,1,4,0)
     ROR LOCAL REGISTRY and ROR PATIENT files are
"KRN",8994,1810,2,4,1,5,0)
     queried. This flag overrides the 'D' and 'P'
"KRN",8994,1810,2,4,1,6,0)
     flags.
"KRN",8994,1810,2,4,1,7,0)
 
"KRN",8994,1810,2,4,1,8,0)
  B  Backwards. Traverses the index in the opposite
"KRN",8994,1810,2,4,1,9,0)
     direction of normal traversal.
"KRN",8994,1810,2,4,1,10,0)
 
"KRN",8994,1810,2,4,1,11,0)
  D  Ignore those patients who were added to the
"KRN",8994,1810,2,4,1,12,0)
     registry before the date defined by the DATE
"KRN",8994,1810,2,4,1,13,0)
     parameter.
"KRN",8994,1810,2,4,1,14,0)
 
"KRN",8994,1810,2,4,1,15,0)
  O  Return values of the optional fields
"KRN",8994,1810,2,4,1,16,0)
 
"KRN",8994,1810,2,4,1,17,0)
  P  Include only pending patients
"KRN",8994,1810,2,5,0)
NUMBER^1^^^5
"KRN",8994,1810,2,5,1,0)
^^2^2^3030320^
"KRN",8994,1810,2,5,1,1,0)
Maximum number of entries to return. A value of "*" or no value in this 
"KRN",8994,1810,2,5,1,2,0)
parameter designates all entries that conform the criteria.
"KRN",8994,1810,2,6,0)
FROM^1^^^6
"KRN",8994,1810,2,6,1,0)
^8994.021^9^9^3050804^^^^
"KRN",8994,1810,2,6,1,1,0)
The index entry(s) from which to begin the list. Use the pieces of the
"KRN",8994,1810,2,6,1,2,0)
Results[0] (starting from the second one) to continue the listing in the
"KRN",8994,1810,2,6,1,3,0)
subsequent procedure calls.
"KRN",8994,1810,2,6,1,4,0)
 
"KRN",8994,1810,2,6,1,5,0)
NOTE: The FROM value itself is not included in the
"KRN",8994,1810,2,6,1,6,0)
      resulting list.
"KRN",8994,1810,2,6,1,7,0)
 
"KRN",8994,1810,2,6,1,8,0)
See description of the LIST^DIC for more details about the PART, NUMBER
"KRN",8994,1810,2,6,1,9,0)
and FROM parameters.
"KRN",8994,1810,2,"B","DATE",2)

"KRN",8994,1810,2,"B","FLAGS",4)

"KRN",8994,1810,2,"B","FROM",6)

"KRN",8994,1810,2,"B","NUMBER",5)

"KRN",8994,1810,2,"B","PART",3)

"KRN",8994,1810,2,"B","REGIEN",1)

"KRN",8994,1810,2,"PARAMSEQ",1,1)

"KRN",8994,1810,2,"PARAMSEQ",2,2)

"KRN",8994,1810,2,"PARAMSEQ",3,3)

"KRN",8994,1810,2,"PARAMSEQ",4,4)

"KRN",8994,1810,2,"PARAMSEQ",5,5)

"KRN",8994,1810,2,"PARAMSEQ",6,6)

"KRN",8994,1810,3,0)
^^108^108^3050804^
"KRN",8994,1810,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1810,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1810,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1810,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1810,3,5,0)
   
"KRN",8994,1810,3,6,0)
   Results[0]            Result Descriptor
"KRN",8994,1810,3,7,0)
                           ^01: The last error code
"KRN",8994,1810,3,8,0)
                           ^02: Number of the error descriptors
"KRN",8994,1810,3,9,0)
    
"KRN",8994,1810,3,10,0)
   Results[i]            Error Descriptor
"KRN",8994,1810,3,11,0)
                           ^01: Error code
"KRN",8994,1810,3,12,0)
                           ^02: Message
"KRN",8994,1810,3,13,0)
                           ^03: Place of the error
"KRN",8994,1810,3,14,0)
 
"KRN",8994,1810,3,15,0)
Otherwise, number of patients and the value of the FROM parameter for the
"KRN",8994,1810,3,16,0)
next procedure call are returned in the Results[0] and the subsequent
"KRN",8994,1810,3,17,0)
nodes of the Results array contain the patients.
"KRN",8994,1810,3,18,0)
  
"KRN",8994,1810,3,19,0)
  Results[0]            Result Descriptor
"KRN",8994,1810,3,20,0)
                          ^01: Number of patients
"KRN",8994,1810,3,21,0)
                          ^02: Values that comprise the FROM parameter
"KRN",8994,1810,3,22,0)
                          ^nn: for the subsequent call of the procedure
"KRN",8994,1810,3,23,0)
 
"KRN",8994,1810,3,24,0)
  Results[i]            Patient
"KRN",8994,1810,3,25,0)
                          ^01: IEN (DFN)
"KRN",8994,1810,3,26,0)
                          ^02: Name
"KRN",8994,1810,3,27,0)
                          ^03: Date of Birth (FileMan)
"KRN",8994,1810,3,28,0)
                          ^04: SSN
"KRN",8994,1810,3,29,0)
                          ^05: Date of Death (FileMan)
"KRN",8994,1810,3,30,0)
                          ^06: Sex (internal)
"KRN",8994,1810,3,31,0)
 
"KRN",8994,1810,3,32,0)
  Results[i+1]          Optional Fields (these nodes are created only
"KRN",8994,1810,3,33,0)
                        if the FLAGS parameter contains the 'O' flag)
"KRN",8994,1810,3,34,0)
                          ^01: "O" (letter O)
"KRN",8994,1810,3,35,0)
                          ^02: Date Entered (FileMan)
"KRN",8994,1810,3,36,0)
                          ^03: Status (internal)
"KRN",8994,1810,3,37,0)
                          ^04: Active (0/1)
"KRN",8994,1810,3,38,0)
                          ^05: Do not Send (0/1)
"KRN",8994,1810,3,39,0)
                          ^06: Data Acknowledged Until (FileMan)
"KRN",8994,1810,3,40,0)
                          ^07: Data Extracted Until (FileMan)
"KRN",8994,1810,3,41,0)
                          ^08: Date Selected (FileMan)
"KRN",8994,1810,3,42,0)
                          ^09: Date Confirmed (FileMan)
"KRN",8994,1810,3,43,0)
                          ^10: Location Selected
"KRN",8994,1810,3,44,0)
                          ^11: reserved
"KRN",8994,1810,3,45,0)
                          ^12: reserved
"KRN",8994,1810,3,46,0)
                          ^13: reserved
"KRN",8994,1810,3,47,0)
                          ^14: Action Flags (see the description below)
"KRN",8994,1810,3,48,0)
 
"KRN",8994,1810,3,49,0)
                        The Status field can have the following values
"KRN",8994,1810,3,50,0)
                        (see description of the STATUS field of the
"KRN",8994,1810,3,51,0)
                        ROR REGISTRY RECORD file for more details):
"KRN",8994,1810,3,52,0)
                            0  Active
"KRN",8994,1810,3,53,0)
                            4  Pending
"KRN",8994,1810,3,54,0)
                            5  Deleted
"KRN",8994,1810,3,55,0)
 
"KRN",8994,1810,3,56,0)
                        The Action Flags field indicates the actions that
"KRN",8994,1810,3,57,0)
                        can be performed on the patient's record:
"KRN",8994,1810,3,58,0)
                            C  CDC form can be edited/printed
"KRN",8994,1810,3,59,0)
                            D  The record can be deleted
"KRN",8994,1810,3,60,0)
                            E  The record can be edited
"KRN",8994,1810,3,61,0)
                            O  Read-only mode
"KRN",8994,1810,3,62,0)
 
"KRN",8994,1810,3,63,0)
Example #1 (search the PATIENT file):
"KRN",8994,1810,3,64,0)
 
"KRN",8994,1810,3,65,0)
  with RPCBroker do
"KRN",8994,1810,3,66,0)
    begin
"KRN",8994,1810,3,67,0)
      Param[0].Value := '2';      // Registry IEN
"KRN",8994,1810,3,68,0)
      Param[0].PType := literal;
"KRN",8994,1810,3,69,0)
      Param[1].Value := '';       // Date
"KRN",8994,1810,3,70,0)
      Param[1].PType := literal;
"KRN",8994,1810,3,71,0)
      Param[2].Value := '3456';   // Last four digits of the SSN
"KRN",8994,1810,3,72,0)
      Param[2].PType := literal;
"KRN",8994,1810,3,73,0)
      Param[3].Value := '2';      // Flags
"KRN",8994,1810,3,74,0)
      Param[3].PType := literal;
"KRN",8994,1810,3,75,0)
      Call;
"KRN",8994,1810,3,76,0)
    end;
"KRN",8994,1810,3,77,0)
 
"KRN",8994,1810,3,78,0)
  The Results array will contain something like this:
"KRN",8994,1810,3,79,0)
 
"KRN",8994,1810,3,80,0)
  Results[0] = '1'
"KRN",8994,1810,3,81,0)
  Results[1] = '162^ATTENDING,PATIENT^3000617^321233456^^M'
"KRN",8994,1810,3,82,0)
 
"KRN",8994,1810,3,83,0)
Example 2 (query the registry):
"KRN",8994,1810,3,84,0)
 
"KRN",8994,1810,3,85,0)
  with RPCBroker do
"KRN",8994,1810,3,86,0)
    begin
"KRN",8994,1810,3,87,0)
      Param[0].Value := '2';      // Registry IEN
"KRN",8994,1810,3,88,0)
      Param[0].PType := literal;
"KRN",8994,1810,3,89,0)
      Param[1].Value := '';       // Date
"KRN",8994,1810,3,90,0)
      Param[1].PType := literal;
"KRN",8994,1810,3,91,0)
      Param[2].Value := 'B';      // Partial match
"KRN",8994,1810,3,92,0)
      Param[2].PType := literal;
"KRN",8994,1810,3,93,0)
      Param[3].Value := 'O';      // Flags
"KRN",8994,1810,3,94,0)
      Param[3].PType := literal;
"KRN",8994,1810,3,95,0)
      Param[4].Value := '3';      // Number
"KRN",8994,1810,3,96,0)
      Param[4].PType := literal;
"KRN",8994,1810,3,97,0)
      Call;
"KRN",8994,1810,3,98,0)
    end;
"KRN",8994,1810,3,99,0)
 
"KRN",8994,1810,3,100,0)
  The Results array will contain something like this (see the Results[0]-
"KRN",8994,1810,3,101,0)
  not all records have been loaded):
"KRN",8994,1810,3,102,0)
 
"KRN",8994,1810,3,103,0)
  Results[0] = '2'
"KRN",8994,1810,3,104,0)
  Results[1] = '38^BARNEY,PURPLE^2450000^332456754^^M'
"KRN",8994,1810,3,105,0)
  Results[2] = 'O^3040729.151905^3^1^0^3041027^3041222^3040725^3040729
"KRN",8994,1810,3,106,0)
               ^PALO ALTO^^^^CDE'
"KRN",8994,1810,3,107,0)
  Results[3] = '127^BROWNING,CHARLES^2671227^601122767P^^M'
"KRN",8994,1810,3,108,0)
  Results[4] = 'O^3030716.152528^3^1^0^3040929^3040929^3030921^^^^^^CDE'
"KRN",8994,1811,-1)
0^48
"KRN",8994,1811,0)
ROR PATIENT SELECTION RULES^PTRULES^RORRP022^2^R^^^1^1
"KRN",8994,1811,1,0)
^8994.01^2^2^3050802^^^
"KRN",8994,1811,1,1,0)
The ROR PATIENT SELECTION RULES remote procedure returns a list of 
"KRN",8994,1811,1,2,0)
selection rules that have caused addition of the patient to the registry.
"KRN",8994,1811,2,0)
^8994.02A^2^2
"KRN",8994,1811,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1811,2,1,1,0)
^^2^2^3030321^
"KRN",8994,1811,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,1811,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1811,2,2,0)
PATIEN^1^^1^2
"KRN",8994,1811,2,2,1,0)
^8994.021^2^2^3050802^^^
"KRN",8994,1811,2,2,1,1,0)
Valid IEN of a registry patient should be assigned to the PATIEN
"KRN",8994,1811,2,2,1,2,0)
parameter.
"KRN",8994,1811,2,"B","PATIEN",2)

"KRN",8994,1811,2,"B","REGIEN",1)

"KRN",8994,1811,2,"PARAMSEQ",1,1)

"KRN",8994,1811,2,"PARAMSEQ",2,2)

"KRN",8994,1811,3,0)
^^29^29^3050802^
"KRN",8994,1811,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1811,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1811,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1811,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1811,3,5,0)
  
"KRN",8994,1811,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1811,3,7,0)
                          ^01: The last error code
"KRN",8994,1811,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1811,3,9,0)
                                                                      
"KRN",8994,1811,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1811,3,11,0)
                          ^01: Error code
"KRN",8994,1811,3,12,0)
                          ^02: Message
"KRN",8994,1811,3,13,0)
                          ^03: Place of the error
"KRN",8994,1811,3,14,0)
 
"KRN",8994,1811,3,15,0)
Otherwise, number of selection rules is returned in the Results[0] and the
"KRN",8994,1811,3,16,0)
subsequent nodes of the array contain the rules.
"KRN",8994,1811,3,17,0)
 
"KRN",8994,1811,3,18,0)
  Results[0]            Number of Selection Rules
"KRN",8994,1811,3,19,0)
 
"KRN",8994,1811,3,20,0)
  Results[i]            Selection Rule
"KRN",8994,1811,3,21,0)
                          ^01: IEN in the SELECTION RULE multiple
"KRN",8994,1811,3,22,0)
                               of the ROR LOCAL REGISTRY file
"KRN",8994,1811,3,23,0)
                          ^02: IEN of the Rule (in the
"KRN",8994,1811,3,24,0)
                               ROR SELECTION RULE file)
"KRN",8994,1811,3,25,0)
                          ^03: Name of the Rule
"KRN",8994,1811,3,26,0)
                          ^04: Date (FileMan)
"KRN",8994,1811,3,27,0)
                          ^05: Location IEN  (Institution IEN)
"KRN",8994,1811,3,28,0)
                          ^06: Location Name (Institution Name)
"KRN",8994,1811,3,29,0)
                          ^07: Short Description
"KRN",8994,1812,-1)
0^29
"KRN",8994,1812,0)
ROR LIST ITEMS^LSTITEMS^RORRP012^2^A^^^1^1
"KRN",8994,1812,1,0)
^8994.01^2^2^3050526^^^^
"KRN",8994,1812,1,1,0)
The ROR LIST ITEMS remote procedure returns a list of registry-specific 
"KRN",8994,1812,1,2,0)
items from the ROR LIST ITEM file.
"KRN",8994,1812,2,0)
^8994.02A^2^2
"KRN",8994,1812,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1812,2,1,1,0)
^8994.021^2^2^3050513^^
"KRN",8994,1812,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,1812,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1812,2,2,0)
TYPE^1^^1^2
"KRN",8994,1812,2,2,1,0)
^^7^7^3050526^
"KRN",8994,1812,2,2,1,1,0)
The TYPE parameter defines type of the items that should be extracted:
"KRN",8994,1812,2,2,1,2,0)
 
"KRN",8994,1812,2,2,1,3,0)
  3  Lab Groups
"KRN",8994,1812,2,2,1,4,0)
  4  Drug Groups
"KRN",8994,1812,2,2,1,5,0)
 
"KRN",8994,1812,2,2,1,6,0)
See description of the TYPE field (.02) of the ROR LIST ITEM file (#799.1)
"KRN",8994,1812,2,2,1,7,0)
for more details.
"KRN",8994,1812,2,"B","REGIEN",1)

"KRN",8994,1812,2,"B","TYPE",2)

"KRN",8994,1812,2,"PARAMSEQ",1,1)

"KRN",8994,1812,2,"PARAMSEQ",2,2)

"KRN",8994,1812,3,0)
^8994.03^23^23^3050526^^^^
"KRN",8994,1812,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1812,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1812,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1812,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1812,3,5,0)
   
"KRN",8994,1812,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1812,3,7,0)
                          ^01: The last error code
"KRN",8994,1812,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1812,3,9,0)
                                                                      
"KRN",8994,1812,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1812,3,11,0)
                          ^01: Error code
"KRN",8994,1812,3,12,0)
                          ^02: Message
"KRN",8994,1812,3,13,0)
                          ^03: Place of the error
"KRN",8994,1812,3,14,0)
 
"KRN",8994,1812,3,15,0)
Otherwise, number of list items is returned in the Results[0] and the
"KRN",8994,1812,3,16,0)
subsequent nodes of the array contain the items.
"KRN",8994,1812,3,17,0)
  
"KRN",8994,1812,3,18,0)
   Results[0]            Number of Items
"KRN",8994,1812,3,19,0)
  
"KRN",8994,1812,3,20,0)
   Results[i]            List Item
"KRN",8994,1812,3,21,0)
                           ^01: IEN
"KRN",8994,1812,3,22,0)
                           ^02: Text
"KRN",8994,1812,3,23,0)
                           ^03: Code
"KRN",8994,1813,-1)
0^23
"KRN",8994,1813,0)
ROR LIST COORDINATORS^RCLIST^RORRP023^4^P^^^1^1
"KRN",8994,1813,1,0)
^8994.01^3^3^3050830^^^^
"KRN",8994,1813,1,1,0)
The ROR LIST COORDINATORS remote procedure returns a list of registry 
"KRN",8994,1813,1,2,0)
coordinators. The list is retrieved from the COORDINATOR multiple (14) of
"KRN",8994,1813,1,3,0)
the ROR REGISTRY PARAMETERS file (#798.1).
"KRN",8994,1813,2,0)
^8994.02A^1^1
"KRN",8994,1813,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1813,2,1,1,0)
^8994.021^2^2^3030624^^^^
"KRN",8994,1813,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the 
"KRN",8994,1813,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1813,2,"B","REGIEN",1)

"KRN",8994,1813,2,"PARAMSEQ",1,1)

"KRN",8994,1813,3,0)
^8994.03^22^22^3030624^^^
"KRN",8994,1813,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1813,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1813,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1813,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1813,3,5,0)
  
"KRN",8994,1813,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1813,3,7,0)
                          ^01: The last error code
"KRN",8994,1813,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1813,3,9,0)
                                                                      
"KRN",8994,1813,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1813,3,11,0)
                          ^01: Error code
"KRN",8994,1813,3,12,0)
                          ^02: Message
"KRN",8994,1813,3,13,0)
                          ^03: Place of the error
"KRN",8994,1813,3,14,0)
 
"KRN",8994,1813,3,15,0)
Otherwise, number of coordinators is returned in the Results[0] and the 
"KRN",8994,1813,3,16,0)
subsequent nodes of the global array contain the coordinators.
"KRN",8994,1813,3,17,0)
 
"KRN",8994,1813,3,18,0)
  Results[0]            Number of Coordinators
"KRN",8994,1813,3,19,0)
 
"KRN",8994,1813,3,20,0)
  Results[i]            Coordinator's Descriptor
"KRN",8994,1813,3,21,0)
                          ^01: IEN
"KRN",8994,1813,3,22,0)
                          ^02: Name
"KRN",8994,1814,-1)
0^61
"KRN",8994,1814,0)
ROR UPDATE COORDINATORS^RCLUPD^RORRP023^2^R^^^1^1
"KRN",8994,1814,1,0)
^8994.01^3^3^3030409^^
"KRN",8994,1814,1,1,0)
The ROR UPDATE COORDINATORS remote procedure updates the list of registry 
"KRN",8994,1814,1,2,0)
coordinators that is stored in the COORDINATOR (14) multiple of the ROR 
"KRN",8994,1814,1,3,0)
REGISTRY PARAMETERS file (#798.1).
"KRN",8994,1814,2,0)
^8994.02A^2^2
"KRN",8994,1814,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1814,2,1,1,0)
^^2^2^3030409^
"KRN",8994,1814,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the 
"KRN",8994,1814,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1814,2,2,0)
RCLST^2^^1^2
"KRN",8994,1814,2,2,1,0)
^^11^11^3030409^
"KRN",8994,1814,2,2,1,1,0)
The RCLST parameter should be an array containing a list of user IENs
"KRN",8994,1814,2,2,1,2,0)
(DUZs). The corresponding users will be designated as the registry
"KRN",8994,1814,2,2,1,3,0)
coordinators.
"KRN",8994,1814,2,2,1,4,0)
 
"KRN",8994,1814,2,2,1,5,0)
Example:
"KRN",8994,1814,2,2,1,6,0)
  with RPCBroker.Param[1] do
"KRN",8994,1814,2,2,1,7,0)
    begin
"KRN",8994,1814,2,2,1,8,0)
      PType :=list;
"KRN",8994,1814,2,2,1,9,0)
      for i := 1 to Coordinators.Count do
"KRN",8994,1814,2,2,1,10,0)
        Mult[i] := Coordinators[i-1].IEN;
"KRN",8994,1814,2,2,1,11,0)
    end;
"KRN",8994,1814,2,"B","RCLST",2)

"KRN",8994,1814,2,"B","REGIEN",1)

"KRN",8994,1814,2,"PARAMSEQ",1,1)

"KRN",8994,1814,2,"PARAMSEQ",2,2)

"KRN",8994,1814,3,0)
^^15^15^3030425^
"KRN",8994,1814,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1814,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1814,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1814,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1814,3,5,0)
  
"KRN",8994,1814,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1814,3,7,0)
                          ^01: The last error code
"KRN",8994,1814,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1814,3,9,0)
                                                                      
"KRN",8994,1814,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1814,3,11,0)
                          ^01: Error code
"KRN",8994,1814,3,12,0)
                          ^02: Message
"KRN",8994,1814,3,13,0)
                          ^03: Place of the error
"KRN",8994,1814,3,14,0)
 
"KRN",8994,1814,3,15,0)
Otherwise, zero is returned in the Results[0].
"KRN",8994,1815,-1)
0^37
"KRN",8994,1815,0)
ROR LIST VISTA USERS^USERLIST^RORRP024^4^R^^^1^1
"KRN",8994,1815,1,0)
^8994.01^2^2^3040203^^^^
"KRN",8994,1815,1,1,0)
The ROR LIST VISTA USERS remote procedure returns a list of users from the
"KRN",8994,1815,1,2,0)
NEW PERSON file (#200).
"KRN",8994,1815,2,0)
^8994.02A^6^4
"KRN",8994,1815,2,3,0)
PART^1^30^1^1
"KRN",8994,1815,2,3,1,0)
^^2^2^3030409^
"KRN",8994,1815,2,3,1,1,0)
The PART parameter defines the search pattern. It should contain the
"KRN",8994,1815,2,3,1,2,0)
beginning of the user's name.
"KRN",8994,1815,2,4,0)
FLAGS^1^^^2
"KRN",8994,1815,2,4,1,0)
^^9^9^3040203^
"KRN",8994,1815,2,4,1,1,0)
Flags that control the execution (can be combined):
"KRN",8994,1815,2,4,1,2,0)
 
"KRN",8994,1815,2,4,1,3,0)
  B  Backwards. Traverses the index in the opposite
"KRN",8994,1815,2,4,1,4,0)
     direction of normal traversal.
"KRN",8994,1815,2,4,1,5,0)
 
"KRN",8994,1815,2,4,1,6,0)
  D  Get default division for each user
"KRN",8994,1815,2,4,1,7,0)
 
"KRN",8994,1815,2,4,1,8,0)
  P  Select providers only (check for the PROVIDER
"KRN",8994,1815,2,4,1,9,0)
     security key).
"KRN",8994,1815,2,5,0)
NUMBER^1^^^3
"KRN",8994,1815,2,5,1,0)
^8994.021^2^2^3030409^^^
"KRN",8994,1815,2,5,1,1,0)
Maximum number of entries to return. A value of "*" or no value in this 
"KRN",8994,1815,2,5,1,2,0)
parameter designates all entries that conform the criteria.
"KRN",8994,1815,2,6,0)
FROM^1^^^4
"KRN",8994,1815,2,6,1,0)
^8994.021^9^9^3040203^^^
"KRN",8994,1815,2,6,1,1,0)
The index entry(s) from which to begin the list. Use the pieces of the
"KRN",8994,1815,2,6,1,2,0)
Results[0] (starting from the second one) to continue the listing in the
"KRN",8994,1815,2,6,1,3,0)
subsequent procedure calls.
"KRN",8994,1815,2,6,1,4,0)
 
"KRN",8994,1815,2,6,1,5,0)
NOTE: The FROM value itself is not included in the
"KRN",8994,1815,2,6,1,6,0)
      resulting list.
"KRN",8994,1815,2,6,1,7,0)
 
"KRN",8994,1815,2,6,1,8,0)
See description of the LIST^DIC for more details about the PART, NUMBER
"KRN",8994,1815,2,6,1,9,0)
and FROM parameters.
"KRN",8994,1815,2,"B","FLAGS",4)

"KRN",8994,1815,2,"B","FROM",6)

"KRN",8994,1815,2,"B","NUMBER",5)

"KRN",8994,1815,2,"B","PART",3)

"KRN",8994,1815,2,"PARAMSEQ",1,3)

"KRN",8994,1815,2,"PARAMSEQ",2,4)

"KRN",8994,1815,2,"PARAMSEQ",3,5)

"KRN",8994,1815,2,"PARAMSEQ",4,6)

"KRN",8994,1815,3,0)
^^30^30^3040203^
"KRN",8994,1815,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1815,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1815,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1815,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1815,3,5,0)
  
"KRN",8994,1815,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1815,3,7,0)
                          ^01: The last error code
"KRN",8994,1815,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1815,3,9,0)
   
"KRN",8994,1815,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1815,3,11,0)
                          ^01: Error code
"KRN",8994,1815,3,12,0)
                          ^02: Message
"KRN",8994,1815,3,13,0)
                          ^03: Place of the error
"KRN",8994,1815,3,14,0)
 
"KRN",8994,1815,3,15,0)
Otherwise, number of VistA users and the value of the FROM parameter for
"KRN",8994,1815,3,16,0)
the next procedure call are returned in the Results[0] and the subsequent
"KRN",8994,1815,3,17,0)
nodes of the Results array contain the users.
"KRN",8994,1815,3,18,0)
  
"KRN",8994,1815,3,19,0)
  Results[0]            Result Descriptor
"KRN",8994,1815,3,20,0)
                          ^01: Number of users
"KRN",8994,1815,3,21,0)
                          ^02: Values that comprise the FROM parameter
"KRN",8994,1815,3,22,0)
                          ^nn: for the subsequent call of the procedure
"KRN",8994,1815,3,23,0)
 
"KRN",8994,1815,3,24,0)
  Results[i]            VistA User
"KRN",8994,1815,3,25,0)
                          ^01: IEN (DUZ)
"KRN",8994,1815,3,26,0)
                          ^02: Name
"KRN",8994,1815,3,27,0)
                          ^03: Office Phone
"KRN",8994,1815,3,28,0)
                          ^04: Nickname
"KRN",8994,1815,3,29,0)
                          ^06: Default Division IEN  (only if D flag)
"KRN",8994,1815,3,30,0)
                          ^07: Default Division Name (only if D flag)
"KRN",8994,1816,-1)
0^68
"KRN",8994,1816,0)
RORICR CDC LOAD^LOADCDC^RORRP025^2^R^^^1^1
"KRN",8994,1816,1,0)
^8994.01^2^2^3040203^^^^
"KRN",8994,1816,1,1,0)
The RORICR CDC LOAD remote procedure loads the data for the CDC form 
"KRN",8994,1816,1,2,0)
that is edited/printed by the ICR registry.
"KRN",8994,1816,2,0)
^8994.02A^3^3
"KRN",8994,1816,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1816,2,1,1,0)
^^2^2^3030411^
"KRN",8994,1816,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,1816,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1816,2,2,0)
PATIEN^1^^1^2
"KRN",8994,1816,2,2,1,0)
^8994.021^1^1^3030716^^^^
"KRN",8994,1816,2,2,1,1,0)
A valid patient IEN (DFN) should be assigned to the PATIEN parameter.
"KRN",8994,1816,2,3,0)
LOCK^1^^^3
"KRN",8994,1816,2,3,1,0)
^8994.021^2^2^3040203^^^
"KRN",8994,1816,2,3,1,1,0)
If this parameter is defined and not zero then the RPC will try to lock
"KRN",8994,1816,2,3,1,2,0)
the registry record before loading the data and will leave it locked.
"KRN",8994,1816,2,"B","LOCK",3)

"KRN",8994,1816,2,"B","PATIEN",2)

"KRN",8994,1816,2,"B","REGIEN",1)

"KRN",8994,1816,2,"PARAMSEQ",1,1)

"KRN",8994,1816,2,"PARAMSEQ",2,2)

"KRN",8994,1816,2,"PARAMSEQ",3,3)

"KRN",8994,1816,3,0)
^^264^264^3040203^
"KRN",8994,1816,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1816,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1816,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1816,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1816,3,5,0)
   
"KRN",8994,1816,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1816,3,7,0)
                          ^01: The last error code
"KRN",8994,1816,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1816,3,9,0)
                                                                      
"KRN",8994,1816,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1816,3,11,0)
                          ^01: Error code
"KRN",8994,1816,3,12,0)
                          ^02: Message
"KRN",8994,1816,3,13,0)
                          ^03: Place of the error
"KRN",8994,1816,3,14,0)
 
"KRN",8994,1816,3,15,0)
If locking was requested (see the LOCK parameter) and the record could not
"KRN",8994,1816,3,16,0)
be locked then the first "^"-piece of the Results[0] would be greater than
"KRN",8994,1816,3,17,0)
0. The Results[0] would contain the lock descriptor and subsequent nodes
"KRN",8994,1816,3,18,0)
of the global array would contain the data (see below). The lock 
"KRN",8994,1816,3,19,0)
descriptor contains information about the process, which owns the most 
"KRN",8994,1816,3,20,0)
recent lock of the record.
"KRN",8994,1816,3,21,0)
 
"KRN",8994,1816,3,22,0)
  Results[0]            Lock Descriptor
"KRN",8994,1816,3,23,0)
                          ^01: Date/Time (FileMan)
"KRN",8994,1816,3,24,0)
                          ^02: User/Process name
"KRN",8994,1816,3,25,0)
                          ^03: User IEN (DUZ)
"KRN",8994,1816,3,26,0)
                          ^04: $JOB
"KRN",8994,1816,3,27,0)
                          ^05: Task number
"KRN",8994,1816,3,28,0)
 
"KRN",8994,1816,3,29,0)
THE DATA ARE LOADED ONLY FOR VIEWING PURPOSES (READ-ONLY)!
"KRN",8994,1816,3,30,0)
 
"KRN",8994,1816,3,31,0)
Otherwise, zero is returned in the Results[0] and the subsequent nodes of
"KRN",8994,1816,3,32,0)
the array contain the data. Some data items are optional (for example, RCE
"KRN",8994,1816,3,33,0)
and ETN). Some other items can be repeated (e.g. AID and CMT).
"KRN",8994,1816,3,34,0)
 
"KRN",8994,1816,3,35,0)
  Results[0]            0
"KRN",8994,1816,3,36,0)
 
"KRN",8994,1816,3,37,0)
  Results[i]            Demographic Information
"KRN",8994,1816,3,38,0)
                          ^01: "DEM"
"KRN",8994,1816,3,39,0)
                          ^02: ""
"KRN",8994,1816,3,40,0)
                          ^03: Patient IEN (DFN)
"KRN",8994,1816,3,41,0)
                          ^04: Patient Name
"KRN",8994,1816,3,42,0)
                          ^05: Date of Birth (FileMan)
"KRN",8994,1816,3,43,0)
                          ^06: SSN
"KRN",8994,1816,3,44,0)
                          ^07: Date of Death (FileMan)
"KRN",8994,1816,3,45,0)
                          ^08: Sex (F/M)
"KRN",8994,1816,3,46,0)
 
"KRN",8994,1816,3,47,0)
  Results[i]            Patient's Address
"KRN",8994,1816,3,48,0)
                          ^01: "ADR"
"KRN",8994,1816,3,49,0)
                          ^02: ""
"KRN",8994,1816,3,50,0)
                          ^03: Address (1)
"KRN",8994,1816,3,51,0)
                          ^04: Address (2)
"KRN",8994,1816,3,52,0)
                          ^05: Address (3)
"KRN",8994,1816,3,53,0)
                          ^06: City
"KRN",8994,1816,3,54,0)
                          ^07: State (IEN)
"KRN",8994,1816,3,55,0)
                          ^08: State (Name)
"KRN",8994,1816,3,56,0)
                          ^09: ZIP
"KRN",8994,1816,3,57,0)
                          ^10: ZIP+4
"KRN",8994,1816,3,58,0)
                          ^11: County (IEN)
"KRN",8994,1816,3,59,0)
                          ^12: County (Name)
"KRN",8994,1816,3,60,0)
                          ^13: Home Phone
"KRN",8994,1816,3,61,0)
 
"KRN",8994,1816,3,62,0)
  Results[i]            Race Information
"KRN",8994,1816,3,63,0)
                          ^01: "RCE"
"KRN",8994,1816,3,64,0)
                          ^02: Race IEN
"KRN",8994,1816,3,65,0)
                          ^03: Race HL7 Value
"KRN",8994,1816,3,66,0)
                          ^04: Race
"KRN",8994,1816,3,67,0)
                          ^05: Collection Method HL7 Value
"KRN",8994,1816,3,68,0)
                          ^06: Collection Method
"KRN",8994,1816,3,69,0)
 
"KRN",8994,1816,3,70,0)
                        Race HL7 Values
"KRN",8994,1816,3,71,0)
                          1002-5  American Indian or Alaska Native
"KRN",8994,1816,3,72,0)
                          2028-9  Asian
"KRN",8994,1816,3,73,0)
                          2054-5  Black or African American
"KRN",8994,1816,3,74,0)
                          0000-0  Declined to Answer
"KRN",8994,1816,3,75,0)
                          2076-8  Native Hawaiian or Pacific Islander
"KRN",8994,1816,3,76,0)
                          9999-4  Unknown by Patient
"KRN",8994,1816,3,77,0)
                          2106-3  White
"KRN",8994,1816,3,78,0)
 
"KRN",8994,1816,3,79,0)
                        Collection Method HL7 Values
"KRN",8994,1816,3,80,0)
                          OBS     Observer
"KRN",8994,1816,3,81,0)
                          PRX     Proxy
"KRN",8994,1816,3,82,0)
                          SLF     Self Identification
"KRN",8994,1816,3,83,0)
                          UNK     Unknown
"KRN",8994,1816,3,84,0)
 
"KRN",8994,1816,3,85,0)
  Results[i]            Ethnicity Information
"KRN",8994,1816,3,86,0)
                          ^01: "ETN"
"KRN",8994,1816,3,87,0)
                          ^02: Ethnicity IEN
"KRN",8994,1816,3,88,0)
                          ^03: Ethnicity HL7 Value
"KRN",8994,1816,3,89,0)
                          ^04: Ethnicity
"KRN",8994,1816,3,90,0)
                          ^05: Collection Method HL7 value
"KRN",8994,1816,3,91,0)
                          ^06: Collection Method
"KRN",8994,1816,3,92,0)
 
"KRN",8994,1816,3,93,0)
                        Ethnicity HL7 Values
"KRN",8994,1816,3,94,0)
                          0000-0  Declined to Answer
"KRN",8994,1816,3,95,0)
                          2135-2  Hispanic or Latino
"KRN",8994,1816,3,96,0)
                          2186-5  Not Hispanic or Latino
"KRN",8994,1816,3,97,0)
                          9999-4  Unknown by Patient
"KRN",8994,1816,3,98,0)
 
"KRN",8994,1816,3,99,0)
  Results[i]            Form Headers
"KRN",8994,1816,3,100,0)
                          ^01: "HDR"
"KRN",8994,1816,3,101,0)
                          ^02: ""
"KRN",8994,1816,3,102,0)
                          ^03: DATE CDC FORM COMPLETED (FileMan)
"KRN",8994,1816,3,103,0)
                          ^04: CDC FORM COMPLETED BY (DUZ)
"KRN",8994,1816,3,104,0)
                          ^05: CDC FORM COMPLETED BY (Name)
"KRN",8994,1816,3,105,0)
                          ^06: Phone number of person completed form
"KRN",8994,1816,3,106,0)
                          ^07: Medical Record Number
"KRN",8994,1816,3,107,0)
 
"KRN",8994,1816,3,108,0)
  Results[i]            CDC Demographics (III)
"KRN",8994,1816,3,109,0)
                          ^01: "CDM"
"KRN",8994,1816,3,110,0)
                          ^02: ""
"KRN",8994,1816,3,111,0)
                          ^03: STATUS AT REPORT {1|2}
"KRN",8994,1816,3,112,0)
                          ^04: AGE AT DIAGNOSIS
"KRN",8994,1816,3,113,0)
                          ^05: PATIENT STATUS {1|2|9}
"KRN",8994,1816,3,114,0)
                          ^06: STATE/TERRITORY OF DEATH
"KRN",8994,1816,3,115,0)
                          ^07: COUNTRY OF BIRTH {1|7|8|9}
"KRN",8994,1816,3,116,0)
                          ^08: DEPENDENCY/OTHER COUNTRY DESCRIPTION
"KRN",8994,1816,3,117,0)
                          ^09: ONSET OF ILLNESS/AIDS- CITY
"KRN",8994,1816,3,118,0)
                          ^10: ONSET OF ILLNESS/AIDS- COUNTY
"KRN",8994,1816,3,119,0)
                          ^11: ONSET OF ILLNESS/AIDS- STATE (IEN)
"KRN",8994,1816,3,120,0)
                          ^12: ONSET OF ILLNESS/AIDS- STATE (Name)
"KRN",8994,1816,3,121,0)
                          ^13: ONSET OF ILLNESS/AIDS- COUNTRY
"KRN",8994,1816,3,122,0)
                          ^14: ONSET OF ILLNESS/AIDS- ZIP
"KRN",8994,1816,3,123,0)
 
"KRN",8994,1816,3,124,0)
  Results[i]            Facility of Diagnosis (IV)
"KRN",8994,1816,3,125,0)
                          ^01: "FD"
"KRN",8994,1816,3,126,0)
                          ^02: ""
"KRN",8994,1816,3,127,0)
                          ^03: AIDS DX - HOSPITAL
"KRN",8994,1816,3,128,0)
                          ^04: AIDS DX - CITY
"KRN",8994,1816,3,129,0)
                          ^05: AIDS DX - STATE (IEN)
"KRN",8994,1816,3,130,0)
                          ^06: AIDS DX - STATE (Name)
"KRN",8994,1816,3,131,0)
                          ^07: AIDS DX - COUNTRY
"KRN",8994,1816,3,132,0)
                          ^08: AIDS DX - FACILITY SETTING {1|2|3|9}
"KRN",8994,1816,3,133,0)
                          ^09: AIDS DX - FACILITY TYPE {01|31|88}
"KRN",8994,1816,3,134,0)
                          ^10: AIDS DX - OTHER FACILITY TYPE
"KRN",8994,1816,3,135,0)
 
"KRN",8994,1816,3,136,0)
  Results[i]            Patient History (V)
"KRN",8994,1816,3,137,0)
                          ^01: "PH"
"KRN",8994,1816,3,138,0)
                          ^02: ""
"KRN",8994,1816,3,139,0)
                          ^03: SEX RELATIONS W/MALE PARTNER   {0|1|9}
"KRN",8994,1816,3,140,0)
                          ^04: SEX RELATIONS W/FEMALE PARTNER {0|1|9}
"KRN",8994,1816,3,141,0)
                          ^05: IV DRUGS AFTER 77 AND PRE HIV  {0|1|9}
"KRN",8994,1816,3,142,0)
                          ^06: REC'D CLOTTING FACTORS         {0|1|9}
"KRN",8994,1816,3,143,0)
                          ^07: TYPE OF HEMOPHILIA             {1|2|8}
"KRN",8994,1816,3,144,0)
                          ^08: OTHER HEMOPHILIA DESCRIPTION
"KRN",8994,1816,3,145,0)
                          ^09: SR WITH IV DRUG USER           {0|1|9}
"KRN",8994,1816,3,146,0)
                          ^10: SR WITH BISEXUAL MAN           {0|1|9}
"KRN",8994,1816,3,147,0)
                          ^11: SR W HEMOPHILIA/COAG DISORDER  {0|1|9}
"KRN",8994,1816,3,148,0)
                          ^12: SR W TRANS RECIPIENT WITH AIDS {0|1|9}
"KRN",8994,1816,3,149,0)
                          ^13: TRANSPLANT RECIP-DOCUMNTD HIV  {0|1|9}
"KRN",8994,1816,3,150,0)
                          ^14: SR W AIDS/HIV INFECTION        {0|1|9}
"KRN",8994,1816,3,151,0)
                          ^15: TRANS AFTER 77 AND BEFORE HIV  {0|1|9}
"KRN",8994,1816,3,152,0)
                          ^16: DATE OF FIRST TRANSFUSION      (MM/YY)
"KRN",8994,1816,3,153,0)
                          ^17: DATE OF LAST TRANSFUSION       (MM/YY)
"KRN",8994,1816,3,154,0)
                          ^18: TRANSPLANT OR ARTIF INSEMIN    {0|1|9}
"KRN",8994,1816,3,155,0)
                          ^19: WORK IN HEALTH CARE OR LAB     {0|1|9}
"KRN",8994,1816,3,156,0)
                          ^20: OCCUPATION
"KRN",8994,1816,3,157,0)
 
"KRN",8994,1816,3,158,0)
  Results[i]            Laboratory Data (VI)
"KRN",8994,1816,3,159,0)
 
"KRN",8994,1816,3,160,0)
                          ^01: "LD1"
"KRN",8994,1816,3,161,0)
                          ^02: ""
"KRN",8994,1816,3,162,0)
                          ^03: HIV-1 EIA                      {0|1|9}
"KRN",8994,1816,3,163,0)
                          ^04: HIV-1 EIA DATE                 (MM/YY)
"KRN",8994,1816,3,164,0)
                          ^05: HIV-1/HIV-2 EIA                {0|1|9}
"KRN",8994,1816,3,165,0)
                          ^06: HIV-1/HIV-2 EIA DATE           (MM/YY)
"KRN",8994,1816,3,166,0)
                          ^07: HIV-1 WESTERN BLOT/IFA         {0|1|8|9}
"KRN",8994,1816,3,167,0)
                          ^08: HIV-1 WESTERN BLOT/IFA DATE    (MM/YY)
"KRN",8994,1816,3,168,0)
                          ^09: OTHER HIV ANTIBODY TEST        {0|1|8|9}
"KRN",8994,1816,3,169,0)
                          ^10: OTHER HIV ANTIBODY TEST DATE   (MM/YY)
"KRN",8994,1816,3,170,0)
                          ^11: OTHER HIV ANTIBODY TEST DESC
"KRN",8994,1816,3,171,0)
                          ^12: Positive HIV Detection Test    {1|2|3}
"KRN",8994,1816,3,172,0)
                          ^13: Date of the HIV Detection test (MM/YY)
"KRN",8994,1816,3,173,0)
                          ^14: TYPE OF OTHER POSITIVE TEST
"KRN",8994,1816,3,174,0)
                          ^15: DATE OTHER POS DETECTION TEST  (MM/YY)
"KRN",8994,1816,3,175,0)
                          ^16: DETECTABLE VIRAL LOAD TEST {11|12|13|18}
"KRN",8994,1816,3,176,0)
                          ^17: DETECTABLE VIRAL LOAD RESULT
"KRN",8994,1816,3,177,0)
                          ^18: DETECTABLE VIRAL LOAD DATE     (MM/YY)
"KRN",8994,1816,3,178,0)
 
"KRN",8994,1816,3,179,0)
                          ^01: "LD2"
"KRN",8994,1816,3,180,0)
                          ^02: ""
"KRN",8994,1816,3,181,0)
                          ^03: TYPE FOR LAST NEG TEST
"KRN",8994,1816,3,182,0)
                          ^04: LAST DOCUMNTD NEG HIV TEST     (MM/YY)
"KRN",8994,1816,3,183,0)
                          ^05: PHYS DOCUMNTD DIAGNOSIS?       {0|1|9}
"KRN",8994,1816,3,184,0)
                          ^06: DATE PHYS DOCUMNTD DIAG        (MM/YY)
"KRN",8994,1816,3,185,0)
                          ^07: CD4+ COUNT FOR CDC
"KRN",8994,1816,3,186,0)
                          ^08: CD4+ COUNT FOR CDC DATE        (MM/YY)
"KRN",8994,1816,3,187,0)
                          ^09: CD4+ PERCENT FOR CDC
"KRN",8994,1816,3,188,0)
                          ^10: CD4+ PERCENT FOR CDC DATE      (MM/YY)
"KRN",8994,1816,3,189,0)
                          ^11: CD4 COUNT FIRST <200
"KRN",8994,1816,3,190,0)
                          ^12: CD4 COUNT FIRST <200 DATE      (MM/YY)
"KRN",8994,1816,3,191,0)
                          ^13: CD4 PERCENT FIRST <14%
"KRN",8994,1816,3,192,0)
                          ^14: CD4 PERCENT FIRST <14% DATE    (MM/YY)
"KRN",8994,1816,3,193,0)
 
"KRN",8994,1816,3,194,0)
  Results[i]            Clinical Status (VIII)
"KRN",8994,1816,3,195,0)
                          ^01: "CS"
"KRN",8994,1816,3,196,0)
                          ^02: ""
"KRN",8994,1816,3,197,0)
                          ^03: RECORD REVIEWED {0|1}
"KRN",8994,1816,3,198,0)
                          ^04: DATE ASYMPTOMATIC              (MM/YY)
"KRN",8994,1816,3,199,0)
                          ^05: DATE SYMPTOMATIC               (MM/YY)
"KRN",8994,1816,3,200,0)
                          ^06: RVCT CASE NO.
"KRN",8994,1816,3,201,0)
                          ^07: IMMUNODEF THAT DISQUALIFIES    {0|1|9}
"KRN",8994,1816,3,202,0)
 
"KRN",8994,1816,3,203,0)
  Results[i]            AIDS Indicator Disease (VIII)
"KRN",8994,1816,3,204,0)
                          ^01: "AID"
"KRN",8994,1816,3,205,0)
                          ^02: Disease Code
"KRN",8994,1816,3,206,0)
                          ^03: Initial Diagnosis              {1|2}
"KRN",8994,1816,3,207,0)
                          ^04: Initial Date                   (MM/YY)
"KRN",8994,1816,3,208,0)
 
"KRN",8994,1816,3,209,0)
                        Disease Codes:
"KRN",8994,1816,3,210,0)
                            1  CANDIDIASIS, B, T, OR L
"KRN",8994,1816,3,211,0)
                            2  CANDIDIASIS, ESOPHAGEAL
"KRN",8994,1816,3,212,0)
                            3  CARCINOMA, INVASIVE CERVICAL
"KRN",8994,1816,3,213,0)
                            4  COCCIDIOIDOMYCOSIS, DIS/EXTRAP
"KRN",8994,1816,3,214,0)
                            5  CRYPTOCOCCOSIS, EXTRAPULMONARY
"KRN",8994,1816,3,215,0)
                            6  CRYPTOSPORIDIOSIS, CHRONIC
"KRN",8994,1816,3,216,0)
                            7  CYTOMEGALOVIRUS DISEASE
"KRN",8994,1816,3,217,0)
                            8  CYTOMEGALOVIRUS RETINITIS
"KRN",8994,1816,3,218,0)
                            9  HIV ENCEPHALOPATHY
"KRN",8994,1816,3,219,0)
                           10  HERPES SIMPLEX
"KRN",8994,1816,3,220,0)
                           11  HISTOPLASMOSIS, DIS/EXTRAP
"KRN",8994,1816,3,221,0)
                           12  ISOSPORIASIS, CHRONIC INTEST
"KRN",8994,1816,3,222,0)
                           13  KAPOSI'S SARCOMA
"KRN",8994,1816,3,223,0)
                           14  LYMPHOMA, BURKITT'S
"KRN",8994,1816,3,224,0)
                           15  LYMPHOMA, IMMUNOBLASTIC
"KRN",8994,1816,3,225,0)
                           16  LYMPHOMA, PRIMARY IN BRAIN
"KRN",8994,1816,3,226,0)
                           17  MYCOBACTERIUM AVIUM COMPLEX
"KRN",8994,1816,3,227,0)
                           18  M. TUBERCULOSIS, PULMONARY
"KRN",8994,1816,3,228,0)
                           19  M TUBERCULOSIS, DIS/EXTRAP
"KRN",8994,1816,3,229,0)
                           20  MYCOBACTERIUM
"KRN",8994,1816,3,230,0)
                           21  PNEUMOCYSTIS CARINII PNEUMONIA
"KRN",8994,1816,3,231,0)
                           22  PNEUMONIA, RECURRENT IN 12 MO
"KRN",8994,1816,3,232,0)
                           23  PROGRESSIVE MULTIFOCAL LEUKO
"KRN",8994,1816,3,233,0)
                           24  SALMONELLA SEPTICEMIA, RECURR
"KRN",8994,1816,3,234,0)
                           25  TOXOPLASMOSIS OF BRAIN
"KRN",8994,1816,3,235,0)
                           26  WASTING SYNDROME DUE TO HIV
"KRN",8994,1816,3,236,0)
 
"KRN",8994,1816,3,237,0)
  Results[i]            Treatment/Services (IX)
"KRN",8994,1816,3,238,0)
 
"KRN",8994,1816,3,239,0)
                          ^01: "TS1"
"KRN",8994,1816,3,240,0)
                          ^02: ""
"KRN",8994,1816,3,241,0)
                          ^03: PATIENT BEEN INFORMED OF HIV   {0|1|9}
"KRN",8994,1816,3,242,0)
                          ^04: PARTNERS NOTIFIED BY           {1|2|3|9}
"KRN",8994,1816,3,243,0)
                          ^05: HIV RELATED MED SERVICES
"KRN",8994,1816,3,244,0)
                          ^06: SUBSTANCE ABUSE TREATMENT      {0|1|8|9}
"KRN",8994,1816,3,245,0)
                          ^07: RCVD ANTI-RETROVIRAL THERAPY   {0|1|9}
"KRN",8994,1816,3,246,0)
                          ^08: RECEIVED PCP PROPHYLAXIS       {0|1|9}
"KRN",8994,1816,3,247,0)
                          ^09: ENROLLED AT CLINCAL TRIAL      {1|2|3|9}
"KRN",8994,1816,3,248,0)
                          ^10: ENROLLED AT CLINIC             {1|2|3|9}
"KRN",8994,1816,3,249,0)
                          ^11: PRIMARY REIMBURSER FOR MED RX {1|2|3|4|7|9}
"KRN",8994,1816,3,250,0)
 
"KRN",8994,1816,3,251,0)
                          ^01: "TS2"
"KRN",8994,1816,3,252,0)
                          ^02: ""    
"KRN",8994,1816,3,253,0)
                          ^03: GYNECOLOGY OR OBSTETRIC CARE   {0|1|9}
"KRN",8994,1816,3,254,0)
                          ^04: CURRENTLY PREGNANT             {0|1|9}
"KRN",8994,1816,3,255,0)
                          ^05: DELIVERED LIVE BORN INFANT     {0|1|9}
"KRN",8994,1816,3,256,0)
                          ^06: CHILD'S DATE OF BIRTH
"KRN",8994,1816,3,257,0)
                          ^07: CHILD'S HOSPITAL OF BIRTH
"KRN",8994,1816,3,258,0)
                          ^08: CHILD'S HOSPITAL - CITY
"KRN",8994,1816,3,259,0)
                          ^09: CHILD'S HOSPITAL - STATE
"KRN",8994,1816,3,260,0)
 
"KRN",8994,1816,3,261,0)
  Results[i]            Comments (X)
"KRN",8994,1816,3,262,0)
                          ^01: "CMT"
"KRN",8994,1816,3,263,0)
                          ^02: [1-3]
"KRN",8994,1816,3,264,0)
                          ^03: Comment
"KRN",8994,1818,-1)
0^35
"KRN",8994,1818,0)
ROR LIST STATES^STATELST^RORRP029^4^R^^^1^1
"KRN",8994,1818,1,0)
^8994.01^2^2^3030425^^
"KRN",8994,1818,1,1,0)
The ROR LIST STATES remote procedure returns a list of states that conform
"KRN",8994,1818,1,2,0)
the search criteria.
"KRN",8994,1818,2,0)
^8994.02A^4^4
"KRN",8994,1818,2,1,0)
PART^1^30^1^1
"KRN",8994,1818,2,1,1,0)
^^4^4^3030414^
"KRN",8994,1818,2,1,1,1,0)
The PART parameter defines the search pattern. If it contains 2 character
"KRN",8994,1818,2,1,1,2,0)
abbreviation of the state and the FLAGS parameter contains "A" then the
"KRN",8994,1818,2,1,1,3,0)
corresponding state is returned (see the FLAGS parameter for more
"KRN",8994,1818,2,1,1,4,0)
details). Otherwise, the regular search among state names is performed.
"KRN",8994,1818,2,2,0)
FLAGS^1^^^2
"KRN",8994,1818,2,2,1,0)
^^10^10^3030414^
"KRN",8994,1818,2,2,1,1,0)
Flags that control the execution (can be combined):
"KRN",8994,1818,2,2,1,2,0)
 
"KRN",8994,1818,2,2,1,3,0)
  A  Enable abbreviation search. If PART contains 2
"KRN",8994,1818,2,2,1,4,0)
     character abbreviation, the corresponding state
"KRN",8994,1818,2,2,1,5,0)
     is returned. If the length of PART parameter is
"KRN",8994,1818,2,2,1,6,0)
     not equal 2 or it does not contain a valid state
"KRN",8994,1818,2,2,1,7,0)
     abbreviation then the regular search is performed.
"KRN",8994,1818,2,2,1,8,0)
 
"KRN",8994,1818,2,2,1,9,0)
  B  Backwards. Traverses the index in the opposite
"KRN",8994,1818,2,2,1,10,0)
     direction of normal traversal.
"KRN",8994,1818,2,3,0)
NUMBER^1^^^3
"KRN",8994,1818,2,3,1,0)
^^2^2^3030414^
"KRN",8994,1818,2,3,1,1,0)
Maximum number of entries to return. A value of "*" or no value in this 
"KRN",8994,1818,2,3,1,2,0)
parameter designates all entries that conform the criteria.
"KRN",8994,1818,2,4,0)
FROM^1^^^4
"KRN",8994,1818,2,4,1,0)
^^9^9^3030425^
"KRN",8994,1818,2,4,1,1,0)
The index entry(s) from which to begin the list. Use the pieces of the
"KRN",8994,1818,2,4,1,2,0)
Results[0] (starting from the second one) to continue the listing in the
"KRN",8994,1818,2,4,1,3,0)
subsequent procedure calls.
"KRN",8994,1818,2,4,1,4,0)
  
"KRN",8994,1818,2,4,1,5,0)
NOTE: The FROM value itself is not included in the
"KRN",8994,1818,2,4,1,6,0)
      resulting list.
"KRN",8994,1818,2,4,1,7,0)
  
"KRN",8994,1818,2,4,1,8,0)
See description of the LIST^DIC for more details about the PART, NUMBER
"KRN",8994,1818,2,4,1,9,0)
and FROM parameters.
"KRN",8994,1818,2,"B","FLAGS",2)

"KRN",8994,1818,2,"B","FROM",4)

"KRN",8994,1818,2,"B","NUMBER",3)

"KRN",8994,1818,2,"B","PART",1)

"KRN",8994,1818,2,"PARAMSEQ",1,1)

"KRN",8994,1818,2,"PARAMSEQ",2,2)

"KRN",8994,1818,2,"PARAMSEQ",3,3)

"KRN",8994,1818,2,"PARAMSEQ",4,4)

"KRN",8994,1818,3,0)
^^28^28^3030425^
"KRN",8994,1818,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1818,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1818,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1818,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1818,3,5,0)
   
"KRN",8994,1818,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1818,3,7,0)
                          ^01: The last error code
"KRN",8994,1818,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1818,3,9,0)
   
"KRN",8994,1818,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1818,3,11,0)
                          ^01: Error code
"KRN",8994,1818,3,12,0)
                          ^02: Message
"KRN",8994,1818,3,13,0)
                          ^03: Place of the error
"KRN",8994,1818,3,14,0)
 
"KRN",8994,1818,3,15,0)
Otherwise, number of states and the value of the FROM parameter for the 
"KRN",8994,1818,3,16,0)
next procedure call are returned in the Results[0] and the subsequent 
"KRN",8994,1818,3,17,0)
nodes of the global array contain the states.
"KRN",8994,1818,3,18,0)
 
"KRN",8994,1818,3,19,0)
  Results[0]            Result Descriptor
"KRN",8994,1818,3,20,0)
                          ^01: Number of states
"KRN",8994,1818,3,21,0)
                          ^02: Values that comprise the FROM
"KRN",8994,1818,3,22,0)
                          ^nn: parameter for the subsequent call
"KRN",8994,1818,3,23,0)
                                                                     
"KRN",8994,1818,3,24,0)
  Results[i]            State
"KRN",8994,1818,3,25,0)
                          ^01: IEN
"KRN",8994,1818,3,26,0)
                          ^02: Name
"KRN",8994,1818,3,27,0)
                          ^03: Abbreviation
"KRN",8994,1818,3,28,0)
                          ^04: VA State Code
"KRN",8994,1819,-1)
0^69
"KRN",8994,1819,0)
RORICR CDC SAVE^SAVECDC^RORRP027^2^R^^^1^1
"KRN",8994,1819,1,0)
^8994.01^2^2^3040416^^^^
"KRN",8994,1819,1,1,0)
The RORICR CDC SAVE remote procedure updates the fields that are used by 
"KRN",8994,1819,1,2,0)
the ICR CDC form.
"KRN",8994,1819,2,0)
^8994.02A^4^4
"KRN",8994,1819,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1819,2,1,1,0)
^8994.021^2^2^3030415^^
"KRN",8994,1819,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,1819,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1819,2,2,0)
PATIEN^1^^1^2
"KRN",8994,1819,2,2,1,0)
^8994.021^1^1^3030415^^
"KRN",8994,1819,2,2,1,1,0)
A valid patient IEN (DFN) should be assigned to the PATIEN parameter.
"KRN",8994,1819,2,3,0)
DATA^2^^1^4
"KRN",8994,1819,2,3,1,0)
^^25^25^3030415^
"KRN",8994,1819,2,3,1,1,0)
A list that contains the CDC data in the same format as the output of the
"KRN",8994,1819,2,3,1,2,0)
RORICR CDC LOAD remote procedure (see the RORRP025 routine and description
"KRN",8994,1819,2,3,1,3,0)
of the RPC for more details).
"KRN",8994,1819,2,3,1,4,0)
 
"KRN",8994,1819,2,3,1,5,0)
Example:
"KRN",8994,1819,2,3,1,6,0)
 
"KRN",8994,1819,2,3,1,7,0)
  with RPCBroker.Param[3] do
"KRN",8994,1819,2,3,1,8,0)
    begin
"KRN",8994,1819,2,3,1,9,0)
      PType := list;
"KRN",8994,1819,2,3,1,10,0)
      Mult[1] := 'HDR^^2990622';
"KRN",8994,1819,2,3,1,11,0)
      Mult[2] := 'CDM^^2^22^1^^1^^Westmont^Du Page^17^ILLINOIS^US';
"KRN",8994,1819,2,3,1,12,0)
      ...
"KRN",8994,1819,2,3,1,13,0)
      Mult[n] := 'CMT^1^Just a sample CDC comment';
"KRN",8994,1819,2,3,1,14,0)
    end;
"KRN",8994,1819,2,3,1,15,0)
 
"KRN",8994,1819,2,3,1,16,0)
NOTE #1: The CS data segment must be always included before the
"KRN",8994,1819,2,3,1,17,0)
         AID segments. Otherwise, the latter will be ignored.
"KRN",8994,1819,2,3,1,18,0)
                                                                    
"KRN",8994,1819,2,3,1,19,0)
NOTE #2: Any AIDS indicator disease, which has empty 3rd piece
"KRN",8994,1819,2,3,1,20,0)
         in the corresponding AID segment (or no segment at all),
"KRN",8994,1819,2,3,1,21,0)
         will be removed from the patient record.
"KRN",8994,1819,2,3,1,22,0)
    
"KRN",8994,1819,2,3,1,23,0)
NOTE #3: There should be at least one empty comment (i.e. the
"KRN",8994,1819,2,3,1,24,0)
         "CMT^1" segment) among the data if you want to clear
"KRN",8994,1819,2,3,1,25,0)
         the CDC comments. Otherwise, they will not be updated.
"KRN",8994,1819,2,4,0)
FLAGS^1^^^3
"KRN",8994,1819,2,4,1,0)
^8994.021^4^4^3040416^^^^
"KRN",8994,1819,2,4,1,1,0)
Flags that control the execution (can be combined):
"KRN",8994,1819,2,4,1,2,0)
 
"KRN",8994,1819,2,4,1,3,0)
  H  Update the patient history. If this flag is
"KRN",8994,1819,2,4,1,4,0)
     not provided, the PH data segment is ignored.
"KRN",8994,1819,2,"B","DATA",3)

"KRN",8994,1819,2,"B","FLAGS",4)

"KRN",8994,1819,2,"B","PATIEN",2)

"KRN",8994,1819,2,"B","REGIEN",1)

"KRN",8994,1819,2,"PARAMSEQ",1,1)

"KRN",8994,1819,2,"PARAMSEQ",2,2)

"KRN",8994,1819,2,"PARAMSEQ",3,4)

"KRN",8994,1819,2,"PARAMSEQ",4,3)

"KRN",8994,1819,3,0)
^8994.03^21^21^3040416^^
"KRN",8994,1819,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1819,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1819,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1819,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1819,3,5,0)
   
"KRN",8994,1819,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1819,3,7,0)
                          ^01: The last error code
"KRN",8994,1819,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1819,3,9,0)
                                                                      
"KRN",8994,1819,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1819,3,11,0)
                          ^01: Error code
"KRN",8994,1819,3,12,0)
                          ^02: Message
"KRN",8994,1819,3,13,0)
                          ^03: Place of the error
"KRN",8994,1819,3,14,0)
 
"KRN",8994,1819,3,15,0)
A positive value of the first "^"-piece of the Results[0] indicates an
"KRN",8994,1819,3,16,0)
error in the CDC data. The value is the number of the erroneous piece of
"KRN",8994,1819,3,17,0)
the data segment whose name is returned in the second piece of the
"KRN",8994,1819,3,18,0)
Results[0]. For example, the "11^CDM" means that the 11th piece of the CDM
"KRN",8994,1819,3,19,0)
data segment (ONSET OF ILLNESS/AIDS- STATE) contains an invalid value.
"KRN",8994,1819,3,20,0)
    
"KRN",8994,1819,3,21,0)
Otherwise, zero is returned in the Results[0].
"KRN",8994,1852,-1)
0^17
"KRN",8994,1852,0)
ROR GET USER INFO^USERINFO^RORRP024^2^R^^^1^1
"KRN",8994,1852,1,0)
^8994.01^2^2^3040803^^^^
"KRN",8994,1852,1,1,0)
The ROR GET USER INFO remote procedure returns basic information about the
"KRN",8994,1852,1,2,0)
user.
"KRN",8994,1852,2,0)
^8994.02A^1^1
"KRN",8994,1852,2,1,0)
USER^1^^^1
"KRN",8994,1852,2,1,1,0)
^8994.021^2^2^3040803^^^^
"KRN",8994,1852,2,1,1,1,0)
User IEN in the NEW PERSON file. By default (if $G(USER)'>0), the DUZ is
"KRN",8994,1852,2,1,1,2,0)
used).
"KRN",8994,1852,2,"B","USER",1)

"KRN",8994,1852,2,"PARAMSEQ",1,1)

"KRN",8994,1852,3,0)
^^31^31^3040803^
"KRN",8994,1852,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1852,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1852,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1852,3,4,0)
descriptors returned in the subsequent nodes of the Results array.
"KRN",8994,1852,3,5,0)
 
"KRN",8994,1852,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1852,3,7,0)
                          ^01: The last error code (LASTERR)
"KRN",8994,1852,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1852,3,9,0)
 
"KRN",8994,1852,3,10,0)
 
"KRN",8994,1852,3,11,0)
  Results[i]            Error Descriptor
"KRN",8994,1852,3,12,0)
                          ^01: Error code
"KRN",8994,1852,3,13,0)
                          ^02: Message
"KRN",8994,1852,3,14,0)
                          ^03: Place of the error
"KRN",8994,1852,3,15,0)
 
"KRN",8994,1852,3,16,0)
Error descriptors are returned in reverse chronological order (most recent
"KRN",8994,1852,3,17,0)
error first).
"KRN",8994,1852,3,18,0)
 
"KRN",8994,1852,3,19,0)
Otherwise, the user info is returned in the Results[0].
"KRN",8994,1852,3,20,0)
 
"KRN",8994,1852,3,21,0)
  Results[0]            User Info
"KRN",8994,1852,3,22,0)
                          ^01: IEN
"KRN",8994,1852,3,23,0)
                          ^02: Name
"KRN",8994,1852,3,24,0)
                          ^03: Office Phone
"KRN",8994,1852,3,25,0)
                          ^04: Nickname
"KRN",8994,1852,3,26,0)
                          ^05: Read Timeout
"KRN",8994,1852,3,27,0)
                          ^06: Default Division IEN
"KRN",8994,1852,3,28,0)
                          ^07: Default Division Name
"KRN",8994,1852,3,29,0)
                          ^08: Institution IEN
"KRN",8994,1852,3,30,0)
                          ^09: Institution Name
"KRN",8994,1852,3,31,0)
                          ^10: Station Number (with suffix)
"KRN",8994,1853,-1)
0^46
"KRN",8994,1853,0)
ROR PATIENT GET DATA^GETPTDAT^RORRP021^2^R^^^1^1
"KRN",8994,1853,1,0)
^8994.01^2^2^3050819^^^^
"KRN",8994,1853,1,1,0)
The ROR GET PATIENT DATA remote procedure returns patient's data from the 
"KRN",8994,1853,1,2,0)
PATIENT file and (optionally) the registry record.
"KRN",8994,1853,2,0)
^8994.02A^3^3
"KRN",8994,1853,2,1,0)
PATIEN^1^^1^1
"KRN",8994,1853,2,1,1,0)
^^1^1^3030613^
"KRN",8994,1853,2,1,1,1,0)
A valid patient IEN (DFN) should be assigned to the PATIEN parameter.
"KRN",8994,1853,2,2,0)
FLAGS^1^^^2
"KRN",8994,1853,2,2,1,0)
^8994.021^10^10^3050819^^
"KRN",8994,1853,2,2,1,1,0)
Flags that control the execution (can be combined):
"KRN",8994,1853,2,2,1,2,0)
 
"KRN",8994,1853,2,2,1,3,0)
  A  Load the patient's address
"KRN",8994,1853,2,2,1,4,0)
  E  Load the ethnicity information
"KRN",8994,1853,2,2,1,5,0)
  L  Load values of the registry local fields
"KRN",8994,1853,2,2,1,6,0)
  R  Load the race information
"KRN",8994,1853,2,2,1,7,0)
  S  Load the patient's selection rules
"KRN",8994,1853,2,2,1,8,0)
 
"KRN",8994,1853,2,2,1,9,0)
The "L" and "S" flags require the REGIEN parameter. Otherwise, they are
"KRN",8994,1853,2,2,1,10,0)
ignored.
"KRN",8994,1853,2,3,0)
REGIEN^1^^^3
"KRN",8994,1853,2,3,1,0)
^8994.021^7^7^3050819^^^^
"KRN",8994,1853,2,3,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,1853,2,3,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1853,2,3,1,3,0)
 
"KRN",8994,1853,2,3,1,4,0)
If this parameter is defined and its value is greater than 0 then the
"KRN",8994,1853,2,3,1,5,0)
"PRD" segment with the basic patient's registry data will be returned.
"KRN",8994,1853,2,3,1,6,0)
If the patient is not in the registry then an empty "PRD" segment will
"KRN",8994,1853,2,3,1,7,0)
be returned anyway.
"KRN",8994,1853,2,"B","FLAGS",2)

"KRN",8994,1853,2,"B","PATIEN",1)

"KRN",8994,1853,2,"B","REGIEN",3)

"KRN",8994,1853,2,"PARAMSEQ",1,1)

"KRN",8994,1853,2,"PARAMSEQ",2,2)

"KRN",8994,1853,2,"PARAMSEQ",3,3)

"KRN",8994,1853,3,0)
^8994.03^133^133^3050819^^
"KRN",8994,1853,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1853,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1853,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1853,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1853,3,5,0)
  
"KRN",8994,1853,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1853,3,7,0)
                          ^01: The last error code
"KRN",8994,1853,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1853,3,9,0)
   
"KRN",8994,1853,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1853,3,11,0)
                          ^01: Error code
"KRN",8994,1853,3,12,0)
                          ^02: Message
"KRN",8994,1853,3,13,0)
                          ^03: Place of the error
"KRN",8994,1853,3,14,0)
 
"KRN",8994,1853,3,15,0)
Otherwise, zero is returned in the Results[0] and subsequent nodes 
"KRN",8994,1853,3,16,0)
contain the patient's data.
"KRN",8994,1853,3,17,0)
 
"KRN",8994,1853,3,18,0)
  Results[0]            0
"KRN",8994,1853,3,19,0)
 
"KRN",8994,1853,3,20,0)
  Results[i]            Demographic Information
"KRN",8994,1853,3,21,0)
                          ^01: "DEM"
"KRN",8994,1853,3,22,0)
                          ^02: ""
"KRN",8994,1853,3,23,0)
                          ^03: Patient IEN (DFN)
"KRN",8994,1853,3,24,0)
                          ^04: Patient Name
"KRN",8994,1853,3,25,0)
                          ^05: Date of Birth (FileMan)
"KRN",8994,1853,3,26,0)
                          ^06: SSN
"KRN",8994,1853,3,27,0)
                          ^07: Date of Death (FileMan)
"KRN",8994,1853,3,28,0)
                          ^08: Sex (F/M)
"KRN",8994,1853,3,29,0)
 
"KRN",8994,1853,3,30,0)
  Results[i]            Patient's Address
"KRN",8994,1853,3,31,0)
                          ^01: "ADR"
"KRN",8994,1853,3,32,0)
                          ^02: ""
"KRN",8994,1853,3,33,0)
                          ^03: Address (1)
"KRN",8994,1853,3,34,0)
                          ^04: Address (2)
"KRN",8994,1853,3,35,0)
                          ^05: Address (3)
"KRN",8994,1853,3,36,0)
                          ^06: City
"KRN",8994,1853,3,37,0)
                          ^07: State (IEN)
"KRN",8994,1853,3,38,0)
                          ^08: State (Name)
"KRN",8994,1853,3,39,0)
                          ^09: ZIP
"KRN",8994,1853,3,40,0)
                          ^10: ZIP+4
"KRN",8994,1853,3,41,0)
                          ^11: County (IEN)
"KRN",8994,1853,3,42,0)
                          ^12: County (Name)
"KRN",8994,1853,3,43,0)
                          ^13: Home Phone
"KRN",8994,1853,3,44,0)
 
"KRN",8994,1853,3,45,0)
  Results[i]            Race Information
"KRN",8994,1853,3,46,0)
                          ^01: "RCE"
"KRN",8994,1853,3,47,0)
                          ^02: Race IEN
"KRN",8994,1853,3,48,0)
                          ^03: Race HL7 Value
"KRN",8994,1853,3,49,0)
                          ^04: Race
"KRN",8994,1853,3,50,0)
                          ^05: Collection Method HL7 Value
"KRN",8994,1853,3,51,0)
                          ^06: Collection Method
"KRN",8994,1853,3,52,0)
 
"KRN",8994,1853,3,53,0)
                        Race HL7 Values
"KRN",8994,1853,3,54,0)
                          1002-5  American Indian or Alaska Native
"KRN",8994,1853,3,55,0)
                          2028-9  Asian
"KRN",8994,1853,3,56,0)
                          2054-5  Black or African American
"KRN",8994,1853,3,57,0)
                          0000-0  Declined to Answer
"KRN",8994,1853,3,58,0)
                          2076-8  Native Hawaiian or Pacific Islander
"KRN",8994,1853,3,59,0)
                          9999-4  Unknown by Patient
"KRN",8994,1853,3,60,0)
                          2106-3  White
"KRN",8994,1853,3,61,0)
 
"KRN",8994,1853,3,62,0)
                        Collection Method HL7 Values
"KRN",8994,1853,3,63,0)
                          OBS     Observer
"KRN",8994,1853,3,64,0)
                          PRX     Proxy
"KRN",8994,1853,3,65,0)
                          SLF     Self Identification
"KRN",8994,1853,3,66,0)
                          UNK     Unknown
"KRN",8994,1853,3,67,0)
 
"KRN",8994,1853,3,68,0)
  Results[i]            Ethnicity Information
"KRN",8994,1853,3,69,0)
                          ^01: "ETN"
"KRN",8994,1853,3,70,0)
                          ^02: Ethnicity IEN
"KRN",8994,1853,3,71,0)
                          ^03: Ethnicity HL7 Value
"KRN",8994,1853,3,72,0)
                          ^04: Ethnicity
"KRN",8994,1853,3,73,0)
                          ^05: Collection Method HL7 value
"KRN",8994,1853,3,74,0)
                          ^06: Collection Method
"KRN",8994,1853,3,75,0)
 
"KRN",8994,1853,3,76,0)
                        Ethnicity HL7 Values
"KRN",8994,1853,3,77,0)
                          0000-0  Declined to Answer
"KRN",8994,1853,3,78,0)
                          2135-2  Hispanic or Latino
"KRN",8994,1853,3,79,0)
                          2186-5  Not Hispanic or Latino
"KRN",8994,1853,3,80,0)
                          9999-4  Unknown by Patient
"KRN",8994,1853,3,81,0)
 
"KRN",8994,1853,3,82,0)
  Results[i]            Patient's Registry Data
"KRN",8994,1853,3,83,0)
                          ^01: "PRD"
"KRN",8994,1853,3,84,0)
                          ^02: ""
"KRN",8994,1853,3,85,0)
                          ^03: Date Entered (FileMan)
"KRN",8994,1853,3,86,0)
                          ^04: Status Code (Field 3, File #798)
"KRN",8994,1853,3,87,0)
                          ^05: Active (0/1)
"KRN",8994,1853,3,88,0)
                          ^06: Do not Send (0/1)
"KRN",8994,1853,3,89,0)
                          ^07: Data Acknowledged Until (FileMan)
"KRN",8994,1853,3,90,0)
                          ^08: Data Extracted Until (FileMan)
"KRN",8994,1853,3,91,0)
                          ^09: Date Selected (FileMan)
"KRN",8994,1853,3,92,0)
                          ^10: Date Confirmed (FileMan)
"KRN",8994,1853,3,93,0)
                          ^11: Location Selected (Institution Name)
"KRN",8994,1853,3,94,0)
                          ^12: reserved
"KRN",8994,1853,3,95,0)
                          ^13: reserved
"KRN",8994,1853,3,96,0)
                          ^14: reserved
"KRN",8994,1853,3,97,0)
                          ^15: Action Flags (see the description below)
"KRN",8994,1853,3,98,0)
 
"KRN",8994,1853,3,99,0)
                        The Status field can have the following values
"KRN",8994,1853,3,100,0)
                        (see description of the STATUS field of the
"KRN",8994,1853,3,101,0)
                        ROR REGISTRY RECORD file for more details):
"KRN",8994,1853,3,102,0)
                            0  Confirmed
"KRN",8994,1853,3,103,0)
                            4  Pending
"KRN",8994,1853,3,104,0)
                            5  Deleted
"KRN",8994,1853,3,105,0)
 
"KRN",8994,1853,3,106,0)
                        The Action Flags field indicates the actions that
"KRN",8994,1853,3,107,0)
                        can be performed on the patient's record:
"KRN",8994,1853,3,108,0)
                            C  CDC form can be edited/printed
"KRN",8994,1853,3,109,0)
                            D  The record can be deleted
"KRN",8994,1853,3,110,0)
                            E  The record can be edited
"KRN",8994,1853,3,111,0)
                            O  Read-only mode
"KRN",8994,1853,3,112,0)
 
"KRN",8994,1853,3,113,0)
  Results[i]            Local field data
"KRN",8994,1853,3,114,0)
                          ^O1: "LFV"
"KRN",8994,1853,3,115,0)
                          ^02: IEN in the LOCAL FIELD multiple
"KRN",8994,1853,3,116,0)
                               of the ROR REGISTRY RECORD file
"KRN",8994,1853,3,117,0)
                          ^03: Field Definition IEN
"KRN",8994,1853,3,118,0)
                               (in the ROR LOCAL FIELD file)
"KRN",8994,1853,3,119,0)
                          ^04: Field Name
"KRN",8994,1853,3,120,0)
                          ^05: Date (FileMan)
"KRN",8994,1853,3,121,0)
                          ^06: Comment
"KRN",8994,1853,3,122,0)
 
"KRN",8994,1853,3,123,0)
  Results[i]            Selection Rule
"KRN",8994,1853,3,124,0)
                          ^01: "PSR"
"KRN",8994,1853,3,125,0)
                          ^02: IEN in the SELECTION RULE multiple
"KRN",8994,1853,3,126,0)
                               of the ROR REGISTRY RECORD file
"KRN",8994,1853,3,127,0)
                          ^03: Rule Definition IEN
"KRN",8994,1853,3,128,0)
                               (in the ROR SELECTION RULE file)
"KRN",8994,1853,3,129,0)
                          ^04: Name of the Rule
"KRN",8994,1853,3,130,0)
                          ^05: Date (FileMan)
"KRN",8994,1853,3,131,0)
                          ^06: Location IEN  (Institution IEN)
"KRN",8994,1853,3,132,0)
                          ^07: Location Name (Institution Name)
"KRN",8994,1853,3,133,0)
                          ^08: Short Description
"KRN",8994,1855,-1)
0^45
"KRN",8994,1855,0)
ROR PATIENT DELETE^DELETE^RORRP030^2^R^^^1^1
"KRN",8994,1855,1,0)
^8994.01^2^2^3050804^^
"KRN",8994,1855,1,1,0)
The ROR PATIENT DELETE remote procedure marks the patient's record as 
"KRN",8994,1855,1,2,0)
deleted from the registry.
"KRN",8994,1855,2,0)
^8994.02A^3^3
"KRN",8994,1855,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1855,2,1,1,0)
^^2^2^3030624^
"KRN",8994,1855,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,1855,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1855,2,2,0)
RORDFN^1^^1^2
"KRN",8994,1855,2,2,1,0)
^8994.021^1^1^3050804^^
"KRN",8994,1855,2,2,1,1,0)
A valid patient IEN (DFN) should be assigned to the RORDFN parameter.
"KRN",8994,1855,2,3,0)
FORCE^1^^^3
"KRN",8994,1855,2,3,1,0)
^^1^1^3050804^
"KRN",8994,1855,2,3,1,1,0)
Deprecated
"KRN",8994,1855,2,"B","FORCE",3)

"KRN",8994,1855,2,"B","REGIEN",1)

"KRN",8994,1855,2,"B","RORDFN",2)

"KRN",8994,1855,2,"PARAMSEQ",1,1)

"KRN",8994,1855,2,"PARAMSEQ",2,2)

"KRN",8994,1855,2,"PARAMSEQ",3,3)

"KRN",8994,1855,3,0)
^8994.03^18^18^3050804^^
"KRN",8994,1855,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1855,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1855,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1855,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1855,3,5,0)
   
"KRN",8994,1855,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1855,3,7,0)
                          ^01: The last error code
"KRN",8994,1855,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1855,3,9,0)
   
"KRN",8994,1855,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1855,3,11,0)
                          ^01: Error code
"KRN",8994,1855,3,12,0)
                          ^02: Message
"KRN",8994,1855,3,13,0)
                          ^03: Place of the error
"KRN",8994,1855,3,14,0)
  
"KRN",8994,1855,3,15,0)
Otherwise, the following codes can be returned in the Results[0]:
"KRN",8994,1855,3,16,0)
 
"KRN",8994,1855,3,17,0)
  0  The record cannot be deleted
"KRN",8994,1855,3,18,0)
  9  The record has been marked as deleted
"KRN",8994,1856,-1)
0^32
"KRN",8994,1856,0)
ROR LIST LOCAL LAB TESTS^LTLIST^RORRP031^4^A^^^1^1
"KRN",8994,1856,1,0)
^^3^3^3030625^
"KRN",8994,1856,1,1,0)
The ROR LIST LOCAL LAB TESTS remote procedure returns a list of local lab 
"KRN",8994,1856,1,2,0)
tests, which are referenced by the LOCAL TEST NAME multiple (28) of the
"KRN",8994,1856,1,3,0)
ROR REGISTRY PARAMETERS file (#798.1).
"KRN",8994,1856,2,0)
^8994.02A^2^2
"KRN",8994,1856,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1856,2,1,1,0)
^^2^2^3030624^
"KRN",8994,1856,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the 
"KRN",8994,1856,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1856,2,2,0)
GROUP^1^^^2
"KRN",8994,1856,2,2,1,0)
^8994.021^3^3^3030625^^^
"KRN",8994,1856,2,2,1,1,0)
If this parameter is defined and not zero, it should contain a valid code
"KRN",8994,1856,2,2,1,2,0)
of the Lab Group. In this case, only the tests associated with this group
"KRN",8994,1856,2,2,1,3,0)
will be returned.
"KRN",8994,1856,2,"B","GROUP",2)

"KRN",8994,1856,2,"B","REGIEN",1)

"KRN",8994,1856,2,"PARAMSEQ",1,1)

"KRN",8994,1856,2,"PARAMSEQ",2,2)

"KRN",8994,1856,3,0)
^8994.03^24^24^3030625^^^
"KRN",8994,1856,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1856,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1856,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1856,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1856,3,5,0)
  
"KRN",8994,1856,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1856,3,7,0)
                          ^01: The last error code
"KRN",8994,1856,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1856,3,9,0)
                                                                      
"KRN",8994,1856,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1856,3,11,0)
                          ^01: Error code
"KRN",8994,1856,3,12,0)
                          ^02: Message
"KRN",8994,1856,3,13,0)
                          ^03: Place of the error
"KRN",8994,1856,3,14,0)
 
"KRN",8994,1856,3,15,0)
Otherwise, number of lab tests is returned in the Results[0] and the 
"KRN",8994,1856,3,16,0)
subsequent nodes of the global array contain the tests.
"KRN",8994,1856,3,17,0)
 
"KRN",8994,1856,3,18,0)
  Results[0]            Number of Local Tests
"KRN",8994,1856,3,19,0)
 
"KRN",8994,1856,3,20,0)
  Results[i]            Test Descriptor
"KRN",8994,1856,3,21,0)
                          ^01: IEN in the LOCAL TEST NAME multiple
"KRN",8994,1856,3,22,0)
                          ^02: Local test name
"KRN",8994,1856,3,23,0)
                          ^03: IEN of the local test (in the file #60)
"KRN",8994,1856,3,24,0)
                          ^04: Code of the Lab Group
"KRN",8994,1857,-1)
0^63
"KRN",8994,1857,0)
ROR UPDATE LOCAL LAB TESTS^LTLUPD^RORRP031^2^R^^^1^1
"KRN",8994,1857,1,0)
^8994.01^3^3^3050215^^
"KRN",8994,1857,1,1,0)
The ROR UPDATE LOCAL LAB TESTS remote procedure updates the list of local
"KRN",8994,1857,1,2,0)
Lab test names, which is stored in the LOCAL TEST NAME (28) multiple of
"KRN",8994,1857,1,3,0)
the ROR REGISTRY PARAMETERS file (#798.1).
"KRN",8994,1857,2,0)
^8994.02A^3^3
"KRN",8994,1857,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1857,2,1,1,0)
^^2^2^3030625^
"KRN",8994,1857,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the 
"KRN",8994,1857,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1857,2,2,0)
LTLST^2^^1^3
"KRN",8994,1857,2,2,1,0)
^^17^17^3030625^
"KRN",8994,1857,2,2,1,1,0)
The LTLST parameter should be an array containing a list of laboratory 
"KRN",8994,1857,2,2,1,2,0)
test IEN's and Lab Group codes. An item of the list should have the 
"KRN",8994,1857,2,2,1,3,0)
following format:
"KRN",8994,1857,2,2,1,4,0)
 
"KRN",8994,1857,2,2,1,5,0)
  ^01: Ignored
"KRN",8994,1857,2,2,1,6,0)
  ^02: Ignored
"KRN",8994,1857,2,2,1,7,0)
  ^03: IEN of the local test (in file #60)
"KRN",8994,1857,2,2,1,8,0)
  ^04: Code of the Lab Group
"KRN",8994,1857,2,2,1,9,0)
       (see also the GROUP parameter)
"KRN",8994,1857,2,2,1,10,0)
  
"KRN",8994,1857,2,2,1,11,0)
Example:
"KRN",8994,1857,2,2,1,12,0)
  with RPCBroker.Param[1] do
"KRN",8994,1857,2,2,1,13,0)
    begin
"KRN",8994,1857,2,2,1,14,0)
      PType :=list;
"KRN",8994,1857,2,2,1,15,0)
      for i := 1 to Tests.Count do
"KRN",8994,1857,2,2,1,16,0)
        Mult[i] := '^^' + Tests[i-1].TestIEN + '^' + Tests[i-1].GroupCode;
"KRN",8994,1857,2,2,1,17,0)
    end;
"KRN",8994,1857,2,3,0)
GROUP^1^^1^2
"KRN",8994,1857,2,3,1,0)
^^8^8^3050215^
"KRN",8994,1857,2,3,1,1,0)
If the GROUP parameter is equal to 0 then every item of the LTLST must 
"KRN",8994,1857,2,3,1,2,0)
contain a valid group code. If an empty list is passed into the RPC then 
"KRN",8994,1857,2,3,1,3,0)
ALL records will be deleted from the LOCAL TEST NAME multiple.
"KRN",8994,1857,2,3,1,4,0)
 
"KRN",8994,1857,2,3,1,5,0)
If this parameter is not zero then it should contain a valid group code.
"KRN",8994,1857,2,3,1,6,0)
All records of the LTLST will be associated with this group. If an empty
"KRN",8994,1857,2,3,1,7,0)
list is passed into the RPC then only records associated with this group
"KRN",8994,1857,2,3,1,8,0)
will be deleted from the multiple.
"KRN",8994,1857,2,"B","GROUP",3)

"KRN",8994,1857,2,"B","LTLST",2)

"KRN",8994,1857,2,"B","REGIEN",1)

"KRN",8994,1857,2,"PARAMSEQ",1,1)

"KRN",8994,1857,2,"PARAMSEQ",2,3)

"KRN",8994,1857,2,"PARAMSEQ",3,2)

"KRN",8994,1857,3,0)
^8994.03^15^15^3050215^^^^
"KRN",8994,1857,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1857,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1857,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1857,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1857,3,5,0)
  
"KRN",8994,1857,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1857,3,7,0)
                          ^01: The last error code
"KRN",8994,1857,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1857,3,9,0)
                                                                      
"KRN",8994,1857,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1857,3,11,0)
                          ^01: Error code
"KRN",8994,1857,3,12,0)
                          ^02: Message
"KRN",8994,1857,3,13,0)
                          ^03: Place of the error
"KRN",8994,1857,3,14,0)
 
"KRN",8994,1857,3,15,0)
Otherwise, zero is returned in the Results[0].
"KRN",8994,1858,-1)
0^31
"KRN",8994,1858,0)
ROR LIST LOCAL DRUGS^LDLIST^RORRP032^4^A^^^1^1
"KRN",8994,1858,1,0)
^8994.01^3^3^3030625^^
"KRN",8994,1858,1,1,0)
The ROR LIST LOCAL DRUGS remote procedure returns a list of local drugs, 
"KRN",8994,1858,1,2,0)
which are referenced by the LOCAL DRUG NAME multiple (29) of the ROR
"KRN",8994,1858,1,3,0)
REGISTRY PARAMETERS file (#798.1).
"KRN",8994,1858,2,0)
^8994.02A^2^2
"KRN",8994,1858,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1858,2,1,1,0)
^8994.021^2^2^3030625^^
"KRN",8994,1858,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the 
"KRN",8994,1858,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1858,2,2,0)
GROUP^1^^^2
"KRN",8994,1858,2,2,1,0)
^^3^3^3030625^
"KRN",8994,1858,2,2,1,1,0)
If this parameter is defined and not zero, it should contain a valid code
"KRN",8994,1858,2,2,1,2,0)
of the Drug Group. In this case, only the drugs associated with this group
"KRN",8994,1858,2,2,1,3,0)
will be returned.
"KRN",8994,1858,2,"B","GROUP",2)

"KRN",8994,1858,2,"B","REGIEN",1)

"KRN",8994,1858,2,"PARAMSEQ",1,1)

"KRN",8994,1858,2,"PARAMSEQ",2,2)

"KRN",8994,1858,3,0)
^8994.03^24^24^3030625^^
"KRN",8994,1858,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1858,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1858,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1858,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1858,3,5,0)
  
"KRN",8994,1858,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1858,3,7,0)
                          ^01: The last error code
"KRN",8994,1858,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1858,3,9,0)
                                                                      
"KRN",8994,1858,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1858,3,11,0)
                          ^01: Error code
"KRN",8994,1858,3,12,0)
                          ^02: Message
"KRN",8994,1858,3,13,0)
                          ^03: Place of the error
"KRN",8994,1858,3,14,0)
 
"KRN",8994,1858,3,15,0)
Otherwise, number of drugs is returned in the Results[0] and the 
"KRN",8994,1858,3,16,0)
subsequent nodes of the global array contain the drugs.
"KRN",8994,1858,3,17,0)
 
"KRN",8994,1858,3,18,0)
  Results[0]            Number of Drugs
"KRN",8994,1858,3,19,0)
 
"KRN",8994,1858,3,20,0)
  Results[i]            Drug Descriptor
"KRN",8994,1858,3,21,0)
                          ^01: IEN in the LOCAL DRUG NAME multiple
"KRN",8994,1858,3,22,0)
                          ^02: Local drug name
"KRN",8994,1858,3,23,0)
                          ^03: IEN of the local drug (in the file #50)
"KRN",8994,1858,3,24,0)
                          ^04: Code of the Drug Group
"KRN",8994,1859,-1)
0^62
"KRN",8994,1859,0)
ROR UPDATE LOCAL DRUGS^LDLUPD^RORRP032^2^R^^^1^1
"KRN",8994,1859,1,0)
^^3^3^3030625^
"KRN",8994,1859,1,1,0)
The ROR UPDATE LOCAL DRUGS remote procedure updates the list of local drug
"KRN",8994,1859,1,2,0)
names, which is stored in the LOCAL DRUG NAME (29) multiple of the ROR
"KRN",8994,1859,1,3,0)
REGISTRY PARAMETERS file (#798.1).
"KRN",8994,1859,2,0)
^8994.02A^3^3
"KRN",8994,1859,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1859,2,1,1,0)
^^2^2^3030625^
"KRN",8994,1859,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the 
"KRN",8994,1859,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1859,2,2,0)
LDLST^2^^1^3
"KRN",8994,1859,2,2,1,0)
^^16^16^3030625^
"KRN",8994,1859,2,2,1,1,0)
The LDLST parameter should be an array containing a list of drug IEN's and
"KRN",8994,1859,2,2,1,2,0)
Drug Group codes. An item of the list should have the following format:
"KRN",8994,1859,2,2,1,3,0)
 
"KRN",8994,1859,2,2,1,4,0)
  ^01: Ignored
"KRN",8994,1859,2,2,1,5,0)
  ^02: Ignored
"KRN",8994,1859,2,2,1,6,0)
  ^03: IEN of the local drug (in file #50)
"KRN",8994,1859,2,2,1,7,0)
  ^04: Code of the Drug Group
"KRN",8994,1859,2,2,1,8,0)
       (see also the GROUP parameter)
"KRN",8994,1859,2,2,1,9,0)
  
"KRN",8994,1859,2,2,1,10,0)
Example:
"KRN",8994,1859,2,2,1,11,0)
  with RPCBroker.Param[1] do
"KRN",8994,1859,2,2,1,12,0)
    begin
"KRN",8994,1859,2,2,1,13,0)
      PType :=list;
"KRN",8994,1859,2,2,1,14,0)
      for i := 1 to Drugs.Count do
"KRN",8994,1859,2,2,1,15,0)
        Mult[i] := '^^' + Drugs[i-1].DrugIEN + '^' + Drugs[i-1].GroupCode;
"KRN",8994,1859,2,2,1,16,0)
    end;
"KRN",8994,1859,2,3,0)
GROUP^1^^1^2
"KRN",8994,1859,2,3,1,0)
^^8^8^3030625^
"KRN",8994,1859,2,3,1,1,0)
If the GROUP parameter is equal to 0 then every item of the LDLST must 
"KRN",8994,1859,2,3,1,2,0)
contain a valid group code. If ane mpty list is passed into the RPC then 
"KRN",8994,1859,2,3,1,3,0)
ALL records will be deleted from the LOCAL DRUG NAME multiple.
"KRN",8994,1859,2,3,1,4,0)
 
"KRN",8994,1859,2,3,1,5,0)
If this parameter is not zero then it should contain a valid group code.
"KRN",8994,1859,2,3,1,6,0)
All records of the LDLST will be associated with this group. If an empty
"KRN",8994,1859,2,3,1,7,0)
list is passed into the RPC then only records associated with this group
"KRN",8994,1859,2,3,1,8,0)
will be deleted from the multiple.
"KRN",8994,1859,2,"B","GROUP",3)

"KRN",8994,1859,2,"B","LDLST",2)

"KRN",8994,1859,2,"B","REGIEN",1)

"KRN",8994,1859,2,"PARAMSEQ",1,1)

"KRN",8994,1859,2,"PARAMSEQ",2,3)

"KRN",8994,1859,2,"PARAMSEQ",3,2)

"KRN",8994,1859,3,0)
^^15^15^3030625^
"KRN",8994,1859,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1859,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1859,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1859,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1859,3,5,0)
  
"KRN",8994,1859,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1859,3,7,0)
                          ^01: The last error code
"KRN",8994,1859,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1859,3,9,0)
                                                                      
"KRN",8994,1859,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1859,3,11,0)
                          ^01: Error code
"KRN",8994,1859,3,12,0)
                          ^02: Message
"KRN",8994,1859,3,13,0)
                          ^03: Place of the error
"KRN",8994,1859,3,14,0)
 
"KRN",8994,1859,3,15,0)
Otherwise, zero is returned in the Results[0].
"KRN",8994,1860,-1)
0^25
"KRN",8994,1860,0)
ROR LIST DRUGS^DRUGLIST^RORRP017^4^R^^^1^1
"KRN",8994,1860,1,0)
^8994.01^2^2^3051004^^^
"KRN",8994,1860,1,1,0)
The ROR LIST DRUGS remote procedure returns a list of drugs (defined in
"KRN",8994,1860,1,2,0)
the DRUG file), which conform the criteria.
"KRN",8994,1860,2,0)
^8994.02A^5^4
"KRN",8994,1860,2,2,0)
PART^1^30^^1
"KRN",8994,1860,2,2,1,0)
^8994.021^1^1^3030626^^
"KRN",8994,1860,2,2,1,1,0)
The partial match restriction.
"KRN",8994,1860,2,3,0)
FLAGS^1^^^2
"KRN",8994,1860,2,3,1,0)
^^8^8^3031110^
"KRN",8994,1860,2,3,1,1,0)
Flags that control the execution (can be combined):
"KRN",8994,1860,2,3,1,2,0)
 
"KRN",8994,1860,2,3,1,3,0)
  B  Backwards. Traverses the index in the opposite
"KRN",8994,1860,2,3,1,4,0)
     direction of normal traversal
"KRN",8994,1860,2,3,1,5,0)
 
"KRN",8994,1860,2,3,1,6,0)
  G  Retrive generic drugs (from file #50.6).
"KRN",8994,1860,2,3,1,7,0)
     Otherwise, list of dispensed drugs (from
"KRN",8994,1860,2,3,1,8,0)
     file #50) is retrived.
"KRN",8994,1860,2,4,0)
NUMBER^1^^^3
"KRN",8994,1860,2,4,1,0)
^^1^1^3051004^
"KRN",8994,1860,2,4,1,1,0)
Deprecated.
"KRN",8994,1860,2,5,0)
FROM^1^^^4
"KRN",8994,1860,2,5,1,0)
^^1^1^3051004^
"KRN",8994,1860,2,5,1,1,0)
Deprecated.
"KRN",8994,1860,2,"B","FLAGS",3)

"KRN",8994,1860,2,"B","FROM",5)

"KRN",8994,1860,2,"B","NUMBER",4)

"KRN",8994,1860,2,"B","PART",2)

"KRN",8994,1860,2,"PARAMSEQ",1,2)

"KRN",8994,1860,2,"PARAMSEQ",2,3)

"KRN",8994,1860,2,"PARAMSEQ",3,4)

"KRN",8994,1860,2,"PARAMSEQ",4,5)

"KRN",8994,1860,3,0)
^^23^23^3051004^
"KRN",8994,1860,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,1860,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,1860,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1860,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1860,3,5,0)
   
"KRN",8994,1860,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1860,3,7,0)
                          ^01: The last error code
"KRN",8994,1860,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1860,3,9,0)
   
"KRN",8994,1860,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1860,3,11,0)
                          ^01: Error code
"KRN",8994,1860,3,12,0)
                          ^02: Message
"KRN",8994,1860,3,13,0)
                          ^03: Place of the error
"KRN",8994,1860,3,14,0)
  
"KRN",8994,1860,3,15,0)
Otherwise, number of drugs is returned in the Results[0] and the
"KRN",8994,1860,3,16,0)
subsequent nodes of the global array contain the drugs.
"KRN",8994,1860,3,17,0)
   
"KRN",8994,1860,3,18,0)
  Results[0]          Number of drugs
"KRN",8994,1860,3,19,0)
 
"KRN",8994,1860,3,20,0)
  Results[i]          Drug
"KRN",8994,1860,3,21,0)
                        ^01: IEN in the DRUG file (#50)
"KRN",8994,1860,3,22,0)
                        ^02: Generic Name
"KRN",8994,1860,3,23,0)
                        ^03: VA Drug Class
"KRN",8994,1861,-1)
0^71
"KRN",8994,1861,0)
RORICR PATIENT LOAD^LOAD^RORRP033^4^R^^^1^1
"KRN",8994,1861,1,0)
^8994.01^2^2^3050819^^^^
"KRN",8994,1861,1,1,0)
The RORICR PATIENT LOAD remote procedure loads the patient's data from the
"KRN",8994,1861,1,2,0)
ICR registry and prepares the record for editing.
"KRN",8994,1861,2,0)
^8994.02A^3^3
"KRN",8994,1861,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1861,2,1,1,0)
^8994.021^2^2^3030703^^^
"KRN",8994,1861,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,1861,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1861,2,2,0)
PATIEN^1^^1^2
"KRN",8994,1861,2,2,1,0)
^8994.021^1^1^3030715^^^^
"KRN",8994,1861,2,2,1,1,0)
A valid patient IEN (DFN) should be assigned to the PATIEN parameter.
"KRN",8994,1861,2,3,0)
LOCK^1^^^3
"KRN",8994,1861,2,3,1,0)
^8994.021^2^2^3050819^^
"KRN",8994,1861,2,3,1,1,0)
If this parameter is defined and not zero then the RPC will try to lock
"KRN",8994,1861,2,3,1,2,0)
the registry record before loading the data and will leave it locked.
"KRN",8994,1861,2,"B","LOCK",3)

"KRN",8994,1861,2,"B","PATIEN",2)

"KRN",8994,1861,2,"B","REGIEN",1)

"KRN",8994,1861,2,"PARAMSEQ",1,1)

"KRN",8994,1861,2,"PARAMSEQ",2,2)

"KRN",8994,1861,2,"PARAMSEQ",3,3)

"KRN",8994,1861,3,0)
^^143^143^3050819^
"KRN",8994,1861,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1861,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1861,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1861,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1861,3,5,0)
   
"KRN",8994,1861,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1861,3,7,0)
                          ^01: The last error code
"KRN",8994,1861,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1861,3,9,0)
                                                                      
"KRN",8994,1861,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1861,3,11,0)
                          ^01: Error code
"KRN",8994,1861,3,12,0)
                          ^02: Message
"KRN",8994,1861,3,13,0)
                          ^03: Place of the error
"KRN",8994,1861,3,14,0)
 
"KRN",8994,1861,3,15,0)
If locking was requested (see the LOCK parameter) and the record could not
"KRN",8994,1861,3,16,0)
be locked then the first "^"-piece of the Results[0] would be greater than
"KRN",8994,1861,3,17,0)
0. The Results[0] would contain the lock descriptor and subsequent nodes
"KRN",8994,1861,3,18,0)
of the global array would contain the data (see below). The lock 
"KRN",8994,1861,3,19,0)
descriptor contains information about the process, which owns the most 
"KRN",8994,1861,3,20,0)
recent lock of the record. The "O" flag (read-only) would also be added to
"KRN",8994,1861,3,21,0)
the 15th field of the "PRD" segment.
"KRN",8994,1861,3,22,0)
 
"KRN",8994,1861,3,23,0)
  Results[0]            Lock Descriptor
"KRN",8994,1861,3,24,0)
                          ^01: Date/Time (FileMan)
"KRN",8994,1861,3,25,0)
                          ^02: User/Process name
"KRN",8994,1861,3,26,0)
                          ^03: User IEN (DUZ)
"KRN",8994,1861,3,27,0)
                          ^04: $JOB
"KRN",8994,1861,3,28,0)
                          ^05: Task number
"KRN",8994,1861,3,29,0)
 
"KRN",8994,1861,3,30,0)
THE DATA ARE LOADED ONLY FOR VIEWING PURPOSES (READ-ONLY)!
"KRN",8994,1861,3,31,0)
 
"KRN",8994,1861,3,32,0)
Otherwise, zero is returned in the Results[0] and the subsequent nodes of
"KRN",8994,1861,3,33,0)
the array contain the data.
"KRN",8994,1861,3,34,0)
 
"KRN",8994,1861,3,35,0)
  Results[0]            0
"KRN",8994,1861,3,36,0)
 
"KRN",8994,1861,3,37,0)
  Results[i]            Demographic Information
"KRN",8994,1861,3,38,0)
                          ^01: "DEM"
"KRN",8994,1861,3,39,0)
                          ^02: ""
"KRN",8994,1861,3,40,0)
                          ^03: Patient IEN (DFN)
"KRN",8994,1861,3,41,0)
                          ^04: Patient Name
"KRN",8994,1861,3,42,0)
                          ^05: Date of Birth (FileMan)
"KRN",8994,1861,3,43,0)
                          ^06: SSN
"KRN",8994,1861,3,44,0)
                          ^07: Date of Death (FileMan)
"KRN",8994,1861,3,45,0)
                          ^08: Sex (F/M)
"KRN",8994,1861,3,46,0)
 
"KRN",8994,1861,3,47,0)
  Results[i]            Basic Registry Data
"KRN",8994,1861,3,48,0)
                          ^01: "PRD"
"KRN",8994,1861,3,49,0)
                          ^02: ""
"KRN",8994,1861,3,50,0)
                          ^03: Date Entered (FileMan)
"KRN",8994,1861,3,51,0)
                          ^04: Status Code (Field 3, File #798)
"KRN",8994,1861,3,52,0)
                          ^05: Active (0/1)
"KRN",8994,1861,3,53,0)
                          ^06: Do not Send (0/1)
"KRN",8994,1861,3,54,0)
                          ^07: Data Acknowledged Until (FileMan)
"KRN",8994,1861,3,55,0)
                          ^08: Data Extracted Until (FileMan)
"KRN",8994,1861,3,56,0)
                          ^09: Date Selected (FileMan)
"KRN",8994,1861,3,57,0)
                          ^10: Date Confirmed (FileMan)
"KRN",8994,1861,3,58,0)
                          ^11: Location Selected (Institution Name)
"KRN",8994,1861,3,59,0)
                          ^12: reserved
"KRN",8994,1861,3,60,0)
                          ^13: reserved
"KRN",8994,1861,3,61,0)
                          ^14: reserved
"KRN",8994,1861,3,62,0)
                          ^15: Action Flags (see the description below)
"KRN",8994,1861,3,63,0)
 
"KRN",8994,1861,3,64,0)
                        The Status field can have the following values
"KRN",8994,1861,3,65,0)
                        (see description of the STATUS field of the
"KRN",8994,1861,3,66,0)
                        ROR REGISTRY RECORD file for more details):
"KRN",8994,1861,3,67,0)
                            0  Confirmed
"KRN",8994,1861,3,68,0)
                            4  Pending
"KRN",8994,1861,3,69,0)
                            5  Deleted
"KRN",8994,1861,3,70,0)
 
"KRN",8994,1861,3,71,0)
                        The Action Flags field indicates the actions that
"KRN",8994,1861,3,72,0)
                        can be performed on the patient's record:
"KRN",8994,1861,3,73,0)
                            C  CDC form can be edited/printed
"KRN",8994,1861,3,74,0)
                            D  The record can be deleted
"KRN",8994,1861,3,75,0)
                            E  The record can be edited
"KRN",8994,1861,3,76,0)
                            O  Read-only mode
"KRN",8994,1861,3,77,0)
 
"KRN",8994,1861,3,78,0)
  Results[i]            Local field data
"KRN",8994,1861,3,79,0)
                          ^O1: "LFV"
"KRN",8994,1861,3,80,0)
                          ^02: IEN in the LOCAL FIELD multiple
"KRN",8994,1861,3,81,0)
                               of the ROR REGISTRY RECORD file
"KRN",8994,1861,3,82,0)
                          ^03: Field Definition IEN
"KRN",8994,1861,3,83,0)
                               (in the ROR LOCAL FIELD file)
"KRN",8994,1861,3,84,0)
                          ^04: Field Name
"KRN",8994,1861,3,85,0)
                          ^05: Date (FileMan)
"KRN",8994,1861,3,86,0)
                          ^06: Comment
"KRN",8994,1861,3,87,0)
 
"KRN",8994,1861,3,88,0)
  Results[i]            Selection Rule
"KRN",8994,1861,3,89,0)
                          ^01: "PSR"
"KRN",8994,1861,3,90,0)
                          ^02: IEN in the SELECTION RULE multiple
"KRN",8994,1861,3,91,0)
                               of the ROR REGISTRY RECORD file
"KRN",8994,1861,3,92,0)
                          ^03: Rule Definition IEN
"KRN",8994,1861,3,93,0)
                               (in the ROR SELECTION RULE file)
"KRN",8994,1861,3,94,0)
                          ^04: Name of the Rule
"KRN",8994,1861,3,95,0)
                          ^05: Date (FileMan)
"KRN",8994,1861,3,96,0)
                          ^06: Location IEN  (Institution IEN)
"KRN",8994,1861,3,97,0)
                          ^07: Location Name (Institution Name)
"KRN",8994,1861,3,98,0)
                          ^08: Short Description
"KRN",8994,1861,3,99,0)
 
"KRN",8994,1861,3,100,0)
  Results[i]            Patient History (risk factors)
"KRN",8994,1861,3,101,0)
                          ^01: "PH"
"KRN",8994,1861,3,102,0)
                          ^02: ""
"KRN",8994,1861,3,103,0)
                          ^03: SEX RELATIONS W/MALE PARTNER   {0|1|9}
"KRN",8994,1861,3,104,0)
                          ^04: SEX RELATIONS W/FEMALE PARTNER {0|1|9}
"KRN",8994,1861,3,105,0)
                          ^05: IV DRUGS AFTER 77 AND PRE HIV  {0|1|9}
"KRN",8994,1861,3,106,0)
                          ^06: REC'D CLOTTING FACTORS         {0|1|9}
"KRN",8994,1861,3,107,0)
                          ^07: TYPE OF HEMOPHILIA             {1|2|8}
"KRN",8994,1861,3,108,0)
                          ^08: OTHER HEMOPHILIA DESCRIPTION
"KRN",8994,1861,3,109,0)
                          ^09: SR WITH IV DRUG USER           {0|1|9}
"KRN",8994,1861,3,110,0)
                          ^10: SR WITH BISEXUAL MAN           {0|1|9}
"KRN",8994,1861,3,111,0)
                          ^11: SR W HEMOPHILIA/COAG DISORDER  {0|1|9}
"KRN",8994,1861,3,112,0)
                          ^12: SR W TRANS RECIPIENT WITH AIDS {0|1|9}
"KRN",8994,1861,3,113,0)
                          ^13: TRANSPLANT RECIP-DOCUMNTD HIV  {0|1|9}
"KRN",8994,1861,3,114,0)
                          ^14: SR W AIDS/HIV INFECTION        {0|1|9}
"KRN",8994,1861,3,115,0)
                          ^15: TRANS AFTER 77 AND BEFORE HIV  {0|1|9}
"KRN",8994,1861,3,116,0)
                          ^16: DATE OF FIRST TRANSFUSION      (MM/YY)
"KRN",8994,1861,3,117,0)
                          ^17: DATE OF LAST TRANSFUSION       (MM/YY)
"KRN",8994,1861,3,118,0)
                          ^18: TRANSPLANT OR ARTIF INSEMIN    {0|1|9}
"KRN",8994,1861,3,119,0)
                          ^19: WORK IN HEALTH CARE OR LAB     {0|1|9}
"KRN",8994,1861,3,120,0)
                          ^20: OCCUPATION
"KRN",8994,1861,3,121,0)
 
"KRN",8994,1861,3,122,0)
  Results[i]            CD4 and Viral Load results
"KRN",8994,1861,3,123,0)
                          ^01: "LTR"
"KRN",8994,1861,3,124,0)
                          ^02: Result IEN (inverted date/time)
"KRN",8994,1861,3,125,0)
                          ^03: Date/time of the test (FileMan)
"KRN",8994,1861,3,126,0)
                          ^04: Result
"KRN",8994,1861,3,127,0)
                          ^05: Test IEN (in file #60)
"KRN",8994,1861,3,128,0)
                          ^06: Test name
"KRN",8994,1861,3,129,0)
                          ^07: Code of the group
"KRN",8994,1861,3,130,0)
                          ^08: Group name
"KRN",8994,1861,3,131,0)
 
"KRN",8994,1861,3,132,0)
  Results[i]            Registry Data
"KRN",8994,1861,3,133,0)
                          ^01: "ICR"
"KRN",8994,1861,3,134,0)
                          ^02: ""
"KRN",8994,1861,3,135,0)
                          ^03: Clinical AIDS                  {0|1}
"KRN",8994,1861,3,136,0)
                          ^04: Date of Clinical AIDS (FileMan)
"KRN",8994,1861,3,137,0)
                          ^05: Code of the Supporting Evidence
"KRN",8994,1861,3,138,0)
                          ^06: Date of last CD4 (FileMan)
"KRN",8994,1861,3,139,0)
                          ^07: Last CD4
"KRN",8994,1861,3,140,0)
                          ^08: Date of lowest CD4 (FileMan)
"KRN",8994,1861,3,141,0)
                          ^09: Lowest CD4
"KRN",8994,1861,3,142,0)
                          ^10: Date of lowest CD4 % (FileMan)
"KRN",8994,1861,3,143,0)
                          ^11: Lowest CD4 %
"KRN",8994,1862,-1)
0^72
"KRN",8994,1862,0)
RORICR PATIENT SAVE^SAVE^RORRP034^2^R^^^1^1
"KRN",8994,1862,1,0)
^8994.01^2^2^3050818^^^
"KRN",8994,1862,1,1,0)
The RORICR PATIENT SAVE remote procedure updates the patient's record in
"KRN",8994,1862,1,2,0)
the registry (or creates one).
"KRN",8994,1862,2,0)
^8994.02A^4^4
"KRN",8994,1862,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1862,2,1,1,0)
^8994.021^2^2^3030707^^^
"KRN",8994,1862,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,1862,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1862,2,2,0)
PATIEN^1^^1^2
"KRN",8994,1862,2,2,1,0)
^8994.021^1^1^3030707^^^
"KRN",8994,1862,2,2,1,1,0)
A valid patient IEN (DFN) should be assigned to the PATIEN parameter.
"KRN",8994,1862,2,3,0)
DATA^2^^1^4
"KRN",8994,1862,2,3,1,0)
^8994.021^30^30^3050818^^^
"KRN",8994,1862,2,3,1,1,0)
A list that contains the data in the same format as the output of the
"KRN",8994,1862,2,3,1,2,0)
RORICR PATIENT LOAD remote procedure. Only PH and ICR segments are
"KRN",8994,1862,2,3,1,3,0)
processed; the others are ignored.
"KRN",8994,1862,2,3,1,4,0)
 
"KRN",8994,1862,2,3,1,5,0)
Example:
"KRN",8994,1862,2,3,1,6,0)
 
"KRN",8994,1862,2,3,1,7,0)
  with RPCBroker do
"KRN",8994,1862,2,3,1,8,0)
    begin
"KRN",8994,1862,2,3,1,9,0)
      RemoteProcedure:= 'RORICR PATIENT LOAD';
"KRN",8994,1862,2,3,1,10,0)
      Param[0].Value := RegistryIEN;
"KRN",8994,1862,2,3,1,11,0)
      Param[0].PType := literal;
"KRN",8994,1862,2,3,1,12,0)
      Param[1].Value := DFN;
"KRN",8994,1862,2,3,1,13,0)
      Param[1].PType := literal;
"KRN",8994,1862,2,3,1,14,0)
      lstCall(PatientData);     // Load the data
"KRN",8994,1862,2,3,1,15,0)
 
"KRN",8994,1862,2,3,1,16,0)
      ...                       // Edit the data
"KRN",8994,1862,2,3,1,17,0)
 
"KRN",8994,1862,2,3,1,18,0)
      RemoteProcedure:= 'RORICR PATIENT SAVE';
"KRN",8994,1862,2,3,1,19,0)
      Param[0].Value := RegistryIEN;
"KRN",8994,1862,2,3,1,20,0)
      Param[0].PType := literal;
"KRN",8994,1862,2,3,1,21,0)
      Param[1].Value := DFN;
"KRN",8994,1862,2,3,1,22,0)
      Param[1].PType := literal;
"KRN",8994,1862,2,3,1,23,0)
      Param[2].PType := list;
"KRN",8994,1862,2,3,1,24,0)
      Param[2].Mult.Assign(PatientData);
"KRN",8994,1862,2,3,1,25,0)
      Call;                     // Save the data
"KRN",8994,1862,2,3,1,26,0)
   end;
"KRN",8994,1862,2,3,1,27,0)
 
"KRN",8994,1862,2,3,1,28,0)
NOTE: Only those items of the list are processed
"KRN",8994,1862,2,3,1,29,0)
      that have numeric subscripts greater than 0;
"KRN",8994,1862,2,3,1,30,0)
      all others are ignored.
"KRN",8994,1862,2,4,0)
CANCEL^1^^^3
"KRN",8994,1862,2,4,1,0)
^^1^1^3050818^
"KRN",8994,1862,2,4,1,1,0)
Cancel the update and unlock the patient's registry data.
"KRN",8994,1862,2,"B","CANCEL",4)

"KRN",8994,1862,2,"B","DATA",3)

"KRN",8994,1862,2,"B","PATIEN",2)

"KRN",8994,1862,2,"B","REGIEN",1)

"KRN",8994,1862,2,"PARAMSEQ",1,1)

"KRN",8994,1862,2,"PARAMSEQ",2,2)

"KRN",8994,1862,2,"PARAMSEQ",3,4)

"KRN",8994,1862,2,"PARAMSEQ",4,3)

"KRN",8994,1862,3,0)
^8994.03^21^21^3050818^^
"KRN",8994,1862,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1862,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1862,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1862,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1862,3,5,0)
   
"KRN",8994,1862,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1862,3,7,0)
                          ^01: The last error code
"KRN",8994,1862,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1862,3,9,0)
                                                                      
"KRN",8994,1862,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1862,3,11,0)
                          ^01: Error code
"KRN",8994,1862,3,12,0)
                          ^02: Message
"KRN",8994,1862,3,13,0)
                          ^03: Place of the error
"KRN",8994,1862,3,14,0)
 
"KRN",8994,1862,3,15,0)
A positive value of the first "^"-piece of the Results[0] indicates an
"KRN",8994,1862,3,16,0)
error in the data. The value is the number of the erroneous piece of the
"KRN",8994,1862,3,17,0)
data segment whose name is returned in the second piece of the Results[0].
"KRN",8994,1862,3,18,0)
For example, the "16^PH" means that the 16th piece of the PH data segment
"KRN",8994,1862,3,19,0)
(DATE OF FIRST TRANSFUSION) contains an invalid value.
"KRN",8994,1862,3,20,0)
    
"KRN",8994,1862,3,21,0)
Otherwise, zero is returned in the Results[0].
"KRN",8994,1869,-1)
0^67
"KRN",8994,1869,0)
RORICR CDC CANCEL^CANCEL^RORRP027^2^R^^^1^1
"KRN",8994,1869,1,0)
^^3^3^3030716^
"KRN",8994,1869,1,1,0)
The RORICR CDC CANCEL remote procedure cancels the editing process 
"KRN",8994,1869,1,2,0)
initiated by the RORICR CDC LOAD remote procedure (see the LOCK parameter)
"KRN",8994,1869,1,3,0)
and unlocks the registry records.
"KRN",8994,1869,2,0)
^8994.02A^2^2
"KRN",8994,1869,2,1,0)
REGIEN^1^^1^1
"KRN",8994,1869,2,1,1,0)
^8994.021^2^2^3030707^^^
"KRN",8994,1869,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,1869,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,1869,2,2,0)
PATIEN^1^^1^2
"KRN",8994,1869,2,2,1,0)
^8994.021^1^1^3030716^^^^
"KRN",8994,1869,2,2,1,1,0)
A valid patient IEN (DFN) should be assigned to the PATIEN parameter.
"KRN",8994,1869,2,"B","PATIEN",2)

"KRN",8994,1869,2,"B","REGIEN",1)

"KRN",8994,1869,2,"PARAMSEQ",1,1)

"KRN",8994,1869,2,"PARAMSEQ",2,2)

"KRN",8994,1869,3,0)
^8994.03^15^15^3030716^^
"KRN",8994,1869,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,1869,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,1869,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,1869,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,1869,3,5,0)
   
"KRN",8994,1869,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,1869,3,7,0)
                          ^01: The last error code
"KRN",8994,1869,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,1869,3,9,0)
                                                                      
"KRN",8994,1869,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,1869,3,11,0)
                          ^01: Error code
"KRN",8994,1869,3,12,0)
                          ^02: Message
"KRN",8994,1869,3,13,0)
                          ^03: Place of the error
"KRN",8994,1869,3,14,0)
    
"KRN",8994,1869,3,15,0)
Otherwise, zero is returned in the Results[0].
"KRN",8994,2001,-1)
0^26
"KRN",8994,2001,0)
ROR LIST GENERIC DRUGS^GDLIST^RORRP035^4^A^^^1^1
"KRN",8994,2001,1,0)
^^2^2^3040114^
"KRN",8994,2001,1,1,0)
The ROR LIST GENERIC DRUGS remote procedure returns a list of generic
"KRN",8994,2001,1,2,0)
drugs, which are referenced by the ROR GENERIC DRUG file (#799.51).
"KRN",8994,2001,2,0)
^8994.02A^2^2
"KRN",8994,2001,2,1,0)
REGIEN^1^^1^1
"KRN",8994,2001,2,1,1,0)
^8994.021^2^2^3030625^^
"KRN",8994,2001,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the 
"KRN",8994,2001,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,2001,2,2,0)
GROUP^1^^^2
"KRN",8994,2001,2,2,1,0)
^8994.021^3^3^3040114^^
"KRN",8994,2001,2,2,1,1,0)
If this parameter is defined and not zero, it should contain a valid code
"KRN",8994,2001,2,2,1,2,0)
of the Drug Group. In this case, only the drugs associated with this group
"KRN",8994,2001,2,2,1,3,0)
will be returned.
"KRN",8994,2001,2,"B","GROUP",2)

"KRN",8994,2001,2,"B","REGIEN",1)

"KRN",8994,2001,2,"PARAMSEQ",1,1)

"KRN",8994,2001,2,"PARAMSEQ",2,2)

"KRN",8994,2001,3,0)
^^24^24^3040114^
"KRN",8994,2001,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,2001,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,2001,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,2001,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,2001,3,5,0)
  
"KRN",8994,2001,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,2001,3,7,0)
                          ^01: The last error code
"KRN",8994,2001,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,2001,3,9,0)
                                                                      
"KRN",8994,2001,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,2001,3,11,0)
                          ^01: Error code
"KRN",8994,2001,3,12,0)
                          ^02: Message
"KRN",8994,2001,3,13,0)
                          ^03: Place of the error
"KRN",8994,2001,3,14,0)
 
"KRN",8994,2001,3,15,0)
Otherwise, number of drugs is returned in the Results[0] and the 
"KRN",8994,2001,3,16,0)
subsequent nodes of the global array contain the drugs.
"KRN",8994,2001,3,17,0)
 
"KRN",8994,2001,3,18,0)
  Results[0]            Number of Drugs
"KRN",8994,2001,3,19,0)
 
"KRN",8994,2001,3,20,0)
  Results[i]            Drug Descriptor
"KRN",8994,2001,3,21,0)
                          ^01: IEN in the ROR GENERIC DRUG file
"KRN",8994,2001,3,22,0)
                          ^02: Generic drug name
"KRN",8994,2001,3,23,0)
                          ^03: IEN of the generic drug (in the file #50.6)
"KRN",8994,2001,3,24,0)
                          ^04: Code of the Drug Group (see file #799.51)
"KRN",8994,2081,-1)
0^65
"KRN",8994,2081,0)
RORHEPC PATIENT LOAD^LOAD^RORRP036^4^R^^^1^1
"KRN",8994,2081,1,0)
^^2^2^3040416^
"KRN",8994,2081,1,1,0)
The RORHEPC PATIENT LOAD remote procedure loads the patient's data from
"KRN",8994,2081,1,2,0)
the Hepatitis C registry and prepares the record for editing.
"KRN",8994,2081,2,0)
^8994.02A^3^3
"KRN",8994,2081,2,1,0)
REGIEN^1^^1^1
"KRN",8994,2081,2,1,1,0)
^8994.021^2^2^3030703^^^
"KRN",8994,2081,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,2081,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,2081,2,2,0)
PATIEN^1^^1^2
"KRN",8994,2081,2,2,1,0)
^8994.021^1^1^3030715^^^^
"KRN",8994,2081,2,2,1,1,0)
A valid patient IEN (DFN) should be assigned to the PATIEN parameter.
"KRN",8994,2081,2,3,0)
LOCK^1^^^3
"KRN",8994,2081,2,3,1,0)
^8994.021^2^2^3040416^^
"KRN",8994,2081,2,3,1,1,0)
If this parameter is defined and not zero then the RPC will try to lock
"KRN",8994,2081,2,3,1,2,0)
the registry record before loading the data and will leave it locked.
"KRN",8994,2081,2,"B","LOCK",3)

"KRN",8994,2081,2,"B","PATIEN",2)

"KRN",8994,2081,2,"B","REGIEN",1)

"KRN",8994,2081,2,"PARAMSEQ",1,1)

"KRN",8994,2081,2,"PARAMSEQ",2,2)

"KRN",8994,2081,2,"PARAMSEQ",3,3)

"KRN",8994,2081,3,0)
^^71^71^3040416^
"KRN",8994,2081,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,2081,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,2081,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,2081,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,2081,3,5,0)
   
"KRN",8994,2081,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,2081,3,7,0)
                          ^01: The last error code
"KRN",8994,2081,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,2081,3,9,0)
                                                                      
"KRN",8994,2081,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,2081,3,11,0)
                          ^01: Error code
"KRN",8994,2081,3,12,0)
                          ^02: Message
"KRN",8994,2081,3,13,0)
                          ^03: Place of the error
"KRN",8994,2081,3,14,0)
 
"KRN",8994,2081,3,15,0)
If locking was requested (see the LOCK parameter) and the record could not
"KRN",8994,2081,3,16,0)
be locked then the first "^"-piece of the Results[0] would be greater than
"KRN",8994,2081,3,17,0)
0. The Results[0] would contain the lock descriptor and subsequent nodes
"KRN",8994,2081,3,18,0)
of the global array would contain the data (see below). The lock 
"KRN",8994,2081,3,19,0)
descriptor contains information about the process, which owns the most 
"KRN",8994,2081,3,20,0)
recent lock of the record. The "O" flag (read-only) would also be added to
"KRN",8994,2081,3,21,0)
the 15th field of the "PRD" segment.
"KRN",8994,2081,3,22,0)
 
"KRN",8994,2081,3,23,0)
  Results[0]            Lock Descriptor
"KRN",8994,2081,3,24,0)
                          ^01: Date/Time (FileMan)
"KRN",8994,2081,3,25,0)
                          ^02: User/Process name
"KRN",8994,2081,3,26,0)
                          ^03: User IEN (DUZ)
"KRN",8994,2081,3,27,0)
                          ^04: $JOB
"KRN",8994,2081,3,28,0)
                          ^05: Task number
"KRN",8994,2081,3,29,0)
 
"KRN",8994,2081,3,30,0)
THE DATA ARE LOADED ONLY FOR VIEWING PURPOSES (READ-ONLY)!
"KRN",8994,2081,3,31,0)
 
"KRN",8994,2081,3,32,0)
Otherwise, zero is returned in the Results[0] and the subsequent nodes of
"KRN",8994,2081,3,33,0)
the array contain the data.
"KRN",8994,2081,3,34,0)
 
"KRN",8994,2081,3,35,0)
  Results[0]            0
"KRN",8994,2081,3,36,0)
 
"KRN",8994,2081,3,37,0)
  Results[i]            Demographic Information
"KRN",8994,2081,3,38,0)
                          ^01: "DEM"
"KRN",8994,2081,3,39,0)
                          ^02: ""
"KRN",8994,2081,3,40,0)
                          ^03: Patient IEN (DFN)
"KRN",8994,2081,3,41,0)
                          ^04: Patient Name
"KRN",8994,2081,3,42,0)
                          ^05: Date of Birth (FileMan)
"KRN",8994,2081,3,43,0)
                          ^06: SSN
"KRN",8994,2081,3,44,0)
                          ^07: Date of Death (FileMan)
"KRN",8994,2081,3,45,0)
                          ^08: Sex (F/M)
"KRN",8994,2081,3,46,0)
 
"KRN",8994,2081,3,47,0)
  Results[i]            Basic Registry Data
"KRN",8994,2081,3,48,0)
                          ^01: "PRD"
"KRN",8994,2081,3,49,0)
                          ^02: ""
"KRN",8994,2081,3,50,0)
                          ^03: Date Entered (FileMan)
"KRN",8994,2081,3,51,0)
                          ^04: New Patient (internal)
"KRN",8994,2081,3,52,0)
                          ^05: Active (0/1)
"KRN",8994,2081,3,53,0)
                          ^06: Do not Send (0/1)
"KRN",8994,2081,3,54,0)
                          ^07: Data Acknowledged Until (FileMan)
"KRN",8994,2081,3,55,0)
                          ^08: Data Extracted Until (FileMan)
"KRN",8994,2081,3,56,0)
                          ^09: Inactivation Date (FileMan)
"KRN",8994,2081,3,57,0)
                          ^10: Inactivated By (IEN)
"KRN",8994,2081,3,58,0)
                          ^11: Inactivated By (Name)
"KRN",8994,2081,3,59,0)
                          ^12: Reactivation Date (FileMan)
"KRN",8994,2081,3,60,0)
                          ^13: Reactivated By (IEN)
"KRN",8994,2081,3,61,0)
                          ^14: Reactivated By (Name)
"KRN",8994,2081,3,62,0)
                          ^15: Action Flags
"KRN",8994,2081,3,63,0)
                          ^16: Code of inactivation reason
"KRN",8994,2081,3,64,0)
                          ^17: Code of supporting evidence
"KRN",8994,2081,3,65,0)
 
"KRN",8994,2081,3,66,0)
  Results[i]            Registry Data
"KRN",8994,2081,3,67,0)
                          ^01: "HEPC"
"KRN",8994,2081,3,68,0)
                          ^02: ""
"KRN",8994,2081,3,69,0)
                          ^03: Investigational Drugs {0|1}
"KRN",8994,2081,3,70,0)
                          ^04: reserved
"KRN",8994,2081,3,71,0)
                          ^05: Code of the Supporting Evidence
"KRN",8994,2082,-1)
0^66
"KRN",8994,2082,0)
RORHEPC PATIENT SAVE^SAVE^RORRP037^2^R^^^1^1
"KRN",8994,2082,1,0)
^8994.01^2^2^3050818^^^
"KRN",8994,2082,1,1,0)
The RORHEPC PATIENT SAVE remote procedure updates the patient's record in
"KRN",8994,2082,1,2,0)
the registry (or creates one).
"KRN",8994,2082,2,0)
^8994.02A^4^4
"KRN",8994,2082,2,1,0)
REGIEN^1^^1^1
"KRN",8994,2082,2,1,1,0)
^8994.021^2^2^3030707^^^
"KRN",8994,2082,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,2082,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,2082,2,2,0)
PATIEN^1^^1^2
"KRN",8994,2082,2,2,1,0)
^8994.021^1^1^3030707^^^
"KRN",8994,2082,2,2,1,1,0)
A valid patient IEN (DFN) should be assigned to the PATIEN parameter.
"KRN",8994,2082,2,3,0)
DATA^2^^1^4
"KRN",8994,2082,2,3,1,0)
^8994.021^30^30^3050818^^^
"KRN",8994,2082,2,3,1,1,0)
A list that contains the data in the same format as the output of the
"KRN",8994,2082,2,3,1,2,0)
RORHEPC PATIENT LOAD remote procedure. Only HEPC segment is processed; the
"KRN",8994,2082,2,3,1,3,0)
others are ignored.
"KRN",8994,2082,2,3,1,4,0)
 
"KRN",8994,2082,2,3,1,5,0)
Example:
"KRN",8994,2082,2,3,1,6,0)
 
"KRN",8994,2082,2,3,1,7,0)
  with RPCBroker do
"KRN",8994,2082,2,3,1,8,0)
    begin
"KRN",8994,2082,2,3,1,9,0)
      RemoteProcedure:= 'RORHEPC PATIENT LOAD';
"KRN",8994,2082,2,3,1,10,0)
      Param[0].Value := RegistryIEN;
"KRN",8994,2082,2,3,1,11,0)
      Param[0].PType := literal;
"KRN",8994,2082,2,3,1,12,0)
      Param[1].Value := DFN;
"KRN",8994,2082,2,3,1,13,0)
      Param[1].PType := literal;
"KRN",8994,2082,2,3,1,14,0)
      lstCall(PatientData);     // Load the data
"KRN",8994,2082,2,3,1,15,0)
 
"KRN",8994,2082,2,3,1,16,0)
      ...                       // Edit the data
"KRN",8994,2082,2,3,1,17,0)
 
"KRN",8994,2082,2,3,1,18,0)
      RemoteProcedure:= 'RORHEPC PATIENT SAVE';
"KRN",8994,2082,2,3,1,19,0)
      Param[0].Value := RegistryIEN;
"KRN",8994,2082,2,3,1,20,0)
      Param[0].PType := literal;
"KRN",8994,2082,2,3,1,21,0)
      Param[1].Value := DFN;
"KRN",8994,2082,2,3,1,22,0)
      Param[1].PType := literal;
"KRN",8994,2082,2,3,1,23,0)
      Param[2].PType := list;
"KRN",8994,2082,2,3,1,24,0)
      Param[2].Mult.Assign(PatientData);
"KRN",8994,2082,2,3,1,25,0)
      Call;                     // Save the data
"KRN",8994,2082,2,3,1,26,0)
   end;
"KRN",8994,2082,2,3,1,27,0)
 
"KRN",8994,2082,2,3,1,28,0)
NOTE: Only those items of the list are processed
"KRN",8994,2082,2,3,1,29,0)
      that have numeric subscripts greater than 0;
"KRN",8994,2082,2,3,1,30,0)
      all others are ignored.
"KRN",8994,2082,2,4,0)
CANCEL^1^^^3
"KRN",8994,2082,2,4,1,0)
^^1^1^3050818^
"KRN",8994,2082,2,4,1,1,0)
Cancel the update and unlock the patient's registry data.
"KRN",8994,2082,2,"B","CANCEL",4)

"KRN",8994,2082,2,"B","DATA",3)

"KRN",8994,2082,2,"B","PATIEN",2)

"KRN",8994,2082,2,"B","REGIEN",1)

"KRN",8994,2082,2,"PARAMSEQ",1,1)

"KRN",8994,2082,2,"PARAMSEQ",2,2)

"KRN",8994,2082,2,"PARAMSEQ",3,4)

"KRN",8994,2082,2,"PARAMSEQ",4,3)

"KRN",8994,2082,3,0)
^8994.03^21^21^3050818^^
"KRN",8994,2082,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,2082,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,2082,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,2082,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,2082,3,5,0)
   
"KRN",8994,2082,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,2082,3,7,0)
                          ^01: The last error code
"KRN",8994,2082,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,2082,3,9,0)
                                                                      
"KRN",8994,2082,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,2082,3,11,0)
                          ^01: Error code
"KRN",8994,2082,3,12,0)
                          ^02: Message
"KRN",8994,2082,3,13,0)
                          ^03: Place of the error
"KRN",8994,2082,3,14,0)
 
"KRN",8994,2082,3,15,0)
A positive value of the first "^"-piece of the Results[0] indicates an
"KRN",8994,2082,3,16,0)
error in the data. The value is the number of the erroneous piece of the
"KRN",8994,2082,3,17,0)
data segment whose name is returned in the second piece of the Results[0].
"KRN",8994,2082,3,18,0)
For example, the "5^HEPC" means that the 5th piece of the HEPC data
"KRN",8994,2082,3,19,0)
segment (SUPPORTING EVIDENCE) contains an invalid value.
"KRN",8994,2082,3,20,0)
    
"KRN",8994,2082,3,21,0)
Otherwise, zero is returned in the Results[0].
"KRN",8994,2220,-1)
0^1
"KRN",8994,2220,0)
ROR LIST PARAMETER INSTANCES^GETPLIST^RORRP038^2^R^^^1
"KRN",8994,2220,2,0)
^8994.02A^3^3
"KRN",8994,2220,2,1,0)
NAME^1^60^^1
"KRN",8994,2220,2,1,1,0)
^^1^1^3041027^
"KRN",8994,2220,2,1,1,1,0)
The NAME parameter defines the name of the parameter.
"KRN",8994,2220,2,2,0)
ENTITY^1^30^^2
"KRN",8994,2220,2,2,1,0)
^8994.021^4^4^3041027^^
"KRN",8994,2220,2,2,1,1,0)
The ENTITY parameter defines the area(s) where the parameter value is
"KRN",8994,2220,2,2,1,2,0)
searched for. By default ($G(ENTITY)=""), the "ALL" value is used (see the
"KRN",8994,2220,2,2,1,3,0)
DBIA #2263 for more details). The other values that are used most often
"KRN",8994,2220,2,2,1,4,0)
are the "USR" (user settings) and the "PKG" (package settings).
"KRN",8994,2220,2,3,0)
PREFIX^1^30^^3
"KRN",8994,2220,2,3,1,0)
^^2^2^3041027^
"KRN",8994,2220,2,3,1,1,0)
Only those instances are selected whose names begin from a value of this 
"KRN",8994,2220,2,3,1,2,0)
parameter.  By default ($G(PREFIX)=""), all instances are selected.
"KRN",8994,2220,2,"B","ENTITY",2)

"KRN",8994,2220,2,"B","NAME",1)

"KRN",8994,2220,2,"B","PREFIX",3)

"KRN",8994,2220,2,"PARAMSEQ",1,1)

"KRN",8994,2220,2,"PARAMSEQ",2,2)

"KRN",8994,2220,2,"PARAMSEQ",3,3)

"KRN",8994,2220,3,0)
^8994.03^21^21^3041027^^
"KRN",8994,2220,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,2220,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,2220,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,2220,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,2220,3,5,0)
   
"KRN",8994,2220,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,2220,3,7,0)
                          ^01: The last error code
"KRN",8994,2220,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,2220,3,9,0)
                                                                       
"KRN",8994,2220,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,2220,3,11,0)
                          ^01: Error code
"KRN",8994,2220,3,12,0)
                          ^02: Message
"KRN",8994,2220,3,13,0)
                          ^03: Place of the error
"KRN",8994,2220,3,14,0)
 
"KRN",8994,2220,3,15,0)
Otherwise, the Results[0] contains number of parameter instances and the
"KRN",8994,2220,3,16,0)
subsequent node(s) of the Results array contain the instance names and
"KRN",8994,2220,3,17,0)
values:
"KRN",8994,2220,3,18,0)
 
"KRN",8994,2220,3,19,0)
  Results[0]            Number of instances
"KRN",8994,2220,3,20,0)
 
"KRN",8994,2220,3,21,0)
  Results[i]            Instance name^Internal value
"KRN",8994,2221,-1)
0^20
"KRN",8994,2221,0)
ROR GUI PARAMETER RENAME^RENPARM^RORRP038^2^R^^^1
"KRN",8994,2221,1,0)
^8994.01^2^2^3041028^^
"KRN",8994,2221,1,1,0)
The ROR GUI PARAMETER RENAME remote procedure renames the instance of the 
"KRN",8994,2221,1,2,0)
parameter.
"KRN",8994,2221,2,0)
^8994.02A^4^4
"KRN",8994,2221,2,1,0)
ENTITY^1^30^1^1
"KRN",8994,2221,2,1,1,0)
^^4^4^3041028^
"KRN",8994,2221,2,1,1,1,0)
The ENTITY parameter defines the context that the parameter value is
"KRN",8994,2221,2,1,1,2,0)
associated with.  The values that are used most often are the "USR" (user 
"KRN",8994,2221,2,1,1,3,0)
settings) and "PKG" (package settings).  See the DBIA #2263 for more 
"KRN",8994,2221,2,1,1,4,0)
details.
"KRN",8994,2221,2,2,0)
NAME^1^30^1^2
"KRN",8994,2221,2,2,1,0)
^^1^1^3041028^
"KRN",8994,2221,2,2,1,1,0)
The NAME parameter defines the name of the GUI parameter.
"KRN",8994,2221,2,3,0)
OLDINST^1^60^1^3
"KRN",8994,2221,2,3,1,0)
^^1^1^3041028^
"KRN",8994,2221,2,3,1,1,0)
Current instance name of the GUI parameter.
"KRN",8994,2221,2,4,0)
NEWINST^1^60^1^4
"KRN",8994,2221,2,4,1,0)
^8994.021^1^1^3041028^^
"KRN",8994,2221,2,4,1,1,0)
New instance name for the GUI parameter.
"KRN",8994,2221,2,"B","ENTITY",1)

"KRN",8994,2221,2,"B","NAME",2)

"KRN",8994,2221,2,"B","NEWINST",4)

"KRN",8994,2221,2,"B","OLDINST",3)

"KRN",8994,2221,2,"PARAMSEQ",1,1)

"KRN",8994,2221,2,"PARAMSEQ",2,2)

"KRN",8994,2221,2,"PARAMSEQ",3,3)

"KRN",8994,2221,2,"PARAMSEQ",4,4)

"KRN",8994,2221,3,0)
^8994.03^15^15^3041028^^
"KRN",8994,2221,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,2221,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,2221,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,2221,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,2221,3,5,0)
   
"KRN",8994,2221,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,2221,3,7,0)
                          ^01: The last error code
"KRN",8994,2221,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,2221,3,9,0)
                                                                       
"KRN",8994,2221,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,2221,3,11,0)
                          ^01: Error code
"KRN",8994,2221,3,12,0)
                          ^02: Message
"KRN",8994,2221,3,13,0)
                          ^03: Place of the error
"KRN",8994,2221,3,14,0)
 
"KRN",8994,2221,3,15,0)
Otherwise, the Results[0] contains 0.
"KRN",8994,2323,-1)
0^73
"KRN",8994,2323,0)
ROR LIST LOCAL FIELDS^LFLIST^RORRP040^4^R^^^1
"KRN",8994,2323,1,0)
^8994.01^3^3^3050811^^^^
"KRN",8994,2323,1,1,0)
The ROR LIST LOCAL FIELDS remote procedure returns a list of
"KRN",8994,2323,1,2,0)
registry-specific field definitions from the ROR LOCAL FIELD file
"KRN",8994,2323,1,3,0)
(#799.53).
"KRN",8994,2323,2,0)
^8994.02A^3^3
"KRN",8994,2323,2,1,0)
REGIEN^1^^1^1
"KRN",8994,2323,2,1,1,0)
^^2^2^3050513^
"KRN",8994,2323,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,2323,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,2323,2,2,0)
FLAGS^1^^^2
"KRN",8994,2323,2,2,1,0)
^8994.021^3^3^3050811^^^^
"KRN",8994,2323,2,2,1,1,0)
Flags that control the execution (can be combined):
"KRN",8994,2323,2,2,1,2,0)
 
"KRN",8994,2323,2,2,1,3,0)
  I  Include inactive field definitions
"KRN",8994,2323,2,3,0)
LOCK^1^^^3
"KRN",8994,2323,2,3,1,0)
^8994.021^1^1^3050811^^^^
"KRN",8994,2323,2,3,1,1,0)
Lock the local fields before loading the data and leave them locked.
"KRN",8994,2323,2,"B","FLAGS",2)

"KRN",8994,2323,2,"B","LOCK",3)

"KRN",8994,2323,2,"B","REGIEN",1)

"KRN",8994,2323,2,"PARAMSEQ",1,1)

"KRN",8994,2323,2,"PARAMSEQ",2,2)

"KRN",8994,2323,2,"PARAMSEQ",3,3)

"KRN",8994,2323,3,0)
^8994.03^35^35^3050811^^^
"KRN",8994,2323,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,2323,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,2323,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,2323,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,2323,3,5,0)
 
"KRN",8994,2323,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,2323,3,7,0)
                          ^01: The last error code
"KRN",8994,2323,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,2323,3,9,0)
 
"KRN",8994,2323,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,2323,3,11,0)
                          ^01: Error code
"KRN",8994,2323,3,12,0)
                          ^02: Message
"KRN",8994,2323,3,13,0)
                          ^03: Place of the error
"KRN",8994,2323,3,14,0)
 
"KRN",8994,2323,3,15,0)
Otherwise, number of local fields is returned in the Results[0] and the
"KRN",8994,2323,3,16,0)
subsequent nodes of the array contain the field definitions.
"KRN",8994,2323,3,17,0)
                                                                  
"KRN",8994,2323,3,18,0)
If the local fields cannot be locked then the second "^"-piece of the
"KRN",8994,2323,3,19,0)
Results[0] will be greater than 0 and the node will contain the lock
"KRN",8994,2323,3,20,0)
descriptor.                              
"KRN",8994,2323,3,21,0)
 
"KRN",8994,2323,3,22,0)
  Results[0]            Result Descriptor
"KRN",8994,2323,3,23,0)
                          ^01: Number of local fields
"KRN",8994,2323,3,24,0)
                          [Lock Descriptor]
"KRN",8994,2323,3,25,0)
                          ^02: Date/Time
"KRN",8994,2323,3,26,0)
                          ^03: User/Process name
"KRN",8994,2323,3,27,0)
                          ^04: User IEN (DUZ)
"KRN",8994,2323,3,28,0)
                          ^05: $JOB
"KRN",8994,2323,3,29,0)
                          ^06: Task number
"KRN",8994,2323,3,30,0)
 
"KRN",8994,2323,3,31,0)
  Results[i]            Field Definition
"KRN",8994,2323,3,32,0)
                          ^01: IEN
"KRN",8994,2323,3,33,0)
                          ^02: Name
"KRN",8994,2323,3,34,0)
                          ^03: Date of Inactivation
"KRN",8994,2323,3,35,0)
                          ^04: Description
"KRN",8994,2324,-1)
0^74
"KRN",8994,2324,0)
ROR UPDATE LOCAL FIELDS^LFLUPD^RORRP040^2^R^^^1
"KRN",8994,2324,1,0)
^8994.01^3^3^3050811^^
"KRN",8994,2324,1,1,0)
The ROR UPDATE LOCAL FIELDS remote procedure updates a list of
"KRN",8994,2324,1,2,0)
registry-specific field definitions in the the ROR LOCAL FIELD file
"KRN",8994,2324,1,3,0)
(#799.53).
"KRN",8994,2324,2,0)
^8994.02A^3^3
"KRN",8994,2324,2,1,0)
REGIEN^1^^1^1
"KRN",8994,2324,2,1,1,0)
^8994.021^2^2^3050811^^^
"KRN",8994,2324,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the 
"KRN",8994,2324,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,2324,2,2,0)
CANCEL^1^^^2
"KRN",8994,2324,2,2,1,0)
^^1^1^3050811^
"KRN",8994,2324,2,2,1,1,0)
Cancel the update and unlock the local fields.
"KRN",8994,2324,2,3,0)
LFLST^2^^^3
"KRN",8994,2324,2,3,1,0)
^^7^7^3050811^
"KRN",8994,2324,2,3,1,1,0)
Reference to a local variable that contains a list of local fields.
"KRN",8994,2324,2,3,1,2,0)
 
"KRN",8994,2324,2,3,1,3,0)
  LFLST[i]              Local Field Descriptor
"KRN",8994,2324,2,3,1,4,0)
                          ^01: IEN
"KRN",8994,2324,2,3,1,5,0)
                          ^02: Name
"KRN",8994,2324,2,3,1,6,0)
                          ^03: Inactivation Date (FileMan)
"KRN",8994,2324,2,3,1,7,0)
                          ^04: Description
"KRN",8994,2324,2,"B","CANCEL",2)

"KRN",8994,2324,2,"B","LFLST",3)

"KRN",8994,2324,2,"B","REGIEN",1)

"KRN",8994,2324,2,"PARAMSEQ",1,1)

"KRN",8994,2324,2,"PARAMSEQ",2,2)

"KRN",8994,2324,2,"PARAMSEQ",3,3)

"KRN",8994,2324,3,0)
^8994.03^15^15^3050811^^
"KRN",8994,2324,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,2324,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,2324,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,2324,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,2324,3,5,0)
  
"KRN",8994,2324,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,2324,3,7,0)
                          ^01: The last error code
"KRN",8994,2324,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,2324,3,9,0)
                                                                      
"KRN",8994,2324,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,2324,3,11,0)
                          ^01: Error code
"KRN",8994,2324,3,12,0)
                          ^02: Message
"KRN",8994,2324,3,13,0)
                          ^03: Place of the error
"KRN",8994,2324,3,14,0)
 
"KRN",8994,2324,3,15,0)
Otherwise, zero is returned in the Results[0].
"KRN",8994,2325,-1)
0^75
"KRN",8994,2325,0)
ROR LIST SELECTION RULES^SELRULES^RORRP014^2^R^^^1
"KRN",8994,2325,1,0)
^^4^4^3050516^
"KRN",8994,2325,1,1,0)
The ROR LIST SELECTION RULES remote procedure returns a list 
"KRN",8994,2325,1,2,0)
of registry selection rules from the ROR SELECTION RULE file
"KRN",8994,2325,1,3,0)
(#798.2) that are referenced by the SELCTION RULE multiple (3)
"KRN",8994,2325,1,4,0)
of the ROR REGISTRY PARAMETERS file (#798.1).
"KRN",8994,2325,2,0)
^8994.02A^1^1
"KRN",8994,2325,2,1,0)
REGIEN^1^^1^1
"KRN",8994,2325,2,1,1,0)
^8994.021^2^2^3050516^^
"KRN",8994,2325,2,1,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,2325,2,1,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,2325,2,"B","REGIEN",1)

"KRN",8994,2325,2,"PARAMSEQ",1,1)

"KRN",8994,2325,3,0)
^^24^24^3050516^
"KRN",8994,2325,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that
"KRN",8994,2325,3,2,0)
an error occurred during the execution of the remote procedure. In this
"KRN",8994,2325,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,2325,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,2325,3,5,0)
 
"KRN",8994,2325,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,2325,3,7,0)
                          ^01: The last error code
"KRN",8994,2325,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,2325,3,9,0)
 
"KRN",8994,2325,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,2325,3,11,0)
                          ^01: Error code
"KRN",8994,2325,3,12,0)
                          ^02: Message
"KRN",8994,2325,3,13,0)
                          ^03: Place of the error
"KRN",8994,2325,3,14,0)
 
"KRN",8994,2325,3,15,0)
Otherwise, number of top-level selection rules is returned in the
"KRN",8994,2325,3,16,0)
Results[0] and the subsequent nodes of the array contain the rule
"KRN",8994,2325,3,17,0)
definitions.
"KRN",8994,2325,3,18,0)
 
"KRN",8994,2325,3,19,0)
   Results[0]            Number of Selection Rules
"KRN",8994,2325,3,20,0)
 
"KRN",8994,2325,3,21,0)
   Results[i]            Rule Definition
"KRN",8994,2325,3,22,0)
                           ^01: IEN
"KRN",8994,2325,3,23,0)
                           ^02: Name
"KRN",8994,2325,3,24,0)
                           ^03: Short Description
"KRN",8994,2326,-1)
0^76
"KRN",8994,2326,0)
ROR PRODUCTION ACCOUNT^PROD^RORRP012^2^P^^^1
"KRN",8994,2326,1,0)
^^2^2^3050526^
"KRN",8994,2326,1,1,0)
This RPC checks if the current account is a 
"KRN",8994,2326,1,2,0)
production one.
"KRN",8994,2326,3,0)
^8994.03^2^2^3050526^^
"KRN",8994,2326,3,1,0)
1 is returned in Results[0] in case of a production account. Otherwise, 
"KRN",8994,2326,3,2,0)
zero is returned.
"KRN",8994,2335,-1)
0^77
"KRN",8994,2335,0)
ROR PATIENT REGISTRY LABS^LOADPRL^RORRP041^4^R^^^1
"KRN",8994,2335,1,0)
^^2^2^3050819^
"KRN",8994,2335,1,1,0)
This remote procedure returns the results of registry-specific lab tests 
"KRN",8994,2335,1,2,0)
for the patient and group statistics for these results.
"KRN",8994,2335,2,0)
^8994.02A^2^2
"KRN",8994,2335,2,1,0)
PTIEN^1^^1^1
"KRN",8994,2335,2,1,1,0)
^^1^1^3050819^
"KRN",8994,2335,2,1,1,1,0)
A valid patient IEN (DFN) should be assigned to the PTIEN parameter.
"KRN",8994,2335,2,2,0)
REGIEN^1^^1^2
"KRN",8994,2335,2,2,1,0)
^^2^2^3050819^
"KRN",8994,2335,2,2,1,1,0)
The REGIEN parameter should contain a valid registry IEN (IEN of the
"KRN",8994,2335,2,2,1,2,0)
registry parameters record in the ROR REGISTRY PARAMETERS file #798.1).
"KRN",8994,2335,2,"B","PTIEN",1)

"KRN",8994,2335,2,"B","REGIEN",2)

"KRN",8994,2335,2,"PARAMSEQ",1,1)

"KRN",8994,2335,2,"PARAMSEQ",2,2)

"KRN",8994,2335,3,0)
^^37^37^3050819^
"KRN",8994,2335,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,2335,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,2335,3,3,0)
case, the second piece of the Results[0] will contain number of the error
"KRN",8994,2335,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,2335,3,5,0)
  
"KRN",8994,2335,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,2335,3,7,0)
                          ^01: The last error code
"KRN",8994,2335,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,2335,3,9,0)
   
"KRN",8994,2335,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,2335,3,11,0)
                          ^01: Error code
"KRN",8994,2335,3,12,0)
                          ^02: Message
"KRN",8994,2335,3,13,0)
                          ^03: Place of the error
"KRN",8994,2335,3,14,0)
 
"KRN",8994,2335,3,15,0)
Otherwise, zero is returned in the Results[0] and subsequent nodes 
"KRN",8994,2335,3,16,0)
contain the patient's data.
"KRN",8994,2335,3,17,0)
 
"KRN",8994,2335,3,18,0)
  Results[0]            0
"KRN",8994,2335,3,19,0)
  
"KRN",8994,2335,3,20,0)
  Results[i]            Registry-specific Lab Result
"KRN",8994,2335,3,21,0)
                          ^01: "LTR"
"KRN",8994,2335,3,22,0)
                          ^02: Result IEN (inverted date/time)
"KRN",8994,2335,3,23,0)
                          ^03: Date/time of the test (FileMan)
"KRN",8994,2335,3,24,0)
                          ^04: Result
"KRN",8994,2335,3,25,0)
                          ^05: Test IEN (in file #60)
"KRN",8994,2335,3,26,0)
                          ^06: Test name
"KRN",8994,2335,3,27,0)
                          ^07: Code of the group
"KRN",8994,2335,3,28,0)
                          ^08: Group name
"KRN",8994,2335,3,29,0)
   
"KRN",8994,2335,3,30,0)
  Results[i]            Lab Group Statistics
"KRN",8994,2335,3,31,0)
                          ^01: "LTG"
"KRN",8994,2335,3,32,0)
                          ^02: Code of the group
"KRN",8994,2335,3,33,0)
                          ^03: Group name
"KRN",8994,2335,3,34,0)
                          ^04: Latest result value
"KRN",8994,2335,3,35,0)
                          ^05: Date of the latest result (FileMan)
"KRN",8994,2335,3,36,0)
                          ^06: Lowest result value
"KRN",8994,2335,3,37,0)
                          ^07: Date of the lowest value (FileMan)
"KRN",8994,2336,-1)
0^78
"KRN",8994,2336,0)
ROR LIST CPT^CPTLIST^RORRP042^4^R^^^1^1
"KRN",8994,2336,1,0)
^8994.01^2^2^3051110^^^^
"KRN",8994,2336,1,1,0)
The ROR LIST CPT remote procedure returns a list of CPT codes (defined in
"KRN",8994,2336,1,2,0)
the CPT file), which conform the criteria.
"KRN",8994,2336,2,0)
^8994.02A^5^5
"KRN",8994,2336,2,1,0)
PART^1^30^^2
"KRN",8994,2336,2,1,1,0)
^8994.021^1^1^3051007^^^
"KRN",8994,2336,2,1,1,1,0)
The partial match restriction.
"KRN",8994,2336,2,2,0)
FLAGS^1^^^3
"KRN",8994,2336,2,2,1,0)
^^12^12^3051110^
"KRN",8994,2336,2,2,1,1,0)
Flags that control the execution (can be combined):
"KRN",8994,2336,2,2,1,2,0)
 
"KRN",8994,2336,2,2,1,3,0)
  A  Exclude active codes
"KRN",8994,2336,2,2,1,4,0)
 
"KRN",8994,2336,2,2,1,5,0)
  B  Backwards. Traverses the index in the opposite
"KRN",8994,2336,2,2,1,6,0)
     direction of normal traversal
"KRN",8994,2336,2,2,1,7,0)
 
"KRN",8994,2336,2,2,1,8,0)
  D  Full search by short name
"KRN",8994,2336,2,2,1,9,0)
 
"KRN",8994,2336,2,2,1,10,0)
  I  Exclude inactive codes
"KRN",8994,2336,2,2,1,11,0)
 
"KRN",8994,2336,2,2,1,12,0)
  K  Search in description keywords
"KRN",8994,2336,2,3,0)
NUMBER^1^^^4
"KRN",8994,2336,2,3,1,0)
^8994.021^2^2^3051007^^^
"KRN",8994,2336,2,3,1,1,0)
Maximum number of entries to return. A value of "*" or no value in this 
"KRN",8994,2336,2,3,1,2,0)
parameter designates all entries.
"KRN",8994,2336,2,4,0)
FROM^1^^^5
"KRN",8994,2336,2,4,1,0)
^8994.021^13^13^3051007^^^^
"KRN",8994,2336,2,4,1,1,0)
The index entry(s) from which to begin the list
"KRN",8994,2336,2,4,1,2,0)
   ^01: FromName
"KRN",8994,2336,2,4,1,3,0)
   ^02: FromIEN
"KRN",8994,2336,2,4,1,4,0)
  
"KRN",8994,2336,2,4,1,5,0)
For example, a FROM value of "18" would list entries following 18. You can
"KRN",8994,2336,2,4,1,6,0)
use the 2-nd and 3-rd "^"- pieces of the Results[0] to continue the
"KRN",8994,2336,2,4,1,7,0)
listing in the subsequent procedure calls.
"KRN",8994,2336,2,4,1,8,0)
  
"KRN",8994,2336,2,4,1,9,0)
NOTE: The FROM value itself is not included in the
"KRN",8994,2336,2,4,1,10,0)
      resulting list.
"KRN",8994,2336,2,4,1,11,0)
  
"KRN",8994,2336,2,4,1,12,0)
See description of the LIST^DIC for more details about the PART, NUMBER 
"KRN",8994,2336,2,4,1,13,0)
and FROM parameters.
"KRN",8994,2336,2,5,0)
DATE^1^^^1
"KRN",8994,2336,2,5,1,0)
^8994.021^1^1^3051110^^^
"KRN",8994,2336,2,5,1,1,0)
Date for the code set versioning.
"KRN",8994,2336,2,"B","DATE",5)

"KRN",8994,2336,2,"B","FLAGS",2)

"KRN",8994,2336,2,"B","FROM",4)

"KRN",8994,2336,2,"B","NUMBER",3)

"KRN",8994,2336,2,"B","PART",1)

"KRN",8994,2336,2,"PARAMSEQ",1,5)

"KRN",8994,2336,2,"PARAMSEQ",2,1)

"KRN",8994,2336,2,"PARAMSEQ",3,2)

"KRN",8994,2336,2,"PARAMSEQ",4,3)

"KRN",8994,2336,2,"PARAMSEQ",5,4)

"KRN",8994,2336,3,0)
^8994.03^30^30^3051110^^
"KRN",8994,2336,3,1,0)
A negative value of the first "^"-piece of the Results[0] indicates that 
"KRN",8994,2336,3,2,0)
an error occurred during the execution of the remote procedure. In this 
"KRN",8994,2336,3,3,0)
case, the second piece of the Results[0] will contain number of the error 
"KRN",8994,2336,3,4,0)
descriptors returned in the subsequent nodes of the Results array:
"KRN",8994,2336,3,5,0)
  
"KRN",8994,2336,3,6,0)
  Results[0]            Result Descriptor
"KRN",8994,2336,3,7,0)
                          ^01: The last error code
"KRN",8994,2336,3,8,0)
                          ^02: Number of the error descriptors
"KRN",8994,2336,3,9,0)
   
"KRN",8994,2336,3,10,0)
  Results[i]            Error Descriptor
"KRN",8994,2336,3,11,0)
                          ^01: Error code
"KRN",8994,2336,3,12,0)
                          ^02: Message
"KRN",8994,2336,3,13,0)
                          ^03: Place of the error
"KRN",8994,2336,3,14,0)
 
"KRN",8994,2336,3,15,0)
Otherwise, number of CPT codes and the value of the FROM parameter for the
"KRN",8994,2336,3,16,0)
next procedure call are returned in the Results[0] and the subsequent
"KRN",8994,2336,3,17,0)
nodes of the global array contain the codes.
"KRN",8994,2336,3,18,0)
  
"KRN",8994,2336,3,19,0)
  Results[0]          Result Descriptor
"KRN",8994,2336,3,20,0)
                        ^01: Number of codes
"KRN",8994,2336,3,21,0)
                        ^02: FromName
"KRN",8994,2336,3,22,0)
                        ^03: FromIEN
"KRN",8994,2336,3,23,0)
 
"KRN",8994,2336,3,24,0)
  Results[i]          CPT
"KRN",8994,2336,3,25,0)
                        ^01: IEN
"KRN",8994,2336,3,26,0)
                        ^02: Short Description
"KRN",8994,2336,3,27,0)
                        ^03: Code
"KRN",8994,2336,3,28,0)
                        ^04: reserved
"KRN",8994,2336,3,29,0)
                        ^05: Inactive (""/1)
"KRN",8994,2336,3,30,0)
                        ^06: Inactivation Date (FileMan)
"KRN",8994,2347,-1)
1^4
"KRN",8994,2347,0)
ROR ACTIVATE INACTIVATE
"KRN",8994,2348,-1)
1^5
"KRN",8994,2348,0)
ROR ACTIVATE PATIENT GET
"KRN",8994,2349,-1)
1^6
"KRN",8994,2349,0)
ROR ACTIVITY DETAILS
"KRN",8994,2350,-1)
1^7
"KRN",8994,2350,0)
ROR ACTIVITY LOG
"KRN",8994,2351,-1)
1^8
"KRN",8994,2351,0)
ROR CLEAR RPC HANDLE
"KRN",8994,2352,-1)
1^9
"KRN",8994,2352,0)
ROR DRUG REPORT
"KRN",8994,2353,-1)
1^10
"KRN",8994,2353,0)
ROR EDIT PATIENT GET
"KRN",8994,2354,-1)
1^11
"KRN",8994,2354,0)
ROR ENTER EDIT PATIENT
"KRN",8994,2355,-1)
1^12
"KRN",8994,2355,0)
ROR GET CODE LIST
"KRN",8994,2356,-1)
1^13
"KRN",8994,2356,0)
ROR GET GUI PARAMS
"KRN",8994,2357,-1)
1^15
"KRN",8994,2357,0)
ROR GET RPC HANDLE
"KRN",8994,2358,-1)
1^18
"KRN",8994,2358,0)
ROR GET USER NAME
"KRN",8994,2359,-1)
1^21
"KRN",8994,2359,0)
ROR IDRUGS PATIENT SET
"KRN",8994,2360,-1)
1^22
"KRN",8994,2360,0)
ROR INV DRUGS
"KRN",8994,2361,-1)
1^43
"KRN",8994,2361,0)
ROR PATIENT (IN)ACTIVATE
"KRN",8994,2362,-1)
1^44
"KRN",8994,2362,0)
ROR PATIENT CHECKS
"KRN",8994,2363,-1)
1^47
"KRN",8994,2363,0)
ROR PATIENT SEARCH
"KRN",8994,2364,-1)
1^49
"KRN",8994,2364,0)
ROR REG PARAMS GET
"KRN",8994,2365,-1)
1^50
"KRN",8994,2365,0)
ROR REPORT
"KRN",8994,2366,-1)
1^55
"KRN",8994,2366,0)
ROR SET GUI PARAMS
"KRN",8994,2367,-1)
1^56
"KRN",8994,2367,0)
ROR STORE RPC HANDLE
"KRN",8994,2368,-1)
1^64
"KRN",8994,2368,0)
RORHEPC PATIENT CANCEL
"KRN",8994,2369,-1)
1^70
"KRN",8994,2369,0)
RORICR PATIENT CANCEL
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",4,.5)
.5;4;;;EDEOUT^DIFROMSO(.5,DA,"",XPDA);FPRE^DIFROMSI(.5,"",XPDA);EPRE^DIFROMSI(.5,DA,"",XPDA,"",OLDA);;EPOST^DIFROMSI(.5,DA,"",XPDA)
"ORD",4,.5,0)
FUNCTION
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",6,.401)
.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"ORD",6,.401,0)
SORT TEMPLATE
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",9,.84)
.84;9;;;EDEOUT^DIFROMSO(.84,DA,"",XPDA);FPRE^DIFROMSI(.84,"",XPDA);EPRE^DIFROMSI(.84,DA,"",XPDA,"",OLDA);;EPOST^DIFROMSI(.84,DA,"",XPDA);DEL^DIFROMSK(.84,"",%)
"ORD",9,.84,0)
DIALOG
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PGL",798.6,0,2,.02)
REGISTRY^RP798.1'^ROR(798.1,^0;2^Q
"PGL",799.2,0,2,1)
PARENT^*P799.2'X^ROR(799.2,^0;2^Q:$$VAEDT^RORDD(799.2,,-1)  S DIC("S")="I Y'="_+$G(DA) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PKG",389,-1)
1^1
"PKG",389,0)
CLINICAL CASE REGISTRIES^ROR^CLINICAL CASE REGISTRIES
"PKG",389,20,0)
^9.402P^^
"PKG",389,22,0)
^9.49I^1^1
"PKG",389,22,1,0)
1.5^3060208^3050906^222222227
"PKG",389,22,1,1,0)
^^3^3^3060208
"PKG",389,22,1,1,1,0)
Clinical Case Registries (CCR) V1.5 package. 
"PKG",389,22,1,1,2,0)
This build can be used both for updating the CCR V1.0
"PKG",389,22,1,1,3,0)
and for a "virgin" installation of the package.
"PKG",389,"VERSION")
1.5
"PRE")
RORP000
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
214
"RTN","ROR")
0^20^B21431872
"RTN","ROR",1,0)
ROR ;HCIOFO/SG - CLINICAL CASE REGISTRIES ; 2/6/06 9:10am
"RTN","ROR",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","ROR",3,0)
 ;
"RTN","ROR",4,0)
 ; LOCAL VARIABLE ------ DESCRIPTION
"RTN","ROR",5,0)
 ;
"RTN","ROR",6,0)
 ; RORCACHE              In-memory cache
"RTN","ROR",7,0)
 ; RORERRDL              Default error location
"RTN","ROR",8,0)
 ; RORERROR              Error processing data
"RTN","ROR",9,0)
 ; RORPARM               Task-wide constants and variables
"RTN","ROR",10,0)
 ;
"RTN","ROR",11,0)
 ; See the source code of the ^ROR02 routine for more details.
"RTN","ROR",12,0)
 ;
"RTN","ROR",13,0)
 ; ROREXT                Regular data extraction    (See ^ROREXT)
"RTN","ROR",14,0)
 ; RORHDT                Historical data extraction (See ^RORHDT)
"RTN","ROR",15,0)
 ; RORLOG                Log subsystem data         (See ^RORLOG)
"RTN","ROR",16,0)
 ; RORUPD                Registry update parameters (See ^RORUPD)
"RTN","ROR",17,0)
 ;
"RTN","ROR",18,0)
 ; TEMPORARY NODE ------ DESCRIPTION
"RTN","ROR",19,0)
 ;
"RTN","ROR",20,0)
 ; ^TMP("RORHDT")        Control data of historical data extraction
"RTN","ROR",21,0)
 ; ^TMP("RORTMP")        Temporary storage
"RTN","ROR",22,0)
 ; ^TMP("RORUPD")        Registry update temporary data
"RTN","ROR",23,0)
 ;
"RTN","ROR",24,0)
 ; ^TMP(rtn_name)        Temporary storage used by the rtn_name
"RTN","ROR",25,0)
 ;                       routine (mostly, the RPC's)
"RTN","ROR",26,0)
 ;
"RTN","ROR",27,0)
 ; ^TMP($J,"RORTMP-"_)   Generic temporary storage used by ^RORTMP
"RTN","ROR",28,0)
 ;
"RTN","ROR",29,0)
 ; ^XTMP("RORHDT")       Control data of historical data extraction
"RTN","ROR",30,0)
 ; ^XTMP("RORUPDJ")      Registry update temporary data (multitask)
"RTN","ROR",31,0)
 ; ^XTMP("RORUPDR")      Registry update temporary data (installation)
"RTN","ROR",32,0)
 ;
"RTN","ROR",33,0)
 ; See detailed description of the temporary global nodes in
"RTN","ROR",34,0)
 ; the source code of the ^ROR01 routine.
"RTN","ROR",35,0)
 ;
"RTN","ROR",36,0)
 ; NAMESPACE ----------- DESCRIPTION
"RTN","ROR",37,0)
 ;
"RTN","ROR",38,0)
 ; RORAPI*               Supported APIs
"RTN","ROR",39,0)
 ; RORDD*                Routines used by the Data Dictionary
"RTN","ROR",40,0)
 ; RORERR*               Error processing
"RTN","ROR",41,0)
 ; ROREVT*               Event protocols
"RTN","ROR",42,0)
 ; ROREX*                Regular data extraction & transmission
"RTN","ROR",43,0)
 ; RORHDT*               Historical data extraction
"RTN","ROR",44,0)
 ; RORHIV*               HIV registry-specific routines
"RTN","ROR",45,0)
 ; RORHL*                HL7 utilities
"RTN","ROR",46,0)
 ; RORKIDS*              Low-level installation utilities (KIDS)
"RTN","ROR",47,0)
 ; RORLOCK*              Locks and transactions
"RTN","ROR",48,0)
 ; RORLOG*               Error recording
"RTN","ROR",49,0)
 ;
"RTN","ROR",50,0)
 ; RORPnnn*               Patch installation routines (KIDS)
"RTN","ROR",51,0)
 ;                         nnn - patch number
"RTN","ROR",52,0)
 ; RORPUT*               High-level installation utilities
"RTN","ROR",53,0)
 ;
"RTN","ROR",54,0)
 ; RORREP*               Roll-and-scroll reports
"RTN","ROR",55,0)
 ; RORRP*                Remote procedures
"RTN","ROR",56,0)
 ; RORSET*               Registry setup routines
"RTN","ROR",57,0)
 ; RORTXT*               Text resource routines
"RTN","ROR",58,0)
 ; RORUP*                Registry update
"RTN","ROR",59,0)
 ; RORUTL*               Utilities
"RTN","ROR",60,0)
 ; RORVM*                Entry points for VistA menu options
"RTN","ROR",61,0)
 ; RORXnnn*              XML reports (nnn - report code)
"RTN","ROR",62,0)
 ; RORXU*                Utilities for XML reports
"RTN","ROR",63,0)
 ;
"RTN","ROR",64,0)
 ; DIALOG -------------- DESCRIPTION
"RTN","ROR",65,0)
 ;
"RTN","ROR",66,0)
 ; 7980000.*             Various messages and templates
"RTN","ROR",67,0)
 ; 7981???.*             Report templates (XSL)
"RTN","ROR",68,0)
 ;
"RTN","ROR",69,0)
 ; MENU OPTION --------- DESCRIPTION
"RTN","ROR",70,0)
 ;
"RTN","ROR",71,0)
 ; [ROR TASK]            Registry update and data extraction option
"RTN","ROR",72,0)
 ;                       (must be scheduled; do not run it directly)
"RTN","ROR",73,0)
 ; [ROR SETUP]           Registry Setup
"RTN","ROR",74,0)
 ; [RORHDT MAIN]         Historical data extraction menu
"RTN","ROR",75,0)
 ; [RORMNT MAIN]         Maintenance menu
"RTN","ROR",76,0)
 ;
"RTN","ROR",77,0)
 ; SPECIAL ENTRY POINT - DESCRIPTION
"RTN","ROR",78,0)
 ;
"RTN","ROR",79,0)
 ;         ^RORUTL06     Menu for developer's utilities
"RTN","ROR",80,0)
 ; DISTPREP^RORUTL06     Prepares registry for KIDS distribution
"RTN","ROR",81,0)
 ;   PRTMDE^RORUTL06     Prints the data element metadata
"RTN","ROR",82,0)
 ;   VERIFY^RORUTL06     Checks the registry definition
"RTN","ROR",83,0)
 ;
"RTN","ROR",84,0)
 ;  EXTRACT^RORUTL07     Data extraction & transmission in debug mode
"RTN","ROR",85,0)
 ;   UPDATE^RORUTL07     Registry update in debug mode
"RTN","ROR",86,0)
 ;
"RTN","ROR",87,0)
 ; INITIALS ------------ DEVELOPER
"RTN","ROR",88,0)
 ;
"RTN","ROR",89,0)
 ; BH                    Brent Hicks
"RTN","ROR",90,0)
 ; CRT                   Cameron Taylor
"RTN","ROR",91,0)
 ; SG                    Sergey Gavrilov
"RTN","ROR",92,0)
 ;
"RTN","ROR",93,0)
 Q
"RTN","ROR",94,0)
 ;
"RTN","ROR",95,0)
 ;***** RETURNS THE TEST BUILD NUMBER FOR THE DATA EXTRACTION
"RTN","ROR",96,0)
BUILD() ;
"RTN","ROR",97,0)
 Q 6
"RTN","ROR",98,0)
 ;
"RTN","ROR",99,0)
 ;***** REGISTRY UPDATE AND DATA EXTRACTION TASK
"RTN","ROR",100,0)
 ;
"RTN","ROR",101,0)
 ; ZTQPARAM      String that contains a list of registry names
"RTN","ROR",102,0)
 ;               separated by commas. You must define the list as
"RTN","ROR",103,0)
 ;               a value of the TASK PARAMETERS field during
"RTN","ROR",104,0)
 ;               scheduling of the [ROR TASK] option that uses
"RTN","ROR",105,0)
 ;               this entry point.
"RTN","ROR",106,0)
 ;
"RTN","ROR",107,0)
 ; The following task parameters are optional. They can be defined
"RTN","ROR",108,0)
 ; on the second page of the option scheduling form as the pairs of
"RTN","ROR",109,0)
 ; variable names and values. See description of the ROR TASK option
"RTN","ROR",110,0)
 ; for more details regarding these parameters.
"RTN","ROR",111,0)
 ;
"RTN","ROR",112,0)
 ; [RORFLCLR]    Clear flags to control processing (default: "").
"RTN","ROR",113,0)
 ; [RORFLSET]    Set flags to control processing (default: "EX").
"RTN","ROR",114,0)
 ;
"RTN","ROR",115,0)
 ;                 D  Run the task(s) in Debug Mode #1
"RTN","ROR",116,0)
 ;
"RTN","ROR",117,0)
 ;                 E  Use the event references (file #798.3)
"RTN","ROR",118,0)
 ;
"RTN","ROR",119,0)
 ;                 S  Run the data extraction in single-task mode
"RTN","ROR",120,0)
 ;
"RTN","ROR",121,0)
 ;                 X  Suspend the data extraction task in the
"RTN","ROR",122,0)
 ;                    same way as the registry update
"RTN","ROR",123,0)
 ;
"RTN","ROR",124,0)
 ; [RORMNTSK]    Maximum number of the registry update subtasks.
"RTN","ROR",125,0)
 ;               The default value of the parameter is "2-3-AUTO".
"RTN","ROR",126,0)
 ;
"RTN","ROR",127,0)
 ; [RORSUSP]     Suspension parameters of the registry update and
"RTN","ROR",128,0)
 ;               data extraction subtasks. The subtasks are not
"RTN","ROR",129,0)
 ;               suspended by default.
"RTN","ROR",130,0)
 ;
"RTN","ROR",131,0)
TASK ;
"RTN","ROR",132,0)
 N RORERROR      ; Error processing data
"RTN","ROR",133,0)
 N RORLOG        ; Log subsystem constants & variables
"RTN","ROR",134,0)
 N RORPARM       ; Application parameters
"RTN","ROR",135,0)
 ;
"RTN","ROR",136,0)
 N CNT,FLAGS,I,RC,REGLST,REGNAME,RORERRDL  K ZTREQ
"RTN","ROR",137,0)
 ;--- Initialize constants and variables
"RTN","ROR",138,0)
 D INIT^RORUTL01("ROR",1)
"RTN","ROR",139,0)
 D CLEAR^RORERR("TASK^ROR",1)
"RTN","ROR",140,0)
 ;--- Open a new log
"RTN","ROR",141,0)
 S RC=$$SETUP^RORLOG()
"RTN","ROR",142,0)
 S RC=$$OPEN^RORLOG(,7,"ROR TASK STARTED")
"RTN","ROR",143,0)
 ;
"RTN","ROR",144,0)
 ;--- Check and log the task parameters and force the <UNDEF>
"RTN","ROR",145,0)
 ;--- error in case of a missing/invalid critical value
"RTN","ROR",146,0)
 I $$TASKPRMS^ROR10(.REGLST)<0  K ZTQPARAM  S RC=ZTQPARAM
"RTN","ROR",147,0)
 ;--- Clear/Set the flags (override the default value)
"RTN","ROR",148,0)
 S FLAGS=$TR("EX",RORFLCLR_RORFLSET)_RORFLSET
"RTN","ROR",149,0)
 ;--- Associate the log with the registries
"RTN","ROR",150,0)
 S RC=$$SETRGLST^RORLOG(.REGLST)
"RTN","ROR",151,0)
 ;--- Enable debug mode if requested
"RTN","ROR",152,0)
 S:FLAGS["D" RORPARM("DEBUG")=1
"RTN","ROR",153,0)
 ;
"RTN","ROR",154,0)
 ;--- Rebuild the "ACL" cross-reference
"RTN","ROR",155,0)
 S RC=$$RNDXACL^RORUTL11()
"RTN","ROR",156,0)
 ;--- Remove inactive registries from the list
"RTN","ROR",157,0)
 S RC=$$ARLST^RORUTL02(.REGLST)  G:RC<0 ABORT
"RTN","ROR",158,0)
 ;--- Check the status of last HL7 message(s)
"RTN","ROR",159,0)
 S RC=$$CHECKMSG^ROR10(.REGLST)  G:RC<0 ABORT
"RTN","ROR",160,0)
 ;
"RTN","ROR",161,0)
 ;--- Update the registries
"RTN","ROR",162,0)
 S RC=$$UPDATE^RORUPD(.REGLST,RORMNTSK,RORSUSP,FLAGS)
"RTN","ROR",163,0)
 ;--- Process the errors
"RTN","ROR",164,0)
 I RC<0  D  G:RC<0 ABORT
"RTN","ROR",165,0)
 . ;--- Quit if stop is requested (via the TaskMan User option)
"RTN","ROR",166,0)
 . I RC=-42  D ALERT^RORUTL01(.REGLST,-42)  S ZTSTOP=1  Q
"RTN","ROR",167,0)
 . ;--- Do not send the alert for some warnings
"RTN","ROR",168,0)
 . I RC=-28  S RC=0  Q
"RTN","ROR",169,0)
 . ;--- Send the alert in case of other errors/warnings
"RTN","ROR",170,0)
 . D ALERT^RORUTL01(.REGLST,-43,,,,"registry update")
"RTN","ROR",171,0)
 . S RC=0
"RTN","ROR",172,0)
 ;
"RTN","ROR",173,0)
 ;--- Mark registry records 1 month after the installation so that
"RTN","ROR",174,0)
 ;    the local registry data and demographic data will be resent
"RTN","ROR",175,0)
 ;--- to restore the data overwritten with the historical data
"RTN","ROR",176,0)
 S RC=$$REMARK^RORUTL05(.REGLST,31)
"RTN","ROR",177,0)
 ;
"RTN","ROR",178,0)
 ;--- Perform the data extraction
"RTN","ROR",179,0)
 S RC=$$EXTRACT^ROREXT(.REGLST,,RORSUSP,FLAGS)
"RTN","ROR",180,0)
 ;--- Process the errors
"RTN","ROR",181,0)
 I RC<0  D  G:RC<0 ABORT
"RTN","ROR",182,0)
 . ;--- Quit if stop is requested (via the TaskMan User option)
"RTN","ROR",183,0)
 . I RC=-42  D ALERT^RORUTL01(.REGLST,-42)  S ZTSTOP=1  Q
"RTN","ROR",184,0)
 . ;--- Do not send the alert for some warnings
"RTN","ROR",185,0)
 . I RC=-28  S RC=0  Q
"RTN","ROR",186,0)
 . ;--- Send the alert in case of other errors/warnings
"RTN","ROR",187,0)
 . D ALERT^RORUTL01(.REGLST,-43,,,,"data extraction")
"RTN","ROR",188,0)
 . S RC=0
"RTN","ROR",189,0)
 ;
"RTN","ROR",190,0)
 ;--- Purge the old tasks
"RTN","ROR",191,0)
 S RC=$$PURGE^RORTSK02(14)
"RTN","ROR",192,0)
 ;--- Purge the old logs
"RTN","ROR",193,0)
 S RC=$$PURGE^RORLOG01(31)
"RTN","ROR",194,0)
 ;--- Purge the old event references
"RTN","ROR",195,0)
 S RC=$$EPDATE^RORUTL05()
"RTN","ROR",196,0)
 S:RC>0 RC=$$PURGE^RORUPP02(RC)
"RTN","ROR",197,0)
 ;---
"RTN","ROR",198,0)
 S ZTREQ="@"
"RTN","ROR",199,0)
ABORT ;
"RTN","ROR",200,0)
 S I=$S($G(ZTREQ)="@":"COMPLETED",1:"ABORTED")
"RTN","ROR",201,0)
 D CLOSE^RORLOG("ROR TASK "_I)
"RTN","ROR",202,0)
 Q
"RTN","ROR01")
0^21^B15808
"RTN","ROR01",1,0)
ROR01 ;HCIOFO/SG - CLINICAL CASE REGISTRIES (TEMP. GLOBALS) ; 8/25/05 9:38am
"RTN","ROR01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","ROR01",3,0)
 ;
"RTN","ROR01",4,0)
 ; ^TMP($J,"RORTMP-"_) - TEMPORARY STORAGE (see the ^RORTMP routine)
"RTN","ROR01",5,0)
 ;
"RTN","ROR01",6,0)
 ; ^TMP($J,"RORTMP-0",   Indexes of allocated buffers
"RTN","ROR01",7,0)
 ;   i)                  ""
"RTN","ROR01",8,0)
 ;
"RTN","ROR01",9,0)
 ; ^TMP($J,"RORTMP-"_i,  Allocated buffers
"RTN","ROR01",10,0)
 ;   ...)
"RTN","ROR01",11,0)
 ;
"RTN","ROR01",12,0)
 ; ^TMP("RORACK") ------ CONTROL DATA OF ACKNOWLEDGEMENT PROCESSING
"RTN","ROR01",13,0)
 ;
"RTN","ROR01",14,0)
 ; ^TMP("RORACK",$J,
"RTN","ROR01",15,0)
 ;   "PR",IEN)           List of IENs of registry records that
"RTN","ROR01",16,0)
 ;                       acknowledgements have been processed for.
"RTN","ROR01",17,0)
 ;
"RTN","ROR01",18,0)
 ; ^TMP("RORHDT") ------ CONTROL DATA OF HISTORICAL DATA EXTRACTION
"RTN","ROR01",19,0)
 ;
"RTN","ROR01",20,0)
 ; ^TMP("RORHDT",$J,
"RTN","ROR01",21,0)
 ;   "PR",               List of IENs of registry records processed
"RTN","ROR01",22,0)
 ;                       in the re-extraction section of function
"RTN","ROR01",23,0)
 ;                       $$EXTRACT^RORHDT04.
"RTN","ROR01",24,0)
 ;     IEN)              Return code of the record processing. If this
"RTN","ROR01",25,0)
 ;                       value is less than zero, data extraction was
"RTN","ROR01",26,0)
 ;                       not successful again.
"RTN","ROR01",27,0)
 ;
"RTN","ROR01",28,0)
 ; ^TMP("RORPTF") ------ TEMPOPARY PTF INDEX FOR DATA EXTRACTION
"RTN","ROR01",29,0)
 ;
"RTN","ROR01",30,0)
 ; ^TMP("RORPTF",$J,
"RTN","ROR01",31,0)
 ;   "DTF",              List of already indexed time frames of
"RTN","ROR01",32,0)
 ;                       the PTF CLOSE OUT file (#45.84).
"RTN","ROR01",33,0)
 ;     StartDate)        StartDate^EndDate
"RTN","ROR01",34,0)
 ;   "PDI",              Temporary PTF index itself
"RTN","ROR01",35,0)
 ;     DFN,PTFIEN)       ""
"RTN","ROR01",36,0)
 ;
"RTN","ROR01",37,0)
 ; ^TMP("RORTMP",$J) --- TEMPORARY STORAGE
"RTN","ROR01",38,0)
 ;
"RTN","ROR01",39,0)
 ; ^TMP("RORUPD") ------ REGISTRY UPDATE TEMPORARY DATA
"RTN","ROR01",40,0)
 ;
"RTN","ROR01",41,0)
 ; ^TMP("RORUPD",$J,
"RTN","ROR01",42,0)
 ;
"RTN","ROR01",43,0)
 ;   1,File#,
"RTN","ROR01",44,0)
 ;     "S",Rule Name)    List of selection rules
"RTN","ROR01",45,0)
 ;     "F",DataCode,     List of data elements to load
"RTN","ROR01",46,0)
 ;       "E")            If expression implementing the selection
"RTN","ROR01",47,0)
 ;                       rule references an external value of the
"RTN","ROR01",48,0)
 ;                       element, the "E" sub-node will be defined.
"RTN","ROR01",49,0)
 ;       "I")            If expression implementing the selection
"RTN","ROR01",50,0)
 ;                       rule references an internal value of the
"RTN","ROR01",51,0)
 ;                       element, the "I" sub-node will be defined.
"RTN","ROR01",52,0)
 ;
"RTN","ROR01",53,0)
 ;   2,Registry#)        Registry Name
"RTN","ROR01",54,0)
 ;
"RTN","ROR01",55,0)
 ;   3,Rule Name,        Selection rule descriptor
"RTN","ROR01",56,0)
 ;                         ^1: Rule#
"RTN","ROR01",57,0)
 ;                         ^2: File Number
"RTN","ROR01",58,0)
 ;                         ^3: 1 if already processed, otherwise
"RTN","ROR01",59,0)
 ;                             empty string
"RTN","ROR01",60,0)
 ;                         ^4: 1 if registry should be updated (in
"RTN","ROR01",61,0)
 ;                             case of matched condition, of course)
"RTN","ROR01",62,0)
 ;     1)                MUMPS function entry point
"RTN","ROR01",63,0)
 ;     2,Registry#)      List of affected registries
"RTN","ROR01",64,0)
 ;     3,Rule Name)      List of rules that this rule depend on
"RTN","ROR01",65,0)
 ;
"RTN","ROR01",66,0)
 ;   4,LabSearch#)       List of Lab search IENs
"RTN","ROR01",67,0)
 ;
"RTN","ROR01",68,0)
 ;   "LS",
"RTN","ROR01",69,0)
 ;     Result Code,
"RTN","ROR01",70,0)
 ;       LabSearch#,
"RTN","ROR01",71,0)
 ;         Seq#)         Condition to check the result
"RTN","ROR01",72,0)
 ;                         ^1: Indicator
"RTN","ROR01",73,0)
 ;                         ^2: Indicated Value
"RTN","ROR01",74,0)
 ;
"RTN","ROR01",75,0)
 ;   "U",Patient#,       This node is defined if the patient has been 
"RTN","ROR01",76,0)
 ;                       processed
"RTN","ROR01",77,0)
 ;     2,Registry#,      This node is defined if the registry should
"RTN","ROR01",78,0)
 ;                       be updated
"RTN","ROR01",79,0)
 ;       Rule#)          Reference to a top-level selection rule
"RTN","ROR01",80,0)
 ;                         ^01: Trigger date of the rule
"RTN","ROR01",81,0)
 ;                         ^02: Institution IEN
"RTN","ROR01",82,0)
 ;
"RTN","ROR01",83,0)
 ; ^XTMP("RORUPD"_) ---- REGISTRY UPDATE TEMPORARY DATA (MULTITASK)
"RTN","ROR01",84,0)
 ;
"RTN","ROR01",85,0)
 ;                       If the registry update starts in the
"RTN","ROR01",86,0)
 ;                       multitask mode, all temporary data from the
"RTN","ROR01",87,0)
 ;                       ^TMP("RORUPD",$J) node is merged to this
"RTN","ROR01",88,0)
 ;                       node so that it will be available for all
"RTN","ROR01",89,0)
 ;                       registry update subtasks.
"RTN","ROR01",90,0)
 ;
"RTN","ROR01",91,0)
 ; ^XTMP("RORUPDJ"_$J,
"RTN","ROR01",92,0)
 ;                       If the regular registry update is run in the
"RTN","ROR01",93,0)
 ;                       multitask mode, the ^XTMP("RORUPDJ"_$J) node
"RTN","ROR01",94,0)
 ;                       is used. $J is the job number of the main
"RTN","ROR01",95,0)
 ;                       registry update task.
"RTN","ROR01",96,0)
 ;
"RTN","ROR01",97,0)
 ; ^XTMP("RORUPDR"_Registry#,
"RTN","ROR01",98,0)
 ;                       During the initial registry population
"RTN","ROR01",99,0)
 ;                       (performed by the post-install routines),
"RTN","ROR01",100,0)
 ;                       the ^XTMP("RORUPDR"_Registry#) node is used.
"RTN","ROR01",101,0)
 ;                       The list of processed patients (the "U"
"RTN","ROR01",102,0)
 ;                       subscript) is used to restart the process
"RTN","ROR01",103,0)
 ;                       after an error or a crash.
"RTN","ROR01",104,0)
 ;
"RTN","ROR01",105,0)
 ;   0)                  Node descriptor
"RTN","ROR01",106,0)
 ;                         ^1: purge date  (FileMan)
"RTN","ROR01",107,0)
 ;                         ^2: create date (FileMan)
"RTN","ROR01",108,0)
 ;                         ^3: description
"RTN","ROR01",109,0)
 ;
"RTN","ROR01",110,0)
 ;   "T",Task#)          This node is LOCKed while the (sub)task is
"RTN","ROR01",111,0)
 ;                       running (subscript of the main task is 0).
"RTN","ROR01",112,0)
 ;
"RTN","ROR01",113,0)
 ;                       Otherwise, "S" means that the subtask has
"RTN","ROR01",114,0)
 ;                       been scheduled but not started yet.
"RTN","ROR01",115,0)
 ;
"RTN","ROR01",116,0)
 ;                       A negative value of the non-locked node
"RTN","ROR01",117,0)
 ;                       represents the error code (for example,
"RTN","ROR01",118,0)
 ;                       -60 means that the subtask has crashed).
"RTN","ROR01",119,0)
 ;
"RTN","ROR01",120,0)
 ;                       Non-negative value of the node means that
"RTN","ROR01",121,0)
 ;                       the subtask has been completed. The value
"RTN","ROR01",122,0)
 ;                       has the following structure:
"RTN","ROR01",123,0)
 ;                         ^1: Number of processed patients
"RTN","ROR01",124,0)
 ;                         ^2: Number of patients processed with
"RTN","ROR01",125,0)
 ;                             errors
"RTN","ROR01",126,0)
 ;
"RTN","ROR01",127,0)
 Q
"RTN","ROR02")
0^22^B8243
"RTN","ROR02",1,0)
ROR02 ;HCIOFO/SG - CLINICAL CASE REGISTRIES (VARIABLES) ; 7/22/05 11:11am
"RTN","ROR02",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","ROR02",3,0)
 ;
"RTN","ROR02",4,0)
 ; RORCACHE ------------ IN-MEMORY CACHE
"RTN","ROR02",5,0)
 ;
"RTN","ROR02",6,0)
 ; RORCACHE(
"RTN","ROR02",7,0)
 ;   "XMLENT",...)       XML elements and attributes
"RTN","ROR02",8,0)
 ;                       (see the $$XEC^RORTSK11 function)
"RTN","ROR02",9,0)
 ;
"RTN","ROR02",10,0)
 ; RORERRDL ------------ DEFAULT ERROR LOCATION
"RTN","ROR02",11,0)
 ;
"RTN","ROR02",12,0)
 ; RORERROR ------------ ERROR PROCESSING DATA
"RTN","ROR02",13,0)
 ;
"RTN","ROR02",14,0)
 ; RORERROR("ES",        Index of the top of the stack
"RTN","ROR02",15,0)
 ;   Index,                ^1: Error code
"RTN","ROR02",16,0)
 ;                         ^2: Message text
"RTN","ROR02",17,0)
 ;     1)                Place of the error (LABEL^ROUTINE)
"RTN","ROR02",18,0)
 ;     2,Seq#)           Additional information (opt'l)
"RTN","ROR02",19,0)
 ;
"RTN","ROR02",20,0)
 ; RORERROR("DBS",       The $$DBS^RORERR function stores a list of
"RTN","ROR02",21,0)
 ;   ErrCode)            FileMan DBS error codes here (as subnodes).
"RTN","ROR02",22,0)
 ;
"RTN","ROR02",23,0)
 ; RORPARM ------------- PACKAGE-WIDE CONSTANTS AND VARIABLES
"RTN","ROR02",24,0)
 ;
"RTN","ROR02",25,0)
 ; RORPARM("DEBUG")      Debug mode (opt'l):
"RTN","ROR02",26,0)
 ;                         0  Disabled (default)
"RTN","ROR02",27,0)
 ;                         1  Enabled
"RTN","ROR02",28,0)
 ;                         2  Enabled; and all messages are not only
"RTN","ROR02",29,0)
 ;                            logged but displayed on the screen too
"RTN","ROR02",30,0)
 ;                         3  The same as 2 but registry update or
"RTN","ROR02",31,0)
 ;                            data extraction is aborted immediately
"RTN","ROR02",32,0)
 ;                            after processing a patient with errors
"RTN","ROR02",33,0)
 ;
"RTN","ROR02",34,0)
 ; RORPARM("DEVELOPER")  If this node is defined and not zero,
"RTN","ROR02",35,0)
 ;                       national definitions (registry parameters,
"RTN","ROR02",36,0)
 ;                       selection rules, etc) can be edited.
"RTN","ROR02",37,0)
 ;                       Otherwise, editing is prohibited.
"RTN","ROR02",38,0)
 ;
"RTN","ROR02",39,0)
 ; RORPARM("ERR")        Enable/disable extended error processing:
"RTN","ROR02",40,0)
 ;                         0  Disabled (default)
"RTN","ROR02",41,0)
 ;                         1  Enabled
"RTN","ROR02",42,0)
 ;
"RTN","ROR02",43,0)
 ; RORPARM("KIDS",       This node is defined and non-zero only during
"RTN","ROR02",44,0)
 ;                       the KIDS installation process:
"RTN","ROR02",45,0)
 ;                         1  Pre-install
"RTN","ROR02",46,0)
 ;                         2  Post-install
"RTN","ROR02",47,0)
 ;   ParamName)          Value of an installation parameter
"RTN","ROR02",48,0)
 ;
"RTN","ROR02",49,0)
 ; RORPARM("LOG",        Enable/disable log collection:
"RTN","ROR02",50,0)
 ;                         0  Disabled (default)
"RTN","ROR02",51,0)
 ;                         1  Enabled
"RTN","ROR02",52,0)
 ;   Type)               Enable (1) collection of only particular
"RTN","ROR02",53,0)
 ;                       events (optional, all events by default)
"RTN","ROR02",54,0)
 ;                       See the LOG EVENT field in the ROR REGISTRY
"RTN","ROR02",55,0)
 ;                       PARAMETERS file #798.1 for possible values.
"RTN","ROR02",56,0)
 ;
"RTN","ROR02",57,0)
 ; RORPARM("SETUP")      This node is defined and non-zero only
"RTN","ROR02",58,0)
 ;                       during the registry setup.
"RTN","ROR02",59,0)
 ;
"RTN","ROR02",60,0)
 Q
"RTN","ROR10")
0^23^B33339833
"RTN","ROR10",1,0)
ROR10 ;HCIOFO/SG - NIGHTLY TASK UTILITIES ; 11/29/05 4:21pm
"RTN","ROR10",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","ROR10",3,0)
 ;
"RTN","ROR10",4,0)
 Q
"RTN","ROR10",5,0)
 ;
"RTN","ROR10",6,0)
 ;***** DISPLAYS THE ALERT ABOUT PROBLEMATIC HL7 MESSAGES
"RTN","ROR10",7,0)
ALERT ;
"RTN","ROR10",8,0)
 Q:$G(XQADATA)=""
"RTN","ROR10",9,0)
 N I,PARAMS,RORINFO,TMP
"RTN","ROR10",10,0)
 ;--- Get and prepare the parameters
"RTN","ROR10",11,0)
 S PARAMS("REGISTRY")=$P(XQADATA,"^")
"RTN","ROR10",12,0)
 S PARAMS("NOR")=$P(XQADATA,"^",2)
"RTN","ROR10",13,0)
 ;--- Load and format the text
"RTN","ROR10",14,0)
 D BLD^DIALOG(7980000.027,.PARAMS,,"RORINFO","S")
"RTN","ROR10",15,0)
 ;--- Display the text
"RTN","ROR10",16,0)
 S I=""  W !!
"RTN","ROR10",17,0)
 F  S I=$O(RORINFO(I))  Q:I=""  W RORINFO(I),!
"RTN","ROR10",18,0)
 Q
"RTN","ROR10",19,0)
 ;
"RTN","ROR10",20,0)
 ;***** CHECKS THE STATUS OF LAST HL7 MESSAGE(S)
"RTN","ROR10",21,0)
 ;
"RTN","ROR10",22,0)
 ; .REGLST       Reference to a local array containing registry
"RTN","ROR10",23,0)
 ;               names as subscripts and (optionally) registry
"RTN","ROR10",24,0)
 ;               IENs as values.
"RTN","ROR10",25,0)
 ;
"RTN","ROR10",26,0)
 ; Return values:
"RTN","ROR10",27,0)
 ;       <0  Error code
"RTN","ROR10",28,0)
 ;        0  Ok
"RTN","ROR10",29,0)
 ;
"RTN","ROR10",30,0)
CHECKMSG(REGLST) ;
"RTN","ROR10",31,0)
 N RORLBLST      ; List of latest batch HL7 messages (see ^ROR11)
"RTN","ROR10",32,0)
 ;
"RTN","ROR10",33,0)
 N HDTIEN,IENS,IM,LBCID,MSGDT,MSGSTC,RC,REGIEN,REGNAME,RORBUF,RORFDA,RORMSG,TMP
"RTN","ROR10",34,0)
 S RC=0
"RTN","ROR10",35,0)
 ;
"RTN","ROR10",36,0)
 ;=== Compile the list of latest batch HL7 messages
"RTN","ROR10",37,0)
 S REGNAME=""
"RTN","ROR10",38,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:RC<0
"RTN","ROR10",39,0)
 . ;--- Get the registry IEN
"RTN","ROR10",40,0)
 . S REGIEN=+$G(REGLST(REGNAME))
"RTN","ROR10",41,0)
 . I REGIEN'>0  D  I REGIEN'>0  S RC=+REGIEN  Q
"RTN","ROR10",42,0)
 . . S REGIEN=$$REGIEN^RORUTL02(REGNAME)
"RTN","ROR10",43,0)
 . S $P(REGLST(REGNAME),U)=REGIEN
"RTN","ROR10",44,0)
 . ;--- Get the list of batch HL7 message IDs
"RTN","ROR10",45,0)
 . K RORBUF,RORMSG
"RTN","ROR10",46,0)
 . S IENS=","_REGIEN_","
"RTN","ROR10",47,0)
 . D LIST^DIC(798.122,IENS,"@;.01;.02;.03I",,,,,"B",,,"RORBUF","RORMSG")
"RTN","ROR10",48,0)
 . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,,798.122,IENS)  Q
"RTN","ROR10",49,0)
 . ;--- Update the list of latest HL7 batch messages
"RTN","ROR10",50,0)
 . S IM=""
"RTN","ROR10",51,0)
 . F  S IM=$O(RORBUF("DILIST","ID",IM))  Q:IM=""  D
"RTN","ROR10",52,0)
 . . S LBCID=RORBUF("DILIST","ID",IM,.01)
"RTN","ROR10",53,0)
 . . S IENS=RORBUF("DILIST",2,IM)_","_REGIEN_","
"RTN","ROR10",54,0)
 . . S MSGDT=$G(RORBUF("DILIST","ID",IM,.03))
"RTN","ROR10",55,0)
 . . D ADDMSG^ROR11(LBCID,IENS,$G(RORBUF("DILIST","ID",IM,.02)),MSGDT)
"RTN","ROR10",56,0)
 Q:RC<0 RC
"RTN","ROR10",57,0)
 ;
"RTN","ROR10",58,0)
 ;=== Analyze the list of messages
"RTN","ROR10",59,0)
 S LBCID=0
"RTN","ROR10",60,0)
 F  S LBCID=$O(RORLBLST(LBCID))  Q:LBCID'>0  D  Q:RC<0
"RTN","ROR10",61,0)
 . S MSGSTC=+RORLBLST(LBCID,"MS")
"RTN","ROR10",62,0)
 . S MSGDT=RORLBLST(LBCID,"DT")
"RTN","ROR10",63,0)
 . ;--- If the message does not exist (usually, it should), remove
"RTN","ROR10",64,0)
 . ;    the reference(s) but do not update the patients' extraction
"RTN","ROR10",65,0)
 . ;--- dates. Data will be re-extracted and resent (just in case).
"RTN","ROR10",66,0)
 . I 'MSGSTC  D  Q
"RTN","ROR10",67,0)
 . . D DELMSG^ROR11(LBCID,.RORFDA)
"RTN","ROR10",68,0)
 . . D ERROR^RORERR(-49,,,,LBCID)
"RTN","ROR10",69,0)
 . ;--- Unfortunately, the 'successfully completed' status (3) is
"RTN","ROR10",70,0)
 . ;    returned for cancelled messages as well (and possibly in
"RTN","ROR10",71,0)
 . ;    some other situations). Update the patients' extraction
"RTN","ROR10",72,0)
 . ;    dates only if there is no error message in the status
"RTN","ROR10",73,0)
 . ;--- string. Then remove the message reference(s).
"RTN","ROR10",74,0)
 . I MSGSTC=3  D  Q
"RTN","ROR10",75,0)
 . . S TMP=$P(RORLBLST(LBCID,"MS"),U,3)
"RTN","ROR10",76,0)
 . . S:TMP="" TMP=$$UPDTRR^ROR11($P(RORLBLST(LBCID),U),MSGDT)
"RTN","ROR10",77,0)
 . . D DELMSG^ROR11(LBCID,.RORFDA)
"RTN","ROR10",78,0)
 . ;--- If the message is being processed/transmitted,
"RTN","ROR10",79,0)
 . ;--- then keep the reference(s) in the list.
"RTN","ROR10",80,0)
 . I (MSGSTC=1.5)!(MSGSTC=1.7)  D  Q
"RTN","ROR10",81,0)
 . . D ERROR^RORERR(-73,,,,LBCID)
"RTN","ROR10",82,0)
 . ;--- Otherwise (the message has not been sent), keep the
"RTN","ROR10",83,0)
 . ;--- reference(s) and requeue the message (just in case).
"RTN","ROR10",84,0)
 . S TMP=+$$MSGACT^HLUTIL(LBCID,2)
"RTN","ROR10",85,0)
 . D ERROR^RORERR($S(TMP:-93,1:-92),,,,LBCID)
"RTN","ROR10",86,0)
 Q:RC<0 RC
"RTN","ROR10",87,0)
 ;
"RTN","ROR10",88,0)
 S REGNAME=""
"RTN","ROR10",89,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D
"RTN","ROR10",90,0)
 . ;--- Get the registry IEN
"RTN","ROR10",91,0)
 . S REGIEN=+$G(REGLST(REGNAME))  Q:REGIEN'>0
"RTN","ROR10",92,0)
 . S IENS=REGIEN_","
"RTN","ROR10",93,0)
 . ;--- Check if all registry messages have been sent
"RTN","ROR10",94,0)
 . I $D(RORLBLST("RM",REGIEN))<10  D:$D(RORLBLST("RM",REGIEN))  Q
"RTN","ROR10",95,0)
 . . K RORLBLST("RM",REGIEN)
"RTN","ROR10",96,0)
 . . ;--- Clear the HL7 ATTEMPT COUNTER field
"RTN","ROR10",97,0)
 . . S RORFDA(798.1,IENS,19.3)="@"
"RTN","ROR10",98,0)
 . . ;--- Check for an automatic backpull definition
"RTN","ROR10",99,0)
 . . S HDTIEN=$$GET1^DIQ(798.1,IENS,21.01,"I",,"RORMSG")
"RTN","ROR10",100,0)
 . . I $G(DIERR)  D DBS^RORERR("RORMSG",-9,,,798.1,IENS)  Q
"RTN","ROR10",101,0)
 . . D:HDTIEN>0
"RTN","ROR10",102,0)
 . . . ;--- Reset the automatic backpull mode
"RTN","ROR10",103,0)
 . . . S RORFDA(798.1,IENS,21.01)="@"
"RTN","ROR10",104,0)
 . . . ;--- Complete the automatic backpull
"RTN","ROR10",105,0)
 . . . S TMP=$$COMPLETE^RORHDT06(HDTIEN,REGNAME)
"RTN","ROR10",106,0)
 . ;--- Increment the HL7 ATTEMPT COUNTER for registries with unsent
"RTN","ROR10",107,0)
 . ;--- message(s) and exclude those registries from data extraction.
"RTN","ROR10",108,0)
 . S TMP=$$GET1^DIQ(798.1,IENS,19.3,,,"RORMSG")
"RTN","ROR10",109,0)
 . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","ROR10",110,0)
 . S RORFDA(798.1,IENS,19.3)=TMP+1
"RTN","ROR10",111,0)
 . K REGLST(REGNAME)
"RTN","ROR10",112,0)
 ;
"RTN","ROR10",113,0)
 ;=== Update the registry parameters if necessary
"RTN","ROR10",114,0)
 D:$D(RORFDA)>1
"RTN","ROR10",115,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","ROR10",116,0)
 . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,798.1)
"RTN","ROR10",117,0)
 ;
"RTN","ROR10",118,0)
 ;=== Notify the AAC and local coordinators if necessary
"RTN","ROR10",119,0)
 D:$D(RORLBLST("RM"))>1 NOTIFY^ROR11()
"RTN","ROR10",120,0)
 ;
"RTN","ROR10",121,0)
 ;=== Success
"RTN","ROR10",122,0)
 Q 0
"RTN","ROR10",123,0)
 ;
"RTN","ROR10",124,0)
 ;***** PROCESSES THE TASK PARAMETERS
"RTN","ROR10",125,0)
 ;
"RTN","ROR10",126,0)
 ; .REGLST       Reference to a local variable where the list of
"RTN","ROR10",127,0)
 ;               registry names is returned to
"RTN","ROR10",128,0)
 ;
"RTN","ROR10",129,0)
 ; Return values:
"RTN","ROR10",130,0)
 ;       <0  Error code
"RTN","ROR10",131,0)
 ;        0  Ok
"RTN","ROR10",132,0)
 ;
"RTN","ROR10",133,0)
TASKPRMS(REGLST) ;
"RTN","ROR10",134,0)
 N %DT,DTOUT,INFO,REGNAME,TMP,X,Y
"RTN","ROR10",135,0)
 ;--- Log the task parameters
"RTN","ROR10",136,0)
 D TP(.INFO,"ZTQPARAM")
"RTN","ROR10",137,0)
 D TP(.INFO,"RORFLSET")
"RTN","ROR10",138,0)
 D TP(.INFO,"RORFLCLR")
"RTN","ROR10",139,0)
 D TP(.INFO,"RORMNTSK")
"RTN","ROR10",140,0)
 D TP(.INFO,"RORSUSP")
"RTN","ROR10",141,0)
 D LOG^RORLOG(,"Task Parameters",,.INFO)
"RTN","ROR10",142,0)
 ;--- Check the task parameters
"RTN","ROR10",143,0)
 I ZTQPARAM=""  D  Q RC
"RTN","ROR10",144,0)
 . D TEXT^RORTXT(7980000.001,.INFO)
"RTN","ROR10",145,0)
 . S RC=$$ERROR^RORERR(-88,,.INFO,,"TASK PARAMETERS")
"RTN","ROR10",146,0)
 ;--- Maximum number of subtasks
"RTN","ROR10",147,0)
 S RORMNTSK=$S(RORMNTSK'="":$TR(RORMNTSK,"-","^"),1:"2^3^AUTO")
"RTN","ROR10",148,0)
 ;--- Suspension parameters
"RTN","ROR10",149,0)
 D:RORSUSP'=""
"RTN","ROR10",150,0)
 . S TMP=RORSUSP,RORSUSP=""
"RTN","ROR10",151,0)
 . F I=1,2  D  S:$G(Y)>0 $P(RORSUSP,"^",I)=Y#1
"RTN","ROR10",152,0)
 . . S X=$P(TMP,"-",I),%DT="R"  D ^%DT
"RTN","ROR10",153,0)
 ;--- Extract registry names from task parameters
"RTN","ROR10",154,0)
 F I=1:1  S REGNAME=$P(ZTQPARAM,",",I)  Q:REGNAME=""  D
"RTN","ROR10",155,0)
 . S REGNAME=$$TRIM^XLFSTR(REGNAME)
"RTN","ROR10",156,0)
 . S:REGNAME'="" REGLST(REGNAME)=""
"RTN","ROR10",157,0)
 ;--- Flags
"RTN","ROR10",158,0)
 S RORFLCLR=$$UP^XLFSTR(RORFLCLR)
"RTN","ROR10",159,0)
 S RORFLSET=$$UP^XLFSTR(RORFLSET)
"RTN","ROR10",160,0)
 Q 0
"RTN","ROR10",161,0)
 ;
"RTN","ROR10",162,0)
TP(INFO,NAME) ;
"RTN","ROR10",163,0)
 S @NAME=$$TRIM^XLFSTR($G(@NAME))  Q:@NAME=""
"RTN","ROR10",164,0)
 S INFO($O(INFO(""),-1)+1)=$$LJ^XLFSTR(NAME,8)_" = """_@NAME_""""
"RTN","ROR10",165,0)
 Q
"RTN","ROR11")
0^195^B52722073
"RTN","ROR11",1,0)
ROR11 ;HCIOFO/SG - NIGHTLY TASK UTILITIES ; 12/7/05 9:40am
"RTN","ROR11",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","ROR11",3,0)
 ;
"RTN","ROR11",4,0)
 ; RORLBLST ------------ LIST OF LATEST HL7 MESSAGES
"RTN","ROR11",5,0)
 ;
"RTN","ROR11",6,0)
 ; RORLBLST(
"RTN","ROR11",7,0)
 ;   MsgID,              Internal Batch ID
"RTN","ROR11",8,0)
 ;     "MS")             Message Status (see $$MSGSTAT^HLUTIL)
"RTN","ROR11",9,0)
 ;                         ^01: Status Code
"RTN","ROR11",10,0)
 ;                         ^02: Status Updated
"RTN","ROR11",11,0)
 ;                         ^03: Error Message
"RTN","ROR11",12,0)
 ;                         ^04: Error Type pointer
"RTN","ROR11",13,0)
 ;                         ^05: Queue Position or Number of Retries
"RTN","ROR11",14,0)
 ;                         ^06: Open Failed
"RTN","ROR11",15,0)
 ;                         ^07: ACK Timeout
"RTN","ROR11",16,0)
 ;     "RL",
"RTN","ROR11",17,0)
 ;       RegIEN)         IENS of the message reference in the
"RTN","ROR11",18,0)
 ;                       registry parameters (sub-file #798.122)
"RTN","ROR11",19,0)
 ;
"RTN","ROR11",20,0)
 ;   "N",                Created and used by the NOTIFY^ROR11
"RTN","ROR11",21,0)
 ;     EMail,
"RTN","ROR11",22,0)
 ;       RegName)        RegIEN
"RTN","ROR11",23,0)
 ;
"RTN","ROR11",24,0)
 ;   "RM",
"RTN","ROR11",25,0)
 ;     RegIEN,           ""
"RTN","ROR11",26,0)
 ;       MsgID)          ""
"RTN","ROR11",27,0)
 ;
"RTN","ROR11",28,0)
 Q
"RTN","ROR11",29,0)
 ;
"RTN","ROR11",30,0)
 ;***** ADDS THE HL7 BATCH MESSAGE TO THE LIST
"RTN","ROR11",31,0)
 ;
"RTN","ROR11",32,0)
 ; MSGID         Batch HL7 Message Control ID
"RTN","ROR11",33,0)
 ; IENS          IENS of the message reference in the reigstry
"RTN","ROR11",34,0)
 ;               parameters (sub-file #798.122)
"RTN","ROR11",35,0)
 ; IBID          Internal Batch ID
"RTN","ROR11",36,0)
 ; DATE          Date/Time of the batch
"RTN","ROR11",37,0)
 ;
"RTN","ROR11",38,0)
ADDMSG(MSGID,IENS,IBID,DATE) ;
"RTN","ROR11",39,0)
 N REGIEN  S REGIEN=$P(IENS,",",2)
"RTN","ROR11",40,0)
 D:'$D(RORLBLST(MSGID))
"RTN","ROR11",41,0)
 . S RORLBLST(MSGID,"MS")=$$MSGSTAT^HLUTIL(MSGID)
"RTN","ROR11",42,0)
 . S RORLBLST(MSGID,"DT")=DATE
"RTN","ROR11",43,0)
 . S RORLBLST(MSGID)=IBID
"RTN","ROR11",44,0)
 S RORLBLST(MSGID,"RL",REGIEN)=IENS
"RTN","ROR11",45,0)
 S RORLBLST("RM",REGIEN,MSGID)=""
"RTN","ROR11",46,0)
 S RORLBLST("RM",REGIEN)=""
"RTN","ROR11",47,0)
 Q
"RTN","ROR11",48,0)
 ;
"RTN","ROR11",49,0)
 ;***** REMOVES THE HL7 BATCH MESSAGE FROM THE LIST
"RTN","ROR11",50,0)
 ;
"RTN","ROR11",51,0)
 ; MSGID         Batch HL7 Message Control ID
"RTN","ROR11",52,0)
 ; [.FDA]        Reference to the FDA arrays that will be updated
"RTN","ROR11",53,0)
 ;               to remove the references to the message
"RTN","ROR11",54,0)
 ;
"RTN","ROR11",55,0)
DELMSG(MSGID,FDA) ;
"RTN","ROR11",56,0)
 N IENS,REGIEN  S REGIEN=""
"RTN","ROR11",57,0)
 F  S REGIEN=$O(RORLBLST(MSGID,"RL",REGIEN))  Q:REGIEN=""  D
"RTN","ROR11",58,0)
 . S IENS=$P(RORLBLST(MSGID,"RL",REGIEN),U)
"RTN","ROR11",59,0)
 . S:IENS'="" FDA(798.122,IENS,.01)="@"
"RTN","ROR11",60,0)
 . K RORLBLST("RM",REGIEN,MSGID)
"RTN","ROR11",61,0)
 K RORLBLST(MSGID)
"RTN","ROR11",62,0)
 Q
"RTN","ROR11",63,0)
 ;
"RTN","ROR11",64,0)
 ;***** NOTIFIES THE AAC AND LOCAL COORDINATORS
"RTN","ROR11",65,0)
NOTIFY() ;
"RTN","ROR11",66,0)
 Q:$D(RORLBLST("RM"))<10
"RTN","ROR11",67,0)
 N ALNOR,EMAIL,IENS,MSGID,NOR,PARAMS,REGIEN,REGNAME,RORBUF,RORMSG,RORTXT,RORXML,TMP
"RTN","ROR11",68,0)
 K RORLBLST("N")
"RTN","ROR11",69,0)
 ;
"RTN","ROR11",70,0)
 ;=== Send local alerts and generate the notification list
"RTN","ROR11",71,0)
 S REGIEN=0
"RTN","ROR11",72,0)
 F  S REGIEN=$O(RORLBLST("RM",REGIEN))  Q:REGIEN'>0  D
"RTN","ROR11",73,0)
 . K RORBUF,RORMSG,RORTXT  S IENS=REGIEN_","
"RTN","ROR11",74,0)
 . ;--- Load the notification parameters
"RTN","ROR11",75,0)
 . D GETS^DIQ(798.1,IENS,".01;13.2;13.3;19.3",,"RORBUF","RORMSG")
"RTN","ROR11",76,0)
 . I $G(DIERR)  D DBS^RORERR("RORMSG",-9,,,798.1,IENS)  Q
"RTN","ROR11",77,0)
 . ;--- Check if the notification should be sent
"RTN","ROR11",78,0)
 . S ALNOR=+$G(RORBUF(798.1,IENS,13.2)) ; ALERT FREQUENCY
"RTN","ROR11",79,0)
 . S NOR=+$G(RORBUF(798.1,IENS,19.3))   ; HL7 ATTEMPT COUNTER
"RTN","ROR11",80,0)
 . Q:$S(ALNOR'>0:1,1:NOR#ALNOR)
"RTN","ROR11",81,0)
 . ;---
"RTN","ROR11",82,0)
 . S REGNAME=$G(RORBUF(798.1,IENS,.01)) ; Registry Name
"RTN","ROR11",83,0)
 . S EMAIL=$G(RORBUF(798.1,IENS,13.3))  ; Notification E-mail
"RTN","ROR11",84,0)
 . S PARAMS("REGISTRY")=REGNAME
"RTN","ROR11",85,0)
 . S PARAMS("NOR")=NOR
"RTN","ROR11",86,0)
 . ;--- Error message header
"RTN","ROR11",87,0)
 . D BLD^DIALOG(7980000.023,.PARAMS,,"RORTXT","S")
"RTN","ROR11",88,0)
 . ;--- Append the list of unsent HL7 messages
"RTN","ROR11",89,0)
 . S MSGID=""
"RTN","ROR11",90,0)
 . F  S MSGID=$O(RORLBLST("RM",REGIEN,MSGID))  Q:MSGID=""  D
"RTN","ROR11",91,0)
 . . S MSGSTAT=RORLBLST(MSGID,"MS")
"RTN","ROR11",92,0)
 . . S RORTXT($O(RORTXT(""),-1)+1)=""
"RTN","ROR11",93,0)
 . . D MSG7STS^RORUTL05(MSGID,.RORTXT,,7980000.004,.PARAMS,MSGSTAT)
"RTN","ROR11",94,0)
 . ;--- Error message footer
"RTN","ROR11",95,0)
 . D BLD^DIALOG(7980000.024,.PARAMS,,"RORTXT")
"RTN","ROR11",96,0)
 . ;--- Record the error message
"RTN","ROR11",97,0)
 . D LOG^RORERR(-67,.RORTXT,,NOR)
"RTN","ROR11",98,0)
 . ;--- Notify local staff
"RTN","ROR11",99,0)
 . S TMP=REGNAME_U_NOR
"RTN","ROR11",100,0)
 . D ALERT^RORUTL01(REGNAME,-67,"ALERT^ROR10",TMP,,NOR)
"RTN","ROR11",101,0)
 . ;--- Update the national notification list
"RTN","ROR11",102,0)
 . D:$$CCRNTFY^RORUTL05(REGIEN)
"RTN","ROR11",103,0)
 . . S:EMAIL'="" RORLBLST("N",EMAIL,REGNAME)=REGIEN
"RTN","ROR11",104,0)
 ;
"RTN","ROR11",105,0)
 ;=== Get station name and number
"RTN","ROR11",106,0)
 S TMP=$$SITE^RORUTL03()
"RTN","ROR11",107,0)
 S PARAMS("STNAME")=$P(TMP,U,2)
"RTN","ROR11",108,0)
 S PARAMS("STNUM")=$P(TMP,U)
"RTN","ROR11",109,0)
 ;
"RTN","ROR11",110,0)
 ;=== Generate notification e-mails
"RTN","ROR11",111,0)
 S EMAIL=""
"RTN","ROR11",112,0)
 F  S EMAIL=$O(RORLBLST("N",EMAIL))  Q:EMAIL=""  D
"RTN","ROR11",113,0)
 . K RORXML
"RTN","ROR11",114,0)
 . ;--- E-mail header
"RTN","ROR11",115,0)
 . D BLD^DIALOG(7980000.025,.PARAMS,,"RORXML","S")
"RTN","ROR11",116,0)
 . ;--- Process affected registries
"RTN","ROR11",117,0)
 . S REGNAME=""
"RTN","ROR11",118,0)
 . F  S REGNAME=$O(RORLBLST("N",EMAIL,REGNAME))  Q:REGNAME=""  D
"RTN","ROR11",119,0)
 . . S REGIEN=+RORLBLST("N",EMAIL,REGNAME)
"RTN","ROR11",120,0)
 . . S PARAMS("REGISTRY")=REGNAME
"RTN","ROR11",121,0)
 . . S PARAMS("NOR")=NOR
"RTN","ROR11",122,0)
 . . ;--- Append registry section
"RTN","ROR11",123,0)
 . . D NTFXML("<REGISTRY>")
"RTN","ROR11",124,0)
 . . D NTFXML("<NAME>"_REGNAME_"</NAME>")
"RTN","ROR11",125,0)
 . . S TMP=$P($$REGNAME^RORUTL01(REGIEN),U,2)
"RTN","ROR11",126,0)
 . . D NTFXML("<DESCRIPTION>"_TMP_"</DESCRIPTION>")
"RTN","ROR11",127,0)
 . . ;--- Append message list
"RTN","ROR11",128,0)
 . . S MSGID=""
"RTN","ROR11",129,0)
 . . F  S MSGID=$O(RORLBLST("RM",REGIEN,MSGID))  Q:MSGID=""  D
"RTN","ROR11",130,0)
 . . . S MSGSTAT=RORLBLST(MSGID,"MS")
"RTN","ROR11",131,0)
 . . . D MSG7STS^RORUTL05(MSGID,.RORXML,,7980000.002,.PARAMS,MSGSTAT)
"RTN","ROR11",132,0)
 . . ;--- Close the registry section
"RTN","ROR11",133,0)
 . . D NTFXML("</REGISTRY>")
"RTN","ROR11",134,0)
 . ;--- E-mail footer
"RTN","ROR11",135,0)
 . D BLD^DIALOG(7980000.026,.PARAMS,,"RORXML","S")
"RTN","ROR11",136,0)
 . ;--- Send the e-mail
"RTN","ROR11",137,0)
 . D
"RTN","ROR11",138,0)
 . . N XMCHAN,XMDUZ,XMLOC,XMSUB,XMTEXT,XMY,XMZ
"RTN","ROR11",139,0)
 . . S XMDUZ=.5,XMY(EMAIL)=""
"RTN","ROR11",140,0)
 . . S XMSUB="ROR: HL7 PROBLEM"
"RTN","ROR11",141,0)
 . . S XMTEXT="RORXML("
"RTN","ROR11",142,0)
 . . D ^XMD
"RTN","ROR11",143,0)
 Q
"RTN","ROR11",144,0)
 ;
"RTN","ROR11",145,0)
NTFXML(STR) ;
"RTN","ROR11",146,0)
 S RORXML($O(RORXML(""),-1)+1)=STR
"RTN","ROR11",147,0)
 Q
"RTN","ROR11",148,0)
 ;
"RTN","ROR11",149,0)
 ;***** UPDATES REGISTRY RECORDS AFTER SUCCESSFUL DATA TRANSMISSION
"RTN","ROR11",150,0)
 ;
"RTN","ROR11",151,0)
 ; BATCHID       Internal HL7 batch ID
"RTN","ROR11",152,0)
 ; BATCHDT       Date/Time of the batch
"RTN","ROR11",153,0)
 ;
"RTN","ROR11",154,0)
 ; Return values:
"RTN","ROR11",155,0)
 ;       <0  Error code
"RTN","ROR11",156,0)
 ;        0  Ok
"RTN","ROR11",157,0)
 ;
"RTN","ROR11",158,0)
UPDTRR(BATCHID,BATCHDT) ;
"RTN","ROR11",159,0)
 N IEN,IENS,LBI,MSGID,PATIEN,REGIEN,RORBUF,RORFDA,RORMSG,TMP,XREF
"RTN","ROR11",160,0)
 S XREF=$$ROOT^DILFD(798)_"""AM"")"
"RTN","ROR11",161,0)
 S LBI=$L(BATCHID)
"RTN","ROR11",162,0)
 ;===
"RTN","ROR11",163,0)
 S MSGID=BATCHID
"RTN","ROR11",164,0)
 F  S MSGID=$O(@XREF@(MSGID))  Q:$E(MSGID,1,LBI)'=BATCHID  D
"RTN","ROR11",165,0)
 . S IEN=0
"RTN","ROR11",166,0)
 . F  S IEN=$O(@XREF@(MSGID,IEN))  Q:IEN'>0  D
"RTN","ROR11",167,0)
 . . S IENS=IEN_","  K RORBUF,RORFDA,RORMSG
"RTN","ROR11",168,0)
 . . ;=== Load the registry record
"RTN","ROR11",169,0)
 . . S TMP=".01;.02;3;4;4.1;5;5.1;6;9.1;9.2;10"
"RTN","ROR11",170,0)
 . . D GETS^DIQ(798,IENS,TMP,"I","RORBUF","RORMSG")
"RTN","ROR11",171,0)
 . . S PATIEN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","ROR11",172,0)
 . . I $G(DIERR)  D DBS^RORERR("RORMSG",-9,,PATIEN,798,IENS)  Q
"RTN","ROR11",173,0)
 . . S REGIEN=+$G(RORBUF(798,IENS,.02,"I"))
"RTN","ROR11",174,0)
 . . ;
"RTN","ROR11",175,0)
 . . ;=== Update record state only if the corresponding HL7 message
"RTN","ROR11",176,0)
 . . ;=== was actually generated (check for fake Message ID)
"RTN","ROR11",177,0)
 . . I $P($G(RORBUF(798,IENS,10,"I")),"-",2)  S RC=0  D  Q:RC
"RTN","ROR11",178,0)
 . . . ;--- Delete a record marked for deletion (only if the deletion
"RTN","ROR11",179,0)
 . . . ;--- date/time is earlier than the last message timestamp)
"RTN","ROR11",180,0)
 . . . I $G(RORBUF(798,IENS,3,"I"))=5  D  Q
"RTN","ROR11",181,0)
 . . . . Q:$G(RORBUF(798,IENS,6,"I"))'<BATCHDT
"RTN","ROR11",182,0)
 . . . . N DA,DIK  S RC=1
"RTN","ROR11",183,0)
 . . . . S DIK=$$ROOT^DILFD(798),DA=IEN  D ^DIK
"RTN","ROR11",184,0)
 . . . . S TMP=$$REGNAME^RORUTL01(REGIEN)
"RTN","ROR11",185,0)
 . . . . D LOG^RORERR(-90,,PATIEN,$P(TMP,U))
"RTN","ROR11",186,0)
 . . . ;--- Reset the UPDATE DEMOGRAPHICS flag if the demographic
"RTN","ROR11",187,0)
 . . . ;--- data was updated before the latest data extraction
"RTN","ROR11",188,0)
 . . . D:$G(RORBUF(798,IENS,4,"I"))
"RTN","ROR11",189,0)
 . . . . S:$G(RORBUF(798,IENS,4.1,"I"))<BATCHDT RORFDA(798,IENS,4)="@"
"RTN","ROR11",190,0)
 . . . ;--- Reset the UPDATE LOCAL REGISTRY DATA flag if the local
"RTN","ROR11",191,0)
 . . . ;--- data was updated before the latest data extraction
"RTN","ROR11",192,0)
 . . . D:$G(RORBUF(798,IENS,5,"I"))
"RTN","ROR11",193,0)
 . . . . S:$G(RORBUF(798,IENS,5.1,"I"))<BATCHDT RORFDA(798,IENS,5)="@"
"RTN","ROR11",194,0)
 . . ;
"RTN","ROR11",195,0)
 . . ;=== Update extraction dates
"RTN","ROR11",196,0)
 . . S TMP=+$G(RORBUF(798,IENS,9.2,"I"))
"RTN","ROR11",197,0)
 . . S:TMP>$G(RORBUF(798,IENS,9.1)) RORFDA(798,IENS,9.1)=TMP
"RTN","ROR11",198,0)
 . . ;=== Clear the message ID
"RTN","ROR11",199,0)
 . . S RORFDA(798,IENS,10)="@"
"RTN","ROR11",200,0)
 . . ;=== Update the registry record (if necessary)
"RTN","ROR11",201,0)
 . . D:$D(RORFDA)>1
"RTN","ROR11",202,0)
 . . . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","ROR11",203,0)
 . . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,PATIEN,798,IENS)
"RTN","ROR11",204,0)
 ;===
"RTN","ROR11",205,0)
 Q 0
"RTN","RORACK")
1^24
"RTN","RORACK01")
1^25
"RTN","RORAPI01")
0^26^B7206554
"RTN","RORAPI01",1,0)
RORAPI01 ;HCIOFO/SG - CLINICAL REGISTRIES API ; 5/12/05 1:59pm
"RTN","RORAPI01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORAPI01",3,0)
 ;
"RTN","RORAPI01",4,0)
 ;***** EXAMPLE
"RTN","RORAPI01",5,0)
 ;
"RTN","RORAPI01",6,0)
 N BUF,IPD,IRD,PATIEN,RC,REGIEN
"RTN","RORAPI01",7,0)
 W !,"   Patient  Registries"
"RTN","RORAPI01",8,0)
 W !,"   -------  ----------"
"RTN","RORAPI01",9,0)
 ;--- Initialize the patient iterator
"RTN","RORAPI01",10,0)
 S RC=$$PATITER^RORAPI01(.IPD,"VA HEPC")
"RTN","RORAPI01",11,0)
 I RC<0  W "RC= ",RC,!  Q
"RTN","RORAPI01",12,0)
 ;--- Browse through the registry patients
"RTN","RORAPI01",13,0)
 F  S PATIEN=$$NEXTPAT^RORAPI01(.IPD)  Q:PATIEN'>0  D
"RTN","RORAPI01",14,0)
 . W !,$J(PATIEN,10),"  "
"RTN","RORAPI01",15,0)
 . ;--- Initialize the registry iterator
"RTN","RORAPI01",16,0)
 . S RC=$$REGITER^RORAPI01(.IRD,PATIEN)
"RTN","RORAPI01",17,0)
 . I RC<0  W "RC= ",RC  Q
"RTN","RORAPI01",18,0)
 . ;--- Browse through the patient's registry records
"RTN","RORAPI01",19,0)
 . S BUF=""
"RTN","RORAPI01",20,0)
 . F  S REGIEN=$$NEXTREG^RORAPI01(.IRD)  Q:REGIEN'>0  D
"RTN","RORAPI01",21,0)
 . . S BUF=BUF_","_REGIEN
"RTN","RORAPI01",22,0)
 . W $P(BUF,",",2,999)
"RTN","RORAPI01",23,0)
 ;---
"RTN","RORAPI01",24,0)
 W !
"RTN","RORAPI01",25,0)
 Q
"RTN","RORAPI01",26,0)
 ;
"RTN","RORAPI01",27,0)
 ;***** RETURNS THE NEXT PATIENT IN THE REGISTRY
"RTN","RORAPI01",28,0)
 ;
"RTN","RORAPI01",29,0)
 ; .IDESC        Reference to the iterator descriptor created
"RTN","RORAPI01",30,0)
 ;               by PATITER^RORAPI01
"RTN","RORAPI01",31,0)
 ;
"RTN","RORAPI01",32,0)
 ; Return Values:
"RTN","RORAPI01",33,0)
 ;       <0  Error code
"RTN","RORAPI01",34,0)
 ;       ""  No more patients in the registry
"RTN","RORAPI01",35,0)
 ;       >0  Patient IEN^empty
"RTN","RORAPI01",36,0)
 ;
"RTN","RORAPI01",37,0)
NEXTPAT(IDESC) ;
"RTN","RORAPI01",38,0)
 N RC
"RTN","RORAPI01",39,0)
 F  D  Q:$G(RC)
"RTN","RORAPI01",40,0)
 . ;--- Get IEN of the next registry record
"RTN","RORAPI01",41,0)
 . S IDESC("IEN")=$O(^RORDATA(798,"AC",IDESC("REGIEN"),IDESC("IEN")))
"RTN","RORAPI01",42,0)
 . I IDESC("IEN")'>0  S RC="1^END"  Q
"RTN","RORAPI01",43,0)
 . Q:'$$ACTIVE^RORDD(IDESC("IEN"))
"RTN","RORAPI01",44,0)
 . ;--- Load the patient IEN (DFN)
"RTN","RORAPI01",45,0)
 . S RC=$P($G(^RORDATA(798,IDESC("IEN"),0)),U)
"RTN","RORAPI01",46,0)
 Q $S(RC="1^END":"",1:RC)
"RTN","RORAPI01",47,0)
 ;
"RTN","RORAPI01",48,0)
 ;***** RETURNS THE NEXT REGISTRY FOR THE PATIENT
"RTN","RORAPI01",49,0)
 ;
"RTN","RORAPI01",50,0)
 ; .IDESC        Reference to the iterator descriptor created
"RTN","RORAPI01",51,0)
 ;               by REGITER^RORAPI01
"RTN","RORAPI01",52,0)
 ;
"RTN","RORAPI01",53,0)
 ; Return Values:
"RTN","RORAPI01",54,0)
 ;       <0  Error code
"RTN","RORAPI01",55,0)
 ;       ""  No more registries for the patient
"RTN","RORAPI01",56,0)
 ;       >0  Registry IEN^empty
"RTN","RORAPI01",57,0)
 ;
"RTN","RORAPI01",58,0)
NEXTREG(IDESC) ;
"RTN","RORAPI01",59,0)
 N RC
"RTN","RORAPI01",60,0)
 F  D  Q:$G(RC)
"RTN","RORAPI01",61,0)
 . ;--- Get IEN of the next registry record
"RTN","RORAPI01",62,0)
 . S IDESC("IEN")=$O(^RORDATA(798,"B",IDESC("PATIEN"),IDESC("IEN")))
"RTN","RORAPI01",63,0)
 . I IDESC("IEN")'>0  S RC="1^END"  Q
"RTN","RORAPI01",64,0)
 . Q:'$$ACTIVE^RORDD(IDESC("IEN"))
"RTN","RORAPI01",65,0)
 . ;--- Load the registry IEN
"RTN","RORAPI01",66,0)
 . S RC=$P($G(^RORDATA(798,IDESC("IEN"),0)),U,2)
"RTN","RORAPI01",67,0)
 Q $S(RC="1^END":"",1:RC)
"RTN","RORAPI01",68,0)
 ;
"RTN","RORAPI01",69,0)
 ;***** CREATES AN ITERATOR OF PATIENTS IN THE REGISTRY
"RTN","RORAPI01",70,0)
 ;
"RTN","RORAPI01",71,0)
 ; .IDESC        Reference to a local variable where an iterator
"RTN","RORAPI01",72,0)
 ;               descriptor will be created
"RTN","RORAPI01",73,0)
 ; REGNAME       Registry name
"RTN","RORAPI01",74,0)
 ; [MODE]        Bit flags that define iteration mode (3 by default)
"RTN","RORAPI01",75,0)
 ;                 1  Active patients
"RTN","RORAPI01",76,0)
 ;                 2  Reserved
"RTN","RORAPI01",77,0)
 ;
"RTN","RORAPI01",78,0)
 ; Return Values:
"RTN","RORAPI01",79,0)
 ;       <0  Error code
"RTN","RORAPI01",80,0)
 ;        0  Ok
"RTN","RORAPI01",81,0)
 ;
"RTN","RORAPI01",82,0)
PATITER(IDESC,REGNAME,MODE) ;
"RTN","RORAPI01",83,0)
 N REGIEN  K IDESC
"RTN","RORAPI01",84,0)
 ;--- Get an IEN of the Registry Parameters
"RTN","RORAPI01",85,0)
 S REGIEN=$$REGIEN^RORUTL02(REGNAME)
"RTN","RORAPI01",86,0)
 Q:REGIEN<0 REGIEN
"RTN","RORAPI01",87,0)
 ;--- Setup the descriptor
"RTN","RORAPI01",88,0)
 S MODE=$S($G(MODE):MODE,1:3)
"RTN","RORAPI01",89,0)
 S IDESC("REGNAME")=REGNAME
"RTN","RORAPI01",90,0)
 S IDESC("REGIEN")=REGIEN
"RTN","RORAPI01",91,0)
 S IDESC("ACT")=MODE#2
"RTN","RORAPI01",92,0)
 S IDESC("ROOT")=$$ROOT^DILFD(798,"",1)
"RTN","RORAPI01",93,0)
 S IDESC("IEN")=0
"RTN","RORAPI01",94,0)
 Q 0
"RTN","RORAPI01",95,0)
 ;
"RTN","RORAPI01",96,0)
 ;***** CREATES AN ITERATOR OF THE PATIENT REGISTRIES
"RTN","RORAPI01",97,0)
 ;
"RTN","RORAPI01",98,0)
 ; .IDESC        Reference to a local variable where an iterator
"RTN","RORAPI01",99,0)
 ;               descriptor will be created
"RTN","RORAPI01",100,0)
 ; PATIEN        Patient IEN
"RTN","RORAPI01",101,0)
 ; [MODE]        Bit flags that define iteration mode (3 by default)
"RTN","RORAPI01",102,0)
 ;                 1  Registries where the patient is active
"RTN","RORAPI01",103,0)
 ;                 2  Reserved
"RTN","RORAPI01",104,0)
 ;
"RTN","RORAPI01",105,0)
 ; Return Values:
"RTN","RORAPI01",106,0)
 ;       <0  Error code
"RTN","RORAPI01",107,0)
 ;        0  Ok
"RTN","RORAPI01",108,0)
 ;
"RTN","RORAPI01",109,0)
REGITER(IDESC,PATIEN,MODE) ;
"RTN","RORAPI01",110,0)
 K IDESC
"RTN","RORAPI01",111,0)
 ;--- Setup the descriptor
"RTN","RORAPI01",112,0)
 S MODE=$S($G(MODE):MODE,1:3)
"RTN","RORAPI01",113,0)
 S IDESC("PATIEN")=PATIEN
"RTN","RORAPI01",114,0)
 S IDESC("ACT")=MODE#2
"RTN","RORAPI01",115,0)
 S IDESC("ROOT")=$$ROOT^DILFD(798,"",1)
"RTN","RORAPI01",116,0)
 S IDESC("IEN")=0
"RTN","RORAPI01",117,0)
 Q 0
"RTN","RORBIN")
0^221^B47206993
"RTN","RORBIN",1,0)
RORBIN ;HCIOFO/SG - BINARY OPERATIONS  ; 1/23/06 1:54pm
"RTN","RORBIN",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORBIN",3,0)
 ;
"RTN","RORBIN",4,0)
 Q
"RTN","RORBIN",5,0)
 ;
"RTN","RORBIN",6,0)
 ;***** BINARY "AND" OPERATION
"RTN","RORBIN",7,0)
 ;
"RTN","RORBIN",8,0)
 ; V1            Operands formatted as strings of "1" and "0"
"RTN","RORBIN",9,0)
 ; V2
"RTN","RORBIN",10,0)
 ;
"RTN","RORBIN",11,0)
AND(V1,V2) ;
"RTN","RORBIN",12,0)
 N I,L1,L2,N,RES
"RTN","RORBIN",13,0)
 S L1=$L(V1),L2=$L(V2),RES=""
"RTN","RORBIN",14,0)
 I L1<L2  S N=L1,V2=$E(V2,L2-L1+1,L2)
"RTN","RORBIN",15,0)
 E        S N=L2,V1=$E(V1,L1-L2+1,L1)
"RTN","RORBIN",16,0)
 F I=1:1:N  S RES=RES_$S($E(V1,I)&$E(V2,I):"1",1:"0")
"RTN","RORBIN",17,0)
 Q RES
"RTN","RORBIN",18,0)
 ;
"RTN","RORBIN",19,0)
 ;***** FAST CONVERSIONS FROM HEXADECIMAL TO BINARY
"RTN","RORBIN",20,0)
 ;
"RTN","RORBIN",21,0)
 ; VAL           Hexadecimal value
"RTN","RORBIN",22,0)
 ;
"RTN","RORBIN",23,0)
C16TO2(VAL) ;
"RTN","RORBIN",24,0)
 N I,J,L,RES
"RTN","RORBIN",25,0)
 S L=$L(VAL),RES=""
"RTN","RORBIN",26,0)
 F I=1:1:L  D
"RTN","RORBIN",27,0)
 . S J=$F("0123456789ABCDEF",$E(VAL,I))-1
"RTN","RORBIN",28,0)
 . S RES=RES_$P("0000^0001^0010^0011^0100^0101^0110^0111^1000^1001^1010^1011^1100^1101^1110^1111","^",J)
"RTN","RORBIN",29,0)
 Q RES
"RTN","RORBIN",30,0)
 ;
"RTN","RORBIN",31,0)
 ;***** CALCULATES CRC-32 FOR PROVIDED DATA
"RTN","RORBIN",32,0)
 ;
"RTN","RORBIN",33,0)
 ; ROR8NODE      Closed root of an array that contains the data
"RTN","RORBIN",34,0)
 ;
"RTN","RORBIN",35,0)
CRC32(ROR8NODE) ;
"RTN","RORBIN",36,0)
 N TMPCRC  S TMPCRC=$$C16TO2("FFFFFFFF")
"RTN","RORBIN",37,0)
 F  S ROR8NODE=$Q(@ROR8NODE)  Q:ROR8NODE=""  D
"RTN","RORBIN",38,0)
 . S TMPCRC=$$UPDCRC32(TMPCRC,@ROR8NODE)
"RTN","RORBIN",39,0)
 S TMPCRC=$$BASE^XLFUTL($$NOT(TMPCRC),2,16)
"RTN","RORBIN",40,0)
 Q $TR($J(TMPCRC,8)," ","0")
"RTN","RORBIN",41,0)
 ;
"RTN","RORBIN",42,0)
 ;***** BINARY "NOT" OPERATION
"RTN","RORBIN",43,0)
 ;
"RTN","RORBIN",44,0)
 ; V1            Operand formatted as string of "1" and "0"
"RTN","RORBIN",45,0)
 ;
"RTN","RORBIN",46,0)
NOT(VAL) ;
"RTN","RORBIN",47,0)
 Q $TR(VAL,"01","10")
"RTN","RORBIN",48,0)
 ;
"RTN","RORBIN",49,0)
 ;***** BINARY "OR" OPERATION
"RTN","RORBIN",50,0)
 ;
"RTN","RORBIN",51,0)
 ; V1            Operands formatted as strings of "1" and "0"
"RTN","RORBIN",52,0)
 ; V2
"RTN","RORBIN",53,0)
 ;
"RTN","RORBIN",54,0)
OR(V1,V2) ;
"RTN","RORBIN",55,0)
 N I,L1,L2,N,RES,TMP
"RTN","RORBIN",56,0)
 S L1=$L(V1),L2=$L(V2)
"RTN","RORBIN",57,0)
 I L1<L2  S N=L1,RES=$E(V2,1,L2-L1),V2=$E(V2,L2-L1+1,L2)
"RTN","RORBIN",58,0)
 E        S N=L2,RES=$E(V1,1,L1-L2),V1=$E(V1,L1-L2+1,L1)
"RTN","RORBIN",59,0)
 F I=1:1:N  S RES=RES_$S($E(V1,I)!$E(V2,I):"1",1:"0")
"RTN","RORBIN",60,0)
 Q RES
"RTN","RORBIN",61,0)
 ;
"RTN","RORBIN",62,0)
 ;***** RIGHT SHIFT (SIGNED OF UNSIGNED)
"RTN","RORBIN",63,0)
 ;
"RTN","RORBIN",64,0)
 ; V1            Operands formatted as strings of "1" and "0"
"RTN","RORBIN",65,0)
 ; V2
"RTN","RORBIN",66,0)
 ;
"RTN","RORBIN",67,0)
 ; N             Number of bits to shift by
"RTN","RORBIN",68,0)
 ;
"RTN","RORBIN",69,0)
 ; SIGN          If this parameter defined and greater than 0, then
"RTN","RORBIN",70,0)
 ;               "signed" shift is performed (sign bit is propagated).
"RTN","RORBIN",71,0)
 ;               Parameter value defines the maximum number of bits
"RTN","RORBIN",72,0)
 ;               allowed for the values.
"RTN","RORBIN",73,0)
 ;
"RTN","RORBIN",74,0)
 ;               By default ($G(SIGN)'>0), "unsigned" shift is
"RTN","RORBIN",75,0)
 ;               performed.
"RTN","RORBIN",76,0)
 ;
"RTN","RORBIN",77,0)
SHR(VAL,N,SIGN) ;
"RTN","RORBIN",78,0)
 N FILL,L,RES,SIZE
"RTN","RORBIN",79,0)
 S L=$L(VAL)
"RTN","RORBIN",80,0)
 Q:$G(SIGN)'>0 $S(N<L:$E(VAL,1,L-N),1:"0")
"RTN","RORBIN",81,0)
 S SIZE=+SIGN
"RTN","RORBIN",82,0)
 ;---
"RTN","RORBIN",83,0)
 S:L>SIZE VAL=$E(VAL,L-SIZE+1,L),L=SIZE
"RTN","RORBIN",84,0)
 S SIGN=$S(L<SIZE:0,1:$E(VAL,1))
"RTN","RORBIN",85,0)
 S:N>SIZE N=SIZE
"RTN","RORBIN",86,0)
 S:SIGN $P(FILL,"1",N+1)=""
"RTN","RORBIN",87,0)
 Q $E($G(FILL)_$S(N<L:$E(VAL,1,L-N),1:"0"),1,SIZE)
"RTN","RORBIN",88,0)
 ;
"RTN","RORBIN",89,0)
 ;***** INTERNAL ENTRY POINT FOR CRC-32 CALCULATION
"RTN","RORBIN",90,0)
UPDCRC32(CRC32,STR) ;
"RTN","RORBIN",91,0)
 N FFFFFF,I,I32,L
"RTN","RORBIN",92,0)
 S L=$L(STR),FFFFFF=$$C16TO2("FFFFFF")
"RTN","RORBIN",93,0)
 F I=1:1:L  D
"RTN","RORBIN",94,0)
 . S I32=$$XOR(CRC32,$$CNV^XLFUTL($A(STR,I),2))
"RTN","RORBIN",95,0)
 . S I32=$$DEC^XLFUTL(I32,2)#256+1
"RTN","RORBIN",96,0)
 . S TMP=$$C16TO2($P($T(TBL+I32),";;",2))
"RTN","RORBIN",97,0)
 . S CRC32=$$XOR($$AND($$SHR(CRC32,8,32),FFFFFF),TMP)
"RTN","RORBIN",98,0)
 Q CRC32
"RTN","RORBIN",99,0)
 ;
"RTN","RORBIN",100,0)
 ;***** BINARY "EXCLUSIVE OR" OPERATION
"RTN","RORBIN",101,0)
 ;
"RTN","RORBIN",102,0)
 ; V1            Operands formatted as strings of "1" and "0"
"RTN","RORBIN",103,0)
 ; V2
"RTN","RORBIN",104,0)
 ;
"RTN","RORBIN",105,0)
XOR(V1,V2) ;
"RTN","RORBIN",106,0)
 N I,L1,L2,N,RES,TMP
"RTN","RORBIN",107,0)
 S L1=$L(V1),L2=$L(V2)
"RTN","RORBIN",108,0)
 I L1<L2  S N=L1,RES=$E(V2,1,L2-L1),V2=$E(V2,L2-L1+1,L2)
"RTN","RORBIN",109,0)
 E        S N=L2,RES=$E(V1,1,L1-L2),V1=$E(V1,L1-L2+1,L1)
"RTN","RORBIN",110,0)
 F I=1:1:N  S RES=RES_$S($E(V1,I)+$E(V2,I)=1:"1",1:"0")
"RTN","RORBIN",111,0)
 Q RES
"RTN","RORBIN",112,0)
 ;
"RTN","RORBIN",113,0)
 ;***** TABLE FOR CRC-32 CALCULATION
"RTN","RORBIN",114,0)
TBL ;
"RTN","RORBIN",115,0)
 ;;00000000
"RTN","RORBIN",116,0)
 ;;77073096
"RTN","RORBIN",117,0)
 ;;EE0E612C
"RTN","RORBIN",118,0)
 ;;990951BA
"RTN","RORBIN",119,0)
 ;;076DC419
"RTN","RORBIN",120,0)
 ;;706AF48F
"RTN","RORBIN",121,0)
 ;;E963A535
"RTN","RORBIN",122,0)
 ;;9E6495A3
"RTN","RORBIN",123,0)
 ;;0EDB8832
"RTN","RORBIN",124,0)
 ;;79DCB8A4
"RTN","RORBIN",125,0)
 ;;E0D5E91E
"RTN","RORBIN",126,0)
 ;;97D2D988
"RTN","RORBIN",127,0)
 ;;09B64C2B
"RTN","RORBIN",128,0)
 ;;7EB17CBD
"RTN","RORBIN",129,0)
 ;;E7B82D07
"RTN","RORBIN",130,0)
 ;;90BF1D91
"RTN","RORBIN",131,0)
 ;;1DB71064
"RTN","RORBIN",132,0)
 ;;6AB020F2
"RTN","RORBIN",133,0)
 ;;F3B97148
"RTN","RORBIN",134,0)
 ;;84BE41DE
"RTN","RORBIN",135,0)
 ;;1ADAD47D
"RTN","RORBIN",136,0)
 ;;6DDDE4EB
"RTN","RORBIN",137,0)
 ;;F4D4B551
"RTN","RORBIN",138,0)
 ;;83D385C7
"RTN","RORBIN",139,0)
 ;;136C9856
"RTN","RORBIN",140,0)
 ;;646BA8C0
"RTN","RORBIN",141,0)
 ;;FD62F97A
"RTN","RORBIN",142,0)
 ;;8A65C9EC
"RTN","RORBIN",143,0)
 ;;14015C4F
"RTN","RORBIN",144,0)
 ;;63066CD9
"RTN","RORBIN",145,0)
 ;;FA0F3D63
"RTN","RORBIN",146,0)
 ;;8D080DF5
"RTN","RORBIN",147,0)
 ;;3B6E20C8
"RTN","RORBIN",148,0)
 ;;4C69105E
"RTN","RORBIN",149,0)
 ;;D56041E4
"RTN","RORBIN",150,0)
 ;;A2677172
"RTN","RORBIN",151,0)
 ;;3C03E4D1
"RTN","RORBIN",152,0)
 ;;4B04D447
"RTN","RORBIN",153,0)
 ;;D20D85FD
"RTN","RORBIN",154,0)
 ;;A50AB56B
"RTN","RORBIN",155,0)
 ;;35B5A8FA
"RTN","RORBIN",156,0)
 ;;42B2986C
"RTN","RORBIN",157,0)
 ;;DBBBC9D6
"RTN","RORBIN",158,0)
 ;;ACBCF940
"RTN","RORBIN",159,0)
 ;;32D86CE3
"RTN","RORBIN",160,0)
 ;;45DF5C75
"RTN","RORBIN",161,0)
 ;;DCD60DCF
"RTN","RORBIN",162,0)
 ;;ABD13D59
"RTN","RORBIN",163,0)
 ;;26D930AC
"RTN","RORBIN",164,0)
 ;;51DE003A
"RTN","RORBIN",165,0)
 ;;C8D75180
"RTN","RORBIN",166,0)
 ;;BFD06116
"RTN","RORBIN",167,0)
 ;;21B4F4B5
"RTN","RORBIN",168,0)
 ;;56B3C423
"RTN","RORBIN",169,0)
 ;;CFBA9599
"RTN","RORBIN",170,0)
 ;;B8BDA50F
"RTN","RORBIN",171,0)
 ;;2802B89E
"RTN","RORBIN",172,0)
 ;;5F058808
"RTN","RORBIN",173,0)
 ;;C60CD9B2
"RTN","RORBIN",174,0)
 ;;B10BE924
"RTN","RORBIN",175,0)
 ;;2F6F7C87
"RTN","RORBIN",176,0)
 ;;58684C11
"RTN","RORBIN",177,0)
 ;;C1611DAB
"RTN","RORBIN",178,0)
 ;;B6662D3D
"RTN","RORBIN",179,0)
 ;;76DC4190
"RTN","RORBIN",180,0)
 ;;01DB7106
"RTN","RORBIN",181,0)
 ;;98D220BC
"RTN","RORBIN",182,0)
 ;;EFD5102A
"RTN","RORBIN",183,0)
 ;;71B18589
"RTN","RORBIN",184,0)
 ;;06B6B51F
"RTN","RORBIN",185,0)
 ;;9FBFE4A5
"RTN","RORBIN",186,0)
 ;;E8B8D433
"RTN","RORBIN",187,0)
 ;;7807C9A2
"RTN","RORBIN",188,0)
 ;;0F00F934
"RTN","RORBIN",189,0)
 ;;9609A88E
"RTN","RORBIN",190,0)
 ;;E10E9818
"RTN","RORBIN",191,0)
 ;;7F6A0DBB
"RTN","RORBIN",192,0)
 ;;086D3D2D
"RTN","RORBIN",193,0)
 ;;91646C97
"RTN","RORBIN",194,0)
 ;;E6635C01
"RTN","RORBIN",195,0)
 ;;6B6B51F4
"RTN","RORBIN",196,0)
 ;;1C6C6162
"RTN","RORBIN",197,0)
 ;;856530D8
"RTN","RORBIN",198,0)
 ;;F262004E
"RTN","RORBIN",199,0)
 ;;6C0695ED
"RTN","RORBIN",200,0)
 ;;1B01A57B
"RTN","RORBIN",201,0)
 ;;8208F4C1
"RTN","RORBIN",202,0)
 ;;F50FC457
"RTN","RORBIN",203,0)
 ;;65B0D9C6
"RTN","RORBIN",204,0)
 ;;12B7E950
"RTN","RORBIN",205,0)
 ;;8BBEB8EA
"RTN","RORBIN",206,0)
 ;;FCB9887C
"RTN","RORBIN",207,0)
 ;;62DD1DDF
"RTN","RORBIN",208,0)
 ;;15DA2D49
"RTN","RORBIN",209,0)
 ;;8CD37CF3
"RTN","RORBIN",210,0)
 ;;FBD44C65
"RTN","RORBIN",211,0)
 ;;4DB26158
"RTN","RORBIN",212,0)
 ;;3AB551CE
"RTN","RORBIN",213,0)
 ;;A3BC0074
"RTN","RORBIN",214,0)
 ;;D4BB30E2
"RTN","RORBIN",215,0)
 ;;4ADFA541
"RTN","RORBIN",216,0)
 ;;3DD895D7
"RTN","RORBIN",217,0)
 ;;A4D1C46D
"RTN","RORBIN",218,0)
 ;;D3D6F4FB
"RTN","RORBIN",219,0)
 ;;4369E96A
"RTN","RORBIN",220,0)
 ;;346ED9FC
"RTN","RORBIN",221,0)
 ;;AD678846
"RTN","RORBIN",222,0)
 ;;DA60B8D0
"RTN","RORBIN",223,0)
 ;;44042D73
"RTN","RORBIN",224,0)
 ;;33031DE5
"RTN","RORBIN",225,0)
 ;;AA0A4C5F
"RTN","RORBIN",226,0)
 ;;DD0D7CC9
"RTN","RORBIN",227,0)
 ;;5005713C
"RTN","RORBIN",228,0)
 ;;270241AA
"RTN","RORBIN",229,0)
 ;;BE0B1010
"RTN","RORBIN",230,0)
 ;;C90C2086
"RTN","RORBIN",231,0)
 ;;5768B525
"RTN","RORBIN",232,0)
 ;;206F85B3
"RTN","RORBIN",233,0)
 ;;B966D409
"RTN","RORBIN",234,0)
 ;;CE61E49F
"RTN","RORBIN",235,0)
 ;;5EDEF90E
"RTN","RORBIN",236,0)
 ;;29D9C998
"RTN","RORBIN",237,0)
 ;;B0D09822
"RTN","RORBIN",238,0)
 ;;C7D7A8B4
"RTN","RORBIN",239,0)
 ;;59B33D17
"RTN","RORBIN",240,0)
 ;;2EB40D81
"RTN","RORBIN",241,0)
 ;;B7BD5C3B
"RTN","RORBIN",242,0)
 ;;C0BA6CAD
"RTN","RORBIN",243,0)
 ;;EDB88320
"RTN","RORBIN",244,0)
 ;;9ABFB3B6
"RTN","RORBIN",245,0)
 ;;03B6E20C
"RTN","RORBIN",246,0)
 ;;74B1D29A
"RTN","RORBIN",247,0)
 ;;EAD54739
"RTN","RORBIN",248,0)
 ;;9DD277AF
"RTN","RORBIN",249,0)
 ;;04DB2615
"RTN","RORBIN",250,0)
 ;;73DC1683
"RTN","RORBIN",251,0)
 ;;E3630B12
"RTN","RORBIN",252,0)
 ;;94643B84
"RTN","RORBIN",253,0)
 ;;0D6D6A3E
"RTN","RORBIN",254,0)
 ;;7A6A5AA8
"RTN","RORBIN",255,0)
 ;;E40ECF0B
"RTN","RORBIN",256,0)
 ;;9309FF9D
"RTN","RORBIN",257,0)
 ;;0A00AE27
"RTN","RORBIN",258,0)
 ;;7D079EB1
"RTN","RORBIN",259,0)
 ;;F00F9344
"RTN","RORBIN",260,0)
 ;;8708A3D2
"RTN","RORBIN",261,0)
 ;;1E01F268
"RTN","RORBIN",262,0)
 ;;6906C2FE
"RTN","RORBIN",263,0)
 ;;F762575D
"RTN","RORBIN",264,0)
 ;;806567CB
"RTN","RORBIN",265,0)
 ;;196C3671
"RTN","RORBIN",266,0)
 ;;6E6B06E7
"RTN","RORBIN",267,0)
 ;;FED41B76
"RTN","RORBIN",268,0)
 ;;89D32BE0
"RTN","RORBIN",269,0)
 ;;10DA7A5A
"RTN","RORBIN",270,0)
 ;;67DD4ACC
"RTN","RORBIN",271,0)
 ;;F9B9DF6F
"RTN","RORBIN",272,0)
 ;;8EBEEFF9
"RTN","RORBIN",273,0)
 ;;17B7BE43
"RTN","RORBIN",274,0)
 ;;60B08ED5
"RTN","RORBIN",275,0)
 ;;D6D6A3E8
"RTN","RORBIN",276,0)
 ;;A1D1937E
"RTN","RORBIN",277,0)
 ;;38D8C2C4
"RTN","RORBIN",278,0)
 ;;4FDFF252
"RTN","RORBIN",279,0)
 ;;D1BB67F1
"RTN","RORBIN",280,0)
 ;;A6BC5767
"RTN","RORBIN",281,0)
 ;;3FB506DD
"RTN","RORBIN",282,0)
 ;;48B2364B
"RTN","RORBIN",283,0)
 ;;D80D2BDA
"RTN","RORBIN",284,0)
 ;;AF0A1B4C
"RTN","RORBIN",285,0)
 ;;36034AF6
"RTN","RORBIN",286,0)
 ;;41047A60
"RTN","RORBIN",287,0)
 ;;DF60EFC3
"RTN","RORBIN",288,0)
 ;;A867DF55
"RTN","RORBIN",289,0)
 ;;316E8EEF
"RTN","RORBIN",290,0)
 ;;4669BE79
"RTN","RORBIN",291,0)
 ;;CB61B38C
"RTN","RORBIN",292,0)
 ;;BC66831A
"RTN","RORBIN",293,0)
 ;;256FD2A0
"RTN","RORBIN",294,0)
 ;;5268E236
"RTN","RORBIN",295,0)
 ;;CC0C7795
"RTN","RORBIN",296,0)
 ;;BB0B4703
"RTN","RORBIN",297,0)
 ;;220216B9
"RTN","RORBIN",298,0)
 ;;5505262F
"RTN","RORBIN",299,0)
 ;;C5BA3BBE
"RTN","RORBIN",300,0)
 ;;B2BD0B28
"RTN","RORBIN",301,0)
 ;;2BB45A92
"RTN","RORBIN",302,0)
 ;;5CB36A04
"RTN","RORBIN",303,0)
 ;;C2D7FFA7
"RTN","RORBIN",304,0)
 ;;B5D0CF31
"RTN","RORBIN",305,0)
 ;;2CD99E8B
"RTN","RORBIN",306,0)
 ;;5BDEAE1D
"RTN","RORBIN",307,0)
 ;;9B64C2B0
"RTN","RORBIN",308,0)
 ;;EC63F226
"RTN","RORBIN",309,0)
 ;;756AA39C
"RTN","RORBIN",310,0)
 ;;026D930A
"RTN","RORBIN",311,0)
 ;;9C0906A9
"RTN","RORBIN",312,0)
 ;;EB0E363F
"RTN","RORBIN",313,0)
 ;;72076785
"RTN","RORBIN",314,0)
 ;;05005713
"RTN","RORBIN",315,0)
 ;;95BF4A82
"RTN","RORBIN",316,0)
 ;;E2B87A14
"RTN","RORBIN",317,0)
 ;;7BB12BAE
"RTN","RORBIN",318,0)
 ;;0CB61B38
"RTN","RORBIN",319,0)
 ;;92D28E9B
"RTN","RORBIN",320,0)
 ;;E5D5BE0D
"RTN","RORBIN",321,0)
 ;;7CDCEFB7
"RTN","RORBIN",322,0)
 ;;0BDBDF21
"RTN","RORBIN",323,0)
 ;;86D3D2D4
"RTN","RORBIN",324,0)
 ;;F1D4E242
"RTN","RORBIN",325,0)
 ;;68DDB3F8
"RTN","RORBIN",326,0)
 ;;1FDA836E
"RTN","RORBIN",327,0)
 ;;81BE16CD
"RTN","RORBIN",328,0)
 ;;F6B9265B
"RTN","RORBIN",329,0)
 ;;6FB077E1
"RTN","RORBIN",330,0)
 ;;18B74777
"RTN","RORBIN",331,0)
 ;;88085AE6
"RTN","RORBIN",332,0)
 ;;FF0F6A70
"RTN","RORBIN",333,0)
 ;;66063BCA
"RTN","RORBIN",334,0)
 ;;11010B5C
"RTN","RORBIN",335,0)
 ;;8F659EFF
"RTN","RORBIN",336,0)
 ;;F862AE69
"RTN","RORBIN",337,0)
 ;;616BFFD3
"RTN","RORBIN",338,0)
 ;;166CCF45
"RTN","RORBIN",339,0)
 ;;A00AE278
"RTN","RORBIN",340,0)
 ;;D70DD2EE
"RTN","RORBIN",341,0)
 ;;4E048354
"RTN","RORBIN",342,0)
 ;;3903B3C2
"RTN","RORBIN",343,0)
 ;;A7672661
"RTN","RORBIN",344,0)
 ;;D06016F7
"RTN","RORBIN",345,0)
 ;;4969474D
"RTN","RORBIN",346,0)
 ;;3E6E77DB
"RTN","RORBIN",347,0)
 ;;AED16A4A
"RTN","RORBIN",348,0)
 ;;D9D65ADC
"RTN","RORBIN",349,0)
 ;;40DF0B66
"RTN","RORBIN",350,0)
 ;;37D83BF0
"RTN","RORBIN",351,0)
 ;;A9BCAE53
"RTN","RORBIN",352,0)
 ;;DEBB9EC5
"RTN","RORBIN",353,0)
 ;;47B2CF7F
"RTN","RORBIN",354,0)
 ;;30B5FFE9
"RTN","RORBIN",355,0)
 ;;BDBDF21C
"RTN","RORBIN",356,0)
 ;;CABAC28A
"RTN","RORBIN",357,0)
 ;;53B39330
"RTN","RORBIN",358,0)
 ;;24B4A3A6
"RTN","RORBIN",359,0)
 ;;BAD03605
"RTN","RORBIN",360,0)
 ;;CDD70693
"RTN","RORBIN",361,0)
 ;;54DE5729
"RTN","RORBIN",362,0)
 ;;23D967BF
"RTN","RORBIN",363,0)
 ;;B3667A2E
"RTN","RORBIN",364,0)
 ;;C4614AB8
"RTN","RORBIN",365,0)
 ;;5D681B02
"RTN","RORBIN",366,0)
 ;;2A6F2B94
"RTN","RORBIN",367,0)
 ;;B40BBE37
"RTN","RORBIN",368,0)
 ;;C30C8EA1
"RTN","RORBIN",369,0)
 ;;5A05DF1B
"RTN","RORBIN",370,0)
 ;;2D02EF8D
"RTN","RORDD")
0^27^B33607447
"RTN","RORDD",1,0)
RORDD ;HCIOFO/SG - DATA DICTIONARY UTILITIES ; 9/2/05 10:58am
"RTN","RORDD",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORDD",3,0)
 ;
"RTN","RORDD",4,0)
 Q
"RTN","RORDD",5,0)
 ;
"RTN","RORDD",6,0)
 ;***** CHECKS USER KEYS AND LOGS ATTEMPTS OF UNAUTHORIZED ACCESS
"RTN","RORDD",7,0)
 ;
"RTN","RORDD",8,0)
 ; FILE          File number
"RTN","RORDD",9,0)
 ;
"RTN","RORDD",10,0)
 ; [REGISTRY]    Either a registry name or a registry IEN.
"RTN","RORDD",11,0)
 ;               By default ($G(REGISTRY)=""), the function checks if
"RTN","RORDD",12,0)
 ;               the user has any Clinical Case Registries keys.
"RTN","RORDD",13,0)
 ;
"RTN","RORDD",14,0)
 ; [STRICT]      If this parameter is defined and not zero then an
"RTN","RORDD",15,0)
 ;               access violation event is recorded even if the user
"RTN","RORDD",16,0)
 ;               has other Clinical Case Registries keys.
"RTN","RORDD",17,0)
 ;
"RTN","RORDD",18,0)
 ;               This mode can be used to restrict access to a file,
"RTN","RORDD",19,0)
 ;               which is solely associated with a single registry
"RTN","RORDD",20,0)
 ;               (for example, the ROR HIV STUDY file).
"RTN","RORDD",21,0)
 ;
"RTN","RORDD",22,0)
 ; Return Values:
"RTN","RORDD",23,0)
 ;        0  Access denied
"RTN","RORDD",24,0)
 ;        1  Access granted
"RTN","RORDD",25,0)
 ;
"RTN","RORDD",26,0)
ACCESS(FILE,REGISTRY,STRICT) ;
"RTN","RORDD",27,0)
 Q:$G(DUZ)'>0 0               ; Unknown user
"RTN","RORDD",28,0)
 Q:$E($G(XPDNM),1,3)="ROR" 1  ; KIDS
"RTN","RORDD",29,0)
 N ANYKEY,REGKEY
"RTN","RORDD",30,0)
 S (REGKEY,ANYKEY)=1
"RTN","RORDD",31,0)
 ;--- Check the user's security keys
"RTN","RORDD",32,0)
 I $G(REGISTRY)'=""  D:$D(^ROR(798.1,"ACL",DUZ,REGISTRY))<10
"RTN","RORDD",33,0)
 . Q:$D(^XUSEC("ROR VA IRM",DUZ))
"RTN","RORDD",34,0)
 . S REGKEY=0,ANYKEY=($D(^ROR(798.1,"ACL",DUZ))>1)
"RTN","RORDD",35,0)
 E  D:$D(^ROR(798.1,"ACL",DUZ))<10
"RTN","RORDD",36,0)
 . S:'$D(^XUSEC("ROR VA IRM",DUZ)) (REGKEY,ANYKEY)=0
"RTN","RORDD",37,0)
 Q:REGKEY 1
"RTN","RORDD",38,0)
 ;--- Do not record an access violation event if the user has
"RTN","RORDD",39,0)
 ;    any Clinical Case Registries key and the "strict" mode
"RTN","RORDD",40,0)
 ;--- has not been requested by the caller.
"RTN","RORDD",41,0)
 I '$G(STRICT)  Q:ANYKEY 0
"RTN","RORDD",42,0)
 N RORMSG,X
"RTN","RORDD",43,0)
 ;--- Record the access violation event (if the API is available)
"RTN","RORDD",44,0)
 S X="RORLOG"  X ^%ZOSF("TEST")
"RTN","RORDD",45,0)
 I $T  D  D ACVIOLTN^RORLOG(X,$G(REGISTRY))
"RTN","RORDD",46,0)
 . S X="Attempt of unauthorized access to the file #"_FILE
"RTN","RORDD",47,0)
 ;--- Display the message (if the current device is a display)
"RTN","RORDD",48,0)
 I $E($G(IOST),1,2)="C-"  D  H 4
"RTN","RORDD",49,0)
 . D TEXT^RORTXT(7980000.003,.RORMSG)
"RTN","RORDD",50,0)
 . W !!!  S X=""
"RTN","RORDD",51,0)
 . F  S X=$O(RORMSG(X))  Q:X=""  D
"RTN","RORDD",52,0)
 . . W ?($G(IOM,80)-$L(RORMSG(X))\2),RORMSG(X),!
"RTN","RORDD",53,0)
 ;--- Log Off the user (if not an RPC Broker session)
"RTN","RORDD",54,0)
 D:'$$BROKER^XWBLIB H^XUS
"RTN","RORDD",55,0)
 Q 0
"RTN","RORDD",56,0)
 ;
"RTN","RORDD",57,0)
 ;***** "ACL" CROSS-REFERENCE UTILITIES
"RTN","RORDD",58,0)
 ;
"RTN","RORDD",59,0)
 ; These two procedures are used by the kill and set logic of the
"RTN","RORDD",60,0)
 ; "ACL" cross-reference (MUMPS type) of the .01 field of the SECURITY
"RTN","RORDD",61,0)
 ; KEY multiple of the ROR REGISTRY PARAMETERS file (#798.1).
"RTN","RORDD",62,0)
 ;
"RTN","RORDD",63,0)
 ; FileMan initializes the X variable (name of the security key) and
"RTN","RORDD",64,0)
 ; the DA array before calling these procedures.
"RTN","RORDD",65,0)
 ;
"RTN","RORDD",66,0)
ACLKILL ;
"RTN","RORDD",67,0)
 N RORDUZ,RORREG
"RTN","RORDD",68,0)
 S RORREG=$P($G(^ROR(798.1,DA(1),0)),U)
"RTN","RORDD",69,0)
 S RORDUZ=""
"RTN","RORDD",70,0)
 F  S RORDUZ=$O(^XUSEC(X,RORDUZ))  Q:RORDUZ=""  D
"RTN","RORDD",71,0)
 . K ^ROR(798.1,"ACL",RORDUZ,DA(1),X,DA)
"RTN","RORDD",72,0)
 . K:RORREG'="" ^ROR(798.1,"ACL",RORDUZ,RORREG,X,DA)
"RTN","RORDD",73,0)
 Q
"RTN","RORDD",74,0)
 ;
"RTN","RORDD",75,0)
ACLSET ;
"RTN","RORDD",76,0)
 N RORDUZ,RORREG
"RTN","RORDD",77,0)
 S RORREG=$P($G(^ROR(798.1,DA(1),0)),U)
"RTN","RORDD",78,0)
 S RORDUZ=""
"RTN","RORDD",79,0)
 F  S RORDUZ=$O(^XUSEC(X,RORDUZ))  Q:RORDUZ=""  D
"RTN","RORDD",80,0)
 . S ^ROR(798.1,"ACL",RORDUZ,DA(1),X,DA)=""
"RTN","RORDD",81,0)
 . S:RORREG'="" ^ROR(798.1,"ACL",RORDUZ,RORREG,X,DA)=""
"RTN","RORDD",82,0)
 Q
"RTN","RORDD",83,0)
 ;
"RTN","RORDD",84,0)
 ;***** CHECKS IF THE REGISTRY RECORD IS ACTIVE
"RTN","RORDD",85,0)
 ;
"RTN","RORDD",86,0)
 ; IEN           IEN of the registry record
"RTN","RORDD",87,0)
 ;
"RTN","RORDD",88,0)
 ; [CHKDT]       Date/Time for status calculation. The current date
"RTN","RORDD",89,0)
 ;               and time are used by default.
"RTN","RORDD",90,0)
 ;               Currently, this parameter has no effect .
"RTN","RORDD",91,0)
 ;
"RTN","RORDD",92,0)
 ; [.STATUS]     Status code is returned via this parameter.
"RTN","RORDD",93,0)
 ;               It explains the reason for inactivity:
"RTN","RORDD",94,0)
 ;                 ""  Status unknown or no record
"RTN","RORDD",95,0)
 ;                  4  Pending patient
"RTN","RORDD",96,0)
 ;                  5  Patient is marked for deletion
"RTN","RORDD",97,0)
 ;
"RTN","RORDD",98,0)
 ; Return Values:
"RTN","RORDD",99,0)
 ;        0  The record is inactive
"RTN","RORDD",100,0)
 ;        1  The record is active
"RTN","RORDD",101,0)
 ;
"RTN","RORDD",102,0)
ACTIVE(IEN,CHKDT,STATUS) ;
"RTN","RORDD",103,0)
 N NODE0
"RTN","RORDD",104,0)
 S NODE0=$G(^RORDATA(798,+IEN,0))
"RTN","RORDD",105,0)
 I NODE0=""  S STATUS=""  Q 0
"RTN","RORDD",106,0)
 S STATUS=+$P(NODE0,U,5)
"RTN","RORDD",107,0)
 Q:STATUS=4 0  ; Pending
"RTN","RORDD",108,0)
 Q:STATUS=5 0  ; Marked for deletion
"RTN","RORDD",109,0)
 Q 1           ; Active
"RTN","RORDD",110,0)
 ;
"RTN","RORDD",111,0)
 ;***** DISPLAYS A LIST OF APIs DEFINED IN THE SUBFILE #799.23
"RTN","RORDD",112,0)
 ;
"RTN","RORDD",113,0)
 ; IEN           IEN of the current record of the file #799.2
"RTN","RORDD",114,0)
 ;
"RTN","RORDD",115,0)
APILST(IEN) ;
"RTN","RORDD",116,0)
 N D,DIC,DLAYGO,DZ,RORMSG
"RTN","RORDD",117,0)
 S DIC=$$ROOT^DILFD(799.23,","_(+IEN)_",")  Q:DIC=""
"RTN","RORDD",118,0)
 S D=$$GET1^DID(799.23,.01,,"FIELD LENGTH",,"RORMSG")
"RTN","RORDD",119,0)
 D EN^DDIOL($J(1,D),,"?2"),EN^DDIOL("GETS^DIQ",,"?10")
"RTN","RORDD",120,0)
 S DIC(0)="",D="B",DZ="??"
"RTN","RORDD",121,0)
 S DIC("W")="D EN^DDIOL($P(^(0),U,3)_""^""_$P(^(0),U,2),,""?10"")"
"RTN","RORDD",122,0)
 D DQ^DICQ
"RTN","RORDD",123,0)
 Q
"RTN","RORDD",124,0)
 ;
"RTN","RORDD",125,0)
 ;***** VALIDATES A NAME OF THE CALLBACK FUNCTION
"RTN","RORDD",126,0)
 ;
"RTN","RORDD",127,0)
 ; MNFP          Minimal number of formal parameters (opt'l).
"RTN","RORDD",128,0)
 ;               If this parameter has a value greater than 1, the
"RTN","RORDD",129,0)
 ;               function makes very simple check of the number of
"RTN","RORDD",130,0)
 ;               formal parameters in the source code.
"RTN","RORDD",131,0)
 ;
"RTN","RORDD",132,0)
 ; This function is intended for use in the input transforms
"RTN","RORDD",133,0)
 ; of registry definition fields. It kills the X variable if it
"RTN","RORDD",134,0)
 ; contains illegal value.
"RTN","RORDD",135,0)
 ;
"RTN","RORDD",136,0)
 ; The function does not allow to use '%' in the routine and
"RTN","RORDD",137,0)
 ; tag names (this is prohibited by VistA SAC).
"RTN","RORDD",138,0)
 ;
"RTN","RORDD",139,0)
 ; If the function cannot obtain the source code of the callback
"RTN","RORDD",140,0)
 ; function (because the code does not exist yet or has been stripped)
"RTN","RORDD",141,0)
 ; or there are not enough formal parameters in the definition of the
"RTN","RORDD",142,0)
 ; function, it issues a warning but does not reject the value.
"RTN","RORDD",143,0)
 ;
"RTN","RORDD",144,0)
 ; Return Values:
"RTN","RORDD",145,0)
 ;        0  Ok
"RTN","RORDD",146,0)
 ;        1  Illegal name (X is killed)
"RTN","RORDD",147,0)
 ;
"RTN","RORDD",148,0)
EP(MNFP) ;
"RTN","RORDD",149,0)
 Q:$G(X)="" 0
"RTN","RORDD",150,0)
 N ENTPNT,TMP
"RTN","RORDD",151,0)
 ;--- Check if the value has the "$$TAG^ROUTINE" format
"RTN","RORDD",152,0)
 I '(X?2"$"1.8UN1"^"1.8UN)  K X  Q 1
"RTN","RORDD",153,0)
 ;--- Check if the routine exists
"RTN","RORDD",154,0)
 S ENTPNT=X,X=$P(X,U,2)
"RTN","RORDD",155,0)
 X ^%ZOSF("TEST")  E  D  K X  Q 1
"RTN","RORDD",156,0)
 . D EN^DDIOL("The '"_X_"' routine does not exist!")
"RTN","RORDD",157,0)
 S X=ENTPNT
"RTN","RORDD",158,0)
 ;--- Skip the enhanced checks when verifying fields
"RTN","RORDD",159,0)
 Q:$G(DIUTIL)="VERIFY FIELDS" 0
"RTN","RORDD",160,0)
 ;--- Get the line of source code
"RTN","RORDD",161,0)
 S ENTPNT=$P(X,"$$",2),TMP=$TR($P($T(@ENTPNT),";")," ")
"RTN","RORDD",162,0)
 ;--- Display a warning if there is no source line
"RTN","RORDD",163,0)
 I TMP=""  D  Q 0
"RTN","RORDD",164,0)
 . S TMP="Make sure that the '"_$P(ENTPNT,U)_"' tag"
"RTN","RORDD",165,0)
 . D EN^DDIOL(TMP_" exists in the '"_$P(ENTPNT,U,2)_"' routine.")
"RTN","RORDD",166,0)
 ;--- Display a warning if there are not enough formal parameters
"RTN","RORDD",167,0)
 I $G(MNFP)>1,$L(TMP,",")<MNFP  D  Q 0
"RTN","RORDD",168,0)
 . S TMP="Make sure that the entry point has at least "_MNFP
"RTN","RORDD",169,0)
 . D EN^DDIOL(TMP_" formal parameter(s).")
"RTN","RORDD",170,0)
 Q 0
"RTN","RORDD",171,0)
 ;
"RTN","RORDD",172,0)
 ;***** VALIDATES A SELECTION RULE EXPRESSION
"RTN","RORDD",173,0)
 ;
"RTN","RORDD",174,0)
 ; FILE          File number that the expression is associated with
"RTN","RORDD",175,0)
 ;
"RTN","RORDD",176,0)
 ; This function is intended for use in the input transforms
"RTN","RORDD",177,0)
 ; of registry definition fields. It kills the X variable if
"RTN","RORDD",178,0)
 ; it contains an illegal value.
"RTN","RORDD",179,0)
 ;
"RTN","RORDD",180,0)
 ; Return Values:
"RTN","RORDD",181,0)
 ;        0  Ok
"RTN","RORDD",182,0)
 ;        1  Illegal expression (X is killed)
"RTN","RORDD",183,0)
 ;
"RTN","RORDD",184,0)
EXPR(FILE) ;
"RTN","RORDD",185,0)
 Q:($G(FILE)'>0)!($G(X)="") 0
"RTN","RORDD",186,0)
 N EXPR,RC,RESULT,RORERROR,RORLOG,RORPARM,TMP
"RTN","RORDD",187,0)
 ;--- Check if the parser routine exists in the UCI
"RTN","RORDD",188,0)
 S EXPR=X,X="RORUPEX"  X ^%ZOSF("TEST")  S X=EXPR  E  Q 0
"RTN","RORDD",189,0)
 ;--- Parse and validate the expression
"RTN","RORDD",190,0)
 S RC=$$PARSER^RORUPEX(FILE,X,.RESULT)
"RTN","RORDD",191,0)
 Q:RC'<0 0  K X
"RTN","RORDD",192,0)
 ;--- Field does not exist
"RTN","RORDD",193,0)
 I RC=-7   D  Q 1
"RTN","RORDD",194,0)
 . S TMP="One of the referenced fields"
"RTN","RORDD",195,0)
 . D EN^DDIOL(TMP_" does not exist in the file #"_FILE_"!")
"RTN","RORDD",196,0)
 ;--- Syntax error in the expression
"RTN","RORDD",197,0)
 I RC=-21  D  Q 1
"RTN","RORDD",198,0)
 . D EN^DDIOL("Invalid expression: '"_EXPR_"'")
"RTN","RORDD",199,0)
 . D EN^DDIOL("Parsed to: '"_$G(RESULT)_"' ")
"RTN","RORDD",200,0)
 ;--- File does not exist
"RTN","RORDD",201,0)
 I RC=-58  D  Q 1
"RTN","RORDD",202,0)
 . D EN^DDIOL("Referenced file #"_FILE_" does not exist!")
"RTN","RORDD",203,0)
 Q 1
"RTN","RORDD",204,0)
 ;
"RTN","RORDD",205,0)
 ;***** CHECKS IF A FIELD OF A NATIONAL DEFINITION CAN BE DELETED
"RTN","RORDD",206,0)
 ;
"RTN","RORDD",207,0)
 ; FILE          Top-level file number
"RTN","RORDD",208,0)
 ; [IEN]         IEN of the current record of the top-level file
"RTN","RORDD",209,0)
 ; [FIELD]       Number of the NATIONAL field.
"RTN","RORDD",210,0)
 ;               If value of this parameter less than zero, local
"RTN","RORDD",211,0)
 ;               modifications of all records will be prohibited.
"RTN","RORDD",212,0)
 ;               By default, the .09 field is used.
"RTN","RORDD",213,0)
 ;
"RTN","RORDD",214,0)
 ; This function is intended for use in the "DEL" node logic
"RTN","RORDD",215,0)
 ; of registry definition fields.
"RTN","RORDD",216,0)
 ;
"RTN","RORDD",217,0)
 ; Return Values:
"RTN","RORDD",218,0)
 ;        0  The value of the field can be deleted
"RTN","RORDD",219,0)
 ;        1  Deletion is prohibited
"RTN","RORDD",220,0)
 ;
"RTN","RORDD",221,0)
VADEL(FILE,IEN,FIELD) ;
"RTN","RORDD",222,0)
 Q:$G(XPDNM)'="" 0
"RTN","RORDD",223,0)
 ;--- An authorized developer can delete anything
"RTN","RORDD",224,0)
 Q:$G(RORPARM("DEVELOPER")) 0
"RTN","RORDD",225,0)
 ;--- Check if the registry definition is a national one
"RTN","RORDD",226,0)
 N RC,RORMSG
"RTN","RORDD",227,0)
 I $G(FIELD)'<0  S RC=0  D:$G(IEN)>0  Q:'RC 0
"RTN","RORDD",228,0)
 . S:'$G(FIELD) FIELD=.09
"RTN","RORDD",229,0)
 . S RC=$$GET1^DIQ(FILE,IEN_",",FIELD,"I",,"RORMSG")
"RTN","RORDD",230,0)
 D EN^DDIOL("You cannot edit a national registry definition!")
"RTN","RORDD",231,0)
 Q 1
"RTN","RORDD",232,0)
 ;
"RTN","RORDD",233,0)
 ;***** CHECKS IF A FIELD OF A NATIONAL DEFINITION CAN BE EDITED
"RTN","RORDD",234,0)
 ;
"RTN","RORDD",235,0)
 ; FILE          Top-level file number
"RTN","RORDD",236,0)
 ; [IEN]         IEN of the current record of the top-level file
"RTN","RORDD",237,0)
 ; [FIELD]       Number of the NATIONAL field.
"RTN","RORDD",238,0)
 ;               If value of this parameter less than zero, local
"RTN","RORDD",239,0)
 ;               modifications of all records will be prohibited.
"RTN","RORDD",240,0)
 ;               By default, the .09 field is used.
"RTN","RORDD",241,0)
 ;
"RTN","RORDD",242,0)
 ; This function is intended for use in the input transforms
"RTN","RORDD",243,0)
 ; of registry definition fields. It kills the X variable if
"RTN","RORDD",244,0)
 ; it contains illegal value.
"RTN","RORDD",245,0)
 ;
"RTN","RORDD",246,0)
 ; Return Values:
"RTN","RORDD",247,0)
 ;        0  The field can be edited
"RTN","RORDD",248,0)
 ;        1  Editing is prohibited (X is killed)
"RTN","RORDD",249,0)
 ;
"RTN","RORDD",250,0)
VAEDT(FILE,IEN,FIELD) ;
"RTN","RORDD",251,0)
 Q:($G(DIUTIL)="VERIFY FIELDS")!($G(XPDNM)'="") 0
"RTN","RORDD",252,0)
 ;--- An authorized developer can edit anything
"RTN","RORDD",253,0)
 Q:$G(RORPARM("DEVELOPER")) 0
"RTN","RORDD",254,0)
 ;--- Check if the registry definition is a national one
"RTN","RORDD",255,0)
 N RC,RORMSG
"RTN","RORDD",256,0)
 I $G(FIELD)'<0  S RC=0  D:$G(IEN)>0  Q:'RC 0
"RTN","RORDD",257,0)
 . S:'$G(FIELD) FIELD=.09
"RTN","RORDD",258,0)
 . S RC=$$GET1^DIQ(FILE,IEN_",",FIELD,"I",,"RORMSG")
"RTN","RORDD",259,0)
 K X
"RTN","RORDD",260,0)
 D EN^DDIOL("You cannot edit a national registry definition!")
"RTN","RORDD",261,0)
 Q 1
"RTN","RORDD01")
0^28^B18102562
"RTN","RORDD01",1,0)
RORDD01 ;HCIOFO/SG - DATA DICTIONARY UTILITIES ; 1/23/06 4:45pm
"RTN","RORDD01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORDD01",3,0)
 ;
"RTN","RORDD01",4,0)
 Q
"RTN","RORDD01",5,0)
 ;
"RTN","RORDD01",6,0)
 ;***** "ANC" INDEX OF THE "REGISTRY NAME" MULTIPLE OF THE FILE #799.6
"RTN","RORDD01",7,0)
 ;
"RTN","RORDD01",8,0)
 ; .SDA          Reference to a local array of record IENs
"RTN","RORDD01",9,0)
 ;
"RTN","RORDD01",10,0)
 ; REGNAME       Registry name
"RTN","RORDD01",11,0)
 ;
"RTN","RORDD01",12,0)
 ; MODE          1 - Set, 0 - Kill
"RTN","RORDD01",13,0)
 ;
"RTN","RORDD01",14,0)
ANC7996(SDA,REGNAME,MODE) ;
"RTN","RORDD01",15,0)
 I MODE  S MODE=($D(^RORDATA(799.6,SDA(1),3,"ANC"))>1)  D
"RTN","RORDD01",16,0)
 . S ^RORDATA(799.6,SDA(1),3,"ANC",$E(REGNAME,1,30),SDA)=""
"RTN","RORDD01",17,0)
 E  D  S MODE=($D(^RORDATA(799.6,SDA(1),3,"ANC"))>1)
"RTN","RORDD01",18,0)
 . K ^RORDATA(799.6,SDA(1),3,"ANC",$E(REGNAME,1,30),SDA)
"RTN","RORDD01",19,0)
 Q:MODE
"RTN","RORDD01",20,0)
 ;--- Re-index the main record (the "ADNAUTO" index, in particular)
"RTN","RORDD01",21,0)
 N DA,DIK
"RTN","RORDD01",22,0)
 S DIK="^RORDATA(799.6,",DIK(1)=".01",DA=SDA(1)
"RTN","RORDD01",23,0)
 D EN^DIK
"RTN","RORDD01",24,0)
 Q
"RTN","RORDD01",25,0)
 ;
"RTN","RORDD01",26,0)
 ;***** DELETES THE DATA ASSOCIATED WITH THE MAIN REGISTRY RECORD
"RTN","RORDD01",27,0)
 ;
"RTN","RORDD01",28,0)
 ; IEN           IEN of the registry record (file #798)
"RTN","RORDD01",29,0)
 ; PTIEN         Patient IEN
"RTN","RORDD01",30,0)
 ;
"RTN","RORDD01",31,0)
DEL798(IEN,PTIEN) ;
"RTN","RORDD01",32,0)
 N DA,DIK,I,PTDEL
"RTN","RORDD01",33,0)
 ;--- Delete the HIV record from the ROR HIV RECORD file (#799.4)
"RTN","RORDD01",34,0)
 I $D(^RORDATA(799.4,IEN))  S DIK="^RORDATA(799.4,",DA=IEN  D ^DIK
"RTN","RORDD01",35,0)
 ;--- Check if the patient is added to more than one registry
"RTN","RORDD01",36,0)
 S I="",PTDEL=1
"RTN","RORDD01",37,0)
 F  S I=$O(^RORDATA(798,"B",PTIEN,I))  Q:I=""  S:I'=IEN PTDEL=0
"RTN","RORDD01",38,0)
 ;--- Delete corresponding patient's records if they are not
"RTN","RORDD01",39,0)
 ;    referenced by other registries and the patient's record
"RTN","RORDD01",40,0)
 ;--- in the PATIENT file (#2) is not a "merged" one.
"RTN","RORDD01",41,0)
 I PTDEL  D:$G(^DPT(PTIEN,-9))'>0
"RTN","RORDD01",42,0)
 . ;--- Delete the record from the ROR PATIENT file
"RTN","RORDD01",43,0)
 . S DIK="^RORDATA(798.4,",DA=PTIEN  D ^DIK
"RTN","RORDD01",44,0)
 . ;--- Delete the record from the ROR PATIENT EVENTS file
"RTN","RORDD01",45,0)
 . S DIK="^RORDATA(798.3,",DA=PTIEN  D ^DIK
"RTN","RORDD01",46,0)
 Q
"RTN","RORDD01",47,0)
 ;
"RTN","RORDD01",48,0)
 ;***** RETURNS THE VALUE OF 'DATE SELECTED' COMPUTED FIELD
"RTN","RORDD01",49,0)
 ;
"RTN","RORDD01",50,0)
 ; IEN           IEN of the registry record (file #798)
"RTN","RORDD01",51,0)
 ;
"RTN","RORDD01",52,0)
DTSEL(IEN) ;
"RTN","RORDD01",53,0)
 N DTSEL
"RTN","RORDD01",54,0)
 ;--- Earliest date of a selection rule
"RTN","RORDD01",55,0)
 S DTSEL=$O(^RORDATA(798,IEN,1,"AD",""))\1
"RTN","RORDD01",56,0)
 ;--- If SELECTION RULE multiple is empty, return DATE ENTERED
"RTN","RORDD01",57,0)
 Q $S(DTSEL>0:DTSEL,1:$P($G(^RORDATA(798,IEN,0)),U,3)\1)
"RTN","RORDD01",58,0)
 ;
"RTN","RORDD01",59,0)
 ;***** STORE THE VALUE INTO THE FIELD
"RTN","RORDD01",60,0)
 ;
"RTN","RORDD01",61,0)
 ; FILE          Sub(file) number
"RTN","RORDD01",62,0)
 ; IENS          IENS of the record
"RTN","RORDD01",63,0)
 ; FIELD         Field number
"RTN","RORDD01",64,0)
 ; VALUE         Internal value to be assigned
"RTN","RORDD01",65,0)
 ;
"RTN","RORDD01",66,0)
FILE(FILE,IENS,FIELD,VALUE) ;
"RTN","RORDD01",67,0)
 N ROR8FDA,ROR8MSG,TMP
"RTN","RORDD01",68,0)
 S TMP=$S($E(IENS,$L(IENS))=",":IENS,1:IENS_",")
"RTN","RORDD01",69,0)
 S ROR8FDA(+FILE,TMP,+FIELD)=VALUE
"RTN","RORDD01",70,0)
 D FILE^DIE(,"ROR8FDA","ROR8MSG")
"RTN","RORDD01",71,0)
 Q
"RTN","RORDD01",72,0)
 ;
"RTN","RORDD01",73,0)
 ;***** STATUS OF THE HISTORICAL DATA DEFINITION
"RTN","RORDD01",74,0)
 ;
"RTN","RORDD01",75,0)
 ; HDEIEN        IEN of the HDE definition (file #799.6)
"RTN","RORDD01",76,0)
 ;
"RTN","RORDD01",77,0)
 ; Return Values:
"RTN","RORDD01",78,0)
 ;       ""  Unknown/Undefined
"RTN","RORDD01",79,0)
 ;        0  Inactive
"RTN","RORDD01",80,0)
 ;        1  Pending/Active
"RTN","RORDD01",81,0)
 ;        2  Completed
"RTN","RORDD01",82,0)
 ;
"RTN","RORDD01",83,0)
HDESTAT(HDEIEN) ;
"RTN","RORDD01",84,0)
 N BUF,STATUS,TYPE
"RTN","RORDD01",85,0)
 S HDEIEN=+HDEIEN,BUF=$G(^RORDATA(799.6,HDEIEN,0))
"RTN","RORDD01",86,0)
 S TYPE=+$P(BUF,U,2),STATUS=""
"RTN","RORDD01",87,0)
 ;=== Auto
"RTN","RORDD01",88,0)
 I TYPE=1  D  Q STATUS
"RTN","RORDD01",89,0)
 . N ADT
"RTN","RORDD01",90,0)
 . ;--- Activation Date
"RTN","RORDD01",91,0)
 . S ADT=+$P(BUF,U,7)
"RTN","RORDD01",92,0)
 . I (ADT'>0)!(ADT<DT)  S STATUS=0  Q
"RTN","RORDD01",93,0)
 . ;--- Check if all registries have completion dates
"RTN","RORDD01",94,0)
 . I $D(^RORDATA(799.6,HDEIEN,3,"ANC"))<10  S STATUS=2  Q
"RTN","RORDD01",95,0)
 . ;--- Pending or Active
"RTN","RORDD01",96,0)
 . S STATUS=1
"RTN","RORDD01",97,0)
 ;=== Manual
"RTN","RORDD01",98,0)
 I TYPE=2  D  Q STATUS
"RTN","RORDD01",99,0)
 . N TSKIEN,TSKSTAT
"RTN","RORDD01",100,0)
 . ;--- Check if any tasks are defined
"RTN","RORDD01",101,0)
 . I $O(^RORDATA(799.6,HDEIEN,4,0))'>0  S STATUS=0  Q
"RTN","RORDD01",102,0)
 . ;--- Check if all tasks have been completed
"RTN","RORDD01",103,0)
 . I $D(^RORDATA(799.6,HDEIEN,4,"ANC"))<10  S STATUS=2  Q
"RTN","RORDD01",104,0)
 . ;--- Pending, Active, or Errors
"RTN","RORDD01",105,0)
 . S STATUS=1
"RTN","RORDD01",106,0)
 ;=== Unknown or Undefined
"RTN","RORDD01",107,0)
 Q ""
"RTN","RORDD01",108,0)
 ;
"RTN","RORDD01",109,0)
 ;***** CHECKS IF THE LOCAL REGISTRY FIELD IS ACTIVE
"RTN","RORDD01",110,0)
 ;
"RTN","RORDD01",111,0)
 ; IEN           IEN of the local field definition (file #799.53)
"RTN","RORDD01",112,0)
 ;
"RTN","RORDD01",113,0)
 ; Return Values:
"RTN","RORDD01",114,0)
 ;        0  Inactivated
"RTN","RORDD01",115,0)
 ;        1  Active
"RTN","RORDD01",116,0)
 ;
"RTN","RORDD01",117,0)
LFACTIVE(IEN) ;
"RTN","RORDD01",118,0)
 N TMP
"RTN","RORDD01",119,0)
 S TMP=$G(^ROR(799.53,+IEN,0))  Q:TMP="" 0
"RTN","RORDD01",120,0)
 S TMP=$P(TMP,U,2)\1            Q:TMP'>0 1
"RTN","RORDD01",121,0)
 Q (TMP>DT)
"RTN","RORDD01",122,0)
 ;
"RTN","RORDD01",123,0)
 ;***** RETURNS THE VALUE OF 'LOCATION' COMPUTED FIELD
"RTN","RORDD01",124,0)
 ;
"RTN","RORDD01",125,0)
 ; IEN           IEN of the registry record (file #798)
"RTN","RORDD01",126,0)
 ;
"RTN","RORDD01",127,0)
LOCSEL(IEN) ;
"RTN","RORDD01",128,0)
 N DTSEL,SRIEN
"RTN","RORDD01",129,0)
 S DTSEL=$O(^RORDATA(798,IEN,1,"AD",""))  Q:DTSEL'>0 ""
"RTN","RORDD01",130,0)
 S SRIEN=$O(^RORDATA(798,IEN,1,"AD",DTSEL,""))
"RTN","RORDD01",131,0)
 Q $S(SRIEN>0:$P($G(^RORDATA(798,IEN,1,SRIEN,0)),U,3),1:"")
"RTN","RORDD01",132,0)
 ;
"RTN","RORDD01",133,0)
 ;***** RE-INDEXES ONE RECORD OF THE (SUB)FILE
"RTN","RORDD01",134,0)
 ;
"RTN","RORDD01",135,0)
 ; FILE          File number
"RTN","RORDD01",136,0)
 ;
"RTN","RORDD01",137,0)
 ; .DA           Reference to a local array of record IENs
"RTN","RORDD01",138,0)
 ;
"RTN","RORDD01",139,0)
 ; [FIELD]       Optional field number. If it is provided, then only
"RTN","RORDD01",140,0)
 ;               cross-references for this field are re-indexed.
"RTN","RORDD01",141,0)
 ;
"RTN","RORDD01",142,0)
REINDEX1(FILE,DA,FIELD) ;
"RTN","RORDD01",143,0)
 N DIK
"RTN","RORDD01",144,0)
 S DIK=$$ROOT^DILFD(FILE,$$IENS^DILF(.DA))
"RTN","RORDD01",145,0)
 S:$G(FIELD)>0 DIK(1)=+FIELD
"RTN","RORDD01",146,0)
 D EN^DIK
"RTN","RORDD01",147,0)
 Q
"RTN","RORDD01",148,0)
 ;
"RTN","RORDD01",149,0)
 ;***** REACTS ON THE REGISTRY RECORD STATUS CHANGES
"RTN","RORDD01",150,0)
 ;
"RTN","RORDD01",151,0)
 ; MODE          Execution mode (1 - Set, 2 - Kill)
"RTN","RORDD01",152,0)
 ;
"RTN","RORDD01",153,0)
 ; IEN           Internal entry number of the registry record
"RTN","RORDD01",154,0)
 ;
"RTN","RORDD01",155,0)
 ; STOLD         Old and new internal values of the STATUS field
"RTN","RORDD01",156,0)
 ; STNEW
"RTN","RORDD01",157,0)
 ;
"RTN","RORDD01",158,0)
RST798(MODE,IEN,STOLD,STNEW) ;
"RTN","RORDD01",159,0)
 Q:STNEW=STOLD
"RTN","RORDD01",160,0)
 N IENS,RORFDA,RORMSG
"RTN","RORDD01",161,0)
 S IENS=(+IEN)_","
"RTN","RORDD01",162,0)
 ;---
"RTN","RORDD01",163,0)
 D
"RTN","RORDD01",164,0)
 . ;--- Deleted
"RTN","RORDD01",165,0)
 . I STNEW=5  D  Q
"RTN","RORDD01",166,0)
 . . S RORFDA(798,IENS,6)=$$NOW^XLFDT
"RTN","RORDD01",167,0)
 . . S:$G(DUZ)>0 RORFDA(798,IENS,6.1)=+DUZ
"RTN","RORDD01",168,0)
 . ;--- Confirmed
"RTN","RORDD01",169,0)
 . I STOLD=4,'STNEW  D  Q
"RTN","RORDD01",170,0)
 . . S RORFDA(798,IENS,2)=$$NOW^XLFDT
"RTN","RORDD01",171,0)
 . . S:$G(DUZ)>0 RORFDA(798,IENS,2.1)=+DUZ
"RTN","RORDD01",172,0)
 ;---
"RTN","RORDD01",173,0)
 D:$D(RORFDA)>1 FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORDD01",174,0)
 Q
"RTN","RORDD01",175,0)
 ;
"RTN","RORDD01",176,0)
 ;***** GENERATES THE INDEX VALUE OF THE REPORT ELEMENT
"RTN","RORDD01",177,0)
 ;
"RTN","RORDD01",178,0)
 ; MODE          Sort mode (see the SORT BY field of the REPORT
"RTN","RORDD01",179,0)
 ;               ELEMENT multiple of the ROR TASK file for details)
"RTN","RORDD01",180,0)
 ; VAL           Value of the report element
"RTN","RORDD01",181,0)
 ;
"RTN","RORDD01",182,0)
SORTBY(MODE,VAL) ;
"RTN","RORDD01",183,0)
 Q $S(MODE=3:+VAL,VAL="":" ",MODE=2:$E(VAL,1,29)_" ",1:$E(VAL,1,30))
"RTN","RORERR")
0^29^B31347576
"RTN","RORERR",1,0)
RORERR ;HCIOFO/SG - ERROR PROCESSING  ; 11/7/05 10:29am
"RTN","RORERR",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORERR",3,0)
 ;
"RTN","RORERR",4,0)
 Q
"RTN","RORERR",5,0)
 ;
"RTN","RORERR",6,0)
 ;***** INITIALIZES THE ERROR STACK
"RTN","RORERR",7,0)
 ;
"RTN","RORERR",8,0)
 ; [DEFLOC]      Default error location
"RTN","RORERR",9,0)
 ; [ENABLE]      Enable extended error processing
"RTN","RORERR",10,0)
 ; 
"RTN","RORERR",11,0)
 ; Do not forget to NEW the RORERRDL variable before calling
"RTN","RORERR",12,0)
 ; this procedure!
"RTN","RORERR",13,0)
 ;
"RTN","RORERR",14,0)
CLEAR(DEFLOC,ENABLE) ;
"RTN","RORERR",15,0)
 S:$D(ENABLE) RORPARM("ERR")=+$G(ENABLE)
"RTN","RORERR",16,0)
 I $G(RORPARM("ERR"))  K RORERROR("ES")  S:$D(DEFLOC) RORERRDL=DEFLOC
"RTN","RORERR",17,0)
 D CLEAN^DILF
"RTN","RORERR",18,0)
 Q
"RTN","RORERR",19,0)
 ;
"RTN","RORERR",20,0)
 ;***** CHECKS THE ERRORS AFTER A FILEMAN DBS CALL
"RTN","RORERR",21,0)
 ;
"RTN","RORERR",22,0)
 ; ROR8MSG       Closed reference of the error messages array
"RTN","RORERR",23,0)
 ;               (from DBS calls)
"RTN","RORERR",24,0)
 ; [ERRCODE]     Error code to assign
"RTN","RORERR",25,0)
 ; [PLACE]       Location of the error (see the $$ERROR)
"RTN","RORERR",26,0)
 ; [PATIEN]      Patient IEN
"RTN","RORERR",27,0)
 ; [FILE]        File number used in the DBS call
"RTN","RORERR",28,0)
 ; [IENS]        IENS used in the DBS call
"RTN","RORERR",29,0)
 ;
"RTN","RORERR",30,0)
 ; The $$DBS^RORERR function checks the DIERR and @ROR8MSG variables
"RTN","RORERR",31,0)
 ; for errors after a FileMan DBS call.
"RTN","RORERR",32,0)
 ; 
"RTN","RORERR",33,0)
 ; Return Values:
"RTN","RORERR",34,0)
 ;
"RTN","RORERR",35,0)
 ; If there are no errors found, it returns an empty string.
"RTN","RORERR",36,0)
 ; In case of errors, the result depends on value of the ERRCODE
"RTN","RORERR",37,0)
 ; parameter:
"RTN","RORERR",38,0)
 ;
"RTN","RORERR",39,0)
 ; If ERRCODE is omitted or equals 0, the function returns a string
"RTN","RORERR",40,0)
 ; containing the list of error codes separated by comma.
"RTN","RORERR",41,0)
 ; 
"RTN","RORERR",42,0)
 ; If ERRCODE is not zero, the $$ERROR^RORERR function is called and
"RTN","RORERR",43,0)
 ; its return value is returned.
"RTN","RORERR",44,0)
 ;
"RTN","RORERR",45,0)
 ; NOTE: This entry point can also be called as a procedure:
"RTN","RORERR",46,0)
 ;       D DBS^RORERR(...) if you do not need its return value.
"RTN","RORERR",47,0)
 ;
"RTN","RORERR",48,0)
DBS(ROR8MSG,ERRCODE,PLACE,PATIEN,FILE,IENS) ;
"RTN","RORERR",49,0)
 K RORERROR("DBS")
"RTN","RORERR",50,0)
 I '$G(DIERR)  Q:$QUIT ""  Q
"RTN","RORERR",51,0)
 N ERRLST,ERRNODE,I,MSGTEXT
"RTN","RORERR",52,0)
 S ERRNODE=$S($G(ROR8MSG)'="":$NA(@ROR8MSG@("DIERR")),1:$NA(^TMP("DIERR",$J)))
"RTN","RORERR",53,0)
 I $D(@ERRNODE)<10  Q:$QUIT ""  Q
"RTN","RORERR",54,0)
 ;--- Get a list of errors
"RTN","RORERR",55,0)
 S I=0
"RTN","RORERR",56,0)
 F  S I=$O(@ERRNODE@("E",I))  Q:'I  S RORERROR("DBS",I)=""
"RTN","RORERR",57,0)
 ;--- Return a list of errors
"RTN","RORERR",58,0)
 I '$G(ERRCODE)  D  Q:$QUIT $P(ERRLST,",",2,99)  Q
"RTN","RORERR",59,0)
 . S ERRLST="",I=0
"RTN","RORERR",60,0)
 . F  S I=$O(RORERROR("DBS",I))  Q:'I  S ERRLST=ERRLST_","_I
"RTN","RORERR",61,0)
 . D CLEAN^DILF
"RTN","RORERR",62,0)
 ;--- Record/display the error message
"RTN","RORERR",63,0)
 D MSG^DIALOG("AE",.MSGTEXT,,,$G(ROR8MSG)),CLEAN^DILF
"RTN","RORERR",64,0)
 S I=$S($G(FILE):"; File #"_FILE,1:"")
"RTN","RORERR",65,0)
 S:$G(IENS)'="" I=I_"; IENS: """_IENS_""""
"RTN","RORERR",66,0)
 S I=$$ERROR(ERRCODE,.PLACE,.MSGTEXT,.PATIEN,I)
"RTN","RORERR",67,0)
 Q:$QUIT I  Q
"RTN","RORERR",68,0)
 ;
"RTN","RORERR",69,0)
 ;***** SETS DEFAULT ERROR LOCATION
"RTN","RORERR",70,0)
 ;
"RTN","RORERR",71,0)
 ; DEFLOC        Default error location
"RTN","RORERR",72,0)
 ; 
"RTN","RORERR",73,0)
 ; Do not forget to NEW the RORERRDL variable before calling
"RTN","RORERR",74,0)
 ; this procedure!
"RTN","RORERR",75,0)
 ;
"RTN","RORERR",76,0)
DFLTLOC(DEFLOC) ;
"RTN","RORERR",77,0)
 I $G(RORPARM("ERR"))  S RORERRDL=DEFLOC
"RTN","RORERR",78,0)
 D CLEAN^DILF
"RTN","RORERR",79,0)
 Q
"RTN","RORERR",80,0)
 ;
"RTN","RORERR",81,0)
 ;***** DISPLAYS CONTENT OF THE ERROR STACK
"RTN","RORERR",82,0)
DSPSTK() ;
"RTN","RORERR",83,0)
 Q:'$G(RORPARM("ERR"))!($D(RORERROR("ES"))<10)
"RTN","RORERR",84,0)
 N EPTR,I,TMP
"RTN","RORERR",85,0)
 D DSPSTKL("Err   Message Text",1)
"RTN","RORERR",86,0)
 D DSPSTKL("      Additional info")
"RTN","RORERR",87,0)
 S EPTR=""
"RTN","RORERR",88,0)
 F  S EPTR=$O(RORERROR("ES",EPTR))  Q:EPTR=""  D
"RTN","RORERR",89,0)
 . S TMP=RORERROR("ES",EPTR)
"RTN","RORERR",90,0)
 . D DSPSTKL($J(+TMP,4)_"  "_$P(TMP,U,2),1)
"RTN","RORERR",91,0)
 . S TMP=$G(RORERROR("ES",EPTR,1))
"RTN","RORERR",92,0)
 . D:TMP'="" DSPSTKL("      Location: "_TMP)
"RTN","RORERR",93,0)
 . S I=""
"RTN","RORERR",94,0)
 . F  S I=$O(RORERROR("ES",EPTR,2,I))  Q:I=""  D
"RTN","RORERR",95,0)
 . . D DSPSTKL("      "_RORERROR("ES",EPTR,2,I))
"RTN","RORERR",96,0)
 Q
"RTN","RORERR",97,0)
 ;
"RTN","RORERR",98,0)
 ; MSG           Message to display
"RTN","RORERR",99,0)
 ; [SKIP]        Skip a line before the output
"RTN","RORERR",100,0)
 ;
"RTN","RORERR",101,0)
DSPSTKL(MSG,SKIP) ;
"RTN","RORERR",102,0)
 I '$G(RORPARM("KIDS"))  W:$G(SKIP) !  W MSG,!  Q
"RTN","RORERR",103,0)
 I $G(SKIP)  D BMES^XPDUTL(MSG)  Q
"RTN","RORERR",104,0)
 D MES^XPDUTL(MSG)
"RTN","RORERR",105,0)
 Q
"RTN","RORERR",106,0)
 ;
"RTN","RORERR",107,0)
 ;***** PUTS THE ERROR IN THE ERROR STACK AND LOG FILE
"RTN","RORERR",108,0)
 ;
"RTN","RORERR",109,0)
 ; ERRCODE       Error code. Debug messages, information messages,
"RTN","RORERR",110,0)
 ;               data quality warnings and warnings are not placed
"RTN","RORERR",111,0)
 ;               into the stack. However, they are logged and
"RTN","RORERR",112,0)
 ;               displayed if this is enabled.
"RTN","RORERR",113,0)
 ;
"RTN","RORERR",114,0)
 ; [PLACE]       Location of the error (TAG^ROUTINE).
"RTN","RORERR",115,0)
 ;
"RTN","RORERR",116,0)
 ;               If the parameter is undefined then the location is
"RTN","RORERR",117,0)
 ;               extracted from the stack (see description of the
"RTN","RORERR",118,0)
 ;               $STACK function for more details).
"RTN","RORERR",119,0)
 ;
"RTN","RORERR",120,0)
 ;               If an empty string is used as a value of the
"RTN","RORERR",121,0)
 ;               parameter then the default location is used
"RTN","RORERR",122,0)
 ;               (that has been set by CLEAR or DFLTLOC).
"RTN","RORERR",123,0)
 ;
"RTN","RORERR",124,0)
 ; [[.]RORINFO]  Optional additional information (either a string or
"RTN","RORERR",125,0)
 ;               a reference to a local array that contains strings
"RTN","RORERR",126,0)
 ;               prepared for storing in a word processing field)
"RTN","RORERR",127,0)
 ;
"RTN","RORERR",128,0)
 ; [PATIEN]      Patient IEN
"RTN","RORERR",129,0)
 ;
"RTN","RORERR",130,0)
 ; [ARG2-ARG5]   Optional parameters as for $$MSG^RORERR20
"RTN","RORERR",131,0)
 ;               (|1| is substituted by the value of the PATIEN)
"RTN","RORERR",132,0)
 ;
"RTN","RORERR",133,0)
 ; Return Values:
"RTN","RORERR",134,0)
 ;       <0  Error code (value of the ERRCODE)
"RTN","RORERR",135,0)
 ;        0  Ok (if ERRCOCE'<0)
"RTN","RORERR",136,0)
 ;
"RTN","RORERR",137,0)
 ; NOTE: This entry point can also be called as a procedure:
"RTN","RORERR",138,0)
 ;       D ERROR^RORERR(...) if you do not need its return value.
"RTN","RORERR",139,0)
 ;
"RTN","RORERR",140,0)
ERROR(ERRCODE,PLACE,RORINFO,PATIEN,ARG2,ARG3,ARG4,ARG5) ;
"RTN","RORERR",141,0)
 I ERRCODE'<0  Q:$QUIT 0  Q
"RTN","RORERR",142,0)
 N IR,SL,MSG,TOP,TYPE
"RTN","RORERR",143,0)
 D:'$D(PLACE)
"RTN","RORERR",144,0)
 . S SL=$STACK(-1)-1
"RTN","RORERR",145,0)
 . F  Q:SL'>0  D  Q:'(PLACE["^RORERR")  S SL=SL-1
"RTN","RORERR",146,0)
 . . S PLACE=$P($STACK(SL,"PLACE")," ")
"RTN","RORERR",147,0)
 S:$G(PLACE)="" PLACE=$G(RORERRDL)
"RTN","RORERR",148,0)
 I $D(RORINFO)=1  S IR=RORINFO  K RORINFO  S RORINFO(1)=IR,IR=1
"RTN","RORERR",149,0)
 E  S IR=$O(RORINFO(""),-1)
"RTN","RORERR",150,0)
 S MSG=$$MSG^RORERR20(+ERRCODE,.TYPE,.PATIEN,.ARG2,.ARG3,.ARG4,.ARG5)
"RTN","RORERR",151,0)
 ;--- Put the error to the error stack
"RTN","RORERR",152,0)
 D:$G(RORPARM("ERR"))&(TYPE>4)
"RTN","RORERR",153,0)
 . S (RORERROR("ES"),TOP)=$G(RORERROR("ES"))+1
"RTN","RORERR",154,0)
 . S RORERROR("ES",TOP)=+ERRCODE_U_MSG
"RTN","RORERR",155,0)
 . S RORERROR("ES",TOP,1)=PLACE
"RTN","RORERR",156,0)
 . M:$D(RORINFO) RORERROR("ES",TOP,2)=RORINFO
"RTN","RORERR",157,0)
 ;--- Log the message
"RTN","RORERR",158,0)
 S:PLACE'="" IR=IR+1,RORINFO(IR)="Location: "_PLACE
"RTN","RORERR",159,0)
 D LOG^RORLOG(TYPE,MSG,$G(PATIEN),.RORINFO),CLEAN^DILF
"RTN","RORERR",160,0)
 Q:$QUIT ERRCODE  Q
"RTN","RORERR",161,0)
 ;
"RTN","RORERR",162,0)
 ;***** CHECKS FOR INVALID POINTER ERROR
"RTN","RORERR",163,0)
 ;
"RTN","RORERR",164,0)
 ; FILE          Number of the 'pointed from' file
"RTN","RORERR",165,0)
 ; IENS          IENS of the record of the file
"RTN","RORERR",166,0)
 ; FIELD         Number of the pointer field
"RTN","RORERR",167,0)
 ; [PLACE]       Location of the error (see the $$ERROR)
"RTN","RORERR",168,0)
 ; [PATIEN]      Patient IEN
"RTN","RORERR",169,0)
 ; [ERRCODE]     Error code to assign (-79 by default)
"RTN","RORERR",170,0)
 ;
"RTN","RORERR",171,0)
 ; The $$INVLDPTR^RORERR function checks the list of latest FileMan
"RTN","RORERR",172,0)
 ; DBS error codes for the pointer errors.
"RTN","RORERR",173,0)
 ; 
"RTN","RORERR",174,0)
 ; Return Values:
"RTN","RORERR",175,0)
 ;
"RTN","RORERR",176,0)
 ; If there are no pointer errors found, the function returns zero.
"RTN","RORERR",177,0)
 ; Otherwise, the $$ERROR^RORERR function is called and its value
"RTN","RORERR",178,0)
 ; is returned (a negative value of the ERRCODE or -79 by default).
"RTN","RORERR",179,0)
 ;
"RTN","RORERR",180,0)
INVLDPTR(FILE,IENS,FIELD,PLACE,PATIEN,ERRCODE) ;
"RTN","RORERR",181,0)
 Q:$D(RORERROR("DBS"))<10 0
"RTN","RORERR",182,0)
 N EC,TMP
"RTN","RORERR",183,0)
 F EC=601,0  Q:$D(RORERROR("DBS",EC))
"RTN","RORERR",184,0)
 Q:'EC 0
"RTN","RORERR",185,0)
 S TMP="File #"_FILE_"; IENS: """_IENS_"""; Field: "_FIELD
"RTN","RORERR",186,0)
 Q $$ERROR($S($G(ERRCODE)<0:ERRCODE,1:-79),$G(PLACE),.TMP,.PATIEN)
"RTN","RORERR",187,0)
 ;
"RTN","RORERR",188,0)
 ;***** RECORDS THE ERROR MESSAGE INTO THE LOG FILE
"RTN","RORERR",189,0)
 ;
"RTN","RORERR",190,0)
 ; ERRCODE       Error code.
"RTN","RORERR",191,0)
 ;
"RTN","RORERR",192,0)
 ; [[.]RORINFO]  Optional additional information (either a string or
"RTN","RORERR",193,0)
 ;               a reference to a local array that contains strings
"RTN","RORERR",194,0)
 ;               prepared for storing in a word processing field)
"RTN","RORERR",195,0)
 ;
"RTN","RORERR",196,0)
 ; [PATIEN]      Patient IEN
"RTN","RORERR",197,0)
 ;
"RTN","RORERR",198,0)
 ; [ARG2-ARG5]   Optional parameters as for $$MSG^RORERR20
"RTN","RORERR",199,0)
 ;               (|1| is substituted by the value of the PATIEN)
"RTN","RORERR",200,0)
 ;
"RTN","RORERR",201,0)
LOG(ERRCODE,RORINFO,PATIEN,ARG2,ARG3,ARG4,ARG5) ;
"RTN","RORERR",202,0)
 Q:ERRCODE'<0
"RTN","RORERR",203,0)
 N MSG,TYPE
"RTN","RORERR",204,0)
 S MSG=$$MSG^RORERR20(+ERRCODE,.TYPE,.PATIEN,.ARG2,.ARG3,.ARG4,.ARG5)
"RTN","RORERR",205,0)
 D LOG^RORLOG(TYPE,MSG,$G(PATIEN),.RORINFO)
"RTN","RORERR",206,0)
 Q
"RTN","RORERR",207,0)
 ;
"RTN","RORERR",208,0)
 ;***** RETURNS THE ERROR STACK FOR A REMOTE PROCEDURE
"RTN","RORERR",209,0)
 ;
"RTN","RORERR",210,0)
 ; .RESULT       Reference to a local variable where the error
"RTN","RORERR",211,0)
 ;               descriptors are returned to.
"RTN","RORERR",212,0)
 ;
"RTN","RORERR",213,0)
 ; LASTERR       The last error code
"RTN","RORERR",214,0)
 ;
"RTN","RORERR",215,0)
 ; Return Values:
"RTN","RORERR",216,0)
 ;
"RTN","RORERR",217,0)
 ; RESULT(0)             Result descriptor
"RTN","RORERR",218,0)
 ;                         ^01: The last error code (LASTERR)
"RTN","RORERR",219,0)
 ;                         ^02: Number of the error descriptors
"RTN","RORERR",220,0)
 ;
"RTN","RORERR",221,0)
 ; RESULT(i)             Error descriptor
"RTN","RORERR",222,0)
 ;                         ^01: Error code
"RTN","RORERR",223,0)
 ;                         ^02: Message
"RTN","RORERR",224,0)
 ;                         ^03: Place of the error
"RTN","RORERR",225,0)
 ; RESULT(j)             Line of the additional info
"RTN","RORERR",226,0)
 ;                         ^01: ""
"RTN","RORERR",227,0)
 ;                         ^02: Text
"RTN","RORERR",228,0)
 ;
"RTN","RORERR",229,0)
 ; Error descriptors are returned in reverse chronological order
"RTN","RORERR",230,0)
 ; (most recent first).
"RTN","RORERR",231,0)
 ; 
"RTN","RORERR",232,0)
RPCSTK(RESULT,LASTERR) ;
"RTN","RORERR",233,0)
 N CNT,ECNT,EPTR,I,TMP
"RTN","RORERR",234,0)
 K RESULT  S RESULT(0)=(+LASTERR)_U_"0"
"RTN","RORERR",235,0)
 S TMP=$$RTRNFMT^XWBLIB(2,1)
"RTN","RORERR",236,0)
 Q:$D(RORERROR("ES"))<10
"RTN","RORERR",237,0)
 ;
"RTN","RORERR",238,0)
 S EPTR="",(CNT,ECNT)=0
"RTN","RORERR",239,0)
 F  S EPTR=$O(RORERROR("ES",EPTR),-1)  Q:EPTR=""  D
"RTN","RORERR",240,0)
 . S TMP=$G(RORERROR("ES",EPTR)),CNT=CNT+1,ECNT=ECNT+1
"RTN","RORERR",241,0)
 . S RESULT(CNT)=(+TMP)_U_$TR($P(TMP,U,2,999),U,"~")
"RTN","RORERR",242,0)
 . S TMP=$G(RORERROR("ES",EPTR,1))
"RTN","RORERR",243,0)
 . S $P(RESULT(CNT),U,3)=$TR(TMP,U,"~")
"RTN","RORERR",244,0)
 . S I=0
"RTN","RORERR",245,0)
 . F  S I=$O(RORERROR("ES",EPTR,2,I))  Q:I'>0  D
"RTN","RORERR",246,0)
 . . S CNT=CNT+1,$P(RESULT(CNT),U,2)=RORERROR("ES",EPTR,2,I)
"RTN","RORERR",247,0)
 ;
"RTN","RORERR",248,0)
 S $P(RESULT(0),U,2)=ECNT
"RTN","RORERR",249,0)
 K ^TMP("DILIST",$J)
"RTN","RORERR",250,0)
 Q
"RTN","RORERR",251,0)
 ;
"RTN","RORERR",252,0)
 ;***** DUMPS LOCAL VARIABLES INTO THE LOG
"RTN","RORERR",253,0)
 ;
"RTN","RORERR",254,0)
 ; M1S2G         Message code.
"RTN","RORERR",255,0)
 ;
"RTN","RORERR",256,0)
 ; V1A2R3S       List of local variables separated by commas
"RTN","RORERR",257,0)
 ;
"RTN","RORERR",258,0)
VARDUMP(M1S2G,V1A2R3S) ;
"RTN","RORERR",259,0)
 Q
"RTN","RORERR10")
1^30
"RTN","RORERR11")
1^31
"RTN","RORERR12")
1^32
"RTN","RORERR20")
0^33^B65392976
"RTN","RORERR20",1,0)
RORERR20 ;HCIOFO/SG - LIST OF ERROR MESSAGES  ; 1/22/06 7:00pm
"RTN","RORERR20",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORERR20",3,0)
 ;
"RTN","RORERR20",4,0)
 Q
"RTN","RORERR20",5,0)
 ;
"RTN","RORERR20",6,0)
 ;***** RETURNS THE TEXT OF THE MESSAGE
"RTN","RORERR20",7,0)
 ;
"RTN","RORERR20",8,0)
 ; ERRCODE       Error code
"RTN","RORERR20",9,0)
 ; [.TYPE]       Type of the error
"RTN","RORERR20",10,0)
 ; [ARG1-ARG5]   Optional parameters that substitute the |n| "windows"
"RTN","RORERR20",11,0)
 ;               in the text of the message (for example, the |2| will
"RTN","RORERR20",12,0)
 ;               be substituted by the value of the ARG2).
"RTN","RORERR20",13,0)
 ;
"RTN","RORERR20",14,0)
MSG(ERRCODE,TYPE,ARG1,ARG2,ARG3,ARG4,ARG5) ;
"RTN","RORERR20",15,0)
 S TYPE=6  Q:ERRCODE'<0 ""
"RTN","RORERR20",16,0)
 N ARG,I1,I2,MSG
"RTN","RORERR20",17,0)
 ;--- Get a descriptor of the message
"RTN","RORERR20",18,0)
 S I1=-ERRCODE,MSG=$P($T(MSGLIST+I1),";;",2)
"RTN","RORERR20",19,0)
 S I1=+$TR($P(MSG,U,2)," "),MSG=$P(MSG,U,3,999)
"RTN","RORERR20",20,0)
 S:I1>0 TYPE=I1
"RTN","RORERR20",21,0)
 Q:MSG?." " "Unknown error ("_ERRCODE_")"
"RTN","RORERR20",22,0)
 ;--- Substitute parameters
"RTN","RORERR20",23,0)
 S I1=2
"RTN","RORERR20",24,0)
 F  S I1=$F(MSG,"|",I1-1)  Q:'I1  D
"RTN","RORERR20",25,0)
 . S I2=$F(MSG,"|",I1)  Q:'I2
"RTN","RORERR20",26,0)
 . X "S ARG=$G(ARG"_+$TR($E(MSG,I1,I2-2)," ")_")"
"RTN","RORERR20",27,0)
 . S $E(MSG,I1-1,I2-1)=ARG
"RTN","RORERR20",28,0)
 Q $$TRIM^XLFSTR(MSG)
"RTN","RORERR20",29,0)
 ;
"RTN","RORERR20",30,0)
 ;***** RETURNS TYPE OF THE MESSAGE
"RTN","RORERR20",31,0)
 ;
"RTN","RORERR20",32,0)
 ; ERRCODE       Error code
"RTN","RORERR20",33,0)
 ;
"RTN","RORERR20",34,0)
TYPE(ERRCODE) ;
"RTN","RORERR20",35,0)
 Q:ERRCODE'<0 0
"RTN","RORERR20",36,0)
 N I,TYPE  S I=-ERRCODE
"RTN","RORERR20",37,0)
 S I=$P($T(MSGLIST+I),";;",2),TYPE=+$TR($P(I,U,2)," ")
"RTN","RORERR20",38,0)
 Q $S(TYPE>0:TYPE,1:6)
"RTN","RORERR20",39,0)
 ;
"RTN","RORERR20",40,0)
 ;***** LIST OF THE MESSAGES (THERE SHOULD BE NOTHING AFTER THE LIST!)
"RTN","RORERR20",41,0)
 ;
"RTN","RORERR20",42,0)
 ; The error codes are provided in the table only for clarity.
"RTN","RORERR20",43,0)
 ; Text of the messages are extracted using the $TEXT function and
"RTN","RORERR20",44,0)
 ; absolute values of the ERRCODE parameter.
"RTN","RORERR20",45,0)
 ;
"RTN","RORERR20",46,0)
 ; Message Type:
"RTN","RORERR20",47,0)
 ;               1  Debug          4  Warning
"RTN","RORERR20",48,0)
 ;               2  Information    5  Database Error
"RTN","RORERR20",49,0)
 ;               3  Data Quality   6  Error
"RTN","RORERR20",50,0)
 ;
"RTN","RORERR20",51,0)
MSGLIST ; Code Type  Message Text
"RTN","RORERR20",52,0)
 ;;  -1 ^ 6 ^ Cannot find a descriptor of the registry
"RTN","RORERR20",53,0)
 ;;  -2 ^ 6 ^ Duplicate registry names
"RTN","RORERR20",54,0)
 ;;  -3 ^ 6 ^ Cannot find a descriptor of the selection rule
"RTN","RORERR20",55,0)
 ;;  -4 ^ 6 ^ Duplicate rule names
"RTN","RORERR20",56,0)
 ;;  -5 ^ 6 ^ Circle rule references
"RTN","RORERR20",57,0)
 ;;  -6 ^ 6 ^ Invalid update entry point: |2|
"RTN","RORERR20",58,0)
 ;;  -7 ^ 6 ^ Field '|2|' not found
"RTN","RORERR20",59,0)
 ;;  -8 ^ 6 ^ Duplicate patients in the registry
"RTN","RORERR20",60,0)
 ;;  -9 ^ 5 ^ FileMan DBS call error(s)|2|
"RTN","RORERR20",61,0)
 ;; -10 ^ 6 ^ Bad registry name: '|2|'
"RTN","RORERR20",62,0)
 ;; -11 ^ 6 ^ Cannot lock the record(s) of |2|
"RTN","RORERR20",63,0)
 ;; -12 ^ 6 ^ Cannot load and prepare lab search data
"RTN","RORERR20",64,0)
 ;; -13 ^ 6 ^ Cannot lock the registries
"RTN","RORERR20",65,0)
 ;; -14 ^ 6 ^ Cannot prepare selection rules
"RTN","RORERR20",66,0)
 ;; -15 ^ 6 ^ Error(s) during processing of the patient data
"RTN","RORERR20",67,0)
 ;; -16 ^ 6 ^ Cannot update demographic data
"RTN","RORERR20",68,0)
 ;; -17 ^ 6 ^ Invalid entry point: '|2|'
"RTN","RORERR20",69,0)
 ;; -18 ^ 6 ^ Routine '|2|' does not exist
"RTN","RORERR20",70,0)
 ;; -19 ^ 6 ^ Cannot load the selection rules
"RTN","RORERR20",71,0)
 ;; -20 ^ 6 ^ Cannot sort the selection rules
"RTN","RORERR20",72,0)
 ;; -21 ^ 6 ^ Syntax error in the expression
"RTN","RORERR20",73,0)
 ;; -22 ^ 6 ^ Cannot prepare data extraction definitions
"RTN","RORERR20",74,0)
 ;; -23 ^ 6 ^ Cannot set up HL7 environment variables
"RTN","RORERR20",75,0)
 ;; -24 ^ 6 ^ Cannot send the batch HL7 message
"RTN","RORERR20",76,0)
 ;; -25 ^ 6 ^ No HL7 event driver protocol
"RTN","RORERR20",77,0)
 ;; -26 ^ 3 ^ Neither ICN nor SSN is available
"RTN","RORERR20",78,0)
 ;; -27 ^ 5 ^ Cannot obtain results of the Lab tests
"RTN","RORERR20",79,0)
 ;; -28 ^ 4 ^ No active registries to |2|!
"RTN","RORERR20",80,0)
 ;; -29 ^ 1 ^ Non-existent LOINC code |2| in the registry parameters
"RTN","RORERR20",81,0)
 ;; -30 ^ 5 ^ Duplicate records in the file #95.3 for LOINC code |2|
"RTN","RORERR20",82,0)
 ;; -31 ^ 4 ^ Cannot remove the patient #|1| from the pending list
"RTN","RORERR20",83,0)
 ;; -32 ^ 6 ^ Incorrect data extraction period: '|2|-|3|'
"RTN","RORERR20",84,0)
 ;; -33 ^ 6 ^ Cannot de-queue data extraction task
"RTN","RORERR20",85,0)
 ;; -34 ^ 6 ^ Cannot open an output file
"RTN","RORERR20",86,0)
 ;; -35 ^ 6 ^ Device Handler error
"RTN","RORERR20",87,0)
 ;; -36 ^ 6 ^ Cannot retrieve Patient details (DFN:|1|) from File #|2|
"RTN","RORERR20",88,0)
 ;; -37 ^ 6 ^ Cannot retrieve details of medication
"RTN","RORERR20",89,0)
 ;; -38 ^ 6 ^ Cannot retrieve CPT code
"RTN","RORERR20",90,0)
 ;; -39 ^ 6 ^ Duplicate HL7 message ID in the file #798: '|2|'
"RTN","RORERR20",91,0)
 ;; -40 ^ 6 ^ Undefined variable: '|2|'
"RTN","RORERR20",92,0)
 ;; -41 ^ 2 ^ Registry setup has been completed
"RTN","RORERR20",93,0)
 ;; -42 ^ 4 ^ Task has been interrupted by user or by parent task
"RTN","RORERR20",94,0)
 ;; -43 ^ 6 ^ Error during the |2|. See log files.
"RTN","RORERR20",95,0)
 ;; -44 ^ 6 ^ Invalid extraction entry point: '|2|'
"RTN","RORERR20",96,0)
 ;; -45 ^ 6 ^ Invalid or missing IEN of selection rule
"RTN","RORERR20",97,0)
 ;; -46 ^ 5 ^ Cannot load registry parameters
"RTN","RORERR20",98,0)
 ;; -47 ^ 5 ^ Cannot find the '|2|' drug class
"RTN","RORERR20",99,0)
 ;; -48 ^ 2 ^ Registry '|2|' is inactive
"RTN","RORERR20",100,0)
 ;; -49 ^ 4 ^ Cannot find HL7 message #|2| to check its status
"RTN","RORERR20",101,0)
 ;; -50 ^ 6 ^ Cannot create the '|2|' checkpoint!
"RTN","RORERR20",102,0)
 ;; -51 ^ 6 ^ Cannot complete the '|2|' checkpoint!
"RTN","RORERR20",103,0)
 ;; -52 ^ 6 ^ Cannot find HL7 message ID in the file #798: '|2|'
"RTN","RORERR20",104,0)
 ;; -53 ^ 6 ^ Cannot enable the '|2|' protocol
"RTN","RORERR20",105,0)
 ;; -54 ^ 6 ^ The '|2|' Lab Search is not defined
"RTN","RORERR20",106,0)
 ;; -55 ^ 4 ^ No indicators are defined for the '|2|' Lab Search
"RTN","RORERR20",107,0)
 ;; -56 ^ 6 ^ Error code '|2|' is returned by the '|3|'
"RTN","RORERR20",108,0)
 ;; -57 ^ 4 ^ Error code '|2|' is returned by the '|3|'
"RTN","RORERR20",109,0)
 ;; -58 ^ 6 ^ File '|2|' not found
"RTN","RORERR20",110,0)
 ;; -59 ^ 3 ^ ICN checksum is shorter than 6 digits
"RTN","RORERR20",111,0)
 ;; -60 ^ 6 ^ Subtask #|2| crashed (see TaskMan logs)
"RTN","RORERR20",112,0)
 ;; -61 ^ 6 ^ Cannot start the registry update in multitask mode
"RTN","RORERR20",113,0)
 ;; -62 ^ 2 ^ Registry Update subtask #|2| has been scheduled
"RTN","RORERR20",114,0)
 ;; -63 ^ 6 ^ Data search in file #|2| is not supported
"RTN","RORERR20",115,0)
 ;; -64 ^ 6 ^ Data element #|3| (file #|2|) is not supported
"RTN","RORERR20",116,0)
 ;; -65 ^ 6 ^ |4| value of element #|3| (file #|2|) is not supported
"RTN","RORERR20",117,0)
 ;; -66 ^ 1 ^ Patient was skipped due to counter in the file #798.3
"RTN","RORERR20",118,0)
 ;; -67 ^ 6 ^ CCR HL7 messages created |2| day(s) ago have not been sent yet.
"RTN","RORERR20",119,0)
 ;; -68 ^ 6 ^ Invalid header of the HL7 message (or no header at all)
"RTN","RORERR20",120,0)
 ;; -69 ^ 6 ^ Cannot find the data element
"RTN","RORERR20",121,0)
 ;; -70 ^ 6 ^ Duplicate names of the data element
"RTN","RORERR20",122,0)
 ;; -71 ^ 1 ^ User entered the "^"
"RTN","RORERR20",123,0)
 ;; -72 ^ 6 ^ Timeout
"RTN","RORERR20",124,0)
 ;; -73 ^ 4 ^ HL7 message #|2| is being processed/transmitted
"RTN","RORERR20",125,0)
 ;; -74 ^ 6 ^ Number of messages in the batch does not match the BTS
"RTN","RORERR20",126,0)
 ;; -75 ^ 6 ^ Not all four HL7 encoding characters are defined
"RTN","RORERR20",127,0)
 ;; -76 ^ 6 ^ The [|2|] option must not be running during installation
"RTN","RORERR20",128,0)
 ;; -77 ^ 6 ^ Cannot create MailMan message stub
"RTN","RORERR20",129,0)
 ;; -78 ^ 6 ^ Scheduled subtasks have not been started by TaskMan
"RTN","RORERR20",130,0)
 ;; -79 ^ 6 ^ Missing or dangling pointer
"RTN","RORERR20",131,0)
 ;; -80 ^ 6 ^ Cannot find a list item (file #799.1)
"RTN","RORERR20",132,0)
 ;; -81 ^ 6 ^ Duplicate item codes (file #799.1)
"RTN","RORERR20",133,0)
 ;; -82 ^ 6 ^ The task '|2|' cannot be scheduled at '|3|'
"RTN","RORERR20",134,0)
 ;; -83 ^ 6 ^ Cannot find the task #|2| in the ROR TASK file
"RTN","RORERR20",135,0)
 ;; -84 ^ 6 ^ The task #|2| has not responded on the stop request yet
"RTN","RORERR20",136,0)
 ;; -85 ^ 6 ^ Invalid task number: '|2|'
"RTN","RORERR20",137,0)
 ;; -86 ^ 6 ^ Cannot find report parameters (file #799.34)
"RTN","RORERR20",138,0)
 ;; -87 ^ 6 ^ Duplicate report parameters (file #799.34)
"RTN","RORERR20",139,0)
 ;; -88 ^ 6 ^ Parameter |2| has an invalid value: '|3|'
"RTN","RORERR20",140,0)
 ;; -89 ^ 2 ^ No output file has been created
"RTN","RORERR20",141,0)
 ;; -90 ^ 2 ^ The patient has been deleted from the |2| registry
"RTN","RORERR20",142,0)
 ;; -91 ^ 6 ^ Illegal attempt to access the registries from the GUI
"RTN","RORERR20",143,0)
 ;; -92 ^ 6 ^ Cannot re-queue unsent batch HL7 message #|2|
"RTN","RORERR20",144,0)
 ;; -93 ^ 4 ^ Batch HL7 message #|2| has been re-queued
"RTN","RORERR20",145,0)
 ;; -94 ^ 2 ^ Data Extraction task #|2| has been scheduled
"RTN","RORERR20",146,0)
 ;; -95 ^ 3 ^ Invalid value. File: #|2|; IENS: "|3|"; Field(s): |4|
"RTN","RORERR20",147,0)
 ;; -96 ^ 6 ^ Cannot rename the '|2|' security key to '|3|'
"RTN","RORERR20",148,0)
 ;; -97 ^ 6 ^ The patient is not in the |2|
"RTN","RORERR20",149,0)
 ;; -98 ^ 6 ^ Cannot get closed root name of file #|2| (IENS: |3|)
"RTN","RORERR20",150,0)
 ;; -99 ^ 1 ^ FileMan DBS call error(s)|2|
"RTN","RORERR20",151,0)
 ;;-100 ^ 3 ^ |2| was returned by the |3|
"RTN","RORERR20",152,0)
 ;;-101 ^ 2 ^ Your CCR task #|2| has finished (|3|)
"RTN","RORERR20",153,0)
 ;;-102 ^ 5 ^ Invalid or missing record in the |2| file (IEN: |3|)
"RTN","RORERR20",154,0)
 ;;-103 ^ 6 ^ The registry |2| has not been populated yet.
"RTN","RORERR20",155,0)
 ;;-104 ^ 4 ^ XML parsing warning
"RTN","RORERR20",156,0)
 ;;-105 ^ 6 ^ XML parsing error
"RTN","RORERR20",157,0)
 ;;-106 ^ 6 ^ Error(s) during parsing the report parameters
"RTN","RORERR20",158,0)
 ;;-107 ^ 6 ^ Incompatible version of the GUI
"RTN","RORERR20",159,0)
 ;;-108 ^ 2 ^ Backpull parameters have been loaded.
"RTN","RORERR20",160,0)
 ;;-109 ^ 2 ^ Automatic backpull has been completed.
"RTN","RORERR20",161,0)
 ;;-110 ^ 5 ^ Pointer(s) in the restored data cannot be resolved.
"RTN","RORERR20",162,0)
 ;;-111 ^ 2 ^ Patient "merge" from DFN #|2| to DFN #|3|.
"RTN","ROREVT01")
0^34^B5877686
"RTN","ROREVT01",1,0)
ROREVT01 ;HCIOFO/SG - EVENT PROTOCOLS  ; 6/9/03 1:50pm
"RTN","ROREVT01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","ROREVT01",3,0)
 ;
"RTN","ROREVT01",4,0)
 ; This routine uses the following IAs:
"RTN","ROREVT01",5,0)
 ;
"RTN","ROREVT01",6,0)
 ; #1181         Subscription to the DGPM MOVEMENT EVENT protocol
"RTN","ROREVT01",7,0)
 ; #1298         Subscription to the PXK VISIT DATA EVENT protocol
"RTN","ROREVT01",8,0)
 ; #3565         Subscription to the LR7O ALL EVSEND RESULTS protocol
"RTN","ROREVT01",9,0)
 ;
"RTN","ROREVT01",10,0)
 Q
"RTN","ROREVT01",11,0)
 ;
"RTN","ROREVT01",12,0)
 ;***** 'ROR EVENT LAB' PROTOCOL IMPLEMENTATION (DATA AREA #1)
"RTN","ROREVT01",13,0)
LAB ;
"RTN","ROREVT01",14,0)
 Q:$G(OREMSG)=""
"RTN","ROREVT01",15,0)
 N BUF,DATE,DONE,FS,I,PATIEN
"RTN","ROREVT01",16,0)
 S I="",DONE="00"
"RTN","ROREVT01",17,0)
 F  S I=$O(@OREMSG@(I))  Q:I=""  D  Q:DONE="11"
"RTN","ROREVT01",18,0)
 . S BUF=$G(@OREMSG@(I))
"RTN","ROREVT01",19,0)
 . ;--- Get the HL7 field separator
"RTN","ROREVT01",20,0)
 . I $G(FS)=""  S:$E(BUF,1,3)="MSH" FS=$E(BUF,4)  Q:$G(FS)=""
"RTN","ROREVT01",21,0)
 . ;--- Get the patient IEN
"RTN","ROREVT01",22,0)
 . I $P(BUF,FS)="PID"  D:'$E(DONE,1)  Q
"RTN","ROREVT01",23,0)
 . . S PATIEN=+$P(BUF,FS,4)              ; PID-3
"RTN","ROREVT01",24,0)
 . . S:PATIEN>0 $E(DONE,1)="1"
"RTN","ROREVT01",25,0)
 . ;--- Get the specimen date
"RTN","ROREVT01",26,0)
 . I $P(BUF,FS)="OBR"  D:'$E(DONE,2)  Q
"RTN","ROREVT01",27,0)
 . . S DATE=$$HL7TFM^XLFDT($P(BUF,FS,8)) ; OBR-7
"RTN","ROREVT01",28,0)
 . . S $E(DONE,2)="1"
"RTN","ROREVT01",29,0)
 ;--- Create the event reference
"RTN","ROREVT01",30,0)
 S:DONE="11" I=$$ADD^RORUPP02(PATIEN,1,DATE)
"RTN","ROREVT01",31,0)
 Q
"RTN","ROREVT01",32,0)
 ;
"RTN","ROREVT01",33,0)
 ;***** RETURNS THE LIST OF PACKAGE EVENT PROTOCOLS
"RTN","ROREVT01",34,0)
 ;
"RTN","ROREVT01",35,0)
 ; .EPLST        Reference to a local variable. The list of
"RTN","ROREVT01",36,0)
 ;               package event protocols will be returned via
"RTN","ROREVT01",37,0)
 ;               this parameter: EPLST(ProtocolName)=""
"RTN","ROREVT01",38,0)
 ;
"RTN","ROREVT01",39,0)
LIST(EPLST) ;
"RTN","ROREVT01",40,0)
 K EPLST
"RTN","ROREVT01",41,0)
 S EPLST("ROR EVENT LAB")=""
"RTN","ROREVT01",42,0)
 S EPLST("ROR EVENT PTF")=""
"RTN","ROREVT01",43,0)
 S EPLST("ROR EVENT VISIT")=""
"RTN","ROREVT01",44,0)
 Q
"RTN","ROREVT01",45,0)
 ;
"RTN","ROREVT01",46,0)
 ;***** 'ROR EVENT PTF' PROTOCOL IMPLEMENTATION (DATA AREA #3)
"RTN","ROREVT01",47,0)
PTF ;
"RTN","ROREVT01",48,0)
 N ADATE,IEN405,PATIEN,PDATE,RC,TRC
"RTN","ROREVT01",49,0)
 S PATIEN=$P($G(DGPMA),"^",3)  Q:PATIEN'>0
"RTN","ROREVT01",50,0)
 ;--- Admissions, transfers and discharges
"RTN","ROREVT01",51,0)
 F TRC=1,2,3  D
"RTN","ROREVT01",52,0)
 . S IEN405=0
"RTN","ROREVT01",53,0)
 . F  S IEN405=$O(^UTILITY("DGPM",$J,TRC,IEN405))  Q:IEN405'>0  D
"RTN","ROREVT01",54,0)
 . . S PDATE=$P($G(^UTILITY("DGPM",$J,TRC,IEN405,"P")),"^")
"RTN","ROREVT01",55,0)
 . . S ADATE=$P($G(^UTILITY("DGPM",$J,TRC,IEN405,"A")),"^")
"RTN","ROREVT01",56,0)
 . . I PDATE>0               S RC=$$ADD^RORUPP02(PATIEN,3,PDATE)
"RTN","ROREVT01",57,0)
 . . I ADATE>0  S:ADATE'=PDATE RC=$$ADD^RORUPP02(PATIEN,3,ADATE)
"RTN","ROREVT01",58,0)
 Q
"RTN","ROREVT01",59,0)
 ;
"RTN","ROREVT01",60,0)
 ;***** 'ROR EVENT VISIT' PROTOCOL IMPLEMENTATION (DATA AREA #2)
"RTN","ROREVT01",61,0)
VISIT ;
"RTN","ROREVT01",62,0)
 N BUF,IEN,PATIEN,RC,VSIEN
"RTN","ROREVT01",63,0)
 S VSIEN=""
"RTN","ROREVT01",64,0)
 F  S VSIEN=$O(^TMP("PXKCO",$J,VSIEN))  Q:VSIEN=""  D
"RTN","ROREVT01",65,0)
 . S IEN=""
"RTN","ROREVT01",66,0)
 . F  S IEN=$O(^TMP("PXKCO",$J,VSIEN,"VST",IEN))  Q:IEN=""  D
"RTN","ROREVT01",67,0)
 . . S BUF=$G(^TMP("PXKCO",$J,VSIEN,"VST",IEN,0,"AFTER"))
"RTN","ROREVT01",68,0)
 . . S PATIEN=$P(BUF,"^",5)  Q:(PATIEN'>0)!$P(BUF,"^",11)
"RTN","ROREVT01",69,0)
 . . ;--- Create the event reference
"RTN","ROREVT01",70,0)
 . . S RC=$$ADD^RORUPP02(PATIEN,2,$P(BUF,"^",2))
"RTN","ROREVT01",71,0)
 Q
"RTN","ROREXPR")
0^35^B25327319
"RTN","ROREXPR",1,0)
ROREXPR ;HCIOFO/SG - PREPARATION FOR DATA EXTRACTION  ; 11/2/05 8:56am
"RTN","ROREXPR",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","ROREXPR",3,0)
 ;
"RTN","ROREXPR",4,0)
 Q
"RTN","ROREXPR",5,0)
 ;
"RTN","ROREXPR",6,0)
 ;***** PREPARES VARIABLES FOR DATA EXTRACTION
"RTN","ROREXPR",7,0)
 ;
"RTN","ROREXPR",8,0)
 ; .REGLST       Reference to a local array containing registry
"RTN","ROREXPR",9,0)
 ;               names as subscripts and registry IENs as values
"RTN","ROREXPR",10,0)
 ;
"RTN","ROREXPR",11,0)
 ; [DXBEG]       Data extraction start date (individual start
"RTN","ROREXPR",12,0)
 ;               date for each patient by default).
"RTN","ROREXPR",13,0)
 ;               Time part of the parameter value is ignored.
"RTN","ROREXPR",14,0)
 ;
"RTN","ROREXPR",15,0)
 ; [DXEND]       Data extraction end date (TODAY by default)
"RTN","ROREXPR",16,0)
 ;               Time part of the parameter value is ignored.
"RTN","ROREXPR",17,0)
 ;
"RTN","ROREXPR",18,0)
 ; DXBEG and DXEND parameters may be used only for historical data
"RTN","ROREXPR",19,0)
 ; extraction. Use of these parameters for regular data extraction
"RTN","ROREXPR",20,0)
 ; process will negatively affect the package!
"RTN","ROREXPR",21,0)
 ;
"RTN","ROREXPR",22,0)
 ; This function does not kill the ROREXT("DTAR") node! It just adds
"RTN","ROREXPR",23,0)
 ; missing data areas to those that are already present in the list.
"RTN","ROREXPR",24,0)
 ;
"RTN","ROREXPR",25,0)
 ; Data extraction parameters are aggregated from individual
"RTN","ROREXPR",26,0)
 ; registry parameters as follow:
"RTN","ROREXPR",27,0)
 ;
"RTN","ROREXPR",28,0)
 ;   EXTRACT PERIOD FOR NEW PATIENT  Maximum
"RTN","ROREXPR",29,0)
 ;   LAG DAYS                        Maximum
"RTN","ROREXPR",30,0)
 ;   EXTRACTED RESULT                Union
"RTN","ROREXPR",31,0)
 ;   MAXIMUM MESSAGE SIZE            Minimum
"RTN","ROREXPR",32,0)
 ;
"RTN","ROREXPR",33,0)
 ; Return Values:
"RTN","ROREXPR",34,0)
 ;        0  Ok
"RTN","ROREXPR",35,0)
 ;       <0  Error code
"RTN","ROREXPR",36,0)
 ;
"RTN","ROREXPR",37,0)
PREPARE(REGLST,DXBEG,DXEND) ;
"RTN","ROREXPR",38,0)
 N I,IL,IR,LOINC,NODE,RC,REGIEN,REGNAME,RORBUF,RORMSG,TMP,VAL
"RTN","ROREXPR",39,0)
 K RORLRC
"RTN","ROREXPR",40,0)
 F TMP="DXBEG","HDTIEN","LD","MAXHL7SIZE","PATCH"  K ROREXT(TMP)
"RTN","ROREXPR",41,0)
 S DXBEG=$G(DXBEG)\1,DXEND=$G(DXEND)\1
"RTN","ROREXPR",42,0)
 ;
"RTN","ROREXPR",43,0)
 ;=== Data areas
"RTN","ROREXPR",44,0)
 S NODE=$$ROOT^DILFD(799.33,,1)
"RTN","ROREXPR",45,0)
 ;--- Validate the existing list
"RTN","ROREXPR",46,0)
 S IR=0
"RTN","ROREXPR",47,0)
 F  S IR=$O(ROREXT("DTAR",IR))  Q:IR'>0  D
"RTN","ROREXPR",48,0)
 . I '$D(@NODE@(IR))  K ROREXT("DTAR",IR)  Q
"RTN","ROREXPR",49,0)
 . S TMP=$G(ROREXT("DTAR",IR))
"RTN","ROREXPR",50,0)
 . S:TMP>0 ROREXT("DTAR",IR)=($P(TMP,U)\1)_U_($P(TMP,U,2)\1)
"RTN","ROREXPR",51,0)
 ;--- Add remaining data areas
"RTN","ROREXPR",52,0)
 S IR=0
"RTN","ROREXPR",53,0)
 F  S IR=$O(@NODE@(IR))  Q:IR'>0  D:'$D(ROREXT("DTAR",IR))
"RTN","ROREXPR",54,0)
 . S ROREXT("DTAR",IR)=""
"RTN","ROREXPR",55,0)
 ;
"RTN","ROREXPR",56,0)
 ;=== Main data extraction time frame
"RTN","ROREXPR",57,0)
 S ROREXT("DXEND")=$S(DXEND>0:DXEND,1:$$DT^XLFDT)
"RTN","ROREXPR",58,0)
 I DXBEG>0  S RC=0  D  Q:RC<0 RC
"RTN","ROREXPR",59,0)
 . S ROREXT("DXBEG")=DXBEG  Q:DXBEG'>ROREXT("DXEND")
"RTN","ROREXPR",60,0)
 . S RC=$$ERROR^RORERR(-32,,,,DXBEG,ROREXT("DXEND"))
"RTN","ROREXPR",61,0)
 ;
"RTN","ROREXPR",62,0)
 ;=== Check if the critical patches are installed
"RTN","ROREXPR",63,0)
 F TMP="MD*1.0*1","MC*2.3*34","GMPL*2*30"  D
"RTN","ROREXPR",64,0)
 . S:$$PATCH^XPDUTL(TMP) ROREXT("PATCH",TMP)=""
"RTN","ROREXPR",65,0)
 ;
"RTN","ROREXPR",66,0)
 ;=== Get the package version and the latest patch info
"RTN","ROREXPR",67,0)
 S TMP="CLINICAL CASE REGISTRIES"
"RTN","ROREXPR",68,0)
 S ROREXT("VERSION")=$$VERSION^XPDUTL(TMP)
"RTN","ROREXPR",69,0)
 S TMP=$$LAST^XPDUTL(TMP)  D:TMP>0
"RTN","ROREXPR",70,0)
 . S $P(ROREXT("VERSION"),U,2)=+TMP
"RTN","ROREXPR",71,0)
 . S $P(ROREXT("VERSION"),U,3)=$P(TMP,U,2)
"RTN","ROREXPR",72,0)
 ;
"RTN","ROREXPR",73,0)
 ;=== Aggregate registry parameters
"RTN","ROREXPR",74,0)
 S REGNAME="",RC=0
"RTN","ROREXPR",75,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:RC<0
"RTN","ROREXPR",76,0)
 . ;--- Get the registry IEN and parameters
"RTN","ROREXPR",77,0)
 . S REGIEN=$$REGIEN^RORUTL02(REGNAME,"7;10;13;13.1;15.1",.RORBUF)
"RTN","ROREXPR",78,0)
 . I REGIEN<0  S RC=REGIEN  Q
"RTN","ROREXPR",79,0)
 . ;--- Extract Period for New Patient
"RTN","ROREXPR",80,0)
 . S VAL=+$G(RORBUF("DILIST","ID",1,7))
"RTN","ROREXPR",81,0)
 . S:VAL>$G(ROREXT("EXTRDAYS")) ROREXT("EXTRDAYS")=VAL
"RTN","ROREXPR",82,0)
 . ;--- Setup the message builder call-back entry point
"RTN","ROREXPR",83,0)
 . S VAL=$$TRIM^XLFSTR($G(RORBUF("DILIST","ID",1,10)))
"RTN","ROREXPR",84,0)
 . I VAL'=""  D  Q:RC<0
"RTN","ROREXPR",85,0)
 . . S RC=$$VERIFYEP^RORUTL01(VAL)
"RTN","ROREXPR",86,0)
 . . I RC<0  D ERROR^RORERR(-44,,REGNAME,,VAL)  Q
"RTN","ROREXPR",87,0)
 . . S ROREXT("MSGBLD",REGIEN)=VAL
"RTN","ROREXPR",88,0)
 . ;--- Use the first available HL7 event protocol if it has not
"RTN","ROREXPR",89,0)
 . ;--- been defined before calling the $$PREPARE^ROREXPR
"RTN","ROREXPR",90,0)
 . D:$G(ROREXT("HL7PROT"))=""
"RTN","ROREXPR",91,0)
 . . S ROREXT("HL7PROT")=$G(RORBUF("DILIST","ID",1,13))
"RTN","ROREXPR",92,0)
 . ;--- Load maximum message size and convert it into bytes
"RTN","ROREXPR",93,0)
 . ;--- (1 Megabyte = 1024 Kb = 1024 * 1024 = 1048576 bytes)
"RTN","ROREXPR",94,0)
 . S VAL=($G(RORBUF("DILIST","ID",1,13.1))*1048576)\1
"RTN","ROREXPR",95,0)
 . I VAL>0  D  S:(TMP'>0)!(VAL<TMP) ROREXT("MAXHL7SIZE")=VAL
"RTN","ROREXPR",96,0)
 . . S TMP=+$G(ROREXT("MAXHL7SIZE"))
"RTN","ROREXPR",97,0)
 . ;--- Setup the lag interval (for regular data extraction only)
"RTN","ROREXPR",98,0)
 . D:'$G(ROREXT("DXBEG"))
"RTN","ROREXPR",99,0)
 . . S VAL=+$G(RORBUF("DILIST","ID",1,15.1))
"RTN","ROREXPR",100,0)
 . . S:VAL>$G(ROREXT("LD",1)) ROREXT("LD",1)=VAL
"RTN","ROREXPR",101,0)
 . ;--- Load list of codes of extracted Lab results
"RTN","ROREXPR",102,0)
 . I $G(RORLRC)'="*"  D  Q:RC<0
"RTN","ROREXPR",103,0)
 . . S TMP=","_REGIEN_","
"RTN","ROREXPR",104,0)
 . . D LIST^DIC(798.112,TMP,"@;.01;.02;.03","U",,,,"B",,,,"RORMSG")
"RTN","ROREXPR",105,0)
 . . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,,798.112,TMP)  Q
"RTN","ROREXPR",106,0)
 . . Q:$G(^TMP("DILIST",$J,0))'>0
"RTN","ROREXPR",107,0)
 . . S (IL,IR,RC)=0
"RTN","ROREXPR",108,0)
 . . F  S IR=$O(^TMP("DILIST",$J,"ID",IR))  Q:IR=""  D  Q:RC
"RTN","ROREXPR",109,0)
 . . . S LOINC=$G(^TMP("DILIST",$J,"ID",IR,.01))
"RTN","ROREXPR",110,0)
 . . . ;--- All results or list of subscripts
"RTN","ROREXPR",111,0)
 . . . I LOINC="*"  D  S RC=1  Q
"RTN","ROREXPR",112,0)
 . . . . S VAL=$G(^TMP("DILIST",$J,"ID",IR,.03))
"RTN","ROREXPR",113,0)
 . . . . I VAL=""         K RORLRC  S RORLRC="*"  Q
"RTN","ROREXPR",114,0)
 . . . . I $G(RORLRC)=""  K RORLRC  S RORLRC=VAL  Q
"RTN","ROREXPR",115,0)
 . . . . F I=1:1  S TMP=$P(RORLRC,",",I)  Q:(TMP="")!(TMP=VAL)
"RTN","ROREXPR",116,0)
 . . . . S:TMP="" RORLRC=RORLRC_","_VAL
"RTN","ROREXPR",117,0)
 . . . ;--- Ignore individual codes if any subscripts
"RTN","ROREXPR",118,0)
 . . . ;--- (CH, MI, etc.) have been requested already
"RTN","ROREXPR",119,0)
 . . . Q:$G(RORLRC)'=""
"RTN","ROREXPR",120,0)
 . . . ;--- LOINC
"RTN","ROREXPR",121,0)
 . . . I LOINC>0  D  Q:RC<0  S IL=IL+1,RORLRC(IL)=TMP_"^LN"
"RTN","ROREXPR",122,0)
 . . . . S TMP=$$LNCODE^RORUTL02(LOINC)  S:TMP<0 RC=TMP
"RTN","ROREXPR",123,0)
 . . . ;--- NLT
"RTN","ROREXPR",124,0)
 . . . S TMP=$G(^TMP("DILIST",$J,"ID",IR,.02))
"RTN","ROREXPR",125,0)
 . . . S:TMP>0 IL=IL+1,RORLRC(IL)=TMP_"^NLT"
"RTN","ROREXPR",126,0)
 D CLEAN^DILF
"RTN","ROREXPR",127,0)
 K ^TMP("DILIST",$J)
"RTN","ROREXPR",128,0)
 Q:RC<0 RC
"RTN","ROREXPR",129,0)
 ;
"RTN","ROREXPR",130,0)
 ;=== Validate parameters
"RTN","ROREXPR",131,0)
 I '$G(ROREXT("DXBEG"))  S:$G(ROREXT("LD",1))'>0 ROREXT("LD",1)=1
"RTN","ROREXPR",132,0)
 ;
"RTN","ROREXPR",133,0)
 ;=== Check the HL7 parameters
"RTN","ROREXPR",134,0)
 I $G(ROREXT("HL7PROT"))'=""  D  Q:RC<0 RC
"RTN","ROREXPR",135,0)
 . S RC=$$INIT^RORHL7()
"RTN","ROREXPR",136,0)
 ;
"RTN","ROREXPR",137,0)
 ;=== Success
"RTN","ROREXPR",138,0)
 Q 0
"RTN","ROREXT")
0^36^B24189218
"RTN","ROREXT",1,0)
ROREXT ;HCIOFO/SG - DATA EXTRACTION & TRANSMISSION ; 11/1/05 3:08pm
"RTN","ROREXT",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","ROREXT",3,0)
 ;
"RTN","ROREXT",4,0)
 ; ROREXT -------------- DATA EXTRACTION DESCRIPTOR
"RTN","ROREXT",5,0)
 ;
"RTN","ROREXT",6,0)
 ; ROREXT("DTAR",        Data is extracted only in those areas that
"RTN","ROREXT",7,0)
 ;                       are listed here. If a data area time frame
"RTN","ROREXT",8,0)
 ;                       is provided, then it is merged with the
"RTN","ROREXT",9,0)
 ;                       regular time frame(s) for that area.
"RTN","ROREXT",10,0)
 ;   DataArea)           "" or Data Area Time Frame
"RTN","ROREXT",11,0)
 ;                         ^01: Start Date (FileMan)
"RTN","ROREXT",12,0)
 ;                         ^02: End Date   (FileMan)
"RTN","ROREXT",13,0)
 ;
"RTN","ROREXT",14,0)
 ; ROREXT("DXBEG")       Start date of the data extraction (opt'l)
"RTN","ROREXT",15,0)
 ;                       If this node is defined and greater than
"RTN","ROREXT",16,0)
 ;                       zero, data extraction starts from this date
"RTN","ROREXT",17,0)
 ;                       (instead of individual start date for each
"RTN","ROREXT",18,0)
 ;                       patient in the registry).
"RTN","ROREXT",19,0)
 ;
"RTN","ROREXT",20,0)
 ; ROREXT("DXEND")       End date of the data extraction
"RTN","ROREXT",21,0)
 ;                       (these nodes are set by $$PREPARE^ROREXPR).
"RTN","ROREXT",22,0)
 ;
"RTN","ROREXT",23,0)
 ; ROREXT("EXTRDAYS")    Extraction period for a new patient
"RTN","ROREXT",24,0)
 ;
"RTN","ROREXT",25,0)
 ; ROREXT("FLAGS")       Flags to control processing (see the
"RTN","ROREXT",26,0)
 ;                       TASK^ROR for possible values).
"RTN","ROREXT",27,0)
 ;
"RTN","ROREXT",28,0)
 ; ROREXT("HDTIEN")      When a historical data extraction is
"RTN","ROREXT",29,0)
 ;                       performed, this node stores IEN of
"RTN","ROREXT",30,0)
 ;                       the record of the ROR HISTORICAL DATA
"RTN","ROREXT",31,0)
 ;                       EXTRACTION file (#799.6).
"RTN","ROREXT",32,0)
 ;
"RTN","ROREXT",33,0)
 ; ROREXT("HL7BUF")      Closed root of the buffer where the HL7
"RTN","ROREXT",34,0)
 ;                       message is constructed. By default, the
"RTN","ROREXT",35,0)
 ;                       ^TMP("HLS",$J) is used.
"RTN","ROREXT",36,0)
 ;
"RTN","ROREXT",37,0)
 ; ROREXT("HL7CNT")      Counter of the messages in the batch
"RTN","ROREXT",38,0)
 ; ROREXT("HL7DT")       Date of the batch message creation (FileMan)
"RTN","ROREXT",39,0)
 ; ROREXT("HL7MID")      Message ID of the "stub" message
"RTN","ROREXT",40,0)
 ; ROREXT("HL7MTIEN")    IEN in the File #772 for the "stub" message
"RTN","ROREXT",41,0)
 ; ROREXT("HL7PROT")     Name of the event driver protocol
"RTN","ROREXT",42,0)
 ;
"RTN","ROREXT",43,0)
 ; ROREXT("HL7PTR")      Subscript of the last occupied sub-node of
"RTN","ROREXT",44,0)
 ;                       the message buffer (see the "HL7BUF").
"RTN","ROREXT",45,0)
 ;                       Value of the variable is incremented before
"RTN","ROREXT",46,0)
 ;                       storing the segment.
"RTN","ROREXT",47,0)
 ;
"RTN","ROREXT",48,0)
 ; ROREXT("HL7SID",
"RTN","ROREXT",49,0)
 ;   SegName)            The next value of the Set ID for this kind
"RTN","ROREXT",50,0)
 ;                       of segments. The $$CREATE^RORHL7 function
"RTN","ROREXT",51,0)
 ;                       resets the Set ID's to 1 for all supported
"RTN","ROREXT",52,0)
 ;                       segments.
"RTN","ROREXT",53,0)
 ;
"RTN","ROREXT",54,0)
 ; ROREXT("HL7SIZE")     Current size of the HL7 batch
"RTN","ROREXT",55,0)
 ;                         ^1: Current size (in bytes)
"RTN","ROREXT",56,0)
 ;                         ^2: 1 if maximum size has been reached
"RTN","ROREXT",57,0)
 ;
"RTN","ROREXT",58,0)
 ; ROREXT("LD",
"RTN","ROREXT",59,0)
 ;   1)                  Number of lag days for the data extraction
"RTN","ROREXT",60,0)
 ;
"RTN","ROREXT",61,0)
 ; ROREXT("MAXHL7SIZE")  Maximum size (in bytes) of an HL7 message
"RTN","ROREXT",62,0)
 ;
"RTN","ROREXT",63,0)
 ; ROREXT("MSGBLD",
"RTN","ROREXT",64,0)
 ;   RegIEN)             Message builder call-back entry point (opt'l)
"RTN","ROREXT",65,0)
 ;
"RTN","ROREXT",66,0)
 ; ROREXT("NBM")         Number of batch messages generated for
"RTN","ROREXT",67,0)
 ;                       the current protocol
"RTN","ROREXT",68,0)
 ;
"RTN","ROREXT",69,0)
 ; ROREXT("PATCH",
"RTN","ROREXT",70,0)
 ;   PatchName)          Defined if the patch is installed
"RTN","ROREXT",71,0)
 ;
"RTN","ROREXT",72,0)
 ; ROREXT("SUSPEND")     DATA EXTRACTION SUSPENSION PARAMETERS
"RTN","ROREXT",73,0)
 ;                         ^1: Suspension start time (FileMan)
"RTN","ROREXT",74,0)
 ;                         ^2: Suspension end time (FileMan)
"RTN","ROREXT",75,0)
 ;
"RTN","ROREXT",76,0)
 ;                       For example, to suspend the data extraction
"RTN","ROREXT",77,0)
 ;                       from 7:00 until 18:00 this node should have
"RTN","ROREXT",78,0)
 ;                       the following value: ".07^.18".
"RTN","ROREXT",79,0)
 ;
"RTN","ROREXT",80,0)
 ; ROREXT("VERSION")     ROR version/patch installed at the site
"RTN","ROREXT",81,0)
 ;                         ^1: Version number (e.g. 1.0)
"RTN","ROREXT",82,0)
 ;                         ^2: Latest patch number (e.g. 5)
"RTN","ROREXT",83,0)
 ;                         ^3: Patch installation date (FileMan)
"RTN","ROREXT",84,0)
 ;
"RTN","ROREXT",85,0)
 ; RORHL --------------- HL7 ENVIRONMENT VARIABLES
"RTN","ROREXT",86,0)
 ;
"RTN","ROREXT",87,0)
 ; RORHL                 This local array contains HL7 environment
"RTN","ROREXT",88,0)
 ;                       variables initialized by INIT^HLFNC2 ("FS",
"RTN","ROREXT",89,0)
 ;                       "ECH" and others).
"RTN","ROREXT",90,0)
 ;
"RTN","ROREXT",91,0)
 ; RORLRC -------------- LIST OF EXTRACTED LAB RESULTS
"RTN","ROREXT",92,0)
 ;
"RTN","ROREXT",93,0)
 ; RORLRC(               Either a list of codes of a Lab results to
"RTN","ROREXT",94,0)
 ;                       extract or "*" for all results (see the LA7SC
"RTN","ROREXT",95,0)
 ;                       parameter of the GCPR^LA7QRY entry point)
"RTN","ROREXT",96,0)
 ;   Seq#)               Lab result code
"RTN","ROREXT",97,0)
 ;                         ^1: Result code
"RTN","ROREXT",98,0)
 ;                         ^2: Coding system ("LN" or "NLT")
"RTN","ROREXT",99,0)
 ;
"RTN","ROREXT",100,0)
 Q
"RTN","ROREXT",101,0)
 ;
"RTN","ROREXT",102,0)
 ;***** PERFORMS THE DATA EXTRACTION
"RTN","ROREXT",103,0)
 ;
"RTN","ROREXT",104,0)
 ; .REGLST       Reference to a local array containing registry
"RTN","ROREXT",105,0)
 ;               names as subscripts and registry IENs as values
"RTN","ROREXT",106,0)
 ;
"RTN","ROREXT",107,0)
 ; [DXBEG]       Data extraction start date (individual start
"RTN","ROREXT",108,0)
 ;               date for each patient by default).
"RTN","ROREXT",109,0)
 ;               Time part of the parameter value is ignored.
"RTN","ROREXT",110,0)
 ;
"RTN","ROREXT",111,0)
 ; [SUSPEND]     Subtask suspension parameters:
"RTN","ROREXT",112,0)
 ;               See description of the ROREXT("SUSPEND") node
"RTN","ROREXT",113,0)
 ;               for details.
"RTN","ROREXT",114,0)
 ;
"RTN","ROREXT",115,0)
 ; [FLAGS]       Flags to control processing.
"RTN","ROREXT",116,0)
 ;               See description of the TASK^ROR for
"RTN","ROREXT",117,0)
 ;               possible values of the flags.
"RTN","ROREXT",118,0)
 ;
"RTN","ROREXT",119,0)
 ; Return Values:
"RTN","ROREXT",120,0)
 ;       <0  Error code (see MSGLIST^RORERR20)
"RTN","ROREXT",121,0)
 ;        0  Ok
"RTN","ROREXT",122,0)
 ;
"RTN","ROREXT",123,0)
EXTRACT(REGLST,DXBEG,SUSPEND,FLAGS) ;
"RTN","ROREXT",124,0)
 N ROREXT        ; Data extraction descriptor
"RTN","ROREXT",125,0)
 N ROREXTSV      ; Backup copy of the descriptor
"RTN","ROREXT",126,0)
 ;
"RTN","ROREXT",127,0)
 N CNT,ERRCNT,PGRLST,RC,REGIEN,REGNAME,RORGLST,RORMSG,RORPROT,TMP,ZTDESC,ZTDTH,ZTRTN,ZTSAVE
"RTN","ROREXT",128,0)
 D CLEAR^RORERR("EXTRACT^ROREXT")
"RTN","ROREXT",129,0)
 S (ERRCNT,RC)=0
"RTN","ROREXT",130,0)
 ;
"RTN","ROREXT",131,0)
 ;=== Prepare the common parameters
"RTN","ROREXT",132,0)
 S:$G(DXBEG)>0 ROREXT("DXBEG")=DXBEG
"RTN","ROREXT",133,0)
 S ROREXT("FLAGS")=$$UP^XLFSTR($G(FLAGS))
"RTN","ROREXT",134,0)
 ;--- Enable task suspension if requested
"RTN","ROREXT",135,0)
 I $G(SUSPEND)>0  S:ROREXT("FLAGS")["X" ROREXT("SUSPEND")=SUSPEND
"RTN","ROREXT",136,0)
 ;
"RTN","ROREXT",137,0)
 ;=== Group the registries by the HL7 protocol name
"RTN","ROREXT",138,0)
 S REGNAME=""
"RTN","ROREXT",139,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D
"RTN","ROREXT",140,0)
 . ;--- Get the registry IEN
"RTN","ROREXT",141,0)
 . S REGIEN=+REGLST(REGNAME)
"RTN","ROREXT",142,0)
 . I REGIEN'>0  D  Q:REGIEN'>0
"RTN","ROREXT",143,0)
 . . S REGIEN=$$REGIEN^RORUTL02(REGNAME)
"RTN","ROREXT",144,0)
 . ;--- Get the HL7 protocol name
"RTN","ROREXT",145,0)
 . S RORPROT=$$GET1^DIQ(798.1,REGIEN_",",13,"E",,"RORMSG")
"RTN","ROREXT",146,0)
 . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,798.1,REGIEN_",")
"RTN","ROREXT",147,0)
 . I RORPROT=""  D  S ERRCNT=ERRCNT+1  Q
"RTN","ROREXT",148,0)
 . . D ERROR^RORERR(-25,,REGNAME)
"RTN","ROREXT",149,0)
 . ;--- Create the reference
"RTN","ROREXT",150,0)
 . S PGRLST(RORPROT,REGNAME)=REGIEN
"RTN","ROREXT",151,0)
 ;
"RTN","ROREXT",152,0)
 ;=== Data extraction
"RTN","ROREXT",153,0)
 M ROREXTSV=ROREXT
"RTN","ROREXT",154,0)
 S RORPROT="",RC=0
"RTN","ROREXT",155,0)
 F CNT=1:1  S RORPROT=$O(PGRLST(RORPROT))  Q:RORPROT=""  D  Q:RC<0
"RTN","ROREXT",156,0)
 . ;--- Prepare the task-specific parameters
"RTN","ROREXT",157,0)
 . K RORGLST  M RORGLST=PGRLST(RORPROT)
"RTN","ROREXT",158,0)
 . S ROREXT("HL7PROT")=RORPROT
"RTN","ROREXT",159,0)
 . ;--- Single-task data extraction (if requested)
"RTN","ROREXT",160,0)
 . I ROREXT("FLAGS")["S"  D  Q
"RTN","ROREXT",161,0)
 . . S TMP=$$INTEXT^ROREXT01(.RORGLST)
"RTN","ROREXT",162,0)
 . . I TMP<0  S:TMP=-42 RC=TMP  S ERRCNT=ERRCNT+1
"RTN","ROREXT",163,0)
 . . K ROREXT  M ROREXT=ROREXTSV
"RTN","ROREXT",164,0)
 . ;--- Otherwise, start a separate task
"RTN","ROREXT",165,0)
 . S ZTRTN="TASK^ROREXT",ZTIO=""
"RTN","ROREXT",166,0)
 . S ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT,,,,(CNT-1)*30)
"RTN","ROREXT",167,0)
 . S ZTDESC="CCR Data Extraction ("_RORPROT_")"
"RTN","ROREXT",168,0)
 . F TMP="ROREXT(","RORGLST(","RORPARM("  S ZTSAVE(TMP)=""
"RTN","ROREXT",169,0)
 . D ^%ZTLOAD
"RTN","ROREXT",170,0)
 . ;--- Log the action
"RTN","ROREXT",171,0)
 . D LOG^RORERR(-94,,,ZTSK)
"RTN","ROREXT",172,0)
 ;
"RTN","ROREXT",173,0)
 ;=== Error processing
"RTN","ROREXT",174,0)
 Q $S(RC<0:RC,ERRCNT>0:-43,1:0)
"RTN","ROREXT",175,0)
 ;
"RTN","ROREXT",176,0)
 ;***** ENTRY POINT FOR DATA EXTRACTION TASK
"RTN","ROREXT",177,0)
 ;
"RTN","ROREXT",178,0)
 ; ROREXT        Data extraction descriptor
"RTN","ROREXT",179,0)
 ; RORGLST       List of registry names and IENs
"RTN","ROREXT",180,0)
 ; RORPARM       Task-wide constants and variables
"RTN","ROREXT",181,0)
 ;
"RTN","ROREXT",182,0)
TASK ;
"RTN","ROREXT",183,0)
 N RORERRDL      ; Default error location
"RTN","ROREXT",184,0)
 N RORERROR      ; Error processing data
"RTN","ROREXT",185,0)
 ;
"RTN","ROREXT",186,0)
 N RC,TMP  K ZTREQ
"RTN","ROREXT",187,0)
 ;--- Initialize the variables
"RTN","ROREXT",188,0)
 D CLEAR^RORERR("TASK^ROREXT",1)
"RTN","ROREXT",189,0)
 ;--- Disable debug output (task has no output device)
"RTN","ROREXT",190,0)
 S:$G(RORPARM("DEBUG"))>1 RORPARM("DEBUG")=1
"RTN","ROREXT",191,0)
 ;--- Data extraction
"RTN","ROREXT",192,0)
 S RC=$$INTEXT^ROREXT01(.RORGLST,ZTSK)
"RTN","ROREXT",193,0)
 ;--- Error processing and notifications
"RTN","ROREXT",194,0)
 S:RC<0 ZTSTOP=1
"RTN","ROREXT",195,0)
 I RC=-42  D ALERT^RORUTL01(.RORGLST,-42)  Q
"RTN","ROREXT",196,0)
 D:RC<0 ALERT^RORUTL01(.RORGLST,-43,,,,"data extraction")
"RTN","ROREXT",197,0)
 S ZTREQ="@"
"RTN","ROREXT",198,0)
 Q
"RTN","ROREXT01")
0^37^B49949802
"RTN","ROREXT01",1,0)
ROREXT01 ;HCIOFO/SG - EXTRACTION & TRANSMISSION PROCESS ; 1/22/06 12:40pm
"RTN","ROREXT01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","ROREXT01",3,0)
 ;
"RTN","ROREXT01",4,0)
 Q
"RTN","ROREXT01",5,0)
 ;
"RTN","ROREXT01",6,0)
 ;***** INTERNAL ENTRY POINT FOR DATA EXTRACTION
"RTN","ROREXT01",7,0)
 ;
"RTN","ROREXT01",8,0)
 ; .REGLST       Reference to a local array containing registry
"RTN","ROREXT01",9,0)
 ;               names as subscripts and registry IENs as values
"RTN","ROREXT01",10,0)
 ;
"RTN","ROREXT01",11,0)
 ; [RORTASK]     Task Number (if the data extraction is performed
"RTN","ROREXT01",12,0)
 ;               by a separate process)
"RTN","ROREXT01",13,0)
 ;
"RTN","ROREXT01",14,0)
 ; Return Values:
"RTN","ROREXT01",15,0)
 ;       <0  Error code (see MSGLIST^RORERR20)
"RTN","ROREXT01",16,0)
 ;        0  Ok
"RTN","ROREXT01",17,0)
 ;
"RTN","ROREXT01",18,0)
 ; NOTE: The ROREXT and RORPARM local arrays must be properly
"RTN","ROREXT01",19,0)
 ;       initialized before calling this function.
"RTN","ROREXT01",20,0)
 ;
"RTN","ROREXT01",21,0)
INTEXT(REGLST,RORTASK) ;
"RTN","ROREXT01",22,0)
 N RORHL         ; HL7 variables
"RTN","ROREXT01",23,0)
 N RORLOG        ; Log subsystem constants & variables
"RTN","ROREXT01",24,0)
 N RORLRC        ; List of codes of Lab results to be extracted
"RTN","ROREXT01",25,0)
 ;
"RTN","ROREXT01",26,0)
 N COUNTERS,DXBEG,DXEND,HDTIEN,MID,RC,TMP
"RTN","ROREXT01",27,0)
 D INIT^RORUTL01("ROREXT")
"RTN","ROREXT01",28,0)
 S DXBEG=$G(ROREXT("DXBEG")),DXEND="",HDTIEN=0
"RTN","ROREXT01",29,0)
 K ^TMP("RORPTF",$J)
"RTN","ROREXT01",30,0)
 ;--- Open a new log
"RTN","ROREXT01",31,0)
 S TMP=$$SETUP^RORLOG(.REGLST)
"RTN","ROREXT01",32,0)
 S TMP=$S($G(RORTASK)'="":" TASK #"_RORTASK,1:"")
"RTN","ROREXT01",33,0)
 S TMP=$$OPEN^RORLOG(.REGLST,2,"DATA EXTRACTION"_TMP_" STARTED")
"RTN","ROREXT01",34,0)
 D
"RTN","ROREXT01",35,0)
 . ;--- Check the list of registries
"RTN","ROREXT01",36,0)
 . I $D(REGLST)<10  D  Q
"RTN","ROREXT01",37,0)
 . . S RC=$$ERROR^RORERR(-28,,,,"extract data")
"RTN","ROREXT01",38,0)
 . ;--- Lock parameters of the registries being processed
"RTN","ROREXT01",39,0)
 . S RC=$$LOCKREG^RORUTL02(.REGLST,1,,"DATA EXTRACTION")  Q:RC<0
"RTN","ROREXT01",40,0)
 . I 'RC  D  Q
"RTN","ROREXT01",41,0)
 . . S RC=$$ERROR^RORERR(-11,,,,"registries being processed")
"RTN","ROREXT01",42,0)
 . ;--- Check for pending historical data extraction
"RTN","ROREXT01",43,0)
 . I DXBEG'>0  D  I HDTIEN<0  S RC=+HDTIEN  Q
"RTN","ROREXT01",44,0)
 . . S HDTIEN=$$FIND^RORHDT06(.REGLST,.DXBEG,.DXEND)
"RTN","ROREXT01",45,0)
 . ;--- Load and process data extraction rules
"RTN","ROREXT01",46,0)
 . S RC=$$PREPARE^ROREXPR(.REGLST,DXBEG,DXEND)
"RTN","ROREXT01",47,0)
 . I RC<0  S RC=$$ERROR^RORERR(-22)  Q
"RTN","ROREXT01",48,0)
 . ;--- Load and process the historical data extraction parameters
"RTN","ROREXT01",49,0)
 . I HDTIEN>0  D  Q:RC<0
"RTN","ROREXT01",50,0)
 . . S RC=$$PREPARE^RORHDT06(HDTIEN)
"RTN","ROREXT01",51,0)
 . ;--- Reference the historical data extraction definition
"RTN","ROREXT01",52,0)
 . S RC=$$REGREF^RORHDT06(.REGLST,HDTIEN)  Q:RC<0
"RTN","ROREXT01",53,0)
 . ;--- Display the debug information
"RTN","ROREXT01",54,0)
 . D:$G(RORPARM("DEBUG"))>1 DEBUG^ROREXTUT
"RTN","ROREXT01",55,0)
 . ;--- Extract and send the data
"RTN","ROREXT01",56,0)
 . S RC=$$PROCESS(.REGLST)  Q:RC<0
"RTN","ROREXT01",57,0)
 . S COUNTERS=RC,RC=0
"RTN","ROREXT01",58,0)
 . ;--- Update registry parameters
"RTN","ROREXT01",59,0)
 . S TMP=$$TMSTMP^ROREXTUT(.REGLST)
"RTN","ROREXT01",60,0)
 ;--- Unlock parameters of processed registries
"RTN","ROREXT01",61,0)
 S TMP=$$LOCKREG^RORUTL02(.REGLST,0)
"RTN","ROREXT01",62,0)
 ;
"RTN","ROREXT01",63,0)
 ;--- Statistics & Cleanup
"RTN","ROREXT01",64,0)
 S TMP="DATA EXTRACTION "_$S(RC<0:"ABORTED",1:"COMPLETED")
"RTN","ROREXT01",65,0)
 D CLOSE^RORLOG(TMP,$G(COUNTERS))
"RTN","ROREXT01",66,0)
 D:'$G(RORPARM("DEBUG")) INIT^RORUTL01("ROREXT")
"RTN","ROREXT01",67,0)
 K ^TMP("RORPTF",$J)
"RTN","ROREXT01",68,0)
 ;---
"RTN","ROREXT01",69,0)
 Q $S($G(RC)<0:RC,1:0)
"RTN","ROREXT01",70,0)
 ;
"RTN","ROREXT01",71,0)
 ;***** RETURNS THE NEXT PATIENT FOR DATA EXTRACTION
"RTN","ROREXT01",72,0)
 ;
"RTN","ROREXT01",73,0)
 ; PTIEN         Patient IEN (DFN)
"RTN","ROREXT01",74,0)
 ;
"RTN","ROREXT01",75,0)
 ; .RGIENLST     Reference to a local array containing registry
"RTN","ROREXT01",76,0)
 ;               IENs as subscripts. The IENs of the corresponding
"RTN","ROREXT01",77,0)
 ;               patient's registry records are returned as values.
"RTN","ROREXT01",78,0)
 ;
"RTN","ROREXT01",79,0)
 ; Return Values:
"RTN","ROREXT01",80,0)
 ;        0  No more patients
"RTN","ROREXT01",81,0)
 ;       >0  IEN (DFN) of the next patient who belongs to at least
"RTN","ROREXT01",82,0)
 ;           one of the registries defined by the RGIENLST parameter.
"RTN","ROREXT01",83,0)
 ;
"RTN","ROREXT01",84,0)
NEXTPAT(PTIEN,RGIENLST) ;
"RTN","ROREXT01",85,0)
 N CNT,IEN,REGIEN,STATUS
"RTN","ROREXT01",86,0)
 S CNT=0
"RTN","ROREXT01",87,0)
 F  S PTIEN=$O(^RORDATA(798,"KEY",PTIEN))  Q:PTIEN'>0  D  Q:CNT
"RTN","ROREXT01",88,0)
 . S REGIEN=0
"RTN","ROREXT01",89,0)
 . F  S REGIEN=$O(RGIENLST(REGIEN))  Q:REGIEN'>0  D
"RTN","ROREXT01",90,0)
 . . S RGIENLST(REGIEN)=0
"RTN","ROREXT01",91,0)
 . . S IEN=+$O(^RORDATA(798,"KEY",PTIEN,REGIEN,""))
"RTN","ROREXT01",92,0)
 . . Q:IEN'>0
"RTN","ROREXT01",93,0)
 . . ;--- Skip all inactive records except marked for deletion
"RTN","ROREXT01",94,0)
 . . I '$$ACTIVE^RORDD(IEN,,.STATUS)  Q:STATUS'=5
"RTN","ROREXT01",95,0)
 . . ;--- Skip a record tagged as "DON'T SEND"
"RTN","ROREXT01",96,0)
 . . Q:$P($G(^RORDATA(798,IEN,2)),U,4)
"RTN","ROREXT01",97,0)
 . . ;--- Consider the record
"RTN","ROREXT01",98,0)
 . . S RGIENLST(REGIEN)=IEN,CNT=CNT+1
"RTN","ROREXT01",99,0)
 Q $S(PTIEN>0:PTIEN,1:0)
"RTN","ROREXT01",100,0)
 ;
"RTN","ROREXT01",101,0)
 ;***** SCANS THE REGISTRY AND EXTRACTS THE DATA
"RTN","ROREXT01",102,0)
 ;
"RTN","ROREXT01",103,0)
 ; .REGLST       Reference to a local array containing registry
"RTN","ROREXT01",104,0)
 ;               names as subscripts and registry IENs as values
"RTN","ROREXT01",105,0)
 ;
"RTN","ROREXT01",106,0)
 ; Return Values:
"RTN","ROREXT01",107,0)
 ;       <0  Error Code
"RTN","ROREXT01",108,0)
 ;      >=0  Statistics
"RTN","ROREXT01",109,0)
 ;             ^1: Total number of processed patients
"RTN","ROREXT01",110,0)
 ;             ^2: Number of patients processed with errors
"RTN","ROREXT01",111,0)
 ;
"RTN","ROREXT01",112,0)
 ; In normal mode this function processes all patients and returns
"RTN","ROREXT01",113,0)
 ; total number of patients and number of patients processed with
"RTN","ROREXT01",114,0)
 ; errors.
"RTN","ROREXT01",115,0)
 ;
"RTN","ROREXT01",116,0)
 ; However, in debug mode 3 the function stops after the first
"RTN","ROREXT01",117,0)
 ; patient processed with error and returns an error code.
"RTN","ROREXT01",118,0)
 ;
"RTN","ROREXT01",119,0)
PROCESS(REGLST) ;
"RTN","ROREXT01",120,0)
 N CNT,DTNEXT,ECNT,PTIEN,RC,REGIEN,REGNAME,RGIENLST,RORBUF,RORMSG,TH,TMP
"RTN","ROREXT01",121,0)
 ;--- Prepare the list of registry IENs
"RTN","ROREXT01",122,0)
 S REGNAME="",REGIEN=0
"RTN","ROREXT01",123,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:REGIEN<0
"RTN","ROREXT01",124,0)
 . S REGIEN=+REGLST(REGNAME)
"RTN","ROREXT01",125,0)
 . S:REGIEN'>0 REGIEN=$$REGIEN^RORUTL02(REGNAME)
"RTN","ROREXT01",126,0)
 . S:REGIEN>0 RGIENLST(REGIEN)=""
"RTN","ROREXT01",127,0)
 Q:REGIEN<0 REGIEN
"RTN","ROREXT01",128,0)
 ;--- Initialize environment variables
"RTN","ROREXT01",129,0)
 S RC=$$INIT^RORHL7()  Q:RC<0 RC
"RTN","ROREXT01",130,0)
 ;
"RTN","ROREXT01",131,0)
 ;--- Generate the registry state message
"RTN","ROREXT01",132,0)
 S RC=$$CREATE^RORHL7()  Q:RC<0 RC
"RTN","ROREXT01",133,0)
 S REGIEN=0
"RTN","ROREXT01",134,0)
 F  S REGIEN=$O(RGIENLST(REGIEN))  Q:REGIEN'>0  D  Q:RC<0
"RTN","ROREXT01",135,0)
 . S RC=$$REGSTATE^ROREXT03(REGIEN)
"RTN","ROREXT01",136,0)
 Q:RC<0 RC
"RTN","ROREXT01",137,0)
 ;
"RTN","ROREXT01",138,0)
 ;--- Loop through the patients of the registries
"RTN","ROREXT01",139,0)
 S (CNT,ECNT,PTIEN,RC)=0
"RTN","ROREXT01",140,0)
 F  S PTIEN=$$NEXTPAT(PTIEN,.RGIENLST)  Q:PTIEN'>0  D  Q:RC
"RTN","ROREXT01",141,0)
 . ;--- For a queued task only
"RTN","ROREXT01",142,0)
 . I $D(ZTQUEUED)  S RC=0  D  Q:RC<0
"RTN","ROREXT01",143,0)
 . . ;--- Check if task stop has been requested
"RTN","ROREXT01",144,0)
 . . I $$S^%ZTLOAD  S RC=$$ERROR^RORERR(-42)  Q
"RTN","ROREXT01",145,0)
 . . ;--- Check if the task should be suspended
"RTN","ROREXT01",146,0)
 . . Q:'$G(ROREXT("SUSPEND"))
"RTN","ROREXT01",147,0)
 . . Q:$$NOW^XLFDT<$G(DTNEXT)
"RTN","ROREXT01",148,0)
 . . Q:'$$SUSPEND(.DTNEXT)
"RTN","ROREXT01",149,0)
 . . ;--- Suspend the task during the peak hours
"RTN","ROREXT01",150,0)
 . . F  D  Q:'TH!(RC<0)
"RTN","ROREXT01",151,0)
 . . . S TH=$$FMDIFF^XLFDT(DTNEXT,$$NOW^XLFDT,2)
"RTN","ROREXT01",152,0)
 . . . I TH<60  S TH=0  Q       ; Do not HANG for less than a
"RTN","ROREXT01",153,0)
 . . . H $S(TH>3600:3600,1:TH)  ; minute and more than an hour
"RTN","ROREXT01",154,0)
 . . . ;--- Check if task stop has been requested
"RTN","ROREXT01",155,0)
 . . . S:$$S^%ZTLOAD RC=$$ERROR^RORERR(-42)
"RTN","ROREXT01",156,0)
 . ;--- Process the patient's records
"RTN","ROREXT01",157,0)
 . S CNT=CNT+1
"RTN","ROREXT01",158,0)
 . I $G(RORPARM("DEBUG"))>1  W:$E($G(IOST),1,2)="C-" *13,CNT
"RTN","ROREXT01",159,0)
 . S RC=$$PROCPAT(PTIEN,.RGIENLST)
"RTN","ROREXT01",160,0)
 . ;--- Process the error (if any)
"RTN","ROREXT01",161,0)
 . I RC<0  D  S:$G(RORPARM("DEBUG"))<3 RC=0  Q
"RTN","ROREXT01",162,0)
 . . S ECNT=ECNT+1,RC=$$ERROR^RORERR(-15,,,$G(PTIEN))
"RTN","ROREXT01",163,0)
 . ;--- Send the batch HL7 message when the maximum size is reached
"RTN","ROREXT01",164,0)
 . S:$$ISMAXSZ^RORHL7() RC=$$SEND^ROREXT03(.RGIENLST)
"RTN","ROREXT01",165,0)
 Q:RC<0 RC
"RTN","ROREXT01",166,0)
 ;
"RTN","ROREXT01",167,0)
 ;--- Send the remaining data (flush the buffer)
"RTN","ROREXT01",168,0)
 S RC=$$SEND^ROREXT03(.RGIENLST)  Q:RC<0 RC
"RTN","ROREXT01",169,0)
 ;
"RTN","ROREXT01",170,0)
 ;--- Return number of processed patients and number of errors
"RTN","ROREXT01",171,0)
 Q CNT_U_ECNT
"RTN","ROREXT01",172,0)
 ;
"RTN","ROREXT01",173,0)
 ;***** PROCESS THE PATIENT'S REGISTRY RECORDS
"RTN","ROREXT01",174,0)
 ;
"RTN","ROREXT01",175,0)
 ; PTIEN         Patient IEN (DFN)
"RTN","ROREXT01",176,0)
 ;
"RTN","ROREXT01",177,0)
 ; .RGIENLST     Reference to a local array containing registry
"RTN","ROREXT01",178,0)
 ;               IENs as subscripts and IENs of the corresponding
"RTN","ROREXT01",179,0)
 ;               patient's registry records as values.
"RTN","ROREXT01",180,0)
 ;
"RTN","ROREXT01",181,0)
 ; Return Values:
"RTN","ROREXT01",182,0)
 ;       <0  Error Code
"RTN","ROREXT01",183,0)
 ;        0  Ok
"RTN","ROREXT01",184,0)
 ;
"RTN","ROREXT01",185,0)
PROCPAT(PTIEN,RGIENLST) ;
"RTN","ROREXT01",186,0)
 N RORERRDL      ; Default error location
"RTN","ROREXT01",187,0)
 ;
"RTN","ROREXT01",188,0)
 N BATCHID,CNT,DXDTS,IEN,MSHPTR,RC,REGIEN,RORMSH,TMP
"RTN","ROREXT01",189,0)
 D CLEAR^RORERR("PROCPAT^ROREXT01")
"RTN","ROREXT01",190,0)
 ;
"RTN","ROREXT01",191,0)
 ;--- Compile the data extraction time frames
"RTN","ROREXT01",192,0)
 S (CNT,RC,REGIEN)=0
"RTN","ROREXT01",193,0)
 F  S REGIEN=$O(RGIENLST(REGIEN))  Q:REGIEN'>0  D  Q:RC<0
"RTN","ROREXT01",194,0)
 . S IEN=+RGIENLST(REGIEN)  Q:IEN'>0
"RTN","ROREXT01",195,0)
 . S RC=$$DXPERIOD^ROREXTUT(.DXDTS,IEN,PTIEN)
"RTN","ROREXT01",196,0)
 . S:'RC CNT=CNT+1
"RTN","ROREXT01",197,0)
 . S:RC>0 RGIENLST(REGIEN)=0
"RTN","ROREXT01",198,0)
 Q:RC<0 RC
"RTN","ROREXT01",199,0)
 ;--- If the patient should be skipped in all registries
"RTN","ROREXT01",200,0)
 ;    that are being processed, then do not perform the data
"RTN","ROREXT01",201,0)
 ;--- extraction for this patient at all.
"RTN","ROREXT01",202,0)
 I 'CNT  D:$G(RORPARM("DEBUG"))  Q 0
"RTN","ROREXT01",203,0)
 . D LOG^RORLOG(4,"There is no data to extract.",PTIEN)
"RTN","ROREXT01",204,0)
 ;
"RTN","ROREXT01",205,0)
 ;--- Create an HL7 message for the patient
"RTN","ROREXT01",206,0)
 S MSHPTR=$$CREATE^RORHL7(.RORMSH)  Q:MSHPTR<0 MSHPTR
"RTN","ROREXT01",207,0)
 S RC=$$MESSAGE^ROREXT02(PTIEN,.RGIENLST,.DXDTS,$G(ROREXT("HDTIEN")))
"RTN","ROREXT01",208,0)
 ;
"RTN","ROREXT01",209,0)
 ;--- Delete the unfinished message from the ^TMP("HLS",$J)
"RTN","ROREXT01",210,0)
 ;    if there is no data to send (RC>0) or there was an error
"RTN","ROREXT01",211,0)
 ;    during the data extraction (RC<0). Return the error code
"RTN","ROREXT01",212,0)
 ;--- in the latter case.
"RTN","ROREXT01",213,0)
 I RC!($O(^TMP("HLS",$J,""),-1)=MSHPTR)  D  Q:RC<0 RC
"RTN","ROREXT01",214,0)
 . D ROLLBACK^RORHL7(MSHPTR)  S:'RC RC=1
"RTN","ROREXT01",215,0)
 ;
"RTN","ROREXT01",216,0)
 ;--- Do not change state of the record(s) during the
"RTN","ROREXT01",217,0)
 ;--- historical data extraction
"RTN","ROREXT01",218,0)
 I $G(ROREXT("HDTIEN"))'>0  D  Q:RC<0 RC
"RTN","ROREXT01",219,0)
 . S TMP=$S('RC:$P(RORMSH,$E(RORMSH,4),10),1:"")
"RTN","ROREXT01",220,0)
 . S RC=$$UPDRECS^ROREXT03(PTIEN,.RGIENLST,TMP,$P(DXDTS,U,2))
"RTN","ROREXT01",221,0)
 ;---
"RTN","ROREXT01",222,0)
 Q 0
"RTN","ROREXT01",223,0)
 ;
"RTN","ROREXT01",224,0)
 ;***** CHECKS IF THE TASK SHOULD BE SUSPENDED
"RTN","ROREXT01",225,0)
 ;
"RTN","ROREXT01",226,0)
 ; .DTNEXT       Date/Time of the next event (suspend/resume)
"RTN","ROREXT01",227,0)
 ;               is returned via this parameter
"RTN","ROREXT01",228,0)
 ;
"RTN","ROREXT01",229,0)
 ; Return Values:
"RTN","ROREXT01",230,0)
 ;        0  Continue/Resume
"RTN","ROREXT01",231,0)
 ;        1  Suspend
"RTN","ROREXT01",232,0)
 ;
"RTN","ROREXT01",233,0)
SUSPEND(DTNEXT) ;
"RTN","ROREXT01",234,0)
 N DATE,NOW,SUSPEND,TIME,TS,TR
"RTN","ROREXT01",235,0)
 S TS=$P(ROREXT("SUSPEND"),U,1)
"RTN","ROREXT01",236,0)
 S TR=$P(ROREXT("SUSPEND"),U,2)
"RTN","ROREXT01",237,0)
 S NOW=$$NOW^XLFDT,DATE=NOW\1
"RTN","ROREXT01",238,0)
 ;--- A work day
"RTN","ROREXT01",239,0)
 I $$WDCHK^RORUTL01(DATE)  D  Q SUSPEND
"RTN","ROREXT01",240,0)
 . S TIME=NOW-DATE,SUSPEND=0
"RTN","ROREXT01",241,0)
 . I TIME<TS   S DTNEXT=DATE+TS  Q
"RTN","ROREXT01",242,0)
 . I TIME'<TR  S DTNEXT=$$WDNEXT^RORUTL01(DATE)+TS  Q
"RTN","ROREXT01",243,0)
 . S DTNEXT=DATE+TR,SUSPEND=1
"RTN","ROREXT01",244,0)
 ;--- Saturday, Sunday or Holiday
"RTN","ROREXT01",245,0)
 S DTNEXT=$$WDNEXT^RORUTL01(DATE)+TS
"RTN","ROREXT01",246,0)
 Q 0
"RTN","ROREXT02")
0^38^B40742469
"RTN","ROREXT02",1,0)
ROREXT02 ;HCIOFO/SG - DEFAULT MESSAGE BUILDER ; 12/7/05 10:44am
"RTN","ROREXT02",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","ROREXT02",3,0)
 ;
"RTN","ROREXT02",4,0)
 Q
"RTN","ROREXT02",5,0)
 ;
"RTN","ROREXT02",6,0)
 ;***** CHECKS IF DEMOGRAPHIC DATA HAS BEEN UPDATED
"RTN","ROREXT02",7,0)
 ;
"RTN","ROREXT02",8,0)
 ; .RGIENLST     Reference to a local array containing registry
"RTN","ROREXT02",9,0)
 ;               IENs as subscripts and IENs of the corresponding
"RTN","ROREXT02",10,0)
 ;               patient's registry records as values.
"RTN","ROREXT02",11,0)
 ;
"RTN","ROREXT02",12,0)
 ; Return Values:
"RTN","ROREXT02",13,0)
 ;       <0  Error Code
"RTN","ROREXT02",14,0)
 ;        0  Demographic data is unchanged
"RTN","ROREXT02",15,0)
 ;       >0  Demographic data has been updated
"RTN","ROREXT02",16,0)
 ;
"RTN","ROREXT02",17,0)
DEMCHK(RGIENLST) ;
"RTN","ROREXT02",18,0)
 N DEM,IENS,RC,REGIEN,RORMSG
"RTN","ROREXT02",19,0)
 S (DEM,RC,REGIEN)=0
"RTN","ROREXT02",20,0)
 F  S REGIEN=$O(RGIENLST(REGIEN))  Q:REGIEN'>0  D  Q:DEM!(RC<0)
"RTN","ROREXT02",21,0)
 . S IENS=+RGIENLST(REGIEN)_","  Q:IENS'>0
"RTN","ROREXT02",22,0)
 . S DEM=+$$GET1^DIQ(798,IENS,4,"I",,"RORMSG")
"RTN","ROREXT02",23,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","ROREXT02",24,0)
 Q $S(RC<0:RC,1:DEM)
"RTN","ROREXT02",25,0)
 ;
"RTN","ROREXT02",26,0)
 ;***** EXTRACTS AND PREPARES LABORATORY DATA
"RTN","ROREXT02",27,0)
 ;
"RTN","ROREXT02",28,0)
 ; PTIEN         Patient IEN
"RTN","ROREXT02",29,0)
 ;
"RTN","ROREXT02",30,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","ROREXT02",31,0)
 ;               data extraction time frames are stored.
"RTN","ROREXT02",32,0)
 ;
"RTN","ROREXT02",33,0)
 ; [HDTMODE]     If this parameter is defined and non-zero, start and
"RTN","ROREXT02",34,0)
 ;               end dates are specimen collection dates. Otherwise,
"RTN","ROREXT02",35,0)
 ;               they are dates of the results.
"RTN","ROREXT02",36,0)
 ;
"RTN","ROREXT02",37,0)
 ; The function uses node ^TMP("RORTMP",$J) as a temporary storage.
"RTN","ROREXT02",38,0)
 ;
"RTN","ROREXT02",39,0)
 ; Return Values:
"RTN","ROREXT02",40,0)
 ;       <0  Error Code
"RTN","ROREXT02",41,0)
 ;        0  Ok
"RTN","ROREXT02",42,0)
 ;
"RTN","ROREXT02",43,0)
LABDATA(PTIEN,DXDTS,HDTMODE) ;
"RTN","ROREXT02",44,0)
 N ENDT,IDX,RC,RORTMP,STDT,TMP
"RTN","ROREXT02",45,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","ROREXT02",46,0)
 S (IDX,RC)=0
"RTN","ROREXT02",47,0)
 F  S IDX=$O(DXDTS(1,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","ROREXT02",48,0)
 . S STDT=$P(DXDTS(1,IDX),U),ENDT=$P(DXDTS(1,IDX),U,2)
"RTN","ROREXT02",49,0)
 . ;--- Get the Lab results
"RTN","ROREXT02",50,0)
 . K @RORTMP  S TMP=$S($G(HDTMODE):"^CD",1:"^RAD")
"RTN","ROREXT02",51,0)
 . S RC=$$LABRSLTS^RORUTL02(PTIEN,STDT_TMP,ENDT_TMP,RORTMP)
"RTN","ROREXT02",52,0)
 . Q:RC<0
"RTN","ROREXT02",53,0)
 . ;--- Call the Lab data post-processor
"RTN","ROREXT02",54,0)
 . S RC=$$LABPROC(RORTMP,PTIEN)
"RTN","ROREXT02",55,0)
 . ;---
"RTN","ROREXT02",56,0)
 D FREE^RORTMP(RORTMP)
"RTN","ROREXT02",57,0)
 Q $S(RC<0:RC,1:0)
"RTN","ROREXT02",58,0)
 ;
"RTN","ROREXT02",59,0)
 ;***** LABORATORY DATA POST-PROCESSOR
"RTN","ROREXT02",60,0)
 ;
"RTN","ROREXT02",61,0)
 ; ROR8TMP       Closed root of the array (local or global), which
"RTN","ROREXT02",62,0)
 ;               contains the data loaded by the $$GCPR^LA7QRY
"RTN","ROREXT02",63,0)
 ;
"RTN","ROREXT02",64,0)
 ; PTIEN         Patient IEN
"RTN","ROREXT02",65,0)
 ;
"RTN","ROREXT02",66,0)
 ; Return Values:
"RTN","ROREXT02",67,0)
 ;       <0  Error Code
"RTN","ROREXT02",68,0)
 ;        0  Ok
"RTN","ROREXT02",69,0)
 ;
"RTN","ROREXT02",70,0)
LABPROC(ROR8TMP,PTIEN) ;
"RTN","ROREXT02",71,0)
 N BUF,CS,DFLTSITE,FS,I,J,LABC,SEG,TMP
"RTN","ROREXT02",72,0)
 ;--- Extract separators from the MSH segment
"RTN","ROREXT02",73,0)
 S BUF=$G(@ROR8TMP@(1))
"RTN","ROREXT02",74,0)
 S:$E(BUF,1,3)="MSH" CS=$E(BUF,5)
"RTN","ROREXT02",75,0)
 S:$G(CS)="" CS="^"
"RTN","ROREXT02",76,0)
 ;--- Initialize constants and variables
"RTN","ROREXT02",77,0)
 S LABC="LABC"_CS_"Lab Comment"_CS_"VA080"
"RTN","ROREXT02",78,0)
 ;--- Get the default station number and name
"RTN","ROREXT02",79,0)
 S DFLTSITE=$$SITE^RORUTL03(CS)
"RTN","ROREXT02",80,0)
 ;
"RTN","ROREXT02",81,0)
 ;--- Add the results to the message
"RTN","ROREXT02",82,0)
 S I=0
"RTN","ROREXT02",83,0)
 F  S I=$O(@ROR8TMP@(I))  Q:I=""  D
"RTN","ROREXT02",84,0)
 . ;--- Load the full segment
"RTN","ROREXT02",85,0)
 . D LOADSEG^RORHL7A(.SEG,$NA(@ROR8TMP@(I)))  Q:$G(SEG(0))=""
"RTN","ROREXT02",86,0)
 . D
"RTN","ROREXT02",87,0)
 . . ;--- Use the default station if the local one is missing
"RTN","ROREXT02",88,0)
 . . I SEG(0)="OBX"  D  Q
"RTN","ROREXT02",89,0)
 . . . S:$P($G(SEG(15)),CS)="" SEG(15)=DFLTSITE
"RTN","ROREXT02",90,0)
 . . ;--- Leave only the code of the Provider
"RTN","ROREXT02",91,0)
 . . I SEG(0)="OBR"  D  Q
"RTN","ROREXT02",92,0)
 . . . S SEG(16)=+$G(SEG(16)),SEG(24)="LAB"
"RTN","ROREXT02",93,0)
 . . ;--- Replace NTE's with OBX's
"RTN","ROREXT02",94,0)
 . . I SEG(0)="NTE"  D  Q
"RTN","ROREXT02",95,0)
 . . . K TMP  M TMP=SEG(3)  K SEG
"RTN","ROREXT02",96,0)
 . . . S SEG(0)="OBX"
"RTN","ROREXT02",97,0)
 . . . S SEG(2)="ST",SEG(3)=LABC,SEG(4)="LCOMM"
"RTN","ROREXT02",98,0)
 . . . M SEG(5)=TMP
"RTN","ROREXT02",99,0)
 . . . S SEG(11)="F"
"RTN","ROREXT02",100,0)
 . . ;--- Skip all other segments
"RTN","ROREXT02",101,0)
 . . K SEG
"RTN","ROREXT02",102,0)
 . ;--- Store the segment
"RTN","ROREXT02",103,0)
 . D:$D(SEG)>1 ADDSEG^RORHL7(.SEG)
"RTN","ROREXT02",104,0)
 Q 0
"RTN","ROREXT02",105,0)
 ;
"RTN","ROREXT02",106,0)
 ;***** EXTRACTS PATIENT'S DATA AND CREATES THE MESSAGE BODY
"RTN","ROREXT02",107,0)
 ;
"RTN","ROREXT02",108,0)
 ; PTIEN         Patient IEN
"RTN","ROREXT02",109,0)
 ;
"RTN","ROREXT02",110,0)
 ; .RGIENLST     Reference to a local array containing registry
"RTN","ROREXT02",111,0)
 ;               IENs as subscripts and IENs of the corresponding
"RTN","ROREXT02",112,0)
 ;               patient's registry records as values.
"RTN","ROREXT02",113,0)
 ;
"RTN","ROREXT02",114,0)
 ; .DXDTS        Either a single time frame in StartDate^EndDate
"RTN","ROREXT02",115,0)
 ;               format or a reference to a local variable containing
"RTN","ROREXT02",116,0)
 ;               the list of data extraction time frames. The main
"RTN","ROREXT02",117,0)
 ;               time frame should be stored in the root node:
"RTN","ROREXT02",118,0)
 ;
"RTN","ROREXT02",119,0)
 ;  DXDTS(         MainStartDate^MainEndDate  (FileMan)
"RTN","ROREXT02",120,0)
 ;    DataArea,
"RTN","ROREXT02",121,0)
 ;      i)         StartDate^EndDate          (FileMan)
"RTN","ROREXT02",122,0)
 ;
"RTN","ROREXT02",123,0)
 ;               See the $$DXPERIOD^ROREXTUT function for details.
"RTN","ROREXT02",124,0)
 ;
"RTN","ROREXT02",125,0)
 ; [HDTMODE]     This parameter is defined and non-zero during the
"RTN","ROREXT02",126,0)
 ;               historical data extraction.
"RTN","ROREXT02",127,0)
 ;
"RTN","ROREXT02",128,0)
 ; Return Values:
"RTN","ROREXT02",129,0)
 ;       <0  Error Code
"RTN","ROREXT02",130,0)
 ;        0  Ok
"RTN","ROREXT02",131,0)
 ;       >0  Nothing to send
"RTN","ROREXT02",132,0)
 ;
"RTN","ROREXT02",133,0)
MESSAGE(PTIEN,RGIENLST,DXDTS,HDTMODE) ;
"RTN","ROREXT02",134,0)
 N RORDEM        ; Update demographics
"RTN","ROREXT02",135,0)
 ;
"RTN","ROREXT02",136,0)
 N CLINPTR,CSRPTR,DEMPTR,PV1PTR,RC,REGIEN,RORMSG,RORPTR,TMP
"RTN","ROREXT02",137,0)
 S HDTMODE=+$G(HDTMODE)
"RTN","ROREXT02",138,0)
 ;--- If only the main time frame is provided then
"RTN","ROREXT02",139,0)
 ;--- generate the data-specific ones automatically
"RTN","ROREXT02",140,0)
 I $D(DXDTS)<10  D  D DXMERGE^ROREXTUT(.DXDTS)
"RTN","ROREXT02",141,0)
 . D DXADD^ROREXTUT(.DXDTS,$P(DXDTS,U),$P(DXDTS,U,2),0,1)
"RTN","ROREXT02",142,0)
 ;--- Initialize variables
"RTN","ROREXT02",143,0)
 S RC=$$INIT^RORHL7()  Q:RC<0 RC
"RTN","ROREXT02",144,0)
 S RORDEM=$$DEMCHK(.RGIENLST)
"RTN","ROREXT02",145,0)
 ;
"RTN","ROREXT02",146,0)
 ;=== Demographic data segments
"RTN","ROREXT02",147,0)
 S DEMPTR=$$PTR^RORHL7
"RTN","ROREXT02",148,0)
 S RC=$$PID^RORHL01(PTIEN)  Q:RC<0 RC
"RTN","ROREXT02",149,0)
 ;--- Period of Servise
"RTN","ROREXT02",150,0)
 S RC=$$ZSP^RORHL01(PTIEN)  Q:RC<0 RC
"RTN","ROREXT02",151,0)
 ;--- Rated Disabilities
"RTN","ROREXT02",152,0)
 S RC=$$ZRD^RORHL01(PTIEN)  Q:RC<0 RC
"RTN","ROREXT02",153,0)
 ;
"RTN","ROREXT02",154,0)
 ;=== Inpatient and Outpatient Encounter Data
"RTN","ROREXT02",155,0)
 S PV1PTR=$$PTR^RORHL7
"RTN","ROREXT02",156,0)
 ;--- Inpatient
"RTN","ROREXT02",157,0)
 S RC=$$EN1^RORHL08(PTIEN,.DXDTS,"PV1")  Q:RC<0 RC
"RTN","ROREXT02",158,0)
 ;--- Outpatient
"RTN","ROREXT02",159,0)
 S RC=$$EN1^RORHL09(PTIEN,.DXDTS,"PV1")  Q:RC<0 RC
"RTN","ROREXT02",160,0)
 ;
"RTN","ROREXT02",161,0)
 ;=== Required CSR segment (dummy)
"RTN","ROREXT02",162,0)
 S CSRPTR=$$PTR^RORHL7
"RTN","ROREXT02",163,0)
 S RC=$$CSR^RORHL02(,PTIEN)  Q:RC<0 RC
"RTN","ROREXT02",164,0)
 ;
"RTN","ROREXT02",165,0)
 ;=== Add other encounter data segments
"RTN","ROREXT02",166,0)
 S CLINPTR=$$PTR^RORHL7
"RTN","ROREXT02",167,0)
 ;---Inpatient
"RTN","ROREXT02",168,0)
 S RC=$$EN1^RORHL08(PTIEN,.DXDTS,"OBR")    Q:RC<0 RC
"RTN","ROREXT02",169,0)
 ;--- Outpatient
"RTN","ROREXT02",170,0)
 S RC=$$EN1^RORHL09(PTIEN,.DXDTS,"OBR")    Q:RC<0 RC
"RTN","ROREXT02",171,0)
 ;--- Radiology
"RTN","ROREXT02",172,0)
 S RC=$$EN1^RORHL04(PTIEN,.DXDTS)          Q:RC<0 RC
"RTN","ROREXT02",173,0)
 ;--- Autopsy
"RTN","ROREXT02",174,0)
 S RC=$$EN1^RORHL05(PTIEN,.DXDTS)          Q:RC<0 RC
"RTN","ROREXT02",175,0)
 ;--- Surgical Pathology
"RTN","ROREXT02",176,0)
 S RC=$$EN1^RORHL10(PTIEN,.DXDTS,HDTMODE)  Q:RC<0 RC
"RTN","ROREXT02",177,0)
 ;--- Cytopathology
"RTN","ROREXT02",178,0)
 S RC=$$EN1^RORHL11(PTIEN,.DXDTS,HDTMODE)  Q:RC<0 RC
"RTN","ROREXT02",179,0)
 ;--- Microbiology
"RTN","ROREXT02",180,0)
 S RC=$$EN1^RORHL12(PTIEN,.DXDTS,HDTMODE)  Q:RC<0 RC
"RTN","ROREXT02",181,0)
 ;--- EKG (Medical Procedures)
"RTN","ROREXT02",182,0)
 S RC=$$EN1^RORHL13(PTIEN,.DXDTS)          Q:RC<0 RC
"RTN","ROREXT02",183,0)
 ;--- Allergy
"RTN","ROREXT02",184,0)
 S RC=$$EN1^RORHL14(PTIEN,.DXDTS)          Q:RC<0 RC
"RTN","ROREXT02",185,0)
 ;--- IV
"RTN","ROREXT02",186,0)
 S RC=$$EN1^RORHL15(PTIEN,.DXDTS)          Q:RC<0 RC
"RTN","ROREXT02",187,0)
 ;--- Vitals
"RTN","ROREXT02",188,0)
 S RC=$$EN1^RORHL16(PTIEN,.DXDTS)          Q:RC<0 RC
"RTN","ROREXT02",189,0)
 ;--- Problem List
"RTN","ROREXT02",190,0)
 S RC=$$EN1^RORHL17(PTIEN,.DXDTS)          Q:RC<0 RC
"RTN","ROREXT02",191,0)
 ;--- Lab data
"RTN","ROREXT02",192,0)
 S RC=$$LABDATA(PTIEN,.DXDTS,HDTMODE)      Q:RC<0 RC
"RTN","ROREXT02",193,0)
 ;--- Pharmacy
"RTN","ROREXT02",194,0)
 S RC=$$EN1^RORHL03(PTIEN,.DXDTS)          Q:RC<0 RC
"RTN","ROREXT02",195,0)
 ;
"RTN","ROREXT02",196,0)
 ;=== Analyze the structure of the message
"RTN","ROREXT02",197,0)
 S RORPTR=$$PTR^RORHL7
"RTN","ROREXT02",198,0)
 ;--- If the demographic data has not changed since the previous
"RTN","ROREXT02",199,0)
 ;    data extraction and no clinical data has been added to the
"RTN","ROREXT02",200,0)
 ;--- message, then remove the demographic section completely.
"RTN","ROREXT02",201,0)
 I 'RORDEM,RORPTR'>CLINPTR,CSRPTR'>PV1PTR  D
"RTN","ROREXT02",202,0)
 . D ROLLBACK^RORHL7(DEMPTR,1)  S CLINPTR=0
"RTN","ROREXT02",203,0)
 ;
"RTN","ROREXT02",204,0)
 ;=== Registry Data
"RTN","ROREXT02",205,0)
 S REGIEN=0
"RTN","ROREXT02",206,0)
 F  S REGIEN=$O(RGIENLST(REGIEN)),RC=0  Q:REGIEN'>0  D  Q:RC<0
"RTN","ROREXT02",207,0)
 . S IEN=+RGIENLST(REGIEN)  Q:IEN'>0
"RTN","ROREXT02",208,0)
 . ;--- If no clinical or demographics data is sent and the local
"RTN","ROREXT02",209,0)
 . ;    registry data has not been modified since the last data
"RTN","ROREXT02",210,0)
 . ;--- extraction, then do not include the registry data section.
"RTN","ROREXT02",211,0)
 . I 'CLINPTR  D  Q:RC
"RTN","ROREXT02",212,0)
 . . S RC='$$GET1^DIQ(798,IEN_",",5,"I",,"RORMSG")
"RTN","ROREXT02",213,0)
 . . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,PTIEN,798,IEN_",")
"RTN","ROREXT02",214,0)
 . ;---
"RTN","ROREXT02",215,0)
 . I $G(ROREXT("MSGBLD",REGIEN))'=""  D
"RTN","ROREXT02",216,0)
 . . X "S RC="_ROREXT("MSGBLD",REGIEN)_"(IEN,PTIEN,.DXDTS)"
"RTN","ROREXT02",217,0)
 . E  S RC=$$REGDATA(IEN,PTIEN,.DXDTS)
"RTN","ROREXT02",218,0)
 ;
"RTN","ROREXT02",219,0)
 ;=== Analyze the structure of the message
"RTN","ROREXT02",220,0)
 S RORPTR=$$PTR^RORHL7
"RTN","ROREXT02",221,0)
 Q (RORPTR'>DEMPTR)
"RTN","ROREXT02",222,0)
 ;
"RTN","ROREXT02",223,0)
 ;***** EXTRACTS REGISTRY-SPECIFIC DATA
"RTN","ROREXT02",224,0)
 ;
"RTN","ROREXT02",225,0)
 ; RORIEN        IEN of the patient record in the registry
"RTN","ROREXT02",226,0)
 ;
"RTN","ROREXT02",227,0)
 ; PTIEN         Patient IEN
"RTN","ROREXT02",228,0)
 ;
"RTN","ROREXT02",229,0)
 ; .DXDTS        Data extraction time frames
"RTN","ROREXT02",230,0)
 ;
"RTN","ROREXT02",231,0)
 ; [HDTMODE]     This parameter is defined and non-zero during the
"RTN","ROREXT02",232,0)
 ;               historical data extraction.
"RTN","ROREXT02",233,0)
 ;
"RTN","ROREXT02",234,0)
 ; Return Values:
"RTN","ROREXT02",235,0)
 ;       <0  Error Code
"RTN","ROREXT02",236,0)
 ;        0  Ok
"RTN","ROREXT02",237,0)
 ;       >0  Nothing to send
"RTN","ROREXT02",238,0)
 ;
"RTN","ROREXT02",239,0)
REGDATA(RORIEN,PTIEN,DXDTS,HDTMODE) ;
"RTN","ROREXT02",240,0)
 N IENS,RC
"RTN","ROREXT02",241,0)
 S IENS=RORIEN_","
"RTN","ROREXT02",242,0)
 S RC=$$PID^RORHL01(PTIEN)       Q:RC<0 RC
"RTN","ROREXT02",243,0)
 S RC=$$CSR^RORHL02(IENS,PTIEN)  Q:RC<0 RC
"RTN","ROREXT02",244,0)
 S RC=$$CSP^RORHL02(IENS,DXDTS)  Q:RC<0 RC
"RTN","ROREXT02",245,0)
 Q 0
"RTN","ROREXT03")
0^39^B20585148
"RTN","ROREXT03",1,0)
ROREXT03 ;HCIOFO/SG - REGISTRY DATA EXTRACTION (OVERFLOW) ; 11/29/05 4:13pm
"RTN","ROREXT03",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","ROREXT03",3,0)
 ;
"RTN","ROREXT03",4,0)
 Q
"RTN","ROREXT03",5,0)
 ;
"RTN","ROREXT03",6,0)
 ;*****REGISTRY STATE CSR SEGMENT
"RTN","ROREXT03",7,0)
CSR(REGIEN) ;
"RTN","ROREXT03",8,0)
 N CS,RC,RORINFO,RORSEG,RPTSTATS,TMP
"RTN","ROREXT03",9,0)
 D ECH^RORHL7(.CS)
"RTN","ROREXT03",10,0)
 ;
"RTN","ROREXT03",11,0)
 ;--- Get the registry information
"RTN","ROREXT03",12,0)
 S RC=$$REGINFO^RORUTL17(REGIEN,"RORINFO")  Q:RC<0 RC
"RTN","ROREXT03",13,0)
 S TMP=$$STATS^RORTSK12(REGIEN,.RPTSTATS)
"RTN","ROREXT03",14,0)
 ;
"RTN","ROREXT03",15,0)
 ;--- Initialize the segment
"RTN","ROREXT03",16,0)
 S RORSEG(0)="CSR"
"RTN","ROREXT03",17,0)
 ;
"RTN","ROREXT03",18,0)
 ;--- CSR-1 - Name of the registry and version of the CCR
"RTN","ROREXT03",19,0)
 S TMP=+$P(ROREXT("VERSION"),U)              ; Version
"RTN","ROREXT03",20,0)
 S:$P(TMP,".",2)="" $P(TMP,".",2)="0"
"RTN","ROREXT03",21,0)
 S $P(TMP,".",3)=+$P(ROREXT("VERSION"),U,2)  ; Patch Number
"RTN","ROREXT03",22,0)
 S $P(TMP,".",4)=+$$BUILD^ROR                ; Build Number
"RTN","ROREXT03",23,0)
 S RORSEG(1)=$$ESCAPE^RORHL7($P($$REGNAME^RORUTL01(REGIEN),U))_CS_TMP
"RTN","ROREXT03",24,0)
 ;
"RTN","ROREXT03",25,0)
 ;--- CSR-3 - Institution
"RTN","ROREXT03",26,0)
 S RORSEG(3)=$$SITE^RORUTL03(CS)
"RTN","ROREXT03",27,0)
 ;
"RTN","ROREXT03",28,0)
 ;--- CSR-4 - Patient ID
"RTN","ROREXT03",29,0)
 S TMP="0"_CS_CS_CS_CS_"U"
"RTN","ROREXT03",30,0)
 S $P(TMP,CS,6)=+$G(RORINFO("NPP"))  ; Number of pending patients
"RTN","ROREXT03",31,0)
 S $P(TMP,CS,7)=+$P(RPTSTATS,U)      ; Number of reports
"RTN","ROREXT03",32,0)
 S RORSEG(4)=TMP
"RTN","ROREXT03",33,0)
 ;
"RTN","ROREXT03",34,0)
 ;--- Store the segment
"RTN","ROREXT03",35,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","ROREXT03",36,0)
 Q 0
"RTN","ROREXT03",37,0)
 ;
"RTN","ROREXT03",38,0)
 ;***** REGISTRY STATE PID SEGMENT
"RTN","ROREXT03",39,0)
PID() ;
"RTN","ROREXT03",40,0)
 N CS,RORSEG
"RTN","ROREXT03",41,0)
 D ECH^RORHL7(.CS)
"RTN","ROREXT03",42,0)
 ;
"RTN","ROREXT03",43,0)
 ;--- Initialize the segment
"RTN","ROREXT03",44,0)
 S RORSEG(0)="PID"
"RTN","ROREXT03",45,0)
 ;
"RTN","ROREXT03",46,0)
 ;--- PID-3 DFN and Station Number
"RTN","ROREXT03",47,0)
 S RORSEG(3)="0"_CS_CS_CS_CS_"U"
"RTN","ROREXT03",48,0)
 ;
"RTN","ROREXT03",49,0)
 ;--- PID-5 Patient Name
"RTN","ROREXT03",50,0)
 S RORSEG(5)="PSEUDO"_CS_"PATIENT"
"RTN","ROREXT03",51,0)
 ;
"RTN","ROREXT03",52,0)
 ;--- Store the segment
"RTN","ROREXT03",53,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","ROREXT03",54,0)
 Q 0
"RTN","ROREXT03",55,0)
 ;
"RTN","ROREXT03",56,0)
 ;***** GENERATES THE REGISTRY STATE HL7 MESSAGE
"RTN","ROREXT03",57,0)
 ;
"RTN","ROREXT03",58,0)
 ; REGIEN        Registry IEN
"RTN","ROREXT03",59,0)
 ;
"RTN","ROREXT03",60,0)
 ; Return Values:
"RTN","ROREXT03",61,0)
 ;       <0  Error code
"RTN","ROREXT03",62,0)
 ;        0  Ok
"RTN","ROREXT03",63,0)
 ;       >0  Number of ignored errors
"RTN","ROREXT03",64,0)
 ;
"RTN","ROREXT03",65,0)
REGSTATE(REGIEN) ;
"RTN","ROREXT03",66,0)
 N RC
"RTN","ROREXT03",67,0)
 ;--- Output pseudo-patient's segments
"RTN","ROREXT03",68,0)
 S RC=$$PID()            Q:RC<0 RC
"RTN","ROREXT03",69,0)
 S RC=$$CSR(REGIEN)      Q:RC<0 RC
"RTN","ROREXT03",70,0)
 ;---
"RTN","ROREXT03",71,0)
 Q 0
"RTN","ROREXT03",72,0)
 ;
"RTN","ROREXT03",73,0)
 ;***** SENDS THE CURRENT HL7 BATCH
"RTN","ROREXT03",74,0)
 ;
"RTN","ROREXT03",75,0)
 ; .RGIENLST     Reference to a local array containing registry
"RTN","ROREXT03",76,0)
 ;               IENs as subscripts and IENs of the corresponding
"RTN","ROREXT03",77,0)
 ;               patient's registry records as values.
"RTN","ROREXT03",78,0)
 ;
"RTN","ROREXT03",79,0)
 ; Return Values:
"RTN","ROREXT03",80,0)
 ;       <0  Error Code
"RTN","ROREXT03",81,0)
 ;        0  Ok
"RTN","ROREXT03",82,0)
 ;
"RTN","ROREXT03",83,0)
SEND(RGIENLST) ;
"RTN","ROREXT03",84,0)
 N IENS,MID,RC,REGIEN,RORFDA,RORMSG,TMP
"RTN","ROREXT03",85,0)
 W:$G(RORPARM("DEBUG"))>1 !,"HL7 Batch ID: ",$G(ROREXT("HL7MID"))
"RTN","ROREXT03",86,0)
 S RC=$$SEND^RORHL7(.MID)  Q:RC<0 RC
"RTN","ROREXT03",87,0)
 I 'RC,$G(MID)'=""  D
"RTN","ROREXT03",88,0)
 . S ROREXT("NBM")=$G(ROREXT("NBM"))+1
"RTN","ROREXT03",89,0)
 . S TMP="HL7 batch message "_MID_" has been generated"
"RTN","ROREXT03",90,0)
 . D LOG^RORLOG(2,TMP)
"RTN","ROREXT03",91,0)
 . ;--- Add message reference to the LAST BATCH CONTROL ID
"RTN","ROREXT03",92,0)
 . ;--- multiples of the registries that are being processed
"RTN","ROREXT03",93,0)
 . S (RC,REGIEN)=0
"RTN","ROREXT03",94,0)
 . F  S REGIEN=$O(RGIENLST(REGIEN))  Q:REGIEN'>0  D  Q:RC<0
"RTN","ROREXT03",95,0)
 . . K RORFDA,RORMSG  S IENS="+1,"_REGIEN_","
"RTN","ROREXT03",96,0)
 . . ;--- LAST BATCH CONTROL ID
"RTN","ROREXT03",97,0)
 . . S RORFDA(798.122,IENS,.01)=MID
"RTN","ROREXT03",98,0)
 . . ;--- INTERNAL BATCH ID
"RTN","ROREXT03",99,0)
 . . S RORFDA(798.122,IENS,.02)=$G(ROREXT("HL7MID"))
"RTN","ROREXT03",100,0)
 . . ;--- Batch Date/Time
"RTN","ROREXT03",101,0)
 . . S TMP=+$G(ROREXT("HL7DT"))
"RTN","ROREXT03",102,0)
 . . S RORFDA(798.122,IENS,.03)=$S(TMP>0:TMP,1:$$NOW^XLFDT)
"RTN","ROREXT03",103,0)
 . . ;--- Create the record
"RTN","ROREXT03",104,0)
 . . D UPDATE^DIE(,"RORFDA",,"RORMSG")
"RTN","ROREXT03",105,0)
 . . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,PTIEN,798.122,IENS)
"RTN","ROREXT03",106,0)
 Q 0
"RTN","ROREXT03",107,0)
 ;
"RTN","ROREXT03",108,0)
 ;***** UPDATES THE REGISTRY RECORDS AFTER THE DATA EXTRACTION
"RTN","ROREXT03",109,0)
 ;
"RTN","ROREXT03",110,0)
 ; PTIEN         Patient IEN (DFN)
"RTN","ROREXT03",111,0)
 ;
"RTN","ROREXT03",112,0)
 ; .RGIENLST     Reference to a local array containing registry
"RTN","ROREXT03",113,0)
 ;               IENs as subscripts and IENs of the corresponding
"RTN","ROREXT03",114,0)
 ;               patient's registry records as values.
"RTN","ROREXT03",115,0)
 ;
"RTN","ROREXT03",116,0)
 ; BATCHID
"RTN","ROREXT03",117,0)
 ;
"RTN","ROREXT03",118,0)
 ; Return Values:
"RTN","ROREXT03",119,0)
 ;       <0  Error Code
"RTN","ROREXT03",120,0)
 ;        0  Ok
"RTN","ROREXT03",121,0)
 ;
"RTN","ROREXT03",122,0)
UPDRECS(PTIEN,RGIENLST,BATCHID,ENDT) ;
"RTN","ROREXT03",123,0)
 N FS,IEN,IENS,RC,REGIEN,RORFDA,RORMSG
"RTN","ROREXT03",124,0)
 S (RC,REGIEN)=0
"RTN","ROREXT03",125,0)
 F  S REGIEN=$O(RGIENLST(REGIEN))  Q:REGIEN'>0  D  Q:RC<0
"RTN","ROREXT03",126,0)
 . K RORFDA,RORMSG
"RTN","ROREXT03",127,0)
 . S IEN=+RGIENLST(REGIEN)  Q:IEN'>0
"RTN","ROREXT03",128,0)
 . S IENS=IEN_","
"RTN","ROREXT03",129,0)
 . ;--- Store the Message ID in the registry
"RTN","ROREXT03",130,0)
 . S:BATCHID'="" RORFDA(798,IENS,10)=BATCHID
"RTN","ROREXT03",131,0)
 . ;--- Otherwise, populate the MESSAGE ID field with a fake ID.
"RTN","ROREXT03",132,0)
 . ;    This will force the message status checkup process to
"RTN","ROREXT03",133,0)
 . ;    update the DATA ACKNOWLEDGED UNTIL field so that the next
"RTN","ROREXT03",134,0)
 . ;    data extraction process will not browse through the data
"RTN","ROREXT03",135,0)
 . ;--- already processed by the previous one.
"RTN","ROREXT03",136,0)
 . S:BATCHID="" RORFDA(798,IENS,10)=ROREXT("HL7MID")_"-0"
"RTN","ROREXT03",137,0)
 . ;--- Always update the DATA EXTRACTED UNTIL field
"RTN","ROREXT03",138,0)
 . S RORFDA(798,IENS,9.2)=ENDT
"RTN","ROREXT03",139,0)
 . ;--- Update the registry record
"RTN","ROREXT03",140,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","ROREXT03",141,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,PTIEN,798,IENS)
"RTN","ROREXT03",142,0)
 ;---
"RTN","ROREXT03",143,0)
 Q $S(RC<0:RC,1:0)
"RTN","ROREXTUT")
0^40^B39216710
"RTN","ROREXTUT",1,0)
ROREXTUT ;HCIOFO/SG - DATA EXTRACT UTILITIES  ; 11/25/05 3:57pm
"RTN","ROREXTUT",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","ROREXTUT",3,0)
 ;
"RTN","ROREXTUT",4,0)
 Q
"RTN","ROREXTUT",5,0)
 ;
"RTN","ROREXTUT",6,0)
 ;***** PRINT SOME DEBUG INFORMATION
"RTN","ROREXTUT",7,0)
DEBUG ;
"RTN","ROREXTUT",8,0)
 D ZW^RORUTL01("ROREXT","Control Data")
"RTN","ROREXTUT",9,0)
 D ZW^RORUTL01("RORLRC","Lab Results to extract")
"RTN","ROREXTUT",10,0)
 W !,"Job number: ",$J,!
"RTN","ROREXTUT",11,0)
 Q
"RTN","ROREXTUT",12,0)
 ;
"RTN","ROREXTUT",13,0)
 ;***** ADDS THE TIME FRAME TO THE LIST
"RTN","ROREXTUT",14,0)
 ;
"RTN","ROREXTUT",15,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","ROREXTUT",16,0)
 ;               data extraction time frames are stored.
"RTN","ROREXTUT",17,0)
 ;
"RTN","ROREXTUT",18,0)
 ; STDT          Start date (FileMan)
"RTN","ROREXTUT",19,0)
 ; ENDT          End Date   (FileMan)
"RTN","ROREXTUT",20,0)
 ;
"RTN","ROREXTUT",21,0)
 ; DTAR          Data area code (see the ROR DATA AREA file #799.33)
"RTN","ROREXTUT",22,0)
 ;
"RTN","ROREXTUT",23,0)
 ; [MAIN]        If this parameter defined and not zero, the time
"RTN","ROREXTUT",24,0)
 ;               frame is considered the main one.
"RTN","ROREXTUT",25,0)
 ;
"RTN","ROREXTUT",26,0)
 ; Variants of positional relationship of the existing time frames
"RTN","ROREXTUT",27,0)
 ; and the one that is being added to the list (STDT-ENDT):
"RTN","ROREXTUT",28,0)
 ;
"RTN","ROREXTUT",29,0)
 ; (1)  +--------TMP                      +----------+
"RTN","ROREXTUT",30,0)
 ;                     STDT--------ENDT
"RTN","ROREXTUT",31,0)
 ;
"RTN","ROREXTUT",32,0)
 ; (2)           +--------TMP
"RTN","ROREXTUT",33,0)
 ;      STDT--------ENDT
"RTN","ROREXTUT",34,0)
 ;
"RTN","ROREXTUT",35,0)
 ; (3)  TMP--------+
"RTN","ROREXTUT",36,0)
 ;           STDT--------ENDT
"RTN","ROREXTUT",37,0)
 ;
"RTN","ROREXTUT",38,0)
 ; (4)         +--------+
"RTN","ROREXTUT",39,0)
 ;      STDT------------------ENDT
"RTN","ROREXTUT",40,0)
 ;
"RTN","ROREXTUT",41,0)
DXADD(DXDTS,STDT,ENDT,DTAR,MAIN) ;
"RTN","ROREXTUT",42,0)
 Q:STDT>ENDT
"RTN","ROREXTUT",43,0)
 N DATE,EXIT,TMP
"RTN","ROREXTUT",44,0)
 ;--- Update the main time frame
"RTN","ROREXTUT",45,0)
 I $G(MAIN)  D  S DTAR=0
"RTN","ROREXTUT",46,0)
 . S TMP=+$P(DXDTS,U)
"RTN","ROREXTUT",47,0)
 . S:(TMP'>0)!(STDT<TMP) $P(DXDTS,U,1)=STDT
"RTN","ROREXTUT",48,0)
 . S:ENDT>$P(DXDTS,U,2) $P(DXDTS,U,2)=ENDT
"RTN","ROREXTUT",49,0)
 ;--- Merge the time frames if possible
"RTN","ROREXTUT",50,0)
 S DATE=$O(DXDTS(DTAR,ENDT)),EXIT=0
"RTN","ROREXTUT",51,0)
 F  S DATE=$O(DXDTS(DTAR,DATE),-1)  Q:DATE=""  D  Q:EXIT
"RTN","ROREXTUT",52,0)
 . S TMP=$P(DXDTS(DTAR,DATE),U,2)
"RTN","ROREXTUT",53,0)
 . I TMP<STDT  S EXIT=1  Q          ; (1)
"RTN","ROREXTUT",54,0)
 . S:TMP>ENDT ENDT=TMP              ; (2)
"RTN","ROREXTUT",55,0)
 . S TMP=$P(DXDTS(DTAR,DATE),U)
"RTN","ROREXTUT",56,0)
 . S:TMP<STDT STDT=TMP              ; (3)
"RTN","ROREXTUT",57,0)
 . K DXDTS(DTAR,DATE)
"RTN","ROREXTUT",58,0)
 ;--- Store the new time frame
"RTN","ROREXTUT",59,0)
 S DXDTS(DTAR,STDT)=STDT_U_ENDT
"RTN","ROREXTUT",60,0)
 Q
"RTN","ROREXTUT",61,0)
 ;
"RTN","ROREXTUT",62,0)
 ;***** CALCULATES THE MAIN DATA EXTRACTION TIME FRAME
"RTN","ROREXTUT",63,0)
 ;
"RTN","ROREXTUT",64,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","ROREXTUT",65,0)
 ;               data extraction time frames are stored.
"RTN","ROREXTUT",66,0)
 ;
"RTN","ROREXTUT",67,0)
 ; IEN           IEN of the patient's record in the registry
"RTN","ROREXTUT",68,0)
 ;
"RTN","ROREXTUT",69,0)
 ; Return Values:
"RTN","ROREXTUT",70,0)
 ;        <0  Error Code
"RTN","ROREXTUT",71,0)
 ;         0  Ok
"RTN","ROREXTUT",72,0)
 ;        >0  Skip the patient
"RTN","ROREXTUT",73,0)
 ;
"RTN","ROREXTUT",74,0)
 ; If the special extraction start date for all patients is defined
"RTN","ROREXTUT",75,0)
 ; then it is as the start date of the main time frame. Usually,
"RTN","ROREXTUT",76,0)
 ; this mode is not used. ;-)
"RTN","ROREXTUT",77,0)
 ;
"RTN","ROREXTUT",78,0)
 ; If the field #9.1 of the patient record in the registry (#798)
"RTN","ROREXTUT",79,0)
 ; has a value then this value is used as the start date of the
"RTN","ROREXTUT",80,0)
 ; main time frame (data have already been extracted until that
"RTN","ROREXTUT",81,0)
 ; date). This field is empty for new patients.
"RTN","ROREXTUT",82,0)
 ;
"RTN","ROREXTUT",83,0)
 ; The function tries to get the earliest date when a selection rule
"RTN","ROREXTUT",84,0)
 ; has been triggered for the newly added patient. If the patient has
"RTN","ROREXTUT",85,0)
 ; been added manually and there are no selection rules in the
"RTN","ROREXTUT",86,0)
 ; SELECTION RULE multiple of the registry record then a date when
"RTN","ROREXTUT",87,0)
 ; the patient was added to the registry is used.
"RTN","ROREXTUT",88,0)
 ;
"RTN","ROREXTUT",89,0)
 ; After that, extract period for new patients (value of the field
"RTN","ROREXTUT",90,0)
 ; #7 of the file #798.1) is subtracted from the date and the result
"RTN","ROREXTUT",91,0)
 ; is used as the start date. If the extract period is not set for
"RTN","ROREXTUT",92,0)
 ; the registry then a default value (365) is used.
"RTN","ROREXTUT",93,0)
 ;
"RTN","ROREXTUT",94,0)
DXMAIN(DXDTS,IEN) ;
"RTN","ROREXTUT",95,0)
 N ENDT,IENS,LCH,RC,RORBUF,RORMSG,STDT,TMP
"RTN","ROREXTUT",96,0)
 S (ENDT,STDT)="",IENS=IEN_",",LCH=0
"RTN","ROREXTUT",97,0)
 ;--- Get the registry record data
"RTN","ROREXTUT",98,0)
 D GETS^DIQ(798,IENS,"1;3;3.2;4;5;9.1","I","RORBUF","RORMSG")
"RTN","ROREXTUT",99,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","ROREXTUT",100,0)
 S ENDT=$$FMADD^XLFDT(ROREXT("DXEND"),-$G(ROREXT("LD",1)))
"RTN","ROREXTUT",101,0)
 F TMP=4,5  S:$G(RORBUF(798,IENS,TMP,"I")) LCH=1
"RTN","ROREXTUT",102,0)
 ;--- Empty time frame for patients who are marked for deletion
"RTN","ROREXTUT",103,0)
 I $G(RORBUF(798,IENS,3,"I"))=5  D  Q 0
"RTN","ROREXTUT",104,0)
 . D DXADD(.DXDTS,ENDT,ENDT,0,1)
"RTN","ROREXTUT",105,0)
 ;--- Special start date for ALL patients (if defined)
"RTN","ROREXTUT",106,0)
 S STDT=$G(ROREXT("DXBEG"))
"RTN","ROREXTUT",107,0)
 I STDT'>0  D
"RTN","ROREXTUT",108,0)
 . ;--- Start date from the patient's registry record
"RTN","ROREXTUT",109,0)
 . ;--- (value of the DATA ACKNOWLEDGED UNTIL field)
"RTN","ROREXTUT",110,0)
 . S STDT=$G(RORBUF(798,IENS,9.1,"I"))\1  Q:STDT>0
"RTN","ROREXTUT",111,0)
 . ;--- If value of the DATA ACKNOWLEDGED UNTIL field is missing or
"RTN","ROREXTUT",112,0)
 . ;    not greater than 0, then the patient is considered new and
"RTN","ROREXTUT",113,0)
 . ;    the start date is calculated as date of earliest selection
"RTN","ROREXTUT",114,0)
 . ;    rule minus maximum value of the EXTRACT PERIOD FOR NEW
"RTN","ROREXTUT",115,0)
 . ;--- PATIENT field for all processed registries.
"RTN","ROREXTUT",116,0)
 . S STDT=$G(RORBUF(798,IENS,3.2,"I"))  Q:STDT'>0
"RTN","ROREXTUT",117,0)
 . S TMP=+$G(ROREXT("EXTRDAYS"))
"RTN","ROREXTUT",118,0)
 . S STDT=$$FMADD^XLFDT(STDT,-$S(TMP>0:TMP,1:365))\1
"RTN","ROREXTUT",119,0)
 ;--- Check the dates and add the time frame to the list
"RTN","ROREXTUT",120,0)
 I (STDT'>0)!(ENDT'>0)  D  Q RC
"RTN","ROREXTUT",121,0)
 . S TMP=$$GET1^DIQ(798,IENS,.01,"I",,"RORMSG")
"RTN","ROREXTUT",122,0)
 . S RC=$$ERROR^RORERR(-32,,,TMP,STDT,ENDT)
"RTN","ROREXTUT",123,0)
 S RC=0
"RTN","ROREXTUT",124,0)
 I STDT'<ENDT  S RC=1  S:LCH STDT=ENDT,RC=0
"RTN","ROREXTUT",125,0)
 D:'RC DXADD(.DXDTS,STDT,ENDT,0,1)
"RTN","ROREXTUT",126,0)
 Q RC
"RTN","ROREXTUT",127,0)
 ;
"RTN","ROREXTUT",128,0)
 ;***** MERGES SPECIAL TIME FRAMES INTO THE 'DATA-SPECIFIC' LISTS
"RTN","ROREXTUT",129,0)
 ;
"RTN","ROREXTUT",130,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","ROREXTUT",131,0)
 ;               data extraction time frames are stored.
"RTN","ROREXTUT",132,0)
 ;
"RTN","ROREXTUT",133,0)
DXMERGE(DXDTS) ;
"RTN","ROREXTUT",134,0)
 N DTAR,TMP
"RTN","ROREXTUT",135,0)
 S DTAR=0
"RTN","ROREXTUT",136,0)
 F  S DTAR=$O(ROREXT("DTAR",DTAR))  Q:DTAR'>0  D
"RTN","ROREXTUT",137,0)
 . ;--- Main time frame
"RTN","ROREXTUT",138,0)
 . D DXADD(.DXDTS,$P(DXDTS,U),$P(DXDTS,U,2),DTAR)
"RTN","ROREXTUT",139,0)
 . ;--- Data-specific time frame
"RTN","ROREXTUT",140,0)
 . S TMP=$G(ROREXT("DTAR",DTAR))
"RTN","ROREXTUT",141,0)
 . D:TMP>0 DXADD(.DXDTS,$P(TMP,U),$P(TMP,U,2),DTAR)
"RTN","ROREXTUT",142,0)
 Q
"RTN","ROREXTUT",143,0)
 ;
"RTN","ROREXTUT",144,0)
 ;***** ADDS DATA EXTRACTION PERIODS FOR THE PATIENT TO THE LIST
"RTN","ROREXTUT",145,0)
 ;
"RTN","ROREXTUT",146,0)
 ; .DXDTS        Reference to a local variable that the data
"RTN","ROREXTUT",147,0)
 ;               extraction time frames are added to. The
"RTN","ROREXTUT",148,0)
 ;               main time frame is returned in the root node:
"RTN","ROREXTUT",149,0)
 ;
"RTN","ROREXTUT",150,0)
 ;  DXDTS(         MainStartDate^MainEndDate  (FileMan)
"RTN","ROREXTUT",151,0)
 ;    DataArea,
"RTN","ROREXTUT",152,0)
 ;      i)         StartDate^EndDate          (FileMan)
"RTN","ROREXTUT",153,0)
 ;
"RTN","ROREXTUT",154,0)
 ; IEN           IEN of the patient record in the registry
"RTN","ROREXTUT",155,0)
 ;
"RTN","ROREXTUT",156,0)
 ; PATIEN        Patient IEN
"RTN","ROREXTUT",157,0)
 ;
"RTN","ROREXTUT",158,0)
 ; Return Values:
"RTN","ROREXTUT",159,0)
 ;        <0  Error Code
"RTN","ROREXTUT",160,0)
 ;         0  Ok
"RTN","ROREXTUT",161,0)
 ;        >0  Skip the patient
"RTN","ROREXTUT",162,0)
 ;
"RTN","ROREXTUT",163,0)
DXPERIOD(DXDTS,IEN,PATIEN) ;
"RTN","ROREXTUT",164,0)
 N AREA,ENDT,EVTDT,EVTIEN,NODE,RC,STDT,TMP
"RTN","ROREXTUT",165,0)
 S DXDTS=$G(DXDTS)
"RTN","ROREXTUT",166,0)
 ;
"RTN","ROREXTUT",167,0)
 ;=== Main data extraction time frame
"RTN","ROREXTUT",168,0)
 S RC=$$DXMAIN(.DXDTS,IEN)  Q:RC RC
"RTN","ROREXTUT",169,0)
 ;
"RTN","ROREXTUT",170,0)
 ;=== Data-specific protocols (only Inpatient at present)
"RTN","ROREXTUT",171,0)
 ; The Inpatient protocol is not used anymore because now the
"RTN","ROREXTUT",172,0)
 ; data search is performed on the PTF CLOSE OUT file instead
"RTN","ROREXTUT",173,0)
 ; of the PTF file (after patch ROR*1*8).
"RTN","ROREXTUT",174,0)
 ;S NODE=$NA(^RORDATA(798.3,+PATIEN,2))
"RTN","ROREXTUT",175,0)
 ;F AREA=3  D
"RTN","ROREXTUT",176,0)
 ;. ;--- Browse the events in the main time frame
"RTN","ROREXTUT",177,0)
 ;. S EVTDT=$O(@NODE@("AT",AREA,+DXDTS),-1)
"RTN","ROREXTUT",178,0)
 ;. S ENDT=+$P(DXDTS,U,2)
"RTN","ROREXTUT",179,0)
 ;. F  S EVTDT=$O(@NODE@("AT",AREA,EVTDT))  Q:'EVTDT!(EVTDT'<ENDT)  D
"RTN","ROREXTUT",180,0)
 ;. . S EVTIEN=""
"RTN","ROREXTUT",181,0)
 ;. . F  S EVTIEN=$O(@NODE@("AT",AREA,EVTDT,EVTIEN))  Q:EVTIEN=""  D
"RTN","ROREXTUT",182,0)
 ;. . . S TMP=$P($G(@NODE@(EVTIEN,0)),U,3)\1
"RTN","ROREXTUT",183,0)
 ;. . . D:TMP>0 DXADD(.DXDTS,TMP,$$FMADD^XLFDT(TMP,1),AREA)
"RTN","ROREXTUT",184,0)
 ;
"RTN","ROREXTUT",185,0)
 ;=== Data-specific 'sliding windows'
"RTN","ROREXTUT",186,0)
 D:$G(ROREXT("HDTIEN"))'>0
"RTN","ROREXTUT",187,0)
 . S STDT=$$FMADD^XLFDT($P(DXDTS,U,1),-60)
"RTN","ROREXTUT",188,0)
 . S ENDT=$$FMADD^XLFDT($P(DXDTS,U,2),-60)
"RTN","ROREXTUT",189,0)
 . D DXADD(.DXDTS,STDT,ENDT,7)  ; Autopsy
"RTN","ROREXTUT",190,0)
 ;
"RTN","ROREXTUT",191,0)
 ;=== Merge the main time frame into the data-specific ones
"RTN","ROREXTUT",192,0)
 D DXMERGE(.DXDTS)
"RTN","ROREXTUT",193,0)
 Q 0
"RTN","ROREXTUT",194,0)
 ;
"RTN","ROREXTUT",195,0)
 ;***** UPDATES DATA EXTRACTION PARAMETERS OF THE REGISTRY
"RTN","ROREXTUT",196,0)
 ;
"RTN","ROREXTUT",197,0)
 ; .REGLST       Reference to a local array containing registry names
"RTN","ROREXTUT",198,0)
 ;               as subscripts and optional registry IENs as values
"RTN","ROREXTUT",199,0)
 ;
"RTN","ROREXTUT",200,0)
 ; Return values:
"RTN","ROREXTUT",201,0)
 ;       <0  Error code
"RTN","ROREXTUT",202,0)
 ;        0  Ok
"RTN","ROREXTUT",203,0)
 ;
"RTN","ROREXTUT",204,0)
TMSTMP(REGLST) ;
"RTN","ROREXTUT",205,0)
 N DATE,RC,REGIEN,REGIENS,REGNAME,RORFDA,RORMSG
"RTN","ROREXTUT",206,0)
 S RC=0,DATE=ROREXT("DXEND")\1
"RTN","ROREXTUT",207,0)
 ;---
"RTN","ROREXTUT",208,0)
 S REGNAME=""
"RTN","ROREXTUT",209,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:RC<0
"RTN","ROREXTUT",210,0)
 . ;--- Get the registry IEN
"RTN","ROREXTUT",211,0)
 . S REGIEN=+$G(REGLST(REGNAME))
"RTN","ROREXTUT",212,0)
 . I REGIEN'>0  D  I REGIEN'>0  S RC=+REGIEN  Q
"RTN","ROREXTUT",213,0)
 . . S REGIEN=$$REGIEN^RORUTL02(REGNAME)
"RTN","ROREXTUT",214,0)
 . S REGIENS=REGIEN_","
"RTN","ROREXTUT",215,0)
 . ;--- Do not update timestamp after historical data extractions
"RTN","ROREXTUT",216,0)
 . I $G(ROREXT("HDTIEN"))'>0  D  Q:RC<0
"RTN","ROREXTUT",217,0)
 . . ;--- Check if the new date until that data has been extracted
"RTN","ROREXTUT",218,0)
 . . ;    is greater than that stored in the registry parameters
"RTN","ROREXTUT",219,0)
 . . S TMP=$$GET1^DIQ(798.1,REGIENS,2,"I",,"RORMSG")
"RTN","ROREXTUT",220,0)
 . . I $G(DIERR)  D  Q
"RTN","ROREXTUT",221,0)
 . . . S RC=$$DBS^RORERR("RORMSG",-9,,,798.1,REGIENS)
"RTN","ROREXTUT",222,0)
 . . S:DATE>TMP RORFDA(798.1,REGIENS,2)=DATE
"RTN","ROREXTUT",223,0)
 . ;--- Increment the number of attempts
"RTN","ROREXTUT",224,0)
 . D:$G(ROREXT("NBM"))>0
"RTN","ROREXTUT",225,0)
 . . S TMP=$$GET1^DIQ(798.1,REGIENS,19.3,"I",,"RORMSG")
"RTN","ROREXTUT",226,0)
 . . S RORFDA(798.1,REGIENS,19.3)=TMP+1
"RTN","ROREXTUT",227,0)
 . ;--- Update registry parameters
"RTN","ROREXTUT",228,0)
 . Q:$D(RORFDA)<10
"RTN","ROREXTUT",229,0)
 . D FILE^DIE("K","RORFDA","RORMSG")
"RTN","ROREXTUT",230,0)
 . I $G(DIERR)  D  Q
"RTN","ROREXTUT",231,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,798.1,REGIENS)
"RTN","ROREXTUT",232,0)
 . ;--- Reset all report stats
"RTN","ROREXTUT",233,0)
 . D CLEAR^RORTSK12(REGIEN)
"RTN","ROREXTUT",234,0)
 ;---
"RTN","ROREXTUT",235,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORHDT")
0^41^B15352700
"RTN","RORHDT",1,0)
RORHDT ;HCIOFO/SG - HISTORICAL DATA EXTRACTION ; 1/22/06 5:54pm
"RTN","RORHDT",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHDT",3,0)
 ;
"RTN","RORHDT",4,0)
 ; RORHDT -------------- HISTORICAL DATA EXTRACTION DESCRIPTOR
"RTN","RORHDT",5,0)
 ;
"RTN","RORHDT",6,0)
 ; RORHDT("BHS")         If this node has a non-zero value, the
"RTN","RORHDT",7,0)
 ;                       $$COMMIT^RORHDT05 function outputs a BHS
"RTN","RORHDT",8,0)
 ;                       segment before writing the data from the
"RTN","RORHDT",9,0)
 ;                       ^TMP("HLS",$J) node. Then it kills the
"RTN","RORHDT",10,0)
 ;                       RORHDT("BHS") node.
"RTN","RORHDT",11,0)
 ;
"RTN","RORHDT",12,0)
 ; See also descriptions of the ^TMP("RORHDT") node in the ^ROR01
"RTN","RORHDT",13,0)
 ; routine.
"RTN","RORHDT",14,0)
 ;
"RTN","RORHDT",15,0)
 Q
"RTN","RORHDT",16,0)
 ;
"RTN","RORHDT",17,0)
 ;***** (RE)CREATES A DATA EXTRACTION TASK TABLE
"RTN","RORHDT",18,0)
CREATE ;
"RTN","RORHDT",19,0)
 N RORERRDL      ; Default error location
"RTN","RORHDT",20,0)
 N RORERROR      ; Error processing data
"RTN","RORHDT",21,0)
 N RORPARM       ; Application parameters
"RTN","RORHDT",22,0)
 ;
"RTN","RORHDT",23,0)
 N HDEIEN,RC
"RTN","RORHDT",24,0)
 S RORPARM("ERR")=1
"RTN","RORHDT",25,0)
 ;S RORPARM("DEBUG")=2 ; Remove the first ';' to start in debug mode
"RTN","RORHDT",26,0)
 D CLEAR^RORERR("CREATE^RORHDT")
"RTN","RORHDT",27,0)
 ;--- Select a data extraction
"RTN","RORHDT",28,0)
 S HDEIEN=$$SELHDE^RORHDTUT()  G:HDEIEN<0 ERROR
"RTN","RORHDT",29,0)
 Q:'HDEIEN
"RTN","RORHDT",30,0)
 ;--- Request a confirmation
"RTN","RORHDT",31,0)
 S RC=$$CREATE^RORHDTAC(HDEIEN)
"RTN","RORHDT",32,0)
 I RC  G:RC<0 ERROR  Q
"RTN","RORHDT",33,0)
 ;--- Create a new task table
"RTN","RORHDT",34,0)
 S RC=$$CREATE^RORHDT02(HDEIEN)    G:RC<0 ERROR
"RTN","RORHDT",35,0)
 W:'RC !,"New task table has been created."
"RTN","RORHDT",36,0)
 Q
"RTN","RORHDT",37,0)
 ;
"RTN","RORHDT",38,0)
 ;***** EDITS THE EXTRACTION DEFINITION
"RTN","RORHDT",39,0)
EDITHDE ;
"RTN","RORHDT",40,0)
 N DA,DIE,DIDEL,DR,DTOUT,NATIONAL
"RTN","RORHDT",41,0)
 ;--- Select a data extraction
"RTN","RORHDT",42,0)
 S DA=$$SELHDE^RORHDTUT("A",,.NATIONAL)  G:DA<0 ERROR
"RTN","RORHDT",43,0)
 Q:'DA
"RTN","RORHDT",44,0)
 ;--- Edit the parameters
"RTN","RORHDT",45,0)
 S DIE=$$ROOT^DILFD(799.6)
"RTN","RORHDT",46,0)
 S DR="[RORHDT EDIT "_$S(NATIONAL:"NATIONAL EXTRACT]",1:"EXTRACTION]")
"RTN","RORHDT",47,0)
 W !  D ^DIE
"RTN","RORHDT",48,0)
 Q
"RTN","RORHDT",49,0)
 ;
"RTN","RORHDT",50,0)
 ;***** DISPLAYS THE ERRORS
"RTN","RORHDT",51,0)
ERROR ;
"RTN","RORHDT",52,0)
 D DSPSTK^RORERR()
"RTN","RORHDT",53,0)
 Q
"RTN","RORHDT",54,0)
 ;
"RTN","RORHDT",55,0)
 ;***** DISPLAYS THE LATEST LOG OF THE TASK
"RTN","RORHDT",56,0)
LOG ;
"RTN","RORHDT",57,0)
 N RORERRDL      ; Default error location
"RTN","RORHDT",58,0)
 N RORERROR      ; Error processing data
"RTN","RORHDT",59,0)
 N RORPARM       ; Application parameters
"RTN","RORHDT",60,0)
 ;
"RTN","RORHDT",61,0)
 N HDEIEN,POP,RC,TASKIEN
"RTN","RORHDT",62,0)
 S RORPARM("ERR")=1
"RTN","RORHDT",63,0)
 ;S RORPARM("DEBUG")=2 ; Remove the first ';' to start in debug mode
"RTN","RORHDT",64,0)
 D CLEAR^RORERR("LOG^RORHDT")
"RTN","RORHDT",65,0)
 ;--- Select data extraction and task
"RTN","RORHDT",66,0)
 S HDEIEN=$$SELHDE^RORHDTUT()           G:HDEIEN<0 ERROR
"RTN","RORHDT",67,0)
 Q:'HDEIEN
"RTN","RORHDT",68,0)
 S TASKIEN=$$SELTASK^RORHDTUT(HDEIEN)  G:TASKIEN<0 ERROR
"RTN","RORHDT",69,0)
 Q:'TASKIEN
"RTN","RORHDT",70,0)
 ;--- Display the log
"RTN","RORHDT",71,0)
 S RC=$$LOG^RORHDT01(HDEIEN,TASKIEN)        G:RC<0 ERROR
"RTN","RORHDT",72,0)
 Q
"RTN","RORHDT",73,0)
 ;
"RTN","RORHDT",74,0)
 ;***** STARTS A DATA EXTRACTION TASK
"RTN","RORHDT",75,0)
START ;
"RTN","RORHDT",76,0)
 N RORERRDL      ; Default error location
"RTN","RORHDT",77,0)
 N RORERROR      ; Error processing data
"RTN","RORHDT",78,0)
 N RORPARM       ; Application parameters
"RTN","RORHDT",79,0)
 ;
"RTN","RORHDT",80,0)
 N FAM,HDEIEN,RC,TASKIEN
"RTN","RORHDT",81,0)
 S RORPARM("ERR")=1
"RTN","RORHDT",82,0)
 ;S RORPARM("DEBUG")=2 ; Remove the first ';' to start in debug mode
"RTN","RORHDT",83,0)
 D CLEAR^RORERR("START^RORHDT")
"RTN","RORHDT",84,0)
 ;--- Select data extraction and task
"RTN","RORHDT",85,0)
 S HDEIEN=$$SELHDE^RORHDTUT()           G:HDEIEN<0 ERROR
"RTN","RORHDT",86,0)
 Q:'HDEIEN
"RTN","RORHDT",87,0)
 S TASKIEN=$$SELTASK^RORHDTUT(HDEIEN)  G:TASKIEN<0 ERROR
"RTN","RORHDT",88,0)
 Q:'TASKIEN
"RTN","RORHDT",89,0)
 ;--- Start the task
"RTN","RORHDT",90,0)
 S RC=$$START^RORHDTAC(HDEIEN,TASKIEN,.FAM)
"RTN","RORHDT",91,0)
 I RC  G:RC<0 ERROR  Q
"RTN","RORHDT",92,0)
 S RC=$$START^RORHDT03(HDEIEN,TASKIEN,FAM)  G:RC<0 ERROR
"RTN","RORHDT",93,0)
 Q
"RTN","RORHDT",94,0)
 ;
"RTN","RORHDT",95,0)
 ;***** DISPLAYS DATA EXTRACTION STATUS
"RTN","RORHDT",96,0)
STATUS ;
"RTN","RORHDT",97,0)
 N RORERRDL      ; Default error location
"RTN","RORHDT",98,0)
 N RORERROR      ; Error processing data
"RTN","RORHDT",99,0)
 N RORPARM       ; Application parameters
"RTN","RORHDT",100,0)
 ;
"RTN","RORHDT",101,0)
 N DIR,HDEIEN,POP,RC,TMP
"RTN","RORHDT",102,0)
 S RORPARM("ERR")=1
"RTN","RORHDT",103,0)
 ;S RORPARM("DEBUG")=2 ; Remove the first ';' to start in debug mode
"RTN","RORHDT",104,0)
 D CLEAR^RORERR("STATUS^RORHDT")
"RTN","RORHDT",105,0)
 ;--- Select a data extraction
"RTN","RORHDT",106,0)
 S HDEIEN=$$SELHDE^RORHDTUT()  G:HDEIEN<0 ERROR
"RTN","RORHDT",107,0)
 Q:'HDEIEN
"RTN","RORHDT",108,0)
 ;--- Display status of the data extraction
"RTN","RORHDT",109,0)
 S RC=$$STATUS^RORHDT01(HDEIEN)
"RTN","RORHDT",110,0)
 W !  D PAGE^RORHDTUT(),^%ZISC     G:RC<0 ERROR
"RTN","RORHDT",111,0)
 Q
"RTN","RORHDT",112,0)
 ;
"RTN","RORHDT",113,0)
 ;***** STOPS A DATA EXTRACTION TASK
"RTN","RORHDT",114,0)
STOP ;
"RTN","RORHDT",115,0)
 N RORERRDL      ; Default error location
"RTN","RORHDT",116,0)
 N RORERROR      ; Error processing data
"RTN","RORHDT",117,0)
 N RORPARM       ; Application parameters
"RTN","RORHDT",118,0)
 ;
"RTN","RORHDT",119,0)
 N HDEIEN,RC,TASKIEN
"RTN","RORHDT",120,0)
 S RORPARM("ERR")=1
"RTN","RORHDT",121,0)
 ;S RORPARM("DEBUG")=2 ; Remove the first ';' to start in debug mode
"RTN","RORHDT",122,0)
 D CLEAR^RORERR("STOP^RORHDT")
"RTN","RORHDT",123,0)
 ;--- Select data extraction and task
"RTN","RORHDT",124,0)
 S HDEIEN=$$SELHDE^RORHDTUT()           G:HDEIEN<0 ERROR
"RTN","RORHDT",125,0)
 Q:'HDEIEN
"RTN","RORHDT",126,0)
 S TASKIEN=$$SELTASK^RORHDTUT(HDEIEN)  G:TASKIEN<0 ERROR
"RTN","RORHDT",127,0)
 Q:'TASKIEN
"RTN","RORHDT",128,0)
 ;--- Stop the task
"RTN","RORHDT",129,0)
 S RC=$$STOP^RORHDTAC(HDEIEN,TASKIEN)
"RTN","RORHDT",130,0)
 I RC  G:RC<0 ERROR  Q
"RTN","RORHDT",131,0)
 S RC=$$STOP^RORHDT03(HDEIEN,TASKIEN)       G:RC<0 ERROR
"RTN","RORHDT",132,0)
 Q
"RTN","RORHDT01")
0^42^B3904620
"RTN","RORHDT01",1,0)
RORHDT01 ;HCIOFO/SG - HISTORICAL DATA EXTRACTION STATUS ; 12/21/05 3:41pm
"RTN","RORHDT01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHDT01",3,0)
 ;
"RTN","RORHDT01",4,0)
 Q
"RTN","RORHDT01",5,0)
 ;
"RTN","RORHDT01",6,0)
 ;***** DISPLAYS THE LATEST TASK LOG
"RTN","RORHDT01",7,0)
 ;
"RTN","RORHDT01",8,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDT01",9,0)
 ; TASKIEN       Task IEN
"RTN","RORHDT01",10,0)
 ;
"RTN","RORHDT01",11,0)
 ; Return Values:
"RTN","RORHDT01",12,0)
 ;       <0  Error code
"RTN","RORHDT01",13,0)
 ;        0  Ok
"RTN","RORHDT01",14,0)
 ;
"RTN","RORHDT01",15,0)
LOG(HDEIEN,TASKIEN) ;
"RTN","RORHDT01",16,0)
 N BY,FIC,FR,IENS,INFO,IOP,L,LOGIEN,RC,TASK,TO
"RTN","RORHDT01",17,0)
 ;--- Get the task number
"RTN","RORHDT01",18,0)
 S TASK=$$TASKNUM^RORHDTUT(HDEIEN,TASKIEN)
"RTN","RORHDT01",19,0)
 Q:TASK<0 TASK
"RTN","RORHDT01",20,0)
 I 'TASK  D  Q 0
"RTN","RORHDT01",21,0)
 . W !!,"Sorry. It appears that this task has not been run."
"RTN","RORHDT01",22,0)
 ;--- Get the task info (Log IEN, in particular)
"RTN","RORHDT01",23,0)
 S RC=$$TASKINFO^RORTSK02(TASK,.INFO,"E")  Q:RC<0 RC
"RTN","RORHDT01",24,0)
 S LOGIEN=+$G(INFO(12))
"RTN","RORHDT01",25,0)
 ;--- Print the log
"RTN","RORHDT01",26,0)
 I LOGIEN>0,$D(^RORDATA(798.7,LOGIEN))  D
"RTN","RORHDT01",27,0)
 . S L=0,DIC=798.7
"RTN","RORHDT01",28,0)
 . S BY="NUMBER;@,4,.01;@",FLDS="[ROR LOG]"
"RTN","RORHDT01",29,0)
 . S (FR,TO)=LOGIEN
"RTN","RORHDT01",30,0)
 . W !  D EN1^DIP
"RTN","RORHDT01",31,0)
 E  W !!,"Sorry. The log is not available."
"RTN","RORHDT01",32,0)
 Q 0
"RTN","RORHDT01",33,0)
 ;
"RTN","RORHDT01",34,0)
 ;***** DISPLAYS DATA EXTRACTION STATUS
"RTN","RORHDT01",35,0)
 ;
"RTN","RORHDT01",36,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDT01",37,0)
 ;
"RTN","RORHDT01",38,0)
 ; Return Values:
"RTN","RORHDT01",39,0)
 ;       <0  Error code
"RTN","RORHDT01",40,0)
 ;        0  Ok
"RTN","RORHDT01",41,0)
 ;
"RTN","RORHDT01",42,0)
STATUS(HDEIEN) ;
"RTN","RORHDT01",43,0)
 N I,IENS,REGLST,RORBUF,RORMSG,TMP
"RTN","RORHDT01",44,0)
 ;--- Get values from the main record
"RTN","RORHDT01",45,0)
 S IENS=(+HDEIEN)_","
"RTN","RORHDT01",46,0)
 D GETS^DIQ(799.6,IENS,".01;.03;.04;2;3*","EI","RORBUF","RORMSG")
"RTN","RORHDT01",47,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.6,IENS)
"RTN","RORHDT01",48,0)
 ;--- Compile the list of registries
"RTN","RORHDT01",49,0)
 S (I,REGLST)=""
"RTN","RORHDT01",50,0)
 F  S I=$O(RORBUF(799.63,I))  Q:I=""  D
"RTN","RORHDT01",51,0)
 . S TMP=$G(RORBUF(799.63,I,.01,"E"))
"RTN","RORHDT01",52,0)
 . S:TMP'="" REGLST=REGLST_", "_TMP
"RTN","RORHDT01",53,0)
 ;--- Display the data extraction information
"RTN","RORHDT01",54,0)
 W !
"RTN","RORHDT01",55,0)
 W !,"Name:       ",RORBUF(799.6,IENS,.01,"E")
"RTN","RORHDT01",56,0)
 W !,"Registries: ",$P(REGLST,", ",2,999)
"RTN","RORHDT01",57,0)
 W !,"Date Range: ",$G(RORBUF(799.6,IENS,.03,"E"))
"RTN","RORHDT01",58,0)
 W " -- ",$G(RORBUF(799.6,IENS,.04,"E"))
"RTN","RORHDT01",59,0)
 W !,"Output Dir: ",$G(RORBUF(799.6,IENS,2,"E")),!
"RTN","RORHDT01",60,0)
 ;--- Display the task list
"RTN","RORHDT01",61,0)
 Q $$TASKLIST^RORHDTUT(HDEIEN)
"RTN","RORHDT02")
0^43^B12578851
"RTN","RORHDT02",1,0)
RORHDT02 ;HCIOFO/SG - CREATE EXTRACTION TASK RECORDS ; 1/25/06 8:56am
"RTN","RORHDT02",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHDT02",3,0)
 ;
"RTN","RORHDT02",4,0)
 Q
"RTN","RORHDT02",5,0)
 ;
"RTN","RORHDT02",6,0)
 ;***** (RE)CREATES THE TASK TABLE
"RTN","RORHDT02",7,0)
 ;
"RTN","RORHDT02",8,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDT02",9,0)
 ; [NTSK]        Number of tasks to create
"RTN","RORHDT02",10,0)
 ;
"RTN","RORHDT02",11,0)
 ; Return Values:
"RTN","RORHDT02",12,0)
 ;       <0  Error code
"RTN","RORHDT02",13,0)
 ;        0  Ok
"RTN","RORHDT02",14,0)
 ;        1  Timeout or "^"
"RTN","RORHDT02",15,0)
 ;
"RTN","RORHDT02",16,0)
CREATE(HDEIEN,NTSK) ;
"RTN","RORHDT02",17,0)
 N BUF,FNAME,I,IENS,REGLST,SILENT,TSKTBL,TMP
"RTN","RORHDT02",18,0)
 S SILENT=($G(NTSK)>0)
"RTN","RORHDT02",19,0)
 ;--- Load the data extract parameters
"RTN","RORHDT02",20,0)
 S IENS=(+HDEIEN)_","
"RTN","RORHDT02",21,0)
 D GETS^DIQ(799.6,IENS,".05;.08;3*",,"RORBUF","RORMSG")
"RTN","RORHDT02",22,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.6,IENS)
"RTN","RORHDT02",23,0)
 ;--- Construct the base file name
"RTN","RORHDT02",24,0)
 S FNAME=$G(RORBUF(799.6,IENS,.08))
"RTN","RORHDT02",25,0)
 S FNAME=$TR(FNAME," !@#$%^&*-+=[]{}|\;:'"",.<>/?`~")
"RTN","RORHDT02",26,0)
 S FNAME=FNAME_"-"_$E($P($$SITE^VASITE(),U,3),1,3)_"-"
"RTN","RORHDT02",27,0)
 ;--- Compile the list of registries
"RTN","RORHDT02",28,0)
 S I=""
"RTN","RORHDT02",29,0)
 F  S I=$O(RORBUF(799.63,I))  Q:I=""  D
"RTN","RORHDT02",30,0)
 . S TMP=$G(RORBUF(799.63,I,.01))  S:TMP'="" REGLST(TMP)=""
"RTN","RORHDT02",31,0)
 ;---
"RTN","RORHDT02",32,0)
 S TMP=+$G(RORBUF(799.6,IENS,.05))
"RTN","RORHDT02",33,0)
 S NTSK=$$TASKTBL(.REGLST,TMP,.TSKTBL,$G(NTSK))
"RTN","RORHDT02",34,0)
 ;--- Ask for the final confirmation
"RTN","RORHDT02",35,0)
 I 'SILENT  D  Q:TMP 1
"RTN","RORHDT02",36,0)
 . N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RORHDT02",37,0)
 . S DIR(0)="Y"
"RTN","RORHDT02",38,0)
 . S DIR("A")="Create the new task table"
"RTN","RORHDT02",39,0)
 . S DIR("B")="NO"
"RTN","RORHDT02",40,0)
 . W !  D ^DIR
"RTN","RORHDT02",41,0)
 . S TMP=$D(DIRUT)!'$G(Y)
"RTN","RORHDT02",42,0)
 ;--- Create the new task table
"RTN","RORHDT02",43,0)
 Q $$UPDTBL(HDEIEN,.TSKTBL,FNAME)
"RTN","RORHDT02",44,0)
 ;
"RTN","RORHDT02",45,0)
 ;***** DISTRIBUTES PATIENTS AMONG THE DATA EXTRACTION TASKS
"RTN","RORHDT02",46,0)
 ;
"RTN","RORHDT02",47,0)
 ; .REGLST       Reference to a local array containing registry
"RTN","RORHDT02",48,0)
 ;               names as the subscripts and optional registry IENs
"RTN","RORHDT02",49,0)
 ;               as the values.
"RTN","RORHDT02",50,0)
 ;
"RTN","RORHDT02",51,0)
 ; MNPTPB        Maximum number of patients per batch
"RTN","RORHDT02",52,0)
 ;
"RTN","RORHDT02",53,0)
 ; .TSKTBL       Reference to a local array where task
"RTN","RORHDT02",54,0)
 ;               desciptors will be stored
"RTN","RORHDT02",55,0)
 ;
"RTN","RORHDT02",56,0)
 ; [NTSK]        If this parameters is defined and greater than 0,
"RTN","RORHDT02",57,0)
 ;               then this number of task is enforced. Moreover,
"RTN","RORHDT02",58,0)
 ;               in this case the function work in silent mode and
"RTN","RORHDT02",59,0)
 ;               do not displays any messages.
"RTN","RORHDT02",60,0)
 ;
"RTN","RORHDT02",61,0)
 ; Return Values:
"RTN","RORHDT02",62,0)
 ;       <0  Error code
"RTN","RORHDT02",63,0)
 ;       >0  Number of tasks
"RTN","RORHDT02",64,0)
 ;
"RTN","RORHDT02",65,0)
TASKTBL(REGLST,MNPTPB,TSKTBL,NTSK) ;
"RTN","RORHDT02",66,0)
 N I,IEN,INC,NPT,NR,PTLST,SILENT
"RTN","RORHDT02",67,0)
 S SILENT=($G(NTSK)>0),PTLST=$$ALLOC^RORTMP()
"RTN","RORHDT02",68,0)
 S:MNPTPB'>0 MNPTPB=1000  K TSKTBL
"RTN","RORHDT02",69,0)
 ;--- Count the registry patients
"RTN","RORHDT02",70,0)
 W:'SILENT !!,"Counting registry patients..."
"RTN","RORHDT02",71,0)
 S NPT=$$REGPTCNT^RORUTL18(.REGLST,"AS",PTLST)
"RTN","RORHDT02",72,0)
 W:'SILENT *13,"Number of unique patients:            ",NPT
"RTN","RORHDT02",73,0)
 ;--- Calculate number of tasks
"RTN","RORHDT02",74,0)
 W:'SILENT !,"Maximum number of patients per batch: ",MNPTPB
"RTN","RORHDT02",75,0)
 I $G(NTSK)'>0  D
"RTN","RORHDT02",76,0)
 . S NTSK=NPT\MNPTPB  S:NPT#MNPTPB NTSK=NTSK+1
"RTN","RORHDT02",77,0)
 E  S:NTSK>NPT NTSK=NPT
"RTN","RORHDT02",78,0)
 ;--- Distribute patients between the tasks
"RTN","RORHDT02",79,0)
 D:NTSK>1
"RTN","RORHDT02",80,0)
 . ;--- Generate IEN intervals (no more than 1000)
"RTN","RORHDT02",81,0)
 . S INC=NPT\1000,NR=0  S:INC<1 INC=1
"RTN","RORHDT02",82,0)
 . F IEN=0:INC  S IEN=$O(@PTLST@(IEN))  Q:IEN'>0  D
"RTN","RORHDT02",83,0)
 . . S NR=NR+1,@PTLST@("I",NR)=IEN
"RTN","RORHDT02",84,0)
 . ;--- Generate the task table
"RTN","RORHDT02",85,0)
 . S IEN=1,INC=NR/NTSK
"RTN","RORHDT02",86,0)
 . F TSKTBL=1:1  D  Q:(TSKTBL'<NTSK)!(IEN'>0)
"RTN","RORHDT02",87,0)
 . . S TSKTBL(TSKTBL)=IEN
"RTN","RORHDT02",88,0)
 . . S I=TSKTBL*INC\1,IEN=$G(@PTLST@("I",I))
"RTN","RORHDT02",89,0)
 . . S $P(TSKTBL(TSKTBL),U,2)=IEN
"RTN","RORHDT02",90,0)
 ;--- Analize the result
"RTN","RORHDT02",91,0)
 I $G(TSKTBL)<2  K TSKTBL  S TSKTBL=1,TSKTBL(1)=1
"RTN","RORHDT02",92,0)
 S $P(TSKTBL(TSKTBL),U,2)=+$O(@PTLST@(" "),-1)
"RTN","RORHDT02",93,0)
 S NTSK=+TSKTBL
"RTN","RORHDT02",94,0)
 ;--- Cleanup
"RTN","RORHDT02",95,0)
 D FREE^RORTMP(PTLST)
"RTN","RORHDT02",96,0)
 W:'SILENT !,"Number of data extraction tasks:      ",NTSK
"RTN","RORHDT02",97,0)
 Q NTSK
"RTN","RORHDT02",98,0)
 ;
"RTN","RORHDT02",99,0)
 ;***** UPDATES THE TASK TABLE
"RTN","RORHDT02",100,0)
 ;
"RTN","RORHDT02",101,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDT02",102,0)
 ;
"RTN","RORHDT02",103,0)
 ; [.TSKTBL]     Reference to a local variable containing a task
"RTN","RORHDT02",104,0)
 ;               table generated by the TASKTBL function.
"RTN","RORHDT02",105,0)
 ;
"RTN","RORHDT02",106,0)
 ; [FNAME]       Base file name
"RTN","RORHDT02",107,0)
 ;
"RTN","RORHDT02",108,0)
 ; Return Values:
"RTN","RORHDT02",109,0)
 ;       <0  Error code
"RTN","RORHDT02",110,0)
 ;        0  Ok
"RTN","RORHDT02",111,0)
 ;
"RTN","RORHDT02",112,0)
UPDTBL(HDEIEN,TSKTBL,FNAME) ;
"RTN","RORHDT02",113,0)
 N I,IENS,RC,RORFDA,RORMSG
"RTN","RORHDT02",114,0)
 S RC=0
"RTN","RORHDT02",115,0)
 ;--- Clear the old table
"RTN","RORHDT02",116,0)
 S RC=$$CLEAR^RORUTL05(799.64,","_(+HDEIEN)_",")  Q:RC<0 RC
"RTN","RORHDT02",117,0)
 ;--- Prepare records in the FDA.
"RTN","RORHDT02",118,0)
 F I=1:1:+TSKTBL  D
"RTN","RORHDT02",119,0)
 . S IENS="+"_I_","_(+HDEIEN)_","
"RTN","RORHDT02",120,0)
 . S RORFDA(799.64,IENS,.01)=+TSKTBL(I)
"RTN","RORHDT02",121,0)
 . S RORFDA(799.64,IENS,.05)=FNAME_$TR($J(I,2)," ","0")_".HDT"
"RTN","RORHDT02",122,0)
 ;--- Update the table
"RTN","RORHDT02",123,0)
 D UPDATE^DIE(,"RORFDA",,"RORMSG")
"RTN","RORHDT02",124,0)
 S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,799.64)
"RTN","RORHDT02",125,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORHDT03")
0^44^B17815439
"RTN","RORHDT03",1,0)
RORHDT03 ;HCIOFO/SG - MANIPULATIONS WITH EXTRACTION TASKS ; 1/23/06 8:40am
"RTN","RORHDT03",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHDT03",3,0)
 ;
"RTN","RORHDT03",4,0)
 Q
"RTN","RORHDT03",5,0)
 ;
"RTN","RORHDT03",6,0)
 ;***** STARTS THE DATA EXTRACTION TASK
"RTN","RORHDT03",7,0)
 ;
"RTN","RORHDT03",8,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDT03",9,0)
 ; TASKIEN       Task IEN
"RTN","RORHDT03",10,0)
 ; FAM           File Access Mode:
"RTN","RORHDT03",11,0)
 ;                 "A"  Append new messages to the file
"RTN","RORHDT03",12,0)
 ;                 "O"  Overwrite the file
"RTN","RORHDT03",13,0)
 ;                 "N"  Modify file name and create a new file
"RTN","RORHDT03",14,0)
 ; [ZTDTH]       Start date/time
"RTN","RORHDT03",15,0)
 ;
"RTN","RORHDT03",16,0)
 ; Return Values:
"RTN","RORHDT03",17,0)
 ;       <0  Error code
"RTN","RORHDT03",18,0)
 ;        0  Ok
"RTN","RORHDT03",19,0)
 ;        1  Start time has not been entered
"RTN","RORHDT03",20,0)
 ;        2  Already running or pending
"RTN","RORHDT03",21,0)
 ;
"RTN","RORHDT03",22,0)
START(HDEIEN,TASKIEN,FAM,ZTDTH) ;
"RTN","RORHDT03",23,0)
 N IENS,PARAMS,RC,RORFDA,RORMSG,STATUS,TASK,TMP
"RTN","RORHDT03",24,0)
 N ZTCPU,ZTDESC,ZTIO,ZTKIL,ZTPRI,ZTRTN,ZTSAVE,ZTSK,ZTSYNC,ZTUCI
"RTN","RORHDT03",25,0)
 ;--- Check status of the task
"RTN","RORHDT03",26,0)
 S STATUS=+$$TASKSTAT^RORHDTUT(HDEIEN,TASKIEN,3)
"RTN","RORHDT03",27,0)
 Q:(STATUS=1)!(STATUS=2)!(STATUS=102) 2
"RTN","RORHDT03",28,0)
 ;--- Start/schedule the task
"RTN","RORHDT03",29,0)
 S PARAMS("PARAMS","HDEIEN")=HDEIEN
"RTN","RORHDT03",30,0)
 S PARAMS("PARAMS","TASKIEN")=TASKIEN
"RTN","RORHDT03",31,0)
 S PARAMS("PARAMS","FAM")=FAM
"RTN","RORHDT03",32,0)
 S ZTDESC="CCR HDE Task #"_TASKIEN
"RTN","RORHDT03",33,0)
 S TASK=$$CREATE^RORTSK(1,"TASK^RORHDT03",,,,,.PARAMS)
"RTN","RORHDT03",34,0)
 Q:TASK<0 TASK
"RTN","RORHDT03",35,0)
 W !,"Task #"_TASK_" has been scheduled."
"RTN","RORHDT03",36,0)
 ;--- Update task number
"RTN","RORHDT03",37,0)
 S IENS=(+TASKIEN)_","_(+HDEIEN)_","
"RTN","RORHDT03",38,0)
 S RORFDA(799.64,IENS,.02)=TASK
"RTN","RORHDT03",39,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORHDT03",40,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.64,IENS)
"RTN","RORHDT03",41,0)
 ;--- Update the last known task status
"RTN","RORHDT03",42,0)
 S TMP=$$TASKSTAT^RORHDTUT(HDEIEN,TASKIEN)
"RTN","RORHDT03",43,0)
 ;--- Success
"RTN","RORHDT03",44,0)
 Q 0
"RTN","RORHDT03",45,0)
 ;
"RTN","RORHDT03",46,0)
 ;***** STOPS THE DATA EXTRACTION TASK
"RTN","RORHDT03",47,0)
 ;
"RTN","RORHDT03",48,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDT03",49,0)
 ; TASKIEN       Task IEN
"RTN","RORHDT03",50,0)
 ;
"RTN","RORHDT03",51,0)
 ; Return Values:
"RTN","RORHDT03",52,0)
 ;       <0  Error code
"RTN","RORHDT03",53,0)
 ;        0  Ok
"RTN","RORHDT03",54,0)
 ;
"RTN","RORHDT03",55,0)
STOP(HDEIEN,TASKIEN) ;
"RTN","RORHDT03",56,0)
 N RC,STATUS,TASK,TMP
"RTN","RORHDT03",57,0)
 ;--- Get status of the task
"RTN","RORHDT03",58,0)
 S STATUS=+$$TASKSTAT^RORHDTUT(HDEIEN,TASKIEN)
"RTN","RORHDT03",59,0)
 Q:STATUS<0 STATUS
"RTN","RORHDT03",60,0)
 ;--- Stop the task if it is running, pending, or suspended
"RTN","RORHDT03",61,0)
 I (STATUS=1)!(STATUS=2)!(STATUS=102)  D  Q:$G(RC)<0 RC
"RTN","RORHDT03",62,0)
 . S TASK=$$TASKNUM^RORHDTUT(HDEIEN,TASKIEN)
"RTN","RORHDT03",63,0)
 . I TASK<0  S RC=+TASK  Q
"RTN","RORHDT03",64,0)
 . S RC=$$DEQUEUE^RORTSK(TASK)
"RTN","RORHDT03",65,0)
 . W:'RC !,"The task #"_TASK_" has been stopped/unscheduled."
"RTN","RORHDT03",66,0)
 . ;--- Update the last known task status
"RTN","RORHDT03",67,0)
 . S STATUS=+$$TASKSTAT^RORHDTUT(HDEIEN,TASKIEN)
"RTN","RORHDT03",68,0)
 ;--- Task is stopping
"RTN","RORHDT03",69,0)
 D:STATUS=103
"RTN","RORHDT03",70,0)
 . W !,"The task #"_TASK_" has not responded to the stop request yet."
"RTN","RORHDT03",71,0)
 Q 0
"RTN","RORHDT03",72,0)
 ;
"RTN","RORHDT03",73,0)
 ;***** HISTORICAL DATA EXTRACTION TASK
"RTN","RORHDT03",74,0)
 ;
"RTN","RORHDT03",75,0)
 ; RORTSK        Task number and task parameters
"RTN","RORHDT03",76,0)
 ;
"RTN","RORHDT03",77,0)
TASK ;
"RTN","RORHDT03",78,0)
 N RORERRDL      ; Default error location
"RTN","RORHDT03",79,0)
 N RORERROR      ; Error processing data
"RTN","RORHDT03",80,0)
 N RORLOG        ; Log susbsystem data
"RTN","RORHDT03",81,0)
 N RORPARM       ; Application parameters
"RTN","RORHDT03",82,0)
 ;
"RTN","RORHDT03",83,0)
 N BUF,COUNTERS,FAM,HDEIEN,I,IENS,INFO,RC,REGLST,REGNAME,RORBUF,RORMSG,TASKIEN,TMP
"RTN","RORHDT03",84,0)
 S RORTSK=ZTSK
"RTN","RORHDT03",85,0)
 S HDEIEN=+$$PARAM^RORTSK01("HDEIEN")
"RTN","RORHDT03",86,0)
 S TASKIEN=+$$PARAM^RORTSK01("TASKIEN")
"RTN","RORHDT03",87,0)
 ;--- Initialize constants and variables
"RTN","RORHDT03",88,0)
 D INIT^RORUTL01("RORHDT"),CLEAR^RORERR("TASK^RORHDT03")
"RTN","RORHDT03",89,0)
 ;S RORPARM("DEBUG")=1 ; Remove the first ';' to start in debug mode
"RTN","RORHDT03",90,0)
 S RORPARM("ERR")=1    ; Enable enhanced error processing
"RTN","RORHDT03",91,0)
 S RORPARM("LOG")=1    ; Enable error recording
"RTN","RORHDT03",92,0)
 ;--- Wait until the task record is created
"RTN","RORHDT03",93,0)
 S TMP=$$TRWAIT^RORTSK01(RORTSK)
"RTN","RORHDT03",94,0)
 ;--- Open the task log
"RTN","RORHDT03",95,0)
 S TMP=$$SETUP^RORLOG()
"RTN","RORHDT03",96,0)
 S TMP=$$OPEN^RORLOG(,4,"HDE TASK #"_RORTSK_" STARTED")
"RTN","RORHDT03",97,0)
 D
"RTN","RORHDT03",98,0)
 . ;--- Initialize the task
"RTN","RORHDT03",99,0)
 . S RC=$$INIT^RORTSK01(RORTSK,$$LOGIEN^RORLOG)  Q:RC<0
"RTN","RORHDT03",100,0)
 . ;--- Load parameters of the data extraction
"RTN","RORHDT03",101,0)
 . S IENS=(+HDEIEN)_","
"RTN","RORHDT03",102,0)
 . D GETS^DIQ(799.6,IENS,"3*","I","RORBUF","RORMSG")
"RTN","RORHDT03",103,0)
 . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,799.6,IENS)
"RTN","RORHDT03",104,0)
 . ;--- Compile the list of registries
"RTN","RORHDT03",105,0)
 . S I=""
"RTN","RORHDT03",106,0)
 . F  S I=$O(RORBUF(799.63,I))  Q:I=""  D
"RTN","RORHDT03",107,0)
 . . S REGNAME=$G(RORBUF(799.63,I,.01,"I"))  Q:REGNAME=""
"RTN","RORHDT03",108,0)
 . . S TMP=$$REGIEN^RORUTL02(REGNAME)
"RTN","RORHDT03",109,0)
 . . S:TMP>0 REGLST(REGNAME)=TMP
"RTN","RORHDT03",110,0)
 . ;--- Associate the log with the registries
"RTN","RORHDT03",111,0)
 . S RC=$$SETRGLST^RORLOG(.REGLST)
"RTN","RORHDT03",112,0)
 . ;---
"RTN","RORHDT03",113,0)
 . S TMP=$$PARAM^RORTSK01("FAM")
"RTN","RORHDT03",114,0)
 . S RC=$$EXTRACT^RORHDT04(.REGLST,HDEIEN,TASKIEN,TMP)
"RTN","RORHDT03",115,0)
 . S:RC'<0 COUNTERS=RC
"RTN","RORHDT03",116,0)
 ;
"RTN","RORHDT03",117,0)
 ;--- Post-processing
"RTN","RORHDT03",118,0)
 S TMP=$$EXIT^RORTSK01(RC)
"RTN","RORHDT03",119,0)
 ;--- Close the log
"RTN","RORHDT03",120,0)
 S TMP="HDE TASK #"_RORTSK_$S(RC<0:" ABORTED",1:" COMPLETED")
"RTN","RORHDT03",121,0)
 D CLOSE^RORLOG(TMP,$G(COUNTERS))
"RTN","RORHDT03",122,0)
 D:'$G(RORPARM("DEBUG")) INIT^RORUTL01("RORHDT")
"RTN","RORHDT03",123,0)
 Q
"RTN","RORHDT04")
0^45^B50817494
"RTN","RORHDT04",1,0)
RORHDT04 ;HCIOFO/SG - HISTORICAL DATA EXTRACTION PROCESS ; 1/22/06 8:18pm
"RTN","RORHDT04",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHDT04",3,0)
 ;
"RTN","RORHDT04",4,0)
 Q
"RTN","RORHDT04",5,0)
 ;
"RTN","RORHDT04",6,0)
 ;***** DATA EXTRACTION PROCESS
"RTN","RORHDT04",7,0)
 ;
"RTN","RORHDT04",8,0)
 ; .REGLST       Reference to a local array containing registry
"RTN","RORHDT04",9,0)
 ;               names as subscripts and registry IENs as values
"RTN","RORHDT04",10,0)
 ;
"RTN","RORHDT04",11,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDT04",12,0)
 ; TASKIEN       Task IEN
"RTN","RORHDT04",13,0)
 ;
"RTN","RORHDT04",14,0)
 ; FAM           File Access Mode
"RTN","RORHDT04",15,0)
 ;
"RTN","RORHDT04",16,0)
 ; Return Values:
"RTN","RORHDT04",17,0)
 ;       <0  Error code
"RTN","RORHDT04",18,0)
 ;      >=0  Statistics
"RTN","RORHDT04",19,0)
 ;             ^1: Total number of processed patients
"RTN","RORHDT04",20,0)
 ;             ^2: Number of patients processed with errors
"RTN","RORHDT04",21,0)
 ;
"RTN","RORHDT04",22,0)
EXTRACT(REGLST,HDEIEN,TASKIEN,FAM) ;
"RTN","RORHDT04",23,0)
 N ROREXT        ; Data extraction descriptor
"RTN","RORHDT04",24,0)
 N RORHL         ; HL7 variables
"RTN","RORHDT04",25,0)
 N RORLRC        ; List of codes of Lab results to be extracted
"RTN","RORHDT04",26,0)
 ;
"RTN","RORHDT04",27,0)
 N CNT           ; Number of processed registry records
"RTN","RORHDT04",28,0)
 N ECNT          ; Number of records processed with errors
"RTN","RORHDT04",29,0)
 N FILE          ; Name of the output file
"RTN","RORHDT04",30,0)
 N OUTDIR        ; Name of the output directory
"RTN","RORHDT04",31,0)
 ;
"RTN","RORHDT04",32,0)
 N BDT,EDT,NEXT,POP,RC,REGIEN,REGNAME,RGIENLST,RRBIEN,RREIEN,STOP,TMP
"RTN","RORHDT04",33,0)
 K ^TMP("RORHDT",$J,"PR"),^TMP("HLS",$J),^TMP("RORPTF",$J)
"RTN","RORHDT04",34,0)
 S (CNT,ECNT,STOP)=0,RORHDT("BHS")=1
"RTN","RORHDT04",35,0)
 ;--- Prepare the list of registry IENs
"RTN","RORHDT04",36,0)
 S REGNAME="",REGIEN=0
"RTN","RORHDT04",37,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:REGIEN<0
"RTN","RORHDT04",38,0)
 . S REGIEN=+REGLST(REGNAME)
"RTN","RORHDT04",39,0)
 . S:REGIEN'>0 REGIEN=$$REGIEN^RORUTL02(REGNAME)
"RTN","RORHDT04",40,0)
 . S:REGIEN>0 RGIENLST(REGIEN)=""
"RTN","RORHDT04",41,0)
 Q:REGIEN<0 REGIEN
"RTN","RORHDT04",42,0)
 ;
"RTN","RORHDT04",43,0)
 ;=== Load parameters
"RTN","RORHDT04",44,0)
 S RC=$$HDEPARM^RORHDT05(HDEIEN,.BDT,.EDT,.OUTDIR)
"RTN","RORHDT04",45,0)
 Q:RC<0 RC
"RTN","RORHDT04",46,0)
 S RC=$$TASKPARM^RORHDT05(HDEIEN,TASKIEN,.RRBIEN,.RREIEN,.FILE)
"RTN","RORHDT04",47,0)
 Q:RC<0 RC
"RTN","RORHDT04",48,0)
 ;
"RTN","RORHDT04",49,0)
 ;=== Prepare data extraction rules
"RTN","RORHDT04",50,0)
 S RC=$$PREPARE^ROREXPR(.REGLST,BDT,EDT)
"RTN","RORHDT04",51,0)
 Q:RC<0 $$ERROR^RORERR(-22)
"RTN","RORHDT04",52,0)
 ;--- Load and process historical data extraction parameters
"RTN","RORHDT04",53,0)
 S RC=$$PREPARE^RORHDT06(HDEIEN)  Q:RC<0 RC
"RTN","RORHDT04",54,0)
 K ROREXT("MAXHL7SIZE")  ; Do not limit the size
"RTN","RORHDT04",55,0)
 ;
"RTN","RORHDT04",56,0)
 ;=== Initialize the HL7 environment
"RTN","RORHDT04",57,0)
 S RC=$$INIT^RORHL7()  Q:RC<0 RC
"RTN","RORHDT04",58,0)
 ;
"RTN","RORHDT04",59,0)
 ;=== Delete the old output host file(s)
"RTN","RORHDT04",60,0)
 S TMP=$$DELFILES^RORHDT05(OUTDIR,FILE)
"RTN","RORHDT04",61,0)
 ;
"RTN","RORHDT04",62,0)
 D
"RTN","RORHDT04",63,0)
 . N COMMIT,IENS,NODE,NRTC,PTIEN
"RTN","RORHDT04",64,0)
 . S NRTC=100 ; Number of records to commit
"RTN","RORHDT04",65,0)
 . ;
"RTN","RORHDT04",66,0)
 . ;=== Try to re-extract the erroneous records
"RTN","RORHDT04",67,0)
 . S NODE=$$ROOT^DILFD(799.641,","_(+TASKIEN)_","_(+HDEIEN)_",",1)
"RTN","RORHDT04",68,0)
 . S NODE=$NA(@NODE@("B"))
"RTN","RORHDT04",69,0)
 . S PTIEN=0,RC=0
"RTN","RORHDT04",70,0)
 . F  D  Q:RC!STOP!(PTIEN'>0)
"RTN","RORHDT04",71,0)
 . . K ^TMP("HLS",$J)
"RTN","RORHDT04",72,0)
 . . F  S PTIEN=$O(@NODE@(PTIEN))  Q:PTIEN'>0  D  Q:RC!'((CNT-ECNT)#NRTC)
"RTN","RORHDT04",73,0)
 . . . S RC=$$LOOP^RORTSK01()
"RTN","RORHDT04",74,0)
 . . . I RC<0  S:RC=-42 STOP=1  Q
"RTN","RORHDT04",75,0)
 . . . S RC=$$PROCREC(PTIEN,.RGIENLST),CNT=CNT+1
"RTN","RORHDT04",76,0)
 . . . S ^TMP("RORHDT",$J,"PR",PTIEN)=RC
"RTN","RORHDT04",77,0)
 . . . I RC'<0  S RC=0  Q
"RTN","RORHDT04",78,0)
 . . . ;--- Proccess the error
"RTN","RORHDT04",79,0)
 . . . S RC=$$ERROR^RORERR(-15,,,PTIEN),ECNT=ECNT+1
"RTN","RORHDT04",80,0)
 . . . S:$G(RORPARM("DEBUG"))<3 RC=0
"RTN","RORHDT04",81,0)
 . . I RC<0  Q:'STOP
"RTN","RORHDT04",82,0)
 . . ;--- Commit the data
"RTN","RORHDT04",83,0)
 . . S TMP=$$COMMIT^RORHDT05(OUTDIR,FILE)
"RTN","RORHDT04",84,0)
 . . S:TMP<0 RC=TMP
"RTN","RORHDT04",85,0)
 . Q:STOP!(RC=-34)
"RTN","RORHDT04",86,0)
 . ;
"RTN","RORHDT04",87,0)
 . ;=== Extract the remaining registry data
"RTN","RORHDT04",88,0)
 . S PTIEN=$S(RRBIEN>0:+$O(^RORDATA(798,"KEY",RRBIEN),-1),1:0)
"RTN","RORHDT04",89,0)
 . S RC=0
"RTN","RORHDT04",90,0)
 . F  D  Q:RC!STOP!(PTIEN'>0)
"RTN","RORHDT04",91,0)
 . . K ^TMP("HLS",$J)  S COMMIT=0
"RTN","RORHDT04",92,0)
 . . F  S PTIEN=$$NEXTPAT(PTIEN,.RGIENLST)  Q:PTIEN'>0  D  Q:RC!COMMIT
"RTN","RORHDT04",93,0)
 . . . S RC=$$LOOP^RORTSK01()
"RTN","RORHDT04",94,0)
 . . . I RC<0  S:RC=-42 STOP=1  Q
"RTN","RORHDT04",95,0)
 . . . I RREIEN>0,PTIEN'<RREIEN  S PTIEN="",RC=1  Q
"RTN","RORHDT04",96,0)
 . . . Q:$D(^TMP("RORHDT",$J,"PR",PTIEN))
"RTN","RORHDT04",97,0)
 . . . S RC=$$PROCREC(PTIEN,.RGIENLST),CNT=CNT+1
"RTN","RORHDT04",98,0)
 . . . I RC'<0  S COMMIT='((CNT-ECNT)#NRTC),RC=0  Q
"RTN","RORHDT04",99,0)
 . . . ;--- Proccess the error
"RTN","RORHDT04",100,0)
 . . . S RC=$$ERROR^RORERR(-15,,,PTIEN),ECNT=ECNT+1
"RTN","RORHDT04",101,0)
 . . . S:$G(RORPARM("DEBUG"))<3 RC=0
"RTN","RORHDT04",102,0)
 . . . S TMP=$$ADDERR^RORHDT05(HDEIEN,TASKIEN,PTIEN)
"RTN","RORHDT04",103,0)
 . . . S:TMP<0 RC=TMP
"RTN","RORHDT04",104,0)
 . . I RC<0  Q:'STOP
"RTN","RORHDT04",105,0)
 . . ;--- Commit the data
"RTN","RORHDT04",106,0)
 . . S NEXT=$S(COMMIT:$$NEXTPAT(PTIEN,.RGIENLST),1:PTIEN)
"RTN","RORHDT04",107,0)
 . . S TMP=$$COMMIT^RORHDT05(OUTDIR,FILE)
"RTN","RORHDT04",108,0)
 . . S:TMP<0 RC=TMP
"RTN","RORHDT04",109,0)
 ;
"RTN","RORHDT04",110,0)
 ;--- The $$COMMIT^RORHDT05 returns -34 if it was not able to create
"RTN","RORHDT04",111,0)
 ;--- the output file (wrong directory name, protection error, etc.).
"RTN","RORHDT04",112,0)
 D:RC'=-34
"RTN","RORHDT04",113,0)
 . N NODE,RORFDA,RORMSG
"RTN","RORHDT04",114,0)
 . ;
"RTN","RORHDT04",115,0)
 . ;=== Write the batch trailer segment and close the file if
"RTN","RORHDT04",116,0)
 . ;=== the batch is not empty. Otherwise, record a warning.
"RTN","RORHDT04",117,0)
 . I '$G(RORHDT("BHS"))  D
"RTN","RORHDT04",118,0)
 . . S TMP=$S(ECNT!(RC<0):"Completed with errors",STOP:"Stopped",1:"")
"RTN","RORHDT04",119,0)
 . . U IO  W $$BTS^RORHL7A($$MSGCNT^RORHL7,TMP),$C(13)
"RTN","RORHDT04",120,0)
 . . D CLOSE^%ZISH("HL7FILE")
"RTN","RORHDT04",121,0)
 . E  D ERROR^RORERR(-89)
"RTN","RORHDT04",122,0)
 . ;
"RTN","RORHDT04",123,0)
 . ;=== Update the NEXT RECORD IEN field in the task record
"RTN","RORHDT04",124,0)
 . I $D(NEXT)  D:NEXT'>0
"RTN","RORHDT04",125,0)
 . . ;--- If the task completed successfuly, the NEXT RECORD IEN
"RTN","RORHDT04",126,0)
 . . ;    field is set to an empty string. If the task is restarted
"RTN","RORHDT04",127,0)
 . . ;--- afterwards, it will re-extract all data again.
"RTN","RORHDT04",128,0)
 . . I 'ECNT  S NEXT=""  Q
"RTN","RORHDT04",129,0)
 . . ;--- If completed with errors, use IEN of the last record
"RTN","RORHDT04",130,0)
 . . ;--- processed by the task incremented by 1.
"RTN","RORHDT04",131,0)
 . . I RREIEN>0  S NEXT=RREIEN+1  Q
"RTN","RORHDT04",132,0)
 . . ;--- Or the IEN of the last patient record incremented by 1
"RTN","RORHDT04",133,0)
 . . ;--- (in case of the last/single task).
"RTN","RORHDT04",134,0)
 . . S NEXT=$O(^RORDATA(798,"KEY",""),-1)+1
"RTN","RORHDT04",135,0)
 . . ;--- When the task is restarted, it will try to re-extract only
"RTN","RORHDT04",136,0)
 . . ;    erroneous records and will not process already extracted
"RTN","RORHDT04",137,0)
 . . ;    data (the PTIEN will not be less than the RREIEN or the
"RTN","RORHDT04",138,0)
 . . ;--- $ORDER function will not return a value greater than zero).
"RTN","RORHDT04",139,0)
 . E  Q:(RC<0)!ECNT!STOP  S NEXT=""
"RTN","RORHDT04",140,0)
 . ;
"RTN","RORHDT04",141,0)
 . ;=== Update the task record
"RTN","RORHDT04",142,0)
 . S IENS=(+TASKIEN)_","_(+HDEIEN)_","
"RTN","RORHDT04",143,0)
 . S RORFDA(799.64,IENS,.04)=NEXT
"RTN","RORHDT04",144,0)
 . D FILE^DIE("K","RORFDA","RORMSG")
"RTN","RORHDT04",145,0)
 . S TMP=$$DBS^RORERR("RORMSG",-9,,,799.64,IENS)
"RTN","RORHDT04",146,0)
 ;
"RTN","RORHDT04",147,0)
 ;=== Cleanup
"RTN","RORHDT04",148,0)
 K ^TMP("RORPTF",$J)
"RTN","RORHDT04",149,0)
 S:RC'<0 RC=$$CLRERRS^RORHDT05(HDEIEN,TASKIEN)
"RTN","RORHDT04",150,0)
 Q $S(RC<0:RC,1:CNT_U_ECNT)
"RTN","RORHDT04",151,0)
 ;
"RTN","RORHDT04",152,0)
 ;***** RETURNS THE NEXT PATIENT FOR DATA EXTRACTION
"RTN","RORHDT04",153,0)
 ;
"RTN","RORHDT04",154,0)
 ; PTIEN         Patient IEN (DFN)
"RTN","RORHDT04",155,0)
 ;
"RTN","RORHDT04",156,0)
 ; .RGIENLST     Reference to a local array containing registry
"RTN","RORHDT04",157,0)
 ;               IENs as subscripts. The IENs of the corresponding
"RTN","RORHDT04",158,0)
 ;               patient's registry records are returned as values.
"RTN","RORHDT04",159,0)
 ;
"RTN","RORHDT04",160,0)
 ; Return Values:
"RTN","RORHDT04",161,0)
 ;        0  No more patients
"RTN","RORHDT04",162,0)
 ;       >0  IEN (DFN) of the next patient who belongs to at least
"RTN","RORHDT04",163,0)
 ;           one of the registries defined by the RGIENLST parameter.
"RTN","RORHDT04",164,0)
 ;
"RTN","RORHDT04",165,0)
NEXTPAT(PTIEN,RGIENLST) ;
"RTN","RORHDT04",166,0)
 N CNT,IEN,REGIEN
"RTN","RORHDT04",167,0)
 S CNT=0
"RTN","RORHDT04",168,0)
 F  S PTIEN=$O(^RORDATA(798,"KEY",PTIEN))  Q:PTIEN'>0  D  Q:CNT
"RTN","RORHDT04",169,0)
 . S REGIEN=0
"RTN","RORHDT04",170,0)
 . F  S REGIEN=$O(RGIENLST(REGIEN))  Q:REGIEN'>0  D
"RTN","RORHDT04",171,0)
 . . S RGIENLST(REGIEN)=0
"RTN","RORHDT04",172,0)
 . . S IEN=+$O(^RORDATA(798,"KEY",PTIEN,REGIEN,""))
"RTN","RORHDT04",173,0)
 . . Q:IEN'>0
"RTN","RORHDT04",174,0)
 . . ;--- Skip inactive records
"RTN","RORHDT04",175,0)
 . . Q:'$$ACTIVE^RORDD(IEN)
"RTN","RORHDT04",176,0)
 . . ;--- Skip records tagged as "DON'T SEND"
"RTN","RORHDT04",177,0)
 . . Q:$P($G(^RORDATA(798,IEN,2)),U,4)
"RTN","RORHDT04",178,0)
 . . ;--- Consider the record
"RTN","RORHDT04",179,0)
 . . S RGIENLST(REGIEN)=IEN,CNT=CNT+1
"RTN","RORHDT04",180,0)
 Q $S(PTIEN>0:PTIEN,1:0)
"RTN","RORHDT04",181,0)
 ;
"RTN","RORHDT04",182,0)
 ;***** PROCESSES A RECORD IN THE REGISTRY
"RTN","RORHDT04",183,0)
 ;
"RTN","RORHDT04",184,0)
 ; PTIEN         Patient IEN (DFN)
"RTN","RORHDT04",185,0)
 ;
"RTN","RORHDT04",186,0)
 ; .RGIENLST     Reference to a local array containing registry
"RTN","RORHDT04",187,0)
 ;               IENs as subscripts and IENs of the corresponding
"RTN","RORHDT04",188,0)
 ;               patient's registry records as values.
"RTN","RORHDT04",189,0)
 ;
"RTN","RORHDT04",190,0)
 ; Return Values:
"RTN","RORHDT04",191,0)
 ;       <0  Error code
"RTN","RORHDT04",192,0)
 ;        0  Ok
"RTN","RORHDT04",193,0)
 ;        1  Nothing has been extracted
"RTN","RORHDT04",194,0)
 ;
"RTN","RORHDT04",195,0)
PROCREC(PTIEN,RGIENLST) ;
"RTN","RORHDT04",196,0)
 N RORERRDL      ; Default error location
"RTN","RORHDT04",197,0)
 ;
"RTN","RORHDT04",198,0)
 N BATCHID,CNT,DXDTS,IEN,MSHPTR,RC,REGIEN,RORMSH,TMP
"RTN","RORHDT04",199,0)
 D CLEAR^RORERR("PROCREC^RORHDT04")
"RTN","RORHDT04",200,0)
 ;
"RTN","RORHDT04",201,0)
 ;--- Compile the data extraction time frames
"RTN","RORHDT04",202,0)
 S (CNT,RC,REGIEN)=0
"RTN","RORHDT04",203,0)
 F  S REGIEN=$O(RGIENLST(REGIEN))  Q:REGIEN'>0  D  Q:RC<0
"RTN","RORHDT04",204,0)
 . S IEN=+RGIENLST(REGIEN)  Q:IEN'>0
"RTN","RORHDT04",205,0)
 . S RC=$$DXPERIOD^ROREXTUT(.DXDTS,IEN,PTIEN)
"RTN","RORHDT04",206,0)
 . S:'RC CNT=CNT+1
"RTN","RORHDT04",207,0)
 . S:RC>0 RGIENLST(REGIEN)=0
"RTN","RORHDT04",208,0)
 Q:RC<0 RC
"RTN","RORHDT04",209,0)
 ;--- If the patient should be skipped in all registries
"RTN","RORHDT04",210,0)
 ;    that are being processed, then do not perform the data
"RTN","RORHDT04",211,0)
 ;--- extraction for this patient at all.
"RTN","RORHDT04",212,0)
 I 'CNT  D:$G(RORPARM("DEBUG"))  Q 0
"RTN","RORHDT04",213,0)
 . D LOG^RORLOG(4,"There is no data to extract.",PTIEN)
"RTN","RORHDT04",214,0)
 ;
"RTN","RORHDT04",215,0)
 ;--- Create an HL7 message for the patient
"RTN","RORHDT04",216,0)
 S MSHPTR=$$CREATE^RORHL7(.RORMSH)  Q:MSHPTR<0 MSHPTR
"RTN","RORHDT04",217,0)
 S RC=$$MESSAGE^ROREXT02(PTIEN,.RGIENLST,.DXDTS,$G(ROREXT("HDTIEN")))
"RTN","RORHDT04",218,0)
 ;
"RTN","RORHDT04",219,0)
 ;--- Delete the unfinished message from the ^TMP("HLS",$J)
"RTN","RORHDT04",220,0)
 ;    if there is no data to send (RC>0) or there was an error
"RTN","RORHDT04",221,0)
 ;    during the data extraction (RC<0). Return the error code
"RTN","RORHDT04",222,0)
 ;--- in the latter case.
"RTN","RORHDT04",223,0)
 I RC!($O(^TMP("HLS",$J,""),-1)=MSHPTR)  D  Q:RC<0 RC
"RTN","RORHDT04",224,0)
 . D ROLLBACK^RORHL7(MSHPTR)  S:'RC RC=1
"RTN","RORHDT04",225,0)
 ;---
"RTN","RORHDT04",226,0)
 Q RC
"RTN","RORHDT05")
0^46^B13039492
"RTN","RORHDT05",1,0)
RORHDT05 ;HCIOFO/SG - HISTORICAL DATA EXTRACTION FUNCTIONS ; 1/22/06 12:01pm
"RTN","RORHDT05",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHDT05",3,0)
 ;
"RTN","RORHDT05",4,0)
 Q
"RTN","RORHDT05",5,0)
 ;
"RTN","RORHDT05",6,0)
 ;***** ADDS A RECORD TO THE 'ERROR' MULTIPLE OF THE TASK RECORD
"RTN","RORHDT05",7,0)
 ;
"RTN","RORHDT05",8,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDT05",9,0)
 ; TASKIEN       Task IEN
"RTN","RORHDT05",10,0)
 ; PTIEN         Patient IEN
"RTN","RORHDT05",11,0)
 ;
"RTN","RORHDT05",12,0)
 ; Return Values:
"RTN","RORHDT05",13,0)
 ;       <0  Error code
"RTN","RORHDT05",14,0)
 ;        0  Ok
"RTN","RORHDT05",15,0)
 ;
"RTN","RORHDT05",16,0)
ADDERR(HDEIEN,TASKIEN,PTIEN) ;
"RTN","RORHDT05",17,0)
 N IENS,RC,RORFDA,RORIEN,RORMSG
"RTN","RORHDT05",18,0)
 S IENS="+1,"_(+TASKIEN)_","_(+HDEIEN)_",",RORIEN(1)=+PTIEN
"RTN","RORHDT05",19,0)
 S RORFDA(799.641,IENS,.01)=+PTIEN
"RTN","RORHDT05",20,0)
 D UPDATE^DIE(,"RORFDA","RORIEN","RORMSG")
"RTN","RORHDT05",21,0)
 Q $$DBS^RORERR("RORMSG",-9,,,799.641,IENS)
"RTN","RORHDT05",22,0)
 ;
"RTN","RORHDT05",23,0)
 ;***** DELETES RECORDS FROM THE 'ERROR' MULTIPLE OF THE TASK RECORD
"RTN","RORHDT05",24,0)
 ;
"RTN","RORHDT05",25,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDT05",26,0)
 ; TASKIEN       Task IEN
"RTN","RORHDT05",27,0)
 ;
"RTN","RORHDT05",28,0)
 ; This functions deletes all erroneous records from the ERROR
"RTN","RORHDT05",29,0)
 ; multiple of the task record that have been re-extracted without
"RTN","RORHDT05",30,0)
 ; errors. So, there is no reason to keep them anymore.
"RTN","RORHDT05",31,0)
 ;
"RTN","RORHDT05",32,0)
 ; Return Values:
"RTN","RORHDT05",33,0)
 ;       <0  Error code
"RTN","RORHDT05",34,0)
 ;        0  Ok
"RTN","RORHDT05",35,0)
 ;
"RTN","RORHDT05",36,0)
CLRERRS(HDEIEN,TASKIEN) ;
"RTN","RORHDT05",37,0)
 N I,IEN,RC,RORFDA,RORMSG,SFI
"RTN","RORHDT05",38,0)
 S SFI=","_(+TASKIEN)_","_(+HDEIEN)_",",RC=0
"RTN","RORHDT05",39,0)
 S IEN=""
"RTN","RORHDT05",40,0)
 F  D  Q:(RC<0)!(IEN="")
"RTN","RORHDT05",41,0)
 . F I=1:1:10  S IEN=$O(^TMP("RORHDT",$J,"PR",IEN))  Q:IEN=""  D
"RTN","RORHDT05",42,0)
 . . S:^TMP("RORHDT",$J,"PR",IEN)'<0 RORFDA(799.641,IEN_SFI,.01)="@"
"RTN","RORHDT05",43,0)
 . Q:$D(RORFDA)<10
"RTN","RORHDT05",44,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORHDT05",45,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,799.641)
"RTN","RORHDT05",46,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORHDT05",47,0)
 ;
"RTN","RORHDT05",48,0)
 ;***** COMMITS HL7 DATA TO THE OUTPUT FILE
"RTN","RORHDT05",49,0)
 ;
"RTN","RORHDT05",50,0)
 ; OUTDIR        Output directory
"RTN","RORHDT05",51,0)
 ; FILE          Output file name
"RTN","RORHDT05",52,0)
 ;
"RTN","RORHDT05",53,0)
 ; Return Values:
"RTN","RORHDT05",54,0)
 ;       <0  Error code
"RTN","RORHDT05",55,0)
 ;        0  Ok
"RTN","RORHDT05",56,0)
 ;
"RTN","RORHDT05",57,0)
COMMIT(OUTDIR,FILE) ;
"RTN","RORHDT05",58,0)
 N CR,I,J,POP,RC
"RTN","RORHDT05",59,0)
 Q:$D(^TMP("HLS",$J))<10 0
"RTN","RORHDT05",60,0)
 S CR=$C(13),RC=0
"RTN","RORHDT05",61,0)
 ;--- Create the file and write the BHS segment (if necessary)
"RTN","RORHDT05",62,0)
 I $G(RORHDT("BHS"))  D  Q:RC<0 RC  K RORHDT("BHS")
"RTN","RORHDT05",63,0)
 . D OPEN^%ZISH("HL7FILE",OUTDIR,FILE,"WB")
"RTN","RORHDT05",64,0)
 . I $G(POP)  S RC=$$ERROR^RORERR(-34,,OUTDIR_FILE)  Q
"RTN","RORHDT05",65,0)
 . S I=$G(ROREXT("HL7DT"))  U IO
"RTN","RORHDT05",66,0)
 . W $$BHS^RORHL7A($G(ROREXT("HL7MID")),I,"HISTORICAL DATA"),$C(13)
"RTN","RORHDT05",67,0)
 ;--- Write the segments
"RTN","RORHDT05",68,0)
 S I=0
"RTN","RORHDT05",69,0)
 F  S I=$O(^TMP("HLS",$J,I))  Q:I=""  D
"RTN","RORHDT05",70,0)
 . W ^TMP("HLS",$J,I)  S J=""
"RTN","RORHDT05",71,0)
 . F  S J=$O(^TMP("HLS",$J,I,J))  Q:J=""  W ^(J)
"RTN","RORHDT05",72,0)
 . W CR
"RTN","RORHDT05",73,0)
 Q 0
"RTN","RORHDT05",74,0)
 ;
"RTN","RORHDT05",75,0)
 ;***** DELETES THE OLD OUTPUT HOST FILE(S)
"RTN","RORHDT05",76,0)
 ;
"RTN","RORHDT05",77,0)
 ; OUTDIR        Output directory
"RTN","RORHDT05",78,0)
 ; FILE          Output file name
"RTN","RORHDT05",79,0)
 ;
"RTN","RORHDT05",80,0)
 ; Return Values:
"RTN","RORHDT05",81,0)
 ;       <0  Error code
"RTN","RORHDT05",82,0)
 ;        0  Ok
"RTN","RORHDT05",83,0)
 ;
"RTN","RORHDT05",84,0)
DELFILES(OUTDIR,FILE) ;
"RTN","RORHDT05",85,0)
 N RC,RORDST,RORSRC  Q:FILE="" 0
"RTN","RORHDT05",86,0)
 S RORSRC(FILE_"*")=""
"RTN","RORHDT05",87,0)
 Q:'$$LIST^%ZISH(OUTDIR,"RORSRC","RORDST") 0
"RTN","RORHDT05",88,0)
 I '$$DEL^%ZISH(OUTDIR,"RORDST")  D  Q RC
"RTN","RORHDT05",89,0)
 . S RC=$$ERROR^RORERR(-56,,,,0,"$$DEL^%ZISH")
"RTN","RORHDT05",90,0)
 Q 0
"RTN","RORHDT05",91,0)
 ;
"RTN","RORHDT05",92,0)
 ;***** LOADS DATA EXTRACTION PARAMETERS
"RTN","RORHDT05",93,0)
 ;
"RTN","RORHDT05",94,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDT05",95,0)
 ;
"RTN","RORHDT05",96,0)
 ; [.BDT]        Start date of the data extract
"RTN","RORHDT05",97,0)
 ; [.EDT]        End date of the data extract
"RTN","RORHDT05",98,0)
 ; [.OUTDIR]     Output directory
"RTN","RORHDT05",99,0)
 ;
"RTN","RORHDT05",100,0)
 ; Return Values:
"RTN","RORHDT05",101,0)
 ;       <0  Error code
"RTN","RORHDT05",102,0)
 ;        0  Ok
"RTN","RORHDT05",103,0)
 ;
"RTN","RORHDT05",104,0)
HDEPARM(HDEIEN,BDT,EDT,OUTDIR) ;
"RTN","RORHDT05",105,0)
 N IENS,RC,RORBUF,RORMSG,TMP
"RTN","RORHDT05",106,0)
 S IENS=(+HDEIEN)_","
"RTN","RORHDT05",107,0)
 ;--- Get data from the registry descriptor
"RTN","RORHDT05",108,0)
 D GETS^DIQ(799.6,IENS,".03;.04;2","I","RORBUF","RORMSG")
"RTN","RORHDT05",109,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","RORHDT05",110,0)
 S BDT=$G(RORBUF(799.6,IENS,.03,"I"))
"RTN","RORHDT05",111,0)
 S EDT=$G(RORBUF(799.6,IENS,.04,"I"))
"RTN","RORHDT05",112,0)
 S OUTDIR=$G(RORBUF(799.6,IENS,2,"I"))
"RTN","RORHDT05",113,0)
 I (BDT'>0)!(EDT'>0)!(BDT>EDT)  D  Q RC
"RTN","RORHDT05",114,0)
 . S RC=$$ERROR^RORERR(-32,,,,BDT,EDT)
"RTN","RORHDT05",115,0)
 Q 0
"RTN","RORHDT05",116,0)
 ;
"RTN","RORHDT05",117,0)
 ;***** LOADS TASK PARAMETERS
"RTN","RORHDT05",118,0)
 ;
"RTN","RORHDT05",119,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDT05",120,0)
 ; TASKIEN       Task IEN
"RTN","RORHDT05",121,0)
 ;
"RTN","RORHDT05",122,0)
 ; [.RBIEN]      Start record IEN
"RTN","RORHDT05",123,0)
 ; [.REIEN]      End record IEN
"RTN","RORHDT05",124,0)
 ; [.FILE]       File name
"RTN","RORHDT05",125,0)
 ;
"RTN","RORHDT05",126,0)
 ; Return Values:
"RTN","RORHDT05",127,0)
 ;       <0  Error code
"RTN","RORHDT05",128,0)
 ;        0  Ok
"RTN","RORHDT05",129,0)
 ;
"RTN","RORHDT05",130,0)
TASKPARM(HDEIEN,TASKIEN,RBIEN,REIEN,FILE) ;
"RTN","RORHDT05",131,0)
 N IENS,RC,ROOT,RORBUF,RORMSG,TMP
"RTN","RORHDT05",132,0)
 ;--- Load data from the task record
"RTN","RORHDT05",133,0)
 S IENS=(+TASKIEN)_","_(+HDEIEN)_","
"RTN","RORHDT05",134,0)
 D GETS^DIQ(799.64,IENS,".01;.04;.05","I","RORBUF","RORMSG")
"RTN","RORHDT05",135,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.64,IENS)
"RTN","RORHDT05",136,0)
 S RBIEN=$G(RORBUF(799.64,IENS,.01,"I"))
"RTN","RORHDT05",137,0)
 S FILE=$G(RORBUF(799.64,IENS,.05,"I"))
"RTN","RORHDT05",138,0)
 ;--- Get the end record IEN from the next task record
"RTN","RORHDT05",139,0)
 S ROOT=$$ROOT^DILFD(799.64,","_(+HDEIEN)_",",1)
"RTN","RORHDT05",140,0)
 S REIEN=$O(@ROOT@("B",RBIEN))
"RTN","RORHDT05",141,0)
 ;--- If an IEN of the record is available from the previous run,
"RTN","RORHDT05",142,0)
 ;    use it as start record IEN
"RTN","RORHDT05",143,0)
 S TMP=$G(RORBUF(799.64,IENS,.04,"I"))
"RTN","RORHDT05",144,0)
 S:TMP>0 RBIEN=TMP
"RTN","RORHDT05",145,0)
 Q 0
"RTN","RORHDT06")
0^218^B18765135
"RTN","RORHDT06",1,0)
RORHDT06 ;HCIOFO/SG - HISTORICAL DATA EXTRACTION PARAMETERS ; 11/30/05 10:03am
"RTN","RORHDT06",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHDT06",3,0)
 ;
"RTN","RORHDT06",4,0)
 Q
"RTN","RORHDT06",5,0)
 ;
"RTN","RORHDT06",6,0)
 ;***** UPDATES COMPLETION DATE FOR THE REGISTRY
"RTN","RORHDT06",7,0)
 ;
"RTN","RORHDT06",8,0)
 ; HDTIEN        IEN of the data extraction definition
"RTN","RORHDT06",9,0)
 ; REGNAME       Registry name
"RTN","RORHDT06",10,0)
 ; [DATE]        Completion date/time (current, if omitted)
"RTN","RORHDT06",11,0)
 ;
"RTN","RORHDT06",12,0)
 ; Return Values:
"RTN","RORHDT06",13,0)
 ;       <0  Error code
"RTN","RORHDT06",14,0)
 ;        0  Ok
"RTN","RORHDT06",15,0)
 ;
"RTN","RORHDT06",16,0)
COMPLETE(HDTIEN,REGNAME,DATE) ;
"RTN","RORHDT06",17,0)
 Q:HDTIEN'>0 0
"RTN","RORHDT06",18,0)
 Q:$G(^RORDATA(799.6,+HDTIEN,0))="" 0
"RTN","RORHDT06",19,0)
 N IEN,IENS,INFO,RORFDA,RORMSG,TMP,TYPE
"RTN","RORHDT06",20,0)
 ;--- Search for the registry record in the backpull definition
"RTN","RORHDT06",21,0)
 S IENS=","_(+HDTIEN)_","
"RTN","RORHDT06",22,0)
 S IEN=$$FIND1^DIC(799.63,IENS,"QX",REGNAME,"B",,"RORMSG")
"RTN","RORHDT06",23,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.63,IENS)
"RTN","RORHDT06",24,0)
 Q:IEN'>0 0
"RTN","RORHDT06",25,0)
 ;--- Update the completion date
"RTN","RORHDT06",26,0)
 S DATE=$S($G(DATE,-1)<0:$$NOW^XLFDT,'DATE:"",1:DATE)
"RTN","RORHDT06",27,0)
 S RORFDA(799.63,IEN_IENS,.02)=DATE
"RTN","RORHDT06",28,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORHDT06",29,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.63,IEN_IENS)
"RTN","RORHDT06",30,0)
 ;--- Success
"RTN","RORHDT06",31,0)
 S TMP=$$MSG^RORERR20(-109,.TYPE)
"RTN","RORHDT06",32,0)
 S INFO(1)=$$GET1^DIQ(799.6,(+HDTIEN)_",",.01,,,"RORMSG")
"RTN","RORHDT06",33,0)
 S INFO(2)=REGNAME
"RTN","RORHDT06",34,0)
 D LOG^RORLOG(TYPE,TMP,,.INFO)
"RTN","RORHDT06",35,0)
 Q 0
"RTN","RORHDT06",36,0)
 ;
"RTN","RORHDT06",37,0)
 ;***** SEARCHES FOR A PENDING HISTORICAL DATA EXTRACTION
"RTN","RORHDT06",38,0)
 ;
"RTN","RORHDT06",39,0)
 ; .RORGLST      Reference to a local array containing registry names
"RTN","RORHDT06",40,0)
 ;               as subscripts and optional registry IENs as values.
"RTN","RORHDT06",41,0)
 ;            
"RTN","RORHDT06",42,0)
 ;               If a definition of a pending historical data
"RTN","RORHDT06",43,0)
 ;               extraction is found, then the function removes
"RTN","RORHDT06",44,0)
 ;               the registries, which are not referenced by the
"RTN","RORHDT06",45,0)
 ;               definition, from this list.
"RTN","RORHDT06",46,0)
 ;
"RTN","RORHDT06",47,0)
 ; [.SDT]        Reference to a local variable where the start
"RTN","RORHDT06",48,0)
 ;               date of the main time frame for the historical
"RTN","RORHDT06",49,0)
 ;               extraction will be returned.
"RTN","RORHDT06",50,0)
 ;
"RTN","RORHDT06",51,0)
 ; [.EDT]        Reference to a local variable where the end
"RTN","RORHDT06",52,0)
 ;               date of the main time frame for the historical
"RTN","RORHDT06",53,0)
 ;               extraction will be returned.
"RTN","RORHDT06",54,0)
 ;
"RTN","RORHDT06",55,0)
 ; Return Values:
"RTN","RORHDT06",56,0)
 ;       <0  Error code
"RTN","RORHDT06",57,0)
 ;        0  There are no pending historical data extractions
"RTN","RORHDT06",58,0)
 ;       >0  IEN of the data extraction definition
"RTN","RORHDT06",59,0)
 ;
"RTN","RORHDT06",60,0)
FIND(RORGLST,SDT,EDT) ;
"RTN","RORHDT06",61,0)
 N HDTIEN,NODE,REGNAME,RORBUF,RORMSG,SCR,TMP
"RTN","RORHDT06",62,0)
 S (EDT,SDT)=""
"RTN","RORHDT06",63,0)
 ;--- Search for a pending historical data extraction
"RTN","RORHDT06",64,0)
 S TMP="@;.03I;.04I"
"RTN","RORHDT06",65,0)
 S SCR="I $P($G(^(0)),U,7)\1'>DT,$$FINDSCR^RORHDT06(Y)"
"RTN","RORHDT06",66,0)
 D LIST^DIC(799.6,,TMP,"Q",1,,,"ADNAUTO",SCR,,"RORBUF","RORMSG")
"RTN","RORHDT06",67,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.6)
"RTN","RORHDT06",68,0)
 Q:$G(RORBUF("DILIST",0))'>0 0
"RTN","RORHDT06",69,0)
 S HDTIEN=+$G(RORBUF("DILIST",2,1))
"RTN","RORHDT06",70,0)
 Q:HDTIEN'>0 0
"RTN","RORHDT06",71,0)
 ;--- Keep only the registries referenced by the definition
"RTN","RORHDT06",72,0)
 S NODE=$$ROOT^DILFD(799.63,","_HDTIEN_",",1)
"RTN","RORHDT06",73,0)
 S REGNAME=""
"RTN","RORHDT06",74,0)
 F  S REGNAME=$O(RORGLST(REGNAME))  Q:REGNAME=""  D
"RTN","RORHDT06",75,0)
 . K:'$D(@NODE@("ANC",REGNAME)) RORGLST(REGNAME)
"RTN","RORHDT06",76,0)
 ;--- Return the dates and IEN
"RTN","RORHDT06",77,0)
 S SDT=$G(RORBUF("DILIST","ID",1,.03))
"RTN","RORHDT06",78,0)
 S EDT=$G(RORBUF("DILIST","ID",1,.04))
"RTN","RORHDT06",79,0)
 Q HDTIEN
"RTN","RORHDT06",80,0)
 ;
"RTN","RORHDT06",81,0)
 ;***** CHECKS IF THE BACKPULL SHOULD BE PROCESSED BY THE TASK
"RTN","RORHDT06",82,0)
 ;
"RTN","RORHDT06",83,0)
 ; HDTIEN        IEN of the data extraction definition
"RTN","RORHDT06",84,0)
 ;
"RTN","RORHDT06",85,0)
 ; Return Values:
"RTN","RORHDT06",86,0)
 ;        0  Skip
"RTN","RORHDT06",87,0)
 ;        1  Include
"RTN","RORHDT06",88,0)
 ;
"RTN","RORHDT06",89,0)
FINDSCR(HDTIEN) ;
"RTN","RORHDT06",90,0)
 N REGNAME  S REGNAME=""
"RTN","RORHDT06",91,0)
 F  D  Q:REGNAME=""  Q:$D(RORGLST(REGNAME))
"RTN","RORHDT06",92,0)
 . S REGNAME=$O(^RORDATA(799.6,HDTIEN,3,"ANC",REGNAME))
"RTN","RORHDT06",93,0)
 Q (REGNAME'="")
"RTN","RORHDT06",94,0)
 ;
"RTN","RORHDT06",95,0)
 ;***** PREPARES HISTORICAL DATA EXTRACTION PARAMETERS
"RTN","RORHDT06",96,0)
 ;
"RTN","RORHDT06",97,0)
 ; HDTIEN        IEN of the data extraction definition
"RTN","RORHDT06",98,0)
 ;
"RTN","RORHDT06",99,0)
 ; Return Values:
"RTN","RORHDT06",100,0)
 ;        0  Ok
"RTN","RORHDT06",101,0)
 ;       <0  Error code
"RTN","RORHDT06",102,0)
 ;
"RTN","RORHDT06",103,0)
PREPARE(HDTIEN) ;
"RTN","RORHDT06",104,0)
 N DAC,HDTNAME,IENS,NODE,RC,RORBUF,RORMSG,SCR,SDT,TMP,TYPE
"RTN","RORHDT06",105,0)
 I $G(HDTIEN)'>0  D  Q 0
"RTN","RORHDT06",106,0)
 . K ROREXT("HDTIEN")
"RTN","RORHDT06",107,0)
 S ROREXT("HDTIEN")=+HDTIEN,RC=0
"RTN","RORHDT06",108,0)
 ;--- Load the parameters
"RTN","RORHDT06",109,0)
 S IENS=+HDTIEN_","
"RTN","RORHDT06",110,0)
 D GETS^DIQ(799.6,IENS,".01;.06;1*","I","RORBUF","RORMSG")
"RTN","RORHDT06",111,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.6,IENS)
"RTN","RORHDT06",112,0)
 S HDTNAME=$G(RORBUF(799.6,IENS,.01,"I"))
"RTN","RORHDT06",113,0)
 ;--- Override the maximum message size (if requested)
"RTN","RORHDT06",114,0)
 S TMP=$G(RORBUF(799.6,IENS,.06,"I"))
"RTN","RORHDT06",115,0)
 I TMP>0  S ROREXT("MAXHL7SIZE")=(TMP*1048576)\1
"RTN","RORHDT06",116,0)
 E  K:TMP=0 ROREXT("MAXHL7SIZE")
"RTN","RORHDT06",117,0)
 ;--- Override the data areas
"RTN","RORHDT06",118,0)
 K ROREXT("DTAR")
"RTN","RORHDT06",119,0)
 S NODE=$$ROOT^DILFD(799.33,,1)
"RTN","RORHDT06",120,0)
 S IENS=""
"RTN","RORHDT06",121,0)
 F  S IENS=$O(RORBUF(799.61,IENS))  Q:IENS=""  D
"RTN","RORHDT06",122,0)
 . S DAC=+$G(RORBUF(799.61,IENS,.01,"I"))
"RTN","RORHDT06",123,0)
 . Q:'$D(@NODE@(DAC))
"RTN","RORHDT06",124,0)
 . S SDT=+$G(RORBUF(799.61,IENS,.02,"I"))  ; Start Date
"RTN","RORHDT06",125,0)
 . I SDT'>0  S ROREXT("DTAR",DAC)=""  Q
"RTN","RORHDT06",126,0)
 . S TMP=+$G(RORBUF(799.61,IENS,.03,"I"))  ; End Date
"RTN","RORHDT06",127,0)
 . S:TMP>0 ROREXT("DTAR",DAC)=SDT_U_TMP
"RTN","RORHDT06",128,0)
 ;--- Ignore the lag days
"RTN","RORHDT06",129,0)
 K ROREXT("LD")
"RTN","RORHDT06",130,0)
 ;--- Set the special batch message date (BHS-6) to make
"RTN","RORHDT06",131,0)
 ;    sure that timestamps of historical clinical units are
"RTN","RORHDT06",132,0)
 ;--- earlier than those of the regular ones.
"RTN","RORHDT06",133,0)
 S ROREXT("HL7DT")=$$FMADD^XLFDT(ROREXT("DXEND")\1,,,1)
"RTN","RORHDT06",134,0)
 ;--- Success
"RTN","RORHDT06",135,0)
 S TMP=$$MSG^RORERR20(-108,.TYPE)
"RTN","RORHDT06",136,0)
 D LOG^RORLOG(TYPE,TMP,,HDTNAME)
"RTN","RORHDT06",137,0)
 Q 0
"RTN","RORHDT06",138,0)
 ;
"RTN","RORHDT06",139,0)
 ;***** STORES THE BACKPULL REFERENCE INTO THE REGISTRY PARAMETERS
"RTN","RORHDT06",140,0)
 ;
"RTN","RORHDT06",141,0)
 ; .REGLST       Reference to a local array containing registry
"RTN","RORHDT06",142,0)
 ;               names as subscripts and registry IENs as values.
"RTN","RORHDT06",143,0)
 ;
"RTN","RORHDT06",144,0)
 ; HDTIEN        IEN of the data extraction definition
"RTN","RORHDT06",145,0)
 ;
"RTN","RORHDT06",146,0)
REGREF(REGLST,HDTIEN) ;
"RTN","RORHDT06",147,0)
 N RC,REGIEN,REGNAME,RORFDA,RORMSG
"RTN","RORHDT06",148,0)
 S REGNAME="",RC=0
"RTN","RORHDT06",149,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:RC<0
"RTN","RORHDT06",150,0)
 . S REGIEN=+REGLST(REGNAME)
"RTN","RORHDT06",151,0)
 . I REGIEN'>0  D  I REGIEN'>0  S RC=REGIEN  Q
"RTN","RORHDT06",152,0)
 . . S REGIEN=$$REGIEN^RORUTL02(REGNAME)
"RTN","RORHDT06",153,0)
 . K RORFDA,RORMSG
"RTN","RORHDT06",154,0)
 . S RORFDA(798.1,REGIEN_",",21.01)=$S(HDTIEN>0:+HDTIEN,1:"@")
"RTN","RORHDT06",155,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORHDT06",156,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798.1,REGIEN_",")
"RTN","RORHDT06",157,0)
 ;---
"RTN","RORHDT06",158,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORHDTAC")
0^47^B8906685
"RTN","RORHDTAC",1,0)
RORHDTAC ;HCIOFO/SG - DATA EXTRACTION ACTION CONFIRMATIONS ; 1/22/06 5:52pm
"RTN","RORHDTAC",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHDTAC",3,0)
 ;
"RTN","RORHDTAC",4,0)
 Q
"RTN","RORHDTAC",5,0)
 ;
"RTN","RORHDTAC",6,0)
 ;***** CONFIRMATION TO CREATE A NEW TASK TABLE
"RTN","RORHDTAC",7,0)
 ;
"RTN","RORHDTAC",8,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDTAC",9,0)
 ;
"RTN","RORHDTAC",10,0)
 ; Return Values:
"RTN","RORHDTAC",11,0)
 ;       <0  Error code
"RTN","RORHDTAC",12,0)
 ;        0  Ok
"RTN","RORHDTAC",13,0)
 ;        1  Cancel
"RTN","RORHDTAC",14,0)
 ;
"RTN","RORHDTAC",15,0)
CREATE(HDEIEN) ;
"RTN","RORHDTAC",16,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IENS,RC,RORBUF,RORMSG,X,Y
"RTN","RORHDTAC",17,0)
 ;--- Display status of the data extract
"RTN","RORHDTAC",18,0)
 S RC=$$STATUS^RORHDT01(HDEIEN)  Q:RC<0 RC
"RTN","RORHDTAC",19,0)
 ;--- Check if registry task table is not empty
"RTN","RORHDTAC",20,0)
 S IENS=","_(+HDEIEN)_","
"RTN","RORHDTAC",21,0)
 D LIST^DIC(799.64,IENS,"@","Q",1,,,"B",,,"RORBUF","RORMSG")
"RTN","RORHDTAC",22,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.64,IENS)
"RTN","RORHDTAC",23,0)
 ;--- Ask for a confirmation to overwrite
"RTN","RORHDTAC",24,0)
 I $G(RORBUF("DILIST",0))>0  D  Q:RC 1
"RTN","RORHDTAC",25,0)
 . K DIR  S DIR(0)="Y"
"RTN","RORHDTAC",26,0)
 . S DIR("A")="Overwrite the existing task table"
"RTN","RORHDTAC",27,0)
 . S DIR("B")="NO"
"RTN","RORHDTAC",28,0)
 . W !  D ^DIR  S RC=$D(DIRUT)!'$G(Y)
"RTN","RORHDTAC",29,0)
 Q 0
"RTN","RORHDTAC",30,0)
 ;
"RTN","RORHDTAC",31,0)
 ;***** CONFIRMATIONS TO START THE TASK
"RTN","RORHDTAC",32,0)
 ;
"RTN","RORHDTAC",33,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDTAC",34,0)
 ; TASKIEN       Task IEN
"RTN","RORHDTAC",35,0)
 ; .FAM          File Access Mode is returned via this parameter
"RTN","RORHDTAC",36,0)
 ;
"RTN","RORHDTAC",37,0)
 ; Return Values:
"RTN","RORHDTAC",38,0)
 ;       <0  Error code
"RTN","RORHDTAC",39,0)
 ;        0  Ok
"RTN","RORHDTAC",40,0)
 ;        1  Cancel
"RTN","RORHDTAC",41,0)
 ;
"RTN","RORHDTAC",42,0)
START(HDEIEN,TASKIEN,FAM) ;
"RTN","RORHDTAC",43,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,FILE,OUTDIR,RC,RORDST,RORSRC,STATUS,X,Y
"RTN","RORHDTAC",44,0)
 S FAM=""
"RTN","RORHDTAC",45,0)
 ;--- Check status of the task
"RTN","RORHDTAC",46,0)
 S STATUS=+$$TASKSTAT^RORHDTUT(HDEIEN,TASKIEN)
"RTN","RORHDTAC",47,0)
 I STATUS=1  D  Q:RC $S(RC<0:RC,1:1)
"RTN","RORHDTAC",48,0)
 . K DIR  S DIR(0)="Y"
"RTN","RORHDTAC",49,0)
 . S DIR("A")="The task is pending. Do you want to reschedule it"
"RTN","RORHDTAC",50,0)
 . S DIR("B")="NO"
"RTN","RORHDTAC",51,0)
 . D ^DIR  S RC=$D(DIRUT)!'$G(Y)
"RTN","RORHDTAC",52,0)
 . S:'RC RC=$$STOP^RORHDT03(HDEIEN,TASKIEN)
"RTN","RORHDTAC",53,0)
 I STATUS=2  D  Q 1
"RTN","RORHDTAC",54,0)
 . W !,"The task is running already"
"RTN","RORHDTAC",55,0)
 I STATUS=3  D  Q:RC 1
"RTN","RORHDTAC",56,0)
 . K DIR  S DIR(0)="Y"
"RTN","RORHDTAC",57,0)
 . S DIR("A")="The task is completed. Do you want to rerun it"
"RTN","RORHDTAC",58,0)
 . S DIR("B")="NO"
"RTN","RORHDTAC",59,0)
 . D ^DIR  S RC=$D(DIRUT)!'$G(Y)
"RTN","RORHDTAC",60,0)
 ;--- Check if the output file exists already
"RTN","RORHDTAC",61,0)
 S RC=$$TASKFILE^RORHDTUT(HDEIEN,TASKIEN,.OUTDIR,.FILE)  Q:RC<0 RC
"RTN","RORHDTAC",62,0)
 S RORSRC(FILE)=""
"RTN","RORHDTAC",63,0)
 S RC=$$LIST^%ZISH(OUTDIR,"RORSRC","RORDST")
"RTN","RORHDTAC",64,0)
 I RC  S:$D(RORDST)>1 FAM="N"
"RTN","RORHDTAC",65,0)
 ;--- Generate the new file name
"RTN","RORHDTAC",66,0)
 I FAM["N"  D  Q:RC<0 RC
"RTN","RORHDTAC",67,0)
 . S RC=$$NEWFILE^RORHDTUT(HDEIEN,TASKIEN,.FILE)
"RTN","RORHDTAC",68,0)
 . W:'RC !,"Data will be written to the '"_FILE_"' file."
"RTN","RORHDTAC",69,0)
 ;---
"RTN","RORHDTAC",70,0)
 Q 0
"RTN","RORHDTAC",71,0)
 ;
"RTN","RORHDTAC",72,0)
 ;***** CONFIRMATION TO STOP THE TASK
"RTN","RORHDTAC",73,0)
 ;
"RTN","RORHDTAC",74,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDTAC",75,0)
 ; TASKIEN       Task IEN
"RTN","RORHDTAC",76,0)
 ;
"RTN","RORHDTAC",77,0)
 ; Return Values:
"RTN","RORHDTAC",78,0)
 ;       <0  Error code
"RTN","RORHDTAC",79,0)
 ;        0  Stop the task
"RTN","RORHDTAC",80,0)
 ;        1  Cancel
"RTN","RORHDTAC",81,0)
 ;
"RTN","RORHDTAC",82,0)
STOP(HDEIEN,TASKIEN) ;
"RTN","RORHDTAC",83,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IENS,STATUS,X,Y,ZTSK
"RTN","RORHDTAC",84,0)
 ;--- Check status of the task
"RTN","RORHDTAC",85,0)
 S STATUS=+$$TASKSTAT^RORHDTUT(HDEIEN,TASKIEN)
"RTN","RORHDTAC",86,0)
 ;--- Quit if the task is not running, pending, nor suspended
"RTN","RORHDTAC",87,0)
 Q:(STATUS'=1)&(STATUS'=2)&(STATUS'=102) 1
"RTN","RORHDTAC",88,0)
 ;--- Get the task number
"RTN","RORHDTAC",89,0)
 S IENS=(+TASKIEN)_","_(+HDEIEN)_","
"RTN","RORHDTAC",90,0)
 S ZTSK=$$GET1^DIQ(799.64,IENS,.02,,,"RORMSG")
"RTN","RORHDTAC",91,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.64,IENS)
"RTN","RORHDTAC",92,0)
 ;--- Ask for the final confirmation
"RTN","RORHDTAC",93,0)
 K DIR  S DIR(0)="Y"
"RTN","RORHDTAC",94,0)
 S DIR("A")=$S(STATUS=1:"Dequeue",1:"Stop")_" the task #"_ZTSK
"RTN","RORHDTAC",95,0)
 S DIR("B")="NO"
"RTN","RORHDTAC",96,0)
 D ^DIR
"RTN","RORHDTAC",97,0)
 Q $D(DIRUT)!'$G(Y)
"RTN","RORHDTUT")
0^48^B48671355
"RTN","RORHDTUT",1,0)
RORHDTUT ;HCIOFO/SG - HISTORICAL DATA EXTRACTION UTILITIES ; 1/23/06 8:16am
"RTN","RORHDTUT",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHDTUT",3,0)
 ;
"RTN","RORHDTUT",4,0)
 Q
"RTN","RORHDTUT",5,0)
 ;
"RTN","RORHDTUT",6,0)
 ;***** RETURNS THE DATA EXTRACTION TIME FRAME(S)
"RTN","RORHDTUT",7,0)
 ;
"RTN","RORHDTUT",8,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDTUT",9,0)
 ;
"RTN","RORHDTUT",10,0)
 ; .DXDTF        Reference to a local array where the time frame(s)
"RTN","RORHDTUT",11,0)
 ;               will be returned to.
"RTN","RORHDTUT",12,0)
 ;
"RTN","RORHDTUT",13,0)
 ;  DXTDF(       A single time frame if no specific parameters are
"RTN","RORHDTUT",14,0)
 ;               defined for the data area(s)
"RTN","RORHDTUT",15,0)
 ;                 ^01: Start Date
"RTN","RORHDTUT",16,0)
 ;                 ^02: End Date
"RTN","RORHDTUT",17,0)
 ;    DataArea)  Time frame for the data area:
"RTN","RORHDTUT",18,0)
 ;                 ^01: Start Date
"RTN","RORHDTUT",19,0)
 ;                 ^02: End Date
"RTN","RORHDTUT",20,0)
 ;
"RTN","RORHDTUT",21,0)
 ; Return Values:
"RTN","RORHDTUT",22,0)
 ;       <0  Error code
"RTN","RORHDTUT",23,0)
 ;        0  Ok
"RTN","RORHDTUT",24,0)
 ;
"RTN","RORHDTUT",25,0)
DXDTF(HDEIEN,DXDTF) ;
"RTN","RORHDTUT",26,0)
 N BUF,DAC,ENDT,IENS,RORBUF,RORMSG,STDT,TMP
"RTN","RORHDTUT",27,0)
 K DXDTF
"RTN","RORHDTUT",28,0)
 ;--- Load the time frame(s) from the data extract definition
"RTN","RORHDTUT",29,0)
 S IENS=(+HDEIEN)_","
"RTN","RORHDTUT",30,0)
 D GETS^DIQ(799.6,IENS,".03;.04;1*","I","RORBUF","RORMSG")
"RTN","RORHDTUT",31,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.6,IENS)
"RTN","RORHDTUT",32,0)
 ;--- Get the main time frame (if defined)
"RTN","RORHDTUT",33,0)
 S STDT=$G(RORBUF(799.6,IENS,.03,"I"))\1  ; Start Date
"RTN","RORHDTUT",34,0)
 S ENDT=$G(RORBUF(799.6,IENS,.04,"I"))\1  ; End Date
"RTN","RORHDTUT",35,0)
 ;--- Check for data area time frames
"RTN","RORHDTUT",36,0)
 S IENS=""
"RTN","RORHDTUT",37,0)
 F  S IENS=$O(RORBUF(799.61,IENS))  Q:IENS=""  D
"RTN","RORHDTUT",38,0)
 . S DAC=+$G(RORBUF(799.61,IENS,.01,"I"))  Q:DAC'>0
"RTN","RORHDTUT",39,0)
 . S BUF=""
"RTN","RORHDTUT",40,0)
 . ;--- Start Date
"RTN","RORHDTUT",41,0)
 . S TMP=$G(RORBUF(799.61,IENS,.02,"I"))\1
"RTN","RORHDTUT",42,0)
 . I TMP'>0  S TMP=STDT  Q:TMP'>0
"RTN","RORHDTUT",43,0)
 . S $P(BUF,U,1)=TMP
"RTN","RORHDTUT",44,0)
 . ;--- End Date
"RTN","RORHDTUT",45,0)
 . S TMP=$G(RORBUF(799.61,IENS,.03,"I"))\1
"RTN","RORHDTUT",46,0)
 . I TMP'>0  S TMP=ENDT  Q:TMP'>0
"RTN","RORHDTUT",47,0)
 . S $P(BUF,U,2)=TMP
"RTN","RORHDTUT",48,0)
 . ;--- Store the time frame
"RTN","RORHDTUT",49,0)
 . S DXDTF(DAC)=BUF
"RTN","RORHDTUT",50,0)
 ;--- Otherwise, return the main time frame
"RTN","RORHDTUT",51,0)
 S:$D(DXDTF)<10 DXDTF=STDT_U_ENDT
"RTN","RORHDTUT",52,0)
 ;--- Success
"RTN","RORHDTUT",53,0)
 Q 0
"RTN","RORHDTUT",54,0)
 ;
"RTN","RORHDTUT",55,0)
 ;***** GENERATES A NEW UNUSED FILE NAME FOR THE TASK
"RTN","RORHDTUT",56,0)
 ;
"RTN","RORHDTUT",57,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDTUT",58,0)
 ; TASKIEN       Task IEN
"RTN","RORHDTUT",59,0)
 ; [.FILE]       New name is returned via this parameter
"RTN","RORHDTUT",60,0)
 ; [GNONLY]      Only generate a new name but do not store it into
"RTN","RORHDTUT",61,0)
 ;               task record
"RTN","RORHDTUT",62,0)
 ;
"RTN","RORHDTUT",63,0)
 ; Return Values:
"RTN","RORHDTUT",64,0)
 ;       <0  Error code
"RTN","RORHDTUT",65,0)
 ;        0  Ok
"RTN","RORHDTUT",66,0)
 ;
"RTN","RORHDTUT",67,0)
NEWFILE(HDEIEN,TASKIEN,FILE,GNONLY) ;
"RTN","RORHDTUT",68,0)
 N BASE,EXT,FN,IENS,NAME,OUTDIR,RC,RORBUF,RORLST,RORMSG,TMP
"RTN","RORHDTUT",69,0)
 S RC=$$TASKFILE(HDEIEN,TASKIEN,.OUTDIR,.FILE)  Q:RC<0 RC
"RTN","RORHDTUT",70,0)
 S BASE=$P($P(FILE,"."),"-",1,3),EXT=$P($P(FILE,".",2),";")
"RTN","RORHDTUT",71,0)
 ;--- Get a list of files in the output directory
"RTN","RORHDTUT",72,0)
 S RORBUF(BASE_"*."_EXT)=""
"RTN","RORHDTUT",73,0)
 Q:'$$LIST^%ZISH(OUTDIR,"RORBUF","RORLST") 0
"RTN","RORHDTUT",74,0)
 Q:$D(RORLST)<10 0
"RTN","RORHDTUT",75,0)
 K RORBUF
"RTN","RORHDTUT",76,0)
 ;--- Generate a new name
"RTN","RORHDTUT",77,0)
 S NAME="",FN=0
"RTN","RORHDTUT",78,0)
 F  S NAME=$O(RORLST(NAME))  Q:NAME=""  D
"RTN","RORHDTUT",79,0)
 . S TMP=+$P(NAME,"-",4)  S:TMP>FN FN=TMP
"RTN","RORHDTUT",80,0)
 S FILE=BASE,$P(FILE,"-",4)=$TR($J(FN+1,2)," ","0")
"RTN","RORHDTUT",81,0)
 S FILE=FILE_"."_EXT
"RTN","RORHDTUT",82,0)
 Q:$G(GNONLY) 0
"RTN","RORHDTUT",83,0)
 K RORLST
"RTN","RORHDTUT",84,0)
 ;--- Store it to the task record
"RTN","RORHDTUT",85,0)
 S IENS=(+TASKIEN)_","_(+HDEIEN)_","
"RTN","RORHDTUT",86,0)
 S RORBUF(799.64,IENS,.05)=FILE
"RTN","RORHDTUT",87,0)
 D FILE^DIE(,"RORBUF","RORMSG")
"RTN","RORHDTUT",88,0)
 Q $$DBS^RORERR("RORMSG",-9,,,799.64,IENS)
"RTN","RORHDTUT",89,0)
 ;
"RTN","RORHDTUT",90,0)
 ;***** PAUSES THE OUTPUT AT PAGE END
"RTN","RORHDTUT",91,0)
 ;
"RTN","RORHDTUT",92,0)
 ; Return values:
"RTN","RORHDTUT",93,0)
 ;       -2  Timeout
"RTN","RORHDTUT",94,0)
 ;       -1  User entered a '^'
"RTN","RORHDTUT",95,0)
 ;        0  Continue
"RTN","RORHDTUT",96,0)
 ;
"RTN","RORHDTUT",97,0)
PAGE() ;
"RTN","RORHDTUT",98,0)
 I $G(IOST)'["C-"  S $Y=0  Q:$QUIT 0  Q
"RTN","RORHDTUT",99,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RORHDTUT",100,0)
 S DIR(0)="E"  D ^DIR  S $Y=0
"RTN","RORHDTUT",101,0)
 Q:$QUIT $S($D(DUOUT):-1,$D(DTOUT):-2,1:0)
"RTN","RORHDTUT",102,0)
 Q
"RTN","RORHDTUT",103,0)
 ;
"RTN","RORHDTUT",104,0)
 ;***** SELECTS/ADDS A HISTORICAL DATA EXTRACTION DEFINITION
"RTN","RORHDTUT",105,0)
 ;
"RTN","RORHDTUT",106,0)
 ; [FLAGS]       Flags that control the processing
"RTN","RORHDTUT",107,0)
 ;                 "A"  Allow addition of new entries
"RTN","RORHDTUT",108,0)
 ;
"RTN","RORHDTUT",109,0)
 ; [.NAME]       Data extract name is returned via this parameter
"RTN","RORHDTUT",110,0)
 ;
"RTN","RORHDTUT",111,0)
 ; [.NATIONAL]   This parameter is set to 1 if a national data
"RTN","RORHDTUT",112,0)
 ;               extraction is selected
"RTN","RORHDTUT",113,0)
 ;
"RTN","RORHDTUT",114,0)
 ; Return Values:
"RTN","RORHDTUT",115,0)
 ;       <0  Error code
"RTN","RORHDTUT",116,0)
 ;       ""  "^" has been entered or timeout
"RTN","RORHDTUT",117,0)
 ;        0  Nothing has been selected
"RTN","RORHDTUT",118,0)
 ;       >0  IEN of the selected definition (file #799.6)
"RTN","RORHDTUT",119,0)
 ;
"RTN","RORHDTUT",120,0)
SELHDE(FLAGS,NAME,NATIONAL) ;
"RTN","RORHDTUT",121,0)
 N DA,DIC,DLAYGO,DTOUT,DUOUT,X,Y
"RTN","RORHDTUT",122,0)
 S NAME="",NATIONAL=0,FLAGS=$G(FLAGS)
"RTN","RORHDTUT",123,0)
 S DIC=799.6,DIC(0)="AENQZ"
"RTN","RORHDTUT",124,0)
 I FLAGS["A"  D  S DIC(0)=DIC(0)_"L",DLAYGO=DIC
"RTN","RORHDTUT",125,0)
 . S DIC("DR")="[RORHDT EDIT EXTRACTION]"
"RTN","RORHDTUT",126,0)
 S DIC("A")="Select a Data Extraction: "
"RTN","RORHDTUT",127,0)
 S DIC("S")="I $P($G(^(0)),U,2)=2"  ; Only "Manual" type
"RTN","RORHDTUT",128,0)
 W !  D ^DIC  Q:$D(DTOUT)!$D(DUOUT) ""
"RTN","RORHDTUT",129,0)
 I Y>0  S NAME=Y(0,0),NATIONAL=+$P(Y(0),U,9)  Q +Y
"RTN","RORHDTUT",130,0)
 Q 0
"RTN","RORHDTUT",131,0)
 ;
"RTN","RORHDTUT",132,0)
 ;***** SELECTS A DATA EXTRACTION TASK
"RTN","RORHDTUT",133,0)
 ;
"RTN","RORHDTUT",134,0)
 ; RORHDIEN      Data Extraction Definition IEN
"RTN","RORHDTUT",135,0)
 ;
"RTN","RORHDTUT",136,0)
 ; Return Values:
"RTN","RORHDTUT",137,0)
 ;       <0  Error code
"RTN","RORHDTUT",138,0)
 ;       ""  "^" has been entered or timeout
"RTN","RORHDTUT",139,0)
 ;        0  Nothing has been selected
"RTN","RORHDTUT",140,0)
 ;       >0  IEN of the selected task (multiple #4 of file #799.6)
"RTN","RORHDTUT",141,0)
 ;
"RTN","RORHDTUT",142,0)
SELTASK(RORHDIEN) ;
"RTN","RORHDTUT",143,0)
 N DA,DIR,DTOUT,DUOUT,IENS,RC,ROROOT,X,Y
"RTN","RORHDTUT",144,0)
 ;--- Display status of the data extraction
"RTN","RORHDTUT",145,0)
 S RC=$$STATUS^RORHDT01(RORHDIEN)  Q:RC<0 RC
"RTN","RORHDTUT",146,0)
 ;--- Select a task
"RTN","RORHDTUT",147,0)
 S ROROOT=$$ROOT^DILFD(799.64,","_RORHDIEN_",",1)
"RTN","RORHDTUT",148,0)
 S TMP=+$O(@ROROOT@(" "),-1)
"RTN","RORHDTUT",149,0)
 S DIR(0)="NO^1:"_TMP_":0^K:'$D(@ROROOT@(X,0)) X"
"RTN","RORHDTUT",150,0)
 S DIR("A")="Task ID"
"RTN","RORHDTUT",151,0)
 S DIR("?")="^I $$TASKLIST^RORHDTUT(RORHDIEN)"
"RTN","RORHDTUT",152,0)
 W !  D ^DIR
"RTN","RORHDTUT",153,0)
 Q $S($D(DTOUT)!$D(DUOUT):"",Y>0:+Y,1:0)
"RTN","RORHDTUT",154,0)
 ;
"RTN","RORHDTUT",155,0)
 ;***** GETS THE NAME OF THE TASK OUTPUT FILE
"RTN","RORHDTUT",156,0)
 ;
"RTN","RORHDTUT",157,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDTUT",158,0)
 ; TASKIEN       Task IEN
"RTN","RORHDTUT",159,0)
 ; .OUTDIR       Output directory is returned via this parameter
"RTN","RORHDTUT",160,0)
 ; .FILE         File name is returned via the parameter
"RTN","RORHDTUT",161,0)
 ;
"RTN","RORHDTUT",162,0)
 ; Return Values:
"RTN","RORHDTUT",163,0)
 ;       <0  Error code
"RTN","RORHDTUT",164,0)
 ;        0  Ok
"RTN","RORHDTUT",165,0)
 ;
"RTN","RORHDTUT",166,0)
TASKFILE(HDEIEN,TASKIEN,OUTDIR,FILE) ;
"RTN","RORHDTUT",167,0)
 N IENS,RC,RORMSG
"RTN","RORHDTUT",168,0)
 S (OUTDIR,FILE)=""
"RTN","RORHDTUT",169,0)
 ;--- Get the output directory
"RTN","RORHDTUT",170,0)
 S IENS=(+HDEIEN)_","
"RTN","RORHDTUT",171,0)
 S OUTDIR=$$GET1^DIQ(799.6,IENS,2,,,"RORMSG")
"RTN","RORHDTUT",172,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.6,IENS)
"RTN","RORHDTUT",173,0)
 ;--- Get the file name
"RTN","RORHDTUT",174,0)
 S IENS=(+TASKIEN)_","_(+HDEIEN)_","
"RTN","RORHDTUT",175,0)
 S FILE=$$GET1^DIQ(799.64,IENS,.05,,,"RORMSG")
"RTN","RORHDTUT",176,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.6,IENS)
"RTN","RORHDTUT",177,0)
 ;--- Success
"RTN","RORHDTUT",178,0)
 Q 0
"RTN","RORHDTUT",179,0)
 ;
"RTN","RORHDTUT",180,0)
 ;***** DISPLAYS THE TASK LIST
"RTN","RORHDTUT",181,0)
 ;
"RTN","RORHDTUT",182,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDTUT",183,0)
 ;
"RTN","RORHDTUT",184,0)
 ; Return Values:
"RTN","RORHDTUT",185,0)
 ;       <0  Error code
"RTN","RORHDTUT",186,0)
 ;        0  Ok
"RTN","RORHDTUT",187,0)
 ;
"RTN","RORHDTUT",188,0)
TASKLIST(HDEIEN) ;
"RTN","RORHDTUT",189,0)
 N IENS,IT,RC,RORBUF,RORMNL,RORMSG,TASKIEN,TS
"RTN","RORHDTUT",190,0)
 ;--- Get the list of tasks
"RTN","RORHDTUT",191,0)
 S IENS=","_(+HDEIEN)_",",TMP="@;.01;.02;.05"
"RTN","RORHDTUT",192,0)
 D LIST^DIC(799.64,IENS,TMP,"Q",,,,"B",,,"RORBUF","RORMSG")
"RTN","RORHDTUT",193,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.64,IENS)
"RTN","RORHDTUT",194,0)
 I $G(RORBUF("DILIST",0))<1  D  Q 0
"RTN","RORHDTUT",195,0)
 . W !,?10,"No tasks have been defined"
"RTN","RORHDTUT",196,0)
 ;--- Get status of the tasks
"RTN","RORHDTUT",197,0)
 S IT=""
"RTN","RORHDTUT",198,0)
 F  S IT=$O(RORBUF("DILIST","ID",IT))  Q:IT=""  D
"RTN","RORHDTUT",199,0)
 . S TASKIEN=+RORBUF("DILIST",2,IT)
"RTN","RORHDTUT",200,0)
 . S TS=$$TASKSTAT(HDEIEN,TASKIEN)
"RTN","RORHDTUT",201,0)
 . S RORBUF("DILIST","ID",IT,.03)=$P(TS,U,2)
"RTN","RORHDTUT",202,0)
 ;--- Display the task table
"RTN","RORHDTUT",203,0)
 S RORMNL=$S($G(IOSL)>3:IOSL-3,1:20),$Y=0
"RTN","RORHDTUT",204,0)
 D TASKLP()  W !
"RTN","RORHDTUT",205,0)
 S IT="",RC=0
"RTN","RORHDTUT",206,0)
 F  S IT=$O(RORBUF("DILIST","ID",IT))  Q:IT=""  D  Q:RC
"RTN","RORHDTUT",207,0)
 . D TASKLP(IT)  S:$Y'<RORMNL RC=$$PAGE()
"RTN","RORHDTUT",208,0)
 ;--- Success
"RTN","RORHDTUT",209,0)
 Q 0
"RTN","RORHDTUT",210,0)
 ;
"RTN","RORHDTUT",211,0)
 ;***** DISPLAYS A LINE OF THE TASK TABLE
"RTN","RORHDTUT",212,0)
 ;
"RTN","RORHDTUT",213,0)
 ; RORBUF        Field values from the record of the file #798.5
"RTN","RORHDTUT",214,0)
 ;               returned by LIST^DIC
"RTN","RORHDTUT",215,0)
 ;
"RTN","RORHDTUT",216,0)
 ; IT            Index in the table
"RTN","RORHDTUT",217,0)
 ;
"RTN","RORHDTUT",218,0)
TASKLP(IT) ;
"RTN","RORHDTUT",219,0)
 ;;!?2^ID^$J($G(RORBUF("DILIST",2,IT)),2)
"RTN","RORHDTUT",220,0)
 ;;?6^File Name^$G(RORBUF("DILIST","ID",IT,.05))
"RTN","RORHDTUT",221,0)
 ;;?39^Task^$G(RORBUF("DILIST","ID",IT,.02))
"RTN","RORHDTUT",222,0)
 ;;?49^Status^$G(RORBUF("DILIST","ID",IT,.03))
"RTN","RORHDTUT",223,0)
 ;
"RTN","RORHDTUT",224,0)
 N I,TMP
"RTN","RORHDTUT",225,0)
 ;--- Display the headers
"RTN","RORHDTUT",226,0)
 I '$G(IT)  D  Q
"RTN","RORHDTUT",227,0)
 . F I=1:1  S TMP=$P($T(TASKLP+I),";;",2,999)  Q:TMP=""  D
"RTN","RORHDTUT",228,0)
 . . W @$TR($P(TMP,"^")," "),$P(TMP,"^",2)
"RTN","RORHDTUT",229,0)
 ;--- Display the values
"RTN","RORHDTUT",230,0)
 F I=1:1  S TMP=$P($T(TASKLP+I),";;",2,999)  Q:TMP=""  D
"RTN","RORHDTUT",231,0)
 . W @$TR($P(TMP,"^")," "),@$P(TMP,"^",3)
"RTN","RORHDTUT",232,0)
 Q
"RTN","RORHDTUT",233,0)
 ;
"RTN","RORHDTUT",234,0)
 ;***** RETURNS THE TASK NUMBER
"RTN","RORHDTUT",235,0)
 ;
"RTN","RORHDTUT",236,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDTUT",237,0)
 ; TASKIEN       Task IEN
"RTN","RORHDTUT",238,0)
 ;
"RTN","RORHDTUT",239,0)
 ; Return Values:
"RTN","RORHDTUT",240,0)
 ;       <0  Error code
"RTN","RORHDTUT",241,0)
 ;        0  No task defined
"RTN","RORHDTUT",242,0)
 ;       >0  Task Number
"RTN","RORHDTUT",243,0)
 ;
"RTN","RORHDTUT",244,0)
TASKNUM(HDEIEN,TASKIEN) ;
"RTN","RORHDTUT",245,0)
 N IENS,RORMSG,TASK
"RTN","RORHDTUT",246,0)
 S IENS=(+TASKIEN)_","_(+HDEIEN)_","
"RTN","RORHDTUT",247,0)
 S TASK=+$$GET1^DIQ(799.64,IENS,.02,"I",,"RORMSG")
"RTN","RORHDTUT",248,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.64,IENS)
"RTN","RORHDTUT",249,0)
 Q TASK
"RTN","RORHDTUT",250,0)
 ;
"RTN","RORHDTUT",251,0)
 ;***** RETURNS STATUS OF THE TASK
"RTN","RORHDTUT",252,0)
 ;
"RTN","RORHDTUT",253,0)
 ; HDEIEN        Data Extract IEN
"RTN","RORHDTUT",254,0)
 ; TASKIEN       Task IEN
"RTN","RORHDTUT",255,0)
 ; [LTO]         LOCK timeout
"RTN","RORHDTUT",256,0)
 ;
"RTN","RORHDTUT",257,0)
 ; Return Values:
"RTN","RORHDTUT",258,0)
 ;       <0  Error code
"RTN","RORHDTUT",259,0)
 ;        0  Unknown Status
"RTN","RORHDTUT",260,0)
 ;       >0  Status (Code^Description)
"RTN","RORHDTUT",261,0)
 ;
"RTN","RORHDTUT",262,0)
 ;               1  Active: Pending
"RTN","RORHDTUT",263,0)
 ;               2  Active: Running
"RTN","RORHDTUT",264,0)
 ;               3  Inactive: Finished
"RTN","RORHDTUT",265,0)
 ;               4  Inactive: Available
"RTN","RORHDTUT",266,0)
 ;               5  Inactive: Interrupted
"RTN","RORHDTUT",267,0)
 ;
"RTN","RORHDTUT",268,0)
 ;             100  Inactive: Crashed
"RTN","RORHDTUT",269,0)
 ;             101  Inactive: Errors
"RTN","RORHDTUT",270,0)
 ;             102  Active: Suspended
"RTN","RORHDTUT",271,0)
 ;             103  Active: Stopping
"RTN","RORHDTUT",272,0)
 ;
"RTN","RORHDTUT",273,0)
TASKSTAT(HDEIEN,TASKIEN,LTO) ;
"RTN","RORHDTUT",274,0)
 N IENS,RORBUF,RORFDA,RORMSG,STATUS,TASK,TMP
"RTN","RORHDTUT",275,0)
 S IENS=(+TASKIEN)_","_(+HDEIEN)_","
"RTN","RORHDTUT",276,0)
 ;--- Get the task number and its last known status
"RTN","RORHDTUT",277,0)
 D GETS^DIQ(799.64,IENS,".02;.03","EI","RORBUF","RORMSG")
"RTN","RORHDTUT",278,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.64,IENS)
"RTN","RORHDTUT",279,0)
 S TASK=$G(RORBUF(799.64,IENS,.02,"I"))
"RTN","RORHDTUT",280,0)
 Q:TASK="" 0
"RTN","RORHDTUT",281,0)
 ;--- Try to get status of the task
"RTN","RORHDTUT",282,0)
 S STATUS=$$STATUS^RORTSK02(TASK,$G(LTO))
"RTN","RORHDTUT",283,0)
 Q:STATUS<0 STATUS
"RTN","RORHDTUT",284,0)
 ;--- If the  task record exists, then update the task STATUS
"RTN","RORHDTUT",285,0)
 ;--- field if necessary and return the current task status
"RTN","RORHDTUT",286,0)
 I STATUS>0  D:+STATUS'=$G(RORBUF(799.64,IENS,.03,"I"))  Q STATUS
"RTN","RORHDTUT",287,0)
 . S RORFDA(799.64,IENS,.03)=+STATUS
"RTN","RORHDTUT",288,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORHDTUT",289,0)
 . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,799.64,IENS)
"RTN","RORHDTUT",290,0)
 ;--- Otherwise, return the last known status
"RTN","RORHDTUT",291,0)
 S STATUS=+$G(RORBUF(799.64,IENS,.03,"I"))
"RTN","RORHDTUT",292,0)
 Q:STATUS'>0 0
"RTN","RORHDTUT",293,0)
 S TMP=$TR($G(RORBUF(799.64,IENS,.03,"E")),">",":")
"RTN","RORHDTUT",294,0)
 Q STATUS_U_TMP
"RTN","RORHIV03")
0^198^B35616768
"RTN","RORHIV03",1,0)
RORHIV03 ;HCIOFO/SG - CONVERSION OF THE FILE #158 ; 5/12/05 2:53pm
"RTN","RORHIV03",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHIV03",3,0)
 ;
"RTN","RORHIV03",4,0)
 Q
"RTN","RORHIV03",5,0)
 ;
"RTN","RORHIV03",6,0)
 ;***** TRANSFERS THE CDC COMMENTS TO THE MULTIPLE #25
"RTN","RORHIV03",7,0)
CDCOMM() ;
"RTN","RORHIV03",8,0)
 N CNT,I,IENS,RC,RORBUF,RORFDA,RORMSG,TMP
"RTN","RORHIV03",9,0)
 S (CNT,RC)=0
"RTN","RORHIV03",10,0)
 ;--- Load the old comments (non-empty ones)
"RTN","RORHIV03",11,0)
 F I=3,2,1  D
"RTN","RORHIV03",12,0)
 . S TMP=$G(^IMR(158,IMRIEN,I+9))
"RTN","RORHIV03",13,0)
 . S:(TMP'="")!CNT RORBUF(I,0)=TMP,CNT=CNT+1
"RTN","RORHIV03",14,0)
 ;--- Store the comments in the new word processing field
"RTN","RORHIV03",15,0)
 D:$D(RORBUF)>1
"RTN","RORHIV03",16,0)
 . S IENS=RORIEN_","
"RTN","RORHIV03",17,0)
 . S RORFDA(799.4,IENS,25)="RORBUF"
"RTN","RORHIV03",18,0)
 . D UPDATE^DIE(,"RORFDA",,"RORMSG")
"RTN","RORHIV03",19,0)
 . I $G(DIERR)  D
"RTN","RORHIV03",20,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,799.4,IENS)
"RTN","RORHIV03",21,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORHIV03",22,0)
 ;
"RTN","RORHIV03",23,0)
 ;***** TRANSFERS THE PATIENT'S DATA FROM FILE #158 TO FILE #799.4
"RTN","RORHIV03",24,0)
 ;
"RTN","RORHIV03",25,0)
 ; IMRIEN        IEN of the IMMUNOLOGY CASE STUDY file record
"RTN","RORHIV03",26,0)
 ; RORIEN        IEN of the record of the ROR HIV RECORD file
"RTN","RORHIV03",27,0)
 ;
"RTN","RORHIV03",28,0)
 ; Return Values:
"RTN","RORHIV03",29,0)
 ;       <0  Error code
"RTN","RORHIV03",30,0)
 ;        0  Ok
"RTN","RORHIV03",31,0)
 ;
"RTN","RORHIV03",32,0)
CNVPTDAT(IMRIEN,RORIEN) ;
"RTN","RORHIV03",33,0)
 N DA,DIK,RC,RORNODE,TMP
"RTN","RORHIV03",34,0)
 S RORNODE=""
"RTN","RORHIV03",35,0)
 ;--- Check the parameters
"RTN","RORHIV03",36,0)
 I '$D(^IMR(158,IMRIEN,0))  D  Q RC
"RTN","RORHIV03",37,0)
 . S RC=$$ERROR^RORERR(-88,,,,"IMRIEN",IMRIEN)
"RTN","RORHIV03",38,0)
 I '$D(^RORDATA(799.4,RORIEN,0))  D  Q RC
"RTN","RORHIV03",39,0)
 . S RC=$$ERROR^RORERR(-88,,,,"RORIEN",RORIEN)
"RTN","RORHIV03",40,0)
 ;---
"RTN","RORHIV03",41,0)
 S RORNODE=^RORDATA(799.4,RORIEN,0)
"RTN","RORHIV03",42,0)
 D COPY(0,"42>2,23>3")
"RTN","RORHIV03",43,0)
 D COPY(1,"7>4")
"RTN","RORHIV03",44,0)
 I $P(RORNODE,U,2)=4  D  ; CLINICAL AIDS
"RTN","RORHIV03",45,0)
 . S $P(RORNODE,U,2)=1,TMP=$P(RORNODE,U,3)\1
"RTN","RORHIV03",46,0)
 . I TMP<1000000  S $P(RORNODE,U,3)=""  Q
"RTN","RORHIV03",47,0)
 . S:'$E(TMP,4,5) $E(TMP,4,5)="01"
"RTN","RORHIV03",48,0)
 . S:'$E(TMP,6,7) $E(TMP,6,7)="01"
"RTN","RORHIV03",49,0)
 . S $P(RORNODE,U,3)=TMP
"RTN","RORHIV03",50,0)
 E  S $P(RORNODE,U,2,3)=U
"RTN","RORHIV03",51,0)
 D STORE(0)
"RTN","RORHIV03",52,0)
 ;---
"RTN","RORHIV03",53,0)
 D COPY(1,"6>1,34>5,9>9,10>10,11>11,12>12,13>13,14>14")
"RTN","RORHIV03",54,0)
 D COPY(2,"16>4")
"RTN","RORHIV03",55,0)
 D COPY(102,"8>7,23>8")
"RTN","RORHIV03",56,0)
 D COPY(110,"1>2,2>3")
"RTN","RORHIV03",57,0)
 D COPY(112,"5>6")
"RTN","RORHIV03",58,0)
 D STORE(9)
"RTN","RORHIV03",59,0)
 ;---
"RTN","RORHIV03",60,0)
 D COPY(102,"19>5")
"RTN","RORHIV03",61,0)
 D COPY(110,"4>1,5>4")
"RTN","RORHIV03",62,0)
 D COPY(112,"7>2,8>3")
"RTN","RORHIV03",63,0)
 D STORE(11)
"RTN","RORHIV03",64,0)
 ;---
"RTN","RORHIV03",65,0)
 D COPY(1,"16>2,17>3,18>4")
"RTN","RORHIV03",66,0)
 D COPY(2,"54>1")
"RTN","RORHIV03",67,0)
 D COPY(102,"10>7")
"RTN","RORHIV03",68,0)
 D COPY(110,"16>5")
"RTN","RORHIV03",69,0)
 D COPY(112,"6>6")
"RTN","RORHIV03",70,0)
 D STORE(12)
"RTN","RORHIV03",71,0)
 ;---
"RTN","RORHIV03",72,0)
 D COPY(1,"26>3,20>6,28>7,29>8,30>9,31>10,32>12,21>13,22>14,23>15,24>17")
"RTN","RORHIV03",73,0)
 D TRANSL(1,19,5,"1,2,3","1,2,8")
"RTN","RORHIV03",74,0)
 D COPY(2,"21>1,23>2,53>4,55>18")
"RTN","RORHIV03",75,0)
 D COPY(102,"14>16")
"RTN","RORHIV03",76,0)
 D COPY(110,"3>11")
"RTN","RORHIV03",77,0)
 D STORE(14)
"RTN","RORHIV03",78,0)
 ;---
"RTN","RORHIV03",79,0)
 D COPY(1,"35>1,36>9")
"RTN","RORHIV03",80,0)
 D COPY(2,"49>5"),TRANSL(2,50,7,"P,N,I,U","1,0,8,9")
"RTN","RORHIV03",81,0)
 D COPY(102,"20>11")
"RTN","RORHIV03",82,0)
 D COPY(108,"27>2,28>6,29>8,30>12")
"RTN","RORHIV03",83,0)
 D COPY(110,"17>3,18>4,19>13,20>14")
"RTN","RORHIV03",84,0)
 D STORE(16)
"RTN","RORHIV03",85,0)
 ;---
"RTN","RORHIV03",86,0)
 D COPY(111,"10>1,11>2,12>3,13>4,14>5,1>6,2>7,3>8,4>9")
"RTN","RORHIV03",87,0)
 D STORE(18)
"RTN","RORHIV03",88,0)
 ;---
"RTN","RORHIV03",89,0)
 D COPY(102,"21>1,22>3")
"RTN","RORHIV03",90,0)
 D COPY(108,"31>2")
"RTN","RORHIV03",91,0)
 D COPY(111,"5>4,6>5,7>6,8>7,9>8")
"RTN","RORHIV03",92,0)
 D STORE(20)
"RTN","RORHIV03",93,0)
 ;---
"RTN","RORHIV03",94,0)
 D COPY(110,"6>1,7>2,8>4,9>5,10>6,11>7,12>8")
"RTN","RORHIV03",95,0)
 D COPY(112,"11>3")
"RTN","RORHIV03",96,0)
 D STORE(22)
"RTN","RORHIV03",97,0)
 ;---
"RTN","RORHIV03",98,0)
 D TRANSL(110,13,1,"1,2,9","1,0,9")
"RTN","RORHIV03",99,0)
 D TRANSL(110,14,2,"1,2,9","1,0,9")
"RTN","RORHIV03",100,0)
 D TRANSL(110,15,3,"1,2,9","1,0,9")
"RTN","RORHIV03",101,0)
 D COPY(112,"1>4,2>5,3>6,4>7")
"RTN","RORHIV03",102,0)
 D STORE(23)
"RTN","RORHIV03",103,0)
 ;---
"RTN","RORHIV03",104,0)
 S RC=$$INIDIAGS()  Q:RC<0 RC
"RTN","RORHIV03",105,0)
 S RC=$$CDCOMM()  Q:RC<0 RC
"RTN","RORHIV03",106,0)
 ;--- Reindex the entry
"RTN","RORHIV03",107,0)
 S DIK="^RORDATA(799.4,",DA=RORIEN  D IX1^DIK
"RTN","RORHIV03",108,0)
 Q 0
"RTN","RORHIV03",109,0)
 ;
"RTN","RORHIV03",110,0)
 ;***** COPY THE FIELD DATA
"RTN","RORHIV03",111,0)
COPY(SRCN,PTLIST) ;
"RTN","RORHIV03",112,0)
 N DSTP,I,SRCP,TMP
"RTN","RORHIV03",113,0)
 S:'$D(RORNODE(SRCN)) RORNODE(SRCN)=$G(^IMR(158,IMRIEN,SRCN))
"RTN","RORHIV03",114,0)
 F I=1:1  S TMP=$P(PTLIST,",",I)  Q:TMP=""  D
"RTN","RORHIV03",115,0)
 . S SRCP=+$P(TMP,">"),DSTP=+$P(TMP,">",2)
"RTN","RORHIV03",116,0)
 . S TMP=$P(RORNODE(SRCN),U,SRCP)
"RTN","RORHIV03",117,0)
 . S:TMP'="" $P(RORNODE,U,DSTP)=TMP
"RTN","RORHIV03",118,0)
 Q
"RTN","RORHIV03",119,0)
 ;
"RTN","RORHIV03",120,0)
 ;***** TRANSFER INITIAL DIAGNOSES
"RTN","RORHIV03",121,0)
INIDIAGS() ;
"RTN","RORHIV03",122,0)
 ;;01^2;24^108;1
"RTN","RORHIV03",123,0)
 ;;02^2;25^108;2
"RTN","RORHIV03",124,0)
 ;;03^102;15^108;3
"RTN","RORHIV03",125,0)
 ;;04^2;26^108;4
"RTN","RORHIV03",126,0)
 ;;05^2;27^108;5
"RTN","RORHIV03",127,0)
 ;;06^2;28^108;6
"RTN","RORHIV03",128,0)
 ;;07^2;29^108;7
"RTN","RORHIV03",129,0)
 ;;08^2;30^108;8
"RTN","RORHIV03",130,0)
 ;;09^2;31^108;9
"RTN","RORHIV03",131,0)
 ;;10^2;32^108;10
"RTN","RORHIV03",132,0)
 ;;11^2;33^108;11
"RTN","RORHIV03",133,0)
 ;;12^2;34^108;12
"RTN","RORHIV03",134,0)
 ;;13^2;35^108;13
"RTN","RORHIV03",135,0)
 ;;14^1;36^108;14
"RTN","RORHIV03",136,0)
 ;;15^2;37^108;15
"RTN","RORHIV03",137,0)
 ;;16^2;38^108;16
"RTN","RORHIV03",138,0)
 ;;17^2;39^108;17
"RTN","RORHIV03",139,0)
 ;;18^102;16^108;18
"RTN","RORHIV03",140,0)
 ;;19^2;40^108;19
"RTN","RORHIV03",141,0)
 ;;20^2;41^108;20
"RTN","RORHIV03",142,0)
 ;;21^2;42^108;21
"RTN","RORHIV03",143,0)
 ;;22^102;17^108;22
"RTN","RORHIV03",144,0)
 ;;23^2;43^108;23
"RTN","RORHIV03",145,0)
 ;;24^2;44^108;24
"RTN","RORHIV03",146,0)
 ;;25^2;45^108;25
"RTN","RORHIV03",147,0)
 ;;26^2;46^108;26
"RTN","RORHIV03",148,0)
 ;
"RTN","RORHIV03",149,0)
 N BUF,DATE,DIAG,DIEN,I,IENS,RC,RORFDA,RORILST,RORMSG,TMP
"RTN","RORHIV03",150,0)
 K ^RORDATA(799.4,RORIEN,10)  S RC=0
"RTN","RORHIV03",151,0)
 ;--- Load the old data nodes (if they have not been loaded yet)
"RTN","RORHIV03",152,0)
 F I=2,102,108  D:'$D(RORNODE(I))
"RTN","RORHIV03",153,0)
 . S RORNODE(I)=$G(^IMR(158,IMRIEN,I))
"RTN","RORHIV03",154,0)
 ;--- Prepare the data
"RTN","RORHIV03",155,0)
 F I=1:1  S BUF=$P($T(INIDIAGS+I),";;",2,99)  Q:BUF=""  D
"RTN","RORHIV03",156,0)
 . S DIEN=+BUF
"RTN","RORHIV03",157,0)
 . S TMP=$P(BUF,U,2),DX=$P(RORNODE(+TMP),U,$P(TMP,";",2))
"RTN","RORHIV03",158,0)
 . S DX=$TR(DX,"DPN0","12")  Q:DX=""
"RTN","RORHIV03",159,0)
 . S TMP=$P(BUF,U,3),DATE=$P(RORNODE(+TMP),U,$P(TMP,";",2))
"RTN","RORHIV03",160,0)
 . ;---
"RTN","RORHIV03",161,0)
 . S IENS="+"_I_","_RORIEN_","
"RTN","RORHIV03",162,0)
 . S RORFDA(799.41,IENS,.01)=DIEN
"RTN","RORHIV03",163,0)
 . S RORFDA(799.41,IENS,.02)=DX
"RTN","RORHIV03",164,0)
 . S RORFDA(799.41,IENS,.03)=DATE
"RTN","RORHIV03",165,0)
 . S RORILST(I)=DIEN
"RTN","RORHIV03",166,0)
 ;--- Store the data
"RTN","RORHIV03",167,0)
 D:$D(RORFDA)>1
"RTN","RORHIV03",168,0)
 . D UPDATE^DIE(,"RORFDA","RORILST","RORMSG")
"RTN","RORHIV03",169,0)
 . I $G(DIERR)  D  Q
"RTN","RORHIV03",170,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,799.41)
"RTN","RORHIV03",171,0)
 ;---
"RTN","RORHIV03",172,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORHIV03",173,0)
 ;
"RTN","RORHIV03",174,0)
 ;***** TEMPORARY 'AFTER UPDATE' CALL-BACK ENTRY POINT
"RTN","RORHIV03",175,0)
 ;
"RTN","RORHIV03",176,0)
 ; RORIEN        An IEN of the newly added registry record
"RTN","RORHIV03",177,0)
 ; PATIEN        Patient IEN
"RTN","RORHIV03",178,0)
 ; REGIEN        Registry IEN
"RTN","RORHIV03",179,0)
 ;
"RTN","RORHIV03",180,0)
 ; Return Values:
"RTN","RORHIV03",181,0)
 ;       <0  Error Code
"RTN","RORHIV03",182,0)
 ;        0  Ok
"RTN","RORHIV03",183,0)
 ;
"RTN","RORHIV03",184,0)
POSTUPD(RORIEN,PATIEN,REGIEN) ;
"RTN","RORHIV03",185,0)
 N CODE,IEN158,IENS,RC,RORFDA,RORMSG,TMP
"RTN","RORHIV03",186,0)
 ;--- Perform the standard HIV post-update actions
"RTN","RORHIV03",187,0)
 S RC=$$POSTUPD^RORUPD62(RORIEN,PATIEN,REGIEN)  Q:RC<0 RC
"RTN","RORHIV03",188,0)
 ;--- Check if the patient is in the ICR v2.1
"RTN","RORHIV03",189,0)
 S CODE=$$XOR^RORUTL03(PATIEN)
"RTN","RORHIV03",190,0)
 S IEN158=$O(^IMR(158,"B",CODE,""))  Q:IEN158'>0 0
"RTN","RORHIV03",191,0)
 S IENS=RORIEN_","
"RTN","RORHIV03",192,0)
 ;--- Populate the DATE ENTERED with the date of first selection rule
"RTN","RORHIV03",193,0)
 S TMP=$$GET1^DIQ(798,IENS,3.2,"I",,"RORMSG")
"RTN","RORHIV03",194,0)
 D:$G(DIERR) DBS^RORERR("RORMSG",-9,,PATIEN,798,IENS)
"RTN","RORHIV03",195,0)
 S:TMP>0 RORFDA(798,IENS,1)=TMP
"RTN","RORHIV03",196,0)
 ;--- Convert the patient's data
"RTN","RORHIV03",197,0)
 D:$$CNVPTDAT(IEN158,RORIEN)'<0
"RTN","RORHIV03",198,0)
 . ;--- Replace the 'Pending' flag with 'Active'
"RTN","RORHIV03",199,0)
 . S RORFDA(798,IENS,3)=0    ; STATUS (Pending -> Active)
"RTN","RORHIV03",200,0)
 . S RORFDA(798,IENS,11)="@" ; DON'T SEND
"RTN","RORHIV03",201,0)
 ;--- Update the registry record if necessary
"RTN","RORHIV03",202,0)
 I $D(RORFDA)>1  D  Q:RC<0 RC
"RTN","RORHIV03",203,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORHIV03",204,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,PATIEN,798,IENS)
"RTN","RORHIV03",205,0)
 ;---
"RTN","RORHIV03",206,0)
 Q 0
"RTN","RORHIV03",207,0)
 ;
"RTN","RORHIV03",208,0)
 ;***** CREATES THE NEW DATA NODE IN THE RECORD OF THE FILE #799.4
"RTN","RORHIV03",209,0)
STORE(DSTN) ;
"RTN","RORHIV03",210,0)
 K ^RORDATA(799.4,RORIEN,DSTN)
"RTN","RORHIV03",211,0)
 S:RORNODE'="" ^RORDATA(799.4,RORIEN,DSTN)=RORNODE
"RTN","RORHIV03",212,0)
 S RORNODE=""
"RTN","RORHIV03",213,0)
 Q
"RTN","RORHIV03",214,0)
 ;
"RTN","RORHIV03",215,0)
 ;***** TRANSLATE THE SET OF CODES
"RTN","RORHIV03",216,0)
TRANSL(SRCN,SRCP,DSTP,FROM,TO) ;
"RTN","RORHIV03",217,0)
 N TMP
"RTN","RORHIV03",218,0)
 S:'$D(RORNODE(SRCN)) RORNODE(SRCN)=$G(^IMR(158,IMRIEN,SRCN))
"RTN","RORHIV03",219,0)
 S TMP=$P(RORNODE(SRCN),U,SRCP)
"RTN","RORHIV03",220,0)
 S:TMP'="" $P(RORNODE,U,DSTP)=$TR(TMP,FROM,TO)
"RTN","RORHIV03",221,0)
 Q
"RTN","RORHIVUT")
0^199^B835917
"RTN","RORHIVUT",1,0)
RORHIVUT ;HCIOFO/SG - HIV UTILITIES ; 9/14/05 8:15am
"RTN","RORHIVUT",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHIVUT",3,0)
 ;
"RTN","RORHIVUT",4,0)
 Q
"RTN","RORHIVUT",5,0)
 ;
"RTN","RORHIVUT",6,0)
 ;***** RETURNS THE CATEGORY SUBSCRIPT AND HEADER
"RTN","RORHIVUT",7,0)
CAT(I) ;
"RTN","RORHIVUT",8,0)
 ;;ALL^AIDS^HIV
"RTN","RORHIVUT",9,0)
 ;;All Patients^AIDS OI^HIV+ (no AIDS OI)
"RTN","RORHIVUT",10,0)
 ;
"RTN","RORHIVUT",11,0)
 Q $P($P($T(CAT+1),";;",2),U,I)_U_$P($P($T(CAT+2),";;",2),U,I)
"RTN","RORHIVUT",12,0)
 ;
"RTN","RORHIVUT",13,0)
 ;***** RETURNS CLINICAL AIDS STATUS OF THE PATIENT
"RTN","RORHIVUT",14,0)
 ;
"RTN","RORHIVUT",15,0)
 ; IEN           IEN of the registry record
"RTN","RORHIVUT",16,0)
 ;
"RTN","RORHIVUT",17,0)
 ; [DATE]        Date that the status should be determined on.
"RTN","RORHIVUT",18,0)
 ;
"RTN","RORHIVUT",19,0)
 ;               If not defined or not greater than 0 then the
"RTN","RORHIVUT",20,0)
 ;               date of Clinical AIDS is not checked.
"RTN","RORHIVUT",21,0)
 ;
"RTN","RORHIVUT",22,0)
 ; Return Values:
"RTN","RORHIVUT",23,0)
 ;        0  No Clinical AIDS
"RTN","RORHIVUT",24,0)
 ;        1  Clinical AIDS. The second "^"-piece will
"RTN","RORHIVUT",25,0)
 ;           contain the Clinical AIDS date
"RTN","RORHIVUT",26,0)
 ;
"RTN","RORHIVUT",27,0)
CLINAIDS(IEN,DATE) ;
"RTN","RORHIVUT",28,0)
 N X  S X=$P($G(^RORDATA(799.4,+IEN,0)),U,2,3)
"RTN","RORHIVUT",29,0)
 Q:'X 0
"RTN","RORHIVUT",30,0)
 I $G(DATE)>0  Q:$P(X,U,2)\1>DATE 0
"RTN","RORHIVUT",31,0)
 Q "1"_U_$P(X,U,2)
"RTN","RORHIVUT",32,0)
 ;
"RTN","RORHIVUT",33,0)
 ;***** CHECKS IF THE ICR RECORD EXISTS
"RTN","RORHIVUT",34,0)
 ;
"RTN","RORHIVUT",35,0)
 ; IEN           IEN of the registry record
"RTN","RORHIVUT",36,0)
 ;
"RTN","RORHIVUT",37,0)
 ; Return Values:
"RTN","RORHIVUT",38,0)
 ;        0  Record does not exist
"RTN","RORHIVUT",39,0)
 ;        1  The ICR record exists
"RTN","RORHIVUT",40,0)
 ;
"RTN","RORHIVUT",41,0)
ICRDEF(IEN) ;
"RTN","RORHIVUT",42,0)
 Q $G(^RORDATA(799.4,+IEN,0))>0
"RTN","RORHIVUT",43,0)
 ;
"RTN","RORHIVUT",44,0)
 ;***** RETURNS NUMBER OF AVAILABLE CATEGORIES
"RTN","RORHIVUT",45,0)
NCAT() ;
"RTN","RORHIVUT",46,0)
 Q $L($P($T(CAT+1),";;",2),U)
"RTN","RORHL01")
0^49^B7061029
"RTN","RORHL01",1,0)
RORHL01 ;HOIFO/CRT - HL7 PATIENT DATA: PID,ZSP,ZRD ; 7/29/05 2:05pm
"RTN","RORHL01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL01",3,0)
 ;
"RTN","RORHL01",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL01",5,0)
 ;
"RTN","RORHL01",6,0)
 ; #263          $$EN^VAFHLPID (controlled)
"RTN","RORHL01",7,0)
 ; #3630         BLDPID^VAFCQRY (controlled) ??? - have to subscribe
"RTN","RORHL01",8,0)
 ; #10035        Read access to the PATIENT file (supported)
"RTN","RORHL01",9,0)
 ;
"RTN","RORHL01",10,0)
 ; #???          $$EN^VAFHLZSP
"RTN","RORHL01",11,0)
 ; #???          EN^VAFHLZRD
"RTN","RORHL01",12,0)
 ;
"RTN","RORHL01",13,0)
 Q
"RTN","RORHL01",14,0)
 ;
"RTN","RORHL01",15,0)
 ;***** PID SEGMENT BUILDER
"RTN","RORHL01",16,0)
 ;
"RTN","RORHL01",17,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL01",18,0)
 ;
"RTN","RORHL01",19,0)
 ; Return Values:
"RTN","RORHL01",20,0)
 ;       <0  Error Code
"RTN","RORHL01",21,0)
 ;        0  Ok
"RTN","RORHL01",22,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL01",23,0)
 ;
"RTN","RORHL01",24,0)
PID(RORDFN) ;
"RTN","RORHL01",25,0)
 N CS,ERRCNT,I,PTID,RC,RORBUF,RORMSG,RPS,SCS,SEG,TMP
"RTN","RORHL01",26,0)
 S (ERRCNT,RC)=0
"RTN","RORHL01",27,0)
 D ECH^RORHL7(.CS,.SCS,.RPS)
"RTN","RORHL01",28,0)
 ;
"RTN","RORHL01",29,0)
 ;--- Check if the patient exists
"RTN","RORHL01",30,0)
 S RORDFN=+$G(RORDFN)
"RTN","RORHL01",31,0)
 I '$D(^DPT(RORDFN,0))  D  Q RC
"RTN","RORHL01",32,0)
 . S RC=$$ERROR^RORERR(-36,,,RORDFN,2)
"RTN","RORHL01",33,0)
 ;
"RTN","RORHL01",34,0)
 ;--- Call Standard PID Segment builder
"RTN","RORHL01",35,0)
 S TMP="3,5,7,8,10,11,19,22,29"
"RTN","RORHL01",36,0)
 D BLDPID^VAFCQRY(RORDFN,"",TMP,.RORBUF,.RORHL,.RORMSG)
"RTN","RORHL01",37,0)
 ;---
"RTN","RORHL01",38,0)
 D LOADSEG^RORHL7A(.SEG,"RORBUF")
"RTN","RORHL01",39,0)
 ;
"RTN","RORHL01",40,0)
 ;--- PID-3 Patient Identifiers
"RTN","RORHL01",41,0)
 S PTID=""
"RTN","RORHL01",42,0)
 F I=1:1  S TMP=$P(SEG(3),RPS,I)  Q:TMP=""  D
"RTN","RORHL01",43,0)
 . S:"NI,PI"[$P(TMP,CS,5) PTID=PTID_RPS_TMP
"RTN","RORHL01",44,0)
 S SEG(3)=$P(PTID,RPS,2,99)
"RTN","RORHL01",45,0)
 ;
"RTN","RORHL01",46,0)
 ;--- PID-5 Remove the Patient Name
"RTN","RORHL01",47,0)
 S SEG(5)=""
"RTN","RORHL01",48,0)
 ;
"RTN","RORHL01",49,0)
 ;--- PID-10 Send the old race if the new format is not available
"RTN","RORHL01",50,0)
 I $G(SEG(10))?.""""  D
"RTN","RORHL01",51,0)
 . N VAFPID
"RTN","RORHL01",52,0)
 . S TMP=$$EN^VAFHLPID(RORDFN,"10")
"RTN","RORHL01",53,0)
 . S:$G(VAFPID(1))'="" RORSEG=RORSEG_VAFPID(1)
"RTN","RORHL01",54,0)
 . S SEG(10)=$P(TMP,HLFS,11)
"RTN","RORHL01",55,0)
 ;
"RTN","RORHL01",56,0)
 ;--- PID-11 Remove Address (leave ZIP only)
"RTN","RORHL01",57,0)
 S SEG(11)=CS_CS_CS_CS_$P($G(SEG(11)),CS,5)
"RTN","RORHL01",58,0)
 ;
"RTN","RORHL01",59,0)
 ;--- PID-19 Encrypt SSN
"RTN","RORHL01",60,0)
 S SEG(19)=$$XOR^RORUTL03($G(SEG(19)))
"RTN","RORHL01",61,0)
 ;
"RTN","RORHL01",62,0)
 ;--- Store the segment
"RTN","RORHL01",63,0)
 D ADDSEG^RORHL7(.SEG)
"RTN","RORHL01",64,0)
 Q ERRCNT
"RTN","RORHL01",65,0)
 ;
"RTN","RORHL01",66,0)
 ;***** ZSP SEGMENT BUILDER
"RTN","RORHL01",67,0)
 ;
"RTN","RORHL01",68,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL01",69,0)
 ;
"RTN","RORHL01",70,0)
 ; Return Values:
"RTN","RORHL01",71,0)
 ;       <0  Error Code
"RTN","RORHL01",72,0)
 ;        0  Ok
"RTN","RORHL01",73,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL01",74,0)
 ;
"RTN","RORHL01",75,0)
ZSP(RORDFN) ;
"RTN","RORHL01",76,0)
 N RC,RORFLDS,RORSEG
"RTN","RORHL01",77,0)
 S RC=0
"RTN","RORHL01",78,0)
 ;
"RTN","RORHL01",79,0)
 ;--- Check if the patient exists
"RTN","RORHL01",80,0)
 S RORDFN=+$G(RORDFN)
"RTN","RORHL01",81,0)
 I '$D(^DPT(RORDFN,0))  D  Q RC
"RTN","RORHL01",82,0)
 . S RC=$$ERROR^RORERR(-36,,,RORDFN,2)
"RTN","RORHL01",83,0)
 ;
"RTN","RORHL01",84,0)
 S RORFLDS="1,2,3,4" ; Default HL7 fields
"RTN","RORHL01",85,0)
 ;
"RTN","RORHL01",86,0)
 ;--- Call Standard ZSP Segment Builder
"RTN","RORHL01",87,0)
 S RORSEG=$$EN^VAFHLZSP(RORDFN)
"RTN","RORHL01",88,0)
 ;
"RTN","RORHL01",89,0)
 ;--- Store the segment
"RTN","RORHL01",90,0)
 D ADDSEG^RORHL7(.RORSEG,"C")
"RTN","RORHL01",91,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORHL01",92,0)
 ;
"RTN","RORHL01",93,0)
 ;***** ZRD SEGMENT BUILDER
"RTN","RORHL01",94,0)
 ;
"RTN","RORHL01",95,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL01",96,0)
 ;
"RTN","RORHL01",97,0)
 ; Return Values:
"RTN","RORHL01",98,0)
 ;       <0  Error Code
"RTN","RORHL01",99,0)
 ;        0  Ok
"RTN","RORHL01",100,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL01",101,0)
 ;
"RTN","RORHL01",102,0)
ZRD(RORDFN) ;
"RTN","RORHL01",103,0)
 N I,RC,RORFLDS,RORSEG
"RTN","RORHL01",104,0)
 S RC=0
"RTN","RORHL01",105,0)
 ;
"RTN","RORHL01",106,0)
 ;--- Check if the patient exists
"RTN","RORHL01",107,0)
 S RORDFN=+$G(RORDFN)
"RTN","RORHL01",108,0)
 I '$D(^DPT(RORDFN,0))  D  Q RC
"RTN","RORHL01",109,0)
 . S RC=$$ERROR^RORERR(-36,,,RORDFN,2)
"RTN","RORHL01",110,0)
 ;
"RTN","RORHL01",111,0)
 S RORFLDS="1,2,3,4" ; Default HL7 fields
"RTN","RORHL01",112,0)
 ;
"RTN","RORHL01",113,0)
 ;--- Call Standard ZRD Segment Builder
"RTN","RORHL01",114,0)
 D EN^VAFHLZRD(RORDFN,RORFLDS,,HLFS,"RORSEG")
"RTN","RORHL01",115,0)
 ;
"RTN","RORHL01",116,0)
 ;--- Store the segment(s)
"RTN","RORHL01",117,0)
 S I=""
"RTN","RORHL01",118,0)
 F  S I=$O(RORSEG(I))  Q:I=""  Q:$P($G(RORSEG(I,0)),HLFS,3)=""  D
"RTN","RORHL01",119,0)
 . D ADDSEG^RORHL7(RORSEG(I,0),"C")
"RTN","RORHL01",120,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORHL02")
0^50^B29938860
"RTN","RORHL02",1,0)
RORHL02 ;HOIFO/CRT,SG - HL7 REGISTRY DATA: CSP,CSR,CSS ; 12/6/05 2:36pm
"RTN","RORHL02",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL02",3,0)
 ;
"RTN","RORHL02",4,0)
 Q
"RTN","RORHL02",5,0)
 ;
"RTN","RORHL02",6,0)
 ;***** CSP SEGMENTS BUILDER
"RTN","RORHL02",7,0)
 ;
"RTN","RORHL02",8,0)
 ; RORIENS       IENS of Patient Record in Registry File
"RTN","RORHL02",9,0)
 ;
"RTN","RORHL02",10,0)
 ; DXDTS         Main time frame for data extraction in
"RTN","RORHL02",11,0)
 ;               StartDate^EndDate format
"RTN","RORHL02",12,0)
 ;
"RTN","RORHL02",13,0)
 ; Return Values:
"RTN","RORHL02",14,0)
 ;       <0  Error Code
"RTN","RORHL02",15,0)
 ;        0  Ok
"RTN","RORHL02",16,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL02",17,0)
 ;
"RTN","RORHL02",18,0)
CSP(RORIENS,DXDTS) ;
"RTN","RORHL02",19,0)
 N CS,ERRCNT,FLDS,RC,RORMSG,ROROUT,STATUS,TMP
"RTN","RORHL02",20,0)
 S (ERRCNT,RC)=0
"RTN","RORHL02",21,0)
 ;--- Check the parameters
"RTN","RORHL02",22,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL02",23,0)
 ;
"RTN","RORHL02",24,0)
 S FLDS="1;2;3;3.2;6"
"RTN","RORHL02",25,0)
 D GETS^DIQ(798,RORIENS,FLDS,"IE","ROROUT","RORMSG")
"RTN","RORHL02",26,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798,RORIENS)
"RTN","RORHL02",27,0)
 I $$ICRDEF^RORHIVUT(+RORIENS)  D  Q:RC<0 RC
"RTN","RORHL02",28,0)
 . D GETS^DIQ(799.4,RORIENS,"9.01","IE","ROROUT","RORMSG")
"RTN","RORHL02",29,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,799.4,RORIENS)
"RTN","RORHL02",30,0)
 ;
"RTN","RORHL02",31,0)
 S STATUS=+$G(ROROUT(798,RORIENS,3,"I"))
"RTN","RORHL02",32,0)
 ;--- UPDATE
"RTN","RORHL02",33,0)
 I $G(DXDTS)>0  D  Q:RC<0 RC
"RTN","RORHL02",34,0)
 . S RC=$$CSPSEG(0,$P(DXDTS,U),$P(DXDTS,U,2))
"RTN","RORHL02",35,0)
 ;--- SELECT
"RTN","RORHL02",36,0)
 S RC=$$CSPSEG(1,$G(ROROUT(798,RORIENS,3.2,"I")))  Q:RC<0 RC
"RTN","RORHL02",37,0)
 ;--- ADD
"RTN","RORHL02",38,0)
 S RC=$$CSPSEG(2,$G(ROROUT(798,RORIENS,1,"I")))  Q:RC<0 RC
"RTN","RORHL02",39,0)
 ;--- CONFIRM
"RTN","RORHL02",40,0)
 I $G(ROROUT(798,RORIENS,2,"I"))>0  D  Q:RC<0 RC
"RTN","RORHL02",41,0)
 . S RC=$$CSPSEG(3,ROROUT(798,RORIENS,2,"I"))
"RTN","RORHL02",42,0)
 ;--- DELETE
"RTN","RORHL02",43,0)
 I STATUS=5  D  Q:RC<0 RC
"RTN","RORHL02",44,0)
 . S RC=$$CSPSEG(4,$G(ROROUT(798,RORIENS,6,"I")))
"RTN","RORHL02",45,0)
 ;--- CDC
"RTN","RORHL02",46,0)
 I $G(ROROUT(799.4,RORIENS,9.01,"I"))>0  D  Q:RC<0 RC
"RTN","RORHL02",47,0)
 . S RC=$$CSPSEG(5,ROROUT(799.4,RORIENS,9.01,"I"))
"RTN","RORHL02",48,0)
 ;---
"RTN","RORHL02",49,0)
 Q ERRCNT
"RTN","RORHL02",50,0)
 ;
"RTN","RORHL02",51,0)
 ;***** LOW-LEVEL CSP BUILDER
"RTN","RORHL02",52,0)
 ;
"RTN","RORHL02",53,0)
 ; RGEVC         Registry event code
"RTN","RORHL02",54,0)
 ; DATE          Event date (FileMan)
"RTN","RORHL02",55,0)
 ; [ENDT]        End date (FileMan)
"RTN","RORHL02",56,0)
 ;
"RTN","RORHL02",57,0)
 ; Return Values:
"RTN","RORHL02",58,0)
 ;       <0  Error Code
"RTN","RORHL02",59,0)
 ;        0  Ok
"RTN","RORHL02",60,0)
 ;
"RTN","RORHL02",61,0)
CSPSEG(RGEVC,DATE,ENDT,CSP4) ;
"RTN","RORHL02",62,0)
 ;;UPDATE^SELECT^ADD^CONFIRM^DELETE^CDC^MERGE
"RTN","RORHL02",63,0)
 N CS,RORSEG,TMP
"RTN","RORHL02",64,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL02",65,0)
 ;
"RTN","RORHL02",66,0)
 ;--- Initialize the segment
"RTN","RORHL02",67,0)
 S RORSEG(0)="CSP"
"RTN","RORHL02",68,0)
 ;
"RTN","RORHL02",69,0)
 ;--- CSP-1
"RTN","RORHL02",70,0)
 S TMP=$S(RGEVC'<0:$P($P($T(CSPSEG+1),";;",2),U,RGEVC+1),1:"")
"RTN","RORHL02",71,0)
 Q:TMP="" $$ERROR^RORERR(-88,,,,"RGEVC",RGEVC)
"RTN","RORHL02",72,0)
 S RORSEG(1)=RGEVC_CS_TMP
"RTN","RORHL02",73,0)
 ;
"RTN","RORHL02",74,0)
 ;--- CSP-2
"RTN","RORHL02",75,0)
 S RORSEG(2)=$$FM2HL^RORHL7(DATE)
"RTN","RORHL02",76,0)
 ;
"RTN","RORHL02",77,0)
 ;--- CSP-3
"RTN","RORHL02",78,0)
 S:$G(ENDT)>0 RORSEG(3)=$$FM2HL^RORHL7(ENDT)
"RTN","RORHL02",79,0)
 ;
"RTN","RORHL02",80,0)
 ;--- CSP-4
"RTN","RORHL02",81,0)
 S:$G(CSP4)'?." " RORSEG(4)=CSP4
"RTN","RORHL02",82,0)
 ;
"RTN","RORHL02",83,0)
 ;--- Store the segment
"RTN","RORHL02",84,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL02",85,0)
 Q 0
"RTN","RORHL02",86,0)
 ;
"RTN","RORHL02",87,0)
 ;***** CSR SEGMENT BUILDER
"RTN","RORHL02",88,0)
 ;
"RTN","RORHL02",89,0)
 ; [RORIENS]     IENS of Patient Record in Registry File. Either this
"RTN","RORHL02",90,0)
 ;               parameter or the PTIEN must have a valid value.
"RTN","RORHL02",91,0)
 ;
"RTN","RORHL02",92,0)
 ; [PTIEN]       Patient IEN (DFN). If no value is provided for this
"RTN","RORHL02",93,0)
 ;               parameter, then the function uses the value of the
"RTN","RORHL02",94,0)
 ;               .01 field of the patient's registry record.
"RTN","RORHL02",95,0)
 ;
"RTN","RORHL02",96,0)
 ; [RORFLDS]     Segment Fields to populate
"RTN","RORHL02",97,0)
 ;               (1,3,4,6,9,10,12 available)
"RTN","RORHL02",98,0)
 ;
"RTN","RORHL02",99,0)
 ; Return Values:
"RTN","RORHL02",100,0)
 ;       <0  Error Code
"RTN","RORHL02",101,0)
 ;        0  Ok
"RTN","RORHL02",102,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL02",103,0)
 ;
"RTN","RORHL02",104,0)
CSR(RORIENS,PTIEN,RORFLDS) ;
"RTN","RORHL02",105,0)
 N BUF,CS,ERRCNT,HIVIENS,RC,RORMSG,ROROUT,RORSEG,RORTXT,RPS,SCS,TMP,VER
"RTN","RORHL02",106,0)
 S (ERRCNT,RC)=0,HIVIENS=""
"RTN","RORHL02",107,0)
 D ECH^RORHL7(.CS,.SCS,.RPS)
"RTN","RORHL02",108,0)
 S PTIEN=+$G(PTIEN)
"RTN","RORHL02",109,0)
 ;
"RTN","RORHL02",110,0)
 I $G(RORIENS)>0  D  Q:RC<0 RC
"RTN","RORHL02",111,0)
 . S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL02",112,0)
 . D GETS^DIQ(798,RORIENS,".01;.02;1","IE","ROROUT","RORMSG")
"RTN","RORHL02",113,0)
 . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,,798,RORIENS)  Q
"RTN","RORHL02",114,0)
 . S:PTIEN'>0 PTIEN=+$G(ROROUT(798,RORIENS,.01,"I"))
"RTN","RORHL02",115,0)
 . S:$D(^RORDATA(799.4,+RORIENS,0)) HIVIENS=RORIENS
"RTN","RORHL02",116,0)
 E  S RORIENS=""
"RTN","RORHL02",117,0)
 ;
"RTN","RORHL02",118,0)
 I $G(RORFLDS)'=""  D
"RTN","RORHL02",119,0)
 . S:$E(RORFLDS)'="," RORFLDS=","_RORFLDS
"RTN","RORHL02",120,0)
 . S:$E(RORFLDS,$L(RORFLDS))'="," RORFLDS=RORFLDS_","
"RTN","RORHL02",121,0)
 E  S RORFLDS=",1,3,4,6,9,10,12," ; Default HL7 fields
"RTN","RORHL02",122,0)
 ;
"RTN","RORHL02",123,0)
 ;--- Initialize the segment
"RTN","RORHL02",124,0)
 S RORSEG(0)="CSR"
"RTN","RORHL02",125,0)
 ;
"RTN","RORHL02",126,0)
 ;--- CSR-1 - Name of the registry and version of the CCR
"RTN","RORHL02",127,0)
 I RORFLDS[",1,"  D
"RTN","RORHL02",128,0)
 . S VER=+$P(ROREXT("VERSION"),U)              ; Version
"RTN","RORHL02",129,0)
 . S:$P(VER,".",2)="" $P(VER,".",2)="0"
"RTN","RORHL02",130,0)
 . S $P(VER,".",3)=+$P(ROREXT("VERSION"),U,2)  ; Patch Number
"RTN","RORHL02",131,0)
 . S $P(VER,".",4)=+$$BUILD^ROR                ; Build Number
"RTN","RORHL02",132,0)
 . S TMP=$S(RORIENS'="":$G(ROROUT(798,RORIENS,.02,"E")),1:"")
"RTN","RORHL02",133,0)
 . S RORSEG(1)=$S(TMP'="":TMP,1:"CCR")_CS_VER
"RTN","RORHL02",134,0)
 ;
"RTN","RORHL02",135,0)
 ;--- CSR-3 - Institution
"RTN","RORHL02",136,0)
 I RORFLDS[",3,"  D
"RTN","RORHL02",137,0)
 . S RORSEG(3)=$$SITE^RORUTL03(CS)
"RTN","RORHL02",138,0)
 ;
"RTN","RORHL02",139,0)
 ;--- CSR-4 - Patient ID
"RTN","RORHL02",140,0)
 I RORFLDS[",4,"  D
"RTN","RORHL02",141,0)
 . S RORSEG(4)=PTIEN_CS_CS_CS_"USVHA"_CS_"PI"
"RTN","RORHL02",142,0)
 ;
"RTN","RORHL02",143,0)
 ;--- CSR-6 - Date when added to the registry
"RTN","RORHL02",144,0)
 I RORFLDS[",6,",RORIENS'=""  D  Q:RC<0 RC
"RTN","RORHL02",145,0)
 . S TMP=$$FMTHL7^XLFDT($G(ROROUT(798,RORIENS,1,"I"))\1)
"RTN","RORHL02",146,0)
 . I TMP'>0  S RC=$$ERROR^RORERR(-95,,,,798,RORIENS,1)  Q
"RTN","RORHL02",147,0)
 . S RORSEG(6)=TMP
"RTN","RORHL02",148,0)
 ;
"RTN","RORHL02",149,0)
 ;--- CSR-9 - Date of Clinical AIDS (HIV)
"RTN","RORHL02",150,0)
 I RORFLDS[",9,",HIVIENS'=""  D  Q:RC<0 RC
"RTN","RORHL02",151,0)
 . D GETS^DIQ(799.4,HIVIENS,".02;.03","I","ROROUT","RORMSG")
"RTN","RORHL02",152,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL02",153,0)
 . . D DBS^RORERR("RORMSG",-9,,,799.4,HIVIENS)
"RTN","RORHL02",154,0)
 . I '$G(ROROUT(799.4,HIVIENS,.02,"I"))  S TMP=""
"RTN","RORHL02",155,0)
 . E  S TMP=$G(ROROUT(799.4,HIVIENS,.03,"I"))
"RTN","RORHL02",156,0)
 . S RORSEG(9)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL02",157,0)
 ;
"RTN","RORHL02",158,0)
 ;--- CSR-10 - Reason for addition of the patient to the registry
"RTN","RORHL02",159,0)
 I RORFLDS[",10,",RORIENS'=""  D  Q:RC<0 RC
"RTN","RORHL02",160,0)
 . S RORSEG(10)=$$ADREASON^RORHLUT1(RORIENS,CS)
"RTN","RORHL02",161,0)
 ;
"RTN","RORHL02",162,0)
 ;--- CSR-12 - Risk factors
"RTN","RORHL02",163,0)
 I RORFLDS[",12,",HIVIENS'=""  D  Q:RC<0 RC
"RTN","RORHL02",164,0)
 . N CNT,EV,FLD,RFLST,RORBUF,RORQUIT,RORRISK
"RTN","RORHL02",165,0)
 . S RFLST="14.01;14.02;14.03;14.04;14.07;14.08;14.09;14.1;14.11;14.12;14.13;14.16;14.17"
"RTN","RORHL02",166,0)
 . D GETS^DIQ(799.4,HIVIENS,RFLST,"I","RORBUF","RORMSG")
"RTN","RORHL02",167,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL02",168,0)
 . . D DBS^RORERR("RORMSG",-9,,,799.4,HIVIENS)
"RTN","RORHL02",169,0)
 . ;---
"RTN","RORHL02",170,0)
 . S RORRISK="",RORQUIT=0
"RTN","RORHL02",171,0)
 . F CNT=1:1  S FLD=$P(RFLST,";",CNT)  Q:FLD=""  D:FLD>0  Q:RORQUIT
"RTN","RORHL02",172,0)
 . . S TMP=$G(RORBUF(799.4,HIVIENS,FLD,"I"))
"RTN","RORHL02",173,0)
 . . S EV=$S(TMP=0:"NO",TMP=1:"YES",TMP=9:"UNKNOWN",1:"")
"RTN","RORHL02",174,0)
 . . I EV=""  S RORRISK="",RORQUIT=1  Q
"RTN","RORHL02",175,0)
 . . S $P(RORRISK,RPS,CNT)=TMP_CS_EV
"RTN","RORHL02",176,0)
 . S RORSEG(12)=RORRISK
"RTN","RORHL02",177,0)
 ;
"RTN","RORHL02",178,0)
 ;--- Store the segment
"RTN","RORHL02",179,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL02",180,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL03")
0^51^B34671095
"RTN","RORHL03",1,0)
RORHL03 ;HOIFO/CRT - HL7 PHARMACY: ORC,RXE ; 8/26/05 2:06pm
"RTN","RORHL03",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL03",3,0)
 ;
"RTN","RORHL03",4,0)
 ; Routine's RORHL03* use the following IAs:
"RTN","RORHL03",5,0)
 ;
"RTN","RORHL03",6,0)
 ; #93-A         Get stop code from the file #44 (controlled)
"RTN","RORHL03",7,0)
 ; #2400         OCL^PSOORRL and OEL^PSOORRL (controlled)
"RTN","RORHL03",8,0)
 ; #10060        Read access to file #200 (supported)
"RTN","RORHL03",9,0)
 ; #10090        Read access to file #4 (supported)
"RTN","RORHL03",10,0)
 ;
"RTN","RORHL03",11,0)
 ; #1977         Read access to file #52
"RTN","RORHL03",12,0)
 ; #1876         Read access to file #59
"RTN","RORHL03",13,0)
 ; #2497         Read access to file #55
"RTN","RORHL03",14,0)
 ;
"RTN","RORHL03",15,0)
 Q
"RTN","RORHL03",16,0)
 ;
"RTN","RORHL03",17,0)
 ;***** PHARMACY DATA SEGMENT BUILDER
"RTN","RORHL03",18,0)
 ;
"RTN","RORHL03",19,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL03",20,0)
 ;
"RTN","RORHL03",21,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL03",22,0)
 ;               data extraction time frames are stored.
"RTN","RORHL03",23,0)
 ;
"RTN","RORHL03",24,0)
 ; Return Values:
"RTN","RORHL03",25,0)
 ;       <0  Error Code
"RTN","RORHL03",26,0)
 ;        0  Ok
"RTN","RORHL03",27,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL03",28,0)
 ;
"RTN","RORHL03",29,0)
EN1(RORDFN,DXDTS) ;
"RTN","RORHL03",30,0)
 N ENDT,ERRCNT,IDX,RC,STDT
"RTN","RORHL03",31,0)
 S (ERRCNT,RC)=0
"RTN","RORHL03",32,0)
 ;---
"RTN","RORHL03",33,0)
 S IDX=0
"RTN","RORHL03",34,0)
 F  S IDX=$O(DXDTS(6,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL03",35,0)
 . S STDT=$P(DXDTS(6,IDX),U),ENDT=$P(DXDTS(6,IDX),U,2)
"RTN","RORHL03",36,0)
 . S TMP=$$EN2(RORDFN,STDT,ENDT)
"RTN","RORHL03",37,0)
 . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL03",38,0)
 ;---
"RTN","RORHL03",39,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL03",40,0)
 ;
"RTN","RORHL03",41,0)
 ;***** PHARMACY DATA SEGMENT BUILDER
"RTN","RORHL03",42,0)
 ;
"RTN","RORHL03",43,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL03",44,0)
 ;
"RTN","RORHL03",45,0)
 ; RORSTDT       Start Date/Time (Fileman)
"RTN","RORHL03",46,0)
 ; RORENDT       End Date/Time (Fileman)
"RTN","RORHL03",47,0)
 ;
"RTN","RORHL03",48,0)
 ; Return Values:
"RTN","RORHL03",49,0)
 ;       <0  Error Code
"RTN","RORHL03",50,0)
 ;        0  Ok
"RTN","RORHL03",51,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL03",52,0)
 ;
"RTN","RORHL03",53,0)
 ; The ^TMP("PS",$J) global node is used by this function.
"RTN","RORHL03",54,0)
 ;
"RTN","RORHL03",55,0)
EN2(RORDFN,RORSTDT,RORENDT) ;
"RTN","RORHL03",56,0)
 N ERRCNT,IEN,IENS,II,RC,RORII,RORINC,RORINDEX,RORMSG,RORORD,RORRXE,RORTMP,RORXII,TMP
"RTN","RORHL03",57,0)
 S (ERRCNT,RC)=0
"RTN","RORHL03",58,0)
 ;
"RTN","RORHL03",59,0)
 ;--- Load the list of prescriptions
"RTN","RORHL03",60,0)
 K ^TMP("PS",$J)
"RTN","RORHL03",61,0)
 D OCL^PSOORRL(RORDFN,RORSTDT,RORENDT)
"RTN","RORHL03",62,0)
 Q:$D(^TMP("PS",$J))<10 0
"RTN","RORHL03",63,0)
 ;
"RTN","RORHL03",64,0)
 ;--- Select the prescriptions
"RTN","RORHL03",65,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORHL03",66,0)
 S RORII=0
"RTN","RORHL03",67,0)
 F  S RORII=$O(^TMP("PS",$J,RORII))  Q:'RORII  D
"RTN","RORHL03",68,0)
 . S RORORD=$P(^TMP("PS",$J,RORII,0),U)
"RTN","RORHL03",69,0)
 . Q:RORORD'>0
"RTN","RORHL03",70,0)
 . S II=$P(RORORD,";"),II=$E(II,$L(II))
"RTN","RORHL03",71,0)
 . Q:'("RUV"[II)
"RTN","RORHL03",72,0)
 . ;---
"RTN","RORHL03",73,0)
 . I "UV"[II   D  Q:(TMP<RORSTDT)!(TMP'<RORENDT)
"RTN","RORHL03",74,0)
 . . S TMP=$P($G(^TMP("PS",$J,RORII,0)),U,15)
"RTN","RORHL03",75,0)
 . I II="R"  D  Q:TMP<RORSTDT
"RTN","RORHL03",76,0)
 . . S TMP=$P($G(^TMP("PS",$J,RORII,0)),U,10)
"RTN","RORHL03",77,0)
 . ;---
"RTN","RORHL03",78,0)
 . S @RORTMP@(RORII,0)=^TMP("PS",$J,RORII,0)
"RTN","RORHL03",79,0)
 K ^TMP("PS",$J)
"RTN","RORHL03",80,0)
 ;
"RTN","RORHL03",81,0)
 ;--- Browse through the list and generate the HL7 segments
"RTN","RORHL03",82,0)
 S RORII=0
"RTN","RORHL03",83,0)
 F  S RORII=$O(@RORTMP@(RORII))  Q:'RORII  D  Q:RC<0
"RTN","RORHL03",84,0)
 . S RORORD=$P(@RORTMP@(RORII,0),U)
"RTN","RORHL03",85,0)
 . S RORXII=$P(RORORD,";"),RORXII=$E(RORXII,$L(RORXII))
"RTN","RORHL03",86,0)
 . ;
"RTN","RORHL03",87,0)
 . K ^TMP("PS",$J),RORRXE
"RTN","RORHL03",88,0)
 . D OEL^PSOORRL(RORDFN,RORORD)
"RTN","RORHL03",89,0)
 . Q:$D(^TMP("PS",$J))<10
"RTN","RORHL03",90,0)
 . M RORRXE=^TMP("PS",$J)
"RTN","RORHL03",91,0)
 . K ^TMP("PS",$J)
"RTN","RORHL03",92,0)
 . ;
"RTN","RORHL03",93,0)
 . I RORXII="R" D                ;--- Outpatient Pharmacy
"RTN","RORHL03",94,0)
 . . D REFILL
"RTN","RORHL03",95,0)
 . . ;--- Check if the original prescription or one of
"RTN","RORHL03",96,0)
 . . ;--- the refills is within date range
"RTN","RORHL03",97,0)
 . . S RORINC=0
"RTN","RORHL03",98,0)
 . . F RORINDEX="REF","PAR" D
"RTN","RORHL03",99,0)
 . . . S II=""
"RTN","RORHL03",100,0)
 . . . F  S II=$O(RORRXE(RORINDEX,II))  Q:II=""  D
"RTN","RORHL03",101,0)
 . . . . S TMP=$P($G(RORRXE(RORINDEX,II,0)),U)
"RTN","RORHL03",102,0)
 . . . . I TMP'<RORSTDT,TMP<RORENDT  S RORINC=1  Q
"RTN","RORHL03",103,0)
 . . . . K RORRXE(RORINDEX,II,0)
"RTN","RORHL03",104,0)
 . . Q:'RORINC
"RTN","RORHL03",105,0)
 . . ;---
"RTN","RORHL03",106,0)
 . . S IEN=+$P(RORORD,";")
"RTN","RORHL03",107,0)
 . . S TMP=$$ORC(IEN,.RORRXE)
"RTN","RORHL03",108,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL03",109,0)
 . . S TMP=$$RXE^RORHL031(IEN,.RORRXE)
"RTN","RORHL03",110,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL03",111,0)
 . . ;
"RTN","RORHL03",112,0)
 . I RORXII="U" D                ;--- Unit Dose Inpatient Pharmacy
"RTN","RORHL03",113,0)
 . . S IENS=+$P(RORORD,";")_","_RORDFN_","
"RTN","RORHL03",114,0)
 . . S TMP=$$ORC^RORHL07(IENS,.RORRXE)
"RTN","RORHL03",115,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL03",116,0)
 . . S TMP=$$RXE^RORHL07(IENS,.RORRXE)
"RTN","RORHL03",117,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL03",118,0)
 . . ;
"RTN","RORHL03",119,0)
 . I RORXII="V" D                ;--- IV Inpatient Pharmacy
"RTN","RORHL03",120,0)
 . . S IENS=+$P(RORORD,";")_","_RORDFN_","
"RTN","RORHL03",121,0)
 . . S TMP=$$ORC^RORHL071(IENS,.RORRXE)
"RTN","RORHL03",122,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL03",123,0)
 . . S TMP=$$RXE^RORHL071(IENS,.RORRXE)
"RTN","RORHL03",124,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL03",125,0)
 ;
"RTN","RORHL03",126,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORHL03",127,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL03",128,0)
 ;
"RTN","RORHL03",129,0)
 ;***** OUTPATIENT PHARMACY ORC SEGMENT BUILDER
"RTN","RORHL03",130,0)
 ;
"RTN","RORHL03",131,0)
 ; RORIEN        IEN of Record in PrescPN. File #52
"RTN","RORHL03",132,0)
 ;
"RTN","RORHL03",133,0)
 ; .RORORC       Array with info (from OEL^PSOORRL)
"RTN","RORHL03",134,0)
 ;
"RTN","RORHL03",135,0)
 ; Return Values:
"RTN","RORHL03",136,0)
 ;       <0  Error Code
"RTN","RORHL03",137,0)
 ;        0  Ok
"RTN","RORHL03",138,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL03",139,0)
 ;
"RTN","RORHL03",140,0)
ORC(RORIEN,RORORC) ;
"RTN","RORHL03",141,0)
 N BUF,CS,ERRCNT,IEN,IENS59,RC,RORMSG,ROROUT,RORSEG,TMP
"RTN","RORHL03",142,0)
 S (ERRCNT,RC)=0
"RTN","RORHL03",143,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL03",144,0)
 ;
"RTN","RORHL03",145,0)
 ;--- Initialize the segment
"RTN","RORHL03",146,0)
 S RORSEG(0)="ORC"
"RTN","RORHL03",147,0)
 ;
"RTN","RORHL03",148,0)
 ;--- ORC-1 - Order Control 
"RTN","RORHL03",149,0)
 S RORSEG(1)="NW"
"RTN","RORHL03",150,0)
 ;
"RTN","RORHL03",151,0)
 ;--- ORC-2 - Placer Order #
"RTN","RORHL03",152,0)
 S RORSEG(2)=+RORIEN_CS_"OP"
"RTN","RORHL03",153,0)
 ;
"RTN","RORHL03",154,0)
 ;--- ORC-9 - Release Date/Time
"RTN","RORHL03",155,0)
 S TMP=$P($G(RORORC("RXN",0)),U,7)
"RTN","RORHL03",156,0)
 S RORSEG(9)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL03",157,0)
 ;
"RTN","RORHL03",158,0)
 ;--- ORC-12 - Provider
"RTN","RORHL03",159,0)
 S BUF=+$P($G(RORORC("P",0)),U)
"RTN","RORHL03",160,0)
 I BUF>0  D
"RTN","RORHL03",161,0)
 . S $P(BUF,CS,13)=$$GET1^DIQ(200,+BUF_",",53.5,"E",,"RORMSG")
"RTN","RORHL03",162,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL03",163,0)
 . . D DBS^RORERR("RORMSG",-99,,,200,+BUF_",")
"RTN","RORHL03",164,0)
 . S RORSEG(12)=BUF
"RTN","RORHL03",165,0)
 ;
"RTN","RORHL03",166,0)
 ;--- ORC-15 - Order Date/Time
"RTN","RORHL03",167,0)
 S TMP=$$FMTHL7^XLFDT($P($G(RORORC(0)),U,5))
"RTN","RORHL03",168,0)
 Q:TMP'>0 $$ERROR^RORERR(-100,,,,"No order date","OEL^PSOORRL")
"RTN","RORHL03",169,0)
 S RORSEG(15)=TMP
"RTN","RORHL03",170,0)
 ;
"RTN","RORHL03",171,0)
 ;--- ORC-16 - Control Code Reason
"RTN","RORHL03",172,0)
 S RORSEG(16)=CS_CS_CS_CS_"NEW"
"RTN","RORHL03",173,0)
 ;
"RTN","RORHL03",174,0)
 ;--- ORC-17 - Division
"RTN","RORHL03",175,0)
 S RORSEG(17)=$$SITE^RORUTL03(CS)
"RTN","RORHL03",176,0)
 S IENS59=+$$GET1^DIQ(52,+RORIEN,20,"I",,"RORMSG")_","
"RTN","RORHL03",177,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL03",178,0)
 . D DBS^RORERR("RORMSG",-99,,,52,+RORIEN)
"RTN","RORHL03",179,0)
 I IENS59>0  D
"RTN","RORHL03",180,0)
 . D GETS^DIQ(59,IENS59,"100","IE","ROROUT","RORMSG")
"RTN","RORHL03",181,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL03",182,0)
 . . D DBS^RORERR("RORMSG",-99,,,59,IENS59)
"RTN","RORHL03",183,0)
 . S IEN=+$G(ROROUT(59,IENS59,100,"I"))
"RTN","RORHL03",184,0)
 . Q:IEN'>0
"RTN","RORHL03",185,0)
 . ;---
"RTN","RORHL03",186,0)
 . S BUF=$$GET1^DIQ(4,IEN_",",99,"I",,"RORMSG")
"RTN","RORHL03",187,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL03",188,0)
 . . D DBS^RORERR("RORMSG",-99,,,4,IEN_",")
"RTN","RORHL03",189,0)
 . Q:BUF=""
"RTN","RORHL03",190,0)
 . S $P(BUF,CS,2)=$$ESCAPE^RORHL7($G(ROROUT(59,IENS59,100,"E")))
"RTN","RORHL03",191,0)
 . S $P(BUF,CS,3)="99VA4"
"RTN","RORHL03",192,0)
 . S RORSEG(17)=BUF
"RTN","RORHL03",193,0)
 ;
"RTN","RORHL03",194,0)
 ;--- Store the segment
"RTN","RORHL03",195,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL03",196,0)
 Q ERRCNT
"RTN","RORHL03",197,0)
 ;
"RTN","RORHL03",198,0)
 ;***** MAKES ORIGINAL FILL LIKE REFILLS TO REUSE CODE
"RTN","RORHL03",199,0)
REFILL ;
"RTN","RORHL03",200,0)
 S RORRXE("REF",0,0)=""
"RTN","RORHL03",201,0)
 S $P(RORRXE("REF",0,0),U,1)=$P(RORRXE("RXN",0),U,6)
"RTN","RORHL03",202,0)
 S $P(RORRXE("REF",0,0),U,2)=$P(RORRXE(0),U,7)
"RTN","RORHL03",203,0)
 S $P(RORRXE("REF",0,0),U,3)=$P(RORRXE(0),U,8)
"RTN","RORHL03",204,0)
 S $P(RORRXE("REF",0,0),U,4)=$P(RORRXE("RXN",0),U,7)
"RTN","RORHL03",205,0)
 S $P(RORRXE("REF",0,0),U,5)=$P(RORRXE("RXN",0),U,3)
"RTN","RORHL03",206,0)
 Q
"RTN","RORHL031")
0^52^B37995805
"RTN","RORHL031",1,0)
RORHL031 ;HOIFO/BH - HL7 PHARMACY: UTILITIES ; 8/26/05 2:39pm
"RTN","RORHL031",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL031",3,0)
 ;
"RTN","RORHL031",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL031",5,0)
 ;
"RTN","RORHL031",6,0)
 ; #1878         EN^PSOORDER
"RTN","RORHL031",7,0)
 ; #1977         Read access to file #52
"RTN","RORHL031",8,0)
 ; #4533         ARWS^PSS50 (supported)
"RTN","RORHL031",9,0)
 ; #4545         DATA^PSN50P68 (supported)
"RTN","RORHL031",10,0)
 ;
"RTN","RORHL031",11,0)
 Q
"RTN","RORHL031",12,0)
 ;
"RTN","RORHL031",13,0)
 ;***** OUTPATIENT PHARMACY RXE SEGMENT BUILDER
"RTN","RORHL031",14,0)
 ;
"RTN","RORHL031",15,0)
 ; RORIEN        IEN in the PRESCRIPTION file (#52)
"RTN","RORHL031",16,0)
 ;
"RTN","RORHL031",17,0)
 ; .RORRXE       Array with info (from OEL^PSOORRL)
"RTN","RORHL031",18,0)
 ;
"RTN","RORHL031",19,0)
 ; The ^TMP("PSOR",$J) global node is used by this function.
"RTN","RORHL031",20,0)
 ;
"RTN","RORHL031",21,0)
 ; Return Values:
"RTN","RORHL031",22,0)
 ;       <0  Error Code
"RTN","RORHL031",23,0)
 ;        0  Ok
"RTN","RORHL031",24,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL031",25,0)
 ;
"RTN","RORHL031",26,0)
RXE(RORIEN,RORRXE) ;
"RTN","RORHL031",27,0)
 N BUF,CS,ERRCNT,IDGN,II,INDF,J,L,RC,RORCMOP,RORMSG,RORTEST,RORMREF,RORCLIN,RORPRICE,RORSEG,RORSTOP,RORLST,RORSTAT,RORISIG,TMP
"RTN","RORHL031",28,0)
 S (ERRCNT,RC)=0
"RTN","RORHL031",29,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL031",30,0)
 ;
"RTN","RORHL031",31,0)
 Q:$P($G(RORRXE(0)),U)="" 0
"RTN","RORHL031",32,0)
 ;
"RTN","RORHL031",33,0)
 K ^TMP("PSOR",$J)
"RTN","RORHL031",34,0)
 D EN^PSOORDER(,RORIEN)
"RTN","RORHL031",35,0)
 ;
"RTN","RORHL031",36,0)
 S BUF=$G(^TMP("PSOR",$J,RORIEN,0))
"RTN","RORHL031",37,0)
 S RORMREF=$P(BUF,U,8)            ; # of refills
"RTN","RORHL031",38,0)
 S RORPRICE=$P(BUF,U,10)          ; unit price of drugs
"RTN","RORHL031",39,0)
 ;
"RTN","RORHL031",40,0)
 S BUF=$G(^TMP("PSOR",$J,RORIEN,1))
"RTN","RORHL031",41,0)
 S RORSTAT=$P($P(BUF,U,5),";",1)  ; patient status (internal)
"RTN","RORHL031",42,0)
 S RORSTDE=$P($P(BUF,U,5),";",2)  ; patient status
"RTN","RORHL031",43,0)
 S RORCLIN=+$P(BUF,U,4)           ; clinic
"RTN","RORHL031",44,0)
 ;
"RTN","RORHL031",45,0)
 S (J,RORISIG)="",L=245
"RTN","RORHL031",46,0)
 F  S J=$O(^TMP("PSOR",$J,RORIEN,"SIG1",J))  Q:J=""  D  Q:L'>0
"RTN","RORHL031",47,0)
 . S BUF=$G(^TMP("PSOR",$J,RORIEN,"SIG1",J,0))
"RTN","RORHL031",48,0)
 . S RORISIG=RORISIG_" "_$E(BUF,1,L)
"RTN","RORHL031",49,0)
 . S L=L-$L(BUF)-1  S:L<-1 RORISIG=RORISIG_"..."
"RTN","RORHL031",50,0)
 S RORISIG=$$TRIM^XLFSTR(RORISIG)
"RTN","RORHL031",51,0)
 ;
"RTN","RORHL031",52,0)
 ;--- Get Stop Code
"RTN","RORHL031",53,0)
 S RORSTOP=$$STOPCODE^RORUTL18(+RORCLIN)
"RTN","RORHL031",54,0)
 S:RORSTOP'>0 RORSTOP=""
"RTN","RORHL031",55,0)
 ;
"RTN","RORHL031",56,0)
 ;--- Get last dispensed dates
"RTN","RORHL031",57,0)
 D LIST^DIC(52.1,","_RORIEN_",","@;10.1I",,,,,,,,"RORLST","RORMSG")
"RTN","RORHL031",58,0)
 I $G(DIERR)  D  Q RC
"RTN","RORHL031",59,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,52.1,","_RORIEN_",")
"RTN","RORHL031",60,0)
 S J=0  K RORLST("AIEN")
"RTN","RORHL031",61,0)
 F  S J=$O(RORLST("DILIST",2,J))  Q:J=""  D
"RTN","RORHL031",62,0)
 . S TMP=+RORLST("DILIST",2,J)
"RTN","RORHL031",63,0)
 . S:TMP RORLST("AIEN",TMP,J)=""
"RTN","RORHL031",64,0)
 ;
"RTN","RORHL031",65,0)
 ;--- Load the CMOP list
"RTN","RORHL031",66,0)
 D LIST^DIC(52.01,","_RORIEN_",","@;2;3","I",,,,,,,"RORCMOP","RORMSG")
"RTN","RORHL031",67,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL031",68,0)
 . D DBS^RORERR("RORMSG",-99,,,52.01,","_RORIEN_",")
"RTN","RORHL031",69,0)
 S J=0  K RORCMOP("A2")
"RTN","RORHL031",70,0)
 F  S J=$O(RORCMOP("DILIST","ID",J))  Q:J=""  D
"RTN","RORHL031",71,0)
 . Q:$G(RORCMOP("DILIST","ID",J,3))=3
"RTN","RORHL031",72,0)
 . S TMP=$G(RORCMOP("DILIST","ID",J,2))
"RTN","RORHL031",73,0)
 . S:TMP'="" RORCMOP("A2",TMP,J)=""
"RTN","RORHL031",74,0)
 ;
"RTN","RORHL031",75,0)
 F RORINDEX="REF","PAR" D
"RTN","RORHL031",76,0)
 . S II=""
"RTN","RORHL031",77,0)
 . F  S II=$O(RORRXE(RORINDEX,II))  Q:II=""  D  Q:RC<0
"RTN","RORHL031",78,0)
 . . S RORTEST=$G(RORRXE(RORINDEX,II,0))  Q:RORTEST=""
"RTN","RORHL031",79,0)
 . . ;
"RTN","RORHL031",80,0)
 . . ;--- Initialize the segment
"RTN","RORHL031",81,0)
 . . K RORSEG  S RORSEG(0)="RXE"
"RTN","RORHL031",82,0)
 . . ;
"RTN","RORHL031",83,0)
 . . ;--- RXE-1 - Quantity/Timing
"RTN","RORHL031",84,0)
 . . S RORSEG(1)=""""""
"RTN","RORHL031",85,0)
 . . ;
"RTN","RORHL031",86,0)
 . . ;--- RXE-2 - Give Code
"RTN","RORHL031",87,0)
 . . S IDGN=+$P($G(RORRXE("DD",1,0)),U,3)  ; File #50 IEN
"RTN","RORHL031",88,0)
 . . I IDGN'>0  S IDGN=+$P($G(RORRXE("DD",1,0)),U)  Q:IDGN'>0
"RTN","RORHL031",89,0)
 . . S TMP=$$RXE2(IDGN,CS,.BUF,.INDF)
"RTN","RORHL031",90,0)
 . . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL031",91,0)
 . . Q:BUF=""
"RTN","RORHL031",92,0)
 . . S RORSEG(2)=BUF
"RTN","RORHL031",93,0)
 . . ;
"RTN","RORHL031",94,0)
 . . ;--- RXE-3 - Give Amount (Min)
"RTN","RORHL031",95,0)
 . . S RORSEG(3)=""""""
"RTN","RORHL031",96,0)
 . . ;
"RTN","RORHL031",97,0)
 . . ;--- RXE-4 - Max # of re-fills
"RTN","RORHL031",98,0)
 . . S RORSEG(4)=RORMREF
"RTN","RORHL031",99,0)
 . . ;
"RTN","RORHL031",100,0)
 . . ;--- RXE-5 - Give Units
"RTN","RORHL031",101,0)
 . . S TMP=$$RXE5(+$G(INDF),CS,.BUF)
"RTN","RORHL031",102,0)
 . . S:TMP ERRCNT=ERRCNT+1
"RTN","RORHL031",103,0)
 . . S:BUF'="" RORSEG(5)=BUF
"RTN","RORHL031",104,0)
 . . ;
"RTN","RORHL031",105,0)
 . . ;--- RXE-6 - Release Date/Time
"RTN","RORHL031",106,0)
 . . S TMP=$P($G(RORRXE(RORINDEX,II,0)),U,4)
"RTN","RORHL031",107,0)
 . . S RORSEG(6)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL031",108,0)
 . . ;
"RTN","RORHL031",109,0)
 . . ;--- RXE-7 - SIG1
"RTN","RORHL031",110,0)
 . . S RORSEG(7)=CS_$$ESCAPE^RORHL7(RORISIG)
"RTN","RORHL031",111,0)
 . . ;
"RTN","RORHL031",112,0)
 . . ;--- RXE-10 - Dispense amount
"RTN","RORHL031",113,0)
 . . S RORSEG(10)=$P($G(RORRXE(RORINDEX,II,0)),U,3)
"RTN","RORHL031",114,0)
 . . ;
"RTN","RORHL031",115,0)
 . . ;--- RXE-15 - Refill Indicator
"RTN","RORHL031",116,0)
 . . S RORSEG(15)=$S(RORINDEX="REF":1,RORINDEX="PAR":2)
"RTN","RORHL031",117,0)
 . . ;
"RTN","RORHL031",118,0)
 . . ;--- RXE-17 - Refill #
"RTN","RORHL031",119,0)
 . . S RORSEG(17)=II
"RTN","RORHL031",120,0)
 . . ;
"RTN","RORHL031",121,0)
 . . ;--- RXE-18 - Fill Date/Time
"RTN","RORHL031",122,0)
 . . S TMP=$P($G(RORRXE(RORINDEX,II,0)),U)
"RTN","RORHL031",123,0)
 . . S RORSEG(18)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL031",124,0)
 . . ;
"RTN","RORHL031",125,0)
 . . ;--- RXE-19 - Total Daily Dose
"RTN","RORHL031",126,0)
 . . S RORSEG(19)=$P($G(RORRXE(RORINDEX,II,0)),U,2)
"RTN","RORHL031",127,0)
 . . ;
"RTN","RORHL031",128,0)
 . . ;--- RXE-20 - CMOP
"RTN","RORHL031",129,0)
 . . S RORSEG(20)=$S($D(RORCMOP("A2",II)):"Y",1:"N")
"RTN","RORHL031",130,0)
 . . ;
"RTN","RORHL031",131,0)
 . . ;--- RXE-21 - Clinic Stop
"RTN","RORHL031",132,0)
 . . S RORSEG(21)=RORSTOP
"RTN","RORHL031",133,0)
 . . ;
"RTN","RORHL031",134,0)
 . . ;--- RXE-22 - Dispense Date
"RTN","RORHL031",135,0)
 . . I 'II  D
"RTN","RORHL031",136,0)
 . . . S TMP=$P($G(RORRXE(0)),U,5)
"RTN","RORHL031",137,0)
 . . . S RORSEG(22)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL031",138,0)
 . . E  D
"RTN","RORHL031",139,0)
 . . . S J=$O(RORLST("AIEN",II,""))  Q:J'>0
"RTN","RORHL031",140,0)
 . . . S TMP=$G(RORLST("DILIST","ID",J,10.1))
"RTN","RORHL031",141,0)
 . . . S RORSEG(22)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL031",142,0)
 . . ;
"RTN","RORHL031",143,0)
 . . ;--- RXE-23 - Unit Cost
"RTN","RORHL031",144,0)
 . . S RORSEG(23)=RORPRICE
"RTN","RORHL031",145,0)
 . . ;
"RTN","RORHL031",146,0)
 . . ;--- RXE-27 - Patient Status
"RTN","RORHL031",147,0)
 . . S RORSEG(27)=RORSTAT_CS_RORSTDE
"RTN","RORHL031",148,0)
 . . ;
"RTN","RORHL031",149,0)
 . . ;--- RXE-30 Mail/Window
"RTN","RORHL031",150,0)
 . . S TMP=$P($G(RORRXE(RORINDEX,II,0)),U,5)
"RTN","RORHL031",151,0)
 . . S RORSEG(30)=$S(TMP="M":"AD",TMP="W":"TR",1:"")
"RTN","RORHL031",152,0)
 . . ;
"RTN","RORHL031",153,0)
 . . ;--- Store the segment
"RTN","RORHL031",154,0)
 . . D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL031",155,0)
 ;
"RTN","RORHL031",156,0)
 K ^TMP("PSOR",$J)
"RTN","RORHL031",157,0)
 Q ERRCNT
"RTN","RORHL031",158,0)
 ;
"RTN","RORHL031",159,0)
 ;***** CONSTRUCTS THE RXE-2 FIELD (GIVE CODE)
"RTN","RORHL031",160,0)
 ;
"RTN","RORHL031",161,0)
 ; IEN50         IEN in the DRUG file (#50)
"RTN","RORHL031",162,0)
 ;
"RTN","RORHL031",163,0)
 ; [CS]          Component Separator (defaults to "^")
"RTN","RORHL031",164,0)
 ;
"RTN","RORHL031",165,0)
 ; .RXE2         Reference to a local variable where the value
"RTN","RORHL031",166,0)
 ;               of the  RXE-2 field is returned
"RTN","RORHL031",167,0)
 ;
"RTN","RORHL031",168,0)
 ; [.PSNDF]      VA PRODUCT
"RTN","RORHL031",169,0)
 ;                 ^01: IEN
"RTN","RORHL031",170,0)
 ;                 ^02: NAME (.01)
"RTN","RORHL031",171,0)
 ;
"RTN","RORHL031",172,0)
 ; Return Values:
"RTN","RORHL031",173,0)
 ;       <0  Error Code
"RTN","RORHL031",174,0)
 ;        0  Ok
"RTN","RORHL031",175,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL031",176,0)
 ;
"RTN","RORHL031",177,0)
RXE2(IEN50,CS,RXE2,PSNDF) ;
"RTN","RORHL031",178,0)
 N ERRCNT,IDGN,NODE,RC,RORMSG,TMP,TMP1
"RTN","RORHL031",179,0)
 S (ERRCNT,RC)=0,RXE2=""
"RTN","RORHL031",180,0)
 ;
"RTN","RORHL031",181,0)
 S:$G(CS)="" CS="^"
"RTN","RORHL031",182,0)
 S IDGN=+$G(IEN50)
"RTN","RORHL031",183,0)
 ;
"RTN","RORHL031",184,0)
 S NODE=$$ALLOC^RORTMP(.TMP)
"RTN","RORHL031",185,0)
 D ARWS^PSS50(IDGN,,TMP)
"RTN","RORHL031",186,0)
 ;
"RTN","RORHL031",187,0)
 S $P(RXE2,CS,1)=$G(@NODE@(IDGN,31))        ; NDC
"RTN","RORHL031",188,0)
 ;--- VA Product Name
"RTN","RORHL031",189,0)
 S PSNDF=$G(@NODE@(IDGN,22)),TMP1=$P(PSNDF,U,2)
"RTN","RORHL031",190,0)
 S $P(RXE2,CS,2)=$$ESCAPE^RORHL7($E(TMP1,1,64))
"RTN","RORHL031",191,0)
 S $P(RXE2,CS,3)="PSNDF"
"RTN","RORHL031",192,0)
 ;
"RTN","RORHL031",193,0)
 S TMP=""
"RTN","RORHL031",194,0)
 S $P(TMP,"-",1)=$P($G(@NODE@(IDGN,20)),U)  ; VA Drug Code
"RTN","RORHL031",195,0)
 S $P(TMP,"-",2)=$G(@NODE@(IDGN,2))         ; VA Drug Class
"RTN","RORHL031",196,0)
 S:TMP'="-" $P(RXE2,CS,4)=TMP
"RTN","RORHL031",197,0)
 ;--- Drug Name
"RTN","RORHL031",198,0)
 S $P(RXE2,CS,5)=$$ESCAPE^RORHL7($G(@NODE@(IDGN,.01)))
"RTN","RORHL031",199,0)
 S $P(RXE2,CS,6)="99PSD"
"RTN","RORHL031",200,0)
 ;
"RTN","RORHL031",201,0)
 D FREE^RORTMP(NODE)
"RTN","RORHL031",202,0)
 S:($P(RXE2,CS,1,2)="^")&($P(RXE2,CS,4,5)="^") RXE2=""
"RTN","RORHL031",203,0)
 Q ERRCNT
"RTN","RORHL031",204,0)
 ;
"RTN","RORHL031",205,0)
 ;***** CONSTRUCTS THE RXE-5 FIELD (GIVE UNITS)
"RTN","RORHL031",206,0)
 ;
"RTN","RORHL031",207,0)
 ; IEN50P68      IEN in the VA PRODUCT file (#50.68)
"RTN","RORHL031",208,0)
 ;
"RTN","RORHL031",209,0)
 ; [CS]          Component Separator (defaults to "^")
"RTN","RORHL031",210,0)
 ;
"RTN","RORHL031",211,0)
 ; .RXE5         Reference to a local variable where the value
"RTN","RORHL031",212,0)
 ;               of the  RXE-5 field is returned
"RTN","RORHL031",213,0)
 ;
"RTN","RORHL031",214,0)
 ; Return Values:
"RTN","RORHL031",215,0)
 ;       <0  Error Code
"RTN","RORHL031",216,0)
 ;        0  Ok
"RTN","RORHL031",217,0)
 ;
"RTN","RORHL031",218,0)
RXE5(IEN50P68,CS,RXE5) ;
"RTN","RORHL031",219,0)
 N INDF,NODE,TMP
"RTN","RORHL031",220,0)
 S:$G(CS)="" CS="^"
"RTN","RORHL031",221,0)
 S RXE5="",INDF=+$G(IEN50P68)
"RTN","RORHL031",222,0)
 Q:INDF'>0 0
"RTN","RORHL031",223,0)
 ;--- Get the units
"RTN","RORHL031",224,0)
 S NODE=$$ALLOC^RORTMP(.TMP)
"RTN","RORHL031",225,0)
 D DATA^PSN50P68(INDF,,TMP)
"RTN","RORHL031",226,0)
 S TMP=$G(@NODE@(INDF,3))
"RTN","RORHL031",227,0)
 D FREE^RORTMP(NODE)
"RTN","RORHL031",228,0)
 Q:TMP'>0 0
"RTN","RORHL031",229,0)
 ;--- Format the field
"RTN","RORHL031",230,0)
 S $P(RXE5,CS,4)=$P(TMP,U)
"RTN","RORHL031",231,0)
 S $P(RXE5,CS,5)=$$ESCAPE^RORHL7($P(TMP,U,2))
"RTN","RORHL031",232,0)
 S $P(RXE5,CS,6)="99PSU"
"RTN","RORHL031",233,0)
 ;--- Success
"RTN","RORHL031",234,0)
 Q 0
"RTN","RORHL04")
0^53^B31631249
"RTN","RORHL04",1,0)
RORHL04 ;HOIFO/CRT,SG - HL7 RADIOLOGY: OBR,OBX ; 10/27/05 11:19am
"RTN","RORHL04",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL04",3,0)
 ;
"RTN","RORHL04",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL04",5,0)
 ;
"RTN","RORHL04",6,0)
 ; #65           Read access to file #70 (controlled)
"RTN","RORHL04",7,0)
 ; #118-B        Read access to file #71 (controlled)
"RTN","RORHL04",8,0)
 ; #118-D        Read access to file #72 (controlled)
"RTN","RORHL04",9,0)
 ; #1995         $$CPT^ICPTCOD (supported)
"RTN","RORHL04",10,0)
 ; #2043         EN1^RAO7PC1 (supported)
"RTN","RORHL04",11,0)
 ; #10060        Read access to the file #200 (supported)
"RTN","RORHL04",12,0)
 ; #10090        Read access to the file #4 (supported)
"RTN","RORHL04",13,0)
 ;
"RTN","RORHL04",14,0)
 ; #15-C         Read access to file #74 (Private)
"RTN","RORHL04",15,0)
 ;
"RTN","RORHL04",16,0)
 Q
"RTN","RORHL04",17,0)
 ;
"RTN","RORHL04",18,0)
 ;***** SEARCHES RADIOLOGY FOR DATA
"RTN","RORHL04",19,0)
 ;
"RTN","RORHL04",20,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL04",21,0)
 ;
"RTN","RORHL04",22,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL04",23,0)
 ;               data extraction time frames are stored.
"RTN","RORHL04",24,0)
 ;
"RTN","RORHL04",25,0)
 ; Return Values:
"RTN","RORHL04",26,0)
 ;       <0  Error code
"RTN","RORHL04",27,0)
 ;        0  Ok
"RTN","RORHL04",28,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL04",29,0)
 ;
"RTN","RORHL04",30,0)
 ; The ^TMP($J,"RAE1") global node is used by the function.
"RTN","RORHL04",31,0)
 ;
"RTN","RORHL04",32,0)
EN1(RORDFN,DXDTS) ;
"RTN","RORHL04",33,0)
 N CNI,DTI,ERRCNT,EXAMID,IDX,IENS,IENS74,RACN0,RC,RORENDT,RORSTDT,STR1,TMP
"RTN","RORHL04",34,0)
 S (ERRCNT,RC)=0
"RTN","RORHL04",35,0)
 ;
"RTN","RORHL04",36,0)
 S IDX=0
"RTN","RORHL04",37,0)
 F  S IDX=$O(DXDTS(4,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL04",38,0)
 . S RORSTDT=$P(DXDTS(4,IDX),U),RORENDT=$P(DXDTS(4,IDX),U,2)
"RTN","RORHL04",39,0)
 . ;--- Get radiology data
"RTN","RORHL04",40,0)
 . K ^TMP($J,"RAE1")
"RTN","RORHL04",41,0)
 . D EN1^RAO7PC1(RORDFN,RORSTDT,RORENDT,999999999)
"RTN","RORHL04",42,0)
 . ;--- Process the data
"RTN","RORHL04",43,0)
 . S EXAMID=""
"RTN","RORHL04",44,0)
 . F  S EXAMID=$O(^TMP($J,"RAE1",RORDFN,EXAMID))  Q:EXAMID=""  D
"RTN","RORHL04",45,0)
 . . S DTI=$P(EXAMID,"-"),CNI=$P(EXAMID,"-",2)
"RTN","RORHL04",46,0)
 . . S IENS=CNI_","_DTI_","_RORDFN_","
"RTN","RORHL04",47,0)
 . . S STR=^TMP($J,"RAE1",RORDFN,EXAMID)
"RTN","RORHL04",48,0)
 . . S RACN0=$P(STR,"^",2),IENS74=$P(STR,"^",5)
"RTN","RORHL04",49,0)
 . . S TMP=$$OBR(IENS,RACN0)
"RTN","RORHL04",50,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL04",51,0)
 . . Q:TMP="S"
"RTN","RORHL04",52,0)
 . . S TMP=$$OBX(IENS,IENS74)
"RTN","RORHL04",53,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL04",54,0)
 ;
"RTN","RORHL04",55,0)
 K ^TMP($J,"RAE1")
"RTN","RORHL04",56,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL04",57,0)
 ;
"RTN","RORHL04",58,0)
 ;*****
"RTN","RORHL04",59,0)
LOOP(TEXT,OID) ;
"RTN","RORHL04",60,0)
 N BR,CNT,I,I1,TMP
"RTN","RORHL04",61,0)
 S BR=$E(HLECH,3)_".br"_$E(HLECH,3)
"RTN","RORHL04",62,0)
 S RORSEG(3)=OID
"RTN","RORHL04",63,0)
 K RORSEG(5)
"RTN","RORHL04",64,0)
 ;---
"RTN","RORHL04",65,0)
 S I=$O(TEXT("")),CNT=0
"RTN","RORHL04",66,0)
 F  Q:I=""  S I1=$O(TEXT(I))  D  S I=I1
"RTN","RORHL04",67,0)
 . S TMP=$$ESCAPE^RORHL7(TEXT(I))
"RTN","RORHL04",68,0)
 . S CNT=CNT+1,RORSEG(5,CNT)=$S(I1'="":TMP_BR,1:TMP)
"RTN","RORHL04",69,0)
 ;---
"RTN","RORHL04",70,0)
 D:$D(RORSEG(5)) ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL04",71,0)
 Q
"RTN","RORHL04",72,0)
 ;
"RTN","RORHL04",73,0)
 ;***** GENERATES THE RADIOLOGY OBR SEGMENT
"RTN","RORHL04",74,0)
 ;
"RTN","RORHL04",75,0)
 ; RORIENS       IENS of the radiology record in the file #70.03
"RTN","RORHL04",76,0)
 ;
"RTN","RORHL04",77,0)
 ; Return Values:
"RTN","RORHL04",78,0)
 ;       <0  Error code
"RTN","RORHL04",79,0)
 ;        0  Ok
"RTN","RORHL04",80,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL04",81,0)
 ;      "S"  Skip the record
"RTN","RORHL04",82,0)
 ;
"RTN","RORHL04",83,0)
OBR(RORIENS,RACN0) ;
"RTN","RORHL04",84,0)
 N BUF,CPTIEN,CS,ERRCNT,IENS,IENS7002,RADTE,RC,RORMSG,ROROUT,RORSEG,TMP
"RTN","RORHL04",85,0)
 S (ERRCNT,RC)=0
"RTN","RORHL04",86,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL04",87,0)
 ;--- Check the parameters
"RTN","RORHL04",88,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL04",89,0)
 ;
"RTN","RORHL04",90,0)
 D GETS^DIQ(70.03,RORIENS,"2;14","IE","ROROUT","RORMSG")
"RTN","RORHL04",91,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,70.03,RORIENS)
"RTN","RORHL04",92,0)
 S IENS7002=$P(RORIENS,",",2,3)_","
"RTN","RORHL04",93,0)
 D GETS^DIQ(70.02,IENS7002,".01;3","EI","ROROUT","RORMSG")
"RTN","RORHL04",94,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,70.02,IENS7002)
"RTN","RORHL04",95,0)
 ;
"RTN","RORHL04",96,0)
 ;--- Initialize the segment
"RTN","RORHL04",97,0)
 S RORSEG(0)="OBR"
"RTN","RORHL04",98,0)
 ;
"RTN","RORHL04",99,0)
 ;--- OBR-3 - Unique Accession #
"RTN","RORHL04",100,0)
 S BUF=$P(RORIENS,",",2)_"-"_$P(RORIENS,",")
"RTN","RORHL04",101,0)
 S RADTE=$G(ROROUT(70.02,IENS7002,.01,"I"))\1
"RTN","RORHL04",102,0)
 S $P(BUF,CS,2)=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_+RACN0
"RTN","RORHL04",103,0)
 S RORSEG(3)=BUF
"RTN","RORHL04",104,0)
 ;
"RTN","RORHL04",105,0)
 ;--- OBR-4 - Procedure & CPT Code
"RTN","RORHL04",106,0)
 S IENS=+$G(ROROUT(70.03,RORIENS,2,"I"))_","
"RTN","RORHL04",107,0)
 Q:IENS'>0 $$ERROR^RORERR(-95,,,,70.03,RORIENS,2)
"RTN","RORHL04",108,0)
 S CPTIEN=+$$GET1^DIQ(71,IENS,9,"I",,"RORMSG")
"RTN","RORHL04",109,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,71,IENS)
"RTN","RORHL04",110,0)
 ;--- Some procedures never have a CPT code. Record a warning
"RTN","RORHL04",111,0)
 ;--- (only in debug mode) and skip the record.
"RTN","RORHL04",112,0)
 I CPTIEN'>0  D:$G(RORPARM("DEBUG"))  Q "S"
"RTN","RORHL04",113,0)
 . D ERROR^RORERR(-95,,,,71,IENS,9)
"RTN","RORHL04",114,0)
 ;---
"RTN","RORHL04",115,0)
 S TMP=$$CPT^ICPTCOD(CPTIEN)
"RTN","RORHL04",116,0)
 Q:TMP<0 $$ERROR^RORERR(-56,,$P(TMP,U,2),,+TMP,"$$CPT^ICPTCOD")
"RTN","RORHL04",117,0)
 S BUF=$P(TMP,U,2)_CS_$$ESCAPE^RORHL7($P(TMP,U,3))_CS_"C4"
"RTN","RORHL04",118,0)
 ;---
"RTN","RORHL04",119,0)
 S $P(BUF,CS,4)=$G(ROROUT(70.03,RORIENS,2,"I"))
"RTN","RORHL04",120,0)
 S $P(BUF,CS,5)=$$ESCAPE^RORHL7($G(ROROUT(70.03,RORIENS,2,"E")))
"RTN","RORHL04",121,0)
 S $P(BUF,CS,6)="99RAP"
"RTN","RORHL04",122,0)
 S RORSEG(4)=BUF
"RTN","RORHL04",123,0)
 ;
"RTN","RORHL04",124,0)
 ;--- OBR-7 - Exam Date/Time
"RTN","RORHL04",125,0)
 S TMP=$$FMTHL7^XLFDT($G(ROROUT(70.02,IENS7002,.01,"I")))
"RTN","RORHL04",126,0)
 Q:TMP'>0 $$ERROR^RORERR(-95,,,,70.02,IENS7002,.01)
"RTN","RORHL04",127,0)
 S RORSEG(7)=TMP
"RTN","RORHL04",128,0)
 ;
"RTN","RORHL04",129,0)
 ;--- OBR-16 - Requesting Physician
"RTN","RORHL04",130,0)
 S BUF=+$G(ROROUT(70.03,RORIENS,14,"I"))
"RTN","RORHL04",131,0)
 I BUF>0  D
"RTN","RORHL04",132,0)
 . S $P(BUF,CS,13)=$$GET1^DIQ(200,+BUF_",",53.5,"E",,"RORMSG")
"RTN","RORHL04",133,0)
 . I $G(DIERR)  D DBS^RORERR("RORMSG",-99,,,200,+BUF_",")  Q
"RTN","RORHL04",134,0)
 . S RORSEG(16)=BUF
"RTN","RORHL04",135,0)
 ;
"RTN","RORHL04",136,0)
 ;--- OBR-24 - Service Section ID
"RTN","RORHL04",137,0)
 S RORSEG(24)="RAD"
"RTN","RORHL04",138,0)
 ;
"RTN","RORHL04",139,0)
 ;--- OBR-44 - Division
"RTN","RORHL04",140,0)
 S RORSEG(44)=$$SITE^RORUTL03(CS)
"RTN","RORHL04",141,0)
 S IENS=+$G(ROROUT(70.02,IENS7002,3,"I"))_","
"RTN","RORHL04",142,0)
 I IENS>0  D
"RTN","RORHL04",143,0)
 . S BUF=$$GET1^DIQ(4,IENS,99,"I",,"RORMSG")
"RTN","RORHL04",144,0)
 . I $G(DIERR)  D DBS^RORERR("RORMSG",-99,,,4,IENS)  Q
"RTN","RORHL04",145,0)
 . Q:BUF=""
"RTN","RORHL04",146,0)
 . S $P(BUF,CS,2)=$$ESCAPE^RORHL7($G(ROROUT(70.02,IENS7002,3,"E")))
"RTN","RORHL04",147,0)
 . S $P(BUF,CS,3)="99VA4"
"RTN","RORHL04",148,0)
 . S RORSEG(44)=BUF
"RTN","RORHL04",149,0)
 ;
"RTN","RORHL04",150,0)
 ;--- Store the segment
"RTN","RORHL04",151,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL04",152,0)
 Q ERRCNT
"RTN","RORHL04",153,0)
 ;
"RTN","RORHL04",154,0)
 ;***** GENERATES THE RADIOLOGY OBX SEGMENT
"RTN","RORHL04",155,0)
 ;
"RTN","RORHL04",156,0)
 ; RORIENS       IENS of the radiology record in the file #70.03
"RTN","RORHL04",157,0)
 ;
"RTN","RORHL04",158,0)
 ; Return Values:
"RTN","RORHL04",159,0)
 ;       <0  Error code
"RTN","RORHL04",160,0)
 ;        0  Ok
"RTN","RORHL04",161,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL04",162,0)
 ;
"RTN","RORHL04",163,0)
OBX(RORIENS,IENS74) ;
"RTN","RORHL04",164,0)
 N ERRCNT,RC,RORMSG,ROROUT,RORSEG,RORTXT,TMP
"RTN","RORHL04",165,0)
 S (ERRCNT,RC)=0
"RTN","RORHL04",166,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL04",167,0)
 ;--- Check the parameters
"RTN","RORHL04",168,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL04",169,0)
 ;
"RTN","RORHL04",170,0)
 ;--- Initialize the segment
"RTN","RORHL04",171,0)
 S RORSEG(0)="OBX"
"RTN","RORHL04",172,0)
 ;
"RTN","RORHL04",173,0)
 ;--- OBX-2
"RTN","RORHL04",174,0)
 S RORSEG(2)="FT"
"RTN","RORHL04",175,0)
 ;
"RTN","RORHL04",176,0)
 ;--- OBX-11
"RTN","RORHL04",177,0)
 S RORSEG(11)="F"
"RTN","RORHL04",178,0)
 ;
"RTN","RORHL04",179,0)
 ;-- Get the Report Text
"RTN","RORHL04",180,0)
 S TMP=$$GET1^DIQ(74,IENS74,200,,"RORTXT","RORMSG")
"RTN","RORHL04",181,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL04",182,0)
 . D DBS^RORERR("RORMSG",-99,,,74,IENS74)
"RTN","RORHL04",183,0)
 I $D(RORTXT)>1  D  K RORTXT
"RTN","RORHL04",184,0)
 . D LOOP(.RORTXT,"RT"_CS_"Report Text"_CS_"VA080")
"RTN","RORHL04",185,0)
 ;
"RTN","RORHL04",186,0)
 ;--- Get the Impression Report
"RTN","RORHL04",187,0)
 S TMP=$$GET1^DIQ(74,IENS74,300,,"RORTXT","RORMSG")
"RTN","RORHL04",188,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL04",189,0)
 . D DBS^RORERR("RORMSG",-99,,,74,IENS74)
"RTN","RORHL04",190,0)
 I $D(RORTXT)>1  D  K RORTXT
"RTN","RORHL04",191,0)
 . D LOOP(.RORTXT,"IT"_CS_"Impression Text"_CS_"VA080")
"RTN","RORHL04",192,0)
 ;
"RTN","RORHL04",193,0)
 ;--- Get the Clinical History
"RTN","RORHL04",194,0)
 S TMP=$$GET1^DIQ(70.03,RORIENS,400,,"RORTXT","RORMSG")
"RTN","RORHL04",195,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL04",196,0)
 . D DBS^RORERR("RORMSG",-99,,,70.03,RORIENS)
"RTN","RORHL04",197,0)
 I $D(RORTXT)>1  D  K RORTXT
"RTN","RORHL04",198,0)
 . D LOOP(.RORTXT,"CH"_CS_"Clinical History"_CS_"VA080")
"RTN","RORHL04",199,0)
 ;
"RTN","RORHL04",200,0)
 Q ERRCNT
"RTN","RORHL05")
0^54^B21912781
"RTN","RORHL05",1,0)
RORHL05 ;HOIFO/CRT - HL7 AUTOPSY: OBR ; 2/8/06 8:06am
"RTN","RORHL05",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL05",3,0)
 ;
"RTN","RORHL05",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL05",5,0)
 ;
"RTN","RORHL05",6,0)
 ; #1995         $$CPT^ICPTCOD (supported)
"RTN","RORHL05",7,0)
 ; #2503         LRDFN^LR7OR1 (controlled)
"RTN","RORHL05",8,0)
 ; #3465         Access to autopsy data (private)
"RTN","RORHL05",9,0)
 ; #10040        Read the INSTITUTION field of file #44 (supported)
"RTN","RORHL05",10,0)
 ; #10090        Read access to the file #4 (supported)
"RTN","RORHL05",11,0)
 ;
"RTN","RORHL05",12,0)
 Q
"RTN","RORHL05",13,0)
 ;
"RTN","RORHL05",14,0)
 ;***** SEARCHES FOR AUTOPSY DATA
"RTN","RORHL05",15,0)
 ;
"RTN","RORHL05",16,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL05",17,0)
 ;
"RTN","RORHL05",18,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL05",19,0)
 ;               data extraction time frames are stored.
"RTN","RORHL05",20,0)
 ;
"RTN","RORHL05",21,0)
 ; [FORCE]       Force the extraction of the autopsy data
"RTN","RORHL05",22,0)
 ;
"RTN","RORHL05",23,0)
 ; Return Values:
"RTN","RORHL05",24,0)
 ;       <0  Error code
"RTN","RORHL05",25,0)
 ;        0  Ok
"RTN","RORHL05",26,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL05",27,0)
 ;
"RTN","RORHL05",28,0)
EN1(RORDFN,DXDTS,FORCE) ;
"RTN","RORHL05",29,0)
 N ADATE,ERRCNT,RC,RORLRDFN,RORMSG
"RTN","RORHL05",30,0)
 S (ERRCNT,RC)=0
"RTN","RORHL05",31,0)
 ;
"RTN","RORHL05",32,0)
 ;--- Check if the autopsy has been performed
"RTN","RORHL05",33,0)
 S RORLRDFN=+$$LABREF^RORUTL18(RORDFN)  Q:RORLRDFN'>0 0
"RTN","RORHL05",34,0)
 S ADATE=$$GET1^DIQ(63,RORLRDFN_",",11,"I",,"RORMSG")
"RTN","RORHL05",35,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,RORDFN,63,RORLRDFN_",")
"RTN","RORHL05",36,0)
 ;
"RTN","RORHL05",37,0)
 D:ADATE>0
"RTN","RORHL05",38,0)
 . ;--- Check if the autopsy data should be sent (autopsy date
"RTN","RORHL05",39,0)
 . ;    falls into one of the data extraction time frames or
"RTN","RORHL05",40,0)
 . ;--- the extraction if forced by the function parameter).
"RTN","RORHL05",41,0)
 . I '$G(FORCE)  S RC=0  D  Q:'RC
"RTN","RORHL05",42,0)
 . . N D1,D2,IDX
"RTN","RORHL05",43,0)
 . . S IDX=0
"RTN","RORHL05",44,0)
 . . F  S IDX=$O(DXDTS(7,IDX))  Q:IDX'>0  D  Q:RC
"RTN","RORHL05",45,0)
 . . . S D1=$P(DXDTS(7,IDX),U),D2=$P(DXDTS(7,IDX),U,2)
"RTN","RORHL05",46,0)
 . . . S:(ADATE'<D1)&(ADATE<D2) RC=1
"RTN","RORHL05",47,0)
 . .
"RTN","RORHL05",48,0)
 . ;--- Send the data
"RTN","RORHL05",49,0)
 . S RC=$$OBR(RORLRDFN)
"RTN","RORHL05",50,0)
 . I RC  Q:RC<0  S ERRCNT=ERRCNT+RC
"RTN","RORHL05",51,0)
 . S RC=$$OBX(RORLRDFN)
"RTN","RORHL05",52,0)
 . I RC  Q:RC<0  S ERRCNT=ERRCNT+RC
"RTN","RORHL05",53,0)
 ;
"RTN","RORHL05",54,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL05",55,0)
 ;
"RTN","RORHL05",56,0)
 ;***** AUTOPSY OBR SEGMENT BUILDER
"RTN","RORHL05",57,0)
 ;
"RTN","RORHL05",58,0)
 ; RORLRDFN      IEN of Lab Patient Record in File #63
"RTN","RORHL05",59,0)
 ;
"RTN","RORHL05",60,0)
 ; Return Values:
"RTN","RORHL05",61,0)
 ;       <0  Error code
"RTN","RORHL05",62,0)
 ;        0  Ok
"RTN","RORHL05",63,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL05",64,0)
 ;
"RTN","RORHL05",65,0)
OBR(RORLRDFN) ;
"RTN","RORHL05",66,0)
 N BUF,CS,ERRCNT,IEN,IENS63,RC,RORMSG,ROROUT,RORSEG,TMP
"RTN","RORHL05",67,0)
 S (ERRCNT,RC)=0
"RTN","RORHL05",68,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL05",69,0)
 ;
"RTN","RORHL05",70,0)
 S IENS63=+$G(RORLRDFN)_","
"RTN","RORHL05",71,0)
 D GETS^DIQ(63,IENS63,"11;12.1;13.1;14;14.1;14.5;14.7","IE","ROROUT","RORMSG")
"RTN","RORHL05",72,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL05",73,0)
 . D DBS^RORERR("RORMSG",-9,,,63,IENS63)
"RTN","RORHL05",74,0)
 ;
"RTN","RORHL05",75,0)
 ;--- Initialize the segment
"RTN","RORHL05",76,0)
 S RORSEG(0)="OBR"
"RTN","RORHL05",77,0)
 ;
"RTN","RORHL05",78,0)
 ;--- OBR-3 - Order #
"RTN","RORHL05",79,0)
 I $G(ROROUT(63,IENS63,14,"E"))=""  D  Q RC
"RTN","RORHL05",80,0)
 . S RC=$$ERROR^RORERR(-95,,,,63,IENS63,14)
"RTN","RORHL05",81,0)
 S RORSEG(3)=ROROUT(63,IENS63,14,"E")
"RTN","RORHL05",82,0)
 ;
"RTN","RORHL05",83,0)
 ;--- OBR-4 - CPT Code
"RTN","RORHL05",84,0)
 S BUF=88099,TMP=$$CPT^ICPTCOD(BUF)
"RTN","RORHL05",85,0)
 I TMP<0  D  S ERRCNT=ERRCNT+1,TMP=""
"RTN","RORHL05",86,0)
 . D ERROR^RORERR(-57,,$P(TMP,U,2),,+TMP,"$$CPT^ICPTCOD")
"RTN","RORHL05",87,0)
 S $P(BUF,CS,2)=$$ESCAPE^RORHL7($P(TMP,U,3))
"RTN","RORHL05",88,0)
 S $P(BUF,CS,3)="C4"
"RTN","RORHL05",89,0)
 S RORSEG(4)=BUF
"RTN","RORHL05",90,0)
 ;
"RTN","RORHL05",91,0)
 ;--- OBR-7 - Autopsy Date/Time
"RTN","RORHL05",92,0)
 S TMP=$$FMTHL7^XLFDT($G(ROROUT(63,IENS63,11,"I")))
"RTN","RORHL05",93,0)
 Q:TMP'>0 $$ERROR^RORERR(-95,,,,63,IENS63,11)
"RTN","RORHL05",94,0)
 S RORSEG(7)=TMP
"RTN","RORHL05",95,0)
 ;
"RTN","RORHL05",96,0)
 ;--- OBR-8 - Date of the final autopsy diagnoses
"RTN","RORHL05",97,0)
 S RORSEG(8)=$$FMTHL7^XLFDT($G(ROROUT(63,IENS63,13.1,"I")))
"RTN","RORHL05",98,0)
 ;
"RTN","RORHL05",99,0)
 ;--- OBR-16 - Ordering Provider
"RTN","RORHL05",100,0)
 S RORSEG(16)=$G(ROROUT(63,IENS63,12.1,"I"))
"RTN","RORHL05",101,0)
 ;
"RTN","RORHL05",102,0)
 ;--- OBR-22 - Date/TIme the report is released
"RTN","RORHL05",103,0)
 S RORSEG(22)=$$FMTHL7^XLFDT($G(ROROUT(63,IENS63,14.7,"I")))
"RTN","RORHL05",104,0)
 ;
"RTN","RORHL05",105,0)
 ;--- OBR-24 - Diagnostic Service ID
"RTN","RORHL05",106,0)
 S RORSEG(24)="SP"
"RTN","RORHL05",107,0)
 ;
"RTN","RORHL05",108,0)
 ;--- OBR-44 - Division
"RTN","RORHL05",109,0)
 S TMP=$G(ROROUT(63,IENS63,14.1,"I"))
"RTN","RORHL05",110,0)
 S IEN=$S(TMP'="":+$O(^SC("B",TMP,0)),1:0)
"RTN","RORHL05",111,0)
 S RORSEG(44)=$$DIV44^RORHLUT1(IEN,CS)
"RTN","RORHL05",112,0)
 ;
"RTN","RORHL05",113,0)
 ;--- OBR-46 - Service
"RTN","RORHL05",114,0)
 S BUF=+$G(ROROUT(63,IENS63,14.5,"I"))
"RTN","RORHL05",115,0)
 D:BUF>0
"RTN","RORHL05",116,0)
 . S $P(BUF,CS,2)=$G(ROROUT(63,IENS63,14.5,"E"))
"RTN","RORHL05",117,0)
 . S RORSEG(46)=BUF
"RTN","RORHL05",118,0)
 ;
"RTN","RORHL05",119,0)
 ;--- Store the segment
"RTN","RORHL05",120,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL05",121,0)
 Q ERRCNT
"RTN","RORHL05",122,0)
 ;
"RTN","RORHL05",123,0)
 ;***** AUTOPSY OBX SEGMENT BUILDER
"RTN","RORHL05",124,0)
 ;
"RTN","RORHL05",125,0)
 ; RORLRDFN      IEN of Lab Patient Record in File #63
"RTN","RORHL05",126,0)
 ;
"RTN","RORHL05",127,0)
 ; Return Values:
"RTN","RORHL05",128,0)
 ;       <0  Error code
"RTN","RORHL05",129,0)
 ;        0  Ok
"RTN","RORHL05",130,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL05",131,0)
 ;
"RTN","RORHL05",132,0)
OBX(RORLRDFN) ;
"RTN","RORHL05",133,0)
 ;;32.2;;AUCD^Clinical Diagnosis^VA080
"RTN","RORHL05",134,0)
 ;;32.3;;AUPD^Pathological Diagnosis^VA080
"RTN","RORHL05",135,0)
 ;
"RTN","RORHL05",136,0)
 N BR,BUF,CS,ERRCNT,FLD,I,I1,ICNT,IENS63,IMF,RC,RORMSG,RORSEG,RORTXT,TMP
"RTN","RORHL05",137,0)
 S (ERRCNT,RC)=0
"RTN","RORHL05",138,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL05",139,0)
 S BR=$E(HLECH,3)_".br"_$E(HLECH,3)
"RTN","RORHL05",140,0)
 ;
"RTN","RORHL05",141,0)
 ;--- Initialize the segment
"RTN","RORHL05",142,0)
 S RORSEG(0)="OBX"
"RTN","RORHL05",143,0)
 ;
"RTN","RORHL05",144,0)
 ;--- OBX-2 - Value Type
"RTN","RORHL05",145,0)
 S RORSEG(2)="FT"
"RTN","RORHL05",146,0)
 ;
"RTN","RORHL05",147,0)
 ;--- OBX-11 - Observation Result Status
"RTN","RORHL05",148,0)
 S RORSEG(11)="F"
"RTN","RORHL05",149,0)
 ;
"RTN","RORHL05",150,0)
 ;--- Generate the OBX segments
"RTN","RORHL05",151,0)
 S IENS63=+$G(RORLRDFN)_","
"RTN","RORHL05",152,0)
 F IMF=1,2  D
"RTN","RORHL05",153,0)
 . S BUF=$T(OBX+IMF),FLD=$P(BUF,";;",2)
"RTN","RORHL05",154,0)
 . K RORMSG,RORTXT,RORSEG(5)
"RTN","RORHL05",155,0)
 . ;--- OBX-3 - Observation Identifier
"RTN","RORHL05",156,0)
 . S RORSEG(3)=$P(BUF,";;",3)
"RTN","RORHL05",157,0)
 . ;--- Load the text
"RTN","RORHL05",158,0)
 . S TMP=$$GET1^DIQ(63,IENS63,FLD,,"RORTXT","RORMSG")
"RTN","RORHL05",159,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL05",160,0)
 . . D DBS^RORERR("RORMSG",-9,,,63,IENS63)
"RTN","RORHL05",161,0)
 . ;--- Process the text
"RTN","RORHL05",162,0)
 . S I=$O(RORTXT("")),ICNT=0
"RTN","RORHL05",163,0)
 . F  Q:I=""  S I1=$O(RORTXT(I))  D  S I=I1
"RTN","RORHL05",164,0)
 . . ;--- OBX-5 - Observation Value
"RTN","RORHL05",165,0)
 . . S TMP=$$ESCAPE^RORHL7(RORTXT(I))
"RTN","RORHL05",166,0)
 . . S ICNT=ICNT+1,RORSEG(5,ICNT)=$S(I1'="":TMP_BR,1:TMP)
"RTN","RORHL05",167,0)
 . ;--- Store the segment
"RTN","RORHL05",168,0)
 . D:ICNT>0 ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL05",169,0)
 ;
"RTN","RORHL05",170,0)
 ;---
"RTN","RORHL05",171,0)
 Q ERRCNT
"RTN","RORHL06")
0^55^B22550285
"RTN","RORHL06",1,0)
RORHL06 ;HOIFO/BH,CRT - HL7 LIVER BIOPSY: OBR,OBX ; 8/1/05 3:53pm
"RTN","RORHL06",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL06",3,0)
 ;
"RTN","RORHL06",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL06",5,0)
 ;
"RTN","RORHL06",6,0)
 ; #1995         $$CPT^ICPTCOD (supported)
"RTN","RORHL06",7,0)
 ; #2503         LRDFN^LR7OR1 (controlled)
"RTN","RORHL06",8,0)
 ; #10035        Read access to the PATIENT file (supported)
"RTN","RORHL06",9,0)
 ;
"RTN","RORHL06",10,0)
 Q
"RTN","RORHL06",11,0)
 ;
"RTN","RORHL06",12,0)
 ;***** SEARCHES FOR LIVER BIOPSY DATA
"RTN","RORHL06",13,0)
 ;
"RTN","RORHL06",14,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL06",15,0)
 ;
"RTN","RORHL06",16,0)
 ; RORSTDT       Start Date (FileMan)
"RTN","RORHL06",17,0)
 ; RORENDT       End Date   (FileMan)
"RTN","RORHL06",18,0)
 ;
"RTN","RORHL06",19,0)
 ; Return Values:
"RTN","RORHL06",20,0)
 ;       <0  Error code
"RTN","RORHL06",21,0)
 ;        0  Ok
"RTN","RORHL06",22,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL06",23,0)
 ;
"RTN","RORHL06",24,0)
 ; The function uses the ^UTILITY($J,"W") global node.
"RTN","RORHL06",25,0)
 ;
"RTN","RORHL06",26,0)
EN1(RORDFN,RORSTDT,RORENDT) ;
"RTN","RORHL06",27,0)
 N ERRCNT,FLDS,IDT,IENS,K5,LRDFN,QUIT,RC,SPECIMEN
"RTN","RORHL06",28,0)
 S (ERRCNT,RC)=0
"RTN","RORHL06",29,0)
 ;
"RTN","RORHL06",30,0)
 ;--- Check if the patient exists
"RTN","RORHL06",31,0)
 S RORDFN=+$G(RORDFN)
"RTN","RORHL06",32,0)
 I '$D(^DPT(RORDFN))  D  Q RC
"RTN","RORHL06",33,0)
 . S RC=$$ERROR^RORERR(-36,,,RORDFN,2)
"RTN","RORHL06",34,0)
 ;
"RTN","RORHL06",35,0)
 S LRDFN=+$$LABREF^RORUTL18(RORDFN)  Q:LRDFN'>0 0
"RTN","RORHL06",36,0)
 ;
"RTN","RORHL06",37,0)
 S FLDS="1.1;1.4"
"RTN","RORHL06",38,0)
 S RORENDT=$$INVDATE^RORUTL01(RORENDT)
"RTN","RORHL06",39,0)
 S RORSTDT=$$INVDATE^RORUTL01(RORSTDT)
"RTN","RORHL06",40,0)
 ;
"RTN","RORHL06",41,0)
 S IDT=$O(^LR(LRDFN,"SP",RORSTDT))
"RTN","RORHL06",42,0)
 F  S IDT=$O(^LR(LRDFN,"SP",IDT),-1)  Q:'IDT!(IDT'>RORENDT)  D  Q:RC<0
"RTN","RORHL06",43,0)
 . S K5=0,QUIT=0
"RTN","RORHL06",44,0)
 . F  S K5=$O(^LR(LRDFN,"SP",IDT,.1,K5))  Q:'K5  D  Q:QUIT!(RC<0)
"RTN","RORHL06",45,0)
 . . S IENS=K5_","_IDT_","_LRDFN_","
"RTN","RORHL06",46,0)
 . . S SPECIMEN=$$GET1^DIQ(63.812,IENS,.01,"E",,"RORMSG")
"RTN","RORHL06",47,0)
 . . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL06",48,0)
 . . . D DBS^RORERR("RORMSG",-9,,,63.812,IENS)
"RTN","RORHL06",49,0)
 . . I $$UP^XLFSTR(SPECIMEN)["LIVER"  D
"RTN","RORHL06",50,0)
 . . . S IENS=IDT_","_LRDFN_","
"RTN","RORHL06",51,0)
 . . . S TMP=$$OBR(IENS)
"RTN","RORHL06",52,0)
 . . . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL06",53,0)
 . . . S TMP=$$OBX(IENS,FLDS)
"RTN","RORHL06",54,0)
 . . . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL06",55,0)
 . . . S QUIT=1
"RTN","RORHL06",56,0)
 ;
"RTN","RORHL06",57,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL06",58,0)
 ;
"RTN","RORHL06",59,0)
 ;***** LIVER BIOPSY OBR SEGMENT BUILDER
"RTN","RORHL06",60,0)
 ;
"RTN","RORHL06",61,0)
 ; RORIENS       IENS of Liver Biopsy Record in File #63.08
"RTN","RORHL06",62,0)
 ;
"RTN","RORHL06",63,0)
 ; Return Values:
"RTN","RORHL06",64,0)
 ;       <0  Error code
"RTN","RORHL06",65,0)
 ;        0  Ok
"RTN","RORHL06",66,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL06",67,0)
 ;
"RTN","RORHL06",68,0)
OBR(RORIENS) ;
"RTN","RORHL06",69,0)
 N BUF,CS,ERRCNT,FLDS,IEN,RC,RORMSG,ROROUT,RORSEG,TMP
"RTN","RORHL06",70,0)
 S (ERRCNT,RC)=0
"RTN","RORHL06",71,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL06",72,0)
 ;--- Check the parameters
"RTN","RORHL06",73,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL06",74,0)
 ;
"RTN","RORHL06",75,0)
 ;--- Load the data (with a temporary fix for invalid
"RTN","RORHL06",76,0)
 ;--- output transform of the .01 field - ROR*1*8)
"RTN","RORHL06",77,0)
 D GETS^DIQ(63.08,RORIENS,".01","I","ROROUT","RORMSG")
"RTN","RORHL06",78,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL06",79,0)
 . D DBS^RORERR("RORMSG",-9,,,63.08,RORIENS)
"RTN","RORHL06",80,0)
 D GETS^DIQ(63.08,RORIENS,".06;.07;.08","IE","ROROUT","RORMSG")
"RTN","RORHL06",81,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL06",82,0)
 . D DBS^RORERR("RORMSG",-9,,,63.08,RORIENS)
"RTN","RORHL06",83,0)
 ;
"RTN","RORHL06",84,0)
 ;--- Initialize the segment
"RTN","RORHL06",85,0)
 S RORSEG(0)="OBR"
"RTN","RORHL06",86,0)
 ;
"RTN","RORHL06",87,0)
 ;--- OBR-3 - Surgical Path Acc #
"RTN","RORHL06",88,0)
 S RORSEG(3)=$G(ROROUT(63.08,RORIENS,.06,"E"))
"RTN","RORHL06",89,0)
 ;
"RTN","RORHL06",90,0)
 ;--- OBR-4 - Liver Biopsy CPT Code
"RTN","RORHL06",91,0)
 S BUF=47000,TMP=$$CPT^ICPTCOD(BUF)
"RTN","RORHL06",92,0)
 I TMP<0  D  S ERRCNT=ERRCNT+1,TMP=""
"RTN","RORHL06",93,0)
 . D ERROR^RORERR(-57,,$P(TMP,U,2),,+TMP,"$$CPT^ICPTCOD")
"RTN","RORHL06",94,0)
 S $P(BUF,CS,2)=$$ESCAPE^RORHL7($P(TMP,U,3))
"RTN","RORHL06",95,0)
 S $P(BUF,CS,3)="C4"
"RTN","RORHL06",96,0)
 S RORSEG(4)=BUF
"RTN","RORHL06",97,0)
 ;
"RTN","RORHL06",98,0)
 ;--- OBR-7 - Date/Time Specimen Taken
"RTN","RORHL06",99,0)
 S TMP=$G(ROROUT(63.08,RORIENS,.01,"I"))
"RTN","RORHL06",100,0)
 Q:TMP'>0 $$ERROR^RORERR(-95,,,,63.08,RORIENS,.01)
"RTN","RORHL06",101,0)
 S RORSEG(7)=$$FMTHL7^XLFDT(TMP)
"RTN","RORHL06",102,0)
 ;
"RTN","RORHL06",103,0)
 ;--- OBR-16 - Surgeon/Physician
"RTN","RORHL06",104,0)
 S RORSEG(16)=$G(ROROUT(63.08,RORIENS,.07,"I"))
"RTN","RORHL06",105,0)
 ;
"RTN","RORHL06",106,0)
 ;--- OBR-24 - Service Section ID
"RTN","RORHL06",107,0)
 S RORSEG(24)="SP"
"RTN","RORHL06",108,0)
 ;
"RTN","RORHL06",109,0)
 ;--- OBR-44 - Division
"RTN","RORHL06",110,0)
 S TMP=$G(ROROUT(63.08,RORIENS,.08,"E"))
"RTN","RORHL06",111,0)
 S IEN=$S(TMP'="":+$O(^SC("B",TMP,0)),1:0)
"RTN","RORHL06",112,0)
 S RORSEG(44)=$$DIV44^RORHLUT1(IEN,CS)
"RTN","RORHL06",113,0)
 ;
"RTN","RORHL06",114,0)
 ;--- Store the segment
"RTN","RORHL06",115,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL06",116,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL06",117,0)
 ;
"RTN","RORHL06",118,0)
 ;***** LIVER BIOPSY OBX SEGMENT(S) BUILDER
"RTN","RORHL06",119,0)
 ;
"RTN","RORHL06",120,0)
 ; RORIENS       IENS of Liver Biopsy Record in File #63.08
"RTN","RORHL06",121,0)
 ; RORFLDS       List of WP fields to return as OBX'es
"RTN","RORHL06",122,0)
 ;
"RTN","RORHL06",123,0)
 ; Return Values:
"RTN","RORHL06",124,0)
 ;       <0  Error code
"RTN","RORHL06",125,0)
 ;        0  Ok
"RTN","RORHL06",126,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL06",127,0)
 ;
"RTN","RORHL06",128,0)
OBX(RORIENS,RORFLDS) ;
"RTN","RORHL06",129,0)
 N BUF,CS,DIWF,DIWL,DIWR,ERRCNT,FLD,I,RORII,PZ,RC,RORMSG,ROROUT,RORRES,RORSEG,SCS,TMP,X
"RTN","RORHL06",130,0)
 S (ERRCNT,RC)=0
"RTN","RORHL06",131,0)
 D ECH^RORHL7(.CS,.SCS)
"RTN","RORHL06",132,0)
 ;--- Check the parameters
"RTN","RORHL06",133,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL06",134,0)
 ;
"RTN","RORHL06",135,0)
 ;--- Load the data
"RTN","RORHL06",136,0)
 D GETS^DIQ(63.08,RORIENS,RORFLDS,"EI","ROROUT","RORMSG")
"RTN","RORHL06",137,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL06",138,0)
 . D DBS^RORERR("RORMSG",-99,,,63.08,RORIENS)
"RTN","RORHL06",139,0)
 ;
"RTN","RORHL06",140,0)
 ;--- Initialize the segment
"RTN","RORHL06",141,0)
 S RORSEG(0)="OBX"
"RTN","RORHL06",142,0)
 ;
"RTN","RORHL06",143,0)
 ;--- OBX-2
"RTN","RORHL06",144,0)
 S RORSEG(2)="FT"
"RTN","RORHL06",145,0)
 ;
"RTN","RORHL06",146,0)
 ;--- OBX-11
"RTN","RORHL06",147,0)
 S RORSEG(11)="F"
"RTN","RORHL06",148,0)
 ;
"RTN","RORHL06",149,0)
 F PZ=1:1  S FLD=$P(RORFLDS,";",PZ)  Q:FLD=""  D  Q:RC<0
"RTN","RORHL06",150,0)
 . S BUF=47000,TMP=$$CPT^ICPTCOD(BUF)
"RTN","RORHL06",151,0)
 . I TMP<0  D  S ERRCNT=ERRCNT+1,TMP=""
"RTN","RORHL06",152,0)
 . . D ERROR^RORERR(-57,,$P(TMP,U,2),,+TMP,"$$CPT^ICPTCOD")
"RTN","RORHL06",153,0)
 . S $P(BUF,SCS,2)=$$GET1^DID(63.08,FLD,,"LABEL",,"RORMSG")
"RTN","RORHL06",154,0)
 . S $P(BUF,CS,2)=$$ESCAPE^RORHL7($P(TMP,U,3))
"RTN","RORHL06",155,0)
 . S $P(BUF,CS,3)="C4"
"RTN","RORHL06",156,0)
 . S RORSEG(3)=BUF
"RTN","RORHL06",157,0)
 . ;---
"RTN","RORHL06",158,0)
 . K ^UTILITY($J,"W")
"RTN","RORHL06",159,0)
 . S DIWL=1,DIWR=72
"RTN","RORHL06",160,0)
 . S RORII=0
"RTN","RORHL06",161,0)
 . F  S RORII=$O(ROROUT(63.08,RORIENS,FLD,RORII))  Q:'RORII  D
"RTN","RORHL06",162,0)
 . . S X=ROROUT(63.08,RORIENS,FLD,RORII)  D ^DIWP
"RTN","RORHL06",163,0)
 . ;---
"RTN","RORHL06",164,0)
 . S I=0
"RTN","RORHL06",165,0)
 . F  S I=$O(^UTILITY($J,"W",DIWL,I))  Q:'I  D
"RTN","RORHL06",166,0)
 . . S RORSEG(5)=$G(^UTILITY($J,"W",DIWL,I,0))
"RTN","RORHL06",167,0)
 . . ;--- Store the segment
"RTN","RORHL06",168,0)
 . . D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL06",169,0)
 ;
"RTN","RORHL06",170,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL07")
0^56^B16768200
"RTN","RORHL07",1,0)
RORHL07 ;HOIFO/BH - HL7 INPATIENT PHARMACY: ORC,RXE ; 8/26/05 2:40pm
"RTN","RORHL07",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL07",3,0)
 ;
"RTN","RORHL07",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL07",5,0)
 ;
"RTN","RORHL07",6,0)
 ; #93           Get stop code from the file #44 (controlled)
"RTN","RORHL07",7,0)
 ; #1876         Read access to file #59 (controlled)
"RTN","RORHL07",8,0)
 ; #1977         Read access to file #52 (controlled)
"RTN","RORHL07",9,0)
 ; #2497         Read access to file #55 (controlled)
"RTN","RORHL07",10,0)
 ; #10040        Read the INSTITUTION field of file #44 (supported)
"RTN","RORHL07",11,0)
 ; #10060        Read access to file #200 (supported)
"RTN","RORHL07",12,0)
 ; #10090        Read access to file #4 (supported)
"RTN","RORHL07",13,0)
 ;
"RTN","RORHL07",14,0)
 Q
"RTN","RORHL07",15,0)
 ;
"RTN","RORHL07",16,0)
 ;***** INPATIENT PHARMACY ORC SEGMENT BUILDER
"RTN","RORHL07",17,0)
 ;
"RTN","RORHL07",18,0)
 ; RORIENS       IENS of Unit/Dose in subfile #55.06
"RTN","RORHL07",19,0)
 ;
"RTN","RORHL07",20,0)
 ; .RORORC       Array with info (from OEL^PSOORRL)
"RTN","RORHL07",21,0)
 ;
"RTN","RORHL07",22,0)
 ; Return Values:
"RTN","RORHL07",23,0)
 ;       <0  Error Code
"RTN","RORHL07",24,0)
 ;        0  Ok
"RTN","RORHL07",25,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL07",26,0)
 ;
"RTN","RORHL07",27,0)
ORC(RORIENS,RORORC) ;
"RTN","RORHL07",28,0)
 N BUF,CS,ERRCNT,IEN42,IEN44,RC,RORMSG,RORSEG,TMP
"RTN","RORHL07",29,0)
 S (ERRCNT,RC)=0
"RTN","RORHL07",30,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL07",31,0)
 ;--- Check the parameters
"RTN","RORHL07",32,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL07",33,0)
 ;
"RTN","RORHL07",34,0)
 ;--- Initialize the segment
"RTN","RORHL07",35,0)
 S RORSEG(0)="ORC"
"RTN","RORHL07",36,0)
 ;
"RTN","RORHL07",37,0)
 ;--- ORC-1 - Order Control 
"RTN","RORHL07",38,0)
 S RORSEG(1)="NW"
"RTN","RORHL07",39,0)
 ;
"RTN","RORHL07",40,0)
 ;--- ORC-2 - Placer Order Number
"RTN","RORHL07",41,0)
 S TMP=$$GET1^DIQ(55.06,RORIENS,.01,,,"RORMSG")
"RTN","RORHL07",42,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,55.06,RORIENS)
"RTN","RORHL07",43,0)
 S RORSEG(2)=RORDFN_"V"_TMP_CS_"IP"
"RTN","RORHL07",44,0)
 ;
"RTN","RORHL07",45,0)
 ;--- ORC-12 - Provider
"RTN","RORHL07",46,0)
 S BUF=+$P($G(RORORC("P",0)),U)
"RTN","RORHL07",47,0)
 I BUF>0  D
"RTN","RORHL07",48,0)
 . S $P(BUF,CS,13)=$$GET1^DIQ(200,+BUF_",",53.5,"E",,"RORMSG")
"RTN","RORHL07",49,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL07",50,0)
 . . D DBS^RORERR("RORMSG",-99,,,200,+BUF_",")
"RTN","RORHL07",51,0)
 . S RORSEG(12)=BUF
"RTN","RORHL07",52,0)
 ;
"RTN","RORHL07",53,0)
 ;--- ORC-15 - Order Date/Time
"RTN","RORHL07",54,0)
 S TMP=$$FMTHL7^XLFDT($P($G(RORORC(0)),U,5))
"RTN","RORHL07",55,0)
 Q:TMP'>0 $$ERROR^RORERR(-100,,,,"No order date","OEL^PSOORRL")
"RTN","RORHL07",56,0)
 S RORSEG(15)=TMP
"RTN","RORHL07",57,0)
 ;
"RTN","RORHL07",58,0)
 ;--- ORC-16 - Control Code Reason
"RTN","RORHL07",59,0)
 S RORSEG(16)=CS_CS_CS_CS_"NEW"
"RTN","RORHL07",60,0)
 ;
"RTN","RORHL07",61,0)
 ;--- ORC-17 - Division
"RTN","RORHL07",62,0)
 S IEN42=+$$GET1^DIQ(55.06,RORIENS,9,"I",,"RORMSG")
"RTN","RORHL07",63,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL07",64,0)
 . D DBS^RORERR("RORMSG",-99,,,55.06,RORIENS)
"RTN","RORHL07",65,0)
 I IEN42>0  D
"RTN","RORHL07",66,0)
 . S IEN44=+$$GET1^DIQ(42,IEN42_",",44,"I",,"RORMSG")
"RTN","RORHL07",67,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL07",68,0)
 . . D DBS^RORERR("RORMSG",-99,,,42,IEN42_",")
"RTN","RORHL07",69,0)
 E  S IEN44=0
"RTN","RORHL07",70,0)
 S RORSEG(17)=$$DIV44^RORHLUT1(IEN44,CS)
"RTN","RORHL07",71,0)
 ;
"RTN","RORHL07",72,0)
 ;--- Store the segment
"RTN","RORHL07",73,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL07",74,0)
 Q ERRCNT
"RTN","RORHL07",75,0)
 ;
"RTN","RORHL07",76,0)
 ;***** INPATIENT PHARMACY RXE SEGMENT BUILDER
"RTN","RORHL07",77,0)
 ;
"RTN","RORHL07",78,0)
 ; RORIENS       IENS of Pharmacy Record in subfile #55.06
"RTN","RORHL07",79,0)
 ; .RORRXE       Array containing info (from OEL^PSJORRL)
"RTN","RORHL07",80,0)
 ;
"RTN","RORHL07",81,0)
 ; Return Values:
"RTN","RORHL07",82,0)
 ;       <0  Error Code
"RTN","RORHL07",83,0)
 ;        0  Ok
"RTN","RORHL07",84,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL07",85,0)
 ;
"RTN","RORHL07",86,0)
RXE(RORIENS,RORRXE) ;
"RTN","RORHL07",87,0)
 N BUF,CS,ERRCNT,IDGN,II,INDF,RC,RORMSG,RORMR,ROROUT,RORUOUT,RORQT,RORSEG,TMP
"RTN","RORHL07",88,0)
 S (ERRCNT,RC)=0
"RTN","RORHL07",89,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL07",90,0)
 ;--- Check the parameters
"RTN","RORHL07",91,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL07",92,0)
 ;
"RTN","RORHL07",93,0)
 Q:$P($G(RORRXE(0)),U)="" 0
"RTN","RORHL07",94,0)
 ;
"RTN","RORHL07",95,0)
 ;--- Load the data
"RTN","RORHL07",96,0)
 D GETS^DIQ(55.06,RORIENS,"3;26","E","ROROUT","RORMSG")
"RTN","RORHL07",97,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL07",98,0)
 . D DBS^RORERR("RORMSG",-99,,,55.06,RORIENS)
"RTN","RORHL07",99,0)
 S RORMR=$$ESCAPE^RORHL7($G(ROROUT(55.06,RORIENS,3,"E")))
"RTN","RORHL07",100,0)
 S TMP=$G(ROROUT(55.06,RORIENS,26,"E")),RORQT=""
"RTN","RORHL07",101,0)
 S:TMP'="" $P(RORQT,CS,8)=$$ESCAPE^RORHL7(TMP)
"RTN","RORHL07",102,0)
 ;
"RTN","RORHL07",103,0)
 S II=0
"RTN","RORHL07",104,0)
 F  S II=$O(RORRXE("DD",II)) Q:II=""  D  Q:RC<0
"RTN","RORHL07",105,0)
 . K ROROUT,RORSEG
"RTN","RORHL07",106,0)
 . ;--- Initialize the segment
"RTN","RORHL07",107,0)
 . S RORSEG(0)="RXE"
"RTN","RORHL07",108,0)
 . ;
"RTN","RORHL07",109,0)
 . ;--- RXE-1 - Quantity/Timing
"RTN","RORHL07",110,0)
 . S RORSEG(1)=RORQT
"RTN","RORHL07",111,0)
 . ;
"RTN","RORHL07",112,0)
 . ;--- RXE-2 - Give Code
"RTN","RORHL07",113,0)
 . S IDGN=+$P($G(RORRXE("DD",II,0)),U)
"RTN","RORHL07",114,0)
 . S:IDGN'>0 IDGN=+$P($G(RORRXE("DD",II,0)),U,3)  Q:IDGN'>0
"RTN","RORHL07",115,0)
 . S BUF="",TMP=$$RXE2^RORHL031(IDGN,CS,.BUF,.INDF)
"RTN","RORHL07",116,0)
 . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL07",117,0)
 . Q:BUF=""
"RTN","RORHL07",118,0)
 . S RORSEG(2)=BUF
"RTN","RORHL07",119,0)
 . ;
"RTN","RORHL07",120,0)
 . ;--- RXE-3 - Give Amount (Min)
"RTN","RORHL07",121,0)
 . S RORSEG(3)=""""""
"RTN","RORHL07",122,0)
 . ;
"RTN","RORHL07",123,0)
 . ;--- RXE-5 - Give Units
"RTN","RORHL07",124,0)
 . S TMP=$$RXE5^RORHL031(+$G(INDF),CS,.BUF)
"RTN","RORHL07",125,0)
 . S:TMP ERRCNT=ERRCNT+1
"RTN","RORHL07",126,0)
 . S:BUF'="" RORSEG(5)=BUF
"RTN","RORHL07",127,0)
 . ;
"RTN","RORHL07",128,0)
 . ;--- RXE-18 - Stop Date/Time
"RTN","RORHL07",129,0)
 . S TMP=$P($G(RORRXE(0)),U,3)
"RTN","RORHL07",130,0)
 . S RORSEG(18)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL07",131,0)
 . ;
"RTN","RORHL07",132,0)
 . ;--- RXE-21 - Medication Route
"RTN","RORHL07",133,0)
 . S:RORMR'="" RORSEG(21)=RORMR
"RTN","RORHL07",134,0)
 . ;
"RTN","RORHL07",135,0)
 . ;--- RXE-24 - Units per dose
"RTN","RORHL07",136,0)
 . S TMP=$P($G(RORRXE("DD",II,0)),U,2)
"RTN","RORHL07",137,0)
 . S:TMP'="" RORSEG(24)=+TMP
"RTN","RORHL07",138,0)
 . ;
"RTN","RORHL07",139,0)
 . ;--- Store the segment
"RTN","RORHL07",140,0)
 . D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL07",141,0)
 ;
"RTN","RORHL07",142,0)
 Q ERRCNT
"RTN","RORHL071")
0^57^B16088753
"RTN","RORHL071",1,0)
RORHL071 ;HOIFO/BH - HL7 IV PHARMACY: ORC,RXE ; 1/25/06 12:22pm
"RTN","RORHL071",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL071",3,0)
 ;
"RTN","RORHL071",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL071",5,0)
 ;
"RTN","RORHL071",6,0)
 ; #2497         Read access to file #55 (controlled)
"RTN","RORHL071",7,0)
 ; #10039        Read access to file #42 (supported)
"RTN","RORHL071",8,0)
 ; #10060        Read access to file #200 (supported)
"RTN","RORHL071",9,0)
 ;
"RTN","RORHL071",10,0)
 Q
"RTN","RORHL071",11,0)
 ;
"RTN","RORHL071",12,0)
 ;***** IV PHARMACY ORC SEGMENT BUILDER
"RTN","RORHL071",13,0)
 ;
"RTN","RORHL071",14,0)
 ; RORIENS       IENS of IV in subfile #55.01
"RTN","RORHL071",15,0)
 ;
"RTN","RORHL071",16,0)
 ; .RORORC       Array with info (from OEL^PSOORRL)
"RTN","RORHL071",17,0)
 ;
"RTN","RORHL071",18,0)
 ; Return Values:
"RTN","RORHL071",19,0)
 ;       <0  Error Code
"RTN","RORHL071",20,0)
 ;        0  Ok
"RTN","RORHL071",21,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL071",22,0)
 ;
"RTN","RORHL071",23,0)
ORC(RORIENS,RORORC) ;
"RTN","RORHL071",24,0)
 N BUF,CS,ERRCNT,IEN42,IEN44,RC,RORMSG,RORSEG,TMP
"RTN","RORHL071",25,0)
 S (ERRCNT,RC)=0
"RTN","RORHL071",26,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL071",27,0)
 ;--- Check the parameters
"RTN","RORHL071",28,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL071",29,0)
 ;
"RTN","RORHL071",30,0)
 ;--- Initialize the segment
"RTN","RORHL071",31,0)
 S RORSEG(0)="ORC"
"RTN","RORHL071",32,0)
 ;
"RTN","RORHL071",33,0)
 ;--- ORC-1 - Order Control 
"RTN","RORHL071",34,0)
 S RORSEG(1)="NW"
"RTN","RORHL071",35,0)
 ;
"RTN","RORHL071",36,0)
 ;--- ORC-2 - Placer Order Number
"RTN","RORHL071",37,0)
 S TMP=$$GET1^DIQ(55.01,RORIENS,.01,,,"RORMSG")
"RTN","RORHL071",38,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,55.01,RORIENS)
"RTN","RORHL071",39,0)
 S RORSEG(2)=RORDFN_"V"_TMP_CS_"IP"
"RTN","RORHL071",40,0)
 ;
"RTN","RORHL071",41,0)
 ;--- ORC-12 - Provider
"RTN","RORHL071",42,0)
 S BUF=+$P($G(RORORC("P",0)),U)
"RTN","RORHL071",43,0)
 I BUF>0  D
"RTN","RORHL071",44,0)
 . S $P(BUF,CS,13)=$$GET1^DIQ(200,+BUF_",",53.5,"E",,"RORMSG")
"RTN","RORHL071",45,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL071",46,0)
 . . D DBS^RORERR("RORMSG",-99,,,200,+BUF_",")
"RTN","RORHL071",47,0)
 . S RORSEG(12)=BUF
"RTN","RORHL071",48,0)
 ;
"RTN","RORHL071",49,0)
 ;--- ORC-15 - Order Date/Time
"RTN","RORHL071",50,0)
 S TMP=$$FMTHL7^XLFDT($P($G(RORORC(0)),U,5))
"RTN","RORHL071",51,0)
 Q:TMP'>0 $$ERROR^RORERR(-100,,,,"No order date","OEL^PSOORRL")
"RTN","RORHL071",52,0)
 S RORSEG(15)=TMP
"RTN","RORHL071",53,0)
 ;
"RTN","RORHL071",54,0)
 ;--- ORC-16 - Control Code Reason
"RTN","RORHL071",55,0)
 S RORSEG(16)=CS_CS_CS_CS_"NEW"
"RTN","RORHL071",56,0)
 ;
"RTN","RORHL071",57,0)
 ;--- ORC-17 - Division
"RTN","RORHL071",58,0)
 S IEN42=+$$GET1^DIQ(55.01,RORIENS,9,"I",,"RORMSG")
"RTN","RORHL071",59,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL071",60,0)
 . D DBS^RORERR("RORMSG",-99,,,55.01,RORIENS)
"RTN","RORHL071",61,0)
 I IEN42>0  D
"RTN","RORHL071",62,0)
 . S IEN44=+$$GET1^DIQ(42,IEN42_",",44,"I",,"RORMSG")
"RTN","RORHL071",63,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL071",64,0)
 . . D DBS^RORERR("RORMSG",-99,,,42,IEN42_",")
"RTN","RORHL071",65,0)
 E  S IEN44=0
"RTN","RORHL071",66,0)
 S RORSEG(17)=$$DIV44^RORHLUT1(IEN44,CS)
"RTN","RORHL071",67,0)
 ;
"RTN","RORHL071",68,0)
 ;--- Store the segment
"RTN","RORHL071",69,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL071",70,0)
 Q ERRCNT
"RTN","RORHL071",71,0)
 ;
"RTN","RORHL071",72,0)
 ;***** IV PHARMACY RXE SEGMENT BUILDER
"RTN","RORHL071",73,0)
 ;
"RTN","RORHL071",74,0)
 ; RORIENS       IENS of Pharmacy Record in subfile #55.01
"RTN","RORHL071",75,0)
 ; .RORRXE       Array containing info (from OEL^PSJORRL)
"RTN","RORHL071",76,0)
 ;
"RTN","RORHL071",77,0)
 ; Return Values:
"RTN","RORHL071",78,0)
 ;       <0  Error Code
"RTN","RORHL071",79,0)
 ;        0  Ok
"RTN","RORHL071",80,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL071",81,0)
 ;
"RTN","RORHL071",82,0)
RXE(RORIENS,RORRXE) ;
"RTN","RORHL071",83,0)
 N BUF,CS,ERRCNT,IDGN,II,INDF,RC,RORMSG,RORMR,ROROUT,RORQT,RORSEG,TMP
"RTN","RORHL071",84,0)
 S (ERRCNT,RC)=0
"RTN","RORHL071",85,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL071",86,0)
 ;--- Check the parameters
"RTN","RORHL071",87,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL071",88,0)
 ;
"RTN","RORHL071",89,0)
 Q:$P($G(RORRXE(0)),U)="" 0
"RTN","RORHL071",90,0)
 ;
"RTN","RORHL071",91,0)
 ;--- Load the data
"RTN","RORHL071",92,0)
 D GETS^DIQ(55.01,RORIENS,"132;.09","E","ROROUT","RORMSG")
"RTN","RORHL071",93,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL071",94,0)
 . D DBS^RORERR("RORMSG",-99,,,55.01,RORIENS)
"RTN","RORHL071",95,0)
 S RORMR=$$ESCAPE^RORHL7($G(ROROUT(55.01,RORIENS,132,"E")))
"RTN","RORHL071",96,0)
 S TMP=$G(ROROUT(55.01,RORIENS,.09,"E")),RORQT=""
"RTN","RORHL071",97,0)
 S:TMP'="" $P(RORQT,CS,8)=$$ESCAPE^RORHL7(TMP)
"RTN","RORHL071",98,0)
 ;
"RTN","RORHL071",99,0)
 S II=0
"RTN","RORHL071",100,0)
 F  S II=$O(RORRXE("DD",II)) Q:II=""  D  Q:RC<0
"RTN","RORHL071",101,0)
 . K ROROUT,RORSEG
"RTN","RORHL071",102,0)
 . ;--- Initialize the segment
"RTN","RORHL071",103,0)
 . S RORSEG(0)="RXE"
"RTN","RORHL071",104,0)
 . ;
"RTN","RORHL071",105,0)
 . ;--- RXE-1 - Quantity/Timing
"RTN","RORHL071",106,0)
 . S RORSEG(1)=RORQT
"RTN","RORHL071",107,0)
 . ;
"RTN","RORHL071",108,0)
 . ;--- RXE-2 - Give Code
"RTN","RORHL071",109,0)
 . S IDGN=+$P($G(RORRXE("DD",II,0)),U)
"RTN","RORHL071",110,0)
 . S:IDGN'>0 IDGN=+$P($G(RORRXE("DD",II,0)),U,3)  Q:IDGN'>0
"RTN","RORHL071",111,0)
 . S BUF="",TMP=$$RXE2^RORHL031(IDGN,CS,.BUF,.INDF)
"RTN","RORHL071",112,0)
 . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL071",113,0)
 . Q:BUF=""
"RTN","RORHL071",114,0)
 . S RORSEG(2)=BUF
"RTN","RORHL071",115,0)
 . ;
"RTN","RORHL071",116,0)
 . ;--- RXE-3 - Give Amount (Min)
"RTN","RORHL071",117,0)
 . S RORSEG(3)=""""""
"RTN","RORHL071",118,0)
 . ;
"RTN","RORHL071",119,0)
 . ;--- RXE-5 - Give Units
"RTN","RORHL071",120,0)
 . S TMP=$$RXE5^RORHL031(+$G(INDF),CS,.BUF)
"RTN","RORHL071",121,0)
 . S:TMP ERRCNT=ERRCNT+1
"RTN","RORHL071",122,0)
 . S:BUF'="" RORSEG(5)=BUF
"RTN","RORHL071",123,0)
 . ;
"RTN","RORHL071",124,0)
 . ;--- RXE-18 - Stop Date/Time
"RTN","RORHL071",125,0)
 . S TMP=$P($G(RORRXE(0)),U,3)
"RTN","RORHL071",126,0)
 . S RORSEG(18)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL071",127,0)
 . ;
"RTN","RORHL071",128,0)
 . ;--- RXE-21 - Medication Route
"RTN","RORHL071",129,0)
 . S:RORMR'="" RORSEG(21)=RORMR
"RTN","RORHL071",130,0)
 . ;
"RTN","RORHL071",131,0)
 . ;--- RXE-24 - Units per dose
"RTN","RORHL071",132,0)
 . S TMP=$P($G(RORRXE("DD",II,0)),U,2)
"RTN","RORHL071",133,0)
 . S:TMP'="" RORSEG(24)=+TMP
"RTN","RORHL071",134,0)
 . ;
"RTN","RORHL071",135,0)
 . ;--- Store the segment
"RTN","RORHL071",136,0)
 . D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL071",137,0)
 ;
"RTN","RORHL071",138,0)
 Q ERRCNT
"RTN","RORHL08")
0^58^B41390061
"RTN","RORHL08",1,0)
RORHL08 ;HOIFO/BH - HL7 INPATIENT DATA: PV1,OBR ; 10/27/05 8:57am
"RTN","RORHL08",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL08",3,0)
 ;
"RTN","RORHL08",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL08",5,0)
 ;
"RTN","RORHL08",6,0)
 ; #92           Read access to the PTF file (controlled)
"RTN","RORHL08",7,0)
 ; #???          Read access to the PTF CLOSE OUT file (???)
"RTN","RORHL08",8,0)
 ;
"RTN","RORHL08",9,0)
 Q
"RTN","RORHL08",10,0)
 ;
"RTN","RORHL08",11,0)
 ;***** INPATIENT DATA SEGMENT BUILDER
"RTN","RORHL08",12,0)
 ;
"RTN","RORHL08",13,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL08",14,0)
 ;
"RTN","RORHL08",15,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL08",16,0)
 ;               data extraction time frames are stored.
"RTN","RORHL08",17,0)
 ;
"RTN","RORHL08",18,0)
 ; RORTY         Set to either "PV1" or "OBR"
"RTN","RORHL08",19,0)
 ;
"RTN","RORHL08",20,0)
 ; The ^TMP("RORHL08",$J) global node is used by this function.
"RTN","RORHL08",21,0)
 ;
"RTN","RORHL08",22,0)
 ; Return Values:
"RTN","RORHL08",23,0)
 ;       <0  Error Code
"RTN","RORHL08",24,0)
 ;        0  Ok
"RTN","RORHL08",25,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL08",26,0)
 ;
"RTN","RORHL08",27,0)
EN1(RORDFN,DXDTS,RORTY) ;
"RTN","RORHL08",28,0)
 N ERRCNT,IENS,INIEN,PV1CNT,RC,RORMSG,TMP
"RTN","RORHL08",29,0)
 S (ERRCNT,RC)=0
"RTN","RORHL08",30,0)
 ;
"RTN","RORHL08",31,0)
 ;--- PV1 Segments
"RTN","RORHL08",32,0)
 I RORTY="PV1"  K ^TMP("RORHL08",$J)  D
"RTN","RORHL08",33,0)
 . N DATE,ENDT,IDX,STDT,TYPE,XREF
"RTN","RORHL08",34,0)
 . S XREF=$NA(^TMP("RORPTF",$J,"PDI",RORDFN))
"RTN","RORHL08",35,0)
 . S (IDX,PV1CNT)=0
"RTN","RORHL08",36,0)
 . F  S IDX=$O(DXDTS(3,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL08",37,0)
 . . S STDT=$P(DXDTS(3,IDX),U),ENDT=$P(DXDTS(3,IDX),U,2)
"RTN","RORHL08",38,0)
 . . ;---
"RTN","RORHL08",39,0)
 . . S TMP=$$UPDNDX(STDT,ENDT)
"RTN","RORHL08",40,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL08",41,0)
 . . ;---
"RTN","RORHL08",42,0)
 . . S DATE=$O(@XREF@(STDT),-1)
"RTN","RORHL08",43,0)
 . . F  S DATE=$O(@XREF@(DATE))  Q:'DATE!(DATE'<ENDT)  D
"RTN","RORHL08",44,0)
 . . . S INIEN=""
"RTN","RORHL08",45,0)
 . . . F  S INIEN=$O(@XREF@(DATE,INIEN))  Q:'INIEN  D
"RTN","RORHL08",46,0)
 . . . . S IENS=INIEN_","
"RTN","RORHL08",47,0)
 . . . . ;--- Skip non-PTF records
"RTN","RORHL08",48,0)
 . . . . S TYPE=$$GET1^DIQ(45,IENS,11,"I",,"RORMSG")
"RTN","RORHL08",49,0)
 . . . . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL08",50,0)
 . . . . . D DBS^RORERR("RORMSG",-9,,RORDFN,45,IENS)
"RTN","RORHL08",51,0)
 . . . . Q:TYPE'="1"
"RTN","RORHL08",52,0)
 . . . . ;--- Generate the PV1 segment
"RTN","RORHL08",53,0)
 . . . . S TMP=$$PV1(INIEN,RORDFN)
"RTN","RORHL08",54,0)
 . . . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL08",55,0)
 . . . . ;--- Reference for the corresponding OBR and OBX segments
"RTN","RORHL08",56,0)
 . . . . S:TMP'="S" PV1CNT=PV1CNT+1,^TMP("RORHL08",$J,PV1CNT)=INIEN
"RTN","RORHL08",57,0)
 ;
"RTN","RORHL08",58,0)
 ;--- OBR and OBX Segments
"RTN","RORHL08",59,0)
 I RORTY="OBR"  D  K ^TMP("RORHL08",$J)
"RTN","RORHL08",60,0)
 . S PV1CNT=0
"RTN","RORHL08",61,0)
 . F  S PV1CNT=$O(^TMP("RORHL08",$J,PV1CNT))  Q:PV1CNT'>0  D
"RTN","RORHL08",62,0)
 . . S INIEN=+$G(^TMP("RORHL08",$J,PV1CNT))  Q:INIEN'>0
"RTN","RORHL08",63,0)
 . . ;---
"RTN","RORHL08",64,0)
 . . S TMP=$$OBR(INIEN,RORDFN)
"RTN","RORHL08",65,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL08",66,0)
 . . ;---
"RTN","RORHL08",67,0)
 . . S TMP=$$OBX^RORHL081(INIEN,RORDFN)
"RTN","RORHL08",68,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL08",69,0)
 ;
"RTN","RORHL08",70,0)
 ;--- Check for errors
"RTN","RORHL08",71,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL08",72,0)
 ;
"RTN","RORHL08",73,0)
 ;***** MERGES THE TIME FRAME INTO THE LIST
"RTN","RORHL08",74,0)
 ;
"RTN","RORHL08",75,0)
 ; .DXDTS        Reference to a local array where the time frames
"RTN","RORHL08",76,0)
 ;               are returned: DXDTS(StartDT)=StartDT^EndDT.
"RTN","RORHL08",77,0)
 ;
"RTN","RORHL08",78,0)
 ; STDT          Start date
"RTN","RORHL08",79,0)
 ; ENDT          End date
"RTN","RORHL08",80,0)
 ;
"RTN","RORHL08",81,0)
 ; This procedure merges the provided time frame [STDT,ENDT[ into
"RTN","RORHL08",82,0)
 ; the list stored in the ^TMP("RORPTF",$J,"DTF") global node and
"RTN","RORHL08",83,0)
 ; returns a list of time frames that should be updated into a
"RTN","RORHL08",84,0)
 ; local array defined by the DXDTS parameter.
"RTN","RORHL08",85,0)
 ;
"RTN","RORHL08",86,0)
 ; Variants of positional relationship of the existing time frames
"RTN","RORHL08",87,0)
 ; and the one that is being added to the list:
"RTN","RORHL08",88,0)
 ;
"RTN","RORHL08",89,0)
 ; (1)  +--------TMP                      +----------+
"RTN","RORHL08",90,0)
 ;                     STDT--------ENDT
"RTN","RORHL08",91,0)
 ;
"RTN","RORHL08",92,0)
 ; (2)           +--------TMP
"RTN","RORHL08",93,0)
 ;      STDT--------ENDT
"RTN","RORHL08",94,0)
 ;
"RTN","RORHL08",95,0)
 ; (3)  TMP--------+
"RTN","RORHL08",96,0)
 ;           STDT--------ENDT
"RTN","RORHL08",97,0)
 ;
"RTN","RORHL08",98,0)
 ; (4)         +--------+
"RTN","RORHL08",99,0)
 ;      STDT------------------ENDT
"RTN","RORHL08",100,0)
 ;
"RTN","RORHL08",101,0)
MERGEDTF(DXDTS,STDT,ENDT) ;
"RTN","RORHL08",102,0)
 N DATE,DXE,DXS,ENDT0,EXIT,STDT0,TMP  K DXDTS
"RTN","RORHL08",103,0)
 Q:STDT>ENDT
"RTN","RORHL08",104,0)
 S STDT0=STDT,(DXE,ENDT0)=ENDT
"RTN","RORHL08",105,0)
 ;--- Merge time frames if possible
"RTN","RORHL08",106,0)
 S DATE=$O(^TMP("RORPTF",$J,"DTF",ENDT)),EXIT=0
"RTN","RORHL08",107,0)
 F  S DATE=$O(^TMP("RORPTF",$J,"DTF",DATE),-1)  Q:DATE=""  D  Q:EXIT
"RTN","RORHL08",108,0)
 . S DXS=$P(^TMP("RORPTF",$J,"DTF",DATE),U,2)
"RTN","RORHL08",109,0)
 . I DXS<STDT  S EXIT=1  Q         ; (1)
"RTN","RORHL08",110,0)
 . S:DXS>ENDT ENDT=DXS,DFLT=0      ; (2)
"RTN","RORHL08",111,0)
 . S:DXS<DXE DXDTS(DXS)=DXS_U_DXE
"RTN","RORHL08",112,0)
 . S DXE=$P(^TMP("RORPTF",$J,"DTF",DATE),U)
"RTN","RORHL08",113,0)
 . S:DXE<STDT STDT=DXE,DFLT=0      ; (3)
"RTN","RORHL08",114,0)
 . K ^TMP("RORPTF",$J,"DTF",DATE)
"RTN","RORHL08",115,0)
 S:DXE>STDT0 DXDTS(STDT0)=STDT0_U_DXE
"RTN","RORHL08",116,0)
 ;--- Store the new time frame
"RTN","RORHL08",117,0)
 S ^TMP("RORPTF",$J,"DTF",STDT)=STDT_U_ENDT
"RTN","RORHL08",118,0)
 Q
"RTN","RORHL08",119,0)
 ;
"RTN","RORHL08",120,0)
 ;***** OBR SEGMENT BUILDER (INPATIENT)
"RTN","RORHL08",121,0)
 ;
"RTN","RORHL08",122,0)
 ; RORIEN        IEN of file #45
"RTN","RORHL08",123,0)
 ;
"RTN","RORHL08",124,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL08",125,0)
 ;
"RTN","RORHL08",126,0)
 ; Return Values:
"RTN","RORHL08",127,0)
 ;       <0  Error Code
"RTN","RORHL08",128,0)
 ;        0  Ok
"RTN","RORHL08",129,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL08",130,0)
 ;
"RTN","RORHL08",131,0)
OBR(RORIEN,RORDFN) ;
"RTN","RORHL08",132,0)
 N CS,ERRCNT,IENS,OBDT,RC,RORMSG,RORSEG,TMP
"RTN","RORHL08",133,0)
 S (ERRCNT,RC)=0
"RTN","RORHL08",134,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL08",135,0)
 ;
"RTN","RORHL08",136,0)
 ;--- Initialize the segment
"RTN","RORHL08",137,0)
 S RORSEG(0)="OBR"
"RTN","RORHL08",138,0)
 ;
"RTN","RORHL08",139,0)
 ;--- OBR-3 - Order Number (IEN in the PTF file #45)
"RTN","RORHL08",140,0)
 S RORSEG(3)=RORIEN
"RTN","RORHL08",141,0)
 ;
"RTN","RORHL08",142,0)
 ;--- OBR-4 - Universal Service ID
"RTN","RORHL08",143,0)
 S RORSEG(4)="IP"_CS_"Inpatient"_CS_"C4"
"RTN","RORHL08",144,0)
 ;
"RTN","RORHL08",145,0)
 ;--- OBR-7 -Observation Date/Time (Admission Date/Time) *KEY*
"RTN","RORHL08",146,0)
 S IENS=RORIEN_","
"RTN","RORHL08",147,0)
 S OBDT=$$GET1^DIQ(45,IENS,2,"I",,"RORMSG")
"RTN","RORHL08",148,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,RORDFN,45,IENS)
"RTN","RORHL08",149,0)
 ;---
"RTN","RORHL08",150,0)
 S OBDT=$$FMTHL7^XLFDT(OBDT)
"RTN","RORHL08",151,0)
 Q:OBDT'>0 $$ERROR^RORERR(-95,,,RORDFN,45,IENS,2)
"RTN","RORHL08",152,0)
 S RORSEG(7)=OBDT
"RTN","RORHL08",153,0)
 ;
"RTN","RORHL08",154,0)
 ;--- OBR-24 - Diagnostic Service ID
"RTN","RORHL08",155,0)
 S RORSEG(24)="PHY"
"RTN","RORHL08",156,0)
 ;
"RTN","RORHL08",157,0)
 ;--- OBR-44 - Division
"RTN","RORHL08",158,0)
 S RORSEG(44)=$$SITE^RORUTL03(CS)
"RTN","RORHL08",159,0)
 ;
"RTN","RORHL08",160,0)
 ;--- Store the segment
"RTN","RORHL08",161,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL08",162,0)
 Q ERRCNT
"RTN","RORHL08",163,0)
 ;
"RTN","RORHL08",164,0)
 ;***** PV1 SEGMENT BUILDER (INPATIENT)
"RTN","RORHL08",165,0)
 ;
"RTN","RORHL08",166,0)
 ; RORIEN        IEN of file #45
"RTN","RORHL08",167,0)
 ;
"RTN","RORHL08",168,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL08",169,0)
 ;
"RTN","RORHL08",170,0)
 ; Return Values:
"RTN","RORHL08",171,0)
 ;       <0  Error Code
"RTN","RORHL08",172,0)
 ;        0  Ok
"RTN","RORHL08",173,0)
 ;      "S"  No inpatient data
"RTN","RORHL08",174,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL08",175,0)
 ;
"RTN","RORHL08",176,0)
PV1(RORIEN,RORDFN) ;
"RTN","RORHL08",177,0)
 N BUF,CS,ERRCNT,IENS,RC,RORBUF,RORMSG,RORSEG,TMP
"RTN","RORHL08",178,0)
 S (ERRCNT,RC)=0
"RTN","RORHL08",179,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL08",180,0)
 ;
"RTN","RORHL08",181,0)
 ;--- Load the data
"RTN","RORHL08",182,0)
 S IENS=RORIEN_","
"RTN","RORHL08",183,0)
 D GETS^DIQ(45,IENS,"2;70;71;72","I","RORBUF","RORMSG")
"RTN","RORHL08",184,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL08",185,0)
 . D DBS^RORERR("RORMSG",-9,,RORDFN,45,IENS)
"RTN","RORHL08",186,0)
 ;
"RTN","RORHL08",187,0)
 ;--- Initialize the segment
"RTN","RORHL08",188,0)
 S RORSEG(0)="PV1"
"RTN","RORHL08",189,0)
 ;
"RTN","RORHL08",190,0)
 ;--- PV1-2 - Patient Class
"RTN","RORHL08",191,0)
 S RORSEG(2)="I"  ; I - Inpatient
"RTN","RORHL08",192,0)
 ;
"RTN","RORHL08",193,0)
 ;--- PV1-3 - Assigned Patient Location (Station Number)
"RTN","RORHL08",194,0)
 S TMP=$E($P($$SITE^VASITE,U,3),1,3)  ; Strip the suffix
"RTN","RORHL08",195,0)
 Q:TMP'>0 $$ERROR^RORERR(-100,,,,"No station number","$$SITE^VASITE")
"RTN","RORHL08",196,0)
 S RORSEG(3)=TMP
"RTN","RORHL08",197,0)
 ;
"RTN","RORHL08",198,0)
 ;--- PV1-6 - Prior Patient Location (Bed Section at Discharge)
"RTN","RORHL08",199,0)
 I $G(RORBUF(45,IENS,71,"I"))>0  D
"RTN","RORHL08",200,0)
 . S BUF=""
"RTN","RORHL08",201,0)
 . S $P(BUF,CS,3)=RORBUF(45,IENS,71,"I")  ; Bed Section IEN
"RTN","RORHL08",202,0)
 . S TMP=$$EXTERNAL^DILFD(45,71,,$P(BUF,CS,3),"RORMSG")
"RTN","RORHL08",203,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL08",204,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,45,IENS)
"RTN","RORHL08",205,0)
 . S $P(BUF,CS,9)=$$ESCAPE^RORHL7(TMP)    ; Bed Section Name
"RTN","RORHL08",206,0)
 . S RORSEG(6)=BUF
"RTN","RORHL08",207,0)
 ;
"RTN","RORHL08",208,0)
 ;--- PV1-19 - Visit Number (IEN in the PTF file #45) *KEY*
"RTN","RORHL08",209,0)
 S RORSEG(19)=RORIEN
"RTN","RORHL08",210,0)
 ;
"RTN","RORHL08",211,0)
 ;--- PV1-36 - Discharge Disposition
"RTN","RORHL08",212,0)
 S RORSEG(36)=$G(RORBUF(45,IENS,72,"I"))
"RTN","RORHL08",213,0)
 ;
"RTN","RORHL08",214,0)
 ;--- PV1-44 - Admit Date/Time *KEY*
"RTN","RORHL08",215,0)
 S TMP=$$FMTHL7^XLFDT($G(RORBUF(45,IENS,2,"I")))
"RTN","RORHL08",216,0)
 Q:TMP'>0 $$ERROR^RORERR(-95,,,RORDFN,45,IENS,2)
"RTN","RORHL08",217,0)
 S RORSEG(44)=TMP
"RTN","RORHL08",218,0)
 ;
"RTN","RORHL08",219,0)
 ;--- PV1-45 - Discharge Date/Time
"RTN","RORHL08",220,0)
 S RORSEG(45)=$$FM2HL^RORHL7($G(RORBUF(45,IENS,70,"I")))
"RTN","RORHL08",221,0)
 ;
"RTN","RORHL08",222,0)
 ;--- Store the segment
"RTN","RORHL08",223,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL08",224,0)
 Q ERRCNT
"RTN","RORHL08",225,0)
 ;
"RTN","RORHL08",226,0)
 ;***** UPDATES TEMPORARY PTF INDEX
"RTN","RORHL08",227,0)
 ;
"RTN","RORHL08",228,0)
 ; STDT          Start date
"RTN","RORHL08",229,0)
 ; ENDT          End date
"RTN","RORHL08",230,0)
 ;
"RTN","RORHL08",231,0)
 ; This function updates the temporary PTF index with records
"RTN","RORHL08",232,0)
 ; closed in the provided time frame.
"RTN","RORHL08",233,0)
 ;
"RTN","RORHL08",234,0)
 ; Return Values:
"RTN","RORHL08",235,0)
 ;       <0  Error Code
"RTN","RORHL08",236,0)
 ;        0  Ok
"RTN","RORHL08",237,0)
 ;
"RTN","RORHL08",238,0)
UPDNDX(STDT,ENDT) ;
"RTN","RORHL08",239,0)
 N DATE,DXDTS,IDX,IEN,PATIEN,RC,RORMSG,TMP
"RTN","RORHL08",240,0)
 ;--- Get time frames that should be processed
"RTN","RORHL08",241,0)
 D MERGEDTF(.DXDTS,STDT,ENDT)  Q:$D(DXDTS)<10 0
"RTN","RORHL08",242,0)
 ;--- Update the index
"RTN","RORHL08",243,0)
 S IDX=0
"RTN","RORHL08",244,0)
 F  S IDX=$O(DXDTS(IDX))  Q:IDX'>0  D
"RTN","RORHL08",245,0)
 . S STDT=$P(DXDTS(IDX),U),ENDT=$P(DXDTS(IDX),U,2)
"RTN","RORHL08",246,0)
 . S DATE=$O(^DGP(45.84,"AC",STDT),-1)
"RTN","RORHL08",247,0)
 . F  S DATE=$O(^DGP(45.84,"AC",DATE))  Q:'DATE!(DATE'<ENDT)  D
"RTN","RORHL08",248,0)
 . . S IEN=0
"RTN","RORHL08",249,0)
 . . F  S IEN=$O(^DGP(45.84,"AC",DATE,IEN))  Q:IEN'>0  D
"RTN","RORHL08",250,0)
 . . . ;--- Patient IEN (entries of file #45.84 are DINUM'ed)
"RTN","RORHL08",251,0)
 . . . S PATIEN=$$GET1^DIQ(45,IEN,.01,"I",,"RORMSG")
"RTN","RORHL08",252,0)
 . . . I $G(DIERR)  D DBS^RORERR("RORMSG",-99,,,45,IEN)  Q
"RTN","RORHL08",253,0)
 . . . ;--- Create index entry
"RTN","RORHL08",254,0)
 . . . S:PATIEN>0 ^TMP("RORPTF",$J,"PDI",PATIEN,DATE,IEN)=""
"RTN","RORHL08",255,0)
 ;---
"RTN","RORHL08",256,0)
 Q 0
"RTN","RORHL081")
0^59^B40675935
"RTN","RORHL081",1,0)
RORHL081 ;HOIFO/BH - HL7 INPATIENT DATA: OBX ; 10/27/05 12:32pm
"RTN","RORHL081",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL081",3,0)
 ;
"RTN","RORHL081",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL081",5,0)
 ;
"RTN","RORHL081",6,0)
 ; #92           Read access to the PTF file (Controlled)
"RTN","RORHL081",7,0)
 ;
"RTN","RORHL081",8,0)
 Q
"RTN","RORHL081",9,0)
 ;
"RTN","RORHL081",10,0)
 ;***** BED SECTION
"RTN","RORHL081",11,0)
BEDSEC(RORIEN) ;
"RTN","RORHL081",12,0)
 N DATE,ERRCNT,FLD,ICDFLST,IEN4502,IENS,IFL,NODE,OID,RORBS,RORBSED,RORBSSD,RORBUF,RORCODE,RORMSG,TMP
"RTN","RORHL081",13,0)
 S ERRCNT=0,ICDFLST="5;6;7;8;9;11;12;13;14;15"
"RTN","RORHL081",14,0)
 S OID="INBED"_RORCS_"Bedsection Diagnosis"_RORCS_"VA080"
"RTN","RORHL081",15,0)
 S NODE=$$ROOT^DILFD(45.02,","_RORIEN_",",1)
"RTN","RORHL081",16,0)
 ;---
"RTN","RORHL081",17,0)
 S DATE=$$GET1^DIQ(45,RORIEN_",",2,"I",,"RORMSG")
"RTN","RORHL081",18,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL081",19,0)
 . D DBS^RORERR("RORMSG",-99,,RORDFN,45,RORIEN_",")
"RTN","RORHL081",20,0)
 S (RORBSSD,RORBSED)=$$FM2HL^RORHL7(DATE)
"RTN","RORHL081",21,0)
 ;
"RTN","RORHL081",22,0)
 S DATE=""
"RTN","RORHL081",23,0)
 F  S DATE=$O(@NODE@("AM",DATE))  Q:DATE=""  D
"RTN","RORHL081",24,0)
 . S IEN4502=0
"RTN","RORHL081",25,0)
 . F  S IEN4502=$O(@NODE@("AM",DATE,IEN4502))  Q:IEN4502'>0  D
"RTN","RORHL081",26,0)
 . . S RORBSSD=RORBSED  K RORBUF
"RTN","RORHL081",27,0)
 . . S IENS=IEN4502_","_RORIEN_","
"RTN","RORHL081",28,0)
 . . ;--- Load the data
"RTN","RORHL081",29,0)
 . . D GETS^DIQ(45.02,IENS,"2;10;"_ICDFLST,"EI","RORBUF","RORMSG")
"RTN","RORHL081",30,0)
 . . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL081",31,0)
 . . . D DBS^RORERR("RORMSG",-99,,RORDFN,45.02,IENS)
"RTN","RORHL081",32,0)
 . . ;--- Name of the bed section
"RTN","RORHL081",33,0)
 . . S RORBS=$$ESCAPE^RORHL7($G(RORBUF(45.02,IENS,2,"E")))
"RTN","RORHL081",34,0)
 . . ;--- End date
"RTN","RORHL081",35,0)
 . . S RORBSED=$$FM2HL^RORHL7($G(RORBUF(45.02,IENS,10,"I")))
"RTN","RORHL081",36,0)
 . . ;--- ICD-9 codes
"RTN","RORHL081",37,0)
 . . S RORCODE=""
"RTN","RORHL081",38,0)
 . . F IFL=1:1  S FLD=+$P(ICDFLST,";",IFL)  Q:'FLD  D
"RTN","RORHL081",39,0)
 . . . S TMP=$G(RORBUF(45.02,IENS,FLD,"E"))
"RTN","RORHL081",40,0)
 . . . S:TMP'="" $P(RORCODE,RORRS,IFL)=TMP
"RTN","RORHL081",41,0)
 . . ;--- Store the segment (if there is at least one ICD-9 code)
"RTN","RORHL081",42,0)
 . . D:RORCODE'="" SETOBX(OID,RORCODE,RORBS,RORBSED,RORBSSD)
"RTN","RORHL081",43,0)
 ;
"RTN","RORHL081",44,0)
 Q ERRCNT
"RTN","RORHL081",45,0)
 ;
"RTN","RORHL081",46,0)
 ;***** DISCHARGE DIAGNOSIS CODES
"RTN","RORHL081",47,0)
DDIAG(RORIEN) ;
"RTN","RORHL081",48,0)
 N ERRCNT,FLD,ICDFLST,IENS,IFL,OID,RORBUF,RORDDIAG,TMP
"RTN","RORHL081",49,0)
 S ERRCNT=0,OID="INDIS"_RORCS_"Discharge Diagnosis"_RORCS_"VA080"
"RTN","RORHL081",50,0)
 S ICDFLST="79.16;79.17;79.18;79.19;79.201;79.21;79.22;79.23;79.24"
"RTN","RORHL081",51,0)
 ;--- Load the data
"RTN","RORHL081",52,0)
 S IENS=RORIEN_","
"RTN","RORHL081",53,0)
 D GETS^DIQ(45,IENS,ICDFLST,"E","RORBUF","RORMSG")
"RTN","RORHL081",54,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL081",55,0)
 . D DBS^RORERR("RORMSG",-99,,RORDFN,45,IENS)
"RTN","RORHL081",56,0)
 ;--- ICD-9 codes
"RTN","RORHL081",57,0)
 S RORDDIAG=""
"RTN","RORHL081",58,0)
 F IFL=1:1  S FLD=+$P(ICDFLST,";",IFL)  Q:'FLD  D
"RTN","RORHL081",59,0)
 . S TMP=$G(RORBUF(45,IENS,FLD,"E"))
"RTN","RORHL081",60,0)
 . S:TMP'="" $P(RORDDIAG,RORRS,IFL)=TMP
"RTN","RORHL081",61,0)
 ;--- Store the segment (if there is at least one ICD-9 code)
"RTN","RORHL081",62,0)
 D:RORDDIAG'="" SETOBX(OID,RORDDIAG)
"RTN","RORHL081",63,0)
 Q ERRCNT
"RTN","RORHL081",64,0)
 ;
"RTN","RORHL081",65,0)
 ;***** OBX SEGMENT(S) BUILDER (INPATIENT)
"RTN","RORHL081",66,0)
 ;
"RTN","RORHL081",67,0)
 ; RORIEN        IEN of file #45
"RTN","RORHL081",68,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL081",69,0)
 ;
"RTN","RORHL081",70,0)
 ; Return Values:
"RTN","RORHL081",71,0)
 ;       <0  Error Code
"RTN","RORHL081",72,0)
 ;        0  Ok
"RTN","RORHL081",73,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL081",74,0)
 ;
"RTN","RORHL081",75,0)
OBX(RORIEN,RORDFN) ;
"RTN","RORHL081",76,0)
 N ERRCNT,RC,RORCS,RORLST,RORMSG,RORRS,TMP
"RTN","RORHL081",77,0)
 S (ERRCNT,RC)=0
"RTN","RORHL081",78,0)
 D ECH^RORHL7(.RORCS,,.RORRS)
"RTN","RORHL081",79,0)
 ;
"RTN","RORHL081",80,0)
 ;--- Principal diagnosis
"RTN","RORHL081",81,0)
 S RC=$$PRIN(RORIEN)
"RTN","RORHL081",82,0)
 I RC  S ERRCNT=ERRCNT+1  Q:RC<0 RC
"RTN","RORHL081",83,0)
 ;--- Primary discharge diagnosis
"RTN","RORHL081",84,0)
 S RC=$$PDISCH(RORIEN)
"RTN","RORHL081",85,0)
 I RC  S ERRCNT=ERRCNT+1  Q:RC<0 RC
"RTN","RORHL081",86,0)
 ;--- Discharge diagnosis codes
"RTN","RORHL081",87,0)
 S RC=$$DDIAG(RORIEN)
"RTN","RORHL081",88,0)
 I RC  S ERRCNT=ERRCNT+1  Q:RC<0 RC
"RTN","RORHL081",89,0)
 ;--- Bed section
"RTN","RORHL081",90,0)
 S RC=$$BEDSEC(RORIEN)
"RTN","RORHL081",91,0)
 I RC  S ERRCNT=ERRCNT+1  Q:RC<0 RC
"RTN","RORHL081",92,0)
 ;--- Surgical procedures
"RTN","RORHL081",93,0)
 S RC=$$SURGPRO(RORIEN)
"RTN","RORHL081",94,0)
 I RC  S ERRCNT=ERRCNT+1  Q:RC<0 RC
"RTN","RORHL081",95,0)
 ;--- Other diagnoses
"RTN","RORHL081",96,0)
 S RC=$$OTRPROC(RORIEN)
"RTN","RORHL081",97,0)
 I RC  S ERRCNT=ERRCNT+1  Q:RC<0 RC
"RTN","RORHL081",98,0)
 ;
"RTN","RORHL081",99,0)
 Q ERRCNT
"RTN","RORHL081",100,0)
 ;
"RTN","RORHL081",101,0)
 ;***** OTHER DIAGNOSES
"RTN","RORHL081",102,0)
OTRPROC(RORIEN) ;
"RTN","RORHL081",103,0)
 N ERRCNT,FLD,ICDFLST,IEN4505,IENS,IFL,NODE,OID,RORBUF,RORMSG,ROROPBS,ROROPCD,ROROPDTE,TMP
"RTN","RORHL081",104,0)
 S ERRCNT=0,ICDFLST="4;5;6;7;8"
"RTN","RORHL081",105,0)
 S OID="INOTR"_RORCS_"Other Diagnosis"_RORCS_"VA080"
"RTN","RORHL081",106,0)
 S NODE=$$ROOT^DILFD(45.05,","_RORIEN_",",1)
"RTN","RORHL081",107,0)
 ;
"RTN","RORHL081",108,0)
 S IEN4505=0
"RTN","RORHL081",109,0)
 F  S IEN4505=$O(@NODE@(IEN4505))  Q:IEN4505'>0  D
"RTN","RORHL081",110,0)
 . S IENS=IEN4505_","_RORIEN_","  K RORBUF
"RTN","RORHL081",111,0)
 . ;--- Load the data
"RTN","RORHL081",112,0)
 . D GETS^DIQ(45.05,IENS,".01;1;"_ICDFLST,"EI","RORBUF","RORMSG")
"RTN","RORHL081",113,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL081",114,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,45.05,IENS)
"RTN","RORHL081",115,0)
 . ;--- Name of the facility
"RTN","RORHL081",116,0)
 . S ROROPBS=$$ESCAPE^RORHL7($G(RORBUF(45.05,IENS,1,"E")))
"RTN","RORHL081",117,0)
 . ;--- Date of the procedure
"RTN","RORHL081",118,0)
 . S ROROPDTE=$$FM2HL^RORHL7($G(RORBUF(45.05,IENS,.01,"I")))
"RTN","RORHL081",119,0)
 . ;--- ICD-9 codes
"RTN","RORHL081",120,0)
 . S ROROPCD=""
"RTN","RORHL081",121,0)
 . F IFL=1:1  S FLD=+$P(ICDFLST,";",IFL)  Q:'FLD  D
"RTN","RORHL081",122,0)
 . . S TMP=$G(RORBUF(45.05,IENS,FLD,"E"))
"RTN","RORHL081",123,0)
 . . S:TMP'="" $P(ROROPCD,RORRS,IFL)=TMP
"RTN","RORHL081",124,0)
 . ;--- Store the segment (if there is at least one ICD-9 code)
"RTN","RORHL081",125,0)
 . D:ROROPCD'="" SETOBX(OID,ROROPCD,ROROPBS,,ROROPDTE)
"RTN","RORHL081",126,0)
 ;
"RTN","RORHL081",127,0)
 Q ERRCNT
"RTN","RORHL081",128,0)
 ;
"RTN","RORHL081",129,0)
 ;***** PRIMARY DISCHARGE DIAGNOSIS
"RTN","RORHL081",130,0)
PDISCH(IEN) ;
"RTN","RORHL081",131,0)
 N ERRCNT,OID,RORDD,RORMSG,TMP
"RTN","RORHL081",132,0)
 S ERRCNT=0,OID="INPRI"_RORCS_"Primary Dis. Diagnosis"_RORCS_"VA080"
"RTN","RORHL081",133,0)
 ;--- Load the data
"RTN","RORHL081",134,0)
 S RORDD=$$GET1^DIQ(45,IEN_",",79,"E",,"RORMSG")
"RTN","RORHL081",135,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL081",136,0)
 . D DBS^RORERR("RORMSG",-99,,RORDFN,45,IEN_",")
"RTN","RORHL081",137,0)
 ;--- Store the segment
"RTN","RORHL081",138,0)
 D:RORDD'="" SETOBX(OID,RORDD)
"RTN","RORHL081",139,0)
 Q ERRCNT
"RTN","RORHL081",140,0)
 ;
"RTN","RORHL081",141,0)
 ;***** PRINCIPAL DIAGNOSIS
"RTN","RORHL081",142,0)
PRIN(IEN) ;
"RTN","RORHL081",143,0)
 N ERRCNT,OID,RORMSG,RORPDIAG,TMP
"RTN","RORHL081",144,0)
 S ERRCNT=0,OID="INAD"_RORCS_"Admitting Diagnosis"_RORCS_"VA080"
"RTN","RORHL081",145,0)
 ;--- Load the data
"RTN","RORHL081",146,0)
 S RORPDIAG=$$GET1^DIQ(45,IEN_",",80,"E",,"RORMSG")
"RTN","RORHL081",147,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL081",148,0)
 . D DBS^RORERR("RORMSG",-99,,RORDFN,45,IEN_",")
"RTN","RORHL081",149,0)
 ;--- Store the segment
"RTN","RORHL081",150,0)
 D:RORPDIAG'="" SETOBX(OID,RORPDIAG)
"RTN","RORHL081",151,0)
 Q ERRCNT
"RTN","RORHL081",152,0)
 ;
"RTN","RORHL081",153,0)
 ;***** LOW-LEVEL SEGMENT BUILDER
"RTN","RORHL081",154,0)
 ;
"RTN","RORHL081",155,0)
 ; OBX3          Observation Identifier
"RTN","RORHL081",156,0)
 ;
"RTN","RORHL081",157,0)
 ; OBX5          Observation Value
"RTN","RORHL081",158,0)
 ;
"RTN","RORHL081",159,0)
 ; [OBX6]        Bed Section
"RTN","RORHL081",160,0)
 ;
"RTN","RORHL081",161,0)
 ; [OBX12]       Bed Section End Date/Time
"RTN","RORHL081",162,0)
 ;
"RTN","RORHL081",163,0)
 ; [OBX14]       Bed Section Start Date, if OBX3 contains
"RTN","RORHL081",164,0)
 ;               "INBED^Bedsection Diagnosis";
"RTN","RORHL081",165,0)
 ;               Surgical Procedure Date, if OBX3 contains
"RTN","RORHL081",166,0)
 ;               "INSURG^Surgical Procedures";
"RTN","RORHL081",167,0)
 ;               Other Procedure Date, if OBX3 contains
"RTN","RORHL081",168,0)
 ;               "INOTR^Other Diagnosis".
"RTN","RORHL081",169,0)
 ;
"RTN","RORHL081",170,0)
SETOBX(OBX3,OBX5,OBX6,OBX12,OBX14) ;
"RTN","RORHL081",171,0)
 N RORSEG
"RTN","RORHL081",172,0)
 S RORSEG(0)="OBX"
"RTN","RORHL081",173,0)
 ;--- OBX-2 Value Type
"RTN","RORHL081",174,0)
 S RORSEG(2)="FT"
"RTN","RORHL081",175,0)
 ;--- OBX-3 Observation Identifier
"RTN","RORHL081",176,0)
 S RORSEG(3)=OBX3
"RTN","RORHL081",177,0)
 ;--- OBX-5 Observation Value
"RTN","RORHL081",178,0)
 S RORSEG(5)=OBX5
"RTN","RORHL081",179,0)
 ;--- OBX-6 Bed Section
"RTN","RORHL081",180,0)
 S:$G(OBX6)'="" RORSEG(6)=OBX6
"RTN","RORHL081",181,0)
 ;--- OBX-11 Observation Result Status
"RTN","RORHL081",182,0)
 S RORSEG(11)="F"
"RTN","RORHL081",183,0)
 ;--- OBX-12 Bed Section End Date/Time
"RTN","RORHL081",184,0)
 S:$G(OBX12)'="" RORSEG(12)=OBX12
"RTN","RORHL081",185,0)
 ;--- OBX-14 Bed Section Start Date/Time or Procedure Date
"RTN","RORHL081",186,0)
 S:$G(OBX14)'="" RORSEG(14)=OBX14
"RTN","RORHL081",187,0)
 ;--- Store the segment
"RTN","RORHL081",188,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL081",189,0)
 Q
"RTN","RORHL081",190,0)
 ;
"RTN","RORHL081",191,0)
 ;***** SURGICAL PROCEDURES
"RTN","RORHL081",192,0)
SURGPRO(RORIEN) ;
"RTN","RORHL081",193,0)
 N ERRCNT,FLD,IEN4501,IENS,IFL,NODE,OID,RORBUF,RORMSG,SDTE,SPCD,SPFLST,TMP
"RTN","RORHL081",194,0)
 S ERRCNT=0,SPFLST="8;9;10;11;12"
"RTN","RORHL081",195,0)
 S OID="INSURG"_RORCS_"Surgical Procedures"_RORCS_"VA080"
"RTN","RORHL081",196,0)
 S NODE=$$ROOT^DILFD(45.01,","_RORIEN_",",1)
"RTN","RORHL081",197,0)
 ;
"RTN","RORHL081",198,0)
 S IEN4501=0
"RTN","RORHL081",199,0)
 F  S IEN4501=$O(@NODE@(IEN4501))  Q:IEN4501'>0  D
"RTN","RORHL081",200,0)
 . S IENS=IEN4501_","_RORIEN_","  K RORBUF
"RTN","RORHL081",201,0)
 . ;--- Load the data
"RTN","RORHL081",202,0)
 . D GETS^DIQ(45.01,IENS,".01;"_SPFLST,"EI","RORBUF","RORMSG")
"RTN","RORHL081",203,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL081",204,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,45.01,IENS)
"RTN","RORHL081",205,0)
 . ;--- Date of the procedure
"RTN","RORHL081",206,0)
 . S SDTE=$$FM2HL^RORHL7($G(RORBUF(45.01,IENS,.01,"I")))
"RTN","RORHL081",207,0)
 . ;--- Procedure codes
"RTN","RORHL081",208,0)
 . S SPCD=""
"RTN","RORHL081",209,0)
 . F IFL=1:1  S FLD=+$P(SPFLST,";",IFL)  Q:'FLD  D
"RTN","RORHL081",210,0)
 . . S TMP=$G(RORBUF(45.01,IENS,FLD,"E"))
"RTN","RORHL081",211,0)
 . . S:TMP'="" $P(SPCD,RORRS,IFL)=TMP
"RTN","RORHL081",212,0)
 . ;--- Store the segment (if there is at least one code)
"RTN","RORHL081",213,0)
 . D:SPCD'="" SETOBX(OID,SPCD,,,SDTE)
"RTN","RORHL081",214,0)
 ;
"RTN","RORHL081",215,0)
 Q ERRCNT
"RTN","RORHL09")
0^60^B43916632
"RTN","RORHL09",1,0)
RORHL09 ;HOIFO/BH - HL7 OUTPATIENT DATA: PV1,OBR,OBX ; 1/23/06 2:09pm
"RTN","RORHL09",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL09",3,0)
 ;
"RTN","RORHL09",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL09",5,0)
 ;
"RTN","RORHL09",6,0)
 ; #93       Get stop code from the file #44 (controlled)
"RTN","RORHL09",7,0)
 ; #1889     Use of the ENCEVENT^PXKENC API
"RTN","RORHL09",8,0)
 ; #1995     $$CODEC^ICPTCOD (supported)
"RTN","RORHL09",9,0)
 ; #????     Read access to the 'AA' x-ref in VISIT file (#9000010)
"RTN","RORHL09",10,0)
 ; #3990     $$CODEC^ICDCODE (supported)
"RTN","RORHL09",11,0)
 ; #10060    Read access to the file #200 (supported)
"RTN","RORHL09",12,0)
 ; #????     Access to the file #40.8 (field #1)
"RTN","RORHL09",13,0)
 ;
"RTN","RORHL09",14,0)
 Q
"RTN","RORHL09",15,0)
 ;
"RTN","RORHL09",16,0)
 ;***** PROCESSES DIAGNOSIS CODES
"RTN","RORHL09",17,0)
DIAGS() ;
"RTN","RORHL09",18,0)
 N DIAG,IEN,K5,OID,REC,TMP
"RTN","RORHL09",19,0)
 S OID="OICD9"_RORCS_"Diagnosis"_RORCS_"VA080"
"RTN","RORHL09",20,0)
 S K5=""
"RTN","RORHL09",21,0)
 F  S K5=$O(^TMP("PXKENC",$J,RORIEN,"POV",K5))  Q:K5=""  D
"RTN","RORHL09",22,0)
 . S REC=^TMP("PXKENC",$J,RORIEN,"POV",K5,0)
"RTN","RORHL09",23,0)
 . S IEN=+$P(REC,U)  Q:IEN'>0
"RTN","RORHL09",24,0)
 . ;---
"RTN","RORHL09",25,0)
 . S DIAG=$$CODEC^ICDCODE(IEN)
"RTN","RORHL09",26,0)
 . D:DIAG'<0 SETOBX(OID,DIAG)
"RTN","RORHL09",27,0)
 Q 0
"RTN","RORHL09",28,0)
 ;
"RTN","RORHL09",29,0)
 ;***** OUTPATIENT DATA SEGMENT BUILDER
"RTN","RORHL09",30,0)
 ;
"RTN","RORHL09",31,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL09",32,0)
 ;
"RTN","RORHL09",33,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL09",34,0)
 ;               data extraction time frames are stored.
"RTN","RORHL09",35,0)
 ;
"RTN","RORHL09",36,0)
 ; RORTY         Set to either "PV1" or "OBR"
"RTN","RORHL09",37,0)
 ;
"RTN","RORHL09",38,0)
 ; The ^TMP("PXKENC",$J) and ^TMP("RORHL08",$J) global nodes are
"RTN","RORHL09",39,0)
 ; used by this function.
"RTN","RORHL09",40,0)
 ;
"RTN","RORHL09",41,0)
 ; Return Values:
"RTN","RORHL09",42,0)
 ;       <0  Error Code
"RTN","RORHL09",43,0)
 ;        0  Ok
"RTN","RORHL09",44,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL09",45,0)
 ;
"RTN","RORHL09",46,0)
EN1(RORDFN,DXDTS,RORTY) ;
"RTN","RORHL09",47,0)
 N ERRCNT,PIEN,PV1CNT,RC
"RTN","RORHL09",48,0)
 S (ERRCNT,RC)=0
"RTN","RORHL09",49,0)
 ;
"RTN","RORHL09",50,0)
 ;--- PV1 Segments
"RTN","RORHL09",51,0)
 I RORTY="PV1"  K ^TMP("PXKENC",$J),^TMP("RORHL09",$J)  D
"RTN","RORHL09",52,0)
 . N IDX,INVDT,ROREND
"RTN","RORHL09",53,0)
 . S (IDX,PV1CNT)=0
"RTN","RORHL09",54,0)
 . F  S IDX=$O(DXDTS(2,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL09",55,0)
 . . S INVDT=9999999-$$FMADD^XLFDT($P(DXDTS(2,IDX),U)\1,-1)
"RTN","RORHL09",56,0)
 . . S ROREND=9999999-$P(DXDTS(2,IDX),U,2)
"RTN","RORHL09",57,0)
 . . F  S INVDT=$O(^AUPNVSIT("AA",RORDFN,INVDT),-1)  Q:'INVDT!(INVDT'>ROREND)  D
"RTN","RORHL09",58,0)
 . . . S PIEN=""
"RTN","RORHL09",59,0)
 . . . F  S PIEN=$O(^AUPNVSIT("AA",RORDFN,INVDT,PIEN),-1)  Q:'PIEN  D
"RTN","RORHL09",60,0)
 . . . . S TMP=$$PV1(PIEN,RORDFN)
"RTN","RORHL09",61,0)
 . . . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL09",62,0)
 . . . . ;--- Reference for the corresponding OBR segment
"RTN","RORHL09",63,0)
 . . . . S:TMP'="S" PV1CNT=PV1CNT+1,^TMP("RORHL09",$J,PV1CNT)=PIEN
"RTN","RORHL09",64,0)
 ;
"RTN","RORHL09",65,0)
 ;--- OBR and OBX Segments
"RTN","RORHL09",66,0)
 I RORTY="OBR"  D  K ^TMP("PXKENC",$J),^TMP("RORHL09",$J)
"RTN","RORHL09",67,0)
 . S PV1CNT=0
"RTN","RORHL09",68,0)
 . F  S PV1CNT=$O(^TMP("RORHL09",$J,PV1CNT))  Q:PV1CNT'>0  D
"RTN","RORHL09",69,0)
 . . S PIEN=+$G(^TMP("RORHL09",$J,PV1CNT))  Q:PIEN'>0
"RTN","RORHL09",70,0)
 . . ;---
"RTN","RORHL09",71,0)
 . . S TMP=$$OBR(PIEN,RORDFN)
"RTN","RORHL09",72,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL09",73,0)
 . . ;---
"RTN","RORHL09",74,0)
 . . S TMP=$$OBX(PIEN,RORDFN)
"RTN","RORHL09",75,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL09",76,0)
 ;
"RTN","RORHL09",77,0)
 ;--- Check for errors
"RTN","RORHL09",78,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL09",79,0)
 ;
"RTN","RORHL09",80,0)
 ;***** OBR SEGMENT BUILDER (OUTPATIENT)
"RTN","RORHL09",81,0)
 ;
"RTN","RORHL09",82,0)
 ; RORIEN        IEN of file #9000010
"RTN","RORHL09",83,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL09",84,0)
 ;
"RTN","RORHL09",85,0)
 ; Return Values:
"RTN","RORHL09",86,0)
 ;       <0  Error Code
"RTN","RORHL09",87,0)
 ;        0  Ok
"RTN","RORHL09",88,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL09",89,0)
 ;
"RTN","RORHL09",90,0)
OBR(RORIEN,RORDFN) ;
"RTN","RORHL09",91,0)
 N CS,ERRCNT,RC,RORSEG,STN,TMP,VST0
"RTN","RORHL09",92,0)
 S (ERRCNT,RC)=0
"RTN","RORHL09",93,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL09",94,0)
 ;
"RTN","RORHL09",95,0)
 S VST0=$G(^TMP("PXKENC",$J,RORIEN,"VST",RORIEN,0))
"RTN","RORHL09",96,0)
 ;
"RTN","RORHL09",97,0)
 ;--- Initialize the segment
"RTN","RORHL09",98,0)
 S RORSEG(0)="OBR"
"RTN","RORHL09",99,0)
 ;
"RTN","RORHL09",100,0)
 ;--- OBR-3 - Order Number (IEN in the VISIT file #9000010) 
"RTN","RORHL09",101,0)
 S RORSEG(3)=RORIEN
"RTN","RORHL09",102,0)
 ;
"RTN","RORHL09",103,0)
 ;--- OBR-4 - Universal Service ID
"RTN","RORHL09",104,0)
 S RORSEG(4)="OP"_CS_"Outpatient"_CS_"C4"
"RTN","RORHL09",105,0)
 ;
"RTN","RORHL09",106,0)
 ;--- OBR-7 - Observation Date/Time (Visit Date/Time) *KEY*
"RTN","RORHL09",107,0)
 S TMP=$$FMTHL7^XLFDT($P(VST0,U))
"RTN","RORHL09",108,0)
 Q:TMP'>0 $$ERROR^RORERR(-100,,,,"No visit date","ENCEVENT^PXKENC")
"RTN","RORHL09",109,0)
 S RORSEG(7)=TMP
"RTN","RORHL09",110,0)
 ;
"RTN","RORHL09",111,0)
 ;--- OBR-24 - Diagnostic Service ID
"RTN","RORHL09",112,0)
 S RORSEG(24)="PHY"
"RTN","RORHL09",113,0)
 ;
"RTN","RORHL09",114,0)
 ;--- OBR-44 - Division
"RTN","RORHL09",115,0)
 S RORSEG(44)=$$SITE^RORUTL03(CS)
"RTN","RORHL09",116,0)
 S TMP=+$P(VST0,U,6)  ; LOC. OF ENCOUNTER (.06)
"RTN","RORHL09",117,0)
 I TMP>0  D
"RTN","RORHL09",118,0)
 . S TMP=$$NS^XUAF4(TMP),STN=$P(TMP,U,2)
"RTN","RORHL09",119,0)
 . S:STN'="" RORSEG(44)=STN_CS_$P(TMP,U)_CS_"99VA4"
"RTN","RORHL09",120,0)
 ;
"RTN","RORHL09",121,0)
 ;--- Store the segment
"RTN","RORHL09",122,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL09",123,0)
 Q ERRCNT
"RTN","RORHL09",124,0)
 ;
"RTN","RORHL09",125,0)
 ;***** OBX SEGMENT BUILDER (OUTPATIENT)
"RTN","RORHL09",126,0)
 ;
"RTN","RORHL09",127,0)
 ; RORIEN        IEN of file #9000010
"RTN","RORHL09",128,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL09",129,0)
 ;
"RTN","RORHL09",130,0)
 ; Return Values:
"RTN","RORHL09",131,0)
 ;       <0  Error Code
"RTN","RORHL09",132,0)
 ;        0  Ok
"RTN","RORHL09",133,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL09",134,0)
 ;
"RTN","RORHL09",135,0)
OBX(RORIEN,RORDFN) ;
"RTN","RORHL09",136,0)
 N ERRCNT,RC,RORCS,RORLST,RORMSG,RORSEG,TMP
"RTN","RORHL09",137,0)
 S (ERRCNT,RC)=0
"RTN","RORHL09",138,0)
 D ECH^RORHL7(.RORCS)
"RTN","RORHL09",139,0)
 ;
"RTN","RORHL09",140,0)
 ;--- Procedures
"RTN","RORHL09",141,0)
 I $D(^TMP("PXKENC",$J,RORIEN,"CPT"))>1  D  Q:RC<0 RC
"RTN","RORHL09",142,0)
 . S RC=$$PROCS()  S:RC ERRCNT=ERRCNT+1
"RTN","RORHL09",143,0)
 ;--- Diagnosis codes
"RTN","RORHL09",144,0)
 I $D(^TMP("PXKENC",$J,RORIEN,"POV"))>1  D  Q:RC<0 RC
"RTN","RORHL09",145,0)
 . S RC=$$DIAGS()  S:RC ERRCNT=ERRCNT+1
"RTN","RORHL09",146,0)
 ;
"RTN","RORHL09",147,0)
 Q ERRCNT
"RTN","RORHL09",148,0)
 ; 
"RTN","RORHL09",149,0)
 ;***** PROCESSES PROCEDURES
"RTN","RORHL09",150,0)
PROCS() ;
"RTN","RORHL09",151,0)
 N CLASS,ERRCNT,IEN,K5,OID,PROC,PRV,REC,RORMSG,TMP
"RTN","RORHL09",152,0)
 S ERRCNT=0
"RTN","RORHL09",153,0)
 S OID="OCPT"_RORCS_"Procedures"_RORCS_"VA080"
"RTN","RORHL09",154,0)
 S K5=""
"RTN","RORHL09",155,0)
 F  S K5=$O(^TMP("PXKENC",$J,RORIEN,"CPT",K5))  Q:K5=""  D
"RTN","RORHL09",156,0)
 . S REC=$G(^TMP("PXKENC",$J,RORIEN,"CPT",K5,0))
"RTN","RORHL09",157,0)
 . S IEN=+$P(REC,U)  Q:IEN'>0
"RTN","RORHL09",158,0)
 . ;---
"RTN","RORHL09",159,0)
 . S PROC=$$CODEC^ICPTCOD(IEN)
"RTN","RORHL09",160,0)
 . Q:PROC<0
"RTN","RORHL09",161,0)
 . ;---
"RTN","RORHL09",162,0)
 . S PRV=+$P($G(^TMP("PXKENC",$J,RORIEN,"CPT",K5,12)),U,4)
"RTN","RORHL09",163,0)
 . Q:PRV'>0
"RTN","RORHL09",164,0)
 . ;---
"RTN","RORHL09",165,0)
 . S $P(PRV,RORCS,13)=$$GET1^DIQ(200,PRV_",",53.5,"E",,"RORMSG")
"RTN","RORHL09",166,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL09",167,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,200,+PRV_",")
"RTN","RORHL09",168,0)
 . ;---
"RTN","RORHL09",169,0)
 . D SETOBX(OID,PROC,PRV)
"RTN","RORHL09",170,0)
 Q ERRCNT
"RTN","RORHL09",171,0)
 ;
"RTN","RORHL09",172,0)
 ;***** PV1 SEGMENT BUILDER (OUTPATIENT)
"RTN","RORHL09",173,0)
 ;
"RTN","RORHL09",174,0)
 ; RORIEN        IEN in the file #9000010
"RTN","RORHL09",175,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL09",176,0)
 ;
"RTN","RORHL09",177,0)
 ; Return Values:
"RTN","RORHL09",178,0)
 ;       <0  Error Code
"RTN","RORHL09",179,0)
 ;        0  Ok
"RTN","RORHL09",180,0)
 ;      "S"  No visit data
"RTN","RORHL09",181,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL09",182,0)
 ;
"RTN","RORHL09",183,0)
PV1(RORIEN,RORDFN) ;
"RTN","RORHL09",184,0)
 N BUF,CLASS,CS,ERRCNT,IENS,KK4,RC,REC,REP,RORCLIN,RORMSG,PRV,TMP,TMP1,VST0
"RTN","RORHL09",185,0)
 S (ERRCNT,RC)=0
"RTN","RORHL09",186,0)
 D ECH^RORHL7(.CS,,.REP)
"RTN","RORHL09",187,0)
 ;
"RTN","RORHL09",188,0)
 ;--- Get Visit Data
"RTN","RORHL09",189,0)
 D ENCEVENT^PXKENC(RORIEN,1)
"RTN","RORHL09",190,0)
 Q:$D(^TMP("PXKENC",$J,RORIEN))<10 "S"
"RTN","RORHL09",191,0)
 S VST0=$G(^TMP("PXKENC",$J,RORIEN,"VST",RORIEN,0))
"RTN","RORHL09",192,0)
 ;
"RTN","RORHL09",193,0)
 ;--- Do not send visits with the following service categories: Daily
"RTN","RORHL09",194,0)
 ;--- Hospitalization (D), Ancillary (X), Chart (C), Not Found (N),
"RTN","RORHL09",195,0)
 ;                    (E), Event Historical, Hospitalization (H).
"RTN","RORHL09",196,0)
 Q:"HEDXNC"[$P(VST0,U,7) "S"
"RTN","RORHL09",197,0)
 ;
"RTN","RORHL09",198,0)
 ;--- Initialize the segment
"RTN","RORHL09",199,0)
 S RORSEG(0)="PV1"
"RTN","RORHL09",200,0)
 ;
"RTN","RORHL09",201,0)
 ;--- PV1-2 - Patient Class
"RTN","RORHL09",202,0)
 S RORSEG(2)="O"  ; O - Outpatient
"RTN","RORHL09",203,0)
 ;
"RTN","RORHL09",204,0)
 ;--- PV1-3 - Assigned Patient Location (Station Number and Stop Code)
"RTN","RORHL09",205,0)
 S RORCLIN=+$P(VST0,U,22),BUF=""
"RTN","RORHL09",206,0)
 I RORCLIN>0  D
"RTN","RORHL09",207,0)
 . S IENS=RORCLIN_","
"RTN","RORHL09",208,0)
 . S TMP=$$GET1^DIQ(44,IENS,3.5,"I")  Q:TMP'>0
"RTN","RORHL09",209,0)
 . S BUF=$$GET1^DIQ(40.8,TMP,1)       Q:BUF=""  ; Station Number
"RTN","RORHL09",210,0)
 . S TMP=$$STOPCODE^RORUTL18(+RORCLIN)
"RTN","RORHL09",211,0)
 . S $P(BUF,CS,6)=$S(TMP>0:TMP,1:"")            ; Stop Code
"RTN","RORHL09",212,0)
 Q:$P(BUF,CS,6)="" "S"  ; Stop Code is required
"RTN","RORHL09",213,0)
 S RORSEG(3)=BUF
"RTN","RORHL09",214,0)
 ;
"RTN","RORHL09",215,0)
 ; PV1-4  - Admission Type
"RTN","RORHL09",216,0)
 S TMP=$P($G(^TMP("PXKENC",$J,RORIEN,"VST",RORIEN,150)),U,3)
"RTN","RORHL09",217,0)
 S RORSEG(4)=TMP
"RTN","RORHL09",218,0)
 ;
"RTN","RORHL09",219,0)
 ;--- PV1-7 - Attending Physician (User IEN and Provider Class Name)
"RTN","RORHL09",220,0)
 S (KK4,BUF)=""
"RTN","RORHL09",221,0)
 F  S KK4=$O(^TMP("PXKENC",$J,RORIEN,"PRV",KK4))  Q:KK4=""  D
"RTN","RORHL09",222,0)
 . S REC=$G(^TMP("PXKENC",$J,RORIEN,"PRV",KK4,0))
"RTN","RORHL09",223,0)
 . S PRV=+$P(REC,U)  Q:(PRV'>0)!($P(REC,U,4)'="P")
"RTN","RORHL09",224,0)
 . S $P(PRV,CS,13)=$$GET1^DIQ(200,PRV_",",53.5,"E",,"RORMSG")
"RTN","RORHL09",225,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL09",226,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,200,PRV_",")
"RTN","RORHL09",227,0)
 . S BUF=BUF_REP_PRV
"RTN","RORHL09",228,0)
 S RORSEG(7)=$P(BUF,REP,2,999)
"RTN","RORHL09",229,0)
 ;
"RTN","RORHL09",230,0)
 ;--- PV1-19 - Visit Number (IEN in the VISIT file #9000010) *KEY*
"RTN","RORHL09",231,0)
 S RORSEG(19)=RORIEN
"RTN","RORHL09",232,0)
 ;
"RTN","RORHL09",233,0)
 ;--- PV1-44 - Admit Date/Time (Visit Date/Time) *KEY*
"RTN","RORHL09",234,0)
 S TMP=$$FMTHL7^XLFDT($P(VST0,U))
"RTN","RORHL09",235,0)
 I TMP'>0  D  Q RC
"RTN","RORHL09",236,0)
 . S RC=$$ERROR^RORERR(-100,,,,"No admission date","ENCEVENT^PXKENC")
"RTN","RORHL09",237,0)
 S RORSEG(44)=TMP
"RTN","RORHL09",238,0)
 ;
"RTN","RORHL09",239,0)
 ;--- PV1-51 - Visit Indicator (Deleted Visit Indicator)
"RTN","RORHL09",240,0)
 S TMP=$P(VST0,U,11)
"RTN","RORHL09",241,0)
 S RORSEG(51)=$S(TMP'="":TMP,1:0)
"RTN","RORHL09",242,0)
 ;
"RTN","RORHL09",243,0)
 ;--- Store the segment
"RTN","RORHL09",244,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL09",245,0)
 Q ERRCNT
"RTN","RORHL09",246,0)
 ;
"RTN","RORHL09",247,0)
 ;***** LOW-LEVEL SEGMENT BUILDER
"RTN","RORHL09",248,0)
 ;
"RTN","RORHL09",249,0)
 ; OBX3          Observation Identifier
"RTN","RORHL09",250,0)
 ;
"RTN","RORHL09",251,0)
 ; OBX5          Observation Value
"RTN","RORHL09",252,0)
 ;
"RTN","RORHL09",253,0)
 ; [OBX16]       Procedure Provider and Provider Class Name
"RTN","RORHL09",254,0)
 ;
"RTN","RORHL09",255,0)
SETOBX(OBX3,OBX5,OBX16) ;
"RTN","RORHL09",256,0)
 N RORSEG
"RTN","RORHL09",257,0)
 S RORSEG(0)="OBX"
"RTN","RORHL09",258,0)
 ;--- OBX-2 Value Type
"RTN","RORHL09",259,0)
 S RORSEG(2)="FT"
"RTN","RORHL09",260,0)
 ;--- OBX-3 Observation Identifier
"RTN","RORHL09",261,0)
 S RORSEG(3)=OBX3
"RTN","RORHL09",262,0)
 ;--- OBX-5 Observation Value
"RTN","RORHL09",263,0)
 S RORSEG(5)=OBX5
"RTN","RORHL09",264,0)
 ;--- OBX-11 Observation Result Status
"RTN","RORHL09",265,0)
 S RORSEG(11)="F"
"RTN","RORHL09",266,0)
 ;--- OBX-16 Responsible Observer (Procedure Provider)
"RTN","RORHL09",267,0)
 S:$G(OBX16)'="" RORSEG(16)=OBX16
"RTN","RORHL09",268,0)
 ;--- Store the segment
"RTN","RORHL09",269,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL09",270,0)
 Q
"RTN","RORHL10")
0^61^B39625132
"RTN","RORHL10",1,0)
RORHL10 ;HOIFO/BH - HL7 SURGICAL PATHOLOGY DATA: OBR,OBX ; 8/25/05 11:27am
"RTN","RORHL10",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL10",3,0)
 ;
"RTN","RORHL10",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL10",5,0)
 ;
"RTN","RORHL10",6,0)
 ; #525          Read access to the multiple #63.08 (controlled)
"RTN","RORHL10",7,0)
 ; #2503         LRDFN^LR7OR1 (controlled)
"RTN","RORHL10",8,0)
 ; #4343         $$SPATH^LA7UTL03 (controlled)
"RTN","RORHL10",9,0)
 ;
"RTN","RORHL10",10,0)
 Q
"RTN","RORHL10",11,0)
 ;
"RTN","RORHL10",12,0)
 ;***** SEARCHES FOR SURGICAL PATHOLOGY DATA
"RTN","RORHL10",13,0)
 ;
"RTN","RORHL10",14,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL10",15,0)
 ;
"RTN","RORHL10",16,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL10",17,0)
 ;               data extraction time frames are stored.
"RTN","RORHL10",18,0)
 ;
"RTN","RORHL10",19,0)
 ; [CDSMODE]     Search the data by:
"RTN","RORHL10",20,0)
 ;                 0  completion/result date (default)
"RTN","RORHL10",21,0)
 ;                 1  specimen collection date
"RTN","RORHL10",22,0)
 ;
"RTN","RORHL10",23,0)
 ; Return Values:
"RTN","RORHL10",24,0)
 ;       <0  Error code
"RTN","RORHL10",25,0)
 ;        0  Ok
"RTN","RORHL10",26,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL10",27,0)
 ;
"RTN","RORHL10",28,0)
EN1(RORDFN,DXDTS,CDSMODE) ;
"RTN","RORHL10",29,0)
 N ERRCNT,IDX,LRDFN,RC,RORENDT,RORSTDT
"RTN","RORHL10",30,0)
 S (ERRCNT,RC)=0
"RTN","RORHL10",31,0)
 ;
"RTN","RORHL10",32,0)
 S LRDFN=+$$LABREF^RORUTL18(RORDFN)  Q:LRDFN'>0 0
"RTN","RORHL10",33,0)
 ;
"RTN","RORHL10",34,0)
 S IDX=0
"RTN","RORHL10",35,0)
 F  S IDX=$O(DXDTS(9,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL10",36,0)
 . S RORSTDT=$P(DXDTS(9,IDX),U),RORENDT=$P(DXDTS(9,IDX),U,2)
"RTN","RORHL10",37,0)
 . ;---
"RTN","RORHL10",38,0)
 . S RC=$S($G(CDSMODE):$$CD(),1:$$RAD())
"RTN","RORHL10",39,0)
 . S:RC>0 ERRCNT=ERRCNT+RC
"RTN","RORHL10",40,0)
 ;
"RTN","RORHL10",41,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL10",42,0)
 ;
"RTN","RORHL10",43,0)
 ;***** SEARCHES BY SPECIMEN COLLECTION DATE
"RTN","RORHL10",44,0)
CD() ;
"RTN","RORHL10",45,0)
 N ENDT,ERRCNT,IDT,STDT
"RTN","RORHL10",46,0)
 S ERRCNT=0
"RTN","RORHL10",47,0)
 S STDT=9999999-RORSTDT
"RTN","RORHL10",48,0)
 S ENDT=9999999-RORENDT
"RTN","RORHL10",49,0)
 ;---
"RTN","RORHL10",50,0)
 S IDT=$O(^LR(LRDFN,"SP",STDT))
"RTN","RORHL10",51,0)
 F  S IDT=$O(^LR(LRDFN,"SP",IDT),-1)  Q:'IDT!(IDT'>ENDT)  D
"RTN","RORHL10",52,0)
 . S:$$OBROBX(IDT,LRDFN) ERRCNT=ERRCNT+1
"RTN","RORHL10",53,0)
 Q ERRCNT
"RTN","RORHL10",54,0)
 ;
"RTN","RORHL10",55,0)
 ;***** SEARCHES BY COMPLETION (RESULT) DATE
"RTN","RORHL10",56,0)
RAD() ;
"RTN","RORHL10",57,0)
 N ERRCNT,IDT,RCDT
"RTN","RORHL10",58,0)
 S ERRCNT=0
"RTN","RORHL10",59,0)
 ;---
"RTN","RORHL10",60,0)
 S IDT=0
"RTN","RORHL10",61,0)
 F  S IDT=$O(^LR(LRDFN,"SP",IDT))  Q:IDT'>0  D
"RTN","RORHL10",62,0)
 . S RCDT=$P($G(^LR(LRDFN,"SP",IDT,0)),U,3)
"RTN","RORHL10",63,0)
 . I RCDT'<RORSTDT,RCDT<RORENDT  S:$$OBROBX(IDT,LRDFN) ERRCNT=ERRCNT+1
"RTN","RORHL10",64,0)
 Q ERRCNT
"RTN","RORHL10",65,0)
 ; 
"RTN","RORHL10",66,0)
 ;***** CREATES OBR AND OBX SEGMENTS
"RTN","RORHL10",67,0)
OBROBX(RORIDT,LRDFN) ;
"RTN","RORHL10",68,0)
 N ERRCNT,RC
"RTN","RORHL10",69,0)
 S ERRCNT=0
"RTN","RORHL10",70,0)
 ;---
"RTN","RORHL10",71,0)
 S RC=$$OBR(RORIDT_","_LRDFN_",")
"RTN","RORHL10",72,0)
 I RC  S ERRCNT=ERRCNT+1  Q:RC<0 RC
"RTN","RORHL10",73,0)
 ;---
"RTN","RORHL10",74,0)
 S RC=$$OBX(LRDFN,RORIDT)
"RTN","RORHL10",75,0)
 I RC  S ERRCNT=ERRCNT+1  Q:RC<0 RC
"RTN","RORHL10",76,0)
 ;---
"RTN","RORHL10",77,0)
 Q ERRCNT
"RTN","RORHL10",78,0)
 ;
"RTN","RORHL10",79,0)
 ;***** OBR SEGMENT BUILDER
"RTN","RORHL10",80,0)
 ;
"RTN","RORHL10",81,0)
 ; RORIENS       IENS of SP Entry
"RTN","RORHL10",82,0)
 ;
"RTN","RORHL10",83,0)
 ; Return Values:
"RTN","RORHL10",84,0)
 ;       <0  Error code
"RTN","RORHL10",85,0)
 ;        0  Ok
"RTN","RORHL10",86,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL10",87,0)
 ;
"RTN","RORHL10",88,0)
OBR(RORIENS) ;
"RTN","RORHL10",89,0)
 N CS,ERRCNT,FLDS,IEN,RC,RORMSG,ROROUT,RORSEG,TMP
"RTN","RORHL10",90,0)
 S (ERRCNT,RC)=0
"RTN","RORHL10",91,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL10",92,0)
 ;--- Check the parameters
"RTN","RORHL10",93,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL10",94,0)
 ;
"RTN","RORHL10",95,0)
 ;--- Load the data (with a temporary fix for invalid
"RTN","RORHL10",96,0)
 ;--- output transform of the .01 field - ROR*1*8)
"RTN","RORHL10",97,0)
 D GETS^DIQ(63.08,RORIENS,".01","I","ROROUT","RORMSG")
"RTN","RORHL10",98,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL10",99,0)
 . D DBS^RORERR("RORMSG",-9,,,63.08,RORIENS)
"RTN","RORHL10",100,0)
 D GETS^DIQ(63.08,RORIENS,".03;.06;.07;.08","IE","ROROUT","RORMSG")
"RTN","RORHL10",101,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL10",102,0)
 . D DBS^RORERR("RORMSG",-9,,,63.08,RORIENS)
"RTN","RORHL10",103,0)
 ;
"RTN","RORHL10",104,0)
 ;--- Initialize the segment
"RTN","RORHL10",105,0)
 S RORSEG(0)="OBR"
"RTN","RORHL10",106,0)
 ;
"RTN","RORHL10",107,0)
 ;--- OBR-3 - Surgical Pathology Acc #
"RTN","RORHL10",108,0)
 I $G(ROROUT(63.08,RORIENS,.06,"E"))=""  D  Q RC
"RTN","RORHL10",109,0)
 . S RC=$$ERROR^RORERR(-95,,,,63.08,RORIENS,.06)
"RTN","RORHL10",110,0)
 S RORSEG(3)=ROROUT(63.08,RORIENS,.06,"E")
"RTN","RORHL10",111,0)
 ;
"RTN","RORHL10",112,0)
 ;--- OBR-4 - SP CPT Code
"RTN","RORHL10",113,0)
 S RORSEG(4)="88300"_CS_"LEVEL I - SURGICAL PAT"_CS_"C4"
"RTN","RORHL10",114,0)
 ;
"RTN","RORHL10",115,0)
 ;--- OBR-7 - Date/Time Specimen Taken
"RTN","RORHL10",116,0)
 S TMP=$$FMTHL7^XLFDT($G(ROROUT(63.08,RORIENS,.01,"I")))
"RTN","RORHL10",117,0)
 Q:TMP'>0 $$ERROR^RORERR(-95,,,,63.08,RORIENS,.01)
"RTN","RORHL10",118,0)
 S RORSEG(7)=TMP
"RTN","RORHL10",119,0)
 ;
"RTN","RORHL10",120,0)
 ;--- OBR-8 - Date Report Completed
"RTN","RORHL10",121,0)
 S TMP=$G(ROROUT(63.08,RORIENS,.03,"I"))
"RTN","RORHL10",122,0)
 S RORSEG(8)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL10",123,0)
 ;
"RTN","RORHL10",124,0)
 ;--- OBR-16 - Surgeon/Physican
"RTN","RORHL10",125,0)
 S RORSEG(16)=$G(ROROUT(63.08,RORIENS,.07,"I"))
"RTN","RORHL10",126,0)
 ;
"RTN","RORHL10",127,0)
 ;--- OBR-24 - Service Section ID
"RTN","RORHL10",128,0)
 S RORSEG(24)="SP"
"RTN","RORHL10",129,0)
 ;
"RTN","RORHL10",130,0)
 ; OBR-44 - Divsion
"RTN","RORHL10",131,0)
 S TMP=$G(ROROUT(63.08,RORIENS,.08,"I"))
"RTN","RORHL10",132,0)
 S IEN=$S(TMP'="":+$O(^SC("B",TMP,0)),1:0)
"RTN","RORHL10",133,0)
 S RORSEG(44)=$$DIV44^RORHLUT1(IEN,CS)
"RTN","RORHL10",134,0)
 ;
"RTN","RORHL10",135,0)
 ;--- Store the segment
"RTN","RORHL10",136,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL10",137,0)
 Q ERRCNT
"RTN","RORHL10",138,0)
 ;
"RTN","RORHL10",139,0)
 ;***** OBX SEGMENT BUILDER
"RTN","RORHL10",140,0)
 ;
"RTN","RORHL10",141,0)
 ; LRDFN         Patient Lab DFN
"RTN","RORHL10",142,0)
 ; RORIENS       IENS of SP Entry
"RTN","RORHL10",143,0)
 ;
"RTN","RORHL10",144,0)
 ; Return Values:
"RTN","RORHL10",145,0)
 ;       <0  Error code
"RTN","RORHL10",146,0)
 ;        0  Ok
"RTN","RORHL10",147,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL10",148,0)
 ;
"RTN","RORHL10",149,0)
OBX(LRDFN,RORIENS) ;
"RTN","RORHL10",150,0)
 N CS,ERRCNT,RC,RORMSG,ROROUT,RORSEG,RORTMP,RPS,TMP
"RTN","RORHL10",151,0)
 S (ERRCNT,RC)=0
"RTN","RORHL10",152,0)
 D ECH^RORHL7(.CS,,.RPS)
"RTN","RORHL10",153,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORHL10",154,0)
 ;---
"RTN","RORHL10",155,0)
 I $$SPATH^LA7UTL03(LRDFN,RORIENS,RORTMP,"RORMSG")  D
"RTN","RORHL10",156,0)
 . D SPECIMEN
"RTN","RORHL10",157,0)
 . D SETOBXWP($$SEGID("BCH","Brief clinical History",CS),"CHIS")
"RTN","RORHL10",158,0)
 . D SETOBXWP($$SEGID("PDIAG","Preoperative Diagnosis",CS),"PREDX")
"RTN","RORHL10",159,0)
 . D SETOBXWP($$SEGID("OF","Operative Findings",CS),"OPERDX")
"RTN","RORHL10",160,0)
 . S TMP=$$SEGID("POPDIAG","Postoperative Diagnosis",CS)
"RTN","RORHL10",161,0)
 . D SETOBXWP(TMP,"POSTDX")
"RTN","RORHL10",162,0)
 . D SETOBXWP($$SEGID("GDESC","Gross Decription",CS),"GROSSD")
"RTN","RORHL10",163,0)
 . D SETOBXWP($$SEGID("MDESC","Microscopic Description",CS),"MICROD")
"RTN","RORHL10",164,0)
 . S TMP=$$SEGID("SPDIAG","Surgical Pathology Diagnosis",CS)
"RTN","RORHL10",165,0)
 . D SETOBXWP(TMP,"SURGP")
"RTN","RORHL10",166,0)
 . D ICD(RPS)
"RTN","RORHL10",167,0)
 E  D:$D(RORMSG)>1
"RTN","RORHL10",168,0)
 . N I,INFO  S TMP=""
"RTN","RORHL10",169,0)
 . F I=1:1  S TMP=$O(RORMSG(TMP))  Q:TMP=""  S INFO(I)=RORMSG(TMP)
"RTN","RORHL10",170,0)
 . S RC=$$ERROR^RORERR(-56,,.INFO,,0,"$$SPATH^LA7UTL03")
"RTN","RORHL10",171,0)
 ;---
"RTN","RORHL10",172,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORHL10",173,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL10",174,0)
 ;
"RTN","RORHL10",175,0)
 ;***** MAKES SPECIMEN OBX
"RTN","RORHL10",176,0)
SPECIMEN ;
"RTN","RORHL10",177,0)
 N INDEX,RORSPEC,SPECID
"RTN","RORHL10",178,0)
 S INDEX="",SPECID=$$SEGID("SPEC","Specimen",CS)
"RTN","RORHL10",179,0)
 F  S INDEX=$O(@RORTMP@("SPEC",INDEX))  Q:INDEX=""  D
"RTN","RORHL10",180,0)
 . S RORSPEC=$G(@RORTMP@("SPEC",INDEX))
"RTN","RORHL10",181,0)
 . D:RORSPEC'="" SETOBX(SPECID,RORSPEC)
"RTN","RORHL10",182,0)
 Q
"RTN","RORHL10",183,0)
 ;
"RTN","RORHL10",184,0)
 ;***** ICD-9
"RTN","RORHL10",185,0)
ICD(RPS) ;
"RTN","RORHL10",186,0)
 N CNT,ICDLST,INDEX,RORICD,TMP
"RTN","RORHL10",187,0)
 S ICDID=$$SEGID("ICD9","ICD9",CS)
"RTN","RORHL10",188,0)
 S (INDEX,RORICD)="",CNT=0
"RTN","RORHL10",189,0)
 F  S INDEX=$O(@RORTMP@("ICD9",INDEX))  Q:INDEX=""  D
"RTN","RORHL10",190,0)
 . S TMP=$G(@RORTMP@("ICD9",INDEX))
"RTN","RORHL10",191,0)
 . S:TMP'="" CNT=CNT+1,$P(RORICD,RPS,CNT)=TMP
"RTN","RORHL10",192,0)
 D:RORICD'="" SETOBX(ICDID,RORICD)
"RTN","RORHL10",193,0)
 Q
"RTN","RORHL10",194,0)
 ;
"RTN","RORHL10",195,0)
 ;***** CONSTRUCTS SEGMENT IDENTIFIER
"RTN","RORHL10",196,0)
SEGID(CODE,NAME,CS) ;
"RTN","RORHL10",197,0)
 Q CODE_CS_NAME_CS_"VA080"
"RTN","RORHL10",198,0)
 ;
"RTN","RORHL10",199,0)
 ;***** CREATE AND STORE THE OBX SEGMENTS
"RTN","RORHL10",200,0)
SETOBX(OBX3,OBX5) ;
"RTN","RORHL10",201,0)
 N RORSEG
"RTN","RORHL10",202,0)
 ;--- Initialize the segment
"RTN","RORHL10",203,0)
 S RORSEG(0)="OBX"
"RTN","RORHL10",204,0)
 ;--- OBX-2 - Value Type
"RTN","RORHL10",205,0)
 S RORSEG(2)="FT"
"RTN","RORHL10",206,0)
 ;--- OBX-3 - Observation Identifier
"RTN","RORHL10",207,0)
 S RORSEG(3)=OBX3
"RTN","RORHL10",208,0)
 ;--- OBX-5 - Observation Value
"RTN","RORHL10",209,0)
 S RORSEG(5)=$$ESCAPE^RORHL7(OBX5)
"RTN","RORHL10",210,0)
 ;--- OBX-11 - Observation Result Status
"RTN","RORHL10",211,0)
 S RORSEG(11)="F"
"RTN","RORHL10",212,0)
 ;--- Store the segment
"RTN","RORHL10",213,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL10",214,0)
 Q
"RTN","RORHL10",215,0)
 ;
"RTN","RORHL10",216,0)
SETOBXWP(OBX3,SUBS) ;
"RTN","RORHL10",217,0)
 N BR,CNT,I,I1,RORSEG,TMP
"RTN","RORHL10",218,0)
 S BR=$E(HLECH,3)_".br"_$E(HLECH,3)
"RTN","RORHL10",219,0)
 Q:$D(@RORTMP@(SUBS))<10
"RTN","RORHL10",220,0)
 ;--- Initialize the segment
"RTN","RORHL10",221,0)
 S RORSEG(0)="OBX"
"RTN","RORHL10",222,0)
 ;--- OBX-2 - Value Type
"RTN","RORHL10",223,0)
 S RORSEG(2)="FT"
"RTN","RORHL10",224,0)
 ;--- OBX-3 - Observation Identifier
"RTN","RORHL10",225,0)
 S RORSEG(3)=OBX3
"RTN","RORHL10",226,0)
 ;--- OBX-5 - Observation Value
"RTN","RORHL10",227,0)
 S I=$O(@RORTMP@(SUBS,"")),CNT=0
"RTN","RORHL10",228,0)
 F  Q:I=""  S I1=$O(@RORTMP@(SUBS,I))  D  S I=I1
"RTN","RORHL10",229,0)
 . S TMP=$$ESCAPE^RORHL7(@RORTMP@(SUBS,I))
"RTN","RORHL10",230,0)
 . S CNT=CNT+1,RORSEG(5,CNT)=$S(I1'="":TMP_BR,1:TMP)
"RTN","RORHL10",231,0)
 ;--- OBX-11 - Observation Result Status
"RTN","RORHL10",232,0)
 S RORSEG(11)="F"
"RTN","RORHL10",233,0)
 ;--- Store the segment
"RTN","RORHL10",234,0)
 D:$D(RORSEG(5)) ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL10",235,0)
 Q
"RTN","RORHL11")
0^62^B29514988
"RTN","RORHL11",1,0)
RORHL11 ;HOIFO/BH,SG - HL7 CYTOPATHOLOGY DATA: OBR,OBX ; 8/26/05 12:28pm
"RTN","RORHL11",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL11",3,0)
 ;
"RTN","RORHL11",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL11",5,0)
 ;
"RTN","RORHL11",6,0)
 ; #2503         LRDFN^LR7OR1 (controlled)
"RTN","RORHL11",7,0)
 ; #4344         $$CYPATH^LA7UTL02 (controlled)
"RTN","RORHL11",8,0)
 ;
"RTN","RORHL11",9,0)
 Q
"RTN","RORHL11",10,0)
 ;
"RTN","RORHL11",11,0)
 ;***** SEARCHES BY SPECIMEN COLLECTION DATE
"RTN","RORHL11",12,0)
CD() ;
"RTN","RORHL11",13,0)
 N ENDT,ERRCNT,IDT,STDT
"RTN","RORHL11",14,0)
 S ERRCNT=0
"RTN","RORHL11",15,0)
 S STDT=9999999-RORSTDT
"RTN","RORHL11",16,0)
 S ENDT=9999999-RORENDT
"RTN","RORHL11",17,0)
 S IDT=$O(^LR(LRDFN,"CY",STDT))
"RTN","RORHL11",18,0)
 F  S IDT=$O(^LR(LRDFN,"CY",IDT),-1)  Q:'IDT!(IDT'>ENDT)  D
"RTN","RORHL11",19,0)
 . S:$$OBROBX(IDT) ERRCNT=ERRCNT+1
"RTN","RORHL11",20,0)
 Q ERRCNT
"RTN","RORHL11",21,0)
 ;
"RTN","RORHL11",22,0)
 ;***** SEARCHES FOR CYTOPATHOLOGY DATA
"RTN","RORHL11",23,0)
 ;
"RTN","RORHL11",24,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL11",25,0)
 ;
"RTN","RORHL11",26,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL11",27,0)
 ;               data extraction time frames are stored.
"RTN","RORHL11",28,0)
 ;
"RTN","RORHL11",29,0)
 ; [CDSMODE]     Search the data by:
"RTN","RORHL11",30,0)
 ;                 0  completion/result date (default)
"RTN","RORHL11",31,0)
 ;                 1  specimen collection date
"RTN","RORHL11",32,0)
 ;
"RTN","RORHL11",33,0)
 ; Return Values:
"RTN","RORHL11",34,0)
 ;       <0  Error code
"RTN","RORHL11",35,0)
 ;        0  Ok
"RTN","RORHL11",36,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL11",37,0)
 ;
"RTN","RORHL11",38,0)
EN1(RORDFN,DXDTS,CDSMODE,RORPTR,RORFILE,HLFS,HLECH) ;
"RTN","RORHL11",39,0)
 N ERRCNT,IDX,LRDFN,RC,RORENDT,RORIEN,RORSTDT
"RTN","RORHL11",40,0)
 S (ERRCNT,RC)=0
"RTN","RORHL11",41,0)
 ;
"RTN","RORHL11",42,0)
 S LRDFN=+$$LABREF^RORUTL18(RORDFN)  Q:LRDFN'>0 0
"RTN","RORHL11",43,0)
 ;
"RTN","RORHL11",44,0)
 S IDX=0
"RTN","RORHL11",45,0)
 F  S IDX=$O(DXDTS(10,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL11",46,0)
 . S RORSTDT=$P(DXDTS(10,IDX),U),RORENDT=$P(DXDTS(10,IDX),U,2)
"RTN","RORHL11",47,0)
 . ;---
"RTN","RORHL11",48,0)
 . S RC=$S($G(CDSMODE):$$CD(),1:$$RAD())
"RTN","RORHL11",49,0)
 . S:RC>0 ERRCNT=ERRCNT+RC
"RTN","RORHL11",50,0)
 ;
"RTN","RORHL11",51,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL11",52,0)
 ;
"RTN","RORHL11",53,0)
 ;*****
"RTN","RORHL11",54,0)
ICD(RPS) ;
"RTN","RORHL11",55,0)
 Q:$D(@RORTMP@("ICD9"))<10
"RTN","RORHL11",56,0)
 N CNT,ICDLST,INDEX,RORICD,TMP
"RTN","RORHL11",57,0)
 S ICDID=$$SEGID("ICD9","ICD9",CS)
"RTN","RORHL11",58,0)
 S (INDEX,RORICD)="",CNT=0
"RTN","RORHL11",59,0)
 F  S INDEX=$O(@RORTMP@("ICD9",INDEX))  Q:INDEX=""  D
"RTN","RORHL11",60,0)
 . S TMP=$G(@RORTMP@("ICD9",INDEX))
"RTN","RORHL11",61,0)
 . S:TMP'="" CNT=CNT+1,$P(RORICD,RPS,CNT)=TMP
"RTN","RORHL11",62,0)
 D:RORICD'="" SETOBX(ICDID,RORICD)
"RTN","RORHL11",63,0)
 Q
"RTN","RORHL11",64,0)
 ;
"RTN","RORHL11",65,0)
 ;***** CREATES OBR AND OBX SEGMENTS
"RTN","RORHL11",66,0)
OBROBX(RORIDT) ;
"RTN","RORHL11",67,0)
 N ERRCNT,RC,RORMSG,RORTMP,TMP
"RTN","RORHL11",68,0)
 S (ERRCNT,RC)=0
"RTN","RORHL11",69,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORHL11",70,0)
 ;---
"RTN","RORHL11",71,0)
 I $$CYPATH^LA7UTL02(LRDFN,RORIDT,RORTMP,"RORMSG")  D
"RTN","RORHL11",72,0)
 . S RC=$$OBR(RORTMP,RORIDT)
"RTN","RORHL11",73,0)
 . I RC  S ERRCNT=ERRCNT+1  Q:RC<0
"RTN","RORHL11",74,0)
 . ;---
"RTN","RORHL11",75,0)
 . S RC=$$OBX(RORTMP)
"RTN","RORHL11",76,0)
 . I RC  S ERRCNT=ERRCNT+1  Q:RC<0
"RTN","RORHL11",77,0)
 E  D:$D(RORMSG)>1
"RTN","RORHL11",78,0)
 . N I,INFO  S TMP=""
"RTN","RORHL11",79,0)
 . F I=1:1  S TMP=$O(RORMSG(TMP))  Q:TMP=""  S INFO(I)=RORMSG(TMP)
"RTN","RORHL11",80,0)
 . S RC=$$ERROR^RORERR(-56,,.INFO,,0,"$$CYPATH^LA7UTL02")
"RTN","RORHL11",81,0)
 ;---
"RTN","RORHL11",82,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORHL11",83,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL11",84,0)
 ;
"RTN","RORHL11",85,0)
 ;***** CYTOPATHOLOGY OBR SEGMENT BUILDER
"RTN","RORHL11",86,0)
 ;
"RTN","RORHL11",87,0)
 ; RORTMP        Closed root of the array holding lab data
"RTN","RORHL11",88,0)
 ; RORIEN        IEN of Cyto Visit
"RTN","RORHL11",89,0)
 ;
"RTN","RORHL11",90,0)
 ; Return Values:
"RTN","RORHL11",91,0)
 ;       <0  Error code
"RTN","RORHL11",92,0)
 ;        0  Ok
"RTN","RORHL11",93,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL11",94,0)
 ;
"RTN","RORHL11",95,0)
OBR(RORTMP,RORIEN) ;
"RTN","RORHL11",96,0)
 N CS,CPA,ERRCNT,RC,RORSEG,TMP
"RTN","RORHL11",97,0)
 S (ERRCNT,RC)=0
"RTN","RORHL11",98,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL11",99,0)
 ;
"RTN","RORHL11",100,0)
 ;--- Initialize the segment
"RTN","RORHL11",101,0)
 S RORSEG(0)="OBR"
"RTN","RORHL11",102,0)
 ;
"RTN","RORHL11",103,0)
 ;--- OBR-3 - Cyto Path Acc #
"RTN","RORHL11",104,0)
 S CPA=$P($G(@RORTMP@("DEMO",RORIEN)),U,2)  Q:CPA="" 0
"RTN","RORHL11",105,0)
 S RORSEG(3)=CPA
"RTN","RORHL11",106,0)
 ;
"RTN","RORHL11",107,0)
 ;--- OBR-4
"RTN","RORHL11",108,0)
 S RORSEG(4)="88108"_CS_"CYTOPATHOLOGY, CONCENT"_CS_"C4"
"RTN","RORHL11",109,0)
 ;
"RTN","RORHL11",110,0)
 ;--- OBR-7 - Date/Time Specimen Taken
"RTN","RORHL11",111,0)
 S TMP=$$FMTHL7^XLFDT($P(@RORTMP@("DEMO",RORIEN),U))
"RTN","RORHL11",112,0)
 I TMP'>0  D  Q RC
"RTN","RORHL11",113,0)
 . S RC=$$ERROR^RORERR(-100,,,,"No specimen date","$$CYPATH^LA7UTL02")
"RTN","RORHL11",114,0)
 S RORSEG(7)=TMP
"RTN","RORHL11",115,0)
 ;
"RTN","RORHL11",116,0)
 ;--- OBR-24 - Service Section ID
"RTN","RORHL11",117,0)
 S RORSEG(24)="CP"
"RTN","RORHL11",118,0)
 ;
"RTN","RORHL11",119,0)
 ;--- OBR-44 - Divsion
"RTN","RORHL11",120,0)
 S RORSEG(44)=$$SITE^RORUTL03(CS)
"RTN","RORHL11",121,0)
 ;
"RTN","RORHL11",122,0)
 ;--- Store the segment
"RTN","RORHL11",123,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL11",124,0)
 Q ERRCNT
"RTN","RORHL11",125,0)
 ;
"RTN","RORHL11",126,0)
 ;***** CYTOPATHOLOGY OBX SEGMENT BUILDER
"RTN","RORHL11",127,0)
 ;
"RTN","RORHL11",128,0)
 ; RORTMP        Closed root of the array holding lab data
"RTN","RORHL11",129,0)
 ;
"RTN","RORHL11",130,0)
 ; Return Values:
"RTN","RORHL11",131,0)
 ;       <0  Error code
"RTN","RORHL11",132,0)
 ;        0  Ok
"RTN","RORHL11",133,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL11",134,0)
 ;
"RTN","RORHL11",135,0)
OBX(RORTMP) ;
"RTN","RORHL11",136,0)
 N CS,ERRCNT,RC,RPS,TMP
"RTN","RORHL11",137,0)
 S (ERRCNT,RC)=0
"RTN","RORHL11",138,0)
 D ECH^RORHL7(.CS,,.RPS)
"RTN","RORHL11",139,0)
 ;
"RTN","RORHL11",140,0)
 D:$D(@RORTMP@("SPEC")) SPECIMEN
"RTN","RORHL11",141,0)
 D SETOBXWP($$SEGID("BCH","Brief clinical History",CS),"CHIS")
"RTN","RORHL11",142,0)
 D SETOBXWP($$SEGID("PDIAG","Preoperative Diagnosis",CS),"PREDX")
"RTN","RORHL11",143,0)
 D SETOBXWP($$SEGID("OF","Operative Findings",CS),"OPERDX")
"RTN","RORHL11",144,0)
 D SETOBXWP($$SEGID("POPDIAG","Postoperative Diagnosis",CS),"POSTDX")
"RTN","RORHL11",145,0)
 D SETOBXWP($$SEGID("MICRO","Microscopic Examination",CS),"MICRO")
"RTN","RORHL11",146,0)
 D SETOBXWP($$SEGID("CDIAG","Cytopathology Diagnosis",CS),"CYTODX")
"RTN","RORHL11",147,0)
 D ICD(RPS)
"RTN","RORHL11",148,0)
 ;
"RTN","RORHL11",149,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL11",150,0)
 ;
"RTN","RORHL11",151,0)
 ;***** SEARCHES BY COMPLETION (RESULT) DATE
"RTN","RORHL11",152,0)
RAD() ;
"RTN","RORHL11",153,0)
 N ERRCNT,IDT,RCDT
"RTN","RORHL11",154,0)
 S (ERRCNT,IDT)=0
"RTN","RORHL11",155,0)
 F  S IDT=$O(^LR(LRDFN,"CY",IDT))  Q:'IDT  D
"RTN","RORHL11",156,0)
 . S RCDT=$P($G(^LR(LRDFN,"CY",IDT,0)),U,3)
"RTN","RORHL11",157,0)
 . I RCDT'<RORSTDT,RCDT<RORENDT  S:$$OBROBX(IDT) ERRCNT=ERRCNT+1
"RTN","RORHL11",158,0)
 Q ERRCNT
"RTN","RORHL11",159,0)
 ;
"RTN","RORHL11",160,0)
 ;***** CONSTRUCTS SEGMENT IDENTIFIER
"RTN","RORHL11",161,0)
SEGID(PONE,PTWO,CS) ; Create segment identifier
"RTN","RORHL11",162,0)
 Q PONE_CS_PTWO_CS_"VA080"
"RTN","RORHL11",163,0)
 ;
"RTN","RORHL11",164,0)
 ;***** CREATE AND STORE THE OBX SEGMENTS
"RTN","RORHL11",165,0)
SETOBX(OBX3,OBX5) ;
"RTN","RORHL11",166,0)
 N RORSEG
"RTN","RORHL11",167,0)
 ;--- Initialize the segment
"RTN","RORHL11",168,0)
 S RORSEG(0)="OBX"
"RTN","RORHL11",169,0)
 ;--- OBX-2
"RTN","RORHL11",170,0)
 S RORSEG(2)="FT"
"RTN","RORHL11",171,0)
 ;--- OBX-3
"RTN","RORHL11",172,0)
 S RORSEG(3)=OBX3
"RTN","RORHL11",173,0)
 ;--- OBX-5
"RTN","RORHL11",174,0)
 S RORSEG(5)=$$ESCAPE^RORHL7(OBX5)
"RTN","RORHL11",175,0)
 ;--- OBX-11
"RTN","RORHL11",176,0)
 S RORSEG(11)="F"
"RTN","RORHL11",177,0)
 ;--- Store the segment
"RTN","RORHL11",178,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL11",179,0)
 Q
"RTN","RORHL11",180,0)
 ;
"RTN","RORHL11",181,0)
SETOBXWP(OBX3,SUBS) ;
"RTN","RORHL11",182,0)
 N BR,CNT,I,I1,RORSEG,TMP
"RTN","RORHL11",183,0)
 S BR=$E(HLECH,3)_".br"_$E(HLECH,3)
"RTN","RORHL11",184,0)
 Q:$D(@RORTMP@(SUBS))<10
"RTN","RORHL11",185,0)
 ;--- Initialize the segment
"RTN","RORHL11",186,0)
 S RORSEG(0)="OBX"
"RTN","RORHL11",187,0)
 ;--- OBX-2 - Value Type
"RTN","RORHL11",188,0)
 S RORSEG(2)="FT"
"RTN","RORHL11",189,0)
 ;--- OBX-3 - Observation Identifier
"RTN","RORHL11",190,0)
 S RORSEG(3)=OBX3
"RTN","RORHL11",191,0)
 ;--- OBX-5 - Observation Value
"RTN","RORHL11",192,0)
 S I=$O(@RORTMP@(SUBS,"")),CNT=0
"RTN","RORHL11",193,0)
 F  Q:I=""  S I1=$O(@RORTMP@(SUBS,I))  D  S I=I1
"RTN","RORHL11",194,0)
 . S TMP=$$ESCAPE^RORHL7(@RORTMP@(SUBS,I))
"RTN","RORHL11",195,0)
 . S CNT=CNT+1,RORSEG(5,CNT)=$S(I1'="":TMP_BR,1:TMP)
"RTN","RORHL11",196,0)
 ;--- OBX-11 - Observation Result Status
"RTN","RORHL11",197,0)
 S RORSEG(11)="F"
"RTN","RORHL11",198,0)
 ;--- Store the segment
"RTN","RORHL11",199,0)
 D:$D(RORSEG(5)) ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL11",200,0)
 Q
"RTN","RORHL11",201,0)
 ;
"RTN","RORHL11",202,0)
 ;***** MAKES SPECIMEN OBX
"RTN","RORHL11",203,0)
SPECIMEN ;
"RTN","RORHL11",204,0)
 N INDEX,RORSPEC,SPECID
"RTN","RORHL11",205,0)
 S SPECID=$$SEGID("SPEC","Specimen",CS)
"RTN","RORHL11",206,0)
 S INDEX=""
"RTN","RORHL11",207,0)
 F  S INDEX=$O(@RORTMP@("SPEC",INDEX))  Q:INDEX=""  D
"RTN","RORHL11",208,0)
 . S RORSPEC=$G(@RORTMP@("SPEC",INDEX))
"RTN","RORHL11",209,0)
 . D:RORSPEC'="" SETOBX(SPECID,RORSPEC)
"RTN","RORHL11",210,0)
 Q
"RTN","RORHL12")
0^63^B9232656
"RTN","RORHL12",1,0)
RORHL12 ;HOIFO/BH,SG - HL7 MICROBIOLOGY DATA: OBR ; 8/25/05 4:20pm
"RTN","RORHL12",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL12",3,0)
 ;
"RTN","RORHL12",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL12",5,0)
 ;
"RTN","RORHL12",6,0)
 ; #2503         LRDFN^LR7OR1 (controlled)
"RTN","RORHL12",7,0)
 ; #4335         $$GETDATA^LA7UTL1A (controlled)
"RTN","RORHL12",8,0)
 ;
"RTN","RORHL12",9,0)
 Q
"RTN","RORHL12",10,0)
 ;
"RTN","RORHL12",11,0)
 ;***** SEARCHES FOR MICROBIOLOGY DATA
"RTN","RORHL12",12,0)
 ;
"RTN","RORHL12",13,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL12",14,0)
 ;
"RTN","RORHL12",15,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL12",16,0)
 ;               data extraction time frames are stored.
"RTN","RORHL12",17,0)
 ;
"RTN","RORHL12",18,0)
 ; [CDSMODE]     Search the data by:
"RTN","RORHL12",19,0)
 ;                 0  completion/result date (default)
"RTN","RORHL12",20,0)
 ;                 1  specimen collection date
"RTN","RORHL12",21,0)
 ;
"RTN","RORHL12",22,0)
 ; Return Values:
"RTN","RORHL12",23,0)
 ;       <0  Error code
"RTN","RORHL12",24,0)
 ;        0  Ok
"RTN","RORHL12",25,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL12",26,0)
 ;
"RTN","RORHL12",27,0)
EN1(RORDFN,DXDTS,CDSMODE) ;
"RTN","RORHL12",28,0)
 N ERRCNT,IDX,LRDFN,RC,RCL,RORENDT,RORMIIEN,RORREF,RORSTDT,RORTMP,TMP
"RTN","RORHL12",29,0)
 S (ERRCNT,RC)=0
"RTN","RORHL12",30,0)
 ;--- Check the parameters
"RTN","RORHL12",31,0)
 S CDSMODE=$S($G(CDSMODE):"CD",1:"RAD")
"RTN","RORHL12",32,0)
 ;
"RTN","RORHL12",33,0)
 S LRDFN=+$$LABREF^RORUTL18(RORDFN)  Q:LRDFN'>0 0
"RTN","RORHL12",34,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORHL12",35,0)
 ;
"RTN","RORHL12",36,0)
 S IDX=0
"RTN","RORHL12",37,0)
 F  S IDX=$O(DXDTS(11,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL12",38,0)
 . S RORSTDT=$P(DXDTS(11,IDX),U),RORENDT=$P(DXDTS(11,IDX),U,2)
"RTN","RORHL12",39,0)
 . K @RORTMP
"RTN","RORHL12",40,0)
 . ;--- Get microbiology data
"RTN","RORHL12",41,0)
 . S RCL=$$GETDATA^LA7UTL1A(LRDFN,RORSTDT,RORENDT,CDSMODE,RORTMP)
"RTN","RORHL12",42,0)
 . I RCL<0  D  Q
"RTN","RORHL12",43,0)
 . . S TMP="$$GETDATA^LA7UTL1A"
"RTN","RORHL12",44,0)
 . . S RC=$$ERROR^RORERR(-56,,$P(RCL,U,2),RORDFN,+RCL,TMP)
"RTN","RORHL12",45,0)
 . ;--- Process the data
"RTN","RORHL12",46,0)
 . S RORMIIEN=""
"RTN","RORHL12",47,0)
 . F  S RORMIIEN=$O(@RORTMP@(LRDFN,RORMIIEN))  Q:RORMIIEN=""  D
"RTN","RORHL12",48,0)
 . . S RORREF=$NA(@RORTMP@(LRDFN,RORMIIEN))
"RTN","RORHL12",49,0)
 . . ;---
"RTN","RORHL12",50,0)
 . . S TMP=$$OBR(RORREF)
"RTN","RORHL12",51,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL12",52,0)
 . . ;---
"RTN","RORHL12",53,0)
 . . S TMP=$$OBX^RORHL121(RORREF)
"RTN","RORHL12",54,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL12",55,0)
 ;
"RTN","RORHL12",56,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORHL12",57,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL12",58,0)
 ;
"RTN","RORHL12",59,0)
 ;***** MICROBIOLOGY OBR SEGMENT BUILDER
"RTN","RORHL12",60,0)
 ;
"RTN","RORHL12",61,0)
 ; RORREF        Global reference for MI entry
"RTN","RORHL12",62,0)
 ;
"RTN","RORHL12",63,0)
 ; Return Values:
"RTN","RORHL12",64,0)
 ;       <0  Error code
"RTN","RORHL12",65,0)
 ;        0  Ok
"RTN","RORHL12",66,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL12",67,0)
 ;
"RTN","RORHL12",68,0)
OBR(RORREF) ;
"RTN","RORHL12",69,0)
 N CS,ERRCNT,RC,RORSEG
"RTN","RORHL12",70,0)
 S (ERRCNT,RC)=0
"RTN","RORHL12",71,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL12",72,0)
 ;
"RTN","RORHL12",73,0)
 ;--- Initialize the segment
"RTN","RORHL12",74,0)
 S RORSEG(0)="OBR"
"RTN","RORHL12",75,0)
 ;
"RTN","RORHL12",76,0)
 ;--- OBR-3 - Accession Number
"RTN","RORHL12",77,0)
 S TMP=$G(@RORREF@(0,.06,"I"))
"RTN","RORHL12",78,0)
 I TMP=""  D  Q RC
"RTN","RORHL12",79,0)
 . S RC=$$ERROR^RORERR(-100,,,,"No accession #","$$GETDATA^LA7UTL1A")
"RTN","RORHL12",80,0)
 S RORSEG(3)=TMP
"RTN","RORHL12",81,0)
 ;
"RTN","RORHL12",82,0)
 ;--- OBR-4 - Universal Service ID
"RTN","RORHL12",83,0)
 S RORSEG(4)="87999"_CS_"MICROBIOLOGY"_CS_"C4"
"RTN","RORHL12",84,0)
 ;
"RTN","RORHL12",85,0)
 ;--- OBR-7 - Accession Date
"RTN","RORHL12",86,0)
 S TMP=$$FMTHL7^XLFDT($G(@RORREF@(0,.01,"I")))
"RTN","RORHL12",87,0)
 I TMP'>0  D  Q RC
"RTN","RORHL12",88,0)
 . S RC=$$ERROR^RORERR(-100,,,,"No accession date","$$GETDATA^LA7UTL1A")
"RTN","RORHL12",89,0)
 S RORSEG(7)=TMP
"RTN","RORHL12",90,0)
 ;
"RTN","RORHL12",91,0)
 ;--- OBR-11 - Urine Screen
"RTN","RORHL12",92,0)
 S RORSEG(11)=$G(@RORREF@(0,11.57,"I"))
"RTN","RORHL12",93,0)
 ;
"RTN","RORHL12",94,0)
 ;--- OBR-13 - Site/Specimen
"RTN","RORHL12",95,0)
 S RORSEG(13)=$$ESCAPE^RORHL7($G(@RORREF@(0,.05,"E")))
"RTN","RORHL12",96,0)
 ;
"RTN","RORHL12",97,0)
 ;--- OBR-20 - Collection Sample
"RTN","RORHL12",98,0)
 S RORSEG(20)=$$ESCAPE^RORHL7($G(@RORREF@(0,.055,"E")))
"RTN","RORHL12",99,0)
 ;
"RTN","RORHL12",100,0)
 ;--- OBR-21 - Sputum Screen
"RTN","RORHL12",101,0)
 S RORSEG(21)=$$ESCAPE^RORHL7($G(@RORREF@(0,11.58,"E")))
"RTN","RORHL12",102,0)
 ;
"RTN","RORHL12",103,0)
 ;--- OBR-24 - Diagnostic Service ID
"RTN","RORHL12",104,0)
 S RORSEG(24)="MB"
"RTN","RORHL12",105,0)
 ;
"RTN","RORHL12",106,0)
 ;--- OBR-25 - Sterility Control
"RTN","RORHL12",107,0)
 S TMP=$G(@RORREF@(0,11.51,"I"))
"RTN","RORHL12",108,0)
 S RORSEG(25)=$S(TMP="P":"F",TMP="N":"R",1:"")
"RTN","RORHL12",109,0)
 ;
"RTN","RORHL12",110,0)
 ;--- OBR-44 - Division
"RTN","RORHL12",111,0)
 S RORSEG(44)=$$SITE^RORUTL03(CS)
"RTN","RORHL12",112,0)
 ;
"RTN","RORHL12",113,0)
 ;--- Store the segment
"RTN","RORHL12",114,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL12",115,0)
 Q ERRCNT
"RTN","RORHL121")
0^64^B63479618
"RTN","RORHL121",1,0)
RORHL121 ;HOIFO/BH - HL7 MICROBIOLOGY DATA: OBX ; 8/31/05 1:16pm
"RTN","RORHL121",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL121",3,0)
 ;
"RTN","RORHL121",4,0)
 Q
"RTN","RORHL121",5,0)
 ;
"RTN","RORHL121",6,0)
FUNGUS ;***** Process Fungus/Yeast
"RTN","RORHL121",7,0)
 N FYIEN,RORFYIEN,RORFYID,RORFYCM
"RTN","RORHL121",8,0)
 ;
"RTN","RORHL121",9,0)
 S RORFYID=$$SEGID("FUNG","Fungus-Yeast",CS)
"RTN","RORHL121",10,0)
 S RORFYCM=$$SEGID("FUNGC","F-Y Comment",CS)
"RTN","RORHL121",11,0)
 S RORFYIEN=""
"RTN","RORHL121",12,0)
 F  S RORFYIEN=$O(@RORREF@(9,RORFYIEN))  Q:'RORFYIEN  D
"RTN","RORHL121",13,0)
 . S TMP=$G(@RORREF@(9,RORFYIEN,0,.01,"E"))
"RTN","RORHL121",14,0)
 . Q:TMP=""
"RTN","RORHL121",15,0)
 . D SETOBX(RORFYID,,TMP,$G(@RORREF@(9,RORFYIEN,0,1,"I")))
"RTN","RORHL121",16,0)
 . ;---
"RTN","RORHL121",17,0)
 . S FYIEN=""
"RTN","RORHL121",18,0)
 . F  S FYIEN=$O(@RORREF@(9,RORFYIEN,1,FYIEN))  Q:FYIEN=""  D
"RTN","RORHL121",19,0)
 . . S TMP=$G(@RORREF@(9,RORFYIEN,1,FYIEN,0,.01,"E"))
"RTN","RORHL121",20,0)
 . . D:TMP'="" SETOBX(RORFYCM,,TMP)
"RTN","RORHL121",21,0)
 Q
"RTN","RORHL121",22,0)
 ;
"RTN","RORHL121",23,0)
BACSP ;***** Bacteriology Smear/Prep
"RTN","RORHL121",24,0)
 ;
"RTN","RORHL121",25,0)
 N RORBSPID,RORBSP
"RTN","RORHL121",26,0)
 S RORBSPID=$$SEGID("BACT-SP","Bact Smear/Prep",CS)
"RTN","RORHL121",27,0)
 ;
"RTN","RORHL121",28,0)
 S RORBSP=""
"RTN","RORHL121",29,0)
 F  S RORBSP=$O(@RORREF@(25,RORBSP))  Q:'RORBSP  D
"RTN","RORHL121",30,0)
 . S TMP=$G(@RORREF@(25,RORBSP,0,.01,"E"))
"RTN","RORHL121",31,0)
 . D:TMP'="" SETOBX(RORBSPID,,TMP)
"RTN","RORHL121",32,0)
 Q
"RTN","RORHL121",33,0)
 ;
"RTN","RORHL121",34,0)
MYCO ;***** Mycobacterium
"RTN","RORHL121",35,0)
 N RORMYD,RORMYD1,RORDF,RORDO,RORMYIEN,RORMYID,RORMYCM,MYIEN,RORMYF,RORMYO,TMP,TMP1
"RTN","RORHL121",36,0)
 S RORMYID=$$SEGID("MYCO","Mycobacterium",CS)
"RTN","RORHL121",37,0)
 S RORMYCM=$$SEGID("MYCOC","Myco Comment",CS)
"RTN","RORHL121",38,0)
 S RORMYF=$$SEGID("MYCOAF","Myco Anti-F",CS)
"RTN","RORHL121",39,0)
 S RORMYO=$$SEGID("MYCOAO","Myco Anti-O",CS)
"RTN","RORHL121",40,0)
 ;
"RTN","RORHL121",41,0)
 S RORMYIEN=""
"RTN","RORHL121",42,0)
 F  S RORMYIEN=$O(@RORREF@(12,RORMYIEN))  Q:'RORMYIEN  D
"RTN","RORHL121",43,0)
 . S TMP=$G(@RORREF@(12,RORMYIEN,0,.01,"E"))
"RTN","RORHL121",44,0)
 . Q:TMP=""
"RTN","RORHL121",45,0)
 . D SETOBX(RORMYID,,TMP,$G(@RORREF@(12,RORMYIEN,0,1,"I")))
"RTN","RORHL121",46,0)
 . ;---
"RTN","RORHL121",47,0)
 . S MYIEN=""
"RTN","RORHL121",48,0)
 . F  S MYIEN=$O(@RORREF@(12,RORMYIEN,1,MYIEN))  Q:MYIEN=""  D
"RTN","RORHL121",49,0)
 . . S TMP=$G(@RORREF@(12,RORMYIEN,1,MYIEN,0,.01,"E"))
"RTN","RORHL121",50,0)
 . . D:TMP'="" SETOBX(RORMYCM,,TMP)
"RTN","RORHL121",51,0)
 . ;
"RTN","RORHL121",52,0)
 . S RORMYD=2
"RTN","RORHL121",53,0)
 . F  S RORMYD=$O(@RORREF@(12,RORMYIEN,0,RORMYD)) Q:'RORMYD!(RORMYD'<3)  D
"RTN","RORHL121",54,0)
 . . S TMP=$G(@RORREF@(12,RORMYIEN,0,RORMYD,"I"))  Q:TMP?."^"
"RTN","RORHL121",55,0)
 . . D SETOBX(RORMYF,$P(TMP,U),$P(TMP,U,2))
"RTN","RORHL121",56,0)
 . ;
"RTN","RORHL121",57,0)
 . S RORMYD1=4
"RTN","RORHL121",58,0)
 . F  S RORMYD1=$O(@RORREF@(12,RORMYIEN,0,RORMYD1)) Q:'RORMYD1!(RORMYD1'<56)  D
"RTN","RORHL121",59,0)
 . . S TMP=$G(@RORREF@(12,RORMYIEN,0,RORMYD1,"I"))  Q:TMP?."^"
"RTN","RORHL121",60,0)
 . . D SETOBX(RORMYO,$P(TMP,U),$P(TMP,U,2))
"RTN","RORHL121",61,0)
 Q
"RTN","RORHL121",62,0)
 ;
"RTN","RORHL121",63,0)
MYCOSP ;***** Mycology Smear Prep
"RTN","RORHL121",64,0)
 ;
"RTN","RORHL121",65,0)
 N RORMSPID,RORMSPIN
"RTN","RORHL121",66,0)
 S RORMSPID=$$SEGID("MYCO-SP","Mycology Smear/Prep",CS)
"RTN","RORHL121",67,0)
 ;
"RTN","RORHL121",68,0)
 S RORMSPIN=""
"RTN","RORHL121",69,0)
 F  S RORMSPIN=$O(@RORREF@(15,RORMSPIN))  Q:'RORMSPIN  D
"RTN","RORHL121",70,0)
 . S TMP=$G(@RORREF@(15,RORMSPIN,0,.01,"E"))
"RTN","RORHL121",71,0)
 . D:TMP'="" SETOBX(RORMSPID,,TMP)
"RTN","RORHL121",72,0)
 Q
"RTN","RORHL121",73,0)
 ;
"RTN","RORHL121",74,0)
 ;***** MICROBIOLOGY OBX SEGMENT(S) BUILDER
"RTN","RORHL121",75,0)
 ;
"RTN","RORHL121",76,0)
 ; RORREF        Global reference for MI entry
"RTN","RORHL121",77,0)
 ;
"RTN","RORHL121",78,0)
 ; Return Values:
"RTN","RORHL121",79,0)
 ;       <0  Error code
"RTN","RORHL121",80,0)
 ;        0  Ok
"RTN","RORHL121",81,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL121",82,0)
 ;
"RTN","RORHL121",83,0)
OBX(RORREF) ;
"RTN","RORHL121",84,0)
 N CS,ERRCNT,RORTBST,IEN,RC,RORID,TMP
"RTN","RORHL121",85,0)
 S (ERRCNT,RC)=0
"RTN","RORHL121",86,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL121",87,0)
 ;
"RTN","RORHL121",88,0)
 ;--- Process TB data if Final report
"RTN","RORHL121",89,0)
 S RORTBST=$G(@RORREF@(0,23,"I"))
"RTN","RORHL121",90,0)
 I RORTBST="F" D
"RTN","RORHL121",91,0)
 . N RORTBDTE,RORTBAFS,RORTBQTY
"RTN","RORHL121",92,0)
 . S RORID=$$SEGID("AFB-SP","TB Report",CS)
"RTN","RORHL121",93,0)
 . S RORTBDTE=$$FM2HL^RORHL7($G(@RORREF@(0,22,"I")))
"RTN","RORHL121",94,0)
 . S RORTBAFS=$G(@RORREF@(0,24,"I"))
"RTN","RORHL121",95,0)
 . S RORTBQTY=$G(@RORREF@(0,25,"I"))
"RTN","RORHL121",96,0)
 . D SETOBX(RORID,,RORTBST,RORTBQTY,RORTBAFS,,RORTBDTE)
"RTN","RORHL121",97,0)
 ;
"RTN","RORHL121",98,0)
 ;--- Get Bact RPT Remark Data
"RTN","RORHL121",99,0)
 S RORID=$$SEGID("BACT","Bact",CS)
"RTN","RORHL121",100,0)
 S IEN=""
"RTN","RORHL121",101,0)
 F  S IEN=$O(@RORREF@(4,IEN))  Q:'IEN  D
"RTN","RORHL121",102,0)
 . S TMP=$G(@RORREF@(4,IEN,0,.01,"E"))
"RTN","RORHL121",103,0)
 . D:TMP'="" SETOBX(RORID,,TMP)
"RTN","RORHL121",104,0)
 ;
"RTN","RORHL121",105,0)
 ;--- Get Gram Stain Data
"RTN","RORHL121",106,0)
 S RORID=$$SEGID("GRAM","Gram Stain",CS)
"RTN","RORHL121",107,0)
 S IEN=""
"RTN","RORHL121",108,0)
 F  S IEN=$O(@RORREF@(2,IEN))  Q:'IEN  D
"RTN","RORHL121",109,0)
 . S TMP=$G(@RORREF@(2,IEN,0,.01,"E"))
"RTN","RORHL121",110,0)
 . D:TMP'="" SETOBX(RORID,,TMP)
"RTN","RORHL121",111,0)
 ;
"RTN","RORHL121",112,0)
 D ORGDATA  ; Organism Data
"RTN","RORHL121",113,0)
 D PARDATA  ; Parasite Data
"RTN","RORHL121",114,0)
 D FUNGUS   ; Fungus/Yeast Data
"RTN","RORHL121",115,0)
 D MYCO     ; Mycobacterium Data
"RTN","RORHL121",116,0)
 D VIRUS    ; Virus Data
"RTN","RORHL121",117,0)
 D PARASP   ; Parasitology Smear/Prep
"RTN","RORHL121",118,0)
 D BACSP    ; Bacteriology Smear/Prep
"RTN","RORHL121",119,0)
 D MYCOSP   ; Mycology Smear Prep
"RTN","RORHL121",120,0)
 D VIRORPT  ; Virology RPT Remark
"RTN","RORHL121",121,0)
 ;
"RTN","RORHL121",122,0)
 ;--- Parasite Remark
"RTN","RORHL121",123,0)
 S RORID=$$SEGID("PARP","Parasite Remark",CS)
"RTN","RORHL121",124,0)
 S IEN=""
"RTN","RORHL121",125,0)
 F  S IEN=$O(@RORREF@(7,IEN))  Q:IEN=""  D
"RTN","RORHL121",126,0)
 . S TMP=$G(@RORREF@(7,IEN,0,.01,"E"))
"RTN","RORHL121",127,0)
 . D:TMP'="" SETOBX(RORID,,TMP)
"RTN","RORHL121",128,0)
 ;
"RTN","RORHL121",129,0)
 ;--- Specimen Comments
"RTN","RORHL121",130,0)
 S TMP=$G(@RORREF@(0,.99,"E"))
"RTN","RORHL121",131,0)
 I TMP'=""  D  D SETOBX(RORID,,TMP)
"RTN","RORHL121",132,0)
 . S RORID=$$SEGID("COMP","Specimen Comment",CS)
"RTN","RORHL121",133,0)
 ;
"RTN","RORHL121",134,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL121",135,0)
 ;
"RTN","RORHL121",136,0)
 ;***** PROCESSES ORGANISM DATA
"RTN","RORHL121",137,0)
ORGDATA ;
"RTN","RORHL121",138,0)
 N IEN,RORANTID,RORCMID,RORID,RORMBC,RORMIC,RORORIEN,RORAINX,RORAINX1,RORANTIF,RORANTIO,TMP,TMP1
"RTN","RORHL121",139,0)
 S RORID=$$SEGID("ORG","Organism",CS)
"RTN","RORHL121",140,0)
 S RORCMID=$$SEGID("ORGC","Org Comment",CS)
"RTN","RORHL121",141,0)
 S RORANTID=$$SEGID("ORGA","Org Antibiotic",CS)
"RTN","RORHL121",142,0)
 S RORANTIF=$$SEGID("ORGAF","Org Antibiotic-F",CS)
"RTN","RORHL121",143,0)
 S RORANTIO=$$SEGID("ORGAO","Org Antibiotic-O",CS)
"RTN","RORHL121",144,0)
 ;---
"RTN","RORHL121",145,0)
 S RORORIEN=""
"RTN","RORHL121",146,0)
 F  S RORORIEN=$O(@RORREF@(3,RORORIEN))  Q:'RORORIEN  D
"RTN","RORHL121",147,0)
 . S TMP=$G(@RORREF@(3,RORORIEN,0,.01,"E"))
"RTN","RORHL121",148,0)
 . Q:TMP=""
"RTN","RORHL121",149,0)
 . D SETOBX(RORID,,TMP,$G(@RORREF@(3,RORORIEN,0,1,"I")))
"RTN","RORHL121",150,0)
 . ;---
"RTN","RORHL121",151,0)
 . S RORAINX=2
"RTN","RORHL121",152,0)
 . F  S RORAINX=$O(@RORREF@(3,RORORIEN,0,RORAINX)) Q:'RORAINX!(RORAINX'<3)  D
"RTN","RORHL121",153,0)
 . . S TMP=$G(@RORREF@(3,RORORIEN,0,RORAINX,"I"))  Q:TMP?."^"
"RTN","RORHL121",154,0)
 . . D SETOBX(RORANTIF,$P(TMP,U),$P(TMP,U,2))
"RTN","RORHL121",155,0)
 . ;---
"RTN","RORHL121",156,0)
 . S RORAINX1=10
"RTN","RORHL121",157,0)
 . F  S RORAINX1=$O(@RORREF@(3,RORORIEN,0,RORAINX1)) Q:'RORAINX1!(RORAINX1'<160)  D
"RTN","RORHL121",158,0)
 . . S TMP=$G(@RORREF@(3,RORORIEN,0,RORAINX1,"I"))  Q:TMP?."^"
"RTN","RORHL121",159,0)
 . . D SETOBX(RORANTIO,$P(TMP,U),$P(TMP,U,2))
"RTN","RORHL121",160,0)
 . ;---
"RTN","RORHL121",161,0)
 . S IEN=""
"RTN","RORHL121",162,0)
 . F  S IEN=$O(@RORREF@(3,RORORIEN,1,IEN))  Q:IEN=""  D
"RTN","RORHL121",163,0)
 . . S TMP=$G(@RORREF@(3,RORORIEN,1,IEN,0,.01,"E"))
"RTN","RORHL121",164,0)
 . . D:TMP'="" SETOBX(RORCMID,,TMP)
"RTN","RORHL121",165,0)
 . ;---
"RTN","RORHL121",166,0)
 . S IEN=""
"RTN","RORHL121",167,0)
 . F  S IEN=$O(@RORREF@(3,RORORIEN,3,IEN))  Q:IEN=""  D
"RTN","RORHL121",168,0)
 . . S TMP=$G(@RORREF@(3,RORORIEN,3,IEN,0,.01,"E"))
"RTN","RORHL121",169,0)
 . . Q:TMP=""
"RTN","RORHL121",170,0)
 . . S RORMIC=$G(@RORREF@(3,RORORIEN,3,IEN,0,1,"E"))
"RTN","RORHL121",171,0)
 . . S RORMBC=$G(@RORREF@(3,RORORIEN,3,IEN,0,2,"E"))
"RTN","RORHL121",172,0)
 . . D SETOBX(RORANTID,,TMP,,RORMIC,RORMBC)
"RTN","RORHL121",173,0)
 Q
"RTN","RORHL121",174,0)
 ;
"RTN","RORHL121",175,0)
PARASP ;***** Parasitology Smear/Prep
"RTN","RORHL121",176,0)
 ;
"RTN","RORHL121",177,0)
 N RORPSPID,RORPSP
"RTN","RORHL121",178,0)
 S RORPSPID=$$SEGID("PARA-SP","Para Smear/Prep",CS)
"RTN","RORHL121",179,0)
 ;
"RTN","RORHL121",180,0)
 S RORPSP=""
"RTN","RORHL121",181,0)
 F  S RORPSP=$O(@RORREF@(24,RORPSP))  Q:'RORPSP  D
"RTN","RORHL121",182,0)
 . S TMP=$G(@RORREF@(24,RORPSP,0,.01,"E"))
"RTN","RORHL121",183,0)
 . D:TMP'="" SETOBX(RORPSPID,,TMP)
"RTN","RORHL121",184,0)
 Q
"RTN","RORHL121",185,0)
 ;
"RTN","RORHL121",186,0)
 ;***** PROCESSES PARASITE DATA
"RTN","RORHL121",187,0)
PARDATA ;
"RTN","RORHL121",188,0)
 N IEN,RORPCMID,RORPSID,RORPSIEN,RORSTID,RORSTIEN,RORSTQAN,TMP
"RTN","RORHL121",189,0)
 S RORPSID=$$SEGID("PAR","Parasite",CS)
"RTN","RORHL121",190,0)
 S RORSTID=$$SEGID("PARQ","Stage",CS)
"RTN","RORHL121",191,0)
 S RORPCMID=$$SEGID("PARC","Comment",CS)
"RTN","RORHL121",192,0)
 ;---
"RTN","RORHL121",193,0)
 S RORPSIEN=""
"RTN","RORHL121",194,0)
 F  S RORPSIEN=$O(@RORREF@(6,RORPSIEN))  Q:RORPSIEN=""  D
"RTN","RORHL121",195,0)
 . S TMP=$G(@RORREF@(6,RORPSIEN,"0",".01","E"))
"RTN","RORHL121",196,0)
 . Q:TMP=""
"RTN","RORHL121",197,0)
 . D SETOBX(RORPSID,,TMP)
"RTN","RORHL121",198,0)
 . ;---
"RTN","RORHL121",199,0)
 . S RORSTIEN=""
"RTN","RORHL121",200,0)
 . F  S RORSTIEN=$O(@RORREF@(6,RORPSIEN,1,RORSTIEN)) Q:RORSTIEN=""  D
"RTN","RORHL121",201,0)
 . . S TMP=$G(@RORREF@(6,RORPSIEN,1,RORSTIEN,0,.01,"I"))
"RTN","RORHL121",202,0)
 . . Q:TMP=""
"RTN","RORHL121",203,0)
 . . S RORSTQAN=$G(@RORREF@(6,RORPSIEN,1,RORSTIEN,0,"1","E"))
"RTN","RORHL121",204,0)
 . . D SETOBX(RORSTID,,TMP,RORSTQAN)
"RTN","RORHL121",205,0)
 . . ;---
"RTN","RORHL121",206,0)
 . . S IEN=""
"RTN","RORHL121",207,0)
 . . F  S IEN=$O(@RORREF@(6,RORPSIEN,1,RORSTIEN,1,IEN))  Q:IEN=""  D
"RTN","RORHL121",208,0)
 . . . S TMP=$G(@RORREF@(6,RORPSIEN,1,RORSTIEN,1,IEN,0,.01,"E"))
"RTN","RORHL121",209,0)
 . . . D:TMP'="" SETOBX(RORPCMID,,TMP)
"RTN","RORHL121",210,0)
 Q
"RTN","RORHL121",211,0)
 ;
"RTN","RORHL121",212,0)
 ;***** CREATES SEGMENT IDENTIFIER
"RTN","RORHL121",213,0)
SEGID(PONE,PTWO,CS) ;
"RTN","RORHL121",214,0)
 Q PONE_CS_PTWO_CS_"VA080"
"RTN","RORHL121",215,0)
 ;
"RTN","RORHL121",216,0)
 ;***** CREATES AND STORES THE OBX SEGMENT
"RTN","RORHL121",217,0)
SETOBX(OBX3,OBX4,OBX5,OBX6,OBX7,OBX13,OBX14) ;
"RTN","RORHL121",218,0)
 N RORSEG
"RTN","RORHL121",219,0)
 ;--- Initialize the segment
"RTN","RORHL121",220,0)
 S RORSEG(0)="OBX"
"RTN","RORHL121",221,0)
 ;--- OBX-2
"RTN","RORHL121",222,0)
 S RORSEG(2)="FT"
"RTN","RORHL121",223,0)
 ;--- OBX-3
"RTN","RORHL121",224,0)
 S RORSEG(3)=OBX3
"RTN","RORHL121",225,0)
 ;--- OBX-4, OBX-5, OBX-6, and OBX-7
"RTN","RORHL121",226,0)
 S:$G(OBX4)'="" RORSEG(4)=$$ESCAPE^RORHL7(OBX4)
"RTN","RORHL121",227,0)
 S:$G(OBX5)'="" RORSEG(5)=$$ESCAPE^RORHL7(OBX5)
"RTN","RORHL121",228,0)
 S:$G(OBX6)'="" RORSEG(6)=$$ESCAPE^RORHL7(OBX6)
"RTN","RORHL121",229,0)
 S:$G(OBX7)'="" RORSEG(7)=$$ESCAPE^RORHL7(OBX7)
"RTN","RORHL121",230,0)
 ;--- OBX-11
"RTN","RORHL121",231,0)
 S RORSEG(11)="F"
"RTN","RORHL121",232,0)
 ;--- OBX-13 and OBX-14
"RTN","RORHL121",233,0)
 S:$G(OBX13)'="" RORSEG(13)=$$ESCAPE^RORHL7(OBX13)
"RTN","RORHL121",234,0)
 S:$G(OBX14)'="" RORSEG(14)=OBX14
"RTN","RORHL121",235,0)
 ;--- Store the segment
"RTN","RORHL121",236,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL121",237,0)
 Q
"RTN","RORHL121",238,0)
 ;
"RTN","RORHL121",239,0)
VIRORPT ;***** Virology RPT Remark
"RTN","RORHL121",240,0)
 N RORVRID,RORVRIEN
"RTN","RORHL121",241,0)
 S RORVRID=$$SEGID("VIRUSR","Virology RPT",CS)
"RTN","RORHL121",242,0)
 ;
"RTN","RORHL121",243,0)
 S RORVRIEN=""
"RTN","RORHL121",244,0)
 F  S RORVRIEN=$O(@RORREF@(18,RORVRIEN))  Q:'RORVRIEN  D
"RTN","RORHL121",245,0)
 . S TMP=$G(@RORREF@(18,RORVRIEN,0,.01,"E"))
"RTN","RORHL121",246,0)
 . D:TMP'="" SETOBX(RORVRID,,TMP)
"RTN","RORHL121",247,0)
 Q
"RTN","RORHL121",248,0)
 ;
"RTN","RORHL121",249,0)
VIRUS ;***** Virus
"RTN","RORHL121",250,0)
 ;
"RTN","RORHL121",251,0)
 N RORVIRID,RORVIIEN
"RTN","RORHL121",252,0)
 S RORVIRID=$$SEGID("VIRUS","Virus",CS)
"RTN","RORHL121",253,0)
 ;
"RTN","RORHL121",254,0)
 S RORVIIEN=""
"RTN","RORHL121",255,0)
 F  S RORVIIEN=$O(@RORREF@(17,RORVIIEN))  Q:'RORVIIEN  D
"RTN","RORHL121",256,0)
 . S TMP=$G(@RORREF@(17,RORVIIEN,0,.01,"E"))
"RTN","RORHL121",257,0)
 . D:TMP'="" SETOBX(RORVIRID,,TMP)
"RTN","RORHL121",258,0)
 Q
"RTN","RORHL13")
0^65^B16669898
"RTN","RORHL13",1,0)
RORHL13 ;HOIFO/BH,SG - HL7 MEDICAL PROCEDURES (EKG): OBR,OBX ; 8/25/05 11:32am
"RTN","RORHL13",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL13",3,0)
 ;
"RTN","RORHL13",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL13",5,0)
 ;
"RTN","RORHL13",6,0)
 ; #3780         GET^MCARAPI (private)
"RTN","RORHL13",7,0)
 ; #3854         GET^MDAPI1 (private)
"RTN","RORHL13",8,0)
 ;
"RTN","RORHL13",9,0)
 Q
"RTN","RORHL13",10,0)
 ;
"RTN","RORHL13",11,0)
 ;***** CONVERTS THE DATE FROM EXTERNAL TO HL7 FORMAT
"RTN","RORHL13",12,0)
DATE(DATE) ;
"RTN","RORHL13",13,0)
 N RES
"RTN","RORHL13",14,0)
 D DT^DILF(,$P(DATE,"@"),.RES)
"RTN","RORHL13",15,0)
 Q $$FM2HL^RORHL7($G(RES))
"RTN","RORHL13",16,0)
 ;
"RTN","RORHL13",17,0)
 ;***** SEARCHES FOR MEDICAL PROCEDURES (EKG)
"RTN","RORHL13",18,0)
 ;
"RTN","RORHL13",19,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL13",20,0)
 ;
"RTN","RORHL13",21,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL13",22,0)
 ;               data extraction time frames are stored.
"RTN","RORHL13",23,0)
 ;
"RTN","RORHL13",24,0)
 ; Return Values:
"RTN","RORHL13",25,0)
 ;       <0  Error code
"RTN","RORHL13",26,0)
 ;        0  Ok
"RTN","RORHL13",27,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL13",28,0)
 ;
"RTN","RORHL13",29,0)
EN1(RORDFN,DXDTS) ;
"RTN","RORHL13",30,0)
 N ERRCNT,IDX,RC,RORENDT,RORESULT,RORIENS,RORSTDT,SF,TMP
"RTN","RORHL13",31,0)
 S (ERRCNT,RC)=0
"RTN","RORHL13",32,0)
 S RORESULT=$$ALLOC^RORTMP()
"RTN","RORHL13",33,0)
 ;
"RTN","RORHL13",34,0)
 S IDX=0
"RTN","RORHL13",35,0)
 F  S IDX=$O(DXDTS(12,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL13",36,0)
 . S RORSTDT=$P(DXDTS(12,IDX),U),RORENDT=$P(DXDTS(12,IDX),U,2)
"RTN","RORHL13",37,0)
 . K @RORESULT
"RTN","RORHL13",38,0)
 . ;
"RTN","RORHL13",39,0)
 . ;--- Check if Clinical Procedures patch has been installed,
"RTN","RORHL13",40,0)
 . ;--- if not call the API associated with the Medicine Patch.
"RTN","RORHL13",41,0)
 . S TMP=".01;.02;11;14;20;21;18"
"RTN","RORHL13",42,0)
 . I $D(ROREXT("PATCH","MD*1.0*1"))  D
"RTN","RORHL13",43,0)
 . . D GET^MDAPI1(RORESULT,RORDFN,RORSTDT,RORENDT,TMP)
"RTN","RORHL13",44,0)
 . E  I $D(ROREXT("PATCH","MC*2.3*34"))  D
"RTN","RORHL13",45,0)
 . . D GET^MCARAPI(RORESULT,RORDFN,RORSTDT,RORENDT,TMP)
"RTN","RORHL13",46,0)
 . E  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL13",47,0)
 . ;
"RTN","RORHL13",48,0)
 . ;--- Build the index
"RTN","RORHL13",49,0)
 . F SF=691.54  S TMP=""  D
"RTN","RORHL13",50,0)
 . . F  S TMP=$O(@RORESULT@(SF,TMP))  Q:TMP=""  D
"RTN","RORHL13",51,0)
 . . . S @RORESULT@("A",SF,$P(TMP,",",2)_",",TMP)=""
"RTN","RORHL13",52,0)
 . ;
"RTN","RORHL13",53,0)
 . ;--- Process the data
"RTN","RORHL13",54,0)
 . S RORIENS=""
"RTN","RORHL13",55,0)
 . F  S RORIENS=$O(@RORESULT@(691.5,RORIENS))  Q:RORIENS=""  D
"RTN","RORHL13",56,0)
 . . S TMP=$$OBR(RORIENS)
"RTN","RORHL13",57,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL13",58,0)
 . . S TMP=$$OBX(RORIENS)
"RTN","RORHL13",59,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL13",60,0)
 ;
"RTN","RORHL13",61,0)
 D FREE^RORTMP(RORESULT)
"RTN","RORHL13",62,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL13",63,0)
 ;
"RTN","RORHL13",64,0)
 ;***** MEDICAL PROCEDURE (EKG) OBR SEGMENT BUILDER
"RTN","RORHL13",65,0)
 ;
"RTN","RORHL13",66,0)
 ; RORIENS       Medical Procedure Record IENS
"RTN","RORHL13",67,0)
 ;
"RTN","RORHL13",68,0)
 ; Return Values:
"RTN","RORHL13",69,0)
 ;       <0  Error code
"RTN","RORHL13",70,0)
 ;        0  Ok
"RTN","RORHL13",71,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL13",72,0)
 ;
"RTN","RORHL13",73,0)
OBR(RORIENS) ;
"RTN","RORHL13",74,0)
 N CS,ERRCNT,IEN,RC,ROROUT,RORSEG,TMP
"RTN","RORHL13",75,0)
 S (ERRCNT,RC)=0
"RTN","RORHL13",76,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL13",77,0)
 ;
"RTN","RORHL13",78,0)
 ;--- Initialize the segment
"RTN","RORHL13",79,0)
 S RORSEG(0)="OBR"
"RTN","RORHL13",80,0)
 ;
"RTN","RORHL13",81,0)
 ;--- OBR-3 - IEN in the ELECTROCARDIOGRAM (EKG) file #691.5
"RTN","RORHL13",82,0)
 S RORSEG(3)=$TR(RORIENS,",")
"RTN","RORHL13",83,0)
 ;
"RTN","RORHL13",84,0)
 ;--- OBR-4 - Universal Service ID
"RTN","RORHL13",85,0)
 S RORSEG(4)="93000"_CS_"ELECTROCARDIOGRAM"_CS_"C4"
"RTN","RORHL13",86,0)
 ;
"RTN","RORHL13",87,0)
 ;--- OBR-6 - Requested Date/time (date of the EKG)
"RTN","RORHL13",88,0)
 S TMP=$$DATE($G(@RORESULT@(691.5,RORIENS,.01,"E")))
"RTN","RORHL13",89,0)
 Q:TMP'>0 $$ERROR^RORERR(-95,,,,691.5,RORIENS,.01)
"RTN","RORHL13",90,0)
 S RORSEG(6)=TMP
"RTN","RORHL13",91,0)
 ;
"RTN","RORHL13",92,0)
 ;--- OBR-7 - Observation Date/Time (when received from an instrument)
"RTN","RORHL13",93,0)
 S RORSEG(7)=$$DATE($G(@RORESULT@(691.5,RORIENS,21,"E")))
"RTN","RORHL13",94,0)
 ;
"RTN","RORHL13",95,0)
 ;--- OBR-24 - Diagnostic Service ID
"RTN","RORHL13",96,0)
 S RORSEG(24)="EC"
"RTN","RORHL13",97,0)
 ;
"RTN","RORHL13",98,0)
 ;--- OBR-25 - Confirmation Status
"RTN","RORHL13",99,0)
 S TMP=$G(@RORESULT@(691.5,RORIENS,11,"E"))
"RTN","RORHL13",100,0)
 I TMP'=""  D  S RORSEG(25)=TMP
"RTN","RORHL13",101,0)
 . S TMP=$S(TMP="CONFIRMED":"F",TMP="UNCONFIRMED":"R",1:"")
"RTN","RORHL13",102,0)
 ;
"RTN","RORHL13",103,0)
 ;--- OBR-44 - Division
"RTN","RORHL13",104,0)
 S TMP=$G(@RORESULT@(691.5,RORIENS,18,"E"))
"RTN","RORHL13",105,0)
 S IEN=$S(TMP'="":+$O(^SC("B",TMP,0)),1:0)
"RTN","RORHL13",106,0)
 S RORSEG(44)=$$DIV44^RORHLUT1(IEN,CS)
"RTN","RORHL13",107,0)
 ;
"RTN","RORHL13",108,0)
 ;--- Store the segment
"RTN","RORHL13",109,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL13",110,0)
 Q ERRCNT
"RTN","RORHL13",111,0)
 ;
"RTN","RORHL13",112,0)
 ;***** MEDICAL PROCEDURE (EKG) OBX SEGMENT(S) BUILDER
"RTN","RORHL13",113,0)
 ;
"RTN","RORHL13",114,0)
 ; RORIENS       Medical Procedure Record IENS
"RTN","RORHL13",115,0)
 ;
"RTN","RORHL13",116,0)
 ; Return Values:
"RTN","RORHL13",117,0)
 ;       <0  Error code
"RTN","RORHL13",118,0)
 ;        0  Ok
"RTN","RORHL13",119,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL13",120,0)
 ;
"RTN","RORHL13",121,0)
OBX(RORIENS) ;
"RTN","RORHL13",122,0)
 N CS,ERRCNT,RC,RORID,RORINT,RORKEY,RORMOD,RORSEG,TMP
"RTN","RORHL13",123,0)
 S (ERRCNT,RC)=0
"RTN","RORHL13",124,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL13",125,0)
 ;
"RTN","RORHL13",126,0)
 ;--- Process any interpretation data
"RTN","RORHL13",127,0)
 S RORID="INT"_CS_"Interpretation"_CS_"VA080"
"RTN","RORHL13",128,0)
 S RORKEY=""
"RTN","RORHL13",129,0)
 F  S RORKEY=$O(@RORESULT@("A",691.54,RORIENS,RORKEY))  Q:RORKEY=""  D
"RTN","RORHL13",130,0)
 . S RORINT=$G(@RORESULT@(691.54,RORKEY,.01,"E"))
"RTN","RORHL13",131,0)
 . Q:RORINT=""
"RTN","RORHL13",132,0)
 . S RORMOD=$G(@RORESULT@(691.54,RORKEY,1,"E"))
"RTN","RORHL13",133,0)
 . D SETOBX(RORID,RORMOD,RORINT)
"RTN","RORHL13",134,0)
 ;
"RTN","RORHL13",135,0)
 ;--- Process auto instrument data
"RTN","RORHL13",136,0)
 S RORID="AUTO"_CS_"Auto Instrument"_CS_"VA080"
"RTN","RORHL13",137,0)
 D SETOBXWP^RORHLUT1($NA(@RORESULT@(691.5,RORIENS,20)),RORID)
"RTN","RORHL13",138,0)
 ;
"RTN","RORHL13",139,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL13",140,0)
 ;
"RTN","RORHL13",141,0)
 ;***** CREATES AND STORES THE OBX SEGMENT
"RTN","RORHL13",142,0)
SETOBX(OBX3,OBX4,OBX5) ;
"RTN","RORHL13",143,0)
 N RORSEG
"RTN","RORHL13",144,0)
 ;--- Initialize the segment
"RTN","RORHL13",145,0)
 S RORSEG(0)="OBX"
"RTN","RORHL13",146,0)
 ;--- OBX-2 - Value Type
"RTN","RORHL13",147,0)
 S RORSEG(2)="FT"
"RTN","RORHL13",148,0)
 ;--- OBX-3 - Observation Identiifer
"RTN","RORHL13",149,0)
 S RORSEG(3)=OBX3
"RTN","RORHL13",150,0)
 ;--- OBX-4 - Observation Sub-ID (Interpretation Code Modifier)
"RTN","RORHL13",151,0)
 S:$G(OBX4)'="" RORSEG(4)=OBX4
"RTN","RORHL13",152,0)
 ;--- OBX-5 - Observation Value
"RTN","RORHL13",153,0)
 S RORSEG(5)=$$ESCAPE^RORHL7(OBX5)
"RTN","RORHL13",154,0)
 ;--- OBX-11 - Observation Result Status
"RTN","RORHL13",155,0)
 S RORSEG(11)="F"
"RTN","RORHL13",156,0)
 ;--- Store the segment
"RTN","RORHL13",157,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL13",158,0)
 Q
"RTN","RORHL14")
0^66^B30458142
"RTN","RORHL14",1,0)
RORHL14 ;HOIFO/BH,SG - HL7 ALLERGY DATA: OBR,OBX ; 8/26/05 2:43pm
"RTN","RORHL14",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL14",3,0)
 ;
"RTN","RORHL14",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL14",5,0)
 ;
"RTN","RORHL14",6,0)
 ; #2167         Read access to the file #120.83 (controlled)
"RTN","RORHL14",7,0)
 ; #4531         ZERO^PSN50P41
"RTN","RORHL14",8,0)
 ; #4543         IEN^PSN50P65
"RTN","RORHL14",9,0)
 ; #10060        Read access to the file #200 (supported)
"RTN","RORHL14",10,0)
 ;
"RTN","RORHL14",11,0)
 ;
"RTN","RORHL14",12,0)
 Q
"RTN","RORHL14",13,0)
 ;
"RTN","RORHL14",14,0)
 ;***** SEARCHES FOR ALLERGY DATA
"RTN","RORHL14",15,0)
 ;
"RTN","RORHL14",16,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL14",17,0)
 ;
"RTN","RORHL14",18,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL14",19,0)
 ;               data extraction time frames are stored.
"RTN","RORHL14",20,0)
 ;
"RTN","RORHL14",21,0)
 ; Return Values:
"RTN","RORHL14",22,0)
 ;       <0  Error code
"RTN","RORHL14",23,0)
 ;        0  Ok
"RTN","RORHL14",24,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL14",25,0)
 ;
"RTN","RORHL14",26,0)
EN1(RORDFN,DXDTS) ;
"RTN","RORHL14",27,0)
 N ERRCNT,IDX,RC,RORARR,RORDTE,RORENDT,RORIEN,RORSTDT,TMP
"RTN","RORHL14",28,0)
 S (ERRCNT,RC)=0
"RTN","RORHL14",29,0)
 ;
"RTN","RORHL14",30,0)
 S IDX=0
"RTN","RORHL14",31,0)
 F  S IDX=$O(DXDTS(13,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL14",32,0)
 . S RORSTDT=$P(DXDTS(13,IDX),U),RORENDT=$P(DXDTS(13,IDX),U,2)
"RTN","RORHL14",33,0)
 . ;---
"RTN","RORHL14",34,0)
 . S RORDTE=$O(^GMR(120.8,"AODT",RORSTDT),-1)
"RTN","RORHL14",35,0)
 . F  S RORDTE=$O(^GMR(120.8,"AODT",RORDTE))  Q:'RORDTE!(RORDTE'<RORENDT)  D
"RTN","RORHL14",36,0)
 . . S RORIEN=0
"RTN","RORHL14",37,0)
 . . F  S RORIEN=$O(^GMR(120.8,"AODT",RORDTE,RORIEN))  Q:'RORIEN  D
"RTN","RORHL14",38,0)
 . . . S:$D(^GMR(120.8,"B",RORDFN,RORIEN)) RORARR(RORIEN)=""
"RTN","RORHL14",39,0)
 . I $D(RORARR)<10  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL14",40,0)
 . ;
"RTN","RORHL14",41,0)
 . S RORIEN=0
"RTN","RORHL14",42,0)
 . F  S RORIEN=$O(RORARR(RORIEN))  Q:'RORIEN  D
"RTN","RORHL14",43,0)
 . . S TMP=$$OBR(RORIEN,RORDFN)
"RTN","RORHL14",44,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL14",45,0)
 . . S TMP=$$OBX(RORIEN,RORDFN)
"RTN","RORHL14",46,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL14",47,0)
 ;
"RTN","RORHL14",48,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL14",49,0)
 ;
"RTN","RORHL14",50,0)
 ;***** ALLERGY OBR SEGMENT BUILDER
"RTN","RORHL14",51,0)
 ;
"RTN","RORHL14",52,0)
 ; RORAIEN       IEN of Allergy entry
"RTN","RORHL14",53,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL14",54,0)
 ;
"RTN","RORHL14",55,0)
 ; Return Values:
"RTN","RORHL14",56,0)
 ;       <0  Error code
"RTN","RORHL14",57,0)
 ;        0  Ok
"RTN","RORHL14",58,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL14",59,0)
 ;
"RTN","RORHL14",60,0)
OBR(RORAIEN,RORDFN) ;
"RTN","RORHL14",61,0)
 N BUF,CS,ERRCNT,RC,RORLST,RORMSG,RORSEG,TMP
"RTN","RORHL14",62,0)
 S (ERRCNT,RC)=0
"RTN","RORHL14",63,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL14",64,0)
 ;
"RTN","RORHL14",65,0)
 S RORAIEN=RORAIEN_","
"RTN","RORHL14",66,0)
 D GETS^DIQ(120.8,RORAIEN,".02;3.1;4;5;6","EI","RORLST","RORMSG")
"RTN","RORHL14",67,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL14",68,0)
 . D DBS^RORERR("RORMSG",-9,,RORDFN,120.8,RORAIEN)
"RTN","RORHL14",69,0)
 ;
"RTN","RORHL14",70,0)
 ;--- Initialize the segment
"RTN","RORHL14",71,0)
 S RORSEG(0)="OBR"
"RTN","RORHL14",72,0)
 ;
"RTN","RORHL14",73,0)
 ;--- OBR-3 - IEN of the record
"RTN","RORHL14",74,0)
 S RORSEG(3)=$P(RORAIEN,",")
"RTN","RORHL14",75,0)
 ;
"RTN","RORHL14",76,0)
 ;--- OBR-4 - Sevice ID
"RTN","RORHL14",77,0)
 S RORSEG(4)="95000"_CS_"ALLERGY"_CS_"C4"
"RTN","RORHL14",78,0)
 ;
"RTN","RORHL14",79,0)
 ;--- OBR-7 - Observation Date/Time (Origination Date)
"RTN","RORHL14",80,0)
 S TMP=$$FMTHL7^XLFDT($G(RORLST(120.8,RORAIEN,4,"I")))
"RTN","RORHL14",81,0)
 Q:TMP'>0 $$ERROR^RORERR(-95,,,RORDFN,120.8,RORAIEN,4)
"RTN","RORHL14",82,0)
 S RORSEG(7)=TMP
"RTN","RORHL14",83,0)
 ;
"RTN","RORHL14",84,0)
 ;--- OBR-13 - Relevant Clinical Info. (Reactant)
"RTN","RORHL14",85,0)
 S RORSEG(13)=$G(RORLST(120.8,RORAIEN,.02,"E"))
"RTN","RORHL14",86,0)
 ;
"RTN","RORHL14",87,0)
 ;--- OBR-16 - Ordering Provider
"RTN","RORHL14",88,0)
 S BUF=$G(RORLST(120.8,RORAIEN,5,"I"))
"RTN","RORHL14",89,0)
 I BUF>0  D
"RTN","RORHL14",90,0)
 . S $P(BUF,CS,13)=$$GET1^DIQ(200,+BUF_",",53.5,"E",,"RORMSG")
"RTN","RORHL14",91,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL14",92,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,200,+BUF_",")
"RTN","RORHL14",93,0)
 . S RORSEG(16)=BUF
"RTN","RORHL14",94,0)
 ;
"RTN","RORHL14",95,0)
 ;--- OBR-20 - Filler Field 1 (Allergy Type)
"RTN","RORHL14",96,0)
 S RORSEG(20)=$G(RORLST(120.8,RORAIEN,3.1,"E"))
"RTN","RORHL14",97,0)
 ;
"RTN","RORHL14",98,0)
 ;--- OBR-24 - Diagnostic Service ID
"RTN","RORHL14",99,0)
 S RORSEG(24)="TX"
"RTN","RORHL14",100,0)
 ;
"RTN","RORHL14",101,0)
 ;--- OBR-25 - Result Status (Observed/Historical)
"RTN","RORHL14",102,0)
 S TMP=$G(RORLST(120.8,RORAIEN,6,"E"))
"RTN","RORHL14",103,0)
 I TMP'=""  D  S RORSEG(25)=TMP
"RTN","RORHL14",104,0)
 . S TMP=$S(TMP="HISTORICAL":"R",TMP="OBSERVED":"F",1:"")
"RTN","RORHL14",105,0)
 ;
"RTN","RORHL14",106,0)
 ;--- Store the segment
"RTN","RORHL14",107,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL14",108,0)
 Q ERRCNT
"RTN","RORHL14",109,0)
 ;
"RTN","RORHL14",110,0)
 ;***** ALLERGY OBX SEGMENT(S) BUILDER
"RTN","RORHL14",111,0)
 ;
"RTN","RORHL14",112,0)
 ; RORAIEN       IEN of Allergy entry
"RTN","RORHL14",113,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL14",114,0)
 ;
"RTN","RORHL14",115,0)
 ; Return Values:
"RTN","RORHL14",116,0)
 ;       <0  Error code
"RTN","RORHL14",117,0)
 ;        0  Ok
"RTN","RORHL14",118,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL14",119,0)
 ;
"RTN","RORHL14",120,0)
OBX(RORAIEN,RORDFN) ;
"RTN","RORHL14",121,0)
 N BUF,CS,DTE,ERRCNT,IEN,RC,REAC,RORID,RORIENS,RORKEY,RORLST,RORMSG,RORSEG,RORTMP,RORTS,RPS,TMP
"RTN","RORHL14",122,0)
 S (ERRCNT,RC)=0,RORIENS=","_RORAIEN_","
"RTN","RORHL14",123,0)
 D ECH^RORHL7(.CS,,.RPS)
"RTN","RORHL14",124,0)
 ;
"RTN","RORHL14",125,0)
 ;=== Ingredients
"RTN","RORHL14",126,0)
 K RORLST,RORMSG
"RTN","RORHL14",127,0)
 D LIST^DIC(120.802,RORIENS,"@;.01","I",,,,,,,"RORLST","RORMSG")
"RTN","RORHL14",128,0)
 I $G(DIERR)  D  Q RC
"RTN","RORHL14",129,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,RORDFN,120.802,RORIENS)
"RTN","RORHL14",130,0)
 S RORID="INGR"_CS_"Ingredients"_CS_"VA080"
"RTN","RORHL14",131,0)
 ;---
"RTN","RORHL14",132,0)
 S RORTMP=$$ALLOC^RORTMP(.RORTS)
"RTN","RORHL14",133,0)
 S RORKEY=0
"RTN","RORHL14",134,0)
 F  S RORKEY=$O(RORLST("DILIST","ID",RORKEY))  Q:'RORKEY  D
"RTN","RORHL14",135,0)
 . S IEN=+$G(RORLST("DILIST","ID",RORKEY,.01))  Q:IEN'>0
"RTN","RORHL14",136,0)
 . D ZERO^PSN50P41(IEN,,,RORTS)
"RTN","RORHL14",137,0)
 . S TMP=$G(@RORTMP@(IEN,.01))
"RTN","RORHL14",138,0)
 . D:TMP'="" SETOBX(TMP,RORID)
"RTN","RORHL14",139,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORHL14",140,0)
 ;
"RTN","RORHL14",141,0)
 ;=== Classes
"RTN","RORHL14",142,0)
 K RORLST,RORMSG
"RTN","RORHL14",143,0)
 D LIST^DIC(120.803,RORIENS,"@;.01","I",,,,,,,"RORLST","RORMSG")
"RTN","RORHL14",144,0)
 I $G(DIERR)  D  Q RC
"RTN","RORHL14",145,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,RORDFN,120.803,RORIENS)
"RTN","RORHL14",146,0)
 ;---
"RTN","RORHL14",147,0)
 S RORTMP=$$ALLOC^RORTMP(.RORTS)
"RTN","RORHL14",148,0)
 S (CNT,RORKEY)=0,BUF=""
"RTN","RORHL14",149,0)
 F  S RORKEY=$O(RORLST("DILIST","ID",RORKEY))  Q:'RORKEY  D
"RTN","RORHL14",150,0)
 . S IEN=+$G(RORLST("DILIST","ID",RORKEY,.01))  Q:IEN'>0
"RTN","RORHL14",151,0)
 . D IEN^PSN50P65(IEN,,RORTS)
"RTN","RORHL14",152,0)
 . S TMP=$G(@RORTMP@(IEN,.01))
"RTN","RORHL14",153,0)
 . S:TMP'="" BUF=BUF_$S(BUF'="":RPS_TMP,1:TMP)
"RTN","RORHL14",154,0)
 D:BUF'="" SETOBX(BUF,"CLAS"_CS_"Drug Class"_CS_"VA080")
"RTN","RORHL14",155,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORHL14",156,0)
 ;
"RTN","RORHL14",157,0)
 ;=== Reactions
"RTN","RORHL14",158,0)
 K RORLST,RORMSG
"RTN","RORHL14",159,0)
 D LIST^DIC(120.81,RORIENS,"@;.01;3","I",,,,,,,"RORLST","RORMSG")
"RTN","RORHL14",160,0)
 I $G(DIERR)  D  Q RC
"RTN","RORHL14",161,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,RORDFN,120.81,RORIENS)
"RTN","RORHL14",162,0)
 S RORID="RCTS"_CS_"Reactions"_CS_"VA080"
"RTN","RORHL14",163,0)
 ;---
"RTN","RORHL14",164,0)
 S RORKEY=0
"RTN","RORHL14",165,0)
 F  S RORKEY=$O(RORLST("DILIST","ID",RORKEY))  Q:'RORKEY  D
"RTN","RORHL14",166,0)
 . S IEN=RORLST("DILIST","ID",RORKEY,.01)  Q:IEN'>0
"RTN","RORHL14",167,0)
 . S REAC=$$GET1^DIQ(120.83,IEN_",",.01,"E",,"RORMSG")
"RTN","RORHL14",168,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL14",169,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,120.83,IEN_",")
"RTN","RORHL14",170,0)
 . Q:REAC=""
"RTN","RORHL14",171,0)
 . S DTE=$$FM2HL^RORHL7($G(RORLST("DILIST","ID",RORKEY,3)))
"RTN","RORHL14",172,0)
 . D SETOBX(REAC,RORID,DTE)
"RTN","RORHL14",173,0)
 ;
"RTN","RORHL14",174,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL14",175,0)
 ;
"RTN","RORHL14",176,0)
 ;***** CREATES AND STORES THE OBX SEGMENT
"RTN","RORHL14",177,0)
SETOBX(OBX5,OBX3,OBX12) ;
"RTN","RORHL14",178,0)
 N RORSEG
"RTN","RORHL14",179,0)
 ;--- Initialize the segment
"RTN","RORHL14",180,0)
 S RORSEG(0)="OBX"
"RTN","RORHL14",181,0)
 ;--- OBX-2 - Value Type
"RTN","RORHL14",182,0)
 S RORSEG(2)="FT"
"RTN","RORHL14",183,0)
 ;--- OBX-3 - Observation Identifier
"RTN","RORHL14",184,0)
 S RORSEG(3)=OBX3
"RTN","RORHL14",185,0)
 ;--- OBX-5 - Observation Value
"RTN","RORHL14",186,0)
 S RORSEG(5)=OBX5
"RTN","RORHL14",187,0)
 ;--- OBX-11 - Observation Result Status
"RTN","RORHL14",188,0)
 S RORSEG(11)="F"
"RTN","RORHL14",189,0)
 ;--- OBX-12 - Reactions Date/Time Entered
"RTN","RORHL14",190,0)
 S:$G(OBX12)'="" RORSEG(12)=OBX12
"RTN","RORHL14",191,0)
 ;--- Store the segment
"RTN","RORHL14",192,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL14",193,0)
 Q
"RTN","RORHL15")
0^67^B36834138
"RTN","RORHL15",1,0)
RORHL15 ;HOIFO/BH - HL7 IV DATA: OBR, OBX ; 8/26/05 2:43pm
"RTN","RORHL15",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL15",3,0)
 ;
"RTN","RORHL15",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL15",5,0)
 ;
"RTN","RORHL15",6,0)
 ; #117          Read access to the file #55 (controlled)
"RTN","RORHL15",7,0)
 ; #2400         OCL^PSOORRL and OEL^PSOORRL (controlled)
"RTN","RORHL15",8,0)
 ; #4549         ZERO^PSS52P6 (supported)
"RTN","RORHL15",9,0)
 ; #4550         ZERO^PSS52P7 (supported)
"RTN","RORHL15",10,0)
 ;
"RTN","RORHL15",11,0)
 Q
"RTN","RORHL15",12,0)
 ;
"RTN","RORHL15",13,0)
 ;***** SEARCHES FOR IV DATA
"RTN","RORHL15",14,0)
 ;
"RTN","RORHL15",15,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL15",16,0)
 ;
"RTN","RORHL15",17,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL15",18,0)
 ;               data extraction time frames are stored.
"RTN","RORHL15",19,0)
 ;
"RTN","RORHL15",20,0)
 ; Return Values:
"RTN","RORHL15",21,0)
 ;       <0  Error code
"RTN","RORHL15",22,0)
 ;        0  Ok
"RTN","RORHL15",23,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL15",24,0)
 ;
"RTN","RORHL15",25,0)
 ; The ^TMP("PS",$J) global node is used by this function.
"RTN","RORHL15",26,0)
 ;
"RTN","RORHL15",27,0)
EN1(RORDFN,DXDTS) ;
"RTN","RORHL15",28,0)
 N ERRCNT,IDX,II,RC,RORENDT,RORII,RORORD,RORSTDT,RORTMP
"RTN","RORHL15",29,0)
 S (ERRCNT,RC)=0
"RTN","RORHL15",30,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORHL15",31,0)
 ;
"RTN","RORHL15",32,0)
 S IDX=0
"RTN","RORHL15",33,0)
 F  S IDX=$O(DXDTS(14,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL15",34,0)
 . S RORSTDT=$P(DXDTS(14,IDX),U),RORENDT=$P(DXDTS(14,IDX),U,2)
"RTN","RORHL15",35,0)
 . ;--- Load the list of prescriptions
"RTN","RORHL15",36,0)
 . K ^TMP("PS",$J),@RORTMP
"RTN","RORHL15",37,0)
 . D OCL^PSOORRL(RORDFN,RORSTDT,RORENDT)
"RTN","RORHL15",38,0)
 . Q:$D(^TMP("PS",$J))<10
"RTN","RORHL15",39,0)
 . ;
"RTN","RORHL15",40,0)
 . ;--- Select the prescriptions
"RTN","RORHL15",41,0)
 . S RORII=0
"RTN","RORHL15",42,0)
 . F  S RORII=$O(^TMP("PS",$J,RORII))  Q:'RORII  D
"RTN","RORHL15",43,0)
 . . S RORORD=$P(^TMP("PS",$J,RORII,0),U)
"RTN","RORHL15",44,0)
 . . Q:RORORD'>0
"RTN","RORHL15",45,0)
 . . S II=$P(RORORD,";"),II=$E(II,$L(II))
"RTN","RORHL15",46,0)
 . . Q:II'="V"
"RTN","RORHL15",47,0)
 . . ;---
"RTN","RORHL15",48,0)
 . . M @RORTMP@(RORII)=^TMP("PS",$J,RORII)
"RTN","RORHL15",49,0)
 . ;
"RTN","RORHL15",50,0)
 . ;--- Browse through the list and generate the HL7 segments
"RTN","RORHL15",51,0)
 . S RORII=0
"RTN","RORHL15",52,0)
 . F  S RORII=$O(@RORTMP@(RORII))  Q:'RORII  D
"RTN","RORHL15",53,0)
 . . S RORORD=$P(@RORTMP@(RORII,0),U)
"RTN","RORHL15",54,0)
 . . S RORORD=$P(RORORD,";")
"RTN","RORHL15",55,0)
 . . S RORORD=$E(RORORD,1,$L(RORORD)-1)
"RTN","RORHL15",56,0)
 . . ;---
"RTN","RORHL15",57,0)
 . . S TMP=$$OBR(RORORD,RORDFN)
"RTN","RORHL15",58,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL15",59,0)
 . . S TMP=$$OBX(RORORD,RORDFN)
"RTN","RORHL15",60,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL15",61,0)
 ;
"RTN","RORHL15",62,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORHL15",63,0)
 K ^TMP("PS",$J)
"RTN","RORHL15",64,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL15",65,0)
 ;
"RTN","RORHL15",66,0)
 ;***** IV OBR SEGMENT BUILDER
"RTN","RORHL15",67,0)
 ;
"RTN","RORHL15",68,0)
 ; RORORD        Order Number
"RTN","RORHL15",69,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL15",70,0)
 ;
"RTN","RORHL15",71,0)
 ; Return Values:
"RTN","RORHL15",72,0)
 ;       <0  Error code
"RTN","RORHL15",73,0)
 ;        0  Ok
"RTN","RORHL15",74,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL15",75,0)
 ;
"RTN","RORHL15",76,0)
OBR(RORORD,RORDFN) ;
"RTN","RORHL15",77,0)
 N CS,ERRCNT,IEN,RC,RORBUF,RORIENS,RORMSG,RORSEG,TMP
"RTN","RORHL15",78,0)
 S (ERRCNT,RC)=0
"RTN","RORHL15",79,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL15",80,0)
 ;
"RTN","RORHL15",81,0)
 S RORIENS=$$GETIENS(RORORD,RORDFN)  Q:'RORIENS 0
"RTN","RORHL15",82,0)
 D GETS^DIQ(55.01,RORIENS,".02;.03;.04;.08;.09;9","IE","RORBUF","RORMSG")
"RTN","RORHL15",83,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL15",84,0)
 . D DBS^RORERR("RORMSG",-9,,RORDFN,55.01,RORIENS)
"RTN","RORHL15",85,0)
 ;
"RTN","RORHL15",86,0)
 ;--- Initialize the segment
"RTN","RORHL15",87,0)
 S RORSEG(0)="OBR"
"RTN","RORHL15",88,0)
 ;
"RTN","RORHL15",89,0)
 ;--- OBR-3 - Order Number
"RTN","RORHL15",90,0)
 S RORSEG(3)=RORORD
"RTN","RORHL15",91,0)
 ;
"RTN","RORHL15",92,0)
 ;--- OBR-4 - IV CPT Code
"RTN","RORHL15",93,0)
 S RORSEG(4)="90780"_CS_"IV"_CS_"C4"
"RTN","RORHL15",94,0)
 ;
"RTN","RORHL15",95,0)
 ;--- OBR-7 - Start Date
"RTN","RORHL15",96,0)
 S TMP=$$FMTHL7^XLFDT($G(RORBUF(55.01,RORIENS,.02,"I")))
"RTN","RORHL15",97,0)
 Q:TMP'>0 $$ERROR^RORERR(-95,,,RORDFN,55.01,RORIENS,.02)
"RTN","RORHL15",98,0)
 S RORSEG(7)=TMP
"RTN","RORHL15",99,0)
 ;
"RTN","RORHL15",100,0)
 ;--- OBR-8 - Stop Date
"RTN","RORHL15",101,0)
 S TMP=$G(RORBUF(55.01,RORIENS,.03,"I"))
"RTN","RORHL15",102,0)
 S RORSEG(8)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL15",103,0)
 ;
"RTN","RORHL15",104,0)
 ;--- OBR-13 - Schedule
"RTN","RORHL15",105,0)
 S TMP=$G(RORBUF(55.01,RORIENS,.09,"I"))
"RTN","RORHL15",106,0)
 S RORSEG(13)=$$ESCAPE^RORHL7(TMP)
"RTN","RORHL15",107,0)
 ;
"RTN","RORHL15",108,0)
 ;--- OBR-20 - Infusion Rate
"RTN","RORHL15",109,0)
 S TMP=$G(RORBUF(55.01,RORIENS,.08,"I"))
"RTN","RORHL15",110,0)
 S RORSEG(20)=$$ESCAPE^RORHL7(TMP)
"RTN","RORHL15",111,0)
 ;
"RTN","RORHL15",112,0)
 ;--- OBR-24 - Diagnostic Service ID
"RTN","RORHL15",113,0)
 S RORSEG(24)="IMM"
"RTN","RORHL15",114,0)
 ;
"RTN","RORHL15",115,0)
 ;--- OBR-40 - Type
"RTN","RORHL15",116,0)
 S TMP=$G(RORBUF(55.01,RORIENS,.04,"I"))
"RTN","RORHL15",117,0)
 I TMP'=""  D  S RORSEG(40)=TMP
"RTN","RORHL15",118,0)
 . S $P(TMP,CS,2)=$G(RORBUF(55.01,RORIENS,.04,"E"))
"RTN","RORHL15",119,0)
 . S $P(TMP,CS,3)="VA"
"RTN","RORHL15",120,0)
 ;
"RTN","RORHL15",121,0)
 ;--- OBR-44 - Division
"RTN","RORHL15",122,0)
 S IEN=+$G(RORBUF(55.01,RORIENS,9,"I"))
"RTN","RORHL15",123,0)
 I IEN>0  D
"RTN","RORHL15",124,0)
 . S IEN=+$$GET1^DIQ(42,IEN_",",44,"I",,"RORMSG")
"RTN","RORHL15",125,0)
 . D:$G(DIERR) DBS^RORERR("RORMSG",-99,,,42,IEN_",")
"RTN","RORHL15",126,0)
 S RORSEG(44)=$$DIV44^RORHLUT1(IEN,CS)
"RTN","RORHL15",127,0)
 ;
"RTN","RORHL15",128,0)
 ;--- Store the segment
"RTN","RORHL15",129,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL15",130,0)
 Q ERRCNT
"RTN","RORHL15",131,0)
 ;
"RTN","RORHL15",132,0)
 ;***** IV OBX SEGMENT(S) BUILDER
"RTN","RORHL15",133,0)
 ;
"RTN","RORHL15",134,0)
 ; RORORD        Order Number
"RTN","RORHL15",135,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL15",136,0)
 ;
"RTN","RORHL15",137,0)
 ; Return Values:
"RTN","RORHL15",138,0)
 ;       <0  Error code
"RTN","RORHL15",139,0)
 ;        0  Ok
"RTN","RORHL15",140,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL15",141,0)
 ;
"RTN","RORHL15",142,0)
OBX(RORORD,RORDFN) ;
"RTN","RORHL15",143,0)
 N CS,ERRCNT,IEN,RC,RORID,RORIENS,RORKEY,RORLST,RORMSG,TMP
"RTN","RORHL15",144,0)
 S (ERRCNT,RC)=0
"RTN","RORHL15",145,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL15",146,0)
 ;
"RTN","RORHL15",147,0)
 S RORIENS=$$GETIENS(RORORD,RORDFN)  Q:'RORIENS 0
"RTN","RORHL15",148,0)
 ;
"RTN","RORHL15",149,0)
 ;=== Other Print information
"RTN","RORHL15",150,0)
 S TMP=$$GET1^DIQ(55.01,RORIENS,31,"E",,"RORMSG")
"RTN","RORHL15",151,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL15",152,0)
 . D DBS^RORERR("RORMSG",-99,,RORDFN,55.01,RORIENS)
"RTN","RORHL15",153,0)
 I TMP'=""  D  D SETOBX(TMP,RORID)
"RTN","RORHL15",154,0)
 . S RORID="OTPR"_CS_"Other Print info."_CS_"VA080"
"RTN","RORHL15",155,0)
 ;
"RTN","RORHL15",156,0)
 ;=== Additive data
"RTN","RORHL15",157,0)
 K RORMSG,RORLST
"RTN","RORHL15",158,0)
 D LIST^DIC(55.02,","_RORIENS,"@;.01;.02","I",,,,,,,"RORLST","RORMSG")
"RTN","RORHL15",159,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL15",160,0)
 . D DBS^RORERR("RORMSG",-99,,RORDFN,55.02,","_RORIENS)
"RTN","RORHL15",161,0)
 I $D(RORLST)>1  D
"RTN","RORHL15",162,0)
 . N RORAD,RORST,RORTMP,RORTS
"RTN","RORHL15",163,0)
 . S RORTMP=$$ALLOC^RORTMP(.RORTS)
"RTN","RORHL15",164,0)
 . S RORID="ADD"_CS_"Additive"_CS_"VA080"
"RTN","RORHL15",165,0)
 . S RORKEY=""
"RTN","RORHL15",166,0)
 . F  S RORKEY=$O(RORLST("DILIST","ID",RORKEY))  Q:'RORKEY  D
"RTN","RORHL15",167,0)
 . . S IEN=+$G(RORLST("DILIST","ID",RORKEY,.01))  Q:IEN'>0
"RTN","RORHL15",168,0)
 . . D ZERO^PSS52P6(IEN,,,RORTS)
"RTN","RORHL15",169,0)
 . . S RORAD=$G(@RORTMP@(IEN,.01))  Q:RORAD=""
"RTN","RORHL15",170,0)
 . . S RORST=$G(RORLST("DILIST","ID",RORKEY,.02))
"RTN","RORHL15",171,0)
 . . D SETOBX(RORAD,RORID,RORST)
"RTN","RORHL15",172,0)
 . D FREE^RORTMP(RORTMP)
"RTN","RORHL15",173,0)
 ;
"RTN","RORHL15",174,0)
 ;=== Solution Data
"RTN","RORHL15",175,0)
 K RORMSG,RORLST
"RTN","RORHL15",176,0)
 D LIST^DIC(55.11,","_RORIENS,"@;.01;1","I",,,,,,,"RORLST","RORMSG")
"RTN","RORHL15",177,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL15",178,0)
 . D DBS^RORERR("RORMSG",-99,,,55.11,","_RORIENS)
"RTN","RORHL15",179,0)
 I $D(RORLST)>1  D
"RTN","RORHL15",180,0)
 . N RORSOL,RORVOL,RORTMP,RORTS
"RTN","RORHL15",181,0)
 . S RORTMP=$$ALLOC^RORTMP(.RORTS)
"RTN","RORHL15",182,0)
 . S RORID="SOL"_CS_"Solution"_CS_"VA080"
"RTN","RORHL15",183,0)
 . S RORKEY=""
"RTN","RORHL15",184,0)
 . F  S RORKEY=$O(RORLST("DILIST","ID",RORKEY))  Q:'RORKEY  D
"RTN","RORHL15",185,0)
 . . S IEN=+$G(RORLST("DILIST","ID",RORKEY,.01))  Q:IEN'>0
"RTN","RORHL15",186,0)
 . . D ZERO^PSS52P7(IEN,,,RORTS)
"RTN","RORHL15",187,0)
 . . S RORSOL=$G(@RORTMP@(IEN,.01))  Q:RORSOL=""
"RTN","RORHL15",188,0)
 . . S RORVOL=$G(RORLST("DILIST","ID",RORKEY,1))
"RTN","RORHL15",189,0)
 . . D SETOBX(RORSOL,RORID,RORVOL)
"RTN","RORHL15",190,0)
 . D FREE^RORTMP(RORTMP)
"RTN","RORHL15",191,0)
 ;
"RTN","RORHL15",192,0)
 Q ERRCNT
"RTN","RORHL15",193,0)
 ;
"RTN","RORHL15",194,0)
 ;*****
"RTN","RORHL15",195,0)
GETIENS(RORORD,RORDFN) ;
"RTN","RORHL15",196,0)
 N IEN
"RTN","RORHL15",197,0)
 S IEN=$O(^PS(55,RORDFN,"IV","B",RORORD,""))
"RTN","RORHL15",198,0)
 Q $S(IEN>0:IEN_","_RORDFN_",",1:"")
"RTN","RORHL15",199,0)
 ;
"RTN","RORHL15",200,0)
 ;***** CREATES AND STORES THE OBX SEGMENT
"RTN","RORHL15",201,0)
SETOBX(OBX5,OBX3,OBX7) ;
"RTN","RORHL15",202,0)
 N RORSEG
"RTN","RORHL15",203,0)
 ;--- Initialize the segment
"RTN","RORHL15",204,0)
 S RORSEG(0)="OBX"
"RTN","RORHL15",205,0)
 ;--- OBX-2 - Value Type
"RTN","RORHL15",206,0)
 S RORSEG(2)="FT"
"RTN","RORHL15",207,0)
 ;--- OBX-3 - Obervation Identifier
"RTN","RORHL15",208,0)
 S RORSEG(3)=OBX3
"RTN","RORHL15",209,0)
 ;--- OBX-5 - Observation Value
"RTN","RORHL15",210,0)
 S RORSEG(5)=$$ESCAPE^RORHL7(OBX5)
"RTN","RORHL15",211,0)
 ;--- OBX-7 - Strength (additives) or volume (solutions)
"RTN","RORHL15",212,0)
 S:$G(OBX7)'="" RORSEG(7)=OBX7
"RTN","RORHL15",213,0)
 ;--- OBX-11 - Observation Result Status
"RTN","RORHL15",214,0)
 S RORSEG(11)="F"
"RTN","RORHL15",215,0)
 ;--- Store the segment
"RTN","RORHL15",216,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL15",217,0)
 Q
"RTN","RORHL16")
0^68^B13477054
"RTN","RORHL16",1,0)
RORHL16 ;HOIFO/BH,SG - HL7 VITALS DATA: OBR,OBX ; 8/31/05 2:16pm
"RTN","RORHL16",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL16",3,0)
 ;
"RTN","RORHL16",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL16",5,0)
 ;
"RTN","RORHL16",6,0)
 ; #1446         EN1^GMRVUT0 (controlled)
"RTN","RORHL16",7,0)
 ;
"RTN","RORHL16",8,0)
 Q
"RTN","RORHL16",9,0)
 ;
"RTN","RORHL16",10,0)
 ;***** SEARCHES FOR VITALS DATA
"RTN","RORHL16",11,0)
 ;
"RTN","RORHL16",12,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL16",13,0)
 ;
"RTN","RORHL16",14,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL16",15,0)
 ;               data extraction time frames are stored.
"RTN","RORHL16",16,0)
 ;
"RTN","RORHL16",17,0)
 ; Return Values:
"RTN","RORHL16",18,0)
 ;       <0  Error code
"RTN","RORHL16",19,0)
 ;        0  Ok
"RTN","RORHL16",20,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL16",21,0)
 ;
"RTN","RORHL16",22,0)
 ; The function uses ^UTILITY($J,"GMRVD") global node.
"RTN","RORHL16",23,0)
 ;
"RTN","RORHL16",24,0)
EN1(RORDFN,DXDTS) ;
"RTN","RORHL16",25,0)
 N DFN,GMRVSTR,IDX,PAT,RC,RORENDT,RORSTDT
"RTN","RORHL16",26,0)
 S (ERRCNT,RC)=0
"RTN","RORHL16",27,0)
 ;
"RTN","RORHL16",28,0)
 S IDX=0
"RTN","RORHL16",29,0)
 F  S IDX=$O(DXDTS(15,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL16",30,0)
 . S RORSTDT=$P(DXDTS(15,IDX),U),RORENDT=$P(DXDTS(15,IDX),U,2)
"RTN","RORHL16",31,0)
 . ;--- Check to see if the patient has any Vitals data
"RTN","RORHL16",32,0)
 . K ^UTILITY($J,"GMRVD")
"RTN","RORHL16",33,0)
 . S DFN=RORDFN,GMRVSTR="BP;T;R;P;HT;WT;PN"
"RTN","RORHL16",34,0)
 . S GMRVSTR(0)=RORSTDT_"^"_RORENDT_"^999999^0"
"RTN","RORHL16",35,0)
 . D EN1^GMRVUT0
"RTN","RORHL16",36,0)
 . Q:$D(^UTILITY($J,"GMRVD"))<10
"RTN","RORHL16",37,0)
 . ;--- Process the data
"RTN","RORHL16",38,0)
 . S TMP=$$OBR()
"RTN","RORHL16",39,0)
 . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL16",40,0)
 . S TMP=$$OBX()
"RTN","RORHL16",41,0)
 . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL16",42,0)
 ;
"RTN","RORHL16",43,0)
 K ^UTILITY($J,"GMRVD")
"RTN","RORHL16",44,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL16",45,0)
 ;
"RTN","RORHL16",46,0)
 ;***** VITALS OBR SEGMENT BUILDER
"RTN","RORHL16",47,0)
 ;
"RTN","RORHL16",48,0)
 ; Return Values:
"RTN","RORHL16",49,0)
 ;       <0  Error code
"RTN","RORHL16",50,0)
 ;        0  Ok
"RTN","RORHL16",51,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL16",52,0)
 ;
"RTN","RORHL16",53,0)
OBR() ;
"RTN","RORHL16",54,0)
 N CS,ERRCNT,RC,RORSEG
"RTN","RORHL16",55,0)
 S (ERRCNT,RC)=0
"RTN","RORHL16",56,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL16",57,0)
 ;
"RTN","RORHL16",58,0)
 ;--- Initialize the segment
"RTN","RORHL16",59,0)
 S RORSEG(0)="OBR"
"RTN","RORHL16",60,0)
 ;
"RTN","RORHL16",61,0)
 ;--- OBR-4 - Vitals CPT Code
"RTN","RORHL16",62,0)
 S RORSEG(4)="94150"_CS_"VITAL CAPACITY TEST"_CS_"C4"
"RTN","RORHL16",63,0)
 ;
"RTN","RORHL16",64,0)
 ;--- OBR-24 - Diagnostic Service ID
"RTN","RORHL16",65,0)
 S RORSEG(24)="EC"
"RTN","RORHL16",66,0)
 ;
"RTN","RORHL16",67,0)
 ;--- OBR-44 - Division
"RTN","RORHL16",68,0)
 S RORSEG(44)=$$SITE^RORUTL03(CS)
"RTN","RORHL16",69,0)
 ;
"RTN","RORHL16",70,0)
 ;--- Store the segment
"RTN","RORHL16",71,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL16",72,0)
 Q ERRCNT
"RTN","RORHL16",73,0)
 ;
"RTN","RORHL16",74,0)
 ;***** VITALS OBX SEGMENT(S) BUILDER
"RTN","RORHL16",75,0)
 ;
"RTN","RORHL16",76,0)
 ; Return Values:
"RTN","RORHL16",77,0)
 ;       <0  Error code
"RTN","RORHL16",78,0)
 ;        0  Ok
"RTN","RORHL16",79,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL16",80,0)
 ;
"RTN","RORHL16",81,0)
OBX() ;
"RTN","RORHL16",82,0)
 N CS,ERRCNT,RC,OBID
"RTN","RORHL16",83,0)
 S (ERRCNT,RC)=0
"RTN","RORHL16",84,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL16",85,0)
 ;
"RTN","RORHL16",86,0)
 F OBID="BP^Blood Pressue^VA080","T^Temperature^VA080","R^Respiration^VA080","P^Pulse^VA080","HT^Height^VA080","WT^Weight^VA080","PN^Pain^VA080"  D
"RTN","RORHL16",87,0)
 . D VITALTYP($TR(OBID,"^",CS),CS)
"RTN","RORHL16",88,0)
 ;
"RTN","RORHL16",89,0)
 Q ERRCNT
"RTN","RORHL16",90,0)
 ;
"RTN","RORHL16",91,0)
 ;***** LOOPS THROUGH THE UTILITY GLOBAL FOR VITAL TYPE
"RTN","RORHL16",92,0)
VITALTYP(OBID,CS) ;
"RTN","RORHL16",93,0)
 N BODYMASS,DATA,DTE,IEN,MEASDATE,OBX5,TYPE,UNITS
"RTN","RORHL16",94,0)
 S TYPE=$P(OBID,CS)
"RTN","RORHL16",95,0)
 Q:'$D(^UTILITY($J,"GMRVD",TYPE))
"RTN","RORHL16",96,0)
 ;---
"RTN","RORHL16",97,0)
 S DTE=""
"RTN","RORHL16",98,0)
 F  S DTE=$O(^UTILITY($J,"GMRVD",TYPE,DTE))  Q:'DTE  D
"RTN","RORHL16",99,0)
 . S IEN=""
"RTN","RORHL16",100,0)
 . F  S IEN=$O(^UTILITY($J,"GMRVD",TYPE,DTE,IEN))  Q:'IEN  D
"RTN","RORHL16",101,0)
 . . S DATA=^UTILITY($J,"GMRVD",TYPE,DTE,IEN)
"RTN","RORHL16",102,0)
 . . ;
"RTN","RORHL16",103,0)
 . . S MEASDATE=$P(DATA,U)  ;??? Temporary fix for Vitals API bug
"RTN","RORHL16",104,0)
 . . I $L(MEASDATE)=8  S:$E(MEASDATE,8)="0" MEASDATE=$E(MEASDATE,1,7)
"RTN","RORHL16",105,0)
 . . S MEASDATE=$$FM2HL^RORHL7(MEASDATE)
"RTN","RORHL16",106,0)
 . . S UNITS=$P(DATA,U,13)
"RTN","RORHL16",107,0)
 . . S BODYMASS=$S(TYPE="WT":$P(DATA,U,14),1:"")
"RTN","RORHL16",108,0)
 . . ;
"RTN","RORHL16",109,0)
 . . S OBX5=$P(DATA,U,8)_U_$P(DATA,U,11)_U_$P(DATA,U,17)
"RTN","RORHL16",110,0)
 . . D SETOBX(OBID,IEN,OBX5,UNITS,BODYMASS,MEASDATE)
"RTN","RORHL16",111,0)
 ;
"RTN","RORHL16",112,0)
 Q
"RTN","RORHL16",113,0)
 ;
"RTN","RORHL16",114,0)
 ;*** CREATES AND STORES THE OBX SEGMENT
"RTN","RORHL16",115,0)
SETOBX(OBX3,OBX4,OBX5,OBX6,OBX7,OBX14) ;
"RTN","RORHL16",116,0)
 N RORSEG
"RTN","RORHL16",117,0)
 ;--- Initialize the segment
"RTN","RORHL16",118,0)
 S RORSEG(0)="OBX"
"RTN","RORHL16",119,0)
 ;--- OBX-2
"RTN","RORHL16",120,0)
 S RORSEG(2)="FT"
"RTN","RORHL16",121,0)
 ;---
"RTN","RORHL16",122,0)
 S RORSEG(3)=OBX3
"RTN","RORHL16",123,0)
 S RORSEG(4)=OBX4
"RTN","RORHL16",124,0)
 S RORSEG(5)=$$ESCAPE^RORHL7(OBX5)
"RTN","RORHL16",125,0)
 S:$G(OBX6)'="" RORSEG(6)=OBX6
"RTN","RORHL16",126,0)
 S:$G(OBX7)'="" RORSEG(7)=OBX7
"RTN","RORHL16",127,0)
 S:$G(OBX14)'="" RORSEG(14)=OBX14
"RTN","RORHL16",128,0)
 ;--- OBX-11
"RTN","RORHL16",129,0)
 S RORSEG(11)="F"
"RTN","RORHL16",130,0)
 ;--- Store the segment
"RTN","RORHL16",131,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL16",132,0)
 Q
"RTN","RORHL17")
0^69^B29166670
"RTN","RORHL17",1,0)
RORHL17 ;HOIFO/BH,SG - HL7 PROBLEM LIST: OBR,OBX ; 1/23/06 2:22pm
"RTN","RORHL17",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL17",3,0)
 ;
"RTN","RORHL17",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL17",5,0)
 ;
"RTN","RORHL17",6,0)
 ; #2308         Access to PROBLEM file #9000011 (controlled)
"RTN","RORHL17",7,0)
 ; #2644         $$MOD^GMPLUTL3 (controlled)
"RTN","RORHL17",8,0)
 ; #3990         $$CODEC^ICDCODE (supported)
"RTN","RORHL17",9,0)
 ; #4743         GET^GMPLWP (controlled)
"RTN","RORHL17",10,0)
 ;
"RTN","RORHL17",11,0)
 Q
"RTN","RORHL17",12,0)
 ;
"RTN","RORHL17",13,0)
 ;***** SEARCHES FOR Problem List DATA
"RTN","RORHL17",14,0)
 ;
"RTN","RORHL17",15,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL17",16,0)
 ;
"RTN","RORHL17",17,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL17",18,0)
 ;               data extraction time frames are stored.
"RTN","RORHL17",19,0)
 ;
"RTN","RORHL17",20,0)
 ; Return Values:
"RTN","RORHL17",21,0)
 ;       <0  Error code
"RTN","RORHL17",22,0)
 ;        0  Ok
"RTN","RORHL17",23,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL17",24,0)
 ;
"RTN","RORHL17",25,0)
 ;
"RTN","RORHL17",26,0)
EN1(RORDFN,DXDTS) ;
"RTN","RORHL17",27,0)
 N CS,DFN,GMRVSTR,IDX,PROBIEN,RC,RORARR,RORBUF,RORENDT,RORMSG,RORSTDT,RORTMP,TMP
"RTN","RORHL17",28,0)
 S (ERRCNT,RC)=0
"RTN","RORHL17",29,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL17",30,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORHL17",31,0)
 ;
"RTN","RORHL17",32,0)
 S IDX=0
"RTN","RORHL17",33,0)
 F  S IDX=$O(DXDTS(16,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL17",34,0)
 . S RORSTDT=$P(DXDTS(16,IDX),U),RORENDT=$P(DXDTS(16,IDX),U,2)
"RTN","RORHL17",35,0)
 . ;--- Check to see is any problems have been entered/modified
"RTN","RORHL17",36,0)
 . ;--- during the data extraction time frame
"RTN","RORHL17",37,0)
 . S MDATE=$$MOD^GMPLUTL3(RORDFN)
"RTN","RORHL17",38,0)
 . Q:(MDATE<RORSTDT)!(MDATE'<RORENDT)
"RTN","RORHL17",39,0)
 . ;--- Find newly entered problems or modified problems
"RTN","RORHL17",40,0)
 . S PROBIEN=""
"RTN","RORHL17",41,0)
 . F  S PROBIEN=$O(^AUPNPROB("AC",RORDFN,PROBIEN)) Q:'PROBIEN  D
"RTN","RORHL17",42,0)
 . . S TMP=$$LOAD(.RORARR,PROBIEN)  Q:TMP="S"
"RTN","RORHL17",43,0)
 . . S:TMP>0 ERRCNT=ERRCNT+TMP
"RTN","RORHL17",44,0)
 . . ;---
"RTN","RORHL17",45,0)
 . . S TMP=$$OBR(.RORARR)
"RTN","RORHL17",46,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL17",47,0)
 . . S TMP=$$OBX(.RORARR)
"RTN","RORHL17",48,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL17",49,0)
 ;
"RTN","RORHL17",50,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORHL17",51,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL17",52,0)
 ;
"RTN","RORHL17",53,0)
 ;***** VALIDATES THE DATE
"RTN","RORHL17",54,0)
CHECK(DATE) ;
"RTN","RORHL17",55,0)
 Q:DATE'>0 ""
"RTN","RORHL17",56,0)
 Q:$E(DATE,1,3)>$E(DT,1,3) ""
"RTN","RORHL17",57,0)
 S:$E(DATE,4,5)="00" $E(DATE,4,5)="01"
"RTN","RORHL17",58,0)
 S:$E(DATE,6,7)="00" $E(DATE,6,7)="01"
"RTN","RORHL17",59,0)
 Q $$FM2HL^RORHL7(DATE)
"RTN","RORHL17",60,0)
 ;
"RTN","RORHL17",61,0)
 ;I $E(DATE,1,2)="20",$E(DATE,3,4)>$E(DT,2,3) Q ""
"RTN","RORHL17",62,0)
 ;
"RTN","RORHL17",63,0)
 ;*****
"RTN","RORHL17",64,0)
LOAD(RORARR,PROBIEN) ;
"RTN","RORHL17",65,0)
 N CNT,ERRCNT,IENS,MDATE,NOTE,REC,REC1,SUB3,SUB5,STAT
"RTN","RORHL17",66,0)
 K RORARR,@RORTMP  S ERRCNT=0
"RTN","RORHL17",67,0)
 ;
"RTN","RORHL17",68,0)
 S REC=$G(^AUPNPROB(PROBIEN,0))
"RTN","RORHL17",69,0)
 S REC1=$G(^AUPNPROB(PROBIEN,1))
"RTN","RORHL17",70,0)
 S MDATE=$P(REC,U,3)
"RTN","RORHL17",71,0)
 Q:(MDATE<RORSTDT)!(MDATE'<RORENDT) "S"
"RTN","RORHL17",72,0)
 ;
"RTN","RORHL17",73,0)
 S RORARR("OBR","FACIL")=$P(REC,U,6)
"RTN","RORHL17",74,0)
 S RORARR("OBR","NMBR")=$P(REC,U,7)
"RTN","RORHL17",75,0)
 S RORARR("OBR","COND")=$P(REC1,U,2)
"RTN","RORHL17",76,0)
 S RORARR("OBR","DE")=$$FMTHL7^XLFDT($P(REC,U,8))
"RTN","RORHL17",77,0)
 S RORARR("OBR","DOO")=$$CHECK($P(REC,U,13))
"RTN","RORHL17",78,0)
 S RORARR("OBR","DR")=$$CHECK($P(REC1,U,7))
"RTN","RORHL17",79,0)
 ;
"RTN","RORHL17",80,0)
 S DIAG=$$CODEC^ICDCODE(+$P(REC,U))
"RTN","RORHL17",81,0)
 S:DIAG<0 DIAG=""
"RTN","RORHL17",82,0)
 ;
"RTN","RORHL17",83,0)
 S RORARR("OBR","DIAG")=DIAG
"RTN","RORHL17",84,0)
 S RORARR("OBR","DR")=$$FMTHL7^XLFDT($P(REC1,U,9))
"RTN","RORHL17",85,0)
 S RORARR("OBR","RP")=$P(REC1,U,4)
"RTN","RORHL17",86,0)
 S RORARR("OBR","DLM")=$$FMTHL7^XLFDT(MDATE)
"RTN","RORHL17",87,0)
 S RORARR("OBR","ST")=$P(REC,U,12)
"RTN","RORHL17",88,0)
 ;
"RTN","RORHL17",89,0)
 S RORARR("OBX","PR")=$$GET1^DIQ(9000011,PROBIEN,.05,"E")
"RTN","RORHL17",90,0)
 S RORARR("OBX","PROB")=$$GET1^DIQ(9000011,PROBIEN,1.01,"E")
"RTN","RORHL17",91,0)
 ;
"RTN","RORHL17",92,0)
 I $D(ROREXT("PATCH","GMPL*2*30"))  D
"RTN","RORHL17",93,0)
 . D GET^GMPLWP(RORTMP,PROBIEN)
"RTN","RORHL17",94,0)
 E  I $D(^AUPNPROB(PROBIEN,11))>1  D
"RTN","RORHL17",95,0)
 . S SUB3=0,CNT=0
"RTN","RORHL17",96,0)
 . F  S SUB3=$O(^AUPNPROB(PROBIEN,11,SUB3))  Q:'SUB3  D
"RTN","RORHL17",97,0)
 . . S SUB5=0
"RTN","RORHL17",98,0)
 . . F  S SUB5=$O(^AUPNPROB(PROBIEN,11,SUB3,11,SUB5))  Q:'SUB5  D
"RTN","RORHL17",99,0)
 . . . S IENS=SUB5_","_SUB3_","_PROBIEN_","
"RTN","RORHL17",100,0)
 . . . S NOTE=$$GET1^DIQ(9000011.1111,IENS,.03,,,"RORMSG")
"RTN","RORHL17",101,0)
 . . . S CNT=CNT+1,@RORTMP@(CNT)=NOTE
"RTN","RORHL17",102,0)
 ;
"RTN","RORHL17",103,0)
 Q ERRCNT
"RTN","RORHL17",104,0)
 ;
"RTN","RORHL17",105,0)
 ;***** PROBLEM LIST OBR SEGMENT BUILDER
"RTN","RORHL17",106,0)
 ;
"RTN","RORHL17",107,0)
 ; Return Values:
"RTN","RORHL17",108,0)
 ;       <0  Error code
"RTN","RORHL17",109,0)
 ;        0  Ok
"RTN","RORHL17",110,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL17",111,0)
 ;
"RTN","RORHL17",112,0)
OBR(RORARR) ;
"RTN","RORHL17",113,0)
 N CLASS,CS,ERRCNT,PRV,RC,RORMSG,RORSEG,TMP,TMP1
"RTN","RORHL17",114,0)
 S (ERRCNT,RC)=0
"RTN","RORHL17",115,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL17",116,0)
 ;
"RTN","RORHL17",117,0)
 ;--- Initialize the segment
"RTN","RORHL17",118,0)
 S RORSEG(0)="OBR"
"RTN","RORHL17",119,0)
 ;
"RTN","RORHL17",120,0)
 ;--- OBR-3 - Filler Order Number
"RTN","RORHL17",121,0)
 S RORSEG(3)=RORARR("OBR","FACIL")_RORARR("OBR","NMBR")
"RTN","RORHL17",122,0)
 ;
"RTN","RORHL17",123,0)
 ;--- OBR-4 - Problem List CPT Code
"RTN","RORHL17",124,0)
 S RORSEG(4)="90125"_CS_"HOSPITAL CARE,NEW, INTERMED."_CS_"C4"
"RTN","RORHL17",125,0)
 ;
"RTN","RORHL17",126,0)
 ;--- OBR-6 - Requested Date/time (Date Entered)
"RTN","RORHL17",127,0)
 S RORSEG(6)=RORARR("OBR","DE")
"RTN","RORHL17",128,0)
 ;
"RTN","RORHL17",129,0)
 ;--- OBR-7 - Observation Date/Time (Date Appeared)
"RTN","RORHL17",130,0)
 S RORSEG(7)=RORARR("OBR","DOO")
"RTN","RORHL17",131,0)
 ;
"RTN","RORHL17",132,0)
 ;--- OBR-8 - Observation End Date/Time (Date Resolved/Inactivated)
"RTN","RORHL17",133,0)
 S RORSEG(8)=RORARR("OBR","DR")
"RTN","RORHL17",134,0)
 ;
"RTN","RORHL17",135,0)
 ;--- OBR-13 -  Relevant Clinical Info. (Diagnosis Code)
"RTN","RORHL17",136,0)
 S RORSEG(13)=RORARR("OBR","DIAG")
"RTN","RORHL17",137,0)
 ;
"RTN","RORHL17",138,0)
 ;--- OBR-14 - Specimen Received Date/time (Date Resolved/Inactivated)
"RTN","RORHL17",139,0)
 S RORSEG(14)=RORARR("OBR","DR")
"RTN","RORHL17",140,0)
 ;
"RTN","RORHL17",141,0)
 ;--- OBR-16 - Ordering Provider
"RTN","RORHL17",142,0)
 S PRV=RORARR("OBR","RP")
"RTN","RORHL17",143,0)
 S TMP=$$GET1^DIQ(200,PRV_",",53.5,"E",,"RORMSG")
"RTN","RORHL17",144,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL17",145,0)
 . D DBS^RORERR("RORMSG",-99,,RORDFN,200,PRV_",")
"RTN","RORHL17",146,0)
 E  S $P(PRV,CS,13)=$$ESCAPE^RORHL7(TMP)
"RTN","RORHL17",147,0)
 S RORSEG(16)=PRV
"RTN","RORHL17",148,0)
 ;
"RTN","RORHL17",149,0)
 ;--- OBR-20 - Filler Field 1 (Condition of the Record)
"RTN","RORHL17",150,0)
 S RORSEG(20)=RORARR("OBR","COND")
"RTN","RORHL17",151,0)
 ;
"RTN","RORHL17",152,0)
 ;--- OBR-22 - Results Rpt/Status Change Date/time  (Last Modified)
"RTN","RORHL17",153,0)
 S RORSEG(22)=RORARR("OBR","DLM")
"RTN","RORHL17",154,0)
 ;
"RTN","RORHL17",155,0)
 ;--- OBR-24 - Diagnostic Service ID
"RTN","RORHL17",156,0)
 S RORSEG(24)="TX"
"RTN","RORHL17",157,0)
 ;
"RTN","RORHL17",158,0)
 ;--- OBR-25 - Result Status (Status of the Problem)
"RTN","RORHL17",159,0)
 S TMP1=RORARR("OBR","ST")
"RTN","RORHL17",160,0)
 S TMP=$S(TMP1="A":"F",TMP1="I":"R",1:"")
"RTN","RORHL17",161,0)
 S RORSEG(25)=TMP
"RTN","RORHL17",162,0)
 ;
"RTN","RORHL17",163,0)
 ;--- OBR-44 - Division
"RTN","RORHL17",164,0)
 S RORSEG(44)=$$SITE^RORUTL03(CS)
"RTN","RORHL17",165,0)
 ;
"RTN","RORHL17",166,0)
 ;--- Store the segment
"RTN","RORHL17",167,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL17",168,0)
 Q ERRCNT
"RTN","RORHL17",169,0)
 ;
"RTN","RORHL17",170,0)
 ;***** PROBLEM LIST OBX SEGMENT(S) BUILDER
"RTN","RORHL17",171,0)
 ;
"RTN","RORHL17",172,0)
 ; Return Values:
"RTN","RORHL17",173,0)
 ;       <0  Error code
"RTN","RORHL17",174,0)
 ;        0  Ok
"RTN","RORHL17",175,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL17",176,0)
 ;
"RTN","RORHL17",177,0)
OBX(RORARR) ;
"RTN","RORHL17",178,0)
 N BR,CS,ERRCNT,NDX,OBX3,RC
"RTN","RORHL17",179,0)
 S (ERRCNT,RC)=0
"RTN","RORHL17",180,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL17",181,0)
 S BR=$E(HLECH,3)_".br"_$E(HLECH,3)
"RTN","RORHL17",182,0)
 ;
"RTN","RORHL17",183,0)
 I $D(RORARR("OBX","PR")) D
"RTN","RORHL17",184,0)
 . S OBX3="PRVN"_CS_"Provider Narrative"_CS_"VA080"
"RTN","RORHL17",185,0)
 . D SETOBX(OBX3,"",$$ESCAPE^RORHL7(RORARR("OBX","PR")))
"RTN","RORHL17",186,0)
 ;
"RTN","RORHL17",187,0)
 I $D(RORARR("OBX","PROB")) D
"RTN","RORHL17",188,0)
 . S OBX3="EXPR"_CS_"Expression"_CS_"VA080"
"RTN","RORHL17",189,0)
 . D SETOBX(OBX3,"",$$ESCAPE^RORHL7(RORARR("OBX","PROB")))
"RTN","RORHL17",190,0)
 ;
"RTN","RORHL17",191,0)
 S OBX3="NOTE"_CS_"Note Narrative"_CS_"VA080"
"RTN","RORHL17",192,0)
 D SETOBXWP^RORHLUT1(RORTMP,OBX3)
"RTN","RORHL17",193,0)
 ;
"RTN","RORHL17",194,0)
 Q ERRCNT
"RTN","RORHL17",195,0)
 ;
"RTN","RORHL17",196,0)
 ;*** CREATES AND STORES THE OBX SEGMENT
"RTN","RORHL17",197,0)
SETOBX(OBX3,OBX4,OBX5) ;
"RTN","RORHL17",198,0)
 N RORSEG
"RTN","RORHL17",199,0)
 ;--- Initialize the segment
"RTN","RORHL17",200,0)
 S RORSEG(0)="OBX"
"RTN","RORHL17",201,0)
 ;--- OBX-2
"RTN","RORHL17",202,0)
 S RORSEG(2)="FT"
"RTN","RORHL17",203,0)
 ;--- OBX-3
"RTN","RORHL17",204,0)
 S RORSEG(3)=OBX3
"RTN","RORHL17",205,0)
 ;--- OBX-4
"RTN","RORHL17",206,0)
 S:$G(OBX4)'="" RORSEG(4)=OBX4
"RTN","RORHL17",207,0)
 ;--- OBX-5
"RTN","RORHL17",208,0)
 S RORSEG(5)=OBX5
"RTN","RORHL17",209,0)
 ;--- OBX-11
"RTN","RORHL17",210,0)
 S RORSEG(11)="F"
"RTN","RORHL17",211,0)
 ;--- Store the segment
"RTN","RORHL17",212,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL17",213,0)
 Q
"RTN","RORHL21")
1^70
"RTN","RORHL7")
0^71^B33346768
"RTN","RORHL7",1,0)
RORHL7 ;HCIOFO/SG - HL7 UTILITIES ; 11/2/05 10:30am
"RTN","RORHL7",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL7",3,0)
 ;
"RTN","RORHL7",4,0)
 Q
"RTN","RORHL7",5,0)
 ;
"RTN","RORHL7",6,0)
 ;***** ADDS THE SEGMENT TO THE HL7 MESSAGE BUFFER
"RTN","RORHL7",7,0)
 ;
"RTN","RORHL7",8,0)
 ; .SOURCE       Reference to a local variable where the
"RTN","RORHL7",9,0)
 ;               source data is stored
"RTN","RORHL7",10,0)
 ;
"RTN","RORHL7",11,0)
 ; [SRCTYPE]     Type and format of the source data
"RTN","RORHL7",12,0)
 ;                 "C"  Complete segment (see the ADDSEGC^RORHL7A
"RTN","RORHL7",13,0)
 ;                      for source data format description)
"RTN","RORHL7",14,0)
 ;                 "F"  List of field values (see the ADDSEGF^RORHL7A 
"RTN","RORHL7",15,0)
 ;                      for source data format description).
"RTN","RORHL7",16,0)
 ;                      This is the default parameter value.
"RTN","RORHL7",17,0)
 ;
"RTN","RORHL7",18,0)
ADDSEG(SOURCE,SRCTYPE) ;
"RTN","RORHL7",19,0)
 I $G(SRCTYPE)?."F"  D ADDSEGF^RORHL7A(.SOURCE)  Q
"RTN","RORHL7",20,0)
 I SRCTYPE="C"       D ADDSEGC^RORHL7A(.SOURCE)  Q
"RTN","RORHL7",21,0)
 D ERROR^RORERR(-88,,,,"SRCTYPE",$G(SRCTYPE))
"RTN","RORHL7",22,0)
 Q
"RTN","RORHL7",23,0)
 ;
"RTN","RORHL7",24,0)
 ;***** CREATES A NEW MESSAGE IN THE BATCH
"RTN","RORHL7",25,0)
 ;
"RTN","RORHL7",26,0)
 ; The function adds a new message header to the batch. If the batch
"RTN","RORHL7",27,0)
 ; does not exist yet, it is created.
"RTN","RORHL7",28,0)
 ;
"RTN","RORHL7",29,0)
 ; [.RORMSH]     Reference to a variable in what a MSH segment of
"RTN","RORHL7",30,0)
 ;               the message is returned.
"RTN","RORHL7",31,0)
 ;
"RTN","RORHL7",32,0)
 ; Return Values:
"RTN","RORHL7",33,0)
 ;        <0  Error Code
"RTN","RORHL7",34,0)
 ;        >0  Index of a subnode of the ^TMP("HLS",$J) that
"RTN","RORHL7",35,0)
 ;            contains the new MSH segment.
"RTN","RORHL7",36,0)
 ;
"RTN","RORHL7",37,0)
 ; MSH segment is returned as a value of the RORMSH parameter. In case
"RTN","RORHL7",38,0)
 ; of a long segment, continuations are returned as subnodes.
"RTN","RORHL7",39,0)
 ;
"RTN","RORHL7",40,0)
 ; Several nodes (HL7*) in ROREXT are set and the ^TMP("HLS",$J) node
"RTN","RORHL7",41,0)
 ; is deleted by this entry point before it creates a new batch.
"RTN","RORHL7",42,0)
 ;
"RTN","RORHL7",43,0)
CREATE(RORMSH) ;
"RTN","RORHL7",44,0)
 N NDX,RC,TMP  K RORMSH
"RTN","RORHL7",45,0)
 Q:$G(ROREXT("HL7PROT"))="" $$ERROR^RORERR(-25)
"RTN","RORHL7",46,0)
 ;--- Create a message stub for the new batch message
"RTN","RORHL7",47,0)
 ;    (if it has not been created before)
"RTN","RORHL7",48,0)
 I '$G(ROREXT("HL7MTIEN"))  D  Q:$G(RC)<0 RC
"RTN","RORHL7",49,0)
 . N RORMID,RORIEN,RORDT
"RTN","RORHL7",50,0)
 . ;--- Set up HL7 environment variables
"RTN","RORHL7",51,0)
 . S RC=$$INIT($NA(^TMP("HLS",$J)))  Q:RC<0
"RTN","RORHL7",52,0)
 . ;--- Create a stub
"RTN","RORHL7",53,0)
 . S RORDT=$S($G(ROREXT("HDTIEN"))>0:$G(ROREXT("HL7DT")),1:"")
"RTN","RORHL7",54,0)
 . D CREATE^HLTF(.RORMID,.RORIEN,.RORDT)
"RTN","RORHL7",55,0)
 . ;--- Save parameters of the new batch message
"RTN","RORHL7",56,0)
 . S (ROREXT("HL7CNT"),ROREXT("HL7SIZE"))=0
"RTN","RORHL7",57,0)
 . S ROREXT("HL7DT")=RORDT
"RTN","RORHL7",58,0)
 . S ROREXT("HL7MID")=RORMID
"RTN","RORHL7",59,0)
 . S ROREXT("HL7MTIEN")=RORIEN
"RTN","RORHL7",60,0)
 . ;--- Initialize temporary storage
"RTN","RORHL7",61,0)
 . K ^TMP("HLS",$J)
"RTN","RORHL7",62,0)
 ;--- Initialize the HL7 environment variables
"RTN","RORHL7",63,0)
 S RC=$$INIT()  Q:RC<0 RC
"RTN","RORHL7",64,0)
 S NDX=$G(ROREXT("HL7PTR"))+1
"RTN","RORHL7",65,0)
 ;--- Reset the Set ID's for all supported segments
"RTN","RORHL7",66,0)
 F TMP="OBR","OBX","PID","PV1","ZRD","ZSP"  D
"RTN","RORHL7",67,0)
 . S ROREXT("HL7SID",TMP)=1
"RTN","RORHL7",68,0)
 ;--- Create and store a MSH segment for individual message
"RTN","RORHL7",69,0)
 S ROREXT("HL7CNT")=ROREXT("HL7CNT")+1
"RTN","RORHL7",70,0)
 S TMP=ROREXT("HL7MID")_"-"_ROREXT("HL7CNT")
"RTN","RORHL7",71,0)
 D MSH^HLFNC2(.RORHL,TMP,.RORMSH)
"RTN","RORHL7",72,0)
 S:$P(RORMSH,RORHL("FS"),17)="US" $P(RORMSH,RORHL("FS"),17)="USA"
"RTN","RORHL7",73,0)
 M ^TMP("HLS",$J,NDX)=RORMSH
"RTN","RORHL7",74,0)
 S ROREXT("HL7SIZE")=ROREXT("HL7SIZE")+$L(RORMSH)+$L($G(RORMSH(1)))+1
"RTN","RORHL7",75,0)
 S ROREXT("HL7PTR")=NDX
"RTN","RORHL7",76,0)
 Q NDX
"RTN","RORHL7",77,0)
 ;
"RTN","RORHL7",78,0)
 ;***** REPLACES ENCODING CHARACTERS WITH ESCAPE CODES
"RTN","RORHL7",79,0)
 ;
"RTN","RORHL7",80,0)
 ; STR           Source string
"RTN","RORHL7",81,0)
 ;
"RTN","RORHL7",82,0)
 ; The HLFS and HLECH variables must be initialized before
"RTN","RORHL7",83,0)
 ; calling this function (either by the INIT^HLFNC2 or manually).
"RTN","RORHL7",84,0)
 ;
"RTN","RORHL7",85,0)
 ; The function returns the source string with encoding
"RTN","RORHL7",86,0)
 ; characters replaced with corresponding escape codes.
"RTN","RORHL7",87,0)
 ;
"RTN","RORHL7",88,0)
ESCAPE(STR) ;
"RTN","RORHL7",89,0)
 Q:STR="" STR
"RTN","RORHL7",90,0)
 N BUF,ESC,CH,I1,I2,SCLST
"RTN","RORHL7",91,0)
 S SCLST=HLECH_HLFS
"RTN","RORHL7",92,0)
 ;--- Find all occurrences of encoding characters and
"RTN","RORHL7",93,0)
 ;    save their positions to a local array
"RTN","RORHL7",94,0)
 F I1=1:1:5  S CH=$E(SCLST,I1),I2=1  Q:CH=""  D
"RTN","RORHL7",95,0)
 . F  S I2=$F(STR,CH,I2)  Q:'I2  S BUF(I2-1)=I1
"RTN","RORHL7",96,0)
 Q:$D(BUF)<10 STR
"RTN","RORHL7",97,0)
 ;--- Replace encoding characters with escape codes
"RTN","RORHL7",98,0)
 S (BUF,I2)="",ESC=$E(HLECH,3)  S:ESC="" ESC="\"
"RTN","RORHL7",99,0)
 F  S I1=I2,I2=$O(BUF(I2))  Q:I2=""  D
"RTN","RORHL7",100,0)
 . S BUF=BUF_$E(STR,I1+1,I2-1)_ESC_$E("SRETF",BUF(I2))_ESC
"RTN","RORHL7",101,0)
 Q BUF_$E(STR,I1+1,$L(STR))
"RTN","RORHL7",102,0)
 ;
"RTN","RORHL7",103,0)
 ;***** CHECKS THE DATE/TIME AND CONVERTS IT TO HL7 FORMAT
"RTN","RORHL7",104,0)
 ;
"RTN","RORHL7",105,0)
 ; DATE          Date/time in FileMan format
"RTN","RORHL7",106,0)
 ;
"RTN","RORHL7",107,0)
FM2HL(DATE) ;
"RTN","RORHL7",108,0)
 Q:'$G(DATE) """"""
"RTN","RORHL7",109,0)
 S DATE=$$FMTHL7^XLFDT(DATE)
"RTN","RORHL7",110,0)
 Q $S(DATE>0:DATE,1:"")
"RTN","RORHL7",111,0)
 ;
"RTN","RORHL7",112,0)
 ;***** INITIALIZES THE HL7 SEPARATORS
"RTN","RORHL7",113,0)
 ;
"RTN","RORHL7",114,0)
 ; [.CS]         Reference to a local variable where the
"RTN","RORHL7",115,0)
 ;               component separator will be returned to.
"RTN","RORHL7",116,0)
 ;
"RTN","RORHL7",117,0)
 ; [.SCS]        Reference to a local variable where the
"RTN","RORHL7",118,0)
 ;               sub-component separator will be returned to.
"RTN","RORHL7",119,0)
 ;
"RTN","RORHL7",120,0)
 ; [.RPS]        Reference to a local variable where the
"RTN","RORHL7",121,0)
 ;               repetition separator will be returned to.
"RTN","RORHL7",122,0)
 ;
"RTN","RORHL7",123,0)
ECH(CS,SCS,RPS) ;
"RTN","RORHL7",124,0)
 S HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL7",125,0)
 S CS=$E(HLECH,1),SCS=$E(HLECH,4),RPS=$E(HLECH,2)
"RTN","RORHL7",126,0)
 Q
"RTN","RORHL7",127,0)
 ;
"RTN","RORHL7",128,0)
 ;***** INITIALIZES THE HL7 ENVIRONMENT VARIABLES
"RTN","RORHL7",129,0)
 ;
"RTN","RORHL7",130,0)
 ; [ROR8FILE]    Closed root of the buffer that will be used for
"RTN","RORHL7",131,0)
 ;               construction of the HL7 message.
"RTN","RORHL7",132,0)
 ;
"RTN","RORHL7",133,0)
 ; Return Values:
"RTN","RORHL7",134,0)
 ;        <0  Error Code
"RTN","RORHL7",135,0)
 ;         0  Ok
"RTN","RORHL7",136,0)
 ;
"RTN","RORHL7",137,0)
INIT(ROR8FILE) ;
"RTN","RORHL7",138,0)
 N TMP  K RORHL
"RTN","RORHL7",139,0)
 D INIT^HLFNC2(ROREXT("HL7PROT"),.RORHL)
"RTN","RORHL7",140,0)
 Q:$G(RORHL) $$ERROR^RORERR(-23,,RORHL)
"RTN","RORHL7",141,0)
 S TMP=$G(RORHL("ECH"))
"RTN","RORHL7",142,0)
 Q:$L(TMP)<4 $$ERROR^RORERR(-75)
"RTN","RORHL7",143,0)
 ;--- Initialize the nodes required for the API's
"RTN","RORHL7",144,0)
 S:$G(ROR8FILE)'="" ROREXT("HL7BUF")=ROR8FILE
"RTN","RORHL7",145,0)
 D:$G(ROREXT("HL7BUF"))'=""
"RTN","RORHL7",146,0)
 . S ROREXT("HL7PTR")=+$O(@ROREXT("HL7BUF")@(""),-1)
"RTN","RORHL7",147,0)
 Q 0
"RTN","RORHL7",148,0)
 ;
"RTN","RORHL7",149,0)
 ;***** CHECKS IF MAXIMUM BATCH SIZE IS REACHED
"RTN","RORHL7",150,0)
 ;
"RTN","RORHL7",151,0)
 ; [RESERVE]     Number of bytes reserved in the batch (0 by default)
"RTN","RORHL7",152,0)
 ;
"RTN","RORHL7",153,0)
 ; Return Values:
"RTN","RORHL7",154,0)
 ;         0  Messages can be added to the batch
"RTN","RORHL7",155,0)
 ;         1  Maximum size of the batch has been reached
"RTN","RORHL7",156,0)
 ;
"RTN","RORHL7",157,0)
ISMAXSZ(RESERVE) ;
"RTN","RORHL7",158,0)
 Q:$G(ROREXT("MAXHL7SIZE"))'>0 0
"RTN","RORHL7",159,0)
 Q:($G(ROREXT("HL7SIZE"))+$G(RESERVE))<ROREXT("MAXHL7SIZE") 0
"RTN","RORHL7",160,0)
 S $P(ROREXT("HL7SIZE"),U,2)=1
"RTN","RORHL7",161,0)
 Q 1
"RTN","RORHL7",162,0)
 ;
"RTN","RORHL7",163,0)
 ;***** RETURNS NUMBER OF MESSAGES IN THE CURRENT BATCH
"RTN","RORHL7",164,0)
MSGCNT() ;
"RTN","RORHL7",165,0)
 Q $G(ROREXT("HL7CNT"))
"RTN","RORHL7",166,0)
 ;
"RTN","RORHL7",167,0)
 ;***** RETURNS THE POINTER TO LAST SEGMENT IN THE MESSAGE BUFFER
"RTN","RORHL7",168,0)
PTR() Q +$G(ROREXT("HL7PTR"))
"RTN","RORHL7",169,0)
 ;
"RTN","RORHL7",170,0)
 ;***** DELETES THE SEGMENTS FROM THE HL7 MESSAGE BUFFER
"RTN","RORHL7",171,0)
 ;
"RTN","RORHL7",172,0)
 ; SEGPTR        An index of the HL7 segment in the message buffer
"RTN","RORHL7",173,0)
 ;
"RTN","RORHL7",174,0)
 ; [KEEP]        Keep the segment referenced by the SEGPTR and start
"RTN","RORHL7",175,0)
 ;               the rollback from the next segment.
"RTN","RORHL7",176,0)
 ;
"RTN","RORHL7",177,0)
ROLLBACK(SEGPTR,KEEP) ;
"RTN","RORHL7",178,0)
 N BUF,I,I1,MSH,NODE,SEGNAME
"RTN","RORHL7",179,0)
 S NODE=ROREXT("HL7BUF"),HLFS=$G(RORHL("FS"),"|")
"RTN","RORHL7",180,0)
 S I=$S($G(KEEP):$O(@NODE@(SEGPTR)),1:+SEGPTR)
"RTN","RORHL7",181,0)
 S MSH=$S(I>0:$P($G(@NODE@(I)),HLFS)="MSH",1:0)
"RTN","RORHL7",182,0)
 ;---
"RTN","RORHL7",183,0)
 F  Q:I'>0  D  S I=$O(@NODE@(I))
"RTN","RORHL7",184,0)
 . S BUF=$G(@NODE@(I))
"RTN","RORHL7",185,0)
 . ;--- Decrement the batch size indicator
"RTN","RORHL7",186,0)
 . S ROREXT("HL7SIZE")=$G(ROREXT("HL7SIZE"))-$L(BUF)-1
"RTN","RORHL7",187,0)
 . S I1=""
"RTN","RORHL7",188,0)
 . F  S I1=$O(@NODE@(I,I1))  Q:I1=""  D
"RTN","RORHL7",189,0)
 . . S ROREXT("HL7SIZE")=ROREXT("HL7SIZE")-$L(@NODE@(I,I1))
"RTN","RORHL7",190,0)
 . ;--- Decrement the 'Set ID' counter if necessary
"RTN","RORHL7",191,0)
 . S SEGNAME=$P(BUF,HLFS),I1=+$G(ROREXT("HL7SID",SEGNAME))
"RTN","RORHL7",192,0)
 . I I1>0  S:$P(BUF,HLFS,2)>0 ROREXT("HL7SID",SEGNAME)=I1-1
"RTN","RORHL7",193,0)
 . ;--- Delete the segment
"RTN","RORHL7",194,0)
 . K @NODE@(I)
"RTN","RORHL7",195,0)
 ;--- Validate current size of the batch
"RTN","RORHL7",196,0)
 S:$G(ROREXT("HL7SIZE"))<0 ROREXT("HL7SIZE")=0
"RTN","RORHL7",197,0)
 ;--- Decrease number of messages in the batch if necessary
"RTN","RORHL7",198,0)
 I MSH  S:$G(ROREXT("HL7CNT"))>0 ROREXT("HL7CNT")=ROREXT("HL7CNT")-1
"RTN","RORHL7",199,0)
 Q
"RTN","RORHL7",200,0)
 ;
"RTN","RORHL7",201,0)
 ;***** SENDS THE BATCH MESSAGE
"RTN","RORHL7",202,0)
 ;
"RTN","RORHL7",203,0)
 ; .MID          Reference to a local variable where the batch
"RTN","RORHL7",204,0)
 ;               message ID (returned by the GENERATE^HLMA) is
"RTN","RORHL7",205,0)
 ;               returned to.
"RTN","RORHL7",206,0)
 ;
"RTN","RORHL7",207,0)
 ; Return Values:
"RTN","RORHL7",208,0)
 ;        <0  Error Code
"RTN","RORHL7",209,0)
 ;         0  Ok
"RTN","RORHL7",210,0)
 ;        >0  There was nothing to send
"RTN","RORHL7",211,0)
 ;
"RTN","RORHL7",212,0)
 ; Several nodes (HL7*) in the ROREXT and the ^TMP("HLS",$J) node
"RTN","RORHL7",213,0)
 ; are deleted by this entry point.
"RTN","RORHL7",214,0)
 ;
"RTN","RORHL7",215,0)
SEND(MID) ;
"RTN","RORHL7",216,0)
 N RC,RORBUF,RORHLP  S MID=""
"RTN","RORHL7",217,0)
 Q:$G(ROREXT("HL7PROT"))="" $$ERROR^RORERR(-25)
"RTN","RORHL7",218,0)
 ;--- Quit if there is nothing to send
"RTN","RORHL7",219,0)
 Q:'$G(ROREXT("HL7MTIEN"))!($D(^TMP("HLS",$J))<10) 1
"RTN","RORHL7",220,0)
 ;--- Set up the HL7 environment variables
"RTN","RORHL7",221,0)
 D INIT^HLFNC2(ROREXT("HL7PROT"),.RORHL)
"RTN","RORHL7",222,0)
 Q:$G(RORHL) $$ERROR^RORERR(-23,,RORHL)
"RTN","RORHL7",223,0)
 ;--- Send the message
"RTN","RORHL7",224,0)
 S RORHLP("NAMESPACE")="ROR"
"RTN","RORHL7",225,0)
 D GENERATE^HLMA(ROREXT("HL7PROT"),"GB",1,.RORBUF,ROREXT("HL7MTIEN"),.RORHLP)
"RTN","RORHL7",226,0)
 S RC=$S($P(RORBUF,U,2):$$ERROR^RORERR(-24,,RORBUF),1:0)
"RTN","RORHL7",227,0)
 S MID=$P(RORBUF,U)
"RTN","RORHL7",228,0)
 ;--- Cleanup if there is no error or not in debug mode
"RTN","RORHL7",229,0)
 D:'$G(RORPARM("DEBUG"))!(RC'<0)
"RTN","RORHL7",230,0)
 . F TMP="HL7CNT","HL7MTIEN","HL7SIZE"  K ROREXT(TMP)
"RTN","RORHL7",231,0)
 . K ^TMP("HLS",$J)
"RTN","RORHL7",232,0)
 Q RC
"RTN","RORHL7A")
0^72^B35053076
"RTN","RORHL7A",1,0)
RORHL7A ;HCIOFO/SG - HL7 UTILITIES ; 7/29/05 1:35pm
"RTN","RORHL7A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHL7A",3,0)
 ;
"RTN","RORHL7A",4,0)
 Q
"RTN","RORHL7A",5,0)
 ;
"RTN","RORHL7A",6,0)
 ;***** ADDS THE SEGMENT TO THE HL7 MESSAGE BUFFER
"RTN","RORHL7A",7,0)
 ;
"RTN","RORHL7A",8,0)
 ; SEG           Complete HL7 segment
"RTN","RORHL7A",9,0)
 ;
"RTN","RORHL7A",10,0)
 ; The ADDSEGC^RORHL7A procedure adds the HL7 segment to the HL7
"RTN","RORHL7A",11,0)
 ; message buffer defined by the ROREXT("HL7BUF") parameter
"RTN","RORHL7A",12,0)
 ; (the ^TMP("HLS",$J), by default). The <TAB>, <CR> and <LF>
"RTN","RORHL7A",13,0)
 ; characters are replaced with spaces. Long segments are split
"RTN","RORHL7A",14,0)
 ; among sub-nodes of the main segment node in the destination
"RTN","RORHL7A",15,0)
 ; buffer.
"RTN","RORHL7A",16,0)
 ;
"RTN","RORHL7A",17,0)
 ; The RORHL array and some nodes of the ROREXT array must be
"RTN","RORHL7A",18,0)
 ; initialized (either by the $$INIT^RORHL7 or manually) before
"RTN","RORHL7A",19,0)
 ; calling this procedure.
"RTN","RORHL7A",20,0)
 ;
"RTN","RORHL7A",21,0)
ADDSEGC(SEG) ;
"RTN","RORHL7A",22,0)
 N I1,I2,MAXLEN,NODE,PTR,PTR1,SID,SL
"RTN","RORHL7A",23,0)
 S NODE=ROREXT("HL7BUF"),PTR=$G(ROREXT("HL7PTR"))+1
"RTN","RORHL7A",24,0)
 S HLFS=RORHL("FS"),HLECH=RORHL("ECH")
"RTN","RORHL7A",25,0)
 Q:$P(SEG,HLFS)=""  ; Segment Name
"RTN","RORHL7A",26,0)
 ;--- Assign the Set ID if necessary
"RTN","RORHL7A",27,0)
 S SID=$$SETID($P(SEG,HLFS))
"RTN","RORHL7A",28,0)
 S:SID>0 $P(SEG,HLFS,2)=SID
"RTN","RORHL7A",29,0)
 ;--- Remove empty trailing fields
"RTN","RORHL7A",30,0)
 S I2=$L(SEG,HLFS)
"RTN","RORHL7A",31,0)
 F I1=I2:-1:1  Q:$TR($P(SEG,HLFS,I1),HLECH)'=""
"RTN","RORHL7A",32,0)
 S:I1<I2 $P(SEG,HLFS,I1+1,I2)=""
"RTN","RORHL7A",33,0)
 ;--- Store the segment
"RTN","RORHL7A",34,0)
 S SL=$L(SEG),MAXLEN=245  K @NODE@(PTR)
"RTN","RORHL7A",35,0)
 S @NODE@(PTR)=$TR($E(SEG,1,MAXLEN),$C(9,10,13),"   ")
"RTN","RORHL7A",36,0)
 S ROREXT("HL7SIZE")=$G(ROREXT("HL7SIZE"))+SL+1
"RTN","RORHL7A",37,0)
 ;--- Split the segment into sub-nodes if necessary
"RTN","RORHL7A",38,0)
 D:SL>MAXLEN
"RTN","RORHL7A",39,0)
 . S I2=MAXLEN
"RTN","RORHL7A",40,0)
 . F PTR1=1:1  S I1=I2+1,I2=I1+MAXLEN-1  Q:I1>SL  D
"RTN","RORHL7A",41,0)
 . . S @NODE@(PTR,PTR1)=$TR($E(SEG,I1,I2),$C(9,10,13),"   ")
"RTN","RORHL7A",42,0)
 ;--- Save the pointer
"RTN","RORHL7A",43,0)
 S ROREXT("HL7PTR")=PTR
"RTN","RORHL7A",44,0)
 Q
"RTN","RORHL7A",45,0)
 ;
"RTN","RORHL7A",46,0)
 ;***** ASSEMBLES THE SEGMENT AND ADDS IT TO THE HL7 MESSAGE BUFFER
"RTN","RORHL7A",47,0)
 ;
"RTN","RORHL7A",48,0)
 ; .FIELDS       Reference to a local variable where the HL7
"RTN","RORHL7A",49,0)
 ;               fields are stored
"RTN","RORHL7A",50,0)
 ;
"RTN","RORHL7A",51,0)
 ;  FIELDS(
"RTN","RORHL7A",52,0)
 ;    0)         Segment name
"RTN","RORHL7A",53,0)
 ;    I,         Field value
"RTN","RORHL7A",54,0)
 ;      i)       Continuation of the value if it is
"RTN","RORHL7A",55,0)
 ;    ...        longer than than 245 characters
"RTN","RORHL7A",56,0)
 ;
"RTN","RORHL7A",57,0)
 ; The ADDSEGF^RORHL7A procedure assembles the HL7 segment from
"RTN","RORHL7A",58,0)
 ; provided field values and adds it to the HL7 message buffer
"RTN","RORHL7A",59,0)
 ; defined by the ROREXT("HL7BUF") node (the ^TMP("HLS",$J), by
"RTN","RORHL7A",60,0)
 ; default). The <TAB>, <CR> and <LF> characters are replaced with
"RTN","RORHL7A",61,0)
 ; spaces. Long segments are split among sub-nodes of the main
"RTN","RORHL7A",62,0)
 ; segment node in the destination buffer.
"RTN","RORHL7A",63,0)
 ;
"RTN","RORHL7A",64,0)
 ; The RORHL array and some nodes of the ROREXT array must be
"RTN","RORHL7A",65,0)
 ; initialized (either by the $$INIT^RORHL7 or manually) before
"RTN","RORHL7A",66,0)
 ; calling this procedure.
"RTN","RORHL7A",67,0)
 ;
"RTN","RORHL7A",68,0)
ADDSEGF(FIELDS) ;
"RTN","RORHL7A",69,0)
 ; RORBUF        Temporary buffer for the segment construction
"RTN","RORHL7A",70,0)
 ; RORIS         Current continuation subscript in the HL7 buffer
"RTN","RORHL7A",71,0)
 ; RORNODE       Closed root of the HL7 message buffer
"RTN","RORHL7A",72,0)
 ; RORPTR        Current subscript in the HL7 message buffer
"RTN","RORHL7A",73,0)
 ; RORSL         Number of characters that can be appended to the
"RTN","RORHL7A",74,0)
 ;               RORBUF before it has to be emptied into the HL7
"RTN","RORHL7A",75,0)
 ;               message buffer
"RTN","RORHL7A",76,0)
 ;
"RTN","RORHL7A",77,0)
 N FLD,I,LASTFLD,RORBUF,RORIS,RORNODE,RORPTR,RORSL
"RTN","RORHL7A",78,0)
 Q:$G(FIELDS(0))=""  ; Segment Name
"RTN","RORHL7A",79,0)
 S RORNODE=ROREXT("HL7BUF"),RORPTR=$G(ROREXT("HL7PTR"))+1
"RTN","RORHL7A",80,0)
 S HLFS=RORHL("FS"),HLECH=RORHL("ECH")
"RTN","RORHL7A",81,0)
 ;--- Assign the Set ID if necessary
"RTN","RORHL7A",82,0)
 S I=$$SETID(FIELDS(0))
"RTN","RORHL7A",83,0)
 S:I>0 FIELDS(1)=I
"RTN","RORHL7A",84,0)
 ;--- Remove empty trailing fields
"RTN","RORHL7A",85,0)
 S I=$NA(FIELDS(" "))
"RTN","RORHL7A",86,0)
 F  S I=$Q(@I,-1)  Q:I=""  Q:$TR(@I,HLECH)'=""  K @I
"RTN","RORHL7A",87,0)
 ;--- Initialize construction variables
"RTN","RORHL7A",88,0)
 S RORBUF=FIELDS(0),I=$L(RORBUF)
"RTN","RORHL7A",89,0)
 S ROREXT("HL7SIZE")=$G(ROREXT("HL7SIZE"))+I+1
"RTN","RORHL7A",90,0)
 S RORIS=0,RORSL=245-I
"RTN","RORHL7A",91,0)
 ;--- Append the fields and store the segment
"RTN","RORHL7A",92,0)
 S LASTFLD=+$O(FIELDS(" "),-1)
"RTN","RORHL7A",93,0)
 F FLD=1:1:LASTFLD  D
"RTN","RORHL7A",94,0)
 . D APPEND(HLFS_$G(FIELDS(FLD)))
"RTN","RORHL7A",95,0)
 . ;--- Process the field continuation nodes
"RTN","RORHL7A",96,0)
 . S I=""
"RTN","RORHL7A",97,0)
 . F  S I=$O(FIELDS(FLD,I))  Q:I=""  D APPEND(FIELDS(FLD,I))
"RTN","RORHL7A",98,0)
 ;--- Flush the buffer if necessary
"RTN","RORHL7A",99,0)
 D:RORBUF'=""
"RTN","RORHL7A",100,0)
 . I 'RORIS  S @RORNODE@(RORPTR)=RORBUF  Q
"RTN","RORHL7A",101,0)
 . S @RORNODE@(RORPTR,RORIS)=RORBUF
"RTN","RORHL7A",102,0)
 S ROREXT("HL7PTR")=RORPTR
"RTN","RORHL7A",103,0)
 Q
"RTN","RORHL7A",104,0)
 ;
"RTN","RORHL7A",105,0)
 ;***** APPENDS THE FIELD VALUE TO THE HL7 SEGMENT
"RTN","RORHL7A",106,0)
 ;
"RTN","RORHL7A",107,0)
 ; VAL           Value of the field (or its part)
"RTN","RORHL7A",108,0)
 ;
"RTN","RORHL7A",109,0)
 ; This is an internal function. Do not call it directly.
"RTN","RORHL7A",110,0)
 ;
"RTN","RORHL7A",111,0)
APPEND(VAL) ;
"RTN","RORHL7A",112,0)
 N BASE,L
"RTN","RORHL7A",113,0)
 S VAL=$TR(VAL,$C(9,10,13),"   "),L=$L(VAL)
"RTN","RORHL7A",114,0)
 S ROREXT("HL7SIZE")=$G(ROREXT("HL7SIZE"))+L
"RTN","RORHL7A",115,0)
 I L'>RORSL  S RORBUF=RORBUF_VAL,RORSL=RORSL-L  Q
"RTN","RORHL7A",116,0)
 ;---
"RTN","RORHL7A",117,0)
 S RORBUF=RORBUF_$E(VAL,1,RORSL),L=L-RORSL
"RTN","RORHL7A",118,0)
 S BASE=1
"RTN","RORHL7A",119,0)
 F  D  Q:L'>0
"RTN","RORHL7A",120,0)
 . I 'RORIS  S @RORNODE@(RORPTR)=RORBUF
"RTN","RORHL7A",121,0)
 . E  S @RORNODE@(RORPTR,RORIS)=RORBUF
"RTN","RORHL7A",122,0)
 . S BASE=BASE+RORSL,RORIS=RORIS+1,RORSL=245
"RTN","RORHL7A",123,0)
 . S RORBUF=$E(VAL,BASE,BASE+RORSL-1),L=L-RORSL
"RTN","RORHL7A",124,0)
 S RORSL=-L
"RTN","RORHL7A",125,0)
 Q
"RTN","RORHL7A",126,0)
 ;
"RTN","RORHL7A",127,0)
 ;***** RETURNS THE BHS SEGMENT
"RTN","RORHL7A",128,0)
 ;
"RTN","RORHL7A",129,0)
 ; BID           Batch message ID
"RTN","RORHL7A",130,0)
 ;
"RTN","RORHL7A",131,0)
 ; [BDT]         Batch message creation time in internal FileMan
"RTN","RORHL7A",132,0)
 ;               format (NOW by default)
"RTN","RORHL7A",133,0)
 ;
"RTN","RORHL7A",134,0)
 ; [COMMENT]     Optional comment
"RTN","RORHL7A",135,0)
 ;
"RTN","RORHL7A",136,0)
 ; The RORHL local variable must be initialized by the $$INIT^RORHL7
"RTN","RORHL7A",137,0)
 ; function before calling this entry point.
"RTN","RORHL7A",138,0)
 ;
"RTN","RORHL7A",139,0)
BHS(BID,BDT,COMMENT) ;
"RTN","RORHL7A",140,0)
 N CS,SEG,TMP
"RTN","RORHL7A",141,0)
 D BHS^HLFNC3(.RORHL,BID,.SEG)
"RTN","RORHL7A",142,0)
 Q:$G(SEG)="" ""
"RTN","RORHL7A",143,0)
 S HLFS=RORHL("FS"),HLECH=RORHL("ECH"),CS=$E(HLECH,1)
"RTN","RORHL7A",144,0)
 ;--- Post-processing
"RTN","RORHL7A",145,0)
 S SEG=SEG_$G(SEG(1))
"RTN","RORHL7A",146,0)
 S:$G(BDT)'>0 BDT=$$NOW^XLFDT
"RTN","RORHL7A",147,0)
 S TMP=$E($P($$SITE^VASITE,U,3),1,3)
"RTN","RORHL7A",148,0)
 S $P(SEG,HLFS,4)=TMP_CS_$G(^XMB("NETNAME"))_CS_"DNS"
"RTN","RORHL7A",149,0)
 S $P(SEG,HLFS,5)="ROR AAC"
"RTN","RORHL7A",150,0)
 S $P(SEG,HLFS,7)=$$FMTHL7^XLFDT(BDT)
"RTN","RORHL7A",151,0)
 S TMP=$P(SEG,HLFS,9)
"RTN","RORHL7A",152,0)
 S $P(TMP,CS,3)=$P(TMP,CS,3)_$E(HLECH,2)_$G(RORHL("ETN"))
"RTN","RORHL7A",153,0)
 S $P(SEG,HLFS,9)=TMP
"RTN","RORHL7A",154,0)
 S $P(SEG,HLFS,10)=$G(COMMENT)
"RTN","RORHL7A",155,0)
 Q SEG
"RTN","RORHL7A",156,0)
 ;
"RTN","RORHL7A",157,0)
 ;***** RETURNS BTS SEGMENT
"RTN","RORHL7A",158,0)
 ;
"RTN","RORHL7A",159,0)
 ; MSGCNT        Batch message count
"RTN","RORHL7A",160,0)
 ; [COMMENT]     Batch comment
"RTN","RORHL7A",161,0)
 ;
"RTN","RORHL7A",162,0)
 ; The RORHL variable must be initialized by the INIT^HLFNC2 before
"RTN","RORHL7A",163,0)
 ; calling this entry point
"RTN","RORHL7A",164,0)
 ;
"RTN","RORHL7A",165,0)
BTS(MSGCNT,COMMENT) ;
"RTN","RORHL7A",166,0)
 Q "BTS"_RORHL("FS")_MSGCNT_RORHL("FS")_$G(COMMENT)
"RTN","RORHL7A",167,0)
 ;
"RTN","RORHL7A",168,0)
 ;***** LOADS THE HL7 FIELD (OR ITS PART) TO THE BUFFER
"RTN","RORHL7A",169,0)
 ;
"RTN","RORHL7A",170,0)
 ; VAL           Value of the field (or its part)
"RTN","RORHL7A",171,0)
 ;
"RTN","RORHL7A",172,0)
 ; FLD           Number of the field in the segment (piece number)
"RTN","RORHL7A",173,0)
 ;
"RTN","RORHL7A",174,0)
FIELD(VAL,FLD) ;
"RTN","RORHL7A",175,0)
 N BASE,L
"RTN","RORHL7A",176,0)
 S:FLD>RORFLD RORFLD=FLD,RORIS=0,RORSL=245
"RTN","RORHL7A",177,0)
 S L=$L(VAL),BASE=1
"RTN","RORHL7A",178,0)
 F RORIS=RORIS:1  D  Q:L'>0
"RTN","RORHL7A",179,0)
 . I 'RORIS  S RORSEG(RORFLD)=$G(RORSEG(RORFLD))_$E(VAL,BASE,BASE+RORSL-1)
"RTN","RORHL7A",180,0)
 . E  S RORSEG(RORFLD,RORIS)=$G(RORSEG(RORFLD,RORIS))_$E(VAL,BASE,BASE+RORSL-1)
"RTN","RORHL7A",181,0)
 . S BASE=BASE+RORSL,L=L-RORSL,RORSL=245
"RTN","RORHL7A",182,0)
 S RORSL=-L
"RTN","RORHL7A",183,0)
 Q
"RTN","RORHL7A",184,0)
 ;
"RTN","RORHL7A",185,0)
 ;***** LOADS THE HL7 SEGMENT INTO THE RPOVIDED BUFFER
"RTN","RORHL7A",186,0)
 ;
"RTN","RORHL7A",187,0)
 ; .RORSEG       Reference to a local variable where the HL7
"RTN","RORHL7A",188,0)
 ;               fields will be stored. The fields are stored
"RTN","RORHL7A",189,0)
 ;               in the following format:
"RTN","RORHL7A",190,0)
 ;
"RTN","RORHL7A",191,0)
 ;                 RORSEG(FldNum)=FldVal
"RTN","RORHL7A",192,0)
 ;
"RTN","RORHL7A",193,0)
 ;               If the value is longer that 245 characters then
"RTN","RORHL7A",194,0)
 ;               the continuation nodes are created:
"RTN","RORHL7A",195,0)
 ;
"RTN","RORHL7A",196,0)
 ;                 RORSEG(FldNum,#)=FldValCont
"RTN","RORHL7A",197,0)
 ;
"RTN","RORHL7A",198,0)
 ; ROR8SRC       Closed root of the source buffer containing
"RTN","RORHL7A",199,0)
 ;               the HL7 segment
"RTN","RORHL7A",200,0)
 ;
"RTN","RORHL7A",201,0)
LOADSEG(RORSEG,ROR8SRC) ;
"RTN","RORHL7A",202,0)
 N BUF,FLD,I,IFL,NFL,RORFLD,RORIS,RORSL
"RTN","RORHL7A",203,0)
 S HLFS=RORHL("FS")  K RORSEG
"RTN","RORHL7A",204,0)
 ;--- Process the main segment
"RTN","RORHL7A",205,0)
 S BUF=$G(@ROR8SRC),NFL=$L(BUF,HLFS)
"RTN","RORHL7A",206,0)
 F IFL=1:1:NFL  S RORSEG(IFL-1)=$P(BUF,HLFS,IFL)
"RTN","RORHL7A",207,0)
 Q:$D(@ROR8SRC)<10
"RTN","RORHL7A",208,0)
 ;--- Process the sub-segments
"RTN","RORHL7A",209,0)
 S (FLD,RORFLD)=NFL-1,RORIS=0,RORSL=245-$L(RORSEG(FLD))
"RTN","RORHL7A",210,0)
 S I=""
"RTN","RORHL7A",211,0)
 F  S I=$O(@ROR8SRC@(I))  Q:I=""  D
"RTN","RORHL7A",212,0)
 . S BUF=@ROR8SRC@(I),NFL=$L(BUF,HLFS)
"RTN","RORHL7A",213,0)
 . D FIELD($P(BUF,HLFS),FLD)
"RTN","RORHL7A",214,0)
 . F IFL=2:1:NFL  S FLD=FLD+1  D FIELD($P(BUF,HLFS,IFL),FLD)
"RTN","RORHL7A",215,0)
 Q
"RTN","RORHL7A",216,0)
 ;
"RTN","RORHL7A",217,0)
 ;***** RETURNS TEXT EXPLANATIONS OF THE HL7 MESSAGE STATUS
"RTN","RORHL7A",218,0)
 ;
"RTN","RORHL7A",219,0)
 ; MSGST         Status value returned by the $$MSGSTAT^HLUTIL
"RTN","RORHL7A",220,0)
 ;
"RTN","RORHL7A",221,0)
MSGSTXT(MSGST) ;
"RTN","RORHL7A",222,0)
 N ST  S ST=+MSGST
"RTN","RORHL7A",223,0)
 Q:'ST "Message does not exist"
"RTN","RORHL7A",224,0)
 Q:ST=1 "Waiting in queue"
"RTN","RORHL7A",225,0)
 Q:ST=1.5 "Opening connection"
"RTN","RORHL7A",226,0)
 Q:ST=1.7 "Awaiting response"
"RTN","RORHL7A",227,0)
 Q:ST=2 "Awaiting application ack"
"RTN","RORHL7A",228,0)
 Q:ST=3 "Successfully completed"
"RTN","RORHL7A",229,0)
 Q:ST=4 "Error"
"RTN","RORHL7A",230,0)
 Q:ST=8 "Being generated"
"RTN","RORHL7A",231,0)
 Q:ST=9 "Awaiting processing"
"RTN","RORHL7A",232,0)
 Q "Unknown"
"RTN","RORHL7A",233,0)
 ;
"RTN","RORHL7A",234,0)
 ;***** ASSIGNS THE 'SET ID'
"RTN","RORHL7A",235,0)
 ;
"RTN","RORHL7A",236,0)
 ; SEGNAME       Name of the HL7 segment
"RTN","RORHL7A",237,0)
 ; [DISINC]      Disable increment of the Set ID
"RTN","RORHL7A",238,0)
 ;
"RTN","RORHL7A",239,0)
 ; Return Values:
"RTN","RORHL7A",240,0)
 ;        ""  Not required for this segment
"RTN","RORHL7A",241,0)
 ;        >0  Value for the Set ID field
"RTN","RORHL7A",242,0)
 ;
"RTN","RORHL7A",243,0)
SETID(SEGNAME,DISINC) ;
"RTN","RORHL7A",244,0)
 N SETID
"RTN","RORHL7A",245,0)
 Q:$G(SEGNAME)="" ""
"RTN","RORHL7A",246,0)
 S SETID=+$G(ROREXT("HL7SID",SEGNAME))
"RTN","RORHL7A",247,0)
 Q:SETID'>0 ""
"RTN","RORHL7A",248,0)
 S:'$G(DISINC) ROREXT("HL7SID",SEGNAME)=SETID+1
"RTN","RORHL7A",249,0)
 Q SETID
"RTN","RORHLUT1")
0^73^B6316864
"RTN","RORHLUT1",1,0)
RORHLUT1 ;HCIOFO/SG - HL7 UTILITIES (HIGH LEVEL) ; 8/24/05 1:55pm
"RTN","RORHLUT1",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORHLUT1",3,0)
 ;
"RTN","RORHLUT1",4,0)
 Q
"RTN","RORHLUT1",5,0)
 ;
"RTN","RORHLUT1",6,0)
 ;***** RETURNS A REASON WHY THE PATIENT HAS BEEN ADDED
"RTN","RORHLUT1",7,0)
 ;
"RTN","RORHLUT1",8,0)
 ; RORIENS       IENS of Patient Record in Registry File
"RTN","RORHLUT1",9,0)
 ;
"RTN","RORHLUT1",10,0)
 ; CS            HL7 component separator
"RTN","RORHLUT1",11,0)
 ;
"RTN","RORHLUT1",12,0)
ADREASON(RORIENS,CS) ;
"RTN","RORHLUT1",13,0)
 N CODE,ICD9,LAB,NAME,NODE,IEN,RORMSG,TMP
"RTN","RORHLUT1",14,0)
 S (CODE,ICD9,LAB)=0
"RTN","RORHLUT1",15,0)
 S NODE=$$ROOT^DILFD(798.01,","_RORIENS,1)
"RTN","RORHLUT1",16,0)
 Q:NODE="" ""
"RTN","RORHLUT1",17,0)
 ;--- Check the names of selection rules
"RTN","RORHLUT1",18,0)
 S IEN=0
"RTN","RORHLUT1",19,0)
 F  S IEN=$O(@NODE@("B",IEN))  Q:IEN'>0  D
"RTN","RORHLUT1",20,0)
 . S NAME=$$GET1^DIQ(798.2,IEN_",",.01,,,"RORMSG")
"RTN","RORHLUT1",21,0)
 . I $G(DIERR)  D  Q
"RTN","RORHLUT1",22,0)
 . . D DBS^RORERR("RORMSG",-9,,,798.2,IEN_",")
"RTN","RORHLUT1",23,0)
 . Q:$E(NAME,1,2)'="VA"
"RTN","RORHLUT1",24,0)
 . I NAME?1.E1" LAB"             S LAB=1   Q
"RTN","RORHLUT1",25,0)
 . I NAME?1.E1" PROBLEM"         S ICD9=1  Q
"RTN","RORHLUT1",26,0)
 . I NAME?1.E1" PTF".1" HIST"    S ICD9=1  Q
"RTN","RORHLUT1",27,0)
 . I NAME?1.E1" VISIT".1" HIST"  S ICD9=1  Q
"RTN","RORHLUT1",28,0)
 . I NAME?1.E1" VPOV"            S ICD9=1  Q
"RTN","RORHLUT1",29,0)
 ;--- Check if the patient has been added automatically
"RTN","RORHLUT1",30,0)
 S NAME="Automatically Added - "
"RTN","RORHLUT1",31,0)
 I ICD9  S CODE=7,NAME=NAME_"ICD9"
"RTN","RORHLUT1",32,0)
 I LAB  S CODE=8  D:ICD9  S NAME=NAME_"Lab"
"RTN","RORHLUT1",33,0)
 . S CODE=9,NAME=NAME_" and "
"RTN","RORHLUT1",34,0)
 ;---
"RTN","RORHLUT1",35,0)
 Q $S(CODE:CODE_CS_$$ESCAPE^RORHL7(NAME)_CS_"99VA799_1",1:"")
"RTN","RORHLUT1",36,0)
 ;
"RTN","RORHLUT1",37,0)
 ;***** RETURNS THE HL7 VALUE FOR THE DIVISION FIELD
"RTN","RORHLUT1",38,0)
 ;
"RTN","RORHLUT1",39,0)
 ; IEN44         IEN in the HOSPITAL LOCATION file (#44)
"RTN","RORHLUT1",40,0)
 ;
"RTN","RORHLUT1",41,0)
 ; [CS]          Component separator ("^", by default))
"RTN","RORHLUT1",42,0)
 ;
"RTN","RORHLUT1",43,0)
 ; Return Values:
"RTN","RORHLUT1",44,0)
 ;       ""  Error
"RTN","RORHLUT1",45,0)
 ;     '=""  Value of the HL7 field
"RTN","RORHLUT1",46,0)
 ;
"RTN","RORHLUT1",47,0)
DIV44(IEN44,CS) ;
"RTN","RORHLUT1",48,0)
 N DIV,IENS4,NAME,RORBUF,RORMSG,STN,TMP
"RTN","RORHLUT1",49,0)
 S:$G(CS)="" CS="^"
"RTN","RORHLUT1",50,0)
 S DIV=$$SITE^RORUTL03(CS)
"RTN","RORHLUT1",51,0)
 Q:IEN44'>0 DIV
"RTN","RORHLUT1",52,0)
 ;--- Get the pointer to the INSTITUTION file
"RTN","RORHLUT1",53,0)
 S IENS4=+$$GET1^DIQ(44,IEN44_",",3,"I",,"RORMSG")_","
"RTN","RORHLUT1",54,0)
 I $G(DIERR)  D  Q DIV
"RTN","RORHLUT1",55,0)
 . D DBS^RORERR("RORMSG",-9,,,44,IEN44_",")
"RTN","RORHLUT1",56,0)
 Q:IENS4'>0 DIV
"RTN","RORHLUT1",57,0)
 ;--- Load the station name and number
"RTN","RORHLUT1",58,0)
 D GETS^DIQ(4,IENS4,".01;99",,"RORBUF","RORMSG")
"RTN","RORHLUT1",59,0)
 I $G(DIERR)  D  Q DIV
"RTN","RORHLUT1",60,0)
 . D DBS^RORERR("RORMSG",-9,,,4,IENS4)
"RTN","RORHLUT1",61,0)
 S STN=$E($G(ROROUT(4,IENS4,99)),1,3)
"RTN","RORHLUT1",62,0)
 Q:STN="" DIV
"RTN","RORHLUT1",63,0)
 ;--- Construct the HL7 value
"RTN","RORHLUT1",64,0)
 S NAME=$$ESCAPE^RORHL7($G(RORBUF(4,IENS4,.01)))
"RTN","RORHLUT1",65,0)
 Q STN_CS_NAME_CS_"99VA4"
"RTN","RORHLUT1",66,0)
 ;
"RTN","RORHLUT1",67,0)
 ;***** STORES THE MULTILINE TEXT IN THE OBX SEGMENT
"RTN","RORHLUT1",68,0)
 ;
"RTN","RORHLUT1",69,0)
 ; NODE          Closed root of the text
"RTN","RORHLUT1",70,0)
 ; OBX3          Segment identifier
"RTN","RORHLUT1",71,0)
 ;
"RTN","RORHLUT1",72,0)
SETOBXWP(NODE,OBX3) ;
"RTN","RORHLUT1",73,0)
 N BR,CNT,I,I1,RORSEG,TMP
"RTN","RORHLUT1",74,0)
 S BR=$E(HLECH,3)_".br"_$E(HLECH,3)
"RTN","RORHLUT1",75,0)
 Q:$D(@NODE)<10
"RTN","RORHLUT1",76,0)
 ;--- Initialize the segment
"RTN","RORHLUT1",77,0)
 S RORSEG(0)="OBX"
"RTN","RORHLUT1",78,0)
 ;--- OBX-2 - Value Type
"RTN","RORHLUT1",79,0)
 S RORSEG(2)="FT"
"RTN","RORHLUT1",80,0)
 ;--- OBX-3 - Observation Identifier
"RTN","RORHLUT1",81,0)
 S RORSEG(3)=OBX3
"RTN","RORHLUT1",82,0)
 ;--- OBX-5 - Observation Value
"RTN","RORHLUT1",83,0)
 S I=$O(@NODE@(0)),CNT=0
"RTN","RORHLUT1",84,0)
 F  Q:I'>0  S I1=$O(@NODE@(I))  D  S I=I1
"RTN","RORHLUT1",85,0)
 . S TMP=$$ESCAPE^RORHL7(@NODE@(I))
"RTN","RORHLUT1",86,0)
 . S CNT=CNT+1,RORSEG(5,CNT)=$S(I1>0:TMP_BR,1:TMP)
"RTN","RORHLUT1",87,0)
 ;--- OBX-11 - Observation Result Status
"RTN","RORHLUT1",88,0)
 S RORSEG(11)="F"
"RTN","RORHLUT1",89,0)
 ;--- Store the segment
"RTN","RORHLUT1",90,0)
 D:$D(RORSEG(5)) ADDSEG^RORHL7(.RORSEG)
"RTN","RORHLUT1",91,0)
 Q
"RTN","RORICR01")
1^74
"RTN","RORICR02")
1^75
"RTN","RORICR03")
1^76
"RTN","RORICREX")
1^77
"RTN","RORICRUT")
1^78
"RTN","RORKIDS")
0^79^B35787858
"RTN","RORKIDS",1,0)
RORKIDS ;HCIOFO/SG - INSTALL UTILITIES (LOW-LEVEL) ; 4/21/05 2:02pm
"RTN","RORKIDS",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORKIDS",3,0)
 ;
"RTN","RORKIDS",4,0)
 Q
"RTN","RORKIDS",5,0)
 ;
"RTN","RORKIDS",6,0)
 ;***** DISPLAYS THE MESSAGE IF THE INSTALLATION ABORTS
"RTN","RORKIDS",7,0)
ABTMSG() ;
"RTN","RORKIDS",8,0)
 ;;You can use the Print Log Files [RORMNT PRINT LOGS] option from
"RTN","RORKIDS",9,0)
 ;;the Clinical Case Registries Maintenance [RORMNT MAIN] menu to
"RTN","RORKIDS",10,0)
 ;;review the log file(s). The Install File Print [XPD PRINT INSTALL
"RTN","RORKIDS",11,0)
 ;;FILE] option from the Utilities [XPD UTILITY] can help also.
"RTN","RORKIDS",12,0)
 ;;Please fix the error(s) and restart the installation.
"RTN","RORKIDS",13,0)
 ;;
"RTN","RORKIDS",14,0)
 ;;NOTE: You must have the ROR VA IRM key to be able to access
"RTN","RORKIDS",15,0)
 ;;      the Clinical Case Registries files and view the logs.
"RTN","RORKIDS",16,0)
 ;
"RTN","RORKIDS",17,0)
 N I,INFO,MODE,TMP
"RTN","RORKIDS",18,0)
 S MODE=+$G(RORPARM("KIDS"))
"RTN","RORKIDS",19,0)
 S MODE=$S(MODE=1:"PRE-INSTALL",MODE=2:"POST-INSTALL",1:"")
"RTN","RORKIDS",20,0)
 Q:MODE=""
"RTN","RORKIDS",21,0)
 F I=1:1  S TMP=$T(ABTMSG+I)  Q:TMP'[";;"  S INFO(I)=$P(TMP,";;",2,99)
"RTN","RORKIDS",22,0)
 D BMES("FATAL ERROR(S) DURING THE REGISTRY "_MODE_"!",.INFO)
"RTN","RORKIDS",23,0)
 Q
"RTN","RORKIDS",24,0)
 ;
"RTN","RORKIDS",25,0)
 ;***** SENDS AN ALERT
"RTN","RORKIDS",26,0)
 ;
"RTN","RORKIDS",27,0)
 ; DUZ           DUZ of the addressee
"RTN","RORKIDS",28,0)
 ;
"RTN","RORKIDS",29,0)
 ; MSG           Text of the message or negative error code. The '^'
"RTN","RORKIDS",30,0)
 ;               characters are replaced with spaces in the text.
"RTN","RORKIDS",31,0)
 ;
"RTN","RORKIDS",32,0)
 ; [REGNAME]     Registry name
"RTN","RORKIDS",33,0)
 ;
"RTN","RORKIDS",34,0)
 ; [PATIEN]      Patient IEN
"RTN","RORKIDS",35,0)
 ;
"RTN","RORKIDS",36,0)
 ; [ARG2-ARG5]   Optional parameters as for $$ERROR^RORERR
"RTN","RORKIDS",37,0)
 ;
"RTN","RORKIDS",38,0)
ALERT(DUZ,MSG,REGNAME,PATIEN,ARG2,ARG3,ARG4,ARG5) ;
"RTN","RORKIDS",39,0)
 Q:'$G(DUZ)
"RTN","RORKIDS",40,0)
 N XQA,XQADATA,XQAFLG,XQAMSG,XQAROU,TMP
"RTN","RORKIDS",41,0)
 S XQA(DUZ)=""
"RTN","RORKIDS",42,0)
 ;--- Get text of the error message
"RTN","RORKIDS",43,0)
 I +MSG=MSG  Q:MSG'<0  D
"RTN","RORKIDS",44,0)
 . S MSG=$$MSG^RORERR20(+MSG,,.PATIEN,.ARG2,.ARG3,.ARG4,.ARG5)
"RTN","RORKIDS",45,0)
 S MSG=$TR(MSG,"^","~"),XQAMSG="ROR: ",TMP=70-$L(XQAMSG)-3
"RTN","RORKIDS",46,0)
 S XQAMSG=XQAMSG_$S($L(MSG)>TMP:$E(MSG,1,TMP)_"...",1:MSG)
"RTN","RORKIDS",47,0)
 ;--- Setup alert processing routine
"RTN","RORKIDS",48,0)
 S $P(XQADATA,U,1)=$E(MSG,1,78)
"RTN","RORKIDS",49,0)
 S $P(XQADATA,U,2)=$G(REGNAME)
"RTN","RORKIDS",50,0)
 S $P(XQADATA,U,3)=$G(PATIEN)
"RTN","RORKIDS",51,0)
 S XQAROU="ALERTRTN^RORKIDS"
"RTN","RORKIDS",52,0)
 ;--- Send the alert
"RTN","RORKIDS",53,0)
 S XQAFLG="D"  D SETUP^XQALERT
"RTN","RORKIDS",54,0)
 Q
"RTN","RORKIDS",55,0)
 ;
"RTN","RORKIDS",56,0)
 ;***** ALERT PROCESSING ROUTINE
"RTN","RORKIDS",57,0)
 ;
"RTN","RORKIDS",58,0)
 ; XQADATA       Alert data
"RTN","RORKIDS",59,0)
 ;                 ^1: Message
"RTN","RORKIDS",60,0)
 ;                 ^2: Registry name
"RTN","RORKIDS",61,0)
 ;                 ^3: Patient DFN
"RTN","RORKIDS",62,0)
 ;
"RTN","RORKIDS",63,0)
ALERTRTN ;
"RTN","RORKIDS",64,0)
 ;;Registry Name:
"RTN","RORKIDS",65,0)
 ;;Patient DFN:
"RTN","RORKIDS",66,0)
 ;
"RTN","RORKIDS",67,0)
 Q:$G(XQADATA)=""
"RTN","RORKIDS",68,0)
 N I,TMP
"RTN","RORKIDS",69,0)
 W !!,$P(XQADATA,"^"),!
"RTN","RORKIDS",70,0)
 F I=1:1:2  S TMP=$P(XQADATA,"^",I+1)  D:TMP'=""
"RTN","RORKIDS",71,0)
 . W $P($T(ALERTRTN+I),";;",2),?15,TMP,!
"RTN","RORKIDS",72,0)
 Q
"RTN","RORKIDS",73,0)
 ;
"RTN","RORKIDS",74,0)
 ;***** OUTPUTS THE MESSAGE AND PUTS IT INTO THE LOG
"RTN","RORKIDS",75,0)
BMES(MSG,INFO) ;
"RTN","RORKIDS",76,0)
 N I
"RTN","RORKIDS",77,0)
 D BMES^XPDUTL("   "_MSG)
"RTN","RORKIDS",78,0)
 S I=""
"RTN","RORKIDS",79,0)
 F  S I=$O(INFO(I))  Q:I=""  D MES^XPDUTL("   "_INFO(I))
"RTN","RORKIDS",80,0)
 D LOG^RORLOG(,MSG,,.INFO)
"RTN","RORKIDS",81,0)
 Q
"RTN","RORKIDS",82,0)
 ;
"RTN","RORKIDS",83,0)
 ;***** CHECKS THE SCHEDULED OPTION
"RTN","RORKIDS",84,0)
 ;
"RTN","RORKIDS",85,0)
 ; OPTION        Option name
"RTN","RORKIDS",86,0)
 ;
"RTN","RORKIDS",87,0)
 ; Return Values:
"RTN","RORKIDS",88,0)
 ;       <0  Error code
"RTN","RORKIDS",89,0)
 ;        0  Ok
"RTN","RORKIDS",90,0)
 ;
"RTN","RORKIDS",91,0)
 ; This function can be used in the environment check routines to
"RTN","RORKIDS",92,0)
 ; check if the option is running and/or scheduled to run.
"RTN","RORKIDS",93,0)
 ;
"RTN","RORKIDS",94,0)
 ; The function displays appropriate error messages and warnings
"RTN","RORKIDS",95,0)
 ; using the WRITE command. So, it MUST NOT be called from the
"RTN","RORKIDS",96,0)
 ; pre-install or post-install routines.
"RTN","RORKIDS",97,0)
 ;
"RTN","RORKIDS",98,0)
 ; The function uses the ^UTILITY($J,"W") node (^DIWP and ^DIWW).
"RTN","RORKIDS",99,0)
 ;
"RTN","RORKIDS",100,0)
CHKOPT(OPTION) ;
"RTN","RORKIDS",101,0)
 N DIWF,DIWL,DIWR,RC,RORBUF,RORI,RORSDT,TMP,X,ZTSK
"RTN","RORKIDS",102,0)
 ;--- Check status of the option
"RTN","RORKIDS",103,0)
 D OPTSTAT^XUTMOPT(OPTION,.RORBUF)
"RTN","RORKIDS",104,0)
 S (RC,RORSDT)=0
"RTN","RORKIDS",105,0)
 F RORI=1:1:$G(RORBUF)  K ZTSK  D  I $G(ZTSK(1))=2  S RC=-76  Q
"RTN","RORKIDS",106,0)
 . S ZTSK=$P(RORBUF(RORI),"^")  Q:'ZTSK
"RTN","RORKIDS",107,0)
 . D STAT^%ZTLOAD
"RTN","RORKIDS",108,0)
 . S TMP=$P(RORBUF(RORI),"^",2)
"RTN","RORKIDS",109,0)
 . I TMP>0  S:'RORSDT!(TMP<RORSDT) RORSDT=TMP
"RTN","RORKIDS",110,0)
 ;--- Display an error message if the option is running
"RTN","RORKIDS",111,0)
 I RC  D  Q RC
"RTN","RORKIDS",112,0)
 . W !,$$MSG^RORERR20(RC,,,OPTION),!
"RTN","RORKIDS",113,0)
 ;--- Display an apropriate warning
"RTN","RORKIDS",114,0)
 S DIWL=5,DIWR=$G(IOM,80)-DIWL
"RTN","RORKIDS",115,0)
 K ^UTILITY($J,"W")
"RTN","RORKIDS",116,0)
CM1 I RORSDT>0  D
"RTN","RORKIDS",117,0)
 . ;;"The ["_OPTION_"] option is scheduled to run "_RORSDT_"."
"RTN","RORKIDS",118,0)
 . ;;"If you are going to schedule the installation, please, choose"
"RTN","RORKIDS",119,0)
 . ;;"an appropriate time so that the post-install will either"
"RTN","RORKIDS",120,0)
 . ;;"finish well before the ["_OPTION_"] scheduled time or start"
"RTN","RORKIDS",121,0)
 . ;;"after the option completion."
"RTN","RORKIDS",122,0)
 . ;---
"RTN","RORKIDS",123,0)
 . S RORSDT=$$FMTE^XLFDT(RORSDT)
"RTN","RORKIDS",124,0)
 . S RORSDT="on "_$P(RORSDT,"@")_" at "_$P(RORSDT,"@",2)
"RTN","RORKIDS",125,0)
 . F RORI=1:1  S X=$T(CM1+RORI)  Q:X'[";;"  D
"RTN","RORKIDS",126,0)
 . . X "S X="_$P(X,";;",2)  D ^DIWP
"RTN","RORKIDS",127,0)
CM2 E  D
"RTN","RORKIDS",128,0)
 . ;;"The ["_OPTION_"] option is not scheduled. Do not forget"
"RTN","RORKIDS",129,0)
 . ;;"to schedule it after completion of the installation."
"RTN","RORKIDS",130,0)
 . ;---
"RTN","RORKIDS",131,0)
 . F RORI=1:1  S X=$T(CM2+RORI)  Q:X'[";;"  D
"RTN","RORKIDS",132,0)
 . . X "S X="_$P(X,";;",2)  D ^DIWP
"RTN","RORKIDS",133,0)
 W !  D ^DIWW
"RTN","RORKIDS",134,0)
 Q 0
"RTN","RORKIDS",135,0)
 ;
"RTN","RORKIDS",136,0)
 ;***** PROCESSES THE INSTALL CHECKPOINT
"RTN","RORKIDS",137,0)
 ;
"RTN","RORKIDS",138,0)
 ; CPNAME        Checkpoint name
"RTN","RORKIDS",139,0)
 ;
"RTN","RORKIDS",140,0)
 ; CALLBACK      Callback entry point ($$TAG^ROUTINE). This function
"RTN","RORKIDS",141,0)
 ;               accepts no parameters and must return either 0 if
"RTN","RORKIDS",142,0)
 ;               everything is Ok or a negative error code.
"RTN","RORKIDS",143,0)
 ;
"RTN","RORKIDS",144,0)
 ; [PARAM]       Value to set checkpoint parameter to.
"RTN","RORKIDS",145,0)
 ;
"RTN","RORKIDS",146,0)
 ; The function checks if the checkpoint is completed. If it is not,
"RTN","RORKIDS",147,0)
 ; the callback entry point is XECUTEd. If everything is Ok, the
"RTN","RORKIDS",148,0)
 ; function will complete the checkpoint.
"RTN","RORKIDS",149,0)
 ;
"RTN","RORKIDS",150,0)
 ; Return Values:
"RTN","RORKIDS",151,0)
 ;       <0  Error code
"RTN","RORKIDS",152,0)
 ;        0  Ok
"RTN","RORKIDS",153,0)
 ;
"RTN","RORKIDS",154,0)
CP(CPNAME,CALLBACK,PARAM) ;
"RTN","RORKIDS",155,0)
 N RC
"RTN","RORKIDS",156,0)
 ;--- Verify the checkpoint and quit if it is completed
"RTN","RORKIDS",157,0)
 S RC=$$VERCP^XPDUTL(CPNAME)  Q:RC>0 0
"RTN","RORKIDS",158,0)
 ;--- Create the new checkpoint
"RTN","RORKIDS",159,0)
 I RC<0  D  Q:'RC $$ERROR^RORERR(-50,,,,CPNAME)
"RTN","RORKIDS",160,0)
 . S RC=$$NEWCP^XPDUTL(CPNAME,,.PARAM)
"RTN","RORKIDS",161,0)
 ;--- Reset the KIDS progress bar
"RTN","RORKIDS",162,0)
 S XPDIDTOT=0  D UPDATE^XPDID(0)
"RTN","RORKIDS",163,0)
 ;--- Execute the callback entry point
"RTN","RORKIDS",164,0)
 X "S RC="_CALLBACK  Q:RC<0 RC
"RTN","RORKIDS",165,0)
 ;--- Complete the check point
"RTN","RORKIDS",166,0)
 S RC=$$COMCP^XPDUTL(CPNAME)
"RTN","RORKIDS",167,0)
 Q:'RC $$ERROR^RORERR(-51,,,,CPNAME)
"RTN","RORKIDS",168,0)
 Q 0
"RTN","RORKIDS",169,0)
 ;
"RTN","RORKIDS",170,0)
 ;***** DELETES THE (SUB)FILE DD AND DATA (IF REQUESTED)
"RTN","RORKIDS",171,0)
 ;
"RTN","RORKIDS",172,0)
 ; FILE          File number
"RTN","RORKIDS",173,0)
 ;
"RTN","RORKIDS",174,0)
 ; [FLAGS]       String that contains flags for EN^DIU2:
"RTN","RORKIDS",175,0)
 ;                 "D"  Delete the data as well as the DD
"RTN","RORKIDS",176,0)
 ;                 "E"  Echo back information during deletion
"RTN","RORKIDS",177,0)
 ;                 "S"  Subfile data dictionary is to be deleted
"RTN","RORKIDS",178,0)
 ;                 "T"  Templates are to be deleted
"RTN","RORKIDS",179,0)
 ;
"RTN","RORKIDS",180,0)
 ; [SILENT]      If this parameters is defined and non-zero, the
"RTN","RORKIDS",181,0)
 ;               function will work in "silent" mode.
"RTN","RORKIDS",182,0)
 ;               Nothing (except error messages if debug mode >1 is
"RTN","RORKIDS",183,0)
 ;               enabled) will be displayed on the console or stored
"RTN","RORKIDS",184,0)
 ;               into the INSTALLATION file.
"RTN","RORKIDS",185,0)
 ;
"RTN","RORKIDS",186,0)
 ; Return Values:
"RTN","RORKIDS",187,0)
 ;       <0  Error code
"RTN","RORKIDS",188,0)
 ;        0  Ok
"RTN","RORKIDS",189,0)
 ;
"RTN","RORKIDS",190,0)
 ; NOTE: This entry point can also be called as a procedure:
"RTN","RORKIDS",191,0)
 ;       D DELFILE^RORKIDS(...) if you do not need its return value.
"RTN","RORKIDS",192,0)
 ;
"RTN","RORKIDS",193,0)
DELFILE(FILE,FLAGS,SILENT) ;
"RTN","RORKIDS",194,0)
 I '$$VFILE^DILFD(+FILE)  Q:$QUIT 0  Q
"RTN","RORKIDS",195,0)
 N DIU,FT,RC
"RTN","RORKIDS",196,0)
 S DIU=+FILE,DIU(0)=$G(FLAGS)
"RTN","RORKIDS",197,0)
 I '$G(SILENT)  D
"RTN","RORKIDS",198,0)
 . S FT=$S(DIU(0)["S":"subfile",1:"file")
"RTN","RORKIDS",199,0)
 . D BMES("Deleting the "_FT_" #"_(+FILE)_"...")
"RTN","RORKIDS",200,0)
 D EN^DIU2
"RTN","RORKIDS",201,0)
 D:'$G(SILENT) MES("The "_FT_" has been deleted.")
"RTN","RORKIDS",202,0)
 Q:$QUIT 0  Q
"RTN","RORKIDS",203,0)
 ;
"RTN","RORKIDS",204,0)
 ;***** DELETES FIELD DEFENITIONS FROM THE DD
"RTN","RORKIDS",205,0)
 ;
"RTN","RORKIDS",206,0)
 ; FILE          File number
"RTN","RORKIDS",207,0)
 ;
"RTN","RORKIDS",208,0)
 ; FLDLST        String that contains list of field numbers to
"RTN","RORKIDS",209,0)
 ;               delete (separated with the ';').
"RTN","RORKIDS",210,0)
 ;
"RTN","RORKIDS",211,0)
 ; [SILENT]      If this parameters is defined and non-zero, the
"RTN","RORKIDS",212,0)
 ;               function will work in "silent" mode.
"RTN","RORKIDS",213,0)
 ;               Nothing (except error messages if debug mode >1 is
"RTN","RORKIDS",214,0)
 ;               enabled) will be displayed on the console or stored
"RTN","RORKIDS",215,0)
 ;               into the INSTALLATION file.
"RTN","RORKIDS",216,0)
 ;
"RTN","RORKIDS",217,0)
 ; Return Values:
"RTN","RORKIDS",218,0)
 ;       <0  Error code
"RTN","RORKIDS",219,0)
 ;        0  Ok
"RTN","RORKIDS",220,0)
 ;
"RTN","RORKIDS",221,0)
 ; NOTE: This entry point can also be called as a procedure:
"RTN","RORKIDS",222,0)
 ;       D DELFLDS^RORKIDS(...) if you do not need its return value.
"RTN","RORKIDS",223,0)
 ;
"RTN","RORKIDS",224,0)
DELFLDS(FILE,FLDLST,SILENT) ;
"RTN","RORKIDS",225,0)
 I '$$VFILE^DILFD(+FILE)  Q:$QUIT 0  Q
"RTN","RORKIDS",226,0)
 N DA,DIK,I,RC
"RTN","RORKIDS",227,0)
 D:'$G(SILENT)
"RTN","RORKIDS",228,0)
 . D BMES("Deleting the field definitions...")
"RTN","RORKIDS",229,0)
 . D MES("File #"_(+FILE)_", Fields: '"_FLDLST_"'")
"RTN","RORKIDS",230,0)
 S DA(1)=+FILE,DIK="^DD("_DA(1)_","
"RTN","RORKIDS",231,0)
 F I=1:1  S DA=$P(FLDLST,";",I)  Q:'DA  D ^DIK
"RTN","RORKIDS",232,0)
 D:'$G(SILENT) MES("The definitions have been deleted.")
"RTN","RORKIDS",233,0)
 Q:$QUIT 0  Q
"RTN","RORKIDS",234,0)
 ;
"RTN","RORKIDS",235,0)
 ;***** OUTPUTS THE MESSAGE AND PUTS IT INTO THE LOG
"RTN","RORKIDS",236,0)
MES(MSG,INFO) ;
"RTN","RORKIDS",237,0)
 N I
"RTN","RORKIDS",238,0)
 D MES^XPDUTL("   "_MSG)
"RTN","RORKIDS",239,0)
 S I=""
"RTN","RORKIDS",240,0)
 F  S I=$O(INFO(I))  Q:I=""  D MES^XPDUTL("   "_INFO(I))
"RTN","RORKIDS",241,0)
 D LOG^RORLOG(,MSG,,.INFO)
"RTN","RORKIDS",242,0)
 Q
"RTN","RORKIDS",243,0)
 ;
"RTN","RORKIDS",244,0)
 ;***** RETURNS A VALUE OF THE INSTALLATION PARAMETER
"RTN","RORKIDS",245,0)
 ;
"RTN","RORKIDS",246,0)
 ; NAME          Name of the parameter
"RTN","RORKIDS",247,0)
 ;
"RTN","RORKIDS",248,0)
PARAM(NAME) ;
"RTN","RORKIDS",249,0)
 Q $G(RORPARM("KIDS",NAME))
"RTN","RORKIDS",250,0)
 ;
"RTN","RORKIDS",251,0)
 ;***** UPDATES THE FILE'S PACKAGE REVISION DATA (IF NECESSARY)
"RTN","RORKIDS",252,0)
 ;
"RTN","RORKIDS",253,0)
 ; FILE          File number
"RTN","RORKIDS",254,0)
 ;
"RTN","RORKIDS",255,0)
 ; [PRD]         Package revision data
"RTN","RORKIDS",256,0)
 ;                 ^01: Revision number (N.N)
"RTN","RORKIDS",257,0)
 ;                 ^02: Patch name
"RTN","RORKIDS",258,0)
 ;
"RTN","RORKIDS",259,0)
 ; If this entry point is called as a function, it returns the
"RTN","RORKIDS",260,0)
 ; previous value of the PACKAGE REVISION DATA attribute.
"RTN","RORKIDS",261,0)
 ;
"RTN","RORKIDS",262,0)
PRD(FILE,PRD) ;
"RTN","RORKIDS",263,0)
 N OLDPRD,RORMSG
"RTN","RORKIDS",264,0)
 S OLDPRD=$$GET1^DID(FILE,,,"PACKAGE REVISION DATA",,"RORMSG")
"RTN","RORKIDS",265,0)
 D:$G(PRD)>OLDPRD PRD^DILFD(FILE,PRD)
"RTN","RORKIDS",266,0)
 Q:$QUIT OLDPRD  Q
"RTN","RORLOCK")
0^80^B21824053
"RTN","RORLOCK",1,0)
RORLOCK ;HCIOFO/SG - LOCKS AND TYRANSACTIONS ; 10/1/03 4:36pm
"RTN","RORLOCK",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORLOCK",3,0)
 ;
"RTN","RORLOCK",4,0)
 Q
"RTN","RORLOCK",5,0)
 ;
"RTN","RORLOCK",6,0)
 ;***** FINDS THE LOCK DESCRIPTOR FOR THE GLOBAL NODE
"RTN","RORLOCK",7,0)
LDSC(NODELIST) ;
"RTN","RORLOCK",8,0)
 N DESCR,IENS,L,NDX,NODE,RORMSG,SP,TMP
"RTN","RORLOCK",9,0)
 S:$D(NODELIST)<10 NODELIST(NODELIST)=""
"RTN","RORLOCK",10,0)
 S (DESCR,NODE)=""
"RTN","RORLOCK",11,0)
 F  S NODE=$O(NODELIST(NODE))  Q:NODE=""  D
"RTN","RORLOCK",12,0)
 . ;--- The Node itself
"RTN","RORLOCK",13,0)
 . S SP=$$XLNDX(NODE),TMP=$G(^XTMP("RORLOCK",SP))
"RTN","RORLOCK",14,0)
 . S:TMP>DESCR DESCR=TMP
"RTN","RORLOCK",15,0)
 . ;--- Left Siblings and Ancestors
"RTN","RORLOCK",16,0)
 . S NDX=SP
"RTN","RORLOCK",17,0)
 . F  S NDX=$O(^XTMP("RORLOCK",NDX),-1),L=$L(NDX)  Q:(NDX="")!(NDX'=$E(SP,1,L))  D
"RTN","RORLOCK",18,0)
 . . S TMP=$G(^XTMP("RORLOCK",NDX))  S:TMP>DESCR DESCR=TMP
"RTN","RORLOCK",19,0)
 . ;--- Right Siblings and Descendants
"RTN","RORLOCK",20,0)
 . S NDX=SP,L=$L(SP)
"RTN","RORLOCK",21,0)
 . F  S NDX=$O(^XTMP("RORLOCK",NDX))  Q:(NDX="")!($E(NDX,1,L)'=SP)  D
"RTN","RORLOCK",22,0)
 . . S TMP=$G(^XTMP("RORLOCK",NDX))  S:TMP>DESCR DESCR=TMP
"RTN","RORLOCK",23,0)
 ;--- Prepare the lock descriptor
"RTN","RORLOCK",24,0)
 S:'DESCR $P(DESCR,U)=$$NOW^XLFDT
"RTN","RORLOCK",25,0)
 D:$P(DESCR,U,3)>0
"RTN","RORLOCK",26,0)
 . S IENS=+$P(DESCR,U,3)_","
"RTN","RORLOCK",27,0)
 . S $P(DESCR,U,2)=$$GET1^DIQ(200,IENS,.01,,,"RORMSG")
"RTN","RORLOCK",28,0)
 . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,200,IENS)
"RTN","RORLOCK",29,0)
 S:$P(DESCR,U,2)="" $P(DESCR,U,2)="UNKNOWN USER"
"RTN","RORLOCK",30,0)
 Q DESCR
"RTN","RORLOCK",31,0)
 ;
"RTN","RORLOCK",32,0)
 ;***** LOCKS THE (SUB)FILE, RECORD OR FIELD NODE
"RTN","RORLOCK",33,0)
 ;
"RTN","RORLOCK",34,0)
 ; FILE          File/subfile number
"RTN","RORLOCK",35,0)
 ; [IENS]        IENS of the record or subfile
"RTN","RORLOCK",36,0)
 ; [FIELD]       Field number
"RTN","RORLOCK",37,0)
 ; [TO]          Timeout (1 sec, by default)
"RTN","RORLOCK",38,0)
 ;
"RTN","RORLOCK",39,0)
 ; Return Values:
"RTN","RORLOCK",40,0)
 ;       <0  Error code
"RTN","RORLOCK",41,0)
 ;        0  Ok (the object has been locked)
"RTN","RORLOCK",42,0)
 ;       >0  The object is locked by another user. A lock descriptor
"RTN","RORLOCK",43,0)
 ;           is returned in this case:
"RTN","RORLOCK",44,0)
 ;             ^01: Date/Time (FileMan)
"RTN","RORLOCK",45,0)
 ;             ^02: User/Process name
"RTN","RORLOCK",46,0)
 ;             ^03: User IEN (DUZ)
"RTN","RORLOCK",47,0)
 ;             ^04: $JOB
"RTN","RORLOCK",48,0)
 ;             ^05: Task number
"RTN","RORLOCK",49,0)
 ;
"RTN","RORLOCK",50,0)
 ; If the fourth field is empty then the object is locked by unknown
"RTN","RORLOCK",51,0)
 ; user (see the name in the 2nd field).
"RTN","RORLOCK",52,0)
 ;
"RTN","RORLOCK",53,0)
 ; Otherwise, if the third field is empty then the object is locked
"RTN","RORLOCK",54,0)
 ; by a registry background process (see the name in the 2nd field).
"RTN","RORLOCK",55,0)
 ;
"RTN","RORLOCK",56,0)
LOCK(FILE,IENS,FIELD,TO,NAME) ;
"RTN","RORLOCK",57,0)
 N DESCR,NODELIST,NODE,PI,RC
"RTN","RORLOCK",58,0)
 I $D(FILE)<10  S RC=0  D:$G(FILE)>0  Q RC
"RTN","RORLOCK",59,0)
 . S RC=$$LOCK1(FILE,$G(IENS),$G(FIELD),$G(TO),$G(NAME))
"RTN","RORLOCK",60,0)
 ;--- Compile the list of global nodes
"RTN","RORLOCK",61,0)
 S RC=$$NODELIST(.NODELIST,.FILE,$G(IENS),$G(FIELD))
"RTN","RORLOCK",62,0)
 Q:RC<0 RC  Q:NODELIST="" 0
"RTN","RORLOCK",63,0)
 ;--- Try to lock the object(s)
"RTN","RORLOCK",64,0)
 X "L +("_NODELIST_"):"_$S($G(TO)>0:TO,1:1)  E  Q $$LDSC(.NODELIST)
"RTN","RORLOCK",65,0)
 ;--- Create the lock descriptor(s)
"RTN","RORLOCK",66,0)
 S DESCR=$$NOW^XLFDT_U_$G(NAME)_U_U_$JOB_U_$G(ZTSK)
"RTN","RORLOCK",67,0)
 S:$G(NAME)="" $P(DESCR,U,3)=$G(DUZ)
"RTN","RORLOCK",68,0)
 S NODE=""
"RTN","RORLOCK",69,0)
 F  S NODE=$O(NODELIST(NODE))  Q:NODE=""  D
"RTN","RORLOCK",70,0)
 . S ^XTMP("RORLOCK",$$XLNDX(NODE))=DESCR
"RTN","RORLOCK",71,0)
 Q 0
"RTN","RORLOCK",72,0)
 ;
"RTN","RORLOCK",73,0)
LOCK1(FILE,IENS,FIELD,TO,NAME) ;
"RTN","RORLOCK",74,0)
 N DESCR,NODE
"RTN","RORLOCK",75,0)
 S NODE=$$NODE(FILE,$G(IENS),$G(FIELD))
"RTN","RORLOCK",76,0)
 Q:NODE<0 NODE
"RTN","RORLOCK",77,0)
 ;--- Try to lock the object
"RTN","RORLOCK",78,0)
 L +@NODE:$S($G(TO)>0:TO,1:1)  E  Q $$LDSC(NODE)
"RTN","RORLOCK",79,0)
 ;--- Create the lock descriptor
"RTN","RORLOCK",80,0)
 S DESCR=$$NOW^XLFDT_U_$G(NAME)_U_U_$JOB_U_$G(ZTSK)
"RTN","RORLOCK",81,0)
 S:$G(NAME)="" $P(DESCR,U,3)=$G(DUZ)
"RTN","RORLOCK",82,0)
 S ^XTMP("RORLOCK",$$XLNDX(NODE))=DESCR
"RTN","RORLOCK",83,0)
 Q 0
"RTN","RORLOCK",84,0)
 ;
"RTN","RORLOCK",85,0)
 ;***** RETURNS THE GLOBAL NODE OF THE OBJECT
"RTN","RORLOCK",86,0)
 ;
"RTN","RORLOCK",87,0)
 ; FILE          File/subfile number
"RTN","RORLOCK",88,0)
 ; IENS          IENS of the record or subfile
"RTN","RORLOCK",89,0)
 ; FIELD         Field number
"RTN","RORLOCK",90,0)
 ;
"RTN","RORLOCK",91,0)
 ; Return Values:
"RTN","RORLOCK",92,0)
 ;       <0  Error code
"RTN","RORLOCK",93,0)
 ;           Closed root
"RTN","RORLOCK",94,0)
 ;
"RTN","RORLOCK",95,0)
NODE(FILE,IENS,FIELD) ;
"RTN","RORLOCK",96,0)
 N FGL,IEN,NODE,RC
"RTN","RORLOCK",97,0)
 S IEN=+IENS  S:IEN $P(IENS,",")=""
"RTN","RORLOCK",98,0)
 ;--- Closed root of the (sub)file
"RTN","RORLOCK",99,0)
 S NODE=$$ROOT^DILFD(FILE,IENS,1)
"RTN","RORLOCK",100,0)
 I NODE=""  D  Q RC
"RTN","RORLOCK",101,0)
 . S RC=$$ERROR^RORERR(-98,,,,FILE,IENS)
"RTN","RORLOCK",102,0)
 Q:'IEN NODE
"RTN","RORLOCK",103,0)
 ;--- The record node
"RTN","RORLOCK",104,0)
 S NODE=$NA(@NODE@(IEN))
"RTN","RORLOCK",105,0)
 Q:'FIELD NODE
"RTN","RORLOCK",106,0)
 ;--- Field node
"RTN","RORLOCK",107,0)
 S FGL=$$GET1^DID(FILE,FIELD,,"GLOBAL SUBSCRIPT LOCATION",,"RORMSG")
"RTN","RORLOCK",108,0)
 I $G(DIERR)  D  Q RC
"RTN","RORLOCK",109,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,FILE)
"RTN","RORLOCK",110,0)
 S:$P(FGL,";")'="" NODE=$NA(@NODE@($P(FGL,";")))
"RTN","RORLOCK",111,0)
 Q NODE
"RTN","RORLOCK",112,0)
 ;
"RTN","RORLOCK",113,0)
 ;***** COMPILES THE LIST OF GLOBAL NODES
"RTN","RORLOCK",114,0)
NODELIST(NODELIST,FILE,IENS,FIELD) ;
"RTN","RORLOCK",115,0)
 N NODE,PI,RC  K NODELIST
"RTN","RORLOCK",116,0)
 S NODELIST="",RC=0
"RTN","RORLOCK",117,0)
 ;--- Main object
"RTN","RORLOCK",118,0)
 I $G(FILE)>0  D  Q:RC<0 RC
"RTN","RORLOCK",119,0)
 . S NODE=$$NODE(FILE,IENS,FIELD)
"RTN","RORLOCK",120,0)
 . I NODE<0  S RC=+NODE  Q
"RTN","RORLOCK",121,0)
 . S NODELIST=NODELIST_","_NODE
"RTN","RORLOCK",122,0)
 . S NODELIST(NODE)=""
"RTN","RORLOCK",123,0)
 ;--- Linked objects
"RTN","RORLOCK",124,0)
 S PI="FILE"
"RTN","RORLOCK",125,0)
 F  S PI=$Q(@PI)  Q:PI=""  D  Q:RC<0
"RTN","RORLOCK",126,0)
 . S NODE=$$NODE($QS(PI,1),$QS(PI,2),$QS(PI,3))
"RTN","RORLOCK",127,0)
 . I NODE<0  S RC=+NODE  Q
"RTN","RORLOCK",128,0)
 . S NODELIST=NODELIST_","_NODE
"RTN","RORLOCK",129,0)
 . S NODELIST(NODE)=""
"RTN","RORLOCK",130,0)
 Q:RC<0 RC
"RTN","RORLOCK",131,0)
 ;---
"RTN","RORLOCK",132,0)
 S NODELIST=$P(NODELIST,",",2,999)
"RTN","RORLOCK",133,0)
 Q RC
"RTN","RORLOCK",134,0)
 ;
"RTN","RORLOCK",135,0)
 ;***** GENERATES A TEXT DESCRIPTION FROM THE LOCK DESCRIPTOR
"RTN","RORLOCK",136,0)
 ;
"RTN","RORLOCK",137,0)
 ; LDSC          Lock descriptor returned by the $$LOCK^RORLOCK
"RTN","RORLOCK",138,0)
 ;
"RTN","RORLOCK",139,0)
TEXT(LDSC) ;
"RTN","RORLOCK",140,0)
 N LTEXT
"RTN","RORLOCK",141,0)
 S LTEXT=$P(LDSC,U,2)_" about "_$$FMTE^XLFDT(+LDSC)
"RTN","RORLOCK",142,0)
 S:$P(LDSC,U,4) LTEXT=LTEXT_"; Job #"_$P(LDSC,U,4)
"RTN","RORLOCK",143,0)
 S:$P(LDSC,U,5) LTEXT=LTEXT_"; Task #"_$P(LDSC,U,5)
"RTN","RORLOCK",144,0)
 Q LTEXT
"RTN","RORLOCK",145,0)
 ;
"RTN","RORLOCK",146,0)
 ;***** UNLOCKS THE (SUB)FILE, RECORD OR FIELD NODE
"RTN","RORLOCK",147,0)
 ;
"RTN","RORLOCK",148,0)
 ; FILE          File/subfile number
"RTN","RORLOCK",149,0)
 ; [IENS]        IENS of the record or subfile
"RTN","RORLOCK",150,0)
 ; [FIELD]       Field number
"RTN","RORLOCK",151,0)
 ;
"RTN","RORLOCK",152,0)
 ; Return Values:
"RTN","RORLOCK",153,0)
 ;       <0  Error code
"RTN","RORLOCK",154,0)
 ;        0  Ok
"RTN","RORLOCK",155,0)
 ;
"RTN","RORLOCK",156,0)
 ; NOTE: This entry point can also be called as a procedure:
"RTN","RORLOCK",157,0)
 ;       D UNLOCK^RORLOCK(...) if you do not need its return value.
"RTN","RORLOCK",158,0)
 ;
"RTN","RORLOCK",159,0)
UNLOCK(FILE,IENS,FIELD) ;
"RTN","RORLOCK",160,0)
 N NODELIST,NODE,PI,RC
"RTN","RORLOCK",161,0)
 I $D(FILE)<10  S RC=0  D:$G(FILE)>0  Q:$QUIT RC  Q
"RTN","RORLOCK",162,0)
 . S RC=$$UNLOCK1(FILE,$G(IENS),$G(FIELD))
"RTN","RORLOCK",163,0)
 ;--- Compile the list of global nodes
"RTN","RORLOCK",164,0)
 S RC=$$NODELIST(.NODELIST,.FILE,$G(IENS),$G(FIELD))
"RTN","RORLOCK",165,0)
 I RC<0  Q:$QUIT RC  Q
"RTN","RORLOCK",166,0)
 I NODELIST=""  Q:$QUIT 0  Q
"RTN","RORLOCK",167,0)
 ;--- Remove the lock descriptor(s)
"RTN","RORLOCK",168,0)
 S NODE=""
"RTN","RORLOCK",169,0)
 F  S NODE=$O(NODELIST(NODE))  Q:NODE=""  D
"RTN","RORLOCK",170,0)
 . K ^XTMP("RORLOCK",$$XLNDX(NODE))
"RTN","RORLOCK",171,0)
 ;--- Unlock the object(s)
"RTN","RORLOCK",172,0)
 X "L -("_NODELIST_")"
"RTN","RORLOCK",173,0)
 Q:$QUIT 0  Q
"RTN","RORLOCK",174,0)
 ;
"RTN","RORLOCK",175,0)
UNLOCK1(FILE,IENS,FIELD) ;
"RTN","RORLOCK",176,0)
 N NODE
"RTN","RORLOCK",177,0)
 S NODE=$$NODE(FILE,$G(IENS),$G(FIELD))
"RTN","RORLOCK",178,0)
 Q:NODE<0 NODE
"RTN","RORLOCK",179,0)
 ;--- Remove the lock descriptor
"RTN","RORLOCK",180,0)
 K ^XTMP("RORLOCK",$$XLNDX(NODE))
"RTN","RORLOCK",181,0)
 ;--- Unlock the object
"RTN","RORLOCK",182,0)
 L -@NODE
"RTN","RORLOCK",183,0)
 Q 0
"RTN","RORLOCK",184,0)
 ;
"RTN","RORLOCK",185,0)
 ;***** RETURNS SUBSCRIPT OF THE NODE IN THE DESCRIPTOR TABLE
"RTN","RORLOCK",186,0)
XLNDX(NODE) ;
"RTN","RORLOCK",187,0)
 N L  S L=$L(NODE)
"RTN","RORLOCK",188,0)
 Q $S($E(NODE,L)=")":$E(NODE,1,L-1),1:NODE)
"RTN","RORLOG")
0^81^B46747985
"RTN","RORLOG",1,0)
RORLOG ;HCIOFO/SG - LOG FILE MANAGEMENT ; 1/17/06 10:10am
"RTN","RORLOG",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORLOG",3,0)
 ;
"RTN","RORLOG",4,0)
 ; RORLOG -------------- CONSTANT & VARIABLES OF THE LOG SUSBSYSTEM
"RTN","RORLOG",5,0)
 ;
"RTN","RORLOG",6,0)
 ; RORLOG("IEN")         IEN of the main record in the ROR LOG file
"RTN","RORLOG",7,0)
 ;
"RTN","RORLOG",8,0)
 ; This routine uses the following IAs:
"RTN","RORLOG",9,0)
 ;
"RTN","RORLOG",10,0)
 ; #10060        Read-only (DBS API) access to the NEW PERSON file
"RTN","RORLOG",11,0)
 ;
"RTN","RORLOG",12,0)
 Q
"RTN","RORLOG",13,0)
 ;
"RTN","RORLOG",14,0)
 ;***** RECORDS THE ACCESS VIOLATION EVENT
"RTN","RORLOG",15,0)
 ;
"RTN","RORLOG",16,0)
 ; MSG           Either a negative code of the message or a message
"RTN","RORLOG",17,0)
 ;               text that will be recorded in the log.
"RTN","RORLOG",18,0)
 ;
"RTN","RORLOG",19,0)
 ; [REGISTRY]    Either a registry name or a registry IEN
"RTN","RORLOG",20,0)
 ;               (the log will be associated with this registry)
"RTN","RORLOG",21,0)
 ;
"RTN","RORLOG",22,0)
 ; [ARG2-ARG5]   Optional parameters as for $$MSG^RORERR20
"RTN","RORLOG",23,0)
 ;
"RTN","RORLOG",24,0)
ACVIOLTN(MSG,REGISTRY,ARG2,ARG3,ARG4,ARG5) ;
"RTN","RORLOG",25,0)
 N INFO,RORLOG,RORMSG,RORPARM
"RTN","RORLOG",26,0)
 S REGISTRY=$G(REGISTRY)
"RTN","RORLOG",27,0)
 ;--- Make sure that event recording is enabled
"RTN","RORLOG",28,0)
 S RORPARM("LOG")=1
"RTN","RORLOG",29,0)
 ;--- Get the registry name
"RTN","RORLOG",30,0)
 I (+REGISTRY)=REGISTRY  D:REGISTRY>0
"RTN","RORLOG",31,0)
 . S REGISTRY=$P($G(^ROR(798.1,+REGISTRY,0)),U)
"RTN","RORLOG",32,0)
 ;--- Get the text of the message (if a code is provided)
"RTN","RORLOG",33,0)
 S:(+MSG)=MSG MSG=$$MSG^RORERR20(+MSG,,,.ARG2,.ARG3,.ARG4,.ARG5)
"RTN","RORLOG",34,0)
 ;--- Send an alert to the registry coordinators
"RTN","RORLOG",35,0)
 D:REGISTRY'=""
"RTN","RORLOG",36,0)
 . S INFO=$G(DUZ)_U_$$NOW^XLFDT
"RTN","RORLOG",37,0)
 . D ALERT^RORUTL01(REGISTRY,MSG,"ACLRTN^RORLOG01",INFO)
"RTN","RORLOG",38,0)
 ;--- Create a new log and record the message
"RTN","RORLOG",39,0)
 I $$OPEN(REGISTRY,6)'<0  D  D CLOSE()
"RTN","RORLOG",40,0)
 . D:$G(DUZ)>0
"RTN","RORLOG",41,0)
 . . S INFO="Violator: "_$$GET1^DIQ(200,DUZ_",",.01,,,"RORMSG")
"RTN","RORLOG",42,0)
 . . S INFO=INFO_" (DUZ="_DUZ_")"
"RTN","RORLOG",43,0)
 . D LOG(6,MSG,,.INFO)
"RTN","RORLOG",44,0)
 Q
"RTN","RORLOG",45,0)
 ;
"RTN","RORLOG",46,0)
 ;***** CLOSES THE CURRENT LOG
"RTN","RORLOG",47,0)
 ;
"RTN","RORLOG",48,0)
 ; [MESSAGE]     Text of the final message
"RTN","RORLOG",49,0)
 ; [COUNTERS]    Statistic counters
"RTN","RORLOG",50,0)
 ;                 ^1: Total number of processed patients
"RTN","RORLOG",51,0)
 ;                 ^2: Number of patients processed with errors
"RTN","RORLOG",52,0)
 ;
"RTN","RORLOG",53,0)
CLOSE(MESSAGE,COUNTERS) ;
"RTN","RORLOG",54,0)
 Q:$G(RORLOG("IEN"))'>0
"RTN","RORLOG",55,0)
 N BDT,EDT,IENS,RATE,RORFDA,RORINFO,RORMSG,TMP
"RTN","RORLOG",56,0)
 S EDT=$$NOW^XLFDT
"RTN","RORLOG",57,0)
 S IENS=RORLOG("IEN")_","
"RTN","RORLOG",58,0)
 ;--- Prepare statistic data
"RTN","RORLOG",59,0)
 D:$G(COUNTERS)>0
"RTN","RORLOG",60,0)
 . S RORINFO(1)="Patients:     "_+$P(COUNTERS,U)
"RTN","RORLOG",61,0)
 . S RORINFO(2)="Errors:       "_+$P(COUNTERS,U,2)
"RTN","RORLOG",62,0)
 . S BDT=$$GET1^DIQ(798.7,IENS,.01,"I",,"RORMSG")
"RTN","RORLOG",63,0)
 . Q:$G(BDT)'>0
"RTN","RORLOG",64,0)
 . S TMP=$$FMDIFF^XLFDT(EDT,BDT,2)
"RTN","RORLOG",65,0)
 . S RATE=$S(TMP>0:$J(COUNTERS/TMP,0,3),1:"")
"RTN","RORLOG",66,0)
 . S RORINFO(3)="Time (sec):   "_TMP
"RTN","RORLOG",67,0)
 . S:RATE RORINFO(4)="Patients/sec: "_RATE
"RTN","RORLOG",68,0)
 . ;--- Data for the log header
"RTN","RORLOG",69,0)
 . S RORFDA(798.7,IENS,6.01)=$P(COUNTERS,U,1)
"RTN","RORLOG",70,0)
 . S RORFDA(798.7,IENS,6.02)=$P(COUNTERS,U,2)
"RTN","RORLOG",71,0)
 . S:RATE RORFDA(798.7,IENS,6.03)=RATE
"RTN","RORLOG",72,0)
 ;--- Store data in the header and log the final message
"RTN","RORLOG",73,0)
 S RORFDA(798.7,IENS,5)=EDT
"RTN","RORLOG",74,0)
 D FILE^DIE("K","RORFDA","RORMSG")
"RTN","RORLOG",75,0)
 D:$G(MESSAGE)'="" LOG^RORLOG(,MESSAGE,,.RORINFO)
"RTN","RORLOG",76,0)
 K RORLOG
"RTN","RORLOG",77,0)
 Q
"RTN","RORLOG",78,0)
 ;
"RTN","RORLOG",79,0)
 ;***** PUTS MESSAGE IN THE LOG
"RTN","RORLOG",80,0)
 ;
"RTN","RORLOG",81,0)
 ; [TYPE]        Type of the event:
"RTN","RORLOG",82,0)
 ;                 1  Debug
"RTN","RORLOG",83,0)
 ;                 2  Information
"RTN","RORLOG",84,0)
 ;                 3  Data quality
"RTN","RORLOG",85,0)
 ;                 4  Warning
"RTN","RORLOG",86,0)
 ;                 5  Database error
"RTN","RORLOG",87,0)
 ;                 6  Error
"RTN","RORLOG",88,0)
 ;
"RTN","RORLOG",89,0)
 ;       If value of the parameter is omitted or equals 0, the message
"RTN","RORLOG",90,0)
 ;       is logged as "information" (if log is enabled). This mode is
"RTN","RORLOG",91,0)
 ;       intended for log headers and separators.
"RTN","RORLOG",92,0)
 ;
"RTN","RORLOG",93,0)
 ; MESSAGE       Message text
"RTN","RORLOG",94,0)
 ; [PATIEN]      Patient IEN
"RTN","RORLOG",95,0)
 ;
"RTN","RORLOG",96,0)
 ; [[.]RORINFO]  Optional additional information (either a string or
"RTN","RORLOG",97,0)
 ;               a reference to a local array that contains strings
"RTN","RORLOG",98,0)
 ;               prepared for storing in a word processing field)
"RTN","RORLOG",99,0)
 ;
"RTN","RORLOG",100,0)
LOG(TYPE,MESSAGE,PATIEN,RORINFO) ;
"RTN","RORLOG",101,0)
 ;--- Do not do anything if log is disabled
"RTN","RORLOG",102,0)
 Q:'$G(RORPARM("LOG"))
"RTN","RORLOG",103,0)
 ;--- Check if collection of this kind of event is enabled.
"RTN","RORLOG",104,0)
 ;    Debug messages could be enabled only explicitly.
"RTN","RORLOG",105,0)
 I '$G(TYPE)  S TYPE=2
"RTN","RORLOG",106,0)
 E  I ($D(RORPARM("LOG"))>1)!(TYPE=1)  Q:'$G(RORPARM("LOG",+TYPE))
"RTN","RORLOG",107,0)
 ;---
"RTN","RORLOG",108,0)
 N CURRIO,DATETIME,I,IENS,RC,RORFDA,RORMSG,TMP
"RTN","RORLOG",109,0)
 I $D(RORINFO)=1  S TMP=RORINFO  K RORINFO  S RORINFO(1)=TMP  K TMP
"RTN","RORLOG",110,0)
 S DATETIME=$$NOW^XLFDT
"RTN","RORLOG",111,0)
 ;--- Add a new record to the log (if it has been open)
"RTN","RORLOG",112,0)
 D:$G(RORLOG("IEN"))>0
"RTN","RORLOG",113,0)
 . S IENS="+1,"_RORLOG("IEN")_","
"RTN","RORLOG",114,0)
 . S RORFDA(798.74,IENS,.01)=DATETIME
"RTN","RORLOG",115,0)
 . S RORFDA(798.74,IENS,1)=+TYPE
"RTN","RORLOG",116,0)
 . S RORFDA(798.74,IENS,2)=$E(MESSAGE,1,70)
"RTN","RORLOG",117,0)
 . S:$G(PATIEN) RORFDA(798.74,IENS,3)=+PATIEN
"RTN","RORLOG",118,0)
 . S:$D(RORINFO)>1 RORFDA(798.74,IENS,4)="RORINFO"
"RTN","RORLOG",119,0)
 . D UPDATE^DIE(,"RORFDA",,"RORMSG")
"RTN","RORLOG",120,0)
 ;--- Display message (if debug mode 2 is enabled)
"RTN","RORLOG",121,0)
 I $G(RORPARM("DEBUG"))>1  U $G(IO(0))  D  U IO
"RTN","RORLOG",122,0)
 . W !,$P($$FMTE^XLFDT(DATETIME,"2FS"),"@",2)_" "_$E(MESSAGE,1,70),!
"RTN","RORLOG",123,0)
 . S I=""
"RTN","RORLOG",124,0)
 . F  S I=$O(RORINFO(I))  Q:I=""  D  W ?9,TMP,!
"RTN","RORLOG",125,0)
 . . S TMP=$G(RORINFO(I))  S:TMP="" TMP=$G(RORINFO(I,0))
"RTN","RORLOG",126,0)
 . W:$G(PATIEN) ?9,"Patient IEN: "_PATIEN,!
"RTN","RORLOG",127,0)
 Q
"RTN","RORLOG",128,0)
 ;
"RTN","RORLOG",129,0)
 ;***** RETURNS AN IEN OF THE CURRENT LOG
"RTN","RORLOG",130,0)
LOGIEN() ;
"RTN","RORLOG",131,0)
 Q +$G(RORLOG("IEN"))
"RTN","RORLOG",132,0)
 ;
"RTN","RORLOG",133,0)
 ;***** OPENS A NEW LOG
"RTN","RORLOG",134,0)
 ;
"RTN","RORLOG",135,0)
 ; [[.]REGLST]   Either name of the registry or reference to a local
"RTN","RORLOG",136,0)
 ;               array containing registry names as subscripts and
"RTN","RORLOG",137,0)
 ;               optional registry IENs as values
"RTN","RORLOG",138,0)
 ;
"RTN","RORLOG",139,0)
 ; [ACTIVITY]    Type of the activity:
"RTN","RORLOG",140,0)
 ;                 0  Other (default)
"RTN","RORLOG",141,0)
 ;                 1  Registry update
"RTN","RORLOG",142,0)
 ;                 2  Data Extract
"RTN","RORLOG",143,0)
 ;                 3  Acknowledgement
"RTN","RORLOG",144,0)
 ;                 4  Hist. Extraction
"RTN","RORLOG",145,0)
 ;                 5  Report
"RTN","RORLOG",146,0)
 ;                 6  Access Violation
"RTN","RORLOG",147,0)
 ;                 7  ROR TASK
"RTN","RORLOG",148,0)
 ;                 8  Registry Setup
"RTN","RORLOG",149,0)
 ;
"RTN","RORLOG",150,0)
 ; [MESSAGE]     Text of the first message
"RTN","RORLOG",151,0)
 ;
"RTN","RORLOG",152,0)
 ; [[.]ADDINFO]  Optional additional information (either a string or
"RTN","RORLOG",153,0)
 ;               a reference to a local array that contains strings
"RTN","RORLOG",154,0)
 ;               prepared for storing in a word processing field).
"RTN","RORLOG",155,0)
 ;               This text is appended after the list of registries
"RTN","RORLOG",156,0)
 ;               associated with the log.
"RTN","RORLOG",157,0)
 ;
"RTN","RORLOG",158,0)
 ; Return Values:
"RTN","RORLOG",159,0)
 ;       <0  Error code
"RTN","RORLOG",160,0)
 ;        0  Ok
"RTN","RORLOG",161,0)
 ;
"RTN","RORLOG",162,0)
OPEN(REGLST,ACTIVITY,MESSAGE,ADDINFO) ;
"RTN","RORLOG",163,0)
 Q:'$G(RORPARM("LOG")) 0
"RTN","RORLOG",164,0)
 N I,IENS,IPTR,RC,REGIEN,REGNAME,RORFDA,RORIEN,RORINFO,RORMSG,TMP
"RTN","RORLOG",165,0)
 K RORLOG
"RTN","RORLOG",166,0)
 ;=== Prepare the list of registries
"RTN","RORLOG",167,0)
 I $D(REGLST)=1  S:REGLST'="" REGLST(REGLST)=""
"RTN","RORLOG",168,0)
 S REGNAME="",(IPTR,RC)=0
"RTN","RORLOG",169,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:RC<0
"RTN","RORLOG",170,0)
 . S REGIEN=+$G(REGLST(REGNAME))
"RTN","RORLOG",171,0)
 . I REGIEN'>0  D  I REGIEN'>0  S RC=REGIEN  Q
"RTN","RORLOG",172,0)
 . . S REGIEN=$$REGIEN^RORUTL02(REGNAME)
"RTN","RORLOG",173,0)
 . S IPTR=IPTR+1,RORINFO(IPTR)=REGNAME
"RTN","RORLOG",174,0)
 . S RORFDA(798.73,"+"_(IPTR+10)_",+1,",.01)=REGIEN
"RTN","RORLOG",175,0)
 . S RORIEN(IPTR+10)=REGIEN
"RTN","RORLOG",176,0)
 Q:RC<0 RC
"RTN","RORLOG",177,0)
 ;=== Create a log header (main record) in the ROR LOG file
"RTN","RORLOG",178,0)
 S IENS="+1,"
"RTN","RORLOG",179,0)
 S RORFDA(798.7,IENS,.01)=$$NOW^XLFDT
"RTN","RORLOG",180,0)
 S:$G(ACTIVITY)>0 RORFDA(798.7,IENS,1)=ACTIVITY
"RTN","RORLOG",181,0)
 S RORFDA(798.7,IENS,2)=$J
"RTN","RORLOG",182,0)
 S RORFDA(798.7,IENS,7)=$S($G(DUZ)>0:+DUZ,1:"")
"RTN","RORLOG",183,0)
 S TMP=$S($D(ZTQUEUED):+$G(ZTSK),1:0)
"RTN","RORLOG",184,0)
 S RORFDA(798.7,IENS,8)=$S(TMP>0:TMP,1:"")
"RTN","RORLOG",185,0)
 D UPDATE^DIE(,"RORFDA","RORIEN","RORMSG")
"RTN","RORLOG",186,0)
 S RC=$$DBS^RORERR("RORMSG",-9)  Q:RC<0 RC
"RTN","RORLOG",187,0)
 S RORLOG("IEN")=RORIEN(1)
"RTN","RORLOG",188,0)
 ;=== Add the header message (if any)
"RTN","RORLOG",189,0)
 D:$G(MESSAGE)'=""
"RTN","RORLOG",190,0)
 . ;--- Append the additional text to list of registries
"RTN","RORLOG",191,0)
 . I $D(ADDINFO)=1  D
"RTN","RORLOG",192,0)
 . . S IPTR=IPTR+1,RORINFO(IPTR)=ADDINFO
"RTN","RORLOG",193,0)
 . E  S I=""  D
"RTN","RORLOG",194,0)
 . . F  S I=$O(ADDINFO(I))  Q:I=""  D
"RTN","RORLOG",195,0)
 . . . S TMP=$G(ADDINFO(I)),IPTR=IPTR+1
"RTN","RORLOG",196,0)
 . . . S RORINFO(IPTR)=$S(TMP'="":TMP,1:$G(ADDINFO(I,0)))
"RTN","RORLOG",197,0)
 . ;---
"RTN","RORLOG",198,0)
 . D LOG(,MESSAGE,,.RORINFO)
"RTN","RORLOG",199,0)
 ;=== Success
"RTN","RORLOG",200,0)
 Q 0
"RTN","RORLOG",201,0)
 ;
"RTN","RORLOG",202,0)
 ;***** REPLACES LIST OF REGISTRIES ASSOCIATED WITH THE CURRENT LOG
"RTN","RORLOG",203,0)
 ;
"RTN","RORLOG",204,0)
 ; [.]REGLST     Either name of the registry or a reference to a local
"RTN","RORLOG",205,0)
 ;               array containing registry names as subscripts and
"RTN","RORLOG",206,0)
 ;               optional registry IENs as values.
"RTN","RORLOG",207,0)
 ;
"RTN","RORLOG",208,0)
 ; [NOLP]        If this parameter is defined and non-zero, the log
"RTN","RORLOG",209,0)
 ;               subsystem parameters will not be updated according
"RTN","RORLOG",210,0)
 ;               to the new list of associated registries.
"RTN","RORLOG",211,0)
 ;
"RTN","RORLOG",212,0)
 ; Return Values:
"RTN","RORLOG",213,0)
 ;       <0  Error code
"RTN","RORLOG",214,0)
 ;        0  Ok
"RTN","RORLOG",215,0)
 ;
"RTN","RORLOG",216,0)
SETRGLST(REGLST,NOLP) ;
"RTN","RORLOG",217,0)
 N I,IENS,RC,REGIEN,RILST,RORBUF,RORFDA,RORIEN,RORMSG
"RTN","RORLOG",218,0)
 S IENS=$$LOGIEN()_","
"RTN","RORLOG",219,0)
 Q:'$G(RORPARM("LOG"))!(IENS'>0) 0
"RTN","RORLOG",220,0)
 ;--- Compile a list of registry IENs (as subscripts)
"RTN","RORLOG",221,0)
 S:$D(REGLST)=1 REGLST(REGLST)=""
"RTN","RORLOG",222,0)
 S I="",RC=0
"RTN","RORLOG",223,0)
 F  S I=$O(REGLST(I))  Q:I=""  D  Q:RC<0
"RTN","RORLOG",224,0)
 . S REGIEN=+$G(REGLST(I))
"RTN","RORLOG",225,0)
 . I REGIEN'>0  D  I REGIEN'>0  S RC=REGIEN  Q
"RTN","RORLOG",226,0)
 . . S REGIEN=$$REGIEN^RORUTL02(I)
"RTN","RORLOG",227,0)
 . S RILST(REGIEN)=""
"RTN","RORLOG",228,0)
 Q:RC<0 RC
"RTN","RORLOG",229,0)
 ;--- Delete old registries from the multiple of the log record
"RTN","RORLOG",230,0)
 D LIST^DIC(798.73,","_IENS,"@;.01I","U",,,,"B",,,"RORBUF","RORMSG")
"RTN","RORLOG",231,0)
 S RC=$$DBS^RORERR("RORMSG",-9)  Q:RC<0 RC
"RTN","RORLOG",232,0)
 S I=""
"RTN","RORLOG",233,0)
 F  S I=$O(RORBUF("DILIST",2,I))  Q:I=""  D
"RTN","RORLOG",234,0)
 . S REGIEN=RORBUF("DILIST","ID",I,.01)
"RTN","RORLOG",235,0)
 . I $D(RILST(REGIEN))  K RILST(REGIEN)  Q
"RTN","RORLOG",236,0)
 . S RORFDA(798.73,RORBUF("DILIST",2,I)_","_IENS,.01)="@"
"RTN","RORLOG",237,0)
 I $D(RORFDA)>1  D  Q:RC<0 RC
"RTN","RORLOG",238,0)
 . D FILE^DIE("K","RORFDA","RORMSG")
"RTN","RORLOG",239,0)
 . S RC=$$DBS^RORERR("RORMSG",-9)
"RTN","RORLOG",240,0)
 ;--- Add new registries to the multiple
"RTN","RORLOG",241,0)
 S REGIEN=""
"RTN","RORLOG",242,0)
 F I=1:1  S REGIEN=$O(RILST(REGIEN))  Q:REGIEN=""  D
"RTN","RORLOG",243,0)
 . S RORFDA(798.73,"+"_I_","_IENS,.01)=REGIEN
"RTN","RORLOG",244,0)
 . S RORIEN(I)=REGIEN
"RTN","RORLOG",245,0)
 I $D(RORFDA)>1  D  Q:RC<0 RC
"RTN","RORLOG",246,0)
 . D UPDATE^DIE(,"RORFDA","RORIEN","RORMSG")
"RTN","RORLOG",247,0)
 . S RC=$$DBS^RORERR("RORMSG",-9)
"RTN","RORLOG",248,0)
 ;--- Reload parameters (if necessary)
"RTN","RORLOG",249,0)
 I '$G(NOLP)  D  Q:RC<0 RC
"RTN","RORLOG",250,0)
 . K RORPARM("LOG")  S RC=$$PARAMS^RORLOG01(.REGLST)
"RTN","RORLOG",251,0)
 Q 0
"RTN","RORLOG",252,0)
 ;
"RTN","RORLOG",253,0)
 ;***** INITIALIZES THE LOG SUBSYSTEM
"RTN","RORLOG",254,0)
 ;
"RTN","RORLOG",255,0)
 ; [[.]REGLST]   Either a reference to a local array containing names
"RTN","RORLOG",256,0)
 ;               of the registries to process (as subscripts) or a
"RTN","RORLOG",257,0)
 ;               string that contains a name of the single registry.
"RTN","RORLOG",258,0)
 ;
"RTN","RORLOG",259,0)
 ; Return Values:
"RTN","RORLOG",260,0)
 ;       <0  Error code
"RTN","RORLOG",261,0)
 ;        0  Ok
"RTN","RORLOG",262,0)
 ;
"RTN","RORLOG",263,0)
SETUP(REGLST) ;
"RTN","RORLOG",264,0)
 K RORPARM("LOG"),RORLOG
"RTN","RORLOG",265,0)
 S:$D(REGLST)=1 REGLST(REGLST)=""
"RTN","RORLOG",266,0)
 Q $$PARAMS^RORLOG01(.REGLST)
"RTN","RORLOG01")
0^82^B13742298
"RTN","RORLOG01",1,0)
RORLOG01 ;HCIOFO/SG - LOG FILE MANAGEMENT (UTILITIES) ; 1/17/06 10:09am
"RTN","RORLOG01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORLOG01",3,0)
 ;
"RTN","RORLOG01",4,0)
 Q
"RTN","RORLOG01",5,0)
 ;
"RTN","RORLOG01",6,0)
 ;***** PROCESSES AN ACCESS VIOLATION ALERT
"RTN","RORLOG01",7,0)
ACLRTN ;
"RTN","RORLOG01",8,0)
 N I,PARAMS,RORBUF
"RTN","RORLOG01",9,0)
 ;--- Prepare the parameters
"RTN","RORLOG01",10,0)
 S (PARAMS("DUZ"),I)=+$P(XQADATA,U)
"RTN","RORLOG01",11,0)
 I I>0  D  K RORBUF
"RTN","RORLOG01",12,0)
 . S PARAMS("USERNAME")=$$GET1^DIQ(200,I_",",.01,,,"RORBUF")
"RTN","RORLOG01",13,0)
 S:$G(PARAMS("USERNAME"))="" PARAMS("USERNAME")="unknown user"
"RTN","RORLOG01",14,0)
 S PARAMS("DATETIME")=$$FMTE^XLFDT($P(XQADATA,U,2))
"RTN","RORLOG01",15,0)
 ;--- Generate the text of alert
"RTN","RORLOG01",16,0)
 D BLD^DIALOG(7980000.015,.PARAMS,,"RORBUF","S")
"RTN","RORLOG01",17,0)
 ;--- Display the alert details
"RTN","RORLOG01",18,0)
 S I=0  W !
"RTN","RORLOG01",19,0)
 F  S I=$O(RORBUF(I))  Q:I'>0  W !,RORBUF(I)
"RTN","RORLOG01",20,0)
 Q
"RTN","RORLOG01",21,0)
 ;
"RTN","RORLOG01",22,0)
 ;***** LOADS THE LOG SUBSYSTEM PARAMETERS
"RTN","RORLOG01",23,0)
 ;
"RTN","RORLOG01",24,0)
 ; .RORLST       Reference to a local array containing names
"RTN","RORLOG01",25,0)
 ;               of the registries to process (as subscripts).
"RTN","RORLOG01",26,0)
 ;
"RTN","RORLOG01",27,0)
 ; Return Values:
"RTN","RORLOG01",28,0)
 ;       <0  Error code
"RTN","RORLOG01",29,0)
 ;        0  Ok
"RTN","RORLOG01",30,0)
 ;
"RTN","RORLOG01",31,0)
PARAMS(RORLST) ;
"RTN","RORLOG01",32,0)
 N ENABLE,IENS,IR,IRS,RC,RORBUF,RORMSG,RORSB,SCR,TYPE
"RTN","RORLOG01",33,0)
 ;--- Load a list of parameters of active registries
"RTN","RORLOG01",34,0)
 S SCR="I '$P(^(0),U,7),$D(RORLST($P(^(0),U)))"
"RTN","RORLOG01",35,0)
 D LIST^DIC(798.1,,"@;8I","U","*",,,"B",SCR,,"RORBUF","RORMSG")
"RTN","RORLOG01",36,0)
 S RC=$$DBS^RORERR("RORMSG",-9)  Q:RC<0 RC
"RTN","RORLOG01",37,0)
 I '$G(RORBUF("DILIST",0))  S RORPARM("LOG")=1  Q 0
"RTN","RORLOG01",38,0)
 ;--- Process the list of log parameters
"RTN","RORLOG01",39,0)
 S IR="",RC=0
"RTN","RORLOG01",40,0)
 F  S IR=$O(RORBUF("DILIST","ID",IR))  Q:IR=""  D  Q:RC
"RTN","RORLOG01",41,0)
 . ;--- Check if the log is enabled
"RTN","RORLOG01",42,0)
 . Q:'$G(RORBUF("DILIST","ID",IR,8))
"RTN","RORLOG01",43,0)
 . S ENABLE=1
"RTN","RORLOG01",44,0)
 . ;--- Load a list of event types to log
"RTN","RORLOG01",45,0)
 . S IRS=","_RORBUF("DILIST",2,IR)_","  K RORSB
"RTN","RORLOG01",46,0)
 . D LIST^DIC(798.11,IRS,"@;.01I","U","*",,,"B",,,"RORSB","RORMSG")
"RTN","RORLOG01",47,0)
 . S RC=$$DBS^RORERR("RORMSG",-9)  Q:RC<0
"RTN","RORLOG01",48,0)
 . ;--- If there are no event types, log all events
"RTN","RORLOG01",49,0)
 . I '$G(RORSB("DILIST",0))  D  Q
"RTN","RORLOG01",50,0)
 . . K RORPARM("LOG")  S RC=1
"RTN","RORLOG01",51,0)
 . ;--- Process the list of event types
"RTN","RORLOG01",52,0)
 . S IRS=""
"RTN","RORLOG01",53,0)
 . F  S IRS=$O(RORSB("DILIST","ID",IRS))  Q:IRS=""  D
"RTN","RORLOG01",54,0)
 . . S TYPE=+$G(RORSB("DILIST","ID",IRS,.01))
"RTN","RORLOG01",55,0)
 . . S:TYPE RORPARM("LOG",TYPE)=1
"RTN","RORLOG01",56,0)
 S:$G(ENABLE) RORPARM("LOG")=1
"RTN","RORLOG01",57,0)
 ;--- If not all types of errors are recorded,
"RTN","RORLOG01",58,0)
 ;    enable recording of the type "Error"
"RTN","RORLOG01",59,0)
 S:$D(RORPARM("LOG"))>1 RORPARM("LOG",6)=1
"RTN","RORLOG01",60,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORLOG01",61,0)
 ;
"RTN","RORLOG01",62,0)
 ;***** PURGES THE OLD LOGS
"RTN","RORLOG01",63,0)
 ;
"RTN","RORLOG01",64,0)
 ; [DKEEP]       Days to keep logs in the file (by default = 31)
"RTN","RORLOG01",65,0)
 ;
"RTN","RORLOG01",66,0)
 ; Return Values:
"RTN","RORLOG01",67,0)
 ;       <0  Error code
"RTN","RORLOG01",68,0)
 ;        0  Ok
"RTN","RORLOG01",69,0)
 ;
"RTN","RORLOG01",70,0)
PURGE(DKEEP) ;
"RTN","RORLOG01",71,0)
 N HDR,IEN,IR,RC,RORFDA,RORFROM,RORMSG
"RTN","RORLOG01",72,0)
 S RORFROM=$$FMADD^XLFDT($$DT^XLFDT,-$G(DKEEP,31))+1
"RTN","RORLOG01",73,0)
 S RC=0
"RTN","RORLOG01",74,0)
 F  D  Q:'$P($G(HDR),U,3)!(RC<0)
"RTN","RORLOG01",75,0)
 . K RORFDA,RORMSG
"RTN","RORLOG01",76,0)
 . ;--- Get the next 10 records
"RTN","RORLOG01",77,0)
 . D LIST^DIC(798.7,,"@","BU",10,.RORFROM,,"B",,,"RORFDA","RORMSG")
"RTN","RORLOG01",78,0)
 . S RC=$$DBS^RORERR("RORMSG",-9)  Q:RC<0
"RTN","RORLOG01",79,0)
 . ;--- Stop if no records left
"RTN","RORLOG01",80,0)
 . S HDR=$G(RORFDA("DILIST",0))  Q:'HDR
"RTN","RORLOG01",81,0)
 . ;--- Prepare the data
"RTN","RORLOG01",82,0)
 . S IR=""
"RTN","RORLOG01",83,0)
 . F  S IR=$O(RORFDA("DILIST",2,IR),-1)  Q:IR=""  D
"RTN","RORLOG01",84,0)
 . . S IEN=RORFDA("DILIST",2,IR)
"RTN","RORLOG01",85,0)
 . . ;--- Check if the cross-reference entries are valid
"RTN","RORLOG01",86,0)
 . . D XREFCHK(IEN)
"RTN","RORLOG01",87,0)
 . . ;--- Delete the log only if it is not referenced
"RTN","RORLOG01",88,0)
 . . S:'$D(^RORDATA(798.7,"AREF",IEN)) RORFDA(798.7,IEN_",",.01)="@"
"RTN","RORLOG01",89,0)
 . K RORFDA("DILIST")
"RTN","RORLOG01",90,0)
 . Q:$D(RORFDA)<10
"RTN","RORLOG01",91,0)
 . ;--- Delete the records
"RTN","RORLOG01",92,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORLOG01",93,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.7)
"RTN","RORLOG01",94,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORLOG01",95,0)
 ;
"RTN","RORLOG01",96,0)
 ;***** CHECK IF THE LOG IS REALLY REFERENCED
"RTN","RORLOG01",97,0)
 ;
"RTN","RORLOG01",98,0)
 ; LOGIEN        IEN of the log
"RTN","RORLOG01",99,0)
 ;
"RTN","RORLOG01",100,0)
XREFCHK(LOGIEN) ;
"RTN","RORLOG01",101,0)
 N FIELD,FILE,IENS,NODE,RORMSG,TMP
"RTN","RORLOG01",102,0)
 S NODE=$NA(^RORDATA(798.7,"AREF",IEN))
"RTN","RORLOG01",103,0)
 S FILE=""
"RTN","RORLOG01",104,0)
 F  S FILE=$O(@NODE@(FILE))  Q:FILE=""  D
"RTN","RORLOG01",105,0)
 . S IENS=""
"RTN","RORLOG01",106,0)
 . F  S IENS=$O(@NODE@(FILE,IENS))  Q:IENS=""  D
"RTN","RORLOG01",107,0)
 . . S FIELD=""
"RTN","RORLOG01",108,0)
 . . F  S FIELD=$O(@NODE@(FILE,IENS,FIELD))  Q:FIELD=""  D
"RTN","RORLOG01",109,0)
 . . . S TMP=+$$GET1^DIQ(FILE,IENS,FIELD,"I",,"RORMSG")
"RTN","RORLOG01",110,0)
 . . . K:TMP'=LOGIEN @NODE@(FILE,IENS,FIELD)
"RTN","RORLOG01",111,0)
 Q
"RTN","RORNTEG")
0^83^B19432116
"RTN","RORNTEG",1,0)
RORNTEG ;ISC/XTSUMBLD KERNEL - Package checksum checker ;3060126.152942
"RTN","RORNTEG",2,0)
 ;;0.0;
"RTN","RORNTEG",3,0)
 ;;7.3;3060126.152942
"RTN","RORNTEG",4,0)
 S XT4="I 1",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","RORNTEG",5,0)
CONT F XT1=1:1 S XT2=$T(ROU+XT1) Q:XT2=""  S X=$P(XT2," ",1),XT3=$P(XT2,";",3) X XT4 I $T W !,X X ^%ZOSF("TEST") S:'$T XT3=0 X:XT3 ^%ZOSF("RSUM") W ?10,$S('XT3:"Routine not in UCI",XT3'=Y:"Calculated "_$C(7)_Y_", off by "_(Y-XT3),1:"ok")
"RTN","RORNTEG",6,0)
 G CONT^RORNTEG0
"RTN","RORNTEG",7,0)
 K %1,%2,%3,X,Y,XT1,XT2,XT3,XT4 Q
"RTN","RORNTEG",8,0)
ONE S XT4="I $D(^UTILITY($J,X))",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","RORNTEG",9,0)
 W !,"Check a subset of routines:" K ^UTILITY($J) X ^%ZOSF("RSEL")
"RTN","RORNTEG",10,0)
 W ! G CONT
"RTN","RORNTEG",11,0)
ROU ;;
"RTN","RORNTEG",12,0)
ROR ;;2717801
"RTN","RORNTEG",13,0)
ROR01 ;;1117
"RTN","RORNTEG",14,0)
ROR02 ;;1122
"RTN","RORNTEG",15,0)
ROR10 ;;7730208
"RTN","RORNTEG",16,0)
ROR11 ;;8580380
"RTN","RORNTEG",17,0)
RORAPI01 ;;1957725
"RTN","RORNTEG",18,0)
RORBIN ;;2967124
"RTN","RORNTEG",19,0)
RORDD ;;4656034
"RTN","RORNTEG",20,0)
RORDD01 ;;3401360
"RTN","RORNTEG",21,0)
RORERR ;;4405971
"RTN","RORNTEG",22,0)
RORERR20 ;;14492523
"RTN","RORNTEG",23,0)
ROREVT01 ;;2008294
"RTN","RORNTEG",24,0)
ROREXPR ;;5694255
"RTN","RORNTEG",25,0)
ROREXT ;;3147105
"RTN","RORNTEG",26,0)
ROREXT01 ;;8425154
"RTN","RORNTEG",27,0)
ROREXT02 ;;5834876
"RTN","RORNTEG",28,0)
ROREXT03 ;;4554817
"RTN","RORNTEG",29,0)
ROREXTUT ;;5555893
"RTN","RORNTEG",30,0)
RORHDT ;;3349203
"RTN","RORNTEG",31,0)
RORHDT01 ;;1390687
"RTN","RORNTEG",32,0)
RORHDT02 ;;2997526
"RTN","RORNTEG",33,0)
RORHDT03 ;;4297815
"RTN","RORNTEG",34,0)
RORHDT04 ;;9379124
"RTN","RORNTEG",35,0)
RORHDT05 ;;2711736
"RTN","RORNTEG",36,0)
RORHDT06 ;;3568354
"RTN","RORNTEG",37,0)
RORHDTAC ;;2681469
"RTN","RORNTEG",38,0)
RORHDTUT ;;5831331
"RTN","RORNTEG",39,0)
RORHIV03 ;;4806950
"RTN","RORNTEG",40,0)
RORHIVUT ;;357536
"RTN","RORNTEG",41,0)
RORHL01 ;;1491461
"RTN","RORNTEG",42,0)
RORHL02 ;;5546944
"RTN","RORNTEG",43,0)
RORHL03 ;;5258533
"RTN","RORNTEG",44,0)
RORHL031 ;;6235058
"RTN","RORNTEG",45,0)
RORHL04 ;;5297245
"RTN","RORNTEG",46,0)
RORHL05 ;;4084796
"RTN","RORNTEG",47,0)
RORHL06 ;;4217993
"RTN","RORNTEG",48,0)
RORHL07 ;;3246023
"RTN","RORNTEG",49,0)
RORHL071 ;;3217396
"RTN","RORNTEG",50,0)
RORHL08 ;;5887870
"RTN","RORNTEG",51,0)
RORHL081 ;;7585616
"RTN","RORNTEG",52,0)
RORHL09 ;;6026195
"RTN","RORNTEG",53,0)
RORHL10 ;;5509115
"RTN","RORNTEG",54,0)
RORHL11 ;;4565613
"RTN","RORNTEG",55,0)
RORHL12 ;;2399116
"RTN","RORNTEG",56,0)
RORHL121 ;;9878360
"RTN","RORNTEG",57,0)
RORHL13 ;;3466976
"RTN","RORNTEG",58,0)
RORHL14 ;;5357488
"RTN","RORNTEG",59,0)
RORHL15 ;;5532311
"RTN","RORNTEG",60,0)
RORHL16 ;;3252430
"RTN","RORNTEG",61,0)
RORHL17 ;;4936158
"RTN","RORNTEG",62,0)
RORHL7 ;;4806448
"RTN","RORNTEG",63,0)
RORHL7A ;;4554021
"RTN","RORNTEG",64,0)
RORHLUT1 ;;1806943
"RTN","RORNTEG",65,0)
RORKIDS ;;6182684
"RTN","RORNTEG",66,0)
RORLOCK ;;4131518
"RTN","RORNTEG",67,0)
RORLOG ;;6030893
"RTN","RORNTEG",68,0)
RORLOG01 ;;3716383
"RTN","RORNTEG",69,0)
RORP000 ;;10708753
"RTN","RORNTEG",70,0)
RORP000A ;;10206450
"RTN","RORNTEG",71,0)
RORP000B ;;11070750
"RTN","RORNTEG",72,0)
RORPUT01 ;;5495626
"RTN","RORNTEG",73,0)
RORPUT02 ;;5936706
"RTN","RORNTEG",74,0)
RORREP01 ;;9158405
"RTN","RORNTEG",75,0)
RORREP02 ;;10911089
"RTN","RORNTEG",76,0)
RORRP007 ;;4442755
"RTN","RORNTEG",77,0)
RORRP010 ;;1881192
"RTN","RORNTEG",78,0)
RORRP011 ;;2555508
"RTN","RORNTEG",79,0)
RORRP012 ;;1144389
"RTN","RORNTEG",80,0)
RORRP013 ;;4665100
"RTN","RORNTEG",81,0)
RORRP014 ;;2785597
"RTN","RORNTEG",82,0)
RORRP015 ;;3365112
"RTN","RORNTEG",83,0)
RORRP016 ;;3160766
"RTN","RORNTEG",84,0)
RORRP017 ;;1924388
"RTN","RORNTEG",85,0)
RORRP018 ;;1666201
"RTN","RORNTEG",86,0)
RORRP019 ;;5814698
"RTN","RORNTEG",87,0)
RORRP020 ;;4077705
"RTN","RORNTEG",88,0)
RORRP021 ;;3721454
"RTN","RORNTEG",89,0)
RORRP022 ;;1262090
"RTN","RORNTEG",90,0)
RORRP023 ;;2273081
"RTN","RORNTEG",91,0)
RORRP024 ;;3821351
"RTN","RORNTEG",92,0)
RORRP025 ;;4917408
"RTN","RORNTEG",93,0)
RORRP026 ;;10176668
"RTN","RORNTEG",94,0)
RORRP027 ;;6589308
"RTN","RORNTEG",95,0)
RORRP029 ;;1527601
"RTN","RORNTEG",96,0)
RORRP030 ;;1101835
"RTN","RORNTEG",97,0)
RORRP031 ;;4897990
"RTN","RORNTEG",98,0)
RORRP032 ;;5035421
"RTN","RORNTEG",99,0)
RORRP033 ;;2395118
"RTN","RORNTEG",100,0)
RORRP034 ;;3041648
"RTN","RORNTEG",101,0)
RORRP035 ;;1597804
"RTN","RORNTEG",102,0)
RORRP036 ;;1773818
"RTN","RORNTEG",103,0)
RORRP037 ;;2638742
"RTN","RORNTEG",104,0)
RORRP038 ;;4339809
"RTN","RORNTEG",105,0)
RORRP040 ;;4049054
"RTN","RORNTEG",106,0)
RORRP041 ;;2687037
"RTN","RORNTEG",107,0)
RORRP042 ;;2333070
"RTN","RORNTEG",108,0)
RORSET01 ;;4563146
"RTN","RORNTEG",109,0)
RORSETU1 ;;2833894
"RTN","RORNTEG",110,0)
RORSETU2 ;;2447593
"RTN","RORNTEG",111,0)
RORTMP ;;679112
"RTN","RORNTEG",112,0)
RORTSK ;;3964693
"RTN","RORNTEG",113,0)
RORTSK01 ;;7070947
"RTN","RORNTEG",114,0)
RORTSK02 ;;4523778
"RTN","RORNTEG",115,0)
RORTSK03 ;;2058050
"RTN","RORNTEG",116,0)
RORTSK10 ;;5894436
"RTN","RORNTEG",117,0)
RORTSK11 ;;3325690
"RTN","RORNTEG",118,0)
RORTSK12 ;;2274583
"RTN","RORNTEG",119,0)
RORTSK13 ;;5581664
"RTN","RORNTEG",120,0)
RORTSK14 ;;2157270
"RTN","RORNTEG",121,0)
RORTXT ;;141117
"RTN","RORNTEG",122,0)
RORUPD ;;3118364
"RTN","RORNTEG",123,0)
RORUPD01 ;;7989261
"RTN","RORNTEG",124,0)
RORUPD04 ;;5421758
"RTN","RORNTEG",125,0)
RORUPD05 ;;7081088
"RTN","RORNTEG",126,0)
RORUPD06 ;;3084967
"RTN","RORNTEG",127,0)
RORUPD07 ;;2356625
"RTN","RORNTEG",128,0)
RORUPD08 ;;4579765
"RTN","RORNTEG",129,0)
RORUPD09 ;;2869944
"RTN","RORNTEG",130,0)
RORUPD50 ;;3764045
"RTN","RORNTEG",131,0)
RORUPD51 ;;8479867
"RTN","RORNTEG",132,0)
RORUPD52 ;;2557167
"RTN","RORNTEG",133,0)
RORUPD62 ;;1941130
"RTN","RORNTEG",134,0)
RORUPDUT ;;7113425
"RTN","RORNTEG",135,0)
RORUPEX ;;3382608
"RTN","RORNTEG",136,0)
RORUPP01 ;;3620688
"RTN","RORNTEG",137,0)
RORUPP02 ;;3149282
"RTN","RORNTEG",138,0)
RORUPR ;;5364149
"RTN","RORNTEG",139,0)
RORUPR1 ;;10955587
"RTN","RORNTEG",140,0)
RORUTL01 ;;4692322
"RTN","RORNTEG",141,0)
RORUTL02 ;;5296575
"RTN","RORNTEG",142,0)
RORUTL03 ;;8066801
"RTN","RORNTEG",143,0)
RORUTL04 ;;2076790
"RTN","RORNTEG",144,0)
RORUTL05 ;;7047621
"RTN","RORNTEG",145,0)
RORUTL06 ;;10075666
"RTN","RORNTEG",146,0)
RORUTL07 ;;2099977
"RTN","RORNTEG",147,0)
RORUTL08 ;;3164502
"RTN","RORNTEG",148,0)
RORUTL09 ;;1836557
"RTN","RORNTEG",149,0)
RORUTL10 ;;5740794
"RTN","RORNTEG",150,0)
RORUTL11 ;;942933
"RTN","RORNTEG",151,0)
RORUTL14 ;;1375993
"RTN","RORNTEG",152,0)
RORUTL15 ;;6511088
"RTN","RORNTEG",153,0)
RORUTL16 ;;2364514
"RTN","RORNTEG",154,0)
RORUTL17 ;;6994520
"RTN","RORNTEG",155,0)
RORUTL18 ;;3250231
"RTN","RORNTEG",156,0)
RORUTL19 ;;1203624
"RTN","RORNTEG",157,0)
RORVM001 ;;609363
"RTN","RORNTEG",158,0)
RORX000 ;;2233772
"RTN","RORNTEG",159,0)
RORX001 ;;5778832
"RTN","RORNTEG",160,0)
RORX002 ;;3917612
"RTN","RORNTEG",161,0)
RORX003 ;;5545892
"RTN","RORNTEG",162,0)
RORX003A ;;7545014
"RTN","RORNTEG",163,0)
RORX004 ;;3369267
"RTN","RORNTEG",164,0)
RORX005 ;;1558283
"RTN","RORNTEG",165,0)
RORX005A ;;5728919
"RTN","RORNTEG",166,0)
RORX005B ;;2068516
"RTN","RORNTEG",167,0)
RORX005C ;;6689502
"RTN","RORNTEG0")
0^84^B4347507
"RTN","RORNTEG0",1,0)
RORNTEG0 ;ISC/XTSUMBLD KERNEL - Package checksum checker ;3060126.152942
"RTN","RORNTEG0",2,0)
 ;;0.0;
"RTN","RORNTEG0",3,0)
 ;;7.3;3060126.152942
"RTN","RORNTEG0",4,0)
 S XT4="I 1",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","RORNTEG0",5,0)
CONT F XT1=1:1 S XT2=$T(ROU+XT1) Q:XT2=""  S X=$P(XT2," ",1),XT3=$P(XT2,";",3) X XT4 I $T W !,X X ^%ZOSF("TEST") S:'$T XT3=0 X:XT3 ^%ZOSF("RSUM") W ?10,$S('XT3:"Routine not in UCI",XT3'=Y:"Calculated "_$C(7)_Y_", off by "_(Y-XT3),1:"ok")
"RTN","RORNTEG0",6,0)
 ;
"RTN","RORNTEG0",7,0)
 K %1,%2,%3,X,Y,XT1,XT2,XT3,XT4 Q
"RTN","RORNTEG0",8,0)
ONE S XT4="I $D(^UTILITY($J,X))",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","RORNTEG0",9,0)
 W !,"Check a subset of routines:" K ^UTILITY($J) X ^%ZOSF("RSEL")
"RTN","RORNTEG0",10,0)
 W ! G CONT
"RTN","RORNTEG0",11,0)
ROU ;;
"RTN","RORNTEG0",12,0)
RORX006 ;;1957749
"RTN","RORNTEG0",13,0)
RORX006A ;;4045076
"RTN","RORNTEG0",14,0)
RORX006C ;;4479620
"RTN","RORNTEG0",15,0)
RORX007 ;;6378955
"RTN","RORNTEG0",16,0)
RORX007A ;;2467042
"RTN","RORNTEG0",17,0)
RORX008 ;;2076427
"RTN","RORNTEG0",18,0)
RORX008A ;;7092822
"RTN","RORNTEG0",19,0)
RORX009 ;;3203627
"RTN","RORNTEG0",20,0)
RORX009A ;;10011538
"RTN","RORNTEG0",21,0)
RORX009C ;;9417785
"RTN","RORNTEG0",22,0)
RORX010 ;;6851839
"RTN","RORNTEG0",23,0)
RORX011 ;;7772559
"RTN","RORNTEG0",24,0)
RORX012 ;;3000028
"RTN","RORNTEG0",25,0)
RORX012A ;;10697075
"RTN","RORNTEG0",26,0)
RORX013 ;;1600392
"RTN","RORNTEG0",27,0)
RORX013A ;;6836799
"RTN","RORNTEG0",28,0)
RORX013C ;;3235328
"RTN","RORNTEG0",29,0)
RORX014 ;;2137320
"RTN","RORNTEG0",30,0)
RORX014A ;;6097645
"RTN","RORNTEG0",31,0)
RORX015 ;;1566763
"RTN","RORNTEG0",32,0)
RORX015A ;;3958983
"RTN","RORNTEG0",33,0)
RORX015C ;;3279733
"RTN","RORNTEG0",34,0)
RORX016 ;;1551044
"RTN","RORNTEG0",35,0)
RORX016A ;;2574228
"RTN","RORNTEG0",36,0)
RORX016B ;;2976507
"RTN","RORNTEG0",37,0)
RORX016C ;;4657732
"RTN","RORNTEG0",38,0)
RORXU001 ;;2567828
"RTN","RORNTEG0",39,0)
RORXU002 ;;7493232
"RTN","RORNTEG0",40,0)
RORXU003 ;;5759589
"RTN","RORNTEG0",41,0)
RORXU004 ;;405249
"RTN","RORNTEG0",42,0)
RORXU005 ;;3020773
"RTN","RORNTEG0",43,0)
RORXU006 ;;6157436
"RTN","RORNTEG0",44,0)
RORXU007 ;;6706394
"RTN","RORP000")
0^85^B65292418
"RTN","RORP000",1,0)
RORP000 ;HCIOFO/SG - CCR V1.5 INSTALLATION ROUTINE ; 1/23/06 9:26am
"RTN","RORP000",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORP000",3,0)
 ;
"RTN","RORP000",4,0)
 ;***** ENVIRONMENT CHECK
"RTN","RORP000",5,0)
 N RC,RORMSG,TMP,VERSION
"RTN","RORP000",6,0)
 ;---
"RTN","RORP000",7,0)
 S TMP=$G(^XMB("NETNAME"))
"RTN","RORP000",8,0)
 I TMP="DEV.DEV.FO-HINES.MED.VA.GOV"  D  Q:$G(XPDABORT)
"RTN","RORP000",9,0)
 . F TMP=798,798.1,799.31,799.4  S:$$PRD^RORKIDS(TMP)<1.5 XPDABORT=2
"RTN","RORP000",10,0)
 . Q:'$G(XPDABORT)
"RTN","RORP000",11,0)
 . W !!,"This build cannot be installed into the Hines development",!
"RTN","RORP000",12,0)
 . W "acccount until the package revision data of the files 798,",!
"RTN","RORP000",13,0)
 . W "798.1, 799.31, and 799.4 is reset to '1.5^ROR 1.5'!",!
"RTN","RORP000",14,0)
 ;
"RTN","RORP000",15,0)
 ;--- Check the installed  version of the package
"RTN","RORP000",16,0)
 S VERSION=$$VERSION^XPDUTL("CLINICAL CASE REGISTRIES")
"RTN","RORP000",17,0)
 I VERSION>1.5  D  Q
"RTN","RORP000",18,0)
 . W !!,"A newer version of the CCR package is already",!
"RTN","RORP000",19,0)
 . W "installed in this account: CCR v"_VERSION_"!",!
"RTN","RORP000",20,0)
 . S XPDABORT=1
"RTN","RORP000",21,0)
 ;
"RTN","RORP000",22,0)
 ;--- Check the User ID
"RTN","RORP000",23,0)
 I $G(DUZ)'>0  D  S XPDABORT=2  Q
"RTN","RORP000",24,0)
 . W !!,"The DUZ variable must be defined!",!
"RTN","RORP000",25,0)
 ;
"RTN","RORP000",26,0)
 ;--- Check the required security key
"RTN","RORP000",27,0)
 S TMP=$$LKUP^XPDKEY("ROR VA IRM")
"RTN","RORP000",28,0)
 I TMP>0,'$D(^XUSEC("ROR VA IRM",DUZ))  D  S XPDABORT=2  Q
"RTN","RORP000",29,0)
 . W !!,"You must have the ROR VA IRM security key!",!
"RTN","RORP000",30,0)
 ;
"RTN","RORP000",31,0)
 ;--- Check if all required patches are installed
"RTN","RORP000",32,0)
 S RC=0
"RTN","RORP000",33,0)
 F TMP="LA*5.2*64","LA*5.2*70"  S RC=$$PATCH^XPDUTL(TMP)  Q:RC
"RTN","RORP000",34,0)
 I 'RC  D  S XPDABORT=2  Q
"RTN","RORP000",35,0)
 . W !!,"Patch LA*5.2*64 or LA*5.2*70 must be installed before",!
"RTN","RORP000",36,0)
 . W "installation of this build!",!
"RTN","RORP000",37,0)
 ;---
"RTN","RORP000",38,0)
 I +VERSION=1,'$$PATCH^XPDUTL("ROR*1.0*8")  D  S XPDABORT=2  Q
"RTN","RORP000",39,0)
 . W !!,"Patch ROR*1.0*8 must be installed before installation",!
"RTN","RORP000",40,0)
 . W "of this build!",!
"RTN","RORP000",41,0)
 ;
"RTN","RORP000",42,0)
 ;=== Installation section
"RTN","RORP000",43,0)
 Q:'$G(XPDENV)
"RTN","RORP000",44,0)
 ;--- Check the nightly task option
"RTN","RORP000",45,0)
 S RC=$$CHKOPT("ROR TASK")
"RTN","RORP000",46,0)
 I RC>0  D  Q:$G(XPDABORT)
"RTN","RORP000",47,0)
 . ;--- Abort the installation if the task is running
"RTN","RORP000",48,0)
 . I RC=3  S XPDABORT=2  Q
"RTN","RORP000",49,0)
 . ;--- Unschedule the option
"RTN","RORP000",50,0)
 . D RESCH^XUTMOPT("ROR TASK","@")
"RTN","RORP000",51,0)
 ;--- Cancel the routine deletion if they are not there anyway
"RTN","RORP000",52,0)
 D:+VERSION'=1 RTNUP
"RTN","RORP000",53,0)
 ;--- Idle the event protocols
"RTN","RORP000",54,0)
 K ^ROR(798.1,"AEP")
"RTN","RORP000",55,0)
 Q
"RTN","RORP000",56,0)
 ;
"RTN","RORP000",57,0)
 ;***** CHECKS THE OPTION STATUS AMD DISPLAYS ERRORS/WARNINGS
"RTN","RORP000",58,0)
 ;
"RTN","RORP000",59,0)
 ; OPTION        Option name
"RTN","RORP000",60,0)
 ;
"RTN","RORP000",61,0)
 ; Return Values:
"RTN","RORP000",62,0)
 ;        0  Option does not exist
"RTN","RORP000",63,0)
 ;        1  Option exists
"RTN","RORP000",64,0)
 ;        3  Option is running
"RTN","RORP000",65,0)
 ;
"RTN","RORP000",66,0)
CHKOPT(OPTION) ;
"RTN","RORP000",67,0)
 N RC,RORBUF,RORI,ZTSK
"RTN","RORP000",68,0)
 ;--- No problem if the option does not exist yet
"RTN","RORP000",69,0)
 Q:$$LKOPT^XPDMENU(OPTION)'>0 0
"RTN","RORP000",70,0)
 ;--- Check status of the option
"RTN","RORP000",71,0)
 S RC=1
"RTN","RORP000",72,0)
 D OPTSTAT^XUTMOPT(OPTION,.RORBUF)
"RTN","RORP000",73,0)
 F RORI=1:1:$G(RORBUF)  D  I $G(ZTSK(1))=2  S RC=3  Q
"RTN","RORP000",74,0)
 . K ZTSK  S ZTSK=$P(RORBUF(RORI),"^")
"RTN","RORP000",75,0)
 . D:ZTSK STAT^%ZTLOAD
"RTN","RORP000",76,0)
 ;--- Display the error
"RTN","RORP000",77,0)
 I RC=3  D  Q RC
"RTN","RORP000",78,0)
 . W !,"This build cannot be installed while the CCR nightly task"
"RTN","RORP000",79,0)
 . W !,"(the Registry Update & Data Extraction [ROR TASK] option)"
"RTN","RORP000",80,0)
 . W !,"is running!"
"RTN","RORP000",81,0)
 . W !,"Please either wait until the task finishes and start the"
"RTN","RORP000",82,0)
 . W !,"installation again, or schedule the patch installation"
"RTN","RORP000",83,0)
 . W !,"to run before the time when nightly task starts.",!
"RTN","RORP000",84,0)
 ;--- Remind the IRM to reschedule the option
"RTN","RORP000",85,0)
 W !,"Please do not forget to reschedule the Registry Update & Data"
"RTN","RORP000",86,0)
 W !,"Extraction [ROR TASK] option after you make sure that the new"
"RTN","RORP000",87,0)
 W !,"verison of the CCR package is installed successfully.",!
"RTN","RORP000",88,0)
 ;---
"RTN","RORP000",89,0)
 Q RC
"RTN","RORP000",90,0)
 ;
"RTN","RORP000",91,0)
 ;***** ERROR PROCESSING
"RTN","RORP000",92,0)
ERROR ;
"RTN","RORP000",93,0)
 N TMP  S XPDABORT=1
"RTN","RORP000",94,0)
 I $D(ZTQUEUED)  D  D ALERT^RORKIDS(DUZ,-43,REGNAME,,TMP)
"RTN","RORP000",95,0)
 . S TMP=+$G(RORPARM("KIDS"))
"RTN","RORP000",96,0)
 . S TMP=$S(TMP=1:"pre-",TMP=2:"post-",1:"")_"install"
"RTN","RORP000",97,0)
 D DSPSTK^RORERR(),ABTMSG^RORKIDS()
"RTN","RORP000",98,0)
 Q
"RTN","RORP000",99,0)
 ;
"RTN","RORP000",100,0)
 ;***** NAME OF THE ICR (IT IS RENAMED IN VERSION 1.5)
"RTN","RORP000",101,0)
ICRNAME() ;
"RTN","RORP000",102,0)
 N NEWNAME,REGIEN,RORMSG
"RTN","RORP000",103,0)
 S NEWNAME="VA HIV"
"RTN","RORP000",104,0)
 Q:'$$VFILE^DILFD(798.1) NEWNAME
"RTN","RORP000",105,0)
 S REGIEN=$$FIND1^DIC(798.1,,"Q",NEWNAME,"B",,"RORMSG")
"RTN","RORP000",106,0)
 Q $S(REGIEN>0:NEWNAME,1:"VA ICR")
"RTN","RORP000",107,0)
 ;
"RTN","RORP000",108,0)
 ;***** INITIALIZES INSTALLATION-WIDE VARIABLES
"RTN","RORP000",109,0)
 ;
"RTN","RORP000",110,0)
 ; Return values:
"RTN","RORP000",111,0)
 ;       <0  Error code
"RTN","RORP000",112,0)
 ;        0  Ok
"RTN","RORP000",113,0)
 ;
"RTN","RORP000",114,0)
INITVARS() ;
"RTN","RORP000",115,0)
 N REGNAME
"RTN","RORP000",116,0)
 I '$$VFILE^DILFD(798.1)  D  Q 0
"RTN","RORP000",117,0)
 . S (RORHEPC,RORICR)=""
"RTN","RORP000",118,0)
 ;--- Get the HepC registry IEN
"RTN","RORP000",119,0)
 S REGNAME="VA HEPC"
"RTN","RORP000",120,0)
 S RORHEPC=$$REGIEN^RORUTL02(REGNAME)  Q:RORHEPC<0 RORHEPC
"RTN","RORP000",121,0)
 S $P(RORHEPC,U,2)=REGNAME
"RTN","RORP000",122,0)
 ;--- Get the ICR (HIV) registry IEN
"RTN","RORP000",123,0)
 S REGNAME=$$ICRNAME
"RTN","RORP000",124,0)
 S RORICR=$$REGIEN^RORUTL02(REGNAME)   Q:RORICR<0 RORICR
"RTN","RORP000",125,0)
 S $P(RORICR,U,2)=REGNAME
"RTN","RORP000",126,0)
 ;--- Success
"RTN","RORP000",127,0)
 Q 0
"RTN","RORP000",128,0)
 ;
"RTN","RORP000",129,0)
 ;***** POST-INSTALL ENTRY POINT
"RTN","RORP000",130,0)
POS ;
"RTN","RORP000",131,0)
 N RORERROR      ; Error processing data
"RTN","RORP000",132,0)
 N RORHEPC       ; HepC IEN and Name
"RTN","RORP000",133,0)
 N RORICR        ; ICR (HIV) IEN and Name
"RTN","RORP000",134,0)
 N RORLOG        ; Log subsystem constants & variables
"RTN","RORP000",135,0)
 N RORPARM       ; Application parameters
"RTN","RORP000",136,0)
 N RORPRD        ; Package Revision Data
"RTN","RORP000",137,0)
 ;
"RTN","RORP000",138,0)
 N DA,DIK,RC,TMP
"RTN","RORP000",139,0)
 S RORPARM("DEVELOPER")=1   ; Enable modifications
"RTN","RORP000",140,0)
 S RORPARM("ERR")=1         ; Enable error processing
"RTN","RORP000",141,0)
 S RORPARM("KIDS")=2        ; Post-install indicator
"RTN","RORP000",142,0)
 S RORPARM("LOG")=1         ; Enable log recording
"RTN","RORP000",143,0)
 ;
"RTN","RORP000",144,0)
 ;--- Package Revision Data
"RTN","RORP000",145,0)
 S RORPRD="1.5^ROR 1.5"
"RTN","RORP000",146,0)
 ;
"RTN","RORP000",147,0)
 ;--- Re-enable the event protocols (idled by the environment check)
"RTN","RORP000",148,0)
 K DIK  S DIK="^ROR(798.1,",DIK(1)="25^AEP"
"RTN","RORP000",149,0)
 D ENALL^DIK
"RTN","RORP000",150,0)
 ;
"RTN","RORP000",151,0)
 ;--- Open a new log
"RTN","RORP000",152,0)
 K TMP  S (TMP("VA HEPC"),TMP($$ICRNAME))=""
"RTN","RORP000",153,0)
 S TMP=$$OPEN^RORLOG(.TMP,0,XPDNM_" POST-INSTALL STARTED")
"RTN","RORP000",154,0)
 K TMP
"RTN","RORP000",155,0)
 ;
"RTN","RORP000",156,0)
 ;--- Initialize installation-wide variables
"RTN","RORP000",157,0)
 S RC=$$INITVARS()  G:RC<0 ERROR
"RTN","RORP000",158,0)
 ;
"RTN","RORP000",159,0)
 ;--- Rename the security keys
"RTN","RORP000",160,0)
 G:$$CP^RORKIDS("POS05","$$KEYS^RORP000B")<0 ERROR
"RTN","RORP000",161,0)
 ;
"RTN","RORP000",162,0)
 ;--- Restore the CDC definition
"RTN","RORP000",163,0)
 G:$$CP^RORKIDS("POS10","$$CDCDEF^RORP000B")<0 ERROR
"RTN","RORP000",164,0)
 ;
"RTN","RORP000",165,0)
 ;--- ROR REGISTRY PARAMETERS file (#798.1) conversion
"RTN","RORP000",166,0)
 G:$$CP^RORKIDS("POS15","$$CNV7981^RORP000B")<0 ERROR
"RTN","RORP000",167,0)
 ;
"RTN","RORP000",168,0)
 ;--- ROR LOCAL REGISTRY file (#798) conversion
"RTN","RORP000",169,0)
 G:$$CP^RORKIDS("POS20","$$CNV798^RORP000B")<0 ERROR
"RTN","RORP000",170,0)
 ;
"RTN","RORP000",171,0)
 ;--- ROR HIV RECORD file (#799.4) conversion
"RTN","RORP000",172,0)
 G:$$CP^RORKIDS("POS25","$$CNV7994^RORP000B")<0 ERROR
"RTN","RORP000",173,0)
 ;
"RTN","RORP000",174,0)
 ;--- ROR LIST ITEM file (#799.1) conversion
"RTN","RORP000",175,0)
 G:$$CP^RORKIDS("POS30","$$CNV7991^RORP000B")<0 ERROR
"RTN","RORP000",176,0)
 ;
"RTN","RORP000",177,0)
 ;--- ROR GENERIC DRUG file (#799.51)
"RTN","RORP000",178,0)
 G:$$CP^RORKIDS("POS32","$$RS79951^RORPUT02")<0 ERROR
"RTN","RORP000",179,0)
 ;
"RTN","RORP000",180,0)
 ;--- Restore predefined report templates
"RTN","RORP000",181,0)
 G:$$CP^RORKIDS("POS35","$$RSPRT^RORPUT02")<0 ERROR
"RTN","RORP000",182,0)
 ;
"RTN","RORP000",183,0)
 ;--- ROR XML ITEM file (#799.31)
"RTN","RORP000",184,0)
 D PRD^RORKIDS(799.31,RORPRD)
"RTN","RORP000",185,0)
 ;
"RTN","RORP000",186,0)
 ;--- Re-enable GUI access to the CCR v1.5
"RTN","RORP000",187,0)
 D:'$$OPTDE^XPDUTL("ROR GUI",1)
"RTN","RORP000",188,0)
 . N INFO
"RTN","RORP000",189,0)
 . S TMP="Post-install was not able to re-enable the ROR GUI option!"
"RTN","RORP000",190,0)
 . S INFO(1)="Please remove the 'Out of Order' message manually using"
"RTN","RORP000",191,0)
 . S INFO(2)="the Restrict Availability of Options [XQRESTRICT]"
"RTN","RORP000",192,0)
 . S INFO(3)="option of the Menu Management [XUMAINT] menu."
"RTN","RORP000",193,0)
 . D BMES^RORKIDS(TMP,.INFO)
"RTN","RORP000",194,0)
 ;
"RTN","RORP000",195,0)
 ;--- Close the log
"RTN","RORP000",196,0)
 D CLOSE^RORLOG(XPDNM_" POST-INSTALL COMPLETED")
"RTN","RORP000",197,0)
 Q
"RTN","RORP000",198,0)
 ;
"RTN","RORP000",199,0)
 ;***** PRE-INSTALL ENTRY POINT
"RTN","RORP000",200,0)
PRE ;
"RTN","RORP000",201,0)
 N RORERROR      ; Error processing data
"RTN","RORP000",202,0)
 N RORHEPC       ; HepC IEN and Name
"RTN","RORP000",203,0)
 N RORICR        ; ICR (HIV) IEN and Name
"RTN","RORP000",204,0)
 N RORLOG        ; Log subsystem constants & variables
"RTN","RORP000",205,0)
 N RORPARM       ; Application parameters
"RTN","RORP000",206,0)
 N RORPRD        ; Package Revision Data
"RTN","RORP000",207,0)
 ;
"RTN","RORP000",208,0)
 N RC,REGNAME,RORPRD,TMP
"RTN","RORP000",209,0)
 S RORPARM("DEVELOPER")=1   ; Enable modifications
"RTN","RORP000",210,0)
 S RORPARM("ERR")=1         ; Enable error processing
"RTN","RORP000",211,0)
 S RORPARM("KIDS")=1        ; Pre-install indicator
"RTN","RORP000",212,0)
 ;
"RTN","RORP000",213,0)
 ;--- Package Revision Data
"RTN","RORP000",214,0)
 S RORPRD="1.4^ROR 1.5 PRE-INSTALL"
"RTN","RORP000",215,0)
 ;
"RTN","RORP000",216,0)
 ;--- Disable GUI access to the package
"RTN","RORP000",217,0)
 S TMP="CCR package is being upgraded. Please try later."
"RTN","RORP000",218,0)
 D OUT^XPDMENU("ROR GUI",TMP)
"RTN","RORP000",219,0)
 S TMP="Please use new CCR GUI to access HepC registry."
"RTN","RORP000",220,0)
 D OUT^XPDMENU("ROR GUI MENU",TMP)
"RTN","RORP000",221,0)
 ;
"RTN","RORP000",222,0)
 ;--- Open a new log if the ROR LOG file exists
"RTN","RORP000",223,0)
 D:$$VFILE^DILFD(798.7)
"RTN","RORP000",224,0)
 . S RORPARM("LOG")=1
"RTN","RORP000",225,0)
 . K TMP  S (TMP("VA HEPC"),TMP($$ICRNAME))=""
"RTN","RORP000",226,0)
 . S TMP=$$OPEN^RORLOG(.TMP,0,XPDNM_" PRE-INSTALL STARTED")
"RTN","RORP000",227,0)
 . K TMP
"RTN","RORP000",228,0)
 ;
"RTN","RORP000",229,0)
 ;--- Initialize installation-wide variables
"RTN","RORP000",230,0)
 S RC=$$INITVARS()  G:RC<0 ERROR
"RTN","RORP000",231,0)
 ;
"RTN","RORP000",232,0)
 ;--- Delete old data, parameters, etc.
"RTN","RORP000",233,0)
 G:$$CP^RORKIDS("PRE05","$$CLEAR^RORP000A")<0 ERROR
"RTN","RORP000",234,0)
 ;
"RTN","RORP000",235,0)
 ;--- Prepare the existing version for the upgrade
"RTN","RORP000",236,0)
 G:$$CP^RORKIDS("PRE10","$$CONVERT^RORP000A")<0 ERROR
"RTN","RORP000",237,0)
 ;
"RTN","RORP000",238,0)
 ;--- Rename the ICR-related configuration records
"RTN","RORP000",239,0)
 G:$$CP^RORKIDS("PRE15","$$RENAME^RORP000A")<0 ERROR
"RTN","RORP000",240,0)
 ;
"RTN","RORP000",241,0)
 ;--- Close the log
"RTN","RORP000",242,0)
 D CLOSE^RORLOG(XPDNM_" PRE-INSTALL COMPLETED")
"RTN","RORP000",243,0)
 Q
"RTN","RORP000",244,0)
 ;
"RTN","RORP000",245,0)
 ;***** PRE-TRANSPORTATION ENTRY POINT
"RTN","RORP000",246,0)
PTR ;
"RTN","RORP000",247,0)
 N RORBUF,TMP
"RTN","RORP000",248,0)
 ;--- Copy the CDC definition to the transport global
"RTN","RORP000",249,0)
 D GETPARM^RORRP038(.RORBUF,"ICRCDCDEF","PKG")
"RTN","RORP000",250,0)
 K RORBUF(0)  M @XPDGREF@("RORCDCDEF")=RORBUF
"RTN","RORP000",251,0)
 ;--- Load the records of the ROR LIST ITEM file
"RTN","RORP000",252,0)
 D LD7991^RORPUT02()
"RTN","RORP000",253,0)
 ;--- Load the records of the ROR GENERIG DRUG file
"RTN","RORP000",254,0)
 D LD79951^RORPUT02()
"RTN","RORP000",255,0)
 ;--- Load predefined report templates
"RTN","RORP000",256,0)
 D LDPRT^RORPUT02()
"RTN","RORP000",257,0)
 Q
"RTN","RORP000",258,0)
 ;
"RTN","RORP000",259,0)
 ;***** CANCELS DELETION OF THE ROUTINES
"RTN","RORP000",260,0)
RTNUP ;
"RTN","RORP000",261,0)
 ;;RORACK,   RORACK01, RORERR10, RORERR11, RORERR12, RORHL21
"RTN","RORP000",262,0)
 ;;RORICR01, RORICR02, RORICR03, RORICREX, RORICRUT, RORP008
"RTN","RORP000",263,0)
 ;;RORRP1,   RORRP10,  RORRP2,   RORRP3,   RORRP4,   RORRP5
"RTN","RORP000",264,0)
 ;;RORRP6,   RORRP7,   RORRP8,   RORRP10,  RORX005U
"RTN","RORP000",265,0)
 ;
"RTN","RORP000",266,0)
 N BUF,I,J,NAME,TMP
"RTN","RORP000",267,0)
 F I=1:1  S BUF=$P($T(RTNUP+I),";;",2)  Q:BUF=""  D
"RTN","RORP000",268,0)
 . F J=1:1  S NAME=$$TRIM^XLFSTR($P(BUF,",",J))  Q:NAME=""  D
"RTN","RORP000",269,0)
 . . S TMP=$$RTNUP^XPDUTL(NAME,2)
"RTN","RORP000",270,0)
 Q
"RTN","RORP000A")
0^18^B50265344
"RTN","RORP000A",1,0)
RORP000A ;HCIOFO/SG - CCR V1.5 PRE-INSTALL CODE ; 1/23/06 10:15am
"RTN","RORP000A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORP000A",3,0)
 ;
"RTN","RORP000A",4,0)
 Q
"RTN","RORP000A",5,0)
 ;
"RTN","RORP000A",6,0)
 ;***** DELETES OLD DATA, PARAMETERS, ETC.
"RTN","RORP000A",7,0)
 ;
"RTN","RORP000A",8,0)
 ; Return values:
"RTN","RORP000A",9,0)
 ;       <0  Error code
"RTN","RORP000A",10,0)
 ;        0  Ok
"RTN","RORP000A",11,0)
 ;
"RTN","RORP000A",12,0)
CLEAR() ;
"RTN","RORP000A",13,0)
 N ENTITY,ENTLST,IEN,NODE,PARAM,PSIGNAME,PSIGVAL,RC,RORMSG,TMP,X
"RTN","RORP000A",14,0)
 S RC=0
"RTN","RORP000A",15,0)
 ;
"RTN","RORP000A",16,0)
 ;--- The ROR REGISTRY PARAMETERS file (#798.1)
"RTN","RORP000A",17,0)
 I $$VFILE^DILFD(798.1)  D  Q:RC<0 RC
"RTN","RORP000A",18,0)
 . D BMES^RORKIDS("Removing old selection rule references...")
"RTN","RORP000A",19,0)
 . S NODE=$$ROOT^DILFD(798.1,,1),IEN=0
"RTN","RORP000A",20,0)
 . F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORP000A",21,0)
 . . S TMP=$P($G(@NODE@(IEN,0)),U)
"RTN","RORP000A",22,0)
 . . S:$E(TMP,1,2)="VA" RC=$$CLEAR^RORUTL05(798.13,","_IEN_",")
"RTN","RORP000A",23,0)
 . D:RC'<0 MES^RORKIDS("The references have been removed.")
"RTN","RORP000A",24,0)
 ;
"RTN","RORP000A",25,0)
 ;--- The ROR TASK file (#798.8)
"RTN","RORP000A",26,0)
 I $$VFILE^DILFD(798.8)  D  Q:RC<0 RC
"RTN","RORP000A",27,0)
 . D BMES^RORKIDS("Clearing the ROR TASK file...")
"RTN","RORP000A",28,0)
 . S RC=$$CLEAR^RORUTL05(798.8)  Q:RC<0
"RTN","RORP000A",29,0)
 . D MES^RORKIDS("The file has been cleared.")
"RTN","RORP000A",30,0)
 ;
"RTN","RORP000A",31,0)
 ;--- The ROR REPORT PARAMETERS file (#799.34)
"RTN","RORP000A",32,0)
 I $$VFILE^DILFD(799.34)  D  Q:RC<0 RC
"RTN","RORP000A",33,0)
 . D BMES^RORKIDS("Clearing the ROR REPORT PARAMETERS file...")
"RTN","RORP000A",34,0)
 . S RC=$$CLEAR^RORUTL05(799.34)  Q:RC<0
"RTN","RORP000A",35,0)
 . D MES^RORKIDS("The file has been cleared.")
"RTN","RORP000A",36,0)
 ;
"RTN","RORP000A",37,0)
 ;--- The ROR LAB SEARCH file (#798.9)
"RTN","RORP000A",38,0)
 I $$VFILE^DILFD(798.9)  D  Q:RC<0 RC
"RTN","RORP000A",39,0)
 . D BMES^RORKIDS("Clearing the ROR LAB SEARCH file...")
"RTN","RORP000A",40,0)
 . S RC=$$CLEAR^RORUTL05(798.9)  Q:RC<0
"RTN","RORP000A",41,0)
 . D MES^RORKIDS("The file has been cleared.")
"RTN","RORP000A",42,0)
 ;
"RTN","RORP000A",43,0)
 ;--- Delete old GUI parameters during the first installation
"RTN","RORP000A",44,0)
 S PSIGNAME="ROR 1.5 INSTALL"
"RTN","RORP000A",45,0)
 S PSIGVAL="PARAMETERS CLEARED"
"RTN","RORP000A",46,0)
 S X="CLEARQ^RORP000A",@^%ZOSF("TRAP"),$ETRAP=""
"RTN","RORP000A",47,0)
 D GETPARM^RORRP038(.TMP,PSIGNAME,"PKG")
"RTN","RORP000A",48,0)
 I $G(TMP(1))'=PSIGVAL  D  Q:RC<0 RC
"RTN","RORP000A",49,0)
 . D BMES^RORKIDS("Deleting old GUI parameters...")
"RTN","RORP000A",50,0)
 . F PARAM="ROR VA HEPC GUI SETTINGS","ROR GUI PARAMETER"  D
"RTN","RORP000A",51,0)
 . . K ENTLST
"RTN","RORP000A",52,0)
 . . D ENVAL^XPAR(.ENTLST,PARAM)
"RTN","RORP000A",53,0)
 . . S ENTITY=""
"RTN","RORP000A",54,0)
 . . F  S ENTITY=$O(ENTLST(ENTITY))  Q:ENTITY=""  D
"RTN","RORP000A",55,0)
 . . . D NDEL^XPAR(ENTITY,PARAM)
"RTN","RORP000A",56,0)
 . D MES^RORKIDS("The parameters have been deleted.")
"RTN","RORP000A",57,0)
 . D SETPARM^RORRP038(.RES,PSIGNAME,"PKG",PSIGVAL)
"RTN","RORP000A",58,0)
CLEARQ ;---
"RTN","RORP000A",59,0)
 Q 0
"RTN","RORP000A",60,0)
 ;
"RTN","RORP000A",61,0)
 ;***** CONVERT THE FILES BEFORE THE UPGRADE
"RTN","RORP000A",62,0)
 ;
"RTN","RORP000A",63,0)
 ; Return values:
"RTN","RORP000A",64,0)
 ;       <0  Error code
"RTN","RORP000A",65,0)
 ;        0  Ok
"RTN","RORP000A",66,0)
 ;
"RTN","RORP000A",67,0)
CONVERT() ;
"RTN","RORP000A",68,0)
 N RC  S RC=0
"RTN","RORP000A",69,0)
 ;
"RTN","RORP000A",70,0)
 ;=== The ROR REGISTRY PARAMETERS file (#798.1)
"RTN","RORP000A",71,0)
 I $$VFILE^DILFD(798.1),$$PRD^RORKIDS(798.1)<RORPRD  D  Q:RC<0 RC
"RTN","RORP000A",72,0)
 . ;--- Delete HL7 SEGMENT multiple (9) and corresponding data
"RTN","RORP000A",73,0)
 . S RC=$$DELFILE^RORKIDS(798.19,"DS")  Q:RC<0
"RTN","RORP000A",74,0)
 . ;--- Delete USER multiple (16) and corresponding data
"RTN","RORP000A",75,0)
 . S RC=$$DELFILE^RORKIDS(798.116,"DS")  Q:RC<0
"RTN","RORP000A",76,0)
 . ;--- Delete DRUG THERAPY LIST multiple (17) and corresponding data
"RTN","RORP000A",77,0)
 . S RC=$$DELFILE^RORKIDS(798.117,"DS")  Q:RC<0
"RTN","RORP000A",78,0)
 . ;--- Delete the EXTRACTED RESULT multiple (12) and corresponding
"RTN","RORP000A",79,0)
 . ;--- data (the same DD and new data will be restored by KIDS).
"RTN","RORP000A",80,0)
 . S RC=$$DELFILE^RORKIDS(798.112,"DS")  Q:RC<0
"RTN","RORP000A",81,0)
 . ;--- Delete SECURITY KEY multiple (18) and corresponding data
"RTN","RORP000A",82,0)
 . ;--- (the same DD and new data will be restored by KIDS).
"RTN","RORP000A",83,0)
 . S RC=$$DELFILE^RORKIDS(798.118,"DS")  Q:RC<0
"RTN","RORP000A",84,0)
 . ;--- Delete other deprecated fields and corresponding data
"RTN","RORP000A",85,0)
 . D DELFLDS(798.1,"2.1;2.2;2.3;2.4;2.5;15.9;19.2;21.01;21.02;21.03;21.06")
"RTN","RORP000A",86,0)
 . ;--- Delete old cross-references
"RTN","RORP000A",87,0)
 . D DELIX^DDMOD(798.11,.01,1)   ; "B", LOG EVENT
"RTN","RORP000A",88,0)
 . ;--- Update the Package Revision Data
"RTN","RORP000A",89,0)
 . D PRD^RORKIDS(798.1,RORPRD)
"RTN","RORP000A",90,0)
 ;
"RTN","RORP000A",91,0)
 ;=== The ROR LOCAL REGISTRY file (#798)
"RTN","RORP000A",92,0)
 I $$VFILE^DILFD(798),$$PRD^RORKIDS(798)<RORPRD  D  Q:RC<0 RC
"RTN","RORP000A",93,0)
 . ;--- Delete deprecated fields but keep the data until
"RTN","RORP000A",94,0)
 . ;--- the conversion is performed by the post-install
"RTN","RORP000A",95,0)
 . S RC=$$DELFLDS^RORKIDS(798,"2;2.1;2.2;3.2;6;6.1;7;7.1;12")
"RTN","RORP000A",96,0)
 . ;--- Delete old indexes
"RTN","RORP000A",97,0)
 . D DELIXN^DDMOD(798,"ANP","K")
"RTN","RORP000A",98,0)
 . ;--- Update the Package Revision Data
"RTN","RORP000A",99,0)
 . D PRD^RORKIDS(798,RORPRD)
"RTN","RORP000A",100,0)
 ;
"RTN","RORP000A",101,0)
 ;=== The ROR HDT TASK file (#798.5)
"RTN","RORP000A",102,0)
 D:$$VFILE^DILFD(798.5) DELFILE^RORKIDS(798.5,"DT")
"RTN","RORP000A",103,0)
 ;
"RTN","RORP000A",104,0)
 ;=== The ROR LIST ITEM file (#799.1)
"RTN","RORP000A",105,0)
 D:$$VFILE^DILFD(799.1) DELIX^DDMOD(799.1,.01,1,"K")  ; "B" xref
"RTN","RORP000A",106,0)
 ;
"RTN","RORP000A",107,0)
 ;=== The ROR XML ITEM file (#799.31)
"RTN","RORP000A",108,0)
 I $$VFILE^DILFD(799.31),$$PRD^RORKIDS(799.31)<RORPRD  D  Q:RC<0 RC
"RTN","RORP000A",109,0)
 . ;--- Delete old cross-references
"RTN","RORP000A",110,0)
 . D DELIX^DDMOD(799.31,.01,1)  ; "B" xref
"RTN","RORP000A",111,0)
 . ;--- Update the Package Revision Data
"RTN","RORP000A",112,0)
 . D PRD^RORKIDS(799.31,RORPRD)
"RTN","RORP000A",113,0)
 ;
"RTN","RORP000A",114,0)
 ;=== The ROR GENERIC DRUG file (#799.51)
"RTN","RORP000A",115,0)
 D:$$VFILE^DILFD(799.51) DELFILE^RORKIDS(799.51,"D")
"RTN","RORP000A",116,0)
 ;
"RTN","RORP000A",117,0)
 ;=== The ROR HISTORICAL DATA EXTRACTION file (#799.6)
"RTN","RORP000A",118,0)
 D:$$VFILE^DILFD(799.6) DELFLDS^RORKIDS(799.6,".08",1)
"RTN","RORP000A",119,0)
 ;
"RTN","RORP000A",120,0)
 ;=== Success
"RTN","RORP000A",121,0)
 Q 0
"RTN","RORP000A",122,0)
 ;
"RTN","RORP000A",123,0)
 ;***** DELETES FIELDS (DD AND DATA) FROM THE (SUB)FILE
"RTN","RORP000A",124,0)
DELFLDS(FILE,FLDLST) ;
"RTN","RORP000A",125,0)
 N FLD,I,IEN,IENS,ROOT,RORFDA,RORMSG
"RTN","RORP000A",126,0)
 S ROOT=$$ROOT^DILFD(FILE,$G(IENS),1)  Q:ROOT=""
"RTN","RORP000A",127,0)
 ;--- Exclude computed fields
"RTN","RORP000A",128,0)
 F I=1:1  S FLD=$P(FLDLST,";",I)  Q:FLD=""  D
"RTN","RORP000A",129,0)
 . S:$$GET1^DID(FILE,FLD,,"TYPE",,"RORMSG")'="COMPUTED" FLD(FLD)=""
"RTN","RORP000A",130,0)
 ;--- Delete the field data
"RTN","RORP000A",131,0)
 D BMES^RORKIDS("Deleting redundant data from the file #"_FILE_" ...")
"RTN","RORP000A",132,0)
 S IEN=0
"RTN","RORP000A",133,0)
 F  S IEN=$O(@ROOT@(IEN))  Q:IEN'>0  D
"RTN","RORP000A",134,0)
 . S IENS=IEN_",",FLD=0
"RTN","RORP000A",135,0)
 . F  S FLD=$O(FLD(FLD))  Q:FLD'>0  S RORFDA(FILE,IENS,FLD)="@"
"RTN","RORP000A",136,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORP000A",137,0)
 D MES^RORKIDS("The data has been deleted.")
"RTN","RORP000A",138,0)
 ;--- Delete the field definitions
"RTN","RORP000A",139,0)
 D DELFLDS^RORKIDS(FILE,FLDLST)
"RTN","RORP000A",140,0)
 Q
"RTN","RORP000A",141,0)
 ;
"RTN","RORP000A",142,0)
 ;***** REPLACES "VA ICR" WITH "VA HIV"
"RTN","RORP000A",143,0)
ICRTOHIV(NAME) ;
"RTN","RORP000A",144,0)
 Q $S($E(NAME,1,6)="VA ICR":"VA HIV"_$E(NAME,7,999),1:NAME)
"RTN","RORP000A",145,0)
 ;
"RTN","RORP000A",146,0)
 ;***** RENAMES ICR-RELATED CONFIGURATION RECORDS
"RTN","RORP000A",147,0)
 ;
"RTN","RORP000A",148,0)
 ; Return values:
"RTN","RORP000A",149,0)
 ;       <0  Error code
"RTN","RORP000A",150,0)
 ;        0  Ok
"RTN","RORP000A",151,0)
 ;
"RTN","RORP000A",152,0)
RENAME() ;
"RTN","RORP000A",153,0)
 N I,ICRNAME,IENS,NAME,PI,RC,REGIEN,RORBUF,RORFDA,RORMSG,TMP
"RTN","RORP000A",154,0)
 S REGIEN=+$G(RORICR)
"RTN","RORP000A",155,0)
 Q:REGIEN'>0 0
"RTN","RORP000A",156,0)
 S ICRNAME="VA ICR"
"RTN","RORP000A",157,0)
 ;
"RTN","RORP000A",158,0)
 ;--- Rename Lab search criteria
"RTN","RORP000A",159,0)
 I $$VFILE^DILFD(798.9)  D  Q:$G(RC)<0 RC
"RTN","RORP000A",160,0)
 . D BMES^RORKIDS("Checking the ICR Lab search criteria...")
"RTN","RORP000A",161,0)
 . K RORBUF,RORFDA,RORMSG
"RTN","RORP000A",162,0)
 . D FIND^DIC(798.9,,".01I","Q",ICRNAME,,"B",,,"RORBUF","RORMSG")
"RTN","RORP000A",163,0)
 . I $G(DIERR)>0  S RC=$$DBS^RORERR("RORMSG",-9,,,798.9)  Q
"RTN","RORP000A",164,0)
 . S I=0
"RTN","RORP000A",165,0)
 . F  S I=$O(RORBUF("DILIST",2,I))  Q:I=""  D
"RTN","RORP000A",166,0)
 . . S TMP=RORBUF("DILIST","ID",I,.01),NAME=$$ICRTOHIV(TMP)
"RTN","RORP000A",167,0)
 . . S:NAME'=TMP RORFDA(798.9,RORBUF("DILIST",2,I)_",",.01)=NAME
"RTN","RORP000A",168,0)
 . Q:$D(RORFDA)<10
"RTN","RORP000A",169,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORP000A",170,0)
 . I $G(DIERR)>0  S RC=$$DBS^RORERR("RORMSG",-9,,,798.9)  Q
"RTN","RORP000A",171,0)
 . D MES^RORKIDS("Search criteria have been renamed.")
"RTN","RORP000A",172,0)
 ;
"RTN","RORP000A",173,0)
 ;--- Rename selection rules
"RTN","RORP000A",174,0)
 I $$VFILE^DILFD(798.2)  D  Q:$G(RC)<0 RC
"RTN","RORP000A",175,0)
 . D BMES^RORKIDS("Checking the ICR selection rules...")
"RTN","RORP000A",176,0)
 . K RORBUF,RORFDA,RORMSG
"RTN","RORP000A",177,0)
 . D FIND^DIC(798.2,,".01I","Q",ICRNAME,,"B",,,"RORBUF","RORMSG")
"RTN","RORP000A",178,0)
 . I $G(DIERR)>0  S RC=$$DBS^RORERR("RORMSG",-9,,,798.2)  Q
"RTN","RORP000A",179,0)
 . S I=0
"RTN","RORP000A",180,0)
 . F  S I=$O(RORBUF("DILIST",2,I))  Q:I=""  D
"RTN","RORP000A",181,0)
 . . S TMP=RORBUF("DILIST","ID",I,.01),NAME=$$ICRTOHIV(TMP)
"RTN","RORP000A",182,0)
 . . S:NAME'=TMP RORFDA(798.2,RORBUF("DILIST",2,I)_",",.01)=NAME
"RTN","RORP000A",183,0)
 . Q:$D(RORFDA)<10
"RTN","RORP000A",184,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORP000A",185,0)
 . I $G(DIERR)>0  S RC=$$DBS^RORERR("RORMSG",-9,,,798.2)  Q
"RTN","RORP000A",186,0)
 . D MES^RORKIDS("Selection rules have been renamed.")
"RTN","RORP000A",187,0)
 ;
"RTN","RORP000A",188,0)
 ;--- New registry name
"RTN","RORP000A",189,0)
 I $$VFILE^DILFD(798.1)  D  Q:$G(RC)<0 RC
"RTN","RORP000A",190,0)
 . D BMES^RORKIDS("Renaming the ICR registry parameters...")
"RTN","RORP000A",191,0)
 . K RORBUF,RORFDA,RORMSG  S IENS=REGIEN_","
"RTN","RORP000A",192,0)
 . S RORFDA(798.1,IENS,.01)=$$ICRTOHIV(ICRNAME)
"RTN","RORP000A",193,0)
 . S RORFDA(798.1,IENS,4)="Human Immunodeficiency Virus Registry"
"RTN","RORP000A",194,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORP000A",195,0)
 . I $G(DIERR)>0  S RC=$$DBS^RORERR("RORMSG",-9,,,798.1,IENS)  Q
"RTN","RORP000A",196,0)
 . D MES^RORKIDS("Registry parameters have been renamed.")
"RTN","RORP000A",197,0)
 ;
"RTN","RORP000A",198,0)
 ;--- Success
"RTN","RORP000A",199,0)
 Q 0
"RTN","RORP000B")
0^19^B67791275
"RTN","RORP000B",1,0)
RORP000B ;HCIOFO/SG - CCR V1.5 POST-INSTALL CODE ; 1/20/06 1:35pm
"RTN","RORP000B",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORP000B",3,0)
 ;
"RTN","RORP000B",4,0)
 Q
"RTN","RORP000B",5,0)
 ;
"RTN","RORP000B",6,0)
 ;***** RESTORES THE CDC DEFINITION
"RTN","RORP000B",7,0)
 ;
"RTN","RORP000B",8,0)
 ; Return Values:
"RTN","RORP000B",9,0)
 ;       <0  Error code
"RTN","RORP000B",10,0)
 ;        0  Ok
"RTN","RORP000B",11,0)
 ;
"RTN","RORP000B",12,0)
CDCDEF() ;
"RTN","RORP000B",13,0)
 N RC,RESULTS,RORBUF
"RTN","RORP000B",14,0)
 D BMES^RORKIDS("Restoring the CDC definition...")
"RTN","RORP000B",15,0)
 ;--- Restore the definition from the transport global
"RTN","RORP000B",16,0)
 M RORBUF=@XPDGREF@("RORCDCDEF")
"RTN","RORP000B",17,0)
 S RORBUF="HIV CDC Form Template"
"RTN","RORP000B",18,0)
 D SETPARM^RORRP038(.RESULTS,"ICRCDCDEF","PKG",.RORBUF)
"RTN","RORP000B",19,0)
 Q:$G(RESULTS(0))<0 +RESULTS(0)
"RTN","RORP000B",20,0)
 ;--- Success
"RTN","RORP000B",21,0)
 D MES^RORKIDS("The definition has been restored successfully.")
"RTN","RORP000B",22,0)
 Q 0
"RTN","RORP000B",23,0)
 ;
"RTN","RORP000B",24,0)
 ;***** CONVERSION OF THE 'ROR REGISTRY RECORD' FILE (#798)
"RTN","RORP000B",25,0)
 ;
"RTN","RORP000B",26,0)
 ; Return values:
"RTN","RORP000B",27,0)
 ;       <0  Error code
"RTN","RORP000B",28,0)
 ;        0  Ok
"RTN","RORP000B",29,0)
 ;
"RTN","RORP000B",30,0)
CNV798() ;
"RTN","RORP000B",31,0)
 N BUF,DA,DIK,ERRCNT,HEPCIEN,HSRDATE,HSRIEN,I,IEN,ROOT,TMP
"RTN","RORP000B",32,0)
 S (ERRCNT,RC)=0
"RTN","RORP000B",33,0)
 ;=== Quit if the file has been converted already
"RTN","RORP000B",34,0)
 Q:$$PRD^RORKIDS(798)'<RORPRD 0
"RTN","RORP000B",35,0)
 D BMES^RORKIDS("Converting ROR REGISTRY RECORD file (#798)...")
"RTN","RORP000B",36,0)
 ;
"RTN","RORP000B",37,0)
 ;=== Get some HepC references
"RTN","RORP000B",38,0)
 S HEPCIEN=+RORHEPC
"RTN","RORP000B",39,0)
 S HSRIEN=$$SRLIEN^RORUTL02("VA HEPC 1.0 CONVERSION")
"RTN","RORP000B",40,0)
 Q:HSRIEN'>0 $$ERROR^RORERR(-3)
"RTN","RORP000B",41,0)
 S HSRDATE=$$DT^XLFDT
"RTN","RORP000B",42,0)
 ;
"RTN","RORP000B",43,0)
 ;=== Process the records
"RTN","RORP000B",44,0)
 S DIK=$$ROOT^DILFD(798),ROOT=$$CREF^DILF(DIK)
"RTN","RORP000B",45,0)
 S IEN=0
"RTN","RORP000B",46,0)
 F  S IEN=$O(@ROOT@(IEN)),RC=0  Q:IEN'>0  D  S:RC<0 ERRCNT=ERRCNT+1
"RTN","RORP000B",47,0)
 . ;=== Perform low-level conversion
"RTN","RORP000B",48,0)
 . I '$D(@ROOT@("CONVERTED",IEN))  D  Q:RC
"RTN","RORP000B",49,0)
 . . ;--- Load the data nodes
"RTN","RORP000B",50,0)
 . . K BUF  F I=0,2  S BUF(I)=$G(@ROOT@(IEN,I))
"RTN","RORP000B",51,0)
 . . ;--- Perform basic validation of the record
"RTN","RORP000B",52,0)
 . . I ($P(BUF(0),U)'>0)!($P(BUF(0),U,2)'>0)  D  S RC=1  Q
"RTN","RORP000B",53,0)
 . . . S DA=IEN  D ^DIK  ; Delete invalid record
"RTN","RORP000B",54,0)
 . . . K @ROOT@(IEN)     ; Make sure that record is deleted
"RTN","RORP000B",55,0)
 . . ;--- Check the STATUS (former NEW PATIENT) field
"RTN","RORP000B",56,0)
 . . D:$P(BUF(0),U,5)<4
"RTN","RORP000B",57,0)
 . . . ;--- Mark an erroneously added and then manually
"RTN","RORP000B",58,0)
 . . . ;--- inactivated patient for deletion
"RTN","RORP000B",59,0)
 . . . S TMP=$P(BUF(0),U,13)&($P(BUF(0),U,4)>$P(BUF(0),U,11))
"RTN","RORP000B",60,0)
 . . . S $P(BUF(0),U,5)=$S(TMP:5,1:0)
"RTN","RORP000B",61,0)
 . . ;--- Change the data location of some fields
"RTN","RORP000B",62,0)
 . . S $P(BUF(0),U,8)=$P(BUF(0),U,15)  ; DEMOGRAPHICS UPDATED
"RTN","RORP000B",63,0)
 . . S $P(BUF(0),U,9)=$P(BUF(0),U,16)  ; LOCAL DATA UPDATED
"RTN","RORP000B",64,0)
 . . ;--- Populate DATE CONFIRMED with the value of DATE ENTERED
"RTN","RORP000B",65,0)
 . . S:'$P(BUF(0),U,5) $P(BUF(0),U,4)=$P(BUF(0),U,3)
"RTN","RORP000B",66,0)
 . . ;--- Clear values of deleted fields (INACTIVATION DATE,
"RTN","RORP000B",67,0)
 . . ;    INACTIVATED BY, REACTIVATION DATE, REACTIVATED BY,
"RTN","RORP000B",68,0)
 . . ;--- REASON FOR INACTIVATION, SUPPORTING EVIDENCE,
"RTN","RORP000B",69,0)
 . . S $P(BUF(0),U,9,16)=$P(BUF(0),U,9)
"RTN","RORP000B",70,0)
 . . S $P(BUF(2),U,4,5)=$P(BUF(2),U,4)
"RTN","RORP000B",71,0)
 . . ;--- Populate the DATE DELETED field (if necessary)
"RTN","RORP000B",72,0)
 . . S:$P(BUF(0),U,5)=5 $P(BUF(0),U,11)=$$NOW^XLFDT
"RTN","RORP000B",73,0)
 . . ;--- Reset the transmission dates (DATA EXTRACTED UNTIL =
"RTN","RORP000B",74,0)
 . . ;    DATA ACKNOWLEDGED UNTIL) and clear MESSAGE ID's to
"RTN","RORP000B",75,0)
 . . ;    ensure that no data will be missed during transition
"RTN","RORP000B",76,0)
 . . ;--- to the new HL7 message acknowledgement model.
"RTN","RORP000B",77,0)
 . . S $P(BUF(2),U,2,3)=$P(BUF(2),U,1)_U
"RTN","RORP000B",78,0)
 . . ;--- Store the data and mark the record as converted
"RTN","RORP000B",79,0)
 . . M @ROOT@(IEN)=BUF
"RTN","RORP000B",80,0)
 . . S @ROOT@("CONVERTED",IEN)=""
"RTN","RORP000B",81,0)
 . ;=== Additional processing for HepC records
"RTN","RORP000B",82,0)
 . I $P($G(@ROOT@(IEN,0)),U,2)=HEPCIEN  D  Q:RC<0
"RTN","RORP000B",83,0)
 . . N IENS,RORFDA,RORMSG
"RTN","RORP000B",84,0)
 . . ;--- Add "conversion" selection rule
"RTN","RORP000B",85,0)
 . . D:'$D(@ROOT@(IEN,1,"B",HSRIEN))
"RTN","RORP000B",86,0)
 . . . S IENS="+1,"_IEN_","
"RTN","RORP000B",87,0)
 . . . S RORFDA(798.01,IENS,.01)=HSRIEN  ; SELECTION RULE
"RTN","RORP000B",88,0)
 . . . S RORFDA(798.01,IENS,1)=HSRDATE   ; DATE
"RTN","RORP000B",89,0)
 . . . D UPDATE^DIE(,"RORFDA","RORMSG")
"RTN","RORP000B",90,0)
 . . . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798.01,IENS)
"RTN","RORP000B",91,0)
 ;--- Error(s) during conversion
"RTN","RORP000B",92,0)
 Q:ERRCNT>0 $$ERROR^RORERR(-43,,,,"file #798 conversion")
"RTN","RORP000B",93,0)
 ;
"RTN","RORP000B",94,0)
 ;=== Rebuild the cross-references
"RTN","RORP000B",95,0)
 K DA,@ROOT@("AM")
"RTN","RORP000B",96,0)
 S DIK(1)="10"            D ENALL^DIK  ; MESSAGE ID
"RTN","RORP000B",97,0)
 S DIK(1)=".02^ARP^ARCP"  D ENALL^DIK  ; New indexes
"RTN","RORP000B",98,0)
 ;
"RTN","RORP000B",99,0)
 ;=== Success
"RTN","RORP000B",100,0)
 D PRD^RORKIDS(798,RORPRD)
"RTN","RORP000B",101,0)
 K @ROOT@("CONVERTED")
"RTN","RORP000B",102,0)
 D MES^RORKIDS("The file has been converted successfully.")
"RTN","RORP000B",103,0)
 Q 0
"RTN","RORP000B",104,0)
 ;
"RTN","RORP000B",105,0)
 ;***** CONVERSION OF THE 'ROR REGISTRY PARAMETERS' FILE (#798.1)
"RTN","RORP000B",106,0)
 ;
"RTN","RORP000B",107,0)
 ; Return values:
"RTN","RORP000B",108,0)
 ;       <0  Error code
"RTN","RORP000B",109,0)
 ;        0  Ok
"RTN","RORP000B",110,0)
 ;
"RTN","RORP000B",111,0)
CNV7981() ;
"RTN","RORP000B",112,0)
 N BUF,ERRCNT,I,IEN,IENS,RC,ROOT,RORMSG,RORFDA,TMP
"RTN","RORP000B",113,0)
 S (ERRCNT,RC)=0
"RTN","RORP000B",114,0)
 ;=== Quit if the file has been converted already
"RTN","RORP000B",115,0)
 Q:$$PRD^RORKIDS(798.1)'<RORPRD 0
"RTN","RORP000B",116,0)
 D BMES^RORKIDS("Updating ROR REGISTRY PARAMETERS file (#798.1)...")
"RTN","RORP000B",117,0)
 ;
"RTN","RORP000B",118,0)
 ;=== Process the records (registry-independent fields)
"RTN","RORP000B",119,0)
 S ROOT=$$ROOT^DILFD(798.1,,1)
"RTN","RORP000B",120,0)
 S IEN=0
"RTN","RORP000B",121,0)
 F  S IEN=$O(@ROOT@(IEN)),RC=0  Q:IEN'>0  D  S:RC<0 ERRCNT=ERRCNT+1
"RTN","RORP000B",122,0)
 . ;=== Perform low-level conversion
"RTN","RORP000B",123,0)
 . I '$D(@ROOT@("CONVERTED",IEN))  D  Q:RC<0
"RTN","RORP000B",124,0)
 . . ;--- Clear values of deleted fields
"RTN","RORP000B",125,0)
 . . K @ROOT@(IEN,14)
"RTN","RORP000B",126,0)
 . . ;--- Mark the record as converted
"RTN","RORP000B",127,0)
 . . S @ROOT@("CONVERTED",IEN)=""
"RTN","RORP000B",128,0)
 . ;=== Set registry parameters
"RTN","RORP000B",129,0)
 . S IENS=IEN_","  K RORFDA,RORMSG
"RTN","RORP000B",130,0)
 . ;--- EXTRACT PERIOD FOR NEW PATIENT
"RTN","RORP000B",131,0)
 . S RORFDA(798.1,IENS,7)=7300 ; 20 years
"RTN","RORP000B",132,0)
 . ;--- PROTOCOL
"RTN","RORP000B",133,0)
 . S RORFDA(798.1,IENS,13)="ROR-SITE-DRIVER"
"RTN","RORP000B",134,0)
 . ;--- MAXIMUM MESSAGE SIZE
"RTN","RORP000B",135,0)
 . S RORFDA(798.1,IENS,13.1)=5 ; megabytes
"RTN","RORP000B",136,0)
 . ;--- NUMBER OF RETRIES FOR ALERT
"RTN","RORP000B",137,0)
 . S RORFDA(798.1,IENS,13.2)=2
"RTN","RORP000B",138,0)
 . ;--- LAG DAYS
"RTN","RORP000B",139,0)
 . S RORFDA(798.1,IENS,15.1)=7
"RTN","RORP000B",140,0)
 . ;--- EXCLUDE EMPLOYEES
"RTN","RORP000B",141,0)
 . S RORFDA(798.1,IENS,26)="NO"
"RTN","RORP000B",142,0)
 . ;--- Store the data
"RTN","RORP000B",143,0)
 . D FILE^DIE("E","RORFDA","RORMSG")
"RTN","RORP000B",144,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","RORP000B",145,0)
 ;--- Error(s) during conversion
"RTN","RORP000B",146,0)
 Q:ERRCNT>0 $$ERROR^RORERR(-43,,,,"file #798.1 update")
"RTN","RORP000B",147,0)
 ;
"RTN","RORP000B",148,0)
 ;=== Set the HepC registry parameters
"RTN","RORP000B",149,0)
 S IENS=(+RORHEPC)_","  K RORFDA,RORMSG
"RTN","RORP000B",150,0)
 ;--- REGISTRY UPDATED UNTIL
"RTN","RORP000B",151,0)
 S TMP=$$GET1^DIQ(798.1,IENS,1,"I",,"RORMSG")
"RTN","RORP000B",152,0)
 S:TMP'>0 RORFDA(798.1,IENS,1)=2900101
"RTN","RORP000B",153,0)
 ;--- DATA EXTRACTED UNTIL
"RTN","RORP000B",154,0)
 S TMP=$$GET1^DIQ(798.1,IENS,2,"I",,"RORMSG")
"RTN","RORP000B",155,0)
 S:TMP'>0 RORFDA(798.1,IENS,2)=2850101
"RTN","RORP000B",156,0)
 ;--- AVAILABLE REPORTS
"RTN","RORP000B",157,0)
 S RORFDA(798.1,IENS,27)="1,2,3,4,5,6,7,9,10,11,12,13,14,15,16,17"
"RTN","RORP000B",158,0)
 ;--- Store the data
"RTN","RORP000B",159,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORP000B",160,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","RORP000B",161,0)
 ;
"RTN","RORP000B",162,0)
 ;=== Set the HIV registry parameters
"RTN","RORP000B",163,0)
 S IENS=(+RORICR)_","  K RORFDA,RORMSG
"RTN","RORP000B",164,0)
 ;--- Clear the old value during the upgrade
"RTN","RORP000B",165,0)
 S RORFDA(798.1,IENS,6.1)="@"  ; BEFORE UPDATE
"RTN","RORP000B",166,0)
 S RORFDA(798.1,IENS,10)="@"   ; MESSAGE BUILDER
"RTN","RORP000B",167,0)
 ;--- REGISTRY UPDATED UNTIL
"RTN","RORP000B",168,0)
 S TMP=$$GET1^DIQ(798.1,IENS,1,"I",,"RORMSG")
"RTN","RORP000B",169,0)
 S:TMP'>0 RORFDA(798.1,IENS,1)=2850101
"RTN","RORP000B",170,0)
 ;--- DATA EXTRACTED UNTIL
"RTN","RORP000B",171,0)
 S TMP=$$GET1^DIQ(798.1,IENS,2,"I",,"RORMSG")
"RTN","RORP000B",172,0)
 S:TMP'>0 RORFDA(798.1,IENS,2)=2850101
"RTN","RORP000B",173,0)
 ;--- AVAILABLE REPORTS
"RTN","RORP000B",174,0)
 S RORFDA(798.1,IENS,27)="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17"
"RTN","RORP000B",175,0)
 ;--- Store the data
"RTN","RORP000B",176,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORP000B",177,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","RORP000B",178,0)
 ;
"RTN","RORP000B",179,0)
 ;=== Reindex the cross-references
"RTN","RORP000B",180,0)
 S TMP=$$RNDXACL^RORUTL11()  ; "ACL" (security keys)
"RTN","RORP000B",181,0)
 ;
"RTN","RORP000B",182,0)
 ;=== Success
"RTN","RORP000B",183,0)
 D PRD^RORKIDS(798.1,RORPRD)
"RTN","RORP000B",184,0)
 K @ROOT@("CONVERTED")
"RTN","RORP000B",185,0)
 D MES^RORKIDS("The file has been updated successfully.")
"RTN","RORP000B",186,0)
 Q 0
"RTN","RORP000B",187,0)
 ;
"RTN","RORP000B",188,0)
 ;***** CONVERSION OF THE 'ROR LIST ITEM' FILE (#799.1)
"RTN","RORP000B",189,0)
 ;
"RTN","RORP000B",190,0)
 ; Return values:
"RTN","RORP000B",191,0)
 ;       <0  Error code
"RTN","RORP000B",192,0)
 ;        0  Ok
"RTN","RORP000B",193,0)
 ;
"RTN","RORP000B",194,0)
CNV7991() ;
"RTN","RORP000B",195,0)
 N DA,DIK,ERRCNT,II,IENS,RC,RORBUF,RORFDA,RORMSG,TMP,TYPE
"RTN","RORP000B",196,0)
 S (ERRCNT,RC)=0
"RTN","RORP000B",197,0)
 ;
"RTN","RORP000B",198,0)
 ;--- Delete inactivation reasons and supporting evidences
"RTN","RORP000B",199,0)
 S DIK=$$ROOT^DILFD(799.1)
"RTN","RORP000B",200,0)
 F TYPE=1,2  S RC=0  D  S:RC<0 ERRCNT=ERRCNT+1
"RTN","RORP000B",201,0)
 . K RORBUF,RORMSG
"RTN","RORP000B",202,0)
 . D FIND^DIC(799.1,,"@","Q",TYPE,,"KEY",,,"RORBUF","RORMSG")
"RTN","RORP000B",203,0)
 . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,,799.1)  Q
"RTN","RORP000B",204,0)
 . S II=""
"RTN","RORP000B",205,0)
 . F  S II=$O(RORBUF("DILIST",2,II))  Q:II=""  D
"RTN","RORP000B",206,0)
 . . S DA=+RORBUF("DILIST",2,II)  D ^DIK
"RTN","RORP000B",207,0)
 Q:ERRCNT>0 $$ERROR^RORERR(-43,,,,"file #799.1 cleanup")
"RTN","RORP000B",208,0)
 ;
"RTN","RORP000B",209,0)
 ;--- Restore the data from the transport global
"RTN","RORP000B",210,0)
 S RC=$$RS7991^RORPUT02()  Q:RC<0 RC
"RTN","RORP000B",211,0)
 ;--- Success
"RTN","RORP000B",212,0)
 Q 0
"RTN","RORP000B",213,0)
 ;
"RTN","RORP000B",214,0)
 ;***** CONVERSION OF THE 'ROR HIV RECORD' FILE (#799.4)
"RTN","RORP000B",215,0)
 ;
"RTN","RORP000B",216,0)
 ; Return values:
"RTN","RORP000B",217,0)
 ;       <0  Error code
"RTN","RORP000B",218,0)
 ;        0  Ok
"RTN","RORP000B",219,0)
 ;
"RTN","RORP000B",220,0)
CNV7994() ;
"RTN","RORP000B",221,0)
 N BUF,I,IEN,RC,ROOT,STORE,TMP,VAL
"RTN","RORP000B",222,0)
 S RC=0
"RTN","RORP000B",223,0)
 ;=== Quit if the file has been converted already
"RTN","RORP000B",224,0)
 Q:$$PRD^RORKIDS(799.4)'<RORPRD 0
"RTN","RORP000B",225,0)
 D BMES^RORKIDS("Updating ROR HIV RECORD file (#799.4)...")
"RTN","RORP000B",226,0)
 ;
"RTN","RORP000B",227,0)
 ;=== Process the records
"RTN","RORP000B",228,0)
 S ROOT=$$ROOT^DILFD(799.4,,1)
"RTN","RORP000B",229,0)
 S IEN=0
"RTN","RORP000B",230,0)
 F  S IEN=$O(@ROOT@(IEN)),RC=0  Q:IEN'>0  D  S:RC<0 ERRCNT=ERRCNT+1
"RTN","RORP000B",231,0)
 . S BUF=$G(@ROOT@(IEN,16))  Q:BUF=""
"RTN","RORP000B",232,0)
 . S STORE=0
"RTN","RORP000B",233,0)
 . F I=1,5  S VAL=$P(BUF,U,I)  D:VAL'=""
"RTN","RORP000B",234,0)
 . . I VAL="I"  S $P(BUF,U,I)=8,STORE=1  Q
"RTN","RORP000B",235,0)
 . . I VAL="N"  S $P(BUF,U,I)=0,STORE=1  Q
"RTN","RORP000B",236,0)
 . . I VAL="P"  S $P(BUF,U,I)=1,STORE=1  Q
"RTN","RORP000B",237,0)
 . . I VAL="U"  S $P(BUF,U,I)=9,STORE=1  Q
"RTN","RORP000B",238,0)
 . S:STORE @ROOT@(IEN,16)=BUF
"RTN","RORP000B",239,0)
 ;
"RTN","RORP000B",240,0)
 ;=== Success
"RTN","RORP000B",241,0)
 D PRD^RORKIDS(799.4,RORPRD)
"RTN","RORP000B",242,0)
 D MES^RORKIDS("The file has been updated successfully.")
"RTN","RORP000B",243,0)
 Q 0
"RTN","RORP000B",244,0)
 ;
"RTN","RORP000B",245,0)
 ;***** RENAMES THE SECURITY KEYS
"RTN","RORP000B",246,0)
 ;
"RTN","RORP000B",247,0)
 ; Return Values:
"RTN","RORP000B",248,0)
 ;       <0  Error code
"RTN","RORP000B",249,0)
 ;        0  Ok
"RTN","RORP000B",250,0)
 ;
"RTN","RORP000B",251,0)
KEYS() ;
"RTN","RORP000B",252,0)
 N KEYIEN,RC,TMP
"RTN","RORP000B",253,0)
 D BMES^RORKIDS("Renaming the ICR security keys...")
"RTN","RORP000B",254,0)
 S RC=0
"RTN","RORP000B",255,0)
 ;---
"RTN","RORP000B",256,0)
 F SRCNAME="ROR VA ICR ADMIN","ROR VA ICR USER"  D  Q:RC<0
"RTN","RORP000B",257,0)
 . S KEYIEN=$$LKUP^XPDKEY(SRCNAME)  Q:KEYIEN'>0
"RTN","RORP000B",258,0)
 . S DSTNAME=SRCNAME,$P(DSTNAME," ",3)="HIV"
"RTN","RORP000B",259,0)
 . I $D(^XUSEC(SRCNAME))>1  D
"RTN","RORP000B",260,0)
 . . S KEYIEN=$$LKUP^XPDKEY(DSTNAME)
"RTN","RORP000B",261,0)
 . . D:KEYIEN>0 DEL^XPDKEY(KEYIEN)
"RTN","RORP000B",262,0)
 . . S TMP=$$RENAME^XPDKEY(SRCNAME,DSTNAME)
"RTN","RORP000B",263,0)
 . . S:'TMP RC=$$ERROR^RORERR(-96,,,,SRCNAME,DSTNAME)
"RTN","RORP000B",264,0)
 . E  D DEL^XPDKEY(KEYIEN)
"RTN","RORP000B",265,0)
 Q:RC<0 RC
"RTN","RORP000B",266,0)
 ;--- Success
"RTN","RORP000B",267,0)
 D MES^RORKIDS("The keys have been renamed successfully.")
"RTN","RORP000B",268,0)
 Q 0
"RTN","RORP008")
1^86
"RTN","RORPUT01")
0^87^B36828175
"RTN","RORPUT01",1,0)
RORPUT01 ;HCIOFO/SG - EDIT LOINC AND DRUG CODE MULTIPLES ; 9/29/03 3:29pm
"RTN","RORPUT01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORPUT01",3,0)
 ;
"RTN","RORPUT01",4,0)
 Q
"RTN","RORPUT01",5,0)
 ;
"RTN","RORPUT01",6,0)
 ;***** ADDS THE RECORDS TO THE MULTIPLE
"RTN","RORPUT01",7,0)
 ;
"RTN","RORPUT01",8,0)
 ; REGIEN        Registry IEN
"RTN","RORPUT01",9,0)
 ; SUBFILE       Subfile number
"RTN","RORPUT01",10,0)
 ; LSTREF        Reference to a list or the list itself (see the
"RTN","RORPUT01",11,0)
 ;               $$COMPNEXT^RORPUT01 function for more details).
"RTN","RORPUT01",12,0)
 ;
"RTN","RORPUT01",13,0)
 ; Return Values:
"RTN","RORPUT01",14,0)
 ;       <0  Error code
"RTN","RORPUT01",15,0)
 ;        0  Ok
"RTN","RORPUT01",16,0)
 ;
"RTN","RORPUT01",17,0)
ADD(REGIEN,SUBFILE,LSTREF) ;
"RTN","RORPUT01",18,0)
 N BUF,IENS,ITEM,LI,NEXT,RC,RORFDA,RORMSG,TLI
"RTN","RORPUT01",19,0)
 S NEXT=$$COMPNEXT(LSTREF)  Q:NEXT<0 NEXT
"RTN","RORPUT01",20,0)
 S IENS="?+1,"_(+REGIEN)_",",RC=0
"RTN","RORPUT01",21,0)
 F TLI=1:1  X NEXT  Q:$G(BUF)'[";;"  D  Q:RC<0
"RTN","RORPUT01",22,0)
 . S BUF=$P(BUF,";;",2)
"RTN","RORPUT01",23,0)
 . D MES^RORKIDS(BUF)
"RTN","RORPUT01",24,0)
 . S BUF=$TR(BUF," ")
"RTN","RORPUT01",25,0)
 . F LI=1:1  S ITEM=$P(BUF,",",LI)  Q:ITEM=""  D  Q:RC<0
"RTN","RORPUT01",26,0)
 . . S RORFDA(SUBFILE,IENS,.01)=ITEM
"RTN","RORPUT01",27,0)
 . . D UPDATE^DIE(,"RORFDA",,"RORMSG")
"RTN","RORPUT01",28,0)
 . . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,SUBFILE,IENS)
"RTN","RORPUT01",29,0)
 Q RC
"RTN","RORPUT01",30,0)
 ;
"RTN","RORPUT01",31,0)
 ;***** COMPILES THE 'NEXT' LOGIC
"RTN","RORPUT01",32,0)
 ;
"RTN","RORPUT01",33,0)
 ; PARAM         Parameter defining the list of codes. It should be
"RTN","RORPUT01",34,0)
 ;               either a list of codes separated by commas or a full
"RTN","RORPUT01",35,0)
 ;               reference (TAG^ROUTINE) to a routine label after
"RTN","RORPUT01",36,0)
 ;               which the list is located. In the latter case, the
"RTN","RORPUT01",37,0)
 ;               list itself should look like this:
"RTN","RORPUT01",38,0)
 ;
"RTN","RORPUT01",39,0)
 ;                         ;
"RTN","RORPUT01",40,0)
 ;                         ;***** SHORT DESCRIPTION OF THE LIST
"RTN","RORPUT01",41,0)
 ;                 LABEL   ;
"RTN","RORPUT01",42,0)
 ;                         ;;  Code1, Code2, ...
"RTN","RORPUT01",43,0)
 ;                         ;;  CodeN, ...
"RTN","RORPUT01",44,0)
 ;                         ;
"RTN","RORPUT01",45,0)
 ;
"RTN","RORPUT01",46,0)
 ;               There should be at least one line that does not
"RTN","RORPUT01",47,0)
 ;               contain ";;" after the list (or no lines at all).
"RTN","RORPUT01",48,0)
 ;
"RTN","RORPUT01",49,0)
 ; Return Values:
"RTN","RORPUT01",50,0)
 ;       <0  Error code
"RTN","RORPUT01",51,0)
 ;       ""  The list is empty
"RTN","RORPUT01",52,0)
 ;     '=""  A string that should be XECUTE'd to get the next
"RTN","RORPUT01",53,0)
 ;           buffer with the list data
"RTN","RORPUT01",54,0)
 ;
"RTN","RORPUT01",55,0)
COMPNEXT(PARAM) ;
"RTN","RORPUT01",56,0)
 N I,N,NEXT,RC  Q:PARAM?." " ""
"RTN","RORPUT01",57,0)
 ;--- Reference to a routine label
"RTN","RORPUT01",58,0)
 I PARAM?1.8UN1"^"1.8UN  D  Q NEXT
"RTN","RORPUT01",59,0)
 . S NEXT="S BUF=$T("_$P(PARAM,U)_"+TLI"_U_$P(PARAM,U,2)_")"
"RTN","RORPUT01",60,0)
 ;--- List of codes separated by commas
"RTN","RORPUT01",61,0)
 S N=$L(PARAM,","),RC=0
"RTN","RORPUT01",62,0)
 F I=1:1:N  I '($P(PARAM,",",I)?." "1.N." ")  S RC=-88  Q
"RTN","RORPUT01",63,0)
 I RC<0,I=N  S:$P(PARAM,",",N)?." " RC=0,N=N-1
"RTN","RORPUT01",64,0)
 I N>0,RC'<0  D  Q NEXT
"RTN","RORPUT01",65,0)
 . S NEXT="S BUF=$P("""_";;"_$P(PARAM,",",1,N)_""",U,TLI)"
"RTN","RORPUT01",66,0)
 ;--- Invalid parameter
"RTN","RORPUT01",67,0)
 Q $$ERROR^RORERR(-88,,,,"List of Codes",PARAM)
"RTN","RORPUT01",68,0)
 ;
"RTN","RORPUT01",69,0)
 ;***** ADDS ITEMS TO 'DRUG THERAPY LIST' MULTIPLE OF FILE #798.1
"RTN","RORPUT01",70,0)
 ;
"RTN","RORPUT01",71,0)
 ; [RORREG]      Registry IEN and registry name separated by the '^'
"RTN","RORPUT01",72,0)
 ;               (RegistryIEN^RegistryName).
"RTN","RORPUT01",73,0)
 ;
"RTN","RORPUT01",74,0)
 ; [RORDRGAD]    Either a list of National Drug Codes separated by
"RTN","RORPUT01",75,0)
 ;               commas or a full reference (TAG^ROUTINE) to a
"RTN","RORPUT01",76,0)
 ;               routine label after which the list is located.
"RTN","RORPUT01",77,0)
 ;
"RTN","RORPUT01",78,0)
 ;               All spaces are removed from the lines of the list.
"RTN","RORPUT01",79,0)
 ;               See the $$COMPNEXT^RORPUT01 function for more
"RTN","RORPUT01",80,0)
 ;               details.
"RTN","RORPUT01",81,0)
 ;
"RTN","RORPUT01",82,0)
 ; If some of these parameters are omitted or equal to an empty
"RTN","RORPUT01",83,0)
 ; strings, their values must be defined as the RORPARM("KIDS")
"RTN","RORPUT01",84,0)
 ; sub-nodes of the same name.
"RTN","RORPUT01",85,0)
 ;
"RTN","RORPUT01",86,0)
 ; Return Values:
"RTN","RORPUT01",87,0)
 ;       <0  Error code
"RTN","RORPUT01",88,0)
 ;        0  Ok
"RTN","RORPUT01",89,0)
 ;
"RTN","RORPUT01",90,0)
DRUGADD(RORREG,RORDRGAD) ;
"RTN","RORPUT01",91,0)
 N RC
"RTN","RORPUT01",92,0)
 D BMES^RORKIDS("Adding new items to the drug list...")
"RTN","RORPUT01",93,0)
 ;--- Get the parameters
"RTN","RORPUT01",94,0)
 S:'$G(RORREG) RORREG=$$PARAM^RORKIDS("RORREG")
"RTN","RORPUT01",95,0)
 S:$G(RORDRGAD)="" RORDRGAD=$$PARAM^RORKIDS("RORDRGAD")
"RTN","RORPUT01",96,0)
 ;--- Update the multiple
"RTN","RORPUT01",97,0)
 S RC=$$ADD(+RORREG,798.117,RORDRGAD)  Q:RC<0 RC
"RTN","RORPUT01",98,0)
 ;--- Success
"RTN","RORPUT01",99,0)
 D MES^RORKIDS("The drug list has been updated successfully.")
"RTN","RORPUT01",100,0)
 Q 0
"RTN","RORPUT01",101,0)
 ;
"RTN","RORPUT01",102,0)
 ;***** REMOVES ITEMS FROM 'DRUG THERAPY LIST' MULTIPLE OF FILE #798.1
"RTN","RORPUT01",103,0)
 ;
"RTN","RORPUT01",104,0)
 ; [RORREG]      Registry IEN and registry name separated by the '^'
"RTN","RORPUT01",105,0)
 ;               (RegistryIEN^RegistryName).
"RTN","RORPUT01",106,0)
 ;
"RTN","RORPUT01",107,0)
 ; [RORDRGAD]    Either a list of National Drug Codes separated by
"RTN","RORPUT01",108,0)
 ;               commas or a full reference (TAG^ROUTINE) to a
"RTN","RORPUT01",109,0)
 ;               routine label after which the list is located.
"RTN","RORPUT01",110,0)
 ;
"RTN","RORPUT01",111,0)
 ;               All spaces are removed from the lines of the list.
"RTN","RORPUT01",112,0)
 ;               See the $$COMPNEXT^RORPUT01 function for more
"RTN","RORPUT01",113,0)
 ;               details.
"RTN","RORPUT01",114,0)
 ;
"RTN","RORPUT01",115,0)
 ; If some of these parameters are omitted or equal to an empty
"RTN","RORPUT01",116,0)
 ; strings, their values must be defined as the RORPARM("KIDS")
"RTN","RORPUT01",117,0)
 ; sub-nodes of the same name.
"RTN","RORPUT01",118,0)
 ;
"RTN","RORPUT01",119,0)
 ; Return Values:
"RTN","RORPUT01",120,0)
 ;       <0  Error code
"RTN","RORPUT01",121,0)
 ;        0  Ok
"RTN","RORPUT01",122,0)
 ;
"RTN","RORPUT01",123,0)
DRUGREM(RORREG,RORDRGRM) ;
"RTN","RORPUT01",124,0)
 N RC
"RTN","RORPUT01",125,0)
 D BMES^RORKIDS("Removing obsolete items from the drug list...")
"RTN","RORPUT01",126,0)
 ;--- Get the parameters
"RTN","RORPUT01",127,0)
 S:'$G(RORREG) RORREG=$$PARAM^RORKIDS("RORREG")
"RTN","RORPUT01",128,0)
 S:$G(RORDRGRM)="" RORDRGRM=$$PARAM^RORKIDS("RORDRGRM")
"RTN","RORPUT01",129,0)
 ;--- Update the multiple
"RTN","RORPUT01",130,0)
 S RC=$$REMOVE(+RORREG,798.117,RORDRGRM)  Q:RC<0 RC
"RTN","RORPUT01",131,0)
 ;--- Success
"RTN","RORPUT01",132,0)
 D MES^RORKIDS("The drug list has been updated successfully.")
"RTN","RORPUT01",133,0)
 Q 0
"RTN","RORPUT01",134,0)
 ;
"RTN","RORPUT01",135,0)
 ;***** ADDS ITEMS TO 'EXTRACTED RESULT' MULTIPLE OF FILE #798.1
"RTN","RORPUT01",136,0)
 ;
"RTN","RORPUT01",137,0)
 ; [RORREG]      Registry IEN and registry name separated by the '^'
"RTN","RORPUT01",138,0)
 ;               (RegistryIEN^RegistryName).
"RTN","RORPUT01",139,0)
 ;
"RTN","RORPUT01",140,0)
 ; [RORLNCAD]    Either a list of LOINC codes (without check digits)
"RTN","RORPUT01",141,0)
 ;               separated by commas or a full reference (TAG^ROUTINE)
"RTN","RORPUT01",142,0)
 ;               to a routine label after which the list is located.
"RTN","RORPUT01",143,0)
 ;
"RTN","RORPUT01",144,0)
 ;               All spaces are removed from the lines of the list.
"RTN","RORPUT01",145,0)
 ;               See the $$COMPNEXT^RORPUT01 function for more
"RTN","RORPUT01",146,0)
 ;               details.
"RTN","RORPUT01",147,0)
 ;
"RTN","RORPUT01",148,0)
 ; If some of these parameters are omitted or equal to an empty
"RTN","RORPUT01",149,0)
 ; strings, their values must be defined as the RORPARM("KIDS")
"RTN","RORPUT01",150,0)
 ; sub-nodes of the same name.
"RTN","RORPUT01",151,0)
 ;
"RTN","RORPUT01",152,0)
 ; Return Values:
"RTN","RORPUT01",153,0)
 ;       <0  Error code
"RTN","RORPUT01",154,0)
 ;        0  Ok
"RTN","RORPUT01",155,0)
 ;
"RTN","RORPUT01",156,0)
LOINCADD(RORREG,RORLNCAD) ;
"RTN","RORPUT01",157,0)
 N RC
"RTN","RORPUT01",158,0)
 D BMES^RORKIDS("Adding new LOINC codes to the EXTRACTED RESULT multiple...")
"RTN","RORPUT01",159,0)
 ;--- Get the parameters
"RTN","RORPUT01",160,0)
 S:'$G(RORREG) RORREG=$$PARAM^RORKIDS("RORREG")
"RTN","RORPUT01",161,0)
 S:$G(RORLNCAD)="" RORLNCAD=$$PARAM^RORKIDS("RORLNCAD")
"RTN","RORPUT01",162,0)
 ;--- Add new LOINC codes
"RTN","RORPUT01",163,0)
 S RC=$$ADD(+RORREG,798.112,RORLNCAD)  Q:RC<0 RC
"RTN","RORPUT01",164,0)
 ;--- Success
"RTN","RORPUT01",165,0)
 D MES^RORKIDS("The LOINC list has been updated successfully.")
"RTN","RORPUT01",166,0)
 Q 0
"RTN","RORPUT01",167,0)
 ;
"RTN","RORPUT01",168,0)
 ;***** REMOVES ITEMS FROM 'EXTRACTED RESULT' MULTIPLE OF FILE #798.1
"RTN","RORPUT01",169,0)
 ;
"RTN","RORPUT01",170,0)
 ; [RORREG]      Registry IEN and registry name separated by the '^'
"RTN","RORPUT01",171,0)
 ;               (RegistryIEN^RegistryName).
"RTN","RORPUT01",172,0)
 ;
"RTN","RORPUT01",173,0)
 ; [RORLNCRM]    Either a list of LOINC codes (without check digits)
"RTN","RORPUT01",174,0)
 ;               separated by commas or a full reference (TAG^ROUTINE)
"RTN","RORPUT01",175,0)
 ;               to a routine label after which the list is located.
"RTN","RORPUT01",176,0)
 ;
"RTN","RORPUT01",177,0)
 ;               All spaces are removed from the lines of the list.
"RTN","RORPUT01",178,0)
 ;               See the $$COMPNEXT^RORPUT01 function for more
"RTN","RORPUT01",179,0)
 ;               details.
"RTN","RORPUT01",180,0)
 ;
"RTN","RORPUT01",181,0)
 ; If some of these parameters are omitted or equal to an empty
"RTN","RORPUT01",182,0)
 ; strings, their values must be defined as the RORPARM("KIDS")
"RTN","RORPUT01",183,0)
 ; sub-nodes of the same name.
"RTN","RORPUT01",184,0)
 ;
"RTN","RORPUT01",185,0)
 ; Return Values:
"RTN","RORPUT01",186,0)
 ;       <0  Error code
"RTN","RORPUT01",187,0)
 ;        0  Ok
"RTN","RORPUT01",188,0)
 ;
"RTN","RORPUT01",189,0)
LOINCREM(RORREG,RORLNCRM) ;
"RTN","RORPUT01",190,0)
 N BUF,DA,DIK,IENS,IR,LCI,LOINC,NEXT,RC,RORBUF,RORMSG,TLI
"RTN","RORPUT01",191,0)
 D BMES^RORKIDS("Removing obsolete codes from the EXTRACTED RESULT multiple...")
"RTN","RORPUT01",192,0)
 ;--- Get the parameters
"RTN","RORPUT01",193,0)
 S:'$G(RORREG) RORREG=$$PARAM^RORKIDS("RORREG")
"RTN","RORPUT01",194,0)
 S:$G(RORLNCRM)="" RORLNCRM=$$PARAM^RORKIDS("RORLNCRM")
"RTN","RORPUT01",195,0)
 ;--- Delete unnecessary LOINC codes
"RTN","RORPUT01",196,0)
 S RC=$$REMOVE(+RORREG,798.112,RORLNCRM)  Q:RC<0 RC
"RTN","RORPUT01",197,0)
 ;--- Success
"RTN","RORPUT01",198,0)
 D MES^RORKIDS("The LOINC list has been updated successfully.")
"RTN","RORPUT01",199,0)
 Q 0
"RTN","RORPUT01",200,0)
 ;
"RTN","RORPUT01",201,0)
 ;***** REMOVES THE RECORDS FROM THE MULTIPLE
"RTN","RORPUT01",202,0)
 ;
"RTN","RORPUT01",203,0)
 ; REGIEN        Registry IEN
"RTN","RORPUT01",204,0)
 ; SUBFILE       Subfile number
"RTN","RORPUT01",205,0)
 ; LSTREF        Reference to a list or the list itself (see the
"RTN","RORPUT01",206,0)
 ;               $$COMPNEXT^RORPUT01 function for more details).
"RTN","RORPUT01",207,0)
 ;
"RTN","RORPUT01",208,0)
 ; Return Values:
"RTN","RORPUT01",209,0)
 ;       <0  Error code
"RTN","RORPUT01",210,0)
 ;        0  Ok
"RTN","RORPUT01",211,0)
 ;
"RTN","RORPUT01",212,0)
REMOVE(REGIEN,SUBFILE,LSTREF) ;
"RTN","RORPUT01",213,0)
 N BUF,DA,DIK,IENS,IR,ITEM,LI,NEXT,RC,RORBUF,RORMSG,TLI
"RTN","RORPUT01",214,0)
 S NEXT=$$COMPNEXT(LSTREF)  Q:NEXT<0 NEXT
"RTN","RORPUT01",215,0)
 S IENS=","_(+REGIEN)_",",RC=0
"RTN","RORPUT01",216,0)
 F TLI=1:1  X NEXT  Q:$G(BUF)'[";;"  D  Q:RC<0
"RTN","RORPUT01",217,0)
 . S BUF=$P(BUF,";;",2)
"RTN","RORPUT01",218,0)
 . D MES^RORKIDS(BUF)
"RTN","RORPUT01",219,0)
 . S BUF=$TR(BUF," ")
"RTN","RORPUT01",220,0)
 . F LI=1:1  S ITEM=$P(BUF,",",LI)  Q:ITEM=""  D  Q:RC<0
"RTN","RORPUT01",221,0)
 . . K RORBUF
"RTN","RORPUT01",222,0)
 . . D FIND^DIC(SUBFILE,IENS,"@","QX",ITEM,,"B",,,"RORBUF","RORMSG")
"RTN","RORPUT01",223,0)
 . . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,,SUBFILE,IENS)  Q
"RTN","RORPUT01",224,0)
 . . S IR="",DIK=$$ROOT^DILFD(SUBFILE,IENS),DA(1)=+REGIEN
"RTN","RORPUT01",225,0)
 . . F  S IR=$O(RORBUF("DILIST",2,IR))  Q:IR=""  D
"RTN","RORPUT01",226,0)
 . . . S DA=RORBUF("DILIST",2,IR)  D ^DIK
"RTN","RORPUT01",227,0)
 Q RC
"RTN","RORPUT01",228,0)
 ;
"RTN","RORPUT01",229,0)
 ;***** UPDATES (POPULATES) THE LOCAL REGISTRY
"RTN","RORPUT01",230,0)
 ;
"RTN","RORPUT01",231,0)
 ; [RORREG]      Registry IEN and registry name separated by the '^'
"RTN","RORPUT01",232,0)
 ;               (RegistryIEN^RegistryName).
"RTN","RORPUT01",233,0)
 ; [MAXNTSK]     Maximum number of registry update subtasks
"RTN","RORPUT01",234,0)
 ; [SUSPEND]     Suspend update (sub)tasks during the peak hours
"RTN","RORPUT01",235,0)
 ;               (StartTime^EndTime)
"RTN","RORPUT01",236,0)
 ;
"RTN","RORPUT01",237,0)
 ; If some of these parameters are omitted or equal to an empty
"RTN","RORPUT01",238,0)
 ; strings, their values must be defined as the RORPARM("KIDS")
"RTN","RORPUT01",239,0)
 ; sub-nodes of the same name.
"RTN","RORPUT01",240,0)
 ;
"RTN","RORPUT01",241,0)
 ; Return Values:
"RTN","RORPUT01",242,0)
 ;       <0  Error code
"RTN","RORPUT01",243,0)
 ;        0  Ok
"RTN","RORPUT01",244,0)
 ;
"RTN","RORPUT01",245,0)
UPDATE(RORREG,MAXNTSK,SUSPEND) ;
"RTN","RORPUT01",246,0)
 N EC,REGLST
"RTN","RORPUT01",247,0)
 D BMES^RORKIDS("Updating the local registry...")
"RTN","RORPUT01",248,0)
 ;--- Get the parameters
"RTN","RORPUT01",249,0)
 S:'$G(RORREG) RORREG=$$PARAM^RORKIDS("RORREG")
"RTN","RORPUT01",250,0)
 S:RORREG REGLST($P(RORREG,U,2))=+RORREG
"RTN","RORPUT01",251,0)
 S:$G(MAXNTSK)="" MAXNTSK=$$PARAM^RORKIDS("MAXNTSK")
"RTN","RORPUT01",252,0)
 S:$G(SUSPEND)="" SUSPEND=$$PARAM^RORKIDS("SUSPEND")
"RTN","RORPUT01",253,0)
 ;--- Update the registry
"RTN","RORPUT01",254,0)
 S RC=$$UPDATE^RORUPD(.REGLST,,MAXNTSK,SUSPEND)  Q:RC<0 RC
"RTN","RORPUT01",255,0)
 ;--- Success
"RTN","RORPUT01",256,0)
 D MES^RORKIDS("Registry update completed.")
"RTN","RORPUT01",257,0)
 Q 0
"RTN","RORPUT02")
0^220^B22713364
"RTN","RORPUT02",1,0)
RORPUT02 ;HCIOFO/SG - DATA TRANSPORT FOR KIDS ; 12/9/05 11:26am
"RTN","RORPUT02",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORPUT02",3,0)
 ;
"RTN","RORPUT02",4,0)
 Q
"RTN","RORPUT02",5,0)
 ;
"RTN","RORPUT02",6,0)
 ;***** LOADS 'ROR LIST ITEM' FILE (#799.1) INTO TRANSPORT GLOBAL
"RTN","RORPUT02",7,0)
LD7991() ;
"RTN","RORPUT02",8,0)
 N RORBUF,RORMSG,TMP
"RTN","RORPUT02",9,0)
 S TMP="@;.01;.02;.03;.04;1"
"RTN","RORPUT02",10,0)
 D LIST^DIC(799.1,,TMP,"KPQ",,,,,,,"RORBUF","RORMSG")
"RTN","RORPUT02",11,0)
 K RORBUF("DILIST",0)
"RTN","RORPUT02",12,0)
 M @XPDGREF@("ROR LIST ITEM")=RORBUF("DILIST")
"RTN","RORPUT02",13,0)
 Q
"RTN","RORPUT02",14,0)
 ;
"RTN","RORPUT02",15,0)
 ;***** LOADS 'ROR GENERIG DRUG' FILE (#799.51) INTO TRANSPORT GLOBAL
"RTN","RORPUT02",16,0)
LD79951() ;
"RTN","RORPUT02",17,0)
 N IR,RORBUF,RORMSG,TMP
"RTN","RORPUT02",18,0)
 S TMP="@;.01I;.02E;.03I;.04I;.04E;.09I"
"RTN","RORPUT02",19,0)
 D LIST^DIC(799.51,,TMP,"KPQ",,,,,,,"RORBUF","RORMSG")
"RTN","RORPUT02",20,0)
 K RORBUF("DILIST",0)
"RTN","RORPUT02",21,0)
 S IR=0
"RTN","RORPUT02",22,0)
 F  S IR=$O(RORBUF("DILIST",IR))  Q:IR'>0  D
"RTN","RORPUT02",23,0)
 . S TMP=+$P(RORBUF("DILIST",IR,0),U,4)
"RTN","RORPUT02",24,0)
 . S:TMP>0 $P(RORBUF("DILIST",IR,0),U,4)=$$ITEMCODE^RORUTL09(TMP)
"RTN","RORPUT02",25,0)
 M @XPDGREF@("ROR GENERIC DRUG")=RORBUF("DILIST")
"RTN","RORPUT02",26,0)
 Q
"RTN","RORPUT02",27,0)
 ;
"RTN","RORPUT02",28,0)
 ;**** LOADS PREDEFINED REPORT TEMPLATES INTO TRANSPORT GLOBAL
"RTN","RORPUT02",29,0)
LDPRT() ;
"RTN","RORPUT02",30,0)
 N IPRT,RORBUF,RORLST,TMP
"RTN","RORPUT02",31,0)
 D GETPLIST^RORRP038(.RORLST,"ROR REPORT PARAMS TEMPLATE")
"RTN","RORPUT02",32,0)
 S IPRT=0
"RTN","RORPUT02",33,0)
 F  S IPRT=$O(RORLST(IPRT))  Q:IPRT'>0  D
"RTN","RORPUT02",34,0)
 . Q:$P(RORLST(IPRT),U,2)'="CCR Predefined Report Template"
"RTN","RORPUT02",35,0)
 . S TMP=$P(RORLST(IPRT),U)_U_"ROR REPORT PARAMS TEMPLATE"
"RTN","RORPUT02",36,0)
 . D GETPARM^RORRP038(.RORBUF,TMP,"PKG")
"RTN","RORPUT02",37,0)
 . Q:$G(RORBUF(0))<0
"RTN","RORPUT02",38,0)
 . K RORBUF(0)  Q:$D(RORBUF)<10
"RTN","RORPUT02",39,0)
 . M @XPDGREF@("RORPRTDEF",IPRT)=RORBUF
"RTN","RORPUT02",40,0)
 . S @XPDGREF@("RORPRTDEF",IPRT)=$P(RORLST(IPRT),U)
"RTN","RORPUT02",41,0)
 Q
"RTN","RORPUT02",42,0)
 ;
"RTN","RORPUT02",43,0)
 ;***** RESTORES 'ROR LIST ITEM' FILE (#799.1) FROM TRANSPORT GLOBAL
"RTN","RORPUT02",44,0)
 ;
"RTN","RORPUT02",45,0)
 ; Return Values:
"RTN","RORPUT02",46,0)
 ;       <0  Error code
"RTN","RORPUT02",47,0)
 ;        0  Ok
"RTN","RORPUT02",48,0)
 ;
"RTN","RORPUT02",49,0)
RS7991() ;
"RTN","RORPUT02",50,0)
 N IENS,II,RC,RORBUF,RORFDA,RORMSG
"RTN","RORPUT02",51,0)
 S (II,RC)=0,IENS="?+1,"
"RTN","RORPUT02",52,0)
 F  S II=$O(@XPDGREF@("ROR LIST ITEM",II))  Q:II'>0  D  Q:RC<0
"RTN","RORPUT02",53,0)
 . S RORBUF=$G(@XPDGREF@("ROR LIST ITEM",II,0))  Q:RORBUF?."^"
"RTN","RORPUT02",54,0)
 . K RORFDA,RORMSG
"RTN","RORPUT02",55,0)
 . S RORFDA(799.1,IENS,.01)=$P(RORBUF,U,2) ; TEXT
"RTN","RORPUT02",56,0)
 . S RORFDA(799.1,IENS,.02)=$P(RORBUF,U,3) ; TYPE
"RTN","RORPUT02",57,0)
 . S RORFDA(799.1,IENS,.03)=$P(RORBUF,U,4) ; REGISTRY
"RTN","RORPUT02",58,0)
 . S RORFDA(799.1,IENS,.04)=$P(RORBUF,U,5) ; CODE
"RTN","RORPUT02",59,0)
 . S RORFDA(799.1,IENS,1)=$P(RORBUF,U,6)   ; DATE OF INACTIVATION
"RTN","RORPUT02",60,0)
 . D UPDATE^DIE("EK","RORFDA",,"RORMSG")
"RTN","RORPUT02",61,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,799.1,IENS)
"RTN","RORPUT02",62,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORPUT02",63,0)
 ;
"RTN","RORPUT02",64,0)
 ;***** RESTORES 'ROR GENERIG DRUG' FILE (#799.51) FROM TRANSP. GLOBAL
"RTN","RORPUT02",65,0)
 ;
"RTN","RORPUT02",66,0)
 ; Return Values:
"RTN","RORPUT02",67,0)
 ;       <0  Error code
"RTN","RORPUT02",68,0)
 ;        0  Ok
"RTN","RORPUT02",69,0)
 ;
"RTN","RORPUT02",70,0)
RS79951() ;
"RTN","RORPUT02",71,0)
 N ERRCNT,IENS,II,RC,REGIEN,RORBUF,RORFDA,RORMSG,TMP,VGIEN,VGNAME
"RTN","RORPUT02",72,0)
 D BMES^RORKIDS("Restoring the ROR GENERIC DRUG data...")
"RTN","RORPUT02",73,0)
 ;---
"RTN","RORPUT02",74,0)
 S (ERRCNT,II,RC)=0,IENS="?+1,"
"RTN","RORPUT02",75,0)
 F  S II=$O(@XPDGREF@("ROR GENERIC DRUG",II))  Q:II'>0  D  Q:RC<0
"RTN","RORPUT02",76,0)
 . S RORBUF=$G(@XPDGREF@("ROR GENERIC DRUG",II,0))  Q:RORBUF?."^"
"RTN","RORPUT02",77,0)
 . K RORFDA,RORMSG
"RTN","RORPUT02",78,0)
 . S RORFDA(799.51,IENS,.01)=$P(RORBUF,U,2)  ; NAME
"RTN","RORPUT02",79,0)
 . S RORFDA(799.51,IENS,.09)=$P(RORBUF,U,7)  ; NATIONAL
"RTN","RORPUT02",80,0)
 . ;---
"RTN","RORPUT02",81,0)
 . S REGIEN=$$REGIEN^RORUTL02($P(RORBUF,U,3))
"RTN","RORPUT02",82,0)
 . I REGIEN<0  S RC=REGIEN  Q
"RTN","RORPUT02",83,0)
 . S RORFDA(799.51,IENS,.02)=REGIEN          ; REGISTRY
"RTN","RORPUT02",84,0)
 . ;---
"RTN","RORPUT02",85,0)
 . S TMP=$$ITEMIEN^RORUTL09(4,REGIEN,$P(RORBUF,U,4))
"RTN","RORPUT02",86,0)
 . I TMP<0  S RC=TMP  Q
"RTN","RORPUT02",87,0)
 . S RORFDA(799.51,IENS,.03)=TMP             ; DRUG GROUP
"RTN","RORPUT02",88,0)
 . ;---
"RTN","RORPUT02",89,0)
 . S VGIEN=+$P(RORBUF,U,5),VGNAME=$$VAGN^PSNAPIS(VGIEN)
"RTN","RORPUT02",90,0)
 . I VGNAME'=$P(RORBUF,U,6)  D  Q
"RTN","RORPUT02",91,0)
 . . K TMP  S ERRCNT=ERRCNT+1
"RTN","RORPUT02",92,0)
 . . S TMP(1)="A record of the ROR GENERIC DRUG file (#799.51) has"
"RTN","RORPUT02",93,0)
 . . S TMP(2)="not been restored due to failed pointer resolution."
"RTN","RORPUT02",94,0)
 . . S TMP(3)="The corresponding entry #"_VGIEN_" of the VA GENERIC"
"RTN","RORPUT02",95,0)
 . . S TMP(4)="file (#50.6) has a different name or missing."
"RTN","RORPUT02",96,0)
 . . S TMP(5)="KIDS: "_$P(RORBUF,U,6)
"RTN","RORPUT02",97,0)
 . . S TMP(6)="Site: "_$S(VGNAME'="0":VGNAME,1:"Not Defined")
"RTN","RORPUT02",98,0)
 . . D ERROR^RORERR(-110,,.TMP)
"RTN","RORPUT02",99,0)
 . S RORFDA(799.51,IENS,.04)=VGIEN           ; VA GENERIC
"RTN","RORPUT02",100,0)
 . ;---
"RTN","RORPUT02",101,0)
 . D UPDATE^DIE("K","RORFDA",,"RORMSG")
"RTN","RORPUT02",102,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,799.1,IENS)
"RTN","RORPUT02",103,0)
 ;---
"RTN","RORPUT02",104,0)
 I 'ERRCNT  S TMP="successfully restored."
"RTN","RORPUT02",105,0)
 E  S TMP="restored with errors. See CCR logs for details."
"RTN","RORPUT02",106,0)
 D MES^RORKIDS("Data has been "_TMP)
"RTN","RORPUT02",107,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORPUT02",108,0)
 ;
"RTN","RORPUT02",109,0)
 ;***** RESTORES PREDEFINED REPORT TEMPLATES
"RTN","RORPUT02",110,0)
 ;
"RTN","RORPUT02",111,0)
 ; Return Values:
"RTN","RORPUT02",112,0)
 ;       <0  Error code
"RTN","RORPUT02",113,0)
 ;        0  Ok
"RTN","RORPUT02",114,0)
 ;
"RTN","RORPUT02",115,0)
RSPRT() ;
"RTN","RORPUT02",116,0)
 N IPRT,RC,RESULTS,RORBUF,TMP
"RTN","RORPUT02",117,0)
 D BMES^RORKIDS("Restoring predefined report templates...")
"RTN","RORPUT02",118,0)
 ;---
"RTN","RORPUT02",119,0)
 S (IPRT,RC)=0
"RTN","RORPUT02",120,0)
 F  S IPRT=$O(@XPDGREF@("RORPRTDEF",IPRT))  Q:IPRT'>0  D  Q:RC<0
"RTN","RORPUT02",121,0)
 . K RORBUF
"RTN","RORPUT02",122,0)
 . M RORBUF=@XPDGREF@("RORPRTDEF",IPRT)
"RTN","RORPUT02",123,0)
 . Q:$D(RORBUF)<10
"RTN","RORPUT02",124,0)
 . S TMP=$P(RORBUF,U)_U_"ROR REPORT PARAMS TEMPLATE"
"RTN","RORPUT02",125,0)
 . S RORBUF="CCR Predefined Report Template"
"RTN","RORPUT02",126,0)
 . D SETPARM^RORRP038(.RESULTS,TMP,"PKG",.RORBUF)
"RTN","RORPUT02",127,0)
 . S RC=+$G(RESULTS(0))
"RTN","RORPUT02",128,0)
 Q:RC<0 RC
"RTN","RORPUT02",129,0)
 ;---
"RTN","RORPUT02",130,0)
 D MES^RORKIDS("Templates have been restored successfully.")
"RTN","RORPUT02",131,0)
 Q 0
"RTN","RORREP01")
0^88^B47906972
"RTN","RORREP01",1,0)
RORREP01 ;HOIFO/BH - REGISTRY COMPARISON REPORT ; 12/21/05 11:55am
"RTN","RORREP01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORREP01",3,0)
 ;
"RTN","RORREP01",4,0)
 ;--------------------------------------------------------------------
"RTN","RORREP01",5,0)
 ; Registry: [VA HIV]
"RTN","RORREP01",6,0)
 ;--------------------------------------------------------------------
"RTN","RORREP01",7,0)
 ;
"RTN","RORREP01",8,0)
 Q
"RTN","RORREP01",9,0)
 ;
"RTN","RORREP01",10,0)
BEGIN ;
"RTN","RORREP01",11,0)
 I '$$VFILE^DILFD(158)  D  Q
"RTN","RORREP01",12,0)
 . W !,"ICR v2.1 is not installed in this account!",!
"RTN","RORREP01",13,0)
 I '$D(^XUSEC("IMRA",DUZ)) S IMRLOC="RORREP01" D ACESSERR^IMRERR,H^XUS K IMRLOC
"RTN","RORREP01",14,0)
 ;
"RTN","RORREP01",15,0)
 W !,?10,"####################################################"
"RTN","RORREP01",16,0)
 W !,?10,"#",?20,"Local ICR Version Comparison Report      #",?61
"RTN","RORREP01",17,0)
 W !,?10,"####################################################"
"RTN","RORREP01",18,0)
 ;
"RTN","RORREP01",19,0)
 ;
"RTN","RORREP01",20,0)
DEV D IMRDEV^IMREDIT
"RTN","RORREP01",21,0)
 G:POP KILL
"RTN","RORREP01",22,0)
 I '$D(IO("Q")) W @IOF D REP Q
"RTN","RORREP01",23,0)
 I $D(IO("Q")) D  G KILL
"RTN","RORREP01",24,0)
 . S ZTRTN="REP^RORREP01",ZTDESC="Local ICR Version Comparison Report"
"RTN","RORREP01",25,0)
 . S ZTSAVE("*")="",ZTIO=ION_";"_IOM_";"_IOSL
"RTN","RORREP01",26,0)
 . D ^%ZTLOAD K ZTRTN,ZTDESC,ZTSAVE,ZTSK
"RTN","RORREP01",27,0)
 . Q
"RTN","RORREP01",28,0)
 ;
"RTN","RORREP01",29,0)
REP ; Get Data
"RTN","RORREP01",30,0)
 U IO
"RTN","RORREP01",31,0)
 D EN1
"RTN","RORREP01",32,0)
 K CNT
"RTN","RORREP01",33,0)
 ;
"RTN","RORREP01",34,0)
 D PRNT^RORREP02
"RTN","RORREP01",35,0)
CLOSE D ^%ZISC K %ZIS,IOP
"RTN","RORREP01",36,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RORREP01",37,0)
 ;
"RTN","RORREP01",38,0)
 ;
"RTN","RORREP01",39,0)
KILL D ^%ZISC
"RTN","RORREP01",40,0)
 K ^TMP("RORREP01",$J)
"RTN","RORREP01",41,0)
 K DTOUT,VAROOT,VAERR,A,DIRUT,I,J,POP,X,X0,X1,Y,Z,D,IMRDTE,IMRFLG,IMRHED,IMRRPG,%I,DISYS,IMRPG
"RTN","RORREP01",42,0)
 D HOME^%ZIS
"RTN","RORREP01",43,0)
 Q
"RTN","RORREP01",44,0)
 ;
"RTN","RORREP01",45,0)
 ; ---------------------------------------------------------------------
"RTN","RORREP01",46,0)
EN1 ;
"RTN","RORREP01",47,0)
 K ^TMP("RORREP01",$J)
"RTN","RORREP01",48,0)
 S CNT=0
"RTN","RORREP01",49,0)
 D VTHREE
"RTN","RORREP01",50,0)
 D VTWO
"RTN","RORREP01",51,0)
 ;
"RTN","RORREP01",52,0)
 D INTWO
"RTN","RORREP01",53,0)
 D INTHREE
"RTN","RORREP01",54,0)
 Q
"RTN","RORREP01",55,0)
 ;
"RTN","RORREP01",56,0)
VTHREE ; Make array of version 3 patients 
"RTN","RORREP01",57,0)
 N ICN,IDSC,NAME,RC,PAT
"RTN","RORREP01",58,0)
 K VTHREE
"RTN","RORREP01",59,0)
 S RC=$$PATITER^RORAPI01(.IDSC,"VA HIV")
"RTN","RORREP01",60,0)
 I RC<0 Q
"RTN","RORREP01",61,0)
 F  S RC=$$NEXTPAT^RORAPI01(.IDSC)  Q:RC'>0  D
"RTN","RORREP01",62,0)
 . S PAT=+RC
"RTN","RORREP01",63,0)
 . S ^TMP("RORREP01",$J,"VTHREE",PAT)=""
"RTN","RORREP01",64,0)
 . S ICN=$$GETICN^MPIF001(PAT)
"RTN","RORREP01",65,0)
 . Q:$L(ICN)'=9
"RTN","RORREP01",66,0)
 . S NAME=$P(^DPT(PAT,0),"^",1)
"RTN","RORREP01",67,0)
 . S ^TMP("RORREP01",$J,"ICN",NAME,PAT)=""
"RTN","RORREP01",68,0)
 Q
"RTN","RORREP01",69,0)
 ;
"RTN","RORREP01",70,0)
 ;
"RTN","RORREP01",71,0)
VTWO ; Make array of version 2.1 patients
"RTN","RORREP01",72,0)
 N ENCODE,PAT,IMRIEN
"RTN","RORREP01",73,0)
 S IMRIEN=0
"RTN","RORREP01",74,0)
 F  S IMRIEN=$O(^IMR(158,IMRIEN)) Q:'IMRIEN  D
"RTN","RORREP01",75,0)
 . S ENCODE=$P(^IMR(158,IMRIEN,0),U)
"RTN","RORREP01",76,0)
 . I ENCODE="" D  Q
"RTN","RORREP01",77,0)
 . . S CNT=CNT+1
"RTN","RORREP01",78,0)
 . . S ^TMP("RORREP01",$J,"ERROR","ENCODE",CNT)="Entry "_IMRIEN_" in file #158 does not have .01 field." Q
"RTN","RORREP01",79,0)
 . S PAT=$$XOR^RORUTL03(ENCODE)
"RTN","RORREP01",80,0)
 . I PAT=0!(PAT="") D  Q
"RTN","RORREP01",81,0)
 . . S CNT=CNT+1
"RTN","RORREP01",82,0)
 . . S ^TMP("RORREP01",$J,"ERROR","ENCODE",CNT)="Could not decode .01 field "_ENCODE_" of file #158."
"RTN","RORREP01",83,0)
 . ;
"RTN","RORREP01",84,0)
 . I $D(^DPT(PAT,-9)) D  Q
"RTN","RORREP01",85,0)
 . . N NEWIEN
"RTN","RORREP01",86,0)
 . . S NEWIEN=^DPT(PAT,-9)
"RTN","RORREP01",87,0)
 . . I NEWIEN="" Q
"RTN","RORREP01",88,0)
 . . I $D(^TMP("RORREP01",$J,"PROC",NEWIEN)) Q
"RTN","RORREP01",89,0)
 . . S ^TMP("RORREP01",$J,"MERGE",NEWIEN)=ENCODE
"RTN","RORREP01",90,0)
 . ;
"RTN","RORREP01",91,0)
 . I $$GET1^DIQ(2,PAT,.01)="" D  Q
"RTN","RORREP01",92,0)
 . . S CNT=CNT+1
"RTN","RORREP01",93,0)
 . . S ^TMP("RORREP01",$J,"ERROR","ENCODE",CNT)="Could not get patient name from patient file IEN "_PAT Q
"RTN","RORREP01",94,0)
 . ;
"RTN","RORREP01",95,0)
 . D VTWO1(PAT,ENCODE)
"RTN","RORREP01",96,0)
 ;
"RTN","RORREP01",97,0)
 I $D(^TMP("RORREP01",$J,"MERGE")) D
"RTN","RORREP01",98,0)
 . N ENC,SUB4 S SUB4=0
"RTN","RORREP01",99,0)
 . F  S SUB4=$O(^TMP("RORREP01",$J,"MERGE",SUB4)) Q:SUB4=""  D
"RTN","RORREP01",100,0)
 . . S ENC=^TMP("RORREP01",$J,"MERGE",SUB4)
"RTN","RORREP01",101,0)
 . . D VTWO1(SUB4,ENC)
"RTN","RORREP01",102,0)
 ;
"RTN","RORREP01",103,0)
 K ^TMP("RORREP01",$J,"PROC"),^TMP("RORREP01",$J,"MERGE")
"RTN","RORREP01",104,0)
 Q
"RTN","RORREP01",105,0)
 ;
"RTN","RORREP01",106,0)
VTWO1(PAT,ENCODE) ;
"RTN","RORREP01",107,0)
 N ICN,SSN
"RTN","RORREP01",108,0)
 I $$GET1^DIQ(2,PAT,.01)="" D  Q
"RTN","RORREP01",109,0)
 . S CNT=CNT+1
"RTN","RORREP01",110,0)
 . S ^TMP("RORREP01",$J,"ERROR","ENCODE",CNT)="Could not get file #2 entry for entry "_ENCODE_" of file #158."
"RTN","RORREP01",111,0)
 ;
"RTN","RORREP01",112,0)
 S ^TMP("RORREP01",$J,"PROC",PAT)=""
"RTN","RORREP01",113,0)
 S ^TMP("RORREP01",$J,"VTWO",PAT)=ENCODE
"RTN","RORREP01",114,0)
 I PAT=7202138 W ENCODE_"***"
"RTN","RORREP01",115,0)
 S ICN=$$GETICN^MPIF001(PAT)
"RTN","RORREP01",116,0)
 Q:$L(ICN)'=9
"RTN","RORREP01",117,0)
 S NAME=$P(^DPT(PAT,0),"^",1)
"RTN","RORREP01",118,0)
 S SSN=$$GET1^DIQ(2,PAT,.09),SSN=$E(SSN,6,9)
"RTN","RORREP01",119,0)
 S ^TMP("RORREP01",$J,"ICN",NAME,PAT)=SSN
"RTN","RORREP01",120,0)
 Q
"RTN","RORREP01",121,0)
 ;
"RTN","RORREP01",122,0)
INTWO ; Patients in version 2.1 and not in three or in both
"RTN","RORREP01",123,0)
 N IEN,NAME,DATE21,RULE,SSN S IEN=0
"RTN","RORREP01",124,0)
 F  S IEN=$O(^TMP("RORREP01",$J,"VTWO",IEN)) Q:IEN=""  D
"RTN","RORREP01",125,0)
 . S NAME=$$GET1^DIQ(2,IEN,.01)
"RTN","RORREP01",126,0)
 . S SSN=$$GET1^DIQ(2,IEN,.09),SSN=$E(SSN,6,9)
"RTN","RORREP01",127,0)
 . S DATE21=$$DATE21(^TMP("RORREP01",$J,"VTWO",IEN))
"RTN","RORREP01",128,0)
 . I '$D(^TMP("RORREP01",$J,"VTHREE",IEN)) D  Q
"RTN","RORREP01",129,0)
 . . S ^TMP("RORREP01",$J,"INTWO",NAME)=DATE21_"^"_SSN
"RTN","RORREP01",130,0)
 . S RULE=$$RULE(IEN) I RULE=0 Q
"RTN","RORREP01",131,0)
 . S ^TMP("RORREP01",$J,"INBOTH",NAME)=RULE_"^"_DATE21_"^"_SSN
"RTN","RORREP01",132,0)
 Q
"RTN","RORREP01",133,0)
 ;
"RTN","RORREP01",134,0)
 ;
"RTN","RORREP01",135,0)
INTHREE ; Patients in version 3.0 and not in two OR in both
"RTN","RORREP01",136,0)
 N DATE21,RULE,IEN,PENDING,NAME,SSN S IEN=0
"RTN","RORREP01",137,0)
 F  S IEN=$O(^TMP("RORREP01",$J,"VTHREE",IEN)) Q:IEN=""  D
"RTN","RORREP01",138,0)
 . S NAME=$$GET1^DIQ(2,IEN,.01)
"RTN","RORREP01",139,0)
 . S SSN=$$GET1^DIQ(2,IEN,.09),SSN=$E(SSN,6,9)
"RTN","RORREP01",140,0)
 . I NAME="" S CNT=CNT+1,^TMP("RORREP01",$J,"ERROR","ROR",CNT)="Can't find Name from patient (#2) file IEN "_IEN_"." Q
"RTN","RORREP01",141,0)
 . ;
"RTN","RORREP01",142,0)
 . S RULE=$$RULE(IEN) I RULE=0 Q
"RTN","RORREP01",143,0)
 . I '$D(^TMP("RORREP01",$J,"VTWO",IEN)) D  Q
"RTN","RORREP01",144,0)
 . . S PENDING=$$PEND(IEN)
"RTN","RORREP01",145,0)
 . . S ^TMP("RORREP01",$J,"INTHREE",NAME)=RULE_"^"_PENDING_"^"_SSN
"RTN","RORREP01",146,0)
 . S DATE21=$$DATE21(^TMP("RORREP01",$J,"VTWO",IEN))
"RTN","RORREP01",147,0)
 . S ^TMP("RORREP01",$J,"INBOTH",NAME)=RULE_"^"_DATE21_"^"_SSN
"RTN","RORREP01",148,0)
 Q
"RTN","RORREP01",149,0)
 ;
"RTN","RORREP01",150,0)
 ;
"RTN","RORREP01",151,0)
DATE21(ENCODE) ; Get date added to ICR 2.1
"RTN","RORREP01",152,0)
 N IMRCAT1,IMRCAT2,IMRCAT3,IMRCAT4,IMRNODE,IMRIEN,IMRDTE,IMRARR
"RTN","RORREP01",153,0)
 S IMRIEN=0
"RTN","RORREP01",154,0)
 S IMRIEN=$O(^IMR(158,"B",ENCODE,IMRIEN))
"RTN","RORREP01",155,0)
 S IMRNODE=^IMR(158,IMRIEN,0)
"RTN","RORREP01",156,0)
 S IMRCAT1=$P(IMRNODE,"^",36) I IMRCAT1'="" S IMRARR(IMRCAT1)=""
"RTN","RORREP01",157,0)
 S IMRCAT2=$P(IMRNODE,"^",44) I IMRCAT2'="" S IMRARR(IMRCAT2)=""
"RTN","RORREP01",158,0)
 S IMRCAT3=$P(IMRNODE,"^",35) I IMRCAT3'="" S IMRARR(IMRCAT3)=""
"RTN","RORREP01",159,0)
 S IMRCAT4=$P(IMRNODE,"^",23) I IMRCAT4'="" S IMRARR(IMRCAT4)=""
"RTN","RORREP01",160,0)
 I '$D(IMRARR) Q "No Cat. Date"
"RTN","RORREP01",161,0)
 S IMRDTE=""
"RTN","RORREP01",162,0)
 S IMRDTE=$O(IMRARR(IMRDTE))
"RTN","RORREP01",163,0)
 S Y=IMRDTE D DD^%DT S IMRDTE=Y
"RTN","RORREP01",164,0)
 Q IMRDTE
"RTN","RORREP01",165,0)
 ;
"RTN","RORREP01",166,0)
 ;
"RTN","RORREP01",167,0)
PEND(IEN) ;
"RTN","RORREP01",168,0)
 N RORIEN,PEND
"RTN","RORREP01",169,0)
 S RORIEN="",PEND="YES"
"RTN","RORREP01",170,0)
 S RORIEN=$O(^RORDATA(798,"KEY",IEN,2,RORIEN))
"RTN","RORREP01",171,0)
 S RES=$P(^RORDATA(798,RORIEN,0),"^",5)
"RTN","RORREP01",172,0)
 I RES'=4 S PEND="NO"
"RTN","RORREP01",173,0)
 Q PEND
"RTN","RORREP01",174,0)
 ;
"RTN","RORREP01",175,0)
 ;
"RTN","RORREP01",176,0)
RULE(IEN) ; Get earliest selction rule 
"RTN","RORREP01",177,0)
 N RORIEN
"RTN","RORREP01",178,0)
 S RORIEN=""
"RTN","RORREP01",179,0)
 S RORIEN=$O(^RORDATA(798,"KEY",IEN,2,RORIEN))
"RTN","RORREP01",180,0)
 I 'RORIEN D  Q 0
"RTN","RORREP01",181,0)
 . S CNT=CNT+1
"RTN","RORREP01",182,0)
 . S ^TMP("RORREP01",$J,"ERROR","ROR",CNT)="Can't find IEN of file #798 record that has a #.01 field of "_IEN_"." Q
"RTN","RORREP01",183,0)
 ;
"RTN","RORREP01",184,0)
 N RULE1,DATE1,SELARR,RORSRIEN,SELDATE,DATA,RULE
"RTN","RORREP01",185,0)
 S RORSRIEN=0
"RTN","RORREP01",186,0)
 F  S RORSRIEN=$O(^RORDATA(798,RORIEN,1,RORSRIEN)) Q:'RORSRIEN  D
"RTN","RORREP01",187,0)
 . S DATA=^RORDATA(798,RORIEN,1,RORSRIEN,0)
"RTN","RORREP01",188,0)
 . S RULE=$P(DATA,"^",1)
"RTN","RORREP01",189,0)
 . S RULE=$$GET1^DIQ(798.2,RULE,.01,"E")
"RTN","RORREP01",190,0)
 . S SELDATE=$P(DATA,"^",2)
"RTN","RORREP01",191,0)
 . S SELARR(SELDATE)=RULE
"RTN","RORREP01",192,0)
 ;
"RTN","RORREP01",193,0)
 I '$D(SELARR) D  Q 0
"RTN","RORREP01",194,0)
 . S CNT=CNT+1
"RTN","RORREP01",195,0)
 . N BUFF,EVID,NME
"RTN","RORREP01",196,0)
 . S NME=$$GET1^DIQ(798,RORIEN,.01,"E")
"RTN","RORREP01",197,0)
 . ;
"RTN","RORREP01",198,0)
 . S EVID=$P(^RORDATA(798,RORIEN,0),U,14)
"RTN","RORREP01",199,0)
 . I 'EVID D
"RTN","RORREP01",200,0)
 . . S BUFF=NME_" is in ROR Local Registry file (#798) but has no selection rules."
"RTN","RORREP01",201,0)
 . . S ^TMP("RORREP01",$J,"ERROR",IEN)=BUFF
"RTN","RORREP01",202,0)
 . I EVID D
"RTN","RORREP01",203,0)
 . . S ^TMP("RORREP01",$J,"ISSUE","EVID",IEN)=NME
"RTN","RORREP01",204,0)
 S DATE1="" S DATE1=$O(SELARR(DATE1))
"RTN","RORREP01",205,0)
 S RULE1=SELARR(DATE1)
"RTN","RORREP01",206,0)
 S Y=DATE1 D DD^%DT S DATE1=Y
"RTN","RORREP01",207,0)
 Q DATE1_"^"_RULE1
"RTN","RORREP01",208,0)
 ;
"RTN","RORREP01",209,0)
 ;
"RTN","RORREP02")
0^89^B52937868
"RTN","RORREP02",1,0)
RORREP02 ;HCIOFO/BH - VERSION COMPARISON REPORT (ICR) ; 7/11/03 1:22pm
"RTN","RORREP02",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORREP02",3,0)
 ;
"RTN","RORREP02",4,0)
 ;--------------------------------------------------------------------
"RTN","RORREP02",5,0)
 ; Registry: [VA HIV]
"RTN","RORREP02",6,0)
 ;--------------------------------------------------------------------
"RTN","RORREP02",7,0)
 ;
"RTN","RORREP02",8,0)
PRNT ;
"RTN","RORREP02",9,0)
 N THREEH
"RTN","RORREP02",10,0)
 S THREEH=1
"RTN","RORREP02",11,0)
 D NOW^%DTC S IMRDTE=%,IMRPG="0"
"RTN","RORREP02",12,0)
 K IMRDONE
"RTN","RORREP02",13,0)
 S Y=IMRDTE D DD^%DT S IMRDTE=Y
"RTN","RORREP02",14,0)
 D LIST("INTWO","Patients in ICR 2.1 and not in ROR:ICR")
"RTN","RORREP02",15,0)
 Q:$D(IMRDONE)
"RTN","RORREP02",16,0)
 D LIST("INTHREE","Patients in ROR:ICR and not in ICR 2.1")
"RTN","RORREP02",17,0)
 Q:$D(IMRDONE)
"RTN","RORREP02",18,0)
 D LIST("INBOTH","Patients in ROR:ICR and in ICR 2.1")
"RTN","RORREP02",19,0)
 Q:$D(IMRDONE)
"RTN","RORREP02",20,0)
 D LEGEND
"RTN","RORREP02",21,0)
 Q:$D(IMRDONE)
"RTN","RORREP02",22,0)
 D ISSUE
"RTN","RORREP02",23,0)
 Q:$D(IMRDONE)
"RTN","RORREP02",24,0)
 D ERROR
"RTN","RORREP02",25,0)
 Q:$D(IMRDONE)
"RTN","RORREP02",26,0)
 D ICNERR
"RTN","RORREP02",27,0)
 K IMRDONE,TMP
"RTN","RORREP02",28,0)
 Q
"RTN","RORREP02",29,0)
 ;
"RTN","RORREP02",30,0)
HEDR ; Header of Report
"RTN","RORREP02",31,0)
 S X="ICR Version Comparison Report"
"RTN","RORREP02",32,0)
 W:$Y>0 @IOF S IMRPG=IMRPG+1
"RTN","RORREP02",33,0)
 W IMRDTE,?72,"Page ",IMRPG,!
"RTN","RORREP02",34,0)
 W !," ",X,!
"RTN","RORREP02",35,0)
 W " ",IMRHED
"RTN","RORREP02",36,0)
 W !!
"RTN","RORREP02",37,0)
 I TYPE="INTWO" D
"RTN","RORREP02",38,0)
 . W "                           Last  Earliest Cat.",!
"RTN","RORREP02",39,0)
 . W "Patient                    Four  Date (v 2.1)",!
"RTN","RORREP02",40,0)
 . W "-------                    ----  -------------",!
"RTN","RORREP02",41,0)
 ;
"RTN","RORREP02",42,0)
 I TYPE="INTHREE" D
"RTN","RORREP02",43,0)
 . I THREEH D
"RTN","RORREP02",44,0)
 . . ;
"RTN","RORREP02",45,0)
 . . W " ** Some of these patients are in a Pending state and need to be either      **"
"RTN","RORREP02",46,0)
 . . W !," ** validated into the ICR registry or deleted via the ICR GUI.  Individual  **"
"RTN","RORREP02",47,0)
 . . W !," ** patient data for pending patients will not be sent to AAC until they are **"
"RTN","RORREP02",48,0)
 . . W !," ** validated into the registry.                                             **"
"RTN","RORREP02",49,0)
 . . W !!
"RTN","RORREP02",50,0)
 . . ;
"RTN","RORREP02",51,0)
 . . S THREEH=0
"RTN","RORREP02",52,0)
 . W "Patient                    Last Earliest Sel.     Location Selection",!
"RTN","RORREP02",53,0)
 . W "                           Four Rule (ROR:ICR)    Rule Found (ROR:ICR)  Pending",!
"RTN","RORREP02",54,0)
 . W "-------                    ---- --------------    --------------------  -------",!
"RTN","RORREP02",55,0)
 .
"RTN","RORREP02",56,0)
 ;
"RTN","RORREP02",57,0)
 I TYPE="INBOTH" D
"RTN","RORREP02",58,0)
 . W "                         Last Earliest Sel.  Location Selection    Earliest Cat.",!
"RTN","RORREP02",59,0)
 . W "Patient                  Four Rule (ROR:ICR) Rule Found (ROR:ICR)  Date (v 2.1)",!
"RTN","RORREP02",60,0)
 . W "-------                  ---- -------------- --------------------- -------------",!
"RTN","RORREP02",61,0)
 Q
"RTN","RORREP02",62,0)
 ;
"RTN","RORREP02",63,0)
EHEAD ;
"RTN","RORREP02",64,0)
 S X="ICR Version Comparison Report"
"RTN","RORREP02",65,0)
 W:$Y>0 @IOF S IMRPG=IMRPG+1
"RTN","RORREP02",66,0)
 W !,IMRDTE,?72,"Page ",IMRPG,!
"RTN","RORREP02",67,0)
 W !,"  Patients with Errors.",!!
"RTN","RORREP02",68,0)
 W " -----------------------",!!
"RTN","RORREP02",69,0)
 ;
"RTN","RORREP02",70,0)
 Q
"RTN","RORREP02",71,0)
 ;
"RTN","RORREP02",72,0)
ENDHEAD ;
"RTN","RORREP02",73,0)
 S X="ICR Version Comparison Report"
"RTN","RORREP02",74,0)
 W:$Y>0 @IOF S IMRPG=IMRPG+1
"RTN","RORREP02",75,0)
 W IMRDTE,?72,"Page ",IMRPG,!
"RTN","RORREP02",76,0)
 W !," ",X,!!
"RTN","RORREP02",77,0)
 ;
"RTN","RORREP02",78,0)
 W !," Legend.",!
"RTN","RORREP02",79,0)
 W " -------",!!
"RTN","RORREP02",80,0)
 W " Code                      Description",!
"RTN","RORREP02",81,0)
 W " ----                      -----------"
"RTN","RORREP02",82,0)
 Q
"RTN","RORREP02",83,0)
 ;
"RTN","RORREP02",84,0)
EVID ;  Heading for patients with no selection rules but with supporting
"RTN","RORREP02",85,0)
 ;  Evidence.
"RTN","RORREP02",86,0)
 S X="ICR Version Comparison Report"
"RTN","RORREP02",87,0)
 W:$Y>0 @IOF S IMRPG=IMRPG+1
"RTN","RORREP02",88,0)
 W IMRDTE,?72,"Page ",IMRPG,!
"RTN","RORREP02",89,0)
 W !," ",X,!
"RTN","RORREP02",90,0)
 W !,"** The following patient(s) are in the ROR Local Registry file (#798) but    **"
"RTN","RORREP02",91,0)
 W !,"** have no selection rules but do have supporting evidence for being         **"
"RTN","RORREP02",92,0)
 W !,"** manually added to the Registry.  Please consider adding HIV disease (042) **"
"RTN","RORREP02",93,0)
 W !,"** to the patient's problem list.                                            **",!
"RTN","RORREP02",94,0)
 Q
"RTN","RORREP02",95,0)
 ;
"RTN","RORREP02",96,0)
ICNHEAD ;
"RTN","RORREP02",97,0)
 S X="ICR Version Comparison Report"
"RTN","RORREP02",98,0)
 W:$Y>0 @IOF S IMRPG=IMRPG+1
"RTN","RORREP02",99,0)
 W IMRDTE,?72,"Page ",IMRPG,!
"RTN","RORREP02",100,0)
 W !," ",X,!!
"RTN","RORREP02",101,0)
 ;
"RTN","RORREP02",102,0)
 W "** The following Patients have local ICN's (Intergration Control Numbers)   **"
"RTN","RORREP02",103,0)
 W !,"** and will not have data extracted and transmitted to the national ICR     **"
"RTN","RORREP02",104,0)
 W !,"** database.  Since your facility's VERA reimbursement is calculated from   **"
"RTN","RORREP02",105,0)
 W !,"** the National database, it is important that these patient records be     **"
"RTN","RORREP02",106,0)
 W !,"** updated by the sites IRM with National ICNs.                             **"
"RTN","RORREP02",107,0)
 W !!
"RTN","RORREP02",108,0)
 W " Name                       Last Four",!
"RTN","RORREP02",109,0)
 W " ----                       ---------"
"RTN","RORREP02",110,0)
 Q
"RTN","RORREP02",111,0)
 ;
"RTN","RORREP02",112,0)
 ;
"RTN","RORREP02",113,0)
LIST(TYPE,IMRHED) ; List patients missing data values
"RTN","RORREP02",114,0)
 D HEDR
"RTN","RORREP02",115,0)
 I '$D(^TMP("RORREP01",$J,TYPE)) D  Q
"RTN","RORREP02",116,0)
 . W !!,"No patients found." D PRTC Q:$D(IMRDONE)
"RTN","RORREP02",117,0)
 N NAME,DTE2,NEWNAME,TWOLOC,TWODATE,LOC3,LOC4,DATE3,BOTHLOC,BOTHDTE,DTE3,DATA,SSN
"RTN","RORREP02",118,0)
 N RORTOTAL
"RTN","RORREP02",119,0)
 Q:$D(IMRDONE)
"RTN","RORREP02",120,0)
 S (NAME,RORTOTAL)=0
"RTN","RORREP02",121,0)
 F  S NAME=$O(^TMP("RORREP01",$J,TYPE,NAME)) Q:NAME=""  D  Q:$D(IMRDONE)
"RTN","RORREP02",122,0)
 . I ($Y+4>IOSL) D PRTC Q:$D(IMRDONE)  D HEDR
"RTN","RORREP02",123,0)
 . S DATA=^TMP("RORREP01",$J,TYPE,NAME)
"RTN","RORREP02",124,0)
 . S NEWNAME=$E(NAME_"                         ",1,27)
"RTN","RORREP02",125,0)
 . I TYPE="INTWO" D
"RTN","RORREP02",126,0)
 . . S SSN=$P(DATA,"^",2)
"RTN","RORREP02",127,0)
 . . S DATA=$P(DATA,"^",1)
"RTN","RORREP02",128,0)
 . . W !,NEWNAME_SSN_"  "_DATA
"RTN","RORREP02",129,0)
 . . S RORTOTAL=RORTOTAL+1
"RTN","RORREP02",130,0)
 . ;
"RTN","RORREP02",131,0)
 . I TYPE="INTHREE" D
"RTN","RORREP02",132,0)
 . . S SSN=$P(DATA,"^",4)
"RTN","RORREP02",133,0)
 . . S DATE3=$P(DATA,"^",1),DATE3=$E(DATE3_"                  ",1,18)
"RTN","RORREP02",134,0)
 . . S LOC3=$P(DATA,"^",2),LOC3=$E(LOC3_"                         ",1,25)
"RTN","RORREP02",135,0)
 . . S LOC4=$P(DATA,"^",3)
"RTN","RORREP02",136,0)
 . . W !,NEWNAME_SSN_" "_DATE3_LOC3_LOC4
"RTN","RORREP02",137,0)
 . . S RORTOTAL=RORTOTAL+1
"RTN","RORREP02",138,0)
 . ;
"RTN","RORREP02",139,0)
 . I TYPE="INBOTH" D
"RTN","RORREP02",140,0)
 . . S SSN=$P(DATA,"^",4)
"RTN","RORREP02",141,0)
 . . S NEWNAME=$E(NEWNAME,1,25)
"RTN","RORREP02",142,0)
 . . S BOTHDTE=$P(DATA,"^",1),BOTHDTE=$E(BOTHDTE_"                  ",1,15)
"RTN","RORREP02",143,0)
 . . S BOTHLOC=$P(DATA,"^",2),BOTHLOC=$E(BOTHLOC_"                         ",1,22)
"RTN","RORREP02",144,0)
 . . S DTE2=$P(DATA,"^",3)
"RTN","RORREP02",145,0)
 . . W !,NEWNAME_SSN_" "_BOTHDTE_BOTHLOC_DTE2
"RTN","RORREP02",146,0)
 . . S RORTOTAL=RORTOTAL+1
"RTN","RORREP02",147,0)
 ;
"RTN","RORREP02",148,0)
 I ($Y+4>IOSL) D PRTC Q:$D(IMRDONE)  D HEDR
"RTN","RORREP02",149,0)
 W !,"Total Patients: "_RORTOTAL
"RTN","RORREP02",150,0)
 ;
"RTN","RORREP02",151,0)
 D PRTC
"RTN","RORREP02",152,0)
 Q
"RTN","RORREP02",153,0)
 ;
"RTN","RORREP02",154,0)
 ;
"RTN","RORREP02",155,0)
LEGEND ;
"RTN","RORREP02",156,0)
 D ENDHEAD
"RTN","RORREP02",157,0)
 W !
"RTN","RORREP02",158,0)
 W !," VA HIV 2.1 CONVERSION     Converted from ICR 2.1"
"RTN","RORREP02",159,0)
 W !," VA HIV LAB                ICR Lab Results"
"RTN","RORREP02",160,0)
 W !," VA HIV PROBLEM            ICR ICD-9 in the Problem List"
"RTN","RORREP02",161,0)
 W !," VA HIV PTF                ICR ICD-9 in the Inpatient File (PTF)"
"RTN","RORREP02",162,0)
 W !," VA HIV VPOV               ICR ICD-9 in the Outpatient File (V POV)"
"RTN","RORREP02",163,0)
 D PRTC
"RTN","RORREP02",164,0)
 Q
"RTN","RORREP02",165,0)
 ;
"RTN","RORREP02",166,0)
ICNERR ;
"RTN","RORREP02",167,0)
 I '$D(^TMP("RORREP01",$J,"ICN")) Q
"RTN","RORREP02",168,0)
 D ICNHEAD
"RTN","RORREP02",169,0)
 N DFN,NAME,SSN
"RTN","RORREP02",170,0)
 S NAME=""
"RTN","RORREP02",171,0)
 F  S NAME=$O(^TMP("RORREP01",$J,"ICN",NAME)) Q:NAME=""  D
"RTN","RORREP02",172,0)
 . S DFN=""
"RTN","RORREP02",173,0)
 . F  S DFN=$O(^TMP("RORREP01",$J,"ICN",NAME,DFN)) Q:'DFN  D
"RTN","RORREP02",174,0)
 . . I ($Y+4>IOSL) D PRTC Q:$D(IMRDONE)  D ICNHEAD
"RTN","RORREP02",175,0)
 . . S SSN=^TMP("RORREP01",$J,"ICN",NAME,DFN)
"RTN","RORREP02",176,0)
 . . W !," ",$E(NAME_"                           ",1,27)_SSN
"RTN","RORREP02",177,0)
 Q
"RTN","RORREP02",178,0)
 ;
"RTN","RORREP02",179,0)
ISSUE ;
"RTN","RORREP02",180,0)
 I '$D(^TMP("RORREP01",$J,"ISSUE","EVID")) Q
"RTN","RORREP02",181,0)
 D EVID
"RTN","RORREP02",182,0)
 N EIEN,NME S EIEN=0
"RTN","RORREP02",183,0)
 F  S EIEN=$O(^TMP("RORREP01",$J,"ISSUE","EVID",EIEN)) Q:'EIEN  D 
"RTN","RORREP02",184,0)
 . I ($Y+4>IOSL) D PRTC Q:$D(IMRDONE)  D EVID
"RTN","RORREP02",185,0)
 . S NME=^TMP("RORREP01",$J,"ISSUE","EVID",EIEN)
"RTN","RORREP02",186,0)
 . W !,NME
"RTN","RORREP02",187,0)
 D PRTC
"RTN","RORREP02",188,0)
 Q
"RTN","RORREP02",189,0)
 ;
"RTN","RORREP02",190,0)
ERROR ;
"RTN","RORREP02",191,0)
 I '$D(^TMP("RORREP01",$J,"ERROR")) Q
"RTN","RORREP02",192,0)
 D EHEAD
"RTN","RORREP02",193,0)
 N CNT,EIEN,BUF,BUF1,BUFP  S EIEN=0
"RTN","RORREP02",194,0)
 F  S EIEN=$O(^TMP("RORREP01",$J,"ERROR",EIEN)) Q:'EIEN  D
"RTN","RORREP02",195,0)
 . I ($Y+4>IOSL) D PRTC Q:$D(IMRDONE)  D EHEAD
"RTN","RORREP02",196,0)
 . S BUFP=^TMP("RORREP01",$J,"ERROR",EIEN)
"RTN","RORREP02",197,0)
 . S BUF=$E(BUFP,1,78),BUF1=$E(BUFP,79,150)
"RTN","RORREP02",198,0)
 . W BUF I BUF1'="" W "-"
"RTN","RORREP02",199,0)
 . W !
"RTN","RORREP02",200,0)
 . W BUF1,!
"RTN","RORREP02",201,0)
 . I BUF1'="" W !
"RTN","RORREP02",202,0)
 ;
"RTN","RORREP02",203,0)
 F TMP="ROR","ENCODE"  D
"RTN","RORREP02",204,0)
 . S CNT=0
"RTN","RORREP02",205,0)
 . F  S CNT=$O(^TMP("RORREP01",$J,"ERROR",TMP,CNT)) Q:'CNT  D
"RTN","RORREP02",206,0)
 . . I ($Y+4>IOSL) D PRTC Q:$D(IMRDONE)  D EHEAD
"RTN","RORREP02",207,0)
 . . S BUFP=^TMP("RORREP01",$J,"ERROR",TMP,CNT)
"RTN","RORREP02",208,0)
 . . S BUF=$E(BUFP,1,78),BUF1=$E(BUFP,79,150)
"RTN","RORREP02",209,0)
 . . W BUF I BUF1'="" W "-"
"RTN","RORREP02",210,0)
 . . W !
"RTN","RORREP02",211,0)
 . . W BUF1,!
"RTN","RORREP02",212,0)
 . . I BUF1'="" W !
"RTN","RORREP02",213,0)
 D PRTC
"RTN","RORREP02",214,0)
 Q
"RTN","RORREP02",215,0)
 ;
"RTN","RORREP02",216,0)
 ;
"RTN","RORREP02",217,0)
PRTC ;press return to continue prompt
"RTN","RORREP02",218,0)
 Q:$E(IOST,1,2)'="C-"!($D(IO("S")))
"RTN","RORREP02",219,0)
 K DIR W ! S DIR(0)="E" D ^DIR K DIR I 'Y S IMRDONE=1
"RTN","RORREP02",220,0)
 Q
"RTN","RORRP007")
0^90^B34852551
"RTN","RORRP007",1,0)
RORRP007 ;HCIOFO/SG - RPC: LOGS & MESSAGES ; 11/4/05 8:56am
"RTN","RORRP007",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP007",3,0)
 ;
"RTN","RORRP007",4,0)
 Q
"RTN","RORRP007",5,0)
 ;
"RTN","RORRP007",6,0)
 ;***** LOADS THE LOG INFORMATION INTO THE BUFFER
"RTN","RORRP007",7,0)
 ;
"RTN","RORRP007",8,0)
 ; IEN           Log IEN
"RTN","RORRP007",9,0)
 ;
"RTN","RORRP007",10,0)
 ; ROR8DST       Closed root of the destination buffer
"RTN","RORRP007",11,0)
 ;
"RTN","RORRP007",12,0)
 ; [[.]OFFSET]   Offset in the buffer (modified by the function
"RTN","RORRP007",13,0)
 ;               if passed by reference)
"RTN","RORRP007",14,0)
 ;
"RTN","RORRP007",15,0)
 ; Return Values:
"RTN","RORRP007",16,0)
 ;       <0  Error code
"RTN","RORRP007",17,0)
 ;        0  Ok
"RTN","RORRP007",18,0)
 ;       >0  Skip the log
"RTN","RORRP007",19,0)
 ;
"RTN","RORRP007",20,0)
LOAD(IEN,ROR8DST,OFFSET) ;
"RTN","RORRP007",21,0)
 N BUF,IENS,IENS1,RORBUF,RORMSG
"RTN","RORRP007",22,0)
 S IENS=IEN_","  K RORBUF
"RTN","RORRP007",23,0)
 D GETS^DIQ(798.7,IENS,RORFLDS,"EI","RORBUF","RORMSG")
"RTN","RORRP007",24,0)
 Q:$G(DIERR) 1
"RTN","RORRP007",25,0)
 ;--- Skip the 'Access Violation' activities
"RTN","RORRP007",26,0)
 Q:$G(RORBUF(798.7,IENS,1,"I"))=6 2
"RTN","RORRP007",27,0)
 S BUF="L^"_IEN
"RTN","RORRP007",28,0)
 ;--- Activity (external)
"RTN","RORRP007",29,0)
 S $P(BUF,"^",3)=$G(RORBUF(798.7,IENS,1,"E"))
"RTN","RORRP007",30,0)
 ;--- Activity (internal)
"RTN","RORRP007",31,0)
 S $P(BUF,"^",4)=$G(RORBUF(798.7,IENS,1,"I"))
"RTN","RORRP007",32,0)
 ;--- Start Date/Time
"RTN","RORRP007",33,0)
 S $P(BUF,"^",5)=$G(RORBUF(798.7,IENS,.01,"E"))
"RTN","RORRP007",34,0)
 ;--- Contains messages
"RTN","RORRP007",35,0)
 S $P(BUF,"^",6)=($O(^RORDATA(798.7,IEN,2,0))>0)
"RTN","RORRP007",36,0)
 ;--- Job Number
"RTN","RORRP007",37,0)
 S $P(BUF,"^",7)=$G(RORBUF(798.7,IENS,2,"E"))
"RTN","RORRP007",38,0)
 ;--- End Date/Time
"RTN","RORRP007",39,0)
 S $P(BUF,"^",8)=$G(RORBUF(798.7,IENS,5,"E"))
"RTN","RORRP007",40,0)
 ;--- Number of Processed Patients
"RTN","RORRP007",41,0)
 S $P(BUF,"^",9)=$G(RORBUF(798.7,IENS,6.01,"E"))
"RTN","RORRP007",42,0)
 ;--- Number of Patients with Errors
"RTN","RORRP007",43,0)
 S $P(BUF,"^",10)=$G(RORBUF(798.7,IENS,6.02,"E"))
"RTN","RORRP007",44,0)
 ;--- Processing Rate
"RTN","RORRP007",45,0)
 S $P(BUF,"^",11)=$G(RORBUF(798.7,IENS,6.03,"E"))
"RTN","RORRP007",46,0)
 ;--- Task Number
"RTN","RORRP007",47,0)
 S $P(BUF,"^",12)=$G(RORBUF(798.7,IENS,8,"I"))
"RTN","RORRP007",48,0)
 ;--- Add the log descriptor to the output
"RTN","RORRP007",49,0)
 S OFFSET=$G(OFFSET)+1,@ROR8DST@(OFFSET)=BUF
"RTN","RORRP007",50,0)
 ;--- Load the list of registries
"RTN","RORRP007",51,0)
 S IENS1=""
"RTN","RORRP007",52,0)
 F  S IENS1=$O(RORBUF(798.73,IENS1))  Q:IENS1=""  D
"RTN","RORRP007",53,0)
 . S BUF="R^"_$G(RORBUF(798.73,IENS1,.01,"I"))
"RTN","RORRP007",54,0)
 . S $P(BUF,"^",3)=$G(RORBUF(798.73,IENS1,.01,"E"))
"RTN","RORRP007",55,0)
 . ;--- Add the registry descriptor to the output
"RTN","RORRP007",56,0)
 . S OFFSET=OFFSET+1,@ROR8DST@(OFFSET)=BUF
"RTN","RORRP007",57,0)
 ;---Add the 'End of log' marker
"RTN","RORRP007",58,0)
 S OFFSET=OFFSET+1,@ROR8DST@(OFFSET)="L^END"
"RTN","RORRP007",59,0)
 Q 0
"RTN","RORRP007",60,0)
 ;
"RTN","RORRP007",61,0)
 ;***** RETURNS THE LOG INFORMATION
"RTN","RORRP007",62,0)
 ; RPC: [ROR LOG INFO]
"RTN","RORRP007",63,0)
 ;
"RTN","RORRP007",64,0)
 ; .RORRES       Reference to a local variable where the results
"RTN","RORRP007",65,0)
 ;               are returned to.
"RTN","RORRP007",66,0)
 ;
"RTN","RORRP007",67,0)
 ; LOGIEN        Log IEN
"RTN","RORRP007",68,0)
 ;
"RTN","RORRP007",69,0)
 ; Return Values:
"RTN","RORRP007",70,0)
 ;
"RTN","RORRP007",71,0)
 ; A negative value of the first "^"-piece of the RORRES(0) indicates
"RTN","RORRP007",72,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP007",73,0)
 ;
"RTN","RORRP007",74,0)
 ; Otherwise, either 0 (the log does not exist) or 1 is returned
"RTN","RORRP007",75,0)
 ; in the RORRES(0) and the subsequent nodes of the RORRES array
"RTN","RORRP007",76,0)
 ; contain the log information.
"RTN","RORRP007",77,0)
 ; 
"RTN","RORRP007",78,0)
 ; RORRES(0)             0 or 1
"RTN","RORRP007",79,0)
 ;
"RTN","RORRP007",80,0)
 ; RORRES(i)             See description of the LOGLIST^RORRP007
"RTN","RORRP007",81,0)
 ;
"RTN","RORRP007",82,0)
LOGINFO(RORRES,LOGIEN) ;
"RTN","RORRP007",83,0)
 N RC,RORFLDS
"RTN","RORRP007",84,0)
 ;--- Initialize the variables
"RTN","RORRP007",85,0)
 K RORRES  S RORRES(0)=0
"RTN","RORRP007",86,0)
 S RORFLDS=".01;1;2;3*;5;6.01;6.02;6.03;8"
"RTN","RORRP007",87,0)
 ;--- Check the parameters
"RTN","RORRP007",88,0)
 S LOGIEN=+$G(LOGIEN)  Q:LOGIEN'>0
"RTN","RORRP007",89,0)
 Q:'$D(^RORDATA(798.7,LOGIEN,0))
"RTN","RORRP007",90,0)
 ;--- Load the log information
"RTN","RORRP007",91,0)
 S RC=$$LOAD(LOGIEN,"RORRES")
"RTN","RORRP007",92,0)
 ;--- Check for the errors
"RTN","RORRP007",93,0)
 I 'RC  S RORRES(0)=1
"RTN","RORRP007",94,0)
 E  D:RC<0 RPCSTK^RORERR(.RORRES,RC)
"RTN","RORRP007",95,0)
 Q
"RTN","RORRP007",96,0)
 ;
"RTN","RORRP007",97,0)
 ;***** RETURNS THE LIST OF LOGS
"RTN","RORRP007",98,0)
 ; RPC: [ROR LOG GET LIST]
"RTN","RORRP007",99,0)
 ;
"RTN","RORRP007",100,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP007",101,0)
 ;               are returned to.
"RTN","RORRP007",102,0)
 ;
"RTN","RORRP007",103,0)
 ; REGIEN        Registry IEN
"RTN","RORRP007",104,0)
 ;
"RTN","RORRP007",105,0)
 ; [STDT]        Start date (by default, from the earliest log)
"RTN","RORRP007",106,0)
 ; [ENDT]        End date (by default, to the latest log)
"RTN","RORRP007",107,0)
 ;
"RTN","RORRP007",108,0)
 ; Return Values:
"RTN","RORRP007",109,0)
 ;
"RTN","RORRP007",110,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP007",111,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP007",112,0)
 ;
"RTN","RORRP007",113,0)
 ; Otherwise, number of logs is returned in the @RESULTS@(0) and the
"RTN","RORRP007",114,0)
 ; subsequent nodes of the RESULTS array contain the logs.
"RTN","RORRP007",115,0)
 ; 
"RTN","RORRP007",116,0)
 ; @RESULTS@(0)          Number of logs
"RTN","RORRP007",117,0)
 ;
"RTN","RORRP007",118,0)
 ; @RESULTS@(i)          Log descriptor
"RTN","RORRP007",119,0)
 ;                         ^01: "L"
"RTN","RORRP007",120,0)
 ;                         ^02: Log IEN
"RTN","RORRP007",121,0)
 ;                         ^03: Activity (external)
"RTN","RORRP007",122,0)
 ;                         ^04: Activity (internal)
"RTN","RORRP007",123,0)
 ;                         ^05: Start Date/Time (external)
"RTN","RORRP007",124,0)
 ;                         ^06: Contains messages (0/1)
"RTN","RORRP007",125,0)
 ;                         ^07: Job Number
"RTN","RORRP007",126,0)
 ;                         ^08: End Date/Time (external)
"RTN","RORRP007",127,0)
 ;                         ^09: Number of Processed Patients
"RTN","RORRP007",128,0)
 ;                         ^10: Number of Patients with Errors
"RTN","RORRP007",129,0)
 ;                         ^11: Processing Rate
"RTN","RORRP007",130,0)
 ;                         ^12: Task Number (optional)
"RTN","RORRP007",131,0)
 ;
"RTN","RORRP007",132,0)
 ; @RESULTS@(...)        Registry descriptor (optional)
"RTN","RORRP007",133,0)
 ;                         ^01: "R"
"RTN","RORRP007",134,0)
 ;                         ^02: Registry IEN
"RTN","RORRP007",135,0)
 ;                         ^03: Registry Name
"RTN","RORRP007",136,0)
 ;
"RTN","RORRP007",137,0)
 ; @RESULTS@(i+n)        'End of log' marker
"RTN","RORRP007",138,0)
 ;                         ^01: "L"
"RTN","RORRP007",139,0)
 ;                         ^02: "END"
"RTN","RORRP007",140,0)
 ;
"RTN","RORRP007",141,0)
LOGLIST(RESULTS,REGIEN,STDT,ENDT) ;
"RTN","RORRP007",142,0)
 N CNT,DATE,IEN,RORFLDS,RC,XREF
"RTN","RORRP007",143,0)
 D CLEAR^RORERR("LOGLIST^RORRP007",1)
"RTN","RORRP007",144,0)
 S RORFLDS=".01;1;2;3*;5;6.01;6.02;6.03;8"
"RTN","RORRP007",145,0)
 ;--- Check the parameters
"RTN","RORRP007",146,0)
 I $G(REGIEN)'>0  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP007",147,0)
 . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP007",148,0)
 S REGIEN=+REGIEN,STDT=$G(STDT)\1,ENDT=$G(ENDT)\1
"RTN","RORRP007",149,0)
 S ENDT=$S(ENDT>0:$$FMADD^XLFDT(ENDT,1),1:9999999)
"RTN","RORRP007",150,0)
 ;--- Initialize the variables
"RTN","RORRP007",151,0)
 S XREF=$NA(^RORDATA(798.7,"ARD",REGIEN)),CNT=0
"RTN","RORRP007",152,0)
 K RESULTS  S RESULTS=$$ALLOC^RORTMP()
"RTN","RORRP007",153,0)
 ;--- Browse through the logs
"RTN","RORRP007",154,0)
 S CNT("L")=0,DATE=ENDT
"RTN","RORRP007",155,0)
 F  S DATE=$O(@XREF@(DATE),-1)  Q:DATE=""  Q:DATE<STDT  D
"RTN","RORRP007",156,0)
 . S IEN=""
"RTN","RORRP007",157,0)
 . F  S IEN=$O(@XREF@(DATE,IEN),-1)  Q:IEN=""  D
"RTN","RORRP007",158,0)
 . . S RC=$$LOAD(IEN,RESULTS,.CNT)
"RTN","RORRP007",159,0)
 . . S:'RC CNT("L")=CNT("L")+1
"RTN","RORRP007",160,0)
 ;--- Number of logs
"RTN","RORRP007",161,0)
 S @RESULTS@(0)=CNT("L")
"RTN","RORRP007",162,0)
 Q
"RTN","RORRP007",163,0)
 ;
"RTN","RORRP007",164,0)
 ;***** RETURNS THE LIST OF MESSAGES
"RTN","RORRP007",165,0)
 ; RPC: [ROR LOG GET MESSAGES]
"RTN","RORRP007",166,0)
 ;
"RTN","RORRP007",167,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP007",168,0)
 ;               are returned to.
"RTN","RORRP007",169,0)
 ;
"RTN","RORRP007",170,0)
 ; LOGIEN        IEN of the log
"RTN","RORRP007",171,0)
 ;
"RTN","RORRP007",172,0)
 ; Return Values:
"RTN","RORRP007",173,0)
 ;
"RTN","RORRP007",174,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP007",175,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP007",176,0)
 ;
"RTN","RORRP007",177,0)
 ; Otherwise, number of messages is returned in the RESULTS(0) and
"RTN","RORRP007",178,0)
 ; the subsequent nodes of the RESULTS array contain the messages.
"RTN","RORRP007",179,0)
 ;
"RTN","RORRP007",180,0)
 ; @RESULTS@(0)          Number of messages
"RTN","RORRP007",181,0)
 ;
"RTN","RORRP007",182,0)
 ; @RESULTS@(i)          Message descriptor
"RTN","RORRP007",183,0)
 ;                         ^01: "M"
"RTN","RORRP007",184,0)
 ;                         ^02: Message IENS
"RTN","RORRP007",185,0)
 ;                         ^03: Type (external)
"RTN","RORRP007",186,0)
 ;                         ^04: Type (internal)
"RTN","RORRP007",187,0)
 ;                         ^05: Date/Time (external)
"RTN","RORRP007",188,0)
 ;                         ^06: Has Additional Info (0/1)
"RTN","RORRP007",189,0)
 ;                         ^07: Patient Name
"RTN","RORRP007",190,0)
 ;                         ^08: Patient IEN (DFN)
"RTN","RORRP007",191,0)
 ;
"RTN","RORRP007",192,0)
 ; @RESULTS@(i+1)        Message
"RTN","RORRP007",193,0)
 ;                         ^01: "T"
"RTN","RORRP007",194,0)
 ;                         ^02: Message Text
"RTN","RORRP007",195,0)
 ;
"RTN","RORRP007",196,0)
 ; @RESULTS@(...)        Line of the ADDITIONAL INFO text
"RTN","RORRP007",197,0)
 ;                         ^01: "A"
"RTN","RORRP007",198,0)
 ;                         ^02: Text
"RTN","RORRP007",199,0)
 ;                         
"RTN","RORRP007",200,0)
 ; @RESULTS@(i+n)        'End of message' marker
"RTN","RORRP007",201,0)
 ;                         ^01: "M"
"RTN","RORRP007",202,0)
 ;                         ^02: "END"
"RTN","RORRP007",203,0)
 ;
"RTN","RORRP007",204,0)
MSGLIST(RESULTS,LOGIEN) ;
"RTN","RORRP007",205,0)
 N CNT,I,IEN,IENS,RC,ROOT,RORBUF,RORMSG
"RTN","RORRP007",206,0)
 D CLEAR^RORERR("MESSAGE^RORRP007",1)
"RTN","RORRP007",207,0)
 ;--- Check the parameters
"RTN","RORRP007",208,0)
 I $G(LOGIEN)'>0  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP007",209,0)
 . S RC=$$ERROR^RORERR(-88,,,,"LOGIEN",$G(LOGIEN))
"RTN","RORRP007",210,0)
 S LOGIEN=+LOGIEN
"RTN","RORRP007",211,0)
 ;--- Initialize the variables
"RTN","RORRP007",212,0)
 S ROOT=$$ROOT^DILFD(798.7,,1),CNT=0
"RTN","RORRP007",213,0)
 K RESULTS  S RESULTS=$$ALLOC^RORTMP()
"RTN","RORRP007",214,0)
 ;--- Browse through the messages
"RTN","RORRP007",215,0)
 S (CNT("M"),IEN)=0
"RTN","RORRP007",216,0)
 F  S IEN=$O(@ROOT@(LOGIEN,2,IEN))  Q:IEN'>0  D
"RTN","RORRP007",217,0)
 . S IENS=IEN_","_LOGIEN_","  K RORBUF
"RTN","RORRP007",218,0)
 . ;--- Load the message details
"RTN","RORRP007",219,0)
 . D GETS^DIQ(798.74,IENS,".01;1;2;3;4","EI","RORBUF","RORMSG")
"RTN","RORRP007",220,0)
 . Q:$G(DIERR)
"RTN","RORRP007",221,0)
 . S BUF="M^"_IENS
"RTN","RORRP007",222,0)
 . ;--- Type (external)
"RTN","RORRP007",223,0)
 . S $P(BUF,"^",3)=$G(RORBUF(798.74,IENS,1,"E"))
"RTN","RORRP007",224,0)
 . ;--- Type (Internal)
"RTN","RORRP007",225,0)
 . S $P(BUF,"^",4)=$G(RORBUF(798.74,IENS,1,"I"))
"RTN","RORRP007",226,0)
 . ;--- Date/Time
"RTN","RORRP007",227,0)
 . S $P(BUF,"^",5)=$G(RORBUF(798.74,IENS,.01,"E"))
"RTN","RORRP007",228,0)
 . ;--- Has Additional Info
"RTN","RORRP007",229,0)
 . S $P(BUF,"^",6)=($D(RORBUF(798.74,IENS,4))>1)
"RTN","RORRP007",230,0)
 . ;--- Patient Name
"RTN","RORRP007",231,0)
 . S $P(BUF,"^",7)=$G(RORBUF(798.74,IENS,3,"E"))
"RTN","RORRP007",232,0)
 . ;--- Patient IEN (DFN)
"RTN","RORRP007",233,0)
 . S $P(BUF,"^",8)=$G(RORBUF(798.74,IENS,3,"I"))
"RTN","RORRP007",234,0)
 . ;--- Add the descriptor to the output
"RTN","RORRP007",235,0)
 . S CNT=CNT+1,@RESULTS@(CNT)=BUF
"RTN","RORRP007",236,0)
 . ;--- Add the message text to the output
"RTN","RORRP007",237,0)
 . S CNT=CNT+1,@RESULTS@(CNT)="T^"_$G(RORBUF(798.74,IENS,2,"E"))
"RTN","RORRP007",238,0)
 . ;--- Append the ADDITIONAL INFO
"RTN","RORRP007",239,0)
 . S I=0
"RTN","RORRP007",240,0)
 . F  S I=$O(RORBUF(798.74,IENS,4,I))  Q:'I  D
"RTN","RORRP007",241,0)
 . . S CNT=CNT+1,@RESULTS@(CNT)="A^"_RORBUF(798.74,IENS,4,I)
"RTN","RORRP007",242,0)
 . ;---Add the 'End of message' marker
"RTN","RORRP007",243,0)
 . S CNT=CNT+1,@RESULTS@(CNT)="M^END"
"RTN","RORRP007",244,0)
 . S CNT("M")=CNT("M")+1
"RTN","RORRP007",245,0)
 ;--- Number of messages
"RTN","RORRP007",246,0)
 S @RESULTS@(0)=CNT("M")
"RTN","RORRP007",247,0)
 Q
"RTN","RORRP010")
0^91^B11270311
"RTN","RORRP010",1,0)
RORRP010 ;HCIOFO/SG - RPC: TASK MANAGER ; 10/5/05 11:12am
"RTN","RORRP010",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP010",3,0)
 ;
"RTN","RORRP010",4,0)
 Q
"RTN","RORRP010",5,0)
 ;
"RTN","RORRP010",6,0)
 ;***** DELETES THE TASK
"RTN","RORRP010",7,0)
 ; RPC: [ROR TASK DELETE]
"RTN","RORRP010",8,0)
 ;
"RTN","RORRP010",9,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP010",10,0)
 ;               are returned to.
"RTN","RORRP010",11,0)
 ;
"RTN","RORRP010",12,0)
 ; TASK          Task number
"RTN","RORRP010",13,0)
 ;
"RTN","RORRP010",14,0)
 ; Return Values:
"RTN","RORRP010",15,0)
 ;
"RTN","RORRP010",16,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP010",17,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP010",18,0)
 ;
"RTN","RORRP010",19,0)
 ; Otherwise, zero is returned.
"RTN","RORRP010",20,0)
 ;
"RTN","RORRP010",21,0)
DELTASK(RESULTS,TASK) ;
"RTN","RORRP010",22,0)
 N RORERRDL  K RESULTS
"RTN","RORRP010",23,0)
 D CLEAR^RORERR("DELTASK^RORRP010",1)
"RTN","RORRP010",24,0)
 S RESULTS=$$DEQUEUE^RORTSK(TASK,1)
"RTN","RORRP010",25,0)
 D:RESULTS<0 RPCSTK^RORERR(.RESULTS,RESULTS)
"RTN","RORRP010",26,0)
 Q
"RTN","RORRP010",27,0)
 ;
"RTN","RORRP010",28,0)
 ;***** SCHEDULES THE REPORT
"RTN","RORRP010",29,0)
 ; RPC: [ROR REPORT SCHEDULE]
"RTN","RORRP010",30,0)
 ;
"RTN","RORRP010",31,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP010",32,0)
 ;               are returned to.
"RTN","RORRP010",33,0)
 ;
"RTN","RORRP010",34,0)
 ; RPTCODE       Code of the report
"RTN","RORRP010",35,0)
 ;
"RTN","RORRP010",36,0)
 ; [REGIEN]      Registry IEN (if $G(REGIEN)'>0 the task will not
"RTN","RORRP010",37,0)
 ;               be associated with any particular registry).
"RTN","RORRP010",38,0)
 ;
"RTN","RORRP010",39,0)
 ; [ZTDTH]       Date/time to start the task (FileMan). By default
"RTN","RORRP010",40,0)
 ;               (if $G(ZDTH)'>0) the task will be scheduled to run
"RTN","RORRP010",41,0)
 ;               immediately (see the $$CREATE^RORTSK for details).
"RTN","RORRP010",42,0)
 ;
"RTN","RORRP010",43,0)
 ; [SCHCODE]     Rescheduling code for the task. By default (if
"RTN","RORRP010",44,0)
 ;               $G(SCHCODE)=""), the task is executed once. See
"RTN","RORRP010",45,0)
 ;               description of the $$SCH^XLFDT function for
"RTN","RORRP010",46,0)
 ;               possible values of the parameter).
"RTN","RORRP010",47,0)
 ;
"RTN","RORRP010",48,0)
 ; [.PARAMS]     Reference to a local variable that contains report
"RTN","RORRP010",49,0)
 ;               parameters in XML format.
"RTN","RORRP010",50,0)
 ;
"RTN","RORRP010",51,0)
 ; Return Values:
"RTN","RORRP010",52,0)
 ;
"RTN","RORRP010",53,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP010",54,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP010",55,0)
 ;
"RTN","RORRP010",56,0)
 ; Otherwise, the task descriptor is returned in the RESULTS array
"RTN","RORRP010",57,0)
 ; (see the TASKINFO^RORRP010 entry point for details).
"RTN","RORRP010",58,0)
 ;
"RTN","RORRP010",59,0)
SCHEDREP(RESULTS,RPTCODE,REGIEN,ZTDTH,SCHCODE,PARAMS) ;
"RTN","RORRP010",60,0)
 N RORERRDL,RPINFO,TASK,TMP,TSKPRM
"RTN","RORRP010",61,0)
 N ZTCPU,ZTDESC,ZTIO,ZTKIL,ZTPRI,ZTSAVE,ZTSYNC,ZTUCI
"RTN","RORRP010",62,0)
 D CLEAR^RORERR("SCHEDREP^RORRP010",1)
"RTN","RORRP010",63,0)
 S REGIEN=+$G(REGIEN),SCHCODE=$G(SCHCODE)
"RTN","RORRP010",64,0)
 ;--- Get the report descriptor
"RTN","RORRP010",65,0)
 S RC=$$RPINFO^RORUTL08(RPTCODE,.RPINFO)
"RTN","RORRP010",66,0)
 I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP010",67,0)
 ;--- Parse the report parameters
"RTN","RORRP010",68,0)
 S RC=$$PARSEPRM^RORTSK13(.PARAMS,.TSKPRM)
"RTN","RORRP010",69,0)
 ;--- Create the task
"RTN","RORRP010",70,0)
 S TASK=$$CREATE^RORTSK(2,RPINFO(9),,REGIEN,RPTCODE,SCHCODE,.TSKPRM)
"RTN","RORRP010",71,0)
 I TASK<0  D RPCSTK^RORERR(.RESULTS,TASK)  Q
"RTN","RORRP010",72,0)
 ;--- Get the status
"RTN","RORRP010",73,0)
 D TASKINFO(.RESULTS,TASK)
"RTN","RORRP010",74,0)
 Q
"RTN","RORRP010",75,0)
 ;
"RTN","RORRP010",76,0)
 ;***** RETURNS THE TASK INFORMATION
"RTN","RORRP010",77,0)
 ; RPC: [ROR TASK INFO]
"RTN","RORRP010",78,0)
 ;
"RTN","RORRP010",79,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP010",80,0)
 ;               are returned to.
"RTN","RORRP010",81,0)
 ;
"RTN","RORRP010",82,0)
 ; TASK          Task number
"RTN","RORRP010",83,0)
 ;
"RTN","RORRP010",84,0)
 ; Return Values:
"RTN","RORRP010",85,0)
 ;
"RTN","RORRP010",86,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP010",87,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP010",88,0)
 ;
"RTN","RORRP010",89,0)
 ; Otherwise, the task descriptor is returned in the RESULTS array
"RTN","RORRP010",90,0)
 ; (see the $$TASKINFO^RORTSK02 function for more details).
"RTN","RORRP010",91,0)
 ;
"RTN","RORRP010",92,0)
 ; RESULTS(0)            Result Descriptor
"RTN","RORRP010",93,0)
 ;                         ^1: 1
"RTN","RORRP010",94,0)
 ;                         ^2: Number of nodes that make a single
"RTN","RORRP010",95,0)
 ;                             task descriptor (TIN)
"RTN","RORRP010",96,0)
 ;
"RTN","RORRP010",97,0)
 ; RESULTS(1)            Task Number
"RTN","RORRP010",98,0)
 ; RESULTS(2)            Task Type           (internal^external)
"RTN","RORRP010",99,0)
 ; RESULTS(3)            Registry            (IEN^Name)
"RTN","RORRP010",100,0)
 ; RESULTS(4)            Report              (Code^Name)
"RTN","RORRP010",101,0)
 ; RESULTS(5)            Description
"RTN","RORRP010",102,0)
 ; RESULTS(6)            Task Status         (internal^external)
"RTN","RORRP010",103,0)
 ; RESULTS(7)            Creation Time       (internal)
"RTN","RORRP010",104,0)
 ; RESULTS(8)            User                (DUZ^Name)
"RTN","RORRP010",105,0)
 ; RESULTS(9)            Completion Time     (internal)
"RTN","RORRP010",106,0)
 ; RESULTS(10)           Progress Percentage
"RTN","RORRP010",107,0)
 ; RESULTS(11)           Scheduled to Run at (internal)
"RTN","RORRP010",108,0)
 ; RESULTS(12)           Task Log IEN
"RTN","RORRP010",109,0)
 ; RESULTS(13)           Job Number
"RTN","RORRP010",110,0)
 ;
"RTN","RORRP010",111,0)
TASKINFO(RESULTS,TASK) ;
"RTN","RORRP010",112,0)
 N RC,RORERRDL
"RTN","RORRP010",113,0)
 D CLEAR^RORERR("TASKINFO^RORRP010",1)
"RTN","RORRP010",114,0)
 S RC=$$TASKINFO^RORTSK02(TASK,.RESULTS,"EI")
"RTN","RORRP010",115,0)
 I RC'<0  S RESULTS(0)="1^"_$$TIN^RORTSK02
"RTN","RORRP010",116,0)
 E  D RPCSTK^RORERR(.RESULTS,RC)
"RTN","RORRP010",117,0)
 Q
"RTN","RORRP010",118,0)
 ;
"RTN","RORRP010",119,0)
 ;***** RETURNS A LIST OF USER'S TASKS
"RTN","RORRP010",120,0)
 ; RPC: [ROR TASK LIST]
"RTN","RORRP010",121,0)
 ;
"RTN","RORRP010",122,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP010",123,0)
 ;               are returned to.
"RTN","RORRP010",124,0)
 ;
"RTN","RORRP010",125,0)
 ; [REGIEN]      Registry IEN (all registries by default)
"RTN","RORRP010",126,0)
 ; [TYPE]        Task Type (all types by default)
"RTN","RORRP010",127,0)
 ; [USER]        User IEN (DUZ by default)
"RTN","RORRP010",128,0)
 ;
"RTN","RORRP010",129,0)
 ; Return Values:
"RTN","RORRP010",130,0)
 ;
"RTN","RORRP010",131,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP010",132,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP010",133,0)
 ;
"RTN","RORRP010",134,0)
 ; Otherwise, the task descriptors are returned in the RESULTS array
"RTN","RORRP010",135,0)
 ; (see the TASKINFO^RORRP010 entry point for details).
"RTN","RORRP010",136,0)
 ;
"RTN","RORRP010",137,0)
 ; @RESULTS@(0)          Result Descriptor
"RTN","RORRP010",138,0)
 ;                         ^01: Number of task descriptors returned
"RTN","RORRP010",139,0)
 ;                              in the RESULTS array (NTSK)
"RTN","RORRP010",140,0)
 ;                         ^02: Number of nodes that make a single
"RTN","RORRP010",141,0)
 ;                              task descriptor (TIN)
"RTN","RORRP010",142,0)
 ;
"RTN","RORRP010",143,0)
 ; @RESULTS@(i)          Value returned by the $$TASKINFO^RORTSK02
"RTN","RORRP010",144,0)
 ;                       function. You can calculate the subscript
"RTN","RORRP010",145,0)
 ;                       of the item TI (from 1 to TIN) of the task
"RTN","RORRP010",146,0)
 ;                       TN (from 1 to NTSK) using the following
"RTN","RORRP010",147,0)
 ;                       formula: i = (TN-1)*TIN+TI.
"RTN","RORRP010",148,0)
 ;
"RTN","RORRP010",149,0)
 ; For example, if number of nodes returned by the $$TASKINFO^RORTSK02
"RTN","RORRP010",150,0)
 ; function for each task is 13 and the RESULTS array contains
"RTN","RORRP010",151,0)
 ; information about 3 tasks, the following nodes will be defined:
"RTN","RORRP010",152,0)
 ;
"RTN","RORRP010",153,0)
 ;   @RESULTS@(0)  = "3^13"
"RTN","RORRP010",154,0)
 ;
"RTN","RORRP010",155,0)
 ;   @RESULTS@(1)  = Task Number 1
"RTN","RORRP010",156,0)
 ;   @RESULTS@(2)  = Task Type 1 (internal^external)
"RTN","RORRP010",157,0)
 ;   ...
"RTN","RORRP010",158,0)
 ;   @RESULTS@(13) = Job Number 1
"RTN","RORRP010",159,0)
 ;
"RTN","RORRP010",160,0)
 ;   @RESULTS@(14) = Task Number 2
"RTN","RORRP010",161,0)
 ;   @RESULTS@(15) = Task Type 2 (internal^external)
"RTN","RORRP010",162,0)
 ;   ...
"RTN","RORRP010",163,0)
 ;   @RESULTS@(26) = Job Number 2
"RTN","RORRP010",164,0)
 ;
"RTN","RORRP010",165,0)
 ;   @RESULTS@(27) = Task Number 3
"RTN","RORRP010",166,0)
 ;   @RESULTS@(28) = Task Type 3 (internal^external)
"RTN","RORRP010",167,0)
 ;   ...
"RTN","RORRP010",168,0)
 ;   @RESULTS@(39) = Job Number 3
"RTN","RORRP010",169,0)
 ;
"RTN","RORRP010",170,0)
TASKLIST(RESULTS,REGIEN,TYPE,USER) ;
"RTN","RORRP010",171,0)
 N INFO,NTSK,RC,RORERRDL,TASK,TASKLIST,TIN
"RTN","RORRP010",172,0)
 D CLEAR^RORERR("TASKLIST^RORRP010",1)
"RTN","RORRP010",173,0)
 ;--- Initialize the variables
"RTN","RORRP010",174,0)
 K RESULTS  S RESULTS=$$ALLOC^RORTMP()
"RTN","RORRP010",175,0)
 S TIN=$$TIN^RORTSK02
"RTN","RORRP010",176,0)
 ;--- Get the list of task numbers
"RTN","RORRP010",177,0)
 S RC=$$LIST^RORTSK02(.TASKLIST,$G(REGIEN),$G(TYPE),,,$G(USER))
"RTN","RORRP010",178,0)
 I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP010",179,0)
 ;--- Generate the output list
"RTN","RORRP010",180,0)
 S TASK="",NTSK=0
"RTN","RORRP010",181,0)
 F  S TASK=$O(TASKLIST(TASK))  Q:TASK=""  D
"RTN","RORRP010",182,0)
 . K INFO
"RTN","RORRP010",183,0)
 . S RC=$$TASKINFO^RORTSK02(TASK,.INFO,"EI",NTSK*TIN)  Q:RC<0
"RTN","RORRP010",184,0)
 . M @RESULTS=INFO  S NTSK=NTSK+1
"RTN","RORRP010",185,0)
 S @RESULTS@(0)=NTSK_U_TIN
"RTN","RORRP010",186,0)
 Q
"RTN","RORRP011")
0^92^B14118825
"RTN","RORRP011",1,0)
RORRP011 ;HCIOFO/SG - RPC: TASK MANAGER (REPORTS) ; 11/21/05 1:02pm
"RTN","RORRP011",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP011",3,0)
 ;
"RTN","RORRP011",4,0)
 Q
"RTN","RORRP011",5,0)
 ;
"RTN","RORRP011",6,0)
 ;***** ADDS A LINE TO THE RESULTS ARRAY
"RTN","RORRP011",7,0)
ADD(STR) ;
"RTN","RORRP011",8,0)
 S RESULTS(0)=$G(RESULTS(0))+1,RESULTS(RESULTS(0))=STR
"RTN","RORRP011",9,0)
 Q
"RTN","RORRP011",10,0)
 ;
"RTN","RORRP011",11,0)
 ;***** THE REPORT RETRIEVER
"RTN","RORRP011",12,0)
 ; RPC: [ROR REPORT RETRIEVE]
"RTN","RORRP011",13,0)
 ;
"RTN","RORRP011",14,0)
 ; .RORESULT     Reference to a local variable where the report
"RTN","RORRP011",15,0)
 ;               lines are returned to.
"RTN","RORRP011",16,0)
 ;
"RTN","RORRP011",17,0)
 ; TASK          Task number
"RTN","RORRP011",18,0)
 ;
"RTN","RORRP011",19,0)
 ; [FROM]        Where to start/continue the rendering process
"RTN","RORRP011",20,0)
 ;               (see the $$XMLREP^RORTSK10 function for details).
"RTN","RORRP011",21,0)
 ;               By default (if $G(FROM)'>0), the rendering starts
"RTN","RORRP011",22,0)
 ;               from the beginning of the report.
"RTN","RORRP011",23,0)
 ;
"RTN","RORRP011",24,0)
 ; [MAXSIZE]     Either the maximum number of lines to retrieve or
"RTN","RORRP011",25,0)
 ;               the maximum size of the output in bytes (append the
"RTN","RORRP011",26,0)
 ;               "B" to the number). By default (if $G(MAXSIZE)'>0,)
"RTN","RORRP011",27,0)
 ;               the whole report (starting from the point indicated
"RTN","RORRP011",28,0)
 ;               by the FROM parameter if it is defined) is retrieved.
"RTN","RORRP011",29,0)
 ;
"RTN","RORRP011",30,0)
 ; [.SORT]       Sort modes for the report
"RTN","RORRP011",31,0)
 ;
"RTN","RORRP011",32,0)
 ; See the description of the ROR REPORT RETRIEVE remote procedure
"RTN","RORRP011",33,0)
 ; for more details.
"RTN","RORRP011",34,0)
 ;
"RTN","RORRP011",35,0)
 ; Return Values:
"RTN","RORRP011",36,0)
 ;
"RTN","RORRP011",37,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) node
"RTN","RORRP011",38,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for details).
"RTN","RORRP011",39,0)
 ;
"RTN","RORRP011",40,0)
GETXML(RORESULT,TASK,FROM,MAXSIZE,SORT) ;
"RTN","RORRP011",41,0)
 N DST,RC,RORERRDL,TMP  K RORESULT
"RTN","RORRP011",42,0)
 D CLEAR^RORERR("GETXML^RORRP039",1)
"RTN","RORRP011",43,0)
 ;--- Change the type of the result from the ARRAY to
"RTN","RORRP011",44,0)
 ;--- the GLOBAL ARRAY if a long report is suspected.
"RTN","RORRP011",45,0)
 S DST="RORESULT",MAXSIZE=$G(MAXSIZE)
"RTN","RORRP011",46,0)
 S TMP=$S(MAXSIZE["B":+MAXSIZE,1:MAXSIZE*80)
"RTN","RORRP011",47,0)
 I 'TMP!(TMP>16384),$$RTRNFMT^XWBLIB(4,1)  D
"RTN","RORRP011",48,0)
 . S (DST,RORESULT)=$$ALLOC^RORTMP()
"RTN","RORRP011",49,0)
 ;--- Render the report into XML
"RTN","RORRP011",50,0)
 S RC=$$XMLREP^RORTSK10(DST,TASK,.SORT,.FROM,MAXSIZE)
"RTN","RORRP011",51,0)
 I RC<0  K @DST  D RPCSTK^RORERR(.RORESULT,RC)  Q
"RTN","RORRP011",52,0)
 ;--- Return the starting point for the next call
"RTN","RORRP011",53,0)
 S:MAXSIZE>0 @DST@(0)=$G(FROM)
"RTN","RORRP011",54,0)
 Q
"RTN","RORRP011",55,0)
 ;
"RTN","RORRP011",56,0)
 ;***** RETURNS THE REPORT STYLESHEET
"RTN","RORRP011",57,0)
 ; RPC: [ROR REPORT STYLESHEET]
"RTN","RORRP011",58,0)
 ;
"RTN","RORRP011",59,0)
 ; .RESULTS      Reference to a local variable where the XSL
"RTN","RORRP011",60,0)
 ;               stylesheet lines are returned to.
"RTN","RORRP011",61,0)
 ;
"RTN","RORRP011",62,0)
 ; RPTCODE       Code of the report
"RTN","RORRP011",63,0)
 ;
"RTN","RORRP011",64,0)
 ; [TYPE]        Type of the stylesheet
"RTN","RORRP011",65,0)
 ;                 1  Report preview (default)
"RTN","RORRP011",66,0)
 ;                 2  Comma-separated output
"RTN","RORRP011",67,0)
 ;                 3  Printer output
"RTN","RORRP011",68,0)
 ;
"RTN","RORRP011",69,0)
 ; Return Values:
"RTN","RORRP011",70,0)
 ;
"RTN","RORRP011",71,0)
 ; A negative value of the first "^"-piece of the @RESULTS@(0) node
"RTN","RORRP011",72,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for details).
"RTN","RORRP011",73,0)
 ;
"RTN","RORRP011",74,0)
GETXSL(RESULTS,RPTCODE,TYPE) ;
"RTN","RORRP011",75,0)
 N DLG,RC,RORERRDL
"RTN","RORRP011",76,0)
 D CLEAR^RORERR("GETXSL^RORRP039",1)
"RTN","RORRP011",77,0)
 K RESULTS  S RESULTS=$$ALLOC^RORTMP()
"RTN","RORRP011",78,0)
 ;--- Check the parameters
"RTN","RORRP011",79,0)
 S DLG=7981000,TYPE=$S($G(TYPE)>0:TYPE/1000,1:.001)
"RTN","RORRP011",80,0)
 I $G(RPTCODE)>0  S:RPTCODE'>999 DLG=DLG+RPTCODE+TYPE
"RTN","RORRP011",81,0)
 ;--- Load the stylesheet into the buffer
"RTN","RORRP011",82,0)
 D BLD^DIALOG(DLG,,,RESULTS)
"RTN","RORRP011",83,0)
 D:$D(@RESULTS)<10
"RTN","RORRP011",84,0)
 . D BLD^DIALOG(7981000+TYPE,,,RESULTS)
"RTN","RORRP011",85,0)
 . D:$D(@RESULTS)<10 BLD^DIALOG(7981000,,,RESULTS)
"RTN","RORRP011",86,0)
 Q
"RTN","RORRP011",87,0)
 ;
"RTN","RORRP011",88,0)
 ;***** RETURNS A LIST OF AVAILABLE REPORTS AND THEIR PARAMETERS
"RTN","RORRP011",89,0)
 ; ROR: [ROR REPORTS AVAILABLE]
"RTN","RORRP011",90,0)
 ;
"RTN","RORRP011",91,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP011",92,0)
 ;               are returned to.
"RTN","RORRP011",93,0)
 ;
"RTN","RORRP011",94,0)
 ; REGIEN        Registry IEN
"RTN","RORRP011",95,0)
 ;
"RTN","RORRP011",96,0)
 ; Return Values:
"RTN","RORRP011",97,0)
 ;
"RTN","RORRP011",98,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP011",99,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP011",100,0)
 ;
"RTN","RORRP011",101,0)
 ; Otherwise, the report descriptors are returned in the RESULTS array
"RTN","RORRP011",102,0)
 ; (see the $$RPINFO^RORUTL08 entry point for details).
"RTN","RORRP011",103,0)
 ;
"RTN","RORRP011",104,0)
 ; RESULTS(0)            Number of available reports
"RTN","RORRP011",105,0)
 ;
"RTN","RORRP011",106,0)
 ; RESULTS(i)            XML document that describes the reports
"RTN","RORRP011",107,0)
 ;
"RTN","RORRP011",108,0)
RPAVAIL(RESULTS,REGIEN) ;
"RTN","RORRP011",109,0)
 N BUF,CODE,INFO,NAME,NREP,RC,RPLST
"RTN","RORRP011",110,0)
 D CLEAR^RORERR("RPAVAIL^RORRP039",1)
"RTN","RORRP011",111,0)
 ;--- The the list of available reports
"RTN","RORRP011",112,0)
 S RC=$$RPLIST^RORUTL08(.RPLST,REGIEN)
"RTN","RORRP011",113,0)
 I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP011",114,0)
 ;--- Sort the reports alphabetically
"RTN","RORRP011",115,0)
 S CODE=0
"RTN","RORRP011",116,0)
 F  S CODE=$O(RPLST(CODE))  Q:CODE'>0  D
"RTN","RORRP011",117,0)
 . S NAME=$P(RPLST(CODE),U,2)
"RTN","RORRP011",118,0)
 . S:NAME'="" RPLST("B",NAME,CODE)=""
"RTN","RORRP011",119,0)
 ;---
"RTN","RORRP011",120,0)
 K RESULTS
"RTN","RORRP011",121,0)
 D ADD($$XMLHDR^MXMLUTL())
"RTN","RORRP011",122,0)
 D ADD("<REPORTS>")
"RTN","RORRP011",123,0)
 ;--- Get the parameters of the reports
"RTN","RORRP011",124,0)
 S NAME="",(NREP,RC)=0
"RTN","RORRP011",125,0)
 F  S NAME=$O(RPLST("B",NAME))  Q:NAME=""  D  Q:RC<0
"RTN","RORRP011",126,0)
 . S CODE=0
"RTN","RORRP011",127,0)
 . F  S CODE=$O(RPLST("B",NAME,CODE))  Q:CODE'>0  D  Q:RC<0
"RTN","RORRP011",128,0)
 . . S RC=$$RPINFO^RORUTL08(CODE,.INFO,"E")  Q:RC<0
"RTN","RORRP011",129,0)
 . . S NREP=NREP+1
"RTN","RORRP011",130,0)
 . . S BUF="REPORT CODE="""_CODE_""" NAME="""_INFO(1)_""""
"RTN","RORRP011",131,0)
 . . S BUF=BUF_" IEN="""_INFO(5)_""""
"RTN","RORRP011",132,0)
 . . S:'INFO(2) BUF=BUF_" FGP=""1"""
"RTN","RORRP011",133,0)
 . . S:'INFO(7) BUF=BUF_" LOCAL=""1"""
"RTN","RORRP011",134,0)
 . . S:INFO(12) BUF=BUF_" SHARED_TEMPLATES=""1"""
"RTN","RORRP011",135,0)
 . . D ADD("<"_BUF_">")
"RTN","RORRP011",136,0)
 . . D:INFO(6)>0 ADD("<INADT>"_(+INFO(6))_"</INADT>")
"RTN","RORRP011",137,0)
 . . D ADD("<PANELS>"_INFO(8)_"</PANELS>")
"RTN","RORRP011",138,0)
 . . D:INFO(10)?." "1"<PARAMS>"1.E ADD(INFO(10))
"RTN","RORRP011",139,0)
 . . D:INFO(11)?." "1"<SORT_MODES>"1.E ADD(INFO(11))
"RTN","RORRP011",140,0)
 . . D ADD("</REPORT>")
"RTN","RORRP011",141,0)
 ;---
"RTN","RORRP011",142,0)
 I RC'<0  D ADD("</REPORTS>")  S RESULTS(0)=NREP
"RTN","RORRP011",143,0)
 E  D RPCSTK^RORERR(.RESULTS,RC)
"RTN","RORRP011",144,0)
 Q
"RTN","RORRP012")
0^10^B5905525
"RTN","RORRP012",1,0)
RORRP012 ;HCIOFO/SG - RPC: MISCELLANEOUS ; 12/15/05 4:03pm
"RTN","RORRP012",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP012",3,0)
 ;
"RTN","RORRP012",4,0)
 Q
"RTN","RORRP012",5,0)
 ;
"RTN","RORRP012",6,0)
 ;***** RETURNS THE CURRENT DATE/TIME ON THE SERVER
"RTN","RORRP012",7,0)
 ; RPC: [ROR GET SERVER TIME]
"RTN","RORRP012",8,0)
 ;
"RTN","RORRP012",9,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP012",10,0)
 ;               are returned to.
"RTN","RORRP012",11,0)
 ;
"RTN","RORRP012",12,0)
 ; Return Values:
"RTN","RORRP012",13,0)
 ;
"RTN","RORRP012",14,0)
 ; The current dat/time (in internal FileMan format) is returned
"RTN","RORRP012",15,0)
 ; in the RESULTS(1). RESULTS(0) alwais contains 0.
"RTN","RORRP012",16,0)
 ;
"RTN","RORRP012",17,0)
GETSRVDT(RESULTS) ;
"RTN","RORRP012",18,0)
 S RESULTS(0)=0
"RTN","RORRP012",19,0)
 S RESULTS(1)=$$NOW^XLFDT
"RTN","RORRP012",20,0)
 Q
"RTN","RORRP012",21,0)
 ;
"RTN","RORRP012",22,0)
 ;***** RETURNS A LIST OF ITEMS FROM THE 'ROR LIST ITEM' FILE
"RTN","RORRP012",23,0)
 ; RPC: [ROR LIST ITEMS]
"RTN","RORRP012",24,0)
 ;
"RTN","RORRP012",25,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP012",26,0)
 ;               are returned to.
"RTN","RORRP012",27,0)
 ;
"RTN","RORRP012",28,0)
 ; REGIEN        Registry IEN
"RTN","RORRP012",29,0)
 ;
"RTN","RORRP012",30,0)
 ; TYPE          Type of the items:
"RTN","RORRP012",31,0)
 ;                 3  Lab Group
"RTN","RORRP012",32,0)
 ;                 4  Drug Group
"RTN","RORRP012",33,0)
 ;
"RTN","RORRP012",34,0)
 ; Return Values:
"RTN","RORRP012",35,0)
 ;
"RTN","RORRP012",36,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP012",37,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP012",38,0)
 ; details).
"RTN","RORRP012",39,0)
 ;
"RTN","RORRP012",40,0)
 ; Otherwise, number of items is returned in the RESULTS(0)
"RTN","RORRP012",41,0)
 ; and the subsequent nodes of the array contain the items.
"RTN","RORRP012",42,0)
 ; 
"RTN","RORRP012",43,0)
 ; RESULTS(0)            Number of item
"RTN","RORRP012",44,0)
 ;
"RTN","RORRP012",45,0)
 ; RESULTS(i)            List Item
"RTN","RORRP012",46,0)
 ;                         ^01: IEN
"RTN","RORRP012",47,0)
 ;                         ^02: Text
"RTN","RORRP012",48,0)
 ;                         ^03: Code
"RTN","RORRP012",49,0)
 ;
"RTN","RORRP012",50,0)
LSTITEMS(RESULTS,REGIEN,TYPE) ;
"RTN","RORRP012",51,0)
 N CNT,CODE,ITEMS,RC,RORERRDL
"RTN","RORRP012",52,0)
 D CLEAR^RORERR("LSTITEMS^RORRP012",1)
"RTN","RORRP012",53,0)
 K RESULTS  S RESULTS(0)=0
"RTN","RORRP012",54,0)
 ;--- Check the parameters
"RTN","RORRP012",55,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP012",56,0)
 . ;--- Registry IEN
"RTN","RORRP012",57,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP012",58,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP012",59,0)
 . S REGIEN=+REGIEN
"RTN","RORRP012",60,0)
 . ;--- Type
"RTN","RORRP012",61,0)
 . I $G(TYPE)'>0  D  Q
"RTN","RORRP012",62,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"TYPE",$G(TYPE))
"RTN","RORRP012",63,0)
 . S TYPE=+TYPE
"RTN","RORRP012",64,0)
 ;--- Load the list items
"RTN","RORRP012",65,0)
 S RC=$$ITEMLIST^RORUTL09(TYPE,REGIEN,.ITEMS)
"RTN","RORRP012",66,0)
 ;--- Populate the output array
"RTN","RORRP012",67,0)
 S CODE="",CNT=0
"RTN","RORRP012",68,0)
 F  S CODE=$O(ITEMS(CODE))  Q:CODE=""  D
"RTN","RORRP012",69,0)
 . S CNT=CNT+1,RESULTS(CNT)=$P(ITEMS(CODE),U,1,2)
"RTN","RORRP012",70,0)
 . S $P(RESULTS(CNT),U,3)=CODE
"RTN","RORRP012",71,0)
 S RESULTS(0)=CNT
"RTN","RORRP012",72,0)
 Q
"RTN","RORRP012",73,0)
 ;
"RTN","RORRP012",74,0)
 ;***** CHECKS FOR PRODUCTION ACCOUNT
"RTN","RORRP012",75,0)
 ; RPC: [ROR PRODUCTION ACCOUNT]
"RTN","RORRP012",76,0)
 ;
"RTN","RORRP012",77,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP012",78,0)
 ;               are returned to.
"RTN","RORRP012",79,0)
 ;
"RTN","RORRP012",80,0)
 ; Return Values:
"RTN","RORRP012",81,0)
 ;
"RTN","RORRP012",82,0)
 ; 1 is returned in RESULTS(0) in case of a production account.
"RTN","RORRP012",83,0)
 ; Otherwise, zero is returned.
"RTN","RORRP012",84,0)
 ;
"RTN","RORRP012",85,0)
PROD(RESULTS) ;
"RTN","RORRP012",86,0)
 S RESULTS(0)=+$$PROD^XUPROD()
"RTN","RORRP012",87,0)
 Q
"RTN","RORRP012",88,0)
 ;
"RTN","RORRP012",89,0)
 ;***** CHECKS IF THE RESCHEDULING CODE IS VALID
"RTN","RORRP012",90,0)
 ; ROR: [ROR TASK VALIDATE RESCHEDULING]
"RTN","RORRP012",91,0)
 ;
"RTN","RORRP012",92,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP012",93,0)
 ;               are returned to.
"RTN","RORRP012",94,0)
 ;
"RTN","RORRP012",95,0)
 ; SCHCODE       Rescheduling code
"RTN","RORRP012",96,0)
 ;
"RTN","RORRP012",97,0)
 ; [SCHDT]       Date when a task is scheduled to run for the
"RTN","RORRP012",98,0)
 ;               first time (FileMan). By default (if $G(SCHDT)'>0),
"RTN","RORRP012",99,0)
 ;               the current date/time is used.
"RTN","RORRP012",100,0)
 ;
"RTN","RORRP012",101,0)
 ; Return Values:
"RTN","RORRP012",102,0)
 ;
"RTN","RORRP012",103,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP012",104,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP012",105,0)
 ;
"RTN","RORRP012",106,0)
 ; Otherwise, either 1 (the rescheduling code is valid) or 0 (the
"RTN","RORRP012",107,0)
 ; code is not valid) is returned in the RESULTS(0). If the code is
"RTN","RORRP012",108,0)
 ; valid then the next date/time to run the task (FileMan format)
"RTN","RORRP012",109,0)
 ; is returned in the RESULTS(1).
"RTN","RORRP012",110,0)
 ;
"RTN","RORRP012",111,0)
VALIDSCH(RESULTS,SCHCODE,SCHDT) ;
"RTN","RORRP012",112,0)
 N NEXT,RORMSG,TMP  K RESULTS
"RTN","RORRP012",113,0)
 I $G(SCHCODE)=""  S RESULTS(0)=1  Q
"RTN","RORRP012",114,0)
 S RESULTS(0)=0
"RTN","RORRP012",115,0)
 ;--- Check if the rescheduling code is correct
"RTN","RORRP012",116,0)
 S:$G(SCHDT)'>0 SCHDT=$$NOW^XLFDT
"RTN","RORRP012",117,0)
 S NEXT=$$SCH^XLFDT(SCHCODE,SCHDT,1)
"RTN","RORRP012",118,0)
 Q:NEXT'>0
"RTN","RORRP012",119,0)
 ;--- Make sure that a task will not be rescheduled in less
"RTN","RORRP012",120,0)
 ;--- than 60 seconds (to be able to delete it if necessary)
"RTN","RORRP012",121,0)
 S TMP=$$SCH^XLFDT(SCHCODE,NEXT,1)
"RTN","RORRP012",122,0)
 S:$$FMDIFF^XLFDT(TMP,NEXT,2)'<60 RESULTS(0)=1,RESULTS(1)=NEXT
"RTN","RORRP012",123,0)
 Q
"RTN","RORRP013")
0^1^B24923269
"RTN","RORRP013",1,0)
RORRP013 ;HCIOFO/SG - RPC: ACCESS & SECURITY ; 11/9/05 8:56am
"RTN","RORRP013",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP013",3,0)
 ;
"RTN","RORRP013",4,0)
 Q
"RTN","RORRP013",5,0)
 ;
"RTN","RORRP013",6,0)
 ;***** RETURNS A LIST OF REGISTRIES ACCESSIBLE TO THE GUI USER
"RTN","RORRP013",7,0)
 ; RPC: [ROR GUI ACCESS]
"RTN","RORRP013",8,0)
 ;
"RTN","RORRP013",9,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP013",10,0)
 ;               are returned to.
"RTN","RORRP013",11,0)
 ;
"RTN","RORRP013",12,0)
 ; [USER]        User IEN in the NEW PERSON file. By default
"RTN","RORRP013",13,0)
 ;               (if $G(USER)'>0), the DUZ is used).
"RTN","RORRP013",14,0)
 ;
"RTN","RORRP013",15,0)
 ; Return Values:
"RTN","RORRP013",16,0)
 ;
"RTN","RORRP013",17,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP013",18,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP013",19,0)
 ; 
"RTN","RORRP013",20,0)
 ; RESULTS(0)            Number of accessible registries
"RTN","RORRP013",21,0)
 ;
"RTN","RORRP013",22,0)
 ; RESULTS(i)            Registry descriptor
"RTN","RORRP013",23,0)
 ;                         ^01: Registry IEN
"RTN","RORRP013",24,0)
 ;                         ^02: Registry name
"RTN","RORRP013",25,0)
 ;                         ^03: Administrator? (0 or 1)
"RTN","RORRP013",26,0)
 ;                         ^04: Short description
"RTN","RORRP013",27,0)
 ;
"RTN","RORRP013",28,0)
ACREGLST(RESULTS,USER) ;
"RTN","RORRP013",29,0)
 N ADMIN,CNT,IENS,KEY,RC,REGIEN,RORBUF,RORERRDL,RORMSG,TMP
"RTN","RORRP013",30,0)
 K RESULTS  S RESULTS(0)=0
"RTN","RORRP013",31,0)
 D CLEAR^RORERR("ACREGLST^RORRP013",1)
"RTN","RORRP013",32,0)
 ;--- Check the version of the GUI
"RTN","RORRP013",33,0)
 I $G(XWBAPVER)<1.5  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP013",34,0)
 . N DIERR,DIHELP,DIMSG
"RTN","RORRP013",35,0)
 . S TMP("CV")=$S($G(XWBAPVER)>0:XWBAPVER,1:"1.0")
"RTN","RORRP013",36,0)
 . S TMP("RV")="1.5"
"RTN","RORRP013",37,0)
 . D BLD^DIALOG(7980000.006,.TMP,,"RORBUF")
"RTN","RORRP013",38,0)
 . S RC=$$ERROR^RORERR(-107,,.RORBUF)
"RTN","RORRP013",39,0)
 . K RORBUF,TMP
"RTN","RORRP013",40,0)
 ;--- User must be defined
"RTN","RORRP013",41,0)
 I $G(USER)'>0  S USER=+$G(DUZ)  Q:USER'>0
"RTN","RORRP013",42,0)
 ;
"RTN","RORRP013",43,0)
 S (CNT,RC,REGIEN)=0
"RTN","RORRP013",44,0)
 F  S REGIEN=$O(^ROR(798.1,"ACL",USER,REGIEN))  Q:REGIEN=""  D  Q:RC<0
"RTN","RORRP013",45,0)
 . Q:REGIEN'>0  S IENS=REGIEN_","  K RORBUF
"RTN","RORRP013",46,0)
 . D GETS^DIQ(798.1,IENS,".01;4",,"RORBUF","RORMSG")
"RTN","RORRP013",47,0)
 . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,,798.1,IENS)  Q
"RTN","RORRP013",48,0)
 . ;--- Add the registry descriptor to the list
"RTN","RORRP013",49,0)
 . S CNT=CNT+1,RESULTS(CNT)=REGIEN_"^"_$G(RORBUF(798.1,IENS,.01))
"RTN","RORRP013",50,0)
 . S $P(RESULTS(CNT),"^",4)=$G(RORBUF(798.1,IENS,4))
"RTN","RORRP013",51,0)
 . ;--- Check if the user has the administrator security key
"RTN","RORRP013",52,0)
 . S KEY="",ADMIN=0
"RTN","RORRP013",53,0)
 . F  S KEY=$O(^ROR(798.1,"ACL",USER,REGIEN,KEY))  Q:KEY=""  D  Q:RC<0
"RTN","RORRP013",54,0)
 . . I KEY?1"ROR"1.E  S:KEY["ADMIN" ADMIN=1
"RTN","RORRP013",55,0)
 . S $P(RESULTS(CNT),"^",3)=ADMIN
"RTN","RORRP013",56,0)
 ;
"RTN","RORRP013",57,0)
 I RC'<0  D:CNT'>0  S RESULTS(0)=CNT
"RTN","RORRP013",58,0)
 . D ACVIOLTN^RORLOG(-91)  ; Record the access violation
"RTN","RORRP013",59,0)
 E  D RPCSTK^RORERR(.RESULTS,RC)
"RTN","RORRP013",60,0)
 Q
"RTN","RORRP013",61,0)
 ;
"RTN","RORRP013",62,0)
 ;***** RETURNS THE LIST OF ACCESS VIOLATIONS
"RTN","RORRP013",63,0)
 ; RPC: [ROR LOG GET ACCESS VIOLATIONS]
"RTN","RORRP013",64,0)
 ;
"RTN","RORRP013",65,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP013",66,0)
 ;               are returned to.
"RTN","RORRP013",67,0)
 ;
"RTN","RORRP013",68,0)
 ; [STDT]        Start date (by default, from the earliest violation)
"RTN","RORRP013",69,0)
 ; [ENDT]        End date (by default, to the latest violation)
"RTN","RORRP013",70,0)
 ;
"RTN","RORRP013",71,0)
 ; Return Values:
"RTN","RORRP013",72,0)
 ;
"RTN","RORRP013",73,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP013",74,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP013",75,0)
 ;
"RTN","RORRP013",76,0)
 ; Otherwise, number of logs is returned in the RESULTS(0) and the
"RTN","RORRP013",77,0)
 ; subsequent nodes of the RESULTS array contain the violations.
"RTN","RORRP013",78,0)
 ; 
"RTN","RORRP013",79,0)
 ; @RESULTS@(0)          Number of access violations
"RTN","RORRP013",80,0)
 ;
"RTN","RORRP013",81,0)
 ; @RESULTS@(i)          Access violation descriptor
"RTN","RORRP013",82,0)
 ;                         ^01: Date/Time (int)
"RTN","RORRP013",83,0)
 ;                         ^02: User Name
"RTN","RORRP013",84,0)
 ;                         ^03: User IEN
"RTN","RORRP013",85,0)
 ;                         ^04: Message
"RTN","RORRP013",86,0)
 ;
"RTN","RORRP013",87,0)
AVLIST(RESULTS,STDT,ENDT) ;
"RTN","RORRP013",88,0)
 N BUF,CNT,DATE,IEN,IENS,RC,ROOT,RORBUF,RORERRDL,RORMSG
"RTN","RORRP013",89,0)
 D CLEAR^RORERR("AVLIST^RORRP013",1)
"RTN","RORRP013",90,0)
 ;--- Check the parameters
"RTN","RORRP013",91,0)
 S STDT=$G(STDT)\1,ENDT=$G(ENDT)\1
"RTN","RORRP013",92,0)
 S ENDT=$S(ENDT>0:$$FMADD^XLFDT(ENDT,1),1:9999999)
"RTN","RORRP013",93,0)
 ;--- Initialize the variables
"RTN","RORRP013",94,0)
 S ROOT=$$ROOT^DILFD(798.7,,1),CNT=0
"RTN","RORRP013",95,0)
 K RESULTS  S RESULTS=$$ALLOC^RORTMP()
"RTN","RORRP013",96,0)
 ;--- Browse through the logs
"RTN","RORRP013",97,0)
 S DATE=STDT
"RTN","RORRP013",98,0)
 F  S DATE=$O(@ROOT@("B",DATE))  Q:DATE=""  Q:DATE'<ENDT  D
"RTN","RORRP013",99,0)
 . S IEN=0
"RTN","RORRP013",100,0)
 . F  S IEN=$O(@ROOT@("B",DATE,IEN))  Q:IEN'>0  D
"RTN","RORRP013",101,0)
 . . S IENS=IEN_","  K RORBUF
"RTN","RORRP013",102,0)
 . . D GETS^DIQ(798.7,IENS,".01;1;7","EI","RORBUF","RORMSG")
"RTN","RORRP013",103,0)
 . . Q:$G(DIERR)
"RTN","RORRP013",104,0)
 . . ;--- Check for the 'Access Violation' Activity
"RTN","RORRP013",105,0)
 . . Q:$G(RORBUF(798.7,IENS,1,"I"))'=6
"RTN","RORRP013",106,0)
 . . ;--- Date/Time of the event
"RTN","RORRP013",107,0)
 . . S BUF=$G(RORBUF(798.7,IENS,.01,"I"))
"RTN","RORRP013",108,0)
 . . ;--- User Name (ext)
"RTN","RORRP013",109,0)
 . . S $P(BUF,"^",2)=$G(RORBUF(798.7,IENS,7,"E"))
"RTN","RORRP013",110,0)
 . . ;--- User IEN (int)
"RTN","RORRP013",111,0)
 . . S $P(BUF,"^",3)=$G(RORBUF(798.7,IENS,7,"I"))
"RTN","RORRP013",112,0)
 . . ;--- Message
"RTN","RORRP013",113,0)
 . . S $P(BUF,"^",4)=$$GET1^DIQ(798.74,"1,"_IENS,2,,,"RORMSG")
"RTN","RORRP013",114,0)
 . . ;--- Add the record to the output
"RTN","RORRP013",115,0)
 . . S CNT=CNT+1,@RESULTS@(CNT)=BUF
"RTN","RORRP013",116,0)
 ;--- Number of violations
"RTN","RORRP013",117,0)
 S @RESULTS@(0)=CNT
"RTN","RORRP013",118,0)
 Q
"RTN","RORRP013",119,0)
 ;
"RTN","RORRP013",120,0)
 ;***** ADDS THE USERS WHO HAVE THE SECURITY KEY TO THE LIST
"RTN","RORRP013",121,0)
 ;
"RTN","RORRP013",122,0)
 ; KEYNAME       Name of the security key
"RTN","RORRP013",123,0)
 ; ACCESS        Level of the user access to the registry
"RTN","RORRP013",124,0)
 ;               (1-User, 2-Administrator, 3-IRM)
"RTN","RORRP013",125,0)
 ;
"RTN","RORRP013",126,0)
 ; Return Values:
"RTN","RORRP013",127,0)
 ;
"RTN","RORRP013",128,0)
KLIST(KEYNAME,ACCESS) ;
"RTN","RORRP013",129,0)
 N IEN  S IEN=0
"RTN","RORRP013",130,0)
 F  S IEN=$O(^XUSEC(KEYNAME,IEN))  Q:IEN'>0  D
"RTN","RORRP013",131,0)
 . S $P(@RORULST@(IEN,0),"^",ACCESS)=1
"RTN","RORRP013",132,0)
 Q
"RTN","RORRP013",133,0)
 ;
"RTN","RORRP013",134,0)
 ;***** RETURNS THE LIST OF REGISTRY USERS
"RTN","RORRP013",135,0)
 ; RPC: [ROR GET REGISTRY USERS]
"RTN","RORRP013",136,0)
 ;
"RTN","RORRP013",137,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP013",138,0)
 ;               are returned to.
"RTN","RORRP013",139,0)
 ;
"RTN","RORRP013",140,0)
 ; REGIEN        Registry IEN
"RTN","RORRP013",141,0)
 ;
"RTN","RORRP013",142,0)
 ; Return Values:
"RTN","RORRP013",143,0)
 ;
"RTN","RORRP013",144,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP013",145,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP013",146,0)
 ;
"RTN","RORRP013",147,0)
 ; Otherwise, number of users is returned in the RESULTS(0) and the
"RTN","RORRP013",148,0)
 ; subsequent nodes of the RESULTS array contain the users.
"RTN","RORRP013",149,0)
 ; 
"RTN","RORRP013",150,0)
 ; @RESULTS@(0)          Number of users
"RTN","RORRP013",151,0)
 ;
"RTN","RORRP013",152,0)
 ; @RESULTS@(i)          User descriptor
"RTN","RORRP013",153,0)
 ;                         ^01: User IEN (DUZ)
"RTN","RORRP013",154,0)
 ;                         ^02: User Name
"RTN","RORRP013",155,0)
 ;                         ^03: User          (0/1)
"RTN","RORRP013",156,0)
 ;                         ^04: Administrator (0/1)
"RTN","RORRP013",157,0)
 ;                         ^05: IRM           (0/1)
"RTN","RORRP013",158,0)
 ;
"RTN","RORRP013",159,0)
USERLIST(RESULTS,REGIEN) ;
"RTN","RORRP013",160,0)
 N ACCESS,ADMIN,CNT,IEN,NAME,RORERRDL,RORMSG,RORULST
"RTN","RORRP013",161,0)
 D CLEAR^RORERR("USERLIST^RORRP013",1)
"RTN","RORRP013",162,0)
 ;--- Check the parameters
"RTN","RORRP013",163,0)
 I $G(REGIEN)'>0  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP013",164,0)
 . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP013",165,0)
 S REGIEN=+REGIEN
"RTN","RORRP013",166,0)
 ;--- Initialize the variables
"RTN","RORRP013",167,0)
 K RESULTS  S RESULTS=$$ALLOC^RORTMP()
"RTN","RORRP013",168,0)
 S RORULST=$$ALLOC^RORTMP()
"RTN","RORRP013",169,0)
 ;--- Browse the security keys
"RTN","RORRP013",170,0)
 S NAME=""
"RTN","RORRP013",171,0)
 F  S NAME=$O(^ROR(798.1,REGIEN,18,"B",NAME))  Q:NAME=""  D
"RTN","RORRP013",172,0)
 . S ADMIN=(NAME?1"ROR"1.E)&(NAME["ADMIN")
"RTN","RORRP013",173,0)
 . D KLIST(NAME,$S(ADMIN:2,1:1))
"RTN","RORRP013",174,0)
 ;--- Add the authorized IRM personnel
"RTN","RORRP013",175,0)
 D KLIST("ROR VA IRM",3)
"RTN","RORRP013",176,0)
 ;--- Sort the users by their names
"RTN","RORRP013",177,0)
 S IEN=0
"RTN","RORRP013",178,0)
 F  S IEN=$O(@RORULST@(IEN))  Q:IEN'>0  D
"RTN","RORRP013",179,0)
 . S NAME=$$GET1^DIQ(200,IEN_",",.01,,,"RORMSG")
"RTN","RORRP013",180,0)
 . S:NAME'="" @RORULST@("B",NAME,IEN)=""
"RTN","RORRP013",181,0)
 ;--- Generate the output
"RTN","RORRP013",182,0)
 S NAME="",CNT=0
"RTN","RORRP013",183,0)
 F  S NAME=$O(@RORULST@("B",NAME)) Q:NAME=""  D
"RTN","RORRP013",184,0)
 . S IEN=0
"RTN","RORRP013",185,0)
 . F  S IEN=$O(@RORULST@("B",NAME,IEN)) Q:IEN'>0  D
"RTN","RORRP013",186,0)
 . . S ACCESS=$G(@RORULST@(IEN,0))
"RTN","RORRP013",187,0)
 . . S CNT=CNT+1,@RESULTS@(CNT)=IEN_"^"_NAME_"^"_ACCESS
"RTN","RORRP013",188,0)
 S @RESULTS@(0)=CNT
"RTN","RORRP013",189,0)
 ;--- Cleanup
"RTN","RORRP013",190,0)
 D FREE^RORTMP(RORULST)
"RTN","RORRP013",191,0)
 Q
"RTN","RORRP014")
0^93^B14432703
"RTN","RORRP014",1,0)
RORRP014 ;HCIOFO/SG - RPC: REGISTRY INFO & PARAMETERS ; 11/14/05 8:31am
"RTN","RORRP014",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP014",3,0)
 ;
"RTN","RORRP014",4,0)
 Q
"RTN","RORRP014",5,0)
 ;
"RTN","RORRP014",6,0)
 ;***** RETURNS THE REGISTRY INFORMATION
"RTN","RORRP014",7,0)
 ; RPC: [ROR GET REGISTRY INFO]
"RTN","RORRP014",8,0)
 ;
"RTN","RORRP014",9,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP014",10,0)
 ;               are returned to.
"RTN","RORRP014",11,0)
 ;
"RTN","RORRP014",12,0)
 ; REGISTRY      Either a registry IEN or a registry name
"RTN","RORRP014",13,0)
 ;
"RTN","RORRP014",14,0)
 ; Return Values:
"RTN","RORRP014",15,0)
 ;
"RTN","RORRP014",16,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP014",17,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP014",18,0)
 ;
"RTN","RORRP014",19,0)
 ; Otherwise, 0 is returned in the RESULTS(0) and the subsequent
"RTN","RORRP014",20,0)
 ; nodes of the RESULTS array contain the registry information.
"RTN","RORRP014",21,0)
 ; 
"RTN","RORRP014",22,0)
 ; RESULTS(0)            0
"RTN","RORRP014",23,0)
 ;
"RTN","RORRP014",24,0)
 ; RESULTS(1)            Registry
"RTN","RORRP014",25,0)
 ;                         ^01: IEN
"RTN","RORRP014",26,0)
 ;                         ^02: Name
"RTN","RORRP014",27,0)
 ;
"RTN","RORRP014",28,0)
 ; RESULTS(2)            National (0/1)
"RTN","RORRP014",29,0)
 ;
"RTN","RORRP014",30,0)
 ; RESULTS(3)            Registry Description
"RTN","RORRP014",31,0)
 ;
"RTN","RORRP014",32,0)
 ; RESULTS(4)            Last registry update date (int)
"RTN","RORRP014",33,0)
 ;
"RTN","RORRP014",34,0)
 ; RESULTS(5)            Last data extraction date (int)
"RTN","RORRP014",35,0)
 ;
"RTN","RORRP014",36,0)
 ; RESULTS(6)            Number of Active Patients
"RTN","RORRP014",37,0)
 ;
"RTN","RORRP014",38,0)
 ; RESULTS(7)            Number of Pending Patients
"RTN","RORRP014",39,0)
 ;
"RTN","RORRP014",40,0)
 ; RESULTS(8)            Registry Status
"RTN","RORRP014",41,0)
 ;                         ^01: Internal value (0-Active, 1-Inactive)
"RTN","RORRP014",42,0)
 ;                         ^02: External value
"RTN","RORRP014",43,0)
 ;
"RTN","RORRP014",44,0)
 ; RESULTS(9)            reserved
"RTN","RORRP014",45,0)
 ;
"RTN","RORRP014",46,0)
 ; RESULTS(10)           Version information
"RTN","RORRP014",47,0)
 ;                         ^01: Package version
"RTN","RORRP014",48,0)
 ;                         ^02: Latest patch number
"RTN","RORRP014",49,0)
 ;                         ^03: Date of the latest patch (int)
"RTN","RORRP014",50,0)
 ;
"RTN","RORRP014",51,0)
REGINFO(RESULTS,REGISTRY) ;
"RTN","RORRP014",52,0)
 N IENS,RC,REGIEN,RORBUF,RORERRDL,RORMSG,TMP
"RTN","RORRP014",53,0)
 D CLEAR^RORERR("REGINFO^RORRP014",1)
"RTN","RORRP014",54,0)
 ;--- Check the parameters
"RTN","RORRP014",55,0)
 S TMP=$$UP^XLFSTR($G(REGISTRY)),REGIEN=+TMP
"RTN","RORRP014",56,0)
 I TMP'=REGIEN  D:TMP?3.UNP
"RTN","RORRP014",57,0)
 . S REGIEN=$$REGIEN^RORUTL02(TMP)
"RTN","RORRP014",58,0)
 . S:REGIEN<0 TMP=$$ERROR^RORERR(REGIEN)
"RTN","RORRP014",59,0)
 I REGIEN'>0  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP014",60,0)
 . S RC=$$ERROR^RORERR(-88,,,,"REGISTRY",$G(REGISTRY))
"RTN","RORRP014",61,0)
 ;--- Initialize the variables
"RTN","RORRP014",62,0)
 K RESULTS
"RTN","RORRP014",63,0)
 ;--- Load the registry info
"RTN","RORRP014",64,0)
 S IENS=REGIEN_",",TMP=".01;.09;1;2;4;11;19.1;19.2"
"RTN","RORRP014",65,0)
 D GETS^DIQ(798.1,IENS,TMP,"I","RORBUF","RORMSG")
"RTN","RORRP014",66,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP014",67,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","RORRP014",68,0)
 ;--- Registry IEN and Name
"RTN","RORRP014",69,0)
 S RESULTS(1)=REGIEN_"^"_$G(RORBUF(798.1,IENS,.01,"I"))
"RTN","RORRP014",70,0)
 ;--- National
"RTN","RORRP014",71,0)
 S RESULTS(2)=+$G(RORBUF(798.1,IENS,.09,"I"))
"RTN","RORRP014",72,0)
 ;--- Registry Description
"RTN","RORRP014",73,0)
 S RESULTS(3)=$G(RORBUF(798.1,IENS,4,"I"))
"RTN","RORRP014",74,0)
 ;--- Registry Updated Until
"RTN","RORRP014",75,0)
 S RESULTS(4)=$G(RORBUF(798.1,IENS,1,"I"))
"RTN","RORRP014",76,0)
 ;--- Data Extracted Until
"RTN","RORRP014",77,0)
 S RESULTS(5)=$G(RORBUF(798.1,IENS,2,"I"))
"RTN","RORRP014",78,0)
 ;--- Number of Active Patients
"RTN","RORRP014",79,0)
 S RESULTS(6)=+$G(RORBUF(798.1,IENS,19.1,"I"))
"RTN","RORRP014",80,0)
 ;--- Number of Pending Patients
"RTN","RORRP014",81,0)
 S RESULTS(7)=+$G(RORBUF(798.1,IENS,19.2,"I"))
"RTN","RORRP014",82,0)
 ;--- Registry Status
"RTN","RORRP014",83,0)
 S TMP=+$G(RORBUF(798.1,IENS,11,"I"))
"RTN","RORRP014",84,0)
 S $P(TMP,"^",2)=$$EXTERNAL^DILFD(798.1,11,,TMP,"RORMSG")
"RTN","RORRP014",85,0)
 S RESULTS(8)=TMP
"RTN","RORRP014",86,0)
 ;--- reserved (former Awaiting Acknowledgement)
"RTN","RORRP014",87,0)
 S RESULTS(9)=""
"RTN","RORRP014",88,0)
 ;--- Version information
"RTN","RORRP014",89,0)
 S TMP="CLINICAL CASE REGISTRIES"
"RTN","RORRP014",90,0)
 S RESULTS(10)=$$VERSION^XPDUTL(TMP),TMP=$$LAST^XPDUTL(TMP)
"RTN","RORRP014",91,0)
 S:TMP>0 $P(RESULTS(10),"^",2,3)=+TMP_"^"_$P(TMP,U,2)
"RTN","RORRP014",92,0)
 ;---
"RTN","RORRP014",93,0)
 S RESULTS(0)=0
"RTN","RORRP014",94,0)
 Q
"RTN","RORRP014",95,0)
 ;
"RTN","RORRP014",96,0)
 ;***** RETURNS LIST OF REGISTRY SELECTION RULES
"RTN","RORRP014",97,0)
 ; RPC: [ROR LIST SELECTION RULES]
"RTN","RORRP014",98,0)
 ;
"RTN","RORRP014",99,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP014",100,0)
 ;               are returned to.
"RTN","RORRP014",101,0)
 ;
"RTN","RORRP014",102,0)
 ; REGIEN        Registry IEN
"RTN","RORRP014",103,0)
 ;
"RTN","RORRP014",104,0)
 ; See the description of the ROR LIST SELECTION RULES remote
"RTN","RORRP014",105,0)
 ; procedure for more details.
"RTN","RORRP014",106,0)
 ;
"RTN","RORRP014",107,0)
 ; Return Values:
"RTN","RORRP014",108,0)
 ;
"RTN","RORRP014",109,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) node
"RTN","RORRP014",110,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for details).
"RTN","RORRP014",111,0)
 ;
"RTN","RORRP014",112,0)
SELRULES(RESULTS,REGIEN) ;
"RTN","RORRP014",113,0)
 N CNT,IEN,IENS,IRL,RC,RORBUF,RORLST,RORMSG
"RTN","RORRP014",114,0)
 D CLEAR^RORERR("SELRULES^RORRP014",1)
"RTN","RORRP014",115,0)
 K RESULTS  S (RESULTS(0),CNT)=0
"RTN","RORRP014",116,0)
 ;
"RTN","RORRP014",117,0)
 ;=== Check the parameters
"RTN","RORRP014",118,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP014",119,0)
 . ;--- Registry IEN
"RTN","RORRP014",120,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP014",121,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP014",122,0)
 . S REGIEN=+REGIEN
"RTN","RORRP014",123,0)
 ;
"RTN","RORRP014",124,0)
 ;=== Load the list of selection rules
"RTN","RORRP014",125,0)
 S IENS=","_REGIEN_","
"RTN","RORRP014",126,0)
 D LIST^DIC(798.13,IENS,"@;.01",,,,,"B",,,"RORLST","RORMSG")
"RTN","RORRP014",127,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP014",128,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.13,IENS)
"RTN","RORRP014",129,0)
 ;
"RTN","RORRP014",130,0)
 ;=== Add rule definitions to the results
"RTN","RORRP014",131,0)
 S IRL=0
"RTN","RORRP014",132,0)
 F  S IRL=$O(RORLST("DILIST","ID",IRL))  Q:IRL'>0  D
"RTN","RORRP014",133,0)
 . K RORBUF,RORMSG
"RTN","RORRP014",134,0)
 . S NAME=RORLST("DILIST","ID",IRL,.01)
"RTN","RORRP014",135,0)
 . S IEN=$$SRLIEN^RORUTL02(NAME,".01;4",.RORBUF)  Q:IEN'>0
"RTN","RORRP014",136,0)
 . S CNT=CNT+1,RESULTS(CNT)=IEN
"RTN","RORRP014",137,0)
 . S $P(RESULTS(CNT),U,2)=$G(RORBUF("DILIST","ID",1,.01))
"RTN","RORRP014",138,0)
 . S $P(RESULTS(CNT),U,3)=$G(RORBUF("DILIST","ID",1,4))
"RTN","RORRP014",139,0)
 ;
"RTN","RORRP014",140,0)
 ;=== Success
"RTN","RORRP014",141,0)
 S RESULTS(0)=CNT
"RTN","RORRP014",142,0)
 Q
"RTN","RORRP015")
0^94^B22373114
"RTN","RORRP015",1,0)
RORRP015 ;HCIOFO/SG - RPC: DIVISIONS AND HOSPITAL LOCATIONS ; 1/23/06 2:27pm
"RTN","RORRP015",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP015",3,0)
 ;
"RTN","RORRP015",4,0)
 ; This routine uses the following IAs:
"RTN","RORRP015",5,0)
 ;
"RTN","RORRP015",6,0)
 ; #????         Access to the file #40.8 (???: 3433)
"RTN","RORRP015",7,0)
 ; #1246         WIN^DGPMDDCF (supported)
"RTN","RORRP015",8,0)
 ; #10040        Access to the HOSPITAL LOCATION file (supported)
"RTN","RORRP015",9,0)
 ;           ??? Add DIVISION (3.5) to DBIA #10040
"RTN","RORRP015",10,0)
 ;
"RTN","RORRP015",11,0)
 Q
"RTN","RORRP015",12,0)
 ;
"RTN","RORRP015",13,0)
 ;***** CHECKS IF THE HOSPITAL LOCATION IS ACTIVE
"RTN","RORRP015",14,0)
 ;
"RTN","RORRP015",15,0)
 ; LOCIEN        IEN of the hospital location
"RTN","RORRP015",16,0)
 ;
"RTN","RORRP015",17,0)
ACTLOC(LOCIEN) ;
"RTN","RORRP015",18,0)
 N D0,DGPMOS,RDT,X
"RTN","RORRP015",19,0)
 Q:$G(^SC(LOCIEN,"OOS")) 0              ; An OOS entry
"RTN","RORRP015",20,0)
 S D0=+$G(^SC(LOCIEN,42))
"RTN","RORRP015",21,0)
 I D0>0  D WIN^DGPMDDCF  Q 'X           ; Check if ward is inactive
"RTN","RORRP015",22,0)
 S X=$G(^SC(LOCIEN,"I"))  Q:'$P(X,U) 1  ; No inactivation date
"RTN","RORRP015",23,0)
 S RDT=+$P(X,U,2)
"RTN","RORRP015",24,0)
 I DT>$P(X,U)  Q:'RDT!(DT<RDT) 0        ; Check reactivation date
"RTN","RORRP015",25,0)
 Q 1
"RTN","RORRP015",26,0)
 ;
"RTN","RORRP015",27,0)
 ;***** RETURNS THE LIST OF DIVISIONS
"RTN","RORRP015",28,0)
 ; RPC: [ROR LIST DIVISIONS]
"RTN","RORRP015",29,0)
 ;
"RTN","RORRP015",30,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP015",31,0)
 ;               are returned to.
"RTN","RORRP015",32,0)
 ;
"RTN","RORRP015",33,0)
 ; [PART]        The partial match restriction.
"RTN","RORRP015",34,0)
 ;
"RTN","RORRP015",35,0)
 ; [FLAGS]       Flags that control the execution (can be combined)
"RTN","RORRP015",36,0)
 ;                 B  Backwards. Traverses the index in the opposite
"RTN","RORRP015",37,0)
 ;                    direction of normal traversal.
"RTN","RORRP015",38,0)
 ;
"RTN","RORRP015",39,0)
 ; [NUMBER]      Maximum number of entries to return. A value of "*"
"RTN","RORRP015",40,0)
 ;               or no value in this parameter designates all entries.
"RTN","RORRP015",41,0)
 ;
"RTN","RORRP015",42,0)
 ; [FROM]        The index entry(s) from which to begin the list
"RTN","RORRP015",43,0)
 ;                 ^01: FromName
"RTN","RORRP015",44,0)
 ;                 ^02: FromIEN
"RTN","RORRP015",45,0)
 ;
"RTN","RORRP015",46,0)
 ;               For example, a FROM value of "VA" would list entries
"RTN","RORRP015",47,0)
 ;               following VA. You can use the 2-nd and 3-rd "^"-
"RTN","RORRP015",48,0)
 ;               pieces of the @RESULTS@(0) node to continue the
"RTN","RORRP015",49,0)
 ;               listing in the subsequent procedure calls.
"RTN","RORRP015",50,0)
 ;
"RTN","RORRP015",51,0)
 ;               NOTE: The FROM value itself is not included in
"RTN","RORRP015",52,0)
 ;                     the resulting list.
"RTN","RORRP015",53,0)
 ;
"RTN","RORRP015",54,0)
 ; The ^TMP("DILIST",$J) global node is used by the procedure.
"RTN","RORRP015",55,0)
 ;
"RTN","RORRP015",56,0)
 ; See description of the LIST^DIC for more details about the
"RTN","RORRP015",57,0)
 ; PART, NUMBER and FROM parameters.
"RTN","RORRP015",58,0)
 ;
"RTN","RORRP015",59,0)
 ; Return Values:
"RTN","RORRP015",60,0)
 ;
"RTN","RORRP015",61,0)
 ; A negative value of the first "^"-piece of the @RESULTS@(0)
"RTN","RORRP015",62,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP015",63,0)
 ; details).
"RTN","RORRP015",64,0)
 ;
"RTN","RORRP015",65,0)
 ; Otherwise, number of divisions and the value of the FROM parameter
"RTN","RORRP015",66,0)
 ; for the next procedure call are returned in the @RESULTS@(0) and
"RTN","RORRP015",67,0)
 ; the subsequent nodes of the global array contain the divisions.
"RTN","RORRP015",68,0)
 ; 
"RTN","RORRP015",69,0)
 ; @RESULTS@(0)          Result Descriptor
"RTN","RORRP015",70,0)
 ;                         ^01: Number of divisions
"RTN","RORRP015",71,0)
 ;                         ^02: FromName
"RTN","RORRP015",72,0)
 ;                         ^03: FromIEN
"RTN","RORRP015",73,0)
 ;
"RTN","RORRP015",74,0)
 ; @RESULTS@(i)          Division
"RTN","RORRP015",75,0)
 ;                         ^01: IEN
"RTN","RORRP015",76,0)
 ;                         ^02: Name
"RTN","RORRP015",77,0)
 ;                         ^03: Facility Number
"RTN","RORRP015",78,0)
 ;                         ^04: Institution IEN
"RTN","RORRP015",79,0)
 ;
"RTN","RORRP015",80,0)
DIVLIST(RESULTS,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP015",81,0)
 N BUF,RC,RORERRDL,RORMSG,TMP
"RTN","RORRP015",82,0)
 D CLEAR^RORERR("DIVLIST^RORRP015",1)
"RTN","RORRP015",83,0)
 K RESULTS  S RESULTS=$NA(^TMP("DILIST",$J))  K @RESULTS
"RTN","RORRP015",84,0)
 ;--- Check the parameters
"RTN","RORRP015",85,0)
 S PART=$G(PART),FLAGS=$G(FLAGS)
"RTN","RORRP015",86,0)
 S NUMBER=$S($G(NUMBER)>0:+NUMBER,1:"*")
"RTN","RORRP015",87,0)
 ;--- Setup the start point
"RTN","RORRP015",88,0)
 I $G(FROM)'=""  D  S FROM=$P(FROM,U)
"RTN","RORRP015",89,0)
 . S:$P(FROM,U,2)>0 FROM("IEN")=+$P(FROM,U,2)
"RTN","RORRP015",90,0)
 ;--- Get the list of divisions
"RTN","RORRP015",91,0)
 S BUF="@;.01;1;.07I",TMP="P"_$S(FLAGS["B":"B",1:"")
"RTN","RORRP015",92,0)
 D LIST^DIC(40.8,,BUF,TMP,NUMBER,.FROM,PART,"B",,,,"RORMSG")
"RTN","RORRP015",93,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP015",94,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,40.8)
"RTN","RORRP015",95,0)
 . K ^TMP("DILIST",$J)
"RTN","RORRP015",96,0)
 ;--- Success
"RTN","RORRP015",97,0)
 S TMP=$G(^TMP("DILIST",$J,0)),BUF=+$P(TMP,U)
"RTN","RORRP015",98,0)
 K ^TMP("DILIST",$J,0)
"RTN","RORRP015",99,0)
 S:$P(TMP,U,3) $P(BUF,U,2,3)=$G(FROM)_U_$G(FROM("IEN"))
"RTN","RORRP015",100,0)
 S @RESULTS@(0)=BUF
"RTN","RORRP015",101,0)
 Q
"RTN","RORRP015",102,0)
 ;
"RTN","RORRP015",103,0)
 ;***** RETURNS THE LIST OF HOSPITAL LOCATIONS
"RTN","RORRP015",104,0)
 ; RPC: [ROR LIST HOSPITAL LOCATIONS]
"RTN","RORRP015",105,0)
 ;
"RTN","RORRP015",106,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP015",107,0)
 ;               are returned to.
"RTN","RORRP015",108,0)
 ;
"RTN","RORRP015",109,0)
 ; [HLTYPES]     List of location types separated by commas (internal
"RTN","RORRP015",110,0)
 ;               values of the TYPE field of the HOSPITAL LOCATION
"RTN","RORRP015",111,0)
 ;               file). Only locations of the types defined by this
"RTN","RORRP015",112,0)
 ;               parameter are selected by the procedure. By default
"RTN","RORRP015",113,0)
 ;               ($G(HLTYPES)=""), all locations are selected.
"RTN","RORRP015",114,0)
 ;
"RTN","RORRP015",115,0)
 ; [DIVIEN]      Division IEN. If this parameter is defined and
"RTN","RORRP015",116,0)
 ;               greater than zero then only the locations associated 
"RTN","RORRP015",117,0)
 ;               with this division will be selected.
"RTN","RORRP015",118,0)
 ;
"RTN","RORRP015",119,0)
 ; [PART]        The partial match restriction.
"RTN","RORRP015",120,0)
 ;
"RTN","RORRP015",121,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORRP015",122,0)
 ;                 A  Include active locations (default)
"RTN","RORRP015",123,0)
 ;                 B  Backwards. Traverses the index in the opposite
"RTN","RORRP015",124,0)
 ;                    direction of normal traversal.
"RTN","RORRP015",125,0)
 ;                 I  Include inactive locations
"RTN","RORRP015",126,0)
 ;
"RTN","RORRP015",127,0)
 ; [NUMBER]      Maximum number of entries to return. A value of "*"
"RTN","RORRP015",128,0)
 ;               or no value in this parameter designates all entries.
"RTN","RORRP015",129,0)
 ;
"RTN","RORRP015",130,0)
 ; [FROM]        The index entry(s) from which to begin the list
"RTN","RORRP015",131,0)
 ;                 ^01: FromName
"RTN","RORRP015",132,0)
 ;                 ^02: FromIEN
"RTN","RORRP015",133,0)
 ;
"RTN","RORRP015",134,0)
 ;               For example, a FROM value of "VA" would list entries
"RTN","RORRP015",135,0)
 ;               following VA. You can use the 2-nd and 3-rd "^"-
"RTN","RORRP015",136,0)
 ;               pieces of the @RESULTS@(0) node to continue the
"RTN","RORRP015",137,0)
 ;               listing in the subsequent procedure calls.
"RTN","RORRP015",138,0)
 ;
"RTN","RORRP015",139,0)
 ;               NOTE: The FROM value itself is not included in
"RTN","RORRP015",140,0)
 ;                     the resulting list.
"RTN","RORRP015",141,0)
 ;
"RTN","RORRP015",142,0)
 ; The ^TMP("DILIST",$J) global node is used by the procedure.
"RTN","RORRP015",143,0)
 ;
"RTN","RORRP015",144,0)
 ; See description of the LIST^DIC for more details about the
"RTN","RORRP015",145,0)
 ; PART, NUMBER and FROM parameters.
"RTN","RORRP015",146,0)
 ;
"RTN","RORRP015",147,0)
 ; Return Values:
"RTN","RORRP015",148,0)
 ;
"RTN","RORRP015",149,0)
 ; A negative value of the first "^"-piece of the @RESULTS@(0)
"RTN","RORRP015",150,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP015",151,0)
 ; details).
"RTN","RORRP015",152,0)
 ;
"RTN","RORRP015",153,0)
 ; Otherwise, number of hospital locations and the value of the
"RTN","RORRP015",154,0)
 ; FROM parameter for the next procedure call are returned in
"RTN","RORRP015",155,0)
 ; the @RESULTS@(0) and the subsequent nodes of the global array
"RTN","RORRP015",156,0)
 ; contain the locations.
"RTN","RORRP015",157,0)
 ; 
"RTN","RORRP015",158,0)
 ; @RESULTS@(0)          Result Descriptor
"RTN","RORRP015",159,0)
 ;                         ^01: Number of locations
"RTN","RORRP015",160,0)
 ;                         ^02: FromName
"RTN","RORRP015",161,0)
 ;                         ^03: FromIEN
"RTN","RORRP015",162,0)
 ;
"RTN","RORRP015",163,0)
 ; @RESULTS@(i)          Hospital Location
"RTN","RORRP015",164,0)
 ;                         ^01: IEN
"RTN","RORRP015",165,0)
 ;                         ^02: Name
"RTN","RORRP015",166,0)
 ;                         ^03: Type (internal)
"RTN","RORRP015",167,0)
 ;                         ^04: Institution IEN
"RTN","RORRP015",168,0)
 ;                         ^05: Division IEN
"RTN","RORRP015",169,0)
 ;                         ^06: Active (0/1)
"RTN","RORRP015",170,0)
 ;
"RTN","RORRP015",171,0)
 ; NOTE: The 6th "^"-piece of the location record (Active) is
"RTN","RORRP015",172,0)
 ;       populated only if both "A" and "I" flags are used.
"RTN","RORRP015",173,0)
 ;
"RTN","RORRP015",174,0)
HLOCLIST(RESULTS,HLTYPES,DIVIEN,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP015",175,0)
 N BUF,I,RC,RORERRDL,RORHLT,RORMSG,SCR,TMP
"RTN","RORRP015",176,0)
 D CLEAR^RORERR("HLOCLIST^RORRP015",1)
"RTN","RORRP015",177,0)
 K RESULTS  S RESULTS=$NA(^TMP("DILIST",$J))  K @RESULTS
"RTN","RORRP015",178,0)
 ;--- Check the parameters
"RTN","RORRP015",179,0)
 S HLTYPES=$$UP^XLFSTR($TR($G(HLTYPES)," "))
"RTN","RORRP015",180,0)
 F I=1:1  S TMP=$P(HLTYPES,",",I)  Q:TMP=""  S RORHLT(TMP)=""
"RTN","RORRP015",181,0)
 S DIVIEN=$S($G(DIVIEN)>0:+DIVIEN,1:0)
"RTN","RORRP015",182,0)
 S PART=$G(PART),FLAGS=$G(FLAGS)
"RTN","RORRP015",183,0)
 S NUMBER=$S($G(NUMBER)>0:+NUMBER,1:"*")
"RTN","RORRP015",184,0)
 ;--- If neither "A" nor "I" flag is provided, add the "A" (default)
"RTN","RORRP015",185,0)
 S:$TR(FLAGS,"AI")=FLAGS FLAGS=FLAGS_"A"
"RTN","RORRP015",186,0)
 ;--- Setup the start point
"RTN","RORRP015",187,0)
 I $G(FROM)'=""  D  S FROM=$P(FROM,U)
"RTN","RORRP015",188,0)
 . S:$P(FROM,U,2)>0 FROM("IEN")=+$P(FROM,U,2)
"RTN","RORRP015",189,0)
 ;--- Compile the screen logic (be careful with naked references)
"RTN","RORRP015",190,0)
 S SCR=""
"RTN","RORRP015",191,0)
 D:$D(RORHLT)>1
"RTN","RORRP015",192,0)
 . S SCR=SCR_"S D=$P($G(^(0)),U,3) I D'="""",$D(RORHLT(D)) "
"RTN","RORRP015",193,0)
 S:DIVIEN SCR=SCR_"I $P($G(^(0)),U,15)=DIVIEN "
"RTN","RORRP015",194,0)
 S:FLAGS'["A" SCR=SCR_"I '$$ACTLOC^RORRP015(+Y) "
"RTN","RORRP015",195,0)
 S:FLAGS'["I" SCR=SCR_"I $$ACTLOC^RORRP015(+Y) "
"RTN","RORRP015",196,0)
 ;--- Get the list of locations
"RTN","RORRP015",197,0)
 S BUF="@;.01;2I;3I;3.5I",TMP="P"_$S(FLAGS["B":"B",1:"")
"RTN","RORRP015",198,0)
 D LIST^DIC(44,,BUF,TMP,NUMBER,.FROM,PART,"B",SCR,,,"RORMSG")
"RTN","RORRP015",199,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP015",200,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,44)
"RTN","RORRP015",201,0)
 . K ^TMP("DILIST",$J)
"RTN","RORRP015",202,0)
 ;--- Populate the Active field if both flags are used
"RTN","RORRP015",203,0)
 I FLAGS["I",FLAGS["A"  S I=0  D
"RTN","RORRP015",204,0)
 . F  S I=$O(@RESULTS@(I))  Q:I=""  D
"RTN","RORRP015",205,0)
 . . S $P(@RESULTS@(I,0),U,6)=$$ACTLOC(+@RESULTS@(I,0))
"RTN","RORRP015",206,0)
 ;--- Success
"RTN","RORRP015",207,0)
 S TMP=$G(^TMP("DILIST",$J,0)),BUF=+$P(TMP,U)
"RTN","RORRP015",208,0)
 K ^TMP("DILIST",$J,0)
"RTN","RORRP015",209,0)
 S:$P(TMP,U,3) $P(BUF,U,2,3)=$G(FROM)_U_$G(FROM("IEN"))
"RTN","RORRP015",210,0)
 S @RESULTS@(0)=BUF
"RTN","RORRP015",211,0)
 Q
"RTN","RORRP016")
0^95^B18769051
"RTN","RORRP016",1,0)
RORRP016 ;HCIOFO/SG - RPC: ICD-9 CODES ; 11/21/05 4:06pm
"RTN","RORRP016",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP016",3,0)
 ;
"RTN","RORRP016",4,0)
 ; This routine uses the following IAs:
"RTN","RORRP016",5,0)
 ;
"RTN","RORRP016",6,0)
 ; #3990         $$ICDDX^ICDCODE and $$ICDD^ICDCODE (supported)
"RTN","RORRP016",7,0)
 ; #10082        Access to the file #80 (supported)
"RTN","RORRP016",8,0)
 ;
"RTN","RORRP016",9,0)
 Q
"RTN","RORRP016",10,0)
 ;
"RTN","RORRP016",11,0)
 ;***** RETURNS THE LIST OF ICD-9 CODES
"RTN","RORRP016",12,0)
 ; RPC: [ROR LIST ICD-9]
"RTN","RORRP016",13,0)
 ;
"RTN","RORRP016",14,0)
 ; .RORESULT     Reference to a local variable where the results
"RTN","RORRP016",15,0)
 ;               are returned to.
"RTN","RORRP016",16,0)
 ;
"RTN","RORRP016",17,0)
 ; [DATE]        Date for the code set versioning.
"RTN","RORRP016",18,0)
 ;
"RTN","RORRP016",19,0)
 ; [PART]        The partial match restriction.
"RTN","RORRP016",20,0)
 ;
"RTN","RORRP016",21,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORRP016",22,0)
 ;                 A  Exclude active codes
"RTN","RORRP016",23,0)
 ;                 B  Backwards. Traverses the index in the opposite
"RTN","RORRP016",24,0)
 ;                    direction of normal traversal
"RTN","RORRP016",25,0)
 ;                 D  Full search by description
"RTN","RORRP016",26,0)
 ;                 F  Exclude codes applicable to females only
"RTN","RORRP016",27,0)
 ;                 I  Exclude inactive codes
"RTN","RORRP016",28,0)
 ;                 K  Search in description keywords
"RTN","RORRP016",29,0)
 ;                 M  Exclude codes applicable to males only
"RTN","RORRP016",30,0)
 ;                 P  Exclude codes that are not acceptable
"RTN","RORRP016",31,0)
 ;                    as primary diagnoses
"RTN","RORRP016",32,0)
 ;
"RTN","RORRP016",33,0)
 ; [NUMBER]      Maximum number of entries to return. A value of "*"
"RTN","RORRP016",34,0)
 ;               or no value in this parameter designates all entries.
"RTN","RORRP016",35,0)
 ;
"RTN","RORRP016",36,0)
 ; [FROM]        The index entry(s) from which to begin the list
"RTN","RORRP016",37,0)
 ;                 ^01: FromName
"RTN","RORRP016",38,0)
 ;                 ^02: FromIEN
"RTN","RORRP016",39,0)
 ;
"RTN","RORRP016",40,0)
 ;               For example, a FROM value of "51" would list entries
"RTN","RORRP016",41,0)
 ;               following 51. You can use the 2-nd and 3-rd "^"-
"RTN","RORRP016",42,0)
 ;               pieces of the @RORESULT@(0) node to continue the
"RTN","RORRP016",43,0)
 ;               listing in the subsequent procedure calls.
"RTN","RORRP016",44,0)
 ;
"RTN","RORRP016",45,0)
 ;               NOTE: The FROM value itself is not included in
"RTN","RORRP016",46,0)
 ;                     the resulting list.
"RTN","RORRP016",47,0)
 ;
"RTN","RORRP016",48,0)
 ; See description of the LIST^DIC for more details about the
"RTN","RORRP016",49,0)
 ; PART, NUMBER and FROM parameters.
"RTN","RORRP016",50,0)
 ;
"RTN","RORRP016",51,0)
 ; The ^TMP("RORRP016",$J) global node is used by this procedure.
"RTN","RORRP016",52,0)
 ;
"RTN","RORRP016",53,0)
 ; Return Values:
"RTN","RORRP016",54,0)
 ;
"RTN","RORRP016",55,0)
 ; A negative value of the first "^"-piece of the @RORESULT@(0)
"RTN","RORRP016",56,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP016",57,0)
 ; details).
"RTN","RORRP016",58,0)
 ;
"RTN","RORRP016",59,0)
 ; Otherwise, number of ICD-9 codes and the value of the FROM
"RTN","RORRP016",60,0)
 ; parameter for the next procedure call are returned in the
"RTN","RORRP016",61,0)
 ; @RORESULT@(0) and the subsequent nodes of the global array
"RTN","RORRP016",62,0)
 ; contain the codes.
"RTN","RORRP016",63,0)
 ; 
"RTN","RORRP016",64,0)
 ; @RORESULT@(0)         Result Descriptor
"RTN","RORRP016",65,0)
 ;                         ^01: Number of codes
"RTN","RORRP016",66,0)
 ;                         ^02: FromName
"RTN","RORRP016",67,0)
 ;                         ^03: FromIEN
"RTN","RORRP016",68,0)
 ;
"RTN","RORRP016",69,0)
 ; @RORESULT@(i)         ICD-9
"RTN","RORRP016",70,0)
 ;                         ^01: IEN
"RTN","RORRP016",71,0)
 ;                         ^02: Diagnosis
"RTN","RORRP016",72,0)
 ;                         ^03: Code
"RTN","RORRP016",73,0)
 ;                         ^04: Use only with Sex
"RTN","RORRP016",74,0)
 ;                         ^05: Inactive {0|1}
"RTN","RORRP016",75,0)
 ;                         ^06: Inactivation Date (FileMan)
"RTN","RORRP016",76,0)
 ;
"RTN","RORRP016",77,0)
 ; @RORESULT@(i+1)       ICD-9 Description
"RTN","RORRP016",78,0)
 ;
"RTN","RORRP016",79,0)
ICD9LIST(RORESULT,DATE,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP016",80,0)
 N BUF,RC,RORERRDL,TMP
"RTN","RORRP016",81,0)
 D CLEAR^RORERR("ICD9LIST^RORRP016",1)
"RTN","RORRP016",82,0)
 K RORESULT  S RORESULT=$NA(^TMP("RORRP016",$J))  K @RORESULT
"RTN","RORRP016",83,0)
 ;--- Check the parameters
"RTN","RORRP016",84,0)
 S PART=$G(PART),FLAGS=$G(FLAGS)
"RTN","RORRP016",85,0)
 S NUMBER=$S($G(NUMBER)>0:+NUMBER,1:"*")
"RTN","RORRP016",86,0)
 ;--- Setup the start point
"RTN","RORRP016",87,0)
 I $G(FROM)'=""  D  S FROM=$P(FROM,U)
"RTN","RORRP016",88,0)
 . S:$P(FROM,U,2)>0 FROM("IEN")=+$P(FROM,U,2)
"RTN","RORRP016",89,0)
 ;--- Get the list of ICD-9 codes
"RTN","RORRP016",90,0)
 S RC=$$QUERY(PART,FLAGS,NUMBER,.FROM)
"RTN","RORRP016",91,0)
 I RC<0  D RPCSTK^RORERR(.RORESULT,RC)  Q
"RTN","RORRP016",92,0)
 S RORESULT=$NA(@RORESULT@("DILIST"))
"RTN","RORRP016",93,0)
 ;--- Load remaining data and refine the list
"RTN","RORRP016",94,0)
 D REFINE(PART,FLAGS,$G(DATE))
"RTN","RORRP016",95,0)
 ;--- Success
"RTN","RORRP016",96,0)
 S TMP=$G(@RORESULT@(0)),BUF=+$P(TMP,U)
"RTN","RORRP016",97,0)
 S:$P(TMP,U,3) $P(BUF,U,2,3)=$G(FROM)_U_$G(FROM("IEN"))
"RTN","RORRP016",98,0)
 K @RORESULT@(0)  S @RORESULT@(0)=BUF
"RTN","RORRP016",99,0)
 Q
"RTN","RORRP016",100,0)
 ;
"RTN","RORRP016",101,0)
 ;***** QUERIES THE ICD DIAGNOSIS FILE (#80)
"RTN","RORRP016",102,0)
QUERY(PART,FLAGS,NR,FROM) ;
"RTN","RORRP016",103,0)
 N FLDS,RORMSG,SCR,TMP,XREF
"RTN","RORRP016",104,0)
 ;--- Compile the screen logic (be careful with naked references)
"RTN","RORRP016",105,0)
 S SCR=""
"RTN","RORRP016",106,0)
 I FLAGS["D"  S:PART'="" SCR=SCR_"I $P(D,U,3)["""_PART_""" ",PART=""
"RTN","RORRP016",107,0)
 S:FLAGS["F" SCR=SCR_"I $P(D,U,10)'=""F"" "
"RTN","RORRP016",108,0)
 S:FLAGS["M" SCR=SCR_"I $P(D,U,10)'=""M"" "
"RTN","RORRP016",109,0)
 S:FLAGS["P" SCR=SCR_"I '$P(D,U,4) "
"RTN","RORRP016",110,0)
 S:SCR'="" SCR="S D=$G(^(0)) "_SCR
"RTN","RORRP016",111,0)
 ;--- Get the list of codes and some data
"RTN","RORRP016",112,0)
 S FLDS="@;3;.01;9.5I;IXI",TMP="P"_$S(FLAGS["B":"B",1:"")
"RTN","RORRP016",113,0)
 S XREF=$S(FLAGS["D":"#",FLAGS["K":"D",1:"BA")
"RTN","RORRP016",114,0)
 D LIST^DIC(80,,FLDS,TMP,NR,.FROM,PART,XREF,SCR,,RORESULT,"RORMSG")
"RTN","RORRP016",115,0)
 I $G(DIERR)  K @RORESULT  Q $$DBS^RORERR("RORMSG",-9,,,80)
"RTN","RORRP016",116,0)
 ;--- Success
"RTN","RORRP016",117,0)
 Q 0
"RTN","RORRP016",118,0)
 ;
"RTN","RORRP016",119,0)
 ;***** REFINES THE LIST OF ICD-9 CODES
"RTN","RORRP016",120,0)
REFINE(PART,FLAGS,DATE) ;
"RTN","RORRP016",121,0)
 N BUF,CNT,ICDINFO,MODE,RORDESC,SUBS,TMP
"RTN","RORRP016",122,0)
 S MODE=($TR(FLAGS,"DK")=FLAGS)
"RTN","RORRP016",123,0)
 S (CNT,SUBS)=0
"RTN","RORRP016",124,0)
 F  S SUBS=$O(@RORESULT@(SUBS)) Q:SUBS'>0  D
"RTN","RORRP016",125,0)
 . S BUF=@RORESULT@(SUBS,0)
"RTN","RORRP016",126,0)
 . ;--- Remove duplicates created by the logic of the "BAA" xref
"RTN","RORRP016",127,0)
 . I MODE  D  I '(TMP?1.E1" ")  K @RORESULT@(SUBS)  Q
"RTN","RORRP016",128,0)
 . . S TMP=$P(BUF,U,5)
"RTN","RORRP016",129,0)
 . ;--- Load the additional data
"RTN","RORRP016",130,0)
 . S ICDINFO=$$ICDDX^ICDCODE(+$P(BUF,U),DATE)
"RTN","RORRP016",131,0)
 . I ICDINFO<0  K @RORESULT@(SUBS)  Q
"RTN","RORRP016",132,0)
 . ;--- Screen active/inactive records
"RTN","RORRP016",133,0)
 . S TMP=+$P(ICDINFO,U,10)                      ; Status
"RTN","RORRP016",134,0)
 . I $S(TMP:FLAGS["A",1:FLAGS["I")  K @RORESULT@(SUBS)  Q
"RTN","RORRP016",135,0)
 . S $P(BUF,U,5)=TMP
"RTN","RORRP016",136,0)
 . S $P(BUF,U,6)=$S(TMP:$P(ICDINFO,U,12),1:"")  ; Inactivation Date
"RTN","RORRP016",137,0)
 . ;--- Versioned diagnosis
"RTN","RORRP016",138,0)
 . S TMP=$P(ICDINFO,U,4)  S:TMP'="" $P(BUF,U,2)=TMP
"RTN","RORRP016",139,0)
 . ;--- Store the data
"RTN","RORRP016",140,0)
 . S CNT=CNT+1,@RORESULT@(SUBS,0)=BUF
"RTN","RORRP016",141,0)
 . ;--- Versioned description
"RTN","RORRP016",142,0)
 . S TMP=$$ICDD^ICDCODE($P(BUF,U,3),"RORDESC")
"RTN","RORRP016",143,0)
 . S @RORESULT@(SUBS,1)=$S($G(RORDESC(1))'="":RORDESC(1),1:$P(BUF,U,2))
"RTN","RORRP016",144,0)
 . K RORDESC
"RTN","RORRP016",145,0)
 ;---
"RTN","RORRP016",146,0)
 S $P(@RORESULT@(0),U)=CNT
"RTN","RORRP016",147,0)
 Q
"RTN","RORRP017")
0^9^B9907674
"RTN","RORRP017",1,0)
RORRP017 ;HCIOFO/SG - RPC: DRUGS AND CLASSES ; 9/29/05 10:00am
"RTN","RORRP017",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP017",3,0)
 ;
"RTN","RORRP017",4,0)
 ; This routine uses the following IAs:
"RTN","RORRP017",5,0)
 ;
"RTN","RORRP017",6,0)
 ; #4533         ZERO^PSS50 (supported)
"RTN","RORRP017",7,0)
 ; #4540         ZERO^PSN50P6 (supported)
"RTN","RORRP017",8,0)
 ; #4543         C^PSN50P65, IEN^PSN50P65 (supported)
"RTN","RORRP017",9,0)
 ;
"RTN","RORRP017",10,0)
 Q
"RTN","RORRP017",11,0)
 ;
"RTN","RORRP017",12,0)
 ;***** RETURNS THE LIST OF DRUGS (DISPENSED OR GENERIC)
"RTN","RORRP017",13,0)
 ; RPC: [ROR LIST DRUGS]
"RTN","RORRP017",14,0)
 ;
"RTN","RORRP017",15,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP017",16,0)
 ;               are returned to.
"RTN","RORRP017",17,0)
 ;
"RTN","RORRP017",18,0)
 ; [PART]        The partial match restriction.
"RTN","RORRP017",19,0)
 ;
"RTN","RORRP017",20,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORRP017",21,0)
 ;                 G  Retrive generic drugs (from file #50.6).
"RTN","RORRP017",22,0)
 ;                    Otherwise, list of dispensed drugs (from
"RTN","RORRP017",23,0)
 ;                    file #50) is retrieved.
"RTN","RORRP017",24,0)
 ;
"RTN","RORRP017",25,0)
 ; [NUMBER]      Deprecated
"RTN","RORRP017",26,0)
 ; [FROM]        Deprecated
"RTN","RORRP017",27,0)
 ;
"RTN","RORRP017",28,0)
 ; Return Values:
"RTN","RORRP017",29,0)
 ;
"RTN","RORRP017",30,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP017",31,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP017",32,0)
 ; details).
"RTN","RORRP017",33,0)
 ;
"RTN","RORRP017",34,0)
 ; Otherwise, number of drugs is returned in the
"RTN","RORRP017",35,0)
 ; @RESULTS@(0) and the subsequent nodes of the global array
"RTN","RORRP017",36,0)
 ; contain the drugs.
"RTN","RORRP017",37,0)
 ; 
"RTN","RORRP017",38,0)
 ; @RESULTS@(0)          Number of drugs
"RTN","RORRP017",39,0)
 ;
"RTN","RORRP017",40,0)
 ; @RESULTS@(i)          Drug
"RTN","RORRP017",41,0)
 ;                         ^01: Drug IEN
"RTN","RORRP017",42,0)
 ;                         ^02: Drug Name
"RTN","RORRP017",43,0)
 ;                         ^03: VA Drug Class (only for dispensed)
"RTN","RORRP017",44,0)
 ;
"RTN","RORRP017",45,0)
DRUGLIST(RESULTS,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP017",46,0)
 N BUF,CNT,GENERIC,IEN,LP,NAME,NODE,RC,RORERRDL,TMP
"RTN","RORRP017",47,0)
 D CLEAR^RORERR("DRUGLIST^RORRP017",1)
"RTN","RORRP017",48,0)
 K RESULTS  S RESULTS=$$ALLOC^RORTMP()
"RTN","RORRP017",49,0)
 ;--- Check the parameters
"RTN","RORRP017",50,0)
 S FLAGS=$G(FLAGS)  S:$G(PART)="" PART="??"
"RTN","RORRP017",51,0)
 S GENERIC=(FLAGS["G")
"RTN","RORRP017",52,0)
 ;--- Get the list of drugs
"RTN","RORRP017",53,0)
 S NODE=$$ALLOC^RORTMP(.TMP)
"RTN","RORRP017",54,0)
 I GENERIC  D
"RTN","RORRP017",55,0)
 . D ZERO^PSN50P6(,PART,,,TMP)  ; Generic
"RTN","RORRP017",56,0)
 E  D ZERO^PSS50(,PART,,,,TMP)  ; Dispensed
"RTN","RORRP017",57,0)
 ;--- Copy the data to the destination array
"RTN","RORRP017",58,0)
 S:PART="??" PART=""  S LP=$L(PART)
"RTN","RORRP017",59,0)
 S NAME="",CNT=0
"RTN","RORRP017",60,0)
 F  S NAME=$O(@NODE@("B",NAME))  Q:NAME=""  D
"RTN","RORRP017",61,0)
 . S IEN=""
"RTN","RORRP017",62,0)
 . F  S IEN=$O(@NODE@("B",NAME,IEN))  Q:IEN=""  D
"RTN","RORRP017",63,0)
 . . S TMP=$G(@NODE@(IEN,.01))  Q:TMP=""
"RTN","RORRP017",64,0)
 . . Q:$E(TMP,1,LP)'=PART  ; Exclude mnemonics
"RTN","RORRP017",65,0)
 . . S BUF=IEN_U_TMP  S:'GENERIC $P(BUF,U,3)=$G(@NODE@(IEN,2))
"RTN","RORRP017",66,0)
 . . S CNT=CNT+1,@RESULTS@(CNT)=BUF
"RTN","RORRP017",67,0)
 ;--- Success
"RTN","RORRP017",68,0)
 S @RESULTS@(0)=CNT
"RTN","RORRP017",69,0)
 D FREE^RORTMP(NODE)
"RTN","RORRP017",70,0)
 Q
"RTN","RORRP017",71,0)
 ;
"RTN","RORRP017",72,0)
 ;***** RETURNS THE LIST OF VA DRUG CLASSES
"RTN","RORRP017",73,0)
 ; RPC: [ROR LIST VA DRUG CLASSES]
"RTN","RORRP017",74,0)
 ;
"RTN","RORRP017",75,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP017",76,0)
 ;               are returned to.
"RTN","RORRP017",77,0)
 ;
"RTN","RORRP017",78,0)
 ; [PARENT]      Reserved
"RTN","RORRP017",79,0)
 ;
"RTN","RORRP017",80,0)
 ; [PART]        The partial match restriction.
"RTN","RORRP017",81,0)
 ;
"RTN","RORRP017",82,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORRP017",83,0)
 ;                 N  Search classes by their names
"RTN","RORRP017",84,0)
 ;                    (by default, the search is performed by codes)
"RTN","RORRP017",85,0)
 ;
"RTN","RORRP017",86,0)
 ; [NUMBER]      Deprecated
"RTN","RORRP017",87,0)
 ; [FROM]        Deprecated
"RTN","RORRP017",88,0)
 ;
"RTN","RORRP017",89,0)
 ; Return Values:
"RTN","RORRP017",90,0)
 ;
"RTN","RORRP017",91,0)
 ; A negative value of the first "^"-piece of the @RESULTS@(0)
"RTN","RORRP017",92,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP017",93,0)
 ; details).
"RTN","RORRP017",94,0)
 ;
"RTN","RORRP017",95,0)
 ; Otherwise, number of drug classes is returned in the
"RTN","RORRP017",96,0)
 ; @RESULTS@(0) and the subsequent nodes of the global array
"RTN","RORRP017",97,0)
 ; contain the classes.
"RTN","RORRP017",98,0)
 ; 
"RTN","RORRP017",99,0)
 ; @RESULTS@(0)          Number of classes
"RTN","RORRP017",100,0)
 ;
"RTN","RORRP017",101,0)
 ; @RESULTS@(i)          Drug Class
"RTN","RORRP017",102,0)
 ;                         ^01: IEN
"RTN","RORRP017",103,0)
 ;                         ^02: Classification
"RTN","RORRP017",104,0)
 ;                         ^03: Code
"RTN","RORRP017",105,0)
 ;
"RTN","RORRP017",106,0)
VACLSLST(RESULTS,PARENT,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP017",107,0)
 N CNT,IEN,LP,NODE,RC,RORERRDL,SUBS,TMP,VAL,XREF
"RTN","RORRP017",108,0)
 D CLEAR^RORERR("VACLSLST^RORRP017",1)
"RTN","RORRP017",109,0)
 K RESULTS  S RESULTS=$$ALLOC^RORTMP()
"RTN","RORRP017",110,0)
 ;--- Check the parameters
"RTN","RORRP017",111,0)
 S FLAGS=$G(FLAGS)  S:$G(PART)="" PART="??"
"RTN","RORRP017",112,0)
 ;--- Get the list of codes
"RTN","RORRP017",113,0)
 S NODE=$$ALLOC^RORTMP(.TMP)
"RTN","RORRP017",114,0)
 I FLAGS["N"  D  S XREF="C",SUBS=1
"RTN","RORRP017",115,0)
 . D C^PSN50P65(,PART,TMP)
"RTN","RORRP017",116,0)
 E  D  S XREF="B",SUBS=.01
"RTN","RORRP017",117,0)
 . D IEN^PSN50P65(,PART,TMP)
"RTN","RORRP017",118,0)
 ;--- Copy the data to the destination array
"RTN","RORRP017",119,0)
 S:PART="??" PART=""  S LP=$L(PART)
"RTN","RORRP017",120,0)
 S VAL="",CNT=0
"RTN","RORRP017",121,0)
 F  S VAL=$O(@NODE@(XREF,VAL))  Q:VAL=""  D
"RTN","RORRP017",122,0)
 . S IEN=""
"RTN","RORRP017",123,0)
 . F  S IEN=$O(@NODE@(XREF,VAL,IEN))  Q:IEN=""  D
"RTN","RORRP017",124,0)
 . . S TMP=$G(@NODE@(IEN,SUBS))
"RTN","RORRP017",125,0)
 . . Q:$E(TMP,1,LP)'=PART  ; Exclude mnemonics
"RTN","RORRP017",126,0)
 . . S CNT=CNT+1
"RTN","RORRP017",127,0)
 . . S @RESULTS@(CNT)=IEN_U_$G(@NODE@(IEN,1))_U_$G(@NODE@(IEN,.01))
"RTN","RORRP017",128,0)
 ;--- Success
"RTN","RORRP017",129,0)
 S @RESULTS@(0)=CNT
"RTN","RORRP017",130,0)
 D FREE^RORTMP(NODE)
"RTN","RORRP017",131,0)
 Q
"RTN","RORRP018")
0^96^B7897873
"RTN","RORRP018",1,0)
RORRP018 ;HCIOFO/SG - RPC: LIST OF LAB TESTS ; 10/19/05 8:23am
"RTN","RORRP018",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP018",3,0)
 ;
"RTN","RORRP018",4,0)
 ; This routine uses the following IAs:
"RTN","RORRP018",5,0)
 ;
"RTN","RORRP018",6,0)
 ; #91           Access to the LABORATORY TEST file
"RTN","RORRP018",7,0)
 ;
"RTN","RORRP018",8,0)
 Q
"RTN","RORRP018",9,0)
 ;
"RTN","RORRP018",10,0)
 ;***** RETURNS THE LIST OF LAB TESTS
"RTN","RORRP018",11,0)
 ; RPC: [ROR LIST LABORATORY TESTS]
"RTN","RORRP018",12,0)
 ;
"RTN","RORRP018",13,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP018",14,0)
 ;               are returned to.
"RTN","RORRP018",15,0)
 ;
"RTN","RORRP018",16,0)
 ; [SUBSCR]      List of the test subscripts (separated by commas)
"RTN","RORRP018",17,0)
 ;               to include. By default ($G(SUBSCR)=""), all tests
"RTN","RORRP018",18,0)
 ;               are retrieved.
"RTN","RORRP018",19,0)
 ;
"RTN","RORRP018",20,0)
 ; [PART]        The partial match restriction.
"RTN","RORRP018",21,0)
 ;
"RTN","RORRP018",22,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORRP018",23,0)
 ;                 B  Backwards. Traverses the index in the opposite
"RTN","RORRP018",24,0)
 ;                    direction of normal traversal
"RTN","RORRP018",25,0)
 ;                 P  Include panels (by default, the panels are
"RTN","RORRP018",26,0)
 ;                    excluded from the list)
"RTN","RORRP018",27,0)
 ;
"RTN","RORRP018",28,0)
 ; [NUMBER]      Maximum number of entries to return. A value of "*"
"RTN","RORRP018",29,0)
 ;               or no value in this parameter designates all entries.
"RTN","RORRP018",30,0)
 ;
"RTN","RORRP018",31,0)
 ; [FROM]        The index entry(s) from which to begin the list
"RTN","RORRP018",32,0)
 ;                 ^01: FromName
"RTN","RORRP018",33,0)
 ;                 ^02: FromIEN
"RTN","RORRP018",34,0)
 ;
"RTN","RORRP018",35,0)
 ;               For example, a FROM value of "AD" would list entries
"RTN","RORRP018",36,0)
 ;               following AD. You can use the 2-nd and 3-rd "^"-
"RTN","RORRP018",37,0)
 ;               pieces of the @RESULTS@(0) node to continue the
"RTN","RORRP018",38,0)
 ;               listing in the subsequent procedure calls.
"RTN","RORRP018",39,0)
 ;
"RTN","RORRP018",40,0)
 ;               NOTE: The FROM value itself is not included in
"RTN","RORRP018",41,0)
 ;                     the resulting list.
"RTN","RORRP018",42,0)
 ;
"RTN","RORRP018",43,0)
 ; See description of the LIST^DIC for more details about the
"RTN","RORRP018",44,0)
 ; PART, NUMBER and FROM parameters.
"RTN","RORRP018",45,0)
 ;
"RTN","RORRP018",46,0)
 ; Return Values:
"RTN","RORRP018",47,0)
 ;
"RTN","RORRP018",48,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP018",49,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP018",50,0)
 ; details).
"RTN","RORRP018",51,0)
 ;
"RTN","RORRP018",52,0)
 ; Otherwise, number of lab tests and the value of the FROM
"RTN","RORRP018",53,0)
 ; parameter for the next procedure call are returned in the
"RTN","RORRP018",54,0)
 ; @RESULTS@(0) and the subsequent nodes of the global array
"RTN","RORRP018",55,0)
 ; contain the tests.
"RTN","RORRP018",56,0)
 ; 
"RTN","RORRP018",57,0)
 ; @RESULTS@(0)          Result Descriptor
"RTN","RORRP018",58,0)
 ;                         ^01: Number of tests
"RTN","RORRP018",59,0)
 ;                         ^02: FromName
"RTN","RORRP018",60,0)
 ;                         ^03: FromIEN
"RTN","RORRP018",61,0)
 ;
"RTN","RORRP018",62,0)
 ; @RESULTS@(i)          Lab Test
"RTN","RORRP018",63,0)
 ;                         ^01: IEN
"RTN","RORRP018",64,0)
 ;                         ^02: Test Name
"RTN","RORRP018",65,0)
 ;                         ^03: Subscript (internal)
"RTN","RORRP018",66,0)
 ;                         ^04: Panel {""|1}
"RTN","RORRP018",67,0)
 ;
"RTN","RORRP018",68,0)
LABTLIST(RESULTS,SUBSCR,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP018",69,0)
 N BUF,I,RC,RORERRDL,RORMSG,RORSUBS,SCR,TMP
"RTN","RORRP018",70,0)
 D CLEAR^RORERR("LABTLIST^RORRP018",1)
"RTN","RORRP018",71,0)
 K RESULTS  S RESULTS=$$ALLOC^RORTMP()
"RTN","RORRP018",72,0)
 ;--- Check the parameters
"RTN","RORRP018",73,0)
 S SUBSCR=$$UP^XLFSTR($TR($G(SUBSCR)," "))
"RTN","RORRP018",74,0)
 F I=1:1  S TMP=$P(SUBSCR,",",I)  Q:TMP=""  S RORSUBS(TMP)=""
"RTN","RORRP018",75,0)
 S PART=$G(PART),FLAGS=$G(FLAGS)
"RTN","RORRP018",76,0)
 S NUMBER=$S($G(NUMBER)>0:+NUMBER,1:"*")
"RTN","RORRP018",77,0)
 ;--- Setup the start point
"RTN","RORRP018",78,0)
 I $G(FROM)'=""  D  S FROM=$P(FROM,U)
"RTN","RORRP018",79,0)
 . S:$P(FROM,U,2)>0 FROM("IEN")=+$P(FROM,U,2)
"RTN","RORRP018",80,0)
 ;--- Compile the screen logic (be careful with naked references)
"RTN","RORRP018",81,0)
 S SCR=""
"RTN","RORRP018",82,0)
 D:$D(RORSUBS)>0
"RTN","RORRP018",83,0)
 . S SCR=SCR_"S D=$P($G(^(0)),U,4) I D'="""",$D(RORSUBS(D)) "
"RTN","RORRP018",84,0)
 S:FLAGS'["P" SCR=SCR_"I $O(^(2,0))'>0 "  ; Exclude panels
"RTN","RORRP018",85,0)
 ;--- Get the list of tests
"RTN","RORRP018",86,0)
 S BUF="@;.01;4I",TMP="PM"_$S(FLAGS["B":"B",1:"")
"RTN","RORRP018",87,0)
 D LIST^DIC(60,,BUF,TMP,NUMBER,.FROM,PART,"B",SCR,,RESULTS,"RORMSG")
"RTN","RORRP018",88,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP018",89,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,60)
"RTN","RORRP018",90,0)
 . D FREE^RORTMP(RESULTS)
"RTN","RORRP018",91,0)
 S RESULTS=$NA(@RESULTS@("DILIST"))
"RTN","RORRP018",92,0)
 ;--- Post processing
"RTN","RORRP018",93,0)
 D:FLAGS["P"
"RTN","RORRP018",94,0)
 . ;--- Mark the Lab panels
"RTN","RORRP018",95,0)
 . S I=0
"RTN","RORRP018",96,0)
 . F  S I=$O(@RESULTS@(I))  Q:I'>0  D
"RTN","RORRP018",97,0)
 . . S IEN=+$P(@RESULTS@(I,0),U)
"RTN","RORRP018",98,0)
 . . S TMP=$$GET1^DIQ(60,IEN_",","COUNT(#200)",,,"RORMSG")
"RTN","RORRP018",99,0)
 . . S:TMP>0 $P(@RESULTS@(I,0),U,4)=1
"RTN","RORRP018",100,0)
 ;--- Success
"RTN","RORRP018",101,0)
 S TMP=$G(@RESULTS@(0)),BUF=+$P(TMP,U)
"RTN","RORRP018",102,0)
 K @RESULTS@(0)
"RTN","RORRP018",103,0)
 S:$P(TMP,U,3) $P(BUF,U,2,3)=$G(FROM)_U_$G(FROM("IEN"))
"RTN","RORRP018",104,0)
 S @RESULTS@(0)=BUF
"RTN","RORRP018",105,0)
 Q
"RTN","RORRP019")
0^4^B40743189
"RTN","RORRP019",1,0)
RORRP019 ;HCIOFO/SG - RPC: LIST OF PATIENTS ; 9/20/05 9:21am
"RTN","RORRP019",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP019",3,0)
 ;
"RTN","RORRP019",4,0)
 Q
"RTN","RORRP019",5,0)
 ;
"RTN","RORRP019",6,0)
 ;***** RETURNS THE LIST OF PATIENTS (EITHER FROM #798 OR #2)
"RTN","RORRP019",7,0)
 ; RPC: [ROR LIST PATIENTS]
"RTN","RORRP019",8,0)
 ;
"RTN","RORRP019",9,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP019",10,0)
 ;               are returned to.
"RTN","RORRP019",11,0)
 ;
"RTN","RORRP019",12,0)
 ; REGIEN        Registry IEN
"RTN","RORRP019",13,0)
 ;
"RTN","RORRP019",14,0)
 ; [DATE]        If the value of this parameter is greater than 0
"RTN","RORRP019",15,0)
 ;               and the 'C' flag is defined, then patients who
"RTN","RORRP019",16,0)
 ;               were confrmed in the registry before this date,
"RTN","RORRP019",17,0)
 ;               will be skipped.
"RTN","RORRP019",18,0)
 ;
"RTN","RORRP019",19,0)
 ; [PART]        The search pattern (partial match restriction).
"RTN","RORRP019",20,0)
 ;               If this parameter is a number preceded by the '`',
"RTN","RORRP019",21,0)
 ;               then a list containing only the patient with this
"RTN","RORRP019",22,0)
 ;               IEN is compiled.
"RTN","RORRP019",23,0)
 ;
"RTN","RORRP019",24,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORRP019",25,0)
 ;                 2  Search in the PATIENT file. By default, the
"RTN","RORRP019",26,0)
 ;                    ROR REGISTRY RECORD and ROR PATIENT files are
"RTN","RORRP019",27,0)
 ;                    queried. This flag overrides the 'C' and 'P'
"RTN","RORRP019",28,0)
 ;                    flags.
"RTN","RORRP019",29,0)
 ;                 B  Backwards. Traverses the index in the opposite
"RTN","RORRP019",30,0)
 ;                    direction of normal traversal.
"RTN","RORRP019",31,0)
 ;                 C  Include confirmed patients
"RTN","RORRP019",32,0)
 ;                 O  Add values of the optional fields
"RTN","RORRP019",33,0)
 ;                 P  Include pending patients
"RTN","RORRP019",34,0)
 ;
"RTN","RORRP019",35,0)
 ; [NUMBER]      Maximum number of entries to return. A value of "*"
"RTN","RORRP019",36,0)
 ;               or no value in this parameter designates all entries.
"RTN","RORRP019",37,0)
 ;
"RTN","RORRP019",38,0)
 ; [FROM]        The index entry(s) from which to begin the list.
"RTN","RORRP019",39,0)
 ;               You should use the pieces of the @RESULTS@(0) node
"RTN","RORRP019",40,0)
 ;               (starting from the second one) to continue the
"RTN","RORRP019",41,0)
 ;               listing in the subsequent procedure calls.
"RTN","RORRP019",42,0)
 ;
"RTN","RORRP019",43,0)
 ;               NOTE: The FROM value itself is not included in
"RTN","RORRP019",44,0)
 ;                     the resulting list.
"RTN","RORRP019",45,0)
 ;
"RTN","RORRP019",46,0)
 ; The ^TMP("DILIST",$J) global node is used by the procedure.
"RTN","RORRP019",47,0)
 ;
"RTN","RORRP019",48,0)
 ; See description of the LIST^DIC for more details about the
"RTN","RORRP019",49,0)
 ; PART, NUMBER and FROM parameters.
"RTN","RORRP019",50,0)
 ;
"RTN","RORRP019",51,0)
 ; Return Values:
"RTN","RORRP019",52,0)
 ;
"RTN","RORRP019",53,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP019",54,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP019",55,0)
 ; details).
"RTN","RORRP019",56,0)
 ;
"RTN","RORRP019",57,0)
 ; Otherwise, number of patients and the value of the FROM
"RTN","RORRP019",58,0)
 ; parameter for the next procedure call are returned in the
"RTN","RORRP019",59,0)
 ; @RESULTS@(0) and the subsequent nodes of the global array
"RTN","RORRP019",60,0)
 ; contain the patients.
"RTN","RORRP019",61,0)
 ; 
"RTN","RORRP019",62,0)
 ; @RESULTS@(0)          Result Descriptor
"RTN","RORRP019",63,0)
 ;                         ^01: Number of patients
"RTN","RORRP019",64,0)
 ;                         ^02: Values that comprise the FROM
"RTN","RORRP019",65,0)
 ;                         ^nn: parameter for the subsequent call
"RTN","RORRP019",66,0)
 ;
"RTN","RORRP019",67,0)
 ; @RESULTS@(i)          Patient
"RTN","RORRP019",68,0)
 ;                         ...  See the $$LOAD2^RORRP020 (RORDEM)
"RTN","RORRP019",69,0)
 ;
"RTN","RORRP019",70,0)
 ; @RESULTS@(i+1)        Optional fields (these nodes are created only
"RTN","RORRP019",71,0)
 ;                       if the FLAGS parameter contains the 'O' flag)
"RTN","RORRP019",72,0)
 ;                         ^01: "O" (letter O)
"RTN","RORRP019",73,0)
 ;                         ...  See the $$LOAD798^RORRP020
"RTN","RORRP019",74,0)
 ;
"RTN","RORRP019",75,0)
PTLIST(RESULTS,REGIEN,DATE,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP019",76,0)
 N BUF,I,RC,RORERRDL,RORMSG,TMP
"RTN","RORRP019",77,0)
 D CLEAR^RORERR("PTLIST^RORRP019",1)
"RTN","RORRP019",78,0)
 K RESULTS  S RESULTS=$NA(^TMP("DILIST",$J))  K @RESULTS
"RTN","RORRP019",79,0)
 ;
"RTN","RORRP019",80,0)
 ;=== Check the parameters
"RTN","RORRP019",81,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP019",82,0)
 . ;--- Registry IEN
"RTN","RORRP019",83,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP019",84,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP019",85,0)
 . S REGIEN=+REGIEN
"RTN","RORRP019",86,0)
 . ;--- Flags and date
"RTN","RORRP019",87,0)
 . S FLAGS=$$UP^XLFSTR($G(FLAGS)),DATE=+$G(DATE)
"RTN","RORRP019",88,0)
 . S TMP=$TR(FLAGS,"CP")
"RTN","RORRP019",89,0)
 . ;- The '2' flag overrides all flags related to the CCR files.
"RTN","RORRP019",90,0)
 . I FLAGS["2"  S FLAGS=TMP
"RTN","RORRP019",91,0)
 . ;- By default, all registry patients are included
"RTN","RORRP019",92,0)
 . ;- (except those who are marked for deletion).
"RTN","RORRP019",93,0)
 . E  I TMP=FLAGS  S FLAGS=FLAGS_"CP"
"RTN","RORRP019",94,0)
 . ;- If the date is provided, then make sure that confirmed
"RTN","RORRP019",95,0)
 . ;- registry patients are included in the search (the 'C' flag).
"RTN","RORRP019",96,0)
 . E  S:DATE>0 FLAGS=FLAGS_"C"
"RTN","RORRP019",97,0)
 . ;--- Others
"RTN","RORRP019",98,0)
 . S PART=$G(PART),FROM=$G(FROM)
"RTN","RORRP019",99,0)
 . S NUMBER=$S($G(NUMBER)>0:+NUMBER,1:"*")
"RTN","RORRP019",100,0)
 ;
"RTN","RORRP019",101,0)
 ;=== Setup the starting point
"RTN","RORRP019",102,0)
 F I=1:1  S TMP=$P(FROM,U,I)  Q:TMP=""  S FROM(I)=TMP
"RTN","RORRP019",103,0)
 S FROM=$G(FROM(1))
"RTN","RORRP019",104,0)
 ;
"RTN","RORRP019",105,0)
 ;=== Query the file
"RTN","RORRP019",106,0)
 S RC=0  D
"RTN","RORRP019",107,0)
 . ;--- Load a single patient with the provided IEN
"RTN","RORRP019",108,0)
 . I PART?1"`"1.N  D  Q
"RTN","RORRP019",109,0)
 . . I FLAGS'["2"  Q:$$PRRIEN^RORUTL01($P(PART,"`",2),REGIEN)'>0
"RTN","RORRP019",110,0)
 . . D FIND^DIC(2,,"@","P",PART,"*","#",,,,"RORMSG")
"RTN","RORRP019",111,0)
 . . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,2)
"RTN","RORRP019",112,0)
 . ;--- List of patients from PATIENT file (#2)
"RTN","RORRP019",113,0)
 . I FLAGS["2"  D  Q
"RTN","RORRP019",114,0)
 . . S RC=$$LST2(REGIEN,PART,FLAGS,NUMBER,.FROM)
"RTN","RORRP019",115,0)
 . ;--- List of registry patients
"RTN","RORRP019",116,0)
 . S RC=$$LST798(REGIEN,DATE,PART,FLAGS,NUMBER,.FROM)
"RTN","RORRP019",117,0)
 ;
"RTN","RORRP019",118,0)
 ;=== Check for the error(s)
"RTN","RORRP019",119,0)
 I RC<0  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP019",120,0)
 . K ^TMP("DILIST",$J)
"RTN","RORRP019",121,0)
 ;
"RTN","RORRP019",122,0)
 ;=== Post-processing
"RTN","RORRP019",123,0)
 S RC=$$POSTPROC^RORRP020(RESULTS,REGIEN,FLAGS)
"RTN","RORRP019",124,0)
 I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP019",125,0)
 ;
"RTN","RORRP019",126,0)
 ;=== Success
"RTN","RORRP019",127,0)
 S TMP=$G(^TMP("DILIST",$J,0)),BUF=+$P(TMP,U)
"RTN","RORRP019",128,0)
 K ^TMP("DILIST",$J,0)
"RTN","RORRP019",129,0)
 I $P(TMP,U,3)  S I=0  D
"RTN","RORRP019",130,0)
 . F  S I=$O(FROM(I))  Q:I'>0  S TMP=FROM(I)  S:TMP'="" BUF=BUF_U_TMP
"RTN","RORRP019",131,0)
 S @RESULTS@(0)=BUF
"RTN","RORRP019",132,0)
 Q
"RTN","RORRP019",133,0)
 ;
"RTN","RORRP019",134,0)
 ;***** QUERIES THE 'PATIENT' FILE (#2)
"RTN","RORRP019",135,0)
 ;
"RTN","RORRP019",136,0)
 ; RORREG        Registry IEN
"RTN","RORRP019",137,0)
 ;
"RTN","RORRP019",138,0)
 ; PART          The partial match restriction
"RTN","RORRP019",139,0)
 ;
"RTN","RORRP019",140,0)
 ; FLAGS         Flags that control the execution
"RTN","RORRP019",141,0)
 ;
"RTN","RORRP019",142,0)
 ; NUMBER        Maximum number of entries to return
"RTN","RORRP019",143,0)
 ;
"RTN","RORRP019",144,0)
 ; .FROM         Reference to a local variable that contains the
"RTN","RORRP019",145,0)
 ;               starting point for the LIST^DIC. The new point is
"RTN","RORRP019",146,0)
 ;               returned in this variable as well.
"RTN","RORRP019",147,0)
 ;
"RTN","RORRP019",148,0)
 ; Return Values:
"RTN","RORRP019",149,0)
 ;       <0  Error code
"RTN","RORRP019",150,0)
 ;        0  Ok
"RTN","RORRP019",151,0)
 ;
"RTN","RORRP019",152,0)
LST2(RORREG,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP019",153,0)
 N RC,RORMSG,SCR,TMP,XREF
"RTN","RORRP019",154,0)
 ;--- Select the cross-reference
"RTN","RORRP019",155,0)
 S XREF=$S(PART?4N:"BS",PART?1U4N:"BS5",PART?9N.1"P":"SSN",1:"B")
"RTN","RORRP019",156,0)
 ;--- Compile the screen logic (be careful with naked references)
"RTN","RORRP019",157,0)
 S SCR="I '$$SKIPEMPL^RORUTL02(+Y,.RORREG)"
"RTN","RORRP019",158,0)
 ;--- Get the list of patients
"RTN","RORRP019",159,0)
 S TMP="P"_$S(FLAGS["B":"B",1:"")_$S(XREF="B":"M",1:"")
"RTN","RORRP019",160,0)
 D LIST^DIC(2,,"@",TMP,NUMBER,.FROM,PART,XREF,SCR,,,"RORMSG")
"RTN","RORRP019",161,0)
 S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,2)
"RTN","RORRP019",162,0)
 ;---
"RTN","RORRP019",163,0)
 Q $S($G(RC)<0:RC,1:0)
"RTN","RORRP019",164,0)
 ;
"RTN","RORRP019",165,0)
 ;***** QUERIES THE CCR FILES (#798 OR #798.4)
"RTN","RORRP019",166,0)
 ;
"RTN","RORRP019",167,0)
 ; REGIEN        Registry IEN
"RTN","RORRP019",168,0)
 ;
"RTN","RORRP019",169,0)
 ; RORDT         Ignore patients who were confirmed in the registry
"RTN","RORRP019",170,0)
 ;               before the provided date (if the FLAGS parameter
"RTN","RORRP019",171,0)
 ;               contains the "C" flag)
"RTN","RORRP019",172,0)
 ;
"RTN","RORRP019",173,0)
 ; PART          The partial match restriction
"RTN","RORRP019",174,0)
 ;
"RTN","RORRP019",175,0)
 ; FLAGS         Flags that control the execution
"RTN","RORRP019",176,0)
 ;
"RTN","RORRP019",177,0)
 ; NUMBER        Maximum number of entries to return
"RTN","RORRP019",178,0)
 ;
"RTN","RORRP019",179,0)
 ; .FROM         Reference to a local variable that contains the
"RTN","RORRP019",180,0)
 ;               starting point for the LIST^DIC. The new point is
"RTN","RORRP019",181,0)
 ;               returned in this variable as well.
"RTN","RORRP019",182,0)
 ;
"RTN","RORRP019",183,0)
 ; Return Values:
"RTN","RORRP019",184,0)
 ;       <0  Error code
"RTN","RORRP019",185,0)
 ;        0  Ok
"RTN","RORRP019",186,0)
 ;
"RTN","RORRP019",187,0)
LST798(REGIEN,RORDT,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP019",188,0)
 N APART,RC,RORMSG,RORPS,SCR,TMP,XREF
"RTN","RORRP019",189,0)
 S RC=0
"RTN","RORRP019",190,0)
 ;--- Analyze the parameters
"RTN","RORRP019",191,0)
 S:FLAGS["C" RORPS(0)=""  ; Confirmed
"RTN","RORRP019",192,0)
 S:FLAGS["P" RORPS(4)=""  ; Pending
"RTN","RORRP019",193,0)
 S XREF=$S(PART?4N:"BS",PART?1U4N:"BS5",PART?9N.1"P":"SSN",1:"")
"RTN","RORRP019",194,0)
 ;--- Select the appropriate CCR file and perform the query
"RTN","RORRP019",195,0)
 I XREF'=""  D
"RTN","RORRP019",196,0)
 . S SCR="S D=$O(^RORDATA(798,""KEY"",+Y,"_REGIEN_",0)) "
"RTN","RORRP019",197,0)
 . S SCR=SCR_"I D>0 S D=$G(^RORDATA(798,D,0)) "
"RTN","RORRP019",198,0)
 . S SCR=SCR_"I $D(RORPS(+$P(D,U,5))) "
"RTN","RORRP019",199,0)
 . ;--- If the confirmation threshold is provided, add the
"RTN","RORRP019",200,0)
 . ;    screen code and check if there is at least one record
"RTN","RORRP019",201,0)
 . ;--- that conforms the confirmation date criterion
"RTN","RORRP019",202,0)
 . I RORDT>0  D  Q:'$D(SCR)
"RTN","RORRP019",203,0)
 . . I FLAGS["B"  D  Q
"RTN","RORRP019",204,0)
 . . . S SCR=SCR_"I $P(D,U,4)'>RORDT "
"RTN","RORRP019",205,0)
 . . . K:$O(^RORDATA(798,"ARCP",REGIEN_"#",""))>RORDT SCR
"RTN","RORRP019",206,0)
 . . ;---
"RTN","RORRP019",207,0)
 . . S SCR=SCR_"I $P(D,U,4)'<RORDT "
"RTN","RORRP019",208,0)
 . . K:$O(^RORDATA(798,"ARCP",REGIEN_"#",""),-1)<RORDT SCR
"RTN","RORRP019",209,0)
 . ;--- Query the ROR PATIENT file
"RTN","RORRP019",210,0)
 . S TMP="P"_$S(FLAGS["B":"B",1:"")
"RTN","RORRP019",211,0)
 . D LIST^DIC(798.4,,"@",TMP,NUMBER,.FROM,PART,XREF,SCR,,,"RORMSG")
"RTN","RORRP019",212,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798.4)
"RTN","RORRP019",213,0)
 E  D
"RTN","RORRP019",214,0)
 . S APART(1)=REGIEN_"#"
"RTN","RORRP019",215,0)
 . S FROM(1)=$S(FLAGS["B":"~",1:" ")
"RTN","RORRP019",216,0)
 . S SCR="S D=+$P($G(^(0)),U,5) I $D(RORPS(D)) "
"RTN","RORRP019",217,0)
 . ;---
"RTN","RORRP019",218,0)
 . I RORDT>0  S XREF="ARCP",APART(3)=PART  D:$G(FROM(2))=""
"RTN","RORRP019",219,0)
 . . S FROM(2)=$$FMADD^XLFDT(RORDT,,,,$S(FLAGS["B":1,1:-1))
"RTN","RORRP019",220,0)
 . E  S XREF="ARP",APART(2)=PART
"RTN","RORRP019",221,0)
 . ;--- Query the ROR REGISTRY RECORD file
"RTN","RORRP019",222,0)
 . S TMP="P"_$S(FLAGS["B":"B",1:"")
"RTN","RORRP019",223,0)
 . D LIST^DIC(798,,"@;.01I",TMP,NUMBER,.FROM,.APART,XREF,SCR,,,"RORMSG")
"RTN","RORRP019",224,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798)
"RTN","RORRP019",225,0)
 ;---
"RTN","RORRP019",226,0)
 Q $S($G(RC)<0:RC,1:0)
"RTN","RORRP020")
0^97^B23181298
"RTN","RORRP020",1,0)
RORRP020 ;HCIOFO/SG - RPC: PATIENT DATA UTILITIES ; 8/19/05 9:56am
"RTN","RORRP020",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP020",3,0)
 ;
"RTN","RORRP020",4,0)
 ; This routine uses the following IAs:
"RTN","RORRP020",5,0)
 ;
"RTN","RORRP020",6,0)
 ; #10035        Fields and x-refs of the PATIENT file (supported)
"RTN","RORRP020",7,0)
 ;
"RTN","RORRP020",8,0)
 Q
"RTN","RORRP020",9,0)
 ;
"RTN","RORRP020",10,0)
 ;***** LOADS THE DATA FROM THE 'PATIENT' FILE (#2)
"RTN","RORRP020",11,0)
 ;
"RTN","RORRP020",12,0)
 ; DFN           Patient IEN
"RTN","RORRP020",13,0)
 ;
"RTN","RORRP020",14,0)
 ; .RORDEM       Reference to a local variable where the demographic
"RTN","RORRP020",15,0)
 ;               information is returned to:
"RTN","RORRP020",16,0)
 ;
"RTN","RORRP020",17,0)
 ;                 ^01: Patient IEN (DFN)
"RTN","RORRP020",18,0)
 ;                 ^02: Patient Name
"RTN","RORRP020",19,0)
 ;                 ^03: Date of Birth (FileMan)
"RTN","RORRP020",20,0)
 ;                 ^04: SSN
"RTN","RORRP020",21,0)
 ;                 ^05: Date of Death (FileMan)
"RTN","RORRP020",22,0)
 ;                 ^06: Sex (F/M)
"RTN","RORRP020",23,0)
 ;
"RTN","RORRP020",24,0)
 ; [.RORADR]     Reference to a local variable where the patient's
"RTN","RORRP020",25,0)
 ;               address is returned to:
"RTN","RORRP020",26,0)
 ;
"RTN","RORRP020",27,0)
 ;                 ^01: Address (1)
"RTN","RORRP020",28,0)
 ;                 ^02: Address (2)
"RTN","RORRP020",29,0)
 ;                 ^03: Address (3)
"RTN","RORRP020",30,0)
 ;                 ^04: City
"RTN","RORRP020",31,0)
 ;                 ^05: State (IEN)
"RTN","RORRP020",32,0)
 ;                 ^06: State (Name)
"RTN","RORRP020",33,0)
 ;                 ^07: ZIP
"RTN","RORRP020",34,0)
 ;                 ^08: ZIP+4
"RTN","RORRP020",35,0)
 ;                 ^09: County (IEN)
"RTN","RORRP020",36,0)
 ;                 ^10: County (Name)
"RTN","RORRP020",37,0)
 ;                 ^11: Home Phone
"RTN","RORRP020",38,0)
 ;
"RTN","RORRP020",39,0)
 ; [.VADM]       Reference to a local array that is populated by
"RTN","RORRP020",40,0)
 ;               the 4^VADM API inside this function
"RTN","RORRP020",41,0)
 ;
"RTN","RORRP020",42,0)
 ; Return Values:
"RTN","RORRP020",43,0)
 ;       <0  Error code
"RTN","RORRP020",44,0)
 ;        0  Ok
"RTN","RORRP020",45,0)
 ;
"RTN","RORRP020",46,0)
LOAD2(DFN,RORDEM,RORADR,VADM) ;
"RTN","RORRP020",47,0)
 N I,VA,VAHOW,VAPA,VAROOT  D 4^VADPT
"RTN","RORRP020",48,0)
 ;--- Demographic information
"RTN","RORRP020",49,0)
 S RORDEM=DFN                          ; DFN
"RTN","RORRP020",50,0)
 S $P(RORDEM,U,2)=$G(VADM(1))          ; Name
"RTN","RORRP020",51,0)
 S $P(RORDEM,U,3)=$P($G(VADM(3)),U)    ; DOB
"RTN","RORRP020",52,0)
 S $P(RORDEM,U,4)=$P($G(VADM(2)),U)    ; SSN
"RTN","RORRP020",53,0)
 S $P(RORDEM,U,5)=$P($G(VADM(6)),U)    ; DOD
"RTN","RORRP020",54,0)
 S $P(RORDEM,U,6)=$P($G(VADM(5)),U)    ; Sex
"RTN","RORRP020",55,0)
 ;--- Patient's address
"RTN","RORRP020",56,0)
 S RORADR=$G(VAPA(1))                  ; Address (1)
"RTN","RORRP020",57,0)
 S $P(RORADR,U,2)=$G(VAPA(2))          ; Address (2)
"RTN","RORRP020",58,0)
 S $P(RORADR,U,3)=$G(VAPA(3))          ; Address (3)
"RTN","RORRP020",59,0)
 S $P(RORADR,U,4)=$G(VAPA(4))          ; City
"RTN","RORRP020",60,0)
 S $P(RORADR,U,5)=$P($G(VAPA(5)),U,1)  ; State IEN
"RTN","RORRP020",61,0)
 S $P(RORADR,U,6)=$P($G(VAPA(5)),U,2)  ; State Name
"RTN","RORRP020",62,0)
 S $P(RORADR,U,7)=$P($G(VAPA(6)),U,1)  ; ZIP
"RTN","RORRP020",63,0)
 S $P(RORADR,U,8)=$P($G(VAPA(6)),U,2)  ; ZIP+4
"RTN","RORRP020",64,0)
 S $P(RORADR,U,9)=$P($G(VAPA(7)),U,1)  ; County IEN
"RTN","RORRP020",65,0)
 S $P(RORADR,U,10)=$P($G(VAPA(7)),U,2) ; County Name
"RTN","RORRP020",66,0)
 S $P(RORADR,U,11)=$G(VAPA(8))         ; Home Phone Number
"RTN","RORRP020",67,0)
 Q 0
"RTN","RORRP020",68,0)
 ;
"RTN","RORRP020",69,0)
 ;***** LOADS THE REGISTRY DATA FOR THE PATIENT
"RTN","RORRP020",70,0)
 ;
"RTN","RORRP020",71,0)
 ; IEN           IEN of the registry record (file #798)
"RTN","RORRP020",72,0)
 ;
"RTN","RORRP020",73,0)
 ; .ROR8DST      Reference to a local variable where the results
"RTN","RORRP020",74,0)
 ;               are returned to:
"RTN","RORRP020",75,0)
 ;
"RTN","RORRP020",76,0)
 ;                 ^01: Date Entered (FileMan)
"RTN","RORRP020",77,0)
 ;                 ^02: Status Code (Field 3, File #798)
"RTN","RORRP020",78,0)
 ;                 ^03: Active (0/1)
"RTN","RORRP020",79,0)
 ;                 ^04: Do not Send (0/1)
"RTN","RORRP020",80,0)
 ;                 ^05: Data Acknowledged Until (FileMan)
"RTN","RORRP020",81,0)
 ;                 ^06: Data Extracted Until (FileMan)
"RTN","RORRP020",82,0)
 ;                 ^07: Date Selected (FileMan)
"RTN","RORRP020",83,0)
 ;                 ^08: Date Confirmed (FileMan)
"RTN","RORRP020",84,0)
 ;                 ^09: Location Selected (Institution Name)
"RTN","RORRP020",85,0)
 ;                 ^10: reserved
"RTN","RORRP020",86,0)
 ;                 ^11: reserved
"RTN","RORRP020",87,0)
 ;                 ^12: reserved
"RTN","RORRP020",88,0)
 ;                 ^13: Action Flags (see the description below)
"RTN","RORRP020",89,0)
 ;
"RTN","RORRP020",90,0)
 ;               The Action Flags field indicates the actions that
"RTN","RORRP020",91,0)
 ;               can be performed on the patient's record in the
"RTN","RORRP020",92,0)
 ;               registry:
"RTN","RORRP020",93,0)
 ;
"RTN","RORRP020",94,0)
 ;                   C  CDC form can be edited/printed
"RTN","RORRP020",95,0)
 ;                   D  The record can be deleted
"RTN","RORRP020",96,0)
 ;                   E  The record can be edited
"RTN","RORRP020",97,0)
 ;                   O  Read-only mode
"RTN","RORRP020",98,0)
 ;
"RTN","RORRP020",99,0)
 ; DOD           Date of Death (for deceased patients)
"RTN","RORRP020",100,0)
 ;
"RTN","RORRP020",101,0)
 ; Return Values:
"RTN","RORRP020",102,0)
 ;       <0  Error code
"RTN","RORRP020",103,0)
 ;        0  Ok
"RTN","RORRP020",104,0)
 ;
"RTN","RORRP020",105,0)
LOAD798(IEN,ROR8DST,DOD) ;
"RTN","RORRP020",106,0)
 N FLAGS,IENS,RORBUF,RORMSG,TMP
"RTN","RORRP020",107,0)
 S ROR8DST=""
"RTN","RORRP020",108,0)
 ;
"RTN","RORRP020",109,0)
 ;--- Check if the patient is in the registry
"RTN","RORRP020",110,0)
 I (IEN'>0)!($D(^RORDATA(798,+IEN))<10)  D  Q 0
"RTN","RORRP020",111,0)
 . S $P(ROR8DST,U,13)=""
"RTN","RORRP020",112,0)
 ;
"RTN","RORRP020",113,0)
 ;--- Load values from the registry record
"RTN","RORRP020",114,0)
 S IENS=(+IEN)_","
"RTN","RORRP020",115,0)
 D GETS^DIQ(798,IENS,"1;2;3;3.2;8;9.1;9.2;11","I","RORBUF","RORMSG")
"RTN","RORRP020",116,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","RORRP020",117,0)
 D GETS^DIQ(798,IENS,"3.3","E","RORBUF","RORMSG")
"RTN","RORRP020",118,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","RORRP020",119,0)
 ;
"RTN","RORRP020",120,0)
 ;--- Registry data
"RTN","RORRP020",121,0)
 S ROR8DST=$G(RORBUF(798,IENS,1,"I"))            ; DATE ENTERED
"RTN","RORRP020",122,0)
 S $P(ROR8DST,U,2)=+$G(RORBUF(798,IENS,3,"I"))   ; STATUS
"RTN","RORRP020",123,0)
 S $P(ROR8DST,U,3)=+$G(RORBUF(798,IENS,8,"I"))   ; ACTIVE
"RTN","RORRP020",124,0)
 S $P(ROR8DST,U,4)=+$G(RORBUF(798,IENS,11,"I"))  ; DON'T SEND
"RTN","RORRP020",125,0)
 S $P(ROR8DST,U,5)=$G(RORBUF(798,IENS,9.1,"I"))  ; ACKNOWLEDGED UNTIL
"RTN","RORRP020",126,0)
 S $P(ROR8DST,U,6)=$G(RORBUF(798,IENS,9.2,"I"))  ; EXTRACTED UNTIL
"RTN","RORRP020",127,0)
 S $P(ROR8DST,U,7)=$G(RORBUF(798,IENS,3.2,"I"))  ; DATE SELECTED
"RTN","RORRP020",128,0)
 S $P(ROR8DST,U,8)=$G(RORBUF(798,IENS,2,"I"))    ; DATE CONFIRMED
"RTN","RORRP020",129,0)
 S $P(ROR8DST,U,9)=$G(RORBUF(798,IENS,3.3,"E"))  ; LOCATION SELECTED
"RTN","RORRP020",130,0)
 ;
"RTN","RORRP020",131,0)
 ;--- Action flags
"RTN","RORRP020",132,0)
 ; The actions and modes are enabled/disabled according to the
"RTN","RORRP020",133,0)
 ; following table:
"RTN","RORRP020",134,0)
 ;-----------------------------------------------------;
"RTN","RORRP020",135,0)
 ;   Actions    ;        Status of the patient         ;
"RTN","RORRP020",136,0)
 ;     and      ;--------------------------------------;
"RTN","RORRP020",137,0)
 ;    Modes     ;Not Added;Pending;Active;Inactive;Dead;
"RTN","RORRP020",138,0)
 ;--------------+---------+-------+------+--------+----;
"RTN","RORRP020",139,0)
 ; (C)DC        ;    D    ;   D   ;      ;        ;    ;
"RTN","RORRP020",140,0)
 ; (D)elete     ;    D    ;       ;      ;        ;    ;
"RTN","RORRP020",141,0)
 ; (E)dit       ;    D    ;       ;      ;        ;    ;
"RTN","RORRP020",142,0)
 ; Read (O)nly  ;         ;       ;      ;        ;    ;
"RTN","RORRP020",143,0)
 ;-----------------------------------------------------;
"RTN","RORRP020",144,0)
 ; D  the action is disabled if at least one of the marked
"RTN","RORRP020",145,0)
 ;    conditions is true;
"RTN","RORRP020",146,0)
 ;
"RTN","RORRP020",147,0)
 ; E  the action is enabled if at least one of the marked
"RTN","RORRP020",148,0)
 ;    conditions is true.
"RTN","RORRP020",149,0)
 ;---
"RTN","RORRP020",150,0)
 D
"RTN","RORRP020",151,0)
 . I $P(ROR8DST,U,2)=4  S FLAGS="DE"  Q    ; Pending
"RTN","RORRP020",152,0)
 . S FLAGS="CDE"
"RTN","RORRP020",153,0)
 S $P(ROR8DST,U,13)=FLAGS
"RTN","RORRP020",154,0)
 Q 0
"RTN","RORRP020",155,0)
 ;
"RTN","RORRP020",156,0)
 ;***** PERFORMS THE POST-PROCESSING OF THE LISTS
"RTN","RORRP020",157,0)
 ;
"RTN","RORRP020",158,0)
 ; RESULTS       Closed root of the array that contains the
"RTN","RORRP020",159,0)
 ;               results of the query
"RTN","RORRP020",160,0)
 ;
"RTN","RORRP020",161,0)
 ; REGIEN        Registry IEN
"RTN","RORRP020",162,0)
 ;
"RTN","RORRP020",163,0)
 ; FLAGS         Flags that control the execution
"RTN","RORRP020",164,0)
 ;
"RTN","RORRP020",165,0)
 ; Return Values:
"RTN","RORRP020",166,0)
 ;       <0  Error code
"RTN","RORRP020",167,0)
 ;        0  Ok
"RTN","RORRP020",168,0)
 ;
"RTN","RORRP020",169,0)
POSTPROC(RESULTS,REGIEN,FLAGS) ;
"RTN","RORRP020",170,0)
 N BUF,DOD,FNP,FO,IEN,IR,PATIEN,RC,TMP
"RTN","RORRP020",171,0)
 S FNP=($TR(FLAGS,"P")'=FLAGS),FO=(FLAGS["O")
"RTN","RORRP020",172,0)
 ;--- Process the resulting records
"RTN","RORRP020",173,0)
 S (IR,RC)=0
"RTN","RORRP020",174,0)
 F  S IR=$O(@RESULTS@(IR))  Q:IR'>0  D  Q:RC<0
"RTN","RORRP020",175,0)
 . S BUF=$G(@RESULTS@(IR,0)),PATIEN=+$P(BUF,U,2)
"RTN","RORRP020",176,0)
 . I PATIEN'>0  S PATIEN=+BUF  Q:PATIEN'>0
"RTN","RORRP020",177,0)
 . ;--- Load the required fields from the PATIENT file
"RTN","RORRP020",178,0)
 . Q:$$LOAD2(PATIEN,.BUF)<0
"RTN","RORRP020",179,0)
 . S DOD=$P(BUF,U,5)
"RTN","RORRP020",180,0)
 . S @RESULTS@(IR,0)=BUF
"RTN","RORRP020",181,0)
 . ;--- Add optional registry fields if necessary
"RTN","RORRP020",182,0)
 . I FO  D  Q:RC<0
"RTN","RORRP020",183,0)
 . . ;--- Get the IEN of the registry record
"RTN","RORRP020",184,0)
 . . S IEN=$$PRRIEN^RORUTL01(PATIEN,REGIEN)
"RTN","RORRP020",185,0)
 . . ;--- Try to load the data from the ROR REGISTRY RECORD file
"RTN","RORRP020",186,0)
 . . S RC=$$LOAD798(IEN,.BUF,DOD)
"RTN","RORRP020",187,0)
 . . S:RC'<0 @RESULTS@(IR,1)="O^"_BUF
"RTN","RORRP020",188,0)
 ;---
"RTN","RORRP020",189,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORRP021")
0^98^B33183817
"RTN","RORRP021",1,0)
RORRP021 ;HCIOFO/SG - RPC: PATIENT DATA ; 8/19/05 10:28am
"RTN","RORRP021",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP021",3,0)
 ;
"RTN","RORRP021",4,0)
 Q
"RTN","RORRP021",5,0)
 ;
"RTN","RORRP021",6,0)
 ;***** LOADS THE PATIENT DATA
"RTN","RORRP021",7,0)
 ; RPC: [ROR PATIENT GET DATA]
"RTN","RORRP021",8,0)
 ;
"RTN","RORRP021",9,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP021",10,0)
 ;               are returned to.
"RTN","RORRP021",11,0)
 ;
"RTN","RORRP021",12,0)
 ; PTIEN         IEN of the patient (DFN)
"RTN","RORRP021",13,0)
 ;
"RTN","RORRP021",14,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORRP021",15,0)
 ;                 A  Load the patient's address
"RTN","RORRP021",16,0)
 ;                 E  Load the ethnicity information
"RTN","RORRP021",17,0)
 ;                 L  Load values of patient's active local fields
"RTN","RORRP021",18,0)
 ;                 R  Load the race information
"RTN","RORRP021",19,0)
 ;                 S  Load the selection rules
"RTN","RORRP021",20,0)
 ;
"RTN","RORRP021",21,0)
 ;               The "L" and "S" flags require the REGIEN parameter.
"RTN","RORRP021",22,0)
 ;               Otherwise, they are ignored.
"RTN","RORRP021",23,0)
 ;
"RTN","RORRP021",24,0)
 ; [REGIEN]      Registry IEN.
"RTN","RORRP021",25,0)
 ;               If value of this parameter is greater than 0
"RTN","RORRP021",26,0)
 ;               then the "PRD" segment with the basic patient's
"RTN","RORRP021",27,0)
 ;               registry data will be returned. If the patient
"RTN","RORRP021",28,0)
 ;               is not in the registry then an empty "PRD" segment
"RTN","RORRP021",29,0)
 ;               will be returned anyway.
"RTN","RORRP021",30,0)
 ;
"RTN","RORRP021",31,0)
 ; Return Values:
"RTN","RORRP021",32,0)
 ;
"RTN","RORRP021",33,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP021",34,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP021",35,0)
 ; details).
"RTN","RORRP021",36,0)
 ;
"RTN","RORRP021",37,0)
 ; Otherwise, zero is returned in the RESULTS(0) and the subsequent
"RTN","RORRP021",38,0)
 ; nodes of the array contain the patient's data.
"RTN","RORRP021",39,0)
 ; 
"RTN","RORRP021",40,0)
 ; RESULTS(0)            0
"RTN","RORRP021",41,0)
 ;
"RTN","RORRP021",42,0)
 ; RESULTS(i)            Demographic Information
"RTN","RORRP021",43,0)
 ;                         ^01: "DEM"
"RTN","RORRP021",44,0)
 ;                         ^02: ""
"RTN","RORRP021",45,0)
 ;                         ...  See the $$LOAD2^RORRP020 (RORDEM)
"RTN","RORRP021",46,0)
 ;
"RTN","RORRP021",47,0)
 ; RESULTS(i)            Patient's Address
"RTN","RORRP021",48,0)
 ;                         ^01: "ADR"
"RTN","RORRP021",49,0)
 ;                         ^02: ""
"RTN","RORRP021",50,0)
 ;                         ...  See the $$LOAD2^RORRP020 (RORADR)
"RTN","RORRP021",51,0)
 ;
"RTN","RORRP021",52,0)
 ; RESULTS(i)            Race Information
"RTN","RORRP021",53,0)
 ;                         ^01: "RCE"
"RTN","RORRP021",54,0)
 ;                         ^02: Race IEN
"RTN","RORRP021",55,0)
 ;                         ^03: Race HL7 Value
"RTN","RORRP021",56,0)
 ;                         ^04: Race
"RTN","RORRP021",57,0)
 ;                         ^05: Collection Method HL7 Value
"RTN","RORRP021",58,0)
 ;                         ^06: Collection Method
"RTN","RORRP021",59,0)
 ;
"RTN","RORRP021",60,0)
 ;                       Race HL7 Values
"RTN","RORRP021",61,0)
 ;                         1002-5  American Indian or Alaska Native
"RTN","RORRP021",62,0)
 ;                         2028-9  Asian
"RTN","RORRP021",63,0)
 ;                         2054-5  Black or African American
"RTN","RORRP021",64,0)
 ;                         0000-0  Declined to Answer
"RTN","RORRP021",65,0)
 ;                         2076-8  Native Hawaiian or Pacific Islander
"RTN","RORRP021",66,0)
 ;                         9999-4  Unknown by Patient
"RTN","RORRP021",67,0)
 ;                         2106-3  White
"RTN","RORRP021",68,0)
 ;
"RTN","RORRP021",69,0)
 ;                       Collection Method HL7 Values
"RTN","RORRP021",70,0)
 ;                         OBS     Observer
"RTN","RORRP021",71,0)
 ;                         PRX     Proxy
"RTN","RORRP021",72,0)
 ;                         SLF     Self Identification
"RTN","RORRP021",73,0)
 ;                         UNK     Unknown
"RTN","RORRP021",74,0)
 ;
"RTN","RORRP021",75,0)
 ; RESULTS(i)            Ethnicity Information
"RTN","RORRP021",76,0)
 ;                         ^01: "ETN"
"RTN","RORRP021",77,0)
 ;                         ^02: Ethnicity IEN
"RTN","RORRP021",78,0)
 ;                         ^03: Ethnicity HL7 Value
"RTN","RORRP021",79,0)
 ;                         ^04: Ethnicity
"RTN","RORRP021",80,0)
 ;                         ^05: Collection Method HL7 value
"RTN","RORRP021",81,0)
 ;                         ^06: Collection Method
"RTN","RORRP021",82,0)
 ;
"RTN","RORRP021",83,0)
 ;                       Ethnicity HL7 Values
"RTN","RORRP021",84,0)
 ;                         0000-0  Declined to Answer
"RTN","RORRP021",85,0)
 ;                         2135-2  Hispanic or Latino
"RTN","RORRP021",86,0)
 ;                         2186-5  Not Hispanic or Latino
"RTN","RORRP021",87,0)
 ;                         9999-4  Unknown by Patient
"RTN","RORRP021",88,0)
 ;
"RTN","RORRP021",89,0)
 ; RESULTS(i)            Patient's Registry Data
"RTN","RORRP021",90,0)
 ;                         ^01: "PRD"
"RTN","RORRP021",91,0)
 ;                         ^02: ""
"RTN","RORRP021",92,0)
 ;                         ...  See the $$LOAD798^RORRP020
"RTN","RORRP021",93,0)
 ;
"RTN","RORRP021",94,0)
 ; RESULTS(i)            Local field data
"RTN","RORRP021",95,0)
 ;                         ^O1: "LFV"
"RTN","RORRP021",96,0)
 ;                         ^02: IEN in the LOCAL FIELD multiple
"RTN","RORRP021",97,0)
 ;                              of the ROR REGISTRY RECORD file
"RTN","RORRP021",98,0)
 ;                         ^03: Field Definition IEN
"RTN","RORRP021",99,0)
 ;                              (in the ROR LOCAL FIELD file)
"RTN","RORRP021",100,0)
 ;                         ^04: Field Name
"RTN","RORRP021",101,0)
 ;                         ^05: Date (FileMan)
"RTN","RORRP021",102,0)
 ;                         ^06: Comment
"RTN","RORRP021",103,0)
 ;
"RTN","RORRP021",104,0)
 ; RESULTS(i)            Selection Rule
"RTN","RORRP021",105,0)
 ;                         ^01: "PSR"
"RTN","RORRP021",106,0)
 ;                         ^02: IEN in the SELECTION RULE multiple
"RTN","RORRP021",107,0)
 ;                              of the ROR REGISTRY RECORD file
"RTN","RORRP021",108,0)
 ;                         ^03: Rule Definition IEN
"RTN","RORRP021",109,0)
 ;                              (in the ROR SELECTION RULE file)
"RTN","RORRP021",110,0)
 ;                         ^04: Name of the Rule
"RTN","RORRP021",111,0)
 ;                         ^05: Date (FileMan)
"RTN","RORRP021",112,0)
 ;                         ^06: Location IEN  (Institution IEN)
"RTN","RORRP021",113,0)
 ;                         ^07: Location Name (Institution Name)
"RTN","RORRP021",114,0)
 ;                         ^08: Short Description
"RTN","RORRP021",115,0)
 ;
"RTN","RORRP021",116,0)
GETPTDAT(RESULTS,PTIEN,FLAGS,REGIEN) ;
"RTN","RORRP021",117,0)
 N BUF,BUF1,DOD,IEN,RC,RESPTR,RORERRDL,VADM
"RTN","RORRP021",118,0)
 D CLEAR^RORERR("GETPTDAT^RORRP021",1)
"RTN","RORRP021",119,0)
 K RESULTS  S (RESULTS(0),RESPTR)=0
"RTN","RORRP021",120,0)
 ;=== Check the parameters
"RTN","RORRP021",121,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP021",122,0)
 . ;--- Patient IEN
"RTN","RORRP021",123,0)
 . I $G(PTIEN)'>0  D  Q
"RTN","RORRP021",124,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"PTIEN",$G(PTIEN))
"RTN","RORRP021",125,0)
 . S PTIEN=+PTIEN
"RTN","RORRP021",126,0)
 . ;--- Flags
"RTN","RORRP021",127,0)
 . S FLAGS=$$UP^XLFSTR($G(FLAGS))
"RTN","RORRP021",128,0)
 ;=== Load the data from the PATIENT file
"RTN","RORRP021",129,0)
 S RC=$$LOAD2^RORRP020(PTIEN,.BUF,.BUF1,.VADM)
"RTN","RORRP021",130,0)
 I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP021",131,0)
 S DOD=$P(BUF,U,5)
"RTN","RORRP021",132,0)
 ;
"RTN","RORRP021",133,0)
 ;=== Demographic information and address
"RTN","RORRP021",134,0)
 S RESPTR=RESPTR+1,RESULTS(RESPTR)="DEM^^"_BUF
"RTN","RORRP021",135,0)
 S:FLAGS["A" RESPTR=RESPTR+1,RESULTS(RESPTR)="ADR^^"_BUF1
"RTN","RORRP021",136,0)
 ;
"RTN","RORRP021",137,0)
 ;=== Race information
"RTN","RORRP021",138,0)
 I FLAGS["R"  D:$G(VADM(12))>0
"RTN","RORRP021",139,0)
 . N I,METHOD,RACE
"RTN","RORRP021",140,0)
 . S I=""
"RTN","RORRP021",141,0)
 . F  S I=$O(VADM(12,I))  Q:I=""  D
"RTN","RORRP021",142,0)
 . . S RACE=$G(VADM(12,I))  Q:RACE'>0
"RTN","RORRP021",143,0)
 . . S METHOD=$G(VADM(12,I,1))
"RTN","RORRP021",144,0)
 . . S BUF="RCE"_U_(+RACE)
"RTN","RORRP021",145,0)
 . . ;--- 
"RTN","RORRP021",146,0)
 . . S $P(BUF,U,3)=$$PTR2CODE^DGUTL4(+RACE,1,2)
"RTN","RORRP021",147,0)
 . . S $P(BUF,U,4)=$P(RACE,U,2)
"RTN","RORRP021",148,0)
 . . S $P(BUF,U,5)=$$PTR2CODE^DGUTL4(+METHOD,3,2)
"RTN","RORRP021",149,0)
 . . S $P(BUF,U,6)=$P(METHOD,U,2)
"RTN","RORRP021",150,0)
 . . ;---
"RTN","RORRP021",151,0)
 . . S RESPTR=RESPTR+1,RESULTS(RESPTR)=BUF
"RTN","RORRP021",152,0)
 ;
"RTN","RORRP021",153,0)
 ;=== Ethnicity information
"RTN","RORRP021",154,0)
 I FLAGS["E"  D:$G(VADM(11))>0
"RTN","RORRP021",155,0)
 . N ETHN,I,METHOD
"RTN","RORRP021",156,0)
 . S I=""
"RTN","RORRP021",157,0)
 . F  S I=$O(VADM(11,I))  Q:I=""  D
"RTN","RORRP021",158,0)
 . . S ETHN=$G(VADM(11,I))  Q:ETHN'>0
"RTN","RORRP021",159,0)
 . . S METHOD=$G(VADM(11,I,1))
"RTN","RORRP021",160,0)
 . . S BUF="ETN"_U_(+ETHN)
"RTN","RORRP021",161,0)
 . . ;--- 
"RTN","RORRP021",162,0)
 . . S $P(BUF,U,3)=$$PTR2CODE^DGUTL4(+ETHN,2,2)
"RTN","RORRP021",163,0)
 . . S $P(BUF,U,4)=$P(ETHN,U,2)
"RTN","RORRP021",164,0)
 . . S $P(BUF,U,5)=$$PTR2CODE^DGUTL4(+METHOD,3,2)
"RTN","RORRP021",165,0)
 . . S $P(BUF,U,6)=$P(METHOD,U,2)
"RTN","RORRP021",166,0)
 . . ;---
"RTN","RORRP021",167,0)
 . . S RESPTR=RESPTR+1,RESULTS(RESPTR)=BUF
"RTN","RORRP021",168,0)
 ;
"RTN","RORRP021",169,0)
 ;=== Patient's registry data
"RTN","RORRP021",170,0)
 I $G(REGIEN)>0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP021",171,0)
 . S RESPTR=RESPTR+1
"RTN","RORRP021",172,0)
 . ;--- Get the IEN of the registry record
"RTN","RORRP021",173,0)
 . S IEN=$$PRRIEN^RORUTL01(PTIEN,REGIEN)
"RTN","RORRP021",174,0)
 . I IEN'>0  S RESULTS(RESPTR)="PRD"  Q
"RTN","RORRP021",175,0)
 . ;--- Load the data from the patient's registry record
"RTN","RORRP021",176,0)
 . S RC=$$LOAD798^RORRP020(IEN,.BUF,DOD)  Q:RC<0
"RTN","RORRP021",177,0)
 . S RESULTS(RESPTR)="PRD^^"_BUF
"RTN","RORRP021",178,0)
 . ;--- Local field values
"RTN","RORRP021",179,0)
 . I FLAGS["L"  D  Q:RC<0
"RTN","RORRP021",180,0)
 . . S RC=$$LFV(IEN,.RESULTS,.RESPTR)
"RTN","RORRP021",181,0)
 . ;--- Selection rules
"RTN","RORRP021",182,0)
 . I FLAGS["S"  D  Q:RC<0
"RTN","RORRP021",183,0)
 . . S RC=$$PSR(IEN,.RESULTS,.RESPTR)
"RTN","RORRP021",184,0)
 ;===
"RTN","RORRP021",185,0)
 Q
"RTN","RORRP021",186,0)
 ;
"RTN","RORRP021",187,0)
 ;***** GET THE LOCAL FIELD VALUES
"RTN","RORRP021",188,0)
LFV(IEN798,RESULTS,RESPTR) ;
"RTN","RORRP021",189,0)
 N I,IEN,IENS,RORBUF,SCR,RORMSG
"RTN","RORRP021",190,0)
 S DT=$$DT^XLFDT
"RTN","RORRP021",191,0)
 ;--- Load the data
"RTN","RORRP021",192,0)
 S SCR="I $$LFACTIVE^RORDD01(+$G(^(0)))"
"RTN","RORRP021",193,0)
 S IENS=","_IEN798_",",I="@;.01I;.01E;.02I;1"
"RTN","RORRP021",194,0)
 D LIST^DIC(798.02,IENS,I,"P",,,,"B",SCR,,"RORBUF","RORMSG")
"RTN","RORRP021",195,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.02,IENS)
"RTN","RORRP021",196,0)
 ;--- Add the data to the output array
"RTN","RORRP021",197,0)
 S I=0
"RTN","RORRP021",198,0)
 F  S I=$O(RORBUF("DILIST",I))  Q:I'>0  D
"RTN","RORRP021",199,0)
 . S RESPTR=RESPTR+1
"RTN","RORRP021",200,0)
 . S RESULTS(RESPTR)="LFV^"_RORBUF("DILIST",I,0)
"RTN","RORRP021",201,0)
 ;--- Success
"RTN","RORRP021",202,0)
 Q 0
"RTN","RORRP021",203,0)
 ;
"RTN","RORRP021",204,0)
 ;***** GET THE SELECTION RULES
"RTN","RORRP021",205,0)
PSR(IEN798,RESULTS,RESPTR) ;
"RTN","RORRP021",206,0)
 N BUF,I,IEN,IENS,RORBUF,RORMSG,TMP
"RTN","RORRP021",207,0)
 ;--- Load the data
"RTN","RORRP021",208,0)
 S IENS=","_IEN798_",",TMP="@;.01I;.01E;1I;2I;2E"
"RTN","RORRP021",209,0)
 D LIST^DIC(798.01,IENS,TMP,"P",,,,"AD",,,"RORBUF","RORMSG")
"RTN","RORRP021",210,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.01,IENS)
"RTN","RORRP021",211,0)
 ;--- Add the data to the output array
"RTN","RORRP021",212,0)
 S I=0
"RTN","RORRP021",213,0)
 F  S I=$O(RORBUF("DILIST",I))  Q:I'>0  D
"RTN","RORRP021",214,0)
 . S BUF=RORBUF("DILIST",I,0),IEN=+$P(BUF,U,2)  Q:IEN'>0
"RTN","RORRP021",215,0)
 . S TMP=$$GET1^DIQ(798.2,IEN_",",4,,,"RORMSG")
"RTN","RORRP021",216,0)
 . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,798.2,IEN_",")
"RTN","RORRP021",217,0)
 . S $P(BUF,U,7)=$S(TMP'="":TMP,1:$P(BUF,U,3))
"RTN","RORRP021",218,0)
 . S RESPTR=RESPTR+1,RESULTS(RESPTR)="PSR^"_BUF
"RTN","RORRP021",219,0)
 ;--- Success
"RTN","RORRP021",220,0)
 Q 0
"RTN","RORRP022")
0^99^B4289383
"RTN","RORRP022",1,0)
RORRP022 ;HCIOFO/SG - RPC: SELECTION RULES ; 8/2/05 11:15am
"RTN","RORRP022",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP022",3,0)
 ;
"RTN","RORRP022",4,0)
 Q
"RTN","RORRP022",5,0)
 ;
"RTN","RORRP022",6,0)
 ;***** LOADS THE SELECTION RULES FROM THE REGISTRY RECORD
"RTN","RORRP022",7,0)
 ; RPC: [ROR PATIENT SELECTION RULES]
"RTN","RORRP022",8,0)
 ;
"RTN","RORRP022",9,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP022",10,0)
 ;               are returned to.
"RTN","RORRP022",11,0)
 ;
"RTN","RORRP022",12,0)
 ; REGIEN        Registry IEN
"RTN","RORRP022",13,0)
 ;
"RTN","RORRP022",14,0)
 ; PATIEN        IEN of the registry patient (DFN)
"RTN","RORRP022",15,0)
 ;
"RTN","RORRP022",16,0)
 ; Return Values:
"RTN","RORRP022",17,0)
 ;
"RTN","RORRP022",18,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP022",19,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP022",20,0)
 ; details).
"RTN","RORRP022",21,0)
 ;
"RTN","RORRP022",22,0)
 ; Otherwise, number of selection rules is returned in the RESULTS(0)
"RTN","RORRP022",23,0)
 ; and the subsequent nodes of the array contain the rules.
"RTN","RORRP022",24,0)
 ; 
"RTN","RORRP022",25,0)
 ; RESULTS(0)            Number of selection rules
"RTN","RORRP022",26,0)
 ;
"RTN","RORRP022",27,0)
 ; RESULTS(i)            Selection Rule
"RTN","RORRP022",28,0)
 ;                         ^01: IEN in the SELECTION RULE multiple
"RTN","RORRP022",29,0)
 ;                              of the ROR REGISTRY RECORD file
"RTN","RORRP022",30,0)
 ;                         ^02: IEN of the Rule (in the
"RTN","RORRP022",31,0)
 ;                              ROR SELECTION RULE file)
"RTN","RORRP022",32,0)
 ;                         ^03: Name of the Rule
"RTN","RORRP022",33,0)
 ;                         ^04: Date (FileMan)
"RTN","RORRP022",34,0)
 ;                         ^05: Location IEN  (Institution IEN)
"RTN","RORRP022",35,0)
 ;                         ^06: Location Name (Institution Name)
"RTN","RORRP022",36,0)
 ;                         ^07: Short Description
"RTN","RORRP022",37,0)
 ;
"RTN","RORRP022",38,0)
PTRULES(RESULTS,REGIEN,PATIEN) ;
"RTN","RORRP022",39,0)
 N BUF,CNT,I,IEN,IENS,RC,RORBUF,RORMSG,TMP
"RTN","RORRP022",40,0)
 D CLEAR^RORERR("PTRULES^RORRP022",1)
"RTN","RORRP022",41,0)
 K RESULTS  S RESULTS(0)=0
"RTN","RORRP022",42,0)
 ;--- Check the parameters
"RTN","RORRP022",43,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP022",44,0)
 . ;--- Registry IEN
"RTN","RORRP022",45,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP022",46,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP022",47,0)
 . S REGIEN=+REGIEN
"RTN","RORRP022",48,0)
 . ;--- Patient IEN
"RTN","RORRP022",49,0)
 . I $G(PATIEN)'>0  D  Q
"RTN","RORRP022",50,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"PATIEN",$G(PATIEN))
"RTN","RORRP022",51,0)
 . S PATIEN=+PATIEN
"RTN","RORRP022",52,0)
 ;--- Get the IEN of the registry record
"RTN","RORRP022",53,0)
 S IEN=$$PRRIEN^RORUTL01(PATIEN,REGIEN)  Q:IEN'>0
"RTN","RORRP022",54,0)
 ;--- Load the selection rules
"RTN","RORRP022",55,0)
 S IENS=","_IEN_",",TMP="@;.01I;.01E;1I;2I;2E"
"RTN","RORRP022",56,0)
 D LIST^DIC(798.01,IENS,TMP,"P",,,,"AD",,,"RORBUF","RORMSG")
"RTN","RORRP022",57,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP022",58,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.01,IENS)
"RTN","RORRP022",59,0)
 ;--- Populate the output array
"RTN","RORRP022",60,0)
 S (CNT,I)=0
"RTN","RORRP022",61,0)
 F  S I=$O(RORBUF("DILIST",I))  Q:I'>0  D
"RTN","RORRP022",62,0)
 . S BUF=RORBUF("DILIST",I,0),IEN=+$P(BUF,U,2)  Q:IEN'>0
"RTN","RORRP022",63,0)
 . S CNT=CNT+1,RESULTS(CNT)=BUF
"RTN","RORRP022",64,0)
 . S TMP=$$GET1^DIQ(798.2,IEN_",",4,,,"RORMSG")
"RTN","RORRP022",65,0)
 . S $P(RESULTS(CNT),U,7)=$S(TMP'="":TMP,1:$P(BUF,U,3))
"RTN","RORRP022",66,0)
 S RESULTS(0)=CNT
"RTN","RORRP022",67,0)
 Q
"RTN","RORRP023")
0^100^B10243108
"RTN","RORRP023",1,0)
RORRP023 ;HCIOFO/SG - RPC: REGISTRY COORDINATORS ; 7/16/03 11:25am
"RTN","RORRP023",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP023",3,0)
 ;
"RTN","RORRP023",4,0)
 ; This routine uses the following IAs:
"RTN","RORRP023",5,0)
 ;
"RTN","RORRP023",6,0)
 ; #10060        Read access (FileMan) to the file #200 (supported)
"RTN","RORRP023",7,0)
 ;
"RTN","RORRP023",8,0)
 Q
"RTN","RORRP023",9,0)
 ;
"RTN","RORRP023",10,0)
 ;***** RETURNS THE LIST OF REGISTRY COORDINATORS
"RTN","RORRP023",11,0)
 ; RPC: [ROR LIST COORDINATORS]
"RTN","RORRP023",12,0)
 ;
"RTN","RORRP023",13,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP023",14,0)
 ;               are returned to.
"RTN","RORRP023",15,0)
 ;
"RTN","RORRP023",16,0)
 ; REGIEN        Registry IEN
"RTN","RORRP023",17,0)
 ;
"RTN","RORRP023",18,0)
 ; The ^TMP("DILIST",$J) global node is used by the procedure.
"RTN","RORRP023",19,0)
 ;
"RTN","RORRP023",20,0)
 ; Return Values:
"RTN","RORRP023",21,0)
 ;
"RTN","RORRP023",22,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP023",23,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP023",24,0)
 ; details).
"RTN","RORRP023",25,0)
 ;
"RTN","RORRP023",26,0)
 ; Otherwise, number of coordinators is returned in the
"RTN","RORRP023",27,0)
 ; @RESULTS@(0) and the subsequent nodes of the global array
"RTN","RORRP023",28,0)
 ; contain the coordinators.
"RTN","RORRP023",29,0)
 ; 
"RTN","RORRP023",30,0)
 ; @RESULTS@(0)          Number of Coordinators
"RTN","RORRP023",31,0)
 ;
"RTN","RORRP023",32,0)
 ; @RESULTS@(i)          Coordinator's Descriptor
"RTN","RORRP023",33,0)
 ;                         ^01: IEN
"RTN","RORRP023",34,0)
 ;                         ^02: Name
"RTN","RORRP023",35,0)
 ;
"RTN","RORRP023",36,0)
RCLIST(RESULTS,REGIEN) ;
"RTN","RORRP023",37,0)
 N IENS,RC,RORERRDL,RORMSG,TMP
"RTN","RORRP023",38,0)
 D CLEAR^RORERR("RCLIST^RORRP023",1)
"RTN","RORRP023",39,0)
 K RESULTS  S RESULTS=$NA(^TMP("DILIST",$J))  K @RESULTS
"RTN","RORRP023",40,0)
 ;--- Check the parameters
"RTN","RORRP023",41,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP023",42,0)
 . ;--- Registry IEN
"RTN","RORRP023",43,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP023",44,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP023",45,0)
 . S REGIEN=+REGIEN
"RTN","RORRP023",46,0)
 ;--- Get the list of coordinators
"RTN","RORRP023",47,0)
 S IENS=","_REGIEN_",",TMP="@;.01E"
"RTN","RORRP023",48,0)
 D LIST^DIC(798.114,IENS,TMP,"PU",,,,"B",,,,"RORMSG")
"RTN","RORRP023",49,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP023",50,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.114,IENS)
"RTN","RORRP023",51,0)
 ;--- Success
"RTN","RORRP023",52,0)
 S TMP=+$G(^TMP("DILIST",$J,0))
"RTN","RORRP023",53,0)
 K ^TMP("DILIST",$J,0)  S @RESULTS@(0)=TMP
"RTN","RORRP023",54,0)
 Q
"RTN","RORRP023",55,0)
 ;
"RTN","RORRP023",56,0)
 ;***** UPDATES THE LIST OF REGISTRY COORDINATORS
"RTN","RORRP023",57,0)
 ; RPC: [ROR UPDATE COORDINATORS]
"RTN","RORRP023",58,0)
 ;
"RTN","RORRP023",59,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP023",60,0)
 ;               are returned to.
"RTN","RORRP023",61,0)
 ;
"RTN","RORRP023",62,0)
 ; REGIEN        Registry IEN
"RTN","RORRP023",63,0)
 ;
"RTN","RORRP023",64,0)
 ; .RCLST(       Reference to a local variable that contains
"RTN","RORRP023",65,0)
 ;               a list of registry coordinators
"RTN","RORRP023",66,0)
 ;   i)            User IEN (DUZ)
"RTN","RORRP023",67,0)
 ;
"RTN","RORRP023",68,0)
 ; Return Values:
"RTN","RORRP023",69,0)
 ;
"RTN","RORRP023",70,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP023",71,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP023",72,0)
 ; details).
"RTN","RORRP023",73,0)
 ;
"RTN","RORRP023",74,0)
 ; Otherwise, zero is returned in the RESULTS(0).
"RTN","RORRP023",75,0)
 ;
"RTN","RORRP023",76,0)
RCLUPD(RESULTS,REGIEN,RCLST) ;
"RTN","RORRP023",77,0)
 N DA,DIK,ECNT,IEN,IENS,RC,RCL,ROOT,RORERRDL,RORFDA,RORIEN,RORMSG,TMP
"RTN","RORRP023",78,0)
 D CLEAR^RORERR("RCLUPD^RORRP023",1)  K RESULTS
"RTN","RORRP023",79,0)
 ;--- Check the parameters
"RTN","RORRP023",80,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP023",81,0)
 . ;--- Registry IEN
"RTN","RORRP023",82,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP023",83,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP023",84,0)
 . S REGIEN=+REGIEN
"RTN","RORRP023",85,0)
 ;
"RTN","RORRP023",86,0)
 ;--- Lock the COORDINATOR multiple
"RTN","RORRP023",87,0)
 S IENS=","_REGIEN_","
"RTN","RORRP023",88,0)
 S RC=$$LOCK^RORLOCK(798.114,IENS)
"RTN","RORRP023",89,0)
 I RC  D:RC>0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP023",90,0)
 . S RC=$$ERROR^RORERR(-11,,,,"the COORDINATOR multiple")
"RTN","RORRP023",91,0)
 ;---
"RTN","RORRP023",92,0)
 S ROOT=$$ROOT^DILFD(798.114,IENS,1)
"RTN","RORRP023",93,0)
 ;
"RTN","RORRP023",94,0)
 ;--- Create a list of coordinators' IENs
"RTN","RORRP023",95,0)
 S TMP=""
"RTN","RORRP023",96,0)
 F  S TMP=$O(RCLST(TMP))  Q:TMP=""  D
"RTN","RORRP023",97,0)
 . S IEN=+RCLST(TMP)
"RTN","RORRP023",98,0)
 . S:$$FIND1^DIC(200,,,"`"_IEN,,,"RORMSG")>0 RCL(IEN)=""
"RTN","RORRP023",99,0)
 ;
"RTN","RORRP023",100,0)
 ;--- Delete the coordinators
"RTN","RORRP023",101,0)
 S DIK=$$OREF^DILF(ROOT),DA(1)=REGIEN,DA=0
"RTN","RORRP023",102,0)
 F  S DA=$O(@ROOT@(DA))  Q:DA'>0  D:'$D(RCL(DA)) ^DIK
"RTN","RORRP023",103,0)
 ;--- Update the coordinators
"RTN","RORRP023",104,0)
 S (ECNT,IEN)=0,IENS="?+1,"_REGIEN_","
"RTN","RORRP023",105,0)
 F  S IEN=$O(RCL(IEN))  Q:IEN'>0  D
"RTN","RORRP023",106,0)
 . S RORFDA(798.114,IENS,.01)=IEN
"RTN","RORRP023",107,0)
 . S RORIEN(1)=IEN
"RTN","RORRP023",108,0)
 . D UPDATE^DIE(,"RORFDA","RORIEN","RORMSG")
"RTN","RORRP023",109,0)
 . I $G(DIERR)  D  S ECNT=ECNT+1  Q
"RTN","RORRP023",110,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,798.114,IENS)
"RTN","RORRP023",111,0)
 ;
"RTN","RORRP023",112,0)
 ;--- Unlock the multiple and check for errors
"RTN","RORRP023",113,0)
 D UNLOCK^RORLOCK(798.114,","_REGIEN_",")
"RTN","RORRP023",114,0)
 I ECNT>0  D RPCSTK^RORERR(.RESULTS,-9)  Q
"RTN","RORRP023",115,0)
 ;--- Success
"RTN","RORRP023",116,0)
 S RESULTS(0)=0
"RTN","RORRP023",117,0)
 Q
"RTN","RORRP024")
0^5^B18900459
"RTN","RORRP024",1,0)
RORRP024 ;HCIOFO/SG - RPC: VISTA USERS ; 12/15/05 4:31pm
"RTN","RORRP024",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP024",3,0)
 ;
"RTN","RORRP024",4,0)
 ; This routine uses the following IAs:
"RTN","RORRP024",5,0)
 ;
"RTN","RORRP024",6,0)
 ; #10060        Read access (FileMan) to the NEW PERSON file
"RTN","RORRP024",7,0)
 ;
"RTN","RORRP024",8,0)
 Q
"RTN","RORRP024",9,0)
 ;
"RTN","RORRP024",10,0)
 ;***** RETURNS THE DEFAULT DIVISION FOR THE USER
"RTN","RORRP024",11,0)
 ;
"RTN","RORRP024",12,0)
 ; USER          User IEN in file #200 (DUZ)
"RTN","RORRP024",13,0)
 ;
"RTN","RORRP024",14,0)
 ; Return Values:
"RTN","RORRP024",15,0)
 ;      ...  Default Division
"RTN","RORRP024",16,0)
 ;             ^01: IEN (in the INSTITUTION file)
"RTN","RORRP024",17,0)
 ;             ^02: Name
"RTN","RORRP024",18,0)
 ;
"RTN","RORRP024",19,0)
DFLTDIV(USER) ;
"RTN","RORRP024",20,0)
 N DIV,IENS,IR,RORBUF,RORMSG,TMP
"RTN","RORRP024",21,0)
 S IENS=","_(+USER)_",",TMP="@;.01I;.01E;1I"
"RTN","RORRP024",22,0)
 D LIST^DIC(200.02,IENS,TMP,"PQ",,,,"#",,,"RORBUF","RORMSG")
"RTN","RORRP024",23,0)
 D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,200,IENS)
"RTN","RORRP024",24,0)
 S DIV=""
"RTN","RORRP024",25,0)
 ;--- Look for default division
"RTN","RORRP024",26,0)
 D:$G(RORBUF("DILIST",0))>0
"RTN","RORRP024",27,0)
 . S IR=0
"RTN","RORRP024",28,0)
 . F  S IR=$O(RORBUF("DILIST",IR))  Q:IR'>0  D  Q:DIV'=""
"RTN","RORRP024",29,0)
 . . S TMP=$G(RORBUF("DILIST",IR,0))
"RTN","RORRP024",30,0)
 . . S:$P(TMP,U,4) DIV=$P(TMP,U,2,3)
"RTN","RORRP024",31,0)
 . ;--- If name of the default division is not available
"RTN","RORRP024",32,0)
 . ;    and the only division is associated with the user
"RTN","RORRP024",33,0)
 . ;--- then use this division as the default one.
"RTN","RORRP024",34,0)
 . I $P(DIV,U,2)=""  D:RORBUF("DILIST",0)<2
"RTN","RORRP024",35,0)
 . . S DIV=$P($G(RORBUF("DILIST",1,0)),U,2,3)
"RTN","RORRP024",36,0)
 ;--- If default division is not available, use the site
"RTN","RORRP024",37,0)
 Q $S($P(DIV,U,2)'="":DIV,1:$P($$SITE^VASITE(),U,1,2))
"RTN","RORRP024",38,0)
 ;
"RTN","RORRP024",39,0)
 ;***** RETURNS INFORMATION ABOUT THE USER
"RTN","RORRP024",40,0)
 ; RPC: [ROR GET USER IFNO]
"RTN","RORRP024",41,0)
 ;
"RTN","RORRP024",42,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP024",43,0)
 ;               are returned to.
"RTN","RORRP024",44,0)
 ;
"RTN","RORRP024",45,0)
 ; [USER]        User IEN in the NEW PERSON file. By default
"RTN","RORRP024",46,0)
 ;               (if $G(USER)'>0), the DUZ is used).
"RTN","RORRP024",47,0)
 ;
"RTN","RORRP024",48,0)
 ; Return Values:
"RTN","RORRP024",49,0)
 ;
"RTN","RORRP024",50,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP024",51,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP024",52,0)
 ; details).
"RTN","RORRP024",53,0)
 ;
"RTN","RORRP024",54,0)
 ; Otherwise, the user info is returned in the RESULTS(0).
"RTN","RORRP024",55,0)
 ; 
"RTN","RORRP024",56,0)
 ; RESULTS(0)            User Info
"RTN","RORRP024",57,0)
 ;                         ^01: IEN
"RTN","RORRP024",58,0)
 ;                         ^02: Name
"RTN","RORRP024",59,0)
 ;                         ^03: Office Phone
"RTN","RORRP024",60,0)
 ;                         ^04: Nickname
"RTN","RORRP024",61,0)
 ;                         ^05: Read Timeout
"RTN","RORRP024",62,0)
 ;                         ^06: Default Division IEN
"RTN","RORRP024",63,0)
 ;                         ^07: Default Division Name
"RTN","RORRP024",64,0)
 ;                         ^08: Institution IEN
"RTN","RORRP024",65,0)
 ;                         ^09: Institution Name
"RTN","RORRP024",66,0)
 ;                         ^10: Station Number (with suffix)
"RTN","RORRP024",67,0)
 ;
"RTN","RORRP024",68,0)
USERINFO(RESULTS,USER) ;
"RTN","RORRP024",69,0)
 N IENS,RORBUF,RORERRDL,RORMSG,TMP
"RTN","RORRP024",70,0)
 D CLEAR^RORERR("USERINFO^RORRP024",1)
"RTN","RORRP024",71,0)
 K RESULTS  S RESULTS(0)=0
"RTN","RORRP024",72,0)
 I $G(USER)'>0  S USER=+$G(DUZ)  Q:USER'>0
"RTN","RORRP024",73,0)
 ;--- Load the data
"RTN","RORRP024",74,0)
 S IENS=USER_","
"RTN","RORRP024",75,0)
 D GETS^DIQ(200,IENS,".01;.132;13",,"RORBUF","RORMSG")
"RTN","RORRP024",76,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP024",77,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,200)  K ^TMP("DILIST",$J)
"RTN","RORRP024",78,0)
 ;--- Compile the result
"RTN","RORRP024",79,0)
 S RESULTS(0)=USER
"RTN","RORRP024",80,0)
 S $P(RESULTS(0),U,2)=$G(RORBUF(200,IENS,.01))  ; Name
"RTN","RORRP024",81,0)
 S $P(RESULTS(0),U,3)=$G(RORBUF(200,IENS,.132)) ; Office Phone
"RTN","RORRP024",82,0)
 S $P(RESULTS(0),U,4)=$G(RORBUF(200,IENS,13))   ; Nick Name
"RTN","RORRP024",83,0)
 S $P(RESULTS(0),U,5)=$$DTIME^XUP(USER)         ; Read Timeout
"RTN","RORRP024",84,0)
 S TMP=$$DFLTDIV(USER)
"RTN","RORRP024",85,0)
 S $P(RESULTS(0),U,6,7)=$P(TMP,U,1,2)           ; Default Division
"RTN","RORRP024",86,0)
 S $P(RESULTS(0),U,8,10)=$$SITE^VASITE()
"RTN","RORRP024",87,0)
 Q
"RTN","RORRP024",88,0)
 ;
"RTN","RORRP024",89,0)
 ;***** RETURNS THE LIST OF VISTA USERS
"RTN","RORRP024",90,0)
 ; RPC: [ROR LIST VISTA USERS]
"RTN","RORRP024",91,0)
 ;
"RTN","RORRP024",92,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP024",93,0)
 ;               are returned to.
"RTN","RORRP024",94,0)
 ;
"RTN","RORRP024",95,0)
 ; PART          The search pattern (partial match restriction)
"RTN","RORRP024",96,0)
 ;
"RTN","RORRP024",97,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORRP024",98,0)
 ;                 B  Backwards. Traverses the index in the opposite
"RTN","RORRP024",99,0)
 ;                    direction of normal traversal.
"RTN","RORRP024",100,0)
 ;                 D  Get default division for each user
"RTN","RORRP024",101,0)
 ;                 P  Select providers only (check for the PROVIDER
"RTN","RORRP024",102,0)
 ;                    security key)
"RTN","RORRP024",103,0)
 ;
"RTN","RORRP024",104,0)
 ; [NUMBER]      Maximum number of entries to return. A value of "*"
"RTN","RORRP024",105,0)
 ;               or no value in this parameter designates all entries.
"RTN","RORRP024",106,0)
 ;
"RTN","RORRP024",107,0)
 ; [FROM]        The index entry(s) from which to begin the list.
"RTN","RORRP024",108,0)
 ;               You should use the pieces of the @RESULTS@(0) node
"RTN","RORRP024",109,0)
 ;               (starting from the second one) to continue the
"RTN","RORRP024",110,0)
 ;               listing in the subsequent procedure calls.
"RTN","RORRP024",111,0)
 ;
"RTN","RORRP024",112,0)
 ;               NOTE: The FROM value itself is not included in
"RTN","RORRP024",113,0)
 ;                     the resulting list.
"RTN","RORRP024",114,0)
 ;
"RTN","RORRP024",115,0)
 ; The ^TMP("DILIST",$J) global node is used by the procedure.
"RTN","RORRP024",116,0)
 ;
"RTN","RORRP024",117,0)
 ; See description of the LIST^DIC for more details about the
"RTN","RORRP024",118,0)
 ; PART, NUMBER and FROM parameters.
"RTN","RORRP024",119,0)
 ;
"RTN","RORRP024",120,0)
 ; Return Values:
"RTN","RORRP024",121,0)
 ;
"RTN","RORRP024",122,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP024",123,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP024",124,0)
 ; details).
"RTN","RORRP024",125,0)
 ;
"RTN","RORRP024",126,0)
 ; Otherwise, number of VistA users and the value of the FROM
"RTN","RORRP024",127,0)
 ; parameter for the next procedure call are returned in the
"RTN","RORRP024",128,0)
 ; @RESULTS@(0) and the subsequent nodes of the global array
"RTN","RORRP024",129,0)
 ; contain the users.
"RTN","RORRP024",130,0)
 ; 
"RTN","RORRP024",131,0)
 ; @RESULTS@(0)          Result Descriptor
"RTN","RORRP024",132,0)
 ;                         ^01: Number of users
"RTN","RORRP024",133,0)
 ;                         ^02: Values that comprise the FROM
"RTN","RORRP024",134,0)
 ;                         ^nn: parameter for the subsequent call
"RTN","RORRP024",135,0)
 ;
"RTN","RORRP024",136,0)
 ; @RESULTS@(i)          User
"RTN","RORRP024",137,0)
 ;                         ^01: IEN
"RTN","RORRP024",138,0)
 ;                         ^02: Name
"RTN","RORRP024",139,0)
 ;                         ^03: Office Phone
"RTN","RORRP024",140,0)
 ;                         ^04: Nickname
"RTN","RORRP024",141,0)
 ;                         ^05: reserved
"RTN","RORRP024",142,0)
 ;                         ^06: Default Division IEN  (only if D flag)
"RTN","RORRP024",143,0)
 ;                         ^07: Default Division Name (only if D flag)
"RTN","RORRP024",144,0)
 ;
"RTN","RORRP024",145,0)
USERLIST(RESULTS,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP024",146,0)
 N BUF,FIELDS,I,RC,RORERRDL,SCR,TMP
"RTN","RORRP024",147,0)
 D CLEAR^RORERR("USERLIST^RORRP024",1)
"RTN","RORRP024",148,0)
 K RESULTS  S RESULTS=$NA(^TMP("DILIST",$J))  K @RESULTS
"RTN","RORRP024",149,0)
 ;--- Check the parameters
"RTN","RORRP024",150,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP024",151,0)
 . ;--- Flags
"RTN","RORRP024",152,0)
 . S FLAGS=$$UP^XLFSTR($G(FLAGS))
"RTN","RORRP024",153,0)
 . ;--- Others
"RTN","RORRP024",154,0)
 . S PART=$G(PART),FROM=$G(FROM)
"RTN","RORRP024",155,0)
 . S NUMBER=$S($G(NUMBER)>0:+NUMBER,1:"*")
"RTN","RORRP024",156,0)
 ;--- Setup the start point
"RTN","RORRP024",157,0)
 F I=1:1  S TMP=$P(FROM,U,I)  Q:TMP=""  S FROM(I)=TMP
"RTN","RORRP024",158,0)
 S FROM=$G(FROM(1))
"RTN","RORRP024",159,0)
 ;--- Compile the screen logic (be careful with naked references)
"RTN","RORRP024",160,0)
 S SCR=""
"RTN","RORRP024",161,0)
 S:FLAGS["P" SCR=SCR_"I $D(^XUSEC(""PROVIDER"",Y))"
"RTN","RORRP024",162,0)
 ;--- Query the file
"RTN","RORRP024",163,0)
 S FIELDS="@;.01;.132;13",TMP="P"_$S(FLAGS["B":"B",1:"")
"RTN","RORRP024",164,0)
 D LIST^DIC(200,,FIELDS,TMP,NUMBER,.FROM,PART,"B",SCR,,,"RORMSG")
"RTN","RORRP024",165,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP024",166,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,200)  K ^TMP("DILIST",$J)
"RTN","RORRP024",167,0)
 ;--- Add default divisions
"RTN","RORRP024",168,0)
 I FLAGS["D"  S I=0  D
"RTN","RORRP024",169,0)
 . F  S I=$O(@RESULTS@(I))  Q:I'>0  D
"RTN","RORRP024",170,0)
 . . S $P(@RESULTS@(I,0),U,6,7)=$P($$DFLTDIV(+@RESULTS@(I,0)),U,1,2)
"RTN","RORRP024",171,0)
 ;--- Success
"RTN","RORRP024",172,0)
 S TMP=$G(^TMP("DILIST",$J,0)),BUF=+$P(TMP,U)
"RTN","RORRP024",173,0)
 K ^TMP("DILIST",$J,0)
"RTN","RORRP024",174,0)
 I $P(TMP,U,3)  S I=0  D
"RTN","RORRP024",175,0)
 . F  S I=$O(FROM(I))  Q:I'>0  S TMP=FROM(I)  S:TMP'="" BUF=BUF_U_TMP
"RTN","RORRP024",176,0)
 S @RESULTS@(0)=BUF
"RTN","RORRP024",177,0)
 Q
"RTN","RORRP025")
0^101^B32323014
"RTN","RORRP025",1,0)
RORRP025 ;HCIOFO/SG - RPC: RORICR CDC LOAD ; 2/3/04 8:11am
"RTN","RORRP025",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP025",3,0)
 ;
"RTN","RORRP025",4,0)
 ; This routine uses the following IAs:
"RTN","RORRP025",5,0)
 ;
"RTN","RORRP025",6,0)
 ; #10060        Read access to the NEW PERSON file (#200)
"RTN","RORRP025",7,0)
 ;
"RTN","RORRP025",8,0)
 ;--------------------------------------------------------------------
"RTN","RORRP025",9,0)
 ; Registry: [VA HIV]
"RTN","RORRP025",10,0)
 ;--------------------------------------------------------------------
"RTN","RORRP025",11,0)
 Q
"RTN","RORRP025",12,0)
 ;
"RTN","RORRP025",13,0)
 ;***** DEMOGRAPHIC INFORMATION (III)
"RTN","RORRP025",14,0)
CDM(IENS) ;
"RTN","RORRP025",15,0)
 N BUF,RC,RORBUF,TMP
"RTN","RORRP025",16,0)
 S BUF="CDM"
"RTN","RORRP025",17,0)
 S RC=$$LOAD^RORRP026(IENS,"CDM^RORRP026",.BUF,.RORBUF)  Q:RC<0 RC
"RTN","RORRP025",18,0)
 ;--- Age at diagnosis
"RTN","RORRP025",19,0)
 S TMP=+$G(RORBUF(799.4,IENS,9.02,"I"))
"RTN","RORRP025",20,0)
 S:TMP=1 $P(BUF,U,4)=$G(RORBUF(799.4,IENS,9.03,"I"))
"RTN","RORRP025",21,0)
 S:TMP=2 $P(BUF,U,4)=$G(RORBUF(799.4,IENS,9.04,"I"))
"RTN","RORRP025",22,0)
 ;--- Country of birth
"RTN","RORRP025",23,0)
 S TMP=+$G(RORBUF(799.4,IENS,9.07,"I"))
"RTN","RORRP025",24,0)
 S:TMP=7 $P(BUF,U,8)=$G(RORBUF(799.4,IENS,9.08,"I"))
"RTN","RORRP025",25,0)
 S:TMP=8 $P(BUF,U,8)=$G(RORBUF(799.4,IENS,9.09,"I"))
"RTN","RORRP025",26,0)
 ;--- Store the data into the result buffer
"RTN","RORRP025",27,0)
 S RORPTR=RORPTR+1,RORDST(RORPTR)=BUF
"RTN","RORRP025",28,0)
 Q 0
"RTN","RORRP025",29,0)
 ;
"RTN","RORRP025",30,0)
 ;***** COMMENTS (X)
"RTN","RORRP025",31,0)
CMT(IENS) ;
"RTN","RORRP025",32,0)
 N BUF,I,RC,RORBUF,RORMSG,TMP
"RTN","RORRP025",33,0)
 S TMP=$$GET1^DIQ(799.4,IENS,25,,"RORBUF","RORMSG")
"RTN","RORRP025",34,0)
 I $G(DIERR)  D  Q RC
"RTN","RORRP025",35,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,799.4,IENS)
"RTN","RORRP025",36,0)
 ;--- Store the data into the result buffer
"RTN","RORRP025",37,0)
 S I=0
"RTN","RORRP025",38,0)
 F  S I=$O(RORBUF(I))  Q:I'>0  D
"RTN","RORRP025",39,0)
 . S RORPTR=RORPTR+1,RORDST(RORPTR)="CMT"_U_I_U_RORBUF(I)
"RTN","RORRP025",40,0)
 Q 0
"RTN","RORRP025",41,0)
 ;
"RTN","RORRP025",42,0)
 ;***** CLINICAL STATUS (VIII)
"RTN","RORRP025",43,0)
CS(IENS) ;
"RTN","RORRP025",44,0)
 N BUF,I,IENS1,RC,RORBUF,RORMSG,TMP
"RTN","RORRP025",45,0)
 S BUF="CS"
"RTN","RORRP025",46,0)
 S RC=$$LOAD^RORRP026(IENS,"CS^RORRP026",.BUF)  Q:RC<0 RC
"RTN","RORRP025",47,0)
 ;--- Store the data into the result buffer
"RTN","RORRP025",48,0)
 S RORPTR=RORPTR+1,RORDST(RORPTR)=BUF
"RTN","RORRP025",49,0)
 ;--- Load the AIDS Indicator diseases
"RTN","RORRP025",50,0)
 S IENS1=","_IENS,TMP="@;.01I;.02I;.03I"
"RTN","RORRP025",51,0)
 D LIST^DIC(799.41,IENS1,TMP,,,,,"B",,,"RORBUF","RORMSG")
"RTN","RORRP025",52,0)
 I $G(DIERR)  D  Q RC
"RTN","RORRP025",53,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,799.41,IENS1)
"RTN","RORRP025",54,0)
 ;--- Process the list
"RTN","RORRP025",55,0)
 S I=0
"RTN","RORRP025",56,0)
 F  S I=$O(RORBUF("DILIST","ID",I))  Q:I'>0  D
"RTN","RORRP025",57,0)
 . S BUF="AID"_U_$G(RORBUF("DILIST","ID",I,.01))
"RTN","RORRP025",58,0)
 . S TMP=$G(RORBUF("DILIST","ID",I,.02))  Q:TMP'>0
"RTN","RORRP025",59,0)
 . S $P(BUF,U,3)=TMP
"RTN","RORRP025",60,0)
 . S $P(BUF,U,4)=$$DATE^RORRP026($G(RORBUF("DILIST","ID",I,.03)))
"RTN","RORRP025",61,0)
 . ;--- Store the data into the result buffer
"RTN","RORRP025",62,0)
 . S RORPTR=RORPTR+1,RORDST(RORPTR)=BUF
"RTN","RORRP025",63,0)
 Q 0
"RTN","RORRP025",64,0)
 ;
"RTN","RORRP025",65,0)
 ;***** PROCESSES THE ERROR(S) AND UNLOCKS THE RECORDS
"RTN","RORRP025",66,0)
ERROR(RESULTS,RC) ;
"RTN","RORRP025",67,0)
 D RPCSTK^RORERR(.RESULTS,RC)
"RTN","RORRP025",68,0)
 D UNLOCK^RORLOCK(.RORLOCK)
"RTN","RORRP025",69,0)
 Q
"RTN","RORRP025",70,0)
 ;
"RTN","RORRP025",71,0)
 ;***** FACILITY OF DIAGNOSIS (IV)
"RTN","RORRP025",72,0)
FD(IENS) ;
"RTN","RORRP025",73,0)
 N BUF,RC,RORBUF,TMP
"RTN","RORRP025",74,0)
 S BUF="FD"
"RTN","RORRP025",75,0)
 S RC=$$LOAD^RORRP026(IENS,"FD^RORRP026",.BUF)  Q:RC<0 RC
"RTN","RORRP025",76,0)
 ;--- Store the data into the result buffer
"RTN","RORRP025",77,0)
 S RORPTR=RORPTR+1,RORDST(RORPTR)=BUF
"RTN","RORRP025",78,0)
 Q 0
"RTN","RORRP025",79,0)
 ;
"RTN","RORRP025",80,0)
 ;***** FORM HEADERS
"RTN","RORRP025",81,0)
HDR(IENS) ;
"RTN","RORRP025",82,0)
 N BUF,IENS200,RC,RORBUF,RORMSG,TMP
"RTN","RORRP025",83,0)
 S BUF="HDR"
"RTN","RORRP025",84,0)
 S RC=$$LOAD^RORRP026(IENS,"HDR^RORRP026",.BUF)  Q:RC<0 RC
"RTN","RORRP025",85,0)
 ;--- Date when the CDC form was completed
"RTN","RORRP025",86,0)
 S:$P(BUF,U,3)="" $P(BUF,U,3)=$$DT^XLFDT
"RTN","RORRP025",87,0)
 ;--- Person who is completing the form
"RTN","RORRP025",88,0)
 S IENS200=DUZ_","
"RTN","RORRP025",89,0)
 D GETS^DIQ(200,IENS200,".01;.132",,"RORBUF","RORMSG")
"RTN","RORRP025",90,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,200,IENS200)
"RTN","RORRP025",91,0)
 S $P(BUF,U,4)=DUZ
"RTN","RORRP025",92,0)
 S $P(BUF,U,5)=$G(RORBUF(200,IENS200,.01))
"RTN","RORRP025",93,0)
 S $P(BUF,U,6)=$G(RORBUF(200,IENS200,.132))
"RTN","RORRP025",94,0)
 ;--- Medical record number (it is the SSN now)
"RTN","RORRP025",95,0)
 S $P(BUF,U,7)=$P($G(RORDST(1)),U,6)
"RTN","RORRP025",96,0)
 ;--- Store the data into the result buffer
"RTN","RORRP025",97,0)
 S RORPTR=RORPTR+1,RORDST(RORPTR)=BUF
"RTN","RORRP025",98,0)
 Q 0
"RTN","RORRP025",99,0)
 ;
"RTN","RORRP025",100,0)
 ;***** LABORATORY DATA (VI)
"RTN","RORRP025",101,0)
LD(IENS) ;
"RTN","RORRP025",102,0)
 N BUF,FLD,RC,RORBUF,TMP
"RTN","RORRP025",103,0)
 S BUF="LD1"
"RTN","RORRP025",104,0)
 S RC=$$LOAD^RORRP026(IENS,"LD1^RORRP026",.BUF,.RORBUF)  Q:RC<0 RC
"RTN","RORRP025",105,0)
 ;--- Positive HIV detection test
"RTN","RORRP025",106,0)
 S FLD=$$PHIVFLD^RORRP026($P(BUF,U,12))
"RTN","RORRP025",107,0)
 S:FLD $P(BUF,U,13)=$$DATE^RORRP026($G(RORBUF(799.4,IENS,FLD,"I")))
"RTN","RORRP025",108,0)
 ;--- Store the data into the result buffer
"RTN","RORRP025",109,0)
 S RORPTR=RORPTR+1,RORDST(RORPTR)=BUF
"RTN","RORRP025",110,0)
 ;--- The second segment
"RTN","RORRP025",111,0)
 S BUF="LD2"
"RTN","RORRP025",112,0)
 S RC=$$LOAD^RORRP026(IENS,"LD2^RORRP026",.BUF)  Q:RC<0 RC
"RTN","RORRP025",113,0)
 ;--- Store the data into the result buffer
"RTN","RORRP025",114,0)
 S RORPTR=RORPTR+1,RORDST(RORPTR)=BUF
"RTN","RORRP025",115,0)
 Q 0
"RTN","RORRP025",116,0)
 ;
"RTN","RORRP025",117,0)
 ;***** LOADS THE ICR CDC DATA
"RTN","RORRP025",118,0)
 ; RPC: [RORICR CDC LOAD]
"RTN","RORRP025",119,0)
 ;
"RTN","RORRP025",120,0)
 ; .RORDST       Reference to a local variable where the results
"RTN","RORRP025",121,0)
 ;               are returned to.
"RTN","RORRP025",122,0)
 ;
"RTN","RORRP025",123,0)
 ; REGIEN        Registry IEN
"RTN","RORRP025",124,0)
 ;
"RTN","RORRP025",125,0)
 ; PATIEN        IEN of the registry patient (DFN)
"RTN","RORRP025",126,0)
 ;
"RTN","RORRP025",127,0)
 ; [LOCK]        Lock the ICR record before loading the data and
"RTN","RORRP025",128,0)
 ;               leave it locked.
"RTN","RORRP025",129,0)
 ;
"RTN","RORRP025",130,0)
 ; Return Values:
"RTN","RORRP025",131,0)
 ;
"RTN","RORRP025",132,0)
 ; A negative value of the first "^"-piece of the RORDST(0)
"RTN","RORRP025",133,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP025",134,0)
 ; details).
"RTN","RORRP025",135,0)
 ;
"RTN","RORRP025",136,0)
 ; If locking was requested (see the LOCK parameter) and the record
"RTN","RORRP025",137,0)
 ; could not be locked then the first "^"-piece of the RORDST(0)
"RTN","RORRP025",138,0)
 ; would be greater than 0. The RORDST(0) would contain the lock
"RTN","RORRP025",139,0)
 ; descriptor and subsequent nodes of the global array would contain
"RTN","RORRP025",140,0)
 ; the data (see below). The lock descriptor contains information
"RTN","RORRP025",141,0)
 ; about the propcess, which owns the most recent lock of the record.
"RTN","RORRP025",142,0)
 ;
"RTN","RORRP025",143,0)
 ; RORDST(0)             Lock Descriptor
"RTN","RORRP025",144,0)
 ;                         ^01: Date/Time (FileMan)
"RTN","RORRP025",145,0)
 ;                         ^02: User/Process name
"RTN","RORRP025",146,0)
 ;                         ^03: User IEN (DUZ)
"RTN","RORRP025",147,0)
 ;                         ^04: $JOB
"RTN","RORRP025",148,0)
 ;                         ^05: Task number
"RTN","RORRP025",149,0)
 ;
"RTN","RORRP025",150,0)
 ; THE DATA ARE LOADED ONLY FOR VIEWING PURPOSES (READ-ONLY)!
"RTN","RORRP025",151,0)
 ;
"RTN","RORRP025",152,0)
 ; Otherwise, zero is returned in the RORDST(0) and the subsequent
"RTN","RORRP025",153,0)
 ; nodes of the array contain the data.
"RTN","RORRP025",154,0)
 ; 
"RTN","RORRP025",155,0)
 ; RORDST(0)             0
"RTN","RORRP025",156,0)
 ;
"RTN","RORRP025",157,0)
 ; RORDST(i)             Data Item
"RTN","RORRP025",158,0)
 ;                         ^01: Type
"RTN","RORRP025",159,0)
 ;                         ^02: Sequential Number or Item Code
"RTN","RORRP025",160,0)
 ;                         ^03: Value
"RTN","RORRP025",161,0)
 ;                         ^04: ...
"RTN","RORRP025",162,0)
 ;
"RTN","RORRP025",163,0)
 ;                       Item Types:
"RTN","RORRP025",164,0)
 ;                         DEM  Demographic Information
"RTN","RORRP025",165,0)
 ;                         ADR  Patient's Address
"RTN","RORRP025",166,0)
 ;                         RCE  Race Information
"RTN","RORRP025",167,0)
 ;                         ETN  Ethnicity Information
"RTN","RORRP025",168,0)
 ;                         HDR  Headers
"RTN","RORRP025",169,0)
 ;                         CDM  CDC Demographics
"RTN","RORRP025",170,0)
 ;                         FD   Facility of Diagnosis
"RTN","RORRP025",171,0)
 ;                         PH   Patient History
"RTN","RORRP025",172,0)
 ;                         LD1  Laboratory Data
"RTN","RORRP025",173,0)
 ;                         LD2  Laboratory Data
"RTN","RORRP025",174,0)
 ;                         CS   Clinical Status
"RTN","RORRP025",175,0)
 ;                         AID  AIDS Indicator Disease
"RTN","RORRP025",176,0)
 ;                         TS1  Treatment/Services
"RTN","RORRP025",177,0)
 ;                         TS2  Treatment/Services
"RTN","RORRP025",178,0)
 ;                         CMT  Comments
"RTN","RORRP025",179,0)
 ;
"RTN","RORRP025",180,0)
 ; See the CDC FIELD TABLE section (CDCFLDS^RORRP026) and the
"RTN","RORRP025",181,0)
 ; description of the RORICR CDC LOAD remote procedure for details.
"RTN","RORRP025",182,0)
 ;
"RTN","RORRP025",183,0)
LOADCDC(RORDST,REGIEN,PATIEN,LOCK) ;
"RTN","RORRP025",184,0)
 N BUF,IEN,RC,RDONLY,RORERRDL,RORLOCK,RORPTR
"RTN","RORRP025",185,0)
 D CLEAR^RORERR("LOADCDC^RORRP025",1)
"RTN","RORRP025",186,0)
 K RORDST  S (RDONLY,RORDST(0))=0
"RTN","RORRP025",187,0)
 ;--- Check the parameters
"RTN","RORRP025",188,0)
 S RC=0  D  I RC<0  D ERROR(.RORDST,RC)  Q
"RTN","RORRP025",189,0)
 . ;--- Registry IEN
"RTN","RORRP025",190,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP025",191,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP025",192,0)
 . S REGIEN=+REGIEN
"RTN","RORRP025",193,0)
 . ;--- Patient IEN
"RTN","RORRP025",194,0)
 . I $G(PATIEN)'>0  D  Q
"RTN","RORRP025",195,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"PATIEN",$G(PATIEN))
"RTN","RORRP025",196,0)
 . S PATIEN=+PATIEN
"RTN","RORRP025",197,0)
 ;
"RTN","RORRP025",198,0)
 ;--- Load the patient's demographic data
"RTN","RORRP025",199,0)
 D GETPTDAT^RORRP021(.RORDST,PATIEN,"AER")
"RTN","RORRP025",200,0)
 Q:$G(RORDST(0))<0
"RTN","RORRP025",201,0)
 S RORPTR=+$O(RORDST(""),-1)
"RTN","RORRP025",202,0)
 ;
"RTN","RORRP025",203,0)
 ;--- Get the IEN of the registry record
"RTN","RORRP025",204,0)
 S IEN=$$PRRIEN^RORUTL01(PATIEN,REGIEN)  Q:IEN'>0
"RTN","RORRP025",205,0)
 S IENS=IEN_","
"RTN","RORRP025",206,0)
 ;
"RTN","RORRP025",207,0)
 ;--- Lock the record
"RTN","RORRP025",208,0)
 I $G(LOCK)  D  I RDONLY<0  D ERROR(.RORDST,+RDONLY)  Q
"RTN","RORRP025",209,0)
 . S RORLOCK(799.4,IENS)=""
"RTN","RORRP025",210,0)
 . S RDONLY=$$LOCK^RORLOCK(799.4,IENS)
"RTN","RORRP025",211,0)
 ;
"RTN","RORRP025",212,0)
 ;--- Create the data segments
"RTN","RORRP025",213,0)
 S RC=0  D  I RC<0  D ERROR(.RORDST,RC)  Q
"RTN","RORRP025",214,0)
 . S RC=$$HDR(IENS)  Q:RC<0
"RTN","RORRP025",215,0)
 . S RC=$$CDM(IENS)  Q:RC<0
"RTN","RORRP025",216,0)
 . S RC=$$FD(IENS)   Q:RC<0
"RTN","RORRP025",217,0)
 . S RC=$$PH(IENS)   Q:RC<0
"RTN","RORRP025",218,0)
 . S RC=$$LD(IENS)   Q:RC<0
"RTN","RORRP025",219,0)
 . S RC=$$CS(IENS)   Q:RC<0
"RTN","RORRP025",220,0)
 . S RC=$$TS(IENS)   Q:RC<0
"RTN","RORRP025",221,0)
 . S RC=$$CMT(IENS)  Q:RC<0
"RTN","RORRP025",222,0)
 ;---
"RTN","RORRP025",223,0)
 S RORDST(0)=RDONLY
"RTN","RORRP025",224,0)
 Q
"RTN","RORRP025",225,0)
 ;
"RTN","RORRP025",226,0)
 ;***** PATIENT HISTORY (V)
"RTN","RORRP025",227,0)
PH(IENS) ;
"RTN","RORRP025",228,0)
 N BUF,RC,RORBUF,TMP
"RTN","RORRP025",229,0)
 S BUF="PH"
"RTN","RORRP025",230,0)
 S RC=$$LOAD^RORRP026(IENS,"PH^RORRP026",.BUF)  Q:RC<0 RC
"RTN","RORRP025",231,0)
 ;--- Store the data into the result buffer
"RTN","RORRP025",232,0)
 S RORPTR=RORPTR+1,RORDST(RORPTR)=BUF
"RTN","RORRP025",233,0)
 Q 0
"RTN","RORRP025",234,0)
 ;
"RTN","RORRP025",235,0)
 ;***** TREATMENT/SERVICES REFERRALS (IX)
"RTN","RORRP025",236,0)
TS(IENS) ;
"RTN","RORRP025",237,0)
 N BUF,RC,RORBUF,TMP
"RTN","RORRP025",238,0)
 S BUF="TS1"
"RTN","RORRP025",239,0)
 S RC=$$LOAD^RORRP026(IENS,"TS1^RORRP026",.BUF)  Q:RC<0 RC
"RTN","RORRP025",240,0)
 ;--- Store the data into the result buffer
"RTN","RORRP025",241,0)
 S RORPTR=RORPTR+1,RORDST(RORPTR)=BUF
"RTN","RORRP025",242,0)
 ;--- The second segment
"RTN","RORRP025",243,0)
 S BUF="TS2"
"RTN","RORRP025",244,0)
 S RC=$$LOAD^RORRP026(IENS,"TS2^RORRP026",.BUF)  Q:RC<0 RC
"RTN","RORRP025",245,0)
 ;--- Store the data into the result buffer
"RTN","RORRP025",246,0)
 S RORPTR=RORPTR+1,RORDST(RORPTR)=BUF
"RTN","RORRP025",247,0)
 Q 0
"RTN","RORRP026")
0^102^B69411455
"RTN","RORRP026",1,0)
RORRP026 ;HCIOFO/SG - RPC: CDC UTILITIES ; 10/14/05 8:07am
"RTN","RORRP026",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP026",3,0)
 ;
"RTN","RORRP026",4,0)
 ;--------------------------------------------------------------------
"RTN","RORRP026",5,0)
 ; Registry: [VA HIV]
"RTN","RORRP026",6,0)
 ;--------------------------------------------------------------------
"RTN","RORRP026",7,0)
 Q
"RTN","RORRP026",8,0)
 ;
"RTN","RORRP026",9,0)
 ;***** POPULATES THE FDA WITH THE CDC DATA
"RTN","RORRP026",10,0)
 ;
"RTN","RORRP026",11,0)
 ; IENS          IENS of the record in the ROR HIV STUDY file
"RTN","RORRP026",12,0)
 ;
"RTN","RORRP026",13,0)
 ; TBLREF        Reference to a field table in the source code
"RTN","RORRP026",14,0)
 ;
"RTN","RORRP026",15,0)
 ; SRCBUF        Source data segment
"RTN","RORRP026",16,0)
 ;
"RTN","RORRP026",17,0)
 ; .FDA          Reference to a local variable where the FDA
"RTN","RORRP026",18,0)
 ;               nodes are created
"RTN","RORRP026",19,0)
 ;
"RTN","RORRP026",20,0)
 ; [.CACHE]      Reference to a local variable where the field
"RTN","RORRP026",21,0)
 ;               lists are cached.
"RTN","RORRP026",22,0)
 ;
"RTN","RORRP026",23,0)
 ; Return Values:
"RTN","RORRP026",24,0)
 ;       <0  Error code
"RTN","RORRP026",25,0)
 ;        0  Ok
"RTN","RORRP026",26,0)
 ;
"RTN","RORRP026",27,0)
CDCFDA(IENS,TBLREF,SRCBUF,RORFDA,CACHE) ;
"RTN","RORRP026",28,0)
 N BUF,FLD,I,POS,RC,RESULT,RORMSG,TGET,TMP,VAL
"RTN","RORRP026",29,0)
 S RC=0
"RTN","RORRP026",30,0)
 ;--- Prepare the fields (if they are not in the cache already)
"RTN","RORRP026",31,0)
 I $D(CACHE("CDCFLDS",TBLREF))<10  D  Q:RC<0 RC
"RTN","RORRP026",32,0)
 . S TGET="S BUF=$T("_$P(TBLREF,"^")_"+I^"_$P(TBLREF,"^",2)_")"
"RTN","RORRP026",33,0)
 . F I=1:1  X TGET  S BUF=$P(BUF,";;",2,999)  Q:BUF=""  D
"RTN","RORRP026",34,0)
 . . S FLD=$TR($P(BUF,U,2)," ")  Q:FLD'>0
"RTN","RORRP026",35,0)
 . . S TMP=+$TR($P(BUF,U)," ")
"RTN","RORRP026",36,0)
 . . I TMP'>0  S CACHE("CDCFLDS",TBLREF,+FLD)=""  Q
"RTN","RORRP026",37,0)
 . . S:FLD["D" TMP=TMP_"D" ; MM/YY field
"RTN","RORRP026",38,0)
 . . S:FLD["R" TMP=TMP_"R" ; Read-only field
"RTN","RORRP026",39,0)
 . . S CACHE("CDCFLDS",TBLREF,+FLD,$S(FLD["E":"E",1:"I"))=TMP
"RTN","RORRP026",40,0)
 ;--- Store the data into the FDA
"RTN","RORRP026",41,0)
 S FLD="",RC=0
"RTN","RORRP026",42,0)
 F  S FLD=$O(CACHE("CDCFLDS",TBLREF,FLD))  Q:FLD=""  D  Q:RC
"RTN","RORRP026",43,0)
 . S POS=$G(CACHE("CDCFLDS",TBLREF,FLD,"I"))
"RTN","RORRP026",44,0)
 . I POS'>0  S POS=$G(CACHE("CDCFLDS",TBLREF,FLD,"E"))  Q:POS'>0
"RTN","RORRP026",45,0)
 . Q:POS["R"  ; Skip read-only fields
"RTN","RORRP026",46,0)
 . S VAL=$P(SRCBUF,U,+POS)
"RTN","RORRP026",47,0)
 . I VAL=""  S RORFDA(799.4,IENS,FLD)=""  Q
"RTN","RORRP026",48,0)
 . ;--- Process the 'YY/MM' date field
"RTN","RORRP026",49,0)
 . I POS["D"  D  Q
"RTN","RORRP026",50,0)
 . . S TMP=$$DATE1(VAL)
"RTN","RORRP026",51,0)
 . . I TMP<0  S RC=(+POS)_U_$P(SRCBUF,U)  Q
"RTN","RORRP026",52,0)
 . . S RORFDA(799.4,IENS,FLD)=TMP
"RTN","RORRP026",53,0)
 . ;--- Precede the internal pointer value with the "`"
"RTN","RORRP026",54,0)
 . I +VAL=VAL  S:$$GET1^DID(799.4,FLD,,"TYPE")="POINTER" VAL="`"_VAL
"RTN","RORRP026",55,0)
 . ;--- Validate the value and store it into the FDA
"RTN","RORRP026",56,0)
 . D VAL^DIE(799.4,IENS,FLD,"FU",VAL,.RESULT,"RORFDA","RORMSG")
"RTN","RORRP026",57,0)
 . S:RESULT="^" RC=(+POS)_U_$P(SRCBUF,U)
"RTN","RORRP026",58,0)
 Q RC
"RTN","RORRP026",59,0)
 ;
"RTN","RORRP026",60,0)
 ;***** FORMATS THE FILEMAN DATE AS 'MM/YY' OR 'YYYY'
"RTN","RORRP026",61,0)
DATE(DATE) ;
"RTN","RORRP026",62,0)
 Q:DATE'>0 ""
"RTN","RORRP026",63,0)
 N MMYY,MONTH
"RTN","RORRP026",64,0)
 S MMYY=$TR($$FMTE^XLFDT(DATE,"6DF")," ","0")
"RTN","RORRP026",65,0)
 S MONTH=$P(MMYY,"/",2)
"RTN","RORRP026",66,0)
 Q $S(MONTH'="00":MONTH_"/"_$E($P(MMYY,"/",3),3,4),1:$P(MMYY,"/",3))
"RTN","RORRP026",67,0)
 ;
"RTN","RORRP026",68,0)
 ;***** CONVERTS THE 'MM/YY' OR 'YYYY' INTO THE FILEMAN DATE
"RTN","RORRP026",69,0)
DATE1(MMYY) ;
"RTN","RORRP026",70,0)
 Q:$G(MMYY)="" ""
"RTN","RORRP026",71,0)
 N DATE
"RTN","RORRP026",72,0)
 ;--- Just a year (YY or YYYY)
"RTN","RORRP026",73,0)
 I MMYY?.1(2N)2N  D  Q $G(DATE,-1)
"RTN","RORRP026",74,0)
 . D DT^DILF("EP",MMYY,.DATE)
"RTN","RORRP026",75,0)
 ;--- Month and year
"RTN","RORRP026",76,0)
 D DT^DILF("EP",$P(MMYY,"/",2),.DATE)
"RTN","RORRP026",77,0)
 I $G(DATE)>0  D  D DT^DILF("P",MMYY,.DATE)
"RTN","RORRP026",78,0)
 . S $P(MMYY,"/",2)=$G(DATE(0))
"RTN","RORRP026",79,0)
 Q $G(DATE,-1)
"RTN","RORRP026",80,0)
 ;
"RTN","RORRP026",81,0)
 ;***** LOADS THE DATA FROM THE 'ROR HIV STUDY' FILE
"RTN","RORRP026",82,0)
 ;
"RTN","RORRP026",83,0)
 ; IENS          IENS of the record in the ROR HIV STUDY file
"RTN","RORRP026",84,0)
 ;
"RTN","RORRP026",85,0)
 ; TBLREF        Reference to a field table in the source code
"RTN","RORRP026",86,0)
 ;
"RTN","RORRP026",87,0)
 ; DSTBUF        Reference to a local variable where the data
"RTN","RORRP026",88,0)
 ;               is returned to
"RTN","RORRP026",89,0)
 ;
"RTN","RORRP026",90,0)
 ; [.RORBUF]     Reference to a local variable where the source
"RTN","RORRP026",91,0)
 ;               field values are returned to (by GETS^DIQ)
"RTN","RORRP026",92,0)
 ;
"RTN","RORRP026",93,0)
 ; [.CACHE]      Reference to a local variable where the field
"RTN","RORRP026",94,0)
 ;               lists are cached.
"RTN","RORRP026",95,0)
 ;
"RTN","RORRP026",96,0)
 ; Return Values:
"RTN","RORRP026",97,0)
 ;       <0  Error code
"RTN","RORRP026",98,0)
 ;        0  Ok
"RTN","RORRP026",99,0)
 ;
"RTN","RORRP026",100,0)
LOAD(IENS,TBLREF,DSTBUF,RORBUF,CACHE) ;
"RTN","RORRP026",101,0)
 N BUF,FLD,I,RC,RORMSG,TGET,TMP
"RTN","RORRP026",102,0)
 S RC=0
"RTN","RORRP026",103,0)
 ;--- Prepare the fields (if they are not in the cache already)
"RTN","RORRP026",104,0)
 I $D(CACHE("CDCFLDS",TBLREF))<10  D  Q:RC<0 RC
"RTN","RORRP026",105,0)
 . S TGET="S BUF=$T("_$P(TBLREF,"^")_"+I^"_$P(TBLREF,"^",2)_")"
"RTN","RORRP026",106,0)
 . F I=1:1  X TGET  S BUF=$P(BUF,";;",2,999)  Q:BUF=""  D
"RTN","RORRP026",107,0)
 . . S FLD=$TR($P(BUF,U,2)," ")  Q:FLD'>0
"RTN","RORRP026",108,0)
 . . S TMP=+$TR($P(BUF,U)," ")
"RTN","RORRP026",109,0)
 . . I TMP'>0  S CACHE("CDCFLDS",TBLREF,+FLD)=""  Q
"RTN","RORRP026",110,0)
 . . S:FLD["D" TMP=TMP_"D"
"RTN","RORRP026",111,0)
 . . S CACHE("CDCFLDS",TBLREF,+FLD,$S(FLD["E":"E",1:"I"))=TMP
"RTN","RORRP026",112,0)
 . ;--- Create the list of fields for the GETS^DIQ
"RTN","RORRP026",113,0)
 . S (CACHE("CDCFLDS",TBLREF),FLD)=""
"RTN","RORRP026",114,0)
 . F  S FLD=$O(CACHE("CDCFLDS",TBLREF,FLD))  Q:FLD=""  D
"RTN","RORRP026",115,0)
 . . S CACHE("CDCFLDS",TBLREF)=CACHE("CDCFLDS",TBLREF)_FLD_";"
"RTN","RORRP026",116,0)
 ;--- Load the data from the file
"RTN","RORRP026",117,0)
 D GETS^DIQ(799.4,IENS,CACHE("CDCFLDS",TBLREF),"EI","RORBUF","RORMSG")
"RTN","RORRP026",118,0)
 I $G(DIERR)  D  Q RC
"RTN","RORRP026",119,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,799.4,IENS)
"RTN","RORRP026",120,0)
 ;--- Store the data into the output buffer
"RTN","RORRP026",121,0)
 S FLD=""
"RTN","RORRP026",122,0)
 F  S FLD=$O(CACHE("CDCFLDS",TBLREF,FLD))  Q:FLD=""  D
"RTN","RORRP026",123,0)
 . S I=""
"RTN","RORRP026",124,0)
 . F  S I=$O(CACHE("CDCFLDS",TBLREF,FLD,I))  Q:I=""  D
"RTN","RORRP026",125,0)
 . . S TMP=CACHE("CDCFLDS",TBLREF,FLD,I)
"RTN","RORRP026",126,0)
 . . I '(TMP["D")  S $P(DSTBUF,U,+TMP)=$G(RORBUF(799.4,IENS,FLD,I))  Q
"RTN","RORRP026",127,0)
 . . S $P(DSTBUF,U,+TMP)=$$DATE($G(RORBUF(799.4,IENS,FLD,"I")))
"RTN","RORRP026",128,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORRP026",129,0)
 ;
"RTN","RORRP026",130,0)
 ;***** RETURNS DATE FIELD NUMBER FOR THE POSITIVE HIV DETECTION TEST
"RTN","RORRP026",131,0)
PHIVFLD(TYPE) ;
"RTN","RORRP026",132,0)
 Q $S(TYPE=1:18.01,TYPE=2:18.02,TYPE=3:18.03,1:0)
"RTN","RORRP026",133,0)
 Q
"RTN","RORRP026",134,0)
 ;
"RTN","RORRP026",135,0)
CDCFLDS ;***** CDC FIELD TABLE
"RTN","RORRP026",136,0)
HDR ;
"RTN","RORRP026",137,0)
 ;;  3 ^  9.01I  ^ DATE CDC FORM COMPLETED
"RTN","RORRP026",138,0)
 ;;  4 ^         ^ CDC FORM COMPLETED BY (DUZ)
"RTN","RORRP026",139,0)
 ;;  5 ^         ^ CDC FORM COMPLETED BY (Name)
"RTN","RORRP026",140,0)
 ;;  6 ^         ^ Phone number of the person completed the form
"RTN","RORRP026",141,0)
CDM ;
"RTN","RORRP026",142,0)
 ;;  3 ^  9.02I  ^ STATUS AT REPORT
"RTN","RORRP026",143,0)
 ;;    ^  9.03I  ^ AGE AT HIV DIAGNOSIS
"RTN","RORRP026",144,0)
 ;;    ^  9.04I  ^ AGE AT AIDS DIAGNOSIS
"RTN","RORRP026",145,0)
 ;;  5 ^  9.9ER  ^ PATIENT STATUS
"RTN","RORRP026",146,0)
 ;;  6 ^  9.06I  ^ STATE/TERRITORY OF DEATH
"RTN","RORRP026",147,0)
 ;;  7 ^  9.07I  ^ COUNTRY OF BIRTH
"RTN","RORRP026",148,0)
 ;;    ^  9.08I  ^ DEPENDENCY OR POSSESSION NAME
"RTN","RORRP026",149,0)
 ;;    ^  9.09I  ^ OTHER COUNTRY DESCRIPTION
"RTN","RORRP026",150,0)
 ;;  9 ^  9.1I   ^ ONSET OF ILLNESS/AIDS- CITY
"RTN","RORRP026",151,0)
 ;; 10 ^  9.11I  ^ ONSET OF ILLNESS/AIDS- COUNTY
"RTN","RORRP026",152,0)
 ;; 11 ^  9.12I  ^ ONSET OF ILLNESS/AIDS- STATE (IEN)
"RTN","RORRP026",153,0)
 ;; 12 ^  9.12E  ^ ONSET OF ILLNESS/AIDS- STATE (Name)
"RTN","RORRP026",154,0)
 ;; 13 ^  9.13I  ^ ONSET OF ILLNESS/AIDS- COUNTRY
"RTN","RORRP026",155,0)
 ;; 14 ^  9.14I  ^ ONSET OF ILLNESS/AIDS- ZIP
"RTN","RORRP026",156,0)
FD ;
"RTN","RORRP026",157,0)
 ;;  3 ^ 12.01I  ^ AIDS DX - HOSPITAL
"RTN","RORRP026",158,0)
 ;;  4 ^ 12.02I  ^ AIDS DX - CITY
"RTN","RORRP026",159,0)
 ;;  5 ^ 12.03I  ^ AIDS DX - STATE (IEN)
"RTN","RORRP026",160,0)
 ;;  6 ^ 12.03E  ^ AIDS DX - STATE (Name)
"RTN","RORRP026",161,0)
 ;;  7 ^ 12.04I  ^ AIDS DX - COUNTRY
"RTN","RORRP026",162,0)
 ;;  8 ^ 12.05I  ^ AIDS DX - FACILITY SETTING
"RTN","RORRP026",163,0)
 ;;  9 ^ 12.06I  ^ AIDS DX - FACILITY TYPE
"RTN","RORRP026",164,0)
 ;; 10 ^ 12.07I  ^ AIDS DX - OTHER FACILITY TYPE
"RTN","RORRP026",165,0)
 ;
"RTN","RORRP026",166,0)
PH ;
"RTN","RORRP026",167,0)
 ;;  3 ^ 14.01I  ^ SEX RELATIONS W/MALE PARTNER
"RTN","RORRP026",168,0)
 ;;  4 ^ 14.02I  ^ SEX RELATIONS W/FEMALE PARTNER
"RTN","RORRP026",169,0)
 ;;  5 ^ 14.03I  ^ IV DRUGS AFTER 77 AND PRE HIV
"RTN","RORRP026",170,0)
 ;;  6 ^ 14.04I  ^ REC'D CLOTTING FACTORS
"RTN","RORRP026",171,0)
 ;;  7 ^ 14.05I  ^ TYPE OF HEMOPHILIA
"RTN","RORRP026",172,0)
 ;;  8 ^ 14.06I  ^ OTHER HEMOPHILIA DESCRIPTION
"RTN","RORRP026",173,0)
 ;;  9 ^ 14.07I  ^ SR WITH IV DRUG USER
"RTN","RORRP026",174,0)
 ;; 10 ^ 14.08I  ^ SR WITH BISEXUAL MAN
"RTN","RORRP026",175,0)
 ;; 11 ^ 14.09I  ^ SR W HEMOPHILIA/COAG DISORDER
"RTN","RORRP026",176,0)
 ;; 12 ^ 14.1I   ^ SR W TRANS RECIPIENT WITH AIDS
"RTN","RORRP026",177,0)
 ;; 13 ^ 14.11I  ^ TRANSPLANT RECIP-DOCUMNTD HIV
"RTN","RORRP026",178,0)
 ;; 14 ^ 14.12I  ^ SR W AIDS/HIV INFECTION
"RTN","RORRP026",179,0)
 ;; 15 ^ 14.13I  ^ TRANS AFTER 77 AND BEFORE HIV
"RTN","RORRP026",180,0)
 ;; 16 ^ 14.14ID ^ DATE OF FIRST TRANSFUSION
"RTN","RORRP026",181,0)
 ;; 17 ^ 14.15ID ^ DATE OF LAST TRANSFUSION
"RTN","RORRP026",182,0)
 ;; 18 ^ 14.16I  ^ TRANSPLANT OR ARTIF INSEMIN
"RTN","RORRP026",183,0)
 ;; 19 ^ 14.17I  ^ WORK IN HEALTH CARE OR LAB
"RTN","RORRP026",184,0)
 ;; 20 ^ 14.18I  ^ OCCUPATION
"RTN","RORRP026",185,0)
LD1 ;
"RTN","RORRP026",186,0)
 ;;  3 ^ 16.01I  ^ HIV-1 EIA
"RTN","RORRP026",187,0)
 ;;  4 ^ 16.02ID ^ HIV-1 EIA DATE
"RTN","RORRP026",188,0)
 ;;  5 ^ 16.03I  ^ HIV-1/HIV-2 EIA
"RTN","RORRP026",189,0)
 ;;  6 ^ 16.04ID ^ HIV-1/HIV-2 EIA DATE
"RTN","RORRP026",190,0)
 ;;  7 ^ 16.05I  ^ HIV-1 WESTERN BLOT/IFA
"RTN","RORRP026",191,0)
 ;;  8 ^ 16.06ID ^ HIV-1 WESTERN BLOT/IFA DATE
"RTN","RORRP026",192,0)
 ;;  9 ^ 16.07I  ^ OTHER HIV ANTIBODY TEST
"RTN","RORRP026",193,0)
 ;; 10 ^ 16.08ID ^ OTHER HIV ANTIBODY TEST DATE
"RTN","RORRP026",194,0)
 ;; 11 ^ 16.09I  ^ OTHER HIV ANTIBODY TEST DESC
"RTN","RORRP026",195,0)
 ;; 12 ^ 18.13I  ^ POSITIVE HIV DETECTION TEST
"RTN","RORRP026",196,0)
 ;;    ^ 18.01I  ^ HIV CULTURE DETECTION TEST
"RTN","RORRP026",197,0)
 ;;    ^ 18.02I  ^ HIV ANTIGEN DETECTION TEST
"RTN","RORRP026",198,0)
 ;;    ^ 18.03I  ^ HIV PCR, DNA, OR RNA PROBE
"RTN","RORRP026",199,0)
 ;; 14 ^ 18.04I  ^ TYPE OF OTHER POSITIVE TEST
"RTN","RORRP026",200,0)
 ;; 15 ^ 18.05ID ^ DATE OTHER POS DETECTION TEST
"RTN","RORRP026",201,0)
 ;; 16 ^ 18.1I   ^ DETECTABLE VIRAL LOAD TEST
"RTN","RORRP026",202,0)
 ;; 17 ^ 18.11I  ^ DETECTABLE VIRAL LOAD RESULT
"RTN","RORRP026",203,0)
 ;; 18 ^ 18.12ID ^ DETECTABLE VIRAL LOAD DATE
"RTN","RORRP026",204,0)
LD2 ;
"RTN","RORRP026",205,0)
 ;;  3 ^ 18.07I  ^ TYPE FOR LAST NEG TEST
"RTN","RORRP026",206,0)
 ;;  4 ^ 18.06ID ^ LAST DOCUMNTD NEG HIV TEST
"RTN","RORRP026",207,0)
 ;;  5 ^ 18.08I  ^ PHYS DOCUMNTD DIAGNOSIS?
"RTN","RORRP026",208,0)
 ;;  6 ^ 18.09ID ^ DATE PHYS DOCUMNTD DIAG
"RTN","RORRP026",209,0)
 ;;  7 ^ 20.01I  ^ CD4+ COUNT FOR CDC
"RTN","RORRP026",210,0)
 ;;  8 ^ 20.02ID ^ CD4+ COUNT FOR CDC DATE
"RTN","RORRP026",211,0)
 ;;  9 ^ 20.03I  ^ CD4+ PERCENT FOR CDC
"RTN","RORRP026",212,0)
 ;; 10 ^ 20.04ID ^ CD4+ PERCENT FOR CDC DATE
"RTN","RORRP026",213,0)
 ;; 11 ^ 20.05I  ^ CD4 COUNT FIRST <200
"RTN","RORRP026",214,0)
 ;; 12 ^ 20.06ID ^ CD4 COUNT FIRST <200 DATE
"RTN","RORRP026",215,0)
 ;; 13 ^ 20.07I  ^ CD4 PERCENT FIRST <14%
"RTN","RORRP026",216,0)
 ;; 14 ^ 20.08ID ^ CD4 PERCENT FIRST <14% DATE
"RTN","RORRP026",217,0)
CS ;
"RTN","RORRP026",218,0)
 ;;  3 ^ 11.01I  ^ RECORD REVIEWED
"RTN","RORRP026",219,0)
 ;;  4 ^ 11.02ID ^ DATE ASYMPTOMATIC
"RTN","RORRP026",220,0)
 ;;  5 ^ 11.03ID ^ DATE SYMPTOMATIC
"RTN","RORRP026",221,0)
 ;;  6 ^ 11.05I  ^ RVCT CASE NO.
"RTN","RORRP026",222,0)
 ;;  7 ^ 11.04I  ^ IMMUNODEF THAT DISQUALIFIES
"RTN","RORRP026",223,0)
TS1 ;
"RTN","RORRP026",224,0)
 ;;  3 ^ 22.01I  ^ PATIENT BEEN INFORMED OF HIV
"RTN","RORRP026",225,0)
 ;;  4 ^ 22.02I  ^ PARTNERS NOTIFIED BY
"RTN","RORRP026",226,0)
 ;;  5 ^ 22.03I  ^ HIV RELATED MED SERVICES
"RTN","RORRP026",227,0)
 ;;  7 ^ 22.04I  ^ RCVD ANTI-RETROVIRAL THERAPY
"RTN","RORRP026",228,0)
 ;;  8 ^ 22.05I  ^ RECEIVED PCP PROPHYLAXIS
"RTN","RORRP026",229,0)
 ;;  9 ^ 22.06I  ^ ENROLLED AT CLINCAL TRIAL
"RTN","RORRP026",230,0)
 ;; 10 ^ 22.07I  ^ ENROLLED AT CLINIC
"RTN","RORRP026",231,0)
 ;; 11 ^ 22.08I  ^ PRIMARY REIMBURSER FOR MED RX
"RTN","RORRP026",232,0)
TS2 ;
"RTN","RORRP026",233,0)
 ;;  3 ^ 23.01I  ^ GYNECOLOGY OR OBSTETRIC CARE
"RTN","RORRP026",234,0)
 ;;  4 ^ 23.02I  ^ CURRENTLY PREGNANT
"RTN","RORRP026",235,0)
 ;;  5 ^ 23.03I  ^ DELIVERED LIVE BORN INFANT
"RTN","RORRP026",236,0)
 ;;  6 ^ 23.04I  ^ CHILD'S DATE OF BIRTH
"RTN","RORRP026",237,0)
 ;;  7 ^ 23.05I  ^ CHILD'S HOSPITAL OF BIRTH
"RTN","RORRP026",238,0)
 ;;  8 ^ 23.06I  ^ CHILD'S HOSPITAL - CITY
"RTN","RORRP026",239,0)
 ;;  9 ^ 23.07I  ^ CHILD'S HOSPITAL - STATE
"RTN","RORRP027")
0^103^B51310426
"RTN","RORRP027",1,0)
RORRP027 ;HCIOFO/SG - RPC: RORICR CDC SAVE ; 11/22/05 4:28pm
"RTN","RORRP027",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP027",3,0)
 ;
"RTN","RORRP027",4,0)
 ;--------------------------------------------------------------------
"RTN","RORRP027",5,0)
 ; Registry: [VA HIV]
"RTN","RORRP027",6,0)
 ;--------------------------------------------------------------------
"RTN","RORRP027",7,0)
 Q
"RTN","RORRP027",8,0)
 ;
"RTN","RORRP027",9,0)
 ;***** AIDS INDICATOR DISEASE (VIII)
"RTN","RORRP027",10,0)
AID(IENS) ;
"RTN","RORRP027",11,0)
 N CODE,RC,TMP
"RTN","RORRP027",12,0)
 S CODE=+$P(RORDATA(RORPTR),U,2)
"RTN","RORRP027",13,0)
 Q:CODE'>0 "2^AID"_U_CODE
"RTN","RORRP027",14,0)
 ;--- Initial diagnosis
"RTN","RORRP027",15,0)
 S RORAILST(CODE)=$P(RORDATA(RORPTR),U,3)
"RTN","RORRP027",16,0)
 ;--- Initial date
"RTN","RORRP027",17,0)
 S TMP=$$DATE1^RORRP026($P(RORDATA(RORPTR),U,4))
"RTN","RORRP027",18,0)
 Q:TMP<0 "4^AID"_U_CODE
"RTN","RORRP027",19,0)
 S $P(RORAILST(CODE),U,2)=TMP
"RTN","RORRP027",20,0)
 Q 0
"RTN","RORRP027",21,0)
 ;
"RTN","RORRP027",22,0)
 ;***** STORES THE AIDS INDICATOR DICEASES INTO THE FDA
"RTN","RORRP027",23,0)
AIDSTORE() ;
"RTN","RORRP027",24,0)
 N CODE,II,NODE,RC,TMP
"RTN","RORRP027",25,0)
 S NODE=$$ROOT^DILFD(799.41,","_IENS,1)
"RTN","RORRP027",26,0)
 S RC=0
"RTN","RORRP027",27,0)
 ;--- Mark the old records for removal
"RTN","RORRP027",28,0)
 S CODE=0
"RTN","RORRP027",29,0)
 F  S CODE=$O(@NODE@(CODE))  Q:CODE'>0  D:'$D(RORAILST(CODE))
"RTN","RORRP027",30,0)
 . S RORFDAFI(799.41,CODE_","_IENS,.01)="@"
"RTN","RORRP027",31,0)
 ;--- Prepare the records to be added/updated
"RTN","RORRP027",32,0)
 S II=+$O(RORIEN(""),-1)
"RTN","RORRP027",33,0)
 S CODE=0
"RTN","RORRP027",34,0)
 F  S CODE=$O(RORAILST(CODE))  Q:CODE'>0  D
"RTN","RORRP027",35,0)
 . ;--- Update the record
"RTN","RORRP027",36,0)
 . I $D(@NODE@(CODE))  D  Q
"RTN","RORRP027",37,0)
 . . S TMP=CODE_","_IENS
"RTN","RORRP027",38,0)
 . . S RORFDAFI(799.41,TMP,.02)=$P(RORAILST(CODE),U,1)
"RTN","RORRP027",39,0)
 . . S RORFDAFI(799.41,TMP,.03)=$P(RORAILST(CODE),U,2)
"RTN","RORRP027",40,0)
 . ;--- Add the record
"RTN","RORRP027",41,0)
 . S II=II+1,RORIEN(II)=CODE,TMP="?+"_II_","_IENS
"RTN","RORRP027",42,0)
 . S RORFDAUP(799.41,TMP,.01)=CODE
"RTN","RORRP027",43,0)
 . S RORFDAUP(799.41,TMP,.02)=$P(RORAILST(CODE),U,1)
"RTN","RORRP027",44,0)
 . S RORFDAUP(799.41,TMP,.03)=$P(RORAILST(CODE),U,2)
"RTN","RORRP027",45,0)
 Q RC
"RTN","RORRP027",46,0)
 ;
"RTN","RORRP027",47,0)
 ;***** CANCELS THE EDITING
"RTN","RORRP027",48,0)
 ; RPC: [RORICR CDC CANCEL]
"RTN","RORRP027",49,0)
 ;
"RTN","RORRP027",50,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP027",51,0)
 ;               are returned to.
"RTN","RORRP027",52,0)
 ;
"RTN","RORRP027",53,0)
 ; REGIEN        Registry IEN
"RTN","RORRP027",54,0)
 ;
"RTN","RORRP027",55,0)
 ; PATIEN        IEN of the registry patient (DFN)
"RTN","RORRP027",56,0)
 ;
"RTN","RORRP027",57,0)
 ; Return Values:
"RTN","RORRP027",58,0)
 ;
"RTN","RORRP027",59,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP027",60,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP027",61,0)
 ; details).
"RTN","RORRP027",62,0)
 ;
"RTN","RORRP027",63,0)
 ; Otherwise, zero is returned in the RESULTS(0).
"RTN","RORRP027",64,0)
 ;
"RTN","RORRP027",65,0)
CANCEL(RESULTS,REGIEN,PATIEN) ;
"RTN","RORRP027",66,0)
 N IENS,RC,RORERRDL
"RTN","RORRP027",67,0)
 D CLEAR^RORERR("CANCEL^RORRP027",1)  K RESULTS
"RTN","RORRP027",68,0)
 ;--- Check the parameters
"RTN","RORRP027",69,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP027",70,0)
 . ;--- Registry IEN
"RTN","RORRP027",71,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP027",72,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP027",73,0)
 . S REGIEN=+REGIEN
"RTN","RORRP027",74,0)
 . ;--- Patient IEN
"RTN","RORRP027",75,0)
 . I $G(PATIEN)'>0  D  Q
"RTN","RORRP027",76,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"PATIEN",$G(PATIEN))
"RTN","RORRP027",77,0)
 . S PATIEN=+PATIEN
"RTN","RORRP027",78,0)
 ;
"RTN","RORRP027",79,0)
 ;--- Get the IENS of the registry record
"RTN","RORRP027",80,0)
 S IENS=$$PRRIEN^RORUTL01(PATIEN,REGIEN)_","
"RTN","RORRP027",81,0)
 ;
"RTN","RORRP027",82,0)
 ;--- Unlock the records
"RTN","RORRP027",83,0)
 I IENS>0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP027",84,0)
 . S RC=$$UNLOCK^RORLOCK(799.4,IENS)
"RTN","RORRP027",85,0)
 S RESULTS(0)=0
"RTN","RORRP027",86,0)
 Q
"RTN","RORRP027",87,0)
 ;
"RTN","RORRP027",88,0)
 ;***** DEMOGRAPHIC INFORMATION (III)
"RTN","RORRP027",89,0)
CDM(IENS) ;
"RTN","RORRP027",90,0)
 N BUF,RC,TMP
"RTN","RORRP027",91,0)
 S BUF=RORDATA(RORPTR)
"RTN","RORRP027",92,0)
 S RC=$$CDCFDA^RORRP026(IENS,"CDM^RORRP026",BUF,.RORFDAFI)
"RTN","RORRP027",93,0)
 Q:RC RC
"RTN","RORRP027",94,0)
 ;--- Default values
"RTN","RORRP027",95,0)
 F TMP=9.04,9.08,9.09  S RORFDAFI(799.4,IENS,TMP)=""
"RTN","RORRP027",96,0)
 ;--- Age at diagnosis
"RTN","RORRP027",97,0)
 S TMP=+$P(BUF,U,3)
"RTN","RORRP027",98,0)
 I TMP  Q:$P(BUF,U,4)'?.2N "4^CDM"  D
"RTN","RORRP027",99,0)
 . S:TMP=1 RORFDAFI(799.4,IENS,9.03)=$P(BUF,U,4)
"RTN","RORRP027",100,0)
 . S:TMP=2 RORFDAFI(799.4,IENS,9.04)=$P(BUF,U,4)
"RTN","RORRP027",101,0)
 ;--- Country of birth
"RTN","RORRP027",102,0)
 S TMP=+$P(BUF,U,7)
"RTN","RORRP027",103,0)
 S:TMP=7 RORFDAFI(799.4,IENS,9.08)=$P(BUF,U,8)
"RTN","RORRP027",104,0)
 S:TMP=8 RORFDAFI(799.4,IENS,9.09)=$P(BUF,U,8)
"RTN","RORRP027",105,0)
 Q 0
"RTN","RORRP027",106,0)
 ;
"RTN","RORRP027",107,0)
 ;***** COMMENTS (X)
"RTN","RORRP027",108,0)
CMT(IENS) ;
"RTN","RORRP027",109,0)
 N CNT,NE,PTR,RC,SEG,TMP  K RORCMT
"RTN","RORRP027",110,0)
 ;--- Load the comments
"RTN","RORRP027",111,0)
 S PTR=RORPTR,(CNT,NE,RC)=0
"RTN","RORRP027",112,0)
 F  D  Q:RC!(SEG'="CMT")  S PTR=$O(RORDATA(PTR))  Q:PTR=""
"RTN","RORRP027",113,0)
 . S SEG=$P(RORDATA(PTR),U)  Q:SEG'="CMT"
"RTN","RORRP027",114,0)
 . S RORPTR=PTR  Q:CNT'<3
"RTN","RORRP027",115,0)
 . S TMP=$P(RORDATA(RORPTR),U,3)
"RTN","RORRP027",116,0)
 . S CNT=CNT+1,RORCMT(CNT)=TMP
"RTN","RORRP027",117,0)
 . S:TMP'="" NE=NE+1
"RTN","RORRP027",118,0)
 ;--- Store the reference into the FDA
"RTN","RORRP027",119,0)
 S RORFDAFI(799.4,IENS,25)=$S(NE>0:"RORCMT",1:"@")
"RTN","RORRP027",120,0)
 Q RC
"RTN","RORRP027",121,0)
 ;
"RTN","RORRP027",122,0)
 ;***** CLINICAL STATUS (VIII)
"RTN","RORRP027",123,0)
CS(IENS) ;
"RTN","RORRP027",124,0)
 N RC,TMP
"RTN","RORRP027",125,0)
 S RC=$$CDCFDA^RORRP026(IENS,"CS^RORRP026",RORDATA(RORPTR),.RORFDAFI)
"RTN","RORRP027",126,0)
 Q RC
"RTN","RORRP027",127,0)
 ;
"RTN","RORRP027",128,0)
 ;***** PROCESSES THE ERROR(S) AND UNLOCKS THE RECORDS
"RTN","RORRP027",129,0)
ERROR(RESULTS,RC) ;
"RTN","RORRP027",130,0)
 D RPCSTK^RORERR(.RESULTS,RC)
"RTN","RORRP027",131,0)
 D UNLOCK^RORLOCK(.RORLOCK)
"RTN","RORRP027",132,0)
 Q
"RTN","RORRP027",133,0)
 ;
"RTN","RORRP027",134,0)
 ;***** FACILITY OF DIAGNOSIS (IV)
"RTN","RORRP027",135,0)
FD(IENS) ;
"RTN","RORRP027",136,0)
 N RC,TMP
"RTN","RORRP027",137,0)
 S RC=$$CDCFDA^RORRP026(IENS,"FD^RORRP026",RORDATA(RORPTR),.RORFDAFI)
"RTN","RORRP027",138,0)
 Q RC
"RTN","RORRP027",139,0)
 ;
"RTN","RORRP027",140,0)
 ;***** FORM HEADERS
"RTN","RORRP027",141,0)
HDR(IENS) ;
"RTN","RORRP027",142,0)
 N RC,TMP
"RTN","RORRP027",143,0)
 S RC=$$CDCFDA^RORRP026(IENS,"HDR^RORRP026",RORDATA(RORPTR),.RORFDAFI)
"RTN","RORRP027",144,0)
 ;--- Person who completed the form
"RTN","RORRP027",145,0)
 S RORFDAFI(799.4,IENS,9.05)=DUZ
"RTN","RORRP027",146,0)
 Q RC
"RTN","RORRP027",147,0)
 ;
"RTN","RORRP027",148,0)
 ;***** LABORATORY DATA (VI)
"RTN","RORRP027",149,0)
LD1(IENS) ;
"RTN","RORRP027",150,0)
 N BUF,FLD,DATE,RC,TMP
"RTN","RORRP027",151,0)
 S BUF=RORDATA(RORPTR)
"RTN","RORRP027",152,0)
 S RC=$$CDCFDA^RORRP026(IENS,"LD1^RORRP026",BUF,.RORFDAFI)
"RTN","RORRP027",153,0)
 Q:RC RC
"RTN","RORRP027",154,0)
 ;--- Positive HIV detection test
"RTN","RORRP027",155,0)
 S FLD=$$PHIVFLD^RORRP026($P(BUF,U,12))
"RTN","RORRP027",156,0)
 I FLD  S RC=0  D  Q:RC RC
"RTN","RORRP027",157,0)
 . S DATE=$$DATE1^RORRP026($P(BUF,U,13))
"RTN","RORRP027",158,0)
 . I DATE<0  S RC="13^LD1"  Q
"RTN","RORRP027",159,0)
 . S RORFDAFI(799.4,IENS,FLD)=DATE
"RTN","RORRP027",160,0)
 Q 0
"RTN","RORRP027",161,0)
 ;
"RTN","RORRP027",162,0)
LD2(IENS) ;
"RTN","RORRP027",163,0)
 N RC,TMP
"RTN","RORRP027",164,0)
 S RC=$$CDCFDA^RORRP026(IENS,"LD2^RORRP026",RORDATA(RORPTR),.RORFDAFI)
"RTN","RORRP027",165,0)
 Q RC
"RTN","RORRP027",166,0)
 ;
"RTN","RORRP027",167,0)
 ;***** PATIENT HISTORY (V)
"RTN","RORRP027",168,0)
PH(IENS) ;
"RTN","RORRP027",169,0)
 N RC,TMP
"RTN","RORRP027",170,0)
 S RC=$$CDCFDA^RORRP026(IENS,"PH^RORRP026",RORDATA(RORPTR),.RORFDAFI)
"RTN","RORRP027",171,0)
 Q RC
"RTN","RORRP027",172,0)
 ;
"RTN","RORRP027",173,0)
 ;***** UPDATES THE CDC DATA
"RTN","RORRP027",174,0)
 ; RPC: [RORICR CDC SAVE]
"RTN","RORRP027",175,0)
 ;
"RTN","RORRP027",176,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP027",177,0)
 ;               are returned to.
"RTN","RORRP027",178,0)
 ;
"RTN","RORRP027",179,0)
 ; REGIEN        Registry IEN
"RTN","RORRP027",180,0)
 ;
"RTN","RORRP027",181,0)
 ; PATIEN        IEN of the registry patient (DFN)
"RTN","RORRP027",182,0)
 ;
"RTN","RORRP027",183,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORRP027",184,0)
 ;                 H  Update the patient history. If this flag is
"RTN","RORRP027",185,0)
 ;                    not provided, the PH data segment is ignored.
"RTN","RORRP027",186,0)
 ;
"RTN","RORRP027",187,0)
 ; .RORDATA      Reference to a local array that contains the CDC
"RTN","RORRP027",188,0)
 ;               data in the same format as the output of the RORICR
"RTN","RORRP027",189,0)
 ;               CDC LOAD remote procedure (see the LOADCDC^RORRP025
"RTN","RORRP027",190,0)
 ;               and description of the RPC for more details).
"RTN","RORRP027",191,0)
 ;
"RTN","RORRP027",192,0)
 ; NOTE #1: The CS data segment must be always included before the
"RTN","RORRP027",193,0)
 ;          AID segments. Otherwise, the latter will be ignored.
"RTN","RORRP027",194,0)
 ;
"RTN","RORRP027",195,0)
 ; NOTE #2: Any AIDS indicator disease, which has empty 3rd piece
"RTN","RORRP027",196,0)
 ;          in the corresponding AID segment (or no segment at all),
"RTN","RORRP027",197,0)
 ;          will be removed from the patient record.
"RTN","RORRP027",198,0)
 ;
"RTN","RORRP027",199,0)
 ; NOTE #3: There should be at least one empty comment (i.e. the
"RTN","RORRP027",200,0)
 ;          "CMT^1" segment) among the data if you want to clear
"RTN","RORRP027",201,0)
 ;          the CDC comments. Otherwise, they will not be updated.
"RTN","RORRP027",202,0)
 ;
"RTN","RORRP027",203,0)
 ; Return Values:
"RTN","RORRP027",204,0)
 ;
"RTN","RORRP027",205,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP027",206,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP027",207,0)
 ; details).
"RTN","RORRP027",208,0)
 ;
"RTN","RORRP027",209,0)
 ; Positive value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP027",210,0)
 ; an error in the CDC data. The value is the number of the erroneous
"RTN","RORRP027",211,0)
 ; piece of the data segment whose name is returned in the second
"RTN","RORRP027",212,0)
 ; piece of the RESULTS(0). For example, the "11^CDM" means that the
"RTN","RORRP027",213,0)
 ; 11th piece of the CDM data segment (ONSET OF ILLNESS/AIDS- STATE)
"RTN","RORRP027",214,0)
 ; contains an invalid value.
"RTN","RORRP027",215,0)
 ;
"RTN","RORRP027",216,0)
 ; Otherwise, zero is returned in the RESULTS(0).
"RTN","RORRP027",217,0)
 ;
"RTN","RORRP027",218,0)
SAVECDC(RESULTS,REGIEN,PATIEN,FLAGS,RORDATA) ;
"RTN","RORRP027",219,0)
 N RORAILST      ; List of AIDS indicator diseases
"RTN","RORRP027",220,0)
 N RORCMT        ; Buffer for the CDC comments (WP field)
"RTN","RORRP027",221,0)
 N RORFDAFI      ; FDA for FILE^DIE
"RTN","RORRP027",222,0)
 N RORFDAUP      ; FDA for UPDATE^DIE
"RTN","RORRP027",223,0)
 N RORIEN        ; List of IEN's to be assigned
"RTN","RORRP027",224,0)
 ;
"RTN","RORRP027",225,0)
 N I,IEN,IENS,RC,RORERRDL,RORMSG,RORPTR,SEG,SEGLST
"RTN","RORRP027",226,0)
 D CLEAR^RORERR("SAVECDC^RORRP027",1)
"RTN","RORRP027",227,0)
 K RESULTS  S (RESULTS(0),RORPTR)=0
"RTN","RORRP027",228,0)
 ;--- Check the parameters
"RTN","RORRP027",229,0)
 S RC=0  D  I RC<0  D ERROR(.RESULTS,RC)  Q
"RTN","RORRP027",230,0)
 . ;--- Registry IEN
"RTN","RORRP027",231,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP027",232,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP027",233,0)
 . S REGIEN=+REGIEN
"RTN","RORRP027",234,0)
 . ;--- Patient IEN
"RTN","RORRP027",235,0)
 . I $G(PATIEN)'>0  D  Q
"RTN","RORRP027",236,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"PATIEN",$G(PATIEN))
"RTN","RORRP027",237,0)
 . S PATIEN=+PATIEN
"RTN","RORRP027",238,0)
 . ;--- Flags
"RTN","RORRP027",239,0)
 . S FLAGS=$$UP^XLFSTR($G(FLAGS))
"RTN","RORRP027",240,0)
 ;
"RTN","RORRP027",241,0)
 ;--- Get IEN of the registry record
"RTN","RORRP027",242,0)
 S IEN=$$PRRIEN^RORUTL01(PATIEN,REGIEN)  Q:IEN'>0
"RTN","RORRP027",243,0)
 S IENS=IEN_","
"RTN","RORRP027",244,0)
 S RORLOCK(799.4,IENS)=""
"RTN","RORRP027",245,0)
 ;
"RTN","RORRP027",246,0)
 ;--- Prepare the data
"RTN","RORRP027",247,0)
 S SEGLST=",HDR,CDM,FD,LD1,LD2,CS,AID,TS1,TS2,CMT,"
"RTN","RORRP027",248,0)
 S:FLAGS["H" SEGLST=SEGLST_"PH,"
"RTN","RORRP027",249,0)
 S (RC,RORPTR)=0
"RTN","RORRP027",250,0)
 F  S RORPTR=$O(RORDATA(RORPTR))  Q:RORPTR'>0  D  Q:RC
"RTN","RORRP027",251,0)
 . S SEG=$TR($P(RORDATA(RORPTR),U)," ")
"RTN","RORRP027",252,0)
 . X:SEGLST[(","_SEG_",") "S RC=$$"_SEG_"(IENS)"
"RTN","RORRP027",253,0)
 I RC<0  D ERROR(.RESULTS,RC)  Q
"RTN","RORRP027",254,0)
 I RC>0  S RESULTS(0)=RC  Q
"RTN","RORRP027",255,0)
 ;
"RTN","RORRP027",256,0)
 ;--- Process the list of AIDS indicator diseases
"RTN","RORRP027",257,0)
 S RC=$$AIDSTORE()
"RTN","RORRP027",258,0)
 I RC<0  D ERROR(.RESULTS,RC)  Q
"RTN","RORRP027",259,0)
 ;
"RTN","RORRP027",260,0)
 ;--- Update the record(s)
"RTN","RORRP027",261,0)
 I $D(RORFDAFI)>1  D  I RC<0  D ERROR(.RESULTS,RC)  Q
"RTN","RORRP027",262,0)
 . D FILE^DIE(,"RORFDAFI","RORMSG")
"RTN","RORRP027",263,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,PATIEN,799.4,IENS)
"RTN","RORRP027",264,0)
 ;--- Add the record(s)
"RTN","RORRP027",265,0)
 I $D(RORFDAUP)>1  D  I RC<0  D ERROR(.RESULTS,RC)  Q
"RTN","RORRP027",266,0)
 . D UPDATE^DIE(,"RORFDAUP","RORIEN","RORMSG")
"RTN","RORRP027",267,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,PATIEN,799.4,IENS)
"RTN","RORRP027",268,0)
 ;
"RTN","RORRP027",269,0)
 ;--- Unlock the records
"RTN","RORRP027",270,0)
 S RC=$$UNLOCK^RORLOCK(.RORLOCK)
"RTN","RORRP027",271,0)
 I RC<0  D ERROR(.RESULTS,RC)  Q
"RTN","RORRP027",272,0)
 S RESULTS(0)=0
"RTN","RORRP027",273,0)
 Q
"RTN","RORRP027",274,0)
 ;
"RTN","RORRP027",275,0)
 ;***** TREATMENT/SERVICES REFERRALS (IX)
"RTN","RORRP027",276,0)
TS1(IENS) ;
"RTN","RORRP027",277,0)
 N RC,TMP
"RTN","RORRP027",278,0)
 S RC=$$CDCFDA^RORRP026(IENS,"TS1^RORRP026",RORDATA(RORPTR),.RORFDAFI)
"RTN","RORRP027",279,0)
 Q RC
"RTN","RORRP027",280,0)
 ;
"RTN","RORRP027",281,0)
TS2(IENS) ;
"RTN","RORRP027",282,0)
 N RC,TMP
"RTN","RORRP027",283,0)
 S RC=$$CDCFDA^RORRP026(IENS,"TS2^RORRP026",RORDATA(RORPTR),.RORFDAFI)
"RTN","RORRP027",284,0)
 Q RC
"RTN","RORRP029")
0^104^B6656524
"RTN","RORRP029",1,0)
RORRP029 ;HCIOFO/SG - RPC: ADDRESS UTILITIES ; 4/16/03 9:35am
"RTN","RORRP029",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP029",3,0)
 ;
"RTN","RORRP029",4,0)
 ; This routine uses the following IAs:
"RTN","RORRP029",5,0)
 ;
"RTN","RORRP029",6,0)
 ; #10056        Read access to the STATE file (#5)
"RTN","RORRP029",7,0)
 ;
"RTN","RORRP029",8,0)
 Q
"RTN","RORRP029",9,0)
 ;
"RTN","RORRP029",10,0)
 ;***** RETURNS THE LIST OF STATES
"RTN","RORRP029",11,0)
 ; RPC: [ROR LIST STATES]
"RTN","RORRP029",12,0)
 ;
"RTN","RORRP029",13,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP029",14,0)
 ;               are returned to.
"RTN","RORRP029",15,0)
 ;
"RTN","RORRP029",16,0)
 ; PART          The search pattern (partial match restriction)
"RTN","RORRP029",17,0)
 ;
"RTN","RORRP029",18,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORRP029",19,0)
 ;                 A  Enable abbreviation search (if PART contains 2
"RTN","RORRP029",20,0)
 ;                    character abbreviation, the corresponding state 
"RTN","RORRP029",21,0)
 ;                    is returned. Otherwise, the regular search is
"RTN","RORRP029",22,0)
 ;                    performed).
"RTN","RORRP029",23,0)
 ;                 B  Backwards. Traverses the index in the opposite
"RTN","RORRP029",24,0)
 ;                    direction of normal traversal.
"RTN","RORRP029",25,0)
 ;
"RTN","RORRP029",26,0)
 ; [NUMBER]      Maximum number of entries to return. A value of "*"
"RTN","RORRP029",27,0)
 ;               or no value in this parameter designates all entries.
"RTN","RORRP029",28,0)
 ;
"RTN","RORRP029",29,0)
 ; [FROM]        The index entry(s) from which to begin the list.
"RTN","RORRP029",30,0)
 ;               You should use the pieces of the @RESULTS@(0) node
"RTN","RORRP029",31,0)
 ;               (starting from the second one) to continue the
"RTN","RORRP029",32,0)
 ;               listing in the subsequent procedure calls.
"RTN","RORRP029",33,0)
 ;
"RTN","RORRP029",34,0)
 ;               NOTE: The FROM value itself is not included in
"RTN","RORRP029",35,0)
 ;                     the resulting list.
"RTN","RORRP029",36,0)
 ;
"RTN","RORRP029",37,0)
 ; The ^TMP("DILIST",$J) global node is used by the procedure.
"RTN","RORRP029",38,0)
 ;
"RTN","RORRP029",39,0)
 ; See description of the LIST^DIC for more details about the
"RTN","RORRP029",40,0)
 ; PART, NUMBER and FROM parameters.
"RTN","RORRP029",41,0)
 ;
"RTN","RORRP029",42,0)
 ; Return Values:
"RTN","RORRP029",43,0)
 ;
"RTN","RORRP029",44,0)
 ; A negative value of the first "^"-piece of the @RESULTS@(0)
"RTN","RORRP029",45,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP029",46,0)
 ; details).
"RTN","RORRP029",47,0)
 ;
"RTN","RORRP029",48,0)
 ; Otherwise, number of states and the value of the FROM
"RTN","RORRP029",49,0)
 ; parameter for the next procedure call are returned in the
"RTN","RORRP029",50,0)
 ; @RESULTS@(0) and the subsequent nodes of the global array
"RTN","RORRP029",51,0)
 ; contain the states.
"RTN","RORRP029",52,0)
 ; 
"RTN","RORRP029",53,0)
 ; @RESULTS@(0)          Result Descriptor
"RTN","RORRP029",54,0)
 ;                         ^01: Number of states
"RTN","RORRP029",55,0)
 ;                         ^02: Values that comprise the FROM
"RTN","RORRP029",56,0)
 ;                         ^nn: parameter for the subsequent call
"RTN","RORRP029",57,0)
 ;
"RTN","RORRP029",58,0)
 ; @RESULTS@(i)          State
"RTN","RORRP029",59,0)
 ;                         ^01: IEN
"RTN","RORRP029",60,0)
 ;                         ^02: Name
"RTN","RORRP029",61,0)
 ;                         ^03: Abbreviation
"RTN","RORRP029",62,0)
 ;                         ^04: VA State Code
"RTN","RORRP029",63,0)
 ;
"RTN","RORRP029",64,0)
STATELST(RESULTS,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP029",65,0)
 N BUF,FIELDS,I,RC,RORERRDL,TMP
"RTN","RORRP029",66,0)
 D CLEAR^RORERR("STATELST^RORRP029",1)
"RTN","RORRP029",67,0)
 K RESULTS  S RESULTS=$NA(^TMP("DILIST",$J))  K @RESULTS
"RTN","RORRP029",68,0)
 S FIELDS="@;.01;1;2"
"RTN","RORRP029",69,0)
 ;--- Check the parameters
"RTN","RORRP029",70,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP029",71,0)
 . ;--- Flags
"RTN","RORRP029",72,0)
 . S FLAGS=$$UP^XLFSTR($G(FLAGS))
"RTN","RORRP029",73,0)
 . ;--- Others
"RTN","RORRP029",74,0)
 . S PART=$G(PART),FROM=$G(FROM)
"RTN","RORRP029",75,0)
 . S NUMBER=$S($G(NUMBER)>0:+NUMBER,1:"*")
"RTN","RORRP029",76,0)
 ;--- Setup the start point
"RTN","RORRP029",77,0)
 F I=1:1  S TMP=$P(FROM,U,I)  Q:TMP=""  S FROM(I)=TMP
"RTN","RORRP029",78,0)
 S FROM=$G(FROM(1))
"RTN","RORRP029",79,0)
 ;--- Check for the abbreviation
"RTN","RORRP029",80,0)
 S RC=0
"RTN","RORRP029",81,0)
 I FLAGS["A",$L(PART)=2  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP029",82,0)
 . D LIST^DIC(5,,FIELDS,"P",2,,PART,"C",,,,"RORMSG")
"RTN","RORRP029",83,0)
 . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,,5)  Q
"RTN","RORRP029",84,0)
 . S:+$G(^TMP("DILIST",$J,0))=1 RC=1
"RTN","RORRP029",85,0)
 ;--- Query the file
"RTN","RORRP029",86,0)
 I 'RC  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP029",87,0)
 . S TMP="P"_$S(FLAGS["B":"B",1:"")
"RTN","RORRP029",88,0)
 . D LIST^DIC(5,,FIELDS,TMP,NUMBER,.FROM,PART,"B",,,,"RORMSG")
"RTN","RORRP029",89,0)
 . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,,5)  Q
"RTN","RORRP029",90,0)
 ;--- Success
"RTN","RORRP029",91,0)
 S TMP=$G(^TMP("DILIST",$J,0)),BUF=+$P(TMP,U)
"RTN","RORRP029",92,0)
 K ^TMP("DILIST",$J,0)
"RTN","RORRP029",93,0)
 I $P(TMP,U,3)  S I=0  D
"RTN","RORRP029",94,0)
 . F  S I=$O(FROM(I))  Q:I'>0  S TMP=FROM(I)  S:TMP'="" BUF=BUF_U_TMP
"RTN","RORRP029",95,0)
 S @RESULTS@(0)=BUF
"RTN","RORRP029",96,0)
 Q
"RTN","RORRP030")
0^105^B3261693
"RTN","RORRP030",1,0)
RORRP030 ;HCIOFO/SG - RPC: PATIENT DELETE ; 11/29/05 3:04pm
"RTN","RORRP030",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP030",3,0)
 ;
"RTN","RORRP030",4,0)
 Q
"RTN","RORRP030",5,0)
 ;
"RTN","RORRP030",6,0)
 ;***** MARKS THE PATIENT'S RECORD AS DELETED FROM THE REGISTRY
"RTN","RORRP030",7,0)
 ; RPC: [ROR PATIENT DELETE]
"RTN","RORRP030",8,0)
 ;
"RTN","RORRP030",9,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP030",10,0)
 ;               are returned to.
"RTN","RORRP030",11,0)
 ;
"RTN","RORRP030",12,0)
 ; REGIEN        Registry IEN
"RTN","RORRP030",13,0)
 ;
"RTN","RORRP030",14,0)
 ; RORDFN        IEN of the patient
"RTN","RORRP030",15,0)
 ;
"RTN","RORRP030",16,0)
 ; [FORCE]       Deprecated
"RTN","RORRP030",17,0)
 ;
"RTN","RORRP030",18,0)
 ; Return Values:
"RTN","RORRP030",19,0)
 ;
"RTN","RORRP030",20,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP030",21,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP030",22,0)
 ; details).
"RTN","RORRP030",23,0)
 ;
"RTN","RORRP030",24,0)
 ; Otherwise, the following codes can be returned in the RESULTS(0):
"RTN","RORRP030",25,0)
 ;
"RTN","RORRP030",26,0)
 ;         0  The record cannot be deleted
"RTN","RORRP030",27,0)
 ;         9  The record has been marked as deleted
"RTN","RORRP030",28,0)
 ;
"RTN","RORRP030",29,0)
DELETE(RESULTS,REGIEN,RORDFN,FORCE) ;
"RTN","RORRP030",30,0)
 N IENS,RC,REGNAME,RORFDA,RORMSG,TMP
"RTN","RORRP030",31,0)
 D CLEAR^RORERR("DELETE^RORRP030",1)
"RTN","RORRP030",32,0)
 K RESULTS  S RESULTS(0)=0
"RTN","RORRP030",33,0)
 ;
"RTN","RORRP030",34,0)
 ;--- Get the registry description/name
"RTN","RORRP030",35,0)
 S TMP=$$REGNAME^RORUTL01(REGIEN)
"RTN","RORRP030",36,0)
 I TMP=""  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP030",37,0)
 . S RC=$$ERROR^RORERR(-1,,,RORDFN)
"RTN","RORRP030",38,0)
 S REGNAME=$S($P(TMP,U,2)'="":$P(TMP,U,2),1:$P(TMP,U))
"RTN","RORRP030",39,0)
 ;
"RTN","RORRP030",40,0)
 ;--- Get IENS of the registry record
"RTN","RORRP030",41,0)
 S IENS=$$PRRIEN^RORUTL01(RORDFN,REGIEN)_","
"RTN","RORRP030",42,0)
 I IENS'>0  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP030",43,0)
 . S RC=$$ERROR^RORERR(-97,,,RORDFN,REGNAME)
"RTN","RORRP030",44,0)
 ;
"RTN","RORRP030",45,0)
 I $$PENDING^RORUTL18(+IENS)  D
"RTN","RORRP030",46,0)
 . ;--- Delete the pending record immediately
"RTN","RORRP030",47,0)
 . N DA,DIK  S DIK=$$ROOT^DILFD(798),DA=+IENS  D ^DIK
"RTN","RORRP030",48,0)
 E  D
"RTN","RORRP030",49,0)
 . ;--- Mark the record as deleted
"RTN","RORRP030",50,0)
 . S RORFDA(798,IENS,3)=5
"RTN","RORRP030",51,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORRP030",52,0)
 . I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)
"RTN","RORRP030",53,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,RORDFN,798,IENS)
"RTN","RORRP030",54,0)
 ;---
"RTN","RORRP030",55,0)
 S RESULTS(0)=9
"RTN","RORRP030",56,0)
 Q
"RTN","RORRP031")
0^106^B31717159
"RTN","RORRP031",1,0)
RORRP031 ;HCIOFO/SG - RPC: LOCAL LAB TEST NAMES ; 2/10/04 8:59am
"RTN","RORRP031",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP031",3,0)
 ;
"RTN","RORRP031",4,0)
 ; This routine uses the following IAs:
"RTN","RORRP031",5,0)
 ;
"RTN","RORRP031",6,0)
 ; #91           Access to the LABORATORY TEST file
"RTN","RORRP031",7,0)
 ;
"RTN","RORRP031",8,0)
 Q
"RTN","RORRP031",9,0)
 ;
"RTN","RORRP031",10,0)
 ;***** PROCESSES THE ERROR(S) AND UNLOCKS THE RECORD(S)
"RTN","RORRP031",11,0)
ERROR(RESULTS,RC) ;
"RTN","RORRP031",12,0)
 D RPCSTK^RORERR(.RESULTS,RC)
"RTN","RORRP031",13,0)
 D UNLOCK^RORLOCK(.RORLOCK)
"RTN","RORRP031",14,0)
 Q
"RTN","RORRP031",15,0)
 ;
"RTN","RORRP031",16,0)
 ;***** RETURNS THE LIST OF LOCAL TEST NAMES
"RTN","RORRP031",17,0)
 ; RPC: [ROR LIST LOCAL LAB TESTS]
"RTN","RORRP031",18,0)
 ;
"RTN","RORRP031",19,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP031",20,0)
 ;               are returned to.
"RTN","RORRP031",21,0)
 ;
"RTN","RORRP031",22,0)
 ; REGIEN        Registry IEN
"RTN","RORRP031",23,0)
 ;
"RTN","RORRP031",24,0)
 ; [GROUP]       Code of the Lab Group. If this parameter is
"RTN","RORRP031",25,0)
 ;               defined and greater than zero then only the tests
"RTN","RORRP031",26,0)
 ;               associated with this group will be returned.
"RTN","RORRP031",27,0)
 ;
"RTN","RORRP031",28,0)
 ; The ^TMP("DILIST",$J) global node is used by the procedure.
"RTN","RORRP031",29,0)
 ;
"RTN","RORRP031",30,0)
 ; Return Values:
"RTN","RORRP031",31,0)
 ;
"RTN","RORRP031",32,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP031",33,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP031",34,0)
 ; details).
"RTN","RORRP031",35,0)
 ;
"RTN","RORRP031",36,0)
 ; Otherwise, number of lab tests is returned in the @RESULTS@(0)
"RTN","RORRP031",37,0)
 ; and the subsequent nodes of the global array contain the tests.
"RTN","RORRP031",38,0)
 ; 
"RTN","RORRP031",39,0)
 ; @RESULTS@(0)          Number of Local Tests
"RTN","RORRP031",40,0)
 ;
"RTN","RORRP031",41,0)
 ; @RESULTS@(i)          Test Descriptor
"RTN","RORRP031",42,0)
 ;                         ^01: IEN in the LOCAL TEST NAME multiple
"RTN","RORRP031",43,0)
 ;                         ^02: Local test name
"RTN","RORRP031",44,0)
 ;                         ^03: IEN of the local test
"RTN","RORRP031",45,0)
 ;                         ^04: Code of the Lab Group
"RTN","RORRP031",46,0)
 ;
"RTN","RORRP031",47,0)
LTLIST(RESULTS,REGIEN,GROUP) ;
"RTN","RORRP031",48,0)
 N GROUPIEN,IENS,IR,RC,RORERRDL,RORMSG,SCR,TMP
"RTN","RORRP031",49,0)
 D CLEAR^RORERR("LTLIST^RORRP031",1)
"RTN","RORRP031",50,0)
 K RESULTS  S RESULTS=$NA(^TMP("DILIST",$J))  K @RESULTS
"RTN","RORRP031",51,0)
 ;
"RTN","RORRP031",52,0)
 ;--- Check the parameters
"RTN","RORRP031",53,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP031",54,0)
 . ;--- Registry IEN
"RTN","RORRP031",55,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP031",56,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP031",57,0)
 . S REGIEN=+REGIEN
"RTN","RORRP031",58,0)
 . ;--- Code of the Lab Group
"RTN","RORRP031",59,0)
 . S GROUP=+$G(GROUP)
"RTN","RORRP031",60,0)
 . S GROUPIEN=$S(GROUP>0:$$ITEMIEN^RORUTL09(3,REGIEN,GROUP),1:0)
"RTN","RORRP031",61,0)
 . I GROUPIEN<0  D  Q
"RTN","RORRP031",62,0)
 . . S RC=$$ERROR^RORERR(GROUPIEN)
"RTN","RORRP031",63,0)
 ;
"RTN","RORRP031",64,0)
 ;--- Compile the screen logic  (be careful with naked references)
"RTN","RORRP031",65,0)
 S SCR=""
"RTN","RORRP031",66,0)
 S:GROUPIEN>0 SCR=SCR_"I $P($G(^(0)),U,2)="_GROUPIEN_" "
"RTN","RORRP031",67,0)
 ;--- Get the list of tests
"RTN","RORRP031",68,0)
 S IENS=","_REGIEN_",",TMP="@;.01E;.01I;.02I"
"RTN","RORRP031",69,0)
 D LIST^DIC(798.128,IENS,TMP,"PU",,,,"B",SCR,,,"RORMSG")
"RTN","RORRP031",70,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP031",71,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.128,IENS)
"RTN","RORRP031",72,0)
 ;
"RTN","RORRP031",73,0)
 ;--- Replace the group IEN's with the group code(s)
"RTN","RORRP031",74,0)
 S (IR,RC)=0
"RTN","RORRP031",75,0)
 F  S IR=$O(@RESULTS@(IR))  Q:IR'>0  D  Q:RC<0
"RTN","RORRP031",76,0)
 . I GROUPIEN>0  S $P(@RESULTS@(IR,0),U,4)=GROUP  Q
"RTN","RORRP031",77,0)
 . S TMP=+$P(@RESULTS@(IR,0),U,4)
"RTN","RORRP031",78,0)
 . I TMP'>0  S $P(@RESULTS@(IR,0),U,4)=""  Q
"RTN","RORRP031",79,0)
 . S RC=$$ITEMCODE^RORUTL09(TMP)
"RTN","RORRP031",80,0)
 . S:RC>0 $P(@RESULTS@(IR,0),U,4)=RC
"RTN","RORRP031",81,0)
 I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP031",82,0)
 ;--- Success
"RTN","RORRP031",83,0)
 S TMP=+$G(^TMP("DILIST",$J,0))
"RTN","RORRP031",84,0)
 K ^TMP("DILIST",$J,0)  S @RESULTS@(0)=TMP
"RTN","RORRP031",85,0)
 Q
"RTN","RORRP031",86,0)
 ;
"RTN","RORRP031",87,0)
 ;***** UPDATES THE LIST OF LOCAL TEST NAMES
"RTN","RORRP031",88,0)
 ; RPC: [ROR UPDATE LOCAL LAB TESTS]
"RTN","RORRP031",89,0)
 ;
"RTN","RORRP031",90,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP031",91,0)
 ;               are returned to.
"RTN","RORRP031",92,0)
 ;
"RTN","RORRP031",93,0)
 ; REGIEN        Registry IEN
"RTN","RORRP031",94,0)
 ;
"RTN","RORRP031",95,0)
 ; GROUP         Code of the Lab Group.
"RTN","RORRP031",96,0)
 ;
"RTN","RORRP031",97,0)
 ;               If this parameter is equal to 0 then every item of
"RTN","RORRP031",98,0)
 ;               the LTLST must contain a valid group code. If an
"RTN","RORRP031",99,0)
 ;               empty list is passed into the RPC then ALL records
"RTN","RORRP031",100,0)
 ;               will be deleted from the LOCAL TEST NAME multiple.
"RTN","RORRP031",101,0)
 ;
"RTN","RORRP031",102,0)
 ;               If this parameter is not zero then it should contain 
"RTN","RORRP031",103,0)
 ;               a valid group code. All records of the LTLST will be 
"RTN","RORRP031",104,0)
 ;               associated with this group. If an empty list is
"RTN","RORRP031",105,0)
 ;               passed into the RPC then only records associated
"RTN","RORRP031",106,0)
 ;               with this group will be deleted from the multiple.
"RTN","RORRP031",107,0)
 ;
"RTN","RORRP031",108,0)
 ; .LTLST(       Reference to a local variable that contains
"RTN","RORRP031",109,0)
 ;               a list of local laboratory tests
"RTN","RORRP031",110,0)
 ;
"RTN","RORRP031",111,0)
 ;   i)          Test Descriptor
"RTN","RORRP031",112,0)
 ;                 ^01: Ignored
"RTN","RORRP031",113,0)
 ;                 ^02: Ignored
"RTN","RORRP031",114,0)
 ;                 ^03: IEN of the local test
"RTN","RORRP031",115,0)
 ;                 ^04: Code of the Lab Group
"RTN","RORRP031",116,0)
 ;                      (see also the GROUP parameter)
"RTN","RORRP031",117,0)
 ;
"RTN","RORRP031",118,0)
 ; Return Values:
"RTN","RORRP031",119,0)
 ;
"RTN","RORRP031",120,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP031",121,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP031",122,0)
 ; details).
"RTN","RORRP031",123,0)
 ;
"RTN","RORRP031",124,0)
 ; Otherwise, zero is returned in the RESULTS(0).
"RTN","RORRP031",125,0)
 ;
"RTN","RORRP031",126,0)
LTLUPD(RESULTS,REGIEN,GROUP,LTLST) ;
"RTN","RORRP031",127,0)
 N DA,DIK,ECNT,GROUPIEN,GRPIEN,IENS,IR,LTL,RC,ROOT,RORERRDL,RORFDA,RORLOCK,RORMSG,TMP,TSTIEN
"RTN","RORRP031",128,0)
 D CLEAR^RORERR("LTLUPD^RORRP031",1)  K RESULTS
"RTN","RORRP031",129,0)
 S ECNT=0
"RTN","RORRP031",130,0)
 ;
"RTN","RORRP031",131,0)
 ;--- Check the parameters
"RTN","RORRP031",132,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP031",133,0)
 . ;--- Registry IEN
"RTN","RORRP031",134,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP031",135,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP031",136,0)
 . S REGIEN=+REGIEN
"RTN","RORRP031",137,0)
 . ;--- Code of the Lab Group
"RTN","RORRP031",138,0)
 . S GROUPIEN=$S($G(GROUP)>0:$$ITEMIEN^RORUTL09(3,REGIEN,GROUP),1:0)
"RTN","RORRP031",139,0)
 . I GROUPIEN<0  D  Q
"RTN","RORRP031",140,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"GROUP",$G(GROUP))
"RTN","RORRP031",141,0)
 . S GROUP=+$G(GROUP)
"RTN","RORRP031",142,0)
 ;
"RTN","RORRP031",143,0)
 ;--- Lock the LOCAL TEST NAME multiple
"RTN","RORRP031",144,0)
 S IENS=","_REGIEN_","
"RTN","RORRP031",145,0)
 S RC=$$LOCK^RORLOCK(798.128,IENS)
"RTN","RORRP031",146,0)
 I RC  D:RC>0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP031",147,0)
 . S RC=$$ERROR^RORERR(-11,,,,"the LOCAL TEST NAME multiple")
"RTN","RORRP031",148,0)
 ;---
"RTN","RORRP031",149,0)
 S RORLOCK(798.128,IENS)=""
"RTN","RORRP031",150,0)
 S ROOT=$$ROOT^DILFD(798.128,IENS,1)
"RTN","RORRP031",151,0)
 ;
"RTN","RORRP031",152,0)
 ;--- Prepare the data
"RTN","RORRP031",153,0)
 S IR="",RC=0
"RTN","RORRP031",154,0)
 F  S IR=$O(LTLST(IR))  Q:IR=""  D  Q:RC<0
"RTN","RORRP031",155,0)
 . ;--- Check if the test is defined in the LABORATORY TEST file
"RTN","RORRP031",156,0)
 . S TSTIEN=+$P(LTLST(IR),U,3)
"RTN","RORRP031",157,0)
 . Q:$$FIND1^DIC(60,,,"`"_TSTIEN,,,"RORMSG")'>0
"RTN","RORRP031",158,0)
 . ;--- Assign the default Group IEN (if the GROUP is provided)
"RTN","RORRP031",159,0)
 . I GROUPIEN>0  S LTL(GROUPIEN,TSTIEN)=""  Q
"RTN","RORRP031",160,0)
 . ;--- Get IEN of the Lab Group
"RTN","RORRP031",161,0)
 . S TMP=+$P(LTLST(IR),U,4)
"RTN","RORRP031",162,0)
 . S GRPIEN=$$ITEMIEN^RORUTL09(3,REGIEN,TMP)
"RTN","RORRP031",163,0)
 . I GRPIEN'>0  D:GRPIEN<0  Q
"RTN","RORRP031",164,0)
 . . S RC=$$ERROR^RORERR(GRPIEN)
"RTN","RORRP031",165,0)
 . ;--- Create the reference
"RTN","RORRP031",166,0)
 . S LTL(GRPIEN,TSTIEN)=""
"RTN","RORRP031",167,0)
 I RC<0  D ERROR(.RESULTS,RC)  Q
"RTN","RORRP031",168,0)
 ;
"RTN","RORRP031",169,0)
 ;--- Mark the groups to be cleared
"RTN","RORRP031",170,0)
 I GROUPIEN'>0  S GRPIEN=""  D
"RTN","RORRP031",171,0)
 . F  S GRPIEN=$O(@ROOT@("G",GRPIEN))  Q:GRPIEN=""  S LTL(GRPIEN)=""
"RTN","RORRP031",172,0)
 E  S LTL(GROUPIEN)=""
"RTN","RORRP031",173,0)
 ;
"RTN","RORRP031",174,0)
 ;--- Update the multiple
"RTN","RORRP031",175,0)
 S IENS="?+1,"_REGIEN_",",ECNT=0
"RTN","RORRP031",176,0)
 S GRPIEN=""
"RTN","RORRP031",177,0)
 F  S GRPIEN=$O(LTL(GRPIEN))  Q:GRPIEN=""  D
"RTN","RORRP031",178,0)
 . ;--- Delete the old records
"RTN","RORRP031",179,0)
 . S DIK=$$OREF^DILF(ROOT),DA(1)=REGIEN
"RTN","RORRP031",180,0)
 . S TSTIEN=""
"RTN","RORRP031",181,0)
 . F  S TSTIEN=$O(@ROOT@("G",GRPIEN,TSTIEN))  Q:TSTIEN=""  D
"RTN","RORRP031",182,0)
 . . S DA=""
"RTN","RORRP031",183,0)
 . . F  S DA=$O(@ROOT@("G",GRPIEN,TSTIEN,DA))  Q:DA=""  D ^DIK
"RTN","RORRP031",184,0)
 . ;--- Store the new records
"RTN","RORRP031",185,0)
 . S TSTIEN=""
"RTN","RORRP031",186,0)
 . F  S TSTIEN=$O(LTL(GRPIEN,TSTIEN))  Q:TSTIEN=""  D
"RTN","RORRP031",187,0)
 . . S RORFDA(798.128,IENS,.01)=TSTIEN
"RTN","RORRP031",188,0)
 . . S RORFDA(798.128,IENS,.02)=GRPIEN
"RTN","RORRP031",189,0)
 . . D UPDATE^DIE(,"RORFDA",,"RORMSG")
"RTN","RORRP031",190,0)
 . . I $G(DIERR)  D  S ECNT=ECNT+1  Q
"RTN","RORRP031",191,0)
 . . . D DBS^RORERR("RORMSG",-9,,,798.128,IENS)
"RTN","RORRP031",192,0)
 ;
"RTN","RORRP031",193,0)
 ;--- Unlock the multiple and check for errors
"RTN","RORRP031",194,0)
 D UNLOCK^RORLOCK(798.128,","_REGIEN_",")
"RTN","RORRP031",195,0)
 I ECNT>0  D RPCSTK^RORERR(.RESULTS,-9)  Q
"RTN","RORRP031",196,0)
 ;--- Success
"RTN","RORRP031",197,0)
 S RESULTS(0)=0
"RTN","RORRP031",198,0)
 Q
"RTN","RORRP032")
0^107^B32884612
"RTN","RORRP032",1,0)
RORRP032 ;HCIOFO/SG - RPC: LOCAL DRUG NAMES ; 11/3/05 2:26pm
"RTN","RORRP032",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP032",3,0)
 ;
"RTN","RORRP032",4,0)
 ; This routine uses the following IAs:
"RTN","RORRP032",5,0)
 ;
"RTN","RORRP032",6,0)
 ; #4533         ZERO^PSS50 (supported)
"RTN","RORRP032",7,0)
 ;
"RTN","RORRP032",8,0)
 Q
"RTN","RORRP032",9,0)
 ;
"RTN","RORRP032",10,0)
 ;***** PROCESSES THE ERROR(S) AND UNLOCKS THE RECORD(S)
"RTN","RORRP032",11,0)
ERROR(RESULTS,RC) ;
"RTN","RORRP032",12,0)
 D RPCSTK^RORERR(.RESULTS,RC)
"RTN","RORRP032",13,0)
 D UNLOCK^RORLOCK(.RORLOCK)
"RTN","RORRP032",14,0)
 Q
"RTN","RORRP032",15,0)
 ;
"RTN","RORRP032",16,0)
 ;***** RETURNS THE LIST OF LOCAL DRUG NAMES
"RTN","RORRP032",17,0)
 ; RPC: [ROR LIST LOCAL DRUGS]
"RTN","RORRP032",18,0)
 ;
"RTN","RORRP032",19,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP032",20,0)
 ;               are returned to.
"RTN","RORRP032",21,0)
 ;
"RTN","RORRP032",22,0)
 ; REGIEN        Registry IEN
"RTN","RORRP032",23,0)
 ;
"RTN","RORRP032",24,0)
 ; [GROUP]       Code of the Drug Group. If this parameter is
"RTN","RORRP032",25,0)
 ;               defined and greater than zero then only the drugs
"RTN","RORRP032",26,0)
 ;               associated with this group will be returned.
"RTN","RORRP032",27,0)
 ;
"RTN","RORRP032",28,0)
 ; The ^TMP("DILIST",$J) global node is used by the procedure.
"RTN","RORRP032",29,0)
 ;
"RTN","RORRP032",30,0)
 ; Return Values:
"RTN","RORRP032",31,0)
 ;
"RTN","RORRP032",32,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP032",33,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP032",34,0)
 ; details).
"RTN","RORRP032",35,0)
 ;
"RTN","RORRP032",36,0)
 ; Otherwise, number of drugs is returned in the @RESULTS@(0) and
"RTN","RORRP032",37,0)
 ; the subsequent nodes of the global array contain the drugs.
"RTN","RORRP032",38,0)
 ; 
"RTN","RORRP032",39,0)
 ; @RESULTS@(0)          Number of Local Drugs
"RTN","RORRP032",40,0)
 ;
"RTN","RORRP032",41,0)
 ; @RESULTS@(i)          Drug Descriptor
"RTN","RORRP032",42,0)
 ;                         ^01: IEN in the LOCAL DRUG NAME multiple
"RTN","RORRP032",43,0)
 ;                         ^02: Local drug name
"RTN","RORRP032",44,0)
 ;                         ^03: IEN of the local drug
"RTN","RORRP032",45,0)
 ;                         ^04: Code of the Drug Group
"RTN","RORRP032",46,0)
 ;
"RTN","RORRP032",47,0)
LDLIST(RESULTS,REGIEN,GROUP) ;
"RTN","RORRP032",48,0)
 N GROUPIEN,IENS,IR,RC,RORERRDL,RORMSG,SCR,TMP
"RTN","RORRP032",49,0)
 D CLEAR^RORERR("LDLIST^RORRP032",1)
"RTN","RORRP032",50,0)
 K RESULTS  S RESULTS=$NA(^TMP("DILIST",$J))  K @RESULTS
"RTN","RORRP032",51,0)
 ;
"RTN","RORRP032",52,0)
 ;--- Check the parameters
"RTN","RORRP032",53,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP032",54,0)
 . ;--- Registry IEN
"RTN","RORRP032",55,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP032",56,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP032",57,0)
 . S REGIEN=+REGIEN
"RTN","RORRP032",58,0)
 . ;--- Code of the Drug Group
"RTN","RORRP032",59,0)
 . S GROUP=+$G(GROUP)
"RTN","RORRP032",60,0)
 . S GROUPIEN=$S(GROUP>0:$$ITEMIEN^RORUTL09(4,REGIEN,GROUP),1:0)
"RTN","RORRP032",61,0)
 . I GROUPIEN<0  D  Q
"RTN","RORRP032",62,0)
 . . S RC=$$ERROR^RORERR(GROUPIEN)
"RTN","RORRP032",63,0)
 ;
"RTN","RORRP032",64,0)
 ;--- Compile the screen logic  (be careful with naked references)
"RTN","RORRP032",65,0)
 S SCR=""
"RTN","RORRP032",66,0)
 S:GROUPIEN>0 SCR=SCR_"I $P($G(^(0)),U,2)="_GROUPIEN_" "
"RTN","RORRP032",67,0)
 ;--- Get the list of drugs
"RTN","RORRP032",68,0)
 S IENS=","_REGIEN_",",TMP="@;.01E;.01I;.02I"
"RTN","RORRP032",69,0)
 D LIST^DIC(798.129,IENS,TMP,"PU",,,,"B",SCR,,,"RORMSG")
"RTN","RORRP032",70,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP032",71,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.129,IENS)
"RTN","RORRP032",72,0)
 ;
"RTN","RORRP032",73,0)
 ;--- Replace the group IEN's with the group code(s)
"RTN","RORRP032",74,0)
 S (IR,RC)=0
"RTN","RORRP032",75,0)
 F  S IR=$O(@RESULTS@(IR))  Q:IR'>0  D  Q:RC<0
"RTN","RORRP032",76,0)
 . I GROUPIEN>0  S $P(@RESULTS@(IR,0),U,4)=GROUP  Q
"RTN","RORRP032",77,0)
 . S TMP=+$P(@RESULTS@(IR,0),U,4)
"RTN","RORRP032",78,0)
 . I TMP'>0  S $P(@RESULTS@(IR,0),U,4)=""  Q
"RTN","RORRP032",79,0)
 . S RC=$$ITEMCODE^RORUTL09(TMP)
"RTN","RORRP032",80,0)
 . S:RC>0 $P(@RESULTS@(IR,0),U,4)=RC
"RTN","RORRP032",81,0)
 I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP032",82,0)
 ;--- Success
"RTN","RORRP032",83,0)
 S TMP=+$G(^TMP("DILIST",$J,0))
"RTN","RORRP032",84,0)
 K ^TMP("DILIST",$J,0)  S @RESULTS@(0)=TMP
"RTN","RORRP032",85,0)
 Q
"RTN","RORRP032",86,0)
 ;
"RTN","RORRP032",87,0)
 ;***** UPDATES THE LIST OF LOCAL DRUG NAMES
"RTN","RORRP032",88,0)
 ; RPC: [ROR UPDATE LOCAL DRUGS]
"RTN","RORRP032",89,0)
 ;
"RTN","RORRP032",90,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP032",91,0)
 ;               are returned to.
"RTN","RORRP032",92,0)
 ;
"RTN","RORRP032",93,0)
 ; REGIEN        Registry IEN
"RTN","RORRP032",94,0)
 ;
"RTN","RORRP032",95,0)
 ; GROUP         Code of the Drug Group.
"RTN","RORRP032",96,0)
 ;
"RTN","RORRP032",97,0)
 ;               If this parameter is equal to 0 then every item of
"RTN","RORRP032",98,0)
 ;               the LDLST must contain a valid group code. If an
"RTN","RORRP032",99,0)
 ;               empty list is passed into the RPC then ALL records
"RTN","RORRP032",100,0)
 ;               will be deleted from the LOCAL DRUG NAME multiple.
"RTN","RORRP032",101,0)
 ;
"RTN","RORRP032",102,0)
 ;               If this parameter is not zero then it should contain 
"RTN","RORRP032",103,0)
 ;               a valid group code. All records of the LDLST will be
"RTN","RORRP032",104,0)
 ;               associated with this group. If an empty list is
"RTN","RORRP032",105,0)
 ;               passed into the RPC then only records associated
"RTN","RORRP032",106,0)
 ;               with this group will be deleted from the multiple.
"RTN","RORRP032",107,0)
 ;
"RTN","RORRP032",108,0)
 ; .LDLST(       Reference to a local variable that contains
"RTN","RORRP032",109,0)
 ;               a list of local drugs
"RTN","RORRP032",110,0)
 ;
"RTN","RORRP032",111,0)
 ;   i)          Test Descriptor
"RTN","RORRP032",112,0)
 ;                 ^01: Ignored
"RTN","RORRP032",113,0)
 ;                 ^02: Ignored
"RTN","RORRP032",114,0)
 ;                 ^03: IEN of the local drug
"RTN","RORRP032",115,0)
 ;                 ^04: Code of the Drug Group
"RTN","RORRP032",116,0)
 ;                      (see also the GROUP parameter)
"RTN","RORRP032",117,0)
 ;
"RTN","RORRP032",118,0)
 ; Return Values:
"RTN","RORRP032",119,0)
 ;
"RTN","RORRP032",120,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP032",121,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP032",122,0)
 ; details).
"RTN","RORRP032",123,0)
 ;
"RTN","RORRP032",124,0)
 ; Otherwise, zero is returned in the RESULTS(0).
"RTN","RORRP032",125,0)
 ;
"RTN","RORRP032",126,0)
LDLUPD(RESULTS,REGIEN,GROUP,LDLST) ;
"RTN","RORRP032",127,0)
 N DA,DIK,DRUGIEN,ECNT,GROUPIEN,GRPIEN,IENS,IR,LDL,RC,ROOT,RORERRDL,RORFDA,RORLOCK,RORMSG,RORTMP,RORTS,TMP
"RTN","RORRP032",128,0)
 D CLEAR^RORERR("LDLUPD^RORRP032",1)  K RESULTS
"RTN","RORRP032",129,0)
 S ECNT=0
"RTN","RORRP032",130,0)
 ;
"RTN","RORRP032",131,0)
 ;--- Check the parameters
"RTN","RORRP032",132,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP032",133,0)
 . ;--- Registry IEN
"RTN","RORRP032",134,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP032",135,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP032",136,0)
 . S REGIEN=+REGIEN
"RTN","RORRP032",137,0)
 . ;--- Code of the Drug Group
"RTN","RORRP032",138,0)
 . S GROUPIEN=$S($G(GROUP)>0:$$ITEMIEN^RORUTL09(4,REGIEN,GROUP),1:0)
"RTN","RORRP032",139,0)
 . I GROUPIEN<0  D  Q
"RTN","RORRP032",140,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"GROUP",$G(GROUP))
"RTN","RORRP032",141,0)
 . S GROUP=+$G(GROUP)
"RTN","RORRP032",142,0)
 ;
"RTN","RORRP032",143,0)
 ;--- Lock the LOCAL DRUG NAME multiple
"RTN","RORRP032",144,0)
 S IENS=","_REGIEN_","
"RTN","RORRP032",145,0)
 S RC=$$LOCK^RORLOCK(798.129,IENS)
"RTN","RORRP032",146,0)
 I RC  D:RC>0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP032",147,0)
 . S RC=$$ERROR^RORERR(-11,,,,"the LOCAL DRUG NAME multiple")
"RTN","RORRP032",148,0)
 ;---
"RTN","RORRP032",149,0)
 S RORLOCK(798.129,IENS)=""
"RTN","RORRP032",150,0)
 S ROOT=$$ROOT^DILFD(798.129,IENS,1)
"RTN","RORRP032",151,0)
 ;
"RTN","RORRP032",152,0)
 ;--- Prepare the data
"RTN","RORRP032",153,0)
 S RORTMP=$$ALLOC^RORTMP(.RORTS)
"RTN","RORRP032",154,0)
 S IR="",RC=0
"RTN","RORRP032",155,0)
 F  S IR=$O(LDLST(IR))  Q:IR=""  D  Q:RC<0
"RTN","RORRP032",156,0)
 . ;--- Check if the drug is defined in the DRUG file
"RTN","RORRP032",157,0)
 . S DRUGIEN=+$P(LDLST(IR),U,3)
"RTN","RORRP032",158,0)
 . D ZERO^PSS50(DRUGIEN,,,,,RORTS)
"RTN","RORRP032",159,0)
 . Q:$G(@RORTMP@(0))'>0
"RTN","RORRP032",160,0)
 . ;--- Assign the default Group IEN (if the GROUP is provided)
"RTN","RORRP032",161,0)
 . I GROUPIEN>0  S LDL(GROUPIEN,DRUGIEN)=""  Q
"RTN","RORRP032",162,0)
 . ;--- Get IEN of the Drug Group
"RTN","RORRP032",163,0)
 . S TMP=+$P(LDLST(IR),U,4)
"RTN","RORRP032",164,0)
 . S GRPIEN=$$ITEMIEN^RORUTL09(4,REGIEN,TMP)
"RTN","RORRP032",165,0)
 . I GRPIEN'>0  D:GRPIEN<0  Q
"RTN","RORRP032",166,0)
 . . S RC=$$ERROR^RORERR(GRPIEN)
"RTN","RORRP032",167,0)
 . ;--- Create the reference
"RTN","RORRP032",168,0)
 . S LDL(GRPIEN,DRUGIEN)=""
"RTN","RORRP032",169,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORRP032",170,0)
 I RC<0  D ERROR(.RESULTS,RC)  Q
"RTN","RORRP032",171,0)
 ;---
"RTN","RORRP032",172,0)
 I GROUPIEN'>0  S GRPIEN=""  D
"RTN","RORRP032",173,0)
 . F  S GRPIEN=$O(@ROOT@("G",GRPIEN))  Q:GRPIEN=""  S LDL(GRPIEN)=""
"RTN","RORRP032",174,0)
 E  S LDL(GROUPIEN)=""
"RTN","RORRP032",175,0)
 ;
"RTN","RORRP032",176,0)
 ;--- Update the multiple
"RTN","RORRP032",177,0)
 S IENS="?+1,"_REGIEN_",",ECNT=0
"RTN","RORRP032",178,0)
 S GRPIEN=""
"RTN","RORRP032",179,0)
 F  S GRPIEN=$O(LDL(GRPIEN))  Q:GRPIEN=""  D
"RTN","RORRP032",180,0)
 . ;--- Delete the old records
"RTN","RORRP032",181,0)
 . S DIK=$$OREF^DILF(ROOT),DA(1)=REGIEN
"RTN","RORRP032",182,0)
 . S DRUGIEN=""
"RTN","RORRP032",183,0)
 . F  S DRUGIEN=$O(@ROOT@("G",GRPIEN,DRUGIEN))  Q:DRUGIEN=""  D
"RTN","RORRP032",184,0)
 . . S DA=""
"RTN","RORRP032",185,0)
 . . F  S DA=$O(@ROOT@("G",GRPIEN,DRUGIEN,DA))  Q:DA=""  D ^DIK
"RTN","RORRP032",186,0)
 . ;--- Store the new records
"RTN","RORRP032",187,0)
 . S DRUGIEN=""
"RTN","RORRP032",188,0)
 . F  S DRUGIEN=$O(LDL(GRPIEN,DRUGIEN))  Q:DRUGIEN=""  D
"RTN","RORRP032",189,0)
 . . S RORFDA(798.129,IENS,.01)=DRUGIEN
"RTN","RORRP032",190,0)
 . . S RORFDA(798.129,IENS,.02)=GRPIEN
"RTN","RORRP032",191,0)
 . . D UPDATE^DIE(,"RORFDA",,"RORMSG")
"RTN","RORRP032",192,0)
 . . I $G(DIERR)  D  S ECNT=ECNT+1  Q
"RTN","RORRP032",193,0)
 . . . D DBS^RORERR("RORMSG",-9,,,798.129,IENS)
"RTN","RORRP032",194,0)
 ;
"RTN","RORRP032",195,0)
 ;--- Unlock the multiple and check for errors
"RTN","RORRP032",196,0)
 D UNLOCK^RORLOCK(798.129,","_REGIEN_",")
"RTN","RORRP032",197,0)
 I ECNT>0  D RPCSTK^RORERR(.RESULTS,-9)  Q
"RTN","RORRP032",198,0)
 ;--- Success
"RTN","RORRP032",199,0)
 S RESULTS(0)=0
"RTN","RORRP032",200,0)
 Q
"RTN","RORRP033")
0^108^B14303142
"RTN","RORRP033",1,0)
RORRP033 ;HCIOFO/SG - RPC: HIV PATIENT LOAD ; 10/27/05 2:12pm
"RTN","RORRP033",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP033",3,0)
 ;
"RTN","RORRP033",4,0)
 Q
"RTN","RORRP033",5,0)
 ;
"RTN","RORRP033",6,0)
 ;***** PROCESSES THE ERROR(S) AND UNLOCKS THE RECORDS
"RTN","RORRP033",7,0)
ERROR(RESULTS,RC) ;
"RTN","RORRP033",8,0)
 D RPCSTK^RORERR(.RESULTS,RC)
"RTN","RORRP033",9,0)
 D UNLOCK^RORLOCK(.RORLOCK)
"RTN","RORRP033",10,0)
 Q
"RTN","RORRP033",11,0)
 ;
"RTN","RORRP033",12,0)
 ;***** LOADS THE PATIENT'S DATA FOR EDITING
"RTN","RORRP033",13,0)
 ; RPC: [RORICR PATIENT LOAD]
"RTN","RORRP033",14,0)
 ;
"RTN","RORRP033",15,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP033",16,0)
 ;               are returned to.
"RTN","RORRP033",17,0)
 ;
"RTN","RORRP033",18,0)
 ; REGIEN        Registry IEN
"RTN","RORRP033",19,0)
 ;
"RTN","RORRP033",20,0)
 ; PATIEN        IEN of the registry patient (DFN)
"RTN","RORRP033",21,0)
 ;
"RTN","RORRP033",22,0)
 ; [LOCK]        Lock the registry record before loading the data and
"RTN","RORRP033",23,0)
 ;               leave it locked.
"RTN","RORRP033",24,0)
 ;
"RTN","RORRP033",25,0)
 ; Return Values:
"RTN","RORRP033",26,0)
 ;
"RTN","RORRP033",27,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP033",28,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP033",29,0)
 ; details).
"RTN","RORRP033",30,0)
 ;
"RTN","RORRP033",31,0)
 ; If locking was requested (see the LOCK parameter) and the record
"RTN","RORRP033",32,0)
 ; could not be locked then the first "^"-piece of the @RESULTS@(0)
"RTN","RORRP033",33,0)
 ; would be greater than 0. The @RESULTS@(0) would contain the lock
"RTN","RORRP033",34,0)
 ; descriptor and subsequent nodes of the global array would contain
"RTN","RORRP033",35,0)
 ; the data (see below). The lock descriptor contains information
"RTN","RORRP033",36,0)
 ; about the process, which owns the most recent lock of the record.
"RTN","RORRP033",37,0)
 ; The "O" flag (read-only) would also be added to the 15th field
"RTN","RORRP033",38,0)
 ; of the "PRD" segment.
"RTN","RORRP033",39,0)
 ;
"RTN","RORRP033",40,0)
 ; @RESULTS@(0)          Lock Descriptor
"RTN","RORRP033",41,0)
 ;                         ^01: Date/Time (FileMan)
"RTN","RORRP033",42,0)
 ;                         ^02: User/Process name
"RTN","RORRP033",43,0)
 ;                         ^03: User IEN (DUZ)
"RTN","RORRP033",44,0)
 ;                         ^04: $JOB
"RTN","RORRP033",45,0)
 ;                         ^05: Task number
"RTN","RORRP033",46,0)
 ;
"RTN","RORRP033",47,0)
 ; THE DATA IS LOADED ONLY FOR VIEWING PURPOSES (READ-ONLY)!
"RTN","RORRP033",48,0)
 ;
"RTN","RORRP033",49,0)
 ; Otherwise, zero is returned in the @RESULTS@(0) and the
"RTN","RORRP033",50,0)
 ; subsequent nodes of the global array contain the patient's data.
"RTN","RORRP033",51,0)
 ; 
"RTN","RORRP033",52,0)
 ; @RESULTS@(0)          0
"RTN","RORRP033",53,0)
 ;
"RTN","RORRP033",54,0)
 ; @RESULTS@(i)          Demographic data
"RTN","RORRP033",55,0)
 ;                         ^01: "DEM"
"RTN","RORRP033",56,0)
 ;                         ^02: ""
"RTN","RORRP033",57,0)
 ;                         ...  See description of the ROR PATIENT
"RTN","RORRP033",58,0)
 ;                              GET DATA remote procedure
"RTN","RORRP033",59,0)
 ;
"RTN","RORRP033",60,0)
 ; @RESULTS@(i)          Basic registry data
"RTN","RORRP033",61,0)
 ;                         ^01: "PRD"
"RTN","RORRP033",62,0)
 ;                         ^02: ""
"RTN","RORRP033",63,0)
 ;                         ...  See description of the ROR PATIENT
"RTN","RORRP033",64,0)
 ;                              GET DATA remote procedure
"RTN","RORRP033",65,0)
 ;
"RTN","RORRP033",66,0)
 ; RESULTS(i)            Local field data
"RTN","RORRP033",67,0)
 ;                         ^O1: "LFV"
"RTN","RORRP033",68,0)
 ;                         ...  See description of the ROR PATIENT
"RTN","RORRP033",69,0)
 ;                              GET DATA remote procedure
"RTN","RORRP033",70,0)
 ;
"RTN","RORRP033",71,0)
 ; RESULTS(i)            Selection Rule
"RTN","RORRP033",72,0)
 ;                         ^01: "PSR"
"RTN","RORRP033",73,0)
 ;                         ...  See description of the ROR PATIENT
"RTN","RORRP033",74,0)
 ;                              GET DATA remote procedure
"RTN","RORRP033",75,0)
 ;
"RTN","RORRP033",76,0)
 ; @RESULTS@(i)          Patient's history (risk factors)
"RTN","RORRP033",77,0)
 ;                         ^01: "PH"
"RTN","RORRP033",78,0)
 ;                         ^02: ""
"RTN","RORRP033",79,0)
 ;                         ...  See description of the RORICR
"RTN","RORRP033",80,0)
 ;                              CDC LOAD remote procedure
"RTN","RORRP033",81,0)
 ;
"RTN","RORRP033",82,0)
 ; @RESULTS@(i)          Registry data
"RTN","RORRP033",83,0)
 ;                         ^01: "ICR"
"RTN","RORRP033",84,0)
 ;                         ^02: ""
"RTN","RORRP033",85,0)
 ;                         ^03: Clinical AIDS (0/1)
"RTN","RORRP033",86,0)
 ;                         ^04: Date of Clinical AIDS (FileMan)
"RTN","RORRP033",87,0)
 ;                         ^05: reserved
"RTN","RORRP033",88,0)
 ;
"RTN","RORRP033",89,0)
LOAD(RESULTS,REGIEN,PATIEN,LOCK) ;
"RTN","RORRP033",90,0)
 N I,ICRBUF,IENS,LOCKRC,RC,RESPTR,RORBUF,RORERRDL,RORLOCK,RORMSG,TMP
"RTN","RORRP033",91,0)
 D CLEAR^RORERR("LOAD^RORRP033",1)
"RTN","RORRP033",92,0)
 K RESULTS  S RESULTS=$$ALLOC^RORTMP()
"RTN","RORRP033",93,0)
 S ICRBUF="ICR",LOCKRC=0
"RTN","RORRP033",94,0)
 ;=== Check the parameters
"RTN","RORRP033",95,0)
 S RC=0  D  I RC<0  D ERROR(.RESULTS,RC)  Q
"RTN","RORRP033",96,0)
 . ;--- Registry IEN
"RTN","RORRP033",97,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP033",98,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP033",99,0)
 . S REGIEN=+REGIEN
"RTN","RORRP033",100,0)
 . ;--- Patient IEN
"RTN","RORRP033",101,0)
 . I $G(PATIEN)'>0  D  Q
"RTN","RORRP033",102,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"PATIEN",$G(PATIEN))
"RTN","RORRP033",103,0)
 . S PATIEN=+PATIEN
"RTN","RORRP033",104,0)
 ;
"RTN","RORRP033",105,0)
 ;=== Get the IENS of the registry record
"RTN","RORRP033",106,0)
 S IENS=$$PRRIEN^RORUTL01(PATIEN,REGIEN)_","
"RTN","RORRP033",107,0)
 ;
"RTN","RORRP033",108,0)
 ;=== Lock the records
"RTN","RORRP033",109,0)
 I $G(LOCK),IENS>0  D  I LOCKRC<0  D ERROR(.RESULTS,+LOCKRC)  Q
"RTN","RORRP033",110,0)
 . S RORLOCK(798,IENS)=""
"RTN","RORRP033",111,0)
 . S RORLOCK(799.4,IENS)=""
"RTN","RORRP033",112,0)
 . S LOCKRC=$$LOCK^RORLOCK(.RORLOCK)
"RTN","RORRP033",113,0)
 ;
"RTN","RORRP033",114,0)
 ;=== Get the patient's data
"RTN","RORRP033",115,0)
 D GETPTDAT^RORRP021(.RORBUF,PATIEN,"LS",REGIEN)
"RTN","RORRP033",116,0)
 I $G(RORBUF(0))<0  D ERROR(.RESULTS,+RORBUF(0))  Q
"RTN","RORRP033",117,0)
 ;---
"RTN","RORRP033",118,0)
 S I=""
"RTN","RORRP033",119,0)
 F  S I=$O(RORBUF(I))  Q:I=""  Q:$P(RORBUF(I),U)="PRD"
"RTN","RORRP033",120,0)
 D:I'=""
"RTN","RORRP033",121,0)
 . S TMP=$P(RORBUF(I),U,15)
"RTN","RORRP033",122,0)
 . I TMP'["O"  S:LOCKRC $P(RORBUF(I),U,15)=TMP_"O" ; Read Only
"RTN","RORRP033",123,0)
 . E  D UNLOCK^RORLOCK(.RORLOCK)  S LOCKRC=0
"RTN","RORRP033",124,0)
 ;---
"RTN","RORRP033",125,0)
 M @RESULTS=RORBUF  S RESPTR=$O(RORBUF(""),-1)
"RTN","RORRP033",126,0)
 K RORBUF
"RTN","RORRP033",127,0)
 ;
"RTN","RORRP033",128,0)
 ;=== Load the ICR data
"RTN","RORRP033",129,0)
 I IENS>0  S RC=0  D  I RC<0  D ERROR(.RESULTS,RC)  Q
"RTN","RORRP033",130,0)
 . Q:$D(^RORDATA(799.4,+IENS))<10
"RTN","RORRP033",131,0)
 . ;--- Patient's history (risk factors)
"RTN","RORRP033",132,0)
 . S RORBUF="PH"
"RTN","RORRP033",133,0)
 . S RC=$$LOAD^RORRP026(IENS,"PH^RORRP026",.RORBUF)  Q:RC<0
"RTN","RORRP033",134,0)
 . S RESPTR=RESPTR+1,@RESULTS@(RESPTR)=RORBUF
"RTN","RORRP033",135,0)
 . ;--- Other registry data
"RTN","RORRP033",136,0)
 . D GETS^DIQ(799.4,IENS,".02;.03;","I","RORBUF","RORMSG")
"RTN","RORRP033",137,0)
 . I $G(DIERR)  D  Q
"RTN","RORRP033",138,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,PATIEN,799.4,IENS)
"RTN","RORRP033",139,0)
 . S $P(ICRBUF,U,3)=+$G(RORBUF(799.4,IENS,.02,"I"))
"RTN","RORRP033",140,0)
 . S $P(ICRBUF,U,4)=$G(RORBUF(799.4,IENS,.03,"I"))
"RTN","RORRP033",141,0)
 ;
"RTN","RORRP033",142,0)
 ;===
"RTN","RORRP033",143,0)
 S RESPTR=RESPTR+1,@RESULTS@(RESPTR)=ICRBUF
"RTN","RORRP033",144,0)
 S @RESULTS@(0)=LOCKRC
"RTN","RORRP033",145,0)
 Q
"RTN","RORRP034")
0^109^B12664578
"RTN","RORRP034",1,0)
RORRP034 ;HCIOFO/SG - RPC: HIV PATIENT SAVE/CANCEL ; 11/29/05 8:49am
"RTN","RORRP034",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP034",3,0)
 ;
"RTN","RORRP034",4,0)
 Q
"RTN","RORRP034",5,0)
 ;
"RTN","RORRP034",6,0)
 ;***** UPDATES THE PATIENT'S REGISTRY DATA
"RTN","RORRP034",7,0)
 ; RPC: [RORICR PATIENT SAVE]
"RTN","RORRP034",8,0)
 ;
"RTN","RORRP034",9,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP034",10,0)
 ;               are returned to.
"RTN","RORRP034",11,0)
 ;
"RTN","RORRP034",12,0)
 ; REGIEN        Registry IEN
"RTN","RORRP034",13,0)
 ;
"RTN","RORRP034",14,0)
 ; PTIEN         IEN of the registry patient (DFN)
"RTN","RORRP034",15,0)
 ;
"RTN","RORRP034",16,0)
 ; [CANCEL]      Cancel the update and unlock the registry data
"RTN","RORRP034",17,0)
 ;
"RTN","RORRP034",18,0)
 ; .DATA         Reference to a local array that contains the data
"RTN","RORRP034",19,0)
 ;               in the same format as the output of the RORICR
"RTN","RORRP034",20,0)
 ;               PATIENT LOAD remote procedure. Only PH, ICR, and
"RTN","RORRP034",21,0)
 ;               LFV segments are processed; the others are ignored.
"RTN","RORRP034",22,0)
 ;
"RTN","RORRP034",23,0)
 ; Return Values:
"RTN","RORRP034",24,0)
 ;
"RTN","RORRP034",25,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP034",26,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP034",27,0)
 ; details).
"RTN","RORRP034",28,0)
 ;
"RTN","RORRP034",29,0)
 ; Otherwise, zero is returned in the RESULTS(0).
"RTN","RORRP034",30,0)
 ;
"RTN","RORRP034",31,0)
SAVE(RESULTS,REGIEN,PTIEN,CANCEL,DATA) ;
"RTN","RORRP034",32,0)
 N IENS,LOCK,RC,RORERRDL
"RTN","RORRP034",33,0)
 D CLEAR^RORERR("SAVE^RORRP034",1)
"RTN","RORRP034",34,0)
 K RESULTS  S (RESULTS(0),RC)=0
"RTN","RORRP034",35,0)
 D
"RTN","RORRP034",36,0)
 . ;--- Registry IEN
"RTN","RORRP034",37,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP034",38,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP034",39,0)
 . S REGIEN=+REGIEN
"RTN","RORRP034",40,0)
 . ;--- Patient IEN
"RTN","RORRP034",41,0)
 . I $G(PTIEN)'>0  D  Q
"RTN","RORRP034",42,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"PTIEN",$G(PTIEN))
"RTN","RORRP034",43,0)
 . S PTIEN=+PTIEN
"RTN","RORRP034",44,0)
 . ;--- Get the IENS of the registry record
"RTN","RORRP034",45,0)
 . S IENS=$$PRRIEN^RORUTL01(PTIEN,REGIEN)_","
"RTN","RORRP034",46,0)
 . S:IENS>0 (LOCK(798,IENS),LOCK(799.4,IENS))=""
"RTN","RORRP034",47,0)
 . Q:$G(CANCEL)
"RTN","RORRP034",48,0)
 . ;--- Save the data
"RTN","RORRP034",49,0)
 . S RC=$$SAVE1(.IENS)
"RTN","RORRP034",50,0)
 . I '$D(LOCK)  S:IENS>0 (LOCK(798,IENS),LOCK(799.4,IENS))=""
"RTN","RORRP034",51,0)
 . S:RC>0 RESULTS(0)=RC
"RTN","RORRP034",52,0)
 ;
"RTN","RORRP034",53,0)
 ;--- Do not unlock the records if there are errors in the data
"RTN","RORRP034",54,0)
 ;    (positive value is returned by the $$SAVE1), since the user
"RTN","RORRP034",55,0)
 ;--- will have another chance to correct the data and save it.
"RTN","RORRP034",56,0)
 D:RC'>0 UNLOCK^RORLOCK(.LOCK)
"RTN","RORRP034",57,0)
 D:RC<0 RPCSTK^RORERR(.RESULTS,RC)
"RTN","RORRP034",58,0)
 Q
"RTN","RORRP034",59,0)
 ;
"RTN","RORRP034",60,0)
 ;***** INTERNAL ENTRY POINT THAT UPDATES THE REGISTRY DATA
"RTN","RORRP034",61,0)
SAVE1(IENS798) ;
"RTN","RORRP034",62,0)
 N IENS,LFIEN,LFV,RC,RDI,REGNAME,RORFDA,RORMSG,SEG,TMP
"RTN","RORRP034",63,0)
 ;
"RTN","RORRP034",64,0)
 ;=== Add the patient to the registry if necessary
"RTN","RORRP034",65,0)
 I IENS798'>0  S RC=0  D  Q:RC<0 RC
"RTN","RORRP034",66,0)
 . S REGNAME=$P($$REGNAME^RORUTL01(REGIEN),U)
"RTN","RORRP034",67,0)
 . ;--- Add the patient to the registry
"RTN","RORRP034",68,0)
 . S RC=$$ADDPAT^RORUPD06(PTIEN,REGNAME)  Q:RC<0
"RTN","RORRP034",69,0)
 . ;--- Get the IENS of the registry record
"RTN","RORRP034",70,0)
 . S IENS798=$$PRRIEN^RORUTL01(PTIEN,REGIEN)_","
"RTN","RORRP034",71,0)
 . S:IENS798'>0 RC=$$ERROR^RORERR(-97,,,PTIEN,REGNAME)
"RTN","RORRP034",72,0)
 ;
"RTN","RORRP034",73,0)
 ;=== Prepare the data
"RTN","RORRP034",74,0)
 S (LFCNT,RDI,RC)=0
"RTN","RORRP034",75,0)
 F  S RDI=$O(DATA(RDI))  Q:RDI'>0  D  Q:RC
"RTN","RORRP034",76,0)
 . S SEG=$P(DATA(RDI),U)
"RTN","RORRP034",77,0)
 . ;--- Risk factors
"RTN","RORRP034",78,0)
 . I SEG="PH"  D  Q
"RTN","RORRP034",79,0)
 . . S RC=$$CDCFDA^RORRP026(IENS798,"PH^RORRP026",DATA(RDI),.RORFDA)
"RTN","RORRP034",80,0)
 . ;--- Registry data
"RTN","RORRP034",81,0)
 . I SEG="ICR"  D  Q
"RTN","RORRP034",82,0)
 . . S TMP=$P(DATA(RDI),U,3)
"RTN","RORRP034",83,0)
 . . S RORFDA(799.4,IENS798,.02)=TMP
"RTN","RORRP034",84,0)
 . . S RORFDA(799.4,IENS798,.03)=$S(TMP:$P(DATA(RDI),U,4),1:"")
"RTN","RORRP034",85,0)
 . ;--- Local field values
"RTN","RORRP034",86,0)
 . I SEG="LFV"  D  Q
"RTN","RORRP034",87,0)
 . . S LFIEN=+$P(DATA(RDI),U,3)
"RTN","RORRP034",88,0)
 . . S:LFIEN>0 LFV(LFIEN)=DATA(RDI)
"RTN","RORRP034",89,0)
 Q:RC RC
"RTN","RORRP034",90,0)
 ;
"RTN","RORRP034",91,0)
 ;=== Confirm the pending patient
"RTN","RORRP034",92,0)
 D:$$GET1^DIQ(798,IENS798,3,"I",,"RORMSG")=4
"RTN","RORRP034",93,0)
 . ;--- Do not clear the DON'T SEND flag for 'test' patients
"RTN","RORRP034",94,0)
 . S:'$$TESTPAT^RORUTL01(PTIEN) RORFDA(798,IENS798,11)="@"
"RTN","RORRP034",95,0)
 . ;--- Change the STATUS from 'Pending' to 'Active'
"RTN","RORRP034",96,0)
 . S RORFDA(798,IENS798,3)=0
"RTN","RORRP034",97,0)
 ;
"RTN","RORRP034",98,0)
 ;=== Update the local fields
"RTN","RORRP034",99,0)
 I $D(LFV)>1  D  Q:RC<0 RC
"RTN","RORRP034",100,0)
 . S RORFDA(798,IENS798,5)=1  ; UPDATE LOCAL REGISTRY DATA
"RTN","RORRP034",101,0)
 . S RC=$$UPDLFV^RORUTL19(IENS798,.LFV)
"RTN","RORRP034",102,0)
 ;
"RTN","RORRP034",103,0)
 ;=== Update the record(s)
"RTN","RORRP034",104,0)
 I $D(RORFDA)>1  D  Q:RC<0 RC
"RTN","RORRP034",105,0)
 . S RORFDA(798,IENS798,5)=1  ; UPDATE LOCAL REGISTRY DATA
"RTN","RORRP034",106,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORRP034",107,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,PTIEN,"798&799.4",IENS798)
"RTN","RORRP034",108,0)
 ;
"RTN","RORRP034",109,0)
 ;=== Success
"RTN","RORRP034",110,0)
 Q 0
"RTN","RORRP035")
0^14^B5557216
"RTN","RORRP035",1,0)
RORRP035 ;HCIOFO/SG - RPC: GENERIC DRUG NAMES ; 10/18/05 12:10pm
"RTN","RORRP035",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP035",3,0)
 ;
"RTN","RORRP035",4,0)
 Q
"RTN","RORRP035",5,0)
 ;
"RTN","RORRP035",6,0)
 ;***** RETURNS THE LIST OF GENERIC DRUGS
"RTN","RORRP035",7,0)
 ; RPC: [ROR LIST GENERIC DRUGS]
"RTN","RORRP035",8,0)
 ;
"RTN","RORRP035",9,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP035",10,0)
 ;               are returned to.
"RTN","RORRP035",11,0)
 ;
"RTN","RORRP035",12,0)
 ; REGIEN        Registry IEN
"RTN","RORRP035",13,0)
 ;
"RTN","RORRP035",14,0)
 ; [GROUP]       Code of the Drug Group. If this parameter is
"RTN","RORRP035",15,0)
 ;               defined and greater than zero then only the drugs
"RTN","RORRP035",16,0)
 ;               associated with this group will be returned.
"RTN","RORRP035",17,0)
 ;
"RTN","RORRP035",18,0)
 ; The ^TMP("DILIST",$J) global node is used by the procedure.
"RTN","RORRP035",19,0)
 ;
"RTN","RORRP035",20,0)
 ; Return Values:
"RTN","RORRP035",21,0)
 ;
"RTN","RORRP035",22,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP035",23,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP035",24,0)
 ; details).
"RTN","RORRP035",25,0)
 ;
"RTN","RORRP035",26,0)
 ; Otherwise, number of drugs is returned in the @RESULTS@(0) and
"RTN","RORRP035",27,0)
 ; the subsequent nodes of the global array contain the drugs.
"RTN","RORRP035",28,0)
 ; 
"RTN","RORRP035",29,0)
 ; @RESULTS@(0)          Number of Local Drugs
"RTN","RORRP035",30,0)
 ;
"RTN","RORRP035",31,0)
 ; @RESULTS@(i)          Drug Descriptor
"RTN","RORRP035",32,0)
 ;                         ^01: IEN in the ROR GENERIC DRUG file
"RTN","RORRP035",33,0)
 ;                         ^02: Generic drug name
"RTN","RORRP035",34,0)
 ;                         ^03: IEN of the generic drug (file #50.6)
"RTN","RORRP035",35,0)
 ;                         ^04: Code of the Drug Group
"RTN","RORRP035",36,0)
 ;
"RTN","RORRP035",37,0)
GDLIST(RESULTS,REGIEN,GROUP) ;
"RTN","RORRP035",38,0)
 N GROUPIEN,IENS,IR,PART,RC,RORERRDL,RORMSG,SCR,TMP
"RTN","RORRP035",39,0)
 D CLEAR^RORERR("GDLIST^RORRP032",1)
"RTN","RORRP035",40,0)
 K RESULTS  S RESULTS=$NA(^TMP("DILIST",$J))  K @RESULTS
"RTN","RORRP035",41,0)
 ;
"RTN","RORRP035",42,0)
 ;--- Check the parameters
"RTN","RORRP035",43,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP035",44,0)
 . ;--- Registry IEN
"RTN","RORRP035",45,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP035",46,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP035",47,0)
 . S REGIEN=+REGIEN
"RTN","RORRP035",48,0)
 . ;--- Code of the Drug Group
"RTN","RORRP035",49,0)
 . S GROUP=+$G(GROUP)
"RTN","RORRP035",50,0)
 . S GROUPIEN=$S(GROUP>0:$$ITEMIEN^RORUTL09(4,REGIEN,GROUP),1:0)
"RTN","RORRP035",51,0)
 . I GROUPIEN<0  D  Q
"RTN","RORRP035",52,0)
 . . S RC=$$ERROR^RORERR(GROUPIEN)
"RTN","RORRP035",53,0)
 ;
"RTN","RORRP035",54,0)
 ;--- Compile the screen logic  (be careful with naked references)
"RTN","RORRP035",55,0)
 S SCR=""
"RTN","RORRP035",56,0)
 S:GROUPIEN>0 SCR=SCR_"I $P($G(^(0)),U,3)="_GROUPIEN_" "
"RTN","RORRP035",57,0)
 ;--- Get the list of drugs
"RTN","RORRP035",58,0)
 S TMP="@;.04E;.04I;.03I",PART(1)=REGIEN_"#"
"RTN","RORRP035",59,0)
 D LIST^DIC(799.51,,TMP,"PU",,,.PART,"ARDG",SCR,,,"RORMSG")
"RTN","RORRP035",60,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP035",61,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,799.51)
"RTN","RORRP035",62,0)
 ;
"RTN","RORRP035",63,0)
 ;--- Replace the group IEN's with the group code(s)
"RTN","RORRP035",64,0)
 S (IR,RC)=0
"RTN","RORRP035",65,0)
 F  S IR=$O(@RESULTS@(IR))  Q:IR'>0  D  Q:RC<0
"RTN","RORRP035",66,0)
 . I GROUPIEN>0  S $P(@RESULTS@(IR,0),U,4)=GROUP  Q
"RTN","RORRP035",67,0)
 . S TMP=+$P(@RESULTS@(IR,0),U,4)
"RTN","RORRP035",68,0)
 . I TMP'>0  S $P(@RESULTS@(IR,0),U,4)=""  Q
"RTN","RORRP035",69,0)
 . S RC=$$ITEMCODE^RORUTL09(TMP)
"RTN","RORRP035",70,0)
 . S:RC>0 $P(@RESULTS@(IR,0),U,4)=RC
"RTN","RORRP035",71,0)
 I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP035",72,0)
 ;--- Success
"RTN","RORRP035",73,0)
 S TMP=+$G(^TMP("DILIST",$J,0))
"RTN","RORRP035",74,0)
 K ^TMP("DILIST",$J,0)  S @RESULTS@(0)=TMP
"RTN","RORRP035",75,0)
 Q
"RTN","RORRP036")
0^2^B9045878
"RTN","RORRP036",1,0)
RORRP036 ;HCIOFO/SG - RPC: HEPC PATIENT LOAD ; 10/27/05 2:39pm
"RTN","RORRP036",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP036",3,0)
 ;
"RTN","RORRP036",4,0)
 Q
"RTN","RORRP036",5,0)
 ;
"RTN","RORRP036",6,0)
 ;***** PROCESSES THE ERROR(S) AND UNLOCKS THE RECORDS
"RTN","RORRP036",7,0)
ERROR(RESULTS,RC) ;
"RTN","RORRP036",8,0)
 D RPCSTK^RORERR(.RESULTS,RC)
"RTN","RORRP036",9,0)
 D UNLOCK^RORLOCK(.RORLOCK)
"RTN","RORRP036",10,0)
 Q
"RTN","RORRP036",11,0)
 ;
"RTN","RORRP036",12,0)
 ;***** LOADS THE PATIENT'S DATA FOR EDITING
"RTN","RORRP036",13,0)
 ; RPC: [RORHEPC PATIENT LOAD]
"RTN","RORRP036",14,0)
 ;
"RTN","RORRP036",15,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP036",16,0)
 ;               are returned to.
"RTN","RORRP036",17,0)
 ;
"RTN","RORRP036",18,0)
 ; REGIEN        Registry IEN
"RTN","RORRP036",19,0)
 ;
"RTN","RORRP036",20,0)
 ; PATIEN        IEN of the registry patient (DFN)
"RTN","RORRP036",21,0)
 ;
"RTN","RORRP036",22,0)
 ; [LOCK]        Lock the registry record before loading the data and
"RTN","RORRP036",23,0)
 ;               leave it locked.
"RTN","RORRP036",24,0)
 ;
"RTN","RORRP036",25,0)
 ; Return Values:
"RTN","RORRP036",26,0)
 ;
"RTN","RORRP036",27,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP036",28,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP036",29,0)
 ; details).
"RTN","RORRP036",30,0)
 ;
"RTN","RORRP036",31,0)
 ; If locking was requested (see the LOCK parameter) and the record
"RTN","RORRP036",32,0)
 ; could not be locked then the first "^"-piece of the @RESULTS@(0)
"RTN","RORRP036",33,0)
 ; would be greater than 0. The @RESULTS@(0) would contain the lock
"RTN","RORRP036",34,0)
 ; descriptor and subsequent nodes of the global array would contain
"RTN","RORRP036",35,0)
 ; the data (see below). The lock descriptor contains information
"RTN","RORRP036",36,0)
 ; about the process, which owns the most recent lock of the record.
"RTN","RORRP036",37,0)
 ; The "O" flag (read-only) would also be added to the 15th field
"RTN","RORRP036",38,0)
 ; of the "PRD" segment.
"RTN","RORRP036",39,0)
 ;
"RTN","RORRP036",40,0)
 ; @RESULTS@(0)          Lock Descriptor
"RTN","RORRP036",41,0)
 ;                         ^01: Date/Time (FileMan)
"RTN","RORRP036",42,0)
 ;                         ^02: User/Process name
"RTN","RORRP036",43,0)
 ;                         ^03: User IEN (DUZ)
"RTN","RORRP036",44,0)
 ;                         ^04: $JOB
"RTN","RORRP036",45,0)
 ;                         ^05: Task number
"RTN","RORRP036",46,0)
 ;
"RTN","RORRP036",47,0)
 ; THE DATA IS LOADED ONLY FOR VIEWING PURPOSES (READ-ONLY)!
"RTN","RORRP036",48,0)
 ;
"RTN","RORRP036",49,0)
 ; Otherwise, zero is returned in the @RESULTS@(0) and the
"RTN","RORRP036",50,0)
 ; subsequent nodes of the global array contain the patient's data.
"RTN","RORRP036",51,0)
 ; 
"RTN","RORRP036",52,0)
 ; @RESULTS@(0)          0
"RTN","RORRP036",53,0)
 ;
"RTN","RORRP036",54,0)
 ; @RESULTS@(i)          Demographic data
"RTN","RORRP036",55,0)
 ;                         ^01: "DEM"
"RTN","RORRP036",56,0)
 ;                         ^02: ""
"RTN","RORRP036",57,0)
 ;                         ...  See description of the ROR PATIENT
"RTN","RORRP036",58,0)
 ;                              GET DATA remote procedure
"RTN","RORRP036",59,0)
 ;
"RTN","RORRP036",60,0)
 ; @RESULTS@(i)          Basic registry data
"RTN","RORRP036",61,0)
 ;                         ^01: "PRD"
"RTN","RORRP036",62,0)
 ;                         ^02: ""
"RTN","RORRP036",63,0)
 ;                         ...  See description of the ROR PATIENT
"RTN","RORRP036",64,0)
 ;                              GET DATA remote procedure
"RTN","RORRP036",65,0)
 ;
"RTN","RORRP036",66,0)
 ; RESULTS(i)            Local field data
"RTN","RORRP036",67,0)
 ;                         ^O1: "LFV"
"RTN","RORRP036",68,0)
 ;                         ...  See description of the ROR PATIENT
"RTN","RORRP036",69,0)
 ;                              GET DATA remote procedure
"RTN","RORRP036",70,0)
 ;
"RTN","RORRP036",71,0)
 ; RESULTS(i)            Selection Rule
"RTN","RORRP036",72,0)
 ;                         ^01: "PSR"
"RTN","RORRP036",73,0)
 ;                         ...  See description of the ROR PATIENT
"RTN","RORRP036",74,0)
 ;                              GET DATA remote procedure
"RTN","RORRP036",75,0)
 ;
"RTN","RORRP036",76,0)
LOAD(RESULTS,REGIEN,PATIEN,LOCK) ;
"RTN","RORRP036",77,0)
 N HEPCBUF,I,IENS,LOCKRC,RC,RESPTR,RORBUF,RORERRDL,RORLOCK,RORMSG,TMP
"RTN","RORRP036",78,0)
 D CLEAR^RORERR("LOAD^RORRP036",1)
"RTN","RORRP036",79,0)
 K RESULTS  S RESULTS=$$ALLOC^RORTMP()
"RTN","RORRP036",80,0)
 S HEPCBUF="HEPC",LOCKRC=0
"RTN","RORRP036",81,0)
 ;=== Check the parameters
"RTN","RORRP036",82,0)
 S RC=0  D  I RC<0  D ERROR(.RESULTS,RC)  Q
"RTN","RORRP036",83,0)
 . ;--- Registry IEN
"RTN","RORRP036",84,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP036",85,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP036",86,0)
 . S REGIEN=+REGIEN
"RTN","RORRP036",87,0)
 . ;--- Patient IEN
"RTN","RORRP036",88,0)
 . I $G(PATIEN)'>0  D  Q
"RTN","RORRP036",89,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"PATIEN",$G(PATIEN))
"RTN","RORRP036",90,0)
 . S PATIEN=+PATIEN
"RTN","RORRP036",91,0)
 ;
"RTN","RORRP036",92,0)
 ;=== Get the IENS of the registry record
"RTN","RORRP036",93,0)
 S IENS=$$PRRIEN^RORUTL01(PATIEN,REGIEN)_","
"RTN","RORRP036",94,0)
 ;
"RTN","RORRP036",95,0)
 ;=== Lock the record
"RTN","RORRP036",96,0)
 I $G(LOCK),IENS>0  D  I LOCKRC<0  D ERROR(.RESULTS,+LOCKRC)  Q
"RTN","RORRP036",97,0)
 . S LOCKRC=$$LOCK^RORLOCK(798,IENS)
"RTN","RORRP036",98,0)
 ;
"RTN","RORRP036",99,0)
 ;=== Get the patient's data
"RTN","RORRP036",100,0)
 D GETPTDAT^RORRP021(.RORBUF,PATIEN,"LS",REGIEN)
"RTN","RORRP036",101,0)
 I $G(RORBUF(0))<0  D ERROR(.RESULTS,+RORBUF(0))  Q
"RTN","RORRP036",102,0)
 ;---
"RTN","RORRP036",103,0)
 S I=""
"RTN","RORRP036",104,0)
 F  S I=$O(RORBUF(I))  Q:I=""  Q:$P(RORBUF(I),U)="PRD"
"RTN","RORRP036",105,0)
 D:I'=""
"RTN","RORRP036",106,0)
 . S TMP=$P(RORBUF(I),U,15)
"RTN","RORRP036",107,0)
 . I TMP'["O"  S:LOCKRC $P(RORBUF(I),U,15)=TMP_"O" ; Read Only
"RTN","RORRP036",108,0)
 . E  D UNLOCK^RORLOCK(.RORLOCK)  S LOCKRC=0
"RTN","RORRP036",109,0)
 ;---
"RTN","RORRP036",110,0)
 M @RESULTS=RORBUF  S RESPTR=$O(RORBUF(""),-1)
"RTN","RORRP036",111,0)
 K RORBUF
"RTN","RORRP036",112,0)
 ;
"RTN","RORRP036",113,0)
 ;=== Load the HepC data
"RTN","RORRP036",114,0)
 I IENS>0  S RC=0  D  I RC<0  D ERROR(.RESULTS,RC)  Q
"RTN","RORRP036",115,0)
 . Q:$D(^RORDATA(798,+IENS))<10
"RTN","RORRP036",116,0)
 . ; Insert code here if/when necessary
"RTN","RORRP036",117,0)
 ;
"RTN","RORRP036",118,0)
 ;===
"RTN","RORRP036",119,0)
 S RESPTR=RESPTR+1,@RESULTS@(RESPTR)=HEPCBUF
"RTN","RORRP036",120,0)
 S @RESULTS@(0)=LOCKRC
"RTN","RORRP036",121,0)
 Q
"RTN","RORRP037")
0^3^B11590629
"RTN","RORRP037",1,0)
RORRP037 ;HCIOFO/SG - RPC: HEPC PATIENT SAVE/CANCEL ; 11/29/05 8:50am
"RTN","RORRP037",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP037",3,0)
 ;
"RTN","RORRP037",4,0)
 Q
"RTN","RORRP037",5,0)
 ;
"RTN","RORRP037",6,0)
 ;***** UPDATES THE PATIENT'S REGISTRY DATA
"RTN","RORRP037",7,0)
 ; RPC: [RORHEPC PATIENT SAVE]
"RTN","RORRP037",8,0)
 ;
"RTN","RORRP037",9,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP037",10,0)
 ;               are returned to.
"RTN","RORRP037",11,0)
 ;
"RTN","RORRP037",12,0)
 ; REGIEN        Registry IEN
"RTN","RORRP037",13,0)
 ;
"RTN","RORRP037",14,0)
 ; PTIEN         IEN of the registry patient (DFN)
"RTN","RORRP037",15,0)
 ;
"RTN","RORRP037",16,0)
 ; [CANCEL]      Cancel the update and unlock the registry data
"RTN","RORRP037",17,0)
 ;
"RTN","RORRP037",18,0)
 ; .DATA         Reference to a local array that contains the data
"RTN","RORRP037",19,0)
 ;               in the same format as the output of the RORHEPC
"RTN","RORRP037",20,0)
 ;               PATIENT LOAD remote procedure. Only HEPC and LFV
"RTN","RORRP037",21,0)
 ;               segments are processed; the others are ignored.
"RTN","RORRP037",22,0)
 ;
"RTN","RORRP037",23,0)
 ; Return Values:
"RTN","RORRP037",24,0)
 ;
"RTN","RORRP037",25,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP037",26,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP037",27,0)
 ; details).
"RTN","RORRP037",28,0)
 ;
"RTN","RORRP037",29,0)
 ; Otherwise, zero is returned in the RESULTS(0).
"RTN","RORRP037",30,0)
 ;
"RTN","RORRP037",31,0)
SAVE(RESULTS,REGIEN,PTIEN,CANCEL,DATA) ;
"RTN","RORRP037",32,0)
 N IENS,LOCK,RC,RORERRDL
"RTN","RORRP037",33,0)
 D CLEAR^RORERR("SAVE^RORRP037",1)
"RTN","RORRP037",34,0)
 K RESULTS  S (RESULTS(0),RC)=0
"RTN","RORRP037",35,0)
 D
"RTN","RORRP037",36,0)
 . ;--- Registry IEN
"RTN","RORRP037",37,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP037",38,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP037",39,0)
 . S REGIEN=+REGIEN
"RTN","RORRP037",40,0)
 . ;--- Patient IEN
"RTN","RORRP037",41,0)
 . I $G(PTIEN)'>0  D  Q
"RTN","RORRP037",42,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"PTIEN",$G(PTIEN))
"RTN","RORRP037",43,0)
 . S PTIEN=+PTIEN
"RTN","RORRP037",44,0)
 . ;--- Get the IENS of the registry record
"RTN","RORRP037",45,0)
 . S IENS=$$PRRIEN^RORUTL01(PTIEN,REGIEN)_","
"RTN","RORRP037",46,0)
 . S:IENS>0 LOCK(798,IENS)=""
"RTN","RORRP037",47,0)
 . Q:$G(CANCEL)
"RTN","RORRP037",48,0)
 . ;--- Save the data
"RTN","RORRP037",49,0)
 . S RC=$$SAVE1(.IENS)
"RTN","RORRP037",50,0)
 . I '$D(LOCK)  S:IENS>0 LOCK(798,IENS)=""
"RTN","RORRP037",51,0)
 . S:RC>0 RESULTS(0)=RC
"RTN","RORRP037",52,0)
 ;
"RTN","RORRP037",53,0)
 ;--- Do not unlock the records if there are errors in the data
"RTN","RORRP037",54,0)
 ;    (positive value is returned by the $$SAVE1), since the user
"RTN","RORRP037",55,0)
 ;--- will have another chance to correct the data and save it.
"RTN","RORRP037",56,0)
 D:RC'>0 UNLOCK^RORLOCK(.LOCK)
"RTN","RORRP037",57,0)
 D:RC<0 RPCSTK^RORERR(.RESULTS,RC)
"RTN","RORRP037",58,0)
 Q
"RTN","RORRP037",59,0)
 ;
"RTN","RORRP037",60,0)
 ;***** INTERNAL ENTRY POINT THAT UPDATES THE REGISTRY DATA
"RTN","RORRP037",61,0)
 ;
"RTN","RORRP037",62,0)
 ; IENS798       IENS of the registry record in the file #798
"RTN","RORRP037",63,0)
 ;
"RTN","RORRP037",64,0)
 ; Return Values:
"RTN","RORRP037",65,0)
 ;       <0  Error code
"RTN","RORRP037",66,0)
 ;        0  Ok
"RTN","RORRP037",67,0)
 ;
"RTN","RORRP037",68,0)
SAVE1(IENS798) ;
"RTN","RORRP037",69,0)
 N IENS,LFIEN,LFV,RC,RDI,REGNAME,RORFDA,RORMSG,SEG,TMP
"RTN","RORRP037",70,0)
 ;
"RTN","RORRP037",71,0)
 ;=== Add the patient to the registry if necessary
"RTN","RORRP037",72,0)
 I IENS798'>0  S RC=0  D  Q:RC<0 RC
"RTN","RORRP037",73,0)
 . S REGNAME=$P($$REGNAME^RORUTL01(REGIEN),U)
"RTN","RORRP037",74,0)
 . ;--- Add the patient to the registry
"RTN","RORRP037",75,0)
 . S RC=$$ADDPAT^RORUPD06(PTIEN,REGNAME)  Q:RC<0
"RTN","RORRP037",76,0)
 . ;--- Get the IENS of the registry record
"RTN","RORRP037",77,0)
 . S IENS798=$$PRRIEN^RORUTL01(PTIEN,REGIEN)_","
"RTN","RORRP037",78,0)
 . S:IENS798'>0 RC=$$ERROR^RORERR(-97,,,PTIEN,REGNAME)
"RTN","RORRP037",79,0)
 ;
"RTN","RORRP037",80,0)
 ;=== Prepare the data
"RTN","RORRP037",81,0)
 S (LFCNT,RDI,RC)=0
"RTN","RORRP037",82,0)
 F  S RDI=$O(DATA(RDI))  Q:RDI'>0  D  Q:RC
"RTN","RORRP037",83,0)
 . S SEG=$P(DATA(RDI),U)
"RTN","RORRP037",84,0)
 . ;--- Registry data
"RTN","RORRP037",85,0)
 . I SEG="ICR"  D  Q
"RTN","RORRP037",86,0)
 . . ; Insert code here if/when necessary
"RTN","RORRP037",87,0)
 . ;--- Local field values
"RTN","RORRP037",88,0)
 . I SEG="LFV"  D  Q
"RTN","RORRP037",89,0)
 . . S LFIEN=+$P(DATA(RDI),U,3)
"RTN","RORRP037",90,0)
 . . S:LFIEN>0 LFV(LFIEN)=DATA(RDI)
"RTN","RORRP037",91,0)
 Q:RC RC
"RTN","RORRP037",92,0)
 ;
"RTN","RORRP037",93,0)
 ;=== Confirm the pending patient
"RTN","RORRP037",94,0)
 D:$$GET1^DIQ(798,IENS798,3,"I",,"RORMSG")=4
"RTN","RORRP037",95,0)
 . ;--- Do not clear the DON'T SEND flag for 'test' patients
"RTN","RORRP037",96,0)
 . S:'$$TESTPAT^RORUTL01(PTIEN) RORFDA(798,IENS798,11)="@"
"RTN","RORRP037",97,0)
 . ;--- Change the STATUS from 'Pending' to 'Active'
"RTN","RORRP037",98,0)
 . S RORFDA(798,IENS798,3)=0
"RTN","RORRP037",99,0)
 ;
"RTN","RORRP037",100,0)
 ;=== Update the local fields
"RTN","RORRP037",101,0)
 I $D(LFV)>1  D  Q:RC<0 RC
"RTN","RORRP037",102,0)
 . S RORFDA(798,IENS798,5)=1  ; UPDATE LOCAL REGISTRY DATA
"RTN","RORRP037",103,0)
 . S RC=$$UPDLFV^RORUTL19(IENS798,.LFV)
"RTN","RORRP037",104,0)
 ;
"RTN","RORRP037",105,0)
 ;=== Update the record(s)
"RTN","RORRP037",106,0)
 I $D(RORFDA)>1  D  Q:RC<0 RC
"RTN","RORRP037",107,0)
 . S RORFDA(798,IENS798,5)=1  ; UPDATE LOCAL REGISTRY DATA
"RTN","RORRP037",108,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORRP037",109,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,PTIEN,798,IENS798)
"RTN","RORRP037",110,0)
 ;
"RTN","RORRP037",111,0)
 ;=== Success
"RTN","RORRP037",112,0)
 Q 0
"RTN","RORRP038")
0^11^B24551181
"RTN","RORRP038",1,0)
RORRP038 ;HCIOFO/SG - RPC: USER AND PACKAGE PARAMETERS ; 11/21/05 9:28am
"RTN","RORRP038",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP038",3,0)
 ;
"RTN","RORRP038",4,0)
 ; This routine uses the following IA's:
"RTN","RORRP038",5,0)
 ;
"RTN","RORRP038",6,0)
 ; #2263         GETWP^XPAR and PUT^XPAR (supported)
"RTN","RORRP038",7,0)
 ;
"RTN","RORRP038",8,0)
 Q
"RTN","RORRP038",9,0)
 ;
"RTN","RORRP038",10,0)
 ;***** RETRIEVES THE VALUE OF THE GUI PARAMETER
"RTN","RORRP038",11,0)
 ; RPC: [ROR GUI PARAMETER GET]
"RTN","RORRP038",12,0)
 ;
"RTN","RORRP038",13,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP038",14,0)
 ;               are returned to.
"RTN","RORRP038",15,0)
 ;
"RTN","RORRP038",16,0)
 ; INSTANCE      Instance name of the GUI parameter.
"RTN","RORRP038",17,0)
 ;               Optional second "^"-piece of this parameter can
"RTN","RORRP038",18,0)
 ;               contain name of the parameter. By default, the
"RTN","RORRP038",19,0)
 ;               "ROR GUI PARAMETER" is used.
"RTN","RORRP038",20,0)
 ;
"RTN","RORRP038",21,0)
 ; [ENTITY]      Entity where the parameter value is searched for.
"RTN","RORRP038",22,0)
 ;               By default ($G(ENTITY)=""), the "ALL" value is used
"RTN","RORRP038",23,0)
 ;               (see the DBIA #2263 for more details).
"RTN","RORRP038",24,0)
 ;
"RTN","RORRP038",25,0)
 ; Return Values:
"RTN","RORRP038",26,0)
 ;
"RTN","RORRP038",27,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP038",28,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP038",29,0)
 ;
"RTN","RORRP038",30,0)
 ; Otherwise, the RESULTS(0) will contain 0 and the subsequent nodes
"RTN","RORRP038",31,0)
 ; of the RESULTS array will contain the lines of parameter value.
"RTN","RORRP038",32,0)
 ;
"RTN","RORRP038",33,0)
GETPARM(RESULTS,INSTANCE,ENTITY) ;
"RTN","RORRP038",34,0)
 N CNT,I,RC,RORBUF,RORERRDL,RORMSG  K RESULTS
"RTN","RORRP038",35,0)
 D CLEAR^RORERR("GETPARM^RORRP038",1)
"RTN","RORRP038",36,0)
 ;--- Check the parameters
"RTN","RORRP038",37,0)
 I $G(INSTANCE)=""  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP038",38,0)
 . S RC=$$ERROR^RORERR(-88,,,,"INSTANCE",$G(INSTANCE))
"RTN","RORRP038",39,0)
 S:$G(ENTITY)="" ENTITY="ALL"
"RTN","RORRP038",40,0)
 S NAME=$P(INSTANCE,U,2)
"RTN","RORRP038",41,0)
 S:$G(NAME)="" NAME="ROR GUI PARAMETER"
"RTN","RORRP038",42,0)
 ;--- Get the value
"RTN","RORRP038",43,0)
 D GETWP^XPAR(.RORBUF,ENTITY,NAME,$P(INSTANCE,U),.RORMSG)
"RTN","RORRP038",44,0)
 I $G(RORMSG)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP038",45,0)
 . S RC=$$ERROR^RORERR(-56,,$P(RORMSG,U,2),,+RORMSG,"GETWP^XPAR")
"RTN","RORRP038",46,0)
 S RESULTS(0)=0
"RTN","RORRP038",47,0)
 ;--- Ignore and delete old parameters without description.
"RTN","RORRP038",48,0)
 ;    These parameters were created by the CCR v1.0.
"RTN","RORRP038",49,0)
 ;--- Unfortunately, the ENVAL^XPAR procedure ignores them.
"RTN","RORRP038",50,0)
 I $G(RORBUF)=""  D DEL^XPAR(ENTITY,NAME,$P(INSTANCE,U))  Q
"RTN","RORRP038",51,0)
 ;--- Copy the value to the output array
"RTN","RORRP038",52,0)
 S I="",CNT=0
"RTN","RORRP038",53,0)
 F  S I=$O(RORBUF(I))  Q:I=""  D
"RTN","RORRP038",54,0)
 . S CNT=CNT+1,RESULTS(CNT)=RORBUF(I,0)  K RORBUF(I)
"RTN","RORRP038",55,0)
 Q
"RTN","RORRP038",56,0)
 ;
"RTN","RORRP038",57,0)
 ;***** RETRIEVES THE LIST OF ALL INSTANCES OF THE PARAMETER
"RTN","RORRP038",58,0)
 ; RPC: [ROR LIST PARAMETER INSTANCES]
"RTN","RORRP038",59,0)
 ;
"RTN","RORRP038",60,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP038",61,0)
 ;               are returned to.
"RTN","RORRP038",62,0)
 ;
"RTN","RORRP038",63,0)
 ; [NAME]        Name of the parameter (by default, the
"RTN","RORRP038",64,0)
 ;               "ROR GUI PARAMETER" is used)
"RTN","RORRP038",65,0)
 ;
"RTN","RORRP038",66,0)
 ; [ENTITY]      Entity where the parameters are searched for.
"RTN","RORRP038",67,0)
 ;               By default ($G(ENTITY)=""), the "ALL" value is used
"RTN","RORRP038",68,0)
 ;               (see the DBIA #2263 for more details).
"RTN","RORRP038",69,0)
 ;
"RTN","RORRP038",70,0)
 ; [PREFIX]      Instance name prefix (by default, all instances
"RTN","RORRP038",71,0)
 ;               are selected). Bear in mind that the prefix is
"RTN","RORRP038",72,0)
 ;               removed from the instance names.
"RTN","RORRP038",73,0)
 ;
"RTN","RORRP038",74,0)
GETPLIST(RESULTS,NAME,ENTITY,PREFIX) ;
"RTN","RORRP038",75,0)
 N CNT,I,LP,RC,RORBUF,RORERRDL,RORMSG  K RESULTS
"RTN","RORRP038",76,0)
 D CLEAR^RORERR("GETRPLST^RORRP038",1)
"RTN","RORRP038",77,0)
 S:$G(NAME)="" NAME="ROR GUI PARAMETER"
"RTN","RORRP038",78,0)
 S:$G(ENTITY)="" ENTITY="ALL"
"RTN","RORRP038",79,0)
 S:$G(PREFIX)="" PREFIX=""
"RTN","RORRP038",80,0)
 D GETLST^XPAR(.RESULTS,ENTITY,NAME,"Q")
"RTN","RORRP038",81,0)
 I $G(RORMSG)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP038",82,0)
 . S RC=$$ERROR^RORERR(-56,,$P(RORMSG,U,2),,+RORMSG,"GETLST^XPAR")
"RTN","RORRP038",83,0)
 ;--- Screen unwanted instances and strip the prefixes
"RTN","RORRP038",84,0)
 S LP=$L(PREFIX)
"RTN","RORRP038",85,0)
 I LP>0  S (CNT,I)=0  D
"RTN","RORRP038",86,0)
 . F  S I=$O(RESULTS(I))  Q:I=""  D
"RTN","RORRP038",87,0)
 . . I $E(RESULTS(I),1,LP)'=PREFIX  K RESULTS(I)  Q
"RTN","RORRP038",88,0)
 . . S RESULTS(I)=$E(RESULTS(I),LP+1,999),CNT=CNT+1
"RTN","RORRP038",89,0)
 E  S CNT=+$G(RESULTS)
"RTN","RORRP038",90,0)
 ;--- Store the total number of instances
"RTN","RORRP038",91,0)
 S RESULTS(0)=CNT,RESULTS=""
"RTN","RORRP038",92,0)
 Q
"RTN","RORRP038",93,0)
 ;
"RTN","RORRP038",94,0)
 ;***** RENAMES THE INSTANCE OF THE GUI PARAMETER
"RTN","RORRP038",95,0)
 ; RPC: [ROR GUI PARAMETER RENAME]
"RTN","RORRP038",96,0)
 ;
"RTN","RORRP038",97,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP038",98,0)
 ;               are returned to.
"RTN","RORRP038",99,0)
 ;
"RTN","RORRP038",100,0)
 ; ENTITY        Entity that the parameter is associated with.
"RTN","RORRP038",101,0)
 ;
"RTN","RORRP038",102,0)
 ; NAME          Name of the parameter
"RTN","RORRP038",103,0)
 ;
"RTN","RORRP038",104,0)
 ; OLDINST       Current instance name of the GUI parameter
"RTN","RORRP038",105,0)
 ;
"RTN","RORRP038",106,0)
 ; NEWINST       New instance name for the GUI parameter
"RTN","RORRP038",107,0)
 ;
"RTN","RORRP038",108,0)
 ; Return Values:
"RTN","RORRP038",109,0)
 ;
"RTN","RORRP038",110,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP038",111,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP038",112,0)
 ;
"RTN","RORRP038",113,0)
 ; Otherwise, the RESULTS(0) will contain 0.
"RTN","RORRP038",114,0)
 ;
"RTN","RORRP038",115,0)
RENPARM(RESULTS,ENTITY,NAME,OLDINST,NEWINST) ;
"RTN","RORRP038",116,0)
 N RC,RORERRDL,RORMSG,TMP  K RESULTS
"RTN","RORRP038",117,0)
 D CLEAR^RORERR("RENPARM^RORRP038",1)
"RTN","RORRP038",118,0)
 ;--- Check the parameters
"RTN","RORRP038",119,0)
 I $G(ENTITY)=""  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP038",120,0)
 . S RC=$$ERROR^RORERR(-88,,,,"ENTITY",$G(ENTITY))
"RTN","RORRP038",121,0)
 I $G(NAME)=""  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP038",122,0)
 . S RC=$$ERROR^RORERR(-88,,,,"NAME",$G(NAME))
"RTN","RORRP038",123,0)
 I $G(OLDINST)=""  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP038",124,0)
 . S RC=$$ERROR^RORERR(-88,,,,"OLDINST",$G(OLDINST))
"RTN","RORRP038",125,0)
 I $G(NEWINST)=""  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP038",126,0)
 . S RC=$$ERROR^RORERR(-88,,,,"NEWINST",$G(NEWINST))
"RTN","RORRP038",127,0)
 ;--- Delete the instance with the new name if it exists
"RTN","RORRP038",128,0)
 ;--- (otherwise, the REP^XPAR will return an error)
"RTN","RORRP038",129,0)
 D:$$UP^XLFSTR(OLDINST)'=$$UP^XLFSTR(NEWINST)
"RTN","RORRP038",130,0)
 . D DEL^XPAR(ENTITY,NAME,NEWINST,.RORMSG)  K RORMSG
"RTN","RORRP038",131,0)
 ;--- Rename the instance
"RTN","RORRP038",132,0)
 D REP^XPAR(ENTITY,NAME,OLDINST,NEWINST,.RORMSG)
"RTN","RORRP038",133,0)
 I $G(RORMSG)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP038",134,0)
 . S RC=$$ERROR^RORERR(-56,,$P(RORMSG,U,2),,+RORMSG,"REP^XPAR")
"RTN","RORRP038",135,0)
 S RESULTS(0)=0
"RTN","RORRP038",136,0)
 Q
"RTN","RORRP038",137,0)
 ;
"RTN","RORRP038",138,0)
 ;***** STORES THE VALUE OF THE GUI PARAMETER
"RTN","RORRP038",139,0)
 ; RPC: [ROR GUI PARAMETER SET]
"RTN","RORRP038",140,0)
 ;
"RTN","RORRP038",141,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP038",142,0)
 ;               are returned to.
"RTN","RORRP038",143,0)
 ;
"RTN","RORRP038",144,0)
 ; INSTANCE      Instance name of the GUI parameter.
"RTN","RORRP038",145,0)
 ;               Optional second "^"-piece of this parameter can
"RTN","RORRP038",146,0)
 ;               contain name of the parameter. By default, the
"RTN","RORRP038",147,0)
 ;               "ROR GUI PARAMETER" is used.
"RTN","RORRP038",148,0)
 ;
"RTN","RORRP038",149,0)
 ; [ENTITY]      Entity that the parameter is associated with.
"RTN","RORRP038",150,0)
 ;               By default ($G(ENTITY)=""), the "USR" value is used
"RTN","RORRP038",151,0)
 ;               (see the DBIA #2263 for more details).
"RTN","RORRP038",152,0)
 ;
"RTN","RORRP038",153,0)
 ; [.]VALUE      Value of the parameter. It should be either a string
"RTN","RORRP038",154,0)
 ;               or a reference to a local array that contains a text
"RTN","RORRP038",155,0)
 ;               (prepared for a word-processing field).
"RTN","RORRP038",156,0)
 ;
"RTN","RORRP038",157,0)
 ;               The local array should not contain the 0 subscript
"RTN","RORRP038",158,0)
 ;               (it will not be stored).
"RTN","RORRP038",159,0)
 ;
"RTN","RORRP038",160,0)
 ;               You can use the "@" value to delete the parameter.
"RTN","RORRP038",161,0)
 ;
"RTN","RORRP038",162,0)
 ; Return Values:
"RTN","RORRP038",163,0)
 ;
"RTN","RORRP038",164,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP038",165,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP038",166,0)
 ;
"RTN","RORRP038",167,0)
 ; Otherwise, the RESULTS(0) will contain 0.
"RTN","RORRP038",168,0)
 ;
"RTN","RORRP038",169,0)
SETPARM(RESULTS,INSTANCE,ENTITY,VALUE) ;
"RTN","RORRP038",170,0)
 N RC,RORBUF,RORERRDL,RORMSG,TMP  K RESULTS
"RTN","RORRP038",171,0)
 D CLEAR^RORERR("SETPARM^RORRP038",1)
"RTN","RORRP038",172,0)
 ;--- Check the parameters
"RTN","RORRP038",173,0)
 I $G(INSTANCE)=""  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP038",174,0)
 . S RC=$$ERROR^RORERR(-88,,,,"INSTANCE",$G(INSTANCE))
"RTN","RORRP038",175,0)
 I '$D(VALUE)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP038",176,0)
 . S RC=$$ERROR^RORERR(-88,,,,"VALUE","<UNDEFINED>")
"RTN","RORRP038",177,0)
 S:$G(ENTITY)="" ENTITY="USR"
"RTN","RORRP038",178,0)
 S NAME=$P(INSTANCE,U,2)
"RTN","RORRP038",179,0)
 S:$G(NAME)="" NAME="ROR GUI PARAMETER"
"RTN","RORRP038",180,0)
 ;--- Prepare the value (make sure the description is not empty)
"RTN","RORRP038",181,0)
 I $D(VALUE),$G(VALUE)'="@"  D
"RTN","RORRP038",182,0)
 . I $D(VALUE)=1  S RORBUF(1,0)=VALUE
"RTN","RORRP038",183,0)
 . E  M RORBUF=VALUE
"RTN","RORRP038",184,0)
 . S:$G(RORBUF)="" RORBUF="CCR GUI Parameter"
"RTN","RORRP038",185,0)
 E  S RORBUF="@"
"RTN","RORRP038",186,0)
 ;--- Store the value
"RTN","RORRP038",187,0)
 D PUT^XPAR(ENTITY,NAME,$P(INSTANCE,U),.RORBUF,.RORMSG)
"RTN","RORRP038",188,0)
 I $G(RORMSG),+RORMSG'=1  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP038",189,0)
 . S RC=$$ERROR^RORERR(-56,,$P(RORMSG,U,2),,+RORMSG,"PUT^XPAR")
"RTN","RORRP038",190,0)
 S RESULTS=0
"RTN","RORRP038",191,0)
 Q
"RTN","RORRP040")
0^203^B22896887
"RTN","RORRP040",1,0)
RORRP040 ;HCIOFO/SG - RPC: LOCAL REGISTRY FIELDS ; 8/25/05 12:23pm
"RTN","RORRP040",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP040",3,0)
 ;
"RTN","RORRP040",4,0)
 Q
"RTN","RORRP040",5,0)
 ;
"RTN","RORRP040",6,0)
 ;***** LOADS THE LIST OF LOCAL FIELD DEFINITIONS
"RTN","RORRP040",7,0)
 ; RPC: [ROR LIST LOCAL FIELDS]
"RTN","RORRP040",8,0)
 ;
"RTN","RORRP040",9,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP040",10,0)
 ;               are returned to.
"RTN","RORRP040",11,0)
 ;
"RTN","RORRP040",12,0)
 ; REGIEN        Registry IEN
"RTN","RORRP040",13,0)
 ;
"RTN","RORRP040",14,0)
 ; FLAGS         Flags that control processing:
"RTN","RORRP040",15,0)
 ;                 I  Include inactive field definitions
"RTN","RORRP040",16,0)
 ;
"RTN","RORRP040",17,0)
 ; [LOCK]        Lock the local fields before loading the data and
"RTN","RORRP040",18,0)
 ;               leave them locked.
"RTN","RORRP040",19,0)
 ;
"RTN","RORRP040",20,0)
 ; Return Values:
"RTN","RORRP040",21,0)
 ;
"RTN","RORRP040",22,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) node
"RTN","RORRP040",23,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for details).
"RTN","RORRP040",24,0)
 ;
"RTN","RORRP040",25,0)
 ; If the local field table cannot be locked then the second
"RTN","RORRP040",26,0)
 ; "^"-piece of the @RESULTS@(0) will be greater than 0 and the
"RTN","RORRP040",27,0)
 ; node will contain the lock descriptor.
"RTN","RORRP040",28,0)
 ;
"RTN","RORRP040",29,0)
 ; @RESULTS@(0)          Result Descriptor
"RTN","RORRP040",30,0)
 ;                         ^01: Number of local fields
"RTN","RORRP040",31,0)
 ;                         ^02: Lock Descriptor (see the
"RTN","RORRP040",32,0)
 ;                         ...  LOCK^RORLOCK for details)
"RTN","RORRP040",33,0)
 ;
"RTN","RORRP040",34,0)
 ; The subsequent nodes will contain local field definitions.
"RTN","RORRP040",35,0)
 ;
"RTN","RORRP040",36,0)
 ; See the description of the ROR LIST LOCAL FIELDS remote procedure
"RTN","RORRP040",37,0)
 ; for more details.
"RTN","RORRP040",38,0)
 ;
"RTN","RORRP040",39,0)
LFLIST(RESULTS,REGIEN,FLAGS,LOCK) ;
"RTN","RORRP040",40,0)
 N CNT,IEN,IENS,LOCKRC,NAME,RC,ROOT,RORBUF,RORERRDL,RORMSG,TMP
"RTN","RORRP040",41,0)
 D CLEAR^RORERR("LFLIST^RORRP040",1)
"RTN","RORRP040",42,0)
 K RESULTS  S RESULTS=$$ALLOC^RORTMP()
"RTN","RORRP040",43,0)
 ;
"RTN","RORRP040",44,0)
 ;=== Check the parameters
"RTN","RORRP040",45,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP040",46,0)
 . ;--- Registry IEN
"RTN","RORRP040",47,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP040",48,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP040",49,0)
 . S REGIEN=+REGIEN
"RTN","RORRP040",50,0)
 . ;--- Flags
"RTN","RORRP040",51,0)
 . S FLAGS=$G(FLAGS)
"RTN","RORRP040",52,0)
 ;
"RTN","RORRP040",53,0)
 ;=== Lock the ROR LOCAL FIELD file
"RTN","RORRP040",54,0)
 I $G(LOCK)  D  I LOCKRC<0  D RPCSTK^RORERR(.RESULTS,LOCKRC)  Q
"RTN","RORRP040",55,0)
 . S LOCKRC=$$LOCK^RORLOCK(799.53)
"RTN","RORRP040",56,0)
 ;
"RTN","RORRP040",57,0)
 ;=== Load the list of field definitions
"RTN","RORRP040",58,0)
 S DT=$$DT^XLFDT
"RTN","RORRP040",59,0)
 S ROOT=$$ROOT^DILFD(799.53,,1)
"RTN","RORRP040",60,0)
 S NAME="",(CNT,RC)=0
"RTN","RORRP040",61,0)
 F  S NAME=$O(@ROOT@("KEY",REGIEN,NAME))  Q:NAME=""  D  Q:RC<0
"RTN","RORRP040",62,0)
 . S IEN=0
"RTN","RORRP040",63,0)
 . F  S IEN=$O(@ROOT@("KEY",REGIEN,NAME,IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORRP040",64,0)
 . . S IENS=IEN_","  K RORBUF,RORMSG
"RTN","RORRP040",65,0)
 . . D GETS^DIQ(799.53,IENS,".01;.02;1","I","RORBUF","RORMSG")
"RTN","RORRP040",66,0)
 . . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,,798.53)  Q
"RTN","RORRP040",67,0)
 . . ;--- Skip inactive field definition if necessary
"RTN","RORRP040",68,0)
 . . I FLAGS'["I"  D  I TMP>0  Q:TMP'>DT
"RTN","RORRP040",69,0)
 . . . S TMP=+$G(RORBUF(799.53,IENS,.02,"I"))
"RTN","RORRP040",70,0)
 . . ;--- Add the definition to the list
"RTN","RORRP040",71,0)
 . . S CNT=CNT+1,RORBUF=IEN
"RTN","RORRP040",72,0)
 . . S $P(RORBUF,U,2)=$G(RORBUF(799.53,IENS,.01,"I"))
"RTN","RORRP040",73,0)
 . . S $P(RORBUF,U,3)=$G(RORBUF(799.53,IENS,.02,"I"))
"RTN","RORRP040",74,0)
 . . S $P(RORBUF,U,4)=$G(RORBUF(799.53,IENS,1,"I"))
"RTN","RORRP040",75,0)
 . . S @RESULTS@(CNT)=RORBUF
"RTN","RORRP040",76,0)
 I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP040",77,0)
 ;
"RTN","RORRP040",78,0)
 ;=== Success
"RTN","RORRP040",79,0)
 S @RESULTS@(0)=CNT_U_$G(LOCKRC)
"RTN","RORRP040",80,0)
 Q
"RTN","RORRP040",81,0)
 ;
"RTN","RORRP040",82,0)
 ;***** UPDATES THE LIST OF LOCAL FIELD DEFINITIONS
"RTN","RORRP040",83,0)
 ; RPC: [ROR UPDATE LOCAL FIELDS]
"RTN","RORRP040",84,0)
 ;
"RTN","RORRP040",85,0)
 ; .RESULTS      Reference to a local variable
"RTN","RORRP040",86,0)
 ;
"RTN","RORRP040",87,0)
 ; REGIEN        Registry IEN
"RTN","RORRP040",88,0)
 ;
"RTN","RORRP040",89,0)
 ; [CANCEL]      Cancel the update and unlock the local fields
"RTN","RORRP040",90,0)
 ;
"RTN","RORRP040",91,0)
 ; [.LFLST]      Reference to a local variable that contains
"RTN","RORRP040",92,0)
 ;               a list of local fields
"RTN","RORRP040",93,0)
 ; .LFLST(
"RTN","RORRP040",94,0)
 ;
"RTN","RORRP040",95,0)
 ;   i)          Local Field Descriptor
"RTN","RORRP040",96,0)
 ;                 ^01: IEN
"RTN","RORRP040",97,0)
 ;                 ^02: Name
"RTN","RORRP040",98,0)
 ;                 ^03: Inactivation Date (FileMan)
"RTN","RORRP040",99,0)
 ;                 ^04: Description
"RTN","RORRP040",100,0)
 ;
"RTN","RORRP040",101,0)
 ; See the description of the ROR UPDATE LOCAL FIELDS remote procedure
"RTN","RORRP040",102,0)
 ; for more details.
"RTN","RORRP040",103,0)
 ;
"RTN","RORRP040",104,0)
 ; Return Values:
"RTN","RORRP040",105,0)
 ;
"RTN","RORRP040",106,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) node
"RTN","RORRP040",107,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for details).
"RTN","RORRP040",108,0)
 ;
"RTN","RORRP040",109,0)
 ; Otherwise, zero is returned in the RESULTS(0).
"RTN","RORRP040",110,0)
 ;
"RTN","RORRP040",111,0)
LFLUPD(RESULTS,REGIEN,CANCEL,LFLST) ;
"RTN","RORRP040",112,0)
 N ECNT,I,IEN,RC,RORERRDL,TMP
"RTN","RORRP040",113,0)
 K RESULTS
"RTN","RORRP040",114,0)
 D CLEAR^RORERR("LFLUPD^RORRP040",1)
"RTN","RORRP040",115,0)
 S (ECNT,RC)=0
"RTN","RORRP040",116,0)
 ;
"RTN","RORRP040",117,0)
 ;=== Check the parameters
"RTN","RORRP040",118,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP040",119,0)
 . ;--- Registry IEN
"RTN","RORRP040",120,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP040",121,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP040",122,0)
 . S REGIEN=+REGIEN
"RTN","RORRP040",123,0)
 . ;--- List of local fields
"RTN","RORRP040",124,0)
 . S I=0
"RTN","RORRP040",125,0)
 . F  S I=$O(LFLST(I))  Q:I'>0  D
"RTN","RORRP040",126,0)
 . . S IEN=+$P(LFLST(I),U)  S:IEN>0 LFLST("AI",IEN)=I
"RTN","RORRP040",127,0)
 ;
"RTN","RORRP040",128,0)
 D:'$G(CANCEL)
"RTN","RORRP040",129,0)
 . N DA,DIK,IENS,NAME,RORFDA,RORMSG,XREF
"RTN","RORRP040",130,0)
 . ;--- Delete the old records
"RTN","RORRP040",131,0)
 . S DIK=$$ROOT^DILFD(799.53)
"RTN","RORRP040",132,0)
 . S XREF=DIK_"""KEY"","_REGIEN_")"
"RTN","RORRP040",133,0)
 . S NAME=""
"RTN","RORRP040",134,0)
 . F  S NAME=$O(@XREF@(NAME))  Q:NAME=""  D
"RTN","RORRP040",135,0)
 . . S DA=""
"RTN","RORRP040",136,0)
 . . F  S DA=$O(@XREF@(NAME,DA))  Q:DA=""  D
"RTN","RORRP040",137,0)
 . . . D:'$D(LFLST("AI",DA)) LVDEL(DA),^DIK
"RTN","RORRP040",138,0)
 . ;--- Store the new records
"RTN","RORRP040",139,0)
 . S NODE=$$CREF^DILF(DIK)
"RTN","RORRP040",140,0)
 . S I=0
"RTN","RORRP040",141,0)
 . F  S I=$O(LFLST(I))  Q:I'>0  D
"RTN","RORRP040",142,0)
 . . S IEN=+$P(LFLST(I),U)
"RTN","RORRP040",143,0)
 . . S IENS=$S(IEN'>0:"+1,",$D(@NODE@(IEN)):IEN_",",1:"+1,")
"RTN","RORRP040",144,0)
 . . K RORFDA,RORMSG
"RTN","RORRP040",145,0)
 . . S RORFDA(799.53,IENS,.01)=$P(LFLST(I),U,2)  ; NAME
"RTN","RORRP040",146,0)
 . . S RORFDA(799.53,IENS,.02)=$P(LFLST(I),U,3)  ; DATE OF INACTIV.
"RTN","RORRP040",147,0)
 . . S RORFDA(799.53,IENS,.03)=REGIEN            ; REGISTRY
"RTN","RORRP040",148,0)
 . . S RORFDA(799.53,IENS,1)=$P(LFLST(I),U,4)    ; DESCRIPTION
"RTN","RORRP040",149,0)
 . . I $E(IENS,1)="+"  D
"RTN","RORRP040",150,0)
 . . . D UPDATE^DIE(,"RORFDA",,"RORMSG")
"RTN","RORRP040",151,0)
 . . E  D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORRP040",152,0)
 . . I $G(DIERR)  D  S ECNT=ECNT+1
"RTN","RORRP040",153,0)
 . . . D DBS^RORERR("RORMSG",-9,,,799.53,IENS)
"RTN","RORRP040",154,0)
 ;
"RTN","RORRP040",155,0)
 ;=== Unlock the file and check for errors
"RTN","RORRP040",156,0)
 D UNLOCK^RORLOCK(799.53)
"RTN","RORRP040",157,0)
 I ECNT>0  D RPCSTK^RORERR(.RESULTS,-9)  Q
"RTN","RORRP040",158,0)
 ;--- Success
"RTN","RORRP040",159,0)
 S RESULTS(0)=0
"RTN","RORRP040",160,0)
 Q
"RTN","RORRP040",161,0)
 ;
"RTN","RORRP040",162,0)
 ;***** DELETES THE LOCAL FIELD FROM THE PATIENTS' RECORDS
"RTN","RORRP040",163,0)
 ;
"RTN","RORRP040",164,0)
 ; LFIEN         IEN of the local field (file #799.53)
"RTN","RORRP040",165,0)
 ;
"RTN","RORRP040",166,0)
LVDEL(LFIEN) ;
"RTN","RORRP040",167,0)
 N DA,DIK,XREF
"RTN","RORRP040",168,0)
 S XREF=$$ROOT^DILFD(798)_"""ALF"","_LFIEN_")"
"RTN","RORRP040",169,0)
 S DA(1)=""
"RTN","RORRP040",170,0)
 F  S DA(1)=$O(@XREF@(DA(1)))  Q:DA(1)=""  D
"RTN","RORRP040",171,0)
 . S DA="",DIK=$$ROOT^DILFD(798.02,","_DA(1)_",")
"RTN","RORRP040",172,0)
 . F  S DA=$O(@XREF@(DA(1),DA))  Q:DA=""  D ^DIK
"RTN","RORRP040",173,0)
 Q
"RTN","RORRP041")
0^205^B12442273
"RTN","RORRP041",1,0)
RORRP041 ;HCIOFO/SG - RPC: REGISTRY-SPECIFIC LAB RESULTS ; 8/25/05 12:24pm
"RTN","RORRP041",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP041",3,0)
 ;
"RTN","RORRP041",4,0)
 Q
"RTN","RORRP041",5,0)
 ;
"RTN","RORRP041",6,0)
 ;***** LOADS AND PROCESSES CD4 AND VIRAL LOAD RESULTS
"RTN","RORRP041",7,0)
 ;
"RTN","RORRP041",8,0)
 ; .ROR8DST(     Reference to the Lab search descriptor.
"RTN","RORRP041",9,0)
 ;               See the $$LTSEARCH^RORUTL10 for details
"RTN","RORRP041",10,0)
 ;
"RTN","RORRP041",11,0)
 ;   "RORPTR")   Index of the last node in the destination buffer
"RTN","RORRP041",12,0)
 ;
"RTN","RORRP041",13,0)
 ;   "RORSTATS",
"RTN","RORRP041",14,0)
 ;     Group,
"RTN","RORRP041",15,0)
 ;       "LAST") Latest
"RTN","RORRP041",16,0)
 ;                 ^01: Result Value
"RTN","RORRP041",17,0)
 ;                 ^02: Date
"RTN","RORRP041",18,0)
 ;       "MAX")  Highest
"RTN","RORRP041",19,0)
 ;                 ^01: Result Value
"RTN","RORRP041",20,0)
 ;                 ^02: Date
"RTN","RORRP041",21,0)
 ;       "MIN")  Lowest
"RTN","RORRP041",22,0)
 ;                 ^01: Result Value
"RTN","RORRP041",23,0)
 ;                 ^02: Date
"RTN","RORRP041",24,0)
 ;
"RTN","RORRP041",25,0)
 ; INVDT         IEN of the Lab test (inverted date)
"RTN","RORRP041",26,0)
 ;
"RTN","RORRP041",27,0)
 ; .RESULT       Reference to a local variable, which contains the
"RTN","RORRP041",28,0)
 ;               result in the same format as it is stored into
"RTN","RORRP041",29,0)
 ;               the destination array by default.
"RTN","RORRP041",30,0)
 ;
"RTN","RORRP041",31,0)
 ; Return Values:
"RTN","RORRP041",32,0)
 ;       <0  Error code (the search will be aborted)
"RTN","RORRP041",33,0)
 ;        0  Ok
"RTN","RORRP041",34,0)
 ;        1  Skip this result
"RTN","RORRP041",35,0)
 ;        2  Skip this and all remaining results
"RTN","RORRP041",36,0)
 ;
"RTN","RORRP041",37,0)
LOADLT(ROR8DST,INVDT,RESULT) ;
"RTN","RORRP041",38,0)
 N BUF,GROUP,LTDT,LTVAL,TMP
"RTN","RORRP041",39,0)
 S LTDT=$P($G(RESULT(1)),U,2)    Q:LTDT'>0 1   ; Date of the test
"RTN","RORRP041",40,0)
 S LTVAL=$$TRIM^XLFSTR($P(RESULT(1),U,3))      ; Result value
"RTN","RORRP041",41,0)
 S GROUP=+$P($G(RESULT(2)),U,3)  Q:GROUP'>0 1  ; Code of the group
"RTN","RORRP041",42,0)
 ;
"RTN","RORRP041",43,0)
 ;=== Create and store the segment
"RTN","RORRP041",44,0)
 S BUF="LTR"_U_$P(RESULT(1),U)
"RTN","RORRP041",45,0)
 S $P(BUF,U,3,4)=LTDT_U_LTVAL
"RTN","RORRP041",46,0)
 S $P(BUF,U,5,8)=$P(RESULT(2),U,1,4)
"RTN","RORRP041",47,0)
 S ROR8DST("RORPTR")=$G(ROR8DST("RORPTR"))+1
"RTN","RORRP041",48,0)
 S @ROR8DST@(ROR8DST("RORPTR"))=BUF
"RTN","RORRP041",49,0)
 ;
"RTN","RORRP041",50,0)
 ;=== Most recent result of the group
"RTN","RORRP041",51,0)
 D:LTDT>$P($G(ROR8DST("RORSTATS",GROUP,"LAST")),U,2)
"RTN","RORRP041",52,0)
 . S ROR8DST("RORSTATS",GROUP,"LAST")=LTVAL_U_LTDT
"RTN","RORRP041",53,0)
 ;
"RTN","RORRP041",54,0)
 ;=== Numeric results
"RTN","RORRP041",55,0)
 D:$$NUMERIC^RORUTL05(LTVAL)
"RTN","RORRP041",56,0)
 . ;--- Lowest result value of the group
"RTN","RORRP041",57,0)
 . S TMP=+$G(ROR8DST("RORSTATS",GROUP,"MIN"))
"RTN","RORRP041",58,0)
 . S:'TMP!(LTVAL<TMP) ROR8DST("RORSTATS",GROUP,"MIN")=LTVAL_U_LTDT
"RTN","RORRP041",59,0)
 . ;--- Highest result value of the group
"RTN","RORRP041",60,0)
 . S TMP=+$G(ROR8DST("RORSTATS",GROUP,"MAX"))
"RTN","RORRP041",61,0)
 . S:LTVAL>TMP ROR8DST("RORSTATS",GROUP,"MAX")=LTVAL_U_LTDT
"RTN","RORRP041",62,0)
 ;
"RTN","RORRP041",63,0)
 ;=== Success
"RTN","RORRP041",64,0)
 Q 0
"RTN","RORRP041",65,0)
 ;
"RTN","RORRP041",66,0)
 ;***** LOADS THE PATIENT'S REGISTRY-SPECIFIC LAB RESULTS
"RTN","RORRP041",67,0)
 ; RPC: [ROR PATIENT REGISTRY LABS]
"RTN","RORRP041",68,0)
 ;
"RTN","RORRP041",69,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP041",70,0)
 ;               are returned to.
"RTN","RORRP041",71,0)
 ;
"RTN","RORRP041",72,0)
 ; REGIEN        Registry IEN
"RTN","RORRP041",73,0)
 ;
"RTN","RORRP041",74,0)
 ; PATIEN        IEN of the registry patient (DFN)
"RTN","RORRP041",75,0)
 ;
"RTN","RORRP041",76,0)
 ; Return Values:
"RTN","RORRP041",77,0)
 ;
"RTN","RORRP041",78,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP041",79,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP041",80,0)
 ; details).
"RTN","RORRP041",81,0)
 ;
"RTN","RORRP041",82,0)
 ; Otherwise, zero is returned in the @RESULTS@(0) and the
"RTN","RORRP041",83,0)
 ; subsequent nodes of the global array contain the data.
"RTN","RORRP041",84,0)
 ; 
"RTN","RORRP041",85,0)
 ; @RESULTS@(0)          0
"RTN","RORRP041",86,0)
 ;
"RTN","RORRP041",87,0)
 ; @RESULTS@(i)          Registry-specific Lab Result
"RTN","RORRP041",88,0)
 ;                         ^01: "LTR"
"RTN","RORRP041",89,0)
 ;                         ^02: Result IEN (inverted date/time)
"RTN","RORRP041",90,0)
 ;                         ^03: Date/time of the test (FileMan)
"RTN","RORRP041",91,0)
 ;                         ^04: Result
"RTN","RORRP041",92,0)
 ;                         ^05: Test IEN (in file #60)
"RTN","RORRP041",93,0)
 ;                         ^06: Test name
"RTN","RORRP041",94,0)
 ;                         ^07: Code of the group
"RTN","RORRP041",95,0)
 ;                         ^08: Group name
"RTN","RORRP041",96,0)
 ;
"RTN","RORRP041",97,0)
 ; @RESULTS@(i)          Lab Group Statistics
"RTN","RORRP041",98,0)
 ;                         ^01: "LTG"
"RTN","RORRP041",99,0)
 ;                         ^02: Code of the group
"RTN","RORRP041",100,0)
 ;                         ^03: Group name
"RTN","RORRP041",101,0)
 ;                         ^04: Latest result value
"RTN","RORRP041",102,0)
 ;                         ^05: Date of the latest result (FileMan)
"RTN","RORRP041",103,0)
 ;                         ^06: Lowest result value
"RTN","RORRP041",104,0)
 ;                         ^07: Date of the lowest value (FileMan)
"RTN","RORRP041",105,0)
 ;
"RTN","RORRP041",106,0)
LOADPRL(RESULTS,REGIEN,PATIEN) ;
"RTN","RORRP041",107,0)
 N BUF,GRP,NAME,PTR,RC,RORBUF,RORERRDL,TMP
"RTN","RORRP041",108,0)
 D CLEAR^RORERR("LOAD^RORRP041",1)
"RTN","RORRP041",109,0)
 K RESULTS  S RESULTS=$$ALLOC^RORTMP()  S @RESULTS@(0)=0
"RTN","RORRP041",110,0)
 ;
"RTN","RORRP041",111,0)
 ;=== Check the parameters
"RTN","RORRP041",112,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP041",113,0)
 . ;--- Registry IEN
"RTN","RORRP041",114,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP041",115,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP041",116,0)
 . S REGIEN=+REGIEN
"RTN","RORRP041",117,0)
 . ;--- Patient IEN
"RTN","RORRP041",118,0)
 . I $G(PATIEN)'>0  D  Q
"RTN","RORRP041",119,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"PATIEN",$G(PATIEN))
"RTN","RORRP041",120,0)
 . S PATIEN=+PATIEN
"RTN","RORRP041",121,0)
 ;
"RTN","RORRP041",122,0)
 ;=== Search for registry-specific lab results
"RTN","RORRP041",123,0)
 S RORBUF=RESULTS
"RTN","RORRP041",124,0)
 S RORBUF("RORCB")="$$LOADLT^RORRP041"
"RTN","RORRP041",125,0)
 S RC=$$LTSEARCH^RORUTL10(PATIEN,+REGIEN,.RORBUF)
"RTN","RORRP041",126,0)
 I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP041",127,0)
 ;
"RTN","RORRP041",128,0)
 ;=== Store the group statistics
"RTN","RORRP041",129,0)
 S PTR=+$O(@RESULTS@(""),-1)
"RTN","RORRP041",130,0)
 S GRP=0
"RTN","RORRP041",131,0)
 F  S GRP=$O(RORBUF("RORSTATS",GRP))  Q:GRP'>0  D
"RTN","RORRP041",132,0)
 . S TMP=$$ITEMIEN^RORUTL09(3,REGIEN,GRP,.NAME)
"RTN","RORRP041",133,0)
 . S BUF="LTG"_U_GRP_U_NAME
"RTN","RORRP041",134,0)
 . S $P(BUF,U,4,5)=$G(RORBUF("RORSTATS",GRP,"LAST"))
"RTN","RORRP041",135,0)
 . S $P(BUF,U,6,7)=$G(RORBUF("RORSTATS",GRP,"MIN"))
"RTN","RORRP041",136,0)
 . S PTR=PTR+1,@RESULTS@(PTR)=BUF
"RTN","RORRP041",137,0)
 Q
"RTN","RORRP042")
0^213^B12774243
"RTN","RORRP042",1,0)
RORRP042 ;HCIOFO/SG - RPC: CPT CODES ; 11/10/05 9:21am
"RTN","RORRP042",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORRP042",3,0)
 ;
"RTN","RORRP042",4,0)
 ; This routine uses the following IAs:
"RTN","RORRP042",5,0)
 ;
"RTN","RORRP042",6,0)
 ; #1995          $$CPT^ICPTCOD (supported)
"RTN","RORRP042",7,0)
 ; #2815          Access to the file #81 (supported)
"RTN","RORRP042",8,0)
 ;
"RTN","RORRP042",9,0)
 Q
"RTN","RORRP042",10,0)
 ;
"RTN","RORRP042",11,0)
 ;***** RETURNS THE LIST OF CPT CODES
"RTN","RORRP042",12,0)
 ; RPC: [ROR LIST CPT]
"RTN","RORRP042",13,0)
 ;
"RTN","RORRP042",14,0)
 ; .RORESULT     Reference to a local variable where the results
"RTN","RORRP042",15,0)
 ;               are returned to.
"RTN","RORRP042",16,0)
 ;
"RTN","RORRP042",17,0)
 ; [DATE]        Date for the code set versioning.
"RTN","RORRP042",18,0)
 ;
"RTN","RORRP042",19,0)
 ; [PART]        The partial match restriction.
"RTN","RORRP042",20,0)
 ;
"RTN","RORRP042",21,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORRP042",22,0)
 ;                 A  Exclude active codes
"RTN","RORRP042",23,0)
 ;                 B  Backwards. Traverses the index in the opposite
"RTN","RORRP042",24,0)
 ;                    direction of normal traversal
"RTN","RORRP042",25,0)
 ;                 D  Full search by short name
"RTN","RORRP042",26,0)
 ;                 I  Exclude inactive codes
"RTN","RORRP042",27,0)
 ;                 K  Search in description keywords
"RTN","RORRP042",28,0)
 ;
"RTN","RORRP042",29,0)
 ; [NUMBER]      Maximum number of entries to return. A value of "*"
"RTN","RORRP042",30,0)
 ;               or no value in this parameter designates all entries.
"RTN","RORRP042",31,0)
 ;
"RTN","RORRP042",32,0)
 ; [FROM]        The index entry(s) from which to begin the list
"RTN","RORRP042",33,0)
 ;                 ^01: FromName
"RTN","RORRP042",34,0)
 ;                 ^02: FromIEN
"RTN","RORRP042",35,0)
 ;
"RTN","RORRP042",36,0)
 ;               For example, a FROM value of "51" would list entries
"RTN","RORRP042",37,0)
 ;               following 51. You can use the 2-nd and 3-rd "^"-
"RTN","RORRP042",38,0)
 ;               pieces of the @RORESULT@(0) node to continue the
"RTN","RORRP042",39,0)
 ;               listing in the subsequent procedure calls.
"RTN","RORRP042",40,0)
 ;
"RTN","RORRP042",41,0)
 ;               NOTE: The FROM value itself is not included in
"RTN","RORRP042",42,0)
 ;                     the resulting list.
"RTN","RORRP042",43,0)
 ;
"RTN","RORRP042",44,0)
 ; See description of the LIST^DIC for more details about the
"RTN","RORRP042",45,0)
 ; PART, NUMBER and FROM parameters.
"RTN","RORRP042",46,0)
 ;
"RTN","RORRP042",47,0)
 ; The ^TMP("RORRP042",$J) global node is used by this procedure.
"RTN","RORRP042",48,0)
 ;
"RTN","RORRP042",49,0)
 ; Return Values:
"RTN","RORRP042",50,0)
 ;
"RTN","RORRP042",51,0)
 ; A negative value of the first "^"-piece of the @RORESULT@(0)
"RTN","RORRP042",52,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP042",53,0)
 ; details).
"RTN","RORRP042",54,0)
 ;
"RTN","RORRP042",55,0)
 ; Otherwise, number of CPT codes and the value of the FROM
"RTN","RORRP042",56,0)
 ; parameter for the next procedure call are returned in the
"RTN","RORRP042",57,0)
 ; @RORESULT@(0) and the subsequent nodes of the global array
"RTN","RORRP042",58,0)
 ; contain the codes.
"RTN","RORRP042",59,0)
 ; 
"RTN","RORRP042",60,0)
 ; @RORESULT@(0)         Result Descriptor
"RTN","RORRP042",61,0)
 ;                         ^01: Number of codes
"RTN","RORRP042",62,0)
 ;                         ^02: FromName
"RTN","RORRP042",63,0)
 ;                         ^03: FromIEN
"RTN","RORRP042",64,0)
 ;
"RTN","RORRP042",65,0)
 ; @RORESULT@(i)         CPT
"RTN","RORRP042",66,0)
 ;                         ^01: IEN
"RTN","RORRP042",67,0)
 ;                         ^02: Short Name
"RTN","RORRP042",68,0)
 ;                         ^03: Code
"RTN","RORRP042",69,0)
 ;                         ^04: reserved
"RTN","RORRP042",70,0)
 ;                         ^05: Inactive {0|1}
"RTN","RORRP042",71,0)
 ;                         ^06: Inactivation Date (FileMan)
"RTN","RORRP042",72,0)
 ;
"RTN","RORRP042",73,0)
CPTLIST(RORESULT,DATE,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP042",74,0)
 N BUF,RC,RORERRDL,TMP
"RTN","RORRP042",75,0)
 D CLEAR^RORERR("CPTLIST^RORRP042",1)
"RTN","RORRP042",76,0)
 K RORESULT  S RORESULT=$NA(^TMP("RORRP042",$J))  K @RORESULT
"RTN","RORRP042",77,0)
 ;--- Check the parameters
"RTN","RORRP042",78,0)
 S PART=$G(PART),FLAGS=$G(FLAGS)
"RTN","RORRP042",79,0)
 S NUMBER=$S($G(NUMBER)>0:+NUMBER,1:"*")
"RTN","RORRP042",80,0)
 ;--- Setup the start point
"RTN","RORRP042",81,0)
 I $G(FROM)'=""  D  S FROM=$P(FROM,U)
"RTN","RORRP042",82,0)
 . S:$P(FROM,U,2)>0 FROM("IEN")=+$P(FROM,U,2)
"RTN","RORRP042",83,0)
 ;--- Get the list of CPT codes
"RTN","RORRP042",84,0)
 S RC=$$QUERY(PART,FLAGS,NUMBER,.FROM)
"RTN","RORRP042",85,0)
 I RC<0  D RPCSTK^RORERR(.RORESULT,RC)  Q
"RTN","RORRP042",86,0)
 S RORESULT=$NA(@RORESULT@("DILIST"))
"RTN","RORRP042",87,0)
 ;--- Load remaining data and refine the list
"RTN","RORRP042",88,0)
 D REFINE($G(DATE),FLAGS)
"RTN","RORRP042",89,0)
 ;--- Success
"RTN","RORRP042",90,0)
 S TMP=$G(@RORESULT@(0)),BUF=+$P(TMP,U)
"RTN","RORRP042",91,0)
 S:$P(TMP,U,3) $P(BUF,U,2,3)=$G(FROM)_U_$G(FROM("IEN"))
"RTN","RORRP042",92,0)
 K @RORESULT@(0)  S @RORESULT@(0)=BUF
"RTN","RORRP042",93,0)
 Q
"RTN","RORRP042",94,0)
 ;
"RTN","RORRP042",95,0)
 ;***** QUERIES THE CPT FILE (#81)
"RTN","RORRP042",96,0)
QUERY(PART,FLAGS,NR,FROM) ;
"RTN","RORRP042",97,0)
 N FLDS,RORMSG,SCR,TMP,XREF
"RTN","RORRP042",98,0)
 ;--- Compile the screen logic (be careful with naked references)
"RTN","RORRP042",99,0)
 S SCR=""
"RTN","RORRP042",100,0)
 I FLAGS["D"  S:PART'="" SCR=SCR_"I $P(D,U,2)["""_PART_""" ",PART=""
"RTN","RORRP042",101,0)
 S:SCR'="" SCR="S D=$G(^(0)) "_SCR
"RTN","RORRP042",102,0)
 ;--- Get the list of codes and some data
"RTN","RORRP042",103,0)
 S FLDS="@;.01;.01",TMP="P"_$S(FLAGS["B":"B",1:"")
"RTN","RORRP042",104,0)
 S XREF=$S(FLAGS["D":"#",FLAGS["K":"C",1:"B")
"RTN","RORRP042",105,0)
 D LIST^DIC(81,,FLDS,TMP,NR,.FROM,PART,XREF,SCR,,RORESULT,"RORMSG")
"RTN","RORRP042",106,0)
 I $G(DIERR)  K @RORESULT  Q $$DBS^RORERR("RORMSG",-9,,,80)
"RTN","RORRP042",107,0)
 ;--- Success
"RTN","RORRP042",108,0)
 Q 0
"RTN","RORRP042",109,0)
 ;
"RTN","RORRP042",110,0)
 ;***** REFINES THE LIST OF CPT CODES
"RTN","RORRP042",111,0)
REFINE(DATE,FLAGS) ;
"RTN","RORRP042",112,0)
 N BUF,CNT,CPTINFO,RORDESC,SUBS,TMP
"RTN","RORRP042",113,0)
 S (CNT,SUBS)=0
"RTN","RORRP042",114,0)
 F  S SUBS=$O(@RORESULT@(SUBS)) Q:SUBS'>0  D
"RTN","RORRP042",115,0)
 . S BUF=@RORESULT@(SUBS,0)
"RTN","RORRP042",116,0)
 . S CPTINFO=$$CPT^ICPTCOD(+$P(BUF,U),DATE)
"RTN","RORRP042",117,0)
 . I CPTINFO<0  K @RORESULT@(SUBS)  Q
"RTN","RORRP042",118,0)
 . ;--- Screen active/inactive records
"RTN","RORRP042",119,0)
 . S TMP=+$P(CPTINFO,U,7)                      ; Status
"RTN","RORRP042",120,0)
 . I $S(TMP:FLAGS["A",1:FLAGS["I")  K @RORESULT@(SUBS)  Q
"RTN","RORRP042",121,0)
 . S $P(BUF,U,5)=TMP
"RTN","RORRP042",122,0)
 . S $P(BUF,U,6)=$S(TMP:$P(CPTINFO,U,8),1:"")  ; Inactivation Date
"RTN","RORRP042",123,0)
 . ;--- Versioned short name
"RTN","RORRP042",124,0)
 . S TMP=$P(CPTINFO,U,3)  S:TMP'="" $P(BUF,U,2)=TMP
"RTN","RORRP042",125,0)
 . ;--- Store the data
"RTN","RORRP042",126,0)
 . S CNT=CNT+1,@RORESULT@(SUBS,0)=BUF
"RTN","RORRP042",127,0)
 ;---
"RTN","RORRP042",128,0)
 S $P(@RORESULT@(0),U)=CNT
"RTN","RORRP042",129,0)
 Q
"RTN","RORRP1")
1^111
"RTN","RORRP10")
1^112
"RTN","RORRP2")
1^113
"RTN","RORRP3")
1^114
"RTN","RORRP4")
1^115
"RTN","RORRP5")
1^116
"RTN","RORRP6")
1^117
"RTN","RORRP7")
1^118
"RTN","RORRP8")
1^119
"RTN","RORRP9")
1^120
"RTN","RORSET01")
0^121^B16165599
"RTN","RORSET01",1,0)
RORSET01 ;HCIOFO/SG - REGISTRY SETUP ROUTINE ; 1/27/06 11:00am
"RTN","RORSET01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORSET01",3,0)
 ;
"RTN","RORSET01",4,0)
 ;***** HEPC REGISTRY SETUP
"RTN","RORSET01",5,0)
 ;
"RTN","RORSET01",6,0)
 N RORERROR      ; Error processing data
"RTN","RORSET01",7,0)
 N RORLOG        ; Log subsystem constants & variables
"RTN","RORSET01",8,0)
 N RORPARM       ; Application parameters
"RTN","RORSET01",9,0)
 ;
"RTN","RORSET01",10,0)
 N LSNAME,RC,REGNAME,RORHDT,RORMNTSK,RORREG,RORSUSP,TMP
"RTN","RORSET01",11,0)
 N ZTCPU,ZTDESC,ZTIO,ZTKIL,ZTPRI,ZTRTN,ZTSAVE,ZTSK,ZTSYNC,ZTUCI
"RTN","RORSET01",12,0)
 S RORPARM("ERR")=1         ; Enable error processing
"RTN","RORSET01",13,0)
 S RORPARM("SETUP")=1       ; Registry setup indicator
"RTN","RORSET01",14,0)
 ;
"RTN","RORSET01",15,0)
 ;--- IEN and name of the registry
"RTN","RORSET01",16,0)
 S RORREG=$$SELREG^RORUTL18(.REGNAME)  G:RORREG<0 ERROR
"RTN","RORSET01",17,0)
 Q:'RORREG
"RTN","RORSET01",18,0)
 S $P(RORREG,U,2)=REGNAME,LSNAME=REGNAME
"RTN","RORSET01",19,0)
 ;
"RTN","RORSET01",20,0)
 ;--- Check the Lab Search
"RTN","RORSET01",21,0)
 S RC=$$LABSRCH^RORSETU2(LSNAME)
"RTN","RORSET01",22,0)
 S RC=$S(RC=-55:$$LSCONF^RORSETU1(LSNAME),RC<0:RC,1:1)
"RTN","RORSET01",23,0)
 Q:'RC  G:RC<0 ERROR
"RTN","RORSET01",24,0)
 ;
"RTN","RORSET01",25,0)
 ;--- Request setup parameters
"RTN","RORSET01",26,0)
 S RC=$$ASKPARMS^RORSETU1(.RORMNTSK,.RORSUSP)
"RTN","RORSET01",27,0)
 I RC<0  Q:(RC=-71)!(RC=-72)  G ERROR
"RTN","RORSET01",28,0)
 ;
"RTN","RORSET01",29,0)
 ;--- Schedule the setup task
"RTN","RORSET01",30,0)
 S ZTRTN="TASK^RORSET01",ZTIO=""
"RTN","RORSET01",31,0)
 S ZTDESC="Registry Setup ("_$P(RORREG,U,2)_")"
"RTN","RORSET01",32,0)
 F TMP="RORMNTSK","RORREG","RORSUSP"  S ZTSAVE(TMP)=""
"RTN","RORSET01",33,0)
 D ^%ZTLOAD
"RTN","RORSET01",34,0)
 Q
"RTN","RORSET01",35,0)
ERROR ;--- Display the errors
"RTN","RORSET01",36,0)
 D DSPSTK^RORERR()
"RTN","RORSET01",37,0)
 Q
"RTN","RORSET01",38,0)
 ;
"RTN","RORSET01",39,0)
 ;***** REPLACES THE SELECTION RULES
"RTN","RORSET01",40,0)
 ;
"RTN","RORSET01",41,0)
 ; RORREG        Registry IEN and registry name separated by the '^'
"RTN","RORSET01",42,0)
 ;               (RegistryIEN^RegistryName).
"RTN","RORSET01",43,0)
 ; FROM,TO       Codes of the rule groups (1-regular, 2-historical)
"RTN","RORSET01",44,0)
 ;
"RTN","RORSET01",45,0)
 ; Return Values:
"RTN","RORSET01",46,0)
 ;       <0  Error code
"RTN","RORSET01",47,0)
 ;        0  Ok
"RTN","RORSET01",48,0)
 ;
"RTN","RORSET01",49,0)
RULES(RORREG,FROM,TO) ;
"RTN","RORSET01",50,0)
 ;;VA HEPC PTF^VA HEPC PTF HIST
"RTN","RORSET01",51,0)
 ;;VA HEPC VISIT^VA HEPC VISIT HIST
"RTN","RORSET01",52,0)
 ;
"RTN","RORSET01",53,0)
 N I,IEN,IENS,NAMES,RC,RORFDA,RORMSG
"RTN","RORSET01",54,0)
 S IENS=","_(+RORREG)_",",RC=0
"RTN","RORSET01",55,0)
 ;--- Replace the selection rules
"RTN","RORSET01",56,0)
 F I=1,2  D  Q:RC<0
"RTN","RORSET01",57,0)
 . S NAMES=$P($T(RULES+I),";;",2)  Q:NAMES?."^"
"RTN","RORSET01",58,0)
 . S IEN=$$FIND1^DIC(798.13,IENS,"UX",$P(NAMES,U,FROM),"B",,"RORMSG")
"RTN","RORSET01",59,0)
 . Q:IEN=0
"RTN","RORSET01",60,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.13)
"RTN","RORSET01",61,0)
 . Q:RC<0
"RTN","RORSET01",62,0)
 . S RORFDA(798.13,IEN_IENS,.01)=$P(NAMES,U,TO)
"RTN","RORSET01",63,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORSET01",64,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.13,IEN_IENS)
"RTN","RORSET01",65,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORSET01",66,0)
 ;
"RTN","RORSET01",67,0)
 ;***** ENTRY POINT OF THE REGISTRY SETUP TASK
"RTN","RORSET01",68,0)
 ;
"RTN","RORSET01",69,0)
 ; RORMNTSK      Maximum number of the registry update subtasks
"RTN","RORSET01",70,0)
 ; RORREG        RegistryIEN^RegistryName
"RTN","RORSET01",71,0)
 ; RORSUSP       Task suspension time frame (StartTime^EndTime)
"RTN","RORSET01",72,0)
 ;
"RTN","RORSET01",73,0)
TASK ;
"RTN","RORSET01",74,0)
 N RORERROR      ; Error processing data
"RTN","RORSET01",75,0)
 N RORLOG        ; Log subsystem constants & variables
"RTN","RORSET01",76,0)
 N RORPARM       ; Application parameters
"RTN","RORSET01",77,0)
 ;
"RTN","RORSET01",78,0)
 N RC,REGLST,REGNAME,TMP
"RTN","RORSET01",79,0)
 S RORPARM("DEVELOPER")=1   ; Enable modifications
"RTN","RORSET01",80,0)
 S RORPARM("ERR")=1         ; Enable error processing
"RTN","RORSET01",81,0)
 S RORPARM("LOG")=1         ; Enable event recording
"RTN","RORSET01",82,0)
 S RORPARM("SETUP")=1       ; Registry setup indicator
"RTN","RORSET01",83,0)
 ;
"RTN","RORSET01",84,0)
 S REGNAME=$P(RORREG,U,2),REGLST(REGNAME)=+RORREG
"RTN","RORSET01",85,0)
 ;--- Open a new log
"RTN","RORSET01",86,0)
 S RC=$$OPEN^RORLOG(.REGLST,8,"REGISTRY SETUP STARTED")
"RTN","RORSET01",87,0)
 D
"RTN","RORSET01",88,0)
 . ;--- Replace the selection rules with historical ones
"RTN","RORSET01",89,0)
 . I REGNAME="VA HEPC"  S RC=$$RULES(RORREG,1,2)  Q:RC<0
"RTN","RORSET01",90,0)
 . ;--- Populate the registry
"RTN","RORSET01",91,0)
 . S RC=$$UPDATE^RORUPD(.REGLST,$G(RORMNTSK),$G(RORSUSP),"E")  Q:RC<0
"RTN","RORSET01",92,0)
 . D LOG^RORLOG(2,"The registry has been populated.")
"RTN","RORSET01",93,0)
 . ;--- Convert the ICR 2.1 records
"RTN","RORSET01",94,0)
 . I REGNAME="VA HIV"  D  Q:RC<0
"RTN","RORSET01",95,0)
 . . S RC=$$CONVERT^RORUPD62(RORREG)
"RTN","RORSET01",96,0)
 . . ;--- Update number of patients in registry parameters
"RTN","RORSET01",97,0)
 . . S TMP=$$UPDDEM^RORUPD51(.REGLST)
"RTN","RORSET01",98,0)
 . ;--- Setup the registry
"RTN","RORSET01",99,0)
 . S RC=$$PREPARE^RORSETU2(RORREG)  Q:RC<0
"RTN","RORSET01",100,0)
 ;
"RTN","RORSET01",101,0)
 ;--- Restore the regular selection rules
"RTN","RORSET01",102,0)
 D:REGNAME="VA HEPC"
"RTN","RORSET01",103,0)
 . S TMP=$$RULES(RORREG,2,1)  I TMP<0  S:RC'<0 RC=TMP
"RTN","RORSET01",104,0)
 ;--- Close the log
"RTN","RORSET01",105,0)
 S TMP="REGISTRY SETUP "_$S(RC<0:"ABORTED",1:"COMPLETED")
"RTN","RORSET01",106,0)
 D CLOSE^RORLOG(TMP)
"RTN","RORSET01",107,0)
 ;
"RTN","RORSET01",108,0)
 ;--- Send the notification e-mail
"RTN","RORSET01",109,0)
 S:RC'<0 TMP=$$SENDINFO^RORUTL17(+RORREG,,"EP")
"RTN","RORSET01",110,0)
 ;--- Send an alert to the originator of the task
"RTN","RORSET01",111,0)
 S TMP=$S(RC<0:-43,1:-41)
"RTN","RORSET01",112,0)
 D ALERT^RORKIDS(DUZ,TMP,$P(RORREG,U,2),,"registry setup")
"RTN","RORSET01",113,0)
 ;
"RTN","RORSET01",114,0)
 ;--- Cleanup
"RTN","RORSET01",115,0)
 I RC'<0  D  S ZTREQ="@"
"RTN","RORSET01",116,0)
 . K ^XTMP("RORUPDR"_+RORREG)
"RTN","RORSET01",117,0)
 Q
"RTN","RORSETU1")
0^122^B9739381
"RTN","RORSETU1",1,0)
RORSETU1 ;HCIOFO/SG - SETUP UTILITIES (USER INTERFACE) ; 6/10/03 8:28am
"RTN","RORSETU1",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORSETU1",3,0)
 ;
"RTN","RORSETU1",4,0)
 Q
"RTN","RORSETU1",5,0)
 ;
"RTN","RORSETU1",6,0)
 ;***** REQUESTS SETUP PARAMETERS FROM THE USER
"RTN","RORSETU1",7,0)
 ;
"RTN","RORSETU1",8,0)
 ; .MAXNTSK      Maximum number of registry update subtasks is
"RTN","RORSETU1",9,0)
 ;               returned via this parameter
"RTN","RORSETU1",10,0)
 ;
"RTN","RORSETU1",11,0)
 ; .SUSPEND      Start and end times of registry setup suspension
"RTN","RORSETU1",12,0)
 ;               are returned via this parameter
"RTN","RORSETU1",13,0)
 ;
"RTN","RORSETU1",14,0)
 ; Return Values:
"RTN","RORSETU1",15,0)
 ;       <0  Error code
"RTN","RORSETU1",16,0)
 ;        0  Ok
"RTN","RORSETU1",17,0)
 ;
"RTN","RORSETU1",18,0)
ASKPARMS(MAXNTSK,SUSPEND) ;
"RTN","RORSETU1",19,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,RC,X,Y
"RTN","RORSETU1",20,0)
 S MAXNTSK=0,SUSPEND=""
"RTN","RORSETU1",21,0)
 ;---
"RTN","RORSETU1",22,0)
 K DIR  S DIR(0)="N^0:10:0",DIR("B")=5
"RTN","RORSETU1",23,0)
 S DIR("A")="Maximum number of registry update subtasks"
"RTN","RORSETU1",24,0)
 D BLD^DIALOG(7980000.009,,,"DIR(""?"")","S")
"RTN","RORSETU1",25,0)
 D ^DIR
"RTN","RORSETU1",26,0)
 Q:$D(DUOUT) -71  Q:$D(DTOUT) -72
"RTN","RORSETU1",27,0)
 S MAXNTSK=Y
"RTN","RORSETU1",28,0)
 ;---
"RTN","RORSETU1",29,0)
 K DIR  S DIR(0)="Y",DIR("B")="NO"
"RTN","RORSETU1",30,0)
 S DIR("A")="Suspend the post-install during the peak hours"
"RTN","RORSETU1",31,0)
 D BLD^DIALOG(7980000.01,,,"DIR(""?"")","S")
"RTN","RORSETU1",32,0)
 D ^DIR
"RTN","RORSETU1",33,0)
 Q:$D(DUOUT) -71  Q:$D(DTOUT) -72
"RTN","RORSETU1",34,0)
 ;---
"RTN","RORSETU1",35,0)
 S RC=0
"RTN","RORSETU1",36,0)
 F  Q:'$G(Y)  D  Q:RC<0
"RTN","RORSETU1",37,0)
 . K DIR  S DIR(0)="D^::R",DIR("B")="7:00AM"
"RTN","RORSETU1",38,0)
 . S DIR("A")="Suspension start time"
"RTN","RORSETU1",39,0)
 . D BLD^DIALOG(7980000.011,,,"DIR(""?"")","S")
"RTN","RORSETU1",40,0)
 . D ^DIR
"RTN","RORSETU1",41,0)
 . I $D(DUOUT)  S RC=-71  Q
"RTN","RORSETU1",42,0)
 . I $D(DTOUT)  S RC=-72  Q
"RTN","RORSETU1",43,0)
 . S $P(SUSPEND,U,1)=Y#1
"RTN","RORSETU1",44,0)
 . ;---
"RTN","RORSETU1",45,0)
 . K DIR  S DIR(0)="D^::R",DIR("B")="6:00PM"
"RTN","RORSETU1",46,0)
 . S DIR("A")="Suspension end time"
"RTN","RORSETU1",47,0)
 . D BLD^DIALOG(7980000.012,,,"DIR(""?"")","S")
"RTN","RORSETU1",48,0)
 . D ^DIR
"RTN","RORSETU1",49,0)
 . I $D(DUOUT)  S RC=-71  Q
"RTN","RORSETU1",50,0)
 . I $D(DTOUT)  S RC=-72  Q
"RTN","RORSETU1",51,0)
 . S $P(SUSPEND,U,2)=Y#1
"RTN","RORSETU1",52,0)
 . ;---
"RTN","RORSETU1",53,0)
 . I $P(SUSPEND,U,2)>$P(SUSPEND,U,1)  S Y=0  Q
"RTN","RORSETU1",54,0)
 . W " ??",!!,"The end time must be later than the start time.",!
"RTN","RORSETU1",55,0)
 ;---
"RTN","RORSETU1",56,0)
 D:'RC CONFTXT(MAXNTSK,SUSPEND)
"RTN","RORSETU1",57,0)
 ;---
"RTN","RORSETU1",58,0)
 Q RC
"RTN","RORSETU1",59,0)
 ;
"RTN","RORSETU1",60,0)
 ;***** GENERATES THE TEXT OF CONFIRMATION REQUEST
"RTN","RORSETU1",61,0)
 ;
"RTN","RORSETU1",62,0)
 ; MAXNTSK       Maximum number of registry update subtasks
"RTN","RORSETU1",63,0)
 ; SUSPEND       Task suspension parameters
"RTN","RORSETU1",64,0)
 ;
"RTN","RORSETU1",65,0)
CONFTXT(MAXNTSK,SUSPEND) ;
"RTN","RORSETU1",66,0)
 N TMP
"RTN","RORSETU1",67,0)
 W !
"RTN","RORSETU1",68,0)
 W !,"  ============================================="
"RTN","RORSETU1",69,0)
 S TMP=$S(MAXNTSK>0:MAXNTSK,1:1)
"RTN","RORSETU1",70,0)
 W !,"  Number of registry update (sub)tasks... "_TMP
"RTN","RORSETU1",71,0)
 S TMP=$S(SUSPEND:"Yes",1:"No")
"RTN","RORSETU1",72,0)
 W !,"  Suspend the tasks during peak hours.... "_TMP
"RTN","RORSETU1",73,0)
 D:SUSPEND
"RTN","RORSETU1",74,0)
 . S TMP=$P($$FMTE^XLFDT(DT+$P(SUSPEND,U,1),"F"),"@",2)
"RTN","RORSETU1",75,0)
 . W !,"  Suspend the tasks at................... "_TMP
"RTN","RORSETU1",76,0)
 . S TMP=$P($$FMTE^XLFDT(DT+$P(SUSPEND,U,2),"F"),"@",2)
"RTN","RORSETU1",77,0)
 . W !,"  Resume the tasks at.................... "_TMP
"RTN","RORSETU1",78,0)
 W !,"  ============================================="
"RTN","RORSETU1",79,0)
 W !
"RTN","RORSETU1",80,0)
 Q
"RTN","RORSETU1",81,0)
 ;
"RTN","RORSETU1",82,0)
 ;***** ASKS FOR CONFIRMATION IF THERE ARE NO SEARCH INDICATORS
"RTN","RORSETU1",83,0)
 ;
"RTN","RORSETU1",84,0)
 ; LSNAME        Name of the Lab Search
"RTN","RORSETU1",85,0)
 ;
"RTN","RORSETU1",86,0)
 ; Return Values:
"RTN","RORSETU1",87,0)
 ;       <0  Error code
"RTN","RORSETU1",88,0)
 ;        0  Exit the registry setup
"RTN","RORSETU1",89,0)
 ;       >1  Continue the setup
"RTN","RORSETU1",90,0)
 ;
"RTN","RORSETU1",91,0)
LSCONF(LSNAME) ;
"RTN","RORSETU1",92,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,RC,X,Y
"RTN","RORSETU1",93,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RORSETU1",94,0)
 S DIR("A")="Continue the registry setup"
"RTN","RORSETU1",95,0)
 S DIR("A",1)=""
"RTN","RORSETU1",96,0)
 S DIR("A",2)="The '"_LSNAME_"' Lab Search contains no active search indicators."
"RTN","RORSETU1",97,0)
 D ^DIR
"RTN","RORSETU1",98,0)
 Q $S($D(DUOUT):-71,$D(DTOUT):-72,1:+Y)
"RTN","RORSETU2")
0^123^B9293827
"RTN","RORSETU2",1,0)
RORSETU2 ;HCIOFO/SG - SETUP UTILITIES (REGISTRY) ; 1/23/06 10:35am
"RTN","RORSETU2",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORSETU2",3,0)
 ;
"RTN","RORSETU2",4,0)
 Q
"RTN","RORSETU2",5,0)
 ;
"RTN","RORSETU2",6,0)
 ;***** DRAWS THE BOUNDARY BETWEEN HISTORICAL AND REGULAR EXTRACTIONS
"RTN","RORSETU2",7,0)
 ;
"RTN","RORSETU2",8,0)
 ; REGIEN        Registry IEN
"RTN","RORSETU2",9,0)
 ; .BNDRYDT      Date that represents a boundary between historical
"RTN","RORSETU2",10,0)
 ;               data extraction and regular data extracts is returned
"RTN","RORSETU2",11,0)
 ;               via this parameter.
"RTN","RORSETU2",12,0)
 ;
"RTN","RORSETU2",13,0)
 ; Return Values:
"RTN","RORSETU2",14,0)
 ;       <0  Error code
"RTN","RORSETU2",15,0)
 ;      >=0  Statistics
"RTN","RORSETU2",16,0)
 ;             ^1: Total number of processed records
"RTN","RORSETU2",17,0)
 ;             ^2: Number of records processed with errors
"RTN","RORSETU2",18,0)
 ;
"RTN","RORSETU2",19,0)
 ; The function calculates a date that will be a boundary between
"RTN","RORSETU2",20,0)
 ; historical data extraction and regular data extractions. This date
"RTN","RORSETU2",21,0)
 ; is stored to all records of the registry. Moreover, the date is
"RTN","RORSETU2",22,0)
 ; returned as a value of the second parameter.
"RTN","RORSETU2",23,0)
 ;
"RTN","RORSETU2",24,0)
BNDRYDT(REGIEN,BNDRYDT) ;
"RTN","RORSETU2",25,0)
 N CNT,DATE,ECNT,IEN,IENS,LD1,PATIEN,RC,ROOT,RORFDA,RORMSG,TMP
"RTN","RORSETU2",26,0)
 S ROOT=$$ROOT^DILFD(798,,1)
"RTN","RORSETU2",27,0)
 ;--- Get the lag period
"RTN","RORSETU2",28,0)
 S LD1=$$GET1^DIQ(798.1,REGIEN_",",15.1,,,"RORMSG")
"RTN","RORSETU2",29,0)
 S RC=$$DBS^RORERR("RORMSG",-9)  Q:RC<0 RC
"RTN","RORSETU2",30,0)
 ;--- Calculate the date
"RTN","RORSETU2",31,0)
 S BNDRYDT=$$FMADD^XLFDT($$DT^XLFDT,-$S(LD1>0:LD1,1:1)-1)
"RTN","RORSETU2",32,0)
 ;--- Store the date into the records of the registry
"RTN","RORSETU2",33,0)
 S IEN="",(CNT,ECNT)=0
"RTN","RORSETU2",34,0)
 F  S IEN=$O(@ROOT@("AC",REGIEN,IEN))  Q:IEN=""  D
"RTN","RORSETU2",35,0)
 . S CNT=CNT+1,IENS=IEN_",",DATE=BNDRYDT
"RTN","RORSETU2",36,0)
 . ;--- Update the record
"RTN","RORSETU2",37,0)
 . S RORFDA(798,IENS,9.1)=DATE
"RTN","RORSETU2",38,0)
 . S RORFDA(798,IENS,9.2)=DATE
"RTN","RORSETU2",39,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORSETU2",40,0)
 . I $G(DIERR)  D  S ECNT=ECNT+1  Q
"RTN","RORSETU2",41,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9)
"RTN","RORSETU2",42,0)
 Q $S(RC<0:RC,1:CNT_U_ECNT)
"RTN","RORSETU2",43,0)
 ;
"RTN","RORSETU2",44,0)
 ;***** CHECKS THE LAB SEARCH CRITERION
"RTN","RORSETU2",45,0)
 ;
"RTN","RORSETU2",46,0)
 ; LSNAME        Name of the Lab search criterion
"RTN","RORSETU2",47,0)
 ;
"RTN","RORSETU2",48,0)
 ; This function uses the ^TMP("DILIST",$J) global node.
"RTN","RORSETU2",49,0)
 ;
"RTN","RORSETU2",50,0)
 ; Return Values:
"RTN","RORSETU2",51,0)
 ;       <0  Error code
"RTN","RORSETU2",52,0)
 ;        0  Ok
"RTN","RORSETU2",53,0)
 ;
"RTN","RORSETU2",54,0)
LABSRCH(LSNAME) ;
"RTN","RORSETU2",55,0)
 N IEN,IENS,IR,LSICNT,RC,RORMSG,TMP
"RTN","RORSETU2",56,0)
 ;--- Find the definition
"RTN","RORSETU2",57,0)
 S IENS=$$FIND1^DIC(798.9,,"X",LSNAME,"B",,"RORMSG")_","
"RTN","RORSETU2",58,0)
 S RC=$$DBS^RORERR("RORMSG",-9)  Q:RC<0 RC
"RTN","RORSETU2",59,0)
 Q:IENS'>0 $$ERROR^RORERR(-54,,,,LSNAME)
"RTN","RORSETU2",60,0)
 ;--- Load the search indicators
"RTN","RORSETU2",61,0)
 D LIST^DIC(798.92,","_IENS,"@;1I",,,,,"B",,,,"RORMSG")
"RTN","RORSETU2",62,0)
 S RC=$$DBS^RORERR("RORMSG",-9)  Q:RC<0 RC
"RTN","RORSETU2",63,0)
 ;--- Check the search indicators
"RTN","RORSETU2",64,0)
 S IR="",LSICNT=0
"RTN","RORSETU2",65,0)
 F  S IR=$O(^TMP("DILIST",$J,"ID",IR))  Q:IR=""  D
"RTN","RORSETU2",66,0)
 . S:$G(^TMP("DILIST",$J,"ID",IR,1))>0 LSICNT=LSICNT+1
"RTN","RORSETU2",67,0)
 ;--- Process the errors (if any)
"RTN","RORSETU2",68,0)
 Q:LSICNT'>0 $$ERROR^RORERR(-55,,,,LSNAME)
"RTN","RORSETU2",69,0)
 Q 0
"RTN","RORSETU2",70,0)
 ;
"RTN","RORSETU2",71,0)
 ;***** PREPARES REGISTRY RECORDS
"RTN","RORSETU2",72,0)
 ;
"RTN","RORSETU2",73,0)
 ; RORREG        Registry IEN and registry name separated by the '^'
"RTN","RORSETU2",74,0)
 ;               (RegistryIEN^RegistryName).
"RTN","RORSETU2",75,0)
 ;
"RTN","RORSETU2",76,0)
 ; Return Values:
"RTN","RORSETU2",77,0)
 ;       <0  Error code
"RTN","RORSETU2",78,0)
 ;        0  Ok
"RTN","RORSETU2",79,0)
 ;
"RTN","RORSETU2",80,0)
PREPARE(RORREG) ;
"RTN","RORSETU2",81,0)
 ;;Data extraction boundary (historical/regular) has been established.
"RTN","RORSETU2",82,0)
 ;;Parameters of the historical data extraction have been updated.
"RTN","RORSETU2",83,0)
 ;
"RTN","RORSETU2",84,0)
 N DATE,RC,TMP
"RTN","RORSETU2",85,0)
 ;--- Modify records of the registry
"RTN","RORSETU2",86,0)
 S RC=$$BNDRYDT(+RORREG,.DATE)  Q:RC<0 RC
"RTN","RORSETU2",87,0)
 S TMP="Processed records: "_+RC_", Errors: "_+$P(RC,U,2)
"RTN","RORSETU2",88,0)
 D LOG^RORLOG(2,$P($T(PREPARE+1),";;",2),,TMP)
"RTN","RORSETU2",89,0)
 ;--- Update the registry parameters of historical data extraction
"RTN","RORSETU2",90,0)
 S RC=$$UPDHDTRP(+RORREG,DATE)  Q:RC<0 RC
"RTN","RORSETU2",91,0)
 D LOG^RORLOG(2,$P($T(PREPARE+2),";;",2))
"RTN","RORSETU2",92,0)
 Q 0
"RTN","RORSETU2",93,0)
 ;
"RTN","RORSETU2",94,0)
 ;***** UPDATES REGISTRY PARAMETERS OF THE HISTORICAL DATA EXTRACTION
"RTN","RORSETU2",95,0)
 ;
"RTN","RORSETU2",96,0)
 ; REGIEN        Registry IEN
"RTN","RORSETU2",97,0)
 ; HDTEDT        Date that represents a boundary between historical
"RTN","RORSETU2",98,0)
 ;               data extraction and regular data extracts
"RTN","RORSETU2",99,0)
 ;
"RTN","RORSETU2",100,0)
 ; Return Values:
"RTN","RORSETU2",101,0)
 ;       <0  Error code
"RTN","RORSETU2",102,0)
 ;        0  Ok
"RTN","RORSETU2",103,0)
 ;
"RTN","RORSETU2",104,0)
UPDHDTRP(REGIEN,HDTEDT) ;
"RTN","RORSETU2",105,0)
 N IENS,RC,RORFDA,RORMSG
"RTN","RORSETU2",106,0)
 S IENS=REGIEN_","
"RTN","RORSETU2",107,0)
 ;--- Prepare the data
"RTN","RORSETU2",108,0)
 S RORFDA(798.1,IENS,21.05)=$$NOW^XLFDT      ; Timestamp
"RTN","RORSETU2",109,0)
 ;--- Update historical data extraction parameters
"RTN","RORSETU2",110,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORSETU2",111,0)
 S RC=$$DBS^RORERR("RORMSG",-9)
"RTN","RORSETU2",112,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORTMP")
0^206^B2339215
"RTN","RORTMP",1,0)
RORTMP ;HCIOFO/SG - TEMPORARY GLOBAL STORAGE ; 10/14/05 1:41pm
"RTN","RORTMP",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORTMP",3,0)
 ;
"RTN","RORTMP",4,0)
 ; DO NOT use this API to pass the data between tasks!
"RTN","RORTMP",5,0)
 ;
"RTN","RORTMP",6,0)
 Q
"RTN","RORTMP",7,0)
 ;
"RTN","RORTMP",8,0)
 ;***** ALLOCATES A TEMPORARY GLOBAL BUFFER
"RTN","RORTMP",9,0)
 ;
"RTN","RORTMP",10,0)
 ; [.SUBS]       Subscript of the buffer is returned here
"RTN","RORTMP",11,0)
 ;
"RTN","RORTMP",12,0)
 ; Return Values:
"RTN","RORTMP",13,0)
 ;           Closed root of the buffer
"RTN","RORTMP",14,0)
 ;
"RTN","RORTMP",15,0)
ALLOC(SUBS) ;
"RTN","RORTMP",16,0)
 N NDX,NODE
"RTN","RORTMP",17,0)
 S NDX=$O(^TMP($J,"RORTMP-0",""),-1)+1
"RTN","RORTMP",18,0)
 S SUBS="RORTMP-"_NDX,NODE=$NA(^TMP($J,SUBS))  K @NODE
"RTN","RORTMP",19,0)
 S ^TMP($J,"RORTMP-0",NDX)=""
"RTN","RORTMP",20,0)
 Q NODE
"RTN","RORTMP",21,0)
 ;
"RTN","RORTMP",22,0)
 ;***** FREES THE TEMPORARY GLOBAL BUFFER
"RTN","RORTMP",23,0)
 ;
"RTN","RORTMP",24,0)
 ; NODE          Closed root of the temporary global buffer
"RTN","RORTMP",25,0)
 ;
"RTN","RORTMP",26,0)
FREE(NODE) ;
"RTN","RORTMP",27,0)
 N NDX  S NDX=$$NDX(NODE)
"RTN","RORTMP",28,0)
 K:NDX>0 ^TMP($J,"RORTMP-0",NDX),@NODE
"RTN","RORTMP",29,0)
 Q
"RTN","RORTMP",30,0)
 ;
"RTN","RORTMP",31,0)
 ;***** EXTRACTS THE INDEX FROM THE CLOSED ROOT OF THE BUFFER
"RTN","RORTMP",32,0)
 ;
"RTN","RORTMP",33,0)
 ; NODE          Closed root of the temporary global buffer
"RTN","RORTMP",34,0)
 ;
"RTN","RORTMP",35,0)
 ; Return Values:
"RTN","RORTMP",36,0)
 ;        0  Invalid closed root
"RTN","RORTMP",37,0)
 ;       >0  Index of the buffer
"RTN","RORTMP",38,0)
 ;
"RTN","RORTMP",39,0)
NDX(NODE) ;
"RTN","RORTMP",40,0)
 N SUBS
"RTN","RORTMP",41,0)
 Q:$E(NODE,1)'="^" 0
"RTN","RORTMP",42,0)
 Q:$NA(@NODE,1)'=$NA(^TMP($J)) 0
"RTN","RORTMP",43,0)
 S SUBS=$QS(NODE,2)
"RTN","RORTMP",44,0)
 Q:$P(SUBS,"-")'="RORTMP" 0
"RTN","RORTMP",45,0)
 S NDX=+$P(SUBS,"-",2)
"RTN","RORTMP",46,0)
 Q $S(NDX>0:NDX,1:0)
"RTN","RORTMP",47,0)
 ;
"RTN","RORTMP",48,0)
 ;***** FREES THE LAST ALLOCATED BUFFER(S)
"RTN","RORTMP",49,0)
 ;
"RTN","RORTMP",50,0)
 ; [NODE]        Closed root of the temporary global buffer.
"RTN","RORTMP",51,0)
 ;
"RTN","RORTMP",52,0)
 ;               If this parameter is defined and references a
"RTN","RORTMP",53,0)
 ;               valid temporary buffer, then this buffer and
"RTN","RORTMP",54,0)
 ;               all others allocated after it are freed.
"RTN","RORTMP",55,0)
 ;
"RTN","RORTMP",56,0)
 ;               Otherwise, only the last buffer is freed.
"RTN","RORTMP",57,0)
 ;
"RTN","RORTMP",58,0)
POP(NODE) ;
"RTN","RORTMP",59,0)
 N NDX  S NDX=$$NDX($G(NODE))
"RTN","RORTMP",60,0)
 S:NDX'>0 NDX=+$O(^TMP($J,"RORTMP-0",""),-1)
"RTN","RORTMP",61,0)
 F  Q:NDX'>0  D  S NDX=$O(^TMP($J,"RORTMP-0",NDX))
"RTN","RORTMP",62,0)
 . D FREE($NA(^TMP($J,"RORTMP-"_NDX)))
"RTN","RORTMP",63,0)
 Q
"RTN","RORTMP",64,0)
 ;
"RTN","RORTMP",65,0)
 ;***** DELETES ALL TEMPORARY BUFFERS
"RTN","RORTMP",66,0)
PURGE ;
"RTN","RORTMP",67,0)
 N I  S I="RORTMP-"
"RTN","RORTMP",68,0)
 F  S I=$O(^TMP($J,I))  Q:$E(I,1,7)'="RORTMP-"  K ^TMP($J,I)
"RTN","RORTMP",69,0)
 Q
"RTN","RORTSK")
0^124^B23508484
"RTN","RORTSK",1,0)
RORTSK ;HCIOFO/SG - TASK MANAGER ; 1/22/06 6:26pm
"RTN","RORTSK",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORTSK",3,0)
 ;
"RTN","RORTSK",4,0)
 Q
"RTN","RORTSK",5,0)
 ;
"RTN","RORTSK",6,0)
 ;***** CREATES AND SCHEDULES A TASK
"RTN","RORTSK",7,0)
 ;
"RTN","RORTSK",8,0)
 ; TYPE          Type of the task (1 - Generic, 2 - Report)
"RTN","RORTSK",9,0)
 ;
"RTN","RORTSK",10,0)
 ; ZTRTN         The entry point TaskMan will DO to start the task.
"RTN","RORTSK",11,0)
 ;
"RTN","RORTSK",12,0)
 ;               This parameter can also have the $$TAG^ROUTINE
"RTN","RORTSK",13,0)
 ;               format. In this case, the "proxy task" will be used.
"RTN","RORTSK",14,0)
 ;               The value of the parameter will be saved in the
"RTN","RORTSK",15,0)
 ;               RORTSK("EP") node and the "TASK^RORTSK01" will be
"RTN","RORTSK",16,0)
 ;               assigned to the ZTRTN variable. See the TASK^RORTSK01
"RTN","RORTSK",17,0)
 ;               for more details.
"RTN","RORTSK",18,0)
 ;
"RTN","RORTSK",19,0)
 ; [.PARAMS]     Reference to a local variable that contains a list
"RTN","RORTSK",20,0)
 ;               of name-value pairs of the task parameters.
"RTN","RORTSK",21,0)
 ;               The parameters are passed to the task as sub-nodes
"RTN","RORTSK",22,0)
 ;               of the "PARAMS" node of the RORTSK local variable.
"RTN","RORTSK",23,0)
 ;
"RTN","RORTSK",24,0)
 ;               Examples:
"RTN","RORTSK",25,0)
 ;
"RTN","RORTSK",26,0)
 ;                 PARAMS("NUM")=10    ==> RORTSK("PARAMS","NUM")=10
"RTN","RORTSK",27,0)
 ;                 PARAMS("A(10)")="B" ==> RORTSK("PARAMS","A",10)="B"
"RTN","RORTSK",28,0)
 ;
"RTN","RORTSK",29,0)
 ; [REGIEN]      Registry IEN (if $G(REGIEN)'>0 the task will not
"RTN","RORTSK",30,0)
 ;               be associated with any particular registry).
"RTN","RORTSK",31,0)
 ;
"RTN","RORTSK",32,0)
 ; [REPORT]      Code of the report (if the TYPE = 2).
"RTN","RORTSK",33,0)
 ;
"RTN","RORTSK",34,0)
 ; [SCHCODE]     Rescheduling code for the task. By default (if
"RTN","RORTSK",35,0)
 ;               $G(SCHCODE)=""), the task is executed once. See
"RTN","RORTSK",36,0)
 ;               description of the $$SCH^XLFDT function for
"RTN","RORTSK",37,0)
 ;               possible values of the parameter).
"RTN","RORTSK",38,0)
 ;
"RTN","RORTSK",39,0)
 ; [.RORTSKPP]   Reference to a local variable that contains a task
"RTN","RORTSK",40,0)
 ;               descriptor with already prepared task parameters
"RTN","RORTSK",41,0)
 ;               (under the "PARAMS" subscript). These parameters
"RTN","RORTSK",42,0)
 ;               are copied into the new task descriptor "as is".
"RTN","RORTSK",43,0)
 ;
"RTN","RORTSK",44,0)
 ; All other input variables used by the %ZTLOAD (except the ZTRTN)
"RTN","RORTSK",45,0)
 ; can be used to control the task. Modifications of the default
"RTN","RORTSK",46,0)
 ; behavior of some of those variables are described below.
"RTN","RORTSK",47,0)
 ;
"RTN","RORTSK",48,0)
 ; [ZTDESC]      Task description
"RTN","RORTSK",49,0)
 ;
"RTN","RORTSK",50,0)
 ; [ZTDTH]       Date/time to start the task (FileMan). By default
"RTN","RORTSK",51,0)
 ;               (if $G(ZTDTH)=""), the task is scheduled to run
"RTN","RORTSK",52,0)
 ;               with a 3 second delay.
"RTN","RORTSK",53,0)
 ;
"RTN","RORTSK",54,0)
 ; [ZTIO]        Output device. By default (if $G(ZTIO)=""), the
"RTN","RORTSK",55,0)
 ;               task is started without an output device.
"RTN","RORTSK",56,0)
 ;
"RTN","RORTSK",57,0)
 ; [ZTSAVE]      List of variables that should be passed to the task.
"RTN","RORTSK",58,0)
 ;               The CREATE^RORTSK function adds the "RORTSK(" item
"RTN","RORTSK",59,0)
 ;               to the list if the task proxy is requested (see the
"RTN","RORTSK",60,0)
 ;               ZTRTN parameter for details) or the PARAMS parameter
"RTN","RORTSK",61,0)
 ;               is defined.
"RTN","RORTSK",62,0)
 ;
"RTN","RORTSK",63,0)
 ; Return values:
"RTN","RORTSK",64,0)
 ;       <0  Error code
"RTN","RORTSK",65,0)
 ;       >0  Task Number
"RTN","RORTSK",66,0)
 ;
"RTN","RORTSK",67,0)
CREATE(TYPE,ZTRTN,PARAMS,REGIEN,REPORT,SCHCODE,RORTSKPP) ;
"RTN","RORTSK",68,0)
 N DESCR,IENS,RC,RORFDA,RORIEN,RORMSG,RORTSK,RPTIEN,TMP,ZTSK
"RTN","RORTSK",69,0)
 S (RC,RPTIEN)=0
"RTN","RORTSK",70,0)
 I $G(REGIEN)>0  D  Q:RC<0 RC
"RTN","RORTSK",71,0)
 . I TYPE=2  D  I RPTIEN<0  S RC=RPTIEN  Q
"RTN","RORTSK",72,0)
 . . S RPTIEN=$$RPIEN^RORUTL08(REPORT,.DESCR)
"RTN","RORTSK",73,0)
 E  S REGIEN=0
"RTN","RORTSK",74,0)
 ;--- Task parameters
"RTN","RORTSK",75,0)
 M RORTSK("PARAMS")=RORTSKPP("PARAMS")
"RTN","RORTSK",76,0)
 I $D(PARAMS)>1  D  Q:RC<0 RC
"RTN","RORTSK",77,0)
 . S RC=$$PARAMS^RORTSK03(.PARAMS)
"RTN","RORTSK",78,0)
 . ;--- If there is the TASK_DESCR parameter in
"RTN","RORTSK",79,0)
 . ;    the list use its value as the task description
"RTN","RORTSK",80,0)
 . ;--- (if the ZTDESC variable is not defined)
"RTN","RORTSK",81,0)
 . S TMP=$$PARAM^RORTSK01("TASK_DESCR")
"RTN","RORTSK",82,0)
 . S:TMP'="" DESCR=$E(TMP,1,200)
"RTN","RORTSK",83,0)
 ;--- Registry IEN
"RTN","RORTSK",84,0)
 D:'$D(RORTSK("PARAMS","REGIEN"))
"RTN","RORTSK",85,0)
 . S RORTSK("PARAMS","REGIEN")=+$G(REGIEN)
"RTN","RORTSK",86,0)
 ;--- Prepare the task description
"RTN","RORTSK",87,0)
 I $G(ZTDESC)=""  D  Q:RC<0 RC
"RTN","RORTSK",88,0)
 . I $G(DESCR)'=""  S ZTDESC=DESCR  Q
"RTN","RORTSK",89,0)
 . S DESCR=$$EXTERNAL^DILFD(798.8,.02,,TYPE,"RORMSG")
"RTN","RORTSK",90,0)
 . I $G(DIERR)  D  Q
"RTN","RORTSK",91,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,798.8)
"RTN","RORTSK",92,0)
 . S (DESCR,ZTDESC)=DESCR_" Task started from the GUI"
"RTN","RORTSK",93,0)
 E  S DESCR=ZTDESC
"RTN","RORTSK",94,0)
 S:$L(DESCR)>60 DESCR=$E(DESCR,1,57)_"..."
"RTN","RORTSK",95,0)
 ;--- Check if the task proxy should be used
"RTN","RORTSK",96,0)
 I $E(ZTRTN,1,2)="$$"  D  S ZTRTN="TASK^RORTSK01"
"RTN","RORTSK",97,0)
 . S RORTSK("EP")=ZTRTN  Q:$G(SCHCODE)=""
"RTN","RORTSK",98,0)
 . F TMP="TYPE","REGIEN","REPORT","SCHCODE"  D
"RTN","RORTSK",99,0)
 . . S RORTSK(TMP)=$G(@TMP)
"RTN","RORTSK",100,0)
 ;--- If the task is scheduled to run immediately, postpone the start
"RTN","RORTSK",101,0)
 ;--- for 3 seconds to make sure that the task record is created
"RTN","RORTSK",102,0)
 S TMP=$$NOW^XLFDT
"RTN","RORTSK",103,0)
 I $G(ZTDTH)>0,$$FMDIFF^XLFDT(ZTDTH,TMP,2)>3
"RTN","RORTSK",104,0)
 E  S ZTDTH=$$FMADD^XLFDT(TMP,,,,3)
"RTN","RORTSK",105,0)
 ;--- Schedule the task
"RTN","RORTSK",106,0)
 S:'($D(ZTIO)#10) ZTIO=""
"RTN","RORTSK",107,0)
 S ZTSAVE("RORTSK(")=""
"RTN","RORTSK",108,0)
 D ^%ZTLOAD
"RTN","RORTSK",109,0)
 Q:'$G(ZTSK) $$ERROR^RORERR(-82,,,,ZTRTN,ZTDTH)
"RTN","RORTSK",110,0)
 S RORTSK=ZTSK
"RTN","RORTSK",111,0)
 ;--- Prepare data for the record in the ROR TASK file
"RTN","RORTSK",112,0)
 S IENS="+1,"
"RTN","RORTSK",113,0)
 S (RORFDA(798.8,IENS,.01),RORIEN(1))=RORTSK    ; Task Number
"RTN","RORTSK",114,0)
 S RORFDA(798.8,IENS,.02)=+TYPE                 ; Type
"RTN","RORTSK",115,0)
 D:REGIEN>0
"RTN","RORTSK",116,0)
 . S RORFDA(798.8,IENS,.03)=+REGIEN             ; Registry
"RTN","RORTSK",117,0)
 . S:RPTIEN RORFDA(798.8,IENS,.04)=RPTIEN       ; IEN of report par.
"RTN","RORTSK",118,0)
 S RORFDA(798.8,IENS,.05)=DESCR                 ; Description
"RTN","RORTSK",119,0)
 S TMP=$$PARAM^RORTSK01("TASK_COMMENT")
"RTN","RORTSK",120,0)
 S:TMP'?." " RORFDA(798.8,IENS,1.01)=TMP        ; Comment
"RTN","RORTSK",121,0)
 ;--- Create the record
"RTN","RORTSK",122,0)
 D UPDATE^DIE(,"RORFDA","RORIEN","RORMSG")
"RTN","RORTSK",123,0)
 I $G(DIERR)  D  Q RC
"RTN","RORTSK",124,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.8,IENS)
"RTN","RORTSK",125,0)
 . ;--- Try to unschedule the task if the record has not been created
"RTN","RORTSK",126,0)
 . S ZTSK=RORTSK  D DQ^%ZTLOAD
"RTN","RORTSK",127,0)
 Q RORTSK
"RTN","RORTSK",128,0)
 ;
"RTN","RORTSK",129,0)
 ;***** DEQUEUES AND/OR DELETES THE TASK
"RTN","RORTSK",130,0)
 ;
"RTN","RORTSK",131,0)
 ; TASK          Task number
"RTN","RORTSK",132,0)
 ;
"RTN","RORTSK",133,0)
 ; [DELETE]      Delete the task from the Taskman and the task
"RTN","RORTSK",134,0)
 ;               record from the ROR TASK file (#798.8) if this
"RTN","RORTSK",135,0)
 ;               parameter has a non-zero value.
"RTN","RORTSK",136,0)
 ;
"RTN","RORTSK",137,0)
 ; Return Values:
"RTN","RORTSK",138,0)
 ;       <0  Error code
"RTN","RORTSK",139,0)
 ;        0  Ok
"RTN","RORTSK",140,0)
 ;        1  No responce from the task
"RTN","RORTSK",141,0)
 ;
"RTN","RORTSK",142,0)
DEQUEUE(TASK,DELETE) ;
"RTN","RORTSK",143,0)
 N DA,DIK,I,RC,STATUS,TASKNODE,ZTSK
"RTN","RORTSK",144,0)
 S STATUS=+$$STATUS^RORTSK02(TASK,,1)
"RTN","RORTSK",145,0)
 I STATUS<0  Q $S(STATUS=-83:0,1:STATUS)
"RTN","RORTSK",146,0)
 S TASKNODE=$NA(^RORDATA(798.8,TASK))
"RTN","RORTSK",147,0)
 ;--- Unschedule the task
"RTN","RORTSK",148,0)
 I STATUS=1  S ZTSK=TASK  D DQ^%ZTLOAD
"RTN","RORTSK",149,0)
 ;--- Stop the task if it is running
"RTN","RORTSK",150,0)
 S STATUS=+$$STATUS^RORTSK02(TASK)
"RTN","RORTSK",151,0)
 S:(STATUS=2)!(STATUS=102) @TASKNODE@("A")=2
"RTN","RORTSK",152,0)
 Q:'$G(DELETE) 0
"RTN","RORTSK",153,0)
 ;--- Wait for a response from the task
"RTN","RORTSK",154,0)
 S STATUS=+$$STATUS^RORTSK02(TASK,3)  Q:STATUS<0 STATUS
"RTN","RORTSK",155,0)
 Q:STATUS=103 1
"RTN","RORTSK",156,0)
 ;--- Kill the REPORT ELEMENT multiple to avoid delays in ^DIK
"RTN","RORTSK",157,0)
 K @TASKNODE@("RI")
"RTN","RORTSK",158,0)
 ;--- Delete the task record
"RTN","RORTSK",159,0)
 S DIK="^RORDATA(798.8,",DA=TASK  D ^DIK
"RTN","RORTSK",160,0)
 Q 0
"RTN","RORTSK",161,0)
 ;
"RTN","RORTSK",162,0)
 ;***** RESUMES THE TASK
"RTN","RORTSK",163,0)
 ;
"RTN","RORTSK",164,0)
 ; TASK          Task number
"RTN","RORTSK",165,0)
 ;
"RTN","RORTSK",166,0)
 ; Return Values:
"RTN","RORTSK",167,0)
 ;       <0  Error code
"RTN","RORTSK",168,0)
 ;        0  Ok
"RTN","RORTSK",169,0)
 ;
"RTN","RORTSK",170,0)
RESUME(TASK) ;
"RTN","RORTSK",171,0)
 N STATUS
"RTN","RORTSK",172,0)
 S STATUS=+$$STATUS^RORTSK02(TASK,,1)  Q:STATUS<0 STATUS
"RTN","RORTSK",173,0)
 K ^RORDATA(798.8,TASK,"A")
"RTN","RORTSK",174,0)
 Q 0
"RTN","RORTSK",175,0)
 ;
"RTN","RORTSK",176,0)
 ;***** SUSPENDS THE TASK
"RTN","RORTSK",177,0)
 ;
"RTN","RORTSK",178,0)
 ; TASK          Task number
"RTN","RORTSK",179,0)
 ;
"RTN","RORTSK",180,0)
 ; Return Values:
"RTN","RORTSK",181,0)
 ;       <0  Error code
"RTN","RORTSK",182,0)
 ;        0  Ok
"RTN","RORTSK",183,0)
 ;
"RTN","RORTSK",184,0)
SUSPEND(TASK) ;
"RTN","RORTSK",185,0)
 N STATUS
"RTN","RORTSK",186,0)
 S STATUS=+$$STATUS^RORTSK02(TASK,,1)  Q:STATUS<0 STATUS
"RTN","RORTSK",187,0)
 S:(STATUS=1)!(STATUS=2) ^RORDATA(798.8,TASK,"A")=1
"RTN","RORTSK",188,0)
 Q 0
"RTN","RORTSK01")
0^125^B48586132
"RTN","RORTSK01",1,0)
RORTSK01 ;HCIOFO/SG - (SUB)TASK UTILITIES ; 1/22/06 8:05pm
"RTN","RORTSK01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORTSK01",3,0)
 ;
"RTN","RORTSK01",4,0)
 ; These utilities should be called only from the tasks and subtasks
"RTN","RORTSK01",5,0)
 ; that are created and scheduled by the RORTSK API.
"RTN","RORTSK01",6,0)
 ;
"RTN","RORTSK01",7,0)
 ; The RORTSK local array is passed to the task. If the proxy task
"RTN","RORTSK01",8,0)
 ; is used then it passes this array by reference into the entry
"RTN","RORTSK01",9,0)
 ; point that implements the generic task or report.
"RTN","RORTSK01",10,0)
 ;
"RTN","RORTSK01",11,0)
 ; RORTSK(               Task Number
"RTN","RORTSK01",12,0)
 ;
"RTN","RORTSK01",13,0)
 ;   "PARAMS",...)       Report Parameters
"RTN","RORTSK01",14,0)
 ;   "TPP-PREV")         Previous value of task progress percentage
"RTN","RORTSK01",15,0)
 ;
"RTN","RORTSK01",16,0)
 ; If the proxy task is used, additional nodes are created:
"RTN","RORTSK01",17,0)
 ;
"RTN","RORTSK01",18,0)
 ;   "EP")               Entry Point
"RTN","RORTSK01",19,0)
 ;   "TYPE")             Type of the Task
"RTN","RORTSK01",20,0)
 ;   "REGIEN")           Registry IEN
"RTN","RORTSK01",21,0)
 ;   "REPORT")           Code of the Report
"RTN","RORTSK01",22,0)
 ;   "SCHCODE")          Rescheduling Code
"RTN","RORTSK01",23,0)
 ;
"RTN","RORTSK01",24,0)
 ; See descriptions of the REPORT BUILDER field (10.01) of the
"RTN","RORTSK01",25,0)
 ; ROR REPORT PARAMETERS file (#799.34) and the ROR REPORT SCHEDULE
"RTN","RORTSK01",26,0)
 ; remote procedure for more details.
"RTN","RORTSK01",27,0)
 ;
"RTN","RORTSK01",28,0)
 Q
"RTN","RORTSK01",29,0)
 ;
"RTN","RORTSK01",30,0)
 ;***** DUMMY ENTRY POINT (TO AVOID CRASH DURING ALERT PROCESSING)
"RTN","RORTSK01",31,0)
ALERTRTN Q
"RTN","RORTSK01",32,0)
 ;
"RTN","RORTSK01",33,0)
 ;***** (SUB)TASK CLEANUP
"RTN","RORTSK01",34,0)
 ;
"RTN","RORTSK01",35,0)
 ; ERRCODE       Error code of the task
"RTN","RORTSK01",36,0)
 ; [PARENT]      Parent task for the subtask
"RTN","RORTSK01",37,0)
 ;
"RTN","RORTSK01",38,0)
 ; Return Values:
"RTN","RORTSK01",39,0)
 ;       <0  Error code
"RTN","RORTSK01",40,0)
 ;        0  Ok
"RTN","RORTSK01",41,0)
 ;
"RTN","RORTSK01",42,0)
EXIT(ERRCODE,PARENT) ;
"RTN","RORTSK01",43,0)
 N IENS,RC,RORFDA,RORMSG,STATUS,TASKINFO,TASKNODE,TMP
"RTN","RORTSK01",44,0)
 S RC=0,STATUS=$S(ERRCODE=-42:5,ERRCODE<0:101,1:3),ZTREQ="@"
"RTN","RORTSK01",45,0)
 ;=== SUBTASK
"RTN","RORTSK01",46,0)
 I $G(PARENT)  D  Q RC
"RTN","RORTSK01",47,0)
 . ;--- Not implemented
"RTN","RORTSK01",48,0)
 ;=== TASK
"RTN","RORTSK01",49,0)
 S TASKNODE=$NA(^RORDATA(798.8,RORTSK))
"RTN","RORTSK01",50,0)
 S TMP=$$TASKINFO^RORTSK02(RORTSK,.TASKINFO)
"RTN","RORTSK01",51,0)
 ;--- Report statistics
"RTN","RORTSK01",52,0)
 D:+$G(TASKINFO(2))=2
"RTN","RORTSK01",53,0)
 . S TMP=+$G(TASKINFO(3))  ; Registry IEN
"RTN","RORTSK01",54,0)
 . D:TMP>0 INC^RORTSK12(TMP,+$G(TASKINFO(4)))
"RTN","RORTSK01",55,0)
 ;--- Send an alert to the user who has started the task
"RTN","RORTSK01",56,0)
 S TMP=$G(TASKINFO(5))  ; Task Description
"RTN","RORTSK01",57,0)
 D ORALERT^RORUTL18($$MSG^RORERR20(-101,,,RORTSK,TMP))
"RTN","RORTSK01",58,0)
 ;--- Update the task record
"RTN","RORTSK01",59,0)
 S IENS=RORTSK_","
"RTN","RORTSK01",60,0)
 S RORFDA(798.8,IENS,2.01)=STATUS      ; Status
"RTN","RORTSK01",61,0)
 S RORFDA(798.8,IENS,2.02)=$$NOW^XLFDT ; Completion Time
"RTN","RORTSK01",62,0)
 S RORFDA(798.8,IENS,2.04)="@"         ; Job Number
"RTN","RORTSK01",63,0)
 S RORFDA(798.8,IENS,4)="@"            ; Progress
"RTN","RORTSK01",64,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORTSK01",65,0)
 S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798.8,IENS)
"RTN","RORTSK01",66,0)
 ;--- Cleanup
"RTN","RORTSK01",67,0)
 K @TASKNODE@("A"),@TASKNODE@("T")
"RTN","RORTSK01",68,0)
 L -@TASKNODE@("T",0)
"RTN","RORTSK01",69,0)
 Q RC
"RTN","RORTSK01",70,0)
 ;
"RTN","RORTSK01",71,0)
 ;***** INITIALIZES THE (SUB)TASK
"RTN","RORTSK01",72,0)
 ;
"RTN","RORTSK01",73,0)
 ; TASK          Task number
"RTN","RORTSK01",74,0)
 ; [LOG]         Log IEN (returned by the $$LOGIEN^RORLOG function)
"RTN","RORTSK01",75,0)
 ; [PARENT]      Parent task for the subtask
"RTN","RORTSK01",76,0)
 ;
"RTN","RORTSK01",77,0)
 ; Return Values:
"RTN","RORTSK01",78,0)
 ;       <0  Error code
"RTN","RORTSK01",79,0)
 ;        0  Ok
"RTN","RORTSK01",80,0)
 ;
"RTN","RORTSK01",81,0)
INIT(TASK,LOG,PARENT) ;
"RTN","RORTSK01",82,0)
 N I,RC,RORDTH,RORFDA,RORMSG,TASKNODE
"RTN","RORTSK01",83,0)
 S RORDTH=$G(ZTDTH)  S:RORDTH'>0 RORDTH=$$NOW^XLFDT
"RTN","RORTSK01",84,0)
 S RC=0,RORTSK=+TASK  K RORTSK("PREVTPP")
"RTN","RORTSK01",85,0)
 ;=== SUBTASK
"RTN","RORTSK01",86,0)
 I $G(PARENT)  S RC=0  D  Q RC
"RTN","RORTSK01",87,0)
 . ;--- Not implemented
"RTN","RORTSK01",88,0)
 ;=== TASK
"RTN","RORTSK01",89,0)
 S TASKNODE=$NA(^RORDATA(798.8,RORTSK))
"RTN","RORTSK01",90,0)
 ;--- Schedule the next instance of the task (if requested)
"RTN","RORTSK01",91,0)
 D:$G(RORTSK("SCHCODE"))'=""
"RTN","RORTSK01",92,0)
 . N EP,TYPE,REGIEN,REPORT,SCHCODE
"RTN","RORTSK01",93,0)
 . N ZTCPU,ZTDTH,ZTIO,ZTKIL,ZTPRI,ZTSAVE,ZTSYNC,ZTUCI
"RTN","RORTSK01",94,0)
 . F I="EP","TYPE","REGIEN","REPORT","SCHCODE"  S @I=$G(RORTSK(I))
"RTN","RORTSK01",95,0)
 . Q:(TYPE'>0)!(EP="")
"RTN","RORTSK01",96,0)
 . S ZTDTH=$$SCH^XLFDT(SCHCODE,RORDTH,1)
"RTN","RORTSK01",97,0)
 . S TMP=$$CREATE^RORTSK(TYPE,EP,,REGIEN,REPORT,SCHCODE,.RORTSK)
"RTN","RORTSK01",98,0)
 ;--- Wait until the task record is created
"RTN","RORTSK01",99,0)
 S RC=$$TRWAIT(RORTSK)  Q:RC<0 RC
"RTN","RORTSK01",100,0)
 ;--- Lock the task record
"RTN","RORTSK01",101,0)
 L +@TASKNODE@("T",0):5
"RTN","RORTSK01",102,0)
 E  Q $$ERROR^RORERR(-11,,,,"the ROR TASK file")
"RTN","RORTSK01",103,0)
 ;--- Clear the list of subtasks
"RTN","RORTSK01",104,0)
 K @TASKNODE@("T")
"RTN","RORTSK01",105,0)
 ;--- Update the task record
"RTN","RORTSK01",106,0)
 S IENS=RORTSK_","
"RTN","RORTSK01",107,0)
 S RORFDA(798.8,IENS,2.01)=100         ; STATUS = 'Crashed'
"RTN","RORTSK01",108,0)
 S RORFDA(798.8,IENS,2.03)=$G(LOG)     ; Log IEN
"RTN","RORTSK01",109,0)
 S RORFDA(798.8,IENS,2.04)=$J          ; Job Number
"RTN","RORTSK01",110,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORTSK01",111,0)
 S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798.8,IENS)
"RTN","RORTSK01",112,0)
 Q RC
"RTN","RORTSK01",113,0)
 ;
"RTN","RORTSK01",114,0)
 ;***** TASK CONTROL FUNCTION
"RTN","RORTSK01",115,0)
 ;
"RTN","RORTSK01",116,0)
 ; [TPP]         Task/Section progress (0-1)
"RTN","RORTSK01",117,0)
 ;
"RTN","RORTSK01",118,0)
 ; Return Values:
"RTN","RORTSK01",119,0)
 ;       <0  Error code
"RTN","RORTSK01",120,0)
 ;        0  Ok
"RTN","RORTSK01",121,0)
 ;
"RTN","RORTSK01",122,0)
LOOP(TPP) ;
"RTN","RORTSK01",123,0)
 N ACTION,OFFSET,RC
"RTN","RORTSK01",124,0)
 ;--- Update the task progress percentage
"RTN","RORTSK01",125,0)
 D:$G(TPP)'=""
"RTN","RORTSK01",126,0)
 . I TPP'<0,TPP'>1  D  S TPP=+$J(TPP,0,2)
"RTN","RORTSK01",127,0)
 . . S TPP=TPP*$G(RORTSK("TPP-BASE"),100)+$G(RORTSK("TPP-OFFS"))
"RTN","RORTSK01",128,0)
 . E  S TPP=""
"RTN","RORTSK01",129,0)
 . Q:TPP=$G(RORTSK("TPP-PREV"))
"RTN","RORTSK01",130,0)
 . S (^RORDATA(798.8,RORTSK,"P"),RORTSK("TPP-PREV"))=TPP
"RTN","RORTSK01",131,0)
 ;--- Requested action
"RTN","RORTSK01",132,0)
 S ACTION=$S($$S^%ZTLOAD:2,1:+$G(^RORDATA(798.8,RORTSK,"A")))
"RTN","RORTSK01",133,0)
 Q:'ACTION 0
"RTN","RORTSK01",134,0)
 ;=== SUSPEND THE TASK
"RTN","RORTSK01",135,0)
 I ACTION=1  S RC=0  D  Q RC
"RTN","RORTSK01",136,0)
 . N IENS,RORFDA,RORMSG
"RTN","RORTSK01",137,0)
 . S IENS=RORTSK_","
"RTN","RORTSK01",138,0)
 . ;--- Update the task status
"RTN","RORTSK01",139,0)
 . S RORFDA(798.8,IENS,2.01)=102      ; STATUS = 'Suspended'
"RTN","RORTSK01",140,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORTSK01",141,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798.8,IENS)
"RTN","RORTSK01",142,0)
 . ;--- Suspension cycle
"RTN","RORTSK01",143,0)
 . F  H 60  D  Q:ACTION'=1
"RTN","RORTSK01",144,0)
 . . S ACTION=$S($$S^%ZTLOAD:2,1:+$G(^RORDATA(798.8,RORTSK,"A")))
"RTN","RORTSK01",145,0)
 . ;--- Restore the default task status
"RTN","RORTSK01",146,0)
 . S RORFDA(798.8,IENS,2.01)=100      ; STATUS = 'Crashed'
"RTN","RORTSK01",147,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORTSK01",148,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798.8,IENS)
"RTN","RORTSK01",149,0)
 ;=== STOP THE TASK
"RTN","RORTSK01",150,0)
 I ACTION=2  D  Q $$ERROR^RORERR(-42)
"RTN","RORTSK01",151,0)
 . S ZTSTOP=1
"RTN","RORTSK01",152,0)
 Q 0
"RTN","RORTSK01",153,0)
 ;
"RTN","RORTSK01",154,0)
 ;***** RETURNS THE VALUE/ATTRIBUTE OF THE TASK PARAMETER
"RTN","RORTSK01",155,0)
PARAM(NAME,ATTR) ;
"RTN","RORTSK01",156,0)
 Q:$G(ATTR)'="" $G(RORTSK("PARAMS",NAME,"A",ATTR))
"RTN","RORTSK01",157,0)
 Q $G(RORTSK("PARAMS",NAME))
"RTN","RORTSK01",158,0)
 ;
"RTN","RORTSK01",159,0)
 ;***** TASK PROXY
"RTN","RORTSK01",160,0)
 ;
"RTN","RORTSK01",161,0)
 ; RORTSK("EP")  This node must contain name of the task entry point
"RTN","RORTSK01",162,0)
 ;               ($$TAG^ROUTINE). The function should return either
"RTN","RORTSK01",163,0)
 ;               a negative error code or zero.
"RTN","RORTSK01",164,0)
 ;
"RTN","RORTSK01",165,0)
TASK ;
"RTN","RORTSK01",166,0)
 N RORCACHE      ; Cache of element and attribute names
"RTN","RORTSK01",167,0)
 N RORLOG        ; Log subsystem constants & variables
"RTN","RORTSK01",168,0)
 N RORPARM       ; Application parameters
"RTN","RORTSK01",169,0)
 ;
"RTN","RORTSK01",170,0)
 N ACTIVITY,I,INFO,RC,REGLST,RORERRDL,TASKINFO,TMP,TRC
"RTN","RORTSK01",171,0)
 S RORTSK=ZTSK
"RTN","RORTSK01",172,0)
 ;--- Initialize constants and variables
"RTN","RORTSK01",173,0)
 D INIT^RORUTL01("ROR")
"RTN","RORTSK01",174,0)
 ;S RORPARM("DEBUG")=1 ; Remove the first ';' to start in debug mode
"RTN","RORTSK01",175,0)
 S RORPARM("ERR")=1    ; Enable enhanced error processing
"RTN","RORTSK01",176,0)
 S RORPARM("LOG")=1    ; Enable error recording
"RTN","RORTSK01",177,0)
 ;--- Wait until the task record is created
"RTN","RORTSK01",178,0)
 S TMP=$$TRWAIT(RORTSK)
"RTN","RORTSK01",179,0)
 ;--- Get the task information
"RTN","RORTSK01",180,0)
 S TRC=$$TASKINFO^RORTSK02(RORTSK,.TASKINFO,"E")
"RTN","RORTSK01",181,0)
 ;--- Open a task log
"RTN","RORTSK01",182,0)
 S TMP=$P($G(TASKINFO(3)),U,2)  S:TMP'="" REGLST(TMP)=""
"RTN","RORTSK01",183,0)
 S ACTIVITY=$S(+$G(TASKINFO(2))=2:5,1:0)
"RTN","RORTSK01",184,0)
 S TMP=$$SETUP^RORLOG(.REGLST)
"RTN","RORTSK01",185,0)
 S RC=$$OPEN^RORLOG(.REGLST,ACTIVITY,"TASK #"_RORTSK_" STARTED")
"RTN","RORTSK01",186,0)
 ;--- Abort the task if task information was not available
"RTN","RORTSK01",187,0)
 I TRC<0  D:RC'<0  Q
"RTN","RORTSK01",188,0)
 . S TMP=$$ERROR^RORERR(-56,,,,TRC,"$$TASKINFO^RORTSK02")
"RTN","RORTSK01",189,0)
 . D CLOSE^RORLOG("TASK #"_RORTSK_" ABORTED")
"RTN","RORTSK01",190,0)
 D
"RTN","RORTSK01",191,0)
 . ;--- Record the task information (if available)
"RTN","RORTSK01",192,0)
 . S I=0,TMP=$G(TASKINFO(5))
"RTN","RORTSK01",193,0)
 . S:TMP'="" I=I+1,INFO(I)="Description: '"_TMP_"'"
"RTN","RORTSK01",194,0)
 . S TMP=$P($G(TASKINFO(8)),U,2)
"RTN","RORTSK01",195,0)
 . S:TMP'="" I=I+1,INFO(I)="User:        '"_TMP_"'"
"RTN","RORTSK01",196,0)
 . S TMP=$G(TASKINFO(14))
"RTN","RORTSK01",197,0)
 . S:TMP'="" I=I+1,INFO(I)="Comment:     '"_TMP_"'"
"RTN","RORTSK01",198,0)
 . D:I LOG^RORLOG(2,"Task Information",,.INFO)
"RTN","RORTSK01",199,0)
 . ;--- Verify the entry point
"RTN","RORTSK01",200,0)
 . S RC=$$VERIFYEP^RORUTL01($G(RORTSK("EP")),1)  Q:RC<0
"RTN","RORTSK01",201,0)
 . ;--- Initialize the task
"RTN","RORTSK01",202,0)
 . S RC=$$INIT(RORTSK,$$LOGIEN^RORLOG)  Q:RC<0
"RTN","RORTSK01",203,0)
 . K ACTIVITY,INFO,REGLST,TASKINFO,TMP
"RTN","RORTSK01",204,0)
 . ;--- Call the entry point
"RTN","RORTSK01",205,0)
 . X "S TRC="_RORTSK("EP")_"(.RORTSK)"
"RTN","RORTSK01",206,0)
 ;
"RTN","RORTSK01",207,0)
 ;--- Post-processing
"RTN","RORTSK01",208,0)
 S TMP=$$EXIT(TRC)
"RTN","RORTSK01",209,0)
 ;--- Close the log
"RTN","RORTSK01",210,0)
 S TMP="TASK #"_RORTSK_$S(TRC<0:" ABORTED",1:" COMPLETED")
"RTN","RORTSK01",211,0)
 D CLOSE^RORLOG(TMP)
"RTN","RORTSK01",212,0)
 Q
"RTN","RORTSK01",213,0)
 ;
"RTN","RORTSK01",214,0)
 ;***** SETS THE BASE VALUE FOR THE PROGRESS INDICATOR
"RTN","RORTSK01",215,0)
 ;
"RTN","RORTSK01",216,0)
 ; BASE          Base value for the progress indicator (0-100)
"RTN","RORTSK01",217,0)
 ;
"RTN","RORTSK01",218,0)
TPPSETUP(BASE) ;
"RTN","RORTSK01",219,0)
 I $G(BASE)'>0  K RORTSK("TPP-BASE"),RORTSK("TPP-OFFS")  Q
"RTN","RORTSK01",220,0)
 N TMP
"RTN","RORTSK01",221,0)
 S RORTSK("TPP-OFFS")=$G(RORTSK("TPP-OFFS"))+$G(RORTSK("TPP-BASE"))
"RTN","RORTSK01",222,0)
 S TMP=100-$G(RORTSK("TPP-OFFS"))
"RTN","RORTSK01",223,0)
 S RORTSK("TPP-BASE")=$S(BASE<TMP:BASE,1:TMP)
"RTN","RORTSK01",224,0)
 S TMP=$$LOOP(0)
"RTN","RORTSK01",225,0)
 Q
"RTN","RORTSK01",226,0)
 ;
"RTN","RORTSK01",227,0)
 ;***** WAITS UNTIL THE TASK RECORD IS CREATED
"RTN","RORTSK01",228,0)
 ;
"RTN","RORTSK01",229,0)
 ; TASK          Task number
"RTN","RORTSK01",230,0)
 ;
"RTN","RORTSK01",231,0)
 ; Return Values:
"RTN","RORTSK01",232,0)
 ;       <0  Error code
"RTN","RORTSK01",233,0)
 ;        0  Ok
"RTN","RORTSK01",234,0)
 ;
"RTN","RORTSK01",235,0)
TRWAIT(TASK) ;
"RTN","RORTSK01",236,0)
 N I  F I=1:1:5  Q:$D(^RORDATA(798.8,TASK,0))  H 1
"RTN","RORTSK01",237,0)
 Q $S($D(^RORDATA(798.8,TASK,0)):0,1:$$ERROR^RORERR(-83,,,,TASK))
"RTN","RORTSK02")
0^12^B26540777
"RTN","RORTSK02",1,0)
RORTSK02 ;HCIOFO/SG - TASK MANAGER UTILITIES ; 1/23/06 8:11am
"RTN","RORTSK02",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORTSK02",3,0)
 ;
"RTN","RORTSK02",4,0)
 Q
"RTN","RORTSK02",5,0)
 ;
"RTN","RORTSK02",6,0)
 ;***** RETURNS A LIST OF USER'S TASKS
"RTN","RORTSK02",7,0)
 ;
"RTN","RORTSK02",8,0)
 ; .TASKLIST     Reference to a local array that the task
"RTN","RORTSK02",9,0)
 ;               list is returned to
"RTN","RORTSK02",10,0)
 ;
"RTN","RORTSK02",11,0)
 ; [REGIEN]      Registry IEN
"RTN","RORTSK02",12,0)
 ;
"RTN","RORTSK02",13,0)
 ; [TYPE]        Type of the task (1 - Generic, 2 - Report)
"RTN","RORTSK02",14,0)
 ;
"RTN","RORTSK02",15,0)
 ; [.FROM]       Where to start/continue the list generation.
"RTN","RORTSK02",16,0)
 ;               By defualt (if $G(FROM)'>0), the extraction starts
"RTN","RORTSK02",17,0)
 ;               from the beginning of the user's task list.
"RTN","RORTSK02",18,0)
 ;
"RTN","RORTSK02",19,0)
 ;               NOTE: The task, which number is passed via this
"RTN","RORTSK02",20,0)
 ;               parameter, is not included in the report.
"RTN","RORTSK02",21,0)
 ;
"RTN","RORTSK02",22,0)
 ;               After the call, this parameter contains the last
"RTN","RORTSK02",23,0)
 ;               extracted task number or an empty string if there
"RTN","RORTSK02",24,0)
 ;               are no more tasks.
"RTN","RORTSK02",25,0)
 ;
"RTN","RORTSK02",26,0)
 ; [NUMBER]      Maximum number of tasks returned by the function.
"RTN","RORTSK02",27,0)
 ;               By default (if $G(NUMBER)'>0), all task numbers
"RTN","RORTSK02",28,0)
 ;               (starting from the point indicated by the FROM
"RTN","RORTSK02",29,0)
 ;               parameter if it is defined) are retrieved.
"RTN","RORTSK02",30,0)
 ;
"RTN","RORTSK02",31,0)
 ; [USER]        A user IEN (DUZ). By default (if $G(USER)'>0),
"RTN","RORTSK02",32,0)
 ;               the curent user's DUZ is used.
"RTN","RORTSK02",33,0)
 ;
"RTN","RORTSK02",34,0)
 ; Return values:
"RTN","RORTSK02",35,0)
 ;       <0  Error code
"RTN","RORTSK02",36,0)
 ;        0  No tasks have been found
"RTN","RORTSK02",37,0)
 ;       >0  Number of tasks
"RTN","RORTSK02",38,0)
 ;
"RTN","RORTSK02",39,0)
LIST(TASKLIST,REGIEN,TYPE,FROM,NUMBER,USER) ;
"RTN","RORTSK02",40,0)
 N DIR,NTSK,RC,ROOT,RORBUF,SCR,TASK  K TASKLIST
"RTN","RORTSK02",41,0)
 S ROOT=$$ROOT^DILFD(798.8,,1)
"RTN","RORTSK02",42,0)
 S USER=$S($G(USER)>0:+USER,1:+$G(DUZ))
"RTN","RORTSK02",43,0)
 S DIR=$S($$UP^XLFSTR($G(NUMBER))["B":-1,1:1)
"RTN","RORTSK02",44,0)
 S NUMBER=$S($G(NUMBER)>0:+NUMBER,1:999999)
"RTN","RORTSK02",45,0)
 ;--- Generate a screen logic
"RTN","RORTSK02",46,0)
 S SCR="I 1"
"RTN","RORTSK02",47,0)
 S:$G(REGIEN)>0 SCR=SCR_","_"$P(RORBUF,U,3)="_(+REGIEN)
"RTN","RORTSK02",48,0)
 S:$G(TYPE)>0 SCR=SCR_","_"$P(RORBUF,U,2)="_(+TYPE)
"RTN","RORTSK02",49,0)
 ;--- Generate the output list
"RTN","RORTSK02",50,0)
 S TASK=$S($G(FROM)>0:FROM,1:""),NTSK=0
"RTN","RORTSK02",51,0)
 F  S TASK=$O(@ROOT@("U",USER,TASK),DIR)  Q:TASK=""  D  Q:NTSK'<NUMBER
"RTN","RORTSK02",52,0)
 . S RORBUF=$G(@ROOT@(TASK,0))  X SCR  E  Q
"RTN","RORTSK02",53,0)
 . S NTSK=NTSK+1,TASKLIST(TASK)=""
"RTN","RORTSK02",54,0)
 S FROM=TASK
"RTN","RORTSK02",55,0)
 Q NTSK
"RTN","RORTSK02",56,0)
 ;
"RTN","RORTSK02",57,0)
 ;***** PURGES THE OLD TASKS
"RTN","RORTSK02",58,0)
 ;
"RTN","RORTSK02",59,0)
 ; [DKEEP]       Days to keep the old tasks (by default = 15)
"RTN","RORTSK02",60,0)
 ;
"RTN","RORTSK02",61,0)
 ; Return Values:
"RTN","RORTSK02",62,0)
 ;       <0  Error code
"RTN","RORTSK02",63,0)
 ;        0  Ok
"RTN","RORTSK02",64,0)
 ;
"RTN","RORTSK02",65,0)
PURGE(DKEEP) ;
"RTN","RORTSK02",66,0)
 N DA,DATE,DIK,FROM,RC,STATUS,TASK,TASKINFO
"RTN","RORTSK02",67,0)
 S ROOT=$$ROOT^DILFD(798.8,,1),DIK=$$OREF^DILF(ROOT)
"RTN","RORTSK02",68,0)
 S FROM=$$FMADD^XLFDT($$DT^XLFDT,1-$G(DKEEP,15))
"RTN","RORTSK02",69,0)
 ;---
"RTN","RORTSK02",70,0)
 S DATE=FROM,RC=0
"RTN","RORTSK02",71,0)
 F  S DATE=$O(@ROOT@("ACDT",DATE),-1)  Q:DATE=""  D
"RTN","RORTSK02",72,0)
 . S TASK=""
"RTN","RORTSK02",73,0)
 . F  S TASK=$O(@ROOT@("ACDT",DATE,TASK),-1)  Q:TASK=""  D
"RTN","RORTSK02",74,0)
 . . Q:$$TASKINFO(TASK,.TASKINFO)<0
"RTN","RORTSK02",75,0)
 . . S STATUS=+TASKINFO(6)
"RTN","RORTSK02",76,0)
 . . ;--- Do not delete pending, running and suspended tasks
"RTN","RORTSK02",77,0)
 . . Q:(STATUS=1)!(STATUS=2)!(STATUS=102)
"RTN","RORTSK02",78,0)
 . . ;--- If task is completed, use its completion
"RTN","RORTSK02",79,0)
 . . ;--- date instead of the creation date
"RTN","RORTSK02",80,0)
 . . I TASKINFO(9)>DATE  Q:TASKINFO(9)'<FROM
"RTN","RORTSK02",81,0)
 . . ;--- Delete the record
"RTN","RORTSK02",82,0)
 . . S DA=TASK  D ^DIK
"RTN","RORTSK02",83,0)
 ;---
"RTN","RORTSK02",84,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORTSK02",85,0)
 ;
"RTN","RORTSK02",86,0)
 ;***** RETURNS STATUS OF THE TASK
"RTN","RORTSK02",87,0)
 ;
"RTN","RORTSK02",88,0)
 ; TASK          Task number
"RTN","RORTSK02",89,0)
 ; [LTO]         LOCK timeout (0 by default)
"RTN","RORTSK02",90,0)
 ; [UNDEF83]     Return the error -83 if there is no task record.
"RTN","RORTSK02",91,0)
 ;               By default (if +$G(UNDEF83)=0), zero is returned.
"RTN","RORTSK02",92,0)
 ;
"RTN","RORTSK02",93,0)
 ; Return Values:
"RTN","RORTSK02",94,0)
 ;       <0  Error code
"RTN","RORTSK02",95,0)
 ;        0  Undefined task/Unknown Status
"RTN","RORTSK02",96,0)
 ;       >0  Status (Code^Description)
"RTN","RORTSK02",97,0)
 ;
"RTN","RORTSK02",98,0)
 ;               1  Active: Pending
"RTN","RORTSK02",99,0)
 ;               2  Active: Running
"RTN","RORTSK02",100,0)
 ;               3  Inactive: Finished
"RTN","RORTSK02",101,0)
 ;               4  Inactive: Available
"RTN","RORTSK02",102,0)
 ;               5  Inactive: Interrupted
"RTN","RORTSK02",103,0)
 ;
"RTN","RORTSK02",104,0)
 ;             100  Inactive: Crashed
"RTN","RORTSK02",105,0)
 ;             101  Inactive: Errors
"RTN","RORTSK02",106,0)
 ;             102  Active: Suspended
"RTN","RORTSK02",107,0)
 ;             103  Active: Stopping
"RTN","RORTSK02",108,0)
 ;
"RTN","RORTSK02",109,0)
STATUS(TASK,LTO,UNDEF83) ;
"RTN","RORTSK02",110,0)
 N ACTION,IENS,RORBUF,RORMSG,STATUS,TASKNODE,TMS,ZTSK
"RTN","RORTSK02",111,0)
 Q:TASK'>0 $$ERROR^RORERR(-85,,,,TASK)
"RTN","RORTSK02",112,0)
 S TASKNODE=$NA(^RORDATA(798.8,TASK))
"RTN","RORTSK02",113,0)
 Q:'$D(@TASKNODE) $S($G(UNDEF83):-83,1:0)
"RTN","RORTSK02",114,0)
 ;--- Get internal value of the STATUS field (2.01)
"RTN","RORTSK02",115,0)
 S STATUS=+$G(@TASKNODE@(2))
"RTN","RORTSK02",116,0)
 ;--- Lock the record and check if the task is running
"RTN","RORTSK02",117,0)
 L +@TASKNODE@("T",0):$G(LTO,0)
"RTN","RORTSK02",118,0)
 E  S TMS=""  D  Q:TMS'="" TMS
"RTN","RORTSK02",119,0)
 . S ACTION=+$G(@TASKNODE@("A"))
"RTN","RORTSK02",120,0)
 . I ACTION=2    S TMS="103^Active: Stopping"   Q
"RTN","RORTSK02",121,0)
 . I STATUS=100  S TMS="2^Active: Running"      Q
"RTN","RORTSK02",122,0)
 . I STATUS=102  S TMS="102^Active: Suspended"  Q
"RTN","RORTSK02",123,0)
 D
"RTN","RORTSK02",124,0)
 . ;--- Try to get status from the Taskman
"RTN","RORTSK02",125,0)
 . S ZTSK=TASK  D STAT^%ZTLOAD
"RTN","RORTSK02",126,0)
 . S TMS=$S($G(ZTSK(0)):+$G(ZTSK(1)),1:0)
"RTN","RORTSK02",127,0)
 . ;--- Pending or Available
"RTN","RORTSK02",128,0)
 . I (TMS=1)!(TMS=4)  S STATUS=TMS_U_$G(ZTSK(2))  Q
"RTN","RORTSK02",129,0)
 . ;--- Running (actually, crashed ;-)
"RTN","RORTSK02",130,0)
 . I TMS=2  S STATUS=100  Q
"RTN","RORTSK02",131,0)
 . ;--- Finished, Interrupted or Undefined
"RTN","RORTSK02",132,0)
 . I 'STATUS  S:TMS STATUS=TMS_U_$G(ZTSK(2))  Q
"RTN","RORTSK02",133,0)
 . ;--- If the task record is not locked and the STATUS field shows
"RTN","RORTSK02",134,0)
 . ;    'Suspended' (102) then the task probably crashed while it
"RTN","RORTSK02",135,0)
 . ;--- was in the suspended state
"RTN","RORTSK02",136,0)
 . S:STATUS=102 STATUS=100
"RTN","RORTSK02",137,0)
 ;--- Get the external value of the STATUS field (if necessary)
"RTN","RORTSK02",138,0)
 I STATUS>0  D:$P(STATUS,U,2)=""
"RTN","RORTSK02",139,0)
 . S $P(STATUS,U,2)=$$EXTERNAL^DILFD(798.8,2.01,,STATUS,"RORMSG")
"RTN","RORTSK02",140,0)
 . S:$G(DIERR) STATUS=$$DBS^RORERR("RORMSG",-9,,,798.8)
"RTN","RORTSK02",141,0)
 ;
"RTN","RORTSK02",142,0)
 ;--- Unlock the task record
"RTN","RORTSK02",143,0)
 L -@TASKNODE@("T",0)
"RTN","RORTSK02",144,0)
 Q $TR(STATUS,">",":")
"RTN","RORTSK02",145,0)
 ;
"RTN","RORTSK02",146,0)
 ;***** RETURNS THE TASK INFORMATION
"RTN","RORTSK02",147,0)
 ;
"RTN","RORTSK02",148,0)
 ; TASK          Task number
"RTN","RORTSK02",149,0)
 ;
"RTN","RORTSK02",150,0)
 ; .INFO         Reference to a local variable (output):
"RTN","RORTSK02",151,0)
 ;
"RTN","RORTSK02",152,0)
 ; INFO(
"RTN","RORTSK02",153,0)
 ;   OFFSET+1)           Task Number
"RTN","RORTSK02",154,0)
 ;   OFFSET+2)           Task Type           (internal^external)
"RTN","RORTSK02",155,0)
 ;   OFFSET+3)           Registry            (IEN^Name)
"RTN","RORTSK02",156,0)
 ;   OFFSET+4)           Report              (Code^Name)
"RTN","RORTSK02",157,0)
 ;   OFFSET+5)           Description
"RTN","RORTSK02",158,0)
 ;   OFFSET+6)           Task Status         (internal^external)
"RTN","RORTSK02",159,0)
 ;   OFFSET+7)           Creation Time       (internal)
"RTN","RORTSK02",160,0)
 ;   OFFSET+8)           User                (DUZ^Name)
"RTN","RORTSK02",161,0)
 ;   OFFSET+9)           Completion Time     (internal)
"RTN","RORTSK02",162,0)
 ;   OFFSET+10)          Progress Percentage
"RTN","RORTSK02",163,0)
 ;   OFFSET+11)          Scheduled to Run at (internal)
"RTN","RORTSK02",164,0)
 ;   OFFSET+12)          Task Log IEN
"RTN","RORTSK02",165,0)
 ;   OFFSET+13)          Job Number
"RTN","RORTSK02",166,0)
 ;   OFFSET+14)          User Comment
"RTN","RORTSK02",167,0)
 ;
"RTN","RORTSK02",168,0)
 ; [FLAGS]       Characters controlling behavior of the function
"RTN","RORTSK02",169,0)
 ;               (they can be combined):
"RTN","RORTSK02",170,0)
 ;                 E  Return external values also (when applicable)
"RTN","RORTSK02",171,0)
 ;
"RTN","RORTSK02",172,0)
 ; [OFFSET]      A number that is added to all subscripts in the
"RTN","RORTSK02",173,0)
 ;               destination array (by default, it is zero).
"RTN","RORTSK02",174,0)
 ;
"RTN","RORTSK02",175,0)
 ; Return Values:
"RTN","RORTSK02",176,0)
 ;       <0  Error code
"RTN","RORTSK02",177,0)
 ;        0  Ok
"RTN","RORTSK02",178,0)
 ;
"RTN","RORTSK02",179,0)
TASKINFO(TASK,INFO,FLAGS,OFFSET) ;
"RTN","RORTSK02",180,0)
 N I,IENS,RORBUF,RORMSG,TMP
"RTN","RORTSK02",181,0)
 S FLAGS=$$UP^XLFSTR($G(FLAGS))
"RTN","RORTSK02",182,0)
 S OFFSET=$S($G(OFFSET)>0:+OFFSET,1:0)
"RTN","RORTSK02",183,0)
 ;--- Clear the output array
"RTN","RORTSK02",184,0)
 K:'OFFSET INFO  S TMP=$$TIN
"RTN","RORTSK02",185,0)
 F I=1:1:TMP  S INFO(OFFSET+I)=""
"RTN","RORTSK02",186,0)
 ;--- Get the task status
"RTN","RORTSK02",187,0)
 S TMP=$$STATUS(TASK,,1)  Q:TMP<0 TMP
"RTN","RORTSK02",188,0)
 S INFO(OFFSET+1)=TASK
"RTN","RORTSK02",189,0)
 S INFO(OFFSET+6)=$S(FLAGS["E":TMP,1:+TMP)
"RTN","RORTSK02",190,0)
 ;--- Load the task record
"RTN","RORTSK02",191,0)
 S IENS=TASK_",",I=$S(FLAGS["E":"EIN",1:"IN")
"RTN","RORTSK02",192,0)
 S TMP=".02;.03;.04;.05;.07;.08;1.01;2.02;2.03;2.04;4"
"RTN","RORTSK02",193,0)
 D GETS^DIQ(798.8,IENS,TMP,I,"RORBUF","RORMSG")
"RTN","RORTSK02",194,0)
 I $G(DIERR)  D  Q RC
"RTN","RORTSK02",195,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.8,IENS)
"RTN","RORTSK02",196,0)
 ;--- Format the output array
"RTN","RORTSK02",197,0)
 Q $$FRMTI^RORTSK03(OFFSET,.INFO,IENS,.RORBUF,FLAGS)
"RTN","RORTSK02",198,0)
 ;
"RTN","RORTSK02",199,0)
 ;***** RETURNS NUMBER OF NODES IN THE TASK INFORMATION ARRAY
"RTN","RORTSK02",200,0)
TIN() Q 14
"RTN","RORTSK03")
0^13^B6780184
"RTN","RORTSK03",1,0)
RORTSK03 ;HCIOFO/SG - TASK MANAGER OVERFLOW CODE ; 8/30/05 8:34am
"RTN","RORTSK03",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORTSK03",3,0)
 ;
"RTN","RORTSK03",4,0)
 Q
"RTN","RORTSK03",5,0)
 ;
"RTN","RORTSK03",6,0)
 ;***** PREPARE THE TASK PARAMETERS
"RTN","RORTSK03",7,0)
 ;
"RTN","RORTSK03",8,0)
 ; .PARAMS       Reference to a local array that contains
"RTN","RORTSK03",9,0)
 ;               the task parameters
"RTN","RORTSK03",10,0)
 ;
"RTN","RORTSK03",11,0)
 ; Return Values:
"RTN","RORTSK03",12,0)
 ;       <0  Error code
"RTN","RORTSK03",13,0)
 ;        0  Ok
"RTN","RORTSK03",14,0)
 ;
"RTN","RORTSK03",15,0)
PARAMS(PARAMS) ;
"RTN","RORTSK03",16,0)
 N I,NAME,NODE,SUBS,TMP
"RTN","RORTSK03",17,0)
 S I=""
"RTN","RORTSK03",18,0)
 F  S I=$O(PARAMS(I))  Q:I=""  D
"RTN","RORTSK03",19,0)
 . S NAME=$TR($P(PARAMS(I),"=")," ")  Q:NAME=""
"RTN","RORTSK03",20,0)
 . S TMP=$P(NAME,"(")  Q:TMP=""
"RTN","RORTSK03",21,0)
 . S NODE="RORTSK(""PARAMS"","""_TMP_""""
"RTN","RORTSK03",22,0)
 . S TMP=$P(NAME,"(",2,999)
"RTN","RORTSK03",23,0)
 . S NODE=$S(TMP'="":NODE_","_TMP,1:NODE_")")
"RTN","RORTSK03",24,0)
 . S @NODE=$$TRIM^XLFSTR($P(PARAMS(I),"=",2,999))
"RTN","RORTSK03",25,0)
 Q 0
"RTN","RORTSK03",26,0)
 ;
"RTN","RORTSK03",27,0)
 ;***** FORMATS THE TASK INFORMATION FOR $$TASKINFO^RORTSK02
"RTN","RORTSK03",28,0)
 ;
"RTN","RORTSK03",29,0)
 ; OFFSET        Offset for the subscripts
"RTN","RORTSK03",30,0)
 ; .INFO         Reference to a local variable (output):
"RTN","RORTSK03",31,0)
 ; IENS          The second subscript in the RORBUF array
"RTN","RORTSK03",32,0)
 ; .RORBUF       Referrence to a local variable containing output
"RTN","RORTSK03",33,0)
 ;               of the GETS^DIQ procedure
"RTN","RORTSK03",34,0)
 ; FLAGS         Characters controlling behavior of the function
"RTN","RORTSK03",35,0)
 ;
"RTN","RORTSK03",36,0)
 ; Return Values:
"RTN","RORTSK03",37,0)
 ;       <0  Error code
"RTN","RORTSK03",38,0)
 ;        0  Ok
"RTN","RORTSK03",39,0)
 ;
"RTN","RORTSK03",40,0)
FRMTI(OFFSET,INFO,IENS,RORBUF,FLAGS) ;
"RTN","RORTSK03",41,0)
 N I,TMP,ZTCPU,ZTSK
"RTN","RORTSK03",42,0)
 ;--- Task Type
"RTN","RORTSK03",43,0)
 I $G(RORBUF(798.8,IENS,.02,"I"))'=""  D
"RTN","RORTSK03",44,0)
 . S I=OFFSET+2,INFO(I)=RORBUF(798.8,IENS,.02,"I")
"RTN","RORTSK03",45,0)
 . S:FLAGS["E" $P(INFO(I),U,2)=$G(RORBUF(798.8,IENS,.02,"E"))
"RTN","RORTSK03",46,0)
 ;--- Registry
"RTN","RORTSK03",47,0)
 I $G(RORBUF(798.8,IENS,.03,"I"))'=""  D
"RTN","RORTSK03",48,0)
 . S I=OFFSET+3,INFO(I)=RORBUF(798.8,IENS,.03,"I")
"RTN","RORTSK03",49,0)
 . S:FLAGS["E" $P(INFO(I),U,2)=$G(RORBUF(798.8,IENS,.03,"E"))
"RTN","RORTSK03",50,0)
 ;--- Report
"RTN","RORTSK03",51,0)
 S TMP=+$G(RORBUF(798.8,IENS,.04,"I"))
"RTN","RORTSK03",52,0)
 I TMP>0  S TMP=$$RPCODE^RORUTL08(TMP)  I TMP'=""  D
"RTN","RORTSK03",53,0)
 . S I=OFFSET+4,INFO(I)=TMP
"RTN","RORTSK03",54,0)
 . S:FLAGS["E" $P(INFO(I),U,2)=$G(RORBUF(798.8,IENS,.04,"E"))
"RTN","RORTSK03",55,0)
 ;--- Description
"RTN","RORTSK03",56,0)
 S INFO(OFFSET+5)=$G(RORBUF(798.8,IENS,.05,"I"))
"RTN","RORTSK03",57,0)
 ;--- Creation Time
"RTN","RORTSK03",58,0)
 I $G(RORBUF(798.8,IENS,.07,"I"))'=""  D
"RTN","RORTSK03",59,0)
 . S INFO(OFFSET+7)=RORBUF(798.8,IENS,.07,"I")
"RTN","RORTSK03",60,0)
 ;--- User
"RTN","RORTSK03",61,0)
 I $G(RORBUF(798.8,IENS,.08,"I"))'=""  D
"RTN","RORTSK03",62,0)
 . S I=OFFSET+8,INFO(I)=RORBUF(798.8,IENS,.08,"I")
"RTN","RORTSK03",63,0)
 . S:FLAGS["E" $P(INFO(I),U,2)=$G(RORBUF(798.8,IENS,.08,"E"))
"RTN","RORTSK03",64,0)
 ;--- Completion Time
"RTN","RORTSK03",65,0)
 I $G(RORBUF(798.8,IENS,2.02,"I"))'=""  D
"RTN","RORTSK03",66,0)
 . S INFO(OFFSET+9)=RORBUF(798.8,IENS,2.02,"I")
"RTN","RORTSK03",67,0)
 ;--- Progress Percentage
"RTN","RORTSK03",68,0)
 S TMP=$G(RORBUF(798.8,IENS,4,"I"))
"RTN","RORTSK03",69,0)
 S INFO(OFFSET+10)=$S(TMP'="":$J(TMP,0,2),1:"")
"RTN","RORTSK03",70,0)
 ;--- Scheduled to Run at
"RTN","RORTSK03",71,0)
 S ZTSK=TASK  D ISQED^%ZTLOAD
"RTN","RORTSK03",72,0)
 I $G(ZTSK(0)),$D(ZTSK("D"))#10  D
"RTN","RORTSK03",73,0)
 . S INFO(OFFSET+11)=$$HTFM^XLFDT(ZTSK("D"))
"RTN","RORTSK03",74,0)
 ;--- Task Log
"RTN","RORTSK03",75,0)
 S INFO(OFFSET+12)=$G(RORBUF(798.8,IENS,2.03,"I"))
"RTN","RORTSK03",76,0)
 ;--- Job Number
"RTN","RORTSK03",77,0)
 S INFO(OFFSET+13)=$G(RORBUF(798.8,IENS,2.04,"I"))
"RTN","RORTSK03",78,0)
 ;--- User Comment
"RTN","RORTSK03",79,0)
 S INFO(OFFSET+14)=$G(RORBUF(798.8,IENS,1.01,"I"))
"RTN","RORTSK03",80,0)
 Q 0
"RTN","RORTSK10")
0^126^B40092056
"RTN","RORTSK10",1,0)
RORTSK10 ;HCIOFO/SG - REPORT RETRIEVING UTILITIES ; 10/21/05 10:13am
"RTN","RORTSK10",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORTSK10",3,0)
 ;
"RTN","RORTSK10",4,0)
 Q
"RTN","RORTSK10",5,0)
 ;
"RTN","RORTSK10",6,0)
 ;***** TRACES THE PATH FROM THE ELEMENT TO THE ROOT
"RTN","RORTSK10",7,0)
 ;
"RTN","RORTSK10",8,0)
 ; IEN           IEN of the report element
"RTN","RORTSK10",9,0)
 ;
"RTN","RORTSK10",10,0)
 ; .STACK        Reference to a local variable where the path will
"RTN","RORTSK10",11,0)
 ;               be stored to.
"RTN","RORTSK10",12,0)
 ;
"RTN","RORTSK10",13,0)
 ;  STACK                Number of elements in the path (n)
"RTN","RORTSK10",14,0)
 ;  STACK(i)             Identifiers of the elements (i=1 - the source
"RTN","RORTSK10",15,0)
 ;                       element; i=n - the root element)
"RTN","RORTSK10",16,0)
 ;                         ^1: IEN of the report element
"RTN","RORTSK10",17,0)
 ;                         ^2: Where exactly the rendering process
"RTN","RORTSK10",18,0)
 ;                             has stopped (see $$XMLSTR for details)
"RTN","RORTSK10",19,0)
 ;                         ^3: IEN of the text line
"RTN","RORTSK10",20,0)
 ;
"RTN","RORTSK10",21,0)
PATH(IEN,STACK) ;
"RTN","RORTSK10",22,0)
 K STACK  S STACK=0
"RTN","RORTSK10",23,0)
 F  D  Q:IEN'>0
"RTN","RORTSK10",24,0)
 . S STACK=STACK+1,STACK(STACK)=IEN
"RTN","RORTSK10",25,0)
 . S:'$P(IEN,U,2) $P(STACK(STACK),U,2)=4
"RTN","RORTSK10",26,0)
 . S IEN=$P($G(@RORSRC@(+IEN,0)),U,2)
"RTN","RORTSK10",27,0)
 Q
"RTN","RORTSK10",28,0)
 ;
"RTN","RORTSK10",29,0)
 ;***** RENDERS THE REPORT INTO XML
"RTN","RORTSK10",30,0)
 ;
"RTN","RORTSK10",31,0)
 ; ROR8DST       Closed root of the destination buffer
"RTN","RORTSK10",32,0)
 ;
"RTN","RORTSK10",33,0)
 ; TASK          Task number
"RTN","RORTSK10",34,0)
 ;
"RTN","RORTSK10",35,0)
 ; [.SORT]       Sort modes for the report
"RTN","RORTSK10",36,0)
 ;
"RTN","RORTSK10",37,0)
 ; [.FROM]       Where to start/continue the rendering process
"RTN","RORTSK10",38,0)
 ;                 ^1: IEN of the report element
"RTN","RORTSK10",39,0)
 ;                 ^2: Where exactly the rendering process has stopped
"RTN","RORTSK10",40,0)
 ;                     (see the $$XMLSTR function for details)
"RTN","RORTSK10",41,0)
 ;                 ^3: IEN of the text line (if the 2nd piece = 3)
"RTN","RORTSK10",42,0)
 ;
"RTN","RORTSK10",43,0)
 ;               You must not make any assumptions about structure of 
"RTN","RORTSK10",44,0)
 ;               this parameter (it can be changed at any time without
"RTN","RORTSK10",45,0)
 ;               warning). The only exception is the IEN of the report
"RTN","RORTSK10",46,0)
 ;               element. You can assign a positive value to this
"RTN","RORTSK10",47,0)
 ;               parameter before the call to start the rendering from
"RTN","RORTSK10",48,0)
 ;               the corresponding element.
"RTN","RORTSK10",49,0)
 ;
"RTN","RORTSK10",50,0)
 ; [MAXSIZE]     Either the maximum number of lines to retrieve or
"RTN","RORTSK10",51,0)
 ;               the maximum size of the output in bytes (append the
"RTN","RORTSK10",52,0)
 ;               "B" to the number). By default (if $G(MAXSIZE)'>0,)
"RTN","RORTSK10",53,0)
 ;               the whole report (starting from the point indicated
"RTN","RORTSK10",54,0)
 ;               by the FROM parameter if it is defined) is retrieved.
"RTN","RORTSK10",55,0)
 ;
"RTN","RORTSK10",56,0)
 ;               Examples:
"RTN","RORTSK10",57,0)
 ;                 500    Retrieve no more than 500 lines
"RTN","RORTSK10",58,0)
 ;                 4096B  Retrieve no more than 4Kb
"RTN","RORTSK10",59,0)
 ;
"RTN","RORTSK10",60,0)
 ;         NOTE: If the "B" suffix is used, the size of the retrieved
"RTN","RORTSK10",61,0)
 ;               portion of the document can be somewhat bigger than
"RTN","RORTSK10",62,0)
 ;               MAXSIZE! The last line of the chunk is not truncated
"RTN","RORTSK10",63,0)
 ;               even if the size will be bigger than MAXSIZE.
"RTN","RORTSK10",64,0)
 ;
"RTN","RORTSK10",65,0)
 ; Return Values:
"RTN","RORTSK10",66,0)
 ;       <0  Error code
"RTN","RORTSK10",67,0)
 ;        0  Ok
"RTN","RORTSK10",68,0)
 ;       >0  Number of rendered lines
"RTN","RORTSK10",69,0)
 ;
"RTN","RORTSK10",70,0)
 ; If the maximum size (MAXSIZE) is reached, the identifiers
"RTN","RORTSK10",71,0)
 ; of the last item (it has not been added to the output buffer) are
"RTN","RORTSK10",72,0)
 ; returned via the FROM parameter. The next call of the function will
"RTN","RORTSK10",73,0)
 ; continue the rendering process starting from that item.
"RTN","RORTSK10",74,0)
 ;
"RTN","RORTSK10",75,0)
XMLREP(ROR8DST,TASK,SORT,FROM,MAXSIZE) ;
"RTN","RORTSK10",76,0)
 N RORNUM        ; Number of rendered lines of the report
"RTN","RORTSK10",77,0)
 N RORSIZE       ; Size of the output (in bytes)
"RTN","RORTSK10",78,0)
 N RORSORT       ; Sort modes for the report
"RTN","RORTSK10",79,0)
 N RORSTACK      ; Path from the FROM element to the root
"RTN","RORTSK10",80,0)
 N RORSRC        ; Closed root of the source report data
"RTN","RORTSK10",81,0)
 ;
"RTN","RORTSK10",82,0)
 N DIR,I,RC,SORTFLD,SORTLST  K @ROR8DST
"RTN","RORTSK10",83,0)
 S RORSRC=$$ROOT^DILFD(798.87,","_TASK_",",1)
"RTN","RORTSK10",84,0)
 ;--- Setup the size limits
"RTN","RORTSK10",85,0)
 S (RORNUM,RORSIZE)=0
"RTN","RORTSK10",86,0)
 S MAXSIZE=$$UP^XLFSTR($G(MAXSIZE))
"RTN","RORTSK10",87,0)
 I MAXSIZE["B"  S RORNUM(1)=0,RORSIZE(1)=+MAXSIZE
"RTN","RORTSK10",88,0)
 E  S RORNUM(1)=+MAXSIZE,RORSIZE(1)=0
"RTN","RORTSK10",89,0)
 ;--- Setup the starting point
"RTN","RORTSK10",90,0)
 I $G(FROM)>0  D
"RTN","RORTSK10",91,0)
 . S:$P(FROM,U,2)'>0 $P(FROM,U,2)=1
"RTN","RORTSK10",92,0)
 . D PATH(FROM,.RORSTACK)
"RTN","RORTSK10",93,0)
 E  S I=$$XMLSTR("<?xml version=""1.0""?>")
"RTN","RORTSK10",94,0)
 ;--- Setup the sorting
"RTN","RORTSK10",95,0)
 S (FROM,I)=""
"RTN","RORTSK10",96,0)
 F  S I=$O(SORT(I))  Q:I=""  D
"RTN","RORTSK10",97,0)
 . S SORTLST=$P(SORT(I),"=")            Q:SORTLST=""
"RTN","RORTSK10",98,0)
 . S SORTFLD=$P($P(SORT(I),"=",2),":")  Q:SORTFLD=""
"RTN","RORTSK10",99,0)
 . S DIR=$S($P(SORT(I),":",2)?1"D".1"ESC":-1,1:1)
"RTN","RORTSK10",100,0)
 . S RORSORT($$XEC^RORTSK11(SORTLST))=$$XEC^RORTSK11(SORTFLD)_U_DIR
"RTN","RORTSK10",101,0)
 ;--- Get the report
"RTN","RORTSK10",102,0)
 S RC=$$XMLREPI(0,0)
"RTN","RORTSK10",103,0)
 S:RC>0 FROM=$P(RC,U,2)_U_$P(RC,U)_U_$P(RC,U,3)
"RTN","RORTSK10",104,0)
 Q $S(RC'<0:RORNUM,1:RC)
"RTN","RORTSK10",105,0)
 ;
"RTN","RORTSK10",106,0)
 ;***** RECURSIVELY RENDERS THE REPORT INTO XML
"RTN","RORTSK10",107,0)
 ;
"RTN","RORTSK10",108,0)
 ; PARENT        IEN of the parent element
"RTN","RORTSK10",109,0)
 ; PELC          Type of the parent element
"RTN","RORTSK10",110,0)
 ;
"RTN","RORTSK10",111,0)
 ; Return Values:
"RTN","RORTSK10",112,0)
 ;       <0  Error code
"RTN","RORTSK10",113,0)
 ;        0  Ok
"RTN","RORTSK10",114,0)
 ;       >0  Number of rendered lines has reached the limit
"RTN","RORTSK10",115,0)
 ;           (see the $$XMLSTR function for details)
"RTN","RORTSK10",116,0)
 ;
"RTN","RORTSK10",117,0)
XMLREPI(PARENT,PELC) ;
"RTN","RORTSK10",118,0)
 N RORIEN        ; IEN of the report element being processed
"RTN","RORTSK10",119,0)
 ;
"RTN","RORTSK10",120,0)
 N BUF,DIR,LC,ELEMENT,I,LINE,MODE,RC,SVC,TMP,VAL,XREF
"RTN","RORTSK10",121,0)
 I $G(PELC)>0  D
"RTN","RORTSK10",122,0)
 . S BUF=$G(RORSORT(PELC)),SVC=+$P(BUF,U),DIR=$S($P(BUF,U,2)<0:-1,1:1)
"RTN","RORTSK10",123,0)
 E  S SVC=0,DIR=1
"RTN","RORTSK10",124,0)
 S XREF=$NA(@RORSRC@("APSV",PARENT,SVC))
"RTN","RORTSK10",125,0)
 ;--- Use order of creation if the xref is not available
"RTN","RORTSK10",126,0)
 S:$D(@XREF)<10 XREF=$NA(@RORSRC@("APSV",PARENT,0))
"RTN","RORTSK10",127,0)
 ;--- Determine the starting point (FROM)
"RTN","RORTSK10",128,0)
 I $G(RORSTACK)>0  S RC=0  D  Q:RC RC
"RTN","RORTSK10",129,0)
 . S RORIEN=+$P(RORSTACK(RORSTACK),U)
"RTN","RORTSK10",130,0)
 . S MODE=+$P(RORSTACK(RORSTACK),U,2)
"RTN","RORTSK10",131,0)
 . S LINE=+$P(RORSTACK(RORSTACK),U,3)
"RTN","RORTSK10",132,0)
 . S RORSTACK=RORSTACK-1
"RTN","RORTSK10",133,0)
 . S I=+$O(@RORSRC@("APSR",RORIEN,SVC,""))
"RTN","RORTSK10",134,0)
 . I I>0  D
"RTN","RORTSK10",135,0)
 . . S TMP=+$P($G(@RORSRC@(I,0)),U,3)
"RTN","RORTSK10",136,0)
 . . S VAL=$$SORTBY^RORDD01(TMP,$G(@RORSRC@(I,1)))
"RTN","RORTSK10",137,0)
 . E  S VAL=" "
"RTN","RORTSK10",138,0)
 . S RORIEN=$O(@RORSRC@("APSV",PARENT,SVC,VAL,RORIEN),-DIR)
"RTN","RORTSK10",139,0)
 . S VAL=$O(@RORSRC@("APSV",PARENT,SVC,VAL),-DIR)
"RTN","RORTSK10",140,0)
 E  K RORSTACK  S (LINE,MODE)=0,(RORIEN,VAL)=""
"RTN","RORTSK10",141,0)
 ;--- Render the report elements
"RTN","RORTSK10",142,0)
 S RC=0
"RTN","RORTSK10",143,0)
 F  S VAL=$O(@XREF@(VAL),DIR)  Q:VAL=""  D  Q:RC
"RTN","RORTSK10",144,0)
 . F  S RORIEN=$O(@XREF@(VAL,RORIEN),DIR)  Q:RORIEN=""  D  S MODE=0  Q:RC
"RTN","RORTSK10",145,0)
 . . S TMP=$G(@RORSRC@(RORIEN,0))  Q:$P(TMP,U,4)
"RTN","RORTSK10",146,0)
 . . S ELC=+$P(TMP,U)  Q:ELC'>0
"RTN","RORTSK10",147,0)
 . . S ELEMENT=$P(^ROR(799.31,ELC,0),U)
"RTN","RORTSK10",148,0)
 . . S I=0,BUF="<"_ELEMENT
"RTN","RORTSK10",149,0)
 . . ;--- Render the attributes of the element
"RTN","RORTSK10",150,0)
 . . F  S I=$O(@RORSRC@(RORIEN,2,I))  Q:I'>0  D
"RTN","RORTSK10",151,0)
 . . . S TMP=$P(@RORSRC@(RORIEN,2,I,0),U)
"RTN","RORTSK10",152,0)
 . . . S BUF=BUF_" "_$P(^ROR(799.31,TMP,0),U)
"RTN","RORTSK10",153,0)
 . . . S BUF=BUF_"="""_$G(@RORSRC@(RORIEN,2,I,1))_""""
"RTN","RORTSK10",154,0)
 . . ;--- Append the SORT attribute(s) to a table
"RTN","RORTSK10",155,0)
 . . D:$D(RORSORT(ELC))
"RTN","RORTSK10",156,0)
 . . . S TMP=+$P(RORSORT(ELC),U)  Q:TMP'>0
"RTN","RORTSK10",157,0)
 . . . S BUF=BUF_" SORT="""_$P(^ROR(799.31,TMP,0),U)_""""
"RTN","RORTSK10",158,0)
 . . . S TMP=+$P(RORSORT(ELC),U,2)
"RTN","RORTSK10",159,0)
 . . . S:TMP<0 BUF=BUF_" SORTDESC=""1"""
"RTN","RORTSK10",160,0)
 . . ;--- Leaf element (without children)
"RTN","RORTSK10",161,0)
 . . I $D(@RORSRC@("APSV",RORIEN))<10  D  Q
"RTN","RORTSK10",162,0)
 . . . ;--- <ELEMENT...>VALUE</ELEMENT>
"RTN","RORTSK10",163,0)
 . . . S TMP=$G(@RORSRC@(RORIEN,1))
"RTN","RORTSK10",164,0)
 . . . I TMP'=""  D:MODE'>2  Q
"RTN","RORTSK10",165,0)
 . . . . S RC=$$XMLSTR(BUF_">"_TMP_"</"_ELEMENT_">",2)
"RTN","RORTSK10",166,0)
 . . . ;--- <ELEMENT.../>
"RTN","RORTSK10",167,0)
 . . . S I=$O(@RORSRC@(RORIEN,3,0))
"RTN","RORTSK10",168,0)
 . . . I I'>0  S:MODE'>2 RC=$$XMLSTR(BUF_"/>",2)  Q
"RTN","RORTSK10",169,0)
 . . . ;--- <ELEMENT...>
"RTN","RORTSK10",170,0)
 . . . ;    TEXT
"RTN","RORTSK10",171,0)
 . . . ;--- </ELEMENT>
"RTN","RORTSK10",172,0)
 . . . I MODE'>3  D  Q:RC
"RTN","RORTSK10",173,0)
 . . . . S:MODE'>1 RC=$$XMLSTR(BUF_">",1)
"RTN","RORTSK10",174,0)
 . . . . S:LINE>0 I=LINE,LINE=0
"RTN","RORTSK10",175,0)
 . . . . F  Q:RC  D  S I=$O(@RORSRC@(RORIEN,3,I))  Q:I'>0
"RTN","RORTSK10",176,0)
 . . . . . S RC=$$XMLSTR($G(@RORSRC@(RORIEN,3,I,0)),3,I)
"RTN","RORTSK10",177,0)
 . . . S RC=$$XMLSTR("</"_ELEMENT_">",5)
"RTN","RORTSK10",178,0)
 . . ;--- Parent element and all children (recursively)
"RTN","RORTSK10",179,0)
 . . I MODE'>4  D  Q:RC
"RTN","RORTSK10",180,0)
 . . . I MODE'>1  S RC=$$XMLSTR(BUF_">",1)  Q:RC
"RTN","RORTSK10",181,0)
 . . . S RC=$$XMLREPI(RORIEN,ELC)
"RTN","RORTSK10",182,0)
 . . S RC=$$XMLSTR("</"_ELEMENT_">",5)
"RTN","RORTSK10",183,0)
 . S RORIEN=""
"RTN","RORTSK10",184,0)
 Q RC
"RTN","RORTSK10",185,0)
 ;
"RTN","RORTSK10",186,0)
 ;***** APPENDS THE STRING TO THE OUTPUT BUFFER
"RTN","RORTSK10",187,0)
 ;
"RTN","RORTSK10",188,0)
 ; STR           String that should be appended to the document
"RTN","RORTSK10",189,0)
 ; TYPE          Type of the rendered item
"RTN","RORTSK10",190,0)
 ; [LINE]        IEN of the text line
"RTN","RORTSK10",191,0)
 ;
"RTN","RORTSK10",192,0)
 ; Return Values:
"RTN","RORTSK10",193,0)
 ;        0  Ok
"RTN","RORTSK10",194,0)
 ;       >0  Number of rendered lines has reached the limit
"RTN","RORTSK10",195,0)
 ;             ^1: Where exactly the rendering process has stopped
"RTN","RORTSK10",196,0)
 ;                   1  Opening tag
"RTN","RORTSK10",197,0)
 ;                   2  Single value
"RTN","RORTSK10",198,0)
 ;                   3  Multiline text value
"RTN","RORTSK10",199,0)
 ;                   4  Nested tag
"RTN","RORTSK10",200,0)
 ;                   5  Closing tag
"RTN","RORTSK10",201,0)
 ;             ^2: IEN of the report element
"RTN","RORTSK10",202,0)
 ;             ^3: IEN of the text line (if the 1st piece = 3)
"RTN","RORTSK10",203,0)
 ;
"RTN","RORTSK10",204,0)
XMLSTR(STR,TYPE,LINE) ;
"RTN","RORTSK10",205,0)
 N SL  S SL=$L(STR)+2
"RTN","RORTSK10",206,0)
 I RORNUM(1)>0  Q:RORNUM'<RORNUM(1) TYPE_U_RORIEN_U_$G(LINE)
"RTN","RORTSK10",207,0)
 I RORSIZE(1)>0  Q:RORSIZE'<RORSIZE(1) TYPE_U_RORIEN_U_$G(LINE)
"RTN","RORTSK10",208,0)
 S RORNUM=RORNUM+1,@ROR8DST@(RORNUM)=STR
"RTN","RORTSK10",209,0)
 S RORSIZE=RORSIZE+SL
"RTN","RORTSK10",210,0)
 Q 0
"RTN","RORTSK10",211,0)
 ;
"RTN","RORTSK10",212,0)
 ;*****
"RTN","RORTSK10",213,0)
XREFNODE(TASK,PARENT,SORT) ;
"RTN","RORTSK10",214,0)
 N NODE
"RTN","RORTSK10",215,0)
 S NODE=$$ROOT^DILFD(798.87,","_TASK_",",1)
"RTN","RORTSK10",216,0)
 S SORT=$$XEC^RORTSK11(SORT)
"RTN","RORTSK10",217,0)
 Q $S(SORT>0:$NA(@NODE@("APSV",PARENT,SORT)),1:"")
"RTN","RORTSK11")
0^127^B20505407
"RTN","RORTSK11",1,0)
RORTSK11 ;HCIOFO/SG - REPORT CREATION UTILITIES ; 10/25/05 2:17pm
"RTN","RORTSK11",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORTSK11",3,0)
 ;
"RTN","RORTSK11",4,0)
 Q
"RTN","RORTSK11",5,0)
 ;
"RTN","RORTSK11",6,0)
 ;***** ADDS THE ATTRIBUTE TO THE ELEMENT
"RTN","RORTSK11",7,0)
 ;
"RTN","RORTSK11",8,0)
 ; TASK          Task number
"RTN","RORTSK11",9,0)
 ;
"RTN","RORTSK11",10,0)
 ; ELMTIEN       IEN of the element
"RTN","RORTSK11",11,0)
 ;
"RTN","RORTSK11",12,0)
 ; NAME          Attribute name
"RTN","RORTSK11",13,0)
 ;
"RTN","RORTSK11",14,0)
 ; VALUE         Value of the attribute
"RTN","RORTSK11",15,0)
 ;
"RTN","RORTSK11",16,0)
 ; The value is automatically encoded by this function.
"RTN","RORTSK11",17,0)
 ; See the $$XMLENC^RORUTL03 function for more details
"RTN","RORTSK11",18,0)
 ;
"RTN","RORTSK11",19,0)
 ; Return Values:
"RTN","RORTSK11",20,0)
 ;       <0  Error code
"RTN","RORTSK11",21,0)
 ;        0  Invalid attribute name
"RTN","RORTSK11",22,0)
 ;       >0  Attribute IEN
"RTN","RORTSK11",23,0)
 ;
"RTN","RORTSK11",24,0)
ADDATTR(TASK,ELMTIEN,NAME,VALUE) ;
"RTN","RORTSK11",25,0)
 I $G(ELMTIEN)<0  Q:$QUIT 0  Q
"RTN","RORTSK11",26,0)
 N IENS,RC,RORFDA,RORIEN,RORMSG
"RTN","RORTSK11",27,0)
 I $D(^RORDATA(798.8,+TASK,"RI",+ELMTIEN))<10  Q:$QUIT 0  Q
"RTN","RORTSK11",28,0)
 S IENS="?+1,"_(+ELMTIEN)_","_(+TASK)_","
"RTN","RORTSK11",29,0)
 S (RORIEN(1),RORFDA(798.872,IENS,.01))=$$XEC(NAME)
"RTN","RORTSK11",30,0)
 I RORIEN(1)'>0  Q:$QUIT 0  Q
"RTN","RORTSK11",31,0)
 S RORFDA(798.872,IENS,1)=$$XMLENC^RORUTL03(VALUE)
"RTN","RORTSK11",32,0)
 D UPDATE^DIE(,"RORFDA","RORIEN","RORMSG")
"RTN","RORTSK11",33,0)
 I $G(DIERR)  D  Q:$QUIT RC  Q
"RTN","RORTSK11",34,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.872,IENS)
"RTN","RORTSK11",35,0)
 Q:$QUIT +$G(RORIEN(1))  Q
"RTN","RORTSK11",36,0)
 ;
"RTN","RORTSK11",37,0)
 ;***** ADDS THE TEXT ELEMENT TO THE REPORT
"RTN","RORTSK11",38,0)
 ;
"RTN","RORTSK11",39,0)
 ; TASK          Task number
"RTN","RORTSK11",40,0)
 ;
"RTN","RORTSK11",41,0)
 ; NAME          Element name
"RTN","RORTSK11",42,0)
 ;
"RTN","RORTSK11",43,0)
 ; [.]ROR8TXT    Either a closed root or a reference to an array
"RTN","RORTSK11",44,0)
 ;               that contains the text in word processing format.
"RTN","RORTSK11",45,0)
 ;
"RTN","RORTSK11",46,0)
 ; [PARENT]      IEN of the parent element
"RTN","RORTSK11",47,0)
 ;
"RTN","RORTSK11",48,0)
 ; The text is not encoded by the function. This should be done
"RTN","RORTSK11",49,0)
 ; beforehand (use the $$XMLENC^RORUTL03 function).
"RTN","RORTSK11",50,0)
 ;
"RTN","RORTSK11",51,0)
 ; Return Values:
"RTN","RORTSK11",52,0)
 ;       <0  Error code
"RTN","RORTSK11",53,0)
 ;        0  Invalid element name
"RTN","RORTSK11",54,0)
 ;       >0  IEN of the report element
"RTN","RORTSK11",55,0)
 ;
"RTN","RORTSK11",56,0)
ADDTEXT(TASK,NAME,ROR8TXT,PARENT) ;
"RTN","RORTSK11",57,0)
 I $G(PARENT)<0  Q:$QUIT 0  Q
"RTN","RORTSK11",58,0)
 N IENS,RC,RORFDA,RORIEN,RORMSG,TMP
"RTN","RORTSK11",59,0)
 S IENS="+1,"_(+TASK)_","
"RTN","RORTSK11",60,0)
 S (RORFDA(798.87,IENS,.01),TMP)=$$XEC(NAME)
"RTN","RORTSK11",61,0)
 I TMP'>0  Q:$QUIT 0  Q
"RTN","RORTSK11",62,0)
 S RORFDA(798.87,IENS,.02)=+$G(PARENT)
"RTN","RORTSK11",63,0)
 S RORFDA(798.87,IENS,3)=$S($D(ROR8TXT)>1:"ROR8TXT",1:ROR8TXT)
"RTN","RORTSK11",64,0)
 D UPDATE^DIE(,"RORFDA","RORIEN","RORMSG")
"RTN","RORTSK11",65,0)
 I $G(DIERR)  D  Q:$QUIT RC  Q
"RTN","RORTSK11",66,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.87,IENS)
"RTN","RORTSK11",67,0)
 Q:$QUIT +$G(RORIEN(1))  Q
"RTN","RORTSK11",68,0)
 ;
"RTN","RORTSK11",69,0)
 ;***** ADDS THE SINGLE-LINE ELEMENT TO THE REPORT
"RTN","RORTSK11",70,0)
 ;
"RTN","RORTSK11",71,0)
 ; TASK          Task number
"RTN","RORTSK11",72,0)
 ;
"RTN","RORTSK11",73,0)
 ; NAME          Element name
"RTN","RORTSK11",74,0)
 ;
"RTN","RORTSK11",75,0)
 ; [VALUE]       Value of the element
"RTN","RORTSK11",76,0)
 ;
"RTN","RORTSK11",77,0)
 ; [PARENT]      IEN of the parent element
"RTN","RORTSK11",78,0)
 ;
"RTN","RORTSK11",79,0)
 ; [SORTBY]      Parent element is sorted by the value of the element
"RTN","RORTSK11",80,0)
 ;               that is being added:
"RTN","RORTSK11",81,0)
 ;                 1  Sort "as is"
"RTN","RORTSK11",82,0)
 ;                 2  Sort as strings
"RTN","RORTSK11",83,0)
 ;                 3  Sort as numbers
"RTN","RORTSK11",84,0)
 ;
"RTN","RORTSK11",85,0)
 ; The value is automatically encoded by this function.
"RTN","RORTSK11",86,0)
 ; See the $$XMLENC^RORUTL03 function for more details
"RTN","RORTSK11",87,0)
 ;
"RTN","RORTSK11",88,0)
 ; Return Values:
"RTN","RORTSK11",89,0)
 ;       <0  Error code
"RTN","RORTSK11",90,0)
 ;        0  Invalid element name
"RTN","RORTSK11",91,0)
 ;       >0  IEN of the report element
"RTN","RORTSK11",92,0)
 ;
"RTN","RORTSK11",93,0)
ADDVAL(TASK,NAME,VALUE,PARENT,SORTBY,ID) ;
"RTN","RORTSK11",94,0)
 I $G(PARENT)<0  Q:$QUIT 0  Q
"RTN","RORTSK11",95,0)
 N IENS,RC,RORFDA,RORIEN,RORMSG,TMP
"RTN","RORTSK11",96,0)
 S IENS="+1,"_(+TASK)_","
"RTN","RORTSK11",97,0)
 S (RORFDA(798.87,IENS,.01),TMP)=$$XEC(NAME)
"RTN","RORTSK11",98,0)
 I TMP'>0  Q:$QUIT 0  Q
"RTN","RORTSK11",99,0)
 S RORFDA(798.87,IENS,.02)=+$G(PARENT)
"RTN","RORTSK11",100,0)
 S:$G(SORTBY) RORFDA(798.87,IENS,.03)=SORTBY
"RTN","RORTSK11",101,0)
 S:$G(VALUE)'="" RORFDA(798.87,IENS,1)=$$XMLENC^RORUTL03(VALUE)
"RTN","RORTSK11",102,0)
 D:$G(ID)'=""
"RTN","RORTSK11",103,0)
 . S TMP="+2,"_IENS
"RTN","RORTSK11",104,0)
 . S (RORIEN(2),RORFDA(798.872,TMP,.01))=$$XEC("ID")
"RTN","RORTSK11",105,0)
 . S RORFDA(798.872,TMP,1)=ID
"RTN","RORTSK11",106,0)
 D UPDATE^DIE(,"RORFDA","RORIEN","RORMSG")
"RTN","RORTSK11",107,0)
 I $G(DIERR)  D  Q:$QUIT RC  Q
"RTN","RORTSK11",108,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.87,IENS)
"RTN","RORTSK11",109,0)
 Q:$QUIT +$G(RORIEN(1))  Q
"RTN","RORTSK11",110,0)
 ;
"RTN","RORTSK11",111,0)
 ;***** CHECKS IF THE ELEMENT HAS "CHILDREN"
"RTN","RORTSK11",112,0)
 ;
"RTN","RORTSK11",113,0)
 ; TASK          Task number
"RTN","RORTSK11",114,0)
 ;
"RTN","RORTSK11",115,0)
 ; ELMTIEN       IEN of the element
"RTN","RORTSK11",116,0)
 ;
"RTN","RORTSK11",117,0)
 ; Return Values:
"RTN","RORTSK11",118,0)
 ;        0  Leaf element
"RTN","RORTSK11",119,0)
 ;       >0  Has children
"RTN","RORTSK11",120,0)
 ;
"RTN","RORTSK11",121,0)
HASCHLD(TASK,ELMTIEN) ;
"RTN","RORTSK11",122,0)
 Q:ELMTIEN<0 0
"RTN","RORTSK11",123,0)
 Q $D(^RORDATA(798.8,+TASK,"RI","APSV",+ELMTIEN))>1
"RTN","RORTSK11",124,0)
 ;
"RTN","RORTSK11",125,0)
 ;***** UPDATES VALUE OF THE ELEMENT
"RTN","RORTSK11",126,0)
 ;
"RTN","RORTSK11",127,0)
 ; TASK          Task number
"RTN","RORTSK11",128,0)
 ;
"RTN","RORTSK11",129,0)
 ; ELMTIEN       IEN of the element
"RTN","RORTSK11",130,0)
 ;
"RTN","RORTSK11",131,0)
 ; [VALUE]       Value of the element
"RTN","RORTSK11",132,0)
 ;
"RTN","RORTSK11",133,0)
 ; [SORTBY]      Parent element is sorted by the value of the element
"RTN","RORTSK11",134,0)
 ;               that is being added:
"RTN","RORTSK11",135,0)
 ;                 1  Sort "as is"
"RTN","RORTSK11",136,0)
 ;                 2  Sort as strings
"RTN","RORTSK11",137,0)
 ;                 3  Sort as numbers
"RTN","RORTSK11",138,0)
 ;
"RTN","RORTSK11",139,0)
 ; [IGNORE]      Do not render this element into the resulting XML
"RTN","RORTSK11",140,0)
 ;               document.
"RTN","RORTSK11",141,0)
 ;
"RTN","RORTSK11",142,0)
 ; The value is automatically encoded by this function.
"RTN","RORTSK11",143,0)
 ; See the $$XMLENC^RORUTL03 function for more details
"RTN","RORTSK11",144,0)
 ;
"RTN","RORTSK11",145,0)
 ; Return Values:
"RTN","RORTSK11",146,0)
 ;       <0  Error code
"RTN","RORTSK11",147,0)
 ;       >0  IEN of the report element
"RTN","RORTSK11",148,0)
 ;
"RTN","RORTSK11",149,0)
UPDVAL(TASK,ELMTIEN,VALUE,SORTBY,IGNORE) ;
"RTN","RORTSK11",150,0)
 I $G(ELMTIEN)<0  Q:$QUIT 0  Q
"RTN","RORTSK11",151,0)
 N IENS,RORFDA,RORIEN,RORMSG,TMP
"RTN","RORTSK11",152,0)
 I $D(^RORDATA(798.8,+TASK,"RI",+ELMTIEN))<10  Q:$QUIT 0  Q
"RTN","RORTSK11",153,0)
 S IENS=(+ELMTIEN)_","_(+TASK)_","
"RTN","RORTSK11",154,0)
 S:$G(SORTBY) RORFDA(798.87,IENS,.03)=SORTBY
"RTN","RORTSK11",155,0)
 S RORFDA(798.87,IENS,.04)=$S($G(IGNORE):1,1:"")
"RTN","RORTSK11",156,0)
 S RORFDA(798.87,IENS,1)=$$XMLENC^RORUTL03($G(VALUE))
"RTN","RORTSK11",157,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORTSK11",158,0)
 I $G(DIERR)  D  Q:$QUIT RC  Q
"RTN","RORTSK11",159,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.87,IENS)
"RTN","RORTSK11",160,0)
 Q:$QUIT +$G(RORIEN(1))  Q
"RTN","RORTSK11",161,0)
 ;
"RTN","RORTSK11",162,0)
 ;***** DUMPS THE VARIABLE
"RTN","RORTSK11",163,0)
 ;
"RTN","RORTSK11",164,0)
 ; TASK          Task number
"RTN","RORTSK11",165,0)
 ;
"RTN","RORTSK11",166,0)
 ; ROOT          Closed root of the variable
"RTN","RORTSK11",167,0)
 ;
"RTN","RORTSK11",168,0)
 ; [PARENT]      IEN of the parent element (0, by default)
"RTN","RORTSK11",169,0)
 ;
"RTN","RORTSK11",170,0)
 ; [NAME]        Element name ("VARDUMP", by default)
"RTN","RORTSK11",171,0)
 ;
"RTN","RORTSK11",172,0)
 ; Return Values:
"RTN","RORTSK11",173,0)
 ;       <0  Error code
"RTN","RORTSK11",174,0)
 ;       >0  IEN of the element
"RTN","RORTSK11",175,0)
 ;
"RTN","RORTSK11",176,0)
VARDUMP(TASK,ROOT,PARENT,NAME) ;
"RTN","RORTSK11",177,0)
 N DUMP,FLT,LFLT,PI
"RTN","RORTSK11",178,0)
 S:$G(NAME)="" NAME="VARDUMP"
"RTN","RORTSK11",179,0)
 S:$G(PARENT)'>0 PARENT=0
"RTN","RORTSK11",180,0)
 ;---
"RTN","RORTSK11",181,0)
 S LFLT=$L(ROOT)
"RTN","RORTSK11",182,0)
 S:$E(ROOT,LFLT)=")" LFLT=LFLT-1
"RTN","RORTSK11",183,0)
 S FLT=$E(ROOT,1,LFLT)
"RTN","RORTSK11",184,0)
 ;---
"RTN","RORTSK11",185,0)
 S DUMP=$$ADDVAL^RORTSK11(TASK,NAME,,PARENT)
"RTN","RORTSK11",186,0)
 I DUMP<0  Q:$QUIT DUMP  Q
"RTN","RORTSK11",187,0)
 S PI=ROOT
"RTN","RORTSK11",188,0)
 F  S PI=$Q(@PI)  Q:$E(PI,1,LFLT)'=FLT  D
"RTN","RORTSK11",189,0)
 . D ADDVAL^RORTSK11(TASK,"ITEM",PI_"="_@PI,DUMP)
"RTN","RORTSK11",190,0)
 Q:$QUIT DUMP  Q
"RTN","RORTSK11",191,0)
 ;
"RTN","RORTSK11",192,0)
 ;***** RETURNS TYPE (CODE) OF THE ELEMENT
"RTN","RORTSK11",193,0)
 ;
"RTN","RORTSK11",194,0)
 ; NAME          Element name
"RTN","RORTSK11",195,0)
 ;
"RTN","RORTSK11",196,0)
XEC(NAME) ;
"RTN","RORTSK11",197,0)
 S:'$D(RORCACHE("XMLENT",NAME)) RORCACHE("XMLENT",NAME)=+$O(^ROR(799.31,"B",$E(NAME,1,30),0))
"RTN","RORTSK11",198,0)
 Q RORCACHE("XMLENT",NAME)
"RTN","RORTSK12")
0^204^B9078558
"RTN","RORTSK12",1,0)
RORTSK12 ;HCIOFO/SG - REPORT STATS UTILITIES ; 7/15/05 12:00pm
"RTN","RORTSK12",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORTSK12",3,0)
 ;
"RTN","RORTSK12",4,0)
 Q
"RTN","RORTSK12",5,0)
 ;
"RTN","RORTSK12",6,0)
 ;***** CLEARS THE STATISTICS
"RTN","RORTSK12",7,0)
 ;
"RTN","RORTSK12",8,0)
 ; REGIEN        Registry IEN
"RTN","RORTSK12",9,0)
 ;
"RTN","RORTSK12",10,0)
 ; [RPTCODE]     Report Code. By default ($G(RPTCODE)'>0),
"RTN","RORTSK12",11,0)
 ;               all statistic data is deleted.
"RTN","RORTSK12",12,0)
 ;
"RTN","RORTSK12",13,0)
CLEAR(REGIEN,RPTCODE) ;
"RTN","RORTSK12",14,0)
 N DA,DIK,IENS,NODE,RPIEN
"RTN","RORTSK12",15,0)
 S DA(1)=+REGIEN,IENS=","_DA(1)_","
"RTN","RORTSK12",16,0)
 S DIK=$$ROOT^DILFD(798.12,IENS)
"RTN","RORTSK12",17,0)
 S NODE=$$CREF^DILF(DIK)
"RTN","RORTSK12",18,0)
 ;
"RTN","RORTSK12",19,0)
 ;--- Clear the report stats
"RTN","RORTSK12",20,0)
 I $G(RPTCODE)>0  D  Q
"RTN","RORTSK12",21,0)
 . S RPIEN=$$RPIEN^RORUTL08(RPTCODE)  Q:RPIEN'>0
"RTN","RORTSK12",22,0)
 . L +@NODE@(RPTCODE):5
"RTN","RORTSK12",23,0)
 . S DA=$$FIND1^DIC(798.12,IENS,"QX",RPIEN,"B",,"RORMSG")
"RTN","RORTSK12",24,0)
 . D:DA>0 ^DIK
"RTN","RORTSK12",25,0)
 . L -@NODE@(RPTCODE)
"RTN","RORTSK12",26,0)
 ;
"RTN","RORTSK12",27,0)
 ;--- Clear all stats
"RTN","RORTSK12",28,0)
 L +@NODE:5
"RTN","RORTSK12",29,0)
 S DA=0  F  S DA=$O(@NODE@(DA))  Q:DA'>0  D ^DIK
"RTN","RORTSK12",30,0)
 L -@NODE
"RTN","RORTSK12",31,0)
 Q
"RTN","RORTSK12",32,0)
 ;
"RTN","RORTSK12",33,0)
 ;***** INCREMENT THE NUMBER OF REPORT RUNS
"RTN","RORTSK12",34,0)
 ;
"RTN","RORTSK12",35,0)
 ; REGIEN        Registry IEN
"RTN","RORTSK12",36,0)
 ;
"RTN","RORTSK12",37,0)
 ; RPTCODE       Report Code
"RTN","RORTSK12",38,0)
 ;
"RTN","RORTSK12",39,0)
 ; [VAL]         Increment value. By default ($G(VAL)'>0),
"RTN","RORTSK12",40,0)
 ;               the counter is incremented by 1.
"RTN","RORTSK12",41,0)
 ;
"RTN","RORTSK12",42,0)
INC(REGIEN,RPTCODE,VAL) ;
"RTN","RORTSK12",43,0)
 N IEN,IENS,NODE,RORBUF,RORFDA,RORMSG,RPIEN,TMP
"RTN","RORTSK12",44,0)
 S:$G(VAL)'>0 VAL=1
"RTN","RORTSK12",45,0)
 ;
"RTN","RORTSK12",46,0)
 ;--- Get IEN of the report parameters
"RTN","RORTSK12",47,0)
 S RPIEN=$$RPIEN^RORUTL08(RPTCODE)  Q:RPIEN'>0
"RTN","RORTSK12",48,0)
 ;
"RTN","RORTSK12",49,0)
 ;--- Lock the report stats
"RTN","RORTSK12",50,0)
 S IENS=","_(+REGIEN)_","
"RTN","RORTSK12",51,0)
 S NODE=$$ROOT^DILFD(798.12,IENS,1)
"RTN","RORTSK12",52,0)
 L +@NODE@(RPTCODE):5
"RTN","RORTSK12",53,0)
 D
"RTN","RORTSK12",54,0)
 . ;--- Find and load the report stats
"RTN","RORTSK12",55,0)
 . S TMP="@;.02"
"RTN","RORTSK12",56,0)
 . D FIND^DIC(798.12,IENS,TMP,"QX",RPIEN,2,"B",,,"RORBUF","RORMSG")
"RTN","RORTSK12",57,0)
 . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,798.12,IENS)
"RTN","RORTSK12",58,0)
 . Q:$G(RORBUF("DILIST",0))>1
"RTN","RORTSK12",59,0)
 . S IEN=+$G(RORBUF("DILIST",2,1))
"RTN","RORTSK12",60,0)
 . ;--- Increment the counter
"RTN","RORTSK12",61,0)
 . S IENS=$S(IEN>0:IEN,1:"?+1")_","_(+REGIEN)_","
"RTN","RORTSK12",62,0)
 . S RORFDA(798.12,IENS,.01)=RPIEN
"RTN","RORTSK12",63,0)
 . S RORFDA(798.12,IENS,.02)=$G(RORBUF("DILIST","ID",1,.02))+VAL
"RTN","RORTSK12",64,0)
 . D UPDATE^DIE(,"RORFDA",,"RORMSG")
"RTN","RORTSK12",65,0)
 . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,798.12,IENS)
"RTN","RORTSK12",66,0)
 ;
"RTN","RORTSK12",67,0)
 ;--- Unlock the report stats
"RTN","RORTSK12",68,0)
 L -@NODE@(RPTCODE)
"RTN","RORTSK12",69,0)
 Q
"RTN","RORTSK12",70,0)
 ;
"RTN","RORTSK12",71,0)
 ;***** RETURNS THE REPORT RUN STATISTICS
"RTN","RORTSK12",72,0)
 ;
"RTN","RORTSK12",73,0)
 ; REGIEN        Registry IEN
"RTN","RORTSK12",74,0)
 ;
"RTN","RORTSK12",75,0)
 ; .STATS        Reference to a local array where the statistics
"RTN","RORTSK12",76,0)
 ;               (collected since the last successful data
"RTN","RORTSK12",77,0)
 ;               transmission) will be returned to.
"RTN","RORTSK12",78,0)
 ;
"RTN","RORTSK12",79,0)
 ;  STATS(       Report Statistics Summary
"RTN","RORTSK12",80,0)
 ;                 ^01: Total number of report runs
"RTN","RORTSK12",81,0)
 ;    RptCode)   Report run statistics
"RTN","RORTSK12",82,0)
 ;                 ^01: Number of report runs
"RTN","RORTSK12",83,0)
 ;
"RTN","RORTSK12",84,0)
 ; Return Values:
"RTN","RORTSK12",85,0)
 ;       <0  Error code
"RTN","RORTSK12",86,0)
 ;        0  Ok
"RTN","RORTSK12",87,0)
 ;
"RTN","RORTSK12",88,0)
STATS(REGIEN,STATS) ;
"RTN","RORTSK12",89,0)
 N IR,RORBUF,RORMSG,RPTCODE,TMP
"RTN","RORTSK12",90,0)
 K STATS  S STATS="0"
"RTN","RORTSK12",91,0)
 ;--- Load the statistics
"RTN","RORTSK12",92,0)
 S TMP=","_(+REGIEN)_","
"RTN","RORTSK12",93,0)
 D LIST^DIC(798.12,TMP,".01I;.02","Q",,,,"B",,,"RORBUF","RORMSG")
"RTN","RORTSK12",94,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.12,TMP)
"RTN","RORTSK12",95,0)
 ;--- Process the statistics
"RTN","RORTSK12",96,0)
 S IR=0
"RTN","RORTSK12",97,0)
 F  S IR=$O(RORBUF("DILIST","ID",IR))  Q:IR'>0  D
"RTN","RORTSK12",98,0)
 . ;--- Get the IEN of the report parameters
"RTN","RORTSK12",99,0)
 . S TMP=+$G(RORBUF("DILIST","ID",IR,.01))  Q:TMP'>0
"RTN","RORTSK12",100,0)
 . ;--- Get the report code
"RTN","RORTSK12",101,0)
 . S RPTCODE=$$RPCODE^RORUTL08(TMP)  Q:RPTCODE'>0
"RTN","RORTSK12",102,0)
 . ;--- Get the report statistics
"RTN","RORTSK12",103,0)
 . S TMP=+$G(RORBUF("DILIST","ID",IR,.02))
"RTN","RORTSK12",104,0)
 . S $P(STATS(RPTCODE),U)=TMP
"RTN","RORTSK12",105,0)
 . S $P(STATS,U)=$P(STATS,U)+TMP
"RTN","RORTSK12",106,0)
 ;---
"RTN","RORTSK12",107,0)
 Q 0
"RTN","RORTSK13")
0^207^B33904309
"RTN","RORTSK13",1,0)
RORTSK13 ;HCIOFO/SG - PARSER FOR REPORT PARAMETERS ; 11/8/05 2:41pm
"RTN","RORTSK13",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORTSK13",3,0)
 ;
"RTN","RORTSK13",4,0)
 ; This routine uses the following IAs:
"RTN","RORTSK13",5,0)
 ;
"RTN","RORTSK13",6,0)
 ; #1995         $$CODEN^ICPTCOD (supported)
"RTN","RORTSK13",7,0)
 ; #3990         $$CODEN^ICDCODE (supported)
"RTN","RORTSK13",8,0)
 ; #4543         IEN^PSN50P65 (supported)
"RTN","RORTSK13",9,0)
 ;
"RTN","RORTSK13",10,0)
 ; RORXML -------------- DESCRIPTOR FOR THE XML PARSING
"RTN","RORTSK13",11,0)
 ;
"RTN","RORTSK13",12,0)
 ; RORXML(
"RTN","RORTSK13",13,0)
 ;
"RTN","RORTSK13",14,0)
 ;   "ERR")              Number of parsing errors
"RTN","RORTSK13",15,0)
 ;
"RTN","RORTSK13",16,0)
 ;   "PATH")             Path to the current XML tag
"RTN","RORTSK13",17,0)
 ;
"RTN","RORTSK13",18,0)
 ;   "RXGRP")            Name of the current drug group
"RTN","RORTSK13",19,0)
 ;
"RTN","RORTSK13",20,0)
 ;   "TI")               Number of the current text line of
"RTN","RORTSK13",21,0)
 ;                       the current tag value
"RTN","RORTSK13",22,0)
 ;
"RTN","RORTSK13",23,0)
 Q
"RTN","RORTSK13",24,0)
 ;
"RTN","RORTSK13",25,0)
 ;***** START DOCUMENT CALLBACK FOR THE SAX PARSER
"RTN","RORTSK13",26,0)
DOCSTART ;
"RTN","RORTSK13",27,0)
 S RORXML("PATH")="",RORXML("ERR")=0
"RTN","RORTSK13",28,0)
 K RORXML("RXGRP")
"RTN","RORTSK13",29,0)
 Q
"RTN","RORTSK13",30,0)
 ;
"RTN","RORTSK13",31,0)
 ;***** DUMMY CALLBACKS FOR THE SAX PARSER
"RTN","RORTSK13",32,0)
DUMMY(DUMMY1,DUMMY2,DUMMY3) ;
"RTN","RORTSK13",33,0)
DUMMY1 Q
"RTN","RORTSK13",34,0)
 ;
"RTN","RORTSK13",35,0)
 ;***** END ELEMENT CALLBACK FOR THE SAX PARSER
"RTN","RORTSK13",36,0)
 ;
"RTN","RORTSK13",37,0)
 ; ELMT          Name of the element
"RTN","RORTSK13",38,0)
 ;
"RTN","RORTSK13",39,0)
ELEND(ELMT) ;
"RTN","RORTSK13",40,0)
 ;--- Reset the drug group name in the end of the group
"RTN","RORTSK13",41,0)
 K:RORXML("PATH")="PARAMS,DRUGS,GROUP" RORXML("RXGRP")
"RTN","RORTSK13",42,0)
 ;--- Update the current element path
"RTN","RORTSK13",43,0)
 S RORXML("PATH")=$P(RORXML("PATH"),",",1,$L(RORXML("PATH"),",")-1)
"RTN","RORTSK13",44,0)
 Q
"RTN","RORTSK13",45,0)
 ;
"RTN","RORTSK13",46,0)
 ;***** START DOCUMENT CALLBACK FOR THE SAX PARSER
"RTN","RORTSK13",47,0)
 ;
"RTN","RORTSK13",48,0)
 ; ELMT          Name of the element
"RTN","RORTSK13",49,0)
 ; .ATTR         List of attributes and their values
"RTN","RORTSK13",50,0)
 ;
"RTN","RORTSK13",51,0)
ELSTART(ELMT,ATTR) ;
"RTN","RORTSK13",52,0)
 N ID,IEN,ITEM,LIST,LVL,RC,TMP
"RTN","RORTSK13",53,0)
 ;--- Update the current element path
"RTN","RORTSK13",54,0)
 S RORXML("PATH")=RORXML("PATH")_$S(RORXML("PATH")'="":",",1:"")_ELMT
"RTN","RORTSK13",55,0)
 S RORXML("TI")=1
"RTN","RORTSK13",56,0)
 ;--- Ignore everything except parameters
"RTN","RORTSK13",57,0)
 Q:$P(RORXML("PATH"),",")'="PARAMS"
"RTN","RORTSK13",58,0)
 S LVL=$L(RORXML("PATH"),",")
"RTN","RORTSK13",59,0)
 ;
"RTN","RORTSK13",60,0)
 ;=== Store the multi-level lists
"RTN","RORTSK13",61,0)
 I LVL=5  D  Q
"RTN","RORTSK13",62,0)
 . S LIST=$P(RORXML("PATH"),",",LVL-3,LVL-1)
"RTN","RORTSK13",63,0)
 . ;--- Medications and drug classes
"RTN","RORTSK13",64,0)
 . I $P(LIST,",",1,2)="DRUGS,GROUP"  D  Q
"RTN","RORTSK13",65,0)
 . . N GROUP,SECTION
"RTN","RORTSK13",66,0)
 . . S GROUP=$G(RORXML("RXGRP"))  Q:GROUP=""
"RTN","RORTSK13",67,0)
 . . S SECTION=$P(LIST,",",3)     Q:SECTION=""
"RTN","RORTSK13",68,0)
 . . S ID=$G(ATTR("ID"))          Q:ID=""
"RTN","RORTSK13",69,0)
 . . S RORTSK("PARAMS","DRUGS","G",GROUP,SECTION,ID)=$G(ATTR("CODE"))
"RTN","RORTSK13",70,0)
 ;
"RTN","RORTSK13",71,0)
 ;=== Store the lists
"RTN","RORTSK13",72,0)
 I LVL=3  D  Q
"RTN","RORTSK13",73,0)
 . S LIST=$P(RORXML("PATH"),",",LVL-1)
"RTN","RORTSK13",74,0)
 . ;--- List of ICD-9 codes
"RTN","RORTSK13",75,0)
 . I LIST="CPTLST"  D:ELMT="CPT"  Q
"RTN","RORTSK13",76,0)
 . . S ID=$G(ATTR("ID"))  Q:ID=""
"RTN","RORTSK13",77,0)
 . . S IEN=+$$CODEN^ICPTCOD(ID)
"RTN","RORTSK13",78,0)
 . . S:IEN>0 RORTSK("PARAMS",LIST,"C",IEN)=ID
"RTN","RORTSK13",79,0)
 . ;--- Name of the current drug group and its attributes
"RTN","RORTSK13",80,0)
 . I LIST="DRUGS"  D:ELMT="GROUP"  Q
"RTN","RORTSK13",81,0)
 . . S (RORXML("RXGRP"),ID)=$G(ATTR("ID"))  Q:ID=""
"RTN","RORTSK13",82,0)
 . . M RORTSK("PARAMS","DRUGS","G",ID,"A")=ATTR
"RTN","RORTSK13",83,0)
 . . K RORTSK("PARAMS","DRUGS","G",ID,"A","ID")
"RTN","RORTSK13",84,0)
 . ;--- List of ICD-9 codes
"RTN","RORTSK13",85,0)
 . I LIST="ICD9LST"  D:ELMT="ICD9"  Q
"RTN","RORTSK13",86,0)
 . . S ID=$G(ATTR("ID"))  Q:ID=""
"RTN","RORTSK13",87,0)
 . . S IEN=+$$CODEN^ICDCODE(ID)
"RTN","RORTSK13",88,0)
 . . S:IEN>0 RORTSK("PARAMS",LIST,"C",IEN)=ID
"RTN","RORTSK13",89,0)
 . ;--- Lab tests
"RTN","RORTSK13",90,0)
 . I LIST="LABTESTS"  D:ELMT="LT"  Q
"RTN","RORTSK13",91,0)
 . . S ID=$G(ATTR("ID"))  Q:ID=""
"RTN","RORTSK13",92,0)
 . . S RORTSK("PARAMS","LABTESTS","C",ID)=""
"RTN","RORTSK13",93,0)
 . . S TMP=$G(ATTR("LOW"))
"RTN","RORTSK13",94,0)
 . . S:TMP'="" RORTSK("PARAMS","LABTESTS","C",ID,"L")=TMP
"RTN","RORTSK13",95,0)
 . . S TMP=$G(ATTR("HIGH"))
"RTN","RORTSK13",96,0)
 . . S:TMP'="" RORTSK("PARAMS","LABTESTS","C",ID,"H")=TMP
"RTN","RORTSK13",97,0)
 . ;--- Laboratory test ranges
"RTN","RORTSK13",98,0)
 . I LIST="LRGRANGES"  D:ELMT="LRGRANGE"  Q
"RTN","RORTSK13",99,0)
 . . S ID=$G(ATTR("ID"))  Q:'$G(ATTR("USE"))!(ID="")
"RTN","RORTSK13",100,0)
 . . S RORTSK("PARAMS",LIST,"C",ID)=""
"RTN","RORTSK13",101,0)
 . . S TMP=$G(ATTR("LOW"))
"RTN","RORTSK13",102,0)
 . . S:TMP'="" RORTSK("PARAMS",LIST,"C",ID,"L")=TMP
"RTN","RORTSK13",103,0)
 . . S TMP=$G(ATTR("HIGH"))
"RTN","RORTSK13",104,0)
 . . S:TMP'="" RORTSK("PARAMS",LIST,"C",ID,"H")=TMP
"RTN","RORTSK13",105,0)
 . ;--- Default processing
"RTN","RORTSK13",106,0)
 . S TMP=","_LIST_","
"RTN","RORTSK13",107,0)
 . Q:'(",CLINICS,DIVISIONS,LOCAL_FIELDS,OPTIONAL_COLUMNS,OTHER_REGISTRIES,PATIENTS,SELRULES,UTIL_TYPES,"[TMP)
"RTN","RORTSK13",108,0)
 . S ID=$G(ATTR("ID"))
"RTN","RORTSK13",109,0)
 . S:ID'="" RORTSK("PARAMS",LIST,"C",ID)=""
"RTN","RORTSK13",110,0)
 ;
"RTN","RORTSK13",111,0)
 ;=== Store the top-level attributes
"RTN","RORTSK13",112,0)
 I LVL=2  D  Q
"RTN","RORTSK13",113,0)
 . ;--- Date range(s)
"RTN","RORTSK13",114,0)
 . I ELMT?1"DATE_RANGE".1(1"_"1.N)  D  Q
"RTN","RORTSK13",115,0)
 . . N STDT,ENDT
"RTN","RORTSK13",116,0)
 . . S RC=$$DTRANGE^RORTSK14(.ATTR,.STDT,.ENDT)  Q:RC<0
"RTN","RORTSK13",117,0)
 . . S RORTSK("PARAMS",ELMT,"A","START")=STDT
"RTN","RORTSK13",118,0)
 . . S RORTSK("PARAMS",ELMT,"A","END")=ENDT
"RTN","RORTSK13",119,0)
 . ;--- Ignore internal nodes
"RTN","RORTSK13",120,0)
 . Q:ELMT="PANELS"
"RTN","RORTSK13",121,0)
 . ;--- Default processing
"RTN","RORTSK13",122,0)
 . M RORTSK("PARAMS",ELMT,"A")=ATTR
"RTN","RORTSK13",123,0)
 ;
"RTN","RORTSK13",124,0)
 ;--- Ignore everything else
"RTN","RORTSK13",125,0)
 Q
"RTN","RORTSK13",126,0)
 ;
"RTN","RORTSK13",127,0)
 ;***** TEXT CALLBACK FOR THE SAX PARSER
"RTN","RORTSK13",128,0)
 ;
"RTN","RORTSK13",129,0)
 ; TXT           Line of unmarked text
"RTN","RORTSK13",130,0)
 ;
"RTN","RORTSK13",131,0)
ELTEXT(TXT) ;
"RTN","RORTSK13",132,0)
 N ITEM,LIST,LVL
"RTN","RORTSK13",133,0)
 S LVL=$L(RORXML("PATH"),",")
"RTN","RORTSK13",134,0)
 ;--- Store top-level values
"RTN","RORTSK13",135,0)
 I LVL=2  D  Q
"RTN","RORTSK13",136,0)
 . S ITEM=$P(RORXML("PATH"),",",LVL)
"RTN","RORTSK13",137,0)
 . S RORTSK("PARAMS",ITEM)=$G(RORTSK("PARAMS",ITEM))_TXT
"RTN","RORTSK13",138,0)
 ;--- Ignore everything else
"RTN","RORTSK13",139,0)
 Q
"RTN","RORTSK13",140,0)
 ;
"RTN","RORTSK13",141,0)
 ;***** ERROR CALLBACK FOR THE SAX PARSER
"RTN","RORTSK13",142,0)
 ;
"RTN","RORTSK13",143,0)
 ; .ERR          Reference to a local variable containing
"RTN","RORTSK13",144,0)
 ;               informations about the error
"RTN","RORTSK13",145,0)
 ;
"RTN","RORTSK13",146,0)
ERROR(ERR) ;
"RTN","RORTSK13",147,0)
 N ERRCODE,RORINFO,TMP
"RTN","RORTSK13",148,0)
 I ERR("SEV")  D
"RTN","RORTSK13",149,0)
 . S ERRCODE=-105,RORXML("ERR")=$G(RORXML("ERR"))+1
"RTN","RORTSK13",150,0)
 E  S ERRCODE=-104
"RTN","RORTSK13",151,0)
 ;--- Prepare message details
"RTN","RORTSK13",152,0)
 S RORINFO(1)=$TR(ERR("MSG"),U,"~")
"RTN","RORTSK13",153,0)
 S TMP=$P("Warning^Validation Error^Conformance Error",U,ERR("SEV")+1)
"RTN","RORTSK13",154,0)
 S RORINFO(2)=TMP_" in line #"_ERR("LIN")_" (pos#"_ERR("POS")_")"
"RTN","RORTSK13",155,0)
 S RORINFO(3)=$TR(ERR("XML"),$C(9,10,13)," ")
"RTN","RORTSK13",156,0)
 ;--- Record the error message
"RTN","RORTSK13",157,0)
 D ERROR^RORERR(ERRCODE,,.RORINFO)
"RTN","RORTSK13",158,0)
 Q
"RTN","RORTSK13",159,0)
 ;
"RTN","RORTSK13",160,0)
 ;***** PARSES AND PREPARES THE REPORT PARAMETERS
"RTN","RORTSK13",161,0)
 ;
"RTN","RORTSK13",162,0)
 ; .PARAMS       Reference to a local variable that contains report
"RTN","RORTSK13",163,0)
 ;               parameters in XML format. This variable is KILL'ed
"RTN","RORTSK13",164,0)
 ;               by this function.
"RTN","RORTSK13",165,0)
 ;
"RTN","RORTSK13",166,0)
 ; .RORTSK       Reference to a local variable that contains a task
"RTN","RORTSK13",167,0)
 ;               descriptor.
"RTN","RORTSK13",168,0)
 ;
"RTN","RORTSK13",169,0)
 ; Return Values:
"RTN","RORTSK13",170,0)
 ;       <0  Error code
"RTN","RORTSK13",171,0)
 ;        0  Ok
"RTN","RORTSK13",172,0)
 ;
"RTN","RORTSK13",173,0)
PARSEPRM(PARAMS,RORTSK) ;
"RTN","RORTSK13",174,0)
 K RORTSK("PARAMS")
"RTN","RORTSK13",175,0)
 Q:$D(PARAMS)<10 0
"RTN","RORTSK13",176,0)
 ;---
"RTN","RORTSK13",177,0)
 N CBK,RORSRC,RORSUBS,RORTMP,RORXML
"RTN","RORTSK13",178,0)
 S RORSRC=$$ALLOC^RORTMP()          ; Source buffer for XML
"RTN","RORTSK13",179,0)
 S RORTMP=$$ALLOC^RORTMP(.RORSUBS)  ; Temporary buffer
"RTN","RORTSK13",180,0)
 ;--- Copy the XML document into a global since the parser
"RTN","RORTSK13",181,0)
 ;--- cannot read it from a local variable
"RTN","RORTSK13",182,0)
 M @RORSRC=PARAMS  K PARAMS
"RTN","RORTSK13",183,0)
 ;--- Parse the parameters
"RTN","RORTSK13",184,0)
 S CBK("CHARACTERS")="ELTEXT^RORTSK13"
"RTN","RORTSK13",185,0)
 S CBK("COMMENT")="DUMMY^RORTSK13"
"RTN","RORTSK13",186,0)
 S CBK("DOCTYPE")="DUMMY^RORTSK13"
"RTN","RORTSK13",187,0)
 S CBK("ENDDOCUMENT")="DUMMY1^RORTSK13"
"RTN","RORTSK13",188,0)
 S CBK("ENDELEMENT")="ELEND^RORTSK13"
"RTN","RORTSK13",189,0)
 S CBK("ERROR")="ERROR^RORTSK13"
"RTN","RORTSK13",190,0)
 S CBK("EXTERNAL")="DUMMY^RORTSK13"
"RTN","RORTSK13",191,0)
 S CBK("NOTATION")="DUMMY^RORTSK13"
"RTN","RORTSK13",192,0)
 S CBK("PI")="DUMMY^RORTSK13"
"RTN","RORTSK13",193,0)
 S CBK("STARTDOCUMENT")="DOCSTART^RORTSK13"
"RTN","RORTSK13",194,0)
 S CBK("STARTELEMENT")="ELSTART^RORTSK13"
"RTN","RORTSK13",195,0)
 D EN^MXMLPRSE(RORSRC,.CBK,"W")
"RTN","RORTSK13",196,0)
 ;--- Cleanup
"RTN","RORTSK13",197,0)
 D FREE^RORTMP(RORTMP),FREE^RORTMP(RORSRC)
"RTN","RORTSK13",198,0)
 Q $S($G(RORXML("ERR"))>0:$$ERROR^RORERR(-106),1:0)
"RTN","RORTSK14")
0^208^B6333918
"RTN","RORTSK14",1,0)
RORTSK14 ;HCIOFO/SG - PARSER FOR REPORT PARAMETERS (TOOLS) ; 8/30/05 12:48pm
"RTN","RORTSK14",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORTSK14",3,0)
 ;
"RTN","RORTSK14",4,0)
 Q
"RTN","RORTSK14",5,0)
 ;
"RTN","RORTSK14",6,0)
 ;***** CALCULATES START AND END DATES FROM DATE RANGE ATTRIBUTES
"RTN","RORTSK14",7,0)
 ;
"RTN","RORTSK14",8,0)
 ; .ATTR         Reference to a local variable that contains
"RTN","RORTSK14",9,0)
 ;               attributes of the <DATE_RANGE> element.
"RTN","RORTSK14",10,0)
 ;
"RTN","RORTSK14",11,0)
 ; .STDT         Reference to a local variable where
"RTN","RORTSK14",12,0)
 ;               the start date is returned to
"RTN","RORTSK14",13,0)
 ;
"RTN","RORTSK14",14,0)
 ; .ENDT         Reference to a local variable where
"RTN","RORTSK14",15,0)
 ;               the end date is returned to
"RTN","RORTSK14",16,0)
 ;
"RTN","RORTSK14",17,0)
 ; Return Values:
"RTN","RORTSK14",18,0)
 ;       <0  Error code
"RTN","RORTSK14",19,0)
 ;        0  Ok
"RTN","RORTSK14",20,0)
 ;
"RTN","RORTSK14",21,0)
 ; NOTE: In case of an error the function does not change
"RTN","RORTSK14",22,0)
 ;       values of the STDT and ENDT parameters.
"RTN","RORTSK14",23,0)
 ;
"RTN","RORTSK14",24,0)
DTRANGE(ATTR,STDT,ENDT) ;
"RTN","RORTSK14",25,0)
 N ENDT1,FISCAL,QUARTER,RC,RORMSG,STDT1,TMP,TYPE,YEAR
"RTN","RORTSK14",26,0)
 S (STDT1,ENDT1)="",TYPE=$G(ATTR("TYPE"))
"RTN","RORTSK14",27,0)
 S RC=0  D  Q:RC<0 $$DBS^RORERR("RORMSG",-9)
"RTN","RORTSK14",28,0)
 . ;
"RTN","RORTSK14",29,0)
 . ;--- CUSTOM: StartDate, EndDate
"RTN","RORTSK14",30,0)
 . I TYPE="CUSTOM"  D  Q
"RTN","RORTSK14",31,0)
 . . S STDT1=$G(ATTR("START")),ENDT1=$G(ATTR("END"))
"RTN","RORTSK14",32,0)
 . ;
"RTN","RORTSK14",33,0)
 . ;--- CUTOFF: Cutoff
"RTN","RORTSK14",34,0)
 . I TYPE="CUTOFF"  D  Q
"RTN","RORTSK14",35,0)
 . . S ENDT1=$$DT^XLFDT,TMP=$G(ATTR("CUTOFF"))
"RTN","RORTSK14",36,0)
 . . S:$E(TMP,1)="-" TMP=$E(TMP,2,999)
"RTN","RORTSK14",37,0)
 . . D DT^DILF("P","TODAY-"_TMP,.STDT1,-ENDT1,"RORMSG")
"RTN","RORTSK14",38,0)
 . . S:STDT1<0 RC=STDT1
"RTN","RORTSK14",39,0)
 . ;
"RTN","RORTSK14",40,0)
 . ;--- QUARTER: Quarter, Year, Fiscal
"RTN","RORTSK14",41,0)
 . I TYPE="QUARTER"  D  Q
"RTN","RORTSK14",42,0)
 . . S QUARTER=+$G(ATTR("QUARTER")),YEAR=+$G(ATTR("YEAR"))
"RTN","RORTSK14",43,0)
 . . S FISCAL=+$G(ATTR("FISCAL"))  S:FISCAL QUARTER=QUARTER-1
"RTN","RORTSK14",44,0)
 . . S TMP=$P("10/01^01/01^04/01^07/01^10/01","^",QUARTER+1)
"RTN","RORTSK14",45,0)
 . . S TMP=TMP_"/"_$S(QUARTER:YEAR,1:YEAR-1)
"RTN","RORTSK14",46,0)
 . . D DT^DILF("P",TMP,.STDT1,,"RORMSG")
"RTN","RORTSK14",47,0)
 . . I STDT1<0  S RC=STDT1  Q
"RTN","RORTSK14",48,0)
 . . S TMP=$P("12/31^03/31^06/30^09/30^12/31","^",QUARTER+1)
"RTN","RORTSK14",49,0)
 . . S TMP=TMP_"/"_$S(QUARTER:YEAR,1:YEAR-1)
"RTN","RORTSK14",50,0)
 . . D DT^DILF("P",TMP,.ENDT1,STDT1,"RORMSG")
"RTN","RORTSK14",51,0)
 . . I ENDT1<0  S RC=ENDT1  Q
"RTN","RORTSK14",52,0)
 . ;
"RTN","RORTSK14",53,0)
 . ;--- YEAR: Year, Fiscal
"RTN","RORTSK14",54,0)
 . I TYPE="YEAR"  D  Q
"RTN","RORTSK14",55,0)
 . . S YEAR=+$G(ATTR("YEAR")),FISCAL=+$G(ATTR("FISCAL"))
"RTN","RORTSK14",56,0)
 . . S TMP=$S(FISCAL:"10/01/"_(YEAR-1),1:"01/01/"_YEAR)
"RTN","RORTSK14",57,0)
 . . D DT^DILF("P",TMP,.STDT1,,"RORMSG")
"RTN","RORTSK14",58,0)
 . . I STDT1<0  S RC=STDT1  Q
"RTN","RORTSK14",59,0)
 . . S TMP=$S(FISCAL:"09/30/"_YEAR,1:"12/31/"_YEAR)
"RTN","RORTSK14",60,0)
 . . D DT^DILF("P",TMP,.ENDT1,STDT1,"RORMSG")
"RTN","RORTSK14",61,0)
 . . I ENDT1<0  S RC=ENDT1  Q
"RTN","RORTSK14",62,0)
 ;
"RTN","RORTSK14",63,0)
 ;--- Invalid time frame
"RTN","RORTSK14",64,0)
 I (STDT1'>0)!(ENDT1'>0)!(STDT1>ENDT1)  D  Q RC
"RTN","RORTSK14",65,0)
 . S RC=$$ERROR^RORERR(-88,,,,"DATE_RANGE",STDT1_"-"_ENDT1)
"RTN","RORTSK14",66,0)
 ;
"RTN","RORTSK14",67,0)
 ;--- Success
"RTN","RORTSK14",68,0)
 S STDT=STDT1,ENDT=ENDT1
"RTN","RORTSK14",69,0)
 Q 0
"RTN","RORTXT")
0^128^B339606
"RTN","RORTXT",1,0)
RORTXT ;HCIOFO/SG - TEXT RESOURCE UTILITIES ; 12/13/02 11:15am
"RTN","RORTXT",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORTXT",3,0)
 ;
"RTN","RORTXT",4,0)
 ;***** RETURNS THE TEXT RESOURCE
"RTN","RORTXT",5,0)
 ;
"RTN","RORTXT",6,0)
 ; DIALOG        Dialog number (in the DIALOG file)
"RTN","RORTXT",7,0)
 ;
"RTN","RORTXT",8,0)
 ; .RORDST       Reference to a local variable where the text
"RTN","RORTXT",9,0)
 ;               will be stored.
"RTN","RORTXT",10,0)
 ;
"RTN","RORTXT",11,0)
 ; [FLAGS]       Flags that define the mode of execution
"RTN","RORTXT",12,0)
 ;
"RTN","RORTXT",13,0)
 ;                 A  Append the text to the content of RORDST.
"RTN","RORTXT",14,0)
 ;
"RTN","RORTXT",15,0)
 ;                 S  Suppress the blank line that is normally
"RTN","RORTXT",16,0)
 ;                    inserted between discrete blocks of text
"RTN","RORTXT",17,0)
 ;                    (in Append mode).
"RTN","RORTXT",18,0)
 ;
"RTN","RORTXT",19,0)
 ;                 F  Format the local array similar to the default
"RTN","RORTXT",20,0)
 ;                    output format of the ^TMP global (see the
"RTN","RORTXT",21,0)
 ;                    BLD^DIALOG documentation for more detailes).
"RTN","RORTXT",22,0)
 ;
"RTN","RORTXT",23,0)
TEXT(DIALOG,RORDST,FLAGS) ;
"RTN","RORTXT",24,0)
 N DIERR,DIHELP,DIMSG
"RTN","RORTXT",25,0)
 K:'($G(FLAGS)["A") RORDST
"RTN","RORTXT",26,0)
 D BLD^DIALOG(DIALOG,,,"RORDST",$TR($G(FLAGS),"A"))
"RTN","RORTXT",27,0)
 Q
"RTN","RORUPD")
0^129^B25273345
"RTN","RORUPD",1,0)
RORUPD ;HCIOFO/SG - REGISTRY UPDATE ; 7/21/05 10:28am
"RTN","RORUPD",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPD",3,0)
 ;
"RTN","RORUPD",4,0)
 ; RORLRC -------------- LIST OF LAB RESULT CODES TO CHECK
"RTN","RORUPD",5,0)
 ;
"RTN","RORUPD",6,0)
 ; RORLRC(Seq#)          Lab result code (see the LA7SC parameter of
"RTN","RORUPD",7,0)
 ;                       the GCPR^LA7QRY entry point)
"RTN","RORUPD",8,0)
 ;                         ^1: Result code
"RTN","RORUPD",9,0)
 ;                         ^2: Coding system ("LN" or "NLT")
"RTN","RORUPD",10,0)
 ;
"RTN","RORUPD",11,0)
 ; RORUPD -------------- REGISTRY UPDATE DESCRIPTOR
"RTN","RORUPD",12,0)
 ;
"RTN","RORUPD",13,0)
 ; RORUPD("DT")          Date/time when update process started
"RTN","RORUPD",14,0)
 ;
"RTN","RORUPD",15,0)
 ; RORUPD("DSBEG")       Start date of the data scan
"RTN","RORUPD",16,0)
 ; RORUPD("DSEND")       End date of the data scan
"RTN","RORUPD",17,0)
 ;                       (these nodes are set by $$PREPARE1^RORUPR)
"RTN","RORUPD",18,0)
 ;
"RTN","RORUPD",19,0)
 ; RORUPD("EETS")        Timestamp of the earliest event reference
"RTN","RORUPD",20,0)
 ;
"RTN","RORUPD",21,0)
 ; RORUPD("ERRCNT")      Counter of errors during processing of the
"RTN","RORUPD",22,0)
 ;                       current patient
"RTN","RORUPD",23,0)
 ;
"RTN","RORUPD",24,0)
 ; RORUPD("FLAGS")       Flags to control processing (see the
"RTN","RORUPD",25,0)
 ;                       TASK^ROR for possible values).
"RTN","RORUPD",26,0)
 ;
"RTN","RORUPD",27,0)
 ; RORUPD("JOB")         Job number of the main task. This node is
"RTN","RORUPD",28,0)
 ;                       defined only if the registry update is
"RTN","RORUPD",29,0)
 ;                       running in the multitask mode.
"RTN","RORUPD",30,0)
 ;
"RTN","RORUPD",31,0)
 ; RORUPD("LD",          Instead of checking data in the interval
"RTN","RORUPD",32,0)
 ;                       from start date till end date, update process
"RTN","RORUPD",33,0)
 ;                       starts checks from the start date minus
"RTN","RORUPD",34,0)
 ;                       appropriate number of lag days. Thus, data
"RTN","RORUPD",35,0)
 ;                       entered retrospectively will not be missed.
"RTN","RORUPD",36,0)
 ;   1)                  Lag days for data examination
"RTN","RORUPD",37,0)
 ;
"RTN","RORUPD",38,0)
 ; RORUPD("LM",          Loop control mode. It defines when to stop
"RTN","RORUPD",39,0)
 ;                       looping through records of the patient:
"RTN","RORUPD",40,0)
 ;                         0  always loop through all records
"RTN","RORUPD",41,0)
 ;                         1  all top level rules have been triggered
"RTN","RORUPD",42,0)
 ;                            for the patient (default)
"RTN","RORUPD",43,0)
 ;                         2  patient has been marked for addition to
"RTN","RORUPD",44,0)
 ;                            all registries being processed
"RTN","RORUPD",45,0)
 ;   1,Rule Name)        Current list of names of top level rules
"RTN","RORUPD",46,0)
 ;   2,Registry#)        Current list of registry IENs
"RTN","RORUPD",47,0)
 ;
"RTN","RORUPD",48,0)
 ; RORUPD("LM1",         STATIC LIST OF TOP LEVEL RULES
"RTN","RORUPD",49,0)
 ;   Rule Name)
"RTN","RORUPD",50,0)
 ;
"RTN","RORUPD",51,0)
 ; RORUPD("LM2",         STATIC LIST OF REGISTRIES
"RTN","RORUPD",52,0)
 ;   Registry#)            ^1: 1 - if the current patient can be added
"RTN","RORUPD",53,0)
 ;                             to the registry; 0 - if the patient is
"RTN","RORUPD",54,0)
 ;                             already in the registry or he/she is
"RTN","RORUPD",55,0)
 ;                             an employee and should be skipped.
"RTN","RORUPD",56,0)
 ;                         ^2: 1 if the employees must not be added
"RTN","RORUPD",57,0)
 ;                             to the registry.
"RTN","RORUPD",58,0)
 ;
"RTN","RORUPD",59,0)
 ; RORUPD("MAXPPCNT")    When counters in the ROR PATIENT EVENTS
"RTN","RORUPD",60,0)
 ;                       file reach a value stored in this node, the
"RTN","RORUPD",61,0)
 ;                       corresponding patient will be skipped until
"RTN","RORUPD",62,0)
 ;                       someone fixes the error(s) and resets the
"RTN","RORUPD",63,0)
 ;                       counters to 1.
"RTN","RORUPD",64,0)
 ;
"RTN","RORUPD",65,0)
 ; RORUPD("ROOT",File#)  Closed root of the file
"RTN","RORUPD",66,0)
 ;
"RTN","RORUPD",67,0)
 ; RORUPD("SR",          PREPARED SELECTION RULES
"RTN","RORUPD",68,0)
 ;   File#,              This node is defined if the file should be
"RTN","RORUPD",69,0)
 ;                       processed
"RTN","RORUPD",70,0)
 ;
"RTN","RORUPD",71,0)
 ;     "A",              List of rules that should be applied after
"RTN","RORUPD",72,0)
 ;                       processing sub-files and linked files.
"RTN","RORUPD",73,0)
 ;     "B",              List of rules that should be applied before
"RTN","RORUPD",74,0)
 ;                       processing sub-files and linked files.
"RTN","RORUPD",75,0)
 ;       Seq#,             ^1: Selection Rule Name
"RTN","RORUPD",76,0)
 ;                         ^2: Rule# (Selection Rule IEN)
"RTN","RORUPD",77,0)
 ;                         ^3: 1 if registry should be updated if
"RTN","RORUPD",78,0)
 ;                             the expression evaluated as True
"RTN","RORUPD",79,0)
 ;                             (top-level seelction rule)
"RTN","RORUPD",80,0)
 ;         1)            MUMPS expression that implements the rule
"RTN","RORUPD",81,0)
 ;         2,Registry#)  List of IENs of affected registries
"RTN","RORUPD",82,0)
 ;
"RTN","RORUPD",83,0)
 ;     "F",              A list of data elements that should be loaded
"RTN","RORUPD",84,0)
 ;                       before applying selection rules is created
"RTN","RORUPD",85,0)
 ;                       under this node. The elements are grouped by
"RTN","RORUPD",86,0)
 ;                       the APIs used to load the values.
"RTN","RORUPD",87,0)
 ;       API#,           For API #1 (FileMan GETS^DIQ) this node
"RTN","RORUPD",88,0)
 ;                       contains a list of fields separated by ';'.
"RTN","RORUPD",89,0)
 ;         DataCode,     For data elements associated with the API #1
"RTN","RORUPD",90,0)
 ;                       this node stores the field number.
"RTN","RORUPD",91,0)
 ;           "E")        If an external value of the field should be
"RTN","RORUPD",92,0)
 ;                       loaded, a value of the field 4.1 of the
"RTN","RORUPD",93,0)
 ;                       subfile #799.22 is assigned to this node.
"RTN","RORUPD",94,0)
 ;           "I")        If an internal value of the field should be
"RTN","RORUPD",95,0)
 ;                       loaded, a value of the field 4.2 of the
"RTN","RORUPD",96,0)
 ;                       subfile #799.22 is assigned to this node.
"RTN","RORUPD",97,0)
 ;
"RTN","RORUPD",98,0)
 ; RORUPD("SUSPEND")     SUBTASKS SUSPENSION PARAMETERS
"RTN","RORUPD",99,0)
 ;                         ^1: Suspension start time (FileMan)
"RTN","RORUPD",100,0)
 ;                         ^2: Suspension end time (FileMan)
"RTN","RORUPD",101,0)
 ;
"RTN","RORUPD",102,0)
 ;                       For example, to suspend subtasks from
"RTN","RORUPD",103,0)
 ;                       7:00 until 18:00 this node should have
"RTN","RORUPD",104,0)
 ;                       the following value: ".07^.18".
"RTN","RORUPD",105,0)
 ;
"RTN","RORUPD",106,0)
 ; RORUPD("UPD",         CALL-BACK ENTRY POINTS
"RTN","RORUPD",107,0)
 ;   Registry#,1)        Entry point of a MUMPS external function
"RTN","RORUPD",108,0)
 ;                       that assign values of additional fields to
"RTN","RORUPD",109,0)
 ;                       the registry FDA before registry update
"RTN","RORUPD",110,0)
 ;                       (opt'l).
"RTN","RORUPD",111,0)
 ;   Registry#,2)        Entry point of a MUMPS external function
"RTN","RORUPD",112,0)
 ;                       that is called right after registry update
"RTN","RORUPD",113,0)
 ;                       (opt'l).
"RTN","RORUPD",114,0)
 ;
"RTN","RORUPD",115,0)
 ; RORUPDPI ------------ CLOSED ROOT OF THE TEMPORARY STORAGE
"RTN","RORUPD",116,0)
 ;                       (the ^TMP("RORUPD",$J), ^XTMP("RORUPDJ"_$J)
"RTN","RORUPD",117,0)
 ;                       or ^XTMP("RORUPDR"_Registry#) node)
"RTN","RORUPD",118,0)
 ;
"RTN","RORUPD",119,0)
 ; See also a description of ^XTMP("RORUPD"_) in the ^ROR01 routine.
"RTN","RORUPD",120,0)
 ;
"RTN","RORUPD",121,0)
 Q
"RTN","RORUPD",122,0)
 ;
"RTN","RORUPD",123,0)
 ;***** UPDATES THE REGISTRIES
"RTN","RORUPD",124,0)
 ;
"RTN","RORUPD",125,0)
 ; .REGLST       Reference to a local array containing registry
"RTN","RORUPD",126,0)
 ;               names as subscripts and registry IENs as values
"RTN","RORUPD",127,0)
 ;
"RTN","RORUPD",128,0)
 ; [MAXNTSK]     Maximum number of the data processing subtasks.
"RTN","RORUPD",129,0)
 ;               See description of the $$PROCESS^RORUPD05 function
"RTN","RORUPD",130,0)
 ;               for details.
"RTN","RORUPD",131,0)
 ;
"RTN","RORUPD",132,0)
 ; [SUSPEND]     Subtask suspension parameters:
"RTN","RORUPD",133,0)
 ;               See description of the RORUPD("SUSPEND") node
"RTN","RORUPD",134,0)
 ;               for details.
"RTN","RORUPD",135,0)
 ;
"RTN","RORUPD",136,0)
 ; [FLAGS]       Flags to control processing.
"RTN","RORUPD",137,0)
 ;               See description of the TASK^ROR for
"RTN","RORUPD",138,0)
 ;               possible values of the flags).
"RTN","RORUPD",139,0)
 ;
"RTN","RORUPD",140,0)
 ; Return Values:
"RTN","RORUPD",141,0)
 ;       <0  Error code (see MSGLIST^RORERR20)
"RTN","RORUPD",142,0)
 ;        0  Ok
"RTN","RORUPD",143,0)
 ;
"RTN","RORUPD",144,0)
UPDATE(REGLST,MAXNTSK,SUSPEND,FLAGS) ;
"RTN","RORUPD",145,0)
 N RORERRDL      ; Default error location
"RTN","RORUPD",146,0)
 N RORLOG        ; Log subsystem constants & variables
"RTN","RORUPD",147,0)
 N RORLRC        ; List of Lab result codes to check
"RTN","RORUPD",148,0)
 N RORUPD        ; Update descriptor
"RTN","RORUPD",149,0)
 N RORUPDPI      ; Closed root of the temporary storage
"RTN","RORUPD",150,0)
 N RORVALS       ; Calculated values
"RTN","RORUPD",151,0)
 ;
"RTN","RORUPD",152,0)
 N COUNTERS,RC,TMP
"RTN","RORUPD",153,0)
 D INIT^RORUTL01("RORUPD")
"RTN","RORUPD",154,0)
 S RORUPD("FLAGS")=$$UP^XLFSTR($G(FLAGS))
"RTN","RORUPD",155,0)
 D CLEAR^RORERR("UPDATE^RORUPD")
"RTN","RORUPD",156,0)
 ;--- Value of the RORUPDPI variable is modified by the
"RTN","RORUPD",157,0)
 ;    $$PROCESS^RORUPD05 function if the registry update
"RTN","RORUPD",158,0)
 ;--- process runs in the multi-task mode.
"RTN","RORUPD",159,0)
 S RORUPDPI=$NA(^TMP("RORUPD",$J))
"RTN","RORUPD",160,0)
 ;--- Open a new log
"RTN","RORUPD",161,0)
 S TMP=$$SETUP^RORLOG(.REGLST)
"RTN","RORUPD",162,0)
 S TMP=$$OPEN^RORLOG(.REGLST,1,"REGISTRY UPDATE STARTED")
"RTN","RORUPD",163,0)
 D
"RTN","RORUPD",164,0)
 . ;--- Check a list of registries
"RTN","RORUPD",165,0)
 . I $D(REGLST)<10  D  Q
"RTN","RORUPD",166,0)
 . . S RC=$$ERROR^RORERR(-28,,,,"update")
"RTN","RORUPD",167,0)
 . ;--- Lock parameters of the registries being processed
"RTN","RORUPD",168,0)
 . S RC=$$LOCKREG^RORUTL02(.REGLST,1,,"REGISTRY UPDATE")  Q:RC<0
"RTN","RORUPD",169,0)
 . I 'RC  D  K REGLST  Q
"RTN","RORUPD",170,0)
 . . S RC=$$ERROR^RORERR(-11,,,,"registries being processed")
"RTN","RORUPD",171,0)
 . ;--- Prepare selection rules
"RTN","RORUPD",172,0)
 . S:$G(SUSPEND)>0 RORUPD("SUSPEND")=SUSPEND
"RTN","RORUPD",173,0)
 . S RC=$$PREPARE^RORUPR(.REGLST)
"RTN","RORUPD",174,0)
 . I RC<0  S RC=$$ERROR^RORERR(-14)  Q
"RTN","RORUPD",175,0)
 . ;--- Display the debug information
"RTN","RORUPD",176,0)
 . D:$G(RORPARM("DEBUG"))>1 DEBUG^RORUPDUT
"RTN","RORUPD",177,0)
 . ;--- Look for new patients and update the registries
"RTN","RORUPD",178,0)
 . S RC=$$PROCESS^RORUPD05($G(MAXNTSK))  Q:RC<0
"RTN","RORUPD",179,0)
 . S COUNTERS=RC
"RTN","RORUPD",180,0)
 . ;--- Update registry parameters
"RTN","RORUPD",181,0)
 . S TMP=$$TMSTMP^RORUPD01(.REGLST)
"RTN","RORUPD",182,0)
 . ;--- Update demographic data
"RTN","RORUPD",183,0)
 . D LOG^RORLOG(,"Demographic Update")
"RTN","RORUPD",184,0)
 . S RC=$$UPDDEM^RORUPD51(.REGLST)
"RTN","RORUPD",185,0)
 ;
"RTN","RORUPD",186,0)
 ;--- Unlock parameters of processed registries
"RTN","RORUPD",187,0)
 S TMP=$$LOCKREG^RORUTL02(.REGLST,0)
"RTN","RORUPD",188,0)
 ;--- Statistics & Cleanup
"RTN","RORUPD",189,0)
 S TMP="REGISTRY UPDATE "_$S(RC<0:"ABORTED",1:"COMPLETED")
"RTN","RORUPD",190,0)
 D CLOSE^RORLOG(TMP,$G(COUNTERS))
"RTN","RORUPD",191,0)
 D:'$G(RORPARM("DEBUG"))
"RTN","RORUPD",192,0)
 . D INIT^RORUTL01("RORUPD")
"RTN","RORUPD",193,0)
 . ;--- Do not kill the list of processed patients ("U" subnode)
"RTN","RORUPD",194,0)
 . ;    in case of an error or crash during the initial registry
"RTN","RORUPD",195,0)
 . ;--- population (registry setup).
"RTN","RORUPD",196,0)
 . K:'$G(RORPARM("SETUP"))!(RC'<0) @RORUPDPI
"RTN","RORUPD",197,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUPD01")
0^130^B64834418
"RTN","RORUPD01",1,0)
RORUPD01 ;HCIOFO/SG - PROCESSING OF THE FILES  ; 7/21/03 10:19am
"RTN","RORUPD01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPD01",3,0)
 ;
"RTN","RORUPD01",4,0)
 ; This routine uses the following IA's:
"RTN","RORUPD01",5,0)
 ;
"RTN","RORUPD01",6,0)
 ; #3646         $$EMPL^DGSEC4
"RTN","RORUPD01",7,0)
 ; #10035        Browse through IENs of the file #2
"RTN","RORUPD01",8,0)
 ;
"RTN","RORUPD01",9,0)
 Q
"RTN","RORUPD01",10,0)
 ;
"RTN","RORUPD01",11,0)
 ;***** CHECKS FOR A STOP REQUESTS (TASKMAN & PROPRIETARY)
"RTN","RORUPD01",12,0)
 ;
"RTN","RORUPD01",13,0)
 ; Return Values:
"RTN","RORUPD01",14,0)
 ;        0  Continue running
"RTN","RORUPD01",15,0)
 ;        1  Stop the subtask
"RTN","RORUPD01",16,0)
 ;
"RTN","RORUPD01",17,0)
CHKSTOP() ;
"RTN","RORUPD01",18,0)
 Q:'$G(RORUPD("JOB")) $$S^%ZTLOAD
"RTN","RORUPD01",19,0)
 L +@RORUPDPI@("T",0):0
"RTN","RORUPD01",20,0)
 I  L -@RORUPDPI@("T",0)  Q 1
"RTN","RORUPD01",21,0)
 Q $$S^%ZTLOAD
"RTN","RORUPD01",22,0)
 ;
"RTN","RORUPD01",23,0)
 ;***** LOAD DATA ELEMENTS
"RTN","RORUPD01",24,0)
 ;
"RTN","RORUPD01",25,0)
 ; IENS          IENS of the current record
"RTN","RORUPD01",26,0)
 ;
"RTN","RORUPD01",27,0)
 ; Return values:
"RTN","RORUPD01",28,0)
 ;       <0  Error code
"RTN","RORUPD01",29,0)
 ;        0  Ok
"RTN","RORUPD01",30,0)
 ;
"RTN","RORUPD01",31,0)
LOAD(IENS) ;
"RTN","RORUPD01",32,0)
 N RC  S RC=0
"RTN","RORUPD01",33,0)
 ;--- API #1
"RTN","RORUPD01",34,0)
 I $D(RORUPD("SR",2,"F",1))  D  Q:RC<0 RC
"RTN","RORUPD01",35,0)
 . S RC=$$LOADFLDS^RORUPDUT(2,IENS)
"RTN","RORUPD01",36,0)
 ;--- API #2
"RTN","RORUPD01",37,0)
 Q 0
"RTN","RORUPD01",38,0)
 ;
"RTN","RORUPD01",39,0)
 ;***** INITIALIZES LOOP CONTROL LISTS
"RTN","RORUPD01",40,0)
 ;
"RTN","RORUPD01",41,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD01",42,0)
 ;
"RTN","RORUPD01",43,0)
 ; Return Values:
"RTN","RORUPD01",44,0)
 ;       <0  Error code
"RTN","RORUPD01",45,0)
 ;        0  Ok
"RTN","RORUPD01",46,0)
 ;
"RTN","RORUPD01",47,0)
 ; The RORUPD("LM",1,Rule Name) list contains names of the top level
"RTN","RORUPD01",48,0)
 ; rules that have not been triggered by now.
"RTN","RORUPD01",49,0)
 ;
"RTN","RORUPD01",50,0)
 ; The RORUPD("LM",2,Registry#) list contains IENs of the registries
"RTN","RORUPD01",51,0)
 ; that do not contain the patient by now.
"RTN","RORUPD01",52,0)
 ;
"RTN","RORUPD01",53,0)
 ; If the patient is an employee and the registry must not include
"RTN","RORUPD01",54,0)
 ; employees (see the EXCLUDE EMPLOYEES field of the ROR REGISTRY
"RTN","RORUPD01",55,0)
 ; PARAMETERS file), the function initializes the corresponding items
"RTN","RORUPD01",56,0)
 ; of control lists as if the patient were already in the registry.
"RTN","RORUPD01",57,0)
 ; Therefore, the patient will not be added to this registry.
"RTN","RORUPD01",58,0)
 ;
"RTN","RORUPD01",59,0)
LOOPINIT(PATIEN) ;
"RTN","RORUPD01",60,0)
 N I,EMPL,REGIEN
"RTN","RORUPD01",61,0)
 K RORUPD("LM",1),RORUPD("LM",2)
"RTN","RORUPD01",62,0)
 S EMPL=$$EMPL^DGSEC4(PATIEN,"P")
"RTN","RORUPD01",63,0)
 M RORUPD("LM",1)=RORUPD("LM1")
"RTN","RORUPD01",64,0)
 S REGIEN=""
"RTN","RORUPD01",65,0)
 F  S REGIEN=$O(RORUPD("LM2",REGIEN))  Q:REGIEN=""  D
"RTN","RORUPD01",66,0)
 . S $P(RORUPD("LM2",REGIEN),U)=0
"RTN","RORUPD01",67,0)
 . ;--- Check if the patient is already in the registry
"RTN","RORUPD01",68,0)
 . Q:$D(^RORDATA(798,"KEY",PATIEN,REGIEN))
"RTN","RORUPD01",69,0)
 . ;--- Check if the patient is an employee and the
"RTN","RORUPD01",70,0)
 . ;--- employees must not be added to the registry
"RTN","RORUPD01",71,0)
 . I EMPL  Q:$P(RORUPD("LM2",REGIEN),U,2)
"RTN","RORUPD01",72,0)
 . ;--- Initialize the items of control lists
"RTN","RORUPD01",73,0)
 . S $P(RORUPD("LM2",REGIEN),U)=1,RORUPD("LM",2,REGIEN)=""
"RTN","RORUPD01",74,0)
 Q 0
"RTN","RORUPD01",75,0)
 ;
"RTN","RORUPD01",76,0)
 ;***** PROCESS EVERY PATIENT IN THE 'PATIENT' FILE
"RTN","RORUPD01",77,0)
 ;
"RTN","RORUPD01",78,0)
 ; BEGIEN        Start IEN in the PATIENT file
"RTN","RORUPD01",79,0)
 ; ENDIEN        End IEN in the PATIENT file
"RTN","RORUPD01",80,0)
 ;
"RTN","RORUPD01",81,0)
 ; Return Values:
"RTN","RORUPD01",82,0)
 ;       <0  Error code
"RTN","RORUPD01",83,0)
 ;      >=0  Statistics
"RTN","RORUPD01",84,0)
 ;             ^1: Total number of processed patients
"RTN","RORUPD01",85,0)
 ;             ^2: Number of patients processed with errors
"RTN","RORUPD01",86,0)
 ;
"RTN","RORUPD01",87,0)
 ; If there is an error in processing of a patient, routine behavior
"RTN","RORUPD01",88,0)
 ; depends on the mode of execution:
"RTN","RORUPD01",89,0)
 ;
"RTN","RORUPD01",90,0)
 ; In the normal mode program logs the errors, adds a record to the
"RTN","RORUPD01",91,0)
 ; ROR PATIENT EVENTS file (#798.3), and continues processing of
"RTN","RORUPD01",92,0)
 ; the remaining patients. Next registry update wil start data scan
"RTN","RORUPD01",93,0)
 ; for this patient from the date stored in the file #798.3.
"RTN","RORUPD01",94,0)
 ;
"RTN","RORUPD01",95,0)
 ; In the debug mode 3 program is aborted if there is an error
"RTN","RORUPD01",96,0)
 ; during processing of a patient.
"RTN","RORUPD01",97,0)
 ;
"RTN","RORUPD01",98,0)
PROCESS(BEGIEN,ENDIEN) ;
"RTN","RORUPD01",99,0)
 N CNT,DTNEXT,ECNT,EXIT,PATIEN,RC,TH,TMP
"RTN","RORUPD01",100,0)
 ;--- Loop through the patients
"RTN","RORUPD01",101,0)
 S:$G(ENDIEN)'>0 ENDIEN=0
"RTN","RORUPD01",102,0)
 S PATIEN=$S($G(BEGIEN)>0:$O(^DPT(BEGIEN),-1),1:0)
"RTN","RORUPD01",103,0)
 S (CNT,ECNT,EXIT,RC)=0
"RTN","RORUPD01",104,0)
 F  S PATIEN=$O(^DPT(PATIEN))  Q:PATIEN'>0  D  Q:EXIT!(RC<0)
"RTN","RORUPD01",105,0)
 . I ENDIEN,PATIEN'<ENDIEN  S EXIT=1  Q
"RTN","RORUPD01",106,0)
 . ;--- For a queued task only
"RTN","RORUPD01",107,0)
 . I $D(ZTQUEUED)  S RC=0  D  Q:RC<0
"RTN","RORUPD01",108,0)
 . . ;--- Check if task stop has been requested
"RTN","RORUPD01",109,0)
 . . I $$CHKSTOP()  S RC=$$ERROR^RORERR(-42)  Q
"RTN","RORUPD01",110,0)
 . . ;--- Check if the task should be suspended
"RTN","RORUPD01",111,0)
 . . Q:'$G(RORUPD("SUSPEND"))
"RTN","RORUPD01",112,0)
 . . Q:$$NOW^XLFDT<$G(DTNEXT)
"RTN","RORUPD01",113,0)
 . . Q:'$$SUSPEND(.DTNEXT)
"RTN","RORUPD01",114,0)
 . . ;--- Suspend the task during the peak hours
"RTN","RORUPD01",115,0)
 . . F  D  Q:'TH!(RC<0)
"RTN","RORUPD01",116,0)
 . . . S TH=$$FMDIFF^XLFDT(DTNEXT,$$NOW^XLFDT,2)
"RTN","RORUPD01",117,0)
 . . . I TH<60  S TH=0  Q       ; Do not HANG for less than a
"RTN","RORUPD01",118,0)
 . . . H $S(TH>3600:3600,1:TH)  ; minute and more than an hour
"RTN","RORUPD01",119,0)
 . . . ;--- Check if task stop has been requested
"RTN","RORUPD01",120,0)
 . . . S:$$CHKSTOP() RC=$$ERROR^RORERR(-42)
"RTN","RORUPD01",121,0)
 . ;--- Update the progress indicator
"RTN","RORUPD01",122,0)
 . S CNT=CNT+1
"RTN","RORUPD01",123,0)
 . I $G(RORPARM("DEBUG"))>1  W:$E($G(IOST),1,2)="C-" *13,CNT
"RTN","RORUPD01",124,0)
 . ;--- Process the patient
"RTN","RORUPD01",125,0)
 . S RC=$$PROCPAT(PATIEN)
"RTN","RORUPD01",126,0)
 . I $G(RORPARM("SETUP"))  D:'(CNT#1000)
"RTN","RORUPD01",127,0)
 . . D LOG^RORLOG(2,"Number of patients processed by now: "_CNT)
"RTN","RORUPD01",128,0)
 . ;--- Process the error (if any)
"RTN","RORUPD01",129,0)
 . I RC<0  D  S:$G(RORPARM("DEBUG"))<3 RC=0
"RTN","RORUPD01",130,0)
 . . I RC=-66  S RC=0  Q        ; Counter in the file #798.3
"RTN","RORUPD01",131,0)
 . . S ECNT=ECNT+1
"RTN","RORUPD01",132,0)
 . . S RC=$$ERROR^RORERR(-15,,,PATIEN)
"RTN","RORUPD01",133,0)
 . . ;--- Create a record in the file #798.3
"RTN","RORUPD01",134,0)
 . . S TMP=$$ADD^RORUPP01(PATIEN,RORUPD("DSBEG"))
"RTN","RORUPD01",135,0)
 . . S:TMP<0 RC=TMP
"RTN","RORUPD01",136,0)
 Q $S(RC<0:RC,1:CNT_"^"_ECNT)
"RTN","RORUPD01",137,0)
 ;
"RTN","RORUPD01",138,0)
 ;***** PROCESSES PATIENT'S DATA (EXCEPT DEMOGRAPHIC DATA)
"RTN","RORUPD01",139,0)
 ;
"RTN","RORUPD01",140,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD01",141,0)
 ; [NOUPD]       Disable registry update (0 by default)
"RTN","RORUPD01",142,0)
 ;
"RTN","RORUPD01",143,0)
 ; Return Values:
"RTN","RORUPD01",144,0)
 ;       <0  Error code
"RTN","RORUPD01",145,0)
 ;        0  Ok
"RTN","RORUPD01",146,0)
 ;
"RTN","RORUPD01",147,0)
 ; If there is a record for the patient in the ROR PATIENT EVENTS
"RTN","RORUPD01",148,0)
 ; file (#798.3) and date in that record is less than a value of the
"RTN","RORUPD01",149,0)
 ; RORUPD("DSBEG") then it is used as a start date of the data scan
"RTN","RORUPD01",150,0)
 ; for the patient. Otherwise, the RORUPD("DSBEG") is used.
"RTN","RORUPD01",151,0)
 ;
"RTN","RORUPD01",152,0)
PROCPAT(PATIEN,NOUPD) ;
"RTN","RORUPD01",153,0)
 ;--- Quit if the patient has already been processed
"RTN","RORUPD01",154,0)
 Q:$D(@RORUPDPI@("U",PATIEN)) 0
"RTN","RORUPD01",155,0)
 ;--- Quit if the patient's record has been merged
"RTN","RORUPD01",156,0)
 Q:$G(^DPT(PATIEN,-9)) 0
"RTN","RORUPD01",157,0)
 ;--- Do not update the registries with a "test patient"
"RTN","RORUPD01",158,0)
 I '$G(NOUPD),$$TESTPAT^RORUTL01(PATIEN)  D  Q 0
"RTN","RORUPD01",159,0)
 . S @RORUPDPI@("U",PATIEN)=""
"RTN","RORUPD01",160,0)
 ;
"RTN","RORUPD01",161,0)
 N RORERRDL      ; Default error location
"RTN","RORUPD01",162,0)
 ;
"RTN","RORUPD01",163,0)
 N PATIENS,RC,RLST,RORMSG,SDSDT,TMP,UPDREG,UPDSTART
"RTN","RORUPD01",164,0)
 S PATIENS=PATIEN_","
"RTN","RORUPD01",165,0)
 ;--- Initialize the variables
"RTN","RORUPD01",166,0)
 D CLEAR^RORERR("PROCPAT^RORUPD01"),CLREC^RORUPDUT
"RTN","RORUPD01",167,0)
 K RORVALS ; Clear all calculated values
"RTN","RORUPD01",168,0)
 S RC=$$LOOPINIT(PATIEN)  Q:RC<0 RC
"RTN","RORUPD01",169,0)
 ;
"RTN","RORUPD01",170,0)
 ;--- If the loop control list of registries is empty, the patient
"RTN","RORUPD01",171,0)
 ;    is already in all the registries that we are going to process.
"RTN","RORUPD01",172,0)
 S UPDREG=0
"RTN","RORUPD01",173,0)
 I $D(RORUPD("LM",2))>1  S RC=0  D  G:RC<0 PPEX  S UPDREG='$G(NOUPD)
"RTN","RORUPD01",174,0)
 . ;--- Determine start date of the data scan
"RTN","RORUPD01",175,0)
 . S UPDSTART=RORUPD("DSBEG")
"RTN","RORUPD01",176,0)
 . S SDSDT=$$SDSDATE^RORUPP01(PATIEN)
"RTN","RORUPD01",177,0)
 . I SDSDT<0  S RC=SDSDT  Q
"RTN","RORUPD01",178,0)
 . I SDSDT  S:SDSDT<UPDSTART UPDSTART=SDSDT
"RTN","RORUPD01",179,0)
 . S UPDSTART=$$FMADD^XLFDT(UPDSTART\1,-RORUPD("LD",1))
"RTN","RORUPD01",180,0)
 . ;--- Load necessary data elements
"RTN","RORUPD01",181,0)
 . I $D(RORUPD("SR",2,"F"))>1  D  Q:RC<0
"RTN","RORUPD01",182,0)
 . . S RC=$$LOAD(PATIENS)
"RTN","RORUPD01",183,0)
 . D SETVAL^RORUPDUT("ROR DFN",PATIEN)
"RTN","RORUPD01",184,0)
 . ;--- Apply "before" rules
"RTN","RORUPD01",185,0)
 . S RC=$$APLRULES^RORUPDUT(2,PATIENS,"B")  Q:RC
"RTN","RORUPD01",186,0)
 . ;
"RTN","RORUPD01",187,0)
 . ;--- Process patient data from other VistA files
"RTN","RORUPD01",188,0)
 . I $D(RORUPD("SR",9000010))  D  Q:RC
"RTN","RORUPD01",189,0)
 . . S RC=$$VISIT^RORUPD08(UPDSTART,PATIEN)
"RTN","RORUPD01",190,0)
 . I $D(RORUPD("SR",9000011))  D  Q:RC
"RTN","RORUPD01",191,0)
 . . S RC=$$PROBLEM^RORUPD07(UPDSTART,PATIEN)
"RTN","RORUPD01",192,0)
 . I $D(RORUPD("SR",45))  D       Q:RC
"RTN","RORUPD01",193,0)
 . . S RC=$$PTF^RORUPD09(UPDSTART,PATIEN)
"RTN","RORUPD01",194,0)
 . I $D(RORUPD("SR",63))  D       Q:RC
"RTN","RORUPD01",195,0)
 . . S RC=$$LAB^RORUPD04(UPDSTART,PATIEN)
"RTN","RORUPD01",196,0)
 . ; <--- Insert processing of other files here. Do not forget to add
"RTN","RORUPD01",197,0)
 . ;      definitions of these files into the 'ROR METADATA' file.
"RTN","RORUPD01",198,0)
 . ;
"RTN","RORUPD01",199,0)
 . ;--- Apply "after" rules
"RTN","RORUPD01",200,0)
 . S RC=$$APLRULES^RORUPDUT(2,PATIENS,"A")  Q:RC
"RTN","RORUPD01",201,0)
 ;
"RTN","RORUPD01",202,0)
 ;--- Update the registries if necessary
"RTN","RORUPD01",203,0)
 I UPDREG  S RC=$$UPDREG^RORUPD50(PATIEN)  G:RC<0 PPEX
"RTN","RORUPD01",204,0)
 ;--- Error processing
"RTN","RORUPD01",205,0)
 I $$GETEC^RORUPDUT  D  S RC=-15
"RTN","RORUPD01",206,0)
 . S RLST=$NA(@RORUPDPI@("U",PATIEN,2))
"RTN","RORUPD01",207,0)
 E  S RLST="",RC=0
"RTN","RORUPD01",208,0)
 ;--- If there are records in the file #798.3 for the patient,
"RTN","RORUPD01",209,0)
 ;    remove them (log a warning if cannot remove). If the patient
"RTN","RORUPD01",210,0)
 ;    has been processed with errors, remove only records associated
"RTN","RORUPD01",211,0)
 ;--- with the registries that the patient has been added to.
"RTN","RORUPD01",212,0)
 D:$G(SDSDT)
"RTN","RORUPD01",213,0)
 . S TMP=$$REMOVE^RORUPP01(PATIEN,RLST)
"RTN","RORUPD01",214,0)
 . S:TMP<0 TMP=$$ERROR^RORERR(-31,,,PATIEN)
"RTN","RORUPD01",215,0)
 ;--- Mark the patient as processed
"RTN","RORUPD01",216,0)
 S @RORUPDPI@("U",PATIEN)=""
"RTN","RORUPD01",217,0)
PPEX ;--- Cleanup
"RTN","RORUPD01",218,0)
 D CLRDES^RORUPDUT(2)
"RTN","RORUPD01",219,0)
 Q RC
"RTN","RORUPD01",220,0)
 ;
"RTN","RORUPD01",221,0)
 ;***** CHECKS IF THE TASK SHOULD BE SUSPENDED
"RTN","RORUPD01",222,0)
 ;
"RTN","RORUPD01",223,0)
 ; .DTNEXT       Date/Time of the next event (suspend/resume)
"RTN","RORUPD01",224,0)
 ;               is returned via this parameter
"RTN","RORUPD01",225,0)
 ;
"RTN","RORUPD01",226,0)
 ; Return Values:
"RTN","RORUPD01",227,0)
 ;        0  Continue/Resume
"RTN","RORUPD01",228,0)
 ;        1  Suspend
"RTN","RORUPD01",229,0)
 ;
"RTN","RORUPD01",230,0)
SUSPEND(DTNEXT) ;
"RTN","RORUPD01",231,0)
 N DATE,NOW,SUSPEND,TIME,TS,TR
"RTN","RORUPD01",232,0)
 S TS=$P(RORUPD("SUSPEND"),U,1)
"RTN","RORUPD01",233,0)
 S TR=$P(RORUPD("SUSPEND"),U,2)
"RTN","RORUPD01",234,0)
 S NOW=$$NOW^XLFDT,DATE=NOW\1
"RTN","RORUPD01",235,0)
 ;--- A working day
"RTN","RORUPD01",236,0)
 I $$WDCHK^RORUTL01(DATE)  D  Q SUSPEND
"RTN","RORUPD01",237,0)
 . S TIME=NOW-DATE,SUSPEND=0
"RTN","RORUPD01",238,0)
 . I TIME<TS   S DTNEXT=DATE+TS  Q
"RTN","RORUPD01",239,0)
 . I TIME'<TR  S DTNEXT=$$WDNEXT^RORUTL01(DATE)+TS  Q
"RTN","RORUPD01",240,0)
 . S DTNEXT=DATE+TR,SUSPEND=1
"RTN","RORUPD01",241,0)
 ;--- Saturday, Sunday or Holiday
"RTN","RORUPD01",242,0)
 S DTNEXT=$$WDNEXT^RORUTL01(DATE)+TS
"RTN","RORUPD01",243,0)
 Q 0
"RTN","RORUPD01",244,0)
 ;
"RTN","RORUPD01",245,0)
 ;***** UPDATES REGISTRY UPDATE PARAMETERS
"RTN","RORUPD01",246,0)
 ;
"RTN","RORUPD01",247,0)
 ; .REGLST       Reference to a local array containing registry names
"RTN","RORUPD01",248,0)
 ;               as subscripts and optional registry IENs as values
"RTN","RORUPD01",249,0)
 ;
"RTN","RORUPD01",250,0)
 ; Return values:
"RTN","RORUPD01",251,0)
 ;       <0  Error code
"RTN","RORUPD01",252,0)
 ;        0  Ok
"RTN","RORUPD01",253,0)
 ;
"RTN","RORUPD01",254,0)
TMSTMP(REGLST) ;
"RTN","RORUPD01",255,0)
 N DATE,RC,REGIEN,REGIENS,REGNAME,RORFDA,RORMSG,TMP
"RTN","RORUPD01",256,0)
 S REGNAME="",RC=0
"RTN","RORUPD01",257,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:RC<0
"RTN","RORUPD01",258,0)
 . S REGIEN=+$G(REGLST(REGNAME))
"RTN","RORUPD01",259,0)
 . I REGIEN'>0  D  I REGIEN'>0  S RC=+REGIEN  Q
"RTN","RORUPD01",260,0)
 . . S REGIEN=$$REGIEN^RORUTL02(REGNAME)
"RTN","RORUPD01",261,0)
 . S REGIENS=REGIEN_","
"RTN","RORUPD01",262,0)
 . ;--- Check if the new date until that registry is updated is
"RTN","RORUPD01",263,0)
 . ;    greater than that stored in the registry parameters
"RTN","RORUPD01",264,0)
 . S TMP=$$GET1^DIQ(798.1,REGIENS,1,"I",,"RORMSG")
"RTN","RORUPD01",265,0)
 . I $G(DIERR)  D  Q
"RTN","RORUPD01",266,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,798.1,REGIENS)
"RTN","RORUPD01",267,0)
 . S DATE=RORUPD("DSEND")\1
"RTN","RORUPD01",268,0)
 . S:DATE>TMP RORFDA(798.1,REGIENS,1)=DATE
"RTN","RORUPD01",269,0)
 . ;--- Update registry parameters (if necessary)
"RTN","RORUPD01",270,0)
 . Q:$D(RORFDA)<10
"RTN","RORUPD01",271,0)
 . D FILE^DIE("K","RORFDA","RORMSG")
"RTN","RORUPD01",272,0)
 . I $G(DIERR)  D  Q
"RTN","RORUPD01",273,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,798.1,REGIENS)
"RTN","RORUPD01",274,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUPD04")
0^131^B32325986
"RTN","RORUPD04",1,0)
RORUPD04 ;HCIOFO/SG - PROCESSING OF THE LAB DATA  ; 12/8/05 8:20am
"RTN","RORUPD04",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPD04",3,0)
 ;
"RTN","RORUPD04",4,0)
 Q
"RTN","RORUPD04",5,0)
 ;
"RTN","RORUPD04",6,0)
 ;***** CHECKS AN INDICATOR CONDITION
"RTN","RORUPD04",7,0)
 ;
"RTN","RORUPD04",8,0)
 ; LSI           Indicator (internal value)
"RTN","RORUPD04",9,0)
 ; VAL           Indicated value
"RTN","RORUPD04",10,0)
 ; .RESULT(      Result value
"RTN","RORUPD04",11,0)
 ;   "RH")       Reference high
"RTN","RORUPD04",12,0)
 ;   "RL")       Reference low
"RTN","RORUPD04",13,0)
 ;
"RTN","RORUPD04",14,0)
 ; Return Values:
"RTN","RORUPD04",15,0)
 ;        0  False
"RTN","RORUPD04",16,0)
 ;       >0  True
"RTN","RORUPD04",17,0)
 ;
"RTN","RORUPD04",18,0)
CHKIND(LSI,VAL,RESULT) ;
"RTN","RORUPD04",19,0)
 S RESULT=$$UP^XLFSTR(RESULT)
"RTN","RORUPD04",20,0)
 ;--- Reference Range
"RTN","RORUPD04",21,0)
 I LSI=1  D  Q LSI
"RTN","RORUPD04",22,0)
 . I $G(RESULT("RL"))'=""  Q:RESULT<RESULT("RL")
"RTN","RORUPD04",23,0)
 . I $G(RESULT("RH"))'=""  Q:RESULT>RESULT("RH")
"RTN","RORUPD04",24,0)
 . S LSI=0
"RTN","RORUPD04",25,0)
 ;--- Positive Result
"RTN","RORUPD04",26,0)
 I LSI=6  S VAL=0  D  Q VAL
"RTN","RORUPD04",27,0)
 . I (RESULT="P")!(RESULT="R")  S VAL=1  Q
"RTN","RORUPD04",28,0)
 . I RESULT'["POS",RESULT'["REA",RESULT'["DETEC"  Q
"RTN","RORUPD04",29,0)
 . I RESULT'["NEG",RESULT'["NO",RESULT'["IND"  S VAL=1
"RTN","RORUPD04",30,0)
 ;--- Compare to the value
"RTN","RORUPD04",31,0)
 Q:VAL="" 0
"RTN","RORUPD04",32,0)
 I LSI=3  Q (RESULT>VAL)
"RTN","RORUPD04",33,0)
 I LSI=4  Q (RESULT<VAL)
"RTN","RORUPD04",34,0)
 S VAL=$$UP^XLFSTR(VAL)
"RTN","RORUPD04",35,0)
 I LSI=2  Q (RESULT[VAL)
"RTN","RORUPD04",36,0)
 I LSI=5  Q (RESULT=VAL)
"RTN","RORUPD04",37,0)
 Q 0
"RTN","RORUPD04",38,0)
 ;
"RTN","RORUPD04",39,0)
 ;***** PROCESSING OF THE 'LAB DATA' FILE
"RTN","RORUPD04",40,0)
 ;
"RTN","RORUPD04",41,0)
 ; UPDSTART      Date of the earliest update (DO NOT pass by
"RTN","RORUPD04",42,0)
 ;               reference)
"RTN","RORUPD04",43,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD04",44,0)
 ;
"RTN","RORUPD04",45,0)
 ; Return values:
"RTN","RORUPD04",46,0)
 ;       <0  Error code
"RTN","RORUPD04",47,0)
 ;        0  Continue processing of the current patient
"RTN","RORUPD04",48,0)
 ;        1  Stop processing
"RTN","RORUPD04",49,0)
 ;
"RTN","RORUPD04",50,0)
LAB(UPDSTART,PATIEN) ;
"RTN","RORUPD04",51,0)
 N RORFILE       ; File number
"RTN","RORUPD04",52,0)
 ;
"RTN","RORUPD04",53,0)
 N DM,DSEND,LABIENS,RC,RORLAB,TMP
"RTN","RORUPD04",54,0)
 S RORFILE=63,DSEND=RORUPD("DSEND")
"RTN","RORUPD04",55,0)
 K RORVALS("LS")
"RTN","RORUPD04",56,0)
 ;--- If the start date is more than 60 days in the past, results
"RTN","RORUPD04",57,0)
 ;    should be loaded using collection dates. Otherwise, dates of
"RTN","RORUPD04",58,0)
 ;--- the results are used).
"RTN","RORUPD04",59,0)
 S DM=$S($$FMDIFF^XLFDT(DT,UPDSTART)>60:"^CD",1:"^RAD")
"RTN","RORUPD04",60,0)
 ;--- Check the event references if the events are enabled
"RTN","RORUPD04",61,0)
 I $G(RORUPD("FLAGS"))["E"  D  Q:RC'>0 RC
"RTN","RORUPD04",62,0)
 . S RC=$$GET^RORUPP02(PATIEN,1,.UPDSTART,.DSEND)
"RTN","RORUPD04",63,0)
 . ;--- If dates have been modified according to the event references,
"RTN","RORUPD04",64,0)
 . ;--- they are the collection dates/times.
"RTN","RORUPD04",65,0)
 . S:RC>1 UPDSTART=UPDSTART\1,DSEND=$$FMADD^XLFDT(DSEND\1,1),DM="^CD"
"RTN","RORUPD04",66,0)
 ;---
"RTN","RORUPD04",67,0)
 S TMP=$$LABREF^RORUTL18(PATIEN)  Q:TMP'>0 TMP
"RTN","RORUPD04",68,0)
 S LABIENS=TMP_",",RC=0
"RTN","RORUPD04",69,0)
 ;
"RTN","RORUPD04",70,0)
 S RORLAB=$$ALLOC^RORTMP()  D  D FREE^RORTMP(RORLAB)
"RTN","RORUPD04",71,0)
 . ;--- Load the Lab results
"RTN","RORUPD04",72,0)
 . S RC=$$LABRSLTS^RORUTL02(PATIEN,UPDSTART_DM,DSEND_DM,RORLAB)
"RTN","RORUPD04",73,0)
 . I RC<0  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD04",74,0)
 . ;--- Process the results
"RTN","RORUPD04",75,0)
 . Q:$$RESULTS(PATIEN,RORLAB)<0
"RTN","RORUPD04",76,0)
 . ;--- Load necessary data elements
"RTN","RORUPD04",77,0)
 . I $D(RORUPD("SR",RORFILE,"F"))>1  D  I TMP<0  D INCEC^RORUPDUT()  Q
"RTN","RORUPD04",78,0)
 . . S TMP=$$LOAD(LABIENS)
"RTN","RORUPD04",79,0)
 . ;--- Apply "before" rules
"RTN","RORUPD04",80,0)
 . S RC=$$APLRULES^RORUPDUT(RORFILE,LABIENS,"B")
"RTN","RORUPD04",81,0)
 . I RC  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD04",82,0)
 . ;--- Apply "after" rules
"RTN","RORUPD04",83,0)
 . S RC=$$APLRULES^RORUPDUT(RORFILE,LABIENS,"A")
"RTN","RORUPD04",84,0)
 . I RC  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD04",85,0)
 ;
"RTN","RORUPD04",86,0)
 D CLRDES^RORUPDUT(RORFILE)
"RTN","RORUPD04",87,0)
 Q RC
"RTN","RORUPD04",88,0)
 ;
"RTN","RORUPD04",89,0)
 ;***** LOAD DATA ELEMENTS
"RTN","RORUPD04",90,0)
 ;
"RTN","RORUPD04",91,0)
 ; IENS          IENS of the current record
"RTN","RORUPD04",92,0)
 ;
"RTN","RORUPD04",93,0)
 ; Return values:
"RTN","RORUPD04",94,0)
 ;       <0  Error code
"RTN","RORUPD04",95,0)
 ;        0  Ok
"RTN","RORUPD04",96,0)
 ;
"RTN","RORUPD04",97,0)
LOAD(IENS) ;
"RTN","RORUPD04",98,0)
 N RC  S RC=0
"RTN","RORUPD04",99,0)
 ;--- API #1
"RTN","RORUPD04",100,0)
 I $D(RORUPD("SR",RORFILE,"F",1))  D  Q:RC<0 RC
"RTN","RORUPD04",101,0)
 . S RC=$$LOADFLDS^RORUPDUT(RORFILE,IENS)
"RTN","RORUPD04",102,0)
 ;--- API #2
"RTN","RORUPD04",103,0)
 Q 0
"RTN","RORUPD04",104,0)
 ;
"RTN","RORUPD04",105,0)
 ;***** EXTRACTS PROPER RESULT CODE FROM THE OBSERVATION ID
"RTN","RORUPD04",106,0)
 ;
"RTN","RORUPD04",107,0)
 ; OID           Observation ID in HL7 format
"RTN","RORUPD04",108,0)
 ; CS            HL7 component separator
"RTN","RORUPD04",109,0)
 ;
"RTN","RORUPD04",110,0)
 ; Return values:
"RTN","RORUPD04",111,0)
 ;           Lab result code (see the LA7SC parameter of
"RTN","RORUPD04",112,0)
 ;           the GCPR^LA7QRY entry point)
"RTN","RORUPD04",113,0)
 ;             ^1: Result code
"RTN","RORUPD04",114,0)
 ;             ^2: Coding system ("LN" or "NLT")
"RTN","RORUPD04",115,0)
 ;           Or an empty string if coding system is unknown or there
"RTN","RORUPD04",116,0)
 ;           are no active search indicators exist for this code.
"RTN","RORUPD04",117,0)
 ;
"RTN","RORUPD04",118,0)
RESCODE(OID,CS) ;
"RTN","RORUPD04",119,0)
 N CODE,I,RESCODE,TYPE
"RTN","RORUPD04",120,0)
 S RESCODE=""
"RTN","RORUPD04",121,0)
 F I=1,4  D  Q:RESCODE'=""
"RTN","RORUPD04",122,0)
 . S CODE=$P(OID,CS,I),TYPE=$P(OID,CS,I+2)             Q:CODE=""
"RTN","RORUPD04",123,0)
 . S TYPE=$S(TYPE="LN":"LN",TYPE="99VA64":"NLT",1:"")  Q:TYPE=""
"RTN","RORUPD04",124,0)
 . ;--- Check if the search indicators exist for this code
"RTN","RORUPD04",125,0)
 . S RESCODE=CODE_U_TYPE
"RTN","RORUPD04",126,0)
 . S:$D(@RORUPDPI@("LS",RESCODE))<10 RESCODE=""
"RTN","RORUPD04",127,0)
 Q RESCODE
"RTN","RORUPD04",128,0)
 ;
"RTN","RORUPD04",129,0)
 ;***** LOADS AND PROCESSES RESULTS OF THE TESTS
"RTN","RORUPD04",130,0)
 ;
"RTN","RORUPD04",131,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD04",132,0)
 ; ROR8LAB       Closed root of the HL7 message created by GCPR^LA7QRY
"RTN","RORUPD04",133,0)
 ;
"RTN","RORUPD04",134,0)
 ; Return values:
"RTN","RORUPD04",135,0)
 ;       <0  Error code
"RTN","RORUPD04",136,0)
 ;        0  Ok
"RTN","RORUPD04",137,0)
 ;
"RTN","RORUPD04",138,0)
RESULTS(PATIEN,ROR8LAB) ;
"RTN","RORUPD04",139,0)
 N CS,DATE,FS,I,ISEG,LOCATION,LSIEN,LSNODE,RC,RESCODE,RESVAL,RORHL,SEG,SEGTYPE,TMP
"RTN","RORUPD04",140,0)
 S ISEG="",RC=0
"RTN","RORUPD04",141,0)
 F  S ISEG=$O(@ROR8LAB@(ISEG))  Q:ISEG=""  D  Q:RC<0
"RTN","RORUPD04",142,0)
 . S SEG=$G(@ROR8LAB@(ISEG))
"RTN","RORUPD04",143,0)
 . ;--- Extract separators from the MSH segment
"RTN","RORUPD04",144,0)
 . I $E(SEG,1,3)="MSH"  D  Q
"RTN","RORUPD04",145,0)
 . . S (RORHL("FS"),FS)=$E(SEG,4),TMP=$P(SEG,FS,2)
"RTN","RORUPD04",146,0)
 . . S CS=$E(TMP,1)
"RTN","RORUPD04",147,0)
 . ;--- Skip all segments except OBX
"RTN","RORUPD04",148,0)
 . S SEGTYPE=$P(SEG,FS)
"RTN","RORUPD04",149,0)
 . Q:SEGTYPE'="OBX"
"RTN","RORUPD04",150,0)
 . ;--- Get lab result code
"RTN","RORUPD04",151,0)
 . S RESCODE=$$RESCODE($P(SEG,FS,4),CS)  Q:RESCODE=""
"RTN","RORUPD04",152,0)
 . ;--- Load the full segment
"RTN","RORUPD04",153,0)
 . D LOADSEG^RORHL7A(.SEG,$NA(@ROR8LAB@(ISEG)))
"RTN","RORUPD04",154,0)
 . ;--- Get the result data
"RTN","RORUPD04",155,0)
 . S RESVAL=$G(SEG(5)),TMP=$G(SEG(7))
"RTN","RORUPD04",156,0)
 . S RESVAL("RL")=$P(TMP,"-",1) ; Reference Low
"RTN","RORUPD04",157,0)
 . S RESVAL("RH")=$P(TMP,"-",2) ; Reference High
"RTN","RORUPD04",158,0)
 . S DATE=$$HL7TFM^XLFDT($G(SEG(14)),"L")\1
"RTN","RORUPD04",159,0)
 . ;--- Analyze the result
"RTN","RORUPD04",160,0)
 . K LOCATION
"RTN","RORUPD04",161,0)
 . S LSNODE=$NA(@RORUPDPI@("LS",RESCODE))
"RTN","RORUPD04",162,0)
 . S LSIEN=""
"RTN","RORUPD04",163,0)
 . F  S LSIEN=$O(@LSNODE@(LSIEN))  Q:LSIEN=""  D  Q:RC<0
"RTN","RORUPD04",164,0)
 . . S I="",RC=0
"RTN","RORUPD04",165,0)
 . . F  S I=$O(@LSNODE@(LSIEN,I))  Q:I=""  D  Q:RC
"RTN","RORUPD04",166,0)
 . . . S TMP=$G(@LSNODE@(LSIEN,I))
"RTN","RORUPD04",167,0)
 . . . S RC=$$CHKIND(+TMP,$P(TMP,U,2),.RESVAL)
"RTN","RORUPD04",168,0)
 . . Q:RC'>0
"RTN","RORUPD04",169,0)
 . . S TMP=+$G(RORVALS("LS",LSIEN))
"RTN","RORUPD04",170,0)
 . . I TMP  Q:(DATE'>0)!(DATE'<TMP)
"RTN","RORUPD04",171,0)
 . . S:'$D(LOCATION) LOCATION=$$IEN^XUAF4($P($G(SEG(15)),CS))
"RTN","RORUPD04",172,0)
 . . S RORVALS("LS",LSIEN)=DATE_U_LOCATION
"RTN","RORUPD04",173,0)
 ;---
"RTN","RORUPD04",174,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUPD04",175,0)
 ;
"RTN","RORUPD04",176,0)
 ;***** IMPLEMENTATION OF THE SELECTION RULE
"RTN","RORUPD04",177,0)
 ;
"RTN","RORUPD04",178,0)
 ; LSIEN         Lab Search IEN
"RTN","RORUPD04",179,0)
 ;
"RTN","RORUPD04",180,0)
 ; Return values:
"RTN","RORUPD04",181,0)
 ;        0  Skip the patient
"RTN","RORUPD04",182,0)
 ;        1  Add the patient
"RTN","RORUPD04",183,0)
 ;
"RTN","RORUPD04",184,0)
RULE(LSIEN) ;
"RTN","RORUPD04",185,0)
 Q:'$D(RORVALS("LS",LSIEN)) 0
"RTN","RORUPD04",186,0)
 N DATE,LOC,SRDT
"RTN","RORUPD04",187,0)
 S DATE=+$G(RORVALS("LS",LSIEN))
"RTN","RORUPD04",188,0)
 D:DATE>0
"RTN","RORUPD04",189,0)
 . S LOC=$P($G(RORVALS("LS",LSIEN)),U,2)
"RTN","RORUPD04",190,0)
 . S SRDT=$$GETVAL^RORUPDUT("ROR SRDT")
"RTN","RORUPD04",191,0)
 . I (DATE<SRDT)!(SRDT'>0)  D  Q
"RTN","RORUPD04",192,0)
 . . S RORVALS("SV","ROR SRDT")=DATE
"RTN","RORUPD04",193,0)
 . . S RORVALS("SV","ROR SRLOC")=LOC
"RTN","RORUPD04",194,0)
 . I DATE=SRDT  D:$$GETVAL^RORUPDUT("ROR SRLOC")=""  Q
"RTN","RORUPD04",195,0)
 . . S RORVALS("SV","ROR SRLOC")=LOC
"RTN","RORUPD04",196,0)
 Q 1
"RTN","RORUPD05")
0^132^B44214142
"RTN","RORUPD05",1,0)
RORUPD05 ;HCIOFO/SG - REGISTRY UPDATE (MULTITASK) ; 8/25/05 12:33pm
"RTN","RORUPD05",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPD05",3,0)
 ;
"RTN","RORUPD05",4,0)
 Q
"RTN","RORUPD05",5,0)
 ;
"RTN","RORUPD05",6,0)
 ;***** MONITORS THE SUBTASKS
"RTN","RORUPD05",7,0)
 ;
"RTN","RORUPD05",8,0)
 ; Return Values:
"RTN","RORUPD05",9,0)
 ;       <0  Error code
"RTN","RORUPD05",10,0)
 ;      >=0  Combined statistics returned by the $$PROCESS^RORUPD01
"RTN","RORUPD05",11,0)
 ;           function of each subtask
"RTN","RORUPD05",12,0)
 ;
"RTN","RORUPD05",13,0)
MONITOR() ;
"RTN","RORUPD05",14,0)
 N CNT,ECNT,EXIT,RC,TASK,TIMEOUT,TSKCNT
"RTN","RORUPD05",15,0)
 S (CNT,ECNT,EXIT)=0,TIMEOUT=600 ; 10hrs = 600*60
"RTN","RORUPD05",16,0)
 F  H 60  D  Q:EXIT
"RTN","RORUPD05",17,0)
 . ;--- Exit if all subtasks finished
"RTN","RORUPD05",18,0)
 . I $D(@RORUPDPI@("T"))<10  S EXIT=1  Q
"RTN","RORUPD05",19,0)
 . ;--- Abort if some of the subtasks have not started during
"RTN","RORUPD05",20,0)
 . ;--- the predefined time frame.
"RTN","RORUPD05",21,0)
 . I TIMEOUT'>0  S EXIT=$$ERROR^RORERR(-78)  Q
"RTN","RORUPD05",22,0)
 . ;--- Check for a request to stop
"RTN","RORUPD05",23,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD  S EXIT=$$ERROR^RORERR(-42)  Q
"RTN","RORUPD05",24,0)
 . ;--- Browse through the list of subtasks
"RTN","RORUPD05",25,0)
 . S (TASK,TSKCNT)=0
"RTN","RORUPD05",26,0)
 . F  S TASK=$O(@RORUPDPI@("T",TASK))  Q:TASK=""  D
"RTN","RORUPD05",27,0)
 . . S RC=@RORUPDPI@("T",TASK),TSKCNT=TSKCNT+1
"RTN","RORUPD05",28,0)
 . . ;--- Skip a subtask that was scheduled but has not started yet
"RTN","RORUPD05",29,0)
 . . I RC="S"  S TSKCNT=TSKCNT-1  Q
"RTN","RORUPD05",30,0)
 . . ;--- Skip a running subtask
"RTN","RORUPD05",31,0)
 . . L +@RORUPDPI@("T",TASK):0  E  Q
"RTN","RORUPD05",32,0)
 . . L -@RORUPDPI@("T",TASK)
"RTN","RORUPD05",33,0)
 . . ;--- The subtask has crashed
"RTN","RORUPD05",34,0)
 . . I RC=-60  S EXIT=$$ERROR^RORERR(-60,,,,TASK)  Q
"RTN","RORUPD05",35,0)
 . . ;--- Fatal error in the subtask
"RTN","RORUPD05",36,0)
 . . I RC<0  S EXIT=+RC  D  Q
"RTN","RORUPD05",37,0)
 . . . S RC=$$ERROR^RORERR(-56,,,,+RC,"subtask #"_TASK)
"RTN","RORUPD05",38,0)
 . . ;--- The subtask is completed (accumulate the statistics)
"RTN","RORUPD05",39,0)
 . . S CNT=CNT+$P(RC,U),ECNT=ECNT+$P(RC,U,2)
"RTN","RORUPD05",40,0)
 . . K @RORUPDPI@("T",TASK)
"RTN","RORUPD05",41,0)
 . ;--- Timeout timer is ticking only if no subtasks are running
"RTN","RORUPD05",42,0)
 . S:TSKCNT'>0 TIMEOUT=TIMEOUT-1
"RTN","RORUPD05",43,0)
 Q $S(EXIT<0:EXIT,1:CNT_U_ECNT)
"RTN","RORUPD05",44,0)
 ;
"RTN","RORUPD05",45,0)
 ;***** PROCESSES THE DATA (SINGLE TASK OR MULTITASK MODE)
"RTN","RORUPD05",46,0)
 ;
"RTN","RORUPD05",47,0)
 ; [MAXNTSK]     Maximum number of data processing subtasks.
"RTN","RORUPD05",48,0)
 ;               If this parameter is less than 2, all patients
"RTN","RORUPD05",49,0)
 ;               will be processed by the single main task.
"RTN","RORUPD05",50,0)
 ;               Otherwise, all patients can be distributed among
"RTN","RORUPD05",51,0)
 ;               several subtasks.
"RTN","RORUPD05",52,0)
 ;
"RTN","RORUPD05",53,0)
 ;               If "N^M^AUTO" is passed as a value of this parameter
"RTN","RORUPD05",54,0)
 ;               and difference between the end and start dates is
"RTN","RORUPD05",55,0)
 ;               more than M days then N subtasks will be created.
"RTN","RORUPD05",56,0)
 ;
"RTN","RORUPD05",57,0)
 ; Return Values:
"RTN","RORUPD05",58,0)
 ;       <0  Error code
"RTN","RORUPD05",59,0)
 ;      >=0  Statistics returned by the $$MONITOR function
"RTN","RORUPD05",60,0)
 ;
"RTN","RORUPD05",61,0)
 ; The main task will wait for completion of the subtasks. If one
"RTN","RORUPD05",62,0)
 ; of them fails, all other (including the main one) will fail too.
"RTN","RORUPD05",63,0)
 ;
"RTN","RORUPD05",64,0)
PROCESS(MAXNTSK) ;
"RTN","RORUPD05",65,0)
 N COUNTERS,NTSK,OLDPI,RC,SUBSCR,TASKTBL,TMP
"RTN","RORUPD05",66,0)
 ;--- Calculate number of tasks and create the task table
"RTN","RORUPD05",67,0)
 D:$G(MAXNTSK)["AUTO"
"RTN","RORUPD05",68,0)
 . S TMP=$$FMDIFF^XLFDT(RORUPD("DSEND"),RORUPD("DSBEG"),1)
"RTN","RORUPD05",69,0)
 . S MAXNTSK=$S(TMP>$P(MAXNTSK,U,2):+MAXNTSK,1:0)
"RTN","RORUPD05",70,0)
 I $G(MAXNTSK)>1  D  Q:NTSK<0 NTSK
"RTN","RORUPD05",71,0)
 . S NTSK=$$TASKTBL(MAXNTSK,.TASKTBL)
"RTN","RORUPD05",72,0)
 ;--- Process all patients by the main task
"RTN","RORUPD05",73,0)
 Q:$G(NTSK)<2 $$PROCESS^RORUPD01()
"RTN","RORUPD05",74,0)
 ;
"RTN","RORUPD05",75,0)
 S RORUPD("JOB")=$J,OLDPI=RORUPDPI
"RTN","RORUPD05",76,0)
 ;--- Initialize the node in the ^XTMP global
"RTN","RORUPD05",77,0)
 I $G(RORPARM("SETUP"))  D
"RTN","RORUPD05",78,0)
 . S SUBSCR="RORUPDR"_+$O(RORUPD("LM2",""))
"RTN","RORUPD05",79,0)
 . S RORUPDPI=$NA(^XTMP(SUBSCR)),I=0
"RTN","RORUPD05",80,0)
 . F  S I=$O(@RORUPDPI@(I))  Q:I=""  K:I'="U" @RORUPDPI@(I)
"RTN","RORUPD05",81,0)
 E  D
"RTN","RORUPD05",82,0)
 . S SUBSCR="RORUPDJ"_$J
"RTN","RORUPD05",83,0)
 . S RORUPDPI=$NA(^XTMP(SUBSCR))
"RTN","RORUPD05",84,0)
 . K @RORUPDPI
"RTN","RORUPD05",85,0)
 D XTMPHDR^RORUTL01(SUBSCR,30,"PROCESS-RORUPD05")
"RTN","RORUPD05",86,0)
 M @RORUPDPI=@OLDPI
"RTN","RORUPD05",87,0)
 ;--- Indicate that the main task is running
"RTN","RORUPD05",88,0)
 L +@RORUPDPI@("T",0):5
"RTN","RORUPD05",89,0)
 E  Q $$ERROR^RORERR(-61)
"RTN","RORUPD05",90,0)
 ;
"RTN","RORUPD05",91,0)
 ;--- Start the subtasks
"RTN","RORUPD05",92,0)
 S RC=$$START(.TASKTBL)
"RTN","RORUPD05",93,0)
 ;--- Monitor the subtasks
"RTN","RORUPD05",94,0)
 S COUNTERS=$S(RC'<0:$$MONITOR(),1:RC)
"RTN","RORUPD05",95,0)
 ;
"RTN","RORUPD05",96,0)
 ;--- Clear "running" flag of the main task
"RTN","RORUPD05",97,0)
 ;    (request all unfinished subtasks to stop)
"RTN","RORUPD05",98,0)
 L -@RORUPDPI@("T",0)
"RTN","RORUPD05",99,0)
 ;--- Cleanup
"RTN","RORUPD05",100,0)
 I COUNTERS<0  D
"RTN","RORUPD05",101,0)
 . N TASK,ZTSK
"RTN","RORUPD05",102,0)
 . ;--- Dequeue subtasks that have not started yet
"RTN","RORUPD05",103,0)
 . S TASK=0
"RTN","RORUPD05",104,0)
 . F  S TASK=$O(@RORUPDPI@("T",TASK))  Q:TASK=""  D
"RTN","RORUPD05",105,0)
 . . S ZTSK=TASK  D DQ^%ZTLOAD
"RTN","RORUPD05",106,0)
 . ;--- Wait for all unfinished subtasks to stop
"RTN","RORUPD05",107,0)
 . L +@RORUPDPI@("T"):300  L -@RORUPDPI@("T")
"RTN","RORUPD05",108,0)
 K @RORUPDPI@("T")
"RTN","RORUPD05",109,0)
 Q COUNTERS
"RTN","RORUPD05",110,0)
 ;
"RTN","RORUPD05",111,0)
 ;***** STARTS THE SUBTASKS
"RTN","RORUPD05",112,0)
 ;
"RTN","RORUPD05",113,0)
 ; .TASKTBL      Reference to a local variable containing the table
"RTN","RORUPD05",114,0)
 ;               of subtask parameters. See the TASKSPLT and TASKTBL
"RTN","RORUPD05",115,0)
 ;               entry points for details.
"RTN","RORUPD05",116,0)
 ;
"RTN","RORUPD05",117,0)
 ; Return Values:
"RTN","RORUPD05",118,0)
 ;       <0  Error code
"RTN","RORUPD05",119,0)
 ;        0  Ok
"RTN","RORUPD05",120,0)
 ;
"RTN","RORUPD05",121,0)
START(TASKTBL) ;
"RTN","RORUPD05",122,0)
 N CNT,I,ZTDESC,ZTDTH,ZTIO,ZTPRI,ZTRTN,ZTSAVE,ZTSK
"RTN","RORUPD05",123,0)
 K @RORUPDPI@("T")
"RTN","RORUPD05",124,0)
 ;--- Do not allow subtasks to proceed before everything is ready
"RTN","RORUPD05",125,0)
 L +@RORUPDPI@("T"):5
"RTN","RORUPD05",126,0)
 E  Q $$ERROR^RORERR(-61)
"RTN","RORUPD05",127,0)
 ;--- Start the subtasks
"RTN","RORUPD05",128,0)
 S I=""
"RTN","RORUPD05",129,0)
 F CNT=1:1  S I=$O(TASKTBL(I))  Q:I=""  D
"RTN","RORUPD05",130,0)
 . S ZTRTN="SUBTASK^RORUPD05",ZTIO=""
"RTN","RORUPD05",131,0)
 . S ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT,,,,CNT*30)
"RTN","RORUPD05",132,0)
 . S ZTDESC="Registry Update Subtask ("_$TR(TASKTBL(I),U,"-")_")"
"RTN","RORUPD05",133,0)
 . S ZTSAVE("RORIENS")=TASKTBL(I)
"RTN","RORUPD05",134,0)
 . S ZTSAVE("RORLRC(")=""
"RTN","RORUPD05",135,0)
 . S ZTSAVE("RORPARM(")=""
"RTN","RORUPD05",136,0)
 . S ZTSAVE("RORUPD(")=""
"RTN","RORUPD05",137,0)
 . S ZTSAVE("RORUPDPI")=""
"RTN","RORUPD05",138,0)
 . D ^%ZTLOAD
"RTN","RORUPD05",139,0)
 . ;--- Indicate that the subtask has been scheduled
"RTN","RORUPD05",140,0)
 . S @RORUPDPI@("T",ZTSK)="S"
"RTN","RORUPD05",141,0)
 . D LOG^RORERR(-62,,,ZTSK)
"RTN","RORUPD05",142,0)
 ;--- The subtasks may proceed now
"RTN","RORUPD05",143,0)
 L -@RORUPDPI@("T")
"RTN","RORUPD05",144,0)
 Q 0
"RTN","RORUPD05",145,0)
 ;
"RTN","RORUPD05",146,0)
 ;***** DATA PROCESSING SUBTASK
"RTN","RORUPD05",147,0)
 ;
"RTN","RORUPD05",148,0)
 ; RORIENS       Diapason of IENs in the 'PATIENT' file
"RTN","RORUPD05",149,0)
 ;                 ^1: Start IEN
"RTN","RORUPD05",150,0)
 ;                 ^2: End IEN
"RTN","RORUPD05",151,0)
 ; RORLRC        List of Lab result codes to check
"RTN","RORUPD05",152,0)
 ; RORPARM       Application parameters
"RTN","RORUPD05",153,0)
 ; RORUPD        Registry update descriptor
"RTN","RORUPD05",154,0)
 ; RORUPDPI      Closed root of the temporary storage
"RTN","RORUPD05",155,0)
 ;
"RTN","RORUPD05",156,0)
SUBTASK ;
"RTN","RORUPD05",157,0)
 N RORERROR      ; Error processing data
"RTN","RORUPD05",158,0)
 N RORLOG        ; Log subsystem constants & variables
"RTN","RORUPD05",159,0)
 ;
"RTN","RORUPD05",160,0)
 N RC,TASK,TMP
"RTN","RORUPD05",161,0)
 S TASK=ZTSK
"RTN","RORUPD05",162,0)
 ;--- We are not in the KIDS environment anymore
"RTN","RORUPD05",163,0)
 K RORPARM("KIDS")
"RTN","RORUPD05",164,0)
 ;--- Disable debug output (subtask has no device)
"RTN","RORUPD05",165,0)
 S:$G(RORPARM("DEBUG"))>1 RORPARM("DEBUG")=1
"RTN","RORUPD05",166,0)
 ;--- Indicate that the subtask is running
"RTN","RORUPD05",167,0)
 L +@RORUPDPI@("T",TASK):180
"RTN","RORUPD05",168,0)
 E  S RC=$$ERROR^RORERR(-61)  Q
"RTN","RORUPD05",169,0)
 ;--- Check if the main task is running
"RTN","RORUPD05",170,0)
 L +@RORUPDPI@("T",0):0
"RTN","RORUPD05",171,0)
 I  D
"RTN","RORUPD05",172,0)
 . ;--- Cleanup if the main task is not running
"RTN","RORUPD05",173,0)
 . L -@RORUPDPI@("T",0)
"RTN","RORUPD05",174,0)
 . K @RORUPDPI@("T",TASK)
"RTN","RORUPD05",175,0)
 E  D
"RTN","RORUPD05",176,0)
 . N REGIEN,REGLST
"RTN","RORUPD05",177,0)
 . ;--- Error code that will be in effect if the subtask crashes
"RTN","RORUPD05",178,0)
 . S @RORUPDPI@("T",TASK)=-60
"RTN","RORUPD05",179,0)
 . ;--- Initialize the variables
"RTN","RORUPD05",180,0)
 . D INIT^RORUTL01(),CLEAR^RORERR("SUBTASK^RORUPD05")
"RTN","RORUPD05",181,0)
 . S REGIEN=""
"RTN","RORUPD05",182,0)
 . F  S REGIEN=$O(@RORUPDPI@(2,REGIEN))  Q:REGIEN=""  D
"RTN","RORUPD05",183,0)
 . . S TMP=$P(@RORUPDPI@(2,REGIEN),U)  S:TMP'="" REGLST(TMP)=REGIEN
"RTN","RORUPD05",184,0)
 . S TMP="REGISTRY UPDATE SUBTASK #"_TASK_" STARTED"
"RTN","RORUPD05",185,0)
 . S TMP=$$OPEN^RORLOG(.REGLST,1,TMP)
"RTN","RORUPD05",186,0)
 . ;--- Process the patients from 'Start IEN' to 'End IEN'
"RTN","RORUPD05",187,0)
 . S RC=$$PROCESS^RORUPD01($P(RORIENS,U),$P(RORIENS,U,2))
"RTN","RORUPD05",188,0)
 . ;--- Set the error code returned by the registry update process
"RTN","RORUPD05",189,0)
 . S @RORUPDPI@("T",TASK)=RC
"RTN","RORUPD05",190,0)
 . ;--- Cleanup and error processing
"RTN","RORUPD05",191,0)
 . S:RC=-42 ZTSTOP=1
"RTN","RORUPD05",192,0)
 . S TMP="REGISTRY UPDATE SUBTASK "_$S(RC<0:"ABORTED",1:"COMPLETED")
"RTN","RORUPD05",193,0)
 . D CLOSE^RORLOG(TMP,$S(RC'<0:RC,1:""))
"RTN","RORUPD05",194,0)
 ;--- Clear "running" flag of the subtask
"RTN","RORUPD05",195,0)
 L -@RORUPDPI@("T",TASK)
"RTN","RORUPD05",196,0)
 S ZTREQ="@"
"RTN","RORUPD05",197,0)
 Q
"RTN","RORUPD05",198,0)
 ;
"RTN","RORUPD05",199,0)
 ;***** CALCULATES TABLE OF SUBTASKS
"RTN","RORUPD05",200,0)
 ;
"RTN","RORUPD05",201,0)
 ; MAXNTSK       Maximum number of data processing subtasks
"RTN","RORUPD05",202,0)
 ;
"RTN","RORUPD05",203,0)
 ; .TASKTBL      Reference to a local variable where table of
"RTN","RORUPD05",204,0)
 ;               subtask parameters is returned:
"RTN","RORUPD05",205,0)
 ;
"RTN","RORUPD05",206,0)
 ;               TASKTBL       Number of subtasks
"RTN","RORUPD05",207,0)
 ;               TASKTBL(I)    Subtask parameters
"RTN","RORUPD05",208,0)
 ;                               ^1: Start IEN
"RTN","RORUPD05",209,0)
 ;                               ^2: End IEN
"RTN","RORUPD05",210,0)
 ;
"RTN","RORUPD05",211,0)
 ; Return Values:
"RTN","RORUPD05",212,0)
 ;       <0  Error code
"RTN","RORUPD05",213,0)
 ;        0  Process all data by the main task
"RTN","RORUPD05",214,0)
 ;       >1  Number of subtasks
"RTN","RORUPD05",215,0)
 ;
"RTN","RORUPD05",216,0)
 ; If the PATIENT file contains more than 100,000 records, up to
"RTN","RORUPD05",217,0)
 ; MAXNTSK data processing subtasks may be defined. Otherwise, the
"RTN","RORUPD05",218,0)
 ; data should be processed by the main task.
"RTN","RORUPD05",219,0)
 ;
"RTN","RORUPD05",220,0)
TASKTBL(MAXNTSK,RORTBL) ;
"RTN","RORUPD05",221,0)
 N I,IEN,INC,LST,NR,RORTMP
"RTN","RORUPD05",222,0)
 K RORTBL
"RTN","RORUPD05",223,0)
 ;--- Get number of records in the PATIENT file
"RTN","RORUPD05",224,0)
 S NR=$$GET1^DID(2,,,"ENTRIES",,"RORMSG")
"RTN","RORUPD05",225,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9)
"RTN","RORUPD05",226,0)
 Q:NR'>10000 0
"RTN","RORUPD05",227,0)
 ;--- Generate IEN intervals (no more than 300)
"RTN","RORUPD05",228,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORUPD05",229,0)
 S INC=NR\300,NR=0  S:INC<1 INC=1
"RTN","RORUPD05",230,0)
 F IEN=0:INC  S IEN=$O(^DPT(IEN))  Q:IEN'>0  D
"RTN","RORUPD05",231,0)
 . S NR=NR+1,@RORTMP@(NR)=IEN
"RTN","RORUPD05",232,0)
 ;--- Generate the task table
"RTN","RORUPD05",233,0)
 S IEN=1,INC=NR/MAXNTSK
"RTN","RORUPD05",234,0)
 F RORTBL=1:1  D  Q:(RORTBL'<MAXNTSK)!(IEN'>0)
"RTN","RORUPD05",235,0)
 . S RORTBL(RORTBL)=IEN
"RTN","RORUPD05",236,0)
 . S I=$J(RORTBL*INC,0,0),IEN=$G(@RORTMP@(I))
"RTN","RORUPD05",237,0)
 . S $P(RORTBL(RORTBL),U,2)=IEN
"RTN","RORUPD05",238,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORUPD05",239,0)
 ;--- Analize the result
"RTN","RORUPD05",240,0)
 I $G(RORTBL)<2  K RORTBL
"RTN","RORUPD05",241,0)
 E  S $P(RORTBL(RORTBL),U,2)=$O(^DPT(" "),-1)
"RTN","RORUPD05",242,0)
 Q +$G(RORTBL)
"RTN","RORUPD06")
0^133^B11384765
"RTN","RORUPD06",1,0)
RORUPD06 ;HCIOFO/SG - REGISTRY UPDATE (MISCELLANEOUS) ; 11/25/03 3:49pm
"RTN","RORUPD06",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPD06",3,0)
 ;
"RTN","RORUPD06",4,0)
 Q
"RTN","RORUPD06",5,0)
 ;
"RTN","RORUPD06",6,0)
 ;***** ADDS THE PATIENT TO THE REGISTRY (UNCONDITIONALLY)
"RTN","RORUPD06",7,0)
 ;
"RTN","RORUPD06",8,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD06",9,0)
 ; REGNAME       Registry name
"RTN","RORUPD06",10,0)
 ; .RULES        Reference to a local array containing list of
"RTN","RORUPD06",11,0)
 ;               triggered selection rules: RULES(n)=RuleIEN^Date
"RTN","RORUPD06",12,0)
 ;
"RTN","RORUPD06",13,0)
 ; Return Values:
"RTN","RORUPD06",14,0)
 ;       <0  Error code (see MSGLIST^RORERR20)
"RTN","RORUPD06",15,0)
 ;        0  Ok
"RTN","RORUPD06",16,0)
 ;
"RTN","RORUPD06",17,0)
ADDPAT(PATIEN,REGNAME,RULES) ;
"RTN","RORUPD06",18,0)
 N RORERRDL      ; Default error location
"RTN","RORUPD06",19,0)
 N RORUPD        ; Update descriptor
"RTN","RORUPD06",20,0)
 N RORUPDPI      ; Closed root of the temporary storage
"RTN","RORUPD06",21,0)
 ;
"RTN","RORUPD06",22,0)
 N I,RC,REGIEN,REGLST,RORLRC,RORSRLST,RULEIEN,VSRLST
"RTN","RORUPD06",23,0)
 D INIT^RORUTL01("RORUPD")
"RTN","RORUPD06",24,0)
 D CLEAR^RORERR("ADDPAT^RORUPD06")
"RTN","RORUPD06",25,0)
 S RORUPDPI=$NA(^TMP("RORUPD",$J))
"RTN","RORUPD06",26,0)
 ;--- Check the registry name
"RTN","RORUPD06",27,0)
 Q:REGNAME?." " $$ERROR^RORERR(-10,,,PATIEN,REGNAME)
"RTN","RORUPD06",28,0)
 S REGIEN=$$REGIEN^RORUTL02(REGNAME)  Q:REGIEN<0 REGIEN
"RTN","RORUPD06",29,0)
 S REGLST(REGNAME)=REGIEN
"RTN","RORUPD06",30,0)
 ;--- Compile a list of IENs of valid selection rules
"RTN","RORUPD06",31,0)
 S I=""
"RTN","RORUPD06",32,0)
 F  S I=$O(^ROR(798.1,REGIEN,1,"B",I))  Q:I=""  D
"RTN","RORUPD06",33,0)
 . S RULEIEN=$$SRLIEN^RORUTL02(I)  S:RULEIEN>0 VSRLST(RULEIEN)=""
"RTN","RORUPD06",34,0)
 ;--- Prepare list of triggered selection rules
"RTN","RORUPD06",35,0)
 S I="",RC=0
"RTN","RORUPD06",36,0)
 F  S I=$O(RULES(I))  Q:I=""  D  Q:RC<0
"RTN","RORUPD06",37,0)
 . S RULEIEN=$P(RULES(I),U)
"RTN","RORUPD06",38,0)
 . I RULEIEN'>0            S RC=$$ERROR^RORERR(-45)  Q
"RTN","RORUPD06",39,0)
 . I '$D(VSRLST(RULEIEN))  S RC=$$ERROR^RORERR(-45)  Q
"RTN","RORUPD06",40,0)
 . S RORSRLST(RULEIEN)=$P(RULES(I),U,2)
"RTN","RORUPD06",41,0)
 Q:RC<0 RC
"RTN","RORUPD06",42,0)
 ;--- Prepare update descriptor
"RTN","RORUPD06",43,0)
 S RC=$$PREPARE1^RORUPR(.REGLST)
"RTN","RORUPD06",44,0)
 Q:RC<0 $$ERROR^RORERR(-14,,,PATIEN)
"RTN","RORUPD06",45,0)
 ;--- Add the patient to the registry
"RTN","RORUPD06",46,0)
 S RC=$$ADDPDATA^RORUPD50(PATIEN)               Q:RC<0 RC
"RTN","RORUPD06",47,0)
 S RC=$$ADD^RORUPD50(PATIEN,REGIEN,"RORSRLST")  Q:RC<0 RC
"RTN","RORUPD06",48,0)
 ;--- Update patient demographic data
"RTN","RORUPD06",49,0)
 S RC=$$UPDPTDEM^RORUPD51(PATIEN)
"RTN","RORUPD06",50,0)
 Q:RC<0 $$ERROR^RORERR(-16,,,PATIEN)
"RTN","RORUPD06",51,0)
 ;--- Cleanup
"RTN","RORUPD06",52,0)
 D:'$G(RORPARM("DEBUG")) INIT^RORUTL01("RORUPD")
"RTN","RORUPD06",53,0)
 Q 0
"RTN","RORUPD06",54,0)
 ;
"RTN","RORUPD06",55,0)
 ;***** CHECKS/UPDATES THE SINGLE PATIENT IN THE REGISTRY
"RTN","RORUPD06",56,0)
 ;
"RTN","RORUPD06",57,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD06",58,0)
 ; REGNAME       Registry name
"RTN","RORUPD06",59,0)
 ;
"RTN","RORUPD06",60,0)
 ; .UPDBYRUL     Reference to a local array for the list of rules that
"RTN","RORUPD06",61,0)
 ;               the patient is selected by (output). The list has
"RTN","RORUPD06",62,0)
 ;               the following structure: UPDBYRUL(Rule#)=Date, where
"RTN","RORUPD06",63,0)
 ;               "Rule#" is an IEN of the selection rule in the file
"RTN","RORUPD06",64,0)
 ;               #798.2 and "Date" is the date when the patient has
"RTN","RORUPD06",65,0)
 ;               passed the selection rule for the first time.
"RTN","RORUPD06",66,0)
 ;
"RTN","RORUPD06",67,0)
 ; [CHKONLY]     If this optional parameter is undefined (default)
"RTN","RORUPD06",68,0)
 ;               or equals to zero then the function checks a patient
"RTN","RORUPD06",69,0)
 ;               against selection rules and adds him to the registry 
"RTN","RORUPD06",70,0)
 ;               if he passes at least one of the rules.
"RTN","RORUPD06",71,0)
 ;               Otherwise, the patient is only checked against the
"RTN","RORUPD06",72,0)
 ;               rules but registry is not updated.
"RTN","RORUPD06",73,0)
 ;
"RTN","RORUPD06",74,0)
 ; Return Values:
"RTN","RORUPD06",75,0)
 ;       <0  Error code (see MSGLIST^RORERR20)
"RTN","RORUPD06",76,0)
 ;        0  Ok
"RTN","RORUPD06",77,0)
 ;
"RTN","RORUPD06",78,0)
 ; If a local array passed as the UPDBYRUL parameter is undefined
"RTN","RORUPD06",79,0)
 ; after return from the function then the patient has not pass any
"RTN","RORUPD06",80,0)
 ; selection rule.
"RTN","RORUPD06",81,0)
 ;
"RTN","RORUPD06",82,0)
UPDPAT(PATIEN,REGNAME,UPDBYRUL,CHKONLY) ;
"RTN","RORUPD06",83,0)
 N RORERRDL      ; Default error location
"RTN","RORUPD06",84,0)
 N RORLRC        ; List of Lab result codes to check
"RTN","RORUPD06",85,0)
 N RORUPD        ; Update descriptor
"RTN","RORUPD06",86,0)
 N RORUPDPI      ; Closed root of the temporary storage
"RTN","RORUPD06",87,0)
 N RORVALS       ; Calculated values
"RTN","RORUPD06",88,0)
 ;
"RTN","RORUPD06",89,0)
 N RC,REGIEN,REGLST
"RTN","RORUPD06",90,0)
 D INIT^RORUTL01("RORUPD")
"RTN","RORUPD06",91,0)
 D CLEAR^RORERR("UPDPAT^RORUPD06")
"RTN","RORUPD06",92,0)
 S RORUPDPI=$NA(^TMP("RORUPD",$J))
"RTN","RORUPD06",93,0)
 ;--- Check the registry name
"RTN","RORUPD06",94,0)
 Q:REGNAME?." " $$ERROR^RORERR(-10,,,PATIEN,REGNAME)
"RTN","RORUPD06",95,0)
 S REGLST(REGNAME)=""  K UPDBYRUL
"RTN","RORUPD06",96,0)
 ;--- Prepare selection rules
"RTN","RORUPD06",97,0)
 S RC=$$PREPARE^RORUPR(.REGLST)
"RTN","RORUPD06",98,0)
 Q:RC<0 $$ERROR^RORERR(-14,,,PATIEN)
"RTN","RORUPD06",99,0)
 D:$G(RORPARM("DEBUG"))>1 DEBUG^RORUPDUT
"RTN","RORUPD06",100,0)
 ;--- Check the patient and update the registry
"RTN","RORUPD06",101,0)
 S RC=$$PROCPAT^RORUPD01(PATIEN,$G(CHKONLY))
"RTN","RORUPD06",102,0)
 Q:RC<0 $$ERROR^RORERR(-15,,,PATIEN)
"RTN","RORUPD06",103,0)
 ;--- Update patient demographic data
"RTN","RORUPD06",104,0)
 I '$G(CHKONLY)  D  Q:RC<0 $$ERROR^RORERR(-16,,,PATIEN)
"RTN","RORUPD06",105,0)
 . S RC=$$UPDPTDEM^RORUPD51(PATIEN)
"RTN","RORUPD06",106,0)
 ;--- Load the list of triggered rules
"RTN","RORUPD06",107,0)
 S REGIEN=""
"RTN","RORUPD06",108,0)
 F  S REGIEN=$O(@RORUPDPI@("U",PATIEN,2,REGIEN))  Q:REGIEN=""  D
"RTN","RORUPD06",109,0)
 . M UPDBYRUL=@RORUPDPI@("U",PATIEN,2,REGIEN)
"RTN","RORUPD06",110,0)
 ;--- Cleanup
"RTN","RORUPD06",111,0)
 D:'$G(RORPARM("DEBUG")) INIT^RORUTL01("RORUPD")
"RTN","RORUPD06",112,0)
 Q 0
"RTN","RORUPD07")
0^134^B7767949
"RTN","RORUPD07",1,0)
RORUPD07 ;HCIOFO/SG - PROCESSING OF THE 'PROBLEM' FILE  ; 8/3/05 9:46am
"RTN","RORUPD07",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPD07",3,0)
 ;
"RTN","RORUPD07",4,0)
 ; This routine uses the following IAs:
"RTN","RORUPD07",5,0)
 ;
"RTN","RORUPD07",6,0)
 ; #928          ACTIVE^GMPLUTL
"RTN","RORUPD07",7,0)
 ; #2977         GETFLDS^GMPLEDT3
"RTN","RORUPD07",8,0)
 ;
"RTN","RORUPD07",9,0)
 Q
"RTN","RORUPD07",10,0)
 ;
"RTN","RORUPD07",11,0)
 ;***** LOADS DATA ELEMENT VALUES
"RTN","RORUPD07",12,0)
 ;
"RTN","RORUPD07",13,0)
 ; IENS          IENS of the current record
"RTN","RORUPD07",14,0)
 ;
"RTN","RORUPD07",15,0)
 ; Return values:
"RTN","RORUPD07",16,0)
 ;       <0  Error code
"RTN","RORUPD07",17,0)
 ;        0  Ok
"RTN","RORUPD07",18,0)
 ;
"RTN","RORUPD07",19,0)
LOAD(IENS) ;
"RTN","RORUPD07",20,0)
 N RC  S RC=0
"RTN","RORUPD07",21,0)
 ;--- API #1
"RTN","RORUPD07",22,0)
 I $D(RORUPD("SR",RORFILE,"F",1))  D  Q:RC<0 RC
"RTN","RORUPD07",23,0)
 . S RC=$$LOADFLDS^RORUPDUT(RORFILE,IENS)
"RTN","RORUPD07",24,0)
 ;--- API #2
"RTN","RORUPD07",25,0)
 I $D(RORUPD("SR",RORFILE,"F",2))  D  Q:RC<0 RC
"RTN","RORUPD07",26,0)
 . N DE,GMPFLD,GMPORIG,GMPROV,GMVAMC,IN,IP,VT
"RTN","RORUPD07",27,0)
 . S (GMPVAMC,GMPROV)=0
"RTN","RORUPD07",28,0)
 . D GETFLDS^GMPLEDT3(+IENS)
"RTN","RORUPD07",29,0)
 . ;---
"RTN","RORUPD07",30,0)
 . S DE=""
"RTN","RORUPD07",31,0)
 . F  S DE=$O(RORUPD("SR",RORFILE,"F",2,DE))  Q:DE=""  D
"RTN","RORUPD07",32,0)
 . . S VT=""
"RTN","RORUPD07",33,0)
 . . F  S VT=$O(RORUPD("SR",RORFILE,"F",2,DE,VT))  Q:VT=""  D
"RTN","RORUPD07",34,0)
 . . . S IP=+$P(RORUPD("SR",RORFILE,"F",2,DE,VT),U,1)  Q:IP'>0
"RTN","RORUPD07",35,0)
 . . . S IN=+$P(RORUPD("SR",RORFILE,"F",2,DE,VT),U,2)
"RTN","RORUPD07",36,0)
 . . . S RORVALS("DV",RORFILE,DE,VT)=$P($G(GMPFLD(IN)),U,IP)
"RTN","RORUPD07",37,0)
 Q 0
"RTN","RORUPD07",38,0)
 ;
"RTN","RORUPD07",39,0)
 ;***** PROCESSING OF THE 'PROBLEM' FILE
"RTN","RORUPD07",40,0)
 ;
"RTN","RORUPD07",41,0)
 ; UPDSTART      Date of the earliest update
"RTN","RORUPD07",42,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD07",43,0)
 ;
"RTN","RORUPD07",44,0)
 ; Return values:
"RTN","RORUPD07",45,0)
 ;       <0  Error code
"RTN","RORUPD07",46,0)
 ;        0  Continue processing of the current patient
"RTN","RORUPD07",47,0)
 ;        1  Stop processing
"RTN","RORUPD07",48,0)
 ;
"RTN","RORUPD07",49,0)
PROBLEM(UPDSTART,PATIEN) ;
"RTN","RORUPD07",50,0)
 N RORFILE       ; File number
"RTN","RORUPD07",51,0)
 N RORPLST       ; List of patient problems
"RTN","RORUPD07",52,0)
 ;
"RTN","RORUPD07",53,0)
 N DATE,IS,LOCATION,PROBIENS,RC,TMP
"RTN","RORUPD07",54,0)
 S RORFILE=9000011
"RTN","RORUPD07",55,0)
 ;--- Check if the problem list has been modified in
"RTN","RORUPD07",56,0)
 ;    the data scan period of the patient.
"RTN","RORUPD07",57,0)
 Q:$$MOD^GMPLUTL3(PATIEN)<UPDSTART 0
"RTN","RORUPD07",58,0)
 ;--- Load a list of active problems
"RTN","RORUPD07",59,0)
 D ACTIVE^GMPLUTL(PATIEN,.RORPLST)
"RTN","RORUPD07",60,0)
 ;
"RTN","RORUPD07",61,0)
 ;--- Browse through the problems
"RTN","RORUPD07",62,0)
 S (IS,RC)=0
"RTN","RORUPD07",63,0)
 F  S IS=$O(RORPLST(IS))  Q:IS=""  D  Q:RC
"RTN","RORUPD07",64,0)
 . S PROBIENS=+RORPLST(IS,0)_","
"RTN","RORUPD07",65,0)
 . ;--- Load necessary data elements
"RTN","RORUPD07",66,0)
 . I $D(RORUPD("SR",RORFILE,"F"))>1  D  I TMP<0 D INCEC^RORUPDUT() Q
"RTN","RORUPD07",67,0)
 . . S TMP=$$LOAD(PROBIENS)  Q:TMP<0
"RTN","RORUPD07",68,0)
 . . S TMP=$$GETDE^RORUPDUT(RORFILE,130)
"RTN","RORUPD07",69,0)
 . . S LOCATION=$S(TMP>0:$$IEN4^RORUTL18(TMP),1:"")
"RTN","RORUPD07",70,0)
 . ;--- Ignore problems entered not in the data scan period
"RTN","RORUPD07",71,0)
 . S DATE=$$GETDE^RORUPDUT(RORFILE,118)
"RTN","RORUPD07",72,0)
 . Q:(DATE<UPDSTART)!(DATE'<RORUPD("DSEND"))
"RTN","RORUPD07",73,0)
 . ;--- Apply "before" rules
"RTN","RORUPD07",74,0)
 . S RC=$$APLRULES^RORUPDUT(RORFILE,PROBIENS,"B",DATE,$G(LOCATION))
"RTN","RORUPD07",75,0)
 . I RC  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD07",76,0)
 . ;--- Apply "after" rules
"RTN","RORUPD07",77,0)
 . S RC=$$APLRULES^RORUPDUT(RORFILE,PROBIENS,"A",DATE,$G(LOCATION))
"RTN","RORUPD07",78,0)
 . I RC  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD07",79,0)
 ;
"RTN","RORUPD07",80,0)
 D CLRDES^RORUPDUT(RORFILE)
"RTN","RORUPD07",81,0)
 Q RC
"RTN","RORUPD08")
0^135^B22389683
"RTN","RORUPD08",1,0)
RORUPD08 ;HCIOFO/SG - PROCESSING OF 'VISIT' & 'V POV' FILES  ; 10/27/05 11:08am
"RTN","RORUPD08",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPD08",3,0)
 ;
"RTN","RORUPD08",4,0)
 ; This routine uses the following IAs:
"RTN","RORUPD08",5,0)
 ;
"RTN","RORUPD08",6,0)
 ; #1554         POV^PXAPIIB
"RTN","RORUPD08",7,0)
 ; #1905         SELECTED^VSIT
"RTN","RORUPD08",8,0)
 ; #1906         LOOKUP^VSIT
"RTN","RORUPD08",9,0)
 ; #3990         $$CODEC^ICDCODE (supported)
"RTN","RORUPD08",10,0)
 ;
"RTN","RORUPD08",11,0)
 Q
"RTN","RORUPD08",12,0)
 ;
"RTN","RORUPD08",13,0)
 ;***** LOADS 'V POV' DATA ELEMENTS
"RTN","RORUPD08",14,0)
 ;
"RTN","RORUPD08",15,0)
 ; IENS          IENS of the current record
"RTN","RORUPD08",16,0)
 ;
"RTN","RORUPD08",17,0)
 ; Return values:
"RTN","RORUPD08",18,0)
 ;       <0  Error code
"RTN","RORUPD08",19,0)
 ;        0  Ok
"RTN","RORUPD08",20,0)
 ;
"RTN","RORUPD08",21,0)
LOADVPOV(IENS) ;
"RTN","RORUPD08",22,0)
 N RC  S RC=0
"RTN","RORUPD08",23,0)
 ;--- API #1
"RTN","RORUPD08",24,0)
 I $D(RORUPD("SR",RORFILE,"F",1))  D  Q:RC<0 RC
"RTN","RORUPD08",25,0)
 . S RC=$$LOADFLDS^RORUPDUT(RORFILE,IENS)
"RTN","RORUPD08",26,0)
 ;--- API #2
"RTN","RORUPD08",27,0)
 I $D(RORUPD("SR",RORFILE,"F",2))  D  Q:RC<0 RC
"RTN","RORUPD08",28,0)
 . N BUF,DE,IP,RORMSG,TMP,VT
"RTN","RORUPD08",29,0)
 . S BUF=$G(RORVPLST(+IENS)),DE=""
"RTN","RORUPD08",30,0)
 . F  S DE=$O(RORUPD("SR",RORFILE,"F",2,DE))  Q:DE=""  D
"RTN","RORUPD08",31,0)
 . . S VT=""
"RTN","RORUPD08",32,0)
 . . F  S VT=$O(RORUPD("SR",RORFILE,"F",2,DE,VT))  Q:VT=""  D
"RTN","RORUPD08",33,0)
 . . . S IP=+$P(RORUPD("SR",RORFILE,"F",2,DE,VT),U)
"RTN","RORUPD08",34,0)
 . . . S:IP>0 RORVALS("DV",RORFILE,DE,VT)=$P(BUF,U,IP)
"RTN","RORUPD08",35,0)
 . ;--- External value of the POV field (.01)
"RTN","RORUPD08",36,0)
 . I $D(RORUPD("SR",RORFILE,"F",2,112,"E"))  D  Q:RC<0
"RTN","RORUPD08",37,0)
 . . S TMP=+$P(BUF,U)  Q:TMP'>0
"RTN","RORUPD08",38,0)
 . . S TMP=$$CODEC^ICDCODE(TMP)
"RTN","RORUPD08",39,0)
 . . S RORVALS("DV",RORFILE,112,"E")=$S(TMP'<0:TMP,1:"")
"RTN","RORUPD08",40,0)
 Q 0
"RTN","RORUPD08",41,0)
 ;
"RTN","RORUPD08",42,0)
 ;***** LOAD 'VISIT' DATA ELEMENTS
"RTN","RORUPD08",43,0)
 ;
"RTN","RORUPD08",44,0)
 ; IENS          IENS of the current record
"RTN","RORUPD08",45,0)
 ;
"RTN","RORUPD08",46,0)
 ; Return values:
"RTN","RORUPD08",47,0)
 ;       <0  Error code
"RTN","RORUPD08",48,0)
 ;        0  Ok
"RTN","RORUPD08",49,0)
 ;
"RTN","RORUPD08",50,0)
LOADVSIT(IENS) ;
"RTN","RORUPD08",51,0)
 N RC  S RC=0
"RTN","RORUPD08",52,0)
 ;--- API #1
"RTN","RORUPD08",53,0)
 I $D(RORUPD("SR",RORFILE,"F",1))  D  Q:RC<0 RC
"RTN","RORUPD08",54,0)
 . S RC=$$LOADFLDS^RORUPDUT(RORFILE,IENS)
"RTN","RORUPD08",55,0)
 ;--- API #2
"RTN","RORUPD08",56,0)
 I $D(RORUPD("SR",RORFILE,"F",2))  D  Q:RC<0 RC
"RTN","RORUPD08",57,0)
 . N API,DE,IN,IP,TMP,VSIT,VT
"RTN","RORUPD08",58,0)
 . S TMP=$$LOOKUP^VSIT(+IENS,"B",0)
"RTN","RORUPD08",59,0)
 . I TMP<0  S API="$$LOOKUP^VSIT"  D  Q
"RTN","RORUPD08",60,0)
 . . S RC=$$ERROR^RORERR(-57,,,,TMP,API)
"RTN","RORUPD08",61,0)
 . ;---
"RTN","RORUPD08",62,0)
 . S DE=""
"RTN","RORUPD08",63,0)
 . F  S DE=$O(RORUPD("SR",RORFILE,"F",2,DE))  Q:DE=""  D
"RTN","RORUPD08",64,0)
 . . S VT=""
"RTN","RORUPD08",65,0)
 . . F  S VT=$O(RORUPD("SR",RORFILE,"F",2,DE,VT))  Q:VT=""  D
"RTN","RORUPD08",66,0)
 . . . S IP=+$P(RORUPD("SR",RORFILE,"F",2,DE,VT),U)  Q:IP'>0
"RTN","RORUPD08",67,0)
 . . . S IN=$P(RORUPD("SR",RORFILE,"F",2,DE,VT),U,2)
"RTN","RORUPD08",68,0)
 . . . S RORVALS("DV",RORFILE,DE,VT)=$P($G(VSIT(IN)),U,IP)
"RTN","RORUPD08",69,0)
 . ;---
"RTN","RORUPD08",70,0)
 Q 0
"RTN","RORUPD08",71,0)
 ;
"RTN","RORUPD08",72,0)
 ;***** PROCESSING OF THE 'VISIT' FILE
"RTN","RORUPD08",73,0)
 ;
"RTN","RORUPD08",74,0)
 ; UPDSTART      Date of the earliest update
"RTN","RORUPD08",75,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD08",76,0)
 ;
"RTN","RORUPD08",77,0)
 ; Return values:
"RTN","RORUPD08",78,0)
 ;       <0  Error code
"RTN","RORUPD08",79,0)
 ;        0  Continue processing of the current patient
"RTN","RORUPD08",80,0)
 ;        1  Stop processing
"RTN","RORUPD08",81,0)
 ;
"RTN","RORUPD08",82,0)
 ; The function uses the ^TMP("VSIT",$J) global node.
"RTN","RORUPD08",83,0)
 ;
"RTN","RORUPD08",84,0)
VISIT(UPDSTART,PATIEN) ;
"RTN","RORUPD08",85,0)
 N RORFILE       ; File number
"RTN","RORUPD08",86,0)
 ;
"RTN","RORUPD08",87,0)
 N DATE,DSEND,IEN,LOCATION,RC,TMP,VISIENS
"RTN","RORUPD08",88,0)
 S RORFILE=9000010,DSEND=RORUPD("DSEND")
"RTN","RORUPD08",89,0)
 ;--- Check the event references if the events are enabled
"RTN","RORUPD08",90,0)
 I $G(RORUPD("FLAGS"))["E"  D  Q:RC'>0 RC
"RTN","RORUPD08",91,0)
 . S RC=$$GET^RORUPP02(PATIEN,2,.UPDSTART,.DSEND)
"RTN","RORUPD08",92,0)
 . S:RC>1 UPDSTART=UPDSTART\1,DSEND=$$FMADD^XLFDT(DSEND\1,1)
"RTN","RORUPD08",93,0)
 ;--- Get a list of visits
"RTN","RORUPD08",94,0)
 D SELECTED^VSIT(PATIEN,UPDSTART,DSEND)
"RTN","RORUPD08",95,0)
 ;
"RTN","RORUPD08",96,0)
 ;--- Browse through the visits
"RTN","RORUPD08",97,0)
 S (IEN,RC)=0
"RTN","RORUPD08",98,0)
 F  S IEN=$O(^TMP("VSIT",$J,IEN))  Q:IEN=""  D  Q:RC
"RTN","RORUPD08",99,0)
 . S VISIENS=IEN_",",TMP=+$O(^TMP("VSIT",$J,IEN,""))
"RTN","RORUPD08",100,0)
 . S DATE=$P($G(^TMP("VSIT",$J,IEN,TMP)),U)
"RTN","RORUPD08",101,0)
 . ;--- Load necessary data elements
"RTN","RORUPD08",102,0)
 . I $D(RORUPD("SR",RORFILE,"F"))>1  D  I TMP<0 D INCEC^RORUPDUT() Q
"RTN","RORUPD08",103,0)
 . . S TMP=$$LOADVSIT(VISIENS)  Q:TMP<0
"RTN","RORUPD08",104,0)
 . . S LOCATION=$$GETDE^RORUPDUT(RORFILE,129)
"RTN","RORUPD08",105,0)
 . ;--- Apply "before" rules
"RTN","RORUPD08",106,0)
 . S RC=$$APLRULES^RORUPDUT(RORFILE,VISIENS,"B",DATE,$G(LOCATION))
"RTN","RORUPD08",107,0)
 . I RC  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD08",108,0)
 . ;
"RTN","RORUPD08",109,0)
 . ;--- Process V POV file
"RTN","RORUPD08",110,0)
 . I $D(RORUPD("SR",9000010.07))  D  I RC  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD08",111,0)
 . . S RC=$$VPOV(IEN,DATE,$G(LOCATION))
"RTN","RORUPD08",112,0)
 . ;
"RTN","RORUPD08",113,0)
 . ;--- Apply "after" rules
"RTN","RORUPD08",114,0)
 . S RC=$$APLRULES^RORUPDUT(RORFILE,VISIENS,"A",DATE,$G(LOCATION))
"RTN","RORUPD08",115,0)
 . I RC  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD08",116,0)
 ;
"RTN","RORUPD08",117,0)
 K ^TMP("VSIT",$J)
"RTN","RORUPD08",118,0)
 D CLRDES^RORUPDUT(RORFILE)
"RTN","RORUPD08",119,0)
 Q RC
"RTN","RORUPD08",120,0)
 ;
"RTN","RORUPD08",121,0)
 ;***** PROCESSING OF THE 'V POV' FILE
"RTN","RORUPD08",122,0)
 ;
"RTN","RORUPD08",123,0)
 ; VISITIEN      IEN of the visit (in the "VISIT" file)
"RTN","RORUPD08",124,0)
 ; DATE          Visit date
"RTN","RORUPD08",125,0)
 ; LOCATION      Institution IEN
"RTN","RORUPD08",126,0)
 ;
"RTN","RORUPD08",127,0)
 ; Return values:
"RTN","RORUPD08",128,0)
 ;       <0  Error code
"RTN","RORUPD08",129,0)
 ;        0  Continue processing of the current patient
"RTN","RORUPD08",130,0)
 ;        1  Stop processing
"RTN","RORUPD08",131,0)
 ;
"RTN","RORUPD08",132,0)
VPOV(VISITIEN,DATE,LOCATION) ;
"RTN","RORUPD08",133,0)
 N RORFILE       ; File number
"RTN","RORUPD08",134,0)
 N RORVPLST      ; List of records in the file
"RTN","RORUPD08",135,0)
 ;
"RTN","RORUPD08",136,0)
 N IEN,NODE,RC,TMP,VPIENS
"RTN","RORUPD08",137,0)
 S RORFILE=9000010.07
"RTN","RORUPD08",138,0)
 D CLRVALS^RORUPDUT(RORFILE)
"RTN","RORUPD08",139,0)
 ;--- Get a list of records
"RTN","RORUPD08",140,0)
 D POV^PXAPIIB(VISITIEN,.RORVPLST)
"RTN","RORUPD08",141,0)
 ;
"RTN","RORUPD08",142,0)
 S (IEN,RC)=0
"RTN","RORUPD08",143,0)
 F  S IEN=$O(RORVPLST(IEN))  Q:IEN=""  D  Q:RC
"RTN","RORUPD08",144,0)
 . S VPIENS=IEN_","
"RTN","RORUPD08",145,0)
 . ;--- Load necessary data elements
"RTN","RORUPD08",146,0)
 . I $D(RORUPD("SR",RORFILE,"F"))>1  D  I TMP<0 D INCEC^RORUPDUT() Q
"RTN","RORUPD08",147,0)
 . . S TMP=$$LOADVPOV(VPIENS)
"RTN","RORUPD08",148,0)
 . ;--- Apply "before" rules
"RTN","RORUPD08",149,0)
 . S RC=$$APLRULES^RORUPDUT(RORFILE,VPIENS,"B",DATE,LOCATION)
"RTN","RORUPD08",150,0)
 . I RC  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD08",151,0)
 . ;--- Apply "after" rules
"RTN","RORUPD08",152,0)
 . S RC=$$APLRULES^RORUPDUT(RORFILE,VPIENS,"A",DATE,LOCATION)
"RTN","RORUPD08",153,0)
 . I RC  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD08",154,0)
 ;
"RTN","RORUPD08",155,0)
 D CLRDES^RORUPDUT(RORFILE)
"RTN","RORUPD08",156,0)
 Q RC
"RTN","RORUPD09")
0^136^B9474836
"RTN","RORUPD09",1,0)
RORUPD09 ;HCIOFO/SG - PROCESSING OF THE 'PTF' FILE  ; 8/3/05 9:50am
"RTN","RORUPD09",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPD09",3,0)
 ;
"RTN","RORUPD09",4,0)
 ; This routine uses the following IAs:
"RTN","RORUPD09",5,0)
 ;
"RTN","RORUPD09",6,0)
 ; #3157         RPC^DGPTFAPI
"RTN","RORUPD09",7,0)
 ; #3545         Access to the "AAD" cross-reference and the field 80
"RTN","RORUPD09",8,0)
 ;
"RTN","RORUPD09",9,0)
 Q
"RTN","RORUPD09",10,0)
 ;
"RTN","RORUPD09",11,0)
 ;***** LOADS DATA ELEMENT VALUES
"RTN","RORUPD09",12,0)
 ;
"RTN","RORUPD09",13,0)
 ; IENS          IENS of the current record
"RTN","RORUPD09",14,0)
 ;
"RTN","RORUPD09",15,0)
 ; Return values:
"RTN","RORUPD09",16,0)
 ;       <0  Error code
"RTN","RORUPD09",17,0)
 ;        0  Ok
"RTN","RORUPD09",18,0)
 ;
"RTN","RORUPD09",19,0)
LOAD(IENS) ;
"RTN","RORUPD09",20,0)
 N RC  S RC=0
"RTN","RORUPD09",21,0)
 ;--- API #1
"RTN","RORUPD09",22,0)
 I $D(RORUPD("SR",RORFILE,"F",1))  D  Q:RC<0 RC
"RTN","RORUPD09",23,0)
 . S RC=$$LOADFLDS^RORUPDUT(RORFILE,IENS)
"RTN","RORUPD09",24,0)
 ;--- API #2
"RTN","RORUPD09",25,0)
 I $D(RORUPD("SR",RORFILE,"F",2))  D  Q:RC<0 RC
"RTN","RORUPD09",26,0)
 . N API,DE,IN,IP,RORBUF,VT
"RTN","RORUPD09",27,0)
 . D RPC^DGPTFAPI(.RORBUF,+IENS)
"RTN","RORUPD09",28,0)
 . I $G(RORBUF(0))<0  S API="RPC^DGPTFAPI"  D  Q
"RTN","RORUPD09",29,0)
 . . S RC=$$ERROR^RORERR(-57,,,,RORBUF(0),API)
"RTN","RORUPD09",30,0)
 . ;---
"RTN","RORUPD09",31,0)
 . S DE=""
"RTN","RORUPD09",32,0)
 . F  S DE=$O(RORUPD("SR",RORFILE,"F",2,DE))  Q:DE=""  D
"RTN","RORUPD09",33,0)
 . . S VT=""
"RTN","RORUPD09",34,0)
 . . F  S VT=$O(RORUPD("SR",RORFILE,"F",2,DE,VT))  Q:VT=""  D
"RTN","RORUPD09",35,0)
 . . . S IP=+$P(RORUPD("SR",RORFILE,"F",2,DE,VT),U,1)  Q:IP'>0
"RTN","RORUPD09",36,0)
 . . . S IN=+$P(RORUPD("SR",RORFILE,"F",2,DE,VT),U,2)
"RTN","RORUPD09",37,0)
 . . . S RORVALS("DV",RORFILE,DE,VT)=$P($G(RORBUF(IN)),U,IP)
"RTN","RORUPD09",38,0)
 Q 0
"RTN","RORUPD09",39,0)
 ;
"RTN","RORUPD09",40,0)
 ;***** PROCESSING OF THE 'PTF' FILE
"RTN","RORUPD09",41,0)
 ;
"RTN","RORUPD09",42,0)
 ; UPDSTART      Date of the earliest update
"RTN","RORUPD09",43,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD09",44,0)
 ;
"RTN","RORUPD09",45,0)
 ; Return values:
"RTN","RORUPD09",46,0)
 ;       <0  Error code
"RTN","RORUPD09",47,0)
 ;        0  Continue processing of the current patient
"RTN","RORUPD09",48,0)
 ;        1  Stop processing
"RTN","RORUPD09",49,0)
 ;
"RTN","RORUPD09",50,0)
PTF(UPDSTART,PATIEN) ;
"RTN","RORUPD09",51,0)
 N RORFILE       ; File number
"RTN","RORUPD09",52,0)
 ;
"RTN","RORUPD09",53,0)
 N ADMDT,ADMIENS,EDT,IEN,LOCATION,NODE,RC,TMP
"RTN","RORUPD09",54,0)
 S RORFILE=45,EDT=RORUPD("DSEND")
"RTN","RORUPD09",55,0)
 ;--- Check the event references if the events are enabled
"RTN","RORUPD09",56,0)
 I $G(RORUPD("FLAGS"))["E"  D  Q:RC'>0 RC
"RTN","RORUPD09",57,0)
 . S RC=$$GET^RORUPP02(PATIEN,3,.UPDSTART,.EDT)
"RTN","RORUPD09",58,0)
 . S:RC>1 UPDSTART=UPDSTART\1,EDT=$$FMADD^XLFDT(EDT\1,1)
"RTN","RORUPD09",59,0)
 ;--- Subtract 1 second from the start date to include
"RTN","RORUPD09",60,0)
 ;    it into the interval
"RTN","RORUPD09",61,0)
 S ADMDT=$$FMADD^XLFDT(UPDSTART,,,,-1)
"RTN","RORUPD09",62,0)
 ;
"RTN","RORUPD09",63,0)
 ;--- Browse through the admissions
"RTN","RORUPD09",64,0)
 S NODE=RORUPD("ROOT",RORFILE),NODE=$NA(@NODE@("AAD",PATIEN))
"RTN","RORUPD09",65,0)
 S RC=0
"RTN","RORUPD09",66,0)
 F  S ADMDT=$O(@NODE@(ADMDT))  Q:(ADMDT="")!(ADMDT'<EDT)  D  Q:RC
"RTN","RORUPD09",67,0)
 . S IEN=""
"RTN","RORUPD09",68,0)
 . F  S IEN=$O(@NODE@(ADMDT,IEN))  Q:IEN=""  D  Q:RC
"RTN","RORUPD09",69,0)
 . . S ADMIENS=IEN_","
"RTN","RORUPD09",70,0)
 . . ;--- Load necessary data elements
"RTN","RORUPD09",71,0)
 . . I $D(RORUPD("SR",RORFILE,"F"))>1  D  I TMP<0 D INCEC^RORUPDUT() Q
"RTN","RORUPD09",72,0)
 . . . S TMP=$$LOAD(ADMIENS)
"RTN","RORUPD09",73,0)
 . . . S TMP=$$GETDE^RORUPDUT(45,131)_$$GETDE^RORUPDUT(45,132)
"RTN","RORUPD09",74,0)
 . . . S LOCATION=$S(TMP'="":$$IEN^XUAF4(TMP),1:"")
"RTN","RORUPD09",75,0)
 . . ;--- Apply "before" rules
"RTN","RORUPD09",76,0)
 . . S RC=$$APLRULES^RORUPDUT(RORFILE,ADMIENS,"B",ADMDT,$G(LOCATION))
"RTN","RORUPD09",77,0)
 . . I RC  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD09",78,0)
 . . ;--- Apply "after" rules
"RTN","RORUPD09",79,0)
 . . S RC=$$APLRULES^RORUPDUT(RORFILE,ADMIENS,"A",ADMDT,$G(LOCATION))
"RTN","RORUPD09",80,0)
 . . I RC  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD09",81,0)
 ;
"RTN","RORUPD09",82,0)
 D CLRDES^RORUPDUT(RORFILE)
"RTN","RORUPD09",83,0)
 Q RC
"RTN","RORUPD09",84,0)
 ;
"RTN","RORUPD09",85,0)
 ;***** IMPLEMENTATION OF THE 'VA HEPC PTF' RULE
"RTN","RORUPD09",86,0)
PTFRULE(ICD) ;
"RTN","RORUPD09",87,0)
 N DATELMT,RC
"RTN","RORUPD09",88,0)
 S RC=0
"RTN","RORUPD09",89,0)
 F DATELMT=111,101,102,103,104,105,106,107,108,109,110  D  Q:RC
"RTN","RORUPD09",90,0)
 . S RC=ICD[(","_$G(RORVALS("DV",45,DATELMT,"E"))_",")
"RTN","RORUPD09",91,0)
 Q RC
"RTN","RORUPD50")
0^137^B14024739
"RTN","RORUPD50",1,0)
RORUPD50 ;HCIOFO/SG - UPDATE THE PATIENT IN THE REGISTRIES  ; 8/2/05 9:14am
"RTN","RORUPD50",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPD50",3,0)
 ;
"RTN","RORUPD50",4,0)
 Q
"RTN","RORUPD50",5,0)
 ;
"RTN","RORUPD50",6,0)
 ;***** ADDS THE PATIENT TO THE REGISTRY
"RTN","RORUPD50",7,0)
 ;
"RTN","RORUPD50",8,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD50",9,0)
 ; REGIEN        Registry IEN
"RTN","RORUPD50",10,0)
 ;
"RTN","RORUPD50",11,0)
 ; [ROR8RULS]    Closed root of a local array containing list of
"RTN","RORUPD50",12,0)
 ;               triggered selection rules:
"RTN","RORUPD50",13,0)
 ;                 @ROR8RULS@(RuleIEN)=Date
"RTN","RORUPD50",14,0)
 ;               If this parameter is not defined or equals to
"RTN","RORUPD50",15,0)
 ;               an empty string, selection rules are loaded from
"RTN","RORUPD50",16,0)
 ;               corresponding sub-node of the ^TMP("RORUPD",$J,"U").
"RTN","RORUPD50",17,0)
 ;
"RTN","RORUPD50",18,0)
 ; [[.]DOD]      Date of death. If this parameter is undefined,
"RTN","RORUPD50",19,0)
 ;               its value will be taken from the ROR PATIENT file.
"RTN","RORUPD50",20,0)
 ;               If you are going to call this function several times
"RTN","RORUPD50",21,0)
 ;               for the same patient (for different registries),
"RTN","RORUPD50",22,0)
 ;               pass a reference to undefined local variable (the
"RTN","RORUPD50",23,0)
 ;               DOD will be read from the file only once).
"RTN","RORUPD50",24,0)
 ;
"RTN","RORUPD50",25,0)
 ; Return values:
"RTN","RORUPD50",26,0)
 ;       <0  Error code
"RTN","RORUPD50",27,0)
 ;        0  Ok
"RTN","RORUPD50",28,0)
 ;        1  Patient has already existed in the registry
"RTN","RORUPD50",29,0)
 ;
"RTN","RORUPD50",30,0)
ADD(PATIEN,REGIEN,ROR8RULS,DOD) ;
"RTN","RORUPD50",31,0)
 N I,IENS,IENS01,RC,RORFDA,RORIEN,RORMSG,RULEIEN,TMP
"RTN","RORUPD50",32,0)
 ;--- Quit if the patient is already in the registry
"RTN","RORUPD50",33,0)
 Q:$$PRRIEN^RORUTL01(PATIEN,REGIEN)>0 1
"RTN","RORUPD50",34,0)
 ;
"RTN","RORUPD50",35,0)
 ;--- Prepare registry data
"RTN","RORUPD50",36,0)
 K RORFDA  S IENS="+1,"
"RTN","RORUPD50",37,0)
 S RORFDA(798,IENS,.01)=PATIEN           ; Patient Name
"RTN","RORUPD50",38,0)
 S RORFDA(798,IENS,.02)=REGIEN           ; Registry
"RTN","RORUPD50",39,0)
 S RORFDA(798,IENS,3)=4                  ; Pending
"RTN","RORUPD50",40,0)
 S RORFDA(798,IENS,4)=1                  ; Update Demographics
"RTN","RORUPD50",41,0)
 S RORFDA(798,IENS,5)=1                  ; Update Local Data
"RTN","RORUPD50",42,0)
 S RORFDA(798,IENS,11)=1                 ; Don't Send
"RTN","RORUPD50",43,0)
 ;--- Get the date of death
"RTN","RORUPD50",44,0)
 S:'($D(DOD)#10) DOD=$$GET1^DIQ(798.4,PATIEN_",",.351,"I",,"RORMSG")
"RTN","RORUPD50",45,0)
 ;--- Load list of triggered rules
"RTN","RORUPD50",46,0)
 S:$G(ROR8RULS)="" ROR8RULS=$NA(@RORUPDPI@("U",PATIEN,2,REGIEN))
"RTN","RORUPD50",47,0)
 S RULEIEN=""
"RTN","RORUPD50",48,0)
 F I=1:1  S RULEIEN=$O(@ROR8RULS@(RULEIEN))  Q:RULEIEN=""  D
"RTN","RORUPD50",49,0)
 . S IENS01="+"_(1000+I)_","_IENS
"RTN","RORUPD50",50,0)
 . S RORFDA(798.01,IENS01,.01)=RULEIEN  ; SELECTION RULE
"RTN","RORUPD50",51,0)
 . S TMP=$P(@ROR8RULS@(RULEIEN),U)\1
"RTN","RORUPD50",52,0)
 . S:TMP>0 RORFDA(798.01,IENS01,1)=TMP  ; DATE
"RTN","RORUPD50",53,0)
 . S TMP=+$P(@ROR8RULS@(RULEIEN),U,2)
"RTN","RORUPD50",54,0)
 . S:TMP>0 RORFDA(798.01,IENS01,2)=TMP  ; LOCATION
"RTN","RORUPD50",55,0)
 ;
"RTN","RORUPD50",56,0)
 ;--- Registry update transaction
"RTN","RORUPD50",57,0)
 S RC=0  D
"RTN","RORUPD50",58,0)
 . ;--- Call "before update" entry point
"RTN","RORUPD50",59,0)
 . S ENTRY=$G(RORUPD("UPD",REGIEN,1))
"RTN","RORUPD50",60,0)
 . I ENTRY'=""  X "S RC="_ENTRY_"(.RORFDA,PATIEN,REGIEN)"  Q:RC<0
"RTN","RORUPD50",61,0)
 . ;--- Make sure that the DON'T SEND flag is set for 'test' patient
"RTN","RORUPD50",62,0)
 . S:$$TESTPAT^RORUTL01(PATIEN) RORFDA(798,IENS,11)=1
"RTN","RORUPD50",63,0)
 . ;--- Update the registry
"RTN","RORUPD50",64,0)
 . D UPDATE^DIE(,"RORFDA","RORIEN","RORMSG")
"RTN","RORUPD50",65,0)
 . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9)  Q
"RTN","RORUPD50",66,0)
 . ;--- Call "after update" entry point
"RTN","RORUPD50",67,0)
 . S ENTRY=$G(RORUPD("UPD",REGIEN,2))
"RTN","RORUPD50",68,0)
 . I ENTRY'=""  X "S RC="_ENTRY_"(RORIEN(1),PATIEN,REGIEN)"  Q:RC<0
"RTN","RORUPD50",69,0)
 Q:RC'<0 0
"RTN","RORUPD50",70,0)
 ;
"RTN","RORUPD50",71,0)
 ;--- Rollback the update in case of error(s)
"RTN","RORUPD50",72,0)
 N DA,DIK
"RTN","RORUPD50",73,0)
 S DIK=$$ROOT^DILFD(798),DA=$G(RORIEN(1))
"RTN","RORUPD50",74,0)
 D:DA>0 ^DIK
"RTN","RORUPD50",75,0)
 Q RC
"RTN","RORUPD50",76,0)
 ;
"RTN","RORUPD50",77,0)
 ;***** ADDS PATIENT DATA TO THE 'ROR PATIENT' FILE
"RTN","RORUPD50",78,0)
 ;
"RTN","RORUPD50",79,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD50",80,0)
 ;
"RTN","RORUPD50",81,0)
 ; Return values:
"RTN","RORUPD50",82,0)
 ;       <0  Error code
"RTN","RORUPD50",83,0)
 ;        0  Ok
"RTN","RORUPD50",84,0)
 ;        1  Patient data have already existed
"RTN","RORUPD50",85,0)
 ;
"RTN","RORUPD50",86,0)
ADDPDATA(PATIEN) ;
"RTN","RORUPD50",87,0)
 N IENS,RC,RORBUF,RORPAT,RORIEN,RORMSG
"RTN","RORUPD50",88,0)
 ;--- Try to find patient data
"RTN","RORUPD50",89,0)
 D FIND^DIC(798.4,,"@","QUX",PATIEN,1,"B",,,"RORBUF","RORMSG")
"RTN","RORUPD50",90,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.4)
"RTN","RORUPD50",91,0)
 ;--- Patient data already exists in the file
"RTN","RORUPD50",92,0)
 Q:$G(RORBUF("DILIST",0)) 1
"RTN","RORUPD50",93,0)
 ;--- Check if the patient record in the file #2 is valid
"RTN","RORUPD50",94,0)
 S RC=$$CHKPTR^RORUTL05(PATIEN)  Q:RC<0 RC
"RTN","RORUPD50",95,0)
 ;--- Prepare patient data
"RTN","RORUPD50",96,0)
 S IENS="+1,"
"RTN","RORUPD50",97,0)
 S RC=$$PATDATA^RORUPD52(PATIEN_",",.RORPAT,IENS)  Q:RC<0 RC
"RTN","RORUPD50",98,0)
 S RORIEN(1)=PATIEN                      ; IEN of the new record
"RTN","RORUPD50",99,0)
 S RORPAT(798.4,IENS,.01)=PATIEN         ; Patient Name
"RTN","RORUPD50",100,0)
 ;--- Add the patient record to the file
"RTN","RORUPD50",101,0)
 D UPDATE^DIE(,"RORPAT","RORIEN","RORMSG")
"RTN","RORUPD50",102,0)
 I $G(DIERR)  D  Q:RC
"RTN","RORUPD50",103,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,PATIEN,798.4)
"RTN","RORUPD50",104,0)
 Q 0
"RTN","RORUPD50",105,0)
 ;
"RTN","RORUPD50",106,0)
 ;***** ADDS THE PATIENT TO MARKED REGISTRIES
"RTN","RORUPD50",107,0)
 ;
"RTN","RORUPD50",108,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD50",109,0)
 ;
"RTN","RORUPD50",110,0)
 ; Return values:
"RTN","RORUPD50",111,0)
 ;       <0  Error code
"RTN","RORUPD50",112,0)
 ;        0  Patient should not be added to the registry
"RTN","RORUPD50",113,0)
 ;       >0  Patient has been added to the registry
"RTN","RORUPD50",114,0)
 ;
"RTN","RORUPD50",115,0)
UPDREG(PATIEN) ;
"RTN","RORUPD50",116,0)
 N DOD,ENTRY,INCTVDT,RC,REGIEN
"RTN","RORUPD50",117,0)
 ;--- Check if patient should be added to any registry
"RTN","RORUPD50",118,0)
 Q:$D(@RORUPDPI@("U",PATIEN,2))<10 0
"RTN","RORUPD50",119,0)
 ;--- Add patient data
"RTN","RORUPD50",120,0)
 S RC=$$ADDPDATA(PATIEN)  Q:RC<0 RC
"RTN","RORUPD50",121,0)
 ;--- Update all marked registries
"RTN","RORUPD50",122,0)
 S REGIEN="",RC=0
"RTN","RORUPD50",123,0)
 F  D  Q:REGIEN=""  S RC=$$ADD(PATIEN,REGIEN,,.DOD)  Q:RC<0
"RTN","RORUPD50",124,0)
 . S REGIEN=$O(@RORUPDPI@("U",PATIEN,2,REGIEN))
"RTN","RORUPD50",125,0)
 Q $S(RC<0:RC,1:1)
"RTN","RORUPD51")
0^138^B43538631
"RTN","RORUPD51",1,0)
RORUPD51 ;HCIOFO/SG - UPDATE PATIENT'S DEMOGRAPHIC DATA (1) ; 1/24/06 11:44am
"RTN","RORUPD51",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPD51",3,0)
 ;
"RTN","RORUPD51",4,0)
 Q
"RTN","RORUPD51",5,0)
 ;
"RTN","RORUPD51",6,0)
 ;***** MARKS REGISTRIES (UPDATE DEMOGRAPHICS)
"RTN","RORUPD51",7,0)
 ;
"RTN","RORUPD51",8,0)
 ; PTIEN         Patient IEN
"RTN","RORUPD51",9,0)
 ; [DOD]         Date of death
"RTN","RORUPD51",10,0)
 ;
"RTN","RORUPD51",11,0)
 ; Return Values:
"RTN","RORUPD51",12,0)
 ;       <0  Error code
"RTN","RORUPD51",13,0)
 ;        0  Ok
"RTN","RORUPD51",14,0)
 ;
"RTN","RORUPD51",15,0)
MARKREGS(PTIEN,DOD) ;
"RTN","RORUPD51",16,0)
 N ACTIVE,ECNT,I,IENS,RC,RI,TMP
"RTN","RORUPD51",17,0)
 N RORBUF,RORFDA,RORMSG,RORSRC
"RTN","RORUPD51",18,0)
 ;--- Compile a list of associated registries
"RTN","RORUPD51",19,0)
 D FIND^DIC(798,,"@","QUX",PTIEN,,"B",,,"RORBUF","RORMSG")
"RTN","RORUPD51",20,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,PTIEN,798)
"RTN","RORUPD51",21,0)
 ;--- Mark patient records of the registries
"RTN","RORUPD51",22,0)
 S RI="",ECNT=0
"RTN","RORUPD51",23,0)
 F  S RI=$O(RORBUF("DILIST",2,RI))  Q:RI=""  D  L -^RORDATA(798,+IENS)
"RTN","RORUPD51",24,0)
 . S IENS=RORBUF("DILIST",2,RI)_","
"RTN","RORUPD51",25,0)
 . K RORFDA,RORSRC
"RTN","RORUPD51",26,0)
 . ;--- Try to lock the record; if this fails, continue anyway
"RTN","RORUPD51",27,0)
 . L +^RORDATA(798,+IENS):1
"RTN","RORUPD51",28,0)
 . ;--- Load the field values
"RTN","RORUPD51",29,0)
 . D GETS^DIQ(798,IENS,"4;8","EI","RORSRC","RORMSG")
"RTN","RORUPD51",30,0)
 . I $G(DIERR)  D  S ECNT=ECNT+1  Q
"RTN","RORUPD51",31,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,PTIEN,798,IENS)
"RTN","RORUPD51",32,0)
 . S ACTIVE=+$G(RORSRC(798,IENS,8,"E"))
"RTN","RORUPD51",33,0)
 . ;--- Do not mark again if already marked
"RTN","RORUPD51",34,0)
 . I '$G(RORSRC(798,IENS,4,"I"))  S RC=0  D  Q:RC<0
"RTN","RORUPD51",35,0)
 . . ;--- Mark only active records
"RTN","RORUPD51",36,0)
 . . S:ACTIVE RORFDA(798,IENS,4)=1
"RTN","RORUPD51",37,0)
 . ;--- Update registry data record
"RTN","RORUPD51",38,0)
 . I $D(RORFDA)>1  S RC=0  D  Q:RC<0
"RTN","RORUPD51",39,0)
 . . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORUPD51",40,0)
 . . I $G(DIERR)  D  S ECNT=ECNT+1
"RTN","RORUPD51",41,0)
 . . . S RC=$$DBS^RORERR("RORMSG",-9,,PTIEN,798,IENS)
"RTN","RORUPD51",42,0)
 Q $S(ECNT>0:-9,1:0)
"RTN","RORUPD51",43,0)
 ;
"RTN","RORUPD51",44,0)
 ;***** PROCESSES THE MERGED PATIENT RECORD
"RTN","RORUPD51",45,0)
 ;
"RTN","RORUPD51",46,0)
 ; DFN           IEN of the merged record (medrged from)
"RTN","RORUPD51",47,0)
 ; NEWDFN        New patient IEN (merged to)
"RTN","RORUPD51",48,0)
 ;
"RTN","RORUPD51",49,0)
 ; Return values:
"RTN","RORUPD51",50,0)
 ;       <0  Error code
"RTN","RORUPD51",51,0)
 ;        0  Ok
"RTN","RORUPD51",52,0)
 ;
"RTN","RORUPD51",53,0)
MERGE(DFN,NEWDFN) ;
"RTN","RORUPD51",54,0)
 N DA,DIK,DTNEW,DTOLD,IEN,IENS,IR,PTIEN,REGIEN,REGLST,RORBUF,RORFDA,RORMSG,TMP
"RTN","RORUPD51",55,0)
 D LOG^RORERR(-111,,,DFN,NEWDFN)
"RTN","RORUPD51",56,0)
 ;=== Get the lists of registry records associated with the
"RTN","RORUPD51",57,0)
 ;=== merged from ("from") and merged to ("to") patient data
"RTN","RORUPD51",58,0)
 F PTIEN=DFN,NEWDFN  D  Q:RC<0
"RTN","RORUPD51",59,0)
 . K RORBUF,RORMSG
"RTN","RORUPD51",60,0)
 . D FIND^DIC(798,,"@;.02I;1I","QUX",PTIEN,,"B",,,"RORBUF","RORMSG")
"RTN","RORUPD51",61,0)
 . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,PTIEN,798)  Q
"RTN","RORUPD51",62,0)
 . S IR=0
"RTN","RORUPD51",63,0)
 . F  S IR=$O(RORBUF("DILIST",2,IR))  Q:IR'>0  D  Q:RC<0
"RTN","RORUPD51",64,0)
 . . S IEN=+RORBUF("DILIST",2,IR)
"RTN","RORUPD51",65,0)
 . . S REGIEN=+$G(RORBUF("DILIST","ID",IR,.02))
"RTN","RORUPD51",66,0)
 . . I REGIEN'>0  S RC=$$ERROR^RORERR(-95,,,PTIEN,798,IEN_",",.02)  Q
"RTN","RORUPD51",67,0)
 . . S TMP=+$G(RORBUF("DILIST","ID",IR,1))
"RTN","RORUPD51",68,0)
 . . I TMP'>0  S RC=$$ERROR^RORERR(-95,,,PTIEN,798,IEN_",",1)  Q
"RTN","RORUPD51",69,0)
 . . S REGLST(PTIEN,REGIEN)=IEN_U_TMP
"RTN","RORUPD51",70,0)
 Q:RC<0 RC
"RTN","RORUPD51",71,0)
 ;=== Compare the "from" and "to" registry records
"RTN","RORUPD51",72,0)
 S REGIEN=0
"RTN","RORUPD51",73,0)
 F  S REGIEN=$O(REGLST(DFN,REGIEN))  Q:REGIEN'>0  D
"RTN","RORUPD51",74,0)
 . K RORFDA,RORMSG  S RC=0
"RTN","RORUPD51",75,0)
 . S DTOLD=+$P(REGLST(DFN,REGIEN),U,2)
"RTN","RORUPD51",76,0)
 . S DTNEW=+$P($G(REGLST(NEWDFN,REGIEN)),U,2)
"RTN","RORUPD51",77,0)
 . I (DTNEW'>0)!(DTOLD<DTNEW)  D  Q:RC<0
"RTN","RORUPD51",78,0)
 . . ;--- Make sure that the "to" patient has a record
"RTN","RORUPD51",79,0)
 . . ;--- in the ROR PATIENT file.
"RTN","RORUPD51",80,0)
 . . S RC=$$ADDPDATA^RORUPD50(NEWDFN)  Q:RC<0
"RTN","RORUPD51",81,0)
 . . ;--- Replace the .01 value in the "from" registry record with
"RTN","RORUPD51",82,0)
 . . ;    the new patient pointer since there is either no other
"RTN","RORUPD51",83,0)
 . . ;--- record for this patient or it is newer than the "from" one.
"RTN","RORUPD51",84,0)
 . . S IENS=+$P(REGLST(DFN,REGIEN),U)_","
"RTN","RORUPD51",85,0)
 . . S RORFDA(798,IENS,.01)=NEWDFN
"RTN","RORUPD51",86,0)
 . . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORUPD51",87,0)
 . . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,DFN,798,IENS)  Q
"RTN","RORUPD51",88,0)
 . . ;--- Delete the "to" registry record. It was created after
"RTN","RORUPD51",89,0)
 . . ;--- the original ("from") one and we should keep the latter.
"RTN","RORUPD51",90,0)
 . . S DA=+$P($G(REGLST(NEWDFN,REGIEN)),U)
"RTN","RORUPD51",91,0)
 . . I DA>0  S DIK=$$ROOT^DILFD(798)  D ^DIK
"RTN","RORUPD51",92,0)
 . E  D
"RTN","RORUPD51",93,0)
 . . ;--- Delete the "from" registry record since
"RTN","RORUPD51",94,0)
 . . ;--- the "to" record is actually older
"RTN","RORUPD51",95,0)
 . . S DIK=$$ROOT^DILFD(798),DA=+$P(REGLST(DFN,REGIEN),U)  D ^DIK
"RTN","RORUPD51",96,0)
 . ;--- Indicate successful merge
"RTN","RORUPD51",97,0)
 . K REGLST(DFN,REGIEN)
"RTN","RORUPD51",98,0)
 ;=== Done
"RTN","RORUPD51",99,0)
 Q 0
"RTN","RORUPD51",100,0)
 ;
"RTN","RORUPD51",101,0)
 ;***** SCANS PATIENTS AND UPDATES DEMOGRAPHIC DATA (IF NECESSARY)
"RTN","RORUPD51",102,0)
 ;
"RTN","RORUPD51",103,0)
 ; .REGLST       Reference to a local array containing
"RTN","RORUPD51",104,0)
 ;               registry names as subscripts
"RTN","RORUPD51",105,0)
 ;
"RTN","RORUPD51",106,0)
 ; Return Values:
"RTN","RORUPD51",107,0)
 ;       <0  Error code
"RTN","RORUPD51",108,0)
 ;        0  Ok
"RTN","RORUPD51",109,0)
 ;
"RTN","RORUPD51",110,0)
UPDDEM(REGLST) ;
"RTN","RORUPD51",111,0)
 N CNT,IR,PTIEN,RC,REGIEN,REGNAME,ROOT,SCR,UPD,UPDCNT
"RTN","RORUPD51",112,0)
 N RORLOR,RORLST,RORMSG
"RTN","RORUPD51",113,0)
 S ROOT=$$ROOT^DILFD(798,,1)
"RTN","RORUPD51",114,0)
 ;--- Compile a list of registry internal entry numbers
"RTN","RORUPD51",115,0)
 S REGNAME="",RC=0
"RTN","RORUPD51",116,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:RC<0
"RTN","RORUPD51",117,0)
 . S RC=+$G(REGLST(REGNAME))
"RTN","RORUPD51",118,0)
 . S:RC'>0 RC=$$REGIEN^RORUTL02(REGNAME)
"RTN","RORUPD51",119,0)
 . S:RC>0 RORLOR(+RC)=""
"RTN","RORUPD51",120,0)
 Q:RC<0 RC
"RTN","RORUPD51",121,0)
 ;--- Loop through the patients of the registries
"RTN","RORUPD51",122,0)
 S PTIEN="",(CNT,RC)=0
"RTN","RORUPD51",123,0)
 F  S PTIEN=$O(@ROOT@("B",PTIEN))  Q:PTIEN=""  D  Q:RC<0
"RTN","RORUPD51",124,0)
 . ;--- Check if task stop has been requested
"RTN","RORUPD51",125,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD  D  Q
"RTN","RORUPD51",126,0)
 . . S RC=$$ERROR^RORERR(-42)
"RTN","RORUPD51",127,0)
 . S CNT=CNT+1
"RTN","RORUPD51",128,0)
 . I $G(RORPARM("DEBUG"))>1  W:$E($G(IOST),1,2)="C-" *13,CNT
"RTN","RORUPD51",129,0)
 . ;--- Check for "stray" items in the cross-reference
"RTN","RORUPD51",130,0)
 . S IR=""
"RTN","RORUPD51",131,0)
 . F  S IR=$O(@ROOT@("B",PTIEN,IR))  Q:IR=""  D
"RTN","RORUPD51",132,0)
 . . K:$P($G(@ROOT@(IR,0)),U)'>0 @ROOT@("B",PTIEN,IR)
"RTN","RORUPD51",133,0)
 . Q:$D(@ROOT@("B",PTIEN))<10
"RTN","RORUPD51",134,0)
 . ;--- Check for a merged patient record
"RTN","RORUPD51",135,0)
 . S RC=$$MERGED^RORUTL18(PTIEN)
"RTN","RORUPD51",136,0)
 . I RC  S:RC>0 RC=$$MERGE(PTIEN,RC)  S RC=0  Q
"RTN","RORUPD51",137,0)
 . ;--- Load a list of patient's registry records
"RTN","RORUPD51",138,0)
 . S SCR="S Y=+$P($G(^(0)),U,2) I Y,$D(RORLOR(Y))"
"RTN","RORUPD51",139,0)
 . D FIND^DIC(798,,"@;.02I;3I;8E","QUX",PTIEN,,"B",SCR,,"RORLST","RORMSG")
"RTN","RORUPD51",140,0)
 . I $G(DIERR)  D  Q
"RTN","RORUPD51",141,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,PTIEN,798)
"RTN","RORUPD51",142,0)
 . ;--- Demographic data should be checked only if at least one of
"RTN","RORUPD51",143,0)
 . ;--- the registry records of the patient is active.
"RTN","RORUPD51",144,0)
 . S IR="",UPDCNT=0
"RTN","RORUPD51",145,0)
 . F  S IR=$O(RORLST("DILIST","ID",IR))  Q:IR=""  D
"RTN","RORUPD51",146,0)
 . . S UPD=+$G(RORLST("DILIST","ID",IR,8))
"RTN","RORUPD51",147,0)
 . . S REGIEN=+$G(RORLST("DILIST","ID",IR,.02))
"RTN","RORUPD51",148,0)
 . . S TMP=+$G(RORLST("DILIST","ID",IR,3))  ; STATUS
"RTN","RORUPD51",149,0)
 . . S CNT(REGIEN,TMP)=$G(CNT(REGIEN,TMP))+1
"RTN","RORUPD51",150,0)
 . . S:UPD UPDCNT=UPDCNT+1
"RTN","RORUPD51",151,0)
 . S:UPDCNT RC=$$UPDPTDEM(PTIEN)
"RTN","RORUPD51",152,0)
 D:RC'<0 UPDRCNT(.CNT)
"RTN","RORUPD51",153,0)
 ;---
"RTN","RORUPD51",154,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUPD51",155,0)
 ;
"RTN","RORUPD51",156,0)
 ;***** UPDATES DEMOGRAPHIC DATA OF THE PATIENT (IF NECESSARY)
"RTN","RORUPD51",157,0)
 ;
"RTN","RORUPD51",158,0)
 ; PTIEN         Patient IEN
"RTN","RORUPD51",159,0)
 ;
"RTN","RORUPD51",160,0)
 ; Return Values:
"RTN","RORUPD51",161,0)
 ;       <0  Error code
"RTN","RORUPD51",162,0)
 ;        0  Ok
"RTN","RORUPD51",163,0)
 ;
"RTN","RORUPD51",164,0)
UPDPTDEM(PTIEN) ;
"RTN","RORUPD51",165,0)
 N CF,DOD,IENS,RC,RORMSG,RORPAT
"RTN","RORUPD51",166,0)
 S IENS=PTIEN_",",CF=0
"RTN","RORUPD51",167,0)
 ;--- Try to lock the record of the ROR PATIENT file
"RTN","RORUPD51",168,0)
 L +^RORDATA(798.4,PTIEN):1
"RTN","RORUPD51",169,0)
 E  Q $$ERROR^RORERR(-11,,,PTIEN,"file #798.4")
"RTN","RORUPD51",170,0)
 D
"RTN","RORUPD51",171,0)
 . ;--- Compare demographic data
"RTN","RORUPD51",172,0)
 . S RC=$$PATDATA^RORUPD52(IENS,.RORPAT,IENS,.DOD)  Q:RC<0
"RTN","RORUPD51",173,0)
 . S:RC CF=1
"RTN","RORUPD51",174,0)
 . ;--- Mark registry records of the patient
"RTN","RORUPD51",175,0)
 . I CF  S RC=$$MARKREGS(PTIEN,$G(DOD))  Q:RC<0
"RTN","RORUPD51",176,0)
 . ;--- Update demographic data
"RTN","RORUPD51",177,0)
 . I CF,$D(RORPAT)>1  S RC=0  D  Q:RC<0
"RTN","RORUPD51",178,0)
 . . D FILE^DIE(,"RORPAT","RORMSG")  Q:'$G(DIERR)
"RTN","RORUPD51",179,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,PTIEN,798.4)
"RTN","RORUPD51",180,0)
 ;
"RTN","RORUPD51",181,0)
 L -^RORDATA(798.4,PTIEN)
"RTN","RORUPD51",182,0)
 Q 0
"RTN","RORUPD51",183,0)
 ;
"RTN","RORUPD51",184,0)
 ;***** UPDATES RECORD COUNTERS IN THE 'ROR REGISTRY PARAMETERS' FILE
"RTN","RORUPD51",185,0)
 ;
"RTN","RORUPD51",186,0)
 ; .CNT(         Reference to a local array containg registry
"RTN","RORUPD51",187,0)
 ;               record counters
"RTN","RORUPD51",188,0)
 ;   Registry#,
"RTN","RORUPD51",189,0)
 ;     0)        Number of confirmed records
"RTN","RORUPD51",190,0)
 ;     4)        Number of pending records
"RTN","RORUPD51",191,0)
 ;
"RTN","RORUPD51",192,0)
UPDRCNT(CNT) ;
"RTN","RORUPD51",193,0)
 N IENS,RC,REGIEN,RORFDA,RORMSG
"RTN","RORUPD51",194,0)
 S REGIEN=0
"RTN","RORUPD51",195,0)
 F  S REGIEN=$O(CNT(REGIEN))  Q:REGIEN=""  D
"RTN","RORUPD51",196,0)
 . S IENS=REGIEN_","
"RTN","RORUPD51",197,0)
 . S RORFDA(798.1,IENS,19.1)=$G(CNT(REGIEN,0))
"RTN","RORUPD51",198,0)
 . S RORFDA(798.1,IENS,19.2)=$G(CNT(REGIEN,4))
"RTN","RORUPD51",199,0)
 . D FILE^DIE("K","RORFDA","RORMSG")
"RTN","RORUPD51",200,0)
 . I $G(DIERR)  D  Q
"RTN","RORUPD51",201,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,798.1,IENS)
"RTN","RORUPD51",202,0)
 Q
"RTN","RORUPD52")
0^139^B12529395
"RTN","RORUPD52",1,0)
RORUPD52 ;HCIOFO/SG - UPDATE PATIENT'S DEMOGRAPHIC DATA (2) ; 12/12/05 9:19am
"RTN","RORUPD52",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPD52",3,0)
 ;
"RTN","RORUPD52",4,0)
 ; This routine uses the following IAs:
"RTN","RORUPD52",5,0)
 ;
"RTN","RORUPD52",6,0)
 ; #174          RATED DISBAILITIES (VA) multiple (controlled)
"RTN","RORUPD52",7,0)
 ; #2701         $$GETICN^MPIF001  Gets ICN
"RTN","RORUPD52",8,0)
 ; #4807         RDIS^DGRPDB (supported)
"RTN","RORUPD52",9,0)
 ; #10061        6^VADPT
"RTN","RORUPD52",10,0)
 ;
"RTN","RORUPD52",11,0)
 Q
"RTN","RORUPD52",12,0)
 ;
"RTN","RORUPD52",13,0)
 ;***** LOAD DEMOGRAPHIC DATA FROM THE 'PATIENT' FILE
"RTN","RORUPD52",14,0)
 ;
"RTN","RORUPD52",15,0)
 ; DFN           Internal Entry Number in the PATIENT file
"RTN","RORUPD52",16,0)
 ;
"RTN","RORUPD52",17,0)
 ; .RES          Reference to a buffer for the data
"RTN","RORUPD52",18,0)
 ;
"RTN","RORUPD52",19,0)
 ;   RES(1,      Demographic and elegibility data
"RTN","RORUPD52",20,0)
 ;                 ^1: SSN                           .09
"RTN","RORUPD52",21,0)
 ;                 ^2: Date of Birth                 .03
"RTN","RORUPD52",22,0)
 ;                 ^3: Sex                           .02
"RTN","RORUPD52",23,0)
 ;                 ^4: Date of Death                 .351
"RTN","RORUPD52",24,0)
 ;                 ^5: Period of Service             .323
"RTN","RORUPD52",25,0)
 ;                 ^6: Service Connected?            .301
"RTN","RORUPD52",26,0)
 ;                 ^7: Service Connected Percentage  .302
"RTN","RORUPD52",27,0)
 ;                 ^8: ZIP+4                         .1112
"RTN","RORUPD52",28,0)
 ;                 ^9: ICN (with the checksum)       991.*
"RTN","RORUPD52",29,0)
 ;     "FL")     List of field numbers separated by the ";"
"RTN","RORUPD52",30,0)
 ;
"RTN","RORUPD52",31,0)
 ;   RES(2)      Race and ethnicity data
"RTN","RORUPD52",32,0)
 ;                 Race^Method^...^Ethnicity^Method^...
"RTN","RORUPD52",33,0)
 ;
"RTN","RORUPD52",34,0)
 ; Return Values:
"RTN","RORUPD52",35,0)
 ;       <0  Error code
"RTN","RORUPD52",36,0)
 ;        0  Ok
"RTN","RORUPD52",37,0)
 ;
"RTN","RORUPD52",38,0)
LOADDM(DFN,RES) ;
"RTN","RORUPD52",39,0)
 N I,J,VA,VADM,VAEL,VAHOW,VAPA,VAROOT
"RTN","RORUPD52",40,0)
 S RES(1,"FL")=".09;.03;.02;.351;.323;.301;.302;.1112;991"
"RTN","RORUPD52",41,0)
 D 6^VADPT  F I=1,2  S RES(I)=""
"RTN","RORUPD52",42,0)
 ;--- Demographic and eligibility fields
"RTN","RORUPD52",43,0)
 F I=2,3,5,6  S RES(1)=RES(1)_U_$P($G(VADM(I)),U)
"RTN","RORUPD52",44,0)
 S $E(RES(1),1)=""  ; Remove the first "^"
"RTN","RORUPD52",45,0)
 S I=$G(VAEL(3))
"RTN","RORUPD52",46,0)
 S RES(1)=RES(1)_U_$P($G(VAEL(2)),U)_U_$S(I:"Y",1:"N")_U_$P(I,U,2)
"RTN","RORUPD52",47,0)
 S I=$$GETICN^MPIF001(DFN)
"RTN","RORUPD52",48,0)
 S RES(1)=RES(1)_U_$P($G(VAPA(6)),U,2)_U_$S(I'<0:I,1:"")
"RTN","RORUPD52",49,0)
 ;--- Race & Ethnicity
"RTN","RORUPD52",50,0)
 F I=11,12  S J=""  D
"RTN","RORUPD52",51,0)
 . F  S J=$O(VADM(I,J))  Q:J=""  D
"RTN","RORUPD52",52,0)
 . . S RES(2)=RES(2)_U_$P(VADM(I,J),U)_U_$P($G(VADM(I,J,1)),U)
"RTN","RORUPD52",53,0)
 S $E(RES(2),1)=""  ; Remove the first "^"
"RTN","RORUPD52",54,0)
 Q 0
"RTN","RORUPD52",55,0)
 ;
"RTN","RORUPD52",56,0)
 ;***** LOAD RATED DISABILITIES FROM THE 'PATIENT' FILE
"RTN","RORUPD52",57,0)
 ;
"RTN","RORUPD52",58,0)
 ; DFN           Internal Entry Number in the PATIENT file
"RTN","RORUPD52",59,0)
 ;
"RTN","RORUPD52",60,0)
 ; .RES          Reference to a buffer for the data
"RTN","RORUPD52",61,0)
 ;
"RTN","RORUPD52",62,0)
 ;   RES(3)      Rated disabilities data
"RTN","RORUPD52",63,0)
 ;                 Rated Disability^Disability %^Service Connected^...
"RTN","RORUPD52",64,0)
 ;
"RTN","RORUPD52",65,0)
 ; Return Values:
"RTN","RORUPD52",66,0)
 ;       <0  Error code
"RTN","RORUPD52",67,0)
 ;        0  Ok
"RTN","RORUPD52",68,0)
 ;
"RTN","RORUPD52",69,0)
LOADRD(DFN,RES) ;
"RTN","RORUPD52",70,0)
 N I,RC,RORBUF
"RTN","RORUPD52",71,0)
 S I=0
"RTN","RORUPD52",72,0)
 F  S I=$O(^DPT(DFN,.372,I))  Q:I'>0  D
"RTN","RORUPD52",73,0)
 . S RORBUF(I)=$P($G(^DPT(DFN,.372,I,0)),U,1,3)
"RTN","RORUPD52",74,0)
 S RES(3)=$$CRC32^RORBIN("RORBUF")
"RTN","RORUPD52",75,0)
 Q 0
"RTN","RORUPD52",76,0)
 ; Use this code to load disabilities when the API is fixed.
"RTN","RORUPD52",77,0)
 ;S RC=$$RDIS^DGRPDB(DFN,.RORBUF)
"RTN","RORUPD52",78,0)
 ;D:'RC ERROR^RORERR(-57,,,DFN,RC,"$$RDIS^DGRPDB")
"RTN","RORUPD52",79,0)
 ;
"RTN","RORUPD52",80,0)
 ;***** GETS AND PREPARES PATIENT'S DATA
"RTN","RORUPD52",81,0)
 ;
"RTN","RORUPD52",82,0)
 ; PATIENS       Patient IENS in the PATIENT file
"RTN","RORUPD52",83,0)
 ; .RORPAT       Reference to the FDA for field values
"RTN","RORUPD52",84,0)
 ; RORIENS       IENS of the record in the ROR PATIENT file
"RTN","RORUPD52",85,0)
 ; [.DOD]        Date of death is returned via this parameter
"RTN","RORUPD52",86,0)
 ;
"RTN","RORUPD52",87,0)
 ; Return Values:
"RTN","RORUPD52",88,0)
 ;       <0  Error code
"RTN","RORUPD52",89,0)
 ;        0  Patient data has not been changed
"RTN","RORUPD52",90,0)
 ;       >0  Data has been changed
"RTN","RORUPD52",91,0)
 ;
"RTN","RORUPD52",92,0)
PATDATA(PATIENS,RORPAT,RORIENS,DOD) ;
"RTN","RORUPD52",93,0)
 N BUF,DIFCNT,N1,NODE,RC,RORDFN
"RTN","RORUPD52",94,0)
 S:PATIENS'["," PATIENS=PATIENS_","
"RTN","RORUPD52",95,0)
 S:RORIENS'["," RORIENS=RORIENS_","
"RTN","RORUPD52",96,0)
 S RORDFN=$S(RORIENS?1.N1",":+RORIENS,1:-1)
"RTN","RORUPD52",97,0)
 S DOD="",(DIFCNT,RC)=0
"RTN","RORUPD52",98,0)
 ;--- Load demographic data from the PATIENT file
"RTN","RORUPD52",99,0)
 S RC=$$LOADDM(+PATIENS,.NODE)  Q:RC<0 RC
"RTN","RORUPD52",100,0)
 S DOD=$P(NODE(1),U,4),N1=$L(NODE(1,"FL"),";")
"RTN","RORUPD52",101,0)
 ;--- Demographic and eligibility fields
"RTN","RORUPD52",102,0)
 S BUF=$P($G(^RORDATA(798.4,RORDFN,1)),U,1,N1)
"RTN","RORUPD52",103,0)
 I NODE(1)'=BUF  D
"RTN","RORUPD52",104,0)
 . N CF,FLD,I
"RTN","RORUPD52",105,0)
 . F I=1:1:N1  S FLD=+$P(NODE(1,"FL"),";",I)  D:FLD>0
"RTN","RORUPD52",106,0)
 . . K RORPAT(798.4,RORIENS,FLD)
"RTN","RORUPD52",107,0)
 . . ;--- Update the field if necessary
"RTN","RORUPD52",108,0)
 . . S OLDVAL=$P(BUF,U,I)  Q:$P(NODE(1),U,I)=OLDVAL
"RTN","RORUPD52",109,0)
 . . S RORPAT(798.4,RORIENS,FLD)=$P(NODE(1),U,I),CF=1
"RTN","RORUPD52",110,0)
 . . ;--- Save previous values of the special fields
"RTN","RORUPD52",111,0)
 . . I FLD=.09  D  Q
"RTN","RORUPD52",112,0)
 . . . S RORPAT(798.4,RORIENS,10.1)=OLDVAL  ; Old SSN
"RTN","RORUPD52",113,0)
 . . I FLD=991.01  D  Q
"RTN","RORUPD52",114,0)
 . . . S RORPAT(798.4,RORIENS,10.2)=OLDVAL  ; Old ICN
"RTN","RORUPD52",115,0)
 . I $G(CF)  S DIFCNT=DIFCNT+1  Q
"RTN","RORUPD52",116,0)
 . S $P(^RORDATA(798.4,RORDFN,1),U,N1)=$P(BUF,U,N1)
"RTN","RORUPD52",117,0)
 ;--- Race & Ethnicity
"RTN","RORUPD52",118,0)
 I NODE(2)'=$G(^RORDATA(798.4,RORDFN,2))  D
"RTN","RORUPD52",119,0)
 . S DIFCNT=DIFCNT+1,RORPAT(798.4,RORIENS,2)=NODE(2)
"RTN","RORUPD52",120,0)
 K NODE
"RTN","RORUPD52",121,0)
 ;--- Rated disabilities
"RTN","RORUPD52",122,0)
 S RC=$$LOADRD(+PATIENS,.NODE)  Q:RC<0 RC
"RTN","RORUPD52",123,0)
 I NODE(3)'=$G(^RORDATA(798.4,RORDFN,3))  D
"RTN","RORUPD52",124,0)
 . S DIFCNT=DIFCNT+1,RORPAT(798.4,RORIENS,.3721)=NODE(3)
"RTN","RORUPD52",125,0)
 Q $S(RC<0:RC,1:DIFCNT)
"RTN","RORUPD62")
0^202^B5521623
"RTN","RORUPD62",1,0)
RORUPD62 ;HCIOFO/SG - HIV-SPECIFIC REGISTRY UPDATE CODE ; 5/11/05 2:17pm
"RTN","RORUPD62",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPD62",3,0)
 ;
"RTN","RORUPD62",4,0)
 ; This routine uses the following IAs:
"RTN","RORUPD62",5,0)
 ;
"RTN","RORUPD62",6,0)
 ; #2762         Check for the patient merge (controlled)
"RTN","RORUPD62",7,0)
 ;
"RTN","RORUPD62",8,0)
 ;--------------------------------------------------------------------
"RTN","RORUPD62",9,0)
 ; Registry: [VA HIV]
"RTN","RORUPD62",10,0)
 ;--------------------------------------------------------------------
"RTN","RORUPD62",11,0)
 Q
"RTN","RORUPD62",12,0)
 ;
"RTN","RORUPD62",13,0)
 ;***** CONVERTS ICR 2.1 RECORDS TO CCR:HIV FORMAT
"RTN","RORUPD62",14,0)
 ;
"RTN","RORUPD62",15,0)
 ; RORREG        Registry IEN
"RTN","RORUPD62",16,0)
 ;
"RTN","RORUPD62",17,0)
 ; Return Values:
"RTN","RORUPD62",18,0)
 ;       <0  Error Code
"RTN","RORUPD62",19,0)
 ;        0  Ok
"RTN","RORUPD62",20,0)
 ;
"RTN","RORUPD62",21,0)
CONVERT(RORREG) ;
"RTN","RORUPD62",22,0)
 N CODE,IMRIEN,PATIEN,RC,REGIEN,RULENAME,RULES,TMP
"RTN","RORUPD62",23,0)
 D LOG^RORLOG(2,"ICR 2.1 Conversion")
"RTN","RORUPD62",24,0)
 S REGIEN=+RORREG
"RTN","RORUPD62",25,0)
 ;--- Prepare the selection rules
"RTN","RORUPD62",26,0)
 S RULENAME="VA HIV 2.1 CONVERSION"
"RTN","RORUPD62",27,0)
 S TMP=$$SRLIEN^RORUTL02(RULENAME)
"RTN","RORUPD62",28,0)
 Q:TMP'>0 $$ERROR^RORERR(-3,,RULENAME)
"RTN","RORUPD62",29,0)
 S RULES(1)=TMP_U_DT
"RTN","RORUPD62",30,0)
 ;--- Convert the remaining records of ICR v2.1
"RTN","RORUPD62",31,0)
 S (IMRIEN,RC)=0
"RTN","RORUPD62",32,0)
 F  S IMRIEN=$O(^IMR(158,IMRIEN))  Q:IMRIEN'>0  D  Q:RC<0
"RTN","RORUPD62",33,0)
 . S CODE=$P($G(^IMR(158,IMRIEN,0)),U)  Q:CODE'>0
"RTN","RORUPD62",34,0)
 . S PATIEN=+$$XOR^RORUTL03(CODE)  Q:PATIEN'>0
"RTN","RORUPD62",35,0)
 . ;--- Check if the patient has been merged
"RTN","RORUPD62",36,0)
 . S TMP=+$G(^DPT(PATIEN,-9))  S:TMP>0 PATIEN=TMP
"RTN","RORUPD62",37,0)
 . ;--- Check if the patient record in the file #2 is valid
"RTN","RORUPD62",38,0)
 . Q:$$CHKPTR^RORUTL05(PATIEN)<0
"RTN","RORUPD62",39,0)
 . ;--- Quit if the patient has already been added to the new registry
"RTN","RORUPD62",40,0)
 . Q:$$PRRIEN^RORUTL01(PATIEN,REGIEN)>0
"RTN","RORUPD62",41,0)
 . ;--- Check if the patient is an employee
"RTN","RORUPD62",42,0)
 . Q:$$SKIPEMPL^RORUTL02(PATIEN,.REGIEN)
"RTN","RORUPD62",43,0)
 . ;--- Add the patient to the new registry
"RTN","RORUPD62",44,0)
 . S TMP=$$ADDPAT^RORUPD06(PATIEN,"VA HIV",.RULES)
"RTN","RORUPD62",45,0)
 ;---
"RTN","RORUPD62",46,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUPD62",47,0)
 ;
"RTN","RORUPD62",48,0)
 ;***** AFTER UPDATE CALL-BACK ENTRY POINT
"RTN","RORUPD62",49,0)
 ;
"RTN","RORUPD62",50,0)
 ; RORIEN        An IEN of the newly added registry record
"RTN","RORUPD62",51,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD62",52,0)
 ; REGIEN        Registry IEN
"RTN","RORUPD62",53,0)
 ;
"RTN","RORUPD62",54,0)
 ; Return Values:
"RTN","RORUPD62",55,0)
 ;       <0  Error Code
"RTN","RORUPD62",56,0)
 ;        0  Ok
"RTN","RORUPD62",57,0)
 ;
"RTN","RORUPD62",58,0)
POSTUPD(RORIEN,PATIEN,REGIEN) ;
"RTN","RORUPD62",59,0)
 N DA,DIK,IENS,RC,RORFDA,RORHIV,RORMSG
"RTN","RORUPD62",60,0)
 S RORIEN=+$G(RORIEN)  Q:RORIEN'>0 0
"RTN","RORUPD62",61,0)
 ;--- Delete the record if it exists by some reason
"RTN","RORUPD62",62,0)
 D:$D(^RORDATA(799.4,RORIEN))
"RTN","RORUPD62",63,0)
 . S DIK="^RORDATA(799.4,",DA=RORIEN  D ^DIK
"RTN","RORUPD62",64,0)
 ;--- Prepare the data
"RTN","RORUPD62",65,0)
 S IENS="+1,"
"RTN","RORUPD62",66,0)
 S RORFDA(799.4,IENS,.01)=RORIEN
"RTN","RORUPD62",67,0)
 S RORHIV(1)=RORIEN
"RTN","RORUPD62",68,0)
 ;--- Add the record to the ROR HIV STUDY file
"RTN","RORUPD62",69,0)
 D UPDATE^DIE(,"RORFDA","RORHIV","RORMSG")
"RTN","RORUPD62",70,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.4,IENS)
"RTN","RORUPD62",71,0)
 Q 0
"RTN","RORUPDUT")
0^140^B47401581
"RTN","RORUPDUT",1,0)
RORUPDUT ;HCIOFO/SG - REGISTRY UPDATE UTILITIES  ; 8/2/05 9:17am
"RTN","RORUPDUT",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPDUT",3,0)
 ;
"RTN","RORUPDUT",4,0)
 ; RORVALS ------------- CALCULATED VALUES
"RTN","RORUPDUT",5,0)
 ;
"RTN","RORUPDUT",6,0)
 ; RORVALS("DV",         VALUES OF THE DATA ELEMENTS
"RTN","RORUPDUT",7,0)
 ;   File#,DataCode,"E") External value
"RTN","RORUPDUT",8,0)
 ;   File#,DataCode,"I") Internal value
"RTN","RORUPDUT",9,0)
 ;
"RTN","RORUPDUT",10,0)
 ; RORVALS("LS",         LIST OF TRIGGERED LAB SEARCHES
"RTN","RORUPDUT",11,0)
 ;   LabSearch#)         Observation descriptor
"RTN","RORUPDUT",12,0)
 ;                         ^01: Date/time of the observation
"RTN","RORUPDUT",13,0)
 ;                         ^02: Institution IEN
"RTN","RORUPDUT",14,0)
 ;
"RTN","RORUPDUT",15,0)
 ; RORVALS("SV",         VALUES OF THE SELECTION RULES
"RTN","RORUPDUT",16,0)
 ;   Rule Name,          Current value
"RTN","RORUPDUT",17,0)
 ;     "AVG")            Average value
"RTN","RORUPDUT",18,0)
 ;     "CNT")            Counter
"RTN","RORUPDUT",19,0)
 ;     "DTF")            Used by the {SDF} and {SDL} macros to store
"RTN","RORUPDUT",20,0)
 ;     "DTL")            the earliest and the latest trigger dates
"RTN","RORUPDUT",21,0)
 ;     "MAX")            Maximum value
"RTN","RORUPDUT",22,0)
 ;     "MIN")            Minimum value
"RTN","RORUPDUT",23,0)
 ;     "SUM")            Total value
"RTN","RORUPDUT",24,0)
 ;
"RTN","RORUPDUT",25,0)
 ; PREDEFINED NAME ----- VALUE AND DESCRIPTION
"RTN","RORUPDUT",26,0)
 ;
"RTN","RORUPDUT",27,0)
 ; "ROR DFN"             IEN of the patient being processed
"RTN","RORUPDUT",28,0)
 ; "ROR SRDT"            Date when the current selection rule was
"RTN","RORUPDUT",29,0)
 ;                       triggered (it is set by APLRULES^RORUPDUT
"RTN","RORUPDUT",30,0)
 ;                       but could be changed by selection rules).
"RTN","RORUPDUT",31,0)
 ;                       The {GDF} and {GDL} macros modify this
"RTN","RORUPDUT",32,0)
 ;                       value as well.
"RTN","RORUPDUT",33,0)
 ; "ROR SRLOC"           Institution IEN where the selection rule
"RTN","RORUPDUT",34,0)
 ;                       was triggered
"RTN","RORUPDUT",35,0)
 ;
"RTN","RORUPDUT",36,0)
 Q
"RTN","RORUPDUT",37,0)
 ;
"RTN","RORUPDUT",38,0)
 ;***** APPLIES SELECTION RULES TO THE RECORD
"RTN","RORUPDUT",39,0)
 ;
"RTN","RORUPDUT",40,0)
 ; FILE          File/Subfile number
"RTN","RORUPDUT",41,0)
 ; IENS          IENS of the current record
"RTN","RORUPDUT",42,0)
 ; MODE          "B" (process before subfiles) or
"RTN","RORUPDUT",43,0)
 ;               "A" (process after subfiles)
"RTN","RORUPDUT",44,0)
 ; [DATE]        Trigger date (TODAY by default)
"RTN","RORUPDUT",45,0)
 ; [LOCATION]    Institution IEN (empty by default)
"RTN","RORUPDUT",46,0)
 ;
"RTN","RORUPDUT",47,0)
 ; Return values:
"RTN","RORUPDUT",48,0)
 ;       <0  Error code
"RTN","RORUPDUT",49,0)
 ;        0  Continue processing of the current patient
"RTN","RORUPDUT",50,0)
 ;        1  Stop looping
"RTN","RORUPDUT",51,0)
 ;
"RTN","RORUPDUT",52,0)
APLRULES(FILE,IENS,MODE,DATE,LOCATION) ;
"RTN","RORUPDUT",53,0)
 N EXPR,HDR,LM,PATIEN,RC,REGIEN,RI,RULENAME,RULENODE,TMP
"RTN","RORUPDUT",54,0)
 S:'$G(DATE) DATE=$$DT^XLFDT
"RTN","RORUPDUT",55,0)
 ;--- Loop through the selection rules
"RTN","RORUPDUT",56,0)
 S RI="",RC=0
"RTN","RORUPDUT",57,0)
 F  S RI=$O(RORUPD("SR",FILE,MODE,RI))  Q:RI=""  D  Q:RC<0
"RTN","RORUPDUT",58,0)
 . S RULENODE=$NA(RORUPD("SR",FILE,MODE,RI))
"RTN","RORUPDUT",59,0)
 . S RORVALS("SV","ROR SRDT")=$P(DATE,".")
"RTN","RORUPDUT",60,0)
 . S RORVALS("SV","ROR SRLOC")=$G(LOCATION)
"RTN","RORUPDUT",61,0)
 . S HDR=$G(@RULENODE),RULENAME=$P(HDR,U)
"RTN","RORUPDUT",62,0)
 . ;--- If a top level rule does not exist in the control list, this
"RTN","RORUPDUT",63,0)
 . ;    rule has been already triggered for the patient. So, there is
"RTN","RORUPDUT",64,0)
 . ;    no need to check it again.
"RTN","RORUPDUT",65,0)
 . I $P(HDR,U,3)  Q:'$D(RORUPD("LM",1,RULENAME))
"RTN","RORUPDUT",66,0)
 . ;--- Compute the expression of the selection rule
"RTN","RORUPDUT",67,0)
 . X "S RC="_@RULENODE@(1)
"RTN","RORUPDUT",68,0)
 . I $P(HDR,U,3)  Q:'RC  D               ; TOP LEVEL RULE
"RTN","RORUPDUT",69,0)
 . . S PATIEN=$$GETVAL("ROR DFN"),REGIEN=""
"RTN","RORUPDUT",70,0)
 . . F  S REGIEN=$O(@RULENODE@(2,REGIEN))  Q:REGIEN=""  D
"RTN","RORUPDUT",71,0)
 . . . ;--- Check if the patient is already in the registry
"RTN","RORUPDUT",72,0)
 . . . Q:'$G(RORUPD("LM2",REGIEN))
"RTN","RORUPDUT",73,0)
 . . . ;--- Save the rule reference for the registry and new patient
"RTN","RORUPDUT",74,0)
 . . . S TMP=$$GETVAL("ROR SRDT")_U_$$GETVAL("ROR SRLOC")
"RTN","RORUPDUT",75,0)
 . . . S @RORUPDPI@("U",PATIEN,2,REGIEN,+$P(HDR,U,2))=TMP
"RTN","RORUPDUT",76,0)
 . . . ;--- Remove the registry from the control list
"RTN","RORUPDUT",77,0)
 . . . K RORUPD("LM",2,REGIEN)
"RTN","RORUPDUT",78,0)
 . . ;--- Remove the rule from the control list
"RTN","RORUPDUT",79,0)
 . . K RORUPD("LM",1,RULENAME)
"RTN","RORUPDUT",80,0)
 . E  D SETVAL(RULENAME,RC)              ; LOWER LEVEL RULE
"RTN","RORUPDUT",81,0)
 . S RC=0
"RTN","RORUPDUT",82,0)
 S LM=+$G(RORUPD("LM")) ; Loop mode
"RTN","RORUPDUT",83,0)
 ;--- If the loop mode equals 0, continue processing of the patient
"RTN","RORUPDUT",84,0)
 ;    in any case. Otherwise, stop processing if the corresponding
"RTN","RORUPDUT",85,0)
 ;    control list is empty.
"RTN","RORUPDUT",86,0)
 Q $S(RC<0:RC,LM:$D(RORUPD("LM",LM))<10,1:0)
"RTN","RORUPDUT",87,0)
 ;
"RTN","RORUPDUT",88,0)
 ;***** CLEARS DATA ELEMENT VALUES
"RTN","RORUPDUT",89,0)
 ;
"RTN","RORUPDUT",90,0)
 ; FILE          File/Subfile number
"RTN","RORUPDUT",91,0)
 ;
"RTN","RORUPDUT",92,0)
CLRDES(FILE) ;
"RTN","RORUPDUT",93,0)
 K RORVALS("DV",FILE)
"RTN","RORUPDUT",94,0)
 Q
"RTN","RORUPDUT",95,0)
 ;
"RTN","RORUPDUT",96,0)
 ;***** CLEARS VALUE OF THE ERROR COUNTER
"RTN","RORUPDUT",97,0)
CLREC ;
"RTN","RORUPDUT",98,0)
 K RORUPD("ERRCNT")
"RTN","RORUPDUT",99,0)
 Q
"RTN","RORUPDUT",100,0)
 ;
"RTN","RORUPDUT",101,0)
 ;***** CLEARS VALUES OF THE SELECTION RULES ASSOCIATED WITH THE FILE
"RTN","RORUPDUT",102,0)
 ;
"RTN","RORUPDUT",103,0)
 ; FILE          File/Subfile number
"RTN","RORUPDUT",104,0)
 ;
"RTN","RORUPDUT",105,0)
CLRVALS(FILE) ;
"RTN","RORUPDUT",106,0)
 N MODE,RI,RULENAME
"RTN","RORUPDUT",107,0)
 F MODE="B","A"  D
"RTN","RORUPDUT",108,0)
 . S RI=""
"RTN","RORUPDUT",109,0)
 . F  S RI=$O(RORUPD("SR",FILE,MODE,RI))  Q:RI=""  D
"RTN","RORUPDUT",110,0)
 . . S RULENAME=$P($G(RORUPD("SR",FILE,MODE,RI)),U)
"RTN","RORUPDUT",111,0)
 . . K:RULENAME'="" RORVALS("SV",RULENAME)
"RTN","RORUPDUT",112,0)
 Q
"RTN","RORUPDUT",113,0)
 ;
"RTN","RORUPDUT",114,0)
 ;***** RETURNS A CODE OF THE DATA ELEMENT
"RTN","RORUPDUT",115,0)
 ;
"RTN","RORUPDUT",116,0)
 ; FILE          File number
"RTN","RORUPDUT",117,0)
 ; NAME          Name of the data element
"RTN","RORUPDUT",118,0)
 ;
"RTN","RORUPDUT",119,0)
 ; Return values:
"RTN","RORUPDUT",120,0)
 ;       <0  Error code
"RTN","RORUPDUT",121,0)
 ;       >0  Code of the data element
"RTN","RORUPDUT",122,0)
 ;
"RTN","RORUPDUT",123,0)
DATACODE(FILE,NAME) ;
"RTN","RORUPDUT",124,0)
 N IENS,RC,RORBUF,RORMSG
"RTN","RORUPDUT",125,0)
 S IENS=","_FILE_","
"RTN","RORUPDUT",126,0)
 D FIND^DIC(799.22,IENS,"@;.02I","X",NAME,,"B",,,"RORBUF","RORMSG")
"RTN","RORUPDUT",127,0)
 I $G(DIERR)  D  Q RC
"RTN","RORUPDUT",128,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,799.22,IENS)
"RTN","RORUPDUT",129,0)
 S RC=+$G(RORBUF("DILIST",0))
"RTN","RORUPDUT",130,0)
 Q:RC<1 $$ERROR^RORERR(-69,,NAME)
"RTN","RORUPDUT",131,0)
 Q:RC>1 $$ERROR^RORERR(-70,,NAME)
"RTN","RORUPDUT",132,0)
 Q +$G(RORBUF("DILIST","ID",1,.02))
"RTN","RORUPDUT",133,0)
 ;
"RTN","RORUPDUT",134,0)
 ;***** PRINTS SOME DEBUG INFORMATION
"RTN","RORUPDUT",135,0)
DEBUG ;
"RTN","RORUPDUT",136,0)
 N I
"RTN","RORUPDUT",137,0)
 D ZW^RORUTL01($NA(RORUPD("FLAGS")),"Control Flags")
"RTN","RORUPDUT",138,0)
 D ZW^RORUTL01($NA(RORUPD("SR")),"Selection Rules")
"RTN","RORUPDUT",139,0)
 D ZW^RORUTL01($NA(RORUPD("UPD")),"Call-back Entry Points")
"RTN","RORUPDUT",140,0)
 W !,"Control Lists",!!
"RTN","RORUPDUT",141,0)
 F I="LM1","LM2"  D ZW^RORUTL01($NA(RORUPD(I)))
"RTN","RORUPDUT",142,0)
 D ZW^RORUTL01("RORLRC","Lab Results to check")
"RTN","RORUPDUT",143,0)
 W !,"Job number: ",$J,!
"RTN","RORUPDUT",144,0)
 Q
"RTN","RORUPDUT",145,0)
 ;
"RTN","RORUPDUT",146,0)
 ;***** GETS A VALUE OF THE DATA ELEMENT
"RTN","RORUPDUT",147,0)
 ;
"RTN","RORUPDUT",148,0)
 ; FILE          File number
"RTN","RORUPDUT",149,0)
 ; DATELMT       Code of the data element
"RTN","RORUPDUT",150,0)
 ; [TYPE]        Type of the value
"RTN","RORUPDUT",151,0)
 ;                 "E"  External
"RTN","RORUPDUT",152,0)
 ;                 "I"  Internal (default)
"RTN","RORUPDUT",153,0)
 ;
"RTN","RORUPDUT",154,0)
GETDE(FILE,DATELMT,TYPE) ;
"RTN","RORUPDUT",155,0)
 Q $G(RORVALS("DV",FILE,DATELMT,$G(TYPE,"I")))
"RTN","RORUPDUT",156,0)
 ;
"RTN","RORUPDUT",157,0)
 ;***** RETURNS VALUE OF THE ERROR COUNTER
"RTN","RORUPDUT",158,0)
GETEC() ;
"RTN","RORUPDUT",159,0)
 Q +$G(RORUPD("ERRCNT"))
"RTN","RORUPDUT",160,0)
 ;
"RTN","RORUPDUT",161,0)
 ;***** GETS VALUE OF THE SELECTION RULE
"RTN","RORUPDUT",162,0)
 ;
"RTN","RORUPDUT",163,0)
 ; RULENAME      Name of the rule
"RTN","RORUPDUT",164,0)
 ; [PFX]         Prefix of the value
"RTN","RORUPDUT",165,0)
 ;                 ""     Value itself (default)
"RTN","RORUPDUT",166,0)
 ;                 "AVG"  Average value
"RTN","RORUPDUT",167,0)
 ;                 "CNT"  Counter
"RTN","RORUPDUT",168,0)
 ;                 "MAX"  Maximum value
"RTN","RORUPDUT",169,0)
 ;                 "MIN"  Minimum value
"RTN","RORUPDUT",170,0)
 ;                 "SUM"  Total sum
"RTN","RORUPDUT",171,0)
 ;
"RTN","RORUPDUT",172,0)
GETVAL(RULENAME,PFX) ;
"RTN","RORUPDUT",173,0)
 Q $S($G(PFX)="":$G(RORVALS("SV",RULENAME)),1:$G(RORVALS("SV",RULENAME,PFX)))
"RTN","RORUPDUT",174,0)
 ;
"RTN","RORUPDUT",175,0)
 ;***** INCREMENTS VALUE OF THE ERROR COUNTER
"RTN","RORUPDUT",176,0)
 ;
"RTN","RORUPDUT",177,0)
 ; [RC]          Reference to a variable containing the error code
"RTN","RORUPDUT",178,0)
 ;
"RTN","RORUPDUT",179,0)
INCEC(RC) ;
"RTN","RORUPDUT",180,0)
 S:$G(RC,-1)<0 RORUPD("ERRCNT")=$G(RORUPD("ERRCNT"))+1,RC=0
"RTN","RORUPDUT",181,0)
 Q
"RTN","RORUPDUT",182,0)
 ;
"RTN","RORUPDUT",183,0)
 ;***** LOADS DATA ELEMENT VALUES FROM CORRESPONDING FIELDS
"RTN","RORUPDUT",184,0)
 ;
"RTN","RORUPDUT",185,0)
 ; FILE          File/Subfile number
"RTN","RORUPDUT",186,0)
 ; IENS          IENS of the current record
"RTN","RORUPDUT",187,0)
 ;
"RTN","RORUPDUT",188,0)
 ; Return values:
"RTN","RORUPDUT",189,0)
 ;       <0  Error code
"RTN","RORUPDUT",190,0)
 ;        0  Ok
"RTN","RORUPDUT",191,0)
 ;
"RTN","RORUPDUT",192,0)
LOADFLDS(FILE,IENS) ;
"RTN","RORUPDUT",193,0)
 N DE,FLD,RC,RORFDA,RORMSG,VT  K RORVALS("DV",FILE)
"RTN","RORUPDUT",194,0)
 S FLD=$G(RORUPD("SR",FILE,"F",1))  Q:FLD="" 0
"RTN","RORUPDUT",195,0)
 ;--- Load the field values
"RTN","RORUPDUT",196,0)
 D GETS^DIQ(FILE,IENS,FLD,"EIN","RORFDA","RORMSG")
"RTN","RORUPDUT",197,0)
 I $G(DIERR)  D  Q RC
"RTN","RORUPDUT",198,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,FILE,IENS)
"RTN","RORUPDUT",199,0)
 ;--- Copy the field values from the FDA
"RTN","RORUPDUT",200,0)
 S DE=""
"RTN","RORUPDUT",201,0)
 F  S DE=$O(RORUPD("SR",FILE,"F",1,DE))  Q:DE=""  D
"RTN","RORUPDUT",202,0)
 . S FLD=+$G(RORUPD("SR",FILE,"F",1,DE))  Q:'FLD
"RTN","RORUPDUT",203,0)
 . S VT=""
"RTN","RORUPDUT",204,0)
 . F  S VT=$O(RORUPD("SR",FILE,"F",1,DE,VT))  Q:VT=""  D
"RTN","RORUPDUT",205,0)
 . . S RORVALS("DV",FILE,DE,VT)=$G(RORFDA(FILE,IENS,FLD,VT))
"RTN","RORUPDUT",206,0)
 Q 0
"RTN","RORUPDUT",207,0)
 ;
"RTN","RORUPDUT",208,0)
 ;***** SETS THE EARLIEST DATE FOR THE RULE
"RTN","RORUPDUT",209,0)
 ;
"RTN","RORUPDUT",210,0)
 ; NAME          Name of the selection rule
"RTN","RORUPDUT",211,0)
 ; COND          Result value of the logical condition
"RTN","RORUPDUT",212,0)
 ;
"RTN","RORUPDUT",213,0)
 ; Return values:
"RTN","RORUPDUT",214,0)
 ;        0  COND equals to zero
"RTN","RORUPDUT",215,0)
 ;        1  COND is not zero
"RTN","RORUPDUT",216,0)
 ;
"RTN","RORUPDUT",217,0)
SDF(NAME,COND) ;
"RTN","RORUPDUT",218,0)
 Q:'$G(COND) 0
"RTN","RORUPDUT",219,0)
 N DATE
"RTN","RORUPDUT",220,0)
 S DATE=$G(RORVALS("SV","ROR SRDT"))
"RTN","RORUPDUT",221,0)
 D:DATE>0
"RTN","RORUPDUT",222,0)
 . I $G(RORVALS("SV",NAME,"DTF"))'>0  D  Q
"RTN","RORUPDUT",223,0)
 . . S RORVALS("SV",NAME,"DTF")=DATE
"RTN","RORUPDUT",224,0)
 . S:DATE<RORVALS("SV",NAME,"DTF") RORVALS("SV",NAME,"DTF")=DATE
"RTN","RORUPDUT",225,0)
 Q 1
"RTN","RORUPDUT",226,0)
 ;
"RTN","RORUPDUT",227,0)
 ;***** SETS THE LATEST DATE FOR THE RULE
"RTN","RORUPDUT",228,0)
 ;
"RTN","RORUPDUT",229,0)
 ; NAME          Name of the selection rule
"RTN","RORUPDUT",230,0)
 ; COND          Result value of the logical condition
"RTN","RORUPDUT",231,0)
 ;
"RTN","RORUPDUT",232,0)
 ; Return values:
"RTN","RORUPDUT",233,0)
 ;        0  COND equals to zero
"RTN","RORUPDUT",234,0)
 ;        1  COND is not zero
"RTN","RORUPDUT",235,0)
 ;
"RTN","RORUPDUT",236,0)
SDL(NAME,COND) ;
"RTN","RORUPDUT",237,0)
 Q:'$G(COND) 0
"RTN","RORUPDUT",238,0)
 N DATE
"RTN","RORUPDUT",239,0)
 S DATE=$G(RORVALS("SV","ROR SRDT"))
"RTN","RORUPDUT",240,0)
 D:DATE>0
"RTN","RORUPDUT",241,0)
 . S:DATE>$G(RORVALS("SV",NAME,"DTL")) RORVALS("SV",NAME,"DTL")=DATE
"RTN","RORUPDUT",242,0)
 Q 1
"RTN","RORUPDUT",243,0)
 ;
"RTN","RORUPDUT",244,0)
 ;***** SETS VALUE OF THE SELECTION RULE
"RTN","RORUPDUT",245,0)
 ;
"RTN","RORUPDUT",246,0)
 ; RULENAME      Name of the rule
"RTN","RORUPDUT",247,0)
 ; VALUE         New value
"RTN","RORUPDUT",248,0)
 ;
"RTN","RORUPDUT",249,0)
SETVAL(RULENAME,VALUE) ;
"RTN","RORUPDUT",250,0)
 S RORVALS("SV",RULENAME)=VALUE
"RTN","RORUPDUT",251,0)
 S RORVALS("SV",RULENAME,"CNT")=$G(RORVALS("SV",RULENAME,"CNT"))+1
"RTN","RORUPDUT",252,0)
 S RORVALS("SV",RULENAME,"SUM")=$G(RORVALS("SV",RULENAME,"SUM"))+VALUE
"RTN","RORUPDUT",253,0)
 S RORVALS("SV",RULENAME,"AVG")=RORVALS("SV",RULENAME,"SUM")/RORVALS("SV",RULENAME,"CNT")
"RTN","RORUPDUT",254,0)
 ;
"RTN","RORUPDUT",255,0)
 I $G(RORVALS("SV",RULENAME,"MIN"))=""  S RORVALS("SV",RULENAME,"MIN")=VALUE
"RTN","RORUPDUT",256,0)
 E   S:VALUE<RORVALS("SV",RULENAME,"MIN") RORVALS("SV",RULENAME,"MIN")=VALUE
"RTN","RORUPDUT",257,0)
 ;
"RTN","RORUPDUT",258,0)
 I $G(RORVALS("SV",RULENAME,"MAX"))=""  S RORVALS("SV",RULENAME,"MAX")=VALUE
"RTN","RORUPDUT",259,0)
 E   S:VALUE>RORVALS("SV",RULENAME,"MAX") RORVALS("SV",RULENAME,"MAX")=VALUE
"RTN","RORUPDUT",260,0)
 Q
"RTN","RORUPDUT",261,0)
 ;
"RTN","RORUPDUT",262,0)
 ;***** GETS THE TRIGGER DATE OF THE RULE
"RTN","RORUPDUT",263,0)
 ;
"RTN","RORUPDUT",264,0)
 ; NAME          Name of the selection rule
"RTN","RORUPDUT",265,0)
 ; PFX           Prefix of the value ("GDF" or "GDL")
"RTN","RORUPDUT",266,0)
 ; COND          Result value of the logical condition
"RTN","RORUPDUT",267,0)
 ;
"RTN","RORUPDUT",268,0)
 ; Return values:
"RTN","RORUPDUT",269,0)
 ;        0  COND equals to zero
"RTN","RORUPDUT",270,0)
 ;        1  COND is not zero
"RTN","RORUPDUT",271,0)
 ;
"RTN","RORUPDUT",272,0)
SRDT(NAME,PFX,COND) ;
"RTN","RORUPDUT",273,0)
 Q:'$G(COND) 0
"RTN","RORUPDUT",274,0)
 N DATE
"RTN","RORUPDUT",275,0)
 S DATE=$G(RORVALS("SV",NAME,$S(PFX="GDL":"DTL",1:"DTF")))
"RTN","RORUPDUT",276,0)
 I DATE  S:DATE<$G(RORVALS("SV","ROR SRDT")) RORVALS("SV","ROR SRDT")=DATE
"RTN","RORUPDUT",277,0)
 Q 1
"RTN","RORUPEX")
0^141^B14367646
"RTN","RORUPEX",1,0)
RORUPEX ;HCIOFO/SG - SELECTION RULE EXPRESSION PARSER  ; 7/21/03 9:47am
"RTN","RORUPEX",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPEX",3,0)
 ;
"RTN","RORUPEX",4,0)
 Q
"RTN","RORUPEX",5,0)
 ;
"RTN","RORUPEX",6,0)
 ;***** GETS THE NEXT CHARACTER FROM THE EXPRESSION
"RTN","RORUPEX",7,0)
GETCHAR ;
"RTN","RORUPEX",8,0)
 S LOOK=$E(EXPR,EPTR),EPTR=EPTR+1
"RTN","RORUPEX",9,0)
 Q
"RTN","RORUPEX",10,0)
 ;
"RTN","RORUPEX",11,0)
 ;***** TRANSLATES FIELD OR RULE MACRO TO MUMPS CODE
"RTN","RORUPEX",12,0)
 ;
"RTN","RORUPEX",13,0)
 ; The function returns a string containing MUMPS expression
"RTN","RORUPEX",14,0)
 ; that implements the selection rule macro.
"RTN","RORUPEX",15,0)
 ;
"RTN","RORUPEX",16,0)
GETMACRO() ;
"RTN","RORUPEX",17,0)
 ;;AVG,CNT,E,GDF,GDL,I,LS,MAX,MIN,SDF,SDL,SUM
"RTN","RORUPEX",18,0)
 ;
"RTN","RORUPEX",19,0)
 Q:'$$MATCH("{") ""
"RTN","RORUPEX",20,0)
 N BI,BUF,DATELMT,NAME,PFX,PFXLST,RC,RORMSG,SFX,TMP,XCODE
"RTN","RORUPEX",21,0)
 S PFXLST=","_$P($T(GETMACRO+1),";;",2)_","
"RTN","RORUPEX",22,0)
 S BI=1,RC=0
"RTN","RORUPEX",23,0)
 F  D  Q:RC
"RTN","RORUPEX",24,0)
 . I LOOK="}"  D GETCHAR  S RC=1  Q
"RTN","RORUPEX",25,0)
 . I LOOK=":"  D GETCHAR  S BI=BI+1  Q
"RTN","RORUPEX",26,0)
 . I LOOK="{"  D  Q
"RTN","RORUPEX",27,0)
 . . I BI<3  D SNTXERR("GETMACRO^RORUPEX")  S RC=1  Q
"RTN","RORUPEX",28,0)
 . . S BUF(BI)=$G(BUF(BI))_$$GETMACRO()
"RTN","RORUPEX",29,0)
 . S BUF(BI)=$G(BUF(BI))_LOOK
"RTN","RORUPEX",30,0)
 . D GETCHAR
"RTN","RORUPEX",31,0)
 Q:ERRCODE<0 ""
"RTN","RORUPEX",32,0)
 ;--- Get the parts of the macro
"RTN","RORUPEX",33,0)
 S BI=1,(NAME,PFX,SFX)=""
"RTN","RORUPEX",34,0)
 S TMP=$$UP^XLFSTR($$TRIM^XLFSTR($G(BUF(BI))))
"RTN","RORUPEX",35,0)
 S:PFXLST[(","_TMP_",") PFX=TMP,BI=BI+1
"RTN","RORUPEX",36,0)
 S NAME=$$TRIM^XLFSTR($G(BUF(BI))),BI=BI+1
"RTN","RORUPEX",37,0)
 S SFX=$$TRIM^XLFSTR($G(BUF(BI))),BI=BI+1
"RTN","RORUPEX",38,0)
 ;--- Data element value
"RTN","RORUPEX",39,0)
 I (PFX="E")!(PFX="I")  S XCODE=""  D  Q XCODE
"RTN","RORUPEX",40,0)
 . S DATELMT=$S(+NAME=NAME:+NAME,1:$$DATACODE^RORUPDUT(FILE,NAME))
"RTN","RORUPEX",41,0)
 . I DATELMT<0  S ERRCODE=DATELMT  Q
"RTN","RORUPEX",42,0)
 . S XCODE="$G(RORVALS(""DV"","_FILE_","_DATELMT_","""_PFX_"""))"
"RTN","RORUPEX",43,0)
 . S RESULT("F",DATELMT,PFX)=""
"RTN","RORUPEX",44,0)
 ;--- Lab Search (replace a name of the Lab Search with the IEN)
"RTN","RORUPEX",45,0)
 I PFX="LS"  D  Q "$$RULE^RORUPD04("_TMP_")"
"RTN","RORUPEX",46,0)
 . I FILE'=63  D SNTXERR("GETMACRO^RORUPEX")  S TMP=""  Q
"RTN","RORUPEX",47,0)
 . S TMP="I '$P(^(0),U,2)" ; Only Active
"RTN","RORUPEX",48,0)
 . S TMP=+$$FIND1^DIC(798.9,"","X",NAME,"B",TMP,"RORMSG")
"RTN","RORUPEX",49,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.9)
"RTN","RORUPEX",50,0)
 . S:RC<0 ERRCODE=RC,TMP=0
"RTN","RORUPEX",51,0)
 . S:TMP RESULT("L",TMP)=""
"RTN","RORUPEX",52,0)
 ;--- Trigger date macros (set)
"RTN","RORUPEX",53,0)
 I PFX="SDF"  Q "$$SDF^RORUPDUT("""_NAME_""","_SFX_")"
"RTN","RORUPEX",54,0)
 I PFX="SDL"  Q "$$SDL^RORUPDUT("""_NAME_""","_SFX_")"
"RTN","RORUPEX",55,0)
 ;--- Macros processed after this point cannot reference
"RTN","RORUPEX",56,0)
 ;    the rule that they are part of the expression of
"RTN","RORUPEX",57,0)
 S RESULT("R",NAME)=""
"RTN","RORUPEX",58,0)
 ;--- Trigger date macros (get)
"RTN","RORUPEX",59,0)
 I (PFX="GDF")!(PFX="GDL")  D  Q XCODE
"RTN","RORUPEX",60,0)
 . S XCODE="$$SRDT^RORUPDUT("""_NAME_""","""_PFX_""","_SFX_")"
"RTN","RORUPEX",61,0)
 ;--- Value of the selection rule
"RTN","RORUPEX",62,0)
 Q:PFX="" "$G(RORVALS(""SV"","""_NAME_"""))"
"RTN","RORUPEX",63,0)
 Q "$G(RORVALS(""SV"","""_NAME_""","""_PFX_"""))"
"RTN","RORUPEX",64,0)
 ;
"RTN","RORUPEX",65,0)
 ;***** GETS A STRING CONSTANT FROM THE EXPRESSION
"RTN","RORUPEX",66,0)
 ;
"RTN","RORUPEX",67,0)
 ; The function returns a string argument from the expression.
"RTN","RORUPEX",68,0)
 ;
"RTN","RORUPEX",69,0)
GETSTR() ;
"RTN","RORUPEX",70,0)
 Q:'$$MATCH("""") ""
"RTN","RORUPEX",71,0)
 N RC,STR
"RTN","RORUPEX",72,0)
 S STR="",RC=0
"RTN","RORUPEX",73,0)
 F  D  Q:RC
"RTN","RORUPEX",74,0)
 . I LOOK=""""  D  Q:RC
"RTN","RORUPEX",75,0)
 . . D GETCHAR
"RTN","RORUPEX",76,0)
 . . I LOOK'=""""  S RC=1  Q
"RTN","RORUPEX",77,0)
 . . S STR=STR_""""
"RTN","RORUPEX",78,0)
 . S STR=STR_LOOK
"RTN","RORUPEX",79,0)
 . D GETCHAR
"RTN","RORUPEX",80,0)
 Q STR
"RTN","RORUPEX",81,0)
 ;
"RTN","RORUPEX",82,0)
 ;***** INITIALIZES PARSING PROCESS
"RTN","RORUPEX",83,0)
INIT ;
"RTN","RORUPEX",84,0)
 S EPTR=1,ERRCODE=0,RESULT=""
"RTN","RORUPEX",85,0)
 D GETCHAR,SKIPWHT
"RTN","RORUPEX",86,0)
 Q
"RTN","RORUPEX",87,0)
 ;
"RTN","RORUPEX",88,0)
 ;***** COMPARES LOOK-AHEAD CHARACTER TO THE ARGUMENT
"RTN","RORUPEX",89,0)
MATCH(CH) ;
"RTN","RORUPEX",90,0)
 I LOOK=CH  D GETCHAR  Q 1
"RTN","RORUPEX",91,0)
 D SNTXERR("MATCH^RORUPEX")
"RTN","RORUPEX",92,0)
 Q 0
"RTN","RORUPEX",93,0)
 ;
"RTN","RORUPEX",94,0)
 ;***** PARSES THE EXPRESSION
"RTN","RORUPEX",95,0)
 ;
"RTN","RORUPEX",96,0)
 ; FILE          File number
"RTN","RORUPEX",97,0)
 ; EXPR          Source expression
"RTN","RORUPEX",98,0)
 ; .RESULT(      Resulting MUMPS code
"RTN","RORUPEX",99,0)
 ;   "F",        List of data elements to load
"RTN","RORUPEX",100,0)
 ;     DataCode)
"RTN","RORUPEX",101,0)
 ;   "L",LS#)    List of Lab Search IENs
"RTN","RORUPEX",102,0)
 ;   "R",Rule#)  List of rules that this expression depend on
"RTN","RORUPEX",103,0)
 ;
"RTN","RORUPEX",104,0)
 ; Return values:
"RTN","RORUPEX",105,0)
 ;       <0  Error code
"RTN","RORUPEX",106,0)
 ;        0  Ok
"RTN","RORUPEX",107,0)
 ;
"RTN","RORUPEX",108,0)
PARSER(FILE,EXPR,RESULT) ;
"RTN","RORUPEX",109,0)
 N EPTR          ; Current position in the expression
"RTN","RORUPEX",110,0)
 N ERRCODE       ; Error code
"RTN","RORUPEX",111,0)
 N LOOK          ; Look-ahead character
"RTN","RORUPEX",112,0)
 ;
"RTN","RORUPEX",113,0)
 ;--- Check if the file exists and supported
"RTN","RORUPEX",114,0)
 Q:'$$VFILE^DILFD(FILE) $$ERROR^RORERR(-58,"PARSER^RORUPEX",,,FILE)
"RTN","RORUPEX",115,0)
 Q:'$D(^ROR(799.2,FILE)) $$ERROR^RORERR(-63,"PARSER^RORUPEX",,,FILE)
"RTN","RORUPEX",116,0)
 ;--- Parse the expression
"RTN","RORUPEX",117,0)
 D INIT
"RTN","RORUPEX",118,0)
 F  Q:LOOK=""  D  Q:ERRCODE<0
"RTN","RORUPEX",119,0)
 . I LOOK=""""  D  Q
"RTN","RORUPEX",120,0)
 . . S RESULT=RESULT_""""_$$GETSTR()_""""
"RTN","RORUPEX",121,0)
 . I LOOK="{"  D  Q
"RTN","RORUPEX",122,0)
 . . S RESULT=RESULT_$$GETMACRO()
"RTN","RORUPEX",123,0)
 . S RESULT=RESULT_LOOK
"RTN","RORUPEX",124,0)
 . D GETCHAR
"RTN","RORUPEX",125,0)
 ;
"RTN","RORUPEX",126,0)
 Q $S(ERRCODE<0:ERRCODE,1:0)
"RTN","RORUPEX",127,0)
 ;
"RTN","RORUPEX",128,0)
 ;***** PROCESSES A SYNTAX ERROR
"RTN","RORUPEX",129,0)
SNTXERR(PLACE,MSG) ;
"RTN","RORUPEX",130,0)
 N I,INFO  S I=0
"RTN","RORUPEX",131,0)
 S:$G(MSG)'="" I=I+1,INFO(I)=MSG
"RTN","RORUPEX",132,0)
 S I=I+1,INFO(I)="Position: "_EPTR
"RTN","RORUPEX",133,0)
 S:LOOK'="" INFO(I)=INFO(I)_", Character: '"_LOOK_"'"
"RTN","RORUPEX",134,0)
 S ERRCODE=$$ERROR^RORERR(-21,$G(PLACE),.INFO)
"RTN","RORUPEX",135,0)
 Q
"RTN","RORUPEX",136,0)
 ;
"RTN","RORUPEX",137,0)
 ;***** SKIPS WHITE SPACES IN THE EXPRESSION
"RTN","RORUPEX",138,0)
SKIPWHT ;
"RTN","RORUPEX",139,0)
 F  Q:(" "'[LOOK)!(LOOK="")  D GETCHAR
"RTN","RORUPEX",140,0)
 Q
"RTN","RORUPP01")
0^142^B14228263
"RTN","RORUPP01",1,0)
RORUPP01 ;HCIOFO/SG - PATIENT EVENTS (ERRORS)  ; 1/20/06 1:55pm
"RTN","RORUPP01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPP01",3,0)
 ;
"RTN","RORUPP01",4,0)
 ; RORUPD("LM2",         Static list of registries must be defined
"RTN","RORUPP01",5,0)
 ;   Registry#)          if you are going to use these functions.
"RTN","RORUPP01",6,0)
 ;
"RTN","RORUPP01",7,0)
 ; RORUPD("MAXPPCNT")    This node should have a positive value if
"RTN","RORUPP01",8,0)
 ;                       you are going to use these functions.
"RTN","RORUPP01",9,0)
 ;                       Otherwise, 14 will be used by default.
"RTN","RORUPP01",10,0)
 ;
"RTN","RORUPP01",11,0)
 ; See source code of the ^RORUPD routine for detailed description
"RTN","RORUPP01",12,0)
 ; of these nodes.
"RTN","RORUPP01",13,0)
 ;
"RTN","RORUPP01",14,0)
 Q
"RTN","RORUPP01",15,0)
 ;
"RTN","RORUPP01",16,0)
 ;***** ADDS THE REFERENCES TO THE LIST
"RTN","RORUPP01",17,0)
 ;
"RTN","RORUPP01",18,0)
 ; PATIEN        Patient IEN
"RTN","RORUPP01",19,0)
 ; DATE          Date to start next registry update
"RTN","RORUPP01",20,0)
 ;
"RTN","RORUPP01",21,0)
 ; Return Values:
"RTN","RORUPP01",22,0)
 ;       <0  Error code
"RTN","RORUPP01",23,0)
 ;        0  Ok
"RTN","RORUPP01",24,0)
 ;
"RTN","RORUPP01",25,0)
ADD(PATIEN,DATE) ;
"RTN","RORUPP01",26,0)
 N I,IENS,MAXCNT,RC,REGIEN,RORBUF,RORFDA,RORIEN,RORMSG,TMP,URLST
"RTN","RORUPP01",27,0)
 S MAXCNT=$$MAXCNT()
"RTN","RORUPP01",28,0)
 I $D(^RORDATA(798.3,PATIEN,1,"B"))>1  S RC=0  D  Q:RC<0 RC
"RTN","RORUPP01",29,0)
 . ;--- Get a list of existing patient error records
"RTN","RORUPP01",30,0)
 . S IENS=","_PATIEN_",",I="I $D(RORUPD(""LM2"",+$P(^(0),U)))"
"RTN","RORUPP01",31,0)
 . D LIST^DIC(798.31,IENS,"@;.01I;1I;2",,,,,"B",I,,"RORBUF","RORMSG")
"RTN","RORUPP01",32,0)
 . I $G(DIERR)  D  Q
"RTN","RORUPP01",33,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,798.31,IENS)
"RTN","RORUPP01",34,0)
 . Q:'$G(RORBUF("DILIST",0))
"RTN","RORUPP01",35,0)
 . ;--- Prepare FDA for records to update
"RTN","RORUPP01",36,0)
 . S I=""
"RTN","RORUPP01",37,0)
 . F  S I=$O(RORBUF("DILIST",2,I))  Q:I=""  D
"RTN","RORUPP01",38,0)
 . . S REGIEN=+$G(RORBUF("DILIST","ID",I,.01))
"RTN","RORUPP01",39,0)
 . . S URLST(REGIEN)=""
"RTN","RORUPP01",40,0)
 . . Q:$G(RORBUF("DILIST","ID",I,2))'<MAXCNT
"RTN","RORUPP01",41,0)
 . . S IENS=RORBUF("DILIST",2,I)_","_PATIEN_","
"RTN","RORUPP01",42,0)
 . . S TMP=$G(RORBUF("DILIST","ID",I,1))
"RTN","RORUPP01",43,0)
 . . S RORFDA(798.31,IENS,1)=$S(TMP&(TMP<DATE):TMP,1:DATE)
"RTN","RORUPP01",44,0)
 . . S RORFDA(798.31,IENS,2)=$G(RORBUF("DILIST","ID",I,2))+1
"RTN","RORUPP01",45,0)
 . Q:$D(RORFDA)<10
"RTN","RORUPP01",46,0)
 . ;--- Update the records
"RTN","RORUPP01",47,0)
 . D FILE^DIE("K","RORFDA","RORMSG")
"RTN","RORUPP01",48,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798.31)
"RTN","RORUPP01",49,0)
 ;--- Prepare FDA for records to create
"RTN","RORUPP01",50,0)
 S REGIEN="",I=1
"RTN","RORUPP01",51,0)
 F  S REGIEN=$O(RORUPD("LM2",REGIEN))  Q:REGIEN=""  D
"RTN","RORUPP01",52,0)
 . Q:$D(URLST(REGIEN))
"RTN","RORUPP01",53,0)
 . S I=I+1,IENS="+"_I_",?+1,"
"RTN","RORUPP01",54,0)
 . S RORFDA(798.31,IENS,.01)=REGIEN
"RTN","RORUPP01",55,0)
 . S RORFDA(798.31,IENS,1)=DATE
"RTN","RORUPP01",56,0)
 . S RORFDA(798.31,IENS,2)=1
"RTN","RORUPP01",57,0)
 ;--- Create the records
"RTN","RORUPP01",58,0)
 I $D(RORFDA)>1  S RC=0  D  Q:RC<0 RC
"RTN","RORUPP01",59,0)
 . S (RORFDA(798.3,"?+1,",.01),RORIEN(1))=PATIEN
"RTN","RORUPP01",60,0)
 . D UPDATE^DIE(,"RORFDA","RORIEN","RORMSG")
"RTN","RORUPP01",61,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798.31)
"RTN","RORUPP01",62,0)
 Q 0
"RTN","RORUPP01",63,0)
 ;
"RTN","RORUPP01",64,0)
 ;***** RETURNS THE THRESHOLD VALUE OF THE ERROR COUNTER
"RTN","RORUPP01",65,0)
MAXCNT() ;
"RTN","RORUPP01",66,0)
 Q $S($G(RORUPD("MAXPPCNT"))>0:+RORUPD("MAXPPCNT"),1:14)
"RTN","RORUPP01",67,0)
 ;
"RTN","RORUPP01",68,0)
 ;***** REMOVES THE REFERNCES FROM THE LIST
"RTN","RORUPP01",69,0)
 ;
"RTN","RORUPP01",70,0)
 ; PATIEN        Patient IEN
"RTN","RORUPP01",71,0)
 ; [ROR8LST]     Closed root of an array containg list of registry
"RTN","RORUPP01",72,0)
 ;               IENs as subscripts. $NA(RORUPD("LM2")) is used
"RTN","RORUPP01",73,0)
 ;               by default. Only records associated with these
"RTN","RORUPP01",74,0)
 ;               registries will be removed.
"RTN","RORUPP01",75,0)
 ;
"RTN","RORUPP01",76,0)
 ; Return Values:
"RTN","RORUPP01",77,0)
 ;       <0  Error code
"RTN","RORUPP01",78,0)
 ;        0  Ok
"RTN","RORUPP01",79,0)
 ;
"RTN","RORUPP01",80,0)
REMOVE(PATIEN,ROR8LST) ;
"RTN","RORUPP01",81,0)
 Q:$D(^RORDATA(798.3,PATIEN,1,"B"))<10 0
"RTN","RORUPP01",82,0)
 N I,IENS,RC,RORBUF,RORFDA,RORMSG
"RTN","RORUPP01",83,0)
 S:$G(ROR8LST)="" ROR8LST=$NA(RORUPD("LM2"))
"RTN","RORUPP01",84,0)
 S IENS=","_PATIEN_",",I="I $D(@ROR8LST@(+$P(^(0),U)))"
"RTN","RORUPP01",85,0)
 D LIST^DIC(798.31,IENS,"@",,,,,"B",I,,"RORBUF","RORMSG")
"RTN","RORUPP01",86,0)
 I $G(DIERR)  D  Q RC
"RTN","RORUPP01",87,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.31,IENS)
"RTN","RORUPP01",88,0)
 Q:'$G(RORBUF("DILIST",0)) 0
"RTN","RORUPP01",89,0)
 S I=""
"RTN","RORUPP01",90,0)
 F  S I=$O(RORBUF("DILIST",2,I))  Q:I=""  D
"RTN","RORUPP01",91,0)
 . S IENS=RORBUF("DILIST",2,I)_","_PATIEN_","
"RTN","RORUPP01",92,0)
 . S RORFDA(798.31,IENS,.01)="@"
"RTN","RORUPP01",93,0)
 D FILE^DIE("K","RORFDA","RORMSG")
"RTN","RORUPP01",94,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.31)
"RTN","RORUPP01",95,0)
 Q 0
"RTN","RORUPP01",96,0)
 ;
"RTN","RORUPP01",97,0)
 ;***** RETURNS START DATE FOR THE DATA SCAN (IF ANY)
"RTN","RORUPP01",98,0)
 ;
"RTN","RORUPP01",99,0)
 ; PATIEN        Patient IEN
"RTN","RORUPP01",100,0)
 ;
"RTN","RORUPP01",101,0)
 ; Return Values:
"RTN","RORUPP01",102,0)
 ;       <0  Error code
"RTN","RORUPP01",103,0)
 ;       ""  There is no date for the patient in the file
"RTN","RORUPP01",104,0)
 ;       >0  Start date
"RTN","RORUPP01",105,0)
 ;
"RTN","RORUPP01",106,0)
SDSDATE(PATIEN) ;
"RTN","RORUPP01",107,0)
 Q:$D(^RORDATA(798.3,PATIEN,1,"B"))<10 ""
"RTN","RORUPP01",108,0)
 N CNT,DATE,I,IENS,MAXCNT,RC,RORBUF,RORMSG,TMP
"RTN","RORUPP01",109,0)
 ;--- Load the pending references (in chronological order)
"RTN","RORUPP01",110,0)
 S IENS=","_PATIEN_",",I="I $D(RORUPD(""LM2"",+$P(^(0),U)))"
"RTN","RORUPP01",111,0)
 D LIST^DIC(798.31,IENS,"@;1I;2",,,,,"AD",I,,"RORBUF","RORMSG")
"RTN","RORUPP01",112,0)
 I $G(DIERR)  D  Q RC
"RTN","RORUPP01",113,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.31,IENS)
"RTN","RORUPP01",114,0)
 Q:'$G(RORBUF("DILIST",0)) ""
"RTN","RORUPP01",115,0)
 ;--- Get and return the earliest date
"RTN","RORUPP01",116,0)
 S MAXCNT=$$MAXCNT()
"RTN","RORUPP01",117,0)
 S (DATE,I)="",CNT=0
"RTN","RORUPP01",118,0)
 F  S I=$O(RORBUF("DILIST","ID",I))  Q:I=""  D  Q:CNT&DATE
"RTN","RORUPP01",119,0)
 . S:$G(RORBUF("DILIST","ID",I,2))<MAXCNT CNT=CNT+1
"RTN","RORUPP01",120,0)
 . S:'DATE DATE=$G(RORBUF("DILIST","ID",I,1))
"RTN","RORUPP01",121,0)
 Q $S('CNT:$$ERROR^RORERR(-66,,,PATIEN),1:DATE)
"RTN","RORUPP02")
0^143^B13632896
"RTN","RORUPP02",1,0)
RORUPP02 ;HCIOFO/SG - PATIENT EVENTS (EVENTS)  ; 1/20/06 1:55pm
"RTN","RORUPP02",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPP02",3,0)
 ;
"RTN","RORUPP02",4,0)
 Q
"RTN","RORUPP02",5,0)
 ;
"RTN","RORUPP02",6,0)
 ;***** ADDS THE EVENT REFERENCE
"RTN","RORUPP02",7,0)
 ;
"RTN","RORUPP02",8,0)
 ; PATIEN        Patient IEN
"RTN","RORUPP02",9,0)
 ;
"RTN","RORUPP02",10,0)
 ; AREA          Data area of the event (see the DATA AREA field
"RTN","RORUPP02",11,0)
 ;               of the file #798.3 for details)
"RTN","RORUPP02",12,0)
 ;
"RTN","RORUPP02",13,0)
 ; [DATE]        Date/Time associated with the event (the current
"RTN","RORUPP02",14,0)
 ;               date/time is used by default).
"RTN","RORUPP02",15,0)
 ;
"RTN","RORUPP02",16,0)
 ; Return Values:
"RTN","RORUPP02",17,0)
 ;       <0  Error code
"RTN","RORUPP02",18,0)
 ;        0  Ok
"RTN","RORUPP02",19,0)
 ;
"RTN","RORUPP02",20,0)
ADD(PATIEN,AREA,DATE) ;
"RTN","RORUPP02",21,0)
 N IEN,IENS,RORFDA,RORIEN,RORMSG
"RTN","RORUPP02",22,0)
 S:$G(DATE)'>0 DATE=$$NOW^XLFDT
"RTN","RORUPP02",23,0)
 ;--- Do not record more than one reference per associated date.
"RTN","RORUPP02",24,0)
 ;    Maybe in the future all references will be recorded but we
"RTN","RORUPP02",25,0)
 ;    need only daily precision at the moment. If the reference
"RTN","RORUPP02",26,0)
 ;    exists already, update it with the earlier associated date
"RTN","RORUPP02",27,0)
 ;--- and the latter timestamp if necessary.
"RTN","RORUPP02",28,0)
 S IEN=$O(^RORDATA(798.3,+PATIEN,2,"AD",AREA,DATE\1,""))
"RTN","RORUPP02",29,0)
 I IEN  K DIERR  D  Q $S('$G(DIERR):0,1:-9)
"RTN","RORUPP02",30,0)
 . N BUF,NOW
"RTN","RORUPP02",31,0)
 . S IENS=IEN_","_(+PATIEN)_",",NOW=$$NOW^XLFDT
"RTN","RORUPP02",32,0)
 . S BUF=$G(^RORDATA(798.3,+PATIEN,2,IEN,0))
"RTN","RORUPP02",33,0)
 . S:NOW>$P(BUF,"^") RORFDA(798.32,IENS,.01)=NOW
"RTN","RORUPP02",34,0)
 . S:DATE<$P(BUF,"^",3) RORFDA(798.32,IENS,2)=DATE
"RTN","RORUPP02",35,0)
 . D:$D(RORFDA)>1 FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORUPP02",36,0)
 ;--- Create the new event reference
"RTN","RORUPP02",37,0)
 S (RORFDA(798.3,"?+1,",.01),RORIEN(1))=+PATIEN
"RTN","RORUPP02",38,0)
 S IENS="+2,?+1,"
"RTN","RORUPP02",39,0)
 S RORFDA(798.32,IENS,.01)=$$NOW^XLFDT
"RTN","RORUPP02",40,0)
 S RORFDA(798.32,IENS,1)=AREA
"RTN","RORUPP02",41,0)
 S RORFDA(798.32,IENS,2)=DATE
"RTN","RORUPP02",42,0)
 D UPDATE^DIE(,"RORFDA","RORIEN","RORMSG")
"RTN","RORUPP02",43,0)
 Q $S('$G(DIERR):0,1:-9)
"RTN","RORUPP02",44,0)
 ;
"RTN","RORUPP02",45,0)
 ;***** CHECKS THE EVENTS
"RTN","RORUPP02",46,0)
 ;
"RTN","RORUPP02",47,0)
 ; PATIEN        Patient IEN
"RTN","RORUPP02",48,0)
 ;
"RTN","RORUPP02",49,0)
 ; AREA          Data area of the event (see the DATA AREA field
"RTN","RORUPP02",50,0)
 ;               of the file #798.3 for details)
"RTN","RORUPP02",51,0)
 ;
"RTN","RORUPP02",52,0)
 ; .SDT          Reference to a local variable containing the start
"RTN","RORUPP02",53,0)
 ;               date. The date can be modified by the function and
"RTN","RORUPP02",54,0)
 ;               returned via this parameter.
"RTN","RORUPP02",55,0)
 ;
"RTN","RORUPP02",56,0)
 ; .EDT          Reference to a local variable containing the end
"RTN","RORUPP02",57,0)
 ;               date. The date can be modified by the function and
"RTN","RORUPP02",58,0)
 ;               returned via this parameter.
"RTN","RORUPP02",59,0)
 ;
"RTN","RORUPP02",60,0)
 ; Return Values:
"RTN","RORUPP02",61,0)
 ;       <0  Error code
"RTN","RORUPP02",62,0)
 ;        0  No events (skip)
"RTN","RORUPP02",63,0)
 ;        1  Events have been found (proceed)
"RTN","RORUPP02",64,0)
 ;        2  The same as 1 + dates (SDT & EDT) have been modified
"RTN","RORUPP02",65,0)
 ;
"RTN","RORUPP02",66,0)
GET(PATIEN,AREA,SDT,EDT) ;
"RTN","RORUPP02",67,0)
 N ED,FDTC,FEVT,IEN,NEWEDT,NEWSDT,ROOT,TMP
"RTN","RORUPP02",68,0)
 S ROOT=$NA(^RORDATA(798.3,+PATIEN,2))
"RTN","RORUPP02",69,0)
 S NEWSDT=999999999,NEWEDT=0,(FDTC,FEVT)=0
"RTN","RORUPP02",70,0)
 ;--- If the data search time frame is too wide and some of the
"RTN","RORUPP02",71,0)
 ;    event references have been purged already then the time
"RTN","RORUPP02",72,0)
 ;    frame cannot be shrinked according to the references and the
"RTN","RORUPP02",73,0)
 ;--- patient cannot be skipped if there are no references at all.
"RTN","RORUPP02",74,0)
 S:SDT<$G(RORUPD("EETS")) NEWSDT=SDT,NEWEDT=EDT,FEVT=1
"RTN","RORUPP02",75,0)
 ;--- Browse through the event references
"RTN","RORUPP02",76,0)
 S ED=$O(@ROOT@("AT",AREA,SDT),-1)
"RTN","RORUPP02",77,0)
 F  S ED=$O(@ROOT@("AT",AREA,ED))  Q:(ED="")!(ED'<EDT)  D
"RTN","RORUPP02",78,0)
 . S IEN=""
"RTN","RORUPP02",79,0)
 . F  S IEN=$O(@ROOT@("AT",AREA,ED,IEN))  Q:IEN=""  D
"RTN","RORUPP02",80,0)
 . . S TMP=$P($G(@ROOT@(IEN,0)),"^",3),FEVT=1
"RTN","RORUPP02",81,0)
 . . Q:TMP'>0
"RTN","RORUPP02",82,0)
 . . S:TMP<NEWSDT NEWSDT=TMP,FDTC=1
"RTN","RORUPP02",83,0)
 . . S:TMP>NEWEDT NEWEDT=TMP,FDTC=1
"RTN","RORUPP02",84,0)
 Q:'FEVT 0
"RTN","RORUPP02",85,0)
 I FDTC  S SDT=NEWSDT,EDT=NEWEDT  Q 2
"RTN","RORUPP02",86,0)
 Q 1
"RTN","RORUPP02",87,0)
 ;
"RTN","RORUPP02",88,0)
 ;***** PURGES THE OLD EVENT REFERENCES
"RTN","RORUPP02",89,0)
 ;
"RTN","RORUPP02",90,0)
 ; DATE          Keep the references starting from this date
"RTN","RORUPP02",91,0)
 ;
"RTN","RORUPP02",92,0)
 ; Return Values:
"RTN","RORUPP02",93,0)
 ;       <0  Error code
"RTN","RORUPP02",94,0)
 ;        0  Ok
"RTN","RORUPP02",95,0)
 ;
"RTN","RORUPP02",96,0)
PURGE(DATE) ;
"RTN","RORUPP02",97,0)
 N CNT,DA,DIK,IEN,IEN1,IENS,RC,REINDEX,ROOT,RORFDA,RORMSG
"RTN","RORUPP02",98,0)
 S ROOT=$$ROOT^DILFD(798.3,,1)
"RTN","RORUPP02",99,0)
 S DATE=DATE\1,(CNT,RC)=0
"RTN","RORUPP02",100,0)
 F  S DATE=$O(@ROOT@("AT",DATE),-1)  Q:DATE=""  D  Q:RC<0
"RTN","RORUPP02",101,0)
 . S IEN=""
"RTN","RORUPP02",102,0)
 . F  S IEN=$O(@ROOT@("AT",DATE,IEN))  Q:IEN=""  D  Q:RC<0
"RTN","RORUPP02",103,0)
 . . S IEN1="",REINDEX=0
"RTN","RORUPP02",104,0)
 . . F  S IEN1=$O(@ROOT@("AT",DATE,IEN,IEN1))  Q:IEN1=""  D  Q:RC<0
"RTN","RORUPP02",105,0)
 . . . ;---Check if the corresponding record exists
"RTN","RORUPP02",106,0)
 . . . I '$D(@ROOT@(IEN,2,IEN1,0))  D  Q
"RTN","RORUPP02",107,0)
 . . . . ;--- Delete the "stray" entry from the cross-reference
"RTN","RORUPP02",108,0)
 . . . . K @ROOT@("AT",DATE,IEN,IEN1)
"RTN","RORUPP02",109,0)
 . . . ;--- Delete the record
"RTN","RORUPP02",110,0)
 . . . S IENS=IEN1_","_IEN_","
"RTN","RORUPP02",111,0)
 . . . S RORFDA(798.32,IENS,.01)="@"
"RTN","RORUPP02",112,0)
 . . . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORUPP02",113,0)
 . . . I $G(DIERR)  D  Q
"RTN","RORUPP02",114,0)
 . . . . S RC=$$DBS^RORERR("RORMSG",-9,,,798.32,IENS)
"RTN","RORUPP02",115,0)
 . . . S CNT=CNT+1
"RTN","RORUPP02",116,0)
 . . ;--- Re-index the main record if necessary
"RTN","RORUPP02",117,0)
 . . I REINDEX  K DA  S DIK=$$OREF^DILF(ROOT),DA=IEN  D IX^DIK
"RTN","RORUPP02",118,0)
 D:CNT>0 LOG^RORLOG(2,CNT_" events were purged from the file #798.3")
"RTN","RORUPP02",119,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUPR")
0^144^B27398451
"RTN","RORUPR",1,0)
RORUPR ;HCIOFO/SG - SELECTION RULES PREPARATION  ; 5/12/05 9:22am
"RTN","RORUPR",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPR",3,0)
 ;
"RTN","RORUPR",4,0)
 Q
"RTN","RORUPR",5,0)
 ;
"RTN","RORUPR",6,0)
 ;***** PREPARES SELECTION RULES AND OTHER DATA
"RTN","RORUPR",7,0)
 ;
"RTN","RORUPR",8,0)
 ; .REGLST       Reference to a local array containing registry names
"RTN","RORUPR",9,0)
 ;               as subscripts and optional registry IENs as values
"RTN","RORUPR",10,0)
 ;
"RTN","RORUPR",11,0)
 ; [LMODE]       When stop looping through records of the patient:
"RTN","RORUPR",12,0)
 ;                 0  always loop through all records
"RTN","RORUPR",13,0)
 ;                 1  all top level rules have been triggered (deflt)
"RTN","RORUPR",14,0)
 ;                 2  patient has been marked for addition to all
"RTN","RORUPR",15,0)
 ;                    registries being processed
"RTN","RORUPR",16,0)
 ;
"RTN","RORUPR",17,0)
 ; [DSBEG]       Start date/time of the data scan (the earliest
"RTN","RORUPR",18,0)
 ;               registry update date by default)
"RTN","RORUPR",19,0)
 ;
"RTN","RORUPR",20,0)
 ; [DSEND]       End date/time of the data scan (NOW by default)
"RTN","RORUPR",21,0)
 ;
"RTN","RORUPR",22,0)
 ; Return Values:
"RTN","RORUPR",23,0)
 ;        0  Ok
"RTN","RORUPR",24,0)
 ;       <0  Error code
"RTN","RORUPR",25,0)
 ;
"RTN","RORUPR",26,0)
PREPARE(REGLST,LMODE,DSBEG,DSEND) ;
"RTN","RORUPR",27,0)
 N FILE,I,RC
"RTN","RORUPR",28,0)
 ;--- Clear loop control lists
"RTN","RORUPR",29,0)
 K RORUPD("LM")  S RORUPD("LM")=+$G(LMODE,1)
"RTN","RORUPR",30,0)
 ;--- Load registry parameters
"RTN","RORUPR",31,0)
 S RC=$$PREPARE1(.REGLST,$G(DSBEG),$G(DSEND))  Q:RC<0 RC
"RTN","RORUPR",32,0)
 ;--- Load selection rules
"RTN","RORUPR",33,0)
 S RC=$$LOAD^RORUPR1(.REGLST)        Q:RC<0 $$ERROR^RORERR(-19)
"RTN","RORUPR",34,0)
 ;--- Load and prepare Lab search data
"RTN","RORUPR",35,0)
 S RC=$$LABSRCH^RORUPR1()            Q:RC<0 $$ERROR^RORERR(-12)
"RTN","RORUPR",36,0)
 ;--- Sort loaded rules
"RTN","RORUPR",37,0)
 S RC=$$SORT()                       Q:RC<0 $$ERROR^RORERR(-20)
"RTN","RORUPR",38,0)
 ;--- Load and prepare metadata
"RTN","RORUPR",39,0)
 S RC=$$METADATA^RORUPR1()           Q:RC<0 RC
"RTN","RORUPR",40,0)
 Q 0
"RTN","RORUPR",41,0)
 ;
"RTN","RORUPR",42,0)
 ;***** LOADS REGISTRY PARAMETERS
"RTN","RORUPR",43,0)
 ;
"RTN","RORUPR",44,0)
 ; .REGLST       Reference to a local array containing
"RTN","RORUPR",45,0)
 ;               registry names as subscripts
"RTN","RORUPR",46,0)
 ;
"RTN","RORUPR",47,0)
 ; [DSBEG]       Start date of the data scan (the earliest registry
"RTN","RORUPR",48,0)
 ;               update date by default). Time part of the parameter
"RTN","RORUPR",49,0)
 ;               value is ignored.
"RTN","RORUPR",50,0)
 ;
"RTN","RORUPR",51,0)
 ; [DSEND]       End date/time of the data scan (NOW by default).
"RTN","RORUPR",52,0)
 ;
"RTN","RORUPR",53,0)
 ; Return Values:
"RTN","RORUPR",54,0)
 ;        0  Ok
"RTN","RORUPR",55,0)
 ;       <0  Error code
"RTN","RORUPR",56,0)
 ;
"RTN","RORUPR",57,0)
PREPARE1(REGLST,DSBEG,DSEND) ;
"RTN","RORUPR",58,0)
 N DATE,EVTPROT,I,RC,REGIEN,REGNAME,RORBUF,TMP,UPDSTART
"RTN","RORUPR",59,0)
 K RORUPD("LD"),RORUPD("LM2"),RORUPD("UPD")
"RTN","RORUPR",60,0)
 S DSBEG=$G(DSBEG)\1,DSEND=+$G(DSEND)
"RTN","RORUPR",61,0)
 S UPDSTART=$$DT^XLFDT,EVTPROT=0
"RTN","RORUPR",62,0)
 ;---
"RTN","RORUPR",63,0)
 S REGNAME="",RC=0
"RTN","RORUPR",64,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:RC<0
"RTN","RORUPR",65,0)
 . S TMP="1I;6.1;6.2;15.1;25I;26I"
"RTN","RORUPR",66,0)
 . S REGIEN=$$REGIEN^RORUTL02(REGNAME,TMP,.RORBUF)
"RTN","RORUPR",67,0)
 . I REGIEN'>0  S RC=$$ERROR^RORERR(-46,,REGNAME)  Q
"RTN","RORUPR",68,0)
 . ;--- Add an item to the static list of registries
"RTN","RORUPR",69,0)
 . S RORUPD("LM2",REGIEN)=U_$G(RORBUF("DILIST","ID",1,26))
"RTN","RORUPR",70,0)
 . ;--- Load and verify update entry points
"RTN","RORUPR",71,0)
 . S RC=0
"RTN","RORUPR",72,0)
 . F I=1,2  D  Q:RC<0
"RTN","RORUPR",73,0)
 . . S TMP=$G(RORBUF("DILIST","ID",1,+("6."_I)))
"RTN","RORUPR",74,0)
 . . S TMP=$$TRIM^XLFSTR(TMP)  Q:TMP=""
"RTN","RORUPR",75,0)
 . . S RC=$$VERIFYEP^RORUTL01(TMP)
"RTN","RORUPR",76,0)
 . . S:RC'<0 RORUPD("UPD",REGIEN,I)=TMP
"RTN","RORUPR",77,0)
 . I RC<0  S RC=$$ERROR^RORERR(-6,,REGNAME,,TMP)  Q
"RTN","RORUPR",78,0)
 . ;--- Calculate the earliest update date for the registries
"RTN","RORUPR",79,0)
 . ;    being processed
"RTN","RORUPR",80,0)
 . S DATE=$G(RORBUF("DILIST","ID",1,1))\1
"RTN","RORUPR",81,0)
 . I DATE  S:DATE<UPDSTART UPDSTART=DATE
"RTN","RORUPR",82,0)
 . ;--- Calculate the longest lag interval
"RTN","RORUPR",83,0)
 . S TMP=$G(RORBUF("DILIST","ID",1,15.1))
"RTN","RORUPR",84,0)
 . S:TMP>$G(RORUPD("LD",1)) RORUPD("LD",1)=TMP
"RTN","RORUPR",85,0)
 . ;--- Check if event references should be used
"RTN","RORUPR",86,0)
 . S:$G(RORBUF("DILIST","ID",1,25)) EVTPROT=1
"RTN","RORUPR",87,0)
 Q:RC<0 RC
"RTN","RORUPR",88,0)
 ;--- Check the lag interval
"RTN","RORUPR",89,0)
 S:$G(RORUPD("LD",1))'>0 RORUPD("LD",1)=1
"RTN","RORUPR",90,0)
 ;--- Define data scan period
"RTN","RORUPR",91,0)
 S RORUPD("DT")=$$NOW^XLFDT
"RTN","RORUPR",92,0)
 S RORUPD("DSBEG")=$S(DSBEG:DSBEG,1:UPDSTART)
"RTN","RORUPR",93,0)
 S RORUPD("DSEND")=$S(DSEND:DSEND,1:RORUPD("DT"))
"RTN","RORUPR",94,0)
 ;--- Check if we have event references in the file #798.3
"RTN","RORUPR",95,0)
 S RORUPD("EETS")=$O(^RORDATA(798.3,"AT",""))
"RTN","RORUPR",96,0)
 S:'RORUPD("EETS") EVTPROT=0
"RTN","RORUPR",97,0)
 ;--- Check the control flags
"RTN","RORUPR",98,0)
 S:'EVTPROT RORUPD("FLAGS")=$TR($G(RORUPD("FLAGS")),"E")
"RTN","RORUPR",99,0)
 Q 0
"RTN","RORUPR",100,0)
 ;
"RTN","RORUPR",101,0)
 ;***** PUTS THE RULE INTO THE LIST
"RTN","RORUPR",102,0)
 ;
"RTN","RORUPR",103,0)
 ; RULENAME      Name of the rule
"RTN","RORUPR",104,0)
 ; MODE          "A" (process after subfiles) or
"RTN","RORUPR",105,0)
 ;               "B" (process before subfiles)
"RTN","RORUPR",106,0)
 ; PARENT        Name of the parent rule
"RTN","RORUPR",107,0)
 ; 
"RTN","RORUPR",108,0)
 ; Return Values:
"RTN","RORUPR",109,0)
 ;        0  Ok
"RTN","RORUPR",110,0)
 ;       <0  Error code
"RTN","RORUPR",111,0)
 ;
"RTN","RORUPR",112,0)
PUTRULE(RULENAME,MODE,PARENT) ;
"RTN","RORUPR",113,0)
 N CODE,DSTNODE,DEPNAME,HDR,FILE,IR,IC
"RTN","RORUPR",114,0)
 S HDR=$G(@RORUPDPI@(3,RULENAME)),FILE=+$P(HDR,U,2)
"RTN","RORUPR",115,0)
 ;--- If the rule has already been processed, try to remove it from
"RTN","RORUPR",116,0)
 ;    the dependency list of the parent rule
"RTN","RORUPR",117,0)
 I $P(HDR,U,3)  D REMOVE(RULENAME,FILE,MODE,$G(PARENT))  Q 0
"RTN","RORUPR",118,0)
 ;--- If the rule is in the list of parent rules already, it has been
"RTN","RORUPR",119,0)
 ;    mentioned ; somewhere above in the current processing path.
"RTN","RORUPR",120,0)
 ;    So, we have "cirle refrenece" (the rule directly or inderectly
"RTN","RORUPR",121,0)
 ;    depends on itself)
"RTN","RORUPR",122,0)
 Q:$D(LSTRUL(RULENAME)) $$ERROR^RORERR(-5,,RULENAME)
"RTN","RORUPR",123,0)
 ;--- Put the rule into the list of parent rules
"RTN","RORUPR",124,0)
 S LSTRUL(RULENAME)=""
"RTN","RORUPR",125,0)
 ;--- Process the rules that this one depends on
"RTN","RORUPR",126,0)
 S DEPNAME=""
"RTN","RORUPR",127,0)
 F  S DEPNAME=$O(@RORUPDPI@(3,RULENAME,3,DEPNAME))  Q:DEPNAME=""  D  Q:RC<0
"RTN","RORUPR",128,0)
 . S RC=$$PUTRULE(DEPNAME,MODE,RULENAME)
"RTN","RORUPR",129,0)
 ;--- Remove the rule from the list of parent rules
"RTN","RORUPR",130,0)
 K LSTRUL(RULENAME)  Q:RC<0 RC
"RTN","RORUPR",131,0)
 ;--- Process the rule (put it in the sorted list of rules) if there
"RTN","RORUPR",132,0)
 ;    are no rules left in its dependency list
"RTN","RORUPR",133,0)
 D:$D(@RORUPDPI@(3,RULENAME,3))<10
"RTN","RORUPR",134,0)
 . S IR=$O(RORUPD("SR",FILE,MODE,""),-1)+1
"RTN","RORUPR",135,0)
 . S DSTNODE=$NA(RORUPD("SR",FILE,MODE,IR))
"RTN","RORUPR",136,0)
 . S @DSTNODE=RULENAME_U_+HDR_U_$P(HDR,U,4)
"RTN","RORUPR",137,0)
 . S @DSTNODE@(1)=@RORUPDPI@(3,RULENAME,1)
"RTN","RORUPR",138,0)
 . M @DSTNODE@(2)=@RORUPDPI@(3,RULENAME,2)
"RTN","RORUPR",139,0)
 . S $P(@RORUPDPI@(3,RULENAME),U,3)=1
"RTN","RORUPR",140,0)
 . ;--- Try to remove the rule from the dependency list of
"RTN","RORUPR",141,0)
 . ;    the parent rule
"RTN","RORUPR",142,0)
 . D REMOVE(RULENAME,FILE,MODE,$G(PARENT))
"RTN","RORUPR",143,0)
 Q 0
"RTN","RORUPR",144,0)
 ;
"RTN","RORUPR",145,0)
 ;***** REMOVES THE RULE FROM THE DEPENDENCY LIST OF THE PARENT RULE
"RTN","RORUPR",146,0)
 ;
"RTN","RORUPR",147,0)
 ; RULENAME      Name of the rule
"RTN","RORUPR",148,0)
 ; FILE          File number
"RTN","RORUPR",149,0)
 ; MODE          "A" (process after subfiles) or
"RTN","RORUPR",150,0)
 ;               "B" (process before subfiles)
"RTN","RORUPR",151,0)
 ; PARENT        Name of the parent rule
"RTN","RORUPR",152,0)
 ;
"RTN","RORUPR",153,0)
 ; During the first pass of the sort ("before" rules) a rule is
"RTN","RORUPR",154,0)
 ; removed from the parent's dependency list only if the rule is
"RTN","RORUPR",155,0)
 ; associated with the same file as its parent.
"RTN","RORUPR",156,0)
 ;
"RTN","RORUPR",157,0)
 ; Rules are always removed from the dependency list during
"RTN","RORUPR",158,0)
 ; the second sort pass ("after" rules").
"RTN","RORUPR",159,0)
 ;
"RTN","RORUPR",160,0)
REMOVE(RULENAME,FILE,MODE,PARENT) ;
"RTN","RORUPR",161,0)
 Q:$G(PARENT)=""
"RTN","RORUPR",162,0)
 K:(+$P($G(@RORUPDPI@(3,PARENT)),U,2)=FILE)!(MODE="A") @RORUPDPI@(3,PARENT,3,RULENAME)
"RTN","RORUPR",163,0)
 Q
"RTN","RORUPR",164,0)
 ;
"RTN","RORUPR",165,0)
 ;***** SORTS SELECTION RULES
"RTN","RORUPR",166,0)
 ;
"RTN","RORUPR",167,0)
 ; Return Values:
"RTN","RORUPR",168,0)
 ;        0  Ok
"RTN","RORUPR",169,0)
 ;       <0  Error code
"RTN","RORUPR",170,0)
 ;
"RTN","RORUPR",171,0)
SORT() ;
"RTN","RORUPR",172,0)
 N LSTRUL        ; List of names of the parent rules above in the path
"RTN","RORUPR",173,0)
 ;
"RTN","RORUPR",174,0)
 N FILE,MODE,RC,RULENAME
"RTN","RORUPR",175,0)
 S RC=0  K RORUPD("SR")
"RTN","RORUPR",176,0)
 ;--- Process "before" selection rules first and then process
"RTN","RORUPR",177,0)
 ;  "after" rules
"RTN","RORUPR",178,0)
 F MODE="B","A"  D  Q:RC
"RTN","RORUPR",179,0)
 . S FILE=""             ; Loop through affected files
"RTN","RORUPR",180,0)
 . F  S FILE=$O(@RORUPDPI@(1,FILE))  Q:FILE=""  D  Q:RC
"RTN","RORUPR",181,0)
 . . S RULENAME=""       ; Loop through top level rules
"RTN","RORUPR",182,0)
 . . F  S RULENAME=$O(@RORUPDPI@(1,FILE,"S",RULENAME))  Q:RULENAME=""  D  Q:RC<0
"RTN","RORUPR",183,0)
 . . . S RC=$$PUTRULE(RULENAME,MODE)
"RTN","RORUPR",184,0)
 ;---
"RTN","RORUPR",185,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUPR1")
0^145^B69715396
"RTN","RORUPR1",1,0)
RORUPR1 ;HCIOFO/SG - SELECTION RULES PREPARATION  ; 11/20/05 4:56pm
"RTN","RORUPR1",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUPR1",3,0)
 ;
"RTN","RORUPR1",4,0)
 Q
"RTN","RORUPR1",5,0)
 ;
"RTN","RORUPR1",6,0)
 ;***** MARKS PARENT FILES TO PROCESS
"RTN","RORUPR1",7,0)
 ;
"RTN","RORUPR1",8,0)
 ; This function analyzes file dependencies defined by the 'ROR
"RTN","RORUPR1",9,0)
 ; METADATA' file and guaranties that all necessary files will be
"RTN","RORUPR1",10,0)
 ; processed during the registry update.
"RTN","RORUPR1",11,0)
 ;
"RTN","RORUPR1",12,0)
FILETREE() ;
"RTN","RORUPR1",13,0)
 N FILE,PF,RC
"RTN","RORUPR1",14,0)
 S FILE="",RC=0
"RTN","RORUPR1",15,0)
 F  S FILE=$O(RORUPD("SR",FILE))  Q:FILE=""  D  Q:RC<0
"RTN","RORUPR1",16,0)
 . S PF=+FILE,RC=0
"RTN","RORUPR1",17,0)
 . ;--- Follow a path that leads from this file to
"RTN","RORUPR1",18,0)
 . ;    the root of the "file-processing tree".
"RTN","RORUPR1",19,0)
 . F  D  Q:RC
"RTN","RORUPR1",20,0)
 . . ;--- Check if metadata for the file is defined
"RTN","RORUPR1",21,0)
 . . I '$D(^ROR(799.2,PF))  D  Q
"RTN","RORUPR1",22,0)
 . . . S RC=$$ERROR^RORERR(-63,,,,PF)
"RTN","RORUPR1",23,0)
 . . ;--- Get the number of the parent file
"RTN","RORUPR1",24,0)
 . . S PF=+$$GET1^DIQ(799.2,PF_",",1,"I",,"RORMSG")
"RTN","RORUPR1",25,0)
 . . I $G(DIERR)  D  Q
"RTN","RORUPR1",26,0)
 . . . S RC=$$DBS^RORERR("RORMSG",-9)
"RTN","RORUPR1",27,0)
 . . ;--- Stop if the root of the "file-processing tree" has been
"RTN","RORUPR1",28,0)
 . . ;    reached or the file is already marked for processing.
"RTN","RORUPR1",29,0)
 . . ;    Otherwise, mark the file and continue moving up.
"RTN","RORUPR1",30,0)
 . . I 'PF!$D(RORUPD("SR",PF))  S RC=1  Q
"RTN","RORUPR1",31,0)
 . . S RORUPD("SR",PF)=""
"RTN","RORUPR1",32,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUPR1",33,0)
 ;
"RTN","RORUPR1",34,0)
 ;***** RETURNS LEVEL OF THE FILE IN 'THE FILE PROCESSING' TREE
"RTN","RORUPR1",35,0)
 ;
"RTN","RORUPR1",36,0)
 ; FILE          File number
"RTN","RORUPR1",37,0)
 ;
"RTN","RORUPR1",38,0)
FLEVEL(FILE) ;
"RTN","RORUPR1",39,0)
 N LEVEL
"RTN","RORUPR1",40,0)
 S LEVEL=1
"RTN","RORUPR1",41,0)
 F  S FILE=+$P($G(^ROR(799.2,FILE,0)),U,2)  Q:'FILE  S LEVEL=LEVEL+1
"RTN","RORUPR1",42,0)
 Q LEVEL
"RTN","RORUPR1",43,0)
 ;
"RTN","RORUPR1",44,0)
 ;***** LOADS AND PREPARES LAB SEARCH INDICATORS
"RTN","RORUPR1",45,0)
 ;
"RTN","RORUPR1",46,0)
 ; Return Values:
"RTN","RORUPR1",47,0)
 ;        0  Ok
"RTN","RORUPR1",48,0)
 ;       <0  Error code
"RTN","RORUPR1",49,0)
 ;
"RTN","RORUPR1",50,0)
LABSRCH() ;
"RTN","RORUPR1",51,0)
 N I,IND,IR,LRCODE,LSICNT,LSIEN,RC,RORBUF,RORMSG,TMP,VAL
"RTN","RORUPR1",52,0)
 K RORLRC
"RTN","RORUPR1",53,0)
 ;--- Browse through the list of Lab searches
"RTN","RORUPR1",54,0)
 S LSIEN="",RC=0
"RTN","RORUPR1",55,0)
 F  S LSIEN=$O(@RORUPDPI@(4,LSIEN))  Q:LSIEN=""  D  Q:RC<0
"RTN","RORUPR1",56,0)
 . K RORBUF  S TMP=","_LSIEN_","
"RTN","RORUPR1",57,0)
 . D LIST^DIC(798.92,TMP,"@;.01;.02;1I;2",,,,,"B",,,"RORBUF","RORMSG")
"RTN","RORUPR1",58,0)
 . S RC=$$DBS^RORERR("RORMSG",-9)  Q:RC<0
"RTN","RORUPR1",59,0)
 . ;--- Browse through the list of search indicators
"RTN","RORUPR1",60,0)
 . S IR="",LSICNT=0
"RTN","RORUPR1",61,0)
 . F  S IR=$O(RORBUF("DILIST","ID",IR))  Q:IR=""  D  Q:RC<0
"RTN","RORUPR1",62,0)
 . . K LRCODE
"RTN","RORUPR1",63,0)
 . . ;--- Check if the indicator should be ignored
"RTN","RORUPR1",64,0)
 . . S IND=$G(RORBUF("DILIST","ID",IR,1))  Q:IND'>0
"RTN","RORUPR1",65,0)
 . . ;--- Get the result code (LOINC and/or NLT)
"RTN","RORUPR1",66,0)
 . . S LRCODE=$G(RORBUF("DILIST","ID",IR,.01))
"RTN","RORUPR1",67,0)
 . . I LRCODE>0  D  Q:LRCODE<0  S LRCODE(LRCODE_"^LN")=""
"RTN","RORUPR1",68,0)
 . . . S LRCODE=$$LNCODE^RORUTL02(LRCODE)
"RTN","RORUPR1",69,0)
 . . S LRCODE=$G(RORBUF("DILIST","ID",IR,.02))
"RTN","RORUPR1",70,0)
 . . S:LRCODE>0 LRCODE(LRCODE_"^NLT")=""
"RTN","RORUPR1",71,0)
 . . ;--- Either LOINC or NLT must be defined
"RTN","RORUPR1",72,0)
 . . Q:$D(LRCODE)<10
"RTN","RORUPR1",73,0)
 . . M RORLRC("B")=LRCODE
"RTN","RORUPR1",74,0)
 . . ;--- Prepare and store the search indicator
"RTN","RORUPR1",75,0)
 . . S VAL=$G(RORBUF("DILIST","ID",IR,2))
"RTN","RORUPR1",76,0)
 . . I VAL="",IND'=1,IND'=6  Q
"RTN","RORUPR1",77,0)
 . . S LSICNT=LSICNT+1
"RTN","RORUPR1",78,0)
 . . S LRCODE=""
"RTN","RORUPR1",79,0)
 . . F  S LRCODE=$O(LRCODE(LRCODE))  Q:LRCODE=""  D
"RTN","RORUPR1",80,0)
 . . . S I=$O(@RORUPDPI@("LS",LRCODE,LSIEN,""),-1)+1
"RTN","RORUPR1",81,0)
 . . . S @RORUPDPI@("LS",LRCODE,LSIEN,I)=IND_U_VAL
"RTN","RORUPR1",82,0)
 . Q:(RC<0)!(LSICNT>0)
"RTN","RORUPR1",83,0)
 . ;--- Record a warning if no indicators are defined
"RTN","RORUPR1",84,0)
 . S TMP=$$GET1^DIQ(798.9,LSIEN_",",.01,,,"RORMSG")
"RTN","RORUPR1",85,0)
 . S TMP=$$ERROR^RORERR(-55,,,,TMP)
"RTN","RORUPR1",86,0)
 Q:RC<0 RC
"RTN","RORUPR1",87,0)
 ;--- Prepare a list of Lab result codes for GCPR^LA7QRY
"RTN","RORUPR1",88,0)
 S LRCODE=""
"RTN","RORUPR1",89,0)
 F IR=1:1  S LRCODE=$O(RORLRC("B",LRCODE))  Q:LRCODE=""  D
"RTN","RORUPR1",90,0)
 . S RORLRC(IR)=LRCODE
"RTN","RORUPR1",91,0)
 K RORLRC("B")
"RTN","RORUPR1",92,0)
 Q 0
"RTN","RORUPR1",93,0)
 ;
"RTN","RORUPR1",94,0)
 ;***** LOADS SELECTION RULES DATA
"RTN","RORUPR1",95,0)
 ;
"RTN","RORUPR1",96,0)
 ; .REGLST       Reference to a local array containing registry names
"RTN","RORUPR1",97,0)
 ;               as subscripts and optional registry IENs as values
"RTN","RORUPR1",98,0)
 ;
"RTN","RORUPR1",99,0)
 ; Return Values:
"RTN","RORUPR1",100,0)
 ;        0  Ok
"RTN","RORUPR1",101,0)
 ;       <0  Error code
"RTN","RORUPR1",102,0)
 ;
"RTN","RORUPR1",103,0)
LOAD(REGLST) ;
"RTN","RORUPR1",104,0)
 N I,IENS,RC,REGIEN,REGNAME,RORBUF,RORMSG,RULENAME
"RTN","RORUPR1",105,0)
 K RORUPD("LM1")
"RTN","RORUPR1",106,0)
 S REGNAME="",RC=0
"RTN","RORUPR1",107,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:RC<0
"RTN","RORUPR1",108,0)
 . S REGIEN=+$G(REGLST(REGNAME))
"RTN","RORUPR1",109,0)
 . I REGIEN'>0  D  I REGIEN'>0  S RC=REGIEN  Q
"RTN","RORUPR1",110,0)
 . . S REGIEN=$$REGIEN^RORUTL02(REGNAME)
"RTN","RORUPR1",111,0)
 . S @RORUPDPI@(2,REGIEN)=REGNAME
"RTN","RORUPR1",112,0)
 . ;--- Load selection rules
"RTN","RORUPR1",113,0)
 . K RORBUF  S IENS=","_REGIEN_","
"RTN","RORUPR1",114,0)
 . D LIST^DIC(798.13,IENS,"@;.01E","U",,,,"B",,,"RORBUF","RORMSG")
"RTN","RORUPR1",115,0)
 . S RC=$$DBS^RORERR("RORMSG",-9)  Q:RC<0
"RTN","RORUPR1",116,0)
 . S I=""
"RTN","RORUPR1",117,0)
 . F  S I=$O(RORBUF("DILIST","ID",I))  Q:I=""  D  Q:RC<0
"RTN","RORUPR1",118,0)
 . . S RULENAME=RORBUF("DILIST","ID",I,.01)
"RTN","RORUPR1",119,0)
 . . S RC=$$LOADRULE(RULENAME,REGIEN)
"RTN","RORUPR1",120,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUPR1",121,0)
 ;
"RTN","RORUPR1",122,0)
 ;***** LOADS THE SELECTION RULE
"RTN","RORUPR1",123,0)
 ;
"RTN","RORUPR1",124,0)
 ; RULENAME      Name of the rule
"RTN","RORUPR1",125,0)
 ; REGIEN        Registry IEN
"RTN","RORUPR1",126,0)
 ; [LEVEL]       Level of the rule (O for top level rules)
"RTN","RORUPR1",127,0)
 ;
"RTN","RORUPR1",128,0)
 ; Return Values:
"RTN","RORUPR1",129,0)
 ;        0  Ok
"RTN","RORUPR1",130,0)
 ;       <0  Error code
"RTN","RORUPR1",131,0)
 ;
"RTN","RORUPR1",132,0)
LOADRULE(RULENAME,REGIEN,LEVEL) ;
"RTN","RORUPR1",133,0)
 ;--- Quit if the rule has already been loaded
"RTN","RORUPR1",134,0)
 I $D(@RORUPDPI@(3,RULENAME))  D  Q 0
"RTN","RORUPR1",135,0)
 . S @RORUPDPI@(3,RULENAME,2,REGIEN)=""
"RTN","RORUPR1",136,0)
 ;---
"RTN","RORUPR1",137,0)
 N DATELMT,DEPRLC,EXPR,FILE,I,IENS,RORBUF,RORMSG,RULIEN,TMP
"RTN","RORUPR1",138,0)
 ;--- Load the rule data
"RTN","RORUPR1",139,0)
 D FIND^DIC(798.2,,"@;1;2I","X",RULENAME,2,"B",,,"RORBUF","RORMSG")
"RTN","RORUPR1",140,0)
 S RC=$$DBS^RORERR("RORMSG",-9)  Q:RC<0 RC
"RTN","RORUPR1",141,0)
 Q:$G(RORBUF("DILIST",0))<1 $$ERROR^RORERR(-3,,RULENAME)
"RTN","RORUPR1",142,0)
 Q:$G(RORBUF("DILIST",0))>1 $$ERROR^RORERR(-4,,RULENAME)
"RTN","RORUPR1",143,0)
 S RULIEN=+RORBUF("DILIST",2,1),IENS=","_RULIEN_","
"RTN","RORUPR1",144,0)
 S FILE=+RORBUF("DILIST","ID",1,2)
"RTN","RORUPR1",145,0)
 ;--- Put the rule data into the temporary global
"RTN","RORUPR1",146,0)
 S @RORUPDPI@(1,FILE,"S",RULENAME)=""
"RTN","RORUPR1",147,0)
 S @RORUPDPI@(3,RULENAME)=RULIEN_U_FILE_"^^"_'$G(LEVEL)
"RTN","RORUPR1",148,0)
 S RC=$$PARSER^RORUPEX(FILE,RORBUF("DILIST","ID",1,1),.EXPR)
"RTN","RORUPR1",149,0)
 Q:RC<0 RC
"RTN","RORUPR1",150,0)
 S @RORUPDPI@(3,RULENAME,1)=EXPR
"RTN","RORUPR1",151,0)
 S @RORUPDPI@(3,RULENAME,2,REGIEN)=""
"RTN","RORUPR1",152,0)
 M @RORUPDPI@(1,FILE,"F")=EXPR("F")
"RTN","RORUPR1",153,0)
 S:'$G(LEVEL) RORUPD("LM1",RULENAME)=""
"RTN","RORUPR1",154,0)
 M @RORUPDPI@(4)=EXPR("L")
"RTN","RORUPR1",155,0)
 ;--- Load the rules that this rule depends on
"RTN","RORUPR1",156,0)
 S DEPRLC=""
"RTN","RORUPR1",157,0)
 F  S DEPRLC=$O(EXPR("R",DEPRLC))  Q:DEPRLC=""  D  Q:RC<0
"RTN","RORUPR1",158,0)
 . S RC=$$LOADRULE(DEPRLC,REGIEN,$G(LEVEL)+1)
"RTN","RORUPR1",159,0)
 . S:RC'<0 @RORUPDPI@(3,RULENAME,3,DEPRLC)=""
"RTN","RORUPR1",160,0)
 Q:RC<0 RC
"RTN","RORUPR1",161,0)
 ;--- Load a list of additional data elements
"RTN","RORUPR1",162,0)
 K EXPR,RORBUF,RORMSG
"RTN","RORUPR1",163,0)
 D LIST^DIC(798.26,IENS,"@;.01I;1I",,,,,"B",,,"RORBUF","RORMSG")
"RTN","RORUPR1",164,0)
 S RC=$$DBS^RORERR("RORMSG",-9)  Q:RC<0 RC
"RTN","RORUPR1",165,0)
 S I=""
"RTN","RORUPR1",166,0)
 F  S I=$O(RORBUF("DILIST","ID",I))  Q:I=""  D
"RTN","RORUPR1",167,0)
 . S DATELMT=RORBUF("DILIST","ID",I,.01)
"RTN","RORUPR1",168,0)
 . S TMP=$G(RORBUF("DILIST","ID",I,1))  S:TMP="" TMP="EI"
"RTN","RORUPR1",169,0)
 . S:TMP["E" @RORUPDPI@(1,FILE,"F",DATELMT,"E")=""
"RTN","RORUPR1",170,0)
 . S:TMP["I" @RORUPDPI@(1,FILE,"F",DATELMT,"I")=""
"RTN","RORUPR1",171,0)
 Q 0
"RTN","RORUPR1",172,0)
 ;
"RTN","RORUPR1",173,0)
 ;***** LOADS AND PREPARES THE METADATA
"RTN","RORUPR1",174,0)
METADATA() ;
"RTN","RORUPR1",175,0)
 N API,DATELMT,DEFL,FILE,I,IENS,IS,PIF,RC,ROOT,RORBUF,RORMSG,TMP,VT
"RTN","RORUPR1",176,0)
 S RC=$$FILETREE()  Q:RC<0 RC
"RTN","RORUPR1",177,0)
 S DEFL="@;.02I;1I;4I;4.1;4.2;6I"
"RTN","RORUPR1",178,0)
 ;--- Load and process the metadata
"RTN","RORUPR1",179,0)
 S FILE="",RC=0
"RTN","RORUPR1",180,0)
 F  S FILE=$O(RORUPD("SR",FILE))  Q:FILE=""  D  Q:RC<0
"RTN","RORUPR1",181,0)
 . S IENS=","_FILE_",",PIF=$NA(@RORUPDPI@(1,FILE))
"RTN","RORUPR1",182,0)
 . ;--- Global root of the file
"RTN","RORUPR1",183,0)
 . S RORUPD("ROOT",FILE)=$$ROOT^DILFD(FILE,,1)
"RTN","RORUPR1",184,0)
 . ;--- Associate data elements with APIs
"RTN","RORUPR1",185,0)
 . S DATELMT=""
"RTN","RORUPR1",186,0)
 . F  S DATELMT=$O(@PIF@("F",DATELMT))  Q:DATELMT=""  D  Q:RC<0
"RTN","RORUPR1",187,0)
 . . ;--- Find and load defintion of the data element
"RTN","RORUPR1",188,0)
 . . K RORBUF,RORMSG
"RTN","RORUPR1",189,0)
 . . D FIND^DIC(799.22,IENS,DEFL,"X",DATELMT,,"C",,,"RORBUF","RORMSG")
"RTN","RORUPR1",190,0)
 . . I $G(DIERR)  D  Q
"RTN","RORUPR1",191,0)
 . . . S RC=$$DBS^RORERR("RORMSG",-9,,,799.22,IENS)
"RTN","RORUPR1",192,0)
 . . ;--- Check if search on this element is supported
"RTN","RORUPR1",193,0)
 . . S API=+$G(RORBUF("DILIST","ID",1,1))
"RTN","RORUPR1",194,0)
 . . I 'API  D  Q
"RTN","RORUPR1",195,0)
 . . . S RC=$$ERROR^RORERR(-64,,,,FILE,DATELMT)
"RTN","RORUPR1",196,0)
 . . ;--- Store the field number (if necessary)
"RTN","RORUPR1",197,0)
 . . I API=1  D  S RORUPD("SR",FILE,"F",API,DATELMT)=TMP
"RTN","RORUPR1",198,0)
 . . . S TMP=$G(RORBUF("DILIST","ID",1,6))
"RTN","RORUPR1",199,0)
 . . ;--- Associate the data element with the API
"RTN","RORUPR1",200,0)
 . . S VT=$G(RORBUF("DILIST","ID",1,4)),RC=0
"RTN","RORUPR1",201,0)
 . . F I="E","I"  I $D(@PIF@("F",DATELMT,I))  D  Q:RC<0
"RTN","RORUPR1",202,0)
 . . . ;--- Check if type of the requested value is supported
"RTN","RORUPR1",203,0)
 . . . I VT'[I  D  Q
"RTN","RORUPR1",204,0)
 . . . . S TMP=$$EXTERNAL^DILFD(799.22,4,,I,"RORMSG")
"RTN","RORUPR1",205,0)
 . . . . S RC=$$ERROR^RORERR(-65,,,,FILE,DATELMT,TMP)
"RTN","RORUPR1",206,0)
 . . . ;--- Add the API-Element pair to the list
"RTN","RORUPR1",207,0)
 . . . S TMP=$G(RORBUF("DILIST","ID",1,$$VTFN(I)))
"RTN","RORUPR1",208,0)
 . . . S RORUPD("SR",FILE,"F",API,DATELMT,I)=TMP
"RTN","RORUPR1",209,0)
 . Q:RC<0
"RTN","RORUPR1",210,0)
 . ;--- Add required elements (if any) to the list
"RTN","RORUPR1",211,0)
 . K RORBUF,RORMSG
"RTN","RORUPR1",212,0)
 . D FIND^DIC(799.22,IENS,DEFL,"X",1,,"AR",,,"RORBUF","RORMSG")
"RTN","RORUPR1",213,0)
 . I $G(DIERR)  D  Q
"RTN","RORUPR1",214,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,799.22,IENS)
"RTN","RORUPR1",215,0)
 . S IS=""
"RTN","RORUPR1",216,0)
 . F  S IS=$O(RORBUF("DILIST","ID",IS))  Q:IS=""  D
"RTN","RORUPR1",217,0)
 . . S DATELMT=+$G(RORBUF("DILIST","ID",IS,.02))  Q:'DATELMT
"RTN","RORUPR1",218,0)
 . . S API=+$G(RORBUF("DILIST","ID",IS,1))        Q:'API
"RTN","RORUPR1",219,0)
 . . S VT=$G(RORBUF("DILIST","ID",IS,4))
"RTN","RORUPR1",220,0)
 . . F I="E","I"  D:VT[I
"RTN","RORUPR1",221,0)
 . . . S TMP=$G(RORBUF("DILIST","ID",IS,$$VTFN(I)))
"RTN","RORUPR1",222,0)
 . . . S RORUPD("SR",FILE,"F",API,DATELMT,I)=TMP
"RTN","RORUPR1",223,0)
 . . ;--- Store the field number (if necessary)
"RTN","RORUPR1",224,0)
 . . I API=1  D  S RORUPD("SR",FILE,"F",API,DATELMT)=TMP
"RTN","RORUPR1",225,0)
 . . . S TMP=$G(RORBUF("DILIST","ID",IS,6))
"RTN","RORUPR1",226,0)
 . ;--- Compile a list of fields (separated by ';') for the GETS^DIQ
"RTN","RORUPR1",227,0)
 . Q:$D(RORUPD("SR",FILE,"F",1))<10
"RTN","RORUPR1",228,0)
 . S (DATELMT,RORBUF)=""
"RTN","RORUPR1",229,0)
 . F  S DATELMT=$O(RORUPD("SR",FILE,"F",1,DATELMT))  Q:DATELMT=""  D
"RTN","RORUPR1",230,0)
 . . S TMP=+$G(RORUPD("SR",FILE,"F",1,DATELMT))
"RTN","RORUPR1",231,0)
 . . S:TMP>0 RORBUF=RORBUF_";"_TMP
"RTN","RORUPR1",232,0)
 . S RORUPD("SR",FILE,"F",1)=$S(RORBUF'="":$P(RORBUF,";",2,999),1:"")
"RTN","RORUPR1",233,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUPR1",234,0)
 ;
"RTN","RORUPR1",235,0)
 ;***** RETURNS FIELD NUMBER OF ADDITIONAL DATA
"RTN","RORUPR1",236,0)
VTFN(VT) ;
"RTN","RORUPR1",237,0)
 Q $S(VT="E":4.1,1:4.2)
"RTN","RORUTL01")
0^146^B29781636
"RTN","RORUTL01",1,0)
RORUTL01 ;HCIOFO/SG - UTILITIES  ; 5/12/05 3:29pm
"RTN","RORUTL01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL01",3,0)
 ;
"RTN","RORUTL01",4,0)
 ; This routine uses the following IAs:
"RTN","RORUTL01",5,0)
 ;
"RTN","RORUTL01",6,0)
 ; #3301         Access to the .6 field of the file #2
"RTN","RORUTL01",7,0)
 ; #3744         $$TESTPAT^VADPT
"RTN","RORUTL01",8,0)
 ; #10035        Access to the .01 and .09 fields of the file #2
"RTN","RORUTL01",9,0)
 ; #10038        Access to the HOLIDAY file (supported)
"RTN","RORUTL01",10,0)
 Q
"RTN","RORUTL01",11,0)
 ;
"RTN","RORUTL01",12,0)
 ;***** SENDS ALERT TO REGISTRY COORDINATORS
"RTN","RORUTL01",13,0)
 ;
"RTN","RORUTL01",14,0)
 ; [.]REGLST     Either name of the registry or reference to a local
"RTN","RORUTL01",15,0)
 ;               array containing registry names as subscripts and
"RTN","RORUTL01",16,0)
 ;               optional registry IENs as values
"RTN","RORUTL01",17,0)
 ;
"RTN","RORUTL01",18,0)
 ; MSG           Text of the message or negative error code. The '^'
"RTN","RORUTL01",19,0)
 ;               characters are replaced with spaces in the text.
"RTN","RORUTL01",20,0)
 ;
"RTN","RORUTL01",21,0)
 ; [XQAROU]      Indicates a ROUTINE or TAG^ROUTINE to run when
"RTN","RORUTL01",22,0)
 ;               the alert is processed
"RTN","RORUTL01",23,0)
 ;
"RTN","RORUTL01",24,0)
 ; [XQADATA]     Use this to store a package-specific data string,
"RTN","RORUTL01",25,0)
 ;               in any format
"RTN","RORUTL01",26,0)
 ;
"RTN","RORUTL01",27,0)
 ; [PATIEN]      Patient IEN
"RTN","RORUTL01",28,0)
 ;
"RTN","RORUTL01",29,0)
 ; [ARG2-ARG5]   Optional parameters as for the $$ERROR^RORERR
"RTN","RORUTL01",30,0)
 ;
"RTN","RORUTL01",31,0)
ALERT(REGLST,MSG,XQAROU,XQADATA,PATIEN,ARG2,ARG3,ARG4,ARG5) ;
"RTN","RORUTL01",32,0)
 N IR,RC,REGIEN,REGNAME,RORBUF,RORMSG,TMP,XQA,XQAFLG,XQAMSG
"RTN","RORUTL01",33,0)
 ;--- Prepare the notification list
"RTN","RORUTL01",34,0)
 I $D(REGLST)=1  Q:REGLST=""  S REGLST(REGLST)=""
"RTN","RORUTL01",35,0)
 S REGNAME="",RC=0
"RTN","RORUTL01",36,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D
"RTN","RORUTL01",37,0)
 . S REGIEN=+$G(REGLST(REGNAME))
"RTN","RORUTL01",38,0)
 . I REGIEN'>0  D  Q:REGIEN'>0
"RTN","RORUTL01",39,0)
 . . S REGIEN=$$REGIEN^RORUTL02(REGNAME)
"RTN","RORUTL01",40,0)
 . ;--- Load the notification list from the registry parameters
"RTN","RORUTL01",41,0)
 . K RORBUF  S TMP=","_REGIEN_","
"RTN","RORUTL01",42,0)
 . D LIST^DIC(798.114,TMP,"@;.01I","U",,,,"B",,,"RORBUF","RORMSG")
"RTN","RORUTL01",43,0)
 . S RC=$$DBS^RORERR("RORMSG",-9)  Q:RC<0
"RTN","RORUTL01",44,0)
 . S IR=""
"RTN","RORUTL01",45,0)
 . F  S IR=$O(RORBUF("DILIST","ID",IR))  Q:IR=""  D
"RTN","RORUTL01",46,0)
 . . S TMP=+$G(RORBUF("DILIST","ID",IR,.01))  S:TMP>0 XQA(TMP)=""
"RTN","RORUTL01",47,0)
 Q:$D(XQA)<10
"RTN","RORUTL01",48,0)
 ;--- Get text of the error message (if necessary)
"RTN","RORUTL01",49,0)
 I +MSG=MSG  Q:MSG'<0  D
"RTN","RORUTL01",50,0)
 . S MSG=$$MSG^RORERR20(+MSG,,.PATIEN,.ARG2,.ARG3,.ARG4,.ARG5)
"RTN","RORUTL01",51,0)
 S MSG=$TR(MSG,"^"," "),XQAMSG="ROR: ",TMP=70-$L(XQAMSG)-3
"RTN","RORUTL01",52,0)
 S XQAMSG=XQAMSG_$S($L(MSG)>TMP:$E(MSG,1,TMP)_"...",1:MSG)
"RTN","RORUTL01",53,0)
 ;--- Setup default alert processing routine
"RTN","RORUTL01",54,0)
 I $G(XQAROU)="",$G(XQADATA)=""  D
"RTN","RORUTL01",55,0)
 . S XQADATA=$E(MSG,1,78)_U_$G(PATIEN)
"RTN","RORUTL01",56,0)
 . S REGNAME=""
"RTN","RORUTL01",57,0)
 . F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D
"RTN","RORUTL01",58,0)
 . . S XQADATA=XQADATA_U_REGNAME
"RTN","RORUTL01",59,0)
 . S XQAROU="ALERTRTN^RORUTL01"
"RTN","RORUTL01",60,0)
 ;--- Send the alert
"RTN","RORUTL01",61,0)
 S XQAFLG="D"  D SETUP^XQALERT
"RTN","RORUTL01",62,0)
 Q
"RTN","RORUTL01",63,0)
 ;
"RTN","RORUTL01",64,0)
 ;***** DEFAULT ALERT PROCESSING ROUTINE
"RTN","RORUTL01",65,0)
 ;
"RTN","RORUTL01",66,0)
 ; XQADATA       Alert data
"RTN","RORUTL01",67,0)
 ;                 ^1: Message
"RTN","RORUTL01",68,0)
 ;                 ^2: Patient DFN
"RTN","RORUTL01",69,0)
 ;                 ^3: Registry name
"RTN","RORUTL01",70,0)
 ;                     ...
"RTN","RORUTL01",71,0)
 ;                 ^N: Registry name
"RTN","RORUTL01",72,0)
 ;
"RTN","RORUTL01",73,0)
ALERTRTN ;
"RTN","RORUTL01",74,0)
 Q:$G(XQADATA)=""
"RTN","RORUTL01",75,0)
 N I,REGNAME
"RTN","RORUTL01",76,0)
 W !!,$P(XQADATA,"^"),!
"RTN","RORUTL01",77,0)
 W:$P(XQADATA,"^",2) "Patient DFN: ",$P(XQADATA,"^",2),!
"RTN","RORUTL01",78,0)
 W "Processed Registries",!
"RTN","RORUTL01",79,0)
 F I=3:1  S REGNAME=$P(XQADATA,"^",I)  Q:REGNAME=""  W ?3,REGNAME,!
"RTN","RORUTL01",80,0)
 Q
"RTN","RORUTL01",81,0)
 ;
"RTN","RORUTL01",82,0)
 ;***** INITIALIZES THE VARIABLES
"RTN","RORUTL01",83,0)
 ;
"RTN","RORUTL01",84,0)
 ; NAMESP        Namespace to kill in the ^TMP global
"RTN","RORUTL01",85,0)
 ;               (must start with "ROR")
"RTN","RORUTL01",86,0)
 ; [XPURGE]      Purge namespaced nodes in the ^XTMP global.
"RTN","RORUTL01",87,0)
 ;               The ^XTMP(NAMESP_$J) node is always killed.
"RTN","RORUTL01",88,0)
 ;
"RTN","RORUTL01",89,0)
INIT(NAMESP,XPURGE) ;
"RTN","RORUTL01",90,0)
 N I,L,NOW  K ^TMP($J)
"RTN","RORUTL01",91,0)
 S:$G(U)="" U="^"  S:'$G(DT) DT=$$DT^XLFDT
"RTN","RORUTL01",92,0)
 Q:$E($G(NAMESP),1,3)'="ROR"
"RTN","RORUTL01",93,0)
 ;--- Kill namespaced nodes in the ^TMP global
"RTN","RORUTL01",94,0)
 S I=NAMESP,L=$L(NAMESP)
"RTN","RORUTL01",95,0)
 F  K ^TMP(I,$J)  S I=$O(^TMP(I))  Q:$E(I,1,L)'=NAMESP
"RTN","RORUTL01",96,0)
 ;--- Purge old namespaced nodes in the ^XTMP global
"RTN","RORUTL01",97,0)
 K ^XTMP(NAMESP_$J)
"RTN","RORUTL01",98,0)
 D:$G(XPURGE)
"RTN","RORUTL01",99,0)
 . S NOW=$$NOW^XLFDT,I=NAMESP,L=$L(NAMESP)
"RTN","RORUTL01",100,0)
 . F  D  S I=$O(^XTMP(I))  Q:$E(I,1,L)'=NAMESP
"RTN","RORUTL01",101,0)
 . . K:$G(^XTMP(I,0))<NOW ^XTMP(I)
"RTN","RORUTL01",102,0)
 Q
"RTN","RORUTL01",103,0)
 ;
"RTN","RORUTL01",104,0)
 ;***** INVERTS THE DATE
"RTN","RORUTL01",105,0)
 ;
"RTN","RORUTL01",106,0)
 ; DATE          Date in FileMan format
"RTN","RORUTL01",107,0)
 ; [MODE]        Mode of inversion
"RTN","RORUTL01",108,0)
 ;                 1  Strip the time BEFORE inversion
"RTN","RORUTL01",109,0)
 ;                 2  Strip the time AFTER inversion
"RTN","RORUTL01",110,0)
 ;                 3  Do not invert the time
"RTN","RORUTL01",111,0)
 ;
"RTN","RORUTL01",112,0)
INVDATE(DATE,MODE) ;
"RTN","RORUTL01",113,0)
 Q:$G(MODE)=1 9999999-$P(DATE,".")
"RTN","RORUTL01",114,0)
 Q:$G(MODE)=2 $P(9999999-DATE,".")
"RTN","RORUTL01",115,0)
 I $G(MODE)=3  Q:$P(DATE,".",2) (9999999-$P(DATE,"."))_"."_+$P(DATE,".",2)
"RTN","RORUTL01",116,0)
 Q 9999999-DATE
"RTN","RORUTL01",117,0)
 ;
"RTN","RORUTL01",118,0)
 ;***** RETURNS THE PATIENT IEN (DFN) FROM THE REGISTRY RECORD
"RTN","RORUTL01",119,0)
 ;
"RTN","RORUTL01",120,0)
 ; IEN           IEN of the registry record
"RTN","RORUTL01",121,0)
 ;
"RTN","RORUTL01",122,0)
PTIEN(IEN) ;
"RTN","RORUTL01",123,0)
 Q +$P($G(^RORDATA(798,+IEN,0)),U)
"RTN","RORUTL01",124,0)
 ;
"RTN","RORUTL01",125,0)
 ;***** RETURNS IEN OF THE PATIENT'S RECORD IN THE REGISTRY
"RTN","RORUTL01",126,0)
 ;
"RTN","RORUTL01",127,0)
 ; PATIEN        Patient IEN
"RTN","RORUTL01",128,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL01",129,0)
 ;
"RTN","RORUTL01",130,0)
 ; Return Values:
"RTN","RORUTL01",131,0)
 ;       ""  The registry record has not been found
"RTN","RORUTL01",132,0)
 ;       >0  IEN of the patient's registry record
"RTN","RORUTL01",133,0)
 ;
"RTN","RORUTL01",134,0)
PRRIEN(PATIEN,REGIEN) ;
"RTN","RORUTL01",135,0)
 Q:(PATIEN'>0)!(REGIEN'>0) 0
"RTN","RORUTL01",136,0)
 Q $O(^RORDATA(798,"KEY",+PATIEN,+REGIEN,0))
"RTN","RORUTL01",137,0)
 ;
"RTN","RORUTL01",138,0)
 ;***** RETURNS NAME AND SHORT DESCRIPTION OF THE REGISTRY
"RTN","RORUTL01",139,0)
 ;
"RTN","RORUTL01",140,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL01",141,0)
 ;
"RTN","RORUTL01",142,0)
 ; Return Values:
"RTN","RORUTL01",143,0)
 ;
"RTN","RORUTL01",144,0)
 ; An empty string is returned in case of an error or if there
"RTN","RORUTL01",145,0)
 ; is no registry with such IEN. Otherwise, the name and short
"RTN","RORUTL01",146,0)
 ; description of the registry separated by "^" are returned.
"RTN","RORUTL01",147,0)
 ;
"RTN","RORUTL01",148,0)
REGNAME(REGIEN) ;
"RTN","RORUTL01",149,0)
 N IENS,NAME,RORBUF,RORMSG
"RTN","RORUTL01",150,0)
 Q:'$D(^ROR(798.1,+REGIEN)) ""
"RTN","RORUTL01",151,0)
 S IENS=+REGIEN_","
"RTN","RORUTL01",152,0)
 D GETS^DIQ(798.1,IENS,".01;4",,"RORBUF","RORMSG")
"RTN","RORUTL01",153,0)
 I $G(DIERR)  D  Q ""
"RTN","RORUTL01",154,0)
 . D DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","RORUTL01",155,0)
 Q RORBUF(798.1,IENS,.01)_U_$G(RORBUF(798.1,IENS,4))
"RTN","RORUTL01",156,0)
 ;
"RTN","RORUTL01",157,0)
 ;***** CHECKS IF THE PATIENT IS A TEST ONE
"RTN","RORUTL01",158,0)
 ;
"RTN","RORUTL01",159,0)
 ; PATIEN        Patient IEN
"RTN","RORUTL01",160,0)
 ;
"RTN","RORUTL01",161,0)
 ; Return Values:
"RTN","RORUTL01",162,0)
 ;        0  The patient is NOT a test patient
"RTN","RORUTL01",163,0)
 ;        1  The patient IS a test patient
"RTN","RORUTL01",164,0)
 ;
"RTN","RORUTL01",165,0)
TESTPAT(PATIEN) ;
"RTN","RORUTL01",166,0)
 Q:$$TESTPAT^VADPT(PATIEN) 1
"RTN","RORUTL01",167,0)
 Q:$E($G(^DPT(PATIEN,0)),1,2)="ZZ" 1  ; NAME starts with "ZZ"
"RTN","RORUTL01",168,0)
 Q 0
"RTN","RORUTL01",169,0)
 ;
"RTN","RORUTL01",170,0)
 ;***** VERIFY THE ENTRY POINT
"RTN","RORUTL01",171,0)
 ;
"RTN","RORUTL01",172,0)
 ; ENTRY         Entry point of the external MUMPS function
"RTN","RORUTL01",173,0)
 ; [RECERR]      Record the errors (do not record by default)
"RTN","RORUTL01",174,0)
 ;
"RTN","RORUTL01",175,0)
 ; Return Values:
"RTN","RORUTL01",176,0)
 ;       -18  Routine does not exist
"RTN","RORUTL01",177,0)
 ;       -17  Invalid entry point
"RTN","RORUTL01",178,0)
 ;         0  Ok
"RTN","RORUTL01",179,0)
 ;
"RTN","RORUTL01",180,0)
VERIFYEP(ENTRY,RECERR) ;
"RTN","RORUTL01",181,0)
 N X
"RTN","RORUTL01",182,0)
 S X="S Y="_ENTRY  D ^DIM
"RTN","RORUTL01",183,0)
 Q:'$D(X) $S($G(RECERR):$$ERROR^RORERR(-17,,,,ENTRY),1:-17)
"RTN","RORUTL01",184,0)
 S X=$P(ENTRY,U,2)
"RTN","RORUTL01",185,0)
 X ^%ZOSF("TEST")  E  Q $S($G(RECERR):$$ERROR^RORERR(-18,,,,X),1:-18)
"RTN","RORUTL01",186,0)
 Q 0
"RTN","RORUTL01",187,0)
 ;
"RTN","RORUTL01",188,0)
 ;***** CHECKS IF THE DATE IS A WORKING DAY
"RTN","RORUTL01",189,0)
 ;
"RTN","RORUTL01",190,0)
 ; DATE          The date to be checked
"RTN","RORUTL01",191,0)
 ;
"RTN","RORUTL01",192,0)
 ; Return Values:
"RTN","RORUTL01",193,0)
 ;        0  Weekend or Holiday
"RTN","RORUTL01",194,0)
 ;        1  Working day
"RTN","RORUTL01",195,0)
 ;
"RTN","RORUTL01",196,0)
WDCHK(DATE) ;
"RTN","RORUTL01",197,0)
 N DOW,RORMSG
"RTN","RORUTL01",198,0)
 ;--- Return zero if Saturday (6) or Sunday (0)
"RTN","RORUTL01",199,0)
 S DOW=$$DOW^XLFDT(DATE,1)  Q:'DOW!(DOW>5) 0
"RTN","RORUTL01",200,0)
 ;--- Return 1 if cannot be found in the HOLIDAY file
"RTN","RORUTL01",201,0)
 Q $$FIND1^DIC(40.5,,"QX",DATE\1,"B",,"RORMSG")'>0
"RTN","RORUTL01",202,0)
 ;
"RTN","RORUTL01",203,0)
 ;***** RETURNS THE NEXT WORKING DAY DATE
"RTN","RORUTL01",204,0)
 ;
"RTN","RORUTL01",205,0)
 ; DATE          The source date
"RTN","RORUTL01",206,0)
 ;
"RTN","RORUTL01",207,0)
 ; The function returns a date of the next working day.
"RTN","RORUTL01",208,0)
 ;
"RTN","RORUTL01",209,0)
WDNEXT(DATE) ;
"RTN","RORUTL01",210,0)
 N DOW,RORMSG
"RTN","RORUTL01",211,0)
 F  D  Q:$$FIND1^DIC(40.5,,"QX",DATE,"B",,"RORMSG")'>0
"RTN","RORUTL01",212,0)
 . S DOW=$$DOW^XLFDT(DATE,1)  S:'DOW DOW=7
"RTN","RORUTL01",213,0)
 . ;--- Get the next day and skip a weekend if necessary
"RTN","RORUTL01",214,0)
 . S DATE=$$FMADD^XLFDT(DATE,$S(DOW<5:1,1:8-DOW))
"RTN","RORUTL01",215,0)
 Q DATE
"RTN","RORUTL01",216,0)
 ;
"RTN","RORUTL01",217,0)
 ;***** CREATES A HEADER OF THE NODE IN THE ^XTMP GLOBAL
"RTN","RORUTL01",218,0)
 ;
"RTN","RORUTL01",219,0)
 ; SUBSCR        Subscript of the node in the ^XTMP global
"RTN","RORUTL01",220,0)
 ; [DKEEP]       Number of days to keep the node (1 by default)
"RTN","RORUTL01",221,0)
 ; [DESCR]       Description of the node
"RTN","RORUTL01",222,0)
 ;
"RTN","RORUTL01",223,0)
XTMPHDR(SUBSCR,DKEEP,DESCR) ;
"RTN","RORUTL01",224,0)
 N DATE  S DATE=$$DT^XLFDT  S:$G(DKEEP)'>0 DKEEP=1
"RTN","RORUTL01",225,0)
 S ^XTMP(SUBSCR,0)=$$FMADD^XLFDT(DATE,DKEEP)_U_DATE_U_$G(DESCR)
"RTN","RORUTL01",226,0)
 Q
"RTN","RORUTL01",227,0)
 ;
"RTN","RORUTL01",228,0)
 ;***** EMULATES AND EXTENDS THE ZWRITE COMMAND :-)
"RTN","RORUTL01",229,0)
 ;
"RTN","RORUTL01",230,0)
 ; ROR8NODE      Closed root of the sub-tree to display
"RTN","RORUTL01",231,0)
 ;               (either local array or global variable)
"RTN","RORUTL01",232,0)
 ; [TITLE]       Title of the output
"RTN","RORUTL01",233,0)
 ;
"RTN","RORUTL01",234,0)
ZW(ROR8NODE,TITLE) ;
"RTN","RORUTL01",235,0)
 Q:ROR8NODE=""  Q:'$D(@ROR8NODE)
"RTN","RORUTL01",236,0)
 N FLT,L,PI  W !
"RTN","RORUTL01",237,0)
 W:$G(TITLE)'="" TITLE,!!
"RTN","RORUTL01",238,0)
 W:$D(@ROR8NODE)#10 ROR8NODE_"="_@ROR8NODE,!
"RTN","RORUTL01",239,0)
 S L=$L(ROR8NODE)  S:$E(ROR8NODE,L)=")" L=L-1
"RTN","RORUTL01",240,0)
 S FLT=$E(ROR8NODE,1,L),PI=ROR8NODE
"RTN","RORUTL01",241,0)
 F  S PI=$Q(@PI)  Q:$E(PI,1,L)'=FLT  W PI_"="_@PI,!
"RTN","RORUTL01",242,0)
 Q
"RTN","RORUTL02")
0^147^B36876775
"RTN","RORUTL02",1,0)
RORUTL02 ;HCIOFO/SG - UTILITIES  ; 8/25/05 10:20am
"RTN","RORUTL02",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL02",3,0)
 ;
"RTN","RORUTL02",4,0)
 ; This routine uses the following IAs:
"RTN","RORUTL02",5,0)
 ;
"RTN","RORUTL02",6,0)
 ; #2701         $$GETICN^MPIF001 Gets ICN (supported)
"RTN","RORUTL02",7,0)
 ; #3556         $$GCPR^LA7QRY
"RTN","RORUTL02",8,0)
 ; #3557         Access to the field .01 and x-ref "B"
"RTN","RORUTL02",9,0)
 ;               of the file 95.3
"RTN","RORUTL02",10,0)
 ; #3646         $$EMPL^DGSEC4
"RTN","RORUTL02",11,0)
 ; #10035        Access to the field #.09 of the file #2
"RTN","RORUTL02",12,0)
 ;
"RTN","RORUTL02",13,0)
 Q
"RTN","RORUTL02",14,0)
 ;
"RTN","RORUTL02",15,0)
 ;***** REMOVES THE INACTIVE REGISTRIES FROM THE LIST
"RTN","RORUTL02",16,0)
 ;
"RTN","RORUTL02",17,0)
 ; .REGLST(      A list of registry names (as subscripts)
"RTN","RORUTL02",18,0)
 ;   RegName)    Registry IEN (output)
"RTN","RORUTL02",19,0)
 ;
"RTN","RORUTL02",20,0)
 ; Return values:
"RTN","RORUTL02",21,0)
 ;       <0  Error code
"RTN","RORUTL02",22,0)
 ;        0  Ok
"RTN","RORUTL02",23,0)
 ;
"RTN","RORUTL02",24,0)
 ; This function removes names of those registries that are
"RTN","RORUTL02",25,0)
 ; inactive or cannot be updated for any other reasons from
"RTN","RORUTL02",26,0)
 ; the list. It also associates registry IENs with the names
"RTN","RORUTL02",27,0)
 ; of registries remaining on the list.
"RTN","RORUTL02",28,0)
 ;
"RTN","RORUTL02",29,0)
 ; Moreover, it records corresponding messages about skipped
"RTN","RORUTL02",30,0)
 ; registries to the current open log.
"RTN","RORUTL02",31,0)
 ;
"RTN","RORUTL02",32,0)
ARLST(REGLST) ;
"RTN","RORUTL02",33,0)
 N INFO,RC,REGIEN,REGNAME,RORBUF,TMP  K DSTLST
"RTN","RORUTL02",34,0)
 S REGNAME="",RC=0
"RTN","RORUTL02",35,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:RC<0
"RTN","RORUTL02",36,0)
 . S REGIEN=$$REGIEN(REGNAME,"@;11I;21.05I",.RORBUF)
"RTN","RORUTL02",37,0)
 . ;--- Cannot find (or load) the registry parameters
"RTN","RORUTL02",38,0)
 . I REGIEN'>0  D  Q
"RTN","RORUTL02",39,0)
 . . D ERROR^RORERR(REGIEN,,REGNAME)
"RTN","RORUTL02",40,0)
 . . K REGLST(REGNAME)
"RTN","RORUTL02",41,0)
 . ;--- Check if the registry is marked as 'inactive'
"RTN","RORUTL02",42,0)
 . I $G(RORBUF("DILIST","ID",1,11))  D  Q
"RTN","RORUTL02",43,0)
 . . D ERROR^RORERR(-48,,,,REGNAME)
"RTN","RORUTL02",44,0)
 . . K REGLST(REGNAME)
"RTN","RORUTL02",45,0)
 . ;--- Check if the registry has not been populated
"RTN","RORUTL02",46,0)
 . I '$G(RORBUF("DILIST","ID",1,21.05)),'$G(RORPARM("SETUP"))  D  Q
"RTN","RORUTL02",47,0)
 . . D TEXT^RORTXT(7980000.02,.INFO)
"RTN","RORUTL02",48,0)
 . . D ERROR^RORERR(-103,,.INFO,,REGNAME)
"RTN","RORUTL02",49,0)
 . . K INFO,REGLST(REGNAME)
"RTN","RORUTL02",50,0)
 . ;--- Store the registry IEN
"RTN","RORUTL02",51,0)
 . S REGLST(REGNAME)=REGIEN
"RTN","RORUTL02",52,0)
 Q RC
"RTN","RORUTL02",53,0)
 ;
"RTN","RORUTL02",54,0)
 ;***** RETURNS A FULL ICN OF THE PATIENT
"RTN","RORUTL02",55,0)
 ;
"RTN","RORUTL02",56,0)
 ; PTIEN         Patient IEN
"RTN","RORUTL02",57,0)
 ;
"RTN","RORUTL02",58,0)
 ; Return Values:
"RTN","RORUTL02",59,0)
 ;       <0  Error code
"RTN","RORUTL02",60,0)
 ;       ""  ICN has not been assigned
"RTN","RORUTL02",61,0)
 ;       >0  Patient ICN
"RTN","RORUTL02",62,0)
 ;
"RTN","RORUTL02",63,0)
ICN(PTIEN) ;
"RTN","RORUTL02",64,0)
 N ICN,L,TMP
"RTN","RORUTL02",65,0)
 S ICN=$$GETICN^MPIF001(PTIEN)
"RTN","RORUTL02",66,0)
 I ICN'>0  D  Q ""
"RTN","RORUTL02",67,0)
 . S TMP=$$ERROR^RORERR(-57,,$P(ICN,U,2),PTIEN,+ICN,"$$GETICN^MPIF001")
"RTN","RORUTL02",68,0)
 ;--- Validate the checksum (just in case ;-)
"RTN","RORUTL02",69,0)
 S L=$L($P(ICN,"V",2))
"RTN","RORUTL02",70,0)
 Q $S(L<6:$P(ICN,"V")_"V"_$E("000000",1,6-L)_$P(ICN,"V",2),1:ICN)
"RTN","RORUTL02",71,0)
 ;
"RTN","RORUTL02",72,0)
 ;***** LOADS THE LAB RESULTS
"RTN","RORUTL02",73,0)
 ;
"RTN","RORUTL02",74,0)
 ; PTIEN         Patient IEN
"RTN","RORUTL02",75,0)
 ;
"RTN","RORUTL02",76,0)
 ; SDT           Start date of the results
"RTN","RORUTL02",77,0)
 ; EDT           End date of the results
"RTN","RORUTL02",78,0)
 ;
"RTN","RORUTL02",79,0)
 ; [ROR8DST]     Closed root of the destination array
"RTN","RORUTL02",80,0)
 ;               (the ^TMP("RORTMP",$J) node, by default)
"RTN","RORUTL02",81,0)
 ;
"RTN","RORUTL02",82,0)
 ; Return values:
"RTN","RORUTL02",83,0)
 ;       <0  Error code
"RTN","RORUTL02",84,0)
 ;        0  Ok
"RTN","RORUTL02",85,0)
 ;
"RTN","RORUTL02",86,0)
LABRSLTS(PTIEN,SDT,EDT,ROR8DST) ;
"RTN","RORUTL02",87,0)
 N H7CH,RC,RORMSG,TMP
"RTN","RORUTL02",88,0)
 S:$G(ROR8DST)="" ROR8DST=$NA(^TMP("RORTMP",$J))
"RTN","RORUTL02",89,0)
 K @ROR8DST
"RTN","RORUTL02",90,0)
 I $D(RORLRC)<10  Q:$G(RORLRC)="" 0
"RTN","RORUTL02",91,0)
 ;--- Get the Patient ID (ICN or SSN)
"RTN","RORUTL02",92,0)
 S PTID=$$PTID(PTIEN)  Q:PTID<0 PTID
"RTN","RORUTL02",93,0)
 ;--- Get the Lab data
"RTN","RORUTL02",94,0)
 S H7CH=$G(RORHL("FS"))_$G(RORHL("ECH"))
"RTN","RORUTL02",95,0)
 S RC=$$GCPR^LA7QRY(PTID,SDT,EDT,.RORLRC,"*",.RORMSG,ROR8DST,H7CH)
"RTN","RORUTL02",96,0)
 I RC="",$D(RORMSG)>1  D
"RTN","RORUTL02",97,0)
 . N ERR,I,LST
"RTN","RORUTL02",98,0)
 . S (ERR,LST)=""
"RTN","RORUTL02",99,0)
 . F I=1:1  S ERR=$O(RORMSG(ERR))  Q:ERR=""  D
"RTN","RORUTL02",100,0)
 . . S LST=LST_","_ERR,TMP=RORMSG(ERR)
"RTN","RORUTL02",101,0)
 . . K RORMSG(ERR)  S RORMSG(I)=TMP
"RTN","RORUTL02",102,0)
 . S LST=$P(LST,",",2,999)  Q:(LST=3)!(LST=99)
"RTN","RORUTL02",103,0)
 . S RC=$$ERROR^RORERR(-27,,.RORMSG,PTIEN)
"RTN","RORUTL02",104,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUTL02",105,0)
 ;
"RTN","RORUTL02",106,0)
 ;***** RETURNS THE LOINC CODE WITH THE CONTROL DIGIT
"RTN","RORUTL02",107,0)
 ;
"RTN","RORUTL02",108,0)
 ; LNCODE        LOINC code
"RTN","RORUTL02",109,0)
 ;
"RTN","RORUTL02",110,0)
 ; Besides adding a control digit to the LOINC code, the function
"RTN","RORUTL02",111,0)
 ; checks the code against the LAB LOINC file (#95.3).
"RTN","RORUTL02",112,0)
 ;
"RTN","RORUTL02",113,0)
 ; Return values:
"RTN","RORUTL02",114,0)
 ;       <0  Error code
"RTN","RORUTL02",115,0)
 ;       >0  LOINC code with the control digit
"RTN","RORUTL02",116,0)
 ;
"RTN","RORUTL02",117,0)
LNCODE(LNCODE) ;
"RTN","RORUTL02",118,0)
 N RC,RORBUF,RORMSG
"RTN","RORUTL02",119,0)
 D FIND^DIC(95.3,,"@;.01E","X",$P(LNCODE,"-"),2,"B",,,"RORBUF","RORMSG")
"RTN","RORUTL02",120,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,95.3)
"RTN","RORUTL02",121,0)
 I $G(RORBUF("DILIST",0))<1  D  Q RC ; Non-existent code
"RTN","RORUTL02",122,0)
 . S RC=$$ERROR^RORERR(-29,,,,LNCODE)
"RTN","RORUTL02",123,0)
 I $G(RORBUF("DILIST",0))>1  D  Q RC ; Duplicate records
"RTN","RORUTL02",124,0)
 . S RC=$$ERROR^RORERR(-30,,,,LNCODE)
"RTN","RORUTL02",125,0)
 Q RORBUF("DILIST","ID",1,.01)
"RTN","RORUTL02",126,0)
 ;
"RTN","RORUTL02",127,0)
 ;***** LOCK/UNLOCK REGISTRIES BEING PROCESSED
"RTN","RORUTL02",128,0)
 ;
"RTN","RORUTL02",129,0)
 ; .REGLST       Reference to a local array containing registry names 
"RTN","RORUTL02",130,0)
 ;               as subscripts and optional registry IENs as values
"RTN","RORUTL02",131,0)
 ; [MODE]        0 - Unlock (default), 1 - Lock
"RTN","RORUTL02",132,0)
 ; [TO]          LOCK timeout (3 sec by defualt)
"RTN","RORUTL02",133,0)
 ; [NAME]        Name of the process/task
"RTN","RORUTL02",134,0)
 ;
"RTN","RORUTL02",135,0)
 ; Return Values:
"RTN","RORUTL02",136,0)
 ;       <0  Error code
"RTN","RORUTL02",137,0)
 ;        0  Some of the registries has been locked by another job
"RTN","RORUTL02",138,0)
 ;        1  Ok
"RTN","RORUTL02",139,0)
 ;
"RTN","RORUTL02",140,0)
LOCKREG(REGLST,MODE,TO,NAME) ;
"RTN","RORUTL02",141,0)
 Q:$D(REGLST)<10 1
"RTN","RORUTL02",142,0)
 N LOCKLST,RC,REGIEN,REGNAME
"RTN","RORUTL02",143,0)
 S REGNAME=""
"RTN","RORUTL02",144,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:REGIEN<0
"RTN","RORUTL02",145,0)
 . S REGIEN=+$G(REGLST(REGNAME))
"RTN","RORUTL02",146,0)
 . I REGIEN'>0  S REGIEN=$$REGIEN^RORUTL02(REGNAME)  Q:REGIEN'>0
"RTN","RORUTL02",147,0)
 . S LOCKLST(798.1,REGIEN_",")=""
"RTN","RORUTL02",148,0)
 Q:$G(REGIEN)<0 REGIEN
"RTN","RORUTL02",149,0)
 Q:$D(LOCKLST)<10 1
"RTN","RORUTL02",150,0)
 I $G(MODE)  D
"RTN","RORUTL02",151,0)
 . S RC=$$LOCK^RORLOCK(.LOCKLST,,,+$G(TO,3),$G(NAME))
"RTN","RORUTL02",152,0)
 E  S RC=$$UNLOCK^RORLOCK(.LOCKLST)
"RTN","RORUTL02",153,0)
 Q $S('RC:1,RC<0:RC,1:0)
"RTN","RORUTL02",154,0)
 ;
"RTN","RORUTL02",155,0)
 ;***** RETURNS A PATIENT ID (ICN OR SSN)
"RTN","RORUTL02",156,0)
 ;
"RTN","RORUTL02",157,0)
 ; PTIEN         Patient IEN
"RTN","RORUTL02",158,0)
 ;
"RTN","RORUTL02",159,0)
 ; Return Values:
"RTN","RORUTL02",160,0)
 ;       <0  Error code
"RTN","RORUTL02",161,0)
 ;       ""  Neither ICN nor SSN has been assigned
"RTN","RORUTL02",162,0)
 ;       >0  Patient ICN (or SSN if ICN is not available)
"RTN","RORUTL02",163,0)
 ;
"RTN","RORUTL02",164,0)
PTID(PTIEN) ;
"RTN","RORUTL02",165,0)
 N L,PTID,RC,RORMSG
"RTN","RORUTL02",166,0)
 S PTID=$$GETICN^MPIF001(PTIEN)
"RTN","RORUTL02",167,0)
 I PTID>0  D  Q PTID
"RTN","RORUTL02",168,0)
 . ;--- Validate the checksum (just in case ;-)
"RTN","RORUTL02",169,0)
 . S L=$L($P(PTID,"V",2))  Q:L'<6
"RTN","RORUTL02",170,0)
 . ;S RC=$$ERROR^RORERR(-59,,,PTIEN)
"RTN","RORUTL02",171,0)
 . S $P(PTID,"V",2)=$E("000000",1,6-L)_$P(PTID,"V",2)
"RTN","RORUTL02",172,0)
 ;--- Get SSN if ICN is not available
"RTN","RORUTL02",173,0)
 S PTID=$$GET1^DIQ(2,PTIEN_",",.09,,,"RORMSG")
"RTN","RORUTL02",174,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,PTIEN,2)
"RTN","RORUTL02",175,0)
 Q PTID
"RTN","RORUTL02",176,0)
 ;
"RTN","RORUTL02",177,0)
 ;***** RETURNS IEN OF THE REGISTRY PARAMETERS
"RTN","RORUTL02",178,0)
 ;
"RTN","RORUTL02",179,0)
 ; REGNAME       Name of the registry
"RTN","RORUTL02",180,0)
 ; [FIELDS]      List of fields (separated by semicolons) to load
"RTN","RORUTL02",181,0)
 ; [.RORTRGT]    Reference to a local variable where field values will
"RTN","RORUTL02",182,0)
 ;               be stored by the FIND^DIC call
"RTN","RORUTL02",183,0)
 ;
"RTN","RORUTL02",184,0)
 ; Return Values:
"RTN","RORUTL02",185,0)
 ;       <0  Error code
"RTN","RORUTL02",186,0)
 ;       >0  Registry parameters IEN
"RTN","RORUTL02",187,0)
 ;
"RTN","RORUTL02",188,0)
REGIEN(REGNAME,FIELDS,RORTRGT) ;
"RTN","RORUTL02",189,0)
 N RC,REGIEN,RORMSG  K RORTRGT
"RTN","RORUTL02",190,0)
 D FIND^DIC(798.1,,"@;"_$G(FIELDS),"UX",REGNAME,2,"B",,,"RORTRGT","RORMSG")
"RTN","RORUTL02",191,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.1)
"RTN","RORUTL02",192,0)
 S RC=+$G(RORTRGT("DILIST",0))
"RTN","RORUTL02",193,0)
 Q $S(RC<1:-1,RC>1:-2,1:+RORTRGT("DILIST",2,1))
"RTN","RORUTL02",194,0)
 ;
"RTN","RORUTL02",195,0)
 ;***** RETURNS NUMBER OF RECORDS IN THE REGISTRY
"RTN","RORUTL02",196,0)
 ;
"RTN","RORUTL02",197,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL02",198,0)
 ; [.LOWIEN]     The smallest IEN will be returned via this parameter
"RTN","RORUTL02",199,0)
 ; [.HIGHIEN]    The biggest IEN will be returned via this parameter
"RTN","RORUTL02",200,0)
 ;
"RTN","RORUTL02",201,0)
 ; Return Values:
"RTN","RORUTL02",202,0)
 ;       <0  Error code
"RTN","RORUTL02",203,0)
 ;        0  The registry is empty
"RTN","RORUTL02",204,0)
 ;       >0  Number of records in the registry
"RTN","RORUTL02",205,0)
 ;
"RTN","RORUTL02",206,0)
REGSIZE(REGIEN,LOWIEN,HIGHIEN) ;
"RTN","RORUTL02",207,0)
 N I,NODE,NRE,RC,RORFDA,RORMSG
"RTN","RORUTL02",208,0)
 S NODE=$NA(^RORDATA(798,"AC",REGIEN))
"RTN","RORUTL02",209,0)
 S LOWIEN=$O(@NODE@(""))
"RTN","RORUTL02",210,0)
 S HIGHIEN=$O(@NODE@(""),-1)
"RTN","RORUTL02",211,0)
 ;--- Get number of records from the parameters
"RTN","RORUTL02",212,0)
 S NRE=$$GET1^DIQ(798.1,REGIEN_",",19.1,,,"RORMSG")
"RTN","RORUTL02",213,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.1,REGIEN)
"RTN","RORUTL02",214,0)
 Q:NRE>0 NRE
"RTN","RORUTL02",215,0)
 ;--- Count the records of the registry
"RTN","RORUTL02",216,0)
 S I="",NRE=0
"RTN","RORUTL02",217,0)
 F  S I=$O(@NODE@(I))  Q:I=""  S NRE=NRE+1
"RTN","RORUTL02",218,0)
 ;--- Store the value in the parameters
"RTN","RORUTL02",219,0)
 S RORFDA(798.1,REGIEN_",",19.1)=NRE
"RTN","RORUTL02",220,0)
 D FILE^DIE("K","RORFDA","RORMSG")
"RTN","RORUTL02",221,0)
 Q NRE
"RTN","RORUTL02",222,0)
 ;
"RTN","RORUTL02",223,0)
 ;***** CHECKS IF AN EMPLOYEE SHOULD BE SKIPPED
"RTN","RORUTL02",224,0)
 ;
"RTN","RORUTL02",225,0)
 ; PTIEN         Patient IEN
"RTN","RORUTL02",226,0)
 ;
"RTN","RORUTL02",227,0)
 ; [.]REGIEN     Registry IEN
"RTN","RORUTL02",228,0)
 ;
"RTN","RORUTL02",229,0)
 ;               If you are going to call this function for several
"RTN","RORUTL02",230,0)
 ;               patients in a row (in a cycle), you can pass the
"RTN","RORUTL02",231,0)
 ;               second parameter by reference. This will eliminate
"RTN","RORUTL02",232,0)
 ;               repetitive access to the registry parameters (the
"RTN","RORUTL02",233,0)
 ;               REGIEN("SE") node will be used as a "cache" for the
"RTN","RORUTL02",234,0)
 ;               value of the EXCLUDE EMPLOYEES field).
"RTN","RORUTL02",235,0)
 ;
"RTN","RORUTL02",236,0)
 ; Return Values:
"RTN","RORUTL02",237,0)
 ;        0  Patient can be added to the registry
"RTN","RORUTL02",238,0)
 ;        1  Patient should be skipped
"RTN","RORUTL02",239,0)
 ;
"RTN","RORUTL02",240,0)
 ; The function checks if the patient is an employee and if he/she
"RTN","RORUTL02",241,0)
 ; can be added to the registry (according to the value of the
"RTN","RORUTL02",242,0)
 ; EXCLUDE EMPLOYEES field of the ROR REGISTRY PARAMETERS file).
"RTN","RORUTL02",243,0)
 ;
"RTN","RORUTL02",244,0)
SKIPEMPL(PTIEN,REGIEN) ;
"RTN","RORUTL02",245,0)
 Q:'$$EMPL^DGSEC4(PTIEN,"P") 0
"RTN","RORUTL02",246,0)
 S:'$D(REGIEN("SE")) REGIEN("SE")=+$P($G(^ROR(798.1,+REGIEN,0)),U,10)
"RTN","RORUTL02",247,0)
 Q +REGIEN("SE")
"RTN","RORUTL02",248,0)
 ;
"RTN","RORUTL02",249,0)
 ;***** RETURNS IEN OF THE SELECTION RULE
"RTN","RORUTL02",250,0)
 ;
"RTN","RORUTL02",251,0)
 ; RULENAME      Name of the selection rule
"RTN","RORUTL02",252,0)
 ; [FIELDS]      List of fields (separated by semicolons) to load
"RTN","RORUTL02",253,0)
 ; [.RORTRGT]    Reference to a local variable where field values will
"RTN","RORUTL02",254,0)
 ;               be stored by the FIND^DIC call.
"RTN","RORUTL02",255,0)
 ;
"RTN","RORUTL02",256,0)
 ; Return Values:
"RTN","RORUTL02",257,0)
 ;       <0  Error code
"RTN","RORUTL02",258,0)
 ;       >0  Selection rule IEN
"RTN","RORUTL02",259,0)
 ;
"RTN","RORUTL02",260,0)
SRLIEN(RULENAME,FIELDS,RORTRGT) ;
"RTN","RORUTL02",261,0)
 N RC,RULEIEN,RORMSG  K RORTRGT
"RTN","RORUTL02",262,0)
 D FIND^DIC(798.2,,"@;"_$G(FIELDS),"X",RULENAME,2,"B",,,"RORTRGT","RORMSG")
"RTN","RORUTL02",263,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.2)
"RTN","RORUTL02",264,0)
 S RC=+$G(RORTRGT("DILIST",0))
"RTN","RORUTL02",265,0)
 Q $S(RC<1:-3,RC>1:-4,1:+RORTRGT("DILIST",2,1))
"RTN","RORUTL03")
0^148^B19858687
"RTN","RORUTL03",1,0)
RORUTL03 ;HOIFO/CRT,SG - ENCRYPTION/DECRYPTION ; 7/14/05 2:59pm
"RTN","RORUTL03",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL03",3,0)
 ;
"RTN","RORUTL03",4,0)
 Q
"RTN","RORUTL03",5,0)
 ;
"RTN","RORUTL03",6,0)
 ;***** DECRYPTS THE STRING
"RTN","RORUTL03",7,0)
DECRYPT(S) ;
"RTN","RORUTL03",8,0)
 N ASSOCIX,ASSOCSTR,IDIX,IDSTR
"RTN","RORUTL03",9,0)
 S ASSOCIX=$A($E(S,$L(S)))-31,IDIX=$A($E(S))-31
"RTN","RORUTL03",10,0)
 S ASSOCSTR=$P($T(Z+ASSOCIX),";;",2,99)
"RTN","RORUTL03",11,0)
 S IDSTR=$P($T(Z+IDIX),";;",2,99)
"RTN","RORUTL03",12,0)
 Q $TR($E(S,2,$L(S)-1),ASSOCSTR,IDSTR)
"RTN","RORUTL03",13,0)
 ;
"RTN","RORUTL03",14,0)
 ;***** ENCRYPTS THE STRING
"RTN","RORUTL03",15,0)
ENCRYPT(S) ;
"RTN","RORUTL03",16,0)
 N %,ASSOCIX,ASSOCSTR,IDIX,IDSTR
"RTN","RORUTL03",17,0)
 S ASSOCIX=$R(20)+1
"RTN","RORUTL03",18,0)
 F  S IDIX=$R(20)+1  Q:ASSOCIX'=IDIX
"RTN","RORUTL03",19,0)
 S ASSOCSTR=$P($T(Z+ASSOCIX),";;",2,99)
"RTN","RORUTL03",20,0)
 S IDSTR=$P($T(Z+IDIX),";;",2,99)
"RTN","RORUTL03",21,0)
 Q $C(IDIX+31)_$TR(S,IDSTR,ASSOCSTR)_$C(ASSOCIX+31)
"RTN","RORUTL03",22,0)
 ;
"RTN","RORUTL03",23,0)
 ;***** RETURNS DEFAULT SITE FOR HL7 MESSAGES
"RTN","RORUTL03",24,0)
SITE(CS) ;
"RTN","RORUTL03",25,0)
 N RORSITE,RORSTN  S:$G(CS)="" CS="^"
"RTN","RORUTL03",26,0)
 S RORSITE=$$SITE^VASITE
"RTN","RORUTL03",27,0)
 I RORSITE<0  D  Q ""
"RTN","RORUTL03",28,0)
 . D ERROR^RORERR(-56,,,,RORSITE,"$$SITE^VASITE")
"RTN","RORUTL03",29,0)
 S RORSTN=$E($P(RORSITE,"^",3),1,3)
"RTN","RORUTL03",30,0)
 Q RORSTN_CS_$P(RORSITE,"^",2)_CS_"99VA4"
"RTN","RORUTL03",31,0)
 ;
"RTN","RORUTL03",32,0)
 ;***** XOR ENCRYPTION (from ICR v2.1)
"RTN","RORUTL03",33,0)
XOR(X) ;
"RTN","RORUTL03",34,0)
 N I,SUFFIX
"RTN","RORUTL03",35,0)
 ;--- Separate digits and letters (the suffix)
"RTN","RORUTL03",36,0)
 I X'?1N.N  D  S SUFFIX=$E(X,I,99),X=$E(X,1,I-1)
"RTN","RORUTL03",37,0)
 . F I=1:1  Q:$E(X,I)'?1N
"RTN","RORUTL03",38,0)
 ;--- Convert the numeric part to hexadecimal
"RTN","RORUTL03",39,0)
 S X=$$CNV^XLFUTL(X,16)
"RTN","RORUTL03",40,0)
 ;--- Perform XOR of each hexadecimal digit with '1101' (0xD)
"RTN","RORUTL03",41,0)
 S X=$TR(X,"0123456789ABCDEF","DCFE98BA54761032")
"RTN","RORUTL03",42,0)
 ;--- Pad with 0xD from the left so that the value will contain
"RTN","RORUTL03",43,0)
 ;    no less that 9 hexadecimal digits, convert numeric part
"RTN","RORUTL03",44,0)
 ;--- back to decimal and append the suffix (if available)
"RTN","RORUTL03",45,0)
 Q $$DEC^XLFUTL($TR($J(X,9)," ","D"),16)_$G(SUFFIX)
"RTN","RORUTL03",46,0)
 ;
"RTN","RORUTL03",47,0)
 ;***** ENCODES THE SPECIAL CHARACTERS (&, <, ', and ")
"RTN","RORUTL03",48,0)
 ;
"RTN","RORUTL03",49,0)
 ; STR           Source string
"RTN","RORUTL03",50,0)
 ;
"RTN","RORUTL03",51,0)
XMLENC(STR) ;
"RTN","RORUTL03",52,0)
 N CH,I,IC
"RTN","RORUTL03",53,0)
 F I=1:1:5  S CH=$E("&<""'>",I),IC=1  D
"RTN","RORUTL03",54,0)
 . F  S IC=$F(STR,CH,IC)  Q:IC'>0  D
"RTN","RORUTL03",55,0)
 . . S $E(STR,IC-1,IC-1)=$P("&amp;^&lt;^&quot;^&apos;^&gt;","^",I)
"RTN","RORUTL03",56,0)
 Q STR
"RTN","RORUTL03",57,0)
 ;
"RTN","RORUTL03",58,0)
 ;***** ENCRYPTION/DECRYPTION TABLE
"RTN","RORUTL03",59,0)
Z ;;
"RTN","RORUTL03",60,0)
 ;;ko-ZJtdG)49K{nX1BS$vH<:Myf*>Ae0!jQW=;#PwsO`E'%+rmb[gpqN,l6/hFC@DcUa ]zR}"ViIxu?872.(TYL5_3
"RTN","RORUTL03",61,0)
 ;;`R;M/9BqAF%tSs#Vh)dO1DZP>r *fX'u[.4KlY=-mg_ci802N7LTG<]!CWo:3?{v+,5Q}(@jaExn$pIyHwzU"k6Jeb
"RTN","RORUTL03",62,0)
 ;;ZJk"WQmCn!Y,y@1d+8s?[lNMxgHE(t=uwX:qSLjAI*}6zoF{T3#;cap)/h5%`P4$r]G'9e2if_>UDKb7V<v0- RBO.
"RTN","RORUTL03",63,0)
 ;;dpjt3g4W)qD0VNJarseB "?OYhcu[<M%Z`RIL_6:]AX-zG.#}$@vk7/5x*m;(yb2Fn+l'PwUof1K{9,EQi>H=CT8S!
"RTN","RORUTL03",64,0)
 ;;:1}K$byP;jk)7'`x90Bcq@iSsEnu,(Nl-hf.Y_?J#R]+voQXZU8mrV[!p4tgOWMez CAaGFD6H53%L/dT2<*>"{wI=
"RTN","RORUTL03",65,0)
 ;;J<oZ9phXVNn)m K`t/SI%]A5qOWe?;jTM!fz1l>[D_0xR32ic*4.P"G{r7}E8wvUgyudF+6-:B=$(sCY,LkbHa#'@Q
"RTN","RORUTL03",66,0)
 ;;X,'4Ty;[a8/{6lF_V"}qLI!@x(D7bRmUHh]W15J%N0BYPkrs9:$)Zj>uvzwQ=ieC-oGA.#?tfdcOM3gp`S+En K2*<
"RTN","RORUTL03",67,0)
 ;;W5[];4'<C$/xrZ(k{>?ghBzIFN}fAK"#`p_T!qtD*1E37XGVs@0nmdjSe+Y6Qyo-aUu%i8c=H2vJ) R:MLb.9,wlOP
"RTN","RORUTL03",68,0)
 ;;tjEM+!=xXb)7,ZV{*ci3"8@_l-HS69L>2]AUF/Q%:qD?1m(yvO0e'hT<#o$p4dnIzKP`NrkaGg.ufCRB[; sJYwW}5
"RTN","RORUTL03",69,0)
 ;;/zl-9y:Pj=(R'7QJI *CTX"p0]_3.idcuOBefVU#omwNZ`$vFs?L+1Sk<5,b)hM4A6[Y%aDrg@KqEW8t>H};n!2xG{
"RTN","RORUTL03",70,0)
 ;;0Bo@_HfnK>LR}qWXV+D6`Y28=4CmsG/7-5Ab9!a#rPF.lM$hc3ijQk;),TvzUd<[:I"u1'NZSOw]*gxtE{eJpy (?%
"RTN","RORUTL03",71,0)
 ;;D}LJyGO8`$*ZqH .j>cMh<d=fimszv[#-53F!+a;NC'6T91IV?(0@x/{B)w"]QY,UWprk4:ol%g2nE7teRKbAPuS_X
"RTN","RORUTL03",72,0)
 ;;Y#_0*H<B=Q+FML6]s;r2:e8R}[icKA 1w{)vV5d,.$u"xD/Pg?IyfthO@CzjWp%!`N4Z'3-(oJ9XUE7kTlqSb>anGm
"RTN","RORUTL03",73,0)
 ;;1']_GU<X`NgM?LS9{"jT%s$}y[nvtlefB2RKJW(/cIxDCPow4,>#zm+:5b@06O3Ap8=V*7ZFY!H-uEQk;a .q)irhd
"RTN","RORUTL03",74,0)
 ;;z7AG@QX."%3Lq>METUo{Pp_ a6<0dYVSv8:bI)W9NK`(r'4fswimkRe]C2hg=HOj$1B*/nxt,;cJ#y+![?lFuZ-5D}
"RTN","RORUTL03",75,0)
 ;;Ge6F Hx>q$mC%MTn,:"o'tX/*yP.{lZ!YkiVhuw_<KE5aR[;}W0gjsz3]@7cI2QN?f#4pvbr1OUBD9)=-L(JA+d`S8
"RTN","RORUTL03",76,0)
 ;;>ym};d)-7DZ"Fe/Y<B:xwojR,Vh]O0Sc[`$sg8GXE!I1Qrzp._W%TNKk(=J 3i*2abuHA4C'?MvPq{n#56LftUl@9+
"RTN","RORUTL03",77,0)
 ;;)9 WidFN,1KsmwQ>GJM{I4:C%}#Ep(?HB/r;t.U8ol['Lg"2hRDyZ5`nbf]qjc0!zS-TkYO<_=76a*X@$Pe3+AxVvu
"RTN","RORUTL03",78,0)
 ;;jf"5VdHc#uA,W1i+v'6@pr{n;DJ!8(btPGaQM.LT3oeg?NB/9>Z`-}02*%x<7Ylsqz4OS E$R]KI[:UwC_=h)kXmyF
"RTN","RORUTL03",79,0)
 ;;ar.{YU7mBZR@-K2 "+`M%8sq4JhPo<_XSg3WC;Tuxz,fvEiQ1p9=w}FAIj/keD0c?)LN6OHV]lG:5y'$*>nd[(tb!#
"RTN","RORUTL04")
0^149^B5896522
"RTN","RORUTL04",1,0)
RORUTL04 ;HCIOFO/BH - Registry Stat Report ; 1/16/02 12:30pm
"RTN","RORUTL04",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL04",3,0)
 ;
"RTN","RORUTL04",4,0)
EN1 D COMP
"RTN","RORUTL04",5,0)
 D DISPLAY
"RTN","RORUTL04",6,0)
 Q 
"RTN","RORUTL04",7,0)
 ;
"RTN","RORUTL04",8,0)
COMP N K2,K4,PATIEN,DATE,TMP,CODE,RULE
"RTN","RORUTL04",9,0)
 ;
"RTN","RORUTL04",10,0)
 K ^TMP("ROR STAT REPORT")
"RTN","RORUTL04",11,0)
 S K2=0
"RTN","RORUTL04",12,0)
 F  S K2=$O(^RORDATA(798,K2)) Q:'K2  D
"RTN","RORUTL04",13,0)
 . S PATIEN=$P(^RORDATA(798,K2,0),"^",1)
"RTN","RORUTL04",14,0)
 . S K4=0,CNT=0 K TMP
"RTN","RORUTL04",15,0)
 . F  S K4=$O(^RORDATA(798,K2,1,K4)) Q:'K4  D
"RTN","RORUTL04",16,0)
 . . S CNT=CNT+1
"RTN","RORUTL04",17,0)
 . . S DATE=$P(^RORDATA(798,K2,1,K4,0),"^",2)
"RTN","RORUTL04",18,0)
 . . S CODE=$P(^RORDATA(798,K2,1,K4,0),"^",1)
"RTN","RORUTL04",19,0)
 . . S TMP(DATE)=CODE
"RTN","RORUTL04",20,0)
 . I CNT<1 Q   ;  No selection rules
"RTN","RORUTL04",21,0)
 . S K1=""
"RTN","RORUTL04",22,0)
 . S K1=$O(TMP(K1))
"RTN","RORUTL04",23,0)
 . S RULE=$$GETRULE(.TMP,CNT,K1)
"RTN","RORUTL04",24,0)
 . S ^TMP("ROR STAT REPORT",RULE,K1,PATIEN)=""
"RTN","RORUTL04",25,0)
 Q
"RTN","RORUTL04",26,0)
 ;
"RTN","RORUTL04",27,0)
GETRULE(TMP,CNT,K1) ;
"RTN","RORUTL04",28,0)
 N MARKER,KK1,RULE1,RESULT
"RTN","RORUTL04",29,0)
 I CNT=1 D  Q RESULT
"RTN","RORUTL04",30,0)
 . S RULE1=TMP(K1)
"RTN","RORUTL04",31,0)
 . I RULE1=8 S RESULT="Only_Lab"
"RTN","RORUTL04",32,0)
 . I RULE1'=8 S RESULT="Only_ICD9"
"RTN","RORUTL04",33,0)
 ;
"RTN","RORUTL04",34,0)
 S KK1="",MARKER=0
"RTN","RORUTL04",35,0)
 F  S KK1=$O(TMP(KK1)) Q:'KK1  D
"RTN","RORUTL04",36,0)
 . I TMP(KK1)=8 S MARKER=1
"RTN","RORUTL04",37,0)
 S SEL=TMP(K1)
"RTN","RORUTL04",38,0)
 I MARKER,SEL=8 Q "BOTHL"
"RTN","RORUTL04",39,0)
 I MARKER,SEL'=8 Q "BOTHI"
"RTN","RORUTL04",40,0)
 Q "All_ICD9"
"RTN","RORUTL04",41,0)
 ;
"RTN","RORUTL04",42,0)
DISPLAY ;
"RTN","RORUTL04",43,0)
 N STRING,I,RES
"RTN","RORUTL04",44,0)
 S STRING="Only_Lab^Only_ICD9^BOTHI^BOTHL^All_ICD9"
"RTN","RORUTL04",45,0)
 F I=1:1:5 D
"RTN","RORUTL04",46,0)
 . S RES=$P(STRING,"^",I)
"RTN","RORUTL04",47,0)
 . D LOOP(RES)
"RTN","RORUTL04",48,0)
 Q
"RTN","RORUTL04",49,0)
 ;
"RTN","RORUTL04",50,0)
LOOP(RES) ;
"RTN","RORUTL04",51,0)
 N NAME,SSN,LABEL,DATE,IEN
"RTN","RORUTL04",52,0)
 S LABEL=RES
"RTN","RORUTL04",53,0)
 I $E(LABEL,1,4)="BOTH" D
"RTN","RORUTL04",54,0)
 . I $E(LABEL,5,5)="I" S LABEL="Both_ICD9_&_Lab.  ICD9_was_Earliest."
"RTN","RORUTL04",55,0)
 . I $E(LABEL,5,5)="L" S LABEL="Both_ICD9_&_Lab.  Lab_was_Earliest."
"RTN","RORUTL04",56,0)
 W !,"Reason_Added. "_LABEL,!
"RTN","RORUTL04",57,0)
 ;
"RTN","RORUTL04",58,0)
 S DATE=""
"RTN","RORUTL04",59,0)
 I $O(^TMP("ROR STAT REPORT",RES,DATE))="" W "No_data_to_display.",!
"RTN","RORUTL04",60,0)
 F  S DATE=$O(^TMP("ROR STAT REPORT",RES,DATE)) Q:'DATE  D
"RTN","RORUTL04",61,0)
 . S IEN=""
"RTN","RORUTL04",62,0)
 . F  S IEN=$O(^TMP("ROR STAT REPORT",RES,DATE,IEN)) Q:'IEN  D
"RTN","RORUTL04",63,0)
 . . S NAME=$P(^DPT(IEN,0),"^",1)
"RTN","RORUTL04",64,0)
 . . S NAME=$TR(NAME," ","_")
"RTN","RORUTL04",65,0)
 . . S SSN=$P(^DPT(IEN,0),"^",9)
"RTN","RORUTL04",66,0)
 . . W NAME_"  "_SSN_"  "_$E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_$E(DATE,2,3),!
"RTN","RORUTL04",67,0)
 ;
"RTN","RORUTL04",68,0)
 ;
"RTN","RORUTL05")
0^150^B57340264
"RTN","RORUTL05",1,0)
RORUTL05 ;HCIOFO/SG - MISCELLANEOUS UTILITIES ; 10/21/05 3:50pm
"RTN","RORUTL05",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL05",3,0)
 ;
"RTN","RORUTL05",4,0)
 ; This routine uses the following IAs:
"RTN","RORUTL05",5,0)
 ;
"RTN","RORUTL05",6,0)
 ; #???          Read the .01 field of the file #771.7
"RTN","RORUTL05",7,0)
 ; #10040        Access to the HOSPITAL LOCATION file (supported)
"RTN","RORUTL05",8,0)
 ; #10061        DEM^VADPT (supported)
"RTN","RORUTL05",9,0)
 ;
"RTN","RORUTL05",10,0)
 Q
"RTN","RORUTL05",11,0)
 ;
"RTN","RORUTL05",12,0)
 ;***** CHECKS IF THE E-MAIL NOTIFICATION IS ENABLED
"RTN","RORUTL05",13,0)
 ;
"RTN","RORUTL05",14,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL05",15,0)
 ;
"RTN","RORUTL05",16,0)
 ; Return Values:
"RTN","RORUTL05",17,0)
 ;        0  Do not send e-mail notifications
"RTN","RORUTL05",18,0)
 ;        1  E-mail notifications are enabled
"RTN","RORUTL05",19,0)
 ;
"RTN","RORUTL05",20,0)
CCRNTFY(REGIEN) ;
"RTN","RORUTL05",21,0)
 N DOMAIN,RC
"RTN","RORUTL05",22,0)
 ;--- Check if not a production account
"RTN","RORUTL05",23,0)
 I $T(PROD^XUPROD)'=""  Q:'$$PROD^XUPROD() 0
"RTN","RORUTL05",24,0)
 ;--- Check the domain name
"RTN","RORUTL05",25,0)
 S DOMAIN=$G(^XMB("NETNAME"))
"RTN","RORUTL05",26,0)
 Q:DOMAIN'?1.E1".VA.GOV" 0
"RTN","RORUTL05",27,0)
 Q:(DOMAIN?1"TEST.".E)!(DOMAIN?1"TST.".E) 0
"RTN","RORUTL05",28,0)
 ;--- Registry-specific checks
"RTN","RORUTL05",29,0)
 I $G(REGIEN)>0  S RC=1  D  Q:'RC 0
"RTN","RORUTL05",30,0)
 . N HL,HLECH,HLFS,HLQ,NAME,RORMSG
"RTN","RORUTL05",31,0)
 . ;--- Get the HL7 protocol name
"RTN","RORUTL05",32,0)
 . S NAME=$$GET1^DIQ(798.1,+REGIEN,13,,,"RORMSG")  Q:NAME=""
"RTN","RORUTL05",33,0)
 . ;--- Check the HL7 processing ID
"RTN","RORUTL05",34,0)
 . D INIT^HLFNC2(NAME,.HL)
"RTN","RORUTL05",35,0)
 . I $G(HL("PID"))'="",HL("PID")'="P"  S RC=0  Q
"RTN","RORUTL05",36,0)
 ;--- Notification is enabled (production account)
"RTN","RORUTL05",37,0)
 Q 1
"RTN","RORUTL05",38,0)
 ;
"RTN","RORUTL05",39,0)
 ;***** CHECK IF THE PATIENT'S RECORD IN FILE #2 IS VALID
"RTN","RORUTL05",40,0)
 ;
"RTN","RORUTL05",41,0)
 ; DFN           Patient IEN (in file #2)
"RTN","RORUTL05",42,0)
 ;
"RTN","RORUTL05",43,0)
 ; Return Values:
"RTN","RORUTL05",44,0)
 ;       <0  Error code
"RTN","RORUTL05",45,0)
 ;        0  Ok
"RTN","RORUTL05",46,0)
 ;
"RTN","RORUTL05",47,0)
CHKPTR(DFN,SILENT) ;
"RTN","RORUTL05",48,0)
 N RC,VA,VADM,VAERR
"RTN","RORUTL05",49,0)
 D VADEM(DFN)
"RTN","RORUTL05",50,0)
 I $G(VADM(1))=""  S RC=-102  D:'$G(SILENT)  Q RC
"RTN","RORUTL05",51,0)
 . D ERROR^RORERR(RC,,,,"PATIENT",DFN)
"RTN","RORUTL05",52,0)
 Q 0
"RTN","RORUTL05",53,0)
 ;
"RTN","RORUTL05",54,0)
 ;***** DELETES ALL RECORDS FROM THE (SUB)FILE
"RTN","RORUTL05",55,0)
 ;
"RTN","RORUTL05",56,0)
 ; FILE          File/Subfile number
"RTN","RORUTL05",57,0)
 ; [IENS]        IENS of the subfile
"RTN","RORUTL05",58,0)
 ;
"RTN","RORUTL05",59,0)
 ; Return Values:
"RTN","RORUTL05",60,0)
 ;       <0  Error code
"RTN","RORUTL05",61,0)
 ;        0  Ok
"RTN","RORUTL05",62,0)
 ;
"RTN","RORUTL05",63,0)
CLEAR(FILE,IENS) ;
"RTN","RORUTL05",64,0)
 Q:'$$VFILE^DILFD(FILE) 0
"RTN","RORUTL05",65,0)
 N DA,DIK,RC,ROOT,TMP
"RTN","RORUTL05",66,0)
 S IENS=$G(IENS)
"RTN","RORUTL05",67,0)
 ;--- Lock the (sub)file
"RTN","RORUTL05",68,0)
 S RC=$$LOCK^RORLOCK(FILE,IENS)
"RTN","RORUTL05",69,0)
 I RC  D  Q RC
"RTN","RORUTL05",70,0)
 . S TMP=$$GET1^DID(FILE,,,"NAME",,"RORMSG")
"RTN","RORUTL05",71,0)
 . S TMP=$S(TMP'="":"file",1:"subfile")_" #"_FILE
"RTN","RORUTL05",72,0)
 . S:IENS'="" TMP=TMP_"; IENS: '"_IENS_"'"
"RTN","RORUTL05",73,0)
 . S RC=$$ERROR^RORERR(-11,,"By "_$$TEXT^RORLOCK(RC),,TMP)
"RTN","RORUTL05",74,0)
 ;
"RTN","RORUTL05",75,0)
 ;--- Delete the records
"RTN","RORUTL05",76,0)
 S DIK=$$ROOT^DILFD(FILE,IENS)
"RTN","RORUTL05",77,0)
 S ROOT=$$CREF^DILF(DIK)
"RTN","RORUTL05",78,0)
 D DA^DILF(IENS,.DA)  S DA=0
"RTN","RORUTL05",79,0)
 F  S DA=$O(@ROOT@(DA))  Q:DA'>0  D ^DIK
"RTN","RORUTL05",80,0)
 ;
"RTN","RORUTL05",81,0)
 ;--- Unlock the (sub)file
"RTN","RORUTL05",82,0)
 D UNLOCK^RORLOCK(FILE,IENS)
"RTN","RORUTL05",83,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUTL05",84,0)
 ;
"RTN","RORUTL05",85,0)
 ;***** CLEARS THE FIELDS OF THE RECORDS FOUND BY NAME
"RTN","RORUTL05",86,0)
 ;
"RTN","RORUTL05",87,0)
 ; FILE          File number
"RTN","RORUTL05",88,0)
 ; [IENS]        IENS of the subfile
"RTN","RORUTL05",89,0)
 ; NAME          Name of the record (value of the .01 field)
"RTN","RORUTL05",90,0)
 ; FIELDS        List of field numbers separated by semicolons
"RTN","RORUTL05",91,0)
 ;
"RTN","RORUTL05",92,0)
 ; Return Values:
"RTN","RORUTL05",93,0)
 ;       <0  Error code
"RTN","RORUTL05",94,0)
 ;        0  Ok
"RTN","RORUTL05",95,0)
 ;
"RTN","RORUTL05",96,0)
CLRFLDS(FILE,IENS,NAME,FIELDS) ;
"RTN","RORUTL05",97,0)
 N FLD,I,IEN,IENS1,IS,RC,RORBUF,RORFDA,RORMSG
"RTN","RORUTL05",98,0)
 ;--- Find the record(s)
"RTN","RORUTL05",99,0)
 D FIND^DIC(FILE,$G(IENS),"@","X",NAME,,"B",,,"RORBUF","RORMSG")
"RTN","RORUTL05",100,0)
 S RC=$$DBS^RORERR("RORMSG",-9,,,FILE)  Q:RC<0 RC
"RTN","RORUTL05",101,0)
 S:$G(IENS)="" IENS=","  S FIELDS=$TR(FIELDS," ")
"RTN","RORUTL05",102,0)
 ;--- Update the record(s)
"RTN","RORUTL05",103,0)
 S IS="",RC=0
"RTN","RORUTL05",104,0)
 F  S IS=$O(RORBUF("DILIST",2,IS))  Q:IS=""  D  Q:RC<0
"RTN","RORUTL05",105,0)
 . S IEN=RORBUF("DILIST",2,IS)  Q:IEN'>0
"RTN","RORUTL05",106,0)
 . S IENS1=IEN_IENS
"RTN","RORUTL05",107,0)
 . F I=1:1  S FLD=$P(FIELDS,";",I)  Q:FLD'>0  D
"RTN","RORUTL05",108,0)
 . . S RORFDA(FILE,IENS1,+FLD)="@"
"RTN","RORUTL05",109,0)
 . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORUTL05",110,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,FILE,IENS1)
"RTN","RORUTL05",111,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUTL05",112,0)
 ;
"RTN","RORUTL05",113,0)
 ;***** RETURNS THE END DATE FOR THE EVENT PURGE
"RTN","RORUTL05",114,0)
EPDATE() ;
"RTN","RORUTL05",115,0)
 N DATE,IR,RC,RORBUF,RORMSG,TMP
"RTN","RORUTL05",116,0)
 D LIST^DIC(798.1,,"@;1I;2I","U",,,,"B",,,"RORBUF","RORMSG")
"RTN","RORUTL05",117,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.1)
"RTN","RORUTL05",118,0)
 ;--- Get the oldest date of registry updates
"RTN","RORUTL05",119,0)
 S IR="",DATE=$$DT^XLFDT
"RTN","RORUTL05",120,0)
 F  S IR=$O(RORBUF("DILIST","ID",IR))  Q:IR=""  D
"RTN","RORUTL05",121,0)
 . S TMP=$G(RORBUF("DILIST","ID",IR,1)) ; REGISTRY UPDATED UNTIL
"RTN","RORUTL05",122,0)
 . I TMP>0  S:TMP<DATE DATE=TMP
"RTN","RORUTL05",123,0)
 . ;S TMP=$G(RORBUF("DILIST","ID",IR,2)) ; DATA EXTRACTED UNTIL
"RTN","RORUTL05",124,0)
 . ;I TMP>0  S:TMP<DATE DATE=TMP
"RTN","RORUTL05",125,0)
 ;--- Subtract additional 14 days (just in case)
"RTN","RORUTL05",126,0)
 S DATE=$$FMADD^XLFDT(DATE\1,-14)
"RTN","RORUTL05",127,0)
 ;--- No more than 60 days in the past
"RTN","RORUTL05",128,0)
 S TMP=$$FMADD^XLFDT($$DT^XLFDT,-60)
"RTN","RORUTL05",129,0)
 Q $S(DATE>TMP:DATE,1:TMP)
"RTN","RORUTL05",130,0)
 ;
"RTN","RORUTL05",131,0)
 ;***** RETURNS NAME OF THE HOSPITAL LOCATION
"RTN","RORUTL05",132,0)
 ;
"RTN","RORUTL05",133,0)
 ; HLIEN         IEN of the hospital location
"RTN","RORUTL05",134,0)
 ;
"RTN","RORUTL05",135,0)
HLNAME(HLIEN) ;
"RTN","RORUTL05",136,0)
 N NAME
"RTN","RORUTL05",137,0)
 S NAME=$$GET1^DIQ(44,(+HLIEN)_",",.01,,,"RORMSG")
"RTN","RORUTL05",138,0)
 D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,44,(+HLIEN)_",")
"RTN","RORUTL05",139,0)
 Q NAME
"RTN","RORUTL05",140,0)
 ;
"RTN","RORUTL05",141,0)
 ;***** FORMATS THE TEXT THAT DESCRIBES STATUS OF THE HL7 MESSAGE
"RTN","RORUTL05",142,0)
 ;
"RTN","RORUTL05",143,0)
 ; MSGID         A valid ID of the HL7 message
"RTN","RORUTL05",144,0)
 ;
"RTN","RORUTL05",145,0)
 ; .RORDST       Reference to a local array that the text
"RTN","RORUTL05",146,0)
 ;               is appended to
"RTN","RORUTL05",147,0)
 ;
"RTN","RORUTL05",148,0)
 ; [TITLE]       Title of the output
"RTN","RORUTL05",149,0)
 ;
"RTN","RORUTL05",150,0)
 ; [DLGNUM]      Number of an entry in the DIALOG file that
"RTN","RORUTL05",151,0)
 ;               contains the text template (by default,
"RTN","RORUTL05",152,0)
 ;               the 7980000.004 is used)
"RTN","RORUTL05",153,0)
 ;
"RTN","RORUTL05",154,0)
 ; [.PARAMS]     Reference to a local variable containing
"RTN","RORUTL05",155,0)
 ;               additional parameters that substitute the
"RTN","RORUTL05",156,0)
 ;               placeholders in the text template
"RTN","RORUTL05",157,0)
 ; PARAMS(
"RTN","RORUTL05",158,0)
 ;  "NOR")       Number of retries to resend the message
"RTN","RORUTL05",159,0)
 ;  "REGISTRY")  Name of the registry
"RTN","RORUTL05",160,0)
 ;
"RTN","RORUTL05",161,0)
 ; [MSGSTAT]     Status of the message (result value of the
"RTN","RORUTL05",162,0)
 ;               $$MSGSTAT^HLUTIL function). If this parameter
"RTN","RORUTL05",163,0)
 ;               is undefined or equal to an empty string, the
"RTN","RORUTL05",164,0)
 ;               current status of the message is retrieved.
"RTN","RORUTL05",165,0)
 ;
"RTN","RORUTL05",166,0)
MSG7STS(MSGID,RORDST,TITLE,DLGNUM,PARAMS,MSGSTAT) ;
"RTN","RORUTL05",167,0)
 N RORMSG,TMP
"RTN","RORUTL05",168,0)
 Q:$G(MSGID)?." "
"RTN","RORUTL05",169,0)
 S:$G(MSGSTAT)="" MSGSTAT=$$MSGSTAT^HLUTIL(MSGID)
"RTN","RORUTL05",170,0)
 ;--- Prepare the parameters
"RTN","RORUTL05",171,0)
 S PARAMS("ID")=MSGID
"RTN","RORUTL05",172,0)
 S PARAMS("STATUS")=$$MSGSTXT^RORHL7A(MSGSTAT)
"RTN","RORUTL05",173,0)
 S TMP=+$P(MSGSTAT,U,2)
"RTN","RORUTL05",174,0)
 S:TMP>0 PARAMS("UPDATED")=$$FMTE^XLFDT(TMP)
"RTN","RORUTL05",175,0)
 S PARAMS("ERRMSG")=$P(MSGSTAT,U,3)
"RTN","RORUTL05",176,0)
 S TMP=+$P(MSGSTAT,U,4)
"RTN","RORUTL05",177,0)
 S:TMP>0 PARAMS("ERRTYPE")=$$GET1^DIQ(771.7,TMP_",",.01,,,"RORMSG")
"RTN","RORUTL05",178,0)
 S PARAMS($S(+MSGSTAT=1:"QPOS",1:"RETRIES"))=$P(MSGSTAT,U,5)
"RTN","RORUTL05",179,0)
 S PARAMS("OPENFAIL")=$P(MSGSTAT,U,6)
"RTN","RORUTL05",180,0)
 S PARAMS("ACK")=$P(MSGSTAT,U,7)
"RTN","RORUTL05",181,0)
 ;--- Additional parameters
"RTN","RORUTL05",182,0)
 I $G(DLGNUM)>0  D
"RTN","RORUTL05",183,0)
 . S PARAMS("STATCODE")=+MSGSTAT
"RTN","RORUTL05",184,0)
 . S TMP=+$P(MSGSTAT,U,2)
"RTN","RORUTL05",185,0)
 . S:TMP>0 PARAMS("STATUPD")=$$FMTHL7^XLFDT(TMP)
"RTN","RORUTL05",186,0)
 . S TMP=$$SITE^RORUTL03()
"RTN","RORUTL05",187,0)
 . S PARAMS("STNAME")=$P(TMP,U,2)
"RTN","RORUTL05",188,0)
 . S PARAMS("STNUM")=$P(TMP,U)
"RTN","RORUTL05",189,0)
 . S:$G(PARAMS("NOR"))'>0 PARAMS("NOR")="several"
"RTN","RORUTL05",190,0)
 . S:$G(PARAMS("REGISTRY"))="" PARAMS("REGISTRY")="<unknown>"
"RTN","RORUTL05",191,0)
 E  S DLGNUM=7980000.004
"RTN","RORUTL05",192,0)
 ;--- Build the text
"RTN","RORUTL05",193,0)
 S:$G(TITLE)'="" RORDST(1)=TITLE,RORDST(2)=" "
"RTN","RORUTL05",194,0)
 D BLD^DIALOG(DLGNUM,.PARAMS,,"RORDST","S")
"RTN","RORUTL05",195,0)
 Q
"RTN","RORUTL05",196,0)
 ;
"RTN","RORUTL05",197,0)
 ;***** CHECK IF THE ARGUMENT IS A NUMBER
"RTN","RORUTL05",198,0)
 ;
"RTN","RORUTL05",199,0)
 ; Return Values:
"RTN","RORUTL05",200,0)
 ;        1  Value starts from a number
"RTN","RORUTL05",201,0)
 ;        0  Otherwise
"RTN","RORUTL05",202,0)
 ;
"RTN","RORUTL05",203,0)
NUMERIC(VAL,NUMVAL) ;
"RTN","RORUTL05",204,0)
 S NUMVAL=$$TRIM^XLFSTR(VAL)
"RTN","RORUTL05",205,0)
 I NUMVAL?.1(1"+",1"-")1(1.N.1".".N,.N.1"."1.N).1(1"E".1(1"+",1"-")1.N)  S NUMVAL=+NUMVAL  Q 1
"RTN","RORUTL05",206,0)
 S NUMVAL=""
"RTN","RORUTL05",207,0)
 Q 0
"RTN","RORUTL05",208,0)
 ;
"RTN","RORUTL05",209,0)
 ;***** MARKS THE REGISTRY RECORDS FOR RESENDING THE LOCAL DATA
"RTN","RORUTL05",210,0)
 ;
"RTN","RORUTL05",211,0)
 ; .REGLST       Reference to a local array containing registry names 
"RTN","RORUTL05",212,0)
 ;               as subscripts and optional registry IENs as values
"RTN","RORUTL05",213,0)
 ;
"RTN","RORUTL05",214,0)
 ; WD            Number of days to wait before marking the records
"RTN","RORUTL05",215,0)
 ;               for resending the local registry data
"RTN","RORUTL05",216,0)
 ;
"RTN","RORUTL05",217,0)
 ; Return Values:
"RTN","RORUTL05",218,0)
 ;       <0  Error code
"RTN","RORUTL05",219,0)
 ;        0  Ok
"RTN","RORUTL05",220,0)
 ;
"RTN","RORUTL05",221,0)
REMARK(REGLST,WD) ;
"RTN","RORUTL05",222,0)
 N DATE,IEN,IENS,REGIEN,REGNAME,ROOT,RORFDA,RORMSG,TMP
"RTN","RORUTL05",223,0)
 S ROOT=$$ROOT^DILFD(798,,1),RC=0
"RTN","RORUTL05",224,0)
 S DATE=$$FMADD^XLFDT($$DT^XLFDT,-WD)
"RTN","RORUTL05",225,0)
 ;--- Process the registries from the list
"RTN","RORUTL05",226,0)
 S REGNAME=""
"RTN","RORUTL05",227,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D
"RTN","RORUTL05",228,0)
 . S REGIEN=+REGLST(REGNAME)
"RTN","RORUTL05",229,0)
 . I REGIEN'>0  S REGIEN=$$REGIEN^RORUTL02(REGNAME)  Q:REGIEN'>0
"RTN","RORUTL05",230,0)
 . S IENS=REGIEN_","
"RTN","RORUTL05",231,0)
 . ;--- Get the registry parameters
"RTN","RORUTL05",232,0)
 . D GETS^DIQ(798.1,IENS,"21.04;21.05","I","RORFDA","RORMSG")
"RTN","RORUTL05",233,0)
 . I $G(DIERR)  S TMP=$$DBS^RORERR("RORMSG",-9,,,798.1,IENS)  Q
"RTN","RORUTL05",234,0)
 . ;--- Local data has been resent already
"RTN","RORUTL05",235,0)
 . Q:$G(RORFDA(798.1,IENS,21.04,"I"))
"RTN","RORUTL05",236,0)
 . ;--- The registry has not been populated yet
"RTN","RORUTL05",237,0)
 . Q:'$G(RORFDA(798.1,IENS,21.05,"I"))
"RTN","RORUTL05",238,0)
 . ;--- It is too early for resending the local data
"RTN","RORUTL05",239,0)
 . Q:RORFDA(798.1,IENS,21.05,"I")>DATE
"RTN","RORUTL05",240,0)
 . K RORFDA,RORMSG
"RTN","RORUTL05",241,0)
 . ;--- Mark registry records as modified
"RTN","RORUTL05",242,0)
 . S IEN=0
"RTN","RORUTL05",243,0)
 . F  S IEN=$O(@ROOT@("AC",REGIEN,IEN))  Q:'IEN  D
"RTN","RORUTL05",244,0)
 . . S IENS=IEN_","
"RTN","RORUTL05",245,0)
 . . S RORFDA(798,IENS,4)=1  ; UPDATE DEMOGRAPHICS
"RTN","RORUTL05",246,0)
 . . S RORFDA(798,IENS,5)=1  ; UPDATE LOCAL REGISTRY DATA
"RTN","RORUTL05",247,0)
 . . D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORUTL05",248,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","RORUTL05",249,0)
 . ;--- Update registry parameters
"RTN","RORUTL05",250,0)
 . S IENS=REGIEN_","
"RTN","RORUTL05",251,0)
 . S RORFDA(798.1,IENS,21.04)=$$NOW^XLFDT
"RTN","RORUTL05",252,0)
 . D FILE^DIE("K","RORFDA","RORMSG")
"RTN","RORUTL05",253,0)
 . I $G(DIERR)  S TMP=$$DBS^RORERR("RORMSG",-9,,,798.1,IENS)  Q
"RTN","RORUTL05",254,0)
 . ;--- Record the message
"RTN","RORUTL05",255,0)
 . S TMP="Local registry and demographic data will be resent to AAC"
"RTN","RORUTL05",256,0)
 . D LOG^RORLOG(2,TMP,,"Registry Name: "_REGNAME)
"RTN","RORUTL05",257,0)
 Q 0
"RTN","RORUTL05",258,0)
 ;
"RTN","RORUTL05",259,0)
 ;***** CALLS THE DEM^VADPT
"RTN","RORUTL05",260,0)
 ;
"RTN","RORUTL05",261,0)
 ; DFN           Patient IEN (in file #2)
"RTN","RORUTL05",262,0)
 ; VALIDATE      Make sure that required fields are not empty
"RTN","RORUTL05",263,0)
 ; VAPTYP
"RTN","RORUTL05",264,0)
 ; VAHOW
"RTN","RORUTL05",265,0)
 ;
"RTN","RORUTL05",266,0)
VADEM(DFN,VALIDATE,VAPTYP,VAHOW) ;
"RTN","RORUTL05",267,0)
 N I,J,X,A,K,K1,NC,NF,NQ,T,VAROOT
"RTN","RORUTL05",268,0)
 D DEM^VADPT
"RTN","RORUTL05",269,0)
 Q:'$G(VALIDATE)
"RTN","RORUTL05",270,0)
 ;--- Make sure that required fields are not empty
"RTN","RORUTL05",271,0)
 S:$G(VADM(1))="" VADM(1)="Unknown ("_DFN_")"
"RTN","RORUTL05",272,0)
 S:$G(VA("BID"))="" VA("BID")="UNKN"
"RTN","RORUTL05",273,0)
 Q
"RTN","RORUTL06")
0^151^B71698808
"RTN","RORUTL06",1,0)
RORUTL06 ;HCIOFO/SG - DEVELOPER ENTRY POINTS ; 11/20/05 5:09pm
"RTN","RORUTL06",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL06",3,0)
 ;
"RTN","RORUTL06",4,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RORUTL06",5,0)
 W !,"CLINICAL CASE REGISTRIES DEVELOPER'S UTILITIES"
"RTN","RORUTL06",6,0)
 S X=""
"RTN","RORUTL06",7,0)
 S X=X_";M:Metadata definitions"
"RTN","RORUTL06",8,0)
 S X=X_";V:Verify registry definition"
"RTN","RORUTL06",9,0)
 S X=X_";P:Prepare for KIDS"
"RTN","RORUTL06",10,0)
 S DIR(0)="SO^"_$P(X,";",2,999)
"RTN","RORUTL06",11,0)
 D ^DIR  W !  Q:$D(DIRUT)
"RTN","RORUTL06",12,0)
 G PRTMDE:Y="M",VERIFY:Y="V",DISTPREP:Y="P"
"RTN","RORUTL06",13,0)
 Q
"RTN","RORUTL06",14,0)
 ;
"RTN","RORUTL06",15,0)
 ;***** VERIFIES REGISTRY DEFINITION
"RTN","RORUTL06",16,0)
VERIFY ;
"RTN","RORUTL06",17,0)
 N RORERRDL      ; Default error location
"RTN","RORUTL06",18,0)
 N RORERROR      ; Error processing data
"RTN","RORUTL06",19,0)
 N RORLOG        ; Log parameters
"RTN","RORUTL06",20,0)
 N RORPARM       ; Application parameters
"RTN","RORUTL06",21,0)
 ;
"RTN","RORUTL06",22,0)
 N RC,REGLST,REGNAME,TMP
"RTN","RORUTL06",23,0)
 W !,"REGISTRY DEFINITION VERIFIER",!
"RTN","RORUTL06",24,0)
 D KILL^XUSCLEAN,INIT^RORUTL01("ROR")
"RTN","RORUTL06",25,0)
 S RORPARM("DEBUG")=2
"RTN","RORUTL06",26,0)
 S RORPARM("ERR")=1
"RTN","RORUTL06",27,0)
 S RORPARM("LOG")=1
"RTN","RORUTL06",28,0)
 F TMP=1:1:6  S RORPARM("LOG",TMP)=1
"RTN","RORUTL06",29,0)
 D CLEAR^RORERR("START^RORUTL06")
"RTN","RORUTL06",30,0)
 ;--- Select registries
"RTN","RORUTL06",31,0)
 Q:$$SELREG^RORUTL07(.REGLST)'>0
"RTN","RORUTL06",32,0)
 ;--- Validate registry update defintion
"RTN","RORUTL06",33,0)
 S RC=$$UPDDEF(.REGLST)  G:RC<0 ERROR
"RTN","RORUTL06",34,0)
 ;--- Validate data extraction defintion
"RTN","RORUTL06",35,0)
 S RC=$$EXTDEF(.REGLST)  G:RC<0 ERROR
"RTN","RORUTL06",36,0)
 ;--- Cleanup
"RTN","RORUTL06",37,0)
 D INIT^RORUTL01("ROR")
"RTN","RORUTL06",38,0)
 Q
"RTN","RORUTL06",39,0)
 ;
"RTN","RORUTL06",40,0)
 ;***** PREPARES THE REGISTRY FOR KIDS DISTRIBUTION
"RTN","RORUTL06",41,0)
DISTPREP ;
"RTN","RORUTL06",42,0)
 N RORERRDL      ; Default error location
"RTN","RORUTL06",43,0)
 N RORERROR      ; Error processing data
"RTN","RORUTL06",44,0)
 N RORFULL       ; Full installation (backpull, population, etc.)
"RTN","RORUTL06",45,0)
 N RORPARM       ; Application parameters
"RTN","RORUTL06",46,0)
 ;
"RTN","RORUTL06",47,0)
 N IENS,FLD,FULL,RC,REGIEN,REGNAME,RORFDA,RORMSG
"RTN","RORUTL06",48,0)
 N DA,DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RORUTL06",49,0)
 W !,"REGISTRY PREPARATION FOR KIDS DISTRIBUTION",!
"RTN","RORUTL06",50,0)
 D KILL^XUSCLEAN
"RTN","RORUTL06",51,0)
 S RORPARM("ERR")=1
"RTN","RORUTL06",52,0)
 D CLEAR^RORERR("DISTPREP^RORUTL06")
"RTN","RORUTL06",53,0)
 ;--- Select a registry
"RTN","RORUTL06",54,0)
 S RC=$$SELREG^RORUTL18(.REGNAME)  G:RC<0 ERROR
"RTN","RORUTL06",55,0)
 Q:RC'>0  S REGIEN=RC
"RTN","RORUTL06",56,0)
 ;--- Select the type of distribution
"RTN","RORUTL06",57,0)
 K DIR  S DIR(0)="S^I:Installation;U:Update",DIR("B")="Update"
"RTN","RORUTL06",58,0)
 S DIR("A")="Slect the type of distribution"
"RTN","RORUTL06",59,0)
 D ^DIR  Q:$D(DIRUT)  W !
"RTN","RORUTL06",60,0)
 S RORFULL=(Y="I")
"RTN","RORUTL06",61,0)
 ;--- Request a confirmation
"RTN","RORUTL06",62,0)
 K DIR  S DIR(0)="Y",DIR("B")="NO"
"RTN","RORUTL06",63,0)
 S DIR("A",1)="Some fields of the '"_REGNAME_"' registry parameters"
"RTN","RORUTL06",64,0)
 S DIR("A",2)="will be cleared to prepare them for KIDS distribution."
"RTN","RORUTL06",65,0)
 S DIR("A")="Do you really want to do this"
"RTN","RORUTL06",66,0)
 D ^DIR  Q:'$G(Y)  W !
"RTN","RORUTL06",67,0)
 ;--- Clear Registry parameters (single-valued)
"RTN","RORUTL06",68,0)
 S IENS=REGIEN_","
"RTN","RORUTL06",69,0)
 F FLD=1,2,5,13,19.1,19.2,19.3,21.01,21.04,21.05  D
"RTN","RORUTL06",70,0)
 . S RORFDA(798.1,IENS,FLD)="@"
"RTN","RORUTL06",71,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORUTL06",72,0)
 G:$$DBS^RORERR("RORMSG",-9,,,798.1,IENS) ERROR
"RTN","RORUTL06",73,0)
 ;--- Clear Registry parameters (multiples)
"RTN","RORUTL06",74,0)
 S IENS=","_REGIEN_","
"RTN","RORUTL06",75,0)
 G:$$CLEAR^RORUTL05(798.11,IENS)<0 ERROR  ; LOG EVENT (8.1)
"RTN","RORUTL06",76,0)
 G:$$CLEAR^RORUTL05(798.114,IENS)<0 ERROR ; NOTIFICATION (14)
"RTN","RORUTL06",77,0)
 G:$$CLEAR^RORUTL05(798.122,IENS)<0 ERROR ; LAST BATCH CONTROL ID (22)
"RTN","RORUTL06",78,0)
 G:$$CLEAR^RORUTL05(798.128,IENS)<0 ERROR ; LOCAL LAB TEST (28)
"RTN","RORUTL06",79,0)
 G:$$CLEAR^RORUTL05(798.129,IENS)<0 ERROR ; LOCAL DRUG (29)
"RTN","RORUTL06",80,0)
 G:$$CLEAR^RORUTL05(798.12,IENS)<0 ERROR  ; REPORT STATS (30)
"RTN","RORUTL06",81,0)
 ;--- Registry-specific data
"RTN","RORUTL06",82,0)
 I REGNAME="VA HEPC"  G:$$HEPC(REGIEN)<0 ERROR
"RTN","RORUTL06",83,0)
 I REGNAME="VA HIV"   G:$$HIV(REGIEN)<0 ERROR
"RTN","RORUTL06",84,0)
 ;--- Clean the ROR LOCAL FIELD file (#799.53)
"RTN","RORUTL06",85,0)
 G:$$LOCFLDS()<0 ERROR
"RTN","RORUTL06",86,0)
 ;--- Success
"RTN","RORUTL06",87,0)
 W !,"Registry parameters are ready for distribution."
"RTN","RORUTL06",88,0)
 Q
"RTN","RORUTL06",89,0)
 ;
"RTN","RORUTL06",90,0)
 ;***** DISPLAYS THE ERRORS
"RTN","RORUTL06",91,0)
ERROR ;
"RTN","RORUTL06",92,0)
 D DSPSTK^RORERR()
"RTN","RORUTL06",93,0)
 Q
"RTN","RORUTL06",94,0)
 ;
"RTN","RORUTL06",95,0)
 ;***** VALIDATES DATA EXTRACTION DEFINITION
"RTN","RORUTL06",96,0)
 ;
"RTN","RORUTL06",97,0)
 ; .REGLST       Reference to a local array containing
"RTN","RORUTL06",98,0)
 ;               registry names as subscripts
"RTN","RORUTL06",99,0)
 ;
"RTN","RORUTL06",100,0)
 ; Return Values:
"RTN","RORUTL06",101,0)
 ;       <0  Error Code
"RTN","RORUTL06",102,0)
 ;        0  Ok
"RTN","RORUTL06",103,0)
 ;
"RTN","RORUTL06",104,0)
EXTDEF(REGLST) ;
"RTN","RORUTL06",105,0)
 N RORERRDL      ; Default error location
"RTN","RORUTL06",106,0)
 N ROREXT        ; Data extraction descriptor
"RTN","RORUTL06",107,0)
 N RORHL         ; HL7 variables
"RTN","RORUTL06",108,0)
 N RORLRC        ; List of codes of Lab results to be extracted
"RTN","RORUTL06",109,0)
 ;
"RTN","RORUTL06",110,0)
 N RC
"RTN","RORUTL06",111,0)
 W !,"DATA EXTRACTION DEFINITION",!
"RTN","RORUTL06",112,0)
 D CLEAR^RORERR("UPDDEF^RORUTL06")
"RTN","RORUTL06",113,0)
 S RC=$$PREPARE^ROREXPR(.REGLST)
"RTN","RORUTL06",114,0)
 D:RC'<0 DEBUG^ROREXTUT
"RTN","RORUTL06",115,0)
 Q RC
"RTN","RORUTL06",116,0)
 ;
"RTN","RORUTL06",117,0)
 ;***** HEPC-SPECIFIC PREPARATIONS
"RTN","RORUTL06",118,0)
HEPC(REGIEN) ;
"RTN","RORUTL06",119,0)
 N IENS,RORFDA,RORMSG
"RTN","RORUTL06",120,0)
 S IENS=(+REGIEN)_","
"RTN","RORUTL06",121,0)
 D:$G(RORFULL)
"RTN","RORUTL06",122,0)
 . S RORFDA(798.1,IENS,1)=2900101  ; REGISTRY UPDATED UNTIL
"RTN","RORUTL06",123,0)
 . S RORFDA(798.1,IENS,2)=2850101  ; DATA EXTRACTED UNTIL
"RTN","RORUTL06",124,0)
 S RORFDA(798.1,IENS,25)=1         ; ENABLE PROTOCOLS
"RTN","RORUTL06",125,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORUTL06",126,0)
 Q $$DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","RORUTL06",127,0)
 ;
"RTN","RORUTL06",128,0)
 ;***** HIV-SPECIFIC PREPARATIONS
"RTN","RORUTL06",129,0)
HIV(REGIEN) ;
"RTN","RORUTL06",130,0)
 N IENS,RORFDA,RORMSG
"RTN","RORUTL06",131,0)
 S IENS=(+REGIEN)_","
"RTN","RORUTL06",132,0)
 D:$G(RORFULL)
"RTN","RORUTL06",133,0)
 . S RORFDA(798.1,IENS,1)=2850101  ; REGISTRY UPDATED UNTIL
"RTN","RORUTL06",134,0)
 . S RORFDA(798.1,IENS,2)=2850101  ; DATA EXTRACTED UNTIL
"RTN","RORUTL06",135,0)
 S RORFDA(798.1,IENS,25)=1         ; ENABLE PROTOCOLS
"RTN","RORUTL06",136,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORUTL06",137,0)
 Q $$DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","RORUTL06",138,0)
 ;
"RTN","RORUTL06",139,0)
 ;***** CLEANS THE 'ROR LOCAL FIELD' FILE (#799.53)
"RTN","RORUTL06",140,0)
LOCFLDS() ;
"RTN","RORUTL06",141,0)
 N DA,DIK,ROOT
"RTN","RORUTL06",142,0)
 S DIK=$$ROOT^DILFD(799.53),ROOT=$$CREF^DILF(DIK)
"RTN","RORUTL06",143,0)
 S DA=0
"RTN","RORUTL06",144,0)
 F  S DA=$O(@ROOT@(DA))  Q:DA'>0  D ^DIK
"RTN","RORUTL06",145,0)
 Q 0
"RTN","RORUTL06",146,0)
 ;
"RTN","RORUTL06",147,0)
 ;***** PRINTS THE DATA ELEMENT METADATA
"RTN","RORUTL06",148,0)
PRTMDE ;
"RTN","RORUTL06",149,0)
 N RORCOLS       ; Lits of column descriptors
"RTN","RORUTL06",150,0)
 N RORERRDL      ; Default error location
"RTN","RORUTL06",151,0)
 N RORERROR      ; Error processing data
"RTN","RORUTL06",152,0)
 N RORLST        ; List of files grouped by parents
"RTN","RORUTL06",153,0)
 N RORPAGE       ; Current page number
"RTN","RORUTL06",154,0)
 N RORPARM       ; Application parameters
"RTN","RORUTL06",155,0)
 N RORTTL        ; Title of the report
"RTN","RORUTL06",156,0)
 ;
"RTN","RORUTL06",157,0)
 N DIR,DIRUT,DTOUT,DUOUT,MODE,TMP,X,Y
"RTN","RORUTL06",158,0)
 D KILL^XUSCLEAN
"RTN","RORUTL06",159,0)
 S (DDBDMSG,RORTTL)="METADATA OF THE DATA ELEMENTS"
"RTN","RORUTL06",160,0)
 W !,RORTTL,!  S RORPARM("ERR")=1
"RTN","RORUTL06",161,0)
 D CLEAR^RORERR("PRTMDE^RORUTL06")
"RTN","RORUTL06",162,0)
 ;---Request report sort mode from user
"RTN","RORUTL06",163,0)
 S DIR(0)="S^H:Hierarhical;L:List of codes"
"RTN","RORUTL06",164,0)
 S DIR("A")="Sort mode",DIR("B")="List of codes"
"RTN","RORUTL06",165,0)
 D ^DIR  Q:$D(DIRUT)  S MODE=Y
"RTN","RORUTL06",166,0)
 ;--- Generate and print the report
"RTN","RORUTL06",167,0)
 I MODE="H"  S RC=0  D
"RTN","RORUTL06",168,0)
 . N %ZIS,I,FILE,PARENT,ROOT,RORMSG
"RTN","RORUTL06",169,0)
 . S ROOT=$$ROOT^DILFD(799.2,,1),RORPAGE=0
"RTN","RORUTL06",170,0)
 . ;--- Load column descriptors
"RTN","RORUTL06",171,0)
 . F I=1:1  S TMP=$P($T(PRTMDEH+I),";;",2)  Q:TMP=""  D
"RTN","RORUTL06",172,0)
 . . S RORCOLS(I)=$TR($P(TMP,U,1,3)," ")_U_$P(TMP,U,4)
"RTN","RORUTL06",173,0)
 . ;--- Load file list
"RTN","RORUTL06",174,0)
 . S FILE=0,RC=0
"RTN","RORUTL06",175,0)
 . F  S FILE=$O(@ROOT@(FILE))  Q:FILE'>0  D  Q:RC<0
"RTN","RORUTL06",176,0)
 . . S PARENT=+$$GET1^DIQ(799.2,FILE_",",1,"I",,"RORMSG")
"RTN","RORUTL06",177,0)
 . . I $G(DIERR)  D  Q
"RTN","RORUTL06",178,0)
 . . . S RC=$$DBS^RORERR("RORMSG",-9,,,799.2,FILE_",")
"RTN","RORUTL06",179,0)
 . . S RORLST(PARENT,FILE)=""
"RTN","RORUTL06",180,0)
 . Q:RC<0
"RTN","RORUTL06",181,0)
 . ;--- Print the report
"RTN","RORUTL06",182,0)
 . S %ZIS("B")=""
"RTN","RORUTL06",183,0)
 . D ^%ZIS   Q:$G(POP)  U IO
"RTN","RORUTL06",184,0)
 . S RC=$$PRTMDEH()  S:RC'<0 RC=$$PRTMDE1(0,1)
"RTN","RORUTL06",185,0)
 . D ^%ZISC
"RTN","RORUTL06",186,0)
 E  S RC=$$PRTMDE2()
"RTN","RORUTL06",187,0)
 G:RC<0 ERROR
"RTN","RORUTL06",188,0)
 Q
"RTN","RORUTL06",189,0)
 ;
"RTN","RORUTL06",190,0)
 ;***** PRINTS A LEVEL OF THE "FILE-PROCESSING TREE"
"RTN","RORUTL06",191,0)
 ;
"RTN","RORUTL06",192,0)
 ; PARENT        Parent file number
"RTN","RORUTL06",193,0)
 ; LEVEL         Number of the current level in the tree
"RTN","RORUTL06",194,0)
 ;
"RTN","RORUTL06",195,0)
 ; Return Values:
"RTN","RORUTL06",196,0)
 ;       <0  Error Code
"RTN","RORUTL06",197,0)
 ;        0  Ok
"RTN","RORUTL06",198,0)
 ;
"RTN","RORUTL06",199,0)
PRTMDE1(PARENT,LEVEL) ;
"RTN","RORUTL06",200,0)
 N FIELDS,FILE,FLD,I,IENS,IR,L,RORBUF,RORMSG
"RTN","RORUTL06",201,0)
 S FIELDS="@;.01E;.02I;1I;2E;4I;4.1;4.2;6I"
"RTN","RORUTL06",202,0)
 ;---
"RTN","RORUTL06",203,0)
 S FILE="",RC=0
"RTN","RORUTL06",204,0)
 F  S FILE=$O(RORLST(PARENT,FILE))  Q:FILE=""  D  Q:RC<0
"RTN","RORUTL06",205,0)
 . ;--- Load descriptors of the data elements
"RTN","RORUTL06",206,0)
 . K RORBUF  S IENS=","_FILE_","
"RTN","RORUTL06",207,0)
 . D LIST^DIC(799.22,IENS,FIELDS,,,,,"B",,,"RORBUF","RORMSG")
"RTN","RORUTL06",208,0)
 . ;--- Print header (if necessary) and file number
"RTN","RORUTL06",209,0)
 . I ($Y+5)>IOSL  S RC=$$PRTMDEH()  Q:RC<0
"RTN","RORUTL06",210,0)
 . D PRTMDEL(LEVEL-1),PRTMDEL(LEVEL-1,FILE)
"RTN","RORUTL06",211,0)
 . ;--- Print data element descriptors
"RTN","RORUTL06",212,0)
 . S IR="",RC=0
"RTN","RORUTL06",213,0)
 . F  S IR=$O(RORBUF("DILIST","ID",IR))  Q:IR=""  D  Q:RC<0  W !
"RTN","RORUTL06",214,0)
 . . I ($Y+5)>IOSL  S RC=$$PRTMDEH()  Q:RC<0
"RTN","RORUTL06",215,0)
 . . D:IR>1 PRTMDEL(LEVEL,"")
"RTN","RORUTL06",216,0)
 . . S I=""
"RTN","RORUTL06",217,0)
 . . F  S I=$O(RORCOLS(I))  Q:I=""  D
"RTN","RORUTL06",218,0)
 . . . S FLD=+$P(RORCOLS(I),U,2)  Q:FLD'>0
"RTN","RORUTL06",219,0)
 . . . S L=+$P(RORCOLS(I),U,3)  S:L'>0 L=999
"RTN","RORUTL06",220,0)
 . . . W ?(+RORCOLS(I)),$E($G(RORBUF("DILIST","ID",IR,FLD)),1,L)
"RTN","RORUTL06",221,0)
 . Q:RC<0
"RTN","RORUTL06",222,0)
 . S:$D(RORLST(FILE))>1 RC=$$PRTMDE1(FILE,LEVEL+1)
"RTN","RORUTL06",223,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUTL06",224,0)
 ;
"RTN","RORUTL06",225,0)
 ;***** PRINTS A TABLE OF DATA ELEMENTS
"RTN","RORUTL06",226,0)
PRTMDE2() ;
"RTN","RORUTL06",227,0)
 N BY,DHD,FR,L,DIC,FLDS,TO
"RTN","RORUTL06",228,0)
 S L=0,DIC=799.2,DHD=RORTTL
"RTN","RORUTL06",229,0)
 S BY="[ROR DATA ELEMENTS]",FLDS="[ROR DATA ELEMENTS]"
"RTN","RORUTL06",230,0)
 D EN1^DIP
"RTN","RORUTL06",231,0)
 Q 0
"RTN","RORUTL06",232,0)
 ;
"RTN","RORUTL06",233,0)
 ;***** PRINTS A HEADER OF THE DATA ELEMENT REPORT
"RTN","RORUTL06",234,0)
 ;  X  Field Width Title
"RTN","RORUTL06",235,0)
PRTMDEH() ;
"RTN","RORUTL06",236,0)
 ;;  0^     ^     ^File
"RTN","RORUTL06",237,0)
 ;; 22^  .01^   25^Data Name
"RTN","RORUTL06",238,0)
 ;; 49^  .02^     ^Code
"RTN","RORUTL06",239,0)
 ;; 55^ 2   ^     ^Req
"RTN","RORUTL06",240,0)
 ;; 60^ 1   ^     ^API
"RTN","RORUTL06",241,0)
 ;; 65^ 6   ^     ^Field Number
"RTN","RORUTL06",242,0)
 ;; 82^ 4   ^     ^VT
"RTN","RORUTL06",243,0)
 ;; 86^ 4.1 ^   20^External
"RTN","RORUTL06",244,0)
 ;;108^ 4.2 ^   20^Internal
"RTN","RORUTL06",245,0)
 ;
"RTN","RORUTL06",246,0)
 N DIR,DIRUT,DTOUT,DUOUT,I,X,Y
"RTN","RORUTL06",247,0)
 I RORPAGE,$E(IOST,1,2)="C-"  D  Q:'Y $S(Y="":-72,1:-71)
"RTN","RORUTL06",248,0)
 . S DIR(0)="E"  D ^DIR
"RTN","RORUTL06",249,0)
 W:RORPAGE!($E(IOST,1,2)="C-") @IOF
"RTN","RORUTL06",250,0)
 S RORPAGE=RORPAGE+1,I=""  W RORTTL,!
"RTN","RORUTL06",251,0)
 F  S I=$O(RORCOLS(I))  Q:I=""  W ?(+RORCOLS(I)),$P(RORCOLS(I),U,4)
"RTN","RORUTL06",252,0)
 S X="",$P(X,"-",IOM)=""
"RTN","RORUTL06",253,0)
 W !,X,!
"RTN","RORUTL06",254,0)
 Q 0
"RTN","RORUTL06",255,0)
 ;
"RTN","RORUTL06",256,0)
 ;***** PRINTS THE LEVEL INDICATOR
"RTN","RORUTL06",257,0)
 ;
"RTN","RORUTL06",258,0)
 ; N             Number of dots in the indicator
"RTN","RORUTL06",259,0)
 ; [FILE]        File number
"RTN","RORUTL06",260,0)
 ;
"RTN","RORUTL06",261,0)
PRTMDEL(N,FILE) ;
"RTN","RORUTL06",262,0)
 N I  W:$X>0 !  F I=1:1:N  W ". "
"RTN","RORUTL06",263,0)
 W:$D(FILE) FILE  W:'$D(FILE) !
"RTN","RORUTL06",264,0)
 Q
"RTN","RORUTL06",265,0)
 ;
"RTN","RORUTL06",266,0)
 ;***** VALIDATES REGISTRY UPDATE DEFINITION
"RTN","RORUTL06",267,0)
 ;
"RTN","RORUTL06",268,0)
 ; .REGLST       Reference to a local array containing
"RTN","RORUTL06",269,0)
 ;               registry names as subscripts
"RTN","RORUTL06",270,0)
 ;
"RTN","RORUTL06",271,0)
 ; Return Values:
"RTN","RORUTL06",272,0)
 ;       <0  Error Code
"RTN","RORUTL06",273,0)
 ;        0  Ok
"RTN","RORUTL06",274,0)
 ;
"RTN","RORUTL06",275,0)
UPDDEF(REGLST) ;
"RTN","RORUTL06",276,0)
 N RORERRDL      ; Default error location
"RTN","RORUTL06",277,0)
 N RORLRC        ; List of Lab result codes to check
"RTN","RORUTL06",278,0)
 N RORUPD        ; Update descriptor
"RTN","RORUTL06",279,0)
 N RORUPDPI      ; Closed root of the temporary storage
"RTN","RORUTL06",280,0)
 N RORVALS       ; Calculated values
"RTN","RORUTL06",281,0)
 ;
"RTN","RORUTL06",282,0)
 N RC
"RTN","RORUTL06",283,0)
 W !,"REGISTRY UPDATE DEFINITION",!
"RTN","RORUTL06",284,0)
 D CLEAR^RORERR("UPDDEF^RORUTL06")
"RTN","RORUTL06",285,0)
 S RORUPDPI=$NA(^TMP("RORUPD",$J))
"RTN","RORUTL06",286,0)
 S RC=$$PREPARE^RORUPR(.REGLST)
"RTN","RORUTL06",287,0)
 D:RC'<0 DEBUG^RORUPDUT
"RTN","RORUTL06",288,0)
 Q RC
"RTN","RORUTL07")
0^152^B6858018
"RTN","RORUTL07",1,0)
RORUTL07 ;HCIOFO/SG - TEST ENTRY POINTS ; 11/1/05 1:12pm
"RTN","RORUTL07",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL07",3,0)
 ;
"RTN","RORUTL07",4,0)
 Q
"RTN","RORUTL07",5,0)
 ;
"RTN","RORUTL07",6,0)
 ;***** DISPLAYS THE ERRORS
"RTN","RORUTL07",7,0)
ERROR ;
"RTN","RORUTL07",8,0)
 D DSPSTK^RORERR()
"RTN","RORUTL07",9,0)
 Q
"RTN","RORUTL07",10,0)
 ;
"RTN","RORUTL07",11,0)
 ;***** DATA EXTRACTION TEST ENTRY POINT
"RTN","RORUTL07",12,0)
EXTRACT ;
"RTN","RORUTL07",13,0)
 N RORERRDL      ; Default error location
"RTN","RORUTL07",14,0)
 N RORERROR      ; Error processing data
"RTN","RORUTL07",15,0)
 N RORPARM       ; Application parameters
"RTN","RORUTL07",16,0)
 ;
"RTN","RORUTL07",17,0)
 N RC,REGLST,REGNAME,SDT
"RTN","RORUTL07",18,0)
 W !,"DATA EXTRACTION & TRANSMISSION IN DEBUG MODE",!
"RTN","RORUTL07",19,0)
 D KILL^XUSCLEAN
"RTN","RORUTL07",20,0)
 S RORPARM("DEBUG")=2
"RTN","RORUTL07",21,0)
 S RORPARM("ERR")=1
"RTN","RORUTL07",22,0)
 D CLEAR^RORERR("EXTRACT^RORUTL07")
"RTN","RORUTL07",23,0)
 ;--- Select registries
"RTN","RORUTL07",24,0)
 Q:$$SELREG(.REGLST)'>0
"RTN","RORUTL07",25,0)
 ;--- Request a start date
"RTN","RORUTL07",26,0)
 S SDT=$$GETSDT()                            G:SDT<0 ERROR
"RTN","RORUTL07",27,0)
 ;--- Extract the registry data
"RTN","RORUTL07",28,0)
 S RC=$$EXTRACT^ROREXT(.REGLST,SDT,,"S")  G:RC<0 ERROR
"RTN","RORUTL07",29,0)
 Q
"RTN","RORUTL07",30,0)
 ;
"RTN","RORUTL07",31,0)
 ;***** REQESTS A START DATE FROM A USER
"RTN","RORUTL07",32,0)
 ;
"RTN","RORUTL07",33,0)
 ; Return Values:
"RTN","RORUTL07",34,0)
 ;       <0  Error Code
"RTN","RORUTL07",35,0)
 ;       ""  No start date (default)
"RTN","RORUTL07",36,0)
 ;       >0  Start date
"RTN","RORUTL07",37,0)
 ;
"RTN","RORUTL07",38,0)
GETSDT() ;
"RTN","RORUTL07",39,0)
 ;;If you enter an empty string then the individual start date
"RTN","RORUTL07",40,0)
 ;;(from the registry record) will be used for each patient.
"RTN","RORUTL07",41,0)
 ;
"RTN","RORUTL07",42,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,RC,X,Y
"RTN","RORUTL07",43,0)
 S DIR(0)="DO^:DT:EX"
"RTN","RORUTL07",44,0)
 S DIR("A")="Start date for data extraction"
"RTN","RORUTL07",45,0)
 F X=1:1  S Y=$P($T(GETSDT+X),";;",2)  Q:Y=""  S DIR("?",X)=Y
"RTN","RORUTL07",46,0)
 S DIR("?")="This response must be a date."
"RTN","RORUTL07",47,0)
 D ^DIR
"RTN","RORUTL07",48,0)
 S RC=$S($D(DTOUT):-72,$D(DUOUT):-71,1:0)
"RTN","RORUTL07",49,0)
 Q $S(RC<0:RC,1:$G(Y))
"RTN","RORUTL07",50,0)
 ;
"RTN","RORUTL07",51,0)
 ;***** SELECTS REGISTRIES FROM THE FILE #798.1
"RTN","RORUTL07",52,0)
 ;
"RTN","RORUTL07",53,0)
 ; .REGLST       Reference to a local variable for the list of
"RTN","RORUTL07",54,0)
 ;               registry names (subscripts) and IENs (values)
"RTN","RORUTL07",55,0)
 ;
"RTN","RORUTL07",56,0)
 ; Return Values:
"RTN","RORUTL07",57,0)
 ;       <0  Error code
"RTN","RORUTL07",58,0)
 ;        0  Nothing selected
"RTN","RORUTL07",59,0)
 ;       >0  Number of selected registries
"RTN","RORUTL07",60,0)
 ;       ""  Timeout or "^"
"RTN","RORUTL07",61,0)
 ;
"RTN","RORUTL07",62,0)
SELREG(REGLST) ;
"RTN","RORUTL07",63,0)
 N CNT,DA,DIC,DLAYGO,DTOUT,DUOUT,X,Y
"RTN","RORUTL07",64,0)
 K REGLST  S CNT=0
"RTN","RORUTL07",65,0)
 ;--- Select a registry
"RTN","RORUTL07",66,0)
 S DIC=798.1,DIC(0)="AENQ"
"RTN","RORUTL07",67,0)
 S DIC("A")="Select a Registry: "
"RTN","RORUTL07",68,0)
 F  D  Q:Y'>0  S REGLST($P(Y,U,2))=+Y,CNT=CNT+1
"RTN","RORUTL07",69,0)
 . D ^DIC
"RTN","RORUTL07",70,0)
 W !
"RTN","RORUTL07",71,0)
 Q $S($D(DTOUT)!$D(DUOUT):"",1:CNT)
"RTN","RORUTL07",72,0)
 ;
"RTN","RORUTL07",73,0)
 ;***** REGISTRY UPDATE TEST ENTRY POINT
"RTN","RORUTL07",74,0)
UPDATE ;
"RTN","RORUTL07",75,0)
 N RORERRDL      ; Default error location
"RTN","RORUTL07",76,0)
 N RORERROR      ; Error processing data
"RTN","RORUTL07",77,0)
 N RORPARM       ; Application parameters
"RTN","RORUTL07",78,0)
 ;
"RTN","RORUTL07",79,0)
 N RC,REGLST,REGNAME
"RTN","RORUTL07",80,0)
 W !,"REGISTRY UPDATE IN DEBUG MODE",!
"RTN","RORUTL07",81,0)
 D KILL^XUSCLEAN
"RTN","RORUTL07",82,0)
 S RORPARM("DEBUG")=2
"RTN","RORUTL07",83,0)
 S RORPARM("ERR")=1
"RTN","RORUTL07",84,0)
 D CLEAR^RORERR("UPDATE^RORUTL07")
"RTN","RORUTL07",85,0)
 ;--- Select registries
"RTN","RORUTL07",86,0)
 Q:$$SELREG(.REGLST)'>0
"RTN","RORUTL07",87,0)
 ;--- Update the registry
"RTN","RORUTL07",88,0)
 S RC=$$UPDATE^RORUPD(.REGLST)  G:RC<0 ERROR
"RTN","RORUTL07",89,0)
 Q
"RTN","RORUTL08")
0^153^B17942076
"RTN","RORUTL08",1,0)
RORUTL08 ;HCIOFO/SG - REPORT PARAMETERS UTILITIES  ; 11/21/05 5:08pm
"RTN","RORUTL08",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL08",3,0)
 ;
"RTN","RORUTL08",4,0)
 Q
"RTN","RORUTL08",5,0)
 ;
"RTN","RORUTL08",6,0)
 ;***** RETURNS CODE AND NAME OF THE REPORT PARAMETERS (#799.34)
"RTN","RORUTL08",7,0)
 ;
"RTN","RORUTL08",8,0)
 ; RPIEN         IEN of the report parameters
"RTN","RORUTL08",9,0)
 ; [.NAME]       Report name is returned via this parameter
"RTN","RORUTL08",10,0)
 ;
"RTN","RORUTL08",11,0)
 ; Return Values:
"RTN","RORUTL08",12,0)
 ;       ""  Code is not available
"RTN","RORUTL08",13,0)
 ;           Code of the report
"RTN","RORUTL08",14,0)
 ;
"RTN","RORUTL08",15,0)
RPCODE(RPIEN,NAME) ;
"RTN","RORUTL08",16,0)
 S NAME=""  Q:RPIEN'>0 ""
"RTN","RORUTL08",17,0)
 N BUF
"RTN","RORUTL08",18,0)
 S BUF=$G(^ROR(799.34,+RPIEN,0))  Q:BUF="" ""
"RTN","RORUTL08",19,0)
 S NAME=$P(BUF,U)
"RTN","RORUTL08",20,0)
 Q $P(BUF,U,4)
"RTN","RORUTL08",21,0)
 ;
"RTN","RORUTL08",22,0)
 ;***** RETURNS IEN AND NAME OF THE REPORT PARAMETERS (#799.34)
"RTN","RORUTL08",23,0)
 ;
"RTN","RORUTL08",24,0)
 ; CODE          Code of the report
"RTN","RORUTL08",25,0)
 ; [.NAME]       Report name is returned via this parameter
"RTN","RORUTL08",26,0)
 ;
"RTN","RORUTL08",27,0)
 ; Return Values:
"RTN","RORUTL08",28,0)
 ;       <0  Error code
"RTN","RORUTL08",29,0)
 ;       >0  IEN of the item
"RTN","RORUTL08",30,0)
 ;
"RTN","RORUTL08",31,0)
RPIEN(CODE,NAME) ;
"RTN","RORUTL08",32,0)
 N RC,RORBUF,RORMSG  S NAME=""
"RTN","RORUTL08",33,0)
 D FIND^DIC(799.34,,"@;.01","QX",CODE,2,"KEY",,,"RORBUF","RORMSG")
"RTN","RORUTL08",34,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.34)
"RTN","RORUTL08",35,0)
 S RC=+$G(RORBUF("DILIST",0))
"RTN","RORUTL08",36,0)
 S:RC=1 NAME=$G(RORBUF("DILIST","ID",1,.01))
"RTN","RORUTL08",37,0)
 Q $S(RC<1:-86,RC>1:-87,1:+RORBUF("DILIST",2,1))
"RTN","RORUTL08",38,0)
 ;
"RTN","RORUTL08",39,0)
 ;***** RETURNS REPORT PARAMETERS
"RTN","RORUTL08",40,0)
 ;
"RTN","RORUTL08",41,0)
 ; CODE          Report code
"RTN","RORUTL08",42,0)
 ;
"RTN","RORUTL08",43,0)
 ; .INFO         Reference to a local variable (output):
"RTN","RORUTL08",44,0)
 ;
"RTN","RORUTL08",45,0)
 ; INFO(
"RTN","RORUTL08",46,0)
 ;   OFFSET+1)           Report Name
"RTN","RORUTL08",47,0)
 ;   OFFSET+2)           Backgr. Processing    (0/1)
"RTN","RORUTL08",48,0)
 ;   OFFSET+3)           reserved
"RTN","RORUTL08",49,0)
 ;   OFFSET+4)           Code of the report
"RTN","RORUTL08",50,0)
 ;   OFFSET+5)           Report Parameters IEN
"RTN","RORUTL08",51,0)
 ;   OFFSET+6)           Inactivation Date     (FileMan)
"RTN","RORUTL08",52,0)
 ;   OFFSET+7)           National              (0/1)
"RTN","RORUTL08",53,0)
 ;   OFFSET+8)           List of parameter panels
"RTN","RORUTL08",54,0)
 ;   OFFSET+9)           Report Builder        ($$TAG^ROUTINE)
"RTN","RORUTL08",55,0)
 ;   OFFSET+10)          Default parameters    (XML)
"RTN","RORUTL08",56,0)
 ;   OFFSET+11)          Default sorting modes (XML)
"RTN","RORUTL08",57,0)
 ;   OFFSET+12)          Shared Templates      (0/1)
"RTN","RORUTL08",58,0)
 ;
"RTN","RORUTL08",59,0)
 ; [FLAGS]       Characters controlling behavior of the function
"RTN","RORUTL08",60,0)
 ;               (they can be combined):
"RTN","RORUTL08",61,0)
 ;                 E  Return external values also (when applicable)
"RTN","RORUTL08",62,0)
 ;
"RTN","RORUTL08",63,0)
 ; [OFFSET]      A number that is added to all subscripts in the
"RTN","RORUTL08",64,0)
 ;               destination array (by default, it is zero).
"RTN","RORUTL08",65,0)
 ;
"RTN","RORUTL08",66,0)
 ; Return Values:
"RTN","RORUTL08",67,0)
 ;       <0  Error code
"RTN","RORUTL08",68,0)
 ;        0  Ok
"RTN","RORUTL08",69,0)
 ;
"RTN","RORUTL08",70,0)
RPINFO(CODE,INFO,FLAGS,OFFSET) ;
"RTN","RORUTL08",71,0)
 N BUF,I,IEN,IENS,RC,RORBUF,RORMSG,TMP
"RTN","RORUTL08",72,0)
 S FLAGS=$$UP^XLFSTR($G(FLAGS))
"RTN","RORUTL08",73,0)
 S OFFSET=$S($G(OFFSET)>0:+OFFSET,1:0)
"RTN","RORUTL08",74,0)
 ;--- Clear the output array
"RTN","RORUTL08",75,0)
 K:'OFFSET INFO  S TMP=$$RPN
"RTN","RORUTL08",76,0)
 F I=1:1:TMP  S INFO(OFFSET+I)=""
"RTN","RORUTL08",77,0)
 ;--- Get the record IEN
"RTN","RORUTL08",78,0)
 S IEN=$$RPIEN(CODE)  Q:IEN<0 IEN
"RTN","RORUTL08",79,0)
 ;--- Load the parameters
"RTN","RORUTL08",80,0)
 S IENS=IEN_",",I=$S(FLAGS["E":"EIN",1:"IN")
"RTN","RORUTL08",81,0)
 S TMP=".01;.02;.03;.04;.05;.09;1;10.01;11;12"
"RTN","RORUTL08",82,0)
 D GETS^DIQ(799.34,IENS,TMP,I,"RORBUF","RORMSG")
"RTN","RORUTL08",83,0)
 I $G(DIERR)  D  Q RC
"RTN","RORUTL08",84,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,799.34,IENS)
"RTN","RORUTL08",85,0)
 ;--- Name
"RTN","RORUTL08",86,0)
 S INFO(OFFSET+1)=$G(RORBUF(799.34,IENS,.01,"I"))
"RTN","RORUTL08",87,0)
 ;--- Background Processing
"RTN","RORUTL08",88,0)
 I $G(RORBUF(799.34,IENS,.02,"I"))'=""  D
"RTN","RORUTL08",89,0)
 . S INFO(OFFSET+2)=RORBUF(799.34,IENS,.02,"I")
"RTN","RORUTL08",90,0)
 ;--- Code of the report
"RTN","RORUTL08",91,0)
 S INFO(OFFSET+4)=$G(RORBUF(799.34,IENS,.04,"I"))
"RTN","RORUTL08",92,0)
 ;--- Report Parameters IEN
"RTN","RORUTL08",93,0)
 S INFO(OFFSET+5)=IEN
"RTN","RORUTL08",94,0)
 ;--- Inactivation Date
"RTN","RORUTL08",95,0)
 I $G(RORBUF(799.34,IENS,.05,"I"))'=""  D
"RTN","RORUTL08",96,0)
 . S INFO(OFFSET+6)=RORBUF(799.34,IENS,.05,"I")
"RTN","RORUTL08",97,0)
 ;--- National
"RTN","RORUTL08",98,0)
 I $G(RORBUF(799.34,IENS,.09,"I"))'=""  D
"RTN","RORUTL08",99,0)
 . S INFO(OFFSET+7)=RORBUF(799.34,IENS,.09,"I")
"RTN","RORUTL08",100,0)
 ;--- List of parameter panels
"RTN","RORUTL08",101,0)
 S INFO(OFFSET+8)=$G(RORBUF(799.34,IENS,1,"I"))
"RTN","RORUTL08",102,0)
 ;--- Report Builder
"RTN","RORUTL08",103,0)
 S INFO(OFFSET+9)=$G(RORBUF(799.34,IENS,10.01,"I"))
"RTN","RORUTL08",104,0)
 ;--- Default parameters
"RTN","RORUTL08",105,0)
 S I=0,BUF=""
"RTN","RORUTL08",106,0)
 F  S I=$O(RORBUF(799.34,IENS,11,I))  Q:I'>0  D
"RTN","RORUTL08",107,0)
 . S BUF=BUF_$$TRIM^XLFSTR(RORBUF(799.34,IENS,11,I))
"RTN","RORUTL08",108,0)
 S:BUF'="" INFO(OFFSET+10)="<PARAMS>"_BUF_"</PARAMS>"
"RTN","RORUTL08",109,0)
 ;--- Default sorting modes
"RTN","RORUTL08",110,0)
 S I=0,BUF=""
"RTN","RORUTL08",111,0)
 F  S I=$O(RORBUF(799.34,IENS,12,I))  Q:I'>0  D
"RTN","RORUTL08",112,0)
 . S BUF=BUF_$$TRIM^XLFSTR(RORBUF(799.34,IENS,12,I))
"RTN","RORUTL08",113,0)
 S:BUF'="" INFO(OFFSET+11)="<SORT_MODES>"_BUF_"</SORT_MODES>"
"RTN","RORUTL08",114,0)
 ;--- Shared Templates
"RTN","RORUTL08",115,0)
 S INFO(OFFSET+12)=$G(RORBUF(799.34,IENS,.03,"I"))
"RTN","RORUTL08",116,0)
 Q 0
"RTN","RORUTL08",117,0)
 ;
"RTN","RORUTL08",118,0)
 ;***** RETURNS A LIST OF REPORTS AVAILABLE FOR THE REGISTRY
"RTN","RORUTL08",119,0)
 ;
"RTN","RORUTL08",120,0)
 ; .ROR8DST      Reference to a local variable. Report parameters are
"RTN","RORUTL08",121,0)
 ;               returned into this array in the following format:
"RTN","RORUTL08",122,0)
 ;
"RTN","RORUTL08",123,0)
 ;                 ROR8DST(ReportCode)=ReportIEN^ReportName
"RTN","RORUTL08",124,0)
 ;
"RTN","RORUTL08",125,0)
 ; [REGIEN]      Registry IEN. If $G(REGIEN)>0, both the registry
"RTN","RORUTL08",126,0)
 ;               specific (REGISTRY=REGIEN) and common (REGISTRY=0)
"RTN","RORUTL08",127,0)
 ;               reports will be returned. Otherwise, only the common
"RTN","RORUTL08",128,0)
 ;               ones will be returned.
"RTN","RORUTL08",129,0)
 ;
"RTN","RORUTL08",130,0)
 ; [CDT]         "Current" Date/Time (NOW by default)
"RTN","RORUTL08",131,0)
 ;
"RTN","RORUTL08",132,0)
 ;               If this date/time is equal or later that the
"RTN","RORUTL08",133,0)
 ;               inactivation date from the record (only if there
"RTN","RORUTL08",134,0)
 ;               is any) then the record is considered inactive
"RTN","RORUTL08",135,0)
 ;               and will be skipped.
"RTN","RORUTL08",136,0)
 ;
"RTN","RORUTL08",137,0)
 ;               To include both active and inactive reports in the
"RTN","RORUTL08",138,0)
 ;               list, pass a negative number as the value of this
"RTN","RORUTL08",139,0)
 ;               parameter.
"RTN","RORUTL08",140,0)
 ;
"RTN","RORUTL08",141,0)
 ; Return Values:
"RTN","RORUTL08",142,0)
 ;       <0  Error code
"RTN","RORUTL08",143,0)
 ;        0  Ok
"RTN","RORUTL08",144,0)
 ;
"RTN","RORUTL08",145,0)
RPLIST(ROR8DST,REGIEN,CDT) ;
"RTN","RORUTL08",146,0)
 N CODE,I,IEN,IENS,NAME,INCTVDT,RC,RORMSG,RPLST
"RTN","RORUTL08",147,0)
 K ROR8DST  S RC=0  S:'$G(CDT) CDT=$$NOW^XLFDT
"RTN","RORUTL08",148,0)
 ;--- Load the list of available reports (report codes)
"RTN","RORUTL08",149,0)
 S IENS=(+REGIEN)_","
"RTN","RORUTL08",150,0)
 S RPLST=$$GET1^DIQ(798.1,IENS,27,,,"RORMSG")
"RTN","RORUTL08",151,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","RORUTL08",152,0)
 S RPLST=$TR(RPLST," ")
"RTN","RORUTL08",153,0)
 ;--- Load the report parameters
"RTN","RORUTL08",154,0)
 F I=1:1  S CODE=$P(RPLST,",",I)  Q:CODE=""  D  Q:RC<0
"RTN","RORUTL08",155,0)
 . S IEN=$$RPIEN(CODE,.NAME)  Q:IEN'>0
"RTN","RORUTL08",156,0)
 . S IENS=IEN_","
"RTN","RORUTL08",157,0)
 . ;--- Skip inactive report parameters
"RTN","RORUTL08",158,0)
 . S INCTVDT=$$GET1^DIQ(799.34,IENS,.05,"I",,"RORMSG")
"RTN","RORUTL08",159,0)
 . I $G(DIERR)  D  Q
"RTN","RORUTL08",160,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,799.34,IENS)
"RTN","RORUTL08",161,0)
 . I INCTVDT>0  Q:CDT'<INCTVDT
"RTN","RORUTL08",162,0)
 . ;--- Create a record in the destination array
"RTN","RORUTL08",163,0)
 . S ROR8DST(CODE)=IEN_U_NAME
"RTN","RORUTL08",164,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUTL08",165,0)
 ;
"RTN","RORUTL08",166,0)
 ;***** RETURNS NUMBER OF NODES IN THE PARAMETERS ARRAY
"RTN","RORUTL08",167,0)
RPN() Q 12
"RTN","RORUTL09")
0^154^B6692200
"RTN","RORUTL09",1,0)
RORUTL09 ;HCIOFO/SG - LIST ITEM UTILITIES  ; 4/26/05 10:46am
"RTN","RORUTL09",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL09",3,0)
 ;
"RTN","RORUTL09",4,0)
 Q
"RTN","RORUTL09",5,0)
 ;
"RTN","RORUTL09",6,0)
 ;***** RETURNS CODE AND TEXT OF THE ITEM IN THE FILE #799.1
"RTN","RORUTL09",7,0)
 ;
"RTN","RORUTL09",8,0)
 ; ITEMIEN       IEN of the item
"RTN","RORUTL09",9,0)
 ; [.TEXT]       Text of the item is returned via this parameter
"RTN","RORUTL09",10,0)
 ;
"RTN","RORUTL09",11,0)
 ; Return Values:
"RTN","RORUTL09",12,0)
 ;       <0  Error code
"RTN","RORUTL09",13,0)
 ;       ""  Code is not available
"RTN","RORUTL09",14,0)
 ;       >0  Code of the item
"RTN","RORUTL09",15,0)
 ;
"RTN","RORUTL09",16,0)
ITEMCODE(ITEMIEN,TEXT) ;
"RTN","RORUTL09",17,0)
 S TEXT=""  Q:ITEMIEN'>0 ""
"RTN","RORUTL09",18,0)
 Q:'$D(^ROR(799.1,+ITEMIEN,0)) ""
"RTN","RORUTL09",19,0)
 N IENS,RC,RORBUF,RORMSG
"RTN","RORUTL09",20,0)
 S IENS=(+ITEMIEN)_","
"RTN","RORUTL09",21,0)
 D GETS^DIQ(799.1,IENS,".01;.04",,"RORBUF","RORMSG")
"RTN","RORUTL09",22,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.1,IENS)
"RTN","RORUTL09",23,0)
 S TEXT=$G(RORBUF(799.1,IENS,.01))
"RTN","RORUTL09",24,0)
 Q $G(RORBUF(799.1,IENS,.04))
"RTN","RORUTL09",25,0)
 ;
"RTN","RORUTL09",26,0)
 ;***** RETURNS IEN AND TEXT OF THE ITEM IN THE FILE #799.1
"RTN","RORUTL09",27,0)
 ;
"RTN","RORUTL09",28,0)
 ; TYPE          Type of the item
"RTN","RORUTL09",29,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL09",30,0)
 ; CODE          Code of the item
"RTN","RORUTL09",31,0)
 ; [.TEXT]       Text of the item is returned via this parameter
"RTN","RORUTL09",32,0)
 ;
"RTN","RORUTL09",33,0)
 ; Return Values:
"RTN","RORUTL09",34,0)
 ;       <0  Error code
"RTN","RORUTL09",35,0)
 ;       >0  IEN of the item
"RTN","RORUTL09",36,0)
 ;
"RTN","RORUTL09",37,0)
ITEMIEN(TYPE,REGIEN,CODE,TEXT) ;
"RTN","RORUTL09",38,0)
 N RC,RORBUF,RORMSG,SRCHVAL
"RTN","RORUTL09",39,0)
 S TEXT="",SRCHVAL(1)=+TYPE,SRCHVAL(2)=+REGIEN,SRCHVAL(3)=+CODE
"RTN","RORUTL09",40,0)
 D FIND^DIC(799.1,,"@;.01","QX",.SRCHVAL,2,"KEY",,,"RORBUF","RORMSG")
"RTN","RORUTL09",41,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,799.1)
"RTN","RORUTL09",42,0)
 S RC=+$G(RORBUF("DILIST",0))
"RTN","RORUTL09",43,0)
 S:RC=1 TEXT=$G(RORBUF("DILIST","ID",1,.01))
"RTN","RORUTL09",44,0)
 Q $S(RC<1:-80,RC>1:-81,1:+RORBUF("DILIST",2,1))
"RTN","RORUTL09",45,0)
 ;
"RTN","RORUTL09",46,0)
 ;***** RETURNS A LIST OF ITEMS FROM THE FILE #799.1
"RTN","RORUTL09",47,0)
 ;
"RTN","RORUTL09",48,0)
 ; TYPE          Type of the items:
"RTN","RORUTL09",49,0)
 ;                 3  Lab Group
"RTN","RORUTL09",50,0)
 ;                 4  Drug Group
"RTN","RORUTL09",51,0)
 ;
"RTN","RORUTL09",52,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL09",53,0)
 ;
"RTN","RORUTL09",54,0)
 ; .ROR8DST      Reference to a destination array.
"RTN","RORUTL09",55,0)
 ;               Items are returned into this array in the following
"RTN","RORUTL09",56,0)
 ;               format: ROR8DST(ItemCode)=ItemIEN^ItemText
"RTN","RORUTL09",57,0)
 ;
"RTN","RORUTL09",58,0)
 ; [CDT]         "Current" Date/Time (NOW by default)
"RTN","RORUTL09",59,0)
 ;
"RTN","RORUTL09",60,0)
 ;               If this date/time is equal or later that the
"RTN","RORUTL09",61,0)
 ;               inactivation date from the item record (only if
"RTN","RORUTL09",62,0)
 ;               there is any) then the item is considered inactive
"RTN","RORUTL09",63,0)
 ;               and will be skipped.
"RTN","RORUTL09",64,0)
 ;
"RTN","RORUTL09",65,0)
 ;               To include both active and inactive items in the
"RTN","RORUTL09",66,0)
 ;               list, pass a negative number as the value of this
"RTN","RORUTL09",67,0)
 ;               parameter.
"RTN","RORUTL09",68,0)
 ;
"RTN","RORUTL09",69,0)
 ; Return Values:
"RTN","RORUTL09",70,0)
 ;       <0  Error code
"RTN","RORUTL09",71,0)
 ;        0  Ok
"RTN","RORUTL09",72,0)
 ;
"RTN","RORUTL09",73,0)
ITEMLIST(TYPE,REGIEN,ROR8DST,CDT) ;
"RTN","RORUTL09",74,0)
 N CODE,IEN,IENS,INCTVDT,NODE,RC,RORBUF,RORMSG
"RTN","RORUTL09",75,0)
 S NODE=$NA(^ROR(799.1,"KEY",TYPE,REGIEN))  K ROR8DST
"RTN","RORUTL09",76,0)
 S:'$G(CDT) CDT=$$NOW^XLFDT
"RTN","RORUTL09",77,0)
 ;--- Load the active list items
"RTN","RORUTL09",78,0)
 S CODE="",RC=0
"RTN","RORUTL09",79,0)
 F  S CODE=$O(@NODE@(CODE))  Q:CODE=""  D  Q:RC<0
"RTN","RORUTL09",80,0)
 . S IEN=$O(@NODE@(CODE,""))  Q:'IEN
"RTN","RORUTL09",81,0)
 . S IENS=IEN_","  K RORBUF
"RTN","RORUTL09",82,0)
 . ;--- Load text and inactivation date
"RTN","RORUTL09",83,0)
 . D GETS^DIQ(799.1,IENS,".01;1","IE","RORBUF","RORMSG")
"RTN","RORUTL09",84,0)
 . I $G(DIERR)  D  Q
"RTN","RORUTL09",85,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,799.1,IENS)
"RTN","RORUTL09",86,0)
 . ;--- Skip inactive items
"RTN","RORUTL09",87,0)
 . S INCTVDT=$G(RORBUF(799.1,IENS,1,"I"))
"RTN","RORUTL09",88,0)
 . I INCTVDT>0  Q:CDT'<INCTVDT
"RTN","RORUTL09",89,0)
 . ;--- Create a record in the destination array
"RTN","RORUTL09",90,0)
 . S ROR8DST(CODE)=IEN_U_$G(RORBUF(799.1,IENS,.01,"E"))
"RTN","RORUTL09",91,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUTL10")
0^155^B40383170
"RTN","RORUTL10",1,0)
RORUTL10 ;HCIOFO/SG - LAB DATA SEARCH ; 10/14/05 3:29pm
"RTN","RORUTL10",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL10",3,0)
 ;
"RTN","RORUTL10",4,0)
 ; This routine uses the following IAs:
"RTN","RORUTL10",5,0)
 ;
"RTN","RORUTL10",6,0)
 ; #91           Read access to the file #60
"RTN","RORUTL10",7,0)
 ; #554          Read access to the file #63
"RTN","RORUTL10",8,0)
 ; #998          Laboratory reference from file #2
"RTN","RORUTL10",9,0)
 ;
"RTN","RORUTL10",10,0)
 Q
"RTN","RORUTL10",11,0)
 ;
"RTN","RORUTL10",12,0)
 ;***** LOADS THE LIST OF TESTS FROM THE REGISTRY PARAMETERS
"RTN","RORUTL10",13,0)
 ;
"RTN","RORUTL10",14,0)
 ; ROR8LTST      Closed root of a variable, which will contain
"RTN","RORUTL10",15,0)
 ;               a list of lab tests of interest:
"RTN","RORUTL10",16,0)
 ;
"RTN","RORUTL10",17,0)
 ;               @ROR8LTST@(ResultNode,TestIEN)
"RTN","RORUTL10",18,0)
 ;                 ^01: Test IEN (in file #60)
"RTN","RORUTL10",19,0)
 ;                 ^02: Test name
"RTN","RORUTL10",20,0)
 ;                 ^03: Code of the group
"RTN","RORUTL10",21,0)
 ;                 ^04: Group name
"RTN","RORUTL10",22,0)
 ;                 ^05: Location subscript
"RTN","RORUTL10",23,0)
 ;                 ^06: Result node
"RTN","RORUTL10",24,0)
 ;
"RTN","RORUTL10",25,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL10",26,0)
 ;
"RTN","RORUTL10",27,0)
 ; [GROUPS]      List of codes (separated by commas) of Lab Groups
"RTN","RORUTL10",28,0)
 ;               to load (1 - CD4, 2 - CD4 %, 3 - Viral Load).
"RTN","RORUTL10",29,0)
 ;               If this parameter is undefined or empty then all
"RTN","RORUTL10",30,0)
 ;               tests will be loaded.
"RTN","RORUTL10",31,0)
 ;
"RTN","RORUTL10",32,0)
 ; Return Values:
"RTN","RORUTL10",33,0)
 ;       <0  Error code
"RTN","RORUTL10",34,0)
 ;        0  No tests are defined
"RTN","RORUTL10",35,0)
 ;       >0  Number of the tests
"RTN","RORUTL10",36,0)
 ;
"RTN","RORUTL10",37,0)
LOADTSTS(ROR8LTST,REGIEN,GROUPS) ;
"RTN","RORUTL10",38,0)
 N BUF,CNT,GRIEN,I,IEN,IENS,LTIEN,LTNODE,NAME,NODE,RC,RGIENS,RORBUF,RORMSG,TMP
"RTN","RORUTL10",39,0)
 S RC=0,RGIENS=","_(+REGIEN)_","  K @ROR8LTST
"RTN","RORUTL10",40,0)
 S NODE=$$ROOT^DILFD(798.128,RGIENS,1)
"RTN","RORUTL10",41,0)
 ;--- List of Group IEN's
"RTN","RORUTL10",42,0)
 S GROUPS=$TR($G(GROUPS)," ")
"RTN","RORUTL10",43,0)
 D:GROUPS'=""
"RTN","RORUTL10",44,0)
 . F I=1:1  S TMP=$P(GROUPS,",",I)  Q:TMP'>0  D
"RTN","RORUTL10",45,0)
 . . S TMP=$$ITEMIEN^RORUTL09(3,REGIEN,TMP)
"RTN","RORUTL10",46,0)
 . . S:TMP>0 GRIEN(TMP)=""
"RTN","RORUTL10",47,0)
 ;---
"RTN","RORUTL10",48,0)
 S (CNT,IEN)=0
"RTN","RORUTL10",49,0)
 F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORUTL10",50,0)
 . K RORBUF  S BUF=""
"RTN","RORUTL10",51,0)
 . ;--- Load the local test reference
"RTN","RORUTL10",52,0)
 . S IENS=IEN_RGIENS
"RTN","RORUTL10",53,0)
 . D GETS^DIQ(798.128,IENS,".01;.02","I","RORBUF","RORMSG")
"RTN","RORUTL10",54,0)
 . I $G(DIERR)  D  Q
"RTN","RORUTL10",55,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,798.128,IENS)
"RTN","RORUTL10",56,0)
 . S (BUF,LTIEN)=+$G(RORBUF(798.128,IENS,.01,"I"))
"RTN","RORUTL10",57,0)
 . Q:LTIEN'>0
"RTN","RORUTL10",58,0)
 . ;--- Check the Lab Group
"RTN","RORUTL10",59,0)
 . S GRIEN=+$G(RORBUF(798.128,IENS,.02,"I"))
"RTN","RORUTL10",60,0)
 . I $D(GRIEN)>1  Q:'$D(GRIEN(GRIEN))
"RTN","RORUTL10",61,0)
 . I GRIEN>0  D  Q:RC<0
"RTN","RORUTL10",62,0)
 . . S TMP=$$ITEMCODE^RORUTL09(GRIEN,.NAME)
"RTN","RORUTL10",63,0)
 . . I TMP'>0  S:TMP<0 RC=+TMP  Q
"RTN","RORUTL10",64,0)
 . . S $P(BUF,U,3,4)=TMP_U_NAME  ; Code and name of the group
"RTN","RORUTL10",65,0)
 . ;--- Load the lab test parameters
"RTN","RORUTL10",66,0)
 . S IENS=LTIEN_","
"RTN","RORUTL10",67,0)
 . D GETS^DIQ(60,IENS,".01;5","EI","RORBUF","RORMSG")
"RTN","RORUTL10",68,0)
 . I $G(DIERR)  D  Q
"RTN","RORUTL10",69,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,60,IENS)
"RTN","RORUTL10",70,0)
 . S LTNODE=$P($G(RORBUF(60,IENS,5,"I")),";",2)
"RTN","RORUTL10",71,0)
 . Q:LTNODE=""
"RTN","RORUTL10",72,0)
 . S TMP=$G(RORBUF(60,IENS,.01,"E"))             ; Name of the test
"RTN","RORUTL10",73,0)
 . S $P(BUF,U,2)=$S(TMP'="":TMP,1:"Unknown ("_LTIEN_")")
"RTN","RORUTL10",74,0)
 . S $P(BUF,U,5)=$P(RORBUF(60,IENS,5,"I"),";",1) ; Subscript
"RTN","RORUTL10",75,0)
 . S $P(BUF,U,6)=$P(RORBUF(60,IENS,5,"I"),";",2) ; Result node
"RTN","RORUTL10",76,0)
 . ;--- Create the reference
"RTN","RORUTL10",77,0)
 . S @ROR8LTST@(LTNODE,LTIEN)=BUF,CNT=CNT+1
"RTN","RORUTL10",78,0)
 ;---
"RTN","RORUTL10",79,0)
 Q $S(RC<0:RC,1:CNT)
"RTN","RORUTL10",80,0)
 ;
"RTN","RORUTL10",81,0)
 ;***** SEARCHES THE LAB DATA FOR REGISTRY SPECIFIC RESULTS
"RTN","RORUTL10",82,0)
 ;
"RTN","RORUTL10",83,0)
 ; PATIEN        IEN of the patient (DFN)
"RTN","RORUTL10",84,0)
 ;
"RTN","RORUTL10",85,0)
 ; ROR8LT        Closed root of a variable, which contains a list
"RTN","RORUTL10",86,0)
 ;               of lab tests of interest (in the same format as
"RTN","RORUTL10",87,0)
 ;               the list returned by the $$LOADTSTS^RORUTL10).
"RTN","RORUTL10",88,0)
 ;
"RTN","RORUTL10",89,0)
 ;               If the "*" is passed via this parameter then all
"RTN","RORUTL10",90,0)
 ;               lab tests are considered.
"RTN","RORUTL10",91,0)
 ;
"RTN","RORUTL10",92,0)
 ;               If this parameter has a pure numeric value then
"RTN","RORUTL10",93,0)
 ;               it is considered as registry IEN and the default
"RTN","RORUTL10",94,0)
 ;               list of registry specific tests is automatically
"RTN","RORUTL10",95,0)
 ;               compiled by the $$LOADTSTS^RORUTL10 function.
"RTN","RORUTL10",96,0)
 ;
"RTN","RORUTL10",97,0)
 ; [[.]ROR8DST]  Closed root of an array where the results will be
"RTN","RORUTL10",98,0)
 ;               returned (the ^TMP("RORUTL10",$J), by default).
"RTN","RORUTL10",99,0)
 ;               The results will be stored into the destination
"RTN","RORUTL10",100,0)
 ;               array in following format:
"RTN","RORUTL10",101,0)
 ;
"RTN","RORUTL10",102,0)
 ;                 @ROR8DST@(i,
"RTN","RORUTL10",103,0)
 ;                   1)  Result Descriptor
"RTN","RORUTL10",104,0)
 ;                         ^01: IEN in the file #63 (inverted date)
"RTN","RORUTL10",105,0)
 ;                         ^02: Date of the test (FileMan)
"RTN","RORUTL10",106,0)
 ;                         ^03: Result
"RTN","RORUTL10",107,0)
 ;                   2)  Test Descriptor
"RTN","RORUTL10",108,0)
 ;                         ^01: Test IEN (in the file #60)
"RTN","RORUTL10",109,0)
 ;                         ^02: Test name
"RTN","RORUTL10",110,0)
 ;                         ^03: Code of the group
"RTN","RORUTL10",111,0)
 ;                         ^04: Group name
"RTN","RORUTL10",112,0)
 ;                         ^05: Location subscript
"RTN","RORUTL10",113,0)
 ;                         ^06: Result node
"RTN","RORUTL10",114,0)
 ;
"RTN","RORUTL10",115,0)
 ;               Example:
"RTN","RORUTL10",116,0)
 ;                 S RC=$$LTSEARCH^RORUTL10(DFN,REGIEN,"RORBUF")
"RTN","RORUTL10",117,0)
 ;
"RTN","RORUTL10",118,0)
 ;               If this parameter is passed by reference, you can
"RTN","RORUTL10",119,0)
 ;               provide a full name ($$TAG^ROUTINE) of the callback
"RTN","RORUTL10",120,0)
 ;               function, which will process and store the results,
"RTN","RORUTL10",121,0)
 ;               as the value of the "RORCB" node.
"RTN","RORUTL10",122,0)
 ;
"RTN","RORUTL10",123,0)
 ;               Any additional nodes created in this variable will
"RTN","RORUTL10",124,0)
 ;               be accessible in the callback function. Several
"RTN","RORUTL10",125,0)
 ;               nodes are created automatically:
"RTN","RORUTL10",126,0)
 ;
"RTN","RORUTL10",127,0)
 ;                 "RORDFN"      IEN of the registry patient (DFN)
"RTN","RORUTL10",128,0)
 ;
"RTN","RORUTL10",129,0)
 ;                 "ROREDT"      End date
"RTN","RORUTL10",130,0)
 ;
"RTN","RORUTL10",131,0)
 ;                 "RORFLAGS"    Value of parameter of the same name
"RTN","RORUTL10",132,0)
 ;
"RTN","RORUTL10",133,0)
 ;                 "RORSDT"      Start date
"RTN","RORUTL10",134,0)
 ;
"RTN","RORUTL10",135,0)
 ;               The callback function must accept 3 parameters:
"RTN","RORUTL10",136,0)
 ;
"RTN","RORUTL10",137,0)
 ;                 .ROR8DST      Reference to the ROR8DST parameter.
"RTN","RORUTL10",138,0)
 ;
"RTN","RORUTL10",139,0)
 ;                 INVDT         IEN of the Lab test (inverted date)
"RTN","RORUTL10",140,0)
 ;
"RTN","RORUTL10",141,0)
 ;                 .RESULT       Reference to a local variable,
"RTN","RORUTL10",142,0)
 ;                               which contains the result in the
"RTN","RORUTL10",143,0)
 ;                               same format as it is stored into
"RTN","RORUTL10",144,0)
 ;                               the destination array by default.
"RTN","RORUTL10",145,0)
 ;
"RTN","RORUTL10",146,0)
 ;               The function should return the following values:
"RTN","RORUTL10",147,0)
 ;
"RTN","RORUTL10",148,0)
 ;                 <0  Error code (the search will be aborted)
"RTN","RORUTL10",149,0)
 ;                  0  Ok
"RTN","RORUTL10",150,0)
 ;                  1  Skip this result
"RTN","RORUTL10",151,0)
 ;                  2  Skip this and all remaining results
"RTN","RORUTL10",152,0)
 ;
"RTN","RORUTL10",153,0)
 ;               Example:
"RTN","RORUTL10",154,0)
 ;                 S RORDST=$NA(^TMP("RORBUF",$J))
"RTN","RORUTL10",155,0)
 ;                 S RORDST("RORPTR")=+$O(@RORDST@(""),-1)
"RTN","RORUTL10",156,0)
 ;                 S RORDST("RORCB")="$$LTCB^RORUT999"
"RTN","RORUTL10",157,0)
 ;                 S RC=$$LTSEARCH^RORUTL10(DFN,REGIEN,.RORDST)
"RTN","RORUTL10",158,0)
 ;
"RTN","RORUTL10",159,0)
 ; [RORFLAGS]    Flags to control processing (reserved)
"RTN","RORUTL10",160,0)
 ;
"RTN","RORUTL10",161,0)
 ; [STDT]        Start date (FileMan)
"RTN","RORUTL10",162,0)
 ; [ENDT]        End date   (FileMan)
"RTN","RORUTL10",163,0)
 ;
"RTN","RORUTL10",164,0)
 ;               The search is performed exactly between provided
"RTN","RORUTL10",165,0)
 ;               boundaries (the time parts are considered).
"RTN","RORUTL10",166,0)
 ;
"RTN","RORUTL10",167,0)
 ; The ^TMP("RORUTL10",$J) global node is used by this function.
"RTN","RORUTL10",168,0)
 ;
"RTN","RORUTL10",169,0)
 ; Return Values:
"RTN","RORUTL10",170,0)
 ;       <0  Error code
"RTN","RORUTL10",171,0)
 ;        0  No results have been found
"RTN","RORUTL10",172,0)
 ;       >0  Number of results
"RTN","RORUTL10",173,0)
 ;
"RTN","RORUTL10",174,0)
LTSEARCH(PATIEN,ROR8LT,ROR8DST,RORFLAGS,STDT,ENDT) ;
"RTN","RORUTL10",175,0)
 N BUF,CNT,EXIT,GRC,ILDT,LTDT,LTFREE,LTIEN,LTLOC,LTNODE,LTRES,RC,ROR8SET,RORLR,RORMSG,TMP
"RTN","RORUTL10",176,0)
 S:$G(ROR8DST)="" ROR8DST=$NA(^TMP("RORUTL10",$J))
"RTN","RORUTL10",177,0)
 Q:$G(ROR8LT)="" 0  ; No Lab tests to search for
"RTN","RORUTL10",178,0)
 S RORFLAGS=$G(RORFLAGS),(LTFREE,RC)=0
"RTN","RORUTL10",179,0)
 ;
"RTN","RORUTL10",180,0)
 ;--- Determine the storage method (default or callback)
"RTN","RORUTL10",181,0)
 I $G(ROR8DST("RORCB"))?2"$"1.8UN1"^"1.8UN  D  Q:RC<0 RC
"RTN","RORUTL10",182,0)
 . S ROR8SET="S RC="_ROR8DST("RORCB")_"(.ROR8DST,ILDT,.BUF)"
"RTN","RORUTL10",183,0)
 . S ROR8DST("RORDFN")=PATIEN
"RTN","RORUTL10",184,0)
 . S ROR8DST("ROREDT")=$G(ENDT)
"RTN","RORUTL10",185,0)
 . S ROR8DST("RORFLAGS")=RORFLAGS
"RTN","RORUTL10",186,0)
 . S ROR8DST("RORSDT")=$G(STDT)
"RTN","RORUTL10",187,0)
 E  S ROR8SET=""  K @ROR8DST
"RTN","RORUTL10",188,0)
 ;
"RTN","RORUTL10",189,0)
 ;--- Get the Lab reference
"RTN","RORUTL10",190,0)
 S RORLR=$P($G(^DPT(PATIEN,"LR")),U)  Q:RORLR'>0 0
"RTN","RORUTL10",191,0)
 ;
"RTN","RORUTL10",192,0)
 ;--- Prepare the list of tests of interest
"RTN","RORUTL10",193,0)
 I (+ROR8LT)=ROR8LT  D  Q:RC'>0 RC
"RTN","RORUTL10",194,0)
 . S TMP=+ROR8LT,ROR8LT=$$ALLOC^RORTMP(),LTFREE=1
"RTN","RORUTL10",195,0)
 . S RC=$$LOADTSTS(ROR8LT,TMP)
"RTN","RORUTL10",196,0)
 I ROR8LT'="*",$D(@ROR8LT)<10  Q 0
"RTN","RORUTL10",197,0)
 ;
"RTN","RORUTL10",198,0)
 ;--- Search the Lab data
"RTN","RORUTL10",199,0)
 S STDT=$$INVDATE^RORUTL01($S($G(STDT)>0:STDT,1:0))
"RTN","RORUTL10",200,0)
 S ILDT=$S($G(ENDT)>0:$$INVDATE^RORUTL01(ENDT),1:0)
"RTN","RORUTL10",201,0)
 S (CNT,RC)=0
"RTN","RORUTL10",202,0)
 F  S ILDT=$O(^LR(RORLR,"CH",ILDT))  Q:(ILDT'>0)!(ILDT>STDT)  D  Q:RC
"RTN","RORUTL10",203,0)
 . S LTNODE=1
"RTN","RORUTL10",204,0)
 . F  S LTNODE=$O(^LR(RORLR,"CH",ILDT,LTNODE))  Q:LTNODE=""  D  Q:RC
"RTN","RORUTL10",205,0)
 . . S LTRES=$P($G(^LR(RORLR,"CH",ILDT,LTNODE)),U)
"RTN","RORUTL10",206,0)
 . . Q:LTRES=""    ; Skip empty results
"RTN","RORUTL10",207,0)
 . . S TMP=$$UP^XLFSTR(LTRES)
"RTN","RORUTL10",208,0)
 . . Q:TMP["CANC"  ; Skip cancelled tests
"RTN","RORUTL10",209,0)
 . . S LTDT=$P($G(^LR(RORLR,"CH",ILDT,0)),U)
"RTN","RORUTL10",210,0)
 . . ;--- Only selected tests
"RTN","RORUTL10",211,0)
 . . I ROR8LT'="*"  D  Q
"RTN","RORUTL10",212,0)
 . . . S LTIEN=""
"RTN","RORUTL10",213,0)
 . . . F  S LTIEN=$O(@ROR8LT@(LTNODE,LTIEN))  Q:LTIEN=""  D  Q:RC
"RTN","RORUTL10",214,0)
 . . . . S GRC=$P(@ROR8LT@(LTNODE,LTIEN),U,3)  Q:GRC'>0
"RTN","RORUTL10",215,0)
 . . . . K BUF
"RTN","RORUTL10",216,0)
 . . . . S BUF(1)=ILDT_U_LTDT_U_LTRES
"RTN","RORUTL10",217,0)
 . . . . S BUF(2)=@ROR8LT@(LTNODE,LTIEN)
"RTN","RORUTL10",218,0)
 . . . . ;--- Default output
"RTN","RORUTL10",219,0)
 . . . . I ROR8SET=""  S CNT=CNT+1  M @ROR8DST@(CNT)=BUF  Q
"RTN","RORUTL10",220,0)
 . . . . ;--- Callback function
"RTN","RORUTL10",221,0)
 . . . . X ROR8SET
"RTN","RORUTL10",222,0)
 . . . . I RC  S:RC=1 RC=0  Q
"RTN","RORUTL10",223,0)
 . . . . S CNT=CNT+1
"RTN","RORUTL10",224,0)
 . . ;--- Consider all tests
"RTN","RORUTL10",225,0)
 . . S LTLOC="CH;"_LTNODE_";1",LTIEN=""
"RTN","RORUTL10",226,0)
 . . F  S LTIEN=$O(^LAB(60,"C",LTLOC,LTIEN))  Q:LTIEN=""  D  Q:RC
"RTN","RORUTL10",227,0)
 . . . K BUF
"RTN","RORUTL10",228,0)
 . . . S BUF(1)=ILDT_U_LTDT_U_LTRES
"RTN","RORUTL10",229,0)
 . . . S TMP=$$GET1^DIQ(60,LTIEN,.01,,,"RORMSG")
"RTN","RORUTL10",230,0)
 . . . S BUF(2)=LTIEN_U_$S(TMP'="":TMP,1:"Unknown ("_LTIEN_")")
"RTN","RORUTL10",231,0)
 . . . S $P(BUF(2),U,5,6)="CH"_U_LTNODE
"RTN","RORUTL10",232,0)
 . . . ;--- Default output
"RTN","RORUTL10",233,0)
 . . . I ROR8SET=""  S CNT=CNT+1  M @ROR8DST@(CNT)=BUF  Q
"RTN","RORUTL10",234,0)
 . . . ;--- Callback function
"RTN","RORUTL10",235,0)
 . . . X ROR8SET
"RTN","RORUTL10",236,0)
 . . . I RC  S:RC=1 RC=0  Q
"RTN","RORUTL10",237,0)
 . . . S CNT=CNT+1
"RTN","RORUTL10",238,0)
 ;
"RTN","RORUTL10",239,0)
 ;--- Cleanup
"RTN","RORUTL10",240,0)
 D:LTFREE FREE^RORTMP(ROR8LT)
"RTN","RORUTL10",241,0)
 Q $S(RC<0:RC,1:CNT)
"RTN","RORUTL11")
0^156^B2472015
"RTN","RORUTL11",1,0)
RORUTL11 ;HCIOFO/SG - ACCESS AND SECURITY UTILITIES ; 7/21/03 10:28am
"RTN","RORUTL11",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL11",3,0)
 ;
"RTN","RORUTL11",4,0)
 Q
"RTN","RORUTL11",5,0)
 ;
"RTN","RORUTL11",6,0)
 ;***** REBUILDS THE "ACL" CROSS-REFERENCE (USER ACCESS)
"RTN","RORUTL11",7,0)
 ;
"RTN","RORUTL11",8,0)
 ; Return Values:
"RTN","RORUTL11",9,0)
 ;       <0  Error code
"RTN","RORUTL11",10,0)
 ;        0  Ok
"RTN","RORUTL11",11,0)
 ;
"RTN","RORUTL11",12,0)
RNDXACL() ;
"RTN","RORUTL11",13,0)
 N DA,DIK,REGIEN,ROOT
"RTN","RORUTL11",14,0)
 S ROOT=$$ROOT^DILFD(798.1,,1)  K @ROOT@("ACL")
"RTN","RORUTL11",15,0)
 S REGIEN=0
"RTN","RORUTL11",16,0)
 F  S REGIEN=$O(@ROOT@(REGIEN))  Q:'REGIEN  D
"RTN","RORUTL11",17,0)
 . S DIK=$$ROOT^DILFD(798.118,","_REGIEN_","),DIK(1)=".01^ACL"
"RTN","RORUTL11",18,0)
 . S DA(1)=REGIEN  D ENALL^DIK
"RTN","RORUTL11",19,0)
 Q 0
"RTN","RORUTL11",20,0)
 ;
"RTN","RORUTL11",21,0)
 ;***** CHECKS IF THE RPC CAN BE CALLED BY THE CURRENT USER
"RTN","RORUTL11",22,0)
 ;
"RTN","RORUTL11",23,0)
 ; RPCNAME       Name of the RPC
"RTN","RORUTL11",24,0)
 ;
"RTN","RORUTL11",25,0)
 ; [REGIEN]      Registry IEN
"RTN","RORUTL11",26,0)
 ;
"RTN","RORUTL11",27,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORUTL11",28,0)
 ;                 A  Administrator Only
"RTN","RORUTL11",29,0)
 ;                 I  IRM Only
"RTN","RORUTL11",30,0)
 ;
"RTN","RORUTL11",31,0)
 ; Return Values:
"RTN","RORUTL11",32,0)
 ;       <0  Error code
"RTN","RORUTL11",33,0)
 ;        0  Ok
"RTN","RORUTL11",34,0)
 ;       >0  Access denied
"RTN","RORUTL11",35,0)
 ;
"RTN","RORUTL11",36,0)
RPCHECK(RPCNAME,REGIEN,FLAGS) ;
"RTN","RORUTL11",37,0)
 N ACCESS,KEY,RC
"RTN","RORUTL11",38,0)
 Q:$G(DUZ)'>0 $$ERROR^RORERR(-40,,,,"DUZ")
"RTN","RORUTL11",39,0)
 S FLAGS=$G(FLAGS),REGIEN=+$G(REGIEN)
"RTN","RORUTL11",40,0)
 ;---
"RTN","RORUTL11",41,0)
 S (ACCESS,RC)=0
"RTN","RORUTL11",42,0)
 D  Q:ACCESS 0
"RTN","RORUTL11",43,0)
 . I REGIEN  Q:$D(^ROR(798.1,"ACL",DUZ,REGIEN))<10
"RTN","RORUTL11",44,0)
 . E  Q:$D(^ROR(798.1,"ACL",DUZ))<10
"RTN","RORUTL11",45,0)
 . I FLAGS["I"  Q:'$D(^XUSEC("ROR VA IRM",DUZ))
"RTN","RORUTL11",46,0)
 . I FLAGS["A"  S RC=1,KEY=""  D  Q:RC
"RTN","RORUTL11",47,0)
 . . F  S KEY=$O(^ROR(798.1,"ACL",DUZ,REGIEN,KEY))  Q:KEY=""  D  Q:'RC
"RTN","RORUTL11",48,0)
 . . . I KEY?1"ROR"1.E  S:KEY["ADMIN" RC=0
"RTN","RORUTL11",49,0)
 . S ACCESS=1
"RTN","RORUTL11",50,0)
 ;---
"RTN","RORUTL11",51,0)
 D ACVIOLTN^RORLOG(X,$G(REGIEN),RPCNAME)
"RTN","RORUTL11",52,0)
 Q 1
"RTN","RORUTL14")
0^157^B10147900
"RTN","RORUTL14",1,0)
RORUTL14 ;HCIOFO/BH,SG - PHARMACY DATA SEARCH ; 12/13/05 2:16pm
"RTN","RORUTL14",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL14",3,0)
 ;
"RTN","RORUTL14",4,0)
 Q
"RTN","RORUTL14",5,0)
 ;
"RTN","RORUTL14",6,0)
 ;***** SEARCHES THE PHARMACY DATA
"RTN","RORUTL14",7,0)
 ;
"RTN","RORUTL14",8,0)
 ; PATIEN        IEN of the patient (DFN)
"RTN","RORUTL14",9,0)
 ;
"RTN","RORUTL14",10,0)
 ; ROR8RXS       Closed root of a variable, which contains a list
"RTN","RORUTL14",11,0)
 ;               of drugs of interest (in the same format as
"RTN","RORUTL14",12,0)
 ;               the list returned by the $$DRUGLIST^RORUTL16).
"RTN","RORUTL14",13,0)
 ;
"RTN","RORUTL14",14,0)
 ;               If the "*" is passed via this parameter then all
"RTN","RORUTL14",15,0)
 ;               pharmacy orders tests are considered.
"RTN","RORUTL14",16,0)
 ;
"RTN","RORUTL14",17,0)
 ;               If this parameter has a pure numeric value then
"RTN","RORUTL14",18,0)
 ;               it is considered as registry IEN and the default
"RTN","RORUTL14",19,0)
 ;               list of registry specific drugs is automatically
"RTN","RORUTL14",20,0)
 ;               compiled by the $$DRUGLIST^RORUTL16 function.
"RTN","RORUTL14",21,0)
 ;
"RTN","RORUTL14",22,0)
 ; [[.]ROR8DST]  Closed root of an array where the data will be
"RTN","RORUTL14",23,0)
 ;               returned (the ^TMP("RORUTL14",$J), by default).
"RTN","RORUTL14",24,0)
 ;               The data will be stored into the destination
"RTN","RORUTL14",25,0)
 ;               array in following format:
"RTN","RORUTL14",26,0)
 ;
"RTN","RORUTL14",27,0)
 ;                 @ROR8DST@(i,  Additional drug information
"RTN","RORUTL14",28,0)
 ;                                 ^01: Order number
"RTN","RORUTL14",29,0)
 ;                                 ^02: Flags describing the order:
"RTN","RORUTL14",30,0)
 ;                                        I  Inpatient dose
"RTN","RORUTL14",31,0)
 ;                                        O  Outpatient fill
"RTN","RORUTL14",32,0)
 ;                                        P  Pending
"RTN","RORUTL14",33,0)
 ;                                        V  IV
"RTN","RORUTL14",34,0)
 ;                                 ^03: Generic drug IEN (file #50.6)
"RTN","RORUTL14",35,0)
 ;                                 ^04: Generic drug name
"RTN","RORUTL14",36,0)
 ;                                 ^05: Drug class IEN (file #50.605)
"RTN","RORUTL14",37,0)
 ;                                 ^06: Drug class code
"RTN","RORUTL14",38,0)
 ;                   0)          Detailed information on pharmacy
"RTN","RORUTL14",39,0)
 ;                   "RXN",0)    order loaded by the OEL^PSOORRL
"RTN","RORUTL14",40,0)
 ;                   ...
"RTN","RORUTL14",41,0)
 ;
"RTN","RORUTL14",42,0)
 ;               Example:
"RTN","RORUTL14",43,0)
 ;                 S RORDST=$NA(^TMP("RORTMP",$J))
"RTN","RORUTL14",44,0)
 ;                 S RC=$$RXSEARCH^RORUTL14(DFN,REGIEN,RORDST)
"RTN","RORUTL14",45,0)
 ;
"RTN","RORUTL14",46,0)
 ;               If this parameter is passed by reference, you can
"RTN","RORUTL14",47,0)
 ;               provide a full name ($$TAG^ROUTINE) of the callback
"RTN","RORUTL14",48,0)
 ;               function, which will process and store the results,
"RTN","RORUTL14",49,0)
 ;               as the value of the "RORCB" node.
"RTN","RORUTL14",50,0)
 ;
"RTN","RORUTL14",51,0)
 ;               Any additional nodes created in this variable will
"RTN","RORUTL14",52,0)
 ;               be accessible in the callback function. The following
"RTN","RORUTL14",53,0)
 ;               nodes are created automatically:
"RTN","RORUTL14",54,0)
 ;
"RTN","RORUTL14",55,0)
 ;                 "RORDFN"      IEN of the registry patient (DFN)
"RTN","RORUTL14",56,0)
 ;
"RTN","RORUTL14",57,0)
 ;                 "ROREDT"      End date
"RTN","RORUTL14",58,0)
 ;
"RTN","RORUTL14",59,0)
 ;                 "RORFLAGS"    Value of parameter of the same name
"RTN","RORUTL14",60,0)
 ;
"RTN","RORUTL14",61,0)
 ;                 "RORSDT"      Start date
"RTN","RORUTL14",62,0)
 ;                              
"RTN","RORUTL14",63,0)
 ;                 "RORXGEN"     Generic drug
"RTN","RORUTL14",64,0)
 ;                                 ^01: Drug IEN in file #50.6
"RTN","RORUTL14",65,0)
 ;                                 ^02: Generic drug name
"RTN","RORUTL14",66,0)
 ;
"RTN","RORUTL14",67,0)
 ;                 "RORXVCL"     VA Drug class
"RTN","RORUTL14",68,0)
 ;                                 ^01: Class IEN in file #50.605
"RTN","RORUTL14",69,0)
 ;                                 ^02: Class code
"RTN","RORUTL14",70,0)
 ;
"RTN","RORUTL14",71,0)
 ;               The callback function must accept 5 parameters:
"RTN","RORUTL14",72,0)
 ;
"RTN","RORUTL14",73,0)
 ;                 .ROR8DST      Reference to the ROR8DST parameter
"RTN","RORUTL14",74,0)
 ;                               passed into the $$RXSEARCH function.
"RTN","RORUTL14",75,0)
 ;
"RTN","RORUTL14",76,0)
 ;                 ORDER         Order number (from condensed list)
"RTN","RORUTL14",77,0)
 ;
"RTN","RORUTL14",78,0)
 ;                 FLAGS         Flags describing the order to be
"RTN","RORUTL14",79,0)
 ;                               processed.
"RTN","RORUTL14",80,0)
 ;
"RTN","RORUTL14",81,0)
 ;                 DRUG          Dispensed drug
"RTN","RORUTL14",82,0)
 ;                                 ^01: Drug IEN in file #50
"RTN","RORUTL14",83,0)
 ;                                 ^02: Drug name
"RTN","RORUTL14",84,0)
 ;
"RTN","RORUTL14",85,0)
 ;                 DATE          Order date (issue date for outpatient
"RTN","RORUTL14",86,0)
 ;                               drugs or start date for inpatient)
"RTN","RORUTL14",87,0)
 ;
"RTN","RORUTL14",88,0)
 ;               The ^TMP("PS",$J) global node contains the data
"RTN","RORUTL14",89,0)
 ;               returned by the OEL^PSOORRL procedure (see the
"RTN","RORUTL14",90,0)
 ;               DBIA #2400 for details).
"RTN","RORUTL14",91,0)
 ;
"RTN","RORUTL14",92,0)
 ;               The callback function is called for each additive
"RTN","RORUTL14",93,0)
 ;               included in the IV order; the ^TMP("PS",$J) is
"RTN","RORUTL14",94,0)
 ;               loaded once and stays the same for all of them.
"RTN","RORUTL14",95,0)
 ;
"RTN","RORUTL14",96,0)
 ;               The function should return the following values:
"RTN","RORUTL14",97,0)
 ;
"RTN","RORUTL14",98,0)
 ;                 <0  Error code (the search will be aborted)
"RTN","RORUTL14",99,0)
 ;                  0  Ok
"RTN","RORUTL14",100,0)
 ;                  1  Skip this pharmacy order
"RTN","RORUTL14",101,0)
 ;                  2  Skip this and all remaining orders
"RTN","RORUTL14",102,0)
 ;
"RTN","RORUTL14",103,0)
 ;               Example:
"RTN","RORUTL14",104,0)
 ;                 S RORDST=$NA(^TMP("RORBUF",$J))
"RTN","RORUTL14",105,0)
 ;                 S RORDST("RORPTR")=+$O(@RORDST@(""),-1)
"RTN","RORUTL14",106,0)
 ;                 S RORDST("RORCB")="$$RXCB^RORUT999"
"RTN","RORUTL14",107,0)
 ;                 S RC=$$RXSEARCH^RORUTL14(DFN,REGIEN,.RORDST)
"RTN","RORUTL14",108,0)
 ;
"RTN","RORUTL14",109,0)
 ; [RORFLAGS]    Flags to control processing:
"RTN","RORUTL14",110,0)
 ;                 E  Load external values for additional fields
"RTN","RORUTL14",111,0)
 ;                    stored into the output array or passed to
"RTN","RORUTL14",112,0)
 ;                    the callback function. Affected fields
"RTN","RORUTL14",113,0)
 ;                    have the (E) marker.
"RTN","RORUTL14",114,0)
 ;                 I  Include inpatient doses
"RTN","RORUTL14",115,0)
 ;                 O  Include outpatient fills
"RTN","RORUTL14",116,0)
 ;                 P  Include pending orders
"RTN","RORUTL14",117,0)
 ;                 V  Include IV
"RTN","RORUTL14",118,0)
 ;
"RTN","RORUTL14",119,0)
 ;               If this parameter has no value ($G(RORFLAGS)="")
"RTN","RORUTL14",120,0)
 ;               then the default set of flags is used: "IO".
"RTN","RORUTL14",121,0)
 ;
"RTN","RORUTL14",122,0)
 ; RORSDT        Start date (FileMan)
"RTN","RORUTL14",123,0)
 ; [ROREDT]      End date   (FileMan)
"RTN","RORUTL14",124,0)
 ;
"RTN","RORUTL14",125,0)
 ;               The search is performed exactly between provided
"RTN","RORUTL14",126,0)
 ;               boundaries (the time parts are considered).
"RTN","RORUTL14",127,0)
 ;
"RTN","RORUTL14",128,0)
 ; The following global nodes are used by the function:
"RTN","RORUTL14",129,0)
 ;
"RTN","RORUTL14",130,0)
 ; ^TMP("PS",$J)         The OCL^PSOORRL and OEL^PSOORRL procedures
"RTN","RORUTL14",131,0)
 ;                       return the results into this node.
"RTN","RORUTL14",132,0)
 ;
"RTN","RORUTL14",133,0)
 ; ^TMP("RORUTL14",$J)   If the name of the destination array is
"RTN","RORUTL14",134,0)
 ;                       not provided via the ROR8DST parameter
"RTN","RORUTL14",135,0)
 ;                       then the $$RXSEARCH returns the results
"RTN","RORUTL14",136,0)
 ;                       under this node.
"RTN","RORUTL14",137,0)
 ;
"RTN","RORUTL14",138,0)
 ; ^TMP("RORUTL14L",$J)  If the ROR8RXS parameter is undefined
"RTN","RORUTL14",139,0)
 ;                       then a temporary list of registry specific
"RTN","RORUTL14",140,0)
 ;                       drugs is compiled under this node.
"RTN","RORUTL14",141,0)
 ;
"RTN","RORUTL14",142,0)
 ; Return Values:
"RTN","RORUTL14",143,0)
 ;       <0  Error code
"RTN","RORUTL14",144,0)
 ;        0  No ordes have been found
"RTN","RORUTL14",145,0)
 ;       >0  Number of pharmacy orders
"RTN","RORUTL14",146,0)
 ;
"RTN","RORUTL14",147,0)
RXSEARCH(PATIEN,ROR8RXS,ROR8DST,RORFLAGS,RORSDT,ROREDT) ;
"RTN","RORUTL14",148,0)
 N RC,ROR8SET,RORXLST,TMP
"RTN","RORUTL14",149,0)
 S:$G(ROR8DST)="" ROR8DST=$NA(^TMP("RORUTL14",$J))
"RTN","RORUTL14",150,0)
 S RORFLAGS=$S($G(RORFLAGS)'="":RORFLAGS,1:"IO")
"RTN","RORUTL14",151,0)
 Q:$TR(RORFLAGS,"IO")=RORFLAGS 0  ; Neither Inpatient nor Outpatient
"RTN","RORUTL14",152,0)
 Q:$G(ROR8RXS)="" 0               ; No drugs to search for
"RTN","RORUTL14",153,0)
 ;---
"RTN","RORUTL14",154,0)
 S:$G(ROREDT)'>0 ROREDT=DT
"RTN","RORUTL14",155,0)
 S RORXLST=$$ALLOC^RORTMP(),RC=0
"RTN","RORUTL14",156,0)
 ;
"RTN","RORUTL14",157,0)
 D
"RTN","RORUTL14",158,0)
 . ;--- Prepare the list of drugs of interest
"RTN","RORUTL14",159,0)
 . I (+ROR8RXS)=ROR8RXS  D  Q:RC'>0
"RTN","RORUTL14",160,0)
 . . S TMP=ROR8RXS,ROR8RXS=$$ALLOC^RORTMP()
"RTN","RORUTL14",161,0)
 . . S RC=$$DRUGLIST^RORUTL16(ROR8RXS,TMP)
"RTN","RORUTL14",162,0)
 . I ROR8RXS'="*",$D(@ROR8RXS)<10  S RC=0  Q
"RTN","RORUTL14",163,0)
 . ;--- Preselect pharmacy orders
"RTN","RORUTL14",164,0)
 . S RC=$$QUERY^RORUTL15(PATIEN,RORFLAGS,RORSDT,ROREDT,RORXLST)
"RTN","RORUTL14",165,0)
 . Q:RC'>0
"RTN","RORUTL14",166,0)
 . ;--- Process selected orders
"RTN","RORUTL14",167,0)
 . S RC=$$PROCESS^RORUTL15(PATIEN,RORFLAGS,RORXLST)
"RTN","RORUTL14",168,0)
 . Q:RC'>0
"RTN","RORUTL14",169,0)
 ;
"RTN","RORUTL14",170,0)
 ;--- Cleanup
"RTN","RORUTL14",171,0)
 D POP^RORTMP(RORXLST)
"RTN","RORUTL14",172,0)
 Q RC
"RTN","RORUTL15")
0^158^B44452643
"RTN","RORUTL15",1,0)
RORUTL15 ;HCIOFO/BH,SG - PHARMACY DATA SEARCH (TOOLS) ; 12/21/05 11:11am
"RTN","RORUTL15",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL15",3,0)
 ;
"RTN","RORUTL15",4,0)
 ; This routine uses the following IAs:
"RTN","RORUTL15",5,0)
 ;
"RTN","RORUTL15",6,0)
 ; #2400         OCL^PSOORRL and OEL^PSOORRL (controlled)
"RTN","RORUTL15",7,0)
 ; #4533         ARWS^PSS50 (supported)
"RTN","RORUTL15",8,0)
 ; #4543         IEN^PSN50P65 (supported)
"RTN","RORUTL15",9,0)
 ;
"RTN","RORUTL15",10,0)
 Q
"RTN","RORUTL15",11,0)
 ;
"RTN","RORUTL15",12,0)
 ;***** DOUBLE-CHECKS THE OUTPATIENT RX (ORDER, REFILLS AND PARTIALS)
"RTN","RORUTL15",13,0)
 ;
"RTN","RORUTL15",14,0)
 ; STDT          Start Date (FileMan)
"RTN","RORUTL15",15,0)
 ; ENDT          End Date   (FileMan)
"RTN","RORUTL15",16,0)
 ;
"RTN","RORUTL15",17,0)
 ; [.NREF]       Number of refills is returned via this parameter
"RTN","RORUTL15",18,0)
 ;
"RTN","RORUTL15",19,0)
 ; [.NPAR]       Nubmer of partials is returned via this parameter
"RTN","RORUTL15",20,0)
 ;
"RTN","RORUTL15",21,0)
 ; The ^TMP("PS",$J) node must be populated by the OEL^PSOORRL
"RTN","RORUTL15",22,0)
 ; before calling this function.
"RTN","RORUTL15",23,0)
 ;
"RTN","RORUTL15",24,0)
 ; Return Values:
"RTN","RORUTL15",25,0)
 ;        0  Ok
"RTN","RORUTL15",26,0)
 ;        1  Skip the order
"RTN","RORUTL15",27,0)
 ;
"RTN","RORUTL15",28,0)
DTCHECK(STDT,ENDT,NREF,NPAR) ;
"RTN","RORUTL15",29,0)
 N IRP,RXDT,SKIP
"RTN","RORUTL15",30,0)
 S RXDT=+$P($G(^TMP("PS",$J,"RXN",0)),U,6),(NREF,NPAR)=0
"RTN","RORUTL15",31,0)
 S SKIP=(RXDT<STDT)!(RXDT'<ENDT)
"RTN","RORUTL15",32,0)
 ;--- Refills
"RTN","RORUTL15",33,0)
 S IRP=0
"RTN","RORUTL15",34,0)
 F  S IRP=$O(^TMP("PS",$J,"REF",IRP))  Q:IRP'>0  D
"RTN","RORUTL15",35,0)
 . S RXDT=+$P($G(^TMP("PS",$J,"REF",IRP,0)),U)
"RTN","RORUTL15",36,0)
 . I RXDT'<STDT,RXDT<ENDT  S SKIP=0,NREF=NREF+1  Q
"RTN","RORUTL15",37,0)
 . K ^TMP("PS",$J,"REF",IRP)
"RTN","RORUTL15",38,0)
 ;--- Partials
"RTN","RORUTL15",39,0)
 S IRP=0
"RTN","RORUTL15",40,0)
 F  S IRP=$O(^TMP("PS",$J,"PAR",IRP))  Q:IRP'>0  D
"RTN","RORUTL15",41,0)
 . S RXDT=+$P($G(^TMP("PS",$J,"PAR",IRP,0)),U)
"RTN","RORUTL15",42,0)
 . I RXDT'<STDT,RXDT<ENDT  S SKIP=0,NPAR=NPAR+1  Q
"RTN","RORUTL15",43,0)
 . K ^TMP("PS",$J,"PAR",IRP)
"RTN","RORUTL15",44,0)
 ;---
"RTN","RORUTL15",45,0)
 Q SKIP
"RTN","RORUTL15",46,0)
 ;
"RTN","RORUTL15",47,0)
 ;***** PROCESSES THE LIST OF PRESELECTED PHARMACY ORDERS
"RTN","RORUTL15",48,0)
 ;
"RTN","RORUTL15",49,0)
 ; PTIEN         IEN of the patient (DFN)
"RTN","RORUTL15",50,0)
 ;
"RTN","RORUTL15",51,0)
 ; RORFLAGS      Flags to control processing
"RTN","RORUTL15",52,0)
 ;
"RTN","RORUTL15",53,0)
 ; ROR8LST       Closed root of the list of preselected orders
"RTN","RORUTL15",54,0)
 ;
"RTN","RORUTL15",55,0)
 ; Return Values:
"RTN","RORUTL15",56,0)
 ;       <0  Error code
"RTN","RORUTL15",57,0)
 ;        0  No orders have been found
"RTN","RORUTL15",58,0)
 ;       >0  Number of orders
"RTN","RORUTL15",59,0)
 ;
"RTN","RORUTL15",60,0)
PROCESS(PTIEN,RORFLAGS,ROR8LST) ;
"RTN","RORUTL15",61,0)
 N DRUGIEN,IRX,IVM,LOADEXT,ORDDATE,ORDER,ORDIEN,ORDFLG,RC,ROR8SET,RORLST,RORTMP,RORTS,RORXCNT,TMP
"RTN","RORUTL15",62,0)
 S LOADEXT=(RORFLAGS["E")
"RTN","RORUTL15",63,0)
 S (RC,RORXCNT)=0
"RTN","RORUTL15",64,0)
 S RORTMP=$$ALLOC^RORTMP(.RORTS)
"RTN","RORUTL15",65,0)
 ;
"RTN","RORUTL15",66,0)
 ;=== Determine the storage method (default or callback)
"RTN","RORUTL15",67,0)
 I $G(ROR8DST("RORCB"))?2"$"1.8UN1"^"1.8UN  D
"RTN","RORUTL15",68,0)
 . S ROR8SET="S RC="_ROR8DST("RORCB")_"(.ROR8DST,ORDER"
"RTN","RORUTL15",69,0)
 . S ROR8SET=ROR8SET_",ORDFLG,DRUGIEN_U_DRUGNAME,ORDDATE)"
"RTN","RORUTL15",70,0)
 . ;---
"RTN","RORUTL15",71,0)
 . S ROR8DST("RORDFN")=PTIEN
"RTN","RORUTL15",72,0)
 . S ROR8DST("ROREDT")=ROREDT
"RTN","RORUTL15",73,0)
 . S ROR8DST("RORFLAGS")=RORFLAGS
"RTN","RORUTL15",74,0)
 . S ROR8DST("RORSDT")=RORSDT
"RTN","RORUTL15",75,0)
 E  S ROR8SET=""  K @ROR8DST
"RTN","RORUTL15",76,0)
 ;
"RTN","RORUTL15",77,0)
 ;=== Process the list of preselected orders
"RTN","RORUTL15",78,0)
 S (IRX,RC)=0
"RTN","RORUTL15",79,0)
 F  S IRX=$O(@ROR8LST@(IRX))  Q:'IRX  D  Q:RC
"RTN","RORUTL15",80,0)
 . S ORDFLG=$P(@ROR8LST@(IRX),U)
"RTN","RORUTL15",81,0)
 . S TMP=@ROR8LST@(IRX,0)
"RTN","RORUTL15",82,0)
 . S ORDER=$P(TMP,U),ORDDATE=$P(TMP,U,15)
"RTN","RORUTL15",83,0)
 . ;--- Get the order details
"RTN","RORUTL15",84,0)
 . K ^TMP("PS",$J)
"RTN","RORUTL15",85,0)
 . D OEL^PSOORRL(PTIEN,ORDER)
"RTN","RORUTL15",86,0)
 . Q:$D(^TMP("PS",$J))<10
"RTN","RORUTL15",87,0)
 . ;=== Inpatient and Outpatient Medications
"RTN","RORUTL15",88,0)
 . I ORDFLG'["V"  D  Q
"RTN","RORUTL15",89,0)
 . . ;--- Double-check the dates for outpatient orders
"RTN","RORUTL15",90,0)
 . . I ORDFLG["O"  Q:$$DTCHECK(RORSDT,ROREDT)
"RTN","RORUTL15",91,0)
 . . ;--- Get the drug IEN in the DRUG file (#50)
"RTN","RORUTL15",92,0)
 . . S TMP=$G(^TMP("PS",$J,"DD",1,0)),DRUGIEN=+$P(TMP,U,3)
"RTN","RORUTL15",93,0)
 . . I DRUGIEN'>0  S DRUGIEN=+$P(TMP,U)  Q:DRUGIEN'>0
"RTN","RORUTL15",94,0)
 . . ;--- Process the order
"RTN","RORUTL15",95,0)
 . . S RC=$$PROCMED(ORDER,ORDFLG,DRUGIEN,ORDDATE)
"RTN","RORUTL15",96,0)
 . . S:'RC RORXCNT=RORXCNT+1
"RTN","RORUTL15",97,0)
 . . S:RC=1 RC=0
"RTN","RORUTL15",98,0)
 . ;=== IV Medications
"RTN","RORUTL15",99,0)
 . S RORLST=$$ALLOC^RORTMP(.TMP),ORDIEN=+ORDER
"RTN","RORUTL15",100,0)
 . D
"RTN","RORUTL15",101,0)
 . . N IEN,ORDER  ; Workaround for the bug in the API
"RTN","RORUTL15",102,0)
 . . D PSS436^PSS55(PTIEN,ORDIEN,TMP)
"RTN","RORUTL15",103,0)
 . I $G(@RORLST@(0))'>0  D FREE^RORTMP(RORLST)  Q
"RTN","RORUTL15",104,0)
 . ;--- Process the additives
"RTN","RORUTL15",105,0)
 . S IVM=0
"RTN","RORUTL15",106,0)
 . F  S IVM=$O(@RORLST@(ORDIEN,"ADD",IVM))  Q:IVM'>0  D  Q:RC
"RTN","RORUTL15",107,0)
 . . ;--- IEN in the IV ADDITIVES file (#52.6)
"RTN","RORUTL15",108,0)
 . . S DRUGIEN=+$P($G(@RORLST@(ORDIEN,"ADD",IVM,.01)),U)
"RTN","RORUTL15",109,0)
 . . Q:DRUGIEN'>0
"RTN","RORUTL15",110,0)
 . . ;--- IEN in the DRUG file (#50)
"RTN","RORUTL15",111,0)
 . . D ZERO^PSS52P6(DRUGIEN,,,RORTS)
"RTN","RORUTL15",112,0)
 . . Q:$G(@RORTMP@(0))'>0
"RTN","RORUTL15",113,0)
 . . S DRUGIEN=+$P($G(@RORTMP@(DRUGIEN,1)),U)
"RTN","RORUTL15",114,0)
 . . Q:DRUGIEN'>0
"RTN","RORUTL15",115,0)
 . . ;--- Process the medication
"RTN","RORUTL15",116,0)
 . . S RC=$$PROCMED(ORDER,ORDFLG,DRUGIEN,ORDDATE)
"RTN","RORUTL15",117,0)
 . . S:'RC RORXCNT=RORXCNT+1
"RTN","RORUTL15",118,0)
 . . S:RC=1 RC=0
"RTN","RORUTL15",119,0)
 . ;---
"RTN","RORUTL15",120,0)
 . D FREE^RORTMP(RORLST)
"RTN","RORUTL15",121,0)
 ;
"RTN","RORUTL15",122,0)
 ;===
"RTN","RORUTL15",123,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORUTL15",124,0)
 Q $S(RC<0:RC,1:RORXCNT)
"RTN","RORUTL15",125,0)
 ;
"RTN","RORUTL15",126,0)
 ;***** PROCESS THE MEDICATION (internal)
"RTN","RORUTL15",127,0)
 ;
"RTN","RORUTL15",128,0)
 ; DRUGIEN       IEN of the medication in the DRUG file (#50)
"RTN","RORUTL15",129,0)
 ;
"RTN","RORUTL15",130,0)
 ; The ROR8DST, ROR8RXS, ROR8SET, RORTMP, and RORTS variables
"RTN","RORUTL15",131,0)
 ; must be defined before calling this function.
"RTN","RORUTL15",132,0)
 ;
"RTN","RORUTL15",133,0)
 ; Return Values:
"RTN","RORUTL15",134,0)
 ;       <0  Error code
"RTN","RORUTL15",135,0)
 ;        0  Ok
"RTN","RORUTL15",136,0)
 ;        1  Skip this medication
"RTN","RORUTL15",137,0)
 ;        2  Skip this and all remaining medications
"RTN","RORUTL15",138,0)
 ;
"RTN","RORUTL15",139,0)
PROCMED(ORDER,ORDFLG,DRUGIEN,ORDDATE) ;
"RTN","RORUTL15",140,0)
 N DRUGNAME,RC,ROR8BUF,SKIP,TMP
"RTN","RORUTL15",141,0)
 S RC=0
"RTN","RORUTL15",142,0)
 ;=== Load some drug data
"RTN","RORUTL15",143,0)
 D ARWS^PSS50(DRUGIEN,,RORTS)  K ROR8BUF
"RTN","RORUTL15",144,0)
 F TMP=2,20,25  S ROR8BUF(TMP)=$G(@RORTMP@(DRUGIEN,TMP))
"RTN","RORUTL15",145,0)
 S DRUGNAME=$G(@RORTMP@(DRUGIEN,.01))
"RTN","RORUTL15",146,0)
 S:DRUGNAME="" DRUGNAME="Unknown (IEN="_DRUGIEN_")"
"RTN","RORUTL15",147,0)
 K @RORTMP
"RTN","RORUTL15",148,0)
 ;--- Generic Drug
"RTN","RORUTL15",149,0)
 S ROR8DST("RORXGEN")=ROR8BUF(20)
"RTN","RORUTL15",150,0)
 I $P(ROR8BUF(20),U,2)=""  D  S $P(ROR8DST("RORXGEN"),U,2)=TMP
"RTN","RORUTL15",151,0)
 . S TMP="Unknown ("_(+ROR8BUF(20))_")"
"RTN","RORUTL15",152,0)
 ;--- VA Drug Class
"RTN","RORUTL15",153,0)
 S ROR8DST("RORXVCL")=""
"RTN","RORUTL15",154,0)
 D:ROR8BUF(2)'=""
"RTN","RORUTL15",155,0)
 . ;--- If the "national" drug class is the same, use its IEN
"RTN","RORUTL15",156,0)
 . I $P(ROR8BUF(25),U,2)=ROR8BUF(2)  D  Q
"RTN","RORUTL15",157,0)
 . . S ROR8DST("RORXVCL")=$P(ROR8BUF(25),U,1,2)
"RTN","RORUTL15",158,0)
 . ;--- Get the Drug Class IEN
"RTN","RORUTL15",159,0)
 . D IEN^PSN50P65(,ROR8BUF(2),RORTS)
"RTN","RORUTL15",160,0)
 . S TMP=+$G(@RORTMP@(0))
"RTN","RORUTL15",161,0)
 . S:TMP=1 ROR8DST("RORXVCL")=+$O(@RORTMP@(0))_U_ROR8BUF(2)
"RTN","RORUTL15",162,0)
 . K @RORTMP
"RTN","RORUTL15",163,0)
 ;
"RTN","RORUTL15",164,0)
 ;=== Check if the drug should be skipped
"RTN","RORUTL15",165,0)
 I ROR8RXS'="*"  S SKIP=0  D  Q:SKIP 1
"RTN","RORUTL15",166,0)
 . Q:$D(@ROR8RXS@(DRUGIEN))
"RTN","RORUTL15",167,0)
 . I $D(@ROR8RXS@("C"))>1  Q:$D(@ROR8RXS@("C",+ROR8DST("RORXVCL")))
"RTN","RORUTL15",168,0)
 . I $D(@ROR8RXS@("G"))>1  Q:$D(@ROR8RXS@("G",+ROR8DST("RORXGEN")))
"RTN","RORUTL15",169,0)
 . S SKIP=1
"RTN","RORUTL15",170,0)
 ;
"RTN","RORUTL15",171,0)
 ;--- Load additional drug data
"RTN","RORUTL15",172,0)
 ;D:LOADEXT
"RTN","RORUTL15",173,0)
 ;.
"RTN","RORUTL15",174,0)
 ;
"RTN","RORUTL15",175,0)
 ;=== Default output
"RTN","RORUTL15",176,0)
 I ROR8SET=""  D  Q 0
"RTN","RORUTL15",177,0)
 . S RORXCNT=RORXCNT+1
"RTN","RORUTL15",178,0)
 . M @ROR8DST@(RORXCNT)=^TMP("PS",$J)
"RTN","RORUTL15",179,0)
 . S TMP=ORDER_U_ORDFLG_U_ROR8DST("RORXGEN")
"RTN","RORUTL15",180,0)
 . S $P(TMP,U,5,6)=ROR8DST("RORXVCL")
"RTN","RORUTL15",181,0)
 . S @ROR8DST@(RORXCNT)=TMP
"RTN","RORUTL15",182,0)
 ;=== Callback function
"RTN","RORUTL15",183,0)
 X ROR8SET  ; (.ROR8DST,ORDER,ORDFLG,DRUGIEN_U_DRUGNAME,ORDDATE)
"RTN","RORUTL15",184,0)
 Q RC
"RTN","RORUTL15",185,0)
 ;
"RTN","RORUTL15",186,0)
 ;***** LOADS AND PRESELECTS PHARMACY ORDERS
"RTN","RORUTL15",187,0)
 ;
"RTN","RORUTL15",188,0)
 ; PTIEN         IEN of the patient (DFN)
"RTN","RORUTL15",189,0)
 ;
"RTN","RORUTL15",190,0)
 ; FLAGS         Flags to control processing
"RTN","RORUTL15",191,0)
 ;
"RTN","RORUTL15",192,0)
 ; STDT          Start date (FileMan)
"RTN","RORUTL15",193,0)
 ; ENDT          End date   (FileMan)
"RTN","RORUTL15",194,0)
 ;
"RTN","RORUTL15",195,0)
 ; ROR8LST       Closed root for the list of preselected orders
"RTN","RORUTL15",196,0)
 ;
"RTN","RORUTL15",197,0)
 ; @ROR8LST@(
"RTN","RORUTL15",198,0)
 ;   Seq#,               Flags that describe the order (I,O,P, etc.)
"RTN","RORUTL15",199,0)
 ;     0)                Content of the ^TMP("PS",$J,i,0) node
"RTN","RORUTL15",200,0)
 ;                       returned by the OCL^PSOORRL (see the DBIA
"RTN","RORUTL15",201,0)
 ;                       #2400 for details).
"RTN","RORUTL15",202,0)
 ;
"RTN","RORUTL15",203,0)
 ; Return Values:
"RTN","RORUTL15",204,0)
 ;       <0  Error code
"RTN","RORUTL15",205,0)
 ;        0  No orders have been found
"RTN","RORUTL15",206,0)
 ;       >0  Number of orders
"RTN","RORUTL15",207,0)
 ;
"RTN","RORUTL15",208,0)
QUERY(PTIEN,FLAGS,STDT,ENDT,ROR8LST) ;
"RTN","RORUTL15",209,0)
 N IEN,IRX,ORDER,RXCNT,TMP,TYPE
"RTN","RORUTL15",210,0)
 K ^TMP("PS",$J),@ROR8LST
"RTN","RORUTL15",211,0)
 ;
"RTN","RORUTL15",212,0)
 ;--- Prepare the flags
"RTN","RORUTL15",213,0)
 I FLAGS["I"  D  S TYPE("U;I")="I"
"RTN","RORUTL15",214,0)
 . S:FLAGS["P" TYPE("P;I")="IP"
"RTN","RORUTL15",215,0)
 . S:FLAGS["V" TYPE("V;I")="IV"
"RTN","RORUTL15",216,0)
 I FLAGS["O"  D  S TYPE("R;O")="O"
"RTN","RORUTL15",217,0)
 . S:FLAGS["P" TYPE("P;O")="OP"
"RTN","RORUTL15",218,0)
 ;
"RTN","RORUTL15",219,0)
 ;--- Load the list of pharmacy orders
"RTN","RORUTL15",220,0)
 D OCL^PSOORRL(PTIEN,STDT,ENDT)
"RTN","RORUTL15",221,0)
 Q:$D(^TMP("PS",$J))<10 0
"RTN","RORUTL15",222,0)
 ;
"RTN","RORUTL15",223,0)
 ;--- Preselect the orders
"RTN","RORUTL15",224,0)
 S (IRX,RXCNT)=0
"RTN","RORUTL15",225,0)
 F  S IRX=$O(^TMP("PS",$J,IRX))  Q:'IRX  D
"RTN","RORUTL15",226,0)
 . S ORDER=$P($G(^TMP("PS",$J,IRX,0)),U)  Q:ORDER'>0
"RTN","RORUTL15",227,0)
 . ;--- Check the type of order
"RTN","RORUTL15",228,0)
 . S TMP=$L(ORDER),TYPE=$E(ORDER,TMP-2,TMP)
"RTN","RORUTL15",229,0)
 . S TYPE=$G(TYPE(TYPE))  Q:TYPE=""
"RTN","RORUTL15",230,0)
 . ;--- Double-check the dates
"RTN","RORUTL15",231,0)
 . I TYPE["I"  D  Q:(TMP<STDT)!(TMP'<ENDT)
"RTN","RORUTL15",232,0)
 . . S TMP=+$P($G(^TMP("PS",$J,IRX,0)),U,15)
"RTN","RORUTL15",233,0)
 . I TYPE["O"  D  Q:TMP<STDT
"RTN","RORUTL15",234,0)
 . . S TMP=+$P($G(^TMP("PS",$J,IRX,0)),U,10)
"RTN","RORUTL15",235,0)
 . ;--- Select the order
"RTN","RORUTL15",236,0)
 . S RXCNT=RXCNT+1,@ROR8LST@(RXCNT)=TYPE
"RTN","RORUTL15",237,0)
 . S @ROR8LST@(RXCNT,0)=^TMP("PS",$J,IRX,0)
"RTN","RORUTL15",238,0)
 ;
"RTN","RORUTL15",239,0)
 ;--- Cleanup
"RTN","RORUTL15",240,0)
 K ^TMP("PS",$J)
"RTN","RORUTL15",241,0)
 Q RXCNT
"RTN","RORUTL16")
0^159^B14440971
"RTN","RORUTL16",1,0)
RORUTL16 ;HCIOFO/SG - PHARMACY DATA SEARCH (UTILITIES) ; 10/6/05 9:34am
"RTN","RORUTL16",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL16",3,0)
 ;
"RTN","RORUTL16",4,0)
 ; This routine uses the following IAs:
"RTN","RORUTL16",5,0)
 ;
"RTN","RORUTL16",6,0)
 ; #4533         AND^PSS50, VAC^PSS50 (supported)
"RTN","RORUTL16",7,0)
 ; #4543         IEN^PSN50P65 (supported)
"RTN","RORUTL16",8,0)
 ;
"RTN","RORUTL16",9,0)
 Q
"RTN","RORUTL16",10,0)
 ;
"RTN","RORUTL16",11,0)
 ;***** LOADS THE LIST OF REGISTRY SPECIFIC DRUGS
"RTN","RORUTL16",12,0)
 ;
"RTN","RORUTL16",13,0)
 ; ROR8DST       Closed root of the destination buffer
"RTN","RORUTL16",14,0)
 ;
"RTN","RORUTL16",15,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL16",16,0)
 ;
"RTN","RORUTL16",17,0)
 ; [FLAGS]       Flags to control processing:
"RTN","RORUTL16",18,0)
 ;                 A  Do not kill the destination array before
"RTN","RORUTL16",19,0)
 ;                    loading the drugs (Add the drugs)
"RTN","RORUTL16",20,0)
 ;                 C  Include VA drug classes from the file #798.6
"RTN","RORUTL16",21,0)
 ;                 D  Include local (dispensed) drugs from the LOCAL
"RTN","RORUTL16",22,0)
 ;                    DRUG NAME multiple of the file #798.1
"RTN","RORUTL16",23,0)
 ;                 G  Include generic drugs from the file #799.51
"RTN","RORUTL16",24,0)
 ;                 R  Reduce everything to local (dispensed) drugs
"RTN","RORUTL16",25,0)
 ;
"RTN","RORUTL16",26,0)
 ;               If this parameter has no value ($G(FLAGS)="") then
"RTN","RORUTL16",27,0)
 ;               the default set of flags is used: "DGR".
"RTN","RORUTL16",28,0)
 ;
"RTN","RORUTL16",29,0)
 ; [GROUPID]     Optional identifier of the drug group. By default
"RTN","RORUTL16",30,0)
 ;               ($G(GROUPID)=""), 0 is used.
"RTN","RORUTL16",31,0)
 ;
"RTN","RORUTL16",32,0)
 ; Return Values:
"RTN","RORUTL16",33,0)
 ;       <0  Error code
"RTN","RORUTL16",34,0)
 ;        0  Ok
"RTN","RORUTL16",35,0)
 ;
"RTN","RORUTL16",36,0)
 ; The list of drugs is returned as follow:
"RTN","RORUTL16",37,0)
 ;
"RTN","RORUTL16",38,0)
 ; @ROR8DST@(
"RTN","RORUTL16",39,0)
 ;   DrugIEN,
"RTN","RORUTL16",40,0)
 ;     GroupID)          ""
"RTN","RORUTL16",41,0)
 ;   "C",
"RTN","RORUTL16",42,0)
 ;     VAClassIEN,
"RTN","RORUTL16",43,0)
 ;       GroupID)        ""
"RTN","RORUTL16",44,0)
 ;   "G",
"RTN","RORUTL16",45,0)
 ;     GenericDrugIEN,
"RTN","RORUTL16",46,0)
 ;       GroupID)        ""
"RTN","RORUTL16",47,0)
 ;
"RTN","RORUTL16",48,0)
 ; DrugIEN is an internal entry number of the local drug record
"RTN","RORUTL16",49,0)
 ; in the DRUG file (#50).
"RTN","RORUTL16",50,0)
 ;
"RTN","RORUTL16",51,0)
 ; Nodes "C" and/or "G" are created only if the R flag is not used.
"RTN","RORUTL16",52,0)
 ; Otherwise, VA drug classes and generic drugs are reduced to the
"RTN","RORUTL16",53,0)
 ; local (dispensed) drugs.
"RTN","RORUTL16",54,0)
 ;
"RTN","RORUTL16",55,0)
DRUGLIST(ROR8DST,REGIEN,FLAGS,GROUPID) ;
"RTN","RORUTL16",56,0)
 N DRUGIEN,IEN,NDFP,RC,REDUCE,ROOT,RORMSG,VACLIEN
"RTN","RORUTL16",57,0)
 S FLAGS=$S($G(FLAGS)'="":FLAGS,1:"DGR")
"RTN","RORUTL16",58,0)
 S GROUPID=$S($G(GROUPID)'="":GROUPID,1:0)
"RTN","RORUTL16",59,0)
 S REDUCE=(FLAGS["R")  K:FLAGS'["A" @ROR8DST
"RTN","RORUTL16",60,0)
 ;
"RTN","RORUTL16",61,0)
 ;--- Drug classes
"RTN","RORUTL16",62,0)
 D:FLAGS["C"
"RTN","RORUTL16",63,0)
 . S IEN=0
"RTN","RORUTL16",64,0)
 . F  S IEN=$O(^ROR(798.6,"AC",REGIEN,IEN))  Q:IEN'>0  D
"RTN","RORUTL16",65,0)
 . . D RXADDVCL(ROR8DST,+$G(^ROR(798.6,IEN,0)),REDUCE,GROUPID)
"RTN","RORUTL16",66,0)
 ;
"RTN","RORUTL16",67,0)
 ;--- Local drug names
"RTN","RORUTL16",68,0)
 D:FLAGS["D"
"RTN","RORUTL16",69,0)
 . S ROOT=$$ROOT^DILFD(798.129,","_REGIEN_",",1)
"RTN","RORUTL16",70,0)
 . S IEN=0
"RTN","RORUTL16",71,0)
 . F  S IEN=$O(@ROOT@(IEN))  Q:IEN'>0  D
"RTN","RORUTL16",72,0)
 . . S DRUGIEN=+$P($G(@ROOT@(IEN,0)),U)
"RTN","RORUTL16",73,0)
 . . S:DRUGIEN>0 @ROR8DST@(DRUGIEN,GROUPID)=""
"RTN","RORUTL16",74,0)
 ;
"RTN","RORUTL16",75,0)
 ;--- Generic drugs
"RTN","RORUTL16",76,0)
 D:FLAGS["G"
"RTN","RORUTL16",77,0)
 . N RGS  S RGS=REGIEN_"#",DRUGIEN=0
"RTN","RORUTL16",78,0)
 . F  S DRUGIEN=$O(^ROR(799.51,"ARDG",RGS,DRUGIEN))  Q:DRUGIEN'>0  D
"RTN","RORUTL16",79,0)
 . . D RXADDGEN(ROR8DST,DRUGIEN,REDUCE,GROUPID)
"RTN","RORUTL16",80,0)
 Q 0
"RTN","RORUTL16",81,0)
 ;
"RTN","RORUTL16",82,0)
 ;***** LOADS PHARMACY ORDER DATA
"RTN","RORUTL16",83,0)
 ;
"RTN","RORUTL16",84,0)
 ; .ROR8DST      Reference to the ROR8DST parameter
"RTN","RORUTL16",85,0)
 ;               passed into the callback function.
"RTN","RORUTL16",86,0)
 ;
"RTN","RORUTL16",87,0)
 ; ORDFLGS       Flags describing the original order
"RTN","RORUTL16",88,0)
 ;
"RTN","RORUTL16",89,0)
 ; Return Values:
"RTN","RORUTL16",90,0)
 ;       <0  Error code
"RTN","RORUTL16",91,0)
 ;        0  Ok
"RTN","RORUTL16",92,0)
 ;        1  Skip this refill
"RTN","RORUTL16",93,0)
 ;
"RTN","RORUTL16",94,0)
ORDER(ROR8DST,ORDFLGS) ;
"RTN","RORUTL16",95,0)
 N DATE,FILLTYPE
"RTN","RORUTL16",96,0)
 D:ORDFLGS["I"
"RTN","RORUTL16",97,0)
 . S DATE=$P(RORRXE(0),U,5),FILLTYPE="I"
"RTN","RORUTL16",98,0)
 D:ORDFLGS["O"
"RTN","RORUTL16",99,0)
 . S DATE=$P(RORRXE("RXN",0),U,6)
"RTN","RORUTL16",100,0)
 . S FILLTYPE=$P(RORRXE("RXN",0),U,3)
"RTN","RORUTL16",101,0)
 Q
"RTN","RORUTL16",102,0)
 ;
"RTN","RORUTL16",103,0)
 ;***** ADDS THE GENERIC DRUG TO THE LIST OF DRUGS
"RTN","RORUTL16",104,0)
 ;
"RTN","RORUTL16",105,0)
 ; ROR8DST       Closed root of the destination buffer
"RTN","RORUTL16",106,0)
 ;
"RTN","RORUTL16",107,0)
 ; GENIEN        IEN of a generic drug
"RTN","RORUTL16",108,0)
 ;
"RTN","RORUTL16",109,0)
 ; [REDUCE]      Reduce the class to a list of local drugs
"RTN","RORUTL16",110,0)
 ;
"RTN","RORUTL16",111,0)
 ; [GROUPID]     Drug group ID
"RTN","RORUTL16",112,0)
 ;
"RTN","RORUTL16",113,0)
RXADDGEN(ROR8DST,GENIEN,REDUCE,GROUPID) ;
"RTN","RORUTL16",114,0)
 Q:GENIEN'>0
"RTN","RORUTL16",115,0)
 S GROUPID=$S($G(GROUPID)'="":GROUPID,1:0)
"RTN","RORUTL16",116,0)
 I '$G(REDUCE)  S @ROR8DST@("G",GENIEN,GROUPID)=""  Q
"RTN","RORUTL16",117,0)
 N DRUGIEN,RORTMP,RORTS
"RTN","RORUTL16",118,0)
 S RORTMP=$$ALLOC^RORTMP(.RORTS)
"RTN","RORUTL16",119,0)
 D AND^PSS50(GENIEN,,,RORTS)
"RTN","RORUTL16",120,0)
 S DRUGIEN=0
"RTN","RORUTL16",121,0)
 F  S DRUGIEN=$O(@RORTMP@(DRUGIEN))  Q:DRUGIEN'>0  D
"RTN","RORUTL16",122,0)
 . S @ROR8DST@(DRUGIEN,GROUPID)=""
"RTN","RORUTL16",123,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORUTL16",124,0)
 Q
"RTN","RORUTL16",125,0)
 ;
"RTN","RORUTL16",126,0)
 ;***** ADDS THE VA DRUG CLASS TO THE LIST OF DRUGS
"RTN","RORUTL16",127,0)
 ;
"RTN","RORUTL16",128,0)
 ; ROR8DST       Closed root of the destination buffer
"RTN","RORUTL16",129,0)
 ;
"RTN","RORUTL16",130,0)
 ; VACL          Either IEN or code of a VA drug class
"RTN","RORUTL16",131,0)
 ;
"RTN","RORUTL16",132,0)
 ; [REDUCE]      Reduce the class to a list of local drugs
"RTN","RORUTL16",133,0)
 ;
"RTN","RORUTL16",134,0)
 ; [GROUPID]     Drug group ID
"RTN","RORUTL16",135,0)
 ;
"RTN","RORUTL16",136,0)
 ; [FLAGS]       Flags to control processing:
"RTN","RORUTL16",137,0)
 ;                 E  Always treat content of the VACL parameter as
"RTN","RORUTL16",138,0)
 ;                    a code of the VA Drug Class (instead of IEN)
"RTN","RORUTL16",139,0)
 ;
"RTN","RORUTL16",140,0)
RXADDVCL(ROR8DST,VACL,REDUCE,GROUPID,FLAGS) ;
"RTN","RORUTL16",141,0)
 N DRUGIEN,RORMSG,RORTMP,RORTS,TMP,VACLIEN
"RTN","RORUTL16",142,0)
 S RORTMP=$$ALLOC^RORTMP(.RORTS)
"RTN","RORUTL16",143,0)
 D
"RTN","RORUTL16",144,0)
 . S VACLIEN=+VACL
"RTN","RORUTL16",145,0)
 . I (VACLIEN'=VACL)!($G(FLAGS)["E")  D
"RTN","RORUTL16",146,0)
 . . D IEN^PSN50P65(,VACL,RORTS)
"RTN","RORUTL16",147,0)
 . . S TMP=+$G(@RORTMP@(0))
"RTN","RORUTL16",148,0)
 . . S VACLIEN=$S(TMP=1:+$O(@RORTMP@(0)),1:0)
"RTN","RORUTL16",149,0)
 . Q:VACLIEN'>0
"RTN","RORUTL16",150,0)
 . ;---
"RTN","RORUTL16",151,0)
 . S GROUPID=$S($G(GROUPID)'="":GROUPID,1:0)
"RTN","RORUTL16",152,0)
 . I '$G(REDUCE)  S @ROR8DST@("C",VACLIEN,GROUPID)=""  Q
"RTN","RORUTL16",153,0)
 . D VAC^PSS50(VACLIEN,,,RORTS)
"RTN","RORUTL16",154,0)
 . S DRUGIEN=0
"RTN","RORUTL16",155,0)
 . F  S DRUGIEN=$O(@RORTMP@(DRUGIEN))  Q:DRUGIEN'>0  D
"RTN","RORUTL16",156,0)
 . . S @ROR8DST@(DRUGIEN,GROUPID)=""
"RTN","RORUTL16",157,0)
 ;
"RTN","RORUTL16",158,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORUTL16",159,0)
 Q
"RTN","RORUTL17")
0^160^B53165086
"RTN","RORUTL17",1,0)
RORUTL17 ;HCIOFO/SG - REGISTRY INFORMATION UTILITIES ; 8/25/05 1:44pm
"RTN","RORUTL17",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL17",3,0)
 ;
"RTN","RORUTL17",4,0)
 Q
"RTN","RORUTL17",5,0)
 ;
"RTN","RORUTL17",6,0)
 ;***** ADDS THE PENDING PATIENT TO THE LIST
"RTN","RORUTL17",7,0)
 ;
"RTN","RORUTL17",8,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL17",9,0)
 ; IEN           IEN of the registry record
"RTN","RORUTL17",10,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORUTL17",11,0)
 ;
"RTN","RORUTL17",12,0)
 ; Return Values:
"RTN","RORUTL17",13,0)
 ;       <0  Error code
"RTN","RORUTL17",14,0)
 ;        0  Ok
"RTN","RORUTL17",15,0)
 ;
"RTN","RORUTL17",16,0)
ADDPP(REGIEN,IEN,PATIEN) ;
"RTN","RORUTL17",17,0)
 N BUF,I,NODE,IEN1,TMP,VA,VADM
"RTN","RORUTL17",18,0)
 D VADEM^RORUTL05(PATIEN)
"RTN","RORUTL17",19,0)
 S @ROR8DST@("PPL",PATIEN)=IEN_U_$$XOR^RORUTL03($P($G(VADM(2)),U))
"RTN","RORUTL17",20,0)
 ;--- Dates of selection rules
"RTN","RORUTL17",21,0)
 S NODE=$$ROOT^DILFD(798.01,","_IEN_",",1),BUF=""
"RTN","RORUTL17",22,0)
 S IEN1=0
"RTN","RORUTL17",23,0)
 F  S IEN1=$O(@NODE@(IEN1))  Q:IEN1'>0  D
"RTN","RORUTL17",24,0)
 . S TMP=$G(@NODE@(IEN1,0)),I=+$G(RORSRL(+TMP))
"RTN","RORUTL17",25,0)
 . S:I>0 $P(BUF,U,I)=$P(TMP,U,2)
"RTN","RORUTL17",26,0)
 S @ROR8DST@("PPL",PATIEN,1)=BUF
"RTN","RORUTL17",27,0)
 Q 0
"RTN","RORUTL17",28,0)
 ;
"RTN","RORUTL17",29,0)
 ;***** FORMATS THE DATE
"RTN","RORUTL17",30,0)
DATE(DATE) ;
"RTN","RORUTL17",31,0)
 Q $S(DATE>1:$$FMTE^XLFDT(DATE\1,"5Z"),1:"")
"RTN","RORUTL17",32,0)
 ;
"RTN","RORUTL17",33,0)
 ;***** LOADS THE LIST OF SELECTION RULES
"RTN","RORUTL17",34,0)
 ;
"RTN","RORUTL17",35,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL17",36,0)
 ; .SRLST        Reference to a local variable for the
"RTN","RORUTL17",37,0)
 ;               list of selection rules
"RTN","RORUTL17",38,0)
 ;
"RTN","RORUTL17",39,0)
 ; Return Values:
"RTN","RORUTL17",40,0)
 ;       <0  Error code
"RTN","RORUTL17",41,0)
 ;        0  Ok
"RTN","RORUTL17",42,0)
 ;
"RTN","RORUTL17",43,0)
LOADSRL(REGIEN,SRLST) ;
"RTN","RORUTL17",44,0)
 N IEN,NAME,NODE
"RTN","RORUTL17",45,0)
 S NODE=$$ROOT^DILFD(798.2,,1)
"RTN","RORUTL17",46,0)
 S IEN=0
"RTN","RORUTL17",47,0)
 F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D
"RTN","RORUTL17",48,0)
 . S NAME=$P($G(@NODE@(IEN,0)),U)  Q:NAME=""
"RTN","RORUTL17",49,0)
 . I NAME?1"VA"1.E1"LAB".E      S SRLST(IEN)="1^LAB"      Q
"RTN","RORUTL17",50,0)
 . I NAME?1"VA"1.E1"PROBLEM".E  S SRLST(IEN)="2^PROBLEM"  Q
"RTN","RORUTL17",51,0)
 . I NAME?1"VA"1.E1"PTF".E      S SRLST(IEN)="3^PTF"      Q
"RTN","RORUTL17",52,0)
 . I NAME?1"VA"1.E1"VPOV".E     S SRLST(IEN)="4^VISIT"    Q
"RTN","RORUTL17",53,0)
 . I NAME?1"VA"1.E1"VISIT".E    S SRLST(IEN)="4^VISIT"    Q
"RTN","RORUTL17",54,0)
 Q 0
"RTN","RORUTL17",55,0)
 ;
"RTN","RORUTL17",56,0)
 ;***** COUNTS PATIENTS WITH ERRORS
"RTN","RORUTL17",57,0)
 ;
"RTN","RORUTL17",58,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL17",59,0)
 ;
"RTN","RORUTL17",60,0)
 ; Return Values:
"RTN","RORUTL17",61,0)
 ;       <0  Error code
"RTN","RORUTL17",62,0)
 ;        0  Ok
"RTN","RORUTL17",63,0)
 ;       >0  Number of patients with errors
"RTN","RORUTL17",64,0)
 ;
"RTN","RORUTL17",65,0)
PTERR(REGIEN,SPI) ;
"RTN","RORUTL17",66,0)
 N CNT,IEN,NODE,RC,TMP
"RTN","RORUTL17",67,0)
 W:SPI !,"Counting patients with errors",!
"RTN","RORUTL17",68,0)
 S NODE=$$ROOT^DILFD(798.3,,1),(CNT,RC)=0
"RTN","RORUTL17",69,0)
 S IEN=0
"RTN","RORUTL17",70,0)
 F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D
"RTN","RORUTL17",71,0)
 . W:SPI "."
"RTN","RORUTL17",72,0)
 . S:$D(@NODE@(IEN,1,"B",REGIEN)) CNT=CNT+1
"RTN","RORUTL17",73,0)
 Q $S(RC<0:RC,1:CNT)
"RTN","RORUTL17",74,0)
 ;
"RTN","RORUTL17",75,0)
 ;***** GATHERS THE INFORMATION ABOUT THE REGISTRY
"RTN","RORUTL17",76,0)
 ;
"RTN","RORUTL17",77,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL17",78,0)
 ;
"RTN","RORUTL17",79,0)
 ; ROR8DST       Closed root of the destination array
"RTN","RORUTL17",80,0)
 ;
"RTN","RORUTL17",81,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORUTL17",82,0)
 ;                 E  Count patients with errors in the
"RTN","RORUTL17",83,0)
 ;                    ROR PATIENT EVENTS file
"RTN","RORUTL17",84,0)
 ;                 P  Include list of pending patients
"RTN","RORUTL17",85,0)
 ;                 S  Show the progress indicator
"RTN","RORUTL17",86,0)
 ;
"RTN","RORUTL17",87,0)
 ; @ROR8DST@(
"RTN","RORUTL17",88,0)
 ;   "DTACKMAX")         The latest and the earliest dates by which
"RTN","RORUTL17",89,0)
 ;   "DTACKMIN")         patient data transmissions are acknowledged
"RTN","RORUTL17",90,0)
 ;
"RTN","RORUTL17",91,0)
 ;   "NPA")              Number of active patients
"RTN","RORUTL17",92,0)
 ;   "NPE")              Number of patients with errors in the
"RTN","RORUTL17",93,0)
 ;                       ROR PATIENT EVENTS file
"RTN","RORUTL17",94,0)
 ;   "NPP")              Number of pending patients
"RTN","RORUTL17",95,0)
 ;   "NPT")              Total number of patients in the registry
"RTN","RORUTL17",96,0)
 ;                       (including pending)
"RTN","RORUTL17",97,0)
 ;
"RTN","RORUTL17",98,0)
 ;   "PPL",
"RTN","RORUTL17",99,0)
 ;     0,1)              Map of the corresponding data subnode
"RTN","RORUTL17",100,0)
 ;                       (field names separated by ^)
"RTN","RORUTL17",101,0)
 ;     DFN)              Pending patient
"RTN","RORUTL17",102,0)
 ;                         ^01: IEN of the registry record
"RTN","RORUTL17",103,0)
 ;                         ^02: Coded SSN
"RTN","RORUTL17",104,0)
 ;     DFN,1)
"RTN","RORUTL17",105,0)
 ;                       Dates of the selection rules
"RTN","RORUTL17",106,0)
 ;                         ^01: LAB
"RTN","RORUTL17",107,0)
 ;                         ^02: PROBLEM
"RTN","RORUTL17",108,0)
 ;                         ^03: PTF
"RTN","RORUTL17",109,0)
 ;                         ^04: VISIT
"RTN","RORUTL17",110,0)
 ;
"RTN","RORUTL17",111,0)
 ; Return Values:
"RTN","RORUTL17",112,0)
 ;       <0  Error code
"RTN","RORUTL17",113,0)
 ;        0  Ok
"RTN","RORUTL17",114,0)
 ;       >0  Number of ignored errors
"RTN","RORUTL17",115,0)
 ;
"RTN","RORUTL17",116,0)
REGINFO(REGIEN,ROR8DST,FLAGS) ;
"RTN","RORUTL17",117,0)
 N RORECNT       ; Number of errors
"RTN","RORUTL17",118,0)
 N RORSRL        ; List of selection rules
"RTN","RORUTL17",119,0)
 ;
"RTN","RORUTL17",120,0)
 N COUNTS,CPPL,DTACKMIN,DTACKMAX,IEN,IENS,NODE,PTSTAT,RC,RORBUF,RORMSG,SPI,TMP
"RTN","RORUTL17",121,0)
 S FLAGS=$G(FLAGS),SPI=(FLAGS["S"),CPPL=(FLAGS["P")
"RTN","RORUTL17",122,0)
 S DTACKMIN=999999999,DTACKMAX=0
"RTN","RORUTL17",123,0)
 K @ROR8DST  S (RC,RORECNT)=0
"RTN","RORUTL17",124,0)
 ;
"RTN","RORUTL17",125,0)
 ;--- Load the list of selection rules
"RTN","RORUTL17",126,0)
 I CPPL  S RC=$$LOADSRL(REGIEN,.RORSRL)  Q:RC<0 RC
"RTN","RORUTL17",127,0)
 ;
"RTN","RORUTL17",128,0)
 ;--- Examine registry records
"RTN","RORUTL17",129,0)
 W:SPI !,"Examining registry records",!
"RTN","RORUTL17",130,0)
 S NODE=$$ROOT^DILFD(798,,1)
"RTN","RORUTL17",131,0)
 S IEN=0
"RTN","RORUTL17",132,0)
 F  S IEN=$O(@NODE@("AC",REGIEN,IEN))  Q:IEN'>0  D
"RTN","RORUTL17",133,0)
 . W:SPI "."
"RTN","RORUTL17",134,0)
 . S COUNTS("NPT")=$G(COUNTS("NPT"))+1  ; Total number of patients
"RTN","RORUTL17",135,0)
 . ;--- Load the data
"RTN","RORUTL17",136,0)
 . S IENS=IEN_","  K RORBUF
"RTN","RORUTL17",137,0)
 . D GETS^DIQ(798,IENS,".01;3;9.1","I","RORBUF","RORMSG")
"RTN","RORUTL17",138,0)
 . I $G(DIERR)  D  S RORECNT=RORECNT+1  Q
"RTN","RORUTL17",139,0)
 . . D DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","RORUTL17",140,0)
 . S PTSTAT=+$G(RORBUF(798,IENS,3,"I"))
"RTN","RORUTL17",141,0)
 . ;--- Number of active patients
"RTN","RORUTL17",142,0)
 . D:$$ACTIVE^RORDD(IEN)
"RTN","RORUTL17",143,0)
 . . S COUNTS("NPA")=$G(COUNTS("NPA"))+1
"RTN","RORUTL17",144,0)
 . . S TMP=+$G(RORBUF(798,IENS,9.1,"I"))
"RTN","RORUTL17",145,0)
 . . I TMP>0  S:TMP<DTACKMIN DTACKMIN=TMP  S:TMP>DTACKMAX DTACKMAX=TMP
"RTN","RORUTL17",146,0)
 . ;--- Add a pending patient to the list
"RTN","RORUTL17",147,0)
 . I PTSTAT=4  D:CPPL  S COUNTS("NPP")=$G(COUNTS("NPP"))+1
"RTN","RORUTL17",148,0)
 . . S TMP=$$ADDPP(REGIEN,IEN,+RORBUF(798,IENS,.01,"I"))
"RTN","RORUTL17",149,0)
 ;
"RTN","RORUTL17",150,0)
 ;--- Count patients with errors
"RTN","RORUTL17",151,0)
 I FLAGS["E"  D  Q:RC<0 RC  S @ROR8DST@("NPE")=RC
"RTN","RORUTL17",152,0)
 . S RC=$$PTERR(REGIEN,SPI)
"RTN","RORUTL17",153,0)
 ;
"RTN","RORUTL17",154,0)
 ;--- Success
"RTN","RORUTL17",155,0)
 I DTACKMAX>0  D
"RTN","RORUTL17",156,0)
 . S @ROR8DST@("DTACKMIN")=DTACKMIN
"RTN","RORUTL17",157,0)
 . S @ROR8DST@("DTACKMAX")=DTACKMAX
"RTN","RORUTL17",158,0)
 E  F TMP="MIN","MAX"  S @ROR8DST@("DTACK"_TMP)=""
"RTN","RORUTL17",159,0)
 I CPPL  D:$G(COUNTS("NPP"))>0
"RTN","RORUTL17",160,0)
 . S RORBUF="",TMP=0
"RTN","RORUTL17",161,0)
 . F  S TMP=$O(RORSRL(TMP))  Q:TMP'>0  D
"RTN","RORUTL17",162,0)
 . . S $P(RORBUF,U,+RORSRL(TMP))=$P(RORSRL(TMP),U,2)
"RTN","RORUTL17",163,0)
 . S @ROR8DST@("PPL",0,1)=RORBUF
"RTN","RORUTL17",164,0)
 F TMP="NPA","NPP","NPT"  S @ROR8DST@(TMP)=+$G(COUNTS(TMP))
"RTN","RORUTL17",165,0)
 Q RORECNT
"RTN","RORUTL17",166,0)
 ;
"RTN","RORUTL17",167,0)
 ;***** E-MAILS THE INFORMATION ABOUT THE REGISTRY
"RTN","RORUTL17",168,0)
 ;
"RTN","RORUTL17",169,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL17",170,0)
 ;
"RTN","RORUTL17",171,0)
 ; [EMAIL]       E-mail address where the data will be sent to
"RTN","RORUTL17",172,0)
 ;
"RTN","RORUTL17",173,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORUTL17",174,0)
 ;                 E  Count patients with errors in the
"RTN","RORUTL17",175,0)
 ;                    ROR PATIENT EVENTS file
"RTN","RORUTL17",176,0)
 ;                 P  Include list of pending patients
"RTN","RORUTL17",177,0)
 ;                 S  Show the progress indicator
"RTN","RORUTL17",178,0)
 ;
"RTN","RORUTL17",179,0)
 ; Return Values:
"RTN","RORUTL17",180,0)
 ;       <0  Error code
"RTN","RORUTL17",181,0)
 ;        0  Ok
"RTN","RORUTL17",182,0)
 ;
"RTN","RORUTL17",183,0)
SENDINFO(REGIEN,EMAIL,FLAGS) ;
"RTN","RORUTL17",184,0)
 Q:'$$CCRNTFY^RORUTL05(REGIEN) 0
"RTN","RORUTL17",185,0)
 N DATE,IENS,INFO,MSGBUF,PARAMS,RC,RORBUF,RORMSG,TMP
"RTN","RORUTL17",186,0)
 S FLAGS=$G(FLAGS)
"RTN","RORUTL17",187,0)
 S INFO=$$ALLOC^RORTMP(),RC=0
"RTN","RORUTL17",188,0)
 S MSGBUF=$$ALLOC^RORTMP()
"RTN","RORUTL17",189,0)
 S PARAMS("DATE")=$$DATE($$DT^XLFDT)
"RTN","RORUTL17",190,0)
 ;
"RTN","RORUTL17",191,0)
 ;--- Gather the information
"RTN","RORUTL17",192,0)
 S RC=$$REGINFO(REGIEN,INFO,FLAGS)
"RTN","RORUTL17",193,0)
 ;
"RTN","RORUTL17",194,0)
 D:RC'<0
"RTN","RORUTL17",195,0)
 . N I,MBI,NF,PATIEN,XMCHAN,XMDUZ,XMLOC,XMSUB,XMTEXT,XMY,XMZ
"RTN","RORUTL17",196,0)
 . S IENS=REGIEN_","  K @MSGBUF
"RTN","RORUTL17",197,0)
 . ;
"RTN","RORUTL17",198,0)
 . ;--- Load the registry parameters
"RTN","RORUTL17",199,0)
 . D GETS^DIQ(798.1,IENS,".01;1;2;13.3;19.3","I","RORBUF","RORMSG")
"RTN","RORUTL17",200,0)
 . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,,798.1,IENS)  Q
"RTN","RORUTL17",201,0)
 . I $G(EMAIL)=""  S EMAIL=$G(RORBUF(798.1,IENS,13.3,"I"))  Q:EMAIL=""
"RTN","RORUTL17",202,0)
 . ;
"RTN","RORUTL17",203,0)
 . ;--- Header of the message body
"RTN","RORUTL17",204,0)
 . S TMP=$$SITE^RORUTL03()
"RTN","RORUTL17",205,0)
 . S PARAMS("STNAME")=$P(TMP,U,2)
"RTN","RORUTL17",206,0)
 . S PARAMS("STNUM")=$P(TMP,U)
"RTN","RORUTL17",207,0)
 . ;---
"RTN","RORUTL17",208,0)
 . F I="DTACKMAX","DTACKMIN"  D
"RTN","RORUTL17",209,0)
 . . S PARAMS(I)=$$DATE(+$G(@INFO@(I)))
"RTN","RORUTL17",210,0)
 . F I="NPA","NPP","NPT"  D
"RTN","RORUTL17",211,0)
 . . S PARAMS(I)=+$G(@INFO@(I))
"RTN","RORUTL17",212,0)
 . ;---
"RTN","RORUTL17",213,0)
 . S PARAMS("REGISTRY")=$G(RORBUF(798.1,IENS,.01,"I"))
"RTN","RORUTL17",214,0)
 . S PARAMS("RETRIES")=+$G(RORBUF(798.1,IENS,19.3,"I"))
"RTN","RORUTL17",215,0)
 . S PARAMS("UPDATED_UNTIL")=$$DATE($G(RORBUF(798.1,IENS,1,"I")))
"RTN","RORUTL17",216,0)
 . S PARAMS("EXTRACTED_UNTIL")=$$DATE($G(RORBUF(798.1,IENS,2,"I")))
"RTN","RORUTL17",217,0)
 . D BLD^DIALOG(7980000.021,.PARAMS,,MSGBUF,"S")
"RTN","RORUTL17",218,0)
 . S MBI=+$O(@MSGBUF@(""),-1)
"RTN","RORUTL17",219,0)
 . ;
"RTN","RORUTL17",220,0)
 . ;--- Number of patients with errors
"RTN","RORUTL17",221,0)
 . D:FLAGS["E"
"RTN","RORUTL17",222,0)
 . . S MBI=MBI+1,@MSGBUF@(MBI)="<NPE>"_$G(@INFO@("NPE"))_"</NPE>"
"RTN","RORUTL17",223,0)
 . ;
"RTN","RORUTL17",224,0)
 . ;--- List of pending patients
"RTN","RORUTL17",225,0)
 . D:FLAGS["P"
"RTN","RORUTL17",226,0)
 . . S RORBUF=$G(@INFO@("PPL",0,1))
"RTN","RORUTL17",227,0)
 . . F NF=1:1  Q:$P(RORBUF,U,NF)=""
"RTN","RORUTL17",228,0)
 . . S NF=NF-1
"RTN","RORUTL17",229,0)
 . . S MBI=MBI+1,@MSGBUF@(MBI)="<PPLIST>"
"RTN","RORUTL17",230,0)
 . . S MBI=MBI+1,@MSGBUF@(MBI)="CSSN,"_$TR(RORBUF,U,",")
"RTN","RORUTL17",231,0)
 . . S PATIEN=0
"RTN","RORUTL17",232,0)
 . . F  S PATIEN=$O(@INFO@("PPL",PATIEN))  Q:PATIEN'>0  D
"RTN","RORUTL17",233,0)
 . . . S RORBUF=$G(@INFO@("PPL",PATIEN,1))
"RTN","RORUTL17",234,0)
 . . . F I=1:1:NF  S $P(RORBUF,U,I)=$$DATE(+$P(RORBUF,U,I))
"RTN","RORUTL17",235,0)
 . . . S TMP=$P(@INFO@("PPL",PATIEN),U,2)
"RTN","RORUTL17",236,0)
 . . . S MBI=MBI+1,@MSGBUF@(MBI)=TMP_","_$TR(RORBUF,U,",")
"RTN","RORUTL17",237,0)
 . . S MBI=MBI+1,@MSGBUF@(MBI)="</PPLIST>"
"RTN","RORUTL17",238,0)
 . ;
"RTN","RORUTL17",239,0)
 . ;--- Footer of the message body
"RTN","RORUTL17",240,0)
 . D BLD^DIALOG(7980000.022,.PARAMS,,MSGBUF,"S")
"RTN","RORUTL17",241,0)
 . ;
"RTN","RORUTL17",242,0)
 . ;--- Send the message
"RTN","RORUTL17",243,0)
 . S XMDUZ=.5,XMY(EMAIL)=""
"RTN","RORUTL17",244,0)
 . S XMSUB="ROR: REGISTRY INFO"
"RTN","RORUTL17",245,0)
 . S XMTEXT=$$OREF^DILF(MSGBUF)
"RTN","RORUTL17",246,0)
 . D ^XMD
"RTN","RORUTL17",247,0)
 ;
"RTN","RORUTL17",248,0)
 ;--- Cleanup
"RTN","RORUTL17",249,0)
 D FREE^RORTMP(INFO),FREE^RORTMP(MSGBUF)
"RTN","RORUTL17",250,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUTL18")
0^161^B22624377
"RTN","RORUTL18",1,0)
RORUTL18 ;HCIOFO/SG - MISCELLANEOUS UTILITIES ; 1/25/06 9:21am
"RTN","RORUTL18",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL18",3,0)
 ;
"RTN","RORUTL18",4,0)
 ; This routine uses the following IA's:
"RTN","RORUTL18",5,0)
 ;
"RTN","RORUTL18",6,0)
 ; #10035        Access to the field #63 of the file #2
"RTN","RORUTL18",7,0)
 ;
"RTN","RORUTL18",8,0)
 Q
"RTN","RORUTL18",9,0)
 ;
"RTN","RORUTL18",10,0)
 ;***** STRIPS NON-NUMERIC CHARACTERS FROM THE LAB RESULT VALUE
"RTN","RORUTL18",11,0)
 ;
"RTN","RORUTL18",12,0)
 ; VAL           Source value
"RTN","RORUTL18",13,0)
 ;
"RTN","RORUTL18",14,0)
CLRNMVAL(VAL) ;
"RTN","RORUTL18",15,0)
 Q $TR(VAL," <>,")
"RTN","RORUTL18",16,0)
 ;
"RTN","RORUTL18",17,0)
 ;***** CHECKS FOR 'CONFIRMED' STATUS
"RTN","RORUTL18",18,0)
 ;
"RTN","RORUTL18",19,0)
 ; IEN           IEN of the registry record (in file #798)
"RTN","RORUTL18",20,0)
 ;
"RTN","RORUTL18",21,0)
 ; Return Values:
"RTN","RORUTL18",22,0)
 ;        0  Not confirmed
"RTN","RORUTL18",23,0)
 ;       >0  Confirmation date/time
"RTN","RORUTL18",24,0)
 ;
"RTN","RORUTL18",25,0)
CONFDT(IEN) ;
"RTN","RORUTL18",26,0)
 N CONF  S CONF=$P($G(^RORDATA(798,+IEN,0)),U,4,5)
"RTN","RORUTL18",27,0)
 Q $S('$P(CONF,U,2):$P(CONF,U),1:0)
"RTN","RORUTL18",28,0)
 ;
"RTN","RORUTL18",29,0)
 ;***** DATE RANGE COMPARISON FUNCTIONS
"RTN","RORUTL18",30,0)
DTMAX(DT1,DT2) ;
"RTN","RORUTL18",31,0)
 I DT1>0  Q $S(DT2>DT1:DT2,1:DT1)
"RTN","RORUTL18",32,0)
 Q $S(DT2>0:DT2,1:0)
"RTN","RORUTL18",33,0)
 ;
"RTN","RORUTL18",34,0)
DTMIN(DT1,DT2) ;
"RTN","RORUTL18",35,0)
 I DT1>0  Q $S(DT2'>0:DT1,DT2<DT1:DT2,1:DT1)
"RTN","RORUTL18",36,0)
 Q $S(DT2>0:DT2,1:0)
"RTN","RORUTL18",37,0)
 ;
"RTN","RORUTL18",38,0)
 ;***** RETURNS THE INSTITUTION IEN FOR THE HOSPITAL LOCATION
"RTN","RORUTL18",39,0)
 ;
"RTN","RORUTL18",40,0)
 ; IEN44         IEN in the HOSPITAL LOCATION file (#44)
"RTN","RORUTL18",41,0)
 ;
"RTN","RORUTL18",42,0)
 ; Return Values:
"RTN","RORUTL18",43,0)
 ;       <0  Error
"RTN","RORUTL18",44,0)
 ;       ""  Location has no corresponding institution
"RTN","RORUTL18",45,0)
 ;       >0  Institution IEN
"RTN","RORUTL18",46,0)
 ;
"RTN","RORUTL18",47,0)
IEN4(IEN44) ;
"RTN","RORUTL18",48,0)
 N IEN4,RC,RORMSG
"RTN","RORUTL18",49,0)
 Q:$G(IEN44)'>0 ""
"RTN","RORUTL18",50,0)
 S IEN4=+$$GET1^DIQ(44,IEN44_",",3,"I",,"RORMSG")
"RTN","RORUTL18",51,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,44,IEN44_",")
"RTN","RORUTL18",52,0)
 Q $S(IEN4>0:IEN4,1:"")
"RTN","RORUTL18",53,0)
 ;
"RTN","RORUTL18",54,0)
 ;***** RETURNS A LAB REFERENCE (IEN IN 'LAB DATA') FOR THE PATIENT
"RTN","RORUTL18",55,0)
 ;
"RTN","RORUTL18",56,0)
 ; PTIEN         Patient IEN
"RTN","RORUTL18",57,0)
 ;
"RTN","RORUTL18",58,0)
 ; Return values:
"RTN","RORUTL18",59,0)
 ;       <0  Error code
"RTN","RORUTL18",60,0)
 ;        0  No lab data
"RTN","RORUTL18",61,0)
 ;       >0  IEN of the record in LAB DATA file
"RTN","RORUTL18",62,0)
 ;
"RTN","RORUTL18",63,0)
LABREF(PTIEN) ;
"RTN","RORUTL18",64,0)
 N LABREF,RORMSG
"RTN","RORUTL18",65,0)
 Q:$G(PTIEN)'>0 0
"RTN","RORUTL18",66,0)
 Q:$$MERGED(PTIEN) 0
"RTN","RORUTL18",67,0)
 S LABREF=+$$GET1^DIQ(2,PTIEN_",",63,"I",,"RORMSG")
"RTN","RORUTL18",68,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,PTIEN,2,PTIEN_",")
"RTN","RORUTL18",69,0)
 Q LABREF
"RTN","RORUTL18",70,0)
 ;
"RTN","RORUTL18",71,0)
 ;***** RETURNS THE NEW DFN OF A MERGED PATIENT RECORD
"RTN","RORUTL18",72,0)
 ;
"RTN","RORUTL18",73,0)
 ; DFN           Patient IEN
"RTN","RORUTL18",74,0)
 ;
"RTN","RORUTL18",75,0)
 ; Return values:
"RTN","RORUTL18",76,0)
 ;        0  The patient has not been merged
"RTN","RORUTL18",77,0)
 ;       >0  New DFN
"RTN","RORUTL18",78,0)
 ;
"RTN","RORUTL18",79,0)
MERGED(DFN) ;
"RTN","RORUTL18",80,0)
 N NEWDFN
"RTN","RORUTL18",81,0)
 F  S DFN=+$G(^DPT(+DFN,-9))  Q:DFN'>0  S NEWDFN=DFN
"RTN","RORUTL18",82,0)
 Q +$G(NEWDFN)
"RTN","RORUTL18",83,0)
 ;
"RTN","RORUTL18",84,0)
 ;***** SENDS THE CPRS-COMPATIBLE INFORMATIONAL ALERT
"RTN","RORUTL18",85,0)
 ;
"RTN","RORUTL18",86,0)
 ; MSG           Text of the alert message.  The text is truncated
"RTN","RORUTL18",87,0)
 ;               to 50 characters and '^' are replaced with '~'.
"RTN","RORUTL18",88,0)
 ;
"RTN","RORUTL18",89,0)
 ; [DFN]         Patient IEN
"RTN","RORUTL18",90,0)
 ;
"RTN","RORUTL18",91,0)
 ; [.XQA]        List of addressees.  By default, the
"RTN","RORUTL18",92,0)
 ;               alert is sent to the current user.
"RTN","RORUTL18",93,0)
 ;
"RTN","RORUTL18",94,0)
ORALERT(MSG,DFN,XQA) ;
"RTN","RORUTL18",95,0)
 N LAST4,NAME,VA,VADM,VAHOW,VAROOT,XQADATA,XQAID,XQAMSG,XQAROU
"RTN","RORUTL18",96,0)
 S XQAMSG="",XQAID="ROR,,"
"RTN","RORUTL18",97,0)
 I $G(DFN)>0  D
"RTN","RORUTL18",98,0)
 . D DEM^VADPT
"RTN","RORUTL18",99,0)
 . S NAME=$E($G(VADM(1)),1,9)         ; Patient name
"RTN","RORUTL18",100,0)
 . S LAST4=$E($P($G(VADM(2)),U),6,9)  ; Last 4 of SSN
"RTN","RORUTL18",101,0)
 . S XQAMSG=$$LJ^XLFSTR(NAME_" ("_$E(NAME,1)_LAST4_"):",19)
"RTN","RORUTL18",102,0)
 . S $P(XQAID,",",2)=+DFN
"RTN","RORUTL18",103,0)
 S XQAMSG=XQAMSG_$TR(MSG,"^","~")
"RTN","RORUTL18",104,0)
 S:$L(XQAMSG)>70 $E(XQAMSG,68,999)="..."
"RTN","RORUTL18",105,0)
 I $D(XQA)<10  Q:$G(DUZ)'>0  S XQA(+DUZ)=""
"RTN","RORUTL18",106,0)
 D SETUP^XQALERT
"RTN","RORUTL18",107,0)
 Q
"RTN","RORUTL18",108,0)
 ;
"RTN","RORUTL18",109,0)
 ;***** CHECKS FOR 'PENDING' STATUS
"RTN","RORUTL18",110,0)
 ;
"RTN","RORUTL18",111,0)
 ; IEN           IEN of the registry record (in file #798)
"RTN","RORUTL18",112,0)
 ;
"RTN","RORUTL18",113,0)
 ; Return Values:
"RTN","RORUTL18",114,0)
 ;        0  Non-pending
"RTN","RORUTL18",115,0)
 ;        1  Pending patient
"RTN","RORUTL18",116,0)
 ;
"RTN","RORUTL18",117,0)
PENDING(IEN) ;
"RTN","RORUTL18",118,0)
 Q ($P($G(^RORDATA(798,+IEN,0)),U,5)=4)
"RTN","RORUTL18",119,0)
 ;
"RTN","RORUTL18",120,0)
 ;***** COUNTS THE REGISTRY PATIENTS
"RTN","RORUTL18",121,0)
 ;
"RTN","RORUTL18",122,0)
 ; .REGLST       Reference to a local array containing registry
"RTN","RORUTL18",123,0)
 ;               names as the subscripts and optional registry IENs
"RTN","RORUTL18",124,0)
 ;               as the values.
"RTN","RORUTL18",125,0)
 ;
"RTN","RORUTL18",126,0)
 ; [FLAGS]       Flags (can be combined)
"RTN","RORUTL18",127,0)
 ;                 A  Skip non-active patients
"RTN","RORUTL18",128,0)
 ;                 S  Skip patients marked as "Do not Send"
"RTN","RORUTL18",129,0)
 ;
"RTN","RORUTL18",130,0)
 ; [ROR8DST]     Closed root of the global node that will contain a
"RTN","RORUTL18",131,0)
 ;               list of patients. By default ($G(ROR8DST)=""), the
"RTN","RORUTL18",132,0)
 ;               ^TMP("RORUTL18",$J) global node is used internally
"RTN","RORUTL18",133,0)
 ;               (it is deleted before exiting the function).
"RTN","RORUTL18",134,0)
 ; @ROR8DST@(
"RTN","RORUTL18",135,0)
 ;  PatIEN,
"RTN","RORUTL18",136,0)
 ;    RegIEN)    Registry Record IEN
"RTN","RORUTL18",137,0)
 ;
"RTN","RORUTL18",138,0)
 ; Return Values:
"RTN","RORUTL18",139,0)
 ;       <0  Error code
"RTN","RORUTL18",140,0)
 ;        0  All provided registries are empty
"RTN","RORUTL18",141,0)
 ;       >0  Number of unique patients
"RTN","RORUTL18",142,0)
 ;
"RTN","RORUTL18",143,0)
REGPTCNT(REGLST,FLAGS,ROR8DST) ;
"RTN","RORUTL18",144,0)
 N CNT,IEN,NODE,PLKILL,PTIEN,REGIEN,REGNAME
"RTN","RORUTL18",145,0)
 S:$G(ROR8DST)="" ROR8DST=$NA(^TMP("RORUTL18",$J)),PLKILL=1
"RTN","RORUTL18",146,0)
 S FLAGS=$G(FLAGS),NODE=$$ROOT^DILFD(798,"",1),CNT=0
"RTN","RORUTL18",147,0)
 K @ROR8DST
"RTN","RORUTL18",148,0)
 ;--- Build a list of unique patients and count them
"RTN","RORUTL18",149,0)
 S REGNAME=""
"RTN","RORUTL18",150,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D
"RTN","RORUTL18",151,0)
 . ;--- Get the registry IEN
"RTN","RORUTL18",152,0)
 . S REGIEN=+$G(REGLST(REGNAME))
"RTN","RORUTL18",153,0)
 . I REGIEN'>0  D  Q:REGIEN'>0
"RTN","RORUTL18",154,0)
 . . S REGIEN=$$REGIEN^RORUTL02(REGNAME)
"RTN","RORUTL18",155,0)
 . ;--- Count the registry patients
"RTN","RORUTL18",156,0)
 . S IEN=0
"RTN","RORUTL18",157,0)
 . F  S IEN=$O(@NODE@("AC",REGIEN,IEN))  Q:IEN'>0  D
"RTN","RORUTL18",158,0)
 . . I FLAGS["A"  Q:'$$ACTIVE^RORDD(IEN)
"RTN","RORUTL18",159,0)
 . . I FLAGS["S"  Q:$P($G(^RORDATA(798,IEN,2)),U,4)
"RTN","RORUTL18",160,0)
 . . S PTIEN=$$PTIEN^RORUTL01(IEN)  Q:PTIEN'>0
"RTN","RORUTL18",161,0)
 . . I '$D(@ROR8DST@(PTIEN))  D  S CNT=CNT+1
"RTN","RORUTL18",162,0)
 . . . S @ROR8DST@(PTIEN,REGIEN)=IEN
"RTN","RORUTL18",163,0)
 ;--- Cleanup
"RTN","RORUTL18",164,0)
 K:$G(PLKILL) @ROR8DST
"RTN","RORUTL18",165,0)
 Q CNT
"RTN","RORUTL18",166,0)
 ;
"RTN","RORUTL18",167,0)
 ;***** SELECTS A REGISTRY DESCRIPTOR IN THE FILE #798.1
"RTN","RORUTL18",168,0)
 ;
"RTN","RORUTL18",169,0)
 ; [.REGNAME]    Registry name is returned via this parameter
"RTN","RORUTL18",170,0)
 ;
"RTN","RORUTL18",171,0)
 ; Return Values:
"RTN","RORUTL18",172,0)
 ;       <0  Error code
"RTN","RORUTL18",173,0)
 ;       ""  Timeout, "^" entered, or an error in ^DIC
"RTN","RORUTL18",174,0)
 ;        0  There are no records in the file #798.1
"RTN","RORUTL18",175,0)
 ;       >0  IEN of the selected registry
"RTN","RORUTL18",176,0)
 ;
"RTN","RORUTL18",177,0)
SELREG(REGNAME) ;
"RTN","RORUTL18",178,0)
 N DA,DIC,DLAYGO,DTOUT,DUOUT,RC,RORBUF,RORMSG,X,Y
"RTN","RORUTL18",179,0)
 S REGNAME=""
"RTN","RORUTL18",180,0)
 ;--- If there are less than two records, do not ask a user
"RTN","RORUTL18",181,0)
 D LIST^DIC(798.1,,"@;.01E",,2,,,"B",,,"RORBUF","RORMSG")
"RTN","RORUTL18",182,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.1)
"RTN","RORUTL18",183,0)
 I $G(RORBUF("DILIST",0))<2  D  Q +$G(RORBUF("DILIST",2,1))
"RTN","RORUTL18",184,0)
 . S REGNAME=$G(RORBUF("DILIST","ID",1,.01))
"RTN","RORUTL18",185,0)
 ;--- Select a registry
"RTN","RORUTL18",186,0)
 S DIC=798.1,DIC(0)="AENQZ"
"RTN","RORUTL18",187,0)
 S DIC("A")="Select a Registry: "
"RTN","RORUTL18",188,0)
 D ^DIC
"RTN","RORUTL18",189,0)
 S:Y>0 REGNAME=Y(0,0)
"RTN","RORUTL18",190,0)
 Q $S($D(DTOUT)!$D(DUOUT):"",Y<0:"",1:+Y)
"RTN","RORUTL18",191,0)
 ;
"RTN","RORUTL18",192,0)
 ;***** RETURNS THE CLINIC'S STOP CODE
"RTN","RORUTL18",193,0)
 ;
"RTN","RORUTL18",194,0)
 ; CLIEN         Clinic IEN
"RTN","RORUTL18",195,0)
 ;
"RTN","RORUTL18",196,0)
 ; Return Values:
"RTN","RORUTL18",197,0)
 ;       <0  Error code
"RTN","RORUTL18",198,0)
 ;       ""  No stop code
"RTN","RORUTL18",199,0)
 ;       >0  Stop code
"RTN","RORUTL18",200,0)
 ;
"RTN","RORUTL18",201,0)
STOPCODE(CLIEN) ;
"RTN","RORUTL18",202,0)
 N RORMSG,STOP
"RTN","RORUTL18",203,0)
 I CLIEN>0  D
"RTN","RORUTL18",204,0)
 . S STOP=$$GET1^DIQ(44,CLIEN_",","#8:#1","I",,"RORMSG")
"RTN","RORUTL18",205,0)
 . S:$G(DIERR) STOP=$$DBS^RORERR("RORMSG",-99,,,44,CLIEN_",")
"RTN","RORUTL18",206,0)
 E  S STOP=""
"RTN","RORUTL18",207,0)
 Q STOP
"RTN","RORUTL19")
0^217^B2739501
"RTN","RORUTL19",1,0)
RORUTL19 ;HCIOFO/SG - PATIENT DATA UTILITIES ; 10/27/05 2:40pm
"RTN","RORUTL19",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORUTL19",3,0)
 ;
"RTN","RORUTL19",4,0)
 Q
"RTN","RORUTL19",5,0)
 ;
"RTN","RORUTL19",6,0)
 ;***** UPDATES THE LOCAL FIELDS
"RTN","RORUTL19",7,0)
 ;
"RTN","RORUTL19",8,0)
 ; IENS798       IENS of the registry record in the file #798
"RTN","RORUTL19",9,0)
 ;
"RTN","RORUTL19",10,0)
 ; .LFV          Reference to a local variable that stores the
"RTN","RORUTL19",11,0)
 ;               list of the local field values
"RTN","RORUTL19",12,0)
 ;
"RTN","RORUTL19",13,0)
 ; Return Values:
"RTN","RORUTL19",14,0)
 ;       <0  Error code
"RTN","RORUTL19",15,0)
 ;        0  Ok
"RTN","RORUTL19",16,0)
 ;
"RTN","RORUTL19",17,0)
UPDLFV(IENS798,LFV) ;
"RTN","RORUTL19",18,0)
 N DA,DIK,FLDIEN,IENS,IR,LFCNT,LFIEN,RC,RORFDA,RORLST,RORMSG,SCR
"RTN","RORUTL19",19,0)
 S RC=0
"RTN","RORUTL19",20,0)
 ;
"RTN","RORUTL19",21,0)
 S (LFCNT,LFIEN)=0
"RTN","RORUTL19",22,0)
 F  S LFIEN=$O(LFV(LFIEN))  Q:LFIEN'>0  D
"RTN","RORUTL19",23,0)
 . S LFCNT=LFCNT+1,IENS="?+"_LFCNT_","_IENS798
"RTN","RORUTL19",24,0)
 . S RORFDA(798.02,IENS,.01)=LFIEN
"RTN","RORUTL19",25,0)
 . S RORFDA(798.02,IENS,.02)=$P(LFV(LFIEN),U,5)
"RTN","RORUTL19",26,0)
 . S RORFDA(798.02,IENS,1)=$P(LFV(LFIEN),U,6)
"RTN","RORUTL19",27,0)
 ;--- Delete values of active fields that are not present in the
"RTN","RORUTL19",28,0)
 ;    LFV array (deleted by the user). Values of inactive fields
"RTN","RORUTL19",29,0)
 ;--- are always left intact.
"RTN","RORUTL19",30,0)
 S SCR="I $$LFACTIVE^RORDD01(+$G(^(0)))"
"RTN","RORUTL19",31,0)
 S IENS=","_IENS798
"RTN","RORUTL19",32,0)
 D LIST^DIC(798.02,IENS,"@;.01I",,,,,"B",SCR,,"RORLST","RORMSG")
"RTN","RORUTL19",33,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.02,IENS)
"RTN","RORUTL19",34,0)
 S DIK=$$ROOT^DILFD(798.02,IENS),DA(1)=+IENS798
"RTN","RORUTL19",35,0)
 S IR=""
"RTN","RORUTL19",36,0)
 F  S IR=$O(RORLST("DILIST","ID",IR))  Q:IR=""  D
"RTN","RORUTL19",37,0)
 . S FLDIEN=+RORLST("DILIST","ID",IR,.01)
"RTN","RORUTL19",38,0)
 . I '$D(LFV(FLDIEN))  S DA=+RORLST("DILIST",2,IR)  D ^DIK
"RTN","RORUTL19",39,0)
 ;--- Store the data
"RTN","RORUTL19",40,0)
 I $D(RORFDA)>1  D  Q:RC<0 RC
"RTN","RORUTL19",41,0)
 . D UPDATE^DIE(,"RORFDA",,"RORMSG")
"RTN","RORUTL19",42,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798.02,IENS798)
"RTN","RORUTL19",43,0)
 ;--- Success
"RTN","RORUTL19",44,0)
 Q 0
"RTN","RORVM001")
0^162^B1276605
"RTN","RORVM001",1,0)
RORVM001 ;HCIOFO/SG - MAINTENANCE OPTIONS ; 1/23/06 11:39am
"RTN","RORVM001",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORVM001",3,0)
 ;
"RTN","RORVM001",4,0)
 Q
"RTN","RORVM001",5,0)
 ;
"RTN","RORVM001",6,0)
 ;***** DECODE SSN
"RTN","RORVM001",7,0)
DECODSSN ;
"RTN","RORVM001",8,0)
 Q:'$$ACCESS^RORDD(798)
"RTN","RORVM001",9,0)
 N EXIT,DA,DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RORVM001",10,0)
 S EXIT=0
"RTN","RORVM001",11,0)
 S DIR(0)="FO^9:13"
"RTN","RORVM001",12,0)
 S DIR("A")="Coded SSN"
"RTN","RORVM001",13,0)
 S DIR("?")="Enter a coded Social Security Number."
"RTN","RORVM001",14,0)
 F  D  Q:EXIT
"RTN","RORVM001",15,0)
 . D ^DIR
"RTN","RORVM001",16,0)
 . I $G(Y)=""  S EXIT=1  Q
"RTN","RORVM001",17,0)
 . S X=$$XOR^RORUTL03(Y)
"RTN","RORVM001",18,0)
 . W ?30,"SSN: "_X
"RTN","RORVM001",19,0)
 . W:X'?9N.1A " ??"
"RTN","RORVM001",20,0)
 ;---
"RTN","RORVM001",21,0)
 Q
"RTN","RORVM001",22,0)
 ;
"RTN","RORVM001",23,0)
 ;***** REBUILDS THE "ACL" CROSS-REFERENCE (USER ACCESS)
"RTN","RORVM001",24,0)
 ; OPTION: [RORMNT ACL REINDEX]
"RTN","RORVM001",25,0)
RNDXACL ;
"RTN","RORVM001",26,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,X,Y
"RTN","RORVM001",27,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RORVM001",28,0)
 S DIR("A")="Do you want to reindex the ACL cross-reference"
"RTN","RORVM001",29,0)
 D BLD^DIALOG(7980000.007,,,"DIR(""?"")","S")
"RTN","RORVM001",30,0)
 D ^DIR
"RTN","RORVM001",31,0)
 I $G(Y)  D  W !!,"Done."
"RTN","RORVM001",32,0)
 . S X=$$RNDXACL^RORUTL11()
"RTN","RORVM001",33,0)
 Q
"RTN","RORX000")
0^163^B4541569
"RTN","RORX000",1,0)
RORX000 ;HCIOFO/SG - DUMMY REPORT ; 9/29/03 3:51pm
"RTN","RORX000",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX000",3,0)
 ;
"RTN","RORX000",4,0)
 Q
"RTN","RORX000",5,0)
 ;
"RTN","RORX000",6,0)
 ;*****
"RTN","RORX000",7,0)
BIGDUMMY(RORTSK) ;
"RTN","RORX000",8,0)
 N BODY,FLT,IEN,IENS,NAME,NODE,PARAMS,PATIENT,REPORT,RORBUF,RORMSG,TMP
"RTN","RORX000",9,0)
 ;---
"RTN","RORX000",10,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX000",11,0)
 ;--- Dump the report parameters
"RTN","RORX000",12,0)
 S BODY=$$ADDVAL^RORTSK11(RORTSK,"PARAMETERS",,REPORT)
"RTN","RORX000",13,0)
 S NODE=$NA(RORTSK("PARAMS")),FLT=$P(NODE,")")_","
"RTN","RORX000",14,0)
 F  S NODE=$Q(@NODE)  Q:'(NODE[FLT)  D
"RTN","RORX000",15,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"PARAMETER",NODE_" = "_@NODE,BODY)
"RTN","RORX000",16,0)
 ;--- List of patients
"RTN","RORX000",17,0)
 S BODY=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX000",18,0)
 S NAME=""
"RTN","RORX000",19,0)
 F  S NAME=$O(^DPT("B",NAME))  Q:NAME=""  D
"RTN","RORX000",20,0)
 . S IEN=0
"RTN","RORX000",21,0)
 . F  S IEN=$O(^DPT("B",NAME,IEN))  Q:IEN'>0  D
"RTN","RORX000",22,0)
 . . S IENS=IEN_","  K RORBUF
"RTN","RORX000",23,0)
 . . D GETS^DIQ(2,IENS,".01;.02;.03;.06;.09;","E","RORBUF","RORMSG")
"RTN","RORX000",24,0)
 . . S PATIENT=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,BODY)
"RTN","RORX000",25,0)
 . . S TMP=$G(RORBUF(2,IENS,.01,"E"))
"RTN","RORX000",26,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NAME",TMP,PATIENT)
"RTN","RORX000",27,0)
 . . S TMP=$G(RORBUF(2,IENS,.02,"E"))
"RTN","RORX000",28,0)
 . . D ADDVAL^RORTSK11(RORTSK,"SEX",TMP,PATIENT)
"RTN","RORX000",29,0)
 . . S TMP=$G(RORBUF(2,IENS,.03,"E"))
"RTN","RORX000",30,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DOB",TMP,PATIENT)
"RTN","RORX000",31,0)
 . . S TMP=$G(RORBUF(2,IENS,.06,"E"))
"RTN","RORX000",32,0)
 . . D ADDVAL^RORTSK11(RORTSK,"RACE",TMP,PATIENT)
"RTN","RORX000",33,0)
 . . S TMP=$G(RORBUF(2,IENS,.09,"E"))
"RTN","RORX000",34,0)
 . . D ADDVAL^RORTSK11(RORTSK,"SSN",TMP,PATIENT)
"RTN","RORX000",35,0)
 Q 0
"RTN","RORX000",36,0)
 ;
"RTN","RORX000",37,0)
 ;*****
"RTN","RORX000",38,0)
DUMMY(RORTSK) ;
"RTN","RORX000",39,0)
 N FLT,NODE,PARAMS,REPORT,TMP
"RTN","RORX000",40,0)
 ;---
"RTN","RORX000",41,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX000",42,0)
 S PARAMS=$$ADDVAL^RORTSK11(RORTSK,"PARAMETERS",,REPORT)
"RTN","RORX000",43,0)
 ;--- Dump the report parameters
"RTN","RORX000",44,0)
 S NODE=$NA(RORTSK("PARAMS")),FLT=$P(NODE,")")_","
"RTN","RORX000",45,0)
 F  S NODE=$Q(@NODE)  Q:'(NODE[FLT)  D
"RTN","RORX000",46,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"PARAMETER",NODE_" = "_@NODE,PARAMS)
"RTN","RORX000",47,0)
 Q 0
"RTN","RORX001")
0^6^B28863901
"RTN","RORX001",1,0)
RORX001 ;HCIOFO/SG - LIST OF REGISTRY PATIENTS ; 9/15/05 2:13pm
"RTN","RORX001",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX001",3,0)
 ;
"RTN","RORX001",4,0)
 ; This routine uses the following IAs:
"RTN","RORX001",5,0)
 ;
"RTN","RORX001",6,0)
 ; #10061        DEM^VADPT (supported)
"RTN","RORX001",7,0)
 ;
"RTN","RORX001",8,0)
 Q
"RTN","RORX001",9,0)
 ;
"RTN","RORX001",10,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX001",11,0)
 ;
"RTN","RORX001",12,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX001",13,0)
 ;
"RTN","RORX001",14,0)
 ; Return Values:
"RTN","RORX001",15,0)
 ;       <0  Error code
"RTN","RORX001",16,0)
 ;        0  Ok
"RTN","RORX001",17,0)
 ;
"RTN","RORX001",18,0)
HEADER(PARTAG) ;
"RTN","RORX001",19,0)
 N COL,COLUMNS,HEADER,TMP
"RTN","RORX001",20,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX001",21,0)
 S COLUMNS=$$ADDVAL^RORTSK11(RORTSK,"TBLDEF",,HEADER)
"RTN","RORX001",22,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"NAME","PATIENTS")
"RTN","RORX001",23,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"HEADER","1")
"RTN","RORX001",24,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"FOOTER","1")
"RTN","RORX001",25,0)
 S RORFLDS=".01"
"RTN","RORX001",26,0)
 ;--- Required columns
"RTN","RORX001",27,0)
 F COL="#","NAME"  D
"RTN","RORX001",28,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX001",29,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",COL)
"RTN","RORX001",30,0)
 ;--- Additional columns
"RTN","RORX001",31,0)
 F COL="DOD","CSSN","LAST4","SELRULES","SELDT","CONFDT"  D
"RTN","RORX001",32,0)
 . Q:'$$OPTCOL^RORXU006(COL)
"RTN","RORX001",33,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX001",34,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",COL)
"RTN","RORX001",35,0)
 ;---
"RTN","RORX001",36,0)
 S:$$OPTCOL^RORXU006("CONFDT") RORFLDS=RORFLDS_";2"
"RTN","RORX001",37,0)
 S:$$OPTCOL^RORXU006("SELDT") RORFLDS=RORFLDS_";3.2"
"RTN","RORX001",38,0)
 Q 0
"RTN","RORX001",39,0)
 ;
"RTN","RORX001",40,0)
 ;***** ADDS THE PATIENT DATA TO THE REPORT
"RTN","RORX001",41,0)
 ;
"RTN","RORX001",42,0)
 ; IENS          IENS of the patient's record in the registry
"RTN","RORX001",43,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX001",44,0)
 ;
"RTN","RORX001",45,0)
 ; Return Values:
"RTN","RORX001",46,0)
 ;       <0  Error code
"RTN","RORX001",47,0)
 ;        0  Ok
"RTN","RORX001",48,0)
 ;
"RTN","RORX001",49,0)
PATIENT(IENS,PARTAG) ;
"RTN","RORX001",50,0)
 N DFN,IATIME,NAME,RC,RORBUF,RORMSG,TMP,VA,VADM,VAHOW,VAROOT
"RTN","RORX001",51,0)
 D GETS^DIQ(798,IENS,RORFLDS,"I","RORBUF","RORMSG")
"RTN","RORX001",52,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","RORX001",53,0)
 S DFN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","RORX001",54,0)
 ;--- Load the demographic data
"RTN","RORX001",55,0)
 D DEM^VADPT
"RTN","RORX001",56,0)
 ;--- The <PATIENT> tag
"RTN","RORX001",57,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PARTAG,,DFN)
"RTN","RORX001",58,0)
 ;--- Patient Name
"RTN","RORX001",59,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX001",60,0)
 ;--- Date of Death
"RTN","RORX001",61,0)
 D:$$OPTCOL^RORXU006("DOD")
"RTN","RORX001",62,0)
 . S TMP=$$DATE^RORXU002(VADM(6)\1)
"RTN","RORX001",63,0)
 . D ADDVAL^RORTSK11(RORTSK,"DOD",TMP,PTAG,1)
"RTN","RORX001",64,0)
 ;--- Coded SSN
"RTN","RORX001",65,0)
 D:$$OPTCOL^RORXU006("CSSN")
"RTN","RORX001",66,0)
 . S TMP=$$XOR^RORUTL03($P(VADM(2),U))
"RTN","RORX001",67,0)
 . D ADDVAL^RORTSK11(RORTSK,"CSSN",TMP,PTAG,1)
"RTN","RORX001",68,0)
 ;--- Last 4 digits of the SSN
"RTN","RORX001",69,0)
 D:$$OPTCOL^RORXU006("LAST4")
"RTN","RORX001",70,0)
 . D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG,2)
"RTN","RORX001",71,0)
 ;--- Selection Rules
"RTN","RORX001",72,0)
 I $$OPTCOL^RORXU006("SELRULES")  D  Q:RC<0 RC
"RTN","RORX001",73,0)
 . S RC=$$SELRULES(IENS,PTAG)
"RTN","RORX001",74,0)
 ;--- Date Selected for the Registry
"RTN","RORX001",75,0)
 D:$$OPTCOL^RORXU006("SELDT")
"RTN","RORX001",76,0)
 . S TMP=$$DATE^RORXU002($G(RORBUF(798,IENS,3.2,"I"))\1)
"RTN","RORX001",77,0)
 . D ADDVAL^RORTSK11(RORTSK,"SELDT",TMP,PTAG,1)
"RTN","RORX001",78,0)
 ;--- Date Confirmed in the Registry
"RTN","RORX001",79,0)
 D:$$OPTCOL^RORXU006("CONFDT")
"RTN","RORX001",80,0)
 . S TMP=$$DATE^RORXU002($G(RORBUF(798,IENS,2,"I"))\1)
"RTN","RORX001",81,0)
 . D ADDVAL^RORTSK11(RORTSK,"CONFDT",TMP,PTAG,1)
"RTN","RORX001",82,0)
 ;--- Patient IEN (DFN)
"RTN","RORX001",83,0)
 ;S:$$OPTCOL^RORXU006("DFN") TMP=$$ADDVAL^RORTSK11(RORTSK,"DFN",DFN,PTAG)
"RTN","RORX001",84,0)
 ;--- Integration Control Number
"RTN","RORX001",85,0)
 ;D:$$OPTCOL^RORXU006("ICN")
"RTN","RORX001",86,0)
 ;. S TMP=$$ICN^RORUTL02(DFN)
"RTN","RORX001",87,0)
 ;. D ADDVAL^RORTSK11(RORTSK,"ICN",$P(TMP,"V"),PTAG,1)
"RTN","RORX001",88,0)
 Q 0
"RTN","RORX001",89,0)
 ;
"RTN","RORX001",90,0)
 ;***** COMPILES A LIST OF REGISTRY PATIENTS
"RTN","RORX001",91,0)
 ; REPORT CODE: 001
"RTN","RORX001",92,0)
 ;
"RTN","RORX001",93,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX001",94,0)
 ;
"RTN","RORX001",95,0)
 ; Return Values:
"RTN","RORX001",96,0)
 ;       <0  Error code
"RTN","RORX001",97,0)
 ;        0  Ok
"RTN","RORX001",98,0)
 ;
"RTN","RORX001",99,0)
REGPTLST(RORTSK) ;
"RTN","RORX001",100,0)
 N RORFLDS       ; Fields to load from the file #798
"RTN","RORX001",101,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX001",102,0)
 N RORREG        ; Registry IEN
"RTN","RORX001",103,0)
 ;
"RTN","RORX001",104,0)
 N BODY,CNT,ECNT,IEN,IENS,MODE,PTNAME,RC,REPORT,SFLAGS,TMP,XREFNODE
"RTN","RORX001",105,0)
 ;--- Root node of the report
"RTN","RORX001",106,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX001",107,0)
 Q:REPORT<0 REPORT
"RTN","RORX001",108,0)
 ;
"RTN","RORX001",109,0)
 ;--- Get and prepare the report parameters
"RTN","RORX001",110,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX001",111,0)
 S RC=$$PARAMS^RORXU002(.RORTSK,REPORT,,,.SFLAGS)  Q:RC<0 RC
"RTN","RORX001",112,0)
 S SFLAGS=$TR(SFLAGS,"DG")
"RTN","RORX001",113,0)
 S:'$$PARAM^RORTSK01("PATIENTS","CONFIRMED") SFLAGS=SFLAGS_"C"
"RTN","RORX001",114,0)
 S:'$$PARAM^RORTSK01("PATIENTS","PENDING") SFLAGS=SFLAGS_"G"
"RTN","RORX001",115,0)
 D ADDVAL^RORTSK11(RORTSK,"TYPE",SFLAGS,REPORT)
"RTN","RORX001",116,0)
 ;
"RTN","RORX001",117,0)
 ;--- Initialize constants and variables
"RTN","RORX001",118,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX001",119,0)
 S ECNT=0,XREFNODE=$NA(^RORDATA(798,"ARP",RORREG_"#"))
"RTN","RORX001",120,0)
 ;
"RTN","RORX001",121,0)
 ;--- The report header and list of patients
"RTN","RORX001",122,0)
 S RC=$$HEADER(REPORT)  Q:RC<0 RC
"RTN","RORX001",123,0)
 S BODY=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX001",124,0)
 D ADDATTR^RORTSK11(RORTSK,BODY,"TABLE","PATIENTS")
"RTN","RORX001",125,0)
 Q:BODY<0 BODY
"RTN","RORX001",126,0)
 ;
"RTN","RORX001",127,0)
 ;--- Browse through the registry records
"RTN","RORX001",128,0)
 S PTNAME="",(CNT,RC)=0
"RTN","RORX001",129,0)
 F  S PTNAME=$O(@XREFNODE@(PTNAME))  Q:PTNAME=""  D  Q:RC<0
"RTN","RORX001",130,0)
 . S IEN=0
"RTN","RORX001",131,0)
 . F  S IEN=$O(@XREFNODE@(PTNAME,IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX001",132,0)
 . . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX001",133,0)
 . . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX001",134,0)
 . . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX001",135,0)
 . . ;--- Check if the patient should be skipped
"RTN","RORX001",136,0)
 . . Q:$$SKIP^RORXU005(IEN,SFLAGS)
"RTN","RORX001",137,0)
 . . ;--- Process the registry record
"RTN","RORX001",138,0)
 . . I $$PATIENT(IENS,BODY)<0  S ECNT=ECNT+1  Q
"RTN","RORX001",139,0)
 ;---
"RTN","RORX001",140,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX001",141,0)
 ;
"RTN","RORX001",142,0)
 ;***** ADDS THE SELECTION RULES TO THE REPORT
"RTN","RORX001",143,0)
 ;
"RTN","RORX001",144,0)
 ; IENS          IENS of the patient's record in the registry
"RTN","RORX001",145,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX001",146,0)
 ;
"RTN","RORX001",147,0)
 ; Return Values:
"RTN","RORX001",148,0)
 ;       <0  Error code
"RTN","RORX001",149,0)
 ;        0  Ok
"RTN","RORX001",150,0)
 ;
"RTN","RORX001",151,0)
SELRULES(IENS,PARTAG) ;
"RTN","RORX001",152,0)
 N CNT,I,RORBUF,RORMSG,RT,SRLTAG,TMP
"RTN","RORX001",153,0)
 ;--- Load the list of selection rules
"RTN","RORX001",154,0)
 D LIST^DIC(798.01,","_IENS,"@;.01I;1I",,,,,"B",,,"RORBUF","RORMSG")
"RTN","RORX001",155,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.01,IENS)
"RTN","RORX001",156,0)
 ;--- The <SELRULES> ... </SELRULES> tags
"RTN","RORX001",157,0)
 S SRLTAG=$$ADDVAL^RORTSK11(RORTSK,"SELRULES",,PARTAG)
"RTN","RORX001",158,0)
 ;--- Add the selection rules to the report
"RTN","RORX001",159,0)
 S I="",CNT=0
"RTN","RORX001",160,0)
 F  S I=$O(RORBUF("DILIST","ID",I))  Q:I=""  D
"RTN","RORX001",161,0)
 . S RT=$$ADDVAL^RORTSK11(RORTSK,"RULE",,SRLTAG),CNT=CNT+1
"RTN","RORX001",162,0)
 . S TMP=$G(RORBUF("DILIST","ID",I,.01))
"RTN","RORX001",163,0)
 . S TMP=$$GET1^DIQ(798.2,TMP_",",4,,,"RORMSG")
"RTN","RORX001",164,0)
 . Q:$G(DIERR)!(TMP="")
"RTN","RORX001",165,0)
 . D ADDATTR^RORTSK11(RORTSK,RT,"DESCR",TMP)
"RTN","RORX001",166,0)
 . S TMP=$$DATE^RORXU002($G(RORBUF("DILIST","ID",I,1))\1)
"RTN","RORX001",167,0)
 . D:TMP'="" ADDATTR^RORTSK11(RORTSK,RT,"DATE",TMP)
"RTN","RORX001",168,0)
 ;--- Add the default item if no selection rules have been found
"RTN","RORX001",169,0)
 D:CNT'>0
"RTN","RORX001",170,0)
 . S RT=$$ADDVAL^RORTSK11(RORTSK,"RULE",,SRLTAG)
"RTN","RORX001",171,0)
 . D ADDATTR^RORTSK11(RORTSK,RT,"DESCR","Manual Entry")
"RTN","RORX001",172,0)
 Q 0
"RTN","RORX002")
0^164^B20408394
"RTN","RORX002",1,0)
RORX002 ;HCIOFO/SG - CURRENT INPATIENT LIST ; 12/15/05 12:05pm
"RTN","RORX002",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX002",3,0)
 ;
"RTN","RORX002",4,0)
 ; This routine uses the following IAs:
"RTN","RORX002",5,0)
 ;
"RTN","RORX002",6,0)
 ; #325          ADM^VADPT2 (controlled)
"RTN","RORX002",7,0)
 ; #10061        51^VADPT (supported)
"RTN","RORX002",8,0)
 ;
"RTN","RORX002",9,0)
 Q
"RTN","RORX002",10,0)
 ;
"RTN","RORX002",11,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX002",12,0)
 ;
"RTN","RORX002",13,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX002",14,0)
 ;
"RTN","RORX002",15,0)
 ; Return Values:
"RTN","RORX002",16,0)
 ;       <0  Error code
"RTN","RORX002",17,0)
 ;        0  Ok
"RTN","RORX002",18,0)
 ;
"RTN","RORX002",19,0)
HEADER(PARTAG) ;
"RTN","RORX002",20,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,WARD,ROOM-BED)
"RTN","RORX002",21,0)
 ;
"RTN","RORX002",22,0)
 N HEADER,RC
"RTN","RORX002",23,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX002",24,0)
 Q:HEADER<0 HEADER
"RTN","RORX002",25,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX002",HEADER)
"RTN","RORX002",26,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX002",27,0)
 ;
"RTN","RORX002",28,0)
 ;***** COMPILES THE "CURRENT INPATIENT LIST"
"RTN","RORX002",29,0)
 ; REPORT CODE: 002
"RTN","RORX002",30,0)
 ;
"RTN","RORX002",31,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX002",32,0)
 ;
"RTN","RORX002",33,0)
 ; Return Values:
"RTN","RORX002",34,0)
 ;       <0  Error code
"RTN","RORX002",35,0)
 ;        0  Ok
"RTN","RORX002",36,0)
 ;
"RTN","RORX002",37,0)
INPTLST(RORTSK) ;
"RTN","RORX002",38,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX002",39,0)
 N RORREG        ; Registry IEN
"RTN","RORX002",40,0)
 N RORTMP        ; Closed root of the temporary buffer
"RTN","RORX002",41,0)
 ;
"RTN","RORX002",42,0)
 N BODY,ECNT,INPCNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX002",43,0)
 ;--- Root node of the report
"RTN","RORX002",44,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX002",45,0)
 Q:REPORT<0 REPORT
"RTN","RORX002",46,0)
 ;
"RTN","RORX002",47,0)
 ;--- Get and prepare the report parameters
"RTN","RORX002",48,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX002",49,0)
 S RC=$$PARAMS^RORXU002(.RORTSK,REPORT,,,.SFLAGS)  Q:RC<0 RC
"RTN","RORX002",50,0)
 ;
"RTN","RORX002",51,0)
 ;--- Initialize constants and variables
"RTN","RORX002",52,0)
 S ECNT=0
"RTN","RORX002",53,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX002",54,0)
 ;
"RTN","RORX002",55,0)
 ;--- Report header
"RTN","RORX002",56,0)
 S RC=$$HEADER(REPORT)  Q:RC<0 RC
"RTN","RORX002",57,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORX002",58,0)
 D
"RTN","RORX002",59,0)
 . ;--- Query the registry
"RTN","RORX002",60,0)
 . D TPPSETUP^RORTSK01(50)
"RTN","RORX002",61,0)
 . S RC=$$QUERY(.INPCNT,SFLAGS)
"RTN","RORX002",62,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX002",63,0)
 . ;--- Generate the list of patients
"RTN","RORX002",64,0)
 . D TPPSETUP^RORTSK01(50)
"RTN","RORX002",65,0)
 . S RC=$$PTLIST(REPORT,INPCNT)
"RTN","RORX002",66,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX002",67,0)
 ;
"RTN","RORX002",68,0)
 ;--- Cleanup
"RTN","RORX002",69,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORX002",70,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX002",71,0)
 ;
"RTN","RORX002",72,0)
 ;***** ADDS THE PATIENT DATA TO THE REPORT
"RTN","RORX002",73,0)
 ;
"RTN","RORX002",74,0)
 ; NODE          Closed root of the patient's node in the buffer
"RTN","RORX002",75,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX002",76,0)
 ;
"RTN","RORX002",77,0)
 ; Return Values:
"RTN","RORX002",78,0)
 ;       <0  Error code
"RTN","RORX002",79,0)
 ;        0  Ok
"RTN","RORX002",80,0)
 ;
"RTN","RORX002",81,0)
PATIENT(NODE,PARTAG) ;
"RTN","RORX002",82,0)
 N IEN,NAME,PATIEN,PTAG,PTBUF,RC,TMP
"RTN","RORX002",83,0)
 S PTBUF=@NODE,PATIEN=$P(PTBUF,U,2)
"RTN","RORX002",84,0)
 Q:PATIEN'>0 0
"RTN","RORX002",85,0)
 ;--- The <PATIENT> tag
"RTN","RORX002",86,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PARTAG,,PATIEN)
"RTN","RORX002",87,0)
 ;--- Patient data
"RTN","RORX002",88,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",$QS(NODE,4),PTAG,1)
"RTN","RORX002",89,0)
 D ADDVAL^RORTSK11(RORTSK,"LAST4",$QS(NODE,5),PTAG,2)
"RTN","RORX002",90,0)
 S TMP=$$DATE^RORXU002($P(PTBUF,U,4)\1)
"RTN","RORX002",91,0)
 D ADDVAL^RORTSK11(RORTSK,"DOD",TMP,PTAG,1)
"RTN","RORX002",92,0)
 D ADDVAL^RORTSK11(RORTSK,"WARD",$QS(NODE,3),PTAG,1)
"RTN","RORX002",93,0)
 D ADDVAL^RORTSK11(RORTSK,"ROOM-BED",$P(PTBUF,U,3),PTAG,1)
"RTN","RORX002",94,0)
 Q 0
"RTN","RORX002",95,0)
 ;
"RTN","RORX002",96,0)
 ;***** GENERATES THE LIST OF PATIENTS
"RTN","RORX002",97,0)
 ;
"RTN","RORX002",98,0)
 ; REPORT        IEN of the <REPORT> node
"RTN","RORX002",99,0)
 ; INPCNT        Number of inpatients
"RTN","RORX002",100,0)
 ;
"RTN","RORX002",101,0)
 ; Return Values:
"RTN","RORX002",102,0)
 ;       <0  Error code
"RTN","RORX002",103,0)
 ;        0  Ok
"RTN","RORX002",104,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX002",105,0)
 ;
"RTN","RORX002",106,0)
PTLIST(REPORT,INPCNT) ;
"RTN","RORX002",107,0)
 N BODY,CNT,ECNT,FLT,FLTLEN,NODE,RC,TCNT,TMP
"RTN","RORX002",108,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX002",109,0)
 S BODY=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX002",110,0)
 Q:BODY<0 BODY
"RTN","RORX002",111,0)
 D ADDATTR^RORTSK11(RORTSK,BODY,"TABLE","PATIENTS")
"RTN","RORX002",112,0)
 D:$D(@RORTMP)>1
"RTN","RORX002",113,0)
 . S NODE=RORTMP
"RTN","RORX002",114,0)
 . S FLTLEN=$L(NODE)-1,FLT=$E(NODE,1,FLTLEN)
"RTN","RORX002",115,0)
 . F  S NODE=$Q(@NODE)  Q:$E(NODE,1,FLTLEN)'=FLT  D  Q:RC<0
"RTN","RORX002",116,0)
 . . S TMP=$S(INPCNT>0:CNT/INPCNT,1:"")
"RTN","RORX002",117,0)
 . . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX002",118,0)
 . . S CNT=CNT+1
"RTN","RORX002",119,0)
 . . I $$PATIENT(NODE,BODY)<0  S ECNT=ECNT+1  Q
"RTN","RORX002",120,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX002",121,0)
 ;
"RTN","RORX002",122,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX002",123,0)
 ;
"RTN","RORX002",124,0)
 ; .INPCNT       Number of inpatients is returned in this parameter
"RTN","RORX002",125,0)
 ; SFLAGS        Flags for $$SKIP^RORXU005
"RTN","RORX002",126,0)
 ;
"RTN","RORX002",127,0)
 ; Return Values:
"RTN","RORX002",128,0)
 ;       <0  Error code
"RTN","RORX002",129,0)
 ;        0  Ok
"RTN","RORX002",130,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX002",131,0)
 ;
"RTN","RORX002",132,0)
QUERY(INPCNT,SFLAGS) ;
"RTN","RORX002",133,0)
 N CNT,DFN,ECNT,IEN,IENS,RC,TCNT,TMP,VA,VADM,VAHOW,VAIP,VAROOT,XREFNODE,WARD
"RTN","RORX002",134,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX002",135,0)
 S (CNT,ECNT,INPCNT,RC)=0
"RTN","RORX002",136,0)
 ;--- Browse through the registry records
"RTN","RORX002",137,0)
 S IEN=0
"RTN","RORX002",138,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX002",139,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX002",140,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX002",141,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX002",142,0)
 . ;--- Skip a patient
"RTN","RORX002",143,0)
 . Q:$$SKIP^RORXU005(IEN,SFLAGS)
"RTN","RORX002",144,0)
 . ;--- Process the registry record
"RTN","RORX002",145,0)
 . S DFN=$$PTIEN^RORUTL01(IEN)  Q:DFN'>0
"RTN","RORX002",146,0)
 . K VA,VADM,VAIP  S VAIP("D")=DT\1  D 51^VADPT
"RTN","RORX002",147,0)
 . S WARD=$P(VAIP(5),U,2)  Q:WARD=""
"RTN","RORX002",148,0)
 . S TMP=$S($G(VA("BID"))'="":VA("BID"),1:"UNKN") ; Last 4 of SSN
"RTN","RORX002",149,0)
 . S @RORTMP@(WARD,VADM(1),TMP)=IEN_U_DFN_U_$P(VAIP(6),U,2)_U_$P(VADM(6),U)
"RTN","RORX002",150,0)
 . S INPCNT=INPCNT+1
"RTN","RORX002",151,0)
 ;---
"RTN","RORX002",152,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX002",153,0)
 ;
"RTN","RORX002",154,0)
 ;***** CHECKS THE SUFFIX FOR VALIDITY
"RTN","RORX002",155,0)
 ;
"RTN","RORX002",156,0)
 ; SUFFIX        Suffix
"RTN","RORX002",157,0)
 ;
"RTN","RORX002",158,0)
 ; Return Values:
"RTN","RORX002",159,0)
 ;        0  Ok
"RTN","RORX002",160,0)
 ;        1  Invalid suffix
"RTN","RORX002",161,0)
VSUFFIX(SUFFIX) ;
"RTN","RORX002",162,0)
 Q '("9AA,9AB,9BB,A0,A4,A5,BU,BV,PA"[SUFFIX)
"RTN","RORX003")
0^165^B21537399
"RTN","RORX003",1,0)
RORX003 ;HCIOFO/SG - GENERAL UTLIZATION AND DEMOGRAPHICS ; 1/24/06 7:46am
"RTN","RORX003",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX003",3,0)
 ;
"RTN","RORX003",4,0)
 Q
"RTN","RORX003",5,0)
 ;
"RTN","RORX003",6,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX003",7,0)
 ;
"RTN","RORX003",8,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX003",9,0)
 ;
"RTN","RORX003",10,0)
 ; Return Values:
"RTN","RORX003",11,0)
 ;       <0  Error code
"RTN","RORX003",12,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX003",13,0)
 ;
"RTN","RORX003",14,0)
HEADER(PARTAG) ;
"RTN","RORX003",15,0)
 N COLUMNS,HEADER,NAME,NOTES,TMP
"RTN","RORX003",16,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX003",17,0)
 Q:HEADER<0 HEADER
"RTN","RORX003",18,0)
 S NOTES=$$ADDVAL^RORTSK11(RORTSK,"NOTES",,HEADER)
"RTN","RORX003",19,0)
 D ADDVAL^RORTSK11(RORTSK,"AGE_BASE_DATE",RORAGEDT,NOTES)
"RTN","RORX003",20,0)
 ;---
"RTN","RORX003",21,0)
 S COLUMNS=$$ADDVAL^RORTSK11(RORTSK,"TBLDEF",,HEADER)
"RTN","RORX003",22,0)
 Q:COLUMNS<0 COLUMNS
"RTN","RORX003",23,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"HEADER","1")
"RTN","RORX003",24,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"FOOTER","1")
"RTN","RORX003",25,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"NAME","PATIENTS")
"RTN","RORX003",26,0)
 S RORFL798=".01",RORFLICR=""
"RTN","RORX003",27,0)
 ;--- Required columns
"RTN","RORX003",28,0)
 F NAME="#","NAME"  D
"RTN","RORX003",29,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX003",30,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",NAME)
"RTN","RORX003",31,0)
 ;--- SSN or LAST4
"RTN","RORX003",32,0)
 S NAME=$S($$OPTCOL^RORXU006("SSN"):"SSN",1:"LAST4")
"RTN","RORX003",33,0)
 S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)  Q:TMP<0 TMP
"RTN","RORX003",34,0)
 D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",NAME)
"RTN","RORX003",35,0)
 ;--- Optional columns
"RTN","RORX003",36,0)
 F NAME="DOB","AGE","SEX","RACE","ETHN","RISK","SELDT","CONFDT","UTIL","DOD"  D
"RTN","RORX003",37,0)
 . Q:'$$OPTCOL^RORXU006(NAME)
"RTN","RORX003",38,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX003",39,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",NAME)
"RTN","RORX003",40,0)
 ;---
"RTN","RORX003",41,0)
 S:$$OPTCOL^RORXU006("CONFDT") RORFL798=RORFL798_";2"
"RTN","RORX003",42,0)
 S:$$OPTCOL^RORXU006("SELDT") RORFL798=RORFL798_";3.2"
"RTN","RORX003",43,0)
 Q HEADER
"RTN","RORX003",44,0)
 ;
"RTN","RORX003",45,0)
 ;***** COMPILES THE "GENERAL UTLIZATION AND DEMOGRAPHICS" REPORT
"RTN","RORX003",46,0)
 ; REPORT CODE: 003
"RTN","RORX003",47,0)
 ;
"RTN","RORX003",48,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX003",49,0)
 ;
"RTN","RORX003",50,0)
 ; Return Values:
"RTN","RORX003",51,0)
 ;       <0  Error code
"RTN","RORX003",52,0)
 ;        0  Ok
"RTN","RORX003",53,0)
 ;
"RTN","RORX003",54,0)
UTLDMG(RORTSK) ;
"RTN","RORX003",55,0)
 N RORAGEDT      ; Base date for age calculations
"RTN","RORX003",56,0)
 N RORDTE0       ; Beginning of the Date Entered "sliding window"
"RTN","RORX003",57,0)
 N ROREDT        ; End date
"RTN","RORX003",58,0)
 N RORFL798      ; Fields to load from the file #798
"RTN","RORX003",59,0)
 N RORFLICR      ; Fields to load from the file #799.4
"RTN","RORX003",60,0)
 N RORREG        ; Registry IEN
"RTN","RORX003",61,0)
 N RORRISK       ; Risk factor counters
"RTN","RORX003",62,0)
 N RORSDT        ; Start date
"RTN","RORX003",63,0)
 N RORSUM        ; Summary data
"RTN","RORX003",64,0)
 N RORUTIL       ; Requested utilization types
"RTN","RORX003",65,0)
 N RORUCNT       ; Utilization counters
"RTN","RORX003",66,0)
 ;
"RTN","RORX003",67,0)
 N CNT,ECNT,IEN,IENS,PARAMS,PATIENTS,RC,REPORT,RORPTN,SFLAGS,TMP,XREFNODE
"RTN","RORX003",68,0)
 ;--- Root node of the report
"RTN","RORX003",69,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX003",70,0)
 Q:REPORT<0 REPORT
"RTN","RORX003",71,0)
 ;
"RTN","RORX003",72,0)
 ;=== Get and prepare the report parameters
"RTN","RORX003",73,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX003",74,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,REPORT,.RORSDT,.ROREDT,.SFLAGS)
"RTN","RORX003",75,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX003",76,0)
 ;--- Default set of columns for the summary-only report
"RTN","RORX003",77,0)
 S XREFNODE=$NA(RORTSK("PARAMS","OPTIONAL_COLUMNS","C"))
"RTN","RORX003",78,0)
 I $$PARAM^RORTSK01("OPTIONS","SUMMARY")  D
"RTN","RORX003",79,0)
 . F TMP="RACE","RISK","AGE","SEX","UTIL"  D
"RTN","RORX003",80,0)
 . . S @XREFNODE@(TMP)=""
"RTN","RORX003",81,0)
 S:$$OPTCOL^RORXU006("RACE") @XREFNODE@("ETHN")=""
"RTN","RORX003",82,0)
 ;--- Construct the description of utilization types
"RTN","RORX003",83,0)
 I '$$PARAM^RORTSK01("UTIL_TYPES","ALL")  D
"RTN","RORX003",84,0)
 . M RORUTIL=RORTSK("PARAMS","UTIL_TYPES","C")
"RTN","RORX003",85,0)
 E  S RORUTIL("ALL")=1
"RTN","RORX003",86,0)
 S TMP=$$OPTXT^RORXU002(.RORUTIL,7980000.019)
"RTN","RORX003",87,0)
 D ADDVAL^RORTSK11(RORTSK,"UTIL_TYPES",TMP,PARAMS)
"RTN","RORX003",88,0)
 ;
"RTN","RORX003",89,0)
 ;=== Initialize constants and variables
"RTN","RORX003",90,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX003",91,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",RORREG)),ECNT=0
"RTN","RORX003",92,0)
 S TMP=$$FMDIFF^XLFDT(ROREDT,RORSDT)
"RTN","RORX003",93,0)
 S RORAGEDT=$$FMADD^XLFDT(RORSDT,TMP\2)
"RTN","RORX003",94,0)
 S RORDTE0=$P($$FMTE^XLFDT(DT,7),"/")-10  ; 10 year "sliding window"
"RTN","RORX003",95,0)
 ;
"RTN","RORX003",96,0)
 D
"RTN","RORX003",97,0)
 . ;=== Report header
"RTN","RORX003",98,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX003",99,0)
 . ;---
"RTN","RORX003",100,0)
 . S PATIENTS=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX003",101,0)
 . I PATIENTS<0  S RC=+PATIENTS  Q
"RTN","RORX003",102,0)
 . D ADDATTR^RORTSK11(RORTSK,PATIENTS,"TABLE","PATIENTS")
"RTN","RORX003",103,0)
 . ;=== Browse through the registry records
"RTN","RORX003",104,0)
 . D TPPSETUP^RORTSK01(95)
"RTN","RORX003",105,0)
 . S (CNT,IEN,RC)=0
"RTN","RORX003",106,0)
 . F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX003",107,0)
 . . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX003",108,0)
 . . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX003",109,0)
 . . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX003",110,0)
 . . ;--- Check if the patient should be skipped
"RTN","RORX003",111,0)
 . . Q:$$SKIP^RORXU005(IEN,SFLAGS,RORSDT,ROREDT)
"RTN","RORX003",112,0)
 . . ;--- Process the registry record
"RTN","RORX003",113,0)
 . . S TMP=$$PATIENT^RORX003A(IENS,PATIENTS)
"RTN","RORX003",114,0)
 . . I TMP<0  S ECNT=ECNT+1  Q
"RTN","RORX003",115,0)
 . Q:RC<0
"RTN","RORX003",116,0)
 . ;
"RTN","RORX003",117,0)
 . ;=== Report summary
"RTN","RORX003",118,0)
 . D TPPSETUP^RORTSK01(5)
"RTN","RORX003",119,0)
 . S RC=$$SUMMARY^RORX003A(REPORT,PATIENTS)  Q:RC<0
"RTN","RORX003",120,0)
 . ;
"RTN","RORX003",121,0)
 . ;=== Summary only
"RTN","RORX003",122,0)
 . S TMP=$$PARAM^RORTSK01("OPTIONS","COMPLETE")
"RTN","RORX003",123,0)
 . D:'TMP UPDVAL^RORTSK11(RORTSK,PATIENTS,,,1)
"RTN","RORX003",124,0)
 ;
"RTN","RORX003",125,0)
 ;=== Cleanup
"RTN","RORX003",126,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX003A")
0^166^B45547475
"RTN","RORX003A",1,0)
RORX003A ;HCIOFO/SG - GENERAL UTLIZATION AND DEMOGRAPHICS ; 9/12/05 8:38am
"RTN","RORX003A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX003A",3,0)
 ;
"RTN","RORX003A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX003A",5,0)
 ;
"RTN","RORX003A",6,0)
 ; #10061        2^VADPT (supported)
"RTN","RORX003A",7,0)
 ;
"RTN","RORX003A",8,0)
 Q
"RTN","RORX003A",9,0)
 ;
"RTN","RORX003A",10,0)
 ;***** INCREMENTS SUMMARY COUNTER
"RTN","RORX003A",11,0)
INCSUM(SUMMARY,VAL) ;
"RTN","RORX003A",12,0)
 S:$G(VAL)="" VAL="NO DATA"
"RTN","RORX003A",13,0)
 S RORSUM(SUMMARY,VAL)=$G(RORSUM(SUMMARY,VAL))+1
"RTN","RORX003A",14,0)
 Q
"RTN","RORX003A",15,0)
 ;
"RTN","RORX003A",16,0)
 ;***** ADDS THE PATIENT DATA TO THE REPORT
"RTN","RORX003A",17,0)
 ;
"RTN","RORX003A",18,0)
 ; IENS          IENS of the patient's record in the registry
"RTN","RORX003A",19,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX003A",20,0)
 ;
"RTN","RORX003A",21,0)
 ; Return Values:
"RTN","RORX003A",22,0)
 ;       <0  Error code
"RTN","RORX003A",23,0)
 ;        0  Ok
"RTN","RORX003A",24,0)
 ;       >0  Skip the patient
"RTN","RORX003A",25,0)
 ;
"RTN","RORX003A",26,0)
PATIENT(IENS,PARTAG) ;
"RTN","RORX003A",27,0)
 N DFN,IEN,NAME,RC,RORBUF,RORMSG,TMP,UTIL,VA,VADM,VAERR,VAHOW,VAPTYP,VAROOT
"RTN","RORX003A",28,0)
 S RC=0
"RTN","RORX003A",29,0)
 ;
"RTN","RORX003A",30,0)
 ;--- Get the data from the ROR REGISTRY RECORD file
"RTN","RORX003A",31,0)
 I $G(RORFL798)'=""  D  Q:RC<0 RC
"RTN","RORX003A",32,0)
 . D GETS^DIQ(798,IENS,RORFL798,"I","RORBUF","RORMSG")
"RTN","RORX003A",33,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","RORX003A",34,0)
 S DFN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","RORX003A",35,0)
 ;
"RTN","RORX003A",36,0)
 ;--- Skip a patient without utilization
"RTN","RORX003A",37,0)
 S UTIL=$$UTIL^RORXU003(RORSDT,ROREDT,DFN,.RORUTIL)
"RTN","RORX003A",38,0)
 Q:'UTIL 1
"RTN","RORX003A",39,0)
 ;
"RTN","RORX003A",40,0)
 ;--- Get the data from the ROR HIV STUDY file
"RTN","RORX003A",41,0)
 I $G(RORFLICR)'=""  D  Q:RC<0 RC
"RTN","RORX003A",42,0)
 . D GETS^DIQ(799.4,IENS,RORFLICR,"I","RORBUF","RORMSG")
"RTN","RORX003A",43,0)
 . I $G(DIERR),'$D(RORMSG("DIERR","E",601))  D  Q
"RTN","RORX003A",44,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,799.4,IENS)
"RTN","RORX003A",45,0)
 ;
"RTN","RORX003A",46,0)
 ;--- Load the demographic data
"RTN","RORX003A",47,0)
 D 2^VADPT
"RTN","RORX003A",48,0)
 ;
"RTN","RORX003A",49,0)
 ;--- The <PATIENT> tag
"RTN","RORX003A",50,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PARTAG,,DFN)
"RTN","RORX003A",51,0)
 Q:PTAG<0 PTAG  S RORSUM=$G(RORSUM)+1
"RTN","RORX003A",52,0)
 ;--- Patient Name
"RTN","RORX003A",53,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX003A",54,0)
 ;--- SSN or LAST4
"RTN","RORX003A",55,0)
 I $$OPTCOL^RORXU006("SSN")  D
"RTN","RORX003A",56,0)
 . D ADDVAL^RORTSK11(RORTSK,"SSN",$P(VADM(2),U),PTAG,2)
"RTN","RORX003A",57,0)
 E  D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG,2)
"RTN","RORX003A",58,0)
 ;
"RTN","RORX003A",59,0)
 ;--- Date of Birth
"RTN","RORX003A",60,0)
 D:$$OPTCOL^RORXU006("DOB")
"RTN","RORX003A",61,0)
 . S TMP=$$DATE^RORXU002(VADM(3)\1)
"RTN","RORX003A",62,0)
 . D ADDVAL^RORTSK11(RORTSK,"DOB",TMP,PTAG,1)
"RTN","RORX003A",63,0)
 . S TMP=$P($$FMTE^XLFDT(TMP,7),"/")
"RTN","RORX003A",64,0)
 . D INCSUM("DOB",$S(TMP'<RORDTE0:TMP,TMP>0:0,1:""))
"RTN","RORX003A",65,0)
 ;
"RTN","RORX003A",66,0)
 ;--- Age
"RTN","RORX003A",67,0)
 D:$$OPTCOL^RORXU006("AGE")
"RTN","RORX003A",68,0)
 . S TMP=+$G(VADM(6))  ; Date of Death
"RTN","RORX003A",69,0)
 . S TMP=$S(TMP'>0:RORAGEDT,TMP<RORAGEDT:TMP,1:RORAGEDT)
"RTN","RORX003A",70,0)
 . S TMP=$$FMDIFF^XLFDT(TMP,+VADM(3))\365
"RTN","RORX003A",71,0)
 . D ADDVAL^RORTSK11(RORTSK,"AGE",$S(TMP>0:TMP,1:""),PTAG,1)
"RTN","RORX003A",72,0)
 . Q:TMP'>0
"RTN","RORX003A",73,0)
 . S RORSUM("AGE")=$G(RORSUM("AGE"))+1
"RTN","RORX003A",74,0)
 . S RORSUM("AGE","Average")=$G(RORSUM("AGE","Average"))+TMP
"RTN","RORX003A",75,0)
 . D INCSUM("AGE",TMP-(TMP#10))
"RTN","RORX003A",76,0)
 ;
"RTN","RORX003A",77,0)
 ;--- Sex
"RTN","RORX003A",78,0)
 D:$$OPTCOL^RORXU006("SEX")
"RTN","RORX003A",79,0)
 . S TMP=$P(VADM(5),U,2)
"RTN","RORX003A",80,0)
 . D ADDVAL^RORTSK11(RORTSK,"SEX",TMP,PTAG,1)
"RTN","RORX003A",81,0)
 . D INCSUM("SEX",TMP)
"RTN","RORX003A",82,0)
 ;
"RTN","RORX003A",83,0)
 ;--- Race
"RTN","RORX003A",84,0)
 D:$$OPTCOL^RORXU006("RACE")
"RTN","RORX003A",85,0)
 . N I,SUMVAL,TABLE
"RTN","RORX003A",86,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"RACES",,PTAG)
"RTN","RORX003A",87,0)
 . I $G(VADM(12))>0  S I=""  D
"RTN","RORX003A",88,0)
 . . F  S I=$O(VADM(12,I))  Q:I=""  D
"RTN","RORX003A",89,0)
 . . . S SUMVAL=$P(VADM(12,I),U,2)
"RTN","RORX003A",90,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"RACE",SUMVAL,TABLE)
"RTN","RORX003A",91,0)
 . . S:VADM(12)>1 SUMVAL="MULTIPLE VALUES"
"RTN","RORX003A",92,0)
 . E  D ADDVAL^RORTSK11(RORTSK,"RACE",,TABLE)
"RTN","RORX003A",93,0)
 . D INCSUM("RACE",$G(SUMVAL))
"RTN","RORX003A",94,0)
 ;
"RTN","RORX003A",95,0)
 ;--- Ethnicity
"RTN","RORX003A",96,0)
 D:$$OPTCOL^RORXU006("RACE")
"RTN","RORX003A",97,0)
 . N I,SUMVAL,TABLE
"RTN","RORX003A",98,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"ETHNS",,PTAG)
"RTN","RORX003A",99,0)
 . I $G(VADM(11))>0  S I=""  D
"RTN","RORX003A",100,0)
 . . F  S I=$O(VADM(11,I))  Q:I=""  D
"RTN","RORX003A",101,0)
 . . . S SUMVAL=$P(VADM(11,I),U,2)
"RTN","RORX003A",102,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"ETHN",SUMVAL,TABLE)
"RTN","RORX003A",103,0)
 . . S:VADM(11)>1 SUMVAL="MULTIPLE VALUES"
"RTN","RORX003A",104,0)
 . E  D ADDVAL^RORTSK11(RORTSK,"ETHN",,TABLE)
"RTN","RORX003A",105,0)
 . D INCSUM("ETHN",$G(SUMVAL))
"RTN","RORX003A",106,0)
 ;
"RTN","RORX003A",107,0)
 ;--- Risk factors
"RTN","RORX003A",108,0)
 D:$$OPTCOL^RORXU006("RISK")
"RTN","RORX003A",109,0)
 . N I,RISKS
"RTN","RORX003A",110,0)
 . S RISKS=$$RISKS^RORXU005(+IENS)  S:RISKS<0 RISKS=""
"RTN","RORX003A",111,0)
 . D ADDVAL^RORTSK11(RORTSK,"RISK",RISKS,PTAG)
"RTN","RORX003A",112,0)
 . S RISKS=$TR(RISKS," ")
"RTN","RORX003A",113,0)
 . F I=1:1  S TMP=$P(RISKS,",",I)  Q:TMP'>0  D
"RTN","RORX003A",114,0)
 . . S RORRISK(TMP)=$G(RORRISK(TMP))+1
"RTN","RORX003A",115,0)
 ;
"RTN","RORX003A",116,0)
 ;--- Date Selected
"RTN","RORX003A",117,0)
 D:$$OPTCOL^RORXU006("SELDT")
"RTN","RORX003A",118,0)
 . S TMP=$$DATE^RORXU002($G(RORBUF(798,IENS,3.2,"I"))\1)
"RTN","RORX003A",119,0)
 . D ADDVAL^RORTSK11(RORTSK,"SELDT",TMP,PTAG,1)
"RTN","RORX003A",120,0)
 . S TMP=$P($$FMTE^XLFDT(TMP,7),"/")
"RTN","RORX003A",121,0)
 . D INCSUM("SELDT",$S(TMP'<RORDTE0:TMP,TMP>0:0,1:""))
"RTN","RORX003A",122,0)
 ;
"RTN","RORX003A",123,0)
 ;--- Date Confirmed
"RTN","RORX003A",124,0)
 D:$$OPTCOL^RORXU006("CONFDT")
"RTN","RORX003A",125,0)
 . S TMP=$$DATE^RORXU002($G(RORBUF(798,IENS,2,"I"))\1)
"RTN","RORX003A",126,0)
 . D ADDVAL^RORTSK11(RORTSK,"CONFDT",TMP,PTAG,1)
"RTN","RORX003A",127,0)
 . S TMP=$P($$FMTE^XLFDT(TMP,7),"/")
"RTN","RORX003A",128,0)
 . D INCSUM("CONFDT",$S(TMP'<RORDTE0:TMP,TMP>0:0,1:""))
"RTN","RORX003A",129,0)
 ;
"RTN","RORX003A",130,0)
 ;--- Utilization
"RTN","RORX003A",131,0)
 D:$$OPTCOL^RORXU006("UTIL")
"RTN","RORX003A",132,0)
 . S TMP=$$UTLCODES($P(UTIL,U,2,999))
"RTN","RORX003A",133,0)
 . D ADDVAL^RORTSK11(RORTSK,"UTIL",TMP,PTAG)
"RTN","RORX003A",134,0)
 ;
"RTN","RORX003A",135,0)
 ;--- Date of Death
"RTN","RORX003A",136,0)
 D:$$OPTCOL^RORXU006("DOD")
"RTN","RORX003A",137,0)
 . S TMP=$$DATE^RORXU002(VADM(6)\1)
"RTN","RORX003A",138,0)
 . D ADDVAL^RORTSK11(RORTSK,"DOD",TMP,PTAG,1)
"RTN","RORX003A",139,0)
 . S TMP=$P($$FMTE^XLFDT(TMP,7),"/")
"RTN","RORX003A",140,0)
 . D INCSUM("DOD",$S(TMP'<RORDTE0:TMP,TMP>0:0,1:""))
"RTN","RORX003A",141,0)
 Q 0
"RTN","RORX003A",142,0)
 ;
"RTN","RORX003A",143,0)
 ;***** GENERATES THE REPORT SUMMARY
"RTN","RORX003A",144,0)
 ;
"RTN","RORX003A",145,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX003A",146,0)
 ;
"RTN","RORX003A",147,0)
 ; PATIENTS      Reference (IEN) to the PATIENTS tag
"RTN","RORX003A",148,0)
 ;
"RTN","RORX003A",149,0)
 ; Return Values:
"RTN","RORX003A",150,0)
 ;       <0  Error code
"RTN","RORX003A",151,0)
 ;        0  Ok
"RTN","RORX003A",152,0)
 ;
"RTN","RORX003A",153,0)
SUMMARY(PARTAG,PATIENTS) ;
"RTN","RORX003A",154,0)
 N AGE,I,RC,RORBUF,SI,SUMMARY,TABLE,TAG,TMP
"RTN","RORX003A",155,0)
 S SUMMARY=$$ADDVAL^RORTSK11(RORTSK,"SUMMARY",,PARTAG)
"RTN","RORX003A",156,0)
 Q:SUMMARY<0 SUMMARY
"RTN","RORX003A",157,0)
 ;
"RTN","RORX003A",158,0)
 ;--- Risk factors
"RTN","RORX003A",159,0)
 D:$D(RORRISK)>1
"RTN","RORX003A",160,0)
 . K RORBUF  D BLD^DIALOG(7980000.016,.RORRISK,,"RORBUF")
"RTN","RORX003A",161,0)
 . D ADDTEXT^RORTSK11(RORTSK,"RISK_FACTORS",.RORBUF,SUMMARY)
"RTN","RORX003A",162,0)
 ;
"RTN","RORX003A",163,0)
 ;--- Simple summaries
"RTN","RORX003A",164,0)
 F SI="RACE","ETHN","SEX"  D:$D(RORSUM(SI))>1
"RTN","RORX003A",165,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,SI_"_SUMMARY",,SUMMARY)
"RTN","RORX003A",166,0)
 . S I=""
"RTN","RORX003A",167,0)
 . F  S I=$O(RORSUM(SI,I))  Q:I=""  D
"RTN","RORX003A",168,0)
 . . S TAG=$$ADDVAL^RORTSK11(RORTSK,SI,I,TABLE)
"RTN","RORX003A",169,0)
 . . D ADDATTR^RORTSK11(RORTSK,TAG,"COUNT",RORSUM(SI,I))
"RTN","RORX003A",170,0)
 ;
"RTN","RORX003A",171,0)
 ;--- Date summaries
"RTN","RORX003A",172,0)
 F SI="DOB","DOD","CONFDT","SELDT"  D:$D(RORSUM(SI))>1
"RTN","RORX003A",173,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,SI_"_SUMMARY",,SUMMARY)
"RTN","RORX003A",174,0)
 . D:$G(RORSUM(SI,0))>0
"RTN","RORX003A",175,0)
 . . S TAG=$$ADDVAL^RORTSK11(RORTSK,SI,"Before "_RORDTE0,TABLE)
"RTN","RORX003A",176,0)
 . . D ADDATTR^RORTSK11(RORTSK,TAG,"COUNT",RORSUM(SI,0))
"RTN","RORX003A",177,0)
 . S I=0
"RTN","RORX003A",178,0)
 . F  S I=$O(RORSUM(SI,I))  Q:I=""  D
"RTN","RORX003A",179,0)
 . . S TAG=$$ADDVAL^RORTSK11(RORTSK,SI,I,TABLE)
"RTN","RORX003A",180,0)
 . . D ADDATTR^RORTSK11(RORTSK,TAG,"COUNT",RORSUM(SI,I))
"RTN","RORX003A",181,0)
 ;
"RTN","RORX003A",182,0)
 ;--- Age summary
"RTN","RORX003A",183,0)
 I $G(RORSUM("AGE"))>0  D
"RTN","RORX003A",184,0)
 . ;--- Average age
"RTN","RORX003A",185,0)
 . S TMP=$G(RORSUM("AGE","Average"))/RORSUM("AGE")
"RTN","RORX003A",186,0)
 . S RORSUM("AGE","Average")=$J(TMP,0,2)
"RTN","RORX003A",187,0)
 . ;--- Median age
"RTN","RORX003A",188,0)
 . S TMP=$$XREFNODE^RORTSK10(RORTSK,PATIENTS,"AGE")
"RTN","RORX003A",189,0)
 . S:TMP'="" TMP=$$XREFMDNV^RORXU004(TMP,RORSUM("AGE"))
"RTN","RORX003A",190,0)
 . S RORSUM("AGE","Median")=$S(TMP'="":$J(TMP,0,2),1:"")
"RTN","RORX003A",191,0)
 . ;--- Output the table
"RTN","RORX003A",192,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"AGE_SUMMARY",,SUMMARY)
"RTN","RORX003A",193,0)
 . S I=""
"RTN","RORX003A",194,0)
 . F  S I=$O(RORSUM("AGE",I))  Q:I=""  D
"RTN","RORX003A",195,0)
 . . S TAG=$$ADDVAL^RORTSK11(RORTSK,"AGE",$S(+I=I:I_"+",1:I),TABLE)
"RTN","RORX003A",196,0)
 . . D ADDATTR^RORTSK11(RORTSK,TAG,"COUNT",RORSUM("AGE",I))
"RTN","RORX003A",197,0)
 ;
"RTN","RORX003A",198,0)
 ;--- Utilization codes
"RTN","RORX003A",199,0)
 D:$D(RORUCNT)>1
"RTN","RORX003A",200,0)
 . K RORBUF  D BLD^DIALOG(7980000.017,.RORUCNT,,"RORBUF")
"RTN","RORX003A",201,0)
 . D ADDTEXT^RORTSK11(RORTSK,"UTIL_CODES",.RORBUF,SUMMARY)
"RTN","RORX003A",202,0)
 ;---
"RTN","RORX003A",203,0)
 Q 0
"RTN","RORX003A",204,0)
 ;
"RTN","RORX003A",205,0)
 ;***** PROCESSES UTILIZATION CODES
"RTN","RORX003A",206,0)
UTLCODES(UCSRC) ;
"RTN","RORX003A",207,0)
 N I,UCLST  S UCLST=""
"RTN","RORX003A",208,0)
 F I=1:1  S UC=$P(UCSRC,U,I)  Q:UC=""  D
"RTN","RORX003A",209,0)
 . S UCLST=UCLST_", "_UC,RORUCNT(UC)=$G(RORUCNT(UC))+1
"RTN","RORX003A",210,0)
 Q $P(UCLST,", ",2,999)
"RTN","RORX004")
0^167^B15147784
"RTN","RORX004",1,0)
RORX004 ;HOIFO/BH,SG - CLINIC FOLLOW UP ; 11/15/05 8:50am
"RTN","RORX004",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX004",3,0)
 ;
"RTN","RORX004",4,0)
 ; This routine uses the following IAs:
"RTN","RORX004",5,0)
 ;
"RTN","RORX004",6,0)
 ; #10040        Access to the HOSPITAL LOCATION file (supported)
"RTN","RORX004",7,0)
 ; #10061        2^VADPT (supported)
"RTN","RORX004",8,0)
 ;
"RTN","RORX004",9,0)
 Q
"RTN","RORX004",10,0)
 ;
"RTN","RORX004",11,0)
 ;***** COMPILES THE "CLINIC FOLLOW UP" REPORT
"RTN","RORX004",12,0)
 ; REPORT CODE: 004
"RTN","RORX004",13,0)
 ;
"RTN","RORX004",14,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX004",15,0)
 ;
"RTN","RORX004",16,0)
 ; Return Values:
"RTN","RORX004",17,0)
 ;       <0  Error code
"RTN","RORX004",18,0)
 ;        0  Ok
"RTN","RORX004",19,0)
 ;
"RTN","RORX004",20,0)
CLNFLWUP(RORTSK) ;
"RTN","RORX004",21,0)
 N ROREDT        ; End date
"RTN","RORX004",22,0)
 N RORREG        ; Registry IEN
"RTN","RORX004",23,0)
 N RORSDT        ; Start date
"RTN","RORX004",24,0)
 ;
"RTN","RORX004",25,0)
 N CNT,ECNT,IEN,IENS,PATIENTS,RC,REPORT,RORPTN,SFLAGS,TMP,XREFNODE
"RTN","RORX004",26,0)
 ;--- Root node of the report
"RTN","RORX004",27,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX004",28,0)
 Q:REPORT<0 REPORT
"RTN","RORX004",29,0)
 ;
"RTN","RORX004",30,0)
 ;--- Get and prepare the report parameters
"RTN","RORX004",31,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX004",32,0)
 S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)
"RTN","RORX004",33,0)
 Q:RC<0 RC
"RTN","RORX004",34,0)
 ;
"RTN","RORX004",35,0)
 ;--- Initialize constants and variables
"RTN","RORX004",36,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX004",37,0)
 S ECNT=0,XREFNODE=$NA(^RORDATA(798,"AC",RORREG))
"RTN","RORX004",38,0)
 ;
"RTN","RORX004",39,0)
 D
"RTN","RORX004",40,0)
 . ;--- Report header
"RTN","RORX004",41,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX004",42,0)
 . S PATIENTS=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX004",43,0)
 . I PATIENTS<0  S RC=+PATIENTS  Q
"RTN","RORX004",44,0)
 . D ADDATTR^RORTSK11(RORTSK,PATIENTS,"TABLE","PATIENTS")
"RTN","RORX004",45,0)
 . ;
"RTN","RORX004",46,0)
 . ;--- Browse through the registry records
"RTN","RORX004",47,0)
 . D TPPSETUP^RORTSK01(100)
"RTN","RORX004",48,0)
 . S (CNT,IEN,RC)=0
"RTN","RORX004",49,0)
 . F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX004",50,0)
 . . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX004",51,0)
 . . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX004",52,0)
 . . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX004",53,0)
 . . ;--- Check if the patient should be skipped
"RTN","RORX004",54,0)
 . . Q:$$SKIP^RORXU005(IEN,SFLAGS,RORSDT,ROREDT)
"RTN","RORX004",55,0)
 . . ;--- Process the registry record
"RTN","RORX004",56,0)
 . . S TMP=$$PATIENT(IENS,PATIENTS)
"RTN","RORX004",57,0)
 . . I TMP<0  S ECNT=ECNT+1  Q
"RTN","RORX004",58,0)
 . Q:RC<0
"RTN","RORX004",59,0)
 ;
"RTN","RORX004",60,0)
 ;--- Cleanup
"RTN","RORX004",61,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX004",62,0)
 ;
"RTN","RORX004",63,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX004",64,0)
 ;
"RTN","RORX004",65,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX004",66,0)
 ;
"RTN","RORX004",67,0)
 ; Return Values:
"RTN","RORX004",68,0)
 ;       <0  Error code
"RTN","RORX004",69,0)
 ;        0  Ok
"RTN","RORX004",70,0)
 ;
"RTN","RORX004",71,0)
HEADER(PARTAG) ;
"RTN","RORX004",72,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,SEEN,LSNDT)
"RTN","RORX004",73,0)
 ;
"RTN","RORX004",74,0)
 N HEADER,RC
"RTN","RORX004",75,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX004",76,0)
 Q:HEADER<0 HEADER
"RTN","RORX004",77,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX004",HEADER)
"RTN","RORX004",78,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX004",79,0)
 ;
"RTN","RORX004",80,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX004",81,0)
 ;
"RTN","RORX004",82,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX004",83,0)
 ;
"RTN","RORX004",84,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX004",85,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX004",86,0)
 ;
"RTN","RORX004",87,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX004",88,0)
 ;               returned via this parameter
"RTN","RORX004",89,0)
 ;
"RTN","RORX004",90,0)
 ; Return Values:
"RTN","RORX004",91,0)
 ;       <0  Error code
"RTN","RORX004",92,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX004",93,0)
 ;
"RTN","RORX004",94,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX004",95,0)
 N PARAMS,TMP
"RTN","RORX004",96,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX004",97,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX004",98,0)
 ;--- Process the list of clinics
"RTN","RORX004",99,0)
 S TMP=$$CLINLST^RORXU006(.RORTSK,PARAMS)
"RTN","RORX004",100,0)
 Q:TMP<0 TMP
"RTN","RORX004",101,0)
 ;---
"RTN","RORX004",102,0)
 Q PARAMS
"RTN","RORX004",103,0)
 ;
"RTN","RORX004",104,0)
 ;***** ADDS THE PATIENT DATA TO THE REPORT
"RTN","RORX004",105,0)
 ;
"RTN","RORX004",106,0)
 ; IENS          IENS of the patient's record in the registry
"RTN","RORX004",107,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX004",108,0)
 ;
"RTN","RORX004",109,0)
 ; Return Values:
"RTN","RORX004",110,0)
 ;       <0  Error code
"RTN","RORX004",111,0)
 ;        0  Ok
"RTN","RORX004",112,0)
 ;       >0  Skip the patient
"RTN","RORX004",113,0)
 ;
"RTN","RORX004",114,0)
PATIENT(IENS,PARTAG) ;
"RTN","RORX004",115,0)
 N CHK,CLINAIDS,DFN,IEN,RC,RORBUF,RORMSG,SEEN,TMP,VA,VADM,VAHOW,VAROOT
"RTN","RORX004",116,0)
 S RC=0
"RTN","RORX004",117,0)
 S DFN=$$PTIEN^RORUTL01(+IENS)
"RTN","RORX004",118,0)
 ; 
"RTN","RORX004",119,0)
 ;--- Only include patients that received utilization if care is true
"RTN","RORX004",120,0)
 I $$PARAM^RORTSK01("PATIENTS","CAREONLY")  D  Q:'TMP 1
"RTN","RORX004",121,0)
 . S CHK("ALL")=""
"RTN","RORX004",122,0)
 . S TMP=$$UTIL^RORXU003(RORSDT,ROREDT,DFN,.CHK)
"RTN","RORX004",123,0)
 ;
"RTN","RORX004",124,0)
 ;--- Select Seen/NotSeen patients
"RTN","RORX004",125,0)
 S SEEN=$$SEEN^RORXU001(RORSDT,ROREDT,DFN)
"RTN","RORX004",126,0)
 Q:'$$PARAM^RORTSK01("PATIENTS",$S(SEEN:"SEEN",1:"NOTSEEN")) 1
"RTN","RORX004",127,0)
 ;
"RTN","RORX004",128,0)
 ;--- Load the demographic data
"RTN","RORX004",129,0)
 D 2^VADPT
"RTN","RORX004",130,0)
 ;
"RTN","RORX004",131,0)
 ;--- The <PATIENT> tag
"RTN","RORX004",132,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PARTAG,,DFN)
"RTN","RORX004",133,0)
 Q:PTAG<0 PTAG
"RTN","RORX004",134,0)
 ;
"RTN","RORX004",135,0)
 ;--- Patient Name
"RTN","RORX004",136,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX004",137,0)
 ;--- Last 4 digits of the SSN
"RTN","RORX004",138,0)
 D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG,2)
"RTN","RORX004",139,0)
 ;--- Date of Death
"RTN","RORX004",140,0)
 S TMP=$$DATE^RORXU002($P(VADM(6),U)\1)
"RTN","RORX004",141,0)
 D ADDVAL^RORTSK11(RORTSK,"DOD",TMP,PTAG,1)
"RTN","RORX004",142,0)
 ;--- Seen/Not Seen
"RTN","RORX004",143,0)
 D ADDVAL^RORTSK11(RORTSK,"SEEN",SEEN,PTAG,1)
"RTN","RORX004",144,0)
 ;--- The latest date the patient was seen at any one of
"RTN","RORX004",145,0)
 ;--- the given clinics
"RTN","RORX004",146,0)
 S TMP=$$LASTVSIT^RORXU001(DFN)\1
"RTN","RORX004",147,0)
 D ADDVAL^RORTSK11(RORTSK,"LSNDT",$$DATE^RORXU002(TMP),PTAG,1)
"RTN","RORX004",148,0)
 Q 0
"RTN","RORX005")
0^168^B9729491
"RTN","RORX005",1,0)
RORX005 ;HCIOFO/BH,SG - INPATIENT UTILIZATION ; 10/14/05 1:53pm
"RTN","RORX005",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX005",3,0)
 ;
"RTN","RORX005",4,0)
 Q
"RTN","RORX005",5,0)
 ;
"RTN","RORX005",6,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX005",7,0)
 ;
"RTN","RORX005",8,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX005",9,0)
 ;
"RTN","RORX005",10,0)
 ; Return Values:
"RTN","RORX005",11,0)
 ;       <0  Error code
"RTN","RORX005",12,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX005",13,0)
 ;
"RTN","RORX005",14,0)
HEADER(PARTAG) ;
"RTN","RORX005",15,0)
 ;;HU_DAYS(#,NAME,LAST4,NST,ND,NSS)
"RTN","RORX005",16,0)
 ;;HU_STAYS(#,NAME,LAST4,NST,ND,NSS)
"RTN","RORX005",17,0)
 ;;BEDSECTIONS(#,NAME,NP,NST,ND,MLOS,NSS)
"RTN","RORX005",18,0)
 ;;NOBS(#,NAME,LAST4,DATE,PTF)
"RTN","RORX005",19,0)
 ;;STAYS(NP,NST)
"RTN","RORX005",20,0)
 ;
"RTN","RORX005",21,0)
 N HEADER,RC
"RTN","RORX005",22,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX005",23,0)
 Q:HEADER<0 HEADER
"RTN","RORX005",24,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX005",HEADER)
"RTN","RORX005",25,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX005",26,0)
 ;
"RTN","RORX005",27,0)
 ;
"RTN","RORX005",28,0)
 ;***** COMPILES THE "INPATIENT UTILIZATION" REPORT
"RTN","RORX005",29,0)
 ; REPORT CODE: 005
"RTN","RORX005",30,0)
 ;
"RTN","RORX005",31,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX005",32,0)
 ;
"RTN","RORX005",33,0)
 ; The ^TMP("RORX005",$J) global node is used by this function.
"RTN","RORX005",34,0)
 ;
"RTN","RORX005",35,0)
 ; ^TMP("RORX005",$J,
"RTN","RORX005",36,0)
 ;
"RTN","RORX005",37,0)
 ;   "IP",             Number of inpatients
"RTN","RORX005",38,0)
 ;     DFN,            Last 4 digits of SSN
"RTN","RORX005",39,0)
 ;       "D")          Number of days
"RTN","RORX005",40,0)
 ;       "S")          Number of overnight stays
"RTN","RORX005",41,0)
 ;       "V")          Number of short stays
"RTN","RORX005",42,0)
 ;
"RTN","RORX005",43,0)
 ;   "IPB",
"RTN","RORX005",44,0)
 ;#    BedSectID,
"RTN","RORX005",45,0)
 ;       "D")          Number of days
"RTN","RORX005",46,0)
 ;       "P",          Number of patients
"RTN","RORX005",47,0)
 ;         DFN)
"RTN","RORX005",48,0)
 ;       "S")          Number of overnight stays
"RTN","RORX005",49,0)
 ;       "V")          Number of short stays
"RTN","RORX005",50,0)
 ;     "B",
"RTN","RORX005",51,0)
 ;       BedSectName,
"RTN","RORX005",52,0)
 ;%        BedSectID)
"RTN","RORX005",53,0)
 ;
"RTN","RORX005",54,0)
 ;   "IPD",            Total number of days
"RTN","RORX005",55,0)
 ;     NumOfDays,      Number of patients
"RTN","RORX005",56,0)
 ;       PatientName,
"RTN","RORX005",57,0)
 ;         DFN)
"RTN","RORX005",58,0)
 ;
"RTN","RORX005",59,0)
 ;   "IPMLOS",         Median Length Of Stay
"RTN","RORX005",60,0)
 ;*    BedSectID,      Median Length Of Stay
"RTN","RORX005",61,0)
 ;       NumOfDays,
"RTN","RORX005",62,0)
 ;         Seq#)
"RTN","RORX005",63,0)
 ;
"RTN","RORX005",64,0)
 ;   "IPNOBS",
"RTN","RORX005",65,0)
 ;      PatientName,
"RTN","RORX005",66,0)
 ;        Date,
"RTN","RORX005",67,0)
 ;          PTF#,
"RTN","RORX005",68,0)
 ;            DFN)
"RTN","RORX005",69,0)
 ;
"RTN","RORX005",70,0)
 ;   "IPS",            Total number of stays
"RTN","RORX005",71,0)
 ;     NumOfStays,     Number of patients
"RTN","RORX005",72,0)
 ;       PatientName,
"RTN","RORX005",73,0)
 ;         DFN)
"RTN","RORX005",74,0)
 ;
"RTN","RORX005",75,0)
 ;   "IPV")            Total number of short stays
"RTN","RORX005",76,0)
 ;
"RTN","RORX005",77,0)
 ; Bed section IDs (BedSectID):
"RTN","RORX005",78,0)
 ;   -1  No bed section               [#%*]
"RTN","RORX005",79,0)
 ;    0  Whole patient's stays        [  *]
"RTN","RORX005",80,0)
 ;   >0  Bed section ID (IEN;File#)   [# *]
"RTN","RORX005",81,0)
 ;
"RTN","RORX005",82,0)
 ; Return Values:
"RTN","RORX005",83,0)
 ;       <0  Error code
"RTN","RORX005",84,0)
 ;        0  Ok
"RTN","RORX005",85,0)
 ;
"RTN","RORX005",86,0)
IPUTL(RORTSK) ;
"RTN","RORX005",87,0)
 N ROREDT        ; End date
"RTN","RORX005",88,0)
 N RORREG        ; Registry IEN
"RTN","RORX005",89,0)
 N RORSDT        ; Start date
"RTN","RORX005",90,0)
 ;
"RTN","RORX005",91,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX005",92,0)
 S (ECNT,RC)=0
"RTN","RORX005",93,0)
 K ^TMP("RORX005",$J)
"RTN","RORX005",94,0)
 ;--- Root node of the report
"RTN","RORX005",95,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX005",96,0)
 Q:REPORT<0 REPORT
"RTN","RORX005",97,0)
 ;
"RTN","RORX005",98,0)
 ;--- Get and prepare the report parameters
"RTN","RORX005",99,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX005",100,0)
 S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0 RC
"RTN","RORX005",101,0)
 ;
"RTN","RORX005",102,0)
 ;--- Report header
"RTN","RORX005",103,0)
 S RC=$$HEADER(REPORT)  Q:RC<0 RC
"RTN","RORX005",104,0)
 ;
"RTN","RORX005",105,0)
 D
"RTN","RORX005",106,0)
 . ;--- Query the registry
"RTN","RORX005",107,0)
 . D TPPSETUP^RORTSK01(70)
"RTN","RORX005",108,0)
 . S RC=$$QUERY^RORX005A(SFLAGS)
"RTN","RORX005",109,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX005",110,0)
 . ;--- Sort the data
"RTN","RORX005",111,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX005",112,0)
 . S RC=$$SORT^RORX005B()
"RTN","RORX005",113,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX005",114,0)
 . ;--- Store the results
"RTN","RORX005",115,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX005",116,0)
 . S RC=$$STORE^RORX005C(REPORT)
"RTN","RORX005",117,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX005",118,0)
 ;
"RTN","RORX005",119,0)
 ;--- Cleanup
"RTN","RORX005",120,0)
 K ^TMP("RORX005",$J)
"RTN","RORX005",121,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX005",122,0)
 ;
"RTN","RORX005",123,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX005",124,0)
 ;
"RTN","RORX005",125,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX005",126,0)
 ;
"RTN","RORX005",127,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX005",128,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX005",129,0)
 ;
"RTN","RORX005",130,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX005",131,0)
 ;               returned via this parameter
"RTN","RORX005",132,0)
 ;
"RTN","RORX005",133,0)
 ; Return Values:
"RTN","RORX005",134,0)
 ;       <0  Error code
"RTN","RORX005",135,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX005",136,0)
 ;
"RTN","RORX005",137,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX005",138,0)
 N PARAMS,TMP
"RTN","RORX005",139,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX005",140,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX005",141,0)
 ;--- Process the list of divisions
"RTN","RORX005",142,0)
 S TMP=$$DIVLST^RORXU006(.RORTSK,PARAMS)
"RTN","RORX005",143,0)
 Q:TMP<0 TMP
"RTN","RORX005",144,0)
 ;--- Additional parameters
"RTN","RORX005",145,0)
 F NAME="MAXUTNUM"  D
"RTN","RORX005",146,0)
 . S TMP=$$PARAM^RORTSK01(NAME)
"RTN","RORX005",147,0)
 . D:TMP'="" ADDVAL^RORTSK11(RORTSK,NAME,TMP,PARAMS)
"RTN","RORX005",148,0)
 ;---
"RTN","RORX005",149,0)
 Q PARAMS
"RTN","RORX005A")
0^169^B28503229
"RTN","RORX005A",1,0)
RORX005A ;HCIOFO/BH,SG - INPATIENT UTILIZATION (QUERY) ; 1/9/06 6:27am
"RTN","RORX005A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX005A",3,0)
 ;
"RTN","RORX005A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX005A",5,0)
 ;
"RTN","RORX005A",6,0)
 ; #92           Read access to the file #45 (controlled)
"RTN","RORX005A",7,0)
 ; #557          Read access to the file #40.7 (controlled)
"RTN","RORX005A",8,0)
 ; #???          The .01 field and "C" x-ref of file #40.8
"RTN","RORX005A",9,0)
 ; #10035        Read access to the file #2 (supported)
"RTN","RORX005A",10,0)
 ;
"RTN","RORX005A",11,0)
 Q
"RTN","RORX005A",12,0)
 ;
"RTN","RORX005A",13,0)
 ;***** ADDS THE INPATIENT STAY
"RTN","RORX005A",14,0)
 ;
"RTN","RORX005A",15,0)
 ; DFN           Patient IEN (in file #2)
"RTN","RORX005A",16,0)
 ; PTFIEN        IEN of the PTF record
"RTN","RORX005A",17,0)
 ; LOS           Length of stay
"RTN","RORX005A",18,0)
 ; BSID          Bed section ID
"RTN","RORX005A",19,0)
 ; DATE          Movement date/time (FileMan)
"RTN","RORX005A",20,0)
 ;
"RTN","RORX005A",21,0)
ADDSTAY(DFN,PTFIEN,LOS,BSID,DATE) ;
"RTN","RORX005A",22,0)
 N DST,I,TMP
"RTN","RORX005A",23,0)
 S:$G(BSID)="" BSID=0
"RTN","RORX005A",24,0)
 ;--- Number of patients for the bedsection
"RTN","RORX005A",25,0)
 I 'BSID  S DST=$NA(@RORDST@("IP",DFN))
"RTN","RORX005A",26,0)
 E  S DST=$NA(@RORDST@("IPB",BSID))  D:'$D(@DST@("P",DFN))
"RTN","RORX005A",27,0)
 . S @DST@("P")=$G(@DST@("P"))+1,@DST@("P",DFN)=""
"RTN","RORX005A",28,0)
 ;--- No bed section ID
"RTN","RORX005A",29,0)
 S:BSID<0 @RORDST@("IPNOBS",RORPNAME,DATE,PTFIEN,DFN)=""
"RTN","RORX005A",30,0)
 ;--- Short stays (visits)
"RTN","RORX005A",31,0)
 I LOS'>0  S @DST@("V")=$G(@DST@("V"))+1  Q
"RTN","RORX005A",32,0)
 ;--- Days and stays
"RTN","RORX005A",33,0)
 S @DST@("D")=$G(@DST@("D"))+LOS
"RTN","RORX005A",34,0)
 S @DST@("S")=$G(@DST@("S"))+1
"RTN","RORX005A",35,0)
 ;--- Lengths of stay for median value calculations
"RTN","RORX005A",36,0)
 S I=$O(@RORDST@("IPMLOS",BSID,LOS,""),-1)+1
"RTN","RORX005A",37,0)
 S @RORDST@("IPMLOS",BSID,LOS,I)=""
"RTN","RORX005A",38,0)
 Q
"RTN","RORX005A",39,0)
 ;
"RTN","RORX005A",40,0)
 ;***** LOADS AND PROCESSES THE INPATIENT DATA
"RTN","RORX005A",41,0)
 ;
"RTN","RORX005A",42,0)
 ; DFN           Patient IEN (in file #2)
"RTN","RORX005A",43,0)
 ;
"RTN","RORX005A",44,0)
 ; Return Values:
"RTN","RORX005A",45,0)
 ;       <0  Error code
"RTN","RORX005A",46,0)
 ;        0  Ok
"RTN","RORX005A",47,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX005A",48,0)
 ;
"RTN","RORX005A",49,0)
IPDATA(DFN) ;
"RTN","RORX005A",50,0)
 N RORDST        ; Closed reference to the category node in ^TMP
"RTN","RORX005A",51,0)
 ;
"RTN","RORX005A",52,0)
 N BSID,DATE,DISDT,ENDT,FACILITY,LOS,PTFIEN,RC,RORMSG,STDT,SUFFIX,TMP,VAHOW,VAIP,VAROOT,XDATE
"RTN","RORX005A",53,0)
 S RORDST=$NA(^TMP("RORX005",$J))
"RTN","RORX005A",54,0)
 ;---
"RTN","RORX005A",55,0)
 S XDATE=RORSDT
"RTN","RORX005A",56,0)
 F  S RC=0  D  Q:RC<2  S XDATE=$O(^DGPT("AAD",DFN,XDATE))  Q:XDATE'>0
"RTN","RORX005A",57,0)
 . I XDATE'<ROREDT1  S RC=1  Q
"RTN","RORX005A",58,0)
 . K DATE,LOS,VAIP  S VAIP(16,1)=XDATE
"RTN","RORX005A",59,0)
 . F  D  Q:RC
"RTN","RORX005A",60,0)
 . . S VAIP("D")=+$G(VAIP(16,1))
"RTN","RORX005A",61,0)
 . . I VAIP("D")'>0  S RC=2  Q
"RTN","RORX005A",62,0)
 . . D IN5^VADPT
"RTN","RORX005A",63,0)
 . . I $G(VAIP(1))'>0  S RC=2  Q
"RTN","RORX005A",64,0)
 . . S DATE=+VAIP(3)
"RTN","RORX005A",65,0)
 . . Q:+$G(VAIP(4))=3
"RTN","RORX005A",66,0)
 . . ;--- Check the movement date
"RTN","RORX005A",67,0)
 . . I DATE'<ROREDT1  S RC=1  Q
"RTN","RORX005A",68,0)
 . . S:DATE<RORSDT DATE=RORSDT
"RTN","RORX005A",69,0)
 . . ;--- Check the PTF record
"RTN","RORX005A",70,0)
 . . S PTFIEN=+$G(VAIP(12))  Q:PTFIEN'>0
"RTN","RORX005A",71,0)
 . . I '$D(PTFIEN(PTFIEN))  D  Q:RC
"RTN","RORX005A",72,0)
 . . . S PTFIEN(PTFIEN)=0
"RTN","RORX005A",73,0)
 . . . Q:$$PTF^RORXU001(PTFIEN,"FP",,,.SUFFIX,,.FACILITY)
"RTN","RORX005A",74,0)
 . . . ;--- Check the suffix
"RTN","RORX005A",75,0)
 . . . ;I SUFFIX'=""  Q:$$VSUFFIX(SUFFIX)  ; ROR 1.5
"RTN","RORX005A",76,0)
 . . . ;--- Check the division
"RTN","RORX005A",77,0)
 . . . S TMP=$$PARAM^RORTSK01("DIVISIONS","ALL")
"RTN","RORX005A",78,0)
 . . . I 'TMP  D  Q:'$D(RORTSK("PARAMS","DIVISIONS","C",DIVIEN))
"RTN","RORX005A",79,0)
 . . . . S TMP=FACILITY_SUFFIX
"RTN","RORX005A",80,0)
 . . . . S DIVIEN=$S(TMP'="":+$O(^DG(40.8,"C",TMP,"")),1:0)
"RTN","RORX005A",81,0)
 . . . S PTFIEN(PTFIEN)=1
"RTN","RORX005A",82,0)
 . . ;--- Skip the PTF record if necessary
"RTN","RORX005A",83,0)
 . . Q:'PTFIEN(PTFIEN)
"RTN","RORX005A",84,0)
 . . ;--- Process the admission (only once)
"RTN","RORX005A",85,0)
 . . I '$D(LOS)  D  Q:RC
"RTN","RORX005A",86,0)
 . . . S LOS=$$LOS(+$G(VAIP(13,1)),+$G(VAIP(17,1)))
"RTN","RORX005A",87,0)
 . . . D ADDSTAY(DFN,PTFIEN,LOS)
"RTN","RORX005A",88,0)
 . . ;--- Process the movement
"RTN","RORX005A",89,0)
 . . S ENDT=$G(VAIP(16,1))\1
"RTN","RORX005A",90,0)
 . . S:(ENDT'>0)!(ENDT'<ROREDT1) ENDT=ROREDT,RC=2
"RTN","RORX005A",91,0)
 . . Q:ENDT<RORSDT
"RTN","RORX005A",92,0)
 . . S LOS=$$FMDIFF^XLFDT(ENDT,DATE\1,1)  S:LOS'>0 LOS=0
"RTN","RORX005A",93,0)
 . . ;--- Use the IEN in the SPECIALTY file (#42.4) as the Bedsection 
"RTN","RORX005A",94,0)
 . . ;    ID if it is available (it should be). Otherwise, use the
"RTN","RORX005A",95,0)
 . . ;--- IEN in the FACILITY TREATING SPECIALTY file (#45.7).
"RTN","RORX005A",96,0)
 . . I $G(VAIP(8))>0  D
"RTN","RORX005A",97,0)
 . . . S TMP=$$GET1^DIQ(45.7,+VAIP(8),1,"I",,"RORMSG")
"RTN","RORX005A",98,0)
 . . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,DFN,45.7,+VAIP(8))
"RTN","RORX005A",99,0)
 . . . S BSID=$S(TMP>0:TMP_";42.4",1:+VAIP(8)_";45.7")
"RTN","RORX005A",100,0)
 . . E  S BSID=-1
"RTN","RORX005A",101,0)
 . . D ADDSTAY(DFN,PTFIEN,LOS,BSID,+VAIP(3))
"RTN","RORX005A",102,0)
 . S:$G(DATE)>XDATE XDATE=DATE
"RTN","RORX005A",103,0)
 ;---
"RTN","RORX005A",104,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX005A",105,0)
 ;
"RTN","RORX005A",106,0)
 ;***** CALCULATES THE LENGTH OF STAY
"RTN","RORX005A",107,0)
LOS(STDT,ENDT) ;
"RTN","RORX005A",108,0)
 N DAYS
"RTN","RORX005A",109,0)
 S:STDT<RORSDT STDT=RORSDT
"RTN","RORX005A",110,0)
 S:(ENDT'>0)!(ENDT>ROREDT) ENDT=ROREDT
"RTN","RORX005A",111,0)
 S DAYS=$$FMDIFF^XLFDT(ENDT\1,STDT\1,1)
"RTN","RORX005A",112,0)
 Q $S(DAYS'<0:DAYS,1:0)
"RTN","RORX005A",113,0)
 ;
"RTN","RORX005A",114,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX005A",115,0)
 ;
"RTN","RORX005A",116,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX005A",117,0)
 ;
"RTN","RORX005A",118,0)
 ; Return Values:
"RTN","RORX005A",119,0)
 ;       <0  Error code
"RTN","RORX005A",120,0)
 ;        0  Ok
"RTN","RORX005A",121,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX005A",122,0)
 ;
"RTN","RORX005A",123,0)
QUERY(FLAGS) ;
"RTN","RORX005A",124,0)
 N ROREDT1       ; Day after the end date
"RTN","RORX005A",125,0)
 N RORLAST4      ; Last 4 digits of the current patient's SSN
"RTN","RORX005A",126,0)
 N RORPNAME      ; Name of the current patient
"RTN","RORX005A",127,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX005A",128,0)
 ;
"RTN","RORX005A",129,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,TMP,VA,VADM,XREFNODE
"RTN","RORX005A",130,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX005A",131,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX005A",132,0)
 S ROREDT1=$$FMADD^XLFDT(ROREDT,1)
"RTN","RORX005A",133,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX005A",134,0)
 ;--- Browse through the registry records
"RTN","RORX005A",135,0)
 S IEN=0
"RTN","RORX005A",136,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX005A",137,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX005A",138,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX005A",139,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX005A",140,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX005A",141,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX005A",142,0)
 . ;
"RTN","RORX005A",143,0)
 . ;--- Get the patient IEN (DFN)
"RTN","RORX005A",144,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX005A",145,0)
 . ;
"RTN","RORX005A",146,0)
 . ;--- Get the patient's data
"RTN","RORX005A",147,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX005A",148,0)
 . S RORPNAME=VADM(1),RORLAST4=VA("BID")
"RTN","RORX005A",149,0)
 . ;
"RTN","RORX005A",150,0)
 . ;--- Get the inpatient data
"RTN","RORX005A",151,0)
 . S RC=$$IPDATA(PATIEN)
"RTN","RORX005A",152,0)
 . I RC  S ECNT=ECNT+1  Q:RC<0
"RTN","RORX005A",153,0)
 . ;
"RTN","RORX005A",154,0)
 . ;--- Calculate intermediate totals
"RTN","RORX005A",155,0)
 . S RC=$$TOTALS^RORX005B(PATIEN)
"RTN","RORX005A",156,0)
 . I RC  S ECNT=ECNT+1  Q:RC<0
"RTN","RORX005A",157,0)
 ;---
"RTN","RORX005A",158,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX005A",159,0)
 ;
"RTN","RORX005A",160,0)
 ;***** CHECKS THE SUFFIX FOR VALIDITY
"RTN","RORX005A",161,0)
 ;
"RTN","RORX005A",162,0)
 ; SUFFIX        Suffix
"RTN","RORX005A",163,0)
 ;
"RTN","RORX005A",164,0)
 ; Return Values:
"RTN","RORX005A",165,0)
 ;        0  Ok
"RTN","RORX005A",166,0)
 ;        1  Invalid suffix
"RTN","RORX005A",167,0)
VSUFFIX(SUFFIX) ;
"RTN","RORX005A",168,0)
 Q '("9AA,9AB,9AC,9AD,9AE,9BB,A0,A4,A5,BU,BV,PA"[SUFFIX)
"RTN","RORX005B")
0^170^B7236567
"RTN","RORX005B",1,0)
RORX005B ;HCIOFO/BH,SG - INPATIENT UTILIZATION (SORT) ; 9/14/05 9:30am
"RTN","RORX005B",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX005B",3,0)
 ;
"RTN","RORX005B",4,0)
 Q
"RTN","RORX005B",5,0)
 ;
"RTN","RORX005B",6,0)
 ;***** CALCULATES MEDIAN LENGTHS OF STAY
"RTN","RORX005B",7,0)
 ;
"RTN","RORX005B",8,0)
 ; NODE          Closed root of the category section
"RTN","RORX005B",9,0)
 ;               in the temporary global
"RTN","RORX005B",10,0)
 ;
"RTN","RORX005B",11,0)
 ; FSUM          Update the summary data (0/1)
"RTN","RORX005B",12,0)
 ;
"RTN","RORX005B",13,0)
MLOS(NODE) ;
"RTN","RORX005B",14,0)
 N BSID,TMP,XREFNODE
"RTN","RORX005B",15,0)
 ;--- Median length of the whole stays
"RTN","RORX005B",16,0)
 S XREFNODE=$NA(@NODE@("IPMLOS",0))
"RTN","RORX005B",17,0)
 S TMP=$$XREFMDNV^RORXU004(XREFNODE,+$G(@NODE@("IPS")))
"RTN","RORX005B",18,0)
 S (@NODE@("IPMLOS"),@NODE@("IPMLOS",0))=TMP
"RTN","RORX005B",19,0)
 ;--- Median lengths of the bed section stays
"RTN","RORX005B",20,0)
 S BSID=""
"RTN","RORX005B",21,0)
 F  S BSID=$O(@NODE@("IPMLOS",BSID))  Q:BSID=""  D:BSID
"RTN","RORX005B",22,0)
 . S XREFNODE=$NA(@NODE@("IPMLOS",BSID))
"RTN","RORX005B",23,0)
 . S TMP=+$G(@NODE@("IPB",BSID,"S"))
"RTN","RORX005B",24,0)
 . S @NODE@("IPMLOS",BSID)=$$XREFMDNV^RORXU004(XREFNODE,TMP)
"RTN","RORX005B",25,0)
 Q
"RTN","RORX005B",26,0)
 ;
"RTN","RORX005B",27,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX005B",28,0)
 ;
"RTN","RORX005B",29,0)
 ; Return Values:
"RTN","RORX005B",30,0)
 ;       <0  Error code
"RTN","RORX005B",31,0)
 ;        0  Ok
"RTN","RORX005B",32,0)
 ;
"RTN","RORX005B",33,0)
SORT() ;
"RTN","RORX005B",34,0)
 N BSID,FILE,IENS,NAME,NODE,RC,RORMSG,TMP
"RTN","RORX005B",35,0)
 S NODE=$NA(^TMP("RORX005",$J))  Q:$D(@NODE)<10 0
"RTN","RORX005B",36,0)
 ;--- Bed sections
"RTN","RORX005B",37,0)
 S RC=$$LOOP^RORTSK01(0)  Q:RC<0 RC
"RTN","RORX005B",38,0)
 S BSID=""
"RTN","RORX005B",39,0)
 F  S BSID=$O(@NODE@("IPB",BSID))  Q:'BSID  D
"RTN","RORX005B",40,0)
 . D:BSID>0
"RTN","RORX005B",41,0)
 . . S IENS=(+BSID)_",",FILE=+$P(BSID,";",2)
"RTN","RORX005B",42,0)
 . . S NAME=$$GET1^DIQ(FILE,IENS,.01,,,"RORMSG")
"RTN","RORX005B",43,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,FILE,IENS)
"RTN","RORX005B",44,0)
 . . S:NAME?." " NAME="Unknown ("_BSID_")"
"RTN","RORX005B",45,0)
 . . S @NODE@("IPB","B",NAME,BSID)=""
"RTN","RORX005B",46,0)
 ;--- Median length of stay
"RTN","RORX005B",47,0)
 S RC=$$LOOP^RORTSK01(0.5)  Q:RC<0 RC
"RTN","RORX005B",48,0)
 D MLOS(NODE)
"RTN","RORX005B",49,0)
 ;---
"RTN","RORX005B",50,0)
 Q 0
"RTN","RORX005B",51,0)
 ;
"RTN","RORX005B",52,0)
 ;***** CALCULATES THE INTERMEDIATE TOTALS
"RTN","RORX005B",53,0)
 ;
"RTN","RORX005B",54,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX005B",55,0)
 ;
"RTN","RORX005B",56,0)
 ; Return Values:
"RTN","RORX005B",57,0)
 ;       <0  Error code
"RTN","RORX005B",58,0)
 ;        0  Ok
"RTN","RORX005B",59,0)
 ;
"RTN","RORX005B",60,0)
TOTALS(PATIEN) ;
"RTN","RORX005B",61,0)
 N NODE,TMP
"RTN","RORX005B",62,0)
 S NODE=$NA(^TMP("RORX005",$J))
"RTN","RORX005B",63,0)
 ;
"RTN","RORX005B",64,0)
 ;=== Inpatient data
"RTN","RORX005B",65,0)
 D:$D(@NODE@("IP",PATIEN))>1
"RTN","RORX005B",66,0)
 . N DAYS,STAYS,VISITS
"RTN","RORX005B",67,0)
 . S @NODE@("IP",PATIEN)=RORLAST4
"RTN","RORX005B",68,0)
 . S @NODE@("IP")=$G(@NODE@("IP"))+1
"RTN","RORX005B",69,0)
 . S STAYS=+$G(@NODE@("IP",PATIEN,"S"))
"RTN","RORX005B",70,0)
 . S DAYS=+$G(@NODE@("IP",PATIEN,"D"))
"RTN","RORX005B",71,0)
 . S VISITS=+$G(@NODE@("IP",PATIEN,"V"))
"RTN","RORX005B",72,0)
 . ;--- Number of stays
"RTN","RORX005B",73,0)
 . D:(STAYS>0)!(VISITS>0)
"RTN","RORX005B",74,0)
 . . S @NODE@("IPS")=$G(@NODE@("IPS"))+STAYS
"RTN","RORX005B",75,0)
 . . S @NODE@("IPS",STAYS)=$G(@NODE@("IPS",STAYS))+1
"RTN","RORX005B",76,0)
 . . S @NODE@("IPS",STAYS,RORPNAME,PATIEN)=""
"RTN","RORX005B",77,0)
 . ;--- Number of days
"RTN","RORX005B",78,0)
 . D:(DAYS>0)!(VISITS>0)
"RTN","RORX005B",79,0)
 . . S @NODE@("IPD")=$G(@NODE@("IPD"))+DAYS
"RTN","RORX005B",80,0)
 . . S @NODE@("IPD",DAYS)=$G(@NODE@("IPD",DAYS))+1
"RTN","RORX005B",81,0)
 . . S @NODE@("IPD",DAYS,RORPNAME,PATIEN)=""
"RTN","RORX005B",82,0)
 . ;--- Number of short stays (visits)
"RTN","RORX005B",83,0)
 . D:VISITS>0
"RTN","RORX005B",84,0)
 . . S @NODE@("IPV")=$G(@NODE@("IPV"))+VISITS
"RTN","RORX005B",85,0)
 Q 0
"RTN","RORX005C")
0^171^B36299826
"RTN","RORX005C",1,0)
RORX005C ;HCIOFO/BH,SG - INPATIENT UTILIZATION (STORE) ; 9/14/05 9:17am
"RTN","RORX005C",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX005C",3,0)
 ;
"RTN","RORX005C",4,0)
 Q
"RTN","RORX005C",5,0)
 ;
"RTN","RORX005C",6,0)
 ;***** HIGHEST UTILIZATION
"RTN","RORX005C",7,0)
 ;
"RTN","RORX005C",8,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX005C",9,0)
 ;
"RTN","RORX005C",10,0)
 ; RORNODE       Closed root of the section in the temporary global
"RTN","RORX005C",11,0)
 ;
"RTN","RORX005C",12,0)
 ; Return Values:
"RTN","RORX005C",13,0)
 ;       <0  Error code
"RTN","RORX005C",14,0)
 ;        0  Ok
"RTN","RORX005C",15,0)
 ;
"RTN","RORX005C",16,0)
HIGHUTIL(PRNTELMT,RORNODE) ;
"RTN","RORX005C",17,0)
 N RC,RORMAXUT,RORTCNT,SECTION,TMP
"RTN","RORX005C",18,0)
 S RORMAXUT=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX005C",19,0)
 Q:RORMAXUT'>0 0
"RTN","RORX005C",20,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"HIGHUTIL",,PRNTELMT)
"RTN","RORX005C",21,0)
 Q:SECTION<0 SECTION
"RTN","RORX005C",22,0)
 S (RC,RORTCNT)=0
"RTN","RORX005C",23,0)
 ;--- Stays
"RTN","RORX005C",24,0)
 S RC=$$HIGHUTSD(SECTION,"IPS","HU_STAYS")  Q:RC<0 RC
"RTN","RORX005C",25,0)
 ;--- Days
"RTN","RORX005C",26,0)
 S RC=$$HIGHUTSD(SECTION,"IPD","HU_DAYS")   Q:RC<0 RC
"RTN","RORX005C",27,0)
 ;--- Disable the empty section
"RTN","RORX005C",28,0)
 D:RORTCNT'>0 UPDVAL^RORTSK11(RORTSK,SECTION,"",,1)
"RTN","RORX005C",29,0)
 Q 0
"RTN","RORX005C",30,0)
 ;
"RTN","RORX005C",31,0)
 ;*****
"RTN","RORX005C",32,0)
 ;
"RTN","RORX005C",33,0)
 ; SECTION       IEN of the parent element
"RTN","RORX005C",34,0)
 ;
"RTN","RORX005C",35,0)
 ; SUBS          Utilization subscript in the temporary global
"RTN","RORX005C",36,0)
 ;
"RTN","RORX005C",37,0)
 ; TBLNAME       Name of the table element
"RTN","RORX005C",38,0)
 ;
"RTN","RORX005C",39,0)
 ; Return Values:
"RTN","RORX005C",40,0)
 ;       <0  Error code
"RTN","RORX005C",41,0)
 ;        0  Ok
"RTN","RORX005C",42,0)
 ;
"RTN","RORX005C",43,0)
HIGHUTSD(SECTION,SUBS,TBLNAME) ;
"RTN","RORX005C",44,0)
 Q:$D(@RORNODE@(SUBS))<10 0
"RTN","RORX005C",45,0)
 N COUNT,DFN,ITEM,NAME,NUM,RC,TABLE,TMP
"RTN","RORX005C",46,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,TBLNAME,,SECTION)
"RTN","RORX005C",47,0)
 Q:TABLE<0 TABLE
"RTN","RORX005C",48,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE",TBLNAME)
"RTN","RORX005C",49,0)
 S RORTCNT=RORTCNT+1
"RTN","RORX005C",50,0)
 ;---
"RTN","RORX005C",51,0)
 S NUM="",(COUNT,RC)=0
"RTN","RORX005C",52,0)
 F  S NUM=$O(@RORNODE@(SUBS,NUM),-1)  Q:NUM=""  D  Q:RC
"RTN","RORX005C",53,0)
 . S NAME=""
"RTN","RORX005C",54,0)
 . F  S NAME=$O(@RORNODE@(SUBS,NUM,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX005C",55,0)
 . . S DFN=""
"RTN","RORX005C",56,0)
 . . F  S DFN=$O(@RORNODE@(SUBS,NUM,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX005C",57,0)
 . . . S COUNT=COUNT+1  I COUNT>RORMAXUT  S RC=1  Q
"RTN","RORX005C",58,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX005C",59,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX005C",60,0)
 . . . S TMP=$G(@RORNODE@("IP",DFN))
"RTN","RORX005C",61,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(TMP,U),ITEM,2)
"RTN","RORX005C",62,0)
 . . . S TMP=+$G(@RORNODE@("IP",DFN,"S"))
"RTN","RORX005C",63,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NST",TMP,ITEM,3)
"RTN","RORX005C",64,0)
 . . . S TMP=+$G(@RORNODE@("IP",DFN,"D"))
"RTN","RORX005C",65,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"ND",TMP,ITEM,3)
"RTN","RORX005C",66,0)
 . . . S TMP=$G(@RORNODE@("IP",DFN,"V"))
"RTN","RORX005C",67,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NSS",TMP,ITEM,3)
"RTN","RORX005C",68,0)
 Q 0
"RTN","RORX005C",69,0)
 ;
"RTN","RORX005C",70,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX005C",71,0)
 ;
"RTN","RORX005C",72,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX005C",73,0)
 ;
"RTN","RORX005C",74,0)
 ; Return Values:
"RTN","RORX005C",75,0)
 ;       <0  Error code
"RTN","RORX005C",76,0)
 ;        0  Ok
"RTN","RORX005C",77,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX005C",78,0)
 ;
"RTN","RORX005C",79,0)
STORE(REPORT) ;
"RTN","RORX005C",80,0)
 N RORSONLY      ; Output summary only
"RTN","RORX005C",81,0)
 ;
"RTN","RORX005C",82,0)
 N ECNT,NODE,RC,TMP
"RTN","RORX005C",83,0)
 S NODE=$NA(^TMP("RORX005",$J))
"RTN","RORX005C",84,0)
 Q:$D(@NODE)<10 0
"RTN","RORX005C",85,0)
 S RORSONLY=$$SMRYONLY^RORXU006(),(ECNT,RC)=0
"RTN","RORX005C",86,0)
 ;--- Inpatients
"RTN","RORX005C",87,0)
 S RC=$$LOOP^RORTSK01(0)    Q:RC<0 RC
"RTN","RORX005C",88,0)
 S RC=$$STOREIP(REPORT,NODE)
"RTN","RORX005C",89,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+1
"RTN","RORX005C",90,0)
 ;--- Highest utilization
"RTN","RORX005C",91,0)
 S RC=$$LOOP^RORTSK01(0.5)  Q:RC<0 RC
"RTN","RORX005C",92,0)
 S RC=$$HIGHUTIL(REPORT,NODE)
"RTN","RORX005C",93,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+1
"RTN","RORX005C",94,0)
 ;---
"RTN","RORX005C",95,0)
 Q ECNT
"RTN","RORX005C",96,0)
 ;
"RTN","RORX005C",97,0)
 ;***** INPATIENT DATA
"RTN","RORX005C",98,0)
 ;
"RTN","RORX005C",99,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX005C",100,0)
 ;
"RTN","RORX005C",101,0)
 ; NODE          Closed root of the category section
"RTN","RORX005C",102,0)
 ;               in the temporary global
"RTN","RORX005C",103,0)
 ;
"RTN","RORX005C",104,0)
 ; Return Values:
"RTN","RORX005C",105,0)
 ;       <0  Error code
"RTN","RORX005C",106,0)
 ;        0  Ok
"RTN","RORX005C",107,0)
 ;
"RTN","RORX005C",108,0)
STOREIP(PRNTELMT,NODE) ;
"RTN","RORX005C",109,0)
 Q:$D(@NODE@("IP"))<10 0
"RTN","RORX005C",110,0)
 N BSID,DATE,ITEM,NAME,NS,PATIEN,PTF,RC,SECTION,TABLE,TMP
"RTN","RORX005C",111,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"INPATIENTS",,PRNTELMT)
"RTN","RORX005C",112,0)
 Q:SECTION<0 SECTION
"RTN","RORX005C",113,0)
 S RC=0
"RTN","RORX005C",114,0)
 ;--- Stays
"RTN","RORX005C",115,0)
 I $D(@NODE@("IPS"))>1  D  Q:RC<0 RC
"RTN","RORX005C",116,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"STAYS",,SECTION)
"RTN","RORX005C",117,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX005C",118,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","STAYS")
"RTN","RORX005C",119,0)
 . S NS=""
"RTN","RORX005C",120,0)
 . F  S NS=$O(@NODE@("IPS",NS))  Q:NS=""  D
"RTN","RORX005C",121,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"ITEM",,TABLE)
"RTN","RORX005C",122,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NP",$P(@NODE@("IPS",NS),U),ITEM,3)
"RTN","RORX005C",123,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NST",NS,ITEM,3)
"RTN","RORX005C",124,0)
 ;--- Bed sections (clinics)
"RTN","RORX005C",125,0)
 I $D(@NODE@("IPB"))>1  D  Q:RC<0 RC
"RTN","RORX005C",126,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"BEDSECTIONS",,SECTION)
"RTN","RORX005C",127,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX005C",128,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","BEDSECTIONS")
"RTN","RORX005C",129,0)
 . S NAME=""
"RTN","RORX005C",130,0)
 . F  S NAME=$O(@NODE@("IPB","B",NAME))  Q:NAME=""  D
"RTN","RORX005C",131,0)
 . . S BSID=""
"RTN","RORX005C",132,0)
 . . F  S BSID=$O(@NODE@("IPB","B",NAME,BSID))  Q:BSID=""  D:BSID>0
"RTN","RORX005C",133,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"BEDSECTION",,TABLE)
"RTN","RORX005C",134,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX005C",135,0)
 . . . S TMP=+$G(@NODE@("IPB",BSID,"P"))
"RTN","RORX005C",136,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NP",TMP,ITEM,3)
"RTN","RORX005C",137,0)
 . . . S TMP=+$G(@NODE@("IPB",BSID,"S"))
"RTN","RORX005C",138,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NST",TMP,ITEM,3)
"RTN","RORX005C",139,0)
 . . . S TMP=+$G(@NODE@("IPB",BSID,"D"))
"RTN","RORX005C",140,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"ND",TMP,ITEM,3)
"RTN","RORX005C",141,0)
 . . . S TMP=+$G(@NODE@("IPMLOS",BSID))
"RTN","RORX005C",142,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"MLOS",$J(TMP,0,1),ITEM,3)
"RTN","RORX005C",143,0)
 . . . S TMP=$G(@NODE@("IPB",BSID,"V"))
"RTN","RORX005C",144,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NSS",TMP,ITEM,3)
"RTN","RORX005C",145,0)
 ;--- No bed section
"RTN","RORX005C",146,0)
 I 'RORSONLY,$D(@NODE@("IPNOBS"))>1  D  Q:RC<0 RC
"RTN","RORX005C",147,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"NOBS",,SECTION)
"RTN","RORX005C",148,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX005C",149,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","NOBS")
"RTN","RORX005C",150,0)
 . S NAME=""
"RTN","RORX005C",151,0)
 . F  S NAME=$O(@NODE@("IPNOBS",NAME))  Q:NAME=""  D
"RTN","RORX005C",152,0)
 . . S DATE=""
"RTN","RORX005C",153,0)
 . . F  S DATE=$O(@NODE@("IPNOBS",NAME,DATE))  Q:DATE=""  D
"RTN","RORX005C",154,0)
 . . . S PTF=""
"RTN","RORX005C",155,0)
 . . . F  S PTF=$O(@NODE@("IPNOBS",NAME,DATE,PTF))  Q:PTF=""  D
"RTN","RORX005C",156,0)
 . . . . S DFN=""
"RTN","RORX005C",157,0)
 . . . . F  S DFN=$O(@NODE@("IPNOBS",NAME,DATE,PTF,DFN))  Q:DFN=""  D
"RTN","RORX005C",158,0)
 . . . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX005C",159,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX005C",160,0)
 . . . . . S TMP=$P($G(@NODE@("IP",DFN)),U)
"RTN","RORX005C",161,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",TMP,ITEM,2)
"RTN","RORX005C",162,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"DATE",DATE,ITEM,3)
"RTN","RORX005C",163,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"PTF",PTF,ITEM,1)
"RTN","RORX005C",164,0)
 ;--- Summary
"RTN","RORX005C",165,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+$G(@NODE@("IP")),SECTION)
"RTN","RORX005C",166,0)
 D ADDVAL^RORTSK11(RORTSK,"NST",+$G(@NODE@("IPS")),SECTION)
"RTN","RORX005C",167,0)
 D ADDVAL^RORTSK11(RORTSK,"ND",+$G(@NODE@("IPD")),SECTION)
"RTN","RORX005C",168,0)
 D ADDVAL^RORTSK11(RORTSK,"NSS",+$G(@NODE@("IPV")),SECTION)
"RTN","RORX005C",169,0)
 S TMP=$G(@NODE@("IPMLOS",0))
"RTN","RORX005C",170,0)
 D ADDVAL^RORTSK11(RORTSK,"MLOS",$J(TMP,0,1),SECTION)
"RTN","RORX005C",171,0)
 I $G(@NODE@("IPS"))>0  D
"RTN","RORX005C",172,0)
 . S TMP=$G(@NODE@("IPD"))/@NODE@("IPS")
"RTN","RORX005C",173,0)
 E  S TMP=0
"RTN","RORX005C",174,0)
 D ADDVAL^RORTSK11(RORTSK,"ALOS",$J(TMP,0,1),SECTION)
"RTN","RORX005C",175,0)
 Q 0
"RTN","RORX005U")
1^172
"RTN","RORX006")
0^173^B10891321
"RTN","RORX006",1,0)
RORX006 ;HCIOFO/BH,SG - LAB UTILIZATION ; 11/8/05 8:53am
"RTN","RORX006",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX006",3,0)
 ;
"RTN","RORX006",4,0)
 Q
"RTN","RORX006",5,0)
 ;
"RTN","RORX006",6,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX006",7,0)
 ;
"RTN","RORX006",8,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX006",9,0)
 ;
"RTN","RORX006",10,0)
 ; Return Values:
"RTN","RORX006",11,0)
 ;       <0  Error code
"RTN","RORX006",12,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX006",13,0)
 ;
"RTN","RORX006",14,0)
HEADER(PARTAG) ;
"RTN","RORX006",15,0)
 ;;LABTESTS(#,NAME,NP,NR,MAXNRPP,MAXNP)
"RTN","RORX006",16,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,NO,NR,NDT)
"RTN","RORX006",17,0)
 ;;RESULTS(NP,NR)
"RTN","RORX006",18,0)
 ;
"RTN","RORX006",19,0)
 N HEADER,RC
"RTN","RORX006",20,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX006",21,0)
 Q:HEADER<0 HEADER
"RTN","RORX006",22,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX006",HEADER)
"RTN","RORX006",23,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX006",24,0)
 ;
"RTN","RORX006",25,0)
 ;
"RTN","RORX006",26,0)
 ;***** COMPILES THE "LAB UTILIZATION" REPORT
"RTN","RORX006",27,0)
 ; REPORT CODE: 006
"RTN","RORX006",28,0)
 ;
"RTN","RORX006",29,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX006",30,0)
 ;
"RTN","RORX006",31,0)
 ; The ^TMP("RORX006",$J) global node is used by this function.
"RTN","RORX006",32,0)
 ;
"RTN","RORX006",33,0)
 ; ^TMP("RORX006",$J,
"RTN","RORX006",34,0)
 ;
"RTN","RORX006",35,0)
 ;     "ORD",            Total number of orders
"RTN","RORX006",36,0)
 ;       NumOfOrd,       Number of patients
"RTN","RORX006",37,0)
 ;         PatientName,
"RTN","RORX006",38,0)
 ;           DFN)
"RTN","RORX006",39,0)
 ;
"RTN","RORX006",40,0)
 ;     "PAT",            Total number of patients
"RTN","RORX006",41,0)
 ;       DFN,            Patient descriptor
"RTN","RORX006",42,0)
 ;                         01: Last 4 digits of SSN
"RTN","RORX006",43,0)
 ;                         02: Date of death
"RTN","RORX006",44,0)
 ;         "O")          Number of orders
"RTN","RORX006",45,0)
 ;         "R",          Results
"RTN","RORX006",46,0)
 ;                         ^01: Number of results
"RTN","RORX006",47,0)
 ;                         ^02: Number of different tests
"RTN","RORX006",48,0)
 ;           TestIEN)    Number of results
"RTN","RORX006",49,0)
 ;
"RTN","RORX006",50,0)
 ;     "RES",            Totals
"RTN","RORX006",51,0)
 ;                         ^01: Total number of results
"RTN","RORX006",52,0)
 ;                         ^02: Number of different tests
"RTN","RORX006",53,0)
 ;       TestIEN,
"RTN","RORX006",54,0)
 ;         "M")          Maximum
"RTN","RORX006",55,0)
 ;                         ^01: Maximum number of results
"RTN","RORX006",56,0)
 ;                         ^02: Number of patients
"RTN","RORX006",57,0)
 ;         "P")          Number of patients
"RTN","RORX006",58,0)
 ;         "R")          Number of results
"RTN","RORX006",59,0)
 ;       "B",
"RTN","RORX006",60,0)
 ;         NumOfRes,
"RTN","RORX006",61,0)
 ;           TestName,
"RTN","RORX006",62,0)
 ;             TestIEN)
"RTN","RORX006",63,0)
 ;
"RTN","RORX006",64,0)
 ;     "RES1",
"RTN","RORX006",65,0)
 ;       NumOfResults,   Number of patients
"RTN","RORX006",66,0)
 ;         PatientName,
"RTN","RORX006",67,0)
 ;           DFN)
"RTN","RORX006",68,0)
 ;
"RTN","RORX006",69,0)
 ; Return Values:
"RTN","RORX006",70,0)
 ;       <0  Error code
"RTN","RORX006",71,0)
 ;        0  Ok
"RTN","RORX006",72,0)
 ;
"RTN","RORX006",73,0)
LABUTL(RORTSK) ;
"RTN","RORX006",74,0)
 N ROREDT        ; End date
"RTN","RORX006",75,0)
 N ROREDT1       ; End date + 1 day
"RTN","RORX006",76,0)
 N RORLTST       ; Closed root of the list of lab tests
"RTN","RORX006",77,0)
 N RORREG        ; Registry IEN
"RTN","RORX006",78,0)
 N RORSDT        ; Start date
"RTN","RORX006",79,0)
 ;
"RTN","RORX006",80,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX006",81,0)
 K ^TMP("RORX006",$J)
"RTN","RORX006",82,0)
 S RORLTST="",(ECNT,RC)=0
"RTN","RORX006",83,0)
 ;--- Root node of the report
"RTN","RORX006",84,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX006",85,0)
 Q:REPORT<0 REPORT
"RTN","RORX006",86,0)
 ;
"RTN","RORX006",87,0)
 D
"RTN","RORX006",88,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX006",89,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX006",90,0)
 . S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0
"RTN","RORX006",91,0)
 . S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1)
"RTN","RORX006",92,0)
 . ;--- Report header
"RTN","RORX006",93,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX006",94,0)
 . ;--- Query the registry
"RTN","RORX006",95,0)
 . D TPPSETUP^RORTSK01(70)
"RTN","RORX006",96,0)
 . S RC=$$QUERY^RORX006A(SFLAGS)
"RTN","RORX006",97,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX006",98,0)
 . ;--- Sort the data
"RTN","RORX006",99,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX006",100,0)
 . S RC=$$SORT^RORX006A()
"RTN","RORX006",101,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX006",102,0)
 . ;--- Store the results
"RTN","RORX006",103,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX006",104,0)
 . S RC=$$STORE^RORX006C(REPORT)
"RTN","RORX006",105,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX006",106,0)
 ;
"RTN","RORX006",107,0)
 ;--- Cleanup
"RTN","RORX006",108,0)
 D FREE^RORTMP(RORLTST)
"RTN","RORX006",109,0)
 K ^TMP("RORX006",$J)
"RTN","RORX006",110,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX006",111,0)
 ;
"RTN","RORX006",112,0)
 ;***** OUTPUTS PARAMETERS TO THE REPORT
"RTN","RORX006",113,0)
 ;
"RTN","RORX006",114,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX006",115,0)
 ;
"RTN","RORX006",116,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX006",117,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX006",118,0)
 ;
"RTN","RORX006",119,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX006",120,0)
 ;               returned via this parameter
"RTN","RORX006",121,0)
 ;
"RTN","RORX006",122,0)
 ; Return Values:
"RTN","RORX006",123,0)
 ;       <0  Error code
"RTN","RORX006",124,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX006",125,0)
 ;
"RTN","RORX006",126,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX006",127,0)
 N PARAMS,TMP
"RTN","RORX006",128,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX006",129,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX006",130,0)
 ;--- Additional parameters
"RTN","RORX006",131,0)
 F NAME="MAXUTNUM","MINRPNUM"  D
"RTN","RORX006",132,0)
 . S TMP=$$PARAM^RORTSK01(NAME)
"RTN","RORX006",133,0)
 . D:TMP'="" ADDVAL^RORTSK11(RORTSK,NAME,TMP,PARAMS)
"RTN","RORX006",134,0)
 ;--- Process the list of Lab tests
"RTN","RORX006",135,0)
 S TMP=$$LTLST^RORXU006(.RORTSK,PARAMS,.RORLTST)  Q:TMP<0 TMP
"RTN","RORX006",136,0)
 ;---
"RTN","RORX006",137,0)
 Q PARAMS
"RTN","RORX006A")
0^174^B18261690
"RTN","RORX006A",1,0)
RORX006A ;HCIOFO/BH,SG - LAB UTILIZATION (QUERY & SORT) ; 11/8/05 8:35am
"RTN","RORX006A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX006A",3,0)
 ;
"RTN","RORX006A",4,0)
 Q
"RTN","RORX006A",5,0)
 ;
"RTN","RORX006A",6,0)
 ;***** LOADS AND PROCESSES THE LAB DATA
"RTN","RORX006A",7,0)
 ;
"RTN","RORX006A",8,0)
 ; DFN           Patient IEN (in file #2)
"RTN","RORX006A",9,0)
 ;
"RTN","RORX006A",10,0)
 ; Return Values:
"RTN","RORX006A",11,0)
 ;       <0  Error code
"RTN","RORX006A",12,0)
 ;        0  Ok
"RTN","RORX006A",13,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX006A",14,0)
 ;
"RTN","RORX006A",15,0)
LABDATA(DFN) ;
"RTN","RORX006A",16,0)
 N DST,ENDT,NR,PTNO,PTNR,PRNT,RC,TSTIEN
"RTN","RORX006A",17,0)
 S DST=$NA(^TMP("RORX006",$J))
"RTN","RORX006A",18,0)
 ;
"RTN","RORX006A",19,0)
 ;--- Get the data
"RTN","RORX006A",20,0)
 S DST("RORCB")="$$LTSCB^RORX006A",DST("RORIDT")=""
"RTN","RORX006A",21,0)
 S RC=$$LTSEARCH^RORUTL10(DFN,RORLTST,.DST,,RORSDT,ROREDT1)
"RTN","RORX006A",22,0)
 Q:RC<0 RC  Q:$D(@DST@("PAT",DFN))<10 0
"RTN","RORX006A",23,0)
 ;
"RTN","RORX006A",24,0)
 ;--- Calculate intermediate totals of the tests
"RTN","RORX006A",25,0)
 S TSTIEN=0,(PTNR,PTNT)=0
"RTN","RORX006A",26,0)
 F  S TSTIEN=$O(@DST@("PAT",DFN,"R",TSTIEN))  Q:TSTIEN'>0  D
"RTN","RORX006A",27,0)
 . S NR=+$G(@DST@("PAT",DFN,"R",TSTIEN))
"RTN","RORX006A",28,0)
 . S PTNR=PTNR+NR  ; Number of patient's results
"RTN","RORX006A",29,0)
 . S PTNT=PTNT+1   ; Number of different tests
"RTN","RORX006A",30,0)
 . ;---
"RTN","RORX006A",31,0)
 . S @DST@("RES",TSTIEN,"P")=$G(@DST@("RES",TSTIEN,"P"))+1
"RTN","RORX006A",32,0)
 . S @DST@("RES",TSTIEN,"R")=$G(@DST@("RES",TSTIEN,"R"))+NR
"RTN","RORX006A",33,0)
 . ;---
"RTN","RORX006A",34,0)
 . S TMP=$G(@DST@("RES",TSTIEN,"M"))
"RTN","RORX006A",35,0)
 . D:NR'<TMP
"RTN","RORX006A",36,0)
 . . I NR>TMP  S @DST@("RES",TSTIEN,"M")=NR_U_1  Q
"RTN","RORX006A",37,0)
 . . S $P(@DST@("RES",TSTIEN,"M"),U,2)=$P(TMP,U,2)+1
"RTN","RORX006A",38,0)
 ;
"RTN","RORX006A",39,0)
 ;--- Orders
"RTN","RORX006A",40,0)
 S @DST@("ORD")=$G(@DST@("ORD"))+$G(@DST@("PAT",DFN,"O"))
"RTN","RORX006A",41,0)
 ;
"RTN","RORX006A",42,0)
 ;--- Results
"RTN","RORX006A",43,0)
 S @DST@("RES1",PTNR)=$G(@DST@("RES1",PTNR))+1
"RTN","RORX006A",44,0)
 S @DST@("RES1",PTNR,RORPNAME,DFN)=""
"RTN","RORX006A",45,0)
 ;
"RTN","RORX006A",46,0)
 ;--- Other totals
"RTN","RORX006A",47,0)
 S @DST@("PAT",DFN)=RORLAST4_U_RORDOD
"RTN","RORX006A",48,0)
 S @DST@("PAT",DFN,"R")=PTNR_U_PTNT
"RTN","RORX006A",49,0)
 S @DST@("PAT")=$G(@DST@("PAT"))+1
"RTN","RORX006A",50,0)
 S @DST@("RES")=$G(@DST@("RES"))+PTNR
"RTN","RORX006A",51,0)
 Q 0
"RTN","RORX006A",52,0)
 ;
"RTN","RORX006A",53,0)
 ;***** LAB SEARCH CALLBACK
"RTN","RORX006A",54,0)
 ;
"RTN","RORX006A",55,0)
 ; .ROR8DST      Reference to the ROR8DST parameter.
"RTN","RORX006A",56,0)
 ;
"RTN","RORX006A",57,0)
 ; INVDT         IEN of the Lab test (inverted date)
"RTN","RORX006A",58,0)
 ;
"RTN","RORX006A",59,0)
 ; .RESULT       Reference to a local variable, which contains
"RTN","RORX006A",60,0)
 ;               the result (see the $$LTSEARCH^RORUTL10).
"RTN","RORX006A",61,0)
 ;
"RTN","RORX006A",62,0)
 ; Return Values:
"RTN","RORX006A",63,0)
 ;       <0  Error code (the search will be aborted)
"RTN","RORX006A",64,0)
 ;        0  Ok
"RTN","RORX006A",65,0)
 ;        1  Skip this result
"RTN","RORX006A",66,0)
 ;        2  Skip this and all remaining results
"RTN","RORX006A",67,0)
 ;
"RTN","RORX006A",68,0)
LTSCB(ROR8DST,INVDT,RESULT) ;
"RTN","RORX006A",69,0)
 N DFN,TMP,TSTIEN
"RTN","RORX006A",70,0)
 S DFN=+ROR8DST("RORDFN"),TSTIEN=+RESULT(2)
"RTN","RORX006A",71,0)
 ;--- Number of orders
"RTN","RORX006A",72,0)
 I INVDT'=ROR8DST("RORIDT")  D  S ROR8DST("RORIDT")=INVDT
"RTN","RORX006A",73,0)
 . S @ROR8DST@("PAT",DFN,"O")=$G(@ROR8DST@("PAT",DFN,"O"))+1
"RTN","RORX006A",74,0)
 ;--- Number of results
"RTN","RORX006A",75,0)
 S TMP=$G(@ROR8DST@("PAT",DFN,"R",TSTIEN))
"RTN","RORX006A",76,0)
 S @ROR8DST@("PAT",DFN,"R",TSTIEN)=TMP+1
"RTN","RORX006A",77,0)
 Q 0
"RTN","RORX006A",78,0)
 ;
"RTN","RORX006A",79,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX006A",80,0)
 ;
"RTN","RORX006A",81,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX006A",82,0)
 ;
"RTN","RORX006A",83,0)
 ; Return Values:
"RTN","RORX006A",84,0)
 ;       <0  Error code
"RTN","RORX006A",85,0)
 ;        0  Ok
"RTN","RORX006A",86,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX006A",87,0)
 ;
"RTN","RORX006A",88,0)
QUERY(FLAGS) ;
"RTN","RORX006A",89,0)
 N RORDOD        ; Date of death of the current patient
"RTN","RORX006A",90,0)
 N RORLAST4      ; Last 4 digits of the current patient's SSN
"RTN","RORX006A",91,0)
 N RORPNAME      ; Name of the current patient
"RTN","RORX006A",92,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX006A",93,0)
 ;
"RTN","RORX006A",94,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,TMP,VA,VADM,XREFNODE
"RTN","RORX006A",95,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX006A",96,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX006A",97,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX006A",98,0)
 ;
"RTN","RORX006A",99,0)
 ;--- Browse through the registry records
"RTN","RORX006A",100,0)
 S IEN=0
"RTN","RORX006A",101,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX006A",102,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX006A",103,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX006A",104,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX006A",105,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX006A",106,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX006A",107,0)
 . ;
"RTN","RORX006A",108,0)
 . ;--- Get the patient IEN (DFN)
"RTN","RORX006A",109,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX006A",110,0)
 . ;
"RTN","RORX006A",111,0)
 . ;--- Get the patient's data
"RTN","RORX006A",112,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX006A",113,0)
 . S RORPNAME=VADM(1),RORLAST4=VA("BID")
"RTN","RORX006A",114,0)
 . S RORDOD=$$DATE^RORXU002($P(VADM(6),U)\1)
"RTN","RORX006A",115,0)
 . ;
"RTN","RORX006A",116,0)
 . ;--- Get the Lab data
"RTN","RORX006A",117,0)
 . S RC=$$LABDATA(PATIEN)
"RTN","RORX006A",118,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX006A",119,0)
 ;---
"RTN","RORX006A",120,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX006A",121,0)
 ;
"RTN","RORX006A",122,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX006A",123,0)
 ;
"RTN","RORX006A",124,0)
 ; Return Values:
"RTN","RORX006A",125,0)
 ;       <0  Error code
"RTN","RORX006A",126,0)
 ;        0  Ok
"RTN","RORX006A",127,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX006A",128,0)
 ;
"RTN","RORX006A",129,0)
SORT() ;
"RTN","RORX006A",130,0)
 N ECNT,IEN,NAME,NDLT,NODE,RC,RORMSG,TMP
"RTN","RORX006A",131,0)
 S NODE=$NA(^TMP("RORX006",$J)),(ECNT,RC)=0
"RTN","RORX006A",132,0)
 ;---
"RTN","RORX006A",133,0)
 S RC=$$LOOP^RORTSK01(0)  Q:RC<0 RC
"RTN","RORX006A",134,0)
 Q:$D(@NODE)<10 0
"RTN","RORX006A",135,0)
 ;---
"RTN","RORX006A",136,0)
 S IEN=0,NDLT=0
"RTN","RORX006A",137,0)
 F  S IEN=$O(@NODE@("RES",IEN))  Q:IEN'>0  D
"RTN","RORX006A",138,0)
 . S NDLT=NDLT+1
"RTN","RORX006A",139,0)
 . S NAME=$$GET1^DIQ(60,IEN,.01,,,"RORMSG")
"RTN","RORX006A",140,0)
 . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,60,IEN)
"RTN","RORX006A",141,0)
 . S:NAME?." " NAME="Unknown ("_IEN_")"
"RTN","RORX006A",142,0)
 . S TMP=+$G(@NODE@("RES",IEN,"R"))
"RTN","RORX006A",143,0)
 . S @NODE@("RES","B",TMP,NAME,IEN)=""
"RTN","RORX006A",144,0)
 ;--- Total numbers of Lab tests
"RTN","RORX006A",145,0)
 S $P(@NODE@("RES"),U,2)=NDLT
"RTN","RORX006A",146,0)
 ;---
"RTN","RORX006A",147,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX006C")
0^175^B20109049
"RTN","RORX006C",1,0)
RORX006C ;HCIOFO/BH,SG - LAB UTILIZATION (STORE) ; 9/19/05 9:39am
"RTN","RORX006C",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX006C",3,0)
 ;
"RTN","RORX006C",4,0)
 Q
"RTN","RORX006C",5,0)
 ;
"RTN","RORX006C",6,0)
 ;***** PATIENTS WITH HIGHEST UTILIZATION
"RTN","RORX006C",7,0)
 ;
"RTN","RORX006C",8,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX006C",9,0)
 ;
"RTN","RORX006C",10,0)
 ; NODE          Closed root of the category section
"RTN","RORX006C",11,0)
 ;               in the temporary global
"RTN","RORX006C",12,0)
 ;
"RTN","RORX006C",13,0)
 ; Return Values:
"RTN","RORX006C",14,0)
 ;       <0  Error code
"RTN","RORX006C",15,0)
 ;        0  Ok
"RTN","RORX006C",16,0)
 ;
"RTN","RORX006C",17,0)
PATIENTS(PRNTELMT,NODE) ;
"RTN","RORX006C",18,0)
 Q:$D(@NODE@("PAT"))<10 0
"RTN","RORX006C",19,0)
 N COUNT,DFN,ITEM,MAXUTNUM,NAME,NUM,RC,TMP
"RTN","RORX006C",20,0)
 S MAXUTNUM=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX006C",21,0)
 Q:MAXUTNUM'>0 0
"RTN","RORX006C",22,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,PRNTELMT)
"RTN","RORX006C",23,0)
 Q:TABLE<0 TABLE
"RTN","RORX006C",24,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PATIENTS")
"RTN","RORX006C",25,0)
 ;---
"RTN","RORX006C",26,0)
 S NUM="",(COUNT,RC)=0
"RTN","RORX006C",27,0)
 F  S NUM=$O(@NODE@("RES1",NUM),-1)  Q:NUM=""  D  Q:RC
"RTN","RORX006C",28,0)
 . S NAME=""
"RTN","RORX006C",29,0)
 . F  S NAME=$O(@NODE@("RES1",NUM,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX006C",30,0)
 . . S DFN=""
"RTN","RORX006C",31,0)
 . . F  S DFN=$O(@NODE@("RES1",NUM,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX006C",32,0)
 . . . S COUNT=COUNT+1  I COUNT>MAXUTNUM  S RC=1  Q
"RTN","RORX006C",33,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX006C",34,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX006C",35,0)
 . . . S TMP=$G(@NODE@("PAT",DFN))
"RTN","RORX006C",36,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(TMP,U),ITEM,2)
"RTN","RORX006C",37,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(TMP,U,2),ITEM,1)
"RTN","RORX006C",38,0)
 . . . S TMP=+$G(@NODE@("PAT",DFN,"O"))
"RTN","RORX006C",39,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NO",TMP,ITEM,3)
"RTN","RORX006C",40,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NR",NUM,ITEM,3)
"RTN","RORX006C",41,0)
 . . . S TMP=+$P($G(@NODE@("PAT",DFN,"R")),U,2)
"RTN","RORX006C",42,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NDT",TMP,ITEM,3)
"RTN","RORX006C",43,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX006C",44,0)
 ;
"RTN","RORX006C",45,0)
 ;***** NUMBERS OF PATIENTS AND RESULTS
"RTN","RORX006C",46,0)
 ;
"RTN","RORX006C",47,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX006C",48,0)
 ;
"RTN","RORX006C",49,0)
 ; NODE          Closed root of the category section
"RTN","RORX006C",50,0)
 ;               in the temporary global
"RTN","RORX006C",51,0)
 ;
"RTN","RORX006C",52,0)
 ; Return Values:
"RTN","RORX006C",53,0)
 ;       <0  Error code
"RTN","RORX006C",54,0)
 ;        0  Ok
"RTN","RORX006C",55,0)
 ;
"RTN","RORX006C",56,0)
RESULTS(PRNTELMT,NODE) ;
"RTN","RORX006C",57,0)
 Q:$D(@NODE@("RES1"))<10 0
"RTN","RORX006C",58,0)
 N ITEM,NUM,RC,TABLE
"RTN","RORX006C",59,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"RESULTS",,PRNTELMT)
"RTN","RORX006C",60,0)
 Q:TABLE<0 TABLE
"RTN","RORX006C",61,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","RESULTS")
"RTN","RORX006C",62,0)
 S NUM="",RC=0
"RTN","RORX006C",63,0)
 F  S NUM=$O(@NODE@("RES1",NUM),-1)  Q:NUM=""  D  Q:RC
"RTN","RORX006C",64,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"ITEM",,TABLE)
"RTN","RORX006C",65,0)
 . S TMP=+$G(@NODE@("RES1",NUM))
"RTN","RORX006C",66,0)
 . D ADDVAL^RORTSK11(RORTSK,"NP",TMP,ITEM,3)
"RTN","RORX006C",67,0)
 . D ADDVAL^RORTSK11(RORTSK,"NR",NUM,ITEM,3)
"RTN","RORX006C",68,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX006C",69,0)
 ;
"RTN","RORX006C",70,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX006C",71,0)
 ;
"RTN","RORX006C",72,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX006C",73,0)
 ;
"RTN","RORX006C",74,0)
 ; Return Values:
"RTN","RORX006C",75,0)
 ;       <0  Error code
"RTN","RORX006C",76,0)
 ;        0  Ok
"RTN","RORX006C",77,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX006C",78,0)
 ;
"RTN","RORX006C",79,0)
STORE(REPORT) ;
"RTN","RORX006C",80,0)
 N RORSONLY      ; Output summary only
"RTN","RORX006C",81,0)
 ;
"RTN","RORX006C",82,0)
 N ECNT,NODE,RC,RORI,SUBLST,TMP
"RTN","RORX006C",83,0)
 S RORSONLY=$$SMRYONLY^RORXU006()
"RTN","RORX006C",84,0)
 S (ECNT,RC)=0
"RTN","RORX006C",85,0)
 ;---
"RTN","RORX006C",86,0)
 S NODE=$NA(^TMP("RORX006",$J))
"RTN","RORX006C",87,0)
 Q:$D(@NODE)<10 0
"RTN","RORX006C",88,0)
 ;--- Tables
"RTN","RORX006C",89,0)
 S RC=$$LOOP^RORTSK01(0)  Q:RC<0 RC
"RTN","RORX006C",90,0)
 S RC=$$RESULTS(REPORT,NODE)
"RTN","RORX006C",91,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+RC
"RTN","RORX006C",92,0)
 ;---
"RTN","RORX006C",93,0)
 S RC=$$LOOP^RORTSK01(1/3)  Q:RC<0 RC
"RTN","RORX006C",94,0)
 S RC=$$TESTS(REPORT,NODE)
"RTN","RORX006C",95,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+RC
"RTN","RORX006C",96,0)
 ;---
"RTN","RORX006C",97,0)
 S RC=$$LOOP^RORTSK01(2/3)  Q:RC<0 RC
"RTN","RORX006C",98,0)
 S RC=$$PATIENTS(REPORT,NODE)
"RTN","RORX006C",99,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+RC
"RTN","RORX006C",100,0)
 ;--- Summary
"RTN","RORX006C",101,0)
 D ADDVAL^RORTSK11(RORTSK,"NO",+$G(@NODE@("ORD")),REPORT)
"RTN","RORX006C",102,0)
 S TMP=$G(@NODE@("RES"))
"RTN","RORX006C",103,0)
 D ADDVAL^RORTSK11(RORTSK,"NR",+$P(TMP,U),REPORT)
"RTN","RORX006C",104,0)
 D ADDVAL^RORTSK11(RORTSK,"NDT",+$P(TMP,U,2),REPORT)
"RTN","RORX006C",105,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+$G(@NODE@("PAT")),REPORT)
"RTN","RORX006C",106,0)
 ;---
"RTN","RORX006C",107,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX006C",108,0)
 ;
"RTN","RORX006C",109,0)
 ;***** LAB TESTS
"RTN","RORX006C",110,0)
 ;
"RTN","RORX006C",111,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX006C",112,0)
 ;
"RTN","RORX006C",113,0)
 ; NODE          Closed root of the category section
"RTN","RORX006C",114,0)
 ;               in the temporary global
"RTN","RORX006C",115,0)
 ;
"RTN","RORX006C",116,0)
 ; Return Values:
"RTN","RORX006C",117,0)
 ;       <0  Error code
"RTN","RORX006C",118,0)
 ;        0  Ok
"RTN","RORX006C",119,0)
 ;
"RTN","RORX006C",120,0)
TESTS(PRNTELMT,NODE) ;
"RTN","RORX006C",121,0)
 Q:$D(@NODE@("RES"))<10 0
"RTN","RORX006C",122,0)
 N IEN,ITEM,MINRPNUM,NAME,NUM,RC,TMP
"RTN","RORX006C",123,0)
 S MINRPNUM=$$PARAM^RORTSK01("MINRPNUM")
"RTN","RORX006C",124,0)
 Q:MINRPNUM'>0 0
"RTN","RORX006C",125,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"LABTESTS",,PRNTELMT)
"RTN","RORX006C",126,0)
 Q:TABLE<0 TABLE
"RTN","RORX006C",127,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","LABTESTS")
"RTN","RORX006C",128,0)
 ;---
"RTN","RORX006C",129,0)
 S NUM="",RC=0
"RTN","RORX006C",130,0)
 F  S NUM=$O(@NODE@("RES","B",NUM),-1)  Q:NUM<MINRPNUM  D  Q:RC
"RTN","RORX006C",131,0)
 . S NAME=""
"RTN","RORX006C",132,0)
 . F  S NAME=$O(@NODE@("RES","B",NUM,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX006C",133,0)
 . . S IEN=""
"RTN","RORX006C",134,0)
 . . F  S IEN=$O(@NODE@("RES","B",NUM,NAME,IEN))  Q:IEN=""  D  Q:RC
"RTN","RORX006C",135,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"LT",,TABLE)
"RTN","RORX006C",136,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX006C",137,0)
 . . . S TMP=+$G(@NODE@("RES",IEN,"P"))
"RTN","RORX006C",138,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NP",TMP,ITEM,3)
"RTN","RORX006C",139,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NR",NUM,ITEM,3)
"RTN","RORX006C",140,0)
 . . . S TMP=$G(@NODE@("RES",IEN,"M"))
"RTN","RORX006C",141,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"MAXNRPP",+$P(TMP,U),ITEM,3)
"RTN","RORX006C",142,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"MAXNP",+$P(TMP,U,2),ITEM,3)
"RTN","RORX006C",143,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX007")
0^176^B48286128
"RTN","RORX007",1,0)
RORX007 ;HCIOFO/BH,SG - RADIOLOGY UTILIZATION ; 10/14/05 1:37pm
"RTN","RORX007",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX007",3,0)
 ;
"RTN","RORX007",4,0)
 ; This routine uses the following IAs:
"RTN","RORX007",5,0)
 ;
"RTN","RORX007",6,0)
 ; #10061        DEM^VADPT (supported)
"RTN","RORX007",7,0)
 ;
"RTN","RORX007",8,0)
 Q
"RTN","RORX007",9,0)
 ;
"RTN","RORX007",10,0)
 ;***** COMPILES THE "RADIOLOGY UTILIZATION" REPORT
"RTN","RORX007",11,0)
 ; REPORT CODE: 007
"RTN","RORX007",12,0)
 ;
"RTN","RORX007",13,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX007",14,0)
 ;
"RTN","RORX007",15,0)
 ; The ^TMP("RORX007",$J) and ^TMP($J,"RAE1") global nodes are
"RTN","RORX007",16,0)
 ; used by this function.
"RTN","RORX007",17,0)
 ;
"RTN","RORX007",18,0)
 ; ^TMP("RORX007",$J,
"RTN","RORX007",19,0)
 ;
"RTN","RORX007",20,0)
 ;     "PAT",
"RTN","RORX007",21,0)
 ;       DFN,
"RTN","RORX007",22,0)
 ;         ProcName)     Number of procedures
"RTN","RORX007",23,0)
 ;
"RTN","RORX007",24,0)
 ;     "PATSORT",
"RTN","RORX007",25,0)
 ;       ProcQnty,
"RTN","RORX007",26,0)
 ;         Name,
"RTN","RORX007",27,0)
 ;           Last4)      Patient data
"RTN","RORX007",28,0)
 ;                         ^01: Number of different procedures
"RTN","RORX007",29,0)
 ;                         ^02: Date of death
"RTN","RORX007",30,0)
 ;
"RTN","RORX007",31,0)
 ;     "PROC",
"RTN","RORX007",32,0)
 ;       ProcName,
"RTN","RORX007",33,0)
 ;         DFN)          Number of procedures
"RTN","RORX007",34,0)
 ;
"RTN","RORX007",35,0)
 ;     "PROCSORT",
"RTN","RORX007",36,0)
 ;       ProcQnty,
"RTN","RORX007",37,0)
 ;         ProcName,
"RTN","RORX007",38,0)
 ;           CPT)        Number of individual patients
"RTN","RORX007",39,0)
 ;
"RTN","RORX007",40,0)
 ;     "TOTAL")          Category Totals
"RTN","RORX007",41,0)
 ;                         ^01: Total number of procedures
"RTN","RORX007",42,0)
 ;                         ^02: Number of different procedures
"RTN","RORX007",43,0)
 ;                         ^03: Total number of patients
"RTN","RORX007",44,0)
 ;                         ^04: Number of individual patients
"RTN","RORX007",45,0)
 ;
"RTN","RORX007",46,0)
 ; Return Values:
"RTN","RORX007",47,0)
 ;       <0  Error code
"RTN","RORX007",48,0)
 ;        0  Ok
"RTN","RORX007",49,0)
 ;
"RTN","RORX007",50,0)
RADUTL(RORTSK) ;
"RTN","RORX007",51,0)
 N ROREDT        ; End date
"RTN","RORX007",52,0)
 N RORREG        ; Registry IEN
"RTN","RORX007",53,0)
 N RORSDT        ; Start date
"RTN","RORX007",54,0)
 ;
"RTN","RORX007",55,0)
 N CNT,ECNT,RC,REPORT,RORPTN,SFLAGS,TMP
"RTN","RORX007",56,0)
 ;--- Root node of the report
"RTN","RORX007",57,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX007",58,0)
 Q:REPORT<0 REPORT
"RTN","RORX007",59,0)
 ;
"RTN","RORX007",60,0)
 ;--- Get and prepare the report parameters
"RTN","RORX007",61,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX007",62,0)
 S RC=$$PARAMS^RORX007A(REPORT,.RORSDT,.ROREDT,.SFLAGS)
"RTN","RORX007",63,0)
 Q:RC<0 RC
"RTN","RORX007",64,0)
 ;
"RTN","RORX007",65,0)
 ;--- Initialize constants and variables
"RTN","RORX007",66,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX007",67,0)
 S ECNT=0  K ^TMP("RORX007",$J)
"RTN","RORX007",68,0)
 ;
"RTN","RORX007",69,0)
 ;--- Report header
"RTN","RORX007",70,0)
 S RC=$$HEADER^RORX007A(REPORT)  Q:RC<0 RC
"RTN","RORX007",71,0)
 ;
"RTN","RORX007",72,0)
 D
"RTN","RORX007",73,0)
 . ;--- Query the registry
"RTN","RORX007",74,0)
 . D TPPSETUP^RORTSK01(75)
"RTN","RORX007",75,0)
 . S RC=$$QUERY^RORX007A(SFLAGS)
"RTN","RORX007",76,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX007",77,0)
 . ;--- Sort the data
"RTN","RORX007",78,0)
 . D TPPSETUP^RORTSK01(10)
"RTN","RORX007",79,0)
 . S RC=$$SORT()
"RTN","RORX007",80,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX007",81,0)
 . ;--- Store the results
"RTN","RORX007",82,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX007",83,0)
 . S RC=$$STORE(REPORT)
"RTN","RORX007",84,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX007",85,0)
 ;
"RTN","RORX007",86,0)
 ;--- Cleanup
"RTN","RORX007",87,0)
 K ^TMP("RORX007",$J),^TMP($J,"RAE1")
"RTN","RORX007",88,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX007",89,0)
 ;
"RTN","RORX007",90,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX007",91,0)
 ;
"RTN","RORX007",92,0)
 ; SPCNT         Number of patients selected for the report
"RTN","RORX007",93,0)
 ;
"RTN","RORX007",94,0)
 ; Return Values:
"RTN","RORX007",95,0)
 ;       <0  Error code
"RTN","RORX007",96,0)
 ;        0  Ok
"RTN","RORX007",97,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX007",98,0)
 ;
"RTN","RORX007",99,0)
SORT(SPCNT) ;
"RTN","RORX007",100,0)
 N DFN,DOD,DPCNT,ECNT,NAME,NODE,PRCNT,PQ,PRN,RC,TMP,TOTAL,VA,VADM,VAHOW,VAROOT
"RTN","RORX007",101,0)
 S (ECNT,RC)=0
"RTN","RORX007",102,0)
 S NODE=$NA(^TMP("RORX007",$J))
"RTN","RORX007",103,0)
 Q:$D(@NODE)<10 0
"RTN","RORX007",104,0)
 ;--- Procedures
"RTN","RORX007",105,0)
 S RC=$$LOOP^RORTSK01(0)  Q:RC<0 RC
"RTN","RORX007",106,0)
 S PRN=""
"RTN","RORX007",107,0)
 F  S PRN=$O(@NODE@("PROC",PRN))  Q:PRN=""  D
"RTN","RORX007",108,0)
 . S (DPCNT,PRCNT)=0
"RTN","RORX007",109,0)
 . S DFN=""
"RTN","RORX007",110,0)
 . F  S DFN=$O(@NODE@("PROC",PRN,DFN))  Q:DFN=""  D
"RTN","RORX007",111,0)
 . . S PQ=$G(@NODE@("PROC",PRN,DFN))
"RTN","RORX007",112,0)
 . . S DPCNT=DPCNT+1,PRCNT=PRCNT+PQ
"RTN","RORX007",113,0)
 . ;---
"RTN","RORX007",114,0)
 . S @NODE@("PROCSORT",PRCNT,$P(PRN,U),$P(PRN,U,2))=DPCNT
"RTN","RORX007",115,0)
 . S TOTAL("DPR")=$G(TOTAL("DPR"))+1      ; Different procedures
"RTN","RORX007",116,0)
 . S TOTAL("TPT")=$G(TOTAL("TPT"))+DPCNT  ; Number of patients
"RTN","RORX007",117,0)
 K @NODE@("PROC")
"RTN","RORX007",118,0)
 ;--- Patients
"RTN","RORX007",119,0)
 S RC=$$LOOP^RORTSK01(0.5)  Q:RC<0 RC
"RTN","RORX007",120,0)
 S DFN=""
"RTN","RORX007",121,0)
 F  S DFN=$O(@NODE@("PAT",DFN))  Q:DFN=""  D
"RTN","RORX007",122,0)
 . S (DPCNT,PRCNT)=0
"RTN","RORX007",123,0)
 . D DEM^VADPT
"RTN","RORX007",124,0)
 . S NAME=$G(VADM(1))  Q:NAME=""
"RTN","RORX007",125,0)
 . S LAST4=$G(VA("BID"))  S:LAST4="" LAST4=" "
"RTN","RORX007",126,0)
 . S DOD=$$DATE^RORXU002($P(VADM(6),U)\1)
"RTN","RORX007",127,0)
 . S PRN=""
"RTN","RORX007",128,0)
 . F  S PRN=$O(@NODE@("PAT",DFN,PRN))  Q:PRN=""  D
"RTN","RORX007",129,0)
 . . S PQ=$G(@NODE@("PAT",DFN,PRN))
"RTN","RORX007",130,0)
 . . S DPCNT=DPCNT+1,PRCNT=PRCNT+PQ
"RTN","RORX007",131,0)
 . ;---
"RTN","RORX007",132,0)
 . S @NODE@("PATSORT",PRCNT,NAME,LAST4)=DPCNT_U_DOD
"RTN","RORX007",133,0)
 . S TOTAL("TPR")=$G(TOTAL("TPR"))+PRCNT  ; Number of procedures
"RTN","RORX007",134,0)
 . S TOTAL("DPT")=$G(TOTAL("DPT"))+1      ; Different patients
"RTN","RORX007",135,0)
 K @NODE@("PAT")
"RTN","RORX007",136,0)
 ;--- Totals
"RTN","RORX007",137,0)
 S TMP=$G(TOTAL("TPR"))_U_$G(TOTAL("DPR"))
"RTN","RORX007",138,0)
 S @NODE@("TOTAL")=TMP_U_$G(TOTAL("TPT"))_U_$G(TOTAL("DPT"))
"RTN","RORX007",139,0)
 ;---
"RTN","RORX007",140,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX007",141,0)
 ;
"RTN","RORX007",142,0)
 ;***** STORES THE RESULTS
"RTN","RORX007",143,0)
 ;
"RTN","RORX007",144,0)
 ; Return Values:
"RTN","RORX007",145,0)
 ;       <0  Error code
"RTN","RORX007",146,0)
 ;        0  Ok
"RTN","RORX007",147,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX007",148,0)
 ;
"RTN","RORX007",149,0)
STORE(PARTAG) ;
"RTN","RORX007",150,0)
 N RORSONLY      ; Output summary only
"RTN","RORX007",151,0)
 ;
"RTN","RORX007",152,0)
 N RC,TMP
"RTN","RORX007",153,0)
 S RORSONLY=$$SMRYONLY^RORXU006()
"RTN","RORX007",154,0)
 S RC=0
"RTN","RORX007",155,0)
 ;--- Tables
"RTN","RORX007",156,0)
 Q:$D(^TMP("RORX007",$J))<10 0
"RTN","RORX007",157,0)
 ;--- Procedures
"RTN","RORX007",158,0)
 S RC=$$LOOP^RORTSK01(0)    Q:RC<0 RC
"RTN","RORX007",159,0)
 S RC=$$TBLPROC(PARTAG)     Q:RC<0 RC
"RTN","RORX007",160,0)
 ;--- Patients
"RTN","RORX007",161,0)
 S RC=$$LOOP^RORTSK01(0.5)  Q:RC<0 RC
"RTN","RORX007",162,0)
 S RC=$$TBLPAT(PARTAG)      Q:RC<0 RC
"RTN","RORX007",163,0)
 ;--- Totals
"RTN","RORX007",164,0)
 S TMP=$G(^TMP("RORX007",$J,"TOTAL"))
"RTN","RORX007",165,0)
 D ADDVAL^RORTSK11(RORTSK,"NPR",$P(TMP,U,1),PARTAG)
"RTN","RORX007",166,0)
 D ADDVAL^RORTSK11(RORTSK,"NDP",$P(TMP,U,2),PARTAG)
"RTN","RORX007",167,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",$P(TMP,U,4),PARTAG)
"RTN","RORX007",168,0)
 ;---
"RTN","RORX007",169,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX007",170,0)
 ;
"RTN","RORX007",171,0)
 ;***** STORES THE TABLE OF PATIENTS
"RTN","RORX007",172,0)
 ;
"RTN","RORX007",173,0)
 ; PRNTELMT      IEN of the parent tag
"RTN","RORX007",174,0)
 ;
"RTN","RORX007",175,0)
 ; Return Values:
"RTN","RORX007",176,0)
 ;       <0  Error code
"RTN","RORX007",177,0)
 ;        0  Ok
"RTN","RORX007",178,0)
 ;
"RTN","RORX007",179,0)
TBLPAT(PRNTELMT) ;
"RTN","RORX007",180,0)
 N BUF,ITEM,LAST4,MAXUTNUM,NAME,NODE,PRCNT,RC,TABLE,TMP,UTNUM
"RTN","RORX007",181,0)
 S MAXUTNUM=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX007",182,0)
 Q:MAXUTNUM'>0 0
"RTN","RORX007",183,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,PRNTELMT)
"RTN","RORX007",184,0)
 Q:TABLE<0 TABLE
"RTN","RORX007",185,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PATIENTS")
"RTN","RORX007",186,0)
 S NODE=$NA(^TMP("RORX007",$J,"PATSORT"))
"RTN","RORX007",187,0)
 ;--- Table
"RTN","RORX007",188,0)
 S PRCNT="",(RC,UTNUM)=0
"RTN","RORX007",189,0)
 F  S PRCNT=$O(@NODE@(PRCNT),-1)  Q:PRCNT=""  D  Q:RC
"RTN","RORX007",190,0)
 . S NAME=""
"RTN","RORX007",191,0)
 . F  S NAME=$O(@NODE@(PRCNT,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX007",192,0)
 . . S LAST4=""
"RTN","RORX007",193,0)
 . . F  S LAST4=$O(@NODE@(PRCNT,NAME,LAST4))  Q:LAST4=""  D  Q:RC
"RTN","RORX007",194,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX007",195,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX007",196,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,1)
"RTN","RORX007",197,0)
 . . . S BUF=@NODE@(PRCNT,NAME,LAST4)
"RTN","RORX007",198,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(BUF,U,2),ITEM,1)
"RTN","RORX007",199,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"TOTAL",PRCNT,ITEM,1)
"RTN","RORX007",200,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"UNIQUE",+BUF,ITEM,1)
"RTN","RORX007",201,0)
 . . . S UTNUM=UTNUM+1  S:UTNUM'<MAXUTNUM RC=1
"RTN","RORX007",202,0)
 Q:RC<0 RC
"RTN","RORX007",203,0)
 ;---
"RTN","RORX007",204,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX007",205,0)
 ;
"RTN","RORX007",206,0)
 ;***** STORES THE TABLE OF PROCEDURES
"RTN","RORX007",207,0)
 ;
"RTN","RORX007",208,0)
 ; PRNTELMT      IEN of the parent tag
"RTN","RORX007",209,0)
 ;
"RTN","RORX007",210,0)
 ; Return Values:
"RTN","RORX007",211,0)
 ;       <0  Error code
"RTN","RORX007",212,0)
 ;        0  Ok
"RTN","RORX007",213,0)
 ;
"RTN","RORX007",214,0)
TBLPROC(PRNTELMT) ;
"RTN","RORX007",215,0)
 N CPT,ITEM,MINRPNUM,NODE,PRCNT,PRN,TABLE,TMP
"RTN","RORX007",216,0)
 S MINRPNUM=$$PARAM^RORTSK01("MINRPNUM")
"RTN","RORX007",217,0)
 Q:MINRPNUM'>0 0
"RTN","RORX007",218,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PROCEDURES",,PRNTELMT)
"RTN","RORX007",219,0)
 Q:TABLE<0 TABLE
"RTN","RORX007",220,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PROCEDURES")
"RTN","RORX007",221,0)
 S NODE=$NA(^TMP("RORX007",$J,"PROCSORT"))
"RTN","RORX007",222,0)
 ;--- Table
"RTN","RORX007",223,0)
 S PRCNT="",RC=0
"RTN","RORX007",224,0)
 F  S PRCNT=$O(@NODE@(PRCNT),-1)  Q:PRCNT<MINRPNUM  D  Q:RC
"RTN","RORX007",225,0)
 . S PRN=""
"RTN","RORX007",226,0)
 . F  S PRN=$O(@NODE@(PRCNT,PRN))  Q:PRN=""  D  Q:RC
"RTN","RORX007",227,0)
 . . S CPT=""
"RTN","RORX007",228,0)
 . . F  S CPT=$O(@NODE@(PRCNT,PRN,CPT))  Q:CPT=""  D  Q:RC
"RTN","RORX007",229,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PROCEDURE",,TABLE)
"RTN","RORX007",230,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",PRN,ITEM,1)
"RTN","RORX007",231,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"CPT",CPT,ITEM,2)
"RTN","RORX007",232,0)
 . . . S TMP=+@NODE@(PRCNT,PRN,CPT)
"RTN","RORX007",233,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"PATIENTS",TMP,ITEM,1)
"RTN","RORX007",234,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"TOTAL",PRCNT,ITEM,1)
"RTN","RORX007",235,0)
 Q:RC<0 RC
"RTN","RORX007",236,0)
 ;---
"RTN","RORX007",237,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX007A")
0^177^B11759892
"RTN","RORX007A",1,0)
RORX007A ;HCIOFO/BH,SG - RADILOGY UTILIZATION (OVERFLOW) ; 9/19/05 8:58am
"RTN","RORX007A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX007A",3,0)
 ;
"RTN","RORX007A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX007A",5,0)
 ;
"RTN","RORX007A",6,0)
 ; #2043         EN1^RAO7PC1 (supported)
"RTN","RORX007A",7,0)
 ;
"RTN","RORX007A",8,0)
 Q
"RTN","RORX007A",9,0)
 ;
"RTN","RORX007A",10,0)
 ;***** APPENDS MODIFIERS TO THE CPT CODE
"RTN","RORX007A",11,0)
 ;
"RTN","RORX007A",12,0)
 ; CPT           CPT code
"RTN","RORX007A",13,0)
 ;
"RTN","RORX007A",14,0)
 ; NODE          Closed root of the exam data node returned
"RTN","RORX007A",15,0)
 ;               by the EN1^RAO7PC1
"RTN","RORX007A",16,0)
 ;
"RTN","RORX007A",17,0)
CPTMOD(CPT,NODE) ;
"RTN","RORX007A",18,0)
 N CPM,RORIM
"RTN","RORX007A",19,0)
 S RORIM=""
"RTN","RORX007A",20,0)
 F  S RORIM=$O(@NODE@("CMOD",RORIM))  Q:RORIM=""  D
"RTN","RORX007A",21,0)
 . S CPM=$P($G(@NODE@("CMOD",RORIM)),U)
"RTN","RORX007A",22,0)
 . S:CPM'="" CPT=CPT_"-"_CPM
"RTN","RORX007A",23,0)
 Q CPT
"RTN","RORX007A",24,0)
 ;
"RTN","RORX007A",25,0)
 ;***** LOADS AND PROCESSES THE RADILOGY DATA
"RTN","RORX007A",26,0)
 ;
"RTN","RORX007A",27,0)
 ; DFN           Patient IEN (in file #2)
"RTN","RORX007A",28,0)
 ;
"RTN","RORX007A",29,0)
 ; Return Values:
"RTN","RORX007A",30,0)
 ;       <0  Error code
"RTN","RORX007A",31,0)
 ;        0  Ok
"RTN","RORX007A",32,0)
 ;
"RTN","RORX007A",33,0)
GETDATA(DFN) ;
"RTN","RORX007A",34,0)
 N CPT,EXAMID,NODE,PRNAME,RORBUF
"RTN","RORX007A",35,0)
 ;--- Get the data
"RTN","RORX007A",36,0)
 D EN1^RAO7PC1(DFN,RORSDT,ROREDT,999999)
"RTN","RORX007A",37,0)
 Q:'$D(^TMP($J,"RAE1",PATIEN)) 0
"RTN","RORX007A",38,0)
 ;
"RTN","RORX007A",39,0)
 ;--- Process the data
"RTN","RORX007A",40,0)
 S EXAMID=""
"RTN","RORX007A",41,0)
 F  S EXAMID=$O(^TMP($J,"RAE1",DFN,EXAMID))  Q:EXAMID=""  D
"RTN","RORX007A",42,0)
 . S NODE=$NA(^TMP($J,"RAE1",DFN,EXAMID))
"RTN","RORX007A",43,0)
 . S RORBUF=$G(@NODE),CPT=$$CPTMOD($P(RORBUF,U,10),NODE)
"RTN","RORX007A",44,0)
 . ;--- Get Procedure Name
"RTN","RORX007A",45,0)
 . S PRNAME=$E($P(RORBUF,U),1,30)  Q:PRNAME=""
"RTN","RORX007A",46,0)
 . S PRNAME=PRNAME_U_$S(CPT'="":CPT,1:" ")
"RTN","RORX007A",47,0)
 . ;--- Increment the counters
"RTN","RORX007A",48,0)
 . S ^(DFN)=$G(^TMP("RORX007",$J,"PROC",PRNAME,DFN))+1
"RTN","RORX007A",49,0)
 . S ^(PRNAME)=$G(^TMP("RORX007",$J,"PAT",DFN,PRNAME))+1
"RTN","RORX007A",50,0)
 ;
"RTN","RORX007A",51,0)
 ;--- Cleanup
"RTN","RORX007A",52,0)
 K ^TMP($J,"RAE1")
"RTN","RORX007A",53,0)
 Q 0
"RTN","RORX007A",54,0)
 ;
"RTN","RORX007A",55,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX007A",56,0)
 ;
"RTN","RORX007A",57,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX007A",58,0)
 ;
"RTN","RORX007A",59,0)
 ; Return Values:
"RTN","RORX007A",60,0)
 ;       <0  Error code
"RTN","RORX007A",61,0)
 ;        0  Ok
"RTN","RORX007A",62,0)
 ;
"RTN","RORX007A",63,0)
HEADER(PARTAG) ;
"RTN","RORX007A",64,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,TOTAL,UNIQUE)
"RTN","RORX007A",65,0)
 ;;PROCEDURES(#,NAME,CPT,PATIENTS,TOTAL)
"RTN","RORX007A",66,0)
 ;
"RTN","RORX007A",67,0)
 N HEADER,RC
"RTN","RORX007A",68,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX007A",69,0)
 Q:HEADER<0 HEADER
"RTN","RORX007A",70,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX007A",HEADER)
"RTN","RORX007A",71,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX007A",72,0)
 ;
"RTN","RORX007A",73,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX007A",74,0)
 ;
"RTN","RORX007A",75,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX007A",76,0)
 ;
"RTN","RORX007A",77,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX007A",78,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX007A",79,0)
 ;
"RTN","RORX007A",80,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX007A",81,0)
 ;               returned via this parameter
"RTN","RORX007A",82,0)
 ;
"RTN","RORX007A",83,0)
 ; Return Values:
"RTN","RORX007A",84,0)
 ;       <0  Error code
"RTN","RORX007A",85,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX007A",86,0)
 ;
"RTN","RORX007A",87,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX007A",88,0)
 N NAME,PARAMS,TMP
"RTN","RORX007A",89,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX007A",90,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX007A",91,0)
 ;--- Additional parameters
"RTN","RORX007A",92,0)
 F NAME="MAXUTNUM","MINRPNUM"  D
"RTN","RORX007A",93,0)
 . S TMP=$$PARAM^RORTSK01(NAME)
"RTN","RORX007A",94,0)
 . D:TMP'="" ADDVAL^RORTSK11(RORTSK,NAME,TMP,PARAMS)
"RTN","RORX007A",95,0)
 ;---
"RTN","RORX007A",96,0)
 Q PARAMS
"RTN","RORX007A",97,0)
 ;
"RTN","RORX007A",98,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX007A",99,0)
 ;
"RTN","RORX007A",100,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX007A",101,0)
 ;
"RTN","RORX007A",102,0)
 ; Return Values:
"RTN","RORX007A",103,0)
 ;       <0  Error code
"RTN","RORX007A",104,0)
 ;        0  Ok
"RTN","RORX007A",105,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX007A",106,0)
 ;
"RTN","RORX007A",107,0)
QUERY(FLAGS) ;
"RTN","RORX007A",108,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,RORMSG,TMP,XREFNODE
"RTN","RORX007A",109,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX007A",110,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX007A",111,0)
 ;--- Browse through the registry records
"RTN","RORX007A",112,0)
 S IEN=0
"RTN","RORX007A",113,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX007A",114,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX007A",115,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX007A",116,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX007A",117,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX007A",118,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX007A",119,0)
 . ;
"RTN","RORX007A",120,0)
 . ;--- Get the patient IEN (DFN)
"RTN","RORX007A",121,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX007A",122,0)
 . ;
"RTN","RORX007A",123,0)
 . ;--- Get the radiology data
"RTN","RORX007A",124,0)
 . S RC=$$GETDATA(PATIEN)
"RTN","RORX007A",125,0)
 . I RC  S ECNT=ECNT+1  Q:RC<0
"RTN","RORX007A",126,0)
 ;---
"RTN","RORX007A",127,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX007A",128,0)
 ;
"RTN","RORX007A",129,0)
 ;***** PLURAL/SINGULAR
"RTN","RORX007A",130,0)
SRPL(QNTY,WORD,SQ) ;
"RTN","RORX007A",131,0)
 Q $S('$G(SQ):QNTY_" ",1:"")_$P(WORD,U,$S(QNTY=1:1,1:2))
"RTN","RORX008")
0^15^B8730425
"RTN","RORX008",1,0)
RORX008 ;HOIFO/BH,SG - VERA REIMBURSEMENT REPORT ; 11/8/05 8:38am
"RTN","RORX008",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX008",3,0)
 ;
"RTN","RORX008",4,0)
 ;--------------------------------------------------------------------
"RTN","RORX008",5,0)
 ; Registry: [VA ICR]
"RTN","RORX008",6,0)
 ;--------------------------------------------------------------------
"RTN","RORX008",7,0)
 Q
"RTN","RORX008",8,0)
 ;
"RTN","RORX008",9,0)
 ;***** COMPILES THE "VERA REIMBURSEMENT" REPORT
"RTN","RORX008",10,0)
 ; REPORT CODE: 008
"RTN","RORX008",11,0)
 ;
"RTN","RORX008",12,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX008",13,0)
 ;
"RTN","RORX008",14,0)
 ; The ^TMP("RORX008",$J) global node is used by this function.
"RTN","RORX008",15,0)
 ;
"RTN","RORX008",16,0)
 ; ^TMP("RORX008",$J,
"RTN","RORX008",17,0)
 ;
"RTN","RORX008",18,0)
 ;   "DRG",
"RTN","RORX008",19,0)
 ;     GenDrugIEN,       Generic drug name
"RTN","RORX008",20,0)
 ;       0)              Number of HIV+ patients
"RTN","RORX008",21,0)
 ;       1)              Number of Clinical AIDS patients
"RTN","RORX008",22,0)
 ;
"RTN","RORX008",23,0)
 ;   "PAT",              Totals
"RTN","RORX008",24,0)
 ;                         ^01: Number of basic care patients
"RTN","RORX008",25,0)
 ;                         ^02: Number of complex care patients
"RTN","RORX008",26,0)
 ;                         ^03: Number of patients received ARVs
"RTN","RORX008",27,0)
 ;     DFN)              Patient Descriptor
"RTN","RORX008",28,0)
 ;                         ^01: Las 4 digits of SSN
"RTN","RORX008",29,0)
 ;                         ^02: Name
"RTN","RORX008",30,0)
 ;                         ^03: Date of Death (FileMan)
"RTN","RORX008",31,0)
 ;                         ^04: Received ARV drugs(0/1)
"RTN","RORX008",32,0)
 ;                         ^05: Complex care (0/1)
"RTN","RORX008",33,0)
 ;
"RTN","RORX008",34,0)
 ; Return Values:
"RTN","RORX008",35,0)
 ;       <0  Error code
"RTN","RORX008",36,0)
 ;        0  Ok
"RTN","RORX008",37,0)
 ;
"RTN","RORX008",38,0)
ARVREIMB(RORTSK) ;
"RTN","RORX008",39,0)
 N ROREDT        ; End date
"RTN","RORX008",40,0)
 N ROREDT1       ; End date + 1
"RTN","RORX008",41,0)
 N RORREG        ; Registry IEN
"RTN","RORX008",42,0)
 N RORSDT        ; Start date
"RTN","RORX008",43,0)
 N RORXL         ; Drug list for the pharmacy search API
"RTN","RORX008",44,0)
 ;
"RTN","RORX008",45,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX008",46,0)
 K ^TMP("RORX008",$J)
"RTN","RORX008",47,0)
 S RORXL="",(ECNT,RC)=0
"RTN","RORX008",48,0)
 ;--- Root node of the report
"RTN","RORX008",49,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX008",50,0)
 Q:REPORT<0 REPORT
"RTN","RORX008",51,0)
 ;
"RTN","RORX008",52,0)
 D
"RTN","RORX008",53,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX008",54,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX008",55,0)
 . S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0
"RTN","RORX008",56,0)
 . S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1)
"RTN","RORX008",57,0)
 . ;--- Report header
"RTN","RORX008",58,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX008",59,0)
 . ;--- Query the registry
"RTN","RORX008",60,0)
 . D TPPSETUP^RORTSK01(75)
"RTN","RORX008",61,0)
 . S RC=$$QUERY^RORX008A(SFLAGS)
"RTN","RORX008",62,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX008",63,0)
 . ;--- Store the results
"RTN","RORX008",64,0)
 . D TPPSETUP^RORTSK01(25)
"RTN","RORX008",65,0)
 . S RC=$$STORE^RORX008A(REPORT)
"RTN","RORX008",66,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX008",67,0)
 ;
"RTN","RORX008",68,0)
 ;--- Cleanup
"RTN","RORX008",69,0)
 K ^TMP("RORX008",$J)
"RTN","RORX008",70,0)
 D FREE^RORTMP(RORXL)
"RTN","RORX008",71,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX008",72,0)
 ;
"RTN","RORX008",73,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX008",74,0)
 ;
"RTN","RORX008",75,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX008",76,0)
 ;
"RTN","RORX008",77,0)
 ; Return Values:
"RTN","RORX008",78,0)
 ;       <0  Error code
"RTN","RORX008",79,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX008",80,0)
 ;
"RTN","RORX008",81,0)
HEADER(PARTAG) ;
"RTN","RORX008",82,0)
 ;;DRUGS(#,NAME,NP,NPHIV,NPAIDS)         ^I $$PARAM^RORTSK01("OPTIONS","REGMEDSMRY")
"RTN","RORX008",83,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,AIDSTAT,ARV,COMPLEX)^I $$PARAM^RORTSK01("OPTIONS","PTLIST")
"RTN","RORX008",84,0)
 ;
"RTN","RORX008",85,0)
 N HEADER,RC
"RTN","RORX008",86,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX008",87,0)
 Q:HEADER<0 HEADER
"RTN","RORX008",88,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX008",HEADER)
"RTN","RORX008",89,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX008",90,0)
 ;
"RTN","RORX008",91,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX008",92,0)
 ;
"RTN","RORX008",93,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX008",94,0)
 ;
"RTN","RORX008",95,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX008",96,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX008",97,0)
 ;
"RTN","RORX008",98,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX008",99,0)
 ;               returned via this parameter
"RTN","RORX008",100,0)
 ;
"RTN","RORX008",101,0)
 ; Return Values:
"RTN","RORX008",102,0)
 ;       <0  Error code
"RTN","RORX008",103,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX008",104,0)
 ;
"RTN","RORX008",105,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX008",106,0)
 N PARAMS,TMP
"RTN","RORX008",107,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX008",108,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX008",109,0)
 ;--- Process the drug list and options
"RTN","RORX008",110,0)
 S RORTSK("PARAMS","DRUGS","A","REGMEDS")=1
"RTN","RORX008",111,0)
 S TMP=$$DRUGLST^RORXU007(.RORTSK,PARAMS,.RORXL)
"RTN","RORX008",112,0)
 Q:TMP<0 TMP
"RTN","RORX008",113,0)
 ;---
"RTN","RORX008",114,0)
 Q PARAMS
"RTN","RORX008A")
0^16^B27604999
"RTN","RORX008A",1,0)
RORX008A ;HOIFO/BH,SG - VERA REIMBURSEMENT REPORT ; 10/6/05 1:00pm
"RTN","RORX008A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX008A",3,0)
 ;
"RTN","RORX008A",4,0)
 Q
"RTN","RORX008A",5,0)
 ;
"RTN","RORX008A",6,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX008A",7,0)
 ;
"RTN","RORX008A",8,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX008A",9,0)
 ;
"RTN","RORX008A",10,0)
 ; Return Values:
"RTN","RORX008A",11,0)
 ;       <0  Error code
"RTN","RORX008A",12,0)
 ;        0  Ok
"RTN","RORX008A",13,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX008A",14,0)
 ;
"RTN","RORX008A",15,0)
QUERY(FLAGS) ;
"RTN","RORX008A",16,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX008A",17,0)
 ;
"RTN","RORX008A",18,0)
 N CLINAIDS,CMPXCARE,CNT,CNTARV,CNTBASIC,CNTCMPX,ECNT,IEN,NAME,PATIEN,RC,RORIEN,RORXDST,TMP,UTLCHK,VA,VADM,VAERR,XREFNODE
"RTN","RORX008A",19,0)
 ;
"RTN","RORX008A",20,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX008A",21,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX008A",22,0)
 S (CNT,CNTARV,CNTBASIC,CNTCMPX,ECNT,RC)=0
"RTN","RORX008A",23,0)
 S UTLCHK("ALL")=""
"RTN","RORX008A",24,0)
 ;
"RTN","RORX008A",25,0)
 ;--- Prepare parameters for the pharmacy search API
"RTN","RORX008A",26,0)
 S RORXDST("RORCB")="$$RXSCB^RORX008A"
"RTN","RORX008A",27,0)
 S TMP=$$PARAM^RORTSK01("OPTIONS","REGMEDSMRY")
"RTN","RORX008A",28,0)
 S RORXDST("SINGLE")='TMP!'$$PARAM^RORTSK01("PATIENTS","COMPLEX")
"RTN","RORX008A",29,0)
 ;
"RTN","RORX008A",30,0)
 ;--- Browse through the registry records
"RTN","RORX008A",31,0)
 S RORIEN=0
"RTN","RORX008A",32,0)
 F  S RORIEN=$O(@XREFNODE@(RORIEN))  Q:RORIEN'>0  D  Q:RC<0
"RTN","RORX008A",33,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX008A",34,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX008A",35,0)
 . S CNT=CNT+1
"RTN","RORX008A",36,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX008A",37,0)
 . Q:$$SKIP^RORXU005(RORIEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX008A",38,0)
 . ;
"RTN","RORX008A",39,0)
 . ;--- Get the patient IEN (DFN)
"RTN","RORX008A",40,0)
 . S PATIEN=$$PTIEN^RORUTL01(RORIEN)  Q:PATIEN'>0
"RTN","RORX008A",41,0)
 . ;
"RTN","RORX008A",42,0)
 . ;--- Skip Clinical AIDS if Complex Care was not requested
"RTN","RORX008A",43,0)
 . S CMPXCARE=0
"RTN","RORX008A",44,0)
 . S CLINAIDS=$S($$CLINAIDS^RORHIVUT(RORIEN,ROREDT):1,1:0)
"RTN","RORX008A",45,0)
 . I CLINAIDS  Q:'$$PARAM^RORTSK01("PATIENTS","COMPLEX")  S CMPXCARE=1
"RTN","RORX008A",46,0)
 . ;
"RTN","RORX008A",47,0)
 . ;--- Skip a patient without utlilization
"RTN","RORX008A",48,0)
 . Q:'$$UTIL^RORXU003(RORSDT,ROREDT,PATIEN,.UTLCHK)
"RTN","RORX008A",49,0)
 . ;
"RTN","RORX008A",50,0)
 . ;--- Search for pharmacy data
"RTN","RORX008A",51,0)
 . K RORXDST("ARV")
"RTN","RORX008A",52,0)
 . S TMP=$$RXSEARCH^RORUTL14(PATIEN,RORXL,.RORXDST,"EIOV",RORSDT,ROREDT1)
"RTN","RORX008A",53,0)
 . I TMP<0  S ECNT=ECNT+1  Q
"RTN","RORX008A",54,0)
 . I $D(RORXDST("ARV"))  Q:'$$PARAM^RORTSK01("PATIENTS","COMPLEX")  D
"RTN","RORX008A",55,0)
 . . S IEN=0
"RTN","RORX008A",56,0)
 . . F  S IEN=$O(RORXDST("ARV",IEN))  Q:IEN'>0  D
"RTN","RORX008A",57,0)
 . . . D:'$D(^TMP("RORX008",$J,"DRG",IEN))
"RTN","RORX008A",58,0)
 . . . . S ^TMP("RORX008",$J,"DRG",IEN)=RORXDST("ARV",IEN)
"RTN","RORX008A",59,0)
 . . . S ^(CLINAIDS)=$G(^TMP("RORX008",$J,"DRG",IEN,CLINAIDS))+1
"RTN","RORX008A",60,0)
 . . S CMPXCARE=1,CNTARV=CNTARV+1
"RTN","RORX008A",61,0)
 . ;
"RTN","RORX008A",62,0)
 . ;--- Skip Basic Care if it was not requested
"RTN","RORX008A",63,0)
 . I CMPXCARE  S CNTCMPX=CNTCMPX+1
"RTN","RORX008A",64,0)
 . E  Q:'$$PARAM^RORTSK01("PATIENTS","BASIC")  S CNTBASIC=CNTBASIC+1
"RTN","RORX008A",65,0)
 . ;
"RTN","RORX008A",66,0)
 . D:$$PARAM^RORTSK01("OPTIONS","PTLIST")
"RTN","RORX008A",67,0)
 . . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX008A",68,0)
 . . S TMP=$$DATE^RORXU002(VADM(6)\1)
"RTN","RORX008A",69,0)
 . . S TMP=TMP_U_($D(RORXDST("ARV"))>0)_U_CMPXCARE_U_CLINAIDS
"RTN","RORX008A",70,0)
 . . S ^TMP("RORX008",$J,"PAT",PATIEN)=VA("BID")_U_VADM(1)_U_TMP
"RTN","RORX008A",71,0)
 ;
"RTN","RORX008A",72,0)
 ;--- Totals
"RTN","RORX008A",73,0)
 S ^TMP("RORX008",$J,"PAT")=CNTBASIC_U_CNTCMPX_U_CNTARV
"RTN","RORX008A",74,0)
 ;---
"RTN","RORX008A",75,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX008A",76,0)
 ;
"RTN","RORX008A",77,0)
 ;***** CALLBACK FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORX008A",78,0)
RXSCB(ROR8DST,ORDER,ORDFLG,DRUG,DATE) ;
"RTN","RORX008A",79,0)
 N CA,IEN,NAME
"RTN","RORX008A",80,0)
 S IEN=+ROR8DST("RORXGEN"),NAME=$P(ROR8DST("RORXGEN"),U,2)
"RTN","RORX008A",81,0)
 Q:(IEN'>0)!(NAME="") 1
"RTN","RORX008A",82,0)
 ;---
"RTN","RORX008A",83,0)
 S ROR8DST("ARV")=""  Q:ROR8DST("SINGLE") 2
"RTN","RORX008A",84,0)
 ;---
"RTN","RORX008A",85,0)
 S ROR8DST("ARV",IEN)=NAME
"RTN","RORX008A",86,0)
 Q 0
"RTN","RORX008A",87,0)
 ;
"RTN","RORX008A",88,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX008A",89,0)
 ;
"RTN","RORX008A",90,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX008A",91,0)
 ;
"RTN","RORX008A",92,0)
 ; Return Values:
"RTN","RORX008A",93,0)
 ;       <0  Error code
"RTN","RORX008A",94,0)
 ;        0  Ok
"RTN","RORX008A",95,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX008A",96,0)
 ;
"RTN","RORX008A",97,0)
STORE(REPORT) ;
"RTN","RORX008A",98,0)
 N BUF,CNT,ITEM,IEN,NODE,NPAIDS,NPHIV,RC,TABLE,TMP
"RTN","RORX008A",99,0)
 S NODE=$NA(^TMP("RORX008",$J)),RC=0
"RTN","RORX008A",100,0)
 ;
"RTN","RORX008A",101,0)
 ;--- List of ARV drugs
"RTN","RORX008A",102,0)
 S TMP=$$PARAM^RORTSK01("OPTIONS","REGMEDSMRY")
"RTN","RORX008A",103,0)
 I TMP,$$PARAM^RORTSK01("PATIENTS","COMPLEX")  D  Q:RC<0 RC
"RTN","RORX008A",104,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"DRUGS",,REPORT)
"RTN","RORX008A",105,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX008A",106,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","DRUGS")
"RTN","RORX008A",107,0)
 . S IEN=0
"RTN","RORX008A",108,0)
 . F  S IEN=$O(@NODE@("DRG",IEN))  Q:IEN'>0  D
"RTN","RORX008A",109,0)
 . . S BUF=@NODE@("DRG",IEN)
"RTN","RORX008A",110,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"DRUG",,TABLE)
"RTN","RORX008A",111,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NAME",$P(@NODE@("DRG",IEN),U),ITEM,1)
"RTN","RORX008A",112,0)
 . . S NPHIV=+$G(@NODE@("DRG",IEN,0))
"RTN","RORX008A",113,0)
 . . S NPAIDS=+$G(@NODE@("DRG",IEN,1))
"RTN","RORX008A",114,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NP",NPHIV+NPAIDS,ITEM,3)
"RTN","RORX008A",115,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NPHIV",NPHIV,ITEM,3)
"RTN","RORX008A",116,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NPAIDS",NPAIDS,ITEM,3)
"RTN","RORX008A",117,0)
 ;
"RTN","RORX008A",118,0)
 ;--- List of patients
"RTN","RORX008A",119,0)
 I $$PARAM^RORTSK01("OPTIONS","PTLIST")  D  Q:RC<0 RC
"RTN","RORX008A",120,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX008A",121,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX008A",122,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PATIENTS")
"RTN","RORX008A",123,0)
 . S IEN=0
"RTN","RORX008A",124,0)
 . F  S IEN=$O(@NODE@("PAT",IEN))  Q:IEN'>0  D
"RTN","RORX008A",125,0)
 . . S BUF=@NODE@("PAT",IEN)
"RTN","RORX008A",126,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE,,IEN)
"RTN","RORX008A",127,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NAME",$P(BUF,U,2),ITEM,1)
"RTN","RORX008A",128,0)
 . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(BUF,U),ITEM,2)
"RTN","RORX008A",129,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(BUF,U,3),ITEM,1)
"RTN","RORX008A",130,0)
 . . D ADDVAL^RORTSK11(RORTSK,"AIDSTAT",+$P(BUF,U,6),ITEM,1)
"RTN","RORX008A",131,0)
 . . D ADDVAL^RORTSK11(RORTSK,"ARV",+$P(BUF,U,4),ITEM,1)
"RTN","RORX008A",132,0)
 . . D ADDVAL^RORTSK11(RORTSK,"COMPLEX",+$P(BUF,U,5),ITEM,1)
"RTN","RORX008A",133,0)
 ;
"RTN","RORX008A",134,0)
 ;--- Summary
"RTN","RORX008A",135,0)
 S BUF=@NODE@("PAT")
"RTN","RORX008A",136,0)
 S ITEM=$$ADDVAL^RORTSK11(RORTSK,"SUMMARY",,REPORT)
"RTN","RORX008A",137,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",$P(BUF,U)+$P(BUF,U,2),ITEM)
"RTN","RORX008A",138,0)
 D ADDVAL^RORTSK11(RORTSK,"NPBASIC",+$P(BUF,U,1),ITEM)
"RTN","RORX008A",139,0)
 D ADDVAL^RORTSK11(RORTSK,"NPCOMPLEX",+$P(BUF,U,2),ITEM)
"RTN","RORX008A",140,0)
 D ADDVAL^RORTSK11(RORTSK,"NPARV",+$P(BUF,U,3),ITEM)
"RTN","RORX008A",141,0)
 Q 0
"RTN","RORX009")
0^178^B14460378
"RTN","RORX009",1,0)
RORX009 ;HCIOFO/SG - PHARMACY PRESCRIPTION UTILIZATION ; 11/16/05 10:49am
"RTN","RORX009",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX009",3,0)
 ;
"RTN","RORX009",4,0)
 Q
"RTN","RORX009",5,0)
 ;
"RTN","RORX009",6,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX009",7,0)
 ;
"RTN","RORX009",8,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX009",9,0)
 ;
"RTN","RORX009",10,0)
 ; Return Values:
"RTN","RORX009",11,0)
 ;       <0  Error code
"RTN","RORX009",12,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX009",13,0)
 ;
"RTN","RORX009",14,0)
HEADER(PARTAG) ;
"RTN","RORX009",15,0)
 ;;DOSES(NP,IPNRX)^I $$PARAM^RORTSK01("PATIENTS","INPATIENT")
"RTN","RORX009",16,0)
 ;;DRUGS_DOSES(#,NAME,NP,IPNRX,MAXNRPP,MAXNP)
"RTN","RORX009",17,0)
 ;;DRUGS_FILLS(#,NAME,NP,OPNRX,MAXNRPP,MAXNP)
"RTN","RORX009",18,0)
 ;;FILLS(NP,OPNRX)^I $$PARAM^RORTSK01("PATIENTS","OUTPATIENT")
"RTN","RORX009",19,0)
 ;;HU_DOSES(#,NAME,LAST4,DOD,IPNRX,ND)^I $$PARAM^RORTSK01("PATIENTS","INPATIENT")
"RTN","RORX009",20,0)
 ;;HU_FILLS(#,NAME,LAST4,DOD,OPNRX,ND)^I $$PARAM^RORTSK01("PATIENTS","OUTPATIENT")
"RTN","RORX009",21,0)
 ;;HU_NRX(#,NAME,LAST4,DOD,OPNRX,IPNRX,ND)^I $$PARAM^RORTSK01("PATIENTS","OUTPATIENT"),$$PARAM^RORTSK01("PATIENTS","INPATIENT")
"RTN","RORX009",22,0)
 ;
"RTN","RORX009",23,0)
 N HEADER,RC
"RTN","RORX009",24,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX009",25,0)
 Q:HEADER<0 HEADER
"RTN","RORX009",26,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX009",HEADER)
"RTN","RORX009",27,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX009",28,0)
 ;
"RTN","RORX009",29,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX009",30,0)
 ;
"RTN","RORX009",31,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX009",32,0)
 ;
"RTN","RORX009",33,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX009",34,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX009",35,0)
 ;
"RTN","RORX009",36,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX009",37,0)
 ;               returned via this parameter
"RTN","RORX009",38,0)
 ;
"RTN","RORX009",39,0)
 ; Return Values:
"RTN","RORX009",40,0)
 ;       <0  Error code
"RTN","RORX009",41,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX009",42,0)
 ;
"RTN","RORX009",43,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX009",44,0)
 N PARAMS,TMP
"RTN","RORX009",45,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX009",46,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX009",47,0)
 ;--- Process the drug list and options
"RTN","RORX009",48,0)
 S TMP=$$DRUGLST^RORXU007(.RORTSK,PARAMS,.RORXL,.RORXGRP)
"RTN","RORX009",49,0)
 Q:TMP<0 TMP
"RTN","RORX009",50,0)
 ;--- Additional parameters
"RTN","RORX009",51,0)
 F NAME="MAXUTNUM"  D
"RTN","RORX009",52,0)
 . S TMP=$$PARAM^RORTSK01(NAME)
"RTN","RORX009",53,0)
 . D:TMP'="" ADDVAL^RORTSK11(RORTSK,NAME,TMP,PARAMS)
"RTN","RORX009",54,0)
 ;---
"RTN","RORX009",55,0)
 Q PARAMS
"RTN","RORX009",56,0)
 ;
"RTN","RORX009",57,0)
 ;***** COMPILES THE "PHARMACY PRESCRIPTION UTILIZATION" REPORT
"RTN","RORX009",58,0)
 ; REPORT CODE: 009
"RTN","RORX009",59,0)
 ;
"RTN","RORX009",60,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX009",61,0)
 ;
"RTN","RORX009",62,0)
 ; The ^TMP("RORX009",$J) global node is used by this function.
"RTN","RORX009",63,0)
 ;
"RTN","RORX009",64,0)
 ; ^TMP("RORX009",$J,
"RTN","RORX009",65,0)
 ;
"RTN","RORX009",66,0)
 ;     "IP",             Number of inpatients
"RTN","RORX009",67,0)
 ;       DFN,            Patient's data
"RTN","RORX009",68,0)
 ;                         ^01: Last 4 digits of SSN
"RTN","RORX009",69,0)
 ;                         ^02: Name
"RTN","RORX009",70,0)
 ;                         ^03: Date of Death
"RTN","RORX009",71,0)
 ;                         ^04: Total number of doses
"RTN","RORX009",72,0)
 ;                         ^05: Number of different drugs
"RTN","RORX009",73,0)
 ;         "D",
"RTN","RORX009",74,0)
 ;           DrugIEN)    Quantity
"RTN","RORX009",75,0)
 ;
"RTN","RORX009",76,0)
 ;     "IPD",            Number of different drugs
"RTN","RORX009",77,0)
 ;       DrugIEN,        Drug Name
"RTN","RORX009",78,0)
 ;         "D")          Number of doses
"RTN","RORX009",79,0)
 ;         "M")          Maximum
"RTN","RORX009",80,0)
 ;                         ^01: Maximum number of doses
"RTN","RORX009",81,0)
 ;                         ^02: Number of patients
"RTN","RORX009",82,0)
 ;         "P")          Number of patients
"RTN","RORX009",83,0)
 ;       "B",
"RTN","RORX009",84,0)
 ;         NumOfDoses,
"RTN","RORX009",85,0)
 ;           DrugName,
"RTN","RORX009",86,0)
 ;             DrugIEN)  ""
"RTN","RORX009",87,0)
 ;
"RTN","RORX009",88,0)
 ;     "IPRX",           Total number of doses
"RTN","RORX009",89,0)
 ;       NumOfDoses,     Number of patients
"RTN","RORX009",90,0)
 ;         PatientName,
"RTN","RORX009",91,0)
 ;           DFN)        ""
"RTN","RORX009",92,0)
 ;
"RTN","RORX009",93,0)
 ;     "OP",             Number of outpatients
"RTN","RORX009",94,0)
 ;       DFN,            Patient's data
"RTN","RORX009",95,0)
 ;                         ^01: Last 4 digits of SSN
"RTN","RORX009",96,0)
 ;                         ^02: Name
"RTN","RORX009",97,0)
 ;                         ^03: Date of Death
"RTN","RORX009",98,0)
 ;                         ^04: Total number of fills
"RTN","RORX009",99,0)
 ;                         ^05: Number of different drugs
"RTN","RORX009",100,0)
 ;         "D",
"RTN","RORX009",101,0)
 ;           DrugIEN)    Quantity
"RTN","RORX009",102,0)
 ;
"RTN","RORX009",103,0)
 ;     "OPD",            Number of different drugs
"RTN","RORX009",104,0)
 ;       DrugIEN,        Drug Name
"RTN","RORX009",105,0)
 ;         "D")          Number of fills
"RTN","RORX009",106,0)
 ;         "M")          Maximum
"RTN","RORX009",107,0)
 ;                         ^01: Maximum number of fills
"RTN","RORX009",108,0)
 ;                         ^02: Number of patients
"RTN","RORX009",109,0)
 ;         "P")          Number of patients
"RTN","RORX009",110,0)
 ;       "B",
"RTN","RORX009",111,0)
 ;         NumOfFills,
"RTN","RORX009",112,0)
 ;           DrugName,
"RTN","RORX009",113,0)
 ;             DrugIEN)  ""
"RTN","RORX009",114,0)
 ;
"RTN","RORX009",115,0)
 ;     "OPRX",           Total number of fills
"RTN","RORX009",116,0)
 ;       NumOfFills,     Number of patients
"RTN","RORX009",117,0)
 ;         PatientName,
"RTN","RORX009",118,0)
 ;           DFN)        ""
"RTN","RORX009",119,0)
 ;
"RTN","RORX009",120,0)
 ;     "SUMRX",
"RTN","RORX009",121,0)
 ;       NumberOfRX,     Number of patients
"RTN","RORX009",122,0)
 ;         PatientName,
"RTN","RORX009",123,0)
 ;           DFN,        Number of different drugs
"RTN","RORX009",124,0)
 ;             "IP")
"RTN","RORX009",125,0)
 ;             "OP")
"RTN","RORX009",126,0)
 ;
"RTN","RORX009",127,0)
 ; Return Values:
"RTN","RORX009",128,0)
 ;       <0  Error code
"RTN","RORX009",129,0)
 ;        0  Ok
"RTN","RORX009",130,0)
 ;
"RTN","RORX009",131,0)
RXUTIL(RORTSK) ;
"RTN","RORX009",132,0)
 N ROREDT        ; End date
"RTN","RORX009",133,0)
 N RORREG        ; Registry IEN
"RTN","RORX009",134,0)
 N RORSDT        ; Start date
"RTN","RORX009",135,0)
 N RORXGRP       ; List of drug groups
"RTN","RORX009",136,0)
 N RORXL         ; List of drugs for the pharmacy search API
"RTN","RORX009",137,0)
 ;
"RTN","RORX009",138,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX009",139,0)
 S RORXL="",(ECNT,RC)=0
"RTN","RORX009",140,0)
 K ^TMP("RORX009",$J)
"RTN","RORX009",141,0)
 ;--- Root node of the report
"RTN","RORX009",142,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX009",143,0)
 Q:REPORT<0 REPORT
"RTN","RORX009",144,0)
 ;
"RTN","RORX009",145,0)
 D
"RTN","RORX009",146,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX009",147,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX009",148,0)
 . S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0
"RTN","RORX009",149,0)
 . ;--- Report header
"RTN","RORX009",150,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX009",151,0)
 . ;--- Query the registry
"RTN","RORX009",152,0)
 . D TPPSETUP^RORTSK01(80)
"RTN","RORX009",153,0)
 . S RC=$$QUERY^RORX009A(SFLAGS)
"RTN","RORX009",154,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX009",155,0)
 . ;--- Sort the data
"RTN","RORX009",156,0)
 . D TPPSETUP^RORTSK01(10)
"RTN","RORX009",157,0)
 . S RC=$$SORT^RORX009A()
"RTN","RORX009",158,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX009",159,0)
 . ;--- Store the results
"RTN","RORX009",160,0)
 . D TPPSETUP^RORTSK01(10)
"RTN","RORX009",161,0)
 . S RC=$$STORE^RORX009C(REPORT)
"RTN","RORX009",162,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX009",163,0)
 ;
"RTN","RORX009",164,0)
 ;--- Cleanup
"RTN","RORX009",165,0)
 K ^TMP("RORX009",$J)
"RTN","RORX009",166,0)
 D FREE^RORTMP(RORXL)
"RTN","RORX009",167,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX009A")
0^179^B60001463
"RTN","RORX009A",1,0)
RORX009A ;HCIOFO/SG - PRESCRIPTION UTILIZ. (QUERY & SORT) ; 10/12/05 11:49am
"RTN","RORX009A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX009A",3,0)
 ;
"RTN","RORX009A",4,0)
 Q
"RTN","RORX009A",5,0)
 ;
"RTN","RORX009A",6,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX009A",7,0)
 ;
"RTN","RORX009A",8,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX009A",9,0)
 ;
"RTN","RORX009A",10,0)
 ; Return Values:
"RTN","RORX009A",11,0)
 ;       <0  Error code
"RTN","RORX009A",12,0)
 ;        0  Ok
"RTN","RORX009A",13,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX009A",14,0)
 ;
"RTN","RORX009A",15,0)
QUERY(FLAGS) ;
"RTN","RORX009A",16,0)
 N ROREDT1       ; Day after the end date
"RTN","RORX009A",17,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX009A",18,0)
 ;
"RTN","RORX009A",19,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,RORXDST,RXFLAGS,TMP,XREFNODE
"RTN","RORX009A",20,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX009A",21,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX009A",22,0)
 S ROREDT1=$$FMADD^XLFDT(ROREDT,1)
"RTN","RORX009A",23,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX009A",24,0)
 ;
"RTN","RORX009A",25,0)
 ;--- Prepare parameters for the pharmacy search API
"RTN","RORX009A",26,0)
 S RORXDST=$NA(^TMP("RORX009",$J))
"RTN","RORX009A",27,0)
 S RORXDST("RORCB")="$$RXSCB^RORX009A"
"RTN","RORX009A",28,0)
 S RORXDST("GENERIC")=$$PARAM^RORTSK01("DRUGS","AGGR_GENERIC")
"RTN","RORX009A",29,0)
 S RXFLAGS="E"
"RTN","RORX009A",30,0)
 S:$$PARAM^RORTSK01("PATIENTS","INPATIENT") RXFLAGS=RXFLAGS_"IV"
"RTN","RORX009A",31,0)
 S:$$PARAM^RORTSK01("PATIENTS","OUTPATIENT") RXFLAGS=RXFLAGS_"O"
"RTN","RORX009A",32,0)
 Q:RXFLAGS="E" 0
"RTN","RORX009A",33,0)
 ;
"RTN","RORX009A",34,0)
 ;--- Browse through the registry records
"RTN","RORX009A",35,0)
 S IEN=0
"RTN","RORX009A",36,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX009A",37,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX009A",38,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX009A",39,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX009A",40,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX009A",41,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX009A",42,0)
 . ;
"RTN","RORX009A",43,0)
 . ;--- Get the patient IEN (DFN)
"RTN","RORX009A",44,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX009A",45,0)
 . ;
"RTN","RORX009A",46,0)
 . ;--- Search the pharmacy data
"RTN","RORX009A",47,0)
 . M RORXDST("RORXGRP")=RORXGRP("C")
"RTN","RORX009A",48,0)
 . S TMP=$$RXSEARCH^RORUTL14(PATIEN,RORXL,.RORXDST,RXFLAGS,RORSDT,ROREDT1)
"RTN","RORX009A",49,0)
 . I TMP<0  S ECNT=ECNT+1  Q
"RTN","RORX009A",50,0)
 . ;--- No medications from some groups
"RTN","RORX009A",51,0)
 . Q:$D(RORXDST("RORXGRP"))>1
"RTN","RORX009A",52,0)
 . ;--- Skip the patient if no data has been found
"RTN","RORX009A",53,0)
 . I '$D(@RORXDST@("IP",PATIEN)),'$D(@RORXDST@("OP",PATIEN))  Q
"RTN","RORX009A",54,0)
 . ;
"RTN","RORX009A",55,0)
 . ;--- Calculate intermediate totals
"RTN","RORX009A",56,0)
 . S RC=$$TOTALS(PATIEN)
"RTN","RORX009A",57,0)
 . I RC  S ECNT=ECNT+1  Q:RC<0
"RTN","RORX009A",58,0)
 ;---
"RTN","RORX009A",59,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX009A",60,0)
 ;
"RTN","RORX009A",61,0)
 ;***** CALLBACK FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORX009A",62,0)
RXSCB(ROR8DST,ORDER,ORDFLG,DRUG,DATE) ;
"RTN","RORX009A",63,0)
 N DRUGIEN,DRUGNAME,IRP,RPS,RXCNT,SUBS,TMP
"RTN","RORX009A",64,0)
 I ROR8DST("GENERIC")  D
"RTN","RORX009A",65,0)
 . S DRUGIEN=+ROR8DST("RORXGEN"),DRUGNAME=$P(ROR8DST("RORXGEN"),U,2)
"RTN","RORX009A",66,0)
 E  S DRUGIEN=+DRUG,DRUGNAME=$P(DRUG,U,2)
"RTN","RORX009A",67,0)
 Q:(DRUGIEN'>0)!(DRUGNAME="") 1
"RTN","RORX009A",68,0)
 ;=== Check the drug groups
"RTN","RORX009A",69,0)
 S TMP=$$RXGRPCHK^RORXU007(.ROR8DST,+DRUG,RORXL)
"RTN","RORX009A",70,0)
 Q:TMP TMP
"RTN","RORX009A",71,0)
 ;=== Process the order
"RTN","RORX009A",72,0)
 S SUBS=$S(ORDFLG["I":"IP",ORDFLG["O":"OP",1:"")  Q:SUBS="" 1
"RTN","RORX009A",73,0)
 S RXCNT=0
"RTN","RORX009A",74,0)
 ;--- Count the original order, refills and partials
"RTN","RORX009A",75,0)
 I ORDFLG["I"  S RXCNT=RXCNT+1  ; Inpatient
"RTN","RORX009A",76,0)
 E  D                           ; Outpatient
"RTN","RORX009A",77,0)
 . S TMP=+$P($G(^TMP("PS",$J,"RXN",0)),U,6)  ; Original Fill Date
"RTN","RORX009A",78,0)
 . S:(TMP'<ROR8DST("RORSDT"))&(TMP<ROR8DST("ROREDT")) RXCNT=RXCNT+1
"RTN","RORX009A",79,0)
 F RPS="PAR","REF"  S IRP=0  D
"RTN","RORX009A",80,0)
 . F  S IRP=$O(^TMP("PS",$J,RPS,IRP))  Q:IRP'>0  S RXCNT=RXCNT+1
"RTN","RORX009A",81,0)
 ;--- Update the counters
"RTN","RORX009A",82,0)
 D:RXCNT>0
"RTN","RORX009A",83,0)
 . S TMP=$G(@ROR8DST@(SUBS,+ROR8DST("RORDFN"),"D",DRUGIEN))
"RTN","RORX009A",84,0)
 . S @ROR8DST@(SUBS,+ROR8DST("RORDFN"),"D",DRUGIEN)=TMP+RXCNT
"RTN","RORX009A",85,0)
 . S TMP=SUBS_"D"
"RTN","RORX009A",86,0)
 . S:'$D(@ROR8DST@(TMP,DRUGIEN)) @ROR8DST@(TMP,DRUGIEN)=DRUGNAME
"RTN","RORX009A",87,0)
 Q 0
"RTN","RORX009A",88,0)
 ;
"RTN","RORX009A",89,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX009A",90,0)
 ;
"RTN","RORX009A",91,0)
 ; Return Values:
"RTN","RORX009A",92,0)
 ;       <0  Error code
"RTN","RORX009A",93,0)
 ;        0  Ok
"RTN","RORX009A",94,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX009A",95,0)
 ;
"RTN","RORX009A",96,0)
SORT() ;
"RTN","RORX009A",97,0)
 N ECNT,NODE,RC
"RTN","RORX009A",98,0)
 S (ECNT,RC)=0
"RTN","RORX009A",99,0)
 S NODE=$NA(^TMP("RORX009",$J))
"RTN","RORX009A",100,0)
 Q:$D(@NODE)<10 0
"RTN","RORX009A",101,0)
 ;---
"RTN","RORX009A",102,0)
 S RC=$$LOOP^RORTSK01(0)    Q:RC<0 RC
"RTN","RORX009A",103,0)
 D SORTRX(NODE,"IPD")
"RTN","RORX009A",104,0)
 ;---
"RTN","RORX009A",105,0)
 S RC=$$LOOP^RORTSK01(.33)  Q:RC<0 RC
"RTN","RORX009A",106,0)
 D SORTRX(NODE,"OPD")
"RTN","RORX009A",107,0)
 ;---
"RTN","RORX009A",108,0)
 S RC=$$LOOP^RORTSK01(.66)  Q:RC<0 RC
"RTN","RORX009A",109,0)
 S RC=$$SUMRX(NODE)
"RTN","RORX009A",110,0)
 ;---
"RTN","RORX009A",111,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX009A",112,0)
 ;
"RTN","RORX009A",113,0)
 ;***** SORTS THE DRUG LIST
"RTN","RORX009A",114,0)
 ;
"RTN","RORX009A",115,0)
 ; NODE          Closed root of the category section
"RTN","RORX009A",116,0)
 ;               in the temporary global
"RTN","RORX009A",117,0)
 ;
"RTN","RORX009A",118,0)
 ; SUBS          Drug list subscript ("IPD" or "OPD")
"RTN","RORX009A",119,0)
 ;
"RTN","RORX009A",120,0)
SORTRX(NODE,SUBS) ;
"RTN","RORX009A",121,0)
 N IEN,NAME,NDRUGS,SUM,TMP
"RTN","RORX009A",122,0)
 S IEN=0,NDRUGS=0
"RTN","RORX009A",123,0)
 F  S IEN=$O(@NODE@(SUBS,IEN))  Q:IEN'>0  D
"RTN","RORX009A",124,0)
 . S NAME=@NODE@(SUBS,IEN),NDRUGS=NDRUGS+1
"RTN","RORX009A",125,0)
 . S TMP=+$G(@NODE@(SUBS,IEN,"D"))
"RTN","RORX009A",126,0)
 . S @NODE@(SUBS,"B",TMP,NAME,IEN)=""
"RTN","RORX009A",127,0)
 ;--- Numbers of different drugs
"RTN","RORX009A",128,0)
 S @NODE@(SUBS)=NDRUGS
"RTN","RORX009A",129,0)
 Q
"RTN","RORX009A",130,0)
 ;
"RTN","RORX009A",131,0)
 ;***** COMBINES THE INPATIENT AND OUTPATIENT DATA
"RTN","RORX009A",132,0)
 ;
"RTN","RORX009A",133,0)
 ; NODE          Closed root of the category section
"RTN","RORX009A",134,0)
 ;               in the temporary global
"RTN","RORX009A",135,0)
 ;
"RTN","RORX009A",136,0)
SUMRX(NODE) ;
"RTN","RORX009A",137,0)
 N COUNT,I,MAXUTNUM,NDRX,NRX,RC,RXIEN,SUMNRX,TMP
"RTN","RORX009A",138,0)
 Q:($D(@NODE@("IPRX"))<10)!($D(@NODE@("OPRX"))<10) 0
"RTN","RORX009A",139,0)
 S MAXUTNUM=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX009A",140,0)
 Q:MAXUTNUM'>0 0
"RTN","RORX009A",141,0)
 ;
"RTN","RORX009A",142,0)
 ;=== Outpatient data
"RTN","RORX009A",143,0)
 S NRX="",(COUNT,RC)=0
"RTN","RORX009A",144,0)
 F  S NRX=$O(@NODE@("OPRX",NRX),-1)  Q:NRX=""  D  Q:RC
"RTN","RORX009A",145,0)
 . S RC=$$LOOP^RORTSK01()  Q:RC<0
"RTN","RORX009A",146,0)
 . S @NODE@("SUMRX",NRX)=$G(@NODE@("OPRX",NRX))
"RTN","RORX009A",147,0)
 . S NAME=""
"RTN","RORX009A",148,0)
 . F  S NAME=$O(@NODE@("OPRX",NRX,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX009A",149,0)
 . . S DFN=""
"RTN","RORX009A",150,0)
 . . F  S DFN=$O(@NODE@("OPRX",NRX,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX009A",151,0)
 . . . ;--- Include only the patients with highest utilization
"RTN","RORX009A",152,0)
 . . . S COUNT=COUNT+1  I COUNT>MAXUTNUM  S RC=1  Q
"RTN","RORX009A",153,0)
 . . . ;--- Calculate the totals
"RTN","RORX009A",154,0)
 . . . S (NDRX,SUMNRX)=0
"RTN","RORX009A",155,0)
 . . . F I="IP","OP"  S TMP=$G(@NODE@(I,DFN))  D
"RTN","RORX009A",156,0)
 . . . . S NDRX=NDRX+$P(TMP,U,5),SUMNRX=SUMNRX+$P(TMP,U,4)
"RTN","RORX009A",157,0)
 . . . S @NODE@("SUMRX",SUMNRX,NAME,DFN,"OP")=""
"RTN","RORX009A",158,0)
 . . . S @NODE@("SUMRX",SUMNRX)=$G(@NODE@("SUMRX",SUMNRX))+1
"RTN","RORX009A",159,0)
 . . . ;--- Adjust the total number of different drugs
"RTN","RORX009A",160,0)
 . . . ;--- (some drugs could be both inpatient and outpatient)
"RTN","RORX009A",161,0)
 . . . S RXIEN=0
"RTN","RORX009A",162,0)
 . . . F  S RXIEN=$O(@NODE@("OP",DFN,"D",RXIEN))  Q:RXIEN'>0  D
"RTN","RORX009A",163,0)
 . . . . S:$D(@NODE@("IP",DFN,"D",RXIEN)) NDRX=NDRX-1
"RTN","RORX009A",164,0)
 . . . ;--- Store the number of different drugs
"RTN","RORX009A",165,0)
 . . . S @NODE@("SUMRX",SUMNRX,NAME,DFN)=NDRX
"RTN","RORX009A",166,0)
 ;
"RTN","RORX009A",167,0)
 ;=== Inpatient data
"RTN","RORX009A",168,0)
 S NRX="",(COUNT,RC)=0
"RTN","RORX009A",169,0)
 F  S NRX=$O(@NODE@("IPRX",NRX),-1)  Q:NRX=""  D  Q:RC
"RTN","RORX009A",170,0)
 . S RC=$$LOOP^RORTSK01()  Q:RC<0
"RTN","RORX009A",171,0)
 . S NAME=""
"RTN","RORX009A",172,0)
 . F  S NAME=$O(@NODE@("IPRX",NRX,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX009A",173,0)
 . . S DFN=""
"RTN","RORX009A",174,0)
 . . F  S DFN=$O(@NODE@("IPRX",NRX,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX009A",175,0)
 . . . ;--- Include only the patients with highest utilization
"RTN","RORX009A",176,0)
 . . . S COUNT=COUNT+1  I COUNT>MAXUTNUM  S RC=1  Q
"RTN","RORX009A",177,0)
 . . . ;--- Calculate the totals
"RTN","RORX009A",178,0)
 . . . S (NDRX,SUMNRX)=0
"RTN","RORX009A",179,0)
 . . . F I="IP","OP"  S TMP=$G(@NODE@(I,DFN))  D
"RTN","RORX009A",180,0)
 . . . . S NDRX=NDRX+$P(TMP,U,5),SUMNRX=SUMNRX+$P(TMP,U,4)
"RTN","RORX009A",181,0)
 . . . S @NODE@("SUMRX",SUMNRX,NAME,DFN,"IP")=""
"RTN","RORX009A",182,0)
 . . . ;--- Quit if the patient has been processed already
"RTN","RORX009A",183,0)
 . . . Q:$D(@NODE@("SUMRX",SUMNRX,NAME,DFN,"OP"))
"RTN","RORX009A",184,0)
 . . . S @NODE@("SUMRX",SUMNRX)=$G(@NODE@("SUMRX",SUMNRX))+1
"RTN","RORX009A",185,0)
 . . . ;--- Adjust the total number of different drugs
"RTN","RORX009A",186,0)
 . . . ;--- (some drugs could be both inpatient and outpatient)
"RTN","RORX009A",187,0)
 . . . S RXIEN=0
"RTN","RORX009A",188,0)
 . . . F  S RXIEN=$O(@NODE@("IP",DFN,"D",RXIEN))  Q:RXIEN'>0  D
"RTN","RORX009A",189,0)
 . . . . S:$D(@NODE@("OP",DFN,"D",RXIEN)) NDRX=NDRX-1
"RTN","RORX009A",190,0)
 . . . ;--- Store the number of different drugs
"RTN","RORX009A",191,0)
 . . . S @NODE@("SUMRX",SUMNRX,NAME,DFN)=NDRX
"RTN","RORX009A",192,0)
 ;===
"RTN","RORX009A",193,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX009A",194,0)
 ;
"RTN","RORX009A",195,0)
 ;***** CALCULATES THE INTERMEDIATE TOTALS
"RTN","RORX009A",196,0)
 ;
"RTN","RORX009A",197,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX009A",198,0)
 ;
"RTN","RORX009A",199,0)
 ; Return Values:
"RTN","RORX009A",200,0)
 ;       <0  Error code
"RTN","RORX009A",201,0)
 ;        0  Ok
"RTN","RORX009A",202,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX009A",203,0)
 ;
"RTN","RORX009A",204,0)
TOTALS(PATIEN) ;
"RTN","RORX009A",205,0)
 N DOD,IEN,LAST4,NDRUGS,NODE,NRX,PTNAME,PTNRX,RXS,SUBS,TMP,VA,VADM,VAERR
"RTN","RORX009A",206,0)
 S NODE=$NA(^TMP("RORX009",$J))
"RTN","RORX009A",207,0)
 ;--- Get the patient's data
"RTN","RORX009A",208,0)
 D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX009A",209,0)
 S PTNAME=VADM(1),LAST4=VA("BID"),DOD=$$DATE^RORXU002(VADM(6)\1)
"RTN","RORX009A",210,0)
 ;---
"RTN","RORX009A",211,0)
 F SUBS="IP","OP"  D:$D(@NODE@(SUBS,PATIEN))>1
"RTN","RORX009A",212,0)
 . S RXS=SUBS_"D"
"RTN","RORX009A",213,0)
 . S IEN=0,(NDRUGS,PTNRX)=0
"RTN","RORX009A",214,0)
 . F  S IEN=$O(@NODE@(SUBS,PATIEN,"D",IEN))  Q:IEN'>0  D
"RTN","RORX009A",215,0)
 . . S NRX=@NODE@(SUBS,PATIEN,"D",IEN)
"RTN","RORX009A",216,0)
 . . S NDRUGS=NDRUGS+1,PTNRX=PTNRX+NRX
"RTN","RORX009A",217,0)
 . . ;---
"RTN","RORX009A",218,0)
 . . S @NODE@(RXS,IEN,"D")=$G(@NODE@(RXS,IEN,"D"))+NRX
"RTN","RORX009A",219,0)
 . . S @NODE@(RXS,IEN,"P")=$G(@NODE@(RXS,IEN,"P"))+1
"RTN","RORX009A",220,0)
 . . ;---
"RTN","RORX009A",221,0)
 . . S TMP=$G(@NODE@(RXS,IEN,"M"))
"RTN","RORX009A",222,0)
 . . D:NRX'<TMP
"RTN","RORX009A",223,0)
 . . . I NRX>TMP  S @NODE@(RXS,IEN,"M")=NRX_U_1  Q
"RTN","RORX009A",224,0)
 . . . S $P(@NODE@(RXS,IEN,"M"),U,2)=$P(TMP,U,2)+1
"RTN","RORX009A",225,0)
 . ;---
"RTN","RORX009A",226,0)
 . S @NODE@(SUBS)=$G(@NODE@(SUBS))+1
"RTN","RORX009A",227,0)
 . S @NODE@(SUBS,PATIEN)=LAST4_U_PTNAME_U_DOD_U_PTNRX_U_NDRUGS
"RTN","RORX009A",228,0)
 . ;---
"RTN","RORX009A",229,0)
 . S RXS=SUBS_"RX"
"RTN","RORX009A",230,0)
 . S @NODE@(RXS)=$G(@NODE@(RXS))+PTNRX
"RTN","RORX009A",231,0)
 . S @NODE@(RXS,PTNRX)=$G(@NODE@(RXS,PTNRX))+1
"RTN","RORX009A",232,0)
 . S @NODE@(RXS,PTNRX,PTNAME,PATIEN)=""
"RTN","RORX009A",233,0)
 ;---
"RTN","RORX009A",234,0)
 Q 0
"RTN","RORX009C")
0^180^B58939226
"RTN","RORX009C",1,0)
RORX009C ;HCIOFO/SG - PRESCRIPTION UTILIZ. (STORE) ; 12/16/05 9:19am
"RTN","RORX009C",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX009C",3,0)
 ;
"RTN","RORX009C",4,0)
 Q
"RTN","RORX009C",5,0)
 ;
"RTN","RORX009C",6,0)
 ;***** DRUGS
"RTN","RORX009C",7,0)
 ;
"RTN","RORX009C",8,0)
 ; SECTION       IEN of the parent element
"RTN","RORX009C",9,0)
 ;
"RTN","RORX009C",10,0)
 ; SUBS
"RTN","RORX009C",11,0)
 ;
"RTN","RORX009C",12,0)
 ; NODE          Closed root of the category section
"RTN","RORX009C",13,0)
 ;               in the temporary global
"RTN","RORX009C",14,0)
 ;
"RTN","RORX009C",15,0)
 ; TBLNAME
"RTN","RORX009C",16,0)
 ;
"RTN","RORX009C",17,0)
 ; Return Values:
"RTN","RORX009C",18,0)
 ;       <0  Error code
"RTN","RORX009C",19,0)
 ;        0  Ok
"RTN","RORX009C",20,0)
 ;
"RTN","RORX009C",21,0)
DRUGS(SECTION,SUBS,NODE,TBLNAME) ;
"RTN","RORX009C",22,0)
 Q:$D(@NODE@(SUBS))<10 0
"RTN","RORX009C",23,0)
 N IEN,ITEM,NAME,NRXNAME,NUM,RC,TMP
"RTN","RORX009C",24,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,TBLNAME,,SECTION)
"RTN","RORX009C",25,0)
 Q:TABLE<0 TABLE
"RTN","RORX009C",26,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE",TBLNAME)
"RTN","RORX009C",27,0)
 S NRXNAME=$E(SUBS,1,2)_"NRX"
"RTN","RORX009C",28,0)
 ;---
"RTN","RORX009C",29,0)
 S NUM="",RC=0
"RTN","RORX009C",30,0)
 F  S NUM=$O(@NODE@(SUBS,"B",NUM),-1)  Q:NUM=""  D  Q:RC
"RTN","RORX009C",31,0)
 . S NAME=""
"RTN","RORX009C",32,0)
 . F  S NAME=$O(@NODE@(SUBS,"B",NUM,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX009C",33,0)
 . . S IEN=""
"RTN","RORX009C",34,0)
 . . F  S IEN=$O(@NODE@(SUBS,"B",NUM,NAME,IEN))  Q:IEN=""  D  Q:RC
"RTN","RORX009C",35,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"DRUG",,TABLE)
"RTN","RORX009C",36,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX009C",37,0)
 . . . S TMP=+$G(@NODE@(SUBS,IEN,"P"))
"RTN","RORX009C",38,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NP",TMP,ITEM,3)
"RTN","RORX009C",39,0)
 . . . D ADDVAL^RORTSK11(RORTSK,NRXNAME,NUM,ITEM,3)
"RTN","RORX009C",40,0)
 . . . S TMP=$G(@NODE@(SUBS,IEN,"M"))
"RTN","RORX009C",41,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"MAXNRPP",+$P(TMP,U),ITEM,3)
"RTN","RORX009C",42,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"MAXNP",+$P(TMP,U,2),ITEM,3)
"RTN","RORX009C",43,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX009C",44,0)
 ;
"RTN","RORX009C",45,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX009C",46,0)
 ;
"RTN","RORX009C",47,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX009C",48,0)
 ;
"RTN","RORX009C",49,0)
 ; Return Values:
"RTN","RORX009C",50,0)
 ;       <0  Error code
"RTN","RORX009C",51,0)
 ;        0  Ok
"RTN","RORX009C",52,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX009C",53,0)
 ;
"RTN","RORX009C",54,0)
STORE(REPORT) ;
"RTN","RORX009C",55,0)
 N RORSONLY      ; Output summary only
"RTN","RORX009C",56,0)
 ;
"RTN","RORX009C",57,0)
 N ECNT,NODE,RC,TMP
"RTN","RORX009C",58,0)
 S RORSONLY=$$SMRYONLY^RORXU006(),(ECNT,RC)=0
"RTN","RORX009C",59,0)
 S NODE=$NA(^TMP("RORX009",$J))
"RTN","RORX009C",60,0)
 Q:$D(@NODE)<10 0
"RTN","RORX009C",61,0)
 ;--- Outpatient data
"RTN","RORX009C",62,0)
 S RC=$$LOOP^RORTSK01(0)  Q:RC<0 RC
"RTN","RORX009C",63,0)
 S RC=$$STOREOP(REPORT,NODE)
"RTN","RORX009C",64,0)
 I RC  Q:RC<0  S ECNT=ECNT+1
"RTN","RORX009C",65,0)
 ;--- Inpatient data
"RTN","RORX009C",66,0)
 S RC=$$LOOP^RORTSK01(.33)  Q:RC<0 RC
"RTN","RORX009C",67,0)
 S RC=$$STOREIP(REPORT,NODE)
"RTN","RORX009C",68,0)
 I RC  Q:RC<0  S ECNT=ECNT+1
"RTN","RORX009C",69,0)
 ;--- Highest utilization summary
"RTN","RORX009C",70,0)
 S RC=$$LOOP^RORTSK01(.66)  Q:RC<0 RC
"RTN","RORX009C",71,0)
 S RC=$$STORESUM(REPORT,NODE)
"RTN","RORX009C",72,0)
 I RC  Q:RC<0  S ECNT=ECNT+1
"RTN","RORX009C",73,0)
 ;---
"RTN","RORX009C",74,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX009C",75,0)
 ;
"RTN","RORX009C",76,0)
 ;***** INPATIENT DATA
"RTN","RORX009C",77,0)
 ;
"RTN","RORX009C",78,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX009C",79,0)
 ;
"RTN","RORX009C",80,0)
 ; NODE          Closed root of the category section
"RTN","RORX009C",81,0)
 ;               in the temporary global
"RTN","RORX009C",82,0)
 ;
"RTN","RORX009C",83,0)
 ; Return Values:
"RTN","RORX009C",84,0)
 ;       <0  Error code
"RTN","RORX009C",85,0)
 ;        0  Ok
"RTN","RORX009C",86,0)
 ;
"RTN","RORX009C",87,0)
STOREIP(PRNTELMT,NODE) ;
"RTN","RORX009C",88,0)
 Q:$D(@NODE@("IP"))<10 0
"RTN","RORX009C",89,0)
 N COUNT,DFN,ITEM,MAXUTNUM,NAME,NRX,RC,SECTION,TABLE,TMP
"RTN","RORX009C",90,0)
 S MAXUTNUM=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX009C",91,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"INPATIENTS",,PRNTELMT)
"RTN","RORX009C",92,0)
 Q:SECTION<0 SECTION
"RTN","RORX009C",93,0)
 S RC=0
"RTN","RORX009C",94,0)
 ;--- Number of doses
"RTN","RORX009C",95,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"DOSES",,SECTION)
"RTN","RORX009C",96,0)
 Q:TABLE<0 TABLE
"RTN","RORX009C",97,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","DOSES")
"RTN","RORX009C",98,0)
 S NRX=""
"RTN","RORX009C",99,0)
 F  S NRX=$O(@NODE@("IPRX",NRX),-1)  Q:NRX=""  D
"RTN","RORX009C",100,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"ITEM",,TABLE)
"RTN","RORX009C",101,0)
 . D ADDVAL^RORTSK11(RORTSK,"NP",$P(@NODE@("IPRX",NRX),U),ITEM,3)
"RTN","RORX009C",102,0)
 . D ADDVAL^RORTSK11(RORTSK,"IPNRX",NRX,ITEM,3)
"RTN","RORX009C",103,0)
 ;--- Drugs
"RTN","RORX009C",104,0)
 S RC=$$DRUGS(SECTION,"IPD",NODE,"DRUGS_DOSES")  Q:RC<0 RC
"RTN","RORX009C",105,0)
 ;--- Patients with highest utlization
"RTN","RORX009C",106,0)
 I MAXUTNUM>0  D  Q:RC<0 RC
"RTN","RORX009C",107,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"HU_DOSES",,SECTION)
"RTN","RORX009C",108,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX009C",109,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","HU_DOSES")
"RTN","RORX009C",110,0)
 . S NRX="",(COUNT,RC)=0
"RTN","RORX009C",111,0)
 . F  S NRX=$O(@NODE@("IPRX",NRX),-1)  Q:NRX=""  D  Q:RC
"RTN","RORX009C",112,0)
 . . S RC=$$LOOP^RORTSK01()  Q:RC<0
"RTN","RORX009C",113,0)
 . . S NAME=""
"RTN","RORX009C",114,0)
 . . F  S NAME=$O(@NODE@("IPRX",NRX,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX009C",115,0)
 . . . S DFN=""
"RTN","RORX009C",116,0)
 . . . F  S DFN=$O(@NODE@("IPRX",NRX,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX009C",117,0)
 . . . . S COUNT=COUNT+1  I COUNT>MAXUTNUM  S RC=1  Q
"RTN","RORX009C",118,0)
 . . . . S BUF=$G(@NODE@("IP",DFN))
"RTN","RORX009C",119,0)
 . . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX009C",120,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX009C",121,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(BUF,U),ITEM,2)
"RTN","RORX009C",122,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(BUF,U,3),ITEM,1)
"RTN","RORX009C",123,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"IPNRX",NRX,ITEM,3)
"RTN","RORX009C",124,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"ND",$P(BUF,U,5),ITEM,3)
"RTN","RORX009C",125,0)
 ;--- Summary
"RTN","RORX009C",126,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+$G(@NODE@("IP")),SECTION)
"RTN","RORX009C",127,0)
 D ADDVAL^RORTSK11(RORTSK,"IPNRX",+$G(@NODE@("IPRX")),SECTION)
"RTN","RORX009C",128,0)
 D ADDVAL^RORTSK11(RORTSK,"ND",+$G(@NODE@("IPD")),SECTION)
"RTN","RORX009C",129,0)
 Q 0
"RTN","RORX009C",130,0)
 ;
"RTN","RORX009C",131,0)
 ;***** OUTPATIENT DATA
"RTN","RORX009C",132,0)
 ;
"RTN","RORX009C",133,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX009C",134,0)
 ;
"RTN","RORX009C",135,0)
 ; NODE          Closed root of the category section
"RTN","RORX009C",136,0)
 ;               in the temporary global
"RTN","RORX009C",137,0)
 ;
"RTN","RORX009C",138,0)
 ; Return Values:
"RTN","RORX009C",139,0)
 ;       <0  Error code
"RTN","RORX009C",140,0)
 ;        0  Ok
"RTN","RORX009C",141,0)
 ;
"RTN","RORX009C",142,0)
STOREOP(PRNTELMT,NODE) ;
"RTN","RORX009C",143,0)
 Q:$D(@NODE@("OP"))<10 0
"RTN","RORX009C",144,0)
 N COUNT,DFN,ITEM,MAXUTNUM,NAME,NRX,RC,SECTION,TABLE,TMP
"RTN","RORX009C",145,0)
 S MAXUTNUM=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX009C",146,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"OUTPATIENTS",,PRNTELMT)
"RTN","RORX009C",147,0)
 Q:SECTION<0 SECTION
"RTN","RORX009C",148,0)
 S RC=0
"RTN","RORX009C",149,0)
 ;--- Number of fills
"RTN","RORX009C",150,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"FILLS",,SECTION)
"RTN","RORX009C",151,0)
 Q:TABLE<0 TABLE
"RTN","RORX009C",152,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","FILLS")
"RTN","RORX009C",153,0)
 S NRX=""
"RTN","RORX009C",154,0)
 F  S NRX=$O(@NODE@("OPRX",NRX),-1)  Q:NRX=""  D
"RTN","RORX009C",155,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"ITEM",,TABLE)
"RTN","RORX009C",156,0)
 . D ADDVAL^RORTSK11(RORTSK,"NP",$P(@NODE@("OPRX",NRX),U),ITEM,3)
"RTN","RORX009C",157,0)
 . D ADDVAL^RORTSK11(RORTSK,"OPNRX",NRX,ITEM,3)
"RTN","RORX009C",158,0)
 ;--- Drugs
"RTN","RORX009C",159,0)
 S RC=$$DRUGS(SECTION,"OPD",NODE,"DRUGS_FILLS")  Q:RC<0 RC
"RTN","RORX009C",160,0)
 ;--- Patients with highest utlization
"RTN","RORX009C",161,0)
 I MAXUTNUM>0  D  Q:RC<0 RC
"RTN","RORX009C",162,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"HU_FILLS",,SECTION)
"RTN","RORX009C",163,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX009C",164,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","HU_FILLS")
"RTN","RORX009C",165,0)
 . S NRX="",(COUNT,RC)=0
"RTN","RORX009C",166,0)
 . F  S NRX=$O(@NODE@("OPRX",NRX),-1)  Q:NRX=""  D  Q:RC
"RTN","RORX009C",167,0)
 . . S RC=$$LOOP^RORTSK01()  Q:RC<0
"RTN","RORX009C",168,0)
 . . S NAME=""
"RTN","RORX009C",169,0)
 . . F  S NAME=$O(@NODE@("OPRX",NRX,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX009C",170,0)
 . . . S DFN=""
"RTN","RORX009C",171,0)
 . . . F  S DFN=$O(@NODE@("OPRX",NRX,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX009C",172,0)
 . . . . S COUNT=COUNT+1  I COUNT>MAXUTNUM  S RC=1  Q
"RTN","RORX009C",173,0)
 . . . . S BUF=$G(@NODE@("OP",DFN))
"RTN","RORX009C",174,0)
 . . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX009C",175,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX009C",176,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(BUF,U),ITEM,2)
"RTN","RORX009C",177,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(BUF,U,3),ITEM,1)
"RTN","RORX009C",178,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"OPNRX",NRX,ITEM,3)
"RTN","RORX009C",179,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"ND",$P(BUF,U,5),ITEM,3)
"RTN","RORX009C",180,0)
 ;--- Summary
"RTN","RORX009C",181,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+$G(@NODE@("OP")),SECTION)
"RTN","RORX009C",182,0)
 D ADDVAL^RORTSK11(RORTSK,"OPNRX",+$G(@NODE@("OPRX")),SECTION)
"RTN","RORX009C",183,0)
 D ADDVAL^RORTSK11(RORTSK,"ND",+$G(@NODE@("OPD")),SECTION)
"RTN","RORX009C",184,0)
 Q 0
"RTN","RORX009C",185,0)
 ;
"RTN","RORX009C",186,0)
 ;***** SUMMARY DATA
"RTN","RORX009C",187,0)
 ;
"RTN","RORX009C",188,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX009C",189,0)
 ;
"RTN","RORX009C",190,0)
 ; NODE          Closed root of the category section
"RTN","RORX009C",191,0)
 ;               in the temporary global
"RTN","RORX009C",192,0)
 ;
"RTN","RORX009C",193,0)
 ; Return Values:
"RTN","RORX009C",194,0)
 ;       <0  Error code
"RTN","RORX009C",195,0)
 ;        0  Ok
"RTN","RORX009C",196,0)
 ;
"RTN","RORX009C",197,0)
STORESUM(PRNTELMT,NODE) ;
"RTN","RORX009C",198,0)
 N DFN,DOD,IPNRX,ITEM,LAST4,MAXUTNUM,NAME,NRX,OPNRX,RC,SECTION,TABLE,TMP
"RTN","RORX009C",199,0)
 S MAXUTNUM=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX009C",200,0)
 Q:($D(@NODE@("SUMRX"))<10)!(MAXUTNUM'>0) 0
"RTN","RORX009C",201,0)
 ;---
"RTN","RORX009C",202,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"SUMMARY",,PRNTELMT)
"RTN","RORX009C",203,0)
 Q:SECTION<0 SECTION
"RTN","RORX009C",204,0)
 S RC=0
"RTN","RORX009C",205,0)
 ;--- Patients with highest utlization
"RTN","RORX009C",206,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"HU_NRX",,SECTION)
"RTN","RORX009C",207,0)
 I TABLE<0  S RC=TABLE  Q
"RTN","RORX009C",208,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","HU_NRX")
"RTN","RORX009C",209,0)
 ;---
"RTN","RORX009C",210,0)
 S NRX="",RC=0
"RTN","RORX009C",211,0)
 F  S NRX=$O(@NODE@("SUMRX",NRX),-1)  Q:NRX=""  D  Q:RC
"RTN","RORX009C",212,0)
 . S RC=$$LOOP^RORTSK01()  Q:RC<0
"RTN","RORX009C",213,0)
 . S NAME=""
"RTN","RORX009C",214,0)
 . F  S NAME=$O(@NODE@("SUMRX",NRX,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX009C",215,0)
 . . S DFN=""
"RTN","RORX009C",216,0)
 . . F  S DFN=$O(@NODE@("SUMRX",NRX,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX009C",217,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX009C",218,0)
 . . . S (IPNRX,OPNRX)=0
"RTN","RORX009C",219,0)
 . . . S BUF=$G(@NODE@("OP",DFN))
"RTN","RORX009C",220,0)
 . . . S:BUF'="" LAST4=$P(BUF,U),DOD=$P(BUF,U,3),OPNRX=$P(BUF,U,4)
"RTN","RORX009C",221,0)
 . . . S BUF=$G(@NODE@("IP",DFN))
"RTN","RORX009C",222,0)
 . . . S:BUF'="" LAST4=$P(BUF,U),DOD=$P(BUF,U,3),IPNRX=$P(BUF,U,4)
"RTN","RORX009C",223,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX009C",224,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX009C",225,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"DOD",DOD,ITEM,1)
"RTN","RORX009C",226,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"OPNRX",OPNRX,ITEM,3)
"RTN","RORX009C",227,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"IPNRX",IPNRX,ITEM,3)
"RTN","RORX009C",228,0)
 . . . S TMP=+$G(@NODE@("SUMRX",NRX,NAME,DFN))
"RTN","RORX009C",229,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"ND",TMP,ITEM,3)
"RTN","RORX009C",230,0)
 ;---
"RTN","RORX009C",231,0)
 Q 0
"RTN","RORX010")
0^181^B42705985
"RTN","RORX010",1,0)
RORX010 ;HCIOFO/SG - LAB TESTS BY RANGE REPORT ; 12/8/05 10:39am
"RTN","RORX010",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX010",3,0)
 ;
"RTN","RORX010",4,0)
 ; This routine uses the following IAs:
"RTN","RORX010",5,0)
 ;
"RTN","RORX010",6,0)
 ; #10061        DEM^VADPT (supported)
"RTN","RORX010",7,0)
 ;
"RTN","RORX010",8,0)
 Q
"RTN","RORX010",9,0)
 ;
"RTN","RORX010",10,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX010",11,0)
 ;
"RTN","RORX010",12,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX010",13,0)
 ;
"RTN","RORX010",14,0)
 ; Return Values:
"RTN","RORX010",15,0)
 ;       <0  Error code
"RTN","RORX010",16,0)
 ;        0  Ok
"RTN","RORX010",17,0)
 ;
"RTN","RORX010",18,0)
HEADER(PARTAG) ;
"RTN","RORX010",19,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,PTLRL(GROUP,DATE,NAME,RESULT))
"RTN","RORX010",20,0)
 ;
"RTN","RORX010",21,0)
 N COLUMNS,HEADER,LT,NAME,TMP
"RTN","RORX010",22,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX010",23,0)
 Q:HEADER<0 HEADER
"RTN","RORX010",24,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX010",HEADER)
"RTN","RORX010",25,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX010",26,0)
 ;
"RTN","RORX010",27,0)
 ;***** COMPILES THE LAB TESTS BY RANGE REPORT
"RTN","RORX010",28,0)
 ; REPORT CODE: 010
"RTN","RORX010",29,0)
 ;
"RTN","RORX010",30,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX010",31,0)
 ;
"RTN","RORX010",32,0)
 ; The ^TMP("RORX010",$J) global node is used by this function.
"RTN","RORX010",33,0)
 ;
"RTN","RORX010",34,0)
 ; Return Values:
"RTN","RORX010",35,0)
 ;       <0  Error code
"RTN","RORX010",36,0)
 ;        0  Ok
"RTN","RORX010",37,0)
 ;
"RTN","RORX010",38,0)
LRGRANGE(RORTSK) ;
"RTN","RORX010",39,0)
 N RORDST        ; Callback descriptor
"RTN","RORX010",40,0)
 N ROREDT        ; End date
"RTN","RORX010",41,0)
 N ROREDT1       ; End date + 1 day
"RTN","RORX010",42,0)
 N RORLTL        ; Closed root of the list of lab tests to search for
"RTN","RORX010",43,0)
 N RORREG        ; Registry IEN
"RTN","RORX010",44,0)
 N RORSDT        ; Start date
"RTN","RORX010",45,0)
 ;
"RTN","RORX010",46,0)
 N BODY,CNT,ECNT,IEN,IENS,LRGLST,RC,REPORT,RORPTN,SFLAGS,TMP
"RTN","RORX010",47,0)
 ;--- Root node of the report
"RTN","RORX010",48,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX010",49,0)
 Q:REPORT<0 REPORT
"RTN","RORX010",50,0)
 ;
"RTN","RORX010",51,0)
 ;--- Get and prepare the report parameters
"RTN","RORX010",52,0)
 S RORREG=+$$PARAM^RORTSK01("REGIEN")
"RTN","RORX010",53,0)
 S RC=$$PARAMS(REPORT,.SFLAGS,.LRGLST)  Q:RC<0 RC
"RTN","RORX010",54,0)
 ;
"RTN","RORX010",55,0)
 ;--- Initialize constants and variables
"RTN","RORX010",56,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX010",57,0)
 S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1),ECNT=0
"RTN","RORX010",58,0)
 K ^TMP("RORX010",$J)
"RTN","RORX010",59,0)
 S RORLTL=$$ALLOC^RORTMP()
"RTN","RORX010",60,0)
 ;
"RTN","RORX010",61,0)
 ;--- Prepare the search parameters
"RTN","RORX010",62,0)
 S RORDST=$NA(^TMP("RORX010",$J))
"RTN","RORX010",63,0)
 S RORDST("RORCB")="$$LTCB^RORX010"
"RTN","RORX010",64,0)
 S RC=$$LOADTSTS^RORUTL10(RORLTL,+RORREG,LRGLST)
"RTN","RORX010",65,0)
 ;
"RTN","RORX010",66,0)
 ;--- Report header and list of patients
"RTN","RORX010",67,0)
 S RC=$$HEADER(REPORT)  G:RC<0 ERROR
"RTN","RORX010",68,0)
 S BODY=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX010",69,0)
 I BODY<0  S RC=+BODY  G ERROR
"RTN","RORX010",70,0)
 D ADDATTR^RORTSK11(RORTSK,BODY,"TABLE","PATIENTS")
"RTN","RORX010",71,0)
 ;
"RTN","RORX010",72,0)
 ;--- Browse through the registry records
"RTN","RORX010",73,0)
 S (CNT,IEN,RC)=0
"RTN","RORX010",74,0)
 F  S IEN=$O(^RORDATA(798,"AC",RORREG,IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX010",75,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX010",76,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX010",77,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX010",78,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX010",79,0)
 . Q:$$SKIP^RORXU005(IEN,SFLAGS,RORSDT,ROREDT)
"RTN","RORX010",80,0)
 . ;--- Process the registry record
"RTN","RORX010",81,0)
 . I $$PATIENT(IENS,BODY)<0  S ECNT=ECNT+1  Q
"RTN","RORX010",82,0)
 ;
"RTN","RORX010",83,0)
ERROR ;--- Cleanup
"RTN","RORX010",84,0)
 D FREE^RORTMP(RORLTL)
"RTN","RORX010",85,0)
 K ^TMP("RORX010",$J)
"RTN","RORX010",86,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX010",87,0)
 ;
"RTN","RORX010",88,0)
 ;***** CALLBACK FUNCTION FOR LAB DATA SEARCH
"RTN","RORX010",89,0)
LTCB(RORDST,INVDT,RESULT) ;
"RTN","RORX010",90,0)
 N GRP,NODE,RC,VAL
"RTN","RORX010",91,0)
 S NODE=$NA(RORTSK("PARAMS","LRGRANGES","C"))
"RTN","RORX010",92,0)
 S GRP=+$P($G(RESULT(2)),U,3)
"RTN","RORX010",93,0)
 ;--- Check the result range if necessary
"RTN","RORX010",94,0)
 I $D(@NODE@(GRP))>1  S RC=1  D  Q:RC RC
"RTN","RORX010",95,0)
 . S VAL=$$CLRNMVAL^RORUTL18($P($G(RESULT(1)),U,3))
"RTN","RORX010",96,0)
 . ;--- Skip a non-numeric result
"RTN","RORX010",97,0)
 . Q:'$$NUMERIC^RORUTL05(VAL)
"RTN","RORX010",98,0)
 . ;--- Check the range
"RTN","RORX010",99,0)
 . I $G(@NODE@(GRP,"L"))'=""  Q:VAL<@NODE@(GRP,"L")
"RTN","RORX010",100,0)
 . I $G(@NODE@(GRP,"H"))'=""  Q:VAL>@NODE@(GRP,"H")
"RTN","RORX010",101,0)
 . S RC=0
"RTN","RORX010",102,0)
 ;--- Store the result
"RTN","RORX010",103,0)
 K RORDST("GRP",GRP)
"RTN","RORX010",104,0)
 S RORDST("RORPTR")=$G(RORDST("RORPTR"))+1
"RTN","RORX010",105,0)
 M @RORDST@(RORDST("RORPTR"))=RESULT
"RTN","RORX010",106,0)
 Q 0
"RTN","RORX010",107,0)
 ;
"RTN","RORX010",108,0)
 ;***** OUTPUTS THE REPORT PARAMETERS
"RTN","RORX010",109,0)
 ;
"RTN","RORX010",110,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX010",111,0)
 ;
"RTN","RORX010",112,0)
 ; .FLAGS        Flags for the $$SKIP^RORXU005 are
"RTN","RORX010",113,0)
 ;               returned via this parameter
"RTN","RORX010",114,0)
 ;
"RTN","RORX010",115,0)
 ; .LRGLST       List of lab group codes for the $$LOADTSTS^RORUTL10
"RTN","RORX010",116,0)
 ;
"RTN","RORX010",117,0)
 ; Return Values:
"RTN","RORX010",118,0)
 ;       <0  Error code
"RTN","RORX010",119,0)
 ;        0  Ok
"RTN","RORX010",120,0)
 ;
"RTN","RORX010",121,0)
PARAMS(PARTAG,FLAGS,LRGLST) ;
"RTN","RORX010",122,0)
 N PARAMS,TMP
"RTN","RORX010",123,0)
 S (FLAGS,LRGLST)=""
"RTN","RORX010",124,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.RORSDT,.ROREDT,.FLAGS)
"RTN","RORX010",125,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX010",126,0)
 ;--- Lab test ranges
"RTN","RORX010",127,0)
 I $D(RORTSK("PARAMS","LRGRANGES","C"))>1  D  Q:RC<0 RC
"RTN","RORX010",128,0)
 . N GRC,ELEMENT,NODE,LRGELMTS,RANGE
"RTN","RORX010",129,0)
 . S NODE=$NA(RORTSK("PARAMS","LRGRANGES","C"))
"RTN","RORX010",130,0)
 . S LRGELMTS=$$ADDVAL^RORTSK11(RORTSK,"LRGRANGES",,PARAMS)
"RTN","RORX010",131,0)
 . S (GRC,RC)=0
"RTN","RORX010",132,0)
 . F  S GRC=$O(@NODE@(GRC))  Q:GRC'>0  D  Q:RC<0
"RTN","RORX010",133,0)
 . . S RANGE=0,TMP=$$RANGE(GRC)
"RTN","RORX010",134,0)
 . . S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,"LRGRANGE",TMP,LRGELMTS)
"RTN","RORX010",135,0)
 . . I ELEMENT<0  S RC=ELEMENT  Q
"RTN","RORX010",136,0)
 . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"ID",GRC)
"RTN","RORX010",137,0)
 . . S LRGLST=LRGLST_$S(LRGLST'="":","_GRC,1:GRC)
"RTN","RORX010",138,0)
 . . ;--- Process the range values
"RTN","RORX010",139,0)
 . . S TMP=$G(@NODE@(GRC,"L"))
"RTN","RORX010",140,0)
 . . I TMP'=""  D  S RANGE=1
"RTN","RORX010",141,0)
 . . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"LOW",TMP)
"RTN","RORX010",142,0)
 . . S TMP=$G(@NODE@(GRC,"H"))
"RTN","RORX010",143,0)
 . . I TMP'=""  D  S RANGE=1
"RTN","RORX010",144,0)
 . . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"HIGH",TMP)
"RTN","RORX010",145,0)
 . . D:RANGE ADDATTR^RORTSK11(RORTSK,ELEMENT,"RANGE",1)
"RTN","RORX010",146,0)
 ;--- Success
"RTN","RORX010",147,0)
 Q PARAMS
"RTN","RORX010",148,0)
 ;
"RTN","RORX010",149,0)
 ;***** ADDS THE PATIENT DATA TO THE REPORT
"RTN","RORX010",150,0)
 ;
"RTN","RORX010",151,0)
 ; IENS          IENS of the patient's record in the registry
"RTN","RORX010",152,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX010",153,0)
 ;
"RTN","RORX010",154,0)
 ; Return Values:
"RTN","RORX010",155,0)
 ;       <0  Error code
"RTN","RORX010",156,0)
 ;        0  Ok
"RTN","RORX010",157,0)
 ;
"RTN","RORX010",158,0)
PATIENT(IENS,PARTAG) ;
"RTN","RORX010",159,0)
 N DFN,I,LABTESTS,LT,NAME,RC,RORBUF,RORMSG,TMP,VA,VADM
"RTN","RORX010",160,0)
 ;--- Get the data from the ROR REGISTRY RECORD file
"RTN","RORX010",161,0)
 D GETS^DIQ(798,IENS,".01","I","RORBUF","RORMSG")
"RTN","RORX010",162,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","RORX010",163,0)
 S DFN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","RORX010",164,0)
 ;--- Search for the lab results
"RTN","RORX010",165,0)
 K @RORDST,RORDST("RORPTR")
"RTN","RORX010",166,0)
 M RORDST("GRP")=RORTSK("PARAMS","LRGRANGES","C")
"RTN","RORX010",167,0)
 S RC=$$LTSEARCH^RORUTL10(DFN,RORLTL,.RORDST,,RORSDT,ROREDT1)
"RTN","RORX010",168,0)
 Q:RC'>0 RC
"RTN","RORX010",169,0)
 ;--- Results from all groups should be present
"RTN","RORX010",170,0)
 Q:$D(RORDST("GRP"))>1 0
"RTN","RORX010",171,0)
 ;--- Load the demographic data
"RTN","RORX010",172,0)
 D VADEM^RORUTL05(DFN,1)
"RTN","RORX010",173,0)
 ;--- The <PATIENT> tag
"RTN","RORX010",174,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PARTAG,,DFN)
"RTN","RORX010",175,0)
 Q:PTAG<0 PTAG
"RTN","RORX010",176,0)
 ;--- Patient Name
"RTN","RORX010",177,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX010",178,0)
 ;--- Last 4 digits of the SSN
"RTN","RORX010",179,0)
 D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG,2)
"RTN","RORX010",180,0)
 ;--- Date of death
"RTN","RORX010",181,0)
 S TMP=$$DATE^RORXU002($P(VADM(6),U)\1)
"RTN","RORX010",182,0)
 D ADDVAL^RORTSK11(RORTSK,"DOD",TMP,PTAG,1)
"RTN","RORX010",183,0)
 ;--- Lab results
"RTN","RORX010",184,0)
 S LABTESTS=$$ADDVAL^RORTSK11(RORTSK,"PTLRL",,PTAG)
"RTN","RORX010",185,0)
 S I=""
"RTN","RORX010",186,0)
 F  S I=$O(@RORDST@(I))  Q:I=""  D
"RTN","RORX010",187,0)
 . S LT=$$ADDVAL^RORTSK11(RORTSK,"LT",,LABTESTS)
"RTN","RORX010",188,0)
 . D ADDVAL^RORTSK11(RORTSK,"GROUP",$P(@RORDST@(I,2),U,4),LT,1)
"RTN","RORX010",189,0)
 . D ADDVAL^RORTSK11(RORTSK,"DATE",$P(@RORDST@(I,1),U,2),LT,1)
"RTN","RORX010",190,0)
 . D ADDVAL^RORTSK11(RORTSK,"NAME",$P(@RORDST@(I,2),U,2),LT,1)
"RTN","RORX010",191,0)
 . D ADDVAL^RORTSK11(RORTSK,"RESULT",$P(@RORDST@(I,1),U,3),LT,3)
"RTN","RORX010",192,0)
 ;---
"RTN","RORX010",193,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX010",194,0)
 ;
"RTN","RORX010",195,0)
 ;***** PROCESSES THE RESULT RANGE OPTIONS
"RTN","RORX010",196,0)
 ;
"RTN","RORX010",197,0)
 ; GRC           Code of a Lab Group
"RTN","RORX010",198,0)
 ;
"RTN","RORX010",199,0)
 ; Return Values:
"RTN","RORX010",200,0)
 ;       Description of the Lab results to be included in the report.
"RTN","RORX010",201,0)
 ;
"RTN","RORX010",202,0)
RANGE(GRC) ;
"RTN","RORX010",203,0)
 N RANGE,TMP
"RTN","RORX010",204,0)
 S RANGE=""
"RTN","RORX010",205,0)
 ;--- Range
"RTN","RORX010",206,0)
 D:$D(RORTSK("PARAMS","LRGRANGES","C",GRC))>1
"RTN","RORX010",207,0)
 . ;--- Low
"RTN","RORX010",208,0)
 . S TMP=$G(RORTSK("PARAMS","LRGRANGES","C",GRC,"L"))
"RTN","RORX010",209,0)
 . S:TMP'="" RANGE=RANGE_" not less than "_TMP
"RTN","RORX010",210,0)
 . ;--- High
"RTN","RORX010",211,0)
 . S TMP=$G(RORTSK("PARAMS","LRGRANGES","C",GRC,"H"))
"RTN","RORX010",212,0)
 . I TMP'=""  D:RANGE'=""  S RANGE=RANGE_" not greater than "_TMP
"RTN","RORX010",213,0)
 . . S RANGE=RANGE_" and"
"RTN","RORX010",214,0)
 ;--- Description
"RTN","RORX010",215,0)
 S TMP=$G(RORTSK("PARAMS","LRGRANGES","C",GRC))
"RTN","RORX010",216,0)
 S:TMP="" TMP="Unknown ("_GRC_")"
"RTN","RORX010",217,0)
 Q TMP_" - "_$S(RANGE'="":"numeric results"_RANGE,1:"all results")
"RTN","RORX011")
0^182^B48518702
"RTN","RORX011",1,0)
RORX011 ;HCIOFO/SG - PATIENT MEDICATION HISTORY ; 11/19/05 8:18pm
"RTN","RORX011",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX011",3,0)
 ;
"RTN","RORX011",4,0)
 Q
"RTN","RORX011",5,0)
 ;
"RTN","RORX011",6,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX011",7,0)
 ;
"RTN","RORX011",8,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX011",9,0)
 ;
"RTN","RORX011",10,0)
 ; Return Values:
"RTN","RORX011",11,0)
 ;       <0  Error code
"RTN","RORX011",12,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX011",13,0)
 ;
"RTN","RORX011",14,0)
HEADER(PARTAG) ;
"RTN","RORX011",15,0)
 ;;PTRXL(DATE,ORDER,TYPE,NAME,GENERIC,DAYSPLY,FILLTYPE)
"RTN","RORX011",16,0)
 ;
"RTN","RORX011",17,0)
 N HEADER,NOTES,RC
"RTN","RORX011",18,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX011",19,0)
 Q:HEADER<0 HEADER
"RTN","RORX011",20,0)
 S NOTES=$$ADDVAL^RORTSK11(RORTSK,"NOTES",,HEADER)
"RTN","RORX011",21,0)
 D ADDVAL^RORTSK11(RORTSK,"AGE",$$DT^XLFDT,NOTES)
"RTN","RORX011",22,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX011",HEADER)
"RTN","RORX011",23,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX011",24,0)
 ;
"RTN","RORX011",25,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX011",26,0)
 ;
"RTN","RORX011",27,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX011",28,0)
 ;
"RTN","RORX011",29,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX011",30,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX011",31,0)
 ;
"RTN","RORX011",32,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX011",33,0)
 ;               returned via this parameter
"RTN","RORX011",34,0)
 ;
"RTN","RORX011",35,0)
 ; Return Values:
"RTN","RORX011",36,0)
 ;       <0  Error code
"RTN","RORX011",37,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX011",38,0)
 ;
"RTN","RORX011",39,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX011",40,0)
 N PARAMS,TMP
"RTN","RORX011",41,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX011",42,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX011",43,0)
 ;--- Process the drug list and options
"RTN","RORX011",44,0)
 S TMP=$$DRUGLST^RORXU007(.RORTSK,PARAMS,.RORXL,.RORXGRP)
"RTN","RORX011",45,0)
 Q:TMP<0 TMP
"RTN","RORX011",46,0)
 ;---
"RTN","RORX011",47,0)
 Q PARAMS
"RTN","RORX011",48,0)
 ;
"RTN","RORX011",49,0)
 ;***** PROCESS THE PATIENT'S DATA
"RTN","RORX011",50,0)
 ;
"RTN","RORX011",51,0)
 ; PTLIST        Reference (IEN) to the parent tag
"RTN","RORX011",52,0)
 ; PATIEN        Patient IEN in the file #2 (DFN)
"RTN","RORX011",53,0)
 ;
"RTN","RORX011",54,0)
 ; Return Values:
"RTN","RORX011",55,0)
 ;       <0  Error code
"RTN","RORX011",56,0)
 ;        0  Ok
"RTN","RORX011",57,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX011",58,0)
 ;
"RTN","RORX011",59,0)
PATIENT(PTLIST,PATIEN) ;
"RTN","RORX011",60,0)
 N BUF,FLT,FLTL,FQL,ITEM,NODE,PTAG,QSB,RC,TABLE,VA,VADM,VAERR
"RTN","RORX011",61,0)
 S (ECNT,RC)=0
"RTN","RORX011",62,0)
 ;--- Patient data
"RTN","RORX011",63,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PTLIST,,PATIEN)
"RTN","RORX011",64,0)
 Q:PTAG<0 PTAG
"RTN","RORX011",65,0)
 D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX011",66,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX011",67,0)
 D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG)
"RTN","RORX011",68,0)
 D ADDVAL^RORTSK11(RORTSK,"DOB",$$DATE^RORXU002(VADM(3)\1),PTAG)
"RTN","RORX011",69,0)
 D ADDVAL^RORTSK11(RORTSK,"AGE",VADM(4),PTAG)
"RTN","RORX011",70,0)
 D ADDVAL^RORTSK11(RORTSK,"DOD",$$DATE^RORXU002(VADM(6)\1),PTAG)
"RTN","RORX011",71,0)
 ;--- List of drugs
"RTN","RORX011",72,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PTRXL",,PTAG)
"RTN","RORX011",73,0)
 Q:TABLE<0 TABLE
"RTN","RORX011",74,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PTRXL")
"RTN","RORX011",75,0)
 ;---
"RTN","RORX011",76,0)
 S NODE=RORXDST,FLTL=$L(NODE)-1,FLT=$E(NODE,1,FLTL)
"RTN","RORX011",77,0)
 S QSB=$QL(NODE),FQL=QSB+5
"RTN","RORX011",78,0)
 F  S NODE=$Q(@NODE)  Q:$E(NODE,1,FLTL)'=FLT  D:$QL(NODE)=FQL
"RTN","RORX011",79,0)
 . ; NODE: @RORXDST@(DATE,DRUGNAME,DRUGIEN,RXNUM,RXCNT)
"RTN","RORX011",80,0)
 . S BUF=@NODE
"RTN","RORX011",81,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"DRUG",,TABLE)
"RTN","RORX011",82,0)
 . D ADDVAL^RORTSK11(RORTSK,"DATE",$QS(NODE,QSB+1)\1,ITEM,1)
"RTN","RORX011",83,0)
 . D ADDVAL^RORTSK11(RORTSK,"ORDER",$QS(NODE,QSB+4),ITEM,1)
"RTN","RORX011",84,0)
 . S TMP=$P(BUF,U)
"RTN","RORX011",85,0)
 . S TMP=$S(TMP="O":"ORIGINAL",TMP="P":"PARTIAL",TMP="R":"REFILL",1:"")
"RTN","RORX011",86,0)
 . D ADDVAL^RORTSK11(RORTSK,"TYPE",TMP,ITEM,1)
"RTN","RORX011",87,0)
 . D ADDVAL^RORTSK11(RORTSK,"NAME",$QS(NODE,QSB+2),ITEM,1)
"RTN","RORX011",88,0)
 . D ADDVAL^RORTSK11(RORTSK,"GENERIC",$P(BUF,U,4),ITEM,1)
"RTN","RORX011",89,0)
 . D ADDVAL^RORTSK11(RORTSK,"DAYSPLY",$P(BUF,U,5),ITEM,1)
"RTN","RORX011",90,0)
 . S TMP=$P(BUF,U,2)
"RTN","RORX011",91,0)
 . S TMP=$S(TMP="I":"INPATIENT",TMP="M":"MAIL",TMP="W":"WINDOW",1:"")
"RTN","RORX011",92,0)
 . D ADDVAL^RORTSK11(RORTSK,"FILLTYPE",TMP,ITEM,1)
"RTN","RORX011",93,0)
 ;---
"RTN","RORX011",94,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX011",95,0)
 ;
"RTN","RORX011",96,0)
 ;***** PROCESSES THE LIST OF PATIENTS
"RTN","RORX011",97,0)
 ;
"RTN","RORX011",98,0)
 ; REPORT        Reference (IEN) to the parent tag
"RTN","RORX011",99,0)
 ;
"RTN","RORX011",100,0)
 ; Return Values:
"RTN","RORX011",101,0)
 ;       <0  Error code
"RTN","RORX011",102,0)
 ;        0  Ok
"RTN","RORX011",103,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX011",104,0)
 ;
"RTN","RORX011",105,0)
PROCESS(REPORT) ;
"RTN","RORX011",106,0)
 N CNT,ECNT,PATIEN,PTLIST,PTNODE,RC,RORPTN,RORXDST,RXFLAGS,TMP
"RTN","RORX011",107,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX011",108,0)
 S PTNODE=$NA(RORTSK("PARAMS","PATIENTS","C"))
"RTN","RORX011",109,0)
 ;
"RTN","RORX011",110,0)
 ;--- Count patients in the list
"RTN","RORX011",111,0)
 S (PATIEN,RORPTN)=0
"RTN","RORX011",112,0)
 F  S PATIEN=$O(@PTNODE@(PATIEN))  Q:PATIEN'>0  S RORPTN=RORPTN+1
"RTN","RORX011",113,0)
 Q:RORPTN'>0 0
"RTN","RORX011",114,0)
 S PTLIST=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX011",115,0)
 Q:PTLIST<0 PTLIST
"RTN","RORX011",116,0)
 ;
"RTN","RORX011",117,0)
 ;--- Prepare parameters for the pharmacy search API
"RTN","RORX011",118,0)
 S RORXDST=$NA(^TMP("RORX011",$J))
"RTN","RORX011",119,0)
 S RORXDST("RORCB")="$$RXSCB^RORX011"
"RTN","RORX011",120,0)
 S RXFLAGS="E"
"RTN","RORX011",121,0)
 S:$$PARAM^RORTSK01("PATIENTS","INPATIENT") RXFLAGS=RXFLAGS_"IV"
"RTN","RORX011",122,0)
 S:$$PARAM^RORTSK01("PATIENTS","OUTPATIENT") RXFLAGS=RXFLAGS_"O"
"RTN","RORX011",123,0)
 ;
"RTN","RORX011",124,0)
 ;--- Browse through the list of patients
"RTN","RORX011",125,0)
 S (CNT,PATIEN)=0
"RTN","RORX011",126,0)
 F  S PATIEN=$O(@PTNODE@(PATIEN))  Q:PATIEN'>0  D  Q:RC<0
"RTN","RORX011",127,0)
 . S RC=$$LOOP^RORTSK01(CNT/RORPTN)  Q:RC<0
"RTN","RORX011",128,0)
 . S CNT=CNT+1
"RTN","RORX011",129,0)
 . ;--- Search the pharmacy data
"RTN","RORX011",130,0)
 . K @RORXDST
"RTN","RORX011",131,0)
 . S TMP=$$RXSEARCH^RORUTL14(PATIEN,RORXL,.RORXDST,RXFLAGS,RORSDT,ROREDT1)
"RTN","RORX011",132,0)
 . I TMP<0  S ECNT=ECNT+1  Q
"RTN","RORX011",133,0)
 . ;--- Append the patient's data to the report
"RTN","RORX011",134,0)
 . S TMP=$$PATIENT(PTLIST,PATIEN)
"RTN","RORX011",135,0)
 . I TMP  S ECNT=ECNT+$S(TMP>0:TMP,1:1)  Q
"RTN","RORX011",136,0)
 ;
"RTN","RORX011",137,0)
 ;--- Cleanup
"RTN","RORX011",138,0)
 K @RORXDST
"RTN","RORX011",139,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX011",140,0)
 ;
"RTN","RORX011",141,0)
 ;***** COMPILES THE "PATIENT DRUG HISTORY" REPORT
"RTN","RORX011",142,0)
 ; REPORT CODE: 011
"RTN","RORX011",143,0)
 ;
"RTN","RORX011",144,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX011",145,0)
 ;
"RTN","RORX011",146,0)
 ; The ^TMP("RORX011",$J) global node is used by this function.
"RTN","RORX011",147,0)
 ;
"RTN","RORX011",148,0)
 ; Return Values:
"RTN","RORX011",149,0)
 ;       <0  Error code
"RTN","RORX011",150,0)
 ;        0  Ok
"RTN","RORX011",151,0)
 ;
"RTN","RORX011",152,0)
RXHIST(RORTSK) ;
"RTN","RORX011",153,0)
 N ROREDT        ; End date
"RTN","RORX011",154,0)
 N ROREDT1       ; End date + 1
"RTN","RORX011",155,0)
 N RORREG        ; Registry IEN
"RTN","RORX011",156,0)
 N RORSDT        ; Start date
"RTN","RORX011",157,0)
 N RORXGRP       ; List of drug groups
"RTN","RORX011",158,0)
 N RORXL         ; List of drugs
"RTN","RORX011",159,0)
 ;
"RTN","RORX011",160,0)
 N ECNT,RC,REPORT,TMP
"RTN","RORX011",161,0)
 S RORXL="",(ECNT,RC)=0
"RTN","RORX011",162,0)
 K ^TMP("RORX011",$J)
"RTN","RORX011",163,0)
 ;
"RTN","RORX011",164,0)
 ;--- Root node of the report
"RTN","RORX011",165,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX011",166,0)
 Q:REPORT<0 REPORT
"RTN","RORX011",167,0)
 ;
"RTN","RORX011",168,0)
 D
"RTN","RORX011",169,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX011",170,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX011",171,0)
 . S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT)  Q:RC<0
"RTN","RORX011",172,0)
 . S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1)
"RTN","RORX011",173,0)
 . ;
"RTN","RORX011",174,0)
 . ;--- Report header
"RTN","RORX011",175,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX011",176,0)
 . ;
"RTN","RORX011",177,0)
 . ;--- Process the data and generate the report
"RTN","RORX011",178,0)
 . S RC=$$PROCESS(REPORT)  S:RC>0 ECNT=ECNT+RC
"RTN","RORX011",179,0)
 ;
"RTN","RORX011",180,0)
 ;--- Cleanup
"RTN","RORX011",181,0)
 K ^TMP("RORX011",$J)
"RTN","RORX011",182,0)
 D FREE^RORTMP(RORXL)
"RTN","RORX011",183,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX011",184,0)
 ;
"RTN","RORX011",185,0)
 ;***** CALLBACK FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORX011",186,0)
RXSCB(ROR8DST,ORDER,ORDFLG,DRUG,DATE) ;
"RTN","RORX011",187,0)
 N DRUGIEN,DRUGNAME,FILLTYPE,IEN,IRP,OFD,RPSUB,RXBUF,RXCNT,RXNUM,TMP
"RTN","RORX011",188,0)
 S DRUGIEN=+DRUG,DRUGNAME=$P(DRUG,U,2)
"RTN","RORX011",189,0)
 Q:(DRUGIEN'>0)!(DRUGNAME="") 1
"RTN","RORX011",190,0)
 ;--- Check the drug groups
"RTN","RORX011",191,0)
 S TMP=$$RXGRPCHK^RORXU007(.ROR8DST,+DRUG,RORXL)
"RTN","RORX011",192,0)
 Q:TMP TMP
"RTN","RORX011",193,0)
 ;--- Process the order
"RTN","RORX011",194,0)
 S:ROR8DST("RORXGEN")>0 $P(RXBUF,U,4)=$P(ROR8DST("RORXGEN"),U,2)
"RTN","RORX011",195,0)
 S $P(RXBUF,U,5)=$P($G(^TMP("PS",$J,0)),U,7)  ; Days Supply
"RTN","RORX011",196,0)
 S TMP=$G(^TMP("PS",$J,"RXN",0))
"RTN","RORX011",197,0)
 S FILLTYPE=$S(ORDFLG["I":"I",1:$P(TMP,U,3))
"RTN","RORX011",198,0)
 S RXNUM=$P(TMP,U)  S:RXNUM="" RXNUM=" "
"RTN","RORX011",199,0)
 S RXCNT=0
"RTN","RORX011",200,0)
 ;--- Original prescription
"RTN","RORX011",201,0)
 I ORDFLG["I"  D  ;--- Inpatient
"RTN","RORX011",202,0)
 . S OFD=$P($G(^TMP("PS",$J,0)),U,5)         ; Start Date
"RTN","RORX011",203,0)
 . S $P(RXBUF,U,1,2)="I"_U_FILLTYPE,RXCNT=RXCNT+1
"RTN","RORX011",204,0)
 . S @ROR8DST@(OFD,DRUGNAME,DRUGIEN,RXNUM,RXCNT)=RXBUF
"RTN","RORX011",205,0)
 E  D             ;--- Outpatient
"RTN","RORX011",206,0)
 . S OFD=+$P($G(^TMP("PS",$J,"RXN",0)),U,6)  ; Original Fill Date
"RTN","RORX011",207,0)
 . Q:(OFD<ROR8DST("RORSDT"))!(OFD'<ROR8DST("ROREDT"))
"RTN","RORX011",208,0)
 . S $P(RXBUF,U,1,2)="O"_U_FILLTYPE,RXCNT=RXCNT+1
"RTN","RORX011",209,0)
 . S @ROR8DST@(OFD,DRUGNAME,DRUGIEN,RXNUM,RXCNT)=RXBUF
"RTN","RORX011",210,0)
 ;--- Refills and partials
"RTN","RORX011",211,0)
 F RPSUB="REF","PAR"  D
"RTN","RORX011",212,0)
 . S $P(RXBUF,U)=$E(RPSUB,1)
"RTN","RORX011",213,0)
 . S IRP=0
"RTN","RORX011",214,0)
 . F  S IRP=$O(^TMP("PS",$J,RPSUB,IRP))  Q:IRP'>0  D
"RTN","RORX011",215,0)
 . . S TMP=$G(^TMP("PS",$J,RPSUB,IRP,0))
"RTN","RORX011",216,0)
 . . S $P(RXBUF,U,2)=$S(ORDFLG["I":"I",1:$P(TMP,U,5))
"RTN","RORX011",217,0)
 . . S $P(RXBUF,U,5)=$P(TMP,U,2)  ; Days Supply
"RTN","RORX011",218,0)
 . . I TMP>0  S RXCNT=RXCNT+1  D
"RTN","RORX011",219,0)
 . . . S @ROR8DST@(+TMP,DRUGNAME,DRUGIEN,RXNUM,RXCNT)=RXBUF
"RTN","RORX011",220,0)
 Q 0
"RTN","RORX012")
0^183^B14019577
"RTN","RORX012",1,0)
RORX012 ;HOIFO/SG - COMBINED MEDS AND LABS REPORT ; 11/8/05 8:48am
"RTN","RORX012",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX012",3,0)
 ;
"RTN","RORX012",4,0)
 Q
"RTN","RORX012",5,0)
 ;
"RTN","RORX012",6,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX012",7,0)
 ;
"RTN","RORX012",8,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX012",9,0)
 ;
"RTN","RORX012",10,0)
 ; Return Values:
"RTN","RORX012",11,0)
 ;       <0  Error code
"RTN","RORX012",12,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX012",13,0)
 ;
"RTN","RORX012",14,0)
HEADER(PARTAG) ;
"RTN","RORX012",15,0)
 ;;DRUGS(#,NAME,LAST4,DOD,RXNAME)
"RTN","RORX012",16,0)
 ;;LABTESTS(#,NAME,LAST4,DOD,DATE,LTNAME,RESULT)
"RTN","RORX012",17,0)
 ;;PATIENTS(#,NAME,LAST4,DOD)
"RTN","RORX012",18,0)
 ;
"RTN","RORX012",19,0)
 N HEADER,RC
"RTN","RORX012",20,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX012",21,0)
 Q:HEADER<0 HEADER
"RTN","RORX012",22,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX012",HEADER)
"RTN","RORX012",23,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX012",24,0)
 ;
"RTN","RORX012",25,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX012",26,0)
 ;
"RTN","RORX012",27,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX012",28,0)
 ;
"RTN","RORX012",29,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX012",30,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX012",31,0)
 ;
"RTN","RORX012",32,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX012",33,0)
 ;               returned via this parameter
"RTN","RORX012",34,0)
 ;
"RTN","RORX012",35,0)
 ; Return Values:
"RTN","RORX012",36,0)
 ;       <0  Error code
"RTN","RORX012",37,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX012",38,0)
 ;
"RTN","RORX012",39,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX012",40,0)
 N PARAMS,TMP
"RTN","RORX012",41,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX012",42,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX012",43,0)
 ;--- Process the list of drugs and groups
"RTN","RORX012",44,0)
 I RORPHARM  D  Q:TMP<0 TMP
"RTN","RORX012",45,0)
 . S TMP=$$DRUGLST^RORXU007(.RORTSK,PARAMS,.RORXL,.RORXGRP)
"RTN","RORX012",46,0)
 ;--- Process the list of Lab tests
"RTN","RORX012",47,0)
 I RORLAB  D  Q:TMP<0 TMP
"RTN","RORX012",48,0)
 . S TMP=$$LTLST^RORXU006(.RORTSK,PARAMS,.RORLTST,"RORLTRV")
"RTN","RORX012",49,0)
 ;---
"RTN","RORX012",50,0)
 Q PARAMS
"RTN","RORX012",51,0)
 ;
"RTN","RORX012",52,0)
 ;***** DETERMINES THE REPORT MODE FOR LAB OR PHARMACY
"RTN","RORX012",53,0)
 ;
"RTN","RORX012",54,0)
 ; NAME          Base name of the attribute ("LAB" or "PHARM")
"RTN","RORX012",55,0)
 ;
"RTN","RORX012",56,0)
 ; Return Values:
"RTN","RORX012",57,0)
 ;       <0  "Did Not"
"RTN","RORX012",58,0)
 ;        0  Not selected
"RTN","RORX012",59,0)
 ;       >0  "Did"
"RTN","RORX012",60,0)
RPTMODE(NAME) ;
"RTN","RORX012",61,0)
 Q:$$PARAM^RORTSK01("PATIENTS",NAME) 1        ; "Did"
"RTN","RORX012",62,0)
 Q:$$PARAM^RORTSK01("PATIENTS","NO"_NAME) -1  ; "Did Not"
"RTN","RORX012",63,0)
 Q 0
"RTN","RORX012",64,0)
 ;
"RTN","RORX012",65,0)
 ;***** COMPILES THE "COMBINED PHARMACY AND LAB" REPORT
"RTN","RORX012",66,0)
 ; REPORT CODE: 012
"RTN","RORX012",67,0)
 ;
"RTN","RORX012",68,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX012",69,0)
 ;
"RTN","RORX012",70,0)
 ; The ^TMP("RORX012",$J) global node is used by this function.
"RTN","RORX012",71,0)
 ;
"RTN","RORX012",72,0)
 ; ^TMP("RORX012",$J,
"RTN","RORX012",73,0)
 ;   "PAT",
"RTN","RORX012",74,0)
 ;     DFN,              Patient descriptor
"RTN","RORX012",75,0)
 ;                         ^01: Last 4 digits of SSN
"RTN","RORX012",76,0)
 ;                         ^02: Patient name
"RTN","RORX012",77,0)
 ;                         ^03: Date of Death
"RTN","RORX012",78,0)
 ;       "LR",
"RTN","RORX012",79,0)
 ;         Date,
"RTN","RORX012",80,0)
 ;           TestName,
"RTN","RORX012",81,0)
 ;             TestIEN)  Result
"RTN","RORX012",82,0)
 ;       "RX",
"RTN","RORX012",83,0)
 ;         DrugName,
"RTN","RORX012",84,0)
 ;           DrugIEN)    ""
"RTN","RORX012",85,0)
 ;
"RTN","RORX012",86,0)
 ; Return Values:
"RTN","RORX012",87,0)
 ;       <0  Error code
"RTN","RORX012",88,0)
 ;        0  Ok
"RTN","RORX012",89,0)
 ;
"RTN","RORX012",90,0)
RXANDLAB(RORTSK) ;
"RTN","RORX012",91,0)
 N RORLAB        ; Labs mode (-1|0|1)
"RTN","RORX012",92,0)
 N RORLTST       ; Closed root of the list of lab tests for the
"RTN","RORX012",93,0)
 ;               ; Lab search API
"RTN","RORX012",94,0)
 N RORLTRV       ; Closed root of the list of lab tests with ranges
"RTN","RORX012",95,0)
 N RORPHARM      ; Meds mode (-1|0|1)
"RTN","RORX012",96,0)
 N RORREG        ; Registry IEN
"RTN","RORX012",97,0)
 N RORXEDT       ; Pharmacy end date
"RTN","RORX012",98,0)
 N RORXGRP       ; List of drug groups
"RTN","RORX012",99,0)
 N RORXL         ; Closed root of the drug list for the pharmacy
"RTN","RORX012",100,0)
 ;               ; search API or "*" if all drugs were selected
"RTN","RORX012",101,0)
 N RORXSDT       ; Pharmacy start date
"RTN","RORX012",102,0)
 ;
"RTN","RORX012",103,0)
 N ECNT,NSPT,RC,REPORT,SFLAGS,TMP
"RTN","RORX012",104,0)
 S (RORXL,RORLTST)="",(ECNT,RC)=0
"RTN","RORX012",105,0)
 K ^TMP("RORX012",$J)
"RTN","RORX012",106,0)
 ;--- Root node of the report
"RTN","RORX012",107,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX012",108,0)
 Q:REPORT<0 REPORT
"RTN","RORX012",109,0)
 ;
"RTN","RORX012",110,0)
 D
"RTN","RORX012",111,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX012",112,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")  ; Registry IEN
"RTN","RORX012",113,0)
 . S RORLAB=$$RPTMODE("LAB")            ; Labs logic
"RTN","RORX012",114,0)
 . S RORPHARM=$$RPTMODE("PHARM")        ; Meds logic
"RTN","RORX012",115,0)
 . S RC=$$PARAMS(REPORT,.RORXSDT,.RORXEDT,.SFLAGS)  Q:RC<0
"RTN","RORX012",116,0)
 . ;--- Report header
"RTN","RORX012",117,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX012",118,0)
 . ;--- Query the registry
"RTN","RORX012",119,0)
 . D TPPSETUP^RORTSK01(80)
"RTN","RORX012",120,0)
 . S RC=$$QUERY^RORX012A(SFLAGS,.NSPT)
"RTN","RORX012",121,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX012",122,0)
 . ;--- Store the results
"RTN","RORX012",123,0)
 . D TPPSETUP^RORTSK01(20)
"RTN","RORX012",124,0)
 . S RC=$$STORE^RORX012A(REPORT,NSPT)
"RTN","RORX012",125,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX012",126,0)
 ;
"RTN","RORX012",127,0)
 ;--- Cleanup
"RTN","RORX012",128,0)
 K ^TMP("RORX012",$J)
"RTN","RORX012",129,0)
 D FREE^RORTMP(RORXL),FREE^RORTMP(RORLTST)
"RTN","RORX012",130,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX012A")
0^184^B65824765
"RTN","RORX012A",1,0)
RORX012A ;HCIOFO/SG - COMBINED MEDS AND LABS (QUERY & STORE) ; 12/8/05 10:39am
"RTN","RORX012A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX012A",3,0)
 ;
"RTN","RORX012A",4,0)
 Q
"RTN","RORX012A",5,0)
 ;
"RTN","RORX012A",6,0)
 ;***** LAB SEARCH CALLBACK
"RTN","RORX012A",7,0)
 ;
"RTN","RORX012A",8,0)
 ; .ROR8DST      Reference to the ROR8DST parameter.
"RTN","RORX012A",9,0)
 ;
"RTN","RORX012A",10,0)
 ; INVDT         IEN of the Lab test (inverted date)
"RTN","RORX012A",11,0)
 ;
"RTN","RORX012A",12,0)
 ; .RESULT       Reference to a local variable, which contains
"RTN","RORX012A",13,0)
 ;               the result (see the $$LTSEARCH^RORUTL10).
"RTN","RORX012A",14,0)
 ;
"RTN","RORX012A",15,0)
 ; Return Values:
"RTN","RORX012A",16,0)
 ;       <0  Error code (the search will be aborted)
"RTN","RORX012A",17,0)
 ;        0  Ok
"RTN","RORX012A",18,0)
 ;        1  Skip this result
"RTN","RORX012A",19,0)
 ;        2  Skip this and all remaining results
"RTN","RORX012A",20,0)
 ;
"RTN","RORX012A",21,0)
LTSCB(ROR8DST,INVDT,RESULT) ;
"RTN","RORX012A",22,0)
 N DATE,IEN,NAME,RC,TMP,VAL
"RTN","RORX012A",23,0)
 S IEN=+RESULT(2)           Q:IEN'>0 1   ; IEN of the Lab test
"RTN","RORX012A",24,0)
 S NAME=$P(RESULT(2),U,2)   Q:NAME="" 1  ; Name of the test
"RTN","RORX012A",25,0)
 S DATE=+$P(RESULT(1),U,2)  Q:DATE'>0 1  ; Date of the test
"RTN","RORX012A",26,0)
 S ROR8DST("RORUTIL")=1
"RTN","RORX012A",27,0)
 ;--- Check the result range if necessary
"RTN","RORX012A",28,0)
 I $D(RORLTRV(IEN))>1  S RC=1  D  Q:RC RC
"RTN","RORX012A",29,0)
 . S VAL=$$CLRNMVAL^RORUTL18($P(RESULT(1),U,3))
"RTN","RORX012A",30,0)
 . ;--- Skip a non-numeric result
"RTN","RORX012A",31,0)
 . Q:'$$NUMERIC^RORUTL05(VAL)
"RTN","RORX012A",32,0)
 . ;--- Check the range
"RTN","RORX012A",33,0)
 . I $G(RORLTRV(IEN,"L"))'=""  Q:VAL<RORLTRV(IEN,"L")
"RTN","RORX012A",34,0)
 . I $G(RORLTRV(IEN,"H"))'=""  Q:VAL>RORLTRV(IEN,"H")
"RTN","RORX012A",35,0)
 . S RC=0
"RTN","RORX012A",36,0)
 ;--- Store the result
"RTN","RORX012A",37,0)
 S @ROR8DST@(DATE,NAME,IEN)=$P(RESULT(1),U,3)
"RTN","RORX012A",38,0)
 Q 0
"RTN","RORX012A",39,0)
 ;
"RTN","RORX012A",40,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX012A",41,0)
 ;
"RTN","RORX012A",42,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX012A",43,0)
 ; .NSPT         Number of selected patients is returned here
"RTN","RORX012A",44,0)
 ;
"RTN","RORX012A",45,0)
 ; Return Values:
"RTN","RORX012A",46,0)
 ;       <0  Error code
"RTN","RORX012A",47,0)
 ;        0  Ok
"RTN","RORX012A",48,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX012A",49,0)
 ;
"RTN","RORX012A",50,0)
QUERY(FLAGS,NSPT) ;
"RTN","RORX012A",51,0)
 N RORLDST       ; Descriptor for Lab search API
"RTN","RORX012A",52,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX012A",53,0)
 N RORXDST       ; Descriptor for pharmacy search API
"RTN","RORX012A",54,0)
 ;
"RTN","RORX012A",55,0)
 N CNT,ECNT,IEN,IENS,LTEDT,LTSDT,PATIEN,RC,RXEDT,SKIP,SKIPEDT,SKIPSDT,TMP,UTEDT,UTIL,UTSDT,VA,VADM,XREFNODE
"RTN","RORX012A",56,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX012A",57,0)
 S (CNT,ECNT,NSPT,RC)=0,(SKIPEDT,SKIPSDT)=0
"RTN","RORX012A",58,0)
 ;--- Utilization date range
"RTN","RORX012A",59,0)
 D:$$PARAM^RORTSK01("PATIENTS","CAREONLY")
"RTN","RORX012A",60,0)
 . S UTSDT=$$PARAM^RORTSK01("DATE_RANGE_3","START")\1
"RTN","RORX012A",61,0)
 . S UTEDT=$$PARAM^RORTSK01("DATE_RANGE_3","END")\1
"RTN","RORX012A",62,0)
 . ;--- Combined date range
"RTN","RORX012A",63,0)
 . S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,UTSDT)
"RTN","RORX012A",64,0)
 . S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,UTEDT)
"RTN","RORX012A",65,0)
 ;--- Number of patients in the registry
"RTN","RORX012A",66,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX012A",67,0)
 ;
"RTN","RORX012A",68,0)
 ;--- Setup the descriptors for callback API's
"RTN","RORX012A",69,0)
 I RORLAB  D
"RTN","RORX012A",70,0)
 . I RORLTST'="*",$D(@RORLTST)<10  S RORLAB=0  Q
"RTN","RORX012A",71,0)
 . S RORLDST("RORCB")="$$LTSCB^RORX012A"
"RTN","RORX012A",72,0)
 . ;--- Labs date range
"RTN","RORX012A",73,0)
 . S LTSDT=$$PARAM^RORTSK01("DATE_RANGE_2","START")\1
"RTN","RORX012A",74,0)
 . S LTEDT=$$PARAM^RORTSK01("DATE_RANGE_2","END")\1
"RTN","RORX012A",75,0)
 . ;--- Combined date range
"RTN","RORX012A",76,0)
 . S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,LTSDT)
"RTN","RORX012A",77,0)
 . S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,LTEDT)
"RTN","RORX012A",78,0)
 . ;--- Shift the Labs end date
"RTN","RORX012A",79,0)
 . S LTEDT=$$FMADD^XLFDT(LTEDT,1)
"RTN","RORX012A",80,0)
 I RORPHARM  D
"RTN","RORX012A",81,0)
 . I RORXL'="*",$D(@RORXL)<10  S RORPHARM=0  Q
"RTN","RORX012A",82,0)
 . S RORXDST("RORCB")="$$RXSCB^RORX012A"
"RTN","RORX012A",83,0)
 . S RORXDST("GENERIC")=$$PARAM^RORTSK01("DRUGS","AGGR_GENERIC")
"RTN","RORX012A",84,0)
 . ;--- Combined date range
"RTN","RORX012A",85,0)
 . S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,RORXSDT)
"RTN","RORX012A",86,0)
 . S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,RORXEDT)
"RTN","RORX012A",87,0)
 . ;--- Shift the Meds end date
"RTN","RORX012A",88,0)
 . S RXEDT=$$FMADD^XLFDT(RORXEDT\1,1)
"RTN","RORX012A",89,0)
 Q:'(RORLAB!RORPHARM) 0
"RTN","RORX012A",90,0)
 ;
"RTN","RORX012A",91,0)
 ;--- Browse through the registry records
"RTN","RORX012A",92,0)
 S IEN=0
"RTN","RORX012A",93,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX012A",94,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX012A",95,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX012A",96,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX012A",97,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX012A",98,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,SKIPSDT,SKIPEDT)
"RTN","RORX012A",99,0)
 . S SKIP=1,UTIL=0
"RTN","RORX012A",100,0)
 . ;
"RTN","RORX012A",101,0)
 . ;--- Get the patient IEN (DFN)
"RTN","RORX012A",102,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX012A",103,0)
 . ;
"RTN","RORX012A",104,0)
 . D  I RC<0  S ECNT=ECNT+1,RC=0  Q
"RTN","RORX012A",105,0)
 . . ;--- Search for pharmacy data
"RTN","RORX012A",106,0)
 . . I RORPHARM  D  Q:RC'>0
"RTN","RORX012A",107,0)
 . . . M RORXDST("RORXGRP")=RORXGRP("C")
"RTN","RORX012A",108,0)
 . . . S RORXDST=$NA(^TMP("RORX012",$J,"PAT",PATIEN,"RX"))
"RTN","RORX012A",109,0)
 . . . K RORXDST("RORUTIL")
"RTN","RORX012A",110,0)
 . . . S RC=$$RXSEARCH^RORUTL14(PATIEN,RORXL,.RORXDST,"EIOV",RORXSDT,RXEDT)
"RTN","RORX012A",111,0)
 . . . Q:RC<0
"RTN","RORX012A",112,0)
 . . . ;S:$G(RORXDST("RORUTIL")) UTIL=1
"RTN","RORX012A",113,0)
 . . . I RC>0  S:$D(RORXDST("RORXGRP"))>1 RC=0
"RTN","RORX012A",114,0)
 . . . ;--- Invert the result if the "Did Not" logic was selected
"RTN","RORX012A",115,0)
 . . . I RORPHARM<0  S RC='RC  K @RORXDST
"RTN","RORX012A",116,0)
 . . ;--- Search for Lab data
"RTN","RORX012A",117,0)
 . . I RORLAB  D  Q:RC'>0
"RTN","RORX012A",118,0)
 . . . S RORLDST=$NA(^TMP("RORX012",$J,"PAT",PATIEN,"LR"))
"RTN","RORX012A",119,0)
 . . . K RORLDST("RORUTIL")
"RTN","RORX012A",120,0)
 . . . S RC=$$LTSEARCH^RORUTL10(PATIEN,RORLTST,.RORLDST,,LTSDT,LTEDT)
"RTN","RORX012A",121,0)
 . . . Q:RC<0
"RTN","RORX012A",122,0)
 . . . ;S:$G(RORLDST("RORUTIL")) UTIL=1
"RTN","RORX012A",123,0)
 . . . ;--- Invert the result if the "Did Not" logic was selected
"RTN","RORX012A",124,0)
 . . . S:RORLAB<0 RC='RC
"RTN","RORX012A",125,0)
 . . ;---
"RTN","RORX012A",126,0)
 . . S SKIP=0
"RTN","RORX012A",127,0)
 . ;
"RTN","RORX012A",128,0)
 . ;--- Check for any utilization in the corresponding date range
"RTN","RORX012A",129,0)
 . I 'SKIP  D:$$PARAM^RORTSK01("PATIENTS","CAREONLY")
"RTN","RORX012A",130,0)
 . . K TMP  S TMP("ALL")=1
"RTN","RORX012A",131,0)
 . . S UTIL=+$$UTIL^RORXU003(UTSDT,UTEDT,PATIEN,.TMP)
"RTN","RORX012A",132,0)
 . . S:'UTIL SKIP=1
"RTN","RORX012A",133,0)
 . ;
"RTN","RORX012A",134,0)
 . ;--- Skip the patient if not all search criteria have been met
"RTN","RORX012A",135,0)
 . I SKIP  K ^TMP("RORX012",$J,"PAT",PATIEN)  Q
"RTN","RORX012A",136,0)
 . ;
"RTN","RORX012A",137,0)
 . ;--- Get and store the patient's data
"RTN","RORX012A",138,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX012A",139,0)
 . S TMP=$$DATE^RORXU002(VADM(6)\1)
"RTN","RORX012A",140,0)
 . S ^TMP("RORX012",$J,"PAT",PATIEN)=VA("BID")_U_VADM(1)_U_TMP
"RTN","RORX012A",141,0)
 . S NSPT=NSPT+1
"RTN","RORX012A",142,0)
 ;
"RTN","RORX012A",143,0)
 ;---
"RTN","RORX012A",144,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX012A",145,0)
 ;
"RTN","RORX012A",146,0)
 ;***** CALLBACK FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORX012A",147,0)
RXSCB(ROR8DST,ORDER,ORDFLG,DRUG,DATE) ;
"RTN","RORX012A",148,0)
 N GRP,IEN,NAME,TMP
"RTN","RORX012A",149,0)
 S ROR8DST("RORUTIL")=1
"RTN","RORX012A",150,0)
 ;=== Check the drug groups
"RTN","RORX012A",151,0)
 S TMP=$$RXGRPCHK^RORXU007(.ROR8DST,+DRUG,RORXL)
"RTN","RORX012A",152,0)
 Q:TMP TMP
"RTN","RORX012A",153,0)
 ;--- Get the drug data
"RTN","RORX012A",154,0)
 I ROR8DST("GENERIC")  D
"RTN","RORX012A",155,0)
 . S IEN=+ROR8DST("RORXGEN"),NAME=$P(ROR8DST("RORXGEN"),U,2)
"RTN","RORX012A",156,0)
 E  S IEN=+DRUG,NAME=$P(DRUG,U,2)
"RTN","RORX012A",157,0)
 Q:(IEN'>0)!(NAME="") 1
"RTN","RORX012A",158,0)
 ;--- Output the data
"RTN","RORX012A",159,0)
 S @ROR8DST@(NAME,IEN)=""
"RTN","RORX012A",160,0)
 Q 0
"RTN","RORX012A",161,0)
 ;
"RTN","RORX012A",162,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX012A",163,0)
 ;
"RTN","RORX012A",164,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX012A",165,0)
 ; NSPT          Number of selected patients
"RTN","RORX012A",166,0)
 ;
"RTN","RORX012A",167,0)
 ; Return Values:
"RTN","RORX012A",168,0)
 ;       <0  Error code
"RTN","RORX012A",169,0)
 ;        0  Ok
"RTN","RORX012A",170,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX012A",171,0)
 ;
"RTN","RORX012A",172,0)
STORE(REPORT,NSPT) ;
"RTN","RORX012A",173,0)
 N CNT,DATE,DFN,DOD,ECNT,IEN,ITEM,LAST4,LTLST,NAME,NODE,PTCNT,PTLST,PTNAME,RC,RXLST,TMP,VAL
"RTN","RORX012A",174,0)
 S (ECNT,RC)=0,(LTLST,PTLST,RXLST)=-1
"RTN","RORX012A",175,0)
 ;--- Force the "patient data" note in the output
"RTN","RORX012A",176,0)
 D ADDVAL^RORTSK11(RORTSK,"PATIENT",,REPORT)
"RTN","RORX012A",177,0)
 ;--- Create lab test list
"RTN","RORX012A",178,0)
 I RORLAB  D  Q:LTLST<0 LTLST
"RTN","RORX012A",179,0)
 . S LTLST=$$ADDVAL^RORTSK11(RORTSK,"LABTESTS",,REPORT)
"RTN","RORX012A",180,0)
 . D ADDATTR^RORTSK11(RORTSK,LTLST,"TABLE","LABTESTS")
"RTN","RORX012A",181,0)
 ;--- Create pharmacy list
"RTN","RORX012A",182,0)
 I RORPHARM>0  D  Q:RXLST<0 RXLST
"RTN","RORX012A",183,0)
 . S RXLST=$$ADDVAL^RORTSK11(RORTSK,"DRUGS",,REPORT)
"RTN","RORX012A",184,0)
 . D ADDATTR^RORTSK11(RORTSK,RXLST,"TABLE","DRUGS")
"RTN","RORX012A",185,0)
 ;--- Create patient list
"RTN","RORX012A",186,0)
 I (RORLAB<0)!(RORPHARM<0)  D  Q:PTLST<0 PTLST
"RTN","RORX012A",187,0)
 . S PTLST=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX012A",188,0)
 . D ADDATTR^RORTSK11(RORTSK,PTLST,"TABLE","PATIENTS")
"RTN","RORX012A",189,0)
 ;---
"RTN","RORX012A",190,0)
 S (CNT,DFN,PTCNT)=0
"RTN","RORX012A",191,0)
 F  S DFN=$O(^TMP("RORX012",$J,"PAT",DFN))  Q:DFN'>0  D  Q:RC<0
"RTN","RORX012A",192,0)
 . S TMP=$S(NSPT>0:CNT/NSPT,1:"")
"RTN","RORX012A",193,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX012A",194,0)
 . S CNT=CNT+1,NODE=$NA(^TMP("RORX012",$J,"PAT",DFN))
"RTN","RORX012A",195,0)
 . ;--- Patient's data
"RTN","RORX012A",196,0)
 . S TMP=$G(@NODE)
"RTN","RORX012A",197,0)
 . S LAST4=$P(TMP,U),PTNAME=$P(TMP,U,2),DOD=$P(TMP,U,3)
"RTN","RORX012A",198,0)
 . ;--- Patient list
"RTN","RORX012A",199,0)
 . S TMP=$S(LTLST<0:1,1:$D(@NODE@("LR"))<10)
"RTN","RORX012A",200,0)
 . I TMP,$S(RXLST<0:1,1:$D(@NODE@("RX"))<10)  D  Q
"RTN","RORX012A",201,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PTLST,,DFN)
"RTN","RORX012A",202,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,ITEM,1)
"RTN","RORX012A",203,0)
 . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX012A",204,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DOD",DOD,ITEM,1)
"RTN","RORX012A",205,0)
 . . S PTCNT=PTCNT+1
"RTN","RORX012A",206,0)
 . ;--- List of Lab tests
"RTN","RORX012A",207,0)
 . S DATE=""
"RTN","RORX012A",208,0)
 . F  S DATE=$O(@NODE@("LR",DATE))  Q:DATE=""  D
"RTN","RORX012A",209,0)
 . . S NAME=""
"RTN","RORX012A",210,0)
 . . F  S NAME=$O(@NODE@("LR",DATE,NAME))  Q:NAME=""  D
"RTN","RORX012A",211,0)
 . . . S IEN=""
"RTN","RORX012A",212,0)
 . . . F  S IEN=$O(@NODE@("LR",DATE,NAME,IEN))  Q:IEN=""  D
"RTN","RORX012A",213,0)
 . . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"LT",,LTLST,,DFN)
"RTN","RORX012A",214,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,ITEM,1)
"RTN","RORX012A",215,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX012A",216,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"DOD",DOD,ITEM,1)
"RTN","RORX012A",217,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"DATE",DATE\1,ITEM,1)
"RTN","RORX012A",218,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"LTNAME",NAME,ITEM,1)
"RTN","RORX012A",219,0)
 . . . . S VAL=$G(@NODE@("LR",DATE,NAME,IEN))
"RTN","RORX012A",220,0)
 . . . . S TMP=$S($$NUMERIC^RORUTL05(VAL):3,1:1)
"RTN","RORX012A",221,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"RESULT",VAL,ITEM,TMP)
"RTN","RORX012A",222,0)
 . ;--- List of drugs
"RTN","RORX012A",223,0)
 . S NAME=""
"RTN","RORX012A",224,0)
 . F  S NAME=$O(@NODE@("RX",NAME))  Q:NAME=""  D
"RTN","RORX012A",225,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"DRUG",,RXLST,,DFN)
"RTN","RORX012A",226,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,ITEM,1)
"RTN","RORX012A",227,0)
 . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX012A",228,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DOD",DOD,ITEM,1)
"RTN","RORX012A",229,0)
 . . D ADDVAL^RORTSK11(RORTSK,"RXNAME",NAME,ITEM,1)
"RTN","RORX012A",230,0)
 ;--- Inactivate the patient list tag if the list is empty
"RTN","RORX012A",231,0)
 D:PTCNT'>0 UPDVAL^RORTSK11(RORTSK,PTLST,,,1)
"RTN","RORX012A",232,0)
 ;---
"RTN","RORX012A",233,0)
 Q ECNT
"RTN","RORX013")
0^185^B7562823
"RTN","RORX013",1,0)
RORX013 ;HOIFO/SG - DIAGNOSIS CODES REPORT ; 10/14/05 2:00pm
"RTN","RORX013",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX013",3,0)
 ;
"RTN","RORX013",4,0)
 Q
"RTN","RORX013",5,0)
 ;
"RTN","RORX013",6,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX013",7,0)
 ;
"RTN","RORX013",8,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX013",9,0)
 ;
"RTN","RORX013",10,0)
 ; Return Values:
"RTN","RORX013",11,0)
 ;       <0  Error code
"RTN","RORX013",12,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX013",13,0)
 ;
"RTN","RORX013",14,0)
HEADER(PARTAG) ;
"RTN","RORX013",15,0)
 ;;ICD9LST(#,CODE,DIAG,NP,NC)
"RTN","RORX013",16,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,PTICDL(CODE,DIAG,DATE,SOURCE))
"RTN","RORX013",17,0)
 ;
"RTN","RORX013",18,0)
 N HEADER,RC
"RTN","RORX013",19,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX013",20,0)
 Q:HEADER<0 HEADER
"RTN","RORX013",21,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX013",HEADER)
"RTN","RORX013",22,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX013",23,0)
 ;
"RTN","RORX013",24,0)
 ;
"RTN","RORX013",25,0)
 ;***** COMPILES THE "DIAGNOSIS CODE" REPORT
"RTN","RORX013",26,0)
 ; REPORT CODE: 013
"RTN","RORX013",27,0)
 ;
"RTN","RORX013",28,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX013",29,0)
 ;
"RTN","RORX013",30,0)
 ; The ^TMP("VSIT",$J) global node is used by this function.
"RTN","RORX013",31,0)
 ;
"RTN","RORX013",32,0)
 ; @RORTMP@(
"RTN","RORX013",33,0)
 ;
"RTN","RORX013",34,0)
 ;   "PAT",              Number of patients
"RTN","RORX013",35,0)
 ;     DFN,              Descriptor
"RTN","RORX013",36,0)
 ;                         ^01: Las 4 digits of SSN
"RTN","RORX013",37,0)
 ;                         ^02: Name
"RTN","RORX013",38,0)
 ;                         ^03: Date of Death
"RTN","RORX013",39,0)
 ;       ICD9IEN,        Earliest Code Descriptor
"RTN","RORX013",40,0)
 ;                         ^01: Date
"RTN","RORX013",41,0)
 ;                         ^02: Source ("I", "O", or "PB")
"RTN","RORX013",42,0)
 ;         "C")          Quantity
"RTN","RORX013",43,0)
 ;         "I")          Inpatient quantity
"RTN","RORX013",44,0)
 ;         "O")          Outpatient quantity
"RTN","RORX013",45,0)
 ;         "PB")         Problem List quantity
"RTN","RORX013",46,0)
 ;
"RTN","RORX013",47,0)
 ;   "ICD",              Totals
"RTN","RORX013",48,0)
 ;                         ^01: Number of ICD-9 codes
"RTN","RORX013",49,0)
 ;                         ^02: Number of different codes
"RTN","RORX013",50,0)
 ;     ICD9IEN,          ICD-9 Descriptor
"RTN","RORX013",51,0)
 ;                         ^01: Code
"RTN","RORX013",52,0)
 ;                         ^02: Diagnosis (current version)
"RTN","RORX013",53,0)
 ;       "C")            Quantity
"RTN","RORX013",54,0)
 ;       "P")            Number of unique patients
"RTN","RORX013",55,0)
 ;
"RTN","RORX013",56,0)
 ; Return Values:
"RTN","RORX013",57,0)
 ;       <0  Error code
"RTN","RORX013",58,0)
 ;        0  Ok
"RTN","RORX013",59,0)
 ;
"RTN","RORX013",60,0)
ICD9LST(RORTSK) ;
"RTN","RORX013",61,0)
 N ROREDT        ; End date
"RTN","RORX013",62,0)
 N RORREG        ; Registry IEN
"RTN","RORX013",63,0)
 N RORSDT        ; Start date
"RTN","RORX013",64,0)
 N RORTMP        ; Closed root of the temporary buffer
"RTN","RORX013",65,0)
 ;
"RTN","RORX013",66,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX013",67,0)
 S (ECNT,RC)=0
"RTN","RORX013",68,0)
 ;--- Root node of the report
"RTN","RORX013",69,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX013",70,0)
 Q:REPORT<0 REPORT
"RTN","RORX013",71,0)
 ;
"RTN","RORX013",72,0)
 ;--- Get and prepare the report parameters
"RTN","RORX013",73,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX013",74,0)
 S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0 RC
"RTN","RORX013",75,0)
 ;
"RTN","RORX013",76,0)
 ;--- Report header
"RTN","RORX013",77,0)
 S RC=$$HEADER(REPORT)  Q:RC<0 RC
"RTN","RORX013",78,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORX013",79,0)
 D
"RTN","RORX013",80,0)
 . ;--- Query the registry
"RTN","RORX013",81,0)
 . D TPPSETUP^RORTSK01(70)
"RTN","RORX013",82,0)
 . S RC=$$QUERY^RORX013A(SFLAGS)
"RTN","RORX013",83,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013",84,0)
 . ;--- Sort the data
"RTN","RORX013",85,0)
 . D TPPSETUP^RORTSK01(10)
"RTN","RORX013",86,0)
 . S RC=$$SORT^RORX013A()
"RTN","RORX013",87,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013",88,0)
 . ;--- Store the results
"RTN","RORX013",89,0)
 . D TPPSETUP^RORTSK01(20)
"RTN","RORX013",90,0)
 . S RC=$$STORE^RORX013C(REPORT)
"RTN","RORX013",91,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013",92,0)
 ;
"RTN","RORX013",93,0)
 ;--- Cleanup
"RTN","RORX013",94,0)
 D FREE^RORTMP(RORTMP)  K ^TMP("VSIT",$J)
"RTN","RORX013",95,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX013",96,0)
 ;
"RTN","RORX013",97,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX013",98,0)
 ;
"RTN","RORX013",99,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX013",100,0)
 ;
"RTN","RORX013",101,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX013",102,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX013",103,0)
 ;
"RTN","RORX013",104,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX013",105,0)
 ;               returned via this parameter
"RTN","RORX013",106,0)
 ;
"RTN","RORX013",107,0)
 ; Return Values:
"RTN","RORX013",108,0)
 ;       <0  Error code
"RTN","RORX013",109,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX013",110,0)
 ;
"RTN","RORX013",111,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX013",112,0)
 N PARAMS,TMP
"RTN","RORX013",113,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX013",114,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX013",115,0)
 ;--- Process the list of ICD9 codes
"RTN","RORX013",116,0)
 S TMP=$$ICD9LST^RORXU006(.RORTSK,PARAMS)  Q:TMP<0 TMP
"RTN","RORX013",117,0)
 ;---
"RTN","RORX013",118,0)
 Q PARAMS
"RTN","RORX013A")
0^186^B46112050
"RTN","RORX013A",1,0)
RORX013A ;HCIOFO/SG - DIAGNOSIS CODES (QUERY & SORT) ; 1/9/06 6:19am
"RTN","RORX013A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX013A",3,0)
 ;
"RTN","RORX013A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX013A",5,0)
 ;
"RTN","RORX013A",6,0)
 ; #928          ACTIVE^GMPLUTL
"RTN","RORX013A",7,0)
 ; #1554         POV^PXAPIIB (controlled)
"RTN","RORX013A",8,0)
 ; #1900-F       SELECTED^VSIT (controlled)
"RTN","RORX013A",9,0)
 ; #2977         GETFLDS^GMPLEDT3
"RTN","RORX013A",10,0)
 ; #3157         RPC^DGPTFAPI (supported)
"RTN","RORX013A",11,0)
 ; #3545         Access to the "AAD" cross-reference and the field 80
"RTN","RORX013A",12,0)
 ; #3990         $$CODEN^ICDCODE and $$ICDDX^ICDCODE (supported)
"RTN","RORX013A",13,0)
 ; #10082        Read access to the file #80 (supported)
"RTN","RORX013A",14,0)
 ;
"RTN","RORX013A",15,0)
 Q
"RTN","RORX013A",16,0)
 ;
"RTN","RORX013A",17,0)
 ;**** STORES THE ICD-9 CODE
"RTN","RORX013A",18,0)
 ;
"RTN","RORX013A",19,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",20,0)
 ; SOURCE        ICD-9 source code ("I", "O", "PB")
"RTN","RORX013A",21,0)
 ; [ICD9IEN]     IEN of the ICD-9 descriptor in file #80
"RTN","RORX013A",22,0)
 ; DATE          Date when the code was entered
"RTN","RORX013A",23,0)
 ; [ICD9]        ICD-9 code
"RTN","RORX013A",24,0)
 ;
"RTN","RORX013A",25,0)
 ; Either the ICD9IEN or the ICD9 parameter must be provided.
"RTN","RORX013A",26,0)
 ;
"RTN","RORX013A",27,0)
ICD9SET(PATIEN,SOURCE,ICD9IEN,DATE,ICD9) ;
"RTN","RORX013A",28,0)
 Q:DATE'>0
"RTN","RORX013A",29,0)
 N TMP
"RTN","RORX013A",30,0)
 S ICD9IEN=+$G(ICD9IEN)
"RTN","RORX013A",31,0)
 I ICD9IEN'>0  Q:$G(ICD9)=""  D  Q:ICD9IEN'>0
"RTN","RORX013A",32,0)
 . S ICD9IEN=+$$CODEN^ICDCODE(ICD9,80)
"RTN","RORX013A",33,0)
 I '$$PARAM^RORTSK01("ICD9LST","ALL")  D  Q:'TMP
"RTN","RORX013A",34,0)
 . S TMP=$D(RORTSK("PARAMS","ICD9LST","C",ICD9IEN))
"RTN","RORX013A",35,0)
 ;---
"RTN","RORX013A",36,0)
 S TMP=+$G(@RORTMP@("PAT",PATIEN,ICD9IEN))
"RTN","RORX013A",37,0)
 S:'TMP!(DATE<TMP) @RORTMP@("PAT",PATIEN,ICD9IEN)=DATE_U_SOURCE
"RTN","RORX013A",38,0)
 S ^(SOURCE)=$G(@RORTMP@("PAT",PATIEN,ICD9IEN,SOURCE))+1
"RTN","RORX013A",39,0)
 Q
"RTN","RORX013A",40,0)
 ;
"RTN","RORX013A",41,0)
 ;***** SEARCHES FOR INPATIENT DIAGNOSES
"RTN","RORX013A",42,0)
 ;
"RTN","RORX013A",43,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",44,0)
 ;
"RTN","RORX013A",45,0)
 ; Return Values:
"RTN","RORX013A",46,0)
 ;       <0  Error code
"RTN","RORX013A",47,0)
 ;        0  Ok
"RTN","RORX013A",48,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",49,0)
 ;
"RTN","RORX013A",50,0)
INPAT(PATIEN) ;
"RTN","RORX013A",51,0)
 N ADMDT,DISDT,I,IEN,NODE,RC,RORBUF,RORMSG,TMP
"RTN","RORX013A",52,0)
 S NODE=$NA(^DGPT("AAD",+PATIEN))
"RTN","RORX013A",53,0)
 S RC=0
"RTN","RORX013A",54,0)
 ;--- Browse through the admissions
"RTN","RORX013A",55,0)
 S ADMDT=ROREDT1
"RTN","RORX013A",56,0)
 F  S ADMDT=$O(@NODE@(ADMDT),-1)  Q:ADMDT'>0  D  Q:RC
"RTN","RORX013A",57,0)
 . S IEN=""
"RTN","RORX013A",58,0)
 . F  S IEN=$O(@NODE@(ADMDT,IEN),-1)  Q:IEN'>0  D  Q:RC
"RTN","RORX013A",59,0)
 . . Q:+$G(^DGPT(IEN,0))'=PATIEN
"RTN","RORX013A",60,0)
 . . Q:$$PTF^RORXU001(IEN,"FP",,.DISDT)
"RTN","RORX013A",61,0)
 . . ;--- Skip invalid and/or incomplete admissions
"RTN","RORX013A",62,0)
 . . I DISDT'>0  D  Q:TMP!(DISDT'>0)
"RTN","RORX013A",63,0)
 . . . S TMP=$$CHKADM^RORXU001(PATIEN,ADMDT,.DISDT)
"RTN","RORX013A",64,0)
 . . ;--- Check if any appropriate admissions are left
"RTN","RORX013A",65,0)
 . . I DISDT<RORSDT  S RC=1  Q
"RTN","RORX013A",66,0)
 . . Q:DISDT'<ROREDT1
"RTN","RORX013A",67,0)
 . . ;--- Load and process the admission data
"RTN","RORX013A",68,0)
 . . K RORBUF  D RPC^DGPTFAPI(.RORBUF,IEN)
"RTN","RORX013A",69,0)
 . . I $G(RORBUF(0))<0  D  Q
"RTN","RORX013A",70,0)
 . . . D ERROR^RORERR(-57,,,,RORBUF(0),"RPC^DGPTFAPI")
"RTN","RORX013A",71,0)
 . . S TMP=$P($G(RORBUF(1)),U,3)
"RTN","RORX013A",72,0)
 . . D:TMP'="" ICD9SET(PATIEN,"I",,DISDT,TMP)  ; ICD1
"RTN","RORX013A",73,0)
 . . D:$G(RORBUF(2))'=""                       ; ICD2 - ICD10
"RTN","RORX013A",74,0)
 . . . F I=1:1:9  S TMP=$P(RORBUF(2),U,I)  D:TMP'=""
"RTN","RORX013A",75,0)
 . . . . D ICD9SET(PATIEN,"I",,DISDT,TMP)
"RTN","RORX013A",76,0)
 . . S TMP=+$$GET1^DIQ(45,IEN,80,"I",,"RORMSG")
"RTN","RORX013A",77,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,45,IEN)
"RTN","RORX013A",78,0)
 . . D:TMP>0 ICD9SET(PATIEN,"I",TMP,DISDT)     ; PRINCIPAL DIAGNOSIS
"RTN","RORX013A",79,0)
 ;---
"RTN","RORX013A",80,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX013A",81,0)
 ;
"RTN","RORX013A",82,0)
 ;***** SEARCHES FOR OUTPATIENT DIAGNOSES
"RTN","RORX013A",83,0)
 ;
"RTN","RORX013A",84,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",85,0)
 ;
"RTN","RORX013A",86,0)
 ; Return Values:
"RTN","RORX013A",87,0)
 ;       <0  Error code
"RTN","RORX013A",88,0)
 ;        0  Ok
"RTN","RORX013A",89,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",90,0)
 ;
"RTN","RORX013A",91,0)
OUTPAT(PATIEN) ;
"RTN","RORX013A",92,0)
 N DATE,ICDIEN,RC,RORMSG,RORVPLST,TMP,VPIEN,VSIEN,VSIT
"RTN","RORX013A",93,0)
 D SELECTED^VSIT(PATIEN,RORSDT,ROREDT)
"RTN","RORX013A",94,0)
 ;--- Browse through the visits
"RTN","RORX013A",95,0)
 S (VSIEN,RC)=0
"RTN","RORX013A",96,0)
 F  S VSIEN=$O(^TMP("VSIT",$J,VSIEN))  Q:VSIEN=""  D  Q:RC<0
"RTN","RORX013A",97,0)
 . S TMP=+$O(^TMP("VSIT",$J,VSIEN,""))  Q:TMP'>0
"RTN","RORX013A",98,0)
 . S DATE=$P($G(^TMP("VSIT",$J,VSIEN,TMP)),U)  Q:DATE'>0
"RTN","RORX013A",99,0)
 . ;--- Get a list of V POV records
"RTN","RORX013A",100,0)
 . D POV^PXAPIIB(VSIEN,.RORVPLST)
"RTN","RORX013A",101,0)
 . ;--- Process the records
"RTN","RORX013A",102,0)
 . S (VPIEN,RC)=0
"RTN","RORX013A",103,0)
 . F  S VPIEN=$O(RORVPLST(VPIEN))  Q:VPIEN'>0  D  Q:RC
"RTN","RORX013A",104,0)
 . . S ICDIEN=+$P(RORVPLST(VPIEN),U)
"RTN","RORX013A",105,0)
 . . D:ICDIEN>0 ICD9SET(PATIEN,"O",ICDIEN,DATE)
"RTN","RORX013A",106,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX013A",107,0)
 ;
"RTN","RORX013A",108,0)
 ;***** SEARCHES FOR PROBLEMS
"RTN","RORX013A",109,0)
 ;
"RTN","RORX013A",110,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",111,0)
 ;
"RTN","RORX013A",112,0)
 ; Return Values:
"RTN","RORX013A",113,0)
 ;       <0  Error code
"RTN","RORX013A",114,0)
 ;        0  Ok
"RTN","RORX013A",115,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",116,0)
 ;
"RTN","RORX013A",117,0)
PROBLEM(PATIEN) ;
"RTN","RORX013A",118,0)
 N DATE,GMPFLD,GMPORIG,GMPROV,GMVAMC,ICDIEN,IEN,RC,RORPLST,TMP
"RTN","RORX013A",119,0)
 ;--- Load a list of active problems
"RTN","RORX013A",120,0)
 D ACTIVE^GMPLUTL(PATIEN,.RORPLST)
"RTN","RORX013A",121,0)
 ;--- Browse through the problems
"RTN","RORX013A",122,0)
 S (GMPVAMC,GMPROV)=0
"RTN","RORX013A",123,0)
 S (IS,RC)=0
"RTN","RORX013A",124,0)
 F  S IS=$O(RORPLST(IS))  Q:IS=""  D  Q:RC
"RTN","RORX013A",125,0)
 . S IEN=+$G(RORPLST(IS,0))  Q:IEN'>0
"RTN","RORX013A",126,0)
 . K GMPFLD,GMPORIG  D GETFLDS^GMPLEDT3(IEN)
"RTN","RORX013A",127,0)
 . S ICDIEN=+$G(GMPFLD(.01))  Q:ICDIEN'>0
"RTN","RORX013A",128,0)
 . S DATE=$P($G(GMPFLD(.08)),U)
"RTN","RORX013A",129,0)
 . D:(DATE'<RORSDT)&(DATE<ROREDT1) ICD9SET(PATIEN,"PB",ICDIEN,DATE)
"RTN","RORX013A",130,0)
 Q 0
"RTN","RORX013A",131,0)
 ;
"RTN","RORX013A",132,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX013A",133,0)
 ;
"RTN","RORX013A",134,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX013A",135,0)
 ;
"RTN","RORX013A",136,0)
 ; Return Values:
"RTN","RORX013A",137,0)
 ;       <0  Error code
"RTN","RORX013A",138,0)
 ;        0  Ok
"RTN","RORX013A",139,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",140,0)
 ;
"RTN","RORX013A",141,0)
QUERY(FLAGS) ;
"RTN","RORX013A",142,0)
 N RORDOD        ; Date of death
"RTN","RORX013A",143,0)
 N ROREDT1       ; Day after the end date
"RTN","RORX013A",144,0)
 N RORLAST4      ; Last 4 digits of the current patient's SSN
"RTN","RORX013A",145,0)
 N RORPNAME      ; Name of the current patient
"RTN","RORX013A",146,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX013A",147,0)
 ;
"RTN","RORX013A",148,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,TMP,VA,VADM,XREFNODE
"RTN","RORX013A",149,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX013A",150,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX013A",151,0)
 S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1)
"RTN","RORX013A",152,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX013A",153,0)
 ;
"RTN","RORX013A",154,0)
 ;--- Browse through the registry records
"RTN","RORX013A",155,0)
 S IEN=0
"RTN","RORX013A",156,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX013A",157,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX013A",158,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX013A",159,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX013A",160,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX013A",161,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX013A",162,0)
 . ;
"RTN","RORX013A",163,0)
 . ;--- Get the patient IEN (DFN)
"RTN","RORX013A",164,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX013A",165,0)
 . ;
"RTN","RORX013A",166,0)
 . ;--- Inpatient codes
"RTN","RORX013A",167,0)
 . S RC=$$INPAT(PATIEN)
"RTN","RORX013A",168,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013A",169,0)
 . ;
"RTN","RORX013A",170,0)
 . ;--- Outpatient codes
"RTN","RORX013A",171,0)
 . S RC=$$OUTPAT(PATIEN)
"RTN","RORX013A",172,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013A",173,0)
 . ;
"RTN","RORX013A",174,0)
 . ;--- Problem list
"RTN","RORX013A",175,0)
 . S RC=$$PROBLEM(PATIEN)
"RTN","RORX013A",176,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013A",177,0)
 . ;
"RTN","RORX013A",178,0)
 . ;--- Skip the patient if no data has been found
"RTN","RORX013A",179,0)
 . Q:$D(@RORTMP@("PAT",PATIEN))<10
"RTN","RORX013A",180,0)
 . ;--- Get the patient's data
"RTN","RORX013A",181,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX013A",182,0)
 . S RORPNAME=VADM(1),RORDOD=$P(VADM(6),U),RORLAST4=VA("BID")
"RTN","RORX013A",183,0)
 . ;
"RTN","RORX013A",184,0)
 . ;--- Calculate the patient's totals
"RTN","RORX013A",185,0)
 . S RC=$$TOTALS(PATIEN)
"RTN","RORX013A",186,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013A",187,0)
 ;---
"RTN","RORX013A",188,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX013A",189,0)
 ;
"RTN","RORX013A",190,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX013A",191,0)
 ;
"RTN","RORX013A",192,0)
 ; Return Values:
"RTN","RORX013A",193,0)
 ;       <0  Error code
"RTN","RORX013A",194,0)
 ;        0  Ok
"RTN","RORX013A",195,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",196,0)
 ;
"RTN","RORX013A",197,0)
SORT() ;
"RTN","RORX013A",198,0)
 N ICDIEN,TMP,TNC,TNDC
"RTN","RORX013A",199,0)
 ;---
"RTN","RORX013A",200,0)
 S ICDIEN=0,(TNC,TNDC)=0
"RTN","RORX013A",201,0)
 F  S ICDIEN=$O(@RORTMP@("ICD",ICDIEN))  Q:ICDIEN'>0  D
"RTN","RORX013A",202,0)
 . S TNC=TNC+$G(@RORTMP@("ICD",ICDIEN,"C"))
"RTN","RORX013A",203,0)
 . S TNDC=TNDC+1
"RTN","RORX013A",204,0)
 S @RORTMP@("ICD")=TNC_U_TNDC
"RTN","RORX013A",205,0)
 ;---
"RTN","RORX013A",206,0)
 Q 0
"RTN","RORX013A",207,0)
 ;
"RTN","RORX013A",208,0)
 ;***** CALCULATES INTERMEDIATE TOTALS
"RTN","RORX013A",209,0)
 ;
"RTN","RORX013A",210,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",211,0)
 ;
"RTN","RORX013A",212,0)
 ; Return Values:
"RTN","RORX013A",213,0)
 ;       <0  Error code
"RTN","RORX013A",214,0)
 ;        0  Ok
"RTN","RORX013A",215,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",216,0)
 ;
"RTN","RORX013A",217,0)
TOTALS(PATIEN) ;
"RTN","RORX013A",218,0)
 N CNT,ICD9,ICDIEN,PNODE,RC,TMP
"RTN","RORX013A",219,0)
 S PNODE=$NA(@RORTMP@("PAT",PATIEN))
"RTN","RORX013A",220,0)
 S @PNODE=RORLAST4_U_RORPNAME_U_RORDOD
"RTN","RORX013A",221,0)
 S ^("PAT")=$G(@RORTMP@("PAT"))+1
"RTN","RORX013A",222,0)
 ;
"RTN","RORX013A",223,0)
 S ICDIEN=0
"RTN","RORX013A",224,0)
 F  S ICDIEN=$O(@PNODE@(ICDIEN))  Q:ICDIEN'>0  D
"RTN","RORX013A",225,0)
 . S ICD9=$P($G(@RORTMP@("ICD",ICDIEN)),U)
"RTN","RORX013A",226,0)
 . I ICD9=""  D
"RTN","RORX013A",227,0)
 . . S TMP=$$ICDDX^ICDCODE(ICDIEN)
"RTN","RORX013A",228,0)
 . . I TMP'<0  S ICD9=$P(TMP,U,2),TMP=$P(TMP,U,4)
"RTN","RORX013A",229,0)
 . . E  S TMP=""
"RTN","RORX013A",230,0)
 . . S:ICD9="" ICD9="UNKN"
"RTN","RORX013A",231,0)
 . . S:TMP="" TMP="Unknown ("_ICDIEN_")"
"RTN","RORX013A",232,0)
 . . S @RORTMP@("ICD",ICDIEN)=ICD9_U_TMP
"RTN","RORX013A",233,0)
 . ;---
"RTN","RORX013A",234,0)
 . S CNT=0
"RTN","RORX013A",235,0)
 . F TMP="I","O","PB"  S CNT=CNT+$G(@PNODE@(ICDIEN,TMP))
"RTN","RORX013A",236,0)
 . S @PNODE@(ICDIEN,"C")=CNT
"RTN","RORX013A",237,0)
 . S ^("C")=$G(@RORTMP@("ICD",ICDIEN,"C"))+CNT
"RTN","RORX013A",238,0)
 . S ^("P")=$G(@RORTMP@("ICD",ICDIEN,"P"))+1
"RTN","RORX013A",239,0)
 Q 0
"RTN","RORX013C")
0^187^B11993633
"RTN","RORX013C",1,0)
RORX013C ;HCIOFO/SG - DIAGNOSIS CODES (STORE) ; 10/27/05 11:11am
"RTN","RORX013C",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX013C",3,0)
 ;
"RTN","RORX013C",4,0)
 ; This routine uses the following IAs:
"RTN","RORX013C",5,0)
 ;
"RTN","RORX013C",6,0)
 ; #3990         $$ICDDX^ICDCODE (supported)
"RTN","RORX013C",7,0)
 ;
"RTN","RORX013C",8,0)
 Q
"RTN","RORX013C",9,0)
 ;
"RTN","RORX013C",10,0)
 ;***** STORES THE ICD-9 CODE TABLE
"RTN","RORX013C",11,0)
 ;
"RTN","RORX013C",12,0)
 ; PTAG          IEN of the parent element
"RTN","RORX013C",13,0)
 ;
"RTN","RORX013C",14,0)
 ; NODE          Closed root of the node of the temporary global
"RTN","RORX013C",15,0)
 ;
"RTN","RORX013C",16,0)
 ; Return Values:
"RTN","RORX013C",17,0)
 ;       <0  Error code
"RTN","RORX013C",18,0)
 ;        0  Ok
"RTN","RORX013C",19,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013C",20,0)
 ;
"RTN","RORX013C",21,0)
CODES(PTAG,NODE) ;
"RTN","RORX013C",22,0)
 N ICDIEN,ITEM,TABLE,TMP
"RTN","RORX013C",23,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"ICD9LST",,PTAG)
"RTN","RORX013C",24,0)
 Q:TABLE<0 TABLE
"RTN","RORX013C",25,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","ICD9LST")
"RTN","RORX013C",26,0)
 S ICDIEN=0
"RTN","RORX013C",27,0)
 F  S ICDIEN=$O(@NODE@("ICD",ICDIEN))  Q:ICDIEN'>0  D
"RTN","RORX013C",28,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"ICD9",,TABLE)
"RTN","RORX013C",29,0)
 . S TMP=@NODE@("ICD",ICDIEN)
"RTN","RORX013C",30,0)
 . D ADDVAL^RORTSK11(RORTSK,"CODE",$P(TMP,U,1),ITEM,2)
"RTN","RORX013C",31,0)
 . D ADDVAL^RORTSK11(RORTSK,"DIAG",$P(TMP,U,2),ITEM,2)
"RTN","RORX013C",32,0)
 . S TMP=$G(@NODE@("ICD",ICDIEN,"P"))
"RTN","RORX013C",33,0)
 . D ADDVAL^RORTSK11(RORTSK,"NP",TMP,ITEM,3)
"RTN","RORX013C",34,0)
 . S TMP=$G(@NODE@("ICD",ICDIEN,"C"))
"RTN","RORX013C",35,0)
 . D ADDVAL^RORTSK11(RORTSK,"NC",TMP,ITEM,3)
"RTN","RORX013C",36,0)
 Q 0
"RTN","RORX013C",37,0)
 ;
"RTN","RORX013C",38,0)
 ;***** STORES THE PATIENT TABLE
"RTN","RORX013C",39,0)
 ;
"RTN","RORX013C",40,0)
 ; PTAG          IEN of the parent element
"RTN","RORX013C",41,0)
 ;
"RTN","RORX013C",42,0)
 ; NODE          Closed root of the node of the temporary global
"RTN","RORX013C",43,0)
 ;
"RTN","RORX013C",44,0)
 ; Return Values:
"RTN","RORX013C",45,0)
 ;       <0  Error code
"RTN","RORX013C",46,0)
 ;        0  Ok
"RTN","RORX013C",47,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013C",48,0)
 ;
"RTN","RORX013C",49,0)
PATIENTS(PTAG,NODE) ;
"RTN","RORX013C",50,0)
 N DATE,ICD9,ICDIEN,ITEM,PATIEN,PTICDL,SOURCE,TABLE,TMP
"RTN","RORX013C",51,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,PTAG)
"RTN","RORX013C",52,0)
 Q:TABLE<0 TABLE
"RTN","RORX013C",53,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PATIENTS")
"RTN","RORX013C",54,0)
 S PATIEN=0
"RTN","RORX013C",55,0)
 F  S PATIEN=$O(@NODE@("PAT",PATIEN))  Q:PATIEN'>0  D
"RTN","RORX013C",56,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX013C",57,0)
 . S TMP=@NODE@("PAT",PATIEN)
"RTN","RORX013C",58,0)
 . D ADDVAL^RORTSK11(RORTSK,"NAME",$P(TMP,U,2),ITEM,2)
"RTN","RORX013C",59,0)
 . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(TMP,U,1),ITEM,2)
"RTN","RORX013C",60,0)
 . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(TMP,U,3),ITEM,1)
"RTN","RORX013C",61,0)
 . S PTICDL=$$ADDVAL^RORTSK11(RORTSK,"PTICDL",,ITEM)
"RTN","RORX013C",62,0)
 . S ICDIEN=0
"RTN","RORX013C",63,0)
 . F  S ICDIEN=$O(@NODE@("PAT",PATIEN,ICDIEN))  Q:ICDIEN'>0  D
"RTN","RORX013C",64,0)
 . . S ICD9=$$ADDVAL^RORTSK11(RORTSK,"ICD9",,PTICDL)
"RTN","RORX013C",65,0)
 . . S TMP=$G(@NODE@("PAT",PATIEN,ICDIEN))
"RTN","RORX013C",66,0)
 . . S DATE=$P(TMP,U),SOURCE=$P(TMP,U,2)
"RTN","RORX013C",67,0)
 . . S TMP=$$ICDDX^ICDCODE(ICDIEN,DATE)
"RTN","RORX013C",68,0)
 . . S:TMP<0 TMP=""
"RTN","RORX013C",69,0)
 . . D ADDVAL^RORTSK11(RORTSK,"CODE",$P(TMP,U,2),ICD9,2)
"RTN","RORX013C",70,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DIAG",$P(TMP,U,4),ICD9,2)
"RTN","RORX013C",71,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DATE",DATE\1,ICD9,1)
"RTN","RORX013C",72,0)
 . . D ADDVAL^RORTSK11(RORTSK,"SOURCE",SOURCE,ICD9,2)
"RTN","RORX013C",73,0)
 Q 0
"RTN","RORX013C",74,0)
 ;
"RTN","RORX013C",75,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX013C",76,0)
 ;
"RTN","RORX013C",77,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX013C",78,0)
 ;
"RTN","RORX013C",79,0)
 ; Return Values:
"RTN","RORX013C",80,0)
 ;       <0  Error code
"RTN","RORX013C",81,0)
 ;        0  Ok
"RTN","RORX013C",82,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013C",83,0)
 ;
"RTN","RORX013C",84,0)
STORE(REPORT) ;
"RTN","RORX013C",85,0)
 N ECNT,ICDIEN,PATIEN,RC,SECTION,TMP
"RTN","RORX013C",86,0)
 S (ECNT,RC)=0
"RTN","RORX013C",87,0)
 ;--- Diagnosis codes
"RTN","RORX013C",88,0)
 S RC=$$CODES(REPORT,RORTMP)
"RTN","RORX013C",89,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+RC
"RTN","RORX013C",90,0)
 S RC=$$LOOP^RORTSK01(.4)  Q:RC<0 RC
"RTN","RORX013C",91,0)
 ;--- Patients
"RTN","RORX013C",92,0)
 S TMP=$$PARAM^RORTSK01("OPTIONS","COMPLETE")
"RTN","RORX013C",93,0)
 I TMP  D  I RC  Q:RC<0 RC  S ECNT=ECNT+RC
"RTN","RORX013C",94,0)
 . S RC=$$PATIENTS(REPORT,RORTMP)
"RTN","RORX013C",95,0)
 S RC=$$LOOP^RORTSK01(.99)  Q:RC<0 RC
"RTN","RORX013C",96,0)
 ;--- Totals
"RTN","RORX013C",97,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"SUMMARY",,REPORT)
"RTN","RORX013C",98,0)
 Q:SECTION<0 SECTION
"RTN","RORX013C",99,0)
 S TMP=$G(@RORTMP@("ICD"))
"RTN","RORX013C",100,0)
 D ADDVAL^RORTSK11(RORTSK,"NC",+$P(TMP,U,1),SECTION)
"RTN","RORX013C",101,0)
 D ADDVAL^RORTSK11(RORTSK,"NDC",+$P(TMP,U,2),SECTION)
"RTN","RORX013C",102,0)
 S TMP=$G(@RORTMP@("PAT"))
"RTN","RORX013C",103,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+TMP,SECTION)
"RTN","RORX013C",104,0)
 ;---
"RTN","RORX013C",105,0)
 Q ECNT
"RTN","RORX014")
0^188^B9743721
"RTN","RORX014",1,0)
RORX014 ;HOIFO/SG - REGISTRY MEDICATIONS REPORT ; 11/25/05 5:57pm
"RTN","RORX014",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX014",3,0)
 ;
"RTN","RORX014",4,0)
 Q
"RTN","RORX014",5,0)
 ;
"RTN","RORX014",6,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX014",7,0)
 ;
"RTN","RORX014",8,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX014",9,0)
 ;
"RTN","RORX014",10,0)
 ; Return Values:
"RTN","RORX014",11,0)
 ;       <0  Error code
"RTN","RORX014",12,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX014",13,0)
 ;
"RTN","RORX014",14,0)
HEADER(PARTAG) ;
"RTN","RORX014",15,0)
 ;;RXCOMBLST(NP,PATIENTS(NAME,LAST4,DOD))^I $$PARAM^RORTSK01("OPTIONS","COMPLETE")
"RTN","RORX014",16,0)
 ;;RXCOMBLST(NP,RXCOMB)^I $$PARAM^RORTSK01("OPTIONS","SUMMARY")
"RTN","RORX014",17,0)
 ;
"RTN","RORX014",18,0)
 N HEADER,RC
"RTN","RORX014",19,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX014",20,0)
 Q:HEADER<0 HEADER
"RTN","RORX014",21,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX014",HEADER)
"RTN","RORX014",22,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX014",23,0)
 ;
"RTN","RORX014",24,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX014",25,0)
 ;
"RTN","RORX014",26,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX014",27,0)
 ;
"RTN","RORX014",28,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX014",29,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX014",30,0)
 ;
"RTN","RORX014",31,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX014",32,0)
 ;               returned via this parameter
"RTN","RORX014",33,0)
 ;
"RTN","RORX014",34,0)
 ; Return Values:
"RTN","RORX014",35,0)
 ;       <0  Error code
"RTN","RORX014",36,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX014",37,0)
 ;
"RTN","RORX014",38,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX014",39,0)
 N PARAMS,RC
"RTN","RORX014",40,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX014",41,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX014",42,0)
 ;--- Process the drug list and options
"RTN","RORX014",43,0)
 S RORTSK("PARAMS","DRUGS","A","REGMEDS")=1
"RTN","RORX014",44,0)
 S RORTSK("PARAMS","DRUGS","A","AGGR_GENERIC")=1
"RTN","RORX014",45,0)
 S RC=$$DRUGLST^RORXU007(.RORTSK,PARAMS,.RORXL)
"RTN","RORX014",46,0)
 Q:RC<0 RC
"RTN","RORX014",47,0)
 ;--- Success
"RTN","RORX014",48,0)
 Q PARAMS
"RTN","RORX014",49,0)
 ;
"RTN","RORX014",50,0)
 ;***** COMPILES THE "REGISTRY MEDICATIONS" REPORT
"RTN","RORX014",51,0)
 ; REPORT CODE: 014
"RTN","RORX014",52,0)
 ;
"RTN","RORX014",53,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX014",54,0)
 ;
"RTN","RORX014",55,0)
 ; The ^TMP("RORX014",$J) global node is used by this function.
"RTN","RORX014",56,0)
 ;
"RTN","RORX014",57,0)
 ; ^TMP("RORX014",$J,
"RTN","RORX014",58,0)
 ;   "DRG",
"RTN","RORX014",59,0)
 ;     DrugIEN)          Medication name (generic or formulation)
"RTN","RORX014",60,0)
 ;   "RXC",
"RTN","RORX014",61,0)
 ;     RxcIEN,
"RTN","RORX014",62,0)
 ;       1)              List of Drug IEN's separated by ","
"RTN","RORX014",63,0)
 ;       "P"             Number of patients
"RTN","RORX014",64,0)
 ;         DFN)          Patient Descriptor
"RTN","RORX014",65,0)
 ;                         ^01: Las 4 digits of SSN
"RTN","RORX014",66,0)
 ;                         ^02: Name
"RTN","RORX014",67,0)
 ;                         ^03: Date of Death
"RTN","RORX014",68,0)
 ;     "B",
"RTN","RORX014",69,0)
 ;       RxcNdx,
"RTN","RORX014",70,0)
 ;         RxcIEN)       ""
"RTN","RORX014",71,0)
 ;     "P",
"RTN","RORX014",72,0)
 ;       NumOfPat,
"RTN","RORX014",73,0)
 ;         RxcIEN)       ""
"RTN","RORX014",74,0)
 ;
"RTN","RORX014",75,0)
 ; RxcNdx is the first 100 characters of the list of Drug IEN's.
"RTN","RORX014",76,0)
 ;
"RTN","RORX014",77,0)
 ; Return Values:
"RTN","RORX014",78,0)
 ;       <0  Error code
"RTN","RORX014",79,0)
 ;        0  Ok
"RTN","RORX014",80,0)
 ;
"RTN","RORX014",81,0)
RXCOMB(RORTSK) ;
"RTN","RORX014",82,0)
 N ROREDT        ; End date
"RTN","RORX014",83,0)
 N ROREDT1       ; End date + 1
"RTN","RORX014",84,0)
 N RORREG        ; Registry IEN
"RTN","RORX014",85,0)
 N RORSDT        ; Start date
"RTN","RORX014",86,0)
 N RORXL         ; Drug list for the pharmacy search API
"RTN","RORX014",87,0)
 ;
"RTN","RORX014",88,0)
 N ECNT,NRXC,RC,REPORT,SFLAGS,TMP
"RTN","RORX014",89,0)
 S RORXL="",(ECNT,RC)=0
"RTN","RORX014",90,0)
 K ^TMP("RORX014",$J)
"RTN","RORX014",91,0)
 ;--- Root node of the report
"RTN","RORX014",92,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX014",93,0)
 Q:REPORT<0 REPORT
"RTN","RORX014",94,0)
 ;
"RTN","RORX014",95,0)
 D
"RTN","RORX014",96,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX014",97,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX014",98,0)
 . S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0
"RTN","RORX014",99,0)
 . S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1)
"RTN","RORX014",100,0)
 . ;--- Report header
"RTN","RORX014",101,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX014",102,0)
 . ;--- Query the registry
"RTN","RORX014",103,0)
 . D TPPSETUP^RORTSK01(80)
"RTN","RORX014",104,0)
 . S RC=$$QUERY^RORX014A(SFLAGS)
"RTN","RORX014",105,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX014",106,0)
 . ;--- Sort the data
"RTN","RORX014",107,0)
 . D TPPSETUP^RORTSK01(5)
"RTN","RORX014",108,0)
 . S RC=$$SORT^RORX014A(.NRXC)
"RTN","RORX014",109,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX014",110,0)
 . ;--- Store the results
"RTN","RORX014",111,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX014",112,0)
 . S RC=$$STORE^RORX014A(REPORT,NRXC)
"RTN","RORX014",113,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX014",114,0)
 ;
"RTN","RORX014",115,0)
 ;--- Cleanup
"RTN","RORX014",116,0)
 K ^TMP("RORX014",$J)
"RTN","RORX014",117,0)
 D FREE^RORTMP(RORXL)
"RTN","RORX014",118,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX014A")
0^189^B27835424
"RTN","RORX014A",1,0)
RORX014A ;HOIFO/BH,SG - REGISTRY MEDS REPORT (QUERY & SORT) ; 11/25/05 5:52pm
"RTN","RORX014A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX014A",3,0)
 ;
"RTN","RORX014A",4,0)
 Q
"RTN","RORX014A",5,0)
 ;
"RTN","RORX014A",6,0)
 ;***** ADDS THE DRUG COMBINATION TO THE REPORT
"RTN","RORX014A",7,0)
 ;
"RTN","RORX014A",8,0)
 ; RXLST         List of drug IEN's separated by commas
"RTN","RORX014A",9,0)
 ; PATIEN        Patient IEN in file #2 (DFN)
"RTN","RORX014A",10,0)
 ;
"RTN","RORX014A",11,0)
ADD(RXLST,PATIEN) ;
"RTN","RORX014A",12,0)
 N RXCIEN,RXCNDX,TMP,VA,VADM,VAERR
"RTN","RORX014A",13,0)
 S RXCNDX=$E(RXLST,1,100)
"RTN","RORX014A",14,0)
 ;--- Search for the combination
"RTN","RORX014A",15,0)
 S RXCIEN=""
"RTN","RORX014A",16,0)
 F  D  Q:RXCIEN=""  Q:^TMP("RORX014",$J,"RXC",RXCIEN,1)=RXLST
"RTN","RORX014A",17,0)
 . S RXCIEN=$O(^TMP("RORX014",$J,"RXC","B",RXCNDX,RXCIEN))
"RTN","RORX014A",18,0)
 ;--- Add new combination
"RTN","RORX014A",19,0)
 D:RXCIEN'>0
"RTN","RORX014A",20,0)
 . S RXCIEN=$O(^TMP("RORX014",$J,"RXC"," "),-1)+1
"RTN","RORX014A",21,0)
 . S ^TMP("RORX014",$J,"RXC",RXCIEN,1)=RXLST
"RTN","RORX014A",22,0)
 . S ^TMP("RORX014",$J,"RXC","B",RXCNDX,RXCIEN)=""
"RTN","RORX014A",23,0)
 ;--- Add new patient
"RTN","RORX014A",24,0)
 S ^("P")=$G(^TMP("RORX014",$J,"RXC",RXCIEN,"P"))+1
"RTN","RORX014A",25,0)
 D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX014A",26,0)
 S TMP=VA("BID")_U_VADM(1)_U_$$DATE^RORXU002(VADM(6)\1)
"RTN","RORX014A",27,0)
 S ^TMP("RORX014",$J,"RXC",RXCIEN,"P",PATIEN)=TMP
"RTN","RORX014A",28,0)
 Q
"RTN","RORX014A",29,0)
 ;
"RTN","RORX014A",30,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX014A",31,0)
 ;
"RTN","RORX014A",32,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX014A",33,0)
 ;
"RTN","RORX014A",34,0)
 ; Return Values:
"RTN","RORX014A",35,0)
 ;       <0  Error code
"RTN","RORX014A",36,0)
 ;        0  Ok
"RTN","RORX014A",37,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX014A",38,0)
 ;
"RTN","RORX014A",39,0)
QUERY(FLAGS) ;
"RTN","RORX014A",40,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX014A",41,0)
 N RORXDST       ; Descriptor for pharmacy search API
"RTN","RORX014A",42,0)
 ;
"RTN","RORX014A",43,0)
 N CNT,DRGIEN,ECNT,NAME,PATIEN,RC,RORIEN,RXFLAGS,STR,TMP,XREFNODE
"RTN","RORX014A",44,0)
 ;
"RTN","RORX014A",45,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX014A",46,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX014A",47,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX014A",48,0)
 ;
"RTN","RORX014A",49,0)
 ;--- Prepare parameters for the pharmacy search API
"RTN","RORX014A",50,0)
 S RORXDST=$NA(RORXDST("RORX014"))
"RTN","RORX014A",51,0)
 S RORXDST("RORCB")="$$RXSCB^RORX014A"
"RTN","RORX014A",52,0)
 S RORXDST("GENERIC")=$$PARAM^RORTSK01("DRUGS","AGGR_GENERIC")
"RTN","RORX014A",53,0)
 S RXFLAGS="E"
"RTN","RORX014A",54,0)
 S:$$PARAM^RORTSK01("PATIENTS","INPATIENT") RXFLAGS=RXFLAGS_"IV"
"RTN","RORX014A",55,0)
 S:$$PARAM^RORTSK01("PATIENTS","OUTPATIENT") RXFLAGS=RXFLAGS_"O"
"RTN","RORX014A",56,0)
 Q:RXFLAGS="E" 0
"RTN","RORX014A",57,0)
 ;
"RTN","RORX014A",58,0)
 ;--- Browse through the registry records
"RTN","RORX014A",59,0)
 S RORIEN=0
"RTN","RORX014A",60,0)
 F  S RORIEN=$O(@XREFNODE@(RORIEN))  Q:RORIEN'>0  D  Q:RC<0
"RTN","RORX014A",61,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX014A",62,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX014A",63,0)
 . S CNT=CNT+1
"RTN","RORX014A",64,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX014A",65,0)
 . Q:$$SKIP^RORXU005(RORIEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX014A",66,0)
 . ;
"RTN","RORX014A",67,0)
 . ;--- Get the patient IEN (DFN)
"RTN","RORX014A",68,0)
 . S PATIEN=$$PTIEN^RORUTL01(RORIEN)  Q:PATIEN'>0
"RTN","RORX014A",69,0)
 . ;
"RTN","RORX014A",70,0)
 . ;--- Search for pharmacy data
"RTN","RORX014A",71,0)
 . S TMP=$$RXSEARCH^RORUTL14(PATIEN,RORXL,.RORXDST,RXFLAGS,RORSDT,ROREDT1)
"RTN","RORX014A",72,0)
 . I TMP'>0  S:TMP<0 ECNT=ECNT+1  Q:$D(@RORXDST)<10
"RTN","RORX014A",73,0)
 . ;
"RTN","RORX014A",74,0)
 . S (NAME,STR)=""
"RTN","RORX014A",75,0)
 . F  S NAME=$O(@RORXDST@(NAME))  Q:NAME=""  D
"RTN","RORX014A",76,0)
 . . S DRGIEN=0
"RTN","RORX014A",77,0)
 . . F  S DRGIEN=$O(@RORXDST@(NAME,DRGIEN))  Q:DRGIEN'>0  D
"RTN","RORX014A",78,0)
 . . . S ^TMP("RORX014",$J,"DRG",DRGIEN)=NAME
"RTN","RORX014A",79,0)
 . . . S STR=STR_","_DRGIEN
"RTN","RORX014A",80,0)
 . K @RORXDST
"RTN","RORX014A",81,0)
 . ;
"RTN","RORX014A",82,0)
 . D ADD($P(STR,",",2,999),PATIEN)
"RTN","RORX014A",83,0)
 ;
"RTN","RORX014A",84,0)
 ;---
"RTN","RORX014A",85,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX014A",86,0)
 ;
"RTN","RORX014A",87,0)
 ;***** CALLBACK FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORX014A",88,0)
RXSCB(RORDST,ORDER,ORDFLG,DRUG,DATE) ;
"RTN","RORX014A",89,0)
 N IEN,NAME
"RTN","RORX014A",90,0)
 I ROR8DST("GENERIC")  D
"RTN","RORX014A",91,0)
 . S IEN=+ROR8DST("RORXGEN"),NAME=$P(ROR8DST("RORXGEN"),U,2)
"RTN","RORX014A",92,0)
 E  S IEN=+DRUG,NAME=$P(DRUG,U,2)
"RTN","RORX014A",93,0)
 Q:(IEN'>0)!(NAME="") 1
"RTN","RORX014A",94,0)
 S @RORDST@(NAME,IEN)=""
"RTN","RORX014A",95,0)
 Q 0
"RTN","RORX014A",96,0)
 ;
"RTN","RORX014A",97,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX014A",98,0)
 ;
"RTN","RORX014A",99,0)
 ; NRXC          Number of drug combinations
"RTN","RORX014A",100,0)
 ;
"RTN","RORX014A",101,0)
 ; Return Values:
"RTN","RORX014A",102,0)
 ;       <0  Error code
"RTN","RORX014A",103,0)
 ;        0  Ok
"RTN","RORX014A",104,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX014A",105,0)
 ;
"RTN","RORX014A",106,0)
SORT(NRXC) ;
"RTN","RORX014A",107,0)
 N IEN,TMP
"RTN","RORX014A",108,0)
 S (IEN,NRXC)=0
"RTN","RORX014A",109,0)
 F  S IEN=$O(^TMP("RORX014",$J,"RXC",IEN))  Q:IEN'>0  D
"RTN","RORX014A",110,0)
 . S TMP=^TMP("RORX014",$J,"RXC",IEN,"P")
"RTN","RORX014A",111,0)
 . S ^TMP("RORX014",$J,"RXC","P",TMP,IEN)="",NRXC=NRXC+1
"RTN","RORX014A",112,0)
 Q 0
"RTN","RORX014A",113,0)
 ;
"RTN","RORX014A",114,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX014A",115,0)
 ;
"RTN","RORX014A",116,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX014A",117,0)
 ; NRXC          Number of drug combinations
"RTN","RORX014A",118,0)
 ;
"RTN","RORX014A",119,0)
 ; Return Values:
"RTN","RORX014A",120,0)
 ;       <0  Error code
"RTN","RORX014A",121,0)
 ;        0  Ok
"RTN","RORX014A",122,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX014A",123,0)
 ;
"RTN","RORX014A",124,0)
STORE(REPORT,NRXC) ;
"RTN","RORX014A",125,0)
 N BUF,CNT,DRG,ITEM,NODE,PATIEN,RORI,RXCIEN,RXCNT,RXCOMB,SECTION,TABLE,VA,VADM,VAERR
"RTN","RORX014A",126,0)
 S NODE=$NA(^TMP("RORX014",$J))
"RTN","RORX014A",127,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"RXCOMBLST",,REPORT)
"RTN","RORX014A",128,0)
 Q:SECTION<0 SECTION
"RTN","RORX014A",129,0)
 D ADDATTR^RORTSK11(RORTSK,SECTION,"TABLE","RXCOMBLST")
"RTN","RORX014A",130,0)
 ;---
"RTN","RORX014A",131,0)
 Q:NRXC'>0 0
"RTN","RORX014A",132,0)
 ;---
"RTN","RORX014A",133,0)
 S RXCNT="",CNT=0
"RTN","RORX014A",134,0)
 F  S RXCNT=$O(@NODE@("RXC","P",RXCNT),-1)  Q:RXCNT=""  D
"RTN","RORX014A",135,0)
 . S RC=$$LOOP^RORTSK01(CNT/NRXC),CNT=CNT+1  Q:RC<0
"RTN","RORX014A",136,0)
 . S RXCIEN=""
"RTN","RORX014A",137,0)
 . F  S RXCIEN=$O(@NODE@("RXC","P",RXCNT,RXCIEN),-1)  Q:RXCIEN=""  D
"RTN","RORX014A",138,0)
 . . S RXCOMB=$$ADDVAL^RORTSK11(RORTSK,"RXCOMB",,SECTION)
"RTN","RORX014A",139,0)
 . . ;--- List of drugs
"RTN","RORX014A",140,0)
 . . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"DRUGS",,RXCOMB)
"RTN","RORX014A",141,0)
 . . S BUF=@NODE@("RXC",RXCIEN,1)
"RTN","RORX014A",142,0)
 . . F RORI=1:1  S DRG=$P(BUF,",",RORI)  Q:DRG=""  D
"RTN","RORX014A",143,0)
 . . . S DRG=$P(^TMP("RORX014",$J,"DRG",DRG),U)
"RTN","RORX014A",144,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",DRG,TABLE,1)
"RTN","RORX014A",145,0)
 . . ;--- Number of unique patients
"RTN","RORX014A",146,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NP",RXCNT,RXCOMB,3)
"RTN","RORX014A",147,0)
 . . ;--- List of patients
"RTN","RORX014A",148,0)
 . . Q:'$$PARAM^RORTSK01("OPTIONS","COMPLETE")
"RTN","RORX014A",149,0)
 . . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,RXCOMB)
"RTN","RORX014A",150,0)
 . . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PATIENTS")
"RTN","RORX014A",151,0)
 . . S PATIEN=""
"RTN","RORX014A",152,0)
 . . F  S PATIEN=$O(@NODE@("RXC",RXCIEN,"P",PATIEN))  Q:PATIEN=""  D
"RTN","RORX014A",153,0)
 . . . S BUF=@NODE@("RXC",RXCIEN,"P",PATIEN)
"RTN","RORX014A",154,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE,,PATIEN)
"RTN","RORX014A",155,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",$P(BUF,U,2),ITEM,1)
"RTN","RORX014A",156,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(BUF,U),ITEM,2)
"RTN","RORX014A",157,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(BUF,U,3),ITEM,1)
"RTN","RORX014A",158,0)
 Q 0
"RTN","RORX015")
0^215^B7302265
"RTN","RORX015",1,0)
RORX015 ;HOIFO/SG - PROCEDURES (CPT) REPORT ; 10/26/05 9:46am
"RTN","RORX015",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX015",3,0)
 ;
"RTN","RORX015",4,0)
 Q
"RTN","RORX015",5,0)
 ;
"RTN","RORX015",6,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX015",7,0)
 ;
"RTN","RORX015",8,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX015",9,0)
 ;
"RTN","RORX015",10,0)
 ; Return Values:
"RTN","RORX015",11,0)
 ;       <0  Error code
"RTN","RORX015",12,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX015",13,0)
 ;
"RTN","RORX015",14,0)
HEADER(PARTAG) ;
"RTN","RORX015",15,0)
 ;;CPTLST(#,CODE,DESCR,NP,NC)
"RTN","RORX015",16,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,PTCPTL(CODE,DESCR,DATE,SOURCE))
"RTN","RORX015",17,0)
 ;
"RTN","RORX015",18,0)
 N HEADER,RC
"RTN","RORX015",19,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX015",20,0)
 Q:HEADER<0 HEADER
"RTN","RORX015",21,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX015",HEADER)
"RTN","RORX015",22,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX015",23,0)
 ;
"RTN","RORX015",24,0)
 ;
"RTN","RORX015",25,0)
 ;***** COMPILES THE "PROCEDURES" REPORT
"RTN","RORX015",26,0)
 ; REPORT CODE: 015
"RTN","RORX015",27,0)
 ;
"RTN","RORX015",28,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX015",29,0)
 ;
"RTN","RORX015",30,0)
 ; @RORTMP@(
"RTN","RORX015",31,0)
 ;
"RTN","RORX015",32,0)
 ;   "PAT",              Number of patients
"RTN","RORX015",33,0)
 ;     DFN,              Descriptor
"RTN","RORX015",34,0)
 ;                         ^01: Las 4 digits of SSN
"RTN","RORX015",35,0)
 ;                         ^02: Name
"RTN","RORX015",36,0)
 ;                         ^03: Date of Death
"RTN","RORX015",37,0)
 ;       CPTIEN,         Earliest Code Descriptor
"RTN","RORX015",38,0)
 ;                         ^01: Date
"RTN","RORX015",39,0)
 ;                         ^02: Source ("I" or "O")
"RTN","RORX015",40,0)
 ;         "C")          Quantity
"RTN","RORX015",41,0)
 ;         "I")          Inpatient quantity
"RTN","RORX015",42,0)
 ;         "O")          Outpatient quantity
"RTN","RORX015",43,0)
 ;
"RTN","RORX015",44,0)
 ;   "CPT",              Totals
"RTN","RORX015",45,0)
 ;                         ^01: Number of CPT codes
"RTN","RORX015",46,0)
 ;                         ^02: Number of different codes
"RTN","RORX015",47,0)
 ;     CPTIEN,           CPT Descriptor
"RTN","RORX015",48,0)
 ;                         ^01: Code
"RTN","RORX015",49,0)
 ;                         ^02: Short description (current version)
"RTN","RORX015",50,0)
 ;       "C")            Quantity
"RTN","RORX015",51,0)
 ;       "P")            Number of unique patients
"RTN","RORX015",52,0)
 ;
"RTN","RORX015",53,0)
 ; Return Values:
"RTN","RORX015",54,0)
 ;       <0  Error code
"RTN","RORX015",55,0)
 ;        0  Ok
"RTN","RORX015",56,0)
 ;
"RTN","RORX015",57,0)
CPTLST(RORTSK) ;
"RTN","RORX015",58,0)
 N ROREDT        ; End date
"RTN","RORX015",59,0)
 N RORREG        ; Registry IEN
"RTN","RORX015",60,0)
 N RORSDT        ; Start date
"RTN","RORX015",61,0)
 N RORTMP        ; Closed root of the temporary buffer
"RTN","RORX015",62,0)
 ;
"RTN","RORX015",63,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX015",64,0)
 ;--- Root node of the report
"RTN","RORX015",65,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX015",66,0)
 Q:REPORT<0 REPORT
"RTN","RORX015",67,0)
 ;
"RTN","RORX015",68,0)
 ;--- Get and prepare the report parameters
"RTN","RORX015",69,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX015",70,0)
 S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0 RC
"RTN","RORX015",71,0)
 ;
"RTN","RORX015",72,0)
 ;--- Initialize constants and variables
"RTN","RORX015",73,0)
 S (ECNT,RC)=0
"RTN","RORX015",74,0)
 ;
"RTN","RORX015",75,0)
 ;--- Report header
"RTN","RORX015",76,0)
 S RC=$$HEADER(REPORT)  Q:RC<0 RC
"RTN","RORX015",77,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORX015",78,0)
 D
"RTN","RORX015",79,0)
 . ;--- Query the registry
"RTN","RORX015",80,0)
 . D TPPSETUP^RORTSK01(70)
"RTN","RORX015",81,0)
 . S RC=$$QUERY^RORX015A(SFLAGS)
"RTN","RORX015",82,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX015",83,0)
 . ;--- Sort the data
"RTN","RORX015",84,0)
 . D TPPSETUP^RORTSK01(10)
"RTN","RORX015",85,0)
 . S RC=$$SORT^RORX015A()
"RTN","RORX015",86,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX015",87,0)
 . ;--- Store the results
"RTN","RORX015",88,0)
 . D TPPSETUP^RORTSK01(20)
"RTN","RORX015",89,0)
 . S RC=$$STORE^RORX015C(REPORT)
"RTN","RORX015",90,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX015",91,0)
 ;
"RTN","RORX015",92,0)
 ;--- Cleanup
"RTN","RORX015",93,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORX015",94,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX015",95,0)
 ;
"RTN","RORX015",96,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX015",97,0)
 ;
"RTN","RORX015",98,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX015",99,0)
 ;
"RTN","RORX015",100,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX015",101,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX015",102,0)
 ;
"RTN","RORX015",103,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX015",104,0)
 ;               returned via this parameter
"RTN","RORX015",105,0)
 ;
"RTN","RORX015",106,0)
 ; Return Values:
"RTN","RORX015",107,0)
 ;       <0  Error code
"RTN","RORX015",108,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX015",109,0)
 ;
"RTN","RORX015",110,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX015",111,0)
 N PARAMS,TMP
"RTN","RORX015",112,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX015",113,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX015",114,0)
 ;--- Process the list of CPT codes
"RTN","RORX015",115,0)
 S TMP=$$CPTLST^RORXU006(.RORTSK,PARAMS)  Q:TMP<0 TMP
"RTN","RORX015",116,0)
 ;---
"RTN","RORX015",117,0)
 Q PARAMS
"RTN","RORX015A")
0^216^B24310638
"RTN","RORX015A",1,0)
RORX015A ;HCIOFO/SG - PROCEDURES (QUERY & SORT) ; 10/27/05 11:29am
"RTN","RORX015A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX015A",3,0)
 ;
"RTN","RORX015A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX015A",5,0)
 ;
"RTN","RORX015A",6,0)
 ; #1995         $$CODEN^ICPTCOD and $$CPT^ICPTCOD (supported)
"RTN","RORX015A",7,0)
 ;
"RTN","RORX015A",8,0)
 Q
"RTN","RORX015A",9,0)
 ;
"RTN","RORX015A",10,0)
 ;**** STORES THE CPT CODE
"RTN","RORX015A",11,0)
 ;
"RTN","RORX015A",12,0)
 ; PTIEN         Patient IEN (DFN)
"RTN","RORX015A",13,0)
 ; SOURCE        CPT source code ("I", "O")
"RTN","RORX015A",14,0)
 ; [CPTIEN]      IEN of the CPT descriptor in file #81
"RTN","RORX015A",15,0)
 ; DATE          Date when the code was entered
"RTN","RORX015A",16,0)
 ; [CPT]         CPT code
"RTN","RORX015A",17,0)
 ;
"RTN","RORX015A",18,0)
 ; Either the CPTIEN or the CPT parameter must be provided.
"RTN","RORX015A",19,0)
 ;
"RTN","RORX015A",20,0)
CPTSET(PTIEN,SOURCE,CPTIEN,DATE,CPT) ;
"RTN","RORX015A",21,0)
 Q:DATE'>0
"RTN","RORX015A",22,0)
 N TMP
"RTN","RORX015A",23,0)
 S CPTIEN=+$G(CPTIEN)
"RTN","RORX015A",24,0)
 I CPTIEN'>0  Q:$G(CPT)=""  D  Q:CPTIEN'>0
"RTN","RORX015A",25,0)
 . S CPTIEN=+$$CODEN^ICPTCOD(CPT)
"RTN","RORX015A",26,0)
 I '$$PARAM^RORTSK01("CPTLST","ALL")  D  Q:'TMP
"RTN","RORX015A",27,0)
 . S TMP=$D(RORTSK("PARAMS","CPTLST","C",CPTIEN))
"RTN","RORX015A",28,0)
 ;---
"RTN","RORX015A",29,0)
 S TMP=+$G(@RORTMP@("PAT",PTIEN,CPTIEN))
"RTN","RORX015A",30,0)
 S:'TMP!(DATE<TMP) @RORTMP@("PAT",PTIEN,CPTIEN)=DATE_U_SOURCE
"RTN","RORX015A",31,0)
 S ^(SOURCE)=$G(@RORTMP@("PAT",PTIEN,CPTIEN,SOURCE))+1
"RTN","RORX015A",32,0)
 Q
"RTN","RORX015A",33,0)
 ;
"RTN","RORX015A",34,0)
 ;***** SEARCHES FOR INPATIENT PROCEDURES
"RTN","RORX015A",35,0)
 ;
"RTN","RORX015A",36,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX015A",37,0)
 ;
"RTN","RORX015A",38,0)
 ; Return Values:
"RTN","RORX015A",39,0)
 ;       <0  Error code
"RTN","RORX015A",40,0)
 ;        0  Ok
"RTN","RORX015A",41,0)
 ;
"RTN","RORX015A",42,0)
INPAT(PATIEN) ;
"RTN","RORX015A",43,0)
 N RC
"RTN","RORX015A",44,0)
 S RC=0
"RTN","RORX015A",45,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX015A",46,0)
 ;
"RTN","RORX015A",47,0)
 ;***** CALL-BACK PROCEDURE FOR THE OUTPATIENT SEARCH
"RTN","RORX015A",48,0)
 ;
"RTN","RORX015A",49,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX015A",50,0)
 ;
"RTN","RORX015A",51,0)
OPSCAN(PTIEN) ;
"RTN","RORX015A",52,0)
 N CPTIEN,DATE,IEN,RORCPT,VDATE
"RTN","RORX015A",53,0)
 D GETCPT^SDOE(Y,"RORCPT")
"RTN","RORX015A",54,0)
 Q:$G(RORCPT)'>0
"RTN","RORX015A",55,0)
 S VDATE=+$P(Y0,U)
"RTN","RORX015A",56,0)
 ;---
"RTN","RORX015A",57,0)
 S IEN=0
"RTN","RORX015A",58,0)
 F  S IEN=$O(RORCPT(IEN))  Q:IEN'>0  D
"RTN","RORX015A",59,0)
 . S CPTIEN=+$P(RORCPT(IEN),U),DATE=+$P($G(RORCPT(IEN,12)),U)
"RTN","RORX015A",60,0)
 . D:CPTIEN>0 CPTSET(PTIEN,"O",CPTIEN,$S(DATE>0:DATE,1:VDATE))
"RTN","RORX015A",61,0)
 Q
"RTN","RORX015A",62,0)
 ;
"RTN","RORX015A",63,0)
 ;***** SEARCHES FOR OUTPATIENT PROCEDURES
"RTN","RORX015A",64,0)
 ;
"RTN","RORX015A",65,0)
 ; PTIEN         Patient IEN (DFN)
"RTN","RORX015A",66,0)
 ;
"RTN","RORX015A",67,0)
 ; Return Values:
"RTN","RORX015A",68,0)
 ;       <0  Error code
"RTN","RORX015A",69,0)
 ;        0  Ok
"RTN","RORX015A",70,0)
 ;
"RTN","RORX015A",71,0)
OUTPAT(PTIEN) ;
"RTN","RORX015A",72,0)
 N QUERY
"RTN","RORX015A",73,0)
 D OPEN^SDQ(.QUERY)
"RTN","RORX015A",74,0)
 D INDEX^SDQ(.QUERY,"PATIENT/DATE","SET")
"RTN","RORX015A",75,0)
 D PAT^SDQ(.QUERY,PTIEN,"SET")
"RTN","RORX015A",76,0)
 D DATE^SDQ(.QUERY,RORSDT,ROREDT1,"SET")
"RTN","RORX015A",77,0)
 D SCANCB^SDQ(.QUERY,"D OPSCAN^RORX015A("_PTIEN_")","SET")
"RTN","RORX015A",78,0)
 D ACTIVE^SDQ(.QUERY,"TRUE","SET")
"RTN","RORX015A",79,0)
 D SCAN^SDQ(.QUERY,"FORWARD")
"RTN","RORX015A",80,0)
 D CLOSE^SDQ(.QUERY)
"RTN","RORX015A",81,0)
 Q 0
"RTN","RORX015A",82,0)
 ;
"RTN","RORX015A",83,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX015A",84,0)
 ;
"RTN","RORX015A",85,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX015A",86,0)
 ;
"RTN","RORX015A",87,0)
 ; Return Values:
"RTN","RORX015A",88,0)
 ;       <0  Error code
"RTN","RORX015A",89,0)
 ;        0  Ok
"RTN","RORX015A",90,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015A",91,0)
 ;
"RTN","RORX015A",92,0)
QUERY(FLAGS) ;
"RTN","RORX015A",93,0)
 N ROREDT1       ; Day after the end date
"RTN","RORX015A",94,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX015A",95,0)
 ;
"RTN","RORX015A",96,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,TMP,XREFNODE
"RTN","RORX015A",97,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX015A",98,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX015A",99,0)
 S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1)
"RTN","RORX015A",100,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX015A",101,0)
 ;
"RTN","RORX015A",102,0)
 ;=== Browse through the registry records
"RTN","RORX015A",103,0)
 S IEN=0
"RTN","RORX015A",104,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX015A",105,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX015A",106,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX015A",107,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX015A",108,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX015A",109,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX015A",110,0)
 . ;
"RTN","RORX015A",111,0)
 . ;--- Get the patient IEN (DFN)
"RTN","RORX015A",112,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX015A",113,0)
 . ;
"RTN","RORX015A",114,0)
 . ;--- Inpatient codes
"RTN","RORX015A",115,0)
 . ;S RC=$$INPAT(PATIEN)
"RTN","RORX015A",116,0)
 . ;I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX015A",117,0)
 . ;
"RTN","RORX015A",118,0)
 . ;--- Outpatient codes
"RTN","RORX015A",119,0)
 . S RC=$$OUTPAT(PATIEN)
"RTN","RORX015A",120,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX015A",121,0)
 . ;
"RTN","RORX015A",122,0)
 . ;--- Skip the patient if no data has been found
"RTN","RORX015A",123,0)
 . Q:$D(@RORTMP@("PAT",PATIEN))<10
"RTN","RORX015A",124,0)
 . ;
"RTN","RORX015A",125,0)
 . ;--- Calculate the patient's totals
"RTN","RORX015A",126,0)
 . S RC=$$TOTALS(PATIEN)
"RTN","RORX015A",127,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX015A",128,0)
 ;---
"RTN","RORX015A",129,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX015A",130,0)
 ;
"RTN","RORX015A",131,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX015A",132,0)
 ;
"RTN","RORX015A",133,0)
 ; Return Values:
"RTN","RORX015A",134,0)
 ;       <0  Error code
"RTN","RORX015A",135,0)
 ;        0  Ok
"RTN","RORX015A",136,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015A",137,0)
 ;
"RTN","RORX015A",138,0)
SORT() ;
"RTN","RORX015A",139,0)
 N CPTIEN,TMP,TNC,TNDC
"RTN","RORX015A",140,0)
 ;---
"RTN","RORX015A",141,0)
 S CPTIEN=0,(TNC,TNDC)=0
"RTN","RORX015A",142,0)
 F  S CPTIEN=$O(@RORTMP@("CPT",CPTIEN))  Q:CPTIEN'>0  D
"RTN","RORX015A",143,0)
 . S TNC=TNC+$G(@RORTMP@("CPT",CPTIEN,"C"))
"RTN","RORX015A",144,0)
 . S TNDC=TNDC+1
"RTN","RORX015A",145,0)
 S @RORTMP@("CPT")=TNC_U_TNDC
"RTN","RORX015A",146,0)
 ;---
"RTN","RORX015A",147,0)
 Q 0
"RTN","RORX015A",148,0)
 ;
"RTN","RORX015A",149,0)
 ;***** CALCULATES INTERMEDIATE TOTALS
"RTN","RORX015A",150,0)
 ;
"RTN","RORX015A",151,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX015A",152,0)
 ;
"RTN","RORX015A",153,0)
 ; Return Values:
"RTN","RORX015A",154,0)
 ;       <0  Error code
"RTN","RORX015A",155,0)
 ;        0  Ok
"RTN","RORX015A",156,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015A",157,0)
 ;
"RTN","RORX015A",158,0)
TOTALS(PATIEN) ;
"RTN","RORX015A",159,0)
 N CNT,CPT,CPTIEN,CPTNAME,PNODE,RC,TMP,VA,VADM
"RTN","RORX015A",160,0)
 S PNODE=$NA(@RORTMP@("PAT",PATIEN))
"RTN","RORX015A",161,0)
 ;--- Get and store the patient's data
"RTN","RORX015A",162,0)
 D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX015A",163,0)
 S @PNODE=VA("BID")_U_VADM(1)_U_$$DATE^RORXU002(VADM(6)\1)
"RTN","RORX015A",164,0)
 S ^("PAT")=$G(@RORTMP@("PAT"))+1
"RTN","RORX015A",165,0)
 ;
"RTN","RORX015A",166,0)
 S CPTIEN=0
"RTN","RORX015A",167,0)
 F  S CPTIEN=$O(@PNODE@(CPTIEN))  Q:CPTIEN'>0  D
"RTN","RORX015A",168,0)
 . S CPT=$P($G(@RORTMP@("CPT",CPTIEN)),U)
"RTN","RORX015A",169,0)
 . D:CPT=""
"RTN","RORX015A",170,0)
 . . S TMP=$$CPT^ICPTCOD(CPTIEN)
"RTN","RORX015A",171,0)
 . . I TMP'<0  S CPT=$P(TMP,U,2),CPTNAME=$P(TMP,U,3)
"RTN","RORX015A",172,0)
 . . E  S CPTNAME=""
"RTN","RORX015A",173,0)
 . . S:CPT="" CPT="UNKN"
"RTN","RORX015A",174,0)
 . . S:CPTNAME="" CPTNAME="Unknown ("_CPTIEN_")"
"RTN","RORX015A",175,0)
 . . S @RORTMP@("CPT",CPTIEN)=CPT_U_CPTNAME
"RTN","RORX015A",176,0)
 . ;---
"RTN","RORX015A",177,0)
 . S CNT=0
"RTN","RORX015A",178,0)
 . F TMP="I","O"  S CNT=CNT+$G(@PNODE@(CPTIEN,TMP))
"RTN","RORX015A",179,0)
 . S @PNODE@(CPTIEN,"C")=CNT
"RTN","RORX015A",180,0)
 . S ^("C")=$G(@RORTMP@("CPT",CPTIEN,"C"))+CNT
"RTN","RORX015A",181,0)
 . S ^("P")=$G(@RORTMP@("CPT",CPTIEN,"P"))+1
"RTN","RORX015A",182,0)
 Q 0
"RTN","RORX015C")
0^214^B12085093
"RTN","RORX015C",1,0)
RORX015C ;HCIOFO/SG - PROCEDURES (STORE) ; 10/27/05 11:30am
"RTN","RORX015C",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX015C",3,0)
 ;
"RTN","RORX015C",4,0)
 ; This routine uses the following IAs:
"RTN","RORX015C",5,0)
 ;
"RTN","RORX015C",6,0)
 ; #1995         $$CPT^ICPTCOD (supported)
"RTN","RORX015C",7,0)
 ;
"RTN","RORX015C",8,0)
 Q
"RTN","RORX015C",9,0)
 ;
"RTN","RORX015C",10,0)
 ;***** STORES THE CPT CODE TABLE
"RTN","RORX015C",11,0)
 ;
"RTN","RORX015C",12,0)
 ; PTAG          IEN of the parent element
"RTN","RORX015C",13,0)
 ;
"RTN","RORX015C",14,0)
 ; NODE          Closed root of the node of the temporary global
"RTN","RORX015C",15,0)
 ;
"RTN","RORX015C",16,0)
 ; Return Values:
"RTN","RORX015C",17,0)
 ;       <0  Error code
"RTN","RORX015C",18,0)
 ;        0  Ok
"RTN","RORX015C",19,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015C",20,0)
 ;
"RTN","RORX015C",21,0)
CODES(PTAG,NODE) ;
"RTN","RORX015C",22,0)
 N CPTIEN,ITEM,TABLE,TMP
"RTN","RORX015C",23,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"CPTLST",,PTAG)
"RTN","RORX015C",24,0)
 Q:TABLE<0 TABLE
"RTN","RORX015C",25,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","CPTLST")
"RTN","RORX015C",26,0)
 S CPTIEN=0
"RTN","RORX015C",27,0)
 F  S CPTIEN=$O(@NODE@("CPT",CPTIEN))  Q:CPTIEN'>0  D
"RTN","RORX015C",28,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"CPT",,TABLE)
"RTN","RORX015C",29,0)
 . S TMP=@NODE@("CPT",CPTIEN)
"RTN","RORX015C",30,0)
 . D ADDVAL^RORTSK11(RORTSK,"CODE",$P(TMP,U,1),ITEM,2)
"RTN","RORX015C",31,0)
 . D ADDVAL^RORTSK11(RORTSK,"DESCR",$P(TMP,U,2),ITEM,2)
"RTN","RORX015C",32,0)
 . S TMP=$G(@NODE@("CPT",CPTIEN,"P"))
"RTN","RORX015C",33,0)
 . D ADDVAL^RORTSK11(RORTSK,"NP",TMP,ITEM,3)
"RTN","RORX015C",34,0)
 . S TMP=$G(@NODE@("CPT",CPTIEN,"C"))
"RTN","RORX015C",35,0)
 . D ADDVAL^RORTSK11(RORTSK,"NC",TMP,ITEM,3)
"RTN","RORX015C",36,0)
 Q 0
"RTN","RORX015C",37,0)
 ;
"RTN","RORX015C",38,0)
 ;***** STORES THE PATIENT TABLE
"RTN","RORX015C",39,0)
 ;
"RTN","RORX015C",40,0)
 ; PTAG          IEN of the parent element
"RTN","RORX015C",41,0)
 ;
"RTN","RORX015C",42,0)
 ; NODE          Closed root of the node of the temporary global
"RTN","RORX015C",43,0)
 ;
"RTN","RORX015C",44,0)
 ; Return Values:
"RTN","RORX015C",45,0)
 ;       <0  Error code
"RTN","RORX015C",46,0)
 ;        0  Ok
"RTN","RORX015C",47,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015C",48,0)
 ;
"RTN","RORX015C",49,0)
PATIENTS(PTAG,NODE) ;
"RTN","RORX015C",50,0)
 N DATE,CPT,CPTIEN,ITEM,PATIEN,PTCPTL,SOURCE,TABLE,TMP
"RTN","RORX015C",51,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,PTAG)
"RTN","RORX015C",52,0)
 Q:TABLE<0 TABLE
"RTN","RORX015C",53,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PATIENTS")
"RTN","RORX015C",54,0)
 S PATIEN=0
"RTN","RORX015C",55,0)
 F  S PATIEN=$O(@NODE@("PAT",PATIEN))  Q:PATIEN'>0  D
"RTN","RORX015C",56,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX015C",57,0)
 . S TMP=@NODE@("PAT",PATIEN)
"RTN","RORX015C",58,0)
 . D ADDVAL^RORTSK11(RORTSK,"NAME",$P(TMP,U,2),ITEM,2)
"RTN","RORX015C",59,0)
 . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(TMP,U,1),ITEM,2)
"RTN","RORX015C",60,0)
 . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(TMP,U,3),ITEM,1)
"RTN","RORX015C",61,0)
 . S PTCPTL=$$ADDVAL^RORTSK11(RORTSK,"PTCPTL",,ITEM)
"RTN","RORX015C",62,0)
 . S CPTIEN=0
"RTN","RORX015C",63,0)
 . F  S CPTIEN=$O(@NODE@("PAT",PATIEN,CPTIEN))  Q:CPTIEN'>0  D
"RTN","RORX015C",64,0)
 . . S CPT=$$ADDVAL^RORTSK11(RORTSK,"CPT",,PTCPTL)
"RTN","RORX015C",65,0)
 . . S TMP=$G(@NODE@("PAT",PATIEN,CPTIEN))
"RTN","RORX015C",66,0)
 . . S DATE=$P(TMP,U),SOURCE=$P(TMP,U,2)
"RTN","RORX015C",67,0)
 . . S TMP=$$CPT^ICPTCOD(CPTIEN,DATE)
"RTN","RORX015C",68,0)
 . . S:TMP<0 TMP=""
"RTN","RORX015C",69,0)
 . . D ADDVAL^RORTSK11(RORTSK,"CODE",$P(TMP,U,2),CPT,2)
"RTN","RORX015C",70,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DESCR",$P(TMP,U,3),CPT,2)
"RTN","RORX015C",71,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DATE",$$DATE^RORXU002(DATE\1),CPT,1)
"RTN","RORX015C",72,0)
 . . D ADDVAL^RORTSK11(RORTSK,"SOURCE",SOURCE,CPT,2)
"RTN","RORX015C",73,0)
 Q 0
"RTN","RORX015C",74,0)
 ;
"RTN","RORX015C",75,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX015C",76,0)
 ;
"RTN","RORX015C",77,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX015C",78,0)
 ;
"RTN","RORX015C",79,0)
 ; Return Values:
"RTN","RORX015C",80,0)
 ;       <0  Error code
"RTN","RORX015C",81,0)
 ;        0  Ok
"RTN","RORX015C",82,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015C",83,0)
 ;
"RTN","RORX015C",84,0)
STORE(REPORT) ;
"RTN","RORX015C",85,0)
 N ECNT,PATIEN,RC,SECTION,TMP
"RTN","RORX015C",86,0)
 S (ECNT,RC)=0
"RTN","RORX015C",87,0)
 ;--- CPT codes
"RTN","RORX015C",88,0)
 S RC=$$CODES(REPORT,RORTMP)
"RTN","RORX015C",89,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+RC
"RTN","RORX015C",90,0)
 S RC=$$LOOP^RORTSK01(.3)  Q:RC<0 RC
"RTN","RORX015C",91,0)
 ;--- Patients
"RTN","RORX015C",92,0)
 S TMP=$$PARAM^RORTSK01("OPTIONS","COMPLETE")
"RTN","RORX015C",93,0)
 I TMP  D  I RC  Q:RC<0 RC  S ECNT=ECNT+RC
"RTN","RORX015C",94,0)
 . S RC=$$PATIENTS(REPORT,RORTMP)
"RTN","RORX015C",95,0)
 S RC=$$LOOP^RORTSK01(.99)  Q:RC<0 RC
"RTN","RORX015C",96,0)
 ;--- Totals
"RTN","RORX015C",97,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"SUMMARY",,REPORT)
"RTN","RORX015C",98,0)
 Q:SECTION<0 SECTION
"RTN","RORX015C",99,0)
 S TMP=$G(@RORTMP@("CPT"))
"RTN","RORX015C",100,0)
 D ADDVAL^RORTSK11(RORTSK,"NC",+$P(TMP,U,1),SECTION)
"RTN","RORX015C",101,0)
 D ADDVAL^RORTSK11(RORTSK,"NDC",+$P(TMP,U,2),SECTION)
"RTN","RORX015C",102,0)
 S TMP=$G(@RORTMP@("PAT"))
"RTN","RORX015C",103,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+TMP,SECTION)
"RTN","RORX015C",104,0)
 ;---
"RTN","RORX015C",105,0)
 Q ECNT
"RTN","RORX016")
0^212^B8402177
"RTN","RORX016",1,0)
RORX016 ;HCIOFO/BH,SG - OUTPATIENT UTILIZATION ; 10/14/05 2:06pm
"RTN","RORX016",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX016",3,0)
 ;
"RTN","RORX016",4,0)
 Q
"RTN","RORX016",5,0)
 ;
"RTN","RORX016",6,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX016",7,0)
 ;
"RTN","RORX016",8,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX016",9,0)
 ;
"RTN","RORX016",10,0)
 ; Return Values:
"RTN","RORX016",11,0)
 ;       <0  Error code
"RTN","RORX016",12,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX016",13,0)
 ;
"RTN","RORX016",14,0)
HEADER(PARTAG) ;
"RTN","RORX016",15,0)
 ;;CLINICS(#,STOP,NAME,NP,NV,NSC)
"RTN","RORX016",16,0)
 ;;HU_STOPS(#,NAME,LAST4,NV,NSC,NDS)
"RTN","RORX016",17,0)
 ;;STOPS(NP,NSC)
"RTN","RORX016",18,0)
 ;
"RTN","RORX016",19,0)
 N HEADER,RC
"RTN","RORX016",20,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX016",21,0)
 Q:HEADER<0 HEADER
"RTN","RORX016",22,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX016",HEADER)
"RTN","RORX016",23,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX016",24,0)
 ;
"RTN","RORX016",25,0)
 ;
"RTN","RORX016",26,0)
 ;***** COMPILES THE "OUTPATIENT UTILIZATION" REPORT
"RTN","RORX016",27,0)
 ; REPORT CODE: 016
"RTN","RORX016",28,0)
 ;
"RTN","RORX016",29,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX016",30,0)
 ;
"RTN","RORX016",31,0)
 ; The ^TMP("RORX016",$J) global node is used by this function.
"RTN","RORX016",32,0)
 ;
"RTN","RORX016",33,0)
 ; ^TMP("RORX016",$J,
"RTN","RORX016",34,0)
 ;
"RTN","RORX016",35,0)
 ;     "OP",             Number of outpatients
"RTN","RORX016",36,0)
 ;       DFN,            Patient's data
"RTN","RORX016",37,0)
 ;                         ^01: Number of stops
"RTN","RORX016",38,0)
 ;                         ^02: Number of different stops
"RTN","RORX016",39,0)
 ;                         ^03: Last 4 digits of SSN
"RTN","RORX016",40,0)
 ;                         ^04: Number of visits
"RTN","RORX016",41,0)
 ;                       Children of this node are KILL'ed by
"RTN","RORX016",42,0)
 ;                       the $$TOTALS^RORX016B function.
"RTN","RORX016",43,0)
 ;         Date,         Number of stops associated with the visit
"RTN","RORX016",44,0)
 ;           StopCode)   Quantity
"RTN","RORX016",45,0)
 ;
"RTN","RORX016",46,0)
 ;     "OPS",            Totals
"RTN","RORX016",47,0)
 ;                         ^01: Total number of stops
"RTN","RORX016",48,0)
 ;                         ^02: Number of different stops
"RTN","RORX016",49,0)
 ;       StopCode,       Name of the Clinic Stop Code
"RTN","RORX016",50,0)
 ;         "P")          Number of patients
"RTN","RORX016",51,0)
 ;         "S")          Quantity
"RTN","RORX016",52,0)
 ;         "V")          Number of visits
"RTN","RORX016",53,0)
 ;
"RTN","RORX016",54,0)
 ;     "OPS1",
"RTN","RORX016",55,0)
 ;       NumOfStops,     Number of patients
"RTN","RORX016",56,0)
 ;         PatientName,
"RTN","RORX016",57,0)
 ;           DFN)
"RTN","RORX016",58,0)
 ;
"RTN","RORX016",59,0)
 ;     "OPV")            Total number of visits
"RTN","RORX016",60,0)
 ;
"RTN","RORX016",61,0)
 ; Return Values:
"RTN","RORX016",62,0)
 ;       <0  Error code
"RTN","RORX016",63,0)
 ;        0  Ok
"RTN","RORX016",64,0)
 ;
"RTN","RORX016",65,0)
OPUTL(RORTSK) ;
"RTN","RORX016",66,0)
 N RORDIV        ; List of division IEN's
"RTN","RORX016",67,0)
 N ROREDT        ; End date
"RTN","RORX016",68,0)
 N RORREG        ; Registry IEN
"RTN","RORX016",69,0)
 N RORSDT        ; Start date
"RTN","RORX016",70,0)
 ;
"RTN","RORX016",71,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX016",72,0)
 S (ECNT,RC)=0  K ^TMP("RORX016",$J)
"RTN","RORX016",73,0)
 ;--- Root node of the report
"RTN","RORX016",74,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX016",75,0)
 Q:REPORT<0 REPORT
"RTN","RORX016",76,0)
 ;
"RTN","RORX016",77,0)
 ;--- Get and prepare the report parameters
"RTN","RORX016",78,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX016",79,0)
 S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0 RC
"RTN","RORX016",80,0)
 ;
"RTN","RORX016",81,0)
 ;--- Report header
"RTN","RORX016",82,0)
 S RC=$$HEADER(REPORT)  Q:RC<0 RC
"RTN","RORX016",83,0)
 ;
"RTN","RORX016",84,0)
 D
"RTN","RORX016",85,0)
 . ;--- Query the registry
"RTN","RORX016",86,0)
 . D TPPSETUP^RORTSK01(70)
"RTN","RORX016",87,0)
 . S RC=$$QUERY^RORX016A(SFLAGS)
"RTN","RORX016",88,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX016",89,0)
 . ;--- Sort the data
"RTN","RORX016",90,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX016",91,0)
 . S RC=$$SORT^RORX016B()
"RTN","RORX016",92,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX016",93,0)
 . ;--- Store the results
"RTN","RORX016",94,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX016",95,0)
 . S RC=$$STORE^RORX016C(REPORT)
"RTN","RORX016",96,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX016",97,0)
 ;
"RTN","RORX016",98,0)
 ;--- Cleanup
"RTN","RORX016",99,0)
 K ^TMP("RORX016",$J)
"RTN","RORX016",100,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX016",101,0)
 ;
"RTN","RORX016",102,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX016",103,0)
 ;
"RTN","RORX016",104,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX016",105,0)
 ;
"RTN","RORX016",106,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX016",107,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX016",108,0)
 ;
"RTN","RORX016",109,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX016",110,0)
 ;               returned via this parameter
"RTN","RORX016",111,0)
 ;
"RTN","RORX016",112,0)
 ; Return Values:
"RTN","RORX016",113,0)
 ;       <0  Error code
"RTN","RORX016",114,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX016",115,0)
 ;
"RTN","RORX016",116,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX016",117,0)
 N PARAMS,TMP
"RTN","RORX016",118,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX016",119,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX016",120,0)
 ;--- Process the list of divisions
"RTN","RORX016",121,0)
 S TMP=$$DIVLST^RORXU006(.RORTSK,PARAMS)
"RTN","RORX016",122,0)
 Q:TMP<0 TMP
"RTN","RORX016",123,0)
 ;--- Additional parameters
"RTN","RORX016",124,0)
 F NAME="MAXUTNUM"  D
"RTN","RORX016",125,0)
 . S TMP=$$PARAM^RORTSK01(NAME)
"RTN","RORX016",126,0)
 . D:TMP'="" ADDVAL^RORTSK11(RORTSK,NAME,TMP,PARAMS)
"RTN","RORX016",127,0)
 ;---
"RTN","RORX016",128,0)
 Q PARAMS
"RTN","RORX016A")
0^209^B9199595
"RTN","RORX016A",1,0)
RORX016A ;HCIOFO/BH,SG - OUTPATIENT UTILIZATION (QUERY) ; 1/23/06 2:11pm
"RTN","RORX016A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX016A",3,0)
 ;
"RTN","RORX016A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX016A",5,0)
 ;
"RTN","RORX016A",6,0)
 ; #557          Read access to the file #40.7 (controlled)
"RTN","RORX016A",7,0)
 ; #2548         ACRP Interface Toolkit (supported)
"RTN","RORX016A",8,0)
 ;
"RTN","RORX016A",9,0)
 Q
"RTN","RORX016A",10,0)
 ;
"RTN","RORX016A",11,0)
 ;***** LOADS AND PROCESSES THE OUTPATIENT DATA
"RTN","RORX016A",12,0)
 ;
"RTN","RORX016A",13,0)
 ; RORDFN        Patient IEN (in file #2)
"RTN","RORX016A",14,0)
 ;
"RTN","RORX016A",15,0)
 ; Return Values:
"RTN","RORX016A",16,0)
 ;       <0  Error code
"RTN","RORX016A",17,0)
 ;        0  Ok
"RTN","RORX016A",18,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX016A",19,0)
 ;
"RTN","RORX016A",20,0)
OPDATA(RORDFN) ;
"RTN","RORX016A",21,0)
 N QUERY,RORDST,RORECNT
"RTN","RORX016A",22,0)
 S RORDST=$NA(^TMP("RORX016",$J))
"RTN","RORX016A",23,0)
 D OPEN^SDQ(.QUERY)
"RTN","RORX016A",24,0)
 D INDEX^SDQ(.QUERY,"PATIENT/DATE","SET")
"RTN","RORX016A",25,0)
 D PAT^SDQ(.QUERY,RORDFN,"SET")
"RTN","RORX016A",26,0)
 D DATE^SDQ(.QUERY,RORSDT,ROREDT1,"SET")
"RTN","RORX016A",27,0)
 D SCANCB^SDQ(.QUERY,"D SCAN^RORX016A(Y,Y0)","SET")
"RTN","RORX016A",28,0)
 D ACTIVE^SDQ(.QUERY,"TRUE","SET")
"RTN","RORX016A",29,0)
 D SCAN^SDQ(.QUERY,"FORWARD")
"RTN","RORX016A",30,0)
 D CLOSE^SDQ(.QUERY)
"RTN","RORX016A",31,0)
 Q +$G(RORECNT)
"RTN","RORX016A",32,0)
 ;
"RTN","RORX016A",33,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX016A",34,0)
 ;
"RTN","RORX016A",35,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX016A",36,0)
 ;
"RTN","RORX016A",37,0)
 ; Return Values:
"RTN","RORX016A",38,0)
 ;       <0  Error code
"RTN","RORX016A",39,0)
 ;        0  Ok
"RTN","RORX016A",40,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX016A",41,0)
 ;
"RTN","RORX016A",42,0)
QUERY(FLAGS) ;
"RTN","RORX016A",43,0)
 N ROREDT1       ; Day after the end date
"RTN","RORX016A",44,0)
 N RORLAST4      ; Last 4 digits of the current patient's SSN
"RTN","RORX016A",45,0)
 N RORPNAME      ; Name of the current patient
"RTN","RORX016A",46,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX016A",47,0)
 ;
"RTN","RORX016A",48,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,TMP,VA,VADM,XREFNODE
"RTN","RORX016A",49,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX016A",50,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX016A",51,0)
 S ROREDT1=$$FMADD^XLFDT(ROREDT,1)
"RTN","RORX016A",52,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX016A",53,0)
 ;--- Browse through the registry records
"RTN","RORX016A",54,0)
 S IEN=0
"RTN","RORX016A",55,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX016A",56,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX016A",57,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX016A",58,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX016A",59,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX016A",60,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX016A",61,0)
 . ;
"RTN","RORX016A",62,0)
 . ;--- Get the patient IEN (DFN)
"RTN","RORX016A",63,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX016A",64,0)
 . ;
"RTN","RORX016A",65,0)
 . ;--- Get the patient's data
"RTN","RORX016A",66,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX016A",67,0)
 . S RORPNAME=VADM(1),RORLAST4=VA("BID")
"RTN","RORX016A",68,0)
 . ;
"RTN","RORX016A",69,0)
 . ;--- Get the outpatient data
"RTN","RORX016A",70,0)
 . S RC=$$OPDATA(PATIEN)
"RTN","RORX016A",71,0)
 . I RC  S ECNT=ECNT+1  Q:RC<0
"RTN","RORX016A",72,0)
 . ;
"RTN","RORX016A",73,0)
 . ;--- Calculate intermediate totals
"RTN","RORX016A",74,0)
 . S RC=$$TOTALS^RORX016B(PATIEN)
"RTN","RORX016A",75,0)
 . I RC  S ECNT=ECNT+1  Q:RC<0
"RTN","RORX016A",76,0)
 ;---
"RTN","RORX016A",77,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX016A",78,0)
 ;
"RTN","RORX016A",79,0)
 ;***** CALLBACK ENTRY POINT FOR ACRP API
"RTN","RORX016A",80,0)
SCAN(Y,Y0) ;
"RTN","RORX016A",81,0)
 N DTX,STOP,TMP
"RTN","RORX016A",82,0)
 ;--- Check the division
"RTN","RORX016A",83,0)
 S TMP=$$PARAM^RORTSK01("DIVISIONS","ALL")
"RTN","RORX016A",84,0)
 I 'TMP  Q:'$D(RORTSK("PARAMS","DIVISIONS","C",+$P(Y0,U,11)))
"RTN","RORX016A",85,0)
 ;--- Data comes from the OUTPATIENT ENCOUNTER file (409.68)
"RTN","RORX016A",86,0)
 S STOP=$P($G(^DIC(40.7,+$P(Y0,U,3),0)),U,2),DTX=Y0\1
"RTN","RORX016A",87,0)
 S:STOP="" STOP="NSC"
"RTN","RORX016A",88,0)
 S @RORDST@("OP",RORDFN,DTX)=$G(@RORDST@("OP",RORDFN,DTX))+1
"RTN","RORX016A",89,0)
 S @RORDST@("OP",RORDFN,DTX,STOP)=$G(@RORDST@("OP",RORDFN,DTX,STOP))+1
"RTN","RORX016A",90,0)
 Q
"RTN","RORX016B")
0^210^B8117035
"RTN","RORX016B",1,0)
RORX016B ;HCIOFO/BH,SG - OUTPATIENT UTILIZATION (SORT) ; 9/14/05 10:08am
"RTN","RORX016B",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX016B",3,0)
 ;
"RTN","RORX016B",4,0)
 Q
"RTN","RORX016B",5,0)
 ;
"RTN","RORX016B",6,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX016B",7,0)
 ;
"RTN","RORX016B",8,0)
 ; Return Values:
"RTN","RORX016B",9,0)
 ;       <0  Error code
"RTN","RORX016B",10,0)
 ;        0  Ok
"RTN","RORX016B",11,0)
 ;
"RTN","RORX016B",12,0)
SORT() ;
"RTN","RORX016B",13,0)
 N I,NDSC,NAME,NODE,NSC,NV,RC,RORBUF,RORMSG,STOP,TMP
"RTN","RORX016B",14,0)
 S NODE=$NA(^TMP("RORX016",$J))  Q:$D(@NODE)<10 0
"RTN","RORX016B",15,0)
 ;--- Outpatient stop codes
"RTN","RORX016B",16,0)
 S RC=$$LOOP^RORTSK01(0)  Q:RC<0 RC
"RTN","RORX016B",17,0)
 S STOP="",(NDSC,NSC)=0
"RTN","RORX016B",18,0)
 F  S STOP=$O(@NODE@("OPS",STOP))  Q:STOP=""  D
"RTN","RORX016B",19,0)
 . S NSC=NSC+$G(@NODE@("OPS",STOP,"S")),NDSC=NDSC+1
"RTN","RORX016B",20,0)
 . D FIND^DIC(40.7,,"@;.01","UX",STOP,1,"C",,,"RORBUF","RORMSG")
"RTN","RORX016B",21,0)
 . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,40.7)
"RTN","RORX016B",22,0)
 . S NAME=$G(RORBUF("DILIST","ID",1,.01))  K RORBUF
"RTN","RORX016B",23,0)
 . S @NODE@("OPS",STOP)=$S(NAME'="":NAME,1:"Unknown")
"RTN","RORX016B",24,0)
 S @NODE@("OPS")=NSC_U_NDSC
"RTN","RORX016B",25,0)
 ;---
"RTN","RORX016B",26,0)
 Q 0
"RTN","RORX016B",27,0)
 ;
"RTN","RORX016B",28,0)
 ;***** CALCULATES THE INTERMEDIATE TOTALS
"RTN","RORX016B",29,0)
 ;
"RTN","RORX016B",30,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX016B",31,0)
 ; CATSUB        Category subscript in the temporary global
"RTN","RORX016B",32,0)
 ;
"RTN","RORX016B",33,0)
 ; Return Values:
"RTN","RORX016B",34,0)
 ;       <0  Error code
"RTN","RORX016B",35,0)
 ;        0  Ok
"RTN","RORX016B",36,0)
 ;
"RTN","RORX016B",37,0)
TOTALS(PATIEN) ;
"RTN","RORX016B",38,0)
 N NODE,TMP
"RTN","RORX016B",39,0)
 S NODE=$NA(^TMP("RORX016",$J))
"RTN","RORX016B",40,0)
 ;
"RTN","RORX016B",41,0)
 ;=== Outpatient data
"RTN","RORX016B",42,0)
 D:$D(@NODE@("OP",PATIEN))>1
"RTN","RORX016B",43,0)
 . N DATE,NDSC,NPSC,NSC,NV,NVSC,SCLST,STOP
"RTN","RORX016B",44,0)
 . S @NODE@("OP")=$G(@NODE@("OP"))+1
"RTN","RORX016B",45,0)
 . ;---
"RTN","RORX016B",46,0)
 . S (DATE,NPSC,NV)=0
"RTN","RORX016B",47,0)
 . F  S DATE=$O(@NODE@("OP",PATIEN,DATE))  Q:DATE'>0  D
"RTN","RORX016B",48,0)
 . . S NV=NV+1                              ; Number of visits
"RTN","RORX016B",49,0)
 . . S NVSC=@NODE@("OP",PATIEN,DATE)        ; Number of visist's stops
"RTN","RORX016B",50,0)
 . . ;--- Count the patient's stops
"RTN","RORX016B",51,0)
 . . S STOP=""
"RTN","RORX016B",52,0)
 . . F  S STOP=$O(@NODE@("OP",PATIEN,DATE,STOP))  Q:STOP=""  D
"RTN","RORX016B",53,0)
 . . . S NSC=@NODE@("OP",PATIEN,DATE,STOP)  ; Number of stops
"RTN","RORX016B",54,0)
 . . . S @NODE@("OPS",STOP,"S")=$G(@NODE@("OPS",STOP,"S"))+NSC
"RTN","RORX016B",55,0)
 . . . S @NODE@("OPS",STOP,"V")=$G(@NODE@("OPS",STOP,"V"))+(NSC/NVSC)
"RTN","RORX016B",56,0)
 . . . S SCLST(STOP)=""
"RTN","RORX016B",57,0)
 . . S NPSC=NPSC+NVSC                       ; Total number of stops
"RTN","RORX016B",58,0)
 . K @NODE@("OP",PATIEN)
"RTN","RORX016B",59,0)
 . ;--- Count the different stops and patients
"RTN","RORX016B",60,0)
 . S STOP="",NDSC=0
"RTN","RORX016B",61,0)
 . F  S STOP=$O(SCLST(STOP))  Q:STOP=""  D
"RTN","RORX016B",62,0)
 . . S @NODE@("OPS",STOP,"P")=$G(@NODE@("OPS",STOP,"P"))+1
"RTN","RORX016B",63,0)
 . . S NDSC=NDSC+1                          ; Number of diff. stops
"RTN","RORX016B",64,0)
 . ;--- Count the visits
"RTN","RORX016B",65,0)
 . S:NV>0 @NODE@("OPV")=$G(@NODE@("OPV"))+NV
"RTN","RORX016B",66,0)
 . ;--- Count the stop codes
"RTN","RORX016B",67,0)
 . D:NPSC>0
"RTN","RORX016B",68,0)
 . . S @NODE@("OP",PATIEN)=NPSC_U_NDSC_U_$G(VA("BID"))_U_NV
"RTN","RORX016B",69,0)
 . . S @NODE@("OPS1",NPSC)=$G(@NODE@("OPS1",NPSC))+1
"RTN","RORX016B",70,0)
 . . S @NODE@("OPS1",NPSC,RORPNAME,PATIEN)=""
"RTN","RORX016B",71,0)
 Q 0
"RTN","RORX016C")
0^211^B17593055
"RTN","RORX016C",1,0)
RORX016C ;HCIOFO/BH,SG - OUTPATIENT UTILIZATION (STORE) ; 9/14/05 9:43am
"RTN","RORX016C",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORX016C",3,0)
 ;
"RTN","RORX016C",4,0)
 Q
"RTN","RORX016C",5,0)
 ;
"RTN","RORX016C",6,0)
 ;***** HIGHEST UTILIZATION
"RTN","RORX016C",7,0)
 ;
"RTN","RORX016C",8,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX016C",9,0)
 ;
"RTN","RORX016C",10,0)
 ; RORNODE       Closed root of the section in the temporary global
"RTN","RORX016C",11,0)
 ;
"RTN","RORX016C",12,0)
 ; Return Values:
"RTN","RORX016C",13,0)
 ;       <0  Error code
"RTN","RORX016C",14,0)
 ;        0  Ok
"RTN","RORX016C",15,0)
 ;
"RTN","RORX016C",16,0)
HIGHUTIL(PRNTELMT,RORNODE) ;
"RTN","RORX016C",17,0)
 N BUF,COUNT,DFN,I,ITEM,NAME,NUM,RC,RORMAXUT,RORTCNT,SECTION,TABLE,TMP
"RTN","RORX016C",18,0)
 S RORMAXUT=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX016C",19,0)
 Q:RORMAXUT'>0 0
"RTN","RORX016C",20,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"HIGHUTIL",,PRNTELMT)
"RTN","RORX016C",21,0)
 Q:SECTION<0 SECTION
"RTN","RORX016C",22,0)
 S (RC,RORTCNT)=0
"RTN","RORX016C",23,0)
 ;--- Stops
"RTN","RORX016C",24,0)
 I $D(@RORNODE@("OPS1"))>1  D  Q:RC<0 RC
"RTN","RORX016C",25,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"HU_STOPS",,SECTION)
"RTN","RORX016C",26,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX016C",27,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","HU_STOPS")
"RTN","RORX016C",28,0)
 . S RORTCNT=RORTCNT+1
"RTN","RORX016C",29,0)
 . ;---
"RTN","RORX016C",30,0)
 . S NUM="",(COUNT,RC)=0
"RTN","RORX016C",31,0)
 . F  S NUM=$O(@RORNODE@("OPS1",NUM),-1)  Q:NUM=""  D  Q:RC
"RTN","RORX016C",32,0)
 . . S NAME=""
"RTN","RORX016C",33,0)
 . . F  S NAME=$O(@RORNODE@("OPS1",NUM,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX016C",34,0)
 . . . S DFN=""
"RTN","RORX016C",35,0)
 . . . F  S DFN=$O(@RORNODE@("OPS1",NUM,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX016C",36,0)
 . . . . S COUNT=COUNT+1  I COUNT>RORMAXUT  S RC=1  Q
"RTN","RORX016C",37,0)
 . . . . S BUF=$G(@RORNODE@("OP",DFN))
"RTN","RORX016C",38,0)
 . . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX016C",39,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX016C",40,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(BUF,U,3),ITEM,2)
"RTN","RORX016C",41,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NV",+$P(BUF,U,4),ITEM,3)
"RTN","RORX016C",42,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NSC",NUM,ITEM,3)
"RTN","RORX016C",43,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NDS",+$P(BUF,U,2),ITEM,3)
"RTN","RORX016C",44,0)
 ;--- Disable the empty section
"RTN","RORX016C",45,0)
 D:RORTCNT'>0 UPDVAL^RORTSK11(RORTSK,SECTION,"",,1)
"RTN","RORX016C",46,0)
 Q 0
"RTN","RORX016C",47,0)
 ;
"RTN","RORX016C",48,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX016C",49,0)
 ;
"RTN","RORX016C",50,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX016C",51,0)
 ;
"RTN","RORX016C",52,0)
 ; Return Values:
"RTN","RORX016C",53,0)
 ;       <0  Error code
"RTN","RORX016C",54,0)
 ;        0  Ok
"RTN","RORX016C",55,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX016C",56,0)
 ;
"RTN","RORX016C",57,0)
STORE(REPORT) ;
"RTN","RORX016C",58,0)
 N RORSONLY      ; Output summary only
"RTN","RORX016C",59,0)
 ;
"RTN","RORX016C",60,0)
 N ECNT,NODE,RC,TMP
"RTN","RORX016C",61,0)
 S NODE=$NA(^TMP("RORX016",$J))
"RTN","RORX016C",62,0)
 Q:$D(@NODE)<10 0
"RTN","RORX016C",63,0)
 S RORSONLY=$$SMRYONLY^RORXU006(),(ECNT,RC)=0
"RTN","RORX016C",64,0)
 ;--- Outpatients
"RTN","RORX016C",65,0)
 S RC=$$LOOP^RORTSK01(0)    Q:RC<0 RC
"RTN","RORX016C",66,0)
 S RC=$$STOREOP(REPORT,NODE)
"RTN","RORX016C",67,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+1
"RTN","RORX016C",68,0)
 ;--- Highest utilization
"RTN","RORX016C",69,0)
 S RC=$$LOOP^RORTSK01(0.5)  Q:RC<0 RC
"RTN","RORX016C",70,0)
 S RC=$$HIGHUTIL(REPORT,NODE)
"RTN","RORX016C",71,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+1
"RTN","RORX016C",72,0)
 ;---
"RTN","RORX016C",73,0)
 Q ECNT
"RTN","RORX016C",74,0)
 ;
"RTN","RORX016C",75,0)
 ;***** OUTPATIENT DATA
"RTN","RORX016C",76,0)
 ;
"RTN","RORX016C",77,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX016C",78,0)
 ;
"RTN","RORX016C",79,0)
 ; NODE          Closed root of the category section
"RTN","RORX016C",80,0)
 ;               in the temporary global
"RTN","RORX016C",81,0)
 ;
"RTN","RORX016C",82,0)
 ; Return Values:
"RTN","RORX016C",83,0)
 ;       <0  Error code
"RTN","RORX016C",84,0)
 ;        0  Ok
"RTN","RORX016C",85,0)
 ;
"RTN","RORX016C",86,0)
STOREOP(PRNTELMT,NODE) ;
"RTN","RORX016C",87,0)
 Q:$D(@NODE@("OP"))<10 0
"RTN","RORX016C",88,0)
 N ITEM,NSC,NV,RC,SECTION,STOP,TABLE,TMP
"RTN","RORX016C",89,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"OUTPATIENTS",,PRNTELMT)
"RTN","RORX016C",90,0)
 Q:SECTION<0 SECTION
"RTN","RORX016C",91,0)
 S RC=0
"RTN","RORX016C",92,0)
 ;--- Stop codes
"RTN","RORX016C",93,0)
 I $D(@NODE@("OPS1"))>1  D  Q:RC<0 RC
"RTN","RORX016C",94,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"STOPS",,SECTION)
"RTN","RORX016C",95,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX016C",96,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","STOPS")
"RTN","RORX016C",97,0)
 . S NSC=""
"RTN","RORX016C",98,0)
 . F  S NSC=$O(@NODE@("OPS1",NSC),-1)  Q:NSC=""  D
"RTN","RORX016C",99,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"ITEM",,TABLE)
"RTN","RORX016C",100,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NP",$P(@NODE@("OPS1",NSC),U),ITEM,3)
"RTN","RORX016C",101,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NSC",NSC,ITEM,3)
"RTN","RORX016C",102,0)
 ;--- Clinics
"RTN","RORX016C",103,0)
 I $D(@NODE@("OPS"))>1  D  Q:RC<0 RC
"RTN","RORX016C",104,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"CLINICS",,SECTION)
"RTN","RORX016C",105,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX016C",106,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","CLINICS")
"RTN","RORX016C",107,0)
 . S STOP=""
"RTN","RORX016C",108,0)
 . F  S STOP=$O(@NODE@("OPS",STOP))  Q:STOP=""  D
"RTN","RORX016C",109,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"CLINIC",,TABLE)
"RTN","RORX016C",110,0)
 . . D ADDVAL^RORTSK11(RORTSK,"STOP",STOP,ITEM,3)
"RTN","RORX016C",111,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NAME",$P(@NODE@("OPS",STOP),U),ITEM,1)
"RTN","RORX016C",112,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NP",+$G(@NODE@("OPS",STOP,"P")),ITEM,3)
"RTN","RORX016C",113,0)
 . . S TMP=+$G(@NODE@("OPS",STOP,"V"))
"RTN","RORX016C",114,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NV",$J(TMP,0,2),ITEM,3)
"RTN","RORX016C",115,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NSC",+$G(@NODE@("OPS",STOP,"S")),ITEM,3)
"RTN","RORX016C",116,0)
 ;--- Summary
"RTN","RORX016C",117,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+$G(@NODE@("OP")),SECTION)
"RTN","RORX016C",118,0)
 D ADDVAL^RORTSK11(RORTSK,"NV",+$G(@NODE@("OPV")),SECTION)
"RTN","RORX016C",119,0)
 D ADDVAL^RORTSK11(RORTSK,"NSC",+$G(@NODE@("OPS")),SECTION)
"RTN","RORX016C",120,0)
 Q 0
"RTN","RORXU001")
0^190^B13475252
"RTN","RORXU001",1,0)
RORXU001 ;HCIOFO/BH,SG - REPORT UTILITIES  ; 1/24/06 8:14am
"RTN","RORXU001",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORXU001",3,0)
 ;
"RTN","RORXU001",4,0)
 ; This routine uses the following IAs:
"RTN","RORXU001",5,0)
 ;
"RTN","RORXU001",6,0)
 ; #92           Read access to the file #45 (controlled)
"RTN","RORXU001",7,0)
 ;               fields 3 and 4.
"RTN","RORXU001",8,0)
 ; #1480         Read access to the file #405 (controlled)
"RTN","RORXU001",9,0)
 ; #1894         ENCEVENT^PXKENC (controlled)
"RTN","RORXU001",10,0)
 ;
"RTN","RORXU001",11,0)
 Q
"RTN","RORXU001",12,0)
 ;
"RTN","RORXU001",13,0)
 ;***** DOUBLE CHECKS THE ADMISSION
"RTN","RORXU001",14,0)
 ;
"RTN","RORXU001",15,0)
 ; DFN           Patient IEN
"RTN","RORXU001",16,0)
 ; VAINDT        Admission date
"RTN","RORXU001",17,0)
 ; .DISDT        Discharge date
"RTN","RORXU001",18,0)
 ;
"RTN","RORXU001",19,0)
 ; Return Values:
"RTN","RORXU001",20,0)
 ;        0  Ok
"RTN","RORXU001",21,0)
 ;        1  Invalid admission date
"RTN","RORXU001",22,0)
 ;
"RTN","RORXU001",23,0)
CHKADM(DFN,VAINDT,DISDT) ;
"RTN","RORXU001",24,0)
 N IEN,RORMSG,VADMVT,VAHOW,VAROOT
"RTN","RORXU001",25,0)
 D ADM^VADPT2  Q:'VADMVT 1
"RTN","RORXU001",26,0)
 S IEN=+$$GET1^DIQ(405,VADMVT,.17,"I",,"RORMSG")
"RTN","RORXU001",27,0)
 S:IEN>0 DISDT=$$GET1^DIQ(405,IEN_",",.01,"I",,"RORMSG")
"RTN","RORXU001",28,0)
 Q 0
"RTN","RORXU001",29,0)
 ;
"RTN","RORXU001",30,0)
 ;***** DATE OF THE MOST RECENT VISIT TO ANY OF THE SELECTED CLINICS
"RTN","RORXU001",31,0)
 ;
"RTN","RORXU001",32,0)
 ; PATIEN        Patient IEN (file #2)
"RTN","RORXU001",33,0)
 ;
"RTN","RORXU001",34,0)
 ; .RORCLIN      Reference to a local array of Clinics, the subscripts
"RTN","RORXU001",35,0)
 ;               are IEN's from file #44 or will be a single element
"RTN","RORXU001",36,0)
 ;               array with a subscript of "ALL", which will denote
"RTN","RORXU001",37,0)
 ;               all clinics (i.e. CLIN("ALL")="").
"RTN","RORXU001",38,0)
 ;
"RTN","RORXU001",39,0)
 ; Return Values:
"RTN","RORXU001",40,0)
 ;        0  The patient has never been seen at any of the given
"RTN","RORXU001",41,0)
 ;           clinics
"RTN","RORXU001",42,0)
 ;       >0  Date of the most recent visit to one of the selected
"RTN","RORXU001",43,0)
 ;           clinics
"RTN","RORXU001",44,0)
 ;
"RTN","RORXU001",45,0)
LASTVSIT(PATIEN,RORCLIN) ;
"RTN","RORXU001",46,0)
 N QUERY,RORDT,RORLAST
"RTN","RORXU001",47,0)
 S RORDT=$$FMADD^XLFDT($$DT^XLFDT,1),RORLAST=0
"RTN","RORXU001",48,0)
 ;---
"RTN","RORXU001",49,0)
 D OPEN^SDQ(.QUERY)
"RTN","RORXU001",50,0)
 D INDEX^SDQ(.QUERY,"PATIENT","SET")
"RTN","RORXU001",51,0)
 D PAT^SDQ(.QUERY,PATIEN,"SET")
"RTN","RORXU001",52,0)
 D SCANCB^SDQ(.QUERY,"D SDQSCAN2^RORXU001(Y,Y0)","SET")
"RTN","RORXU001",53,0)
 D ACTIVE^SDQ(.QUERY,"TRUE","SET")
"RTN","RORXU001",54,0)
 D SCAN^SDQ(.QUERY,"FORWARD")
"RTN","RORXU001",55,0)
 D CLOSE^SDQ(.QUERY)
"RTN","RORXU001",56,0)
 ;---
"RTN","RORXU001",57,0)
 Q RORLAST
"RTN","RORXU001",58,0)
 ;
"RTN","RORXU001",59,0)
 ;***** LOADS PTF DATA AND CHECKS IF THE RECORD SHOULD BE SKIPPED
"RTN","RORXU001",60,0)
 ;
"RTN","RORXU001",61,0)
 ; PTFIEN        IEN of the PTF record
"RTN","RORXU001",62,0)
 ;
"RTN","RORXU001",63,0)
 ; [FLAGS]       Flags to control processing
"RTN","RORXU001",64,0)
 ;                 F  Skip fee-basis records
"RTN","RORXU001",65,0)
 ;                 P  Skip non-PTF records
"RTN","RORXU001",66,0)
 ;
"RTN","RORXU001",67,0)
 ; [.ADMDT]      Admission date is returned via this parameter
"RTN","RORXU001",68,0)
 ; [.DISDT]      Discharge date is returned via this parameter
"RTN","RORXU001",69,0)
 ; [.SUFFIX]     Suffix is returned via this parameter
"RTN","RORXU001",70,0)
 ; [.STATUS]     Status is returned via this parameter
"RTN","RORXU001",71,0)
 ; [.FACILITY]   Facility number is returned via this parameter
"RTN","RORXU001",72,0)
 ;
"RTN","RORXU001",73,0)
 ; Return Values:
"RTN","RORXU001",74,0)
 ;       <0  Error code
"RTN","RORXU001",75,0)
 ;        0  Ok
"RTN","RORXU001",76,0)
 ;        1  Skip this record
"RTN","RORXU001",77,0)
 ;
"RTN","RORXU001",78,0)
PTF(PTFIEN,FLAGS,ADMDT,DISDT,SUFFIX,STATUS,FACILITY) ;
"RTN","RORXU001",79,0)
 N FLDLST,IENS,RORBUF,RORMSG
"RTN","RORXU001",80,0)
 S FLAGS=$G(FLAGS),IENS=(+PTFIEN)_","
"RTN","RORXU001",81,0)
 S FLDLST="2;3;5;6;70"
"RTN","RORXU001",82,0)
 S:FLAGS["F" FLDLST=FLDLST_";4"        ; FEE BASIS
"RTN","RORXU001",83,0)
 S:FLAGS["P" FLDLST=FLDLST_";11"       ; TYPE OF RECORD
"RTN","RORXU001",84,0)
 ;--- Load the data
"RTN","RORXU001",85,0)
 D GETS^DIQ(45,IENS,FLDLST,"I","RORBUF","RORMSG")
"RTN","RORXU001",86,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,45,IENS)
"RTN","RORXU001",87,0)
 ;---
"RTN","RORXU001",88,0)
 S ADMDT=$G(RORBUF(45,IENS,2,"I"))     ; ADMISSION DATE
"RTN","RORXU001",89,0)
 S FACILITY=$G(RORBUF(45,IENS,3,"I"))  ; FACILITY
"RTN","RORXU001",90,0)
 S SUFFIX=$G(RORBUF(45,IENS,5,"I"))    ; SUFFIX
"RTN","RORXU001",91,0)
 S STATUS=$G(RORBUF(45,IENS,6,"I"))    ; STATUS
"RTN","RORXU001",92,0)
 S DISDT=$G(RORBUF(45,IENS,70,"I"))    ; DISCHARGE DATE
"RTN","RORXU001",93,0)
 Q:ADMDT'>0 1
"RTN","RORXU001",94,0)
 ;--- Skip a non-PTF record
"RTN","RORXU001",95,0)
 I FLAGS["P"  Q:$G(RORBUF(45,IENS,11,"I"))'=1 1
"RTN","RORXU001",96,0)
 ;--- Skip a fee basis record
"RTN","RORXU001",97,0)
 I FLAGS["F"  Q:$G(RORBUF(45,IENS,4,"I")) 1
"RTN","RORXU001",98,0)
 ;--- Success
"RTN","RORXU001",99,0)
 Q 0
"RTN","RORXU001",100,0)
 ;
"RTN","RORXU001",101,0)
 ;**** CALL-BACK ENTRY POINTS FOR THE SDQ API
"RTN","RORXU001",102,0)
SDQSCAN1(Y,Y0) ;
"RTN","RORXU001",103,0)
 N TMP
"RTN","RORXU001",104,0)
 ;--- Check the clinic
"RTN","RORXU001",105,0)
 I '$$PARAM^RORTSK01("CLINICS","ALL")  D  Q:'TMP
"RTN","RORXU001",106,0)
 . S TMP=$D(RORTSK("PARAMS","CLINICS","C",+$P(Y0,U,4)))
"RTN","RORXU001",107,0)
 ;--- Count the encounters
"RTN","RORXU001",108,0)
 S RORENCNT=RORENCNT+1
"RTN","RORXU001",109,0)
 Q
"RTN","RORXU001",110,0)
 ;
"RTN","RORXU001",111,0)
SDQSCAN2(Y,Y0) ;
"RTN","RORXU001",112,0)
 N DTX,TMP
"RTN","RORXU001",113,0)
 ;--- Check the clinic
"RTN","RORXU001",114,0)
 I '$$PARAM^RORTSK01("CLINICS","ALL")  D  Q:'TMP
"RTN","RORXU001",115,0)
 . S TMP=$D(RORTSK("PARAMS","CLINICS","C",+$P(Y0,U,4)))
"RTN","RORXU001",116,0)
 ;--- Date of the visit
"RTN","RORXU001",117,0)
 S DTX=+$P(Y0,U)  S:(DTX>RORLAST)&(DTX<RORDT) RORLAST=DTX
"RTN","RORXU001",118,0)
 Q
"RTN","RORXU001",119,0)
 ;
"RTN","RORXU001",120,0)
 ;***** CHECKS IF THE PATIENT WAS SEEN AT SELECTED CLINICS
"RTN","RORXU001",121,0)
 ;
"RTN","RORXU001",122,0)
 ; RORSDT        Start Date for search (FileMan).
"RTN","RORXU001",123,0)
 ;               Time is ignored and the beginning of the day is
"RTN","RORXU001",124,0)
 ;               considered as the boundary (ST\1).
"RTN","RORXU001",125,0)
 ;
"RTN","RORXU001",126,0)
 ; ROREDT        End Date for search (FileMan).
"RTN","RORXU001",127,0)
 ;               Time is ignored and the end of the day is
"RTN","RORXU001",128,0)
 ;               considered as the boundary (ED\1+1).
"RTN","RORXU001",129,0)
 ;
"RTN","RORXU001",130,0)
 ; PATIEN        Patient IEN (file #2)
"RTN","RORXU001",131,0)
 ;
"RTN","RORXU001",132,0)
 ; Return Values:
"RTN","RORXU001",133,0)
 ;        0  The patient was not seen at any of the given clinics
"RTN","RORXU001",134,0)
 ;           during the provided time frame
"RTN","RORXU001",135,0)
 ;        1  The patient was seen
"RTN","RORXU001",136,0)
 ; 
"RTN","RORXU001",137,0)
SEEN(RORSDT,ROREDT,PATIEN) ;
"RTN","RORXU001",138,0)
 N QUERY,RORENCNT
"RTN","RORXU001",139,0)
 S RORENCNT=0
"RTN","RORXU001",140,0)
 ;---
"RTN","RORXU001",141,0)
 D OPEN^SDQ(.QUERY)
"RTN","RORXU001",142,0)
 D INDEX^SDQ(.QUERY,"PATIENT/DATE","SET")
"RTN","RORXU001",143,0)
 D PAT^SDQ(.QUERY,PATIEN,"SET")
"RTN","RORXU001",144,0)
 D DATE^SDQ(.QUERY,RORSDT\1,$$FMADD^XLFDT(ROREDT\1,1),"SET")
"RTN","RORXU001",145,0)
 D SCANCB^SDQ(.QUERY,"D SDQSCAN1^RORXU001(Y,Y0)","SET")
"RTN","RORXU001",146,0)
 D ACTIVE^SDQ(.QUERY,"TRUE","SET")
"RTN","RORXU001",147,0)
 D SCAN^SDQ(.QUERY,"FORWARD")
"RTN","RORXU001",148,0)
 D CLOSE^SDQ(.QUERY)
"RTN","RORXU001",149,0)
 ;---
"RTN","RORXU001",150,0)
 Q (RORENCNT>0)
"RTN","RORXU002")
0^7^B52378499
"RTN","RORXU002",1,0)
RORXU002 ;HCIOFO/SG - REPORT BUILDER UTILITIES ; 10/25/05 9:01am
"RTN","RORXU002",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORXU002",3,0)
 ;
"RTN","RORXU002",4,0)
 Q
"RTN","RORXU002",5,0)
 ;
"RTN","RORXU002",6,0)
 ;***** SCANS THE TABLE DEFINITION (RORSRC) FOR COLUMN NAMES
"RTN","RORXU002",7,0)
 ;
"RTN","RORXU002",8,0)
 ; .TERM         Reference to a local variable where
"RTN","RORXU002",9,0)
 ;               is terminator is returned
"RTN","RORXU002",10,0)
 ;
"RTN","RORXU002",11,0)
 ; Return Values:
"RTN","RORXU002",12,0)
 ;       ""  End of definition
"RTN","RORXU002",13,0)
 ;      ...  Name of the column
"RTN","RORXU002",14,0)
 ;
"RTN","RORXU002",15,0)
COLSCAN(TERM) ;
"RTN","RORXU002",16,0)
 N CH,I,TOKEN
"RTN","RORXU002",17,0)
 F I=1:1  S TERM=$E(RORSRC,I)  Q:"(,)"[TERM
"RTN","RORXU002",18,0)
 S TOKEN=$E(RORSRC,1,I-1)
"RTN","RORXU002",19,0)
 F I=I+1:1  S CH=$E(RORSRC,I)  Q:(CH="")!("(,)"'[CH)
"RTN","RORXU002",20,0)
 S $E(RORSRC,1,I-1)=""
"RTN","RORXU002",21,0)
 Q TOKEN
"RTN","RORXU002",22,0)
 ;
"RTN","RORXU002",23,0)
 ;***** CHECKS THE FILEMAN DATE/TIME VALUE
"RTN","RORXU002",24,0)
DATE(DT) ;
"RTN","RORXU002",25,0)
 Q $S(DT>0:+DT,1:"")
"RTN","RORXU002",26,0)
 ;
"RTN","RORXU002",27,0)
 ;***** OUTPUTS THE BASIC HEADER TO THE REPORT
"RTN","RORXU002",28,0)
 ;
"RTN","RORXU002",29,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU002",30,0)
 ;
"RTN","RORXU002",31,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU002",32,0)
 ;
"RTN","RORXU002",33,0)
 ; Return Values:
"RTN","RORXU002",34,0)
 ;       <0  Error code
"RTN","RORXU002",35,0)
 ;       >0  IEN of the HEADER element
"RTN","RORXU002",36,0)
 ;
"RTN","RORXU002",37,0)
HEADER(RORTSK,PARTAG) ;
"RTN","RORXU002",38,0)
 N HEADER,IENS,REGIEN,RORBUF,RORMSG,TMP
"RTN","RORXU002",39,0)
 S HEADER=$$ADDVAL^RORTSK11(RORTSK,"HEADER",,PARTAG)
"RTN","RORXU002",40,0)
 Q:HEADER<0 HEADER
"RTN","RORXU002",41,0)
 D ADDVAL^RORTSK11(RORTSK,"DATE",$$DATE($$NOW^XLFDT),HEADER)
"RTN","RORXU002",42,0)
 D ADDVAL^RORTSK11(RORTSK,"TASK_NUMBER",RORTSK,HEADER)
"RTN","RORXU002",43,0)
 S REGIEN=+$$PARAM^RORTSK01("REGIEN")
"RTN","RORXU002",44,0)
 ;---
"RTN","RORXU002",45,0)
 S IENS=REGIEN_","
"RTN","RORXU002",46,0)
 D GETS^DIQ(798.1,IENS,"1;2","I","RORBUF","RORMSG")
"RTN","RORXU002",47,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","RORXU002",48,0)
 S TMP=$G(RORBUF(798.1,IENS,1,"I"))
"RTN","RORXU002",49,0)
 D ADDVAL^RORTSK11(RORTSK,"UPDATED_UNTIL",$$DATE(TMP),HEADER)
"RTN","RORXU002",50,0)
 S TMP=$G(RORBUF(798.1,IENS,2,"I"))
"RTN","RORXU002",51,0)
 D ADDVAL^RORTSK11(RORTSK,"EXTRACTED_UNTIL",$$DATE(TMP),HEADER)
"RTN","RORXU002",52,0)
 Q HEADER
"RTN","RORXU002",53,0)
 ;
"RTN","RORXU002",54,0)
 ;***** PARSES THE COMMA-SEPARATED LIST
"RTN","RORXU002",55,0)
 ;
"RTN","RORXU002",56,0)
 ; .LIST         Reference to a local variable that contains a list.
"RTN","RORXU002",57,0)
 ;               Items of the list are returned as the subscripts of
"RTN","RORXU002",58,0)
 ;               this variable.
"RTN","RORXU002",59,0)
 ;
"RTN","RORXU002",60,0)
LIST(LIST) ;
"RTN","RORXU002",61,0)
 N I,TMP,VAL
"RTN","RORXU002",62,0)
 F I=1:1  S VAL=$P(LIST,",",I)  Q:VAL=""  D
"RTN","RORXU002",63,0)
 . S TMP=$$TRIM^XLFSTR(VAL)
"RTN","RORXU002",64,0)
 . S:TMP'="" LIST(TMP)=""
"RTN","RORXU002",65,0)
 Q
"RTN","RORXU002",66,0)
 ;
"RTN","RORXU002",67,0)
 ;***** COMPILES A TEXT DESCRIPTION FOR THE REPORT OPTIONS
"RTN","RORXU002",68,0)
 ;
"RTN","RORXU002",69,0)
 ; .OPTIONS      Reference to a local variable containing
"RTN","RORXU002",70,0)
 ;               the options as subscripts
"RTN","RORXU002",71,0)
 ;
"RTN","RORXU002",72,0)
 ; [DLGNUM]      Number of the dialog that contains the template
"RTN","RORXU002",73,0)
 ;               (7980000.018, by default).
"RTN","RORXU002",74,0)
 ;
"RTN","RORXU002",75,0)
 ; Return Values:
"RTN","RORXU002",76,0)
 ;      ...  Text description of the options
"RTN","RORXU002",77,0)
 ;
"RTN","RORXU002",78,0)
OPTXT(OPTIONS,DLGNUM) ;
"RTN","RORXU002",79,0)
 N I,J,NS,RORBUF,TEXT,TMP
"RTN","RORXU002",80,0)
 S:$G(DLGNUM)'>0 DLGNUM=7980000.018
"RTN","RORXU002",81,0)
 D BLD^DIALOG(DLGNUM,,,"RORBUF")
"RTN","RORXU002",82,0)
 S TEXT="",I=0
"RTN","RORXU002",83,0)
 F  S I=$O(RORBUF(I))  Q:I=""  D:$E(RORBUF(I),1)'=" "
"RTN","RORXU002",84,0)
 . S NS=0
"RTN","RORXU002",85,0)
 . F J=1:1  S TMP=$TR($P(RORBUF(I),",",J)," ")  Q:TMP=""  D
"RTN","RORXU002",86,0)
 . . S:$D(OPTIONS(TMP)) NS=2**(J-1)+NS
"RTN","RORXU002",87,0)
 . Q:'NS
"RTN","RORXU002",88,0)
 . S TMP=$$TRIM^XLFSTR($G(RORBUF(I+NS)))
"RTN","RORXU002",89,0)
 . S:TMP'="" TEXT=TEXT_", "_TMP
"RTN","RORXU002",90,0)
 Q $P(TEXT,", ",2,999)
"RTN","RORXU002",91,0)
 ;
"RTN","RORXU002",92,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORXU002",93,0)
 ;
"RTN","RORXU002",94,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU002",95,0)
 ;
"RTN","RORXU002",96,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU002",97,0)
 ;
"RTN","RORXU002",98,0)
 ; .STDT         Start and end dates of the report
"RTN","RORXU002",99,0)
 ; .ENDT         are returned via these parameters
"RTN","RORXU002",100,0)
 ;
"RTN","RORXU002",101,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are returned via this
"RTN","RORXU002",102,0)
 ;               parameter. The "D" (skip deceased patients) and "G"
"RTN","RORXU002",103,0)
 ;               (skip pending patients) flags are always added.
"RTN","RORXU002",104,0)
 ;
"RTN","RORXU002",105,0)
 ; Return Values:
"RTN","RORXU002",106,0)
 ;       <0  Error code
"RTN","RORXU002",107,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORXU002",108,0)
 ;
"RTN","RORXU002",109,0)
PARAMS(RORTSK,PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORXU002",110,0)
 N BUF,ELEMENT,I,LTAG,NAME,PARAMS,RC,REGIEN,RORMSG,TMP
"RTN","RORXU002",111,0)
 S PARAMS=$$ADDVAL^RORTSK11(RORTSK,"PARAMETERS",,PARTAG)
"RTN","RORXU002",112,0)
 S RC=0,(ENDT,STDT)="",FLAGS=""
"RTN","RORXU002",113,0)
 ;
"RTN","RORXU002",114,0)
 ;=== Registry name
"RTN","RORXU002",115,0)
 S REGIEN=+$$PARAM^RORTSK01("REGIEN")
"RTN","RORXU002",116,0)
 I REGIEN>0  D  Q:RC<0 RC
"RTN","RORXU002",117,0)
 . S TMP=$P($$REGNAME^RORUTL01(REGIEN),U)
"RTN","RORXU002",118,0)
 . I TMP=""  S RC=-1  Q
"RTN","RORXU002",119,0)
 . S RC=$$ADDVAL^RORTSK11(RORTSK,"REGNAME",TMP,PARAMS)
"RTN","RORXU002",120,0)
 ;
"RTN","RORXU002",121,0)
 ;=== Alternate date ranges
"RTN","RORXU002",122,0)
 F I=2:1:3  D  Q:RC<0
"RTN","RORXU002",123,0)
 . S STDT=$$PARAM^RORTSK01("DATE_RANGE_"_I,"START")\1  Q:STDT'>0
"RTN","RORXU002",124,0)
 . S ENDT=$$PARAM^RORTSK01("DATE_RANGE_"_I,"END")\1    Q:ENDT'>0
"RTN","RORXU002",125,0)
 . S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,"DATE_RANGE_"_I,,PARAMS)
"RTN","RORXU002",126,0)
 . I ELEMENT<0  S RC=+ELEMENT  Q
"RTN","RORXU002",127,0)
 . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,"START",STDT)  Q:RC<0
"RTN","RORXU002",128,0)
 . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,"END",ENDT)
"RTN","RORXU002",129,0)
 Q:RC<0 RC
"RTN","RORXU002",130,0)
 ;
"RTN","RORXU002",131,0)
 ;=== Main date range
"RTN","RORXU002",132,0)
 S STDT=$$PARAM^RORTSK01("DATE_RANGE","START")\1
"RTN","RORXU002",133,0)
 S ENDT=$$PARAM^RORTSK01("DATE_RANGE","END")\1
"RTN","RORXU002",134,0)
 I STDT>0,ENDT>0  D  Q:RC<0 RC
"RTN","RORXU002",135,0)
 . S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,"DATE_RANGE",,PARAMS)
"RTN","RORXU002",136,0)
 . I ELEMENT<0  S RC=+ELEMENT  Q
"RTN","RORXU002",137,0)
 . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,"START",STDT)  Q:RC<0
"RTN","RORXU002",138,0)
 . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,"END",ENDT)
"RTN","RORXU002",139,0)
 E  S (ENDT,STDT)=""
"RTN","RORXU002",140,0)
 ;
"RTN","RORXU002",141,0)
 ;=== Task comment
"RTN","RORXU002",142,0)
 S TMP=$$PARAM^RORTSK01("TASK_COMMENT")
"RTN","RORXU002",143,0)
 D:TMP'="" ADDVAL^RORTSK11(RORTSK,"TASK_COMMENT",TMP,PARAMS)
"RTN","RORXU002",144,0)
 ;
"RTN","RORXU002",145,0)
 ;=== Patient selection and Options
"RTN","RORXU002",146,0)
 F NAME="PATIENTS","OPTIONS"  D  Q:RC<0
"RTN","RORXU002",147,0)
 . K BUF  M BUF=RORTSK("PARAMS",NAME,"A")  Q:$D(BUF)<10
"RTN","RORXU002",148,0)
 . ;--- Generate the XML tags
"RTN","RORXU002",149,0)
 . S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,NAME,$$OPTXT(.BUF),PARAMS)
"RTN","RORXU002",150,0)
 . I ELEMENT'>0  S RC=ELEMENT  Q
"RTN","RORXU002",151,0)
 . S TMP=""
"RTN","RORXU002",152,0)
 . F  S TMP=$O(BUF(TMP))  Q:TMP=""  D  Q:RC<0
"RTN","RORXU002",153,0)
 . . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,TMP,"1")
"RTN","RORXU002",154,0)
 . ;--- Compile the flags
"RTN","RORXU002",155,0)
 . D:NAME="PATIENTS"
"RTN","RORXU002",156,0)
 . . S:'$D(BUF("DE_BEFORE")) FLAGS=FLAGS_"P"
"RTN","RORXU002",157,0)
 . . S:'$D(BUF("DE_DURING")) FLAGS=FLAGS_"N"
"RTN","RORXU002",158,0)
 . . S:'$D(BUF("DE_AFTER")) FLAGS=FLAGS_"F"
"RTN","RORXU002",159,0)
 Q:RC<0 RC
"RTN","RORXU002",160,0)
 ;
"RTN","RORXU002",161,0)
 ;=== Other Registries
"RTN","RORXU002",162,0)
 I $D(RORTSK("PARAMS","OTHER_REGISTRIES","C"))>1  D  Q:RC<0 RC
"RTN","RORXU002",163,0)
 . N NODE,REGIEN
"RTN","RORXU002",164,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"OTHER_REGISTRIES",,PARAMS)
"RTN","RORXU002",165,0)
 . I LTAG<0  S RC=+LTAG  Q
"RTN","RORXU002",166,0)
 . S NODE=$NA(RORTSK("PARAMS","OTHER_REGISTRIES","C"))
"RTN","RORXU002",167,0)
 . S REGIEN=0
"RTN","RORXU002",168,0)
 . F  S REGIEN=$O(@NODE@(REGIEN))  Q:REGIEN'>0  D  Q:RC<0
"RTN","RORXU002",169,0)
 . . S TMP=$P($$REGNAME^RORUTL01(REGIEN),U,2)
"RTN","RORXU002",170,0)
 . . I TMP=""  K @NODE@(REGIEN)  Q
"RTN","RORXU002",171,0)
 . . S RC=$$ADDVAL^RORTSK11(RORTSK,"REGNAME",TMP,LTAG)
"RTN","RORXU002",172,0)
 . S FLAGS=FLAGS_"R"
"RTN","RORXU002",173,0)
 ;
"RTN","RORXU002",174,0)
 ;=== Local Fields
"RTN","RORXU002",175,0)
 I $D(RORTSK("PARAMS","LOCAL_FIELDS","C"))>1  D  Q:RC<0 RC
"RTN","RORXU002",176,0)
 . N NODE,IEN,IENS
"RTN","RORXU002",177,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"LOCAL_FIELDS",,PARAMS)
"RTN","RORXU002",178,0)
 . I LTAG<0  S RC=+LTAG  Q
"RTN","RORXU002",179,0)
 . S NODE=$NA(RORTSK("PARAMS","LOCAL_FIELDS","C"))
"RTN","RORXU002",180,0)
 . S IEN=0
"RTN","RORXU002",181,0)
 . F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORXU002",182,0)
 . . S TMP=$$GET1^DIQ(799.53,IEN_",",.01,,,"RORMSG")
"RTN","RORXU002",183,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,799.53,IEN_",")
"RTN","RORXU002",184,0)
 . . I TMP=""  K @NODE@(IEN)  Q
"RTN","RORXU002",185,0)
 . . S RC=$$ADDVAL^RORTSK11(RORTSK,"FIELD",TMP,LTAG)
"RTN","RORXU002",186,0)
 . S FLAGS=FLAGS_"O"
"RTN","RORXU002",187,0)
 ;
"RTN","RORXU002",188,0)
 ;=== Lab test ranges
"RTN","RORXU002",189,0)
 I $D(RORTSK("PARAMS","LRGRANGES","C"))>1  D  Q:RC<0 RC
"RTN","RORXU002",190,0)
 . N GRC,NODE
"RTN","RORXU002",191,0)
 . S NODE=$NA(RORTSK("PARAMS","LRGRANGES","C"))
"RTN","RORXU002",192,0)
 . S GRC=0
"RTN","RORXU002",193,0)
 . F  S GRC=$O(@NODE@(GRC))  Q:GRC'>0  D  Q:RC<0
"RTN","RORXU002",194,0)
 . . S RC=$$ITEMIEN^RORUTL09(3,REGIEN,GRC,.TMP)
"RTN","RORXU002",195,0)
 . . S:RC'<0 @NODE@(GRC)=TMP
"RTN","RORXU002",196,0)
 ;
"RTN","RORXU002",197,0)
 ;=== Defaults
"RTN","RORXU002",198,0)
 S TMP=$TR(FLAGS,"FNP")  S:$L(FLAGS)-$L(TMP)=3 FLAGS=TMP
"RTN","RORXU002",199,0)
 S FLAGS=FLAGS_"DG"
"RTN","RORXU002",200,0)
 ;
"RTN","RORXU002",201,0)
 ;=== Success
"RTN","RORXU002",202,0)
 Q PARAMS
"RTN","RORXU002",203,0)
 ;
"RTN","RORXU002",204,0)
 ;***** GENERATES TABLE DEFINITION
"RTN","RORXU002",205,0)
 ;
"RTN","RORXU002",206,0)
 ; TBLREF        Reference to the definition table in the source
"RTN","RORXU002",207,0)
 ;               code (TAG^ROUTINE). See the HEADER^RORX013 for
"RTN","RORXU002",208,0)
 ;               examples of table definitions.
"RTN","RORXU002",209,0)
 ;
"RTN","RORXU002",210,0)
 ; HEADER        IEN of the HEADER element
"RTN","RORXU002",211,0)
 ;
"RTN","RORXU002",212,0)
 ; Return Values:
"RTN","RORXU002",213,0)
 ;       <0  Error code
"RTN","RORXU002",214,0)
 ;        0  Ok
"RTN","RORXU002",215,0)
 ;
"RTN","RORXU002",216,0)
TBLDEF(TBLREF,HEADER) ;
"RTN","RORXU002",217,0)
 N COND,IT,NAME,RC,RORSRC,TBLDEF,TERM,TGET
"RTN","RORXU002",218,0)
 S TGET="S RORSRC=$T("_$P(TBLREF,"^")_"+IT^"_$P(TBLREF,"^",2)_")"
"RTN","RORXU002",219,0)
 S RC=0
"RTN","RORXU002",220,0)
 F IT=1:1  X TGET  S RORSRC=$P(RORSRC,";;",2)  Q:RORSRC=""  D  Q:RC<0
"RTN","RORXU002",221,0)
 . S COND=$$TRIM^XLFSTR($P(RORSRC,U,2,999))
"RTN","RORXU002",222,0)
 . I COND'=""  X COND  E  Q
"RTN","RORXU002",223,0)
 . S RORSRC=$$TRIM^XLFSTR($P(RORSRC,U))
"RTN","RORXU002",224,0)
 . S NAME=$$COLSCAN(.TERM)  Q:(NAME="")!(TERM'="(")
"RTN","RORXU002",225,0)
 . S TBLDEF=$$ADDVAL^RORTSK11(RORTSK,"TBLDEF",,HEADER)
"RTN","RORXU002",226,0)
 . I TBLDEF<0  S RC=TBLDEF  Q
"RTN","RORXU002",227,0)
 . D ADDATTR^RORTSK11(RORTSK,TBLDEF,"NAME",NAME)
"RTN","RORXU002",228,0)
 . D ADDATTR^RORTSK11(RORTSK,TBLDEF,"HEADER","1")
"RTN","RORXU002",229,0)
 . D ADDATTR^RORTSK11(RORTSK,TBLDEF,"FOOTER","1")
"RTN","RORXU002",230,0)
 . D TBLDEF1(TBLDEF)
"RTN","RORXU002",231,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORXU002",232,0)
 ;
"RTN","RORXU002",233,0)
 ;***** GENERATES <COLUMN> ELEMENTS FROM TABLE DEFINITION (RORSRC)
"RTN","RORXU002",234,0)
 ;
"RTN","RORXU002",235,0)
 ; PTAG          IEN of the parent element
"RTN","RORXU002",236,0)
 ;
"RTN","RORXU002",237,0)
TBLDEF1(PTAG) ;
"RTN","RORXU002",238,0)
 N COLUMN,NAME,TERM
"RTN","RORXU002",239,0)
 F  S NAME=$$COLSCAN(.TERM)  Q:NAME=""  D  Q:")"[TERM
"RTN","RORXU002",240,0)
 . S COLUMN=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,PTAG)
"RTN","RORXU002",241,0)
 . D ADDATTR^RORTSK11(RORTSK,COLUMN,"NAME",NAME)
"RTN","RORXU002",242,0)
 . D:TERM="(" TBLDEF1(COLUMN)
"RTN","RORXU002",243,0)
 Q
"RTN","RORXU003")
0^191^B49999822
"RTN","RORXU003",1,0)
RORXU003 ;HCIOFO/BH,SG - REPORT BUILDER UTILITIES ; 1/24/06 11:09am
"RTN","RORXU003",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORXU003",3,0)
 ;
"RTN","RORXU003",4,0)
 ; This routine uses the following IAs:
"RTN","RORXU003",5,0)
 ;
"RTN","RORXU003",6,0)
 ; #1894         ENCEVENT^PXKENC (controlled)
"RTN","RORXU003",7,0)
 ;
"RTN","RORXU003",8,0)
 Q
"RTN","RORXU003",9,0)
 ;
"RTN","RORXU003",10,0)
 ;***** SEARCHES FOR UTLIZATION
"RTN","RORXU003",11,0)
 ;
"RTN","RORXU003",12,0)
 ; STDT          Start date for search (FileMan)
"RTN","RORXU003",13,0)
 ; ENDT          End date for search   (FileMan)
"RTN","RORXU003",14,0)
 ;
"RTN","RORXU003",15,0)
 ; RORDFN        Patient IEN in the PATIENT file (#2)
"RTN","RORXU003",16,0)
 ;
"RTN","RORXU003",17,0)
 ; CHK           Reference to a local array that identifies the
"RTN","RORXU003",18,0)
 ;               packages files that need to be checked i.e. CHK("O"):
"RTN","RORXU003",19,0)
 ;                 A   Allergy
"RTN","RORXU003",20,0)
 ;                 C   Cytopathology
"RTN","RORXU003",21,0)
 ;                 I   Inpatients
"RTN","RORXU003",22,0)
 ;                 IP  Inpatient Pharmacy
"RTN","RORXU003",23,0)
 ;                 IV  IV Medications
"RTN","RORXU003",24,0)
 ;                 L   Laboratory
"RTN","RORXU003",25,0)
 ;                 M   Microbiology
"RTN","RORXU003",26,0)
 ;                 O   Outpatient
"RTN","RORXU003",27,0)
 ;                 OP  Outpatient Pharmacy
"RTN","RORXU003",28,0)
 ;                 R   Radiology
"RTN","RORXU003",29,0)
 ;                 SP  Surgical Pathology
"RTN","RORXU003",30,0)
 ;
"RTN","RORXU003",31,0)
 ;               If set to "ALL", Outpatients, Inpatients, Radiology,
"RTN","RORXU003",32,0)
 ;               Allergy, Pharmacy, Microbiology, Surgical Pathology,
"RTN","RORXU003",33,0)
 ;               Cytopathology, and Lab data will be checked.
"RTN","RORXU003",34,0)
 ;
"RTN","RORXU003",35,0)
 ; Return Values:
"RTN","RORXU003",36,0)
 ;       0  No utilization has been found
"RTN","RORXU003",37,0)
 ;       1  The patient has had utilization. The subsequent "^"-pieces
"RTN","RORXU003",38,0)
 ;          will indicate the utilization areas (the same codes as
"RTN","RORXU003",39,0)
 ;          those for the CHK parameter)
"RTN","RORXU003",40,0)
 ;
"RTN","RORXU003",41,0)
 ;          For example, if a patient had utilization for Inpatients, 
"RTN","RORXU003",42,0)
 ;          Outpatient, Pharmacy, and Lab the string would look as
"RTN","RORXU003",43,0)
 ;          follows: 1^O^I^OP^L
"RTN","RORXU003",44,0)
 ;
"RTN","RORXU003",45,0)
UTIL(STDT,ENDT,RORDFN,CHK) ;
"RTN","RORXU003",46,0)
 N IEN,LRDFN,RES,RORMSG,VAL
"RTN","RORXU003",47,0)
 S VAL=""
"RTN","RORXU003",48,0)
 ;
"RTN","RORXU003",49,0)
 ;--- Outpatient data
"RTN","RORXU003",50,0)
 I $D(CHK("ALL"))!$D(CHK("O")) D
"RTN","RORXU003",51,0)
 . S RES=$$OUTPAT(STDT,ENDT,RORDFN)
"RTN","RORXU003",52,0)
 . S:RES VAL=VAL_U_$P(RES,U,2,999)
"RTN","RORXU003",53,0)
 ;
"RTN","RORXU003",54,0)
 ;--- Inpatient data
"RTN","RORXU003",55,0)
 I $D(CHK("ALL"))!$D(CHK("I")) D
"RTN","RORXU003",56,0)
 . S RES=$$INPAT(STDT,ENDT,RORDFN)
"RTN","RORXU003",57,0)
 . S:RES VAL=VAL_U_$P(RES,U,2,999)
"RTN","RORXU003",58,0)
 ;
"RTN","RORXU003",59,0)
 ;--- Radiology data
"RTN","RORXU003",60,0)
 I $D(CHK("ALL"))!$D(CHK("R")) D
"RTN","RORXU003",61,0)
 . S RES=$$RAD(STDT,ENDT,RORDFN)
"RTN","RORXU003",62,0)
 . S:RES VAL=VAL_U_$P(RES,U,2,999)
"RTN","RORXU003",63,0)
 ;
"RTN","RORXU003",64,0)
 ;--- Allergy data
"RTN","RORXU003",65,0)
 I $D(CHK("ALL"))!$D(CHK("A")) D
"RTN","RORXU003",66,0)
 . S RES=$$ALLERGY(STDT,ENDT,RORDFN)
"RTN","RORXU003",67,0)
 . S:RES VAL=VAL_U_$P(RES,U,2,999)
"RTN","RORXU003",68,0)
 ;
"RTN","RORXU003",69,0)
 ;--- Pharmacy data
"RTN","RORXU003",70,0)
 I $D(CHK("ALL"))!$D(CHK("IP"))!$D(CHK("OP"))!$D(CHK("IV")) D
"RTN","RORXU003",71,0)
 . S RES=$$PHARM(STDT,ENDT,RORDFN,.CHK)
"RTN","RORXU003",72,0)
 . S:RES VAL=VAL_U_$P(RES,U,2,999)
"RTN","RORXU003",73,0)
 ;
"RTN","RORXU003",74,0)
 S LRDFN=+$$LABREF^RORUTL18(RORDFN)
"RTN","RORXU003",75,0)
 ;
"RTN","RORXU003",76,0)
 I LRDFN>0  D
"RTN","RORXU003",77,0)
 . ;--- Microbiology
"RTN","RORXU003",78,0)
 . I $D(CHK("ALL"))!$D(CHK("M")) D
"RTN","RORXU003",79,0)
 . . S RES=$$MICRO(STDT,ENDT,LRDFN)
"RTN","RORXU003",80,0)
 . . S:RES VAL=VAL_U_$P(RES,U,2,999)
"RTN","RORXU003",81,0)
 . ;--- Surgical Pathology
"RTN","RORXU003",82,0)
 . I $D(CHK("ALL"))!$D(CHK("SP")) D
"RTN","RORXU003",83,0)
 . . S RES=$$SURGP(STDT,ENDT,LRDFN)
"RTN","RORXU003",84,0)
 . . S:RES VAL=VAL_U_$P(RES,U,2,999)
"RTN","RORXU003",85,0)
 . ;--- Cytopathology
"RTN","RORXU003",86,0)
 . I $D(CHK("ALL"))!$D(CHK("C")) D
"RTN","RORXU003",87,0)
 . . S RES=$$CYTO(STDT,ENDT,LRDFN)
"RTN","RORXU003",88,0)
 . . S:RES VAL=VAL_U_$P(RES,U,2,999)
"RTN","RORXU003",89,0)
 ;
"RTN","RORXU003",90,0)
 ;--- Lab data
"RTN","RORXU003",91,0)
 I $D(CHK("ALL"))!$D(CHK("L")) D
"RTN","RORXU003",92,0)
 . S RES=$$LAB(STDT,ENDT,RORDFN)
"RTN","RORXU003",93,0)
 . S:RES VAL=VAL_U_$P(RES,U,2,999)
"RTN","RORXU003",94,0)
 ;
"RTN","RORXU003",95,0)
 S $P(VAL,U)=(VAL'="")
"RTN","RORXU003",96,0)
 Q VAL
"RTN","RORXU003",97,0)
 ;
"RTN","RORXU003",98,0)
 ;***** CHECKS ALLERGY DATA
"RTN","RORXU003",99,0)
ALLERGY(STDT,ENDT,RORDFN) ;
"RTN","RORXU003",100,0)
 N DTE,IEN,RC
"RTN","RORXU003",101,0)
 S RC=0
"RTN","RORXU003",102,0)
 S DTE=$O(^GMR(120.8,"AODT",STDT),-1)
"RTN","RORXU003",103,0)
 S ENDT=ENDT_".999999"
"RTN","RORXU003",104,0)
 F  S DTE=$O(^GMR(120.8,"AODT",DTE))  Q:'DTE!(DTE'<ENDT)  D  Q:RC
"RTN","RORXU003",105,0)
 . S IEN=0
"RTN","RORXU003",106,0)
 . F  S IEN=$O(^GMR(120.8,"AODT",DTE,IEN))  Q:'IEN  D  Q:RC
"RTN","RORXU003",107,0)
 . . S:$D(^GMR(120.8,"B",RORDFN,IEN)) RC="1^A"
"RTN","RORXU003",108,0)
 Q RC
"RTN","RORXU003",109,0)
 ;
"RTN","RORXU003",110,0)
 ;***** CHECKS CYTOPATHOLOGY DATA
"RTN","RORXU003",111,0)
CYTO(STDT,ENDT,LRDFN) ;
"RTN","RORXU003",112,0)
 N IDT
"RTN","RORXU003",113,0)
 S IDT=$O(^LR(LRDFN,"CY",9999999-STDT))
"RTN","RORXU003",114,0)
 S IDT=$O(^LR(LRDFN,"CY",IDT),-1)
"RTN","RORXU003",115,0)
 Q $S(IDT&(IDT>(9999999-ENDT)):"1^C",1:0)
"RTN","RORXU003",116,0)
 ;
"RTN","RORXU003",117,0)
 ;***** CHECKS INPATIENT DATA
"RTN","RORXU003",118,0)
INPAT(STDT,ENDT,DFN) ;
"RTN","RORXU003",119,0)
 N ADMDT,DATE,DISDT,IEN,QUIT,RC,VAIP
"RTN","RORXU003",120,0)
 S STDT=STDT\1
"RTN","RORXU003",121,0)
 ;--- Check for an admission date inside the time frame
"RTN","RORXU003",122,0)
 S QUIT=0,DATE=(ENDT\1)_".999999"
"RTN","RORXU003",123,0)
 F  S DATE=$O(^DGPT("AAD",DFN,DATE),-1)  Q:'DATE!(DATE<STDT)  D  Q:QUIT
"RTN","RORXU003",124,0)
 . S IEN=""
"RTN","RORXU003",125,0)
 . F  S IEN=$O(^DGPT("AAD",DFN,DATE,IEN),-1)  Q:'IEN  D  Q:QUIT
"RTN","RORXU003",126,0)
 . . S:'$$PTF^RORXU001(IEN,"FP") QUIT=1
"RTN","RORXU003",127,0)
 Q:QUIT=1 "1^I"
"RTN","RORXU003",128,0)
 ;--- Check for an earlier admission that overlaps the date range
"RTN","RORXU003",129,0)
 S QUIT=0,VAIP("D")=STDT
"RTN","RORXU003",130,0)
 F  D  Q:QUIT
"RTN","RORXU003",131,0)
 . D IN5^VADPT
"RTN","RORXU003",132,0)
 . S VAIP("D")=+$G(VAIP(13,1))
"RTN","RORXU003",133,0)
 . I VAIP("D")'>0  S QUIT=2  Q
"RTN","RORXU003",134,0)
 . S VAIP("D")=$$FMADD^XLFDT(VAIP("D"),,,,-1)
"RTN","RORXU003",135,0)
 . S IEN=+$G(VAIP(12))  Q:IEN'>0
"RTN","RORXU003",136,0)
 . S RC=$$PTF^RORXU001(IEN,"FP",,.DISDT)
"RTN","RORXU003",137,0)
 . S QUIT=$S(RC:0,$G(DISDT)'>0:1,DISDT>STDT:1,1:2)
"RTN","RORXU003",138,0)
 Q $S(QUIT=1:"1^I",1:0)
"RTN","RORXU003",139,0)
 ;
"RTN","RORXU003",140,0)
 ;***** CHECKS LAB DATA
"RTN","RORXU003",141,0)
LAB(STDT,ENDT,RORDFN) ;
"RTN","RORXU003",142,0)
 N PTID,RC,RORMSG,RORTMP
"RTN","RORXU003",143,0)
 S PTID=$$PTID^RORUTL02(RORDFN)  Q:PTID<0 0
"RTN","RORXU003",144,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORXU003",145,0)
 ;--- Get the Lab data
"RTN","RORXU003",146,0)
 S ENDT=(ENDT\1+1)_"^CD",STDT=STDT_"^CD"
"RTN","RORXU003",147,0)
 S RC=$$GCPR^LA7QRY(PTID,STDT,ENDT,"CH","*",.RORMSG,RORTMP)
"RTN","RORXU003",148,0)
 S RC=$S(($D(RORMSG)>1)&(RC=""):0,$D(@RORTMP)>1:"1^L",1:0)
"RTN","RORXU003",149,0)
 ;--- Cleanup
"RTN","RORXU003",150,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORXU003",151,0)
 Q RC
"RTN","RORXU003",152,0)
 ;
"RTN","RORXU003",153,0)
 ;***** CHECKS MICROBIOLOGY DATA
"RTN","RORXU003",154,0)
MICRO(STDT,ENDT,LRDFN) ;
"RTN","RORXU003",155,0)
 N RC,RORTMP
"RTN","RORXU003",156,0)
 S RC=0,RORTMP=$$ALLOC^RORTMP()
"RTN","RORXU003",157,0)
 D:$$GETDATA^LA7UTL1A(LRDFN,STDT,ENDT,"CD",RORTMP)'<0
"RTN","RORXU003",158,0)
 . S:$D(@RORTMP@(LRDFN)) RC="1^M"
"RTN","RORXU003",159,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORXU003",160,0)
 Q RC
"RTN","RORXU003",161,0)
 ;
"RTN","RORXU003",162,0)
 ;***** CHECKS OUTPATIENT DATA
"RTN","RORXU003",163,0)
OUTPAT(STDT,ENDT,RORDFN) ;
"RTN","RORXU003",164,0)
 S STDT=$P(STDT,".",1),STDT=STDT-1,STDT=STDT+.9999
"RTN","RORXU003",165,0)
 S ENDT=$P(ENDT,".",1),ENDT=ENDT+1
"RTN","RORXU003",166,0)
 N QUERY,RORDST,RORECNT
"RTN","RORXU003",167,0)
 S RORECNT=0
"RTN","RORXU003",168,0)
 S RORDST=$NA(^TMP("RORXU003",$J,"OUT"))
"RTN","RORXU003",169,0)
 D OPEN^SDQ(.QUERY)
"RTN","RORXU003",170,0)
 D INDEX^SDQ(.QUERY,"PATIENT/DATE","SET")
"RTN","RORXU003",171,0)
 D PAT^SDQ(.QUERY,RORDFN,"SET")
"RTN","RORXU003",172,0)
 D DATE^SDQ(.QUERY,STDT,ENDT,"SET")
"RTN","RORXU003",173,0)
 D SCANCB^SDQ(.QUERY,"D SCAN^RORXU003()","SET")
"RTN","RORXU003",174,0)
 D ACTIVE^SDQ(.QUERY,"TRUE","SET")
"RTN","RORXU003",175,0)
 D SCAN^SDQ(.QUERY,"FORWARD")
"RTN","RORXU003",176,0)
 D CLOSE^SDQ(.QUERY)
"RTN","RORXU003",177,0)
 Q $S(RORECNT:"1^O",1:0)
"RTN","RORXU003",178,0)
 ;
"RTN","RORXU003",179,0)
 ;***** CHECKS PHARMACY DATA
"RTN","RORXU003",180,0)
PHARM(STDT,ENDT,RORDFN,CHK) ;
"RTN","RORXU003",181,0)
 N BUF,II,IP,IV,OP,ORD,RC,RORLST,SKIP,TMP,TYPE
"RTN","RORXU003",182,0)
 S ENDT=$$FMADD^XLFDT(ENDT\1,1)
"RTN","RORXU003",183,0)
 I '$D(CHK("ALL"))  D
"RTN","RORXU003",184,0)
 . S IP='$D(CHK("IP"))
"RTN","RORXU003",185,0)
 . S IV='$D(CHK("IV"))
"RTN","RORXU003",186,0)
 . S OP='$D(CHK("OP"))
"RTN","RORXU003",187,0)
 E  S (OP,IP,IV)=0
"RTN","RORXU003",188,0)
 ;=== Get the list of orders
"RTN","RORXU003",189,0)
 K ^TMP("PS",$J)
"RTN","RORXU003",190,0)
 D OCL^PSOORRL(RORDFN,STDT,ENDT)
"RTN","RORXU003",191,0)
 Q:$D(^TMP("PS",$J))<10 0
"RTN","RORXU003",192,0)
 S RORLST=$$ALLOC^RORTMP()
"RTN","RORXU003",193,0)
 ;=== Preselect the orders
"RTN","RORXU003",194,0)
 S II=0
"RTN","RORXU003",195,0)
 F  S II=$O(^TMP("PS",$J,II))  Q:'II  D
"RTN","RORXU003",196,0)
 . S BUF=$G(^TMP("PS",$J,II,0)),ORD=$P(BUF,U)  Q:ORD'>0
"RTN","RORXU003",197,0)
 . S TMP=$L(ORD),TYPE=$E(ORD,TMP-2,TMP)
"RTN","RORXU003",198,0)
 . S TYPE=$S(TYPE="R;O":"R",TYPE="U;I":"U",TYPE="V;I":"V",1:"")
"RTN","RORXU003",199,0)
 . ;--- Check if this kind of orders should be processed
"RTN","RORXU003",200,0)
 . Q:$S(TYPE="R":OP,TYPE="U":IP,TYPE="V":IV,1:1)
"RTN","RORXU003",201,0)
 . ;--- Check the dates
"RTN","RORXU003",202,0)
 . I "UV"[TYPE  S TMP=$P(BUF,U,15)  Q:(TMP<STDT)!(TMP'<ENDT)
"RTN","RORXU003",203,0)
 . I TYPE="R"   S TMP=$P(BUF,U,10)  Q:TMP<STDT
"RTN","RORXU003",204,0)
 . ;--- Add the order to the list
"RTN","RORXU003",205,0)
 . S @RORLST@(II)=TYPE,@RORLST@(II,0)=BUF
"RTN","RORXU003",206,0)
 ;=== Process the preselected orders
"RTN","RORXU003",207,0)
 S II=0,RC=""
"RTN","RORXU003",208,0)
 F  S II=$O(@RORLST@(II))  Q:'II  D  Q:OP&IP&IV
"RTN","RORXU003",209,0)
 . S TYPE=@RORLST@(II),ORD=$P(@RORLST@(II,0),U)
"RTN","RORXU003",210,0)
 . ;--- Outpatient
"RTN","RORXU003",211,0)
 . I TYPE="R"  Q:OP  D  S:'SKIP OP=1,RC=RC_U_"OP"  Q
"RTN","RORXU003",212,0)
 . . ;--- Double-check the Rx date(s)
"RTN","RORXU003",213,0)
 . . K ^TMP("PS",$J)
"RTN","RORXU003",214,0)
 . . D OEL^PSOORRL(RORDFN,ORD)
"RTN","RORXU003",215,0)
 . . I $D(^TMP("PS",$J))<10  S SKIP=1  Q
"RTN","RORXU003",216,0)
 . . S SKIP=$$DTCHECK^RORUTL15(STDT,ENDT)
"RTN","RORXU003",217,0)
 . ;--- Inpatient
"RTN","RORXU003",218,0)
 . I TYPE="U"  Q:IP  S IP=1,RC=RC_U_"IP"  Q
"RTN","RORXU003",219,0)
 . ;--- IV
"RTN","RORXU003",220,0)
 . I TYPE="V"  Q:IV  S IV=1,RC=RC_U_"IV"  Q
"RTN","RORXU003",221,0)
 ;===
"RTN","RORXU003",222,0)
 D FREE^RORTMP(RORLST)
"RTN","RORXU003",223,0)
 K ^TMP("PS",$J)
"RTN","RORXU003",224,0)
 S $P(RC,U)=(RC'="")
"RTN","RORXU003",225,0)
 Q RC
"RTN","RORXU003",226,0)
 ;
"RTN","RORXU003",227,0)
 ;***** CHECKS RADIOLOGY DATA
"RTN","RORXU003",228,0)
RAD(STDT,ENDT,RORDFN) ;
"RTN","RORXU003",229,0)
 N RC
"RTN","RORXU003",230,0)
 K ^TMP($J,"RAE1")
"RTN","RORXU003",231,0)
 D EN1^RAO7PC1(RORDFN,STDT,ENDT,999999999)
"RTN","RORXU003",232,0)
 S RC=$S($D(^TMP($J,"RAE1",RORDFN))>1:"1^R",1:0)
"RTN","RORXU003",233,0)
 K ^TMP($J,"RAE1")
"RTN","RORXU003",234,0)
 Q RC
"RTN","RORXU003",235,0)
 ;
"RTN","RORXU003",236,0)
 ;*****
"RTN","RORXU003",237,0)
SCAN() ;
"RTN","RORXU003",238,0)
 S RORECNT=1
"RTN","RORXU003",239,0)
 Q
"RTN","RORXU003",240,0)
 ;
"RTN","RORXU003",241,0)
 ;***** CHECKS SURGICAL PATHOLOGY DATA
"RTN","RORXU003",242,0)
SURGP(STDT,ENDT,LRDFN) ;
"RTN","RORXU003",243,0)
 N IDT
"RTN","RORXU003",244,0)
 S IDT=$O(^LR(LRDFN,"SP",9999999-STDT))
"RTN","RORXU003",245,0)
 S IDT=$O(^LR(LRDFN,"SP",IDT),-1)
"RTN","RORXU003",246,0)
 Q $S(IDT&(IDT>(9999999-ENDT)):"1^SP",1:0)
"RTN","RORXU004")
0^192^B860897
"RTN","RORXU004",1,0)
RORXU004 ;HCIOFO/SG - REPORT UTILITIES (STATISTICS) ; 9/23/03 10:51am
"RTN","RORXU004",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORXU004",3,0)
 ;
"RTN","RORXU004",4,0)
 Q
"RTN","RORXU004",5,0)
 ;
"RTN","RORXU004",6,0)
 ;***** CALCULATES THE MEDIAN VALUE OF THE CROSS-REFERENCE
"RTN","RORXU004",7,0)
 ;
"RTN","RORXU004",8,0)
 ; XREFNODE      Root node of the old-style cross-reference
"RTN","RORXU004",9,0)
 ; NUM           Total number of elements in the array
"RTN","RORXU004",10,0)
 ;
"RTN","RORXU004",11,0)
 ; Return Values:
"RTN","RORXU004",12,0)
 ;       ""  Error (or an empty array)
"RTN","RORXU004",13,0)
 ;     '=""  Median Value
"RTN","RORXU004",14,0)
 ;
"RTN","RORXU004",15,0)
XREFMDNV(XREFNODE,NUM) ;
"RTN","RORXU004",16,0)
 Q:NUM'>0 ""
"RTN","RORXU004",17,0)
 N FLT,FLTL,I,MV,N,PI,VPOS
"RTN","RORXU004",18,0)
 S FLTL=$L(XREFNODE)-1,FLT=$E(XREFNODE,1,FLTL)
"RTN","RORXU004",19,0)
 S N=(NUM+1)\2,VPOS=$QL(XREFNODE)+1
"RTN","RORXU004",20,0)
 ;--- Find the median value
"RTN","RORXU004",21,0)
 S PI=XREFNODE
"RTN","RORXU004",22,0)
 F I=1:1:N  S PI=$Q(@PI)  Q:$E(PI,1,FLTL)'=FLT
"RTN","RORXU004",23,0)
 Q:$E(PI,1,FLTL)'=FLT ""
"RTN","RORXU004",24,0)
 ;--- Calculate median value if NUM is even
"RTN","RORXU004",25,0)
 S MV=$QS(PI,VPOS)
"RTN","RORXU004",26,0)
 I '(NUM#2)  D  Q:I="" ""  S MV=(MV+I)/2
"RTN","RORXU004",27,0)
 . S PI=$Q(@PI),I=$S($E(PI,1,FLTL)=FLT:$QS(PI,VPOS),1:"")
"RTN","RORXU004",28,0)
 Q MV
"RTN","RORXU005")
0^8^B16280481
"RTN","RORXU005",1,0)
RORXU005 ;HCIOFO/SG - REPORT BUILDER UTILITIES ; 12/14/05 12:02pm
"RTN","RORXU005",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORXU005",3,0)
 ;
"RTN","RORXU005",4,0)
 ; This routine uses the following IAs:
"RTN","RORXU005",5,0)
 ;
"RTN","RORXU005",6,0)
 ; #10035        Direct read of the DOD field of the file #2
"RTN","RORXU005",7,0)
 ;
"RTN","RORXU005",8,0)
 Q
"RTN","RORXU005",9,0)
 ;
"RTN","RORXU005",10,0)
 ;***** CALLBACK FUNCTION FOR DRUG SEARCH API
"RTN","RORXU005",11,0)
REIMBCB(RORDST,ORDER,FLAGS,DRUG,DATE) ;
"RTN","RORXU005",12,0)
 S RORDST=1
"RTN","RORXU005",13,0)
 Q 2
"RTN","RORXU005",14,0)
 ;
"RTN","RORXU005",15,0)
 ;***** RETURNS THE REIMBURSEMENT LEVEL FOR THE PATIENT
"RTN","RORXU005",16,0)
 ;
"RTN","RORXU005",17,0)
 ; RORIEN        IEN of the patient's record in the registry
"RTN","RORXU005",18,0)
 ;
"RTN","RORXU005",19,0)
 ; ROR8DRGS      Either closed root of the ARV drug list prepared by
"RTN","RORXU005",20,0)
 ;               the $$DRUGLIST^RORUTL16 or the Registry IEN. In the
"RTN","RORXU005",21,0)
 ;               latter case, the list will be compiled automatically.
"RTN","RORXU005",22,0)
 ;
"RTN","RORXU005",23,0)
 ; STDT          Start date
"RTN","RORXU005",24,0)
 ; ENDT          End date
"RTN","RORXU005",25,0)
 ;
"RTN","RORXU005",26,0)
 ; Return Values:
"RTN","RORXU005",27,0)
 ;       <0  Error code
"RTN","RORXU005",28,0)
 ;        0  Neither Clinical AIDS nor ARV drugs
"RTN","RORXU005",29,0)
 ;       10  ARV drugs
"RTN","RORXU005",30,0)
 ;       20  Clinical AIDS
"RTN","RORXU005",31,0)
 ;       30  Both Clinical AIDS and ARV drugs
"RTN","RORXU005",32,0)
 ;
"RTN","RORXU005",33,0)
REIMBLVL(RORIEN,ROR8DRGS,STDT,ENDT) ;
"RTN","RORXU005",34,0)
 N PATIEN,RC,RLVL,RORDST
"RTN","RORXU005",35,0)
 S RLVL=0
"RTN","RORXU005",36,0)
 ;--- Clinical AIDS
"RTN","RORXU005",37,0)
 S:$$CLINAIDS^RORHIVUT(+RORIEN,ENDT) RLVL=RLVL+20
"RTN","RORXU005",38,0)
 ;--- ARV Drugs
"RTN","RORXU005",39,0)
 S PATIEN=$$PTIEN^RORUTL01(RORIEN)
"RTN","RORXU005",40,0)
 S RORDST("RORCB")="$$REIMBCB^RORXU005"
"RTN","RORXU005",41,0)
 S RC=$$RXSEARCH^RORUTL14(PATIEN,ROR8DRGS,.RORDST,"IOV",STDT,ENDT)
"RTN","RORXU005",42,0)
 S:$G(RORDST)>0 RLVL=RLVL+10
"RTN","RORXU005",43,0)
 ;--- Reimbursement level
"RTN","RORXU005",44,0)
 Q $S(RC<0:RC,1:RLVL)
"RTN","RORXU005",45,0)
 ;
"RTN","RORXU005",46,0)
 ;***** RETURNS THE PATIENT'S LIST OF RISK FACTORS
"RTN","RORXU005",47,0)
 ;
"RTN","RORXU005",48,0)
 ; RORIEN        IEN of the patient's record in the registry
"RTN","RORXU005",49,0)
 ;
"RTN","RORXU005",50,0)
 ; Return Values:
"RTN","RORXU005",51,0)
 ;       <0  Error code
"RTN","RORXU005",52,0)
 ;       ""  No risk factors have been found
"RTN","RORXU005",53,0)
 ;  " ... "  A string containing the risk factor numbers
"RTN","RORXU005",54,0)
 ;           separated by commas and spaces
"RTN","RORXU005",55,0)
 ;
"RTN","RORXU005",56,0)
RISKS(RORIEN) ;
"RTN","RORXU005",57,0)
 Q:'$D(^RORDATA(799.4,+RORIEN,0)) ""
"RTN","RORXU005",58,0)
 N FLD,FLDLST,I,RISKLST,RORBUF,RORMSG
"RTN","RORXU005",59,0)
 S FLDLST="14.01;14.02;14.03;14.04;14.08;14.07;14.09;14.1;14.11;14.12;14.13;14.16;14.17"
"RTN","RORXU005",60,0)
 ;--- Load the risk fields
"RTN","RORXU005",61,0)
 S IENS=(+RORIEN)_","
"RTN","RORXU005",62,0)
 D GETS^DIQ(799.4,IENS,FLDLST,"I","RORBUF","RORMSG")
"RTN","RORXU005",63,0)
 Q:$G(DIERR) $$DBS^RORERR(799.4,-9,,,799.4,IENS)
"RTN","RORXU005",64,0)
 ;--- Process the data
"RTN","RORXU005",65,0)
 S RISKLST=""
"RTN","RORXU005",66,0)
 F I=1:1  S FLD=$P(FLDLST,";",I)  Q:FLD=""  D:FLD>0
"RTN","RORXU005",67,0)
 . S:$G(RORBUF(799.4,IENS,FLD,"I"))=1 RISKLST=RISKLST_", "_I
"RTN","RORXU005",68,0)
 Q $P(RISKLST,", ",2,999)
"RTN","RORXU005",69,0)
 ;
"RTN","RORXU005",70,0)
 ;***** DETERMINES IF THE PATIENT SHOULD NOT BE INCLUDED IN THE REPORT
"RTN","RORXU005",71,0)
 ;
"RTN","RORXU005",72,0)
 ; RORIEN        IEN of the patient's record in the registry
"RTN","RORXU005",73,0)
 ;
"RTN","RORXU005",74,0)
 ; FLAGS         Flags that control the execution (can be combined)
"RTN","RORXU005",75,0)
 ;
"RTN","RORXU005",76,0)
 ;                 C  Skip confirmed patients
"RTN","RORXU005",77,0)
 ;                 G  Skip pending patients
"RTN","RORXU005",78,0)
 ;
"RTN","RORXU005",79,0)
 ;                 D  Skip deceased patients
"RTN","RORXU005",80,0)
 ;                 L  Skip alive patients
"RTN","RORXU005",81,0)
 ;
"RTN","RORXU005",82,0)
 ;                 P  Skip patients confirmed before the start date
"RTN","RORXU005",83,0)
 ;                 N  Skip patients confirmed during the report
"RTN","RORXU005",84,0)
 ;                    time frame
"RTN","RORXU005",85,0)
 ;                 F  Skip patients added after the end date
"RTN","RORXU005",86,0)
 ;
"RTN","RORXU005",87,0)
 ;                 O  Process LOCAL_FIELDS
"RTN","RORXU005",88,0)
 ;                 R  Process OTHER_REGISTRIES
"RTN","RORXU005",89,0)
 ;
"RTN","RORXU005",90,0)
 ; [STDT]        Start date of the report (FileMan).
"RTN","RORXU005",91,0)
 ;               Time is ignored and the beginning of the day is
"RTN","RORXU005",92,0)
 ;               considered as the boundary (STDT\1).
"RTN","RORXU005",93,0)
 ;
"RTN","RORXU005",94,0)
 ;               If not defined or not greater than 0 then 0 is used.
"RTN","RORXU005",95,0)
 ;
"RTN","RORXU005",96,0)
 ; [ENDT]        End date of the report (FileMan).
"RTN","RORXU005",97,0)
 ;               Time is ignored and the end of the day is
"RTN","RORXU005",98,0)
 ;               considered as the boundary (ENDT\1+1).
"RTN","RORXU005",99,0)
 ;
"RTN","RORXU005",100,0)
 ;               If not defined or not greater than 0 then 9999999
"RTN","RORXU005",101,0)
 ;               is used.
"RTN","RORXU005",102,0)
 ;
"RTN","RORXU005",103,0)
 ; Return Values:
"RTN","RORXU005",104,0)
 ;        0  Include the patient's data in the report
"RTN","RORXU005",105,0)
 ;        1  Skip the patient
"RTN","RORXU005",106,0)
 ;
"RTN","RORXU005",107,0)
SKIP(RORIEN,FLAGS,STDT,ENDT) ;
"RTN","RORXU005",108,0)
 N DOD,IEN,NODE,PTIEN,REGIEN,SKIP,STATUS,TMP
"RTN","RORXU005",109,0)
 S SKIP=0
"RTN","RORXU005",110,0)
 ;--- Always skip patients marked for deletion
"RTN","RORXU005",111,0)
 Q:$$SKIPNA(RORIEN,FLAGS,.STATUS) 1
"RTN","RORXU005",112,0)
 ;---Include all registry patients if flags are not provided
"RTN","RORXU005",113,0)
 Q:FLAGS="" 0
"RTN","RORXU005",114,0)
 ;
"RTN","RORXU005",115,0)
 ;--- Confirmed
"RTN","RORXU005",116,0)
 I FLAGS["C"  Q:STATUS'=4 1
"RTN","RORXU005",117,0)
 ;
"RTN","RORXU005",118,0)
 ;--- Alive/Deceased patients
"RTN","RORXU005",119,0)
 S STDT=$S($G(STDT)>0:STDT\1,1:0)
"RTN","RORXU005",120,0)
 I $TR(FLAGS,"LD")'=FLAGS  D  Q:$S(TMP:FLAGS["L",1:FLAGS["D") 1
"RTN","RORXU005",121,0)
 . S:'$D(PTIEN) PTIEN=+$$PTIEN^RORUTL01(RORIEN)
"RTN","RORXU005",122,0)
 . S DOD=+$P($G(^DPT(PTIEN,.35)),U)
"RTN","RORXU005",123,0)
 . S TMP=$S(DOD>0:DOD'<STDT,1:1)
"RTN","RORXU005",124,0)
 ;
"RTN","RORXU005",125,0)
 ;--- Confirmed before/during/after the date range
"RTN","RORXU005",126,0)
 S ENDT=$S($G(ENDT)>0:ENDT\1,1:9999999)+1
"RTN","RORXU005",127,0)
 I $TR(FLAGS,"PNF")'=FLAGS  D  Q:TMP 1
"RTN","RORXU005",128,0)
 . S TMP=+$$CONFDT^RORUTL18(RORIEN)  ; Date Confirmed
"RTN","RORXU005",129,0)
 . S TMP=$S(TMP<STDT:FLAGS["P",TMP>ENDT:FLAGS["F",1:FLAGS["N")
"RTN","RORXU005",130,0)
 ;
"RTN","RORXU005",131,0)
 ;--- Other registries
"RTN","RORXU005",132,0)
 I FLAGS["R"  D  Q:SKIP 1
"RTN","RORXU005",133,0)
 . S NODE=$NA(RORTSK("PARAMS","OTHER_REGISTRIES","C"))
"RTN","RORXU005",134,0)
 . Q:$D(@NODE)<10
"RTN","RORXU005",135,0)
 . S:'$D(PTIEN) PTIEN=+$$PTIEN^RORUTL01(RORIEN)
"RTN","RORXU005",136,0)
 . S REGIEN=0
"RTN","RORXU005",137,0)
 . F  S REGIEN=$O(@NODE@(REGIEN))  Q:REGIEN'>0  D  Q:SKIP
"RTN","RORXU005",138,0)
 . . S IEN=$$PRRIEN^RORUTL01(PTIEN,REGIEN)
"RTN","RORXU005",139,0)
 . . I IEN>0  Q:'$$SKIPNA(IEN,FLAGS)
"RTN","RORXU005",140,0)
 . . S SKIP=1
"RTN","RORXU005",141,0)
 ;
"RTN","RORXU005",142,0)
 ;--- Local Fields
"RTN","RORXU005",143,0)
 I FLAGS["O"  D  Q:SKIP 1
"RTN","RORXU005",144,0)
 . S NODE=$NA(RORTSK("PARAMS","LOCAL_FIELDS","C"))
"RTN","RORXU005",145,0)
 . Q:$D(@NODE)<10
"RTN","RORXU005",146,0)
 . S IEN=0
"RTN","RORXU005",147,0)
 . F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D  Q:SKIP
"RTN","RORXU005",148,0)
 . . S:'$D(^RORDATA(798,RORIEN,20,"B",IEN)) SKIP=1
"RTN","RORXU005",149,0)
 ;
"RTN","RORXU005",150,0)
 ;--- Include in the report
"RTN","RORXU005",151,0)
 Q 0
"RTN","RORXU005",152,0)
 ;
"RTN","RORXU005",153,0)
 ;***** CHECKS STATUS OF THE PATIENT'S REGISTRY RECORD (internal)
"RTN","RORXU005",154,0)
 ;
"RTN","RORXU005",155,0)
 ; IEN798        IEN of the patient's record in the registry
"RTN","RORXU005",156,0)
 ;
"RTN","RORXU005",157,0)
 ; FLAGS         Flags that control the execution
"RTN","RORXU005",158,0)
 ;
"RTN","RORXU005",159,0)
 ; [.STATUS]     Status code is returned via this parameter.
"RTN","RORXU005",160,0)
 ;
"RTN","RORXU005",161,0)
 ; Return Values:
"RTN","RORXU005",162,0)
 ;        0  Continue processing of the patient's data
"RTN","RORXU005",163,0)
 ;        1  Skip the patient
"RTN","RORXU005",164,0)
 ;
"RTN","RORXU005",165,0)
SKIPNA(IEN798,FLAGS,STATUS) ;
"RTN","RORXU005",166,0)
 Q:$$ACTIVE^RORDD(IEN798,,.STATUS) 0  ; Active patient
"RTN","RORXU005",167,0)
 Q:(STATUS=5)!(STATUS="") 1           ; Deleted patient
"RTN","RORXU005",168,0)
 Q:(STATUS=4)&(FLAGS["G") 1           ; Pending patient
"RTN","RORXU005",169,0)
 Q 0
"RTN","RORXU006")
0^193^B40171673
"RTN","RORXU006",1,0)
RORXU006 ;HCIOFO/SG - REPORT PARAMETERS ; 2/8/06 8:04am
"RTN","RORXU006",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORXU006",3,0)
 ;
"RTN","RORXU006",4,0)
 ; This routine uses the following IAs:
"RTN","RORXU006",5,0)
 ;
"RTN","RORXU006",6,0)
 ; #91           Read access to the file #60 (controlled)
"RTN","RORXU006",7,0)
 ; #2947         ATESTS^ORWLRR (controlled)
"RTN","RORXU006",8,0)
 ; #10035        Direct read of DOD field of file #2 (supported)
"RTN","RORXU006",9,0)
 ; #10040        Read access to HOSPITAL LOCATION file (suppotted)
"RTN","RORXU006",10,0)
 ; #10082        Read access to the file #80 (supported)
"RTN","RORXU006",11,0)
 ; #???          The .01 field of file #40.8
"RTN","RORXU006",12,0)
 ;
"RTN","RORXU006",13,0)
 Q
"RTN","RORXU006",14,0)
 ;
"RTN","RORXU006",15,0)
 ;***** PROCESSES THE LIST OF CLINICS
"RTN","RORXU006",16,0)
 ;
"RTN","RORXU006",17,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU006",18,0)
 ;
"RTN","RORXU006",19,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU006",20,0)
 ;
"RTN","RORXU006",21,0)
 ; Return Values:
"RTN","RORXU006",22,0)
 ;       <0  Error code
"RTN","RORXU006",23,0)
 ;       >0  IEN of the CLINICS element
"RTN","RORXU006",24,0)
 ;
"RTN","RORXU006",25,0)
CLINLST(RORTSK,PARTAG) ;
"RTN","RORXU006",26,0)
 N IEN,LTAG,RORMSG,TMP
"RTN","RORXU006",27,0)
 I $D(RORTSK("PARAMS","CLINICS","C"))>1  D
"RTN","RORXU006",28,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"CLINICS",,PARTAG)  Q:LTAG'>0
"RTN","RORXU006",29,0)
 . S IEN=0
"RTN","RORXU006",30,0)
 . F  S IEN=$O(RORTSK("PARAMS","CLINICS","C",IEN))  Q:IEN'>0  D
"RTN","RORXU006",31,0)
 . . S TMP=$$GET1^DIQ(44,IEN_",",.01,,,"RORMSG")
"RTN","RORXU006",32,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,44,IEN_",")
"RTN","RORXU006",33,0)
 . . Q:TMP=""
"RTN","RORXU006",34,0)
 . . D ADDVAL^RORTSK11(RORTSK,"CLINIC",TMP,LTAG,,IEN)
"RTN","RORXU006",35,0)
 E  D:$$PARAM^RORTSK01("CLINICS","ALL")
"RTN","RORXU006",36,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"CLINICS","ALL",PARTAG)
"RTN","RORXU006",37,0)
 Q +$G(LTAG)
"RTN","RORXU006",38,0)
 ;
"RTN","RORXU006",39,0)
 ;***** PROCESSES THE LIST OF CPT CODES
"RTN","RORXU006",40,0)
 ;
"RTN","RORXU006",41,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU006",42,0)
 ;
"RTN","RORXU006",43,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU006",44,0)
 ;
"RTN","RORXU006",45,0)
 ; Return Values:
"RTN","RORXU006",46,0)
 ;       <0  Error code
"RTN","RORXU006",47,0)
 ;       >0  IEN of the CPTLST element
"RTN","RORXU006",48,0)
 ;
"RTN","RORXU006",49,0)
CPTLST(RORTSK,PARTAG) ;
"RTN","RORXU006",50,0)
 N CPT,IEN,LTAG,TMP
"RTN","RORXU006",51,0)
 I $D(RORTSK("PARAMS","CPTLST","C"))>1  D
"RTN","RORXU006",52,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"CPTLST",,PARTAG)  Q:LTAG'>0
"RTN","RORXU006",53,0)
 . S IEN=0
"RTN","RORXU006",54,0)
 . F  S IEN=$O(RORTSK("PARAMS","CPTLST","C",IEN))  Q:IEN'>0  D
"RTN","RORXU006",55,0)
 . . S CPT=$P(RORTSK("PARAMS","CPTLST","C",IEN),U)  Q:CPT=""
"RTN","RORXU006",56,0)
 . . D ADDVAL^RORTSK11(RORTSK,"CPT",CPT,LTAG,,IEN)
"RTN","RORXU006",57,0)
 E  D:$$PARAM^RORTSK01("CPTLST","ALL")
"RTN","RORXU006",58,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"CPTLST","ALL",PARTAG)
"RTN","RORXU006",59,0)
 Q +$G(LTAG)
"RTN","RORXU006",60,0)
 ;
"RTN","RORXU006",61,0)
 ;***** PROCESSES THE LIST OF DIVISIONS
"RTN","RORXU006",62,0)
 ;
"RTN","RORXU006",63,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU006",64,0)
 ;
"RTN","RORXU006",65,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU006",66,0)
 ;
"RTN","RORXU006",67,0)
 ; Return Values:
"RTN","RORXU006",68,0)
 ;       <0  Error code
"RTN","RORXU006",69,0)
 ;       >0  IEN of the DIVISIONS element
"RTN","RORXU006",70,0)
 ;
"RTN","RORXU006",71,0)
DIVLST(RORTSK,PARTAG) ;
"RTN","RORXU006",72,0)
 N IEN,LTAG,RORMSG,TMP
"RTN","RORXU006",73,0)
 I $D(RORTSK("PARAMS","DIVISIONS","C"))>1  D
"RTN","RORXU006",74,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"DIVISIONS",,PARTAG)  Q:LTAG'>0
"RTN","RORXU006",75,0)
 . S IEN=0
"RTN","RORXU006",76,0)
 . F  S IEN=$O(RORTSK("PARAMS","DIVISIONS","C",IEN))  Q:IEN'>0  D
"RTN","RORXU006",77,0)
 . . S TMP=$$GET1^DIQ(40.8,IEN_",",.01,,,"RORMSG")
"RTN","RORXU006",78,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,40.8,IEN_",")
"RTN","RORXU006",79,0)
 . . Q:TMP=""
"RTN","RORXU006",80,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DIVISION",TMP,LTAG,,IEN)
"RTN","RORXU006",81,0)
 E  D:$$PARAM^RORTSK01("DIVISIONS","ALL")
"RTN","RORXU006",82,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"DIVISIONS","ALL",PARTAG)
"RTN","RORXU006",83,0)
 Q +$G(LTAG)
"RTN","RORXU006",84,0)
 ;
"RTN","RORXU006",85,0)
 ;***** PROCESSES THE LIST OF ICD-9 CODES
"RTN","RORXU006",86,0)
 ;
"RTN","RORXU006",87,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU006",88,0)
 ;
"RTN","RORXU006",89,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU006",90,0)
 ;
"RTN","RORXU006",91,0)
 ; Return Values:
"RTN","RORXU006",92,0)
 ;       <0  Error code
"RTN","RORXU006",93,0)
 ;       >0  IEN of the ICD9LST element
"RTN","RORXU006",94,0)
 ;
"RTN","RORXU006",95,0)
ICD9LST(RORTSK,PARTAG) ;
"RTN","RORXU006",96,0)
 N ICD9,IEN,LTAG,TMP
"RTN","RORXU006",97,0)
 I $D(RORTSK("PARAMS","ICD9LST","C"))>1  D
"RTN","RORXU006",98,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"ICD9LST",,PARTAG)  Q:LTAG'>0
"RTN","RORXU006",99,0)
 . S IEN=0
"RTN","RORXU006",100,0)
 . F  S IEN=$O(RORTSK("PARAMS","ICD9LST","C",IEN))  Q:IEN'>0  D
"RTN","RORXU006",101,0)
 . . S ICD9=$P(RORTSK("PARAMS","ICD9LST","C",IEN),U)  Q:ICD9=""
"RTN","RORXU006",102,0)
 . . D ADDVAL^RORTSK11(RORTSK,"ICD9",ICD9,LTAG,,IEN)
"RTN","RORXU006",103,0)
 E  D:$$PARAM^RORTSK01("ICD9LST","ALL")
"RTN","RORXU006",104,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"ICD9LST","ALL",PARTAG)
"RTN","RORXU006",105,0)
 Q +$G(LTAG)
"RTN","RORXU006",106,0)
 ;
"RTN","RORXU006",107,0)
 ;***** PROCESSES THE LIST OF LAB TESTS
"RTN","RORXU006",108,0)
 ;
"RTN","RORXU006",109,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU006",110,0)
 ;
"RTN","RORXU006",111,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU006",112,0)
 ;
"RTN","RORXU006",113,0)
 ;
"RTN","RORXU006",114,0)
 ; .ROR8LST      Reference to a local variable, which contains a
"RTN","RORXU006",115,0)
 ;               closed root of an array. Descriptors of selected
"RTN","RORXU006",116,0)
 ;               lab tests will be returned into this array.
"RTN","RORXU006",117,0)
 ;
"RTN","RORXU006",118,0)
 ;                 @ROR8LTST@(ResultNode,TestIEN)
"RTN","RORXU006",119,0)
 ;                   ^01: Test IEN (in file #60)
"RTN","RORXU006",120,0)
 ;                   ^02: Test name
"RTN","RORXU006",121,0)
 ;                   ^03: 99
"RTN","RORXU006",122,0)
 ;                   ^04: "Other"
"RTN","RORXU006",123,0)
 ;                   ^05: Location subscript
"RTN","RORXU006",124,0)
 ;                   ^06: Result node
"RTN","RORXU006",125,0)
 ;
"RTN","RORXU006",126,0)
 ;               If this parameter is undefined or empty, then a
"RTN","RORXU006",127,0)
 ;               temporary buffer is allocated by the $$ALLOC^RORTMP
"RTN","RORXU006",128,0)
 ;               function and its root is returned via this parameter.
"RTN","RORXU006",129,0)
 ;
"RTN","RORXU006",130,0)
 ;               If all drugs are requested (the "ALL" attribute of
"RTN","RORXU006",131,0)
 ;               the "DRUGS" tag), then "*" is returned.
"RTN","RORXU006",132,0)
 ;
"RTN","RORXU006",133,0)
 ; [ROR8LRG]     Closed root of a node where the lab tests with
"RTN","RORXU006",134,0)
 ;               defined range values will be returned. By default
"RTN","RORXU006",135,0)
 ;               ($G(ROR8LRG)=""), this list is not compiled.
"RTN","RORXU006",136,0)
 ;
"RTN","RORXU006",137,0)
 ;                  @ROR8LRG@(TestIEN,
"RTN","RORXU006",138,0)
 ;                    "H") = Low
"RTN","RORXU006",139,0)
 ;                    "L") = High
"RTN","RORXU006",140,0)
 ;
"RTN","RORXU006",141,0)
 ;               "H", "L", or both will be defined.
"RTN","RORXU006",142,0)
 ;
"RTN","RORXU006",143,0)
 ; If the source list contains lab test panels, all corresponding
"RTN","RORXU006",144,0)
 ; lab tests are added to the @ROR8LST array but only a single tag
"RTN","RORXU006",145,0)
 ; is added to the XML list.
"RTN","RORXU006",146,0)
 ;
"RTN","RORXU006",147,0)
 ; Return Values:
"RTN","RORXU006",148,0)
 ;       <0  Error code
"RTN","RORXU006",149,0)
 ;       >0  IEN of the LABTESTS element
"RTN","RORXU006",150,0)
 ;
"RTN","RORXU006",151,0)
LTLST(RORTSK,PARTAG,ROR8LST,ROR8LRG) ;
"RTN","RORXU006",152,0)
 N ALL,BUF,I,LTAG,LTIEN,LTOPTS,TMP
"RTN","RORXU006",153,0)
 S ALL=+$$PARAM^RORTSK01("LABTESTS","ALL")
"RTN","RORXU006",154,0)
 S (LTAG,RC)=0
"RTN","RORXU006",155,0)
 ;
"RTN","RORXU006",156,0)
 ;=== Validate parameters
"RTN","RORXU006",157,0)
 I 'ALL  D  K @ROR8LST
"RTN","RORXU006",158,0)
 . S:$G(ROR8LST)="" ROR8LST=$$ALLOC^RORTMP()
"RTN","RORXU006",159,0)
 E  S ROR8LST="*"
"RTN","RORXU006",160,0)
 ;
"RTN","RORXU006",161,0)
 ;=== Process the drug options (if present)
"RTN","RORXU006",162,0)
 M LTOPTS=RORTSK("PARAMS","LABTESTS","A")
"RTN","RORXU006",163,0)
 I $D(LTOPTS)>1  D  Q:LTAG'>0 LTAG
"RTN","RORXU006",164,0)
 . N ATTR,REGIEN
"RTN","RORXU006",165,0)
 . S ATTR=$S(ALL:"ALL",1:"")
"RTN","RORXU006",166,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"LABTESTS",ATTR,PARTAG)
"RTN","RORXU006",167,0)
 . Q:LTAG'>0
"RTN","RORXU006",168,0)
 . ;--- Output option attributes
"RTN","RORXU006",169,0)
 . S ATTR="",RC=0
"RTN","RORXU006",170,0)
 . F  S ATTR=$O(LTOPTS(ATTR))  Q:ATTR=""  D  Q:RC<0
"RTN","RORXU006",171,0)
 . . S RC=$$ADDATTR^RORTSK11(RORTSK,LTAG,ATTR,"1")
"RTN","RORXU006",172,0)
 . I RC<0  S LTAG=RC  Q
"RTN","RORXU006",173,0)
 . S ATTR=$$OPTXT^RORXU002(.LTOPTS)
"RTN","RORXU006",174,0)
 . D:ATTR'="" ADDATTR^RORTSK11(RORTSK,LTAG,"DESCR",ATTR)
"RTN","RORXU006",175,0)
 ;
"RTN","RORXU006",176,0)
 ;=== Process the list of tests (if present)
"RTN","RORXU006",177,0)
 I 'ALL,$D(RORTSK("PARAMS","LABTESTS","C"))>1  D
"RTN","RORXU006",178,0)
 . I LTAG'>0  D  Q:LTAG'>0
"RTN","RORXU006",179,0)
 . . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"LABTESTS",,PARTAG)
"RTN","RORXU006",180,0)
 . S LTIEN=0
"RTN","RORXU006",181,0)
 . F  S LTIEN=$O(RORTSK("PARAMS","LABTESTS","C",LTIEN))  Q:LTIEN'>0  D
"RTN","RORXU006",182,0)
 . . D LTLSTI(LTIEN,LTAG)
"RTN","RORXU006",183,0)
 ;
"RTN","RORXU006",184,0)
 Q $S(RC<0:RC,1:LTAG)
"RTN","RORXU006",185,0)
 ;
"RTN","RORXU006",186,0)
 ;***** CREATES THE LAB TEST ITEM(S)
"RTN","RORXU006",187,0)
 ;
"RTN","RORXU006",188,0)
 ; LTIEN         IEN of the lab test in the file #60
"RTN","RORXU006",189,0)
 ; [LTAG]        IEN of the parent tag
"RTN","RORXU006",190,0)
 ;
"RTN","RORXU006",191,0)
 ; This is an internal entry point. Do NOT call it directly.
"RTN","RORXU006",192,0)
 ;
"RTN","RORXU006",193,0)
LTLSTI(LTIEN,LTAG) ;
"RTN","RORXU006",194,0)
 N BUF,I,IENS,ITEM,LTNAME,LTNODE,PLTCNT,RORBUF,RORMSG,TMP
"RTN","RORXU006",195,0)
 ;--- Load the lab test parameters
"RTN","RORXU006",196,0)
 S IENS=LTIEN_","
"RTN","RORXU006",197,0)
 D GETS^DIQ(60,IENS,".01;5","EI","RORBUF","RORMSG")
"RTN","RORXU006",198,0)
 D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,60,IENS)
"RTN","RORXU006",199,0)
 S LTNAME=$G(RORBUF(60,IENS,.01,"E"))  Q:LTNAME=""
"RTN","RORXU006",200,0)
 ;--- Output the tag and update the list of ranges
"RTN","RORXU006",201,0)
 D:$G(LTAG)>0
"RTN","RORXU006",202,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"LT",LTNAME,LTAG,,LTIEN)
"RTN","RORXU006",203,0)
 . S TMP=$$UP^XLFSTR($G(RORTSK("PARAMS","LABTESTS","C",LTIEN,"L")))
"RTN","RORXU006",204,0)
 . D:TMP'=""
"RTN","RORXU006",205,0)
 . . D ADDATTR^RORTSK11(RORTSK,ITEM,"LOW",TMP)
"RTN","RORXU006",206,0)
 . . S:$G(ROR8LRG)'="" @ROR8LRG@(LTIEN,"L")=TMP
"RTN","RORXU006",207,0)
 . S TMP=$$UP^XLFSTR($G(RORTSK("PARAMS","LABTESTS","C",LTIEN,"H")))
"RTN","RORXU006",208,0)
 . D:TMP'=""
"RTN","RORXU006",209,0)
 . . D ADDATTR^RORTSK11(RORTSK,ITEM,"HIGH",TMP)
"RTN","RORXU006",210,0)
 . . S:$G(ROR8LRG)'="" @ROR8LRG@(LTIEN,"H")=TMP
"RTN","RORXU006",211,0)
 ;--- Process the panel
"RTN","RORXU006",212,0)
 D ATESTS^ORWLRR(.BUF,LTIEN)
"RTN","RORXU006",213,0)
 I $D(BUF)>1  S I="",PLTCNT=0  D  Q:PLTCNT>1
"RTN","RORXU006",214,0)
 . F  S I=$O(BUF(I))  Q:I=""  D
"RTN","RORXU006",215,0)
 . . S TMP=+$P(BUF(I),U),PLTCNT=PLTCNT+1
"RTN","RORXU006",216,0)
 . . D:TMP'=LTIEN LTLSTI(TMP)
"RTN","RORXU006",217,0)
 ;--- Create the reference
"RTN","RORXU006",218,0)
 S LTNODE=$P($G(RORBUF(60,IENS,5,"I")),";",2)  Q:LTNODE=""
"RTN","RORXU006",219,0)
 S BUF=LTIEN_U_LTNAME_U_"99^Other"
"RTN","RORXU006",220,0)
 S $P(BUF,U,5)=$P(RORBUF(60,IENS,5,"I"),";")  ; Subscript
"RTN","RORXU006",221,0)
 S $P(BUF,U,6)=LTNODE                         ; Result node
"RTN","RORXU006",222,0)
 S @ROR8LST@(LTNODE,LTIEN)=BUF
"RTN","RORXU006",223,0)
 Q
"RTN","RORXU006",224,0)
 ;
"RTN","RORXU006",225,0)
 ;***** CHECKS IF THE OPTIONAL COLUMN IS SELECTED
"RTN","RORXU006",226,0)
 ;
"RTN","RORXU006",227,0)
 ; NAME          Column name
"RTN","RORXU006",228,0)
 ;
"RTN","RORXU006",229,0)
 ; Return Values:
"RTN","RORXU006",230,0)
 ;        0  Skip the field
"RTN","RORXU006",231,0)
 ;       >0  Include in report
"RTN","RORXU006",232,0)
 ;
"RTN","RORXU006",233,0)
OPTCOL(NAME) ;
"RTN","RORXU006",234,0)
 Q $S($G(NAME)'="":$D(RORTSK("PARAMS","OPTIONAL_COLUMNS","C",NAME)),1:0)
"RTN","RORXU006",235,0)
 ;
"RTN","RORXU006",236,0)
 ;***** CHECK IF ONLY THE SUMMARY SHOULD BE GENERATED
"RTN","RORXU006",237,0)
SMRYONLY() ;
"RTN","RORXU006",238,0)
 Q:$$PARAM^RORTSK01("MAXUTNUM")'="" 0
"RTN","RORXU006",239,0)
 Q:$$PARAM^RORTSK01("MINRPNUM")'="" 0
"RTN","RORXU006",240,0)
 Q 1
"RTN","RORXU007")
0^194^B43659053
"RTN","RORXU007",1,0)
RORXU007 ;HCIOFO/SG - PHARMACY-RELATED REPORT PARAMETERS ; 11/25/05 6:00pm
"RTN","RORXU007",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;;Feb 17, 2006
"RTN","RORXU007",3,0)
 ;
"RTN","RORXU007",4,0)
 ; This routine uses the following IAs:
"RTN","RORXU007",5,0)
 ;
"RTN","RORXU007",6,0)
 ; #4533         ZERO^PSS50 (supported)
"RTN","RORXU007",7,0)
 ; #4540         ZERO^PSN50P6 (supported)
"RTN","RORXU007",8,0)
 ; #4543         IEN^PSN50P65 (supported)
"RTN","RORXU007",9,0)
 ;
"RTN","RORXU007",10,0)
 Q
"RTN","RORXU007",11,0)
 ;
"RTN","RORXU007",12,0)
 ;***** PROCESSES THE "DRUGS" REPORT PARAMETER
"RTN","RORXU007",13,0)
 ;
"RTN","RORXU007",14,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU007",15,0)
 ;
"RTN","RORXU007",16,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU007",17,0)
 ;
"RTN","RORXU007",18,0)
 ; .ROR8LST      Reference to a local variable, which contains a
"RTN","RORXU007",19,0)
 ;               closed root of an array. IEN's of dispensed drugs
"RTN","RORXU007",20,0)
 ;               will be returned into this array.
"RTN","RORXU007",21,0)
 ;
"RTN","RORXU007",22,0)
 ;                 @ROR8LTST@(DrugIEN,Group#) = ""
"RTN","RORXU007",23,0)
 ;
"RTN","RORXU007",24,0)
 ;               If this parameter is undefined or empty, then a
"RTN","RORXU007",25,0)
 ;               temporary buffer is allocated by the $$ALLOC^RORTMP
"RTN","RORXU007",26,0)
 ;               function and its root is returned via this parameter.
"RTN","RORXU007",27,0)
 ;
"RTN","RORXU007",28,0)
 ;               If all drugs are requested (the "ALL" attribute of
"RTN","RORXU007",29,0)
 ;               the "DRUGS" tag), then "*" is returned.
"RTN","RORXU007",30,0)
 ;
"RTN","RORXU007",31,0)
 ; [.GRPLST]     Reference to a local variable that will contain
"RTN","RORXU007",32,0)
 ;               the list of drug groups.
"RTN","RORXU007",33,0)
 ;
"RTN","RORXU007",34,0)
 ;                 GRPLST(
"RTN","RORXU007",35,0)
 ;                   "C",Group#)    = GroupName
"RTN","RORXU007",36,0)
 ;                   "N",GroupName) = Group#
"RTN","RORXU007",37,0)
 ;
"RTN","RORXU007",38,0)
 ; Return Values:
"RTN","RORXU007",39,0)
 ;       <0  Error code
"RTN","RORXU007",40,0)
 ;       >0  IEN of the DRUGS element
"RTN","RORXU007",41,0)
 ;
"RTN","RORXU007",42,0)
DRUGLST(RORTSK,PARTAG,ROR8LST,GRPLST) ;
"RTN","RORXU007",43,0)
 N LTAG,RC,RXALL,RXOPTS,TMP
"RTN","RORXU007",44,0)
 S RXALL=+$$PARAM^RORTSK01("DRUGS","ALL")
"RTN","RORXU007",45,0)
 S (LTAG,RC)=0
"RTN","RORXU007",46,0)
 ;
"RTN","RORXU007",47,0)
 ;=== Validate parameters
"RTN","RORXU007",48,0)
 I RXALL  D  S ROR8LST="*"
"RTN","RORXU007",49,0)
 . F TMP="INVESTIG","REGMDES"  K RORTSK("PARAMS","DRUGS","A",TMP)
"RTN","RORXU007",50,0)
 E  D  K @ROR8LST
"RTN","RORXU007",51,0)
 . S:$G(ROR8LST)="" ROR8LST=$$ALLOC^RORTMP()
"RTN","RORXU007",52,0)
 . ;--- Aggregate by individual formulations if investigational
"RTN","RORXU007",53,0)
 . ;--- medications are selected (they are not linked to generics)
"RTN","RORXU007",54,0)
 . D:$$PARAM^RORTSK01("DRUGS","AGGR_GENERIC")
"RTN","RORXU007",55,0)
 . . N GRPNAME,INV,NODE
"RTN","RORXU007",56,0)
 . . I '$$PARAM^RORTSK01("DRUGS","INVESTIG")  S INV=0  D  Q:'INV
"RTN","RORXU007",57,0)
 . . . S NODE=$NA(RORTSK("PARAMS","DRUGS","G"))
"RTN","RORXU007",58,0)
 . . . S GRPNAME=""
"RTN","RORXU007",59,0)
 . . . F  S GRPNAME=$O(@NODE@(GRPNAME))  Q:GRPNAME=""  D  Q:INV
"RTN","RORXU007",60,0)
 . . . . S:$G(@NODE@(GRPNAME,"A","INVESTIG")) INV=1
"RTN","RORXU007",61,0)
 . . K RORTSK("PARAMS","DRUGS","A","AGGR_GENERIC")
"RTN","RORXU007",62,0)
 . . S RORTSK("PARAMS","DRUGS","A","AGGR_FORMUL")=1
"RTN","RORXU007",63,0)
 . . S RORTSK("PARAMS","DRUGS","A","AGGR_FORCED")=1
"RTN","RORXU007",64,0)
 ;
"RTN","RORXU007",65,0)
 ;=== Process the drug options (if present)
"RTN","RORXU007",66,0)
 M RXOPTS=RORTSK("PARAMS","DRUGS","A")
"RTN","RORXU007",67,0)
 I $D(RXOPTS)>1  D  Q:LTAG'>0 LTAG
"RTN","RORXU007",68,0)
 . N ATTR,REGIEN
"RTN","RORXU007",69,0)
 . S ATTR=$S(RXALL:"ALL",1:"")
"RTN","RORXU007",70,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"DRUGS",ATTR,PARTAG)
"RTN","RORXU007",71,0)
 . Q:LTAG'>0
"RTN","RORXU007",72,0)
 . ;--- Output option attributes
"RTN","RORXU007",73,0)
 . S ATTR="",RC=0
"RTN","RORXU007",74,0)
 . F  S ATTR=$O(RXOPTS(ATTR))  Q:ATTR=""  D  Q:RC<0
"RTN","RORXU007",75,0)
 . . S RC=$$ADDATTR^RORTSK11(RORTSK,LTAG,ATTR,"1")
"RTN","RORXU007",76,0)
 . I RC<0  S LTAG=RC  Q
"RTN","RORXU007",77,0)
 . S ATTR=$$OPTXT^RORXU002(.RXOPTS)
"RTN","RORXU007",78,0)
 . D:ATTR'="" ADDATTR^RORTSK11(RORTSK,LTAG,"DESCR",ATTR)
"RTN","RORXU007",79,0)
 . ;--- Add registry-specific and/or investigational drugs
"RTN","RORXU007",80,0)
 . Q:RXALL
"RTN","RORXU007",81,0)
 . S REGIEN=+$$PARAM^RORTSK01("REGIEN"),TMP="AR"
"RTN","RORXU007",82,0)
 . S:$G(RXOPTS("INVESTIG")) TMP=TMP_"C"
"RTN","RORXU007",83,0)
 . S:$G(RXOPTS("REGMEDS")) TMP=TMP_"DG"
"RTN","RORXU007",84,0)
 . S RC=$$DRUGLIST^RORUTL16(ROR8LST,REGIEN,TMP)
"RTN","RORXU007",85,0)
 ;
"RTN","RORXU007",86,0)
 ;=== Process the list of drugs (if present)
"RTN","RORXU007",87,0)
 I 'RXALL  D:$D(RORTSK("PARAMS","DRUGS","G"))>1
"RTN","RORXU007",88,0)
 . N GRPNAME,GRPTAG,IG,NODE
"RTN","RORXU007",89,0)
 . I LTAG'>0  D  Q:LTAG'>0
"RTN","RORXU007",90,0)
 . . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"DRUGS",,PARTAG)
"RTN","RORXU007",91,0)
 . ;---
"RTN","RORXU007",92,0)
 . S NODE=$NA(RORTSK("PARAMS","DRUGS","G"))
"RTN","RORXU007",93,0)
 . S GRPNAME="",RC=0
"RTN","RORXU007",94,0)
 . F  S GRPNAME=$O(@NODE@(GRPNAME))  Q:GRPNAME=""  D  Q:RC<0
"RTN","RORXU007",95,0)
 . . S IG=$O(GRPLST("C",""),-1)+1
"RTN","RORXU007",96,0)
 . . S GRPLST("C",IG)=GRPNAME,GRPLST("N",GRPNAME)=IG
"RTN","RORXU007",97,0)
 . . S GRPTAG=$$DRUGLST1(LTAG,GRPNAME,IG)
"RTN","RORXU007",98,0)
 . . I GRPTAG'>0  S RC=GRPTAG  Q
"RTN","RORXU007",99,0)
 . . ;--- Individual Formulations
"RTN","RORXU007",100,0)
 . . S RC=$$DRUGLSTF(GRPTAG,GRPNAME,IG)  Q:RC<0
"RTN","RORXU007",101,0)
 . . ;--- Generic Names
"RTN","RORXU007",102,0)
 . . S RC=$$DRUGLSTG(GRPTAG,GRPNAME,IG)  Q:RC<0
"RTN","RORXU007",103,0)
 . . ;--- Drug Classes
"RTN","RORXU007",104,0)
 . . S RC=$$DRUGLSTC(GRPTAG,GRPNAME,IG)  Q:RC<0
"RTN","RORXU007",105,0)
 ;
"RTN","RORXU007",106,0)
 ;===
"RTN","RORXU007",107,0)
 Q $S(RC<0:RC,1:LTAG)
"RTN","RORXU007",108,0)
 ;
"RTN","RORXU007",109,0)
 ;***** PROCESS THE GROUP ATTRIBUTES
"RTN","RORXU007",110,0)
 ;
"RTN","RORXU007",111,0)
 ; PTAG          Reference (IEN) to the parent tag
"RTN","RORXU007",112,0)
 ; GRPNAME       Group Name
"RTN","RORXU007",113,0)
 ; GRPCODE       Group Code (sequential number)
"RTN","RORXU007",114,0)
 ;
"RTN","RORXU007",115,0)
 ; Return Values:
"RTN","RORXU007",116,0)
 ;       <0  Error code
"RTN","RORXU007",117,0)
 ;       >0  IEN of the GROUP element
"RTN","RORXU007",118,0)
 ;
"RTN","RORXU007",119,0)
DRUGLST1(PTAG,GRPNAME,GRPCODE) ;
"RTN","RORXU007",120,0)
 N GRPOPTS,GRPTAG,RC,TMP
"RTN","RORXU007",121,0)
 ;--- Create the group tag
"RTN","RORXU007",122,0)
 S GRPTAG=$$ADDVAL^RORTSK11(RORTSK,"GROUP",,PTAG)
"RTN","RORXU007",123,0)
 Q:GRPTAG'>0 GRPTAG
"RTN","RORXU007",124,0)
 D ADDATTR^RORTSK11(RORTSK,GRPTAG,"NAME",GRPNAME)
"RTN","RORXU007",125,0)
 ;--- Process the group attributes
"RTN","RORXU007",126,0)
 M GRPOPTS=RORTSK("PARAMS","DRUGS","G",GRPNAME,"A")
"RTN","RORXU007",127,0)
 I $D(GRPOPTS)>1  S RC=0  D  Q:RC<0 RC
"RTN","RORXU007",128,0)
 . N ATTR,REGIEN  S ATTR=""
"RTN","RORXU007",129,0)
 . F  S ATTR=$O(GRPOPTS(ATTR))  Q:ATTR=""  D  Q:RC<0
"RTN","RORXU007",130,0)
 . . S RC=$$ADDATTR^RORTSK11(RORTSK,GRPTAG,ATTR,"1")
"RTN","RORXU007",131,0)
 . Q:RC<0
"RTN","RORXU007",132,0)
 . S TMP=$$OPTXT^RORXU002(.GRPOPTS)
"RTN","RORXU007",133,0)
 . D:TMP'="" ADDATTR^RORTSK11(RORTSK,GRPTAG,"DESCR",TMP)
"RTN","RORXU007",134,0)
 . ;--- Add registry-specific and/or investigational drugs
"RTN","RORXU007",135,0)
 . S REGIEN=+$$PARAM^RORTSK01("REGIEN"),TMP="AR"
"RTN","RORXU007",136,0)
 . S:$G(GRPOPTS("INVESTIG")) TMP=TMP_"C"
"RTN","RORXU007",137,0)
 . S:$G(GRPOPTS("REGMEDS")) TMP=TMP_"DG"
"RTN","RORXU007",138,0)
 . S RC=$$DRUGLIST^RORUTL16(ROR8LST,REGIEN,TMP,GRPCODE)
"RTN","RORXU007",139,0)
 ;---
"RTN","RORXU007",140,0)
 Q GRPTAG
"RTN","RORXU007",141,0)
 ;
"RTN","RORXU007",142,0)
 ;***** PROCESS DRUG CLASSES
"RTN","RORXU007",143,0)
 ;
"RTN","RORXU007",144,0)
 ; PTAG          Reference (IEN) to the parent tag
"RTN","RORXU007",145,0)
 ; GRPNAME       Group Name
"RTN","RORXU007",146,0)
 ; GRPCODE       Group Code (sequential number)
"RTN","RORXU007",147,0)
 ;
"RTN","RORXU007",148,0)
 ; Return Values:
"RTN","RORXU007",149,0)
 ;       <0  Error code
"RTN","RORXU007",150,0)
 ;       >0  IEN of the VARXCLS element
"RTN","RORXU007",151,0)
 ;
"RTN","RORXU007",152,0)
DRUGLSTC(PTAG,GRPNAME,GRPCODE) ;
"RTN","RORXU007",153,0)
 N CODE,IEN,LTAG,NODE,RORTMP,SUBS
"RTN","RORXU007",154,0)
 S NODE=$NA(RORTSK("PARAMS","DRUGS","G",GRPNAME,"VARXCLS"))
"RTN","RORXU007",155,0)
 Q:$D(@NODE)<10 0
"RTN","RORXU007",156,0)
 S LTAG=$$ADDVAL^RORTSK11(RORTSK,"VARXCLS",,PTAG)
"RTN","RORXU007",157,0)
 Q:LTAG<0 LTAG
"RTN","RORXU007",158,0)
 ;---
"RTN","RORXU007",159,0)
 S RORTMP=$$ALLOC^RORTMP(.SUBS)
"RTN","RORXU007",160,0)
 S IEN=0
"RTN","RORXU007",161,0)
 F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D
"RTN","RORXU007",162,0)
 . D IEN^PSN50P65(IEN,,SUBS)
"RTN","RORXU007",163,0)
 . S CODE=$G(@RORTMP@(IEN,.01))  Q:CODE=""
"RTN","RORXU007",164,0)
 . D ADDVAL^RORTSK11(RORTSK,"VARXCL",CODE,LTAG,,IEN)
"RTN","RORXU007",165,0)
 . D RXADDVCL^RORUTL16(ROR8LST,IEN,1,GRPCODE)
"RTN","RORXU007",166,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORXU007",167,0)
 ;---
"RTN","RORXU007",168,0)
 Q LTAG
"RTN","RORXU007",169,0)
 ;
"RTN","RORXU007",170,0)
 ;***** PROCESS INDIVIDUAL FORMULATIONS
"RTN","RORXU007",171,0)
 ;
"RTN","RORXU007",172,0)
 ; PTAG          Reference (IEN) to the parent tag
"RTN","RORXU007",173,0)
 ; GRPNAME       Group Name
"RTN","RORXU007",174,0)
 ; GRPCODE       Group Code (sequential number)
"RTN","RORXU007",175,0)
 ;
"RTN","RORXU007",176,0)
 ; Return Values:
"RTN","RORXU007",177,0)
 ;       <0  Error code
"RTN","RORXU007",178,0)
 ;       >0  IEN of the FORMULATIONS element
"RTN","RORXU007",179,0)
 ;
"RTN","RORXU007",180,0)
DRUGLSTF(PTAG,GRPNAME,GRPCODE) ;
"RTN","RORXU007",181,0)
 N IEN,LTAG,NAME,NODE,RORTMP,SUBS
"RTN","RORXU007",182,0)
 S NODE=$NA(RORTSK("PARAMS","DRUGS","G",GRPNAME,"FORMULATIONS"))
"RTN","RORXU007",183,0)
 Q:$D(@NODE)<10 0
"RTN","RORXU007",184,0)
 S LTAG=$$ADDVAL^RORTSK11(RORTSK,"FORMULATIONS",,PTAG)
"RTN","RORXU007",185,0)
 Q:LTAG<0 LTAG
"RTN","RORXU007",186,0)
 ;---
"RTN","RORXU007",187,0)
 S RORTMP=$$ALLOC^RORTMP(.SUBS)
"RTN","RORXU007",188,0)
 S IEN=0
"RTN","RORXU007",189,0)
 F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D
"RTN","RORXU007",190,0)
 . D ZERO^PSS50(IEN,,,,,SUBS)
"RTN","RORXU007",191,0)
 . S NAME=$G(@RORTMP@(IEN,.01))  Q:NAME=""
"RTN","RORXU007",192,0)
 . D ADDVAL^RORTSK11(RORTSK,"DRUG",NAME,LTAG,,IEN)
"RTN","RORXU007",193,0)
 . S @ROR8LST@(IEN,GRPCODE)=""
"RTN","RORXU007",194,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORXU007",195,0)
 ;---
"RTN","RORXU007",196,0)
 Q LTAG
"RTN","RORXU007",197,0)
 ;
"RTN","RORXU007",198,0)
 ;***** PROCESS GENERIC NAMES
"RTN","RORXU007",199,0)
 ;
"RTN","RORXU007",200,0)
 ; PTAG          Reference (IEN) to the parent tag
"RTN","RORXU007",201,0)
 ; GRPNAME       Group Name
"RTN","RORXU007",202,0)
 ; GRPCODE       Group Code (sequential number)
"RTN","RORXU007",203,0)
 ;
"RTN","RORXU007",204,0)
 ; Return Values:
"RTN","RORXU007",205,0)
 ;       <0  Error code
"RTN","RORXU007",206,0)
 ;       >0  IEN of the GENERIC element
"RTN","RORXU007",207,0)
 ;
"RTN","RORXU007",208,0)
DRUGLSTG(PTAG,GRPNAME,GRPCODE) ;
"RTN","RORXU007",209,0)
 N IEN,LTAG,NAME,NODE,RORTMP,SUBS
"RTN","RORXU007",210,0)
 S NODE=$NA(RORTSK("PARAMS","DRUGS","G",GRPNAME,"GENERIC"))
"RTN","RORXU007",211,0)
 Q:$D(@NODE)<10 0
"RTN","RORXU007",212,0)
 S LTAG=$$ADDVAL^RORTSK11(RORTSK,"GENERIC",,PTAG)
"RTN","RORXU007",213,0)
 Q:LTAG<0 LTAG
"RTN","RORXU007",214,0)
 ;---
"RTN","RORXU007",215,0)
 S RORTMP=$$ALLOC^RORTMP(.SUBS)
"RTN","RORXU007",216,0)
 S IEN=0
"RTN","RORXU007",217,0)
 F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D
"RTN","RORXU007",218,0)
 . D ZERO^PSN50P6(IEN,,,,SUBS)
"RTN","RORXU007",219,0)
 . S NAME=$G(@RORTMP@(IEN,.01))  Q:NAME=""
"RTN","RORXU007",220,0)
 . D ADDVAL^RORTSK11(RORTSK,"DRUG",NAME,LTAG,,IEN)
"RTN","RORXU007",221,0)
 . D RXADDGEN^RORUTL16(ROR8LST,IEN,1,GRPCODE)
"RTN","RORXU007",222,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORXU007",223,0)
 ;---
"RTN","RORXU007",224,0)
 Q LTAG
"RTN","RORXU007",225,0)
 ;
"RTN","RORXU007",226,0)
 ;***** FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORXU007",227,0)
 ;
"RTN","RORXU007",228,0)
 ; .RORDST       Reference to the search descriptor
"RTN","RORXU007",229,0)
 ; DRUGIEN       IEN of an individual formulation (dispensed drug)
"RTN","RORXU007",230,0)
 ; ROR8LST       Closed root of the drug list generated by the
"RTN","RORXU007",231,0)
 ;               $$DRUGLST^RORXU007 function or "*" for all drugs.
"RTN","RORXU007",232,0)
 ;
"RTN","RORXU007",233,0)
 ; Return Values:
"RTN","RORXU007",234,0)
 ;        0  Ok
"RTN","RORXU007",235,0)
 ;        1  Skip the record
"RTN","RORXU007",236,0)
 ;
"RTN","RORXU007",237,0)
RXGRPCHK(RORDST,DRUGIEN,ROR8LST) ;
"RTN","RORXU007",238,0)
 Q:ROR8LST="*" 0
"RTN","RORXU007",239,0)
 Q:$D(@ROR8LST@(DRUGIEN))<10 1
"RTN","RORXU007",240,0)
 N GRP  S GRP=""
"RTN","RORXU007",241,0)
 F  S GRP=$O(@ROR8LST@(DRUGIEN,GRP))  Q:GRP=""  D
"RTN","RORXU007",242,0)
 . K RORDST("RORXGRP",GRP)
"RTN","RORXU007",243,0)
 Q 0
"SEC","^DD",798.1,798.1,21.04,8)

"SEC","^DD",798.1,798.1,29,9)

"SEC","^DD",798.1,798.128,.01,8)

"SEC","^DD",798.1,798.129,.01,8.5)

"SEC","^DD",798.1,798.129,.01,9)

"SEC","^DD",798.3,798.31,2,8.5)

"SEC","^DD",798.3,798.31,2,9)

"SEC","^DD",798.7,798.74,2,9)

"SEC","^DD",799.1,799.1,.02,8)

"SEC","^DD",799.4,799.4,10,9)

"SEC","^DD",799.4,799.41,.01,8.5)

"SEC","^DD",799.4,799.41,.01,9)

"SEC","^DD",799.4,799.41,.02,8.5)

"SEC","^DD",799.4,799.41,.02,9)

"SEC","^DD",799.4,799.41,.03,8.5)

"SEC","^DD",799.4,799.41,.03,9)

"SEC","^DD",799.6,799.6,.09,8)

"SEC","^DD",799.6,799.6,2,8.5)

"SEC","^DD",799.6,799.6,2,9)

"SEC","^DIC",798,798,0,"AUDIT")

"SEC","^DIC",798,798,0,"DD")
@
"SEC","^DIC",798,798,0,"DEL")
@
"SEC","^DIC",798,798,0,"LAYGO")
@
"SEC","^DIC",798,798,0,"RD")

"SEC","^DIC",798,798,0,"WR")
@
"SEC","^DIC",798.1,798.1,0,"AUDIT")
@
"SEC","^DIC",798.1,798.1,0,"DD")
@
"SEC","^DIC",798.1,798.1,0,"DEL")
@
"SEC","^DIC",798.1,798.1,0,"LAYGO")
@
"SEC","^DIC",798.1,798.1,0,"RD")

"SEC","^DIC",798.1,798.1,0,"WR")
@
"SEC","^DIC",798.2,798.2,0,"AUDIT")

"SEC","^DIC",798.2,798.2,0,"DD")
@
"SEC","^DIC",798.2,798.2,0,"DEL")
@
"SEC","^DIC",798.2,798.2,0,"LAYGO")
@
"SEC","^DIC",798.2,798.2,0,"RD")

"SEC","^DIC",798.2,798.2,0,"WR")
@
"SEC","^DIC",798.3,798.3,0,"AUDIT")

"SEC","^DIC",798.3,798.3,0,"DD")
@
"SEC","^DIC",798.3,798.3,0,"DEL")
@
"SEC","^DIC",798.3,798.3,0,"LAYGO")
@
"SEC","^DIC",798.3,798.3,0,"RD")

"SEC","^DIC",798.3,798.3,0,"WR")
@
"SEC","^DIC",798.4,798.4,0,"AUDIT")

"SEC","^DIC",798.4,798.4,0,"DD")
@
"SEC","^DIC",798.4,798.4,0,"DEL")
@
"SEC","^DIC",798.4,798.4,0,"LAYGO")
@
"SEC","^DIC",798.4,798.4,0,"RD")

"SEC","^DIC",798.4,798.4,0,"WR")
@
"SEC","^DIC",798.6,798.6,0,"AUDIT")

"SEC","^DIC",798.6,798.6,0,"DD")
@
"SEC","^DIC",798.6,798.6,0,"DEL")
@
"SEC","^DIC",798.6,798.6,0,"LAYGO")
@
"SEC","^DIC",798.6,798.6,0,"RD")

"SEC","^DIC",798.6,798.6,0,"WR")
@
"SEC","^DIC",798.7,798.7,0,"AUDIT")

"SEC","^DIC",798.7,798.7,0,"DD")
@
"SEC","^DIC",798.7,798.7,0,"DEL")
@
"SEC","^DIC",798.7,798.7,0,"LAYGO")
@
"SEC","^DIC",798.7,798.7,0,"RD")

"SEC","^DIC",798.7,798.7,0,"WR")
@
"SEC","^DIC",798.8,798.8,0,"AUDIT")
@
"SEC","^DIC",798.8,798.8,0,"DD")
@
"SEC","^DIC",798.8,798.8,0,"DEL")
@
"SEC","^DIC",798.8,798.8,0,"LAYGO")
@
"SEC","^DIC",798.8,798.8,0,"RD")

"SEC","^DIC",798.8,798.8,0,"WR")
@
"SEC","^DIC",798.9,798.9,0,"AUDIT")

"SEC","^DIC",798.9,798.9,0,"DD")
@
"SEC","^DIC",798.9,798.9,0,"DEL")
@
"SEC","^DIC",798.9,798.9,0,"LAYGO")
@
"SEC","^DIC",798.9,798.9,0,"RD")

"SEC","^DIC",798.9,798.9,0,"WR")
@
"SEC","^DIC",799.1,799.1,0,"AUDIT")

"SEC","^DIC",799.1,799.1,0,"DD")
@
"SEC","^DIC",799.1,799.1,0,"DEL")
@
"SEC","^DIC",799.1,799.1,0,"LAYGO")
@
"SEC","^DIC",799.1,799.1,0,"RD")

"SEC","^DIC",799.1,799.1,0,"WR")
@
"SEC","^DIC",799.2,799.2,0,"AUDIT")

"SEC","^DIC",799.2,799.2,0,"DD")
@
"SEC","^DIC",799.2,799.2,0,"DEL")
@
"SEC","^DIC",799.2,799.2,0,"LAYGO")
@
"SEC","^DIC",799.2,799.2,0,"RD")

"SEC","^DIC",799.2,799.2,0,"WR")
@
"SEC","^DIC",799.31,799.31,0,"AUDIT")
@
"SEC","^DIC",799.31,799.31,0,"DD")
@
"SEC","^DIC",799.31,799.31,0,"DEL")
@
"SEC","^DIC",799.31,799.31,0,"LAYGO")
@
"SEC","^DIC",799.31,799.31,0,"RD")

"SEC","^DIC",799.31,799.31,0,"WR")
@
"SEC","^DIC",799.33,799.33,0,"AUDIT")
@
"SEC","^DIC",799.33,799.33,0,"DD")
@
"SEC","^DIC",799.33,799.33,0,"DEL")
@
"SEC","^DIC",799.33,799.33,0,"LAYGO")
@
"SEC","^DIC",799.33,799.33,0,"RD")

"SEC","^DIC",799.33,799.33,0,"WR")
@
"SEC","^DIC",799.34,799.34,0,"AUDIT")
@
"SEC","^DIC",799.34,799.34,0,"DD")
@
"SEC","^DIC",799.34,799.34,0,"DEL")
@
"SEC","^DIC",799.34,799.34,0,"LAYGO")
@
"SEC","^DIC",799.34,799.34,0,"RD")
@
"SEC","^DIC",799.34,799.34,0,"WR")
@
"SEC","^DIC",799.4,799.4,0,"AUDIT")
@
"SEC","^DIC",799.4,799.4,0,"DD")
@
"SEC","^DIC",799.4,799.4,0,"DEL")
@
"SEC","^DIC",799.4,799.4,0,"LAYGO")
@
"SEC","^DIC",799.4,799.4,0,"RD")

"SEC","^DIC",799.4,799.4,0,"WR")
@
"SEC","^DIC",799.49,799.49,0,"AUDIT")
@
"SEC","^DIC",799.49,799.49,0,"DD")
@
"SEC","^DIC",799.49,799.49,0,"DEL")
@
"SEC","^DIC",799.49,799.49,0,"LAYGO")
@
"SEC","^DIC",799.49,799.49,0,"RD")

"SEC","^DIC",799.49,799.49,0,"WR")
@
"SEC","^DIC",799.51,799.51,0,"AUDIT")
@
"SEC","^DIC",799.51,799.51,0,"DD")
@
"SEC","^DIC",799.51,799.51,0,"DEL")
@
"SEC","^DIC",799.51,799.51,0,"LAYGO")
@
"SEC","^DIC",799.51,799.51,0,"RD")

"SEC","^DIC",799.51,799.51,0,"WR")
@
"SEC","^DIC",799.53,799.53,0,"AUDIT")
@
"SEC","^DIC",799.53,799.53,0,"DD")
@
"SEC","^DIC",799.53,799.53,0,"DEL")
@
"SEC","^DIC",799.53,799.53,0,"LAYGO")
@
"SEC","^DIC",799.53,799.53,0,"RD")

"SEC","^DIC",799.53,799.53,0,"WR")
@
"SEC","^DIC",799.6,799.6,0,"AUDIT")
@
"SEC","^DIC",799.6,799.6,0,"DD")
@
"SEC","^DIC",799.6,799.6,0,"DEL")
@
"SEC","^DIC",799.6,799.6,0,"LAYGO")
@
"SEC","^DIC",799.6,799.6,0,"RD")

"SEC","^DIC",799.6,799.6,0,"WR")
@
"TEMP","ROR GENERIC DRUG",1,0)
1^ABACAVIR^VA HIV^99^3535^ABACAVIR^1
"TEMP","ROR GENERIC DRUG",2,0)
22^ABACAVIR/LAMIVUDINE/ZIDOVUDINE^VA HIV^99^3677^ABACAVIR/LAMIVUDINE/ZIDOVUDINE^1
"TEMP","ROR GENERIC DRUG",3,0)
3^AMPRENAVIR^VA HIV^99^3568^AMPRENAVIR^1
"TEMP","ROR GENERIC DRUG",4,0)
24^ATAZANAVIR^VA HIV^99^3890^ATAZANAVIR^1
"TEMP","ROR GENERIC DRUG",5,0)
4^DELAVIRDINE^VA HIV^99^3395^DELAVIRDINE^1
"TEMP","ROR GENERIC DRUG",6,0)
5^DIDANOSINE^VA HIV^99^2576^DIDANOSINE^1
"TEMP","ROR GENERIC DRUG",7,0)
6^EFAVIRENZ^VA HIV^99^3528^EFAVIRENZ^1
"TEMP","ROR GENERIC DRUG",8,0)
25^EMTRICITABINE^VA HIV^99^3888^EMTRICITABINE^1
"TEMP","ROR GENERIC DRUG",9,0)
23^ENFUVIRTIDE^VA HIV^99^3864^ENFUVIRTIDE^1
"TEMP","ROR GENERIC DRUG",10,0)
27^EPZICOM^VA HIV^99^3994^ABACAVIR/LAMIVUDINE^1
"TEMP","ROR GENERIC DRUG",11,0)
26^FOSAMPRENAVIR^VA HIV^99^3918^FOSAMPRENAVIR^1
"TEMP","ROR GENERIC DRUG",12,0)
7^INDINAVIR^VA HIV^99^3350^INDINAVIR^1
"TEMP","ROR GENERIC DRUG",13,0)
29^INTERFERON ALFA-2A^VA HEPC^99^183^INTERFERON ALFA-2A^1
"TEMP","ROR GENERIC DRUG",14,0)
30^INTERFERON ALFA-2B^VA HEPC^99^1139^INTERFERON ALFA-2B^1
"TEMP","ROR GENERIC DRUG",15,0)
32^INTERFERON ALFA-2B/RIBAVIRIN^VA HEPC^99^3510^INTERFERON ALFA-2B/RIBAVIRIN^1
"TEMP","ROR GENERIC DRUG",16,0)
31^INTERFERON ALFACON-1^VA HEPC^99^3454^INTERFERON ALFACON-1^1
"TEMP","ROR GENERIC DRUG",17,0)
8^LAMIVUDINE^VA HIV^99^3315^LAMIVUDINE^1
"TEMP","ROR GENERIC DRUG",18,0)
16^LAMIVUDINE/ZIDOVUDINE^VA HIV^99^3465^LAMIVUDINE/ZIDOVUDINE^1
"TEMP","ROR GENERIC DRUG",19,0)
17^LOPINAVIR/RITONAVIR^VA HIV^99^3660^LOPINAVIR/RITONAVIR^1
"TEMP","ROR GENERIC DRUG",20,0)
9^NELFINAVIR^VA HIV^99^3394^NELFINAVIR^1
"TEMP","ROR GENERIC DRUG",21,0)
10^NEVIRAPINE^VA HIV^99^3377^NEVIRAPINE^1
"TEMP","ROR GENERIC DRUG",22,0)
33^PEGINTERFERON^VA HEPC^99^3693^PEGINTERFERON^1
"TEMP","ROR GENERIC DRUG",23,0)
34^PEGINTERFERON/RIBAVIRIN^VA HEPC^99^3835^PEGINTERFERON/RIBAVIRIN^1
"TEMP","ROR GENERIC DRUG",24,0)
35^RIBAVIRIN^VA HEPC^99^1909^RIBAVIRIN^1
"TEMP","ROR GENERIC DRUG",25,0)
11^RITONAVIR^VA HIV^99^3349^RITONAVIR^1
"TEMP","ROR GENERIC DRUG",26,0)
12^SAQUINAVIR^VA HIV^99^3316^SAQUINAVIR^1
"TEMP","ROR GENERIC DRUG",27,0)
13^STAVUDINE (dT4)^VA HIV^99^3225^STAVUDINE (dT4)^1
"TEMP","ROR GENERIC DRUG",28,0)
21^TENOFOVIR^VA HIV^99^3724^TENOFOVIR^1
"TEMP","ROR GENERIC DRUG",29,0)
28^TRUVADA^VA HIV^99^3990^EMTRICITABINE/TENOFOVIR^1
"TEMP","ROR GENERIC DRUG",30,0)
14^ZALCITABINE^VA HIV^99^2270^ZALCITABINE^1
"TEMP","ROR GENERIC DRUG",31,0)
15^ZIDOVUDINE^VA HIV^99^2147^ZIDOVUDINE^1
"TEMP","ROR LIST ITEM",1,0)
29^HepC Ab^Lab Group^VA HEPC^1^
"TEMP","ROR LIST ITEM",2,0)
30^HepC RIBA^Lab Group^VA HEPC^2^
"TEMP","ROR LIST ITEM",3,0)
31^HepC Qual^Lab Group^VA HEPC^3^
"TEMP","ROR LIST ITEM",4,0)
32^HepC Quant^Lab Group^VA HEPC^4^
"TEMP","ROR LIST ITEM",5,0)
33^HepC GT^Lab Group^VA HEPC^5^
"TEMP","ROR LIST ITEM",6,0)
17^CD4#^Lab Group^VA HIV^1^
"TEMP","ROR LIST ITEM",7,0)
18^CD4%^Lab Group^VA HIV^2^
"TEMP","ROR LIST ITEM",8,0)
19^HIV VL^Lab Group^VA HIV^3^
"TEMP","ROR LIST ITEM",9,0)
28^HIV Ab^Lab Group^VA HIV^4^
"TEMP","ROR LIST ITEM",10,0)
34^HIV WB^Lab Group^VA HIV^5^
"TEMP","ROR LIST ITEM",11,0)
27^Default (HepC)^Drug Group^VA HEPC^99^
"TEMP","ROR LIST ITEM",12,0)
20^Default (HIV)^Drug Group^VA HIV^99^
"TEMP","RORCDCDEF",1)

"TEMP","RORCDCDEF",2)
edt1_1=^^548^87^32^^49^^^^1^^^^^^Name
"TEMP","RORCDCDEF",3)
edt1_3=^^246^178^22^^49^^^^1^ADR^3^^13^^Address
"TEMP","RORCDCDEF",4)
edt1_4=^^1083^178^22^^49^^^^1^ADR^6^^13^^City
"TEMP","RORCDCDEF",5)
edt1_5=^^1512^178^22^^49^^^^1^ADR^12^^13^^County
"TEMP","RORCDCDEF",6)
edt1_6=^^2205^178^22^^49^^^^1^ADR^9^^13^^ZIP
"TEMP","RORCDCDEF",7)
cmbb1_1=^^1872^176^24^^49^^^^1^ADR^8^^13^^
"TEMP","RORCDCDEF",8)
edt1_2=^^2020^108^22^^49^^^^1^ADR^13^^13^^Phone
"TEMP","RORCDCDEF",9)
edt1_7=^^1872^178^22^^49^^^^1^ADR^^^^^State
"TEMP","RORCDCDEF",10)
dtp2_1=^^161^567^30^MMDDYY^49^117^^^1^HDR^3^^6^^Date form was Completed
"TEMP","RORCDCDEF",11)
edt2_1=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",12)
edt2_2=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",13)
edt2_3=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",14)
edt2_4=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",15)
edt2_5=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",16)
edt2_6=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",17)
chkb2_1=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",18)
chkb2_2=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",19)
edt3_3_1=^^1985^871^22^^49^^^^1^CDM^6^^8^^Territory of death
"TEMP","RORCDCDEF",20)
chkb3_3_1=^^1301^910^25^^49^^^^1^CDM^1^^14^^Current Status Alive
"TEMP","RORCDCDEF",21)
chkb3_3_2=^^1393^910^25^^49^^^^1^CDM^2^^14^^Current Status Dead
"TEMP","RORCDCDEF",22)
chkb3_3_3=^^1485^910^25^^49^^^^1^CDM^9^^14^^Current Status Unk
"TEMP","RORCDCDEF",23)
edt3_3_2=^^1607^902^30^MMDDYY^58^116^^^1^DEM^7^^14^^Date of Death
"TEMP","RORCDCDEF",24)
edt3_2_1=^^885^902^30^MMDDYY^58^115^^^1^DEM^5^^8^^Date of Birth
"TEMP","RORCDCDEF",25)
edt3_1_2=^^574^910^30^BoxedLine^54^2^^^1^CDM^4^^14^^AIDS age
"TEMP","RORCDCDEF",26)
chkb3_1_1=^^126^868^25^^49^^^^1^CDM^3^1^14^^Diagnostic status HIV
"TEMP","RORCDCDEF",27)
chkb3_1_2=^^126^923^25^^49^^^^1^CDM^3^2^14^^Diagnostic status AIDS
"TEMP","RORCDCDEF",28)
edt3_1_1=^^574^848^30^BoxedLine^54^2^^^1^CDM^4^^14^^HIV Age
"TEMP","RORCDCDEF",29)
chkb3_5_1=^^355^1040^25^^49^^^^1^ETN^3^2135-2^6^^Ethnicity Hispanic
"TEMP","RORCDCDEF",30)
chkb3_5_2=^^543^1039^25^^49^^^^1^ETN^3^2186-5^6^^Ethnicity Unk
"TEMP","RORCDCDEF",31)
chkb3_5_3=^^355^1101^25^^49^^^^1^ETN^3^9999-4^6^^Ethnicity Not Hispanic
"TEMP","RORCDCDEF",32)
chkb3_4_1=^^127^1040^25^^49^^^^1^DEM^8^M^8^^Sex Male
"TEMP","RORCDCDEF",33)
chkb3_4_2=^^126^1106^25^^49^^^^1^DEM^8^F^8^^Sex Female
"TEMP","RORCDCDEF",34)
chkb3_6_1=^^730^1039^25^^49^^^^1^RCE^3^1002-5^6^^Race American
"TEMP","RORCDCDEF",35)
chkb3_6_2=^^730^1118^25^^49^^^^1^RCE^3^2028-9^6^^Race Asian
"TEMP","RORCDCDEF",36)
chkb3_6_4=^^864^1119^25^^49^^^^1^RCE^3^2054-5^6^^Race Hawaiian
"TEMP","RORCDCDEF",37)
chkb3_6_3=^^1001^1039^25^^49^^^^1^RCE^3^2076-8^6^^Race Black Am
"TEMP","RORCDCDEF",38)
chkb3_6_6=^^1334^1115^25^^49^^^^1^RCE^3^2106-3^6^^Race Unkn.
"TEMP","RORCDCDEF",39)
chkb3_6_5=^^1189^1114^25^^49^^^^1^RCE^3^9999-4^6^^Race White
"TEMP","RORCDCDEF",40)
chkb3_7_1=^^1501^1019^25^^49^^^^1^CDM^7^1^14^^Country of Birth USA
"TEMP","RORCDCDEF",41)
chkb3_7_2=^^1643^1018^25^^49^^^^1^CDM^7^7^14^^Country of Birth US Depend
"TEMP","RORCDCDEF",42)
chkb3_7_4=^^2339^1123^25^^49^^^^1^CDM^7^9^14^^Country of Birth Unk.
"TEMP","RORCDCDEF",43)
edt3_7_1=^^1811^1065^22^^49^^^^1^CDM^8^^14^^Country of Birth USA Dep Name
"TEMP","RORCDCDEF",44)
chkb3_7_3=^^1501^1119^25^^49^^^^1^CDM^7^8^14^^Country of Birth Other
"TEMP","RORCDCDEF",45)
edt3_7_2=^^1765^1122^22^^49^^^^1^CDM^8^^14^^Country of Birth Other Name
"TEMP","RORCDCDEF",46)
edt3_8_2=^^864^1234^22^^49^^^^1^CDM^10^^14^^Residence County
"TEMP","RORCDCDEF",47)
edt3_8_1=^^214^1234^22^^49^^^^1^CDM^9^^14^^Residence City
"TEMP","RORCDCDEF",48)
edt3_8_4=^^1974^1215^30^BoxedLine^49^9^^^1^CDM^14^^14^ZIP^Residence ZIP
"TEMP","RORCDCDEF",49)
edt3_8_5=^^1383^1234^22^^49^^^^1^CDM^13^^14^^Residence Country
"TEMP","RORCDCDEF",50)
cmbb3_8_1=^^1383^1234^22^^49^^^^1^CDM^11^^14^^Residence State
"TEMP","RORCDCDEF",51)
chkb4_3_1=^^130^1806^25^^49^^^^1^FD^9^01^10^^Diagnostic Facility Type Physitcan, HMO
"TEMP","RORCDCDEF",52)
chkb4_3_2=^^484^1806^25^^49^^^^1^FD^9^31^10^^Diagnostic Facility Type Inpatient
"TEMP","RORCDCDEF",53)
chkb4_3_3=^^129^1865^25^^49^^^^1^FD^9^88^10^^Diagnostic Facility Type Other
"TEMP","RORCDCDEF",54)
edt4_3_1=^^397^1859^22^^49^^^^1^FD^10^^10^^Diagnostic Facility Type Other Name
"TEMP","RORCDCDEF",55)
chkb4_2_1=^^130^1694^25^^49^^^^1^FD^8^1^10^^Diagnostic Facility Setting Public
"TEMP","RORCDCDEF",56)
chkb4_2_2=^^339^1694^25^^49^^^^1^FD^8^2^10^^Diagnostic Facility Setting Private
"TEMP","RORCDCDEF",57)
chkb4_2_3=^^551^1694^25^^49^^^^1^FD^8^3^10^^Diagnostic Facility Setting  Federal
"TEMP","RORCDCDEF",58)
chkb4_2_4=^^772^1694^25^^49^^^^1^FD^8^9^10^^Diagnostic Facility Setting Unk
"TEMP","RORCDCDEF",59)
edt4_1_1=^^125^1402^22^^49^^^^1^FD^3^^10^^Diagnostic Facility Name
"TEMP","RORCDCDEF",60)
edt4_1_2=^^125^1474^22^^49^^^^1^FD^4^^10^^Diagnostic Facility City
"TEMP","RORCDCDEF",61)
edt4_1_4=^^125^1550^22^^49^^^^1^FD^7^^10^^Facility Country
"TEMP","RORCDCDEF",62)
cmbb4_1_1=^^125^1550^22^^49^^^^1^FD^5^^10^^Diagnostic Facility Setting  State
"TEMP","RORCDCDEF",63)
chkb5_14_1=^^2228^2209^24^^49^^^^1^PH^19^1^20^^Work in Clinical Lab Yes
"TEMP","RORCDCDEF",64)
chkb5_14_2=^^2316^2209^24^^49^^^^1^PH^19^0^20^^Work in Clinical Lab No
"TEMP","RORCDCDEF",65)
chkb5_14_3=^^2399^2209^24^^49^^^^1^PH^19^9^20^^Work in Clinical Lab Unk.
"TEMP","RORCDCDEF",66)
edt5_14_1=^^1420^2257^22^^49^^^^1^PH^20^^20^^Work in Clinical Lab Name
"TEMP","RORCDCDEF",67)
chkb5_12_1=^^2228^2163^24^^49^^^^1^PH^18^1^20^^Received Transpalnt Yes
"TEMP","RORCDCDEF",68)
chkb5_12_2=^^2316^2163^24^^49^^^^1^PH^18^0^20^^Received Transpalnt No
"TEMP","RORCDCDEF",69)
chkb5_12_3=^^2398^2163^24^^49^^^^1^PH^18^9^20^^Received Transpalnt Unk
"TEMP","RORCDCDEF",70)
chkb5_11_1=^^2228^2038^24^^49^^^^1^PH^15^1^20^^Received Transfusion Yes
"TEMP","RORCDCDEF",71)
chkb5_11_2=^^2316^2038^24^^49^^^^1^PH^15^0^20^^Received Transfusion No
"TEMP","RORCDCDEF",72)
chkb5_11_3=^^2399^2038^24^^49^^^^1^PH^15^9^20^^Received Transfusion Unk
"TEMP","RORCDCDEF",73)
edV_FirstYear=^^1357^2107^30^MMYY^50^170^^^1^PH^16^^20^MM/YY^Received Transfusion First
"TEMP","RORCDCDEF",74)
edV_LastYear=^^1766^2107^30^MMYY^50^170^^^1^PH^17^^20^MM/YY^Received Transfusion Last
"TEMP","RORCDCDEF",75)
chkb5_10_1=^^2228^1992^24^^49^^^^1^PH^14^1^20^^Hetero SR with Person with AIDS Yes
"TEMP","RORCDCDEF",76)
chkb5_10_2=^^2316^1992^24^^49^^^^1^PH^14^0^20^^Hetero SR with Person with AIDS No
"TEMP","RORCDCDEF",77)
chkb5_10_3=^^2398^1992^24^^49^^^^1^PH^14^9^20^^Hetero SR with Person with AIDS Unk.
"TEMP","RORCDCDEF",78)
chkb5_9_1=^^2228^1946^25^^49^^^^1^PH^13^1^20^^Hetero SR with Transplant recepient Yes
"TEMP","RORCDCDEF",79)
chkb5_9_2=^^2315^1946^25^^49^^^^1^PH^13^0^20^^Hetero SR with Transplant recepient No
"TEMP","RORCDCDEF",80)
chkb5_9_3=^^2398^1946^25^^49^^^^1^PH^13^9^20^^Hetero SR with Transplant recepient Unk
"TEMP","RORCDCDEF",81)
chkb5_8_1=^^2228^1901^24^^49^^^^1^PH^12^1^20^^Hetero SR with Transfusion recepient Yes
"TEMP","RORCDCDEF",82)
chkb5_8_2=^^2316^1901^24^^49^^^^1^PH^12^0^20^^Hetero SR with Transfusion recepient No
"TEMP","RORCDCDEF",83)
chkb5_8_3=^^2399^1901^24^^49^^^^1^PH^12^9^20^^Hetero SR with Transfusion recepient Unk
"TEMP","RORCDCDEF",84)
chkb5_7_1=^^2228^1855^24^^49^^^^1^PH^11^1^20^^Hetero SR with Hemofilia Yes
"TEMP","RORCDCDEF",85)
chkb5_7_2=^^2316^1855^24^^49^^^^1^PH^11^0^20^^Hetero SR with Hemofilia  No
"TEMP","RORCDCDEF",86)
chkb5_7_3=^^2398^1855^24^^49^^^^1^PH^11^9^20^^Hetero SR with Hemofilia Unk
"TEMP","RORCDCDEF",87)
chkb5_6_1=^^2228^1809^24^^49^^^^1^PH^9^1^20^^Hetero SR with Bisexual  male Yes
"TEMP","RORCDCDEF",88)
chkb5_6_2=^^2316^1809^24^^49^^^^1^PH^9^0^20^^Hetero SR with Bisexual  male No
"TEMP","RORCDCDEF",89)
chkb5_6_3=^^2398^1809^24^^49^^^^1^PH^9^9^20^^Hetero SR with Bisexual  male Unk
"TEMP","RORCDCDEF",90)
chkb5_5_1=^^2228^1763^24^^49^^^^1^PH^10^1^20^^Hetero SR with Intravenoue Yes
"TEMP","RORCDCDEF",91)
chkb5_5_2=^^2316^1763^24^^49^^^^1^PH^10^0^20^^Hetero SR with Intravenoue No
"TEMP","RORCDCDEF",92)
chkb5_5_3=^^2398^1763^24^^49^^^^1^PH^10^9^20^^Hetero SR with Intravenoue Unk
"TEMP","RORCDCDEF",93)
chkb5_4_1=^^2228^1601^24^^49^^^^1^PH^6^1^20^^Receiving Clotting Factor  Yes
"TEMP","RORCDCDEF",94)
chkb5_4_2=^^2316^1601^24^^49^^^^1^PH^6^0^20^^Receiving Clotting Factor  No
"TEMP","RORCDCDEF",95)
chkb5_4_3=^^2399^1601^24^^49^^^^1^PH^6^9^20^^Receiving Clotting Factor  Unk
"TEMP","RORCDCDEF",96)
chkb5_4_4=^^1167^1642^27^^49^^^^1^PH^7^1^20^^Receiving Clotting Factor VIII
"TEMP","RORCDCDEF",97)
chkb5_4_5=^^1429^1642^27^^49^^^^1^PH^7^2^20^^Receiving Clotting Factor IX
"TEMP","RORCDCDEF",98)
chkb5_4_6=^^1708^1642^27^^49^^^^1^PH^7^8^20^^Receiving Clotting Factor  Other
"TEMP","RORCDCDEF",99)
edt5_4_1=^^1901^1672^22^^49^^^^1^PH^8^^20^^Receiving Clotting Factor  Other Name
"TEMP","RORCDCDEF",100)
chkb5_3_1=^^2228^1555^24^^49^^^^1^PH^5^1^20^^Injected Drug Yes
"TEMP","RORCDCDEF",101)
chkb5_3_2=^^2316^1555^24^^49^^^^1^PH^5^0^20^^Injected Drug No
"TEMP","RORCDCDEF",102)
chkb5_3_3=^^2398^1555^24^^49^^^^1^PH^5^9^20^^Injected Drug Unk
"TEMP","RORCDCDEF",103)
chkb5_2_1=^^2228^1509^24^^49^^^^1^PH^4^1^20^^Sex With Female Yes
"TEMP","RORCDCDEF",104)
chkb5_2_2=^^2316^1509^24^^49^^^^1^PH^4^0^20^^Sex With Female No
"TEMP","RORCDCDEF",105)
chkb5_2_3=^^2398^1509^24^^49^^^^1^PH^4^9^20^^Sex With Female Unk
"TEMP","RORCDCDEF",106)
chkb5_1_1=^^2228^1463^24^^49^^^^1^PH^3^1^20^^Sex With Male Yes
"TEMP","RORCDCDEF",107)
chkb5_1_2=^^2316^1463^24^^49^^^^1^PH^3^0^20^^Sex With Male No
"TEMP","RORCDCDEF",108)
chkb5_1_3=^^2399^1463^24^^49^^^^1^PH^3^9^20^^Sex With Male Unk
"TEMP","RORCDCDEF",109)
chkb6_8_1=^^2228^2563^24^^49^^^^1^LD2^5^1^14^^HIV-1 Yes
"TEMP","RORCDCDEF",110)
chkb6_8_2=^^2308^2563^24^^49^^^^1^LD2^5^0^14^^HIV-1 No
"TEMP","RORCDCDEF",111)
chkb6_8_3=^^2387^2563^24^^49^^^^1^LD2^5^9^14^^HIV-1 Unk
"TEMP","RORCDCDEF",112)
edt6_8_1=^^2230^2656^30^MMYY^50^170^^^1^LD2^6^^14^MM/YY^HIV Diagnosis by Physician Date
"TEMP","RORCDCDEF",113)
edt6_7_1=^^2230^2448^30^MMYY^50^170^^^1^LD2^4^^14^MM/YY^Lst Documented negative HIV Date
"TEMP","RORCDCDEF",114)
edt6_7_2=^^1557^2469^22^^49^^^^1^LD2^3^^14^^Lst Documented negative HIV Name
"TEMP","RORCDCDEF",115)
edt6_4_1=^^1046^2664^30^MMYY^50^170^^^1^LD1^10^^18^MM/YY^VI. Other HIV Test Date
"TEMP","RORCDCDEF",116)
chkb6_4_1=^^746^2671^27^^49^^^^1^LD1^9^1^18^^VI. Other HIV Test Pos
"TEMP","RORCDCDEF",117)
chkb6_4_2=^^821^2671^27^^49^^^^1^LD1^9^0^18^^VI. Other HIV Test Neg
"TEMP","RORCDCDEF",118)
chkb6_4_3=^^895^2671^27^^49^^^^1^LD1^9^8^18^^VI. Other HIV Test Ind
"TEMP","RORCDCDEF",119)
chkb6_4_4=^^966^2671^27^^49^^^^1^LD1^9^9^18^^VI. Other HIV Not Done
"TEMP","RORCDCDEF",120)
edt6_4_2=^^315^2718^22^^49^^^^1^LD1^11^^18^^VI. Other HIV Test Name
"TEMP","RORCDCDEF",121)
edt6_3_1=^^1046^2598^30^MMYY^50^170^^^1^LD1^8^^18^MM/YY^VI. HIV-1 Western Date
"TEMP","RORCDCDEF",122)
chkb6_3_1=^^746^2605^26^^49^^^^1^LD1^7^1^18^^VI. HIV-1 Western Yes
"TEMP","RORCDCDEF",123)
chkb6_3_2=^^821^2605^26^^49^^^^1^LD1^7^0^18^^VI. HIV-1 Western No
"TEMP","RORCDCDEF",124)
chkb6_3_3=^^896^2605^26^^49^^^^1^LD1^7^8^18^^VI. HIV-1 Western Ind
"TEMP","RORCDCDEF",125)
chkb6_3_4=^^967^2605^26^^49^^^^1^LD1^7^9^18^^VI. HIV-1 Western Not Done
"TEMP","RORCDCDEF",126)
edt6_2_1=^^1046^2531^30^MMYY^50^170^^^1^LD1^6^^18^MM/YY^VI. HIV-1/2 Date
"TEMP","RORCDCDEF",127)
chkb6_2_1=^^746^2538^27^^49^^^^1^LD1^5^1^18^^VI. HIV 1/2 Pos
"TEMP","RORCDCDEF",128)
chkb6_2_2=^^820^2538^27^^49^^^^1^LD1^5^0^18^^VI. HIV 1/2 Neg
"TEMP","RORCDCDEF",129)
chkb6_2_3=^^967^2538^27^^49^^^^1^LD1^5^9^18^^VI. HIV 1/2 Not Done
"TEMP","RORCDCDEF",130)
edt6_1_1=^^1046^2465^30^MMYY^50^170^^^1^LD1^4^^18^MM/YY^VI. HIV-1 EAI Date
"TEMP","RORCDCDEF",131)
chkb6_1_1=^^746^2471^27^^49^^^^1^LD1^3^1^18^^VI. HIV-1 EAI Pos
"TEMP","RORCDCDEF",132)
chkb6_1_2=^^821^2471^27^^49^^^^1^LD1^3^0^18^^VI. HIV-1 EAI Neg
"TEMP","RORCDCDEF",133)
chkb6_1_3=^^966^2471^27^^49^^^^1^LD1^3^9^18^^VI. HIV-1 EAI  Not Done
"TEMP","RORCDCDEF",134)
edt6_5_1=^^1046^2836^30^MMYY^50^170^^^1^LD1^13^^18^MM/YY^VI. Positive HIV Detection Date
"TEMP","RORCDCDEF",135)
edt6_5_2=^^399^2908^22^^49^^^^1^LD1^14^^18^^VI. Positive HIV Detection Other Test Type
"TEMP","RORCDCDEF",136)
edt6_5_3=^^1046^2902^30^MMYY^50^170^^^1^LD1^15^^18^MM/YY^VI. Positive HIV Detection Other Date
"TEMP","RORCDCDEF",137)
chkb6_5_1=^^162^2838^27^^49^^^^1^LD1^12^1^18^^VI. Positive HIV Detection Culture
"TEMP","RORCDCDEF",138)
chkb6_5_2=^^337^2838^27^^49^^^^1^LD1^12^2^18^^VI. Positive HIV Detection Antigen
"TEMP","RORCDCDEF",139)
chkb6_5_3=^^524^2838^27^^49^^^^1^LD1^12^3^18^^VI. Positive HIV Detection PCR, DNA or RNA Probe 
"TEMP","RORCDCDEF",140)
edt6_6_2=^^1046^3074^30^MMYY^50^170^^^1^LD1^18^^18^MM/YY^VI. VIRAL LOAD TEST DATE
"TEMP","RORCDCDEF",141)
cmbb6_6_1=^^301^3073^30^BoxedLine^49^2^^^1^LD1^16^^18^^VI. VIRAL LOAD TEST TYPE 
"TEMP","RORCDCDEF",142)
edt6_6_1=^^517^3073^30^N7^50^29^125^^1^LD1^17^^18^^VI. VIRAL LOAD  COPIES/ML
"TEMP","RORCDCDEF",143)
edt6_9_2=^^2230^2877^30^MMYY^50^170^^^1^LD2^8^^14^MM/YY^VI. IMMUNOLOGY LAB CD4 Count Date
"TEMP","RORCDCDEF",144)
edt6_9_4=^^2230^2944^30^MMYY^50^170^^^1^LD2^10^^14^MM/YY^VI. IMMUNOLOGY LAB CD4 Percent Date
"TEMP","RORCDCDEF",145)
edt6_9_6=^^2230^3058^30^MMYY^50^170^^^1^LD2^12^^14^MM/YY^VI. IMMUNOLOGY LAB First <200ml CD4 Count Date
"TEMP","RORCDCDEF",146)
edt6_9_8=^^2230^3123^30^MMYY^50^170^^^1^LD2^14^^14^MM/YY^VI. IMMUNOLOGY LAB First <200ml CD4 Percent Date
"TEMP","RORCDCDEF",147)
edt6_9_3=^^1938^2944^30^BoxedLine^49^2^^^1^LD2^9^^14^^VI. IMMUNOLOGY LAB CD4 Percent
"TEMP","RORCDCDEF",148)
edt6_9_1=^^1811^2877^30^N4^49^30^^^1^LD2^7^^14^^VI. IMMUNOLOGY LAB CD4 Count
"TEMP","RORCDCDEF",149)
edt6_9_5=^^1810^3057^30^N4^49^30^^^1^LD2^11^^14^^VI. IMMUNOLOGY LAB First <200ml CD4 Count
"TEMP","RORCDCDEF",150)
edt6_9_7=^^1939^3123^30^BoxedLine^49^2^^^1^LD2^13^^14^^VI. IMMUNOLOGY LAB First <200ml CD4 Percent
"TEMP","RORCDCDEF",151)
edt7_1=^^380^111^22^^49^^^^2^^^^^^VII. Physician
"TEMP","RORCDCDEF",152)
edt7_5=^^1320^184^22^PlainLine^49^^^^2^^^^^^VII. Person, compiling form
"TEMP","RORCDCDEF",153)
edt7_3=^^1455^111^22^^49^^^^2^^^^^^VII. Physician Phone
"TEMP","RORCDCDEF",154)
edt7_6=^^2005^184^22^^49^^^^2^^^^^^VII. Person compiling phone
"TEMP","RORCDCDEF",155)
edt7_4=^^355^184^22^^49^^^^2^^^^^^VII. Hospital
"TEMP","RORCDCDEF",156)
edt7_2=^^2140^111^22^^49^^^^2^^^^^^VII. Medical Record Num
"TEMP","RORCDCDEF",157)
edt8_27_1=^^2185^1640^30^MMYY^50^158^^26^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",158)
chkb8_27_1=^^2016^1642^27^^49^^^26^2^AID^3^1^4^^
"TEMP","RORCDCDEF",159)
edt8_26_1=^^2185^1553^30^MMYY^50^158^^25^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",160)
chkb8_26_1=^^2017^1555^26^^49^^^25^2^AID^3^1^4^^
"TEMP","RORCDCDEF",161)
chkb8_26_2=^^2100^1555^26^^49^^^25^2^AID^3^2^4^^
"TEMP","RORCDCDEF",162)
edt8_25_1=^^2185^1464^30^MMYY^50^158^^24^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",163)
chkb8_25_1=^^2016^1467^27^PlainLine^49^1^^24^2^AID^3^1^4^^
"TEMP","RORCDCDEF",164)
edt8_24_1=^^2185^1378^30^MMYY^50^158^^23^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",165)
chkb8_24_1=^^2016^1380^26^^49^^^23^2^AID^3^1^26^^
"TEMP","RORCDCDEF",166)
edt8_23_1=^^2185^1290^30^MMYY^50^158^^22^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",167)
chkb8_23_1=^^2016^1292^27^^49^^^22^2^AID^3^1^4^^
"TEMP","RORCDCDEF",168)
chkb8_23_2=^^2104^1292^27^^49^^^22^2^AID^3^2^4^^
"TEMP","RORCDCDEF",169)
edt8_22_1=^^2185^1204^30^MMYY^50^158^^21^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",170)
chkb8_22_1=^^2017^1205^26^^49^^^21^2^AID^3^1^4^^
"TEMP","RORCDCDEF",171)
chkb8_22_2=^^2104^1205^26^^49^^^21^2^AID^3^2^4^^
"TEMP","RORCDCDEF",172)
edt8_21_1=^^2185^1115^30^MMYY^50^158^^20^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",173)
chkb8_21_1=^^2016^1117^27^^49^^^20^2^AID^3^1^4^^
"TEMP","RORCDCDEF",174)
chkb8_21_2=^^2104^1117^27^^49^^^20^2^AID^3^2^4^^
"TEMP","RORCDCDEF",175)
edt8_20_1=^^2185^1028^30^MMYY^50^158^^19^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",176)
chkb8_20_1=^^2017^1034^26^^49^^^19^2^AID^3^1^4^^
"TEMP","RORCDCDEF",177)
chkb8_20_2=^^2104^1034^26^^49^^^19^2^AID^3^2^4^^
"TEMP","RORCDCDEF",178)
edt8_19_1=^^2185^941^30^MMYY^50^158^^18^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",179)
chkb8_19_1=^^2016^942^27^^49^^^18^2^AID^3^1^4^^
"TEMP","RORCDCDEF",180)
chkb8_19_2=^^2104^942^27^^49^^^18^2^AID^3^2^4^^
"TEMP","RORCDCDEF",181)
edt8_18_1=^^2185^853^30^MMYY^50^158^^17^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",182)
chkb8_18_1=^^2017^855^26^^49^^^17^2^AID^3^1^4^^
"TEMP","RORCDCDEF",183)
chkb8_18_2=^^2104^855^26^PlainLine^49^^^17^2^AID^3^2^4^^
"TEMP","RORCDCDEF",184)
edt8_17_1=^^2185^765^30^MMYY^50^158^^16^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",185)
chkb8_17_1=^^2016^767^27^^49^^^16^2^AID^3^1^4^^
"TEMP","RORCDCDEF",186)
edt8_16_1=^^2185^676^30^MMYY^50^158^^15^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",187)
chkb8_16_1=^^2017^680^26^^49^^^15^2^AID^3^1^4^^
"TEMP","RORCDCDEF",188)
edt8_15_1=^^2185^590^30^MMYY^50^158^^14^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",189)
chkb8_15_1=^^2016^592^27^^49^^^14^2^AID^3^1^4^^
"TEMP","RORCDCDEF",190)
edt8_14_1=^^1019^1640^30^MMYY^50^158^^13^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",191)
chkb8_14_1=^^846^1642^27^^49^^^13^2^AID^3^1^4^^
"TEMP","RORCDCDEF",192)
chkb8_14_2=^^933^1642^27^^49^^^13^2^AID^3^2^4^^
"TEMP","RORCDCDEF",193)
edt8_13_1=^^1019^1552^30^MMYY^50^158^^12^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",194)
chkb8_13_1=^^846^1555^26^^49^^^12^2^AID^3^1^4^^
"TEMP","RORCDCDEF",195)
edt8_12_1=^^1019^1465^30^MMYY^50^158^^11^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",196)
chkb8_12_1=^^845^1467^27^^49^^^11^2^AID^3^1^4^^
"TEMP","RORCDCDEF",197)
edt8_11_1=^^1019^1376^30^MMYY^50^158^^10^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",198)
chkb8_11_1=^^846^1380^26^^49^^^10^2^AID^3^1^4^^
"TEMP","RORCDCDEF",199)
edt8_10_1=^^1019^1289^30^MMYY^50^158^^9^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",200)
chkb8_10_1=^^846^1292^27^^49^^^9^2^AID^3^1^4^^
"TEMP","RORCDCDEF",201)
edt8_9_1=^^1019^1202^30^MMYY^50^158^^8^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",202)
chkb8_9_1=^^846^1205^26^^49^^^8^2^AID^3^1^4^^
"TEMP","RORCDCDEF",203)
chkb8_9_2=^^934^1205^26^^49^^^8^2^AID^3^2^4^^
"TEMP","RORCDCDEF",204)
edt8_8_1=^^1019^1115^30^MMYY^50^158^^7^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",205)
chkb8_8_1=^^846^1117^27^^49^^^7^2^AID^3^1^4^^
"TEMP","RORCDCDEF",206)
edt8_7_1=^^1019^1029^30^MMYY^50^158^^6^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",207)
chkb8_7_1=^^846^1034^26^^49^^^6^2^AID^3^1^4^^
"TEMP","RORCDCDEF",208)
edt8_6_1=^^1019^941^30^MMYY^50^158^^5^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",209)
chkb8_6_1=^^846^946^27^^49^^^5^2^AID^3^1^4^^
"TEMP","RORCDCDEF",210)
edt8_5_1=^^1019^853^30^MMYY^50^158^^4^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",211)
chkb8_5_1=^^846^855^26^^49^^^4^2^AID^3^1^4^^
"TEMP","RORCDCDEF",212)
edt8_4_1=^^1019^765^30^MMYY^50^158^^3^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",213)
chkb8_4_1=^^846^767^27^^49^^^3^2^AID^3^1^4^^
"TEMP","RORCDCDEF",214)
edt8_3_1=^^1019^678^30^MMYY^50^158^^2^2^AID^4^^4^MM/YY^VIII. Candidiasis, esophagel Date
"TEMP","RORCDCDEF",215)
chkb8_3_1=^^846^684^26^^49^^^2^2^AID^3^1^4^^VIII. Candidiasis, esophagel Def
"TEMP","RORCDCDEF",216)
chkb8_3_2=^^934^684^26^^49^^^2^2^AID^3^2^4^^VIII. Candidiasis, esophagel Pres
"TEMP","RORCDCDEF",217)
edt8_2_1=^^1019^591^30^MMYY^50^158^^1^2^AID^4^^4^MM/YY^VIII. Candidiasis, Bronchi, trachea Date
"TEMP","RORCDCDEF",218)
chkb8_2_1=^^846^596^27^^49^^^1^2^AID^3^1^4^^VIII. Candidiasis, Bronchi, trachea Def
"TEMP","RORCDCDEF",219)
chkb8_1=^^471^417^27^^49^^^^2^CS^3^1^7^^VIII. Record Rewieved yes
"TEMP","RORCDCDEF",220)
chkb8_2=^^566^417^27^^49^^^^2^CS^3^0^7^^VIII. Record Rewieved No
"TEMP","RORCDCDEF",221)
edt8_1_1=^^1667^420^30^MMYY^50^155^^^2^CS^4^^7^MM/YY^VIII Asymptomatic Date
"TEMP","RORCDCDEF",222)
edt8_1_2=^^2188^419^30^MMYY^50^155^^^2^CS^5^^7^MM/YY^Symptomatic Date
"TEMP","RORCDCDEF",223)
edt8_1=^^1622^1724^30^BoxedLine^46^9^^^2^CS^6^^7^^RVCT CASE NO
"TEMP","RORCDCDEF",224)
chkb8_28_1=^^1396^1813^27^PlainLine^49^^^^2^CS^7^1^7^^VIII. Immunideficiency disqualifying from AIDS Yes
"TEMP","RORCDCDEF",225)
chkb8_28_2=^^1563^1813^27^^49^^^^2^CS^7^0^7^^VIII. Immunideficiency disqualifying from AIDS No
"TEMP","RORCDCDEF",226)
chkb8_28_3=^^1712^1813^27^^49^^^^2^CS^7^9^7^^VIII. Immunideficiency disqualifying from AIDS Unk
"TEMP","RORCDCDEF",227)
chkb9_8_1=^^1142^2255^26^^49^^^^2^TS1^10^1^11^^Clinic (HRSA)
"TEMP","RORCDCDEF",228)
chkb9_8_2=^^1142^2305^26^^49^^^^2^TS1^10^2^11^^Clinic (Other)
"TEMP","RORCDCDEF",229)
chkb9_8_4=^^1142^2355^26^^49^^^^2^TS1^10^9^11^^Clinic (None)
"TEMP","RORCDCDEF",230)
chkb9_8_3=^^1142^2405^26^^49^^^^2^TS1^10^3^11^^Clinic (Unknown)
"TEMP","RORCDCDEF",231)
chkb9_6_1=^^467^2392^27^^49^^^^2^TS1^8^1^11^^PCP prophylaxis Yes
"TEMP","RORCDCDEF",232)
chkb9_6_2=^^550^2392^27^^49^^^^2^TS1^8^0^11^^PCP prophylaxis No
"TEMP","RORCDCDEF",233)
chkb9_6_3=^^632^2392^27^^49^^^^2^TS1^8^9^11^^PCP prophylaxis Unk
"TEMP","RORCDCDEF",234)
chkb9_12_1=^^1241^2588^27^^49^^^^2^TS2^5^1^9^^IX. Live Infant delivered  Yes
"TEMP","RORCDCDEF",235)
chkb9_12_2=^^2100^2588^27^^49^^^^2^TS2^5^0^9^^IX. Live Infant delivered  No
"TEMP","RORCDCDEF",236)
chkb9_12_3=^^2250^2588^27^^49^^^^2^TS2^5^9^9^^IX. Live Infant delivered  Unk
"TEMP","RORCDCDEF",237)
edt9_12_2=^^1417^2758^30^BoxedLine^49^4^^^2^TS2^^^9^^IX. Live Infant delivered Child SOUNDEX ????
"TEMP","RORCDCDEF",238)
edt9_12_5=^^1942^2751^30^BoxedLine^50^10^^^2^TS2^9^^9^^IX. Live Infant delivered  Child State Patient # 
"TEMP","RORCDCDEF",239)
dtp9_12_1=^^164^2761^30^MMDDYY^49^106^^^2^TS2^6^^9^^IX. Live Infant delivered  Date of Birth
"TEMP","RORCDCDEF",240)
edt9_12_3=^^615^2772^22^^49^^^^2^TS2^8^^9^^IX. Live Infant delivered  City
"TEMP","RORCDCDEF",241)
edt9_12_1=^^769^2700^22^^49^^^^2^TS2^7^^9^^IX. Live Infant delivered  Hospital
"TEMP","RORCDCDEF",242)
cmbb9_12_1=^^1037^2772^22^^49^^^^2^TS2^9^^9^^IX. Live Infant delivered  State
"TEMP","RORCDCDEF",243)
chkb9_11_1=^^1934^2534^26^^49^^^^2^TS2^4^1^9^^IX. Is  patient pregnant Yes
"TEMP","RORCDCDEF",244)
chkb9_11_2=^^2101^2534^26^^49^^^^2^TS2^4^0^9^^IX. Is  patient pregnant No
"TEMP","RORCDCDEF",245)
chkb9_11_3=^^2251^2534^26^^49^^^^2^TS2^4^9^9^^IX. Is  patient pregnant Unk
"TEMP","RORCDCDEF",246)
chkb9_4_1=^^2146^2105^26^^49^^^^2^TS1^6^1^11^^Substance abuse Yes
"TEMP","RORCDCDEF",247)
chkb9_4_2=^^2229^2105^26^^49^^^^2^TS1^6^0^11^^Substance abuse No
"TEMP","RORCDCDEF",248)
chkb9_4_4=^^2392^2105^26^^49^^^^2^TS1^6^8^11^^Substance abuse Unk
"TEMP","RORCDCDEF",249)
chkb9_4_3=^^2313^2105^26^^49^^^^2^TS1^6^9^11^^Substance abuse NA
"TEMP","RORCDCDEF",250)
chkb9_3_1=^^2146^2050^27^^49^^^^2^TS1^5^1^11^^HIV med. services Yes
"TEMP","RORCDCDEF",251)
chkb9_3_2=^^2229^2050^27^^49^^^^2^TS1^5^0^11^^HIV med. services No
"TEMP","RORCDCDEF",252)
chkb9_3_3=^^2392^2050^27^^49^^^^2^TS1^5^9^11^^HIV med. services Unk
"TEMP","RORCDCDEF",253)
chkb9_2_1=^^229^2109^26^^49^^^^2^TS1^4^1^11^^Notified Health department
"TEMP","RORCDCDEF",254)
chkb9_2_3=^^625^2109^26^^49^^^^2^TS1^4^2^11^^Notified Physician/Provider
"TEMP","RORCDCDEF",255)
chkb9_2_2=^^1030^2109^26^^49^^^^2^TS1^4^3^11^^Notified Patient
"TEMP","RORCDCDEF",256)
chkb9_2_4=^^1263^2109^26^^49^^^^2^TS1^4^9^11^^Notified Unk
"TEMP","RORCDCDEF",257)
chkb9_1_1=^^996^1992^27^^49^^^^2^TS1^3^1^11^^Informed of HIV Yes
"TEMP","RORCDCDEF",258)
chkb9_1_2=^^1162^1992^27^^49^^^^2^TS1^3^0^11^^Informed of HIV No
"TEMP","RORCDCDEF",259)
chkb9_1_3=^^1312^1992^27^^49^^^^2^TS1^3^9^11^^Informed of HIV Unk
"TEMP","RORCDCDEF",260)
chkb9_5_1=^^468^2280^26^^49^^^^2^TS1^7^1^11^^ARV therapy Yes
"TEMP","RORCDCDEF",261)
chkb9_5_2=^^550^2280^26^^49^^^^2^TS1^7^0^11^^ARV therapy No
"TEMP","RORCDCDEF",262)
chkb9_5_3=^^634^2280^26^^49^^^^2^TS1^7^9^11^^ARV therapy Unk
"TEMP","RORCDCDEF",263)
chkb9_7_1=^^784^2255^26^^49^^^^2^TS1^9^1^11^^Clinical Trial NIH
"TEMP","RORCDCDEF",264)
chkb9_7_2=^^784^2305^26^^49^^^^2^TS1^9^2^11^^Clinical Trial Other
"TEMP","RORCDCDEF",265)
chkb9_7_4=^^784^2355^26^^49^^^^2^TS1^9^3^11^^Clinical Trial None
"TEMP","RORCDCDEF",266)
chkb9_7_3=^^784^2405^26^^49^^^^2^TS1^9^9^11^^Clinical Trial Unk
"TEMP","RORCDCDEF",267)
chkb9_9_1=^^1621^2255^26^^49^^^^2^TS1^11^1^11^^Reimburse Medicaid
"TEMP","RORCDCDEF",268)
chkb9_9_3=^^1621^2309^26^^49^^^^2^TS1^11^2^11^^Reimbursed No coverage
"TEMP","RORCDCDEF",269)
chkb9_9_2=^^2000^2255^26^^49^^^^2^TS1^11^3^11^^Reimbursed HMO
"TEMP","RORCDCDEF",270)
chkb9_9_4=^^2001^2309^26^^49^^^^2^TS1^11^4^11^^Reimbursed Other
"TEMP","RORCDCDEF",271)
chkb9_9_5=^^1621^2363^27^^49^^^^2^TS1^11^7^11^^Reimbursed Trial
"TEMP","RORCDCDEF",272)
chkb9_9_6=^^2000^2363^27^^49^^^^2^TS1^11^9^11^^Reimbursed Unk
"TEMP","RORCDCDEF",273)
chkb9_10_1=^^1934^2480^26^^49^^^^2^TS2^3^1^9^^Gynecol. services Yes
"TEMP","RORCDCDEF",274)
chkb9_10_2=^^2101^2480^26^^49^^^^2^TS2^3^0^9^^Gynecol. services No
"TEMP","RORCDCDEF",275)
chkb9_10_3=^^2251^2480^26^^49^^^^2^TS2^3^9^9^^Gynecol. services Unk
"TEMP","RORCDCDEF",276)
mmComments=^^420^2864^30^MEMO^65^^^^2^CMT^3^^3^^
"TEMP","RORPRTDEF",1)
13::AIDS Defining Illness (1993)
"TEMP","RORPRTDEF",1,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",1,2)
<PARAMS>
"TEMP","RORPRTDEF",1,3)
<ICD9LST>
"TEMP","RORPRTDEF",1,4)
<ICD9 ID="003.1">SALMONELLA SEPTICEMIA</ICD9>
"TEMP","RORPRTDEF",1,5)
<ICD9 ID="007.2">COCCIDIOSIS</ICD9>
"TEMP","RORPRTDEF",1,6)
<ICD9 ID="007.4">OTH PROTOZO INTES DIS, CRYPTO</ICD9>
"TEMP","RORPRTDEF",1,7)
<ICD9 ID="013.00">TB MENINGITIS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,8)
<ICD9 ID="013.01">TB MENINGITIS-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,9)
<ICD9 ID="013.02">TB MENINGITIS-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,10)
<ICD9 ID="013.03">TB MENINGITIS-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,11)
<ICD9 ID="013.04">TB MENINGITIS-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,12)
<ICD9 ID="013.05">TB MENINGITIS-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,13)
<ICD9 ID="013.06">TB MENINGITIS-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,14)
<ICD9 ID="013.10">TUBRCLMA MENINGES-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,15)
<ICD9 ID="013.11">TUBRCLMA MENING-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,16)
<ICD9 ID="013.12">TUBRCLMA MENIN-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,17)
<ICD9 ID="013.13">TUBRCLMA MENING-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,18)
<ICD9 ID="013.14">TUBRCLMA MENING-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,19)
<ICD9 ID="013.15">TUBRCLMA MENING-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,20)
<ICD9 ID="013.16">TUBRCLMA MENING-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,21)
<ICD9 ID="013.20">TUBERCULOMA BRAIN-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,22)
<ICD9 ID="013.21">TUBRCLOMA BRAIN-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,23)
<ICD9 ID="013.22">TUBRCLMA BRAIN-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,24)
<ICD9 ID="013.23">TUBRCLOMA BRAIN-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,25)
<ICD9 ID="013.24">TUBRCLOMA BRAIN-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,26)
<ICD9 ID="013.25">TUBRCLOMA BRAIN-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,27)
<ICD9 ID="013.26">TUBRCLOMA BRAIN-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,28)
<ICD9 ID="013.30">TB BRAIN ABSCESS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,29)
<ICD9 ID="013.31">TB BRAIN ABSCESS-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,30)
<ICD9 ID="013.32">TB BRAIN ABSC-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,31)
<ICD9 ID="013.33">TB BRAIN ABSC-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,32)
<ICD9 ID="013.34">TB BRAIN ABSCESS-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,33)
<ICD9 ID="013.35">TB BRAIN ABSC-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,34)
<ICD9 ID="013.36">TB BRAIN ABSC-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,35)
<ICD9 ID="013.40">TUBRCLMA SP CORD-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,36)
<ICD9 ID="013.41">TUBRCLMA SP CORD-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,37)
<ICD9 ID="013.42">TUBRCLMA SP CD-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,38)
<ICD9 ID="013.43">TUBRCLMA SP CRD-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,39)
<ICD9 ID="013.44">TUBRCLMA SP CORD-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,40)
<ICD9 ID="013.45">TUBRCLMA SP CRD-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,41)
<ICD9 ID="013.46">TUBRCLMA SP CRD-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,42)
<ICD9 ID="013.50">TB SP CRD ABSCESS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,43)
<ICD9 ID="013.51">TB SP CRD ABSC-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,44)
<ICD9 ID="013.52">TB SP CRD ABSC-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,45)
<ICD9 ID="013.53">TB SP CRD ABSC-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,46)
<ICD9 ID="013.54">TB SP CRD ABSC-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,47)
<ICD9 ID="013.55">TB SP CRD ABSC-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,48)
<ICD9 ID="013.56">TB SP CRD ABSC-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,49)
<ICD9 ID="013.60">TB ENCEPHALITIS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,50)
<ICD9 ID="013.61">TB ENCEPHALITIS-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,51)
<ICD9 ID="013.62">TB ENCEPHALIT-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,52)
<ICD9 ID="013.63">TB ENCEPHALITIS-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,53)
<ICD9 ID="013.64">TB ENCEPHALITIS-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,54)
<ICD9 ID="013.65">TB ENCEPHALITIS-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,55)
<ICD9 ID="013.66">TB ENCEPHALITIS-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,56)
<ICD9 ID="013.80">CNS TB NEC-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,57)
<ICD9 ID="013.81">CNS TB NEC-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,58)
<ICD9 ID="013.82">CNS TB NEC-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,59)
<ICD9 ID="013.83">CNS TB NEC-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,60)
<ICD9 ID="013.84">CNS TB NEC-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,61)
<ICD9 ID="013.85">CNS TB NEC-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,62)
<ICD9 ID="013.86">CNS TB NEC-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,63)
<ICD9 ID="013.90">CNS TB NOS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,64)
<ICD9 ID="013.91">CNS TB NOS-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,65)
<ICD9 ID="013.92">CNS TB NOS-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,66)
<ICD9 ID="013.93">CNS TB NOS-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,67)
<ICD9 ID="013.94">CNS TB NOS-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,68)
<ICD9 ID="013.95">CNS TB NOS-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,69)
<ICD9 ID="013.96">CNS TB NOS-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,70)
<ICD9 ID="014.00">TB PERITONITIS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,71)
<ICD9 ID="014.01">TB PERITONITIS-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,72)
<ICD9 ID="014.02">TB PERITONITIS-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,73)
<ICD9 ID="014.03">TB PERITONITIS-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,74)
<ICD9 ID="014.04">TB PERITONITIS-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,75)
<ICD9 ID="014.05">TB PERITONITIS-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,76)
<ICD9 ID="014.06">TB PERITONITIS-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,77)
<ICD9 ID="014.80">INTESTINAL TB NEC-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,78)
<ICD9 ID="014.81">INTESTIN TB NEC-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,79)
<ICD9 ID="014.82">INTEST TB NEC-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,80)
<ICD9 ID="014.83">INTESTIN TB NEC-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,81)
<ICD9 ID="014.84">INTESTIN TB NEC-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,82)
<ICD9 ID="014.85">INTESTIN TB NEC-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,83)
<ICD9 ID="014.86">INTESTIN TB NEC-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,84)
<ICD9 ID="015.00">TB OF VERTEBRA-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,85)
<ICD9 ID="015.01">TB OF VERTEBRA-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,86)
<ICD9 ID="015.02">TB OF VERTEBRA-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,87)
<ICD9 ID="015.03">TB OF VERTEBRA-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,88)
<ICD9 ID="015.04">TB OF VERTEBRA-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,89)
<ICD9 ID="015.05">TB OF VERTEBRA-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,90)
<ICD9 ID="015.06">TB OF VERTEBRA-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,91)
<ICD9 ID="015.10">TB OF HIP-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,92)
<ICD9 ID="015.11">TB OF HIP-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,93)
<ICD9 ID="015.12">TB OF HIP-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,94)
<ICD9 ID="015.13">TB OF HIP-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,95)
<ICD9 ID="015.14">TB OF HIP-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,96)
<ICD9 ID="015.15">TB OF HIP-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,97)
<ICD9 ID="015.16">TB OF HIP-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,98)
<ICD9 ID="015.20">TB OF KNEE-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,99)
<ICD9 ID="015.21">TB OF KNEE-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,100)
<ICD9 ID="015.22">TB OF KNEE-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,101)
<ICD9 ID="015.23">TB OF KNEE-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,102)
<ICD9 ID="015.24">TB OF KNEE-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,103)
<ICD9 ID="015.25">TB OF KNEE-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,104)
<ICD9 ID="015.26">TB OF KNEE-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,105)
<ICD9 ID="015.50">TB OF LIMB BONES-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,106)
<ICD9 ID="015.51">TB LIMB BONES-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,107)
<ICD9 ID="015.52">TB LIMB BONES-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,108)
<ICD9 ID="015.53">TB LIMB BONES-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,109)
<ICD9 ID="015.54">TB LIMB BONES-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,110)
<ICD9 ID="015.55">TB LIMB BONES-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,111)
<ICD9 ID="015.56">TB LIMB BONES-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,112)
<ICD9 ID="015.60">TB OF MASTOID-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,113)
<ICD9 ID="015.61">TB OF MASTOID-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,114)
<ICD9 ID="015.62">TB OF MASTOID-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,115)
<ICD9 ID="015.63">TB OF MASTOID-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,116)
<ICD9 ID="015.64">TB OF MASTOID-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,117)
<ICD9 ID="015.65">TB OF MASTOID-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,118)
<ICD9 ID="015.66">TB OF MASTOID-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,119)
<ICD9 ID="015.70">TB OF BONE NEC-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,120)
<ICD9 ID="015.71">TB OF BONE NEC-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,121)
<ICD9 ID="015.72">TB OF BONE NEC-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,122)
<ICD9 ID="015.73">TB OF BONE NEC-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,123)
<ICD9 ID="015.74">TB OF BONE NEC-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,124)
<ICD9 ID="015.75">TB OF BONE NEC-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,125)
<ICD9 ID="015.76">TB OF BONE NEC-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,126)
<ICD9 ID="015.80">TB OF JOINT NEC-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,127)
<ICD9 ID="015.81">TB OF JOINT NEC-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,128)
<ICD9 ID="015.82">TB JOINT NEC-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,129)
<ICD9 ID="015.83">TB OF JOINT NEC-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,130)
<ICD9 ID="015.84">TB OF JOINT NEC-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,131)
<ICD9 ID="015.85">TB OF JOINT NEC-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,132)
<ICD9 ID="015.86">TB OF JOINT NEC-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,133)
<ICD9 ID="015.90">TB BONE/JOINT NOS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,134)
<ICD9 ID="015.91">TB BONE/JT NOS-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,135)
<ICD9 ID="015.92">TB BONE/JT NOS-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,136)
<ICD9 ID="015.93">TB BONE/JT NOS-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,137)
<ICD9 ID="015.94">TB BONE/JT NOS-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,138)
<ICD9 ID="015.95">TB BONE/JT NOS-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,139)
<ICD9 ID="015.96">TB BONE/JT NOS-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,140)
<ICD9 ID="016.00">TB OF KIDNEY-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,141)
<ICD9 ID="016.01">TB OF KIDNEY-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,142)
<ICD9 ID="016.02">TB OF KIDNEY-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,143)
<ICD9 ID="016.03">TB OF KIDNEY-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,144)
<ICD9 ID="016.04">TB OF KIDNEY-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,145)
<ICD9 ID="016.05">TB OF KIDNEY-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,146)
<ICD9 ID="016.06">TB OF KIDNEY-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,147)
<ICD9 ID="016.10">TB OF BLADDER-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,148)
<ICD9 ID="016.11">TB OF BLADDER-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,149)
<ICD9 ID="016.12">TB OF BLADDER-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,150)
<ICD9 ID="016.13">TB OF BLADDER-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,151)
<ICD9 ID="016.14">TB OF BLADDER-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,152)
<ICD9 ID="016.15">TB OF BLADDER-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,153)
<ICD9 ID="016.16">TB OF BLADDER-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,154)
<ICD9 ID="016.20">TB OF URETER-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,155)
<ICD9 ID="016.21">TB OF URETER-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,156)
<ICD9 ID="016.22">TB OF URETER-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,157)
<ICD9 ID="016.23">TB OF URETER-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,158)
<ICD9 ID="016.24">TB OF URETER-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,159)
<ICD9 ID="016.25">TB OF URETER-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,160)
<ICD9 ID="016.26">TB OF URETER-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,161)
<ICD9 ID="016.30">TB URINARY NEC-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,162)
<ICD9 ID="016.31">TB URINARY NEC-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,163)
<ICD9 ID="016.32">TB URINARY NEC-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,164)
<ICD9 ID="016.33">TB URINARY NEC-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,165)
<ICD9 ID="016.34">TB URINARY NEC-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,166)
<ICD9 ID="016.35">TB URINARY NEC-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,167)
<ICD9 ID="016.36">TB URINARY NEC-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,168)
<ICD9 ID="016.40">TB EPIDIDYMIS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,169)
<ICD9 ID="016.41">TB EPIDIDYMIS-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,170)
<ICD9 ID="016.42">TB EPIDIDYMIS-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,171)
<ICD9 ID="016.43">TB EPIDIDYMIS-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,172)
<ICD9 ID="016.44">TB EPIDIDYMIS-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,173)
<ICD9 ID="016.45">TB EPIDIDYMIS-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,174)
<ICD9 ID="016.46">TB EPIDIDYMIS-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,175)
<ICD9 ID="016.50">TB MALE GENIT NEC-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,176)
<ICD9 ID="016.51">TB MALE GEN NEC-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,177)
<ICD9 ID="016.52">TB MALE GEN NEC-EX UNKN</ICD9>
"TEMP","RORPRTDEF",1,178)
<ICD9 ID="016.53">TB MALE GEN NEC-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,179)
<ICD9 ID="016.54">TB MALE GEN NEC-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,180)
<ICD9 ID="016.55">TB MALE GEN NEC-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,181)
<ICD9 ID="016.56">TB MALE GEN NEC-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,182)
<ICD9 ID="016.60">TB OVARY TUBE-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,183)
<ICD9 ID="016.61">TB OVARY TUBE-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,184)
<ICD9 ID="016.62">TB OVARY/TUBE-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,185)
<ICD9 ID="016.63">TB OVARY TUBE-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,186)
<ICD9 ID="016.64">TB OVARY TUBE-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,187)
<ICD9 ID="016.65">TB OVARY TUBE-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,188)
<ICD9 ID="016.66">TB OVARY TUBE-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,189)
<ICD9 ID="016.70">TB FEMALE GEN NEC-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,190)
<ICD9 ID="016.71">TB FEM GEN NEC-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,191)
<ICD9 ID="016.72">TB FEM GEN NEC-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,192)
<ICD9 ID="016.73">TB FEM GEN NEC-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,193)
<ICD9 ID="016.74">TB FEM GEN NEC-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,194)
<ICD9 ID="016.75">TB FEM GEN NEC-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,195)
<ICD9 ID="016.76">TB FEM GEN NEC-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,196)
<ICD9 ID="016.90">GU TB NOS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,197)
<ICD9 ID="016.91">GU TB NOS-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,198)
<ICD9 ID="016.92">GU TB NOS-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,199)
<ICD9 ID="016.93">GU TB NOS-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,200)
<ICD9 ID="016.94">GU TB NOS-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,201)
<ICD9 ID="016.95">GU TB NOS-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,202)
<ICD9 ID="016.96">GU TB NOS-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,203)
<ICD9 ID="017.00">TB SKIN/SUBCUTAN-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,204)
<ICD9 ID="017.01">TB SKIN/SUBCUT-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,205)
<ICD9 ID="017.02">TB SKIN/SUBCUT-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,206)
<ICD9 ID="017.03">TB SKIN/SUBCUT-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,207)
<ICD9 ID="017.04">TB SKIN/SUBCUT-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,208)
<ICD9 ID="017.05">TB SKIN/SUBCUT-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,209)
<ICD9 ID="017.06">TB SKIN/SUBCUT-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,210)
<ICD9 ID="017.10">ERYTHEMA NODOS TB-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,211)
<ICD9 ID="017.11">ERYTHEM NODOS TB-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,212)
<ICD9 ID="017.12">ERYTHEM NOD TB-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,213)
<ICD9 ID="017.13">ERYTHEM NOD TB-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,214)
<ICD9 ID="017.14">ERYTHEM NODOS TB-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,215)
<ICD9 ID="017.15">ERYTHEM NOD TB-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,216)
<ICD9 ID="017.16">ERYTHEM NOD TB-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,217)
<ICD9 ID="017.20">TB PERIPH LYMPH-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,218)
<ICD9 ID="017.21">TB PERIPH LYMPH-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,219)
<ICD9 ID="017.22">TB PERIPH LYMPH-EXAM UNK</ICD9>
"TEMP","RORPRTDEF",1,220)
<ICD9 ID="017.23">TB PERIPH LYMPH-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,221)
<ICD9 ID="017.24">TB PERIPH LYMPH-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,222)
<ICD9 ID="017.25">TB PERIPH LYMPH-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,223)
<ICD9 ID="017.26">TB PERIPH LYMPH-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,224)
<ICD9 ID="017.30">TB OF EYE-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,225)
<ICD9 ID="017.31">TB OF EYE-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,226)
<ICD9 ID="017.32">TB OF EYE-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,227)
<ICD9 ID="017.33">TB OF EYE-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,228)
<ICD9 ID="017.34">TB OF EYE-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,229)
<ICD9 ID="017.35">TB OF EYE-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,230)
<ICD9 ID="017.36">TB OF EYE-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,231)
<ICD9 ID="017.40">TB OF EAR-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,232)
<ICD9 ID="017.41">TB OF EAR-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,233)
<ICD9 ID="017.42">TB OF EAR-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,234)
<ICD9 ID="017.43">TB OF EAR-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,235)
<ICD9 ID="017.44">TB OF EAR-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,236)
<ICD9 ID="017.45">TB OF EAR-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,237)
<ICD9 ID="017.46">TB OF EAR-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,238)
<ICD9 ID="017.50">TB OF THYROID-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,239)
<ICD9 ID="017.51">TB OF THYROID-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,240)
<ICD9 ID="017.52">TB OF THYROID-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,241)
<ICD9 ID="017.53">TB OF THYROID-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,242)
<ICD9 ID="017.54">TB OF THYROID-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,243)
<ICD9 ID="017.55">TB OF THYROID-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,244)
<ICD9 ID="017.56">TB OF THYROID-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,245)
<ICD9 ID="017.60">TB OF ADRENAL-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,246)
<ICD9 ID="017.61">TB OF ADRENAL-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,247)
<ICD9 ID="017.62">TB OF ADRENAL-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,248)
<ICD9 ID="017.63">TB OF ADRENAL-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,249)
<ICD9 ID="017.64">TB OF ADRENAL-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,250)
<ICD9 ID="017.65">TB OF ADRENAL-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,251)
<ICD9 ID="017.66">TB OF ADRENAL-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,252)
<ICD9 ID="017.70">TB OF SPLEEN-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,253)
<ICD9 ID="017.71">TB OF SPLEEN-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,254)
<ICD9 ID="017.72">TB OF SPLEEN-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,255)
<ICD9 ID="017.73">TB OF SPLEEN-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,256)
<ICD9 ID="017.74">TB OF SPLEEN-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,257)
<ICD9 ID="017.75">TB OF SPLEEN-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,258)
<ICD9 ID="017.76">TB OF SPLEEN-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,259)
<ICD9 ID="017.80">TB ESOPHAGUS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,260)
<ICD9 ID="017.81">TB ESOPHAGUS-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,261)
<ICD9 ID="017.82">TB ESOPHAGUS-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,262)
<ICD9 ID="017.83">TB ESOPHAGUS-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,263)
<ICD9 ID="017.84">TB ESOPHAGUS-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,264)
<ICD9 ID="017.85">TB ESOPHAGUS-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,265)
<ICD9 ID="017.86">TB ESOPHAGUS-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,266)
<ICD9 ID="017.90">TB OF ORGAN NEC-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,267)
<ICD9 ID="017.91">TB OF ORGAN NEC-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,268)
<ICD9 ID="017.92">TB ORGAN NEC-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,269)
<ICD9 ID="017.93">TB OF ORGAN NEC-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,270)
<ICD9 ID="017.94">TB OF ORGAN NEC-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,271)
<ICD9 ID="017.95">TB OF ORGAN NEC-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,272)
<ICD9 ID="017.96">TB OF ORGAN NEC-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,273)
<ICD9 ID="018.00">ACUTE MILIARY TB-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,274)
<ICD9 ID="018.01">ACUTE MILIARY TB-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,275)
<ICD9 ID="018.02">AC MILIARY TB-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,276)
<ICD9 ID="018.03">AC MILIARY TB-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,277)
<ICD9 ID="018.04">ACUTE MILIARY TB-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,278)
<ICD9 ID="018.05">AC MILIARY TB-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,279)
<ICD9 ID="018.06">AC MILIARY TB-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,280)
<ICD9 ID="018.80">MILIARY TB NEC-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,281)
<ICD9 ID="018.81">MILIARY TB NEC-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,282)
<ICD9 ID="018.82">MILIARY TB NEC-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,283)
<ICD9 ID="018.83">MILIARY TB NEC-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,284)
<ICD9 ID="018.84">MILIARY TB NEC-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,285)
<ICD9 ID="018.85">MILIARY TB NEC-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,286)
<ICD9 ID="018.86">MILIARY TB NEC-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,287)
<ICD9 ID="018.90">MILIARY TB NOS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,288)
<ICD9 ID="018.91">MILIARY TB NOS-NO EXAM</ICD9>
"TEMP","RORPRTDEF",1,289)
<ICD9 ID="018.92">MILIARY TB NOS-EXAM UNKN</ICD9>
"TEMP","RORPRTDEF",1,290)
<ICD9 ID="018.93">MILIARY TB NOS-MICRO DX</ICD9>
"TEMP","RORPRTDEF",1,291)
<ICD9 ID="018.94">MILIARY TB NOS-CULT DX</ICD9>
"TEMP","RORPRTDEF",1,292)
<ICD9 ID="018.95">MILIARY TB NOS-HISTO DX</ICD9>
"TEMP","RORPRTDEF",1,293)
<ICD9 ID="018.96">MILIARY TB NOS-OTH TEST</ICD9>
"TEMP","RORPRTDEF",1,294)
<ICD9 ID="031.0">PULMONARY MYCOBACTERIA</ICD9>
"TEMP","RORPRTDEF",1,295)
<ICD9 ID="031.1">CUTANEOUS MYCOBACTERIA</ICD9>
"TEMP","RORPRTDEF",1,296)
<ICD9 ID="031.2">DMAC, DISEASE DUE TO</ICD9>
"TEMP","RORPRTDEF",1,297)
<ICD9 ID="031.8">MYCOBACTERIAL DIS NEC</ICD9>
"TEMP","RORPRTDEF",1,298)
<ICD9 ID="031.9">MYCOBACTERIAL DIS NOS</ICD9>
"TEMP","RORPRTDEF",1,299)
<ICD9 ID="046.3">PROG MULTIFOC LEUKOENCEP</ICD9>
"TEMP","RORPRTDEF",1,300)
<ICD9 ID="046.8">CNS SLOW VIRUS INFEC NEC</ICD9>
"TEMP","RORPRTDEF",1,301)
<ICD9 ID="054.71">VISCERAL HERPES SIMPLEX</ICD9>
"TEMP","RORPRTDEF",1,302)
<ICD9 ID="078.5">CYTOMEGALOVIRAL DISEASE</ICD9>
"TEMP","RORPRTDEF",1,303)
<ICD9 ID="083.8">RICKETTSIOSES NEC</ICD9>
"TEMP","RORPRTDEF",1,304)
<ICD9 ID="112.4">CANDIDIASIS OF LUNG</ICD9>
"TEMP","RORPRTDEF",1,305)
<ICD9 ID="112.84">CANDIDAL ESOPHAGITIS</ICD9>
"TEMP","RORPRTDEF",1,306)
<ICD9 ID="114.1">PRIM CUTAN COCCIDIOID</ICD9>
"TEMP","RORPRTDEF",1,307)
<ICD9 ID="114.2">COCCIDIOIDAL MENINGITIS</ICD9>
"TEMP","RORPRTDEF",1,308)
<ICD9 ID="114.3">PROGRESS COCCIDIOID NEC</ICD9>
"TEMP","RORPRTDEF",1,309)
<ICD9 ID="115.01">HISTOPLASM CAPSUL MENING</ICD9>
"TEMP","RORPRTDEF",1,310)
<ICD9 ID="115.02">HISTOPLASM CAPSUL RETINA</ICD9>
"TEMP","RORPRTDEF",1,311)
<ICD9 ID="115.03">HISTOPLASM CAPS PERICARD</ICD9>
"TEMP","RORPRTDEF",1,312)
<ICD9 ID="115.04">HISTOPLASM CAPS ENDOCARD</ICD9>
"TEMP","RORPRTDEF",1,313)
<ICD9 ID="115.09">HISTOPLASMA CAPSULAT NEC</ICD9>
"TEMP","RORPRTDEF",1,314)
<ICD9 ID="115.11">HISTOPLASM DUBOIS MENING</ICD9>
"TEMP","RORPRTDEF",1,315)
<ICD9 ID="115.12">HISTOPLASM DUBOIS RETINA</ICD9>
"TEMP","RORPRTDEF",1,316)
<ICD9 ID="115.13">HISTOPLASM DUB PERICARD</ICD9>
"TEMP","RORPRTDEF",1,317)
<ICD9 ID="115.14">HISTOPLASM DUB ENDOCARD</ICD9>
"TEMP","RORPRTDEF",1,318)
<ICD9 ID="115.19">HISTOPLASMA DUBOISII NEC</ICD9>
"TEMP","RORPRTDEF",1,319)
<ICD9 ID="115.91">HISTOPLASMOSIS MENINGIT</ICD9>
"TEMP","RORPRTDEF",1,320)
<ICD9 ID="115.92">HISTOPLASMOSIS RETINITIS</ICD9>
"TEMP","RORPRTDEF",1,321)
<ICD9 ID="115.93">HISTOPLASMOSIS PERICARD</ICD9>
"TEMP","RORPRTDEF",1,322)
<ICD9 ID="115.94">HISTOPLASMOSIS ENDOCARD</ICD9>
"TEMP","RORPRTDEF",1,323)
<ICD9 ID="115.99">HISTOPLASMOSIS NEC</ICD9>
"TEMP","RORPRTDEF",1,324)
<ICD9 ID="117.5">CRYPTOCOCCOSIS</ICD9>
"TEMP","RORPRTDEF",1,325)
<ICD9 ID="130.0">TOXOPLASM MENINGOENCEPH</ICD9>
"TEMP","RORPRTDEF",1,326)
<ICD9 ID="136.3">PNEUMOCYSTOSIS</ICD9>
"TEMP","RORPRTDEF",1,327)
<ICD9 ID="136.8">INFECT/PARASITE DIS NEC</ICD9>
"TEMP","RORPRTDEF",1,328)
<ICD9 ID="176.0">KAPOSI'S SARCOMA, SKIN</ICD9>
"TEMP","RORPRTDEF",1,329)
<ICD9 ID="176.1">KAPOSI'S SARCOMA, SOFT TISSUE</ICD9>
"TEMP","RORPRTDEF",1,330)
<ICD9 ID="176.2">KAPOSI'S SARCOMA, PALATE</ICD9>
"TEMP","RORPRTDEF",1,331)
<ICD9 ID="176.3">KAPOSI'S SARCOMA, GI SITES</ICD9>
"TEMP","RORPRTDEF",1,332)
<ICD9 ID="176.4">KAPOSI'S SARCOMA, LUNG</ICD9>
"TEMP","RORPRTDEF",1,333)
<ICD9 ID="176.5">KAPOSI'S SARCOMA, LYMPH NODES</ICD9>
"TEMP","RORPRTDEF",1,334)
<ICD9 ID="176.8">KAPOSI'S SARCOMA, OTHER SITES</ICD9>
"TEMP","RORPRTDEF",1,335)
<ICD9 ID="176.9">KAPOSI'S SARCOMA, NOS</ICD9>
"TEMP","RORPRTDEF",1,336)
<ICD9 ID="180.0">MALIG NEO ENDOCERVIX</ICD9>
"TEMP","RORPRTDEF",1,337)
<ICD9 ID="180.1">MALIG NEO EXOCERVIX</ICD9>
"TEMP","RORPRTDEF",1,338)
<ICD9 ID="180.8">MALIG NEO CERVIX NEC</ICD9>
"TEMP","RORPRTDEF",1,339)
<ICD9 ID="180.9">MAL NEO CERVIX UTERI NOS</ICD9>
"TEMP","RORPRTDEF",1,340)
<ICD9 ID="200.20">BURKITT'S TUMOR UNSPEC</ICD9>
"TEMP","RORPRTDEF",1,341)
<ICD9 ID="200.21">BURKITT'S TUMOR HEAD</ICD9>
"TEMP","RORPRTDEF",1,342)
<ICD9 ID="200.22">BURKITT'S TUMOR THORAX</ICD9>
"TEMP","RORPRTDEF",1,343)
<ICD9 ID="200.23">BURKITT'S TUMOR ABDOM</ICD9>
"TEMP","RORPRTDEF",1,344)
<ICD9 ID="200.24">BURKITT'S TUMOR AXILLA</ICD9>
"TEMP","RORPRTDEF",1,345)
<ICD9 ID="200.25">BURKITT'S TUMOR INGUIN</ICD9>
"TEMP","RORPRTDEF",1,346)
<ICD9 ID="200.26">BURKITT'S TUMOR PELVIC</ICD9>
"TEMP","RORPRTDEF",1,347)
<ICD9 ID="200.27">BURKITT'S TUMOR SPLEEN</ICD9>
"TEMP","RORPRTDEF",1,348)
<ICD9 ID="200.28">BURKITT'S TUMOR MULT</ICD9>
"TEMP","RORPRTDEF",1,349)
<ICD9 ID="202.80">LYMPHOMA NEC UNSPEC SITE</ICD9>
"TEMP","RORPRTDEF",1,350)
<ICD9 ID="202.81">LYMPHOMAS NEC HEAD</ICD9>
"TEMP","RORPRTDEF",1,351)
<ICD9 ID="202.82">LYMPHOMAS NEC THORAX</ICD9>
"TEMP","RORPRTDEF",1,352)
<ICD9 ID="202.83">LYMPHOMAS NEC ABDOM</ICD9>
"TEMP","RORPRTDEF",1,353)
<ICD9 ID="202.84">LYMPHOMAS NEC AXILLA</ICD9>
"TEMP","RORPRTDEF",1,354)
<ICD9 ID="202.85">LYMPHOMAS NEC INGUIN</ICD9>
"TEMP","RORPRTDEF",1,355)
<ICD9 ID="202.86">LYMPHOMAS NEC PELVIC</ICD9>
"TEMP","RORPRTDEF",1,356)
<ICD9 ID="202.87">LYMPHOMAS NEC SPLEEN</ICD9>
"TEMP","RORPRTDEF",1,357)
<ICD9 ID="202.88">LYMPHOMAS NEC MULT</ICD9>
"TEMP","RORPRTDEF",1,358)
<ICD9 ID="484.1">PNEUM W CYTOMEG INCL DIS</ICD9>
"TEMP","RORPRTDEF",1,359)
</ICD9LST>
"TEMP","RORPRTDEF",1,360)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",1,361)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",1,362)
</PARAMS>
"TEMP","RORPRTDEF",2)
13::Acute or Chronic Renal Failure
"TEMP","RORPRTDEF",2,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",2,2)
<PARAMS>
"TEMP","RORPRTDEF",2,3)
<ICD9LST>
"TEMP","RORPRTDEF",2,4)
<ICD9 ID="584.5">LOWER NEPHRON NEPHROSIS</ICD9>
"TEMP","RORPRTDEF",2,5)
<ICD9 ID="584.6">AC RENAL FAIL, CORT NECR</ICD9>
"TEMP","RORPRTDEF",2,6)
<ICD9 ID="584.7">AC REN FAIL, MEDULL NECR</ICD9>
"TEMP","RORPRTDEF",2,7)
<ICD9 ID="584.8">AC RENAL FAILURE NEC</ICD9>
"TEMP","RORPRTDEF",2,8)
<ICD9 ID="584.9">ACUTE RENAL FAILURE NOS</ICD9>
"TEMP","RORPRTDEF",2,9)
<ICD9 ID="585.">CHRONIC RENAL FAILURE</ICD9>
"TEMP","RORPRTDEF",2,10)
</ICD9LST>
"TEMP","RORPRTDEF",2,11)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",2,12)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",2,13)
</PARAMS>
"TEMP","RORPRTDEF",3)
13::Alcohol
"TEMP","RORPRTDEF",3,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",3,2)
<PARAMS>
"TEMP","RORPRTDEF",3,3)
<ICD9LST>
"TEMP","RORPRTDEF",3,4)
<ICD9 ID="291.0">DELIRIUM TREMENS</ICD9>
"TEMP","RORPRTDEF",3,5)
<ICD9 ID="291.1">ALCOHOL AMNESTIC DISORDR</ICD9>
"TEMP","RORPRTDEF",3,6)
<ICD9 ID="291.2">ALCOHOL PERSIST DEMENTIA</ICD9>
"TEMP","RORPRTDEF",3,7)
<ICD9 ID="291.3">ALCOH PSY DIS W HALLUCIN</ICD9>
"TEMP","RORPRTDEF",3,8)
<ICD9 ID="291.4">PATHOLOGIC ALCOHOL INTOX</ICD9>
"TEMP","RORPRTDEF",3,9)
<ICD9 ID="291.5">ALCOH PSYCH DIS W DELUS</ICD9>
"TEMP","RORPRTDEF",3,10)
<ICD9 ID="291.8">ALCOHOLIC PSYCHOSIS NEC</ICD9>
"TEMP","RORPRTDEF",3,11)
<ICD9 ID="291.81">ALCOHOL WITHDRAWAL</ICD9>
"TEMP","RORPRTDEF",3,12)
<ICD9 ID="291.89">ALCOHOL MENTAL DISOR NEC</ICD9>
"TEMP","RORPRTDEF",3,13)
<ICD9 ID="291.9">ALCOHOL MENTAL DISOR NOS</ICD9>
"TEMP","RORPRTDEF",3,14)
<ICD9 ID="303.00">AC ALCOHOL INTOX-UNSPEC</ICD9>
"TEMP","RORPRTDEF",3,15)
<ICD9 ID="303.01">AC ALCOHOL INTOX-CONTIN</ICD9>
"TEMP","RORPRTDEF",3,16)
<ICD9 ID="303.02">AC ALCOHOL INTOX-EPISOD</ICD9>
"TEMP","RORPRTDEF",3,17)
<ICD9 ID="303.03">AC ALCOHOL INTOX-REMISS</ICD9>
"TEMP","RORPRTDEF",3,18)
<ICD9 ID="303.90">ALCOH DEP NEC/NOS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",3,19)
<ICD9 ID="303.91">ALCOH DEP NEC/NOS-CONTIN</ICD9>
"TEMP","RORPRTDEF",3,20)
<ICD9 ID="303.92">ALCOH DEP NEC/NOS-EPISOD</ICD9>
"TEMP","RORPRTDEF",3,21)
<ICD9 ID="303.93">ALCOH DEP NEC/NOS-REMISS</ICD9>
"TEMP","RORPRTDEF",3,22)
<ICD9 ID="305.00">ALCOHOL ABUSE-UNSPEC</ICD9>
"TEMP","RORPRTDEF",3,23)
<ICD9 ID="305.01">ALCOHOL ABUSE-CONTINUOUS</ICD9>
"TEMP","RORPRTDEF",3,24)
<ICD9 ID="305.02">ALCOHOL ABUSE-EPISODIC</ICD9>
"TEMP","RORPRTDEF",3,25)
<ICD9 ID="305.03">ALCOHOL ABUSE-IN REMISS</ICD9>
"TEMP","RORPRTDEF",3,26)
<ICD9 ID="357.5">ALCOHOLIC POLYNEUROPATHY</ICD9>
"TEMP","RORPRTDEF",3,27)
<ICD9 ID="425.5">ALCOHOLIC CARDIOMYOPATHY</ICD9>
"TEMP","RORPRTDEF",3,28)
<ICD9 ID="535.3">ALCOHOLIC GASTRITIS</ICD9>
"TEMP","RORPRTDEF",3,29)
<ICD9 ID="535.30">ALCOHOLIC GASTRITIS W/O HEMOR</ICD9>
"TEMP","RORPRTDEF",3,30)
<ICD9 ID="535.31">ALCOHOLIC GASTRITIS W HEMOR</ICD9>
"TEMP","RORPRTDEF",3,31)
<ICD9 ID="571.0">ALCOHOLIC FATTY LIVER</ICD9>
"TEMP","RORPRTDEF",3,32)
<ICD9 ID="571.1">AC ALCOHOLIC HEPATITIS</ICD9>
"TEMP","RORPRTDEF",3,33)
<ICD9 ID="571.2">ALCOHOL CIRRHOSIS LIVER</ICD9>
"TEMP","RORPRTDEF",3,34)
<ICD9 ID="571.3">ALCOHOL LIVER DAMAGE NOS</ICD9>
"TEMP","RORPRTDEF",3,35)
</ICD9LST>
"TEMP","RORPRTDEF",3,36)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",3,37)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",3,38)
</PARAMS>
"TEMP","RORPRTDEF",4)
13::Bipolar - Mania
"TEMP","RORPRTDEF",4,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",4,2)
<PARAMS>
"TEMP","RORPRTDEF",4,3)
<ICD9LST>
"TEMP","RORPRTDEF",4,4)
<ICD9 ID="296.00">BIPOL I SINGLE MANIC NOS</ICD9>
"TEMP","RORPRTDEF",4,5)
<ICD9 ID="296.01">BIPOL I SINGLE MANC-MILD</ICD9>
"TEMP","RORPRTDEF",4,6)
<ICD9 ID="296.02">BIPOL I SINGLE MANIC-MOD</ICD9>
"TEMP","RORPRTDEF",4,7)
<ICD9 ID="296.03">BIPOL I SING-SEV W/O PSY</ICD9>
"TEMP","RORPRTDEF",4,8)
<ICD9 ID="296.04">BIPO I SIN MAN-SEV W PSY</ICD9>
"TEMP","RORPRTDEF",4,9)
<ICD9 ID="296.05">BIPOL I SING MAN REM NOS</ICD9>
"TEMP","RORPRTDEF",4,10)
<ICD9 ID="296.06">BIPOL I SINGLE MANIC REM</ICD9>
"TEMP","RORPRTDEF",4,11)
<ICD9 ID="296.10">RECUR MANIC DIS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",4,12)
<ICD9 ID="296.11">RECUR MANIC DIS-MILD</ICD9>
"TEMP","RORPRTDEF",4,13)
<ICD9 ID="296.12">RECUR MANIC DIS-MOD</ICD9>
"TEMP","RORPRTDEF",4,14)
<ICD9 ID="296.13">RECUR MANIC DIS-SEVERE</ICD9>
"TEMP","RORPRTDEF",4,15)
<ICD9 ID="296.14">RECUR MANIC-SEV W PSYCHO</ICD9>
"TEMP","RORPRTDEF",4,16)
<ICD9 ID="296.15">RECUR MANIC-PART REMISS</ICD9>
"TEMP","RORPRTDEF",4,17)
<ICD9 ID="296.16">RECUR MANIC-FULL REMISS</ICD9>
"TEMP","RORPRTDEF",4,18)
<ICD9 ID="296.40">BIPOL I CURRNT MANIC NOS</ICD9>
"TEMP","RORPRTDEF",4,19)
<ICD9 ID="296.41">BIPOL I CURNT MANIC-MILD</ICD9>
"TEMP","RORPRTDEF",4,20)
<ICD9 ID="296.42">BIPOL I CURRNT MANIC-MOD</ICD9>
"TEMP","RORPRTDEF",4,21)
<ICD9 ID="296.43">BIPOL I MANC-SEV W/O PSY</ICD9>
"TEMP","RORPRTDEF",4,22)
<ICD9 ID="296.44">BIPOL I MANIC-SEV W PSY</ICD9>
"TEMP","RORPRTDEF",4,23)
<ICD9 ID="296.45">BIPOL I CUR MAN PART REM</ICD9>
"TEMP","RORPRTDEF",4,24)
<ICD9 ID="296.46">BIPOL I CUR MAN FULL REM</ICD9>
"TEMP","RORPRTDEF",4,25)
<ICD9 ID="296.50">BIPOL I CUR DEPRES NOS</ICD9>
"TEMP","RORPRTDEF",4,26)
<ICD9 ID="296.51">BIPOL I CUR DEPRESS-MILD</ICD9>
"TEMP","RORPRTDEF",4,27)
<ICD9 ID="296.52">BIPOL I CUR DEPRESS-MOD</ICD9>
"TEMP","RORPRTDEF",4,28)
<ICD9 ID="296.53">BIPOL I CURR DEP W/O PSY</ICD9>
"TEMP","RORPRTDEF",4,29)
<ICD9 ID="296.54">BIPOL I CURRNT DEP W PSY</ICD9>
"TEMP","RORPRTDEF",4,30)
<ICD9 ID="296.55">BIPOL I CUR DEP REM NOS</ICD9>
"TEMP","RORPRTDEF",4,31)
<ICD9 ID="296.56">BIPOL I CURRNT DEP REMIS</ICD9>
"TEMP","RORPRTDEF",4,32)
<ICD9 ID="296.60">BIPOL I CURRNT MIXED NOS</ICD9>
"TEMP","RORPRTDEF",4,33)
<ICD9 ID="296.61">BIPOL I CURRNT MIX-MILD</ICD9>
"TEMP","RORPRTDEF",4,34)
<ICD9 ID="296.62">BIPOL I CURRNT MIXED-MOD</ICD9>
"TEMP","RORPRTDEF",4,35)
<ICD9 ID="296.63">BIPOL I CUR MIX W/O PSY</ICD9>
"TEMP","RORPRTDEF",4,36)
<ICD9 ID="296.64">BIPOL I CUR MIXED W PSY</ICD9>
"TEMP","RORPRTDEF",4,37)
<ICD9 ID="296.65">BIPOL I CUR MIX-PART REM</ICD9>
"TEMP","RORPRTDEF",4,38)
<ICD9 ID="296.66">BIPOL I CUR MIXED REMISS</ICD9>
"TEMP","RORPRTDEF",4,39)
<ICD9 ID="296.7">BIPOLOR I CURRENT NOS</ICD9>
"TEMP","RORPRTDEF",4,40)
<ICD9 ID="296.80">BIPOLAR DISORDER NOS</ICD9>
"TEMP","RORPRTDEF",4,41)
<ICD9 ID="296.81">ATYPICAL MANIC DISORDER</ICD9>
"TEMP","RORPRTDEF",4,42)
<ICD9 ID="296.82">ATYPICAL DEPRESSIVE DIS</ICD9>
"TEMP","RORPRTDEF",4,43)
<ICD9 ID="296.89">BIPOLAR DISORDER NEC</ICD9>
"TEMP","RORPRTDEF",4,44)
</ICD9LST>
"TEMP","RORPRTDEF",4,45)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",4,46)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",4,47)
</PARAMS>
"TEMP","RORPRTDEF",5)
13::Cirrhosis
"TEMP","RORPRTDEF",5,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",5,2)
<PARAMS>
"TEMP","RORPRTDEF",5,3)
<ICD9LST>
"TEMP","RORPRTDEF",5,4)
<ICD9 ID="571.2">ALCOHOL CIRRHOSIS LIVER</ICD9>
"TEMP","RORPRTDEF",5,5)
<ICD9 ID="571.5">CIRRHOSIS OF LIVER NOS</ICD9>
"TEMP","RORPRTDEF",5,6)
</ICD9LST>
"TEMP","RORPRTDEF",5,7)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",5,8)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",5,9)
</PARAMS>
"TEMP","RORPRTDEF",6)
13::Depression
"TEMP","RORPRTDEF",6,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",6,2)
<PARAMS>
"TEMP","RORPRTDEF",6,3)
<ICD9LST>
"TEMP","RORPRTDEF",6,4)
<ICD9 ID="293.83">MOOD DISORDER OTHER DIS</ICD9>
"TEMP","RORPRTDEF",6,5)
<ICD9 ID="296.20">DEPRESS DISORDER-UNSPEC</ICD9>
"TEMP","RORPRTDEF",6,6)
<ICD9 ID="296.21">DEPRESS DISORDER-MILD</ICD9>
"TEMP","RORPRTDEF",6,7)
<ICD9 ID="296.22">DEPRESSIVE DISORDER-MOD</ICD9>
"TEMP","RORPRTDEF",6,8)
<ICD9 ID="296.23">DEPRESS DISORDER-SEV W/O PSYCH</ICD9>
"TEMP","RORPRTDEF",6,9)
<ICD9 ID="296.24">DEPR DISORDER-SEV W PSYCH</ICD9>
"TEMP","RORPRTDEF",6,10)
<ICD9 ID="296.25">DEPR DISORDER-PART REMISS</ICD9>
"TEMP","RORPRTDEF",6,11)
<ICD9 ID="296.26">DEPR DISORDER-FULL REMISS</ICD9>
"TEMP","RORPRTDEF",6,12)
<ICD9 ID="296.30">RECURR DEPR DISORDER-UNSP</ICD9>
"TEMP","RORPRTDEF",6,13)
<ICD9 ID="296.31">RECURR DEPR DISORDER-MILD</ICD9>
"TEMP","RORPRTDEF",6,14)
<ICD9 ID="296.32">RECURR DEPR DISORDER-MOD</ICD9>
"TEMP","RORPRTDEF",6,15)
<ICD9 ID="296.33">RECUR DEPR DISORDER-SEVERE</ICD9>
"TEMP","RORPRTDEF",6,16)
<ICD9 ID="296.34">REC DEPR DISORDER-PSYCHOTIC</ICD9>
"TEMP","RORPRTDEF",6,17)
<ICD9 ID="296.35">RECUR DEPR DISORDER-PART REM</ICD9>
"TEMP","RORPRTDEF",6,18)
<ICD9 ID="296.36">RECUR DEPR DISORDER-FULL REM</ICD9>
"TEMP","RORPRTDEF",6,19)
<ICD9 ID="296.50">BIPOL I CUR DEPRES NOS</ICD9>
"TEMP","RORPRTDEF",6,20)
<ICD9 ID="296.51">BIPOL I CUR DEPRESS-MILD</ICD9>
"TEMP","RORPRTDEF",6,21)
<ICD9 ID="296.52">BIPOL I CUR DEPRESS-MOD</ICD9>
"TEMP","RORPRTDEF",6,22)
<ICD9 ID="296.53">BIPOL I CURR DEP W/O PSY</ICD9>
"TEMP","RORPRTDEF",6,23)
<ICD9 ID="296.54">BIPOL I CURRNT DEP W PSY</ICD9>
"TEMP","RORPRTDEF",6,24)
<ICD9 ID="296.55">BIPOL I CUR DEP REM NOS</ICD9>
"TEMP","RORPRTDEF",6,25)
<ICD9 ID="296.56">BIPOL I CURRNT DEP REMIS</ICD9>
"TEMP","RORPRTDEF",6,26)
<ICD9 ID="309.0">ADJUSTMNT DIS W DEPRESSN</ICD9>
"TEMP","RORPRTDEF",6,27)
<ICD9 ID="309.1">PROLONG DEPRESSIVE REACT</ICD9>
"TEMP","RORPRTDEF",6,28)
<ICD9 ID="309.28">ADJUST DIS W ANXIETY/DEP</ICD9>
"TEMP","RORPRTDEF",6,29)
<ICD9 ID="311.">DEPRESSIVE DISORDER NEC</ICD9>
"TEMP","RORPRTDEF",6,30)
</ICD9LST>
"TEMP","RORPRTDEF",6,31)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",6,32)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",6,33)
</PARAMS>
"TEMP","RORPRTDEF",7)
13::Diabetes Type I or II
"TEMP","RORPRTDEF",7,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",7,2)
<PARAMS>
"TEMP","RORPRTDEF",7,3)
<ICD9LST>
"TEMP","RORPRTDEF",7,4)
<ICD9 ID="250.00">DMII WO CMP NT ST UNCNTR</ICD9>
"TEMP","RORPRTDEF",7,5)
<ICD9 ID="250.01">DMI WO CMP NT ST UNCNTRL</ICD9>
"TEMP","RORPRTDEF",7,6)
<ICD9 ID="250.02">DMII WO CMP UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,7)
<ICD9 ID="250.03">DMI WO CMP UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,8)
<ICD9 ID="250.10">DMII KETO NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,9)
<ICD9 ID="250.11">DMI KETO NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,10)
<ICD9 ID="250.12">DMII KETOACD UNCONTROLD</ICD9>
"TEMP","RORPRTDEF",7,11)
<ICD9 ID="250.13">DMI KETOACD UNCONTROLD</ICD9>
"TEMP","RORPRTDEF",7,12)
<ICD9 ID="250.20">DMII HPRSM NT ST UNCNTRL</ICD9>
"TEMP","RORPRTDEF",7,13)
<ICD9 ID="250.21">DMI HPRSM NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,14)
<ICD9 ID="250.22">DMII HPROSMLR UNCONTROLD</ICD9>
"TEMP","RORPRTDEF",7,15)
<ICD9 ID="250.23">DMI HPROSMLR UNCONTROLD</ICD9>
"TEMP","RORPRTDEF",7,16)
<ICD9 ID="250.30">DMII O CM NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,17)
<ICD9 ID="250.31">DMI O CM NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,18)
<ICD9 ID="250.32">DMII OTH COMA UNCONTROLD</ICD9>
"TEMP","RORPRTDEF",7,19)
<ICD9 ID="250.33">DMI OTH COMA UNCONTROLD</ICD9>
"TEMP","RORPRTDEF",7,20)
<ICD9 ID="250.40">DMII RENL NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,21)
<ICD9 ID="250.41">DMI RENL NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,22)
<ICD9 ID="250.42">DMII RENAL UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,23)
<ICD9 ID="250.43">DMI RENAL UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,24)
<ICD9 ID="250.50">DMII OPHTH NT ST UNCNTRL</ICD9>
"TEMP","RORPRTDEF",7,25)
<ICD9 ID="250.51">DMI OPHTH NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,26)
<ICD9 ID="250.52">DMII OPHTH UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,27)
<ICD9 ID="250.53">DMI OPHTH UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,28)
<ICD9 ID="250.60">DMII NEURO NT ST UNCNTRL</ICD9>
"TEMP","RORPRTDEF",7,29)
<ICD9 ID="250.61">DMI NEURO NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,30)
<ICD9 ID="250.62">DMII NEURO UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,31)
<ICD9 ID="250.63">DMI NEURO UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,32)
<ICD9 ID="250.70">DMII CIRC NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,33)
<ICD9 ID="250.71">DMI CIRC NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,34)
<ICD9 ID="250.72">DMII CIRC UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,35)
<ICD9 ID="250.73">DMI CIRC UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,36)
<ICD9 ID="250.80">DMII OTH NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,37)
<ICD9 ID="250.81">DMI OTH NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,38)
<ICD9 ID="250.82">DMII OTH UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,39)
<ICD9 ID="250.83">DMI OTH UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,40)
<ICD9 ID="250.90">DMII UNSPF NT ST UNCNTRL</ICD9>
"TEMP","RORPRTDEF",7,41)
<ICD9 ID="250.91">DMI UNSPF NT ST UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,42)
<ICD9 ID="250.92">DMII UNSPF UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,43)
<ICD9 ID="250.93">DMI UNSPF UNCNTRLD</ICD9>
"TEMP","RORPRTDEF",7,44)
</ICD9LST>
"TEMP","RORPRTDEF",7,45)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",7,46)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",7,47)
</PARAMS>
"TEMP","RORPRTDEF",8)
13::ESLD
"TEMP","RORPRTDEF",8,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",8,2)
<PARAMS>
"TEMP","RORPRTDEF",8,3)
<ICD9LST>
"TEMP","RORPRTDEF",8,4)
<ICD9 ID="456.0">ESOPHAG VARICES W BLEED</ICD9>
"TEMP","RORPRTDEF",8,5)
<ICD9 ID="456.1">ESOPH VARICES W/O BLEED</ICD9>
"TEMP","RORPRTDEF",8,6)
<ICD9 ID="456.20">BLEED ESOPH VAR OTH DIS</ICD9>
"TEMP","RORPRTDEF",8,7)
<ICD9 ID="456.21">ESOPH VARICE OTH DIS NOS</ICD9>
"TEMP","RORPRTDEF",8,8)
<ICD9 ID="456.8">VARICES OF OTHER SITES</ICD9>
"TEMP","RORPRTDEF",8,9)
<ICD9 ID="572.2">HEPATIC COMA</ICD9>
"TEMP","RORPRTDEF",8,10)
<ICD9 ID="572.3">PORTAL HYPERTENSION</ICD9>
"TEMP","RORPRTDEF",8,11)
<ICD9 ID="572.4">HEPATORENAL SYNDROME</ICD9>
"TEMP","RORPRTDEF",8,12)
<ICD9 ID="572.8">OTH SEQUELA, CHR LIV DIS</ICD9>
"TEMP","RORPRTDEF",8,13)
</ICD9LST>
"TEMP","RORPRTDEF",8,14)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",8,15)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",8,16)
</PARAMS>
"TEMP","RORPRTDEF",9)
13::HIV+ Codes
"TEMP","RORPRTDEF",9,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",9,2)
<PARAMS>
"TEMP","RORPRTDEF",9,3)
<ICD9LST>
"TEMP","RORPRTDEF",9,4)
<ICD9 ID="042.">HIV DISEASE</ICD9>
"TEMP","RORPRTDEF",9,5)
<ICD9 ID="042.0">HIV WITH SPECIFIED INFECTIONS</ICD9>
"TEMP","RORPRTDEF",9,6)
<ICD9 ID="042.1">HIV CAUSING OTHER SPEC INF</ICD9>
"TEMP","RORPRTDEF",9,7)
<ICD9 ID="042.2">HIV WITH SPEC MALIGNANT NEO</ICD9>
"TEMP","RORPRTDEF",9,8)
<ICD9 ID="042.9">HIV-AIDS UNSPECIFIED</ICD9>
"TEMP","RORPRTDEF",9,9)
<ICD9 ID="043.0">HIV CAUSING LYMPHADENOPATHY</ICD9>
"TEMP","RORPRTDEF",9,10)
<ICD9 ID="043.1">HIV CAUSING SPEC DISEASE-CNS</ICD9>
"TEMP","RORPRTDEF",9,11)
<ICD9 ID="043.2">HIV CAUSE OTH IMMUNE DIS</ICD9>
"TEMP","RORPRTDEF",9,12)
<ICD9 ID="043.3">HIV CAUSE OTHER SPEC DISORDERS</ICD9>
"TEMP","RORPRTDEF",9,13)
<ICD9 ID="043.9">HIV-ARC, UNSPECIFIED</ICD9>
"TEMP","RORPRTDEF",9,14)
<ICD9 ID="044.0">OTHER HIV CAUSE SPEC ACUTE INF</ICD9>
"TEMP","RORPRTDEF",9,15)
<ICD9 ID="044.9">HIV INFECTION UNSPECIFIED</ICD9>
"TEMP","RORPRTDEF",9,16)
<ICD9 ID="795.8">POSITIVE SERO/VIRAL HIV</ICD9>
"TEMP","RORPRTDEF",9,17)
<ICD9 ID="V08.">ASYMPT HIV STATUS</ICD9>
"TEMP","RORPRTDEF",9,18)
</ICD9LST>
"TEMP","RORPRTDEF",9,19)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",9,20)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",9,21)
</PARAMS>
"TEMP","RORPRTDEF",10)
13::Hepatitis B
"TEMP","RORPRTDEF",10,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",10,2)
<PARAMS>
"TEMP","RORPRTDEF",10,3)
<ICD9LST>
"TEMP","RORPRTDEF",10,4)
<ICD9 ID="070.2">HEPATITIS B WITH COMA</ICD9>
"TEMP","RORPRTDEF",10,5)
<ICD9 ID="070.20">VIR HEP B W/COMA, W/O DELTA</ICD9>
"TEMP","RORPRTDEF",10,6)
<ICD9 ID="070.21">VIRAL HEPATITIS B W COMA/DELTA</ICD9>
"TEMP","RORPRTDEF",10,7)
<ICD9 ID="070.22">CH HEP B W/ H. COMA W/O DELTA</ICD9>
"TEMP","RORPRTDEF",10,8)
<ICD9 ID="070.23">CH HEP B W/ H. COMA W/ DELTA</ICD9>
"TEMP","RORPRTDEF",10,9)
<ICD9 ID="070.3">HEPATITIS B W/O COMA</ICD9>
"TEMP","RORPRTDEF",10,10)
<ICD9 ID="070.30">VIR HEP B W/O COMA, W/O DELTA</ICD9>
"TEMP","RORPRTDEF",10,11)
<ICD9 ID="070.31">VIR HEP B W/O COMA, W/DELTA</ICD9>
"TEMP","RORPRTDEF",10,12)
<ICD9 ID="070.32">CH HEP B W/O H. COMA W/O DELTA</ICD9>
"TEMP","RORPRTDEF",10,13)
<ICD9 ID="070.33">CH HEP B W/O H. COMA W/ DELTA</ICD9>
"TEMP","RORPRTDEF",10,14)
<ICD9 ID="V02.61">HEPATITIS B CARRIER</ICD9>
"TEMP","RORPRTDEF",10,15)
</ICD9LST>
"TEMP","RORPRTDEF",10,16)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",10,17)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",10,18)
</PARAMS>
"TEMP","RORPRTDEF",11)
13::Hepatitis C
"TEMP","RORPRTDEF",11,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",11,2)
<PARAMS>
"TEMP","RORPRTDEF",11,3)
<ICD9LST>
"TEMP","RORPRTDEF",11,4)
<ICD9 ID="070.44">CH HEP C W/ COMA</ICD9>
"TEMP","RORPRTDEF",11,5)
<ICD9 ID="070.54">CH HEP C W/O COMA</ICD9>
"TEMP","RORPRTDEF",11,6)
<ICD9 ID="070.70">HPT C W/O HEPAT COMA NOS</ICD9>
"TEMP","RORPRTDEF",11,7)
<ICD9 ID="070.71">HPT C W HEPATIC COMA NOS</ICD9>
"TEMP","RORPRTDEF",11,8)
<ICD9 ID="V02.62">HEPATITIS C CARRIER</ICD9>
"TEMP","RORPRTDEF",11,9)
</ICD9LST>
"TEMP","RORPRTDEF",11,10)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",11,11)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",11,12)
</PARAMS>
"TEMP","RORPRTDEF",12)
13::Hypertension
"TEMP","RORPRTDEF",12,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",12,2)
<PARAMS>
"TEMP","RORPRTDEF",12,3)
<ICD9LST>
"TEMP","RORPRTDEF",12,4)
<ICD9 ID="401.0">MALIGNANT HYPERTENSION</ICD9>
"TEMP","RORPRTDEF",12,5)
<ICD9 ID="401.1">BENIGN HYPERTENSION</ICD9>
"TEMP","RORPRTDEF",12,6)
<ICD9 ID="401.9">HYPERTENSION NOS</ICD9>
"TEMP","RORPRTDEF",12,7)
<ICD9 ID="402.00">HYP HEART DIS MALIGN W/O FAIL</ICD9>
"TEMP","RORPRTDEF",12,8)
<ICD9 ID="402.01">HYP HEART DIS MALIGN WITH FAIL</ICD9>
"TEMP","RORPRTDEF",12,9)
<ICD9 ID="402.10">HYP HEART DIS BENING W/0 FAIL</ICD9>
"TEMP","RORPRTDEF",12,10)
<ICD9 ID="402.11">HYP HEART DIS BENING WITH FAIL</ICD9>
"TEMP","RORPRTDEF",12,11)
<ICD9 ID="402.90">HYP HEART DIS UNSPECI W/O FAIL</ICD9>
"TEMP","RORPRTDEF",12,12)
<ICD9 ID="402.91">HYP HEART DIS UNSP WITH FAIL</ICD9>
"TEMP","RORPRTDEF",12,13)
<ICD9 ID="403.0">MAL HYPERTENS RENAL DIS</ICD9>
"TEMP","RORPRTDEF",12,14)
<ICD9 ID="403.00">MAL HYP REN W/O REN FAIL</ICD9>
"TEMP","RORPRTDEF",12,15)
<ICD9 ID="403.01">MAL HYP REN W RENAL FAIL</ICD9>
"TEMP","RORPRTDEF",12,16)
<ICD9 ID="403.1">BENIGN HYPERT RENAL DIS</ICD9>
"TEMP","RORPRTDEF",12,17)
<ICD9 ID="403.10">BEN HYP REN W/O REN FAIL</ICD9>
"TEMP","RORPRTDEF",12,18)
<ICD9 ID="403.11">BEN HYP RENAL W REN FAIL</ICD9>
"TEMP","RORPRTDEF",12,19)
<ICD9 ID="403.9">HYPERTENS RENAL DIS NOS</ICD9>
"TEMP","RORPRTDEF",12,20)
<ICD9 ID="403.90">HYP REN NOS W/O REN FAIL</ICD9>
"TEMP","RORPRTDEF",12,21)
<ICD9 ID="403.91">HYP REN NOS W REN FAIL</ICD9>
"TEMP","RORPRTDEF",12,22)
<ICD9 ID="404.0">MAL HYPERT HRT/RENAL DIS</ICD9>
"TEMP","RORPRTDEF",12,23)
<ICD9 ID="404.00">HYP HRT &amp; REN DIS MALIG W/O ME</ICD9>
"TEMP","RORPRTDEF",12,24)
<ICD9 ID="404.01">HYP HRT &amp; REN DIS MAL W/ HEART</ICD9>
"TEMP","RORPRTDEF",12,25)
<ICD9 ID="404.02">MAL HY HT/REN W REN FAIL</ICD9>
"TEMP","RORPRTDEF",12,26)
<ICD9 ID="404.03">HYP HRT &amp; REN MAL W/HRT &amp; RENL</ICD9>
"TEMP","RORPRTDEF",12,27)
<ICD9 ID="404.1">BEN HYPERT HRT/RENAL DIS</ICD9>
"TEMP","RORPRTDEF",12,28)
<ICD9 ID="404.10">HYP HRT &amp; REN DIS BENIGN W/O</ICD9>
"TEMP","RORPRTDEF",12,29)
<ICD9 ID="404.11">HYP HRT &amp; REN BENIGN W/ HEART</ICD9>
"TEMP","RORPRTDEF",12,30)
<ICD9 ID="404.12">BEN HY HT/REN W REN FAIL</ICD9>
"TEMP","RORPRTDEF",12,31)
<ICD9 ID="404.13">HYP HRT &amp; REN BEN W/HRT &amp; REN</ICD9>
"TEMP","RORPRTDEF",12,32)
<ICD9 ID="404.9">HYPERT HRT/RENAL DIS NOS</ICD9>
"TEMP","RORPRTDEF",12,33)
<ICD9 ID="404.90">HYP HRT &amp; REN DIS UNSPECIFIED</ICD9>
"TEMP","RORPRTDEF",12,34)
<ICD9 ID="404.91">HYP HRT &amp; REN UNSP W/HEART</ICD9>
"TEMP","RORPRTDEF",12,35)
<ICD9 ID="404.92">HY HT/REN NOS W REN FAIL</ICD9>
"TEMP","RORPRTDEF",12,36)
<ICD9 ID="404.93">HYP HRT &amp; REN UNS W/HRT &amp; REN</ICD9>
"TEMP","RORPRTDEF",12,37)
<ICD9 ID="405.01">MAL RENOVASC HYPERTENS</ICD9>
"TEMP","RORPRTDEF",12,38)
<ICD9 ID="405.09">MAL SECOND HYPERTEN NEC</ICD9>
"TEMP","RORPRTDEF",12,39)
<ICD9 ID="405.91">RENOVASC HYPERTENSION</ICD9>
"TEMP","RORPRTDEF",12,40)
<ICD9 ID="405.99">SECOND HYPERTENSION NEC</ICD9>
"TEMP","RORPRTDEF",12,41)
</ICD9LST>
"TEMP","RORPRTDEF",12,42)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",12,43)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",12,44)
</PARAMS>
"TEMP","RORPRTDEF",13)
13::Ischemic Heart Disease
"TEMP","RORPRTDEF",13,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",13,2)
<PARAMS>
"TEMP","RORPRTDEF",13,3)
<ICD9LST>
"TEMP","RORPRTDEF",13,4)
<ICD9 ID="410.0">AMI ANTEROLATERAL WALL</ICD9>
"TEMP","RORPRTDEF",13,5)
<ICD9 ID="410.00">AMI ANTEROLATERAL, UNSPEC</ICD9>
"TEMP","RORPRTDEF",13,6)
<ICD9 ID="410.01">AMI ANTEROLATERAL, INIT</ICD9>
"TEMP","RORPRTDEF",13,7)
<ICD9 ID="410.02">AMI ANTEROLATERAL, SUBSEQ</ICD9>
"TEMP","RORPRTDEF",13,8)
<ICD9 ID="410.1">AMI ANTERIOR WALL NEC</ICD9>
"TEMP","RORPRTDEF",13,9)
<ICD9 ID="410.10">AMI ANTERIOR WALL, UNSPEC</ICD9>
"TEMP","RORPRTDEF",13,10)
<ICD9 ID="410.11">AMI ANTERIOR WALL, INIT</ICD9>
"TEMP","RORPRTDEF",13,11)
<ICD9 ID="410.12">AMI ANTERIOR WALL, SUBSEQ</ICD9>
"TEMP","RORPRTDEF",13,12)
<ICD9 ID="410.2">AMI INFEROLATERAL WALL</ICD9>
"TEMP","RORPRTDEF",13,13)
<ICD9 ID="410.20">AMI INFEROLATERAL, UNSPEC</ICD9>
"TEMP","RORPRTDEF",13,14)
<ICD9 ID="410.21">AMI INFEROLATERAL, INIT</ICD9>
"TEMP","RORPRTDEF",13,15)
<ICD9 ID="410.22">AMI INFEROLATERAL, SUBSEQ</ICD9>
"TEMP","RORPRTDEF",13,16)
<ICD9 ID="410.3">AMI INFEROPOSTERIOR WALL</ICD9>
"TEMP","RORPRTDEF",13,17)
<ICD9 ID="410.30">AMI INFEROPOST, UNSPEC</ICD9>
"TEMP","RORPRTDEF",13,18)
<ICD9 ID="410.31">AMI INFEROPOST, INITIAL</ICD9>
"TEMP","RORPRTDEF",13,19)
<ICD9 ID="410.32">AMI INFEROPOST, SUBSEQ</ICD9>
"TEMP","RORPRTDEF",13,20)
<ICD9 ID="410.4">AMI INFERIOR WALL NEC</ICD9>
"TEMP","RORPRTDEF",13,21)
<ICD9 ID="410.40">AMI INFERIOR WALL, UNSPEC</ICD9>
"TEMP","RORPRTDEF",13,22)
<ICD9 ID="410.41">AMI INFERIOR WALL, INIT</ICD9>
"TEMP","RORPRTDEF",13,23)
<ICD9 ID="410.42">AMI INFERIOR WALL, SUBSEQ</ICD9>
"TEMP","RORPRTDEF",13,24)
<ICD9 ID="410.5">AMI LATERAL WALL NEC</ICD9>
"TEMP","RORPRTDEF",13,25)
<ICD9 ID="410.50">AMI LATERAL NEC, UNSPEC</ICD9>
"TEMP","RORPRTDEF",13,26)
<ICD9 ID="410.51">AMI LATERAL NEC, INITIAL</ICD9>
"TEMP","RORPRTDEF",13,27)
<ICD9 ID="410.52">AMI LATERAL NEC, SUBSEQ</ICD9>
"TEMP","RORPRTDEF",13,28)
<ICD9 ID="410.6">TRUE POSTERIOR INFARCT</ICD9>
"TEMP","RORPRTDEF",13,29)
<ICD9 ID="410.60">TRUE POST INFARCT, UNSPEC</ICD9>
"TEMP","RORPRTDEF",13,30)
<ICD9 ID="410.61">TRUE POST INFARCT, INIT</ICD9>
"TEMP","RORPRTDEF",13,31)
<ICD9 ID="410.62">TRUE POST INFARCT, SUBSEQ</ICD9>
"TEMP","RORPRTDEF",13,32)
<ICD9 ID="410.7">SUBENDOCARDIAL INFARCT</ICD9>
"TEMP","RORPRTDEF",13,33)
<ICD9 ID="410.70">SUBENDO INFARCT, UNSPEC</ICD9>
"TEMP","RORPRTDEF",13,34)
<ICD9 ID="410.71">SUBENDO INFARCT, INITIAL</ICD9>
"TEMP","RORPRTDEF",13,35)
<ICD9 ID="410.72">SUBENDO INFARCT, SUBSEQ</ICD9>
"TEMP","RORPRTDEF",13,36)
<ICD9 ID="410.8">MYOCARDIAL INFARCT NEC</ICD9>
"TEMP","RORPRTDEF",13,37)
<ICD9 ID="410.80">AMI NEC, UNSPECIFIED</ICD9>
"TEMP","RORPRTDEF",13,38)
<ICD9 ID="410.81">AMI NEC, INITIAL</ICD9>
"TEMP","RORPRTDEF",13,39)
<ICD9 ID="410.82">AMI NEC, SUBSEQUENT</ICD9>
"TEMP","RORPRTDEF",13,40)
<ICD9 ID="410.9">MYOCARDIAL INFARCT NOS</ICD9>
"TEMP","RORPRTDEF",13,41)
<ICD9 ID="410.90">AMI NOS, UNSPECIFIED</ICD9>
"TEMP","RORPRTDEF",13,42)
<ICD9 ID="410.91">AMI NOS, INITIAL</ICD9>
"TEMP","RORPRTDEF",13,43)
<ICD9 ID="410.92">AMI NOS, SUBSEQUENT</ICD9>
"TEMP","RORPRTDEF",13,44)
<ICD9 ID="411.0">POST MI SYNDROME</ICD9>
"TEMP","RORPRTDEF",13,45)
<ICD9 ID="411.1">INTERMED CORONARY SYND</ICD9>
"TEMP","RORPRTDEF",13,46)
<ICD9 ID="411.8">AC ISCHEMIC HRT DIS NEC</ICD9>
"TEMP","RORPRTDEF",13,47)
<ICD9 ID="411.81">AC CORONAR OCCL W/O MYO INFARC</ICD9>
"TEMP","RORPRTDEF",13,48)
<ICD9 ID="411.89">AC ISCHEMIC HRT DIS NEC</ICD9>
"TEMP","RORPRTDEF",13,49)
<ICD9 ID="412.">OLD MYOCARDIAL INFARCT</ICD9>
"TEMP","RORPRTDEF",13,50)
<ICD9 ID="413.0">ANGINA DECUBITUS</ICD9>
"TEMP","RORPRTDEF",13,51)
<ICD9 ID="413.1">PRINZMETAL ANGINA</ICD9>
"TEMP","RORPRTDEF",13,52)
<ICD9 ID="413.9">ANGINA PECTORIS NEC/NOS</ICD9>
"TEMP","RORPRTDEF",13,53)
<ICD9 ID="414.0">CORONARY ATHEROSCLEROSIS</ICD9>
"TEMP","RORPRTDEF",13,54)
<ICD9 ID="414.00">COR ATHEROSCL UNSP TYP-VES</ICD9>
"TEMP","RORPRTDEF",13,55)
<ICD9 ID="414.01">COR ATHEROSCL NATV C VSL</ICD9>
"TEMP","RORPRTDEF",13,56)
<ICD9 ID="414.02">COR ATHEROSCL AUTOL V BYP</ICD9>
"TEMP","RORPRTDEF",13,57)
<ICD9 ID="414.03">COR ATHEROSCL NONAUTO BIO BYP</ICD9>
"TEMP","RORPRTDEF",13,58)
<ICD9 ID="414.04">CORONARY ATHER/ART BYP GRFT</ICD9>
"TEMP","RORPRTDEF",13,59)
<ICD9 ID="414.05">CORONARY ATHER/UNSP TYP BYP GR</ICD9>
"TEMP","RORPRTDEF",13,60)
<ICD9 ID="414.06">COR ATH NATV ART TP HRT</ICD9>
"TEMP","RORPRTDEF",13,61)
<ICD9 ID="414.07">COR ATH BPS GRAFT TP HRT</ICD9>
"TEMP","RORPRTDEF",13,62)
<ICD9 ID="414.10">ANEURYSM OF HEART</ICD9>
"TEMP","RORPRTDEF",13,63)
<ICD9 ID="414.11">ANEURYSM OF CORONARY VESSELS</ICD9>
"TEMP","RORPRTDEF",13,64)
<ICD9 ID="414.12">DISSECTION OF CORONARY ARTERY</ICD9>
"TEMP","RORPRTDEF",13,65)
<ICD9 ID="414.19">OTHER ANEURYSM OF HEART</ICD9>
"TEMP","RORPRTDEF",13,66)
<ICD9 ID="414.8">CHR ISCHEMIC HRT DIS NEC</ICD9>
"TEMP","RORPRTDEF",13,67)
<ICD9 ID="414.9">CHR ISCHEMIC HRT DIS NOS</ICD9>
"TEMP","RORPRTDEF",13,68)
</ICD9LST>
"TEMP","RORPRTDEF",13,69)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",13,70)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",13,71)
</PARAMS>
"TEMP","RORPRTDEF",14)
13::Schizophrenia
"TEMP","RORPRTDEF",14,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",14,2)
<PARAMS>
"TEMP","RORPRTDEF",14,3)
<ICD9LST>
"TEMP","RORPRTDEF",14,4)
<ICD9 ID="295.00">SIMPL SCHIZOPHREN-UNSPEC</ICD9>
"TEMP","RORPRTDEF",14,5)
<ICD9 ID="295.01">SIMPL SCHIZOPHREN-SUBCHR</ICD9>
"TEMP","RORPRTDEF",14,6)
<ICD9 ID="295.02">SIMPLE SCHIZOPHREN-CHR</ICD9>
"TEMP","RORPRTDEF",14,7)
<ICD9 ID="295.03">SIMP SCHIZ-SUBCHR/EXACER</ICD9>
"TEMP","RORPRTDEF",14,8)
<ICD9 ID="295.04">SIMPL SCHIZO-CHR/EXACERB</ICD9>
"TEMP","RORPRTDEF",14,9)
<ICD9 ID="295.05">SIMPL SCHIZOPHREN-REMISS</ICD9>
"TEMP","RORPRTDEF",14,10)
<ICD9 ID="295.10">DISORGANIZED SCHIZO-UNSP</ICD9>
"TEMP","RORPRTDEF",14,11)
<ICD9 ID="295.11">DISORGANIZED SCHIZO-SUBCHRONIC</ICD9>
"TEMP","RORPRTDEF",14,12)
<ICD9 ID="295.12">DISORGANIZED SCHIZO-CHRONIC</ICD9>
"TEMP","RORPRTDEF",14,13)
<ICD9 ID="295.13">DISORG SCHIZO-SUBCHR/EXACERB</ICD9>
"TEMP","RORPRTDEF",14,14)
<ICD9 ID="295.14">DISORG SCHIZO-CHR/EXACERB</ICD9>
"TEMP","RORPRTDEF",14,15)
<ICD9 ID="295.15">DISORGANIZED SCHIZO-REMISS</ICD9>
"TEMP","RORPRTDEF",14,16)
<ICD9 ID="295.20">CATATONIC-UNSPEC</ICD9>
"TEMP","RORPRTDEF",14,17)
<ICD9 ID="295.21">CATATONIC-SUBCHRONIC</ICD9>
"TEMP","RORPRTDEF",14,18)
<ICD9 ID="295.22">CATATONIC-CHRONIC</ICD9>
"TEMP","RORPRTDEF",14,19)
<ICD9 ID="295.23">CATATONIC-SUBCHR/EXACERB</ICD9>
"TEMP","RORPRTDEF",14,20)
<ICD9 ID="295.24">CATATONIC-CHR/EXACERB</ICD9>
"TEMP","RORPRTDEF",14,21)
<ICD9 ID="295.25">CATATONIC-REMISSION</ICD9>
"TEMP","RORPRTDEF",14,22)
<ICD9 ID="295.30">PARANOID SCHIZO-UNSPEC</ICD9>
"TEMP","RORPRTDEF",14,23)
<ICD9 ID="295.31">PARANOID SCHIZO-SUBCHR</ICD9>
"TEMP","RORPRTDEF",14,24)
<ICD9 ID="295.32">PARANOID SCHIZO-CHRONIC</ICD9>
"TEMP","RORPRTDEF",14,25)
<ICD9 ID="295.33">PARAN SCHIZO-SUBCHR/EXAC</ICD9>
"TEMP","RORPRTDEF",14,26)
<ICD9 ID="295.34">PARAN SCHIZO-CHR/EXACERB</ICD9>
"TEMP","RORPRTDEF",14,27)
<ICD9 ID="295.35">PARANOID SCHIZO-REMISS</ICD9>
"TEMP","RORPRTDEF",14,28)
<ICD9 ID="295.40">SCHIZOPHRENIFORM DIS NOS</ICD9>
"TEMP","RORPRTDEF",14,29)
<ICD9 ID="295.41">SCHIZOPHRENIC DIS-SUBCHR</ICD9>
"TEMP","RORPRTDEF",14,30)
<ICD9 ID="295.42">SCHIZOPHREN DIS-CHRONIC</ICD9>
"TEMP","RORPRTDEF",14,31)
<ICD9 ID="295.43">SCHIZO DIS-SUBCHR/EXACER</ICD9>
"TEMP","RORPRTDEF",14,32)
<ICD9 ID="295.44">SCHIZOPHR DIS-CHR/EXACER</ICD9>
"TEMP","RORPRTDEF",14,33)
<ICD9 ID="295.45">SCHIZOPHRENIC DIS-REMISS</ICD9>
"TEMP","RORPRTDEF",14,34)
<ICD9 ID="295.50">LATENT SCHIZOPHREN-UNSP</ICD9>
"TEMP","RORPRTDEF",14,35)
<ICD9 ID="295.51">LAT SCHIZOPHREN-SUBCHR</ICD9>
"TEMP","RORPRTDEF",14,36)
<ICD9 ID="295.52">LATENT SCHIZOPHREN-CHR</ICD9>
"TEMP","RORPRTDEF",14,37)
<ICD9 ID="295.53">LAT SCHIZO-SUBCHR/EXACER</ICD9>
"TEMP","RORPRTDEF",14,38)
<ICD9 ID="295.54">LATENT SCHIZO-CHR/EXACER</ICD9>
"TEMP","RORPRTDEF",14,39)
<ICD9 ID="295.55">LAT SCHIZOPHREN-REMISS</ICD9>
"TEMP","RORPRTDEF",14,40)
<ICD9 ID="295.60">SCHIZOPHR DIS RESID NOS</ICD9>
"TEMP","RORPRTDEF",14,41)
<ICD9 ID="295.61">SCHIZOPH DIS RESID-SUBCH</ICD9>
"TEMP","RORPRTDEF",14,42)
<ICD9 ID="295.62">SCHIZOPHR DIS RESID-CHR</ICD9>
"TEMP","RORPRTDEF",14,43)
<ICD9 ID="295.63">SCHIZO RESID SUBCHR/EXAC</ICD9>
"TEMP","RORPRTDEF",14,44)
<ICD9 ID="295.64">SCHIZOPH RESID-CHRO/EXAC</ICD9>
"TEMP","RORPRTDEF",14,45)
<ICD9 ID="295.65">SCHIZOPH DIS RESID-REMIS</ICD9>
"TEMP","RORPRTDEF",14,46)
<ICD9 ID="295.70">SCHIZOAFFECTIVE DIS NOS</ICD9>
"TEMP","RORPRTDEF",14,47)
<ICD9 ID="295.71">SCHIZOAFFECTV DIS-SUBCHR</ICD9>
"TEMP","RORPRTDEF",14,48)
<ICD9 ID="295.72">SCHIZOAFFECTIVE DIS-CHR</ICD9>
"TEMP","RORPRTDEF",14,49)
<ICD9 ID="295.73">SCHIZOAFF DIS-SUBCH/EXAC</ICD9>
"TEMP","RORPRTDEF",14,50)
<ICD9 ID="295.74">SCHIZOAFFTV DIS-CHR/EXAC</ICD9>
"TEMP","RORPRTDEF",14,51)
<ICD9 ID="295.75">SCHIZOAFFECTVE DIS-REMIS</ICD9>
"TEMP","RORPRTDEF",14,52)
<ICD9 ID="295.80">SCHIZOPHRENIA OTH-UNSPEC</ICD9>
"TEMP","RORPRTDEF",14,53)
<ICD9 ID="295.81">SCHIZOPHRENIA OTH-SUBCHR</ICD9>
"TEMP","RORPRTDEF",14,54)
<ICD9 ID="295.82">SCHIZOPHRENIA OTH-CHR</ICD9>
"TEMP","RORPRTDEF",14,55)
<ICD9 ID="295.83">SCHIZO OTH-SUBCHR/EXACER</ICD9>
"TEMP","RORPRTDEF",14,56)
<ICD9 ID="295.84">SCHIZO OTH-CHR/EXACERB</ICD9>
"TEMP","RORPRTDEF",14,57)
<ICD9 ID="295.85">SCHIZOPHRENIA OTH-REMISS</ICD9>
"TEMP","RORPRTDEF",14,58)
<ICD9 ID="295.90">SCHIZOPHRENIA NOS-UNSPEC</ICD9>
"TEMP","RORPRTDEF",14,59)
<ICD9 ID="295.91">SCHIZOPHRENIA NOS-SUBCHR</ICD9>
"TEMP","RORPRTDEF",14,60)
<ICD9 ID="295.92">SCHIZOPHRENIA NOS-CHR</ICD9>
"TEMP","RORPRTDEF",14,61)
<ICD9 ID="295.93">SCHIZO NOS-SUBCHR/EXACER</ICD9>
"TEMP","RORPRTDEF",14,62)
<ICD9 ID="295.94">SCHIZO NOS-CHR/EXACERB</ICD9>
"TEMP","RORPRTDEF",14,63)
<ICD9 ID="295.95">SCHIZOPHRENIA NOS-REMISS</ICD9>
"TEMP","RORPRTDEF",14,64)
</ICD9LST>
"TEMP","RORPRTDEF",14,65)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",14,66)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",14,67)
</PARAMS>
"TEMP","RORPRTDEF",15)
13::Substance use (non-alcohol)
"TEMP","RORPRTDEF",15,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",15,2)
<PARAMS>
"TEMP","RORPRTDEF",15,3)
<ICD9LST>
"TEMP","RORPRTDEF",15,4)
<ICD9 ID="304.00">OPIOID DEPENDENCE UNSPECIFIED</ICD9>
"TEMP","RORPRTDEF",15,5)
<ICD9 ID="304.01">OPIOID DEPENDENCE CONT</ICD9>
"TEMP","RORPRTDEF",15,6)
<ICD9 ID="304.02">OPIOID DEPENDENCE EPISODIC</ICD9>
"TEMP","RORPRTDEF",15,7)
<ICD9 ID="304.03">OPIOID DEPENDENCE IN REMISSION</ICD9>
"TEMP","RORPRTDEF",15,8)
<ICD9 ID="304.09">OTHER OPIOID TYPE DEPEN, NEC</ICD9>
"TEMP","RORPRTDEF",15,9)
<ICD9 ID="304.10">SED,HYP,ANXIOLYT DEP-NOS</ICD9>
"TEMP","RORPRTDEF",15,10)
<ICD9 ID="304.11">SED,HYP,ANXIOLYT DEP-CON</ICD9>
"TEMP","RORPRTDEF",15,11)
<ICD9 ID="304.12">SED,HYP,ANXIOLYT DEP-EPI</ICD9>
"TEMP","RORPRTDEF",15,12)
<ICD9 ID="304.13">SED,HYP,ANXIOLYT DEP-REM</ICD9>
"TEMP","RORPRTDEF",15,13)
<ICD9 ID="304.14">PARALDEHYDE DEPENDENCE</ICD9>
"TEMP","RORPRTDEF",15,14)
<ICD9 ID="304.15">PLACIDYL, ETHCHLORUYNOL DEPEND</ICD9>
"TEMP","RORPRTDEF",15,15)
<ICD9 ID="304.16">VALIUM, DIAZEPAM DEPEND</ICD9>
"TEMP","RORPRTDEF",15,16)
<ICD9 ID="304.17">DORIDEN, GLUTETHIMIDE DEPEND</ICD9>
"TEMP","RORPRTDEF",15,17)
<ICD9 ID="304.18">BARBITURATE DEPENDENCE</ICD9>
"TEMP","RORPRTDEF",15,18)
<ICD9 ID="304.19">OTHER SEDATIVE OR HYPNOTIC</ICD9>
"TEMP","RORPRTDEF",15,19)
<ICD9 ID="304.20">COCAINE DEPEND-UNSPEC</ICD9>
"TEMP","RORPRTDEF",15,20)
<ICD9 ID="304.21">COCAINE DEPEND-CONTIN</ICD9>
"TEMP","RORPRTDEF",15,21)
<ICD9 ID="304.22">COCAINE DEPEND-EPISODIC</ICD9>
"TEMP","RORPRTDEF",15,22)
<ICD9 ID="304.23">COCAINE DEPEND-REMISS</ICD9>
"TEMP","RORPRTDEF",15,23)
<ICD9 ID="304.30">CANNABIS DEPENDENCE UNSPEC</ICD9>
"TEMP","RORPRTDEF",15,24)
<ICD9 ID="304.31">CANNABIS DEPENDENCE CONTINUOUS</ICD9>
"TEMP","RORPRTDEF",15,25)
<ICD9 ID="304.32">CANNABIS DEPENDENCE EPISODIC</ICD9>
"TEMP","RORPRTDEF",15,26)
<ICD9 ID="304.33">CANNABIS DEPENDENCE IN REMISS</ICD9>
"TEMP","RORPRTDEF",15,27)
<ICD9 ID="304.39">OTHER CANNABIS DEPEND, NEC</ICD9>
"TEMP","RORPRTDEF",15,28)
<ICD9 ID="304.40">AMPHETAMINE DEPENDENCE UNSPEC</ICD9>
"TEMP","RORPRTDEF",15,29)
<ICD9 ID="304.41">AMPHETAMINE DEPENDENCE CONT</ICD9>
"TEMP","RORPRTDEF",15,30)
<ICD9 ID="304.42">AMPHETAMINE DEPENDENCE EPISOD</ICD9>
"TEMP","RORPRTDEF",15,31)
<ICD9 ID="304.43">AMPHETAMINE DEPENDENCE IN REM</ICD9>
"TEMP","RORPRTDEF",15,32)
<ICD9 ID="304.49">OTHER PSYCHOSTIM DEPEND</ICD9>
"TEMP","RORPRTDEF",15,33)
<ICD9 ID="304.50">HALLUCINOGEN DEPENDENCE UNSPEC</ICD9>
"TEMP","RORPRTDEF",15,34)
<ICD9 ID="304.51">HALLUCINOGEN DEPENDENCE CONT</ICD9>
"TEMP","RORPRTDEF",15,35)
<ICD9 ID="304.52">HALLUCINOGEN DEPENDENCE EPISOD</ICD9>
"TEMP","RORPRTDEF",15,36)
<ICD9 ID="304.53">HALLUCINOGEN DEPENDENCE IN REM</ICD9>
"TEMP","RORPRTDEF",15,37)
<ICD9 ID="304.59">OTHER HALLUCINOGEN DEPEND</ICD9>
"TEMP","RORPRTDEF",15,38)
<ICD9 ID="304.60">DRUG DEPEND OTH-UNSPEC</ICD9>
"TEMP","RORPRTDEF",15,39)
<ICD9 ID="304.61">DRUG DEPEND OTH-CONTIN</ICD9>
"TEMP","RORPRTDEF",15,40)
<ICD9 ID="304.62">DRUG DEPEND OTH-EPISODIC</ICD9>
"TEMP","RORPRTDEF",15,41)
<ICD9 ID="304.63">DRUG DEPEND OTH-IN REM</ICD9>
"TEMP","RORPRTDEF",15,42)
<ICD9 ID="304.70">OPIOID+OTHER DEP-UNSPEC</ICD9>
"TEMP","RORPRTDEF",15,43)
<ICD9 ID="304.71">OPIOID+OTHER DEP-CONTIN</ICD9>
"TEMP","RORPRTDEF",15,44)
<ICD9 ID="304.72">OPIOID+OTHER DEP-EPISOD</ICD9>
"TEMP","RORPRTDEF",15,45)
<ICD9 ID="304.73">OPIOID+OTHER DEP-REMISS</ICD9>
"TEMP","RORPRTDEF",15,46)
<ICD9 ID="304.80">COMB DRUG DEP NEC-UNSPEC</ICD9>
"TEMP","RORPRTDEF",15,47)
<ICD9 ID="304.81">COMB DRUG DEP NEC-CONTIN</ICD9>
"TEMP","RORPRTDEF",15,48)
<ICD9 ID="304.82">COMB DRUG DEP NEC-EPISOD</ICD9>
"TEMP","RORPRTDEF",15,49)
<ICD9 ID="304.83">COMB DRUG DEP NEC-REMISS</ICD9>
"TEMP","RORPRTDEF",15,50)
<ICD9 ID="304.90">UNSPEC DRUG DEPEND NEC UNSPEC</ICD9>
"TEMP","RORPRTDEF",15,51)
<ICD9 ID="304.91">UNSPEC DRUG DEPEND CONTIN</ICD9>
"TEMP","RORPRTDEF",15,52)
<ICD9 ID="304.92">DRUG DEPEND NOS-EPISODIC</ICD9>
"TEMP","RORPRTDEF",15,53)
<ICD9 ID="304.93">DRUG DEPEND NOS-REMISS</ICD9>
"TEMP","RORPRTDEF",15,54)
<ICD9 ID="304.99">UNSPEC DRUG DEPEND, NEC</ICD9>
"TEMP","RORPRTDEF",15,55)
<ICD9 ID="305.20">CANNABIS ABUSE UNSPECIFIED</ICD9>
"TEMP","RORPRTDEF",15,56)
<ICD9 ID="305.21">CANNABIS ABUSE-CONTIN</ICD9>
"TEMP","RORPRTDEF",15,57)
<ICD9 ID="305.22">CANNABIS ABUSE-EPISODIC</ICD9>
"TEMP","RORPRTDEF",15,58)
<ICD9 ID="305.23">CANNABIS ABUSE-IN REMISS</ICD9>
"TEMP","RORPRTDEF",15,59)
<ICD9 ID="305.29">OTHER CANNABIS USE, NEC</ICD9>
"TEMP","RORPRTDEF",15,60)
<ICD9 ID="305.30">HALLUCINOG ABUSE-UNSPEC</ICD9>
"TEMP","RORPRTDEF",15,61)
<ICD9 ID="305.31">HALLUCINOG ABUSE-CONTIN</ICD9>
"TEMP","RORPRTDEF",15,62)
<ICD9 ID="305.32">HALLUCINOG ABUSE-EPISOD</ICD9>
"TEMP","RORPRTDEF",15,63)
<ICD9 ID="305.33">HALLUCINOG ABUSE-REMISS</ICD9>
"TEMP","RORPRTDEF",15,64)
<ICD9 ID="305.39">OTHER HALLUCINOGEN ABUSE, NEC</ICD9>
"TEMP","RORPRTDEF",15,65)
<ICD9 ID="305.40">SED,HYP,ANXIOLYTC AB-NOS</ICD9>
"TEMP","RORPRTDEF",15,66)
<ICD9 ID="305.41">SED,HYP,ANXIOLYTC AB-CON</ICD9>
"TEMP","RORPRTDEF",15,67)
<ICD9 ID="305.42">SED,HYP,ANXIOLYTC AB-EPI</ICD9>
"TEMP","RORPRTDEF",15,68)
<ICD9 ID="305.43">SED,HYP,ANXIOLYTC AB-REM</ICD9>
"TEMP","RORPRTDEF",15,69)
<ICD9 ID="305.44">PARALDEHYDE ABUSE</ICD9>
"TEMP","RORPRTDEF",15,70)
<ICD9 ID="305.45">PLACIDYL, ETHCHLORUYNOL ABUSE</ICD9>
"TEMP","RORPRTDEF",15,71)
<ICD9 ID="305.46">VALIUM, DIAZEPAM ABUSE</ICD9>
"TEMP","RORPRTDEF",15,72)
<ICD9 ID="305.47">DORIDEN, GLUTETHIMIDE ABUSE</ICD9>
"TEMP","RORPRTDEF",15,73)
<ICD9 ID="305.48">BARBITURATES ABUSE</ICD9>
"TEMP","RORPRTDEF",15,74)
<ICD9 ID="305.49">OTHER SEDATIVE OR HYPNOT, NEC</ICD9>
"TEMP","RORPRTDEF",15,75)
<ICD9 ID="305.50">OPIOID ABUSE UNSPECIFIED</ICD9>
"TEMP","RORPRTDEF",15,76)
<ICD9 ID="305.51">OPIOID ABUSE CONTINUOUS</ICD9>
"TEMP","RORPRTDEF",15,77)
<ICD9 ID="305.52">OPIOID ABUSE EPISODIC</ICD9>
"TEMP","RORPRTDEF",15,78)
<ICD9 ID="305.53">OPIOID ABUSE IN REMISSION</ICD9>
"TEMP","RORPRTDEF",15,79)
<ICD9 ID="305.59">OTHER OPIOID ABUSE, NEC</ICD9>
"TEMP","RORPRTDEF",15,80)
<ICD9 ID="305.6">COCAINE ABUSE-UNSPEC</ICD9>
"TEMP","RORPRTDEF",15,81)
<ICD9 ID="305.60">COCAINE ABUSE UNSPECIFIED</ICD9>
"TEMP","RORPRTDEF",15,82)
<ICD9 ID="305.61">COCAINE ABUSE-CONTINUOUS</ICD9>
"TEMP","RORPRTDEF",15,83)
<ICD9 ID="305.62">COCAINE ABUSE-EPISODIC</ICD9>
"TEMP","RORPRTDEF",15,84)
<ICD9 ID="305.63">COCAINE ABUSE-IN REMISS</ICD9>
"TEMP","RORPRTDEF",15,85)
<ICD9 ID="305.70">AMPHETAMINE ABUSE-UNSPECIFIED</ICD9>
"TEMP","RORPRTDEF",15,86)
<ICD9 ID="305.71">AMPHETAMINE ABUSE-CONTINUOUS</ICD9>
"TEMP","RORPRTDEF",15,87)
<ICD9 ID="305.72">AMPHETAMINE ABUSE-EPISODIC</ICD9>
"TEMP","RORPRTDEF",15,88)
<ICD9 ID="305.73">AMPHETAMINE ABUSE-REMISS</ICD9>
"TEMP","RORPRTDEF",15,89)
<ICD9 ID="305.79">OTHER SYMPATHOMIMETIC, NEC</ICD9>
"TEMP","RORPRTDEF",15,90)
<ICD9 ID="305.80">ANTIDEPRESS ABUSE-UNSPEC</ICD9>
"TEMP","RORPRTDEF",15,91)
<ICD9 ID="305.81">ANTIDEPRESS ABUSE-CONTIN</ICD9>
"TEMP","RORPRTDEF",15,92)
<ICD9 ID="305.82">ANTIDEPRESS ABUSE-EPISOD</ICD9>
"TEMP","RORPRTDEF",15,93)
<ICD9 ID="305.83">ANTIDEPRESS ABUSE-REMISS</ICD9>
"TEMP","RORPRTDEF",15,94)
<ICD9 ID="305.90">OTHER DRUG ABUSE-UNSPEC</ICD9>
"TEMP","RORPRTDEF",15,95)
<ICD9 ID="305.91">OTHER DRUG ABUSE-CONTIN</ICD9>
"TEMP","RORPRTDEF",15,96)
<ICD9 ID="305.92">OTHER DRUG ABUSE-EPISOD</ICD9>
"TEMP","RORPRTDEF",15,97)
<ICD9 ID="305.93">OTHER DRUG ABUSE-REMISS</ICD9>
"TEMP","RORPRTDEF",15,98)
<ICD9 ID="305.99">OTHER, MIXED, UNSPEC, NEC</ICD9>
"TEMP","RORPRTDEF",15,99)
</ICD9LST>
"TEMP","RORPRTDEF",15,100)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",15,101)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",15,102)
</PARAMS>
"TEMP","RORPRTDEF",16)
13::Tobacco Use
"TEMP","RORPRTDEF",16,1)
<?xml version="1.0" encoding="UTF-8"?>
"TEMP","RORPRTDEF",16,2)
<PARAMS>
"TEMP","RORPRTDEF",16,3)
<ICD9LST>
"TEMP","RORPRTDEF",16,4)
<ICD9 ID="305.1">TOBACCO USE DISORDER</ICD9>
"TEMP","RORPRTDEF",16,5)
<ICD9 ID="989.84">TOXIC EFFECT OF TOBACCO</ICD9>
"TEMP","RORPRTDEF",16,6)
<ICD9 ID="V15.82">HX-TOBACCO USE</ICD9>
"TEMP","RORPRTDEF",16,7)
</ICD9LST>
"TEMP","RORPRTDEF",16,8)
<OPTIONS COMPLETE="1"/>
"TEMP","RORPRTDEF",16,9)
<PATIENTS DE_BEFORE="1" DE_DURING="1" DE_AFTER="1"/>
"TEMP","RORPRTDEF",16,10)
</PARAMS>
"VER")
8.0^22.0
"^DD",798,798,0)
FIELD^^20^21
"^DD",798,798,0,"DDA")
N
"^DD",798,798,0,"DT")
3050812
"^DD",798,798,0,"IX","AC",798,.02)

"^DD",798,798,0,"IX","ALF",798.02,.01)

"^DD",798,798,0,"IX","AM",798,10)

"^DD",798,798,0,"IX","B",798,.01)

"^DD",798,798,0,"NM","ROR REGISTRY RECORD")

"^DD",798,798,0,"PT",799.4,.01)

"^DD",798,798,0,"SCR")
I $$ACCESS^RORDD(798,+$P($G(^(0)),U,2))
"^DD",798,798,0,"VRPK")
ROR
"^DD",798,798,.01,0)
PATIENT NAME^RP798.4^RORDATA(798.4,^0;1^Q
"^DD",798,798,.01,1,0)
^.1
"^DD",798,798,.01,1,1,0)
798^B
"^DD",798,798,.01,1,1,1)
S ^RORDATA(798,"B",$E(X,1,30),DA)=""
"^DD",798,798,.01,1,1,2)
K ^RORDATA(798,"B",$E(X,1,30),DA)
"^DD",798,798,.01,1,1,3)
Do not delete!
"^DD",798,798,.01,1,1,"%D",0)
^.101^2^2^3030428^^
"^DD",798,798,.01,1,1,"%D",1,0)
Patient records in all defined registries can be
"^DD",798,798,.01,1,1,"%D",2,0)
found using this cross-reference.
"^DD",798,798,.01,3)

"^DD",798,798,.01,8.5)
@
"^DD",798,798,.01,9)
@
"^DD",798,798,.01,20,0)
^.3LA^1^1
"^DD",798,798,.01,20,1,0)
ENTRY
"^DD",798,798,.01,21,0)
^^7^7^3060203^
"^DD",798,798,.01,21,1,0)
The PATIENT NAME field identifies a patient in the
"^DD",798,798,.01,21,2,0)
registry. You can select a patient either from the
"^DD",798,798,.01,21,3,0)
local registry or the ROR PATIENT file, or you can
"^DD",798,798,.01,21,4,0)
add a new patient from the PATIENT file.
"^DD",798,798,.01,21,5,0)
 
"^DD",798,798,.01,21,6,0)
You can only select records of those registries
"^DD",798,798,.01,21,7,0)
that you have appropriate security key(s) for.
"^DD",798,798,.01,23,0)
^.001^12^12^3060203^^
"^DD",798,798,.01,23,1,0)
An internal value of this field is the patient IEN in
"^DD",798,798,.01,23,2,0)
the PATIENT file (#2) because records in the ROR
"^DD",798,798,.01,23,3,0)
PATIENT file (#798.4) have the same internal entry
"^DD",798,798,.01,23,4,0)
numbers as corresponding records in the PATIENT file.
"^DD",798,798,.01,23,5,0)
Patient records in all registries can be found by
"^DD",798,798,.01,23,6,0)
traditional "B" cross-reference.
"^DD",798,798,.01,23,7,0)
 
"^DD",798,798,.01,23,8,0)
When value of this field is deleted (which means 
"^DD",798,798,.01,23,9,0)
deletion of the whole record), the logic of the ADELETE
"^DD",798,798,.01,23,10,0)
cross-reference tries to delete associated records from
"^DD",798,798,.01,23,11,0)
the ROR HIV STUDY (#799.4), ROR PATIENT (#798.4), and
"^DD",798,798,.01,23,12,0)
ROR PATIENT EVENTS (#798.3) files.
"^DD",798,798,.01,"DT")
3060123
"^DD",798,798,.02,0)
REGISTRY^RP798.1'I^ROR(798.1,^0;2^Q
"^DD",798,798,.02,1,0)
^.1
"^DD",798,798,.02,1,1,0)
798^AC
"^DD",798,798,.02,1,1,1)
S ^RORDATA(798,"AC",$E(X,1,30),DA)=""
"^DD",798,798,.02,1,1,2)
K ^RORDATA(798,"AC",$E(X,1,30),DA)
"^DD",798,798,.02,1,1,3)
Do not delete!
"^DD",798,798,.02,1,1,"%D",0)
^.101^2^2^3050804^^
"^DD",798,798,.02,1,1,"%D",1,0)
This cross-reference is used to link all records
"^DD",798,798,.02,1,1,"%D",2,0)
of the registry together.
"^DD",798,798,.02,1,1,"DT")
3000406
"^DD",798,798,.02,1,2,0)
^^TRIGGER^798^1
"^DD",798,798,.02,1,2,1)
X ^DD(798,.02,1,2,1.3) I X S X=DIV S Y(1)=$S($D(^RORDATA(798,D0,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X=DIV S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) X ^DD(798,.02,1,2,1.4)
"^DD",798,798,.02,1,2,1.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S Y(1)=$S($D(^RORDATA(798,D0,0)):^(0),1:"") S X='$P(Y(1),U,3)
"^DD",798,798,.02,1,2,1.4)
S DIH=$G(^RORDATA(798,DIV(0),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=798,DIG=1 D ^DICR
"^DD",798,798,.02,1,2,2)
Q
"^DD",798,798,.02,1,2,3)
Do not delete!
"^DD",798,798,.02,1,2,"%D",0)
^^2^2^3020402^
"^DD",798,798,.02,1,2,"%D",1,0)
This trigger populates the DATE ENTERED field 
"^DD",798,798,.02,1,2,"%D",2,0)
when the patient is added to the registry.
"^DD",798,798,.02,1,2,"CREATE CONDITION")
'DATE ENTERED
"^DD",798,798,.02,1,2,"CREATE VALUE")
NOW
"^DD",798,798,.02,1,2,"DELETE VALUE")
NO EFFECT
"^DD",798,798,.02,1,2,"DT")
3011119
"^DD",798,798,.02,1,2,"FIELD")
DATE
"^DD",798,798,.02,8.5)
@
"^DD",798,798,.02,9)
@
"^DD",798,798,.02,20,0)
^.3LA^1^1
"^DD",798,798,.02,20,1,0)
ENTRY
"^DD",798,798,.02,21,0)
^.001^2^2^3020816^^
"^DD",798,798,.02,21,1,0)
The REGISTRY field identifies the registry that 
"^DD",798,798,.02,21,2,0)
the record belongs to.
"^DD",798,798,.02,23,0)
^.001^2^2^3020816^^
"^DD",798,798,.02,23,1,0)
Traditional cross-reference "AC" is used to link all 
"^DD",798,798,.02,23,2,0)
records of the registry together.
"^DD",798,798,.02,"DT")
3050804
"^DD",798,798,1,0)
DATE ENTERED^DI^^0;3^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",798,798,1,1,0)
^.1^^0
"^DD",798,798,1,5,1,0)
798^.02^2
"^DD",798,798,1,8.5)
@
"^DD",798,798,1,9)
@
"^DD",798,798,1,20,0)
^.3LA^1^1
"^DD",798,798,1,20,1,0)
ENTRY
"^DD",798,798,1,21,0)
^.001^3^3^3050630^^^^
"^DD",798,798,1,21,1,0)
The DATE ENTERED field is automatically populated
"^DD",798,798,1,21,2,0)
by the trigger associated with the REGISTRY field
"^DD",798,798,1,21,3,0)
when the patient is added to the registry.
"^DD",798,798,1,"DT")
3031027
"^DD",798,798,2,0)
DATE CONFIRMED^D^^0;4^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",798,798,2,8.5)
@
"^DD",798,798,2,9)
@
"^DD",798,798,2,20,0)
^.3LA^1^1
"^DD",798,798,2,20,1,0)
ENTRY
"^DD",798,798,2,21,0)
^.001^4^4^3050630^^
"^DD",798,798,2,21,1,0)
A trigger associated with the STATUS field 
"^DD",798,798,2,21,2,0)
automatically populates the DATE CONFIRMED field
"^DD",798,798,2,21,3,0)
with the current date and time when the patient is
"^DD",798,798,2,21,4,0)
confirmed in the registry.
"^DD",798,798,2,"DT")
3050804
"^DD",798,798,2.1,0)
CONFIRMED BY^P200'^VA(200,^0;10^Q
"^DD",798,798,2.1,8.5)
@
"^DD",798,798,2.1,9)
@
"^DD",798,798,2.1,21,0)
^^4^4^3060203^
"^DD",798,798,2.1,21,1,0)
A trigger associated with the STATUS field 
"^DD",798,798,2.1,21,2,0)
automatically populates this field with a pointer
"^DD",798,798,2.1,21,3,0)
to the record of the user who confirmed the 
"^DD",798,798,2.1,21,4,0)
patient.
"^DD",798,798,2.1,"DT")
3050427
"^DD",798,798,3,0)
STATUS^S^0:Confirmed;4:Pending;5:Deleted;^0;5^Q
"^DD",798,798,3,1,0)
^.1
"^DD",798,798,3,1,1,0)
^^TRIGGER^798^5
"^DD",798,798,3,1,1,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^RORDATA(798,D0,0)):^(0),1:"") S X=$P(Y(1),U,7),X=X S DIU=X K Y S X=DIV S X="1" S DIH=$G(^RORDATA(798,DIV(0),0)),DIV=X S $P(^(0),U,7)=DIV,DIH=798,DIG=5 D ^DICR
"^DD",798,798,3,1,1,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^RORDATA(798,D0,0)):^(0),1:"") S X=$P(Y(1),U,7),X=X S DIU=X K Y S X=DIV S X="1" S DIH=$G(^RORDATA(798,DIV(0),0)),DIV=X S $P(^(0),U,7)=DIV,DIH=798,DIG=5 D ^DICR
"^DD",798,798,3,1,1,3)
Do not delete!
"^DD",798,798,3,1,1,"%D",0)
^^2^2^3051129^
"^DD",798,798,3,1,1,"%D",1,0)
This trigger sets the UPDATE LOCAL REGISTRY DATA 
"^DD",798,798,3,1,1,"%D",2,0)
flag when status of the record is changed.
"^DD",798,798,3,1,1,"CREATE VALUE")
"1"
"^DD",798,798,3,1,1,"DELETE VALUE")
"1"
"^DD",798,798,3,1,1,"DT")
3051129
"^DD",798,798,3,1,1,"FIELD")
UPDATE LOCAL REGISTRY DATA
"^DD",798,798,3,8.5)
@
"^DD",798,798,3,9)
@
"^DD",798,798,3,20,0)
^.3LA^1^1
"^DD",798,798,3,20,1,0)
STATE
"^DD",798,798,3,21,0)
^^2^2^3050426^
"^DD",798,798,3,21,1,0)
The STATUS field indicates current status of the 
"^DD",798,798,3,21,2,0)
registry record.
"^DD",798,798,3,23,0)
^^6^6^3050426^
"^DD",798,798,3,23,1,0)
When a patient is deleted from the registry, the 
"^DD",798,798,3,23,2,0)
internal value of this field is changed to 5. This 
"^DD",798,798,3,23,3,0)
record will be deleted during the next run of the 
"^DD",798,798,3,23,4,0)
nightly task and the corresponding HL7 messages will 
"^DD",798,798,3,23,5,0)
instruct the national database software to delete the 
"^DD",798,798,3,23,6,0)
patient data as well.
"^DD",798,798,3,"DT")
3060123
"^DD",798,798,3.1,0)
SELECTION RULE^798.01P^^1;0
"^DD",798,798,3.1,20,0)
^.3LA^1^1
"^DD",798,798,3.1,20,1,0)
ENTRY
"^DD",798,798,3.1,21,0)
^.001^3^3^3060105^^^
"^DD",798,798,3.1,21,1,0)
The SELECTION RULE multiple contains a list of
"^DD",798,798,3.1,21,2,0)
selection rules that the patient passed when added
"^DD",798,798,3.1,21,3,0)
to the registry.
"^DD",798,798,3.1,23,0)
^^2^2^3060105^
"^DD",798,798,3.1,23,1,0)
The list is automatically populated by the registry
"^DD",798,798,3.1,23,2,0)
update.
"^DD",798,798,3.2,0)
DATE SELECTED^CD^^ ; ^S X=$$DTSEL^RORDD01(D0)
"^DD",798,798,3.2,9)
^
"^DD",798,798,3.2,9.01)

"^DD",798,798,3.2,9.1)
S X=$$DTSEL^RORDD01(D0)
"^DD",798,798,3.2,21,0)
^^5^5^3060203^
"^DD",798,798,3.2,21,1,0)
Value of this field is calculated as the earliest
"^DD",798,798,3.2,21,2,0)
date of selection rules from the SELECTION RULE
"^DD",798,798,3.2,21,3,0)
multiple (3.1). If that multiple is empty, then
"^DD",798,798,3.2,21,4,0)
the date part of the DATE ENTERED field (1) will
"^DD",798,798,3.2,21,5,0)
be used.
"^DD",798,798,3.3,0)
LOCATION SELECTED^Cp4^^ ; ^S X=$$LOCSEL^RORDD01(D0)
"^DD",798,798,3.3,9)
^
"^DD",798,798,3.3,9.01)

"^DD",798,798,3.3,9.1)
S X=$$LOCSEL^RORDD01(D0)
"^DD",798,798,3.3,21,0)
^^3^3^3060105^
"^DD",798,798,3.3,21,1,0)
Computation algorithm of this field returns the
"^DD",798,798,3.3,21,2,0)
LOCATION field (2) value of the earliest selection
"^DD",798,798,3.3,21,3,0)
rules from the SELECTION RULE multiple (3.1).
"^DD",798,798,3.3,"DT")
3050803
"^DD",798,798,4,0)
UPDATE DEMOGRAPHICS^S^0:NO;1:YES;^0;6^Q
"^DD",798,798,4,1,0)
^.1^^0
"^DD",798,798,4,20,0)
^.3LA^1^1
"^DD",798,798,4,20,1,0)
STATE
"^DD",798,798,4,21,0)
^^3^3^3060203^
"^DD",798,798,4,21,1,0)
Usually, you should not edit this field. Set the 
"^DD",798,798,4,21,2,0)
value of this field to "YES" if you want patient
"^DD",798,798,4,21,3,0)
demographic data to be sent to the AAC.
"^DD",798,798,4,23,0)
^^12^12^3060203^
"^DD",798,798,4,23,1,0)
During the registry update, demographic fields of each
"^DD",798,798,4,23,2,0)
record of the ROR PATIENT file (#798.4) are compared
"^DD",798,798,4,23,3,0)
with corresponding fields of the PATIENT file (#2).
"^DD",798,798,4,23,4,0)
 
"^DD",798,798,4,23,5,0)
If any of the fields have different values, the 
"^DD",798,798,4,23,6,0)
internal value of 1 is assigned to the UPDATE
"^DD",798,798,4,23,7,0)
DEMOGRAPHICS field of all active patient records in 
"^DD",798,798,4,23,8,0)
local registries. As a result, demographic data is
"^DD",798,798,4,23,9,0)
transmitted to the national registries.
"^DD",798,798,4,23,10,0)
 
"^DD",798,798,4,23,11,0)
After acknowledgement of the successful processing of
"^DD",798,798,4,23,12,0)
transmitted data, the value of this field is deleted.
"^DD",798,798,4,"DT")
3051129
"^DD",798,798,4.1,0)
DEMOGRAPHICS UPDATED^D^^0;8^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",798,798,4.1,8.5)
@
"^DD",798,798,4.1,9)
@
"^DD",798,798,4.1,20,0)
^.3LA^1^1
"^DD",798,798,4.1,20,1,0)
STATE
"^DD",798,798,4.1,21,0)
^^4^4^3030428^
"^DD",798,798,4.1,21,1,0)
The DEMOGRAPHICS UPDATED field stores the 
"^DD",798,798,4.1,21,2,0)
date/time of the last change in the patient's
"^DD",798,798,4.1,21,3,0)
demographic data that was detected by the Clinical
"^DD",798,798,4.1,21,4,0)
Case Registries software.
"^DD",798,798,4.1,23,0)
^^2^2^3060105^
"^DD",798,798,4.1,23,1,0)
This field is populated by the "ADEM" index/trigger
"^DD",798,798,4.1,23,2,0)
associated with the UPDATE DEMOGRAPHICS field (4).
"^DD",798,798,4.1,"DT")
3030417
"^DD",798,798,5,0)
UPDATE LOCAL REGISTRY DATA^S^0:NO;1:YES;^0;7^Q
"^DD",798,798,5,1,0)
^.1^^0
"^DD",798,798,5,5,1,0)
798^3^1
"^DD",798,798,5,20,0)
^.3LA^1^1
"^DD",798,798,5,20,1,0)
STATE
"^DD",798,798,5,21,0)
^^4^4^3060105^
"^DD",798,798,5,21,1,0)
Usually, you should not edit this field. Set the
"^DD",798,798,5,21,2,0)
value of this field to "YES" if you have changed
"^DD",798,798,5,21,3,0)
any local registry data of the patient and want 
"^DD",798,798,5,21,4,0)
this data to be sent to the AAC.
"^DD",798,798,5,23,0)
^^8^8^3060105^
"^DD",798,798,5,23,1,0)
Any changes of local registry data result in assignment
"^DD",798,798,5,23,2,0)
of 1 as an internal value of the UPDATE LOCAL REGISTRY
"^DD",798,798,5,23,3,0)
DATA field (by registry update process or remote
"^DD",798,798,5,23,4,0)
procedures). This is the indication to transmit local
"^DD",798,798,5,23,5,0)
data to the national registry.
"^DD",798,798,5,23,6,0)
 
"^DD",798,798,5,23,7,0)
After acknowledgement of the successful processing of
"^DD",798,798,5,23,8,0)
transmitted data, the value of this field is deleted.
"^DD",798,798,5,"DT")
3051129
"^DD",798,798,5.1,0)
LOCAL DATA UPDATED^D^^0;9^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",798,798,5.1,8.5)
@
"^DD",798,798,5.1,9)
@
"^DD",798,798,5.1,20,0)
^.3LA^1^1
"^DD",798,798,5.1,20,1,0)
STATE
"^DD",798,798,5.1,21,0)
^^3^3^3030428^
"^DD",798,798,5.1,21,1,0)
The LOCAL DATA UPDATED field stores the date/time
"^DD",798,798,5.1,21,2,0)
of the last change in the patient's local registry
"^DD",798,798,5.1,21,3,0)
data.
"^DD",798,798,5.1,23,0)
^^3^3^3060105^
"^DD",798,798,5.1,23,1,0)
This field is populated by the "ALOC" index/trigger
"^DD",798,798,5.1,23,2,0)
associated with the UPDATE LOCAL REGISTRY DATA field
"^DD",798,798,5.1,23,3,0)
(5).
"^DD",798,798,5.1,"DT")
3030417
"^DD",798,798,6,0)
DATE DELETED^D^^0;11^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",798,798,6,8.5)
@
"^DD",798,798,6,9)
@
"^DD",798,798,6,20,0)
^.3LA^1^1
"^DD",798,798,6,20,1,0)
STATE
"^DD",798,798,6,21,0)
^^4^4^3060105^
"^DD",798,798,6,21,1,0)
Trigger associated with the STATUS field (3)
"^DD",798,798,6,21,2,0)
automatically populates this field with the
"^DD",798,798,6,21,3,0)
current date and time when the patient is deleted
"^DD",798,798,6,21,4,0)
from the registry.
"^DD",798,798,6,"DT")
3050630
"^DD",798,798,6.1,0)
DELETED BY^P200'^VA(200,^0;12^Q
"^DD",798,798,6.1,8.5)
@
"^DD",798,798,6.1,9)
@
"^DD",798,798,6.1,20,0)
^.3LA^1^1
"^DD",798,798,6.1,20,1,0)
STATE
"^DD",798,798,6.1,21,0)
^^4^4^3060203^
"^DD",798,798,6.1,21,1,0)
Trigger associated with the STATUS field (3)
"^DD",798,798,6.1,21,2,0)
automatically populates this field with a pointer
"^DD",798,798,6.1,21,3,0)
to the record of the user who deleted the patient
"^DD",798,798,6.1,21,4,0)
from the registry.
"^DD",798,798,6.1,"DT")
3050630
"^DD",798,798,8,0)
ACTIVE^CJ1,0^^ ; ^S X=$$ACTIVE^RORDD(D0)
"^DD",798,798,8,9)
^
"^DD",798,798,8,9.01)

"^DD",798,798,8,9.1)
S X=$$ACTIVE^RORDD(D0)
"^DD",798,798,8,20,0)
^.3LA^1^1
"^DD",798,798,8,20,1,0)
STATE
"^DD",798,798,8,21,0)
^.001^3^3^3050630^^^
"^DD",798,798,8,21,1,0)
This is a computed field that indicates if the 
"^DD",798,798,8,21,2,0)
patient's record in the registry is active and 
"^DD",798,798,8,21,3,0)
should be considered by the software.
"^DD",798,798,8,23,0)
^^4^4^3060203^
"^DD",798,798,8,23,1,0)
Pending records and records marked for deletion are 
"^DD",798,798,8,23,2,0)
considered inactive and are ignored (except in some 
"^DD",798,798,8,23,3,0)
special cases like confirming a pending patient, list 
"^DD",798,798,8,23,4,0)
of pending patients, etc.).
"^DD",798,798,8,"DT")
3050426
"^DD",798,798,9.1,0)
DATA ACKNOWLEDGED UNTIL^D^^2;1^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",798,798,9.1,20,0)
^.3LA^1^1
"^DD",798,798,9.1,20,1,0)
STATE
"^DD",798,798,9.1,21,0)
^^3^3^3060203^
"^DD",798,798,9.1,21,1,0)
The DATA ACKNOWLEDGED UNTIL field contains a date
"^DD",798,798,9.1,21,2,0)
that the patient data has been extracted up to and
"^DD",798,798,9.1,21,3,0)
successfully transmitted.
"^DD",798,798,9.1,23,0)
^.001^10^10^3060203^^
"^DD",798,798,9.1,23,1,0)
A regular data extraction for the patient in the 
"^DD",798,798,9.1,23,2,0)
registry starts from this date.
"^DD",798,798,9.1,23,3,0)
 
"^DD",798,798,9.1,23,4,0)
This field is empty for the patients added by the 
"^DD",798,798,9.1,23,5,0)
nightly task.
"^DD",798,798,9.1,23,6,0)
 
"^DD",798,798,9.1,23,7,0)
The nightly task checks status of the last HL7 batches 
"^DD",798,798,9.1,23,8,0)
and copies the value of the DATA EXTRACTED UNTIL field
"^DD",798,798,9.1,23,9,0)
into this field for the patients whose data was
"^DD",798,798,9.1,23,10,0)
included in the successfully transmitted batches.
"^DD",798,798,9.1,"DT")
3010830
"^DD",798,798,9.2,0)
DATA EXTRACTED UNTIL^D^^2;2^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",798,798,9.2,20,0)
^.3LA^1^1
"^DD",798,798,9.2,20,1,0)
STATE
"^DD",798,798,9.2,21,0)
^^3^3^3060203^
"^DD",798,798,9.2,21,1,0)
This field contains a date that registry data of 
"^DD",798,798,9.2,21,2,0)
the patient has been extracted up to. Actual
"^DD",798,798,9.2,21,3,0)
transmission of this data is not confirmed.
"^DD",798,798,9.2,23,0)
^^7^7^3060203^
"^DD",798,798,9.2,23,1,0)
The field is automatically populated by the regular
"^DD",798,798,9.2,23,2,0)
data extraction process if the data is extracted
"^DD",798,798,9.2,23,3,0)
successfully.
"^DD",798,798,9.2,23,4,0)
 
"^DD",798,798,9.2,23,5,0)
The nightly task copies the value of this field into
"^DD",798,798,9.2,23,6,0)
the DATA ACKNOWLEDGED UNTIL field upon verification of
"^DD",798,798,9.2,23,7,0)
the transmission status of the corresponding HL7 batch.
"^DD",798,798,9.2,"DT")
3010830
"^DD",798,798,10,0)
MESSAGE ID^FX^^2;3^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>20!(X'?1.E1"-"1.N) X
"^DD",798,798,10,1,0)
^.1
"^DD",798,798,10,1,1,0)
798^AM
"^DD",798,798,10,1,1,1)
S ^RORDATA(798,"AM",$E(X,1,30),DA)=""
"^DD",798,798,10,1,1,2)
K ^RORDATA(798,"AM",$E(X,1,30),DA)
"^DD",798,798,10,1,1,3)
Do not delete!
"^DD",798,798,10,1,1,"%D",0)
^^5^5^3060203^
"^DD",798,798,10,1,1,"%D",1,0)
The cross-reference allows the software to find
"^DD",798,798,10,1,1,"%D",2,0)
either a registry record (using the ID of the HL7
"^DD",798,798,10,1,1,"%D",3,0)
message sent to the national registry) or all
"^DD",798,798,10,1,1,"%D",4,0)
registry records included in the particular batch
"^DD",798,798,10,1,1,"%D",5,0)
(using partial match).
"^DD",798,798,10,1,1,"DT")
3010824
"^DD",798,798,10,3)
The unique ID of the latest HL7 message (1-20 characters).
"^DD",798,798,10,8.5)
@
"^DD",798,798,10,9)
@
"^DD",798,798,10,20,0)
^.3LA^1^1
"^DD",798,798,10,20,1,0)
HL7
"^DD",798,798,10,21,0)
^^10^10^3050503^
"^DD",798,798,10,21,1,0)
The MESSAGE ID field contains the identifier of 
"^DD",798,798,10,21,2,0)
latest individual HL7 message created for this
"^DD",798,798,10,21,3,0)
registry record.
"^DD",798,798,10,21,4,0)
 
"^DD",798,798,10,21,5,0)
Value of this field should have the following
"^DD",798,798,10,21,6,0)
format: BatchID-N, where BatchID is the identifier
"^DD",798,798,10,21,7,0)
of the HL7 batch message (see the INTERNAL BATCH
"^DD",798,798,10,21,8,0)
ID field of the LAST BATCH CONTROL ID multiple of
"^DD",798,798,10,21,9,0)
the ROR REGISTRY PARAMETERS file), and N is the
"^DD",798,798,10,21,10,0)
sequential number of the message in the batch.
"^DD",798,798,10,23,0)
^^9^9^3060105^
"^DD",798,798,10,23,1,0)
This field is automatically populated by the regular
"^DD",798,798,10,23,2,0)
data extraction process when the individual message is 
"^DD",798,798,10,23,3,0)
generated.
"^DD",798,798,10,23,4,0)
 
"^DD",798,798,10,23,5,0)
If the sequential number of the message in the batch is
"^DD",798,798,10,23,6,0)
zero, then the data for this patient was not included
"^DD",798,798,10,23,7,0)
in this batch. This "fake" message ID is assigned in 
"^DD",798,798,10,23,8,0)
order to correctly update the DATA EXTRACTED UNTIL and
"^DD",798,798,10,23,9,0)
DATA ACKNOWLEDGED UNTIL fields.
"^DD",798,798,10,"DT")
3011005
"^DD",798,798,11,0)
DON'T SEND^S^0:NO;1:YES;^2;4^Q
"^DD",798,798,11,20,0)
^.3LA^1^1
"^DD",798,798,11,20,1,0)
ENTRY
"^DD",798,798,11,21,0)
^^3^3^3060105^
"^DD",798,798,11,21,1,0)
Set this field to "YES" if you do not want any 
"^DD",798,798,11,21,2,0)
data to be sent to the national registry for this
"^DD",798,798,11,21,3,0)
record.
"^DD",798,798,11,23,0)
^^6^6^3060105^
"^DD",798,798,11,23,1,0)
Usually, this field is populated only automatically by
"^DD",798,798,11,23,2,0)
the registry update processing if a patient is defined
"^DD",798,798,11,23,3,0)
in the PATIENT file as a "test patient" (internal value
"^DD",798,798,11,23,4,0)
of the TEST PATIENT INDICATOR field equals to 1).
"^DD",798,798,11,23,5,0)
 
"^DD",798,798,11,23,6,0)
Pending registry records also have 1 in this field.
"^DD",798,798,11,"DT")
3010919
"^DD",798,798,20,0)
LOCAL FIELD^798.02P^^20;0
"^DD",798,798,20,20,0)
^.3LA^1^1
"^DD",798,798,20,20,1,0)
ENTRY
"^DD",798,798,20,21,0)
^^3^3^3050525^
"^DD",798,798,20,21,1,0)
The LOCAL FIELD multiple contains a list of local 
"^DD",798,798,20,21,2,0)
field values for the registry patient along with
"^DD",798,798,20,21,3,0)
the corresponding dates and comments.
"^DD",798,798.01,0)
SELECTION RULE SUB-FIELD^^2^3
"^DD",798,798.01,0,"DT")
3050802
"^DD",798,798.01,0,"IX","AD",798.01,1)

"^DD",798,798.01,0,"IX","B",798.01,.01)

"^DD",798,798.01,0,"NM","SELECTION RULE")

"^DD",798,798.01,0,"UP")
798
"^DD",798,798.01,.01,0)
SELECTION RULE^MP798.2'^ROR(798.2,^0;1^Q
"^DD",798,798.01,.01,1,0)
^.1
"^DD",798,798.01,.01,1,1,0)
798.01^B
"^DD",798,798.01,.01,1,1,1)
S ^RORDATA(798,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",798,798.01,.01,1,1,2)
K ^RORDATA(798,DA(1),1,"B",$E(X,1,30),DA)
"^DD",798,798.01,.01,1,1,3)
Do not delete!
"^DD",798,798.01,.01,8.5)
@
"^DD",798,798.01,.01,9)
@
"^DD",798,798.01,.01,21,0)
^^2^2^3060203^
"^DD",798,798.01,.01,21,1,0)
This field identifies the selection rule that 
"^DD",798,798.01,.01,21,2,0)
caused addition of the patient to the registry.
"^DD",798,798.01,.01,"DT")
3011009
"^DD",798,798.01,1,0)
DATE^D^^0;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",798,798.01,1,1,0)
^.1
"^DD",798,798.01,1,1,1,0)
798.01^AD
"^DD",798,798.01,1,1,1,1)
S ^RORDATA(798,DA(1),1,"AD",$E(X,1,30),DA)=""
"^DD",798,798.01,1,1,1,2)
K ^RORDATA(798,DA(1),1,"AD",$E(X,1,30),DA)
"^DD",798,798.01,1,1,1,3)
Do not delete!
"^DD",798,798.01,1,1,1,"DT")
3000426
"^DD",798,798.01,1,8.5)
@
"^DD",798,798.01,1,9)
@
"^DD",798,798.01,1,21,0)
^.001^2^2^3050802^^
"^DD",798,798.01,1,21,1,0)
The DATE field contains the date when the patient
"^DD",798,798.01,1,21,2,0)
passed the rule for the first time.
"^DD",798,798.01,1,"DT")
3000426
"^DD",798,798.01,2,0)
LOCATION^P4'^DIC(4,^0;3^Q
"^DD",798,798.01,2,8.5)
@
"^DD",798,798.01,2,9)
@
"^DD",798,798.01,2,21,0)
^^1^1^3050802^
"^DD",798,798.01,2,21,1,0)
Location where the selection rule was triggered.
"^DD",798,798.01,2,"DT")
3050802
"^DD",798,798.02,0)
LOCAL FIELD SUB-FIELD^^1^3
"^DD",798,798.02,0,"DT")
3050812
"^DD",798,798.02,0,"NM","LOCAL FIELD")

"^DD",798,798.02,0,"UP")
798
"^DD",798,798.02,.01,0)
LOCAL FIELD^M*P799.53'X^ROR(799.53,^0;1^S Y=$P($G(^RORDATA(798,DA,0)),U,2),DIC("S")=$S(Y>0:"I $P($G(^(0)),U,3)="_Y,1:"Q") D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",798,798.02,.01,1,0)
^.1
"^DD",798,798.02,.01,1,1,0)
798^ALF
"^DD",798,798.02,.01,1,1,1)
S ^RORDATA(798,"ALF",$E(X,1,30),DA(1),DA)=""
"^DD",798,798.02,.01,1,1,2)
K ^RORDATA(798,"ALF",$E(X,1,30),DA(1),DA)
"^DD",798,798.02,.01,1,1,3)
Do not delete!
"^DD",798,798.02,.01,1,1,"DT")
3050811
"^DD",798,798.02,.01,12)
Only registry-specific records can be selected.
"^DD",798,798.02,.01,12.1)
S DIC("S")="I $P(^(0),U,3)="_$P($G(^RORDATA(798,DA,0)),U,2)
"^DD",798,798.02,.01,21,0)
^^3^3^3060203^
"^DD",798,798.02,.01,21,1,0)
This field stores a pointer to the local field
"^DD",798,798.02,.01,21,2,0)
definition. You can only select from the local
"^DD",798,798.02,.01,21,3,0)
fields associated with the registry.
"^DD",798,798.02,.01,"DT")
3050818
"^DD",798,798.02,.02,0)
DATE^D^^0;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",798,798.02,.02,21,0)
^^2^2^3050513^
"^DD",798,798.02,.02,21,1,0)
This field stores the date associated with the
"^DD",798,798.02,.02,21,2,0)
registry-specific local field value.
"^DD",798,798.02,.02,"DT")
3050513
"^DD",798,798.02,1,0)
COMMENT^F^^1;E1,250^K:$L(X)>200!($L(X)<1) X
"^DD",798,798.02,1,3)
Answer must be 1-200 characters in length.
"^DD",798,798.02,1,21,0)
^.001^2^2^3050812^^
"^DD",798,798.02,1,21,1,0)
This field stores the comment associated with the 
"^DD",798,798.02,1,21,2,0)
registry-specific local field value.
"^DD",798,798.02,1,"DT")
3050812
"^DD",798.1,798.1,0)
FIELD^^30^35
"^DD",798.1,798.1,0,"DDA")
N
"^DD",798.1,798.1,0,"DT")
3051129
"^DD",798.1,798.1,0,"ID","WRITE")
D EN^DDIOL("  "_$P($G(^(0)),U,4),,"?30")
"^DD",798.1,798.1,0,"IX","ACL",798.118,.01)

"^DD",798.1,798.1,0,"IX","AEP",798.1,25)

"^DD",798.1,798.1,0,"IX","ARULES",798.13,.01)

"^DD",798.1,798.1,0,"NM","ROR REGISTRY PARAMETERS")

"^DD",798.1,798.1,0,"PT",798,.02)

"^DD",798.1,798.1,0,"PT",798.31,.01)

"^DD",798.1,798.1,0,"PT",798.6,.02)

"^DD",798.1,798.1,0,"PT",798.73,.01)

"^DD",798.1,798.1,0,"PT",798.8,.03)

"^DD",798.1,798.1,0,"PT",799.1,.03)

"^DD",798.1,798.1,0,"PT",799.51,.02)

"^DD",798.1,798.1,0,"PT",799.53,.03)

"^DD",798.1,798.1,0,"PT",14100042,.02)

"^DD",798.1,798.1,0,"SCR")
I $$ACCESS^RORDD(798.1,Y)
"^DD",798.1,798.1,0,"VRPK")
ROR
"^DD",798.1,798.1,.01,0)
REGISTRY NAME^RFX^^0;1^Q:$$VAEDT^RORDD(798.1,$G(DA))  K:$L(X)>30!($L(X)<3)!'(X?1.UNP) X
"^DD",798.1,798.1,.01,1,0)
^.1^^0
"^DD",798.1,798.1,.01,3)
Enter the unique registry name (3-30 characters).
"^DD",798.1,798.1,.01,8.5)
@
"^DD",798.1,798.1,.01,9)
@
"^DD",798.1,798.1,.01,20,0)
^.3LA^1^1
"^DD",798.1,798.1,.01,20,1,0)
DEFINITION
"^DD",798.1,798.1,.01,21,0)
^.001^9^9^3060203^^
"^DD",798.1,798.1,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,.01,21,3,0)
 
"^DD",798.1,798.1,.01,21,4,0)
You can either select an existing registry or add 
"^DD",798.1,798.1,.01,21,5,0)
a new one. Registry names must be unique. Names of
"^DD",798.1,798.1,.01,21,6,0)
the National registries must start with "VA".
"^DD",798.1,798.1,.01,21,7,0)
 
"^DD",798.1,798.1,.01,21,8,0)
You can only select records of those registries
"^DD",798.1,798.1,.01,21,9,0)
that you have appropriate security key(s) for.
"^DD",798.1,798.1,.01,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,.01,"DT")
3060203
"^DD",798.1,798.1,.09,0)
NATIONAL^SX^0:NO;1:YES;^0;11^Q:$$VAEDT^RORDD(798.1,,-1)
"^DD",798.1,798.1,.09,8.5)
@
"^DD",798.1,798.1,.09,9)
@
"^DD",798.1,798.1,.09,20,0)
^.3LA^1^1
"^DD",798.1,798.1,.09,20,1,0)
DEFINITION
"^DD",798.1,798.1,.09,21,0)
^^6^6^3060203^
"^DD",798.1,798.1,.09,21,1,0)
ONLY AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN
"^DD",798.1,798.1,.09,21,2,0)
EDIT THIS FIELD!
"^DD",798.1,798.1,.09,21,3,0)
 
"^DD",798.1,798.1,.09,21,4,0)
The national registries must have this field set
"^DD",798.1,798.1,.09,21,5,0)
to "YES". This prevents local editing of other 
"^DD",798.1,798.1,.09,21,6,0)
fields of national registry definitions.
"^DD",798.1,798.1,.09,"DEL",1,0)
I $$VADEL^RORDD(798.1,,-1)
"^DD",798.1,798.1,.09,"DT")
3011120
"^DD",798.1,798.1,1,0)
REGISTRY UPDATED UNTIL^D^^0;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",798.1,798.1,1,20,0)
^.3LA^1^1
"^DD",798.1,798.1,1,20,1,0)
STATE
"^DD",798.1,798.1,1,21,0)
^^9^9^3060203^
"^DD",798.1,798.1,1,21,1,0)
This field indicates the date of the last 
"^DD",798.1,798.1,1,21,2,0)
successful run of the regular registry update
"^DD",798.1,798.1,1,21,3,0)
process. The search engine looks for new patients
"^DD",798.1,798.1,1,21,4,0)
starting from this date.
"^DD",798.1,798.1,1,21,5,0)
 
"^DD",798.1,798.1,1,21,6,0)
Usually, this field should not be manually edited;
"^DD",798.1,798.1,1,21,7,0)
it is updated automatically. Before initial
"^DD",798.1,798.1,1,21,8,0)
population of the registry, enter the date that the
"^DD",798.1,798.1,1,21,9,0)
data search should start from.
"^DD",798.1,798.1,1,23,0)
^.001^3^3^3060203^^^
"^DD",798.1,798.1,1,23,1,0)
This field is updated automatically by the registry 
"^DD",798.1,798.1,1,23,2,0)
update process after successful completion (see the 
"^DD",798.1,798.1,1,23,3,0)
$$TMSTMP^RORUPD01 function for details).
"^DD",798.1,798.1,1,"DT")
3010928
"^DD",798.1,798.1,2,0)
DATA EXTRACTED UNTIL^D^^0;3^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",798.1,798.1,2,20,0)
^.3LA^1^1
"^DD",798.1,798.1,2,20,1,0)
STATE
"^DD",798.1,798.1,2,21,0)
^.001^3^3^3020816^^
"^DD",798.1,798.1,2,21,1,0)
This field indicates the date of the last 
"^DD",798.1,798.1,2,21,2,0)
successful run of the regular data extraction
"^DD",798.1,798.1,2,21,3,0)
process. Do not edit this field.
"^DD",798.1,798.1,2,23,0)
^.001^3^3^3020816^^
"^DD",798.1,798.1,2,23,1,0)
This field is updated automatically by the regular data
"^DD",798.1,798.1,2,23,2,0)
extraction process after its successful completion (see
"^DD",798.1,798.1,2,23,3,0)
the $$TMSTMP^ROREXTUT function for details).
"^DD",798.1,798.1,2,"DT")
3010928
"^DD",798.1,798.1,3,0)
SELECTION RULE^798.13^^1;0
"^DD",798.1,798.1,3,9)
@
"^DD",798.1,798.1,3,20,0)
^.3LA^1^1
"^DD",798.1,798.1,3,20,1,0)
DEFINITION
"^DD",798.1,798.1,3,21,0)
^.001^8^8^3051031^^^^
"^DD",798.1,798.1,3,21,1,0)
The SELECTION RULE field contains a list of the 
"^DD",798.1,798.1,3,21,2,0)
top-level selection rules that are used to screen
"^DD",798.1,798.1,3,21,3,0)
the patients to be added to the registry.
"^DD",798.1,798.1,3,21,4,0)
 
"^DD",798.1,798.1,3,21,5,0)
The records of the multiple are uniquely 
"^DD",798.1,798.1,3,21,6,0)
identified by the selection rule names. The "A"
"^DD",798.1,798.1,3,21,7,0)
primary key and the uniqueness index "B" are used
"^DD",798.1,798.1,3,21,8,0)
for this purpose.
"^DD",798.1,798.1,4,0)
SHORT DESCRIPTION^RFX^^0;4^Q:$$VAEDT^RORDD(798.1,$G(DA))  K:$L(X)>40!($L(X)<3) X
"^DD",798.1,798.1,4,3)
Enter a short description of the registry (3-40 characters).
"^DD",798.1,798.1,4,8.5)
@
"^DD",798.1,798.1,4,9)
@
"^DD",798.1,798.1,4,21,0)
^.001^2^2^3020403^^
"^DD",798.1,798.1,4,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,4,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,4,"DT")
3011109
"^DD",798.1,798.1,5,0)
DESCRIPTION^798.15^^2;0
"^DD",798.1,798.1,5,21,0)
^.001^2^2^3011009^^^
"^DD",798.1,798.1,5,21,1,0)
Any additional reference information related to
"^DD",798.1,798.1,5,21,2,0)
the registry may be stored in this field.
"^DD",798.1,798.1,5,23,0)
^.001^1^1^3011009^^
"^DD",798.1,798.1,5,23,1,0)
Content of this field is not used by the application.
"^DD",798.1,798.1,6.1,0)
BEFORE UPDATE^FX^^4;E1,245^Q:$$VAEDT^RORDD(798.1,$G(DA))  Q:$$EP^RORDD(3)
"^DD",798.1,798.1,6.1,3)
Answer must be $$TAG^ROUTINE (5-19 characters in length).
"^DD",798.1,798.1,6.1,8.5)
@
"^DD",798.1,798.1,6.1,9)
@
"^DD",798.1,798.1,6.1,20,0)
^.3LA^1^1
"^DD",798.1,798.1,6.1,20,1,0)
DEFINITION
"^DD",798.1,798.1,6.1,21,0)
^.001^7^7^3050427^^^^
"^DD",798.1,798.1,6.1,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,6.1,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,6.1,21,3,0)
 
"^DD",798.1,798.1,6.1,21,4,0)
Enter a full name ($$TAG^ROUTINE) of the external
"^DD",798.1,798.1,6.1,21,5,0)
MUMPS function that will be called before adding a
"^DD",798.1,798.1,6.1,21,6,0)
new record to the registry. This entry point can
"^DD",798.1,798.1,6.1,21,7,0)
be used to prepare any additional data.
"^DD",798.1,798.1,6.1,23,0)
^^20^20^3050427^
"^DD",798.1,798.1,6.1,23,1,0)
The call-back entry point must accept three parameters:
"^DD",798.1,798.1,6.1,23,2,0)
 
"^DD",798.1,798.1,6.1,23,3,0)
FDA - A reference to a local array that contains 
"^DD",798.1,798.1,6.1,23,4,0)
prepared data (for the UPDATE^DIE FileMan DSB call)
"^DD",798.1,798.1,6.1,23,5,0)
that should be stored as a new record in the ROR
"^DD",798.1,798.1,6.1,23,6,0)
REGISTRY RECORD (#798) file.
"^DD",798.1,798.1,6.1,23,7,0)
 
"^DD",798.1,798.1,6.1,23,8,0)
The main record uses "+1," placeholder and records of
"^DD",798.1,798.1,6.1,23,9,0)
the SELECTION RULE multiple use placeholders with
"^DD",798.1,798.1,6.1,23,10,0)
numbers starting from 1001.
"^DD",798.1,798.1,6.1,23,11,0)
 
"^DD",798.1,798.1,6.1,23,12,0)
See the source code of the $$ADD^RORUPD50 function and
"^DD",798.1,798.1,6.1,23,13,0)
the FileMan Programmer Manual for further details.
"^DD",798.1,798.1,6.1,23,14,0)
 
"^DD",798.1,798.1,6.1,23,15,0)
PATIEN - Patient IEN (in the file #2)
"^DD",798.1,798.1,6.1,23,16,0)
 
"^DD",798.1,798.1,6.1,23,17,0)
REGIEN - Registry IEN (in the file #798.1)
"^DD",798.1,798.1,6.1,23,18,0)
 
"^DD",798.1,798.1,6.1,23,19,0)
The function should return a negative number in case of
"^DD",798.1,798.1,6.1,23,20,0)
errors. Otherwise, zero should be returned.
"^DD",798.1,798.1,6.1,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,6.1,"DT")
3011120
"^DD",798.1,798.1,6.2,0)
AFTER UPDATE^FX^^5;E1,245^Q:$$VAEDT^RORDD(798.1,$G(DA))  Q:$$EP^RORDD(3)
"^DD",798.1,798.1,6.2,3)
Answer must be $$TAG^ROUTINE (5-19 characters in length).
"^DD",798.1,798.1,6.2,8.5)
@
"^DD",798.1,798.1,6.2,9)
@
"^DD",798.1,798.1,6.2,20,0)
^.3LA^1^1
"^DD",798.1,798.1,6.2,20,1,0)
DEFINITION
"^DD",798.1,798.1,6.2,21,0)
^.001^8^8^3020816^^
"^DD",798.1,798.1,6.2,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,6.2,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,6.2,21,3,0)
 
"^DD",798.1,798.1,6.2,21,4,0)
Enter a full name ($$TAG^ROUTINE) of the external
"^DD",798.1,798.1,6.2,21,5,0)
MUMPS function that will be called after adding a
"^DD",798.1,798.1,6.2,21,6,0)
new record to the registry. This entry point can
"^DD",798.1,798.1,6.2,21,7,0)
be used to create record(s) in additional linked
"^DD",798.1,798.1,6.2,21,8,0)
file(s) of the local registry.
"^DD",798.1,798.1,6.2,23,0)
^^11^11^3050427^
"^DD",798.1,798.1,6.2,23,1,0)
The call-back function must accept three parameters:
"^DD",798.1,798.1,6.2,23,2,0)
 
"^DD",798.1,798.1,6.2,23,3,0)
IEN - An IEN of the newly added record of the ROR
"^DD",798.1,798.1,6.2,23,4,0)
REGISTRY RECORD file
"^DD",798.1,798.1,6.2,23,5,0)
 
"^DD",798.1,798.1,6.2,23,6,0)
PATIEN - Patient IEN (in file #2)
"^DD",798.1,798.1,6.2,23,7,0)
 
"^DD",798.1,798.1,6.2,23,8,0)
REGIEN - Registry IEN (in file #798.1)
"^DD",798.1,798.1,6.2,23,9,0)
 
"^DD",798.1,798.1,6.2,23,10,0)
The function should return a negative number in case of
"^DD",798.1,798.1,6.2,23,11,0)
errors. Otherwise, zero should be returned.
"^DD",798.1,798.1,6.2,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,6.2,"DT")
3011120
"^DD",798.1,798.1,7,0)
EXTRACT PERIOD FOR NEW PATIENT^NJ5,0X^^0;5^Q:$$VAEDT^RORDD(798.1,$G(DA))  K:+X'=X!(X>15000)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.1,798.1,7,3)
Enter number of days between 1 and 15000.
"^DD",798.1,798.1,7,8.5)
@
"^DD",798.1,798.1,7,9)
@
"^DD",798.1,798.1,7,20,0)
^.3LA^1^1
"^DD",798.1,798.1,7,20,1,0)
DEFINITION
"^DD",798.1,798.1,7,21,0)
^.001^11^11^3030717^^^
"^DD",798.1,798.1,7,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,7,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,7,21,3,0)
 
"^DD",798.1,798.1,7,21,4,0)
Enter the number of days that should be subtracted
"^DD",798.1,798.1,7,21,5,0)
from the earliest date when the patient passed one
"^DD",798.1,798.1,7,21,6,0)
of the selection rules. The result will be used as
"^DD",798.1,798.1,7,21,7,0)
the start date of the data extraction for this new
"^DD",798.1,798.1,7,21,8,0)
patient.
"^DD",798.1,798.1,7,21,9,0)
 
"^DD",798.1,798.1,7,21,10,0)
If this field is empty, the default value of 3650
"^DD",798.1,798.1,7,21,11,0)
is used.
"^DD",798.1,798.1,7,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,7,"DT")
3011109
"^DD",798.1,798.1,7,"V",0)
^.12P
"^DD",798.1,798.1,8,0)
ENABLE LOG^S^0:NO;1:YES;^0;6^Q
"^DD",798.1,798.1,8,20,0)
^.3LA^1^1
"^DD",798.1,798.1,8,20,1,0)
PARAMETERS
"^DD",798.1,798.1,8,21,0)
^^3^3^3060203^
"^DD",798.1,798.1,8,21,1,0)
Select "YES" to enable recording of different 
"^DD",798.1,798.1,8,21,2,0)
kinds of events (debug messages, errors, etc.)
"^DD",798.1,798.1,8,21,3,0)
generated by registry processes.
"^DD",798.1,798.1,8,23,0)
^.001^10^10^3060203^^
"^DD",798.1,798.1,8,23,1,0)
The ENABLE LOG field controls recording of the errors
"^DD",798.1,798.1,8,23,2,0)
and other events in the log file.
"^DD",798.1,798.1,8,23,3,0)
 
"^DD",798.1,798.1,8,23,4,0)
If internal value of the field is 0 or the field is 
"^DD",798.1,798.1,8,23,5,0)
empty, the recording of all events associated with the
"^DD",798.1,798.1,8,23,6,0)
registry is disabled.
"^DD",798.1,798.1,8,23,7,0)
 
"^DD",798.1,798.1,8,23,8,0)
If internal value of the field is 1, content of the
"^DD",798.1,798.1,8,23,9,0)
LOG EVENT multiple is analyzed to determine which
"^DD",798.1,798.1,8,23,10,0)
events (errors, warnings, etc.) should be recorded.
"^DD",798.1,798.1,8,"DT")
3000503
"^DD",798.1,798.1,8.1,0)
LOG EVENT^798.11S^^3;0
"^DD",798.1,798.1,8.1,20,0)
^.3LA^^0
"^DD",798.1,798.1,8.1,21,0)
^.001^8^8^3060203^^
"^DD",798.1,798.1,8.1,21,1,0)
The LOG EVENT multiple contain a list of event 
"^DD",798.1,798.1,8.1,21,2,0)
types that are enabled to record. 
"^DD",798.1,798.1,8.1,21,3,0)
 
"^DD",798.1,798.1,8.1,21,4,0)
If the list is empty and recording is enabled, 
"^DD",798.1,798.1,8.1,21,5,0)
all events except debug messages will be recorded.
"^DD",798.1,798.1,8.1,21,6,0)
 
"^DD",798.1,798.1,8.1,21,7,0)
Otherwise, only recording of the events from the
"^DD",798.1,798.1,8.1,21,8,0)
list and error messages will be enabled.
"^DD",798.1,798.1,8.1,"DT")
3050722
"^DD",798.1,798.1,10,0)
MESSAGE BUILDER^FX^^7;E1,245^Q:$$VAEDT^RORDD(798.1,$G(DA))  Q:$$EP^RORDD(4)
"^DD",798.1,798.1,10,3)
Answer must be $$TAG^ROUTINE (5-19 characters in length).
"^DD",798.1,798.1,10,8.5)
@
"^DD",798.1,798.1,10,9)
@
"^DD",798.1,798.1,10,20,0)
^.3LA^1^1
"^DD",798.1,798.1,10,20,1,0)
DEFINITION
"^DD",798.1,798.1,10,21,0)
^^10^10^3060106^
"^DD",798.1,798.1,10,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,10,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,10,21,3,0)
 
"^DD",798.1,798.1,10,21,4,0)
Enter a full name ($$TAG^ROUTINE) of the external 
"^DD",798.1,798.1,10,21,5,0)
MUMPS function that will be called to generate the
"^DD",798.1,798.1,10,21,6,0)
registry-specific section of the HL7 message for
"^DD",798.1,798.1,10,21,7,0)
each record of the registry.
"^DD",798.1,798.1,10,21,8,0)
 
"^DD",798.1,798.1,10,21,9,0)
If this field has no value, the default entry 
"^DD",798.1,798.1,10,21,10,0)
point ($$REGDATA^ROREXT02) will be used.
"^DD",798.1,798.1,10,23,0)
^^28^28^3060106^
"^DD",798.1,798.1,10,23,1,0)
The call-back function must accept four parameters:
"^DD",798.1,798.1,10,23,2,0)
 
"^DD",798.1,798.1,10,23,3,0)
IEN - IEN of the registry record
"^DD",798.1,798.1,10,23,4,0)
 
"^DD",798.1,798.1,10,23,5,0)
PATIEN - Patient IEN (in the file #2)
"^DD",798.1,798.1,10,23,6,0)
 
"^DD",798.1,798.1,10,23,7,0)
[.]DXDTS - Either a single time frame in 
"^DD",798.1,798.1,10,23,8,0)
StartDate^EndDate format or a reference to a local 
"^DD",798.1,798.1,10,23,9,0)
variable containing the list of data extraction time 
"^DD",798.1,798.1,10,23,10,0)
frames. The main time frame should be stored in the
"^DD",798.1,798.1,10,23,11,0)
root node (see the $$DXPERIOD^ROREXTUT function for 
"^DD",798.1,798.1,10,23,12,0)
details):
"^DD",798.1,798.1,10,23,13,0)
 
"^DD",798.1,798.1,10,23,14,0)
  DXDTS(         StartDate^EndDate  (FileMan)
"^DD",798.1,798.1,10,23,15,0)
    DataArea,
"^DD",798.1,798.1,10,23,16,0)
      i)         StartDate^EndDate  (FileMan)
"^DD",798.1,798.1,10,23,17,0)
 
"^DD",798.1,798.1,10,23,18,0)
The function should add the text of the HL7 message 
"^DD",798.1,798.1,10,23,19,0)
after already existing nodes in the standard location:
"^DD",798.1,798.1,10,23,20,0)
^TMP("HLS",$J). DO NOT KILL THIS NODE! It contains the
"^DD",798.1,798.1,10,23,21,0)
previous messages of the batch.
"^DD",798.1,798.1,10,23,22,0)
 
"^DD",798.1,798.1,10,23,23,0)
If the message was generated successfully, the function
"^DD",798.1,798.1,10,23,24,0)
should return zero. A negative value corresponds to the
"^DD",798.1,798.1,10,23,25,0)
error code.
"^DD",798.1,798.1,10,23,26,0)
                                                                    
"^DD",798.1,798.1,10,23,27,0)
See the source code of the $$REGDATA^ROREXT02 function 
"^DD",798.1,798.1,10,23,28,0)
for further details.
"^DD",798.1,798.1,10,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,10,"DT")
3011120
"^DD",798.1,798.1,11,0)
REGISTRY STATUS^S^0:ACTIVE;1:INACTIVE;^0;7^Q
"^DD",798.1,798.1,11,1,0)
^.1^^0
"^DD",798.1,798.1,11,20,0)
^.3LA^1^1
"^DD",798.1,798.1,11,20,1,0)
PARAMETERS
"^DD",798.1,798.1,11,21,0)
^.001^3^3^3020816^^
"^DD",798.1,798.1,11,21,1,0)
Select the "INACTIVE" code if you want to exclude
"^DD",798.1,798.1,11,21,2,0)
the registry from the regular registry updates and
"^DD",798.1,798.1,11,21,3,0)
data transmissions.
"^DD",798.1,798.1,11,"DT")
3020424
"^DD",798.1,798.1,12,0)
EXTRACTED RESULT^798.112I^^8;0
"^DD",798.1,798.1,12,9)
@
"^DD",798.1,798.1,12,20,0)
^.3LA^1^1
"^DD",798.1,798.1,12,20,1,0)
DEFINITION
"^DD",798.1,798.1,12,21,0)
^.001^3^3^3020816^^
"^DD",798.1,798.1,12,21,1,0)
This multiple contains a list of Lab result codes.
"^DD",798.1,798.1,12,21,2,0)
These results will be extracted and transmitted to
"^DD",798.1,798.1,12,21,3,0)
AAC.
"^DD",798.1,798.1,12,"DT")
3010629
"^DD",798.1,798.1,13,0)
PROTOCOL^*P101'X^ORD(101,^9;1^Q:$$VAEDT^RORDD(798.1,$G(DA))  S DIC("S")="S D=$G(^(0)) I $E($P(D,U),1,3)=""ROR"",$P(D,U,4)=""E""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",798.1,798.1,13,3)

"^DD",798.1,798.1,13,8.5)
@
"^DD",798.1,798.1,13,9)
@
"^DD",798.1,798.1,13,12)
Only Event Drivers from the "ROR" namespace can be selected!
"^DD",798.1,798.1,13,12.1)
S DIC("S")="S D=$G(^(0)) I $E($P(D,U),1,3)=""ROR"",$P(D,U,4)=""E"""
"^DD",798.1,798.1,13,20,0)
^.3LA^2^2
"^DD",798.1,798.1,13,20,1,0)
HL7
"^DD",798.1,798.1,13,20,2,0)
DEFINITION
"^DD",798.1,798.1,13,21,0)
^.001^6^6^3060106^^^^
"^DD",798.1,798.1,13,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.1,798.1,13,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,13,21,3,0)
 
"^DD",798.1,798.1,13,21,4,0)
This field contains a pointer to the protocol in 
"^DD",798.1,798.1,13,21,5,0)
the PROTOCOL file that is used as the event driver
"^DD",798.1,798.1,13,21,6,0)
for sending HL7 messages.
"^DD",798.1,798.1,13,23,0)
^^5^5^3060106^
"^DD",798.1,798.1,13,23,1,0)
If several registries are processed by the same nightly
"^DD",798.1,798.1,13,23,2,0)
task and they have different values of the PROTOCOL
"^DD",798.1,798.1,13,23,3,0)
field, then the registries are grouped by the value of
"^DD",798.1,798.1,13,23,4,0)
this field and data extraction is performed separately
"^DD",798.1,798.1,13,23,5,0)
for each of those groups.
"^DD",798.1,798.1,13,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,13,"DT")
3011112
"^DD",798.1,798.1,13.1,0)
MAXIMUM MESSAGE SIZE^NJ4,1^^9;2^K:+X'=X!(X>99)!(X<0)!(X?.E1"."2N.N) X
"^DD",798.1,798.1,13.1,3)
Enter maximum size (in megabytes) between 0 and 99, 1 decimal digit.
"^DD",798.1,798.1,13.1,8.5)
@
"^DD",798.1,798.1,13.1,9)
@
"^DD",798.1,798.1,13.1,20,0)
^.3LA^2^2
"^DD",798.1,798.1,13.1,20,1,0)
HL7
"^DD",798.1,798.1,13.1,20,2,0)
PARAMETERS
"^DD",798.1,798.1,13.1,21,0)
^.001^8^8^3060203^^
"^DD",798.1,798.1,13.1,21,1,0)
This field stores the maximum size (in megabytes)
"^DD",798.1,798.1,13.1,21,2,0)
of a batch HL7 message that can be sent to Austin
"^DD",798.1,798.1,13.1,21,3,0)
Automation Center (AAC). If this field is empty or
"^DD",798.1,798.1,13.1,21,4,0)
contains 0, the size is not limited.
"^DD",798.1,798.1,13.1,21,5,0)
 
"^DD",798.1,798.1,13.1,21,6,0)
You must coordinate your intentions with AAC
"^DD",798.1,798.1,13.1,21,7,0)
support personnel if you are going to edit this
"^DD",798.1,798.1,13.1,21,8,0)
field.
"^DD",798.1,798.1,13.1,23,0)
^^8^8^3060203^
"^DD",798.1,798.1,13.1,23,1,0)
Actual size of an HL7 batch can be greater than the
"^DD",798.1,798.1,13.1,23,2,0)
value of this field because the software does not break
"^DD",798.1,798.1,13.1,23,3,0)
in the middle of an individual HL7 message.
"^DD",798.1,798.1,13.1,23,4,0)
 
"^DD",798.1,798.1,13.1,23,5,0)
For example, if the maximum size is 10Mb, the current
"^DD",798.1,798.1,13.1,23,6,0)
size is 9Mb and 3Mb should be sent for the patient
"^DD",798.1,798.1,13.1,23,7,0)
being processed, then the actual size of the batch will
"^DD",798.1,798.1,13.1,23,8,0)
be 12Mb.
"^DD",798.1,798.1,13.1,"DT")
3020730
"^DD",798.1,798.1,13.2,0)
ALERT FREQUENCY^NJ2,0^^9;3^K:+X'=X!(X>10)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.1,798.1,13.2,3)
Type a Number between 1 and 10, 0 Decimal Digits
"^DD",798.1,798.1,13.2,8.5)
@
"^DD",798.1,798.1,13.2,9)
@
"^DD",798.1,798.1,13.2,11,0)
^.2LAP^^0
"^DD",798.1,798.1,13.2,20,0)
^.3LA^2^2
"^DD",798.1,798.1,13.2,20,1,0)
HL7
"^DD",798.1,798.1,13.2,20,2,0)
PARAMETERS
"^DD",798.1,798.1,13.2,21,0)
^.001^20^20^3060203^^
"^DD",798.1,798.1,13.2,21,1,0)
Value of the ALERT FREQUENCY field determines how
"^DD",798.1,798.1,13.2,21,2,0)
often e-mail notifications and VistA alerts are 
"^DD",798.1,798.1,13.2,21,3,0)
sent to the AAC and local staff in case of
"^DD",798.1,798.1,13.2,21,4,0)
problems with the site's CCR software (data
"^DD",798.1,798.1,13.2,21,5,0)
extraction problems, unsent HL7 messages, etc.).
"^DD",798.1,798.1,13.2,21,6,0)
 
"^DD",798.1,798.1,13.2,21,7,0)
If this field is empty or 0, notifications are
"^DD",798.1,798.1,13.2,21,8,0)
not sent.
"^DD",798.1,798.1,13.2,21,9,0)
 
"^DD",798.1,798.1,13.2,21,10,0)
Otherwise, the nightly task increments the error
"^DD",798.1,798.1,13.2,21,11,0)
counters and checks the remainders from division
"^DD",798.1,798.1,13.2,21,12,0)
of the counters by the value of this field. When a
"^DD",798.1,798.1,13.2,21,13,0)
reminder becomes 0, the software sends the
"^DD",798.1,798.1,13.2,21,14,0)
corresponding e-mail notification to the AAC and
"^DD",798.1,798.1,13.2,21,15,0)
generates the VistA alert to the local staff
"^DD",798.1,798.1,13.2,21,16,0)
listed in the NOTIFICATION multiple (14).
"^DD",798.1,798.1,13.2,21,17,0)
 
"^DD",798.1,798.1,13.2,21,18,0)
For example, if the nightly task runs every night 
"^DD",798.1,798.1,13.2,21,19,0)
and the ALERT FREQUENCY is 2, then alerts and 
"^DD",798.1,798.1,13.2,21,20,0)
notifications will be sent every other night.
"^DD",798.1,798.1,13.2,23,0)
^.001^3^3^3060203^^^
"^DD",798.1,798.1,13.2,23,1,0)
See description of the HL7 PROBLEM COUNTER field (19.3)
"^DD",798.1,798.1,13.2,23,2,0)
and source code of the $$CHECKMSG^ROR10 function for
"^DD",798.1,798.1,13.2,23,3,0)
more details.
"^DD",798.1,798.1,13.2,"DT")
3050503
"^DD",798.1,798.1,13.3,0)
NATIONAL NOTIFICATION E-MAIL^FX^^9;4^Q:$$VAEDT^RORDD(798.1,$G(DA))  K:$L(X)>50!($L(X)<3)!(X'?1.ANP1"@"1.ANP) X
"^DD",798.1,798.1,13.3,3)
Answer must be a valid e-mail address (3-50 characters in length).
"^DD",798.1,798.1,13.3,8.5)
@
"^DD",798.1,798.1,13.3,9)
@
"^DD",798.1,798.1,13.3,20,0)
^.3LA^1^1
"^DD",798.1,798.1,13.3,20,1,0)
DEFINITION
"^DD",798.1,798.1,13.3,21,0)
^.001^10^10^3060203^^
"^DD",798.1,798.1,13.3,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.1,798.1,13.3,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,13.3,21,3,0)
 
"^DD",798.1,798.1,13.3,21,4,0)
The NATIONAL NOTIFICATION E-MAIL field holds an 
"^DD",798.1,798.1,13.3,21,5,0)
e-mail address where notifications about registry
"^DD",798.1,798.1,13.3,21,6,0)
problems (mostly, data transmission problems) are
"^DD",798.1,798.1,13.3,21,7,0)
sent to.
"^DD",798.1,798.1,13.3,21,8,0)
 
"^DD",798.1,798.1,13.3,21,9,0)
If the field is empty, e-mail notifications will
"^DD",798.1,798.1,13.3,21,10,0)
not be sent.
"^DD",798.1,798.1,13.3,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,13.3,"DT")
3030429
"^DD",798.1,798.1,14,0)
NOTIFICATION^798.114P^^10;0
"^DD",798.1,798.1,14,21,0)
^.001^3^3^3050525^^^
"^DD",798.1,798.1,14,21,1,0)
This multiple contains a list of VistA users that
"^DD",798.1,798.1,14,21,2,0)
should be notified about problems with the local
"^DD",798.1,798.1,14,21,3,0)
registry.
"^DD",798.1,798.1,14,"DT")
3050427
"^DD",798.1,798.1,15.1,0)
LAG DAYS^NJ1,0^^11;1^K:+X'=X!(X>7)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.1,798.1,15.1,3)
Enter number of days between 1 and 7.
"^DD",798.1,798.1,15.1,20,0)
^.3LA^1^1
"^DD",798.1,798.1,15.1,20,1,0)
PARAMETERS
"^DD",798.1,798.1,15.1,21,0)
^.001^12^12^3020816^^^
"^DD",798.1,798.1,15.1,21,1,0)
Number of days that defines an overlap of the data
"^DD",798.1,798.1,15.1,21,2,0)
searches during the registry updates and a data
"^DD",798.1,798.1,15.1,21,3,0)
extraction delay during the regular data
"^DD",798.1,798.1,15.1,21,4,0)
extractions.
"^DD",798.1,798.1,15.1,21,5,0)
 
"^DD",798.1,798.1,15.1,21,6,0)
If this field is empty, the default value of 1 is 
"^DD",798.1,798.1,15.1,21,7,0)
used by the registry update and data extraction
"^DD",798.1,798.1,15.1,21,8,0)
processes.
"^DD",798.1,798.1,15.1,21,9,0)
 
"^DD",798.1,798.1,15.1,21,10,0)
See the package documentation or Technical
"^DD",798.1,798.1,15.1,21,11,0)
Description of the field in the data dictionary
"^DD",798.1,798.1,15.1,21,12,0)
for more information.
"^DD",798.1,798.1,15.1,23,0)
^^37^37^3060203^
"^DD",798.1,798.1,15.1,23,1,0)
Clinical data may be entered into the VistA system 
"^DD",798.1,798.1,15.1,23,2,0)
later than they are available. For example, an
"^DD",798.1,798.1,15.1,23,3,0)
encounter that occurred today may not get entered into
"^DD",798.1,798.1,15.1,23,4,0)
the system until tomorrow.
"^DD",798.1,798.1,15.1,23,5,0)
 
"^DD",798.1,798.1,15.1,23,6,0)
Because of this delay, data may be missed by the
"^DD",798.1,798.1,15.1,23,7,0)
registry update and data extraction processes if they
"^DD",798.1,798.1,15.1,23,8,0)
look for the data until the current date and then
"^DD",798.1,798.1,15.1,23,9,0)
continue from that point next time.
"^DD",798.1,798.1,15.1,23,10,0)
 
"^DD",798.1,798.1,15.1,23,11,0)
To avoid this problem, data search intervals are 
"^DD",798.1,798.1,15.1,23,12,0)
overlapped by the number of days indicated by this 
"^DD",798.1,798.1,15.1,23,13,0)
field. The registry update process looks for new data 
"^DD",798.1,798.1,15.1,23,14,0)
not from the end date of its previous run but from the 
"^DD",798.1,798.1,15.1,23,15,0)
date that is earlier by the number of days from this 
"^DD",798.1,798.1,15.1,23,16,0)
field. This overlap increases the chances of data
"^DD",798.1,798.1,15.1,23,17,0)
entered retrospectively to be found by the next run of
"^DD",798.1,798.1,15.1,23,18,0)
the registry update process.
"^DD",798.1,798.1,15.1,23,19,0)
 
"^DD",798.1,798.1,15.1,23,20,0)
Moreover, the regular data extraction process extracts
"^DD",798.1,798.1,15.1,23,21,0)
data not until the date when the process is run but
"^DD",798.1,798.1,15.1,23,22,0)
until the date that is earlier by the number of days
"^DD",798.1,798.1,15.1,23,23,0)
from this field. So, this is a delay that allows the
"^DD",798.1,798.1,15.1,23,24,0)
data to be entered retrospectively before the next data
"^DD",798.1,798.1,15.1,23,25,0)
extraction.
"^DD",798.1,798.1,15.1,23,26,0)
 
"^DD",798.1,798.1,15.1,23,27,0)
If the value of this field is too small, you may miss 
"^DD",798.1,798.1,15.1,23,28,0)
some data entered retrospectively. If it is too big,
"^DD",798.1,798.1,15.1,23,29,0)
the national registry will not contain up to date
"^DD",798.1,798.1,15.1,23,30,0)
information (data will be delayed by the number of days
"^DD",798.1,798.1,15.1,23,31,0)
indicated by this field) and the registry update
"^DD",798.1,798.1,15.1,23,32,0)
process will take more time to complete, because 
"^DD",798.1,798.1,15.1,23,33,0)
additional time will be spent processing the data from
"^DD",798.1,798.1,15.1,23,34,0)
the overlap interval).
"^DD",798.1,798.1,15.1,23,35,0)
 
"^DD",798.1,798.1,15.1,23,36,0)
When several registries are processed at the same time,
"^DD",798.1,798.1,15.1,23,37,0)
the maximum value of the LAG DAYS field is used.
"^DD",798.1,798.1,15.1,"DT")
3020426
"^DD",798.1,798.1,18,0)
SECURITY KEY^798.118^^18;0
"^DD",798.1,798.1,18,9)
@
"^DD",798.1,798.1,18,20,0)
^.3LA^1^1
"^DD",798.1,798.1,18,20,1,0)
DEFINITION
"^DD",798.1,798.1,18,21,0)
^.001^2^2^3050722^^^^
"^DD",798.1,798.1,18,21,1,0)
This multiple stores a list of security keys 
"^DD",798.1,798.1,18,21,2,0)
associated with the registry.
"^DD",798.1,798.1,19.1,0)
NUMBER OF PATIENTS^NJ9,0^^19;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",798.1,798.1,19.1,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",798.1,798.1,19.1,8.5)
@
"^DD",798.1,798.1,19.1,9)
@
"^DD",798.1,798.1,19.1,20,0)
^.3LA^1^1
"^DD",798.1,798.1,19.1,20,1,0)
STATE
"^DD",798.1,798.1,19.1,21,0)
^.001^3^3^3060106^^^
"^DD",798.1,798.1,19.1,21,1,0)
The NUMBER OF PATIENTS field contains total number
"^DD",798.1,798.1,19.1,21,2,0)
of confirmed patients in the registry right after
"^DD",798.1,798.1,19.1,21,3,0)
the last registry update.
"^DD",798.1,798.1,19.1,23,0)
^.001^3^3^3060203^^
"^DD",798.1,798.1,19.1,23,1,0)
This field should not be edited. It is updated
"^DD",798.1,798.1,19.1,23,2,0)
automatically by the $$UPDDEM^RORUPD51 function during
"^DD",798.1,798.1,19.1,23,3,0)
the registry update.
"^DD",798.1,798.1,19.1,"DT")
3031027
"^DD",798.1,798.1,19.2,0)
NUMBER OF PENDING PATIENTS^NJ9,0^^19;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",798.1,798.1,19.2,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",798.1,798.1,19.2,8.5)
@
"^DD",798.1,798.1,19.2,9)
@
"^DD",798.1,798.1,19.2,20,0)
^.3LA^1^1
"^DD",798.1,798.1,19.2,20,1,0)
STATE
"^DD",798.1,798.1,19.2,21,0)
^.001^3^3^3060106^^
"^DD",798.1,798.1,19.2,21,1,0)
The NUMBER OF PENDING PATIENTS field stores number
"^DD",798.1,798.1,19.2,21,2,0)
of pending patients in the registry right after
"^DD",798.1,798.1,19.2,21,3,0)
the last registry update.
"^DD",798.1,798.1,19.2,23,0)
^.001^3^3^3060203^^
"^DD",798.1,798.1,19.2,23,1,0)
This field should not be edited. It is updated 
"^DD",798.1,798.1,19.2,23,2,0)
automatically by the $$UPDDEM^RORUPD51 function during
"^DD",798.1,798.1,19.2,23,3,0)
the registry update.
"^DD",798.1,798.1,19.2,"DT")
3050627
"^DD",798.1,798.1,19.3,0)
HL7 ATTEMPT COUNTER^NJ3,0^^19;3^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X
"^DD",798.1,798.1,19.3,3)
Type a Number between 0 and 999, 0 Decimal Digits
"^DD",798.1,798.1,19.3,8.5)
@
"^DD",798.1,798.1,19.3,9)
@
"^DD",798.1,798.1,19.3,20,0)
^.3LA^1^1
"^DD",798.1,798.1,19.3,20,1,0)
HL7
"^DD",798.1,798.1,19.3,21,0)
^^10^10^3060203^
"^DD",798.1,798.1,19.3,21,1,0)
The HL7 ATTEMPT COUNTER field is incremented each
"^DD",798.1,798.1,19.3,21,2,0)
time the nightly task (the Registry Update & Data 
"^DD",798.1,798.1,19.3,21,3,0)
Extraction [ROR TASK] option) encounters at least
"^DD",798.1,798.1,19.3,21,4,0)
one unsent HL7 message.
"^DD",798.1,798.1,19.3,21,5,0)
 
"^DD",798.1,798.1,19.3,21,6,0)
The nightly task assigns 1 to the field when new
"^DD",798.1,798.1,19.3,21,7,0)
HL7 messages are generated (only if all previous
"^DD",798.1,798.1,19.3,21,8,0)
messages have been successfully transmitted).
"^DD",798.1,798.1,19.3,21,9,0)
 
"^DD",798.1,798.1,19.3,21,10,0)
Usually, you should not edit this field.
"^DD",798.1,798.1,19.3,23,0)
^.001^3^3^3060203^^^^
"^DD",798.1,798.1,19.3,23,1,0)
See description of the ALERT FREQUENCY field (13.2) and
"^DD",798.1,798.1,19.3,23,2,0)
source code of the $$CHECKMSG^ROR10 function for more
"^DD",798.1,798.1,19.3,23,3,0)
details.
"^DD",798.1,798.1,19.3,"DT")
3050701
"^DD",798.1,798.1,21.01,0)
AUTOMATIC BACKPULL^*P799.6'^RORDATA(799.6,^21;1^S DIC("S")="I $P($G(^(0)),U,2)=1" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",798.1,798.1,21.01,8.5)
@
"^DD",798.1,798.1,21.01,9)
@
"^DD",798.1,798.1,21.01,12)
Only "Auto" definitions can be selected.
"^DD",798.1,798.1,21.01,12.1)
S DIC("S")="I $P($G(^(0)),U,2)=1"
"^DD",798.1,798.1,21.01,20,0)
^.3LA^1^1
"^DD",798.1,798.1,21.01,20,1,0)
STATE
"^DD",798.1,798.1,21.01,21,0)
^^3^3^3051110^
"^DD",798.1,798.1,21.01,21,1,0)
This field stores the pointer to the historical 
"^DD",798.1,798.1,21.01,21,2,0)
data extraction definition that was used during
"^DD",798.1,798.1,21.01,21,3,0)
the previous run of the nightly task.
"^DD",798.1,798.1,21.01,"DT")
3051110
"^DD",798.1,798.1,21.04,0)
LOCAL DATA RESENT^D^^21;3^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",798.1,798.1,21.04,8.5)
@
"^DD",798.1,798.1,21.04,9)
@
"^DD",798.1,798.1,21.04,20,0)
^.3LA^1^1
"^DD",798.1,798.1,21.04,20,1,0)
STATE
"^DD",798.1,798.1,21.04,21,0)
^.001^10^10^3060203^^
"^DD",798.1,798.1,21.04,21,1,0)
This field holds the date when all local registry 
"^DD",798.1,798.1,21.04,21,2,0)
data was resent to AAC after the installation (to 
"^DD",798.1,798.1,21.04,21,3,0)
fix the data incorrectly overwritten with the 
"^DD",798.1,798.1,21.04,21,4,0)
historical data).
"^DD",798.1,798.1,21.04,21,5,0)
 
"^DD",798.1,798.1,21.04,21,6,0)
Usually, you should not modify this field. If you
"^DD",798.1,798.1,21.04,21,7,0)
need to resend all local registry and demographic
"^DD",798.1,798.1,21.04,21,8,0)
data to AAC, you should clear this field. The data
"^DD",798.1,798.1,21.04,21,9,0)
will be resent automatically during the next
"^DD",798.1,798.1,21.04,21,10,0)
nightly transmission.
"^DD",798.1,798.1,21.04,23,0)
^.001^4^4^3060203^^^^
"^DD",798.1,798.1,21.04,23,1,0)
The value of this field is analyzed and modified by the
"^DD",798.1,798.1,21.04,23,2,0)
$$REMARK^RORUTL05 function. The function is called by
"^DD",798.1,798.1,21.04,23,3,0)
the nightly registry update and data transmission task
"^DD",798.1,798.1,21.04,23,4,0)
(TASK^ROR).
"^DD",798.1,798.1,21.04,"DT")
3020508
"^DD",798.1,798.1,21.05,0)
HDT DATE/TIME^D^^21;4^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",798.1,798.1,21.05,8.5)
@
"^DD",798.1,798.1,21.05,9)
@
"^DD",798.1,798.1,21.05,21,0)
^.001^4^4^3060123^^
"^DD",798.1,798.1,21.05,21,1,0)
This field is initialized with the current 
"^DD",798.1,798.1,21.05,21,2,0)
date/time by the registry setup task upon
"^DD",798.1,798.1,21.05,21,3,0)
successful completion of the initial registry
"^DD",798.1,798.1,21.05,21,4,0)
population.
"^DD",798.1,798.1,21.05,23,0)
^^4^4^3060123^
"^DD",798.1,798.1,21.05,23,1,0)
The field is populated by the $$UPDHDTRP^RORSETU2 
"^DD",798.1,798.1,21.05,23,2,0)
function during the registry setup.
"^DD",798.1,798.1,21.05,23,3,0)
 
"^DD",798.1,798.1,21.05,23,4,0)
Do not delete value of this field!
"^DD",798.1,798.1,21.05,"DT")
3031027
"^DD",798.1,798.1,22,0)
LAST BATCH CONTROL ID^798.122^^22;0
"^DD",798.1,798.1,22,9)
@
"^DD",798.1,798.1,22,20,0)
^.3LA^1^1
"^DD",798.1,798.1,22,20,1,0)
HL7
"^DD",798.1,798.1,22,21,0)
^.001^3^3^3060203^^^^
"^DD",798.1,798.1,22,21,1,0)
This multiple contains a list of identifiers of
"^DD",798.1,798.1,22,21,2,0)
the HL7 batch messages generated during the
"^DD",798.1,798.1,22,21,3,0)
previous run of the nightly task.
"^DD",798.1,798.1,22,23,0)
^^3^3^3060203^
"^DD",798.1,798.1,22,23,1,0)
The nightly task checks status of each message from 
"^DD",798.1,798.1,22,23,2,0)
this multiple before the registry update and data
"^DD",798.1,798.1,22,23,3,0)
extraction.
"^DD",798.1,798.1,22,"DT")
3050504
"^DD",798.1,798.1,25,0)
ENABLE PROTOCOLS^S^0:NO;1:YES;^0;14^Q
"^DD",798.1,798.1,25,1,0)
^.1
"^DD",798.1,798.1,25,1,1,0)
798.1^AEP^MUMPS
"^DD",798.1,798.1,25,1,1,1)
S:X ^ROR(798.1,"AEP",DA)=""
"^DD",798.1,798.1,25,1,1,2)
K ^ROR(798.1,"AEP",DA)
"^DD",798.1,798.1,25,1,1,3)
Do not delete!
"^DD",798.1,798.1,25,1,1,"%D",0)
^^10^10^3060203^
"^DD",798.1,798.1,25,1,1,"%D",1,0)
This cross-reference controls the package event 
"^DD",798.1,798.1,25,1,1,"%D",2,0)
protocols.
"^DD",798.1,798.1,25,1,1,"%D",3,0)
 
"^DD",798.1,798.1,25,1,1,"%D",4,0)
If at least one registry has the ENABLE PROTOCOLS
"^DD",798.1,798.1,25,1,1,"%D",5,0)
field set to "YES", the ^ROR(798.1,"AEP") node
"^DD",798.1,798.1,25,1,1,"%D",6,0)
will be defined and the protocols will call the
"^DD",798.1,798.1,25,1,1,"%D",7,0)
processing routines.
"^DD",798.1,798.1,25,1,1,"%D",8,0)
 
"^DD",798.1,798.1,25,1,1,"%D",9,0)
Otherwise, they will run idle unless they are 
"^DD",798.1,798.1,25,1,1,"%D",10,0)
disabled or unsubscribed manually.
"^DD",798.1,798.1,25,1,1,"DT")
3020418
"^DD",798.1,798.1,25,20,0)
^.3LA^1^1
"^DD",798.1,798.1,25,20,1,0)
PARAMETERS
"^DD",798.1,798.1,25,21,0)
^^13^13^3060203^
"^DD",798.1,798.1,25,21,1,0)
If this field is set to "YES", event protocols
"^DD",798.1,798.1,25,21,2,0)
will be used by the package to speed up the 
"^DD",798.1,798.1,25,21,3,0)
registry processing.
"^DD",798.1,798.1,25,21,4,0)
 
"^DD",798.1,798.1,25,21,5,0)
The protocols create references to patient events
"^DD",798.1,798.1,25,21,6,0)
in the ROR PATIENT EVENTS file. Only those 
"^DD",798.1,798.1,25,21,7,0)
patients that have new references will be 
"^DD",798.1,798.1,25,21,8,0)
processed by the next registry update.
"^DD",798.1,798.1,25,21,9,0)
 
"^DD",798.1,798.1,25,21,10,0)
If several registries are updated at the same 
"^DD",798.1,798.1,25,21,11,0)
time and at least one of them has this field set 
"^DD",798.1,798.1,25,21,12,0)
to "YES", all these registries will be processed 
"^DD",798.1,798.1,25,21,13,0)
using event references.
"^DD",798.1,798.1,25,23,0)
^.001^11^11^3060203^^
"^DD",798.1,798.1,25,23,1,0)
This field controls both the registry update engine 
"^DD",798.1,798.1,25,23,2,0)
and the event protocols.
"^DD",798.1,798.1,25,23,3,0)
 
"^DD",798.1,798.1,25,23,4,0)
If at least one of the defined registries enables the
"^DD",798.1,798.1,25,23,5,0)
protocols, they will process the events and create
"^DD",798.1,798.1,25,23,6,0)
references in the ROR PATIENT EVENTS file (#798.3).
"^DD",798.1,798.1,25,23,7,0)
 
"^DD",798.1,798.1,25,23,8,0)
Otherwise, the protocols will be executed (if they are
"^DD",798.1,798.1,25,23,9,0)
not disabled or unsubscribed manually) but will not
"^DD",798.1,798.1,25,23,10,0)
call processing routines and will not create references
"^DD",798.1,798.1,25,23,11,0)
in file #798.3.
"^DD",798.1,798.1,25,"DT")
3020418
"^DD",798.1,798.1,26,0)
EXCLUDE EMPLOYEES^SX^0:NO;1:YES;^0;10^Q:$$VAEDT^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,26,8.5)
@
"^DD",798.1,798.1,26,9)
@
"^DD",798.1,798.1,26,20,0)
^.3LA^1^1
"^DD",798.1,798.1,26,20,1,0)
DEFINITION
"^DD",798.1,798.1,26,21,0)
^^6^6^3060203^
"^DD",798.1,798.1,26,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,26,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,26,21,3,0)
 
"^DD",798.1,798.1,26,21,4,0)
If this field is set to "YES", patients who are
"^DD",798.1,798.1,26,21,5,0)
employees will not be processed by the registry
"^DD",798.1,798.1,26,21,6,0)
update or data extraction functions.
"^DD",798.1,798.1,26,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,26,"DT")
3020802
"^DD",798.1,798.1,27,0)
AVAILABLE REPORTS^FX^^27;E1,250^Q:$$VAEDT^RORDD(798.1,$G(DA))  K:$L(X)>250!($L(X)<1) X
"^DD",798.1,798.1,27,3)
Answer must be 1-250 characters in length.
"^DD",798.1,798.1,27,8.5)
@
"^DD",798.1,798.1,27,9)
@
"^DD",798.1,798.1,27,20,0)
^.3LA^1^1
"^DD",798.1,798.1,27,20,1,0)
DEFINITION
"^DD",798.1,798.1,27,21,0)
^^7^7^3060203^
"^DD",798.1,798.1,27,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.1,798.1,27,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,27,21,3,0)
 
"^DD",798.1,798.1,27,21,4,0)
The AVAILABLE REPORTS field stores a list of 
"^DD",798.1,798.1,27,21,5,0)
report codes (not the IENs!) separated by commas.
"^DD",798.1,798.1,27,21,6,0)
These reports will be available for this registry
"^DD",798.1,798.1,27,21,7,0)
in the GUI.
"^DD",798.1,798.1,27,23,0)
^.001^5^5^3060203^^^^
"^DD",798.1,798.1,27,23,1,0)
The GUI loads the value of this field using the ROR 
"^DD",798.1,798.1,27,23,2,0)
REPORTS AVAILABLE remote procedure.
"^DD",798.1,798.1,27,23,3,0)
 
"^DD",798.1,798.1,27,23,4,0)
See the data dictionary of the ROR REPORT PARAMETERS 
"^DD",798.1,798.1,27,23,5,0)
file (#799.12) for more details.
"^DD",798.1,798.1,27,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,27,"DT")
3030417
"^DD",798.1,798.1,28,0)
LOCAL TEST NAME^798.128PI^^28;0
"^DD",798.1,798.1,28,20,0)
^.3LA^1^1
"^DD",798.1,798.1,28,20,1,0)
PARAMETERS
"^DD",798.1,798.1,28,21,0)
^.001^3^3^3060106^^
"^DD",798.1,798.1,28,21,1,0)
This multiple maps local lab tests to the 
"^DD",798.1,798.1,28,21,2,0)
predefined lab test groups that are used in the 
"^DD",798.1,798.1,28,21,3,0)
reports.
"^DD",798.1,798.1,28,"DT")
3030402
"^DD",798.1,798.1,29,0)
LOCAL DRUG NAME^798.129P^^29;0
"^DD",798.1,798.1,29,20,0)
^.3LA^1^1
"^DD",798.1,798.1,29,20,1,0)
PARAMETERS
"^DD",798.1,798.1,29,21,0)
^^3^3^3060106^
"^DD",798.1,798.1,29,21,1,0)
This multiple maps local medication names to the
"^DD",798.1,798.1,29,21,2,0)
predefined medication groups that are used in the
"^DD",798.1,798.1,29,21,3,0)
reports.
"^DD",798.1,798.1,30,0)
REPORT STATS^798.12P^^30;0
"^DD",798.1,798.1,30,9)
@
"^DD",798.1,798.1,30,20,0)
^.3LA^1^1
"^DD",798.1,798.1,30,20,1,0)
STATE
"^DD",798.1,798.1,30,21,0)
^.001^4^4^3050722^^
"^DD",798.1,798.1,30,21,1,0)
Records of this multiple store the statistic data 
"^DD",798.1,798.1,30,21,2,0)
related to running reports. Usually, the stats are
"^DD",798.1,798.1,30,21,3,0)
reset after successful data transmission to the
"^DD",798.1,798.1,30,21,4,0)
AAC.
"^DD",798.1,798.1,30,23,0)
^^7^7^3050722^
"^DD",798.1,798.1,30,23,1,0)
Please do not edit the records of this multiple
"^DD",798.1,798.1,30,23,2,0)
directly. Use the entry points of the RORTSK12 routine
"^DD",798.1,798.1,30,23,3,0)
instead.
"^DD",798.1,798.1,30,23,4,0)
 
"^DD",798.1,798.1,30,23,5,0)
The input transform associated with the .01 field of 
"^DD",798.1,798.1,30,23,6,0)
this multiple guarantees that each report has only one
"^DD",798.1,798.1,30,23,7,0)
corresponding record in the multiple.
"^DD",798.1,798.11,0)
LOG EVENT SUB-FIELD^^.01^1
"^DD",798.1,798.11,0,"DT")
3010712
"^DD",798.1,798.11,0,"NM","LOG EVENT")

"^DD",798.1,798.11,0,"UP")
798.1
"^DD",798.1,798.11,.01,0)
LOG EVENT^MSX^1:Debug;2:Information;3:Data Quality;4:Warning;5:Database Error;6:Error;^0;1^Q
"^DD",798.1,798.11,.01,1,0)
^.1^^0
"^DD",798.1,798.11,.01,21,0)
^.001^10^10^3060203^^
"^DD",798.1,798.11,.01,21,1,0)
Select the type of the event if you want to enable
"^DD",798.1,798.11,.01,21,2,0)
recording of these events. If the list is empty,
"^DD",798.1,798.11,.01,21,3,0)
recording of all events is enabled. Otherwise,
"^DD",798.1,798.11,.01,21,4,0)
only events from the list and error messages will 
"^DD",798.1,798.11,.01,21,5,0)
be recorded.
"^DD",798.1,798.11,.01,21,6,0)
 
"^DD",798.1,798.11,.01,21,7,0)
Debug messages are exclusions from this rule (they
"^DD",798.1,798.11,.01,21,8,0)
are not logged if the ENABLE LOG field is set to
"^DD",798.1,798.11,.01,21,9,0)
"YES" and this multiple is empty). Their recording
"^DD",798.1,798.11,.01,21,10,0)
can only be enabled explicitly.
"^DD",798.1,798.11,.01,23,0)
^.001^9^9^3060203^^^^
"^DD",798.1,798.11,.01,23,1,0)
If several registries are processed at the same time,
"^DD",798.1,798.11,.01,23,2,0)
the recording parameters are combined.
"^DD",798.1,798.11,.01,23,3,0)
 
"^DD",798.1,798.11,.01,23,4,0)
If one of the registries requests recording of all 
"^DD",798.1,798.11,.01,23,5,0)
events, all events except the debug messages (type 1)
"^DD",798.1,798.11,.01,23,6,0)
will be recorded for all registries.
"^DD",798.1,798.11,.01,23,7,0)
 
"^DD",798.1,798.11,.01,23,8,0)
Otherwise, merged content of the LOG EVENT multiples
"^DD",798.1,798.11,.01,23,9,0)
will determine the events to be recorded.
"^DD",798.1,798.11,.01,"DT")
3050722
"^DD",798.1,798.112,0)
EXTRACTED RESULT SUB-FIELD^^.03^3
"^DD",798.1,798.112,0,"DT")
3030318
"^DD",798.1,798.112,0,"ID","WRITE")
D EN^DDIOL($P(^(0),U,2),"","?20")
"^DD",798.1,798.112,0,"IX","B",798.112,.01)

"^DD",798.1,798.112,0,"IX","C",798.112,.02)

"^DD",798.1,798.112,0,"NM","EXTRACTED RESULT")

"^DD",798.1,798.112,0,"UP")
798.1
"^DD",798.1,798.112,.01,0)
LOINC CODE^MFX^^0;1^Q:$$VAEDT^RORDD(798.1,$G(DA(1)))  K:X'?1(1.7N,1"*") X
"^DD",798.1,798.112,.01,1,0)
^.1
"^DD",798.1,798.112,.01,1,1,0)
798.112^B
"^DD",798.1,798.112,.01,1,1,1)
S ^ROR(798.1,DA(1),8,"B",$E(X,1,30),DA)=""
"^DD",798.1,798.112,.01,1,1,2)
K ^ROR(798.1,DA(1),8,"B",$E(X,1,30),DA)
"^DD",798.1,798.112,.01,1,1,3)
Do not delete!
"^DD",798.1,798.112,.01,1,1,"DT")
3010716
"^DD",798.1,798.112,.01,3)
Answer must be 1-7 characters in length.
"^DD",798.1,798.112,.01,8.5)
@
"^DD",798.1,798.112,.01,9)
@
"^DD",798.1,798.112,.01,21,0)
^^11^11^3011015^
"^DD",798.1,798.112,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.112,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.112,.01,21,3,0)
 
"^DD",798.1,798.112,.01,21,4,0)
Enter the unique numeric LOINC code (without the
"^DD",798.1,798.112,.01,21,5,0)
check digit) of the Lab result to be extracted. If
"^DD",798.1,798.112,.01,21,6,0)
you want to use only NLT code, enter zero as the
"^DD",798.1,798.112,.01,21,7,0)
value of this field.
"^DD",798.1,798.112,.01,21,8,0)
 
"^DD",798.1,798.112,.01,21,9,0)
If you want to extract all results, create a
"^DD",798.1,798.112,.01,21,10,0)
record in this multiple containing the "*" 
"^DD",798.1,798.112,.01,21,11,0)
character in this field.
"^DD",798.1,798.112,.01,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA(1)))
"^DD",798.1,798.112,.01,"DT")
3010716
"^DD",798.1,798.112,.02,0)
NLT CODE^FX^^0;2^Q:$$VAEDT^RORDD(798.1,$G(DA(1)))  K:'(X?5N1"."4.5N) X
"^DD",798.1,798.112,.02,1,0)
^.1
"^DD",798.1,798.112,.02,1,1,0)
798.112^C
"^DD",798.1,798.112,.02,1,1,1)
S ^ROR(798.1,DA(1),8,"C",$E(X,1,30),DA)=""
"^DD",798.1,798.112,.02,1,1,2)
K ^ROR(798.1,DA(1),8,"C",$E(X,1,30),DA)
"^DD",798.1,798.112,.02,1,1,3)
Do not delete!
"^DD",798.1,798.112,.02,1,1,"DT")
3010716
"^DD",798.1,798.112,.02,3)
Answer must be 10-11 characters in length.
"^DD",798.1,798.112,.02,8.5)
@
"^DD",798.1,798.112,.02,9)
@
"^DD",798.1,798.112,.02,21,0)
^^8^8^3011015^
"^DD",798.1,798.112,.02,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.112,.02,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.112,.02,21,3,0)
 
"^DD",798.1,798.112,.02,21,4,0)
Enter the unique NLT code of the Lab result to be
"^DD",798.1,798.112,.02,21,5,0)
extracted. Both LOINC and NLT codes (if available)
"^DD",798.1,798.112,.02,21,6,0)
are used for searching the Lab results. If you 
"^DD",798.1,798.112,.02,21,7,0)
want to use only the LOINC code, leave this field 
"^DD",798.1,798.112,.02,21,8,0)
empty.
"^DD",798.1,798.112,.02,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA(1)))
"^DD",798.1,798.112,.02,"DT")
3010716
"^DD",798.1,798.112,.03,0)
SUBSCRIPTS^FX^^0;3^Q:$$VAEDT^RORDD(798.1,$G(DA(1)))  K:$L(X)>30!($L(X)<2) X
"^DD",798.1,798.112,.03,3)
Answer must be 2-30 characters in length.
"^DD",798.1,798.112,.03,8.5)
@
"^DD",798.1,798.112,.03,9)
@
"^DD",798.1,798.112,.03,21,0)
^^14^14^3030318^
"^DD",798.1,798.112,.03,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.112,.03,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.112,.03,21,3,0)
 
"^DD",798.1,798.112,.03,21,4,0)
Enter a list of the subscripts separated by commas
"^DD",798.1,798.112,.03,21,5,0)
(CH, MI, etc.) from where the results should be
"^DD",798.1,798.112,.03,21,6,0)
loaded by the $$GCPR^LA7QRY function. Only these
"^DD",798.1,798.112,.03,21,7,0)
subscripts will be searched for new data.
"^DD",798.1,798.112,.03,21,8,0)
 
"^DD",798.1,798.112,.03,21,9,0)
NOTE: The value of the field affects the data
"^DD",798.1,798.112,.03,21,10,0)
extraction only if the LOINC CODE field is equal
"^DD",798.1,798.112,.03,21,11,0)
to "*".
"^DD",798.1,798.112,.03,21,12,0)
 
"^DD",798.1,798.112,.03,21,13,0)
If this field is empty (by default), the API 
"^DD",798.1,798.112,.03,21,14,0)
searches through all supported subscripts.
"^DD",798.1,798.112,.03,"DT")
3030318
"^DD",798.1,798.114,0)
NOTIFICATION SUB-FIELD^^.01^1
"^DD",798.1,798.114,0,"DT")
3010907
"^DD",798.1,798.114,0,"IX","B",798.114,.01)

"^DD",798.1,798.114,0,"NM","NOTIFICATION")

"^DD",798.1,798.114,0,"UP")
798.1
"^DD",798.1,798.114,.01,0)
NOTIFICATION^MP200'X^VA(200,^0;1^S:$D(X) DINUM=X
"^DD",798.1,798.114,.01,1,0)
^.1
"^DD",798.1,798.114,.01,1,1,0)
798.114^B
"^DD",798.1,798.114,.01,1,1,1)
S ^ROR(798.1,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",798.1,798.114,.01,1,1,2)
K ^ROR(798.1,DA(1),10,"B",$E(X,1,30),DA)
"^DD",798.1,798.114,.01,1,1,3)
Do not delete!
"^DD",798.1,798.114,.01,21,0)
^^4^4^3060203^
"^DD",798.1,798.114,.01,21,1,0)
Select a user who already receives alerts or add a
"^DD",798.1,798.114,.01,21,2,0)
new one from the NEW PERSON file. VistA users
"^DD",798.1,798.114,.01,21,3,0)
referenced by this field will be notified about
"^DD",798.1,798.114,.01,21,4,0)
problems with the registry processes.
"^DD",798.1,798.114,.01,"DT")
3050427
"^DD",798.1,798.118,0)
SECURITY KEY SUB-FIELD^^.01^1
"^DD",798.1,798.118,0,"DT")
3020801
"^DD",798.1,798.118,0,"NM","SECURITY KEY")

"^DD",798.1,798.118,0,"UP")
798.1
"^DD",798.1,798.118,.01,0)
SECURITY KEY^MFX^^0;1^Q:$$VAEDT^RORDD(798.1,$G(DA(1)))  K:$L(X)>27!($L(X)<3) X
"^DD",798.1,798.118,.01,1,0)
^.1^^-1
"^DD",798.1,798.118,.01,1,2,0)
798.1^ACL^MUMPS
"^DD",798.1,798.118,.01,1,2,1)
D ACLSET^RORDD
"^DD",798.1,798.118,.01,1,2,2)
D ACLKILL^RORDD
"^DD",798.1,798.118,.01,1,2,3)
Do not delete!
"^DD",798.1,798.118,.01,1,2,"%D",0)
^^25^25^3060203^
"^DD",798.1,798.118,.01,1,2,"%D",1,0)
This cross-reference is used by the screening 
"^DD",798.1,798.118,.01,1,2,"%D",2,0)
logic (the "SCR" node) of some Clinical Case 
"^DD",798.1,798.118,.01,1,2,"%D",3,0)
Registries files to check whether a user is
"^DD",798.1,798.118,.01,1,2,"%D",4,0)
allowed to access the records or not.
"^DD",798.1,798.118,.01,1,2,"%D",5,0)
 
"^DD",798.1,798.118,.01,1,2,"%D",6,0)
The cross-reference contains two kinds of items:
"^DD",798.1,798.118,.01,1,2,"%D",7,0)
 
"^DD",798.1,798.118,.01,1,2,"%D",8,0)
  ^ROR(798.1,"ACL",RORDUZ,RegIEN,KEY,IEN) = ""
"^DD",798.1,798.118,.01,1,2,"%D",9,0)
  ^ROR(798.1,"ACL",RORDUZ,RegName,KEY,IEN) = ""
"^DD",798.1,798.118,.01,1,2,"%D",10,0)
 
"^DD",798.1,798.118,.01,1,2,"%D",11,0)
where RORDUZ is the value of the DUZ variable for
"^DD",798.1,798.118,.01,1,2,"%D",12,0)
the user who has access to one or more registries
"^DD",798.1,798.118,.01,1,2,"%D",13,0)
(according to the allocated security keys). RegIEN
"^DD",798.1,798.118,.01,1,2,"%D",14,0)
and RegName are the registry IEN and name. KEY is
"^DD",798.1,798.118,.01,1,2,"%D",15,0)
the name of security key and IEN is the internal
"^DD",798.1,798.118,.01,1,2,"%D",16,0)
entry number of the corresponding record of the
"^DD",798.1,798.118,.01,1,2,"%D",17,0)
SECURITY KEY multiple.
"^DD",798.1,798.118,.01,1,2,"%D",18,0)
 
"^DD",798.1,798.118,.01,1,2,"%D",19,0)
The cross-reference should be rebuilt after
"^DD",798.1,798.118,.01,1,2,"%D",20,0)
changes in the allocation of the security keys
"^DD",798.1,798.118,.01,1,2,"%D",21,0)
associated with any registry. Usually, this is
"^DD",798.1,798.118,.01,1,2,"%D",22,0)
done by the nightly task (the [ROR TASK] option).
"^DD",798.1,798.118,.01,1,2,"%D",23,0)
However, if you want the changes to be in effect
"^DD",798.1,798.118,.01,1,2,"%D",24,0)
immediately, you should rebuild this
"^DD",798.1,798.118,.01,1,2,"%D",25,0)
cross-reference manually.
"^DD",798.1,798.118,.01,1,2,"DT")
3020805
"^DD",798.1,798.118,.01,3)
Enter a name of security key (3-27 characters in length).
"^DD",798.1,798.118,.01,8.5)
@
"^DD",798.1,798.118,.01,9)
@
"^DD",798.1,798.118,.01,20,0)
^.3LA^^0
"^DD",798.1,798.118,.01,21,0)
^.001^5^5^3020816^^^
"^DD",798.1,798.118,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.118,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.118,.01,21,3,0)
 
"^DD",798.1,798.118,.01,21,4,0)
The SECURITY KEY field contains the name of the 
"^DD",798.1,798.118,.01,21,5,0)
security key associated with the registry.
"^DD",798.1,798.118,.01,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA(1)))
"^DD",798.1,798.118,.01,"DT")
3050722
"^DD",798.1,798.12,0)
REPORT STATS SUB-FIELD^^.02^2
"^DD",798.1,798.12,0,"DT")
3050715
"^DD",798.1,798.12,0,"IX","B",798.12,.01)

"^DD",798.1,798.12,0,"NM","REPORT STATS")

"^DD",798.1,798.12,0,"UP")
798.1
"^DD",798.1,798.12,.01,0)
REPORT STATS^MP799.34'X^ROR(799.34,^0;1^S:$D(X) DINUM=X
"^DD",798.1,798.12,.01,1,0)
^.1
"^DD",798.1,798.12,.01,1,1,0)
798.12^B
"^DD",798.1,798.12,.01,1,1,1)
S ^ROR(798.1,DA(1),30,"B",$E(X,1,30),DA)=""
"^DD",798.1,798.12,.01,1,1,2)
K ^ROR(798.1,DA(1),30,"B",$E(X,1,30),DA)
"^DD",798.1,798.12,.01,1,1,3)
Do not delete!
"^DD",798.1,798.12,.01,1,1,"DT")
3050722
"^DD",798.1,798.12,.01,3)

"^DD",798.1,798.12,.01,8.5)
@
"^DD",798.1,798.12,.01,9)
@
"^DD",798.1,798.12,.01,20,0)
^.3LA^1^1
"^DD",798.1,798.12,.01,20,1,0)
STATE
"^DD",798.1,798.12,.01,21,0)
^^2^2^3060106^
"^DD",798.1,798.12,.01,21,1,0)
A pointer stored in this field links the stats to 
"^DD",798.1,798.12,.01,21,2,0)
the report definition.
"^DD",798.1,798.12,.01,"DT")
3050722
"^DD",798.1,798.12,.02,0)
NUMBER OF RUNS^NJ9,0^^0;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",798.1,798.12,.02,3)
Type a Number between 0 and 999999999, 0 Decimal Digits.
"^DD",798.1,798.12,.02,8.5)
@
"^DD",798.1,798.12,.02,9)
@
"^DD",798.1,798.12,.02,20,0)
^.3LA^1^1
"^DD",798.1,798.12,.02,20,1,0)
STATE
"^DD",798.1,798.12,.02,21,0)
^.001^2^2^3060203^^
"^DD",798.1,798.12,.02,21,1,0)
This field serves as a counter of report runs 
"^DD",798.1,798.12,.02,21,2,0)
since the last successful data transmission.
"^DD",798.1,798.12,.02,23,0)
^.001^2^2^3060203^^
"^DD",798.1,798.12,.02,23,1,0)
Please do not edit the field directly. Use the entry
"^DD",798.1,798.12,.02,23,2,0)
points of the RORTSK12 routine instead.
"^DD",798.1,798.12,.02,"DT")
3050715
"^DD",798.1,798.122,0)
LAST BATCH CONTROL ID SUB-FIELD^^.03^3
"^DD",798.1,798.122,0,"DT")
3051129
"^DD",798.1,798.122,0,"NM","LAST BATCH CONTROL ID")

"^DD",798.1,798.122,0,"UP")
798.1
"^DD",798.1,798.122,.01,0)
LAST BATCH CONTROL ID^MFX^^0;1^K:$L(X)>20!($L(X)<1) X
"^DD",798.1,798.122,.01,1,0)
^.1^^0
"^DD",798.1,798.122,.01,3)
Answer must be 1-20 characters in length.
"^DD",798.1,798.122,.01,8.5)
@
"^DD",798.1,798.122,.01,9)
@
"^DD",798.1,798.122,.01,20,0)
^.3LA^1^1
"^DD",798.1,798.122,.01,20,1,0)
HL7
"^DD",798.1,798.122,.01,21,0)
^.001^3^3^3050503^^^
"^DD",798.1,798.122,.01,21,1,0)
The LAST BATCH CONTROL ID field contains the
"^DD",798.1,798.122,.01,21,2,0)
message control ID (BHS-11) of the latest batch
"^DD",798.1,798.122,.01,21,3,0)
HL7 message submitted to the VistA HL7 engine.
"^DD",798.1,798.122,.01,23,0)
^^3^3^3060203^
"^DD",798.1,798.122,.01,23,1,0)
This field is populated with the value returned by the 
"^DD",798.1,798.122,.01,23,2,0)
GENERATE^HLMA procedure. This value is usually
"^DD",798.1,798.122,.01,23,3,0)
different from that of the INTERNAL BATCH ID field.
"^DD",798.1,798.122,.01,"DT")
3051129
"^DD",798.1,798.122,.02,0)
INTERNAL BATCH ID^RF^^0;2^K:$L(X)>20!($L(X)<1) X
"^DD",798.1,798.122,.02,3)
Answer must be 1-20 characters in length.
"^DD",798.1,798.122,.02,8.5)
@
"^DD",798.1,798.122,.02,9)
@
"^DD",798.1,798.122,.02,20,0)
^.3LA^1^1
"^DD",798.1,798.122,.02,20,1,0)
HL7
"^DD",798.1,798.122,.02,21,0)
^^8^8^3060203^
"^DD",798.1,798.122,.02,21,1,0)
This field contains the internal batch identifier
"^DD",798.1,798.122,.02,21,2,0)
that was used during the generation of the batch 
"^DD",798.1,798.122,.02,21,3,0)
message.
"^DD",798.1,798.122,.02,21,4,0)
 
"^DD",798.1,798.122,.02,21,5,0)
The Control ID of each individual message included
"^DD",798.1,798.122,.02,21,6,0)
in the batch is constructed from the value of this
"^DD",798.1,798.122,.02,21,7,0)
field and a sequential number separated by the '-'
"^DD",798.1,798.122,.02,21,8,0)
character.
"^DD",798.1,798.122,.02,23,0)
^.001^7^7^3060203^^
"^DD",798.1,798.122,.02,23,1,0)
The INTERNAL BATCH ID field is automatically populated 
"^DD",798.1,798.122,.02,23,2,0)
with the identifier of the batch placeholder created by
"^DD",798.1,798.122,.02,23,3,0)
the CREATE^HLTF procedure. See the $$CREATE^RORHL7 and
"^DD",798.1,798.122,.02,23,4,0)
$$TMSTMP^ROREXTUT functions for details.
"^DD",798.1,798.122,.02,23,5,0)
 
"^DD",798.1,798.122,.02,23,6,0)
The actual batch control ID (BHS-11) is usually
"^DD",798.1,798.122,.02,23,7,0)
different from the value stored in this field.
"^DD",798.1,798.122,.02,"DT")
3050503
"^DD",798.1,798.122,.03,0)
DATE^D^^0;3^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",798.1,798.122,.03,8.5)
@
"^DD",798.1,798.122,.03,9)
@
"^DD",798.1,798.122,.03,21,0)
^^2^2^3060106^
"^DD",798.1,798.122,.03,21,1,0)
This field stores the date/time of the batch HL7 
"^DD",798.1,798.122,.03,21,2,0)
message.
"^DD",798.1,798.122,.03,"DT")
3051129
"^DD",798.1,798.128,0)
LOCAL TEST NAME SUB-FIELD^^.02^2
"^DD",798.1,798.128,0,"DT")
3030402
"^DD",798.1,798.128,0,"ID","WRITE")
S %I=Y,Y=+$P($G(^(0)),U,2),Y=$S(Y>0:$P($G(^ROR(799.1,Y,0)),U),1:"") D EN^DDIOL("   "_Y,,"?40") S Y=%I K %I
"^DD",798.1,798.128,0,"IX","B",798.128,.01)

"^DD",798.1,798.128,0,"NM","LOCAL TEST NAME")

"^DD",798.1,798.128,0,"UP")
798.1
"^DD",798.1,798.128,.01,0)
LOCAL TEST NAME^MP60'^LAB(60,^0;1^Q
"^DD",798.1,798.128,.01,1,0)
^.1
"^DD",798.1,798.128,.01,1,1,0)
798.128^B
"^DD",798.1,798.128,.01,1,1,1)
S ^ROR(798.1,DA(1),28,"B",$E(X,1,30),DA)=""
"^DD",798.1,798.128,.01,1,1,2)
K ^ROR(798.1,DA(1),28,"B",$E(X,1,30),DA)
"^DD",798.1,798.128,.01,20,0)
^.3LA^^0
"^DD",798.1,798.128,.01,"DT")
3030706
"^DD",798.1,798.128,.02,0)
LAB GROUP^R*P799.1'X^ROR(799.1,^0;2^S DIC("S")="S D=$G(^(0)) I $P(D,U,2)=3,$P(D,U,3)="_DA(1) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",798.1,798.128,.02,1,0)
^.1^^0
"^DD",798.1,798.128,.02,12)
Only Lab Groups can be selected.
"^DD",798.1,798.128,.02,12.1)
S DIC("S")="I $P(^(0),U,2)=3"
"^DD",798.1,798.128,.02,"DT")
3030706
"^DD",798.1,798.129,0)
LOCAL DRUG NAME SUB-FIELD^^.02^2
"^DD",798.1,798.129,0,"DT")
3030625
"^DD",798.1,798.129,0,"IX","B",798.129,.01)

"^DD",798.1,798.129,0,"NM","LOCAL DRUG NAME")

"^DD",798.1,798.129,0,"UP")
798.1
"^DD",798.1,798.129,.01,0)
LOCAL DRUG NAME^MP50'^PSDRUG(^0;1^Q
"^DD",798.1,798.129,.01,1,0)
^.1
"^DD",798.1,798.129,.01,1,1,0)
798.129^B
"^DD",798.1,798.129,.01,1,1,1)
S ^ROR(798.1,DA(1),29,"B",$E(X,1,30),DA)=""
"^DD",798.1,798.129,.01,1,1,2)
K ^ROR(798.1,DA(1),29,"B",$E(X,1,30),DA)
"^DD",798.1,798.129,.01,20,0)
^.3LA^^0
"^DD",798.1,798.129,.01,"DT")
3030706
"^DD",798.1,798.129,.02,0)
DRUG GROUP^R*P799.1'X^ROR(799.1,^0;2^S DIC("S")="S D=$G(^(0)) I $P(D,U,2)=4,$P(D,U,3)="_DA(1) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",798.1,798.129,.02,12)
Only Drug Groups can be selected.
"^DD",798.1,798.129,.02,12.1)
S DIC("S")="I $P(^(0),U,2)=4"
"^DD",798.1,798.129,.02,20,0)
^.3LA^^0
"^DD",798.1,798.129,.02,"DT")
3030706
"^DD",798.1,798.13,0)
SELECTION RULE SUB-FIELD^^.01^1
"^DD",798.1,798.13,0,"DT")
3000410
"^DD",798.1,798.13,0,"NM","SELECTION RULE")

"^DD",798.1,798.13,0,"UP")
798.1
"^DD",798.1,798.13,.01,0)
SELECTION RULE^MFX^^0;1^Q:$$VAEDT^RORDD(798.1,$G(DA(1)))  K:$L(X)>30!($L(X)<3)!'(X?3.UNP) X I $D(X) K:'$D(^ROR(798.2,"B",$E(X,1,30))) X
"^DD",798.1,798.13,.01,1,0)
^.1^^-1
"^DD",798.1,798.13,.01,1,2,0)
798.1^ARULES
"^DD",798.1,798.13,.01,1,2,1)
S ^ROR(798.1,"ARULES",$E(X,1,30),DA(1),DA)=""
"^DD",798.1,798.13,.01,1,2,2)
K ^ROR(798.1,"ARULES",$E(X,1,30),DA(1),DA)
"^DD",798.1,798.13,.01,1,2,3)
Do not delete!
"^DD",798.1,798.13,.01,1,2,"%D",0)
^^2^2^3011015^
"^DD",798.1,798.13,.01,1,2,"%D",1,0)
This cross-reference can be used to find all 
"^DD",798.1,798.13,.01,1,2,"%D",2,0)
registries that use the selection rule.
"^DD",798.1,798.13,.01,1,2,"DT")
3000406
"^DD",798.1,798.13,.01,3)
Enter a name of the selection rule (3-30 characters).
"^DD",798.1,798.13,.01,4)
I $G(X)="??" N D,DIC,DZ S DIC="^ROR(798.2,",DIC(0)="",D="B",DZ="??" D DQ^DICQ,EN^DDIOL("",,"!")
"^DD",798.1,798.13,.01,8.5)
@
"^DD",798.1,798.13,.01,9)
@
"^DD",798.1,798.13,.01,21,0)
^.001^8^8^3051031^^^^
"^DD",798.1,798.13,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.13,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.13,.01,21,3,0)
 
"^DD",798.1,798.13,.01,21,4,0)
Enter a name of the selection rule that will be 
"^DD",798.1,798.13,.01,21,5,0)
used to select patients for addition to the
"^DD",798.1,798.13,.01,21,6,0)
registry. The name should be entered exactly as it
"^DD",798.1,798.13,.01,21,7,0)
appears in the list of selection rules (file 
"^DD",798.1,798.13,.01,21,8,0)
#798.2).
"^DD",798.1,798.13,.01,23,0)
^.001^3^3^3051031^^^^
"^DD",798.1,798.13,.01,23,1,0)
Names of the selection rules are used here instead of 
"^DD",798.1,798.13,.01,23,2,0)
pointers because the KIDS pointer resolving feature 
"^DD",798.1,798.13,.01,23,3,0)
does not work for .01 fields.
"^DD",798.1,798.13,.01,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA(1)))
"^DD",798.1,798.13,.01,"DT")
3050722
"^DD",798.1,798.15,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",798.1,798.15,0,"NM","DESCRIPTION")

"^DD",798.1,798.15,0,"UP")
798.1
"^DD",798.1,798.15,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",798.1,798.15,.01,"DT")
3000313
"^DD",798.2,798.2,0)
FIELD^^6^7
"^DD",798.2,798.2,0,"DDA")
N
"^DD",798.2,798.2,0,"DT")
3020326
"^DD",798.2,798.2,0,"ID","WRITE")
D EN^DDIOL("  "_$P($G(^(0)),U,3),,"?30")
"^DD",798.2,798.2,0,"NM","ROR SELECTION RULE")

"^DD",798.2,798.2,0,"PT",798.01,.01)

"^DD",798.2,798.2,0,"VRPK")
ROR
"^DD",798.2,798.2,.01,0)
RULE NAME^FX^^0;1^Q:$$VAEDT^RORDD(798.2,$G(DA))  K:$L(X)>30!($L(X)<3)!'(X?1.UNP) X
"^DD",798.2,798.2,.01,1,0)
^.1^^0
"^DD",798.2,798.2,.01,3)
Enter a unique namespaced rule name (3-30 characters).
"^DD",798.2,798.2,.01,8.5)
@
"^DD",798.2,798.2,.01,9)
@
"^DD",798.2,798.2,.01,21,0)
^.001^6^6^3011010^^
"^DD",798.2,798.2,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.2,798.2,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.2,798.2,.01,21,3,0)
 
"^DD",798.2,798.2,.01,21,4,0)
Selection rule name must be unique and name 
"^DD",798.2,798.2,.01,21,5,0)
spaced. Names of the rules that are used for
"^DD",798.2,798.2,.01,21,6,0)
National Registries must start with "VA".
"^DD",798.2,798.2,.01,"DEL",1,0)
I $$VADEL^RORDD(798.2,$G(DA))
"^DD",798.2,798.2,.01,"DT")
3020314
"^DD",798.2,798.2,.09,0)
NATIONAL^SX^0:NO;1:YES;^0;4^Q:$$VAEDT^RORDD(798.2,,-1)
"^DD",798.2,798.2,.09,1,0)
^.1^^0
"^DD",798.2,798.2,.09,8.5)
@
"^DD",798.2,798.2,.09,9)
@
"^DD",798.2,798.2,.09,21,0)
^^6^6^3060203^
"^DD",798.2,798.2,.09,21,1,0)
ONLY AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN
"^DD",798.2,798.2,.09,21,2,0)
EDIT THIS FIELD!
"^DD",798.2,798.2,.09,21,3,0)
 
"^DD",798.2,798.2,.09,21,4,0)
Selection rules of the national registries must
"^DD",798.2,798.2,.09,21,5,0)
have this field set to "YES". This prevents local
"^DD",798.2,798.2,.09,21,6,0)
editing of other fields of rule definitions.
"^DD",798.2,798.2,.09,"DEL",1,0)
I $$VADEL^RORDD(798.2,,-1)
"^DD",798.2,798.2,.09,"DT")
3011121
"^DD",798.2,798.2,1,0)
EXPRESSION^RFX^^1;E1,245^Q:$$VAEDT^RORDD(798.2,$G(DA))  K:$L(X)>250!($L(X)<1) X I $D(X) Q:$$EXPR^RORDD($P($G(^ROR(798.2,DA,0)),U,2))
"^DD",798.2,798.2,1,3)
Enter M expression that implements the selection rule (1-250 characters).
"^DD",798.2,798.2,1,8.5)
@
"^DD",798.2,798.2,1,9)
@
"^DD",798.2,798.2,1,21,0)
^^5^5^3011010^
"^DD",798.2,798.2,1,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.2,798.2,1,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.2,798.2,1,21,3,0)
 
"^DD",798.2,798.2,1,21,4,0)
Enter a MUMPS expression (it may contain special
"^DD",798.2,798.2,1,21,5,0)
macros) that implements the selection rule.
"^DD",798.2,798.2,1,23,0)
^^62^62^3060203^
"^DD",798.2,798.2,1,23,1,0)
MUMPS expression that implements the selection rule can
"^DD",798.2,798.2,1,23,2,0)
contain special macros:
"^DD",798.2,798.2,1,23,3,0)
 
"^DD",798.2,798.2,1,23,4,0)
 {E: Field Name} - External value of the field
"^DD",798.2,798.2,1,23,5,0)
 {E: Field Number}
"^DD",798.2,798.2,1,23,6,0)
 
"^DD",798.2,798.2,1,23,7,0)
 {I: Field Name} - Internal value of the field
"^DD",798.2,798.2,1,23,8,0)
 {I: Field Number}
"^DD",798.2,798.2,1,23,9,0)
 
"^DD",798.2,798.2,1,23,10,0)
 {Rule Name} - Result value of the lower level
"^DD",798.2,798.2,1,23,11,0)
selection rule
"^DD",798.2,798.2,1,23,12,0)
 
"^DD",798.2,798.2,1,23,13,0)
 {AVG: Rule Name} - Average value of the rule
"^DD",798.2,798.2,1,23,14,0)
 
"^DD",798.2,798.2,1,23,15,0)
 {CNT: Rule Name} - Number of calculations of the rule
"^DD",798.2,798.2,1,23,16,0)
 
"^DD",798.2,798.2,1,23,17,0)
 {MAX: Rule Name} - Maximum value of the rule
"^DD",798.2,798.2,1,23,18,0)
 
"^DD",798.2,798.2,1,23,19,0)
 {MIN: Rule Name} - Minimum value of the rule
"^DD",798.2,798.2,1,23,20,0)
 
"^DD",798.2,798.2,1,23,21,0)
 {SUM: Rule Name} - Total of the selection rule values
"^DD",798.2,798.2,1,23,22,0)
 
"^DD",798.2,798.2,1,23,23,0)
 {LS: Lab Search Name} - This macro can be used only in
"^DD",798.2,798.2,1,23,24,0)
the selection rules associated with the LAB DATA file
"^DD",798.2,798.2,1,23,25,0)
(#63). It is evaluated as 1 if some of the patient
"^DD",798.2,798.2,1,23,26,0)
lab results pass the Lab search criteria (from the file
"^DD",798.2,798.2,1,23,27,0)
#798.9). Otherwise, it is evaluated as zero.
"^DD",798.2,798.2,1,23,28,0)
 
"^DD",798.2,798.2,1,23,29,0)
Return values of the top-level rules:
"^DD",798.2,798.2,1,23,30,0)
 
"^DD",798.2,798.2,1,23,31,0)
 0        - Skip the patient
"^DD",798.2,798.2,1,23,32,0)
 Non-zero - Add the patient to the registry
"^DD",798.2,798.2,1,23,33,0)
 
"^DD",798.2,798.2,1,23,34,0)
Return values of the lower level rules:
"^DD",798.2,798.2,1,23,35,0)
 
"^DD",798.2,798.2,1,23,36,0)
Return values can be used in the expressions of the
"^DD",798.2,798.2,1,23,37,0)
other rules. Some additional values are calculated
"^DD",798.2,798.2,1,23,38,0)
automatically (minimum, maximum, average, etc.) for
"^DD",798.2,798.2,1,23,39,0)
each rule.
"^DD",798.2,798.2,1,23,40,0)
 
"^DD",798.2,798.2,1,23,41,0)
Avoid circular references in the expressions. If a 
"^DD",798.2,798.2,1,23,42,0)
rule directly or indirectly depends on itself, it
"^DD",798.2,798.2,1,23,43,0)
cannot be evaluated. An example of the circular
"^DD",798.2,798.2,1,23,44,0)
reference:
"^DD",798.2,798.2,1,23,45,0)
 
"^DD",798.2,798.2,1,23,46,0)
 Rule A: {MAX:B}<10
"^DD",798.2,798.2,1,23,47,0)
 Rule B: {I:23}+{C}
"^DD",798.2,798.2,1,23,48,0)
 Rule C: {CNT:A}
"^DD",798.2,798.2,1,23,49,0)
 
"^DD",798.2,798.2,1,23,50,0)
The rule A cannot be evaluated because it depends on 
"^DD",798.2,798.2,1,23,51,0)
the rule B, which depends on rule C, and C depends on
"^DD",798.2,798.2,1,23,52,0)
A.
"^DD",798.2,798.2,1,23,53,0)
 
"^DD",798.2,798.2,1,23,54,0)
Complex selection rules could be implemented by 
"^DD",798.2,798.2,1,23,55,0)
external MUMPS functions. In that case the expression
"^DD",798.2,798.2,1,23,56,0)
should contains a full reference to the function
"^DD",798.2,798.2,1,23,57,0)
($$TAG^ROUTINE). Values of the necessary data elements
"^DD",798.2,798.2,1,23,58,0)
can be loaded automatically (see description of the
"^DD",798.2,798.2,1,23,59,0)
DATA ELEMENT multiple).
"^DD",798.2,798.2,1,23,60,0)
 
"^DD",798.2,798.2,1,23,61,0)
See the Programmer's reference manual for more details 
"^DD",798.2,798.2,1,23,62,0)
regarding the selection rule expressions.
"^DD",798.2,798.2,1,"DEL",1,0)
I $$VADEL^RORDD(798.2,$G(DA))
"^DD",798.2,798.2,1,"DT")
3011109
"^DD",798.2,798.2,2,0)
FILE^RNJ22,9X^^0;2^Q:$$VAEDT^RORDD(798.2,$G(DA))  K:+X'=X!(X>999999999999)!(X<1)!(X?.E1"."10N.N) X I $D(X) K:'$$VFILE^DILFD(X) X
"^DD",798.2,798.2,2,3)
Enter (sub)file number between 1 and 999999999999, 9 Decimal Digits.
"^DD",798.2,798.2,2,8.5)
@
"^DD",798.2,798.2,2,9)
@
"^DD",798.2,798.2,2,21,0)
^.001^6^6^3020403^^
"^DD",798.2,798.2,2,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.2,798.2,2,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.2,798.2,2,21,3,0)
 
"^DD",798.2,798.2,2,21,4,0)
Enter a file/sub-file number that the selection 
"^DD",798.2,798.2,2,21,5,0)
rule is associated with. Each selection rule can
"^DD",798.2,798.2,2,21,6,0)
be associated with only one file.
"^DD",798.2,798.2,2,"DEL",1,0)
I $$VADEL^RORDD(798.2,$G(DA))
"^DD",798.2,798.2,2,"DT")
3011109
"^DD",798.2,798.2,4,0)
SHORT DESCRIPTION^FX^^0;3^Q:$$VAEDT^RORDD(798.2,$G(DA))  K:$L(X)>30!($L(X)<3) X
"^DD",798.2,798.2,4,3)
Enter a short description of the selection rule (3-30 characters).
"^DD",798.2,798.2,4,8.5)
@
"^DD",798.2,798.2,4,9)
@
"^DD",798.2,798.2,4,21,0)
^^5^5^3020403^
"^DD",798.2,798.2,4,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.2,798.2,4,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.2,798.2,4,21,3,0)
 
"^DD",798.2,798.2,4,21,4,0)
The short description of the selection rule is 
"^DD",798.2,798.2,4,21,5,0)
used in the reports and GUI dialogs.
"^DD",798.2,798.2,4,"DEL",1,0)
I $$VADEL^RORDD(798.2,$G(DA))
"^DD",798.2,798.2,4,"DT")
3011109
"^DD",798.2,798.2,5,0)
DESCRIPTION^798.25^^3;0
"^DD",798.2,798.2,5,21,0)
^^3^3^3020403^
"^DD",798.2,798.2,5,21,1,0)
You can enter any additional reference information
"^DD",798.2,798.2,5,21,2,0)
related to the selection rule. The content of this
"^DD",798.2,798.2,5,21,3,0)
field is not used by the application.
"^DD",798.2,798.2,6,0)
DATA ELEMENT^798.26^^4;0
"^DD",798.2,798.2,6,9)
@
"^DD",798.2,798.2,6,21,0)
^.001^12^12^3060203^^
"^DD",798.2,798.2,6,21,1,0)
The DATA ELEMENT multiple contains a list of 
"^DD",798.2,798.2,6,21,2,0)
additional data elements to load. 
"^DD",798.2,798.2,6,21,3,0)
 
"^DD",798.2,798.2,6,21,4,0)
Values of all the data elements referenced in the
"^DD",798.2,798.2,6,21,5,0)
selection rule expression are loaded
"^DD",798.2,798.2,6,21,6,0)
automatically.
"^DD",798.2,798.2,6,21,7,0)
 
"^DD",798.2,798.2,6,21,8,0)
However, if the rule is implemented by an external
"^DD",798.2,798.2,6,21,9,0)
function, you can enter the codes of all necessary
"^DD",798.2,798.2,6,21,10,0)
data elements into this multiple. Their values
"^DD",798.2,798.2,6,21,11,0)
will be loaded automatically and will be
"^DD",798.2,798.2,6,21,12,0)
accessible in the function.
"^DD",798.2,798.2,6,"DT")
3020326
"^DD",798.2,798.25,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",798.2,798.25,0,"NM","DESCRIPTION")

"^DD",798.2,798.25,0,"UP")
798.2
"^DD",798.2,798.25,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",798.2,798.25,.01,"DT")
3000313
"^DD",798.2,798.26,0)
DATA ELEMENT SUB-FIELD^^1^2
"^DD",798.2,798.26,0,"DT")
3020326
"^DD",798.2,798.26,0,"NM","DATA ELEMENT")

"^DD",798.2,798.26,0,"UP")
798.2
"^DD",798.2,798.26,.01,0)
ELEMENT CODE^MNJ9,0X^^0;1^Q:$$VAEDT^RORDD(798.2,$G(DA(1)))  K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.2,798.26,.01,1,0)
^.1^^0
"^DD",798.2,798.26,.01,3)
Type a Number between 1 and 999999999, 0 Decimal Digits.
"^DD",798.2,798.26,.01,8.5)
@
"^DD",798.2,798.26,.01,9)
@
"^DD",798.2,798.26,.01,21,0)
^^8^8^3020328^
"^DD",798.2,798.26,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.2,798.26,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.2,798.26,.01,21,3,0)
 
"^DD",798.2,798.26,.01,21,4,0)
Enter the code of the data element that should be 
"^DD",798.2,798.26,.01,21,5,0)
loaded before evaluation of the expression. Values
"^DD",798.2,798.26,.01,21,6,0)
of all data elements referenced in the selection
"^DD",798.2,798.26,.01,21,7,0)
rule expression are loaded automatically (you do
"^DD",798.2,798.26,.01,21,8,0)
not need to enter them here).
"^DD",798.2,798.26,.01,"DEL",1,0)
I $$VADEL^RORDD(798.2,$G(DA(1)))
"^DD",798.2,798.26,.01,"DT")
3020326
"^DD",798.2,798.26,1,0)
VALUE TYPE^RSX^E:External;I:Internal;EI:Both;^0;2^Q:$$VAEDT^RORDD(798.2,$G(DA(1)))
"^DD",798.2,798.26,1,8.5)
@
"^DD",798.2,798.26,1,9)
@
"^DD",798.2,798.26,1,21,0)
^^3^3^3020328^
"^DD",798.2,798.26,1,21,1,0)
This field holds required value type(s) of the
"^DD",798.2,798.26,1,21,2,0)
data element. The type(s) must be supported by the
"^DD",798.2,798.26,1,21,3,0)
search engine.
"^DD",798.2,798.26,1,"DT")
3020311
"^DD",798.3,798.3,0)
FIELD^^2^3
"^DD",798.3,798.3,0,"DDA")
N
"^DD",798.3,798.3,0,"DT")
3030606
"^DD",798.3,798.3,0,"IX","AT",798.32,.01)

"^DD",798.3,798.3,0,"IX","B",798.3,.01)

"^DD",798.3,798.3,0,"NM","ROR PATIENT EVENTS")

"^DD",798.3,798.3,0,"VRPK")
ROR
"^DD",798.3,798.3,0,"VRRV")
1.1^ROR*1*5
"^DD",798.3,798.3,.01,0)
PATIENT NAME^RP2'X^DPT(^0;1^S:$D(X) DINUM=X
"^DD",798.3,798.3,.01,1,0)
^.1
"^DD",798.3,798.3,.01,1,1,0)
798.3^B
"^DD",798.3,798.3,.01,1,1,1)
S ^RORDATA(798.3,"B",$E(X,1,30),DA)=""
"^DD",798.3,798.3,.01,1,1,2)
K ^RORDATA(798.3,"B",$E(X,1,30),DA)
"^DD",798.3,798.3,.01,1,1,3)
Do not delete!
"^DD",798.3,798.3,.01,3)

"^DD",798.3,798.3,.01,8.5)
@
"^DD",798.3,798.3,.01,9)
@
"^DD",798.3,798.3,.01,21,0)
^^2^2^3020424^
"^DD",798.3,798.3,.01,21,1,0)
The PATIENT NAME field identifies the patient. You
"^DD",798.3,798.3,.01,21,2,0)
can add a patient from the PATIENT file.
"^DD",798.3,798.3,.01,"DT")
3020415
"^DD",798.3,798.3,1,0)
ERROR^798.31P^^1;0
"^DD",798.3,798.3,1,9)
@
"^DD",798.3,798.3,1,21,0)
^^44^44^3060203^
"^DD",798.3,798.3,1,21,1,0)
This multiple stores references to those
"^DD",798.3,798.3,1,21,2,0)
registries that have the patient processed with
"^DD",798.3,798.3,1,21,3,0)
errors and has not been added to the registry.
"^DD",798.3,798.3,1,21,4,0)
     
"^DD",798.3,798.3,1,21,5,0)
When the problems are fixed, the data search must 
"^DD",798.3,798.3,1,21,6,0)
start not from the date of the previous run of the
"^DD",798.3,798.3,1,21,7,0)
registry update process but from the date that 
"^DD",798.3,798.3,1,21,8,0)
was used when the problem arose. Otherwise, the
"^DD",798.3,798.3,1,21,9,0)
data in the interval between those dates will not
"^DD",798.3,798.3,1,21,10,0)
be checked and some important information may be
"^DD",798.3,798.3,1,21,11,0)
missed.
"^DD",798.3,798.3,1,21,12,0)
     
"^DD",798.3,798.3,1,21,13,0)
This date cannot be stored in the registry file 
"^DD",798.3,798.3,1,21,14,0)
(#798) because the patient has not been added to
"^DD",798.3,798.3,1,21,15,0)
the registry yet. So, the date is stored in this
"^DD",798.3,798.3,1,21,16,0)
multiple.  
"^DD",798.3,798.3,1,21,17,0)
     
"^DD",798.3,798.3,1,21,18,0)
Before the registry update process begins 
"^DD",798.3,798.3,1,21,19,0)
searching the data of the patient, it tries to
"^DD",798.3,798.3,1,21,20,0)
find a record for that patient in this multiple.
"^DD",798.3,798.3,1,21,21,0)
If it exists, the date from the record is used in
"^DD",798.3,798.3,1,21,22,0)
the search instead of regular date (from the
"^DD",798.3,798.3,1,21,23,0)
REGISTRY UPDATED UNTIL field of the REGISTRY
"^DD",798.3,798.3,1,21,24,0)
PARAMETERS file.
"^DD",798.3,798.3,1,21,25,0)
     
"^DD",798.3,798.3,1,21,26,0)
After successfully processing the patient data, 
"^DD",798.3,798.3,1,21,27,0)
the corresponding record is deleted from this
"^DD",798.3,798.3,1,21,28,0)
multiple.  
"^DD",798.3,798.3,1,21,29,0)
     
"^DD",798.3,798.3,1,21,30,0)
Records of the multiple are uniquely identified by
"^DD",798.3,798.3,1,21,31,0)
the registry IEN. The "A" primary key and the "B"
"^DD",798.3,798.3,1,21,32,0)
uniqueness index are used for this purpose.
"^DD",798.3,798.3,1,21,33,0)
 
"^DD",798.3,798.3,1,21,34,0)
Usually, records within this multiple should not
"^DD",798.3,798.3,1,21,35,0)
be edited. Its content is handled automatically by
"^DD",798.3,798.3,1,21,36,0)
entry points from the routine RORUPP01 during the
"^DD",798.3,798.3,1,21,37,0)
registry update.  
"^DD",798.3,798.3,1,21,38,0)
     
"^DD",798.3,798.3,1,21,39,0)
However, if the errors are not corrected in the 
"^DD",798.3,798.3,1,21,40,0)
predefined time frame (2 weeks at the moment),
"^DD",798.3,798.3,1,21,41,0)
patient data will not be analyzed by the 
"^DD",798.3,798.3,1,21,42,0)
subsequent registry updates until someone fixes 
"^DD",798.3,798.3,1,21,43,0)
the errors and resets the COUNTER field of the
"^DD",798.3,798.3,1,21,44,0)
patient records in this multiple.  
"^DD",798.3,798.3,2,0)
EVENT^798.32D^^2;0
"^DD",798.3,798.3,2,9)
@
"^DD",798.3,798.3,2,21,0)
^^9^9^3020424^
"^DD",798.3,798.3,2,21,1,0)
This multiple stores event references created by
"^DD",798.3,798.3,2,21,2,0)
the event protocols. The registry update uses
"^DD",798.3,798.3,2,21,3,0)
these references to speed up the processing.
"^DD",798.3,798.3,2,21,4,0)
 
"^DD",798.3,798.3,2,21,5,0)
The event references are grouped by the data areas
"^DD",798.3,798.3,2,21,6,0)
(protocols) and only one reference per associated 
"^DD",798.3,798.3,2,21,7,0)
date (the DATE field) for each data area is stored
"^DD",798.3,798.3,2,21,8,0)
at the moment. The "AD" cross-reference is used by
"^DD",798.3,798.3,2,21,9,0)
the $$ADD^RORUPP02 function for this purpose.
"^DD",798.3,798.3,2,"DT")
3020415
"^DD",798.3,798.31,0)
ERROR SUB-FIELD^^2^3
"^DD",798.3,798.31,0,"DT")
3020415
"^DD",798.3,798.31,0,"IX","AD",798.31,1)

"^DD",798.3,798.31,0,"NM","ERROR")

"^DD",798.3,798.31,0,"UP")
798.3
"^DD",798.3,798.31,.01,0)
REGISTRY^MP798.1'IX^ROR(798.1,^0;1^Q
"^DD",798.3,798.31,.01,1,0)
^.1^^0
"^DD",798.3,798.31,.01,8.5)
@
"^DD",798.3,798.31,.01,9)
@
"^DD",798.3,798.31,.01,21,0)
^.001^2^2^3020415^^
"^DD",798.3,798.31,.01,21,1,0)
The REGISTRY field identifies the registry that 
"^DD",798.3,798.31,.01,21,2,0)
the record is associated with.
"^DD",798.3,798.31,.01,"DT")
3020415
"^DD",798.3,798.31,1,0)
DATE^RD^^0;2^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",798.3,798.31,1,1,0)
^.1
"^DD",798.3,798.31,1,1,1,0)
798.31^AD
"^DD",798.3,798.31,1,1,1,1)
S ^RORDATA(798.3,DA(1),1,"AD",$E(X,1,30),DA)=""
"^DD",798.3,798.31,1,1,1,2)
K ^RORDATA(798.3,DA(1),1,"AD",$E(X,1,30),DA)
"^DD",798.3,798.31,1,1,1,3)
Do not delete!
"^DD",798.3,798.31,1,1,1,"DT")
3020415
"^DD",798.3,798.31,1,8.5)
@
"^DD",798.3,798.31,1,9)
@
"^DD",798.3,798.31,1,21,0)
^^5^5^3020424^
"^DD",798.3,798.31,1,21,1,0)
The field holds the date that was used as the 
"^DD",798.3,798.31,1,21,2,0)
start date of the data search when problems arose
"^DD",798.3,798.31,1,21,3,0)
during the processing of patient data. After the
"^DD",798.3,798.31,1,21,4,0)
problems are fixed, the next data search will
"^DD",798.3,798.31,1,21,5,0)
start from this date (minus lag days).
"^DD",798.3,798.31,1,23,0)
^.001^4^4^3020424^^^
"^DD",798.3,798.31,1,23,1,0)
The value of this field is used instead of the regular
"^DD",798.3,798.31,1,23,2,0)
start date from the REGISTRY UPDATED UNTIL field of the
"^DD",798.3,798.31,1,23,3,0)
REGISTRY PARAMETERS file during the search for patient
"^DD",798.3,798.31,1,23,4,0)
data.
"^DD",798.3,798.31,1,"DT")
3020415
"^DD",798.3,798.31,2,0)
COUNTER^NJ2,0^^0;3^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.3,798.31,2,3)
Type a Number between 1 and 99, 0 Decimal Digits.
"^DD",798.3,798.31,2,21,0)
^.001^10^10^3060203^^
"^DD",798.3,798.31,2,21,1,0)
When a patient is added to the ROR PATIENT EVENTS
"^DD",798.3,798.31,2,21,2,0)
file (due to errors during the registry update),
"^DD",798.3,798.31,2,21,3,0)
this field is populated with 1.
"^DD",798.3,798.31,2,21,4,0)
 
"^DD",798.3,798.31,2,21,5,0)
Until someone fixes the error(s), every subsequent
"^DD",798.3,798.31,2,21,6,0)
registry update will increment a value of this 
"^DD",798.3,798.31,2,21,7,0)
field by 1. When it reaches a predefined threshold
"^DD",798.3,798.31,2,21,8,0)
value, the registry updates will skip this patient
"^DD",798.3,798.31,2,21,9,0)
until someone fixes the error(s) and resets this
"^DD",798.3,798.31,2,21,10,0)
field to 1.
"^DD",798.3,798.31,2,23,0)
^.001^10^10^3060203^^
"^DD",798.3,798.31,2,23,1,0)
The $$ADD^RORUPP01 function initializes this field with
"^DD",798.3,798.31,2,23,2,0)
1 when the record is created. Then it increments its
"^DD",798.3,798.31,2,23,3,0)
value each time the record is updated until the
"^DD",798.3,798.31,2,23,4,0)
field value becomes not less than a value of the local
"^DD",798.3,798.31,2,23,5,0)
RORUPD(MAXPPCNT") node (or 14 by default).
"^DD",798.3,798.31,2,23,6,0)
 
"^DD",798.3,798.31,2,23,7,0)
The function $$SDSDATE^RORUPP01 analyzes the value of
"^DD",798.3,798.31,2,23,8,0)
the field and returns an error if the counters
"^DD",798.3,798.31,2,23,9,0)
associated with all processed registries have reached
"^DD",798.3,798.31,2,23,10,0)
the threshold.
"^DD",798.3,798.31,2,"DT")
3020415
"^DD",798.3,798.32,0)
EVENT SUB-FIELD^^2^3
"^DD",798.3,798.32,0,"DT")
3030606
"^DD",798.3,798.32,0,"IX","B",798.32,.01)

"^DD",798.3,798.32,0,"NM","EVENT")

"^DD",798.3,798.32,0,"UP")
798.3
"^DD",798.3,798.32,.01,0)
TIMESTAMP^MD^^0;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",798.3,798.32,.01,1,0)
^.1
"^DD",798.3,798.32,.01,1,1,0)
798.32^B
"^DD",798.3,798.32,.01,1,1,1)
S ^RORDATA(798.3,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",798.3,798.32,.01,1,1,2)
K ^RORDATA(798.3,DA(1),2,"B",$E(X,1,30),DA)
"^DD",798.3,798.32,.01,1,1,3)
Do not delete!
"^DD",798.3,798.32,.01,1,2,0)
798.3^AT
"^DD",798.3,798.32,.01,1,2,1)
S ^RORDATA(798.3,"AT",$E(X,1,30),DA(1),DA)=""
"^DD",798.3,798.32,.01,1,2,2)
K ^RORDATA(798.3,"AT",$E(X,1,30),DA(1),DA)
"^DD",798.3,798.32,.01,1,2,3)
Do not delete!
"^DD",798.3,798.32,.01,1,2,"%D",0)
^^3^3^3020424^
"^DD",798.3,798.32,.01,1,2,"%D",1,0)
This cross-reference is used by the 
"^DD",798.3,798.32,.01,1,2,"%D",2,0)
$$PURGE^RORUPP02 function to purge the old event 
"^DD",798.3,798.32,.01,1,2,"%D",3,0)
references.
"^DD",798.3,798.32,.01,1,2,"DT")
3020419
"^DD",798.3,798.32,.01,8.5)
@
"^DD",798.3,798.32,.01,9)
@
"^DD",798.3,798.32,.01,21,0)
^.001^3^3^3020502^^
"^DD",798.3,798.32,.01,21,1,0)
This field stores the timestamp of the event
"^DD",798.3,798.32,.01,21,2,0)
reference (the current date and time when the
"^DD",798.3,798.32,.01,21,3,0)
reference was created).
"^DD",798.3,798.32,.01,"DT")
3020502
"^DD",798.3,798.32,1,0)
DATA AREA^RP799.33'^ROR(799.33,^0;2^Q
"^DD",798.3,798.32,1,3)

"^DD",798.3,798.32,1,8.5)
@
"^DD",798.3,798.32,1,9)
@
"^DD",798.3,798.32,1,21,0)
^^3^3^3060203^
"^DD",798.3,798.32,1,21,1,0)
Internal value of this field is the code defining
"^DD",798.3,798.32,1,21,2,0)
the data area (protocol) that this event reference
"^DD",798.3,798.32,1,21,3,0)
is associated with.
"^DD",798.3,798.32,1,23,0)
^.001^6^6^3060203^^^
"^DD",798.3,798.32,1,23,1,0)
The codes are associated with the event protocols as
"^DD",798.3,798.32,1,23,2,0)
follow:
"^DD",798.3,798.32,1,23,3,0)
 
"^DD",798.3,798.32,1,23,4,0)
 1 - ROR EVENT LAB (LR7O ALL EVSEND RESULTS)
"^DD",798.3,798.32,1,23,5,0)
 2 - ROR EVENT VISIT (PXK VISIT DATA EVENT)
"^DD",798.3,798.32,1,23,6,0)
 3 - ROR EVENT PTF (DGPM MOVEMENT EVENTS)
"^DD",798.3,798.32,1,"DT")
3030606
"^DD",798.3,798.32,2,0)
DATE^D^^0;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",798.3,798.32,2,1,0)
^.1^^0
"^DD",798.3,798.32,2,8.5)
@
"^DD",798.3,798.32,2,9)
@
"^DD",798.3,798.32,2,21,0)
^.001^3^3^3020424^^
"^DD",798.3,798.32,2,21,1,0)
This field stores the date and time associated
"^DD",798.3,798.32,2,21,2,0)
with the event. For example, collection date/time
"^DD",798.3,798.32,2,21,3,0)
of the specimen is stored here for the Lab event.
"^DD",798.3,798.32,2,"DT")
3020419
"^DD",798.4,798.4,0)
FIELD^^991^14
"^DD",798.4,798.4,0,"DDA")
N
"^DD",798.4,798.4,0,"DT")
3021101
"^DD",798.4,798.4,0,"IX","B",798.4,.01)

"^DD",798.4,798.4,0,"IX","BS",798.4,.09)

"^DD",798.4,798.4,0,"IX","BS5",798.4,.09)

"^DD",798.4,798.4,0,"IX","SSN",798.4,.09)

"^DD",798.4,798.4,0,"NM","ROR PATIENT")

"^DD",798.4,798.4,0,"PT",798,.01)

"^DD",798.4,798.4,0,"PT",799.641,.01)

"^DD",798.4,798.4,0,"SCR")
I $$ACCESS^RORDD(798.4)
"^DD",798.4,798.4,0,"VRPK")
ROR
"^DD",798.4,798.4,.01,0)
PATIENT NAME^RP2'X^DPT(^0;1^S:$D(X) DINUM=X
"^DD",798.4,798.4,.01,1,0)
^.1
"^DD",798.4,798.4,.01,1,1,0)
798.4^B
"^DD",798.4,798.4,.01,1,1,1)
S ^RORDATA(798.4,"B",$E(X,1,30),DA)=""
"^DD",798.4,798.4,.01,1,1,2)
K ^RORDATA(798.4,"B",$E(X,1,30),DA)
"^DD",798.4,798.4,.01,1,1,3)
Do not delete!
"^DD",798.4,798.4,.01,1,1,"DT")
3000523
"^DD",798.4,798.4,.01,3)

"^DD",798.4,798.4,.01,8.5)
@
"^DD",798.4,798.4,.01,9)
@
"^DD",798.4,798.4,.01,21,0)
^^5^5^3020802^
"^DD",798.4,798.4,.01,21,1,0)
You can select an existing patient or add a new 
"^DD",798.4,798.4,.01,21,2,0)
one from the PATIENT file (#2).
"^DD",798.4,798.4,.01,21,3,0)
 
"^DD",798.4,798.4,.01,21,4,0)
You can access records of this file only if you
"^DD",798.4,798.4,.01,21,5,0)
have appropriate security key(s) for any registry.
"^DD",798.4,798.4,.01,23,0)
^.001^4^4^3020802^^^
"^DD",798.4,798.4,.01,23,1,0)
The PATIENT NAME field points to the patient record in 
"^DD",798.4,798.4,.01,23,2,0)
the PATIENT file (#2). Internal value of this field is
"^DD",798.4,798.4,.01,23,3,0)
used as internal entry number of the record ("DINUM"
"^DD",798.4,798.4,.01,23,4,0)
feature).
"^DD",798.4,798.4,.01,"DEL",1,0)
I $D(^RORDATA(798,"B",+$G(DA)))
"^DD",798.4,798.4,.01,"DT")
3000523
"^DD",798.4,798.4,.02,0)
SEX^SI^M:MALE;F:FEMALE;^1;3^Q
"^DD",798.4,798.4,.02,20,0)
^.3LA^1^1
"^DD",798.4,798.4,.02,20,1,0)
DEMOGRAPHIC DATA
"^DD",798.4,798.4,.02,21,0)
^.001^1^1^3021106^^^^
"^DD",798.4,798.4,.02,21,1,0)
Do not edit this field!
"^DD",798.4,798.4,.02,23,0)
^.001^1^1^3021106^^^
"^DD",798.4,798.4,.02,23,1,0)
See the corresponding field in the PATIENT file (#2).
"^DD",798.4,798.4,.02,"DT")
3011120
"^DD",798.4,798.4,.03,0)
DATE OF BIRTH^RDOI^^1;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",798.4,798.4,.03,2)
S Y(0)=Y S Y(0)=Y S X=Y(0) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) S Y=X
"^DD",798.4,798.4,.03,2.1)
S Y(0)=Y S X=Y(0) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) S Y=X
"^DD",798.4,798.4,.03,20,0)
^.3LA^1^1
"^DD",798.4,798.4,.03,20,1,0)
DEMOGRAPHIC DATA
"^DD",798.4,798.4,.03,21,0)
^.001^1^1^3021106^^^^
"^DD",798.4,798.4,.03,21,1,0)
Do not edit this field!
"^DD",798.4,798.4,.03,23,0)
^.001^1^1^3021106^^^^
"^DD",798.4,798.4,.03,23,1,0)
See the corresponding field in the PATIENT file (#2).
"^DD",798.4,798.4,.03,"DT")
3011120
"^DD",798.4,798.4,.09,0)
SOCIAL SECURITY NUMBER^RFOI^^1;1^K:$L(X)>11!($L(X)<9) X
"^DD",798.4,798.4,.09,1,0)
^.1
"^DD",798.4,798.4,.09,1,1,0)
798.4^BS^MUMPS
"^DD",798.4,798.4,.09,1,1,1)
S ^RORDATA(798.4,"BS",$E(X,6,9),DA)=""
"^DD",798.4,798.4,.09,1,1,2)
K ^RORDATA(798.4,"BS",$E(X,6,9),DA)
"^DD",798.4,798.4,.09,1,1,3)
Do not delete!
"^DD",798.4,798.4,.09,1,1,"%D",0)
^.101^1^1^3011220^^
"^DD",798.4,798.4,.09,1,1,"%D",1,0)
The cross-reference on the last four digits of the SSN.
"^DD",798.4,798.4,.09,1,1,"DT")
3000426
"^DD",798.4,798.4,.09,1,2,0)
798.4^BS5^MUMPS
"^DD",798.4,798.4,.09,1,2,1)
S ^RORDATA(798.4,"BS5",$E(^DPT(DA,0),1)_$E(X,6,9),DA)=""
"^DD",798.4,798.4,.09,1,2,2)
K ^RORDATA(798.4,"BS5",$E(^DPT(DA,0),1)_$E(X,6,9),DA)
"^DD",798.4,798.4,.09,1,2,3)
Do not delete!
"^DD",798.4,798.4,.09,1,2,"%D",0)
^^3^3^3020403^
"^DD",798.4,798.4,.09,1,2,"%D",1,0)
This cross-reference contains values combined from
"^DD",798.4,798.4,.09,1,2,"%D",2,0)
the first letter of the last name and last four
"^DD",798.4,798.4,.09,1,2,"%D",3,0)
digits of the SSN.
"^DD",798.4,798.4,.09,1,2,"DT")
3011220
"^DD",798.4,798.4,.09,1,3,0)
798.4^SSN
"^DD",798.4,798.4,.09,1,3,1)
S ^RORDATA(798.4,"SSN",$E(X,1,30),DA)=""
"^DD",798.4,798.4,.09,1,3,2)
K ^RORDATA(798.4,"SSN",$E(X,1,30),DA)
"^DD",798.4,798.4,.09,1,3,3)
Do not delete!
"^DD",798.4,798.4,.09,1,3,"DT")
3011221
"^DD",798.4,798.4,.09,2)
S Y(0)=Y S:$L(Y)=11 Y=$E(Y,10,11)_$E(Y,1,9)
"^DD",798.4,798.4,.09,2.1)
S:$L(Y)=11 Y=$E(Y,10,11)_$E(Y,1,9)
"^DD",798.4,798.4,.09,3)
Answer must be 9-11 characters in length.
"^DD",798.4,798.4,.09,20,0)
^.3LA^1^1
"^DD",798.4,798.4,.09,20,1,0)
DEMOGRAPHIC DATA
"^DD",798.4,798.4,.09,21,0)
^.001^1^1^3021106^^
"^DD",798.4,798.4,.09,21,1,0)
Do not edit this field!
"^DD",798.4,798.4,.09,23,0)
^.001^1^1^3021106^^
"^DD",798.4,798.4,.09,23,1,0)
See the corresponding field in the PATIENT file (#2).
"^DD",798.4,798.4,.09,"DT")
3020403
"^DD",798.4,798.4,.1112,0)
ZIP+4^FI^^1;8^K:$L(X)>9!($L(X)<5) X
"^DD",798.4,798.4,.1112,3)
Answer must be 5-9 characters in length.
"^DD",798.4,798.4,.1112,20,0)
^.3LA^1^1
"^DD",798.4,798.4,.1112,20,1,0)
DEMOGRAPHIC DATA
"^DD",798.4,798.4,.1112,21,0)
^.001^1^1^3021106^^
"^DD",798.4,798.4,.1112,21,1,0)
Do not edit this field!
"^DD",798.4,798.4,.1112,23,0)
^.001^1^1^3021106^^
"^DD",798.4,798.4,.1112,23,1,0)
See the corresponding field in the PATIENT file (#2).
"^DD",798.4,798.4,.1112,"DT")
3011120
"^DD",798.4,798.4,.301,0)
SERVICE CONNECTED?^RSI^Y:YES;N:NO;^1;6^Q
"^DD",798.4,798.4,.301,20,0)
^.3LA^1^1
"^DD",798.4,798.4,.301,20,1,0)
DEMOGRAPHIC DATA
"^DD",798.4,798.4,.301,21,0)
^.001^1^1^3021106^^
"^DD",798.4,798.4,.301,21,1,0)
Do not edit this field!
"^DD",798.4,798.4,.301,23,0)
^.001^1^1^3021106^^
"^DD",798.4,798.4,.301,23,1,0)
See the corresponding field in the PATIENT file (#2).
"^DD",798.4,798.4,.301,"DT")
3011120
"^DD",798.4,798.4,.302,0)
SERVICE CONNECTED PERCENTAGE^NJ3,0I^^1;7^K:+X'=X!(X>100)!(X<0)!(X?.E1"."1N.N) X
"^DD",798.4,798.4,.302,3)
Type a Number between 0 and 100, 0 Decimal Digits.
"^DD",798.4,798.4,.302,20,0)
^.3LA^1^1
"^DD",798.4,798.4,.302,20,1,0)
DEMOGRAPHIC DATA
"^DD",798.4,798.4,.302,21,0)
^.001^1^1^3060203^^^
"^DD",798.4,798.4,.302,21,1,0)
Do not edit this field!
"^DD",798.4,798.4,.302,23,0)
^.001^1^1^3060203^^^
"^DD",798.4,798.4,.302,23,1,0)
See the corresponding field in the PATIENT file (#2).
"^DD",798.4,798.4,.302,"DT")
3011120
"^DD",798.4,798.4,.323,0)
PERIOD OF SERVICE^P21'I^DIC(21,^1;5^Q
"^DD",798.4,798.4,.323,20,0)
^.3LA^1^1
"^DD",798.4,798.4,.323,20,1,0)
DEMOGRAPHIC DATA
"^DD",798.4,798.4,.323,21,0)
^.001^1^1^3021106^^
"^DD",798.4,798.4,.323,21,1,0)
Do not edit this field!
"^DD",798.4,798.4,.323,23,0)
^.001^1^1^3021106^^
"^DD",798.4,798.4,.323,23,1,0)
See the corresponding field in the PATIENT file (#2).
"^DD",798.4,798.4,.323,"DT")
3011120
"^DD",798.4,798.4,.351,0)
DATE OF DEATH^DI^^1;4^S %DT="ET" D ^%DT S X=Y K:Y<1 X
"^DD",798.4,798.4,.351,20,0)
^.3LA^1^1
"^DD",798.4,798.4,.351,20,1,0)
DEMOGRAPHIC DATA
"^DD",798.4,798.4,.351,21,0)
^.001^1^1^3021106^^^^
"^DD",798.4,798.4,.351,21,1,0)
Do not edit this field!
"^DD",798.4,798.4,.351,23,0)
^.001^1^1^3021106^^^^
"^DD",798.4,798.4,.351,23,1,0)
See the corresponding field in the PATIENT file (#2).
"^DD",798.4,798.4,.351,"DT")
3020502
"^DD",798.4,798.4,.3721,0)
RATED DISABILITIES DATA^FI^^3;E1,245^K:$L(X)>245!($L(X)<1) X
"^DD",798.4,798.4,.3721,3)
Answer must be 1-245 characters in length.
"^DD",798.4,798.4,.3721,20,0)
^.3LA^1^1
"^DD",798.4,798.4,.3721,20,1,0)
DEMOGRAPHIC DATA
"^DD",798.4,798.4,.3721,21,0)
^.001^1^1^3060106^^^
"^DD",798.4,798.4,.3721,21,1,0)
Do not edit this field!
"^DD",798.4,798.4,.3721,23,0)
^^5^5^3060106^
"^DD",798.4,798.4,.3721,23,1,0)
This field stores the CRC32 value for combined data
"^DD",798.4,798.4,.3721,23,2,0)
from the RATED DISABILITIES (VA) multiple (.3721) of
"^DD",798.4,798.4,.3721,23,3,0)
the PATIENT file (#2). This data can be used only for
"^DD",798.4,798.4,.3721,23,4,0)
comparison (by the RORUPD52 routine) to the data in the
"^DD",798.4,798.4,.3721,23,5,0)
PATIENT file!
"^DD",798.4,798.4,.3721,"DT")
3021106
"^DD",798.4,798.4,2,0)
RACE AND ETHNICITY DATA^FI^^2;E1,245^K:$L(X)>245!($L(X)<1) X
"^DD",798.4,798.4,2,3)
Answer must be 1-245 characters in length.
"^DD",798.4,798.4,2,20,0)
^.3LA^1^1
"^DD",798.4,798.4,2,20,1,0)
DEMOGRAPHIC DATA
"^DD",798.4,798.4,2,21,0)
^.001^1^1^3021106^^
"^DD",798.4,798.4,2,21,1,0)
Do not edit this field!
"^DD",798.4,798.4,2,23,0)
^^6^6^3060203^
"^DD",798.4,798.4,2,23,1,0)
This field stores the combined data from the RACE
"^DD",798.4,798.4,2,23,2,0)
INFORMATION (2) and ETHNICITY INFORMATION (6) multiples
"^DD",798.4,798.4,2,23,3,0)
of the PATIENT file (#2). This data can be used only
"^DD",798.4,798.4,2,23,4,0)
for comparison (by the RORUPD52 routine) to the data in
"^DD",798.4,798.4,2,23,5,0)
the PATIENT file. Do not try to parse values of this
"^DD",798.4,798.4,2,23,6,0)
field in any way!
"^DD",798.4,798.4,2,"DT")
3021106
"^DD",798.4,798.4,10.1,0)
OLD SSN^FI^^10;1^K:$L(X)>11!($L(X)<9) X
"^DD",798.4,798.4,10.1,3)
Answer must be 9-11 characters in length.
"^DD",798.4,798.4,10.1,20,0)
^.3LA^1^1
"^DD",798.4,798.4,10.1,20,1,0)
OLD DEMOGRAPHICS
"^DD",798.4,798.4,10.1,21,0)
^.001^1^1^3021106^^
"^DD",798.4,798.4,10.1,21,1,0)
Do not edit this field!
"^DD",798.4,798.4,10.1,23,0)
^.001^3^3^3021106^^
"^DD",798.4,798.4,10.1,23,1,0)
This field contains the previous value of the patient 
"^DD",798.4,798.4,10.1,23,2,0)
SSN. The registry extraction process transmits both new
"^DD",798.4,798.4,10.1,23,3,0)
and old values of the SSN to the national registries.
"^DD",798.4,798.4,10.1,"DT")
3011120
"^DD",798.4,798.4,10.2,0)
OLD ICN^FI^^10;2^K:$L(X)>19!($L(X)<1) X
"^DD",798.4,798.4,10.2,3)
Answer must be 1-19 characters in length.
"^DD",798.4,798.4,10.2,20,0)
^.3LA^1^1
"^DD",798.4,798.4,10.2,20,1,0)
OLD DEMOGRAPHICS
"^DD",798.4,798.4,10.2,21,0)
^.001^1^1^3021106^^^
"^DD",798.4,798.4,10.2,21,1,0)
Do not edit this field!
"^DD",798.4,798.4,10.2,23,0)
^.001^4^4^3021106^^
"^DD",798.4,798.4,10.2,23,1,0)
This field contains the previous value of the patient 
"^DD",798.4,798.4,10.2,23,2,0)
ICN (with the checksum). The registry extraction
"^DD",798.4,798.4,10.2,23,3,0)
process transmits both new and old values of the ICN to
"^DD",798.4,798.4,10.2,23,4,0)
the national registries.
"^DD",798.4,798.4,10.2,"DT")
3021101
"^DD",798.4,798.4,991,0)
INTEGRATION CONTROL NUMBER^FI^^1;9^K:$L(X)>19!($L(X)<1) X
"^DD",798.4,798.4,991,3)
Answer must be 1-19 characters in length.
"^DD",798.4,798.4,991,20,0)
^.3LA^1^1
"^DD",798.4,798.4,991,20,1,0)
DEMOGRAPHIC DATA
"^DD",798.4,798.4,991,21,0)
^.001^1^1^3021106^^^
"^DD",798.4,798.4,991,21,1,0)
Do not edit this field!
"^DD",798.4,798.4,991,23,0)
^.001^4^4^3021106^^
"^DD",798.4,798.4,991,23,1,0)
This field stores the patient's full Integration
"^DD",798.4,798.4,991,23,2,0)
Control Number (the ICN and checksum separated by the
"^DD",798.4,798.4,991,23,3,0)
"V"). See the fields 991.01 and 991.02 of the PATIENT
"^DD",798.4,798.4,991,23,4,0)
file (#2).
"^DD",798.4,798.4,991,"DT")
3021101
"^DD",798.6,798.6,0)
FIELD^^.02^2
"^DD",798.6,798.6,0,"DDA")
N
"^DD",798.6,798.6,0,"DT")
3000423
"^DD",798.6,798.6,0,"IX","AC",798.6,.02)

"^DD",798.6,798.6,0,"IX","B",798.6,.01)

"^DD",798.6,798.6,0,"NM","ROR PHARMACY CODE")

"^DD",798.6,798.6,0,"VRPK")
ROR
"^DD",798.6,798.6,.01,0)
DRUG CLASS^RP50.605'^PS(50.605,^0;1^Q
"^DD",798.6,798.6,.01,1,0)
^.1
"^DD",798.6,798.6,.01,1,1,0)
798.6^B
"^DD",798.6,798.6,.01,1,1,1)
S ^ROR(798.6,"B",$E(X,1,30),DA)=""
"^DD",798.6,798.6,.01,1,1,2)
K ^ROR(798.6,"B",$E(X,1,30),DA)
"^DD",798.6,798.6,.01,1,1,3)
Do not delete!
"^DD",798.6,798.6,.01,3)

"^DD",798.6,798.6,.01,21,0)
^^2^2^3060203^
"^DD",798.6,798.6,.01,21,1,0)
Select a drug class from the VA DRUG CLASS FILE 
"^DD",798.6,798.6,.01,21,2,0)
(#50.605).
"^DD",798.6,798.6,.01,"DT")
3000423
"^DD",798.6,798.6,.02,0)
REGISTRY^RP798.1'^ROR(798.1,^0;2^Q
"^DD",798.6,798.6,.02,1,0)
^.1
"^DD",798.6,798.6,.02,1,1,0)
798.6^AC
"^DD",798.6,798.6,.02,1,1,1)
S ^ROR(798.6,"AC",$E(X,1,30),DA)=""
"^DD",798.6,798.6,.02,1,1,2)
K ^ROR(798.6,"AC",$E(X,1,30),DA)
"^DD",798.6,798.6,.02,1,1,3)
Do not delete!
"^DD",798.6,798.6,.02,1,1,"%D",0)
^^2^2^3011120^
"^DD",798.6,798.6,.02,1,1,"%D",1,0)
This cross-reference links all drug classes
"^DD",798.6,798.6,.02,1,1,"%D",2,0)
associated with the registry together.
"^DD",798.6,798.6,.02,1,1,"DT")
3010803
"^DD",798.6,798.6,.02,21,0)
^^2^2^3020403^
"^DD",798.6,798.6,.02,21,1,0)
The REGISTRY field identifies the registry that 
"^DD",798.6,798.6,.02,21,2,0)
the record belongs to.
"^DD",798.6,798.6,.02,23,0)
^^3^3^3020403^
"^DD",798.6,798.6,.02,23,1,0)
Traditional cross-reference "AC" is used to link 
"^DD",798.6,798.6,.02,23,2,0)
all drug classes associated with the the registry
"^DD",798.6,798.6,.02,23,3,0)
together.
"^DD",798.6,798.6,.02,"DT")
3010803
"^DD",798.7,798.7,0)
FIELD^^8^11
"^DD",798.7,798.7,0,"DDA")
N
"^DD",798.7,798.7,0,"DT")
3051104
"^DD",798.7,798.7,0,"IX","B",798.7,.01)

"^DD",798.7,798.7,0,"IX","C",798.7,2)

"^DD",798.7,798.7,0,"NM","ROR LOG")

"^DD",798.7,798.7,0,"PT",798.8,2.03)

"^DD",798.7,798.7,0,"SCR")
I $$ACCESS^RORDD(798.7)
"^DD",798.7,798.7,0,"VRPK")
ROR
"^DD",798.7,798.7,.01,0)
START DATE/TIME^RDI^^0;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",798.7,798.7,.01,1,0)
^.1
"^DD",798.7,798.7,.01,1,1,0)
798.7^B
"^DD",798.7,798.7,.01,1,1,1)
S ^RORDATA(798.7,"B",$E(X,1,30),DA)=""
"^DD",798.7,798.7,.01,1,1,2)
K ^RORDATA(798.7,"B",$E(X,1,30),DA)
"^DD",798.7,798.7,.01,1,1,3)
Do not delete!
"^DD",798.7,798.7,.01,3)

"^DD",798.7,798.7,.01,21,0)
^^5^5^3021101^
"^DD",798.7,798.7,.01,21,1,0)
This field contains the date/time when this log 
"^DD",798.7,798.7,.01,21,2,0)
was created.
"^DD",798.7,798.7,.01,21,3,0)
 
"^DD",798.7,798.7,.01,21,4,0)
You can access records of this file only if you
"^DD",798.7,798.7,.01,21,5,0)
have appropriate security key(s) for any registry.
"^DD",798.7,798.7,.01,23,0)
^.001^2^2^3021101^^
"^DD",798.7,798.7,.01,23,1,0)
The $$OPEN^RORLOG function populates this field
"^DD",798.7,798.7,.01,23,2,0)
automatically when a new log is created.
"^DD",798.7,798.7,.01,"DEL",1,0)
I $D(^RORDATA(798.7,"AREF",+$G(DA)))
"^DD",798.7,798.7,.01,"DT")
3010807
"^DD",798.7,798.7,1,0)
ACTIVITY^S^0:Other;1:Registry Update;2:Data Extraction;3:Acknowledgement;4:Hist. Extraction;5:Report;6:Access Violation;7:ROR TASK;8:Registry Setup;^0;3^Q
"^DD",798.7,798.7,1,21,0)
^.001^2^2^3030121^^
"^DD",798.7,798.7,1,21,1,0)
The value of this field indicates the activity
"^DD",798.7,798.7,1,21,2,0)
performed by the process that created the log.
"^DD",798.7,798.7,1,23,0)
^.001^2^2^3030121^^
"^DD",798.7,798.7,1,23,1,0)
This field is populated by the $$OPEN^RORLOG function 
"^DD",798.7,798.7,1,23,2,0)
with the value passed as one of the parameters.
"^DD",798.7,798.7,1,"DT")
3050721
"^DD",798.7,798.7,2,0)
JOB NUMBER^NJ12,0^^0;4^K:+X'=X!(X>999999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.7,798.7,2,1,0)
^.1
"^DD",798.7,798.7,2,1,1,0)
798.7^C
"^DD",798.7,798.7,2,1,1,1)
S ^RORDATA(798.7,"C",$E(X,1,30),DA)=""
"^DD",798.7,798.7,2,1,1,2)
K ^RORDATA(798.7,"C",$E(X,1,30),DA)
"^DD",798.7,798.7,2,1,1,3)
Do not delete!
"^DD",798.7,798.7,2,1,1,"%D",0)
^^3^3^3011011^
"^DD",798.7,798.7,2,1,1,"%D",1,0)
This cross-reference can be used in the 
"^DD",798.7,798.7,2,1,1,"%D",2,0)
troubleshooting process to find the log by the job
"^DD",798.7,798.7,2,1,1,"%D",3,0)
number.
"^DD",798.7,798.7,2,1,1,"DT")
3010813
"^DD",798.7,798.7,2,3)
Enter a job number between 1 and 999999999999, 0 Decimal Digits.
"^DD",798.7,798.7,2,21,0)
^^2^2^3020403^
"^DD",798.7,798.7,2,21,1,0)
Value of the JOB NUMBER field is the job number 
"^DD",798.7,798.7,2,21,2,0)
($JOB) of the process that has created this log.
"^DD",798.7,798.7,2,23,0)
^^2^2^3020403^
"^DD",798.7,798.7,2,23,1,0)
This field is populated automatically by the 
"^DD",798.7,798.7,2,23,2,0)
$$OPEN^RORLOG function.
"^DD",798.7,798.7,2,"DT")
3010813
"^DD",798.7,798.7,3,0)
REGISTRY^798.73P^^1;0
"^DD",798.7,798.7,3,21,0)
^^8^8^3020403^
"^DD",798.7,798.7,3,21,1,0)
This multiple contains a list of the registries 
"^DD",798.7,798.7,3,21,2,0)
that were processed. Events recorded in the log
"^DD",798.7,798.7,3,21,3,0)
are associated with these registries.
"^DD",798.7,798.7,3,21,4,0)
 
"^DD",798.7,798.7,3,21,5,0)
Records of this multiple are indexed by the "ARD"
"^DD",798.7,798.7,3,21,6,0)
index (whole file). So, it is possible to get a
"^DD",798.7,798.7,3,21,7,0)
list of log files associated with the particular
"^DD",798.7,798.7,3,21,8,0)
registry.
"^DD",798.7,798.7,4,0)
MESSAGE^798.74D^^2;0
"^DD",798.7,798.7,4,21,0)
^^2^2^3020403^
"^DD",798.7,798.7,4,21,1,0)
This multiple contains all messages recorded in 
"^DD",798.7,798.7,4,21,2,0)
the log.
"^DD",798.7,798.7,4,23,0)
^^4^4^3060203^
"^DD",798.7,798.7,4,23,1,0)
Every call of the LOG^RORLOG procedure adds a new 
"^DD",798.7,798.7,4,23,2,0)
record to this multiple. The $$OPEN^RORLOG and 
"^DD",798.7,798.7,4,23,3,0)
CLOSE^RORLOG entry points can also call the LOG^RORLOG
"^DD",798.7,798.7,4,23,4,0)
automatically to add a header and footer to the log.
"^DD",798.7,798.7,5,0)
END DATE/TIME^D^^0;2^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",798.7,798.7,5,21,0)
^^2^2^3020403^
"^DD",798.7,798.7,5,21,1,0)
This field contains the date/time when the 
"^DD",798.7,798.7,5,21,2,0)
log was closed.
"^DD",798.7,798.7,5,23,0)
^^2^2^3020403^
"^DD",798.7,798.7,5,23,1,0)
The CLOSE^RORLOG procedure populates this field
"^DD",798.7,798.7,5,23,2,0)
automatically when the log is closed.
"^DD",798.7,798.7,5,"DT")
3010807
"^DD",798.7,798.7,6.01,0)
PROCESSED PATIENTS^NJ12,0^^0;5^K:+X'=X!(X>999999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",798.7,798.7,6.01,3)
Type a Number between 0 and 999999999999, 0 Decimal Digits.
"^DD",798.7,798.7,6.01,21,0)
^.001^2^2^3011011^^
"^DD",798.7,798.7,6.01,21,1,0)
The value of this field indicates the number of 
"^DD",798.7,798.7,6.01,21,2,0)
processed patients.
"^DD",798.7,798.7,6.01,23,0)
^.001^2^2^3020403^^
"^DD",798.7,798.7,6.01,23,1,0)
The value of this field is also duplicated in the last
"^DD",798.7,798.7,6.01,23,2,0)
message of the log (footer).
"^DD",798.7,798.7,6.01,"DT")
3010807
"^DD",798.7,798.7,6.02,0)
PATIENTS WITH ERRORS^NJ12,0^^0;6^K:+X'=X!(X>999999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",798.7,798.7,6.02,3)
Type a Number between 0 and 999999999999, 0 Decimal Digits.
"^DD",798.7,798.7,6.02,21,0)
^^2^2^3011011^
"^DD",798.7,798.7,6.02,21,1,0)
The value of this field indicates the number of 
"^DD",798.7,798.7,6.02,21,2,0)
patients processed with errors.
"^DD",798.7,798.7,6.02,23,0)
^.001^2^2^3020403^^
"^DD",798.7,798.7,6.02,23,1,0)
The value of this field is also duplicated in the last
"^DD",798.7,798.7,6.02,23,2,0)
message of the log (footer).
"^DD",798.7,798.7,6.02,"DT")
3010807
"^DD",798.7,798.7,6.03,0)
RATE^NJ16,3^^0;7^K:+X'=X!(X>999999999999)!(X<0)!(X?.E1"."4N.N) X
"^DD",798.7,798.7,6.03,3)
Type a Number between 0 and 999999999999, 3 Decimal Digits.
"^DD",798.7,798.7,6.03,21,0)
^^2^2^3011011^
"^DD",798.7,798.7,6.03,21,1,0)
The value of this field indicates the rate of 
"^DD",798.7,798.7,6.03,21,2,0)
patient processing (patients per second).
"^DD",798.7,798.7,6.03,23,0)
^.001^2^2^3020403^^
"^DD",798.7,798.7,6.03,23,1,0)
The value of this field is also duplicated in the last
"^DD",798.7,798.7,6.03,23,2,0)
message of the log (footer).
"^DD",798.7,798.7,6.03,"DT")
3010807
"^DD",798.7,798.7,7,0)
USER^P200'I^VA(200,^0;8^Q
"^DD",798.7,798.7,7,8.5)
@
"^DD",798.7,798.7,7,9)
@
"^DD",798.7,798.7,7,10)
The user's DUZ
"^DD",798.7,798.7,7,21,0)
^^3^3^3030219^
"^DD",798.7,798.7,7,21,1,0)
The USER field points to the VistA user associated
"^DD",798.7,798.7,7,21,2,0)
with the log (its internal value is the DUZ at the
"^DD",798.7,798.7,7,21,3,0)
moment when the log was created).
"^DD",798.7,798.7,7,"DT")
3030203
"^DD",798.7,798.7,8,0)
TASK NUMBER^NJ10,0^^0;9^K:+X'=X!(X>9899999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.7,798.7,8,3)
Enter a task number between 1 and 9899999999, 0 Decimal Digits.
"^DD",798.7,798.7,8,8.5)
@
"^DD",798.7,798.7,8,9)
@
"^DD",798.7,798.7,8,21,0)
^^3^3^3060106^
"^DD",798.7,798.7,8,21,1,0)
This field stores the number of the task that 
"^DD",798.7,798.7,8,21,2,0)
created the log. If the log is created from a 
"^DD",798.7,798.7,8,21,3,0)
foreground job, this field will be empty.
"^DD",798.7,798.7,8,"DT")
3051104
"^DD",798.7,798.73,0)
REGISTRY SUB-FIELD^^.01^1
"^DD",798.7,798.73,0,"DT")
3010807
"^DD",798.7,798.73,0,"IX","B",798.73,.01)

"^DD",798.7,798.73,0,"NM","REGISTRY")

"^DD",798.7,798.73,0,"UP")
798.7
"^DD",798.7,798.73,.01,0)
REGISTRY^MP798.1'X^ROR(798.1,^0;1^S:$D(X) DINUM=X
"^DD",798.7,798.73,.01,1,0)
^.1^^-1
"^DD",798.7,798.73,.01,1,1,0)
798.73^B
"^DD",798.7,798.73,.01,1,1,1)
S ^RORDATA(798.7,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",798.7,798.73,.01,1,1,2)
K ^RORDATA(798.7,DA(1),1,"B",$E(X,1,30),DA)
"^DD",798.7,798.73,.01,1,1,3)
Do not delete!
"^DD",798.7,798.73,.01,21,0)
^^4^4^3020403^
"^DD",798.7,798.73,.01,21,1,0)
The value of this field is a pointer to a record 
"^DD",798.7,798.73,.01,21,2,0)
of the ROR REGISTRY PARAMETERS file. The registry
"^DD",798.7,798.73,.01,21,3,0)
represented by that record was processed by the
"^DD",798.7,798.73,.01,21,4,0)
job that created this log.
"^DD",798.7,798.73,.01,"DT")
3010906
"^DD",798.7,798.74,0)
MESSAGE SUB-FIELD^^4^5
"^DD",798.7,798.74,0,"DT")
3011109
"^DD",798.7,798.74,0,"IX","B",798.74,.01)

"^DD",798.7,798.74,0,"NM","MESSAGE")

"^DD",798.7,798.74,0,"UP")
798.7
"^DD",798.7,798.74,.01,0)
DATE/TIME^MD^^0;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",798.7,798.74,.01,1,0)
^.1
"^DD",798.7,798.74,.01,1,1,0)
798.74^B
"^DD",798.7,798.74,.01,1,1,1)
S ^RORDATA(798.7,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",798.7,798.74,.01,1,1,2)
K ^RORDATA(798.7,DA(1),2,"B",$E(X,1,30),DA)
"^DD",798.7,798.74,.01,1,1,3)
Do not delete!
"^DD",798.7,798.74,.01,21,0)
^^2^2^3011011^
"^DD",798.7,798.74,.01,21,1,0)
This field contains the date/time of the recorded
"^DD",798.7,798.74,.01,21,2,0)
event.
"^DD",798.7,798.74,.01,23,0)
^^2^2^3020403^
"^DD",798.7,798.74,.01,23,1,0)
The field is populated automatically by the LOG^RORLOG 
"^DD",798.7,798.74,.01,23,2,0)
procedure with the current date and time.
"^DD",798.7,798.74,.01,"DT")
3010807
"^DD",798.7,798.74,1,0)
TYPE^RS^1:Debug;2:Information;3:Data Quality;4:Warning;5:Database Error;6:Error;^0;2^Q
"^DD",798.7,798.74,1,21,0)
^^6^6^3050722^
"^DD",798.7,798.74,1,21,1,0)
The value of this field indicates the type of the
"^DD",798.7,798.74,1,21,2,0)
recorded event.
"^DD",798.7,798.74,1,21,3,0)
 
"^DD",798.7,798.74,1,21,4,0)
You can control which events are recorded and 
"^DD",798.7,798.74,1,21,5,0)
which are not via the LOG EVENT multiple of the
"^DD",798.7,798.74,1,21,6,0)
ROR REGISTRY PARAMETERS file.
"^DD",798.7,798.74,1,"DT")
3010807
"^DD",798.7,798.74,2,0)
MESSAGE^RF^^2;E1,245^K:$L(X)>70!($L(X)<1) X
"^DD",798.7,798.74,2,3)
Answer must be 1-70 characters in length.
"^DD",798.7,798.74,2,21,0)
^^2^2^3011109^
"^DD",798.7,798.74,2,21,1,0)
This field contains a text message describing the 
"^DD",798.7,798.74,2,21,2,0)
recorded event.
"^DD",798.7,798.74,2,"DT")
3011109
"^DD",798.7,798.74,3,0)
PATIENT^P2'^DPT(^0;4^Q
"^DD",798.7,798.74,3,21,0)
^^3^3^3020403^
"^DD",798.7,798.74,3,21,1,0)
If the recorded event can be associated with a 
"^DD",798.7,798.74,3,21,2,0)
particular patient, this field contains a pointer 
"^DD",798.7,798.74,3,21,3,0)
to the patient record in the PATIENT file (DFN).
"^DD",798.7,798.74,3,"DT")
3010807
"^DD",798.7,798.74,4,0)
ADDITIONAL INFO^798.744^^1;0
"^DD",798.7,798.74,4,21,0)
^.001^2^2^3011011^^^
"^DD",798.7,798.74,4,21,1,0)
This field contains any additional information 
"^DD",798.7,798.74,4,21,2,0)
describing the event.
"^DD",798.7,798.744,0)
ADDITIONAL INFO SUB-FIELD^^.01^1
"^DD",798.7,798.744,0,"DT")
3010807
"^DD",798.7,798.744,0,"NM","ADDITIONAL INFO")

"^DD",798.7,798.744,0,"UP")
798.74
"^DD",798.7,798.744,.01,0)
ADDITIONAL INFO^WL^^0;1^Q
"^DD",798.7,798.744,.01,21,0)
^^2^2^3011011^
"^DD",798.7,798.744,.01,21,1,0)
This field contains any additional information 
"^DD",798.7,798.744,.01,21,2,0)
describing the event.
"^DD",798.7,798.744,.01,"DT")
3010807
"^DD",798.8,798.8,0)
FIELD^^7^16
"^DD",798.8,798.8,0,"DDA")
N
"^DD",798.8,798.8,0,"DT")
3050217
"^DD",798.8,798.8,0,"IX","ACDT",798.8,.07)

"^DD",798.8,798.8,0,"IX","ADUMMY",798.8,.03)

"^DD",798.8,798.8,0,"IX","ALOG",798.8,2.03)

"^DD",798.8,798.8,0,"IX","B",798.8,.01)

"^DD",798.8,798.8,0,"IX","U",798.8,.08)

"^DD",798.8,798.8,0,"NM","ROR TASK")

"^DD",798.8,798.8,0,"SCR")
I $$ACCESS^RORDD(798.8)
"^DD",798.8,798.8,0,"VRPK")
ROR
"^DD",798.8,798.8,.01,0)
TASK NUMBER^RNJ10,0XI^^0;1^K:+X'=X!(X>9899999999)!(X<1)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",798.8,798.8,.01,1,0)
^.1
"^DD",798.8,798.8,.01,1,1,0)
798.8^B
"^DD",798.8,798.8,.01,1,1,1)
S ^RORDATA(798.8,"B",$E(X,1,30),DA)=""
"^DD",798.8,798.8,.01,1,1,2)
K ^RORDATA(798.8,"B",$E(X,1,30),DA)
"^DD",798.8,798.8,.01,1,1,3)
Do not delete!
"^DD",798.8,798.8,.01,1,2,0)
^^TRIGGER^798.8^.07
"^DD",798.8,798.8,.01,1,2,1)
X ^DD(798.8,.01,1,2,1.3) I X S X=DIV S Y(1)=$S($D(^RORDATA(798.8,D0,0)):^(0),1:"") S X=$P(Y(1),U,7),X=X S DIU=X K Y S X=DIV S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) X ^DD(798.8,.01,1,2,1.4)
"^DD",798.8,798.8,.01,1,2,1.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S Y(1)=$S($D(^RORDATA(798.8,D0,0)):^(0),1:"") S X=$P(Y(1),U,7)=""
"^DD",798.8,798.8,.01,1,2,1.4)
S DIH=$G(^RORDATA(798.8,DIV(0),0)),DIV=X S $P(^(0),U,7)=DIV,DIH=798.8,DIG=.07 D ^DICR
"^DD",798.8,798.8,.01,1,2,2)
Q
"^DD",798.8,798.8,.01,1,2,3)
Do not delete!
"^DD",798.8,798.8,.01,1,2,"%D",0)
^^3^3^3030502^
"^DD",798.8,798.8,.01,1,2,"%D",1,0)
This trigger populates the CREATION TIME field 
"^DD",798.8,798.8,.01,1,2,"%D",2,0)
with the current date and time when the task is
"^DD",798.8,798.8,.01,1,2,"%D",3,0)
created.
"^DD",798.8,798.8,.01,1,2,"CREATE CONDITION")
CREATION TIME=""
"^DD",798.8,798.8,.01,1,2,"CREATE VALUE")
NOW
"^DD",798.8,798.8,.01,1,2,"DELETE VALUE")
NO EFFECT
"^DD",798.8,798.8,.01,1,2,"DT")
3021109
"^DD",798.8,798.8,.01,1,2,"FIELD")
CREATION TIME
"^DD",798.8,798.8,.01,1,3,0)
^^TRIGGER^798.8^.08
"^DD",798.8,798.8,.01,1,3,1)
X ^DD(798.8,.01,1,3,1.3) I X S X=DIV S Y(1)=$S($D(^RORDATA(798.8,D0,0)):^(0),1:"") S X=$P(Y(1),U,8),X=X S DIU=X K Y X ^DD(798.8,.01,1,3,1.1) S DIH=$G(^RORDATA(798.8,DIV(0),0)),DIV=X S $P(^(0),U,8)=DIV,DIH=798.8,DIG=.08 D ^DICR
"^DD",798.8,798.8,.01,1,3,1.1)
S X=DIV X ^DD(798.8,.01,1,3,49.2) S %=$S($D(^VA(200,+DUZ,0)):^(0),1:""),X=$S('DUZ:"??",X="#":DUZ,X="N":$P(%,U,1),X="I":$P(%,U,2),X="T":$S($D(^DIC(3.1,+$P(%,U,9),0)):$P(^(0),U,1),1:""),X="NN":$S($D(^VA(200,+DUZ,.1)):$P(^(.1),U,4),1:""),1:"??") K %
"^DD",798.8,798.8,.01,1,3,1.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S Y(1)=$S($D(^RORDATA(798.8,D0,0)):^(0),1:"") S X=$S('$D(^VA(200,+$P(Y(1),U,8),0)):"",1:$P(^(0),U,1))=""
"^DD",798.8,798.8,.01,1,3,2)
Q
"^DD",798.8,798.8,.01,1,3,3)
Do not delete!
"^DD",798.8,798.8,.01,1,3,49.2)
S X="#"
"^DD",798.8,798.8,.01,1,3,"%D",0)
^^2^2^3030502^
"^DD",798.8,798.8,.01,1,3,"%D",1,0)
This trigger populates the USER field with the DUZ
"^DD",798.8,798.8,.01,1,3,"%D",2,0)
of the user who created the task.
"^DD",798.8,798.8,.01,1,3,"CREATE CONDITION")
USER=""
"^DD",798.8,798.8,.01,1,3,"CREATE VALUE")
USER("#")
"^DD",798.8,798.8,.01,1,3,"DELETE VALUE")
NO EFFECT
"^DD",798.8,798.8,.01,1,3,"DT")
3021109
"^DD",798.8,798.8,.01,1,3,"FIELD")
USER
"^DD",798.8,798.8,.01,3)
Type a Number between 1 and 9899999999, 0 Decimal Digits
"^DD",798.8,798.8,.01,8.5)
@
"^DD",798.8,798.8,.01,9)
@
"^DD",798.8,798.8,.01,21,0)
^^2^2^3030507^
"^DD",798.8,798.8,.01,21,1,0)
The TASK NUMBER field references the task created
"^DD",798.8,798.8,.01,21,2,0)
by Taskman.
"^DD",798.8,798.8,.01,23,0)
^.001^2^2^3030507^^
"^DD",798.8,798.8,.01,23,1,0)
Internal value of this field is used as the internal
"^DD",798.8,798.8,.01,23,2,0)
entry number of record ("DINUM" feature).
"^DD",798.8,798.8,.01,"DT")
3031027
"^DD",798.8,798.8,.02,0)
TYPE^RSI^1:Generic;2:Report;^0;2^Q
"^DD",798.8,798.8,.02,8.5)
@
"^DD",798.8,798.8,.02,9)
@
"^DD",798.8,798.8,.02,21,0)
^.001^1^1^3060203^^^
"^DD",798.8,798.8,.02,21,1,0)
The TYPE field indicates the type of task.
"^DD",798.8,798.8,.02,23,0)
^^1^1^3060203^
"^DD",798.8,798.8,.02,23,1,0)
Currently only 'Report' tasks are used.
"^DD",798.8,798.8,.02,"DT")
3031028
"^DD",798.8,798.8,.03,0)
REGISTRY^P798.1'I^ROR(798.1,^0;3^Q
"^DD",798.8,798.8,.03,1,0)
^.1
"^DD",798.8,798.8,.03,1,1,0)
798.8^ADUMMY^MUMPS
"^DD",798.8,798.8,.03,1,1,1)
Q
"^DD",798.8,798.8,.03,1,1,2)
Q
"^DD",798.8,798.8,.03,1,1,3)
Do not delete!
"^DD",798.8,798.8,.03,1,1,"%D",0)
^^4^4^3030507^
"^DD",798.8,798.8,.03,1,1,"%D",1,0)
This dummy cross-reference forces FileMan to flush
"^DD",798.8,798.8,.03,1,1,"%D",2,0)
data during editing a record.  This is required
"^DD",798.8,798.8,.03,1,1,"%D",3,0)
for the proper functioning of the REPORT field's
"^DD",798.8,798.8,.03,1,1,"%D",4,0)
screening logic.
"^DD",798.8,798.8,.03,1,1,"DT")
3021127
"^DD",798.8,798.8,.03,3)

"^DD",798.8,798.8,.03,8.5)
@
"^DD",798.8,798.8,.03,9)
@
"^DD",798.8,798.8,.03,21,0)
^^6^6^3030501^
"^DD",798.8,798.8,.03,21,1,0)
The REGISTRY field references the registry that 
"^DD",798.8,798.8,.03,21,2,0)
the task is associated with. 
"^DD",798.8,798.8,.03,21,3,0)
 
"^DD",798.8,798.8,.03,21,4,0)
If this field has no value then the task either
"^DD",798.8,798.8,.03,21,5,0)
works on several registries or does not affect any
"^DD",798.8,798.8,.03,21,6,0)
of them directly.
"^DD",798.8,798.8,.03,"DT")
3031028
"^DD",798.8,798.8,.04,0)
REPORT^P799.34'I^ROR(799.34,^0;4^Q
"^DD",798.8,798.8,.04,8.5)
@
"^DD",798.8,798.8,.04,9)
@
"^DD",798.8,798.8,.04,21,0)
^^3^3^3040121^
"^DD",798.8,798.8,.04,21,1,0)
The REPORT field indicates the report generated by
"^DD",798.8,798.8,.04,21,2,0)
the task.  This field has a value only if the type
"^DD",798.8,798.8,.04,21,3,0)
of task is 'Report' (see the TYPE field).
"^DD",798.8,798.8,.04,"DT")
3040121
"^DD",798.8,798.8,.05,0)
DESCRIPTION^F^^0;5^K:$L(X)>60!($L(X)<1) X
"^DD",798.8,798.8,.05,3)
Answer must be 1-60 characters in length.
"^DD",798.8,798.8,.05,8.5)
@
"^DD",798.8,798.8,.05,9)
@
"^DD",798.8,798.8,.05,21,0)
^^2^2^3060203^
"^DD",798.8,798.8,.05,21,1,0)
This field stores the description of task.  For
"^DD",798.8,798.8,.05,21,2,0)
reports, it holds the report name.
"^DD",798.8,798.8,.05,"DT")
3021107
"^DD",798.8,798.8,.07,0)
CREATION TIME^RDI^^0;7^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",798.8,798.8,.07,1,0)
^.1
"^DD",798.8,798.8,.07,1,1,0)
798.8^ACDT
"^DD",798.8,798.8,.07,1,1,1)
S ^RORDATA(798.8,"ACDT",$E(X,1,30),DA)=""
"^DD",798.8,798.8,.07,1,1,2)
K ^RORDATA(798.8,"ACDT",$E(X,1,30),DA)
"^DD",798.8,798.8,.07,1,1,3)
Do not delete!
"^DD",798.8,798.8,.07,1,1,"%D",0)
^^2^2^3060203^
"^DD",798.8,798.8,.07,1,1,"%D",1,0)
The $$PURGE^RORTSK02 function uses the ACDT
"^DD",798.8,798.8,.07,1,1,"%D",2,0)
cross-reference to find and purge old tasks.
"^DD",798.8,798.8,.07,1,1,"DT")
3030317
"^DD",798.8,798.8,.07,5,1,0)
798.8^.01^2
"^DD",798.8,798.8,.07,8.5)
@
"^DD",798.8,798.8,.07,9)
@
"^DD",798.8,798.8,.07,21,0)
^^4^4^3030502^
"^DD",798.8,798.8,.07,21,1,0)
The CREATION TIME field stores the date and time 
"^DD",798.8,798.8,.07,21,2,0)
when the task was created.  This field is
"^DD",798.8,798.8,.07,21,3,0)
populated by the trigger associated with the TASK
"^DD",798.8,798.8,.07,21,4,0)
NUMBER field.
"^DD",798.8,798.8,.07,"DT")
3030317
"^DD",798.8,798.8,.08,0)
USER^RP200'I^VA(200,^0;8^Q
"^DD",798.8,798.8,.08,1,0)
^.1
"^DD",798.8,798.8,.08,1,1,0)
798.8^U
"^DD",798.8,798.8,.08,1,1,1)
S ^RORDATA(798.8,"U",$E(X,1,30),DA)=""
"^DD",798.8,798.8,.08,1,1,2)
K ^RORDATA(798.8,"U",$E(X,1,30),DA)
"^DD",798.8,798.8,.08,1,1,3)
Do not delete!
"^DD",798.8,798.8,.08,1,1,"%D",0)
^^2^2^3031210^
"^DD",798.8,798.8,.08,1,1,"%D",1,0)
This cross-reference is used to select only the
"^DD",798.8,798.8,.08,1,1,"%D",2,0)
tasks created by a particular user.
"^DD",798.8,798.8,.08,1,1,"DT")
3021109
"^DD",798.8,798.8,.08,5,1,0)
798.8^.01^3
"^DD",798.8,798.8,.08,8.5)
@
"^DD",798.8,798.8,.08,9)
@
"^DD",798.8,798.8,.08,21,0)
^^3^3^3030502^
"^DD",798.8,798.8,.08,21,1,0)
The USER field references the VistA user who
"^DD",798.8,798.8,.08,21,2,0)
created the task.  This field is populated by the
"^DD",798.8,798.8,.08,21,3,0)
trigger associated with the TASK NUMBER field.
"^DD",798.8,798.8,.08,"DT")
3021109
"^DD",798.8,798.8,1.01,0)
USER COMMENT^F^^1;1^K:$L(X)>60!($L(X)<1) X
"^DD",798.8,798.8,1.01,3)
Answer must be 1-60 characters in length.
"^DD",798.8,798.8,1.01,8.5)
@
"^DD",798.8,798.8,1.01,9)
@
"^DD",798.8,798.8,1.01,21,0)
^^2^2^3060203^
"^DD",798.8,798.8,1.01,21,1,0)
This field stores the user comment entered while
"^DD",798.8,798.8,1.01,21,2,0)
scheduling the task.
"^DD",798.8,798.8,1.01,"DT")
3050217
"^DD",798.8,798.8,2.01,0)
STATUS^S^3:Inactive> Finished;5:Inactive> Interrupted;100:Inactive> Crashed;101:Inactive> Errors;102:Active> Suspended;103:Active> Stopping;^2;1^Q
"^DD",798.8,798.8,2.01,3)

"^DD",798.8,798.8,2.01,8.5)
@
"^DD",798.8,798.8,2.01,9)
@
"^DD",798.8,798.8,2.01,21,0)
^.001^3^3^3060203^^^
"^DD",798.8,798.8,2.01,21,1,0)
The STATUS field stores the current status of the
"^DD",798.8,798.8,2.01,21,2,0)
task.  The values of this field are used along
"^DD",798.8,798.8,2.01,21,3,0)
with those returned by the STAT^%ZTLOAD procedure.
"^DD",798.8,798.8,2.01,23,0)
^^6^6^3060203^
"^DD",798.8,798.8,2.01,23,1,0)
Codes 3 and 5 are duplicated here so that the most
"^DD",798.8,798.8,2.01,23,2,0)
recent status of task will be known even if the task is
"^DD",798.8,798.8,2.01,23,3,0)
deleted by Taskman.
"^DD",798.8,798.8,2.01,23,4,0)
 
"^DD",798.8,798.8,2.01,23,5,0)
Please do not try to analyze this field yourself; use 
"^DD",798.8,798.8,2.01,23,6,0)
the $$STATUS^RORTSK02 function instead.
"^DD",798.8,798.8,2.01,"DT")
3031201
"^DD",798.8,798.8,2.02,0)
COMPLETION TIME^D^^2;2^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",798.8,798.8,2.02,3)

"^DD",798.8,798.8,2.02,8.5)
@
"^DD",798.8,798.8,2.02,9)
@
"^DD",798.8,798.8,2.02,21,0)
^^3^3^3030501^
"^DD",798.8,798.8,2.02,21,1,0)
The task populates the COMPLETION TIME field with
"^DD",798.8,798.8,2.02,21,2,0)
the current date and time right before the task is
"^DD",798.8,798.8,2.02,21,3,0)
completed.
"^DD",798.8,798.8,2.02,23,0)
^^7^7^3030507^
"^DD",798.8,798.8,2.02,23,1,0)
This field has no value in the following cases:
"^DD",798.8,798.8,2.02,23,2,0)
 
"^DD",798.8,798.8,2.02,23,3,0)
 * the task has not started yet;
"^DD",798.8,798.8,2.02,23,4,0)
 * the task is still running;
"^DD",798.8,798.8,2.02,23,5,0)
 * the task has crashed;
"^DD",798.8,798.8,2.02,23,6,0)
 * the task has not populated the field
"^DD",798.8,798.8,2.02,23,7,0)
   due to poor design.
"^DD",798.8,798.8,2.02,"DT")
3030317
"^DD",798.8,798.8,2.03,0)
LOG^P798.7'^RORDATA(798.7,^2;3^Q
"^DD",798.8,798.8,2.03,1,0)
^.1
"^DD",798.8,798.8,2.03,1,1,0)
798.8^ALOG^MUMPS
"^DD",798.8,798.8,2.03,1,1,1)
S ^RORDATA(798.7,"AREF",X,798.8,DA_",",2.03)=""
"^DD",798.8,798.8,2.03,1,1,2)
K ^RORDATA(798.7,"AREF",X,798.8,DA_",",2.03)
"^DD",798.8,798.8,2.03,1,1,3)
Do not delete!
"^DD",798.8,798.8,2.03,1,1,"%D",0)
^^24^24^3030502^
"^DD",798.8,798.8,2.03,1,1,"%D",1,0)
The logic of the ALOG cross-reference maintains a
"^DD",798.8,798.8,2.03,1,1,"%D",2,0)
list of references from the ROR TASK file to the
"^DD",798.8,798.8,2.03,1,1,"%D",3,0)
ROR LOG file.  This list allows the function that
"^DD",798.8,798.8,2.03,1,1,"%D",4,0)
purges the old logs ($$PURGE^RORLOG01) either to 
"^DD",798.8,798.8,2.03,1,1,"%D",5,0)
keep those logs that are referenced from other
"^DD",798.8,798.8,2.03,1,1,"%D",6,0)
files or to remove the references.
"^DD",798.8,798.8,2.03,1,1,"%D",7,0)
                     
"^DD",798.8,798.8,2.03,1,1,"%D",8,0)
The list is stored under the "AREF" subscript in
"^DD",798.8,798.8,2.03,1,1,"%D",9,0)
the ROR LOG file (#798.7) and has the following 
"^DD",798.8,798.8,2.03,1,1,"%D",10,0)
structure:
"^DD",798.8,798.8,2.03,1,1,"%D",11,0)
                     
"^DD",798.8,798.8,2.03,1,1,"%D",12,0)
 ^RORDATA(798.7,"AREF",<Log>,798.8,<IENS>,2.03)
"^DD",798.8,798.8,2.03,1,1,"%D",13,0)
                     
"^DD",798.8,798.8,2.03,1,1,"%D",14,0)
The <Log> is the IEN of the log that is associated
"^DD",798.8,798.8,2.03,1,1,"%D",15,0)
with the task (internal value of the LOG field).
"^DD",798.8,798.8,2.03,1,1,"%D",16,0)
                     
"^DD",798.8,798.8,2.03,1,1,"%D",17,0)
The 798.8 is the number of the file from where the
"^DD",798.8,798.8,2.03,1,1,"%D",18,0)
log is referenced (ROR TASK).
"^DD",798.8,798.8,2.03,1,1,"%D",19,0)
                     
"^DD",798.8,798.8,2.03,1,1,"%D",20,0)
The <IENS> is the IENS of the record that
"^DD",798.8,798.8,2.03,1,1,"%D",21,0)
references the log.
"^DD",798.8,798.8,2.03,1,1,"%D",22,0)
                     
"^DD",798.8,798.8,2.03,1,1,"%D",23,0)
The 2.03 is the number of the field that points to
"^DD",798.8,798.8,2.03,1,1,"%D",24,0)
the log (the LOG field).
"^DD",798.8,798.8,2.03,1,1,"DT")
3030318
"^DD",798.8,798.8,2.03,8.5)
@
"^DD",798.8,798.8,2.03,9)
@
"^DD",798.8,798.8,2.03,21,0)
^^2^2^3030501^
"^DD",798.8,798.8,2.03,21,1,0)
The LOG field references the log created by the 
"^DD",798.8,798.8,2.03,21,2,0)
task.
"^DD",798.8,798.8,2.03,23,0)
^^2^2^3030501^
"^DD",798.8,798.8,2.03,23,1,0)
The proxy task used by the reports (TASK^RORTSK01)
"^DD",798.8,798.8,2.03,23,2,0)
always creates a log and populates this field.
"^DD",798.8,798.8,2.03,"DT")
3030318
"^DD",798.8,798.8,2.04,0)
JOB NUMBER^NJ12,0^^2;4^K:+X'=X!(X>999999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.8,798.8,2.04,3)
Type a Number between 1 and 999999999999, 0 Decimal Digits.
"^DD",798.8,798.8,2.04,8.5)
@
"^DD",798.8,798.8,2.04,9)
@
"^DD",798.8,798.8,2.04,21,0)
^.001^3^3^3060203^^
"^DD",798.8,798.8,2.04,21,1,0)
When the task is running, the JOB NUMBER field
"^DD",798.8,798.8,2.04,21,2,0)
holds the job number that is assigned to the task
"^DD",798.8,798.8,2.04,21,3,0)
by the M system.
"^DD",798.8,798.8,2.04,23,0)
^.001^3^3^3060203^^
"^DD",798.8,798.8,2.04,23,1,0)
If the task crashes, this field retains its value. 
"^DD",798.8,798.8,2.04,23,2,0)
Otherwise, it is cleared right before the task finishes
"^DD",798.8,798.8,2.04,23,3,0)
(see the $$EXIT^RORTSK01 function).
"^DD",798.8,798.8,2.04,"DT")
3021109
"^DD",798.8,798.8,3,0)
SUBTASK^798.83^^T;0
"^DD",798.8,798.8,3,9)
@
"^DD",798.8,798.8,3,21,0)
^.001^2^2^3030507^^
"^DD",798.8,798.8,3,21,1,0)
The SUBTASK multiple contains a list of subtasks 
"^DD",798.8,798.8,3,21,2,0)
started by the main task.
"^DD",798.8,798.8,3,23,0)
^^2^2^3030507^
"^DD",798.8,798.8,3,23,1,0)
The subtask functionality has not been implemented yet.
"^DD",798.8,798.8,3,23,2,0)
This multiple is reserved for future use.
"^DD",798.8,798.8,4,0)
PROGRESS^NJ7,3^^P;E1,255^K:+X'=X!(X>100)!(X<0)!(X?.E1"."4N.N) X
"^DD",798.8,798.8,4,3)
Type a Number between 0 and 100, 3 Decimal Digits.
"^DD",798.8,798.8,4,8.5)
@
"^DD",798.8,798.8,4,9)
@
"^DD",798.8,798.8,4,21,0)
^^4^4^3060203^
"^DD",798.8,798.8,4,21,1,0)
The PROGRESS field stores the percentage of 
"^DD",798.8,798.8,4,21,2,0)
completion of the task.  If the task does not 
"^DD",798.8,798.8,4,21,3,0)
explicitly support this feature, the field is 
"^DD",798.8,798.8,4,21,4,0)
always empty.
"^DD",798.8,798.8,4,23,0)
^.001^3^3^3060203^^^^
"^DD",798.8,798.8,4,23,1,0)
The task can update the value of this field using the 
"^DD",798.8,798.8,4,23,2,0)
parameter of the $$LOOP^RORTSK01 function that should 
"^DD",798.8,798.8,4,23,3,0)
be called in the main loop of the task.
"^DD",798.8,798.8,4,"DT")
3021114
"^DD",798.8,798.8,5,0)
ACTION^S^1:Suspend;2:Stop;^A;E1,255^Q
"^DD",798.8,798.8,5,8.5)
@
"^DD",798.8,798.8,5,9)
@
"^DD",798.8,798.8,5,21,0)
^^3^3^3030502^
"^DD",798.8,798.8,5,21,1,0)
Values of the ACTION field control the task
"^DD",798.8,798.8,5,21,2,0)
behavior.  You can either suspend/resume or stop
"^DD",798.8,798.8,5,21,3,0)
the task
"^DD",798.8,798.8,5,23,0)
^^7^7^3030502^
"^DD",798.8,798.8,5,23,1,0)
Please do not modify this field directly.  Use the 
"^DD",798.8,798.8,5,23,2,0)
$$DEQUEUE^RORTSK function to stop the task, and the
"^DD",798.8,798.8,5,23,3,0)
$$SUSPEND^RORTSK02 and $$RESUME^RORTSK02 functions to
"^DD",798.8,798.8,5,23,4,0)
suspend/resume it.
"^DD",798.8,798.8,5,23,5,0)
 
"^DD",798.8,798.8,5,23,6,0)
The task can also be stopped using the Stop task option
"^DD",798.8,798.8,5,23,7,0)
of the Taskman User menu (see the User's Toolbox menu).
"^DD",798.8,798.8,5,"DT")
3021114
"^DD",798.8,798.8,7,0)
REPORT ELEMENT^798.87P^^RI;0
"^DD",798.8,798.8,7,9)
@
"^DD",798.8,798.8,7,21,0)
^.001^18^18^3030501^^^
"^DD",798.8,798.8,7,21,1,0)
The REPORT ELEMENT multiple stores the output of 
"^DD",798.8,798.8,7,21,2,0)
the 'Report' task (see the TYPE field).
"^DD",798.8,798.8,7,21,3,0)
 
"^DD",798.8,798.8,7,21,4,0)
A report is stored as a tree of XML elements. Each
"^DD",798.8,798.8,7,21,5,0)
element can contain some text, a single-line value
"^DD",798.8,798.8,7,21,6,0)
or no value at all. Several attributes can be 
"^DD",798.8,798.8,7,21,7,0)
associated with the element. Valid element and
"^DD",798.8,798.8,7,21,8,0)
attribute names are stored in the ROR XML ELEMENT 
"^DD",798.8,798.8,7,21,9,0)
and ROR XML ATTRIBUTE files.
"^DD",798.8,798.8,7,21,10,0)
 
"^DD",798.8,798.8,7,21,11,0)
Storing the XML document in this sparse format
"^DD",798.8,798.8,7,21,12,0)
allows to perform sorting on predefined fields
"^DD",798.8,798.8,7,21,13,0)
(on the server) when the report is created.
"^DD",798.8,798.8,7,21,14,0)
 
"^DD",798.8,798.8,7,21,15,0)
If you do not need this functionality, you can 
"^DD",798.8,798.8,7,21,16,0)
generate a report as a single element (in terms 
"^DD",798.8,798.8,7,21,17,0)
of this multiple) that contains the whole XML 
"^DD",798.8,798.8,7,21,18,0)
document.
"^DD",798.8,798.8,7,23,0)
^.001^2^2^3030501^^
"^DD",798.8,798.8,7,23,1,0)
Please do not edit this multiple directly. Use the API 
"^DD",798.8,798.8,7,23,2,0)
defined in the RORTSK1 routine instead.
"^DD",798.8,798.8,7,"DT")
3021129
"^DD",798.8,798.83,0)
SUBTASK SUB-FIELD^^.01^2
"^DD",798.8,798.83,0,"DT")
3021113
"^DD",798.8,798.83,0,"NM","SUBTASK")

"^DD",798.8,798.83,0,"UP")
798.8
"^DD",798.8,798.83,.001,0)
NUMBER^NJ10,0^^ ^K:+X'=X!(X>9899999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.8,798.83,.001,3)
Type a Number between 1 and 9899999999, 0 Decimal Digits.
"^DD",798.8,798.83,.001,8.5)
@
"^DD",798.8,798.83,.001,9)
@
"^DD",798.8,798.83,.001,21,0)
^.001^2^2^3060203^^
"^DD",798.8,798.83,.001,21,1,0)
This is the record IEN that should be equal to the
"^DD",798.8,798.83,.001,21,2,0)
subtask number.
"^DD",798.8,798.83,.001,"DT")
3021113
"^DD",798.8,798.83,.01,0)
STATUS^MF^^0;1^K:$L(X)>10!($L(X)<1) X
"^DD",798.8,798.83,.01,1,0)
^.1^^0
"^DD",798.8,798.83,.01,3)
Answer must be 1-10 characters in length.
"^DD",798.8,798.83,.01,8.5)
@
"^DD",798.8,798.83,.01,9)
@
"^DD",798.8,798.83,.01,21,0)
^^2^2^3030501^
"^DD",798.8,798.83,.01,21,1,0)
The current status of the subtask is stored in 
"^DD",798.8,798.83,.01,21,2,0)
this field.
"^DD",798.8,798.83,.01,"DT")
3021113
"^DD",798.8,798.87,0)
REPORT ELEMENT SUB-FIELD^^3^7
"^DD",798.8,798.87,0,"DT")
3031020
"^DD",798.8,798.87,0,"IX","B",798.87,.01)

"^DD",798.8,798.87,0,"NM","REPORT ELEMENT")

"^DD",798.8,798.87,0,"UP")
798.8
"^DD",798.8,798.87,.01,0)
REPORT ELEMENT^MP799.31'^ROR(799.31,^0;1^Q
"^DD",798.8,798.87,.01,1,0)
^.1
"^DD",798.8,798.87,.01,1,1,0)
798.87^B
"^DD",798.8,798.87,.01,1,1,1)
S ^RORDATA(798.8,DA(1),"RI","B",$E(X,1,30),DA)=""
"^DD",798.8,798.87,.01,1,1,2)
K ^RORDATA(798.8,DA(1),"RI","B",$E(X,1,30),DA)
"^DD",798.8,798.87,.01,1,1,3)
Do not delete!
"^DD",798.8,798.87,.01,1,1,"DT")
3021129
"^DD",798.8,798.87,.01,3)

"^DD",798.8,798.87,.01,8.5)
@
"^DD",798.8,798.87,.01,9)
@
"^DD",798.8,798.87,.01,21,0)
^^2^2^3030501^
"^DD",798.8,798.87,.01,21,1,0)
The REPORT ELEMENT field references the XML 
"^DD",798.8,798.87,.01,21,2,0)
element (tag) that is a part of the report.
"^DD",798.8,798.87,.01,"DT")
3030819
"^DD",798.8,798.87,.02,0)
PARENT^NJ12,0^^0;2^K:+X'=X!(X>999999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.8,798.87,.02,3)
Type a Number between 1 and 999999999999, 0 Decimal Digits.
"^DD",798.8,798.87,.02,8.5)
@
"^DD",798.8,798.87,.02,9)
@
"^DD",798.8,798.87,.02,21,0)
^.001^3^3^3060203^^
"^DD",798.8,798.87,.02,21,1,0)
The PARENT field stores the IEN of the record of 
"^DD",798.8,798.87,.02,21,2,0)
the REPORT ELEMENT multiple that represents the
"^DD",798.8,798.87,.02,21,3,0)
parent element for this one.
"^DD",798.8,798.87,.02,"DT")
3030819
"^DD",798.8,798.87,.03,0)
SORT BY^S^0:NO;1:AS-IS;2:STRING;3:NUMBER;^0;3^Q
"^DD",798.8,798.87,.03,8.5)
@
"^DD",798.8,798.87,.03,9)
@
"^DD",798.8,798.87,.03,21,0)
^.001^6^6^3060203^^^
"^DD",798.8,798.87,.03,21,1,0)
If the SORT field is set to YES then a special
"^DD",798.8,798.87,.03,21,2,0)
cross-reference is built using the value of this 
"^DD",798.8,798.87,.03,21,3,0)
element and the IEN of its parent element.
"^DD",798.8,798.87,.03,21,4,0)
 
"^DD",798.8,798.87,.03,21,5,0)
Only those elements that have single-line values 
"^DD",798.8,798.87,.03,21,6,0)
can be sorted.
"^DD",798.8,798.87,.03,23,0)
^^26^26^3060203^
"^DD",798.8,798.87,.03,23,1,0)
For example, let us assume the report has the following
"^DD",798.8,798.87,.03,23,2,0)
structure:
"^DD",798.8,798.87,.03,23,3,0)
 
"^DD",798.8,798.87,.03,23,4,0)
  <REPORT>
"^DD",798.8,798.87,.03,23,5,0)
   <HEADER>
"^DD",798.8,798.87,.03,23,6,0)
   ...
"^DD",798.8,798.87,.03,23,7,0)
   </HEADER>
"^DD",798.8,798.87,.03,23,8,0)
   <PATIENTS>
"^DD",798.8,798.87,.03,23,9,0)
    <PATIENT>
"^DD",798.8,798.87,.03,23,10,0)
     <NAME> ... </NAME>
"^DD",798.8,798.87,.03,23,11,0)
     <DOB> ... </DOB>
"^DD",798.8,798.87,.03,23,12,0)
     <SELRULES>
"^DD",798.8,798.87,.03,23,13,0)
      <RULE>
"^DD",798.8,798.87,.03,23,14,0)
       <NAME> ... </NAME>
"^DD",798.8,798.87,.03,23,15,0)
       <DATE> ... </DATE>
"^DD",798.8,798.87,.03,23,16,0)
      </RULE>
"^DD",798.8,798.87,.03,23,17,0)
      ...
"^DD",798.8,798.87,.03,23,18,0)
     </SELRULES>
"^DD",798.8,798.87,.03,23,19,0)
    </PATIENT>
"^DD",798.8,798.87,.03,23,20,0)
    ...
"^DD",798.8,798.87,.03,23,21,0)
   </PATIENTS>
"^DD",798.8,798.87,.03,23,22,0)
  </REPORT>
"^DD",798.8,798.87,.03,23,23,0)
 
"^DD",798.8,798.87,.03,23,24,0)
If the SORT BY field is set to YES for the NAME child
"^DD",798.8,798.87,.03,23,25,0)
element of each PATIENT element, then the patients will
"^DD",798.8,798.87,.03,23,26,0)
be sorted by their names.
"^DD",798.8,798.87,.03,"DT")
3030819
"^DD",798.8,798.87,.04,0)
IGNORE^S^0:NO;1:YES;^0;4^Q
"^DD",798.8,798.87,.04,21,0)
^^3^3^3060203^
"^DD",798.8,798.87,.04,21,1,0)
If the IGNORE field is set to 'YES' then the 
"^DD",798.8,798.87,.04,21,2,0)
report element and all its descendants will not be
"^DD",798.8,798.87,.04,21,3,0)
rendered into the resulting XML document.
"^DD",798.8,798.87,.04,"DT")
3030924
"^DD",798.8,798.87,1,0)
VALUE^F^^1;E1,245^K:$L(X)>245!($L(X)<1) X
"^DD",798.8,798.87,1,3)
Answer must be 1-245 characters in length.
"^DD",798.8,798.87,1,8.5)
@
"^DD",798.8,798.87,1,9)
@
"^DD",798.8,798.87,1,21,0)
^.001^5^5^3060203^^^
"^DD",798.8,798.87,1,21,1,0)
The VALUE field stores the single-line value of 
"^DD",798.8,798.87,1,21,2,0)
the element.  For example, if "SMITH, JOHN" is
"^DD",798.8,798.87,1,21,3,0)
stored as the value of the NAME element, then the
"^DD",798.8,798.87,1,21,4,0)
corresponding fragment of the XML document will
"^DD",798.8,798.87,1,21,5,0)
look as follows: <NAME>SMITH, JOHN</NAME>.
"^DD",798.8,798.87,1,"DT")
3030819
"^DD",798.8,798.87,2,0)
ATTRIBUTE^798.872P^^2;0
"^DD",798.8,798.87,2,9)
@
"^DD",798.8,798.87,2,21,0)
^.001^3^3^3030502^^
"^DD",798.8,798.87,2,21,1,0)
The ATTRIBUTE multiple contains a list of XML
"^DD",798.8,798.87,2,21,2,0)
attributes (and their values) associated with the 
"^DD",798.8,798.87,2,21,3,0)
element.
"^DD",798.8,798.87,3,0)
TEXT^798.873^^3;0
"^DD",798.8,798.87,3,9)
@
"^DD",798.8,798.87,3,21,0)
^^8^8^3060203^
"^DD",798.8,798.87,3,21,1,0)
The TEXT field stores the text (multi-line) value
"^DD",798.8,798.87,3,21,2,0)
of the element. For example, the corresponding
"^DD",798.8,798.87,3,21,3,0)
fragment of the XML document for the DESCRIPTION
"^DD",798.8,798.87,3,21,4,0)
element will look as follows:
"^DD",798.8,798.87,3,21,5,0)
 
"^DD",798.8,798.87,3,21,6,0)
  <DESCRIPTION>
"^DD",798.8,798.87,3,21,7,0)
  ... Text from this field ...
"^DD",798.8,798.87,3,21,8,0)
  </DESCRIPTION>
"^DD",798.8,798.872,0)
ATTRIBUTE SUB-FIELD^^1^2
"^DD",798.8,798.872,0,"DT")
3031020
"^DD",798.8,798.872,0,"IX","B",798.872,.01)

"^DD",798.8,798.872,0,"NM","ATTRIBUTE")

"^DD",798.8,798.872,0,"UP")
798.87
"^DD",798.8,798.872,.01,0)
ATTRIBUTE^MP799.31'X^ROR(799.31,^0;1^S:$D(X) DINUM=X
"^DD",798.8,798.872,.01,1,0)
^.1
"^DD",798.8,798.872,.01,1,1,0)
798.872^B
"^DD",798.8,798.872,.01,1,1,1)
S ^RORDATA(798.8,DA(2),"RI",DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",798.8,798.872,.01,1,1,2)
K ^RORDATA(798.8,DA(2),"RI",DA(1),2,"B",$E(X,1,30),DA)
"^DD",798.8,798.872,.01,1,1,3)
Do not delete!
"^DD",798.8,798.872,.01,1,1,"DT")
3030502
"^DD",798.8,798.872,.01,8.5)
@
"^DD",798.8,798.872,.01,9)
@
"^DD",798.8,798.872,.01,21,0)
^.001^2^2^3031020^^^^
"^DD",798.8,798.872,.01,21,1,0)
The ATTRIBUTE field references an XML attribute
"^DD",798.8,798.872,.01,21,2,0)
associated with the report element (tag).
"^DD",798.8,798.872,.01,"DT")
3031020
"^DD",798.8,798.872,1,0)
VALUE^F^^1;E1,245^K:$L(X)>245!($L(X)<1) X
"^DD",798.8,798.872,1,3)
Answer must be 1-245 characters in length.
"^DD",798.8,798.872,1,8.5)
@
"^DD",798.8,798.872,1,9)
@
"^DD",798.8,798.872,1,21,0)
^^5^5^3060203^
"^DD",798.8,798.872,1,21,1,0)
The VALUE field stores the attribute value.  For
"^DD",798.8,798.872,1,21,2,0)
example, if "193" is stored as the value of the ID
"^DD",798.8,798.872,1,21,3,0)
attribute of the PATIENT report element, then the
"^DD",798.8,798.872,1,21,4,0)
corresponding fragment of the XML document will
"^DD",798.8,798.872,1,21,5,0)
look like as follow: <PATIENT ID="193">.
"^DD",798.8,798.872,1,"DT")
3021130
"^DD",798.8,798.873,0)
TEXT SUB-FIELD^^.01^1
"^DD",798.8,798.873,0,"DT")
3021130
"^DD",798.8,798.873,0,"NM","TEXT")

"^DD",798.8,798.873,0,"UP")
798.87
"^DD",798.8,798.873,.01,0)
TEXT^WL^^0;1^Q
"^DD",798.8,798.873,.01,8.5)
@
"^DD",798.8,798.873,.01,9)
@
"^DD",798.8,798.873,.01,21,0)
^^2^2^3030502^
"^DD",798.8,798.873,.01,21,1,0)
This is a line of the text value of the report 
"^DD",798.8,798.873,.01,21,2,0)
element.
"^DD",798.8,798.873,.01,"DT")
3021130
"^DD",798.9,798.9,0)
FIELD^^2^4
"^DD",798.9,798.9,0,"DDA")
N
"^DD",798.9,798.9,0,"DT")
3031006
"^DD",798.9,798.9,0,"IX","ALN",798.92,.01)

"^DD",798.9,798.9,0,"IX","ANLT",798.92,.02)

"^DD",798.9,798.9,0,"NM","ROR LAB SEARCH")

"^DD",798.9,798.9,0,"VRPK")
ROR
"^DD",798.9,798.9,.01,0)
NAME^RFX^^0;1^Q:$$VAEDT^RORDD(798.9,$G(DA))  K:$L(X)>30!($L(X)<3) X
"^DD",798.9,798.9,.01,1,0)
^.1^^0
"^DD",798.9,798.9,.01,3)
Enter a unique name spaced criterion name (3-30 characters).
"^DD",798.9,798.9,.01,8.5)
@
"^DD",798.9,798.9,.01,9)
@
"^DD",798.9,798.9,.01,21,0)
^^6^6^3011016^
"^DD",798.9,798.9,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.9,798.9,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.9,798.9,.01,21,3,0)
 
"^DD",798.9,798.9,.01,21,4,0)
The criterion name must be unique and name spaced.
"^DD",798.9,798.9,.01,21,5,0)
The names that are used for National Registries
"^DD",798.9,798.9,.01,21,6,0)
must start with "VA".
"^DD",798.9,798.9,.01,"DEL",1,0)
I $$VADEL^RORDD(798.9,$G(DA))
"^DD",798.9,798.9,.01,"DT")
3010720
"^DD",798.9,798.9,.09,0)
NATIONAL^SX^0:NO;1:YES;^0;3^Q:$$VAEDT^RORDD(798.9,,-1)
"^DD",798.9,798.9,.09,8.5)
@
"^DD",798.9,798.9,.09,9)
@
"^DD",798.9,798.9,.09,21,0)
^^6^6^3060203^
"^DD",798.9,798.9,.09,21,1,0)
ONLY AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN
"^DD",798.9,798.9,.09,21,2,0)
EDIT THIS FIELD!
"^DD",798.9,798.9,.09,21,3,0)
 
"^DD",798.9,798.9,.09,21,4,0)
The national registries must have this field set
"^DD",798.9,798.9,.09,21,5,0)
to "YES". This prevents local editing of other
"^DD",798.9,798.9,.09,21,6,0)
fields of national registry definitions.
"^DD",798.9,798.9,.09,"DEL",1,0)
I $$VADEL^RORDD(798.9,,-1)
"^DD",798.9,798.9,.09,"DT")
3011119
"^DD",798.9,798.9,1,0)
STATUS^S^0:ACTIVE;1:INACTIVE;^0;2^Q
"^DD",798.9,798.9,1,21,0)
^^2^2^3020403^
"^DD",798.9,798.9,1,21,1,0)
Select the "INACTIVE" code if you want to disable
"^DD",798.9,798.9,1,21,2,0)
the criterion temporarily.
"^DD",798.9,798.9,1,"DT")
3011016
"^DD",798.9,798.9,2,0)
LAB TEST^798.92^^1;0
"^DD",798.9,798.9,2,9)
@
"^DD",798.9,798.9,2,21,0)
^^9^9^3011119^
"^DD",798.9,798.9,2,21,1,0)
This multiple contains a list of the Lab search 
"^DD",798.9,798.9,2,21,2,0)
indicators used by the registry update process.
"^DD",798.9,798.9,2,21,3,0)
 
"^DD",798.9,798.9,2,21,4,0)
If at least one of the indicators is evaluated as 
"^DD",798.9,798.9,2,21,5,0)
True, the macro referencing the search criterion
"^DD",798.9,798.9,2,21,6,0)
will be evaluated as True as well.
"^DD",798.9,798.9,2,21,7,0)
 
"^DD",798.9,798.9,2,21,8,0)
This multiple can contain several records for the
"^DD",798.9,798.9,2,21,9,0)
same Lab test.
"^DD",798.9,798.92,0)
LAB TEST SUB-FIELD^^2^4
"^DD",798.9,798.92,0,"DT")
3031006
"^DD",798.9,798.92,0,"IX","B",798.92,.01)

"^DD",798.9,798.92,0,"NM","LAB TEST")

"^DD",798.9,798.92,0,"UP")
798.9
"^DD",798.9,798.92,.01,0)
LOINC CODE^MNJ7,0^^0;1^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",798.9,798.92,.01,1,0)
^.1
"^DD",798.9,798.92,.01,1,1,0)
798.92^B
"^DD",798.9,798.92,.01,1,1,1)
S ^ROR(798.9,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",798.9,798.92,.01,1,1,2)
K ^ROR(798.9,DA(1),1,"B",$E(X,1,30),DA)
"^DD",798.9,798.92,.01,1,1,3)
Do not delete!
"^DD",798.9,798.92,.01,1,2,0)
798.9^ALN
"^DD",798.9,798.92,.01,1,2,1)
S ^ROR(798.9,"ALN",$E(X,1,30),DA(1),DA)=""
"^DD",798.9,798.92,.01,1,2,2)
K ^ROR(798.9,"ALN",$E(X,1,30),DA(1),DA)
"^DD",798.9,798.92,.01,1,2,3)
Do not delete!
"^DD",798.9,798.92,.01,1,2,"%D",0)
^^3^3^3060203^
"^DD",798.9,798.92,.01,1,2,"%D",1,0)
This cross-reference can be used to find all 
"^DD",798.9,798.92,.01,1,2,"%D",2,0)
criteria that look for Lab results with the
"^DD",798.9,798.92,.01,1,2,"%D",3,0)
specified LOINC code.
"^DD",798.9,798.92,.01,1,2,"DT")
3010621
"^DD",798.9,798.92,.01,3)
Enter the LOINC code without a control digit.
"^DD",798.9,798.92,.01,8.5)
@
"^DD",798.9,798.92,.01,9)
@
"^DD",798.9,798.92,.01,21,0)
^^2^2^3060202^
"^DD",798.9,798.92,.01,21,1,0)
Enter the numeric LOINC code (without the check
"^DD",798.9,798.92,.01,21,2,0)
digit) of the Lab result to be searched for. 
"^DD",798.9,798.92,.01,23,0)
^^2^2^3060202^
"^DD",798.9,798.92,.01,23,1,0)
If you want to use only NLT code, enter zero as the
"^DD",798.9,798.92,.01,23,2,0)
value of this field.
"^DD",798.9,798.92,.01,"DT")
3011119
"^DD",798.9,798.92,.02,0)
NLT CODE^F^^0;2^K:'(X?5N1"."4.5N) X
"^DD",798.9,798.92,.02,1,0)
^.1
"^DD",798.9,798.92,.02,1,1,0)
798.9^ANLT
"^DD",798.9,798.92,.02,1,1,1)
S ^ROR(798.9,"ANLT",$E(X,1,30),DA(1),DA)=""
"^DD",798.9,798.92,.02,1,1,2)
K ^ROR(798.9,"ANLT",$E(X,1,30),DA(1),DA)
"^DD",798.9,798.92,.02,1,1,3)
Do not delete!
"^DD",798.9,798.92,.02,1,1,"%D",0)
^^3^3^3060203^
"^DD",798.9,798.92,.02,1,1,"%D",1,0)
This cross-reference can be used to find all 
"^DD",798.9,798.92,.02,1,1,"%D",2,0)
criteria that look for Lab results with the
"^DD",798.9,798.92,.02,1,1,"%D",3,0)
specified NLT code.
"^DD",798.9,798.92,.02,1,1,"DT")
3010621
"^DD",798.9,798.92,.02,3)
Enter the NLT code (NNNNN.MMMM[M]).
"^DD",798.9,798.92,.02,8.5)
@
"^DD",798.9,798.92,.02,9)
@
"^DD",798.9,798.92,.02,21,0)
^.001^5^5^3011119^^^
"^DD",798.9,798.92,.02,21,1,0)
Enter the NLT code of the Lab result to be 
"^DD",798.9,798.92,.02,21,2,0)
searched for. Both LOINC and NLT codes (if
"^DD",798.9,798.92,.02,21,3,0)
available) are used for searching the Lab results.
"^DD",798.9,798.92,.02,21,4,0)
If you want to use only the LOINC code, leave this
"^DD",798.9,798.92,.02,21,5,0)
field empty.
"^DD",798.9,798.92,.02,"DT")
3011119
"^DD",798.9,798.92,1,0)
INDICATOR^RS^0:Ignore;1:Use Reference Range;2:Contains;3:Greater Than;4:Less Than;5:Equal To;6:Positive Result;^0;3^Q
"^DD",798.9,798.92,1,8.5)
@
"^DD",798.9,798.92,1,9)
@
"^DD",798.9,798.92,1,21,0)
^^35^35^3060203^
"^DD",798.9,798.92,1,21,1,0)
The value of this field indicates the comparison
"^DD",798.9,798.92,1,21,2,0)
operation applied to the Lab result. The Lab
"^DD",798.9,798.92,1,21,3,0)
result is compared to the value of the INDICATED 
"^DD",798.9,798.92,1,21,4,0)
VALUE field. 
"^DD",798.9,798.92,1,21,5,0)
 
"^DD",798.9,798.92,1,21,6,0)
NOTE: All string comparisons are case-insensitive.
"^DD",798.9,798.92,1,21,7,0)
 
"^DD",798.9,798.92,1,21,8,0)
For example, if the internal value of this field 
"^DD",798.9,798.92,1,21,9,0)
is equal to 3 ("Greater Than") and the value of
"^DD",798.9,798.92,1,21,10,0)
the INDICATED VALUE field is 5, then this 
"^DD",798.9,798.92,1,21,11,0)
indicator will be evaluated as True for all
"^DD",798.9,798.92,1,21,12,0)
numeric Lab results values greater than 5.
"^DD",798.9,798.92,1,21,13,0)
 
"^DD",798.9,798.92,1,21,14,0)
The "Contains" indicator checks if the indicated
"^DD",798.9,798.92,1,21,15,0)
value is contained in the Lab result value.
"^DD",798.9,798.92,1,21,16,0)
 
"^DD",798.9,798.92,1,21,17,0)
The only exceptions are the "Use Reference Range"
"^DD",798.9,798.92,1,21,18,0)
indicator, which checks if the result value is
"^DD",798.9,798.92,1,21,19,0)
outside of the reference range defined for the 
"^DD",798.9,798.92,1,21,20,0)
Lab test, and the "Positive Result".
"^DD",798.9,798.92,1,21,21,0)
 
"^DD",798.9,798.92,1,21,22,0)
The "Positive Result" indicator selects a test 
"^DD",798.9,798.92,1,21,23,0)
result if the value
"^DD",798.9,798.92,1,21,24,0)
 
"^DD",798.9,798.92,1,21,25,0)
  * is equal to "P"
"^DD",798.9,798.92,1,21,26,0)
 
"^DD",798.9,798.92,1,21,27,0)
    or
"^DD",798.9,798.92,1,21,28,0)
 
"^DD",798.9,798.92,1,21,29,0)
  * contains "POS", "DETEC" or "REA" and
"^DD",798.9,798.92,1,21,30,0)
    does not contain "NEG", "NO" or "IND".
"^DD",798.9,798.92,1,21,31,0)
 
"^DD",798.9,798.92,1,21,32,0)
For example, the "POSITIVE", "POS", "REACT", and 
"^DD",798.9,798.92,1,21,33,0)
"DETECTABLE" values will be picked up. At the same
"^DD",798.9,798.92,1,21,34,0)
time, the "NON-REACT", "INDETERMINATE", and "NEG"
"^DD",798.9,798.92,1,21,35,0)
values will be skipped.
"^DD",798.9,798.92,1,"DT")
3031006
"^DD",798.9,798.92,2,0)
INDICATED VALUE^F^^0;4^K:$L(X)>30!($L(X)<1) X
"^DD",798.9,798.92,2,3)
Answer must be 1-30 characters in length.
"^DD",798.9,798.92,2,8.5)
@
"^DD",798.9,798.92,2,9)
@
"^DD",798.9,798.92,2,21,0)
^^3^3^3060202^
"^DD",798.9,798.92,2,21,1,0)
This field holds the value that the Lab results
"^DD",798.9,798.92,2,21,2,0)
are compared to (except the "Use Reference Range"
"^DD",798.9,798.92,2,21,3,0)
and Positive Result indicators).
"^DD",798.9,798.92,2,"DT")
3010621
"^DD",799.1,799.1,0)
FIELD^^1^5
"^DD",799.1,799.1,0,"DDA")
N
"^DD",799.1,799.1,0,"DT")
3050805
"^DD",799.1,799.1,0,"NM","ROR LIST ITEM")

"^DD",799.1,799.1,0,"PT",798.128,.02)

"^DD",799.1,799.1,0,"PT",798.129,.02)

"^DD",799.1,799.1,0,"PT",799.51,.03)

"^DD",799.1,799.1,0,"VRPK")
ROR
"^DD",799.1,799.1,0,"VRRV")
1.1^ROR*1*5
"^DD",799.1,799.1,.01,0)
TEXT^RFX^^0;1^Q:$$VAEDT^RORDD(799.1,,-1)  K:$L(X)>60!($L(X)<1) X
"^DD",799.1,799.1,.01,1,0)
^.1^^0
"^DD",799.1,799.1,.01,3)
Enter text of the item (1-60 characters).
"^DD",799.1,799.1,.01,8.5)
@
"^DD",799.1,799.1,.01,9)
@
"^DD",799.1,799.1,.01,21,0)
^^4^4^3050427^
"^DD",799.1,799.1,.01,21,1,0)
This field contains a text representation of the
"^DD",799.1,799.1,.01,21,2,0)
item (external value). The text is displayed by 
"^DD",799.1,799.1,.01,21,3,0)
the GUI in the list of possible values of the
"^DD",799.1,799.1,.01,21,4,0)
registry field that this item is associated with.
"^DD",799.1,799.1,.01,"DEL",1,0)
I $$VADEL^RORDD(799.1,,-1)
"^DD",799.1,799.1,.01,"DT")
3051116
"^DD",799.1,799.1,.02,0)
TYPE^RSX^3:Lab Group;4:Drug Group;^0;2^Q:$$VAEDT^RORDD(799.1,,-1)
"^DD",799.1,799.1,.02,8.5)
@
"^DD",799.1,799.1,.02,9)
@
"^DD",799.1,799.1,.02,21,0)
^.001^3^3^3050426^^^^
"^DD",799.1,799.1,.02,21,1,0)
An internal value of this field links the item to
"^DD",799.1,799.1,.02,21,2,0)
the registry field. The items with the same type
"^DD",799.1,799.1,.02,21,3,0)
define the possible values of the registry field.
"^DD",799.1,799.1,.02,23,0)
^.001^3^3^3050426^^^^
"^DD",799.1,799.1,.02,23,1,0)
When a new registry field needs to be added, add
"^DD",799.1,799.1,.02,23,2,0)
another code to the definition of this field and create
"^DD",799.1,799.1,.02,23,3,0)
the corresponding item records.
"^DD",799.1,799.1,.02,"DT")
3011112
"^DD",799.1,799.1,.03,0)
REGISTRY^RP798.1'X^ROR(798.1,^0;3^Q:$$VAEDT^RORDD(799.1,,-1)
"^DD",799.1,799.1,.03,8.5)
@
"^DD",799.1,799.1,.03,9)
@
"^DD",799.1,799.1,.03,21,0)
^.001^2^2^3050513^^^
"^DD",799.1,799.1,.03,21,1,0)
This field identifies the registry that the item
"^DD",799.1,799.1,.03,21,2,0)
is associated with.
"^DD",799.1,799.1,.03,"DT")
3011112
"^DD",799.1,799.1,.04,0)
CODE^RNJ2,0X^^0;4^Q:$$VAEDT^RORDD(799.1,,-1)  K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",799.1,799.1,.04,3)
Type a Number between 1 and 99, 0 Decimal Digits.
"^DD",799.1,799.1,.04,8.5)
@
"^DD",799.1,799.1,.04,9)
@
"^DD",799.1,799.1,.04,21,0)
^.001^3^3^3030625^^^
"^DD",799.1,799.1,.04,21,1,0)
This field contains a code (internal value) of the
"^DD",799.1,799.1,.04,21,2,0)
item. The codes are unique only among the items of
"^DD",799.1,799.1,.04,21,3,0)
the same type associated with the same registry.
"^DD",799.1,799.1,.04,"DT")
3011112
"^DD",799.1,799.1,1,0)
DATE OF INACTIVATION^D^^0;5^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",799.1,799.1,1,21,0)
^.001^4^4^3021126^^^
"^DD",799.1,799.1,1,21,1,0)
If this field has a value, the item will be
"^DD",799.1,799.1,1,21,2,0)
considered inactive after this date. Use this 
"^DD",799.1,799.1,1,21,3,0)
field to disable unnecessary items instead of
"^DD",799.1,799.1,1,21,4,0)
deleting them.
"^DD",799.1,799.1,1,23,0)
^.001^3^3^3021126^^^
"^DD",799.1,799.1,1,23,1,0)
The $$ITEMLIST^RORUTL01 function analyzes this field 
"^DD",799.1,799.1,1,23,2,0)
when it loads the requested list of items and skips the
"^DD",799.1,799.1,1,23,3,0)
inactive items.
"^DD",799.1,799.1,1,"DT")
3021126
"^DD",799.2,799.2,0)
FIELD^^5^5
"^DD",799.2,799.2,0,"DDA")
N
"^DD",799.2,799.2,0,"DT")
3020326
"^DD",799.2,799.2,0,"ID","WRITE")
N RORMSG D EN^DDIOL($$GET1^DID(Y,,,"NAME",,"RORMSG"),,"?30")
"^DD",799.2,799.2,0,"IX","B",799.2,.01)

"^DD",799.2,799.2,0,"NM","ROR METADATA")

"^DD",799.2,799.2,0,"PT",799.2,1)

"^DD",799.2,799.2,0,"VRPK")
ROR
"^DD",799.2,799.2,.01,0)
FILE^RNJ22,9X^^0;1^Q:$$VAEDT^RORDD(799.2,,-1)  K:+X'=X!(X>999999999999)!(X<2)!(X?.E1"."10.N) X I $D(X) K:'$$VFILE^DILFD(X) X S:$D(X) DINUM=X
"^DD",799.2,799.2,.01,1,0)
^.1
"^DD",799.2,799.2,.01,1,1,0)
799.2^B
"^DD",799.2,799.2,.01,1,1,1)
S ^ROR(799.2,"B",$E(X,1,30),DA)=""
"^DD",799.2,799.2,.01,1,1,2)
K ^ROR(799.2,"B",$E(X,1,30),DA)
"^DD",799.2,799.2,.01,1,1,3)
Do not delete!
"^DD",799.2,799.2,.01,3)
Enter (sub)file number between 2 and 999999999999, 9 Decimal Digits.
"^DD",799.2,799.2,.01,8.5)
@
"^DD",799.2,799.2,.01,9)
@
"^DD",799.2,799.2,.01,21,0)
^^4^4^3020321^
"^DD",799.2,799.2,.01,21,1,0)
The value of this field is the number of the
"^DD",799.2,799.2,.01,21,2,0)
(sub)file that can be searched for new data by the
"^DD",799.2,799.2,.01,21,3,0)
registry update process and is a part of the
"^DD",799.2,799.2,.01,21,4,0)
file-processing tree.
"^DD",799.2,799.2,.01,23,0)
^.001^2^2^3020403^^^
"^DD",799.2,799.2,.01,23,1,0)
The internal value of this field is used as the
"^DD",799.2,799.2,.01,23,2,0)
internal entry number of the record ('DINUM' feature).
"^DD",799.2,799.2,.01,"DEL",1,0)
I $$VADEL^RORDD(799.2,,-1)
"^DD",799.2,799.2,.01,"DT")
3020313
"^DD",799.2,799.2,1,0)
PARENT^*P799.2'X^ROR(799.2,^0;2^Q:$$VAEDT^RORDD(799.2,,-1)  S DIC("S")="I Y'="_+$G(DA) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",799.2,799.2,1,8.5)
@
"^DD",799.2,799.2,1,9)
@
"^DD",799.2,799.2,1,12)
A record cannot be parent record of itself.
"^DD",799.2,799.2,1,12.1)
S DIC("S")="I Y'="_+$G(DA)
"^DD",799.2,799.2,1,21,0)
^^12^12^3020328^
"^DD",799.2,799.2,1,21,1,0)
This field holds the number of the (sub)file that
"^DD",799.2,799.2,1,21,2,0)
is a parent of the current file in the
"^DD",799.2,799.2,1,21,3,0)
file-processing tree. You can choose only from the
"^DD",799.2,799.2,1,21,4,0)
files that have descriptors in the ROR METADATA
"^DD",799.2,799.2,1,21,5,0)
file. However, the current record cannot be
"^DD",799.2,799.2,1,21,6,0)
selected as the parent of itself.
"^DD",799.2,799.2,1,21,7,0)
 
"^DD",799.2,799.2,1,21,8,0)
Leave this field empty for the "root" file (the 
"^DD",799.2,799.2,1,21,9,0)
PATIENT file (#2) most probably).
"^DD",799.2,799.2,1,21,10,0)
 
"^DD",799.2,799.2,1,21,11,0)
See the technical description of the field for 
"^DD",799.2,799.2,1,21,12,0)
more information.
"^DD",799.2,799.2,1,23,0)
^^24^24^3060203^
"^DD",799.2,799.2,1,23,1,0)
During the registry update, VistA files are processed
"^DD",799.2,799.2,1,23,2,0)
in the predetermined hierarchic sequence called
"^DD",799.2,799.2,1,23,3,0)
"file-processing tree". A sample structure of the
"^DD",799.2,799.2,1,23,4,0)
"tree" is illustrated below:
"^DD",799.2,799.2,1,23,5,0)
 
"^DD",799.2,799.2,1,23,6,0)
 . PATIENT (#2)
"^DD",799.2,799.2,1,23,7,0)
 .    VISIT (#9000010)
"^DD",799.2,799.2,1,23,8,0)
 .       V POV (#9000010.07)
"^DD",799.2,799.2,1,23,9,0)
 .    PROBLEM (#9000011)
"^DD",799.2,799.2,1,23,10,0)
 .    PTF (#45)
"^DD",799.2,799.2,1,23,11,0)
 .    LAB DATA (#63)
"^DD",799.2,799.2,1,23,12,0)
 
"^DD",799.2,799.2,1,23,13,0)
This means that for each patient a record in file #2 is
"^DD",799.2,799.2,1,23,14,0)
processed first. Then patient visits from file #9000010
"^DD",799.2,799.2,1,23,15,0)
are processed. During processing of each visit record
"^DD",799.2,799.2,1,23,16,0)
all linked "purpose of visit" records in file
"^DD",799.2,799.2,1,23,17,0)
#9000010.07 are processed. After that, all patient
"^DD",799.2,799.2,1,23,18,0)
records from the problem list are processed. Next in
"^DD",799.2,799.2,1,23,19,0)
line are the patient records from file #45 and the lab
"^DD",799.2,799.2,1,23,20,0)
results.
"^DD",799.2,799.2,1,23,21,0)
 
"^DD",799.2,799.2,1,23,22,0)
The structure of the tree is defined by the routines
"^DD",799.2,799.2,1,23,23,0)
that conduct the search (hard coded loops). However, it
"^DD",799.2,799.2,1,23,24,0)
MUST be reflected in this file.
"^DD",799.2,799.2,1,"DEL",1,0)
I $$VADEL^RORDD(799.2,,-1)
"^DD",799.2,799.2,1,"DT")
3020313
"^DD",799.2,799.2,2,0)
DATA ELEMENT^799.22I^^2;0
"^DD",799.2,799.2,2,9)
@
"^DD",799.2,799.2,2,21,0)
^^8^8^3020403^
"^DD",799.2,799.2,2,21,1,0)
This multiple stores a list of data elements 
"^DD",799.2,799.2,2,21,2,0)
supported by the search engine. These elements can
"^DD",799.2,799.2,2,21,3,0)
be referenced by selection rules associated with
"^DD",799.2,799.2,2,21,4,0)
the file.
"^DD",799.2,799.2,2,21,5,0)
 
"^DD",799.2,799.2,2,21,6,0)
Records of the multiple are uniquely identified by
"^DD",799.2,799.2,2,21,7,0)
the data element name (the primary key "B" and the
"^DD",799.2,799.2,2,21,8,0)
uniqueness index "B" are used for this purpose).
"^DD",799.2,799.2,2,"DT")
3020326
"^DD",799.2,799.2,3,0)
API^799.23I^^3;0
"^DD",799.2,799.2,3,9)
@
"^DD",799.2,799.2,3,21,0)
^^9^9^3020321^
"^DD",799.2,799.2,3,21,1,0)
This multiple stores descriptors of the APIs that
"^DD",799.2,799.2,3,21,2,0)
are used to load values of the search fields.
"^DD",799.2,799.2,3,21,3,0)
 
"^DD",799.2,799.2,3,21,4,0)
Codes of the APIs are unique only in the file
"^DD",799.2,799.2,3,21,5,0)
context. For example, the definition of any file
"^DD",799.2,799.2,3,21,6,0)
can have a descriptor of the API #2.
"^DD",799.2,799.2,3,21,7,0)
 
"^DD",799.2,799.2,3,21,8,0)
Internal entry numbers of the records in this 
"^DD",799.2,799.2,3,21,9,0)
multiple are equal to the codes of the APIs.
"^DD",799.2,799.2,5,0)
DESCRIPTION^799.25^^5;0
"^DD",799.2,799.2,5,9)
@
"^DD",799.2,799.2,5,21,0)
^^3^3^3020403^
"^DD",799.2,799.2,5,21,1,0)
You can enter any additional reference information
"^DD",799.2,799.2,5,21,2,0)
related to the file definition. The content of this
"^DD",799.2,799.2,5,21,3,0)
field is not used by the application.
"^DD",799.2,799.22,0)
DATA ELEMENT SUB-FIELD^^6^8
"^DD",799.2,799.22,0,"DT")
3020326
"^DD",799.2,799.22,0,"ID","WRITE")
D EN^DDIOL("  "_$P(^(0),U,2),,"?35")
"^DD",799.2,799.22,0,"IX","AR",799.22,2)

"^DD",799.2,799.22,0,"IX","C",799.22,.02)

"^DD",799.2,799.22,0,"NM","DATA ELEMENT")

"^DD",799.2,799.22,0,"UP")
799.2
"^DD",799.2,799.22,.01,0)
DATA NAME^MFX^^0;1^Q:$$VAEDT^RORDD(799.2,,-1)  K:($L(X)>30)!($L(X)<3)!(+X=X) X
"^DD",799.2,799.22,.01,1,0)
^.1^^0
"^DD",799.2,799.22,.01,3)
Answer must be 3-30 characters in length.
"^DD",799.2,799.22,.01,8.5)
@
"^DD",799.2,799.22,.01,9)
@
"^DD",799.2,799.22,.01,21,0)
^.001^9^9^3020327^^
"^DD",799.2,799.22,.01,21,1,0)
The value of this field is the name of the data
"^DD",799.2,799.22,.01,21,2,0)
element supported by the search engine. The names 
"^DD",799.2,799.22,.01,21,3,0)
must be unique in the file context.
"^DD",799.2,799.22,.01,21,4,0)
 
"^DD",799.2,799.22,.01,21,5,0)
The data element is supported if either the
"^DD",799.2,799.22,.01,21,6,0)
routine that processes the file can load the value
"^DD",799.2,799.22,.01,21,7,0)
using an application API or there is a DBIA that
"^DD",799.2,799.22,.01,21,8,0)
allows access to the corresponding field via the
"^DD",799.2,799.22,.01,21,9,0)
'GETS^DIQ' FileMan procedure.
"^DD",799.2,799.22,.01,23,0)
^^2^2^3060203^
"^DD",799.2,799.22,.01,23,1,0)
The primary "B" key and the "B" index (new style)
"^DD",799.2,799.22,.01,23,2,0)
guarantee uniqueness of the names in the file context.
"^DD",799.2,799.22,.01,"DEL",1,0)
I $$VADEL^RORDD(799.2,,-1)
"^DD",799.2,799.22,.01,"DT")
3020328
"^DD",799.2,799.22,.02,0)
CODE^RNJ9,0XI^^0;2^Q:$$VAEDT^RORDD(799.2,,-1)  S:X="+" X=$O(^ROR(799.2,"DEC",""),-1)+1 K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",799.2,799.22,.02,1,0)
^.1
"^DD",799.2,799.22,.02,1,1,0)
799.22^C
"^DD",799.2,799.22,.02,1,1,1)
S ^ROR(799.2,DA(1),2,"C",$E(X,1,30),DA)=""
"^DD",799.2,799.22,.02,1,1,2)
K ^ROR(799.2,DA(1),2,"C",$E(X,1,30),DA)
"^DD",799.2,799.22,.02,1,1,3)
List of data element codes.
"^DD",799.2,799.22,.02,1,1,"DT")
3020326
"^DD",799.2,799.22,.02,3)
Type a Number between 1 and 999999999, 0 Decimal Digits.
"^DD",799.2,799.22,.02,8.5)
@
"^DD",799.2,799.22,.02,9)
@
"^DD",799.2,799.22,.02,21,0)
^^7^7^3020327^
"^DD",799.2,799.22,.02,21,1,0)
This field stores the unique code of the data 
"^DD",799.2,799.22,.02,21,2,0)
element. Data elements can be referenced either by
"^DD",799.2,799.22,.02,21,3,0)
their names (only in the file context) or by their
"^DD",799.2,799.22,.02,21,4,0)
codes.
"^DD",799.2,799.22,.02,21,5,0)
 
"^DD",799.2,799.22,.02,21,6,0)
You can enter "+" to get the next available code 
"^DD",799.2,799.22,.02,21,7,0)
for a new data element.
"^DD",799.2,799.22,.02,23,0)
^^3^3^3060203^
"^DD",799.2,799.22,.02,23,1,0)
The secondary "A" key and the whole-file "DEC" index 
"^DD",799.2,799.22,.02,23,2,0)
(new style) guarantee uniqueness of the data element
"^DD",799.2,799.22,.02,23,3,0)
codes.
"^DD",799.2,799.22,.02,"DT")
3020327
"^DD",799.2,799.22,1,0)
LOADER API^RNJ2,0X^^0;5^Q:$$VAEDT^RORDD(799.2,,-1)  K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",799.2,799.22,1,3)
Type a Number between 1 and 99, 0 Decimal Digits.
"^DD",799.2,799.22,1,4)
D APILST^RORDD($G(DA(1)))
"^DD",799.2,799.22,1,8.5)
@
"^DD",799.2,799.22,1,9)
@
"^DD",799.2,799.22,1,21,0)
^^8^8^3020403^
"^DD",799.2,799.22,1,21,1,0)
This field stores the code of the API that is used
"^DD",799.2,799.22,1,21,2,0)
to load a value of the data element defined by the
"^DD",799.2,799.22,1,21,3,0)
descriptor.
"^DD",799.2,799.22,1,21,4,0)
 
"^DD",799.2,799.22,1,21,5,0)
The descriptor of this API must be defined in the
"^DD",799.2,799.22,1,21,6,0)
"API" multiple (subfile #799.23). The only
"^DD",799.2,799.22,1,21,7,0)
exception is the API #1. It is always considered
"^DD",799.2,799.22,1,21,8,0)
as the 'GETS^DIQ' FileMan procedure.
"^DD",799.2,799.22,1,"DT")
3020326
"^DD",799.2,799.22,2,0)
REQUIRED^SX^0:NO;1:YES;^0;3^Q:$$VAEDT^RORDD(799.2,,-1)
"^DD",799.2,799.22,2,1,0)
^.1
"^DD",799.2,799.22,2,1,1,0)
799.22^AR
"^DD",799.2,799.22,2,1,1,1)
S ^ROR(799.2,DA(1),2,"AR",$E(X,1,30),DA)=""
"^DD",799.2,799.22,2,1,1,2)
K ^ROR(799.2,DA(1),2,"AR",$E(X,1,30),DA)
"^DD",799.2,799.22,2,1,1,3)
List of required fields.
"^DD",799.2,799.22,2,1,1,"DT")
3020308
"^DD",799.2,799.22,2,8.5)
@
"^DD",799.2,799.22,2,9)
@
"^DD",799.2,799.22,2,21,0)
^^5^5^3060203^
"^DD",799.2,799.22,2,21,1,0)
If the value of the data element is required by
"^DD",799.2,799.22,2,21,2,0)
the search engine itself, the REQUIRED field
"^DD",799.2,799.22,2,21,3,0)
should be set to "YES" so that the value of the
"^DD",799.2,799.22,2,21,4,0)
element will be loaded whether it is referenced by
"^DD",799.2,799.22,2,21,5,0)
the selection rules or not.
"^DD",799.2,799.22,2,"DEL",1,0)
I $$VADEL^RORDD(799.2,,-1)
"^DD",799.2,799.22,2,"DT")
3020308
"^DD",799.2,799.22,4,0)
VALUE TYPE^RSX^E:External;I:Internal;EI:Both;^0;4^Q:$$VAEDT^RORDD(799.2,,-1)
"^DD",799.2,799.22,4,8.5)
@
"^DD",799.2,799.22,4,9)
@
"^DD",799.2,799.22,4,21,0)
^^4^4^3020328^
"^DD",799.2,799.22,4,21,1,0)
The VALUE TYPE field contains the code of the data
"^DD",799.2,799.22,4,21,2,0)
element value type(s) supported by the search
"^DD",799.2,799.22,4,21,3,0)
engine. The corresponding API must be able to load
"^DD",799.2,799.22,4,21,4,0)
the value(s).
"^DD",799.2,799.22,4,"DT")
3020308
"^DD",799.2,799.22,4.1,0)
EXTERNAL DATA^FX^^4.1;E1,50^Q:$$VAEDT^RORDD(799.2,,-1)  K:$L(X)>50!($L(X)<1) X
"^DD",799.2,799.22,4.1,3)
Answer must be 1-50 characters in length.
"^DD",799.2,799.22,4.1,8.5)
@
"^DD",799.2,799.22,4.1,9)
@
"^DD",799.2,799.22,4.1,21,0)
^^11^11^3060203^
"^DD",799.2,799.22,4.1,21,1,0)
This field can contain any optional data that 
"^DD",799.2,799.22,4.1,21,2,0)
helps to load the external value of the data
"^DD",799.2,799.22,4.1,21,3,0)
element (variable name, subscript, position, 
"^DD",799.2,799.22,4.1,21,4,0)
etc.).
"^DD",799.2,799.22,4.1,21,5,0)
 
"^DD",799.2,799.22,4.1,21,6,0)
Many data elements use the following data
"^DD",799.2,799.22,4.1,21,7,0)
structure: PN[^SN]. The 'SN' is a subscript of the
"^DD",799.2,799.22,4.1,21,8,0)
node in the local array (optional) and the 'PN' is
"^DD",799.2,799.22,4.1,21,9,0)
the number of the "^"-piece of the node value.
"^DD",799.2,799.22,4.1,21,10,0)
These values are used to extract the value from
"^DD",799.2,799.22,4.1,21,11,0)
the local variable created by the API.
"^DD",799.2,799.22,4.1,23,0)
^.001^3^3^3060203^^^^
"^DD",799.2,799.22,4.1,23,1,0)
See definition of the API #2 associated with the file
"^DD",799.2,799.22,4.1,23,2,0)
#45 and source code of the $$LOADFLDS^RORUPD09 function
"^DD",799.2,799.22,4.1,23,3,0)
for an example.
"^DD",799.2,799.22,4.1,"DEL",1,0)
I $$VADEL^RORDD(799.2,,-1)
"^DD",799.2,799.22,4.1,"DT")
3020311
"^DD",799.2,799.22,4.2,0)
INTERNAL DATA^FX^^4.2;E1,50^Q:$$VAEDT^RORDD(799.2,,-1)  K:$L(X)>50!($L(X)<1) X
"^DD",799.2,799.22,4.2,3)
Answer must be 1-50 characters in length.
"^DD",799.2,799.22,4.2,8.5)
@
"^DD",799.2,799.22,4.2,9)
@
"^DD",799.2,799.22,4.2,21,0)
^^11^11^3060203^
"^DD",799.2,799.22,4.2,21,1,0)
This field can contain any optional data that
"^DD",799.2,799.22,4.2,21,2,0)
helps to load the internal value of the data 
"^DD",799.2,799.22,4.2,21,3,0)
element (variable name, subscript, position, 
"^DD",799.2,799.22,4.2,21,4,0)
etc.).
"^DD",799.2,799.22,4.2,21,5,0)
 
"^DD",799.2,799.22,4.2,21,6,0)
Many data elements use the following data
"^DD",799.2,799.22,4.2,21,7,0)
structure: PN[^SN]. The 'SN' is a subscript of the
"^DD",799.2,799.22,4.2,21,8,0)
node in the local array (optional) and the 'PN' is
"^DD",799.2,799.22,4.2,21,9,0)
the number of the "^"-piece of the node value.
"^DD",799.2,799.22,4.2,21,10,0)
These values are used to extract the value from
"^DD",799.2,799.22,4.2,21,11,0)
the local variable created by the API.
"^DD",799.2,799.22,4.2,23,0)
^.001^3^3^3060203^^^^
"^DD",799.2,799.22,4.2,23,1,0)
See definition of the API #2 associated with the file 
"^DD",799.2,799.22,4.2,23,2,0)
#45 and source code of the $$LOADFLDS^RORUPD09 function
"^DD",799.2,799.22,4.2,23,3,0)
for an example.
"^DD",799.2,799.22,4.2,"DEL",1,0)
I $$VADEL^RORDD(799.2,,-1)
"^DD",799.2,799.22,4.2,"DT")
3020311
"^DD",799.2,799.22,6,0)
FIELD NUMBER^NJ19,9X^^0;6^Q:$$VAEDT^RORDD(799.2,,-1)  K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."10.N) X X:$D(X)&$G(DA(1)) "N RORFILE S RORFILE=$P($G(^ROR(799.2,DA(1),0)),U) I RORFILE K:'$$VFIELD^DILFD(RORFILE,X) X"
"^DD",799.2,799.22,6,3)
Type a field number between .000000001 and 999999999, 9 Decimal Digits
"^DD",799.2,799.22,6,8.5)
@
"^DD",799.2,799.22,6,9)
@
"^DD",799.2,799.22,6,21,0)
^^10^10^3020401^
"^DD",799.2,799.22,6,21,1,0)
The FIELD NUMBER field holds the number of the
"^DD",799.2,799.22,6,21,2,0)
field (referenced hereinafter as the search field)
"^DD",799.2,799.22,6,21,3,0)
that the data element is loaded from.
"^DD",799.2,799.22,6,21,4,0)
 
"^DD",799.2,799.22,6,21,5,0)
If the FileMan API #1 (GETS^DIQ) is used to load 
"^DD",799.2,799.22,6,21,6,0)
the value of the data element, the FIELD NUMBER
"^DD",799.2,799.22,6,21,7,0)
field must have a value.
"^DD",799.2,799.22,6,21,8,0)
 
"^DD",799.2,799.22,6,21,9,0)
Otherwise, this field can be empty. However, it is
"^DD",799.2,799.22,6,21,10,0)
recommended to populate it for clarity.
"^DD",799.2,799.22,6,"DEL",1,0)
I $$VADEL^RORDD(799.2,,-1)
"^DD",799.2,799.22,6,"DT")
3020326
"^DD",799.2,799.23,0)
API SUB-FIELD^^2^4
"^DD",799.2,799.23,0,"DT")
3020307
"^DD",799.2,799.23,0,"ID","WRITE")
D EN^DDIOL($P(^(0),U,3)_"^"_$P(^(0),U,2),,"?10")
"^DD",799.2,799.23,0,"IX","B",799.23,.01)

"^DD",799.2,799.23,0,"NM","API")

"^DD",799.2,799.23,0,"UP")
799.2
"^DD",799.2,799.23,.01,0)
API CODE^MNJ2,0X^^0;1^Q:$$VAEDT^RORDD(799.2,,-1)  K:+X'=X!(X>99)!(X<2)!(X?.E1"."1.N) X S:$D(X) DINUM=X
"^DD",799.2,799.23,.01,1,0)
^.1
"^DD",799.2,799.23,.01,1,1,0)
799.23^B
"^DD",799.2,799.23,.01,1,1,1)
S ^ROR(799.2,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",799.2,799.23,.01,1,1,2)
K ^ROR(799.2,DA(1),3,"B",$E(X,1,30),DA)
"^DD",799.2,799.23,.01,1,1,3)
Do not delete!
"^DD",799.2,799.23,.01,3)
Type a Number between 2 and 99, 0 Decimal Digits.
"^DD",799.2,799.23,.01,8.5)
@
"^DD",799.2,799.23,.01,9)
@
"^DD",799.2,799.23,.01,21,0)
^^7^7^3020321^
"^DD",799.2,799.23,.01,21,1,0)
This field stores the code of the API. These codes
"^DD",799.2,799.23,.01,21,2,0)
are used by the corresponding routines of the
"^DD",799.2,799.23,.01,21,3,0)
search engine to distinguish between the APIs.
"^DD",799.2,799.23,.01,21,4,0)
 
"^DD",799.2,799.23,.01,21,5,0)
Codes of the APIs are unique only in the file
"^DD",799.2,799.23,.01,21,6,0)
context. For example, the definition of any file
"^DD",799.2,799.23,.01,21,7,0)
can have a descriptor of the API #2.
"^DD",799.2,799.23,.01,23,0)
^.001^2^2^3020403^^
"^DD",799.2,799.23,.01,23,1,0)
Internal value of this field is used as the internal
"^DD",799.2,799.23,.01,23,2,0)
entry number of the record ('DINUM' feature).
"^DD",799.2,799.23,.01,"DEL",1,0)
I $$VADEL^RORDD(799.2,,-1)
"^DD",799.2,799.23,.01,"DT")
3020308
"^DD",799.2,799.23,1.1,0)
ROUTINE^RFX^^0;2^Q:$$VAEDT^RORDD(799.2,,-1)  K:'(X?1.8UN) X
"^DD",799.2,799.23,1.1,3)
Answer must be a valid routine name (1-8 characters in length).
"^DD",799.2,799.23,1.1,8.5)
@
"^DD",799.2,799.23,1.1,9)
@
"^DD",799.2,799.23,1.1,21,0)
^^2^2^3060203^
"^DD",799.2,799.23,1.1,21,1,0)
This field stores the name of the routine
"^DD",799.2,799.23,1.1,21,2,0)
implementing the API.
"^DD",799.2,799.23,1.1,"DT")
3020308
"^DD",799.2,799.23,1.2,0)
TAG^FX^^0;3^Q:$$VAEDT^RORDD(799.2,,-1)  K:'(X?1.8UN) X
"^DD",799.2,799.23,1.2,3)
Answer must be a valid tag name (1-8 characters in length).
"^DD",799.2,799.23,1.2,8.5)
@
"^DD",799.2,799.23,1.2,9)
@
"^DD",799.2,799.23,1.2,21,0)
^^3^3^3020320^
"^DD",799.2,799.23,1.2,21,1,0)
This field contains a tag name inside the API
"^DD",799.2,799.23,1.2,21,2,0)
routine. If the routine should be executed from 
"^DD",799.2,799.23,1.2,21,3,0)
the beginning, leave this field empty.
"^DD",799.2,799.23,1.2,"DEL",1,0)
I $$VADEL^RORDD(799.2,,-1)
"^DD",799.2,799.23,1.2,"DT")
3020308
"^DD",799.2,799.23,2,0)
IA#^NJ9,0X^^0;4^Q:$$VAEDT^RORDD(799.2,,-1)  K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1.N) X
"^DD",799.2,799.23,2,.1)

"^DD",799.2,799.23,2,3)
Type a Number between 1 and 999999999, 0 Decimal Digits.
"^DD",799.2,799.23,2,8.5)
@
"^DD",799.2,799.23,2,9)
@
"^DD",799.2,799.23,2,21,0)
^.001^2^2^3060203^^
"^DD",799.2,799.23,2,21,1,0)
The IA# field stores a reference number of the 
"^DD",799.2,799.23,2,21,2,0)
integration agreement that describes this API.
"^DD",799.2,799.23,2,"DEL",1,0)
I $$VADEL^RORDD(799.2,,-1)
"^DD",799.2,799.23,2,"DT")
3020308
"^DD",799.2,799.25,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",799.2,799.25,0,"DT")
3020308
"^DD",799.2,799.25,0,"NM","DESCRIPTION")

"^DD",799.2,799.25,0,"UP")
799.2
"^DD",799.2,799.25,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",799.2,799.25,.01,8.5)
@
"^DD",799.2,799.25,.01,9)
@
"^DD",799.2,799.25,.01,"DT")
3020308
"^DD",799.31,799.31,0)
FIELD^^.01^1
"^DD",799.31,799.31,0,"DDA")
N
"^DD",799.31,799.31,0,"DT")
3021130
"^DD",799.31,799.31,0,"NM","ROR XML ITEM")

"^DD",799.31,799.31,0,"PT",798.87,.01)

"^DD",799.31,799.31,0,"PT",798.872,.01)

"^DD",799.31,799.31,0,"VRPK")
ROR
"^DD",799.31,799.31,.01,0)
NAME^RFX^^0;1^Q:$$VAEDT^RORDD(799.31,,-1)  K:$L(X)>30!($L(X)<2)!'(X'?1P.E) X
"^DD",799.31,799.31,.01,1,0)
^.1^^0
"^DD",799.31,799.31,.01,3)
Enter the tag name (2-30 characters).
"^DD",799.31,799.31,.01,8.5)
@
"^DD",799.31,799.31,.01,9)
@
"^DD",799.31,799.31,.01,21,0)
^.001^4^4^3030506^^
"^DD",799.31,799.31,.01,21,1,0)
This field stores the tag name. The name should 
"^DD",799.31,799.31,.01,21,2,0)
not contain spaces and any punctuation marks 
"^DD",799.31,799.31,.01,21,3,0)
except underscore. See an XML reference guide for
"^DD",799.31,799.31,.01,21,4,0)
more details.
"^DD",799.31,799.31,.01,23,0)
^^4^4^3060203^
"^DD",799.31,799.31,.01,23,1,0)
Please use shorter names for tags that will be used
"^DD",799.31,799.31,.01,23,2,0)
more often and/or will be repeated many times in the
"^DD",799.31,799.31,.01,23,3,0)
report. This will decrease amount of the overhead data
"^DD",799.31,799.31,.01,23,4,0)
transmitted from the server to the GUI.
"^DD",799.31,799.31,.01,"DEL",1,0)
I $$VADEL^RORDD(799.31,,-1)
"^DD",799.31,799.31,.01,"DT")
3050722
"^DD",799.33,799.33,0)
FIELD^^.01^2
"^DD",799.33,799.33,0,"DDA")
N
"^DD",799.33,799.33,0,"DT")
3030606
"^DD",799.33,799.33,0,"IX","B",799.33,.01)

"^DD",799.33,799.33,0,"NM","ROR DATA AREA")

"^DD",799.33,799.33,0,"PT",798.32,1)

"^DD",799.33,799.33,0,"PT",799.61,.01)

"^DD",799.33,799.33,0,"VRPK")
ROR
"^DD",799.33,799.33,.001,0)
NUMBER^NJ2,0^^ ^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",799.33,799.33,.001,3)
Type a Number between 1 and 99, 0 Decimal Digits.
"^DD",799.33,799.33,.001,8.5)
@
"^DD",799.33,799.33,.001,9)
@
"^DD",799.33,799.33,.001,"DT")
3030606
"^DD",799.33,799.33,.01,0)
NAME^RFX^^0;1^Q:$$VAEDT^RORDD(799.33,,-1)  K:$L(X)>30!($L(X)<2)!'(X'?1P.E) X
"^DD",799.33,799.33,.01,1,0)
^.1
"^DD",799.33,799.33,.01,1,1,0)
799.33^B
"^DD",799.33,799.33,.01,1,1,1)
S ^ROR(799.33,"B",$E(X,1,30),DA)=""
"^DD",799.33,799.33,.01,1,1,2)
K ^ROR(799.33,"B",$E(X,1,30),DA)
"^DD",799.33,799.33,.01,1,1,3)
Do not delete!
"^DD",799.33,799.33,.01,3)
Enter name of the data area (2-30 characters).
"^DD",799.33,799.33,.01,8.5)
@
"^DD",799.33,799.33,.01,9)
@
"^DD",799.33,799.33,.01,21,0)
^^4^4^3050427^
"^DD",799.33,799.33,.01,21,1,0)
This field stores the name of the data area 
"^DD",799.33,799.33,.01,21,2,0)
referenced by the DATA AREA fields of the HL7
"^DD",799.33,799.33,.01,21,3,0)
SEGMENT (the ROR REGISTRY PARAMETERS file) and
"^DD",799.33,799.33,.01,21,4,0)
EVENT (the ROR PATIENT EVENTS file) multiples.
"^DD",799.33,799.33,.01,"DEL",1,0)
I $$VADEL^RORDD(799.33,,-1)
"^DD",799.33,799.33,.01,"DT")
3030606
"^DD",799.34,799.34,0)
FIELD^^12^10
"^DD",799.34,799.34,0,"DDA")
N
"^DD",799.34,799.34,0,"DT")
3051121
"^DD",799.34,799.34,0,"IX","B",799.34,.01)

"^DD",799.34,799.34,0,"NM","ROR REPORT PARAMETERS")

"^DD",799.34,799.34,0,"PT",798.12,.01)

"^DD",799.34,799.34,0,"PT",798.8,.04)

"^DD",799.34,799.34,0,"VRPK")
ROR
"^DD",799.34,799.34,.01,0)
NAME^RFX^^0;1^Q:$$VAEDT^RORDD(799.34,$G(DA))  K:$L(X)>60!($L(X)<3)!'(X'?1P.E) X
"^DD",799.34,799.34,.01,1,0)
^.1
"^DD",799.34,799.34,.01,1,1,0)
799.34^B
"^DD",799.34,799.34,.01,1,1,1)
S ^ROR(799.34,"B",$E(X,1,30),DA)=""
"^DD",799.34,799.34,.01,1,1,2)
K ^ROR(799.34,"B",$E(X,1,30),DA)
"^DD",799.34,799.34,.01,1,1,3)
Do not delete!
"^DD",799.34,799.34,.01,3)
Enter the report name (3-60 characters).
"^DD",799.34,799.34,.01,8.5)
@
"^DD",799.34,799.34,.01,9)
@
"^DD",799.34,799.34,.01,21,0)
^^5^5^3030505^
"^DD",799.34,799.34,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",799.34,799.34,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.34,799.34,.01,21,3,0)
 
"^DD",799.34,799.34,.01,21,4,0)
The name of the report stored in the NAME field is
"^DD",799.34,799.34,.01,21,5,0)
displayed in the Reports sub-menu of the GUI.
"^DD",799.34,799.34,.01,"DEL",1,0)
I $$VADEL^RORDD(799.34,$G(DA))
"^DD",799.34,799.34,.01,"DT")
3021126
"^DD",799.34,799.34,.02,0)
BACKGROUND PROCESSING?^SX^0:NO;1:YES;^0;2^Q:$$VAEDT^RORDD(799.34,$G(DA))
"^DD",799.34,799.34,.02,8.5)
@
"^DD",799.34,799.34,.02,9)
@
"^DD",799.34,799.34,.02,21,0)
^^6^6^3030506^
"^DD",799.34,799.34,.02,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",799.34,799.34,.02,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.34,799.34,.02,21,3,0)
 
"^DD",799.34,799.34,.02,21,4,0)
If the BACKGROUND PROCESSING? field is set to
"^DD",799.34,799.34,.02,21,5,0)
'YES' then the report will be scheduled to run as
"^DD",799.34,799.34,.02,21,6,0)
a background task.
"^DD",799.34,799.34,.02,23,0)
^^1^1^3030506^
"^DD",799.34,799.34,.02,23,1,0)
Only background processing is currently implemented.
"^DD",799.34,799.34,.02,"DEL",1,0)
I $$VADEL^RORDD(799.34,$G(DA))
"^DD",799.34,799.34,.02,"DT")
3021127
"^DD",799.34,799.34,.03,0)
SHARED TEMPLATES^SX^0:NO;1:YES;^0;3^Q:$$VAEDT^RORDD(799.34,$G(DA))
"^DD",799.34,799.34,.03,8.5)
@
"^DD",799.34,799.34,.03,9)
@
"^DD",799.34,799.34,.03,21,0)
^^7^7^3051121^
"^DD",799.34,799.34,.03,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",799.34,799.34,.03,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.34,799.34,.03,21,3,0)
 
"^DD",799.34,799.34,.03,21,4,0)
If this field is set to 'YES', then report 
"^DD",799.34,799.34,.03,21,5,0)
parameter templates are shared between all 
"^DD",799.34,799.34,.03,21,6,0)
registries. Otherwise, the templates are 
"^DD",799.34,799.34,.03,21,7,0)
registry-specific.
"^DD",799.34,799.34,.03,"DEL",1,0)
I $$VADEL^RORDD(799.34,$G(DA))
"^DD",799.34,799.34,.03,"DT")
3051121
"^DD",799.34,799.34,.04,0)
CODE^RNJ3,0X^^0;4^Q:$$VAEDT^RORDD(799.34,$G(DA))  K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",799.34,799.34,.04,3)
Enter the unique report code (between 1 and 999, 0 Decimal Digits).
"^DD",799.34,799.34,.04,8.5)
@
"^DD",799.34,799.34,.04,9)
@
"^DD",799.34,799.34,.04,21,0)
^^5^5^3030505^
"^DD",799.34,799.34,.04,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",799.34,799.34,.04,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.34,799.34,.04,21,3,0)
 
"^DD",799.34,799.34,.04,21,4,0)
The CODE field stores the unique code of the
"^DD",799.34,799.34,.04,21,5,0)
report.
"^DD",799.34,799.34,.04,23,0)
^^19^19^3030507^
"^DD",799.34,799.34,.04,23,1,0)
The corresponding XSL templates for the report are 
"^DD",799.34,799.34,.04,23,2,0)
stored in the DIALOG file (#.84). The dialog number 
"^DD",799.34,799.34,.04,23,3,0)
of the template has the following structure:
"^DD",799.34,799.34,.04,23,4,0)
 
"^DD",799.34,799.34,.04,23,5,0)
 7981CCC.TTT
"^DD",799.34,799.34,.04,23,6,0)
 
"^DD",799.34,799.34,.04,23,7,0)
 'CCC' is the code of the report.
"^DD",799.34,799.34,.04,23,8,0)
 
"^DD",799.34,799.34,.04,23,9,0)
 'TTT' is the type of the template:
"^DD",799.34,799.34,.04,23,10,0)
        001 - HTML Preview,
"^DD",799.34,799.34,.04,23,11,0)
        002 - Delimited Format (CSV),
"^DD",799.34,799.34,.04,23,12,0)
        003 - Printer Output.
"^DD",799.34,799.34,.04,23,13,0)
 
"^DD",799.34,799.34,.04,23,14,0)
For example, the dialog 7981001.001 contains the HTML
"^DD",799.34,799.34,.04,23,15,0)
preview template for the List of Registry Patients
"^DD",799.34,799.34,.04,23,16,0)
(report code: 1).
"^DD",799.34,799.34,.04,23,17,0)
 
"^DD",799.34,799.34,.04,23,18,0)
If no template is defined for the report then the
"^DD",799.34,799.34,.04,23,19,0)
default template from dialog 7981000 is used.
"^DD",799.34,799.34,.04,"DT")
3030401
"^DD",799.34,799.34,.05,0)
DATE OF INACTIVATION^D^^0;5^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",799.34,799.34,.05,21,0)
^^5^5^3030505^
"^DD",799.34,799.34,.05,21,1,0)
If this field has a value, the report will be
"^DD",799.34,799.34,.05,21,2,0)
considered inactive after this date. Use this
"^DD",799.34,799.34,.05,21,3,0)
field to disable unnecessary reports (and hide
"^DD",799.34,799.34,.05,21,4,0)
them from the Report sub-menu of the GUI) instead
"^DD",799.34,799.34,.05,21,5,0)
of deleting them.
"^DD",799.34,799.34,.05,23,0)
^^3^3^3030505^
"^DD",799.34,799.34,.05,23,1,0)
The ROR REPORTS AVAILABLE remote procedure analyzes
"^DD",799.34,799.34,.05,23,2,0)
this field when it loads the list of available reports
"^DD",799.34,799.34,.05,23,3,0)
and skips the inactive ones.
"^DD",799.34,799.34,.05,"DT")
3021126
"^DD",799.34,799.34,.09,0)
NATIONAL^SX^0:NO;1:YES;^0;9^Q:$$VAEDT^RORDD(799.34,,-1)
"^DD",799.34,799.34,.09,8.5)
@
"^DD",799.34,799.34,.09,9)
@
"^DD",799.34,799.34,.09,21,0)
^^7^7^3030506^
"^DD",799.34,799.34,.09,21,1,0)
ONLY AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN
"^DD",799.34,799.34,.09,21,2,0)
EDIT THIS FIELD!
"^DD",799.34,799.34,.09,21,3,0)
 
"^DD",799.34,799.34,.09,21,4,0)
Reports distributed with the national registries
"^DD",799.34,799.34,.09,21,5,0)
must have this field set to "YES". This prevents
"^DD",799.34,799.34,.09,21,6,0)
local editing of other fields of report
"^DD",799.34,799.34,.09,21,7,0)
definitions.
"^DD",799.34,799.34,.09,"DEL",1,0)
I $$VADEL^RORDD(799.34,,,-1)
"^DD",799.34,799.34,.09,"DT")
3021126
"^DD",799.34,799.34,1,0)
PARAMETER PANELS^FX^^1;E1,250^Q:$$VAEDT^RORDD(799.34,$G(DA))  K:$L(X)>250!($L(X)<1) X
"^DD",799.34,799.34,1,3)
Enter codes of dialog panels separated by commas (1-250 characters).
"^DD",799.34,799.34,1,8.5)
@
"^DD",799.34,799.34,1,9)
@
"^DD",799.34,799.34,1,21,0)
^^7^7^3030507^
"^DD",799.34,799.34,1,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",799.34,799.34,1,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.34,799.34,1,21,3,0)
 
"^DD",799.34,799.34,1,21,4,0)
The PARAMETER PANELS field stores the list of 
"^DD",799.34,799.34,1,21,5,0)
panel codes separated by commas. The panels are 
"^DD",799.34,799.34,1,21,6,0)
combined by the GUI into the dialog form that is
"^DD",799.34,799.34,1,21,7,0)
used to request values of the report parameters.
"^DD",799.34,799.34,1,"DEL",1,0)
I $$VADEL^RORDD(799.34,$G(DA))
"^DD",799.34,799.34,1,"DT")
3030304
"^DD",799.34,799.34,10.01,0)
REPORT BUILDER^RFX^^10.01;E1,245^Q:$$VAEDT^RORDD(799.34,$G(DA))  Q:$$EP^RORDD(1)
"^DD",799.34,799.34,10.01,3)
Answer must be $$TAG^ROUTINE (5-19 characters in length).
"^DD",799.34,799.34,10.01,8.5)
@
"^DD",799.34,799.34,10.01,9)
@
"^DD",799.34,799.34,10.01,21,0)
^.001^6^6^3060106^^
"^DD",799.34,799.34,10.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",799.34,799.34,10.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.34,799.34,10.01,21,3,0)
 
"^DD",799.34,799.34,10.01,21,4,0)
The REPORT BUILDER field stores a reference to the
"^DD",799.34,799.34,10.01,21,5,0)
function that is used to build the report (the
"^DD",799.34,799.34,10.01,21,6,0)
report builder).
"^DD",799.34,799.34,10.01,23,0)
^^24^24^3060106^
"^DD",799.34,799.34,10.01,23,1,0)
The call-back entry point is called with a single
"^DD",799.34,799.34,10.01,23,2,0)
parameter. The parameter is a reference to a local
"^DD",799.34,799.34,10.01,23,3,0)
variable that contains values of the report parameters.
"^DD",799.34,799.34,10.01,23,4,0)
 
"^DD",799.34,799.34,10.01,23,5,0)
 RORTSK(            Task Number
"^DD",799.34,799.34,10.01,23,6,0)
 
"^DD",799.34,799.34,10.01,23,7,0)
   "EP")            Entry Point ($$TAG^ROUTINE)
"^DD",799.34,799.34,10.01,23,8,0)
 
"^DD",799.34,799.34,10.01,23,9,0)
   "PARAMS",...)    See the CCR Programmer's Reference 
"^DD",799.34,799.34,10.01,23,10,0)
                    Manual for details
"^DD",799.34,799.34,10.01,23,11,0)
 
"^DD",799.34,799.34,10.01,23,12,0)
   "REGIEN")        Registry IEN
"^DD",799.34,799.34,10.01,23,13,0)
 
"^DD",799.34,799.34,10.01,23,14,0)
   "TYPE")          Type of the Task
"^DD",799.34,799.34,10.01,23,15,0)
   "REPORT")        Code of the Report
"^DD",799.34,799.34,10.01,23,16,0)
   "SCHCODE")       Rescheduling Code
"^DD",799.34,799.34,10.01,23,17,0)
 
"^DD",799.34,799.34,10.01,23,18,0)
The function must return 0 in the case of successful
"^DD",799.34,799.34,10.01,23,19,0)
completion. Otherwise, a negative error code must be 
"^DD",799.34,799.34,10.01,23,20,0)
returned.
"^DD",799.34,799.34,10.01,23,21,0)
 
"^DD",799.34,799.34,10.01,23,22,0)
See description of the ROR REPORT SCHEDULE remote
"^DD",799.34,799.34,10.01,23,23,0)
procedure and source code of the RORTSK01 routine for
"^DD",799.34,799.34,10.01,23,24,0)
more details.
"^DD",799.34,799.34,10.01,"DT")
3021126
"^DD",799.34,799.34,11,0)
DEFAULT PARAMETERS^799.3411^^11;0
"^DD",799.34,799.34,11,9)
@
"^DD",799.34,799.34,11,21,0)
^.001^2^2^3040124^^
"^DD",799.34,799.34,11,21,1,0)
This field stores the default values for the 
"^DD",799.34,799.34,11,21,2,0)
report parameters (in the NAME=VALUE format).
"^DD",799.34,799.34,12,0)
DEFAULT SORTING^799.3412^^12;0
"^DD",799.34,799.34,12,9)
@
"^DD",799.34,799.34,12,21,0)
^^2^2^3040121^
"^DD",799.34,799.34,12,21,1,0)
This field stores the default sorting modes for
"^DD",799.34,799.34,12,21,2,0)
the report (in the TABLE=FIELD format).
"^DD",799.34,799.3411,0)
DEFAULT PARAMETERS SUB-FIELD^^.01^1
"^DD",799.34,799.3411,0,"DT")
3030918
"^DD",799.34,799.3411,0,"NM","DEFAULT PARAMETERS")

"^DD",799.34,799.3411,0,"UP")
799.34
"^DD",799.34,799.3411,.01,0)
DEFAULT PARAMETERS^WL^^0;1^Q
"^DD",799.34,799.3411,.01,8.5)
@
"^DD",799.34,799.3411,.01,9)
@
"^DD",799.34,799.3411,.01,"DT")
3030918
"^DD",799.34,799.3412,0)
DEFAULT SORTING SUB-FIELD^^.01^1
"^DD",799.34,799.3412,0,"DT")
3031103
"^DD",799.34,799.3412,0,"NM","DEFAULT SORTING")

"^DD",799.34,799.3412,0,"UP")
799.34
"^DD",799.34,799.3412,.01,0)
DEFAULT SORTING^WL^^0;1^Q
"^DD",799.34,799.3412,.01,8.5)
@
"^DD",799.34,799.3412,.01,9)
@
"^DD",799.34,799.3412,.01,"DT")
3031103
"^DD",799.4,799.4,0)
FIELD^^25^100
"^DD",799.4,799.4,0,"DDA")
N
"^DD",799.4,799.4,0,"DT")
3030417
"^DD",799.4,799.4,0,"IX","B",799.4,.01)

"^DD",799.4,799.4,0,"NM","ROR HIV RECORD")

"^DD",799.4,799.4,0,"SCR")
I $$ACCESS^RORDD(799.4,"VA ICR",1)
"^DD",799.4,799.4,0,"VRPK")
ROR
"^DD",799.4,799.4,.01,0)
REGISTRY RECORD^RP798'XI^RORDATA(798,^0;1^S:$D(X) DINUM=X
"^DD",799.4,799.4,.01,1,0)
^.1
"^DD",799.4,799.4,.01,1,1,0)
799.4^B
"^DD",799.4,799.4,.01,1,1,1)
S ^RORDATA(799.4,"B",$E(X,1,30),DA)=""
"^DD",799.4,799.4,.01,1,1,2)
K ^RORDATA(799.4,"B",$E(X,1,30),DA)
"^DD",799.4,799.4,.01,1,1,3)
Do not delete!
"^DD",799.4,799.4,.01,3)

"^DD",799.4,799.4,.01,8.5)
@
"^DD",799.4,799.4,.01,9)
@
"^DD",799.4,799.4,.01,21,0)
^.001^7^7^3050504^^^
"^DD",799.4,799.4,.01,21,1,0)
The REGISTRY RECORD field links a record of the 
"^DD",799.4,799.4,.01,21,2,0)
ROR HIV RECORD file to the main registry record in
"^DD",799.4,799.4,.01,21,3,0)
the ROR REGISTRY RECORD file.
"^DD",799.4,799.4,.01,21,4,0)
 
"^DD",799.4,799.4,.01,21,5,0)
You can access records of this file only if you 
"^DD",799.4,799.4,.01,21,6,0)
have appropriate security key(s) for the Human
"^DD",799.4,799.4,.01,21,7,0)
Immunodeficiency Virus Registry.
"^DD",799.4,799.4,.01,23,0)
^.001^5^5^3050504^^^^
"^DD",799.4,799.4,.01,23,1,0)
Internal value of this field is used as the internal
"^DD",799.4,799.4,.01,23,2,0)
entry number of the record (the 'DINUM' feature).
"^DD",799.4,799.4,.01,23,3,0)
Therefore, the corresponding records of this file and
"^DD",799.4,799.4,.01,23,4,0)
the ROR REGISTRY RECORD file have the same internal
"^DD",799.4,799.4,.01,23,5,0)
entry numbers.
"^DD",799.4,799.4,.01,"DT")
3031028
"^DD",799.4,799.4,.02,0)
CLINICAL AIDS^S^0:NO;1:YES;^0;2^Q
"^DD",799.4,799.4,.02,21,0)
^^3^3^3060203^
"^DD",799.4,799.4,.02,21,1,0)
The CLINICAL AIDS field indicates if the 
"^DD",799.4,799.4,.02,21,2,0)
clinical AIDS (category 4) was diagnosed for 
"^DD",799.4,799.4,.02,21,3,0)
the patient.
"^DD",799.4,799.4,.02,"DT")
3030407
"^DD",799.4,799.4,.03,0)
CLINICAL AIDS DATE^D^^0;3^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,.03,21,0)
^^3^3^3030507^
"^DD",799.4,799.4,.03,21,1,0)
The CLINICAL AIDS DATE field stores the date of 
"^DD",799.4,799.4,.03,21,2,0)
the clinical AIDS diagnosis indicated by the 
"^DD",799.4,799.4,.03,21,3,0)
CLINICAL AIDS field.
"^DD",799.4,799.4,.03,"DT")
3030407
"^DD",799.4,799.4,.04,0)
STATION^P4'^DIC(4,^0;4^Q
"^DD",799.4,799.4,.04,.1)
Institution
"^DD",799.4,799.4,.04,3)
Enter the name of the institution completing the form.
"^DD",799.4,799.4,.04,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,.04,21,1,0)
This field is a pointer to the Institution file 
"^DD",799.4,799.4,.04,21,2,0)
(#4) and identifies the name of the station
"^DD",799.4,799.4,.04,21,3,0)
completing the Center for Disease Control (CDC) 
"^DD",799.4,799.4,.04,21,4,0)
HIV/AIDS form.
"^DD",799.4,799.4,.04,"DT")
2871217
"^DD",799.4,799.4,9.01,0)
DATE CDC FORM COMPLETED^D^^9;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,9.01,.1)
CDC Form Date
"^DD",799.4,799.4,9.01,3)
Enter date CDC Form is being completed.
"^DD",799.4,799.4,9.01,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.01,20,1,0)
CDC HEADER
"^DD",799.4,799.4,9.01,21,0)
^.001^2^2^3030506^^^^
"^DD",799.4,799.4,9.01,21,1,0)
This field is used to track the date on which the 
"^DD",799.4,799.4,9.01,21,2,0)
CDC form was completed.
"^DD",799.4,799.4,9.01,"DT")
3030411
"^DD",799.4,799.4,9.02,0)
STATUS AT REPORT^S^1:HIV (NOT AIDS);2:AIDS;^9;2^Q
"^DD",799.4,799.4,9.02,3)
This is the status indicator at the time of generating the HIV/AIDS report form.
"^DD",799.4,799.4,9.02,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.02,20,1,0)
CDC FORM (III)
"^DD",799.4,799.4,9.02,21,0)
^^3^3^3030507^
"^DD",799.4,799.4,9.02,21,1,0)
This field is used to indicate the status of the 
"^DD",799.4,799.4,9.02,21,2,0)
patient at the time a CDC HIV/AIDS form is
"^DD",799.4,799.4,9.02,21,3,0)
generated.
"^DD",799.4,799.4,9.02,"DT")
2940628
"^DD",799.4,799.4,9.03,0)
AGE AT HIV DIAGNOSIS^NJ2,0^^9;3^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1N.N) X
"^DD",799.4,799.4,9.03,3)
This is the age at which HIV was diagnosed in this patient. Type a Number between 0 and 99, 0 Decimal Digits.
"^DD",799.4,799.4,9.03,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.03,20,1,0)
CDC FORM (III)
"^DD",799.4,799.4,9.03,21,0)
^.001^3^3^3060203^^^^
"^DD",799.4,799.4,9.03,21,1,0)
This field contains the age at which HIV was 
"^DD",799.4,799.4,9.03,21,2,0)
diagnosed in this patient. The value is used for a
"^DD",799.4,799.4,9.03,21,3,0)
field on the CDC HIV/AIDS form.
"^DD",799.4,799.4,9.03,"DT")
2940628
"^DD",799.4,799.4,9.04,0)
AGE AT AIDS DIAGNOSIS^NJ3,0^^9;4^K:+X'=X!(X>100)!(X<0)!(X?.E1"."1N.N) X
"^DD",799.4,799.4,9.04,.1)
Age at AIDS Diagnosis
"^DD",799.4,799.4,9.04,3)
Enter patient's age at diagnosis of AIDS. Type a number between 0-100, 0 decimal digits.
"^DD",799.4,799.4,9.04,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.04,20,1,0)
CDC FORM (III)
"^DD",799.4,799.4,9.04,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,9.04,21,1,0)
This field is used to indicate the patient's age 
"^DD",799.4,799.4,9.04,21,2,0)
at the time that the diagnosis of AIDS was made.
"^DD",799.4,799.4,9.04,21,3,0)
The field is used to print part III of the CDC
"^DD",799.4,799.4,9.04,21,4,0)
form.
"^DD",799.4,799.4,9.04,"DT")
2880114
"^DD",799.4,799.4,9.05,0)
CDC FORM COMPLETED BY^P200'^VA(200,^9;5^Q
"^DD",799.4,799.4,9.05,3)

"^DD",799.4,799.4,9.05,8.5)
@
"^DD",799.4,799.4,9.05,9)
@
"^DD",799.4,799.4,9.05,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.05,20,1,0)
CDC HEADER
"^DD",799.4,799.4,9.05,"DT")
3030417
"^DD",799.4,799.4,9.06,0)
STATE/TERRITORY OF DEATH^F^^9;6^K:$L(X)>24!($L(X)<2) X
"^DD",799.4,799.4,9.06,3)
Enter the State or Territory in which the patient's death occurred. Answer must be 2-24 characters in length.
"^DD",799.4,799.4,9.06,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.06,20,1,0)
CDC FORM (III)
"^DD",799.4,799.4,9.06,21,0)
^.001^4^4^3030506^^
"^DD",799.4,799.4,9.06,21,1,0)
This field is used to hold the name of the state 
"^DD",799.4,799.4,9.06,21,2,0)
or territory in which the patient died. This
"^DD",799.4,799.4,9.06,21,3,0)
information is used to generate the CDC HIV/AIDS
"^DD",799.4,799.4,9.06,21,4,0)
form.
"^DD",799.4,799.4,9.06,"DT")
2950313
"^DD",799.4,799.4,9.07,0)
COUNTRY OF BIRTH^S^1:U.S.;7:U.S. DEPENDENCIES AND POSSESSIONS (INCLUDING PUERTO RICO);8:OTHER;9:UNKNOWN;^9;7^Q
"^DD",799.4,799.4,9.07,3)
Enter the number (or name) indicating the country of birth. NOTE that U.S. Dependencies and possessions includes Puerto Rico.
"^DD",799.4,799.4,9.07,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.07,20,1,0)
CDC FORM (III)
"^DD",799.4,799.4,9.07,21,0)
^^8^8^3060203^
"^DD",799.4,799.4,9.07,21,1,0)
This is the country of birth information for this 
"^DD",799.4,799.4,9.07,21,2,0)
patient for use on the revised CDC form. The
"^DD",799.4,799.4,9.07,21,3,0)
options for this information on the current form 
"^DD",799.4,799.4,9.07,21,4,0)
differ from those available on the earlier CDC
"^DD",799.4,799.4,9.07,21,5,0)
form.
"^DD",799.4,799.4,9.07,21,6,0)
 
"^DD",799.4,799.4,9.07,21,7,0)
The name for either 7 or 8 should be entered in 
"^DD",799.4,799.4,9.07,21,8,0)
the appropriate place.
"^DD",799.4,799.4,9.07,"DT")
3030506
"^DD",799.4,799.4,9.08,0)
DEPENDENCY OR POSSESSION NAME^F^^9;8^K:$L(X)>15!($L(X)<2) X
"^DD",799.4,799.4,9.08,3)
Enter the name of the U.S. Dependency or Possession in which the patient was born (2-15 characters).
"^DD",799.4,799.4,9.08,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.08,20,1,0)
CDC FORM (III)
"^DD",799.4,799.4,9.08,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,9.08,21,1,0)
This field is used to enter the name of the 
"^DD",799.4,799.4,9.08,21,2,0)
country of birth when the country of birth is
"^DD",799.4,799.4,9.08,21,3,0)
indicated as a U.S. dependency or possession on 
"^DD",799.4,799.4,9.08,21,4,0)
the revised CDC form.
"^DD",799.4,799.4,9.08,"DT")
2930331
"^DD",799.4,799.4,9.09,0)
OTHER COUNTRY DESCRIPTION^F^^9;9^K:$L(X)>15!($L(X)<3) X
"^DD",799.4,799.4,9.09,.1)
Other Country Name
"^DD",799.4,799.4,9.09,3)
If patient's country of birth is 'Other', enter name (3-15 characters).
"^DD",799.4,799.4,9.09,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.09,20,1,0)
CDC FORM (III)
"^DD",799.4,799.4,9.09,21,0)
^^5^5^3060203^
"^DD",799.4,799.4,9.09,21,1,0)
This field is used to enter the name of the 
"^DD",799.4,799.4,9.09,21,2,0)
country of birth if OTHER was selected as a value 
"^DD",799.4,799.4,9.09,21,3,0)
of the COUNTRY OF BIRTH field. If the field is not
"^DD",799.4,799.4,9.09,21,4,0)
blank, then it is printed in part III of the CDC
"^DD",799.4,799.4,9.09,21,5,0)
form.
"^DD",799.4,799.4,9.09,"DT")
2871217
"^DD",799.4,799.4,9.1,0)
ONSET OF ILLNESS/AIDS- CITY^F^^9;10^K:$L(X)>15!($L(X)<3) X
"^DD",799.4,799.4,9.1,.1)
City at Onset of Illness Suggestive of AIDS
"^DD",799.4,799.4,9.1,3)
Enter city of residence at onset of illness suggestive of AIDS diagnosis. Answer must be 3-15 characters in length.
"^DD",799.4,799.4,9.1,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.1,20,1,0)
CDC FORM (III)
"^DD",799.4,799.4,9.1,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,9.1,21,1,0)
This is the city in which the patient was residing
"^DD",799.4,799.4,9.1,21,2,0)
at the onset of an illness suggestive of AIDS.
"^DD",799.4,799.4,9.1,21,3,0)
This field is used in printing part III of the CDC
"^DD",799.4,799.4,9.1,21,4,0)
form.
"^DD",799.4,799.4,9.1,"DT")
3030211
"^DD",799.4,799.4,9.11,0)
ONSET OF ILLNESS/AIDS- COUNTY^F^^9;11^K:$L(X)>15!($L(X)<3) X
"^DD",799.4,799.4,9.11,.1)
County at Onset of Illness Suggestive of AIDS
"^DD",799.4,799.4,9.11,3)
Enter county of residence at onset of illness suggestive of AIDS diagnosis. Answer must be 3-15 characters in length.
"^DD",799.4,799.4,9.11,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.11,20,1,0)
CDC FORM (III)
"^DD",799.4,799.4,9.11,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,9.11,21,1,0)
This field is used to indicate the COUNTY in which
"^DD",799.4,799.4,9.11,21,2,0)
the patient was residing at the onset of an
"^DD",799.4,799.4,9.11,21,3,0)
illness suggestive of AIDS. This field is used in
"^DD",799.4,799.4,9.11,21,4,0)
printing part III of the CDC form.
"^DD",799.4,799.4,9.11,"DT")
3030211
"^DD",799.4,799.4,9.12,0)
ONSET OF ILLNESS/AIDS- STATE^P5'^DIC(5,^9;12^Q
"^DD",799.4,799.4,9.12,.1)
State at Onset of Illness Suggestive of AIDS
"^DD",799.4,799.4,9.12,3)
Enter patient's state of residence at onset of illness sugesstive of AIDS.
"^DD",799.4,799.4,9.12,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.12,20,1,0)
CDC FORM (III)
"^DD",799.4,799.4,9.12,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,9.12,21,1,0)
This field is used to indicate the STATE in which 
"^DD",799.4,799.4,9.12,21,2,0)
the patient was residing at the time of onset of
"^DD",799.4,799.4,9.12,21,3,0)
an illness suggestive of AIDS. This field is used
"^DD",799.4,799.4,9.12,21,4,0)
in printing part III of the CDC form.
"^DD",799.4,799.4,9.12,"DT")
3030211
"^DD",799.4,799.4,9.13,0)
ONSET OF ILLNESS/AIDS- COUNTRY^F^^9;13^K:$L(X)>15!($L(X)<3) X
"^DD",799.4,799.4,9.13,.1)
Country at Onset of Illness Suggestive of AIDS
"^DD",799.4,799.4,9.13,3)
Enter patient's country of residence at onset of illness suggestive of AIDS. Answer must be 3-15 characters in length.
"^DD",799.4,799.4,9.13,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.13,20,1,0)
CDC FORM (III)
"^DD",799.4,799.4,9.13,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,9.13,21,1,0)
This field is used to indicate the COUNTRY in 
"^DD",799.4,799.4,9.13,21,2,0)
which the patient was residing at the time of
"^DD",799.4,799.4,9.13,21,3,0)
onset of an illness suggestive of AIDS. This field
"^DD",799.4,799.4,9.13,21,4,0)
is used in printing part III of the CDC form.
"^DD",799.4,799.4,9.13,"DT")
3030211
"^DD",799.4,799.4,9.14,0)
ONSET OF ILLNESS/AIDS- ZIP^F^^9;14^K:$L(X)>9!($L(X)<5) X
"^DD",799.4,799.4,9.14,.1)
Zip Code at Onset of Illness Suggestive of AIDS
"^DD",799.4,799.4,9.14,3)
Enter patient's zip code of residence at onset of illness suggestive of AIDS. Answer must be 5-9 characters in length.
"^DD",799.4,799.4,9.14,20,0)
^.3LA^1^1
"^DD",799.4,799.4,9.14,20,1,0)
CDC FORM (III)
"^DD",799.4,799.4,9.14,21,0)
^^5^5^3060203^
"^DD",799.4,799.4,9.14,21,1,0)
This field is used to indicate the zip code
"^DD",799.4,799.4,9.14,21,2,0)
associated with the residence of the patient at
"^DD",799.4,799.4,9.14,21,3,0)
the onset of an illness suggestive of AIDS. This
"^DD",799.4,799.4,9.14,21,4,0)
field is used in printing part III of the CDC
"^DD",799.4,799.4,9.14,21,5,0)
form.
"^DD",799.4,799.4,9.14,"DT")
3030211
"^DD",799.4,799.4,9.9,0)
PATIENT STATUS^CJ1,0^^ ; ^S X=$S('$D(D0):"",D0<0:"",1:D0),X=$S(X>0:+$P($G(^RORDATA(798,+X,0)),U),1:0),X=$S(X'>0:9,$P($G(^RORDATA(798.4,X,1)),U,4)>0:2,1:1)
"^DD",799.4,799.4,9.9,9)
^
"^DD",799.4,799.4,9.9,9.01)

"^DD",799.4,799.4,9.9,9.1)
RORPTSTATUS(NUMBER)
"^DD",799.4,799.4,9.9,21,0)
^^4^4^3030219^
"^DD",799.4,799.4,9.9,21,1,0)
The PATIENT STATUS field indicates whether the
"^DD",799.4,799.4,9.9,21,2,0)
patient is alive (1) or dead (2), or if the status
"^DD",799.4,799.4,9.9,21,3,0)
is unknown (9). It is also used in printing the
"^DD",799.4,799.4,9.9,21,4,0)
CDC form.
"^DD",799.4,799.4,9.9,"DT")
3030219
"^DD",799.4,799.4,10,0)
AIDS INDICATOR DISEASE^799.41P^^10;0
"^DD",799.4,799.4,10,20,0)
^.3LA^1^1
"^DD",799.4,799.4,10,20,1,0)
CDC FORM (VIII)
"^DD",799.4,799.4,10,21,0)
^^2^2^3060203^
"^DD",799.4,799.4,10,21,1,0)
The AIDS INDICATOR DISEASE multiple contains a 
"^DD",799.4,799.4,10,21,2,0)
list of disease diagnoses that indicate AIDS.
"^DD",799.4,799.4,10,23,0)
^.001^3^3^3060203^^
"^DD",799.4,799.4,10,23,1,0)
The records of the multiple have the same internal
"^DD",799.4,799.4,10,23,2,0)
entry numbers as the corresponding diseases from
"^DD",799.4,799.4,10,23,3,0)
the ROR AIDS INDICATOR DISEASE file (#799.49).
"^DD",799.4,799.4,11.01,0)
RECORD REVIEWED^S^1:YES;0:NO;^11;1^Q
"^DD",799.4,799.4,11.01,3)
Indicate whether the patient's medical record was reviewed prior to submitting the CDC HIV/AIDS form or not.
"^DD",799.4,799.4,11.01,20,0)
^.3LA^1^1
"^DD",799.4,799.4,11.01,20,1,0)
CDC FORM (VIII)
"^DD",799.4,799.4,11.01,21,0)
^.001^4^4^3060203^^^
"^DD",799.4,799.4,11.01,21,1,0)
This field is used to indicate whether the 
"^DD",799.4,799.4,11.01,21,2,0)
patient's medical record was reviewed prior to
"^DD",799.4,799.4,11.01,21,3,0)
submitting the CDC HIV/AIDS form. The entry is
"^DD",799.4,799.4,11.01,21,4,0)
used in the CDC HIV/AIDS form.
"^DD",799.4,799.4,11.01,"DT")
2940628
"^DD",799.4,799.4,11.02,0)
DATE ASYMPTOMATIC^DX^^11;2^S %DT="E",%DT(0)=-DT D ^%DT S X=Y K:Y<1 X K %DT(0)
"^DD",799.4,799.4,11.02,3)
This is the date the patient was diagnosed as ASYMPTOMATIC (including acute retroviral syndrome and persistant generalized lymphadenopathy).
"^DD",799.4,799.4,11.02,20,0)
^.3LA^1^1
"^DD",799.4,799.4,11.02,20,1,0)
CDC FORM (VIII)
"^DD",799.4,799.4,11.02,21,0)
^^5^5^3060203^
"^DD",799.4,799.4,11.02,21,1,0)
This field is used for a date requested in the 
"^DD",799.4,799.4,11.02,21,2,0)
CLINICAL STATUS portion of the CDC form. The form
"^DD",799.4,799.4,11.02,21,3,0)
requests the date the patient was diagnosed as
"^DD",799.4,799.4,11.02,21,4,0)
ASYMPTOMATIC (including acute retroviral syndrome
"^DD",799.4,799.4,11.02,21,5,0)
and persistent generalized lymphadenopathy).
"^DD",799.4,799.4,11.02,"DT")
2970715
"^DD",799.4,799.4,11.03,0)
DATE SYMPTOMATIC^DX^^11;3^S %DT="E",%DT(0)=-DT D ^%DT S X=Y K:Y<1 X K %DT(0)
"^DD",799.4,799.4,11.03,3)
Enter the date when the patient was diagnosed as SYMPTOMATIC (not AIDS).
"^DD",799.4,799.4,11.03,20,0)
^.3LA^1^1
"^DD",799.4,799.4,11.03,20,1,0)
CDC FORM (VIII)
"^DD",799.4,799.4,11.03,21,0)
^^3^3^3030211^
"^DD",799.4,799.4,11.03,21,1,0)
This field is used for the date requested as 
"^DD",799.4,799.4,11.03,21,2,0)
SYMPTOMATIC in the CLINICAL STATUS portion of the
"^DD",799.4,799.4,11.03,21,3,0)
CDC HIV/AIDS reporting form.
"^DD",799.4,799.4,11.03,"DT")
2970715
"^DD",799.4,799.4,11.04,0)
IMMUNODEF THAT DISQUALIFIES^S^1:YES;0:NO;9:UNKNOWN;^11;4^Q
"^DD",799.4,799.4,11.04,.1)
Immunodeficiency that would disqualify AIDS diagnosis
"^DD",799.4,799.4,11.04,3)
This field indicates whether the patient has an immunodeficiency which would disqualify the patient from an AIDS diagnosis.
"^DD",799.4,799.4,11.04,20,0)
^.3LA^1^1
"^DD",799.4,799.4,11.04,20,1,0)
CDC FORM (VIII)
"^DD",799.4,799.4,11.04,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,11.04,21,1,0)
This field indicates whether the patient has an 
"^DD",799.4,799.4,11.04,21,2,0)
immunodeficiency which would disqualify the
"^DD",799.4,799.4,11.04,21,3,0)
patient from an AIDS diagnosis. This field is used
"^DD",799.4,799.4,11.04,21,4,0)
in the CDC HIV/AIDS form.
"^DD",799.4,799.4,11.04,"DT")
2940628
"^DD",799.4,799.4,11.05,0)
RVCT CASE NO.^NJ9,0^^11;5^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",799.4,799.4,11.05,3)
If the presence of tuberculosis is indicated, enter the RVCT CASE Number for the patient.
"^DD",799.4,799.4,11.05,20,0)
^.3LA^1^1
"^DD",799.4,799.4,11.05,20,1,0)
CDC FORM (VIII)
"^DD",799.4,799.4,11.05,21,0)
^^3^3^3060203^
"^DD",799.4,799.4,11.05,21,1,0)
This field is used to enter the RVCT Case number 
"^DD",799.4,799.4,11.05,21,2,0)
if a diagnosis of tuberculosis had been indicated
"^DD",799.4,799.4,11.05,21,3,0)
in part VIII of the CDC form.
"^DD",799.4,799.4,11.05,"DT")
2930331
"^DD",799.4,799.4,12.01,0)
AIDS DX - HOSPITAL^F^^12;1^K:$L(X)>30!($L(X)<3) X
"^DD",799.4,799.4,12.01,.1)
Hospital Where AIDS Diagnosed
"^DD",799.4,799.4,12.01,3)
Enter the name of hospital where AIDS diagnosed.  Answer must be 3-30 characters in length.
"^DD",799.4,799.4,12.01,20,0)
^.3LA^1^1
"^DD",799.4,799.4,12.01,20,1,0)
CDC FORM (IV)
"^DD",799.4,799.4,12.01,21,0)
^^3^3^3030210^
"^DD",799.4,799.4,12.01,21,1,0)
This field contains the name of the hospital where
"^DD",799.4,799.4,12.01,21,2,0)
the diagnosis of AIDS was first made.  This field
"^DD",799.4,799.4,12.01,21,3,0)
is used in printing part IV of the CDC form.
"^DD",799.4,799.4,12.01,"DT")
3030210
"^DD",799.4,799.4,12.02,0)
AIDS DX - CITY^F^^12;2^K:$L(X)>15!($L(X)<3) X
"^DD",799.4,799.4,12.02,.1)
City of Hospital Where AIDS Dx.
"^DD",799.4,799.4,12.02,3)
Enter name of city of hospital where HIV was diagnosed.  Answer must be 3-15 characters in length.
"^DD",799.4,799.4,12.02,20,0)
^.3LA^1^1
"^DD",799.4,799.4,12.02,20,1,0)
CDC FORM (IV)
"^DD",799.4,799.4,12.02,21,0)
^.001^4^4^3060203^^
"^DD",799.4,799.4,12.02,21,1,0)
This field contains the city in which the 
"^DD",799.4,799.4,12.02,21,2,0)
hospital where the diagnosis of AIDS was first
"^DD",799.4,799.4,12.02,21,3,0)
made is located.  This field is used in printing
"^DD",799.4,799.4,12.02,21,4,0)
part IV of the CDC form.
"^DD",799.4,799.4,12.02,"DT")
3030210
"^DD",799.4,799.4,12.03,0)
AIDS DX - STATE^P5'^DIC(5,^12;3^Q
"^DD",799.4,799.4,12.03,.1)
State of Hospital Where AIDS Dx.
"^DD",799.4,799.4,12.03,3)
Enter the name of the state where AIDS was diagnosed.
"^DD",799.4,799.4,12.03,20,0)
^.3LA^1^1
"^DD",799.4,799.4,12.03,20,1,0)
CDC FORM (IV)
"^DD",799.4,799.4,12.03,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,12.03,21,1,0)
This field contains the name of the STATE in which
"^DD",799.4,799.4,12.03,21,2,0)
the hospital where the diagnosis of AIDS was first
"^DD",799.4,799.4,12.03,21,3,0)
made is located. This field is used in printing
"^DD",799.4,799.4,12.03,21,4,0)
part IV of the CDC form.
"^DD",799.4,799.4,12.03,"DT")
3030210
"^DD",799.4,799.4,12.04,0)
AIDS DX - COUNTRY^F^^12;4^K:$L(X)>15!($L(X)<3) X
"^DD",799.4,799.4,12.04,.1)
Country of Hospital Where AIDS Dx.
"^DD",799.4,799.4,12.04,3)
Enter name of country where AIDS was diagnosed.  Answer must be 3-15 characters in length.
"^DD",799.4,799.4,12.04,20,0)
^.3LA^1^1
"^DD",799.4,799.4,12.04,20,1,0)
CDC FORM (IV)
"^DD",799.4,799.4,12.04,21,0)
^.001^4^4^3060203^^
"^DD",799.4,799.4,12.04,21,1,0)
This field is used to record the country in  which
"^DD",799.4,799.4,12.04,21,2,0)
the hospital at which the patient was diagnosed as
"^DD",799.4,799.4,12.04,21,3,0)
having AIDS is located. This field is used in
"^DD",799.4,799.4,12.04,21,4,0)
printing part IV of the CDC form.
"^DD",799.4,799.4,12.04,"DT")
3030210
"^DD",799.4,799.4,12.05,0)
AIDS DX - FACILITY SETTING^S^1:PUBLIC;2:PRIVATE;3:FEDERAL;9:UNKNOWN;^12;5^Q
"^DD",799.4,799.4,12.05,3)
This entry is used to indicate the type of facility on the revised HIV/CDC form.
"^DD",799.4,799.4,12.05,20,0)
^.3LA^1^1
"^DD",799.4,799.4,12.05,20,1,0)
CDC FORM (IV)
"^DD",799.4,799.4,12.05,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,12.05,21,1,0)
This field is used to contain data related to the 
"^DD",799.4,799.4,12.05,21,2,0)
facility setting where the diagnosis was first
"^DD",799.4,799.4,12.05,21,3,0)
made.  The facility setting is public, federal,
"^DD",799.4,799.4,12.05,21,4,0)
etc. This field is used on the CDC HIV/AIDS form.
"^DD",799.4,799.4,12.05,"DT")
3030210
"^DD",799.4,799.4,12.06,0)
AIDS DX - FACILITY TYPE^S^01:PHYSICIAN,HMO;31:HOSPITAL,INPATIENT;88:OTHER;^12;6^Q
"^DD",799.4,799.4,12.06,3)
Select the appropriate code to indicate the type of facility at which the AIDS diagnosis was made.
"^DD",799.4,799.4,12.06,20,0)
^.3LA^1^1
"^DD",799.4,799.4,12.06,20,1,0)
CDC FORM (IV)
"^DD",799.4,799.4,12.06,21,0)
^^4^4^3030210^
"^DD",799.4,799.4,12.06,21,1,0)
This field holds information on the type of 
"^DD",799.4,799.4,12.06,21,2,0)
facility in which the diagnosis was originally
"^DD",799.4,799.4,12.06,21,3,0)
made for this patient.  This information is used
"^DD",799.4,799.4,12.06,21,4,0)
to generate the CDC HIV/AIDS form.
"^DD",799.4,799.4,12.06,"DT")
3030210
"^DD",799.4,799.4,12.07,0)
AIDS DX - OTHER FACILITY TYPE^F^^12;7^K:$L(X)>25!($L(X)<2) X
"^DD",799.4,799.4,12.07,3)
This field is used to specify the 'OTHER' type of facility at which the AIDS diagnosis was made. Answer must be 2-25 characters in length.
"^DD",799.4,799.4,12.07,20,0)
^.3LA^1^1
"^DD",799.4,799.4,12.07,20,1,0)
CDC FORM (IV)
"^DD",799.4,799.4,12.07,21,0)
^.001^4^4^3060203^^
"^DD",799.4,799.4,12.07,21,1,0)
If the facility type selected for the 'AIDS DX - 
"^DD",799.4,799.4,12.07,21,2,0)
FACILITY TYPE' field (12.06) is 'OTHER', then this
"^DD",799.4,799.4,12.07,21,3,0)
field is used to provide a text description of the
"^DD",799.4,799.4,12.07,21,4,0)
'OTHER' type.
"^DD",799.4,799.4,12.07,"DT")
3030210
"^DD",799.4,799.4,14.01,0)
SEX RELATIONS W/MALE PARTNER^S^1:YES;0:NO;9:UNKNOWN;^14;1^Q
"^DD",799.4,799.4,14.01,.1)
Sex With Male Partner
"^DD",799.4,799.4,14.01,3)
Indicate whether patient had sex with a male partner.
"^DD",799.4,799.4,14.01,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.01,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.01,21,0)
^^5^5^3030210^
"^DD",799.4,799.4,14.01,21,1,0)
This field contains the answer to the question 
"^DD",799.4,799.4,14.01,21,2,0)
'Did this patient after 1977 and preceding the
"^DD",799.4,799.4,14.01,21,3,0)
diagnosis of AIDS, have sexual relations with a
"^DD",799.4,799.4,14.01,21,4,0)
male partner?'  The field is used in printing 
"^DD",799.4,799.4,14.01,21,5,0)
part V of the CDC form.
"^DD",799.4,799.4,14.01,"DT")
2930401
"^DD",799.4,799.4,14.02,0)
SEX RELATIONS W/FEMALE PARTNER^S^1:YES;0:NO;9:UNKNOWN;^14;2^Q
"^DD",799.4,799.4,14.02,.1)
Sex With Female Partner
"^DD",799.4,799.4,14.02,3)
Indicate whether patient had sex with a female partner.
"^DD",799.4,799.4,14.02,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.02,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.02,21,0)
^^5^5^3030210^
"^DD",799.4,799.4,14.02,21,1,0)
This field contains the answer to the question 
"^DD",799.4,799.4,14.02,21,2,0)
'Did this patient, after 1977 and preceding the
"^DD",799.4,799.4,14.02,21,3,0)
diagnosis of AIDS, have sexual relations with a
"^DD",799.4,799.4,14.02,21,4,0)
female partner?'  The field is used in printing 
"^DD",799.4,799.4,14.02,21,5,0)
part V of the CDC form.
"^DD",799.4,799.4,14.02,"DT")
2930401
"^DD",799.4,799.4,14.03,0)
IV DRUGS AFTER 77 AND PRE HIV^S^0:NO;1:YES;9:UNKNOWN;^14;3^Q
"^DD",799.4,799.4,14.03,.1)
IV Drugs After 1977/Pre HIV
"^DD",799.4,799.4,14.03,3)
Indicate whether patient used IV drugs after 1977 and preceding HIV diagnosis.
"^DD",799.4,799.4,14.03,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.03,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.03,21,0)
^^7^7^3030210^
"^DD",799.4,799.4,14.03,21,1,0)
This field is used to indicate whether the 
"^DD",799.4,799.4,14.03,21,2,0)
patient used needles for self-injection of drugs
"^DD",799.4,799.4,14.03,21,3,0)
not prescribed by a physician during the period
"^DD",799.4,799.4,14.03,21,4,0)
after 1977 and before the diagnosis of AIDS.
"^DD",799.4,799.4,14.03,21,5,0)
 
"^DD",799.4,799.4,14.03,21,6,0)
This field is used in printing part V of the CDC 
"^DD",799.4,799.4,14.03,21,7,0)
form.
"^DD",799.4,799.4,14.03,"DT")
2930401
"^DD",799.4,799.4,14.04,0)
REC'D CLOTTING FACTORS^S^0:NO;1:YES;9:UNKNOWN;^14;4^Q
"^DD",799.4,799.4,14.04,.1)
BP1.  Received Clotting Factor
"^DD",799.4,799.4,14.04,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.04,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.04,21,0)
^^4^4^3030210^
"^DD",799.4,799.4,14.04,21,1,0)
This field is used in part V of the CDC form to 
"^DD",799.4,799.4,14.04,21,2,0)
indicate whether the patient had received clotting
"^DD",799.4,799.4,14.04,21,3,0)
factors in the period between 1977 and the
"^DD",799.4,799.4,14.04,21,4,0)
diagnosis of AIDS.
"^DD",799.4,799.4,14.04,"DT")
2930401
"^DD",799.4,799.4,14.05,0)
TYPE OF HEMOPHILIA^S^1:HEMOPHILIA A (FACTOR VIII);2:HEMOPHILIA B (FACTOR IX);8:OTHER;^14;5^Q
"^DD",799.4,799.4,14.05,.1)
BP1.  Type of Hemophilia
"^DD",799.4,799.4,14.05,3)
Enter the type of hemophilia.
"^DD",799.4,799.4,14.05,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.05,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.05,21,0)
^^5^5^3060203^
"^DD",799.4,799.4,14.05,21,1,0)
This field is used to indicate, for those 
"^DD",799.4,799.4,14.05,21,2,0)
patients who had received clotting factors as
"^DD",799.4,799.4,14.05,21,3,0)
indicated in field 15.9, the type of hemophilia 
"^DD",799.4,799.4,14.05,21,4,0)
for which clotting factors were given. This field 
"^DD",799.4,799.4,14.05,21,5,0)
is used in printing part 2 of the CDC form.
"^DD",799.4,799.4,14.05,"DT")
3030210
"^DD",799.4,799.4,14.06,0)
OTHER HEMOPHILIA DESCRIPTION^F^^14;6^K:$L(X)>15!($L(X)<3) X
"^DD",799.4,799.4,14.06,.1)
BP1.  Other Hemophilia Desc.
"^DD",799.4,799.4,14.06,3)
If hemophilia is 'OTHER', indicate type.  Answer must be 3-15 characters in length.
"^DD",799.4,799.4,14.06,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.06,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.06,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,14.06,21,1,0)
This field is used to indicate the type of 
"^DD",799.4,799.4,14.06,21,2,0)
hemophilia, if OTHER is selected in field 14.05.
"^DD",799.4,799.4,14.06,21,3,0)
This field is used in printing part V of the CDC
"^DD",799.4,799.4,14.06,21,4,0)
form.
"^DD",799.4,799.4,14.06,"DT")
2871217
"^DD",799.4,799.4,14.07,0)
SR WITH IV DRUG USER^S^0:NO;1:YES;9:UNKNOWN;^14;7^Q
"^DD",799.4,799.4,14.07,.1)
Sex With IV Drug Abuser
"^DD",799.4,799.4,14.07,3)
Indicate whether patient had sex with an IV drug user.
"^DD",799.4,799.4,14.07,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.07,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.07,21,0)
^^5^5^3030210^
"^DD",799.4,799.4,14.07,21,1,0)
This field is used to store the answer to the 
"^DD",799.4,799.4,14.07,21,2,0)
question 'Did this patient have heterosexual
"^DD",799.4,799.4,14.07,21,3,0)
relations with any of the following: IV drug
"^DD",799.4,799.4,14.07,21,4,0)
user'  The response is used in printing part V of 
"^DD",799.4,799.4,14.07,21,5,0)
the CDC form.
"^DD",799.4,799.4,14.07,"DT")
2930401
"^DD",799.4,799.4,14.08,0)
SR WITH BISEXUAL MAN^S^0:NO;1:YES;9:UNKNOWN;^14;8^Q
"^DD",799.4,799.4,14.08,.1)
Sex With Bisexual Male
"^DD",799.4,799.4,14.08,3)
Indicate whether patient had sex with a bisexual male.
"^DD",799.4,799.4,14.08,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.08,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.08,21,0)
^^8^8^3030210^
"^DD",799.4,799.4,14.08,21,1,0)
This field is used to store the answer to the 
"^DD",799.4,799.4,14.08,21,2,0)
question 'Did this patient have heterosexual
"^DD",799.4,799.4,14.08,21,3,0)
relations with any of the following: Bisexual
"^DD",799.4,799.4,14.08,21,4,0)
Man'.  
"^DD",799.4,799.4,14.08,21,5,0)
 
"^DD",799.4,799.4,14.08,21,6,0)
Note that this question should be ignored for Male
"^DD",799.4,799.4,14.08,21,7,0)
patients. The response is used in printing part V
"^DD",799.4,799.4,14.08,21,8,0)
of the CDC form.
"^DD",799.4,799.4,14.08,"DT")
2930401
"^DD",799.4,799.4,14.09,0)
SR W HEMOPHILIA/COAG DISORDER^S^0:NO;1:YES;9:UNKNOWN;^14;9^Q
"^DD",799.4,799.4,14.09,.1)
Sex With Hemophiliac/Coagulation Disorder
"^DD",799.4,799.4,14.09,3)
Indicate whether patient had sex with a person with hemophilia/coagulation disorder.
"^DD",799.4,799.4,14.09,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.09,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.09,21,0)
^^5^5^3030210^
"^DD",799.4,799.4,14.09,21,1,0)
This field is used to store the answer to the 
"^DD",799.4,799.4,14.09,21,2,0)
question 'Did this patient have heterosexual
"^DD",799.4,799.4,14.09,21,3,0)
relations with any of the following: Person with
"^DD",799.4,799.4,14.09,21,4,0)
hemophilia/coagulation disorder.'  The response 
"^DD",799.4,799.4,14.09,21,5,0)
is used in printing part V of the CDC form.
"^DD",799.4,799.4,14.09,"DT")
2930401
"^DD",799.4,799.4,14.1,0)
SR W TRANS RECIPIENT WITH AIDS^S^0:NO;1:YES;9:UNKNOWN;^14;10^Q
"^DD",799.4,799.4,14.1,.1)
Sex With Transfusion Recipient with AIDS
"^DD",799.4,799.4,14.1,3)
Indicate whether patient had sex with a transfusion recipient with AIDS or documented HIV infection.
"^DD",799.4,799.4,14.1,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.1,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.1,21,0)
^^6^6^3030210^
"^DD",799.4,799.4,14.1,21,1,0)
This field is used to store the answer to the 
"^DD",799.4,799.4,14.1,21,2,0)
question 'Did this patient have heterosexual
"^DD",799.4,799.4,14.1,21,3,0)
relations with any of the following: Blood
"^DD",799.4,799.4,14.1,21,4,0)
transfusion recipient with AIDS or documented HIV 
"^DD",799.4,799.4,14.1,21,5,0)
infection.'  This field is used in printing part V
"^DD",799.4,799.4,14.1,21,6,0)
of the CDC form.
"^DD",799.4,799.4,14.1,"DT")
2930401
"^DD",799.4,799.4,14.11,0)
TRANSPLANT RECIP-DOCUMNTD HIV^S^1:YES;0:NO;9:UNKNOWN;^14;11^Q
"^DD",799.4,799.4,14.11,3)
Indicate whether patient is a transplant recipient with documented HIV infection.
"^DD",799.4,799.4,14.11,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.11,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.11,21,0)
^.001^4^4^3030210^^
"^DD",799.4,799.4,14.11,21,1,0)
This field should reflect whether the patient is 
"^DD",799.4,799.4,14.11,21,2,0)
a transplant recipient with documented HIV
"^DD",799.4,799.4,14.11,21,3,0)
infection.  The field is used on the CDC HIV/AIDS
"^DD",799.4,799.4,14.11,21,4,0)
report form.
"^DD",799.4,799.4,14.11,"DT")
2940628
"^DD",799.4,799.4,14.12,0)
SR W AIDS/HIV INFECTION^S^0:NO;1:YES;9:UNKNOWN;^14;12^Q
"^DD",799.4,799.4,14.12,.1)
Sex With AIDS/HIV Infected Person
"^DD",799.4,799.4,14.12,3)
Indicate whether patient had sex with a person with AIDS or documented HIV infection.
"^DD",799.4,799.4,14.12,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.12,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.12,21,0)
^^5^5^3030210^
"^DD",799.4,799.4,14.12,21,1,0)
This field is used to store the answer to the 
"^DD",799.4,799.4,14.12,21,2,0)
question 'Did this patient have heterosexual
"^DD",799.4,799.4,14.12,21,3,0)
relations with any of the following: Person with
"^DD",799.4,799.4,14.12,21,4,0)
AIDS or documented HIV infection.'  This field is 
"^DD",799.4,799.4,14.12,21,5,0)
used in printing part V of the CDC form.
"^DD",799.4,799.4,14.12,"DT")
2930401
"^DD",799.4,799.4,14.13,0)
TRANS AFTER 77 AND BEFORE HIV^S^0:NO;1:YES;9:UNKNOWN;^14;13^Q
"^DD",799.4,799.4,14.13,.1)
Trans After 1977/Pre HIV
"^DD",799.4,799.4,14.13,3)
Indicate whether patient had transfusion(s) after 1977 and prior to HIV Dx.
"^DD",799.4,799.4,14.13,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.13,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.13,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,14.13,21,1,0)
This field is used to indicate if the patient had 
"^DD",799.4,799.4,14.13,21,2,0)
a transfusion after 1977 and before diagnosis of
"^DD",799.4,799.4,14.13,21,3,0)
AIDS.  This field is used in printing part V of
"^DD",799.4,799.4,14.13,21,4,0)
the CDC form.
"^DD",799.4,799.4,14.13,"DT")
2930401
"^DD",799.4,799.4,14.14,0)
DATE OF FIRST TRANSFUSION^D^^14;14^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,14.14,.1)
Date of First Transfusion
"^DD",799.4,799.4,14.14,3)
Enter date of patient's first transfusion.
"^DD",799.4,799.4,14.14,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.14,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.14,21,0)
^^6^6^3060203^
"^DD",799.4,799.4,14.14,21,1,0)
This is the date of the first transfusion after 
"^DD",799.4,799.4,14.14,21,2,0)
1977. This field is only required if the patient
"^DD",799.4,799.4,14.14,21,3,0)
did have a transfusion after 1977 and before the
"^DD",799.4,799.4,14.14,21,4,0)
diagnosis of AIDS, AND this is the only risk 
"^DD",799.4,799.4,14.14,21,5,0)
factor for the patient. This field is used in
"^DD",799.4,799.4,14.14,21,6,0)
printing part V of the CDC form.
"^DD",799.4,799.4,14.14,"DT")
2871217
"^DD",799.4,799.4,14.15,0)
DATE OF LAST TRANSFUSION^D^^14;15^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,14.15,.1)
Date of Last Transfusion
"^DD",799.4,799.4,14.15,3)
Enter date of patient's last transfusion.
"^DD",799.4,799.4,14.15,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.15,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.15,21,0)
^^6^6^3060203^
"^DD",799.4,799.4,14.15,21,1,0)
This is the date of the last transfusion after 
"^DD",799.4,799.4,14.15,21,2,0)
1977. This field is only required if the patient
"^DD",799.4,799.4,14.15,21,3,0)
did have a transfusion after 1977 and before the
"^DD",799.4,799.4,14.15,21,4,0)
diagnosis of AIDS (YES to field #14.13), AND this
"^DD",799.4,799.4,14.15,21,5,0)
is the only risk factor for the patient.  This 
"^DD",799.4,799.4,14.15,21,6,0)
field is used in printing part V of the CDC form.
"^DD",799.4,799.4,14.15,"DT")
2871217
"^DD",799.4,799.4,14.16,0)
TRANSPLANT OR ARTIF INSEMIN^S^1:YES;0:NO;9:UNKNOWN;^14;16^Q
"^DD",799.4,799.4,14.16,3)
Indicate whether the patient received a transplant of tissue/organs or artificial insemination.
"^DD",799.4,799.4,14.16,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.16,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.16,21,0)
^^5^5^3060203^
"^DD",799.4,799.4,14.16,21,1,0)
This field is used to indicate whether the patient
"^DD",799.4,799.4,14.16,21,2,0)
was the recipient of a transplant or artificial
"^DD",799.4,799.4,14.16,21,3,0)
insemination following 1977 and prior to being
"^DD",799.4,799.4,14.16,21,4,0)
diagnosed as HIV positive. This field is used in
"^DD",799.4,799.4,14.16,21,5,0)
printing part V of the CDC form.
"^DD",799.4,799.4,14.16,"DT")
2930401
"^DD",799.4,799.4,14.17,0)
WORK IN HEALTH CARE OR LAB^S^0:NO;1:YES;9:UNKNOWN;^14;17^Q
"^DD",799.4,799.4,14.17,.1)
Health Care/Lab Worker
"^DD",799.4,799.4,14.17,3)
Indicate whether patient has worked as health care or lab worker.
"^DD",799.4,799.4,14.17,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.17,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.17,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,14.17,21,1,0)
After 1977 and preceding the diagnosis of AIDS 
"^DD",799.4,799.4,14.17,21,2,0)
did the patient work in a health care or clinical
"^DD",799.4,799.4,14.17,21,3,0)
laboratory setting?  This field is used in
"^DD",799.4,799.4,14.17,21,4,0)
printing part V of the CDC form.
"^DD",799.4,799.4,14.17,"DT")
2930401
"^DD",799.4,799.4,14.18,0)
OCCUPATION^F^^14;18^K:$L(X)>30!($L(X)<3) X
"^DD",799.4,799.4,14.18,.1)
Occupation
"^DD",799.4,799.4,14.18,3)
If patient has worked as health care or lab worker, indicate occupation.  Answer must be 3-30 characters in length.
"^DD",799.4,799.4,14.18,20,0)
^.3LA^1^1
"^DD",799.4,799.4,14.18,20,1,0)
CDC FORM (V)
"^DD",799.4,799.4,14.18,21,0)
^^4^4^3030210^
"^DD",799.4,799.4,14.18,21,1,0)
If the patient did work in a health care or 
"^DD",799.4,799.4,14.18,21,2,0)
clinical lab after 1977 and prior to the diagnosis
"^DD",799.4,799.4,14.18,21,3,0)
of AIDS (YES to field #14.17), this field is used
"^DD",799.4,799.4,14.18,21,4,0)
to specify the occupation.
"^DD",799.4,799.4,14.18,"DT")
2900905
"^DD",799.4,799.4,16.01,0)
HIV-1 EIA^S^1:POSITIVE;0:NEGATIVE;9:NOT DONE;^16;1^Q
"^DD",799.4,799.4,16.01,3)
Enter the result of the ELISA antibody test.
"^DD",799.4,799.4,16.01,20,0)
^.3LA^1^1
"^DD",799.4,799.4,16.01,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,16.01,21,0)
^^3^3^3060203^
"^DD",799.4,799.4,16.01,21,1,0)
This field is used in filling out part VI of the 
"^DD",799.4,799.4,16.01,21,2,0)
CDC form, and indicates whether an ELISA test for
"^DD",799.4,799.4,16.01,21,3,0)
HIV was performed, and if so, what the result was.
"^DD",799.4,799.4,16.01,"DT")
3030210
"^DD",799.4,799.4,16.02,0)
HIV-1 EIA DATE^D^^16;2^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,16.02,3)
Enter the date (Month and Year) for the FIRST POSITIVE TEST, or the test date.
"^DD",799.4,799.4,16.02,20,0)
^.3LA^1^1
"^DD",799.4,799.4,16.02,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,16.02,21,0)
^.001^3^3^3060203^^
"^DD",799.4,799.4,16.02,21,1,0)
This field is used to contain the date (month and 
"^DD",799.4,799.4,16.02,21,2,0)
year) when the indicated result in part VI of the
"^DD",799.4,799.4,16.02,21,3,0)
revised CDC form was originally determined.
"^DD",799.4,799.4,16.02,"DT")
3030210
"^DD",799.4,799.4,16.03,0)
HIV-1/HIV-2 EIA^S^1:POSITIVE;0:NEGATIVE;9:NOT DONE;^16;3^Q
"^DD",799.4,799.4,16.03,3)
Enter the result of the HIV-1/HIV-2 combination EIA test.
"^DD",799.4,799.4,16.03,20,0)
^.3LA^1^1
"^DD",799.4,799.4,16.03,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,16.03,21,0)
^^4^4^3030210^
"^DD",799.4,799.4,16.03,21,1,0)
This field is used to hold information on whether 
"^DD",799.4,799.4,16.03,21,2,0)
an HIV-1/HIV-2 EIA was performed on the patient
"^DD",799.4,799.4,16.03,21,3,0)
and, if so, the result.  This information is used
"^DD",799.4,799.4,16.03,21,4,0)
to generate the CDC HIV/AIDS form.
"^DD",799.4,799.4,16.03,"DT")
3030210
"^DD",799.4,799.4,16.04,0)
HIV-1/HIV-2 EIA DATE^D^^16;4^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,16.04,3)
Enter the date of the MOST RECENT HIV-1/HIV-2 combination EIA test.
"^DD",799.4,799.4,16.04,20,0)
^.3LA^1^1
"^DD",799.4,799.4,16.04,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,16.04,21,0)
^^3^3^3030210^
"^DD",799.4,799.4,16.04,21,1,0)
This field is used to indicate the date on which 
"^DD",799.4,799.4,16.04,21,2,0)
an HIV-1/HIV-2 EIA test was performed.  It is used
"^DD",799.4,799.4,16.04,21,3,0)
to generate the CDC HIV/AIDS form.
"^DD",799.4,799.4,16.04,"DT")
2940803
"^DD",799.4,799.4,16.05,0)
HIV-1 WESTERN BLOT/IFA^S^1:POSITIVE;0:NEGATIVE;8:INDETERMINATE;9:NOT DONE;^16;5^Q
"^DD",799.4,799.4,16.05,.1)
WESTERN BLOT
"^DD",799.4,799.4,16.05,3)
Enter the result of the Western blot antibody test.
"^DD",799.4,799.4,16.05,20,0)
^.3LA^1^1
"^DD",799.4,799.4,16.05,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,16.05,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,16.05,21,1,0)
This field is used in filling out part VI of the 
"^DD",799.4,799.4,16.05,21,2,0)
CDC form, and indicates whether a WESTERN BLOT
"^DD",799.4,799.4,16.05,21,3,0)
test was performed for HIV, and if so, what the
"^DD",799.4,799.4,16.05,21,4,0)
result was.
"^DD",799.4,799.4,16.05,"DT")
3030210
"^DD",799.4,799.4,16.06,0)
HIV-1 WESTERN BLOT/IFA DATE^D^^16;6^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,16.06,3)
Enter the date (Month and Year) for the FIRST POSITIVE TEST, or the test date.
"^DD",799.4,799.4,16.06,20,0)
^.3LA^1^1
"^DD",799.4,799.4,16.06,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,16.06,21,0)
^^3^3^3030210^
"^DD",799.4,799.4,16.06,21,1,0)
This field is used to contain the date (month and 
"^DD",799.4,799.4,16.06,21,2,0)
year) when the indicated result in part VI of the
"^DD",799.4,799.4,16.06,21,3,0)
revised CDC form was originally determined.
"^DD",799.4,799.4,16.06,"DT")
3030210
"^DD",799.4,799.4,16.07,0)
OTHER HIV ANTIBODY TEST^S^1:POSITIVE;0:NEGATIVE;8:INDETERMINATE;9:NOT DONE;^16;7^Q
"^DD",799.4,799.4,16.07,.1)
Other Antibody Test
"^DD",799.4,799.4,16.07,3)
Enter the result of "Other" antibody test.
"^DD",799.4,799.4,16.07,20,0)
^.3LA^1^1
"^DD",799.4,799.4,16.07,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,16.07,21,0)
^^5^5^3030210^
"^DD",799.4,799.4,16.07,21,1,0)
This field is used in filling out part VI of the 
"^DD",799.4,799.4,16.07,21,2,0)
CDC form, and is used to indicate whether an
"^DD",799.4,799.4,16.07,21,3,0)
antibody test for HIV was performed other than the
"^DD",799.4,799.4,16.07,21,4,0)
ELISA or WESTERN BLOT, and the result of this 
"^DD",799.4,799.4,16.07,21,5,0)
test.
"^DD",799.4,799.4,16.07,"DT")
3030210
"^DD",799.4,799.4,16.08,0)
OTHER HIV ANTIBODY TEST DATE^D^^16;8^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,16.08,3)
Enter the date (Month and Year) for the FIRST POSITIVE TEST, or the test date
"^DD",799.4,799.4,16.08,20,0)
^.3LA^1^1
"^DD",799.4,799.4,16.08,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,16.08,21,0)
^^3^3^3030210^
"^DD",799.4,799.4,16.08,21,1,0)
This field is used to contain the date (month and 
"^DD",799.4,799.4,16.08,21,2,0)
year) when the indicated result in part VI of the
"^DD",799.4,799.4,16.08,21,3,0)
revised CDC form was originally determined.
"^DD",799.4,799.4,16.08,"DT")
3030210
"^DD",799.4,799.4,16.09,0)
OTHER HIV ANTIBODY TEST DESC^F^^16;9^K:$L(X)>15!($L(X)<1) X
"^DD",799.4,799.4,16.09,3)
Describe the type of "Other" antibody test.  Answer must be 1-15 characters in length.
"^DD",799.4,799.4,16.09,20,0)
^.3LA^1^1
"^DD",799.4,799.4,16.09,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,16.09,21,0)
^^4^4^3030210^
"^DD",799.4,799.4,16.09,21,1,0)
This field is used to name or describe the OTHER 
"^DD",799.4,799.4,16.09,21,2,0)
ANTIBODY test used, if field 16.07 indicates that
"^DD",799.4,799.4,16.09,21,3,0)
an OTHER ANTIBODY test was used.  This field is
"^DD",799.4,799.4,16.09,21,4,0)
used in filling out part VI of the CDC form.
"^DD",799.4,799.4,16.09,"DT")
3030210
"^DD",799.4,799.4,16.11,0)
* HIV-2 SERUM EIA^S^1:POSITIVE;0:NEGATIVE;9:NOT DONE;^16;11^Q
"^DD",799.4,799.4,16.11,3)
Indicate the type of results (or NOT DONE) for HIV-2 serum antibody EIA tests.
"^DD",799.4,799.4,16.11,20,0)
^.3LA^1^1
"^DD",799.4,799.4,16.11,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,16.11,21,0)
^^2^2^3030210^
"^DD",799.4,799.4,16.11,21,1,0)
This field is used to enter the results of a test 
"^DD",799.4,799.4,16.11,21,2,0)
for the HIV-2 virus by serum EIA.
"^DD",799.4,799.4,16.11,"DT")
3030410
"^DD",799.4,799.4,16.12,0)
* HIV-2 SERUM EIA DATE^D^^16;12^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,16.12,3)
Enter the date (Month and Year) for the FIRST POSITIVE TEST, or the test date
"^DD",799.4,799.4,16.12,20,0)
^.3LA^1^1
"^DD",799.4,799.4,16.12,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,16.12,21,0)
^^3^3^3030210^
"^DD",799.4,799.4,16.12,21,1,0)
This field is used to contain the date (month and 
"^DD",799.4,799.4,16.12,21,2,0)
year) when the indicated result in part VI of the
"^DD",799.4,799.4,16.12,21,3,0)
revised CDC form was originally determined.
"^DD",799.4,799.4,16.12,"DT")
3030410
"^DD",799.4,799.4,16.13,0)
* HIV-2 WESTERN BLOT^S^1:POSITIVE;0:NEGATIVE;8:INDETERMINATE;9:NOT DONE;^16;13^Q
"^DD",799.4,799.4,16.13,3)
Enter the result for the Western Blot test for HIV-2
"^DD",799.4,799.4,16.13,20,0)
^.3LA^1^1
"^DD",799.4,799.4,16.13,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,16.13,21,0)
^^5^5^3060203^
"^DD",799.4,799.4,16.13,21,1,0)
This field is used to hold information on whether 
"^DD",799.4,799.4,16.13,21,2,0)
an HIV-2 Western Blot test was performed on the
"^DD",799.4,799.4,16.13,21,3,0)
patient and, if so, the result of the test. This
"^DD",799.4,799.4,16.13,21,4,0)
information is used to generate the CDC HIV/AIDS 
"^DD",799.4,799.4,16.13,21,5,0)
form.
"^DD",799.4,799.4,16.13,"DT")
3030410
"^DD",799.4,799.4,16.14,0)
* HIV-2 WESTERN BLOT DATE^D^^16;14^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,16.14,3)
Enter the date of the MOST RECENT Western Blot test for the HIV-2 virus
"^DD",799.4,799.4,16.14,20,0)
^.3LA^1^1
"^DD",799.4,799.4,16.14,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,16.14,21,0)
^^4^4^3030210^
"^DD",799.4,799.4,16.14,21,1,0)
This field is used to hold the date on which an 
"^DD",799.4,799.4,16.14,21,2,0)
HIV-2 Western Blot test was performed on the
"^DD",799.4,799.4,16.14,21,3,0)
patient.  This information is used to generate the
"^DD",799.4,799.4,16.14,21,4,0)
CDC HIV/AIDS form.
"^DD",799.4,799.4,16.14,"DT")
3030410
"^DD",799.4,799.4,18.01,0)
HIV CULTURE DETECTION TEST^D^^18;1^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,18.01,3)
Enter the DATE of the FIRST POSITIVE HIV culture detection test.
"^DD",799.4,799.4,18.01,20,0)
^.3LA^1^1
"^DD",799.4,799.4,18.01,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,18.01,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,18.01,21,1,0)
This field is used to hold the date on which an 
"^DD",799.4,799.4,18.01,21,2,0)
HIV culture test first produced a positive
"^DD",799.4,799.4,18.01,21,3,0)
result.  This information is used to generate the
"^DD",799.4,799.4,18.01,21,4,0)
CDC HIV/AIDS form.
"^DD",799.4,799.4,18.01,"DT")
2941026
"^DD",799.4,799.4,18.02,0)
HIV ANTIGEN DETECTION TEST^D^^18;2^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,18.02,3)
Enter the DATE of the FIRST POSITIVE HIV ANTIGEN detection test.
"^DD",799.4,799.4,18.02,20,0)
^.3LA^1^1
"^DD",799.4,799.4,18.02,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,18.02,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,18.02,21,1,0)
This field is used for the date of the first 
"^DD",799.4,799.4,18.02,21,2,0)
positive HIV antigen detection test which was run.
"^DD",799.4,799.4,18.02,21,3,0)
The data is used in generating the CDC HIV/AIDS
"^DD",799.4,799.4,18.02,21,4,0)
form.
"^DD",799.4,799.4,18.02,"DT")
2941026
"^DD",799.4,799.4,18.03,0)
HIV PCR, DNA, OR RNA PROBE^D^^18;3^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,18.03,3)
Enter the DATE of the FIRST POSITIVE PCR, DNA, or RNA detection test for HIV.
"^DD",799.4,799.4,18.03,20,0)
^.3LA^1^1
"^DD",799.4,799.4,18.03,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,18.03,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,18.03,21,1,0)
This field is used to hold the date on which an 
"^DD",799.4,799.4,18.03,21,2,0)
HIV test involving PCR, DNA or RNA probes first
"^DD",799.4,799.4,18.03,21,3,0)
produced a positive result.  This information is
"^DD",799.4,799.4,18.03,21,4,0)
used to generate the CDC HIV/AIDS form.
"^DD",799.4,799.4,18.03,"DT")
2941026
"^DD",799.4,799.4,18.04,0)
TYPE OF OTHER POSITIVE TEST^F^^18;4^K:$L(X)>30!($L(X)<3) X
"^DD",799.4,799.4,18.04,3)
Enter the TYPE of OTHER HIV detection test which was POSITIVE.
"^DD",799.4,799.4,18.04,20,0)
^.3LA^1^1
"^DD",799.4,799.4,18.04,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,18.04,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,18.04,21,1,0)
This field is used to indicate the type of other 
"^DD",799.4,799.4,18.04,21,2,0)
HIV detection test which yielded a positive
"^DD",799.4,799.4,18.04,21,3,0)
result. This information is used to generate the
"^DD",799.4,799.4,18.04,21,4,0)
CDC HIV/AIDS form.
"^DD",799.4,799.4,18.04,"DT")
2950519
"^DD",799.4,799.4,18.05,0)
DATE OTHER POS DETECTION TEST^D^^18;5^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,18.05,3)
Enter the DATE for the OTHER positive HIV test.
"^DD",799.4,799.4,18.05,20,0)
^.3LA^1^1
"^DD",799.4,799.4,18.05,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,18.05,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,18.05,21,1,0)
This field is used to hold the date on which a 
"^DD",799.4,799.4,18.05,21,2,0)
positive HIV detection test was obtained with an
"^DD",799.4,799.4,18.05,21,3,0)
"other" type of test. This information is used to
"^DD",799.4,799.4,18.05,21,4,0)
generate the CDC HIV/AIDS form.
"^DD",799.4,799.4,18.05,"DT")
2941026
"^DD",799.4,799.4,18.06,0)
LAST DOCUMNTD NEG HIV TEST^D^^18;6^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,18.06,3)
Enter the date on which the last DOCUMENTED negative HIV test was obtained for this patient.
"^DD",799.4,799.4,18.06,20,0)
^.3LA^1^1
"^DD",799.4,799.4,18.06,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,18.06,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,18.06,21,1,0)
This field is used to hold the date on which the 
"^DD",799.4,799.4,18.06,21,2,0)
patient last had a documented negative HIV test.
"^DD",799.4,799.4,18.06,21,3,0)
This information is used to generate the CDC
"^DD",799.4,799.4,18.06,21,4,0)
HIV/AIDS form.
"^DD",799.4,799.4,18.06,"DT")
2940803
"^DD",799.4,799.4,18.07,0)
TYPE FOR LAST NEG TEST^F^^18;7^K:$L(X)>30!($L(X)<3) X
"^DD",799.4,799.4,18.07,3)
Enter the TYPE of HIV test which was the last documented NEGATIVE HIV test for this patient.  Enter 3-30 characters.
"^DD",799.4,799.4,18.07,20,0)
^.3LA^1^1
"^DD",799.4,799.4,18.07,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,18.07,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,18.07,21,1,0)
This field is used to hold information on the type
"^DD",799.4,799.4,18.07,21,2,0)
of test which resulted in the last documented
"^DD",799.4,799.4,18.07,21,3,0)
negative HIV test (field 18.06). This information
"^DD",799.4,799.4,18.07,21,4,0)
is used to generate the CDC HIV/AIDS form.
"^DD",799.4,799.4,18.07,"DT")
2940803
"^DD",799.4,799.4,18.08,0)
PHYS DOCUMNTD DIAGNOSIS?^S^1:YES;0:NO;9:UNKNONW;^18;8^Q
"^DD",799.4,799.4,18.08,3)
Indicate whether, if HIV laboratory tests were not documented, the HIV diagnosis was documented by a physician.
"^DD",799.4,799.4,18.08,20,0)
^.3LA^1^1
"^DD",799.4,799.4,18.08,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,18.08,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,18.08,21,1,0)
This field is used to indicate whether a physician
"^DD",799.4,799.4,18.08,21,2,0)
has documented the diagnosis of HIV or AIDS in
"^DD",799.4,799.4,18.08,21,3,0)
this patient. The information is used to generate
"^DD",799.4,799.4,18.08,21,4,0)
the CDC HIV/AIDS form.
"^DD",799.4,799.4,18.08,"DT")
2940803
"^DD",799.4,799.4,18.09,0)
DATE PHYS DOCUMNTD DIAG^D^^18;9^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,18.09,3)
If HIV laboratory tests were not documented, enter the DATE that the HIV diagnosis was documented by a physician.
"^DD",799.4,799.4,18.09,20,0)
^.3LA^1^1
"^DD",799.4,799.4,18.09,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,18.09,21,0)
^^5^5^3030211^
"^DD",799.4,799.4,18.09,21,1,0)
This field is used for the date on which the 
"^DD",799.4,799.4,18.09,21,2,0)
physician documented the diagnosis on this patient
"^DD",799.4,799.4,18.09,21,3,0)
if this is the case as indicated by field 18.08.
"^DD",799.4,799.4,18.09,21,4,0)
The information is used to generate the CDC 
"^DD",799.4,799.4,18.09,21,5,0)
HIV/AIDS form.
"^DD",799.4,799.4,18.09,"DT")
2940803
"^DD",799.4,799.4,18.1,0)
DETECTABLE VIRAL LOAD TEST^S^11:NASBA (Organon);12:RT-PCR (Roche);13:bDNA (Chiron);18:Other;^18;10^Q
"^DD",799.4,799.4,18.1,20,0)
^.3LA^1^1
"^DD",799.4,799.4,18.1,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,18.1,"DT")
3030410
"^DD",799.4,799.4,18.11,0)
DETECTABLE VIRAL LOAD RESULT^NJ7,0^^18;11^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",799.4,799.4,18.11,3)
Type a Number between 0 and 9999999, 0 Decimal Digits
"^DD",799.4,799.4,18.11,20,0)
^.3LA^1^1
"^DD",799.4,799.4,18.11,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,18.11,"DT")
3030410
"^DD",799.4,799.4,18.12,0)
DETECTABLE VIRAL LOAD DATE^D^^18;12^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,18.12,20,0)
^.3LA^1^1
"^DD",799.4,799.4,18.12,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,18.12,"DT")
3030410
"^DD",799.4,799.4,18.13,0)
POSITIVE HIV DETECTION TEST^S^1:CULTURE;2:ANTIGEN;3:PCR, DNA OR RNA PROBE;^18;13^Q
"^DD",799.4,799.4,18.13,20,0)
^.3LA^1^1
"^DD",799.4,799.4,18.13,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,18.13,"DT")
3030416
"^DD",799.4,799.4,20.01,0)
CD4+ COUNT FOR CDC^NJ5,0^^20;1^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",799.4,799.4,20.01,3)
Enter the actual count, expressed as number of cells per microliter, of T-helper (CD4+) lymphocytes.
"^DD",799.4,799.4,20.01,20,0)
^.3LA^1^1
"^DD",799.4,799.4,20.01,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,20.01,21,0)
^^2^2^3030211^
"^DD",799.4,799.4,20.01,21,1,0)
This field is used to contain the CD4+ count 
"^DD",799.4,799.4,20.01,21,2,0)
entered for part VI of the revised CDC form.
"^DD",799.4,799.4,20.01,"DT")
3030211
"^DD",799.4,799.4,20.02,0)
CD4+ COUNT FOR CDC DATE^D^^20;2^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,20.02,3)
Enter the date (Month and Year) for the FIRST POSITIVE TEST, or the test date.
"^DD",799.4,799.4,20.02,20,0)
^.3LA^1^1
"^DD",799.4,799.4,20.02,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,20.02,21,0)
^^3^3^3030211^
"^DD",799.4,799.4,20.02,21,1,0)
This field is used to contain the date (month and 
"^DD",799.4,799.4,20.02,21,2,0)
year) when the indicated result in part VI of the
"^DD",799.4,799.4,20.02,21,3,0)
revised CDC form was originally determined.
"^DD",799.4,799.4,20.02,"DT")
3030211
"^DD",799.4,799.4,20.03,0)
CD4+ PERCENT FOR CDC^NJ2,0^^20;3^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1N.N) X
"^DD",799.4,799.4,20.03,3)
Type a Number between 0 and 99, 0 Decimal Digits to indicate the percent of the lymphocyte population which was CD4+ lymphocytes.
"^DD",799.4,799.4,20.03,20,0)
^.3LA^1^1
"^DD",799.4,799.4,20.03,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,20.03,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,20.03,21,1,0)
This field is used to enter the percentage of 
"^DD",799.4,799.4,20.03,21,2,0)
CD4+ leukocytes present in the leukocyte
"^DD",799.4,799.4,20.03,21,3,0)
population.  The value is used for part VI of the 
"^DD",799.4,799.4,20.03,21,4,0)
revised CDC form.
"^DD",799.4,799.4,20.03,"DT")
3030211
"^DD",799.4,799.4,20.04,0)
CD4+ PERCENT FOR CDC DATE^D^^20;4^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,20.04,3)
Enter the DATE for the CD4 PERCENTAGE at or near the current diagnostic status.
"^DD",799.4,799.4,20.04,20,0)
^.3LA^1^1
"^DD",799.4,799.4,20.04,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,20.04,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,20.04,21,1,0)
This field is used to store the date on which the 
"^DD",799.4,799.4,20.04,21,2,0)
percentage CD4 value was determined at or closest
"^DD",799.4,799.4,20.04,21,3,0)
to the current diagnosis.  This information is
"^DD",799.4,799.4,20.04,21,4,0)
used to generate the CDC HIV/AIDS form.
"^DD",799.4,799.4,20.04,"DT")
3030211
"^DD",799.4,799.4,20.05,0)
CD4 COUNT FIRST <200^NJ3,0^^20;5^K:+X'=X!(X>200)!(X<0)!(X?.E1"."1N.N) X
"^DD",799.4,799.4,20.05,3)
Enter the first CD4 COUNT which was below 200.  This should be a number between 0 and 199
"^DD",799.4,799.4,20.05,20,0)
^.3LA^1^1
"^DD",799.4,799.4,20.05,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,20.05,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,20.05,21,1,0)
This field is used to contain the number count for
"^DD",799.4,799.4,20.05,21,2,0)
the first CD4 count which was below the value of
"^DD",799.4,799.4,20.05,21,3,0)
200. This information is used to generate the CDC
"^DD",799.4,799.4,20.05,21,4,0)
HIV/AIDS form.
"^DD",799.4,799.4,20.05,"DT")
2941026
"^DD",799.4,799.4,20.06,0)
CD4 COUNT FIRST <200 DATE^D^^20;6^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,20.06,3)
Enter the date for the CD4 count which first gave a value of less than 200.
"^DD",799.4,799.4,20.06,20,0)
^.3LA^1^1
"^DD",799.4,799.4,20.06,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,20.06,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,20.06,21,1,0)
This field is used to hold the date on which the 
"^DD",799.4,799.4,20.06,21,2,0)
CD4 count was first below the value of 200. This
"^DD",799.4,799.4,20.06,21,3,0)
information is used to generate the CDC HIV/AIDS
"^DD",799.4,799.4,20.06,21,4,0)
form.
"^DD",799.4,799.4,20.06,"DT")
2941026
"^DD",799.4,799.4,20.07,0)
CD4 PERCENT FIRST <14%^NJ4,1^^20;7^K:+X'=X!(X>13)!(X<0)!(X?.E1"."2N.N) X
"^DD",799.4,799.4,20.07,3)
Enter the CD4 PERCENTAGE which first gave a value of less than 14 %.
"^DD",799.4,799.4,20.07,20,0)
^.3LA^1^1
"^DD",799.4,799.4,20.07,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,20.07,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,20.07,21,1,0)
This field is used to hold the CD4 percentage 
"^DD",799.4,799.4,20.07,21,2,0)
value which was obtained when the percentage was
"^DD",799.4,799.4,20.07,21,3,0)
first below 14%. This information is used to
"^DD",799.4,799.4,20.07,21,4,0)
generate the CDC HIV/AIDS form.
"^DD",799.4,799.4,20.07,"DT")
2941026
"^DD",799.4,799.4,20.08,0)
CD4 PERCENT FIRST <14% DATE^D^^20;8^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,20.08,.1)
Date of First CD4 Percentage value of less than 14%
"^DD",799.4,799.4,20.08,3)
Enter the date of the first CD4 PERCENTAGE which resulted in a value of less than 14%.
"^DD",799.4,799.4,20.08,20,0)
^.3LA^1^1
"^DD",799.4,799.4,20.08,20,1,0)
CDC FORM (VI)
"^DD",799.4,799.4,20.08,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,20.08,21,1,0)
This field is used to hold the date on which the 
"^DD",799.4,799.4,20.08,21,2,0)
percentage CD4 value was first observed to be
"^DD",799.4,799.4,20.08,21,3,0)
below 14%. This information is used to generate
"^DD",799.4,799.4,20.08,21,4,0)
the CDC HIV/AIDS form.
"^DD",799.4,799.4,20.08,"DT")
2941026
"^DD",799.4,799.4,22.01,0)
PATIENT BEEN INFORMED OF HIV^S^1:YES;0:NO;9:UNKNOWN;^22;1^Q
"^DD",799.4,799.4,22.01,.1)
Has the Patient been informed of HIV Infection?
"^DD",799.4,799.4,22.01,3)
Indicate whether the patient has been informed of the diagnosis of HIV infection.
"^DD",799.4,799.4,22.01,20,0)
^.3LA^1^1
"^DD",799.4,799.4,22.01,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,22.01,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,22.01,21,1,0)
This field is used to indicate whether the patient
"^DD",799.4,799.4,22.01,21,2,0)
has been informed of the diagnosis of HIV
"^DD",799.4,799.4,22.01,21,3,0)
infection. The field is used to supply data for
"^DD",799.4,799.4,22.01,21,4,0)
the CDC HIV/AIDS form.
"^DD",799.4,799.4,22.01,"DT")
2940628
"^DD",799.4,799.4,22.02,0)
PARTNERS NOTIFIED BY^S^1:Health Dept.;2:Physician/Provider;3:Patient;9:Unknown;^22;2^Q
"^DD",799.4,799.4,22.02,.1)
Patient's sexual Partners will be notified by
"^DD",799.4,799.4,22.02,3)
Indicate the entity with responsibility for informing the patient's sexual partners of the patient's HIV infection.
"^DD",799.4,799.4,22.02,20,0)
^.3LA^1^1
"^DD",799.4,799.4,22.02,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,22.02,21,0)
^^5^5^3060203^
"^DD",799.4,799.4,22.02,21,1,0)
This field is used to indicate the entity with 
"^DD",799.4,799.4,22.02,21,2,0)
responsibility for informing the patient's sexual
"^DD",799.4,799.4,22.02,21,3,0)
partners of the patient's HIV infection. The data
"^DD",799.4,799.4,22.02,21,4,0)
in this field will be used in the CDC HIV/AIDS 
"^DD",799.4,799.4,22.02,21,5,0)
form.
"^DD",799.4,799.4,22.02,"DT")
3060203
"^DD",799.4,799.4,22.03,0)
HIV RELATED MED SERVICES^S^1:YES;0:NO;9:UNKNOWN;^22;3^Q
"^DD",799.4,799.4,22.03,3)
Indicate if this patient is receiving or has been referred for HIV-related medical services.
"^DD",799.4,799.4,22.03,20,0)
^.3LA^1^1
"^DD",799.4,799.4,22.03,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,22.03,21,0)
^^5^5^3060203^
"^DD",799.4,799.4,22.03,21,1,0)
This field is used to hold the response related 
"^DD",799.4,799.4,22.03,21,2,0)
to whether the patient is receiving or has been
"^DD",799.4,799.4,22.03,21,3,0)
referred to receive HIV-related medical services.
"^DD",799.4,799.4,22.03,21,4,0)
This information is used in preparing the CDC 
"^DD",799.4,799.4,22.03,21,5,0)
HIV/AIDS form.
"^DD",799.4,799.4,22.03,"DT")
2950710
"^DD",799.4,799.4,22.04,0)
RCVD ANTI-RETROVIRAL THERAPY^S^1:YES;0:NO;9:UNKNOWN;^22;4^Q
"^DD",799.4,799.4,22.04,.1)
RECIEVING OR RECIEVED ANTI-RETROVIRAL THERAPY
"^DD",799.4,799.4,22.04,3)
Indicate whether the patient has received or is receiving anti-retroviral therapy.
"^DD",799.4,799.4,22.04,20,0)
^.3LA^1^1
"^DD",799.4,799.4,22.04,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,22.04,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,22.04,21,1,0)
The response should indicate whether the patient 
"^DD",799.4,799.4,22.04,21,2,0)
has received or is receiving anti-retroviral
"^DD",799.4,799.4,22.04,21,3,0)
therapy. The data is used in generating the CDC
"^DD",799.4,799.4,22.04,21,4,0)
HIV/AIDS form.
"^DD",799.4,799.4,22.04,"DT")
2940628
"^DD",799.4,799.4,22.05,0)
RECEIVED PCP PROPHYLAXIS^S^1:YES;0:NO;9:UNKNOWN;^22;5^Q
"^DD",799.4,799.4,22.05,.1)
Received or receiving PCP Prophylaxis
"^DD",799.4,799.4,22.05,3)
Indicate whether the patient has received or is receiving PCP prophylaxis.
"^DD",799.4,799.4,22.05,20,0)
^.3LA^1^1
"^DD",799.4,799.4,22.05,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,22.05,21,0)
^^3^3^3030211^
"^DD",799.4,799.4,22.05,21,1,0)
The response should indicate whether the patient 
"^DD",799.4,799.4,22.05,21,2,0)
has received or is receiving PCP prophylaxis. The
"^DD",799.4,799.4,22.05,21,3,0)
data is used in generating the CDC HIV/AIDS form.
"^DD",799.4,799.4,22.05,"DT")
2940628
"^DD",799.4,799.4,22.06,0)
ENROLLED AT CLINCAL TRIAL^S^1:NIH SPONSORED;2:OTHER;3:NONE;9:UNKNOWN;^22;6^Q
"^DD",799.4,799.4,22.06,3)
Indicate whether the patient is enrolled in a clinical trial, and which category of clinical trial.
"^DD",799.4,799.4,22.06,20,0)
^.3LA^1^1
"^DD",799.4,799.4,22.06,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,22.06,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,22.06,21,1,0)
This field is used to indicate whether the patient
"^DD",799.4,799.4,22.06,21,2,0)
is enrolled in a clinical trial, and which
"^DD",799.4,799.4,22.06,21,3,0)
category of clinical trial. The data in this field
"^DD",799.4,799.4,22.06,21,4,0)
is used in generating the CDC HIV/AIDS form.
"^DD",799.4,799.4,22.06,"DT")
2940628
"^DD",799.4,799.4,22.07,0)
ENROLLED AT CLINIC^S^1:HRSA SPONSORED;2:OTHER;3:NONE;9:UNKNOWN;^22;7^Q
"^DD",799.4,799.4,22.07,3)
Indicate whether the patient is enrolled in a clinic, and which category of clinic.
"^DD",799.4,799.4,22.07,20,0)
^.3LA^1^1
"^DD",799.4,799.4,22.07,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,22.07,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,22.07,21,1,0)
This field is used to indicate whether the patient
"^DD",799.4,799.4,22.07,21,2,0)
is enrolled in a clinic, and which category of
"^DD",799.4,799.4,22.07,21,3,0)
clinic. The data in this field is used in
"^DD",799.4,799.4,22.07,21,4,0)
generating the CDC HIV/AIDS form.
"^DD",799.4,799.4,22.07,"DT")
2940628
"^DD",799.4,799.4,22.08,0)
PRIMARY REIMBURSER FOR MED RX^S^1:MEDICAID;2:PRIMARY INS/HMO;3:NO COVERAGE;4:OTHER PUBLIC FUNDS;7:CLINICAL TRIAL/GOVMNT PROGRAM;9:UNKNOWN;^22;8^Q
"^DD",799.4,799.4,22.08,.1)
Medical treatment PRIMARILY reimbursed by
"^DD",799.4,799.4,22.08,3)
Indicate the PRIMARY reimburser for this patient's medical treatment.
"^DD",799.4,799.4,22.08,20,0)
^.3LA^1^1
"^DD",799.4,799.4,22.08,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,22.08,21,0)
^^4^4^3030211^
"^DD",799.4,799.4,22.08,21,1,0)
This field is used to indicate who was the PRIMARY
"^DD",799.4,799.4,22.08,21,2,0)
reimburser for this patient's medical treatment.
"^DD",799.4,799.4,22.08,21,3,0)
The entry is used in the generation of the CDC
"^DD",799.4,799.4,22.08,21,4,0)
HIV/AIDS form.
"^DD",799.4,799.4,22.08,"DT")
2940628
"^DD",799.4,799.4,23.01,0)
GYNECOLOGY OR OBSTETRIC CARE^S^1:YES;0:NO;9:UNKNOWN;^23;1^Q
"^DD",799.4,799.4,23.01,.1)
Patient receiving obstetric or gynecological care
"^DD",799.4,799.4,23.01,3)
For FEMALE patients only - Is the patient receiving obstetric or gynecological care?
"^DD",799.4,799.4,23.01,20,0)
^.3LA^1^1
"^DD",799.4,799.4,23.01,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,23.01,21,0)
^^3^3^3060203^
"^DD",799.4,799.4,23.01,21,1,0)
This field is applicable to female patients only.
"^DD",799.4,799.4,23.01,21,2,0)
The field is used to indicate whether the patient
"^DD",799.4,799.4,23.01,21,3,0)
is receiving obstetric or gynecological care.
"^DD",799.4,799.4,23.01,"DT")
3030211
"^DD",799.4,799.4,23.02,0)
CURRENTLY PREGNANT^S^1:YES;0:NO;9:UNKNOWN;^23;2^Q
"^DD",799.4,799.4,23.02,3)
For FEMALE patients only - Is the patient currently pregnant?
"^DD",799.4,799.4,23.02,20,0)
^.3LA^1^1
"^DD",799.4,799.4,23.02,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,23.02,21,0)
^.001^4^4^3060203^^
"^DD",799.4,799.4,23.02,21,1,0)
This field is applicable to female patients only. 
"^DD",799.4,799.4,23.02,21,2,0)
The field is used to indicate whether the female
"^DD",799.4,799.4,23.02,21,3,0)
patient is pregnant at the time the CDC HIV/AIDS
"^DD",799.4,799.4,23.02,21,4,0)
form is generated.
"^DD",799.4,799.4,23.02,"DT")
3030211
"^DD",799.4,799.4,23.03,0)
DELIVERED LIVE BORN INFANT^S^1:YES;0:NO;3:UNKNOWN;^23;3^Q
"^DD",799.4,799.4,23.03,3)
For FEMALE patients only - Has the female patient ever delivered a live born infant?
"^DD",799.4,799.4,23.03,20,0)
^.3LA^1^1
"^DD",799.4,799.4,23.03,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,23.03,21,0)
^^5^5^3060203^
"^DD",799.4,799.4,23.03,21,1,0)
This field is applicable to female patients only.
"^DD",799.4,799.4,23.03,21,2,0)
The field is used to indicate whether the female
"^DD",799.4,799.4,23.03,21,3,0)
patient ever delivered a live born infant. The
"^DD",799.4,799.4,23.03,21,4,0)
response is used to generate the CDC HIV/AIDS
"^DD",799.4,799.4,23.03,21,5,0)
form.
"^DD",799.4,799.4,23.03,"DT")
3030211
"^DD",799.4,799.4,23.04,0)
CHILD'S DATE OF BIRTH^D^^23;4^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.4,23.04,3)
For FEMALE patients only - Enter the date of birth of the last child born to the patient if the birthdate is past 1977.
"^DD",799.4,799.4,23.04,20,0)
^.3LA^1^1
"^DD",799.4,799.4,23.04,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,23.04,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,23.04,21,1,0)
This field is used to indicate the date of birth 
"^DD",799.4,799.4,23.04,21,2,0)
of a child to a female patient who has been 
"^DD",799.4,799.4,23.04,21,3,0)
diagnosed with HIV or AIDS. This information is
"^DD",799.4,799.4,23.04,21,4,0)
used to generate the CDC HIV/AIDS form.
"^DD",799.4,799.4,23.04,"DT")
2941026
"^DD",799.4,799.4,23.05,0)
CHILD'S HOSPITAL OF BIRTH^F^^23;5^K:$L(X)>23!($L(X)<2) X
"^DD",799.4,799.4,23.05,3)
For FEMALE patients only - Enter the name of the hospital (2 to 23 characters) in which the patient's last child was born, if applicable, and the date of birth is past 1977.
"^DD",799.4,799.4,23.05,20,0)
^.3LA^1^1
"^DD",799.4,799.4,23.05,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,23.05,21,0)
^^5^5^3060203^
"^DD",799.4,799.4,23.05,21,1,0)
This field is used to indicate the birth hospital 
"^DD",799.4,799.4,23.05,21,2,0)
for the most recent child of a female patient who
"^DD",799.4,799.4,23.05,21,3,0)
has been diagnosed with HIV or AIDS. This
"^DD",799.4,799.4,23.05,21,4,0)
information is used to generate the CDC HIV/AIDS
"^DD",799.4,799.4,23.05,21,5,0)
form.
"^DD",799.4,799.4,23.05,"DT")
2941026
"^DD",799.4,799.4,23.06,0)
CHILD'S HOSPITAL - CITY^F^^23;6^K:$L(X)>23!($L(X)<2) X
"^DD",799.4,799.4,23.06,3)
Enter the name of the city (2-23 characters) in which the CHILD'S HOSPITAL of birth is located.
"^DD",799.4,799.4,23.06,20,0)
^.3LA^1^1
"^DD",799.4,799.4,23.06,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,23.06,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,23.06,21,1,0)
This field is used to hold the city of the birth 
"^DD",799.4,799.4,23.06,21,2,0)
hospital of the most recent child of a female
"^DD",799.4,799.4,23.06,21,3,0)
diagnosed with HIV or AIDS. This information is
"^DD",799.4,799.4,23.06,21,4,0)
used to generate the CDC HIV/AIDS form.
"^DD",799.4,799.4,23.06,"DT")
2941026
"^DD",799.4,799.4,23.07,0)
CHILD'S HOSPITAL - STATE^F^^23;7^K:$L(X)>2!($L(X)<2)!'(X?2U) X
"^DD",799.4,799.4,23.07,3)
Enter the 2 letter abbreviation for the state in which the CHILD'S HOSPITAL OF BIRTH is located.
"^DD",799.4,799.4,23.07,20,0)
^.3LA^1^1
"^DD",799.4,799.4,23.07,20,1,0)
CDC FORM (IX)
"^DD",799.4,799.4,23.07,21,0)
^^4^4^3060203^
"^DD",799.4,799.4,23.07,21,1,0)
This field is used to hold the state of the birth 
"^DD",799.4,799.4,23.07,21,2,0)
hospital of the most recent child of a female
"^DD",799.4,799.4,23.07,21,3,0)
diagnosed with HIV or AIDS. This information is
"^DD",799.4,799.4,23.07,21,4,0)
used to generate the CDC HIV/AIDS form.
"^DD",799.4,799.4,23.07,"DT")
2941026
"^DD",799.4,799.4,25,0)
CDC COMMENTS^799.425^^25;0
"^DD",799.4,799.4,25,20,0)
^.3LA^1^1
"^DD",799.4,799.4,25,20,1,0)
CDC FORM (X)
"^DD",799.4,799.41,0)
AIDS INDICATOR DISEASE SUB-FIELD^^.03^3
"^DD",799.4,799.41,0,"DT")
3030207
"^DD",799.4,799.41,0,"IX","B",799.41,.01)

"^DD",799.4,799.41,0,"NM","AIDS INDICATOR DISEASE")

"^DD",799.4,799.41,0,"UP")
799.4
"^DD",799.4,799.41,.01,0)
AIDS INDICATOR DISEASE^M*P799.49'X^ROR(799.49,^0;1^S DIC("S")="I $P($G(^(0)),U,3)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X S:$D(X) DINUM=X
"^DD",799.4,799.41,.01,1,0)
^.1
"^DD",799.4,799.41,.01,1,1,0)
799.41^B
"^DD",799.4,799.41,.01,1,1,1)
S ^RORDATA(799.4,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",799.4,799.41,.01,1,1,2)
K ^RORDATA(799.4,DA(1),10,"B",$E(X,1,30),DA)
"^DD",799.4,799.41,.01,12)
Only active indicator diseases can be selected.
"^DD",799.4,799.41,.01,12.1)
S DIC("S")="I $P($G(^(0)),U,3)"
"^DD",799.4,799.41,.01,20,0)
^.3LA^1^1
"^DD",799.4,799.41,.01,20,1,0)
CDC FORM (VIII)
"^DD",799.4,799.41,.01,21,0)
^.001^2^2^3030507^^^
"^DD",799.4,799.41,.01,21,1,0)
The AIDS INDICATOR DISEASE field references the 
"^DD",799.4,799.41,.01,21,2,0)
AIDS indicator disease.
"^DD",799.4,799.41,.01,23,0)
^^6^6^3030507^
"^DD",799.4,799.41,.01,23,1,0)
Only diseases that have values in the SEQUENTIAL NUMBER
"^DD",799.4,799.41,.01,23,2,0)
field can be selected from the ROR AIDS INDICATOR
"^DD",799.4,799.41,.01,23,3,0)
DISEASE file.
"^DD",799.4,799.41,.01,23,4,0)
 
"^DD",799.4,799.41,.01,23,5,0)
Internal value of this field is used as the internal 
"^DD",799.4,799.41,.01,23,6,0)
entry number of the record (the 'DINUM' feature).
"^DD",799.4,799.41,.01,"DT")
3030207
"^DD",799.4,799.41,.02,0)
INITIAL DIAGNOSIS^*S^1:Definitive;2:Presumptive;^0;2^Q
"^DD",799.4,799.41,.02,3)

"^DD",799.4,799.41,.02,12)
Each indicator disease have its own set of initial diagnoses.
"^DD",799.4,799.41,.02,12.1)
S DIC("S")="N RORV S RORV=+$G(^RORDATA(799.4,DA(1),10,DA,0)) I RORV>0 S RORV=$P($G(^ROR(799.49,RORV,0)),U,2) I ("";""_RORV)[("";""_Y_"":"")"
"^DD",799.4,799.41,.02,20,0)
^.3LA^1^1
"^DD",799.4,799.41,.02,20,1,0)
CDC FORM (VIII)
"^DD",799.4,799.41,.02,21,0)
^^2^2^3030507^
"^DD",799.4,799.41,.02,21,1,0)
The INITIAL DIAGNOSIS field stores a diagnosis for
"^DD",799.4,799.41,.02,21,2,0)
the disease. 
"^DD",799.4,799.41,.02,23,0)
^^5^5^3030507^
"^DD",799.4,799.41,.02,23,1,0)
The set of codes is screened according to the value of
"^DD",799.4,799.41,.02,23,2,0)
the INITIAL DIAGNOSIS VALUES field (.02) from the
"^DD",799.4,799.41,.02,23,3,0)
record of the ROR AIDS INDICATOR DISEASE file
"^DD",799.4,799.41,.02,23,4,0)
(#799.49) that is referenced by the AIDS INDICATOR 
"^DD",799.4,799.41,.02,23,5,0)
DISEASE field (.01) of this multiple.
"^DD",799.4,799.41,.02,"DT")
3030206
"^DD",799.4,799.41,.03,0)
DATE^D^^0;3^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",799.4,799.41,.03,20,0)
^.3LA^1^1
"^DD",799.4,799.41,.03,20,1,0)
CDC FORM (VIII)
"^DD",799.4,799.41,.03,21,0)
^^2^2^3030507^
"^DD",799.4,799.41,.03,21,1,0)
The DATE field stores the date when the disease 
"^DD",799.4,799.41,.03,21,2,0)
was diagnosed.
"^DD",799.4,799.41,.03,"DT")
3030206
"^DD",799.4,799.425,0)
CDC COMMENTS SUB-FIELD^^.01^1
"^DD",799.4,799.425,0,"DT")
3030211
"^DD",799.4,799.425,0,"NM","CDC COMMENTS")

"^DD",799.4,799.425,0,"UP")
799.4
"^DD",799.4,799.425,.01,0)
CDC COMMENTS^WL^^0;1^Q
"^DD",799.4,799.425,.01,21,0)
^^2^2^3030507^
"^DD",799.4,799.425,.01,21,1,0)
The CDC COMMENTS field stores 3 lines of text that
"^DD",799.4,799.425,.01,21,2,0)
is printed in the section X of the CDC form.
"^DD",799.4,799.425,.01,"DT")
3030211
"^DD",799.49,799.49,0)
FIELD^^2^5
"^DD",799.49,799.49,0,"DDA")
N
"^DD",799.49,799.49,0,"DT")
3030507
"^DD",799.49,799.49,0,"ID","WRITE")
D EN^DDIOL($J(Y,3),"","?40")
"^DD",799.49,799.49,0,"IX","AS",799.49,.03)

"^DD",799.49,799.49,0,"IX","B",799.49,.01)

"^DD",799.49,799.49,0,"NM","ROR AIDS INDICATOR DISEASE")

"^DD",799.49,799.49,0,"PT",799.41,.01)

"^DD",799.49,799.49,0,"VRPK")
ROR
"^DD",799.49,799.49,.01,0)
DISEASE NAME^RFX^^0;1^Q:$$VAEDT^RORDD(799.49,,-1)  K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",799.49,799.49,.01,1,0)
^.1
"^DD",799.49,799.49,.01,1,1,0)
799.49^B
"^DD",799.49,799.49,.01,1,1,1)
S ^ROR(799.49,"B",$E(X,1,30),DA)=""
"^DD",799.49,799.49,.01,1,1,2)
K ^ROR(799.49,"B",$E(X,1,30),DA)
"^DD",799.49,799.49,.01,1,1,3)
Do not delete!
"^DD",799.49,799.49,.01,3)
Answer must be 3-30 characters in length.
"^DD",799.49,799.49,.01,8.5)
@
"^DD",799.49,799.49,.01,9)
@
"^DD",799.49,799.49,.01,21,0)
^^2^2^3030506^
"^DD",799.49,799.49,.01,21,1,0)
The DISEASE NAME field stores a short name of the
"^DD",799.49,799.49,.01,21,2,0)
disease. 
"^DD",799.49,799.49,.01,23,0)
^^4^4^3030506^
"^DD",799.49,799.49,.01,23,1,0)
Usually, the name is the same as that of the
"^DD",799.49,799.49,.01,23,2,0)
corresponding field of the IMMUNOLOGY CASE STUDY file
"^DD",799.49,799.49,.01,23,3,0)
(#158) that was used by the Immunology Case Registry
"^DD",799.49,799.49,.01,23,4,0)
v2.1 software.
"^DD",799.49,799.49,.01,"DEL",1,0)
I $$VADEL^RORDD(799.49,,-1)
"^DD",799.49,799.49,.01,"DT")
3030206
"^DD",799.49,799.49,.02,0)
INITIAL DIAGNOSIS VALUES^RFX^^0;2^Q:$$VAEDT^RORDD(799.49,,-1)  K:$L(X)>30!($L(X)<1) X
"^DD",799.49,799.49,.02,3)
Answer must be 1-30 characters in length.
"^DD",799.49,799.49,.02,8.5)
@
"^DD",799.49,799.49,.02,9)
@
"^DD",799.49,799.49,.02,21,0)
^^13^13^3060203^
"^DD",799.49,799.49,.02,21,1,0)
The INITIAL DIAGNOSIS VALUES field contains a list
"^DD",799.49,799.49,.02,21,2,0)
of valid diagnoses for this particular disease (as
"^DD",799.49,799.49,.02,21,3,0)
they are defined in the CDC form), separated by
"^DD",799.49,799.49,.02,21,4,0)
semicolons. Each initial diagnosis should consist
"^DD",799.49,799.49,.02,21,5,0)
of internal and external values separated by
"^DD",799.49,799.49,.02,21,6,0)
colon.
"^DD",799.49,799.49,.02,21,7,0)
 
"^DD",799.49,799.49,.02,21,8,0)
For example: '1:Definitive;2:Presumptive'.
"^DD",799.49,799.49,.02,21,9,0)
 
"^DD",799.49,799.49,.02,21,10,0)
The full set of possible diagnoses should be also
"^DD",799.49,799.49,.02,21,11,0)
defined for the INITIAL DIAGNOSIS field of the
"^DD",799.49,799.49,.02,21,12,0)
AIDS INDICATOR DISEASE multiple of the ROR ICR
"^DD",799.49,799.49,.02,21,13,0)
STUDY file.
"^DD",799.49,799.49,.02,23,0)
^.001^4^4^3060203^^^^
"^DD",799.49,799.49,.02,23,1,0)
The value of this field is used by the input transform 
"^DD",799.49,799.49,.02,23,2,0)
of the INITIAL DIAGNOSIS field (.02) of the AIDS 
"^DD",799.49,799.49,.02,23,3,0)
INDICATOR DISEASE multiple (10) of the ROR ICR STUDY 
"^DD",799.49,799.49,.02,23,4,0)
file (#799.4).
"^DD",799.49,799.49,.02,"DT")
3030206
"^DD",799.49,799.49,.03,0)
SEQUENTIAL NUMBER^NJ2,0X^^0;3^Q:$$VAEDT^RORDD(799.49,,-1)  K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",799.49,799.49,.03,1,0)
^.1
"^DD",799.49,799.49,.03,1,1,0)
799.49^AS
"^DD",799.49,799.49,.03,1,1,1)
S ^ROR(799.49,"AS",$E(X,1,30),DA)=""
"^DD",799.49,799.49,.03,1,1,2)
K ^ROR(799.49,"AS",$E(X,1,30),DA)
"^DD",799.49,799.49,.03,1,1,3)
Do not delete!
"^DD",799.49,799.49,.03,1,1,"DT")
3030207
"^DD",799.49,799.49,.03,3)
Type a Number between 1 and 99, 0 Decimal Digits.
"^DD",799.49,799.49,.03,8.5)
@
"^DD",799.49,799.49,.03,9)
@
"^DD",799.49,799.49,.03,21,0)
^^7^7^3060203^
"^DD",799.49,799.49,.03,21,1,0)
The SEQUENTIAL NUMBER field stores a sequential 
"^DD",799.49,799.49,.03,21,2,0)
number of the indicator disease in part VIII of
"^DD",799.49,799.49,.03,21,3,0)
the CDC form (the first column from top to bottom
"^DD",799.49,799.49,.03,21,4,0)
and then the second column in the same way).
"^DD",799.49,799.49,.03,21,5,0)
 
"^DD",799.49,799.49,.03,21,6,0)
If this field has no value then the record is 
"^DD",799.49,799.49,.03,21,7,0)
considered inactive.
"^DD",799.49,799.49,.03,"DEL",1,0)
I $$VADEL^RORDD(799.49,,-1)
"^DD",799.49,799.49,.03,"DT")
3030207
"^DD",799.49,799.49,1.01,0)
DESCRIPTION^RFX^^1;1^Q:$$VAEDT^RORDD(799.49,,-1)  K:$L(X)>100!($L(X)<1) X
"^DD",799.49,799.49,1.01,3)
Answer must be 1-100 characters in length.
"^DD",799.49,799.49,1.01,8.5)
@
"^DD",799.49,799.49,1.01,9)
@
"^DD",799.49,799.49,1.01,21,0)
^^3^3^3060203^
"^DD",799.49,799.49,1.01,21,1,0)
The DESCRIPTION field stores the text associated
"^DD",799.49,799.49,1.01,21,2,0)
with the AIDS indicator disease in part VIII of
"^DD",799.49,799.49,1.01,21,3,0)
the CDC form.
"^DD",799.49,799.49,1.01,23,0)
^.001^1^1^3060203^^^^
"^DD",799.49,799.49,1.01,23,1,0)
This field is not currently used by the software.
"^DD",799.49,799.49,1.01,"DT")
3030507
"^DD",799.49,799.49,2,0)
METHOD DESCRIPTION^799.492^^2;0
"^DD",799.49,799.49,2,"DT")
3030507
"^DD",799.49,799.492,0)
METHOD DESCRIPTION SUB-FIELD^^.01^1
"^DD",799.49,799.492,0,"DT")
3030507
"^DD",799.49,799.492,0,"NM","METHOD DESCRIPTION")

"^DD",799.49,799.492,0,"UP")
799.49
"^DD",799.49,799.492,.01,0)
METHOD DESCRIPTION^WL^^0;1^Q
"^DD",799.49,799.492,.01,21,0)
^^3^3^3030507^
"^DD",799.49,799.492,.01,21,1,0)
The METHOD DESCRIPTION field stores descriptions
"^DD",799.49,799.492,.01,21,2,0)
of the methods that should be used to diagnose the
"^DD",799.49,799.492,.01,21,3,0)
disease.
"^DD",799.49,799.492,.01,"DT")
3030507
"^DD",799.51,799.51,0)
FIELD^^.09^5
"^DD",799.51,799.51,0,"DDA")
N
"^DD",799.51,799.51,0,"DT")
3040114
"^DD",799.51,799.51,0,"IX","AR",799.51,.02)

"^DD",799.51,799.51,0,"IX","B",799.51,.01)

"^DD",799.51,799.51,0,"NM","ROR GENERIC DRUG")

"^DD",799.51,799.51,0,"VRPK")
ROR
"^DD",799.51,799.51,0,"VRRV")
1.1^ROR*1*5
"^DD",799.51,799.51,.01,0)
NAME^RFX^^0;1^Q:$$VAEDT^RORDD(799.51,$G(DA))  K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",799.51,799.51,.01,1,0)
^.1
"^DD",799.51,799.51,.01,1,1,0)
799.51^B
"^DD",799.51,799.51,.01,1,1,1)
S ^ROR(799.51,"B",$E(X,1,30),DA)=""
"^DD",799.51,799.51,.01,1,1,2)
K ^ROR(799.51,"B",$E(X,1,30),DA)
"^DD",799.51,799.51,.01,1,1,3)
Do not delete!
"^DD",799.51,799.51,.01,3)
Name must be 3-30 characters, not numeric or starting with punctuation.
"^DD",799.51,799.51,.01,8.5)
@
"^DD",799.51,799.51,.01,9)
@
"^DD",799.51,799.51,.01,21,0)
^.001^4^4^3040124^^^
"^DD",799.51,799.51,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF 
"^DD",799.51,799.51,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.51,799.51,.01,21,3,0)
 
"^DD",799.51,799.51,.01,21,4,0)
The NAME field stores a short name of the drug.
"^DD",799.51,799.51,.01,"DEL",1,0)
I $$VADEL^RORDD(799.51,$G(DA))
"^DD",799.51,799.51,.02,0)
REGISTRY^RP798.1'X^ROR(798.1,^0;2^Q:$$VAEDT^RORDD(799.51,$G(DA))
"^DD",799.51,799.51,.02,1,0)
^.1
"^DD",799.51,799.51,.02,1,1,0)
799.51^AR
"^DD",799.51,799.51,.02,1,1,1)
S ^ROR(799.51,"AR",$E(X,1,30),DA)=""
"^DD",799.51,799.51,.02,1,1,2)
K ^ROR(799.51,"AR",$E(X,1,30),DA)
"^DD",799.51,799.51,.02,1,1,3)
Do not delete!
"^DD",799.51,799.51,.02,1,1,"%D",0)
^^2^2^3040124^
"^DD",799.51,799.51,.02,1,1,"%D",1,0)
This cross-reference groups all drugs associated
"^DD",799.51,799.51,.02,1,1,"%D",2,0)
with a particular registry together.
"^DD",799.51,799.51,.02,1,1,"DT")
3030818
"^DD",799.51,799.51,.02,8.5)
@
"^DD",799.51,799.51,.02,9)
@
"^DD",799.51,799.51,.02,21,0)
^^5^5^3040124^
"^DD",799.51,799.51,.02,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF 
"^DD",799.51,799.51,.02,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.51,799.51,.02,21,3,0)
 
"^DD",799.51,799.51,.02,21,4,0)
This field identifies the registry that the drug 
"^DD",799.51,799.51,.02,21,5,0)
is associated with.
"^DD",799.51,799.51,.02,"DT")
3040114
"^DD",799.51,799.51,.03,0)
DRUG GROUP^R*P799.1'X^ROR(799.1,^0;3^Q:$$VAEDT^RORDD(799.51,$G(DA))  S Y=$P($G(^ROR(799.51,DA,0)),U,2),DIC("S")="S D=$G(^(0)) I $P(D,U,2)=4"_$S(Y>0:",$P(D,U,3)="_Y,1:"") D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",799.51,799.51,.03,3)

"^DD",799.51,799.51,.03,8.5)
@
"^DD",799.51,799.51,.03,9)
@
"^DD",799.51,799.51,.03,12)
Only Drug Groups can be selected.
"^DD",799.51,799.51,.03,12.1)
S DIC("S")="S D=$G(^(0)) I $P(D,U,2)=4"_$S(Y>0:",$P(D,U,3)="_Y,1:"")
"^DD",799.51,799.51,.03,21,0)
^^2^2^3040124^
"^DD",799.51,799.51,.03,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF 
"^DD",799.51,799.51,.03,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.51,799.51,.03,23,0)
^^2^2^3040124^
"^DD",799.51,799.51,.03,23,1,0)
This field is not used currently. It is reserved for 
"^DD",799.51,799.51,.03,23,2,0)
future use.
"^DD",799.51,799.51,.03,"DT")
3040124
"^DD",799.51,799.51,.04,0)
VA GENERIC^RP50.6'X^PSNDF(50.6,^0;4^Q:$$VAEDT^RORDD(799.51,$G(DA))
"^DD",799.51,799.51,.04,8.5)
@
"^DD",799.51,799.51,.04,9)
@
"^DD",799.51,799.51,.04,21,0)
^^2^2^3040124^
"^DD",799.51,799.51,.04,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF 
"^DD",799.51,799.51,.04,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.51,799.51,.04,"DT")
3040114
"^DD",799.51,799.51,.09,0)
NATIONAL^SX^0:NO;1:YES;^0;9^Q:$$VAEDT^RORDD(799.51,,-1)
"^DD",799.51,799.51,.09,8.5)
@
"^DD",799.51,799.51,.09,9)
@
"^DD",799.51,799.51,.09,21,0)
^^6^6^3060203^
"^DD",799.51,799.51,.09,21,1,0)
ONLY AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN
"^DD",799.51,799.51,.09,21,2,0)
EDIT THIS FIELD!
"^DD",799.51,799.51,.09,21,3,0)
 
"^DD",799.51,799.51,.09,21,4,0)
Drugs associated with the national registries must
"^DD",799.51,799.51,.09,21,5,0)
have this field set to "YES". This prevents local
"^DD",799.51,799.51,.09,21,6,0)
editing of other fields of the record.
"^DD",799.51,799.51,.09,"DEL",1,0)
I $$VADEL^RORDD(799.51,,-1)
"^DD",799.51,799.51,.09,"DT")
3030818
"^DD",799.53,799.53,0)
FIELD^^1^4
"^DD",799.53,799.53,0,"DDA")
N
"^DD",799.53,799.53,0,"DT")
3050513
"^DD",799.53,799.53,0,"ID",.03)
S %I=Y,Y=$S('$D(^(0)):"",$D(^ROR(798.1,+$P(^(0),U,3),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(798.1,.01,0),U,2) D Y^DIQ:Y]"" W ?35,"   ",Y S Y=%I K %I
"^DD",799.53,799.53,0,"IX","B",799.53,.01)

"^DD",799.53,799.53,0,"NM","ROR LOCAL FIELD")

"^DD",799.53,799.53,0,"PT",798.02,.01)

"^DD",799.53,799.53,0,"VRPK")
ROR
"^DD",799.53,799.53,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",799.53,799.53,.01,1,0)
^.1
"^DD",799.53,799.53,.01,1,1,0)
799.53^B
"^DD",799.53,799.53,.01,1,1,1)
S ^ROR(799.53,"B",$E(X,1,30),DA)=""
"^DD",799.53,799.53,.01,1,1,2)
K ^ROR(799.53,"B",$E(X,1,30),DA)
"^DD",799.53,799.53,.01,1,1,3)
Do not delete!
"^DD",799.53,799.53,.01,3)
Enter name of the local field (3-30 characters).
"^DD",799.53,799.53,.01,8.5)
@
"^DD",799.53,799.53,.01,9)
@
"^DD",799.53,799.53,.01,21,0)
^^3^3^3050513^
"^DD",799.53,799.53,.01,21,1,0)
You can either select an existing local field 
"^DD",799.53,799.53,.01,21,2,0)
definition or add a new one. Field names must be 
"^DD",799.53,799.53,.01,21,3,0)
unique within the registry.
"^DD",799.53,799.53,.01,"DT")
3050513
"^DD",799.53,799.53,.02,0)
DATE OF INACTIVATION^D^^0;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",799.53,799.53,.02,8.5)
@
"^DD",799.53,799.53,.02,9)
@
"^DD",799.53,799.53,.02,21,0)
^.001^6^6^3050812^^
"^DD",799.53,799.53,.02,21,1,0)
If this field has a value, the definition of local
"^DD",799.53,799.53,.02,21,2,0)
field will be considered inactive and will not be 
"^DD",799.53,799.53,.02,21,3,0)
presented to the users after this date. 
"^DD",799.53,799.53,.02,21,4,0)
 
"^DD",799.53,799.53,.02,21,5,0)
Use this field to disable unnecessary local fields
"^DD",799.53,799.53,.02,21,6,0)
(and keep their values) instead of deleting them.
"^DD",799.53,799.53,.02,"DT")
3050513
"^DD",799.53,799.53,.03,0)
REGISTRY^RP798.1'^ROR(798.1,^0;3^Q
"^DD",799.53,799.53,.03,8.5)
@
"^DD",799.53,799.53,.03,9)
@
"^DD",799.53,799.53,.03,21,0)
^^2^2^3050513^
"^DD",799.53,799.53,.03,21,1,0)
This field identifies the registry that the local
"^DD",799.53,799.53,.03,21,2,0)
field is associated with.
"^DD",799.53,799.53,.03,"DT")
3050513
"^DD",799.53,799.53,1,0)
DESCRIPTION^RF^^1;E1,200^K:$L(X)>200!($L(X)<3) X
"^DD",799.53,799.53,1,3)
Enter description of the local field (3-200 characters).
"^DD",799.53,799.53,1,8.5)
@
"^DD",799.53,799.53,1,9)
@
"^DD",799.53,799.53,1,21,0)
^^3^3^3060203^
"^DD",799.53,799.53,1,21,1,0)
The DESCRIPTION field stores explanations of the 
"^DD",799.53,799.53,1,21,2,0)
local field and/or its purpose. This text is
"^DD",799.53,799.53,1,21,3,0)
presented to the user during editing of the field.
"^DD",799.53,799.53,1,"DT")
3050513
"^DD",799.6,799.6,0)
FIELD^^5^14
"^DD",799.6,799.6,0,"DDA")
N
"^DD",799.6,799.6,0,"DT")
3051101
"^DD",799.6,799.6,0,"NM","ROR HISTORICAL DATA EXTRACTION")

"^DD",799.6,799.6,0,"PT",798.1,21.01)

"^DD",799.6,799.6,0,"VRPK")
ROR
"^DD",799.6,799.6,.01,0)
NAME^RFX^^0;1^Q:$$VAEDT^RORDD(799.6,$G(DA))  K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",799.6,799.6,.01,1,0)
^.1^^-1
"^DD",799.6,799.6,.01,1,2,0)
^^TRIGGER^799.6^.07
"^DD",799.6,799.6,.01,1,2,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S Y(1)=$S($D(^RORDATA(799.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,7)'>0 I X S X=DIV S Y(1)=$S($D(^RORDATA(799.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,7),X=X S DIU=X K Y S X=DIV S X=DT X ^DD(799.6,.01,1,2,1.4)
"^DD",799.6,799.6,.01,1,2,1.4)
S DIH=$G(^RORDATA(799.6,DIV(0),0)),DIV=X S $P(^(0),U,7)=DIV,DIH=799.6,DIG=.07 D ^DICR
"^DD",799.6,799.6,.01,1,2,2)
Q
"^DD",799.6,799.6,.01,1,2,3)
Do not delete!
"^DD",799.6,799.6,.01,1,2,"%D",0)
^^7^7^3051101^
"^DD",799.6,799.6,.01,1,2,"%D",1,0)
If the ACTIVATION DATE field (.07) is empty, then
"^DD",799.6,799.6,.01,1,2,"%D",2,0)
this trigger populates it with the current date 
"^DD",799.6,799.6,.01,1,2,"%D",3,0)
when the package is installed.
"^DD",799.6,799.6,.01,1,2,"%D",4,0)
 
"^DD",799.6,799.6,.01,1,2,"%D",5,0)
Thus the historical data extraction parameters
"^DD",799.6,799.6,.01,1,2,"%D",6,0)
become active and will be processed by the next 
"^DD",799.6,799.6,.01,1,2,"%D",7,0)
run of the nightly task.
"^DD",799.6,799.6,.01,1,2,"CREATE CONDITION")
ACTIVATION DATE'>0
"^DD",799.6,799.6,.01,1,2,"CREATE VALUE")
TODAY
"^DD",799.6,799.6,.01,1,2,"DELETE VALUE")
NO EFFECT
"^DD",799.6,799.6,.01,1,2,"DT")
3051031
"^DD",799.6,799.6,.01,1,2,"FIELD")
ACTIVATION DATE
"^DD",799.6,799.6,.01,3)
Enter the unique data extraction name (3-30 characters).
"^DD",799.6,799.6,.01,8.5)
@
"^DD",799.6,799.6,.01,9)
@
"^DD",799.6,799.6,.01,20,0)
^.3LA^1^1
"^DD",799.6,799.6,.01,20,1,0)
DEFINITION
"^DD",799.6,799.6,.01,21,0)
^^7^7^3060203^
"^DD",799.6,799.6,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",799.6,799.6,.01,21,2,0)
NATIONAL HISTORICAL DATA EXTRACTION DEFINITION!
"^DD",799.6,799.6,.01,21,3,0)
 
"^DD",799.6,799.6,.01,21,4,0)
This field stores the unique name of the
"^DD",799.6,799.6,.01,21,5,0)
historical data extraction. If an extraction is
"^DD",799.6,799.6,.01,21,6,0)
initiated by a patch, it is a good idea to include
"^DD",799.6,799.6,.01,21,7,0)
the patch number.
"^DD",799.6,799.6,.01,"DEL",1,0)
I $$VADEL^RORDD(799.6,$G(DA))
"^DD",799.6,799.6,.01,"DT")
3051101
"^DD",799.6,799.6,.02,0)
TYPE^RSX^1:Auto (HL7 messages);2:Manual (host files);^0;2^Q:$$VAEDT^RORDD(799.6,$G(DA))
"^DD",799.6,799.6,.02,8.5)
@
"^DD",799.6,799.6,.02,9)
@
"^DD",799.6,799.6,.02,20,0)
^.3LA^1^1
"^DD",799.6,799.6,.02,20,1,0)
DEFINITION
"^DD",799.6,799.6,.02,21,0)
^^15^15^3060203^
"^DD",799.6,799.6,.02,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A 
"^DD",799.6,799.6,.02,21,2,0)
NATIONAL HISTORICAL DATA EXTRACTION DEFINITION!
"^DD",799.6,799.6,.02,21,3,0)
 
"^DD",799.6,799.6,.02,21,4,0)
This field defines the type of data extraction.
"^DD",799.6,799.6,.02,21,5,0)
 
"^DD",799.6,799.6,.02,21,6,0)
Automatic data extractions are initiated by the 
"^DD",799.6,799.6,.02,21,7,0)
CCR patches. Data is extracted by the nightly task
"^DD",799.6,799.6,.02,21,8,0)
and sent via regular batch HL7 messages.
"^DD",799.6,799.6,.02,21,9,0)
 
"^DD",799.6,799.6,.02,21,10,0)
Manual data extractions are initiated by the users
"^DD",799.6,799.6,.02,21,11,0)
using the options from the maintenance menu. They 
"^DD",799.6,799.6,.02,21,12,0)
schedule the data extraction tasks and verify 
"^DD",799.6,799.6,.02,21,13,0)
their completion. Data is written to host files, 
"^DD",799.6,799.6,.02,21,14,0)
which are transferred to the AAC via FTP or any
"^DD",799.6,799.6,.02,21,15,0)
other means.
"^DD",799.6,799.6,.02,"DEL",1,0)
I $$VADEL^RORDD(799.6,$G(DA))
"^DD",799.6,799.6,.02,"DT")
3051031
"^DD",799.6,799.6,.03,0)
START DATE^RDX^^0;3^Q:$$VAEDT^RORDD(799.6,$G(DA))  S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",799.6,799.6,.03,1,0)
^.1
"^DD",799.6,799.6,.03,1,1,0)
^^TRIGGER^799.6^.04
"^DD",799.6,799.6,.03,1,1,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S Y(1)=$S($D(^RORDATA(799.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,4)'>0 I X S X=DIV S Y(1)=$S($D(^RORDATA(799.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X=DIV S X=DT X ^DD(799.6,.03,1,1,1.4)
"^DD",799.6,799.6,.03,1,1,1.4)
S DIH=$G(^RORDATA(799.6,DIV(0),0)),DIV=X S $P(^(0),U,4)=DIV,DIH=799.6,DIG=.04 D ^DICR
"^DD",799.6,799.6,.03,1,1,2)
Q
"^DD",799.6,799.6,.03,1,1,3)
Do not delete!
"^DD",799.6,799.6,.03,1,1,"%D",0)
^^3^3^3051101^
"^DD",799.6,799.6,.03,1,1,"%D",1,0)
If the END DATE field (.04) is empty, then this
"^DD",799.6,799.6,.03,1,1,"%D",2,0)
trigger populates it with the current date when
"^DD",799.6,799.6,.03,1,1,"%D",3,0)
the package is installed.
"^DD",799.6,799.6,.03,1,1,"CREATE CONDITION")
END DATE'>0
"^DD",799.6,799.6,.03,1,1,"CREATE VALUE")
TODAY
"^DD",799.6,799.6,.03,1,1,"DELETE VALUE")
NO EFFECT
"^DD",799.6,799.6,.03,1,1,"DT")
3051101
"^DD",799.6,799.6,.03,1,1,"FIELD")
END DATE
"^DD",799.6,799.6,.03,8.5)
@
"^DD",799.6,799.6,.03,9)
@
"^DD",799.6,799.6,.03,20,0)
^.3LA^1^1
"^DD",799.6,799.6,.03,20,1,0)
DEFINITION
"^DD",799.6,799.6,.03,21,0)
^.001^5^5^3051101^^
"^DD",799.6,799.6,.03,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A 
"^DD",799.6,799.6,.03,21,2,0)
NATIONAL HISTORICAL DATA EXTRACTION DEFINITION!
"^DD",799.6,799.6,.03,21,3,0)
 
"^DD",799.6,799.6,.03,21,4,0)
This field indicates the start date for the 
"^DD",799.6,799.6,.03,21,5,0)
historical data extraction.
"^DD",799.6,799.6,.03,"DEL",1,0)
I $$VADEL^RORDD(799.6,$G(DA))
"^DD",799.6,799.6,.03,"DT")
3051101
"^DD",799.6,799.6,.04,0)
END DATE^DX^^0;4^Q:$$VAEDT^RORDD(799.6,$G(DA))  S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",799.6,799.6,.04,5,1,0)
799.6^.03^1
"^DD",799.6,799.6,.04,8.5)
@
"^DD",799.6,799.6,.04,9)
@
"^DD",799.6,799.6,.04,20,0)
^.3LA^1^1
"^DD",799.6,799.6,.04,20,1,0)
DEFINITION
"^DD",799.6,799.6,.04,21,0)
^^5^5^3051101^
"^DD",799.6,799.6,.04,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A 
"^DD",799.6,799.6,.04,21,2,0)
NATIONAL HISTORICAL DATA EXTRACTION DEFINITION!
"^DD",799.6,799.6,.04,21,3,0)
 
"^DD",799.6,799.6,.04,21,4,0)
This field indicates the end date for the 
"^DD",799.6,799.6,.04,21,5,0)
historical data extraction.
"^DD",799.6,799.6,.04,"DEL",1,0)
I $$VADEL^RORDD(799.6,$G(DA))
"^DD",799.6,799.6,.04,"DT")
3051101
"^DD",799.6,799.6,.05,0)
PATIENTS PER BATCH^NJ9,0X^^0;5^Q:$$VAEDT^RORDD(799.6,$G(DA))  K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",799.6,799.6,.05,3)
Type a Number between 1 and 999999999, 0 Decimal Digits.
"^DD",799.6,799.6,.05,8.5)
@
"^DD",799.6,799.6,.05,9)
@
"^DD",799.6,799.6,.05,20,0)
^.3LA^2^2
"^DD",799.6,799.6,.05,20,1,0)
DEFINITION
"^DD",799.6,799.6,.05,20,2,0)
MANUAL
"^DD",799.6,799.6,.05,21,0)
^^6^6^3051219^
"^DD",799.6,799.6,.05,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A 
"^DD",799.6,799.6,.05,21,2,0)
NATIONAL HISTORICAL DATA EXTRACTION DEFINITION!
"^DD",799.6,799.6,.05,21,3,0)
 
"^DD",799.6,799.6,.05,21,4,0)
The PATIENTS PER BATCH field holds the maximum
"^DD",799.6,799.6,.05,21,5,0)
number of patients whose data is written into a
"^DD",799.6,799.6,.05,21,6,0)
single historical data extraction output file.
"^DD",799.6,799.6,.05,23,0)
^.001^2^2^3060203^^^^
"^DD",799.6,799.6,.05,23,1,0)
This field is used only during manual historical data
"^DD",799.6,799.6,.05,23,2,0)
extractions.
"^DD",799.6,799.6,.05,"DEL",1,0)
I $$VADEL^RORDD(799.6,$G(DA))
"^DD",799.6,799.6,.05,"DT")
3050725
"^DD",799.6,799.6,.06,0)
MAXIMUM MESSAGE SIZE^NJ4,1X^^0;6^Q:$$VAEDT^RORDD(799.6,$G(DA))  K:+X'=X!(X>99)!(X<0)!(X?.E1"."2N.N) X
"^DD",799.6,799.6,.06,3)
Type a Number between 0 and 99, 1 Decimal Digit.
"^DD",799.6,799.6,.06,8.5)
@
"^DD",799.6,799.6,.06,9)
@
"^DD",799.6,799.6,.06,20,0)
^.3LA^2^2
"^DD",799.6,799.6,.06,20,1,0)
DEFINITION
"^DD",799.6,799.6,.06,20,2,0)
AUTO
"^DD",799.6,799.6,.06,21,0)
^.001^7^7^3051219^^
"^DD",799.6,799.6,.06,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A 
"^DD",799.6,799.6,.06,21,2,0)
NATIONAL HISTORICAL DATA EXTRACTION DEFINITION!
"^DD",799.6,799.6,.06,21,3,0)
 
"^DD",799.6,799.6,.06,21,4,0)
This field stores the maximum size (in megabytes)
"^DD",799.6,799.6,.06,21,5,0)
of a batch HL7 message that can be sent to Austin
"^DD",799.6,799.6,.06,21,6,0)
Automation Center (AAC). If this field is empty or
"^DD",799.6,799.6,.06,21,7,0)
contains 0, the size is not limited.
"^DD",799.6,799.6,.06,23,0)
^.001^11^11^3060203^^
"^DD",799.6,799.6,.06,23,1,0)
Actual size of an HL7 batch can be greater than the
"^DD",799.6,799.6,.06,23,2,0)
value of this field because the software does not break
"^DD",799.6,799.6,.06,23,3,0)
in the middle of an individual HL7 message.
"^DD",799.6,799.6,.06,23,4,0)
 
"^DD",799.6,799.6,.06,23,5,0)
For example, if the maximum size is 10Mb, the current
"^DD",799.6,799.6,.06,23,6,0)
size is 9Mb and 3Mb should be sent for the patient
"^DD",799.6,799.6,.06,23,7,0)
being processed then the actual size of the batch will
"^DD",799.6,799.6,.06,23,8,0)
be 12Mb.
"^DD",799.6,799.6,.06,23,9,0)
 
"^DD",799.6,799.6,.06,23,10,0)
This field is used only during automatic historical 
"^DD",799.6,799.6,.06,23,11,0)
data extractions.
"^DD",799.6,799.6,.06,"DEL",1,0)
I $$VADEL^RORDD(799.6,$G(DA))
"^DD",799.6,799.6,.06,"DT")
3051101
"^DD",799.6,799.6,.07,0)
ACTIVATION DATE^D^^0;7^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",799.6,799.6,.07,5,1,0)
799.6^.01^2
"^DD",799.6,799.6,.07,8.5)
@
"^DD",799.6,799.6,.07,9)
@
"^DD",799.6,799.6,.07,20,0)
^.3LA^2^2
"^DD",799.6,799.6,.07,20,1,0)
STATE
"^DD",799.6,799.6,.07,20,2,0)
AUTO
"^DD",799.6,799.6,.07,21,0)
^^5^5^3051219^
"^DD",799.6,799.6,.07,21,1,0)
This field is used only for automatic data 
"^DD",799.6,799.6,.07,21,2,0)
extractions. If it is empty, then the nightly task
"^DD",799.6,799.6,.07,21,3,0)
ignores this record completely. Otherwise, the
"^DD",799.6,799.6,.07,21,4,0)
data extraction will not start before the date and
"^DD",799.6,799.6,.07,21,5,0)
time stored in this field.
"^DD",799.6,799.6,.07,"DT")
3051031
"^DD",799.6,799.6,.08,0)
BASE FILE NAME^FX^^0;8^K:$L(X)>15!($L(X)<1) X
"^DD",799.6,799.6,.08,3)
Answer must be 1-15 characters in length.
"^DD",799.6,799.6,.08,8.5)
@
"^DD",799.6,799.6,.08,9)
@
"^DD",799.6,799.6,.08,20,0)
^.3LA^2^2
"^DD",799.6,799.6,.08,20,1,0)
DEFINITION
"^DD",799.6,799.6,.08,20,2,0)
MANUAL
"^DD",799.6,799.6,.08,21,0)
^^19^19^3051219^
"^DD",799.6,799.6,.08,21,1,0)
The base part for the output file names is stored
"^DD",799.6,799.6,.08,21,2,0)
in this field. It is populated either by a patch 
"^DD",799.6,799.6,.08,21,3,0)
or by the user (if they are instructed to do so).
"^DD",799.6,799.6,.08,21,4,0)
 
"^DD",799.6,799.6,.08,21,5,0)
The output file names will have the following
"^DD",799.6,799.6,.08,21,6,0)
structure:
"^DD",799.6,799.6,.08,21,7,0)
 
"^DD",799.6,799.6,.08,21,8,0)
  BASE-SSS-TT.HDT
"^DD",799.6,799.6,.08,21,9,0)
 
"^DD",799.6,799.6,.08,21,10,0)
where 'BASE' is the value of this field, 'SSS' is
"^DD",799.6,799.6,.08,21,11,0)
the site number (3 digits), and 'TT' is the
"^DD",799.6,799.6,.08,21,12,0)
sequential number of the task (2 digits).
"^DD",799.6,799.6,.08,21,13,0)
                                                     
"^DD",799.6,799.6,.08,21,14,0)
If the task is restarted, the optional numeric
"^DD",799.6,799.6,.08,21,15,0)
modifier '##' (2 digits) will be added to the name
"^DD",799.6,799.6,.08,21,16,0)
so that the already extracted data will not be
"^DD",799.6,799.6,.08,21,17,0)
overwritten:
"^DD",799.6,799.6,.08,21,18,0)
                                                     
"^DD",799.6,799.6,.08,21,19,0)
  BASE-SSS-TT-##.HDT 
"^DD",799.6,799.6,.08,23,0)
^^2^2^3060203^
"^DD",799.6,799.6,.08,23,1,0)
This field is used only during manual historical data
"^DD",799.6,799.6,.08,23,2,0)
extractions.
"^DD",799.6,799.6,.08,"DT")
3051219
"^DD",799.6,799.6,.09,0)
NATIONAL^SX^0:NO;1:YES;^0;9^Q:$$VAEDT^RORDD(799.6,,-1)
"^DD",799.6,799.6,.09,8.5)
@
"^DD",799.6,799.6,.09,9)
@
"^DD",799.6,799.6,.09,20,0)
^.3LA^1^1
"^DD",799.6,799.6,.09,20,1,0)
DEFINITION
"^DD",799.6,799.6,.09,21,0)
^^6^6^3060203^
"^DD",799.6,799.6,.09,21,1,0)
ONLY AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN
"^DD",799.6,799.6,.09,21,2,0)
EDIT THIS FIELD!
"^DD",799.6,799.6,.09,21,3,0)
 
"^DD",799.6,799.6,.09,21,4,0)
National historical data extractions (backpulls)
"^DD",799.6,799.6,.09,21,5,0)
must have this field set to "YES". This prevents
"^DD",799.6,799.6,.09,21,6,0)
local editing of other fields of the definitions.
"^DD",799.6,799.6,.09,"DEL",1,0)
I $$VADEL^RORDD(799.6,$G(DA))
"^DD",799.6,799.6,.09,"DT")
3050725
"^DD",799.6,799.6,1,0)
DATA AREA^799.61P^^1;0
"^DD",799.6,799.6,1,9)
@
"^DD",799.6,799.6,1,20,0)
^.3LA^1^1
"^DD",799.6,799.6,1,20,1,0)
DEFINITION
"^DD",799.6,799.6,1,21,0)
^.001^7^7^3051219^^
"^DD",799.6,799.6,1,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A 
"^DD",799.6,799.6,1,21,2,0)
NATIONAL HISTORICAL DATA EXTRACTION DEFINITION!
"^DD",799.6,799.6,1,21,3,0)
 
"^DD",799.6,799.6,1,21,4,0)
This multiple lists all data areas in which the 
"^DD",799.6,799.6,1,21,5,0)
data extraction will be performed. It can also
"^DD",799.6,799.6,1,21,6,0)
contain additional time frames for these data
"^DD",799.6,799.6,1,21,7,0)
areas.
"^DD",799.6,799.6,2,0)
OUTPUT DIRECTORY^F^^2;E1,240^K:$L(X)>240!($L(X)<1) X
"^DD",799.6,799.6,2,3)
Enter a valid name of the output directory (1-240 characters).
"^DD",799.6,799.6,2,20,0)
^.3LA^2^2
"^DD",799.6,799.6,2,20,1,0)
PARAMETERS
"^DD",799.6,799.6,2,20,2,0)
MANUAL
"^DD",799.6,799.6,2,21,0)
^^19^19^3060203^
"^DD",799.6,799.6,2,21,1,0)
A directory must be created within the file system
"^DD",799.6,799.6,2,21,2,0)
of the host operating system (VMS, Windows,
"^DD",799.6,799.6,2,21,3,0)
etc.). Text files containing historical data in
"^DD",799.6,799.6,2,21,4,0)
the HL7 format will be created in this directory
"^DD",799.6,799.6,2,21,5,0)
by the data extraction tasks.
"^DD",799.6,799.6,2,21,6,0)
 
"^DD",799.6,799.6,2,21,7,0)
The full name of the directory must be entered as
"^DD",799.6,799.6,2,21,8,0)
a value of this field. For example, the value can
"^DD",799.6,799.6,2,21,9,0)
look something like this:
"^DD",799.6,799.6,2,21,10,0)
 
"^DD",799.6,799.6,2,21,11,0)
   VA2$:[OUTPUT] - VAX VMS 
"^DD",799.6,799.6,2,21,12,0)
   D:\Output\    - Windows, MS-DOS
"^DD",799.6,799.6,2,21,13,0)
 
"^DD",799.6,799.6,2,21,14,0)
Because a file name will be concatenated to the
"^DD",799.6,799.6,2,21,15,0)
directory name, the trailing slash in the Windows
"^DD",799.6,799.6,2,21,16,0)
directory name is required.
"^DD",799.6,799.6,2,21,17,0)
 
"^DD",799.6,799.6,2,21,18,0)
Do not forget to enable read/write access to this
"^DD",799.6,799.6,2,21,19,0)
directory for M processes!
"^DD",799.6,799.6,2,"DT")
3050722
"^DD",799.6,799.6,3,0)
REGISTRY NAME^799.63^^3;0
"^DD",799.6,799.6,3,9)
@
"^DD",799.6,799.6,3,21,0)
^^3^3^3051219^
"^DD",799.6,799.6,3,21,1,0)
This multiple references the registries that the
"^DD",799.6,799.6,3,21,2,0)
data extraction will be performed for and
"^DD",799.6,799.6,3,21,3,0)
indicates the extraction status.
"^DD",799.6,799.6,3,"DT")
3051031
"^DD",799.6,799.6,4,0)
TASK^799.64^^4;0
"^DD",799.6,799.6,4,9)
@
"^DD",799.6,799.6,4,20,0)
^.3LA^2^2
"^DD",799.6,799.6,4,20,1,0)
STATE
"^DD",799.6,799.6,4,20,2,0)
MANUAL
"^DD",799.6,799.6,5,0)
STATUS^CJ2,0^^ ; ^S X=$$HDESTAT^RORDD01(+$G(D0))
"^DD",799.6,799.6,5,9)
^
"^DD",799.6,799.6,5,9.01)

"^DD",799.6,799.6,5,9.1)
S X=$$HDESTAT^RORDD01(+$G(D0))
"^DD",799.6,799.6,5,20,0)
^.3LA^1^1
"^DD",799.6,799.6,5,20,1,0)
STATE
"^DD",799.6,799.6,5,21,0)
^^7^7^3060106^
"^DD",799.6,799.6,5,21,1,0)
This field indicates a generic status of the 
"^DD",799.6,799.6,5,21,2,0)
historical data extraction:
"^DD",799.6,799.6,5,21,3,0)
 
"^DD",799.6,799.6,5,21,4,0)
  ""  Unknown/Undefined
"^DD",799.6,799.6,5,21,5,0)
   0  Inactive
"^DD",799.6,799.6,5,21,6,0)
   1  Pending/Active
"^DD",799.6,799.6,5,21,7,0)
   2  Completed
"^DD",799.6,799.6,5,"DT")
3051114
"^DD",799.6,799.61,0)
DATA AREA SUB-FIELD^^.03^3
"^DD",799.6,799.61,0,"DT")
3050722
"^DD",799.6,799.61,0,"NM","DATA AREA")

"^DD",799.6,799.61,0,"UP")
799.6
"^DD",799.6,799.61,.01,0)
DATA AREA^MP799.33'X^ROR(799.33,^0;1^Q:$$VAEDT^RORDD(799.6,$G(DA(1)))
"^DD",799.6,799.61,.01,1,0)
^.1^^0
"^DD",799.6,799.61,.01,3)

"^DD",799.6,799.61,.01,8.5)
@
"^DD",799.6,799.61,.01,9)
@
"^DD",799.6,799.61,.01,20,0)
^.3LA^^0
"^DD",799.6,799.61,.01,21,0)
^^6^6^3051219^
"^DD",799.6,799.61,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A 
"^DD",799.6,799.61,.01,21,2,0)
NATIONAL HISTORICAL DATA EXTRACTION DEFINITION!
"^DD",799.6,799.61,.01,21,3,0)
 
"^DD",799.6,799.61,.01,21,4,0)
Select the data area where the data extraction 
"^DD",799.6,799.61,.01,21,5,0)
will be performed. Data will be extracted only 
"^DD",799.6,799.61,.01,21,6,0)
from the data areas referenced by this field.
"^DD",799.6,799.61,.01,"DEL",1,0)
I $$VADEL^RORDD(799.6,$G(DA(1)))
"^DD",799.6,799.61,.01,"DT")
3050725
"^DD",799.6,799.61,.02,0)
START DATE^DX^^0;2^Q:$$VAEDT^RORDD(799.6,$G(DA(1)))  S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",799.6,799.61,.02,1,0)
^.1
"^DD",799.6,799.61,.02,1,1,0)
^^TRIGGER^799.61^.03
"^DD",799.6,799.61,.02,1,1,1)
X ^DD(799.61,.02,1,1,1.3) I X S X=DIV S Y(1)=$S($D(^RORDATA(799.6,D0,1,D1,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X=DIV S X=DT X ^DD(799.61,.02,1,1,1.4)
"^DD",799.6,799.61,.02,1,1,1.3)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(0)=X S Y(1)=$S($D(^RORDATA(799.6,D0,1,D1,0)):^(0),1:"") S X=$P(Y(1),U,3)'>0
"^DD",799.6,799.61,.02,1,1,1.4)
S DIH=$G(^RORDATA(799.6,DIV(0),1,DIV(1),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=799.61,DIG=.03 D ^DICR
"^DD",799.6,799.61,.02,1,1,2)
Q
"^DD",799.6,799.61,.02,1,1,3)
Do not delete!
"^DD",799.6,799.61,.02,1,1,"%D",0)
^^3^3^3060106^
"^DD",799.6,799.61,.02,1,1,"%D",1,0)
If the END DATE field (.03) is empty, then this 
"^DD",799.6,799.61,.02,1,1,"%D",2,0)
trigger populates it with the current date when
"^DD",799.6,799.61,.02,1,1,"%D",3,0)
the package is installed.
"^DD",799.6,799.61,.02,1,1,"CREATE CONDITION")
END DATE'>0
"^DD",799.6,799.61,.02,1,1,"CREATE VALUE")
TODAY
"^DD",799.6,799.61,.02,1,1,"DELETE VALUE")
NO EFFECT
"^DD",799.6,799.61,.02,1,1,"FIELD")
END DATE
"^DD",799.6,799.61,.02,8.5)
@
"^DD",799.6,799.61,.02,9)
@
"^DD",799.6,799.61,.02,20,0)
^.3LA^^0
"^DD",799.6,799.61,.02,21,0)
^^10^10^3051219^
"^DD",799.6,799.61,.02,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A 
"^DD",799.6,799.61,.02,21,2,0)
NATIONAL HISTORICAL DATA EXTRACTION DEFINITION!
"^DD",799.6,799.61,.02,21,3,0)
 
"^DD",799.6,799.61,.02,21,4,0)
This field stores the start date of an additional 
"^DD",799.6,799.61,.02,21,5,0)
data extraction time frame for this data area.
"^DD",799.6,799.61,.02,21,6,0)
 
"^DD",799.6,799.61,.02,21,7,0)
If this field is empty, then the data is extracted
"^DD",799.6,799.61,.02,21,8,0)
only in the main time frame defined by the
"^DD",799.6,799.61,.02,21,9,0)
top-level fields START DATE (.03) and END DATE
"^DD",799.6,799.61,.02,21,10,0)
(.04).
"^DD",799.6,799.61,.02,"DEL",1,0)
I $$VADEL^RORDD(799.6,$G(DA(1)))
"^DD",799.6,799.61,.02,"DT")
3051101
"^DD",799.6,799.61,.03,0)
END DATE^DX^^0;3^Q:$$VAEDT^RORDD(799.6,$G(DA(1)))  S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",799.6,799.61,.03,5,1,0)
799.61^.02^1
"^DD",799.6,799.61,.03,8.5)
@
"^DD",799.6,799.61,.03,9)
@
"^DD",799.6,799.61,.03,20,0)
^.3LA^^0
"^DD",799.6,799.61,.03,21,0)
^^10^10^3051219^
"^DD",799.6,799.61,.03,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A 
"^DD",799.6,799.61,.03,21,2,0)
NATIONAL HISTORICAL DATA EXTRACTION DEFINITION!
"^DD",799.6,799.61,.03,21,3,0)
 
"^DD",799.6,799.61,.03,21,4,0)
This field stores the end date of an additional 
"^DD",799.6,799.61,.03,21,5,0)
data extraction time frame for this data area.
"^DD",799.6,799.61,.03,21,6,0)
 
"^DD",799.6,799.61,.03,21,7,0)
If this field is empty, then the data is extracted
"^DD",799.6,799.61,.03,21,8,0)
only in the main time frame defined by the
"^DD",799.6,799.61,.03,21,9,0)
top-level fields START DATE (.03) and END DATE
"^DD",799.6,799.61,.03,21,10,0)
(.04).
"^DD",799.6,799.61,.03,"DEL",1,0)
I $$VADEL^RORDD(799.6,$G(DA(1)))
"^DD",799.6,799.61,.03,"DT")
3051101
"^DD",799.6,799.63,0)
REGISTRY NAME SUB-FIELD^^.02^2
"^DD",799.6,799.63,0,"DT")
3051031
"^DD",799.6,799.63,0,"NM","REGISTRY NAME")

"^DD",799.6,799.63,0,"UP")
799.6
"^DD",799.6,799.63,.01,0)
REGISTRY NAME^MRFX^^0;1^Q:$$VAEDT^RORDD(799.6,$G(DA(1)))  K:$L(X)>30!($L(X)<3) X I $D(X) K:'$D(^ROR(798.1,"B",$E(X,1,30))) X
"^DD",799.6,799.63,.01,1,0)
^.1^^0
"^DD",799.6,799.63,.01,3)
Enter the registry name (3-30 characters).
"^DD",799.6,799.63,.01,4)
I $G(X)="??" N D,DIC,DZ S DIC="^ROR(798.1,",DIC(0)="",D="B",DZ="??" D DQ^DICQ,EN^DDIOL("",,"!")
"^DD",799.6,799.63,.01,8.5)
@
"^DD",799.6,799.63,.01,9)
@
"^DD",799.6,799.63,.01,20,0)
^.3LA^1^1
"^DD",799.6,799.63,.01,20,1,0)
DEFINITION
"^DD",799.6,799.63,.01,21,0)
^^5^5^3051101^
"^DD",799.6,799.63,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A 
"^DD",799.6,799.63,.01,21,2,0)
NATIONAL HISTORICAL DATA EXTRACTION DEFINITION!
"^DD",799.6,799.63,.01,21,3,0)
 
"^DD",799.6,799.63,.01,21,4,0)
Enter a name of the registry exactly as it appears
"^DD",799.6,799.63,.01,21,5,0)
in the ROR REGISTRY PARAMETERS file (#798.1).
"^DD",799.6,799.63,.01,23,0)
^.001^3^3^3051101^^^^
"^DD",799.6,799.63,.01,23,1,0)
Names of the registries are used here instead of 
"^DD",799.6,799.63,.01,23,2,0)
pointers because the KIDS pointer resolving feature 
"^DD",799.6,799.63,.01,23,3,0)
does not work for .01 fields.
"^DD",799.6,799.63,.01,"DEL",1,0)
I $$VADEL^RORDD(799.6,$G(DA(1)))
"^DD",799.6,799.63,.01,"DT")
3051031
"^DD",799.6,799.63,.02,0)
COMPLETION DATE/TIME^D^^0;2^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",799.6,799.63,.02,8.5)
@
"^DD",799.6,799.63,.02,9)
@
"^DD",799.6,799.63,.02,20,0)
^.3LA^1^1
"^DD",799.6,799.63,.02,20,1,0)
STATE
"^DD",799.6,799.63,.02,21,0)
^^7^7^3060203^
"^DD",799.6,799.63,.02,21,1,0)
A valid date in this field indicates that the data
"^DD",799.6,799.63,.02,21,2,0)
extraction has been successfully completed for
"^DD",799.6,799.63,.02,21,3,0)
this registry. 
"^DD",799.6,799.63,.02,21,4,0)
 
"^DD",799.6,799.63,.02,21,5,0)
If the data must be re-extracted, clear this field
"^DD",799.6,799.63,.02,21,6,0)
and the nightly task will repeat the historical
"^DD",799.6,799.63,.02,21,7,0)
data extraction for this registry.
"^DD",799.6,799.63,.02,23,0)
^^4^4^3060203^
"^DD",799.6,799.63,.02,23,1,0)
This field is populated by the $$CHECKMSG^ROR10 
"^DD",799.6,799.63,.02,23,2,0)
function after it confirms successful transmission of 
"^DD",799.6,799.63,.02,23,3,0)
the HL7 messages before the next nightly data
"^DD",799.6,799.63,.02,23,4,0)
extraction.
"^DD",799.6,799.63,.02,"DT")
3051031
"^DD",799.6,799.64,0)
TASK SUB-FIELD^^1^6
"^DD",799.6,799.64,0,"DT")
3050725
"^DD",799.6,799.64,0,"IX","T",799.64,.02)

"^DD",799.6,799.64,0,"NM","TASK")

"^DD",799.6,799.64,0,"UP")
799.6
"^DD",799.6,799.64,.01,0)
START RECORD IEN^MNJ22,9^^0;1^K:+X'=X!(X>999999999999)!(X<1)!(X?.E1"."10N.N) X
"^DD",799.6,799.64,.01,1,0)
^.1^^0
"^DD",799.6,799.64,.01,3)
Enter a patient's IEN (DFN).
"^DD",799.6,799.64,.01,8.5)
@
"^DD",799.6,799.64,.01,9)
@
"^DD",799.6,799.64,.01,21,0)
^^16^16^3060203^
"^DD",799.6,799.64,.01,21,1,0)
All patients of the registries are distributed 
"^DD",799.6,799.64,.01,21,2,0)
between the data extraction tasks. Each task
"^DD",799.6,799.64,.01,21,3,0)
extracts the data of the patients whose DFNs are
"^DD",799.6,799.64,.01,21,4,0)
not less than the value of this field in the task
"^DD",799.6,799.64,.01,21,5,0)
record and are less than the value of the field in
"^DD",799.6,799.64,.01,21,6,0)
the next task record.
"^DD",799.6,799.64,.01,21,7,0)
                                                     
"^DD",799.6,799.64,.01,21,8,0)
The first task always has 1 as a value in this
"^DD",799.6,799.64,.01,21,9,0)
field (just in case).
"^DD",799.6,799.64,.01,21,10,0)
                                                     
"^DD",799.6,799.64,.01,21,11,0)
The last task extracts the data of all patients
"^DD",799.6,799.64,.01,21,12,0)
whose registry records have IENs not less than the
"^DD",799.6,799.64,.01,21,13,0)
value of this field.  
"^DD",799.6,799.64,.01,21,14,0)
                                                     
"^DD",799.6,799.64,.01,21,15,0)
Usually, this field should not be edited. It is
"^DD",799.6,799.64,.01,21,16,0)
populated automatically when the task is created.
"^DD",799.6,799.64,.01,23,0)
^^7^7^3060203^
"^DD",799.6,799.64,.01,23,1,0)
The value of this field is not a real pointer to the 
"^DD",799.6,799.64,.01,23,2,0)
ROR REGISTRY RECORD file. There can be no record in the
"^DD",799.6,799.64,.01,23,3,0)
local registry with an IEN stored in this field.
"^DD",799.6,799.64,.01,23,4,0)
 
"^DD",799.6,799.64,.01,23,5,0)
The historical data extraction task will start 
"^DD",799.6,799.64,.01,23,6,0)
processing from the registry record with an IEN that 
"^DD",799.6,799.64,.01,23,7,0)
is not less than the value of this field.
"^DD",799.6,799.64,.01,"DT")
3051114
"^DD",799.6,799.64,.02,0)
TASK NUMBER^NJ10,0I^^0;2^K:+X'=X!(X>9899999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",799.6,799.64,.02,1,0)
^.1
"^DD",799.6,799.64,.02,1,1,0)
799.64^T
"^DD",799.6,799.64,.02,1,1,1)
S ^RORDATA(799.6,DA(1),4,"T",$E(X,1,30),DA)=""
"^DD",799.6,799.64,.02,1,1,2)
K ^RORDATA(799.6,DA(1),4,"T",$E(X,1,30),DA)
"^DD",799.6,799.64,.02,1,1,3)
Do not delete!
"^DD",799.6,799.64,.02,1,1,"DT")
3050725
"^DD",799.6,799.64,.02,3)
Type a Number between 1 and 9899999999, 0 Decimal Digits.
"^DD",799.6,799.64,.02,8.5)
@
"^DD",799.6,799.64,.02,9)
@
"^DD",799.6,799.64,.02,21,0)
^^6^6^3050725^
"^DD",799.6,799.64,.02,21,1,0)
This field contains the number of the Taskman 
"^DD",799.6,799.64,.02,21,2,0)
task (scheduled or running) that does the data
"^DD",799.6,799.64,.02,21,3,0)
extraction.
"^DD",799.6,799.64,.02,21,4,0)
 
"^DD",799.6,799.64,.02,21,5,0)
This field cannot be edited. It is updated
"^DD",799.6,799.64,.02,21,6,0)
automatically by the data extraction task.
"^DD",799.6,799.64,.02,"DT")
3050725
"^DD",799.6,799.64,.03,0)
STATUS^S^0:Unknown;1:Active> Pending;2:Active> Running;3:Inactive> Finished;4:Inactive> Available;5:Inactive> Interrupted;100:Inactive> Crashed;101:Inactive> Errors;102:Active> Suspended;103:Active> Stopping;^0;3^Q
"^DD",799.6,799.64,.03,3)

"^DD",799.6,799.64,.03,8.5)
@
"^DD",799.6,799.64,.03,9)
@
"^DD",799.6,799.64,.03,21,0)
^^2^2^3050725^
"^DD",799.6,799.64,.03,21,1,0)
The STATUS field stores the last known task
"^DD",799.6,799.64,.03,21,2,0)
status.
"^DD",799.6,799.64,.03,23,0)
^^8^8^3060203^
"^DD",799.6,799.64,.03,23,1,0)
This field is populated with the value returned by the
"^DD",799.6,799.64,.03,23,2,0)
$$STATUS^RORTSK02 function. It will reflect the last 
"^DD",799.6,799.64,.03,23,3,0)
known status of the task even after the task is deleted
"^DD",799.6,799.64,.03,23,4,0)
by the Taskman and its record is deleted from the ROR
"^DD",799.6,799.64,.03,23,5,0)
TASK file (#798.8).
"^DD",799.6,799.64,.03,23,6,0)
 
"^DD",799.6,799.64,.03,23,7,0)
Please do not get value of this field directly; use the
"^DD",799.6,799.64,.03,23,8,0)
$$STATUS^RORHDTUT function instead.
"^DD",799.6,799.64,.03,"DT")
3051114
"^DD",799.6,799.64,.04,0)
NEXT PATIENT IEN^NJ22,9^^0;4^K:+X'=X!(X>999999999999)!(X<1)!(X?.E1"."10N.N) X
"^DD",799.6,799.64,.04,3)
Enter the next patient IEN (1-999999999999, 9 Decimal Digits).
"^DD",799.6,799.64,.04,8.5)
@
"^DD",799.6,799.64,.04,9)
@
"^DD",799.6,799.64,.04,21,0)
^.001^10^10^3060122^^
"^DD",799.6,799.64,.04,21,1,0)
If the data extraction task is stopped, it 
"^DD",799.6,799.64,.04,21,2,0)
finishes processing the current patient and stores
"^DD",799.6,799.64,.04,21,3,0)
the IEN of the patient that should be processed
"^DD",799.6,799.64,.04,21,4,0)
next as the value of this field.
"^DD",799.6,799.64,.04,21,5,0)
 
"^DD",799.6,799.64,.04,21,6,0)
When the task is restarted, it starts from the
"^DD",799.6,799.64,.04,21,7,0)
patient IEN stored in this field.
"^DD",799.6,799.64,.04,21,8,0)
 
"^DD",799.6,799.64,.04,21,9,0)
Usually, this field should not be edited. It is
"^DD",799.6,799.64,.04,21,10,0)
updated automatically by the data extraction task.
"^DD",799.6,799.64,.04,23,0)
^^7^7^3060203^
"^DD",799.6,799.64,.04,23,1,0)
The value of this field is not a real pointer to the 
"^DD",799.6,799.64,.04,23,2,0)
ROR PATIENT file. There can be no record in the file
"^DD",799.6,799.64,.04,23,3,0)
with IEN stored in this field.
"^DD",799.6,799.64,.04,23,4,0)
 
"^DD",799.6,799.64,.04,23,5,0)
The restarted historical data extraction task will 
"^DD",799.6,799.64,.04,23,6,0)
continue processing from the patient with an IEN that
"^DD",799.6,799.64,.04,23,7,0)
is not less than the value of this field.
"^DD",799.6,799.64,.04,"DT")
3060122
"^DD",799.6,799.64,.05,0)
FILE NAME^F^^0;5^K:$L(X)>50!($L(X)<1) X
"^DD",799.6,799.64,.05,3)
Answer must be 1-50 characters in length.
"^DD",799.6,799.64,.05,8.5)
@
"^DD",799.6,799.64,.05,9)
@
"^DD",799.6,799.64,.05,21,0)
^.001^22^22^3051101^^
"^DD",799.6,799.64,.05,21,1,0)
The output file name is stored in this field. This
"^DD",799.6,799.64,.05,21,2,0)
name is generated automatically when the task is
"^DD",799.6,799.64,.05,21,3,0)
created. The name has the following structure:
"^DD",799.6,799.64,.05,21,4,0)
 
"^DD",799.6,799.64,.05,21,5,0)
   BASE-SSS-TT.HDT
"^DD",799.6,799.64,.05,21,6,0)
 
"^DD",799.6,799.64,.05,21,7,0)
where 'BASE' is the base part of the file name
"^DD",799.6,799.64,.05,21,8,0)
provided by the user during creation of the task
"^DD",799.6,799.64,.05,21,9,0)
table 'SSS' is the site number (3 digits), and
"^DD",799.6,799.64,.05,21,10,0)
'TT' is the sequential number of the task (2
"^DD",799.6,799.64,.05,21,11,0)
digits).
"^DD",799.6,799.64,.05,21,12,0)
 
"^DD",799.6,799.64,.05,21,13,0)
If the task is restarted, the optional numeric
"^DD",799.6,799.64,.05,21,14,0)
modifier '##' (2 digits) can be added to the name
"^DD",799.6,799.64,.05,21,15,0)
so that the already extracted data will not be
"^DD",799.6,799.64,.05,21,16,0)
overwritten:
"^DD",799.6,799.64,.05,21,17,0)
 
"^DD",799.6,799.64,.05,21,18,0)
   BASE-SSS-TT-##.HDT
"^DD",799.6,799.64,.05,21,19,0)
 
"^DD",799.6,799.64,.05,21,20,0)
Usually, this field should not be edited. It is
"^DD",799.6,799.64,.05,21,21,0)
populated automatically when the task is created
"^DD",799.6,799.64,.05,21,22,0)
or restarted.
"^DD",799.6,799.64,.05,"DT")
3050722
"^DD",799.6,799.64,1,0)
ERROR^799.641P^^1;0
"^DD",799.6,799.64,1,9)
@
"^DD",799.6,799.64,1,21,0)
^^11^11^3060106^
"^DD",799.6,799.64,1,21,1,0)
This multiple contains a list of registry records 
"^DD",799.6,799.64,1,21,2,0)
that were processed with errors.
"^DD",799.6,799.64,1,21,3,0)
                                 
"^DD",799.6,799.64,1,21,4,0)
When the data extraction task is restarted, it
"^DD",799.6,799.64,1,21,5,0)
tries to re-extract the data for these patients.
"^DD",799.6,799.64,1,21,6,0)
If it succeeds, it deletes the corresponding
"^DD",799.6,799.64,1,21,7,0)
records from the list.
"^DD",799.6,799.64,1,21,8,0)
                                 
"^DD",799.6,799.64,1,21,9,0)
The records of the multiple have the same IENs as
"^DD",799.6,799.64,1,21,10,0)
the corresponding registry records in the ROR
"^DD",799.6,799.64,1,21,11,0)
REGISTRY RECORD file (#798).
"^DD",799.6,799.641,0)
ERROR SUB-FIELD^^.01^1
"^DD",799.6,799.641,0,"DT")
3050722
"^DD",799.6,799.641,0,"IX","B",799.641,.01)

"^DD",799.6,799.641,0,"NM","ERROR")

"^DD",799.6,799.641,0,"UP")
799.64
"^DD",799.6,799.641,.01,0)
ERROR^MP798.4'X^RORDATA(798.4,^0;1^S:$D(X) DINUM=X
"^DD",799.6,799.641,.01,1,0)
^.1
"^DD",799.6,799.641,.01,1,1,0)
799.641^B
"^DD",799.6,799.641,.01,1,1,1)
S ^RORDATA(799.6,DA(2),4,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",799.6,799.641,.01,1,1,2)
K ^RORDATA(799.6,DA(2),4,DA(1),1,"B",$E(X,1,30),DA)
"^DD",799.6,799.641,.01,8.5)
@
"^DD",799.6,799.641,.01,9)
@
"^DD",799.6,799.641,.01,"DT")
3060122
"^DIC",798,798,0)
ROR REGISTRY RECORD^798
"^DIC",798,798,0,"GL")
^RORDATA(798,
"^DIC",798,798,"%",0)
^1.005^^0
"^DIC",798,798,"%D",0)
^^32^32^3060203^
"^DIC",798,798,"%D",1,0)
The ROR REGISTRY RECORD file contains records of
"^DIC",798,798,"%D",2,0)
local registries. Each record associates a patient
"^DIC",798,798,"%D",3,0)
with a registry and contains registry-specific and
"^DIC",798,798,"%D",4,0)
additional service information (when the patient 
"^DIC",798,798,"%D",5,0)
was added to the registry, if they were confirmed,
"^DIC",798,798,"%D",6,0)
etc).
"^DIC",798,798,"%D",7,0)
 
"^DIC",798,798,"%D",8,0)
Records of the file are uniquely identified by 
"^DIC",798,798,"%D",9,0)
the patient and the registry (the "A" primary key
"^DIC",798,798,"%D",10,0)
and the uniqueness index "KEY" are used for that
"^DIC",798,798,"%D",11,0)
purpose).
"^DIC",798,798,"%D",12,0)
 
"^DIC",798,798,"%D",13,0)
When the record of this file is deleted, the logic
"^DIC",798,798,"%D",14,0)
of the ADELETE cross-reference tries to delete the
"^DIC",798,798,"%D",15,0)
associated records from the ROR HIV RECORD 
"^DIC",798,798,"%D",16,0)
(#799.4), ROR PATIENT (#798.4), and ROR PATIENT
"^DIC",798,798,"%D",17,0)
EVENTS (#798.3) files.
"^DIC",798,798,"%D",18,0)
 
"^DIC",798,798,"%D",19,0)
A permanent screen (the ^DD(798,0,"SCR") node) 
"^DIC",798,798,"%D",20,0)
restricts access to records of this file. Users
"^DIC",798,798,"%D",21,0)
can only access records of those registries that
"^DIC",798,798,"%D",22,0)
they have the security key(s) for. Users with the
"^DIC",798,798,"%D",23,0)
ROR VA IRM security key can access all records of
"^DIC",798,798,"%D",24,0)
the file.
"^DIC",798,798,"%D",25,0)
 
"^DIC",798,798,"%D",26,0)
If you want the changes in the security keys
"^DIC",798,798,"%D",27,0)
allocation to have an effect immediately, you 
"^DIC",798,798,"%D",28,0)
should rebuild the "ACL" cross-reference of the
"^DIC",798,798,"%D",29,0)
.01 field of the SECURITY KEY multiple of the ROR
"^DIC",798,798,"%D",30,0)
REGISTRY PARAMETERS file (#798.1). See the
"^DIC",798,798,"%D",31,0)
description of the cross-reference for more
"^DIC",798,798,"%D",32,0)
details.
"^DIC",798,"B","ROR REGISTRY RECORD",798)

"^DIC",798.1,798.1,0)
ROR REGISTRY PARAMETERS^798.1
"^DIC",798.1,798.1,0,"GL")
^ROR(798.1,
"^DIC",798.1,798.1,"%",0)
^1.005^^0
"^DIC",798.1,798.1,"%D",0)
^^22^22^3060203^
"^DIC",798.1,798.1,"%D",1,0)
Records of the ROR REGISTRY PARAMETERS file 
"^DIC",798.1,798.1,"%D",2,0)
contain various registry parameters and the data
"^DIC",798.1,798.1,"%D",3,0)
that indicates current registry state. Every 
"^DIC",798.1,798.1,"%D",4,0)
registry must have a record in this file.
"^DIC",798.1,798.1,"%D",5,0)
 
"^DIC",798.1,798.1,"%D",6,0)
Records of the file are uniquely identified by the
"^DIC",798.1,798.1,"%D",7,0)
registry name (the "A" primary key and the
"^DIC",798.1,798.1,"%D",8,0)
uniqueness index "B" are used for that purpose).
"^DIC",798.1,798.1,"%D",9,0)
 
"^DIC",798.1,798.1,"%D",10,0)
A permanent screen (the ^DD(798.1,0,"SCR") node) 
"^DIC",798.1,798.1,"%D",11,0)
restricts access to records of this file. Users
"^DIC",798.1,798.1,"%D",12,0)
can only access records of those registries that
"^DIC",798.1,798.1,"%D",13,0)
they have the security key(s) for. Users with the
"^DIC",798.1,798.1,"%D",14,0)
ROR VA IRM security key can access all records of
"^DIC",798.1,798.1,"%D",15,0)
the file.
"^DIC",798.1,798.1,"%D",16,0)
 
"^DIC",798.1,798.1,"%D",17,0)
If you want the changes in the security keys 
"^DIC",798.1,798.1,"%D",18,0)
allocation to have an effect immediately, you
"^DIC",798.1,798.1,"%D",19,0)
should rebuild the "ACL" cross-reference of the
"^DIC",798.1,798.1,"%D",20,0)
.01 field of the SECURITY KEY multiple of this
"^DIC",798.1,798.1,"%D",21,0)
file. See the description of the cross-reference
"^DIC",798.1,798.1,"%D",22,0)
for more details.
"^DIC",798.1,"B","ROR REGISTRY PARAMETERS",798.1)

"^DIC",798.2,798.2,0)
ROR SELECTION RULE^798.2
"^DIC",798.2,798.2,0,"GL")
^ROR(798.2,
"^DIC",798.2,798.2,"%",0)
^1.005^^0
"^DIC",798.2,798.2,"%D",0)
^^30^30^3020403^
"^DIC",798.2,798.2,"%D",1,0)
The ROR SELECTION RULES file contains definitions
"^DIC",798.2,798.2,"%D",2,0)
of the selection rules that are used to screen
"^DIC",798.2,798.2,"%D",3,0)
patients for addition to the registries. There are
"^DIC",798.2,798.2,"%D",4,0)
two kinds of rules: top-level and lower level.
"^DIC",798.2,798.2,"%D",5,0)
 
"^DIC",798.2,798.2,"%D",6,0)
If a rule is referenced by the ROR REGISTRY 
"^DIC",798.2,798.2,"%D",7,0)
PARAMETERS file, it is the top-level rule.
"^DIC",798.2,798.2,"%D",8,0)
Non-zero value of any top-level rule expression 
"^DIC",798.2,798.2,"%D",9,0)
directly determines that the patient should be
"^DIC",798.2,798.2,"%D",10,0)
added to the corresponding registry.
"^DIC",798.2,798.2,"%D",11,0)
 
"^DIC",798.2,798.2,"%D",12,0)
Lower level rules are referenced only by other 
"^DIC",798.2,798.2,"%D",13,0)
rules (by rule macros in the expressions). Their
"^DIC",798.2,798.2,"%D",14,0)
expressions are evaluated in the proper order, and
"^DIC",798.2,798.2,"%D",15,0)
the result values are used in the expressions of 
"^DIC",798.2,798.2,"%D",16,0)
other rules. Lower level rules have an indirect
"^DIC",798.2,798.2,"%D",17,0)
impact on the final result and can be used for
"^DIC",798.2,798.2,"%D",18,0)
complex processing of linked files and multiples.
"^DIC",798.2,798.2,"%D",19,0)
 
"^DIC",798.2,798.2,"%D",20,0)
For example, a lower level rule can calculate 
"^DIC",798.2,798.2,"%D",21,0)
maximum and minimum values of a parameter in the
"^DIC",798.2,798.2,"%D",22,0)
sub-file, and a top-level rule will analyze these
"^DIC",798.2,798.2,"%D",23,0)
values and decide if the patient should be added 
"^DIC",798.2,798.2,"%D",24,0)
to the registry. Moreover, they could be used to
"^DIC",798.2,798.2,"%D",25,0)
split a very complex rule into several simpler
"^DIC",798.2,798.2,"%D",26,0)
rules.
"^DIC",798.2,798.2,"%D",27,0)
 
"^DIC",798.2,798.2,"%D",28,0)
Records of the file are uniquely identified by the
"^DIC",798.2,798.2,"%D",29,0)
rule name (the "A" primary key and the uniqueness
"^DIC",798.2,798.2,"%D",30,0)
index "B" are used for this purpose).
"^DIC",798.2,"B","ROR SELECTION RULE",798.2)

"^DIC",798.3,798.3,0)
ROR PATIENT EVENTS^798.3
"^DIC",798.3,798.3,0,"GL")
^RORDATA(798.3,
"^DIC",798.3,798.3,"%",0)
^1.005^^0
"^DIC",798.3,798.3,"%D",0)
^^13^13^3050427^
"^DIC",798.3,798.3,"%D",1,0)
The ROR PATIENT EVENTS file is used to store 
"^DIC",798.3,798.3,"%D",2,0)
references to those patients that were processed 
"^DIC",798.3,798.3,"%D",3,0)
with errors and were not added to the registry 
"^DIC",798.3,798.3,"%D",4,0)
(see the ERROR multiple).
"^DIC",798.3,798.3,"%D",5,0)
 
"^DIC",798.3,798.3,"%D",6,0)
Moreover, the data references generated by the 
"^DIC",798.3,798.3,"%D",7,0)
event protocols are stored in this file (see the 
"^DIC",798.3,798.3,"%D",8,0)
EVENT multiple). These references are used to 
"^DIC",798.3,798.3,"%D",9,0)
speed up the regular registry updates.
"^DIC",798.3,798.3,"%D",10,0)
 
"^DIC",798.3,798.3,"%D",11,0)
Records of the file have the same internal entry 
"^DIC",798.3,798.3,"%D",12,0)
numbers as the internal values of the PATIENT NAME
"^DIC",798.3,798.3,"%D",13,0)
field ('DINUM' feature).
"^DIC",798.3,"B","ROR PATIENT EVENTS",798.3)

"^DIC",798.4,798.4,0)
ROR PATIENT^798.4
"^DIC",798.4,798.4,0,"GL")
^RORDATA(798.4,
"^DIC",798.4,798.4,"%",0)
^1.005^^0
"^DIC",798.4,798.4,"%D",0)
^^34^34^3060203^
"^DIC",798.4,798.4,"%D",1,0)
The ROR PATIENT file contains patient information
"^DIC",798.4,798.4,"%D",2,0)
that is common for all local registries (mostly,
"^DIC",798.4,798.4,"%D",3,0)
demographic information).
"^DIC",798.4,798.4,"%D",4,0)
 
"^DIC",798.4,798.4,"%D",5,0)
Most of the fields in the file have the same 
"^DIC",798.4,798.4,"%D",6,0)
numbers and names as the corresponding fields in
"^DIC",798.4,798.4,"%D",7,0)
the PATIENT file.
"^DIC",798.4,798.4,"%D",8,0)
 
"^DIC",798.4,798.4,"%D",9,0)
Demographic data from this file is compared to
"^DIC",798.4,798.4,"%D",10,0)
that from the PATIENT file (#2) to determine if it
"^DIC",798.4,798.4,"%D",11,0)
has been changed since the last registry data
"^DIC",798.4,798.4,"%D",12,0)
extraction. These fields are updated with the
"^DIC",798.4,798.4,"%D",13,0)
values from the PATIENT file and the UPDATE
"^DIC",798.4,798.4,"%D",14,0)
DEMOGRAPHICS flag is set to "YES" in all active
"^DIC",798.4,798.4,"%D",15,0)
registry records of the patient.
"^DIC",798.4,798.4,"%D",16,0)
 
"^DIC",798.4,798.4,"%D",17,0)
Records in the file have the same internal entry 
"^DIC",798.4,798.4,"%D",18,0)
numbers as the patients' records in the PATIENT
"^DIC",798.4,798.4,"%D",19,0)
file. The records are uniquely identified by
"^DIC",798.4,798.4,"%D",20,0)
the internal value of the PATIENT NAME field.
"^DIC",798.4,798.4,"%D",21,0)
 
"^DIC",798.4,798.4,"%D",22,0)
A permanent screen (the ^DD(798.4,0,"SCR") node) 
"^DIC",798.4,798.4,"%D",23,0)
restricts access to the records of this file. Only
"^DIC",798.4,798.4,"%D",24,0)
users with the security key(s) for any defined
"^DIC",798.4,798.4,"%D",25,0)
registry (or those with the ROR VA IRM security
"^DIC",798.4,798.4,"%D",26,0)
key) can access records of the file.
"^DIC",798.4,798.4,"%D",27,0)
 
"^DIC",798.4,798.4,"%D",28,0)
If you want the changes in the security keys
"^DIC",798.4,798.4,"%D",29,0)
allocation to have an effect immediately, you 
"^DIC",798.4,798.4,"%D",30,0)
should rebuild the "ACL" cross-reference of the
"^DIC",798.4,798.4,"%D",31,0)
.01 field of the SECURITY KEY multiple of the ROR
"^DIC",798.4,798.4,"%D",32,0)
REGISTRY PARAMETERS file (#798.1). See the
"^DIC",798.4,798.4,"%D",33,0)
description of the cross-reference for more
"^DIC",798.4,798.4,"%D",34,0)
details.
"^DIC",798.4,"B","ROR PATIENT",798.4)

"^DIC",798.6,798.6,0)
ROR PHARMACY CODE^798.6
"^DIC",798.6,798.6,0,"GL")
^ROR(798.6,
"^DIC",798.6,798.6,"%",0)
^1.005^^0
"^DIC",798.6,798.6,"%D",0)
^^6^6^3060203^
"^DIC",798.6,798.6,"%D",1,0)
This file contains a list of pointers to the VA 
"^DIC",798.6,798.6,"%D",2,0)
Drug Class file (#50.605). Within the Pharmacy
"^DIC",798.6,798.6,"%D",3,0)
package each class is linked to a group of
"^DIC",798.6,798.6,"%D",4,0)
medications. Each class in this file has an
"^DIC",798.6,798.6,"%D",5,0)
associated registry, the "AC" cross-reference
"^DIC",798.6,798.6,"%D",6,0)
groups all entries by registry.
"^DIC",798.6,"B","ROR PHARMACY CODE",798.6)

"^DIC",798.7,798.7,0)
ROR LOG^798.7
"^DIC",798.7,798.7,0,"GL")
^RORDATA(798.7,
"^DIC",798.7,798.7,"%",0)
^1.005^^0
"^DIC",798.7,798.7,"%D",0)
^^22^22^3021223^
"^DIC",798.7,798.7,"%D",1,0)
The ROR LOG file is used for recording different
"^DIC",798.7,798.7,"%D",2,0)
kinds of events (errors, debug messages, etc.)
"^DIC",798.7,798.7,"%D",3,0)
that are generated by registry processes.
"^DIC",798.7,798.7,"%D",4,0)
 
"^DIC",798.7,798.7,"%D",5,0)
You may control event recording via parameters in
"^DIC",798.7,798.7,"%D",6,0)
the ROR REGISTRY PARAMETERS file. Look for
"^DIC",798.7,798.7,"%D",7,0)
additional information in the RORLOG and RORERR
"^DIC",798.7,798.7,"%D",8,0)
routines.
"^DIC",798.7,798.7,"%D",9,0)
 
"^DIC",798.7,798.7,"%D",10,0)
A permanent screen (the ^DD(798.7,0,"SCR") node) 
"^DIC",798.7,798.7,"%D",11,0)
restricts access to records of this file. Only
"^DIC",798.7,798.7,"%D",12,0)
users with the security key(s) for any defined 
"^DIC",798.7,798.7,"%D",13,0)
registry (or those with the ROR VA IRM security
"^DIC",798.7,798.7,"%D",14,0)
key) can access records of the file.
"^DIC",798.7,798.7,"%D",15,0)
 
"^DIC",798.7,798.7,"%D",16,0)
If you want the changes in the security keys 
"^DIC",798.7,798.7,"%D",17,0)
allocation to have an effect immediately, you
"^DIC",798.7,798.7,"%D",18,0)
should rebuild the "ACL" cross-reference of the
"^DIC",798.7,798.7,"%D",19,0)
.01 field of the SECURITY KEY multiple of the ROR
"^DIC",798.7,798.7,"%D",20,0)
REGISTRY PARAMETERS file (#798.1). See the 
"^DIC",798.7,798.7,"%D",21,0)
description of the cross-reference for more
"^DIC",798.7,798.7,"%D",22,0)
details.
"^DIC",798.7,"B","ROR LOG",798.7)

"^DIC",798.8,798.8,0)
ROR TASK^798.8
"^DIC",798.8,798.8,0,"GL")
^RORDATA(798.8,
"^DIC",798.8,798.8,"%",0)
^1.005^^0
"^DIC",798.8,798.8,"%D",0)
^^27^27^3060203^
"^DIC",798.8,798.8,"%D",1,0)
The ROR TASK file enhances the functionality of 
"^DIC",798.8,798.8,"%D",2,0)
Taskman and supports the package APIs used by the
"^DIC",798.8,798.8,"%D",3,0)
GUI to schedule and control tasks, and view
"^DIC",798.8,798.8,"%D",4,0)
and print reports.
"^DIC",798.8,798.8,"%D",5,0)
 
"^DIC",798.8,798.8,"%D",6,0)
Records in the file have the same internal entry 
"^DIC",798.8,798.8,"%D",7,0)
numbers as the corresponding tasks in Taskman. The
"^DIC",798.8,798.8,"%D",8,0)
records are uniquely identified by the internal 
"^DIC",798.8,798.8,"%D",9,0)
value of the TASK NUMBER field.
"^DIC",798.8,798.8,"%D",10,0)
 
"^DIC",798.8,798.8,"%D",11,0)
Usually, you should not edit records of this file 
"^DIC",798.8,798.8,"%D",12,0)
directly. The file is maintained by the APIs 
"^DIC",798.8,798.8,"%D",13,0)
located in the RORTSK* routines.
"^DIC",798.8,798.8,"%D",14,0)
 
"^DIC",798.8,798.8,"%D",15,0)
A permanent screen (the ^DD(798.8,0,"SCR") node) 
"^DIC",798.8,798.8,"%D",16,0)
restricts access to the records of this file. Only
"^DIC",798.8,798.8,"%D",17,0)
users with the security key(s) for any defined
"^DIC",798.8,798.8,"%D",18,0)
registry (or those with the ROR VA IRM security
"^DIC",798.8,798.8,"%D",19,0)
key) can access records of the file.
"^DIC",798.8,798.8,"%D",20,0)
     
"^DIC",798.8,798.8,"%D",21,0)
If you want the changes in the security keys 
"^DIC",798.8,798.8,"%D",22,0)
allocation to have an effect immediately, you
"^DIC",798.8,798.8,"%D",23,0)
should rebuild the "ACL" cross-reference of the
"^DIC",798.8,798.8,"%D",24,0)
.01 field of the SECURITY KEY multiple of the ROR
"^DIC",798.8,798.8,"%D",25,0)
REGISTRY PARAMETERS file (#798.1). See the
"^DIC",798.8,798.8,"%D",26,0)
description of the cross-reference for more
"^DIC",798.8,798.8,"%D",27,0)
details.
"^DIC",798.8,"B","ROR TASK",798.8)

"^DIC",798.9,798.9,0)
ROR LAB SEARCH^798.9
"^DIC",798.9,798.9,0,"GL")
^ROR(798.9,
"^DIC",798.9,798.9,"%",0)
^1.005^^0
"^DIC",798.9,798.9,"%D",0)
^^10^10^3020403^
"^DIC",798.9,798.9,"%D",1,0)
Lab search criteria are stored in this file. These
"^DIC",798.9,798.9,"%D",2,0)
criteria are referenced by the selection rules and
"^DIC",798.9,798.9,"%D",3,0)
used in the search for Lab results.
"^DIC",798.9,798.9,"%D",4,0)
 
"^DIC",798.9,798.9,"%D",5,0)
It is possible but not recommended to use the same
"^DIC",798.9,798.9,"%D",6,0)
criterion for several different registries.
"^DIC",798.9,798.9,"%D",7,0)
 
"^DIC",798.9,798.9,"%D",8,0)
Records of the file are uniquely identified by the
"^DIC",798.9,798.9,"%D",9,0)
criterion name. The "A" primary key and the "B"
"^DIC",798.9,798.9,"%D",10,0)
uniqueness index are used for this purpose.
"^DIC",798.9,"B","ROR LAB SEARCH",798.9)

"^DIC",799.1,799.1,0)
ROR LIST ITEM^799.1
"^DIC",799.1,799.1,0,"GL")
^ROR(799.1,
"^DIC",799.1,799.1,"%",0)
^1.005^^0
"^DIC",799.1,799.1,"%D",0)
^^15^15^3050427^
"^DIC",799.1,799.1,"%D",1,0)
THIS FILE MUST NOT BE MODIFIED LOCALLY! ONLY 
"^DIC",799.1,799.1,"%D",2,0)
AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN EDIT
"^DIC",799.1,799.1,"%D",3,0)
THIS FILE!
"^DIC",799.1,799.1,"%D",4,0)
 
"^DIC",799.1,799.1,"%D",5,0)
This file contains code sets used within different
"^DIC",799.1,799.1,"%D",6,0)
registries.
"^DIC",799.1,799.1,"%D",7,0)
 
"^DIC",799.1,799.1,"%D",8,0)
Records of the file are uniquely identified by the
"^DIC",799.1,799.1,"%D",9,0)
type (it associates the set of values with the 
"^DIC",799.1,799.1,"%D",10,0)
registry field), registry and item code. The "A"
"^DIC",799.1,799.1,"%D",11,0)
primary key and the "KEY" uniqueness index are
"^DIC",799.1,799.1,"%D",12,0)
used for this purpose.
"^DIC",799.1,799.1,"%D",13,0)
 
"^DIC",799.1,799.1,"%D",14,0)
DO NOT DELETE RECORDS FROM THIS FILE IF THEY HAVE 
"^DIC",799.1,799.1,"%D",15,0)
BEEN DISTRIBUTED TO THE SITES ALREADY!
"^DIC",799.1,"B","ROR LIST ITEM",799.1)

"^DIC",799.2,799.2,0)
ROR METADATA^799.2
"^DIC",799.2,799.2,0,"GL")
^ROR(799.2,
"^DIC",799.2,799.2,"%",0)
^1.005^^0
"^DIC",799.2,799.2,"%D",0)
^^33^33^3060203^
"^DIC",799.2,799.2,"%D",1,0)
THIS FILE MUST NOT BE MODIFIED LOCALLY! ONLY 
"^DIC",799.2,799.2,"%D",2,0)
AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN EDIT
"^DIC",799.2,799.2,"%D",3,0)
THIS FILE!
"^DIC",799.2,799.2,"%D",4,0)
 
"^DIC",799.2,799.2,"%D",5,0)
The ROR METADATA file contains descriptors of the
"^DIC",799.2,799.2,"%D",6,0)
files, data elements and APIs used by the registry
"^DIC",799.2,799.2,"%D",7,0)
update subsystem (search engine). These
"^DIC",799.2,799.2,"%D",8,0)
descriptors define relationships between files
"^DIC",799.2,799.2,"%D",9,0)
("file-processing tree") used by the search
"^DIC",799.2,799.2,"%D",10,0)
engine, data elements and APIs.
"^DIC",799.2,799.2,"%D",11,0)
 
"^DIC",799.2,799.2,"%D",12,0)
The expression parser uses data stored in this 
"^DIC",799.2,799.2,"%D",13,0)
file to validate expressions that implement
"^DIC",799.2,799.2,"%D",14,0)
selection rules.
"^DIC",799.2,799.2,"%D",15,0)
 
"^DIC",799.2,799.2,"%D",16,0)
Data from this file loaded and prepared by the
"^DIC",799.2,799.2,"%D",17,0)
$$METADATA^RORUPR1 function is used by the
"^DIC",799.2,799.2,"%D",18,0)
registry update process to load values of the data
"^DIC",799.2,799.2,"%D",19,0)
elements using appropriate APIs.
"^DIC",799.2,799.2,"%D",20,0)
 
"^DIC",799.2,799.2,"%D",21,0)
Developers can use this file as a source of 
"^DIC",799.2,799.2,"%D",22,0)
information required for definition of new 
"^DIC",799.2,799.2,"%D",23,0)
selection rules for new national or local
"^DIC",799.2,799.2,"%D",24,0)
registries (supported files and data elements,
"^DIC",799.2,799.2,"%D",25,0)
APIs, DBIAs, etc.).
"^DIC",799.2,799.2,"%D",26,0)
 
"^DIC",799.2,799.2,"%D",27,0)
All modifications of the registry update routines
"^DIC",799.2,799.2,"%D",28,0)
that affect the file-processing tree, APIs or
"^DIC",799.2,799.2,"%D",29,0)
supported data elements MUST be reflected in the 
"^DIC",799.2,799.2,"%D",30,0)
ROR METADATA file.
"^DIC",799.2,799.2,"%D",31,0)
 
"^DIC",799.2,799.2,"%D",32,0)
Records of this file have internal entry numbers 
"^DIC",799.2,799.2,"%D",33,0)
equal to the corresponding file numbers.
"^DIC",799.2,"B","ROR METADATA",799.2)

"^DIC",799.31,799.31,0)
ROR XML ITEM^799.31
"^DIC",799.31,799.31,0,"GL")
^ROR(799.31,
"^DIC",799.31,799.31,"%",0)
^1.005^^0
"^DIC",799.31,799.31,"%D",0)
^^7^7^3040124^
"^DIC",799.31,799.31,"%D",1,0)
THIS FILE MUST NOT BE MODIFIED LOCALLY! ONLY 
"^DIC",799.31,799.31,"%D",2,0)
AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN EDIT
"^DIC",799.31,799.31,"%D",3,0)
THIS FILE!
"^DIC",799.31,799.31,"%D",4,0)
 
"^DIC",799.31,799.31,"%D",5,0)
The ROR XML ELEMENT file contains a list of XML 
"^DIC",799.31,799.31,"%D",6,0)
tags and attributes that can be used in the 
"^DIC",799.31,799.31,"%D",7,0)
reports.
"^DIC",799.31,"B","ROR XML ITEM",799.31)

"^DIC",799.33,799.33,0)
ROR DATA AREA^799.33
"^DIC",799.33,799.33,0,"GL")
^ROR(799.33,
"^DIC",799.33,799.33,"%",0)
^1.005^^0
"^DIC",799.33,799.33,"%D",0)
^^11^11^3060131^
"^DIC",799.33,799.33,"%D",1,0)
THIS FILE MUST NOT BE MODIFIED LOCALLY! ONLY 
"^DIC",799.33,799.33,"%D",2,0)
AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN EDIT
"^DIC",799.33,799.33,"%D",3,0)
THIS FILE!
"^DIC",799.33,799.33,"%D",4,0)
 
"^DIC",799.33,799.33,"%D",5,0)
The ROR DATA AREA file stores codes and names of
"^DIC",799.33,799.33,"%D",6,0)
the data areas referenced by the DATA AREA (the
"^DIC",799.33,799.33,"%D",7,0)
ROR HISTORICAL DATA EXTRACTION file) and the EVENT
"^DIC",799.33,799.33,"%D",8,0)
(the ROR PATIENT EVENTS file) multiples.
"^DIC",799.33,799.33,"%D",9,0)
 
"^DIC",799.33,799.33,"%D",10,0)
DO NOT EDIT OR DELETE RECORDS FROM THIS FILE IF
"^DIC",799.33,799.33,"%D",11,0)
THEY HAVE BEEN DISTRIBUTED TO THE SITES ALREADY!
"^DIC",799.33,"B","ROR DATA AREA",799.33)

"^DIC",799.34,799.34,0)
ROR REPORT PARAMETERS^799.34
"^DIC",799.34,799.34,0,"GL")
^ROR(799.34,
"^DIC",799.34,799.34,"%",0)
^1.005^^0
"^DIC",799.34,799.34,"%D",0)
^^7^7^3030814^^
"^DIC",799.34,799.34,"%D",1,0)
The ROR REPORT PARAMETERS file stores the report
"^DIC",799.34,799.34,"%D",2,0)
definitions that are used by the ROR REPORT 
"^DIC",799.34,799.34,"%D",3,0)
SCHEDULE remote procedure to schedule the reports.
"^DIC",799.34,799.34,"%D",4,0)
 
"^DIC",799.34,799.34,"%D",5,0)
Records of the file are uniquely identified by the
"^DIC",799.34,799.34,"%D",6,0)
report code (the "A" primary key and the
"^DIC",799.34,799.34,"%D",7,0)
uniqueness index "KEY" are used for that purpose).
"^DIC",799.34,"B","ROR REPORT PARAMETERS",799.34)

"^DIC",799.4,799.4,0)
ROR HIV RECORD^799.4
"^DIC",799.4,799.4,0,"GL")
^RORDATA(799.4,
"^DIC",799.4,799.4,"%",0)
^1.005^^0
"^DIC",799.4,799.4,"%D",0)
^^17^17^3050504^
"^DIC",799.4,799.4,"%D",1,0)
The ROR HIV RECORD file stores the patients' data
"^DIC",799.4,799.4,"%D",2,0)
specific to the Human Immunodeficiency Virus
"^DIC",799.4,799.4,"%D",3,0)
Registry (CCR:HIV).
"^DIC",799.4,799.4,"%D",4,0)
 
"^DIC",799.4,799.4,"%D",5,0)
Records of this file have the same internal entry
"^DIC",799.4,799.4,"%D",6,0)
numbers as the corresponding records of the ROR 
"^DIC",799.4,799.4,"%D",7,0)
REGISTRY RECORD file (#798).
"^DIC",799.4,799.4,"%D",8,0)
 
"^DIC",799.4,799.4,"%D",9,0)
When an CCR:HIV record is deleted from the ROR 
"^DIC",799.4,799.4,"%D",10,0)
REGISTRY RECORD file, the corresponding record of 
"^DIC",799.4,799.4,"%D",11,0)
this file is deleted automatically.
"^DIC",799.4,799.4,"%D",12,0)
 
"^DIC",799.4,799.4,"%D",13,0)
A permanent screen (the ^DD(799.4,0,"SCR") node) 
"^DIC",799.4,799.4,"%D",14,0)
restricts access to this file. Only the users who
"^DIC",799.4,799.4,"%D",15,0)
have the CCR:HIV security key(s) and those with
"^DIC",799.4,799.4,"%D",16,0)
the ROR VA IRM key can access the records of the
"^DIC",799.4,799.4,"%D",17,0)
file.
"^DIC",799.4,"B","ROR HIV RECORD",799.4)

"^DIC",799.49,799.49,0)
ROR AIDS INDICATOR DISEASE^799.49
"^DIC",799.49,799.49,0,"GL")
^ROR(799.49,
"^DIC",799.49,799.49,"%",0)
^1.005^^0
"^DIC",799.49,799.49,"%D",0)
^^10^10^3060203^
"^DIC",799.49,799.49,"%D",1,0)
THIS FILE MUST NOT BE MODIFIED LOCALLY! ONLY 
"^DIC",799.49,799.49,"%D",2,0)
AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN EDIT
"^DIC",799.49,799.49,"%D",3,0)
THIS FILE!
"^DIC",799.49,799.49,"%D",4,0)
 
"^DIC",799.49,799.49,"%D",5,0)
The ROR AIDS INDICATOR DISEASE file contains 
"^DIC",799.49,799.49,"%D",6,0)
definitions of the AIDS indicator diseases 
"^DIC",799.49,799.49,"%D",7,0)
referenced by part VIII of the HIV CDC form.
"^DIC",799.49,799.49,"%D",8,0)
 
"^DIC",799.49,799.49,"%D",9,0)
Also see the AIDS INDICATOR DISEASE multiple (10)
"^DIC",799.49,799.49,"%D",10,0)
of the ROR ICR STUDY file (#799.4).
"^DIC",799.49,"B","ROR AIDS INDICATOR DISEASE",799.49)

"^DIC",799.51,799.51,0)
ROR GENERIC DRUG^799.51
"^DIC",799.51,799.51,0,"GL")
^ROR(799.51,
"^DIC",799.51,799.51,"%",0)
^1.005^^0
"^DIC",799.51,799.51,"%D",0)
^^5^5^3060203^
"^DIC",799.51,799.51,"%D",1,0)
This file contains a list of registry specific
"^DIC",799.51,799.51,"%D",2,0)
generic medications. For example, the ARV 
"^DIC",799.51,799.51,"%D",3,0)
(anti-retroviral) medications associated with the
"^DIC",799.51,799.51,"%D",4,0)
Human Immunodeficiency Virus (HIV) registry are
"^DIC",799.51,799.51,"%D",5,0)
stored here.
"^DIC",799.51,"B","ROR GENERIC DRUG",799.51)

"^DIC",799.53,799.53,0)
ROR LOCAL FIELD^799.53
"^DIC",799.53,799.53,0,"GL")
^ROR(799.53,
"^DIC",799.53,799.53,"%",0)
^1.005^^0
"^DIC",799.53,799.53,"%D",0)
^^7^7^3050513^^
"^DIC",799.53,799.53,"%D",1,0)
The ROR LOCAL FIELD file stores definitions of
"^DIC",799.53,799.53,"%D",2,0)
local registry-specific fields created at the 
"^DIC",799.53,799.53,"%D",3,0)
site.
"^DIC",799.53,799.53,"%D",4,0)
 
"^DIC",799.53,799.53,"%D",5,0)
Uniqueness of the field names for a particular
"^DIC",799.53,799.53,"%D",6,0)
registry is enforced by the primary key "A" and 
"^DIC",799.53,799.53,"%D",7,0)
uniqueness index "KEY".
"^DIC",799.53,"B","ROR LOCAL FIELD",799.53)

"^DIC",799.6,799.6,0)
ROR HISTORICAL DATA EXTRACTION^799.6
"^DIC",799.6,799.6,0,"GL")
^RORDATA(799.6,
"^DIC",799.6,799.6,"%",0)
^1.005^^0
"^DIC",799.6,799.6,"%D",0)
^^9^9^3051031^
"^DIC",799.6,799.6,"%D",1,0)
Records of this file store parameters of the 
"^DIC",799.6,799.6,"%D",2,0)
historical data extractions (backpulls) performed
"^DIC",799.6,799.6,"%D",3,0)
on the registries and reflect status of these data
"^DIC",799.6,799.6,"%D",4,0)
extractions.
"^DIC",799.6,799.6,"%D",5,0)
 
"^DIC",799.6,799.6,"%D",6,0)
Records of the file are uniquely identified by the
"^DIC",799.6,799.6,"%D",7,0)
historical data extraction name (the "A" primary
"^DIC",799.6,799.6,"%D",8,0)
key and the uniqueness index "B" are used for that
"^DIC",799.6,799.6,"%D",9,0)
purpose).
"^DIC",799.6,"B","ROR HISTORICAL DATA EXTRACTION",799.6)

**END**
**END**
