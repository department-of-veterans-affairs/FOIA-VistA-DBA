Released RMPR*3*77 SEQ #65
Extracted from mail message
**KIDS**:RMPR*3.0*77^

**INSTALL NAME**
RMPR*3.0*77
"BLD",15989,0)
RMPR*3.0*77^PROSTHETICS^0^3030915^y
"BLD",15989,1,0)
^^1^1^3030715^^^^
"BLD",15989,1,1,0)
Nois Fixes.
"BLD",15989,4,0)
^9.64PA^660^1
"BLD",15989,4,660,0)
660
"BLD",15989,4,660,2,0)
^9.641^660^1
"BLD",15989,4,660,2,660,0)
RECORD OF PROS APPLIANCE/REPAIR  (File-top level)
"BLD",15989,4,660,2,660,1,0)
^9.6411^8.61^1
"BLD",15989,4,660,2,660,1,8.61,0)
CONSULT REQUEST SERVICE
"BLD",15989,4,660,222)
y^y^p^^^^n^^n
"BLD",15989,4,660,224)

"BLD",15989,4,"APDD",660,660)

"BLD",15989,4,"APDD",660,660,8.61)

"BLD",15989,4,"B",660,660)

"BLD",15989,"ABNS",0)
^9.66A^^
"BLD",15989,"ABPKG")
n^n
"BLD",15989,"INIT")
PAT77^RMPRPS36
"BLD",15989,"KRN",0)
^9.67PA^8989.52^19
"BLD",15989,"KRN",.4,0)
.4
"BLD",15989,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",15989,"KRN",.4,"NM",1,0)
RMPR VIEW REQUEST    FILE #668^668^0
"BLD",15989,"KRN",.4,"NM","B","RMPR VIEW REQUEST    FILE #668",1)

"BLD",15989,"KRN",.401,0)
.401
"BLD",15989,"KRN",.402,0)
.402
"BLD",15989,"KRN",.403,0)
.403
"BLD",15989,"KRN",.5,0)
.5
"BLD",15989,"KRN",.84,0)
.84
"BLD",15989,"KRN",3.6,0)
3.6
"BLD",15989,"KRN",3.8,0)
3.8
"BLD",15989,"KRN",9.2,0)
9.2
"BLD",15989,"KRN",9.8,0)
9.8
"BLD",15989,"KRN",9.8,"NM",0)
^9.68A^38^34
"BLD",15989,"KRN",9.8,"NM",1,0)
RMPOBILU^^0^B28967763
"BLD",15989,"KRN",9.8,"NM",2,0)
RMPR29D^^0^B9231694
"BLD",15989,"KRN",9.8,"NM",3,0)
RMPR5N1^^0^B30610033
"BLD",15989,"KRN",9.8,"NM",4,0)
RMPR5N2^^0^B20251212
"BLD",15989,"KRN",9.8,"NM",5,0)
RMPR5N3^^0^B19380215
"BLD",15989,"KRN",9.8,"NM",7,0)
RMPRN6^^0^B83188489
"BLD",15989,"KRN",9.8,"NM",9,0)
RMPROPN^^0^B16465818
"BLD",15989,"KRN",9.8,"NM",10,0)
RMPROPN1^^0^B10218467
"BLD",15989,"KRN",9.8,"NM",11,0)
RMPRP55^^0^B31001811
"BLD",15989,"KRN",9.8,"NM",12,0)
RMPRPAT7^^0^B1666656
"BLD",15989,"KRN",9.8,"NM",13,0)
RMPRPCEB^^0^B17871246
"BLD",15989,"KRN",9.8,"NM",14,0)
RMPRPRT^^0^B32318513
"BLD",15989,"KRN",9.8,"NM",15,0)
RMPRSE1^^0^B21351335
"BLD",15989,"KRN",9.8,"NM",16,0)
RMPRSE2^^0^B22196712
"BLD",15989,"KRN",9.8,"NM",17,0)
RMPRSE21^^0^B24703368
"BLD",15989,"KRN",9.8,"NM",18,0)
RMPRSEA^^0^B26133076
"BLD",15989,"KRN",9.8,"NM",19,0)
RMPRSP^^0^B11838623
"BLD",15989,"KRN",9.8,"NM",21,0)
RMPRSP2^^0^B29178919
"BLD",15989,"KRN",9.8,"NM",22,0)
RMPRSP3^^0^B10253367
"BLD",15989,"KRN",9.8,"NM",23,0)
RMPRSP7^^0^B21324847
"BLD",15989,"KRN",9.8,"NM",24,0)
RMPRPCE1^^0^B18373171
"BLD",15989,"KRN",9.8,"NM",25,0)
RMPOPED^^0^B86444066
"BLD",15989,"KRN",9.8,"NM",26,0)
RMPORNQ^^0^B5946232
"BLD",15989,"KRN",9.8,"NM",27,0)
RMPOLZA^^0^B9483689
"BLD",15989,"KRN",9.8,"NM",28,0)
RMPRN73^^0^B20536174
"BLD",15989,"KRN",9.8,"NM",30,0)
RMPREO23^^0^B40224649
"BLD",15989,"KRN",9.8,"NM",31,0)
RMPRSP1^^0^B15219488
"BLD",15989,"KRN",9.8,"NM",32,0)
RMPRFO^^0^B11025831
"BLD",15989,"KRN",9.8,"NM",33,0)
RMPRFO1^^0^B16577236
"BLD",15989,"KRN",9.8,"NM",34,0)
RMPRFO2^^0^B21081133
"BLD",15989,"KRN",9.8,"NM",35,0)
RMPRPS35^^0^B76926612
"BLD",15989,"KRN",9.8,"NM",36,0)
RMPRPS36^^0^B84864728
"BLD",15989,"KRN",9.8,"NM",37,0)
RMPR9DO^^0^B82327785
"BLD",15989,"KRN",9.8,"NM",38,0)
RMPR9LNP^^0^B6402289
"BLD",15989,"KRN",9.8,"NM","B","RMPOBILU",1)

"BLD",15989,"KRN",9.8,"NM","B","RMPOLZA",27)

"BLD",15989,"KRN",9.8,"NM","B","RMPOPED",25)

"BLD",15989,"KRN",9.8,"NM","B","RMPORNQ",26)

"BLD",15989,"KRN",9.8,"NM","B","RMPR29D",2)

"BLD",15989,"KRN",9.8,"NM","B","RMPR5N1",3)

"BLD",15989,"KRN",9.8,"NM","B","RMPR5N2",4)

"BLD",15989,"KRN",9.8,"NM","B","RMPR5N3",5)

"BLD",15989,"KRN",9.8,"NM","B","RMPR9DO",37)

"BLD",15989,"KRN",9.8,"NM","B","RMPR9LNP",38)

"BLD",15989,"KRN",9.8,"NM","B","RMPREO23",30)

"BLD",15989,"KRN",9.8,"NM","B","RMPRFO",32)

"BLD",15989,"KRN",9.8,"NM","B","RMPRFO1",33)

"BLD",15989,"KRN",9.8,"NM","B","RMPRFO2",34)

"BLD",15989,"KRN",9.8,"NM","B","RMPRN6",7)

"BLD",15989,"KRN",9.8,"NM","B","RMPRN73",28)

"BLD",15989,"KRN",9.8,"NM","B","RMPROPN",9)

"BLD",15989,"KRN",9.8,"NM","B","RMPROPN1",10)

"BLD",15989,"KRN",9.8,"NM","B","RMPRP55",11)

"BLD",15989,"KRN",9.8,"NM","B","RMPRPAT7",12)

"BLD",15989,"KRN",9.8,"NM","B","RMPRPCE1",24)

"BLD",15989,"KRN",9.8,"NM","B","RMPRPCEB",13)

"BLD",15989,"KRN",9.8,"NM","B","RMPRPRT",14)

"BLD",15989,"KRN",9.8,"NM","B","RMPRPS35",35)

"BLD",15989,"KRN",9.8,"NM","B","RMPRPS36",36)

"BLD",15989,"KRN",9.8,"NM","B","RMPRSE1",15)

"BLD",15989,"KRN",9.8,"NM","B","RMPRSE2",16)

"BLD",15989,"KRN",9.8,"NM","B","RMPRSE21",17)

"BLD",15989,"KRN",9.8,"NM","B","RMPRSEA",18)

"BLD",15989,"KRN",9.8,"NM","B","RMPRSP",19)

"BLD",15989,"KRN",9.8,"NM","B","RMPRSP1",31)

"BLD",15989,"KRN",9.8,"NM","B","RMPRSP2",21)

"BLD",15989,"KRN",9.8,"NM","B","RMPRSP3",22)

"BLD",15989,"KRN",9.8,"NM","B","RMPRSP7",23)

"BLD",15989,"KRN",19,0)
19
"BLD",15989,"KRN",19.1,0)
19.1
"BLD",15989,"KRN",101,0)
101
"BLD",15989,"KRN",409.61,0)
409.61
"BLD",15989,"KRN",771,0)
771
"BLD",15989,"KRN",870,0)
870
"BLD",15989,"KRN",8989.51,0)
8989.51
"BLD",15989,"KRN",8989.52,0)
8989.52
"BLD",15989,"KRN",8994,0)
8994
"BLD",15989,"KRN","B",.4,.4)

"BLD",15989,"KRN","B",.401,.401)

"BLD",15989,"KRN","B",.402,.402)

"BLD",15989,"KRN","B",.403,.403)

"BLD",15989,"KRN","B",.5,.5)

"BLD",15989,"KRN","B",.84,.84)

"BLD",15989,"KRN","B",3.6,3.6)

"BLD",15989,"KRN","B",3.8,3.8)

"BLD",15989,"KRN","B",9.2,9.2)

"BLD",15989,"KRN","B",9.8,9.8)

"BLD",15989,"KRN","B",19,19)

"BLD",15989,"KRN","B",19.1,19.1)

"BLD",15989,"KRN","B",101,101)

"BLD",15989,"KRN","B",409.61,409.61)

"BLD",15989,"KRN","B",771,771)

"BLD",15989,"KRN","B",870,870)

"BLD",15989,"KRN","B",8989.51,8989.51)

"BLD",15989,"KRN","B",8989.52,8989.52)

"BLD",15989,"KRN","B",8994,8994)

"BLD",15989,"QUES",0)
^9.62^^
"BLD",15989,"REQB",0)
^9.611^19^19
"BLD",15989,"REQB",1,0)
RMPR*3.0*33^1
"BLD",15989,"REQB",2,0)
RMPR*3.0*35^1
"BLD",15989,"REQB",3,0)
RMPR*3.0*37^1
"BLD",15989,"REQB",4,0)
RMPR*3.0*41^1
"BLD",15989,"REQB",5,0)
RMPR*3.0*44^1
"BLD",15989,"REQB",6,0)
RMPR*3.0*46^1
"BLD",15989,"REQB",7,0)
RMPR*3.0*50^1
"BLD",15989,"REQB",8,0)
RMPR*3.0*52^1
"BLD",15989,"REQB",9,0)
RMPR*3.0*55^1
"BLD",15989,"REQB",10,0)
RMPR*3.0*57^1
"BLD",15989,"REQB",11,0)
RMPR*3.0*62^1
"BLD",15989,"REQB",12,0)
RMPR*3.0*69^1
"BLD",15989,"REQB",13,0)
RMPR*3.0*70^1
"BLD",15989,"REQB",14,0)
RMPR*3.0*76^1
"BLD",15989,"REQB",15,0)
RMPR*3.0*59^1
"BLD",15989,"REQB",16,0)
RMPR*3.0*71^1
"BLD",15989,"REQB",17,0)
RMPR*3.0*13^1
"BLD",15989,"REQB",18,0)
RMPR*3.0*29^1
"BLD",15989,"REQB",19,0)
RMPR*3.0*72^1
"BLD",15989,"REQB","B","RMPR*3.0*13",17)

"BLD",15989,"REQB","B","RMPR*3.0*29",18)

"BLD",15989,"REQB","B","RMPR*3.0*33",1)

"BLD",15989,"REQB","B","RMPR*3.0*35",2)

"BLD",15989,"REQB","B","RMPR*3.0*37",3)

"BLD",15989,"REQB","B","RMPR*3.0*41",4)

"BLD",15989,"REQB","B","RMPR*3.0*44",5)

"BLD",15989,"REQB","B","RMPR*3.0*46",6)

"BLD",15989,"REQB","B","RMPR*3.0*50",7)

"BLD",15989,"REQB","B","RMPR*3.0*52",8)

"BLD",15989,"REQB","B","RMPR*3.0*55",9)

"BLD",15989,"REQB","B","RMPR*3.0*57",10)

"BLD",15989,"REQB","B","RMPR*3.0*59",15)

"BLD",15989,"REQB","B","RMPR*3.0*62",11)

"BLD",15989,"REQB","B","RMPR*3.0*69",12)

"BLD",15989,"REQB","B","RMPR*3.0*70",13)

"BLD",15989,"REQB","B","RMPR*3.0*71",16)

"BLD",15989,"REQB","B","RMPR*3.0*72",19)

"BLD",15989,"REQB","B","RMPR*3.0*76",14)

"FIA",660)
RECORD OF PROS APPLIANCE/REPAIR
"FIA",660,0)
^RMPR(660,
"FIA",660,0,0)
660IOD
"FIA",660,0,1)
y^y^p^^^^n^^n
"FIA",660,0,10)

"FIA",660,0,11)

"FIA",660,0,"RLRO")

"FIA",660,0,"VR")
3.0^RMPR
"FIA",660,660)
1
"FIA",660,660,8.61)

"INIT")
PAT77^RMPRPS36
"KRN",.4,1779,-1)
0^1
"KRN",.4,1779,0)
RMPR VIEW REQUEST^3021205.0936^@^668^^@^3030603
"KRN",.4,1779,"F",1)
"Order Date: ";X;C1~S DIP(1)=$S($D(^RMPR(668,D0,0)):^(0),1:"") S X=$P(DIP(1),U,1),X=$P(X,".",1) S Y=X D DT K DIP;X;d;L18;Z;"DATE(SUSPENSE DATE)"~
"KRN",.4,1779,"F",2)
S DIP(1)=$S($D(^RMPR(668,D0,0)):^(0),1:"") S X="Patient: "_$P($G(^DPT(+$P(DIP(1),U,2),0)),U) W X K DIP;C26;X;Z;""Patient: "_VETERAN"~
"KRN",.4,1779,"F",3)
S DIP(1)=$S($D(^RMPR(668,D0,0)):^(0),1:"") S X="Requestor: "_$P($G(^VA(200,+$P(DIP(1),U,11),0)),U) W X K DIP;C53;X;Z;""Requestor: "_REQUESTOR"~
"KRN",.4,1779,"F",4)
"Suspended By: ";C1~8;X~
"KRN",.4,1779,"F",5)
S X="-",DIP(1)=$G(X),DIP(2)=$G(X),X=$S($D(IOM):IOM,1:80) S X=X,X1=DIP(1) S %=X,X="" Q:X1=""  S $P(X,X1,%\$L(X1)+1)=X1,X=$E(X,1,%) W X K DIP;C1;X;Z;"DUP("-",IOM)"~
"KRN",.4,1779,"F",6)
"Initial Action Date: ";C1~
"KRN",.4,1779,"F",7)
S DIP(1)=$S($D(^RMPR(668,D0,0)):^(0),1:"") S X=$P(DIP(1),U,9),X=$P(X,".",1) S Y=X D DT K DIP;X;d;L18;Z;"DATE(INITIAL ACTION DATE)"~
"KRN",.4,1779,"F",8)
"Complete Date: ";C35~5;X~
"KRN",.4,1779,"F",9)
S X="=",DIP(1)=$G(X),DIP(2)=$G(X),X=$S($D(IOM):IOM,1:80) S X=X,X1=DIP(1) S %=X,X="" Q:X1=""  S $P(X,X1,%\$L(X1)+1)=X1,X=$E(X,1,%) W X K DIP;C1;X;Z;"DUP("=",IOM)"~
"KRN",.4,1779,"F",10)
"Description of Item/Services Requested";C1~4,.01;C1;""~
"KRN",.4,1779,"F",11)
S X="-",DIP(1)=$G(X),DIP(2)=$G(X),X=$S($D(IOM):IOM,1:80) S X=X,X1=DIP(1) S %=X,X="" Q:X1=""  S $P(X,X1,%\$L(X1)+1)=X1,X=$E(X,1,%) W X K DIP;C1;X;Z;"DUP("-",IOM)"~
"KRN",.4,1779,"F",12)
"Initial Action Note: ";C1~7,.01;C1;X~
"KRN",.4,1779,"F",13)
S X="-",DIP(1)=$G(X),DIP(2)=$G(X),X=$S($D(IOM):IOM,1:80) S X=X,X1=DIP(1) S %=X,X="" Q:X1=""  S $P(X,X1,%\$L(X1)+1)=X1,X=$E(X,1,%) W X K DIP;C1;X;Z;"DUP("-",IOM)"~
"KRN",.4,1779,"F",14)
"Complete Note: ";C1~12,.01;C1;X~
"KRN",.4,1779,"H")
View
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
77^3030915^448
"PKG",101,22,1,"PAH",1,1,0)
^^1^1^3030915
"PKG",101,22,1,"PAH",1,1,1,0)
Nois Fixes.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
34
"RTN","RMPOBILU")
0^1^B28967763
"RTN","RMPOBILU",1,0)
RMPOBILU ;EDS/MDB,RVD - HOME OXYGEN BILLING TRANSACTIONS ;8/7/98  10:58
"RTN","RMPOBILU",2,0)
 ;;3.0;PROSTHETICS;**29,43,44,77**;Feb 09, 1996
"RTN","RMPOBILU",3,0)
 ;RVD 3/18/03 patch #77 - don't allow future billing month creation
"RTN","RMPOBILU",4,0)
 ;
"RTN","RMPOBILU",5,0)
 Q
"RTN","RMPOBILU",6,0)
VDRSCRN ; SCREEN
"RTN","RMPOBILU",7,0)
 Q
"RTN","RMPOBILU",8,0)
 I '$D(RMPOXITE) D  Q
"RTN","RMPOBILU",9,0)
 . W !,$C(7)_"RMPOXITE NOT DEFINED!"
"RTN","RMPOBILU",10,0)
 . S DIC("S")="I 0"
"RTN","RMPOBILU",11,0)
 S DIC("S")="I $D(^RMPR(669.9,RMPOXITE,""RMPOVDR"",Y,0))"
"RTN","RMPOBILU",12,0)
 Q
"RTN","RMPOBILU",13,0)
XFRM1 ; INPUT XFORM FOR BILLING MONTH, FILE 665.72
"RTN","RMPOBILU",14,0)
 S %DT(0)=-DT
"RTN","RMPOBILU",15,0)
 S %DT="E" D ^%DT S X=Y I Y<0 K X Q
"RTN","RMPOBILU",16,0)
 S (DINUM,X)=$E(X,1,5)_"00"
"RTN","RMPOBILU",17,0)
 Q
"RTN","RMPOBILU",18,0)
2319 ; -- Display 2319
"RTN","RMPOBILU",19,0)
 N RMPRNAM,RMPRDOB,RMPRSSN,RMPRDFN
"RTN","RMPOBILU",20,0)
 S (DFN,RMPRDFN)=RMPODFN D DEM^VADPT
"RTN","RMPOBILU",21,0)
 S RMPRNAM=VADM(1)
"RTN","RMPOBILU",22,0)
 S RMPRDOB=+VADM(3)
"RTN","RMPOBILU",23,0)
 S RMPRSSN=+VADM(2)
"RTN","RMPOBILU",24,0)
 S $P(RMPR("L"),"-",80)=""
"RTN","RMPOBILU",25,0)
 S RMPRBAC1=1
"RTN","RMPOBILU",26,0)
 D ^RMPRPAT
"RTN","RMPOBILU",27,0)
 K RMPRBAC1
"RTN","RMPOBILU",28,0)
 Q
"RTN","RMPOBILU",29,0)
ACCEPT ; ACCEPT TRX
"RTN","RMPOBILU",30,0)
 D SAME S DR="2///Y" D ^DIE
"RTN","RMPOBILU",31,0)
 Q
"RTN","RMPOBILU",32,0)
UNACCEPT ; UNACCEPT TRX
"RTN","RMPOBILU",33,0)
 D SAME S DR="2///N" D ^DIE
"RTN","RMPOBILU",34,0)
 Q
"RTN","RMPOBILU",35,0)
SAME ;
"RTN","RMPOBILU",36,0)
 K DIE,DA,DR
"RTN","RMPOBILU",37,0)
 S DA=RMPODFN,DA(1)=RMPOVDR,DA(2)=RMPORVDT,DA(3)=RMPOXITE
"RTN","RMPOBILU",38,0)
 S DIE="^RMPO(665.72,"_DA(3)_",1,"_DA(2)_",1,"_DA(1)_",""V"","
"RTN","RMPOBILU",39,0)
 Q
"RTN","RMPOBILU",40,0)
FCP(FCP) ;
"RTN","RMPOBILU",41,0)
 ;
"RTN","RMPOBILU",42,0)
 ; PASS:
"RTN","RMPOBILU",43,0)
 ; -- AS PARAMETER 
"RTN","RMPOBILU",44,0)
 ;  FCP = FREE-TEXT FUND CONTROL POINT NAME
"RTN","RMPOBILU",45,0)
 ; -- AS VARIABLES
"RTN","RMPOBILU",46,0)
 ;  RMPOXITE = SITE #
"RTN","RMPOBILU",47,0)
 ;  RMPODATE = BILLING MONTH
"RTN","RMPOBILU",48,0)
 ;  RMPOVDR = VENDOR IEN (IF TYPE = 'PURCHASE CARD')
"RTN","RMPOBILU",49,0)
 ; 
"RTN","RMPOBILU",50,0)
 ; RETURNS:
"RTN","RMPOBILU",51,0)
 ; TYPE ^ 442 IEN ^ REF # ^ AMOUNT ^ IEN
"RTN","RMPOBILU",52,0)
 ;   TYPE = PAYMENT TYPE (1 = 1358, 'P' = PURCHASE CARD)
"RTN","RMPOBILU",53,0)
 ;   442 IEN = POINTER TO FILE 442, USED FOR POSTING
"RTN","RMPOBILU",54,0)
 ;   REF # = C# FOR 1358, PCO# FOR PURCHASE CARD
"RTN","RMPOBILU",55,0)
 ;   AMOUNT = TOTAL AMOUNT POSTED SO FAR (PURCHASE CARD ONLY)
"RTN","RMPOBILU",56,0)
 ;   IEN = IEN OF 'FCP' RECORD IN FILE 665.72, USED FOR UPDATING TOTALS
"RTN","RMPOBILU",57,0)
 ;
"RTN","RMPOBILU",58,0)
 N FOUND,DATA,RVDT,IEN,TMP,SITE,FN,TYPE
"RTN","RMPOBILU",59,0)
 S QUIT=0,DATA="",FN=665.72
"RTN","RMPOBILU",60,0)
 I '$D(RMPOXITE) W !,"SITE NOT DEFINED!" Q -1
"RTN","RMPOBILU",61,0)
 I '$D(^RMPO(FN,RMPOXITE)) W !,"SITE NOT FOUND!" Q -1
"RTN","RMPOBILU",62,0)
 S SITE=RMPOXITE
"RTN","RMPOBILU",63,0)
 I '$D(RMPODATE) W !,"BILLING MONTH NOT DEFINED!" Q -1
"RTN","RMPOBILU",64,0)
 S RVDT=RMPODATE
"RTN","RMPOBILU",65,0)
 I '$D(^RMPO(FN,SITE,1,RVDT)) D  Q -1
"RTN","RMPOBILU",66,0)
 . W !,"BILLING MONTH NOT DEFINED!"
"RTN","RMPOBILU",67,0)
 ;
"RTN","RMPOBILU",68,0)
 D FCP4 Q:FOUND DATA
"RTN","RMPOBILU",69,0)
 D FCP1 Q:(Y="")!$$QUIT -1
"RTN","RMPOBILU",70,0)
 S TYPE=Y
"RTN","RMPOBILU",71,0)
 D FCP2:TYPE=1,FCP3:TYPE="P" Q:($G(Y)<0)!QUIT -1
"RTN","RMPOBILU",72,0)
 Q DATA
"RTN","RMPOBILU",73,0)
 Q
"RTN","RMPOBILU",74,0)
FCP4 ; LOOK FOR EXISTING PAYMENT TYPE
"RTN","RMPOBILU",75,0)
 S FOUND=0,DATA=""
"RTN","RMPOBILU",76,0)
 Q:'$D(^RMPO(FN,SITE,1,RVDT,2,"B",FCP))
"RTN","RMPOBILU",77,0)
 K DIC S DA(1)=RVDT,DA(2)=SITE
"RTN","RMPOBILU",78,0)
 S DIC("A")="Select Fund Control Point: "
"RTN","RMPOBILU",79,0)
 S DIC="^RMPO(FN,"_DA(2)_",1,"_DA(1)_",2,",DIC(0)="AMQEZ"
"RTN","RMPOBILU",80,0)
 S DIC("S")="S Z=^(0) I $P(Z,U)=FCP,$S($P(Z,U,2):1,($P(Z,U,2)=""P"")&"
"RTN","RMPOBILU",81,0)
 S DIC("S")=DIC("S")_"($P(Z,U,5)=DUZ)&($P(Z,U,6)=RMPOVDR):1,1:0),"
"RTN","RMPOBILU",82,0)
 S DIC("S")=DIC("S")_"$P(Z,U,8)="""""
"RTN","RMPOBILU",83,0)
 S DIC("W")="W ?35,$P(^(0),U,4)"
"RTN","RMPOBILU",84,0)
 S DIC("W")=DIC("W")_" I $P(^(0),U,2) W ?55,"
"RTN","RMPOBILU",85,0)
 S DIC("W")=DIC("W")_"$J($$BAL^RMPOPST1($P(^(0),U,3)),10,2)"
"RTN","RMPOBILU",86,0)
 D ^DIC
"RTN","RMPOBILU",87,0)
 Q:(Y<0)!$$QUIT
"RTN","RMPOBILU",88,0)
 K RMPOZ M RMPOZ=Y
"RTN","RMPOBILU",89,0)
 K DIR S DIR(0)="Y"
"RTN","RMPOBILU",90,0)
 S RMZ=^RMPO(FN,SITE,1,RVDT,2,+Y,0)
"RTN","RMPOBILU",91,0)
 S RMZ=$P(RMZ,U,4)
"RTN","RMPOBILU",92,0)
 S DIR("A")="Are you sure you want "_RMZ
"RTN","RMPOBILU",93,0)
 S DIR("B")="NO" D ^DIR G:(Y=0) FCP4 Q:(Y'=1)!$$QUIT
"RTN","RMPOBILU",94,0)
 K Y M Y=RMPOZ
"RTN","RMPOBILU",95,0)
 I $P(Y(0),U,2) S DATA=$P(Y(0),U,2,4)_U_U_(+Y),FOUND=1 Q
"RTN","RMPOBILU",96,0)
 S DATA=$P(Y(0),U,2)_U_$P(Y(0),U,3)_U
"RTN","RMPOBILU",97,0)
 S DATA=DATA_$P(Y(0),U,4)_U_$P(Y(0),U,7)_U_(+Y),FOUND=1
"RTN","RMPOBILU",98,0)
 Q
"RTN","RMPOBILU",99,0)
FCP2 ; 1358
"RTN","RMPOBILU",100,0)
 S PRC("SITE")=RMPRS,PRC("CP")=FCP
"RTN","RMPOBILU",101,0)
 S PRCS("A")="Select Obligation Number: "
"RTN","RMPOBILU",102,0)
 D EN1A^PRCS58 Q:(Y<0)!$$QUIT
"RTN","RMPOBILU",103,0)
 K RMPOZ M RMPOZ=Y
"RTN","RMPOBILU",104,0)
 K DIR S DIR(0)="Y",DIR("B")="NO"
"RTN","RMPOBILU",105,0)
 S DIR("A")="Are you sure" D ^DIR Q:(Y<1)!$$QUIT
"RTN","RMPOBILU",106,0)
 K Y M Y=RMPOZ D FCPSET
"RTN","RMPOBILU",107,0)
 K PRC,PRCS
"RTN","RMPOBILU",108,0)
 Q
"RTN","RMPOBILU",109,0)
FCPSET ; SET ENTRY IN RMPO
"RTN","RMPOBILU",110,0)
 S DATA=TYPE_U_$P(Y,U,1,2)_U_U  ; SETUP RETURN VALUE
"RTN","RMPOBILU",111,0)
 ;Check if selected IFCAP order exist in file 665.72
"RTN","RMPOBILU",112,0)
 S Y=$$FCPCHK(.DATA) I Y Q
"RTN","RMPOBILU",113,0)
 K DIC,DIE,DA,DR,DD,DO
"RTN","RMPOBILU",114,0)
 S DA(2)=SITE,DA(1)=RVDT
"RTN","RMPOBILU",115,0)
 S DIC="^RMPO(665.72,"_DA(2)_",1,"_DA(1)_",2,"
"RTN","RMPOBILU",116,0)
 S DIC("P")=$P(^DD(665.723,2,0),U,2)
"RTN","RMPOBILU",117,0)
 S DIC(0)="L",X=FCP D FILE^DICN I Y<0 S DATA=-1 Q
"RTN","RMPOBILU",118,0)
 S DIE=DIC,DA=+Y,DATA=DATA_DA
"RTN","RMPOBILU",119,0)
 S DR="1////"_TYPE
"RTN","RMPOBILU",120,0)
 S DR=DR_";2////"_$P(DATA,U,2)
"RTN","RMPOBILU",121,0)
 S DR=DR_";3///"_$P(DATA,U,3)
"RTN","RMPOBILU",122,0)
 S DR=DR_";4////"_DUZ
"RTN","RMPOBILU",123,0)
 S:TYPE="P" DR=DR_";5////"_RMPOVDR
"RTN","RMPOBILU",124,0)
 D ^DIE
"RTN","RMPOBILU",125,0)
 S Z1=$P(DATA,U,2)
"RTN","RMPOBILU",126,0)
 S Z2=$P(DATA,U,3)
"RTN","RMPOBILU",127,0)
 S $P(^RMPO(665.72,DA(2),1,DA(1),2,DA,0),U,3,4)=Z1_U_Z2
"RTN","RMPOBILU",128,0)
 Q
"RTN","RMPOBILU",129,0)
FCPCHK(DATA) ;CHECK IF FCP ALREADY EXIST IN FILE 665.72
"RTN","RMPOBILU",130,0)
 N IEN,FDT,FPT,FOUND
"RTN","RMPOBILU",131,0)
 S (IEN,FOUND)=0
"RTN","RMPOBILU",132,0)
 F  S IEN=$O(^RMPO(FN,SITE,1,RVDT,2,"B",FCP,IEN)) Q:IEN=""  D  Q:FOUND
"RTN","RMPOBILU",133,0)
 . S FDT=^RMPO(FN,SITE,1,RVDT,2,IEN,0),FPT=$P(FDT,U,2)
"RTN","RMPOBILU",134,0)
 . I $P(FDT,U,8)>0 Q  ; closed flag
"RTN","RMPOBILU",135,0)
 . I FPT=TYPE,$P(DATA,U,2)=$P(FDT,U,3),$P(DATA,U,3)=$P(FDT,U,4) D
"RTN","RMPOBILU",136,0)
 . . I TYPE=1 S DATA=DATA_IEN,FOUND=1 Q
"RTN","RMPOBILU",137,0)
 . . I $P(FDT,U,5)=DUZ,$P(FDT,U,6)=RMPOVDR D
"RTN","RMPOBILU",138,0)
 . . . S $P(DATA,U,4)=$P(FDT,U,7),DATA=DATA_IEN,FOUND=1
"RTN","RMPOBILU",139,0)
 Q FOUND
"RTN","RMPOBILU",140,0)
FCP3 ; PURCHASE CARD
"RTN","RMPOBILU",141,0)
 N PRCA
"RTN","RMPOBILU",142,0)
 I '$D(^PRC(440.5,"H",DUZ)) D  S Y=-1 Q
"RTN","RMPOBILU",143,0)
 . W !!,"You are not an authorized Purchase Card User, CONTACT FISCAL!"
"RTN","RMPOBILU",144,0)
 S PRCA=RMPRS_U_RMPOVDR
"RTN","RMPOBILU",145,0)
 D ADD^PRCH7D(.PRCA) S Y=PRCA Q:(Y<0)!(Y="^")!$$QUIT
"RTN","RMPOBILU",146,0)
 K RMPOZ M RMPOZ=Y
"RTN","RMPOBILU",147,0)
 K DIR S DIR(0)="Y",DIR("B")="NO",DIR("A")="Are you sure"
"RTN","RMPOBILU",148,0)
 D ^DIR Q:(Y<1)!$$QUIT
"RTN","RMPOBILU",149,0)
 K Y M Y=RMPOZ D FCPSET
"RTN","RMPOBILU",150,0)
 Q
"RTN","RMPOBILU",151,0)
FCP1 ; PAYMENT TYPE
"RTN","RMPOBILU",152,0)
 K DIR,DA
"RTN","RMPOBILU",153,0)
 S DIR(0)="665.7232,1" D ^DIR
"RTN","RMPOBILU",154,0)
 Q
"RTN","RMPOBILU",155,0)
GETFCP(DFCP) ; Return FCP from file 420 (External value only)
"RTN","RMPOBILU",156,0)
 ; Pass - DFCP = Default FCP [optional]
"RTN","RMPOBILU",157,0)
 ;
"RTN","RMPOBILU",158,0)
 N DIC,DA
"RTN","RMPOBILU",159,0)
 S:$D(DFCP) DIC("B")=DFCP
"RTN","RMPOBILU",160,0)
 S DA(1)=RMPOXITE,DIC("A")="Select FUND CONTROL POINT: "
"RTN","RMPOBILU",161,0)
 S DIC="^RMPR(669.9,"_DA(1)_",""RMPOFCP"",",DIC(0)="AEQMZ" D ^DIC
"RTN","RMPOBILU",162,0)
 I Y<0!$$QUIT Q Y
"RTN","RMPOBILU",163,0)
 Q Y_U_Y(0,0)
"RTN","RMPOBILU",164,0)
QUIT() S QUIT=$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q QUIT
"RTN","RMPOBILU",165,0)
EQUIT() S QUIT=$D(DTOUT)!$D(Y) Q QUIT
"RTN","RMPOBILU",166,0)
LJ(S,W,C) ; Left justify S in a field W wide padding with char F
"RTN","RMPOBILU",167,0)
 ;
"RTN","RMPOBILU",168,0)
 S C=$G(C," ")   ; Default pad char is space
"RTN","RMPOBILU",169,0)
 S $P(S,C,W-$L(S)+$L(S,C))=""
"RTN","RMPOBILU",170,0)
 Q $E(S,1,W)
"RTN","RMPOBILU",171,0)
 Q
"RTN","RMPOBILU",172,0)
ENC(X,X1,X2) ;Encrypt
"RTN","RMPOBILU",173,0)
 ;Variable X  = string to encrypt
"RTN","RMPOBILU",174,0)
 ;         X1 = DUZ
"RTN","RMPOBILU",175,0)
 ;         X2 = FCP IEN of file 665.72
"RTN","RMPOBILU",176,0)
 D EN^XUSHSHP
"RTN","RMPOBILU",177,0)
 Q X
"RTN","RMPOBILU",178,0)
DEC(X,X1,X2) ;Decrypt
"RTN","RMPOBILU",179,0)
 ;Variable X  = encrypted string
"RTN","RMPOBILU",180,0)
 ;         X1 = DUZ
"RTN","RMPOBILU",181,0)
 ;         X2 = FCP IEN of file 665.72
"RTN","RMPOBILU",182,0)
 D DE^XUSHSHP
"RTN","RMPOBILU",183,0)
 Q X
"RTN","RMPOLZA")
0^27^B9483689
"RTN","RMPOLZA",1,0)
RMPOLZA ;EDS/PAK - HOME OXYGEN LETTERS ;5/27/03  10:34
"RTN","RMPOLZA",2,0)
 ;;3.0;PROSTHETICS;**29,77**;Feb 09, 1996
"RTN","RMPOLZA",3,0)
 ;
"RTN","RMPOLZA",4,0)
 ;RVD patch #77 - insure that dangling 'AC' x-ref will not cause
"RTN","RMPOLZA",5,0)
 ;                the undefined error.
"RTN","RMPOLZA",6,0)
 ; 
"RTN","RMPOLZA",7,0)
QUIT() ;
"RTN","RMPOLZA",8,0)
 ; Input: None
"RTN","RMPOLZA",9,0)
 ; Output:
"RTN","RMPOLZA",10,0)
 ;   Quit flag            -  1: time out on read 
"RTN","RMPOLZA",11,0)
 ;                           0: no time out on read
"RTN","RMPOLZA",12,0)
 ;
"RTN","RMPOLZA",13,0)
 Q ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT))
"RTN","RMPOLZA",14,0)
 ;
"RTN","RMPOLZA",15,0)
SITE(RMPRSITE)  ;find the site if the site is not multidivisional
"RTN","RMPOLZA",16,0)
 ;
"RTN","RMPOLZA",17,0)
 ; Input:
"RTN","RMPOLZA",18,0)
 ;   Prosthetics Site     - valid site ID held in file 669.9
"RTN","RMPOLZA",19,0)
 ; Output:
"RTN","RMPOLZA",20,0)
 ;   Site flag            -  0: no H.O. site selected
"RTN","RMPOLZA",21,0)
 ;                           1: H.O. site selected
"RTN","RMPOLZA",22,0)
 ;
"RTN","RMPOLZA",23,0)
 ; Non interactive call to pull site parameters if site supplied
"RTN","RMPOLZA",24,0)
 I RMPRSITE'="" D ^RMPRSIT M RMPO=RMPR S RMPOSITE=RMPO("STA") Q 1
"RTN","RMPOLZA",25,0)
 ;
"RTN","RMPOLZA",26,0)
 ; Interactive call requiring operator input
"RTN","RMPOLZA",27,0)
 D HOSITE^RMPOUTL0 Q:$G(QUIT) 0 ; output RMPO("STA") - station number
"RTN","RMPOLZA",28,0)
 W @IOF K ^TMP($J)
"RTN","RMPOLZA",29,0)
 I '$G(RMPOREC) W !!,*7,"You must choose a Home Oxygen Site.",!! Q 0
"RTN","RMPOLZA",30,0)
 S RMPOXITE=RMPOREC
"RTN","RMPOLZA",31,0)
 Q 1
"RTN","RMPOLZA",32,0)
 ;
"RTN","RMPOLZA",33,0)
EXTRCT ; Extract patient demographics
"RTN","RMPOLZA",34,0)
 ;
"RTN","RMPOLZA",35,0)
 ; Input:
"RTN","RMPOLZA",36,0)
 ;   RMPODFN              -  Patient IEN to NEW PERSON file
"RTN","RMPOLZA",37,0)
 ;   ADT                  -  Patient Rx activation date
"RTN","RMPOLZA",38,0)
 ; Output:
"RTN","RMPOLZA",39,0)
 ;   ^TMP($J,RMPOXITE,"RMPODEMO",RMPODFN)  -  LastName,FirstName^H.O. ActivateDate^
"RTN","RMPOLZA",40,0)
 ;   Rx Expiry Date^PrimaryItemName^Prescription^PrescriptionDate^TodaysDate^                                   
"RTN","RMPOLZA",41,0)
 ;   ^Sex^AddressLine1^AddressLine2^AddressLine3^City^State^Zip
"RTN","RMPOLZA",42,0)
 ;
"RTN","RMPOLZA",43,0)
 ; quit if already generated demographic details for a patient
"RTN","RMPOLZA",44,0)
 Q:$D(^TMP($J,RMPOXITE,"RMPODEMO",RMPODFN))
"RTN","RMPOLZA",45,0)
 ;
"RTN","RMPOLZA",46,0)
 N INAME,DFN,VAPA,INFO
"RTN","RMPOLZA",47,0)
 ;
"RTN","RMPOLZA",48,0)
 S INAME="",DFN=RMPODFN
"RTN","RMPOLZA",49,0)
 K VADM D DEM^VADPT,ADD^VADPT
"RTN","RMPOLZA",50,0)
 ; 
"RTN","RMPOLZA",51,0)
 ; if patient has an active prescription get date entered & expiry date else set dates = NULL
"RTN","RMPOLZA",52,0)
 I RMPORX'="",$D(^RMPR(665,RMPODFN,"RMPOB",RMPORX,0)) S RMPOEXP=$P(^RMPR(665,RMPODFN,"RMPOB",RMPORX,0),U,3),RMPORXDT=$P(^(0),U)
"RTN","RMPOLZA",53,0)
 E  S (RMPOEXP,RMPORXDT)=""
"RTN","RMPOLZA",54,0)
 ;
"RTN","RMPOLZA",55,0)
 ; get primary item
"RTN","RMPOLZA",56,0)
 S INAME="",RMPOITEM=$O(^RMPR(665,"AC","Y",RMPODFN,0))
"RTN","RMPOLZA",57,0)
 I RMPOITEM'="" D
"RTN","RMPOLZA",58,0)
 . Q:'$D(^RMPR(665,RMPODFN,"RMPOC",RMPOITEM,0))
"RTN","RMPOLZA",59,0)
 . S RMPOITEM=$P(^RMPR(665,RMPODFN,"RMPOC",RMPOITEM,0),U),RMPOITEM=$P(^RMPR(661,RMPOITEM,0),U)
"RTN","RMPOLZA",60,0)
 . S INAME=$P(^PRC(441,RMPOITEM,0),U,2)
"RTN","RMPOLZA",61,0)
 ;
"RTN","RMPOLZA",62,0)
 ;set the ^TMP($J,RMPOXITE,"RMPODEMO" global with patient demographics
"RTN","RMPOLZA",63,0)
 S INFO=VADM(1)_U_$P(VADM(2),U,2)_U_ADT_U_RMPOEXP_U_INAME
"RTN","RMPOLZA",64,0)
 S INFO=INFO_U_RMPORX_U_RMPORXDT_U_DT_U_$P(VADM(5),U)_U_VAPA(1)_U_VAPA(2)_U_VAPA(3)_U_VAPA(4)_U_$P(VAPA(5),U,2)_U_VAPA(6)
"RTN","RMPOLZA",65,0)
 S ^TMP($J,RMPOXITE,"RMPODEMO",RMPODFN)=INFO Q:'$D(RMPOLCD)!RMPOLCD=""
"RTN","RMPOLZA",66,0)
 Q
"RTN","RMPOLZA",67,0)
 ;
"RTN","RMPOLZA",68,0)
LOCK() ; lock virtual list record
"RTN","RMPOLZA",69,0)
 ;
"RTN","RMPOLZA",70,0)
 ; Input:        
"RTN","RMPOLZA",71,0)
 ;   JOB         -  1: job, 2: interactive
"RTN","RMPOLZA",72,0)
 ;
"RTN","RMPOLZA",73,0)
 ; Output:
"RTN","RMPOLZA",74,0)
 ;   None
"RTN","RMPOLZA",75,0)
 ;
"RTN","RMPOLZA",76,0)
 L +^TMP("RMPO",$J,RMPOXITE,"LETTERPRINT"):0
"RTN","RMPOLZA",77,0)
 I '$T W:'JOB !,"Cannot continue as list edit or printing is in progress" H 2 Q 0
"RTN","RMPOLZA",78,0)
 Q 1
"RTN","RMPOLZA",79,0)
 ;
"RTN","RMPOLZA",80,0)
UPDLTR(DA,VAL)  ; Update 'Letter to be sent' in Prosthetics Patient File
"RTN","RMPOLZA",81,0)
 ;
"RTN","RMPOLZA",82,0)
 ; I/P :
"RTN","RMPOLZA",83,0)
 ;     VAL - value to be inserted into field
"RTN","RMPOLZA",84,0)
 ;
"RTN","RMPOLZA",85,0)
 N DIE
"RTN","RMPOLZA",86,0)
 ;
"RTN","RMPOLZA",87,0)
 S DR="19.13///"_VAL,DIE="^RMPR(665," D ^DIE
"RTN","RMPOLZA",88,0)
 Q
"RTN","RMPOLZA",89,0)
 ;
"RTN","RMPOLZA",90,0)
SELN(TYP,TXT,MAX)     ;
"RTN","RMPOLZA",91,0)
 ;
"RTN","RMPOLZA",92,0)
 ; Input:
"RTN","RMPOLZA",93,0)
 ;   TYP(e)               -  section type: "L"ist of # 
"RTN","RMPOLZA",94,0)
 ;                                          single "N"umber
"RTN","RMPOLZA",95,0)
 ;   TeXT                 -  prompt text
"RTN","RMPOLZA",96,0)
 ;   MAX                  -  maximum valid number
"RTN","RMPOLZA",97,0)
 ;
"RTN","RMPOLZA",98,0)
 ; Output:
"RTN","RMPOLZA",99,0)
 ;   Y                    -  selected number or range of numbers 
"RTN","RMPOLZA",100,0)
 ;
"RTN","RMPOLZA",101,0)
 N DIR,Y
"RTN","RMPOLZA",102,0)
 ;
"RTN","RMPOLZA",103,0)
 D FULL^VALM1
"RTN","RMPOLZA",104,0)
 S DIR("A")=TXT,DIR(0)=TYP_"^1:"_MAX_":0"
"RTN","RMPOLZA",105,0)
 D ^DIR
"RTN","RMPOLZA",106,0)
 Q:$$QUIT^RMPOLZA 0
"RTN","RMPOLZA",107,0)
 I Y="" S VALMBCK="R",Y=0
"RTN","RMPOLZA",108,0)
 Q Y
"RTN","RMPOPED")
0^25^B86444066
"RTN","RMPOPED",1,0)
RMPOPED ;EDS/MDB,DDW,RVD - HOME OXYGEN MISC FILE EDITS ;7/24/98
"RTN","RMPOPED",2,0)
 ;;3.0;PROSTHETICS;**29,44,41,52,77**;Feb 09, 1996
"RTN","RMPOPED",3,0)
 ;
"RTN","RMPOPED",4,0)
 ; HNC - patch 52
"RTN","RMPOPED",5,0)
 ;                 modified SITECHK sub
"RTN","RMPOPED",6,0)
 ;                 X will be undefined from GETS^DIQ if field is null
"RTN","RMPOPED",7,0)
 ;                 added $G.
"RTN","RMPOPED",8,0)
 ;RVD - patch #77  use Fileman to set items that are not Primary item
"RTN","RMPOPED",9,0)
 ;                 to 'N' in order to set correctly the 'AC' cross-ref.
"RTN","RMPOPED",10,0)
 Q
"RTN","RMPOPED",11,0)
UNLOCK I $D(RMPODFN) L -^RMPR(665,RMPODFN)
"RTN","RMPOPED",12,0)
 Q
"RTN","RMPOPED",13,0)
EXIT K DIC,DIE,DIR,DIK,X,Y,Z,DR,DA,DD,DO,D0,DTOUT,DIROUT,DUOUT,DIRUT,QUIT,DFN
"RTN","RMPOPED",14,0)
 K ITEM,ITEMS,IEN,IENS,ITMACT,ITM,C,S,W,PI,VDR,ZST
"RTN","RMPOPED",15,0)
 D UNLOCK
"RTN","RMPOPED",16,0)
 Q
"RTN","RMPOPED",17,0)
 ;
"RTN","RMPOPED",18,0)
KEY ;user must have the RMPRSUPERVISOR key in order to add a new patient.
"RTN","RMPOPED",19,0)
 ;option name is EDIT HOME OXYGEN PATIENT
"RTN","RMPOPED",20,0)
 N KEY
"RTN","RMPOPED",21,0)
 S KEY=$O(^DIC(19.1,"B","RMPRSUPERVISOR",0))
"RTN","RMPOPED",22,0)
 I '$D(^VA(200,DUZ,51,KEY)) D  Q
"RTN","RMPOPED",23,0)
 . W !!,"You do not hold the RMPSUPERVISOR key !!"
"RTN","RMPOPED",24,0)
 G PAT
"RTN","RMPOPED",25,0)
 ;
"RTN","RMPOPED",26,0)
SITE ; Editing of Home Oxygen site parameter file.
"RTN","RMPOPED",27,0)
 K DIC,DIE,DA,DR,DD,RMPOXITE
"RTN","RMPOPED",28,0)
 S DIC="^RMPR(669.9,",DIC(0)="QEAMLZ",DIC("A")="Select SITE: "
"RTN","RMPOPED",29,0)
 D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",30,0)
 K DIC("A")
"RTN","RMPOPED",31,0)
 S (DA,RMPOXITE)=+Y
"RTN","RMPOPED",32,0)
 ; Lock it...
"RTN","RMPOPED",33,0)
 L +^RMPR(669.9,RMPOXITE):2
"RTN","RMPOPED",34,0)
 I '$T D  G SITE
"RTN","RMPOPED",35,0)
 . W ?10,$C(7)_Y(0,0)_" -- record in use. Try again later."
"RTN","RMPOPED",36,0)
 ; Edit it
"RTN","RMPOPED",37,0)
 S DIE=DIC,DR="60;61;62;65" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",38,0)
 ; Edit FCP
"RTN","RMPOPED",39,0)
 K DIC,DA,DD,DR,DIE
"RTN","RMPOPED",40,0)
 ;
"RTN","RMPOPED",41,0)
 ; Done.  Unlock
"RTN","RMPOPED",42,0)
 L -^RMPR(669.9,RMPOXITE)
"RTN","RMPOPED",43,0)
 G SITE
"RTN","RMPOPED",44,0)
 ;
"RTN","RMPOPED",45,0)
FCPHLP ; Executable help for FCP multiple in 669.9
"RTN","RMPOPED",46,0)
 ;
"RTN","RMPOPED",47,0)
 Q
"RTN","RMPOPED",48,0)
FCPIX ; Input transform for FCP multiple in 669.9
"RTN","RMPOPED",49,0)
 ;
"RTN","RMPOPED",50,0)
 Q:'$D(X)
"RTN","RMPOPED",51,0)
 I $L(X)>30!($L(X)<3) K X Q
"RTN","RMPOPED",52,0)
 S ZST=$P(^RMPR(669.9,D0,4),U,1)
"RTN","RMPOPED",53,0)
 S RMPOX=X
"RTN","RMPOPED",54,0)
 D FIND^DIC(420.01,","_ZST_",",".01;","M",X,1,,,,"X")
"RTN","RMPOPED",55,0)
 S X=$S($D(X("DILIST","ID",1,.01)):X("DILIST","ID",1,.01),1:RMPOX)
"RTN","RMPOPED",56,0)
 K X("DILIST"),RMPOX
"RTN","RMPOPED",57,0)
 I $G(ZST),('$D(^PRC(420,+ZST,1,"B",X))) W !,"Control Point is not a valid IFCAP FCP.." K X
"RTN","RMPOPED",58,0)
 Q
"RTN","RMPOPED",59,0)
ACT ;activate/inactivate a home oxygen patient
"RTN","RMPOPED",60,0)
 ;Set up site variables.
"RTN","RMPOPED",61,0)
 D HOSITE^RMPOUTL0 I QUIT D EXIT Q
"RTN","RMPOPED",62,0)
 W @IOF
"RTN","RMPOPED",63,0)
 ;
"RTN","RMPOPED",64,0)
ACT1 ;Toggle ACTIVATE/INACTIVATE functions.
"RTN","RMPOPED",65,0)
 N NAME K DIC,DA
"RTN","RMPOPED",66,0)
 S DIC="^RMPR(665,",DIC(0)="QEAMZ" D ^DIC I Y<0!$$QUIT D EXIT Q
"RTN","RMPOPED",67,0)
 S DIE=DIC,DA=+Y,NAME=Y(0,0)
"RTN","RMPOPED",68,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",69,0)
 I '$T D  G ACT1
"RTN","RMPOPED",70,0)
 . W ?10,$C(7)_Y(0,0)_" -- record in use. Try later."
"RTN","RMPOPED",71,0)
 ;If the patient has never been activated, quit.
"RTN","RMPOPED",72,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,2)="" D  G ACT1
"RTN","RMPOPED",73,0)
 . W !!,$C(7)_NAME_" has not been added as a Home Oxygen patient."
"RTN","RMPOPED",74,0)
 . W !,"Please add using the ""Add/Edit Home Oxygen Patient"" option."
"RTN","RMPOPED",75,0)
 ;If the patient is active, perform inactivation actions.
"RTN","RMPOPED",76,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,3)="" D INACTVT^RMPOPED G ACT1
"RTN","RMPOPED",77,0)
 ;If the patient is inactive, perform activation actions.
"RTN","RMPOPED",78,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,3)'="" D ACTVT^RMPOPED G ACT1
"RTN","RMPOPED",79,0)
 Q
"RTN","RMPOPED",80,0)
INACTVT ; Inactivate the patient if user wants to.
"RTN","RMPOPED",81,0)
 ; Confirm if the user wants to proceed.
"RTN","RMPOPED",82,0)
 K DIR S DIR(0)="YO",DIR("B")="NO"
"RTN","RMPOPED",83,0)
 S DIR("A")="Are you sure you want to inactivate "_NAME_" ?" D ^DIR
"RTN","RMPOPED",84,0)
 Q:(Y<1)!$$QUIT
"RTN","RMPOPED",85,0)
 S DR="19.5//TODAY;19.6;19.7////"_DUZ,DIE("NO^")="BACK"
"RTN","RMPOPED",86,0)
 D ^DIE
"RTN","RMPOPED",87,0)
 Q
"RTN","RMPOPED",88,0)
 ;
"RTN","RMPOPED",89,0)
ACTVT ;Activate the patient if the user wants to.
"RTN","RMPOPED",90,0)
 K DIR S DIR(0)="YO",DIR("B")="NO"
"RTN","RMPOPED",91,0)
 S DIR("A")="Are you sure you want to reactivate "_NAME_" ?" D ^DIR
"RTN","RMPOPED",92,0)
 Q:(Y<1)!$$QUIT
"RTN","RMPOPED",93,0)
 S DR="19.2//TODAY;19.5///@;19.6///@;19.7///@"
"RTN","RMPOPED",94,0)
 S DIE("NO^")="BACK"
"RTN","RMPOPED",95,0)
 D ^DIE
"RTN","RMPOPED",96,0)
 Q
"RTN","RMPOPED",97,0)
PAT ;Add/Edit Home Oxygen Patient
"RTN","RMPOPED",98,0)
 S QUIT=0
"RTN","RMPOPED",99,0)
 D HOSITE^RMPOUTL0
"RTN","RMPOPED",100,0)
 I '$D(RMPOXITE)!QUIT D EXIT Q
"RTN","RMPOPED",101,0)
LOOP ;
"RTN","RMPOPED",102,0)
 S QUIT=0
"RTN","RMPOPED",103,0)
 D LOOKUP I QUIT!'$D(RMPODFN) D EXIT Q
"RTN","RMPOPED",104,0)
 D EDBLK I QUIT D EXIT Q
"RTN","RMPOPED",105,0)
 D UNLOCK G LOOP
"RTN","RMPOPED",106,0)
EDBLK ;
"RTN","RMPOPED",107,0)
 D SITECHK Q:QUIT
"RTN","RMPOPED",108,0)
 D DEMOG Q:QUIT
"RTN","RMPOPED",109,0)
 D RX Q:QUIT
"RTN","RMPOPED",110,0)
 D ITEM
"RTN","RMPOPED",111,0)
 Q
"RTN","RMPOPED",112,0)
 ;called by ^RMPOBIL1, providing RMPOPATN as the X variable
"RTN","RMPOPED",113,0)
EDIT ;From Billing...
"RTN","RMPOPED",114,0)
 I '$D(RMPODFN) S RMPODFN=$TR($G(RMPOPATN),"`")
"RTN","RMPOPED",115,0)
 Q:'$D(^RMPR(665,+RMPODFN,0))
"RTN","RMPOPED",116,0)
 W !,"EDITING "_$P(^DPT(RMPODFN,0),U)_"...",!
"RTN","RMPOPED",117,0)
 S QUIT=0,DA=RMPODFN
"RTN","RMPOPED",118,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",119,0)
 I '$T W !!?10,*7," << Record in use. Try later. >>" Q
"RTN","RMPOPED",120,0)
 D EDBLK,EXIT
"RTN","RMPOPED",121,0)
 Q
"RTN","RMPOPED",122,0)
LOOKUP ;First look-up the patient
"RTN","RMPOPED",123,0)
 K DIC,DIE,DA,DR,RMPODFN
"RTN","RMPOPED",124,0)
 W !!! S DIC="^RMPR(665,",DIC(0)="LQEAMZ"
"RTN","RMPOPED",125,0)
 D ^DIC Q:(Y<0)!$$QUIT
"RTN","RMPOPED",126,0)
CONT S (RMPODFN,DA)=+Y
"RTN","RMPOPED",127,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",128,0)
 I '$T W !!?10,*7," << Record in use. Try later. >>" G LOOKUP
"RTN","RMPOPED",129,0)
 Q
"RTN","RMPOPED",130,0)
 ;
"RTN","RMPOPED",131,0)
QUIT() S QUIT=$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q QUIT
"RTN","RMPOPED",132,0)
EQUIT() S QUIT=$D(DTOUT)!$D(Y) Q QUIT
"RTN","RMPOPED",133,0)
LJ(S,W,C) ; LEFT JUSTIFY S IN A FIELD W WIDE PADDING WITH CHAR F
"RTN","RMPOPED",134,0)
 ;
"RTN","RMPOPED",135,0)
 S C=$G(C," ")   ;DEFAULT PAD CHAR IS SPACE
"RTN","RMPOPED",136,0)
 S $P(S,C,W-$L(S)+$L(S,C))=""
"RTN","RMPOPED",137,0)
 Q S
"RTN","RMPOPED",138,0)
 ;
"RTN","RMPOPED",139,0)
SITECHK ;If user chooses patient from site different from billing site
"RTN","RMPOPED",140,0)
 ;
"RTN","RMPOPED",141,0)
 S Y=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U,7)
"RTN","RMPOPED",142,0)
 Q:Y=RMPOXITE    ;Site is the same.. 
"RTN","RMPOPED",143,0)
 I Y="" D SET Q   ;Site not defined, stuff RMPOXITE...
"RTN","RMPOPED",144,0)
 ; Site is different...
"RTN","RMPOPED",145,0)
 S IENS=RMPODFN_","
"RTN","RMPOPED",146,0)
 D GETS^DIQ(665,IENS,19.12,"E","X")
"RTN","RMPOPED",147,0)
 W !!,"Patient's Home Oxygen Contract Location (HOCL) is "
"RTN","RMPOPED",148,0)
 W $G(X(665,IENS,19.12,"E"))
"RTN","RMPOPED",149,0)
 W !,"You are working on billing for HOCL "_RMPO("NAME"),!
"RTN","RMPOPED",150,0)
 K DIR S DIR(0)="Y",DIR("B")="NO"
"RTN","RMPOPED",151,0)
 S DIR("A")="Should I change this patient's HOCL to "_RMPO("NAME")
"RTN","RMPOPED",152,0)
 D ^DIR Q:$$QUIT!(Y=0)
"RTN","RMPOPED",153,0)
 D SET
"RTN","RMPOPED",154,0)
 Q
"RTN","RMPOPED",155,0)
SET ;
"RTN","RMPOPED",156,0)
 K DIE,DR,DA
"RTN","RMPOPED",157,0)
 S DA=RMPODFN
"RTN","RMPOPED",158,0)
 ;W "HERE,RMPOXITE=",RMPOXITE
"RTN","RMPOPED",159,0)
 S DIE="^RMPR(665,",DR="19.12////"_RMPOXITE D ^DIE
"RTN","RMPOPED",160,0)
 Q
"RTN","RMPOPED",161,0)
 ;
"RTN","RMPOPED",162,0)
DEMOG ;First edit the patient's basic fields
"RTN","RMPOPED",163,0)
 ;
"RTN","RMPOPED",164,0)
 K DIE,DR,DA
"RTN","RMPOPED",165,0)
 S DA=RMPODFN
"RTN","RMPOPED",166,0)
 S DIE="^RMPR(665,",DR="19.1" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",167,0)
 S RMPOELIG=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U)
"RTN","RMPOPED",168,0)
 K DR S DR="19.11"_$S(RMPOELIG="D":"",1:"///@")_";19.12"
"RTN","RMPOPED",169,0)
 D ^DIE Q:$$EQUIT
"RTN","RMPOPED",170,0)
 K DR S Y=DT X ^DD("DD") S DR="19.2//"_Y D ^DIE Q:$$QUIT
"RTN","RMPOPED",171,0)
 Q
"RTN","RMPOPED",172,0)
 ;
"RTN","RMPOPED",173,0)
RX ;Edit the Rx Data
"RTN","RMPOPED",174,0)
 ;
"RTN","RMPOPED",175,0)
 K DIC,DIE,DA,DR
"RTN","RMPOPED",176,0)
 S DIC="^RMPR(665,"_RMPODFN_",""RMPOB"",",DIC(0)="AEQLZ"
"RTN","RMPOPED",177,0)
 S DA(1)=RMPODFN,DIC("P")="665.193D"
"RTN","RMPOPED",178,0)
 I $D(^DISV(DUZ,DIC)) S Y=^(DIC) I $D(@(DIC_(+Y)_",0)")) D
"RTN","RMPOPED",179,0)
 . S DIC("B")=$P(^(0),U,1)
"RTN","RMPOPED",180,0)
 D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",181,0)
 S DIE=DIC,DA=+Y,DR=".01;2//^D EXPIRE^RMPOBIL4;3" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",182,0)
 Q
"RTN","RMPOPED",183,0)
 ;
"RTN","RMPOPED",184,0)
ITEM ;Add/Edit Items
"RTN","RMPOPED",185,0)
 ;
"RTN","RMPOPED",186,0)
 ; Display items
"RTN","RMPOPED",187,0)
 D ITEMD
"RTN","RMPOPED",188,0)
 ; If no items on file, then only allow ADD PRIMARY ITEM
"RTN","RMPOPED",189,0)
 I '$D(IEN) D ITEMP Q:QUIT!(ITEM="")  G ITEM
"RTN","RMPOPED",190,0)
 ; ask for ACTION, quit if <return>, timeout, etc
"RTN","RMPOPED",191,0)
 S ITMACT=$$ITEMO Q:$$QUIT!(ITMACT="")
"RTN","RMPOPED",192,0)
 ; if they entered 'A', do ADD ITEM, then edit it
"RTN","RMPOPED",193,0)
 I ITMACT="A" D ITEMA Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEM
"RTN","RMPOPED",194,0)
 ; if they entered 'D', select an item, then delete it
"RTN","RMPOPED",195,0)
 I ITMACT="D" D ITEMS Q:QUIT!(ITEM="")  D ITEMK G ITEM
"RTN","RMPOPED",196,0)
 ; if they entered 'E', select an item, then edit it
"RTN","RMPOPED",197,0)
 I ITMACT="E" D ITEMS Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEM
"RTN","RMPOPED",198,0)
 G ITEM
"RTN","RMPOPED",199,0)
 Q
"RTN","RMPOPED",200,0)
ITEMP ; Add Primary Item
"RTN","RMPOPED",201,0)
 W !!,$C(7)_"No items found, please enter PRIMARY ITEM",!
"RTN","RMPOPED",202,0)
 D ITEMA Q:QUIT!(ITEM="")
"RTN","RMPOPED",203,0)
 S PI="///Y" D ITEME K PI
"RTN","RMPOPED",204,0)
 Q
"RTN","RMPOPED",205,0)
ITEMA ; Add Items
"RTN","RMPOPED",206,0)
 S ITEM=""
"RTN","RMPOPED",207,0)
 K DIC S DIC="^RMPR(661,",DIC(0)="AEQMZ" D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",208,0)
 K DD,DO,DA,DIC
"RTN","RMPOPED",209,0)
 S DIC="^RMPR(665,"_RMPODFN_",""RMPOC"",",DIC(0)="L"
"RTN","RMPOPED",210,0)
 S DIC("P")=$P(^DD(665,19.4,0),U,2),DA(1)=RMPODFN,X=+Y
"RTN","RMPOPED",211,0)
 D FILE^DICN I Y>0 S IEN=$G(IEN)+1,IEN(IEN)=+Y,ITEM=IEN
"RTN","RMPOPED",212,0)
 Q
"RTN","RMPOPED",213,0)
ITEMS ; Select Item
"RTN","RMPOPED",214,0)
 ; Return ITEM = index into both ITEMS and IEN arrays
"RTN","RMPOPED",215,0)
 I IEN=1 S ITEM=1 W "  ",$E(ITEMS(1),1,33) Q
"RTN","RMPOPED",216,0)
 K DIR
"RTN","RMPOPED",217,0)
 S ITEM=""
"RTN","RMPOPED",218,0)
 S DIR(0)="NO^1:"_IEN,DIR("A")="Select an ITEM"
"RTN","RMPOPED",219,0)
 S DIR("?")="Select an item from the list"
"RTN","RMPOPED",220,0)
 M DIR("?")=ITEMS
"RTN","RMPOPED",221,0)
 D ^DIR Q:Y'>0!$$QUIT
"RTN","RMPOPED",222,0)
 S ITEM=+Y W "  ",$E(ITEMS(ITEM),1,33)
"RTN","RMPOPED",223,0)
 Q
"RTN","RMPOPED",224,0)
ITEME ; Edit an Item
"RTN","RMPOPED",225,0)
 N FCP,DFCP,RMCPTHCP,RMCPRENT K DIE,DA,DR,RMCPT
"RTN","RMPOPED",226,0)
 S DA(1)=RMPODFN,DA=IEN(ITEM),DIE="^RMPR(665,"_DA(1)_",""RMPOC"","
"RTN","RMPOPED",227,0)
 D ITEMEP Q:QUIT
"RTN","RMPOPED",228,0)
 S DR=".01R;6R" D ^DIE Q:$$EQUIT!('$D(DA))
"RTN","RMPOPED",229,0)
 S RMCPTHCP=$P($G(^RMPR(665,RMPODFN,"RMPOC",DA,0)),U,7)
"RTN","RMPOPED",230,0)
 S RMCPT=$P($G(^RMPR(661.1,RMCPTHCP,4)),U,1) S DR=""
"RTN","RMPOPED",231,0)
 S RMCPRENT=$P($G(^RMPR(661.1,RMCPTHCP,5)),U,1)
"RTN","RMPOPED",232,0)
 I RMCPT["RR",(RMCPRENT=1) S DR="11;"
"RTN","RMPOPED",233,0)
 I RMCPT["QH" S DR=DR_"12;"
"RTN","RMPOPED",234,0)
 S DR=DR_"1R;2R;3R;4;7:9" K RMCPRENT,RMCPTHCP
"RTN","RMPOPED",235,0)
 D ^DIE I $D(DA),$D(RMCPT),(RMCPT'["RR") S $P(^RMPR(665,DA(1),"RMPOC",DA,0),U,12)=""
"RTN","RMPOPED",236,0)
 I $D(DA),$D(RMCPT),(RMCPT'["QH") S $P(^RMPR(665,DA(1),"RMPOC",DA,0),U,13)=""
"RTN","RMPOPED",237,0)
 Q:$$EQUIT
"RTN","RMPOPED",238,0)
 ; Kludge to "point" to file 420
"RTN","RMPOPED",239,0)
 S DFCP=$P(^RMPR(665,RMPODFN,"RMPOC",IEN(ITEM),0),U,6)
"RTN","RMPOPED",240,0)
 F  D  Q:(FCP>0)!QUIT
"RTN","RMPOPED",241,0)
 . S FCP=$$GETFCP^RMPOBILU(DFCP) Q:QUIT
"RTN","RMPOPED",242,0)
 . I FCP<0 W $C(7)_"REQUIRED FIELD!"
"RTN","RMPOPED",243,0)
 I FCP>0 S DR="5///"_$P(FCP,U,2) D ^DIE Q:$$EQUIT
"RTN","RMPOPED",244,0)
 ; End Kludge
"RTN","RMPOPED",245,0)
 ;S DR="7:9" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",246,0)
 Q
"RTN","RMPOPED",247,0)
ITEMEP ; Primary Item edit...
"RTN","RMPOPED",248,0)
 N PIEN,PFLG,RMDA,RMNO
"RTN","RMPOPED",249,0)
 S RMDA=DA,DR="10" D ^DIE Q:$$QUIT
"RTN","RMPOPED",250,0)
 I $P(^RMPR(665,RMPODFN,"RMPOC",RMDA,0),U,11)'="Y" Q
"RTN","RMPOPED",251,0)
 ; Logic to control toggling of Primary Item flag...
"RTN","RMPOPED",252,0)
 S RMNO="N"
"RTN","RMPOPED",253,0)
 F RMX=0:0 S RMX=$O(^RMPR(665,RMPODFN,"RMPOC",RMX)) Q:RMX'>0  D
"RTN","RMPOPED",254,0)
 . Q:RMDA=RMX
"RTN","RMPOPED",255,0)
 . S DA=RMX,DR="10///^S X=RMNO" D ^DIE
"RTN","RMPOPED",256,0)
 S DA=RMDA
"RTN","RMPOPED",257,0)
 Q
"RTN","RMPOPED",258,0)
PIEN(DFN) ; FIND PRIMARY ITEM
"RTN","RMPOPED",259,0)
 ; RETURN IEN OF P.I. IN MULTIPLE ^ IEN IN FILE 661
"RTN","RMPOPED",260,0)
 N X,PIEN
"RTN","RMPOPED",261,0)
 S X=0,PIEN=0
"RTN","RMPOPED",262,0)
 F  S X=$O(^RMPR(665,DFN,"RMPOC",X)) Q:X'>0  D  Q:PIEN
"RTN","RMPOPED",263,0)
 . S:$P(^RMPR(665,DFN,"RMPOC",X,0),U,11)="Y" PIEN=X
"RTN","RMPOPED",264,0)
 S:PIEN PIEN=PIEN_U_$P(^RMPR(665,DFN,"RMPOC",PIEN,0),U,1)
"RTN","RMPOPED",265,0)
 Q PIEN
"RTN","RMPOPED",266,0)
ITEMD ; Display Items
"RTN","RMPOPED",267,0)
 N I,Z,PIF,ITMNM,VDRNM
"RTN","RMPOPED",268,0)
 K IEN,ITEMS S I=0
"RTN","RMPOPED",269,0)
 Q:$O(^RMPR(665,RMPODFN,"RMPOC",0))'>0
"RTN","RMPOPED",270,0)
 W !!,"The following items are already in this patient's template:",!
"RTN","RMPOPED",271,0)
 F IEN=1:1 S I=$O(^RMPR(665,RMPODFN,"RMPOC",I)) Q:I'>0  D
"RTN","RMPOPED",272,0)
 . S Z=^RMPR(665,RMPODFN,"RMPOC",I,0)
"RTN","RMPOPED",273,0)
 . S PIF=$S($P(Z,U,11)="Y":"*",1:" ")
"RTN","RMPOPED",274,0)
 . S ITMNM=$$ITEMNM($P(Z,U)),VDRNM=$$VDRNM($P(Z,U,2))
"RTN","RMPOPED",275,0)
 .; K X S IENS=$P(Z,U)_","
"RTN","RMPOPED",276,0)
 .; D GETS^DIQ(661,IENS,.01,"","X") S ITMNM=$E(X(661,IENS,.01),1,33)
"RTN","RMPOPED",277,0)
 .; S IENS=$P(Z,U,2)_",",VDRNM="<< VENDOR NOT DEFINED >>"
"RTN","RMPOPED",278,0)
 .; I IENS'="," D GETS^DIQ(440,IENS,.01,"","X") S VDRNM=X(440,IENS,.01)
"RTN","RMPOPED",279,0)
 . S IEN(IEN)=I
"RTN","RMPOPED",280,0)
 . S ITEMS(IEN)=" "_PIF_$J(IEN,4)_"  "_$$LJ(ITMNM,38)_$E(VDRNM,1,30)
"RTN","RMPOPED",281,0)
 . W !,ITEMS(IEN)
"RTN","RMPOPED",282,0)
 W !!," * = Primary Item",!
"RTN","RMPOPED",283,0)
 S IEN=IEN-1
"RTN","RMPOPED",284,0)
 Q
"RTN","RMPOPED",285,0)
ITEMNM(ITM) ; RETURN ITEM NAME
"RTN","RMPOPED",286,0)
 S IENS=ITM_","
"RTN","RMPOPED",287,0)
 D GETS^DIQ(661,IENS,.01,"","X")
"RTN","RMPOPED",288,0)
 Q $E(X(661,IENS,.01),1,33)
"RTN","RMPOPED",289,0)
VDRNM(VDR) ; RETURN VENDOR NAME
"RTN","RMPOPED",290,0)
 I VDR="" Q "<< VENDOR NOT DEFINED >>"
"RTN","RMPOPED",291,0)
 S IENS=VDR_"," D GETS^DIQ(440,IENS,.01,"","X")
"RTN","RMPOPED",292,0)
 Q X(440,IENS,.01)
"RTN","RMPOPED",293,0)
ITEMK ; Delete an Item
"RTN","RMPOPED",294,0)
 ;
"RTN","RMPOPED",295,0)
 K DIR S DIR(0)="Y",DIR("A")="Are you SURE you want to delete this item"
"RTN","RMPOPED",296,0)
 S DIR("B")="NO" D ^DIR Q:Y'>0
"RTN","RMPOPED",297,0)
 K DIK,DA
"RTN","RMPOPED",298,0)
 S DA(1)=RMPODFN,DA=IEN(ITEM),DIK="^RMPR(665,"_DA(1)_",""RMPOC"","
"RTN","RMPOPED",299,0)
 D ^DIK W "  ...deleted!"
"RTN","RMPOPED",300,0)
 Q
"RTN","RMPOPED",301,0)
ITEMO() ; Choose Option
"RTN","RMPOPED",302,0)
 K DIR
"RTN","RMPOPED",303,0)
 S DIR(0)="SBO^A:Add;D:Delete;E:Edit",DIR("A")="Select ACTION" D ^DIR
"RTN","RMPOPED",304,0)
 Q Y
"RTN","RMPOPED",305,0)
 Q
"RTN","RMPORNQ")
0^26^B5946232
"RTN","RMPORNQ",1,0)
RMPORNQ ;(VA-EDS)PAK/HINES CIOFO/HNC - NEW PATIENT REPORT ;7/24/98
"RTN","RMPORNQ",2,0)
 ;;3.0;PROSTHETICS;**29,77**;Feb 09, 1996
"RTN","RMPORNQ",3,0)
 ;
"RTN","RMPORNQ",4,0)
 ;RVD patch #77 - insure that a dangling 'AC' x-ref will not cause
"RTN","RMPORNQ",5,0)
 ;                an undefined error.
"RTN","RMPORNQ",6,0)
 ;
"RTN","RMPORNQ",7,0)
START ;
"RTN","RMPORNQ",8,0)
 ;Set up site variables.
"RTN","RMPORNQ",9,0)
 D HOSITE^RMPOUTL0 I '$D(RMPOXITE) Q
"RTN","RMPORNQ",10,0)
 ;
"RTN","RMPORNQ",11,0)
 ;Ask starting date
"RTN","RMPORNQ",12,0)
 S %DT="AEX",%DT("A")="Enter the start date: "
"RTN","RMPORNQ",13,0)
 S %DT(0)=-DT
"RTN","RMPORNQ",14,0)
 S %DT("B")=$E(DT,4,5)_"/01"_"/"_$E(DT,2,3)
"RTN","RMPORNQ",15,0)
 D ^%DT Q:'Y!$D(DTOUT)
"RTN","RMPORNQ",16,0)
 S FRMDT=$P(Y,".")  ; extract ONLY date
"RTN","RMPORNQ",17,0)
 ;
"RTN","RMPORNQ",18,0)
 ;List the sought patient.
"RTN","RMPORNQ",19,0)
 S DIC="^RMPR(665,",L=0
"RTN","RMPORNQ",20,0)
 S DIS(0)="I $P($G(^RMPR(665,D0,""RMPOA"")),U,7)=RMPOXITE"
"RTN","RMPORNQ",21,0)
 S BY=".01,19.2",FR(1)="",FR(2)=FRMDT,TO(1)="",TO(2)=""
"RTN","RMPORNQ",22,0)
 S (RMEND,RMPORPT,PAGE)=0
"RTN","RMPORNQ",23,0)
 S SPACE="",$P(SPACE," ",80)="",COUNT=0,DASH="",$P(DASH,"-",79)=""
"RTN","RMPORNQ",24,0)
 D NOW^%DTC S Y=% X ^DD("DD") S RPTDT=$P(Y,"@",1)_"  "_$P($P(Y,"@",2),":",1,2)
"RTN","RMPORNQ",25,0)
 S DHD="W ?0 D RPTHDR^RMPORNQ"
"RTN","RMPORNQ",26,0)
 S FLDS=".01;C1;L22;""PATIENT"",W $$SSN^RMPORPR;C25;R4;""SSN"",W $$PRI^RMPORNQ;31;L32;""PRIMARY ITEM"",19.2;C65;L10;""START"""
"RTN","RMPORNQ",27,0)
 S DIOEND="I $G(Y)'[U S COUNT=$E(""      "",1,(6-$L(COUNT)))_COUNT W !!,?50,""TOTAL PATIENTS: "",COUNT S RMEND=1 S:IOST[""P-"" RMPORPT=1"
"RTN","RMPORNQ",28,0)
 D EN1^DIP
"RTN","RMPORNQ",29,0)
 I RMPORPT=0,$G(RMEND) K DIR S DIR(0)="E" D ^DIR
"RTN","RMPORNQ",30,0)
EXIT ;
"RTN","RMPORNQ",31,0)
 ;
"RTN","RMPORNQ",32,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPORNQ",33,0)
 Q
"RTN","RMPORNQ",34,0)
SDT ;Activation date.
"RTN","RMPORNQ",35,0)
 S X=$P($G(^RMPR(665,D0,"RMPOA")),U,2)
"RTN","RMPORNQ",36,0)
 I X S X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_($E(X,1,3)+1700)
"RTN","RMPORNQ",37,0)
 Q
"RTN","RMPORNQ",38,0)
 ;
"RTN","RMPORNQ",39,0)
PRI() ;Get primary item.
"RTN","RMPORNQ",40,0)
 N ITMN
"RTN","RMPORNQ",41,0)
 ;
"RTN","RMPORNQ",42,0)
 S RMPOITM=$O(^RMPR(665,"AC","Y",D0,"")) Q:RMPOITM="" ""
"RTN","RMPORNQ",43,0)
 ; get item name from ITEM MASTER file as pointer field is DINUMed
"RTN","RMPORNQ",44,0)
 I '$D(^RMPR(665,D0,"RMPOC",RMPOITM,0)) Q ""
"RTN","RMPORNQ",45,0)
 S ITMN=$P(^RMPR(665,D0,"RMPOC",RMPOITM,0),U)
"RTN","RMPORNQ",46,0)
 S ITMN=$P(^RMPR(661,ITMN,0),U)
"RTN","RMPORNQ",47,0)
 S ITMN=$P(^PRC(441,ITMN,0),U,2)
"RTN","RMPORNQ",48,0)
 Q $E(ITMN,1,32)
"RTN","RMPORNQ",49,0)
 ;
"RTN","RMPORNQ",50,0)
RPTHDR ;Report header
"RTN","RMPORNQ",51,0)
 N RA S RA=RMPO("NAME"),PAGE=PAGE+1
"RTN","RMPORNQ",52,0)
 W RPTDT,?(40-($L(RA)/2)),RA,?65,"Page: "_PAGE
"RTN","RMPORNQ",53,0)
 W !?24,"New Patient Report",!
"RTN","RMPORNQ",54,0)
 W !,?4,"Patient",?24,"SSN",?39,"Primary Item",?64,"Activation Date"
"RTN","RMPORNQ",55,0)
 W !,"=====================",?24,"====",?30,"================================"
"RTN","RMPORNQ",56,0)
 W ?64,"===============",!
"RTN","RMPORNQ",57,0)
 Q
"RTN","RMPR29D")
0^2^B9231694
"RTN","RMPR29D",1,0)
RMPR29D ;PHX/JLT-DISPLAY 2529-3 INFO ;8/29/1994 [ 09/29/94  10:05 AM ]
"RTN","RMPR29D",2,0)
 ;;3.0;PROSTHETICS;**12,41,77**;Feb 09, 1996
"RTN","RMPR29D",3,0)
 ;RVD 3/18/03 patch #77 - prevent error in word processing field. 
"RTN","RMPR29D",4,0)
DISP ;GET AND DISPLAY 2529-3 INFO
"RTN","RMPR29D",5,0)
 ;CALLED BY:RMPR29,RMPR29A,RMPR29B,RMPR29C,RMPR29J,RMPR29P,RMPR29S,RMPR29T
"RTN","RMPR29D",6,0)
 ;VARIABLES REQUIRED: RMPRDA - ENTRY IN FILE 664.
"RTN","RMPR29D",7,0)
 D HOME^%ZIS K ^UTILITY("DIQ1",$J),HLD
"RTN","RMPR29D",8,0)
 Q:$G(RMPRDA)'>0  S DIC="^RMPR(664.1,",DA=RMPRDA,DR=".02;.11;.04;.09;2;4;13;15;19"
"RTN","RMPR29D",9,0)
 D EN^DIQ1 K DIQ,DR S PAGE=1
"RTN","RMPR29D",10,0)
 S DA=RMPRDA
"RTN","RMPR29D",11,0)
 F RI=0:0 S RI=$O(^RMPR(664.1,DA,2,RI)) Q:RI'>0  I $D(^(RI,0)) D
"RTN","RMPR29D",12,0)
 .S DIC="^RMPR(664.1,",DR="6"
"RTN","RMPR29D",13,0)
 .S DR(664.16)=".01;2;3;8;9;10;7;12;13;13.1",DA(664.16)=RI
"RTN","RMPR29D",14,0)
 .S HLD(RI)=$$ITM1^RMPR31U($P(^RMPR(664.1,DA,2,RI,0),U))
"RTN","RMPR29D",15,0)
 .D EN^DIQ1 K DIQ,DR
"RTN","RMPR29D",16,0)
 I '$D(PNK) D HD^RMPR29W G ITD
"RTN","RMPR29D",17,0)
 I $D(PNK) D HDC^RMPR29W G ITD
"RTN","RMPR29D",18,0)
 G ASK^RMPR29T
"RTN","RMPR29D",19,0)
ITD ;ITEM DISPLAY
"RTN","RMPR29D",20,0)
 ;CALLED BY RMPR29T
"RTN","RMPR29D",21,0)
 ;VARIABLES REQUIRED: HLD - ARRAY OF ITEMS
"RTN","RMPR29D",22,0)
 ;                    RI  - ITEM NUMBER
"RTN","RMPR29D",23,0)
 G:($Y+8>IOSL)!('$D(HLD)) ASK^RMPR29T
"RTN","RMPR29D",24,0)
 S RI=$O(HLD(0))
"RTN","RMPR29D",25,0)
 W !,HLD(RI),?10,$E(^UTILITY("DIQ1",$J,664.16,RI,.01),1,15)
"RTN","RMPR29D",26,0)
 W ?27,$E(^UTILITY("DIQ1",$J,664.16,RI,12),1,15),?45,^(2),?50,^(3),?55,^(8),?65,^(9)
"RTN","RMPR29D",27,0)
 ;HCPCS Display
"RTN","RMPR29D",28,0)
 W !,?10,"HCPCS: ",^UTILITY("DIQ1",$J,664.16,RI,13)
"RTN","RMPR29D",29,0)
 W !,?10,"CPT MODIFIER: ",^UTILITY("DIQ1",$J,664.16,RI,13.1)
"RTN","RMPR29D",30,0)
WP ;WORD PROCESSING FIELD DISPLAY
"RTN","RMPR29D",31,0)
 G:($Y+8>IOSL) ASK^RMPR29T S RWP=$O(^UTILITY("DIQ1",$J,664.16,RI,7,0))
"RTN","RMPR29D",32,0)
 I RWP'>0 K HLD(RI) K D0 D ADC^RMPR293(RMPRDA,RI) W ! G ITD
"RTN","RMPR29D",33,0)
 S X=$G(^UTILITY("DIQ1",$J,664.16,RI,7,RWP))
"RTN","RMPR29D",34,0)
 K ^UTILITY("DIQ1",$J,664.16,RI,7,RWP)
"RTN","RMPR29D",35,0)
 K ^UTILITY($J) S DIWL=1,DIWR=60,DIWF="R" D ^DIWP
"RTN","RMPR29D",36,0)
EXT ;COMMON EXIT POINT
"RTN","RMPR29D",37,0)
 ;CALLED BY RMPR29T
"RTN","RMPR29D",38,0)
 ;VARIABLES REQUIRED: - UTILITY GLOBAL CONTAINING INFO TO PRINT AND KILL.
"RTN","RMPR29D",39,0)
 G:($Y+8>IOSL)!'$D(DIWL) ASK^RMPR29T
"RTN","RMPR29D",40,0)
 S RL=$O(^UTILITY($J,"W",DIWL,0)) I +RL W !,?10,^(RL,0) K ^(0) G EXT
"RTN","RMPR29D",41,0)
 K ^UTILITY($J) G WP
"RTN","RMPR29D",42,0)
CHK ;CHECK DISABILITY AND ITEMS
"RTN","RMPR29D",43,0)
 ;kill record if not all mandatory fields defined
"RTN","RMPR29D",44,0)
 ;CALLED BY RMPR29T,RMPR29
"RTN","RMPR29D",45,0)
 ;VARIABLES REQUIRED: RMPRDA - ENTRY NUMBER IN FILE 664.1
"RTN","RMPR29D",46,0)
 K RKILL
"RTN","RMPR29D",47,0)
 F RCK=1,2,3,4,11,15 I $P(^RMPR(664.1,RMPRDA,0),U,RCK)="" S RKILL=1 S DA=RMPRDA,DIK="^RMPR(664.1," D ^DIK W !!,?5,$C(7),"ALL MANDATORY FIELDS NOT DEFINED FORM 2529-3 DELETED" Q
"RTN","RMPR29D",48,0)
 I $D(RKILL) G EXIT^RMPR29
"RTN","RMPR29D",49,0)
 ;disability code missing
"RTN","RMPR29D",50,0)
 K DKILL
"RTN","RMPR29D",51,0)
 I '$D(^RMPR(664.1,RMPRDA,1))!('$O(^RMPR(664.1,RMPRDA,1,0))) S DKILL=1
"RTN","RMPR29D",52,0)
 F RI=0:0 S RI=$O(^RMPR(664.1,RMPRDA,1,RI)) Q:RI'>0  I $P(^(RI,0),U,1)=""!($P(^(0),U,2)="") S DKILL=1
"RTN","RMPR29D",53,0)
 ;item missing
"RTN","RMPR29D",54,0)
 K IKILL
"RTN","RMPR29D",55,0)
 I '$D(^RMPR(664.1,RMPRDA,2))!('$O(^RMPR(664.1,RMPRDA,2,0))) S IKILL=1
"RTN","RMPR29D",56,0)
 F RI=0:0 S RI=$O(^RMPR(664.1,RMPRDA,2,RI)) Q:RI'>0  I $P(^(RI,0),U,1)=""!($P(^(0),U,2)="")!($P(^(0),U,3)="")!($P(^(0),U,7)="")!($P(^(0),U,8)="") S IKILL=1
"RTN","RMPR29D",57,0)
ER1 ;error message
"RTN","RMPR29D",58,0)
 I $D(DKILL) W $C(7),!!,?5,"2529-3 FORM INCOMPLETE.  DISABILITY CODE INFORMATION IS MISSING!!"
"RTN","RMPR29D",59,0)
 I $D(IKILL) W $C(7),!!,?5,"2529-3 FORM INCOMPLETE.  ITEM INFORMATION IS MISSING!!"
"RTN","RMPR29D",60,0)
 I $D(IKILL)!($D(DKILL)) G DEL^RMPR29
"RTN","RMPR29D",61,0)
 ;see internal notes
"RTN","RMPR29D",62,0)
 K DA,DIC,DIK,DIWF,DIWL,DIWR,PAGE,PNK,RCK,RI,RL,RWP,X
"RTN","RMPR29D",63,0)
 G LAB^RMPR29
"RTN","RMPR5N1")
0^3^B30610033
"RTN","RMPR5N1",1,0)
RMPR5N1 ;HIN/RVD-PROS STOCK ITEM RECORDS ;3/17/03  13:19
"RTN","RMPR5N1",2,0)
 ;;3.0;PROSTHETICS;**33,77**;Feb 09, 1996
"RTN","RMPR5N1",3,0)
 ;RVD 3/17/03 patch #77 - allow queing to p-message.  IO to ION
"RTN","RMPR5N1",4,0)
 D DIV4^RMPRSIT I $D(Y),(Y<0) Q
"RTN","RMPR5N1",5,0)
 ;
"RTN","RMPR5N1",6,0)
EN K ^TMP($J),RMPRI,RMPRFLG S RMPREND=0 D HOME^%ZIS S DIC="^RMPR(661.1,",DIC(0)="AEQM",DIC("S")="I $D(^RMPR(661.1,+Y,3,0))"
"RTN","RMPR5N1",7,0)
 F HCPCS=1:1 S DIC("A")="Select HCPCS "_HCPCS_": " D ^DIC G:$D(DTOUT)!(X["^")!(X=""&(HCPCS=1)) EXIT1 Q:X=""  D
"RTN","RMPR5N1",8,0)
 .Q:'$D(^RMPR(661.1,+Y,0))  S RMHCPC=$P(^RMPR(661.1,+Y,0),U,1)
"RTN","RMPR5N1",9,0)
 .I $D(RMPRI(RMHCPC)) W $C(7)," ??",?40,"..Duplicate HCPCS" S HCPCS=HCPCS-1 Q
"RTN","RMPR5N1",10,0)
 .S:RMHCPC'="" RMPRI(RMHCPC)=+Y
"RTN","RMPR5N1",11,0)
 S RMPRCOUN=0 W !! S %DT("A")="Beginning Date: ",%DT="AEPX",%DT("B")="T-30" D ^%DT S RMPRBDT=Y G:Y<0 EXIT1
"RTN","RMPR5N1",12,0)
ENDATE S %DT("A")="Ending Date: ",%DT="AEX",%DT("B")="TODAY" D ^%DT G:Y<0 EXIT1 I RMPRBDT>Y W !,$C(7),"Invalid Date Range Selection!!" G ENDATE
"RTN","RMPR5N1",13,0)
 G:Y<0 EXIT S RMPREDT=Y,Y=RMPRBDT D DD^%DT S RMPRX=Y,Y=RMPREDT D DD^%DT S RMPRY=Y
"RTN","RMPR5N1",14,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT
"RTN","RMPR5N1",15,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPR5N1",16,0)
 K IO("Q") S ZTDESC="STOCK ITEM REPORT",ZTRTN="PRINT^RMPR5N1",ZTIO=ION,ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPRI(")="",ZTSAVE("RMPRX")="",ZTSAVE("RMPRY")="",ZTSAVE("RMPR(""STA"")")="",ZTSAVE("RMPR(")=""
"RTN","RMPR5N1",17,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT1
"RTN","RMPR5N1",18,0)
 ;
"RTN","RMPR5N1",19,0)
PRINT I $E(IOST)["C" W @IOF,!!,"Processing report......"
"RTN","RMPR5N1",20,0)
 ;Entry point of printing report.
"RTN","RMPR5N1",21,0)
 S RMBDATE=$E(RMPRBDT,4,5)_"/"_$E(RMPRBDT,6,7)_"/"_$E(RMPRBDT,2,3)
"RTN","RMPR5N1",22,0)
 I '$D(RMPRI) D NONEALL G EXIT
"RTN","RMPR5N1",23,0)
 S RMPAGE=1,(RMPREND,RP,QTYT,RMIFL,RMCO,RMTOCO,RMTOCOH)=0
"RTN","RMPR5N1",24,0)
 D HEAD
"RTN","RMPR5N1",25,0)
 ;
"RTN","RMPR5N1",26,0)
PRI S RQ="" F  S RQ=$O(RMPRI(RQ)) Q:RQ=""  S RMD=RMPRI(RQ) D PRI1
"RTN","RMPR5N1",27,0)
 S R0="" D WRI
"RTN","RMPR5N1",28,0)
 G EXIT
"RTN","RMPR5N1",29,0)
 ;
"RTN","RMPR5N1",30,0)
PRI1 S (RMSTAFL,RMSUF,RMQTYT)=0
"RTN","RMPR5N1",31,0)
 S RO=0 F  S RO=$O(^RMPR(661.2,"D",RMD,RO)) Q:(RO'>0)!(RMPREND)  D REST
"RTN","RMPR5N1",32,0)
 D:'RMSTAFL NONE
"RTN","RMPR5N1",33,0)
 Q
"RTN","RMPR5N1",34,0)
 ;
"RTN","RMPR5N1",35,0)
EXIT ;EXIT FROM REPORT HERE
"RTN","RMPR5N1",36,0)
 ;I $E(IOST)["C"&($Y<22) F  W ! Q:$Y>20
"RTN","RMPR5N1",37,0)
 I $E(IOST)["C",'$D(DUOUT),'RMPREND K DIR S DIR(0)="E" D ^DIR
"RTN","RMPR5N1",38,0)
EXIT1 D ^%ZISC
"RTN","RMPR5N1",39,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPR5N1",40,0)
 Q
"RTN","RMPR5N1",41,0)
 ;
"RTN","RMPR5N1",42,0)
REST ;
"RTN","RMPR5N1",43,0)
 S RMSUF=1
"RTN","RMPR5N1",44,0)
 S RMSSN=""
"RTN","RMPR5N1",45,0)
 S RM2=$G(^RMPR(661.2,RO,0)) Q:RM2=""
"RTN","RMPR5N1",46,0)
 Q:'$P(RM2,U,16)
"RTN","RMPR5N1",47,0)
 S RMDAT=$P(RM2,U,1),RMSTA=$P(RM2,U,15) Q:RMSTA'=RMPR("STA")
"RTN","RMPR5N1",48,0)
 Q:RMDAT<RMPRBDT!(RMDAT>RMPREDT)
"RTN","RMPR5N1",49,0)
 S:RMSTA=RMPR("STA") RMSTAFL=1
"RTN","RMPR5N1",50,0)
 S RMPAT=$P(RM2,U,2),RMSO=$P(RM2,U,3),RMUNI=$P(RM2,U,5),RMAVCO=$P(RM2,U,17)
"RTN","RMPR5N1",51,0)
 S RMUSR=$P(RM2,U,7),RMBA=$P(RM2,U,8),RMCOM=$P(RM2,U,13),RMHI=$P(RM2,U,9)
"RTN","RMPR5N1",52,0)
 S RMHCPC=$P(RMHI,"-",1),RMONO=$P(RM2,U,10),RMREC=$P(RM2,U,11),RMCUB=$P(RM2,U,12)
"RTN","RMPR5N1",53,0)
 S RMDAHC=$O(^RMPR(661.1,"B",RMHCPC,0)) Q:'RMDAHC
"RTN","RMPR5N1",54,0)
 S RMDAIT=$P(RMHI,"-",2),RMSER=$P(RM2,U,6)
"RTN","RMPR5N1",55,0)
 S RMDAT=$E(RMDAT,4,5)_"/"_$E(RMDAT,6,7)_"/"_$E(RMDAT,2,3)
"RTN","RMPR5N1",56,0)
 S RM1=$G(^RMPR(661.1,RMDAHC,3,RMDAIT,0))
"RTN","RMPR5N1",57,0)
 Q:RM1=""
"RTN","RMPR5N1",58,0)
 S RMITEM=$P(RM1,U,1)
"RTN","RMPR5N1",59,0)
SET ;
"RTN","RMPR5N1",60,0)
 S ^TMP($J,RQ,RMITEM,RO)="^^"_RMPAT_"^"_RMSO_"^"_RMUSR_"^"_RMBA_"^"_RMONO_"^"_RMREC_"^"_RMCUB_"^"_RMCOM_"^"_RMAVCO_"^"_RMDAT_"^"_RMSER
"RTN","RMPR5N1",61,0)
 Q
"RTN","RMPR5N1",62,0)
 ;
"RTN","RMPR5N1",63,0)
WRI S (RMFH,RMFI,RMPRFLG,RMTOCOH,RMTOCOI)=0
"RTN","RMPR5N1",64,0)
 S RMITEM=""
"RTN","RMPR5N1",65,0)
 F  S R0=$O(^TMP($J,R0)) D:RMFH HTOTAL D:R0'="" HEAD1 Q:R0=""  S R1="" F  S R1=$O(^TMP($J,R0,R1)) D:RMFI ITOTAL Q:R1=""  D:RMITEM'=R1 IHEAD F R2=0:0 S R2=$O(^TMP($J,R0,R1,R2)) Q:(R2'>0)!(RMPREND)  D
"RTN","RMPR5N1",66,0)
 .S RDATA=^TMP($J,R0,R1,R2)
"RTN","RMPR5N1",67,0)
 .S RMDAT=$P(RDATA,U,12),RMAV=$P(RDATA,U,1),RMUNI=$P(RDATA,U,2)
"RTN","RMPR5N1",68,0)
 .S RMPAT=$P(RDATA,U,3),RMSO=$P(RDATA,U,4)
"RTN","RMPR5N1",69,0)
 .S RMUSR=$P(RDATA,U,5),RMQTY=$P(RDATA,U,6),RMONO=$P(RDATA,U,7)
"RTN","RMPR5N1",70,0)
 .S RMREC=$P(RDATA,U,8),RMCUB=$P(RDATA,U,9),RMCOM=$P(RDATA,U,10)
"RTN","RMPR5N1",71,0)
 .S RMSER=$E($P(RDATA,U,13),1,14)
"RTN","RMPR5N1",72,0)
 .S RMAVCO=$P(RDATA,U,11) S:RMAVCO'="" RMCO=RMAVCO*RMQTY
"RTN","RMPR5N1",73,0)
 .S RMITEM=R1
"RTN","RMPR5N1",74,0)
 .I 'RMPRFLG D HEAD1
"RTN","RMPR5N1",75,0)
 .S:RMUSR RMUSR=$E($P(^VA(200,RMUSR,0),U,1),1,12)
"RTN","RMPR5N1",76,0)
 .S:RMPAT RMSSN=$E($P(^DPT(RMPAT,0),U,9),6,9)
"RTN","RMPR5N1",77,0)
 .S (RMFH,RMFI)=1
"RTN","RMPR5N1",78,0)
 .W !,RMDAT
"RTN","RMPR5N1",79,0)
 .I RMPAT W ?9,$E($P(^DPT(RMPAT,0),U,1),1,14),?26,RMSSN,?31,RMUSR,?47,RMQTY,?59,RMSER,?73,$J(RMCUB,7,0) S:$G(RMCO) RMTOCO=RMTOCO+RMCO
"RTN","RMPR5N1",80,0)
 .I 'RMPAT W ?11,"**Note: ",RMCOM,?49,$J(RMONO,4),?54,$J(RMREC,4),?73,$J(RMCUB,7,0) I RMCOM["Returned" S:$G(RMCO) RMTOCO=RMTOCO+RMCO
"RTN","RMPR5N1",81,0)
 .S RMPRFLG=1
"RTN","RMPR5N1",82,0)
 .I $E(IOST)["C"&($Y>(IOSL-7)) S DIR(0)="E" D ^DIR S:$D(DTOUT)!(Y=0) RMPREND=1 Q:RMPREND  W @IOF D HEAD,HEAD1 Q
"RTN","RMPR5N1",83,0)
 .I $Y>(IOSL-6) W @IOF D HEAD,HEAD1 S RMPRFLG=1
"RTN","RMPR5N1",84,0)
 Q
"RTN","RMPR5N1",85,0)
 ;
"RTN","RMPR5N1",86,0)
HEAD W !,"*** ISSUE and STOCK CONTROL RECORD - PROSTHETICS STOCK ITEMS ***",?65,"Page: ",RMPAGE,!,?30,"station: ",$E($P($G(^DIC(4,RMPR("STA"),0)),U,1),1,20)
"RTN","RMPR5N1",87,0)
 N X,% S Y=RMPRBDT D DD^%DT W !,Y," to " S Y=RMPREDT D DD^%DT W Y
"RTN","RMPR5N1",88,0)
 S RMPAGE=RMPAGE+1
"RTN","RMPR5N1",89,0)
 Q
"RTN","RMPR5N1",90,0)
 ;
"RTN","RMPR5N1",91,0)
IHEAD S RMDAHC=$O(^RMPR(661.1,"B",R0,0))
"RTN","RMPR5N1",92,0)
 S RMITEM=$E(RMITEM,1,26)
"RTN","RMPR5N1",93,0)
 W !,"HCPCS: ",R0,?16,"Item: ",R1
"RTN","RMPR5N1",94,0)
 S RMI=1
"RTN","RMPR5N1",95,0)
 Q
"RTN","RMPR5N1",96,0)
 ;
"RTN","RMPR5N1",97,0)
HEAD1 ;write heading
"RTN","RMPR5N1",98,0)
 I $E(IOST)["C"&($Y>(IOSL-7)) S DIR(0)="E" D ^DIR S:$D(DTOUT)!(Y=0) RMPREND=1 Q:RMPREND  W @IOF D HEAD
"RTN","RMPR5N1",99,0)
 W !,RMPR("L")
"RTN","RMPR5N1",100,0)
 W !,?44,"QTY",?50,"QTY",?55,"QTY",?63,"SERIAL"
"RTN","RMPR5N1",101,0)
 W !," DATE",?9,"PATIENT",?26,"SSN",?31,"USER",?44,"ISSUE",?50,"ORDR",?55,"REC",?63,"NUMBER",?73,"BALANCE"
"RTN","RMPR5N1",102,0)
 W !," ----",?9,"-------",?26,"---",?31,"----",?44,"-----",?50,"----",?55,"---",?63,"------",?73,"-------"
"RTN","RMPR5N1",103,0)
 S RMPRFLG=1
"RTN","RMPR5N1",104,0)
 Q
"RTN","RMPR5N1",105,0)
 ;
"RTN","RMPR5N1",106,0)
HTOTAL ;
"RTN","RMPR5N1",107,0)
 I RMFH,'RMPREND W !!,?23,"*** Dollar Value of HCPCS Issued",?60,"=",?62,$J(RMTOCOH,11,2)
"RTN","RMPR5N1",108,0)
 S (RMTOCOH,RMFH)=0
"RTN","RMPR5N1",109,0)
 Q
"RTN","RMPR5N1",110,0)
 ;
"RTN","RMPR5N1",111,0)
ITOTAL ;
"RTN","RMPR5N1",112,0)
 I RMFI,'RMPREND W !,?42,"--------------------------------------",!,?23,"*** Dollar Value of Item Issued",?60,"=",?62,$J(RMTOCO,11,2)
"RTN","RMPR5N1",113,0)
 S RMTOCOH=RMTOCOH+RMTOCO,(RMTOCO,RMCO,RMFI)=0
"RTN","RMPR5N1",114,0)
 Q
"RTN","RMPR5N1",115,0)
 ;
"RTN","RMPR5N1",116,0)
NONE ;nothing to report.
"RTN","RMPR5N1",117,0)
 W !,RMPR("L"),!,"No Item Statistics for HCPCS: ",RQ,"...for this date range !!!"
"RTN","RMPR5N1",118,0)
 Q
"RTN","RMPR5N1",119,0)
NONEALL W !!,"NO DATA AT THIS DATE RANGE!!!!"
"RTN","RMPR5N1",120,0)
 Q
"RTN","RMPR5N2")
0^4^B20251212
"RTN","RMPR5N2",1,0)
RMPR5N2 ;HIN/RVD-PRINT INVENTORY BALANCE BY LOCATION ;3/17/03  13:19
"RTN","RMPR5N2",2,0)
 ;;3.0;PROSTHETICS;**33,37,77**;Feb 09, 1996
"RTN","RMPR5N2",3,0)
 ;RVD 3/17/03 patch #77 - allow queing to p-message.  IO to ION.
"RTN","RMPR5N2",4,0)
 D DIV4^RMPRSIT I $D(Y),(Y<0) Q
"RTN","RMPR5N2",5,0)
 S X="NOW" D ^%DT D DD^%DT S RMDAT=Y
"RTN","RMPR5N2",6,0)
 ;
"RTN","RMPR5N2",7,0)
EN K ^TMP($J),RMPRI,RMPRFLG S RMPREND=0 D HOME^%ZIS S DIC="^RMPR(661.3,",DIC(0)="AEQ",DIC("S")="I $P(^RMPR(661.3,+Y,0),U,3)=RMPR(""STA"")"
"RTN","RMPR5N2",8,0)
EN1 R !!,"Enter 'ALL' for all Locations or 'RETURN' to select individual Locations: ",RMENTER:DTIME G:$D(DTOUT)!$D(DUOUT)!(RMENTER="^") EXIT1
"RTN","RMPR5N2",9,0)
 G:RMENTER["?" EN1
"RTN","RMPR5N2",10,0)
 S X=RMENTER X ^%ZOSF("UPPERCASE") S RMENTER=Y I RMENTER="ALL" S RMPRI(0)=1 G CONT
"RTN","RMPR5N2",11,0)
 W ! F RML=1:1 S DIC("A")="Select Location "_RML_": " D ^DIC G:$D(DTOUT)!(X["^")!(X=""&(RML=1)) EXIT1 Q:X=""  D
"RTN","RMPR5N2",12,0)
 .S RMLOCI=$P(^RMPR(661.3,+Y,0),U,1)
"RTN","RMPR5N2",13,0)
 .I $D(RMPRI(RMLOCI)) W $C(7)," ??",?40,"..Duplicate Location" S RML=RML-1 Q
"RTN","RMPR5N2",14,0)
 .S RMPRI(RMLOCI)=+Y
"RTN","RMPR5N2",15,0)
CONT G:'$D(RMPRI) EXIT1 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT1 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPR5N2",16,0)
 K IO("Q") S ZTDESC="PROSTHETIC INVENTORY LOCATION SUMMARY",ZTRTN="PRINT^RMPR5N2",ZTIO=ION,ZTSAVE("RMPRI(")="",ZTSAVE("RMPR(""STA"")")="",ZTSAVE("RMDAT")="",ZTSAVE("RMPR(")=""
"RTN","RMPR5N2",17,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT1
"RTN","RMPR5N2",18,0)
 ;
"RTN","RMPR5N2",19,0)
PRINT I $E(IOST)["C" W !!,"Processing report....."
"RTN","RMPR5N2",20,0)
 S RMPAGE=1,RMPREND=0,RS=RMPR("STA") D:$D(RMPRI(0)) ALL
"RTN","RMPR5N2",21,0)
 I '$D(RMPRI) D NONE G EXIT
"RTN","RMPR5N2",22,0)
C S RB="" F  S RB=$O(RMPRI(RB)) Q:RB=""  Q:RMPREND  S RMLIEN=RMPRI(RB) D CK
"RTN","RMPR5N2",23,0)
 G:RMPREND EXIT
"RTN","RMPR5N2",24,0)
 W:$E(IOST)["C" @IOF
"RTN","RMPR5N2",25,0)
 D HEAD,WRI D:'$D(^TMP($J)) NONE G EXIT
"RTN","RMPR5N2",26,0)
 ;
"RTN","RMPR5N2",27,0)
CK Q:'$D(^RMPR(661.3,RMLIEN,1,0))
"RTN","RMPR5N2",28,0)
 F J=0:0 S J=$O(^RMPR(661.3,RMLIEN,1,J)) Q:J'>0  F K=0:0 S K=$O(^RMPR(661.3,RMLIEN,1,J,1,K)) Q:K'>0  S RM3=$G(^RMPR(661.3,RMLIEN,1,J,1,K,0)),RMIT=$P(RM3,U,1) D
"RTN","RMPR5N2",29,0)
 .S RMHCPC=$P(RMIT,"-",1),RMDAIT=$P(RMIT,"-",2),RMDAHC=$O(^RMPR(661.1,"B",RMHCPC,0)) Q:'RMDAHC
"RTN","RMPR5N2",30,0)
 .S RM1=$G(^RMPR(661.1,RMDAHC,3,RMDAIT,0)),RMITEM=$P(RM1,U,1) Q:RM1=""
"RTN","RMPR5N2",31,0)
 .S RMBA=$P(RM3,U,2),RMCO=$P(RM3,U,3),RMUNI=$P(RM3,U,4),RMVEN=$P(RM3,U,5)
"RTN","RMPR5N2",32,0)
 .S RMRLE=$P(RM3,U,6),RMDI=$P(RM3,U,7),RMSO=$P(RM3,U,9),RMAV=$P(RM3,U,10)
"RTN","RMPR5N2",33,0)
 .S ^TMP($J,RB,RMIT,RMITEM)=RMAV_"^"_RMBA_"^"_RMCO_"^"_RMUNI_"^"_RMVEN_"^"_RMRLE_"^"_RMDI_"^"_RMSO_"^"_RMLIEN
"RTN","RMPR5N2",34,0)
 Q
"RTN","RMPR5N2",35,0)
 ;write/print report
"RTN","RMPR5N2",36,0)
WRI S RP="" F  S RP=$O(^TMP($J,RP)) Q:RP=""  Q:RMPREND  K RMPRFLG S J="" F  S J=$O(^TMP($J,RP,J)) Q:J=""  Q:RMPREND  S K="" F  S K=$O(^TMP($J,RP,J,K)) Q:K=""  Q:RMPREND  S RMAST="",RM3=^TMP($J,RP,J,K) D
"RTN","RMPR5N2",37,0)
 .I '$D(RMPRFLG) D HEAD1
"RTN","RMPR5N2",38,0)
 .S RMLODA=$P(RM3,U,9)
"RTN","RMPR5N2",39,0)
 .S RMIT=J
"RTN","RMPR5N2",40,0)
 .S RMITEM=K
"RTN","RMPR5N2",41,0)
 .S RMAV=$P(RM3,U,1)
"RTN","RMPR5N2",42,0)
 .S RMBA=$P(RM3,U,2)
"RTN","RMPR5N2",43,0)
 .S RMCO=$P(RM3,U,3)
"RTN","RMPR5N2",44,0)
 .S RMUNI=$P(RM3,U,4)
"RTN","RMPR5N2",45,0)
 .S RMVEN=$P(RM3,U,5)
"RTN","RMPR5N2",46,0)
 .S RMRLE=$P(RM3,U,6)
"RTN","RMPR5N2",47,0)
 .S RMDI=$P(RM3,U,7)
"RTN","RMPR5N2",48,0)
 .S RMSO=$P(RM3,U,8)
"RTN","RMPR5N2",49,0)
 .S:RMUNI RMUNI=$P($G(^PRCD(420.5,RMUNI,0)),U,1)
"RTN","RMPR5N2",50,0)
 .S:RMVEN RMVEN=$P($G(^PRC(440,RMVEN,0)),U,1)
"RTN","RMPR5N2",51,0)
 .S RMITEM=$E(RMITEM,1,27),RMVEN=$E(RMVEN,1,12)
"RTN","RMPR5N2",52,0)
 .S:RMBA<RMRLE RMAST="*"
"RTN","RMPR5N2",53,0)
 .;I RMSO="V" W !,RMHCPC,?9,RMITEM,?37,RMSO,?41,RMVEN,?55,RMUNI,?74,$J(RMBA,5)
"RTN","RMPR5N2",54,0)
 .;I RMSO="C" W !,RMHCPC,?9,RMITEM,?37,RMSO,?41,RMVEN,?55,RMUNI,?58,$J(RMRLE,4),?65,$J(RMAV,8,2),?74,$J(RMBA,5),RMAST
"RTN","RMPR5N2",55,0)
 .W !,RMIT,?9,RMITEM,?37,RMSO,?41,RMVEN,?55,RMUNI,?58,$J(RMRLE,4),?65,$J(RMAV,8,2),?74,$J(RMBA,5),RMAST
"RTN","RMPR5N2",56,0)
 .S RMPRFLG=1
"RTN","RMPR5N2",57,0)
 .I $E(IOST)["C",($Y>(IOSL-7)) S DIR(0)="E" D ^DIR S:$D(DTOUT)!(Y=0) RMPREND=1 Q:RMPREND  W @IOF D HEAD,HEAD1 Q
"RTN","RMPR5N2",58,0)
 .I $Y>(IOSL-6) W @IOF D HEAD,HEAD1 Q
"RTN","RMPR5N2",59,0)
 Q
"RTN","RMPR5N2",60,0)
 ;
"RTN","RMPR5N2",61,0)
HEAD W !,"*** PROSTHETICS INVENTORY BALANCE BY LOCATION ***",?68,"PAGE: ",RMPAGE,!,"Run Date: ",RMDAT,?30,"station: ",$E($P($G(^DIC(4,RS,0)),U,1),1,20)
"RTN","RMPR5N2",62,0)
 S RMPAGE=RMPAGE+1
"RTN","RMPR5N2",63,0)
 Q
"RTN","RMPR5N2",64,0)
 ;
"RTN","RMPR5N2",65,0)
HEAD1 I $E(IOST)["C",($Y>(IOSL-7)) S DIR(0)="E" D ^DIR S:$D(DTOUT)!(Y=0) RMPREND=1 Q:RMPREND  W @IOF D HEAD
"RTN","RMPR5N2",66,0)
 I $E(IOST)'["C",($Y>(IOSL-6)) W @IOF D HEAD
"RTN","RMPR5N2",67,0)
 W !,RMPR("L")
"RTN","RMPR5N2",68,0)
 W !,"Location: ",RP
"RTN","RMPR5N2",69,0)
 W !,?54,"UNIT",?60,"RE-"
"RTN","RMPR5N2",70,0)
 W !,?55,"OF",?59,"ORDER",?68,"AVG",?75,"CUR"
"RTN","RMPR5N2",71,0)
 W !,"HCPCS",?9,"ITEM",?36,"SRC",?41,"VENDOR",?53,"ISSUE",?59,"LEVEL",?68,"COST",?75,"BAL"
"RTN","RMPR5N2",72,0)
 W !,"-----",?9,"----",?36,"---",?41,"------",?53,"-----",?59,"-----",?67,"------",?74,"-----"
"RTN","RMPR5N2",73,0)
 S RMPRFLG=1
"RTN","RMPR5N2",74,0)
 Q
"RTN","RMPR5N2",75,0)
 ;
"RTN","RMPR5N2",76,0)
ALL ;PROCESS ALL LOCATION
"RTN","RMPR5N2",77,0)
 K RMPRI(0) S RML="" F  S RML=$O(^RMPR(661.3,"B",RML)) Q:RML=""  D
"RTN","RMPR5N2",78,0)
 .S RLOC=$O(^RMPR(661.3,"B",RML,0))
"RTN","RMPR5N2",79,0)
 .I $P($G(^RMPR(661.3,RLOC,0)),U,3)=RMPR("STA") S RMPRI(RML)=RLOC
"RTN","RMPR5N2",80,0)
 Q
"RTN","RMPR5N2",81,0)
 ;
"RTN","RMPR5N2",82,0)
EXIT I $E(IOST)["C",'RMPREND W ! S DIR(0)="E" D ^DIR
"RTN","RMPR5N2",83,0)
EXIT1 D ^%ZISC
"RTN","RMPR5N2",84,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPR5N2",85,0)
 Q
"RTN","RMPR5N2",86,0)
NONE W !!,"NO DATA !!!!"
"RTN","RMPR5N2",87,0)
 Q
"RTN","RMPR5N3")
0^5^B19380215
"RTN","RMPR5N3",1,0)
RMPR5N3 ;HIN/RVD-PRINT INVENTORY BALANCE BY HCPCS ;3/17/03  13:19
"RTN","RMPR5N3",2,0)
 ;;3.0;PROSTHETICS;**33,37,77**;Feb 09, 1996
"RTN","RMPR5N3",3,0)
 ;RVD 3/17/03 patch #77 - allow queing to p-message.  IO to ION.
"RTN","RMPR5N3",4,0)
 D DIV4^RMPRSIT I $D(Y),(Y<0) Q
"RTN","RMPR5N3",5,0)
 S X="NOW" D ^%DT D DD^%DT S RMDAT=Y
"RTN","RMPR5N3",6,0)
 ;
"RTN","RMPR5N3",7,0)
EN K ^TMP($J),RMPRI,RMPRFLG S RMPREND=0 D HOME^%ZIS S DIC="^RMPR(661.1,",DIC(0)="AEQM",DIC("S")="I $D(^RMPR(661.1,+Y,0)),($P(^(0),U,9)=1)"
"RTN","RMPR5N3",8,0)
EN1 R !!,"Enter 'ALL' for all HCPCS or 'RETURN' to select individual HCPCS: ",RMENTER:DTIME G:$D(DTOUT)!$D(DUOUT)!(RMENTER="^") EXIT1
"RTN","RMPR5N3",9,0)
 G:RMENTER["?" EN1
"RTN","RMPR5N3",10,0)
 S X=RMENTER X ^%ZOSF("UPPERCASE") S RMENTER=Y I RMENTER="ALL" S RMPRI(0)=1 G CONT
"RTN","RMPR5N3",11,0)
SEL W ! F RML=1:1 S DIC("A")="Select HCPCS "_RML_": " D ^DIC G:$D(DTOUT)!(X["^")!(X=""&(RML=1)) EXIT1 Q:X=""  D
"RTN","RMPR5N3",12,0)
 .S RMI=$P(^RMPR(661.1,+Y,0),U,1)
"RTN","RMPR5N3",13,0)
 .I $D(RMPRI(RMI)) W $C(7)," ??",?40,"..Duplicate HCPCS" S RML=RML-1 Q
"RTN","RMPR5N3",14,0)
 .S RMPRI(RMI)=+Y
"RTN","RMPR5N3",15,0)
CONT G:'$D(RMPRI) EXIT1 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT1 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPR5N3",16,0)
 K IO("Q") S ZTDESC="PROSTHETIC INVENTORY LOCATION SUMMARY",ZTRTN="PRINT^RMPR5N3",ZTIO=ION,ZTSAVE("RMPRI(")="",ZTSAVE("RMPR(""STA"")")="",ZTSAVE("RMDAT")="",ZTSAVE("RMPR(")=""
"RTN","RMPR5N3",17,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT
"RTN","RMPR5N3",18,0)
 ;
"RTN","RMPR5N3",19,0)
PRINT I $E(IOST)["C" W !!,"Processing report......."
"RTN","RMPR5N3",20,0)
 S RMPAGE=1,(RMTOBAL,RMPREND)=0,RS=RMPR("STA") M ^TMP($J,"RM")=RMPRI
"RTN","RMPR5N3",21,0)
 D:$D(RMPRI(0)) ALL
"RTN","RMPR5N3",22,0)
 I '$D(^TMP($J,"RM")) D NONE G EXIT
"RTN","RMPR5N3",23,0)
 S RB="" F  S RB=$O(^TMP($J,"RM",RB)) Q:RB=""  S RMLIEN=^TMP($J,"RM",RB) D
"RTN","RMPR5N3",24,0)
 .S J=0 F  S J=$O(^RMPR(661.3,"C",RMLIEN,J)) Q:J'>0  S R63=$G(^RMPR(661.3,J,0)) I R63'="" S RMLO=$P(R63,U,1) S R3=$O(^RMPR(661.3,"C",RMLIEN,J,0)) I R3 D
"RTN","RMPR5N3",25,0)
 ..F R4=0:0 S R4=$O(^RMPR(661.3,J,1,R3,1,R4)) Q:R4'>0  Q:$P(R63,U,3)'=RS  D
"RTN","RMPR5N3",26,0)
 ...S RM3=$G(^RMPR(661.3,J,1,R3,1,R4,0)) Q:RM3=""
"RTN","RMPR5N3",27,0)
 ...S RMIT=$P(RM3,U,1),RMHCPC=$P(RMIT,"-",1),RMDAIT=$P(RMIT,"-",2)
"RTN","RMPR5N3",28,0)
 ...S RMITEM=$P($G(^RMPR(661.1,RMLIEN,3,RMDAIT,0)),U,1) Q:RMITEM=""
"RTN","RMPR5N3",29,0)
 ...S RMUNI=$P(RM3,U,4),RMRLE=$P(RM3,U,6),RMDI=$P(RM3,U,7),RMSO=$P(RM3,U,9),RMAV=$P(RM3,U,10)
"RTN","RMPR5N3",30,0)
 ...S RMBA=$P(RM3,U,2),RMCO=$P(RM3,U,3),RMVE=$P(RM3,U,5)
"RTN","RMPR5N3",31,0)
 ...S ^TMP($J,RB,RMITEM,RMLO)=RMAV_"^"_RMVE_"^^"_RMUNI_"^"_RMRLE_"^"_RMDI_"^"_RMSO_"^"_RMBA_"^"_RMCO
"RTN","RMPR5N3",32,0)
 W:$E(IOST)["C" @IOF
"RTN","RMPR5N3",33,0)
 D HEAD,WRI D:RMSUF TOTAL G EXIT
"RTN","RMPR5N3",34,0)
 ;write/print report
"RTN","RMPR5N3",35,0)
WRI S RP="",RMSUF=0 D HEAD1
"RTN","RMPR5N3",36,0)
 F  S RP=$O(^TMP($J,RP)) Q:(RP="")!(RMPREND)  D:RMSUF TOTAL K RMPRFLG F  S J=$O(^TMP($J,RP,J)) Q:(J="")!(RMPREND)  S K="",RSA=RP F  S K=$O(^TMP($J,RP,J,K)) Q:(K="")!(RMPREND)  D
"RTN","RMPR5N3",37,0)
 .S RMAST="",RMTMP=^TMP($J,RP,J,K),RMVE=$P(RMTMP,U,2)
"RTN","RMPR5N3",38,0)
 .S RMUNI=$P(RMTMP,U,4),RMRLE=$P(RMTMP,U,5),RMDI=$P(RMTMP,U,6),RMSO=$P(RMTMP,U,7),RMBA=$P(RMTMP,U,8),RMCO=$P(RMTMP,U,9),RMAV=$P(RMTMP,U,1)
"RTN","RMPR5N3",39,0)
 .S RMITEM=J,RMLOC=K,RMSUF=1,RMTOBAL=RMTOBAL+RMBA
"RTN","RMPR5N3",40,0)
 .S:RMUNI RMUNI=$P(^PRCD(420.5,RMUNI,0),U,1)
"RTN","RMPR5N3",41,0)
 .S:RMVE RMVE=$P($G(^PRC(440,RMVE,0)),U,1)
"RTN","RMPR5N3",42,0)
 .S RMITEM=$E(RMITEM,1,20)
"RTN","RMPR5N3",43,0)
 .S:RMBA<RMRLE RMAST="*"
"RTN","RMPR5N3",44,0)
 .W !,RP,?9,RMITEM,?30,RMSO,?33,$E(RMLOC,1,8),?42,$E(RMVE,1,11),?55,RMUNI,?58,$J(RMRLE,4),?64,$J(RMAV,8,2),?73,$J(RMBA,5),RMAST
"RTN","RMPR5N3",45,0)
 .S RMPRFLG=1
"RTN","RMPR5N3",46,0)
 .I $E(IOST)["C"&($Y>(IOSL-7)) S DIR(0)="E" D ^DIR S:$D(DTOUT)!(Y=0) RMPREND=1 Q:RMPREND  W @IOF D HEAD,HEAD1 Q
"RTN","RMPR5N3",47,0)
 .I $Y>(IOSL-6) W @IOF D HEAD,HEAD1 K RMPRFLG Q
"RTN","RMPR5N3",48,0)
 Q
"RTN","RMPR5N3",49,0)
 ;
"RTN","RMPR5N3",50,0)
TOTAL W !,?71,"-------",!,?45,"Total ",RSA," balance = ",?71,$J(RMTOBAL,7),!,RMPR("L")
"RTN","RMPR5N3",51,0)
 S RMSUF=0,RMTOBAL=0
"RTN","RMPR5N3",52,0)
 Q
"RTN","RMPR5N3",53,0)
 ;
"RTN","RMPR5N3",54,0)
HEAD W !,"*** PROSTHETICS INVENTORY BALANCE BY HCPCS ***",?68,"PAGE: ",RMPAGE,!,"Run Date: ",RMDAT,?30,"station: ",$E($P($G(^DIC(4,RS,0)),U,1),1,20)
"RTN","RMPR5N3",55,0)
 S RMPAGE=RMPAGE+1
"RTN","RMPR5N3",56,0)
 Q
"RTN","RMPR5N3",57,0)
 ;
"RTN","RMPR5N3",58,0)
HEAD1 I $E(IOST)["C"&($Y>(IOSL-7)) S DIR(0)="E" D ^DIR S:$D(DTOUT)!(Y=0) RMPREND=1 Q:RMPREND  W @IOF D HEAD
"RTN","RMPR5N3",59,0)
 I $E(IOST)'["C"&($Y>(IOSL-6)) W @IOF D HEAD
"RTN","RMPR5N3",60,0)
 W !,RMPR("L")
"RTN","RMPR5N3",61,0)
 W !,?54,"UNIT",?60,"RE-"
"RTN","RMPR5N3",62,0)
 W !,?55,"OF",?59,"ORDER",?68,"AVG",?75,"CUR"
"RTN","RMPR5N3",63,0)
 W !,"HCPCS",?9,"ITEM",?29,"SRC",?33,"LOCATION",?42,"VENDOR",?53,"ISSUE",?59,"LEVEL",?68,"COST",?75,"BAL"
"RTN","RMPR5N3",64,0)
 W !,"-----",?9,"----",?29,"---",?33,"--------",?42,"------",?53,"-----",?59,"-----",?68,"----",?75,"---"
"RTN","RMPR5N3",65,0)
 S RMPRFLG=1
"RTN","RMPR5N3",66,0)
 Q
"RTN","RMPR5N3",67,0)
 ;
"RTN","RMPR5N3",68,0)
ALL ;process all items
"RTN","RMPR5N3",69,0)
 K RMPRI(0),^TMP($J,"RM")
"RTN","RMPR5N3",70,0)
 F I=0:0 S I=$O(^RMPR(661.1,I)) Q:I'>0  I $P(^RMPR(661.1,I,0),U,9)=1 S RMI=$P(^RMPR(661.1,I,0),U,1) S:RMI'="" ^TMP($J,"RM",RMI)=I
"RTN","RMPR5N3",71,0)
 Q
"RTN","RMPR5N3",72,0)
 ;
"RTN","RMPR5N3",73,0)
EXIT I $E(IOST)["C",'RMPREND W ! S DIR(0)="E" D ^DIR
"RTN","RMPR5N3",74,0)
EXIT1 D ^%ZISC
"RTN","RMPR5N3",75,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPR5N3",76,0)
 Q
"RTN","RMPR5N3",77,0)
NONE W !!,"NO DATA !!!!!"
"RTN","RMPR5N3",78,0)
 Q
"RTN","RMPR9DO")
0^37^B82327785
"RTN","RMPR9DO",1,0)
RMPR9DO ;HOIFO/HNC -  ORDER CONROL PROCESSING-REMOTE PROCEDURE ;9/8/03  07:12
"RTN","RMPR9DO",2,0)
 ;;3.0;PROSTHETICS;**59,77**;Feb 09, 1996
"RTN","RMPR9DO",3,0)
 ;
"RTN","RMPR9DO",4,0)
 ;8/5/03 Make sure no dups, HNC patch 77
"RTN","RMPR9DO",5,0)
 ;
"RTN","RMPR9DO",6,0)
A1(START,STOP,SITE,SORT,DATE,WHAT) ;entry point for rollup
"RTN","RMPR9DO",7,0)
 ;activated from (option name)
"RTN","RMPR9DO",8,0)
 I WHAT="S" D
"RTN","RMPR9DO",9,0)
 .S STN1=0
"RTN","RMPR9DO",10,0)
 .F  S STN1=$O(^RMPR(669.9,STN1)) Q:STN1'>0  D
"RTN","RMPR9DO",11,0)
 . .S SITE=STN1
"RTN","RMPR9DO",12,0)
 . .D A2
"RTN","RMPR9DO",13,0)
 I WHAT="ALL" G A2
"RTN","RMPR9DO",14,0)
 Q
"RTN","RMPR9DO",15,0)
EN(RESULT,DUZ,START,STOP,SITE,SORT,DATE) ; -- Broker callback to get list to display
"RTN","RMPR9DO",16,0)
A2 ;entry to send to PCM, WHAT=ALL or S for Summary Only
"RTN","RMPR9DO",17,0)
 N STRING,CLREND,COLUMN,ON,OFF
"RTN","RMPR9DO",18,0)
 Q:SORT=""
"RTN","RMPR9DO",19,0)
 Q:DATE=""
"RTN","RMPR9DO",20,0)
 Q:START=""
"RTN","RMPR9DO",21,0)
 Q:STOP=""
"RTN","RMPR9DO",22,0)
 Q:SITE=""
"RTN","RMPR9DO",23,0)
 I SITE'="ALL" S SITE=$P(^RMPR(669.9,SITE,0),U,2)
"RTN","RMPR9DO",24,0)
 K ^TMP($J)
"RTN","RMPR9DO",25,0)
 N RMPRA,CDATE,X
"RTN","RMPR9DO",26,0)
 K ADATE,PDAY,RMPRCD
"RTN","RMPR9DO",27,0)
 S VALMCNT=0,RRX=""
"RTN","RMPR9DO",28,0)
 ;if sort for open or pending include all regardless of date
"RTN","RMPR9DO",29,0)
 ;if sort for cancelled or closed include from date passed forward
"RTN","RMPR9DO",30,0)
 ;
"RTN","RMPR9DO",31,0)
 ;PPD# status=pending before date, total days create to 1st action
"RTN","RMPR9DO",32,0)
 ;MHD# manual totals days create to 1st action
"RTN","RMPR9DO",33,0)
 ;CHD# consult totals days create to 1st action
"RTN","RMPR9DO",34,0)
 ;PPDD# status=pending before date, total days in pending state, 1st
"RTN","RMPR9DO",35,0)
 ;      action to current date
"RTN","RMPR9DO",36,0)
 ;
"RTN","RMPR9DO",37,0)
 S (LINE,MHD1,MHD2,MHD3,MHD4,MHD5,CHD1,CHD2,CHD3,CHD4,CHD5,CLNK,MLNK)=0
"RTN","RMPR9DO",38,0)
 S (PPDAY,PPD,PPD1,PPD2,PPD3,PPD4,PPD5)=0
"RTN","RMPR9DO",39,0)
 S (PPDDAY,PPDD1,PPDD2,PPDD3,PPDD4,PPDD5)=0
"RTN","RMPR9DO",40,0)
 I SORT["O"!(SORT["P") D ALL
"RTN","RMPR9DO",41,0)
 I SORT["C"!(SORT["X") D DTFWD
"RTN","RMPR9DO",42,0)
 ;S LINE=LINE+1
"RTN","RMPR9DO",43,0)
 S ^TMP($J,"A1")="^^^^^^^^"_MHD1_U_MHD2_U_MHD3_U_MHD4_U_MHD5_"^^^^"_MLNK_U_0
"RTN","RMPR9DO",44,0)
 I $G(WHAT)="S" S RMPRXM(1)=MHD1_U_MHD2_U_MHD3_U_MHD4_U_MHD5_U_MLNK_U_0
"RTN","RMPR9DO",45,0)
 ;S LINE=LINE+1
"RTN","RMPR9DO",46,0)
 S ^TMP($J,"A2")="^^^^^^^^"_CHD1_U_CHD2_U_CHD3_U_CHD4_U_CHD5_"^^^^"_CLNK_U_1
"RTN","RMPR9DO",47,0)
 I $G(WHAT)="S" S RMPRXM(2)=CHD1_U_CHD2_U_CHD3_U_CHD4_U_CHD5_U_CLNK_U_1
"RTN","RMPR9DO",48,0)
 ;S LINE=LINE+1
"RTN","RMPR9DO",49,0)
 I $G(WHAT)="S" S RMPRXM(3)=PPD1_U_PPD2_U_PPD3_U_PPD4_U_PPD5_U_U_2
"RTN","RMPR9DO",50,0)
 S ^TMP($J,"A3")="^^^^^^^^"_PPDD1_U_PPDD2_U_PPDD3_U_PPDD4_U_PPDD5_"^^^^^"_2
"RTN","RMPR9DO",51,0)
 ;S LINE=LINE+1
"RTN","RMPR9DO",52,0)
 S ^TMP($J,"A4")="^^^^^^^^"_PPD1_U_PPD2_U_PPD3_U_PPD4_U_PPD5_"^^^^^"_3
"RTN","RMPR9DO",53,0)
 ;quarter rollup with full data
"RTN","RMPR9DO",54,0)
 I $G(WHAT)="Q" D MAIL
"RTN","RMPR9DO",55,0)
 ;summary only
"RTN","RMPR9DO",56,0)
 I $G(WHAT)="S" D MAILG
"RTN","RMPR9DO",57,0)
 I $G(WHAT)="ALL" D MAILG,MAIL
"RTN","RMPR9DO",58,0)
 I '$G(WHAT) G EXIT
"RTN","RMPR9DO",59,0)
 Q
"RTN","RMPR9DO",60,0)
ALL ;all open pending records regardless of date passed
"RTN","RMPR9DO",61,0)
 S RMPRI1=0
"RTN","RMPR9DO",62,0)
 F RMPRI1=START:1:STOP D
"RTN","RMPR9DO",63,0)
 .I $L(RMPRI1)=1 S RMPRI=0_RMPRI1
"RTN","RMPR9DO",64,0)
 .E  S RMPRI=RMPRI1
"RTN","RMPR9DO",65,0)
 .S RMPRST=""
"RTN","RMPR9DO",66,0)
 .F  S RMPRST=$O(^RMPR(668,"L1",RMPRI,RMPRST)) Q:RMPRST=""  D
"RTN","RMPR9DO",67,0)
 . .Q:RMPRST="X"
"RTN","RMPR9DO",68,0)
 . .Q:RMPRST="C"
"RTN","RMPR9DO",69,0)
 . .I SORT'["P"&(RMPRST="P") Q
"RTN","RMPR9DO",70,0)
 . .S RMPRA=0
"RTN","RMPR9DO",71,0)
 . .F  S RMPRA=$O(^RMPR(668,"L1",RMPRI,RMPRST,RMPRA)) Q:RMPRA'>0  D
"RTN","RMPR9DO",72,0)
 . . .S STN=$P(^RMPR(668,RMPRA,0),U,7)
"RTN","RMPR9DO",73,0)
 . . .I SITE'="ALL"&(SITE'=STN) Q
"RTN","RMPR9DO",74,0)
 . . .S STNX=$$STATN^RMPRUTIL(STN)
"RTN","RMPR9DO",75,0)
 . . .I $G(WHAT)="S" S VISNX=$P($G(^RMPR(669.9,STN1,"INV")),U,2)
"RTN","RMPR9DO",76,0)
 . . .S STS=$P(^RMPR(668,RMPRA,0),U,10)
"RTN","RMPR9DO",77,0)
 . . .Q:STS["X"
"RTN","RMPR9DO",78,0)
 . . .Q:STS["C"
"RTN","RMPR9DO",79,0)
 . . .I SORT'["O"&(STS="O") Q
"RTN","RMPR9DO",80,0)
 . . .I SORT'["P"&(STS="P") Q
"RTN","RMPR9DO",81,0)
 . . .D REC
"RTN","RMPR9DO",82,0)
 Q
"RTN","RMPR9DO",83,0)
DTFWD ;from date passed forward
"RTN","RMPR9DO",84,0)
 S RMPRI1=0
"RTN","RMPR9DO",85,0)
 F RMPRI1=START:1:STOP D
"RTN","RMPR9DO",86,0)
 .I $L(RMPRI1)=1 S RMPRI=0_RMPRI1
"RTN","RMPR9DO",87,0)
 .E  S RMPRI=RMPRI1
"RTN","RMPR9DO",88,0)
 .S RMPRDTM=""
"RTN","RMPR9DO",89,0)
 .F  S RMPRDTM=$O(^RMPR(668,"L",RMPRI,RMPRDTM)) Q:RMPRDTM=""  D
"RTN","RMPR9DO",90,0)
 ..Q:RMPRDTM=""
"RTN","RMPR9DO",91,0)
 ..Q:RMPRDTM<DATE
"RTN","RMPR9DO",92,0)
 ..S RMPRST=""
"RTN","RMPR9DO",93,0)
 ..F  S RMPRST=$O(^RMPR(668,"L",RMPRI,RMPRDTM,RMPRST)) Q:RMPRST=""  D
"RTN","RMPR9DO",94,0)
 .. .Q:RMPRST="O"
"RTN","RMPR9DO",95,0)
 .. .Q:RMPRST="P"
"RTN","RMPR9DO",96,0)
 .. .I SORT'["X"&(RMPRST="X") Q
"RTN","RMPR9DO",97,0)
 .. .I SORT'["C"&(RMPRST="C") Q
"RTN","RMPR9DO",98,0)
 .. .S RMPRA=0
"RTN","RMPR9DO",99,0)
 .. .F  S RMPRA=$O(^RMPR(668,"L",RMPRI,RMPRDTM,RMPRST,RMPRA)) Q:RMPRA'>0  D
"RTN","RMPR9DO",100,0)
 .. . .Q:RMPRA=""
"RTN","RMPR9DO",101,0)
 .. . .S STN=$P(^RMPR(668,RMPRA,0),U,7)
"RTN","RMPR9DO",102,0)
 .. . .I SITE'="ALL"&(SITE'=STN) Q
"RTN","RMPR9DO",103,0)
 .. . .S STNX=$$STATN^RMPRUTIL(STN)
"RTN","RMPR9DO",104,0)
 .. . .I $G(WHAT)'="" S VISNX=$P($G(^RMPR(669.9,SITE,"INV")),U,2)
"RTN","RMPR9DO",105,0)
 .. . .S STS=$P(^RMPR(668,RMPRA,0),U,10)
"RTN","RMPR9DO",106,0)
 .. . .Q:STS["O"
"RTN","RMPR9DO",107,0)
 .. . .Q:STS["P"
"RTN","RMPR9DO",108,0)
 .. . .I SORT'["C"&(STS="C") Q
"RTN","RMPR9DO",109,0)
 .. . .I SORT'["X"&(STS="X") Q
"RTN","RMPR9DO",110,0)
 .. . .D REC
"RTN","RMPR9DO",111,0)
 S RMPRDTC=$P(DATE,".",1)
"RTN","RMPR9DO",112,0)
 F  S RMPRDTC=$O(^RMPR(668,"CD",RMPRDTC)) Q:RMPRDTC=""  D
"RTN","RMPR9DO",113,0)
 .Q:RMPRDTC<DATE
"RTN","RMPR9DO",114,0)
 .S RMPRDYS=0
"RTN","RMPR9DO",115,0)
 .F  S RMPRDYS=$O(^RMPR(668,"CD",RMPRDTC,RMPRDYS)) Q:RMPRDYS=""  D
"RTN","RMPR9DO",116,0)
 . .Q:RMPRDYS'>5
"RTN","RMPR9DO",117,0)
 . .S RMPRA=0
"RTN","RMPR9DO",118,0)
 . .F  S RMPRA=$O(^RMPR(668,"CD",RMPRDTC,RMPRDYS,RMPRA)) Q:RMPRA'>0  D
"RTN","RMPR9DO",119,0)
 . . .;check site
"RTN","RMPR9DO",120,0)
 . . .S STN=$P(^RMPR(668,RMPRA,0),U,7)
"RTN","RMPR9DO",121,0)
 . . .I SITE'="ALL"&(SITE'=STN) Q
"RTN","RMPR9DO",122,0)
 . . .S STNX=$$STATN^RMPRUTIL(STN)
"RTN","RMPR9DO",123,0)
 . . .;check status
"RTN","RMPR9DO",124,0)
 . . .S STS=$P(^RMPR(668,RMPRA,0),U,10)
"RTN","RMPR9DO",125,0)
 . . .I SORT'["O"&(STS="O") Q
"RTN","RMPR9DO",126,0)
 . . .I SORT'["P"&(STS="P") Q
"RTN","RMPR9DO",127,0)
 . . .I SORT'["C"&(STS="C") Q
"RTN","RMPR9DO",128,0)
 . . .I SORT'["X"&(STS="X") Q
"RTN","RMPR9DO",129,0)
 . . .;ssn range filter
"RTN","RMPR9DO",130,0)
 . . .S DFN=$P(^RMPR(668,RMPRA,0),U,2)
"RTN","RMPR9DO",131,0)
 . . .D DEM^VADPT
"RTN","RMPR9DO",132,0)
 . . .S SSNEN=$E($P(VADM(2),"^",2),10,11)
"RTN","RMPR9DO",133,0)
 . . .I SSNEN>STOP Q
"RTN","RMPR9DO",134,0)
 . . .I SSNEN<START Q
"RTN","RMPR9DO",135,0)
 . . .K SSNEN,VADM
"RTN","RMPR9DO",136,0)
 . . .D REC
"RTN","RMPR9DO",137,0)
 Q
"RTN","RMPR9DO",138,0)
REC ;records to grid
"RTN","RMPR9DO",139,0)
 ;stop date, init action date
"RTN","RMPR9DO",140,0)
 ;check ien, patch 77
"RTN","RMPR9DO",141,0)
 ;
"RTN","RMPR9DO",142,0)
 Q:$D(^TMP($J,RMPRA))
"RTN","RMPR9DO",143,0)
 ;
"RTN","RMPR9DO",144,0)
 N DIC,DIQ,DR,STOPDT
"RTN","RMPR9DO",145,0)
 S DA=RMPRA
"RTN","RMPR9DO",146,0)
 S DIC=668,DIQ="RE",DR=10,DIQ(0)="EN" D EN^DIQ1
"RTN","RMPR9DO",147,0)
 S STOPDT=$P($G(^RMPR(668,RMPRA,0)),U,9),STOPDT=$$DAT2^RMPRUTL1(STOPDT)
"RTN","RMPR9DO",148,0)
 S LINE=LINE+1
"RTN","RMPR9DO",149,0)
 S CDATE=$P(^RMPR(668,RMPRA,0),U,1),CDATE=$$DAT2^RMPRUTL1(CDATE)
"RTN","RMPR9DO",150,0)
 S DFN=$P(^RMPR(668,RMPRA,0),U,2) Q:DFN=""
"RTN","RMPR9DO",151,0)
 N VA,VADM
"RTN","RMPR9DO",152,0)
 D DEM^VADPT
"RTN","RMPR9DO",153,0)
 S WHO=VADM(1)
"RTN","RMPR9DO",154,0)
 S SSN=VADM(2)
"RTN","RMPR9DO",155,0)
 D KVAR^VADPT
"RTN","RMPR9DO",156,0)
 ;type
"RTN","RMPR9DO",157,0)
 S TYPE=$$TYPE^RMPREOU(RMPRA,8)
"RTN","RMPR9DO",158,0)
 ;display description if manual
"RTN","RMPR9DO",159,0)
 S DES=$$DES^RMPREOU(RMPRA,22)
"RTN","RMPR9DO",160,0)
 S DES=$TR(DES,"^","*")
"RTN","RMPR9DO",161,0)
 S DES=$TR(DES,"""","'")
"RTN","RMPR9DO",162,0)
 ;init action date
"RTN","RMPR9DO",163,0)
 S ADATE="",PDAY="",WRKDAY=""
"RTN","RMPR9DO",164,0)
 S ADATE=$P(^RMPR(668,RMPRA,0),U,9)
"RTN","RMPR9DO",165,0)
 ;PPD=1 for previous pending
"RTN","RMPR9DO",166,0)
 I ADATE'="" S (PDAY,WRKDAY)=$$WRKDAY^RMPREOU(RMPRA)
"RTN","RMPR9DO",167,0)
 I ADATE="" S (PDAY,WRKDAY)=$$CWRKDAY^RMPREOU(RMPRA)
"RTN","RMPR9DO",168,0)
 I ADATE'="" S CDAY=$$PDAY^RMPREOU(RMPRA)
"RTN","RMPR9DO",169,0)
 ;
"RTN","RMPR9DO",170,0)
 S STATUS=$$STATUS^RMPREOU(RMPRA)
"RTN","RMPR9DO",171,0)
 I STATUS["PENDING" D
"RTN","RMPR9DO",172,0)
 .I ADATE'=""&(ADATE<DATE) S PPD=1
"RTN","RMPR9DO",173,0)
 .S PPDAY=$$PWRKDAY^RMPREOU(RMPRA)
"RTN","RMPR9DO",174,0)
 S LINKED=$P($G(^RMPR(668,RMPRA,10,0)),U,4)
"RTN","RMPR9DO",175,0)
 I LINKED="" S LINKED=0
"RTN","RMPR9DO",176,0)
 ;
"RTN","RMPR9DO",177,0)
 S ^TMP($J,RMPRA)=CDATE_U_WHO_U_SSN_U_TYPE_U_DES_U
"RTN","RMPR9DO",178,0)
 ;look at pday and parse
"RTN","RMPR9DO",179,0)
 S (HD1,HD2,HD3,HD4,HD5,DH6)=""
"RTN","RMPR9DO",180,0)
 ;SD Working Days in Pending Status
"RTN","RMPR9DO",181,0)
 S (SD1,SD2,SD3,SD4,SD5)=0
"RTN","RMPR9DO",182,0)
 I (PDAY>0)&(PDAY<6)!(PDAY=0) S HD1=PDAY,DH6="NO"
"RTN","RMPR9DO",183,0)
 I (PPDAY>0)&(PPDAY<6)!(PPDAY=0) S SD1=PPDAY
"RTN","RMPR9DO",184,0)
 I (PDAY>0)&(PDAY<6)&(TYPE["MANUAL")!(PDAY=0)&(TYPE["MANUAL") S MHD1=MHD1+1
"RTN","RMPR9DO",185,0)
 I (PDAY>0)&(PDAY<6)&(TYPE'["MANUAL")!(PDAY=0)&(TYPE'["MANUAL") S CHD1=CHD1+1
"RTN","RMPR9DO",186,0)
 I (PPDAY>0)&(PPDAY<6)&(STATUS["PENDING") S PPDD1=PPDD1+1
"RTN","RMPR9DO",187,0)
 I (PDAY>0)&(PDAY<6)&(PPD=1) S PPD1=PPD1+1
"RTN","RMPR9DO",188,0)
 I HD1=""  S HD1=0
"RTN","RMPR9DO",189,0)
 I (PDAY>5)&(PDAY<10) S HD2=PDAY,DH6="YES"
"RTN","RMPR9DO",190,0)
 I (PPDAY>5)&(PPDAY<10) S SD2=PPDAY
"RTN","RMPR9DO",191,0)
 I (PDAY>5)&(PDAY<10)&(TYPE["MANUAL") S MHD2=MHD2+1
"RTN","RMPR9DO",192,0)
 I (PDAY>5)&(PDAY<10)&(TYPE'["MANUAL") S CHD2=CHD2+1
"RTN","RMPR9DO",193,0)
 I (PPDAY>5)&(PPDAY<10)&(STATUS["PENDING") S PPDD2=PPDD2+1
"RTN","RMPR9DO",194,0)
 I (PDAY>5)&(PDAY<10)&(PPD=1) S PPD2=PPD2+1
"RTN","RMPR9DO",195,0)
 I HD2="" S HD2=0
"RTN","RMPR9DO",196,0)
 I (PDAY>9)&(PDAY<30) S HD3=PDAY,DH6="YES"
"RTN","RMPR9DO",197,0)
 I (PPDAY>9)&(PPDAY<30) S SD3=PPDAY
"RTN","RMPR9DO",198,0)
 I (PDAY>9)&(PDAY<30)&(TYPE["MANUAL") S MHD3=MHD3+1
"RTN","RMPR9DO",199,0)
 I (PDAY>9)&(PDAY<30)&(TYPE'["MANUAL") S CHD3=CHD3+1
"RTN","RMPR9DO",200,0)
 I (PPDAY>9)&(PPDAY<30)&(STATUS["PENDING") S PPDD3=PPDD3+1
"RTN","RMPR9DO",201,0)
 I (PDAY>9)&(PDAY<30)&(PPD=1) S PPD3=PPD3+1
"RTN","RMPR9DO",202,0)
 I HD3="" S HD3=0
"RTN","RMPR9DO",203,0)
 I (PDAY>29)&(PDAY<90) S HD4=PDAY,DH6="YES"
"RTN","RMPR9DO",204,0)
 I (PPDAY>29)&(PPDAY<90) S SD4=PPDAY
"RTN","RMPR9DO",205,0)
 I (PDAY>29)&(PDAY<90)&(TYPE["MANUAL") S MHD4=MHD4+1
"RTN","RMPR9DO",206,0)
 I (PDAY>29)&(PDAY<90)&(TYPE'["MANUAL") S CHD4=CHD4+1
"RTN","RMPR9DO",207,0)
 I (PPDAY>29)&(PPDAY<90)&(STATUS["PENDING") S PPDD4=PPDD4+1
"RTN","RMPR9DO",208,0)
 I (PDAY>29)&(PDAY<90)&(PPD=1) S PPD4=PPD4+1
"RTN","RMPR9DO",209,0)
 I HD4="" S HD4=0
"RTN","RMPR9DO",210,0)
 I PDAY>89 S HD5=PDAY,DH6="YES"
"RTN","RMPR9DO",211,0)
 I PPDAY>89 S SD5=PPDAY
"RTN","RMPR9DO",212,0)
 I (PDAY>89)&(TYPE["MANUAL") S MHD5=MHD5+1
"RTN","RMPR9DO",213,0)
 I (PDAY>89)&(TYPE'["MANUAL") S CHD5=CHD5+1
"RTN","RMPR9DO",214,0)
 I (PPDAY>89)&(STATUS["PENDING") S PPDD5=PPDD5+1
"RTN","RMPR9DO",215,0)
 I (PDAY>89)&(PPD=1) S PPD5=PPD5+1
"RTN","RMPR9DO",216,0)
 I HD5="" S HD5=0
"RTN","RMPR9DO",217,0)
 S (PPD,PPDAY)=0
"RTN","RMPR9DO",218,0)
 I LINKED'=0&(TYPE["MANUAL") S MLNK=MLNK+1
"RTN","RMPR9DO",219,0)
 I LINKED'=0&(TYPE'["MANUAL") S CLNK=CLNK+1
"RTN","RMPR9DO",220,0)
 S ^TMP($J,RMPRA)=^TMP($J,RMPRA)_STOPDT_U_DH6_U_HD1_U_HD2_U_HD3_U_HD4_U_HD5
"RTN","RMPR9DO",221,0)
 S ^TMP($J,RMPRA)=^TMP($J,RMPRA)_U_STATUS_U_RMPRA_U_STNX_U_LINKED
"RTN","RMPR9DO",222,0)
 S ^TMP($J,RMPRA)=^TMP($J,RMPRA)_U_U_SD1_U_SD2_U_SD3_U_SD4_U_SD5
"RTN","RMPR9DO",223,0)
 K CDATE,WHO,SSN,TYPE,DES,PDAY,STATUS,ADATE
"RTN","RMPR9DO",224,0)
 ;PUT RESULTS IN GLOBAL!!
"RTN","RMPR9DO",225,0)
 Q
"RTN","RMPR9DO",226,0)
EXIT ;common exit point
"RTN","RMPR9DO",227,0)
 S RESULT=$NA(^TMP($J))
"RTN","RMPR9DO",228,0)
 Q
"RTN","RMPR9DO",229,0)
MAIL ;send to PCM full dataset
"RTN","RMPR9DO",230,0)
 S XMY("G.RMPR SERVER")=""
"RTN","RMPR9DO",231,0)
 S XMY("G.PROSTHETICS@PSAS.MED.VA.GOV")=""
"RTN","RMPR9DO",232,0)
 S XMDUZ=.5
"RTN","RMPR9DO",233,0)
 S XMSUB="Full DOR From Station: "_STNX
"RTN","RMPR9DO",234,0)
 N LASTIEN
"RTN","RMPR9DO",235,0)
 S LASTIEN="A1",LASTIEN=$O(^TMP($J,LASTIEN),-1)
"RTN","RMPR9DO",236,0)
 S ^TMP($J,LASTIEN+1)=^TMP($J,"A1")
"RTN","RMPR9DO",237,0)
 S ^TMP($J,LASTIEN+2)=^TMP($J,"A2")
"RTN","RMPR9DO",238,0)
 S ^TMP($J,LASTIEN+3)=^TMP($J,"A3")
"RTN","RMPR9DO",239,0)
 S ^TMP($J,LASTIEN+4)=^TMP($J,"A4")
"RTN","RMPR9DO",240,0)
 K ^TMP($J,"A1")
"RTN","RMPR9DO",241,0)
 K ^TMP($J,"A2")
"RTN","RMPR9DO",242,0)
 K ^TMP($J,"A3")
"RTN","RMPR9DO",243,0)
 K ^TMP($J,"A4")
"RTN","RMPR9DO",244,0)
 S XMTEXT="^TMP($J,"
"RTN","RMPR9DO",245,0)
 D ^XMD
"RTN","RMPR9DO",246,0)
 Q
"RTN","RMPR9DO",247,0)
MAILG ;Mail message to local staff
"RTN","RMPR9DO",248,0)
 S XMDUZ=.5
"RTN","RMPR9DO",249,0)
 S XMY("G.RMPR SERVER")=""
"RTN","RMPR9DO",250,0)
 S XMY("VHACOPSASPIPReport@MED.VA.GOV")=""
"RTN","RMPR9DO",251,0)
 S XMSUB="DOR From Station: "_STNX
"RTN","RMPR9DO",252,0)
 S RMPRMSG(1)="The Automated Delayed Order Report has transmitted to Prosthetics HQ."
"RTN","RMPR9DO",253,0)
 S RMPRMSG(2)="This was activated by "_$P(XMFROM,"@",1)
"RTN","RMPR9DO",254,0)
 S RMPRMSG(3)=""
"RTN","RMPR9DO",255,0)
 S RMPRMSG(4)="Summary Data Transmitted, includes the following:"
"RTN","RMPR9DO",256,0)
 S RMPRMSG(5)="Totals for site "_STNX_" listed in the order of 0-5, 6-9, 10-29, 30-89, 90+"
"RTN","RMPR9DO",257,0)
 S RMPRMSG(6)="Seperated by ;"
"RTN","RMPR9DO",258,0)
 S RMPRMSG(7)="***Number of MANUALS      ;;"_STNX_";"_MHD1_";"_MHD2_";"_MHD3_";"_MHD4_";"_MHD5
"RTN","RMPR9DO",259,0)
 S RMPRMSG(8)="***Number of CONSULTS     ;;"_STNX_";"_CHD1_";"_CHD2_";"_CHD3_";"_CHD4_";"_CHD5
"RTN","RMPR9DO",260,0)
 S RMPRMSG(9)="***Minus Previous Pending ;;"_STNX_";"_PPD1_";"_PPD2_";"_PPD3_";"_PPD4_";"_PPD5
"RTN","RMPR9DO",261,0)
 S RMPRMSG(10)=""
"RTN","RMPR9DO",262,0)
 S XMTEXT="RMPRMSG("
"RTN","RMPR9DO",263,0)
 D ^XMD
"RTN","RMPR9DO",264,0)
 Q
"RTN","RMPR9LNP")
0^38^B6402289
"RTN","RMPR9LNP",1,0)
RMPR9LNP ;Hines OIFO/HNC - REMOTE PROCEDURE, LIST NPPD DATA ;9/8/03  07:23
"RTN","RMPR9LNP",2,0)
 ;;3.0;PROSTHETICS;**71,77**;Feb 09, 1996
"RTN","RMPR9LNP",3,0)
 ;
"RTN","RMPR9LNP",4,0)
 ;    HNC - Sept 2, 2003 - patch 77 remove the " for Excel CSV
"RTN","RMPR9LNP",5,0)
 ;
"RTN","RMPR9LNP",6,0)
 ;RESULTS passed to broker in ^TMP($J,
"RTN","RMPR9LNP",7,0)
 ;delimited by "^"
"RTN","RMPR9LNP",8,0)
 ;piece 1 = ENTRY DATE
"RTN","RMPR9LNP",9,0)
 ;piece 2 = PATIENT NAME
"RTN","RMPR9LNP",10,0)
 ;piece 3 = PSAS HCPCS with * if hcpcs has Calculation Flag
"RTN","RMPR9LNP",11,0)
 ;piece 4 = QTY
"RTN","RMPR9LNP",12,0)
 ;piece 5 = VENDOR
"RTN","RMPR9LNP",13,0)
 ;piece 6 = INITIAL ACTION DATE
"RTN","RMPR9LNP",14,0)
 ;piece 7 = TOTAL COST
"RTN","RMPR9LNP",15,0)
 ;piece 8 = DESCRIPTION
"RTN","RMPR9LNP",16,0)
 ;piece 9 = INITIATOR
"RTN","RMPR9LNP",17,0)
 ;piece 10 = NPPD LINE BEFORE GROUPER
"RTN","RMPR9LNP",18,0)
 ;piece 11 = STATION
"RTN","RMPR9LNP",19,0)
 ;piece 12 = GROUPER NUMBER
"RTN","RMPR9LNP",20,0)
 ;piece 13 = FORM REQUESTED ON
"RTN","RMPR9LNP",21,0)
 ;piece 14 = TYPE OF TRANSACTION
"RTN","RMPR9LNP",22,0)
 ;piece 15 = SSN
"RTN","RMPR9LNP",23,0)
 ;piece 16 = IEN TO FILE 660
"RTN","RMPR9LNP",24,0)
 ;piece 17 = HCPCS SHORT DESCRIPTION
"RTN","RMPR9LNP",25,0)
 ;piece 18 = SOURCE
"RTN","RMPR9LNP",26,0)
 Q
"RTN","RMPR9LNP",27,0)
 ;
"RTN","RMPR9LNP",28,0)
EN(RESULT,DATE1,DATE2) ;broker entry point
"RTN","RMPR9LNP",29,0)
 ;
"RTN","RMPR9LNP",30,0)
 K ^TMP($J)
"RTN","RMPR9LNP",31,0)
 I '$D(DATE1)!('$D(DATE2)) G EXIT
"RTN","RMPR9LNP",32,0)
 S DATE=DATE1-1
"RTN","RMPR9LNP",33,0)
 F  S DATE=$O(^RMPR(660,"B",DATE)) Q:(DATE="")!($P(DATE,".",1)>DATE2)  D
"RTN","RMPR9LNP",34,0)
 .S RMPRB=0
"RTN","RMPR9LNP",35,0)
 .F  S RMPRB=$O(^RMPR(660,"B",DATE,RMPRB)) Q:RMPRB=""  D
"RTN","RMPR9LNP",36,0)
 ..Q:$P(^RMPR(660,RMPRB,0),U,15)["*"
"RTN","RMPR9LNP",37,0)
 ..S PHCPCS=$P($G(^RMPR(660,RMPRB,1)),U,4)
"RTN","RMPR9LNP",38,0)
 ..Q:PHCPCS=""
"RTN","RMPR9LNP",39,0)
 ..Q:PHCPCS'>0
"RTN","RMPR9LNP",40,0)
 ..S HDES=$P(^RMPR(661.1,PHCPCS,0),U,2)
"RTN","RMPR9LNP",41,0)
 ..S TYPE=$P($G(^RMPR(660,RMPRB,0)),U,4)
"RTN","RMPR9LNP",42,0)
 ..I TYPE'="X" S LINE=$P(^RMPR(661.1,PHCPCS,0),U,7)
"RTN","RMPR9LNP",43,0)
 ..I TYPE="X" S LINE=$P(^RMPR(661.1,PHCPCS,0),U,6)
"RTN","RMPR9LNP",44,0)
 ..S CAL=$P(^RMPR(661.1,PHCPCS,0),U,8)
"RTN","RMPR9LNP",45,0)
 ..I CAL'="" S CAL="*"
"RTN","RMPR9LNP",46,0)
 ..S DFN=$P(^RMPR(660,RMPRB,0),U,2)
"RTN","RMPR9LNP",47,0)
 ..D DEM^VADPT
"RTN","RMPR9LNP",48,0)
 ..D DATA
"RTN","RMPR9LNP",49,0)
 S RESULT=$NA(^TMP($J))
"RTN","RMPR9LNP",50,0)
 Q
"RTN","RMPR9LNP",51,0)
 ;
"RTN","RMPR9LNP",52,0)
DATA ;
"RTN","RMPR9LNP",53,0)
 S B=RMPRB
"RTN","RMPR9LNP",54,0)
 D GETS^DIQ(660,B,".01;.02;4.5;5;7;8;8.3;11;12;14;24;27;68","","RMXM")
"RTN","RMPR9LNP",55,0)
 S $P(^TMP($J,B),U,1)=$G(RMXM(660,B_",",.01))
"RTN","RMPR9LNP",56,0)
 S $P(^TMP($J,B),U,2)=$G(RMXM(660,B_",",.02))
"RTN","RMPR9LNP",57,0)
 S $P(^TMP($J,B),U,3)=$G(RMXM(660,B_",",4.5))_CAL
"RTN","RMPR9LNP",58,0)
 S $P(^TMP($J,B),U,4)=$G(RMXM(660,B_",",5))
"RTN","RMPR9LNP",59,0)
 S $P(^TMP($J,B),U,5)=$G(RMXM(660,B_",",7))
"RTN","RMPR9LNP",60,0)
 S $P(^TMP($J,B),U,6)=$G(RMXM(660,B_",",8.3))
"RTN","RMPR9LNP",61,0)
 S $P(^TMP($J,B),U,7)=$G(RMXM(660,B_",",14))
"RTN","RMPR9LNP",62,0)
 ;patch 77 remove the " for Excel CSV
"RTN","RMPR9LNP",63,0)
 S $P(^TMP($J,B),U,8)=$TR($G(RMXM(660,B_",",24)),"""","'")
"RTN","RMPR9LNP",64,0)
 S $P(^TMP($J,B),U,9)=$G(RMXM(660,B_",",27))
"RTN","RMPR9LNP",65,0)
 S $P(^TMP($J,B),U,10)=LINE
"RTN","RMPR9LNP",66,0)
 S $P(^TMP($J,B),U,11)=$G(RMXM(660,B_",",8))
"RTN","RMPR9LNP",67,0)
 S $P(^TMP($J,B),U,12)=$G(RMXM(660,B_",",68))
"RTN","RMPR9LNP",68,0)
 S $P(^TMP($J,B),U,13)=$G(RMXM(660,B_",",11))
"RTN","RMPR9LNP",69,0)
 S $P(^TMP($J,B),U,14)=TYPE
"RTN","RMPR9LNP",70,0)
 S $P(^TMP($J,B),U,15)=$P(VADM(2),U,2)
"RTN","RMPR9LNP",71,0)
 S $P(^TMP($J,B),U,16)=B
"RTN","RMPR9LNP",72,0)
 S $P(^TMP($J,B),U,17)=HDES
"RTN","RMPR9LNP",73,0)
 S $P(^TMP($J,B),U,18)=$E($G(RMXM(660,B_",",12)),0,1)
"RTN","RMPR9LNP",74,0)
 K RMXM,VADM,CAL
"RTN","RMPR9LNP",75,0)
 Q
"RTN","RMPR9LNP",76,0)
EXIT ;common exit point
"RTN","RMPR9LNP",77,0)
 Q
"RTN","RMPR9LNP",78,0)
 ;END
"RTN","RMPREO23")
0^30^B40224649
"RTN","RMPREO23",1,0)
RMPREO23 ;HINES/HNC ;suspense processing display protocols ;2-3-2000
"RTN","RMPREO23",2,0)
 ;;3.0;PROSTHETICS;**45,55,62,77**;Feb 09, 1996
"RTN","RMPREO23",3,0)
 ; RVD 1/16/01 #62 - added a selected range for linked suspense
"RTN","RMPREO23",4,0)
 ;                   for initial, post other and complete action only.
"RTN","RMPREO23",5,0)
 ;RVD patch #77 - check for ^tmp global and XRMPRDFN variable
"RTN","RMPREO23",6,0)
 Q
"RTN","RMPREO23",7,0)
DIS ;display 2319 action
"RTN","RMPREO23",8,0)
 S RMPRBAC1=1
"RTN","RMPREO23",9,0)
 D FULL^VALM1
"RTN","RMPREO23",10,0)
 S XRMPRDFN=RMPRDFN
"RTN","RMPREO23",11,0)
 D ^RMPRPAT
"RTN","RMPREO23",12,0)
 K RMPRBAC1,RMPRBACK
"RTN","RMPREO23",13,0)
 S VALMBCK="R"
"RTN","RMPREO23",14,0)
 Q:'$D(XRMPRDFN)
"RTN","RMPREO23",15,0)
 S (RMPRDFN,DFN)=XRMPRDFN D DEM^VADPT
"RTN","RMPREO23",16,0)
 S RMPRNAM=$P(VADM(1),U,1)
"RTN","RMPREO23",17,0)
 S RMPRDOB=$P(VADM(3),U,1)
"RTN","RMPREO23",18,0)
 S RMPRSSN=$P(VADM(2),U,1)
"RTN","RMPREO23",19,0)
 K VADM,XRMPRDFN
"RTN","RMPREO23",20,0)
 Q
"RTN","RMPREO23",21,0)
 ;
"RTN","RMPREO23",22,0)
CHG ;change patient
"RTN","RMPREO23",23,0)
 D FULL^VALM1
"RTN","RMPREO23",24,0)
 S XRMPRDFN=RMPRDFN
"RTN","RMPREO23",25,0)
 D GETPAT^RMPRUTIL
"RTN","RMPREO23",26,0)
 I '$D(RMPRDFN) S RMPRDFN=XRMPRDFN
"RTN","RMPREO23",27,0)
 D INIT^RMPREO
"RTN","RMPREO23",28,0)
 S VALMBCK="R"
"RTN","RMPREO23",29,0)
 Q
"RTN","RMPREO23",30,0)
CANCEL ;cancel suspense
"RTN","RMPREO23",31,0)
 D FULL^VALM1
"RTN","RMPREO23",32,0)
 D NUM^RMPREOU
"RTN","RMPREO23",33,0)
 S RMPREOY=Y
"RTN","RMPREO23",34,0)
 F RN=1:1 S XDA=$P(RMPREOY,",",RN) Q:XDA=""  Q:$G(DUOUT)=1  I $D(^TMP($J,"RMPREOEE",XDA,0)) S DA=^TMP($J,"RMPREOEE",XDA,0) D CANCEL^RMPREOS
"RTN","RMPREO23",35,0)
 K RMPREOY,XDA,DA,DUOUT
"RTN","RMPREO23",36,0)
 D INIT^RMPREO
"RTN","RMPREO23",37,0)
 S VALMBCK="R"
"RTN","RMPREO23",38,0)
 Q
"RTN","RMPREO23",39,0)
VIEW ;view consult request
"RTN","RMPREO23",40,0)
 N YY,DA,FLDS,DIC
"RTN","RMPREO23",41,0)
 D FULL^VALM1
"RTN","RMPREO23",42,0)
 D NUM^RMPREOU
"RTN","RMPREO23",43,0)
 I Y="" S VALMBCK="R"
"RTN","RMPREO23",44,0)
 ;
"RTN","RMPREO23",45,0)
 S RN=1,XDA=""
"RTN","RMPREO23",46,0)
 S RMPREOY=Y
"RTN","RMPREO23",47,0)
 F RN=1:1 S XDA=$P(RMPREOY,",",RN) Q:XDA=""  Q:$G(DUOUT)=1  D VIEWP
"RTN","RMPREO23",48,0)
 K RMPREOY,DUOUT
"RTN","RMPREO23",49,0)
 S VALMBCK="R"
"RTN","RMPREO23",50,0)
 Q
"RTN","RMPREO23",51,0)
VIEWP ;
"RTN","RMPREO23",52,0)
 ;
"RTN","RMPREO23",53,0)
 Q:'$D(^TMP($J,"RMPREOEE",XDA,0))
"RTN","RMPREO23",54,0)
 S DA=^TMP($J,"RMPREOEE",XDA,0)
"RTN","RMPREO23",55,0)
 S L=0
"RTN","RMPREO23",56,0)
 S DIC="^RMPR(668,",FLDS="[RMPR VIEW REQUEST]"
"RTN","RMPREO23",57,0)
 S BY="@NUMBER",(FR,TO)=DA
"RTN","RMPREO23",58,0)
 S IOP="HOME"
"RTN","RMPREO23",59,0)
 D EN1^DIP
"RTN","RMPREO23",60,0)
 N DIR S DIR(0)="E" D ^DIR
"RTN","RMPREO23",61,0)
 W @IOF
"RTN","RMPREO23",62,0)
 S DA=^TMP($J,"RMPREOEE",XDA,0)
"RTN","RMPREO23",63,0)
 D VALL^RMPREO24(DA,.L) Q:L="^"
"RTN","RMPREO23",64,0)
 Q
"RTN","RMPREO23",65,0)
 ;
"RTN","RMPREO23",66,0)
PDISP ;print consultaton sheet
"RTN","RMPREO23",67,0)
 D NUM^RMPREOU
"RTN","RMPREO23",68,0)
 D FULL^VALM1
"RTN","RMPREO23",69,0)
 S RMPREOY=Y
"RTN","RMPREO23",70,0)
 F RN=1:1 S XDA=$P(RMPREOY,",",RN) Q:XDA=""  Q:$G(DUOUT)=1  I $D(^TMP($J,"RMPREOEE",XDA,0)) S DA=^TMP($J,"RMPREOEE",XDA,0) D PDISPA
"RTN","RMPREO23",71,0)
 K RMPREOY,XDA,DA,DUOUT
"RTN","RMPREO23",72,0)
 D INIT^RMPREO
"RTN","RMPREO23",73,0)
 S VALMBCK="R"
"RTN","RMPREO23",74,0)
 Q
"RTN","RMPREO23",75,0)
PDISPA ;call consult api
"RTN","RMPREO23",76,0)
 ;pass DA ien to 668
"RTN","RMPREO23",77,0)
 D ENP^RMPREPDT
"RTN","RMPREO23",78,0)
 Q
"RTN","RMPREO23",79,0)
DDISP ;detail display
"RTN","RMPREO23",80,0)
 D NUM^RMPREOU
"RTN","RMPREO23",81,0)
 D FULL^VALM1
"RTN","RMPREO23",82,0)
 S RMPREOY=Y
"RTN","RMPREO23",83,0)
 F RN=1:1 S XDA=$P(RMPREOY,",",RN) Q:XDA=""  Q:$G(DUOUT)=1  I $D(^TMP($J,"RMPREOEE",XDA,0)) S DA=^TMP($J,"RMPREOEE",XDA,0) D DDISPA
"RTN","RMPREO23",84,0)
 K RMPREOY,XDA,DA,DUOUT
"RTN","RMPREO23",85,0)
 D INIT^RMPREO
"RTN","RMPREO23",86,0)
 S VALMBCK="R"
"RTN","RMPREO23",87,0)
 Q
"RTN","RMPREO23",88,0)
DDISPA ;call list template from listmanager
"RTN","RMPREO23",89,0)
 ;pass DA ien to file 668
"RTN","RMPREO23",90,0)
 D EN^RMPREPDT
"RTN","RMPREO23",91,0)
 Q
"RTN","RMPREO23",92,0)
VIEWIA ;view initial action note
"RTN","RMPREO23",93,0)
 N YY,DIC,BY,FLDS,FR,TO,DA
"RTN","RMPREO23",94,0)
 D NUM^RMPREOU
"RTN","RMPREO23",95,0)
 D FULL^VALM1
"RTN","RMPREO23",96,0)
 ;
"RTN","RMPREO23",97,0)
 S RMPREOY=Y
"RTN","RMPREO23",98,0)
 F RN=1:1 S XDA=$P(RMPREOY,",",RN) Q:XDA=""  Q:$G(DUOUT)=1  I $D(^TMP($J,"RMPREOEE",XDA,0)) S DA=^TMP($J,"RMPREOEE",XDA,0) D VIEWIAP
"RTN","RMPREO23",99,0)
 K RMPREOY,XDA,DA,DUOUT
"RTN","RMPREO23",100,0)
 S VALMBCK="R"
"RTN","RMPREO23",101,0)
 Q
"RTN","RMPREO23",102,0)
VIEWIAP ;loop
"RTN","RMPREO23",103,0)
 S L=0
"RTN","RMPREO23",104,0)
 S DIC="^RMPR(668,",FLDS="[RMPR VIEW INITIAL ACTION]"
"RTN","RMPREO23",105,0)
 S BY="@NUMBER",(FR,TO)=DA
"RTN","RMPREO23",106,0)
 S IOP="HOME"
"RTN","RMPREO23",107,0)
 W @IOF
"RTN","RMPREO23",108,0)
 D EN1^DIP
"RTN","RMPREO23",109,0)
 N DIR S DIR(0)="E" D ^DIR
"RTN","RMPREO23",110,0)
 Q
"RTN","RMPREO23",111,0)
 ;
"RTN","RMPREO23",112,0)
VIEWC ;view complete note
"RTN","RMPREO23",113,0)
 ;
"RTN","RMPREO23",114,0)
 N YY,DIC,BY,FLDS,FR,TO,DA
"RTN","RMPREO23",115,0)
 D NUM^RMPREOU
"RTN","RMPREO23",116,0)
 D FULL^VALM1
"RTN","RMPREO23",117,0)
 ;
"RTN","RMPREO23",118,0)
 S RMPREOY=Y
"RTN","RMPREO23",119,0)
 F RN=1:1 S XDA=$P(RMPREOY,",",RN) Q:XDA=""  Q:$G(DUOUT)=1  I $D(^TMP($J,"RMPREOEE",XDA,0)) S DA=^TMP($J,"RMPREOEE",XDA,0) D VIEWCP
"RTN","RMPREO23",120,0)
 K RMPREOY,XDA,DA,DUOUT
"RTN","RMPREO23",121,0)
 S VALMBCK="R"
"RTN","RMPREO23",122,0)
 Q
"RTN","RMPREO23",123,0)
VIEWCP ;loop
"RTN","RMPREO23",124,0)
 S L=0
"RTN","RMPREO23",125,0)
 S DIC="^RMPR(668,",FLDS="[RMPR VIEW COMP NOTE]"
"RTN","RMPREO23",126,0)
 S BY="@NUMBER",(FR,TO)=DA
"RTN","RMPREO23",127,0)
 ;should we ask device?
"RTN","RMPREO23",128,0)
 ;S IOP="HOME"
"RTN","RMPREO23",129,0)
 W @IOF
"RTN","RMPREO23",130,0)
 D EN1^DIP
"RTN","RMPREO23",131,0)
 N DIR S DIR(0)="E" D ^DIR
"RTN","RMPREO23",132,0)
 Q
"RTN","RMPREO23",133,0)
 ;
"RTN","RMPREO23",134,0)
 ;
"RTN","RMPREO23",135,0)
VIEWO ;view other action notes
"RTN","RMPREO23",136,0)
 N YY,DIC,BY,FLDS,FR,TO,DA
"RTN","RMPREO23",137,0)
 D NUM^RMPREOU
"RTN","RMPREO23",138,0)
 D FULL^VALM1
"RTN","RMPREO23",139,0)
 S RMPREOY=Y
"RTN","RMPREO23",140,0)
 F RN=1:1 S XDA=$P(RMPREOY,",",RN) Q:XDA=""  Q:$G(DUOUT)=1  I $D(^TMP($J,"RMPREOEE",XDA,0)) S DA=^TMP($J,"RMPREOEE",XDA,0) D VIEWOP
"RTN","RMPREO23",141,0)
 K RMPREOY,XDA,DA,DUOUT
"RTN","RMPREO23",142,0)
 S VALMBCK="R"
"RTN","RMPREO23",143,0)
 Q
"RTN","RMPREO23",144,0)
VIEWOP ;loop
"RTN","RMPREO23",145,0)
 S L=0
"RTN","RMPREO23",146,0)
 S DIC="^RMPR(668,",FLDS="[RMPR OACT NOTE]"
"RTN","RMPREO23",147,0)
 S BY="@NUMBER",(FR,TO)=DA
"RTN","RMPREO23",148,0)
 S IOP="HOME"
"RTN","RMPREO23",149,0)
 W @IOF
"RTN","RMPREO23",150,0)
 D EN1^DIP
"RTN","RMPREO23",151,0)
 N DIR S DIR(0)="E" D ^DIR
"RTN","RMPREO23",152,0)
 S VALMBCK="R"
"RTN","RMPREO23",153,0)
 Q
"RTN","RMPREO23",154,0)
 ;
"RTN","RMPREO23",155,0)
IACT ;take initial action
"RTN","RMPREO23",156,0)
 ;
"RTN","RMPREO23",157,0)
 N YY,DIC,BY,FLDS,FR,TO,DA
"RTN","RMPREO23",158,0)
 D NUM^RMPREOU
"RTN","RMPREO23",159,0)
 D FULL^VALM1
"RTN","RMPREO23",160,0)
 S RMPREOY=Y
"RTN","RMPREO23",161,0)
 F RN=1:1 S XDA=$P(RMPREOY,",",RN) Q:XDA=""  Q:$G(DUOUT)=1  I $D(^TMP($J,"RMPREOEE",XDA,0)) S DA=^TMP($J,"RMPREOEE",XDA,0) D ENIA^RMPREOS
"RTN","RMPREO23",162,0)
 K RMPREOY,XDA,DA,DUOUT
"RTN","RMPREO23",163,0)
 I $G(RMSUCLFG) D INIT^RMPREOL
"RTN","RMPREO23",164,0)
 I '$G(RMSUCLFG) D INIT^RMPREO
"RTN","RMPREO23",165,0)
 S VALMBCK="R"
"RTN","RMPREO23",166,0)
 Q
"RTN","RMPREO23",167,0)
 ;
"RTN","RMPREO23",168,0)
OACT ;other notes
"RTN","RMPREO23",169,0)
 N YY,DIC,BY,FLDS,FR,TO,DA
"RTN","RMPREO23",170,0)
 D NUM^RMPREOU
"RTN","RMPREO23",171,0)
 D FULL^VALM1
"RTN","RMPREO23",172,0)
 S RMPREOY=Y
"RTN","RMPREO23",173,0)
 F RN=1:1 S XDA=$P(RMPREOY,",",RN) Q:XDA=""  Q:$G(DUOUT)=1  I $D(^TMP($J,"RMPREOEE",XDA,0)) S DA=^TMP($J,"RMPREOEE",XDA,0) D OACT^RMPREOS
"RTN","RMPREO23",174,0)
 K RMPREOY,XDA,DA,DUOUT
"RTN","RMPREO23",175,0)
 I $G(RMSUCLFG) D INIT^RMPREOL
"RTN","RMPREO23",176,0)
 I '$G(RMSUCLFG) D INIT^RMPREO
"RTN","RMPREO23",177,0)
 S VALMBCK="R"
"RTN","RMPREO23",178,0)
 Q
"RTN","RMPREO23",179,0)
 ;
"RTN","RMPREO23",180,0)
CACT ;complete note
"RTN","RMPREO23",181,0)
 N YY,DIC,BY,FLDS,FR,TO,DA
"RTN","RMPREO23",182,0)
 D NUM^RMPREOU
"RTN","RMPREO23",183,0)
 D FULL^VALM1
"RTN","RMPREO23",184,0)
 S RMPREOY=Y
"RTN","RMPREO23",185,0)
 F RN=1:1 S XDA=$P(RMPREOY,",",RN) Q:XDA=""  Q:$G(DUOUT)=1  I $D(^TMP($J,"RMPREOEE",XDA,0)) S DA=^TMP($J,"RMPREOEE",XDA,0) D CLNT^RMPREOS
"RTN","RMPREO23",186,0)
 K RMPREOY,XDA,DA,DUOUT
"RTN","RMPREO23",187,0)
 I $G(RMSUCLFG) D INIT^RMPREOL
"RTN","RMPREO23",188,0)
 I '$G(RMSUCLFG) D INIT^RMPREO
"RTN","RMPREO23",189,0)
 S VALMBCK="R"
"RTN","RMPREO23",190,0)
 Q
"RTN","RMPREO23",191,0)
 ;
"RTN","RMPREO23",192,0)
FORW ;forward consult
"RTN","RMPREO23",193,0)
 N YY,DIC,BY,FLDS,FR,TO,DA
"RTN","RMPREO23",194,0)
 D NUM^RMPREOU
"RTN","RMPREO23",195,0)
 D FULL^VALM1
"RTN","RMPREO23",196,0)
 S RMPREOY=Y
"RTN","RMPREO23",197,0)
 F RN=1:1 S XDA=$P(RMPREOY,",",RN) Q:XDA=""  Q:$G(DUOUT)=1  I $D(^TMP($J,"RMPREOEE",XDA,0)) S DA=^TMP($J,"RMPREOEE",XDA,0) D FORW^RMPREOS
"RTN","RMPREO23",198,0)
 K RMPREOY,XDA,DA,DUOUT
"RTN","RMPREO23",199,0)
 D INIT^RMPREO
"RTN","RMPREO23",200,0)
 S VALMBCK="R"
"RTN","RMPREO23",201,0)
 Q
"RTN","RMPREO23",202,0)
AMAN ;add manual suspense
"RTN","RMPREO23",203,0)
 D FULL^VALM1
"RTN","RMPREO23",204,0)
 D EN^RMPREOS
"RTN","RMPREO23",205,0)
 D INIT^RMPREO
"RTN","RMPREO23",206,0)
 S VALMBCK="R"
"RTN","RMPREO23",207,0)
 Q
"RTN","RMPREO23",208,0)
 ;
"RTN","RMPREO23",209,0)
EMAN ;edit manual suspense
"RTN","RMPREO23",210,0)
 D FULL^VALM1
"RTN","RMPREO23",211,0)
 D NUM^RMPREOU
"RTN","RMPREO23",212,0)
 S RMPREOY=Y
"RTN","RMPREO23",213,0)
 S RN=""
"RTN","RMPREO23",214,0)
 F RN=1:1 S XDA=$P(RMPREOY,",",RN) Q:XDA=""  Q:$G(DUOUT)=1  I $D(^TMP($J,"RMPREOEE",XDA,0)) S DA=^TMP($J,"RMPREOEE",XDA,0) D EMANP
"RTN","RMPREO23",215,0)
 K RMPREOY,XDA,DA,DUOUT,RN
"RTN","RMPREO23",216,0)
 Q
"RTN","RMPREO23",217,0)
EMANP ;edit manual supsense loop
"RTN","RMPREO23",218,0)
 D EN2^RMPREOS
"RTN","RMPREO23",219,0)
 D INIT^RMPREO
"RTN","RMPREO23",220,0)
 S VALMBCK="R"
"RTN","RMPREO23",221,0)
 Q
"RTN","RMPREO23",222,0)
 ;
"RTN","RMPREO23",223,0)
 ;END
"RTN","RMPRFO")
0^32^B11025831
"RTN","RMPRFO",1,0)
RMPRFO ;PHX/RFM,HPL-DRIVER FOR PROSTHETIC LETTERS ;6/2/03  13:34
"RTN","RMPRFO",2,0)
 ;;3.0;PROSTHETICS;**55,77**;Feb 09, 1996
"RTN","RMPRFO",3,0)
 ;
"RTN","RMPRFO",4,0)
 ; ODJ - patch 55 - 1/29/01 - replace hard code 121 mail symbol with
"RTN","RMPRFO",5,0)
 ;                            call to extrinsic to read site param.
"RTN","RMPRFO",6,0)
 ;                            nois AUG-1097-32118
"RTN","RMPRFO",7,0)
 ;RVD patch #77 - remove link to suspense
"RTN","RMPRFO",8,0)
 N % K ^TMP($J,1),^TMP($J,"RMPR") D HOME^%ZIS S RMPRIN=0
"RTN","RMPRFO",9,0)
 K RMPRFF,DFN
"RTN","RMPRFO",10,0)
 ;S Y=DT D DD^%DT S NAME=Y D TRANS^RMPRUTL1 S RMPRDATE=RMPRNAME
"RTN","RMPRFO",11,0)
 S RMPRDEL="S RMPRGO=$S($D(^RMPR(665.4,RMPRIN,0)):""DEL^RMPRFO1"",1:""EXIT^RMPRFO1"") G @RMPRGO"
"RTN","RMPRFO",12,0)
 I '$D(RMPRFF)!($G(DFN)="") D DIV4^RMPRSIT G:$D(X) EXIT^RMPRFO1 S DIC="^DPT(",DIC(0)="AEMQ",DIC("A")="Select PATIENT: "
"RTN","RMPRFO",13,0)
 I $D(RMPRFF)&($G(DFN)>0) S DIC="^DPT(",DIC(0)="N"
"RTN","RMPRFO",14,0)
 D ^DIC G:Y<0 EXIT^RMPRFO1
"RTN","RMPRFO",15,0)
 K DIC S DFN=+Y
"RTN","RMPRFO",16,0)
CUM K ^TMP($J,1),^TMP($J,"RMPR")
"RTN","RMPRFO",17,0)
 S Y=DT D DD^%DT S NAME=Y D TRANS^RMPRUTL1 S RMPRDATE=RMPRNAME
"RTN","RMPRFO",18,0)
 S DIC="^RMPR(665.2,",DIC(0)="AEMQ",DIC("A")="Select FORM LETTER TYPE: " D ^DIC G:Y<0 EXIT^RMPRFO1
"RTN","RMPRFO",19,0)
 K DIC S RMPRFA=+Y
"RTN","RMPRFO",20,0)
 S RMPRTY=$P(Y,U,2)
"RTN","RMPRFO",21,0)
 I $P(^RMPR(665.2,RMPRFA,0),U,3) D VEN^RMPRFO3 D EXIT^RMPRFO1 Q
"RTN","RMPRFO",22,0)
 D DEM^VADPT,ADD^VADPT
"RTN","RMPRFO",23,0)
 F RI=1:1:17 S ^TMP($J,1,RI,0)=" "
"RTN","RMPRFO",24,0)
HEAD1 S %=1 W !,"Would you like a header on this letter" D YN^DICN G:%<0 EXIT^RMPRFO1
"RTN","RMPRFO",25,0)
 I %=0 W !,"Answer `YES` for a header, `NO` for no header" G HEAD1
"RTN","RMPRFO",26,0)
 W @IOF I %=2 S RMPRHED=1 G HEADER
"RTN","RMPRFO",27,0)
 S ^TMP($J,1,1,0)="|SETTAB(""C"")|"
"RTN","RMPRFO",28,0)
 S ^TMP($J,1,2,0)="|TAB|Department of Veterans Affairs"
"RTN","RMPRFO",29,0)
 S NAME=$P(^RMPR(669.9,RMPRSITE,2),U,4) I NAME]"" S NAME=$S($D(^DIC(5,NAME)):$P(^DIC(5,NAME,0),U),1:"STATE") W $$PARS^RMPRUTL1(NAME)
"RTN","RMPRFO",30,0)
 S ^TMP($J,1,3,0)="|TAB|"_$P(^RMPR(669.9,RMPRSITE,0),U)
"RTN","RMPRFO",31,0)
 S ^TMP($J,1,4,0)="|TAB|"_$P(^RMPR(669.9,RMPRSITE,2),U,2)
"RTN","RMPRFO",32,0)
 S ^TMP($J,1,5,0)="|TAB|"_$P(^RMPR(669.9,RMPRSITE,2),U,3)_", "_FIXDNAME_" "_$P(^RMPR(669.9,RMPRSITE,2),U,5) K FIXDNAME
"RTN","RMPRFO",33,0)
HEADER S ^TMP($J,1,9,0)="|SETTAB(5,50)||TAB|"_RMPRDATE
"RTN","RMPRFO",34,0)
 I '$D(RMPRHED) D
"RTN","RMPRFO",35,0)
 . S ^TMP($J,1,11,0)="|TAB|"_$P(VADM(1),",",2)_" "_$P(VADM(1),",",1)_"|TAB|In Reply Refer To: "_$$STA^RMPRUTIL_"/"_$$ROU^RMPRUTIL(RMPRSITE)
"RTN","RMPRFO",36,0)
 . Q
"RTN","RMPRFO",37,0)
 E  D
"RTN","RMPRFO",38,0)
 . S ^TMP($J,1,11,0)="|TAB|"_$P(VADM(1),",",2)_" "_$P(VADM(1),",",1)_"|TAB|"_"             "_$$STA^RMPRUTIL_"/"_$$ROU^RMPRUTIL(RMPRSITE)
"RTN","RMPRFO",39,0)
 . Q
"RTN","RMPRFO",40,0)
 S ^TMP($J,1,12,0)="|TAB|"_VAPA(1)_"|TAB|SSN: "_$P(VADM(2),U,2)
"RTN","RMPRFO",41,0)
 I VAPA(2)]"" S ^TMP($J,1,13,0)="|TAB|"_VAPA(2)_"|TAB|"_VADM(1),^TMP($J,1,14,0)="|TAB|"_VAPA(4)_","_" "_$P(VAPA(5),U,2)_" "_VAPA(6)
"RTN","RMPRFO",42,0)
 E  S ^TMP($J,1,13,0)="|TAB|"_VAPA(4)_","_" "_$P(VAPA(5),U,2)_" "_VAPA(6)_"|TAB|"_VADM(1)
"RTN","RMPRFO",43,0)
 S NAME=$P(VADM(1),",")
"RTN","RMPRFO",44,0)
 I $P(NAME," ",2)?1A.A D
"RTN","RMPRFO",45,0)
 .S NAME1=NAME,NAME=$P(NAME," ",1) D TRANS^RMPRUTL1 S RMPRNAM1=RMPRNAME,NAME=NAME1,NAME=$P(NAME," ",2) D TRANS^RMPRUTL1 S RMPRNAM2=RMPRNAME,RMPRNAME=RMPRNAM1_" "_RMPRNAM2
"RTN","RMPRFO",46,0)
 E  D TRANS^RMPRUTL1
"RTN","RMPRFO",47,0)
 G NAME^RMPRFO1
"RTN","RMPRFO1")
0^33^B16577236
"RTN","RMPRFO1",1,0)
RMPRFO1 ;PHX/RFM,HPL-DRIVER FOR PROSTHETIC LETTERS ;3/17/03  12:19
"RTN","RMPRFO1",2,0)
 ;;3.0;PROSTHETICS;**8,44,77**;Feb 09, 1996
"RTN","RMPRFO1",3,0)
 ;RVD 3/17/03 patch #77 - remove link to suspense from letter module.
"RTN","RMPRFO1",4,0)
NAME ;
"RTN","RMPRFO1",5,0)
 S RMPRNAME=$P(RMPRNAME," ",1,2)
"RTN","RMPRFO1",6,0)
 I $P(VADM(5),U)["M" S ^TMP($J,1,16,0)="|TAB|"_"Dear Mr. "_RMPRNAME_":"
"RTN","RMPRFO1",7,0)
 E  S ^TMP($J,1,16,0)="|TAB|"_"Dear Ms. "_RMPRNAME_":"
"RTN","RMPRFO1",8,0)
 S RV=18 F RI=0:0 S RI=$O(^RMPR(665.2,RMPRFA,1,RI)) Q:RI'>0  Q:^(RI,0)'=" "
"RTN","RMPRFO1",9,0)
 S RI=RI-1 F  S RI=$O(^RMPR(665.2,RMPRFA,1,RI)) Q:RI'>0  S TAB=$S($P(^RMPR(665.2,RMPRFA,1,RI,0),U)["|TAB|":"",1:"|TAB|") S ^TMP($J,1,RV,0)=TAB_^(0),RV=RV+1
"RTN","RMPRFO1",10,0)
EDIT S DIC="^TMP($J,1," D EN^DIWE S RMPRFLAG=1
"RTN","RMPRFO1",11,0)
EDIT1 S %=1 W !,"Do you wish to view this letter" D YN^DICN
"RTN","RMPRFO1",12,0)
 I %<0 G EXIT^RMPRFO1
"RTN","RMPRFO1",13,0)
 I %=0 W !,"Answer `YES` to view the letter, `NO` to not" G EDIT1
"RTN","RMPRFO1",14,0)
 I %=1 S RMPRFFL=1 G:$G(RMPRPRIN)'="" PRINT S RMPRPRIN=1 G SET^RMPRFO2
"RTN","RMPRFO1",15,0)
ASK ;
"RTN","RMPRFO1",16,0)
 S %=1 W !,"Do you wish to accept this letter" D YN^DICN
"RTN","RMPRFO1",17,0)
 I %<0 G EXIT^RMPRFO1
"RTN","RMPRFO1",18,0)
 I %=0 W !,"Answer `YES` or `NO`" G ASK
"RTN","RMPRFO1",19,0)
 I %=2 G ASK2
"RTN","RMPRFO1",20,0)
 K RMPRFFL G:$D(RMPRPRIN) PRINT G SET^RMPRFO2
"RTN","RMPRFO1",21,0)
ASK2 ;DECIDES TO KEEP EDITING LETTER OR DELETE IT
"RTN","RMPRFO1",22,0)
 ; ALREADY SAID NOT TO ACCEPT LETTER
"RTN","RMPRFO1",23,0)
 S %=2 W !,"Do you wish to Delete this letter" D YN^DICN
"RTN","RMPRFO1",24,0)
 I %=1!(%<0) D  Q
"RTN","RMPRFO1",25,0)
 .I $G(RMPRIN)'>0 W $C(7),!!,?35,"Letter Deleted..." D EXIT^RMPRFO1  Q
"RTN","RMPRFO1",26,0)
 .I $D(^RMPR(665.4,RMPRIN,0)) D DEL^RMPRFO1
"RTN","RMPRFO1",27,0)
 .W $C(7),!!,?35,"Deleted..." H 1 Q
"RTN","RMPRFO1",28,0)
 I %=0 W !,"Enter `YES` to Delete this letter" G ASK2
"RTN","RMPRFO1",29,0)
 G EDIT
"RTN","RMPRFO1",30,0)
EN2 ;PRINT/DELETE A LETTER
"RTN","RMPRFO1",31,0)
 K DIC D DIV4^RMPRSIT I $D(Y),(Y<0) G EXIT
"RTN","RMPRFO1",32,0)
 D HOME^%ZIS S DIC=2,DIC(0)="AEQMZ",DIC("A")="Select PATIENT: "
"RTN","RMPRFO1",33,0)
DICW ;CHOOSE THE LETTER TO PRINT
"RTN","RMPRFO1",34,0)
 ;S DIC("W")="S (RMPRDFN,DFN)=+Y" D ^DIC K DIC G:Y<0 EXIT
"RTN","RMPRFO1",35,0)
 D ^DIC K DIC G:Y<0 EXIT S (RMPRDFN,DFN)=+Y
"RTN","RMPRFO1",36,0)
 D EN^RMPRUTL2 Q:RMPRIN=-1  S:$G(RMPRIN)>0 DA=RMPRIN
"RTN","RMPRFO1",37,0)
 Q:$G(DA)<1  Q:$G(DA)=""  S RMPRIN=DA
"RTN","RMPRFO1",38,0)
 Q:$G(RMPRIN)'>0  S RMPRTY=$P(^RMPR(665.4,RMPRIN,0),U,2) L +^RMPR(665.4,RMPRIN,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPRFO1",39,0)
 G:$D(RMPRDELE) DEL
"RTN","RMPRFO1",40,0)
 S DA=RMPRIN,ITMFLG=0 S:$D(^RMPR(665.4,DA,3,0)) ITMFLG=$P(^RMPR(665.4,DA,3,0),U,4) S:ITMFLG>4 ITMFLG=1
"RTN","RMPRFO1",41,0)
 S ITM=RMPRIN
"RTN","RMPRFO1",42,0)
 I $P(^RMPR(665.2,RMPRTY,0),U,3) D PRNT1^RMPRFO3 K RMPRTY,DA,ITM,ITMFLG D EXIT^RMPRFO3 G EXIT
"RTN","RMPRFO1",43,0)
PRINT ;VIEW LETTER
"RTN","RMPRFO1",44,0)
 I $G(RMPRIN)'>0 Q:$G(RMPRDA)'>0  S RMPRIN=RMPRDA
"RTN","RMPRFO1",45,0)
 S DFN=$P(^RMPR(665.4,RMPRIN,0),U)
"RTN","RMPRFO1",46,0)
 S RMPRTY=$P(^RMPR(665.4,RMPRIN,0),U,2)
"RTN","RMPRFO1",47,0)
 S RMPR1=^RMPR(665.2,RMPRTY,0)
"RTN","RMPRFO1",48,0)
 I $P(^RMPR(665.2,RMPRTY,0),U,3) S DA=RMPRIN K RMPR1 G PRNT1^RMPRFO3
"RTN","RMPRFO1",49,0)
 S DIC="^RMPR(665.4,",RMPRPG=0,DHD="[RMPR BLANK]-[RMPR PAGE]"
"RTN","RMPRFO1",50,0)
 S BY="@NUMBER",FR=RMPRIN,TO=RMPRIN,FLDS="3",L=0,PG=2
"RTN","RMPRFO1",51,0)
 D EN1^DIP I '$D(POP) S POP=0
"RTN","RMPRFO1",52,0)
 I POP,$D(RMPRFFL) S RMPRGO=$S($D(^RMPR(665.4,RMPRIN,0)):"DEL^RMPRFO1",1:"EXIT^RMPRFO1") D @RMPRGO W ?9," Deleted..." G EXIT
"RTN","RMPRFO1",53,0)
 ;I '$D(RMPRFFL),'$D(RNSK) S RMPRDFN=DFN D LINK^RMPRS G EXIT
"RTN","RMPRFO1",54,0)
 ;I 'POP,'$D(RMPRFFL),'$D(RNSK) S RMPRDFN=DFN K DIR S DIR(0)="E" W ! D ^DIR,LINK^RMPRS G EXIT
"RTN","RMPRFO1",55,0)
VI I $D(RMPRFFL) R !!,"Enter `return` to continue: ",X:DTIME G:'$T EXIT I X'="" W $C(7),!,"You may only enter `return` here.." G VI
"RTN","RMPRFO1",56,0)
 I $D(RMPRFFL) S DIE="^RMPR(665.4,",DA=RMPRIN,DR=3,DIE("NO^")="" D ^DIE G:$D(DTOUT)!($D(DUOUT)) EXIT G EDIT1
"RTN","RMPRFO1",57,0)
EXIT ;common exit point
"RTN","RMPRFO1",58,0)
 L:$D(RMPRIN) -^RMPR(665.4,RMPRIN,0)
"RTN","RMPRFO1",59,0)
 K ^TMP($J,1),^TMP($J,"RMPR")
"RTN","RMPRFO1",60,0)
 K %X,RMPRFFL,RMPRHED,RMPRPRIN,%Y,RMPRDEL,RMPRRVA,DIC,RMPRFA,KILL,DIE,DA,DR,DIK,RMPR1,RMPR2,RMPRDATE,RMPRIN,RMPRL,RMPRNAME,RMPRU,RMPRDELE,FR,RI,RV
"RTN","RMPRFO1",61,0)
 I '$D(RMPRCOMB)!('$D(RMPRFF)) K RMPREND,VADM,VAPA,VA,NAME,RMPRGO,NAME1,RMPRDEN,RMPRFLAG,RMPRNAM1,RMPRNAM2,RMPRFF,J,RP,RO,RZ D KVAR^VADPT
"RTN","RMPRFO1",62,0)
 D ^%ZISC Q
"RTN","RMPRFO1",63,0)
DEL I $D(RMPRDELE) S %=2 W !,"Are you sure you want to delete this letter" D YN^DICN I %=0 W !,"Answer `YES` to Delete the letter, `NO` to exit" G DEL
"RTN","RMPRFO1",64,0)
 I $D(RMPRDELE),(%<0!(%=2)) G EXIT
"RTN","RMPRFO1",65,0)
 S DIK="^RMPR(665.4,",DA=RMPRIN D ^DIK G EXIT
"RTN","RMPRFO2")
0^34^B21081133
"RTN","RMPRFO2",1,0)
RMPRFO2 ;PHX/RFM,HPL-CONTINUATION OF RMPRFO1 ;11/01/1994
"RTN","RMPRFO2",2,0)
 ;;3.0;PROSTHETICS;**77**;Feb 09, 1996
"RTN","RMPRFO2",3,0)
 ;
"RTN","RMPRFO2",4,0)
 ;RVD patch #77 - check for variable %
"RTN","RMPRFO2",5,0)
VIEW ;VIEW LETTERS FROM ELIG SCREEN2 UNDER ISSUE FROM STOCK
"RTN","RMPRFO2",6,0)
 N RMPRDA,DA,RMPRIN
"RTN","RMPRFO2",7,0)
 Q:'$D(%)
"RTN","RMPRFO2",8,0)
 Q:$G(DFN)=""!(%=3)
"RTN","RMPRFO2",9,0)
 S RMPRFF=1 I '$D(^RMPR(665.4,"B",DFN)) G RO1
"RTN","RMPRFO2",10,0)
 K KILL
"RTN","RMPRFO2",11,0)
 W !!,"Letters on file:"
"RTN","RMPRFO2",12,0)
 ;!,?5,"Type",?29,"Employee",?55,"Date or Vendor"
"RTN","RMPRFO2",13,0)
ASK1 ;SET UP REVERSE LETTER LIST & ASK IF USER WANTS TO VIEW MORE LETTERS
"RTN","RMPRFO2",14,0)
 D EN^RMPRUTL2
"RTN","RMPRFO2",15,0)
 S DA=RMPRIN G:$G(DA)'>0 ASK2
"RTN","RMPRFO2",16,0)
 S RMPRIN=DA D PRINT^RMPRFO1
"RTN","RMPRFO2",17,0)
MOLET K DA,RMPRDA,RMPRIN
"RTN","RMPRFO2",18,0)
 S %=2 W !,"Would you like to see more letters" D YN^DICN
"RTN","RMPRFO2",19,0)
 I %=-1 S KILL=1 Q
"RTN","RMPRFO2",20,0)
 I %=0 W !,"'YES' will let you review another letter for this patient",!,"'NO' will let you continue the program"
"RTN","RMPRFO2",21,0)
 I  W !,"Enter '^' to exit the correspondence screen totally" G MOLET
"RTN","RMPRFO2",22,0)
 I %=2 S KILL=1 D RO1 Q
"RTN","RMPRFO2",23,0)
 I %=1 G ASK1
"RTN","RMPRFO2",24,0)
 G RO1
"RTN","RMPRFO2",25,0)
ASK2 ;Q:RMPRIN=-1
"RTN","RMPRFO2",26,0)
 S %=2 W !,"Do you wish to view a letter" D YN^DICN Q:$D(DTOUT)  S:%<0 KILL=1 G:%=2!(%<0) RO1
"RTN","RMPRFO2",27,0)
 I %=0 W !,"Answer `YES` or `NO`" G ASK2
"RTN","RMPRFO2",28,0)
 I %=1 G VIEW
"RTN","RMPRFO2",29,0)
 ;I %=1 S %=3 G VIEW
"RTN","RMPRFO2",30,0)
ASK3 I %=2 K X R !!,"Enter the number: ",X:DTIME Q:'$T!(X="")  Q:X="^"  I X>(I-1)!(+X<1)!(X'?1N.N) W !,$C(7),"Enter a number between 1 and ",(I-1)_" or `^` to quit." G ASK3
"RTN","RMPRFO2",31,0)
 I %=1 I $G(X)'="" I $G(RMPR9VA($G(X)))=""&($G(RMPRDFN)'="") S RMPR9VA($G(X))=RMPRDFN
"RTN","RMPRFO2",32,0)
 I %=1,$D(^RMPR(665.4,RMPR9VA(+X),0)) S RMPRIN=RMPR9VA(+X),RMPREN=1 D PRINT^RMPRFO1 G VIEW
"RTN","RMPRFO2",33,0)
RO1 K RMPREN S %=2 W !,"Do you wish to create a correspondence letter" D YN^DICN
"RTN","RMPRFO2",34,0)
 I %=1 D CUM^RMPRFO Q
"RTN","RMPRFO2",35,0)
 I %=0 W !,"Answer `YES` to create a form letter, `NO` to continue." G RO1
"RTN","RMPRFO2",36,0)
 I %=2 K RMPRBB,RMPRFF,RMPR9ZRO,RMPR9VA(1),RMPR9VA(2)
"RTN","RMPRFO2",37,0)
 S %=3 Q
"RTN","RMPRFO2",38,0)
EN4 ;EDIT A SKELETON
"RTN","RMPRFO2",39,0)
 K DIC S DIC="^RMPR(665.2,",DIC(0)="AEQLM",DLAYGO=665.2 D ^DIC K DLAYGO
"RTN","RMPRFO2",40,0)
 I +Y<0!($P(Y,U,4)["1") W !!,"SORRY, THIS IS A NON-EDITABLE LETTER" G EXIT^RMPRFO1
"RTN","RMPRFO2",41,0)
 S RMPRIN=+Y L +^RMPR(665.2,RMPRIN,0):1 I $T=0 W !,$C(7),?5,"Someone else is Editing this entry!" K RMPRIN G EXIT^RMPRFO1
"RTN","RMPRFO2",42,0)
 S DIE="^RMPR(665.2,",DA=RMPRIN,DR=".01;1",DIE("NO^")="" D ^DIE L -^RMPR(665.2,RMPRIN,0) I '$D(DA)!($D(DTOUT))!($D(DUOUT)) G EXIT^RMPRFO1
"RTN","RMPRFO2",43,0)
DEN S %=$S($P(^RMPR(665.2,RMPRIN,0),U,2)=1:1,1:2) W !,"Is this a Denial type of letter" D YN^DICN
"RTN","RMPRFO2",44,0)
 G:%<0 EXIT^RMPRFO1
"RTN","RMPRFO2",45,0)
 I %=0 G QUES1
"RTN","RMPRFO2",46,0)
 S $P(^RMPR(665.2,RMPRIN,0),U,2)=$S(%=2:0,%=1:1,1:"")
"RTN","RMPRFO2",47,0)
 G EXIT^RMPRFO1
"RTN","RMPRFO2",48,0)
QUES1 W !,"Enter `YES` if letter is an AMIS Denial" G DEN
"RTN","RMPRFO2",49,0)
EN3 ;PRINT FORM LETTER
"RTN","RMPRFO2",50,0)
 I '$D(RMPR("SIG")) D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPRFO2",51,0)
 D HOME^%ZIS
"RTN","RMPRFO2",52,0)
 ;CHECK IF IT IS THE ADP FL 10-90
"RTN","RMPRFO2",53,0)
 K DIC S DIC="^RMPR(665.2,",DIC(0)="AEQM" D ^DIC G:+Y<0 EXIT^RMPRFO1
"RTN","RMPRFO2",54,0)
 S RMPRIN=+Y K DIC
"RTN","RMPRFO2",55,0)
 ;check if it is the ADP FL 10-90
"RTN","RMPRFO2",56,0)
 I $P(^RMPR(665.2,RMPRIN,0),U,4)["1" K DA D PRNT1^RMPRFO3 D EXIT^RMPRFO1 Q
"RTN","RMPRFO2",57,0)
PR S DIWF="^RMPR(665.2,RMPRIN,1,",DIWF(1)=665.2,BY="@NUMBER",FR=RMPRIN,TO=RMPRIN D EN2^DIWF
"RTN","RMPRFO2",58,0)
 G EXIT^RMPRFO1
"RTN","RMPRFO2",59,0)
SET K DIC S DIC="^RMPR(665.4,",DIC(0)="L",X=DFN,DLAYGO=665.4 K DD,DO,DINUM D FILE^DICN K DLAYGO
"RTN","RMPRFO2",60,0)
 G:Y<0 EXIT^RMPRFO1
"RTN","RMPRFO2",61,0)
 S RMPRIN=+Y,$P(^RMPR(665.4,RMPRIN,0),U,2)=RMPRFA,$P(^(0),U,3)=DT,$P(^(0),U,4)=DUZ,$P(^RMPR(665.4,RMPRIN,0),U,5)=$P(^RMPR(665.2,RMPRFA,0),U,2),$P(^RMPR(665.4,RMPRIN,0),U,6)=RMPR("STA") S DIK=DIC,DA=RMPRIN D IX1^DIK
"RTN","RMPRFO2",62,0)
 S %X="^TMP($J,1,",%Y="^RMPR(665.4,+Y,1," D %XY^%RCR
"RTN","RMPRFO2",63,0)
 G PRINT^RMPRFO1
"RTN","RMPRFO2",64,0)
WRITE S:$G(RMPR9ZRO)'=""&(RO="") RO=RMPR9ZRO
"RTN","RMPRFO2",65,0)
 I I#15=0 S DIR(0)="FAOU^1:245",DIR("A")="End of page: select a letter by number or enter'^' to continue listining" D  I $G(X)="^" Q
"RTN","RMPRFO2",66,0)
 .D ^DIR
"RTN","RMPRFO2",67,0)
 .I $G(X)="" Q
"RTN","RMPRFO2",68,0)
 .I $G(X)>0&($G(RO)>0&($G(X)<(RO+1))) S DA=^TMP($J,"RMPR",RO) W !,"***",DA Q
"RTN","RMPRFO2",69,0)
 W !,I_" ",?4,$S($D(^RMPR(665.2,+$P(^RMPR(665.4,^TMP($J,"RMPR",RO),0),U,2),0)):$E($P(^(0),U,1),1,20),1:"UNKNOWN")
"RTN","RMPRFO2",70,0)
 S:$D(^RMPR(665.4,^TMP($J,"RMPR",RO),2)) RMPR2=$P(^RMPR(665.4,^TMP($J,"RMPR",RO),2),U,1)
"RTN","RMPRFO2",71,0)
 ;W ?27,$S($D(^VA(200,+$P(^RMPR(665.4,^TMP($J,"RMPR",RO),0),U,4),0)):$E($P(^(0),U),1,15),1:"")
"RTN","RMPRFO2",72,0)
 S RMPRPP=$G(^VA(200,+$P(^RMPR(665.4,^TMP($J,"RMPR",RO),0),U,4),0))'="" W ?27,$E($P(^(0),U),1,15) K RMPRPP
"RTN","RMPRFO2",73,0)
 S Y=$S($P(^RMPR(665.4,^TMP($J,"RMPR",RO),0),U,3):$P(^RMPR(665.4,^TMP($J,"RMPR",RO),0),U,3),$D(RMPR2):$P(^PRC(440,RMPR2,0),U,1),1:"") D DD^%DT W ?55,$E(Y,1,24) S RMPR9VA(I)=^TMP($J,"RMPR",RO)
"RTN","RMPRFO2",74,0)
 Q
"RTN","RMPRN6")
0^7^B83188489
"RTN","RMPRN6",1,0)
RMPRN6 ;Hines OIFO/HNC-PRINT NPPD LOCAL DATA ;3/17/03  11:38
"RTN","RMPRN6",2,0)
 ;;3.0;PROSTHETICS;**31,32,34,36,39,48,51,70,77**;Feb 09, 1996
"RTN","RMPRN6",3,0)
 ;RVD 3/17/03 patch #77 - fix undefined and closing device.
"RTN","RMPRN6",4,0)
 D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPRN6",5,0)
DATE S %DT="XEA",%DT("A")="Enter Date to Start NPPD Calculations From: " D ^%DT G:X[U!(X="")!($D(DTOUT)) EXIT
"RTN","RMPRN6",6,0)
 S DATE(1)=+Y
"RTN","RMPRN6",7,0)
 S %DT="XEA",%DT("A")="Enter End Date: " D ^%DT G:X[U!(X="")!($D(DTOUT)) EXIT S DATE(2)=+Y
"RTN","RMPRN6",8,0)
 I DATE(1)>DATE(2) W !!,$C(7),"ENDING DATE RANGE IS LESS THAN BEGINNING DATE RANGE",! G DATE
"RTN","RMPRN6",9,0)
 Q:$D(RMPRCDE)
"RTN","RMPRN6",10,0)
DET ;select detail or brief
"RTN","RMPRN6",11,0)
 D DISP^RMPRN6S
"RTN","RMPRN6",12,0)
 K DIR
"RTN","RMPRN6",13,0)
 ;S DIR(0)="S^D:DETAIL;B:BRIEF"
"RTN","RMPRN6",14,0)
 S DIR(0)="S^1:BRIEF NEW SUMMARY;2:BRIEF USED SUMMARY;3:BRIEF BOTH SUMMARY;4:DETAIL & NEW SUMMARY;5:DETAIL & USED SUMMARY;6:DETAIL & BOTH SUMMARY"
"RTN","RMPRN6",15,0)
 S DIR("A")="Type of Report",DIR("B")="DETAIL & NEW SUMMARY" D ^DIR
"RTN","RMPRN6",16,0)
 Q:$D(DIRUT)!($D(DTOUT))
"RTN","RMPRN6",17,0)
 S RMPRDET=Y
"RTN","RMPRN6",18,0)
DEV ;device
"RTN","RMPRN6",19,0)
 S %ZIS="Q" D ^%ZIS G:POP EXIT K IOP I $E(IOST,1,2)["C-" G PRT
"RTN","RMPRN6",20,0)
 I $D(IO("Q")) S ZTIO=ION,ZTSAVE("RMPRSITE")="",ZTSAVE("RMPR(")=""
"RTN","RMPRN6",21,0)
 I  S ZTSAVE("DATE(")="",ZTSAVE("RMPRZ")="",ZTSAVE("RMPRDET")=""
"RTN","RMPRN6",22,0)
 I  S ZTRTN="PRT^RMPRN6",ZTDESC="Prosthetic NPPD" D ^%ZTLOAD K ZTDESC,ZTIO,ZTRTN,ZTSAVE G EXIT
"RTN","RMPRN6",23,0)
PRT ;print
"RTN","RMPRN6",24,0)
 I '$D(IO("Q")) U IO
"RTN","RMPRN6",25,0)
 D GNP,GNPC
"RTN","RMPRN6",26,0)
 Q
"RTN","RMPRN6",27,0)
ENL ;entry point for one line
"RTN","RMPRN6",28,0)
 D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPRN6",29,0)
 S RMPRCDE=1
"RTN","RMPRN6",30,0)
 D DATE
"RTN","RMPRN6",31,0)
 G:'$D(DATE(1))!('$D(DATE(2))) EXIT
"RTN","RMPRN6",32,0)
 ;single line always new and used (BOTH) sort
"RTN","RMPRN6",33,0)
 S RMPRDET=6
"RTN","RMPRN6",34,0)
 D GNPCC,EXIT
"RTN","RMPRN6",35,0)
 Q
"RTN","RMPRN6",36,0)
GNP ;gather nppd data
"RTN","RMPRN6",37,0)
 S $P(LN,"-",IOM)=""
"RTN","RMPRN6",38,0)
 S DATE=DATE(1)-1
"RTN","RMPRN6",39,0)
 K ^TMP($J)
"RTN","RMPRN6",40,0)
 F  S DATE=$O(^RMPR(660,"B",DATE)) Q:(DATE="")!($P(DATE,".",1)>DATE(2))  D
"RTN","RMPRN6",41,0)
 .S RMPRB=0
"RTN","RMPRN6",42,0)
 .F  S RMPRB=$O(^RMPR(660,"B",DATE,RMPRB)) Q:RMPRB'>0  D
"RTN","RMPRN6",43,0)
 ..;define variables for record
"RTN","RMPRN6",44,0)
 ..S REC=$G(^RMPR(660,RMPRB,0)) Q:REC=""
"RTN","RMPRN6",45,0)
 ..Q:$P(REC,U,15)["*"
"RTN","RMPRN6",46,0)
 ..Q:$P(REC,U,10)'=RMPR("STA")
"RTN","RMPRN6",47,0)
 ..;check for used pip
"RTN","RMPRN6",48,0)
 ..;if used pip sort, not pip, not va, quit
"RTN","RMPRN6",49,0)
 ..I $G(RMPRDET)=2&($P($G(^RMPR(660,RMPRB,1)),U,5)'="")&($P(REC,U,14)'="V") Q
"RTN","RMPRN6",50,0)
 ..I $G(RMPRDET)=5&($P($G(^RMPR(660,RMPRB,1)),U,5)'="")&($P(REC,U,14)'="V") Q
"RTN","RMPRN6",51,0)
 ..S TYPE=$P(REC,U,4)
"RTN","RMPRN6",52,0)
 ..S TY=$S(TYPE="X":2,TYPE="I":1,1:3)
"RTN","RMPRN6",53,0)
 ..S MR=$P($G(^RMPR(660,RMPRB,1)),U,4)
"RTN","RMPRN6",54,0)
 ..I $P(^RMPR(660,RMPRB,0),U,17)'=""&($P(^(0),U,26)="") S TY=2,LINE="R90 A",MR=2676
"RTN","RMPRN6",55,0)
 ..;PICKUP AND DELIVERY
"RTN","RMPRN6",56,0)
 ..I $P(^RMPR(660,RMPRB,0),U,26)'="" S TY=2,LINE="R80 D",MR=2951
"RTN","RMPRN6",57,0)
 ..Q:MR=""
"RTN","RMPRN6",58,0)
 ..;        PATCH 70             Auto-fix
"RTN","RMPRN6",59,0)
 ..K LINE
"RTN","RMPRN6",60,0)
 ..I TY'=2 S LINE=$P(^RMPR(661.1,MR,0),U,7)
"RTN","RMPRN6",61,0)
 ..I TY'=2&($G(LINE)="") D
"RTN","RMPRN6",62,0)
 ...S ERR=""
"RTN","RMPRN6",63,0)
 ...S LINE=$P(^RMPR(661.1,MR,0),U,6)
"RTN","RMPRN6",64,0)
 ...S TYPE="X"
"RTN","RMPRN6",65,0)
 ...S DIE="^RMPR(660,",DA=RMPRB,DR="2///^S X=TYPE"
"RTN","RMPRN6",66,0)
 ...L +^RMPR(660,RMPRB):1 I '$T S ERR=1
"RTN","RMPRN6",67,0)
 ...I ERR="" D ^DIE L -^RMPR(660,RMPRB)
"RTN","RMPRN6",68,0)
 ...K DIE,DA,DR
"RTN","RMPRN6",69,0)
 ...I ERR=1 S ^TMP($J,"RMPRA",RMPRB)="NO UPDATE!"
"RTN","RMPRN6",70,0)
 ...I ERR="" S ^TMP($J,"RMPRA",RMPRB)="NEW TO REPAIR"
"RTN","RMPRN6",71,0)
 ...S B=RMPRB D DATA^RMPRN6XM
"RTN","RMPRN6",72,0)
 ..I TY=2 S LINE=$P(^RMPR(661.1,MR,0),U,6)
"RTN","RMPRN6",73,0)
 ..I TY=2&($G(LINE)="") D
"RTN","RMPRN6",74,0)
 ...S ERR=""
"RTN","RMPRN6",75,0)
 ...S LINE=$P(^RMPR(661.1,MR,0),U,7)
"RTN","RMPRN6",76,0)
 ...S TYPE="I"
"RTN","RMPRN6",77,0)
 ...S DIE="^RMPR(660,",DA=RMPRB,DR="2///^S X=TYPE"
"RTN","RMPRN6",78,0)
 ...L +^RMPR(660,RMPRB):1 I '$T S ERR=1
"RTN","RMPRN6",79,0)
 ...I ERR="" D ^DIE L -^RMPR(660,RMPRB)
"RTN","RMPRN6",80,0)
 ...K DIE,DA,DR
"RTN","RMPRN6",81,0)
 ...I ERR=1 S ^TMP($J,"RMPRA",RMPRB)="NO UPDATE!"
"RTN","RMPRN6",82,0)
 ...I ERR="" S ^TMP($J,"RMPRA",RMPRB)="REPAIR TO NEW"
"RTN","RMPRN6",83,0)
 ...S B=RMPRB D DATA^RMPRN6XM
"RTN","RMPRN6",84,0)
 ..;
"RTN","RMPRN6",85,0)
 ..I LINE="" W !,"Line is null, something wrong with file 661.1  :",MR
"RTN","RMPRN6",86,0)
 ..;set to 999 group if null
"RTN","RMPRN6",87,0)
 ..S FLAG=$P(^RMPR(661.1,MR,0),U,8)
"RTN","RMPRN6",88,0)
 ..I FLAG="" S FLAG=2
"RTN","RMPRN6",89,0)
 ..S CATEGRY=$P($G(^RMPR(660,RMPRB,"AM")),U,3),SPEC=$P($G(^("AM")),U,4),GN=$P($G(^("AMS")),U,1)
"RTN","RMPRN6",90,0)
 ..Q:GN=""
"RTN","RMPRN6",91,0)
 ..D SET
"RTN","RMPRN6",92,0)
 D FMT^RMPRN6XM,MAIL^RMPRN6XM
"RTN","RMPRN6",93,0)
 Q
"RTN","RMPRN6",94,0)
GNPC ;worksheet/detail
"RTN","RMPRN6",95,0)
 S STN=RMPR("NAME")
"RTN","RMPRN6",96,0)
 D CAL^RMPRN6
"RTN","RMPRN6",97,0)
 S PAGE=0,FL=""
"RTN","RMPRN6",98,0)
 D ^RMPRN6PT
"RTN","RMPRN6",99,0)
 G:FL=1 EXIT
"RTN","RMPRN6",100,0)
 D ^RMPRN6PR
"RTN","RMPRN6",101,0)
 G:FL=1 EXIT
"RTN","RMPRN6",102,0)
 I RMPRDET<4 G EXIT
"RTN","RMPRN6",103,0)
 D DESP^RMPRN63
"RTN","RMPRN6",104,0)
 D DESPR^RMPRN63
"RTN","RMPRN6",105,0)
EXIT ;commom exit point
"RTN","RMPRN6",106,0)
 D ^%ZISC
"RTN","RMPRN6",107,0)
 N RMPR,RMPRSITE
"RTN","RMPRN6",108,0)
 K ^TMP($J) D KILL^XUSCLEAN
"RTN","RMPRN6",109,0)
 Q
"RTN","RMPRN6",110,0)
GNPCC ;one line only
"RTN","RMPRN6",111,0)
 S STN=RMPR("NAME")
"RTN","RMPRN6",112,0)
 D CODE^RMPRN63
"RTN","RMPRN6",113,0)
 D ^RMPRN6UT
"RTN","RMPRN6",114,0)
 G:$D(DIRUT)!($D(DTOUT)) EXIT
"RTN","RMPRN6",115,0)
 I $G(RMPRCDE)="" S RMPRCDE="",RMPRCDE=$O(BRA(Y,RMPRCDE))
"RTN","RMPRN6",116,0)
 S Y=DATE(1) D DD^%DT S DATE(3)=Y,Y=DATE(2) D DD^%DT S DATE(4)=Y
"RTN","RMPRN6",117,0)
 S %ZIS="Q" D ^%ZIS G:POP EXIT K IOP I $E(IOST,1,2)["C-" G PRTL
"RTN","RMPRN6",118,0)
 I $D(IO("Q")) S ZTIO=ION,ZTSAVE("RMPRSITE")="",ZTSAVE("RMPR(")=""
"RTN","RMPRN6",119,0)
 I  S ZTSAVE("DATE(")="",ZTSAVE("RMPRZ")="",ZTSAVE("RMPRDET")="",ZTSAVE("RMPRCDE")=""
"RTN","RMPRN6",120,0)
 I  S ZTRTN="PRTL^RMPRN6",ZTDESC="Prosthetic NPPD" D ^%ZTLOAD K ZTDESC,ZTIO,ZTRTN,ZTSAVE G EXIT
"RTN","RMPRN6",121,0)
PRTL ;print one line entry from taskman
"RTN","RMPRN6",122,0)
 I '$D(IO("Q")) U IO
"RTN","RMPRN6",123,0)
 D GNP
"RTN","RMPRN6",124,0)
 D CAL^RMPRN6
"RTN","RMPRN6",125,0)
 S PAGE=0,FL=""
"RTN","RMPRN6",126,0)
 S CODE=RMPRCDE
"RTN","RMPRN6",127,0)
 D DESP^RMPRN6PL
"RTN","RMPRN6",128,0)
 Q
"RTN","RMPRN6",129,0)
SET ;set temp global
"RTN","RMPRN6",130,0)
 S STN=RMPR("NAME")
"RTN","RMPRN6",131,0)
 S ^TMP($J,"RMPRGN",STN,GN,FLAG,LINE,RMPRB)=""
"RTN","RMPRN6",132,0)
 S RMSSN=$P(^RMPR(660,RMPRB,0),U,2) I RMSSN S RMSSN=$P(^DPT(RMSSN,0),U,9)
"RTN","RMPRN6",133,0)
 I RMSSN'="" S ^TMP($J,"A",RMSSN)=""
"RTN","RMPRN6",134,0)
 K RMSSN
"RTN","RMPRN6",135,0)
 Q
"RTN","RMPRN6",136,0)
 ;
"RTN","RMPRN6",137,0)
LOOP ;sort on hcpcs key and grouper is complete
"RTN","RMPRN6",138,0)
 ;store in tmp($j,"N",station) or "R"
"RTN","RMPRN6",139,0)
 S (TAM,T1,RMPRB,COUNT,CODE,RMPRAD,DATE,RMPRFG,RMPRT,RMPRI,RMPRNW,RMPRRPR)=0
"RTN","RMPRN6",140,0)
 S (TQTY,RMPROTH,CC,RMPRC,RMPRN,TT,RMPRPSC,VA,CM,RMPRCT1,SO,SI,DIS,RMPRCT,RMPR21,CODE,RMPRB,FM,LEG,RMPRNI,RMPRNO,RMPRSL,RMPRAA,RMPRPHC)=0
"RTN","RMPRN6",141,0)
 S DATE=DATE(1),RMPRB=0
"RTN","RMPRN6",142,0)
CAL ;loop through grouper key sort
"RTN","RMPRN6",143,0)
 S STN=RMPR("NAME")
"RTN","RMPRN6",144,0)
 D CODE^RMPRN63
"RTN","RMPRN6",145,0)
 S GN=""
"RTN","RMPRN6",146,0)
 F  S GN=$O(^TMP($J,"RMPRGN",STN,GN)) Q:GN=""  D
"RTN","RMPRN6",147,0)
 .S FLG=0
"RTN","RMPRN6",148,0)
 .F  S FLG=$O(^TMP($J,"RMPRGN",STN,GN,FLG)) Q:FLG'>0  D  I FLG=1&(RMPRDET'=2)!(RMPRDET'=5) Q
"RTN","RMPRN6",149,0)
 ..;used items never get grouped
"RTN","RMPRN6",150,0)
 ..I FLG=1&(RMPRDET'=2)&(RMPRDET'=5) D GROUP Q
"RTN","RMPRN6",151,0)
 ..;I FLG=1 D GROUP Q
"RTN","RMPRN6",152,0)
 ..S CODE=0
"RTN","RMPRN6",153,0)
 ..F  S CODE=$O(^TMP($J,"RMPRGN",STN,GN,FLG,CODE)) Q:CODE=""  D
"RTN","RMPRN6",154,0)
 ...S RD=0
"RTN","RMPRN6",155,0)
 ...F  S RD=$O(^TMP($J,"RMPRGN",STN,GN,FLG,CODE,RD)) Q:RD'>0  D
"RTN","RMPRN6",156,0)
 ....I RMPRDET=1!(RMPRDET=4) D SORT Q
"RTN","RMPRN6",157,0)
 ....I RMPRDET=2!(RMPRDET=5) D SORTUSED^RMPRN6S Q
"RTN","RMPRN6",158,0)
 ....I RMPRDET=3!(RMPRDET=6) D SORTBOTH^RMPRN6S Q
"RTN","RMPRN6",159,0)
 ....;D SORT
"RTN","RMPRN6",160,0)
 Q
"RTN","RMPRN6",161,0)
GROUP ;total grouper to main key
"RTN","RMPRN6",162,0)
 M BC=^TMP($J,"RMPRGN",STN,GN)
"RTN","RMPRN6",163,0)
 S BF=0,BTCOST=0,SRD=""
"RTN","RMPRN6",164,0)
 ;bc array is entrie PO 2421
"RTN","RMPRN6",165,0)
 F  S BF=$O(BC(BF)) Q:BF'>0  D
"RTN","RMPRN6",166,0)
 .;b1 is line,or code
"RTN","RMPRN6",167,0)
 .S BL=0
"RTN","RMPRN6",168,0)
 .F  S BL=$O(BC(BF,BL)) Q:BL=""  D
"RTN","RMPRN6",169,0)
 ..S BR=0
"RTN","RMPRN6",170,0)
 ..;BR is record number
"RTN","RMPRN6",171,0)
 ..F  S BR=$O(BC(BF,BL,BR)) Q:BR'>0  D
"RTN","RMPRN6",172,0)
 ...S BCOST=$P(^RMPR(660,BR,0),U,16)
"RTN","RMPRN6",173,0)
 ...S BTCOST=BTCOST+BCOST
"RTN","RMPRN6",174,0)
 ...I (BF=1)&(SRD="") S SRD=BR,CODE="",CODE=$O(BC(1,CODE))
"RTN","RMPRN6",175,0)
 K BC
"RTN","RMPRN6",176,0)
 Q:SRD=""
"RTN","RMPRN6",177,0)
 ;calculate based on primary
"RTN","RMPRN6",178,0)
 S TYPE=$P(^RMPR(660,SRD,0),U,4)
"RTN","RMPRN6",179,0)
 S TY=$S(TYPE="X":2,TYPE="I":1,1:3)
"RTN","RMPRN6",180,0)
 S SOURCE=$P(^RMPR(660,SRD,0),U,14)
"RTN","RMPRN6",181,0)
 S COST=BTCOST
"RTN","RMPRN6",182,0)
 ;stock issue display and calculate zero used cost if VA source
"RTN","RMPRN6",183,0)
 I $P(^RMPR(660,SRD,1),U,5)'=""&(SOURCE["V") S BTCOST=0,COST=0
"RTN","RMPRN6",184,0)
 I $P(^RMPR(660,SRD,0),U,13)["-3" S COST=0,SOURCE="VA",BTCOST=0
"RTN","RMPRN6",185,0)
 S QTY=$P(^RMPR(660,SRD,0),U,7)
"RTN","RMPRN6",186,0)
 S ^TMP($J,CODE,SRD)=COST
"RTN","RMPRN6",187,0)
 S CATEGRY=$P($G(^RMPR(660,SRD,"AM")),U,3),SPEC=$P($G(^("AM")),U,4),GN=$P(^("AMS"),U,1)
"RTN","RMPRN6",188,0)
 ;new or repair code
"RTN","RMPRN6",189,0)
 S B1=SRD
"RTN","RMPRN6",190,0)
 I TY=2 D REP
"RTN","RMPRN6",191,0)
 I TY'=2 D NEW
"RTN","RMPRN6",192,0)
 Q
"RTN","RMPRN6",193,0)
SORT ;main data for worksheets
"RTN","RMPRN6",194,0)
 S TYPE=$P(^RMPR(660,RD,0),U,4)
"RTN","RMPRN6",195,0)
 S TY=$S(TYPE="X":2,TYPE="I":1,1:3)
"RTN","RMPRN6",196,0)
 S SOURCE=$P(^RMPR(660,RD,0),U,14)
"RTN","RMPRN6",197,0)
 I SOURCE="" S SOURCE="C"
"RTN","RMPRN6",198,0)
 S CATEGRY=$P($G(^RMPR(660,RD,"AM")),U,3),SPEC=$P($G(^("AM")),U,4),GN=$P(^("AMS"),U,1)
"RTN","RMPRN6",199,0)
 S COST=$P(^RMPR(660,RD,0),U,16)
"RTN","RMPRN6",200,0)
 ;stock issue source VA, used cost calculation is zero
"RTN","RMPRN6",201,0)
 I $P(^RMPR(660,RD,1),U,5)'=""&(SOURCE["V") S COST=0
"RTN","RMPRN6",202,0)
 ;form
"RTN","RMPRN6",203,0)
 S FORM=$P(^RMPR(660,RD,0),U,13)
"RTN","RMPRN6",204,0)
 I (FORM=4)!(FORM=15) S COST=0,SOURCE="V"
"RTN","RMPRN6",205,0)
 S QTY=$P(^RMPR(660,RD,0),U,7)
"RTN","RMPRN6",206,0)
 S B1=RD
"RTN","RMPRN6",207,0)
 S ^TMP($J,CODE,RD)=COST
"RTN","RMPRN6",208,0)
 I TY=2 D REP
"RTN","RMPRN6",209,0)
 I TY'=2 D NEW
"RTN","RMPRN6",210,0)
 Q
"RTN","RMPRN6",211,0)
REP ;calculate repair cost
"RTN","RMPRN6",212,0)
 ;I $G(RD)'="" D
"RTN","RMPRN6",213,0)
 ;.S SSN=$P(^RMPR(660,RD,0),U,2) I SSN S SSN=$P(^DPT(SSN,0),U,9)
"RTN","RMPRN6",214,0)
 ;.I SSN'="" S ^TMP($J,"A",SSN)=""
"RTN","RMPRN6",215,0)
 ;.K SSN
"RTN","RMPRN6",216,0)
 S LINE=CODE
"RTN","RMPRN6",217,0)
 I LINE="R90 A" S SOURCE="C",QTY=1
"RTN","RMPRN6",218,0)
 I $G(^TMP($J,"R",STN,LINE))="" S ^TMP($J,"R",STN,LINE)=""
"RTN","RMPRN6",219,0)
 I SOURCE["V" S $P(^TMP($J,"R",STN,LINE),U,1)=$P(^TMP($J,"R",STN,LINE),U,1)+QTY
"RTN","RMPRN6",220,0)
 I SOURCE["C" S $P(^TMP($J,"R",STN,LINE),U,2)=$P(^TMP($J,"R",STN,LINE),U,2)+QTY
"RTN","RMPRN6",221,0)
 ;
"RTN","RMPRN6",222,0)
 S $P(^TMP($J,"R",STN,LINE),U,3)=$P(^TMP($J,"R",STN,LINE),U,3)+COST
"RTN","RMPRN6",223,0)
 I CATEGRY=1 S $P(^TMP($J,"R",STN,LINE),U,4)=$P(^TMP($J,"R",STN,LINE),U,4)+1
"RTN","RMPRN6",224,0)
 I CATEGRY=4 S $P(^TMP($J,"R",STN,LINE),U,5)=$P(^TMP($J,"R",STN,LINE),U,5)+1
"RTN","RMPRN6",225,0)
 I CATEGRY=2 S $P(^TMP($J,"R",STN,LINE),U,6)=$P(^TMP($J,"R",STN,LINE),U,6)+1
"RTN","RMPRN6",226,0)
 I CATEGRY=3 S $P(^TMP($J,"R",STN,LINE),U,7)=$P(^TMP($J,"R",STN,LINE),U,7)+1
"RTN","RMPRN6",227,0)
 I SPEC=1 S $P(^TMP($J,"R",STN,LINE),U,8)=$P(^TMP($J,"R",STN,LINE),U,8)+1
"RTN","RMPRN6",228,0)
 I SPEC=2 S $P(^TMP($J,"R",STN,LINE),U,9)=$P(^TMP($J,"R",STN,LINE),U,9)+1
"RTN","RMPRN6",229,0)
 I SPEC=3 S $P(^TMP($J,"R",STN,LINE),U,10)=$P(^TMP($J,"R",STN,LINE),U,10)+1
"RTN","RMPRN6",230,0)
 I SPEC=4 S $P(^TMP($J,"R",STN,LINE),U,11)=$P(^TMP($J,"R",STN,LINE),U,11)+1,$P(^(LINE),U,16)=$P(^(LINE),U,16)+COST
"RTN","RMPRN6",231,0)
 I TYPE="I" S $P(^TMP($J,"R",STN,LINE),U,12)=$P(^TMP($J,"R",STN,LINE),U,12)+1
"RTN","RMPRN6",232,0)
 Q
"RTN","RMPRN6",233,0)
 ;
"RTN","RMPRN6",234,0)
NEW ;calculate new costs
"RTN","RMPRN6",235,0)
 ;I $G(RD)'="" D
"RTN","RMPRN6",236,0)
 ;.S SSN=$P(^RMPR(660,RD,0),U,2) I SSN S SSN=$P(^DPT(SSN,0),U,9)
"RTN","RMPRN6",237,0)
 ;.I SSN'="" S ^TMP($J,"A",SSN)=""
"RTN","RMPRN6",238,0)
 ;.K SSN
"RTN","RMPRN6",239,0)
 S LINE=CODE
"RTN","RMPRN6",240,0)
 I $G(^TMP($J,"N",STN,LINE))="" S ^TMP($J,"N",STN,LINE)=""
"RTN","RMPRN6",241,0)
 I SOURCE["V" S $P(^TMP($J,"N",STN,LINE),U,1)=$P(^TMP($J,"N",STN,LINE),U,1)+QTY
"RTN","RMPRN6",242,0)
 I SOURCE["C" S $P(^TMP($J,"N",STN,LINE),U,2)=$P(^TMP($J,"N",STN,LINE),U,2)+QTY
"RTN","RMPRN6",243,0)
 S $P(^TMP($J,"N",STN,LINE),U,3)=$P(^TMP($J,"N",STN,LINE),U,3)+COST
"RTN","RMPRN6",244,0)
 I CATEGRY=1 S $P(^TMP($J,"N",STN,LINE),U,4)=$P(^TMP($J,"N",STN,LINE),U,4)+1
"RTN","RMPRN6",245,0)
 I CATEGRY=4 S $P(^TMP($J,"N",STN,LINE),U,5)=$P(^TMP($J,"N",STN,LINE),U,5)+1
"RTN","RMPRN6",246,0)
 I CATEGRY=2 S $P(^TMP($J,"N",STN,LINE),U,6)=$P(^TMP($J,"N",STN,LINE),U,6)+1
"RTN","RMPRN6",247,0)
 I CATEGRY=3 S $P(^TMP($J,"N",STN,LINE),U,7)=$P(^TMP($J,"N",STN,LINE),U,7)+1
"RTN","RMPRN6",248,0)
 I SPEC=1 S $P(^TMP($J,"N",STN,LINE),U,8)=$P(^TMP($J,"N",STN,LINE),U,8)+1
"RTN","RMPRN6",249,0)
 I SPEC=2 S $P(^TMP($J,"N",STN,LINE),U,9)=$P(^TMP($J,"N",STN,LINE),U,9)+1
"RTN","RMPRN6",250,0)
 I SPEC=3 S $P(^TMP($J,"N",STN,LINE),U,10)=$P(^TMP($J,"N",STN,LINE),U,10)+1
"RTN","RMPRN6",251,0)
 I SPEC=4 S $P(^TMP($J,"N",STN,LINE),U,11)=$P(^TMP($J,"N",STN,LINE),U,11)+1,$P(^(LINE),U,16)=$P(^(LINE),U,16)+COST
"RTN","RMPRN6",252,0)
 I TYPE="I" S $P(^TMP($J,"N",STN,LINE),U,12)=$P(^TMP($J,"N",STN,LINE),U,12)+1
"RTN","RMPRN6",253,0)
 Q
"RTN","RMPRN73")
0^28^B20536174
"RTN","RMPRN73",1,0)
RMPRN73 ;HINES/HNC -NPPD CALCULATIONS - CONT; 02/14/01
"RTN","RMPRN73",2,0)
 ;;3.0;PROSTHETICS;**57,70,72,77**;Feb 09, 1996
"RTN","RMPRN73",3,0)
 ;
"RTN","RMPRN73",4,0)
 ;DBIA # 801 - for this routine, the agreement covers the field
"RTN","RMPRN73",5,0)
 ;             #.05 Short Description, file #441
"RTN","RMPRN73",6,0)
 ;
"RTN","RMPRN73",7,0)
 ;DBIA #10060 - Fileman read of file #200
"RTN","RMPRN73",8,0)
 ;RVD patch 77 - defined the WHO variable.
"RTN","RMPRN73",9,0)
CODE N I,NULINE
"RTN","RMPRN73",10,0)
 ;
"RTN","RMPRN73",11,0)
 ; read in NPPD new
"RTN","RMPRN73",12,0)
 F I=1:1 S NULINE=$P($T(DES+I^RMPRN72),";;",2) Q:$E(NULINE)="R"  D
"RTN","RMPRN73",13,0)
 . S $P(^TMP($J,"N",STN,$P(NULINE,";",1)),U,15)=$P(NULINE,";",2)
"RTN","RMPRN73",14,0)
 . S ^TMP($J,"RMPRCODE",$P(NULINE,";",1))=$P(NULINE,";",2)
"RTN","RMPRN73",15,0)
 . Q
"RTN","RMPRN73",16,0)
 S $P(^TMP($J,"RMPRCODE"),U,1)=I-1 ;store number of new lines
"RTN","RMPRN73",17,0)
 ;
"RTN","RMPRN73",18,0)
 ; read in NPPD repair
"RTN","RMPRN73",19,0)
 F I=0:1 S NULINE=$P($T(REP+I^RMPRN72),";;",2) Q:$E(NULINE)'="R"  D
"RTN","RMPRN73",20,0)
 . S $P(^TMP($J,"R",STN,$P(NULINE,";",1)),U,15)=$P(NULINE,";",2)
"RTN","RMPRN73",21,0)
 . S ^TMP($J,"RMPRCODE",$P(NULINE,";",1))=$P(NULINE,";",2)
"RTN","RMPRN73",22,0)
 . Q
"RTN","RMPRN73",23,0)
 S $P(^TMP($J,"RMPRCODE"),U,2)=I ;store number of repair lines
"RTN","RMPRN73",24,0)
 Q
"RTN","RMPRN73",25,0)
HOLD ;hold screen
"RTN","RMPRN73",26,0)
 K DIR I IOST["C-" W !! S DIR(0)="E" D ^DIR S:+Y'>0 FL=1
"RTN","RMPRN73",27,0)
 Q
"RTN","RMPRN73",28,0)
HDR W @IOF S PAGE=PAGE+1
"RTN","RMPRN73",29,0)
 W !,LN,!,CODE
"RTN","RMPRN73",30,0)
 W ?10,^TMP($J,"RMPRCODE",CODE)
"RTN","RMPRN73",31,0)
 W ?35,DATE(3)," - ",DATE(4)
"RTN","RMPRN73",32,0)
 W ?70,"Page: ",PAGE
"RTN","RMPRN73",33,0)
 W !,LN,!
"RTN","RMPRN73",34,0)
 I IOM<119 W "NAME",?10,"SSN",?16,"HCPCS",?22,"QTY",?27,"TYPE",?32,"COST",?42,"DATE",?48,"ITEM",?62,"HCPCS DES",?76,"WHO",!,LN
"RTN","RMPRN73",35,0)
 I IOM>119 W "NAME",?10,"SSN",?16,"HCPCS",?22,"QTY",?27,"TYPE",?32,"COST",?42,"DATE",?48,"ITEM",?80,"HCPCS DES",?112,"WHO",?117,"#",!,LN
"RTN","RMPRN73",36,0)
 Q
"RTN","RMPRN73",37,0)
DESP ;desplay detail records
"RTN","RMPRN73",38,0)
 S FL=""
"RTN","RMPRN73",39,0)
 S CODE=""
"RTN","RMPRN73",40,0)
 F  S CODE=$O(^TMP($J,CODE)) Q:CODE="N"  G:FL=1 EXIT D
"RTN","RMPRN73",41,0)
 .D HDR
"RTN","RMPRN73",42,0)
 .S RDX=0
"RTN","RMPRN73",43,0)
 .F  S RDX=$O(^TMP($J,CODE,RDX)) D:RDX'>0 HOLD Q:RDX'>0  Q:FL=1  D
"RTN","RMPRN73",44,0)
 ..S DFN=$P(^RMPR(660,RDX,0),U,2) Q:DFN=""
"RTN","RMPRN73",45,0)
 ..D DEM^VADPT
"RTN","RMPRN73",46,0)
 ..I $Y+6>IOSL,IOST["C-" K DIR W !! S DIR(0)="E" D ^DIR S:+Y'>0 FL=1 Q:+Y'>0  D HDR
"RTN","RMPRN73",47,0)
 ..I $Y+6>IOSL,IOST'["C-" D HDR
"RTN","RMPRN73",48,0)
 ..W !,$E($P(VADM(1),",",1),1,9)
"RTN","RMPRN73",49,0)
 ..W ?10,$P(VADM(2),"-",3)
"RTN","RMPRN73",50,0)
 ..S TYPE=$P(^RMPR(660,RDX,0),U,4)
"RTN","RMPRN73",51,0)
 ..S QTY=$P(^RMPR(660,RDX,0),U,7)
"RTN","RMPRN73",52,0)
 ..S HCPCS=$P(^RMPR(661.1,$P(^RMPR(660,RDX,1),U,4),0),U,1)
"RTN","RMPRN73",53,0)
 ..S HCPCSD=$P(^RMPR(661.1,$P(^RMPR(660,RDX,1),U,4),0),U,2)
"RTN","RMPRN73",54,0)
 ..S WHO=$$GET1^DIQ(200,$P($G(^RMPR(660,RDX,0)),U,27),1)
"RTN","RMPRN73",55,0)
 ..I $G(RDX) S OPEN=$P(^RMPR(660,RDX,0),U,12)
"RTN","RMPRN73",56,0)
 ..I OPEN="" S OPEN="*"
"RTN","RMPRN73",57,0)
 ..E  S OPEN=" "
"RTN","RMPRN73",58,0)
 ..S COST=^TMP($J,CODE,RDX)
"RTN","RMPRN73",59,0)
 ..S SOURCE=$P(^RMPR(660,RDX,0),U,14)
"RTN","RMPRN73",60,0)
 ..S DATE=$P(^RMPR(660,RDX,0),U,1),DATE=$E(DATE,4,5)_"/"_$E(DATE,6,7)
"RTN","RMPRN73",61,0)
 ..S ITEM=$P(^PRC(441,$P(^RMPR(661,$P(^RMPR(660,RDX,0),U,6),0),U,1),0),U,2)
"RTN","RMPRN73",62,0)
 ..I IOM<119 W ?16,HCPCS,?22,QTY,?27,TYPE,?29,SOURCE,?32,OPEN,COST,?42,DATE,?48,$E(ITEM,1,11),?61,"|",?62,$E(HCPCSD,1,12),?76,WHO
"RTN","RMPRN73",63,0)
 ..I IOM>118 W ?16,HCPCS,?22,QTY,?27,TYPE,?29,SOURCE,?32,OPEN,COST,?42,DATE,?48,$E(ITEM,1,29),?79,"|",?80,$E(HCPCSD,1,30),?112,WHO,?117,RDX
"RTN","RMPRN73",64,0)
 Q
"RTN","RMPRN73",65,0)
DESPR ;repair dispaly
"RTN","RMPRN73",66,0)
 ;
"RTN","RMPRN73",67,0)
 S CODE="R1"
"RTN","RMPRN73",68,0)
 F  S CODE=$O(^TMP($J,CODE)) Q:CODE["RMPR"  Q:FL=1  D
"RTN","RMPRN73",69,0)
 .D HDR
"RTN","RMPRN73",70,0)
 .S RDX=0
"RTN","RMPRN73",71,0)
 .F  S RDX=$O(^TMP($J,CODE,RDX)) D:RDX'>0 HOLD Q:RDX'>0  Q:FL=1  D
"RTN","RMPRN73",72,0)
 ..S DFN=$P(^RMPR(660,RDX,0),U,2) Q:DFN=""
"RTN","RMPRN73",73,0)
 ..D DEM^VADPT
"RTN","RMPRN73",74,0)
 ..Q:FL=1
"RTN","RMPRN73",75,0)
 ..I $Y+6>IOSL,IOST["C-" K DIR W !! S DIR(0)="E" D ^DIR S:+Y'>0 FL=1 Q:+Y'>0  D HDR
"RTN","RMPRN73",76,0)
 ..I $Y+6>IOSL,IOST'["C-" D HDR
"RTN","RMPRN73",77,0)
 ..W !,$E($P(VADM(1),",",1),1,9)
"RTN","RMPRN73",78,0)
 ..W ?10,$P(VADM(2),"-",3)
"RTN","RMPRN73",79,0)
 ..S TYPE=$P(^RMPR(660,RDX,0),U,4)
"RTN","RMPRN73",80,0)
 ..S QTY=$P(^RMPR(660,RDX,0),U,7)
"RTN","RMPRN73",81,0)
 ..S SOURCE=$P(^RMPR(660,RDX,0),U,14)
"RTN","RMPRN73",82,0)
 ..I $P(^RMPR(660,RDX,0),U,17)'="" S HCPCS="#SHIP",ITEM="SHIPPING"
"RTN","RMPRN73",83,0)
 ..I $P(^RMPR(660,RDX,0),U,26)'="" S HCPCS="#PICK",ITEM="PICKUP/DEL"
"RTN","RMPRN73",84,0)
 ..S:$G(HCPCS)'["#" HCPCS=$P(^RMPR(661.1,$P(^RMPR(660,RDX,1),U,4),0),U,1)
"RTN","RMPRN73",85,0)
 ..S:$G(HCPCS)'["#" HCPCSD=$P(^RMPR(661.1,$P(^RMPR(660,RDX,1),U,4),0),U,2)
"RTN","RMPRN73",86,0)
 ..I $G(HCPCS)["#S" S HCPCSD="SHIPPING"
"RTN","RMPRN73",87,0)
 ..I $G(HCPCS)["#P" S HCPCSD="PICKUP/DEL",SOURCE="C"
"RTN","RMPRN73",88,0)
 ..I $G(RDX) S OPEN=$P(^RMPR(660,RDX,0),U,12)
"RTN","RMPRN73",89,0)
 ..S WHO=$$GET1^DIQ(200,$P($G(^RMPR(660,RDX,0)),U,27),1)
"RTN","RMPRN73",90,0)
 ..I OPEN="" S OPEN="*"
"RTN","RMPRN73",91,0)
 ..E  S OPEN=" "
"RTN","RMPRN73",92,0)
 ..S COST=^TMP($J,CODE,RDX)
"RTN","RMPRN73",93,0)
 ..;S SOURCE=$P(^RMPR(660,RDX,0),U,14)
"RTN","RMPRN73",94,0)
 ..S DATE=$P(^RMPR(660,RDX,0),U,1),DATE=$E(DATE,4,5)_"/"_$E(DATE,6,7)
"RTN","RMPRN73",95,0)
 ..S:$G(HCPCS)'["#" ITEM=$P(^PRC(441,$P(^RMPR(661,$P(^RMPR(660,RDX,0),U,6),0),U,1),0),U,2)
"RTN","RMPRN73",96,0)
 ..I IOM<119 W ?16,HCPCS,?22,QTY,?27,TYPE,?29,SOURCE,?32,OPEN,COST,?42,DATE,?48,$E(ITEM,1,12),?62,$E(HCPCSD,1,12),?76,WHO
"RTN","RMPRN73",97,0)
 ..I IOM>118 W ?16,HCPCS,?22,QTY,?27,TYPE,?29,SOURCE,?32,OPEN,COST,?42,DATE,?48,$E(ITEM,1,29),?79,"|",?80,$E(HCPCSD,1,30),?112,WHO,?117,RDX
"RTN","RMPRN73",98,0)
 ..K ITEM,HCPCSD,HCPCS
"RTN","RMPRN73",99,0)
 Q
"RTN","RMPRN73",100,0)
EXIT ;
"RTN","RMPRN73",101,0)
 Q
"RTN","RMPRN73",102,0)
 ;END
"RTN","RMPROPN")
0^9^B16465818
"RTN","RMPROPN",1,0)
RMPROPN ;PHX/RFM,JLT-LISTS OPEN 1358 TRANSACTIONS ;8/29/1994
"RTN","RMPROPN",2,0)
 ;;3.0;PROSTHETICS;**77**;Feb 09, 1996
"RTN","RMPROPN",3,0)
 ;RVD 3/17/03 patch #77 - allow queing to p-message.  IO to ION
"RTN","RMPROPN",4,0)
 W !,"This report lists open purchasing transactions created in the"
"RTN","RMPROPN",5,0)
 W !,"Prosthetic Package.  It will not include manual transactions done"
"RTN","RMPROPN",6,0)
 W !,"in the IFCAP 1358 module.",!
"RTN","RMPROPN",7,0)
START K ^TMP($J) D DIV4^RMPRSIT G:$D(X) EX S RMPRCOUN=0 D HOME^%ZIS W !! S %DT("A")="Starting Date: ",%DT="AEPX" D ^%DT S RMPRBDT=Y G:Y<0 EX
"RTN","RMPROPN",8,0)
 S %DT("A")="Ending Date: ",%DT="AEX" D ^%DT G:Y<0 EX I RMPRBDT>Y W !,$C(7),"Invalid Date Range Selection!!" G START
"RTN","RMPROPN",9,0)
 S RMPREDT=Y,Y=RMPRBDT D DD^%DT S RMPRX=Y,Y=RMPREDT D DD^%DT S RMPRY=Y
"RTN","RMPROPN",10,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EX
"RTN","RMPROPN",11,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPROPN",12,0)
 S ZTDESC="OPEN 1358 TRANSACTIONS",ZTRTN="PRINT^RMPROPN",ZTIO=ION,ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPRX")="",ZTSAVE("RMPRY")="",ZTSAVE("RMPR(""STA"")")=""
"RTN","RMPROPN",13,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EX
"RTN","RMPROPN",14,0)
PRINT S X1=RMPRBDT,X2=-1 D C^%DTC S RO=X,RP=0,PAGE=1,RMPRCOUN=0,RMPREND="" I IOST["C-" D WAIT^DICD
"RTN","RMPROPN",15,0)
 F  S RO=$O(^RMPR(664,"B",RO)) Q:RO'>0  Q:RO>RMPREDT  F  S RP=$O(^RMPR(664,"B",RO,RP)) Q:RP'>0  D CK
"RTN","RMPROPN",16,0)
 S (RP,RMPROBL)="" F  S RMPROBL=$O(^TMP($J,RMPROBL)) Q:RMPROBL'>0  Q:RMPREND=1  F  S RP=$O(^TMP($J,RMPROBL,RP)) Q:RP'>0  Q:RMPREND=1  D WRI
"RTN","RMPROPN",17,0)
 I $D(RMPREDT)&(RMPRCOUN=0) W @IOF D HDR W $C(7),!!,"NO SELECTIONS MADE DURING THIS DATE RANGE!!"
"RTN","RMPROPN",18,0)
 I $D(RMPREDT),RMPRCOUN>0,RMPREND'=1 W !!?32,"END OF REPORT" H 1
"RTN","RMPROPN",19,0)
EXIT I $E(IOST)["C"&($Y<20) F  W ! Q:$Y>20
"RTN","RMPROPN",20,0)
 I $D(RMPREDT),'$D(DTOUT),'$D(DUOUT),$E(IOST)["C",'$D(RMPRFLL),RMPREND'=1 S DIR(0)="E" D ^DIR
"RTN","RMPROPN",21,0)
EX K RMPREND,RMPROBL,RMPRFLL,RMPRFLG,DUOUT,DIR,RO,RP,RMPRY,RMPRCOUN,RMPRX,RMPRBDT,RMPREDT,RMPRCK,%DT,X,Y,PAGE,IT,ZTSK,^TMP($J) D ^%ZISC
"RTN","RMPROPN",22,0)
 Q
"RTN","RMPROPN",23,0)
CK Q:'$D(^RMPR(664,RP,0))  Q:$P(^(0),U,4)=""!($P(^(0),U,7)="")!($P(^(0),U,5)'="")!($P(^(0),U,8)'="")  Q:$P(^(0),U,14)'=""&($P(^(0),U,14)'=RMPR("STA"))  S RMPROBL=$P(^(0),U,3),^TMP($J,RMPROBL,RP)="",RMPRCOUN=RMPRCOUN+1
"RTN","RMPROPN",24,0)
 Q
"RTN","RMPROPN",25,0)
WRI I '$D(RMPRFLG) D HDR W !,"PATIENT NAME",?14,"SSN",?20,"OBLIGATION",?33,"REQUEST DATE",?48,"VENDOR",?62,"ITEM",?70,"ITEM COST"
"RTN","RMPROPN",26,0)
 W !,$E($P(^DPT($P(^RMPR(664,RP,0),U,2),0),U,1),1,12),?14,$E($P(^DPT($P(^RMPR(664,RP,0),U,2),0),U,9),6,9),?20,$P($P(^RMPR(664,RP,0),U,7),"-",2,99)
"RTN","RMPROPN",27,0)
 S Y=$P(^RMPR(664,RP,0),U,1) D DD^%DT S Y=$E(Y,1,12) W ?33,Y,?47 W:+$P(^RMPR(664,RP,0),U,4) $E($P(^PRC(440,$P(^RMPR(664,RP,0),U,4),0),U,1),1,12) D ITE
"RTN","RMPROPN",28,0)
 Q
"RTN","RMPROPN",29,0)
ITE I '$D(^RMPR(664,RP,1))&($P(^RMPR(664,RP,0),U,12)) W ?61,"*DELIVERY",?71,$J($FN($P(^RMPR(660,$P(^RMPR(664,RP,0),U,12),0),U,16),"P",2),9) S RMPRFLG=1 D:$Y>(IOSL-6) HDR Q
"RTN","RMPROPN",30,0)
 I $P(^RMPR(664,RP,0),U,12)'="" W ?61,"*SHIPPING",?71,$J($FN($P(^RMPR(660,$P(^RMPR(664,RP,0),U,12),0),U,17),"P",2),9),!
"RTN","RMPROPN",31,0)
 S (IT)=0
"RTN","RMPROPN",32,0)
 F  S IT=$O(^RMPR(664,RP,1,IT)) Q:IT'>0!($D(DUOUT))!($D(DTOUT))  W:IT>1 ! W ?61,$E($P(^PRC(441,$P(^RMPR(661,$P(^RMPR(664,RP,1,IT,0),U,1),0),U,1),0),U,2),1,10) Q:$P(^RMPR(664,RP,1,IT,0),U,13)=""  D COST
"RTN","RMPROPN",33,0)
 Q
"RTN","RMPROPN",34,0)
COST W ?71,$J($FN($P(^RMPR(660,$P(^RMPR(664,RP,1,IT,0),U,13),0),U,16),"P",2),9) S RMPRFLG=1
"RTN","RMPROPN",35,0)
 I $E(IOST)["C"&($Y>(IOSL-6)) W ! S DIR(0)="E" D ^DIR S:Y<1 RMPREND=1 Q:Y=""  S:Y<1 RMPRFLL=1 Q:Y<1  S:$D(DTOUT) RMPREND=1 Q:$D(DTOUT)  D HDR Q
"RTN","RMPROPN",36,0)
 I $Y>(IOSL-6) K RMPRFLG
"RTN","RMPROPN",37,0)
 Q
"RTN","RMPROPN",38,0)
HDR I PAGE'=1!($E(IOST)["C") W @IOF
"RTN","RMPROPN",39,0)
 W !,"FROM: ",RMPRX_"-",RMPRY,?34,"OPEN 1358 TRANSACTIONS"_"     "_"STA "_$$STA^RMPRUTIL,?72,"PAGE ",PAGE,! S PAGE=PAGE+1 Q
"RTN","RMPROPN1")
0^10^B10218467
"RTN","RMPROPN1",1,0)
RMPROPN1 ;PHX/RFM-LISTS OPEN STOCK ISSUES ;8/29/1994
"RTN","RMPROPN1",2,0)
 ;;3.0;PROSTHETICS;**13,77**;Feb 09, 1996
"RTN","RMPROPN1",3,0)
 ;RVD 3/17/03 patch #77 - allow queing to p-message.  IO to ION
"RTN","RMPROPN1",4,0)
 D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPROPN1",5,0)
START S RMPRCOUN=0 D HOME^%ZIS W !! S %DT("A")="Starting Date: ",%DT="AEPX" D ^%DT S RMPRBDT=Y G:Y<0 EXIT
"RTN","RMPROPN1",6,0)
 S %DT("A")="Ending Date: ",%DT="AEX" D ^%DT G:Y<0 EXIT I RMPRBDT>Y W !,$C(7),"Invalid Date Range Selection!!" G START
"RTN","RMPROPN1",7,0)
 S RMPREDT=Y,RMPREDT=RMPREDT+1 G:Y<0 EXIT S Y=RMPRBDT D DD^%DT S RMPRX=Y,Y=RMPREDT-1 D DD^%DT S RMPRY=Y
"RTN","RMPROPN1",8,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT
"RTN","RMPROPN1",9,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPROPN1",10,0)
 S ZTDESC="OPEN STOCK ISSUES",ZTRTN="PRINT^RMPROPN1",ZTIO=ION,ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPRX")="",ZTSAVE("RMPRY")="",ZTSAVE("RMPR(""STA"")")=""
"RTN","RMPROPN1",11,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT
"RTN","RMPROPN1",12,0)
PRINT S X1=RMPRBDT,X2=-1 D C^%DTC S RO=X,RP=0,PAGE=1,RMPRCOUN=0,RMPREND="" I IOST["C-" D WAIT^DICD
"RTN","RMPROPN1",13,0)
 F  S RO=$O(^RMPR(660,"B",RO)) Q:RO'>0  Q:RO>RMPREDT  F  S RP=$O(^RMPR(660,"B",RO,RP)) Q:RP'>0  D CK
"RTN","RMPROPN1",14,0)
 S RP=0 F  S RP=$O(^TMP($J,RP)) Q:RP=""!(RMPREND=1)  D WRI
"RTN","RMPROPN1",15,0)
 I $D(RMPREDT)&(RMPRCOUN=0) W @IOF D HDR W $C(7),!!,"NO SELECTIONS MADE DURING THIS DATE RANGE!!"
"RTN","RMPROPN1",16,0)
 I $D(RMPREDT),RMPRCOUN>0,RMPREND'=1 W !!?32,"END OF REPORT" H 1
"RTN","RMPROPN1",17,0)
EXIT I $E(IOST)["C"&($Y<20) F  W ! Q:$Y>20
"RTN","RMPROPN1",18,0)
 I $D(RMPREDT),'$D(DTOUT),'$D(DUOUT),$E(IOST)["C",'$D(RMPRFLL),RMPREND'=1 S DIR(0)="E" D ^DIR
"RTN","RMPROPN1",19,0)
EX K RMPREND,RMPROBL,RMPRFLL,RMPRFLG,DUOUT,DIR,RO,RP,RMPRY,RMPRCOUN,RMPRX,RMPRBDT,RMPREDT,RMPRCK,%DT,X,Y,PAGE,IT,ZTSK,^TMP($J) D ^%ZISC Q
"RTN","RMPROPN1",20,0)
 Q
"RTN","RMPROPN1",21,0)
CK N RMPRX
"RTN","RMPROPN1",22,0)
 S RMPRX=$G(^RMPR(660,RP,0))
"RTN","RMPROPN1",23,0)
 Q:'RMPRX
"RTN","RMPROPN1",24,0)
 Q:+$P(RMPRX,U,12)!($P(RMPRX,U,10)'=RMPR("STA"))!($P(RMPRX,U,13)=13)
"RTN","RMPROPN1",25,0)
 Q:$P(RMPRX,U,13)'>10
"RTN","RMPROPN1",26,0)
 ;screen VISA
"RTN","RMPROPN1",27,0)
 Q:$P(RMPRX,U,13)=14
"RTN","RMPROPN1",28,0)
 S ^TMP($J,RP)="",RMPRCOUN=RMPRCOUN+1
"RTN","RMPROPN1",29,0)
 Q
"RTN","RMPROPN1",30,0)
WRI I '$D(RMPRFLG) D HDR W !,"PATIENT NAME",?14,"SSN",?20,"REQUEST DATE",?34,"VENDOR",?49,"ITEM",?70,"ITEM COST"
"RTN","RMPROPN1",31,0)
 W !,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,1),1,12),?14,$E($P(^(0),U,9),6,9)
"RTN","RMPROPN1",32,0)
 S Y=$P(^RMPR(660,RP,0),U,1) D DD^%DT S Y=$E(Y,1,12) W ?20,Y,?34 I +$P(^RMPR(660,RP,0),U,9),$D(^PRC(440,$P(^(0),U,9),0)) W $E($P(^PRC(440,$P(^RMPR(660,RP,0),U,9),0),U,1),1,13)
"RTN","RMPROPN1",33,0)
 W ?49 I $D(^PRC(441,$P(^RMPR(661,+$P(^RMPR(660,RP,0),U,6),0),U),0)) W $E($P(^(0),U,2),1,18)
"RTN","RMPROPN1",34,0)
 W ?70,$J($FN(+$P(^RMPR(660,RP,0),U,16),"P",2),10)
"RTN","RMPROPN1",35,0)
 S RMPRFLG=1
"RTN","RMPROPN1",36,0)
 I $E(IOST)["C-"&($Y>(IOSL-6)) W ! S DIR(0)="E" D ^DIR S:Y<1 RMPREND=1 Q:Y=""  S:Y<1 RMPRFLL=1 Q:Y<1  S:$D(DTOUT) RMPREND=1 Q:$D(DTOUT)  D HDR Q
"RTN","RMPROPN1",37,0)
 I $Y>(IOSL-6) K RMPRFLG
"RTN","RMPROPN1",38,0)
 Q
"RTN","RMPROPN1",39,0)
HDR I PAGE'=1!($E(IOST)["C") W @IOF
"RTN","RMPROPN1",40,0)
 W !,"FROM: ",RMPRX_"-",RMPRY,?34,"OPEN STOCK ISSUES",?72,"PAGE ",PAGE,! S PAGE=PAGE+1 Q
"RTN","RMPRP55")
0^11^B31001811
"RTN","RMPRP55",1,0)
RMPRP55 ;PHX/DWL/HNB-PRINT 10-55 ;3/17/03  13:05
"RTN","RMPRP55",2,0)
 ;;3.0;PROSTHETICS;**20,55,77**;Feb 09, 1996
"RTN","RMPRP55",3,0)
 ;
"RTN","RMPRP55",4,0)
 ; ODJ - patch 55 - 1/29/01 - replace 121 hard coded mail symbol with
"RTN","RMPRP55",5,0)
 ;                            call to site param. extrinsic
"RTN","RMPRP55",6,0)
 ;                            nois AUG-1097-32118
"RTN","RMPRP55",7,0)
 ; RVD 3/17/03 patch #77 - allow queing to p-message. IO to ION
"RTN","RMPRP55",8,0)
 ;
"RTN","RMPRP55",9,0)
 I '$D(RMPR) D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPRP55",10,0)
 I $D(RMPRA) G ZIS
"RTN","RMPRP55",11,0)
EN ;ENTRY POINT FOR REPRINTING A 10-55
"RTN","RMPRP55",12,0)
 D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPRP55",13,0)
 S DIC="^RMPR(664,",DIC(0)="AEMQ",DIC("W")="D EN2^RMPRD1"
"RTN","RMPRP55",14,0)
 S DIC("A")="Select Transaction or Patient Name: "
"RTN","RMPRP55",15,0)
 S DIC("S")="I $D(^RMPR(664,Y,1)) S R1=$O(^RMPR(664,Y,1,0)) I R1 S RX=$P(^(R1,0),U,13) S:$D(^RMPR(660,+RX,0)) RX=$P(^(0),U,13)  I RX=1!(RX=10) I '$D(^RMPR(664,""AP"",RMPR(""STA""),Y))"
"RTN","RMPRP55",16,0)
 D ^DIC G:+Y<1 EXIT
"RTN","RMPRP55",17,0)
 S RMPRA=+Y,RMPRACT=1 I $P(^RMPR(664,+Y,0),U,5) D M2^RMPRM G EXIT
"RTN","RMPRP55",18,0)
 D PR^RMPR21A I %'>0 G EXIT
"RTN","RMPRP55",19,0)
 S RX=^RMPR(664,RMPRA,0)
"RTN","RMPRP55",20,0)
ZIS ;
"RTN","RMPRP55",21,0)
 I $P(^RMPR(669.9,RMPRSITE,0),U,5) S IOP="Q;"_$P(^%ZIS(1,$P(^(0),U,5),0),U,1),%ZIS="MQ" D ^%ZIS G:POP EXIT G PT
"RTN","RMPRP55",22,0)
 S %ZIS="MQ" D ^%ZIS G:POP EXIT I $D(IO("Q")) S ZTIO=ION G PT
"RTN","RMPRP55",23,0)
 U IO
"RTN","RMPRP55",24,0)
EN1 ;ADDRESS DEFINED
"RTN","RMPRP55",25,0)
 W:$E(IOST)["C" @IOF S %X="^RMPR(664,RMPRA,",%Y="R55(" D %XY^%RCR
"RTN","RMPRP55",26,0)
 S Y=DT D DD^%DT S DATE=Y,RMPRTT="" W:$D(RMPRACT) ?30,"****DUPLICATE COPY****" I $P($G(R55(4)),U,8)=1 W ?30,"***WORKING COPY***"
"RTN","RMPRP55",27,0)
 W !!!,?5,"DEPARTMENT OF VETERANS AFFAIRS" W !,?5,RMPR("NAME"),!,?5,RMPR("ADD"),!,?5,RMPR("CITY")
"RTN","RMPRP55",28,0)
ADD ;ADDRESS INFO
"RTN","RMPRP55",29,0)
 S RMPRUP=0,I=0,RMPRV=$P(^RMPR(664,RMPRA,0),U,4),RMPRV=^PRC(440,RMPRV,0),RMPRST=$P(RMPRV,U,7),RMPRST=$S(RMPRST="":"NO STATE",1:$P(^DIC(5,RMPRST,0),U,2)),RMPRDUZ="",RMPRDUZ=$P(^RMPR(664,RMPRA,0),U,9),RMPRDUZ=$P(^VA(200,RMPRDUZ,0),U,1)
"RTN","RMPRP55",30,0)
 S RMPRDFN=$P(^RMPR(664,RMPRA,0),U,2)
"RTN","RMPRP55",31,0)
 S I=$O(^RMPR(664,RMPRA,1,I))
"RTN","RMPRP55",32,0)
 S RMPRI=$P(^RMPR(664,RMPRA,1,I,0),U,1)
"RTN","RMPRP55",33,0)
 S RMPRUP=$O(^RMPR(665,"C",RMPRI,RMPRDFN,RMPRUP))
"RTN","RMPRP55",34,0)
 S:RMPRUP RMPRSN=$P(^RMPR(665,RMPRDFN,5,RMPRUP,0),U,3)
"RTN","RMPRP55",35,0)
 ;Should call VADPT not look at global directly
"RTN","RMPRP55",36,0)
 S RMPRNAM=$P(^DPT(RMPRDFN,0),U,1)
"RTN","RMPRP55",37,0)
 S RMPRSSN=$P(^DPT(RMPRDFN,0),U,9)
"RTN","RMPRP55",38,0)
 S RMPRTN=$P(^RMPR(664,RMPRA,0),U,7)
"RTN","RMPRP55",39,0)
WRITE W !!!!!,?5,$P(RMPRV,U,1),?53,"In Reply Refer to:",?73,$$STA^RMPRUTIL_"-",$$ROU^RMPRUTIL(RMPRSITE),!,?5,$P(RMPRV,U,2),?53,RMPRNAM
"RTN","RMPRP55",40,0)
 W !?5,$P(RMPRV,U,6),", ",RMPRST," ",$P(RMPRV,U,8)
"RTN","RMPRP55",41,0)
 W ?53,$E(RMPRSSN,1,3)_"-"_$E(RMPRSSN,4,5)_"-"_$E(RMPRSSN,6,9),!,?53,RMPRTN
"RTN","RMPRP55",42,0)
 W !!,?5,$P(RMPRV,U,1),!!,?5,"With reference to your request of ",?39,$E($P(^RMPR(664,RMPRA,0),U,1),4,5),"/",$E($P(^RMPR(664,RMPRA,0),U,1),6,7),"/",$E($P(^RMPR(664,RMPRA,0),U,1),2,3),", authority is granted to repair "
"RTN","RMPRP55",43,0)
 W !,?5,"the appliance described below for the above-named veteran."
"RTN","RMPRP55",44,0)
DESC ;ITEM,DES,COST,QTY
"RTN","RMPRP55",45,0)
 S $P(LINE,".",75)=""
"RTN","RMPRP55",46,0)
 W !!,?5,LINE,!,?23,"DESCRIPTION OF APPLIANCE OR REPAIR",!,?63,"Unit",?73,"Total",!,?5,"Item",?11,"Name",?32,"Serial Number",?55,"Qty",?63,"Price",?73,"Cost",!,?5,LINE
"RTN","RMPRP55",47,0)
 S I=0,RMPRTO=0 F I=0:0 S I=$O(^RMPR(664,RMPRA,1,I)),RMPRDFN="" G COST:I'>0 D LIST
"RTN","RMPRP55",48,0)
COST S X=RMPRTO,X2="2$",X3=9 D COMMA^%DTC
"RTN","RMPRP55",49,0)
 W !!,?5,"The total cost, not including mailing cost, will not exceed ",?RR+1,X,!!,?5,"When repairs are completed, please attach the original of this letter to"
"RTN","RMPRP55",50,0)
 W !,?5,"the original copy of your invoice covering repair charges.  Your invoice,",!,?5,"in original and one copy should then be forwarded to this office for"
"RTN","RMPRP55",51,0)
 W !?5,"payment.",!!?5,"Please retain the duplicate  copy of this letter for your files."
"RTN","RMPRP55",52,0)
 W !!,?5,"Sincerely,",!!!!,?5,RMPR("SIG"),", Chief",!,?5,RMPR("SBT")
"RTN","RMPRP55",53,0)
END S L=19-RMPRTT F I=1:1:L W !
"RTN","RMPRP55",54,0)
 W ?5,"Initiator: ",RMPRDUZ,?45,"REF: ",RMPRA,?64,"ADP FORM 10-55" D:$D(RMPRPRIV) ^RMPRP23
"RTN","RMPRP55",55,0)
EXIT K RMPRACT,ZTSK,RX,RMPRI,RMPRTN,RMPRDS,RMPRQT,RMPRCT,RMPRTO,RMPRUP,RR,I,DATE,DIC,RG,L,LINE,RMPRA,RMPRDFN,RMPRIS,RMPRNAM,RMPRNM,RMPRSN,RMPRSSN,RMPRST,RMPRTT,RMPRPRIV,RMPRCC,RXT,RX1
"RTN","RMPRP55",56,0)
 K RMPRV,X2,X3,RMPRDUZ,RMPRI1,RMPRIT,RMPRN,VA,VAEL,RZZZ,VAERR,Y,RMPRPRIV,RTX D ^%ZISC Q
"RTN","RMPRP55",57,0)
LIST S RR=^RMPR(664,RMPRA,1,I,0),RMPRIS=$P(RR,U,5),RMPRIS=$P(^PRCD(420.5,RMPRIS,0),U,1),RMPRI=$P(RR,U,1),RMPRI=$P(^RMPR(661,RMPRI,0),U,1),RMPRI=^PRC(441,RMPRI,0),RMPRNM=$P(RMPRI,U,2),RMPRI=$P(RMPRI,U,1)
"RTN","RMPRP55",58,0)
 S RMPRCT=$P(RR,U,3),RMPRQT=$P(RR,U,4),RMPRTO=(RMPRCT*RMPRQT)+RMPRTO,RMPRDS=$P(RR,U,2),X=RMPRCT,X2="2$",X3=9 D COMMA^%DTC S RR=$L(X),RR=79-RR W !,?5,RMPRI,?11,$E(RMPRNM,1,18),?32,$G(RMPRSN),?56,RMPRQT,?59,X,!,?11,RMPRDS
"RTN","RMPRP55",59,0)
 I $P(^RMPR(664,RMPRA,0),U,10)!($P(^(0),U,11)) S RR=$S($P(^(0),U,11):$P(^(0),U,11),1:$P(^(0),U,10)) I RR S X=RR,X2="2$",X3=9 D COMMA^%DTC S RR=$L(X),RR=79-RR W !,?32,"Shipping Charge: ",?59,X,!
"RTN","RMPRP55",60,0)
 I $D(R55(1,1,1,0)) F RTX=0:0 S RTX=$O(R55(1,1,1,RTX)) Q:RTX'>0  W !,?5,R55(1,1,1,RTX,0)
"RTN","RMPRP55",61,0)
CNTER S RMPRTT=(RMPRTT+1) K R55 Q
"RTN","RMPRP55",62,0)
PT F RG="DT","RMPRSITE","RMPRA","RMPRUP","RMPR(" S ZTSAVE(RG)="" S:$D(RMPRACT) ZTSAVE("RMPRACT")="" S:$D(RMPRPRIV) ZTSAVE("RMPRPRIV")=""
"RTN","RMPRP55",63,0)
 I $D(IO("Q")) S ZTRTN="EN1^RMPRP55",ZTDTH=$H,ZTDESC="PROSTHETICS PRINT OF 10-55",ZTIO=ION D ^%ZTLOAD
"RTN","RMPRP55",64,0)
 W !,$S($D(ZTSK):"<REQUEST QUEUED!>",1:"<REQUEST DID NOT QUEUE!>")
"RTN","RMPRP55",65,0)
 D HOME^%ZIS G EXIT
"RTN","RMPRPAT7")
0^12^B1666656
"RTN","RMPRPAT7",1,0)
RMPRPAT7 ;HINES-CIOFO/HNC DISPLAY NPPD KEY ITEMS CONSOLIDATED
"RTN","RMPRPAT7",2,0)
 ;;3.0;PROSTHETICS;**32,34,35,77**;Feb 14, 1998
"RTN","RMPRPAT7",3,0)
 ;;
"RTN","RMPRPAT7",4,0)
 ;RVD 3/18/03 patch #77 - only prints item for the same pt.
"RTN","RMPRPAT7",5,0)
 W !,?5,"PSAS HCPCS",?18,"DESCRIPTION",?48,"QTY",?52,"COST",?62,"ITEM"
"RTN","RMPRPAT7",6,0)
 W !,RMPR("L") S HCTOT=0
"RTN","RMPRPAT7",7,0)
 S HCREC=$P(IT(AN),U,1) Q:HCREC'>0
"RTN","RMPRPAT7",8,0)
 S HC=$G(R19(660,HCREC,68,"E")) Q:HC=""
"RTN","RMPRPAT7",9,0)
 S HC1=0
"RTN","RMPRPAT7",10,0)
 F  S HC1=$O(^RMPR(660,"AG",HC,HC1)) Q:HC1'>0  D
"RTN","RMPRPAT7",11,0)
 .Q:$P($G(^RMPR(660,HC1,0)),U,10)'=RMPR("STA")
"RTN","RMPRPAT7",12,0)
 .I $P(^RMPR(660,HC1,0),U,2)'=RMPRDFN Q
"RTN","RMPRPAT7",13,0)
 .S HCQTY=$P(^RMPR(660,HC1,0),U,7)
"RTN","RMPRPAT7",14,0)
 .S HCCOST=$P(^RMPR(660,HC1,0),U,16)
"RTN","RMPRPAT7",15,0)
 .S HCTOT=HCTOT+HCCOST
"RTN","RMPRPAT7",16,0)
 .S HCRK=$P(^RMPR(660,HC1,0),U,6)
"RTN","RMPRPAT7",17,0)
 .I HCRK S HCRK=$P(^RMPR(661,HCRK,0),U,1),HCRK=$P(^PRC(441,HCRK,0),U,2)
"RTN","RMPRPAT7",18,0)
 .S HCHCP=$P($G(^RMPR(660,HC1,1)),U,4)
"RTN","RMPRPAT7",19,0)
 .I HCHCP S HCHCPS=$P(^RMPR(661.1,HCHCP,0),U,1),HCHCPSD=$P(^(0),U,2)
"RTN","RMPRPAT7",20,0)
 .W !,?5,$G(HCHCPS),?18,$G(HCHCPSD)
"RTN","RMPRPAT7",21,0)
 .W ?48,HCQTY
"RTN","RMPRPAT7",22,0)
 .W ?52,"$"_$J($FN(HCCOST,"P",2),9)
"RTN","RMPRPAT7",23,0)
 .W ?62,$E(HCRK,1,18)
"RTN","RMPRPAT7",24,0)
 W !,?52,"========="
"RTN","RMPRPAT7",25,0)
 W !,?52,"$"_$J($FN(HCTOT,"P",2),9)
"RTN","RMPRPAT7",26,0)
 ;END
"RTN","RMPRPCE1")
0^24^B18373171
"RTN","RMPRPCE1",1,0)
RMPRPCE1 ;HCIOFO/RVD - Prosthetics/PCE UPDATE UTILITY ;5/7/03  09:12
"RTN","RMPRPCE1",2,0)
 ;;3.0;PROSTHETICS;**62,69,77**;Feb 09, 1996
"RTN","RMPRPCE1",3,0)
 ;
"RTN","RMPRPCE1",4,0)
 ;  patch #69
"RTN","RMPRPCE1",5,0)
 ;RVD 4/10/02 - validate the length (16 c) of provisional diagnosis
"RTN","RMPRPCE1",6,0)
 ;              before filing.  Change Routine Prosthetic to ROUTINE
"RTN","RMPRPCE1",7,0)
 ;              Type of Request field in 660.
"RTN","RMPRPCE1",8,0)
 ;RVD 5/6/03 patch #77 - SET Consult Request Service field in #660.
"RTN","RMPRPCE1",9,0)
 ;                     - POST init for setting Consult Request Service. 
"RTN","RMPRPCE1",10,0)
 ;
"RTN","RMPRPCE1",11,0)
 ;DBIA # 10060, Fileman read of file #200.
"RTN","RMPRPCE1",12,0)
 ;
"RTN","RMPRPCE1",13,0)
 ;This routine contains the code for updating file #660 and #668.
"RTN","RMPRPCE1",14,0)
 ;
"RTN","RMPRPCE1",15,0)
 ;RMIE60 - ien of file #660
"RTN","RMPRPCE1",16,0)
UP60(RMIE60,RMIE68,RMSUSTAT) ; update file #660.
"RTN","RMPRPCE1",17,0)
 D NEWVAR
"RTN","RMPRPCE1",18,0)
 S RMERR=0
"RTN","RMPRPCE1",19,0)
 S:RMSUSTAT="" RMSUSTAT=0
"RTN","RMPRPCE1",20,0)
 L +^RMPR(660,RMIE60):2
"RTN","RMPRPCE1",21,0)
 I $T=0 W !,"Someone else is Editing this entry!!!",! H 3 S RMERR=1 G UP60X
"RTN","RMPRPCE1",22,0)
 S RM680=$G(^RMPR(668,RMIE68,0))
"RTN","RMPRPCE1",23,0)
 S RM688=$G(^RMPR(668,RMIE68,8))
"RTN","RMPRPCE1",24,0)
 S RM6810=$G(^RMPR(668,RMIE68,10))
"RTN","RMPRPCE1",25,0)
 ;code here for 668 fields
"RTN","RMPRPCE1",26,0)
 S RMDATE=$P(RM680,U,1)
"RTN","RMPRPCE1",27,0)
 S RMCODT=$P(RM680,U,5)
"RTN","RMPRPCE1",28,0)
 S RMINDT=$P(RM680,U,9)
"RTN","RMPRPCE1",29,0)
 S RMPRCO=$P(RM680,U,15)
"RTN","RMPRPCE1",30,0)
 S RMDWRT=$P(RM680,U,16)
"RTN","RMPRPCE1",31,0)
 S RMSTAT=$P(RM680,U,7)
"RTN","RMPRPCE1",32,0)
 S RMTRES=$P(RM680,U,8)
"RTN","RMPRPCE1",33,0)
 S RMTYRE=$S(RMTRES=1:"ROUTINE",RMTRES=2:"EYEGLASS",RMTRES=3:"CONTACT LENS",RMTRES=4:"OXYGEN",RMTRES=5:"MANUAL",1:"")
"RTN","RMPRPCE1",34,0)
 S RMREQU=$P(RM680,U,11)
"RTN","RMPRPCE1",35,0)
 S RMSERV=""
"RTN","RMPRPCE1",36,0)
 I $G(RMREQU) D GETS^DIQ(200,RMREQU,"29","E","RMAA") S RMSERV=RMAA(200,RMREQU_",",29,"E")
"RTN","RMPRPCE1",37,0)
 S RMPRDI=$E($P(RM688,U,2),1,16)
"RTN","RMPRPCE1",38,0)
 S RMICD9=$P(RM688,U,3)
"RTN","RMPRPCE1",39,0)
 ;
"RTN","RMPRPCE1",40,0)
 S RMDAT(660,RMIE60_",",8.1)=RMDATE
"RTN","RMPRPCE1",41,0)
 S RMDAT(660,RMIE60_",",8.2)=RMDWRT
"RTN","RMPRPCE1",42,0)
 S RMDAT(660,RMIE60_",",8.3)=RMINDT
"RTN","RMPRPCE1",43,0)
 S RMDAT(660,RMIE60_",",8.4)=RMCODT
"RTN","RMPRPCE1",44,0)
 S RMDAT(660,RMIE60_",",8.5)=RMTYRE
"RTN","RMPRPCE1",45,0)
 S RMDAT(660,RMIE60_",",8.6)=RMREQU
"RTN","RMPRPCE1",46,0)
 S RMDAT(660,RMIE60_",",8.61)=RMSERV
"RTN","RMPRPCE1",47,0)
 S RMDAT(660,RMIE60_",",8.7)=RMPRDI
"RTN","RMPRPCE1",48,0)
 S RMDAT(660,RMIE60_",",8.8)=RMICD9
"RTN","RMPRPCE1",49,0)
 S RMDAT(660,RMIE60_",",8.9)=RMPRCO
"RTN","RMPRPCE1",50,0)
 S RMDAT(660,RMIE60_",",8.11)=RMSTAT
"RTN","RMPRPCE1",51,0)
 S RMDAT(660,RMIE60_",",8.14)=RMSUSTAT
"RTN","RMPRPCE1",52,0)
 D FILE^DIE("","RMDAT","RMERROR")
"RTN","RMPRPCE1",53,0)
 I $D(RMERROR) S RMERR=1 D ERR0
"RTN","RMPRPCE1",54,0)
 ;
"RTN","RMPRPCE1",55,0)
 L -^RMPR(660,RMIE60)
"RTN","RMPRPCE1",56,0)
UP60X ; exit point
"RTN","RMPRPCE1",57,0)
 Q RMERR
"RTN","RMPRPCE1",58,0)
 ;
"RTN","RMPRPCE1",59,0)
 ;RMIE60 = IEN of file #660.
"RTN","RMPRPCE1",60,0)
 ;RMIE68 = IEN of file #668.
"RTN","RMPRPCE1",61,0)
UP68(RMIE60,RMIE68,RMAMIS) ; update file #668.
"RTN","RMPRPCE1",62,0)
 D NEWVAR
"RTN","RMPRPCE1",63,0)
 S (RMI,RMERR)=0
"RTN","RMPRPCE1",64,0)
 ;S RMAMIS=$G(^RMPR(660,RMIE60,"AMS"))
"RTN","RMPRPCE1",65,0)
 I '$G(RMAMIS) D ERR8 S RMERR=1 G UP68X
"RTN","RMPRPCE1",66,0)
 ;L +^RMPR(668,RMIE68):2
"RTN","RMPRPCE1",67,0)
 ;I $T=0 W !,"Someone else is Editing this entry!!!",! H 3 S RMERR=1 G UP68X
"RTN","RMPRPCE1",68,0)
 I $D(^RMPR(668,RMIE68,10,"B",RMIE60)) G UP68X
"RTN","RMPRPCE1",69,0)
 S DA(1)=RMIE68 K DD,DO
"RTN","RMPRPCE1",70,0)
 S DIC="^RMPR(668,"_DA(1)_","_"10,",DIC(0)="L",DLAYGO=668,X=RMIE60
"RTN","RMPRPCE1",71,0)
 D FILE^DICN K DIC,X,DLAYGO,DD,DO
"RTN","RMPRPCE1",72,0)
 I Y=-1 S RMERR=1 D ERR8 G UNL68
"RTN","RMPRPCE1",73,0)
 I $D(^RMPR(668,RMIE68,11,"B",RMAMIS)) G UP68X
"RTN","RMPRPCE1",74,0)
 S DA(1)=RMIE68
"RTN","RMPRPCE1",75,0)
 S DIC="^RMPR(668,"_DA(1)_","_"11,",DIC(0)="L",DLAYGO=668,X=RMAMIS
"RTN","RMPRPCE1",76,0)
 D FILE^DICN K DIC
"RTN","RMPRPCE1",77,0)
 I Y=-1 S RMERR=1 D ERR8 G UNL68
"RTN","RMPRPCE1",78,0)
 ;
"RTN","RMPRPCE1",79,0)
UNL68 ;L -^RMPR(668,RMIE68)
"RTN","RMPRPCE1",80,0)
UP68X ; exit point
"RTN","RMPRPCE1",81,0)
 Q RMERR
"RTN","RMPRPCE1",82,0)
 ;
"RTN","RMPRPCE1",83,0)
ERR0 ;error updating file #660
"RTN","RMPRPCE1",84,0)
 W !,"*** Error updating file #660 in PCE module!!!",!
"RTN","RMPRPCE1",85,0)
 Q
"RTN","RMPRPCE1",86,0)
ERR8 ;error updating file #668
"RTN","RMPRPCE1",87,0)
 W !,"*** Error updating file #668 in PCE module!!!",!
"RTN","RMPRPCE1",88,0)
 Q
"RTN","RMPRPCE1",89,0)
LINK ;link 2319 to suspense
"RTN","RMPRPCE1",90,0)
 D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPRPCE1",91,0)
 K ^TMP($J)
"RTN","RMPRPCE1",92,0)
 W ! S DIC="^RMPR(660,",DIC(0)="AEMQZ",DIC("A")="Select PATIENT: "
"RTN","RMPRPCE1",93,0)
 S DIC("S")="S RMZ=$G(^RMPR(660,+Y,10)) I $P(RMZ,U,14)'=1,$D(^(""AMS"")),RMPR(""STA"")=$P(^(0),U,10)"
"RTN","RMPRPCE1",94,0)
 S DIC("W")="D EN^RMPRD1"
"RTN","RMPRPCE1",95,0)
 W !
"RTN","RMPRPCE1",96,0)
 D ^DIC G:Y'>0 EXIT
"RTN","RMPRPCE1",97,0)
 L +^RMPR(660,+Y):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPRPCE1",98,0)
 S RMPRDA=+Y
"RTN","RMPRPCE1",99,0)
 S RMPRDFN=$P(^RMPR(660,+Y,0),U,2)
"RTN","RMPRPCE1",100,0)
 I $D(^RMPR(660,+Y,"AMS")) S RMPRAMIS=$P(^RMPR(660,+Y,"AMS"),U,1)
"RTN","RMPRPCE1",101,0)
 S ^TMP($J,"RMPRPCE",660,+Y)=RMPRAMIS_"^"_RMPRDFN
"RTN","RMPRPCE1",102,0)
 D LINK^RMPRS
"RTN","RMPRPCE1",103,0)
 L -^RMPR(660,RMPRDA)
"RTN","RMPRPCE1",104,0)
EXIT ;quit
"RTN","RMPRPCE1",105,0)
 K ^TMP($J)
"RTN","RMPRPCE1",106,0)
 N RMPR,RMPRSTE
"RTN","RMPRPCE1",107,0)
 D KILL^XUSCLEAN
"RTN","RMPRPCE1",108,0)
 Q
"RTN","RMPRPCE1",109,0)
 ;
"RTN","RMPRPCE1",110,0)
SCRS ;set consult request service.
"RTN","RMPRPCE1",111,0)
 ;start conversion on 1/1/2002, the date of PCE/Link to suspense patch.
"RTN","RMPRPCE1",112,0)
 W !!,"Setting Consult Request Service in file #660....."
"RTN","RMPRPCE1",113,0)
 F RI=3020100:0 S RI=$O(^RMPR(660,"B",RI)) Q:RI'>0  F RJ=0:0 S RJ=$O(^RMPR(660,"B",RI,RJ)) Q:RJ'>0  I $D(^RMPR(660,RJ,10)) D
"RTN","RMPRPCE1",114,0)
 .K RMAA
"RTN","RMPRPCE1",115,0)
 .S RMREQU=$P(^RMPR(660,RJ,10),U,6)
"RTN","RMPRPCE1",116,0)
 .S RMSERV=""
"RTN","RMPRPCE1",117,0)
 .I $G(RMREQU) D GETS^DIQ(200,RMREQU,"29","E","RMAA") S RMSERV=RMAA(200,RMREQU_",",29,"E")
"RTN","RMPRPCE1",118,0)
 .S:RMSERV'="" $P(^RMPR(660,RJ,4),U,3)=RMSERV
"RTN","RMPRPCE1",119,0)
 W !!,"Done setting Consult Request Service!!",!
"RTN","RMPRPCE1",120,0)
 Q
"RTN","RMPRPCE1",121,0)
 ;
"RTN","RMPRPCE1",122,0)
NEWVAR N DA,DIE,DIC,I,J,RMDFN,RMI,RMDATE,RM680,RM688,RM6810,RMERROR
"RTN","RMPRPCE1",123,0)
 N RMERR,RMCHK,RMAMIS,DLAYGO,X,DR,RMAA,RMSERV,RMREQU
"RTN","RMPRPCE1",124,0)
 Q
"RTN","RMPRPCEB")
0^13^B17871246
"RTN","RMPRPCEB",1,0)
RMPRPCEB ;HIN/RVD-PROS PCE BACKGROUND UTILITY ;4/25/03  08:34
"RTN","RMPRPCEB",2,0)
 ;;3.0;PROSTHETICS;**62,69,77**;Feb 09, 1996
"RTN","RMPRPCEB",3,0)
 ;
"RTN","RMPRPCEB",4,0)
 ;RVD patch #69 - add STATION in the error message.
"RTN","RMPRPCEB",5,0)
 ;                QUIT if no data in specified date range.
"RTN","RMPRPCEB",6,0)
 ;RVD patch #77 - only create 1 PCE entry for the same pt & same day.
"RTN","RMPRPCEB",7,0)
 ;
"RTN","RMPRPCEB",8,0)
 W !,"Invalid Entry Point.....",!
"RTN","RMPRPCEB",9,0)
 Q
"RTN","RMPRPCEB",10,0)
TASK ;entry point for task job to send pros encounters to PCE.
"RTN","RMPRPCEB",11,0)
 S IO=0,RMAIL=1
"RTN","RMPRPCEB",12,0)
 S Y=DT D DD^%DT S RMRDAT=Y K RMX,RMXMT,^TMP($J)
"RTN","RMPRPCEB",13,0)
 D NOW^%DTC S RMSTDT=%
"RTN","RMPRPCEB",14,0)
 S X="T-90" D ^%DT S RM90DAY=Y
"RTN","RMPRPCEB",15,0)
 S RMBIEN=$O(^RMPR(660,"B",RM90DAY))
"RTN","RMPRPCEB",16,0)
 Q:RMBIEN=""
"RTN","RMPRPCEB",17,0)
 S (RMENDT,RFLDAT)=0
"RTN","RMPRPCEB",18,0)
 F RS=0:0 S RS=$O(^RMPR(669.9,RS)) Q:RS'>0  D PCEFLG
"RTN","RMPRPCEB",19,0)
 S RI=$O(^RMPR(660,"B",RMBIEN,0))
"RTN","RMPRPCEB",20,0)
 F  S RI=$O(^RMPR(660,RI)) Q:RI'>0  D
"RTN","RMPRPCEB",21,0)
 .S RM600=$G(^RMPR(660,RI,0))
"RTN","RMPRPCEB",22,0)
 .S RM611=$G(^RMPR(660,RI,1))
"RTN","RMPRPCEB",23,0)
 .S RM610=$G(^RMPR(660,RI,10))
"RTN","RMPRPCEB",24,0)
 .Q:$P(RM600,U,15)
"RTN","RMPRPCEB",25,0)
 .Q:$P(RM600,U,17)
"RTN","RMPRPCEB",26,0)
 .Q:'$P(RM610,U,8)
"RTN","RMPRPCEB",27,0)
 .S RMSTA=$P(RM600,U,10)
"RTN","RMPRPCEB",28,0)
 .;quit if already been processed.
"RTN","RMPRPCEB",29,0)
 .Q:$P(RM610,U,12)
"RTN","RMPRPCEB",30,0)
 .Q:(RMSTA="")!('$D(RSTAFLG(RMSTA)))
"RTN","RMPRPCEB",31,0)
 .Q:'$P(RM611,U,4)!'$P(RM600,U,22)
"RTN","RMPRPCEB",32,0)
 .S RMDATE=$P(RM600,U,1),RMDFN=$P(RM600,U,2)
"RTN","RMPRPCEB",33,0)
 .S RMICD9=$P(RM610,U,8)
"RTN","RMPRPCEB",34,0)
 .Q:$D(^TMP($J,RMSTA,RMDATE,RMDFN))
"RTN","RMPRPCEB",35,0)
 .S RMPROCF=0
"RTN","RMPRPCEB",36,0)
 .F J=0:0 S J=$O(^RMPR(660,"C",RMDFN,J)) Q:J'>0  D
"RTN","RMPRPCEB",37,0)
 ..S RMJ60=$G(^RMPR(660,J,0)),RMJDT=$P(RMJ60,U,1),RMJST=$P(RMJ60,U,10)
"RTN","RMPRPCEB",38,0)
 ..Q:(RMJST'=RMSTA)!(RMJDT'=RMDATE)
"RTN","RMPRPCEB",39,0)
 ..S RMJ610=$G(^RMPR(660,J,10)),RMJ12=$P(RMJ610,U,12)
"RTN","RMPRPCEB",40,0)
 ..I $G(RMJ12) S RMPROCF=1
"RTN","RMPRPCEB",41,0)
 .;don't process if PCE data was process for the same day.
"RTN","RMPRPCEB",42,0)
 .Q:$G(RMPROCF)
"RTN","RMPRPCEB",43,0)
 .S ^TMP($J,RMSTA,RMDATE,RMDFN,RI)=""
"RTN","RMPRPCEB",44,0)
 ;
"RTN","RMPRPCEB",45,0)
 D PROC
"RTN","RMPRPCEB",46,0)
 ;I $D(^TMP($J,"RMPRERR")) D ERR
"RTN","RMPRPCEB",47,0)
 I '$D(^TMP($J,"RMPRERR")) D
"RTN","RMPRPCEB",48,0)
 .S ^TMP($J,"RMPR",5)="***** NO ERROR TO REPORT !!!!!"
"RTN","RMPRPCEB",49,0)
 S RMSUBI=4 D BUILD D:$D(^XMB(3.8,"B","RMPR PCE")) MES1,MES2
"RTN","RMPRPCEB",50,0)
 G EXIT
"RTN","RMPRPCEB",51,0)
 ;
"RTN","RMPRPCEB",52,0)
PCEFLG ;
"RTN","RMPRPCEB",53,0)
 S:$D(^RMPR(669.9,RS,"PCE")) RFLDAT=$P($G(^RMPR(669.9,RS,"PCE")),U,2)
"RTN","RMPRPCEB",54,0)
 S:'$D(^RMPR(669.9,RS,"PCE")) RFLDAT=0
"RTN","RMPRPCEB",55,0)
 S RSTAFLG($P(^RMPR(669.9,RS,0),U,2))=RFLDAT
"RTN","RMPRPCEB",56,0)
 S $P(^RMPR(669.9,RS,"PCE"),U,1)=RMSTDT
"RTN","RMPRPCEB",57,0)
 Q
"RTN","RMPRPCEB",58,0)
 ;
"RTN","RMPRPCEB",59,0)
PROC ;process
"RTN","RMPRPCEB",60,0)
 F RS=0:0 S RS=$O(^TMP($J,RS)) Q:RS'>0  F RII=0:0 S RII=$O(^TMP($J,RS,RII)) Q:RII'>0  F RJ=0:0 S RJ=$O(^TMP($J,RS,RII,RJ)) Q:RJ'>0  S RK=$O(^TMP($J,RS,RII,RJ,0)) D
"RTN","RMPRPCEB",61,0)
 .;call PCE Interface
"RTN","RMPRPCEB",62,0)
 .S RMIE60RK=RK
"RTN","RMPRPCEB",63,0)
 .S RMC=$$SENDPCE^RMPRPCEA(RK)
"RTN","RMPRPCEB",64,0)
 .I RMC<1 D
"RTN","RMPRPCEB",65,0)
 ..S RSNAM="        "
"RTN","RMPRPCEB",66,0)
 ..I $G(RS),$D(^DIC(4,RS,0)) S RSNAM=$E($P(^DIC(4,RS,0),U,1),1,8)
"RTN","RMPRPCEB",67,0)
 ..S ^TMP($J,"RMPRERR",RK)="Station: "_RSNAM_", File #660 IEN="_RK_" - Error in PCE interface!!!"
"RTN","RMPRPCEB",68,0)
 ..I $D(RMPROB($J,1))!$D(RMPROB($J,2)) D
"RTN","RMPRPCEB",69,0)
 ...S (R2,R3,RMMESS)="",R6I=RK,RC=0
"RTN","RMPRPCEB",70,0)
 ...F R1=0:0 S R1=$O(RMPROB($J,R1)) Q:R1'>0  S RC=RC+1 F  S R2=$O(RMPROB($J,R1,"ERROR1",R2)) Q:R2=""  F  S R3=$O(RMPROB($J,R1,"ERROR1",R2,R3)) Q:R3=""  D
"RTN","RMPRPCEB",71,0)
 ....F R4=0:0 S R4=$O(RMPROB($J,R1,"ERROR1",R2,R3,R4)) Q:R4'>0  D
"RTN","RMPRPCEB",72,0)
 .....S RMMESS=RMPROB($J,R1,"ERROR1",R2,R3,R4),RMK=R6I_"."_RC,^TMP($J,"RMPRERR",RMK)="    ???? "_$E(RMMESS,1,65)
"RTN","RMPRPCEB",73,0)
 Q
"RTN","RMPRPCEB",74,0)
 ;
"RTN","RMPRPCEB",75,0)
MES1 ;
"RTN","RMPRPCEB",76,0)
 S XMY("G.RMPR PCE")="",XMDUZ=.5,XMTEXT="^TMP($J,""RMPR"","
"RTN","RMPRPCEB",77,0)
 S XMSUB="PROSTHETICS PCE BACKGROUND MESSAGE"
"RTN","RMPRPCEB",78,0)
 S ^TMP($J,"RMPR",1)="Run Date: "_RMRDAT
"RTN","RMPRPCEB",79,0)
 S ^TMP($J,"RMPR",2)="This is a notification from the Prosthetics Department........"
"RTN","RMPRPCEB",80,0)
 S ^TMP($J,"RMPR",3)=""
"RTN","RMPRPCEB",81,0)
 S ^TMP($J,"RMPR",4)=""
"RTN","RMPRPCEB",82,0)
 Q
"RTN","RMPRPCEB",83,0)
MES2 ;
"RTN","RMPRPCEB",84,0)
 S ^TMP($J,"RMPR",RMSUBI+2)=""
"RTN","RMPRPCEB",85,0)
 I $D(^TMP($J,"RMPRERR")) S ^TMP($J,"RMPR",RMSUBI+3)="*** Please contact your PCE Coordinator or IRM ***"
"RTN","RMPRPCEB",86,0)
 I '$D(^TMP($J,"RMPRERR")) S ^TMP($J,"RMPR",RMSUBI+3)=""
"RTN","RMPRPCEB",87,0)
 S ^TMP($J,"RMPR",RMSUBI+4)=""
"RTN","RMPRPCEB",88,0)
 S ^TMP($J,"RMPR",RMSUBI+5)="Thank You!!!"
"RTN","RMPRPCEB",89,0)
 S ^TMP($J,"RMPR",RMSUBI+6)=""
"RTN","RMPRPCEB",90,0)
 S ^TMP($J,"RMPR",RMSUBI+7)="PROSTHETICS DEPARTMENT"
"RTN","RMPRPCEB",91,0)
 D ^XMD
"RTN","RMPRPCEB",92,0)
 D NOW^%DTC
"RTN","RMPRPCEB",93,0)
 ;if task finish to completion and;
"RTN","RMPRPCEB",94,0)
 ;if no errors, set the PCE end date of the background job in #669.9.
"RTN","RMPRPCEB",95,0)
 F RS=0:0 S RS=$O(^RMPR(669.9,RS)) Q:RS'>0  S $P(^RMPR(669.9,RS,"PCE"),U,2)=%
"RTN","RMPRPCEB",96,0)
 Q
"RTN","RMPRPCEB",97,0)
 ;
"RTN","RMPRPCEB",98,0)
BUILD ;
"RTN","RMPRPCEB",99,0)
 F I=0:0 S I=$O(^TMP($J,"RMPRERR",I)) Q:I'>0  D
"RTN","RMPRPCEB",100,0)
 .S RMMAIL=^TMP($J,"RMPRERR",I)
"RTN","RMPRPCEB",101,0)
 .S RMSUBI=RMSUBI+1
"RTN","RMPRPCEB",102,0)
 .S ^TMP($J,"RMPR",RMSUBI)=RMMAIL
"RTN","RMPRPCEB",103,0)
 Q
"RTN","RMPRPCEB",104,0)
 ;
"RTN","RMPRPCEB",105,0)
EXIT ;MAIN EXIT POINT
"RTN","RMPRPCEB",106,0)
 K ^TMP($J)
"RTN","RMPRPCEB",107,0)
 N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPRPCEB",108,0)
 Q
"RTN","RMPRPRT")
0^14^B32318513
"RTN","RMPRPRT",1,0)
RMPRPRT ;PHX/HNB-PRINT 2319 ;3/18/03  09:04
"RTN","RMPRPRT",2,0)
 ;;3.0;PROSTHETICS;**7,50,77**;Feb 09, 1996
"RTN","RMPRPRT",3,0)
 ;
"RTN","RMPRPRT",4,0)
 ; ODJ - Patch 50 - 7/7/00 - NOIS SFC-0300-62501
"RTN","RMPRPRT",5,0)
 ;                           Put N I statement in HDR subroutine
"RTN","RMPRPRT",6,0)
 ;                           because it can get killed here and 
"RTN","RMPRPRT",7,0)
 ;                           calling routines are still using it
"RTN","RMPRPRT",8,0)
 ; RVD 3/18/03 patch #77 - remove the ability of adding pt under
"RTN","RMPRPRT",9,0)
 ;                         option print 2319.
"RTN","RMPRPRT",10,0)
 ;
"RTN","RMPRPRT",11,0)
DSP ;DO PRE DISPLAY HOUSEKEEPING
"RTN","RMPRPRT",12,0)
 ;VARIABLES REQUIRED:
"RTN","RMPRPRT",13,0)
 ;VARIABLES SET; RMPR ARRAY - SITE SPECIFIC INFO
"RTN","RMPRPRT",14,0)
 ;               RMPRDFN - IEN OF PATIENT IN FILE 665
"RTN","RMPRPRT",15,0)
 ;               RMPRNAM - NAME OF PATIENT
"RTN","RMPRPRT",16,0)
 ;               RMPRSSN - SSN O PATIENT
"RTN","RMPRPRT",17,0)
 ;               RMPRDOB - EXTERNAL VERSION OF PATIENT'S DATE OF BIRTH
"RTN","RMPRPRT",18,0)
 ; CALLED BY DSP1^RMPRPRT
"RTN","RMPRPRT",19,0)
 D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPRPRT",20,0)
 K RMPRDFN,RMPRSSN,RMPRSSNE,RMPRDOB,DIC,Y
"RTN","RMPRPRT",21,0)
 S DIC="^RMPR(665,",DIC(0)="AEMQ"
"RTN","RMPRPRT",22,0)
 S DIC("A")="Select PROSTHETIC PATIENT: " D ^DIC K DIC Q:$G(Y)'>0
"RTN","RMPRPRT",23,0)
 S:+Y>0 (RMPRDFN,DFN)=+Y D DEM^VADPT,ELIG^VADPT
"RTN","RMPRPRT",24,0)
 S RMPRNAM=$P(VADM(1),U),RMPRSSN=$P(VADM(2),U)
"RTN","RMPRPRT",25,0)
 S RMPRDOB=$P(VADM(3),U),RMPRSSNE=VA("PID")
"RTN","RMPRPRT",26,0)
 S RMPRCNUM=VAEL(7)
"RTN","RMPRPRT",27,0)
 I +VADM(6) S RMPRDOD=$P(VADM(6),U) W !!,$C(7),"PATIENT IS DECEASED. DATE OF DEATH WAS ",$P(VADM(6),U,2)
"RTN","RMPRPRT",28,0)
 I $D(RMPRDOD) S DIR(0)="Y",DIR("A")="Would you Like to continue Processing this Patient",DIR("B")="NO" D ^DIR K DIR I +Y=0 K RMPRDFN
"RTN","RMPRPRT",29,0)
 K RMPRDOD D KVAR^VADPT
"RTN","RMPRPRT",30,0)
 G:'$D(RMPRDFN) EXIT
"RTN","RMPRPRT",31,0)
DSP2 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT
"RTN","RMPRPRT",32,0)
 I '$D(IO("Q")) U IO G DSP1
"RTN","RMPRPRT",33,0)
 K IO("Q") S ZTRTN="START^RMPRPRT",ZTDESC="PROSTHETIC PATIENT PRINT",ZTIO=ION F RG="RMPRDFN","RMPRNAM","RMPRDOB","RMPRSSN" S ZTSAVE(RG)=""
"RTN","RMPRPRT",34,0)
 K RG D ^%ZTLOAD G EXIT
"RTN","RMPRPRT",35,0)
DSP1 I $E(IOST)["C" S RFLG=1 D ^RMPRPAT K ANS W ! ;G DSP2
"RTN","RMPRPRT",36,0)
START ;DO THE ACUTAL PRINTINTG OF THE ELIGIBILITY SCREENS DATA TO THE PRINTER
"RTN","RMPRPRT",37,0)
 ;VARIABLES REQUIRED: RMPRDFN - PATIENT IEN IN FILE 665
"RTN","RMPRPRT",38,0)
 ;                    RMPRNAM - PATIENT'S NAME
"RTN","RMPRPRT",39,0)
 ;                    RMPRSSN - PATIENT'S SSN NUMBEER
"RTN","RMPRPRT",40,0)
 ;                    RMPRDOB - PATIENT'S DATE OF BIRTH
"RTN","RMPRPRT",41,0)
 ;VARIABLES SET:      RMPR($J,"DESQ",--- - ARRAY  HOLDS PATIENT EYE AND
"RTN","RMPRPRT",42,0)
 ;                                         HAIR COLOR
"RTN","RMPRPRT",43,0)
 ;                    RA("DIQ1",$J,--- - ARRAY  HOLDS PATIENT MAS 
"RTN","RMPRPRT",44,0)
 ;                    R5(---  - ARRAY HOLDING PROSTHETIC  DISABILITY
"RTN","RMPRPRT",45,0)
 ;                              CODE INFORMATION
"RTN","RMPRPRT",46,0)
 ;CALLED BY DSP^RMPRPRT      
"RTN","RMPRPRT",47,0)
 Q:$G(RMPRDFN)<1
"RTN","RMPRPRT",48,0)
 S PAGE=1
"RTN","RMPRPRT",49,0)
 K DIQ,DIC S DIC=2,DA=RMPRDFN,DR=.3721,DR(2.04)=".01;2;3",DIQ="RA(""DIQ1"",$J," F LP=1:1 S DA(2.04)=LP D EN^DIQ1 Q:$G(RA("DIQ1",$J,2.04,LP,.01))=""
"RTN","RMPRPRT",50,0)
 S HGT=" ",WGT=" " S:$D(^RMPR(665,RMPRDFN,10)) HGT=$P(^(10),U,1),WGT=$P(^(10),U,2)
"RTN","RMPRPRT",51,0)
 S %X="^RMPR(665,"_RMPRDFN_",",%Y="R5(" D %XY^%RCR K %X,%Y S DFN=RMPRDFN
"RTN","RMPRPRT",52,0)
 K DIQ,DIC S DIC="^RMPR(665,",DR="22;23",DA=RMPRDFN,DIQ="RMPR($J,""DESC"",",DIQ(0)="E" D EN^DIQ1 K DIC,DIQ,DR
"RTN","RMPRPRT",53,0)
 S HAIR=$S($G(RMPR($J,"DESC",665,RMPRDFN,23,"E"))'="":RMPR($J,"DESC",665,RMPRDFN,23,"E"),1:" "),EYE=$S($G(RMPR($J,"DESC",665,RMPRDFN,22,"E"))'="":RMPR($J,"DESC",665,RMPRDFN,22,"E"),1:" ")
"RTN","RMPRPRT",54,0)
 D HDR D ADD^VADPT W !,"Phone: ",$S($G(VAPA(8))'="":VAPA(8),1:"UNKNOWN"),!
"RTN","RMPRPRT",55,0)
 S DFN=RMPRDFN D OAD^VADPT W !,"Office: ",$S(VAOA(8)'="":VAOA(8),1:"UNKNOWN"),!
"RTN","RMPRPRT",56,0)
 D COMP^RMPRUTIL W !,"Permanent Address:",?40,"Temporary Address:",!,XP(1),?40,X1(1),!
"RTN","RMPRPRT",57,0)
 W:J>2 XP(2) W:J1>2 ?40,X1(2) W:(J>2!(J1>2)) ! W:J>3 XP(3) W:J1>3 ?40,X1(3) W:(J>3!(J1>3)) ! W:J>4 XP(4) W:J1>4 ?40,X1(4)
"RTN","RMPRPRT",58,0)
 W:(J>4!(J1>4)) ! K J,J1,XP,X1
"RTN","RMPRPRT",59,0)
 W !,"Height(IN): ",HGT,"  Weight(LB): ",WGT,"  Eyes: ",EYE,"  Hair: ",HAIR,!!
"RTN","RMPRPRT",60,0)
 ;if you quit here than that is all that will print on the printer
"RTN","RMPRPRT",61,0)
 ;is not complete 19 record.
"RTN","RMPRPRT",62,0)
 ;I $D(RMPRBACK) Q
"RTN","RMPRPRT",63,0)
END D ELIG^VADPT W !!,"Patient Type: ",$P(VAEL(6),U,2),?40,"Period of Service: ",$P(VAEL(2),U,2),!,"Primary Eligibility Code:",?40,"Status: ",$P(VAEL(9),U,2),!,$P(VAEL(1),U,2)
"RTN","RMPRPRT",64,0)
 W ?40,"Eligibility Status: ",$E($P(VAEL(8),U,2),1,19) D MB^VADPT W !!,"Receiving A&A Benefits? " W:VAMB(1)=0 "NO" W:$P(VAMB(1),U,1)=1 $P(VAMB(1),U,2)
"RTN","RMPRPRT",65,0)
 W ?40,"Receiving Housebound Benefits? " W:VAMB(2)=0 "NO" W:$P(VAMB(2),U,1)=1 $P(VAMB(2),U,2)
"RTN","RMPRPRT",66,0)
 W !,"Receiving Social Security? " W:VAMB(3)=0 "NO" W:$P(VAMB(3),U,1)=1 $P(VAMB(3),U,2) W ?40,"Receiving VA Pension? " W:VAMB(4)=0 "NO" W:$P(VAMB(4),U,1)=1 $P(VAMB(4),U,2)
"RTN","RMPRPRT",67,0)
 W !,"Receiving Military Retirement? " W:VAMB(5)=0 "NO" W:$P(VAMB(5),U,1)=1 $P(VAMB(5),U,2) W ?40,"Receiving VA Disability? " W:VAMB(7)=0 "NO" W:$P(VAMB(7),U,1)=1 $P(VAMB(7),U,2) W !!
"RTN","RMPRPRT",68,0)
 W "MAS Disabilities: Code  Disability                           %  TOTAL%=",$S($P(VAEL(3),U,2):$P(VAEL(3),U,2),1:""),! S J=0
"RTN","RMPRPRT",69,0)
 S LP=0 F I=1:1 S LP=$O(RA("DIQ1",$J,2.04,LP)) Q:LP=""  D
"RTN","RMPRPRT",70,0)
 .W !,?21,RA("DIQ1",$J,2.04,LP,.01),?60,RA("DIQ1",$J,2.04,LP,2),?70,RA("DIQ1",$J,2.04,LP,3)
"RTN","RMPRPRT",71,0)
 I I=1 W !?10," NONE LISTED",!
"RTN","RMPRPRT",72,0)
 W !,"Prosthetic Disability Codes:",!
"RTN","RMPRPRT",73,0)
 W ?1,"Code",?10,"Elig",?40,"SC/NSC",?52,"Date",?63,!
"RTN","RMPRPRT",74,0)
 S J=0 F I=1:1 S J=$O(R5(1,J)) Q:J=""!(J?.A)  D DISP
"RTN","RMPRPRT",75,0)
 I I=1 W !?10,"NONE LISTED",!
"RTN","RMPRPRT",76,0)
 K I,LP
"RTN","RMPRPRT",77,0)
 G ^RMPRPRT1
"RTN","RMPRPRT",78,0)
 Q
"RTN","RMPRPRT",79,0)
EXIT ;EXIT FROM PRINTING A PATIENT'S 10-2319
"RTN","RMPRPRT",80,0)
 ;CALLED BY DSP^RMPRPRT AND DSP1^RMPRPRT
"RTN","RMPRPRT",81,0)
 D ^%ZISC,KVAR^VADPT
"RTN","RMPRPRT",82,0)
 K RDP,FG,Y,%,AN,NA,ANST,RC,DA,DIC,DIE,DIPGM,DIYS,ANS,EYE,HAIR,HGT,POP,R2,R5,WGT,X,Y,PAGE,RMPRSSNE
"RTN","RMPRPRT",83,0)
 K:'$D(RMPRF)&($G(RMPRBACK)=0) RMPRDFN,RMPRDOB,RMPRNAM,RMPRSSN,VADM
"RTN","RMPRPRT",84,0)
 Q
"RTN","RMPRPRT",85,0)
HDR ;HEADER FOR 10-2319
"RTN","RMPRPRT",86,0)
 ;CALLED BY START^RMPRPRT
"RTN","RMPRPRT",87,0)
 ;VARTIABLES REQUIRED:RMPRNAM - PATIENT'S NAME
"RTN","RMPRPRT",88,0)
 ;                    RMPRSSN - PATIENT'S SSN
"RTN","RMPRPRT",89,0)
 ;                    VAEL ARRAY - SEE PIMS TECHNICAL MANUAL
"RTN","RMPRPRT",90,0)
 ;                    RMPRDOB - PATIENT'S DATE OF BIRTH
"RTN","RMPRPRT",91,0)
 N I
"RTN","RMPRPRT",92,0)
 I $Y+6>IOSL W @IOF
"RTN","RMPRPRT",93,0)
 I '$D(RMPRSSN) D
"RTN","RMPRPRT",94,0)
 .N DFN
"RTN","RMPRPRT",95,0)
 .S DFN=RMPRDFN
"RTN","RMPRPRT",96,0)
 .D DEM^VADPT
"RTN","RMPRPRT",97,0)
 .S RMPRSSN=$P(VADM(2),U)
"RTN","RMPRPRT",98,0)
 .S RMPRDOB=$P(VADM(3),U)
"RTN","RMPRPRT",99,0)
 W !!,?23,"10-2319 PROSTHETICS VETERAN RECORD",!,$E(RMPRNAM,1,25),?27,"C#: " S DFN=RMPRDFN D ELIG^VADPT W $S(VAEL(7)'="":VAEL(7),1:"UNKNOWN")
"RTN","RMPRPRT",100,0)
 W ?45,"SSN: ",$E(RMPRSSN,1,3)_"-"_$E(RMPRSSN,4,5)_"-"_$E(RMPRSSN,6,9),?63,"DOB: "
"RTN","RMPRPRT",101,0)
 W $E(RMPRDOB,4,5)_"-"_$E(RMPRDOB,6,7)_"-"_($E(RMPRDOB,1,3)+1700),!
"RTN","RMPRPRT",102,0)
 ;
"RTN","RMPRPRT",103,0)
 W "Comment: ",$S($P(R5(0),U,3)]"":$P(R5(0),U,3),1:"")
"RTN","RMPRPRT",104,0)
 Q
"RTN","RMPRPRT",105,0)
DISP ;DISPLAY PROSTHETIC DISABILITY CODES
"RTN","RMPRPRT",106,0)
 ;CALLED BY END^RMPRPRT
"RTN","RMPRPRT",107,0)
 ;VARIABLES REQUIRED R5 - A STRING ARRAY
"RTN","RMPRPRT",108,0)
 ;                    J - AN INDEX INTO THE R5 ARRAY
"RTN","RMPRPRT",109,0)
 W ?1,$P(^RMPR(662,+R5(1,J,0),0),U,1),?10
"RTN","RMPRPRT",110,0)
 S R5=$P(R5(1,J,0),U,4)
"RTN","RMPRPRT",111,0)
 K DIC
"RTN","RMPRPRT",112,0)
 S RC=$P(R5(1,J,0),U,4)
"RTN","RMPRPRT",113,0)
 S REC=$S(RC=1:"SC Vietnam",RC=2:"All Other Service-Connected",RC=3:"NSC A&A",RC=4:"Others Eligible",RC=5:"V.I.S.T.",RC=6:"Voc Rehab.",RC=7:"PHC",RC=8:"Inpatient",RC=9:"Employee",RC=10:"Prima Facia",1:"")
"RTN","RMPRPRT",114,0)
 S RMPRSC=$P(R5(1,J,0),U,3) S RMPRSCC=$S(RMPRSC=1:"SC",RMPRSC=2:"NSC",1:"")
"RTN","RMPRPRT",115,0)
 W REC W:REC'=""&(RMPRSC'="") ?41,RMPRSCC
"RTN","RMPRPRT",116,0)
 K RMPRSCC,RMPRSC,RMEC,REC
"RTN","RMPRPRT",117,0)
 W ?52 S Y=$P(R5(1,J,0),U,2)
"RTN","RMPRPRT",118,0)
 D DD^%DT W Y,?63," ",!
"RTN","RMPRPRT",119,0)
 Q
"RTN","RMPRPS35")
0^35^B76926612
"RTN","RMPRPS35",1,0)
RMPRPS35 ;HINCIO/ODJ - HCPCS Update Utilities ;3/7/03  08:54
"RTN","RMPRPS35",2,0)
 ;;3.0;PROSTHETICS;**58,69,76,77**,FEB 09,1996
"RTN","RMPRPS35",3,0)
 Q
"RTN","RMPRPS35",4,0)
 ;
"RTN","RMPRPS35",5,0)
 ; RVD 2/12/02 patch #76  - replace a list of deactivated for 2003 HCPCS
"RTN","RMPRPS35",6,0)
 ;
"RTN","RMPRPS35",7,0)
 ; RVD 4/25/02 patch #69  - replace a list of deactivated HCPCS.
"RTN","RMPRPS35",8,0)
 ;                          files (661.1 and 661.3)
"RTN","RMPRPS35",9,0)
 ; RVD patch #77 - Convert old HCPCS to new/replacement HCPCS in PIP.
"RTN","RMPRPS35",10,0)
 ;               - old HCPCS not included in patch #76
"RTN","RMPRPS35",11,0)
 ;               - Remove inactive flag.
"RTN","RMPRPS35",12,0)
 ;
"RTN","RMPRPS35",13,0)
 ; HCPCD - Change HCPCS code in files 660, 664, 664.1, 665, 665.72
"RTN","RMPRPS35",14,0)
 ;                                    661.2 and 661.3
"RTN","RMPRPS35",15,0)
 ;         Only to be run if users off the system
"RTN","RMPRPS35",16,0)
 ;         Used where the same HCPCS code has duplicate records.
"RTN","RMPRPS35",17,0)
 ; Inputs:
"RTN","RMPRPS35",18,0)
 ;    RMPRHPF - IEN of HCPCS to delete
"RTN","RMPRPS35",19,0)
 ;    RMPRHPT - IEN of HCPCS to copy deleted HCPCS to
"RTN","RMPRPS35",20,0)
 ;
"RTN","RMPRPS35",21,0)
HCPCD(RMPRHPF,RMPRHPT) ;
"RTN","RMPRPS35",22,0)
 N RMPRI,RMPRFDA,RMPRFME,RMPRIEN,RMPRS,RMPR65P,RMPRJ,RMPRPTP
"RTN","RMPRPS35",23,0)
 N RMPRO1,RMPRO2,RMPRO3,RMPRO4,RMPR641P,RMPR64P,X,Y,DA
"RTN","RMPRPS35",24,0)
 ;
"RTN","RMPRPS35",25,0)
 ; Start with file 660 using the H x-ref.
"RTN","RMPRPS35",26,0)
 S RMPRI=""
"RTN","RMPRPS35",27,0)
 F  S RMPRI=$O(^RMPR(660,"H",RMPRHPF,RMPRI)) Q:RMPRI=""  D
"RTN","RMPRPS35",28,0)
 . ;
"RTN","RMPRPS35",29,0)
 . ; Get pointer to 665 and update HCPCS multiples
"RTN","RMPRPS35",30,0)
 . S RMPR65P=$P($G(^RMPR(660,RMPRI,0)),"^",2)
"RTN","RMPRPS35",31,0)
 . S RMHCIT=$P($G(^RMPR(660,RMPRI,2)),"^",1)
"RTN","RMPRPS35",32,0)
 . I RMPR65P'="" D
"RTN","RMPRPS35",33,0)
 .. ;
"RTN","RMPRPS35",34,0)
 .. ; Update 665.194 multiple
"RTN","RMPRPS35",35,0)
 .. Q:'$D(^RMPR(665,RMPR65P,0))
"RTN","RMPRPS35",36,0)
 .. S RMPRPTP=$P(^RMPR(665,RMPR65P,0),"^",1)
"RTN","RMPRPS35",37,0)
 .. S RMPRJ=0
"RTN","RMPRPS35",38,0)
 .. F  S RMPRJ=$O(^RMPR(665,RMPR65P,"RMPOC",RMPRJ)) Q:'RMPRJ  D
"RTN","RMPRPS35",39,0)
 ... Q:$P($G(^RMPR(665,RMPR65P,"RMPOC",RMPRJ,0)),"^",7)'=RMPRHPF
"RTN","RMPRPS35",40,0)
 ... S RMPRIEN=RMPRJ_","_RMPR65P_","
"RTN","RMPRPS35",41,0)
 ... K RMPRFDA,RMPRFME
"RTN","RMPRPS35",42,0)
 ... S RMPRFDA(665.194,RMPRIEN,6)=RMPRHPT
"RTN","RMPRPS35",43,0)
 ... D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS35",44,0)
 ... Q
"RTN","RMPRPS35",45,0)
 .. ;
"RTN","RMPRPS35",46,0)
 .. ; Update 665.723191 multiple
"RTN","RMPRPS35",47,0)
 .. S RMPRO1=0
"RTN","RMPRPS35",48,0)
 .. F  S RMPRO1=$O(^RMPO(665.72,RMPRO1)) Q:'+RMPRO1  D
"RTN","RMPRPS35",49,0)
 ... S RMPRO2=0
"RTN","RMPRPS35",50,0)
 ... F  S RMPRO2=$O(^RMPO(665.72,RMPRO1,1,RMPRO2)) Q:'+RMPRO2  D
"RTN","RMPRPS35",51,0)
 .... S RMPRO3=0
"RTN","RMPRPS35",52,0)
 .... F  S RMPRO3=$O(^RMPO(665.72,RMPRO1,1,RMPRO2,1,RMPRO3)) Q:'+RMPRO3  D
"RTN","RMPRPS35",53,0)
 ..... I $D(^RMPO(665.72,RMPRO1,1,RMPRO2,1,RMPRO3,"V",RMPRPTP)) D
"RTN","RMPRPS35",54,0)
 ...... S RMPRO4=0
"RTN","RMPRPS35",55,0)
 ...... F  S RMPRO4=$O(^RMPO(665.72,RMPRO1,1,RMPRO2,1,RMPRO3,"V",RMPRPTP,1,RMPRO4)) Q:'+RMPRO4  D
"RTN","RMPRPS35",56,0)
 ....... Q:$P($G(^RMPO(665.72,RMPRO1,1,RMPRO2,1,RMPRO3,"V",RMPRPTP,1,RMPRO4,0)),"^",2)'=RMPRHPF
"RTN","RMPRPS35",57,0)
 ....... S RMPRIEN=RMPRO4_","_RMPRPTP_","_RMPRO3_","_RMPRO2_","_RMPRO1_","
"RTN","RMPRPS35",58,0)
 ....... K RMPRFME,RMPRFDA
"RTN","RMPRPS35",59,0)
 ....... S RMPRFDA(665.723191,RMPRIEN,2)=RMPRHPT
"RTN","RMPRPS35",60,0)
 ....... D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS35",61,0)
 ....... Q
"RTN","RMPRPS35",62,0)
 ...... Q
"RTN","RMPRPS35",63,0)
 ..... Q
"RTN","RMPRPS35",64,0)
 .... Q
"RTN","RMPRPS35",65,0)
 ... Q
"RTN","RMPRPS35",66,0)
 .. Q
"RTN","RMPRPS35",67,0)
 . ;
"RTN","RMPRPS35",68,0)
 . ; Update to 664.1 and 664 HCPCS multiples
"RTN","RMPRPS35",69,0)
 . S RMPRPTP=RMPR65P ;patient pointer
"RTN","RMPRPS35",70,0)
 . I RMPRPTP'="" D
"RTN","RMPRPS35",71,0)
 .. ;
"RTN","RMPRPS35",72,0)
 .. ; Update 664.16 multiple
"RTN","RMPRPS35",73,0)
 .. S RMPR641P=""
"RTN","RMPRPS35",74,0)
 .. F  S RMPR641P=$O(^RMPR(664.1,"D",RMPRPTP,RMPR641P)) Q:RMPR641P=""  D 
"RTN","RMPRPS35",75,0)
 ... S RMPRJ=0
"RTN","RMPRPS35",76,0)
 ... F  S RMPRJ=$O(^RMPR(664.1,RMPR641P,2,RMPRJ)) Q:'+RMPRJ  D
"RTN","RMPRPS35",77,0)
 .... Q:$P($G(^RMPR(664.1,RMPR641P,2,RMPRJ,2)),"^",1)'=RMPRHPF
"RTN","RMPRPS35",78,0)
 .... S RMPRIEN=RMPRJ_","_RMPR641P_","
"RTN","RMPRPS35",79,0)
 .... K RMPRFDA,RMPRFME
"RTN","RMPRPS35",80,0)
 .... S RMPRFDA(664.16,RMPRIEN,13)=RMPRHPT
"RTN","RMPRPS35",81,0)
 .... D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS35",82,0)
 .... Q
"RTN","RMPRPS35",83,0)
 ... Q
"RTN","RMPRPS35",84,0)
 .. Q
"RTN","RMPRPS35",85,0)
 . S RMPRPTP=RMPR65P ;patient pointer same as 665 pointer
"RTN","RMPRPS35",86,0)
 . I RMPRPTP'="" D
"RTN","RMPRPS35",87,0)
 .. ;
"RTN","RMPRPS35",88,0)
 .. ; Update 664.02 multiple
"RTN","RMPRPS35",89,0)
 .. S RMPR64P=""
"RTN","RMPRPS35",90,0)
 .. F  S RMPR64P=$O(^RMPR(664,"C",RMPRPTP,RMPR64P)) Q:RMPR64P=""  D
"RTN","RMPRPS35",91,0)
 ... S RMPRJ=0
"RTN","RMPRPS35",92,0)
 ... F  S RMPRJ=$O(^RMPR(664,RMPR64P,1,RMPRJ)) Q:'+RMPRJ  D
"RTN","RMPRPS35",93,0)
 .... Q:$P($G(^RMPR(664,RMPR64P,1,RMPRJ,0)),"^",16)'=RMPRHPF
"RTN","RMPRPS35",94,0)
 .... K RMPRFDA,RMPRFME
"RTN","RMPRPS35",95,0)
 .... S RMPRIEN=RMPRJ_","_RMPR64P_","
"RTN","RMPRPS35",96,0)
 .... S RMPRFDA(664.02,RMPRIEN,16)=RMPRHPT
"RTN","RMPRPS35",97,0)
 .... D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS35",98,0)
 .... Q
"RTN","RMPRPS35",99,0)
 ... Q
"RTN","RMPRPS35",100,0)
 .. Q
"RTN","RMPRPS35",101,0)
 . ;
"RTN","RMPRPS35",102,0)
 . ; finally update the 660 file
"RTN","RMPRPS35",103,0)
 . K RMPRFDA,RMPRFME
"RTN","RMPRPS35",104,0)
 . S RMPRIEN=RMPRI_","
"RTN","RMPRPS35",105,0)
 . S RMPRFDA(660,RMPRIEN,4.5)=RMPRHPT
"RTN","RMPRPS35",106,0)
 . S RMPRFDA(660,RMPRIEN,37)=RMPRHPT_"-"_$P(RMHCIT,"-",2)
"RTN","RMPRPS35",107,0)
 . D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS35",108,0)
 . Q
"RTN","RMPRPS35",109,0)
 ;
"RTN","RMPRPS35",110,0)
 ; Update PIP files 661.2 and 661.3
"RTN","RMPRPS35",111,0)
HCPCDP S RMPRI=""
"RTN","RMPRPS35",112,0)
 F  S RMPRI=$O(^RMPR(661.2,"D",RMPRHPF,RMPRI)) Q:RMPRI=""  D
"RTN","RMPRPS35",113,0)
 . K RMPRFDA,RMPRFME
"RTN","RMPRPS35",114,0)
 . S RMPRIEN=RMPRI_","
"RTN","RMPRPS35",115,0)
 . S RMPRFDA(661.2,RMPRIEN,3)=RMPRHPT
"RTN","RMPRPS35",116,0)
 . D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS35",117,0)
 . Q
"RTN","RMPRPS35",118,0)
 S RMPRI=0
"RTN","RMPRPS35",119,0)
 F  S RMPRI=$O(^RMPR(661.3,RMPRI)) Q:'+RMPRI  D
"RTN","RMPRPS35",120,0)
 . S RMPRJ=0
"RTN","RMPRPS35",121,0)
 . F  S RMPRJ=$O(^RMPR(661.3,RMPRI,1,RMPRJ)) Q:'+RMPRJ  D
"RTN","RMPRPS35",122,0)
 .. Q:$P($G(^RMPR(661.3,RMPRI,1,RMPRJ,0)),"^",1)'=RMPRHPF
"RTN","RMPRPS35",123,0)
 .. K RMPRFDA,RMPRFME
"RTN","RMPRPS35",124,0)
 .. S RMPRIEN=RMPRJ_","_RMPRI_","
"RTN","RMPRPS35",125,0)
 .. S RMPRFDA(661.31,RMPRIEN,.01)=RMPRHPT
"RTN","RMPRPS35",126,0)
 .. D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS35",127,0)
 .. Q
"RTN","RMPRPS35",128,0)
 . Q
"RTN","RMPRPS35",129,0)
 K RMPRFDA,RMPRFME
"RTN","RMPRPS35",130,0)
 S RMPRIEN=RMPRHPF_","
"RTN","RMPRPS35",131,0)
 S RMPRFDA(661.1,RMPRIEN,.01)="@"
"RTN","RMPRPS35",132,0)
 D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS35",133,0)
HCPCDX Q
"RTN","RMPRPS35",134,0)
 ;
"RTN","RMPRPS35",135,0)
 ; ITEM - move Item records from 661.1 from old to new HCPCS
"RTN","RMPRPS35",136,0)
 ;
"RTN","RMPRPS35",137,0)
 ; Inputs:
"RTN","RMPRPS35",138,0)
 ;   RMPRHPO - Old HCPCS code being replaced
"RTN","RMPRPS35",139,0)
 ;   RMPRHPN - New HCPCS code
"RTN","RMPRPS35",140,0)
 ;
"RTN","RMPRPS35",141,0)
ITEM(RMPRHPO,RMPRHPN) ;
"RTN","RMPRPS35",142,0)
 N RMPRHPOI,RMPRHPNI,RMPRJ,RMPRFDA,RMPRFME,RMPRIEN,X,Y,DA,RMPRIENA,RMPRK
"RTN","RMPRPS35",143,0)
 N RMPRL,RMPRS,RMPRITEM,RMPRIFLG,RML,RMPRIN,RMPRIO
"RTN","RMPRPS35",144,0)
 K ^TMP($J,"RM")
"RTN","RMPRPS35",145,0)
 S RMPRHPOI=$O(^RMPR(661.1,"B",RMPRHPO,"")) ;old HCPCS ien
"RTN","RMPRPS35",146,0)
 S RMPRHPNI=$O(^RMPR(661.1,"B",RMPRHPN,"")) ;new HCPCS ien
"RTN","RMPRPS35",147,0)
 Q:'$G(RMPRHPNI)!'$G(RMPRHPOI)
"RTN","RMPRPS35",148,0)
 G:$D(^RMPR(661.2,"D",RMPRHPNI)) ITEMX ;quit if Items already on new HCPCS and PIP.
"RTN","RMPRPS35",149,0)
 S RMPRIFLG=0
"RTN","RMPRPS35",150,0)
 I $P($G(^RMPR(661.1,RMPRHPOI,0)),"^",9)'="" S RMPRIFLG=1
"RTN","RMPRPS35",151,0)
 ;
"RTN","RMPRPS35",152,0)
 ; Loop on items and copy to new HCPCS
"RTN","RMPRPS35",153,0)
 S RML=0
"RTN","RMPRPS35",154,0)
 ;S RMPRIEN="+1,"_RMPRHPNI_","
"RTN","RMPRPS35",155,0)
 S (RMPRJ,RMPRN)=0
"RTN","RMPRPS35",156,0)
 I $D(^RMPR(661.1,RMPRHPNI,3,0)) S RMPRN=$P(^RMPR(661.1,RMPRHPNI,3,0),U,3)
"RTN","RMPRPS35",157,0)
 S RMPRIENA=RMPRN
"RTN","RMPRPS35",158,0)
 F  S RMPRJ=$O(^RMPR(661.1,RMPRHPOI,3,RMPRJ)) Q:'+RMPRJ  D
"RTN","RMPRPS35",159,0)
 . K RMPRFDA,RMPRFME,DIE
"RTN","RMPRPS35",160,0)
 . I RMPRN=0 S RMPRIENA=RMPRJ
"RTN","RMPRPS35",161,0)
 . I RMPRN>0 S RMPRIENA=RMPRIENA+1
"RTN","RMPRPS35",162,0)
 . S RML=RML+1
"RTN","RMPRPS35",163,0)
 . S RMPRIEN="+"_RML_","_RMPRHPNI_","
"RTN","RMPRPS35",164,0)
 . S RMPRFDA(661.12,RMPRIEN,.01)=$P(^RMPR(661.1,RMPRHPOI,3,RMPRJ,0),"^",1)
"RTN","RMPRPS35",165,0)
 . I $L(RMPRFDA(661.12,RMPRIEN,.01))>30 S RMPRFDA(661.12,RMPRIEN,.01)=$E(RMPRFDA(661.12,RMPRIEN,.01),1,30)
"RTN","RMPRPS35",166,0)
 .;don't create an entry if it's already been created.
"RTN","RMPRPS35",167,0)
 . Q:$D(^RMPR(661.1,RMPRHPNI,3,"B",RMPRFDA(661.12,RMPRIEN,.01)))
"RTN","RMPRPS35",168,0)
 . S ^TMP($J,"RM",RMPRJ)=RMPRIENA
"RTN","RMPRPS35",169,0)
 . D UPDATE^DIE("","RMPRFDA","RMPRIENA","RMPRFME")
"RTN","RMPRPS35",170,0)
 . Q
"RTN","RMPRPS35",171,0)
 ;
"RTN","RMPRPS35",172,0)
 ; Update 661.3 file
"RTN","RMPRPS35",173,0)
 S RMPRJ=""
"RTN","RMPRPS35",174,0)
 F  S RMPRJ=$O(^RMPR(661.3,"C",RMPRHPOI,RMPRJ)) Q:RMPRJ=""  D
"RTN","RMPRPS35",175,0)
 . S RMPRK=""
"RTN","RMPRPS35",176,0)
 . F  S RMPRK=$O(^RMPR(661.3,"C",RMPRHPOI,RMPRJ,RMPRK)) Q:RMPRK=""  D
"RTN","RMPRPS35",177,0)
 .. S RMPRL=0
"RTN","RMPRPS35",178,0)
 .. F  S RMPRL=$O(^RMPR(661.3,RMPRJ,1,RMPRK,1,RMPRL)) Q:'+RMPRL  D
"RTN","RMPRPS35",179,0)
 ... S RMPRS=^RMPR(661.3,RMPRJ,1,RMPRK,1,RMPRL,0)
"RTN","RMPRPS35",180,0)
 ... S RMPRITEM=$P(RMPRS,"^",1)
"RTN","RMPRPS35",181,0)
 ... S RMPRIO=$P(RMPRITEM,"-",2)
"RTN","RMPRPS35",182,0)
 ... Q:'$D(^TMP($J,"RM",RMPRIO))
"RTN","RMPRPS35",183,0)
 ... S RMPRIN=^TMP($J,"RM",RMPRIO)
"RTN","RMPRPS35",184,0)
 ... Q:'$G(RMPRIN)
"RTN","RMPRPS35",185,0)
 ... S $P(RMPRITEM,"-",1)=RMPRHPN
"RTN","RMPRPS35",186,0)
 ... S $P(RMPRITEM,"-",2)=RMPRIN
"RTN","RMPRPS35",187,0)
 ... S RMPRIEN=RMPRL_","_RMPRK_","_RMPRJ_","
"RTN","RMPRPS35",188,0)
 ... K RMPRFDA,RMPRFME
"RTN","RMPRPS35",189,0)
 ... S RMPRFDA(661.312,RMPRIEN,.01)=RMPRITEM
"RTN","RMPRPS35",190,0)
 ... D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS35",191,0)
 ... Q
"RTN","RMPRPS35",192,0)
 .. S RMPRIEN=RMPRK_","_RMPRJ_","
"RTN","RMPRPS35",193,0)
 .. K RMPRFDA,RMPRFME
"RTN","RMPRPS35",194,0)
 .. S RMPRFDA(661.31,RMPRIEN,.01)=RMPRHPNI
"RTN","RMPRPS35",195,0)
 .. D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS35",196,0)
 .. S RMPRIFLG=1
"RTN","RMPRPS35",197,0)
 .. Q
"RTN","RMPRPS35",198,0)
 . Q
"RTN","RMPRPS35",199,0)
 I RMPRIFLG D
"RTN","RMPRPS35",200,0)
 . K RMPRFDA,RMPRFME
"RTN","RMPRPS35",201,0)
 . S RMPRIEN=RMPRHPNI_","
"RTN","RMPRPS35",202,0)
 . S RMPRFDA(661.1,RMPRIEN,10)=1
"RTN","RMPRPS35",203,0)
 . D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS35",204,0)
 . Q
"RTN","RMPRPS35",205,0)
 ;
"RTN","RMPRPS35",206,0)
 ; Update PIP files 661.2
"RTN","RMPRPS35",207,0)
 S RMPRI=""
"RTN","RMPRPS35",208,0)
 F  S RMPRI=$O(^RMPR(661.2,"D",RMPRHPOI,RMPRI)) Q:RMPRI=""  D
"RTN","RMPRPS35",209,0)
 . Q:'$D(^RMPR(661.2,RMPRI,0))
"RTN","RMPRPS35",210,0)
 . S RMHCIT=$P(^RMPR(661.2,RMPRI,0),U,9)
"RTN","RMPRPS35",211,0)
 . K RMPRFDA,RMPRFME
"RTN","RMPRPS35",212,0)
 . S RMPRIEN=RMPRI_","
"RTN","RMPRPS35",213,0)
 . S RMPRFDA(661.2,RMPRIEN,3)=RMPRHPNI
"RTN","RMPRPS35",214,0)
 . S RMPRFDA(661.2,RMPRIEN,9)=RMPRHPN_"-"_$P(RMHCIT,"-",2)
"RTN","RMPRPS35",215,0)
 . D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS35",216,0)
 . Q
"RTN","RMPRPS35",217,0)
 ;
"RTN","RMPRPS35",218,0)
ITEMX Q
"RTN","RMPRPS35",219,0)
 ;
"RTN","RMPRPS35",220,0)
 ; PATCH58 - 
"RTN","RMPRPS35",221,0)
 ; 1 - Repoint duplicate HCPCS
"RTN","RMPRPS35",222,0)
 ; 2 - Copy item and current inventory to new HCPCS for specified list
"RTN","RMPRPS35",223,0)
 ; (patch 58 only)
"RTN","RMPRPS35",224,0)
PATCH58 N RMPRA,RMPRI
"RTN","RMPRPS35",225,0)
 I '$D(IO("Q")) D
"RTN","RMPRPS35",226,0)
 . W !!,"Repointing specified duplicate HCPCS...",!
"RTN","RMPRPS35",227,0)
 . Q
"RTN","RMPRPS35",228,0)
 D HCPCD(170,133) ;E0277
"RTN","RMPRPS35",229,0)
 I '$D(IO("Q")) D
"RTN","RMPRPS35",230,0)
 . W !!,"Repointing complete.",!
"RTN","RMPRPS35",231,0)
 . Q
"RTN","RMPRPS35",232,0)
 ;
"RTN","RMPRPS35",233,0)
 ;for next update, change RMPRA() local array to the HCPCS that need
"RTN","RMPRPS35",234,0)
 ;to be replaced.
"RTN","RMPRPS35",235,0)
PAT76 ; Set up array and replace HCPCS
"RTN","RMPRPS35",236,0)
 S U="^"
"RTN","RMPRPS35",237,0)
 I '$D(IO("Q")) D
"RTN","RMPRPS35",238,0)
 . W !!,"Replacing the following HCPCS...",!
"RTN","RMPRPS35",239,0)
 . Q
"RTN","RMPRPS35",240,0)
 ;patch #58 - replacement code
"RTN","RMPRPS35",241,0)
 ;K RMPRA
"RTN","RMPRPS35",242,0)
 ;S RMPRA(1)="K0182^A7018"
"RTN","RMPRPS35",243,0)
 ;S RMPRA(2)="K0269^E0572"
"RTN","RMPRPS35",244,0)
 F RMI=0:0 S RMI=$O(^RMPR(661.1,"RMPR",RMI)) Q:RMI'>0  D
"RTN","RMPRPS35",245,0)
 . S RMHCDA=^RMPR(661.1,"RMPR",RMI)
"RTN","RMPRPS35",246,0)
 . S RMHOLD=$P(RMHCDA,U,1),RMHNEW=$P(RMHCDA,U,2)
"RTN","RMPRPS35",247,0)
 . I '$D(IO("Q")) D
"RTN","RMPRPS35",248,0)
 .. W !,RMHOLD," with ",RMHNEW
"RTN","RMPRPS35",249,0)
 . D ITEM(RMHOLD,RMHNEW)
"RTN","RMPRPS35",250,0)
 . Q
"RTN","RMPRPS35",251,0)
 I '$D(IO("Q")) D
"RTN","RMPRPS35",252,0)
 . W !!,"HCPCS replacement complete.",!
"RTN","RMPRPS35",253,0)
 . Q
"RTN","RMPRPS35",254,0)
 Q
"RTN","RMPRPS35",255,0)
CFLG ;remove calculation flag.
"RTN","RMPRPS35",256,0)
 W !!,"Removing the Calculation flag.....",!
"RTN","RMPRPS35",257,0)
 F RMPRI=1:1:66 S RMPRY=$P($T(FLG+RMPRI),";",4) Q:RMPRY'>0  D
"RTN","RMPRPS35",258,0)
 .S $P(^RMPR(661.1,RMPRY,0),U,8)=""
"RTN","RMPRPS35",259,0)
 W !!,"Done Removing Calculation flag!!!",!
"RTN","RMPRPS35",260,0)
 Q
"RTN","RMPRPS35",261,0)
FLG ;REMOVE calculation flag of the ff HCPCS:
"RTN","RMPRPS35",262,0)
 ;;E1038;3884
"RTN","RMPRPS35",263,0)
 ;;E1050;264
"RTN","RMPRPS35",264,0)
 ;;E1060;265
"RTN","RMPRPS35",265,0)
 ;;E1070;269
"RTN","RMPRPS35",266,0)
 ;;E1083;271
"RTN","RMPRPS35",267,0)
 ;;E1084;270
"RTN","RMPRPS35",268,0)
 ;;E1085;272
"RTN","RMPRPS35",269,0)
 ;;E1086;273
"RTN","RMPRPS35",270,0)
 ;;E1087;274
"RTN","RMPRPS35",271,0)
 ;;E1088;275
"RTN","RMPRPS35",272,0)
 ;;E1089;276
"RTN","RMPRPS35",273,0)
 ;;E1090;277
"RTN","RMPRPS35",274,0)
 ;;E1092;278
"RTN","RMPRPS35",275,0)
 ;;E1093;279
"RTN","RMPRPS35",276,0)
 ;;E1100;280
"RTN","RMPRPS35",277,0)
 ;;E1110;281
"RTN","RMPRPS35",278,0)
 ;;E1130;282
"RTN","RMPRPS35",279,0)
 ;;E1140;283
"RTN","RMPRPS35",280,0)
 ;;E1150;284
"RTN","RMPRPS35",281,0)
 ;;E1160;285
"RTN","RMPRPS35",282,0)
 ;;E1161;3885
"RTN","RMPRPS35",283,0)
 ;;E1170;286
"RTN","RMPRPS35",284,0)
 ;;E1171;287
"RTN","RMPRPS35",285,0)
 ;;E1172;288
"RTN","RMPRPS35",286,0)
 ;;E1180;289
"RTN","RMPRPS35",287,0)
 ;;E1190;290
"RTN","RMPRPS35",288,0)
 ;;E1195;291
"RTN","RMPRPS35",289,0)
 ;;E1200;292
"RTN","RMPRPS35",290,0)
 ;;E1210;293
"RTN","RMPRPS35",291,0)
 ;;E1211;294
"RTN","RMPRPS35",292,0)
 ;;E1212;295
"RTN","RMPRPS35",293,0)
 ;;E1213;296
"RTN","RMPRPS35",294,0)
 ;;E1220;297
"RTN","RMPRPS35",295,0)
 ;;E1221;298
"RTN","RMPRPS35",296,0)
 ;;E1222;299
"RTN","RMPRPS35",297,0)
 ;;E1223;300
"RTN","RMPRPS35",298,0)
 ;;E1224;301
"RTN","RMPRPS35",299,0)
 ;;E1225;302
"RTN","RMPRPS35",300,0)
 ;;E1226;303
"RTN","RMPRPS35",301,0)
 ;;E1227;304
"RTN","RMPRPS35",302,0)
 ;;E1228;305
"RTN","RMPRPS35",303,0)
 ;;E1230;306
"RTN","RMPRPS35",304,0)
 ;;E1240;307
"RTN","RMPRPS35",305,0)
 ;;E1250;308
"RTN","RMPRPS35",306,0)
 ;;E1260;309
"RTN","RMPRPS35",307,0)
 ;;E1270;310
"RTN","RMPRPS35",308,0)
 ;;E1280;311
"RTN","RMPRPS35",309,0)
 ;;E1285;312
"RTN","RMPRPS35",310,0)
 ;;E1290;313
"RTN","RMPRPS35",311,0)
 ;;E1295;314
"RTN","RMPRPS35",312,0)
 ;;E1296;315
"RTN","RMPRPS35",313,0)
 ;;E1297;316
"RTN","RMPRPS35",314,0)
 ;;E1298;317
"RTN","RMPRPS35",315,0)
 ;;K0001;339
"RTN","RMPRPS35",316,0)
 ;;K0002;340
"RTN","RMPRPS35",317,0)
 ;;K0003;341
"RTN","RMPRPS35",318,0)
 ;;K0004;342
"RTN","RMPRPS35",319,0)
 ;;K0005;343
"RTN","RMPRPS35",320,0)
 ;;K0006;344
"RTN","RMPRPS35",321,0)
 ;;K0007;345
"RTN","RMPRPS35",322,0)
 ;;K0009;347
"RTN","RMPRPS35",323,0)
 ;;K0010;348
"RTN","RMPRPS35",324,0)
 ;;K0011;349
"RTN","RMPRPS35",325,0)
 ;;K0012;350
"RTN","RMPRPS35",326,0)
 ;;K0014;352
"RTN","RMPRPS35",327,0)
 ;;END
"RTN","RMPRPS36")
0^36^B84864728
"RTN","RMPRPS36",1,0)
RMPRPS36 ;HIN CIO/RVD - HCPCS Update Utilities ;7/15/03  16:54
"RTN","RMPRPS36",2,0)
 ;;3.0;PROSTHETICS;**76,77**,FEB 09,1996
"RTN","RMPRPS36",3,0)
 Q
"RTN","RMPRPS36",4,0)
 ;
"RTN","RMPRPS36",5,0)
 ; RVD 2/12/03 patch #76  - replace a list of deactivated 2003 HCPCS
"RTN","RMPRPS36",6,0)
 ;                      for sites with patch #61 installed.
"RTN","RMPRPS36",7,0)
 ; RVD patch #77 - added list of old HCPCS in PIP for conversion.
"RTN","RMPRPS36",8,0)
 ;               - added HCPCS G0290, G0291, TM100, TM101, TM101,
"RTN","RMPRPS36",9,0)
 ;                             TM102, TM103, TM104 and TM105.
"RTN","RMPRPS36",10,0)
 ;
"RTN","RMPRPS36",11,0)
 Q
"RTN","RMPRPS36",12,0)
 ;
"RTN","RMPRPS36",13,0)
F6111 ; Update PIP files 661.11
"RTN","RMPRPS36",14,0)
 K RMI
"RTN","RMPRPS36",15,0)
 F RMI=0:0 S RMI=$O(^RMPR(661.11,"B",RMHOLD,RMI)) Q:RMI'>0  D
"RTN","RMPRPS36",16,0)
 .S RMIT=""
"RTN","RMPRPS36",17,0)
 .Q:'$D(^RMPR(661.11,RMI,0))
"RTN","RMPRPS36",18,0)
 .S RMIT=$P(^RMPR(661.11,RMI,0),U,2)
"RTN","RMPRPS36",19,0)
 .K RMPRFDA,RMPRFME
"RTN","RMPRPS36",20,0)
 .S RMPRIEN=RMI_","
"RTN","RMPRPS36",21,0)
 .S RMPRFDA(661.11,RMPRIEN,.01)=RMHNEW
"RTN","RMPRPS36",22,0)
 .S RMPRFDA(661.11,RMPRIEN,6)=RMHNEW_"-"_RMIT
"RTN","RMPRPS36",23,0)
 .D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS36",24,0)
 Q
"RTN","RMPRPS36",25,0)
 ;
"RTN","RMPRPS36",26,0)
F614 ; Update PIP files 661.4
"RTN","RMPRPS36",27,0)
 K RMI
"RTN","RMPRPS36",28,0)
 F RMI=0:0 S RMI=$O(^RMPR(661.4,"B",RMHOLD,RMI)) Q:RMI'>0  D
"RTN","RMPRPS36",29,0)
 .Q:'$D(^RMPR(661.4,RMI,0))
"RTN","RMPRPS36",30,0)
 .K RMPRFDA,RMPRFME
"RTN","RMPRPS36",31,0)
 .S RMPRIEN=RMI_","
"RTN","RMPRPS36",32,0)
 .S RMPRFDA(661.4,RMPRIEN,.01)=RMHNEW
"RTN","RMPRPS36",33,0)
 .D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS36",34,0)
 Q
"RTN","RMPRPS36",35,0)
 ;
"RTN","RMPRPS36",36,0)
F6141 ; Update PIP files 661.41
"RTN","RMPRPS36",37,0)
 K RMI
"RTN","RMPRPS36",38,0)
 F RMI=0:0 S RMI=$O(^RMPR(661.41,"B",RMHOLD,RMI)) Q:RMI'>0  D
"RTN","RMPRPS36",39,0)
 .Q:'$D(^RMPR(661.41,RMI,0))
"RTN","RMPRPS36",40,0)
 .K RMPRFDA,RMPRFME
"RTN","RMPRPS36",41,0)
 .S RMPRIEN=RMI_","
"RTN","RMPRPS36",42,0)
 .S RMPRFDA(661.41,RMPRIEN,5)=RMHNEW
"RTN","RMPRPS36",43,0)
 .D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS36",44,0)
 Q
"RTN","RMPRPS36",45,0)
 ;
"RTN","RMPRPS36",46,0)
F616 ; Update PIP files 661.6
"RTN","RMPRPS36",47,0)
 K RMI
"RTN","RMPRPS36",48,0)
 F RMI=0:0 S RMI=$O(^RMPR(661.6,"B",RMHOLD,RMI)) Q:RMI'>0  D
"RTN","RMPRPS36",49,0)
 .Q:'$D(^RMPR(661.6,RMI,0))
"RTN","RMPRPS36",50,0)
 .K RMPRFDA,RMPRFME
"RTN","RMPRPS36",51,0)
 .S RMPRIEN=RMI_","
"RTN","RMPRPS36",52,0)
 .S RMPRFDA(661.6,RMPRIEN,.01)=RMHNEW
"RTN","RMPRPS36",53,0)
 .D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS36",54,0)
 Q
"RTN","RMPRPS36",55,0)
 ;
"RTN","RMPRPS36",56,0)
F6163 ; Update PIP files 661.63
"RTN","RMPRPS36",57,0)
 K RMI
"RTN","RMPRPS36",58,0)
 F RMI=0:0 S RMI=$O(^RMPR(661.63,RMI)) Q:RMI'>0  D
"RTN","RMPRPS36",59,0)
 .S RM63DAT=^RMPR(661.63,RMI,0)
"RTN","RMPRPS36",60,0)
 .S RM63HCP=$P(RM63DAT,U,4)
"RTN","RMPRPS36",61,0)
 .Q:RM63HCP'=RMHOLD
"RTN","RMPRPS36",62,0)
 .K RMPRFDA,RMPRFME
"RTN","RMPRPS36",63,0)
 .S RMPRIEN=RMI_","
"RTN","RMPRPS36",64,0)
 .S RMPRFDA(661.63,RMPRIEN,4)=RMHNEW
"RTN","RMPRPS36",65,0)
 .D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS36",66,0)
 Q
"RTN","RMPRPS36",67,0)
 ;
"RTN","RMPRPS36",68,0)
F617 ; Update PIP files 661.7
"RTN","RMPRPS36",69,0)
 K RMI
"RTN","RMPRPS36",70,0)
 F RMI=0:0 S RMI=$O(^RMPR(661.7,"B",RMHOLD,RMI)) Q:RMI'>0  D
"RTN","RMPRPS36",71,0)
 .Q:'$D(^RMPR(661.7,RMI,0))
"RTN","RMPRPS36",72,0)
 .K RMPRFDA,RMPRFME
"RTN","RMPRPS36",73,0)
 .S RMPRIEN=RMI_","
"RTN","RMPRPS36",74,0)
 .S RMPRFDA(661.7,RMPRIEN,.01)=RMHNEW
"RTN","RMPRPS36",75,0)
 .D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS36",76,0)
 Q
"RTN","RMPRPS36",77,0)
 ;
"RTN","RMPRPS36",78,0)
F619 ; Update PIP files 661.9
"RTN","RMPRPS36",79,0)
 K RMI
"RTN","RMPRPS36",80,0)
 F RMI=0:0 S RMI=$O(^RMPR(661.9,RMI)) Q:RMI'>0  D
"RTN","RMPRPS36",81,0)
 .S RM9DAT=^RMPR(661.9,RMI,0)
"RTN","RMPRPS36",82,0)
 .S RM9HCP=$P(RM9DAT,U,2)
"RTN","RMPRPS36",83,0)
 .Q:RM9HCP'=RMHOLD
"RTN","RMPRPS36",84,0)
 .K RMPRFDA,RMPRFME
"RTN","RMPRPS36",85,0)
 .S RMPRIEN=RMI_","
"RTN","RMPRPS36",86,0)
 .S RMPRFDA(661.9,RMPRIEN,1)=RMHNEW
"RTN","RMPRPS36",87,0)
 .D FILE^DIE("","RMPRFDA","RMPRFME")
"RTN","RMPRPS36",88,0)
 Q
"RTN","RMPRPS36",89,0)
 ;
"RTN","RMPRPS36",90,0)
 ;for next update, change RMPRA() local array to the HCPCS that need
"RTN","RMPRPS36",91,0)
 ;to be replaced.
"RTN","RMPRPS36",92,0)
PAT76 ; Set up array and replace HCPCS
"RTN","RMPRPS36",93,0)
 S U="^"
"RTN","RMPRPS36",94,0)
 I '$D(IO("Q")) D
"RTN","RMPRPS36",95,0)
 . W !!,"Replacing the following HCPCS...",!
"RTN","RMPRPS36",96,0)
 . Q
"RTN","RMPRPS36",97,0)
 ;list of replacement HCPCS.
"RTN","RMPRPS36",98,0)
 ;K RMPRA
"RTN","RMPRPS36",99,0)
 ;S RMPRA(1)="K0182^A7018"
"RTN","RMPRPS36",100,0)
 ;S RMPRA(2)="K0269^E0572"
"RTN","RMPRPS36",101,0)
 S I=""
"RTN","RMPRPS36",102,0)
 ;patch #76 - replacement code
"RTN","RMPRPS36",103,0)
 F RMIJ=0:0 S RMIJ=$O(^RMPR(661.1,"RMPR",RMIJ)) Q:RMIJ'>0  D
"RTN","RMPRPS36",104,0)
 .S RMHDA=^RMPR(661.1,"RMPR",RMIJ)
"RTN","RMPRPS36",105,0)
 .S RMHOLD=$P(RMHDA,"^",1),RMHNEW=$P(RMHDA,U,2)
"RTN","RMPRPS36",106,0)
 .I '$D(IO("Q")) D
"RTN","RMPRPS36",107,0)
 .. W !,RMHOLD," with ",RMHNEW
"RTN","RMPRPS36",108,0)
 .;convert 661.11
"RTN","RMPRPS36",109,0)
 .D F6111
"RTN","RMPRPS36",110,0)
 .;convert 661.4
"RTN","RMPRPS36",111,0)
 .D F614
"RTN","RMPRPS36",112,0)
 .;convert 661.41
"RTN","RMPRPS36",113,0)
 .D F6141
"RTN","RMPRPS36",114,0)
 .;convert 661.6
"RTN","RMPRPS36",115,0)
 .D F616
"RTN","RMPRPS36",116,0)
 .;convert 661.7
"RTN","RMPRPS36",117,0)
 .D F617
"RTN","RMPRPS36",118,0)
 .;convert 661.9
"RTN","RMPRPS36",119,0)
 .D F619
"RTN","RMPRPS36",120,0)
 I '$D(IO("Q")) D
"RTN","RMPRPS36",121,0)
 . W !!,"HCPCS replacement complete.",!
"RTN","RMPRPS36",122,0)
 . Q
"RTN","RMPRPS36",123,0)
 Q
"RTN","RMPRPS36",124,0)
 ;
"RTN","RMPRPS36",125,0)
PAT77 ;Convert old HCPCS and set consult service requestor in file 660.
"RTN","RMPRPS36",126,0)
 ;this label is called by patch 77 post-init.
"RTN","RMPRPS36",127,0)
 ;add new HCPCS to file #661.1
"RTN","RMPRPS36",128,0)
 S U="^"
"RTN","RMPRPS36",129,0)
 W !!,"Adding new PSAS HCPCS to file #661.1.....",!
"RTN","RMPRPS36",130,0)
 S DIK="^RMPR(661.1,"
"RTN","RMPRPS36",131,0)
 F RMI=1:1 S RMDAT=$P($T(ADDHCPC+RMI),";",3) Q:RMDAT="END"  D
"RTN","RMPRPS36",132,0)
 .S RIEN=$P(RMDAT,":",1)
"RTN","RMPRPS36",133,0)
 .S RNOD=$P(RMDAT,":",2)
"RTN","RMPRPS36",134,0)
 .S RDAT=$P(RMDAT,":",3)
"RTN","RMPRPS36",135,0)
 .S RARR(RIEN)=""
"RTN","RMPRPS36",136,0)
 .I RNOD=2 S ^RMPR(661.1,RIEN,RNOD,1,0)=RDAT
"RTN","RMPRPS36",137,0)
 .E  S ^RMPR(661.1,RIEN,RNOD)=RDAT
"RTN","RMPRPS36",138,0)
 ;
"RTN","RMPRPS36",139,0)
 F RMI=0:0 S RMI=$O(RARR(RMI)) Q:RMI'>0  D
"RTN","RMPRPS36",140,0)
 .S ^RMPR(661.1,RMI,2,0)="^661.18^1^1"
"RTN","RMPRPS36",141,0)
 .S DA=RMI D IX1^DIK
"RTN","RMPRPS36",142,0)
 S $P(^RMPR(661.1,0),U,3)=3915
"RTN","RMPRPS36",143,0)
 S $P(^RMPR(661.1,0),U,4)=3035
"RTN","RMPRPS36",144,0)
 W !!,"Done adding new PSAS HCPCS!!!",!
"RTN","RMPRPS36",145,0)
 D CONV
"RTN","RMPRPS36",146,0)
 D SCRS^RMPRPCE1
"RTN","RMPRPS36",147,0)
 D CFLG^RMPRPS35
"RTN","RMPRPS36",148,0)
 Q
"RTN","RMPRPS36",149,0)
ADDHCPC ;list of HCPCS added in #77
"RTN","RMPRPS36",150,0)
 ;;3906:0:G0290^STENT, DRUG ELUTING W/DEL SYS^^106939^1^^960 E
"RTN","RMPRPS36",151,0)
 ;;3906:2:STENT, DRUG ELUTING WITH DELIVERY SYSTEM
"RTN","RMPRPS36",152,0)
 ;;3906:4:GY,NU
"RTN","RMPRPS36",153,0)
 ;;3907:0:G0291^STENT, DRUG ELUTING W/O DEL^^106940^1^^960 E
"RTN","RMPRPS36",154,0)
 ;;3907:2:STENT, DRUG ELUTING WITH OUT DELIVERY SYSTEM
"RTN","RMPRPS36",155,0)
 ;;3907:4:GY,NU
"RTN","RMPRPS36",156,0)
 ;;3908:0:TM100^TELEMED HOME COMPUTER/EQUIPMT^^100201^1^R80 C^900 K
"RTN","RMPRPS36",157,0)
 ;;3908:2:TELEMEDICINE HOME COMPUTER EQUIPMENT
"RTN","RMPRPS36",158,0)
 ;;3908:4:NU,RP
"RTN","RMPRPS36",159,0)
 ;;3910:0:TM102^TELEMED HOME EQUIPMENT^^100201^1^R80 C^900 K
"RTN","RMPRPS36",160,0)
 ;;3910:2:TELEMEDICINE HOME EQUIPMENT
"RTN","RMPRPS36",161,0)
 ;;3910:4:NU,RP
"RTN","RMPRPS36",162,0)
 ;;3912:0:TM104^TELEMED AUDIO/VIDEO^^100201^1^R80 C^900 K
"RTN","RMPRPS36",163,0)
 ;;3912:2:TELEMEDICINE VIDEOPHONE/AUDIO VIDEO
"RTN","RMPRPS36",164,0)
 ;;3912:4:NU,RP
"RTN","RMPRPS36",165,0)
 ;;3913:0:TM105^TELEMED WOUND CARE^^100201^1^R80 C^900 K
"RTN","RMPRPS36",166,0)
 ;;3913:2:TELEMEDICINE WOUND CARE EQUIPMENT
"RTN","RMPRPS36",167,0)
 ;;3913:4:NU,RP
"RTN","RMPRPS36",168,0)
 ;;3914:0:TM101^TELEMED VIDEO MONITOR^^100201^1^R80 C^900 K
"RTN","RMPRPS36",169,0)
 ;;3914:2:TELEMEDICINE VIDEO MONITOR
"RTN","RMPRPS36",170,0)
 ;;3914:4:NU,RP
"RTN","RMPRPS36",171,0)
 ;;3915:0:TM103^TELEMED MESSAGE/MONITORING^^100201^1^R80 C^900 K
"RTN","RMPRPS36",172,0)
 ;;3915:2:TELEMEDICINE IN HOME MESSAGE MONITORING
"RTN","RMPRPS36",173,0)
 ;;3915:4:NU,RP
"RTN","RMPRPS36",174,0)
 ;;END
"RTN","RMPRPS36",175,0)
CONV ;convert old HCPCS in PIP to new HCPCS
"RTN","RMPRPS36",176,0)
 W !!,"Replacing old/INACTIVE HCPCS to new/ACTIVE HCPCS in PIP.....",!
"RTN","RMPRPS36",177,0)
 S RMFLG61=""
"RTN","RMPRPS36",178,0)
 I $D(^RMPR(661.6)),$D(^RMPR(661.7)),$D(^RMPR(661.9)) S RMFLG61=1
"RTN","RMPRPS36",179,0)
 F RMPRII=1:1 S RMHCDA=$P($T(HLST+RMPRII),";",3) Q:RMHCDA=""  D
"RTN","RMPRPS36",180,0)
 .S RMHOLD=$P(RMHCDA,U,1),RMHNEW=$P(RMHCDA,U,2)
"RTN","RMPRPS36",181,0)
 .Q:'$D(^RMPR(661.1,"B",RMHOLD))!'$D(^RMPR(661.1,"B",RMHNEW))
"RTN","RMPRPS36",182,0)
 .S RMHNEWI=$O(^RMPR(661.1,"B",RMHNEW,0)) Q:'$G(RMHNEWI)
"RTN","RMPRPS36",183,0)
 .;quit if the new HCPCS has been used in stock issue.
"RTN","RMPRPS36",184,0)
 .S RMFLG=""
"RTN","RMPRPS36",185,0)
 .F R6I=0:0 S R6I=$O(^RMPR(660,"H",RMHNEWI,R6I)) Q:R6I'>0!$G(RMFLG)  D
"RTN","RMPRPS36",186,0)
 ..I $D(^RMPR(660,R6I,0)),$P(^RMPR(660,R6I,0),U,13)=11 S RMFLG=1 Q
"RTN","RMPRPS36",187,0)
 .Q:$G(RMFLG)
"RTN","RMPRPS36",188,0)
 .I $G(RMFLG61) D
"RTN","RMPRPS36",189,0)
 ..;convert 661.11
"RTN","RMPRPS36",190,0)
 ..D F6111
"RTN","RMPRPS36",191,0)
 ..;convert 661.4
"RTN","RMPRPS36",192,0)
 ..D F614
"RTN","RMPRPS36",193,0)
 ..;convert 661.41
"RTN","RMPRPS36",194,0)
 ..D F6141
"RTN","RMPRPS36",195,0)
 ..;convert 661.6
"RTN","RMPRPS36",196,0)
 ..D F616
"RTN","RMPRPS36",197,0)
 ..;convert 661.7
"RTN","RMPRPS36",198,0)
 ..D F617
"RTN","RMPRPS36",199,0)
 ..;convert 661.9
"RTN","RMPRPS36",200,0)
 ..D F619
"RTN","RMPRPS36",201,0)
 . E  D ITEM^RMPRPS35(RMHOLD,RMHNEW)
"RTN","RMPRPS36",202,0)
 I '$D(IO("Q")) W !!,"HCPCS replacement complete!!!",!
"RTN","RMPRPS36",203,0)
 Q
"RTN","RMPRPS36",204,0)
 ;
"RTN","RMPRPS36",205,0)
HLST ;List of old^new HCPCS
"RTN","RMPRPS36",206,0)
 ;;A4360^A4521
"RTN","RMPRPS36",207,0)
 ;;A4370^A4405
"RTN","RMPRPS36",208,0)
 ;;A4454^A4450
"RTN","RMPRPS36",209,0)
 ;;A4460^A6430
"RTN","RMPRPS36",210,0)
 ;;A5123^A4373
"RTN","RMPRPS36",211,0)
 ;;A9010^V2020
"RTN","RMPRPS36",212,0)
 ;;A9040^V5298
"RTN","RMPRPS36",213,0)
 ;;A9070^L3219
"RTN","RMPRPS36",214,0)
 ;;BA108^BA208
"RTN","RMPRPS36",215,0)
 ;;BA109^BA208
"RTN","RMPRPS36",216,0)
 ;;BA110^BA208
"RTN","RMPRPS36",217,0)
 ;;BA111^BA208
"RTN","RMPRPS36",218,0)
 ;;BA112^BA208
"RTN","RMPRPS36",219,0)
 ;;BA113^BA209
"RTN","RMPRPS36",220,0)
 ;;BA114^BA209
"RTN","RMPRPS36",221,0)
 ;;BA115^BA209
"RTN","RMPRPS36",222,0)
 ;;BA116^BA209
"RTN","RMPRPS36",223,0)
 ;;BA117^BA209
"RTN","RMPRPS36",224,0)
 ;;BA118^BA204
"RTN","RMPRPS36",225,0)
 ;;BA119^BA203
"RTN","RMPRPS36",226,0)
 ;;BA120^BA203
"RTN","RMPRPS36",227,0)
 ;;BA121^BA203
"RTN","RMPRPS36",228,0)
 ;;BA122^BA203
"RTN","RMPRPS36",229,0)
 ;;BA123^BA203
"RTN","RMPRPS36",230,0)
 ;;BA124^BA203
"RTN","RMPRPS36",231,0)
 ;;BA125^BA202
"RTN","RMPRPS36",232,0)
 ;;BA126^BA204
"RTN","RMPRPS36",233,0)
 ;;BA127^BA207
"RTN","RMPRPS36",234,0)
 ;;BA128^BA203
"RTN","RMPRPS36",235,0)
 ;;BA129^BA203
"RTN","RMPRPS36",236,0)
 ;;BA130^BA207
"RTN","RMPRPS36",237,0)
 ;;BA131^BA203
"RTN","RMPRPS36",238,0)
 ;;BA133^BA203
"RTN","RMPRPS36",239,0)
 ;;BA134^BA206
"RTN","RMPRPS36",240,0)
 ;;BA135^BA206
"RTN","RMPRPS36",241,0)
 ;;BA136^BA206
"RTN","RMPRPS36",242,0)
 ;;BA137^BA206
"RTN","RMPRPS36",243,0)
 ;;BA138^BA206
"RTN","RMPRPS36",244,0)
 ;;BA139^DL188
"RTN","RMPRPS36",245,0)
 ;;BA140^DL188
"RTN","RMPRPS36",246,0)
 ;;BA141^DL188
"RTN","RMPRPS36",247,0)
 ;;BA142^DL188
"RTN","RMPRPS36",248,0)
 ;;BA143^DL188
"RTN","RMPRPS36",249,0)
 ;;BA144^DL188
"RTN","RMPRPS36",250,0)
 ;;BA145^DL188
"RTN","RMPRPS36",251,0)
 ;;BA146^DL188
"RTN","RMPRPS36",252,0)
 ;;BA147^DL188
"RTN","RMPRPS36",253,0)
 ;;BA148^DL188
"RTN","RMPRPS36",254,0)
 ;;BA149^BA209
"RTN","RMPRPS36",255,0)
 ;;BA150^DL188
"RTN","RMPRPS36",256,0)
 ;;BA151^DL188
"RTN","RMPRPS36",257,0)
 ;;BA152^DL188
"RTN","RMPRPS36",258,0)
 ;;BA153^DL188
"RTN","RMPRPS36",259,0)
 ;;BA154^DL188
"RTN","RMPRPS36",260,0)
 ;;BA155^DL188
"RTN","RMPRPS36",261,0)
 ;;BA156^DL188
"RTN","RMPRPS36",262,0)
 ;;BA157^DL188
"RTN","RMPRPS36",263,0)
 ;;BA158^BA205
"RTN","RMPRPS36",264,0)
 ;;BA159^DL188
"RTN","RMPRPS36",265,0)
 ;;BA160^DL188
"RTN","RMPRPS36",266,0)
 ;;BA161^DL188
"RTN","RMPRPS36",267,0)
 ;;BA162^BA210
"RTN","RMPRPS36",268,0)
 ;;BA163^BA210
"RTN","RMPRPS36",269,0)
 ;;BA164^BA210
"RTN","RMPRPS36",270,0)
 ;;BA165^BA210
"RTN","RMPRPS36",271,0)
 ;;BA166^BA210
"RTN","RMPRPS36",272,0)
 ;;BA167^BA210
"RTN","RMPRPS36",273,0)
 ;;BA168^BA203
"RTN","RMPRPS36",274,0)
 ;;BA169^BA203
"RTN","RMPRPS36",275,0)
 ;;BA170^BA206
"RTN","RMPRPS36",276,0)
 ;;BA173^BA203
"RTN","RMPRPS36",277,0)
 ;;BA174^BA203
"RTN","RMPRPS36",278,0)
 ;;BA175^BA203
"RTN","RMPRPS36",279,0)
 ;;BA176^BA202
"RTN","RMPRPS36",280,0)
 ;;BA177^BA204
"RTN","RMPRPS36",281,0)
 ;;BA178^BA205
"RTN","RMPRPS36",282,0)
 ;;BA180^BA203
"RTN","RMPRPS36",283,0)
 ;;BA183^BA205
"RTN","RMPRPS36",284,0)
 ;;BA184^BA200
"RTN","RMPRPS36",285,0)
 ;;BA185^BA200
"RTN","RMPRPS36",286,0)
 ;;BA186^BA201
"RTN","RMPRPS36",287,0)
 ;;BA187^BA201
"RTN","RMPRPS36",288,0)
 ;;BA189^BA200
"RTN","RMPRPS36",289,0)
 ;;BA190^BA205
"RTN","RMPRPS36",290,0)
 ;;C1780^V2630
"RTN","RMPRPS36",291,0)
 ;;DL100^DL186
"RTN","RMPRPS36",292,0)
 ;;DL101^DL186
"RTN","RMPRPS36",293,0)
 ;;DL102^DL186
"RTN","RMPRPS36",294,0)
 ;;DL103^DL186
"RTN","RMPRPS36",295,0)
 ;;DL104^DL186
"RTN","RMPRPS36",296,0)
 ;;DL105^DL186
"RTN","RMPRPS36",297,0)
 ;;DL106^DL186
"RTN","RMPRPS36",298,0)
 ;;DL107^DL186
"RTN","RMPRPS36",299,0)
 ;;DL108^DL186
"RTN","RMPRPS36",300,0)
 ;;DL109^DL190
"RTN","RMPRPS36",301,0)
 ;;DL110^DL190
"RTN","RMPRPS36",302,0)
 ;;DL111^DL190
"RTN","RMPRPS36",303,0)
 ;;DL112^DL190
"RTN","RMPRPS36",304,0)
 ;;DL113^DL188
"RTN","RMPRPS36",305,0)
 ;;DL114^DL188
"RTN","RMPRPS36",306,0)
 ;;DL115^DL190
"RTN","RMPRPS36",307,0)
 ;;DL116^DL188
"RTN","RMPRPS36",308,0)
 ;;DL117^DL188
"RTN","RMPRPS36",309,0)
 ;;DL118^DL188
"RTN","RMPRPS36",310,0)
 ;;DL119^DL188
"RTN","RMPRPS36",311,0)
 ;;DL122^DL191
"RTN","RMPRPS36",312,0)
 ;;DL123^DL191
"RTN","RMPRPS36",313,0)
 ;;DL124^DL191
"RTN","RMPRPS36",314,0)
 ;;DL125^DL188
"RTN","RMPRPS36",315,0)
 ;;DL126^DL188
"RTN","RMPRPS36",316,0)
 ;;DL127^DL191
"RTN","RMPRPS36",317,0)
 ;;DL128^DL191
"RTN","RMPRPS36",318,0)
 ;;DL130^DL191
"RTN","RMPRPS36",319,0)
 ;;DL131^DL191
"RTN","RMPRPS36",320,0)
 ;;DL132^DL191
"RTN","RMPRPS36",321,0)
 ;;DL133^DL191
"RTN","RMPRPS36",322,0)
 ;;DL134^DL192
"RTN","RMPRPS36",323,0)
 ;;DL135^DL191
"RTN","RMPRPS36",324,0)
 ;;DL136^DL188
"RTN","RMPRPS36",325,0)
 ;;DL137^DL188
"RTN","RMPRPS36",326,0)
 ;;DL138^DL188
"RTN","RMPRPS36",327,0)
 ;;DL139^DL188
"RTN","RMPRPS36",328,0)
 ;;DL140^DL188
"RTN","RMPRPS36",329,0)
 ;;DL141^DL188
"RTN","RMPRPS36",330,0)
 ;;DL142^DL188
"RTN","RMPRPS36",331,0)
 ;;DL143^DL188
"RTN","RMPRPS36",332,0)
 ;;DL148^DL187
"RTN","RMPRPS36",333,0)
 ;;DL149^DL187
"RTN","RMPRPS36",334,0)
 ;;DL150^DL187
"RTN","RMPRPS36",335,0)
 ;;DL151^DL187
"RTN","RMPRPS36",336,0)
 ;;DL152^DL189
"RTN","RMPRPS36",337,0)
 ;;DL153^DL187
"RTN","RMPRPS36",338,0)
 ;;DL154^DL186
"RTN","RMPRPS36",339,0)
 ;;DL155^DL186
"RTN","RMPRPS36",340,0)
 ;;DL156^DL187
"RTN","RMPRPS36",341,0)
 ;;DL157^DL187
"RTN","RMPRPS36",342,0)
 ;;DL158^DL187
"RTN","RMPRPS36",343,0)
 ;;DL159^DL187
"RTN","RMPRPS36",344,0)
 ;;DL160^DL187
"RTN","RMPRPS36",345,0)
 ;;DL161^DL189
"RTN","RMPRPS36",346,0)
 ;;DL162^DL189
"RTN","RMPRPS36",347,0)
 ;;DL163^DL188
"RTN","RMPRPS36",348,0)
 ;;DL164^DL188
"RTN","RMPRPS36",349,0)
 ;;DL165^DL188
"RTN","RMPRPS36",350,0)
 ;;DL166^DL188
"RTN","RMPRPS36",351,0)
 ;;DL167^DL188
"RTN","RMPRPS36",352,0)
 ;;DL170^DL192
"RTN","RMPRPS36",353,0)
 ;;DL171^DL192
"RTN","RMPRPS36",354,0)
 ;;DL172^DL192
"RTN","RMPRPS36",355,0)
 ;;DL173^DL192
"RTN","RMPRPS36",356,0)
 ;;DL174^DL192
"RTN","RMPRPS36",357,0)
 ;;DL178^VA145
"RTN","RMPRPS36",358,0)
 ;;DL179^VA146
"RTN","RMPRPS36",359,0)
 ;;DL182^DL187
"RTN","RMPRPS36",360,0)
 ;;E1638^E0210
"RTN","RMPRPS36",361,0)
 ;;E0690^E0691
"RTN","RMPRPS36",362,0)
 ;;E1638^E0210
"RTN","RMPRPS36",363,0)
 ;;K0021^E0971
"RTN","RMPRPS36",364,0)
 ;;K0034^E0951
"RTN","RMPRPS36",365,0)
 ;;K0101^E0958
"RTN","RMPRPS36",366,0)
 ;;K0183^A7034
"RTN","RMPRPS36",367,0)
 ;;K0184^A7032
"RTN","RMPRPS36",368,0)
 ;;K0185^A7035
"RTN","RMPRPS36",369,0)
 ;;K0186^A7036
"RTN","RMPRPS36",370,0)
 ;;K0187^A7037
"RTN","RMPRPS36",371,0)
 ;;K0188^A7038
"RTN","RMPRPS36",372,0)
 ;;K0551^E1020
"RTN","RMPRPS36",373,0)
 ;;L0920^L0500
"RTN","RMPRPS36",374,0)
 ;;L0391^L0470
"RTN","RMPRPS36",375,0)
 ;;L0920^L0500
"RTN","RMPRPS36",376,0)
 ;;L0930^L0510
"RTN","RMPRPS36",377,0)
 ;;L0940^L0500
"RTN","RMPRPS36",378,0)
 ;;L0950^L0510
"RTN","RMPRPS36",379,0)
 ;;L3218^L3260
"RTN","RMPRPS36",380,0)
 ;;L3223^L3260
"RTN","RMPRPS36",381,0)
 ;;L5660^K0556
"RTN","RMPRPS36",382,0)
 ;;L5662^K0557
"RTN","RMPRPS36",383,0)
 ;;L5663^K0558
"RTN","RMPRPS36",384,0)
 ;;L5664^K0559
"RTN","RMPRPS36",385,0)
 ;;S8403^A4528
"RTN","RMPRPS36",386,0)
 ;;S8405^A4535
"RTN","RMPRPS36",387,0)
 ;;
"RTN","RMPRSE1")
0^15^B21351335
"RTN","RMPRSE1",1,0)
RMPRSE1 ;PHX/RFM-SEARCH FILE 660 ENTRIES FOR ITEM HISTORY ;8/29/1994
"RTN","RMPRSE1",2,0)
 ;;3.0;PROSTHETICS;**20,57,77**;Feb 09, 1996
"RTN","RMPRSE1",3,0)
 ;RVD 3/17/03 patch #77 - allow queing to p-message.  IO to ION.
"RTN","RMPRSE1",4,0)
 ;                      - use RMPR("STA") instead of $$STA^RMPRUTIL.
"RTN","RMPRSE1",5,0)
 ;
"RTN","RMPRSE1",6,0)
EN N ITEM,RMPRARR,RMPRI D HOME^%ZIS,DIV4^RMPRSIT G:$D(X) EXIT1 S DIC="^RMPR(661,",DIC(0)="AEQM" F ITEM=1:1 S DIC("A")="Select ITEM "_ITEM_": " D ^DIC G:$D(DTOUT)!(X["^")!(X=""&(ITEM=1)) EXIT1 Q:X=""  D
"RTN","RMPRSE1",7,0)
 .I $D(RMPRI(+Y)) W $C(7)," ??",?40,"..Duplicate Item" S ITEM=ITEM-1 Q
"RTN","RMPRSE1",8,0)
 .S RMPRARR(ITEM)=+Y,RMPRI(+Y)=""
"RTN","RMPRSE1",9,0)
 S RMPRCOUN=0 W !! S %DT("A")="Beginning Date: ",%DT="AEPX",%DT("B")="T-30" D ^%DT S RMPRBDT=Y G:Y<0 EXIT1
"RTN","RMPRSE1",10,0)
ENDATE S %DT("A")="Ending Date: ",%DT="AEX",%DT("B")="TODAY" D ^%DT G:Y<0 EXIT1 I RMPRBDT>Y W !,$C(7),"Invalid Date Range Selection!!" G ENDATE
"RTN","RMPRSE1",11,0)
 G:Y<0 EXIT S RMPREDT=Y,Y=RMPRBDT D DD^%DT S RMPRX=Y,Y=RMPREDT D DD^%DT S RMPRY=Y
"RTN","RMPRSE1",12,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT
"RTN","RMPRSE1",13,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPRSE1",14,0)
 K IO("Q") S ZTDESC="SEARCH FOR RECALLED ITEM",ZTRTN="PRINT^RMPRSE1",ZTIO=ION,ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPRI(")="",ZTSAVE("RMPRX")="",ZTSAVE("RMPRY")="",ZTSAVE("RMPR(""STA"")")="",ZTSAVE("RMPRARR(")=""
"RTN","RMPRSE1",15,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT1
"RTN","RMPRSE1",16,0)
PRINT ;ENTRY POINT FOR PRINTING REPORT
"RTN","RMPRSE1",17,0)
 S PAGE=1,(RMPRCOUN,RP,QTYT,COSTT)=0 I IOST["C-" D WAIT^DICD
"RTN","RMPRSE1",18,0)
PRI S RQ=0 F  S RQ=$O(RMPRARR(RQ)) Q:RQ=""!($D(KILL))  S RO=$P(RMPRARR(RQ),U),RO=RO-1 D PRI1
"RTN","RMPRSE1",19,0)
 G EXIT
"RTN","RMPRSE1",20,0)
PRI1 F  S RO=$O(^RMPR(660,"AD",RO)) D:RO=""!(RO'=$P(RMPRARR(RQ),U)) REST Q:RO=""!(RO'=$P(RMPRARR(RQ),U))!($D(KILL))  K ENDD F  S RP=$O(^RMPR(660,"AD",RO,RP)) Q:RP=""!($D(KILL))  D CK
"RTN","RMPRSE1",21,0)
 Q
"RTN","RMPRSE1",22,0)
EXIT ;EXIT FROM REPORT HERE
"RTN","RMPRSE1",23,0)
 I RMPRCOUN>0,$D(RMPREDT),'$D(KILL) W !!?32,"END OF REPORT"
"RTN","RMPRSE1",24,0)
 I $E(IOST)["C"&($Y<22),'$D(ENDD) F  W ! Q:$Y>20
"RTN","RMPRSE1",25,0)
 I $D(RMPREDT),$E(IOST)["C",'$D(RMPRFLL),'$D(KILL),'$D(DUOUT),'$D(DTOUT),'$D(ENDD) K DIR S DIR(0)="E" D ^DIR
"RTN","RMPRSE1",26,0)
EXIT1 K RMPRARR,%DT,GOTO,QTYT,ITEM,KILL,ENDD,RQ,RP,RO,ITEM,RMPRI,COSTT,DIC,DIR,PAGE,RO,RMPRCOUN,RMPRSE,RMPRBDT,RMPREDT,RMPRX,RMPRY D ^%ZISC
"RTN","RMPRSE1",27,0)
 Q
"RTN","RMPRSE1",28,0)
CK Q:'$D(^RMPR(660,RP,0))
"RTN","RMPRSE1",29,0)
 I $P(^RMPR(660,RP,0),U,10)'=RMPR("STA") Q
"RTN","RMPRSE1",30,0)
 I ($P(^(0),U,4)="X")!('$P(^(0),U,6))!($P(^(0),U,3)<RMPRBDT)!($P(^(0),U,3)>RMPREDT)  Q  I '$D(^PRC(441,$P(^RMPR(661,$P(^(0),U,6),0),U))) Q
"RTN","RMPRSE1",31,0)
 I $P(RMPRARR(RQ),U)=$P(^RMPR(660,RP,0),U,6) D CON
"RTN","RMPRSE1",32,0)
 Q
"RTN","RMPRSE1",33,0)
CON I $Y>(IOSL-6),PAGE=1,'RMPRCOUN W @IOF
"RTN","RMPRSE1",34,0)
 D HEAD S RMPRCOUN=RMPRCOUN+1
"RTN","RMPRSE1",35,0)
 S Y=$P(^RMPR(660,RP,0),U,3) D DD^%DT W !,Y,?15,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,1),1,13),?30,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,9),6,9)
"RTN","RMPRSE1",36,0)
 W:$P(^RMPR(660,RP,0),U,9)'="" ?36,$E($P(^PRC(440,$P(^RMPR(660,RP,0),U,9),0),U,1),1,35)
"RTN","RMPRSE1",37,0)
 W !,"SERIAL NBR:",?12,$E($P(^RMPR(660,RP,0),U,11),1,12),?25,"QTY: ",$J($P(^(0),U,7),4),?38,"TOTAL COST: ",$J($FN($P(^(0),U,16),"P",2),8) S QTYT=QTYT+$P(^(0),U,7),COSTT=COSTT+$P(^(0),U,16)
"RTN","RMPRSE1",38,0)
 W ?60,$S($P(^RMPR(660,RP,0),U,4)="I":"INITIAL ISSUE",$P(^(0),U,4)="R":"REPLACEMENT",$P(^(0),U,4)="S":"SPARE",1:"UNK"),!,"INITIATOR: " I $P(^(0),U,27),$D(^VA(200,$P(^(0),U,27),0)) W ?15,$P(^(0),U),!
"RTN","RMPRSE1",39,0)
 I $E(IOST)["C"&($Y>(IOSL-6)) S DIR(0)="E" D ^DIR S:Y<1 KILL=1 Q:Y<1  K DIR W @IOF D HEAD Q
"RTN","RMPRSE1",40,0)
 I $Y>(IOSL-6) W @IOF D HEAD
"RTN","RMPRSE1",41,0)
 Q
"RTN","RMPRSE1",42,0)
HEAD I $Y<2!(PAGE=1) W !,"ITEM HISTORY:",?15,$E($P(^PRC(441,$P(^RMPR(661,$P(^RMPR(660,RP,0),U,6),0),U,1),0),U,2),1,39),?63,"STA ",RMPR("STA"),?72,"PAGE ",PAGE S PAGE=PAGE+1
"RTN","RMPRSE1",43,0)
 I  W !!,"REQUEST DATE",?15,"PATIENT NAME",?30,"SSN",?36,"VENDOR" S Y=RMPRBDT D DD^%DT W ?55,Y,"-" S Y=RMPREDT D DD^%DT W Y
"RTN","RMPRSE1",44,0)
 Q
"RTN","RMPRSE1",45,0)
REST D:'RMPRCOUN NONE Q:$D(KILL)!('RMPRCOUN)  W !,"TOTAL DOLLARS SPENT ON THIS ITEM: ","$"_$J($FN(COSTT,"P",2),9),?45,"TOTAL QUANTITY ISSUED: ",$J(QTYT,4) I $O(RMPRARR(RQ)),$E(IOST)["C" W ! K DIR S DIR(0)="E" D ^DIR S:Y<1 KILL=1 W:'$D(KILL) @IOF
"RTN","RMPRSE1",46,0)
 I $E(IOST)'["C",$O(RMPRARR(RQ)) W @IOF
"RTN","RMPRSE1",47,0)
 S (COSTT,QTYT,RMPRCOUN)="" Q
"RTN","RMPRSE1",48,0)
NONE W @IOF,!!,"No Item History for this date range for:",!,$P(^PRC(441,$P(^RMPR(661,$P(RMPRARR(RQ),U),0),U),0),U,2) I $E(IOST)["C" K DIR S DIR(0)="E" W !!!! D ^DIR S:Y<1 KILL=1 S ENDD=1
"RTN","RMPRSE1",49,0)
 Q
"RTN","RMPRSE2")
0^16^B22196712
"RTN","RMPRSE2",1,0)
RMPRSE2 ;PHX/RFM/HNB -SEARCH FILE 660 ENTRIES FOR HCPCS HISTORY ;1/23/1998
"RTN","RMPRSE2",2,0)
 ;;3.0;PROSTHETICS;**28,30,32,36,46,77**;Feb 09, 1996
"RTN","RMPRSE2",3,0)
 ;RVD 3/17/03 patch #77 - allow queing to p-message.  IO to ION.
"RTN","RMPRSE2",4,0)
 ;this routine is modified for future patch
"RTN","RMPRSE2",5,0)
EN S (ITEM,RMPRARR,RMPRI)=""
"RTN","RMPRSE2",6,0)
 K KILL
"RTN","RMPRSE2",7,0)
 D HOME^%ZIS,DIV4^RMPRSIT G:$D(X) EXIT1
"RTN","RMPRSE2",8,0)
 W !!!
"RTN","RMPRSE2",9,0)
 S DIC="^ICPT(",DIC(0)="AEQM"
"RTN","RMPRSE2",10,0)
 F ITEM=1:1 S DIC("A")="Select HCPCS ("_ITEM_"): " D ^DIC G:$D(DTOUT)!(X["^")!(X=""&(ITEM=1)) EXIT1 Q:X=""  D
"RTN","RMPRSE2",11,0)
 .I $D(RMPRI(+Y)) W !,$C(7)," ??",?40,"..Duplicate HCPCS" S ITEM=ITEM-1 Q
"RTN","RMPRSE2",12,0)
 .S RMPRARR(ITEM)=+Y,RMPRI(+Y)=""
"RTN","RMPRSE2",13,0)
 S RMPRCOUN=0 W !! S %DT("A")="Beginning Date: ",%DT="AEPX",%DT("B")="T-30" D ^%DT S RMPRBDT=Y G:Y<0 EXIT1
"RTN","RMPRSE2",14,0)
ENDATE S %DT("A")="Ending Date: ",%DT="AEX",%DT("B")="TODAY"
"RTN","RMPRSE2",15,0)
 D ^%DT G:Y<0 EXIT1
"RTN","RMPRSE2",16,0)
 I RMPRBDT>Y W !,$C(7),"Invalid Date Range Selection!!" G ENDATE
"RTN","RMPRSE2",17,0)
 G:Y<0 EXIT
"RTN","RMPRSE2",18,0)
 S RMPREDT=Y,Y=RMPRBDT D DD^%DT S RMPRX=Y,Y=RMPREDT D DD^%DT S RMPRY=Y
"RTN","RMPRSE2",19,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT
"RTN","RMPRSE2",20,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPRSE2",21,0)
 K IO("Q") S ZTDESC="SEARCH FOR RECALLED ITEM",ZTRTN="PRINT^RMPRSE2",ZTIO=ION,ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPRI(")="",ZTSAVE("RMPRX")="",ZTSAVE("RMPRY")="",ZTSAVE("RMPR(""STA"")")="",ZTSAVE("RMPRARR(")=""
"RTN","RMPRSE2",22,0)
 S ZTSAVE("RMPRSITE")=""
"RTN","RMPRSE2",23,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT1
"RTN","RMPRSE2",24,0)
PRINT ;ENTRY POINT FOR PRINTING REPORT
"RTN","RMPRSE2",25,0)
 S PAGE=1,(RMPRCOUN,RP,QTYT,COSTT)=0
"RTN","RMPRSE2",26,0)
 S RQ=0
"RTN","RMPRSE2",27,0)
 F  S RQ=$O(RMPRARR(RQ)) Q:RQ'>0!($D(KILL))  D  D REST
"RTN","RMPRSE2",28,0)
 .S RO=$P(RMPRARR(RQ),U,1),RO=RO-1
"RTN","RMPRSE2",29,0)
 .F  S RO=$O(^RMPR(660,"G",RO)) Q:RO'>0  D
"RTN","RMPRSE2",30,0)
 . .Q:RO=""!(RO'=$P(RMPRARR(RQ),U))!($D(KILL))
"RTN","RMPRSE2",31,0)
 . .K ENDD
"RTN","RMPRSE2",32,0)
 . .F  S RP=$O(^RMPR(660,"G",RO,RP)) Q:RP=""!($D(KILL))  D CK
"RTN","RMPRSE2",33,0)
 G EXIT
"RTN","RMPRSE2",34,0)
 Q
"RTN","RMPRSE2",35,0)
EXIT ;EXIT FROM REPORT HERE
"RTN","RMPRSE2",36,0)
 I RMPRCOUN>0,$D(RMPREDT),'$D(KILL) W !!?32,"END OF REPORT"
"RTN","RMPRSE2",37,0)
 I $E(IOST)["C"&($Y<22),'$D(ENDD) F  W ! Q:$Y>20
"RTN","RMPRSE2",38,0)
 I $D(RMPREDT),$E(IOST)["C",'$D(RMPRFLL),'$D(KILL),'$D(DUOUT),'$D(DTOUT),'$D(ENDD) K DIR S DIR(0)="E" D ^DIR
"RTN","RMPRSE2",39,0)
EXIT1 K RMPRARR,%DT,GOTO,QTYT,ITEM,KILL,ENDD,RQ,RP,RO,ITEM,RMPRI,COSTT,DIC,DIR,PAGE,RO,RMPRCOUN,RMPRSE,RMPRBDT,RMPREDT,RMPRX,RMPRY D ^%ZISC
"RTN","RMPRSE2",40,0)
 Q
"RTN","RMPRSE2",41,0)
CK Q:'$D(^RMPR(660,RP,0))
"RTN","RMPRSE2",42,0)
 ;hcpcs
"RTN","RMPRSE2",43,0)
 I ('$P(^(0),U,22))!($P(^(0),U,3)<RMPRBDT)!($P(^(0),U,3)>RMPREDT)  Q
"RTN","RMPRSE2",44,0)
 I $P(^RMPR(660,RP,0),U,10)'=RMPR("STA") Q
"RTN","RMPRSE2",45,0)
 ;I '$D(^PRC(441,$P(^RMPR(661,$P(^(0),U,6),0),U))) Q
"RTN","RMPRSE2",46,0)
 I $P(RMPRARR(RQ),U,1)=$P(^RMPR(660,RP,0),U,22) D CON
"RTN","RMPRSE2",47,0)
 Q
"RTN","RMPRSE2",48,0)
 ;
"RTN","RMPRSE2",49,0)
CON I $Y>(IOSL-6),PAGE=1,'RMPRCOUN W @IOF
"RTN","RMPRSE2",50,0)
 D HEAD S RMPRCOUN=RMPRCOUN+1
"RTN","RMPRSE2",51,0)
 S Y=$P(^RMPR(660,RP,0),U,3) D DD^%DT
"RTN","RMPRSE2",52,0)
 W !,Y,?15,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,1),1,13),?30,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,9),6,9)
"RTN","RMPRSE2",53,0)
 W:$P(^RMPR(660,RP,0),U,9)'="" ?36,$E($P(^PRC(440,$P(^RMPR(660,RP,0),U,9),0),U,1),1,35)
"RTN","RMPRSE2",54,0)
 W !,"ITEM: " S ITMP=$P(^RMPR(660,RP,0),U,6)
"RTN","RMPRSE2",55,0)
 W:ITMP'="" $E($P(^PRC(441,$P(^RMPR(661,ITMP,0),U,1),0),U,2),1,20)
"RTN","RMPRSE2",56,0)
 K ITMP
"RTN","RMPRSE2",57,0)
 I $P(^RMPR(660,RP,0),U,13)=4 D
"RTN","RMPRSE2",58,0)
 .W ?27,"QTY: ",$J($P(^RMPR(660,RP,0),U,7),4),?38,"TOTAL COST: ",$J($FN($P(^("LB"),U,9),"P",2),8) S QTYT=QTYT+$P(^(0),U,7),COSTT=COSTT+$P(^("LB"),U,9)
"RTN","RMPRSE2",59,0)
 I $P(^RMPR(660,RP,0),U,13)'=4 W ?27,"QTY: ",$J($P(^RMPR(660,RP,0),U,7),4),?38,"TOTAL COST: ",$J($FN($P(^(0),U,16),"P",2),8) S QTYT=QTYT+$P(^(0),U,7),COSTT=COSTT+$P(^(0),U,16)
"RTN","RMPRSE2",60,0)
 W ?60,$S($P(^RMPR(660,RP,0),U,4)="I":"INITIAL ISSUE",$P(^(0),U,4)="R":"REPLACEMENT",$P(^(0),U,4)="S":"SPARE",$P(^(0),U,4)="X":"REPAIR",1:"UNK"),!,"INITIATOR: " I $P(^(0),U,27),$D(^VA(200,$P(^(0),U,27),0)) W ?15,$P(^(0),U),!
"RTN","RMPRSE2",61,0)
 I $E(IOST)["C"&($Y>(IOSL-6)) S DIR(0)="E" D ^DIR S:Y<1 KILL=1 Q:Y<1  K DIR W @IOF D HEAD Q
"RTN","RMPRSE2",62,0)
 I $Y>(IOSL-6) W @IOF D HEAD
"RTN","RMPRSE2",63,0)
 Q
"RTN","RMPRSE2",64,0)
 ;
"RTN","RMPRSE2",65,0)
HEAD I $Y<2!(PAGE=1) D
"RTN","RMPRSE2",66,0)
 .W !,"HCPCS HISTORY:",?15
"RTN","RMPRSE2",67,0)
 .W $E($P(^ICPT($P(^RMPR(660,RP,0),U,22),0),U,1),1,39)
"RTN","RMPRSE2",68,0)
 .W ?63,"STA ",$$STA^RMPRUTIL,?72,"PAGE ",PAGE S PAGE=PAGE+1
"RTN","RMPRSE2",69,0)
 .W !!,"REQUEST DATE",?15,"PATIENT NAME",?30,"SSN",?36,"VENDOR"
"RTN","RMPRSE2",70,0)
 .S Y=RMPRBDT D DD^%DT W ?55,Y,"-" S Y=RMPREDT D DD^%DT W Y
"RTN","RMPRSE2",71,0)
 .W ! F BH=1:1:IOM W "="
"RTN","RMPRSE2",72,0)
 Q
"RTN","RMPRSE2",73,0)
 ;
"RTN","RMPRSE2",74,0)
REST D:'RMPRCOUN NONE Q:$D(KILL)!('RMPRCOUN)  W !,"TOTAL DOLLARS SPENT ON THIS HCPCS: ","$"_$J($FN(COSTT,"P",2),9),?45,"TOTAL QUANTITY ISSUED: ",$J(QTYT,4)
"RTN","RMPRSE2",75,0)
 I $O(RMPRARR(RQ)),$E(IOST)["C" W ! K DIR S DIR(0)="E" D ^DIR S:Y<1 KILL=1 W:'$D(KILL) @IOF
"RTN","RMPRSE2",76,0)
 I $E(IOST)'["C",$O(RMPRARR(RQ)) W @IOF
"RTN","RMPRSE2",77,0)
 S (COSTT,QTYT,RMPRCOUN)=""
"RTN","RMPRSE2",78,0)
 Q
"RTN","RMPRSE2",79,0)
 ;
"RTN","RMPRSE2",80,0)
NONE W @IOF,!!,"No '",$P(^ICPT(RMPRARR(RQ),0),U,1),"' HCPCS History for this date range.",!
"RTN","RMPRSE2",81,0)
 ;,$P(^PRC(441,$P(^RMPR(661,$P(RMPRARR(RQ),U),0),U),0),U,2)
"RTN","RMPRSE2",82,0)
 I $E(IOST)["C" K DIR S DIR(0)="E" W !!!! D ^DIR W @IOF S:Y<1 KILL=1 S ENDD=1
"RTN","RMPRSE2",83,0)
 Q
"RTN","RMPRSE2",84,0)
XREF ;set new x-ref for the field HCPCS in 660
"RTN","RMPRSE2",85,0)
 W !!,"New Cross Reference for HCPCS..."
"RTN","RMPRSE2",86,0)
 S DIK="^RMPR(660,",DIK(1)="4.1^G" D ENALL^DIK
"RTN","RMPRSE2",87,0)
 Q
"RTN","RMPRSE2",88,0)
 ;END
"RTN","RMPRSE21")
0^17^B24703368
"RTN","RMPRSE21",1,0)
RMPRSE21 ;HINES CIOFO/HNB -SEARCH FILE 660 ENTRIES PSAS HCPCS HISTORY ;1/23/1998
"RTN","RMPRSE21",2,0)
 ;;3.0;PROSTHETICS;**36,62,77**;Feb 09, 1996
"RTN","RMPRSE21",3,0)
 ; RVD patch #62 - add ICD9 code and Description in the output.
"RTN","RMPRSE21",4,0)
 ; RVD patch #77 3/17/03 - use RMPR("STA") instead of $$STA^RMPRUTIL.
"RTN","RMPRSE21",5,0)
 ;
"RTN","RMPRSE21",6,0)
EN S (ITEM,RMPRARR,RMPRI)=""
"RTN","RMPRSE21",7,0)
 K KILL
"RTN","RMPRSE21",8,0)
 D HOME^%ZIS,DIV4^RMPRSIT G:$D(X) EXIT1
"RTN","RMPRSE21",9,0)
 W !!!
"RTN","RMPRSE21",10,0)
 S DIC="^RMPR(661.1,",DIC(0)="AEQM"
"RTN","RMPRSE21",11,0)
 F ITEM=1:1 S DIC("A")="Select PSAS HCPCS ("_ITEM_"): " D ^DIC G:$D(DTOUT)!(X["^")!(X=""&(ITEM=1)) EXIT1 Q:X=""  D
"RTN","RMPRSE21",12,0)
 .I $D(RMPRI(+Y)) W !,$C(7)," ??",?40,"..Duplicate PSAS HCPCS" S ITEM=ITEM-1 Q
"RTN","RMPRSE21",13,0)
 .S RMPRARR(ITEM)=+Y,RMPRI(+Y)=""
"RTN","RMPRSE21",14,0)
 S RMPRCOUN=0 W !! S %DT("A")="Beginning Date: ",%DT="AEPX",%DT("B")="T-30" D ^%DT S RMPRBDT=Y G:Y<0 EXIT1
"RTN","RMPRSE21",15,0)
ENDATE S %DT("A")="Ending Date: ",%DT="AEX",%DT("B")="TODAY"
"RTN","RMPRSE21",16,0)
 D ^%DT G:Y<0 EXIT1
"RTN","RMPRSE21",17,0)
 I RMPRBDT>Y W !,$C(7),"Invalid Date Range Selection!!" G ENDATE
"RTN","RMPRSE21",18,0)
 G:Y<0 EXIT
"RTN","RMPRSE21",19,0)
 S RMPREDT=Y,Y=RMPRBDT D DD^%DT S RMPRX=Y,Y=RMPREDT D DD^%DT S RMPRY=Y
"RTN","RMPRSE21",20,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT
"RTN","RMPRSE21",21,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPRSE21",22,0)
 K IO("Q") S ZTDESC="SEARCH FOR PSAS HCPCS",ZTRTN="PRINT^RMPRSE21",ZTIO=ION,ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPRI(")="",ZTSAVE("RMPRX")="",ZTSAVE("RMPRY")="",ZTSAVE("RMPR(""STA"")")="",ZTSAVE("RMPRARR(")=""
"RTN","RMPRSE21",23,0)
 S ZTSAVE("RMPR(")="",ZTSAVE("RMPRSITE")=""
"RTN","RMPRSE21",24,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT1
"RTN","RMPRSE21",25,0)
PRINT ;ENTRY POINT FOR PRINTING REPORT
"RTN","RMPRSE21",26,0)
 S PAGE=1,(RMPRCOUN,RP,QTYT,COSTT)=0
"RTN","RMPRSE21",27,0)
 S RQ=0
"RTN","RMPRSE21",28,0)
 F  S RQ=$O(RMPRARR(RQ)) Q:RQ'>0!($D(KILL))  D  D REST
"RTN","RMPRSE21",29,0)
 .S RO=$P(RMPRARR(RQ),U,1),RO=RO-1
"RTN","RMPRSE21",30,0)
 .F  S RO=$O(^RMPR(660,"H",RO)) Q:RO'>0  D
"RTN","RMPRSE21",31,0)
 . .Q:RO=""!(RO'=$P(RMPRARR(RQ),U))!($D(KILL))
"RTN","RMPRSE21",32,0)
 . .K ENDD
"RTN","RMPRSE21",33,0)
 . .F  S RP=$O(^RMPR(660,"H",RO,RP)) Q:RP=""!($D(KILL))  D CK
"RTN","RMPRSE21",34,0)
 G EXIT
"RTN","RMPRSE21",35,0)
 Q
"RTN","RMPRSE21",36,0)
EXIT ;EXIT FROM REPORT HERE
"RTN","RMPRSE21",37,0)
 I RMPRCOUN>0,$D(RMPREDT),'$D(KILL) W !!?32,"END OF REPORT"
"RTN","RMPRSE21",38,0)
 I $E(IOST)["C"&($Y<22),'$D(ENDD) F  W ! Q:$Y>20
"RTN","RMPRSE21",39,0)
 I $D(RMPREDT),$E(IOST)["C",'$D(RMPRFLL),'$D(KILL),'$D(DUOUT),'$D(DTOUT),'$D(ENDD) K DIR S DIR(0)="E" D ^DIR
"RTN","RMPRSE21",40,0)
EXIT1 K RMPRARR,%DT,GOTO,QTYT,ITEM,KILL,ENDD,RQ,RP,RO,ITEM,RMPRI,COSTT,DIC,DIR,PAGE,RO,RMPRCOUN,RMPRSE,RMPRBDT,RMPREDT,RMPRX,RMPRY D ^%ZISC
"RTN","RMPRSE21",41,0)
 Q
"RTN","RMPRSE21",42,0)
CK Q:'$D(^RMPR(660,RP,0))
"RTN","RMPRSE21",43,0)
 ;hcpcs
"RTN","RMPRSE21",44,0)
 I ('$P(^RMPR(660,RP,1),U,4))!($P(^(0),U,3)<RMPRBDT)!($P(^(0),U,3)>RMPREDT)  Q
"RTN","RMPRSE21",45,0)
 I $P(^RMPR(660,RP,0),U,10)'=RMPR("STA") Q
"RTN","RMPRSE21",46,0)
 ;
"RTN","RMPRSE21",47,0)
 I $P(RMPRARR(RQ),U,1)=$P(^RMPR(660,RP,1),U,4) D CON
"RTN","RMPRSE21",48,0)
 Q
"RTN","RMPRSE21",49,0)
 ;
"RTN","RMPRSE21",50,0)
CON I $Y>(IOSL-6),PAGE=1,'RMPRCOUN W @IOF
"RTN","RMPRSE21",51,0)
 D HEAD S RMPRCOUN=RMPRCOUN+1
"RTN","RMPRSE21",52,0)
 S Y=$P(^RMPR(660,RP,0),U,3) D DD^%DT
"RTN","RMPRSE21",53,0)
 W !,Y,?15,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,1),1,13),?30,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,9),6,9)
"RTN","RMPRSE21",54,0)
 W:$P(^RMPR(660,RP,0),U,9)'="" ?36,$E($P(^PRC(440,$P(^RMPR(660,RP,0),U,9),0),U,1),1,35)
"RTN","RMPRSE21",55,0)
 W !,"ITEM: " S ITMP=$P(^RMPR(660,RP,0),U,6)
"RTN","RMPRSE21",56,0)
 W:ITMP'="" $E($P(^PRC(441,$P(^RMPR(661,ITMP,0),U,1),0),U,2),1,20)
"RTN","RMPRSE21",57,0)
 K ITMP
"RTN","RMPRSE21",58,0)
 I $P(^RMPR(660,RP,0),U,13)=4 D
"RTN","RMPRSE21",59,0)
 .W ?27,"QTY: ",$J($P(^RMPR(660,RP,0),U,7),4),?38,"TOTAL COST: ",$J($FN($P(^("LB"),U,9),"P",2),8) S QTYT=QTYT+$P(^(0),U,7),COSTT=COSTT+$P(^("LB"),U,9)
"RTN","RMPRSE21",60,0)
 I $P(^RMPR(660,RP,0),U,13)'=4 W ?27,"QTY: ",$J($P(^RMPR(660,RP,0),U,7),4),?38,"TOTAL COST: ",$J($FN($P(^(0),U,16),"P",2),8) S QTYT=QTYT+$P(^(0),U,7),COSTT=COSTT+$P(^(0),U,16)
"RTN","RMPRSE21",61,0)
 W ?60,$S($P(^RMPR(660,RP,0),U,4)="I":"INITIAL ISSUE",$P(^(0),U,4)="R":"REPLACEMENT",$P(^(0),U,4)="S":"SPARE",$P(^(0),U,4)="X":"REPAIR",1:"UNK"),!,"INITIATOR: " I $P(^(0),U,27),$D(^VA(200,$P(^(0),U,27),0)) W ?15,$P(^(0),U)
"RTN","RMPRSE21",62,0)
 S (RMPRICC,RMPRICD)=""
"RTN","RMPRSE21",63,0)
 I $D(^RMPR(660,RP,10)) S RMPRIC9=$P(^RMPR(660,RP,10),U,8)
"RTN","RMPRSE21",64,0)
 I $G(RMPRIC9),$D(^ICD9(RMPRIC9,0)) S RMPRICC=$P(^ICD9(RMPRIC9,0),U,1),RMPRICD=$G(^ICD9(RMPRIC9,1))
"RTN","RMPRSE21",65,0)
 W !,"ICD9 Code: ",RMPRICC,?24,$E(RMPRICD,1,55),!
"RTN","RMPRSE21",66,0)
 I $E(IOST)["C"&($Y>(IOSL-6)) S DIR(0)="E" D ^DIR S:Y<1 KILL=1 Q:Y<1  K DIR W @IOF D HEAD Q
"RTN","RMPRSE21",67,0)
 I $Y>(IOSL-6) W @IOF D HEAD
"RTN","RMPRSE21",68,0)
 Q
"RTN","RMPRSE21",69,0)
 ;
"RTN","RMPRSE21",70,0)
HEAD I $Y<2!(PAGE=1) D
"RTN","RMPRSE21",71,0)
 .W !,"PSAS HCPCS HISTORY:",?15
"RTN","RMPRSE21",72,0)
 .W $E($P(^RMPR(661.1,$P(^RMPR(660,RP,1),U,4),0),U,1),1,39)
"RTN","RMPRSE21",73,0)
 .W ?63,"STA ",RMPR("STA"),?72,"PAGE ",PAGE S PAGE=PAGE+1
"RTN","RMPRSE21",74,0)
 .W !!,"REQUEST DATE",?15,"PATIENT NAME",?30,"SSN",?36,"VENDOR"
"RTN","RMPRSE21",75,0)
 .S Y=RMPRBDT D DD^%DT W ?55,Y,"-" S Y=RMPREDT D DD^%DT W Y
"RTN","RMPRSE21",76,0)
 .W ! F BH=1:1:IOM W "="
"RTN","RMPRSE21",77,0)
 Q
"RTN","RMPRSE21",78,0)
 ;
"RTN","RMPRSE21",79,0)
REST D:'RMPRCOUN NONE Q:$D(KILL)!('RMPRCOUN)  W !,"TOTAL DOLLARS SPENT ON THIS HCPCS: ","$"_$J($FN(COSTT,"P",2),9),?45,"TOTAL QUANTITY ISSUED: ",$J(QTYT,4)
"RTN","RMPRSE21",80,0)
 I $O(RMPRARR(RQ)),$E(IOST)["C" W ! K DIR S DIR(0)="E" D ^DIR S:Y<1 KILL=1 W:'$D(KILL) @IOF
"RTN","RMPRSE21",81,0)
 I $E(IOST)'["C",$O(RMPRARR(RQ)) W @IOF
"RTN","RMPRSE21",82,0)
 S (COSTT,QTYT,RMPRCOUN)=""
"RTN","RMPRSE21",83,0)
 Q
"RTN","RMPRSE21",84,0)
 ;
"RTN","RMPRSE21",85,0)
NONE W @IOF,!!,"No '",$P(^RMPR(661.1,RMPRARR(RQ),0),U,1),"' PSAS HCPCS History for this date range.",!
"RTN","RMPRSE21",86,0)
 ;,$P(^PRC(441,$P(^RMPR(661,$P(RMPRARR(RQ),U),0),U),0),U,2)
"RTN","RMPRSE21",87,0)
 I $E(IOST)["C" K DIR S DIR(0)="E" W !!!! D ^DIR W @IOF S:Y<1 KILL=1 S ENDD=1
"RTN","RMPRSE21",88,0)
 Q
"RTN","RMPRSE21",89,0)
XREF ;set new x-ref for the field HCPCS in 660
"RTN","RMPRSE21",90,0)
 ;fix HCPCS VA117, REMOVE BLANK SPACE IN R90
"RTN","RMPRSE21",91,0)
 S $P(^RMPR(661.1,2801,0),U,6)="R90"
"RTN","RMPRSE21",92,0)
 W !!,"New Cross Reference for HCPCS..."
"RTN","RMPRSE21",93,0)
 S DIK="^RMPR(660,",DIK(1)="4.5^H" D ENALL^DIK
"RTN","RMPRSE21",94,0)
 W !!,"Done"
"RTN","RMPRSE21",95,0)
 Q
"RTN","RMPRSE21",96,0)
 ;END
"RTN","RMPRSEA")
0^18^B26133076
"RTN","RMPRSEA",1,0)
RMPRSEA ;PHX/RFM-SEARCH FILE 660 ENTRIES FOR RECALLED ITEM ;8/29/1994
"RTN","RMPRSEA",2,0)
 ;;3.0;PROSTHETICS;**77**;Feb 09, 1996
"RTN","RMPRSEA",3,0)
 ;RVD 3/17/03 patch #77 - allow queing to p-message.  IO to ION
"RTN","RMPRSEA",4,0)
 D HOME^%ZIS,DIV4^RMPRSIT G:$D(X) EXIT S RMPRCOUN=0,RMPREND="" W !! S %DT("A")="Beginning Date: ",%DT="AEPX" D ^%DT S RMPRBDT=Y G:Y<0 EXIT
"RTN","RMPRSEA",5,0)
ENDATE S %DT("A")="Ending Date: ",%DT="AEX" D ^%DT G:Y<0 EXIT I RMPRBDT>Y W !,$C(7),"Invalid Date Range Selection!!" G ENDATE
"RTN","RMPRSEA",6,0)
 G:Y<0 EXIT S RMPREDT=Y,Y=RMPRBDT D DD^%DT S RMPRX=Y,Y=RMPREDT D DD^%DT S RMPRY=Y
"RTN","RMPRSEA",7,0)
 K DIR S DIR(0)="S^1:Search by Serial Number or Lot Number;2:Search by Item;" D ^DIR G:$D(DIRUT) EXIT S GOTO=$S(Y=1:"SERIAL",Y=2:"ITEM") D @GOTO G:$D(DIRUT) EXIT1
"RTN","RMPRSEA",8,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT
"RTN","RMPRSEA",9,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPRSEA",10,0)
 S ZTDESC="SEARCH FOR RECALLED ITEM",ZTRTN="PRINT^RMPRSEA",ZTIO=ION,ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPRSE")="",ZTSAVE("RMPRX")="",ZTSAVE("RMPRY")="",ZTSAVE("GOTO")="",ZTSAVE("RMPR(""STA"")")=""
"RTN","RMPRSEA",11,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT
"RTN","RMPRSEA",12,0)
PRINT S X1=RMPRBDT,X2=-1 D C^%DTC S RO=X,RP=0,PAGE=1,RMPRCOUN=0,RMPREND="" I $E(IOST)["C" D WAIT^DICD
"RTN","RMPRSEA",13,0)
PRI F J=0:0 S RO=$O(^RMPR(660,"B",RO)) Q:RO'>0!(RO>RMPREDT)  Q:RMPREND=1  F K=0:0 S RP=$O(^RMPR(660,"B",RO,RP)) Q:RP'>0  Q:RMPREND=1  D CK G:$D(DUOUT) EXIT
"RTN","RMPRSEA",14,0)
 I $D(RMPREDT),'POP,'RMPRCOUN W @IOF D HEAD W $C(7),!!,"NO SELECTIONS MADE DURING THIS DATE RANGE!!"
"RTN","RMPRSEA",15,0)
 I RMPRCOUN,$D(RMPREDT),RMPREND'=1 W !!?32,"END OF REPORT"
"RTN","RMPRSEA",16,0)
EXIT I IOST["C-"&($Y<22) F  W ! Q:$Y>20
"RTN","RMPRSEA",17,0)
 I $D(RMPREDT),IOST["C-",'$D(RMPRFLL),RMPREND'=1,'$D(DUOUT),'$D(DTOUT) K DIR S DIR(0)="E" D ^DIR
"RTN","RMPRSEA",18,0)
EXIT1 K GOTO,DIC,DIR,DIRUT,DTOUT,DUOUT,RMPREND,PAGE,RMPRFLL,RAUT,RPAT,LI,RO,RMPRCOUN,RMPRSE,RMPRBDT,RMPREDT,RMPRX,RMPRY,RP,Y,K,X,J D ^%ZISC
"RTN","RMPRSEA",19,0)
 Q
"RTN","RMPRSEA",20,0)
CK Q:'$D(^RMPR(660,RP,0))  Q:$P(^(0),U,4)="X"!('$P(^(0),U,6))  Q:'$D(^PRC(441,$P(^RMPR(661,+$P(^(0),U,6),0),U)))
"RTN","RMPRSEA",21,0)
 I GOTO["SERIAL",$P(^RMPR(660,RP,0),U,11)[RMPRSE!($P(^(0),U,24)[RMPRSE) D CON
"RTN","RMPRSEA",22,0)
 I GOTO["ITEM",RMPRSE=$P(^PRC(441,$P(^RMPR(661,$P(^RMPR(660,RP,0),U,6),0),U),0),U) D CON
"RTN","RMPRSEA",23,0)
 Q
"RTN","RMPRSEA",24,0)
CON I $Y>(IOSL-6),PAGE=1,'RMPRCOUN W @IOF
"RTN","RMPRSEA",25,0)
 D HEAD S RMPRCOUN=RMPRCOUN+1
"RTN","RMPRSEA",26,0)
 S Y=$P(^RMPR(660,RP,0),U,3) D DD^%DT W !,Y,?15,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,1),1,13),?30,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,9),6,9),?36,$E($P(^PRC(441,$P(^RMPR(661,$P(^RMPR(660,RP,0),U,6),0),U,1),0),U,2),1,17)
"RTN","RMPRSEA",27,0)
 W:$P(^RMPR(660,RP,0),U,9)'="" ?55,$E($P(^PRC(440,$P(^RMPR(660,RP,0),U,9),0),U,1),1,25)
"RTN","RMPRSEA",28,0)
 W !,"LOT NBR:",?10,$P(^RMPR(660,RP,0),U,24),?25,"SERIAL NBR:",?37,$P(^RMPR(660,RP,0),U,11),!
"RTN","RMPRSEA",29,0)
 I IOST["C-"&($Y>(IOSL-6)) S DUOUT=1,DIR(0)="E" D ^DIR S:Y="" RMPREND=1 Q:Y=""  S:Y<1 RMPRFLL=1 Q:Y<1  K DIR W @IOF D HEAD Q
"RTN","RMPRSEA",30,0)
 I $Y>(IOSL-6) W @IOF D HEAD
"RTN","RMPRSEA",31,0)
 Q
"RTN","RMPRSEA",32,0)
HEAD I $Y<2 W !,?10,"RECALLED ITEM REPORT" S Y=RMPRBDT D DD^%DT W ?39,Y_"-" S Y=RMPREDT D DD^%DT W Y_"  "_"STA ",$$STA^RMPRUTIL_"  "_"PAGE ",PAGE,!,"REQUEST DATE",?15,"PATIENT NAME",?30,"SSN",?36,"ITEM",?55,"VENDOR",! S PAGE=PAGE+1 Q
"RTN","RMPRSEA",33,0)
 Q
"RTN","RMPRSEA",34,0)
AUT ;AUTOMOTIVE EQUIPMENT SEARCH
"RTN","RMPRSEA",35,0)
 S RMPRCOUN=0,RMPREND="" W !! S %DT("A")="Beginning Date: ",%DT="AEPX" D ^%DT S RMPRBDT=Y G:Y<0 EXIT
"RTN","RMPRSEA",36,0)
 S %DT("A")="Ending Date: ",%DT="AEX" D ^%DT G:Y<0 EXIT I RMPRBDT>Y W !,$C(7),"Invalid Date Range Selection!!" G AUT
"RTN","RMPRSEA",37,0)
 G:Y<0 EXIT S RMPREDT=Y,Y=RMPREDT D DD^%DT S RMPRX=Y,Y=RMPREDT D DD^%DT S RMPRY=Y
"RTN","RMPRSEA",38,0)
 S DIR(0)="F^1:20^K:$E(X)="" "" X",DIR("A")="Enter Serial Number" D ^DIR G:$D(DIRUT) EXIT S RMPRSE=X K DIR
"RTN","RMPRSEA",39,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT
"RTN","RMPRSEA",40,0)
 I '$D(IO("Q")) U IO G PRINTA
"RTN","RMPRSEA",41,0)
 K IO("Q") S ZTDESC="SEARCH FOR RECALLED AUTO ITEM",ZTRTN="PRINTA^RMPRSEA",ZTIO=ION,ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPRSE")="",ZTSAVE("RMPRX")="",ZTSAVE("RMPRY")="" D ^%ZTLOAD G EXIT
"RTN","RMPRSEA",42,0)
PRINTA S X1=RMPRBDT,X2=-1 D C^%DTC S RO=X,RP=0,RMPRCOUN=0,PAGE=1,RMPREND="" D HDR
"RTN","RMPRSEA",43,0)
 F J=0:0 S RO=$O(^RMPR(667.3,"B",RO)) Q:RO'>0  Q:RO>RMPREDT  Q:RMPREND=1  F K=0:0 S RP=$O(^RMPR(667.3,"B",RO,RP)) Q:RP'>0  Q:RMPREND=1  D CK1 G:$D(DUOUT) EXIT
"RTN","RMPRSEA",44,0)
 I RMPRCOUN=0 W !!,"NO SELECTION MADE DURING THIS DATE RANGE!!"
"RTN","RMPRSEA",45,0)
 G EXIT
"RTN","RMPRSEA",46,0)
CK1 Q:'$D(^RMPR(667.3,RP,0))  G:$P(^RMPR(667.3,RP,0),U,6)[RMPRSE INF
"RTN","RMPRSEA",47,0)
 Q
"RTN","RMPRSEA",48,0)
INF S RMPRCOUN=RMPRCOUN+1,Y=$P(^RMPR(667.3,RP,0),U,1) S RAUT=^(0),RPAT=$P(^RMPR(667,$P(RAUT,U,2),0),U,2)
"RTN","RMPRSEA",49,0)
 D DD^%DT W !,Y,?15,$E($P(^DPT(RPAT,0),U,1),1,13),?30,$E($P(^DPT(RPAT,0),U,9),6,9),?36,$P(^RMPR(667.1,$P(RAUT,U,3),0),U,1)
"RTN","RMPRSEA",50,0)
 W !,"VEHICLE ID# ",$P(^RMPR(667,$P(RAUT,U,2),0),U,1),?50,"SERIAL # ",$P(RAUT,U,6) S $P(LI,"-",IOM)="" W !,LI
"RTN","RMPRSEA",51,0)
 I IOST?1"C-".E&($Y>(IOSL-4)) S DUOUT=1,DIR(0)="E" D ^DIR S:Y<1 RMPREND=1 Q:Y=""  S:Y<1 RMPRFLL=1 Q:Y<1  K DIR D HDR Q
"RTN","RMPRSEA",52,0)
 I $Y'>(IOSL-4) Q
"RTN","RMPRSEA",53,0)
HDR W @IOF,!,"REQUEST DATE",?15,"PATIENT NAME",?30,"SSN",?36,"ITEM",?70,"PAGE ",PAGE S $P(LI,"-",IOM)="",PAGE=PAGE+1 W !,LI
"RTN","RMPRSEA",54,0)
 Q
"RTN","RMPRSEA",55,0)
SERIAL S DIR(0)="F^1:20",DIR("A")="Enter Serial Number or Lot Number" D ^DIR Q:$D(DIRUT)  S RMPRSE=X K DIR
"RTN","RMPRSEA",56,0)
 Q
"RTN","RMPRSEA",57,0)
ITEM S DIC="^RMPR(661,",DIC(0)="AEQM",DIC("A")="Select ITEM: " D ^DIC I Y<0 S DIRUT=1 Q 
"RTN","RMPRSEA",58,0)
 S RMPRSE=$P(Y,U,2)
"RTN","RMPRSEA",59,0)
 Q
"RTN","RMPRSP")
0^19^B11838623
"RTN","RMPRSP",1,0)
RMPRSP ;HINES-IO/HNC-PRINT SUSPENSE RECORDS ;7/28/00
"RTN","RMPRSP",2,0)
 ;;3.0;PROSTHETICS;**45,55,77**;Feb 09, 1996
"RTN","RMPRSP",3,0)
 ;RVD 3/17/03 patch #77 - allow queing to p-message.  IO to ION
"RTN","RMPRSP",4,0)
 ;
"RTN","RMPRSP",5,0)
 ;station from CPRS may not be the same as site params, can not filter
"RTN","RMPRSP",6,0)
 ;station is from duz(2), the division in file 200, or
"RTN","RMPRSP",7,0)
 ;default institution in kernel system parameters file 8989.3.
"RTN","RMPRSP",8,0)
 ;
"RTN","RMPRSP",9,0)
EN ;main entry point
"RTN","RMPRSP",10,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT
"RTN","RMPRSP",11,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPRSP",12,0)
 K IO("Q") S ZTDESC="PRINT OPEN PENDING SUSPENSE RECORDS",ZTRTN="PRINT^RMPRSP",ZTIO=ION
"RTN","RMPRSP",13,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT
"RTN","RMPRSP",14,0)
 ;
"RTN","RMPRSP",15,0)
PRINT ;print
"RTN","RMPRSP",16,0)
 W:$E(IOST)["C" @IOF
"RTN","RMPRSP",17,0)
 I '$D(IO("Q")) U IO
"RTN","RMPRSP",18,0)
 ;
"RTN","RMPRSP",19,0)
MAIN ;main sort logic
"RTN","RMPRSP",20,0)
 ;VARIABLES SET:      ST - STATUS
"RTN","RMPRSP",21,0)
 ;                    RO - ENTRY NUMBER IN SUSPENSE
"RTN","RMPRSP",22,0)
 ;
"RTN","RMPRSP",23,0)
 K RMPREND,^TMP($J)
"RTN","RMPRSP",24,0)
 S RMPRPAGE=1 D HEADER1
"RTN","RMPRSP",25,0)
 ;
"RTN","RMPRSP",26,0)
 S ST="C"
"RTN","RMPRSP",27,0)
 F  S ST=$O(^RMPR(668,"E",ST)) Q:ST=""  Q:ST="X"  D
"RTN","RMPRSP",28,0)
 .S RO=0
"RTN","RMPRSP",29,0)
 .F  S RO=$O(^RMPR(668,"E",ST,RO)) Q:RO'>0  D
"RTN","RMPRSP",30,0)
 . .Q:$P(^RMPR(668,RO,0),U,10)="X"
"RTN","RMPRSP",31,0)
 . .Q:$P(^RMPR(668,RO,0),U,10)="C"
"RTN","RMPRSP",32,0)
 . .S DATE=$P($P(^RMPR(668,RO,0),U,1),".",1)
"RTN","RMPRSP",33,0)
 . .S DFN=$P(^RMPR(668,RO,0),U,2) Q:DFN=""
"RTN","RMPRSP",34,0)
 . .D DEM^VADPT
"RTN","RMPRSP",35,0)
 . .S ^TMP($J,DATE,VADM(1),RO)=""
"RTN","RMPRSP",36,0)
 . .K DFN
"RTN","RMPRSP",37,0)
 ;end sort
"RTN","RMPRSP",38,0)
 ;
"RTN","RMPRSP",39,0)
 I '$D(^TMP($J)) W !,"No Open/Pending Suspense Records",! G EXIT
"RTN","RMPRSP",40,0)
 ;
"RTN","RMPRSP",41,0)
 S DATE=0
"RTN","RMPRSP",42,0)
 F  S DATE=$O(^TMP($J,DATE)) Q:DATE'>0  Q:$D(RMPREND)  D
"RTN","RMPRSP",43,0)
 .S NAME=""
"RTN","RMPRSP",44,0)
 .F  S NAME=$O(^TMP($J,DATE,NAME)) Q:NAME=""  Q:$D(RMPREND)  D
"RTN","RMPRSP",45,0)
 . .S RO=0
"RTN","RMPRSP",46,0)
 . .F  S RO=$O(^TMP($J,DATE,NAME,RO)) Q:RO=""  Q:$D(RMPREND)  D
"RTN","RMPRSP",47,0)
 . . .K VADM S DFN=$P(^RMPR(668,RO,0),U,2) D DEM^VADPT
"RTN","RMPRSP",48,0)
 . . .I $Y>(IOSL-6),$E(IOST)["C",$G(RMPRFL)'="" D HEADER Q:$D(RMPREND)
"RTN","RMPRSP",49,0)
 . . .D DISPLAY
"RTN","RMPRSP",50,0)
 . . .W !,$$REPEAT^XLFSTR("-",79)
"RTN","RMPRSP",51,0)
 D EXIT
"RTN","RMPRSP",52,0)
 Q
"RTN","RMPRSP",53,0)
 ;
"RTN","RMPRSP",54,0)
DISPLAY ;display record
"RTN","RMPRSP",55,0)
 W !,$$DAT1^RMPRUTL1(DATE)
"RTN","RMPRSP",56,0)
 W ?10,$E(VADM(1),0,18)
"RTN","RMPRSP",57,0)
 W ?28,$P($P(VADM(2),U,2),"-",3)
"RTN","RMPRSP",58,0)
 W ?34,$$STATUS^RMPREOU(RO,4)," "
"RTN","RMPRSP",59,0)
 S WRKDAY=$$CWRKDAY^RMPREOU(RO) W WRKDAY
"RTN","RMPRSP",60,0)
 W ?44,$$TYPE^RMPREOU(RO,8)
"RTN","RMPRSP",61,0)
 I $P(^RMPR(668,RO,0),U,7)'="" W ?59,$P(^DIC(4,$P(^RMPR(668,RO,0),U,7),0),U,1)
"RTN","RMPRSP",62,0)
 W !,$$DES^RMPREOU(RO,79)
"RTN","RMPRSP",63,0)
 S INIA=$P(^RMPR(668,RO,0),U,9),INIDAY=$$WRKDAY^RMPREOU(RO)
"RTN","RMPRSP",64,0)
 I INIA'="" W !,"**Initial Action Date: ",$$DAT1^RMPRUTL1(INIA),"   (",INIDAY," Working Days)"
"RTN","RMPRSP",65,0)
 ;then display the number of working days to init action.
"RTN","RMPRSP",66,0)
 I  S INIAN=0 D
"RTN","RMPRSP",67,0)
 .F  S INIAN=$O(^RMPR(668,RO,3,INIAN)) Q:INIAN=""  D
"RTN","RMPRSP",68,0)
 . .W !,^RMPR(668,RO,3,INIAN,0)
"RTN","RMPRSP",69,0)
 S ODAT=0
"RTN","RMPRSP",70,0)
 F  S ODAT=$O(^RMPR(668,RO,1,ODAT)) Q:ODAT'>0  D
"RTN","RMPRSP",71,0)
 .S ODAT1=$P(^RMPR(668,RO,1,ODAT,0),U,1)
"RTN","RMPRSP",72,0)
 .W !,"**Other Action Date: ",$$DAT1^RMPRUTL1(ODAT1)
"RTN","RMPRSP",73,0)
 .S ODATN=0
"RTN","RMPRSP",74,0)
 .F  S ODATN=$O(^RMPR(668,RO,1,ODAT,1,ODATN)) Q:ODATN=""  D
"RTN","RMPRSP",75,0)
 . .W !,^RMPR(668,RO,1,ODAT,1,ODATN,0)
"RTN","RMPRSP",76,0)
 K INIAN,ODATN,ODAT,ODAT1
"RTN","RMPRSP",77,0)
 Q
"RTN","RMPRSP",78,0)
 ;
"RTN","RMPRSP",79,0)
HEADER W ! S DIR(0)="E" D ^DIR K DIR S:Y<1 RMPREND=1 Q:Y=""!(Y=0)  W @IOF
"RTN","RMPRSP",80,0)
 ;
"RTN","RMPRSP",81,0)
HEADER1 ;main header
"RTN","RMPRSP",82,0)
 Q:$D(RMPREND)  S RMPRFL=1
"RTN","RMPRSP",83,0)
 W !,"Prosthetics Open/Pending Suspense File List   "
"RTN","RMPRSP",84,0)
 N X,Y,% D NOW^%DTC S Y=% D DD^%DT S Y=$TR(Y,"@"," ") W $P(Y,":",1,2)
"RTN","RMPRSP",85,0)
 ;W ?70,"STA ",$$STA^RMPRUTIL
"RTN","RMPRSP",86,0)
 W !,"DATE",?10,"PATIENT",?28,"SSN",?34,"STATUS",?44,"TYPE",?59,"STATION",?73,"PAGE ",RMPRPAGE
"RTN","RMPRSP",87,0)
 W !,$$REPEAT^XLFSTR("-",79) S RMPRPAGE=RMPRPAGE+1 I $D(RMPRFLG) W !,"CON'T" K RMPRFLG
"RTN","RMPRSP",88,0)
 Q
"RTN","RMPRSP",89,0)
 ;
"RTN","RMPRSP",90,0)
EXIT K ^TMP($J) D ^%ZISC,KILL^XUSCLEAN
"RTN","RMPRSP",91,0)
 Q
"RTN","RMPRSP",92,0)
 ;end
"RTN","RMPRSP1")
0^31^B15219488
"RTN","RMPRSP1",1,0)
RMPRSP1 ;PHX/RFM/HPL/HNC-PRINT 5 DAY OLD SUSPENSE RECORDS ;8/29/1994
"RTN","RMPRSP1",2,0)
 ;;3.0;PROSTHETICS;**45,52,77**;Feb 09, 1996
"RTN","RMPRSP1",3,0)
 ;
"RTN","RMPRSP1",4,0)
 ; ODJ - patch 52 - 10/18/00 - fix undefined text line at EXT
"RTN","RMPRSP1",5,0)
 ;RVD patch #77 - change IO to ION
"RTN","RMPRSP1",6,0)
 ;
"RTN","RMPRSP1",7,0)
 D DIV4^RMPRSIT G:$D(X) EXIT1 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT1
"RTN","RMPRSP1",8,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPRSP1",9,0)
 K IO("Q") S ZTDESC="PRINT 5 DAY OLD SUSPENSE RECORDS",ZTRTN="PRINT^RMPRSP1",ZTIO=ION,ZTSAVE("RMPR(""STA"")")="",ZTSAVE("RMPRSITE")=""
"RTN","RMPRSP1",10,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT1
"RTN","RMPRSP1",11,0)
PRINT W:$E(IOST)["C-" @IOF S RMPRPAGE=1 F I=1:1:11 S FOT(I)=0,TOT=0
"RTN","RMPRSP1",12,0)
C S RMPREDT=$$FMADD^XLFDT(DT,-7),RO=0,RB=$$FMADD^XLFDT(DT,-90) F  S RB=$O(^RMPR(668,"B",RB)) Q:RB>RMPREDT!(RB'>0)  F  S RO=$O(^RMPR(668,"B",RB,RO)) Q:RO=""  D CK
"RTN","RMPRSP1",13,0)
 G WRI
"RTN","RMPRSP1",14,0)
CK Q:'$D(^RMPR(668,RO,0))
"RTN","RMPRSP1",15,0)
 Q:$P(^RMPR(668,RO,0),U,10)'="O"
"RTN","RMPRSP1",16,0)
 Q:$P(^RMPR(668,RO,0),U,9)>0!($P(^(0),U)'>0)!($P(^(0),U,3)'>0)!('+$P(^(0),U,2))
"RTN","RMPRSP1",17,0)
 Q:$P(^RMPR(668,RO,0),U,7)'=RMPR("STA")
"RTN","RMPRSP1",18,0)
 S ^TMP($J,$P(^RMPR(668,RO,0),U),$P(^DPT($P(^RMPR(668,RO,0),U,2),0),U),$S($P(^(0),U,4)>0:$P(^(0),U,4),1:1),RO)=""
"RTN","RMPRSP1",19,0)
 Q
"RTN","RMPRSP1",20,0)
WRI ;
"RTN","RMPRSP1",21,0)
 N RP,RQ,RZ,RS
"RTN","RMPRSP1",22,0)
 S RP=0,RQ=0,RZ=0,RS=0
"RTN","RMPRSP1",23,0)
 F  S RP=$O(^TMP($J,RP)) Q:RP=""  F  S RQ=$O(^TMP($J,RP,RQ)) Q:RQ=""  F  S RS=$O(^TMP($J,RP,RQ,RS)) Q:RS=""  F  S RZ=$O(^TMP($J,RP,RQ,RS,RZ)) Q:RZ=""!($D(RMPREND))  D WRI2
"RTN","RMPRSP1",24,0)
 I $D(RMPREND) G EXIT1
"RTN","RMPRSP1",25,0)
 ;
"RTN","RMPRSP1",26,0)
 ;
"RTN","RMPRSP1",27,0)
 I '$D(^TMP($J)) D
"RTN","RMPRSP1",28,0)
 .  S Y=DT D DD^%DT W !,Y,?25,"OVER 5 DAY OLD SUSPENSE REPORT"
"RTN","RMPRSP1",29,0)
 .  W !!,"No open suspense records over 5 days!" S RMPREX=1
"RTN","RMPRSP1",30,0)
 I $D(RMPREX) K RMPREX G EXIT1
"RTN","RMPRSP1",31,0)
 ;
"RTN","RMPRSP1",32,0)
 W ! F I=1:1:79 W "-"
"RTN","RMPRSP1",33,0)
 W !,"PSC",?5,"2421",?11,"2237",?17,"2529-3",?25,"2529-7",?33,"2474",?39,"2431",?45,"2914",?51,"OTHER",?58,"2520",?64,"STK ISU",?74,"TOTAL"
"RTN","RMPRSP1",34,0)
 W !,$J(FOT(1),3),?5,$J(FOT(2),4),?11,$J(FOT(3),4),?17,$J(FOT(4),6),?25,$J(FOT(5),6),?33,$J(FOT(6),4),?39,$J(FOT(7),4),?45,$J(FOT(8),4),?51,$J(FOT(9),5),?58,$J(FOT(10),4),?64,$J(FOT(11),7)
"RTN","RMPRSP1",35,0)
 S RO=0
"RTN","RMPRSP1",36,0)
 F  S RO=$O(FOT(RO)) Q:RO=""  S TOT=TOT+FOT(RO)
"RTN","RMPRSP1",37,0)
 W ?74,$J(TOT,5)
"RTN","RMPRSP1",38,0)
 I $E(IOST)["C-" W ! K DIR S DIR(0)="E" D ^DIR
"RTN","RMPRSP1",39,0)
 ;
"RTN","RMPRSP1",40,0)
EXIT1 ;common exit
"RTN","RMPRSP1",41,0)
 K FO,I,TOT,FOT,RMPREDT,RMPRFLG,RMPRFL,RMPREND,RMPRPAGE,RMPRG,X,Y
"RTN","RMPRSP1",42,0)
 K RMPRFORM,DIR,RP,RS,RQ,RO,RB,RZ,RMPRFOR1,^TMP($J),RP,RR,RMPRFOR2
"RTN","RMPRSP1",43,0)
 D ^%ZISC
"RTN","RMPRSP1",44,0)
 Q
"RTN","RMPRSP1",45,0)
 ;
"RTN","RMPRSP1",46,0)
WRI2 I RMPRPAGE=1,'$D(RMPRFL) W:$Y>1 @IOF D HEADER1 Q:$D(RMPREND)
"RTN","RMPRSP1",47,0)
 I $Y>(IOSL-6),$E(IOST)["C-",$D(RMPRFL) D HEADER Q:$D(RMPREND)
"RTN","RMPRSP1",48,0)
 I $Y>(IOSL-6),$D(RMPRFL) W @IOF D HEADER1
"RTN","RMPRSP1",49,0)
WRI3 ;
"RTN","RMPRSP1",50,0)
 N DAT1
"RTN","RMPRSP1",51,0)
 S DAT1=$$DAT1^RMPRUTL1(RP)
"RTN","RMPRSP1",52,0)
 W !,DAT1,?13,$E($P(^DPT($P(^RMPR(668,RZ,0),U,2),0),U),1,20),?35,$E($P(^(0),U,9),6,9)
"RTN","RMPRSP1",53,0)
 D FORM
"RTN","RMPRSP1",54,0)
 W ?59,$S($D(^VA(200,+$P(^RMPR(668,RZ,0),U,4),0)):$E($P(^VA(200,$P(^RMPR(668,RZ,0),U,4),0),U),1,19),1:"NO NAME AVAILABLE")
"RTN","RMPRSP1",55,0)
 S RMPRFL=1
"RTN","RMPRSP1",56,0)
 Q:$D(RMPREND)
"RTN","RMPRSP1",57,0)
 D:$D(^RMPR(668,RZ,2,0)) EXT
"RTN","RMPRSP1",58,0)
 Q
"RTN","RMPRSP1",59,0)
HEADER ;
"RTN","RMPRSP1",60,0)
 W !
"RTN","RMPRSP1",61,0)
 S DIR(0)="E" D ^DIR K DIR
"RTN","RMPRSP1",62,0)
 I Y=""!(Y=0) S RMPREND=1 Q:Y=""!(Y=0)
"RTN","RMPRSP1",63,0)
 W @IOF
"RTN","RMPRSP1",64,0)
 ;
"RTN","RMPRSP1",65,0)
HEADER1 ;
"RTN","RMPRSP1",66,0)
 Q:$D(RMPREND)
"RTN","RMPRSP1",67,0)
 S RMPRFL=1
"RTN","RMPRSP1",68,0)
 W !,?23,"DELINQUENT OPEN SUSPENSE REPORT",?70,"STA ",$$STA^RMPRUTIL,!,?2,"DATE",?18,"PATIENT",?35,"SSN",?41,"FORM",?59,"SUSPENDED BY",?73,"PAGE ",RMPRPAGE,!
"RTN","RMPRSP1",69,0)
 S RMPRPAGE=RMPRPAGE+1
"RTN","RMPRSP1",70,0)
 I $D(RMPRFLG) W !,"CON'T" K RMPRFLG
"RTN","RMPRSP1",71,0)
 Q
"RTN","RMPRSP1",72,0)
 ;
"RTN","RMPRSP1",73,0)
EXT ;display only the first line of description
"RTN","RMPRSP1",74,0)
 ;modified in patch 52
"RTN","RMPRSP1",75,0)
 N RR
"RTN","RMPRSP1",76,0)
 S RR=$O(^RMPR(668,RZ,2,0))
"RTN","RMPRSP1",77,0)
 W:+RR !,$G(^RMPR(668,RZ,2,RR,0))
"RTN","RMPRSP1",78,0)
 ;display the entire description
"RTN","RMPRSP1",79,0)
 ;N RR
"RTN","RMPRSP1",80,0)
 ;S RR=0
"RTN","RMPRSP1",81,0)
 ;F  S RR=$O(^RMPR(668,RZ,2,RR)) W:RR="" ! Q:RR=""!($D(RMPREND))  D PEXT
"RTN","RMPRSP1",82,0)
 Q
"RTN","RMPRSP1",83,0)
 ;
"RTN","RMPRSP1",84,0)
PEXT ;
"RTN","RMPRSP1",85,0)
 ;I $Y>(IOSL-6),$E(IOST)["C",$D(RMPRFL) S RMPRFLG=1 D HEADER Q:$D(RMPREND)
"RTN","RMPRSP1",86,0)
 ;I $Y>(IOSL-6),$D(RMPRFL) W @IOF S RMPRFLG=1 D HEADER1
"RTN","RMPRSP1",87,0)
 ;W !,$P(^RMPR(668,RZ,2,RR,0),U)
"RTN","RMPRSP1",88,0)
 Q
"RTN","RMPRSP1",89,0)
 ;
"RTN","RMPRSP1",90,0)
FORM ;
"RTN","RMPRSP1",91,0)
 S FO=$P(^RMPR(668,RZ,0),U,3)
"RTN","RMPRSP1",92,0)
 W ?41,$S(FO=1:"PSC",FO=2:"2421",FO=3:"2237",FO=4:"2529-3",FO=5:"2529-7",FO=6:"2474",FO=7:"2431",FO=8:"2914",FO=9:"OTHER",FO=10:"2520",FO=11:"STOCK ISSUE",1:"UNK")
"RTN","RMPRSP1",93,0)
 S $P(FOT(FO),U)=$P(FOT(FO),U)+1
"RTN","RMPRSP1",94,0)
 Q
"RTN","RMPRSP2")
0^21^B29178919
"RTN","RMPRSP2",1,0)
RMPRSP2 ;PHX/RFM-PRINT SUSPENSE STATISTICS ;8/29/1994
"RTN","RMPRSP2",2,0)
 ;;3.0;PROSTHETICS;**45,52,77**;Feb 09, 1996
"RTN","RMPRSP2",3,0)
 ;
"RTN","RMPRSP2",4,0)
 ; ODJ - patch 52 - ensure report does not include records prior to
"RTN","RMPRSP2",5,0)
 ;       10/05/00   today.
"RTN","RMPRSP2",6,0)
 ;
"RTN","RMPRSP2",7,0)
 ; ODJ - patch 52 - ensure cancelled records are excluded from stats.
"RTN","RMPRSP2",8,0)
 ;       10/05/00
"RTN","RMPRSP2",9,0)
 ; RVD 3/17/03 patch #77 - allow queing to p-message.  IO to ION
"RTN","RMPRSP2",10,0)
 ;
"RTN","RMPRSP2",11,0)
 K ^TMP($J)
"RTN","RMPRSP2",12,0)
 D DIV4^RMPRSIT G:$D(X) EXIT1 D HOME^%ZIS S %DT="AEX",%DT("A")="Starting Date: " D ^%DT G:Y<1 EXIT1 S RMPRBDT=Y
"RTN","RMPRSP2",13,0)
 S %DT(0)=Y,%DT("A")="Ending Date: " D ^%DT K %DT G:Y<1 EXIT1 S RMPREDT=Y
"RTN","RMPRSP2",14,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT1
"RTN","RMPRSP2",15,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPRSP2",16,0)
 K IO("Q") S ZTDESC="PROSTHETIC SUSPENSE STATISTICS",ZTRTN="PRINT^RMPRSP2",ZTIO=ION,ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPR(""STA"")")="",ZTSAVE("RMPRSITE")=""
"RTN","RMPRSP2",17,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT1
"RTN","RMPRSP2",18,0)
PRINT W:$E(IOST)["C" @IOF S RMPRPAGE=1 F I=1:1:11 S (CFOT(I),OFOT(I))=0
"RTN","RMPRSP2",19,0)
 S RB=RMPRBDT,(RO,OTOT,CTOT,ITOT,DELDAT,J1,ODELDAT)=0 ;patch 52
"RTN","RMPRSP2",20,0)
 S:$D(^RMPR(668,"B",RB)) RB=$O(^RMPR(668,"B",RB),-1) ;patch 52
"RTN","RMPRSP2",21,0)
C F  S RB=$O(^RMPR(668,"B",RB)) Q:$P(RB,".",1)>RMPREDT!(RB'>0)  F  S RO=$O(^RMPR(668,"B",RB,RO)) Q:RO=""  D CK
"RTN","RMPRSP2",22,0)
 G WRI
"RTN","RMPRSP2",23,0)
CK Q:$P(RB,".",1)<RMPRBDT  ;patch 52
"RTN","RMPRSP2",24,0)
 Q:'$D(^RMPR(668,RO,0))  Q:$P(^(0),U,3)'>0!('+$P(^(0),U,2))  I RMPRSITE'=1,$P(^(0),U,7)'=RMPR("STA") Q
"RTN","RMPRSP2",25,0)
 I RMPRSITE=1,$P(^RMPR(668,RO,0),U,7)'="",$P(^(0),U,7)'=RMPR("STA") Q
"RTN","RMPRSP2",26,0)
 Q:$P(^RMPR(668,RO,0),U,10)="X"  ;patch 52
"RTN","RMPRSP2",27,0)
 S ^TMP($J,$P(^RMPR(668,RO,0),U),RO)=""
"RTN","RMPRSP2",28,0)
 Q
"RTN","RMPRSP2",29,0)
WRI ;
"RTN","RMPRSP2",30,0)
 S RP=0,RQ=0
"RTN","RMPRSP2",31,0)
 F  S RP=$O(^TMP($J,RP)) Q:RP=""  F  S RQ=$O(^TMP($J,RP,RQ)) Q:RQ=""  D CALC
"RTN","RMPRSP2",32,0)
 ;
"RTN","RMPRSP2",33,0)
 I '$D(^TMP($J)) D
"RTN","RMPRSP2",34,0)
 .  S Y=DT D DD^%DT W !,Y,?25,"PROSTHETICS SUSPENSE STATISTICS"_"     STA ",$$STA^RMPRUTIL
"RTN","RMPRSP2",35,0)
 .  W !!,"No statistics available for this period!" S RMPREX=1
"RTN","RMPRSP2",36,0)
 G:$D(RMPREX) EXIT1
"RTN","RMPRSP2",37,0)
LINE W !?15,"Prosthetics Suspense Statistics "
"RTN","RMPRSP2",38,0)
 N X,Y,% D NOW^%DTC S Y=% D DD^%DT S Y=$TR(Y,"@"," ") W $P(Y,":",1,2)
"RTN","RMPRSP2",39,0)
 W !?16,"For The Period "
"RTN","RMPRSP2",40,0)
 ;W !,"PROSTHETICS SUSPENSE STATISTICS FOR THE PERIOD "
"RTN","RMPRSP2",41,0)
 S Y=RMPRBDT D DD^%DT W Y S Y=RMPREDT D DD^%DT
"RTN","RMPRSP2",42,0)
 W "-"_Y_" STA "_$$STA^RMPRUTIL
"RTN","RMPRSP2",43,0)
 W !,"OPEN SUSPENSE RECORDS" S RX="O"
"RTN","RMPRSP2",44,0)
 W !,"PSC",?5,"2421",?11,"2237",?17,"2529-3",?25,"2529-7",?33,"2474",?39,"2431",?45,"2914",?51,"OTHER",?58,"2520",?64,"STK ISU"
"RTN","RMPRSP2",45,0)
 W !,$J(OFOT(1),3),?5,$J(OFOT(2),4),?11,$J(OFOT(3),4),?17,$J(OFOT(4),6),?25,$J(OFOT(5),6),?33,$J(OFOT(6),4),?39,$J(OFOT(7),4),?45,$J(OFOT(8),4),?51,$J(OFOT(9),5),?58,$J(OFOT(10),4),?64,$J(OFOT(11),7)
"RTN","RMPRSP2",46,0)
 ;init action is pending not open
"RTN","RMPRSP2",47,0)
 S RO=0 F  S RO=$O(OFOT(RO)) Q:RO=""  S OTOT=OTOT+OFOT(RO)
"RTN","RMPRSP2",48,0)
 ;
"RTN","RMPRSP2",49,0)
 W !!,"CLOSED SUSPENSE RECORDS"
"RTN","RMPRSP2",50,0)
 W !,"PSC",?5,"2421",?11,"2237",?17,"2529-3",?25,"2529-7"
"RTN","RMPRSP2",51,0)
 W ?33,"2474",?39,"2431",?45,"2914",?51,"OTHER",?58,"2520"
"RTN","RMPRSP2",52,0)
 W ?64,"STK ISU"
"RTN","RMPRSP2",53,0)
 W !,$J(CFOT(1),3),?5,$J(CFOT(2),4),?11,$J(CFOT(3),4),?17
"RTN","RMPRSP2",54,0)
 W $J(CFOT(4),6),?25,$J(CFOT(5),6),?33,$J(CFOT(6),4),?39
"RTN","RMPRSP2",55,0)
 W $J(CFOT(7),4),?45,$J(CFOT(8),4),?51,$J(CFOT(9),5),?58
"RTN","RMPRSP2",56,0)
 W $J(CFOT(10),4),?64,$J(CFOT(11),7)
"RTN","RMPRSP2",57,0)
 ;
"RTN","RMPRSP2",58,0)
TOT1 ;
"RTN","RMPRSP2",59,0)
 N RO
"RTN","RMPRSP2",60,0)
 S RO=0
"RTN","RMPRSP2",61,0)
 F  S RO=$O(CFOT(RO)) Q:RO=""  S CTOT=CTOT+CFOT(RO)
"RTN","RMPRSP2",62,0)
 ;
"RTN","RMPRSP2",63,0)
 W !!,"NUMBER INITIAL ACTION AFTER 5 DAYS: ",DELDAT
"RTN","RMPRSP2",64,0)
 ;
"RTN","RMPRSP2",65,0)
 W !,"PERCENT OF DELIQUENT RECORDS: "
"RTN","RMPRSP2",66,0)
 I DELDAT>0 W DELDAT/CTOT*100\1_"%"
"RTN","RMPRSP2",67,0)
 E  W "NONE"
"RTN","RMPRSP2",68,0)
 ;
"RTN","RMPRSP2",69,0)
 W !,"NUMBER OF DELIQUENT OPEN RECORDS: ",ODELDAT W ?42,"PERCENT: " I ODELDAT>0 W $FN(ODELDAT/OTOT*100,"P",1)
"RTN","RMPRSP2",70,0)
 W !!,"TOTAL CLOSED RECORDS: ",CTOT
"RTN","RMPRSP2",71,0)
 W !,"TOTAL PENDING RECORDS: ",ITOT
"RTN","RMPRSP2",72,0)
 W !,"TOTAL OPEN RECORDS: ",OTOT
"RTN","RMPRSP2",73,0)
 W !!,"TOTAL RECORDS: ",CTOT+OTOT+ITOT
"RTN","RMPRSP2",74,0)
 W !!,"OVERALL PERCENT OF RECORDS BY FORM TYPE",?73,"ERROR"
"RTN","RMPRSP2",75,0)
 ;
"RTN","RMPRSP2",76,0)
 S CALC="S FTOT=CTOT+OTOT+ITOT,FTOT=$S(FTOT=0:0,1:$J(TTOT/FTOT*100,1,1))"
"RTN","RMPRSP2",77,0)
 F I=(OFOT(1)+CFOT(1)),(OFOT(2)+CFOT(2)),(OFOT(3)+CFOT(3)),(OFOT(4)+CFOT(4)),(OFOT(5)+CFOT(5)),(OFOT(6)+CFOT(6)),(OFOT(7)+CFOT(7)),(OFOT(8)+CFOT(8)),(OFOT(9)+CFOT(9)),(OFOT(10)+CFOT(10)),(OFOT(11)+CFOT(11)) D PCAL
"RTN","RMPRSP2",78,0)
 ;
"RTN","RMPRSP2",79,0)
 W !,"PSC",?5,"2421",?11,"2237",?17,"2529-3",?25,"2529-7",?33
"RTN","RMPRSP2",80,0)
 W "2474",?39,"2431",?45,"2914",?51,"OTHER",?58,"2520"
"RTN","RMPRSP2",81,0)
 W ?64,"STK ISU",?73,"MARGIN"
"RTN","RMPRSP2",82,0)
 W !,RTOT(1),?5,RTOT(2),?11,$J(RTOT(3),4),?17,$J(RTOT(4),6)
"RTN","RMPRSP2",83,0)
 W ?25,$J(RTOT(5),6),?33,$J(RTOT(6),4),?39,$J(RTOT(7),4)
"RTN","RMPRSP2",84,0)
 W ?45,$J(RTOT(8),4),?51,$J(RTOT(9),5),?58,$J(RTOT(10),4)
"RTN","RMPRSP2",85,0)
 W ?64,$J(RTOT(11),7)
"RTN","RMPRSP2",86,0)
 N RO,MARERR
"RTN","RMPRSP2",87,0)
 S RO=0,MARERR=0
"RTN","RMPRSP2",88,0)
 F  S RO=$O(RTOT(RO)) Q:RO=""  S MARERR=MARERR+RTOT(RO)
"RTN","RMPRSP2",89,0)
 W ?74,100-MARERR_"%"
"RTN","RMPRSP2",90,0)
 G ASK1
"RTN","RMPRSP2",91,0)
 ;
"RTN","RMPRSP2",92,0)
PCAL S TTOT=I,J1=(J1+1) X CALC S RTOT(J1)=FTOT Q
"RTN","RMPRSP2",93,0)
 ;
"RTN","RMPRSP2",94,0)
ASK1 I $E(IOST)["C" K DIR S DIR(0)="E" D ^DIR G:Y<1 EXIT1
"RTN","RMPRSP2",95,0)
 I $D(NAME) W:$Y>(IOSL-4) @IOF W !!,"RECORDS CLOSED BY PROSTHETICS AGENT",! S RO=0 F  S RO=$O(NAME(RO)) Q:RO=""  W !,RO,?30,$P(NAME(RO),U)
"RTN","RMPRSP2",96,0)
 I $D(NAME),$E(IOST)["C" W !! D ^DIR
"RTN","RMPRSP2",97,0)
EXIT1 ;common exit
"RTN","RMPRSP2",98,0)
 K FO,I,J1,MARERR,MART,RMPRBDT,RX,TTOT,ITOT,TOT,FOT,OFOT,CALC,DELDAT
"RTN","RMPRSP2",99,0)
 K ODELDAT,FTOT,CTOT,OTOT,CFOT,RTOT,RMPREDT,RMPRFLG,RMPRFL,RMPREND
"RTN","RMPRSP2",100,0)
 K RMPRPAGE,RMPRG,X,Y,RMPRFORM,DIR,RP,RS,RQ,RO,RB,RZ,RMPRFOR1,RMPREX
"RTN","RMPRSP2",101,0)
 K ^TMP($J),RP,RR,RMPRFOR2,NAME,DIR
"RTN","RMPRSP2",102,0)
 D ^%ZISC
"RTN","RMPRSP2",103,0)
 Q
"RTN","RMPRSP2",104,0)
 ;
"RTN","RMPRSP2",105,0)
CALC S FO=$P(^RMPR(668,RQ,0),U,3)
"RTN","RMPRSP2",106,0)
 I $P(^RMPR(668,RQ,0),U,5) S $P(CFOT(FO),U)=$P(CFOT(FO),U)+1,X2=$P(^(0),U),X1=$P(^(0),U,9) D ^%DTC I X>7 S DELDAT=DELDAT+1
"RTN","RMPRSP2",107,0)
 ;pending total
"RTN","RMPRSP2",108,0)
 I ($P(^RMPR(668,RQ,0),U,9))&($P(^RMPR(668,RQ,0),U,5)="") S ITOT=ITOT+1
"RTN","RMPRSP2",109,0)
 ;
"RTN","RMPRSP2",110,0)
 I $P(^RMPR(668,RQ,0),U,9),$D(^VA(200,+$P(^RMPR(668,RQ,0),U,6),0)) S:'$D(NAME($P(^(0),U))) NAME($P(^(0),U))="" S $P(NAME($P(^(0),U)),U)=$P(NAME($P(^(0),U)),U)+1
"RTN","RMPRSP2",111,0)
 I '$P(^RMPR(668,RQ,0),U,9) S $P(OFOT(FO),U)=$P(OFOT(FO),U)+1 S X2=$P(^RMPR(668,RQ,0),U),X1=DT D ^%DTC I X>7 S ODELDAT=ODELDAT+1
"RTN","RMPRSP2",112,0)
 Q
"RTN","RMPRSP3")
0^22^B10253367
"RTN","RMPRSP3",1,0)
RMPRSP3 ;HINES/HNC; - Print Pending Suspense Records File 668 ;5-5-00
"RTN","RMPRSP3",2,0)
 ;;3.0;PROSTHETICS;**45,55,77**;Feb 09, 1996
"RTN","RMPRSP3",3,0)
 ; RVD 3/17/03 patch #77 - allow queing to p-message.  IO to ION
"RTN","RMPRSP3",4,0)
 ;
"RTN","RMPRSP3",5,0)
 ;station from CPRS may not be the same as site params, can not filter
"RTN","RMPRSP3",6,0)
 ;station is from duz(2), the division in file 200, or
"RTN","RMPRSP3",7,0)
 ;default institution in kernel system parameters file 8989.3.
"RTN","RMPRSP3",8,0)
 ;
"RTN","RMPRSP3",9,0)
EN ;PRINT PENDING SUSPENSE
"RTN","RMPRSP3",10,0)
 ;
"RTN","RMPRSP3",11,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT
"RTN","RMPRSP3",12,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPRSP3",13,0)
 K IO("Q") S ZTDESC="PRINT OPEN/PENDING SUMMARY SUSPENSE",ZTRTN="PRINT^RMPRSP3",ZTIO=ION
"RTN","RMPRSP3",14,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT
"RTN","RMPRSP3",15,0)
 ;
"RTN","RMPRSP3",16,0)
PRINT I '$D(IO("Q")) U IO
"RTN","RMPRSP3",17,0)
 W:$E(IOST)["C" @IOF
"RTN","RMPRSP3",18,0)
 S RMPRPAGE=1
"RTN","RMPRSP3",19,0)
 K ^TMP($J)
"RTN","RMPRSP3",20,0)
 ;
"RTN","RMPRSP3",21,0)
ALL ;main sort logic
"RTN","RMPRSP3",22,0)
 ;REQUIRED VARIABLES: RMPRPAGE - PAGE NUMBER
"RTN","RMPRSP3",23,0)
 ;                    
"RTN","RMPRSP3",24,0)
 ;VARIABLES SET:      RP - DATE OF SUPENSE RECORD
"RTN","RMPRSP3",25,0)
 ;                    RO - ENTRY NUMBER IN SUSPENSE
"RTN","RMPRSP3",26,0)
 S RP=0
"RTN","RMPRSP3",27,0)
 F  S RP=$O(^RMPR(668,"B",RP)) Q:RP'>0  D
"RTN","RMPRSP3",28,0)
 .S RO=0
"RTN","RMPRSP3",29,0)
 .F  S RO=$O(^RMPR(668,"B",RP,RO)) Q:RO'>0  D CK1
"RTN","RMPRSP3",30,0)
 G WRI
"RTN","RMPRSP3",31,0)
 Q
"RTN","RMPRSP3",32,0)
 ;
"RTN","RMPRSP3",33,0)
CK1 ;screen records
"RTN","RMPRSP3",34,0)
 Q:$P(^RMPR(668,RO,0),U,10)="X"
"RTN","RMPRSP3",35,0)
 Q:$P(^RMPR(668,RO,0),U,10)="C"
"RTN","RMPRSP3",36,0)
 ;
"RTN","RMPRSP3",37,0)
 S DFN=$P(^RMPR(668,RO,0),U,2) Q:DFN=""
"RTN","RMPRSP3",38,0)
 D DEM^VADPT
"RTN","RMPRSP3",39,0)
 S ^TMP($J,$P(^RMPR(668,RO,0),U,1),$P(VADM(1),U,1),RO)=""
"RTN","RMPRSP3",40,0)
 K VADM
"RTN","RMPRSP3",41,0)
 Q
"RTN","RMPRSP3",42,0)
 ;
"RTN","RMPRSP3",43,0)
WRI I '$D(^TMP($J)) W !,"No Open/Pending Suspense Records",! G EXIT
"RTN","RMPRSP3",44,0)
 ;date/time
"RTN","RMPRSP3",45,0)
 S RP=0
"RTN","RMPRSP3",46,0)
 F  S RP=$O(^TMP($J,RP)) Q:RP=""  D
"RTN","RMPRSP3",47,0)
 .;patient name
"RTN","RMPRSP3",48,0)
 .S RQ=""
"RTN","RMPRSP3",49,0)
 .F  S RQ=$O(^TMP($J,RP,RQ)) Q:RQ=""  D
"RTN","RMPRSP3",50,0)
 . .;record number
"RTN","RMPRSP3",51,0)
 . .S RZ=""
"RTN","RMPRSP3",52,0)
 . .F  S RZ=$O(^TMP($J,RP,RQ,RZ)) Q:RZ=""!($D(RMPREND))  D WRI2
"RTN","RMPRSP3",53,0)
 ;
"RTN","RMPRSP3",54,0)
EXIT K ^TMP($J) D ^%ZISC,KILL^XUSCLEAN Q
"RTN","RMPRSP3",55,0)
 ;
"RTN","RMPRSP3",56,0)
WRI2 I RMPRPAGE=1,'$D(RMPRFL) W:$Y>1 @IOF D HEADER1 Q:$D(RMPREND)
"RTN","RMPRSP3",57,0)
 I $Y>(IOSL-6),$E(IOST)["C",$D(RMPRFL) D HEADER Q:$D(RMPREND)
"RTN","RMPRSP3",58,0)
 I $Y>(IOSL-6),$D(RMPRFL) W @IOF D HEADER1
"RTN","RMPRSP3",59,0)
 ;
"RTN","RMPRSP3",60,0)
 W !,$$DAT1^RMPRUTL1(RP)
"RTN","RMPRSP3",61,0)
 W ?10,$$STATUS^RMPREOU(RZ,4)
"RTN","RMPRSP3",62,0)
 S WRKDAY=$$CWRKDAY^RMPREOU(RZ) W " ",WRKDAY K WRKDAY
"RTN","RMPRSP3",63,0)
 W ?24,$E($P(^DPT($P(^RMPR(668,RZ,0),U,2),0),U),1,20),?42,$E($P(^(0),U,9),6,9)
"RTN","RMPRSP3",64,0)
 D TYPE
"RTN","RMPRSP3",65,0)
 W ?61,$S($D(^VA(200,+$P(^RMPR(668,RZ,0),U,4),0)):$E($P(^VA(200,$P(^RMPR(668,RZ,0),U,4),0),U),1,19),1:"NO NAME AVAILABLE") S RMPRFL=1
"RTN","RMPRSP3",66,0)
 Q:$D(RMPREND)
"RTN","RMPRSP3",67,0)
 ;
"RTN","RMPRSP3",68,0)
 Q
"RTN","RMPRSP3",69,0)
 ;
"RTN","RMPRSP3",70,0)
HEADER W ! S DIR(0)="E" D ^DIR K DIR S:Y<1 RMPREND=1 Q:Y=""!(Y=0)  W @IOF
"RTN","RMPRSP3",71,0)
 ;
"RTN","RMPRSP3",72,0)
HEADER1 Q:$D(RMPREND)  S RMPRFL=1
"RTN","RMPRSP3",73,0)
 W !,"Prosthetics Open/Pending Summary Suspense List   "
"RTN","RMPRSP3",74,0)
 N X,Y,% D NOW^%DTC S Y=% D DD^%DT S Y=$TR(Y,"@"," ") W $P(Y,":",1,2)
"RTN","RMPRSP3",75,0)
 W ?70,"STA ",$$STA^RMPRUTIL,!,"DATE",?10,"STATUS",?24,"PATIENT"
"RTN","RMPRSP3",76,0)
 W ?42,"SSN",?48,"TYPE",?61,"SUSPENDED BY",?73,"PAGE ",RMPRPAGE
"RTN","RMPRSP3",77,0)
 W !,$$REPEAT^XLFSTR("-",79),!
"RTN","RMPRSP3",78,0)
 S RMPRPAGE=RMPRPAGE+1 I $D(RMPRFLG) W !,"CON'T" K RMPRFLG
"RTN","RMPRSP3",79,0)
 Q
"RTN","RMPRSP3",80,0)
 ;
"RTN","RMPRSP3",81,0)
TYPE S FO=$P(^RMPR(668,RZ,0),U,8) W ?48,$S(FO=1:"ROUTINE",FO=2:"EYEGLASS",FO=3:"CONTACT LENS",FO=4:"OXYGEN",FO=5:"MANUAL",1:"") Q
"RTN","RMPRSP7")
0^23^B21324847
"RTN","RMPRSP7",1,0)
RMPRSP7 ;HIN/RVD-PRINT 2319 WITHOUT SUSPENSE LINK ;3/17/03  08:13
"RTN","RMPRSP7",2,0)
 ;;3.0;PROSTHETICS;**62,69,77**;Feb 09, 1996
"RTN","RMPRSP7",3,0)
 ;RVD 8/27/01 patch #62 - PCE data print
"RTN","RMPRSP7",4,0)
 ;RVD 4/9/02 patch #69 -  Disregard Historical data
"RTN","RMPRSP7",5,0)
 ;RVD 3/17/02 patch #77 - Fixed For Loop to include all PT 2319 records
"RTN","RMPRSP7",6,0)
 ;                        that are not linked
"RTN","RMPRSP7",7,0)
 ;
"RTN","RMPRSP7",8,0)
 D DIV4^RMPRSIT I $D(Y),(Y<0) Q
"RTN","RMPRSP7",9,0)
 ; Prompt for Start Date
"RTN","RMPRSP7",10,0)
STDT ;RMPRSDT is start date in FM internal form.
"RTN","RMPRSP7",11,0)
 K %DT,X,Y
"RTN","RMPRSP7",12,0)
 S %DT("A")="Starting Date: "
"RTN","RMPRSP7",13,0)
 S %DT(0)=-DT
"RTN","RMPRSP7",14,0)
 S %DT="AEP"
"RTN","RMPRSP7",15,0)
 D ^%DT I Y<0 G EXIT1
"RTN","RMPRSP7",16,0)
 S RMPRSDT=$P(Y,".",1)
"RTN","RMPRSP7",17,0)
 S %DT("A")="Ending Date: ",%DT="AEX" D ^%DT G:Y<0 EXIT1
"RTN","RMPRSP7",18,0)
 S RMPREDT=$P(Y,".",1)
"RTN","RMPRSP7",19,0)
 I RMPRSDT>RMPREDT W !,$C(7),"Invalid Date Range Selection!!" G STDT
"RTN","RMPRSP7",20,0)
 ;
"RTN","RMPRSP7",21,0)
CONT G:'$D(RMPRSDT) EXIT1 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT1 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPRSP7",22,0)
 K IO("Q") S ZTDESC="PROSTHETIC PATIENT RECORDS WITHOUT SUSPENSE",ZTRTN="PRINT^RMPRSP7",ZTIO=ION,ZTSAVE("RMPRSDT")=""
"RTN","RMPRSP7",23,0)
 S ZTSAVE("RMPR(""STA"")")="",ZTSAVE("RMPR(")="",ZTSAVE("RMPREDT")=""
"RTN","RMPRSP7",24,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT
"RTN","RMPRSP7",25,0)
 ;
"RTN","RMPRSP7",26,0)
PRINT I $E(IOST)["C" W !!,"Processing report......."
"RTN","RMPRSP7",27,0)
 K ^TMP($J)
"RTN","RMPRSP7",28,0)
 K %DT,X,Y
"RTN","RMPRSP7",29,0)
 S X="NOW" D ^%DT S RMDATE=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3)
"RTN","RMPRSP7",30,0)
 S RMPAGE=1,(RMTOBAL,RMPREND)=0,RS=RMPR("STA")
"RTN","RMPRSP7",31,0)
 S RDT=RMPRSDT-1,RET=RMPREDT+1,RS=RMPR("STA")
"RTN","RMPRSP7",32,0)
 S Y=RMPRSDT D DD^%DT S RMSDAT=Y
"RTN","RMPRSP7",33,0)
 S Y=RMPREDT D DD^%DT S RMEDAT=Y
"RTN","RMPRSP7",34,0)
 D BUILD
"RTN","RMPRSP7",35,0)
 I '$D(^TMP($J)) D HEAD,NONE G EXIT
"RTN","RMPRSP7",36,0)
 D HEAD,HEAD1
"RTN","RMPRSP7",37,0)
 D WRITE
"RTN","RMPRSP7",38,0)
 G EXIT
"RTN","RMPRSP7",39,0)
 ;
"RTN","RMPRSP7",40,0)
BUILD ;build a tmp global.
"RTN","RMPRSP7",41,0)
 F RI=RDT:0:RET S RI=$O(^RMPR(660,"B",RI)) Q:(RI'>0)!(RMPREND)!(RI>RMPREDT)  F RJ=0:0 S RJ=$O(^RMPR(660,"B",RI,RJ)) Q:(RJ'>0)  D
"RTN","RMPRSP7",42,0)
 .;don't include if O2 transactions.
"RTN","RMPRSP7",43,0)
 .Q:$D(^RMPO(665.72,"AC",RJ))
"RTN","RMPRSP7",44,0)
 .S RM0=$G(^RMPR(660,RJ,0))
"RTN","RMPRSP7",45,0)
 .S RM10=$G(^RMPR(660,RJ,10))
"RTN","RMPRSP7",46,0)
 .Q:($P(RM0,U,13)=13)!($P(RM0,U,15)="*")
"RTN","RMPRSP7",47,0)
 .Q:($P(RM10,U,14)>0)!($P(RM0,U,10)'=RMPR("STA"))
"RTN","RMPRSP7",48,0)
 .Q:$P(RM0,U,17)'=""
"RTN","RMPRSP7",49,0)
 .I $P(RM0,U,10)=RS D
"RTN","RMPRSP7",50,0)
 ..S RMDFN=$P(RM0,U,2)
"RTN","RMPRSP7",51,0)
 ..S RMITIEN=$P(RM0,U,6)
"RTN","RMPRSP7",52,0)
 ..S (RMITEM,RMPAT)=""
"RTN","RMPRSP7",53,0)
 ..I RMITIEN,($D(^RMPR(661,RMITIEN,0))),($D(^PRC(441,$P(^RMPR(661,RMITIEN,0),U,1),0))) D
"RTN","RMPRSP7",54,0)
 ...S RMITEM=$P(^PRC(441,$P(^RMPR(661,RMITIEN,0),U,1),0),U,2)
"RTN","RMPRSP7",55,0)
 ..S RMITEM=$E(RMITEM,1,18)
"RTN","RMPRSP7",56,0)
 ..I $D(^DPT(RMDFN,0)) S RMPAT=$E($P(^DPT(RMDFN,0),U,1),U,15)
"RTN","RMPRSP7",57,0)
 ..S RMSUSP=$P(RM10,U,1)
"RTN","RMPRSP7",58,0)
 ..S RMRXDT=$P(RM10,U,2)
"RTN","RMPRSP7",59,0)
 ..S RMIADT=$P(RM10,U,3)
"RTN","RMPRSP7",60,0)
 ..S RCDT=$P(RM10,U,4)
"RTN","RMPRSP7",61,0)
 ..S RMAMT=$P(RM0,U,16)
"RTN","RMPRSP7",62,0)
 ..S RMSRC=RJ
"RTN","RMPRSP7",63,0)
 ..S RMPRDI=$P(RM10,U,7)
"RTN","RMPRSP7",64,0)
 ..S RMINIE=$P(RM0,U,27)
"RTN","RMPRSP7",65,0)
 ..S RMCOSU=$P(RM10,U,9)
"RTN","RMPRSP7",66,0)
 ..S RMSUST=$P(RM10,U,11)
"RTN","RMPRSP7",67,0)
 ..S RMPCEP=$P(RM10,U,12)
"RTN","RMPRSP7",68,0)
 ..S RPDT=$P(RM10,U,13)
"RTN","RMPRSP7",69,0)
 ..I RMINIE,$D(^VA(200,RMINIE,0)) S RMINI=$E($P(^VA(200,RMINIE,0),U,1),1,10)
"RTN","RMPRSP7",70,0)
 ..E  S RMINI=""
"RTN","RMPRSP7",71,0)
 ..S RDDT=$E(RI,4,5)_"/"_$E(RI,6,7)_"/"_$E(RI,2,3)
"RTN","RMPRSP7",72,0)
 ..S:RPDT'="" RPDT=$E(RPDT,4,5)_"/"_$E(RPDT,6,7)_"/"_$E(RPDT,2,3)
"RTN","RMPRSP7",73,0)
 ..S:RCDT'="" RCDT=$E(RCDT,4,5)_"/"_$E(RCDT,6,7)_"/"_$E(RCDT,2,3)
"RTN","RMPRSP7",74,0)
 ..S ^TMP($J,RI,RMPAT,RJ)=RMITEM_"^"_RDDT_"^"_RMAMT_"^"_RMSRC_"^"_RMINI_"^"_RPDT_"^"_$E(RMPRDI,1,10)
"RTN","RMPRSP7",75,0)
 Q
"RTN","RMPRSP7",76,0)
 ;
"RTN","RMPRSP7",77,0)
WRITE ;write report to a selected device
"RTN","RMPRSP7",78,0)
 S (RMPREND,RI,RM)=0
"RTN","RMPRSP7",79,0)
 F  S RI=$O(^TMP($J,RI)) Q:(RI'>0)!(RMPREND)  S RJ="" F  S RJ=$O(^TMP($J,RI,RJ)) Q:(RJ="")!(RMPREND)  F  S RM=$O(^TMP($J,RI,RJ,RM)) Q:(RM'>0)!(RMPREND)  D
"RTN","RMPRSP7",80,0)
 .S RMDAT=$G(^TMP($J,RI,RJ,RM))
"RTN","RMPRSP7",81,0)
 .S RMPAT=RJ
"RTN","RMPRSP7",82,0)
 .S RMITEM=$P(RMDAT,U,1)
"RTN","RMPRSP7",83,0)
 .S RDDT=$P(RMDAT,U,2)
"RTN","RMPRSP7",84,0)
 .S RMAMT=$P(RMDAT,U,3)
"RTN","RMPRSP7",85,0)
 .S RMSRC=$P(RMDAT,U,4)
"RTN","RMPRSP7",86,0)
 .S RMINI=$P(RMDAT,U,5)
"RTN","RMPRSP7",87,0)
 .S RPDT=$P(RMDAT,U,6)
"RTN","RMPRSP7",88,0)
 .S RMPRDI=$E($P(RMDAT,U,7),1,12)
"RTN","RMPRSP7",89,0)
 .W !,RDDT,?10,RMPAT,?26,RMITEM,?45,$J(RMAMT,8,2),?57,RMSRC,?67,RMINI
"RTN","RMPRSP7",90,0)
 .S RMPRFLG=1
"RTN","RMPRSP7",91,0)
 .I $E(IOST)["C"&($Y>(IOSL-7)) S DIR(0)="E" D ^DIR S:$D(DTOUT)!(Y=0) RMPREND=1 Q:RMPREND  W @IOF D HEAD,HEAD1 Q
"RTN","RMPRSP7",92,0)
 .I $Y>(IOSL-6) W @IOF D HEAD,HEAD1 K RMPRFLG Q
"RTN","RMPRSP7",93,0)
 W !,RMPR("L")
"RTN","RMPRSP7",94,0)
 W !,"<End of Report>"
"RTN","RMPRSP7",95,0)
 Q
"RTN","RMPRSP7",96,0)
 ;
"RTN","RMPRSP7",97,0)
HEAD W !,"PROSTHETICS PATIENT RECORDS NOT LINKED TO SUSPENSE  Run Date:",RMDATE,?70,"PAGE: ",RMPAGE
"RTN","RMPRSP7",98,0)
 W !,"Start Date: ",RMSDAT,?26,"End Date: ",RMEDAT,?51,"station: ",$E($P($G(^DIC(4,RS,0)),U,1),1,19)
"RTN","RMPRSP7",99,0)
 S RMPAGE=RMPAGE+1
"RTN","RMPRSP7",100,0)
 Q
"RTN","RMPRSP7",101,0)
 ;
"RTN","RMPRSP7",102,0)
HEAD1 I $E(IOST)["C"&($Y>(IOSL-7)) S DIR(0)="E" D ^DIR S:$D(DTOUT)!(Y=0) RMPREND=1 Q:RMPREND  W @IOF D HEAD
"RTN","RMPRSP7",103,0)
 I $E(IOST)'["C"&($Y>(IOSL-6)) W @IOF D HEAD
"RTN","RMPRSP7",104,0)
 W !,RMPR("L")
"RTN","RMPRSP7",105,0)
 W !,"DATE",?10,"PATIENT",?26,"ITEM",?49,"COST",?57,"VISTA #",?67,"INITIATOR"
"RTN","RMPRSP7",106,0)
 W !,"----",?10,"-------",?26,"----",?49,"----",?57,"-------",?67,"---------"
"RTN","RMPRSP7",107,0)
 S RMPRFLG=1
"RTN","RMPRSP7",108,0)
 Q
"RTN","RMPRSP7",109,0)
 ;
"RTN","RMPRSP7",110,0)
EXIT I $E(IOST)["C",'RMPREND K DIR S DIR(0)="E" D ^DIR
"RTN","RMPRSP7",111,0)
EXIT1 D ^%ZISC
"RTN","RMPRSP7",112,0)
 K ^TMP($J)
"RTN","RMPRSP7",113,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPRSP7",114,0)
 Q
"RTN","RMPRSP7",115,0)
NONE W !!,"NO DATA TO PRINT !!!!!"
"RTN","RMPRSP7",116,0)
 Q
"VER")
8.0^22.0
"^DD",660,660,8.61,0)
CONSULT REQUEST SERVICE^F^^4;3^K:$L(X)>35!($L(X)<2) X
"^DD",660,660,8.61,3)
Answer must be 2-35 characters in length.
"^DD",660,660,8.61,21,0)
^^3^3^3030507^
"^DD",660,660,8.61,21,1,0)
A service/section of a suspense requestor that initiated a consult for
"^DD",660,660,8.61,21,2,0)
Prosthetics item.  This free text entry is a service/section name of
"^DD",660,660,8.61,21,3,0)
SERVICE/SECTION file (#49).
"^DD",660,660,8.61,"DT")
3030506
**END**
**END**
