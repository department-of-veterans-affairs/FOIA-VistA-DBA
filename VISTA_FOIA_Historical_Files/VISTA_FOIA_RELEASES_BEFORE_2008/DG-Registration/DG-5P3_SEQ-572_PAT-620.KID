Released DG*5.3*620 SEQ #572
Extracted from mail message
**KIDS**:DG*5.3*620^

**INSTALL NAME**
DG*5.3*620
"BLD",5689,0)
DG*5.3*620^REGISTRATION^0^3050429^y
"BLD",5689,4,0)
^9.64PA^^
"BLD",5689,"INIT")
EN^DG53620P
"BLD",5689,"KRN",0)
^9.67PA^8989.52^19
"BLD",5689,"KRN",.4,0)
.4
"BLD",5689,"KRN",.401,0)
.401
"BLD",5689,"KRN",.402,0)
.402
"BLD",5689,"KRN",.403,0)
.403
"BLD",5689,"KRN",.5,0)
.5
"BLD",5689,"KRN",.84,0)
.84
"BLD",5689,"KRN",3.6,0)
3.6
"BLD",5689,"KRN",3.8,0)
3.8
"BLD",5689,"KRN",9.2,0)
9.2
"BLD",5689,"KRN",9.8,0)
9.8
"BLD",5689,"KRN",9.8,"NM",0)
^9.68A^11^11
"BLD",5689,"KRN",9.8,"NM",1,0)
DG53620P^^0^B2879475
"BLD",5689,"KRN",9.8,"NM",2,0)
DG53620D^^0^B9314705
"BLD",5689,"KRN",9.8,"NM",3,0)
DPTNAME^^0^B13781209
"BLD",5689,"KRN",9.8,"NM",4,0)
DPTNAME1^^0^B10381357
"BLD",5689,"KRN",9.8,"NM",5,0)
DG53620X^^0^B83619676
"BLD",5689,"KRN",9.8,"NM",6,0)
DPTLK1^^0^B33747797
"BLD",5689,"KRN",9.8,"NM",7,0)
DPTLK2^^0^B27589398
"BLD",5689,"KRN",9.8,"NM",8,0)
DG53244U^^0^B59861459
"BLD",5689,"KRN",9.8,"NM",9,0)
VAFCEHU2^^0^B58838899
"BLD",5689,"KRN",9.8,"NM",10,0)
VAFCEHU3^^0^B18681050
"BLD",5689,"KRN",9.8,"NM",11,0)
DG53620Y^^0^B15033168
"BLD",5689,"KRN",9.8,"NM","B","DG53244U",8)

"BLD",5689,"KRN",9.8,"NM","B","DG53620D",2)

"BLD",5689,"KRN",9.8,"NM","B","DG53620P",1)

"BLD",5689,"KRN",9.8,"NM","B","DG53620X",5)

"BLD",5689,"KRN",9.8,"NM","B","DG53620Y",11)

"BLD",5689,"KRN",9.8,"NM","B","DPTLK1",6)

"BLD",5689,"KRN",9.8,"NM","B","DPTLK2",7)

"BLD",5689,"KRN",9.8,"NM","B","DPTNAME",3)

"BLD",5689,"KRN",9.8,"NM","B","DPTNAME1",4)

"BLD",5689,"KRN",9.8,"NM","B","VAFCEHU2",9)

"BLD",5689,"KRN",9.8,"NM","B","VAFCEHU3",10)

"BLD",5689,"KRN",19,0)
19
"BLD",5689,"KRN",19,"NM",0)
^9.68A^^
"BLD",5689,"KRN",19.1,0)
19.1
"BLD",5689,"KRN",101,0)
101
"BLD",5689,"KRN",409.61,0)
409.61
"BLD",5689,"KRN",771,0)
771
"BLD",5689,"KRN",870,0)
870
"BLD",5689,"KRN",8989.51,0)
8989.51
"BLD",5689,"KRN",8989.52,0)
8989.52
"BLD",5689,"KRN",8994,0)
8994
"BLD",5689,"KRN","B",.4,.4)

"BLD",5689,"KRN","B",.401,.401)

"BLD",5689,"KRN","B",.402,.402)

"BLD",5689,"KRN","B",.403,.403)

"BLD",5689,"KRN","B",.5,.5)

"BLD",5689,"KRN","B",.84,.84)

"BLD",5689,"KRN","B",3.6,3.6)

"BLD",5689,"KRN","B",3.8,3.8)

"BLD",5689,"KRN","B",9.2,9.2)

"BLD",5689,"KRN","B",9.8,9.8)

"BLD",5689,"KRN","B",19,19)

"BLD",5689,"KRN","B",19.1,19.1)

"BLD",5689,"KRN","B",101,101)

"BLD",5689,"KRN","B",409.61,409.61)

"BLD",5689,"KRN","B",771,771)

"BLD",5689,"KRN","B",870,870)

"BLD",5689,"KRN","B",8989.51,8989.51)

"BLD",5689,"KRN","B",8989.52,8989.52)

"BLD",5689,"KRN","B",8994,8994)

"BLD",5689,"QUES",0)
^9.62^^
"BLD",5689,"REQB",0)
^9.611^5^5
"BLD",5689,"REQB",1,0)
XU*8.0*343^2
"BLD",5689,"REQB",2,0)
DG*5.3*244^2
"BLD",5689,"REQB",3,0)
DG*5.3*574^2
"BLD",5689,"REQB",4,0)
DG*5.3*615^2
"BLD",5689,"REQB",5,0)
DG*5.3*479^2
"BLD",5689,"REQB","B","DG*5.3*244",2)

"BLD",5689,"REQB","B","DG*5.3*479",5)

"BLD",5689,"REQB","B","DG*5.3*574",3)

"BLD",5689,"REQB","B","DG*5.3*615",4)

"BLD",5689,"REQB","B","XU*8.0*343",1)

"INIT")
EN^DG53620P
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
620^3050429^100824
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","DG53244U")
0^8^B59861459
"RTN","DG53244U",1,0)
DG53244U ;ALB/JDS,BPOIFO/KEITH - Patient Name Standardization ; 27 Jan 2002 11:55 PM
"RTN","DG53244U",2,0)
 ;;5.3;Registration;**244,620**;Aug 13, 1993
"RTN","DG53244U",3,0)
 ;Adapted from XLFNAME3 MKO
"RTN","DG53244U",4,0)
RUN(DGFLAG) ;Convert PATIENT file names;
"RTN","DG53244U",5,0)
 ;In: DGFLAG [ "U"  : Quit, use existing global
"RTN","DG53244U",6,0)
 ;           [ "K"  : Kill ^XTMP. generate global 
"RTN","DG53244U",7,0)
 ;           [ "P"  : Kill ^XTMP, update names, generate global
"RTN","DG53244U",8,0)
 ;
"RTN","DG53244U",9,0)
 ;Use existing global to print
"RTN","DG53244U",10,0)
 Q:DGFLAG="U"
"RTN","DG53244U",11,0)
 ;
"RTN","DG53244U",12,0)
 N DGIENS,DGNAM,DGNMSP,DGPVAL,DPTINV,DGQ,DGTOTAL,DGOUT,DGNCMG,DGNOFDEL
"RTN","DG53244U",13,0)
 N DGA,DGI,DPTFIL,DPTFLD,DPTIENS,DGFIELD,DGTYPE,DPTA,DPTI,VAFHCA08,DGZ
"RTN","DG53244U",14,0)
 N DPTVALUE,DGTEXT,VAFCA08,VAFCNO,DGENUPLD,DPTFN,DGPRUN,DGXRARY,DGMPI
"RTN","DG53244U",15,0)
 N DGICN
"RTN","DG53244U",16,0)
 ;Initialize variables
"RTN","DG53244U",17,0)
 S DGNMSP="DPTNAME",DGQ="""",DGOUT=0
"RTN","DG53244U",18,0)
 F DGI=1:1 S DGA=$T(FIELD+DGI) Q:(DGA'[";;")  D
"RTN","DG53244U",19,0)
 .S DGFIELD(DGI,$P($P(DGA,";;",2),U,3))=$P(DGA,";;",2) Q
"RTN","DG53244U",20,0)
 D XRARY^DG53244V
"RTN","DG53244U",21,0)
 ;Set up ^XTMP
"RTN","DG53244U",22,0)
 I '$G(^XTMP(DGNMSP,0,0)) D
"RTN","DG53244U",23,0)
 .K ^XTMP(DGNMSP)
"RTN","DG53244U",24,0)
 .S ^XTMP(DGNMSP,0)=$$FMADD^XLFDT(DT,90)_"^"_DT
"RTN","DG53244U",25,0)
 .I DGFLAG="P" D
"RTN","DG53244U",26,0)
 ..S ^XTMP(DGNMSP,0,0)=$$NOW^XLFDT(),$P(^XTMP(DGNMSP,0),U,4)=0
"RTN","DG53244U",27,0)
 ..S $P(^XTMP(DGNMSP,0),U,3)="Perform Name Conversion"
"RTN","DG53244U",28,0)
 ..Q
"RTN","DG53244U",29,0)
 .I DGFLAG="K" S $P(^XTMP(DGNMSP,0),U,3)="Generate Report Data"
"RTN","DG53244U",30,0)
 .I '$D(^XTMP(DGNMSP,"STATS")) D
"RTN","DG53244U",31,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.01),U,7)="Patient name"
"RTN","DG53244U",32,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.211),U,7)="Primary NOK name"
"RTN","DG53244U",33,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.2191),U,7)="Secondary NOK name"
"RTN","DG53244U",34,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.2401),U,7)="Father's name"
"RTN","DG53244U",35,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.2402),U,7)="Mother's name"
"RTN","DG53244U",36,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.2403),U,7)="Mother's maiden name"
"RTN","DG53244U",37,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.331),U,7)="Prim. E-contact name"
"RTN","DG53244U",38,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.3311),U,7)="2nd E-contact name"
"RTN","DG53244U",39,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.341),U,7)="Designee name"
"RTN","DG53244U",40,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2.01,.01),U,7)="Alias name"
"RTN","DG53244U",41,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2.101,30),U,7)="Attorney's name"
"RTN","DG53244U",42,0)
 I DGFLAG="P" D
"RTN","DG53244U",43,0)
 .S $P(^XTMP(DGNMSP,0),U)=$$FMADD^XLFDT(DT,90)
"RTN","DG53244U",44,0)
 .S $P(^XTMP(DGNMSP,0),U,5)="RUN"
"RTN","DG53244U",45,0)
 .S DGPRUN=$O(^XTMP(DGNMSP,0,""),-1)+1
"RTN","DG53244U",46,0)
 .S ^XTMP(DGNMSP,0,DGPRUN)=$$NOW^XLFDT()_"^^"_+$P($G(^XTMP(DGNMSP,"STATS")),U)
"RTN","DG53244U",47,0)
 .D MGOUT^DG53244T(.DGNCMG)  ;Remove name change mail group
"RTN","DG53244U",48,0)
 .Q
"RTN","DG53244U",49,0)
 ;
"RTN","DG53244U",50,0)
 ;Prevent messages to HEC
"RTN","DG53244U",51,0)
 S DGENUPLD="ENROLLMENT/ELIGIBILITY UPLOAD IN PROGRESS"
"RTN","DG53244U",52,0)
 S VAFCNO=1  ;Prevent MPI messages
"RTN","DG53244U",53,0)
 S (VAFCA08,VAFHCA08)=1  ;Prevent PIMS Generic Messaging
"RTN","DG53244U",54,0)
 S DGNOFDEL=1  ;Prevent deletion of contact address fields
"RTN","DG53244U",55,0)
 ;
"RTN","DG53244U",56,0)
LOOP ;Loop through Patient file
"RTN","DG53244U",57,0)
 S DGIEN=+$P(^XTMP(DGNMSP,0),U,4)
"RTN","DG53244U",58,0)
 F  S DGIEN=$O(^DPT(DGIEN)) Q:'DGIEN!$$LAST()  D
"RTN","DG53244U",59,0)
 .;Skip merging patients
"RTN","DG53244U",60,0)
 .Q:$P($G(^DPT(DGIEN,0)),U)["MERGING INTO"
"RTN","DG53244U",61,0)
 .;Skip patients that have been merged to another record
"RTN","DG53244U",62,0)
 .Q:$D(^DPT(DGIEN,-9))
"RTN","DG53244U",63,0)
 .;Evaluate field values
"RTN","DG53244U",64,0)
 .S DGIENS=DGIEN_",",DGMPI=0
"RTN","DG53244U",65,0)
 .S DGZ=0 F  S DGZ=$O(DGFIELD(DGZ)) Q:'DGZ  D
"RTN","DG53244U",66,0)
 ..S DPTA=""  F  S DPTA=$O(DGFIELD(DGZ,DPTA)) Q:DPTA=""  D
"RTN","DG53244U",67,0)
 ...Q:'$D(^DPT(DGIEN,$P(DPTA,";")))
"RTN","DG53244U",68,0)
 ...S DGTYPE=DGFIELD(DGZ,DPTA),DPTFLD=$P(DGTYPE,U,2)
"RTN","DG53244U",69,0)
 ...S DPTMAX=$P(DGTYPE,U,5) S:'DPTMAX DPTMAX=35
"RTN","DG53244U",70,0)
 ...I $L(DPTA,";")=3 D  Q
"RTN","DG53244U",71,0)
 ....F DPTI=0:0 S DPTI=$O(^DPT(DGIEN,$P(DPTA,";"),DPTI)) Q:'DPTI  D
"RTN","DG53244U",72,0)
 .....S DPTIENS=DGIEN_","_DPTI_",",DPTFIL=$P(DGTYPE,U,6)
"RTN","DG53244U",73,0)
 .....S DPTVALUE=$P($G(^DPT(DGIEN,$P(DPTA,";"),DPTI,$P(DPTA,";",2))),U,$P(DPTA,";",3))
"RTN","DG53244U",74,0)
 .....Q:'$L(DPTVALUE)
"RTN","DG53244U",75,0)
 .....D UPDATE(DGFLAG,DPTFIL,DPTIENS,DPTFLD,DPTVALUE,DGNMSP,DPTMAX,DPTA)
"RTN","DG53244U",76,0)
 ...S DPTIENS=DGIEN_",",DPTFIL=2
"RTN","DG53244U",77,0)
 ...S DPTVALUE=$P($G(^DPT(DGIEN,$P(DPTA,";"))),U,$P(DPTA,";",2))
"RTN","DG53244U",78,0)
 ...Q:'$L(DPTVALUE)
"RTN","DG53244U",79,0)
 ...D UPDATE(DGFLAG,DPTFIL,DPTIENS,DPTFLD,DPTVALUE,DGNMSP,DPTMAX,DPTA,.DGMPI)
"RTN","DG53244U",80,0)
 ..S $P(^XTMP(DGNMSP,0),U,4)=DGIEN
"RTN","DG53244U",81,0)
 .I DGMPI D  ;Send MPI message
"RTN","DG53244U",82,0)
 ..D RMPI(1) S DGICN=$$GETICN^MPIF001(DGIEN)
"RTN","DG53244U",83,0)
 ..;No ICN, don't send message
"RTN","DG53244U",84,0)
 ..I +DGICN=-1 S DGICN=0 D RMPI(2)
"RTN","DG53244U",85,0)
 ..;Local ICN, don't send message
"RTN","DG53244U",86,0)
 ..I $P($$SITE^VASITE(),"^",3)=$E(DGICN,1,3) S DGICN=0 D RMPI(3)
"RTN","DG53244U",87,0)
 ..I DGICN'=0 N X S X="MPIFA31B" X ^%ZOSF("TEST") D RMPI(4) I $T S DGMPI=$$A31^MPIFA31B(DGIEN) D RMPI(5,DGMPI)
"RTN","DG53244U",88,0)
 ..;Log exception to MPI if problem generating ICN
"RTN","DG53244U",89,0)
 ..I +DGMPI=-1 D RMPI(6),START^RGHLLOG(),EXC^RGHLLOG(220,"Problem generating A31 "_$P(DGMPI,"^",2),DGIEN),STOP^RGHLLOG()
"RTN","DG53244U",90,0)
 ;Send notification message
"RTN","DG53244U",91,0)
 Q:DGFLAG'="P"
"RTN","DG53244U",92,0)
 D MGIN^DG53244T(DGNCMG)  ;Replace name change mail group
"RTN","DG53244U",93,0)
 I 'DGIEN,'DGOUT S $P(^XTMP(DGNMSP,0,0),U,2)=$$NOW^XLFDT()
"RTN","DG53244U",94,0)
 S $P(^XTMP(DGNMSP,0,DGPRUN),U,2)=$$NOW^XLFDT()
"RTN","DG53244U",95,0)
 S $P(^XTMP(DGNMSP,0,DGPRUN),U,4)=+$P(^XTMP(DGNMSP,"STATS"),U)
"RTN","DG53244U",96,0)
 S $P(^XTMP(DGNMSP,0),U,5)="STOP"
"RTN","DG53244U",97,0)
MSG K DGTEXT
"RTN","DG53244U",98,0)
 N XMY,XMTEXT,XMDUN,XMDUZ,XMSUB,XMZ,DGLINE
"RTN","DG53244U",99,0)
 S DGLINE="",$P(DGLINE,"-",80)=""
"RTN","DG53244U",100,0)
 S XMSUB="Patient Name Conversion Process"
"RTN","DG53244U",101,0)
 S XMY("G.PMSTRACK@FORUM.VA.GOV")=""
"RTN","DG53244U",102,0)
 S XMY(+$G(DUZ))="",(XMDUN,XMDUZ)="Patch DG*5.3*244"
"RTN","DG53244U",103,0)
 S DGTEXT(1,0)="The Patient Name Standardization conversion has completed" S DGTEXT=1
"RTN","DG53244U",104,0)
 I DGOUT D
"RTN","DG53244U",105,0)
 .S DGTEXT(1,0)="The Patient Name Standardization was Stopped"
"RTN","DG53244U",106,0)
 .S DGTEXT(2,0)="Please remember to complete the patient name conversion in the future."
"RTN","DG53244U",107,0)
 .S DGTEXT=2
"RTN","DG53244U",108,0)
 S DGOUT=0 D STATS^DG53244V(.DGTEXT)
"RTN","DG53244U",109,0)
 S XMTEXT="DGTEXT("
"RTN","DG53244U",110,0)
 D ^XMD
"RTN","DG53244U",111,0)
 Q
"RTN","DG53244U",112,0)
 ;
"RTN","DG53244U",113,0)
UPDATE(DGFLAG,DGFIL,DGIENS,DGFLD,DGNAM,DGNMSP,DPTMAX,DPTA,DGMPI) ;Process name field
"RTN","DG53244U",114,0)
 ;
"RTN","DG53244U",115,0)
 N DGAUD,DGFDA,DGMSG,DIERR,DGOLD
"RTN","DG53244U",116,0)
 ;Total names evaluated
"RTN","DG53244U",117,0)
 S $P(^XTMP(DGNMSP,"STATS"),U)=$P($G(^XTMP(DGNMSP,"STATS")),U)+1
"RTN","DG53244U",118,0)
 ;Total evaluated by field
"RTN","DG53244U",119,0)
 S $P(^XTMP(DGNMSP,"STATS",DGFIL,DGFLD),U)=$P($G(^XTMP(DGNMSP,"STATS",DGFIL,DGFLD)),U)+1
"RTN","DG53244U",120,0)
 ;Format name
"RTN","DG53244U",121,0)
 S DGOLD=$G(DGNAM)
"RTN","DG53244U",122,0)
 S DGNAM=$$FORMAT^XLFNAME7(.DGNAM,3,DPTMAX,,2,.DGAUD,$S(DGFLD=.2403:1,1:0))
"RTN","DG53244U",123,0)
 D:(DGAUD'=0) RECORD(DGFIL,DGFLD,DGIENS,DGNAM,.DGAUD,DGNMSP,DGIEN,DGOLD)
"RTN","DG53244U",124,0)
 Q:DGFLAG'="P"  ;Processing only
"RTN","DG53244U",125,0)
 Q:DGAUD=2  ;Unconvertible
"RTN","DG53244U",126,0)
 ;Update components if name is not changed
"RTN","DG53244U",127,0)
 I DGAUD=0 D  Q
"RTN","DG53244U",128,0)
 .N DGI,DA,X,DG20NAME,XUNOTRIG
"RTN","DG53244U",129,0)
 .F DGI=2.1,1.1 D
"RTN","DG53244U",130,0)
 ..S:(DGFIL=2) DA=DGIEN S:(DGFIL'=2) DA(1)=DGIEN,DA=$P(DGIENS,",",2)
"RTN","DG53244U",131,0)
 ..S X=DGNAM X DGXRARY($P(DGFIELD(DGZ,DPTA),U,7),DGI)
"RTN","DG53244U",132,0)
 ..Q
"RTN","DG53244U",133,0)
 .Q
"RTN","DG53244U",134,0)
 ;Update source name if different
"RTN","DG53244U",135,0)
 S DPTINV=$TR($$INV(DGIENS),":",",")_","
"RTN","DG53244U",136,0)
 S DGFDA(DGFIL,DPTINV,DGFLD)=DGNAM
"RTN","DG53244U",137,0)
 D FILE^DIE("","DGFDA","DGMSG") K DIERR,DGMSG
"RTN","DG53244U",138,0)
 ;Changes of interest to MPI
"RTN","DG53244U",139,0)
 I DGAUD=1,DGFIL=2 D
"RTN","DG53244U",140,0)
 .I DGFLD=.01 S DGMPI=1
"RTN","DG53244U",141,0)
 .I DGFLD=.2403,DGOLD_","'=DGNAM S DGMPI=1
"RTN","DG53244U",142,0)
 Q
"RTN","DG53244U",143,0)
 ;
"RTN","DG53244U",144,0)
LAST() ;Check stop point
"RTN","DG53244U",145,0)
 I $P(^XTMP(DGNMSP,0),U,5)="STOP" S DGOUT=1 Q DGOUT
"RTN","DG53244U",146,0)
 I $G(DGLIM)="SR",DGIEN>DGLIM(DGLIM) S DGOUT=1 Q DGOUT
"RTN","DG53244U",147,0)
 I DGIEN#100=0 D
"RTN","DG53244U",148,0)
 .I $G(DGLIM)="SD",$$NOW^XLFDT()>DGLIM(DGLIM) S DGOUT=1 Q
"RTN","DG53244U",149,0)
 .D STOP^DG53244V
"RTN","DG53244U",150,0)
 Q DGOUT
"RTN","DG53244U",151,0)
 ;
"RTN","DG53244U",152,0)
RECORD(DGFIL,DGFLD,DGREC,DGNAM,DGAUD,DGNMSP,DGIEN,DGOLD) ;file changes in ^XTMP
"RTN","DG53244U",153,0)
 ;^XTMP global format:
"RTN","DG53244U",154,0)
 ;^XTMP("DPTNAME",0)=purge_date^date_created^process^last_ien^
"RTN","DG53244U",155,0)
 ;                   stop_flag^name_change_mail_group
"RTN","DG53244U",156,0)
 ;^XTMP("DPTNAME",0,0)=conversion_start^conversion_end
"RTN","DG53244U",157,0)
 ;^XTMP("DPTNAME",0,n)=conversion_start^conversion_end^
"RTN","DG53244U",158,0)
 ;                     pts_evaluated_start^pts_evaluated_end
"RTN","DG53244U",159,0)
 ;^XTMP("DPTNAME",DFN,FILE,IFN,FIELD)=old_value^new_value^change_types
"RTN","DG53244U",160,0)
 ;^XTMP("DPTNAME",DFN,"MPI")=1^1^1^1^1^1 (status of MPI messaging)
"RTN","DG53244U",161,0)
 ;^XTMP("DPTNAME",DFN,"MPI","A31")=the result of call to $$A31^MPIFA31B
"RTN","DG53244U",162,0)
 ;^XTMP("DPTNAME","STATS")=names_evaluated^pts_w/changes^total_changes^
"RTN","DG53244U",163,0)
 ;                         type1_changes^type2_changes^type3_changes^
"RTN","DG53244U",164,0)
 ;                         type4_changes
"RTN","DG53244U",165,0)
 ;^XTMP("DPTNAME","STATS",FILE,FIELD)=total_evaluated^total_changed^
"RTN","DG53244U",166,0)
 ;                               type1_changes^type2_changes^
"RTN","DG53244U",167,0)
 ;                               type3_changes^type4_changes
"RTN","DG53244U",168,0)
 ;^XTMP("DPTNAME","B",NAME)=dfn
"RTN","DG53244U",169,0)
 ;
"RTN","DG53244U",170,0)
 ;Data change types: 1=name contains no comma
"RTN","DG53244U",171,0)
 ;                   2=parenthetical text is removed
"RTN","DG53244U",172,0)
 ;                   3=value could not be converted
"RTN","DG53244U",173,0)
 ;                   4=characters are removed or changed
"RTN","DG53244U",174,0)
 ;
"RTN","DG53244U",175,0)
 N DGIENS,DGIEN2,DGTSTR,DGI,DGN S DGTSTR=""
"RTN","DG53244U",176,0)
 S DGIEN2=$S($P(DGREC,",",2):$P(DGREC,",",2),1:DGIEN)
"RTN","DG53244U",177,0)
 ;Record values
"RTN","DG53244U",178,0)
 F DGI=1:1:4 I $D(DGAUD(DGI)) D
"RTN","DG53244U",179,0)
 .S DGTSTR=DGTSTR_DGI
"RTN","DG53244U",180,0)
 .;Field changes by type
"RTN","DG53244U",181,0)
 .S $P(^XTMP(DGNMSP,"STATS",DGFIL,DGFLD),U,(DGI+2))=$P($G(^XTMP(DGNMSP,"STATS",DGFIL,DGFLD)),U,(DGI+2))+1
"RTN","DG53244U",182,0)
 .;Total changes by type
"RTN","DG53244U",183,0)
 .S $P(^XTMP(DGNMSP,"STATS"),U,(DGI+3))=$P($G(^XTMP(DGNMSP,"STATS")),U,(DGI+3))+1
"RTN","DG53244U",184,0)
 .Q
"RTN","DG53244U",185,0)
 ;Total patients with changes
"RTN","DG53244U",186,0)
 I '$D(^XTMP(DGNMSP,DGIEN)) S $P(^XTMP(DGNMSP,"STATS"),U,2)=$P($G(^XTMP(DGNMSP,"STATS")),U,2)+1
"RTN","DG53244U",187,0)
 ;Total fields with changes
"RTN","DG53244U",188,0)
 S $P(^XTMP(DGNMSP,"STATS"),U,3)=$P($G(^XTMP(DGNMSP,"STATS")),U,3)+1
"RTN","DG53244U",189,0)
 ;Total changes by field
"RTN","DG53244U",190,0)
 S $P(^XTMP(DGNMSP,"STATS",DGFIL,DGFLD),U,2)=$P($G(^XTMP(DGNMSP,"STATS",DGFIL,DGFLD)),U,2)+1
"RTN","DG53244U",191,0)
 ;PATIENT field name change and types
"RTN","DG53244U",192,0)
 S ^XTMP(DGNMSP,DGIEN,DGFIL,DGIEN2,DGFLD)=DGOLD_U_DGNAM_U_DGTSTR
"RTN","DG53244U",193,0)
 ;Name x-ref
"RTN","DG53244U",194,0)
 S DGN=$P($G(^DPT(DGIEN,0)),U) S:DGN="" DGN=" "
"RTN","DG53244U",195,0)
 S ^XTMP(DGNMSP,"B",DGN,DGIEN)=""
"RTN","DG53244U",196,0)
 Q
"RTN","DG53244U",197,0)
 ;
"RTN","DG53244U",198,0)
RMPI(DGP,DGMPI) ;Record MPI notification status
"RTN","DG53244U",199,0)
 S $P(^XTMP("DPTNAME",DGIEN,"MPI"),U,DGP)=1
"RTN","DG53244U",200,0)
 Q:'$D(DGMPI)  S ^XTMP("DPTNAME",DGIEN,"MPI","A31")=DGMPI
"RTN","DG53244U",201,0)
 Q
"RTN","DG53244U",202,0)
 ;
"RTN","DG53244U",203,0)
INV(DGIENS) ;Invert the IENS
"RTN","DG53244U",204,0)
 N DGI,DGX
"RTN","DG53244U",205,0)
 Q:DGIENS?."," ""
"RTN","DG53244U",206,0)
 S:DGIENS'?.E1"," DGIENS=DGIENS_","
"RTN","DG53244U",207,0)
 S DGX="" F DGI=$L(DGIENS,",")-1:-1:1 S DGX=DGX_$P(DGIENS,",",DGI)_":"
"RTN","DG53244U",208,0)
 S:DGX?.E1":" DGX=$E(DGX,1,$L(DGX)-1)
"RTN","DG53244U",209,0)
 Q DGX
"RTN","DG53244U",210,0)
 ;
"RTN","DG53244U",211,0)
FIELD ;;
"RTN","DG53244U",212,0)
 ;;NAME^.01^0;1^1.01^30^^ANAM01
"RTN","DG53244U",213,0)
 ;;K-NAME^.211^.21;1^1.02^^^ANAM211
"RTN","DG53244U",214,0)
 ;;K2-NAME^.2191^.211;1^1.03^^^ANAM2191
"RTN","DG53244U",215,0)
 ;;FATHER'S NAME^.2401^.24;1^1.04^^^ANAM2401
"RTN","DG53244U",216,0)
 ;;MOTHER'S NAME^.2402^.24;2^1.05^^^ANAM2402
"RTN","DG53244U",217,0)
 ;;MOTHER'S MAIDEN^.2403^.24;3^1.06^^^ANAM2403
"RTN","DG53244U",218,0)
 ;;E-NAME^.331^.33;1^1.07^^^ANAM331
"RTN","DG53244U",219,0)
 ;;E2-NAME^.3311^.331;1^1.08^^^ANAM3311
"RTN","DG53244U",220,0)
 ;;D NAME^.341^.34;1^1.09^^^ANAM341
"RTN","DG53244U",221,0)
 ;;ALIAS^.01^.01;0;1^100.03^30^2.01^ANAM201
"RTN","DG53244U",222,0)
 ;;ATTORNEY^30^DIS;3;1^100.21^30^2.101^ANAM1001
"RTN","DG53620D")
0^2^B9314705
"RTN","DG53620D",1,0)
DG53620D ;Plano/DW - Post-init continuation for DG*5.3*620 ; Aug 27, 2004
"RTN","DG53620D",2,0)
 ;;5.3;Registration;**620**;Aug 13, 1993
"RTN","DG53620D",3,0)
 ;
"RTN","DG53620D",4,0)
EN ;Entry point
"RTN","DG53620D",5,0)
 D DD
"RTN","DG53620D",6,0)
 Q
"RTN","DG53620D",7,0)
 ;
"RTN","DG53620D",8,0)
DD ;Set input transforms
"RTN","DG53620D",9,0)
 ;
"RTN","DG53620D",10,0)
 D BMES^XPDUTL("Updating input transforms...")
"RTN","DG53620D",11,0)
 ;
"RTN","DG53620D",12,0)
 S $P(^DD(2,.01,0),U,5,99)="K:$L(X)>30!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^XLFNAME7(.DG20NAME,3,30) K:'$L(X) X,DG20NAME S:$D(X) DGNEWVAL=X"
"RTN","DG53620D",13,0)
 ;
"RTN","DG53620D",14,0)
 S $P(^DD(2,.211,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^XLFNAME7(.DG20NAME,3,35) K:'$L(X) X,DG20NAME"
"RTN","DG53620D",15,0)
 ;
"RTN","DG53620D",16,0)
 S $P(^DD(2,.2191,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^XLFNAME7(.DG20NAME,3,35) K:'$L(X) X,DG20NAME I $D(X) D K1^DGLOCK2"
"RTN","DG53620D",17,0)
 ;
"RTN","DG53620D",18,0)
 S $P(^DD(2,.2401,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^XLFNAME7(.DG20NAME,3,35) K:'$L(X) X,DG20NAME"
"RTN","DG53620D",19,0)
 ;
"RTN","DG53620D",20,0)
 S $P(^DD(2,.2402,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^XLFNAME7(.DG20NAME,3,35) K:'$L(X) X,DG20NAME"
"RTN","DG53620D",21,0)
 ;
"RTN","DG53620D",22,0)
 S $P(^DD(2,.2403,0),U,5,99)="K:$L(X)>35!($L(X)<2) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^XLFNAME7(.DG20NAME,3,35,,2,,1) K:'$L(X) X,DG20NAME"
"RTN","DG53620D",23,0)
 ;
"RTN","DG53620D",24,0)
 S $P(^DD(2,.331,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^XLFNAME7(.DG20NAME,3,35) K:'$L(X) X,DG20NAME"
"RTN","DG53620D",25,0)
 ;
"RTN","DG53620D",26,0)
 S $P(^DD(2,.3311,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^XLFNAME7(.DG20NAME,3,35) K:'$L(X) X,DG20NAME I $D(X) D E1^DGLOCK2"
"RTN","DG53620D",27,0)
 ;
"RTN","DG53620D",28,0)
 S $P(^DD(2,.341,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^XLFNAME7(.DG20NAME,3,35) K:'$L(X) X,DG20NAME"
"RTN","DG53620D",29,0)
 ;
"RTN","DG53620D",30,0)
 S $P(^DD(2.01,.01,0),U,5,99)="K:$L(X)>30!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^XLFNAME7(.DG20NAME,3,30) K:'$L(X) X,DG20NAME"
"RTN","DG53620D",31,0)
 ;
"RTN","DG53620D",32,0)
 S $P(^DD(2.101,30,0),U,5,99)="K:$L(X)>30!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^XLFNAME7(.DG20NAME,3,30) K:'$L(X) X,DG20NAME"
"RTN","DG53620D",33,0)
 ;
"RTN","DG53620D",34,0)
 Q
"RTN","DG53620P")
0^1^B2879475
"RTN","DG53620P",1,0)
DG53620P ;Plano/DW - Post installation routine ; 8/2/2004
"RTN","DG53620P",2,0)
 ;;5.3;Registration;**620**;Aug 13, 1993
"RTN","DG53620P",3,0)
 Q
"RTN","DG53620P",4,0)
EN ;Entry point
"RTN","DG53620P",5,0)
 ;
"RTN","DG53620P",6,0)
 ;Update input transforms
"RTN","DG53620P",7,0)
 D DD^DG53620D
"RTN","DG53620P",8,0)
 ;
"RTN","DG53620P",9,0)
 ;Update cross-references
"RTN","DG53620P",10,0)
 D EN^DG53620X
"RTN","DG53620P",11,0)
 ;
"RTN","DG53620P",12,0)
 ;Recompile templates
"RTN","DG53620P",13,0)
 D TMPL
"RTN","DG53620P",14,0)
 ;
"RTN","DG53620P",15,0)
 ;Update triggered fields
"RTN","DG53620P",16,0)
 D TRIG
"RTN","DG53620P",17,0)
 ;
"RTN","DG53620P",18,0)
 Q
"RTN","DG53620P",19,0)
 ;
"RTN","DG53620P",20,0)
TMPL ;Recompile input templates
"RTN","DG53620P",21,0)
 N DGFLD
"RTN","DG53620P",22,0)
 D BMES^XPDUTL("Recompiling templates...")
"RTN","DG53620P",23,0)
 F DGFLD=.01,.211,.2191,.2401,.2402,.2403,.331,.3311,.341 S DGFLD(2,DGFLD)=""
"RTN","DG53620P",24,0)
 D DIEZ^DIKCUTL3(2,.DGFLD)
"RTN","DG53620P",25,0)
 K DGFLD S DGFLD(2.01,.01)="" D DIEZ^DIKCUTL3(2.01,.DGFLD)
"RTN","DG53620P",26,0)
 K DGFLD S DGFLD(2.101,30)="" D DIEZ^DIKCUTL3(2.101,.DGFLD)
"RTN","DG53620P",27,0)
 Q
"RTN","DG53620P",28,0)
 ;
"RTN","DG53620P",29,0)
TRIG ;Update trigger definitions
"RTN","DG53620P",30,0)
 N DGFLD
"RTN","DG53620P",31,0)
 D BMES^XPDUTL("Updating trigger field definitions...")
"RTN","DG53620P",32,0)
 F DGFLD=.01,.211,.2191,.2401,.2402,.2403,.331,.3311,.341 S DGFLD(2,DGFLD)=""
"RTN","DG53620P",33,0)
 D T1(.DGFLD)
"RTN","DG53620P",34,0)
 K DGFLD S DGFLD(2.01,.01)="" D T1(.DGFLD)
"RTN","DG53620P",35,0)
 K DGFLD S DGFLD(2.101,30)="" D T1(.DGFLD)
"RTN","DG53620P",36,0)
 Q
"RTN","DG53620P",37,0)
 ;
"RTN","DG53620P",38,0)
T1(DGFLD) ;Check/update triggering field definitions
"RTN","DG53620P",39,0)
 ;Input: DGFLD=array of fields to update
"RTN","DG53620P",40,0)
 N DGOUT,DGFILE
"RTN","DG53620P",41,0)
 D TRIG^DICR(.DGFLD,.DGOUT)
"RTN","DG53620P",42,0)
 S DGFILE=0 F  S DGFILE=$O(DGOUT(DGFILE)) Q:'DGFILE  D
"RTN","DG53620P",43,0)
 .S DGFLD=0 F  S DGFLD=$O(DGOUT(DGFILE,DGFLD)) Q:'DGFLD  D
"RTN","DG53620P",44,0)
 ..D MES^XPDUTL("         Field #"_DGFLD_" of file #"_DGFILE_" updated.")
"RTN","DG53620P",45,0)
 Q
"RTN","DG53620P",46,0)
 ;
"RTN","DG53620X")
0^5^B83619676
"RTN","DG53620X",1,0)
DG53620X ;Plano/DW-MODIFY NEW-STYLE XREF ;11:26 AM  1 Sep 2004
"RTN","DG53620X",2,0)
 ;;5.3;Registration;**620**;Aug 13, 1993
"RTN","DG53620X",3,0)
 ;
"RTN","DG53620X",4,0)
 Q
"RTN","DG53620X",5,0)
EN ;Entry point
"RTN","DG53620X",6,0)
 D NOP,ANAM01,ANAM211,ANAM2191,ANAM2401
"RTN","DG53620X",7,0)
 D ANAM2402,ANAM2403,ANAM331,ANAM3311
"RTN","DG53620X",8,0)
 D ANAM341^DG53620Y,ANAM201^DG53620Y,ANAM1001^DG53620Y
"RTN","DG53620X",9,0)
 Q
"RTN","DG53620X",10,0)
 ;
"RTN","DG53620X",11,0)
NOP ;NOP X-REF
"RTN","DG53620X",12,0)
 N DGXR,DGRES,DGOUT
"RTN","DG53620X",13,0)
 S DGXR("FILE")=2
"RTN","DG53620X",14,0)
 S DGXR("NAME")="NOP"
"RTN","DG53620X",15,0)
 S DGXR("TYPE")="R"
"RTN","DG53620X",16,0)
 S DGXR("USE")="LS"
"RTN","DG53620X",17,0)
 S DGXR("EXECUTION")="F"
"RTN","DG53620X",18,0)
 S DGXR("ACTIVITY")="IR"
"RTN","DG53620X",19,0)
 S DGXR("SHORT DESCR")="Index of standardized values that don't match .01 value."
"RTN","DG53620X",20,0)
 S DGXR("DESCR",1)="This cross reference facilitates PATIENT file lookups by a standardized name"
"RTN","DG53620X",21,0)
 S DGXR("DESCR",2)="value.  In addition to the standardization applied by Kernel name utilities,"
"RTN","DG53620X",22,0)
 S DGXR("DESCR",3)="hyphens and apostrophes are also removed from the name value.  This cross"
"RTN","DG53620X",23,0)
 S DGXR("DESCR",4)="reference is only set if the standardized name is different than the patient"
"RTN","DG53620X",24,0)
 S DGXR("DESCR",5)="name value stored in the NAME (#.01) field."
"RTN","DG53620X",25,0)
 S DGXR("VAL",1)=.01
"RTN","DG53620X",26,0)
 S DGXR("VAL",1,"SUBSCRIPT")=1
"RTN","DG53620X",27,0)
 S DGXR("VAL",1,"LENGTH")=30
"RTN","DG53620X",28,0)
 S DGXR("VAL",1,"COLLATION")="F"
"RTN","DG53620X",29,0)
 S DGXR("VAL",1,"XFORM FOR STORAGE")="S X=$$NOP^XLFNAME7(X)"
"RTN","DG53620X",30,0)
 S DGXR("VAL",1,"XFORM FOR LOOKUP")="S X=$$NOP^XLFNAME7(X)"
"RTN","DG53620X",31,0)
 D CREIXN^DDMOD(.DGXR,"kW",.DGRES,"DGOUT")
"RTN","DG53620X",32,0)
 Q
"RTN","DG53620X",33,0)
ANAM01 ;ANAM01 X-REF
"RTN","DG53620X",34,0)
 N DGXR,DGRES,DGOUT
"RTN","DG53620X",35,0)
 S DGXR("FILE")=2
"RTN","DG53620X",36,0)
 S DGXR("NAME")="ANAM01"
"RTN","DG53620X",37,0)
 S DGXR("TYPE")="MU"
"RTN","DG53620X",38,0)
 S DGXR("USE")="A"
"RTN","DG53620X",39,0)
 S DGXR("EXECUTION")="F"
"RTN","DG53620X",40,0)
 S DGXR("ACTIVITY")="IR"
"RTN","DG53620X",41,0)
 S DGXR("SHORT DESCR")="This index keeps the NAME COMPONENTS file in synch with the .01 field."
"RTN","DG53620X",42,0)
 S DGXR("DESCR",1)="This cross reference uses Kernel name standardization APIs to keep the NAME"
"RTN","DG53620X",43,0)
 S DGXR("DESCR",2)="COMPONENTS (#20) file record associated with the #.01 field synchronized"
"RTN","DG53620X",44,0)
 S DGXR("DESCR",3)="with the data value stored in that field."
"RTN","DG53620X",45,0)
 S DGXR("SET")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^XLFNAME7(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.01,.DG20NAME,1.01,+$P($G(^DPT(DA,""NAME"")),U),""CL30"") K DG20NAME Q"
"RTN","DG53620X",46,0)
 S DGXR("KILL")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.01,1.01) Q"
"RTN","DG53620X",47,0)
 S DGXR("VAL",1)=.01
"RTN","DG53620X",48,0)
 S DGXR("VAL",1,"SUBSCRIPT")=1
"RTN","DG53620X",49,0)
 S DGXR("VAL",1,"COLLATION")="F"
"RTN","DG53620X",50,0)
 D CREIXN^DDMOD(.DGXR,"kW",.DGRES,"DGOUT")
"RTN","DG53620X",51,0)
 Q
"RTN","DG53620X",52,0)
ANAM211 ;ANAM211 X-REF
"RTN","DG53620X",53,0)
 N DGXR,DGRES,DGOUT
"RTN","DG53620X",54,0)
 S DGXR("FILE")=2
"RTN","DG53620X",55,0)
 S DGXR("NAME")="ANAM211"
"RTN","DG53620X",56,0)
 S DGXR("TYPE")="MU"
"RTN","DG53620X",57,0)
 S DGXR("USE")="A"
"RTN","DG53620X",58,0)
 S DGXR("EXECUTION")="F"
"RTN","DG53620X",59,0)
 S DGXR("ACTIVITY")="IR"
"RTN","DG53620X",60,0)
 S DGXR("SHORT DESCR")="This index keeps the NAME COMPONENTS file in synch with field #.211."
"RTN","DG53620X",61,0)
 S DGXR("DESCR",1)="This cross reference uses Kernel name standardization APIs to keep the NAME"
"RTN","DG53620X",62,0)
 S DGXR("DESCR",2)="COMPONENTS (#20) file record associated with the #.211 field synchronized"
"RTN","DG53620X",63,0)
 S DGXR("DESCR",3)="with the data value stored in that field."
"RTN","DG53620X",64,0)
 S DGXR("SET")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^XLFNAME7(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.211,.DG20NAME,1.02,+$P($G(^DPT(DA,""NAME"")),U,2),""CL35"") K DG20NAME Q"
"RTN","DG53620X",65,0)
 S DGXR("KILL")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.211,1.02) Q"
"RTN","DG53620X",66,0)
 S DGXR("VAL",1)=.211
"RTN","DG53620X",67,0)
 S DGXR("VAL",1,"SUBSCRIPT")=1
"RTN","DG53620X",68,0)
 S DGXR("VAL",1,"COLLATION")="F"
"RTN","DG53620X",69,0)
 D CREIXN^DDMOD(.DGXR,"kW",.DGRES,"DGOUT")
"RTN","DG53620X",70,0)
 Q
"RTN","DG53620X",71,0)
 ;
"RTN","DG53620X",72,0)
ANAM2191 ;ANAM2191 X-REF
"RTN","DG53620X",73,0)
 N DGXR,DGRES,DGOUT
"RTN","DG53620X",74,0)
 S DGXR("FILE")=2
"RTN","DG53620X",75,0)
 S DGXR("NAME")="ANAM2191"
"RTN","DG53620X",76,0)
 S DGXR("TYPE")="MU"
"RTN","DG53620X",77,0)
 S DGXR("USE")="A"
"RTN","DG53620X",78,0)
 S DGXR("EXECUTION")="F"
"RTN","DG53620X",79,0)
 S DGXR("ACTIVITY")="IR"
"RTN","DG53620X",80,0)
 S DGXR("SHORT DESCR")="This index keeps the NAME COMPONENTS file in synch with field #.2191."
"RTN","DG53620X",81,0)
 S DGXR("DESCR",1)="This cross reference uses Kernel name standardization APIs to keep the NAME"
"RTN","DG53620X",82,0)
 S DGXR("DESCR",2)="COMPONENTS (#20) file record associated with the #.2191 field synchronized"
"RTN","DG53620X",83,0)
 S DGXR("DESCR",3)="with the data value stored in that field."
"RTN","DG53620X",84,0)
 S DGXR("SET")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^XLFNAME7(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.2191,.DG20NAME,1.03,+$P($G(^DPT(DA,""NAME"")),U,3),""CL35"") K DG20NAME Q"
"RTN","DG53620X",85,0)
 S DGXR("KILL")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.2191,1.03) Q"
"RTN","DG53620X",86,0)
 S DGXR("VAL",1)=.2191
"RTN","DG53620X",87,0)
 S DGXR("VAL",1,"SUBSCRIPT")=1
"RTN","DG53620X",88,0)
 S DGXR("VAL",1,"COLLATION")="F"
"RTN","DG53620X",89,0)
 D CREIXN^DDMOD(.DGXR,"kW",.DGRES,"DGOUT")
"RTN","DG53620X",90,0)
 Q
"RTN","DG53620X",91,0)
 ;
"RTN","DG53620X",92,0)
ANAM2401 ;ANAM2401 X-REF
"RTN","DG53620X",93,0)
 N DGXR,DGRES,DGOUT
"RTN","DG53620X",94,0)
 S DGXR("FILE")=2
"RTN","DG53620X",95,0)
 S DGXR("NAME")="ANAM2401"
"RTN","DG53620X",96,0)
 S DGXR("TYPE")="MU"
"RTN","DG53620X",97,0)
 S DGXR("USE")="A"
"RTN","DG53620X",98,0)
 S DGXR("EXECUTION")="F"
"RTN","DG53620X",99,0)
 S DGXR("ACTIVITY")="IR"
"RTN","DG53620X",100,0)
 S DGXR("SHORT DESCR")="This index keeps the NAME COMPONENTS file in synch with field #.2401."
"RTN","DG53620X",101,0)
 S DGXR("DESCR",1)="This cross reference uses Kernel name standardization APIs to keep the NAME"
"RTN","DG53620X",102,0)
 S DGXR("DESCR",2)="COMPONENTS (#20) file record associated with the #.2401 field synchronized"
"RTN","DG53620X",103,0)
 S DGXR("DESCR",3)="with the data value stored in that field."
"RTN","DG53620X",104,0)
 S DGXR("SET")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^XLFNAME7(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.2401,.DG20NAME,1.04,+$P($G(^DPT(DA,""NAME"")),U,4),""CL35"") K DG20NAME Q"
"RTN","DG53620X",105,0)
 S DGXR("KILL")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.2401,1.04) Q"
"RTN","DG53620X",106,0)
 S DGXR("VAL",1)=.2401
"RTN","DG53620X",107,0)
 S DGXR("VAL",1,"SUBSCRIPT")=1
"RTN","DG53620X",108,0)
 S DGXR("VAL",1,"COLLATION")="F"
"RTN","DG53620X",109,0)
 D CREIXN^DDMOD(.DGXR,"kW",.DGRES,"DGOUT")
"RTN","DG53620X",110,0)
 Q
"RTN","DG53620X",111,0)
ANAM2402 ;ANAM2402 X-REF
"RTN","DG53620X",112,0)
 N DGXR,DGRES,DGOUT
"RTN","DG53620X",113,0)
 S DGXR("FILE")=2
"RTN","DG53620X",114,0)
 S DGXR("NAME")="ANAM2402"
"RTN","DG53620X",115,0)
 S DGXR("TYPE")="MU"
"RTN","DG53620X",116,0)
 S DGXR("USE")="A"
"RTN","DG53620X",117,0)
 S DGXR("EXECUTION")="F"
"RTN","DG53620X",118,0)
 S DGXR("ACTIVITY")="IR"
"RTN","DG53620X",119,0)
 S DGXR("SHORT DESCR")="This index keeps the NAME COMPONENTS file in synch with field #.2402."
"RTN","DG53620X",120,0)
 S DGXR("DESCR",1)="This cross reference uses Kernel name standardization APIs to keep the NAME"
"RTN","DG53620X",121,0)
 S DGXR("DESCR",2)="COMPONENTS (#20) file record associated with the #.2402 field synchronized"
"RTN","DG53620X",122,0)
 S DGXR("DESCR",3)="with the data value stored in that field."
"RTN","DG53620X",123,0)
 S DGXR("SET")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^XLFNAME7(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.2402,.DG20NAME,1.05,+$P($G(^DPT(DA,""NAME"")),U,5),""CL35"") K DG20NAME Q"
"RTN","DG53620X",124,0)
 S DGXR("KILL")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.2402,1.05) Q"
"RTN","DG53620X",125,0)
 S DGXR("VAL",1)=.2402
"RTN","DG53620X",126,0)
 S DGXR("VAL",1,"SUBSCRIPT")=1
"RTN","DG53620X",127,0)
 S DGXR("VAL",1,"COLLATION")="F"
"RTN","DG53620X",128,0)
 D CREIXN^DDMOD(.DGXR,"kW",.DGRES,"DGOUT")
"RTN","DG53620X",129,0)
 Q
"RTN","DG53620X",130,0)
ANAM2403 ;ANAM2403 X-REF
"RTN","DG53620X",131,0)
 N DGXR,DGRES,DGOUT
"RTN","DG53620X",132,0)
 S DGXR("FILE")=2
"RTN","DG53620X",133,0)
 S DGXR("NAME")="ANAM2403"
"RTN","DG53620X",134,0)
 S DGXR("TYPE")="MU"
"RTN","DG53620X",135,0)
 S DGXR("USE")="A"
"RTN","DG53620X",136,0)
 S DGXR("EXECUTION")="F"
"RTN","DG53620X",137,0)
 S DGXR("ACTIVITY")="IR"
"RTN","DG53620X",138,0)
 S DGXR("SHORT DESCR")="This index keeps the NAME COMPONENTS file in synch with field #.2403."
"RTN","DG53620X",139,0)
 S DGXR("DESCR",1)="This cross reference uses Kernel name standardization APIs to keep the NAME"
"RTN","DG53620X",140,0)
 S DGXR("DESCR",2)="COMPONENTS (#20) file record associated with the #.2403 field synchronized"
"RTN","DG53620X",141,0)
 S DGXR("DESCR",3)="with the data value stored in that field."
"RTN","DG53620X",142,0)
 S DGXR("SET")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^XLFNAME7(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.2403,.DG20NAME,1.06,+$P($G(^DPT(DA,""NAME"")),U,6),""CL35"") K DG20NAME Q"
"RTN","DG53620X",143,0)
 S DGXR("KILL")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.2403,1.06) Q"
"RTN","DG53620X",144,0)
 S DGXR("VAL",1)=.2403
"RTN","DG53620X",145,0)
 S DGXR("VAL",1,"SUBSCRIPT")=1
"RTN","DG53620X",146,0)
 S DGXR("VAL",1,"COLLATION")="F"
"RTN","DG53620X",147,0)
 D CREIXN^DDMOD(.DGXR,"kW",.DGRES,"DGOUT")
"RTN","DG53620X",148,0)
 Q
"RTN","DG53620X",149,0)
ANAM331 ;ANAM331 X-REF
"RTN","DG53620X",150,0)
 N DGXR,DGRES,DGOUT
"RTN","DG53620X",151,0)
 S DGXR("FILE")=2
"RTN","DG53620X",152,0)
 S DGXR("NAME")="ANAM331"
"RTN","DG53620X",153,0)
 S DGXR("TYPE")="MU"
"RTN","DG53620X",154,0)
 S DGXR("USE")="A"
"RTN","DG53620X",155,0)
 S DGXR("EXECUTION")="F"
"RTN","DG53620X",156,0)
 S DGXR("ACTIVITY")="IR"
"RTN","DG53620X",157,0)
 S DGXR("SHORT DESCR")="This index keeps the NAME COMPONENTS file in synch with field #.331."
"RTN","DG53620X",158,0)
 S DGXR("DESCR",1)="This cross reference uses Kernel name standardization APIs to keep the NAME"
"RTN","DG53620X",159,0)
 S DGXR("DESCR",2)="COMPONENTS (#20) file record associated with the #.331 field synchronized"
"RTN","DG53620X",160,0)
 S DGXR("DESCR",3)="with the data value stored in that field."
"RTN","DG53620X",161,0)
 S DGXR("SET")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^XLFNAME7(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.331,.DG20NAME,1.07,+$P($G(^DPT(DA,""NAME"")),U,7),""CL35"") K DG20NAME Q"
"RTN","DG53620X",162,0)
 S DGXR("KILL")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.331,1.07) Q"
"RTN","DG53620X",163,0)
 S DGXR("VAL",1)=.331
"RTN","DG53620X",164,0)
 S DGXR("VAL",1,"SUBSCRIPT")=1
"RTN","DG53620X",165,0)
 S DGXR("VAL",1,"COLLATION")="F"
"RTN","DG53620X",166,0)
 D CREIXN^DDMOD(.DGXR,"kW",.DGRES,"DGOUT")
"RTN","DG53620X",167,0)
 Q
"RTN","DG53620X",168,0)
ANAM3311 ;ANAM3311 X-REF
"RTN","DG53620X",169,0)
 N DGXR,DGRES,DGOUT
"RTN","DG53620X",170,0)
 S DGXR("FILE")=2
"RTN","DG53620X",171,0)
 S DGXR("NAME")="ANAM3311"
"RTN","DG53620X",172,0)
 S DGXR("TYPE")="MU"
"RTN","DG53620X",173,0)
 S DGXR("USE")="A"
"RTN","DG53620X",174,0)
 S DGXR("EXECUTION")="F"
"RTN","DG53620X",175,0)
 S DGXR("ACTIVITY")="IR"
"RTN","DG53620X",176,0)
 S DGXR("SHORT DESCR")="This index keeps the NAME COMPONENTS file in synch with field #.3311."
"RTN","DG53620X",177,0)
 S DGXR("DESCR",1)="This cross reference uses Kernel name standardization APIs to keep the NAME"
"RTN","DG53620X",178,0)
 S DGXR("DESCR",2)="COMPONENTS (#20) file record associated with the #.3311 field synchronized"
"RTN","DG53620X",179,0)
 S DGXR("DESCR",3)="with the data value stored in that field."
"RTN","DG53620X",180,0)
 S DGXR("SET")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^XLFNAME7(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.3311,.DG20NAME,1.08,+$P($G(^DPT(DA,""NAME"")),U,8),""CL35"") K DG20NAME Q"
"RTN","DG53620X",181,0)
 S DGXR("KILL")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.3311,1.08) Q"
"RTN","DG53620X",182,0)
 S DGXR("VAL",1)=.3311
"RTN","DG53620X",183,0)
 S DGXR("VAL",1,"SUBSCRIPT")=1
"RTN","DG53620X",184,0)
 S DGXR("VAL",1,"COLLATION")="F"
"RTN","DG53620X",185,0)
 D CREIXN^DDMOD(.DGXR,"kW",.DGRES,"DGOUT")
"RTN","DG53620X",186,0)
 Q
"RTN","DG53620X",187,0)
 ;
"RTN","DG53620Y")
0^11^B15033168
"RTN","DG53620Y",1,0)
DG53620Y ;Plano/DW-Modify NEW-STYLE XREF ;11:50 AM  29 Nov 2004
"RTN","DG53620Y",2,0)
 ;;5.3;Registration;**620**;Aug 13, 1993
"RTN","DG53620Y",3,0)
 ;
"RTN","DG53620Y",4,0)
 ;Continued after DG53620X
"RTN","DG53620Y",5,0)
ANAM341 ;ANAM341 X-REF
"RTN","DG53620Y",6,0)
 N DGXR,DGRES,DGOUT
"RTN","DG53620Y",7,0)
 S DGXR("FILE")=2
"RTN","DG53620Y",8,0)
 S DGXR("NAME")="ANAM341"
"RTN","DG53620Y",9,0)
 S DGXR("TYPE")="MU"
"RTN","DG53620Y",10,0)
 S DGXR("USE")="A"
"RTN","DG53620Y",11,0)
 S DGXR("EXECUTION")="F"
"RTN","DG53620Y",12,0)
 S DGXR("ACTIVITY")="IR"
"RTN","DG53620Y",13,0)
 S DGXR("SHORT DESCR")="This index keeps the NAME COMPONENTS file in synch with field #.341."
"RTN","DG53620Y",14,0)
 S DGXR("DESCR",1)="This cross reference uses Kernel name standardization APIs to keep the NAME"
"RTN","DG53620Y",15,0)
 S DGXR("DESCR",2)="COMPONENTS (#20) file record associated with the #.341 field synchronized"
"RTN","DG53620Y",16,0)
 S DGXR("DESCR",3)="with the data value stored in that field."
"RTN","DG53620Y",17,0)
 S DGXR("SET")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^XLFNAME7(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.341,.DG20NAME,1.09,+$P($G(^DPT(DA,""NAME"")),U,9),""CL35"") K DG20NAME Q"
"RTN","DG53620Y",18,0)
 S DGXR("KILL")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.341,1.09) Q"
"RTN","DG53620Y",19,0)
 S DGXR("VAL",1)=.341
"RTN","DG53620Y",20,0)
 S DGXR("VAL",1,"SUBSCRIPT")=1
"RTN","DG53620Y",21,0)
 S DGXR("VAL",1,"COLLATION")="F"
"RTN","DG53620Y",22,0)
 D CREIXN^DDMOD(.DGXR,"kW",.DGRES,"DGOUT")
"RTN","DG53620Y",23,0)
 Q
"RTN","DG53620Y",24,0)
 ;
"RTN","DG53620Y",25,0)
ANAM201 ;ANAM201 X-REF
"RTN","DG53620Y",26,0)
 N DGXR,DGRES,DGOUT
"RTN","DG53620Y",27,0)
 S DGXR("FILE")=2
"RTN","DG53620Y",28,0)
 S DGXR("ROOT FILE")=2.01
"RTN","DG53620Y",29,0)
 S DGXR("NAME")="ANAM201"
"RTN","DG53620Y",30,0)
 S DGXR("TYPE")="MU"
"RTN","DG53620Y",31,0)
 S DGXR("USE")="A"
"RTN","DG53620Y",32,0)
 S DGXR("EXECUTION")="F"
"RTN","DG53620Y",33,0)
 S DGXR("ACTIVITY")="IR"
"RTN","DG53620Y",34,0)
 S DGXR("SHORT DESCR")="This index keeps the NAME COMPONENTS file in synch with the .01 field."
"RTN","DG53620Y",35,0)
 S DGXR("DESCR",1)="This cross reference uses Kernel name standardization APIs to keep the NAME"
"RTN","DG53620Y",36,0)
 S DGXR("DESCR",2)="COMPONENTS (#20) file record associated with the #.01 field synchronized"
"RTN","DG53620Y",37,0)
 S DGXR("DESCR",3)="with the data value stored in that field."
"RTN","DG53620Y",38,0)
 S DGXR("SET")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^XLFNAME7(.DG20NAME),UPDCOMP^XLFNAME2(2.01,.DA,.01,.DG20NAME,100.03,,""CL30"") K DG20NAME Q"
"RTN","DG53620Y",39,0)
 S DGXR("KILL")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2.01,.DA,.01,100.03) Q"
"RTN","DG53620Y",40,0)
 S DGXR("VAL",1)=.01
"RTN","DG53620Y",41,0)
 S DGXR("VAL",1,"SUBSCRIPT")=1
"RTN","DG53620Y",42,0)
 S DGXR("VAL",1,"COLLATION")="F"
"RTN","DG53620Y",43,0)
 D CREIXN^DDMOD(.DGXR,"kW",.DGRES,"DGOUT")
"RTN","DG53620Y",44,0)
 Q
"RTN","DG53620Y",45,0)
 ;
"RTN","DG53620Y",46,0)
ANAM1001 ;ANAM1001 X-REF
"RTN","DG53620Y",47,0)
 N DGXR,DGRES,DGOUT
"RTN","DG53620Y",48,0)
 S DGXR("FILE")=2
"RTN","DG53620Y",49,0)
 S DGXR("ROOT FILE")=2.101
"RTN","DG53620Y",50,0)
 S DGXR("NAME")="ANAM1001"
"RTN","DG53620Y",51,0)
 S DGXR("TYPE")="MU"
"RTN","DG53620Y",52,0)
 S DGXR("USE")="A"
"RTN","DG53620Y",53,0)
 S DGXR("EXECUTION")="F"
"RTN","DG53620Y",54,0)
 S DGXR("ACTIVITY")="IR"
"RTN","DG53620Y",55,0)
 S DGXR("SHORT DESCR")="This index keeps the NAME COMPONENTS file in synch with field #30."
"RTN","DG53620Y",56,0)
 S DGXR("DESCR",1)="This cross reference uses Kernel name standardization APIs to keep the NAME"
"RTN","DG53620Y",57,0)
 S DGXR("DESCR",2)="COMPONENTS (#20) file record associated with the #30 field synchronized"
"RTN","DG53620Y",58,0)
 S DGXR("DESCR",3)="with the data value stored in that field."
"RTN","DG53620Y",59,0)
 S DGXR("SET")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^XLFNAME7(.DG20NAME),UPDCOMP^XLFNAME2(2.101,.DA,30,.DG20NAME,100.21,,""CL30"") K DG20NAME Q"
"RTN","DG53620Y",60,0)
 S DGXR("KILL")="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2.101,.DA,30,100.21) Q"
"RTN","DG53620Y",61,0)
 S DGXR("VAL",1)=30
"RTN","DG53620Y",62,0)
 S DGXR("VAL",1,"SUBSCRIPT")=1
"RTN","DG53620Y",63,0)
 S DGXR("VAL",1,"COLLATION")="F"
"RTN","DG53620Y",64,0)
 D CREIXN^DDMOD(.DGXR,"kW",.DGRES,"DGOUT")
"RTN","DG53620Y",65,0)
 Q
"RTN","DG53620Y",66,0)
 ;
"RTN","DPTLK1")
0^6^B33747797
"RTN","DPTLK1",1,0)
DPTLK1 ;ALB/RMO - MAS Patient Look-up Check Cross-References ; 1/14/04 7:25pm
"RTN","DPTLK1",2,0)
 ;;5.3;Registration;**32,50,197,249,317,391,244,532,574,620**;Aug 13, 1993
"RTN","DPTLK1",3,0)
FIND ;Cross reference patient lookup
"RTN","DPTLK1",4,0)
 ;Optional input: DPTNOFZY='1' to suppress fuzzy lookups implemented
"RTN","DPTLK1",5,0)
 ;                by patch DG*5.3*244
"RTN","DPTLK1",6,0)
 ;
"RTN","DPTLK1",7,0)
 N DDCOMA,DPTXOLD,DPTOUT,DPTOVAL
"RTN","DPTLK1",8,0)
 S (DPTXOLD,DPTX)=$$UCASE(DPTX)
"RTN","DPTLK1",9,0)
 I DPTX?1A.E1","1.A.E S DPTXOLD=DPTX,DDCOMA="I $E($P($G(DPTVAL),"","",2),1,"_$L($P(DPTX,",",2))_")="""_$TR($P(DPTX,",",2),"""")_"""",DPTX=$P(DPTX,",")
"RTN","DPTLK1",10,0)
 K DPTREFS S DPTREFS=$S(DIC(0)'["M":"B,NOP",DPTX?1A1N.N:$S($L(DPTX)<6:"BS5,CN,RM",1:"CN,RM"),DPTX?4N!(DPTX?4N1A):"BS,SSN,CN,RM",DPTX?9N.E:"SSN,CN,RM",1:"")
"RTN","DPTLK1",11,0)
 S:DPTREFS="" DPTREFS=$S(DPTX?1N.N:$S($L(DPTX)<5:"CN,RM,BS,SSN",1:"CN,RM,SSN"),DPTX?1N.E:"CN,RM",1:"B,NOP,CN,RM") S:$D(DPTIX) DPTREFS=DPTIX_","_DPTREFS
"RTN","DPTLK1",12,0)
 S DPTBEG=1,(DPTDFN,DPTNUM,DPTOUT)=0
"RTN","DPTLK1",13,0)
 F DPTLP=1:1 S DPTREF=$P(DPTREFS,",",DPTLP) Q:DPTREF=""!(DPTDFN)  D  Q:DPTDFN!DPTOUT
"RTN","DPTLK1",14,0)
 .S DPTVAL=DPTX
"RTN","DPTLK1",15,0)
 .I DPTREF="NOP",'$G(DPTNOFZY) S DPTVAL=$$FORMAT^XLFNAME7(DPTVAL,2,30,1,0,,1) Q:'$L(DPTVAL)
"RTN","DPTLK1",16,0)
 .D LOOK(DPTVAL)
"RTN","DPTLK1",17,0)
 . I DPTREF="B",'$G(DPTNOFZY) S DPTVAL=$$FORMAT^XLFNAME7(DPTX,2,30,1,0,,1) D:DPTVAL'=DPTX LOOK(DPTVAL)
"RTN","DPTLK1",18,0)
 .Q
"RTN","DPTLK1",19,0)
 I 'DPTDFN S:DPTCNT=1&($D(DPTIFNS(DPTCNT))) DPTDFN=+DPTIFNS(DPTCNT) S DPT("NOPRT^")="" D PRTDPT:'DPTDFN&(DPTCNT>DPTNUM)&(DIC(0)["E") K DPT("NOPRT^") I 'DPTDFN,$D(DPTSEL),DPTSEL="" S DPTX="",DPTDFN=-1
"RTN","DPTLK1",20,0)
 I DPTDFN'>0,$L($G(DPTXOLD)) I DPTX=$P(DPTXOLD,",") S DPTX=DPTXOLD
"RTN","DPTLK1",21,0)
 I DPTDFN>0,$D(DPTXOLD) S DPTX=DPTXOLD
"RTN","DPTLK1",22,0)
 ;
"RTN","DPTLK1",23,0)
Q K DPTBEG,DPTIFN,DPTIFNS,DPTLP,DPTLP1,DPTNUM,DPTREF,DPTREFS,DPTVAL
"RTN","DPTLK1",24,0)
 K DPTOVAL,DPTOUT,DPTXOLD,^TMP("DPTLK",$J)
"RTN","DPTLK1",25,0)
 Q
"RTN","DPTLK1",26,0)
 ;
"RTN","DPTLK1",27,0)
LOOK(DPTVAL) ;Look for x-ref matches
"RTN","DPTLK1",28,0)
 ;Input: DPTVAL=lookup seed value
"RTN","DPTLK1",29,0)
 I $L(DPTVAL),$D(^DPT(DPTREF,DPTVAL)) D CHKIFN Q:DPTDFN!DPTOUT
"RTN","DPTLK1",30,0)
 I $L(DPTVAL),'($D(^DPT(DPTREF,DPTVAL))&(DIC(0)["O"))&(DIC(0)'["X") D CHKVAL
"RTN","DPTLK1",31,0)
 Q
"RTN","DPTLK1",32,0)
 ;
"RTN","DPTLK1",33,0)
CHKVAL S DPTOVAL=DPTVAL
"RTN","DPTLK1",34,0)
 N DPTSEED S DPTSEED=DPTVAL
"RTN","DPTLK1",35,0)
 I DPTREF="SSN",(DPTVAL?9N1"p") D  Q
"RTN","DPTLK1",36,0)
 .S DPTVAL=$E(DPTVAL,1,9)_"P" D CHKIFN
"RTN","DPTLK1",37,0)
 .Q
"RTN","DPTLK1",38,0)
 I DPTREF="SSN",(DPTVAL?2.9N) D  Q
"RTN","DPTLK1",39,0)
 .S DPTVAL=$E(DPTVAL_"0000000",1,9)
"RTN","DPTLK1",40,0)
 .D CV1(DPTVAL),CHKIFN
"RTN","DPTLK1",41,0)
 .S DPTVAL=DPTVAL_"P" D CV1(DPTVAL),CHKIFN
"RTN","DPTLK1",42,0)
 .Q
"RTN","DPTLK1",43,0)
 D CV1(DPTVAL)
"RTN","DPTLK1",44,0)
 I DPTREF="CN"!(DPTREF="RM"),DPTVAL'["E",DPTVAL=+DPTVAL,'$D(^DPT(DPTREF,DPTVAL)) D  Q
"RTN","DPTLK1",45,0)
 .S DPTVAL=$O(^DPT(DPTREF,DPTVAL_" "),-1)
"RTN","DPTLK1",46,0)
 .D CV1(DPTVAL)
"RTN","DPTLK1",47,0)
 .Q
"RTN","DPTLK1",48,0)
 Q
"RTN","DPTLK1",49,0)
 ;
"RTN","DPTLK1",50,0)
CV1(DPTVAL) ;Look for input value matches
"RTN","DPTLK1",51,0)
 I $L(DPTVAL) F DPTLP1=0:0 S DPTVAL=$O(^DPT(DPTREF,DPTVAL)) Q:DPTVAL=""!(DPTDFN)!($P(DPTVAL,DPTSEED)'="")  D CHKIFN
"RTN","DPTLK1",52,0)
 Q
"RTN","DPTLK1",53,0)
 ;
"RTN","DPTLK1",54,0)
CHKIFN F DPTIFN=0:0 S DPTIFN=$O(^DPT(DPTREF,DPTVAL,DPTIFN)) Q:'DPTIFN!(DPTDFN)!DPTOUT  S Y=DPTIFN D SETDPT I $S<DPTSZ F I=1:1:DPTNUM-7 S J=$S($D(DPTIFNS(I)):+DPTIFNS(I),1:0) K DPTIFNS(I),DPTS(J) S DPTBEG=I
"RTN","DPTLK1",55,0)
 Q
"RTN","DPTLK1",56,0)
 ;
"RTN","DPTLK1",57,0)
SETDPT Q:($D(DPTS(Y))&($G(DPTREF)'="B"))!'$D(^DPT(Y,0))
"RTN","DPTLK1",58,0)
 ; screen out MERGED FROM records - DG/574
"RTN","DPTLK1",59,0)
 Q:$D(^DPT(Y,-9))
"RTN","DPTLK1",60,0)
 N DPTNVAL I '$D(DPTOVAL) N DPTOVAL S DPTOVAL=DPTX
"RTN","DPTLK1",61,0)
 I 1 S X=DPTOVAL X:$D(DIC("S")) DIC("S") Q:'$T  X:($D(DO("SCR"))) DO("SCR") Q:'$T  X:$D(DDCOMA) DDCOMA Q:'$T
"RTN","DPTLK1",62,0)
 K:$G(DPTCNT)<1 ^TMP("DPTLK",$J)
"RTN","DPTLK1",63,0)
 S DPTS(Y)=$S('$D(DPTREF):$P(^DPT(Y,0),U),1:$P(^DPT(Y,0),U))_U_$S($D(DPTVAL):$E(DPTVAL,($L(DPTOVAL)+1),$L(DPTVAL)),1:"")
"RTN","DPTLK1",64,0)
 S DPTNVAL=$P(^DPT(Y,0),U)_U_$S($G(DPTREF)="NOP":$P(^DPT(Y,0),U),$D(DPTVAL):DPTVAL,1:"")
"RTN","DPTLK1",65,0)
 Q:$D(^TMP("DPTLK",$J,Y,DPTNVAL))
"RTN","DPTLK1",66,0)
 S DPTCNT=DPTCNT+1,^TMP("DPTLK",$J,Y,DPTNVAL)="",DPTIFNS(DPTCNT)=Y_U_DPTNVAL
"RTN","DPTLK1",67,0)
 I $D(DPTLARR) D  Q
"RTN","DPTLK1",68,0)
 .I DPTLMAX,DPTCNT>DPTLMAX D  Q
"RTN","DPTLK1",69,0)
 ..S @DPTLARR@(DPTCNT)="ADDITIONAL MATCHES FOUND BUT NOT RETURNED"
"RTN","DPTLK1",70,0)
 ..S DPTOUT=1
"RTN","DPTLK1",71,0)
 ..Q
"RTN","DPTLK1",72,0)
 .S @DPTLARR@(DPTCNT)=DPTIFNS(DPTCNT)_U_$$SSN(Y)_U_$$DOB(Y)
"RTN","DPTLK1",73,0)
 .Q
"RTN","DPTLK1",74,0)
 I '(DPTCNT#5),DIC(0)["E" D PRTDPT
"RTN","DPTLK1",75,0)
 Q
"RTN","DPTLK1",76,0)
 ;
"RTN","DPTLK1",77,0)
PRTDPT I $D(DDS) D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY S X=0 X ^%ZOSF("RM")
"RTN","DPTLK1",78,0)
 N DPTP1,DPTP2
"RTN","DPTLK1",79,0)
 F DPTNUM=DPTNUM+1:1:DPTCNT Q:DPTOUT  S DPTIFN=+DPTIFNS(DPTNUM) D
"RTN","DPTLK1",80,0)
 .W:'$D(DDS) !
"RTN","DPTLK1",81,0)
 .S DPTP2=$P(DPTIFNS(DPTNUM),U,3)
"RTN","DPTLK1",82,0)
 .S DPTP1=$P(DPTIFNS(DPTNUM),U,2)
"RTN","DPTLK1",83,0)
 .W ?3,DPTNUM,?$X+(4-$L(DPTNUM))
"RTN","DPTLK1",84,0)
 .; write the xref value
"RTN","DPTLK1",85,0)
 .W DPTP2_"  "
"RTN","DPTLK1",86,0)
 .; write patient name if diff than xref value
"RTN","DPTLK1",87,0)
 .I DPTP1'=DPTP2 W DPTP1
"RTN","DPTLK1",88,0)
 .S Y=DPTIFN X:$D(^DPT(DPTIFN,0)) "N DDS X DIC(""W"")" I $D(DDS) S DY=DY+1,DX=0 X DDXY S $X=0
"RTN","DPTLK1",89,0)
 I '$D(DPT("NOPRT^")) W:'$D(DDS) ! W "ENTER '^' TO STOP, OR "
"RTN","DPTLK1",90,0)
 W:'$D(DDS) ! W "CHOOSE ",DPTBEG,"-",DPTNUM,": " R X:DTIME S DPTSEL=X D  Q:DPTSEL=""!$D(DTOUT)!$D(DUOUT)
"RTN","DPTLK1",91,0)
 .S:'$T DPTSEL=$S($D(DPTOVAL):DPTOVAL,$D(DPTVAL):DPTVAL,$D(DPTX):DPTX,$D(DPTXOLD):DPTXOLD,1:""),(DPTOUT,DTOUT)=1
"RTN","DPTLK1",92,0)
 .S:X="^" (DPTOUT,DUOUT)=1
"RTN","DPTLK1",93,0)
 S DPTDFN=$S(DPTSEL'?.ANP!($L(DPTSEL)>30):-1,'$D(DPTIFNS(DPTSEL)):-1,$D(DPTS(+DPTIFNS(DPTSEL))):+DPTIFNS(DPTSEL),1:-1),DPTX=$S(DPTDFN<0:DPTSEL,1:DPTX)
"RTN","DPTLK1",94,0)
 S:DPTDFN=-1 DPTXOLD=DPTSEL
"RTN","DPTLK1",95,0)
 Q
"RTN","DPTLK1",96,0)
 ;
"RTN","DPTLK1",97,0)
LIST(DPTX,DPTLMAX,DPTLARR) ;Silent lookup list
"RTN","DPTLK1",98,0)
 ;Input: DPTX=lookup value (name, SSN, room, ward, DFN or 
"RTN","DPTLK1",99,0)
 ;             "space_return").
"RTN","DPTLK1",100,0)
 ;       DPTLMAX=maximum number of matches to return (optional), this
"RTN","DPTLK1",101,0)
 ;               parameter has no effect if DFN or "space_return"
"RTN","DPTLK1",102,0)
 ;               lookup methods are used.
"RTN","DPTLK1",103,0)
 ;       DPTLARR=name of array to return list of matches, this should
"RTN","DPTLK1",104,0)
 ;               be a global if DPTLMAX is a large value or unspecified
"RTN","DPTLK1",105,0)
 ;               This array is returned in the format:
"RTN","DPTLK1",106,0)
 ;               @DPTLARR@(n)=DFN^patient_name^xref_lookup_match_value^
"RTN","DPTLK1",107,0)
 ;                            SSN^Date_of_Birth
"RTN","DPTLK1",108,0)
 ;               If more matches exist than the maximum to be returned
"RTN","DPTLK1",109,0)
 ;               as specified by DPTLMAX, the @DPTLARR@(DPTLMAX+1) node
"RTN","DPTLK1",110,0)
 ;               will be defined = "ADDITIONAL MATCHES FOUND BUT NOT 
"RTN","DPTLK1",111,0)
 ;               RETURNED".
"RTN","DPTLK1",112,0)
 ;               The calling program has the responsibility to kill
"RTN","DPTLK1",113,0)
 ;               @DPTLARR prior to calling this entry point.
"RTN","DPTLK1",114,0)
 ;Output: number of matches and array named by DPTLARR.
"RTN","DPTLK1",115,0)
 ;
"RTN","DPTLK1",116,0)
 N X,Y,DPTCNT,DIC,DPTSZ,DPTDFN,DPTIFNS,DPTS
"RTN","DPTLK1",117,0)
 S DPTCNT=0,DIC(0)="M",DPTSZ=1000 S:$G(DPTLMAX)<1 DPTLMAX=0
"RTN","DPTLK1",118,0)
 ;Check for "space_return" or DFN lookup
"RTN","DPTLK1",119,0)
 I DPTX=" "!($E(DPTX)="`") D  Q DPTCNT
"RTN","DPTLK1",120,0)
 .I DPTX=" " S Y=$S('($D(DUZ)#2):-1,$D(^DISV(DUZ,"^DPT(")):^("^DPT("),1:-1)
"RTN","DPTLK1",121,0)
 .I $E(DPTX)="`" S Y=$S($D(^DPT(+$P(DPTX,"`",2),0)):+$P(DPTX,"`",2),1:-1)
"RTN","DPTLK1",122,0)
 .Q:Y<1  Q:'$D(^DPT(Y,0))  D SETDPT S DPTCNT=1
"RTN","DPTLK1",123,0)
 .Q
"RTN","DPTLK1",124,0)
 D FIND
"RTN","DPTLK1",125,0)
 Q $S(DPTLMAX&(DPTCNT>DPTLMAX):DPTLMAX,1:DPTCNT)
"RTN","DPTLK1",126,0)
 ;
"RTN","DPTLK1",127,0)
UCASE(DGX) ;Uppercase lookup value
"RTN","DPTLK1",128,0)
 ;Input: DGX=lookup value
"RTN","DPTLK1",129,0)
 ;Output: transformed DGX
"RTN","DPTLK1",130,0)
 N DGI,DGY,DGZ S DGZ=DGX,DGX=""
"RTN","DPTLK1",131,0)
 F DGI=1:1:$L(DGZ) S DGY=$E(DGZ,DGI) D
"RTN","DPTLK1",132,0)
 .S:DGY?1L DGY=$C($A(DGY)-32)
"RTN","DPTLK1",133,0)
 .S DGX=DGX_DGY
"RTN","DPTLK1",134,0)
 Q DGX
"RTN","DPTLK1",135,0)
 ;        
"RTN","DPTLK1",136,0)
SSN(DFN) ;do not show ssn identifier for patient
"RTN","DPTLK1",137,0)
 ; input DFN = ien in file #2 [required]
"RTN","DPTLK1",138,0)
 ; output SSN = nnnnnnnnn
"RTN","DPTLK1",139,0)
 ;
"RTN","DPTLK1",140,0)
 N SSN
"RTN","DPTLK1",141,0)
 S SSN="",DFN=+DFN
"RTN","DPTLK1",142,0)
 I DFN>0 D
"RTN","DPTLK1",143,0)
 .I $$SCREEN(DFN) S SSN="*SENSITIVE*" Q
"RTN","DPTLK1",144,0)
 .S SSN=$P($G(^DPT(DFN,0)),U,9)
"RTN","DPTLK1",145,0)
 Q SSN
"RTN","DPTLK1",146,0)
 ;
"RTN","DPTLK1",147,0)
DOB(DFN,DGYR) ;do not show dob identifier for patient
"RTN","DPTLK1",148,0)
 ; input DFN = ien in file #2  [required]
"RTN","DPTLK1",149,0)
 ;       DGYR = 0/1  [optional]
"RTN","DPTLK1",150,0)
 ;              where 0 returns 4-digit year (default)
"RTN","DPTLK1",151,0)
 ;                    1 returns 2-digit year
"RTN","DPTLK1",152,0)
 ;                    2 returns File manager date
"RTN","DPTLK1",153,0)
 ; output DOB = mm/dd/yyyy (default)
"RTN","DPTLK1",154,0)
 ;            = mm/dd/yy, if DGYR=1
"RTN","DPTLK1",155,0)
 ;            = yyymmdd, if DGYR=2
"RTN","DPTLK1",156,0)
 N B,DOB,YEAR
"RTN","DPTLK1",157,0)
 S DOB="",DFN=+DFN,DGYR=+$G(DGYR)
"RTN","DPTLK1",158,0)
 I DFN>0 D
"RTN","DPTLK1",159,0)
 .I $$SCREEN(DFN) S DOB="*SENSITIVE*" Q
"RTN","DPTLK1",160,0)
 .S B=$P($G(^DPT(DFN,0)),U,3)
"RTN","DPTLK1",161,0)
 .I DGYR'=2 D  Q
"RTN","DPTLK1",162,0)
 ..S YEAR=$S(DGYR=1:"2D",1:"5D")
"RTN","DPTLK1",163,0)
 ..S DOB=$$FMTE^XLFDT(B,YEAR)
"RTN","DPTLK1",164,0)
 .S DOB=B
"RTN","DPTLK1",165,0)
 Q DOB
"RTN","DPTLK1",166,0)
 ;
"RTN","DPTLK1",167,0)
SCREEN(DFN) ;Screening logic for SSN & DOB
"RTN","DPTLK1",168,0)
 ;Input  : DFN - Pointer to PATIENT file (#2)
"RTN","DPTLK1",169,0)
 ;Output : 1 - Apply screen
"RTN","DPTLK1",170,0)
 ;         0 - Don't apply screen
"RTN","DPTLK1",171,0)
 ;Notes  : Screen applied if patient is sensitive or an employee
"RTN","DPTLK1",172,0)
 ;
"RTN","DPTLK1",173,0)
 N DGTIME,DGT,DGA1,DG1,DGXFR0
"RTN","DPTLK1",174,0)
 ;Inpatient check - no longer used (kept for future reference)
"RTN","DPTLK1",175,0)
 ;D H^DGUTL S DGT=DGTIME D ^DGPMSTAT I DG1 Q 0
"RTN","DPTLK1",176,0)
 ;Sensitive - screen
"RTN","DPTLK1",177,0)
 I $P($G(^DGSL(38.1,DFN,0)),"^",2) Q 1
"RTN","DPTLK1",178,0)
 ;Employee - screen
"RTN","DPTLK1",179,0)
 I $$EMPL^DGSEC4(DFN) Q 1
"RTN","DPTLK1",180,0)
 ;Don't screen
"RTN","DPTLK1",181,0)
 Q 0
"RTN","DPTLK2")
0^7^B27589398
"RTN","DPTLK2",1,0)
DPTLK2 ;ALB/RMO - MAS Patient Look-up Add New Patient ; 9/2/04 7:14pm
"RTN","DPTLK2",2,0)
 ;;5.3;Registration;**32,197,214,244,532,578,615,620**;Aug 13, 1993
"RTN","DPTLK2",3,0)
 N DPTCT,DGVV,DPTLIDR
"RTN","DPTLK2",4,0)
 I $D(DDS) D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY
"RTN","DPTLK2",5,0)
 I '$D(DUZ(0)) W:DIC(0)["Q" !?3,*7,"Unable to Add Patient. Your Fileman Access Code is undefined." S DPTDFN=-1 G Q
"RTN","DPTLK2",6,0)
 I $S($D(DLAYGO):2\1-(DLAYGO\1),1:1),DUZ(0)'="@",$D(^DIC(2,0,"LAYGO")) F I=1:1 I DUZ(0)[$E(^("LAYGO"),I) Q:I'>$L(^("LAYGO"))  S DPTDFN=-1 W:DIC(0)["Q" *7," ??" G Q
"RTN","DPTLK2",7,0)
 N DG20NAME S DG20NAME=DPTX,DPTX=$$FORMAT^XLFNAME7(.DG20NAME,3,30,,1)
"RTN","DPTLK2",8,0)
 S DPTX=$S($E(DPTX)[""""&($E(DPTX,$L(DPTX))[""""):$P(DPTX,"""",2),$E(DPTX)["""":$P(DPTX,"""",2),$E(DPTX,$L(DPTX))["""":$P(DPTX,"""",1),1:DPTX)
"RTN","DPTLK2",9,0)
 I $L(DPTX)<3!($L(DPTX)>30)!(DPTX?1P.E)!(DPTX'[",")!(DPTX'?1U.ANP) W:DIC(0)["Q" *7," ??" S DPTDFN=-1 G Q
"RTN","DPTLK2",10,0)
 K DPTLID I DIC(0)["E" D ASKADD D  G Q:DPTDFN<0 I '$D(DIC("DR")) D CHKID G Q:DPTDFN<0 D ^DPTLK3 G Q:DPTDFN<0 W !!?3,"...adding new patient"
"RTN","DPTLK2",11,0)
 .S:DPTDFN<1&('$D(DTOUT)) DUOUT=1
"RTN","DPTLK2",12,0)
 S X=DPTX,DPT("NO^")=$G(DIE("NO^")) K DD,DO,DPTX N DPTZNV
"RTN","DPTLK2",13,0)
 S:$D(DPT("DR")) DIC("DR")="S DIE(""NO^"")=""BACK"";"_DPT("DR")
"RTN","DPTLK2",14,0)
 D FILE^DICN K:$D(DPT("DR")) DIC("DR")
"RTN","DPTLK2",15,0)
 W ?24,"...new patient added",!?3
"RTN","DPTLK2",16,0)
 S DPTDFN=Y S:$L(DPT("NO^")) DIE("NO^")=DPT("NO^")
"RTN","DPTLK2",17,0)
 ;offer prompt of patient file components
"RTN","DPTLK2",18,0)
 S DIE="^DPT(",DA=+Y,DR="S DIE(""NO^"")=""BACK"";.01///^S (X,DPTZNV)=$$NCEDIT^DPTNAME(DA,1,.DG20NAME)"
"RTN","DPTLK2",19,0)
 D ^DIE K DR
"RTN","DPTLK2",20,0)
 ;look for other (local) identifiers
"RTN","DPTLK2",21,0)
 I '$D(DIC("DR")),DIC(0)["E" D
"RTN","DPTLK2",22,0)
 .F DPTID=0:0 S DPTID=$O(^DD(2,0,"ID",DPTID)) Q:'DPTID  D
"RTN","DPTLK2",23,0)
 ..I $F(DPTGID,U_DPTID_U) Q
"RTN","DPTLK2",24,0)
 ..I '$D(^DD(2,DPTID,0)) Q
"RTN","DPTLK2",25,0)
 ..S DPTLID=""
"RTN","DPTLK2",26,0)
 ..S DPTLIDR=$S('$D(DPTLIDR):DPTID,1:DPTLIDR_";"_DPTID)
"RTN","DPTLK2",27,0)
 I $D(DPTLID) W !!?3,"Please enter the following additional information:",!?3 S DIE="^DPT(",DA=+DPTDFN,DIE("NO^")="BACK",DR=DPTLIDR D ^DIE K DIE,DA,DR
"RTN","DPTLK2",28,0)
 ;
"RTN","DPTLK2",29,0)
Q K DFN,DPT("DR"),DPTLID,DPTGID,DPTID,DPTID0,DPTIDS
"RTN","DPTLK2",30,0)
 Q
"RTN","DPTLK2",31,0)
 ;
"RTN","DPTLK2",32,0)
ASKADD I $D(DDS) I $Y>21 D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY
"RTN","DPTLK2",33,0)
 S Y=+$P(^DPT(0),U,4)+1 W !?3,*7,"ARE YOU ADDING ",$S(DPTX'?.N:"'"_DPTX_"' AS ",1:""),"A NEW PATIENT (THE ",Y,$S(Y#10=1&(Y#100-11):"ST",Y#10=2&(Y#100-12):"ND",Y#10=3&(Y#100-13):"RD",1:"TH"),")"
"RTN","DPTLK2",34,0)
 S %=2 D YN^DICN S DPTDFN=$S(%<0!(%=2):-1,%=1:1,1:0) I 'DPTDFN W !?6,"Enter 'YES' to add a new applicant, or 'NO' not to." G ASKADD
"RTN","DPTLK2",35,0)
 I %=1 S:$$CONF1^DPTNAME(DPTX)'=1 DPTDFN=-1
"RTN","DPTLK2",36,0)
 Q
"RTN","DPTLK2",37,0)
 ;
"RTN","DPTLK2",38,0)
CHKID K DFN S DPTDFN=1,DPTGID="^.02^.03^.09^391^1901^.301^994^" F DPTCT=2:1:8 S DPTID=$P(DPTGID,U,DPTCT) Q:'DPTID!(DPTDFN<0)  D CHKID1
"RTN","DPTLK2",39,0)
 Q
"RTN","DPTLK2",40,0)
 ;
"RTN","DPTLK2",41,0)
CHKID1 I $D(^DD(2,DPTID,0)) S DPT("DR")=$S('$D(DPT("DR")):DPTID,1:DPT("DR")_";"_DPTID),DPTID0=^DD(2,DPTID,0) D ASKID S:'$D(X) DPTDFN=-1
"RTN","DPTLK2",42,0)
 Q
"RTN","DPTLK2",43,0)
 ;
"RTN","DPTLK2",44,0)
ASKID N DGREC W !?3,"PATIENT ",$P(DPTID0,U),": " R X:DTIME D  I $D(DTOUT)!$G(DUOUT)!($G(DGREC)=1) W !?6,*7,"<'",DPTX,"'> NOT ADDED" K X Q
"RTN","DPTLK2",45,0)
 .S:'$T DTOUT=U
"RTN","DPTLK2",46,0)
 .S:X="^" DUOUT=1
"RTN","DPTLK2",47,0)
 .Q:$D(DTOUT)!($G(DUOUT))
"RTN","DPTLK2",48,0)
 .I DPTID=.09 D
"RTN","DPTLK2",49,0)
 ..N DGNEWPT
"RTN","DPTLK2",50,0)
 ..S DGNEWPT=1
"RTN","DPTLK2",51,0)
 ..D REC^DGSEC
"RTN","DPTLK2",52,0)
 I X["^" W:$E(X)["^" !?6,*7,"Sorry, '^' not allowed!" W " ??" G ASKID
"RTN","DPTLK2",53,0)
 ; field 994 is not a required field
"RTN","DPTLK2",54,0)
 I DPTID=994 I X["?" D HLPID G ASKID
"RTN","DPTLK2",55,0)
 I DPTID=994 I X="" G SKIP
"RTN","DPTLK2",56,0)
 I X["?"!(X="") W:X="" *7," ??" D HLPID G ASKID
"RTN","DPTLK2",57,0)
 I $P(DPTID0,U,2)["S" F I=1:1 S Y=$P($P(DPTID0,U,3),";",I) K:Y="" X Q:Y=""  I $P(Y,":",1)=X!($E($P(Y,":",2),1,$L(X))=X) S X=$P(Y,":",1),DPTSET=$P(Y,":",2) Q
"RTN","DPTLK2",58,0)
SKIP I $P(DPTID0,U,2)["P" D P1 G ASKID:Y'>0 S DPTIDS(DPTID)=X,DPT("DR")=DPT("DR")_"///"_X K DPTSET Q
"RTN","DPTLK2",59,0)
 I DPTID=.301,$D(X) D CHKIT Q:'$D(X)  I $D(X) W:$D(DPTSET) " ",DPTSET S DPTIDS(DPTID)=X,DPT("DR")=DPT("DR")_"///"_X K DPTSET Q
"RTN","DPTLK2",60,0)
 I DPTID'=.301 X $P(DPTID0,U,5,99) I $D(X) W:$D(DPTSET) " ",DPTSET S DPTIDS(DPTID)=X,DPT("DR")=DPT("DR")_"///"_X K DPTSET Q
"RTN","DPTLK2",61,0)
 W:'$D(X)&($P(DPTID0,U,2)'["D") *7," ??" D HLPID G ASKID
"RTN","DPTLK2",62,0)
 ;
"RTN","DPTLK2",63,0)
HLPID W:$D(^DD(2,DPTID,.1)) !?5,^(.1) W:$D(^DD(2,DPTID,3)) !?5,^(3) I $D(X),X["?" F I=0:0 S I=$O(^DD(2,DPTID,21,I)) Q:'I!(I>3&(X?1"?"))  I $D(^(I,0)) W !?5,^(0) I I>2,X?1"?" W !?5,"..."
"RTN","DPTLK2",64,0)
 X:$D(^DD(2,DPTID,4)) ^(4) I $P(DPTID0,U,2)["D" S X="?",%DT="E" D ^%DT
"RTN","DPTLK2",65,0)
 I $P(DPTID0,U,2)["S" W !?7,"CHOOSE FROM: " F I=1:1 S Y=$P($P(DPTID0,U,3),";",I) Q:Y=""  W !?7,$P(Y,":",1),?15," ",$P(Y,":",2)
"RTN","DPTLK2",66,0)
 I $P(DPTID0,U,2)["P" D P1
"RTN","DPTLK2",67,0)
 Q
"RTN","DPTLK2",68,0)
P1 S DPTDIC=$G(DIC),DPTDIC(0)=$G(DIC(0)) S:$D(DIC("S")) DPTDIC("S")=DIC("S") S:$D(DIC("W")) DPTDIC("W")=DIC("W") S DIC="^"_$P(DPTID0,"^",3),DIC(0)="QEMZ",D="B" D IX^DIC
"RTN","DPTLK2",69,0)
 S DIC=DPTDIC,DIC(0)=DPTDIC(0) S:$D(DPTDIC("S")) DIC("S")=DPTDIC("S") S:$D(DPTDIC("W")) DIC("W")=DPTDIC("W") K DPTDIC D DO^DIC1 S:X["^" DPTDFN=-1 I X'["^",X'["?",Y'>0 S X="?" G P1
"RTN","DPTLK2",70,0)
 Q
"RTN","DPTLK2",71,0)
CHKIT ; do input transform for .301
"RTN","DPTLK2",72,0)
 I X'="Y" Q
"RTN","DPTLK2",73,0)
 S DGVV=DPTIDS(391),DGVV=$O(^DG(391,"B",DGVV,0))
"RTN","DPTLK2",74,0)
 S DGVV=$S($D(^DG(391,+DGVV,0)):$P(^(0),"^",2),1:"")
"RTN","DPTLK2",75,0)
 I DPTIDS(1901)'="Y",'DGVV D EN^DDIOL("Applicant is NOT a veteran!!","","!?4") K X W !?6,*7,"<'",DPTX,"'> NOT ADDED"
"RTN","DPTLK2",76,0)
 Q
"RTN","DPTLK2",77,0)
DEL ;Delete logic
"RTN","DPTLK2",78,0)
 N I,J,A,G,Q,ERR S Q="""",ERR=0 F I=0:0 S I=$O(^DD(2,0,"PT",I)) Q:'I  F J=0:0 S J=$O(^DD(2,0,"PT",I,J)) Q:'J  D
"RTN","DPTLK2",79,0)
  .F K=0:0 S K=$O(^DD(I,+J,1,K)) Q:'K  S A=$G(^(K,0)) I $L($P(A,U,2)),'$L($P(A,U,3)) D
"RTN","DPTLK2",80,0)
 ..S G=$G(^DIC(+I,0,"GL")) Q:'$L(G)  I $D(@(G_Q_$P(A,U,2)_Q_","_DA_")")) W !,"Entry in "_$P($G(^DIC(I,0)),U)_" ("_I_") refers to this patient" S ERR=1 Q
"RTN","DPTLK2",81,0)
 I ERR
"RTN","DPTNAME")
0^3^B13781209
"RTN","DPTNAME",1,0)
DPTNAME ;BPOIFO/KEITH - NAME STANDARDIZATION ; 27 Jan 2002 11:05 PM
"RTN","DPTNAME",2,0)
 ;;5.3;Registration;**244,620**;Aug 13, 1993
"RTN","DPTNAME",3,0)
 ;
"RTN","DPTNAME",4,0)
NCEDIT(DFN,DGHDR,DG20NAME) ;Edit name components
"RTN","DPTNAME",5,0)
 ;Input: DFN=patient ifn
"RTN","DPTNAME",6,0)
 ;     DGHDR=1 to write components header (optional)
"RTN","DPTNAME",7,0)
 ;  DG20NAME=array of name components (optional)
"RTN","DPTNAME",8,0)
 ;Output: formatted name and DG20NAME components array if the user
"RTN","DPTNAME",9,0)
 ;        specifies filing, DG20NAME=null otherwise
"RTN","DPTNAME",10,0)
 ;
"RTN","DPTNAME",11,0)
 N DIR,X,Y,DGCOMP,DGC,DGI,DGX,DGY,DGCOM
"RTN","DPTNAME",12,0)
 N DGCL,DGCX,DGOUT,DGEDIT,%,DIE,DR,DA
"RTN","DPTNAME",13,0)
 ;Initialize variables
"RTN","DPTNAME",14,0)
START S DFN=+DFN,(DGOUT,DGEDIT)=0,DGCOMP=$D(DG20NAME)>9
"RTN","DPTNAME",15,0)
 S DGCOM="FAMILY^GIVEN^MIDDLE^PREFIX^SUFFIX^DEGREE"
"RTN","DPTNAME",16,0)
 S DGCX=" (LAST) NAME^ (FIRST) NAME^ NAME"
"RTN","DPTNAME",17,0)
 S DGCL="1:35^1:25^1:25^1:10^1:10^1:10"
"RTN","DPTNAME",18,0)
 ;Get patient name
"RTN","DPTNAME",19,0)
 S DGX=$P($G(^DPT(DFN,0)),U) Q:DGX=""
"RTN","DPTNAME",20,0)
 ;Get name component values from file #20
"RTN","DPTNAME",21,0)
 I 'DGCOMP S DGCOMP=+$G(^DPT(DFN,"NAME"))_"," I DGCOMP D
"RTN","DPTNAME",22,0)
 .D GETS^DIQ(20,DGCOMP,"1:6",,"DGCOMP")
"RTN","DPTNAME",23,0)
 .I '$D(DGCOMP(20,DGCOMP)) S DGCOMP=0 Q
"RTN","DPTNAME",24,0)
 .F DGI=1:1:6 S DGX($P(DGCOM,U,DGI))=DGCOMP(20,DGCOMP,DGI)
"RTN","DPTNAME",25,0)
 .Q
"RTN","DPTNAME",26,0)
 ;Parse name components from name value
"RTN","DPTNAME",27,0)
 I 'DGCOMP D
"RTN","DPTNAME",28,0)
 .D STDNAME^XLFNAME(.DGX,"C") S DGEDIT=1
"RTN","DPTNAME",29,0)
 .S DGX("SUFFIX")=$$CLEANC^XLFNAME(DGX("SUFFIX"))
"RTN","DPTNAME",30,0)
 .Q
"RTN","DPTNAME",31,0)
 ;Prompt for name component edits
"RTN","DPTNAME",32,0)
 N DTOUT,DUOUT,DIRUT,DGCOUT
"RTN","DPTNAME",33,0)
 S DGCOUT=0 M DG20NAME=DGX
"RTN","DPTNAME",34,0)
 S DIR("PRE")="D:X'=""@"" NCEVAL^DPTNAME1(DGCOMP,.X)"
"RTN","DPTNAME",35,0)
 I $G(DGHDR) W !,"Patient name components--"
"RTN","DPTNAME",36,0)
 F DGI=1:1:6 S DGC($P(DGCOM,U,DGI),DGI)=""
"RTN","DPTNAME",37,0)
 F DGI=1:1:6 Q:DGOUT  D
"RTN","DPTNAME",38,0)
AGAIN .S DGCOMP=$P(DGCOM,U,DGI)
"RTN","DPTNAME",39,0)
 .S DIR("A")=DGCOMP_$P(DGCX,U,DGI)
"RTN","DPTNAME",40,0)
 .S DIR(0)="FO^"_$P(DGCL,U,DGI)
"RTN","DPTNAME",41,0)
 .S DIR("PRE")="D NCEVAL^DPTNAME1(DGCOMP,.X)"
"RTN","DPTNAME",42,0)
 .S DIR("B")=$S($D(DG20NAME(DGCOMP)):DG20NAME(DGCOMP),1:$G(DGX(DGCOMP)))
"RTN","DPTNAME",43,0)
 .K:'$L(DIR("B")) DIR("B")
"RTN","DPTNAME",44,0)
ASK .D ^DIR I $D(DTOUT)!(X=U) S:(X=U) DGCOUT=1 S DGOUT=1 Q
"RTN","DPTNAME",45,0)
 .I $A(X)=94 D JUMP^DPTNAME1(.DGI) G AGAIN
"RTN","DPTNAME",46,0)
 .I X="@",DGI=1 W !,$C(7),"Family name cannot be deleted!" G ASK
"RTN","DPTNAME",47,0)
 .I X="@" D  Q
"RTN","DPTNAME",48,0)
 ..W "  (deletion indicated)" S DG20NAME(DGCOMP)=""
"RTN","DPTNAME",49,0)
 ..S:DG20NAME(DGCOMP)'=$G(DGX(DGCOMP)) DGEDIT=1
"RTN","DPTNAME",50,0)
 ..Q
"RTN","DPTNAME",51,0)
 .Q:'$L(X)
"RTN","DPTNAME",52,0)
 .S DG20NAME=X
"RTN","DPTNAME",53,0)
 .I DGCOMP="SUFFIX" S DG20NAME=$$CLEANC^XLFNAME(DG20NAME)
"RTN","DPTNAME",54,0)
 .S DG20NAME=$$FORMAT^XLFNAME7(DG20NAME,1,35,,3,,1,1)
"RTN","DPTNAME",55,0)
 .I '$L(DG20NAME) W "  ??",$C(7) G ASK
"RTN","DPTNAME",56,0)
 .W:DG20NAME'=X "   (",DG20NAME,")" S DG20NAME(DGCOMP)=DG20NAME
"RTN","DPTNAME",57,0)
 .S:DG20NAME(DGCOMP)'=$G(DGX(DGCOMP)) DGEDIT=1
"RTN","DPTNAME",58,0)
 .Q
"RTN","DPTNAME",59,0)
 Q:'DGEDIT ""
"RTN","DPTNAME",60,0)
 Q:DGOUT&'DGCOUT ""
"RTN","DPTNAME",61,0)
 ;Reconstruct name
"RTN","DPTNAME",62,0)
 S DG20NAME=$$NAMEFMT^XLFNAME(.DG20NAME,"F","CFL30")
"RTN","DPTNAME",63,0)
 ;Format the .01 value
"RTN","DPTNAME",64,0)
 M DGY=DG20NAME
"RTN","DPTNAME",65,0)
 S DG20NAME=$$FORMAT^XLFNAME7(.DGY,3,30,,2)
"RTN","DPTNAME",66,0)
 ;Check the length
"RTN","DPTNAME",67,0)
 I $L(DG20NAME)<3 D  G START
"RTN","DPTNAME",68,0)
 .W !,"Invalid values to file, full name must be at least 3 characters!",$C(7)
"RTN","DPTNAME",69,0)
 .K DG20NAME,DGX,DGCOMP Q
"RTN","DPTNAME",70,0)
 ;File new name value
"RTN","DPTNAME",71,0)
CONF W !,"Ok to file '",DG20NAME,"' and its name components"
"RTN","DPTNAME",72,0)
 S %=1 D YN^DICN
"RTN","DPTNAME",73,0)
 I '% W !,"Indicate if the edits to the name and its components should be filed." G CONF
"RTN","DPTNAME",74,0)
 I %'=1 K DG20NAME S DG20NAME="" Q DG20NAME
"RTN","DPTNAME",75,0)
 I '$$CONF1(DG20NAME) K DG20NAME S DG20NAME=""
"RTN","DPTNAME",76,0)
 Q DG20NAME
"RTN","DPTNAME",77,0)
 ;
"RTN","DPTNAME",78,0)
CONF1(DPTX) ;Confirm if single name value is ok.
"RTN","DPTNAME",79,0)
 ;Input: DPTX=name value
"RTN","DPTNAME",80,0)
 N %
"RTN","DPTNAME",81,0)
 Q:$E($P(DPTX,",",2))?1U 1
"RTN","DPTNAME",82,0)
 W !!?5,$C(7),"WARNING: Do not enter single name values for patients (no given or"
"RTN","DPTNAME",83,0)
 W !?5,"         first name) unless this is actually their legal name!!!",$C(7)
"RTN","DPTNAME",84,0)
RC W !!,"Are you sure you want to enter the patient name in this manner"
"RTN","DPTNAME",85,0)
 S %=2 D YN^DICN S %=$S(%<0!(%=2):-1,%=1:1,1:0) I '% W !?6,"Specify 'YES' to enter a single name value, or 'NO' to discontinue." G RC
"RTN","DPTNAME",86,0)
 W !
"RTN","DPTNAME",87,0)
 Q %=1
"RTN","DPTNAME1")
0^4^B10381357
"RTN","DPTNAME1",1,0)
DPTNAME1 ;BPOIFO/KEITH - NAME STANDARDIZATION ; 12 Aug 2002@20:20
"RTN","DPTNAME1",2,0)
 ;;5.3;Registration;**244,620**;Aug 13, 1993
"RTN","DPTNAME1",3,0)
 ;
"RTN","DPTNAME1",4,0)
NCEVAL(DGC,DGX) ;Evaluate name component entry values
"RTN","DPTNAME1",5,0)
 ;Input: DGC=name component (e.g. FAMILY, GIVEN, etc.)
"RTN","DPTNAME1",6,0)
 ;       DGX=input value for name
"RTN","DPTNAME1",7,0)
 ;
"RTN","DPTNAME1",8,0)
 Q:DGX="@"
"RTN","DPTNAME1",9,0)
 N DGM,DGL,DGI
"RTN","DPTNAME1",10,0)
 I DGX=""!($E(DGX)=U) Q
"RTN","DPTNAME1",11,0)
 D CVALID(DGC,DGX,.DGM)
"RTN","DPTNAME1",12,0)
 M DIR("?")=DGM("HELP") S DGI=$O(DIR("?",""),-1) I DGI D
"RTN","DPTNAME1",13,0)
 .S DIR("?")=DIR("?",DGI) K DIR("?",DGI)
"RTN","DPTNAME1",14,0)
 .Q
"RTN","DPTNAME1",15,0)
 I "???"[DGX Q
"RTN","DPTNAME1",16,0)
 I DGM("RESULT")="" D  Q
"RTN","DPTNAME1",17,0)
 .S DGI="" F  S DGI=$O(DGM("ERROR",DGI)) Q:DGI=""  D
"RTN","DPTNAME1",18,0)
 ..I DGM("ERROR",DGI)["''" S $P(DGM("ERROR",DGI),"'",2)=DGX
"RTN","DPTNAME1",19,0)
 ..W:DGI=1 ! W !,DGM("ERROR",DGI)
"RTN","DPTNAME1",20,0)
 ..Q
"RTN","DPTNAME1",21,0)
 .K DGX
"RTN","DPTNAME1",22,0)
 .Q
"RTN","DPTNAME1",23,0)
 I DGM("RESULT")'=DGX W "   (",DGM("RESULT"),")"
"RTN","DPTNAME1",24,0)
 S DGX=DGM("RESULT")
"RTN","DPTNAME1",25,0)
 Q
"RTN","DPTNAME1",26,0)
 ;
"RTN","DPTNAME1",27,0)
FAMILY ;Family name help text
"RTN","DPTNAME1",28,0)
 S DGM("LENGTH")="1-35"
"RTN","DPTNAME1",29,0)
 D HTEXT("family (last) name.",DGM("LENGTH"))
"RTN","DPTNAME1",30,0)
 S DGM("HELP",4)="Input values less than 3 characters in length must be all alpha characters."
"RTN","DPTNAME1",31,0)
 Q
"RTN","DPTNAME1",32,0)
 ;
"RTN","DPTNAME1",33,0)
GIVEN ;Given name help text
"RTN","DPTNAME1",34,0)
 S DGM("LENGTH")="1-25"
"RTN","DPTNAME1",35,0)
 D HTEXT("given (first) name.",DGM("LENGTH"))
"RTN","DPTNAME1",36,0)
 Q
"RTN","DPTNAME1",37,0)
 ;
"RTN","DPTNAME1",38,0)
MIDDLE ;Middle name help text
"RTN","DPTNAME1",39,0)
 S DGM("LENGTH")="1-25"
"RTN","DPTNAME1",40,0)
 D HTEXT("middle name.",DGM("LENGTH"))
"RTN","DPTNAME1",41,0)
 S DGM("HELP",4)="Middle names of 'NMI' and 'NMN' are prohibited."
"RTN","DPTNAME1",42,0)
 Q
"RTN","DPTNAME1",43,0)
 ;
"RTN","DPTNAME1",44,0)
PREFIX ;Name prefix help text
"RTN","DPTNAME1",45,0)
 S DGM("LENGTH")="1-10"
"RTN","DPTNAME1",46,0)
 D HTEXT("name prefix, such as MR or MS.",DGM("LENGTH"))
"RTN","DPTNAME1",47,0)
 Q
"RTN","DPTNAME1",48,0)
 ;
"RTN","DPTNAME1",49,0)
SUFFIX ;Name suffix help text
"RTN","DPTNAME1",50,0)
 S DGM("LENGTH")="1-10"
"RTN","DPTNAME1",51,0)
 D HTEXT("suffix(es), such as JR, SR, II, or II.",DGM("LENGTH"))
"RTN","DPTNAME1",52,0)
 Q
"RTN","DPTNAME1",53,0)
 ;
"RTN","DPTNAME1",54,0)
DEGREE ;Name degree help text
"RTN","DPTNAME1",55,0)
 S DGM("LENGTH")="1-10"
"RTN","DPTNAME1",56,0)
 D HTEXT("academic degree, such as BS, BA, MD, or PHD.",DGM("LENGTH"))
"RTN","DPTNAME1",57,0)
 Q
"RTN","DPTNAME1",58,0)
 ;
"RTN","DPTNAME1",59,0)
CVALID(DGC,DGX,DGM) ;Name component validation
"RTN","DPTNAME1",60,0)
 ; Input: DGC=name component (e.g. FAMILY, GIVEN, etc.)
"RTN","DPTNAME1",61,0)
 ;        DGX=input value to validate
"RTN","DPTNAME1",62,0)
 ;        DGM=array to return results and errors (pass by reference)
"RTN","DPTNAME1",63,0)
 ;
"RTN","DPTNAME1",64,0)
 ;Output: DGM array in the format:
"RTN","DPTNAME1",65,0)
 ;       DGM("ERROR",n)=error text (if any) 
"RTN","DPTNAME1",66,0)
 ;       DGM("HELP",n)=help text          
"RTN","DPTNAME1",67,0)
 ;       DGM("LENGTH")=field length in length (e.g. 3-30) 
"RTN","DPTNAME1",68,0)
 ;       DGM("RESULT")=transformed name value (null if invalid entry)
"RTN","DPTNAME1",69,0)
 ; 
"RTN","DPTNAME1",70,0)
 N DGL,DGF,DGI,DGR,DGMSG
"RTN","DPTNAME1",71,0)
 S DGF="FAMILY^GIVEN^MIDDLE^PREFIX^SUFFIX^DEGREE"
"RTN","DPTNAME1",72,0)
 S DGF=$P(DGF,DGC),DGF=$L(DGF,U)
"RTN","DPTNAME1",73,0)
 D @DGC  ;Set up length and help text 
"RTN","DPTNAME1",74,0)
 S DGL=+$P(DGM("LENGTH"),"-")_U_+$P(DGM("LENGTH"),"-",2)
"RTN","DPTNAME1",75,0)
 D CVALID^XLFNAME8(DGC,DGX,.DGM)
"RTN","DPTNAME1",76,0)
 Q
"RTN","DPTNAME1",77,0)
 ;
"RTN","DPTNAME1",78,0)
HTEXT(DGF,DGL) ;Generic help text
"RTN","DPTNAME1",79,0)
 ;Input: DGF=field name
"RTN","DPTNAME1",80,0)
 ;       DGL=field length
"RTN","DPTNAME1",81,0)
 S DGM("HELP",1)="Answer with this persons "_DGF
"RTN","DPTNAME1",82,0)
 S DGM("HELP",2)="The response must be "_DGL_" characters in length and may only contain"
"RTN","DPTNAME1",83,0)
 S DGM("HELP",3)="uppercase alpha characters, spaces, hyphens and apostrophes."
"RTN","DPTNAME1",84,0)
 Q
"RTN","DPTNAME1",85,0)
 ;
"RTN","DPTNAME1",86,0)
JUMP(DGI) ;Evaluate request to jump fields
"RTN","DPTNAME1",87,0)
 N DGX,DGY S DGX=$P($E(X,2,99)," ")
"RTN","DPTNAME1",88,0)
 I (U_DGCOM)'[(U_DGX) D  Q
"RTN","DPTNAME1",89,0)
 .W !,"While editing name components, only jumping to other components is allowed!",$C(7)
"RTN","DPTNAME1",90,0)
 .Q
"RTN","DPTNAME1",91,0)
 I (U_DGCOM_U)[(U_DGX_U) S DGI=$O(DGC(DGX,0)) Q
"RTN","DPTNAME1",92,0)
 S DGI=$O(DGC($O(DGC(DGX)),0))
"RTN","DPTNAME1",93,0)
 S DGY=$P(DGCOM,U,DGI)_$P(DGCX,U,DGI) W $P(DGY,DGX,2)
"RTN","DPTNAME1",94,0)
 Q
"RTN","DPTNAME1",95,0)
 ;
"RTN","VAFCEHU2")
0^9^B58838899
"RTN","VAFCEHU2",1,0)
VAFCEHU2 ;ALB/JLU,LTL-UTILITIES FOR 391.98 AND 391.99 AND LIST MAN ;10/10/02  15:55
"RTN","VAFCEHU2",2,0)
 ;;5.3;Registration;**149,255,333,474,477,620**;Aug 13, 1993
"RTN","VAFCEHU2",3,0)
SORTS(SRT,ARY) ;
"RTN","VAFCEHU2",4,0)
 ;this tag will sort the exceptions in different formats depending on
"RTN","VAFCEHU2",5,0)
 ;what the user has selected.
"RTN","VAFCEHU2",6,0)
 ;
"RTN","VAFCEHU2",7,0)
 ;INPUTS - SRT this variable contains what sort is requested from the
"RTN","VAFCEHU2",8,0)
 ;list man patient review screen.
"RTN","VAFCEHU2",9,0)
 ; Ex.  SP  sort by patient
"RTN","VAFCEHU2",10,0)
 ;      SS  sort by site
"RTN","VAFCEHU2",11,0)
 ;      SO  sort by oldest event
"RTN","VAFCEHU2",12,0)
 ;      SN  sort by newest event
"RTN","VAFCEHU2",13,0)
 ;ARY - the array the calling program wants the info returned in.
"RTN","VAFCEHU2",14,0)
 ;
"RTN","VAFCEHU2",15,0)
 ;OUTPUT
"RTN","VAFCEHU2",16,0)
 ;a populated array that was passed in by the user.  The array is in
"RTN","VAFCEHU2",17,0)
 ;the structure xxx(#,0)=value
"RTN","VAFCEHU2",18,0)
 ;
"RTN","VAFCEHU2",19,0)
 S VAR=SRT_"(ARY)"
"RTN","VAFCEHU2",20,0)
 D @VAR
"RTN","VAFCEHU2",21,0)
 Q
"RTN","VAFCEHU2",22,0)
 ;
"RTN","VAFCEHU2",23,0)
SP(ARY) ;sort by patient
"RTN","VAFCEHU2",24,0)
 N LP,LP1,CTR
"RTN","VAFCEHU2",25,0)
 S LP=""
"RTN","VAFCEHU2",26,0)
 S CTR=1
"RTN","VAFCEHU2",27,0)
 F  S LP=$O(^DGCN(391.98,"C",LP)) Q:LP=""  F LP1=0:0 S LP1=$O(^DGCN(391.98,"C",LP,LP1)) Q:LP1=""  D BLD(LP1,ARY,.CTR)
"RTN","VAFCEHU2",28,0)
 Q
"RTN","VAFCEHU2",29,0)
 ;
"RTN","VAFCEHU2",30,0)
SS(ARY) ;sort by site
"RTN","VAFCEHU2",31,0)
 N LP,LP1,CTR
"RTN","VAFCEHU2",32,0)
 S LP=""
"RTN","VAFCEHU2",33,0)
 S CTR=1
"RTN","VAFCEHU2",34,0)
 F  S LP=$O(^DGCN(391.98,"FRM",LP)) Q:LP=""  F LP1=0:0 S LP1=$O(^DGCN(391.98,"FRM",LP,LP1)) Q:LP1=""  D BLD(LP1,ARY,.CTR)
"RTN","VAFCEHU2",35,0)
 Q
"RTN","VAFCEHU2",36,0)
 ;
"RTN","VAFCEHU2",37,0)
SO(ARY) ;sort by oldest event
"RTN","VAFCEHU2",38,0)
 N LP,LP1,CTR
"RTN","VAFCEHU2",39,0)
 S LP=""
"RTN","VAFCEHU2",40,0)
 S CTR=1
"RTN","VAFCEHU2",41,0)
 F  S LP=$O(^DGCN(391.98,"EVT",LP)) Q:LP=""  F LP1=0:0 S LP1=$O(^DGCN(391.98,"EVT",LP,LP1)) Q:LP1=""  D BLD(LP1,ARY,.CTR)
"RTN","VAFCEHU2",42,0)
 Q
"RTN","VAFCEHU2",43,0)
 ;
"RTN","VAFCEHU2",44,0)
SN(ARY) ;sort by newest event
"RTN","VAFCEHU2",45,0)
 N LP,LP1,CTR
"RTN","VAFCEHU2",46,0)
 S LP=999999999999
"RTN","VAFCEHU2",47,0)
 S CTR=1
"RTN","VAFCEHU2",48,0)
 F  S LP=$O(^DGCN(391.98,"EVT",LP),-1) Q:LP=""  F LP1=999999999999:0 S LP1=$O(^DGCN(391.98,"EVT",LP,LP1),-1) Q:LP1=""  D BLD(LP1,ARY,.CTR)
"RTN","VAFCEHU2",49,0)
 Q
"RTN","VAFCEHU2",50,0)
 ;
"RTN","VAFCEHU2",51,0)
BLD(LP1,ARY,CTR) ;this is the actual building subroutine.  the array that is
"RTN","VAFCEHU2",52,0)
 ;return is var(#,0)=value starting at 1.
"RTN","VAFCEHU2",53,0)
 ;
"RTN","VAFCEHU2",54,0)
 N DATA,STAT,PAT,XX
"RTN","VAFCEHU2",55,0)
 ;getting the exception
"RTN","VAFCEHU2",56,0)
 S DATA=$G(^DGCN(391.98,LP1,0))
"RTN","VAFCEHU2",57,0)
 Q:DATA']""
"RTN","VAFCEHU2",58,0)
 ;checking for the status
"RTN","VAFCEHU2",59,0)
 ;Q:$P(DATA,U,4)']"" ;**333
"RTN","VAFCEHU2",60,0)
 I $P(DATA,U,4)']"" S XX=$$EDIT^VAFCEHU1(LP1,"RETIRED DATA") Q  ;**333 retire
"RTN","VAFCEHU2",61,0)
 ;getting the status node from 391.984
"RTN","VAFCEHU2",62,0)
 S STAT=$G(^DGCN(391.984,$P(DATA,U,4),0))
"RTN","VAFCEHU2",63,0)
 ;if retired skip
"RTN","VAFCEHU2",64,0)
 I "RETIRED DATA"=$P(STAT,U,1) Q
"RTN","VAFCEHU2",65,0)
 ;if rejected skip
"RTN","VAFCEHU2",66,0)
 I "DATA REJECTED"=$P(STAT,U,1) Q
"RTN","VAFCEHU2",67,0)
 ;if merge complete
"RTN","VAFCEHU2",68,0)
 I "MERGE COMPLETE"=$P(STAT,U,1) Q
"RTN","VAFCEHU2",69,0)
 ;get patient file zero node
"RTN","VAFCEHU2",70,0)
 S PAT=$G(^DPT($P(DATA,U,1),0))
"RTN","VAFCEHU2",71,0)
 ;Q:PAT']"" ;**333
"RTN","VAFCEHU2",72,0)
 I $S(PAT']"":1,$$IFLOCAL^MPIF001(+$P(DATA,U,1)):1,$$IFVCCI^MPIF001(+$P(DATA,U,1))=-1:1,1:0) S XX=$$EDIT^VAFCEHU1(LP1,"RETIRED DATA") Q  ;**333 retire if a local, you're not the cmor or no cmor
"RTN","VAFCEHU2",73,0)
 S @ARY@(CTR,0)=$P(PAT,U,1)_U_$P(PAT,U,9)_U_$P(PAT,U,3)_U_$P(STAT,U,2)_U_$P(DATA,U,3)_U_$G(^DGCN(391.98,LP1,"FRM"))
"RTN","VAFCEHU2",74,0)
 S @ARY@(CTR,"VAFC")=LP1
"RTN","VAFCEHU2",75,0)
 S CTR=CTR+1
"RTN","VAFCEHU2",76,0)
 Q
"RTN","VAFCEHU2",77,0)
 ;
"RTN","VAFCEHU2",78,0)
FORMAT(ARY,VALMCNT,VALMQUIT) ;this subroutines formats the array in ARY
"RTN","VAFCEHU2",79,0)
 ;from file 391.98 for display by the list manager.  It accepts the
"RTN","VAFCEHU2",80,0)
 ;array name as its input in ARY.
"RTN","VAFCEHU2",81,0)
 ;VALMCNT and VALMQUIT are passed by reference
"RTN","VAFCEHU2",82,0)
 ;VALMCNT will be the total number of entries
"RTN","VAFCEHU2",83,0)
 ;VALMQUIT tells list man to quit if something when wrong.
"RTN","VAFCEHU2",84,0)
 ;
"RTN","VAFCEHU2",85,0)
 N CTR,STR,LP
"RTN","VAFCEHU2",86,0)
 S CTR=1
"RTN","VAFCEHU2",87,0)
 F LP=0:0 S LP=$O(@ARY@(LP)) Q:'LP  S STR=$G(@ARY@(LP,0)) I STR]"" DO
"RTN","VAFCEHU2",88,0)
 .N X,DATE
"RTN","VAFCEHU2",89,0)
 .S X=$$SETSTR^VALM1(CTR,"",1,4)
"RTN","VAFCEHU2",90,0)
 .S X=$$SETSTR^VALM1($E($P(STR,U,1),1,23),X,5,23)
"RTN","VAFCEHU2",91,0)
 .S X=$$SETSTR^VALM1($P(STR,U,2),X,29,9)
"RTN","VAFCEHU2",92,0)
 .S DATE=$$IN2EXDT^VAFCMGU0($P(STR,U,3))
"RTN","VAFCEHU2",93,0)
 .S X=$$SETSTR^VALM1(DATE,X,40,10)
"RTN","VAFCEHU2",94,0)
 .S X=$$SETSTR^VALM1($P(STR,U,4),X,51,2)
"RTN","VAFCEHU2",95,0)
 .S DATE=$$IN2EXDT^VAFCMGU0($P(STR,U,5))
"RTN","VAFCEHU2",96,0)
 .S X=$$SETSTR^VALM1(DATE,X,55,10)
"RTN","VAFCEHU2",97,0)
 .S X=$$SETSTR^VALM1($P(STR,U,6),X,67,$L($P(STR,U,6)))
"RTN","VAFCEHU2",98,0)
 .S @ARY@(LP,0)=X
"RTN","VAFCEHU2",99,0)
 .S @ARY@("IDX",CTR,CTR)=""
"RTN","VAFCEHU2",100,0)
 .S CTR=CTR+1
"RTN","VAFCEHU2",101,0)
 .Q
"RTN","VAFCEHU2",102,0)
 S VALMCNT=CTR-1
"RTN","VAFCEHU2",103,0)
 I CTR=1 DO
"RTN","VAFCEHU2",104,0)
 .S @ARY@(1,0)=""
"RTN","VAFCEHU2",105,0)
 .S @ARY@(2,0)="There are no exceptions on file to review."
"RTN","VAFCEHU2",106,0)
 .S VALMCNT=2
"RTN","VAFCEHU2",107,0)
 .Q
"RTN","VAFCEHU2",108,0)
 Q
"RTN","VAFCEHU2",109,0)
 ;
"RTN","VAFCEHU2",110,0)
FRMDATA(IEN,ARY) ;
"RTN","VAFCEHU2",111,0)
 ;This entry point will return all the data related to a given exception
"RTN","VAFCEHU2",112,0)
 ;INPUTS
"RTN","VAFCEHU2",113,0)
 ;  IEN - The IEN of the exception to be extracted.
"RTN","VAFCEHU2",114,0)
 ;  ARY - The array that the user wishes the information returned in.
"RTN","VAFCEHU2",115,0)
 ;        This array can be either local or global.
"RTN","VAFCEHU2",116,0)
 ;  Ex.   ^TMP("TEST",$J)
"RTN","VAFCEHU2",117,0)
 ;        If and array is not passed then a default global array will
"RTN","VAFCEHU2",118,0)
 ;        be used.  ^TMP($J,"VAFC-MRG","DATA")
"RTN","VAFCEHU2",119,0)
 ;OUTPUTS
"RTN","VAFCEHU2",120,0)
 ;  1 if the look up and retreival were successful
"RTN","VAFCEHU2",121,0)
 ;  0^description if they were not.
"RTN","VAFCEHU2",122,0)
 ;
"RTN","VAFCEHU2",123,0)
 N ERR,LP,DATA
"RTN","VAFCEHU2",124,0)
 I '$D(IEN) S ERR="0^Parameter not defined." G FRMQ
"RTN","VAFCEHU2",125,0)
 I IEN']"" S ERR="0^Exception not defined." G FRMQ
"RTN","VAFCEHU2",126,0)
 I '$D(^DGCN(391.98,IEN,0)) S ERR="0^Exception not in file." G FRMQ
"RTN","VAFCEHU2",127,0)
 I '$D(^DGCN(391.99,"B",IEN)) S ERR="0^Data for exception not defined." G FRMQ
"RTN","VAFCEHU2",128,0)
 I '$D(ARY) S ARY="^TMP($J,""VAFC-MRG"",""DATA"")"
"RTN","VAFCEHU2",129,0)
 I ARY']"" S ARY="^TMP($J,""VAFC-MRG"",""DATA"")"
"RTN","VAFCEHU2",130,0)
 S LP=""
"RTN","VAFCEHU2",131,0)
 F  S LP=$O(^DGCN(391.99,"B",IEN,LP)) Q:'LP  DO
"RTN","VAFCEHU2",132,0)
 . S DATA=$G(^DGCN(391.99,LP,0))
"RTN","VAFCEHU2",133,0)
 . Q:'DATA
"RTN","VAFCEHU2",134,0)
 . I $P(DATA,U,2)=""!($P(DATA,U,3)="") Q  ;**477
"RTN","VAFCEHU2",135,0)
 . I $S($P(DATA,U,3)=.211:1,$P(DATA,U,3)=.2403:1,1:0) D  ;**477 standardize mmn and nok for old pdr entries
"RTN","VAFCEHU2",136,0)
 . . N DGNAME S DGNAME=$G(^DGCN(391.99,LP,"VAL")) I $S(DGNAME="":0,DGNAME["@":0,1:1) D
"RTN","VAFCEHU2",137,0)
 . . . I $P(DATA,U,3)=.211 D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^XLFNAME7(.DGNAME,3,35) I DGNAME="" Q
"RTN","VAFCEHU2",138,0)
 . . . I $P(DATA,U,3)=.2403 D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^XLFNAME7(.DGNAME,3,35,,2,,1) I DGNAME="" Q
"RTN","VAFCEHU2",139,0)
 . . . D UPD(LP,50,DGNAME)
"RTN","VAFCEHU2",140,0)
 . I $P(DATA,U,3)=.05,($G(^DGCN(391.99,LP,"VAL"))="N") D UPD(LP,50,"NEVER MARRIED"),UPD(LP,.06,"@") S $P(DATA,"^",6)="" ;**477 translate marital status from 'n' to 'never married' and remove unresolved flag
"RTN","VAFCEHU2",141,0)
 . ;
"RTN","VAFCEHU2",142,0)
 . S @ARY@($P(DATA,U,2),$P(DATA,U,3))=$G(^DGCN(391.99,LP,"VAL"))_U_$P(DATA,U,5)_U_$P(DATA,U,6)
"RTN","VAFCEHU2",143,0)
 . Q
"RTN","VAFCEHU2",144,0)
 I $D(@ARY)>9 S ERR=1
"RTN","VAFCEHU2",145,0)
 E  S ERR="0^No elments found."
"RTN","VAFCEHU2",146,0)
 ;
"RTN","VAFCEHU2",147,0)
FRMQ Q ERR
"RTN","VAFCEHU2",148,0)
 ;
"RTN","VAFCEHU2",149,0)
REVFUL ;this entry point is to process the user selection from the summary
"RTN","VAFCEHU2",150,0)
 ;screen of the exception handler.
"RTN","VAFCEHU2",151,0)
 ;the variable VALMAR is expected.  This contains the array that is
"RTN","VAFCEHU2",152,0)
 ;being used as part of list manager
"RTN","VAFCEHU2",153,0)
 ;
"RTN","VAFCEHU2",154,0)
 ;variable collision during VAFCMG01 processing, changed ien to ienpdr ;**477
"RTN","VAFCEHU2",155,0)
 ;
"RTN","VAFCEHU2",156,0)
 S VALM("ENTITY")="Patient"
"RTN","VAFCEHU2",157,0)
 D EN^VALM2(XQORNOD(0))
"RTN","VAFCEHU2",158,0)
 I '$D(VALMY) G FULQ
"RTN","VAFCEHU2",159,0)
 N LP,RES
"RTN","VAFCEHU2",160,0)
 F LP=0:0 S LP=$O(VALMY(LP)) Q:'LP  DO  Q:RES<-9
"RTN","VAFCEHU2",161,0)
 .N IENPDR,LCK,MSG,EXCPT,FRM,STR,STAT,EDT,ARY
"RTN","VAFCEHU2",162,0)
 .S RES=0
"RTN","VAFCEHU2",163,0)
 .S IENPDR=$O(@VALMAR@("IDX",LP,0))
"RTN","VAFCEHU2",164,0)
 .Q:'IENPDR
"RTN","VAFCEHU2",165,0)
 .S IENPDR=$G(@VALMAR@(IENPDR,"VAFC"))
"RTN","VAFCEHU2",166,0)
 .Q:'IENPDR
"RTN","VAFCEHU2",167,0)
 .S LCK=$$LOCK^VAFCEHU1(IENPDR)
"RTN","VAFCEHU2",168,0)
 .I 'LCK DO  Q
"RTN","VAFCEHU2",169,0)
 ..N PAT
"RTN","VAFCEHU2",170,0)
 ..S PAT=$E(@VALMAR@(LP,0),4,27)
"RTN","VAFCEHU2",171,0)
 ..D FULL^VALM1
"RTN","VAFCEHU2",172,0)
 ..W $C(7)
"RTN","VAFCEHU2",173,0)
 ..W !!,"The status for ",PAT," is ",$P(LCK,U,2)
"RTN","VAFCEHU2",174,0)
 ..W !,"Review or merging of this data is not allowed at this time."
"RTN","VAFCEHU2",175,0)
 ..D PAUSE^VALM1
"RTN","VAFCEHU2",176,0)
 ..Q
"RTN","VAFCEHU2",177,0)
 .S EXCPT=$G(^DGCN(391.98,IENPDR,0))
"RTN","VAFCEHU2",178,0)
 .S FRM=$G(^DGCN(391.98,IENPDR,"FRM"))
"RTN","VAFCEHU2",179,0)
 .I 'EXCPT!(FRM']"") Q
"RTN","VAFCEHU2",180,0)
 .S ARY="^TMP($J,""VAFC-MRG"",""DATA"")"
"RTN","VAFCEHU2",181,0)
 .S STR=$$FRMDATA(IENPDR,ARY)
"RTN","VAFCEHU2",182,0)
 .Q:'STR
"RTN","VAFCEHU2",183,0)
 .S RES=$$EN^VAFCMG01($P(EXCPT,U,1),ARY,FRM,$P(EXCPT,U,3))
"RTN","VAFCEHU2",184,0)
 .S STAT=$S(RES>11:"DR",RES>9:"MC",RES<2:"DE",1:"AR")
"RTN","VAFCEHU2",185,0)
 .S EDT=$$EDIT^VAFCEHU1(IENPDR,STAT)
"RTN","VAFCEHU2",186,0)
 .I RES=10!(RES=11) D WHO(IENPDR,DUZ,"NOW")
"RTN","VAFCEHU2",187,0)
 .L -^DGCN(391.98,IENPDR) ;**255
"RTN","VAFCEHU2",188,0)
 .Q
"RTN","VAFCEHU2",189,0)
 D INIT2^VAFCEHLM
"RTN","VAFCEHU2",190,0)
 ;
"RTN","VAFCEHU2",191,0)
FULQ Q
"RTN","VAFCEHU2",192,0)
 ;
"RTN","VAFCEHU2",193,0)
WHO(IEN,WHO,WHEN) ;this entry point updates the exceptions as to who
"RTN","VAFCEHU2",194,0)
 ;made this update and when.
"RTN","VAFCEHU2",195,0)
 ;
"RTN","VAFCEHU2",196,0)
 S DIE="^DGCN(391.98,"
"RTN","VAFCEHU2",197,0)
 S DA=IEN
"RTN","VAFCEHU2",198,0)
 S DR="12////"_DUZ_";11///"_WHEN
"RTN","VAFCEHU2",199,0)
 D ^DIE
"RTN","VAFCEHU2",200,0)
 Q
"RTN","VAFCEHU2",201,0)
 ;
"RTN","VAFCEHU2",202,0)
RETPDR(DFN,STAIEN) ;retire site's PDRs 'awaiting review' for patient ;**474
"RTN","VAFCEHU2",203,0)
 ;INPUT    DFN - ien of the patient
"RTN","VAFCEHU2",204,0)
 ;      STAIEN - ien of the institution
"RTN","VAFCEHU2",205,0)
 ;
"RTN","VAFCEHU2",206,0)
 N DAT,IEN,NAM,PDRIEN,STANAM,VAFCINST
"RTN","VAFCEHU2",207,0)
 I 'DFN!'STAIEN Q
"RTN","VAFCEHU2",208,0)
 D GETS^DIQ(4,STAIEN_",",".01;999.1*",,"VAFCINST") ;retrieve current name and name history
"RTN","VAFCEHU2",209,0)
 S NAM=$G(VAFCINST(4,STAIEN_",",.01)) I NAM'="" S STANAM(NAM)="" ;get current name
"RTN","VAFCEHU2",210,0)
 S IEN="" F  S IEN=$O(VAFCINST(4.999,IEN)) Q:IEN=""  S NAM=$G(VAFCINST(4.999,IEN,.02)) I NAM'="" S STANAM(NAM)="" ;get name history in case site name change
"RTN","VAFCEHU2",211,0)
 S NAM="" F  S NAM=$O(STANAM(NAM)) Q:NAM=""  D  ;loop through array of names
"RTN","VAFCEHU2",212,0)
 . S DAT=0 F  S DAT=$O(^DGCN(391.98,"AKY",DFN,NAM,DAT)) Q:DAT=""  D  ;loop through site's pdrs for patient
"RTN","VAFCEHU2",213,0)
 . . S PDRIEN="" F  S PDRIEN=$O(^DGCN(391.98,"AKY",DFN,NAM,DAT,PDRIEN)) Q:'PDRIEN  I $P($G(^DGCN(391.98,PDRIEN,0)),"^",4)=1 S XX=$$EDIT^VAFCEHU1(PDRIEN,"RETIRED DATA") ;retire pdr's awaiting review
"RTN","VAFCEHU2",214,0)
 Q
"RTN","VAFCEHU2",215,0)
 ;
"RTN","VAFCEHU2",216,0)
UPD(DA,FLD,VAL) ;update value ;**477
"RTN","VAFCEHU2",217,0)
 L +^DGCN(391.99,DA,0):10
"RTN","VAFCEHU2",218,0)
 S DIE="^DGCN(391.99,"
"RTN","VAFCEHU2",219,0)
 S DR=FLD_"///^S X=VAL"
"RTN","VAFCEHU2",220,0)
 D ^DIE K DIE,DR
"RTN","VAFCEHU2",221,0)
 L -^DGCN(391.99,DA,0)
"RTN","VAFCEHU2",222,0)
 Q
"RTN","VAFCEHU3")
0^10^B18681050
"RTN","VAFCEHU3",1,0)
VAFCEHU3 ;BIR/LTL,PTD-File utilities for 391.98 ;10/23/02
"RTN","VAFCEHU3",2,0)
 ;;5.3;Registration;**149,295,384,474,477,479,620**;Aug 13, 1993
"RTN","VAFCEHU3",3,0)
 ;
"RTN","VAFCEHU3",4,0)
 ;Check for select fields that if edited can update without review
"RTN","VAFCEHU3",5,0)
EN ;
"RTN","VAFCEHU3",6,0)
 N VAFC,VAFCE,VAFCF S VAFCF=1
"RTN","VAFCEHU3",7,0)
 ;Save the array so a new one can be built for edit
"RTN","VAFCEHU3",8,0)
 M VAFC=@VAFCB K @VAFCB
"RTN","VAFCEHU3",9,0)
 F  S VAFCE=$P(VAFC(2,"FLD"),";",VAFCF) Q:'VAFCE  S VAFCF=VAFCF+1 D
"RTN","VAFCEHU3",10,0)
 .Q:(VAFCE>.01&(VAFCE<.111))!(VAFCE>.219)
"RTN","VAFCEHU3",11,0)
 .S @VAFCB@(2,VAFCE)=VAFC(2,VAFCE)
"RTN","VAFCEHU3",12,0)
 ;save the sending site's station number
"RTN","VAFCEHU3",13,0)
 I $D(VAFC(2,"SENDING SITE")) S @VAFCB@(2,"SENDING SITE")=VAFC(2,"SENDING SITE")
"RTN","VAFCEHU3",14,0)
ED ;D:$D(VAFCB) EDIT^VAFCPTED(PAT,VAFCB_"(2)",".01") ;**295 auto-updated fields - removed .111;.112;.113;.114;.115;.1112;.117;.131;.132;.211;.219 ;**474 stop all auto-updates
"RTN","VAFCEHU3",15,0)
 ;restore the array for possible exceptions
"RTN","VAFCEHU3",16,0)
 M @VAFCB=VAFC
"RTN","VAFCEHU3",17,0)
CH ;Any differences?
"RTN","VAFCEHU3",18,0)
 N DFN,DGNAME ;**295,**384
"RTN","VAFCEHU3",19,0)
 S DFN=PAT,VAFCQ=0,VAFCF=@VAFCB@(2,"FLD") D DEM^VADPT
"RTN","VAFCEHU3",20,0)
 ;reformat problem data
"RTN","VAFCEHU3",21,0)
 I @VAFCB@(2,.05)="N" S @VAFCB@(2,.05)="NEVER MARRIED" ;**477
"RTN","VAFCEHU3",22,0)
 ;If not null and different or null and edited and different,
"RTN","VAFCEHU3",23,0)
 ;we got an exception, we're out of here
"RTN","VAFCEHU3",24,0)
 ;NAME - .01 - VADM(1)
"RTN","VAFCEHU3",25,0)
 I '$$COMP^VAFCUTL(VADM(1),@VAFCB@(2,.01)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",26,0)
 ;SEX - .02 - VADM(5)
"RTN","VAFCEHU3",27,0)
 I (@VAFCB@(2,.02)'[U)&(($P(VADM(5),U,2)'=@VAFCB@(2,.02))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",28,0)
 ;DOB - .03 - VADM(3)
"RTN","VAFCEHU3",29,0)
 I (@VAFCB@(2,.03)'=$P(VADM(3),U)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",30,0)
 ;MARITAL STATUS - .05 - VADM(10)
"RTN","VAFCEHU3",31,0)
 I (@VAFCB@(2,.05)'="""@"""),($P(VADM(10),U,2)'=@VAFCB@(2,.05)),(@VAFCB@(2,.05)'[U) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",32,0)
 ;RELIGION - .08 - VADM(9)
"RTN","VAFCEHU3",33,0)
 I (@VAFCB@(2,.08)'[U),($P(VADM(9),U,2)'=@VAFCB@(2,.08)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",34,0)
 ;SSN - .09 - VADM(2)
"RTN","VAFCEHU3",35,0)
 I (@VAFCB@(2,.09)'=$P(VADM(2),U)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",36,0)
 ;get some address stuff
"RTN","VAFCEHU3",37,0)
 D ADD^VADPT
"RTN","VAFCEHU3",38,0)
 ;STREET ADDRESS [1] - .111 - VAPA(1)
"RTN","VAFCEHU3",39,0)
 ;I (@VAFCB@(2,.111)'="""@"""),'$$COMP^VAFCUTL(@VAFCB@(2,.111),VAPA(1)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",40,0)
 ;STREET ADDRESS [2] - .112 - VAPA(2)
"RTN","VAFCEHU3",41,0)
 ;I (@VAFCB@(2,.112)'="""@"""),'$$COMP^VAFCUTL(@VAFCB@(2,.112),VAPA(2)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",42,0)
 ;STREET ADDRESS [3] - .113 - VAPA(3)
"RTN","VAFCEHU3",43,0)
 ;I (@VAFCB@(2,.113)'="""@"""),'$$COMP^VAFCUTL(@VAFCB@(2,.113),VAPA(3)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",44,0)
 ;CITY - .114 - VAPA(4)
"RTN","VAFCEHU3",45,0)
 ;I (@VAFCB@(2,.114)'="""@"""),'$$COMP^VAFCUTL(VAPA(4),@VAFCB@(2,.114)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",46,0)
 ;STATE - .115 - VAPA(5)
"RTN","VAFCEHU3",47,0)
 ;I (@VAFCB@(2,.115)'="""@"""),($P(VAPA(5),U,2)'=@VAFCB@(2,.115)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",48,0)
 ;ZIP+4 - .1112 - VAPA(11)
"RTN","VAFCEHU3",49,0)
 ;I (@VAFCB@(2,.1112)'="""@"""),(@VAFCB@(2,.1112)'=$P(VAPA(11),U,2)) S VAFCQ=1 G CHQ ;**477 added u,2) ;**479
"RTN","VAFCEHU3",50,0)
 ;COUNTY CODE - .117 - VAPA(7)
"RTN","VAFCEHU3",51,0)
 ;I @VAFCB@(2,.117),(@VAFCB@(2,.117)'=$P(VAPA(7),U)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",52,0)
 ;PHONE HOME - .131 - VAPA(8)
"RTN","VAFCEHU3",53,0)
 I (@VAFCB@(2,.131)'="""@"""),'$$COMP^VAFCUTL($$HLPHONE^HLFNC(VAPA(8)),$$HLPHONE^HLFNC(@VAFCB@(2,.131))) S VAFCQ=1 G CHQ ;**384
"RTN","VAFCEHU3",54,0)
 ;Get the rest
"RTN","VAFCEHU3",55,0)
 D GETS^DIQ(2,DFN_",",".132;.211;.219;.2403;.301;.302;.31115;.323;.361;391;1901","","VAPA")
"RTN","VAFCEHU3",56,0)
 ;PHONE WORK - .132 - VAPA(2,DFN,.132)
"RTN","VAFCEHU3",57,0)
 I (@VAFCB@(2,.132)'="""@"""),'$$COMP^VAFCUTL($$HLPHONE^HLFNC(VAPA(2,DFN_",",.132)),$$HLPHONE^HLFNC(@VAFCB@(2,.132))) S VAFCQ=1 G CHQ ;**384
"RTN","VAFCEHU3",58,0)
 ;K-NAME - .211 - VAPA(2,DFN,.211)
"RTN","VAFCEHU3",59,0)
 I $S(VAPA(2,DFN_",",.211)="":0,1:1) S DGNAME=VAPA(2,DFN_",",.211) D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^XLFNAME7(.DGNAME,3,35),VAPA(2,DFN_",",.211)=DGNAME ;**384 **477
"RTN","VAFCEHU3",60,0)
 I $S(@VAFCB@(2,.211)="":0,@VAFCB@(2,.211)["@":0,1:1) S DGNAME=@VAFCB@(2,.211) D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^XLFNAME7(.DGNAME,3,35),@VAFCB@(2,.211)=DGNAME ;**384 **477
"RTN","VAFCEHU3",61,0)
 I (@VAFCB@(2,.211)'="""@"""),'$$COMP^VAFCUTL(VAPA(2,DFN_",",.211),@VAFCB@(2,.211)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",62,0)
 ;K-PHONE - .219 - VAPA(2,DFN,.219)
"RTN","VAFCEHU3",63,0)
 I (@VAFCB@(2,.219)'="""@"""),'$$COMP^VAFCUTL($$HLPHONE^HLFNC(VAPA(2,DFN_",",.219)),$$HLPHONE^HLFNC(@VAFCB@(2,.219))) S VAFCQ=1 G CHQ ;**384
"RTN","VAFCEHU3",64,0)
 ;MOTHER'S MAIDEN NAME - .2403 - VAPA(2,DFN,.2403)
"RTN","VAFCEHU3",65,0)
 I $S(VAPA(2,DFN_",",.2403)="":0,1:1) S DGNAME=VAPA(2,DFN_",",.2403) D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^XLFNAME7(.DGNAME,3,35,,2,,1),VAPA(2,DFN_",",.2403)=DGNAME ;**384 **477
"RTN","VAFCEHU3",66,0)
 I $S(@VAFCB@(2,.2403)="":0,@VAFCB@(2,.2403)["@":0,1:1) S DGNAME=@VAFCB@(2,.2403) D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^XLFNAME7(.DGNAME,3,35,,2,,1),@VAFCB@(2,.2403)=DGNAME ;**384 **477
"RTN","VAFCEHU3",67,0)
 I ((@VAFCB@(2,.2403)'="""@""")&('$$COMP^VAFCUTL(VAPA(2,DFN_",",.2403),@VAFCB@(2,.2403))))!((@VAFCB@(2,.2403)="""@""")&((VAFCF[".2403;"))&((VAPA(2,DFN_",",.2403)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",68,0)
 ;SERVICE CONNECTED - .301 - VAPA(2,DFN,.301)
"RTN","VAFCEHU3",69,0)
 ;I ((@VAFCB@(2,.301)'="""@""")&((VAPA(2,DFN_",",.301)'=@VAFCB@(2,.301))))!((@VAFCB@(2,.301)="""@""")&((VAFCF[".301;"))&((VAPA(2,DFN_",",.301)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",70,0)
 ;SC% - .302 - VAPA(2,DFN,.302)
"RTN","VAFCEHU3",71,0)
 ;I (@VAFCB@(2,.302)&((VAPA(2,DFN_",",.302)'=@VAFCB@(2,.302))))!((@VAFCB@(2,.302)="""@""")&((VAFCF[".302;"))&((VAPA(2,DFN_",",.302)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",72,0)
 ;EMPLOYMENT STATUS - .31115 - VAPA(2,DFN,.31115)
"RTN","VAFCEHU3",73,0)
 I ((@VAFCB@(2,.31115)'="""@""")&((VAPA(2,DFN_",",.31115)'=@VAFCB@(2,.31115))))!((@VAFCB@(2,.31115)="""@""")&((VAFCF[".31115;"))&((VAPA(2,DFN_",",.31115)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",74,0)
 ;PERIOD OF SERVICE - .323 - VAPA(2,DFN,.323)
"RTN","VAFCEHU3",75,0)
 ;I ((@VAFCB@(2,.323)'="""@""")&((VAPA(2,DFN_",",.323)'=@VAFCB@(2,.323))))!((@VAFCB@(2,.323)="""@""")&((VAFCF[".323;"))&((VAPA(2,DFN_",",.323)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",76,0)
 ;DATE OF DEATH - .351 - VAPA(2,DFN,.351)
"RTN","VAFCEHU3",77,0)
 S VAPA(2,DFN_",",.351)=$$GET1^DIQ(2,DFN_",",.351,"I")
"RTN","VAFCEHU3",78,0)
 I ((@VAFCB@(2,.351)'="""@""")&((@VAFCB@(2,.351)'=VAPA(2,DFN_",",.351))))!((@VAFCB@(2,.351)="""@""")&((VAFCF[".351"))&(VAPA(2,DFN_",",.351))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",79,0)
 ;PRIMARY ELIG CODE - .361 - VAPA(2,DFN,.361)
"RTN","VAFCEHU3",80,0)
 ;I (@VAFCB@(2,.361)]"")&(@VAFCB@(2,.361)'=VAPA(2,DFN_",",.361))!((@VAFCB@(2,.361)="")&((VAFCF[".361;"))&((@VAFCB@(2,.361)'=VAPA(2,DFN_",",.361)))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",81,0)
 ;PATIENT TYPE - 391 - VAPA(2,DFN,391)
"RTN","VAFCEHU3",82,0)
 ;I ((@VAFCB@(2,391)'="""@""")&(@VAFCB@(2,391)'=VAPA(2,DFN_",",391)))!((@VAFCB@(2,391)="""@""")&((VAFCF["391;"))&((VAPA(2,DFN_",",391)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",83,0)
 ;VETERAN (Y/N) - 1901 - VAPA(2,DFN,1901)
"RTN","VAFCEHU3",84,0)
 ;I ((@VAFCB@(2,1901)'="""@""")&(@VAFCB@(2,1901)'=VAPA(2,DFN_",",1901)))!((@VAFCB@(2,1901)="""@""")&((VAFCF["1901;"))&((VAPA(2,DFN_",",1901)]""))) S VAFCQ=1
"RTN","VAFCEHU3",85,0)
CHQ D:'$G(VAFCQ) EN^VAFCEHU4
"RTN","VAFCEHU3",86,0)
 D KVA^VADPT Q
"VER")
8.0^22
**END**
**END**
