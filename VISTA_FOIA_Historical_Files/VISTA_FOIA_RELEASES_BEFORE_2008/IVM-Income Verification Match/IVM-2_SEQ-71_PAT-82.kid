Released IVM*2*82 SEQ #71
Extracted from mail message
**KIDS**:IVM*2.0*82^

**INSTALL NAME**
IVM*2.0*82
"BLD",4934,0)
IVM*2.0*82^INCOME VERIFICATION MATCH^0^3030825^y
"BLD",4934,4,0)
^9.64PA^^
"BLD",4934,"KRN",0)
^9.67PA^8989.52^19
"BLD",4934,"KRN",.4,0)
.4
"BLD",4934,"KRN",.401,0)
.401
"BLD",4934,"KRN",.402,0)
.402
"BLD",4934,"KRN",.403,0)
.403
"BLD",4934,"KRN",.5,0)
.5
"BLD",4934,"KRN",.84,0)
.84
"BLD",4934,"KRN",3.6,0)
3.6
"BLD",4934,"KRN",3.8,0)
3.8
"BLD",4934,"KRN",9.2,0)
9.2
"BLD",4934,"KRN",9.8,0)
9.8
"BLD",4934,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",4934,"KRN",9.8,"NM",1,0)
IVMCMF^^0^B8636384
"BLD",4934,"KRN",9.8,"NM",2,0)
IVMCMF1^^0^B34696418
"BLD",4934,"KRN",9.8,"NM",3,0)
IVMCMFB^^0^B11964156
"BLD",4934,"KRN",9.8,"NM",4,0)
IVMPREC1^^0^B26530064
"BLD",4934,"KRN",9.8,"NM","B","IVMCMF",1)

"BLD",4934,"KRN",9.8,"NM","B","IVMCMF1",2)

"BLD",4934,"KRN",9.8,"NM","B","IVMCMFB",3)

"BLD",4934,"KRN",9.8,"NM","B","IVMPREC1",4)

"BLD",4934,"KRN",19,0)
19
"BLD",4934,"KRN",19.1,0)
19.1
"BLD",4934,"KRN",101,0)
101
"BLD",4934,"KRN",409.61,0)
409.61
"BLD",4934,"KRN",771,0)
771
"BLD",4934,"KRN",870,0)
870
"BLD",4934,"KRN",8989.51,0)
8989.51
"BLD",4934,"KRN",8989.52,0)
8989.52
"BLD",4934,"KRN",8994,0)
8994
"BLD",4934,"KRN","B",.4,.4)

"BLD",4934,"KRN","B",.401,.401)

"BLD",4934,"KRN","B",.402,.402)

"BLD",4934,"KRN","B",.403,.403)

"BLD",4934,"KRN","B",.5,.5)

"BLD",4934,"KRN","B",.84,.84)

"BLD",4934,"KRN","B",3.6,3.6)

"BLD",4934,"KRN","B",3.8,3.8)

"BLD",4934,"KRN","B",9.2,9.2)

"BLD",4934,"KRN","B",9.8,9.8)

"BLD",4934,"KRN","B",19,19)

"BLD",4934,"KRN","B",19.1,19.1)

"BLD",4934,"KRN","B",101,101)

"BLD",4934,"KRN","B",409.61,409.61)

"BLD",4934,"KRN","B",771,771)

"BLD",4934,"KRN","B",870,870)

"BLD",4934,"KRN","B",8989.51,8989.51)

"BLD",4934,"KRN","B",8989.52,8989.52)

"BLD",4934,"KRN","B",8994,8994)

"BLD",4934,"QUES",0)
^9.62^^
"BLD",4934,"REQB",0)
^9.611^2^2
"BLD",4934,"REQB",1,0)
IVM*2.0*72^2
"BLD",4934,"REQB",2,0)
IVM*2.0*71^2
"BLD",4934,"REQB","B","IVM*2.0*71",2)

"BLD",4934,"REQB","B","IVM*2.0*72",1)

"MBREQ")
0
"PKG",220,-1)
1^1
"PKG",220,0)
INCOME VERIFICATION MATCH^IVM^IVM Software for interface with the IVM Center
"PKG",220,20,0)
^9.402P^^
"PKG",220,22,0)
^9.49I^1^1
"PKG",220,22,1,0)
2.0^2941021
"PKG",220,22,1,"PAH",1,0)
82^3030825
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","IVMCMF")
0^1^B8636384
"RTN","IVMCMF",1,0)
IVMCMF ;ALB/RMM - INCOME TEST EDIT CHECK DRIVER ; 07/28/2003
"RTN","IVMCMF",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**71,82**;21-OCT-94
"RTN","IVMCMF",3,0)
 ;
"RTN","IVMCMF",4,0)
 ; This routine will perform edit checks to validate income tests which
"RTN","IVMCMF",5,0)
 ; are transmitted to VistA from the IVM Center. Any errors will be 
"RTN","IVMCMF",6,0)
 ; recorded and will be added to the record in the ANNUAL MEANS TEST 
"RTN","IVMCMF",7,0)
 ; File #408.31.
"RTN","IVMCMF",8,0)
 ;
"RTN","IVMCMF",9,0)
 ; This routine is called from IVMCM1.
"RTN","IVMCMF",10,0)
 ;
"RTN","IVMCMF",11,0)
 ; Required Input:
"RTN","IVMCMF",12,0)
 ;   The global array ^TMP($J,"IVMCM" which contains the income test
"RTN","IVMCMF",13,0)
 ;   The local variable IVMTYPE, which may be:
"RTN","IVMCMF",14,0)
 ;       1 - Means Test
"RTN","IVMCMF",15,0)
 ;       2 - Copay Test
"RTN","IVMCMF",16,0)
 ;       3 - Income Screening information only
"RTN","IVMCMF",17,0)
 ;       4 - Long Term Care Test
"RTN","IVMCMF",18,0)
 ;
"RTN","IVMCMF",19,0)
 ; Output:
"RTN","IVMCMF",20,0)
 ;   Array IVMERR as a list of error condition(s) found (free text)
"RTN","IVMCMF",21,0)
 ;
"RTN","IVMCMF",22,0)
EN(IVMERR) ; Entry point to begin edit checks.
"RTN","IVMCMF",23,0)
 ;
"RTN","IVMCMF",24,0)
 N ARRAY,DEP,I,IEN,SPOUSE,STRING,TYPE,X,CNT,HLERR
"RTN","IVMCMF",25,0)
 S CNT=1
"RTN","IVMCMF",26,0)
 I +$G(IVMTYPE)'>0 S CNT=CNT+1,IVMERR(CNT)="Income Test Type not Specified"
"RTN","IVMCMF",27,0)
 ;
"RTN","IVMCMF",28,0)
 ; Build strings for the veteran
"RTN","IVMCMF",29,0)
 S SPOUSE=0,DEP=1
"RTN","IVMCMF",30,0)
 S ARRAY("PID")=$$CLEAR($G(^TMP($J,"IVMCM","PIDV")))
"RTN","IVMCMF",31,0)
 S ARRAY("ZIC")=$$CLEAR($G(^TMP($J,"IVMCM","ZICV"))),$P(ARRAY("ZIC"),HLFS,21)=$$TOTAL^IVMCME(ARRAY("ZIC"))
"RTN","IVMCMF",32,0)
 S ARRAY("ZIR")=$$CLEAR($G(^TMP($J,"IVMCM","ZIRV")))
"RTN","IVMCMF",33,0)
 ;
"RTN","IVMCMF",34,0)
 ; Build strings for spouse as dependent
"RTN","IVMCMF",35,0)
 S ARRAY(DEP,"ZDP")=$$CLEAR($G(^TMP($J,"IVMCM","ZDPS")))
"RTN","IVMCMF",36,0)
 S ARRAY(DEP,"ZIC")=$$CLEAR($G(^TMP($J,"IVMCM","ZICS")))
"RTN","IVMCMF",37,0)
 S ARRAY(DEP,"ZIR")=$$CLEAR($G(^TMP($J,"IVMCM","ZIRS")))
"RTN","IVMCMF",38,0)
 D ADJ^IVMCME
"RTN","IVMCMF",39,0)
 ;
"RTN","IVMCMF",40,0)
 ; Build strings for children as dependents
"RTN","IVMCMF",41,0)
 S IEN=0 F  S IEN=$O(^TMP($J,"IVMCM","ZDPC",IEN)) Q:'IEN  D
"RTN","IVMCMF",42,0)
 . S DEP=DEP+1
"RTN","IVMCMF",43,0)
 . S ARRAY(DEP,"ZDP")=$$CLEAR($G(^TMP($J,"IVMCM","ZDPC",IEN)))
"RTN","IVMCMF",44,0)
 . S ARRAY(DEP,"ZIC")=$$CLEAR($G(^TMP($J,"IVMCM","ZICC",IEN)))
"RTN","IVMCMF",45,0)
 . S ARRAY(DEP,"ZIR")=$$CLEAR($G(^TMP($J,"IVMCM","ZIRC",IEN)))
"RTN","IVMCMF",46,0)
 . D ADJ^IVMCME
"RTN","IVMCMF",47,0)
 ;
"RTN","IVMCMF",48,0)
 ; - build income test string and check for errors
"RTN","IVMCMF",49,0)
 S ARRAY("ZMT")=$$CLEAR($G(^TMP($J,"IVMCM","ZMT"_IVMTYPE)))
"RTN","IVMCMF",50,0)
 ;
"RTN","IVMCMF",51,0)
 I '$$UPLDOK() S HLERR="Income Test not Uploaded",OK2UPLD=0 D ACK^IVMPREC Q
"RTN","IVMCMF",52,0)
 ;
"RTN","IVMCMF",53,0)
 ; Check Income Test before applying consistency checks
"RTN","IVMCMF",54,0)
 ; - If AGREED TO PAY DEDUCTIBLE is NO
"RTN","IVMCMF",55,0)
 ; - or DECLINES TO GIVE INCOME INFO and AGREED TO PAY DEDUCTIBLE are YES
"RTN","IVMCMF",56,0)
 ; Quit, the consistency checks are unnecessary.
"RTN","IVMCMF",57,0)
 N APD,DTGII S APD=$P(ARRAY("ZMT"),U,11),DTGII=$P(ARRAY("ZMT"),U,14)
"RTN","IVMCMF",58,0)
 I APD=0!(APD=1&(DTGII=1)) Q
"RTN","IVMCMF",59,0)
 ;
"RTN","IVMCMF",60,0)
 D CHECK
"RTN","IVMCMF",61,0)
ENQ Q
"RTN","IVMCMF",62,0)
 ;
"RTN","IVMCMF",63,0)
CLEAR(NODE) ; Convert HLQ to NULL
"RTN","IVMCMF",64,0)
 N I
"RTN","IVMCMF",65,0)
 F I=1:1:$L(NODE,HLFS) I $P(NODE,HLFS,I)=HLQ S $P(NODE,HLFS,I)=""
"RTN","IVMCMF",66,0)
 Q NODE
"RTN","IVMCMF",67,0)
 ;
"RTN","IVMCMF",68,0)
CHECK ; Check validity of transmission data
"RTN","IVMCMF",69,0)
 N IEN
"RTN","IVMCMF",70,0)
 D ZIC^IVMCMF1(ARRAY("ZIC"))
"RTN","IVMCMF",71,0)
 D ZIR^IVMCMF1(ARRAY("ZIR"))
"RTN","IVMCMF",72,0)
 I "^1^2^4^"[("^"_IVMTYPE_"^") D ZMT^IVMCMF2(ARRAY("ZMT"))
"RTN","IVMCMF",73,0)
 F IEN=0:0 S IEN=$O(ARRAY(IEN)) Q:'IEN  D
"RTN","IVMCMF",74,0)
 . D ZDP^IVMCMF2(ARRAY(IEN,"ZDP"),IEN)
"RTN","IVMCMF",75,0)
 . D ZIC^IVMCMF1(ARRAY(IEN,"ZIC"),IEN)
"RTN","IVMCMF",76,0)
 . D ZIR^IVMCMF1(ARRAY(IEN,"ZIR"),IEN)
"RTN","IVMCMF",77,0)
CHECKQ Q
"RTN","IVMCMF",78,0)
 ;
"RTN","IVMCMF",79,0)
UPLDOK() ; Check if the test is complete and OK to upload
"RTN","IVMCMF",80,0)
 ; Quit if not a valid test type
"RTN","IVMCMF",81,0)
 I "^1^2^3^4^"'[(U_IVMTYPE_U) Q 0
"RTN","IVMCMF",82,0)
 ;
"RTN","IVMCMF",83,0)
 ; Check the Income Test Status
"RTN","IVMCMF",84,0)
 N DGSTAT S DGSTAT=$P(ARRAY("ZMT"),U,3)
"RTN","IVMCMF",85,0)
 I IVMTYPE=1,"^C^A^G^N^P^"'[(U_DGSTAT_U) Q 0
"RTN","IVMCMF",86,0)
 I IVMTYPE=2,"^M^E^L^"'[(U_DGSTAT_U) Q 0
"RTN","IVMCMF",87,0)
 I IVMTYPE=4,"^0^1^"'[(U_DGSTAT_U) Q 0
"RTN","IVMCMF",88,0)
 ;
"RTN","IVMCMF",89,0)
 ; Check if the test has been completed
"RTN","IVMCMF",90,0)
 I IVMTYPE'=3,+$P(ARRAY("ZMT"),U,10)'>0 Q 0
"RTN","IVMCMF",91,0)
 Q 1
"RTN","IVMCMF1")
0^2^B34696418
"RTN","IVMCMF1",1,0)
IVMCMF1 ;ALB/RMM - CHECK ANNUAL INCOME DATA ; 07/28/2003
"RTN","IVMCMF1",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**71,82**;21-OCT-94
"RTN","IVMCMF1",3,0)
 ;
"RTN","IVMCMF1",4,0)
 ; This routine is called from IVMCMF.
"RTN","IVMCMF1",5,0)
 ;
"RTN","IVMCMF1",6,0)
 ;
"RTN","IVMCMF1",7,0)
ZIC(STRING,DEPIEN) ; Check validity of ZIC segment
"RTN","IVMCMF1",8,0)
 ;
"RTN","IVMCMF1",9,0)
 ; Input:  STRING as ZIC segment
"RTN","IVMCMF1",10,0)
 ;         DEPIEN as the IEN of the dependent in the array, if applicable
"RTN","IVMCMF1",11,0)
 ;
"RTN","IVMCMF1",12,0)
 N FLAG,I,X,Y,FND1
"RTN","IVMCMF1",13,0)
 S (FND1,FLAG)=0,X=$P(STRING,HLFS,2)
"RTN","IVMCMF1",14,0)
 I $E(X,1,4)<1992!($E(X,5,8)'="0000") S CNT=CNT+1,IVMERR(CNT)="Invalid Income Year in ZIC"
"RTN","IVMCMF1",15,0)
 F I=3:1:20 I $$NUM^IVMCME2($P(STRING,HLFS,I),7,2) S CNT=CNT+1,IVMERR(CNT)=$P($T(ZICFLD+I),";;",2)_" field content/length error"
"RTN","IVMCMF1",16,0)
 I $G(DEPIEN) D
"RTN","IVMCMF1",17,0)
 . F I=13,14 Q:FND1  I $P(STRING,HLFS,I)>0 S FND1=1,CNT=CNT+1,IVMERR(CNT)="Dependents can't have medical or funeral expenses"
"RTN","IVMCMF1",18,0)
 . I DEPIEN=SPOUSE,($P(STRING,HLFS,15)>0) S CNT=CNT+1,IVMERR(CNT)="No educational expenses for spouse"
"RTN","IVMCMF1",19,0)
 . I DEPIEN'=SPOUSE D
"RTN","IVMCMF1",20,0)
 . . I $P(STRING,HLFS,15)&('$P(ARRAY(DEPIEN,"ZIR"),U,9)) S CNT=CNT+1,IVMERR(CNT)="Dependent Educational Exp. error-income not avail. to vet"
"RTN","IVMCMF1",21,0)
 . . S X=$E($P(STRING,HLFS,2),1,4),FND1=0 D ^%DT S X=Y
"RTN","IVMCMF1",22,0)
 . . I $P(STRING,HLFS,15)>0 S X=$P(^DG(43,1,"MT",X,0),U,17) I X'<$P(STRING,HLFS,9) S CNT=CNT+1,IVMERR(CNT)="Income does not exceed child exclusion amount-educational expense not allowed"
"RTN","IVMCMF1",23,0)
 . . F I=16:1:20 Q:FND1  I +$P(STRING,HLFS,I)>0 S FND1=1,CNT=CNT+1,IVMERR(CNT)="No net worth figures allowed for dependent children" Q
"RTN","IVMCMF1",24,0)
 I $P(STRING,HLFS,20)>$P(STRING,HLFS,19) S CNT=CNT+1,IVMERR(CNT)="Debts can't be greater than Other Property or Assets"
"RTN","IVMCMF1",25,0)
 I '$G(DEPIEN) D
"RTN","IVMCMF1",26,0)
 . I IVMTYPE'=1 Q
"RTN","IVMCMF1",27,0)
 . I $P(ARRAY("ZMT"),HLFS,3)="C" Q
"RTN","IVMCMF1",28,0)
 . S FLAG=0 F I=16:1:20 I $P(STRING,HLFS,I)]"" S FLAG=1 Q
"RTN","IVMCMF1",29,0)
 . I 'FLAG,SPOUSE F I=16:1:20 I $P(ARRAY(SPOUSE,"ZIC"),HLFS,I)]"" S FLAG=1 Q
"RTN","IVMCMF1",30,0)
ZICQ Q
"RTN","IVMCMF1",31,0)
 ;
"RTN","IVMCMF1",32,0)
ZIR(STRING,DEPIEN,DGMTDE) ; Check validity of ZIR segment
"RTN","IVMCMF1",33,0)
 ;
"RTN","IVMCMF1",34,0)
 ; Input:  STRING as ZIR segment
"RTN","IVMCMF1",35,0)
 ;         DEPIEN as the IEN of the dependent in the array, if applicable
"RTN","IVMCMF1",36,0)
 ;         DGMTDE MT Data Entry Flag (Optional)
"RTN","IVMCMF1",37,0)
 ;
"RTN","IVMCMF1",38,0)
 N I,X,FND1
"RTN","IVMCMF1",39,0)
 S DGMTDE=+$G(DGMTDE)
"RTN","IVMCMF1",40,0)
 F I=2,3,5:1:9 D
"RTN","IVMCMF1",41,0)
 . S X=$P(STRING,HLFS,I)
"RTN","IVMCMF1",42,0)
 . I X]"",(X'=0),(X'=1) S CNT=CNT+1,IVMERR(CNT)=$P($T(ZIRFLD+I),";;",2)_" contains unacceptable value"
"RTN","IVMCMF1",43,0)
 I $$NUM^IVMCME2($P(STRING,HLFS,4),5,2) S CNT=CNT+1,IVMERR(CNT)="Invalid number for Amount Contributed to Spouse"
"RTN","IVMCMF1",44,0)
 S X=$P(STRING,HLFS,10) I X]""&((X>30)!(X<0)!(+X'=X)) S CNT=CNT+1,IVMERR(CNT)="Invalid number in Number of Dependent Children field"
"RTN","IVMCMF1",45,0)
 I X]"",(X'=DEP-SPOUSE) S CNT=CNT+1,IVMERR(CNT)="Number of Dependent Children does not match dependents transmitted"
"RTN","IVMCMF1",46,0)
 I '$G(DEPIEN) D
"RTN","IVMCMF1",47,0)
 . I $P(STRING,HLFS,2)']"" S CNT=CNT+1,IVMERR(CNT)="Must have Married Last Calendar Year for veteran"
"RTN","IVMCMF1",48,0)
 . I SPOUSE,'$P(STRING,HLFS,2) S CNT=CNT+1,IVMERR(CNT)="Spouse transmitted, but Married Last Calendar Year is NO"
"RTN","IVMCMF1",49,0)
 . I 'DGMTDE,'SPOUSE,$P(STRING,HLFS,2)=1 S CNT=CNT+1,IVMERR(CNT)="No spouse transmitted, but Married Last Calendar Year is YES"
"RTN","IVMCMF1",50,0)
 . I '$P(STRING,HLFS,2),(+$P(STRING,HLFS,3)) S CNT=CNT+1,IVMERR(CNT)="Can't have Lived with Patient if not Married"
"RTN","IVMCMF1",51,0)
 . I $P(STRING,HLFS,2)=1,('+$P(STRING,HLFS,3)) S CNT=CNT+1,IVMERR(CNT)="Must have Living with Patient if Married"
"RTN","IVMCMF1",52,0)
 . I $P(STRING,HLFS,3)=1,($P(STRING,HLFS,4)'="") S CNT=CNT+1,IVMERR(CNT)="Should not have Amount contributed to spouse if living w/patient"
"RTN","IVMCMF1",53,0)
 . I $P(STRING,HLFS,3)=0,($P(STRING,HLFS,4)="") S CNT=CNT+1,IVMERR(CNT)="Need amount contributed to spouse if not living w/patient"
"RTN","IVMCMF1",54,0)
 . F I=6:1:9 I $P(STRING,HLFS,I)]"" S CNT=CNT+1,IVMERR(CNT)=$P($T(ZIRFLD+I),";;",2)_" should not be filled in for veteran"
"RTN","IVMCMF1",55,0)
 . I '$P(STRING,HLFS,3),SPOUSE,($P(STRING,HLFS,4)<600) S FND1=0 F I=3:1:20 Q:FND1  I $P(ARRAY(SPOUSE,"ZIC"),HLFS,I) S FND1=1,CNT=CNT+1,IVMERR(CNT)="No income data allowed if spouse didn't live w/vet & amt contributed <$600"
"RTN","IVMCMF1",56,0)
 I $G(DEPIEN)=SPOUSE D
"RTN","IVMCMF1",57,0)
 . F I=2:1:10 I $P(STRING,HLFS,I)]"" S CNT=CNT+1,IVMERR(CNT)=$P($T(ZIRFLD+I),";;",2)_" should not be filled in for spouse ZIR"
"RTN","IVMCMF1",58,0)
 I $G(DEPIEN),(DEPIEN'=SPOUSE) D
"RTN","IVMCMF1",59,0)
 . I $P(STRING,HLFS,3)'=1,$P(STRING,HLFS,7)'=1 S CNT=CNT+1,IVMERR(CNT)="Dependents must have Lived With Patient field"
"RTN","IVMCMF1",60,0)
 . I '$P(STRING,HLFS,8),($P(STRING,HLFS,9)]"") S CNT=CNT+1,IVMERR(CNT)="Shouldn't have Income Available answered if Child had no income"
"RTN","IVMCMF1",61,0)
 . I $P(STRING,HLFS,3),($P(STRING,HLFS,7)]"") S CNT=CNT+1,IVMERR(CNT)="Shouldn't have Contributed to Support if living w/patient"
"RTN","IVMCMF1",62,0)
 . I '$P(STRING,HLFS,8) S FND1=0 F I=3:1:20 Q:FND1  I $P(ARRAY(DEPIEN,"ZIC"),HLFS,I) S CNT=CNT+1,IVMERR(CNT)="Shouldn't have income data if Child Had Income is NO",FND1=1
"RTN","IVMCMF1",63,0)
ZIRQ Q
"RTN","IVMCMF1",64,0)
 ;
"RTN","IVMCMF1",65,0)
ZICFLD ; ZIC field names
"RTN","IVMCMF1",66,0)
 ;;
"RTN","IVMCMF1",67,0)
 ;;INCOME YEAR
"RTN","IVMCMF1",68,0)
 ;;SOCIAL SECURITY
"RTN","IVMCMF1",69,0)
 ;;US CIVIL SERVICE
"RTN","IVMCMF1",70,0)
 ;;US RAILROAD RETIREMENT
"RTN","IVMCMF1",71,0)
 ;;MILITARY RETIREMENT
"RTN","IVMCMF1",72,0)
 ;;UNEMPLOYMENT COMPENSATION
"RTN","IVMCMF1",73,0)
 ;;OTHER RETIREMENT
"RTN","IVMCMF1",74,0)
 ;;EMPLOYMENT INCOME
"RTN","IVMCMF1",75,0)
 ;;INTEREST, DIVIDEND, ANNUITY
"RTN","IVMCMF1",76,0)
 ;;WORKERS COMP/BLACK LUNG
"RTN","IVMCMF1",77,0)
 ;;OTHER INCOME
"RTN","IVMCMF1",78,0)
 ;;MEDICAL EXPENSES
"RTN","IVMCMF1",79,0)
 ;;FUNERAL AND BURIAL EXPENSES
"RTN","IVMCMF1",80,0)
 ;;EDUCATIONAL EXPENSES
"RTN","IVMCMF1",81,0)
 ;;CASH AMOUNT IN BANK ACCOUNTS
"RTN","IVMCMF1",82,0)
 ;;STOCKS AND BONDS
"RTN","IVMCMF1",83,0)
 ;;REAL PROPERTY
"RTN","IVMCMF1",84,0)
 ;;OTHER PROPERTY OR ASSETS
"RTN","IVMCMF1",85,0)
 ;;DEBTS
"RTN","IVMCMF1",86,0)
 ;
"RTN","IVMCMF1",87,0)
ZIRFLD ; ZIR field names
"RTN","IVMCMF1",88,0)
 ;;
"RTN","IVMCMF1",89,0)
 ;;MARRIED LAST CALENDAR YEAR
"RTN","IVMCMF1",90,0)
 ;;LIVED WITH PATIENT
"RTN","IVMCMF1",91,0)
 ;;AMOUNT CONTRIBUTED TO SPOUSE
"RTN","IVMCMF1",92,0)
 ;;DEPENDENT CHILDREN
"RTN","IVMCMF1",93,0)
 ;;INCAPABLE OF SELF SUPPORT
"RTN","IVMCMF1",94,0)
 ;;CONTRIBUTED TO SUPPORT
"RTN","IVMCMF1",95,0)
 ;;CHILD HAD INCOME
"RTN","IVMCMF1",96,0)
 ;;INCOME AVAILABLE TO YOU
"RTN","IVMCMF1",97,0)
 ;;NUMBER OF DEPENDENT CHILDREN
"RTN","IVMCMFB")
0^3^B11964156
"RTN","IVMCMFB",1,0)
IVMCMFB ;ALB/RMM - SEND INCOME TEST TRANSMISSION BULLETIN ; 07/24/03
"RTN","IVMCMFB",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**71,82**;21-OCT-94
"RTN","IVMCMFB",3,0)
 ;
"RTN","IVMCMFB",4,0)
BULL(DFN,DGMTDT,IVMERR,SCTST) ;
"RTN","IVMCMFB",5,0)
 ; Send mail message notifying site of an income test that was completed
"RTN","IVMCMFB",6,0)
 ; containing data inconsistencies.
"RTN","IVMCMFB",7,0)
 ;
"RTN","IVMCMFB",8,0)
 ;  Input array required:
"RTN","IVMCMFB",9,0)
 ;    "IVMERR("  --  contains lists of inconsistencies from tests 
"RTN","IVMCMFB",10,0)
 ;                   which were uploaded (ORU~Z10 and ORF~Z10)
"RTN","IVMCMFB",11,0)
 ;
"RTN","IVMCMFB",12,0)
 N DIFROM,XMDUZ,XMTEXT,XMSTRIP,XMROU,XMY,XMZ,XMDF,IVMGRP,IVMPAT
"RTN","IVMCMFB",13,0)
 S XMDF=""
"RTN","IVMCMFB",14,0)
 S XMDUZ=""
"RTN","IVMCMFB",15,0)
 S XMTEXT="IVMTXT("
"RTN","IVMCMFB",16,0)
 S XMY(DUZ)=""
"RTN","IVMCMFB",17,0)
 S IVMGRP="MT INCONSISTENCIES"
"RTN","IVMCMFB",18,0)
 S XMY("G."_IVMGRP_"@"_^XMB("NETNAME"))=""
"RTN","IVMCMFB",19,0)
 S IVMPAT=$$PT^IVMUFNC4(DFN)
"RTN","IVMCMFB",20,0)
 S XMSUB="MT INCONSISTENCIES - "_$E($P(IVMPAT,"^"),1)_$P(IVMPAT,"^",3)_"/"_SCTST
"RTN","IVMCMFB",21,0)
 ;
"RTN","IVMCMFB",22,0)
 S IVMTXT(1)="An Income Test was edited/completed on "_$$FMTE^XLFDT($$NOW^XLFDT,"1D")
"RTN","IVMCMFB",23,0)
 S IVMTXT(2)="containing "_($O(IVMERR(""),-1)-1)_" data inconsistencie(s)."
"RTN","IVMCMFB",24,0)
 S IVMTXT(3)=" "
"RTN","IVMCMFB",25,0)
 S IVMTXT(4)="    NAME:        "_$P(IVMPAT,"^")
"RTN","IVMCMFB",26,0)
 S IVMTXT(5)="    ID:          "_$P(IVMPAT,"^",2)
"RTN","IVMCMFB",27,0)
 S IVMTXT(6)="    TEST DATE:   "_$$FMTE^XLFDT(DGMTDT)
"RTN","IVMCMFB",28,0)
 S IVMTXT(7)=" "
"RTN","IVMCMFB",29,0)
 S IVMTXT(8)="The inconsistencies are listed in the comment section of"
"RTN","IVMCMFB",30,0)
 S IVMTXT(9)="the income test for this veteran."
"RTN","IVMCMFB",31,0)
 ;
"RTN","IVMCMFB",32,0)
 D ^XMD
"RTN","IVMCMFB",33,0)
 K IVMTXT,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","IVMCMFB",34,0)
 Q
"RTN","IVMCMFB",35,0)
 ;
"RTN","IVMCMFB",36,0)
PROB(DGMTDT,IVMERR,BULLRQ) ;
"RTN","IVMCMFB",37,0)
 ;  IVMERR - Contains lists of inconsistencies from tests which were
"RTN","IVMCMFB",38,0)
 ;           uploaded (ORU~Z10 and ORF~Z10) or created during data
"RTN","IVMCMFB",39,0)
 ;            entry (Required)
"RTN","IVMCMFB",40,0)
 ;
"RTN","IVMCMFB",41,0)
 ;  BULLRQ - MT INCONSISTENCIES Bulletin Required? flag (Optional)
"RTN","IVMCMFB",42,0)
 ;
"RTN","IVMCMFB",43,0)
 ; If the test wasn't completed during data entry quit
"RTN","IVMCMFB",44,0)
 N MTCOMP,DGMTI,TYPE,SCTST
"RTN","IVMCMFB",45,0)
 S BULLRQ=+$G(BULLRQ)
"RTN","IVMCMFB",46,0)
 S TYPE=$S($D(IVMTYPE):IVMTYPE,$D(DGMTYPT):DGMTYPT,1:"")
"RTN","IVMCMFB",47,0)
 S:'$D(DGMTI) DGMTI=+$$LST^DGMTU(DFN,,TYPE)
"RTN","IVMCMFB",48,0)
 S MTCOMP=$P($G(^DGMT(408.31,+$G(DGMTI),0)),U,7)
"RTN","IVMCMFB",49,0)
 I BULLRQ,MTCOMP'>0 Q
"RTN","IVMCMFB",50,0)
 ;
"RTN","IVMCMFB",51,0)
 ; If errors were found during data entry, send bulletin 
"RTN","IVMCMFB",52,0)
 S SCTST=$P($G(^DGMT(408.31,+$G(DGMTI),2)),U,5)
"RTN","IVMCMFB",53,0)
 I BULLRQ,$D(IVMERR(2)) D BULL(DFN,DGMTDT,.IVMERR,SCTST)
"RTN","IVMCMFB",54,0)
 ;
"RTN","IVMCMFB",55,0)
 ; If inconsistent data was found update the comment field with the list
"RTN","IVMCMFB",56,0)
 ; of errors.
"RTN","IVMCMFB",57,0)
 D INCON(DGMTI,.IVMERR)
"RTN","IVMCMFB",58,0)
 Q
"RTN","IVMCMFB",59,0)
 ;
"RTN","IVMCMFB",60,0)
INCON(DGMTI,IVMERR,TFLG) ;
"RTN","IVMCMFB",61,0)
 ; Append the current comments (if any) with the list of inconsistencies
"RTN","IVMCMFB",62,0)
 ; found during data entry or upload of ORU/ORF Z10
"RTN","IVMCMFB",63,0)
 N CNT,INCNT,COMM,TTYPE,TAB,ERR,LNCNT,TFLG
"RTN","IVMCMFB",64,0)
 I $D(IVMERR(2)),BULLRQ D
"RTN","IVMCMFB",65,0)
 .S TTYPE=^DG(408.33,+$P($G(^DGMT(408.31,DGMTI,0)),U,19),0)
"RTN","IVMCMFB",66,0)
 .S IVMERR(1)=":A "_TTYPE_" was edited on "_$$FMTE^XLFDT($$NOW^XLFDT,"1P")_" with data inconsistencies."
"RTN","IVMCMFB",67,0)
 I $D(IVMERR(2)),'BULLRQ D
"RTN","IVMCMFB",68,0)
 .S IVMERR(1)=":Received/Uploaded Test on "_$$FMTE^XLFDT($$NOW^XLFDT,"1P")_" with data inconsistencies."
"RTN","IVMCMFB",69,0)
 ;
"RTN","IVMCMFB",70,0)
 ; Check for exisiting non-inconsistency messages
"RTN","IVMCMFB",71,0)
 S TFLG=2
"RTN","IVMCMFB",72,0)
 D CHECK(DGMTI,.TFLG)
"RTN","IVMCMFB",73,0)
 ;
"RTN","IVMCMFB",74,0)
 ; If nothing to add to the  COMMENT field, delete all existing msgs
"RTN","IVMCMFB",75,0)
 I '$D(IVMERR(1)) D INCONR(DGMTI) Q
"RTN","IVMCMFB",76,0)
 ;
"RTN","IVMCMFB",77,0)
 ; Overwrite the comments for inconsistencies found during Z10 upload
"RTN","IVMCMFB",78,0)
 S TAB=": "
"RTN","IVMCMFB",79,0)
 F LNCNT=TFLG:1 Q:'$D(IVMERR(LNCNT))  S IVMERR(LNCNT)=TAB_IVMERR(LNCNT)
"RTN","IVMCMFB",80,0)
 D WP^DIE(408.31,DGMTI_",",50,,"IVMERR",.ERR)
"RTN","IVMCMFB",81,0)
 Q
"RTN","IVMCMFB",82,0)
 ;
"RTN","IVMCMFB",83,0)
CHECK(DGMTI,TFLG) ;
"RTN","IVMCMFB",84,0)
 ; Check for exisiting non-inconsistency messages, and keep all 
"RTN","IVMCMFB",85,0)
 ; non-inconsistency (user entered) messages.
"RTN","IVMCMFB",86,0)
 ;
"RTN","IVMCMFB",87,0)
 ; Quit if no comments were entered
"RTN","IVMCMFB",88,0)
 Q:'$D(^DGMT(408.31,DGMTI,"C",1,0))
"RTN","IVMCMFB",89,0)
 ;
"RTN","IVMCMFB",90,0)
 ; Quit if all current comments are for inconsistencies
"RTN","IVMCMFB",91,0)
 S INCNT=0
"RTN","IVMCMFB",92,0)
 F CNT=1:1 Q:'$D(^DGMT(408.31,DGMTI,"C",CNT,0))  D
"RTN","IVMCMFB",93,0)
 .Q:$E(^DGMT(408.31,DGMTI,"C",CNT,0),1)=":"
"RTN","IVMCMFB",94,0)
 .Q:^DGMT(408.31,DGMTI,"C",CNT,0)']""
"RTN","IVMCMFB",95,0)
 .S INCNT=INCNT+1,COMM(INCNT)=^DGMT(408.31,DGMTI,"C",CNT,0)
"RTN","IVMCMFB",96,0)
 Q:INCNT'>0
"RTN","IVMCMFB",97,0)
 ;
"RTN","IVMCMFB",98,0)
 ; Re-Build Comment array with user comments
"RTN","IVMCMFB",99,0)
 S TFLG=INCNT+2
"RTN","IVMCMFB",100,0)
 F CNT=1:1 Q:'$D(IVMERR(CNT))  S INCNT=INCNT+1,COMM(INCNT)=IVMERR(CNT)
"RTN","IVMCMFB",101,0)
 M IVMERR=COMM
"RTN","IVMCMFB",102,0)
 Q
"RTN","IVMCMFB",103,0)
 ;
"RTN","IVMCMFB",104,0)
INCONR(DGMTI) ;
"RTN","IVMCMFB",105,0)
 ; When no inconsistent data and no user comments were found, 
"RTN","IVMCMFB",106,0)
 ; remove everything from the COMMENT Word Procesing field.
"RTN","IVMCMFB",107,0)
 ;
"RTN","IVMCMFB",108,0)
 ; Quit if no comments exist
"RTN","IVMCMFB",109,0)
 Q:'$D(^DGMT(408.31,DGMTI,"C",1,0))
"RTN","IVMCMFB",110,0)
 ;
"RTN","IVMCMFB",111,0)
 ; Delete all, when no comments and no inconsistencies
"RTN","IVMCMFB",112,0)
 D WP^DIE(408.31,DGMTI_",",50,,"@",.ERR)
"RTN","IVMCMFB",113,0)
 ;
"RTN","IVMCMFB",114,0)
 Q
"RTN","IVMPREC1")
0^4^B26530064
"RTN","IVMPREC1",1,0)
IVMPREC1 ;ALB/SEK/BRM - PROCESS INCOMING HL7 (ACK) MESSAGES ; 07/28/2003
"RTN","IVMPREC1",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**9,17,26,52,34,72,82**; 21-OCT-94
"RTN","IVMPREC1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IVMPREC1",4,0)
 ;
"RTN","IVMPREC1",5,0)
 ; This routine will process ACK HL7 messages received from the
"RTN","IVMPREC1",6,0)
 ; IVM center.
"RTN","IVMPREC1",7,0)
 ;
"RTN","IVMPREC1",8,0)
ACK ; - Receive ACK Message from IVM Center stored in ^TMP("HLR".
"RTN","IVMPREC1",9,0)
 ;   If 1st segment is BHS then set(s) of MSH, MSA(AE) will follow
"RTN","IVMPREC1",10,0)
 ;   indicating error(s) in transmission received by IVM Center
"RTN","IVMPREC1",11,0)
 ;   If 1st segment is MSH than MSA (AA) indicating batch or individual
"RTN","IVMPREC1",12,0)
 ;   query was received ok.  MSA (AE) indicates error in transmission of
"RTN","IVMPREC1",13,0)
 ;   individual query.
"RTN","IVMPREC1",14,0)
 ; 
"RTN","IVMPREC1",15,0)
 ; - When acknowledgment code = "AA" (application accept)
"RTN","IVMPREC1",16,0)
 ;   Stuff 1 into STATUS field (.03) of ^IVM(301.6 indicating IVM Center
"RTN","IVMPREC1",17,0)
 ;   has received transmission.  
"RTN","IVMPREC1",18,0)
 ;
"RTN","IVMPREC1",19,0)
 K HLNODE,IVMRTN,SEGCNT,CNT
"RTN","IVMPREC1",20,0)
 S IVMRTN="IVMPREC1"
"RTN","IVMPREC1",21,0)
 S HLFS=HL("FS"),HLQ=HL("Q"),HLECH=HL("ECH")
"RTN","IVMPREC1",22,0)
 K ^TMP($J,IVMRTN)
"RTN","IVMPREC1",23,0)
 F SEGCNT=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","IVMPREC1",24,0)
 . S CNT=0,^TMP($J,IVMRTN,SEGCNT,CNT)=HLNODE
"RTN","IVMPREC1",25,0)
 . F  S CNT=$O(HLNODE(CNT)) Q:'CNT  D
"RTN","IVMPREC1",26,0)
 . . S ^TMP($J,IVMRTN,SEGCNT,CNT)=HLNODE(CNT)
"RTN","IVMPREC1",27,0)
 S HLDA=HLMTIEN
"RTN","IVMPREC1",28,0)
 K HLNODE,SEGCNT,CNT
"RTN","IVMPREC1",29,0)
 ;
"RTN","IVMPREC1",30,0)
 S IVMSEG=$G(^TMP($J,IVMRTN,1,0))
"RTN","IVMPREC1",31,0)
 I IVMSEG="" G ACKQ
"RTN","IVMPREC1",32,0)
 I $P(IVMSEG,HLFS)'="BHS",$P(IVMSEG,HLFS)'="MSH" G ACKQ
"RTN","IVMPREC1",33,0)
 ;
"RTN","IVMPREC1",34,0)
 ; - process batches of acknowledges
"RTN","IVMPREC1",35,0)
 I $P(IVMSEG,HLFS)="BHS" D AE G ACKQ
"RTN","IVMPREC1",36,0)
 ;
"RTN","IVMPREC1",37,0)
 ; - process MSH MSA message
"RTN","IVMPREC1",38,0)
 S IVMSEG=$G(^TMP($J,IVMRTN,2,0))
"RTN","IVMPREC1",39,0)
 I $P(IVMSEG,HLFS)'="MSA" G ACKQ
"RTN","IVMPREC1",40,0)
 S IVMADDT=$P(IVMSEG,HLFS,3)
"RTN","IVMPREC1",41,0)
 I $P(IVMSEG,HLFS,2)="AA" D  G ACKQ
"RTN","IVMPREC1",42,0)
 .F IVMDA=0:0 S IVMDA=$O(^IVM(301.6,"AE",IVMADDT,IVMDA)) Q:'IVMDA  I $$SETSTAT^IVMTLOG(IVMDA,1)
"RTN","IVMPREC1",43,0)
 ;
"RTN","IVMPREC1",44,0)
 I $P(IVMSEG,HLFS,2)="AE" D  G ACKQ
"RTN","IVMPREC1",45,0)
 .S IVMMCI=$P(IVMSEG,HLFS,3)
"RTN","IVMPREC1",46,0)
 .S IVMEM=$P(IVMSEG,HLFS,4)
"RTN","IVMPREC1",47,0)
 .S IVMDA=$O(^IVM(301.6,"AE",IVMADDT,"")) I 'IVMDA D OTH Q
"RTN","IVMPREC1",48,0)
 .I $$SETSTAT^IVMTLOG(IVMDA,3,IVMEM)
"RTN","IVMPREC1",49,0)
 ;
"RTN","IVMPREC1",50,0)
ACKQ ;
"RTN","IVMPREC1",51,0)
 K ^TMP($J,IVMRTN)
"RTN","IVMPREC1",52,0)
 K DA,DIE,DR,IVMADDT,IVMI,IVMCT,IVMDA,IVMMCI,IVMEM,IVMNAME,IVMPAT,IVMRTN,IVMSEG,IVMSSN,IVMTEXT,XMSUB
"RTN","IVMPREC1",53,0)
 ;
"RTN","IVMPREC1",54,0)
 Q
"RTN","IVMPREC1",55,0)
 ;
"RTN","IVMPREC1",56,0)
AE ; - When acknowledgment code = "AE" (application error)
"RTN","IVMPREC1",57,0)
 ;   Stuff 3 into STATUS field(.03), error message into ERROR MESSAGE
"RTN","IVMPREC1",58,0)
 ;   field(.04), and 1 (NEW) into the ERROR PROCESSING STATUS field.
"RTN","IVMPREC1",59,0)
 ;   Stuff 1 into STATUS field(.03) for transmissions (no 'AE' code
"RTN","IVMPREC1",60,0)
 ;   received) received by IVM Center.
"RTN","IVMPREC1",61,0)
 ;
"RTN","IVMPREC1",62,0)
 N Z07FLG,Z07RET
"RTN","IVMPREC1",63,0)
 S IVMI=0 F  S IVMI=$O(^TMP($J,IVMRTN,IVMI)) Q:'IVMI  S IVMSEG=$G(^(IVMI,0)) D
"RTN","IVMPREC1",64,0)
 .D:$E(IVMSEG,1,3)="MSH"
"RTN","IVMPREC1",65,0)
 ..S Z07RET=0
"RTN","IVMPREC1",66,0)
 ..I $P(IVMSEG,HLFS,9)["ORU~Z07" S Z07FLG=1 Q
"RTN","IVMPREC1",67,0)
 ..K Z07FLG
"RTN","IVMPREC1",68,0)
 .Q:IVMSEG']""!($E(IVMSEG,1,3)'="MSA")!($P(IVMSEG,HLFS,2)'="AE")
"RTN","IVMPREC1",69,0)
 .S IVMMCI=$P(IVMSEG,HLFS,3)
"RTN","IVMPREC1",70,0)
 .S IVMEM=$P(IVMSEG,HLFS,4)
"RTN","IVMPREC1",71,0)
 .S IVMDA=$O(^IVM(301.6,"ADS",IVMMCI,"")) I 'IVMDA D  Q:'Z07RET
"RTN","IVMPREC1",72,0)
 ..I $D(Z07FLG) D  Q
"RTN","IVMPREC1",73,0)
 ...S Z07RET=$$Z07CHK(IVMI,IVMMCI,IVMEM)
"RTN","IVMPREC1",74,0)
 ...S:Z07RET IVMDA=$O(^IVM(301.6,"ADS",IVMMCI,""))
"RTN","IVMPREC1",75,0)
 ..D OTH
"RTN","IVMPREC1",76,0)
 .I $$SETSTAT^IVMTLOG(IVMDA,3,IVMEM)
"RTN","IVMPREC1",77,0)
 ;
"RTN","IVMPREC1",78,0)
 ; - update messages in batch with no error
"RTN","IVMPREC1",79,0)
 F IVMDA=0:0 S IVMDA=$O(^IVM(301.6,"AE",+$G(IVMMCI),IVMDA)) Q:'IVMDA  I $$SETSTAT^IVMTLOG(IVMDA,1)
"RTN","IVMPREC1",80,0)
 Q
"RTN","IVMPREC1",81,0)
 ;
"RTN","IVMPREC1",82,0)
OTH ; Generate message for errors other than Full/Initial Transmissions.
"RTN","IVMPREC1",83,0)
 N IVMRMM,IVMNAM,IVMPID,IVMTMP,HLDA,HLDAT,HLSEG,DIC,DR,DA,DIQ
"RTN","IVMPREC1",84,0)
 S (IVMNAM,IVMPID,HLDA,IVMTMP)=""
"RTN","IVMPREC1",85,0)
 S HLDA=$O(^HL(772,"C",$P($G(IVMMCI),"-"),0))
"RTN","IVMPREC1",86,0)
 Q:+$G(HLDA)'>0
"RTN","IVMPREC1",87,0)
 Q:'$D(^HL(772,+HLDA,0))
"RTN","IVMPREC1",88,0)
 S DIC="^HL(772,",DR=200,DA=HLDA,DR(200.02)=.01,DA(200.02)=17,DIQ="HLDAT"
"RTN","IVMPREC1",89,0)
 D EN^DIQ1
"RTN","IVMPREC1",90,0)
 F  S IVMTMP=$O(HLDAT(772,HLDA,200,IVMTMP)) Q:((IVMTMP="")!($G(HLSEG)="PID"))  D
"RTN","IVMPREC1",91,0)
 .S HLSEG=$P($G(HLDAT(772,HLDA,200,IVMTMP)),"^")
"RTN","IVMPREC1",92,0)
 .D:HLSEG="PID"
"RTN","IVMPREC1",93,0)
 ..S IVMNAM=$P($G(HLDAT(772,HLDA,200,IVMTMP)),"^",6)  ;PATIENT NAME
"RTN","IVMPREC1",94,0)
 ..S IVMNAM=$P(IVMNAM,"~")_", "_$P(IVMNAM,"~",2)
"RTN","IVMPREC1",95,0)
 ..S IVMPID=$P($G(HLDAT(772,HLDA,200,IVMTMP)),"^",20)  ;SSN
"RTN","IVMPREC1",96,0)
 ..;S IVMPID=$P(IVMPID,"~")
"RTN","IVMPREC1",97,0)
 ..S IVMPID=$E(IVMPID,1,3)_"-"_$E(IVMPID,4,5)_"-"_$E(IVMPID,6,9)
"RTN","IVMPREC1",98,0)
 ..S XMSUB="ERROR MESSAGE FROM THE HEC"
"RTN","IVMPREC1",99,0)
 ..S IVMTEXT(1)="An Insurance Confirmation message or a Billing/Collections Transmission"
"RTN","IVMPREC1",100,0)
 ..S IVMTEXT(2)="was rejected by the Health Eligibility Center with the following error:"
"RTN","IVMPREC1",101,0)
 ..S IVMTEXT(3)=" ",IVMTEXT(4)=IVMEM,IVMTEXT(5)=" "
"RTN","IVMPREC1",102,0)
 ..S IVMTEXT(6)="NAME: "_IVMNAM
"RTN","IVMPREC1",103,0)
 ..S IVMTEXT(7)="PID : "_IVMPID,IVMTEXT(8)=" "
"RTN","IVMPREC1",104,0)
 ..S IVMRMM=$$MMN^IVMPTRN4($P(IVMMCI,"-"))
"RTN","IVMPREC1",105,0)
 ..S IVMTEXT(9)="Mailman Message # of Acknowledged Transmission: "_$S(IVMRMM:IVMRMM,1:"<unknown>")
"RTN","IVMPREC1",106,0)
 ..S IVMTEXT(10)=" "
"RTN","IVMPREC1",107,0)
 ..S IVMTEXT(11)="If you are unable to find the source of this problem,"
"RTN","IVMPREC1",108,0)
 ..S IVMTEXT(12)="please contact your ISC Support Group or the HEC."
"RTN","IVMPREC1",109,0)
 ..D MAIL^IVMUFNC()
"RTN","IVMPREC1",110,0)
 Q
"RTN","IVMPREC1",111,0)
 ;
"RTN","IVMPREC1",112,0)
Z07CHK(CURSEQ,CURMCI,CUREM) ; Function ;
"RTN","IVMPREC1",113,0)
 ; INPUT
"RTN","IVMPREC1",114,0)
 ;      CURSEQ : Current Sequence # reviewing in batch
"RTN","IVMPREC1",115,0)
 ;      CURMCI : Current Message Control ID reviewing in batch
"RTN","IVMPREC1",116,0)
 ;      CUREM  : Current Error Message reviewing in batch
"RTN","IVMPREC1",117,0)
 ;
"RTN","IVMPREC1",118,0)
 ; Check for duplicate ACK sequence on the same batch
"RTN","IVMPREC1",119,0)
 N SEQ,CHKSEG,CHKSEGN,DUP
"RTN","IVMPREC1",120,0)
 S (SEQ,DUP)=0
"RTN","IVMPREC1",121,0)
 F  S SEQ=$O(^TMP($J,IVMRTN,SEQ)) Q:SEQ=""  D
"RTN","IVMPREC1",122,0)
 . S CHKSEG=^TMP($J,IVMRTN,SEQ,0),CHKSEGN=$E(CHKSEG,1,3)
"RTN","IVMPREC1",123,0)
 . Q:CHKSEGN'="MSA"
"RTN","IVMPREC1",124,0)
 . Q:SEQ=CURSEQ
"RTN","IVMPREC1",125,0)
 . S:$P(CHKSEG,"^",3)=CURMCI DUP=1
"RTN","IVMPREC1",126,0)
 I DUP Q "0^DUPLICATE SEQUENCE ON ACK BATCH"
"RTN","IVMPREC1",127,0)
 ;
"RTN","IVMPREC1",128,0)
 ; Check to see if ADS x-ref missing in last 1000 entries
"RTN","IVMPREC1",129,0)
 N END,IEN,MCI,FND,LOG,RET,TMPCTR
"RTN","IVMPREC1",130,0)
 S FND=0,RET="",IEN=" "
"RTN","IVMPREC1",131,0)
 F TMPCTR=1:1:1000 S IEN=$O(^IVM(301.6,IEN),-1) Q:+IEN=0  D  Q:FND
"RTN","IVMPREC1",132,0)
 . S MCI=$P(^IVM(301.6,IEN,0),"^",5)
"RTN","IVMPREC1",133,0)
 . I MCI=CURMCI S FND=1 D  Q
"RTN","IVMPREC1",134,0)
 . . S LOG=^IVM(301.6,IEN,0)
"RTN","IVMPREC1",135,0)
 . . I $P(LOG,"^",3)=3&($P(LOG,"^",4)=CUREM) S RET="0^ACK TO THIS SEQUENCE HAS ALREADY BEEN PROCESSED" Q
"RTN","IVMPREC1",136,0)
 . . S ^IVM(301.6,"ADS",CURMCI,IEN)="" S RET="1^ADS X-REF MISSING.  X-REF HAS BEEN RESET."
"RTN","IVMPREC1",137,0)
 Q RET
"VER")
8.0^22
**END**
**END**
