KIDS Distribution saved on Jan 20, 2005@11:20:30
GUI 25 RELEASED
**KIDS**:CPRS BUNDLE GUI 25.0^PSS*1.0*59^PSJ*5.0*111^OR*3.0*195^

**INSTALL NAME**
CPRS BUNDLE GUI 25.0
"BLD",4850,0)
CPRS BUNDLE GUI 25.0^^1^3050120^n
"BLD",4850,10,0)
^9.63^3^3
"BLD",4850,10,1,0)
PSS*1.0*59^1
"BLD",4850,10,2,0)
PSJ*5.0*111^1
"BLD",4850,10,3,0)
OR*3.0*195^1
"BLD",4850,10,"B","OR*3.0*195",3)

"BLD",4850,10,"B","PSJ*5.0*111",2)

"BLD",4850,10,"B","PSS*1.0*59",1)

"BLD",4850,"KRN",0)
^9.67PA^8989.52^19
"BLD",4850,"KRN",.4,0)
.4
"BLD",4850,"KRN",.401,0)
.401
"BLD",4850,"KRN",.402,0)
.402
"BLD",4850,"KRN",.403,0)
.403
"BLD",4850,"KRN",.5,0)
.5
"BLD",4850,"KRN",.84,0)
.84
"BLD",4850,"KRN",3.6,0)
3.6
"BLD",4850,"KRN",3.8,0)
3.8
"BLD",4850,"KRN",9.2,0)
9.2
"BLD",4850,"KRN",9.8,0)
9.8
"BLD",4850,"KRN",19,0)
19
"BLD",4850,"KRN",19.1,0)
19.1
"BLD",4850,"KRN",101,0)
101
"BLD",4850,"KRN",409.61,0)
409.61
"BLD",4850,"KRN",771,0)
771
"BLD",4850,"KRN",870,0)
870
"BLD",4850,"KRN",8989.51,0)
8989.51
"BLD",4850,"KRN",8989.52,0)
8989.52
"BLD",4850,"KRN",8994,0)
8994
"BLD",4850,"KRN","B",.4,.4)

"BLD",4850,"KRN","B",.401,.401)

"BLD",4850,"KRN","B",.402,.402)

"BLD",4850,"KRN","B",.403,.403)

"BLD",4850,"KRN","B",.5,.5)

"BLD",4850,"KRN","B",.84,.84)

"BLD",4850,"KRN","B",3.6,3.6)

"BLD",4850,"KRN","B",3.8,3.8)

"BLD",4850,"KRN","B",9.2,9.2)

"BLD",4850,"KRN","B",9.8,9.8)

"BLD",4850,"KRN","B",19,19)

"BLD",4850,"KRN","B",19.1,19.1)

"BLD",4850,"KRN","B",101,101)

"BLD",4850,"KRN","B",409.61,409.61)

"BLD",4850,"KRN","B",771,771)

"BLD",4850,"KRN","B",870,870)

"BLD",4850,"KRN","B",8989.51,8989.51)

"BLD",4850,"KRN","B",8989.52,8989.52)

"BLD",4850,"KRN","B",8994,8994)

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.0
**INSTALL NAME**
PSS*1.0*59
"BLD",4761,0)
PSS*1.0*59^PHARMACY DATA MANAGEMENT^0^3050120^y
"BLD",4761,1,0)
^^48^48^3041117^
"BLD",4761,1,1,0)
1. The Inpatient Medications Orders for Outpatients project will allow a
"BLD",4761,1,2,0)
user the ability to order unit dose medications for outpatients. This is 
"BLD",4761,1,3,0)
accomplished through modifications to Inpatient Medications V. 5.0,
"BLD",4761,1,4,0)
Computerized Patient Record System (CPRS) V. 1.0, and Scheduling V. 5.3.
"BLD",4761,1,5,0)
The purpose of this patch is to create three new fields in the PHARMACY
"BLD",4761,1,6,0)
PATIENT file (#55). In the UNIT DOSE multiple (#62), the CLINIC field
"BLD",4761,1,7,0)
(#130) and the APPOINTMENT DATE/TIME field (#131) have been added. In the
"BLD",4761,1,8,0)
IV multiple (#100), the APPOINTMENT DATE/TIME field (#139) has been added.
"BLD",4761,1,9,0)
 
"BLD",4761,1,10,0)
2. A new parameter has been added to the PHARMACY SYSTEM file (#59.7). It 
"BLD",4761,1,11,0)
is the AUTO-DC IMO ORDERS field (#26.8). This new parameter will allow 
"BLD",4761,1,12,0)
sites to control whether or not Inpatient Medications Orders for 
"BLD",4761,1,13,0)
Outpatients are automatically discontinued during patient movements. This 
"BLD",4761,1,14,0)
parameter will only be effective if sites are using Inpatient Medications 
"BLD",4761,1,15,0)
to control discontinues on patient movements. If the site is using the 
"BLD",4761,1,16,0)
CPRS auto-dc rules, this parameter will have no effect.
"BLD",4761,1,17,0)
 
"BLD",4761,1,18,0)
3. As a part of the Inpatient Medications Requirements for the Special
"BLD",4761,1,19,0)
Focus Group IRA project, this patch modifies the definition of schedules
"BLD",4761,1,20,0)
in the ADMINISTRATION SCHEDULE file (#51.1). TO accomplish this, the 
"BLD",4761,1,21,0)
following changes are being made to the PSSJ SCHEDULE EDIT input 
"BLD",4761,1,22,0)
template:
"BLD",4761,1,23,0)
     a. Do not allow entry of a schedule with the name of OTHER. 
"BLD",4761,1,24,0)
     b. Do not allow entry of administration times for odd schedules. 
"BLD",4761,1,25,0)
     c. Display the calculated frequency to the user.
"BLD",4761,1,26,0)
 
"BLD",4761,1,27,0)
4. Based on the upcoming requirement from the Joint Commission on
"BLD",4761,1,28,0)
Accreditation of Hospital Organizations, schedule names that are
"BLD",4761,1,29,0)
considered dangerous will no longer be allowed. The four schedules that 
"BLD",4761,1,30,0)
will no longer be allowed are: QD, HS, TIW and QOD. These schedules 
"BLD",4761,1,31,0)
cannot be used either alone or as part of a schedule name. For example: 
"BLD",4761,1,32,0)
QD is not allowed. Neither is QD ONCE.
"BLD",4761,1,33,0)
 
"BLD",4761,1,34,0)
5. The Inpatient Medications Requirements for the Special Focus Group IRA
"BLD",4761,1,35,0)
project will prevent users from entering free text schedules for inpatient
"BLD",4761,1,36,0)
medication orders. This patch helps accomplish this by changing the
"BLD",4761,1,37,0)
validation of schedules entered through Computerized Patient Record System
"BLD",4761,1,38,0)
(CPRS) V. 1.0. This validation requires that schedules be defined in the
"BLD",4761,1,39,0)
ADMINISTRATION SCHEDULE file (#51.1) or be a valid day-of-week, PRN or
"BLD",4761,1,40,0)
administration time schedule before allowing the schedule to be added to
"BLD",4761,1,41,0)
an inpatient order.
"BLD",4761,1,42,0)
 
"BLD",4761,1,43,0)
6. A provider entering an order into Computerized Patient Record System
"BLD",4761,1,44,0)
(CPRS) V. 1.0 must be permitted to place a limitation on the duration of
"BLD",4761,1,45,0)
an inpatient medication order. This capability exists for Unit Dose orders
"BLD",4761,1,46,0)
and Inpatient IV orders, but not for IV Fluid orders. This patch helps 
"BLD",4761,1,47,0)
accomplish this by adding a new field to the PHARMACY PATIENT file (#55), 
"BLD",4761,1,48,0)
IV multiple (#100) called REQUESTED IV LIMITATION (#152).
"BLD",4761,4,0)
^9.64PA^51.1^3
"BLD",4761,4,51.1,0)
51.1
"BLD",4761,4,51.1,2,0)
^9.641^51.1^1
"BLD",4761,4,51.1,2,51.1,0)
ADMINISTRATION SCHEDULE  (File-top level)
"BLD",4761,4,51.1,2,51.1,1,0)
^9.6411^5^3
"BLD",4761,4,51.1,2,51.1,1,.01,0)
NAME
"BLD",4761,4,51.1,2,51.1,1,2,0)
FREQUENCY (IN MINUTES)
"BLD",4761,4,51.1,2,51.1,1,5,0)
TYPE OF SCHEDULE
"BLD",4761,4,51.1,222)
y^y^p^^^^n^^n
"BLD",4761,4,51.1,224)

"BLD",4761,4,55,0)
55
"BLD",4761,4,55,2,0)
^9.641^55.06^2
"BLD",4761,4,55,2,55.01,0)
IV  (sub-file)
"BLD",4761,4,55,2,55.01,1,0)
^9.6411^136^4
"BLD",4761,4,55,2,55.01,1,.03,0)
STOP DATE/TIME
"BLD",4761,4,55,2,55.01,1,136,0)
CLINIC
"BLD",4761,4,55,2,55.01,1,139,0)
APPOINTMENT DATE/TIME
"BLD",4761,4,55,2,55.01,1,152,0)
REQUESTED IV LIMITATION
"BLD",4761,4,55,2,55.06,0)
UNIT DOSE  (sub-file)
"BLD",4761,4,55,2,55.06,1,0)
^9.6411^34^3
"BLD",4761,4,55,2,55.06,1,34,0)
STOP DATE/TIME
"BLD",4761,4,55,2,55.06,1,130,0)
CLINIC
"BLD",4761,4,55,2,55.06,1,131,0)
APPOINTMENT DATE/TIME
"BLD",4761,4,55,222)
y^y^p^^^^n^^n
"BLD",4761,4,55,224)

"BLD",4761,4,59.7,0)
59.7
"BLD",4761,4,59.7,2,0)
^9.641^59.7^1
"BLD",4761,4,59.7,2,59.7,0)
PHARMACY SYSTEM  (File-top level)
"BLD",4761,4,59.7,2,59.7,1,0)
^9.6411^26.8^1
"BLD",4761,4,59.7,2,59.7,1,26.8,0)
DC IMO ORDERS
"BLD",4761,4,59.7,222)
y^y^p^^^^n^^n
"BLD",4761,4,59.7,224)

"BLD",4761,4,"APDD",51.1,51.1)

"BLD",4761,4,"APDD",51.1,51.1,.01)

"BLD",4761,4,"APDD",51.1,51.1,2)

"BLD",4761,4,"APDD",51.1,51.1,5)

"BLD",4761,4,"APDD",55,55.01)

"BLD",4761,4,"APDD",55,55.01,.03)

"BLD",4761,4,"APDD",55,55.01,136)

"BLD",4761,4,"APDD",55,55.01,139)

"BLD",4761,4,"APDD",55,55.01,152)

"BLD",4761,4,"APDD",55,55.06)

"BLD",4761,4,"APDD",55,55.06,34)

"BLD",4761,4,"APDD",55,55.06,130)

"BLD",4761,4,"APDD",55,55.06,131)

"BLD",4761,4,"APDD",59.7,59.7)

"BLD",4761,4,"APDD",59.7,59.7,26.8)

"BLD",4761,4,"B",51.1,51.1)

"BLD",4761,4,"B",55,55)

"BLD",4761,4,"B",59.7,59.7)

"BLD",4761,"ABPKG")
n
"BLD",4761,"KRN",0)
^9.67PA^8989.52^19
"BLD",4761,"KRN",.4,0)
.4
"BLD",4761,"KRN",.401,0)
.401
"BLD",4761,"KRN",.402,0)
.402
"BLD",4761,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",4761,"KRN",.402,"NM",1,0)
PSSJ SCHEDULE EDIT    FILE #51.1^51.1^0
"BLD",4761,"KRN",.402,"NM","B","PSSJ SCHEDULE EDIT    FILE #51.1",1)

"BLD",4761,"KRN",.403,0)
.403
"BLD",4761,"KRN",.5,0)
.5
"BLD",4761,"KRN",.84,0)
.84
"BLD",4761,"KRN",3.6,0)
3.6
"BLD",4761,"KRN",3.8,0)
3.8
"BLD",4761,"KRN",9.2,0)
9.2
"BLD",4761,"KRN",9.8,0)
9.8
"BLD",4761,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4761,"KRN",9.8,"NM",1,0)
PSSGSGUI^^0^B19690697
"BLD",4761,"KRN",9.8,"NM",2,0)
PSSJSV^^0^B24455142
"BLD",4761,"KRN",9.8,"NM",3,0)
PSSGS0^^0^B14602958
"BLD",4761,"KRN",9.8,"NM","B","PSSGS0",3)

"BLD",4761,"KRN",9.8,"NM","B","PSSGSGUI",1)

"BLD",4761,"KRN",9.8,"NM","B","PSSJSV",2)

"BLD",4761,"KRN",19,0)
19
"BLD",4761,"KRN",19.1,0)
19.1
"BLD",4761,"KRN",101,0)
101
"BLD",4761,"KRN",409.61,0)
409.61
"BLD",4761,"KRN",771,0)
771
"BLD",4761,"KRN",870,0)
870
"BLD",4761,"KRN",8989.51,0)
8989.51
"BLD",4761,"KRN",8989.52,0)
8989.52
"BLD",4761,"KRN",8994,0)
8994
"BLD",4761,"KRN","B",.4,.4)

"BLD",4761,"KRN","B",.401,.401)

"BLD",4761,"KRN","B",.402,.402)

"BLD",4761,"KRN","B",.403,.403)

"BLD",4761,"KRN","B",.5,.5)

"BLD",4761,"KRN","B",.84,.84)

"BLD",4761,"KRN","B",3.6,3.6)

"BLD",4761,"KRN","B",3.8,3.8)

"BLD",4761,"KRN","B",9.2,9.2)

"BLD",4761,"KRN","B",9.8,9.8)

"BLD",4761,"KRN","B",19,19)

"BLD",4761,"KRN","B",19.1,19.1)

"BLD",4761,"KRN","B",101,101)

"BLD",4761,"KRN","B",409.61,409.61)

"BLD",4761,"KRN","B",771,771)

"BLD",4761,"KRN","B",870,870)

"BLD",4761,"KRN","B",8989.51,8989.51)

"BLD",4761,"KRN","B",8989.52,8989.52)

"BLD",4761,"KRN","B",8994,8994)

"BLD",4761,"QUES",0)
^9.62^^
"BLD",4761,"REQB",0)
^9.611^1^1
"BLD",4761,"REQB",1,0)
PSS*1.0*69^2
"BLD",4761,"REQB","B","PSS*1.0*69",1)

"FIA",51.1)
ADMINISTRATION SCHEDULE
"FIA",51.1,0)
^PS(51.1,
"FIA",51.1,0,0)
51.1I
"FIA",51.1,0,1)
y^y^p^^^^n^^n
"FIA",51.1,0,10)

"FIA",51.1,0,11)

"FIA",51.1,0,"RLRO")

"FIA",51.1,0,"VR")
1.0^PSS
"FIA",51.1,51.1)
1
"FIA",51.1,51.1,.01)

"FIA",51.1,51.1,2)

"FIA",51.1,51.1,5)

"FIA",55)
PHARMACY PATIENT
"FIA",55,0)
^PS(55,
"FIA",55,0,0)
55P
"FIA",55,0,1)
y^y^p^^^^n^^n
"FIA",55,0,10)

"FIA",55,0,11)

"FIA",55,0,"RLRO")

"FIA",55,0,"VR")
1.0^PSS
"FIA",55,55)
1
"FIA",55,55.01)
1
"FIA",55,55.01,.03)

"FIA",55,55.01,136)

"FIA",55,55.01,139)

"FIA",55,55.01,152)

"FIA",55,55.06)
1
"FIA",55,55.06,34)

"FIA",55,55.06,130)

"FIA",55,55.06,131)

"FIA",59.7)
PHARMACY SYSTEM
"FIA",59.7,0)
^PS(59.7,
"FIA",59.7,0,0)
59.7
"FIA",59.7,0,1)
y^y^p^^^^n^^n
"FIA",59.7,0,10)

"FIA",59.7,0,11)

"FIA",59.7,0,"RLRO")

"FIA",59.7,0,"VR")
1.0^PSS
"FIA",59.7,59.7)
1
"FIA",59.7,59.7,26.8)

"IX",55,55,"ACRIV",0)
55^ACRIV^Clinical Reminders index.^MU^^R^IR^W^55.01^^^^^A
"IX",55,55,"ACRIV",.1,0)
^^8^8^3041215
"IX",55,55,"ACRIV",.1,1,0)
This cross-reference builds two indexes, one for finding
"IX",55,55,"ACRIV",.1,2,0)
all patients with a particular drug and one for
"IX",55,55,"ACRIV",.1,3,0)
finding all the drugs a patient has. The indexes are
"IX",55,55,"ACRIV",.1,4,0)
stored in the Clinical Reminders index global as:
"IX",55,55,"ACRIV",.1,5,0)
 ^PXRMINDX(55,"IP",DRUG,DFN,START,STOP,DAS)
"IX",55,55,"ACRIV",.1,6,0)
 ^PXRMINDX(55,"PI",DFN,DRUG,START,STOP,DAS)
"IX",55,55,"ACRIV",.1,7,0)
respectively. START is the start date and STOP is the stop date.
"IX",55,55,"ACRIV",.1,8,0)
For all the details, see the Clinical Reminders Index Technical Guide/Programmer's Manual.
"IX",55,55,"ACRIV",1)
D SPSPA^PSJXRFS(.X,.DA,"IV")
"IX",55,55,"ACRIV",1.4)
S X=$$PATCH^XPDUTL("PXRM*1.5*12")
"IX",55,55,"ACRIV",2)
D KPSPA^PSJXRFK(.X,.DA,"IV")
"IX",55,55,"ACRIV",2.4)
S X=$$PATCH^XPDUTL("PXRM*1.5*12")
"IX",55,55,"ACRIV",2.5)
K ^PXRMINDX(55)
"IX",55,55,"ACRIV",11.1,0)
^.114IA^2^2
"IX",55,55,"ACRIV",11.1,1,0)
1^F^55.01^.02^^1^F
"IX",55,55,"ACRIV",11.1,2,0)
2^F^55.01^.03^^2^F
"IX",55,55,"ACRUD",0)
55^ACRUD^Clinical Reminders index.^MU^^R^IR^W^55.06^^^^^A
"IX",55,55,"ACRUD",.1,0)
^^8^8^3041215
"IX",55,55,"ACRUD",.1,1,0)
This cross-reference builds two indexes, one for finding
"IX",55,55,"ACRUD",.1,2,0)
all patients with a particular drug and one for
"IX",55,55,"ACRUD",.1,3,0)
finding all the drugs a patient has. The indexes are
"IX",55,55,"ACRUD",.1,4,0)
stored in the Clinical Reminders index global as:
"IX",55,55,"ACRUD",.1,5,0)
 ^PXRMINDX(55,"IP",DRUG,DFN,START,STOP,DAS)
"IX",55,55,"ACRUD",.1,6,0)
 ^PXRMINDX(55,"PI",DFN,DRUG,START,STOP,DAS)
"IX",55,55,"ACRUD",.1,7,0)
respectively. START is the start date and STOP is the stop date.
"IX",55,55,"ACRUD",.1,8,0)
For all the details, see the Clinical Reminders Index Technical Guide/Programmer's Manual.
"IX",55,55,"ACRUD",1)
D SPSPA^PSJXRFS(.X,.DA,"UD")
"IX",55,55,"ACRUD",1.4)
S X=$$PATCH^XPDUTL("PXRM*1.5*12")
"IX",55,55,"ACRUD",2)
D KPSPA^PSJXRFK(.X,.DA,"UD")
"IX",55,55,"ACRUD",2.4)
S X=$$PATCH^XPDUTL("PXRM*1.5*12")
"IX",55,55,"ACRUD",2.5)
K ^PXRMINDX(55)
"IX",55,55,"ACRUD",11.1,0)
^.114IA^2^2
"IX",55,55,"ACRUD",11.1,1,0)
1^F^55.06^10^^1^F
"IX",55,55,"ACRUD",11.1,2,0)
2^F^55.06^34^^2^F
"IX",55,55,"AIVC",0)
55^AIVC^List of patients with orders associated with clinic appointments.^R^^R^IR^W^55.01^^^^^S
"IX",55,55,"AIVC",1)
S ^PS(55,"AIVC",$E(X(1),1,20),$E(X(2),1,20),DA(1),DA)=""
"IX",55,55,"AIVC",2)
K ^PS(55,"AIVC",$E(X(1),1,20),$E(X(2),1,20),DA(1),DA)
"IX",55,55,"AIVC",2.5)
K ^PS(55,"AIVC")
"IX",55,55,"AIVC",11.1,0)
^.114IA^3^2
"IX",55,55,"AIVC",11.1,2,0)
1^F^55.01^.03^20^1^F
"IX",55,55,"AIVC",11.1,3,0)
2^F^55.01^136^20^2^F
"IX",55,55,"AUDC",0)
55^AUDC^List of patients with orders associated with clinic appointments.^R^^R^IR^W^55.06^^^^^S
"IX",55,55,"AUDC",1)
S ^PS(55,"AUDC",$E(X(1),1,20),$E(X(2),1,20),DA(1),DA)=""
"IX",55,55,"AUDC",2)
K ^PS(55,"AUDC",$E(X(1),1,20),$E(X(2),1,20),DA(1),DA)
"IX",55,55,"AUDC",2.5)
K ^PS(55,"AUDC")
"IX",55,55,"AUDC",11.1,0)
^.114IA^3^2
"IX",55,55,"AUDC",11.1,2,0)
1^F^55.06^34^20^1^F
"IX",55,55,"AUDC",11.1,3,0)
2^F^55.06^130^20^2^F
"IX",55,55.01,"AIN",0)
55.01^AIN^Clinic cross-reference.^R^^R^IR^I^55.01^^^^^S
"IX",55,55.01,"AIN",.1,0)
^^2^2^3040729^
"IX",55,55.01,"AIN",.1,1,0)
This cross-reference is used to easily determine if a specific patient 
"IX",55,55.01,"AIN",.1,2,0)
has clinic orders.
"IX",55,55.01,"AIN",1)
S ^PS(55,DA(1),"IV","AIN",X(1),X(2),DA)=""
"IX",55,55.01,"AIN",2)
K ^PS(55,DA(1),"IV","AIN",X(1),X(2),DA)
"IX",55,55.01,"AIN",2.5)
K ^PS(55,DA(1),"IV","AIN")
"IX",55,55.01,"AIN",11.1,0)
^.114IA^2^2
"IX",55,55.01,"AIN",11.1,1,0)
1^F^55.01^.03^^1^F
"IX",55,55.01,"AIN",11.1,1,3)

"IX",55,55.01,"AIN",11.1,2,0)
2^F^55.01^136^^2^F
"IX",55,55.01,"AIN",11.1,2,3)

"IX",55,55.06,"AUN",0)
55.06^AUN^Clinic cross-reference.^R^^R^IR^I^55.06^^^^^S
"IX",55,55.06,"AUN",.1,0)
^^2^2^3040729^
"IX",55,55.06,"AUN",.1,1,0)
This cross-reference is used to easily determine if a specific patient 
"IX",55,55.06,"AUN",.1,2,0)
has clinic orders.
"IX",55,55.06,"AUN",1)
S ^PS(55,DA(1),5,"AUN",X(1),X(2),DA)=""
"IX",55,55.06,"AUN",2)
K ^PS(55,DA(1),5,"AUN",X(1),X(2),DA)
"IX",55,55.06,"AUN",2.5)
K ^PS(55,DA(1),5,"AUN")
"IX",55,55.06,"AUN",11.1,0)
^.114IA^2^2
"IX",55,55.06,"AUN",11.1,1,0)
1^F^55.06^34^^1^F
"IX",55,55.06,"AUN",11.1,1,3)

"IX",55,55.06,"AUN",11.1,2,0)
2^F^55.06^130^^2^F
"IX",55,55.06,"AUN",11.1,2,3)

"KRN",.402,1854,-1)
0^1
"KRN",.402,1854,0)
PSSJ SCHEDULE EDIT^3040917.1219^@^51.1^^@^3041122
"KRN",.402,1854,"DIAB",3,1,51.11,0)
WARD ADMINISTRATION TIMES;REQ
"KRN",.402,1854,"DIAB",7,0,51.1,2)
STANDARD ADMINISTRATION TIMES;REQ
"KRN",.402,1854,"DR",1,51.1)
.01;8;8.1;@3;S:'$D(PSJIVSEF) Y="@2";5////C//;S Y=1,PSJS="C";@2;5//CONTINUOUS;I X="O" S Y="";S PSJS=X;I PSJS="D" S Y="@5" Q;@4;2//^D ENFQD^PSSJSV;I X="" W " Must enter a frequency." K X S Y="@4" Q;S PSJS=$$NSO^PSGS0(X);
"KRN",.402,1854,"DR",1,51.1,1)
W !?10,"The schedule entered equals ",PSJS,".",!;I X>1439,X#1440 S PSJS="";I X,X<1440,1440#X S PSJS="";I PSJS="" W ?10,"This is an odd schedule that does not require administration times.",!;
"KRN",.402,1854,"DR",1,51.1,2)
I PSJS="" W ?10,"BCMA will determine the administration times based off the",!;I PSJS="" W ?10,"start date/time of the medication order.";I PSJS="" S Y="@999";@5;I PSJS="" S Y=0;I PSJS'="D" S Y="@6" Q;1R~;@6;I PSJS="D" S Y="@7" Q;
"KRN",.402,1854,"DR",1,51.1,3)
1;@7;3;@999;
"KRN",.402,1854,"DR",2,51.11)
.01;I X="" S Y="@999" Q;1R~;
"MBREQ")
1
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",360,-1)
1^1
"PKG",360,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",360,20,0)
^9.402P^^
"PKG",360,22,0)
^9.49I^1^1
"PKG",360,22,1,0)
1.0^2970930^2971008^24
"PKG",360,22,1,"PAH",1,0)
59^3050120^222222243
"PKG",360,22,1,"PAH",1,1,0)
^^48^48^3050120
"PKG",360,22,1,"PAH",1,1,1,0)
1. The Inpatient Medications Orders for Outpatients project will allow a
"PKG",360,22,1,"PAH",1,1,2,0)
user the ability to order unit dose medications for outpatients. This is 
"PKG",360,22,1,"PAH",1,1,3,0)
accomplished through modifications to Inpatient Medications V. 5.0,
"PKG",360,22,1,"PAH",1,1,4,0)
Computerized Patient Record System (CPRS) V. 1.0, and Scheduling V. 5.3.
"PKG",360,22,1,"PAH",1,1,5,0)
The purpose of this patch is to create three new fields in the PHARMACY
"PKG",360,22,1,"PAH",1,1,6,0)
PATIENT file (#55). In the UNIT DOSE multiple (#62), the CLINIC field
"PKG",360,22,1,"PAH",1,1,7,0)
(#130) and the APPOINTMENT DATE/TIME field (#131) have been added. In the
"PKG",360,22,1,"PAH",1,1,8,0)
IV multiple (#100), the APPOINTMENT DATE/TIME field (#139) has been added.
"PKG",360,22,1,"PAH",1,1,9,0)
 
"PKG",360,22,1,"PAH",1,1,10,0)
2. A new parameter has been added to the PHARMACY SYSTEM file (#59.7). It 
"PKG",360,22,1,"PAH",1,1,11,0)
is the AUTO-DC IMO ORDERS field (#26.8). This new parameter will allow 
"PKG",360,22,1,"PAH",1,1,12,0)
sites to control whether or not Inpatient Medications Orders for 
"PKG",360,22,1,"PAH",1,1,13,0)
Outpatients are automatically discontinued during patient movements. This 
"PKG",360,22,1,"PAH",1,1,14,0)
parameter will only be effective if sites are using Inpatient Medications 
"PKG",360,22,1,"PAH",1,1,15,0)
to control discontinues on patient movements. If the site is using the 
"PKG",360,22,1,"PAH",1,1,16,0)
CPRS auto-dc rules, this parameter will have no effect.
"PKG",360,22,1,"PAH",1,1,17,0)
 
"PKG",360,22,1,"PAH",1,1,18,0)
3. As a part of the Inpatient Medications Requirements for the Special
"PKG",360,22,1,"PAH",1,1,19,0)
Focus Group IRA project, this patch modifies the definition of schedules
"PKG",360,22,1,"PAH",1,1,20,0)
in the ADMINISTRATION SCHEDULE file (#51.1). TO accomplish this, the 
"PKG",360,22,1,"PAH",1,1,21,0)
following changes are being made to the PSSJ SCHEDULE EDIT input 
"PKG",360,22,1,"PAH",1,1,22,0)
template:
"PKG",360,22,1,"PAH",1,1,23,0)
     a. Do not allow entry of a schedule with the name of OTHER. 
"PKG",360,22,1,"PAH",1,1,24,0)
     b. Do not allow entry of administration times for odd schedules. 
"PKG",360,22,1,"PAH",1,1,25,0)
     c. Display the calculated frequency to the user.
"PKG",360,22,1,"PAH",1,1,26,0)
 
"PKG",360,22,1,"PAH",1,1,27,0)
4. Based on the upcoming requirement from the Joint Commission on
"PKG",360,22,1,"PAH",1,1,28,0)
Accreditation of Hospital Organizations, schedule names that are
"PKG",360,22,1,"PAH",1,1,29,0)
considered dangerous will no longer be allowed. The four schedules that 
"PKG",360,22,1,"PAH",1,1,30,0)
will no longer be allowed are: QD, HS, TIW and QOD. These schedules 
"PKG",360,22,1,"PAH",1,1,31,0)
cannot be used either alone or as part of a schedule name. For example: 
"PKG",360,22,1,"PAH",1,1,32,0)
QD is not allowed. Neither is QD ONCE.
"PKG",360,22,1,"PAH",1,1,33,0)
 
"PKG",360,22,1,"PAH",1,1,34,0)
5. The Inpatient Medications Requirements for the Special Focus Group IRA
"PKG",360,22,1,"PAH",1,1,35,0)
project will prevent users from entering free text schedules for inpatient
"PKG",360,22,1,"PAH",1,1,36,0)
medication orders. This patch helps accomplish this by changing the
"PKG",360,22,1,"PAH",1,1,37,0)
validation of schedules entered through Computerized Patient Record System
"PKG",360,22,1,"PAH",1,1,38,0)
(CPRS) V. 1.0. This validation requires that schedules be defined in the
"PKG",360,22,1,"PAH",1,1,39,0)
ADMINISTRATION SCHEDULE file (#51.1) or be a valid day-of-week, PRN or
"PKG",360,22,1,"PAH",1,1,40,0)
administration time schedule before allowing the schedule to be added to
"PKG",360,22,1,"PAH",1,1,41,0)
an inpatient order.
"PKG",360,22,1,"PAH",1,1,42,0)
 
"PKG",360,22,1,"PAH",1,1,43,0)
6. A provider entering an order into Computerized Patient Record System
"PKG",360,22,1,"PAH",1,1,44,0)
(CPRS) V. 1.0 must be permitted to place a limitation on the duration of
"PKG",360,22,1,"PAH",1,1,45,0)
an inpatient medication order. This capability exists for Unit Dose orders
"PKG",360,22,1,"PAH",1,1,46,0)
and Inpatient IV orders, but not for IV Fluid orders. This patch helps 
"PKG",360,22,1,"PAH",1,1,47,0)
accomplish this by adding a new field to the PHARMACY PATIENT file (#55), 
"PKG",360,22,1,"PAH",1,1,48,0)
IV multiple (#100) called REQUESTED IV LIMITATION (#152).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSSGS0")
0^3^B14602958
"RTN","PSSGS0",1,0)
PSSGS0 ;BIR/CML3-SCHEDULE PROCESSOR ;06/01/98
"RTN","PSSGS0",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**12,27,38,44,56,69,59**;9/30/97
"RTN","PSSGS0",3,0)
 ;Reference to $$TRIM^XLFSTR supported by DBIA #10104
"RTN","PSSGS0",4,0)
 ;Reference to ^PS(53.1 supported by DBIA #2140
"RTN","PSSGS0",5,0)
 ;
"RTN","PSSGS0",6,0)
ENA ; entry point for train option
"RTN","PSSGS0",7,0)
 ;N X S X="PSGSETU" X ^%ZOSF("TEST") I  D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSSGS0",8,0)
 ;F  S (PSGS0Y,PSGS0XT)="" R !!,"Select STANDARD SCHEDULE: ",X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" ENQ^PSSGSH I X'?1."?" D EN W:$D(X)[0 $C(7),"  ??" I $D(X)#2,'PSGS0Y,PSGS0XT W "  Every ",PSGS0XT," minutes"
"RTN","PSSGS0",9,0)
 ;K DIC,DIE,PSGS0XT,PSGS0Y,Q,X,Y,PSGDT Q
"RTN","PSSGS0",10,0)
 Q
"RTN","PSSGS0",11,0)
 ;
"RTN","PSSGS0",12,0)
EN3 ;
"RTN","PSSGS0",13,0)
 S PSGST=$P($G(^PS(53.1,DA,0)),"^",7) G EN
"RTN","PSSGS0",14,0)
 ;
"RTN","PSSGS0",15,0)
EN5 ;
"RTN","PSSGS0",16,0)
 S PSGST=$P($G(^PS(55,DA(1),5,DA,0)),"^",7)
"RTN","PSSGS0",17,0)
 ;
"RTN","PSSGS0",18,0)
EN(X,PSSLSTPK) ; validate
"RTN","PSSGS0",19,0)
 ;I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>2)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N")!($E(X,1)=" ") K X Q
"RTN","PSSGS0",20,0)
 I $G(PSSLSTPK)="O"!(PSSLSTPK="X") Q:$G(X)=""  G ENOP
"RTN","PSSGS0",21,0)
 I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>3)!($L(X)>70)!($L(X)<1) K X Q
"RTN","PSSGS0",22,0)
 S X=$$TRIM^XLFSTR(X,"R"," ")
"RTN","PSSGS0",23,0)
 I X?.E1L.E S X=$$ENLU^PSSGMI(X)
"RTN","PSSGS0",24,0)
 ;
"RTN","PSSGS0",25,0)
ENOS ; order set entry
"RTN","PSSGS0",26,0)
 S (PSGS0XT,PSGS0Y,XT,Y)=""
"RTN","PSSGS0",27,0)
 I X="OTHER" G Q
"RTN","PSSGS0",28,0)
 I X["PRN",$$PRNOK(X) G Q
"RTN","PSSGS0",29,0)
 S X0=X I X,X'["X",(X?2.4N1"-".E!(X?2.4N)) D ENCHK S:$D(X) Y=X G Q
"RTN","PSSGS0",30,0)
 I $S($D(^PS(51.1,"AC","PSJ",X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC I XT]"" G Q
"RTN","PSSGS0",31,0)
 I X["@" D DW S:$D(X) Y=$P(X,"@",2) G Q
"RTN","PSSGS0",32,0)
 I $G(PSGSCH)=X S PSGS0Y=$G(PSGAT) Q
"RTN","PSSGS0",33,0)
 K X Q
"RTN","PSSGS0",34,0)
 ;
"RTN","PSSGS0",35,0)
NS I (X="^")!(X="") K X Q
"RTN","PSSGS0",36,0)
 I Y'>0 S X=X0,Y=""
"RTN","PSSGS0",37,0)
Q ;
"RTN","PSSGS0",38,0)
 S PSGS0XT=$S(XT]"":XT,1:""),PSGS0Y=$S(Y:Y,1:"") K QX,SDW,SWD,X0,XT,Z Q
"RTN","PSSGS0",39,0)
 ;
"RTN","PSSGS0",40,0)
ENCHK ;
"RTN","PSSGS0",41,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q
"RTN","PSSGS0",42,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q
"RTN","PSSGS0",43,0)
 S X(1)=$L(X(1)) I X'["-",X>$E(2400,1,X(1)) K X Q
"RTN","PSSGS0",44,0)
 F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$E(2400,1,X(1)):1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSSGS0",45,0)
 K:$D(X) X(1),X(2),X(3) Q
"RTN","PSSGS0",46,0)
 ;
"RTN","PSSGS0",47,0)
ENOP ;
"RTN","PSSGS0",48,0)
 I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>3)!($L(X)>20)!($L(X)<1) K X Q
"RTN","PSSGS0",49,0)
 N PSSUPPER S X=$$UPPER(X)
"RTN","PSSGS0",50,0)
 K Y,DIC S DIC="^PS(51.1,",DIC(0)="E",D="APPSJ",DIC("W")="D DICW^PSSGS0" D IX^DIC I Y>0 S X=$P(Y,"^",2) Q
"RTN","PSSGS0",51,0)
 K Y,DIC S DIC=51,DIC(0)="ME" D ^DIC I Y>0 S X=$P(Y,"^",2)
"RTN","PSSGS0",52,0)
 Q
"RTN","PSSGS0",53,0)
DIC ;
"RTN","PSSGS0",54,0)
 K DIC S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(PSGOES))_"ISZ",DIC("W")="W ""  "","_$S('$D(PSJPWD):"$P(^(0),""^"",2)",'PSJPWD:"$P(^(0),""^"",2)",1:"$S($D(^PS(51.1,+Y,1,+PSJPWD,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"),D="APPSJ"
"RTN","PSSGS0",55,0)
 S DIC("W")=""
"RTN","PSSGS0",56,0)
 I $D(PSGST) S DIC("S")="I $P(^(0),""^"",5)"_$E("'",PSGST'="O")_"=""O"""
"RTN","PSSGS0",57,0)
 D IX^DIC K DIC S:$D(DIE)#2 DIC=DIE Q:Y'>0
"RTN","PSSGS0",58,0)
 S XT=$S("C"[$P(Y(0),"^",5):$P(Y(0),"^",3),1:$P(Y(0),"^",5)),X=+Y,Y="" I $D(PSJPWD),$D(^PS(51.1,X,1,+PSJPWD,0)) S Y=$P(^(0),"^",2)
"RTN","PSSGS0",59,0)
 S (X,X0)=Y(0,0) S:Y="" Y=$P(Y(0),"^",2) Q
"RTN","PSSGS0",60,0)
DW ;
"RTN","PSSGS0",61,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2) D ENCHK Q:'$D(X)  S X=$P(SDW,"@"),X(1)="-" I X?.E1P.E,X'["-" F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSSGS0",62,0)
 F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSSGS0",63,0)
 K X(1) S:$D(X) X=SDW Q
"RTN","PSSGS0",64,0)
DWC I $L(Z)<2 K X Q
"RTN","PSSGS0",65,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSSGS0",66,0)
 E  K X
"RTN","PSSGS0",67,0)
 Q
"RTN","PSSGS0",68,0)
 ;
"RTN","PSSGS0",69,0)
UPPER(PSSUPPER) ;
"RTN","PSSGS0",70,0)
 Q $TR(PSSUPPER,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PSSGS0",71,0)
DICW ; 
"RTN","PSSGS0",72,0)
 S Z=^PS(51.1,+Y,0) W $P(Z,"^",8) Q
"RTN","PSSGS0",73,0)
PRNOK(PSCH) ;
"RTN","PSSGS0",74,0)
 Q:PSCH'["PRN" 0
"RTN","PSSGS0",75,0)
 I $TR(PSCH," ")="PRN" Q 1
"RTN","PSSGS0",76,0)
 N BASE,I,OK S OK=0 S I=$P(PSCH," PRN") I I]"",$D(^PS(51.1,"AC","PSJ",I)) S OK=1
"RTN","PSSGS0",77,0)
 I 'OK D
"RTN","PSSGS0",78,0)
 .I PSCH["@" I $D(^PS(51.1,"AC","PSJ",$P(PSCH,"@")))!$$DOW^PSIVUTL($P(PSCH,"@")) S OK=1 Q
"RTN","PSSGS0",79,0)
 .I $$DOW^PSIVUTL($TR(PSCH," PRN")) S OK=1
"RTN","PSSGS0",80,0)
 Q OK
"RTN","PSSGSGUI")
0^1^B19690697
"RTN","PSSGSGUI",1,0)
PSSGSGUI ;BIR/CML3-SCHEDULE PROCESSOR FOR GUI ONLY ;05/29/98
"RTN","PSSGSGUI",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**12,27,38,44,56,59**;9/30/97
"RTN","PSSGSGUI",3,0)
 ;
"RTN","PSSGSGUI",4,0)
 ;Reference to ^PS(53.1 supported by DBIA #2140
"RTN","PSSGSGUI",5,0)
 ;
"RTN","PSSGSGUI",6,0)
ENA ; entry point for train option
"RTN","PSSGSGUI",7,0)
 ;N X S X="PSGSETU" X ^%ZOSF("TEST") I  D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSSGSGUI",8,0)
 ;F  S (PSGS0Y,PSGS0XT)="" R !!,"Select STANDARD SCHEDULE: ",X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" ENQ^PSSGSH I X'?1."?" D EN W:$D(X)[0 $C(7),"  ??" I $D(X)#2,'PSGS0Y,PSGS0XT W "  Every ",PSGS0XT," minutes"
"RTN","PSSGSGUI",9,0)
 ;K DIC,DIE,PSGS0XT,PSGS0Y,Q,X,Y,PSGDT Q
"RTN","PSSGSGUI",10,0)
 Q
"RTN","PSSGSGUI",11,0)
 ;
"RTN","PSSGSGUI",12,0)
EN3 ;
"RTN","PSSGSGUI",13,0)
 S PSGST=$P($G(^PS(53.1,DA,0)),"^",7) G EN
"RTN","PSSGSGUI",14,0)
 ;
"RTN","PSSGSGUI",15,0)
EN5 ;
"RTN","PSSGSGUI",16,0)
 S PSGST=$P($G(^PS(55,DA(1),5,DA,0)),"^",7)
"RTN","PSSGSGUI",17,0)
 ;
"RTN","PSSGSGUI",18,0)
EN(X,PSSGUIPK) ; validate
"RTN","PSSGSGUI",19,0)
 ;I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>2)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N")!($E(X,1)=" ") K X Q
"RTN","PSSGSGUI",20,0)
 I $G(PSSGUIPK)="O" D  Q
"RTN","PSSGSGUI",21,0)
 .Q:$G(X)=""
"RTN","PSSGSGUI",22,0)
 .I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>3)!($L(X)>20)!($L(X)<1) K X Q
"RTN","PSSGSGUI",23,0)
 .N PSSUPGUI S X=$$UPPER(X)
"RTN","PSSGSGUI",24,0)
 ;I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>3)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N")!($E(X,1)=" ") K X Q
"RTN","PSSGSGUI",25,0)
 I $TR(X," ")="PRN" S X="PRN"
"RTN","PSSGSGUI",26,0)
 S X=$$TRIM^XLFSTR(X,"R"," ")
"RTN","PSSGSGUI",27,0)
 I X?.E1L.E S X=$$ENLU^PSSGMI(X)
"RTN","PSSGSGUI",28,0)
 ;I X["Q0" K X Q
"RTN","PSSGSGUI",29,0)
 ;
"RTN","PSSGSGUI",30,0)
ENOS ; order set entry
"RTN","PSSGSGUI",31,0)
 ; NSS
"RTN","PSSGSGUI",32,0)
 S (PSGS0XT,PSGS0Y,XT,Y)="" ;I X["PRN"!(X="ON CALL")!(X="ONCALL")!(X="ON-CALL")!($D(^PS(51.1,"APPSJ",X))) G Q
"RTN","PSSGSGUI",33,0)
 I $L(X)>63!(X?.E1C.E) S OK=0 G Q
"RTN","PSSGSGUI",34,0)
 I X["PRN",$$PRNOK^PSSGS0(X) G Q
"RTN","PSSGSGUI",35,0)
 I $D(^PS(51.1,"APPSJ",X)) S OK=1 G Q
"RTN","PSSGSGUI",36,0)
 I X="PRN" S OK=1 G Q
"RTN","PSSGSGUI",37,0)
 I X["PRN" D  I OK G Q
"RTN","PSSGSGUI",38,0)
 . S OK=0 F I=1:1:2 S A=$P($TR(X," "),"PRN",I) Q:A]""
"RTN","PSSGSGUI",39,0)
 . Q:A=""  N X S X=A
"RTN","PSSGSGUI",40,0)
 . I $D(^PS(51.1,"APPSJ",X)) S OK=1 Q
"RTN","PSSGSGUI",41,0)
 . I X?2.4N1"-".E!(X?2.4N) D ENCHK I $D(X) S OK=1 Q
"RTN","PSSGSGUI",42,0)
 . D DW I $D(X) S OK=1
"RTN","PSSGSGUI",43,0)
 S X0=X I X,X'["X",(X?2.4N1"-".E!(X?2.4N)) D ENCHK S:$D(X) Y=X G Q
"RTN","PSSGSGUI",44,0)
 I $S($D(^PS(51.1,"AC","PSJ",X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC I XT]"" G Q
"RTN","PSSGSGUI",45,0)
 I X?2.4N1"-".E!(X?2.4N) D ENCHK S:$D(X) Y=X G Q
"RTN","PSSGSGUI",46,0)
 ;D DW G Q
"RTN","PSSGSGUI",47,0)
 N TMPSCHX S TMPSCHX=X S TMPX=X D DW I $G(X)]"" K PSJNSS S PSGSCH=X S:'$D(^PS(51.1,"AC","PSJ",$P(TMPSCHX,"@"))) (PSGS0XT,XT)="D" S Y=$P(TMPSCHX,"@",2) G Q
"RTN","PSSGSGUI",48,0)
 ;I Y'>0,$S(X="NOW":1,X="ONCE":1,X="STAT":1,X="ONE TIME":1,X="ONETIME":1,X="1TIME":1,X="1 TIME":1,X="1-TIME":1,1:X="ONE-TIME") W:'$D(PSGOES) "  (ONCE ONLY)" S Y="",XT="O" G Q
"RTN","PSSGSGUI",49,0)
 ;I $G(PSGSCH)=X S PSGS0Y=$G(PSGAT) Q
"RTN","PSSGSGUI",50,0)
 K X Q
"RTN","PSSGSGUI",51,0)
 ;
"RTN","PSSGSGUI",52,0)
NS I (X="^")!(X="") K X Q
"RTN","PSSGSGUI",53,0)
 I Y'>0 S X=X0,Y=""
"RTN","PSSGSGUI",54,0)
 I $E(X,1,2)="AD" K X G Q
"RTN","PSSGSGUI",55,0)
 I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S XT=1440/$F("BTQ",$E(X)) G Q
"RTN","PSSGSGUI",56,0)
 S:$E(X)="Q" X=$E(X,2,99) S:'X X="1"_X S X1=+X,X=$P(X,+X,2),X2=0 S:X1<0 X1=-X1 S:$E(X)="X" X2=1,X=$E(X,2,99)
"RTN","PSSGSGUI",57,0)
 S XT=$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:-1) I XT<0,Y'>0 K X G Q
"RTN","PSSGSGUI",58,0)
 S X=X0 I XT S:X2 XT=XT\X1 I 'X2 S:$E(X,1,2)="QO" XT=XT*2 S XT=XT*X1
"RTN","PSSGSGUI",59,0)
 ;
"RTN","PSSGSGUI",60,0)
Q ;
"RTN","PSSGSGUI",61,0)
 S PSGS0XT=$S(XT]"":XT,1:""),PSGS0Y=$S(Y:Y,1:"") K QX,SDW,SWD,X0,XT,Z Q
"RTN","PSSGSGUI",62,0)
 ;
"RTN","PSSGSGUI",63,0)
ENCHK ;
"RTN","PSSGSGUI",64,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q
"RTN","PSSGSGUI",65,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q
"RTN","PSSGSGUI",66,0)
 S X(1)=$L(X(1)) I X'["-",X>$E(2400,1,X(1)) K X Q
"RTN","PSSGSGUI",67,0)
 F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$E(2400,1,X(1)):1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSSGSGUI",68,0)
 K:$D(X) X(1),X(2),X(3) Q
"RTN","PSSGSGUI",69,0)
 ;
"RTN","PSSGSGUI",70,0)
DIC ;
"RTN","PSSGSGUI",71,0)
 K DIC S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(PSGOES))_"ISZ"_"X",DIC("W")="W ""  "","_$S('$D(PSJPWD):"$P(^(0),""^"",2)",'PSJPWD:"$P(^(0),""^"",2)",1:"$S($D(^PS(51.1,+Y,1,+PSJPWD,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"),D="APPSJ"
"RTN","PSSGSGUI",72,0)
 S DIC("W")=""
"RTN","PSSGSGUI",73,0)
 ; Naked reference below refers to global reference ^PS(51.1 stored in variable DIC. 
"RTN","PSSGSGUI",74,0)
 I $D(PSGST) S DIC("S")="I $P(^(0),""^"",5)"_$E("'",PSGST'="O")_"=""O"""
"RTN","PSSGSGUI",75,0)
 D IX^DIC K DIC S:$D(DIE)#2 DIC=DIE Q:Y'>0
"RTN","PSSGSGUI",76,0)
 S XT=$S("C"[$P(Y(0),"^",5):$P(Y(0),"^",3),1:$P(Y(0),"^",5)),X=+Y,Y="" I $D(PSJPWD),$D(^PS(51.1,X,1,+PSJPWD,0)) S Y=$P(^(0),"^",2)
"RTN","PSSGSGUI",77,0)
 S (X,X0)=Y(0,0) S:Y="" Y=$P(Y(0),"^",2) Q
"RTN","PSSGSGUI",78,0)
 ;DW     ;
"RTN","PSSGSGUI",79,0)
 ;S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2)
"RTN","PSSGSGUI",80,0)
 ;I X]"" D ENCHK Q:'$D(X)
"RTN","PSSGSGUI",81,0)
 ;S X=$P(SDW,"@"),X(1)="-" I X?.E1P.E,X'["-" F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSSGSGUI",82,0)
 ;F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSSGSGUI",83,0)
 ;K X(1) S:$D(X) X=SDW Q
"RTN","PSSGSGUI",84,0)
 ;DWC    I $L(Z)<2 K X Q
"RTN","PSSGSGUI",85,0)
 ;F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSSGSGUI",86,0)
 ;E  K X
"RTN","PSSGSGUI",87,0)
 ;Q
"RTN","PSSGSGUI",88,0)
 ;
"RTN","PSSGSGUI",89,0)
DW ;
"RTN","PSSGSGUI",90,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2) N XABB S XABB=""
"RTN","PSSGSGUI",91,0)
 I X]"" D ENCHK Q:'$D(X)
"RTN","PSSGSGUI",92,0)
 S X=$P(SDW,"@"),X(1)="-"  ;I X?.E1P.E,X'["-" F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSSGSGUI",93,0)
 F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSSGSGUI",94,0)
 I $D(X) F II=1:1:$L(X,X(1)) S XABB=$G(XABB)_$E($P(X,X(1),II),1,2)_"-"
"RTN","PSSGSGUI",95,0)
 K X(1) S:$D(X) X=SDW I $G(X)]"" I $TR(XABB,"-")]"" S X=$E($G(XABB),1,$L(XABB)-1)
"RTN","PSSGSGUI",96,0)
 Q
"RTN","PSSGSGUI",97,0)
DWC I $L(Z)<2 K X Q
"RTN","PSSGSGUI",98,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSSGSGUI",99,0)
 E  K X
"RTN","PSSGSGUI",100,0)
 Q
"RTN","PSSGSGUI",101,0)
 ;
"RTN","PSSGSGUI",102,0)
UPPER(PSSUPGUI) ;
"RTN","PSSGSGUI",103,0)
 Q $TR(PSSUPGUI,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PSSJSV")
0^2^B24455142
"RTN","PSSJSV",1,0)
PSSJSV ;BIR/CML3/WRT-SCHEDULE VALIDATION ;06/24/96
"RTN","PSSJSV",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**20,38,56,59**;9/30/97
"RTN","PSSJSV",3,0)
 ;
"RTN","PSSJSV",4,0)
 ; Reference to ^PS(51.15 is supported by DBIA #2132
"RTN","PSSJSV",5,0)
 ;
"RTN","PSSJSV",6,0)
EN ;
"RTN","PSSJSV",7,0)
 S X=PSJX,(PSJAT,PSJM,PSJTS,PSJY,PSJAX)="" I $S(X["""":1,$A(X)=45:1,X'?.ANP:1,$L(X," ")>2:1,$L(X)>70:1,$L(X)<1:1,X["P RN":1,1:X["PR N") K PSJX,X Q
"RTN","PSSJSV",8,0)
 I X["PRN"!(X="ON CALL")!(X="ONCALL")!(X="ON-CALL") G DONE
"RTN","PSSJSV",9,0)
 I X?1."?" D:'$D(PSJNE) ENSVH^PSSJSV0 Q
"RTN","PSSJSV",10,0)
 S X0=X,(XT,Y)="" I X,X'["X",(X?2.4N1"-".E!(X?2.4N)) D ENCHK S:$D(X) PSJAT=X G DONE
"RTN","PSSJSV",11,0)
 I X["@" D DW S:$D(X) PSJAT=$P(X,"@",2) G DONE
"RTN","PSSJSV",12,0)
 I $S($D(^PS(51.1,"AC",PSJPP,X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC G:$S(PSJY:PSJTS'="C",1:PSJM) DONE
"RTN","PSSJSV",13,0)
 I $S(X="NOW":1,X="ONCE":1,X="STAT":1,X="ONE TIME":1,X="ONETIME":1,X="1TIME":1,X="1-TIME":1,X="1 TIME":1,1:X="ONE-TIME") S PSJTS="O" W:'$D(PSJNE) "  (ONCE ONLY)" G DONE
"RTN","PSSJSV",14,0)
 S:PSJTS="" PSJTS="C" I PSJAT="" W:'$D(PSJNE) "  (Non standard schedule)" S X=PSJX
"RTN","PSSJSV",15,0)
 I $E(X,1,2)="AD" K X G DONE
"RTN","PSSJSV",16,0)
 I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S PSJM=1440\$F("BTQ",$E(X)) G DONE
"RTN","PSSJSV",17,0)
 S:$E(X)="Q" X=$E(X,2,99) S:'X X="1"_X S X1=+X,X=$P(X,+X,2),X2=0 S:X1<0 X1=-X1 S:$E(X)="X" X2=X1,X=$E(X,2,99) I 'X2,$E(X)="O" S X2=.5,X=$E(X,2,99)
"RTN","PSSJSV",18,0)
 S XT=$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:-1) I XT<0,PSJAT="" K X G DONE
"RTN","PSSJSV",19,0)
 S X=PSJX I XT S:X2 XT=XT\X2 S:'X2 XT=XT*X1
"RTN","PSSJSV",20,0)
 S PSJM=XT
"RTN","PSSJSV",21,0)
 ;
"RTN","PSSJSV",22,0)
DONE ;
"RTN","PSSJSV",23,0)
 K:$D(X)[0 PSJX K D,DIC,Q,QX,SDW,SWD,X,X0,X1,X2,XT,Y,Z Q
"RTN","PSSJSV",24,0)
 ;
"RTN","PSSJSV",25,0)
ENCHK ; admin times
"RTN","PSSJSV",26,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q
"RTN","PSSJSV",27,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q
"RTN","PSSJSV",28,0)
 S X(1)=$L(X(1)) F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$S(X(1)=2:24,1:2400):1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSSJSV",29,0)
 K:$D(X) X(1),X(2),X(3) Q
"RTN","PSSJSV",30,0)
 ;
"RTN","PSSJSV",31,0)
DIC ; 51.1 look-up
"RTN","PSSJSV",32,0)
 S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(PSJNE))_"ISZ",DIC("W")="I '$D(PSJNE) D DICW^PSSJSV0",D="AP"_PSJPP
"RTN","PSSJSV",33,0)
 D IX^DIC K DIC Q:Y'>0  S PSJY=+Y,(PSJX,X,X0)=Y(0,0),PSJM=$P(Y(0),"^",3),PSJTS=$P(Y(0),"^",5),PSJAX=$P(Y(0),U,7) S:PSJTS="" PSJTS="C" Q:PSJTS="O"!(PSJTS["R")  I $D(PSJW),$D(^PS(51.1,+Y,1,+PSJW,0)) S PSJAT=$P(^(0),"^",PSJTS="S"+2)
"RTN","PSSJSV",34,0)
 E  S PSJAT=$P(Y(0),"^",PSJTS="S"*4+2)
"RTN","PSSJSV",35,0)
 Q:PSJTS'="S"
"RTN","PSSJSV",36,0)
 F Y=1:1:$L(PSJAT,"-") S Y(1)=$P(PSJAT,"-",Y),PSJAT(Y(1))="",Y(2)=$O(^PS(51.15,"ACP",PSJPP,Y(1),0)) I Y(2),$D(^PS(51.15,Y(2),0)) S PSJAT(Y(1))=$P(^(0),"^",3) I $D(PSJW),$D(^(1,PSJW,0)),$P(^(0),"^",2)]"" S PSJAT(Y(1))=$P(^(0),"^",2)
"RTN","PSSJSV",37,0)
 Q
"RTN","PSSJSV",38,0)
 ;
"RTN","PSSJSV",39,0)
DW ;  week days
"RTN","PSSJSV",40,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2) D ENCHK Q:'$D(X)  S X=$P(SDW,"@"),X(1)="-" I X?.E1P.E,X'["-" F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSSJSV",41,0)
 F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSSJSV",42,0)
 K X(1) S:$D(X) X=SDW Q
"RTN","PSSJSV",43,0)
DWC I $L(Z)<2 K X Q
"RTN","PSSJSV",44,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSSJSV",45,0)
 E  K X
"RTN","PSSJSV",46,0)
 Q
"RTN","PSSJSV",47,0)
 ;
"RTN","PSSJSV",48,0)
ENSNV ; schedule name
"RTN","PSSJSV",49,0)
 I $S(X["""":1,$A(X)=45:1,X'?.ANP:1,$L(X)>20:1,$L(X)<2:1,1:X?1P.E) K X Q
"RTN","PSSJSV",50,0)
 I $S('$D(PSJPP):0,PSJPP="":1,PSJPP'?.ANP:1,1:'$$VERSION^XPDUTL(PSJPP)) K X
"RTN","PSSJSV",51,0)
 I $D(DA),$D(^PS(51.1,DA,0)),$P(^(0),"^",5)["D" S ZX=X D DNVX S:$D(X) X=ZX K Z1,Z2,Z3,Z4,ZX
"RTN","PSSJSV",52,0)
 Q
"RTN","PSSJSV",53,0)
 ;
"RTN","PSSJSV",54,0)
ENSHV ;  shift in 51.1
"RTN","PSSJSV",55,0)
 I $S($L(X)>11:1,$L(X)<1:1,'$D(PSJPP):1,PSJPP="":1,PSJPP'?.ANP:1,1:'$$VERSION^XPDUTL(PSJPP)) K X Q
"RTN","PSSJSV",56,0)
 F X(1)=1:1:$L(X,"-") S X(2)=$P(X,"-",X(1)) I $S(X(2)="":1,X(2)'?.ANP:1,1:'$D(^PS(51.15,"ACP",PSJPP,X(2)))) K X Q
"RTN","PSSJSV",57,0)
 K X(1),X(2) Q
"RTN","PSSJSV",58,0)
 ;
"RTN","PSSJSV",59,0)
ENVSST ;  shift start/stop times
"RTN","PSSJSV",60,0)
 I X'?2N1"-"2N,X'?4N1"-"4N K X Q
"RTN","PSSJSV",61,0)
 F X(1)=1,2 I $P(X,"-",X(1))>$S($L($P(X,"-",X(1)))<4:24,1:2400) K X Q
"RTN","PSSJSV",62,0)
 K X(1) Q
"RTN","PSSJSV",63,0)
 ;
"RTN","PSSJSV",64,0)
ENFQD ; frequency default
"RTN","PSSJSV",65,0)
 N X1,X2,Z S Z=$S($D(^PS(51.1,DA,0)):$P(^(0),"^"),1:""),X=""
"RTN","PSSJSV",66,0)
 S X=$P(Z,"^",3) I Z]"" Q
"RTN","PSSJSV",67,0)
 S Z=DA I $E(Z,1,2)="AD" Q
"RTN","PSSJSV",68,0)
 I $E(Z,1,3)="BID"!($E(Z,1,3)="TID")!($E(Z,1,3)="QID") S X=1440/$F("BTQ",$E(Z)) Q
"RTN","PSSJSV",69,0)
 E  S:$E(Z)="Q" Z=$E(Z,2,99) S:'Z Z="1"_Z S X1=+Z,Z=$P(Z,+Z,2),X2=0 S:$E(Z)="X" X2=X1,Z=$E(Z,2,99) I 'X2,$E(Z)="O" S X2=.5,Z=$E(Z,2,99)
"RTN","PSSJSV",70,0)
 S X=$S(Z["'":1,(Z["D"&(Z'["AD"))!(Z["AM")!(Z["PM")!(Z["HS"&(Z'["THS")):1440,Z["H"&(Z'["TH"):60,Z["AC"!(Z["PC"):480,Z["W":10080,Z["M":40320,1:"") Q:'X  S:X2 X=X\X2 S:'X2 X=X*X1 Q
"RTN","PSSJSV",71,0)
 ;
"RTN","PSSJSV",72,0)
ENDNV ; day of the week name
"RTN","PSSJSV",73,0)
 N Z1,Z2,Z3,Z4 S X=$S($D(^PS(51.1,DA,0)):$P(^(0),"^"),1:"") I X="" K X Q
"RTN","PSSJSV",74,0)
 ;
"RTN","PSSJSV",75,0)
DNVX S Z2=1,Z4="-" I X'["-",X?.E1P.E F Z1=1:1:$L(X) I $E(X,Z1)?1P S Z4=$E(X,Z1) Q
"RTN","PSSJSV",76,0)
 F Z1=1:1:$L(X,Z4) Q:'Z2  S Z2=0 I $L($P(X,Z4,Z1))>1 F Z3="MONDAYS","TUESDAYS","WEDNESDAYS","THURSDAYS","FRIDAYS","SATURDAYS","SUNDAYS" I $P(Z3,$P(X,Z4,Z1))="" S Z2=1 Q
"RTN","PSSJSV",77,0)
 K:'Z2 X S:Z2 X="D" Q
"RTN","PSSJSV",78,0)
ENPSJ ;validate schedule names for PSJ package
"RTN","PSSJSV",79,0)
 N A,B,I
"RTN","PSSJSV",80,0)
 I $G(PSJPP)'="PSJ" Q
"RTN","PSSJSV",81,0)
 S A=$TR(X,".","") I A="OTHER" K X Q
"RTN","PSSJSV",82,0)
 F I=1:1:$L(A," ") S B=$P(A," ",I) I B="QD"!(B="QOD")!(B="HS")!(B="TIW") K X
"RTN","PSSJSV",83,0)
 Q
"UP",55,55.01,-1)
55^IV
"UP",55,55.01,0)
55.01
"UP",55,55.06,-1)
55^5
"UP",55,55.06,0)
55.06
"VER")
8.0^22.0
"^DD",51.1,51.1,.01,0)
NAME^RFX^^0;1^D ENPSJ^PSSJSV Q:'$D(X)  K:X[""""!($A(X)=45) X I $D(X) K:$L(X," ")>3!($L(X)>20)!($L(X)<2) X
"^DD",51.1,51.1,.01,1,0)
^.1
"^DD",51.1,51.1,.01,1,1,0)
51.1^B
"^DD",51.1,51.1,.01,1,1,1)
S ^PS(51.1,"B",$E(X,1,30),DA)=""
"^DD",51.1,51.1,.01,1,1,2)
K ^PS(51.1,"B",$E(X,1,30),DA)
"^DD",51.1,51.1,.01,1,2,0)
51.1^AUWD^MUMPS
"^DD",51.1,51.1,.01,1,2,1)
S ^PS(51.1,"AUWD")=$S($D(^PS(59.7,1,20)):$P(^(20),"^"),1:"")
"^DD",51.1,51.1,.01,1,2,2)
Q
"^DD",51.1,51.1,.01,1,2,"%D",0)
^^3^3^2970926^^^
"^DD",51.1,51.1,.01,1,2,"%D",1,0)
Used by the Unit Dose inits to determine if a conversion process needs to
"^DD",51.1,51.1,.01,1,2,"%D",2,0)
be run on this file.
"^DD",51.1,51.1,.01,1,2,"%D",3,0)
In the form of: ^PS(51.1,"AUWD")
"^DD",51.1,51.1,.01,1,3,0)
51.1^ACC^MUMPS
"^DD",51.1,51.1,.01,1,3,1)
I $D(^PS(51.1,DA,0)),$P(^(0),"^",4)]"" S ^PS(51.1,"AC",$P(^(0),"^",4),X,DA)=""
"^DD",51.1,51.1,.01,1,3,2)
I $D(^PS(51.1,DA,0)),$P(^(0),"^",4)]"" K ^PS(51.1,"AC",$P(^(0),"^",4),X,DA)
"^DD",51.1,51.1,.01,1,3,3)
USED BY SCHEDULE PROCESSOR
"^DD",51.1,51.1,.01,1,3,"%D",0)
^^2^2^2970926^^
"^DD",51.1,51.1,.01,1,3,"%D",1,0)
Used by the Schedule Processor to do package specific look-ups.
"^DD",51.1,51.1,.01,1,3,"%D",2,0)
In the form of: ^PS(51.1,"AC",$P(^(0),"^",4),X,DA)
"^DD",51.1,51.1,.01,1,4,0)
51.1^APP^MUMPS
"^DD",51.1,51.1,.01,1,4,1)
I $D(^PS(51.1,DA,0)),$P(^(0),"^",4)]"" S ^PS(51.1,"AP"_$P(^(0),"^",4),X,DA)=""
"^DD",51.1,51.1,.01,1,4,2)
I $D(^PS(51.1,DA,0)),$P(^(0),"^",4)]"" K ^PS(51.1,"AP"_$P(^(0),"^",4),X,DA)
"^DD",51.1,51.1,.01,1,4,3)
USED BY SCHEDULE PROCESSOR
"^DD",51.1,51.1,.01,1,4,"%D",0)
^^2^2^2970926^^
"^DD",51.1,51.1,.01,1,4,"%D",1,0)
Used by the schedule processor to do package specific look-ups.
"^DD",51.1,51.1,.01,1,4,"%D",2,0)
In the form of: ^PS(51.1,"AP"_$P(^(0),"^",4),X,DA)
"^DD",51.1,51.1,.01,1,5,0)
51.1^ADHL^MUMPS
"^DD",51.1,51.1,.01,1,5,1)
S PSJHLDA(+DA)="MUP"
"^DD",51.1,51.1,.01,1,5,2)
S PSJHLDA(+DA)="MDL"
"^DD",51.1,51.1,.01,1,5,"%D",0)
^^2^2^2970926^^^
"^DD",51.1,51.1,.01,1,5,"%D",1,0)
Use to update Administration Schedule to OE/RR Schedule file.
"^DD",51.1,51.1,.01,1,5,"%D",2,0)
In the form of: PSJHLDA(+DA)
"^DD",51.1,51.1,.01,1,5,"DT")
2950224
"^DD",51.1,51.1,.01,3)
Answer must be 2-20 characters in length.
"^DD",51.1,51.1,.01,20,0)
^.3LA^1^1
"^DD",51.1,51.1,.01,20,1,0)
PSJ
"^DD",51.1,51.1,.01,21,0)
^.001^3^3^3021218^^^^
"^DD",51.1,51.1,.01,21,1,0)
  This a common abbreviation for a schedule.  A schedule is the frequency
"^DD",51.1,51.1,.01,21,2,0)
for which an action is to take place, such as every eight hours ('Q8H') or
"^DD",51.1,51.1,.01,21,3,0)
every other day ('QOD').
"^DD",51.1,51.1,.01,"DT")
3040714
"^DD",51.1,51.1,2,0)
FREQUENCY (IN MINUTES)^NJ6,0^^0;3^K:+X'=X!(X>129600)!(X<1)!(X?.E1"."1N.N) X
"^DD",51.1,51.1,2,3)
Type a Number between 1 and 129600, 0 Decimal Digits
"^DD",51.1,51.1,2,20,0)
^.3LA^1^1
"^DD",51.1,51.1,2,20,1,0)
PSJ
"^DD",51.1,51.1,2,21,0)
^.001^2^2^3040917^^^^
"^DD",51.1,51.1,2,21,1,0)
  The number of minutes between each time that the action should take
"^DD",51.1,51.1,2,21,2,0)
place.
"^DD",51.1,51.1,2,23,0)
^.001^2^2^3040917^^^^
"^DD",51.1,51.1,2,23,1,0)
 
"^DD",51.1,51.1,2,23,2,0)
 
"^DD",51.1,51.1,2,"DT")
3040917
"^DD",51.1,51.1,5,0)
TYPE OF SCHEDULE^*SX^C:CONTINUOUS;D:DAY OF THE WEEK;DR:DAY OF THE WEEK-RANGE;O:ONE-TIME;R:RANGE;S:SHIFT;OC:ON CALL;^0;5^D:X["D" ENDNV^PSJSV
"^DD",51.1,51.1,5,3)
ENTER TYPE OF SCHEDULE.  'CONTINUOUS' IS THE DEFAULT.
"^DD",51.1,51.1,5,4)
D ENSTH^PSSDDUT
"^DD",51.1,51.1,5,12)
CHECK PACKAGE
"^DD",51.1,51.1,5,12.1)
S DIC("S")="I $S($P(^PS(51.1,DA,0),""^"",4)="""":0,$P(^(0),""^"",4)'=""PSJ"":1,Y=""DR"":0,1:""RS""'[Y)"
"^DD",51.1,51.1,5,20,0)
^.3LA^1^1
"^DD",51.1,51.1,5,20,1,0)
PSJ
"^DD",51.1,51.1,5,21,0)
^.001^2^2^3041004^^^^
"^DD",51.1,51.1,5,21,1,0)
  This is the type of schedule.  The type of schedule determines how the
"^DD",51.1,51.1,5,21,2,0)
schedule will be processed.
"^DD",51.1,51.1,5,"DT")
3041013
"^DD",55,55.01,.03,0)
STOP DATE/TIME^RDX^^0;3^S %DT="ETX" D:X'=+X ^%DT D:X=+X ENDL^PSSDDUT3 S X=Y K:Y<1!(Y'[".") X
"^DD",55,55.01,.03,1,0)
^.1
"^DD",55,55.01,.03,1,1,0)
55^AIV
"^DD",55,55.01,.03,1,1,1)
S ^PS(55,"AIV",+$E(X,1,30),DA(1),DA)=""
"^DD",55,55.01,.03,1,1,2)
K ^PS(55,"AIV",+$E(X,1,30),DA(1),DA)
"^DD",55,55.01,.03,1,1,"%D",0)
^^1^1^2931031^
"^DD",55,55.01,.03,1,1,"%D",1,0)
Identifies IV orders by the order's stop date/time.
"^DD",55,55.01,.03,1,2,0)
55.01^AF^MUMPS
"^DD",55,55.01,.03,1,2,1)
Q:$D(PSIVACT)  I '$D(DIU(0)) S PSIVF1=55.01,PSIVF2=.03 D ENTO^PSIVAL
"^DD",55,55.01,.03,1,2,2)
Q:$D(PSIVACT)  I '$D(DIU(0)) S PSIVF1=55.01,PSIVF2=.03 D ENFR^PSIVAL
"^DD",55,55.01,.03,1,2,"%D",0)
^^1^2920831^
"^DD",55,55.01,.03,1,2,"%D",1,0)
Used by IV Package.
"^DD",55,55.01,.03,1,3,0)
55.01^AIS
"^DD",55,55.01,.03,1,3,1)
S ^PS(55,DA(1),"IV","AIS",$E(X,1,30),DA)=""
"^DD",55,55.01,.03,1,3,2)
K ^PS(55,DA(1),"IV","AIS",$E(X,1,30),DA)
"^DD",55,55.01,.03,1,4,0)
55^AIT^MUMPS
"^DD",55,55.01,.03,1,4,1)
I $P($G(^PS(55,DA(1),"IV",DA,0)),U,4)]"" S ^PS(55,DA(1),"IV","AIT",$P(^(0),U,4),+X,DA)=""
"^DD",55,55.01,.03,1,4,2)
I $P($G(^PS(55,DA(1),"IV",DA,0)),U,4)]"" K ^PS(55,DA(1),"IV","AIT",$P(^(0),U,4),+X,DA)
"^DD",55,55.01,.03,1,4,"%D",0)
4^^4^4^2930611^
"^DD",55,55.01,.03,1,4,"%D",1,0)
  Used by IV to gather orders.  X-refs are in the form of:  
"^DD",55,55.01,.03,1,4,"%D",2,0)
  ^PS(55,DA(1),"IV","AIT",type,stop date/time,DA)  
"^DD",55,55.01,.03,1,4,"%D",3,0)
 
"^DD",55,55.01,.03,1,4,"%D",4,0)
  These are used primarily by the Med Due Worksheet and MAR.
"^DD",55,55.01,.03,1,4,"DT")
2930610
"^DD",55,55.01,.03,3)

"^DD",55,55.01,.03,20,0)
^.3LA^1^1
"^DD",55,55.01,.03,20,1,0)
PSJI
"^DD",55,55.01,.03,21,0)
^^1^1^2920512^^^^
"^DD",55,55.01,.03,21,1,0)
  This is the date and time the order is to end.
"^DD",55,55.01,.03,"DT")
3040729
"^DD",55,55.01,136,0)
CLINIC^*P44'^SC(^DSS;1^S DIC("S")="D PSS13^PSSDDUT" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",55,55.01,136,12)
Entry must be a clinic.  Depending on the condition, INACTIVATE and REACTIVATE dates may exist.
"^DD",55,55.01,136,12.1)
S DIC("S")="D PSS13^PSSDDUT"
"^DD",55,55.01,136,"DT")
3040729
"^DD",55,55.01,139,0)
APPOINTMENT DATE/TIME^D^^DSS;2^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",55,55.01,139,3)
This is the date and time of the appointment this order is being placed for.
"^DD",55,55.01,139,21,0)
^^1^1^3030516^
"^DD",55,55.01,139,21,1,0)
Date and time of the appointment for this clinic location.
"^DD",55,55.01,139,"DT")
3030516
"^DD",55,55.01,152,0)
REQUESTED IV LIMITATION^F^^2.5;4^K:$L(X)>7!($L(X)<2)!'(X?1.2A1.5N) X
"^DD",55,55.01,152,3)
Answer must be 2-7 characters in length.
"^DD",55,55.01,152,21,0)
^^3^3^3041115^
"^DD",55,55.01,152,21,1,0)
This is the length of time to administer, or the total volume 
"^DD",55,55.01,152,21,2,0)
to administer, for IV fluid orders. The value may be in ML or CC for
"^DD",55,55.01,152,21,3,0)
milliliters, L for liters, D for days, or H for hours.
"^DD",55,55.01,152,"DT")
3041115
"^DD",55,55.06,34,0)
STOP DATE/TIME^RDX^^2;4^X:X=+X&X&$D(^PS(55,DA(1),5,DA,2)) "S PSGDL=X D EN2^PSSDDUT3" S %DT="ERTX" D ^%DT S X=+Y K:Y'>0 X
"^DD",55,55.06,34,1,0)
^.1
"^DD",55,55.06,34,1,1,0)
55.06^ASD^MUMPS
"^DD",55,55.06,34,1,1,1)
S ^PS(55,DA(1),5,"AUS",+X,DA)="" I $P($G(^PS(55,DA(1),5,DA,0)),"^",7)]"" S ^PS(55,DA(1),5,"AU",$P(^(0),"^",7),+X,DA)=""
"^DD",55,55.06,34,1,1,2)
K ^PS(55,DA(1),5,"AUS",+X,DA) I $P($G(^PS(55,DA(1),5,DA,0)),"^",7)]"" K ^PS(55,DA(1),5,"AU",$P(^(0),"^",7),+X,DA)
"^DD",55,55.06,34,1,1,3)
NEEDED BY UNIT DOSE
"^DD",55,55.06,34,1,1,"%D",0)
^^5^5^2920729^^^
"^DD",55,55.06,34,1,1,"%D",1,0)
Used by Unit Dose to gather orders.  X-refs are in the form of:
"^DD",55,55.06,34,1,1,"%D",2,0)
^PS(55,DA(1),"AU",status,stop date/time,DA)
"^DD",55,55.06,34,1,1,"%D",3,0)
^PS(55,DA(1),"AUS",stop date/time,DA)
"^DD",55,55.06,34,1,1,"%D",4,0)
 
"^DD",55,55.06,34,1,1,"%D",5,0)
These are used primarily by the profiles.
"^DD",55,55.06,34,1,1,"DT")
2920729
"^DD",55,55.06,34,1,2,0)
55.06^AL53^MUMPS
"^DD",55,55.06,34,1,2,1)
I '$D(DIU(0)) D:$D(PSGAL(53))#2 KILL^PSGAL5:PSGAL(53)=X K PSGAL
"^DD",55,55.06,34,1,2,2)
I '$D(DIU(0)),'$D(PSGPO) S PSGAL(53)=X,PSGAL("C")=6000,PSGALFF=34 D ^PSGAL5
"^DD",55,55.06,34,1,2,3)
UNIT DOSE ACTIVITY LOG
"^DD",55,55.06,34,1,2,"%D",0)
^^1^1^2920729^
"^DD",55,55.06,34,1,2,"%D",1,0)
Used by Unit Dose to log any changes made to this field.
"^DD",55,55.06,34,1,3,0)
55^AUD
"^DD",55,55.06,34,1,3,1)
S ^PS(55,"AUD",$E(X,1,30),DA(1),DA)=""
"^DD",55,55.06,34,1,3,2)
K ^PS(55,"AUD",$E(X,1,30),DA(1),DA)
"^DD",55,55.06,34,1,3,"%D",0)
^^1^1^2931031^
"^DD",55,55.06,34,1,3,"%D",1,0)
Identifies verified Unit Dose orders by the order's stop date/time.
"^DD",55,55.06,34,1,3,"DT")
2931031
"^DD",55,55.06,34,3)
Enter the date and time that the last dose is to be given (and the order will expire).
"^DD",55,55.06,34,4)
D EN^DDIOL(" TIME IS REQUIRED.","","?0")
"^DD",55,55.06,34,20,0)
^.3LA^1^1
"^DD",55,55.06,34,20,1,0)
PSJU
"^DD",55,55.06,34,21,0)
^^3^3^2970624^^^^
"^DD",55,55.06,34,21,1,0)
  This is the date and time the order will automatically expire.  This
"^DD",55,55.06,34,21,2,0)
package initially calculates a default stop date, depending on the SITE
"^DD",55,55.06,34,21,3,0)
PARAMETERS.
"^DD",55,55.06,34,"DT")
3040729
"^DD",55,55.06,130,0)
CLINIC^*P44'^SC(^8;1^S DIC("S")="D PSS13^PSSDDUT" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",55,55.06,130,3)
Entry must be a clinic location and should be a clinic that allows administration of Inpatient Meds.
"^DD",55,55.06,130,12)
Must be a clinic location. For Unit Dose, should allow IPM.
"^DD",55,55.06,130,12.1)
S DIC("S")="D PSS13^PSSDDUT"
"^DD",55,55.06,130,21,0)
^^1^1^3030516^
"^DD",55,55.06,130,21,1,0)
This is the clinic location if this order is for an Outpatient.
"^DD",55,55.06,130,"DT")
3040729
"^DD",55,55.06,131,0)
APPOINTMENT DATE/TIME^D^^8;2^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",55,55.06,131,3)
This is the date and time of the appointment this order is being placed for.
"^DD",55,55.06,131,21,0)
^^1^1^3030516^
"^DD",55,55.06,131,21,1,0)
Date and time of the appointment for this clinic location.
"^DD",55,55.06,131,"DT")
3030516
"^DD",59.7,59.7,26.8,0)
AUTO-DC IMO ORDERS^S^0:NO;1:YES;^26;8^Q
"^DD",59.7,59.7,26.8,3)
 If you want to discontinue inpatient medication orders for outpatients whenever orders are auto-dc'd, answer YES
"^DD",59.7,59.7,26.8,21,0)
^.001^9^9^3030925^^^^
"^DD",59.7,59.7,26.8,21,1,0)
There may be orders for an Outpatient clinic visit that are placed in
"^DD",59.7,59.7,26.8,21,2,0)
Inpatient Medications. These are orders for medications that will be
"^DD",59.7,59.7,26.8,21,3,0)
administered while the patient is in the clinic.
"^DD",59.7,59.7,26.8,21,4,0)
 
"^DD",59.7,59.7,26.8,21,5,0)
It is possible that the site may not want these orders to be auto-dc'd on
"^DD",59.7,59.7,26.8,21,6,0)
patient movements, even if they want all other orders to auto-dc on a
"^DD",59.7,59.7,26.8,21,7,0)
patient movement. If this is the case, the site can answer NO to this
"^DD",59.7,59.7,26.8,21,8,0)
question. The auto-dc routine will then skip the Inpatient orders placed
"^DD",59.7,59.7,26.8,21,9,0)
for a clinic.
"^DD",59.7,59.7,26.8,"DT")
3030925
**INSTALL NAME**
PSJ*5.0*111
"BLD",4766,0)
PSJ*5.0*111^INPATIENT MEDICATIONS^0^3050120^y
"BLD",4766,1,0)
^^74^74^3041119^
"BLD",4766,1,1,0)
1. The Inpatient Medication Orders for Outpatients project will allow a
"BLD",4766,1,2,0)
user the ability to order unit dose medications for outpatients. This is
"BLD",4766,1,3,0)
accomplished through modifications to Inpatient Medications V. 5.0,
"BLD",4766,1,4,0)
Computerized Patient Record System (CPRS) V.1.0 and Scheduling V. 5.3.
"BLD",4766,1,5,0)
This patch provides the changes for Inpatient Medications.
"BLD",4766,1,6,0)
 
"BLD",4766,1,7,0)
2. Provider Comments are not being saved with active IV orders. This patch
"BLD",4766,1,8,0)
corrects this by saving Provider Comments when IV orders become active.
"BLD",4766,1,9,0)
NOIS: ASH-0803-31967, ERI-0303-20187 and ISB-0702-30889. 
"BLD",4766,1,10,0)
 
"BLD",4766,1,11,0)
3. Drug selection lookup was using an old cross reference.  This patch
"BLD",4766,1,12,0)
corrects the program to use the correct one. NOIS: ISB-0803-30450
"BLD",4766,1,13,0)
 
"BLD",4766,1,14,0)
4. To accommodate Billing Awareness, it was necessary to modify the
"BLD",4766,1,15,0)
communication between CPRS and Outpatient Pharmacy V. 7.0 to include
"BLD",4766,1,16,0)
new diagnosis codes. Inpatient Medications V. 5.0 routes all pharmacy
"BLD",4766,1,17,0)
orders to the appropriate package. This patch makes the changes necessary
"BLD",4766,1,18,0)
to pass the new diagnosis codes to the appropriate package.
"BLD",4766,1,19,0)
 
"BLD",4766,1,20,0)
5. A provider entering an order into Computerized Patient Record System
"BLD",4766,1,21,0)
(CPRS) V. 1.0 must be permitted to place a limitation on the duration of
"BLD",4766,1,22,0)
an inpatient medication order. This capability exists for Unit Dose orders
"BLD",4766,1,23,0)
and Inpatient IV orders, but not for IV Fluid orders. This patch makes
"BLD",4766,1,24,0)
the change necessary to receive a duration or dosage limit on an IV Fluid
"BLD",4766,1,25,0)
order placed in CPRS. The limitation will be in hours, days, milliliters,
"BLD",4766,1,26,0)
or liters.
"BLD",4766,1,27,0)
 
"BLD",4766,1,28,0)
6. A site reported a problem with the default start date and time for
"BLD",4766,1,29,0)
orders created between 11pm and midnight. The default start date for these
"BLD",4766,1,30,0)
orders may default to 11pm the following day. This patch corrects the
"BLD",4766,1,31,0)
problem by calculating and displaying the correct default start date and
"BLD",4766,1,32,0)
time. NOIS: BRX-0803-12080.
"BLD",4766,1,33,0)
 
"BLD",4766,1,34,0)
7. Two sites reported a problem with IV labels not printing correctly with
"BLD",4766,1,35,0)
Day-of-Week schedules that had Sunday in the list. This patch corrects
"BLD",4766,1,36,0)
this problem. NOIS: PHO-0903-60884, MIN-1003-41071 and MIN-0204-41197.
"BLD",4766,1,37,0)
 
"BLD",4766,1,38,0)
8. A request was made to modify the Non-Verified/Pending Orders option 
"BLD",4766,1,39,0)
[PSJU VBW] to show the clinic for Outpatient IV orders. This patch makes 
"BLD",4766,1,40,0)
this modification. E3R: 17357
"BLD",4766,1,41,0)
 
"BLD",4766,1,42,0)
9. A description has been added to the ACX cross-reference in the ORDERS
"BLD",4766,1,43,0)
FILE PARENT ORDER field (#125), in the NON-VERIFIED ORDERS file (#53.1) 
"BLD",4766,1,44,0)
at the request of the database administrator.
"BLD",4766,1,45,0)
 
"BLD",4766,1,46,0)
10. A site reported a problem with the display of dosage information 
"BLD",4766,1,47,0)
under certain circumstances. Specifically, there was no  spacing between 
"BLD",4766,1,48,0)
the number and the dosage form. This patch works with changes in Pharmacy 
"BLD",4766,1,49,0)
Data Management V. 1.0 to correct this problem. NOIS: BRX-1004-10173 and 
"BLD",4766,1,50,0)
SFC-1003-62552
"BLD",4766,1,51,0)
 
"BLD",4766,1,52,0)
11. To accomodate the Scheduling Encapsulation project, a change has been
"BLD",4766,1,53,0)
made to the retrieval of appointment information. When a specific error
"BLD",4766,1,54,0)
code is returned, the following message will display in place of the
"BLD",4766,1,55,0)
appointment: "Scheduling database is unavailable". NOIS: ISB-0903-31960
"BLD",4766,1,56,0)
 
"BLD",4766,1,57,0)
12. A site reported that the finishing pharmacist is incorrectly saved as
"BLD",4766,1,58,0)
the provider when the SF - Speed Finish action is used to finish a pending
"BLD",4766,1,59,0)
renewal order. This patch corrects the problem by saving the provider 
"BLD",4766,1,60,0)
that renewed the order with the finished and verified order. 
"BLD",4766,1,61,0)
NOIS: AMA-1004-71742 and CPH-1004-41922
"BLD",4766,1,62,0)
 
"BLD",4766,1,63,0)
13. Orders with Day of Week (DOW) schedules may be created with an 
"BLD",4766,1,64,0)
inappropriate dose frequency which prevents the scheduled doses from 
"BLD",4766,1,65,0)
appearing on the Virtual Due List (VDL) in Bar Code Medication 
"BLD",4766,1,66,0)
Administration (BCMA) V. 3.0. A frequency value appropriate for DOW 
"BLD",4766,1,67,0)
schedules will be stored for orders containing this type of schedule to 
"BLD",4766,1,68,0)
ensure they display correctly in BCMA. NOIS: HIN-0503-41736
"BLD",4766,1,69,0)
 
"BLD",4766,1,70,0)
14. Orders created in CPRS V. 1.0 between 2300 and 2400 may, during the 
"BLD",4766,1,71,0)
finishing process, incorrectly default to a start date and time that is 24
"BLD",4766,1,72,0)
hours later than the correct default start date and time. Orders created 
"BLD",4766,1,73,0)
between 2300 and 2400 will now default to the correct start date and time.
"BLD",4766,1,74,0)
NOIS: PAL-1203-62062.
"BLD",4766,4,0)
^9.64PA^57.8^4
"BLD",4766,4,53.1,0)
53.1
"BLD",4766,4,53.1,2,0)
^9.641^53.1^1
"BLD",4766,4,53.1,2,53.1,0)
NON-VERIFIED ORDERS  (File-top level)
"BLD",4766,4,53.1,2,53.1,1,0)
^9.6411^113^4
"BLD",4766,4,53.1,2,53.1,1,.5,0)
PATIENT NAME
"BLD",4766,4,53.1,2,53.1,1,113,0)
CLINIC
"BLD",4766,4,53.1,2,53.1,1,126,0)
APPOINTMENT DATE/TIME
"BLD",4766,4,53.1,2,53.1,1,127,0)
REQUESTED IV LIMITATION
"BLD",4766,4,53.1,222)
y^y^p^^^^n^^n
"BLD",4766,4,53.1,224)

"BLD",4766,4,53.2,0)
53.2
"BLD",4766,4,53.2,2,0)
^9.641^53.22^1
"BLD",4766,4,53.2,2,53.22,0)
ORDERABLE ITEM  (sub-file)
"BLD",4766,4,53.2,2,53.22,1,0)
^9.6411^8^1
"BLD",4766,4,53.2,2,53.22,1,8,0)
SCHEDULE
"BLD",4766,4,53.2,222)
y^y^p^^^^n^^n
"BLD",4766,4,53.2,224)

"BLD",4766,4,53.46,0)
53.46
"BLD",4766,4,53.46,222)
y^y^f^^^^n
"BLD",4766,4,57.8,0)
57.8
"BLD",4766,4,57.8,222)
y^y^f^^^^n
"BLD",4766,4,"APDD",53.1,53.1)

"BLD",4766,4,"APDD",53.1,53.1,.5)

"BLD",4766,4,"APDD",53.1,53.1,113)

"BLD",4766,4,"APDD",53.1,53.1,126)

"BLD",4766,4,"APDD",53.1,53.1,127)

"BLD",4766,4,"APDD",53.2,53.22)

"BLD",4766,4,"APDD",53.2,53.22,8)

"BLD",4766,4,"B",53.1,53.1)

"BLD",4766,4,"B",53.2,53.2)

"BLD",4766,4,"B",53.46,53.46)

"BLD",4766,4,"B",57.8,57.8)

"BLD",4766,"ABPKG")
n
"BLD",4766,"INI")
SENDMSG^PSJ0111
"BLD",4766,"INID")
^^n
"BLD",4766,"KRN",0)
^9.67PA^8989.52^19
"BLD",4766,"KRN",.4,0)
.4
"BLD",4766,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4766,"KRN",.401,0)
.401
"BLD",4766,"KRN",.402,0)
.402
"BLD",4766,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",4766,"KRN",.402,"NM",1,0)
PSJ IWP EDIT    FILE #59.6^59.6^0
"BLD",4766,"KRN",.402,"NM","B","PSJ IWP EDIT    FILE #59.6",1)

"BLD",4766,"KRN",.403,0)
.403
"BLD",4766,"KRN",.5,0)
.5
"BLD",4766,"KRN",.84,0)
.84
"BLD",4766,"KRN",3.6,0)
3.6
"BLD",4766,"KRN",3.8,0)
3.8
"BLD",4766,"KRN",9.2,0)
9.2
"BLD",4766,"KRN",9.8,0)
9.8
"BLD",4766,"KRN",9.8,"NM",0)
^9.68A^121^92
"BLD",4766,"KRN",9.8,"NM",6,0)
PSIVSTAT^^0^B20250059
"BLD",4766,"KRN",9.8,"NM",11,0)
PSGAP^^0^B6474815
"BLD",4766,"KRN",9.8,"NM",12,0)
PSGAP0^^0^B31616073
"BLD",4766,"KRN",9.8,"NM",13,0)
PSJPDIR^^0^B26737519
"BLD",4766,"KRN",9.8,"NM",14,0)
PSJPR^^0^B40003412
"BLD",4766,"KRN",9.8,"NM",15,0)
PSGEUD^^0^B27851751
"BLD",4766,"KRN",9.8,"NM",16,0)
PSGEUDD^^0^B16167200
"BLD",4766,"KRN",9.8,"NM",17,0)
PSGP^^0^B11482901
"BLD",4766,"KRN",9.8,"NM",18,0)
PSJMDIR1^^0^B4827032
"BLD",4766,"KRN",9.8,"NM",20,0)
PSGMAR^^0^B40665758
"BLD",4766,"KRN",9.8,"NM",21,0)
PSGMAR0^^0^B31846437
"BLD",4766,"KRN",9.8,"NM",22,0)
PSGMAR2^^0^B12041992
"BLD",4766,"KRN",9.8,"NM",23,0)
PSGMAR3^^0^B17619773
"BLD",4766,"KRN",9.8,"NM",24,0)
PSGMIV^^0^B27367456
"BLD",4766,"KRN",9.8,"NM",25,0)
PSGMMAR^^0^B25599735
"BLD",4766,"KRN",9.8,"NM",26,0)
PSGMMAR0^^0^B36138021
"BLD",4766,"KRN",9.8,"NM",27,0)
PSGMMAR2^^0^B30290130
"BLD",4766,"KRN",9.8,"NM",28,0)
PSGMMAR4^^0^B11251322
"BLD",4766,"KRN",9.8,"NM",29,0)
PSGMMIV^^0^B24641228
"BLD",4766,"KRN",9.8,"NM",33,0)
PSJLMUTL^^0^B55430088
"BLD",4766,"KRN",9.8,"NM",35,0)
PSJMDWS^^0^B10884994
"BLD",4766,"KRN",9.8,"NM",36,0)
PSJMP^^0^B3272025
"BLD",4766,"KRN",9.8,"NM",37,0)
PSGCAP^^0^B33088285
"BLD",4766,"KRN",9.8,"NM",38,0)
PSGCAP0^^0^B21624437
"BLD",4766,"KRN",9.8,"NM",39,0)
PSGCAPP^^0^B13538831
"BLD",4766,"KRN",9.8,"NM",40,0)
PSJEXP^^0^B44592127
"BLD",4766,"KRN",9.8,"NM",45,0)
PSGAPP^^0^B25259233
"BLD",4766,"KRN",9.8,"NM",49,0)
PSGNE3^^0^B29480677
"BLD",4766,"KRN",9.8,"NM",51,0)
PSJADT0^^0^B30353145
"BLD",4766,"KRN",9.8,"NM",54,0)
PSGFILED^^0^B24312261
"BLD",4766,"KRN",9.8,"NM",55,0)
PSGMMAR3^^0^B7186458
"BLD",4766,"KRN",9.8,"NM",56,0)
PSGL^^0^B35127952
"BLD",4766,"KRN",9.8,"NM",57,0)
PSGLOI^^0^B33590707
"BLD",4766,"KRN",9.8,"NM",58,0)
PSGVBW^^0^B57660299
"BLD",4766,"KRN",9.8,"NM",59,0)
PSGVBW1^^0^B3427001
"BLD",4766,"KRN",9.8,"NM",60,0)
PSJORRE^^0^B29873993
"BLD",4766,"KRN",9.8,"NM",61,0)
PSGOE7^^0^B18772802
"BLD",4766,"KRN",9.8,"NM",62,0)
PSIVORFA^^0^B26473261
"BLD",4766,"KRN",9.8,"NM",63,0)
PSIVORFB^^0^B29730553
"BLD",4766,"KRN",9.8,"NM",64,0)
PSIVUTL1^^0^B16891513
"BLD",4766,"KRN",9.8,"NM",65,0)
PSJHL4^^0^B64911264
"BLD",4766,"KRN",9.8,"NM",66,0)
PSJHL4A^^0^B30067390
"BLD",4766,"KRN",9.8,"NM",67,0)
PSJHL9^^0^B51714224
"BLD",4766,"KRN",9.8,"NM",68,0)
PSJLIACT^^0^B40797272
"BLD",4766,"KRN",9.8,"NM",69,0)
PSJLIVFD^^0^B37728211
"BLD",4766,"KRN",9.8,"NM",70,0)
PSJLIVMD^^0^B66254747
"BLD",4766,"KRN",9.8,"NM",71,0)
PSJUTL2^^0^B9017401
"BLD",4766,"KRN",9.8,"NM",72,0)
PSIVCAL^^0^B54669382
"BLD",4766,"KRN",9.8,"NM",76,0)
PSGS0^^0^B42463838
"BLD",4766,"KRN",9.8,"NM",77,0)
PSGSEL^^0^B26408346
"BLD",4766,"KRN",9.8,"NM",78,0)
PSGVBWU^^0^B53189589
"BLD",4766,"KRN",9.8,"NM",79,0)
PSIVEDT1^^0^B28421245
"BLD",4766,"KRN",9.8,"NM",80,0)
PSIVWL^^0^B32855058
"BLD",4766,"KRN",9.8,"NM",81,0)
PSGAXR^^0^B7839791
"BLD",4766,"KRN",9.8,"NM",82,0)
PSGSH^^0^B9080011
"BLD",4766,"KRN",9.8,"NM",83,0)
PSJBCMA^^0^B61037114
"BLD",4766,"KRN",9.8,"NM",84,0)
PSGMUTL^^0^B22496253
"BLD",4766,"KRN",9.8,"NM",85,0)
PSJDOSE^^0^B45005446
"BLD",4766,"KRN",9.8,"NM",86,0)
PSJFTR^^0^B27993385
"BLD",4766,"KRN",9.8,"NM",87,0)
PSGOEF^^0^B53688927
"BLD",4766,"KRN",9.8,"NM",88,0)
PSGOEV^^0^B63648518
"BLD",4766,"KRN",9.8,"NM",89,0)
PSJLMUDE^^0^B58744268
"BLD",4766,"KRN",9.8,"NM",90,0)
PSJHL2^^0^B30797471
"BLD",4766,"KRN",9.8,"NM",91,0)
PSGDL^^0^B13209027
"BLD",4766,"KRN",9.8,"NM",92,0)
PSJLMGUD^^0^B30595874
"BLD",4766,"KRN",9.8,"NM",94,0)
PSGOD^^0^B18806763
"BLD",4766,"KRN",9.8,"NM",95,0)
PSGOER^^0^B71999379
"BLD",4766,"KRN",9.8,"NM",96,0)
PSGOETO^^0^B29781842
"BLD",4766,"KRN",9.8,"NM",98,0)
PSGOEE^^0^B62697986
"BLD",4766,"KRN",9.8,"NM",99,0)
PSGOEEW^^0^B28923213
"BLD",4766,"KRN",9.8,"NM",100,0)
PSJORP2^^0^B17903646
"BLD",4766,"KRN",9.8,"NM",101,0)
PSGOE4^^0^B26615644
"BLD",4766,"KRN",9.8,"NM",102,0)
PSGOE8^^0^B34977716
"BLD",4766,"KRN",9.8,"NM",103,0)
PSGOE9^^0^B31080984
"BLD",4766,"KRN",9.8,"NM",104,0)
PSGOE41^^0^B14905342
"BLD",4766,"KRN",9.8,"NM",105,0)
PSGOE81^^0^B21103925
"BLD",4766,"KRN",9.8,"NM",106,0)
PSGOE91^^0^B24021176
"BLD",4766,"KRN",9.8,"NM",107,0)
PSJLIFNI^^0^B11199375
"BLD",4766,"KRN",9.8,"NM",108,0)
PSIVSP^^0^B33966081
"BLD",4766,"KRN",9.8,"NM",109,0)
PSJDDUT^^0^B55719712
"BLD",4766,"KRN",9.8,"NM",110,0)
PSGORS0^^0^B14142586
"BLD",4766,"KRN",9.8,"NM",111,0)
PSJMEDS^^0^B19489029
"BLD",4766,"KRN",9.8,"NM",112,0)
PSGPR^^0^B40201649
"BLD",4766,"KRN",9.8,"NM",113,0)
PSJORRE1^^0^B37494898
"BLD",4766,"KRN",9.8,"NM",114,0)
PSGOES^^0^B19404808
"BLD",4766,"KRN",9.8,"NM",115,0)
PSIVCHK^^0^B15887140
"BLD",4766,"KRN",9.8,"NM",116,0)
PSIVCHK1^^0^B16087678
"BLD",4766,"KRN",9.8,"NM",117,0)
PSGMAR1^^0^B6611470
"BLD",4766,"KRN",9.8,"NM",118,0)
PSGMMAR1^^0^B16034896
"BLD",4766,"KRN",9.8,"NM",119,0)
PSGMMAR5^^0^B4624280
"BLD",4766,"KRN",9.8,"NM",120,0)
PSJHL3^^0^B63058667
"BLD",4766,"KRN",9.8,"NM",121,0)
PSJOE^^0^B81173989
"BLD",4766,"KRN",9.8,"NM","B","PSGAP",11)

"BLD",4766,"KRN",9.8,"NM","B","PSGAP0",12)

"BLD",4766,"KRN",9.8,"NM","B","PSGAPP",45)

"BLD",4766,"KRN",9.8,"NM","B","PSGAXR",81)

"BLD",4766,"KRN",9.8,"NM","B","PSGCAP",37)

"BLD",4766,"KRN",9.8,"NM","B","PSGCAP0",38)

"BLD",4766,"KRN",9.8,"NM","B","PSGCAPP",39)

"BLD",4766,"KRN",9.8,"NM","B","PSGDL",91)

"BLD",4766,"KRN",9.8,"NM","B","PSGEUD",15)

"BLD",4766,"KRN",9.8,"NM","B","PSGEUDD",16)

"BLD",4766,"KRN",9.8,"NM","B","PSGFILED",54)

"BLD",4766,"KRN",9.8,"NM","B","PSGL",56)

"BLD",4766,"KRN",9.8,"NM","B","PSGLOI",57)

"BLD",4766,"KRN",9.8,"NM","B","PSGMAR",20)

"BLD",4766,"KRN",9.8,"NM","B","PSGMAR0",21)

"BLD",4766,"KRN",9.8,"NM","B","PSGMAR1",117)

"BLD",4766,"KRN",9.8,"NM","B","PSGMAR2",22)

"BLD",4766,"KRN",9.8,"NM","B","PSGMAR3",23)

"BLD",4766,"KRN",9.8,"NM","B","PSGMIV",24)

"BLD",4766,"KRN",9.8,"NM","B","PSGMMAR",25)

"BLD",4766,"KRN",9.8,"NM","B","PSGMMAR0",26)

"BLD",4766,"KRN",9.8,"NM","B","PSGMMAR1",118)

"BLD",4766,"KRN",9.8,"NM","B","PSGMMAR2",27)

"BLD",4766,"KRN",9.8,"NM","B","PSGMMAR3",55)

"BLD",4766,"KRN",9.8,"NM","B","PSGMMAR4",28)

"BLD",4766,"KRN",9.8,"NM","B","PSGMMAR5",119)

"BLD",4766,"KRN",9.8,"NM","B","PSGMMIV",29)

"BLD",4766,"KRN",9.8,"NM","B","PSGMUTL",84)

"BLD",4766,"KRN",9.8,"NM","B","PSGNE3",49)

"BLD",4766,"KRN",9.8,"NM","B","PSGOD",94)

"BLD",4766,"KRN",9.8,"NM","B","PSGOE4",101)

"BLD",4766,"KRN",9.8,"NM","B","PSGOE41",104)

"BLD",4766,"KRN",9.8,"NM","B","PSGOE7",61)

"BLD",4766,"KRN",9.8,"NM","B","PSGOE8",102)

"BLD",4766,"KRN",9.8,"NM","B","PSGOE81",105)

"BLD",4766,"KRN",9.8,"NM","B","PSGOE9",103)

"BLD",4766,"KRN",9.8,"NM","B","PSGOE91",106)

"BLD",4766,"KRN",9.8,"NM","B","PSGOEE",98)

"BLD",4766,"KRN",9.8,"NM","B","PSGOEEW",99)

"BLD",4766,"KRN",9.8,"NM","B","PSGOEF",87)

"BLD",4766,"KRN",9.8,"NM","B","PSGOER",95)

"BLD",4766,"KRN",9.8,"NM","B","PSGOES",114)

"BLD",4766,"KRN",9.8,"NM","B","PSGOETO",96)

"BLD",4766,"KRN",9.8,"NM","B","PSGOEV",88)

"BLD",4766,"KRN",9.8,"NM","B","PSGORS0",110)

"BLD",4766,"KRN",9.8,"NM","B","PSGP",17)

"BLD",4766,"KRN",9.8,"NM","B","PSGPR",112)

"BLD",4766,"KRN",9.8,"NM","B","PSGS0",76)

"BLD",4766,"KRN",9.8,"NM","B","PSGSEL",77)

"BLD",4766,"KRN",9.8,"NM","B","PSGSH",82)

"BLD",4766,"KRN",9.8,"NM","B","PSGVBW",58)

"BLD",4766,"KRN",9.8,"NM","B","PSGVBW1",59)

"BLD",4766,"KRN",9.8,"NM","B","PSGVBWU",78)

"BLD",4766,"KRN",9.8,"NM","B","PSIVCAL",72)

"BLD",4766,"KRN",9.8,"NM","B","PSIVCHK",115)

"BLD",4766,"KRN",9.8,"NM","B","PSIVCHK1",116)

"BLD",4766,"KRN",9.8,"NM","B","PSIVEDT1",79)

"BLD",4766,"KRN",9.8,"NM","B","PSIVORFA",62)

"BLD",4766,"KRN",9.8,"NM","B","PSIVORFB",63)

"BLD",4766,"KRN",9.8,"NM","B","PSIVSP",108)

"BLD",4766,"KRN",9.8,"NM","B","PSIVSTAT",6)

"BLD",4766,"KRN",9.8,"NM","B","PSIVUTL1",64)

"BLD",4766,"KRN",9.8,"NM","B","PSIVWL",80)

"BLD",4766,"KRN",9.8,"NM","B","PSJADT0",51)

"BLD",4766,"KRN",9.8,"NM","B","PSJBCMA",83)

"BLD",4766,"KRN",9.8,"NM","B","PSJDDUT",109)

"BLD",4766,"KRN",9.8,"NM","B","PSJDOSE",85)

"BLD",4766,"KRN",9.8,"NM","B","PSJEXP",40)

"BLD",4766,"KRN",9.8,"NM","B","PSJFTR",86)

"BLD",4766,"KRN",9.8,"NM","B","PSJHL2",90)

"BLD",4766,"KRN",9.8,"NM","B","PSJHL3",120)

"BLD",4766,"KRN",9.8,"NM","B","PSJHL4",65)

"BLD",4766,"KRN",9.8,"NM","B","PSJHL4A",66)

"BLD",4766,"KRN",9.8,"NM","B","PSJHL9",67)

"BLD",4766,"KRN",9.8,"NM","B","PSJLIACT",68)

"BLD",4766,"KRN",9.8,"NM","B","PSJLIFNI",107)

"BLD",4766,"KRN",9.8,"NM","B","PSJLIVFD",69)

"BLD",4766,"KRN",9.8,"NM","B","PSJLIVMD",70)

"BLD",4766,"KRN",9.8,"NM","B","PSJLMGUD",92)

"BLD",4766,"KRN",9.8,"NM","B","PSJLMUDE",89)

"BLD",4766,"KRN",9.8,"NM","B","PSJLMUTL",33)

"BLD",4766,"KRN",9.8,"NM","B","PSJMDIR1",18)

"BLD",4766,"KRN",9.8,"NM","B","PSJMDWS",35)

"BLD",4766,"KRN",9.8,"NM","B","PSJMEDS",111)

"BLD",4766,"KRN",9.8,"NM","B","PSJMP",36)

"BLD",4766,"KRN",9.8,"NM","B","PSJOE",121)

"BLD",4766,"KRN",9.8,"NM","B","PSJORP2",100)

"BLD",4766,"KRN",9.8,"NM","B","PSJORRE",60)

"BLD",4766,"KRN",9.8,"NM","B","PSJORRE1",113)

"BLD",4766,"KRN",9.8,"NM","B","PSJPDIR",13)

"BLD",4766,"KRN",9.8,"NM","B","PSJPR",14)

"BLD",4766,"KRN",9.8,"NM","B","PSJUTL2",71)

"BLD",4766,"KRN",19,0)
19
"BLD",4766,"KRN",19,"NM",0)
^9.68A^6^6
"BLD",4766,"KRN",19,"NM",1,0)
PSJ CSD^^0
"BLD",4766,"KRN",19,"NM",2,0)
PSJ SYS EDIT^^0
"BLD",4766,"KRN",19,"NM",3,0)
PSJ PARAM EDIT MENU^^2
"BLD",4766,"KRN",19,"NM",4,0)
PSJU TRAIN SCHEDULE^^0
"BLD",4766,"KRN",19,"NM",5,0)
PSJU ECG^^0
"BLD",4766,"KRN",19,"NM",6,0)
PSJU FILE^^2
"BLD",4766,"KRN",19,"NM","B","PSJ CSD",1)

"BLD",4766,"KRN",19,"NM","B","PSJ PARAM EDIT MENU",3)

"BLD",4766,"KRN",19,"NM","B","PSJ SYS EDIT",2)

"BLD",4766,"KRN",19,"NM","B","PSJU ECG",5)

"BLD",4766,"KRN",19,"NM","B","PSJU FILE",6)

"BLD",4766,"KRN",19,"NM","B","PSJU TRAIN SCHEDULE",4)

"BLD",4766,"KRN",19.1,0)
19.1
"BLD",4766,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4766,"KRN",101,0)
101
"BLD",4766,"KRN",409.61,0)
409.61
"BLD",4766,"KRN",771,0)
771
"BLD",4766,"KRN",870,0)
870
"BLD",4766,"KRN",8989.51,0)
8989.51
"BLD",4766,"KRN",8989.52,0)
8989.52
"BLD",4766,"KRN",8994,0)
8994
"BLD",4766,"KRN","B",.4,.4)

"BLD",4766,"KRN","B",.401,.401)

"BLD",4766,"KRN","B",.402,.402)

"BLD",4766,"KRN","B",.403,.403)

"BLD",4766,"KRN","B",.5,.5)

"BLD",4766,"KRN","B",.84,.84)

"BLD",4766,"KRN","B",3.6,3.6)

"BLD",4766,"KRN","B",3.8,3.8)

"BLD",4766,"KRN","B",9.2,9.2)

"BLD",4766,"KRN","B",9.8,9.8)

"BLD",4766,"KRN","B",19,19)

"BLD",4766,"KRN","B",19.1,19.1)

"BLD",4766,"KRN","B",101,101)

"BLD",4766,"KRN","B",409.61,409.61)

"BLD",4766,"KRN","B",771,771)

"BLD",4766,"KRN","B",870,870)

"BLD",4766,"KRN","B",8989.51,8989.51)

"BLD",4766,"KRN","B",8989.52,8989.52)

"BLD",4766,"KRN","B",8994,8994)

"BLD",4766,"PRET")

"BLD",4766,"QUES",0)
^9.62^^
"BLD",4766,"REQB",0)
^9.611^10^3
"BLD",4766,"REQB",7,0)
PSS*1.0*59^2
"BLD",4766,"REQB",9,0)
PSJ*5.0*110^2
"BLD",4766,"REQB",10,0)
PSJ*5.0*87^2
"BLD",4766,"REQB","B","PSJ*5.0*110",9)

"BLD",4766,"REQB","B","PSJ*5.0*87",10)

"BLD",4766,"REQB","B","PSS*1.0*59",7)

"FIA",53.1)
NON-VERIFIED ORDERS
"FIA",53.1,0)
^PS(53.1,
"FIA",53.1,0,0)
53.1I
"FIA",53.1,0,1)
y^y^p^^^^n^^n
"FIA",53.1,0,10)

"FIA",53.1,0,11)

"FIA",53.1,0,"RLRO")

"FIA",53.1,0,"VR")
5.0^PSJ
"FIA",53.1,53.1)
1
"FIA",53.1,53.1,.5)

"FIA",53.1,53.1,113)

"FIA",53.1,53.1,126)

"FIA",53.1,53.1,127)

"FIA",53.2)
UNIT DOSE ORDER SET
"FIA",53.2,0)
^PS(53.2,
"FIA",53.2,0,0)
53.2
"FIA",53.2,0,1)
y^y^p^^^^n^^n
"FIA",53.2,0,10)

"FIA",53.2,0,11)

"FIA",53.2,0,"RLRO")

"FIA",53.2,0,"VR")
5.0^PSJ
"FIA",53.2,53.2)
1
"FIA",53.2,53.22)
1
"FIA",53.2,53.22,8)

"FIA",53.46)
CLINIC STOP DATES
"FIA",53.46,0)
^PS(53.46,
"FIA",53.46,0,0)
53.46P
"FIA",53.46,0,1)
y^y^f^^^^n
"FIA",53.46,0,10)

"FIA",53.46,0,11)

"FIA",53.46,0,"RLRO")

"FIA",53.46,0,"VR")
5.0^PSJ
"FIA",53.46,53.46)
0
"FIA",57.8)
CLINIC GROUP
"FIA",57.8,0)
^PS(57.8,
"FIA",57.8,0,0)
57.8
"FIA",57.8,0,1)
y^y^f^^^^n
"FIA",57.8,0,10)

"FIA",57.8,0,11)

"FIA",57.8,0,"RLRO")

"FIA",57.8,0,"VR")
5.0^PSJ
"FIA",57.8,57.8)
0
"FIA",57.8,57.81)
0
"INI")
SENDMSG^PSJ0111
"IX",53.1,53.1,"AD",0)
53.1^AD^List of patients by clinic.^R^^R^IR^I^53.1^^^^^S
"IX",53.1,53.1,"AD",1)
S ^PS(53.1,"AD",$E(X(1),1,20),$E(X(2),1,20),DA)=""
"IX",53.1,53.1,"AD",2)
K ^PS(53.1,"AD",$E(X(1),1,20),$E(X(2),1,20),DA)
"IX",53.1,53.1,"AD",2.5)
K ^PS(53.1,"AD")
"IX",53.1,53.1,"AD",11.1,0)
^.114IA^2^2
"IX",53.1,53.1,"AD",11.1,1,0)
1^F^53.1^113^20^1^F
"IX",53.1,53.1,"AD",11.1,2,0)
2^F^53.1^.5^20^2^F
"IX",57.8,57.8,"AC",0)
57.8^AC^Allow ability to find clinic group for a clinic.^MU^^F^IR^W^57.81^^^^^S
"IX",57.8,57.8,"AC",1)
S ^PS(57.8,"AC",$E(X,1,20),DA(1))=""
"IX",57.8,57.8,"AC",2)
K ^PS(57.8,"AC",$E(X,1,20),DA(1))
"IX",57.8,57.8,"AC",2.5)
K ^PS(57.8,"AC")
"IX",57.8,57.8,"AC",11.1,0)
^.114IA^1^1
"IX",57.8,57.8,"AC",11.1,1,0)
1^F^57.81^.01^20^1^F
"IX",57.8,57.8,"AD",0)
57.8^AD^Cross-reference of clinic in this clinic group.^MU^^F^IR^W^57.81^^^^^A
"IX",57.8,57.8,"AD",1)
S ^PS(57.8,"AD",DA(1),$E(X,1,20))=""
"IX",57.8,57.8,"AD",2)
K ^PS(57.8,"AD",DA(1),$E(X,1,20))
"IX",57.8,57.8,"AD",2.5)
K ^PS(57.8,"AD")
"IX",57.8,57.8,"AD",11.1,0)
^.114IA^1^1
"IX",57.8,57.8,"AD",11.1,1,0)
1^F^57.81^.01^^^F
"KRN",.402,1036,-1)
0^1
"KRN",.402,1036,0)
PSJ IWP EDIT^3040618.0804^ ^59.6^^^3041122
"KRN",.402,1036,"%D",0)
^.4021^3^3^3040617^^^^
"KRN",.402,1036,"%D",1,0)
  Used by the Inpatient Medications package t allow the Inpatient
"KRN",.402,1036,"%D",2,0)
Supervisor to tailor various aspects of the package on a ward-by-ward
"KRN",.402,1036,"%D",3,0)
basis.
"KRN",.402,1036,"DR",1,59.6)
.03;S X="";3;.04;.07;.05;.08;.12;.19;.16;.2;.15;.18;.11;1;2;.24;4;5;
"KRN",19,1936,-1)
2^6
"KRN",19,1936,0)
PSJU FILE^Supervisor's Menu^^M^4600^PSJU MGR^^^^^^25^^1
"KRN",19,1936,10,0)
^19.01PI^32^32
"KRN",19,1936,10,28,0)
5583^
"KRN",19,1936,10,28,"^")
PSJ PARAM EDIT MENU
"KRN",19,1936,10,30,0)
11778
"KRN",19,1936,10,30,"^")
PSJU ECG
"KRN",19,1936,"U")
SUPERVISOR'S MENU
"KRN",19,5548,-1)
0^2
"KRN",19,5548,0)
PSJ SYS EDIT^Systems Parameters Edit^^R^^^^^^^^INPATIENT MEDICATIONS
"KRN",19,5548,1,0)
^^2^2^2931216^^
"KRN",19,5548,1,1,0)
  This allows the user (supervisor or coordinator) to edit parameters that
"KRN",19,5548,1,2,0)
affect the Inpatient Medications package as a whole.
"KRN",19,5548,25)
ENSYS^PSGFILED
"KRN",19,5548,"U")
SYSTEMS PARAMETERS EDIT
"KRN",19,5583,-1)
2^3
"KRN",19,5583,0)
PSJ PARAM EDIT MENU^PARameters Edit Menu^^M^64^^^^^^^60
"KRN",19,5583,10,0)
^19.01PI^5^5
"KRN",19,5583,10,1,0)
5548^
"KRN",19,5583,10,1,"^")
PSJ SYS EDIT
"KRN",19,5583,10,5,0)
11728^^5
"KRN",19,5583,10,5,"^")
PSJ CSD
"KRN",19,5583,"U")
PARAMETERS EDIT MENU
"KRN",19,11728,-1)
0^1
"KRN",19,11728,0)
PSJ CSD^Clinic Stop Dates^^R^^^^^^^^INPATIENT MEDICATIONS
"KRN",19,11728,1,0)
^^3^3^3031030^
"KRN",19,11728,1,1,0)
Allows the user to define the information to be used to calculate the 
"KRN",19,11728,1,2,0)
stop date for clinics. This is used for orders placed for Inpatient 
"KRN",19,11728,1,3,0)
Medications for Outpatients.
"KRN",19,11728,25)
ENCSD^PSGFILED
"KRN",19,11728,"U")
CLINIC STOP DATES
"KRN",19,11770,-1)
0^4
"KRN",19,11770,0)
PSJU TRAIN SCHEDULE^Schedule Practice^^A^^^^^^^^^^1
"KRN",19,11770,1,0)
^^4^4^3040716^
"KRN",19,11770,1,1,0)
You can practice inputing your schedules under this option.  Try
"KRN",19,11770,1,2,0)
anything - serious or not!  If the schedule chosen has ADMINISTRATION 
"KRN",19,11770,1,3,0)
TIMES, they will be shown. Entries containing "PRN" or those considered 
"KRN",19,11770,1,4,0)
"ODD" schedules, will show nothing.
"KRN",19,11770,20)
D ENA^PSGS0
"KRN",19,11770,"U")
SCHEDULE PRACTICE
"KRN",19,11778,-1)
0^5
"KRN",19,11778,0)
PSJU ECG^Clinic Groups^^R^^^^^^^^INPATIENT MEDICATIONS
"KRN",19,11778,1,0)
^^4^4^3040415^
"KRN",19,11778,1,1,0)
For Inpatient Medication Orders for Outpatients, Clinic Groups allos the 
"KRN",19,11778,1,2,0)
user to sort these meds by groups of clinics. This option allows the user 
"KRN",19,11778,1,3,0)
to define clinic groupd to allow easier sorting for processing in 
"KRN",19,11778,1,4,0)
Non-Verified Pending items and certain reports.
"KRN",19,11778,25)
ENCG^PSGFILED
"KRN",19,11778,"U")
CLINIC GROUPS
"MBREQ")
1
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",60,-1)
1^1
"PKG",60,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
5.0^2971215^2980204^64
"PKG",60,22,1,"PAH",1,0)
111^3050120^222222243
"PKG",60,22,1,"PAH",1,1,0)
^^74^74^3050120
"PKG",60,22,1,"PAH",1,1,1,0)
1. The Inpatient Medication Orders for Outpatients project will allow a
"PKG",60,22,1,"PAH",1,1,2,0)
user the ability to order unit dose medications for outpatients. This is
"PKG",60,22,1,"PAH",1,1,3,0)
accomplished through modifications to Inpatient Medications V. 5.0,
"PKG",60,22,1,"PAH",1,1,4,0)
Computerized Patient Record System (CPRS) V.1.0 and Scheduling V. 5.3.
"PKG",60,22,1,"PAH",1,1,5,0)
This patch provides the changes for Inpatient Medications.
"PKG",60,22,1,"PAH",1,1,6,0)
 
"PKG",60,22,1,"PAH",1,1,7,0)
2. Provider Comments are not being saved with active IV orders. This patch
"PKG",60,22,1,"PAH",1,1,8,0)
corrects this by saving Provider Comments when IV orders become active.
"PKG",60,22,1,"PAH",1,1,9,0)
NOIS: ASH-0803-31967, ERI-0303-20187 and ISB-0702-30889. 
"PKG",60,22,1,"PAH",1,1,10,0)
 
"PKG",60,22,1,"PAH",1,1,11,0)
3. Drug selection lookup was using an old cross reference.  This patch
"PKG",60,22,1,"PAH",1,1,12,0)
corrects the program to use the correct one. NOIS: ISB-0803-30450
"PKG",60,22,1,"PAH",1,1,13,0)
 
"PKG",60,22,1,"PAH",1,1,14,0)
4. To accommodate Billing Awareness, it was necessary to modify the
"PKG",60,22,1,"PAH",1,1,15,0)
communication between CPRS and Outpatient Pharmacy V. 7.0 to include
"PKG",60,22,1,"PAH",1,1,16,0)
new diagnosis codes. Inpatient Medications V. 5.0 routes all pharmacy
"PKG",60,22,1,"PAH",1,1,17,0)
orders to the appropriate package. This patch makes the changes necessary
"PKG",60,22,1,"PAH",1,1,18,0)
to pass the new diagnosis codes to the appropriate package.
"PKG",60,22,1,"PAH",1,1,19,0)
 
"PKG",60,22,1,"PAH",1,1,20,0)
5. A provider entering an order into Computerized Patient Record System
"PKG",60,22,1,"PAH",1,1,21,0)
(CPRS) V. 1.0 must be permitted to place a limitation on the duration of
"PKG",60,22,1,"PAH",1,1,22,0)
an inpatient medication order. This capability exists for Unit Dose orders
"PKG",60,22,1,"PAH",1,1,23,0)
and Inpatient IV orders, but not for IV Fluid orders. This patch makes
"PKG",60,22,1,"PAH",1,1,24,0)
the change necessary to receive a duration or dosage limit on an IV Fluid
"PKG",60,22,1,"PAH",1,1,25,0)
order placed in CPRS. The limitation will be in hours, days, milliliters,
"PKG",60,22,1,"PAH",1,1,26,0)
or liters.
"PKG",60,22,1,"PAH",1,1,27,0)
 
"PKG",60,22,1,"PAH",1,1,28,0)
6. A site reported a problem with the default start date and time for
"PKG",60,22,1,"PAH",1,1,29,0)
orders created between 11pm and midnight. The default start date for these
"PKG",60,22,1,"PAH",1,1,30,0)
orders may default to 11pm the following day. This patch corrects the
"PKG",60,22,1,"PAH",1,1,31,0)
problem by calculating and displaying the correct default start date and
"PKG",60,22,1,"PAH",1,1,32,0)
time. NOIS: BRX-0803-12080.
"PKG",60,22,1,"PAH",1,1,33,0)
 
"PKG",60,22,1,"PAH",1,1,34,0)
7. Two sites reported a problem with IV labels not printing correctly with
"PKG",60,22,1,"PAH",1,1,35,0)
Day-of-Week schedules that had Sunday in the list. This patch corrects
"PKG",60,22,1,"PAH",1,1,36,0)
this problem. NOIS: PHO-0903-60884, MIN-1003-41071 and MIN-0204-41197.
"PKG",60,22,1,"PAH",1,1,37,0)
 
"PKG",60,22,1,"PAH",1,1,38,0)
8. A request was made to modify the Non-Verified/Pending Orders option 
"PKG",60,22,1,"PAH",1,1,39,0)
[PSJU VBW] to show the clinic for Outpatient IV orders. This patch makes 
"PKG",60,22,1,"PAH",1,1,40,0)
this modification. E3R: 17357
"PKG",60,22,1,"PAH",1,1,41,0)
 
"PKG",60,22,1,"PAH",1,1,42,0)
9. A description has been added to the ACX cross-reference in the ORDERS
"PKG",60,22,1,"PAH",1,1,43,0)
FILE PARENT ORDER field (#125), in the NON-VERIFIED ORDERS file (#53.1) 
"PKG",60,22,1,"PAH",1,1,44,0)
at the request of the database administrator.
"PKG",60,22,1,"PAH",1,1,45,0)
 
"PKG",60,22,1,"PAH",1,1,46,0)
10. A site reported a problem with the display of dosage information 
"PKG",60,22,1,"PAH",1,1,47,0)
under certain circumstances. Specifically, there was no  spacing between 
"PKG",60,22,1,"PAH",1,1,48,0)
the number and the dosage form. This patch works with changes in Pharmacy 
"PKG",60,22,1,"PAH",1,1,49,0)
Data Management V. 1.0 to correct this problem. NOIS: BRX-1004-10173 and 
"PKG",60,22,1,"PAH",1,1,50,0)
SFC-1003-62552
"PKG",60,22,1,"PAH",1,1,51,0)
 
"PKG",60,22,1,"PAH",1,1,52,0)
11. To accomodate the Scheduling Encapsulation project, a change has been
"PKG",60,22,1,"PAH",1,1,53,0)
made to the retrieval of appointment information. When a specific error
"PKG",60,22,1,"PAH",1,1,54,0)
code is returned, the following message will display in place of the
"PKG",60,22,1,"PAH",1,1,55,0)
appointment: "Scheduling database is unavailable". NOIS: ISB-0903-31960
"PKG",60,22,1,"PAH",1,1,56,0)
 
"PKG",60,22,1,"PAH",1,1,57,0)
12. A site reported that the finishing pharmacist is incorrectly saved as
"PKG",60,22,1,"PAH",1,1,58,0)
the provider when the SF - Speed Finish action is used to finish a pending
"PKG",60,22,1,"PAH",1,1,59,0)
renewal order. This patch corrects the problem by saving the provider 
"PKG",60,22,1,"PAH",1,1,60,0)
that renewed the order with the finished and verified order. 
"PKG",60,22,1,"PAH",1,1,61,0)
NOIS: AMA-1004-71742 and CPH-1004-41922
"PKG",60,22,1,"PAH",1,1,62,0)
 
"PKG",60,22,1,"PAH",1,1,63,0)
13. Orders with Day of Week (DOW) schedules may be created with an 
"PKG",60,22,1,"PAH",1,1,64,0)
inappropriate dose frequency which prevents the scheduled doses from 
"PKG",60,22,1,"PAH",1,1,65,0)
appearing on the Virtual Due List (VDL) in Bar Code Medication 
"PKG",60,22,1,"PAH",1,1,66,0)
Administration (BCMA) V. 3.0. A frequency value appropriate for DOW 
"PKG",60,22,1,"PAH",1,1,67,0)
schedules will be stored for orders containing this type of schedule to 
"PKG",60,22,1,"PAH",1,1,68,0)
ensure they display correctly in BCMA. NOIS: HIN-0503-41736
"PKG",60,22,1,"PAH",1,1,69,0)
 
"PKG",60,22,1,"PAH",1,1,70,0)
14. Orders created in CPRS V. 1.0 between 2300 and 2400 may, during the 
"PKG",60,22,1,"PAH",1,1,71,0)
finishing process, incorrectly default to a start date and time that is 24
"PKG",60,22,1,"PAH",1,1,72,0)
hours later than the correct default start date and time. Orders created 
"PKG",60,22,1,"PAH",1,1,73,0)
between 2300 and 2400 will now default to the correct start date and time.
"PKG",60,22,1,"PAH",1,1,74,0)
NOIS: PAL-1203-62062.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
93
"RTN","PSGAP")
0^11^B6474815
"RTN","PSGAP",1,0)
PSGAP ;BIR/CML3-ACTION PROFILE (#1) ;12 Mar 98 / 9:28 AM
"RTN","PSGAP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,111**;16 DEC 97
"RTN","PSGAP",3,0)
 N PSJNEW,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSGAP",4,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGAP",5,0)
 ;
"RTN","PSGAP",6,0)
START ;
"RTN","PSGAP",7,0)
 N PSGWD,PSJPWDO
"RTN","PSGAP",8,0)
 S (PSGP,PSGAPWD,PSGAPWG)=0,(PSGAPWDN,PSGAPWGN)="",PSGSSH="AP",PSGY=1 S PSGPTMP=0,PPAGE=1 D GWP^PSJPDIR G:'$D(PSJSEL)!($G(PSJSTOP)=1) DONE D @PSJSEL("SELECT")
"RTN","PSGAP",9,0)
 S PSGSS=PSJSEL("SELECT") D EN^PSGAP0
"RTN","PSGAP",10,0)
 G:$G(PSJSTOP) START
"RTN","PSGAP",11,0)
 ;
"RTN","PSGAP",12,0)
DONE ;
"RTN","PSGAP",13,0)
 D ENKV^PSGSETU K CA,CNTR,DFN,DIAG,DO,DRG,FD,N,NF,ND,ND2,PSJJORD,PAGE,PDOB,PN,PND,PSEX,PSGAP,PSGAPTM,PSGAPWD,PSGAPWDN,PSGAPWG,PSGAPWGN,PSGDICA,PSGPAT,PSGSS,PSGSSH
"RTN","PSGAP",14,0)
 K PFLG,QFLG,PSGMTYPE,PSGFL,PSGEXPDT,PSGY,PSJSI,PSJSTOP,PSJACNWP,PSJOPC,PSJSEL,PT,RB,RTE,SD,SI,SM,ST,STRT,STP,STT,TM,WS,WT,ZTOUT,ZTSK,PSJDLW
"RTN","PSGAP",15,0)
 K ^TMP($J)
"RTN","PSGAP",16,0)
 Q
"RTN","PSGAP",17,0)
 ;
"RTN","PSGAP",18,0)
G ; get ward group
"RTN","PSGAP",19,0)
 S PSGAPWG=+PSJSEL("WG"),PSGAPWGN=$P(PSJSEL("WG"),"^",2) Q
"RTN","PSGAP",20,0)
 ;
"RTN","PSGAP",21,0)
W ; get ward (and Admin. Team if present)
"RTN","PSGAP",22,0)
 S (PSGWD,PSGAPWD)=+PSJSEL("W"),PSGAPWDN=$P(PSJSEL("W"),"^",2)
"RTN","PSGAP",23,0)
 I $D(PSJSEL("TM")) S TM="",PSJTEAM=1 F  S TM=$O(PSJSEL("TM",TM)) Q:TM=""  S PSGAPTM(TM)=TM
"RTN","PSGAP",24,0)
 Q
"RTN","PSGAP",25,0)
 ;
"RTN","PSGAP",26,0)
P ; get patient
"RTN","PSGAP",27,0)
 S PT="" F  S PT=$O(PSJSEL("P",PT)) Q:PT=""  S DFN="",DFN=$O(PSJSEL("P",PT,DFN)) Q:'DFN  S PSGPAT(DFN)=""
"RTN","PSGAP",28,0)
 Q
"RTN","PSGAP",29,0)
 ;
"RTN","PSGAP",30,0)
ENOR ;
"RTN","PSGAP",31,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGAP",32,0)
 S PSGP=+ORVP D PSJAC2^PSJAC(1) S PSGPAT=PSGP,PSGPAT(DFN)="",(PSGAPWD,PSGAPWG)=0,(PSGAPWDN,PSGAPWGN)="",PSGSS="P" D EN^PSGAP0 S PSJNKF=1 G DONE
"RTN","PSGAP",33,0)
ENLM ;Entry point from PSJ LM AP1 protocol
"RTN","PSGAP",34,0)
 N PSJNEW,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSGAP",35,0)
 S PSGPTMP=0,PPAGE=1,PSGSSH="AP",PSGY=1
"RTN","PSGAP",36,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGAP",37,0)
 S PSGPAT=PSGP,PSGPAT(DFN)="",(PSGAPWD,PSGAPWG)=0,(PSGAPWDN,PSGAPWGN)="",PSGSS="P" D EN^PSGAP0 S PSJNKF=1 G DONE
"RTN","PSGAP0")
0^12^B31616073
"RTN","PSGAP0",1,0)
PSGAP0 ;BIR/CML3-ACTION PROFILE ;20 May 98 / 12:36 PM
"RTN","PSGAP0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,58,111**;16 DEC 97
"RTN","PSGAP0",3,0)
 ;
"RTN","PSGAP0",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSGAP0",5,0)
 ;
"RTN","PSGAP0",6,0)
GOD ; gather order data
"RTN","PSGAP0",7,0)
 S ND=$G(^PS(55,PSGP,5,PSJJORD,0)),ND2=$G(^(2)),SI=$P($G(^(6)),"^"),DRG=$G(^(.2)) ;WS=$S(DRG&PSGAPWD:$D(^PSI(58.1,"D",+DRG,PSGAPWD)),1:0),DRG=$G(^PS(50.7,+DRG,0))
"RTN","PSGAP0",8,0)
 ;S NF=$P(DRG,"^",9)
"RTN","PSGAP0",9,0)
 S X=$$NFWS^PSJUTL1(PSGP,PSJJORD_"U",PSGAPWD) S NF=$P(X,U),WS=$P(X,U,2),SM=$S('$P(X,U,3):0,$P(X,U,4):1,1:2)
"RTN","PSGAP0",10,0)
 N X,PSG
"RTN","PSGAP0",11,0)
 D DRGDISP^PSJLMUT1(PSGP,PSJJORD_"U",40,0,.PSG,1)
"RTN","PSGAP0",12,0)
 S DRG=PSG(1),DRG=$S(DRG["NOT FOUND":"z",1:DRG)
"RTN","PSGAP0",13,0)
 S ST=$P(ND,"^",9),ND=$P(ND,"^",7),SD=$P(ND2,"^",2),FD=$P(ND2,"^",4)
"RTN","PSGAP0",14,0)
 I STP'=9999999\1,(SD>STP) Q
"RTN","PSGAP0",15,0)
 F X="SD","FD" S @X=$E($$ENDTC^PSGMI(@X),1,5)
"RTN","PSGAP0",16,0)
 ;
"RTN","PSGAP0",17,0)
 S Y=SI S:Y]"" Y=$$ENSET^PSGSICHK(Y) S X=ND_U_$E(DRG,1,20),^TMP($J,$E(PSGAPWDN,1,20),TM,PN,X,+PSJJORD)=ST_U_SD_U_FD_U_WS_U_SM_U_NF S:Y]"" ^(PSJJORD,1)=Y
"RTN","PSGAP0",18,0)
 Q
"RTN","PSGAP0",19,0)
 ;
"RTN","PSGAP0",20,0)
PAT ;
"RTN","PSGAP0",21,0)
 ;;S RB=$G(^DPT(PSGP,.101)),TM="zz" S:RB]"" TM=$S('$D(PSGAPTM):"zz",1:$O(^PS(57.7,"AWRT",PSGAPWD,RB,0))) I PSGAPWDN="" S PSGAPWDN="* NF *"
"RTN","PSGAP0",22,0)
 S RB=$G(^DPT(PSGP,.101)) S:RB]"" TM=$S('$D(PSGAPTM):"zz",1:$O(^PS(57.7,"AWRT",PSGAPWD,RB,0))) S:$G(TM)="" TM="zz" I PSGAPWDN="" S PSGAPWDN="* NF *"
"RTN","PSGAP0",23,0)
 I $D(PSGAPTM) S ATM="",ATM=$O(PSGAPTM(ATM)) I ATM'="ALL" Q:'$D(PSGAPTM(+TM))
"RTN","PSGAP0",24,0)
 S:TM'="zz" TM=^PS(57.7,PSGAPWD,1,TM,0)
"RTN","PSGAP0",25,0)
 S PSJACNWP=1 D PSJAC2^PSJAC(1),NOW^%DTC S PSGDT=%,PND=PSGP(0),PN=$S($G(PSJSEL("RBP"))="R":RB,1:"")_"^"_$E($P(PND,"^"),1,20)_"^"_PSGP
"RTN","PSGAP0",26,0)
 I '$G(STT) S STT=PSGDT,STP=9999999
"RTN","PSGAP0",27,0)
 S:PSGMTYPE[1 PSGMTYPE="2,3,4,5,6"
"RTN","PSGAP0",28,0)
 I PSGMTYPE[2 D
"RTN","PSGAP0",29,0)
 . F STRT=STT:0 S STRT=$O(^PS(55,PSGP,5,"AUS",STRT)) Q:'STRT  F PSJJORD=0:0 S PSJJORD=$O(^PS(55,PSGP,5,"AUS",STRT,PSJJORD)) Q:'PSJJORD  D GOD
"RTN","PSGAP0",30,0)
 . S XTYPE=2,PST="S" D ^PSGAPIV
"RTN","PSGAP0",31,0)
 N XTYPE F XTYPE=3:1:6 I PSGMTYPE[XTYPE S PST=$S(XTYPE=3:"P",XTYPE=4:"A",XTYPE=5:"H",1:"C") D ^PSGAPIV
"RTN","PSGAP0",32,0)
 I PSGMTYPE[3 S XTYPE=3,PST="S" D ^PSGAPIV ;* Find syringe type iv
"RTN","PSGAP0",33,0)
 I $D(^TMP($J,$E(PSGAPWDN,1,20),TM,PN)) D
"RTN","PSGAP0",34,0)
 . ;naked reference on line below refers to full global reference on line above
"RTN","PSGAP0",35,0)
 . S ^(PN)=$P(PSJPSEX,"^",2)_"^"_$E($P(PSJPDOB,"^",2),1,10)_";"_PSJPAGE_"^"_VA("PID")_"^"_PSJPDX_"^"_$S(PSJPRB]"":PSJPRB,1:"*NF*")_"^"_$E($P(PSJPAD,"^",2),1,10)_"^"_$E($P(PSJPTD,"^",2),1,10)_"^"_+PSJPWT
"RTN","PSGAP0",36,0)
 . S:($G(PSJSEL("WG"))="^OTHER") ^TMP("PSGAP0",$J,"OUTPT",PSGP)=""
"RTN","PSGAP0",37,0)
 Q
"RTN","PSGAP0",38,0)
 ;
"RTN","PSGAP0",39,0)
GDT ;
"RTN","PSGAP0",40,0)
 K %DT S %DT="EFTX",Y=-1,%DT(0)=$S(N["R":PSGDT,1:STT) F  W !!,"Enter ",N," date/time: " R X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D DTM:X?1."?",^%DT Q:Y>0
"RTN","PSGAP0",41,0)
 I X'="^" S:N["R" STT=$S(Y'>0:PSGDT,Y#1:+$E(Y,1,12),1:Y+.0002)-.0001 S:N["O" STP=$S(Y'>0:9999999,Y#1:+$E(Y,1,12),1:Y+.24)
"RTN","PSGAP0",42,0)
 K %DT Q
"RTN","PSGAP0",43,0)
 ;
"RTN","PSGAP0",44,0)
EN ; entry point
"RTN","PSGAP0",45,0)
 I PSGSS'="P" D NOW^%DTC S PSGDT=%,DT=$$DT^XLFDT F N="START","STOP" D GDT I X="^" S PSJSTOP=1 Q
"RTN","PSGAP0",46,0)
 I PSGSS'="P" Q:X="^"  S:'$P(STP,".",2) $P(STP,".",2)=24 S:'$P(STT,".",2) $P(STT,".",2)="0001"
"RTN","PSGAP0",47,0)
 S PSJSTOP=$$MEDTYPE^PSJMDIR($G(PSGWD)) Q:PSJSTOP  S PSGMTYPE=Y
"RTN","PSGAP0",48,0)
 K ZTSAVE S:PSGSS'="P" (ZTSAVE("STT"),ZTSAVE("STP"))="" F X="PSGP","PSGSS","PSGAPWD","PSGAPWG","PSGAPWDN","PSGAPWGN","PSGPAT(","PSGAPTM(","PSGMTYPE","PSGPTMP","PSJSEL(","PSJOS","PPAGE" S ZTSAVE(X)=""
"RTN","PSGAP0",49,0)
 W !,"...this may take a few minutes...(you should QUEUE this report)..."
"RTN","PSGAP0",50,0)
 S PSGTIR="ENQ^PSGAP0",ZTDESC="ACTION PROFILE" D ENDEV^PSGTI S:POP PSJSTOP=1 Q:POP!$D(IO("Q"))
"RTN","PSGAP0",51,0)
 ;
"RTN","PSGAP0",52,0)
ENQ ; queued entry point
"RTN","PSGAP0",53,0)
 K ^TMP("PSGAP0",$J) N RB,ATM,TM,DRGI,DRGN,DRGT,ON,PST,PSIVUP,PSJORIFN,QST,SLS,XTYPE
"RTN","PSGAP0",54,0)
 D @("P"_PSGSS),^PSGAPP D ^%ZISC K ^TMP("PSGAP0",$J)
"RTN","PSGAP0",55,0)
 Q
"RTN","PSGAP0",56,0)
 ;
"RTN","PSGAP0",57,0)
PG ;
"RTN","PSGAP0",58,0)
 I $G(PSJSEL("WG"))="^OTHER" D CLIN Q
"RTN","PSGAP0",59,0)
 F PSGAPWD=0:0 S PSGAPWD=$O(^PS(57.5,"AC",PSGAPWG,PSGAPWD)) Q:'PSGAPWD  I $D(^DIC(42,PSGAPWD,0)),$P(^(0),"^")]"" S PSGAPWDN=$P(^(0),"^") D PW
"RTN","PSGAP0",60,0)
 Q
"RTN","PSGAP0",61,0)
 ;
"RTN","PSGAP0",62,0)
CLIN ;
"RTN","PSGAP0",63,0)
 F INDEX="AIVC","AUDC" S STOP=0 F  S STOP=$O(^PS(55,INDEX,STOP)) Q:'STOP  S CLIN=0 F  S CLIN=$O(^PS(55,INDEX,STOP,CLIN)) Q:'CLIN  D
"RTN","PSGAP0",64,0)
 . S DFN=0 F  S DFN=$O(^PS(55,INDEX,STOP,CLIN,DFN)) Q:'DFN  I '$D(^TMP("PSGAP0",$J,"OUTPT",DFN)) D
"RTN","PSGAP0",65,0)
 .. S PSGP=DFN,Q=STOP N STOP D PAT
"RTN","PSGAP0",66,0)
 Q
"RTN","PSGAP0",67,0)
 ;
"RTN","PSGAP0",68,0)
PW ;
"RTN","PSGAP0",69,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGAPWDN,PSGP)) Q:'PSGP  D
"RTN","PSGAP0",70,0)
 .S Q=$O(^PS(55,PSGP,5,"AUS",STT)) I Q D PAT Q
"RTN","PSGAP0",71,0)
 .S Q=$O(^PS(55,PSGP,"IV","AIS",STT)) I Q D PAT
"RTN","PSGAP0",72,0)
 Q
"RTN","PSGAP0",73,0)
 ;
"RTN","PSGAP0",74,0)
PP ;
"RTN","PSGAP0",75,0)
 F PSGP=0:0 S PSGP=$O(PSGPAT(PSGP)) Q:'PSGP  S PSGAPWDN=$P($G(^DPT(PSGP,.1)),"^") S:PSGAPWDN]"" PSGAPWD=+$O(^DIC(42,"B",PSGAPWDN,0)) D PAT
"RTN","PSGAP0",76,0)
 Q
"RTN","PSGAP0",77,0)
 ;
"RTN","PSGAP0",78,0)
DTM ;
"RTN","PSGAP0",79,0)
 S Y=%DT(0) D D^DIQ S T=$P(Y,"@",2),Y=$P(Y,",")
"RTN","PSGAP0",80,0)
 W !!?2,"If a ",N," date is entered, an action profile will print for only those",!,"patients that have at least one active order with a ",$S(N["A":"STOP",1:"START")," DATE on or ",$S(N["A":"after",1:"before"),!,"the ",N," date entered."
"RTN","PSGAP0",81,0)
 W !?2,"Entry is not required.  If neither date is entered, all patients with active",!,"orders will print (for the ward(s) chosen).  Enter an up-arrow (^) to exit."
"RTN","PSGAP0",82,0)
 W !?2,"If you wish to enter a ",$S(N["R":"start",1:"stop")," date of ",Y,", you must enter a TIME of day",!,"of ",T," or greater.  Any date after ",Y," does not need time entered.",! S Y=-1 Q
"RTN","PSGAPP")
0^45^B25259233
"RTN","PSGAPP",1,0)
PSGAPP ;BIR/CML3-PRINT DATA FOR ACTION PROFILE ;05 Oct 98 / 10:36 AM
"RTN","PSGAPP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,20,60,50,111**;16 DEC 97
"RTN","PSGAPP",3,0)
 ;
"RTN","PSGAPP",4,0)
LOOP ;
"RTN","PSGAPP",5,0)
 D NOW^%DTC S PSGDT=%,DT=$$DT^XLFDT,PSGPDT=$$ENDTC2^PSGMI(PSGDT),CML=IO'=IO(0)!($E(IOST,1,2)'="C-")
"RTN","PSGAPP",6,0)
 U IO I '$D(^TMP($J)) W:$Y @IOF W !?28,"UNIT DOSE ACTION PROFILE",?62,PSGPDT,!?10,"NO ACTIVE ORDERS FOUND FOR ",$S(PSGSS="G":"WARD GROUP: "_PSGAPWGN,PSGSS="W":"WARD: "_PSGAPWDN,1:"PATIENT(S) SELECTED"),"." G DONE
"RTN","PSGAPP",7,0)
 S PSGVAMC=$$SITE^PSGMMAR2(80)
"RTN","PSGAPP",8,0)
 S (LN,LINE,ALN)="",$P(LN,"_",19)="",$P(LINE,"-",81)="",$P(ALN," -",18)="",ALN=ALN_" A C T I V E"_ALN
"RTN","PSGAPP",9,0)
 S (PN,WD,TM)="" F  S WD=$O(^TMP($J,WD)) Q:WD=""!$D(PSJDLW)  F  S TM=$O(^TMP($J,WD,TM)) Q:TM=""!$D(PSJDLW)  F  S PN=$O(^TMP($J,WD,TM,PN)) Q:PN=""!$D(PSJDLW)  D
"RTN","PSGAPP",10,0)
 . ;naked reference on line below refers to the full reference on the line above
"RTN","PSGAPP",11,0)
 . S PI=$G(^(PN)),AMO=0 S:PI="" PI=$G(^TMP($J,WD,"zz",PN)) D H1
"RTN","PSGAPP",12,0)
 ;
"RTN","PSGAPP",13,0)
DONE ;
"RTN","PSGAPP",14,0)
 W:CML&($Y) @IOF K AD,ALN,AMO,CML,DF,LINE,LN,MF,N,PG,PI,PPN,PSGPDT,RCT,RF,PID,TD,TM,WD,PSJDLW,PSJTEAM,PSGVAMC Q
"RTN","PSGAPP",15,0)
 ;
"RTN","PSGAPP",16,0)
H1 ;
"RTN","PSGAPP",17,0)
 Q:$D(PSJDLW)
"RTN","PSGAPP",18,0)
 I $E(IOST,1)="C" K DIR S DIR(0)="E" D ^DIR K DIR S:$D(DTOUT)!$D(DUOUT) PSJDLW=1 I $D(DTOUT)!$D(DUOUT) Q
"RTN","PSGAPP",19,0)
 S (N,DF)=0,PSEX=$P(PI,"^"),PDOB=$P(PI,"^",2),PID=$P(PI,"^",3),RB=$P(PI,"^",5),AD=$P(PI,"^",6),TD=$P(PI,"^",7),WT=$P(PI,"^",8),PI=$P(PI,"^",4),PPN=$P(PN,"^",2),(DFN,PSGP)=$P(PN,"^",3)
"RTN","PSGAPP",20,0)
 S PAGE=$P(PDOB,";",2),PDOB=$P(PDOB,";"),PG=1 W:$Y @IOF W !?26,"UNIT DOSE ACTION PROFILE #1",?62,PSGPDT
"RTN","PSGAPP",21,0)
 W !?+PSGVAMC,$P(PSGVAMC,U,2)
"RTN","PSGAPP",22,0)
 W !?23,"(Continuation of VA FORM 10-1158)",?72,"Page: 1",!,LINE
"RTN","PSGAPP",23,0)
 W !,"   This form is to be used to REVIEW/RENEW/CANCEL existing active medication",!," orders for inpatients.  Review the active orders listed and beside"
"RTN","PSGAPP",24,0)
 W " each order",!," circle one of the following:",!?30,"R - to RENEW the order",!?30,"D - to DISCONTINUE the order",!?30,"N - to take NO ACTION (the order will remain",!?34,"active until the stop date indicated)"
"RTN","PSGAPP",25,0)
 W !!,"   A new order must be written for any new medication or to make any changes",!," in dosage or directions on an existing order.",!,LINE,!
"RTN","PSGAPP",26,0)
 S PSJOPC="" D ENTRY^PSJHEAD(DFN,PSJOPC,PG,$G(PSJNARC),$G(PSJTEAM,1),1)
"RTN","PSGAPP",27,0)
 W !,LINE,!," No. Action",?16,"Drug",?52,"ST Start Stop  Status/Info",!,ALN
"RTN","PSGAPP",28,0)
END ;
"RTN","PSGAPP",29,0)
 S (ON,DRG)="" F  S DRG=$O(^TMP($J,WD,TM,PN,DRG)) Q:DRG=""  F  S ON=$O(^TMP($J,WD,TM,PN,DRG,ON)) Q:ON=""  S ND=^(ON),SI=$G(^(ON,1)) D NP:$Y+11>IOSL Q:$D(PSJDLW)  D ORDP
"RTN","PSGAPP",30,0)
 Q:$D(PSJDLW)
"RTN","PSGAPP",31,0)
 I $D(^PS(53.1,"AC",PSGP)) W !!?13,"******** THIS PATIENT HAS NON-VERIFIED ORDERS. ********"
"RTN","PSGAPP",32,0)
 S DF=1 W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE"
"RTN","PSGAPP",33,0)
 D:$Y+11>IOSL NP1 W:'$D(PSJDLW) !!!?10,"MULTIDISCIPLINARY REVIEW",!?16,"(WHEN APPROPRIATE)",?40,LN_LN,!?40,"PHARMACIST'S SIGNATURE"
"RTN","PSGAPP",34,0)
 D:$Y+7>IOSL NP1 W:'$D(PSJDLW) !!?40,LN_LN,!?40,"NURSE'S SIGNATURE"
"RTN","PSGAPP",35,0)
 I IOSL-$Y>11 W !!?3,"ADDITIONAL MEDICATION ORDERS:" F  W !!,LINE Q:$Y+9>IOSL  S AMO=1
"RTN","PSGAPP",36,0)
 I  W !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE",!
"RTN","PSGAPP",37,0)
 E  I $Y+6<IOSL F Q=$Y+5:1:IOSL-1 W !
"RTN","PSGAPP",38,0)
 W:'$D(PSJDLW) !?2,PPN,?40,PID,?78-$L(PDOB),PDOB
"RTN","PSGAPP",39,0)
 I 'AMO D
"RTN","PSGAPP",40,0)
 .S AMO=1 D NP1 Q:$D(PSJDLW)  W !!?3,"ADDITIONAL MEDICATION ORDERS:" F  W !!,LINE Q:$Y+9>IOSL
"RTN","PSGAPP",41,0)
 .W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE",!
"RTN","PSGAPP",42,0)
 .W:'$D(PSJDLW) !?2,PPN,?40,PID,?78-$L(PDOB),PDOB
"RTN","PSGAPP",43,0)
 Q
"RTN","PSGAPP",44,0)
 ;
"RTN","PSGAPP",45,0)
ORDP ;
"RTN","PSGAPP",46,0)
 S N=N+1 I ND="" D PRT^PSGAPIV(ON) Q
"RTN","PSGAPP",47,0)
 N X,PSG S PSGP=$P(PN,U,3)
"RTN","PSGAPP",48,0)
 D DRGDISP^PSJLMUT1(+PSGP,+ON_"U",39,65,.PSG,0)
"RTN","PSGAPP",49,0)
 S SM=$P(ND,"^",5),NF=$P(ND,"^",6) W !,$J(N,3) W "  R D N "
"RTN","PSGAPP",50,0)
 W PSG(1),?52,$P(DRG,U),?55,$P(ND,U,2),?61,$P(ND,U,3),?67,$P(ND,U) I NF!SM!$P(ND,U,4) W ?71 W:NF "NF " W:$P(ND,U,4) "WS " W:SM $E("HSM",SM,3)
"RTN","PSGAPP",51,0)
 N X F X=1:0 S X=$O(PSG(X)) Q:'X  W !?11,PSG(X)
"RTN","PSGAPP",52,0)
 I SI]"" W !?11,"Special Instructions: " F X=1:1:$L(SI," ") S Y=$P(SI," ",X) W:$X+$L(Y)>78 !?35 W Y," "
"RTN","PSGAPP",53,0)
 W ! Q
"RTN","PSGAPP",54,0)
 ;
"RTN","PSGAPP",55,0)
NP ;
"RTN","PSGAPP",56,0)
 Q:$G(PSJDLW)
"RTN","PSGAPP",57,0)
 W !!?16,LN,?40,LN_LN,!?16,"Date and Time",?40,"PROVIDER'S SIGNATURE"
"RTN","PSGAPP",58,0)
 ;
"RTN","PSGAPP",59,0)
NP1 ;
"RTN","PSGAPP",60,0)
 Q:$D(PSJDLW)
"RTN","PSGAPP",61,0)
 I $E(IOST,1)="C" K DIR S DIR(0)="E" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S PSJDLW=1 Q
"RTN","PSGAPP",62,0)
 I $Y+5<IOSL F Q=$Y:1:IOSL-4 W !
"RTN","PSGAPP",63,0)
 S PG=PG+1 W:'AMO !?2,PPN,?40,PID,?78-$L(PDOB),PDOB W:$Y @IOF W !?26,"UNIT DOSE ACTION PROFILE #1",?73-$L(PG),"Page: "_PG
"RTN","PSGAPP",64,0)
 W !?+PSGVAMC,$P(PSGVAMC,U,2)
"RTN","PSGAPP",65,0)
 W !?1,PPN,?40,PID,?60,PDOB I DF W !!,LINE Q
"RTN","PSGAPP",66,0)
 W:'AMO !!," No. Action",?16,"Drug",?52,"ST Start Stop  Status/Info",!,ALN Q
"RTN","PSGAPP",67,0)
 ;
"RTN","PSGAPP",68,0)
ENRCT ;
"RTN","PSGAPP",69,0)
 N DFN,GMRA,GMRAL,RCT,X S DFN=PSGP,GMRA="0^0^111" D EN1^GMRADPT
"RTN","PSGAPP",70,0)
 S X=0 F  S X=$O(GMRAL(X)) Q:'X  I $P(GMRAL(X),"^",2)]"" S RCT($P(GMRAL(X),"^",2))=""
"RTN","PSGAPP",71,0)
 I '$D(RCT) W " ____________________" Q
"RTN","PSGAPP",72,0)
 S RCT="" F X=0:1 S RCT=$O(RCT(RCT)) Q:RCT=""  W:X "," W:$X+$L(RCT)>77 ! W " ",$S(RCT="NKA":"No Known Allergies",1:RCT)
"RTN","PSGAPP",73,0)
 Q
"RTN","PSGAXR")
0^81^B7839791
"RTN","PSGAXR",1,0)
PSGAXR ;BIR/CML3-EXECUTE VARIOUS XREFS ;24 JUN 96 / 12:06 PM
"RTN","PSGAXR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**111**;16 DEC 97
"RTN","PSGAXR",3,0)
 ;
"RTN","PSGAXR",4,0)
ENSS ; set x-refs under 53.1,28
"RTN","PSGAXR",5,0)
 S ZZ=+$G(^PS(53.1,DA,.2)) S:$D(PSGP)[0 PSGP=$P($G(^PS(53.1,DA,0)),"^",15)_"^1" I 'PSGP,'ZZ K ZZ K:$P(PSGP,"^",2) PSGP Q
"RTN","PSGAXR",6,0)
 I PSGP D 
"RTN","PSGAXR",7,0)
 . S ^PS(53.1,"AS",X,+PSGP,DA)="" I $S(X["A":0,1:X'["D") S ^PS(53.1,"AC",+PSGP,DA)="" S:ZZ ^PS(53.1,"AOD",+PSGP,ZZ,DA)=""
"RTN","PSGAXR",8,0)
 . I X="P",+$P($G(^PS(53.1,DA,4)),U) S ^PS(53.1,"AV",+PSGP,DA)=""
"RTN","PSGAXR",9,0)
 ;I X]"" S ZZ=$S($G(ORIFN):ORIFN,1:$P($G(^PS(53.1,DA,0)),"^",21)_"^1") I ZZ S ORIFN=+ZZ D ENSC^PSGORU K:$P(ZZ,"^",2) ORIFN
"RTN","PSGAXR",10,0)
 ;D EN1^PSJHL2(PSGP,"OC",DA_"P")
"RTN","PSGAXR",11,0)
 K ZZ K:$P(PSGP,"^",2) PSGP Q
"RTN","PSGAXR",12,0)
 ;
"RTN","PSGAXR",13,0)
ENSK ; kill x-refs under 53.1,28
"RTN","PSGAXR",14,0)
 S:$D(PSGP)[0 PSGP=$P($G(^PS(53.1,DA,0)),"^",15)_"^1" S ZZ=+$G(^PS(53.1,DA,.1)),ZZZ=+$G(^PS(53.1,DA,"DSS"))
"RTN","PSGAXR",15,0)
 I PSGP K ^PS(53.1,"AC",+PSGP,DA),^PS(53.1,"AS",X,+PSGP,DA),^PS(53.1,"AV",+PSGP,DA) K:ZZ ^PS(53.1,"AOD",+PSGP,ZZ,DA) K:ZZZ ^PS(53.1,"AD",ZZZ,+PSGP,DA)
"RTN","PSGAXR",16,0)
 K ZZ K:$P(PSGP,"^",2) PSGP Q
"RTN","PSGAXR",17,0)
 ;
"RTN","PSGAXR",18,0)
ENNDS ; set x-refs under 53.1,.1
"RTN","PSGAXR",19,0)
 S ^PS(53.1,"D",X,DA)="" S:$D(PSGP)[0 PSGP=$P($G(^PS(53.1,DA,0)),"^",15)_"^1" I PSGP S PSGX=X D END^PSGSICHK S X=PSGX,PSGX=$P($G(^PS(53.1,DA,0)),"^",9) I $S(PSGX["A":0,1:PSGX'["D") S ^PS(53.1,"AOD",+PSGP,X,DA)=""
"RTN","PSGAXR",20,0)
 K PSGX K:$P(PSGP,"^",2) PSGP Q
"RTN","PSGAXR",21,0)
 ;
"RTN","PSGAXR",22,0)
ENNDK ; kill x-refs under 53.1,.1
"RTN","PSGAXR",23,0)
 S:$D(PSGP)[0 PSGP=$P($G(^PS(53.1,DA,0)),"^",15)_"^1" K ^PS(53.1,"D",X,DA) K:PSGP ^PS(53.1,"AOD",+PSGP,X,DA) K:$P(PSGP,"^",2) PSGP Q
"RTN","PSGAXR",24,0)
 ;
"RTN","PSGAXR",25,0)
ENNPS ; set x-refs under 53.1,.5
"RTN","PSGAXR",26,0)
 S ^PS(53.1,"C",X,DA)="",PSGX=$P($G(^PS(53.1,DA,0)),"^",9) S:PSGX]"" ^PS(53.1,"AS",PSGX,X,DA)=""
"RTN","PSGAXR",27,0)
 I $S(PSGX["A":0,1:PSGX'["D") S ^PS(53.1,"AC",X,DA)=""
"RTN","PSGAXR",28,0)
 I PSGX="P",+$P($G(^PS(53.1,DA,4)),U) S ^PS(53.1,"AV",X,DA)=""
"RTN","PSGAXR",29,0)
 S:PSGX ^PS(53.1,"AOD",X,PSGX,DA)=""
"RTN","PSGAXR",30,0)
 K PSGX Q
"RTN","PSGAXR",31,0)
 ;
"RTN","PSGAXR",32,0)
ENNPK ; kill x-refs under 53.1,.5
"RTN","PSGAXR",33,0)
 K ^PS(53.1,"AC",X,DA),^PS(53.1,"C",X,DA) S PSGX=$P($G(^PS(53.1,DA,0)),"^",9) K:PSGX]"" ^PS(53.1,"AS",PSGX,X,DA) S PSGX=+$G(^PS(53.1,DA,.1)) K:PSGX ^PS(53.1,"AOD",X,PSGX,DA)
"RTN","PSGAXR",34,0)
 K ^PS(53.1,"AV",X,DA)
"RTN","PSGAXR",35,0)
 K PSGX Q
"RTN","PSGAXR",36,0)
ENNACK ; Set x-refs under Nurse verification for acknowleged pending orders.
"RTN","PSGAXR",37,0)
 S PSGX=$G(^PS(53.1,DA,0)) S PSGP=$P(PSGX,U,15)
"RTN","PSGAXR",38,0)
 S PSGST=$P(PSGX,U,9)
"RTN","PSGAXR",39,0)
 I PSGP,+X,(PSGST="P") S ^PS(53.1,"AV",PSGP,DA)=""
"RTN","PSGAXR",40,0)
 K PSGX,PSGP,PSGST Q
"RTN","PSGAXR",41,0)
ENNACKK ; Kill x-refs under Nurse verification
"RTN","PSGAXR",42,0)
 S PSGP=$P($G(^PS(53.1,DA,0)),U,15)
"RTN","PSGAXR",43,0)
 K:+PSGP ^PS(53.1,"AV",+PSGP,DA) Q
"RTN","PSGCAP")
0^37^B33088285
"RTN","PSGCAP",1,0)
PSGCAP ;BIR/CML3-ACTION PROFILE (#2) ;04 APR 96 / 1:10 PM
"RTN","PSGCAP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**111**;16 DEC 97
"RTN","PSGCAP",3,0)
 N PSJNEW,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSGCAP",4,0)
 ;
"RTN","PSGCAP",5,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGCAP",6,0)
 ;
"RTN","PSGCAP",7,0)
START ;
"RTN","PSGCAP",8,0)
 S (PSGAP,PSGP,PSGAPWD,PSGAPWG)=0,(PSGAPWDN,PSGAPWGN)="",PSGSSH="AP" S PSGPTMP=0,PPAGE=1
"RTN","PSGCAP",9,0)
 D ^PSGSEL G:PSGSS="^"!(PSGSS="") DONE D @PSGSS I (Y'="^OTHER"),(Y'>0) W !!?3,"No patient(s) selected.  Option terminated." G START
"RTN","PSGCAP",10,0)
 ;
"RTN","PSGCAP",11,0)
ORS I '$G(PSGAPWG) S PSGAPS="P" G ORS1
"RTN","PSGCAP",12,0)
 S PSGAPS="T" I $S(PSGSS'="P":1,1:PSGPAT>1) F  W !!,"Sort Action Profiles by (T)eam or Treating (P)rovider? T// " R PSGAPS:DTIME D Q1 Q:PSGAPS]""
"RTN","PSGCAP",13,0)
ORS1 G:PSGAPS="^" START D NOW^%DTC S PSGDT=% F N="START","STOP" D GDT G:$D(DIRUT) START
"RTN","PSGCAP",14,0)
 F  W !!,"Print (A)ll active orders, or (E)xpiring orders only? A// " R PSGAPO:DTIME D Q2 Q:PSGAPO]""
"RTN","PSGCAP",15,0)
 G:PSGAPO="^" START
"RTN","PSGCAP",16,0)
 G:$$MEDTYPE^PSJMDIR($G(PSGWD)) START S PSGMTYPE=Y
"RTN","PSGCAP",17,0)
 K ZTSAVE F X="PSGAPS","PSGAPO","PSGAPSD","PSGAPFD","PSGMTYPE","PSGP","PSGSS","PSGAPWD","PSGAPWG","PSGAPWDN","PSGAPWGN","PSGPAT(","PSGPTMP","PPAGE" S ZTSAVE(X)=""
"RTN","PSGCAP",18,0)
 S PSGTIR="ENQ^PSGCAP0",ZTDESC="ACTION PROFILE" D ENDEV^PSGTI G:POP START G:$D(IO("Q")) DONE
"RTN","PSGCAP",19,0)
 W !,"...this may take a few minutes...(you really should QUEUE this report)..." D ENQ^PSGCAP0
"RTN","PSGCAP",20,0)
 ;
"RTN","PSGCAP",21,0)
 ;
"RTN","PSGCAP",22,0)
DONE ;
"RTN","PSGCAP",23,0)
 D ENKV^PSGSETU K CA,CNTR,DIAG,DO,DRG,FD,LQ,N,NF,ND,ND2,PSJJORD,PAGE,PDOB,PN,PND,PSEX,PSGAP,PSGAPWD,PSGAPWDN,PSGAPWG,PSGAPWGN,PSGDICA,PSGPAT,PSGSS
"RTN","PSGCAP",24,0)
 K PSGSSH,RB,RTE,SD,SI,SM,ST,STRT,STP,STT,WS,WT,S1,ZTOUT,PSGAPFD,PSGAPSD,PSGAPS,PSGAPO,PSJACNWP,PSJDLW,PSJOPC,PSJPWDO,PSGWD
"RTN","PSGCAP",25,0)
 K PSGADR,PSGALG,PSGEXPDT,PSGMTYPE,PSJSI,PSJSTOP,PSJTEAM,PST,QST
"RTN","PSGCAP",26,0)
 K ^TMP($J)
"RTN","PSGCAP",27,0)
 Q
"RTN","PSGCAP",28,0)
 ;
"RTN","PSGCAP",29,0)
GDT ;
"RTN","PSGCAP",30,0)
 K DIR NEW MINDT S:N="START" MINDT=PSGDT-.0001,DIR("B")="NOW" S:N="STOP" MINDT=PSGAPSD,DIR("B")=$$ENDD^PSGMI(PSGAPSD)
"RTN","PSGCAP",31,0)
 S DIR(0)="DA^"_MINDT_":9999999.9999:EFTX",DIR("?")="^D DTM^PSGCAP",DIR("A")="Enter "_$S(N["R":"START",1:"STOP")_" date/time: " D ^DIR K DIR Q:$D(DIRUT)
"RTN","PSGCAP",32,0)
 I X'="^" S:N["R" PSGAPSD=$S(Y'>0:PSGDT,Y#1:+$E(Y,1,12),1:Y+.0001) S:N["O" PSGAPFD=$S(Y'>0:9999999,Y#1:+$E(Y,1,12),1:Y+.24)
"RTN","PSGCAP",33,0)
  Q
"RTN","PSGCAP",34,0)
 ;
"RTN","PSGCAP",35,0)
G ; get ward group
"RTN","PSGCAP",36,0)
 S DIC="^PS(57.5,",DIC(0)="QEAMZ",DIC("A")="Select WARD GROUP: " W ! D ^DIC K DIC S:Y>0 PSGAPWG=+Y,PSGAPWGN=Y(0,0) I Y<0,X="^OTHER" D
"RTN","PSGCAP",37,0)
 . S (Y,PSGAPWG,PSGAPWGN)="^OTHER",(PSGAPWD,PSGAPWDN)="zz"
"RTN","PSGCAP",38,0)
 Q
"RTN","PSGCAP",39,0)
 ;
"RTN","PSGCAP",40,0)
C ;
"RTN","PSGCAP",41,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGCAP",42,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGCAP",43,0)
CDIC ;
"RTN","PSGCAP",44,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y
"RTN","PSGCAP",45,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGCAP",46,0)
 Q
"RTN","PSGCAP",47,0)
L ;
"RTN","PSGCAP",48,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGCAP",49,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGCAP",50,0)
LDIC ;
"RTN","PSGCAP",51,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y
"RTN","PSGCAP",52,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGCAP",53,0)
 Q
"RTN","PSGCAP",54,0)
W ; get ward
"RTN","PSGCAP",55,0)
 S DIC="^DIC(42,",DIC(0)="QEAMZ",DIC("A")="Select WARD: " W ! D ^DIC K DIC S:Y>0 (PSGWD,PSGAPWD)=+Y,PSGAPWDN=Y(0,0) Q
"RTN","PSGCAP",56,0)
 ;
"RTN","PSGCAP",57,0)
P ; get patient
"RTN","PSGCAP",58,0)
 K PSGPAT,PSJPWDO,PSGWD
"RTN","PSGCAP",59,0)
 S PSGPAT=0 F CNTR=1:1 S:CNTR>1 PSGDICA="another" D ENP^PSGGAO Q:PSGP'>0  S PSGPAT(PSGP)="",PSGPAT=PSGPAT+1 S:'$G(PSJPWDO) (PSGWD,PSJPWDO)=PSJPWD S PSGWD=$S('$G(PSGWD):0,PSJPWDO=PSJPWD:PSJPWD,1:0)
"RTN","PSGCAP",60,0)
 S Y=$S(PSGPAT:1,1:-1) K PSGDICA Q
"RTN","PSGCAP",61,0)
 ;
"RTN","PSGCAP",62,0)
DTM ;
"RTN","PSGCAP",63,0)
 S Y=PSGDT D D^DIQ S T=$P(Y,"@",2),Y=$P(Y,",")
"RTN","PSGCAP",64,0)
 W !!?2,"Enter a ",N," date.  If a time is not entered for the ",N," date, the",!,$S(N["R":"beginning",1:"end")," of the day is assumed and used."
"RTN","PSGCAP",65,0)
 W !?2,"If you wish to enter a ",$S(N["R":"start",1:"stop")," date of ",Y,", you must enter a TIME of day",!,"of ",T," or greater.  Any date after ",Y," does not need time entered.",! S Y=-1 Q
"RTN","PSGCAP",66,0)
 ;
"RTN","PSGCAP",67,0)
Q1 ;
"RTN","PSGCAP",68,0)
 W:'$T $C(7) S:'$T PSGAPS="^" Q:PSGAPS="^"
"RTN","PSGCAP",69,0)
 I PSGAPS="" S PSGAPS="T" W "  (TEAM)" Q
"RTN","PSGCAP",70,0)
 I PSGAPS?.E1C.E S PSGAPS="" W $C(7),"  ??" Q
"RTN","PSGCAP",71,0)
 I PSGAPS?1."?" W !!?2,"Enter 'T' (or press RETURN) to sort and print patients by TEAM.  Enter 'P'",!,"to sort and print patients by treating PROVIDER." S PSGAPS="" Q
"RTN","PSGCAP",72,0)
 F Q=1:1:$L(PSGAPS) I $E(PSGAPS,Q)?1L S PSGAPS=$E(PSGAPS,1,Q-1)_$C($A($E(PSGAPS,Q))-32)_$E(PSGAPS,Q+1,$L(PSGAPS))
"RTN","PSGCAP",73,0)
 F X="TEAM","PROVIDER" I $P(X,PSGAPS)="" W $P(X,PSGAPS,2) S PSGAPS=$E(X) Q
"RTN","PSGCAP",74,0)
 E  W $C(7),"  ??" S PSGAPS=""
"RTN","PSGCAP",75,0)
 Q
"RTN","PSGCAP",76,0)
 ;
"RTN","PSGCAP",77,0)
Q2 ;
"RTN","PSGCAP",78,0)
 W:'$T $C(7) S:'$T PSGAPO="^" Q:PSGAPO="^"
"RTN","PSGCAP",79,0)
 I PSGAPO="" S PSGAPO="A" W "  (ALL)" Q
"RTN","PSGCAP",80,0)
 I PSGAPO?.E1C.E S PSGAPO="" W $C(7),"  ??" Q
"RTN","PSGCAP",81,0)
 I PSGAPO?1."?" W !!?2,"Enter 'A' (or press RETURN) to print ALL ACTIVE orders for the patient(s)",!,"selected.  Enter 'E' to print only orders that will EXPIRE within the date",!,"range selected for the patient(s) selected." S PSGAPO="" Q
"RTN","PSGCAP",82,0)
 F Q=1:1:$L(PSGAPO) I $E(PSGAPO,Q)?1L S PSGAPO=$E(PSGAPO,1,Q-1)_$C($A($E(PSGAPO,Q))-32)_$E(PSGAPO,Q+1,$L(PSGAPO))
"RTN","PSGCAP",83,0)
 F X="ALL","EXPIRING" I $P(X,PSGAPO)="" W $P(X,PSGAPO,2) S PSGAPO=$E(X) Q
"RTN","PSGCAP",84,0)
 E  W $C(7),"  ??" S PSGPAS=""
"RTN","PSGCAP",85,0)
 Q
"RTN","PSGCAP",86,0)
ENLM ;Entry point for PSJ LM AP2 protocol
"RTN","PSGCAP",87,0)
 N PSJNEW,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSGCAP",88,0)
 S PSGPTMP=0,PPAGE=1
"RTN","PSGCAP",89,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGCAP",90,0)
 S PSGPAT=PSGP,PSGPAT(DFN)="",(PSGAPWD,PSGAPWG)=0,(PSGAPWDN,PSGAPWGN)="",PSGSS="P",PSGAPS="T" D ORS1
"RTN","PSGCAP",91,0)
 S PSJNKF=1 G DONE
"RTN","PSGCAP0")
0^38^B21624437
"RTN","PSGCAP0",1,0)
PSGCAP0 ;BIR/CML3-ACTION PROFILE ;12 Mar 98 / 9:30 AM
"RTN","PSGCAP0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,58,111**;16 DEC 97
"RTN","PSGCAP0",3,0)
 ;
"RTN","PSGCAP0",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSGCAP0",5,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGCAP0",6,0)
 ;
"RTN","PSGCAP0",7,0)
GOD ; gather order data
"RTN","PSGCAP0",8,0)
 S ND=$G(^PS(55,PSGP,5,PSJJORD,0)),ND2=$G(^(2)),SI=$P($G(^(6)),"^"),DRG=$G(^(.2)) ;WS=$S(DRG&PSGAPWD:$D(^PSI(58.1,"D",+DRG,PSGAPWD)),1:0)
"RTN","PSGCAP0",9,0)
 S X=$$NFWS^PSJUTL1(PSGP,PSJJORD_"U",PSGAPWD) S NF=$P(X,U),WS=$P(X,U,2),SM=$S('$P(X,U,3):0,$P(X,U,4):1,1:2)
"RTN","PSGCAP0",10,0)
 N X,PSG
"RTN","PSGCAP0",11,0)
 D DRGDISP^PSJLMUT1(PSGP,PSJJORD_"U",20,0,.PSG,1)
"RTN","PSGCAP0",12,0)
 S DRG=PSG(1),DRG=$S(DRG["NOT FOUND":"z",1:DRG) ;SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2)
"RTN","PSGCAP0",13,0)
 S ST=$S($P(ND,U,27)="R"&($P(ND,U,9)="A"):"R",1:$P(ND,U,9)),ND=$P(ND,"^",7)
"RTN","PSGCAP0",14,0)
 N DDRG S (X,DCU)=0 F  S X=$O(^PS(55,PSGP,5,PSJJORD,1,X)) Q:'X  S DDRG=^(X,0),DCU=DCU+($P($G(^PSDRUG(+DDRG,660)),"^",6)*($S($P(DDRG,"^",2):$P(DDRG,"^",2),1:1)))
"RTN","PSGCAP0",15,0)
 ;
"RTN","PSGCAP0",16,0)
 ;
"RTN","PSGCAP0",17,0)
 S SD=$P(ND2,"^",2),FD=$P(ND2,"^",4) F X="SD","FD" S @X=$E($$ENDTC^PSGMI(@X),1,5)
"RTN","PSGCAP0",18,0)
 ;S Y=SI S:Y]"" Y=$$ENSET^PSGSICHK(Y) S:'$G(PSGAPWDN) PSGAPWDN=PSJPWDN S ^TMP($J,S1,PSGAPWDN,PN,ND_"^"_DRG,PSJJORD)=ST_"^"_SD_"^"_FD_"^"_WS_"^"_SM_"^"_NF_"^"_DCU_"^"_DRG S:Y]"" ^(PSJJORD,1)=Y Q
"RTN","PSGCAP0",19,0)
 S Y=SI S:Y]"" Y=$$ENSET^PSGSICHK(Y) S PSGAPWDN=$S($G(PSGAPWD)="zz":"zz",'$G(PSGAPWDN):PSJPWDN,1:"zz") S ^TMP($J,S1,PSGAPWDN,PN,ND_"^"_DRG,PSJJORD)=ST_"^"_SD_"^"_FD_"^"_WS_"^"_SM_"^"_NF_"^"_DCU_"^"_DRG S:Y]"" ^(PSJJORD,1)=Y Q
"RTN","PSGCAP0",20,0)
 ;
"RTN","PSGCAP0",21,0)
PAT ;
"RTN","PSGCAP0",22,0)
 D PSJAC2^PSJAC(1),NOW^%DTC S PSGDT=%,PN=$E($P(PSGP(0),"^"),1,20)_"^"_PSGP
"RTN","PSGCAP0",23,0)
 S S1="zz" I PSGAPS="T",PSJPWD,PSJPRB]"",$D(^PS(57.7,PSJPWD,1,+$O(^PS(57.7,"AWRT",PSJPWD,PSJPRB,0)),0)),$P(^(0),"^")]"" S S1=$P(^(0),"^")
"RTN","PSGCAP0",24,0)
 I PSGAPS="P",PSJPTSP,$D(^VA(200,PSJPTSP,0)),$P(^(0),"^")]"" S S1=$P(^(0),"^")
"RTN","PSGCAP0",25,0)
 S:PSGMTYPE[1 PSGMTYPE="2,3,4,5,6"
"RTN","PSGCAP0",26,0)
 I PSGMTYPE[2 D
"RTN","PSGCAP0",27,0)
 . F STRT=PSGAPSD-.0001:0 S STRT=$O(^PS(55,PSGP,5,"AUS",STRT)) Q:$S('STRT:1,PSGAPO="E":STRT>PSGAPFD,1:0)  I STRT'=PSGAPSD F PSJJORD=0:0 S PSJJORD=$O(^PS(55,PSGP,5,"AUS",STRT,PSJJORD)) Q:'PSJJORD  D GOD
"RTN","PSGCAP0",28,0)
 . S XTYPE=2,PST="S" D ^PSGCAPIV
"RTN","PSGCAP0",29,0)
 N XTYPE F XTYPE=3:1:6 I PSGMTYPE[XTYPE S PST=$S(XTYPE=3:"P",XTYPE=4:"A",XTYPE=5:"H",1:"C") D ^PSGCAPIV
"RTN","PSGCAP0",30,0)
 I PSGMTYPE[3 S XTYPE=3,PST="S" D ^PSGCAPIV ;* Find syringe type iv
"RTN","PSGCAP0",31,0)
 I $D(^TMP($J,S1,PSGAPWDN,PN)) S ^(PN)=$P(PSJPSEX,"^",2)_"^"_$E($P(PSJPDOB,"^",2),1,10)_";"_PSJPAGE_"^"_VA("PID")_"^"_PSJPDX_"^"_$S(PSJPRB]"":PSJPRB,1:"*NF*")_"^"_$E($P(PSJPAD,"^",2),1,10)_"^"_$E($P(PSJPTD,"^",2),1,10)
"RTN","PSGCAP0",32,0)
 I  S ^TMP($J,S1,PSGAPWDN,PN)=^(PN)_"^"_PSJPWT_"^"_PSJPWTD_"^"_PSJPHT_"^"_PSJPHTD_"^"_$P(PSGP(0),"^")
"RTN","PSGCAP0",33,0)
 Q
"RTN","PSGCAP0",34,0)
 ;
"RTN","PSGCAP0",35,0)
ENQ ; queued entry point
"RTN","PSGCAP0",36,0)
 N ALFLG,DCU,DRGI,DRGN,DRGT,KKA,HT,HTD,ON,PST,PSIVUP,PSJORIFN,QST,WTD,XTYPE
"RTN","PSGCAP0",37,0)
 K ^TMP($J) S STT=PSGAPSD-.0001,PSJACNWP=1 D @("P"_PSGSS),^PSGCAPP D ^%ZISC
"RTN","PSGCAP0",38,0)
 Q
"RTN","PSGCAP0",39,0)
 ;
"RTN","PSGCAP0",40,0)
PG ;
"RTN","PSGCAP0",41,0)
 I PSGAPWD="zz" D CLIN Q
"RTN","PSGCAP0",42,0)
 F PSGAPWD=0:0 S PSGAPWD=$O(^PS(57.5,"AC",PSGAPWG,PSGAPWD)) Q:'PSGAPWD  I $D(^DIC(42,PSGAPWD,0)),$P(^(0),"^")]"" S PSGAPWDN=$P(^(0),"^") D PW
"RTN","PSGCAP0",43,0)
 Q
"RTN","PSGCAP0",44,0)
 ;
"RTN","PSGCAP0",45,0)
PW ;
"RTN","PSGCAP0",46,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGAPWDN,PSGP)) Q:'PSGP  D PAT
"RTN","PSGCAP0",47,0)
 Q
"RTN","PSGCAP0",48,0)
 ;
"RTN","PSGCAP0",49,0)
PP ;
"RTN","PSGCAP0",50,0)
 F PSGP=0:0 S PSGP=$O(PSGPAT(PSGP)) Q:'PSGP  S PSGAPWDN=$P($G(^DPT(PSGP,.1)),"^") S:PSGAPWDN]"" PSGAPWD=+$O(^DIC(42,"B",PSGAPWDN,0)) S:PSGAPWDN="" PSGAPWDN="zz" D PAT
"RTN","PSGCAP0",51,0)
 Q
"RTN","PSGCAP0",52,0)
 ;
"RTN","PSGCAP0",53,0)
PL S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D PC
"RTN","PSGCAP0",54,0)
 Q
"RTN","PSGCAP0",55,0)
PC S PSGAPWDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGCAP0",56,0)
 S PSGP="" F  S PSGP=$O(^PS(53.1,"AD",CL,PSGP)) Q:PSGP=""  D PAT
"RTN","PSGCAP0",57,0)
 N INDEX,APSTOP
"RTN","PSGCAP0",58,0)
 F INDEX="AIVC","AUDC" S APSTOP=0 F  S APSTOP=$O(^PS(55,INDEX,APSTOP)) Q:'APSTOP  D
"RTN","PSGCAP0",59,0)
 . S DFN=0 F  S DFN=$O(^PS(55,INDEX,APSTOP,CL,DFN)) Q:'DFN  I '$D(^TMP("PSGAP0",$J,"OUTPT",DFN)) S PSGP=DFN,Q=APSTOP,PSGAPWD="zz" D PAT
"RTN","PSGCAP0",60,0)
 Q
"RTN","PSGCAP0",61,0)
CLIN ;
"RTN","PSGCAP0",62,0)
 N INDEX,APSTOP,CLIN
"RTN","PSGCAP0",63,0)
 F INDEX="AIVC","AUDC" S APSTOP=0 F  S APSTOP=$O(^PS(55,INDEX,APSTOP)) Q:'APSTOP  S CLIN=0 F  S CLIN=$O(^PS(55,INDEX,APSTOP,CLIN)) Q:'CLIN  D
"RTN","PSGCAP0",64,0)
 . S DFN=0 F  S DFN=$O(^PS(55,INDEX,APSTOP,CLIN,DFN)) Q:'DFN  I '$D(^TMP("PSGAP0",$J,"OUTPT",DFN)) S PSGP=DFN,Q=APSTOP,PSGAPWD="zz" D PAT
"RTN","PSGCAP0",65,0)
 Q
"RTN","PSGCAP0",66,0)
 ;
"RTN","PSGCAP0",67,0)
ENOR ;
"RTN","PSGCAP0",68,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGCAP0",69,0)
 S (DFN,PSGP)=+ORVP D ^PSJAC S PSGPAT=PSGP,PSGPAT(DFN)="",(PSGAP,PSGAPWD,PSGAPWG)=0,(PSGAPWDN,PSGAPWGN)="",PSGSS="P" D ORS^PSGCAP S PSJNKF=1 D DONE^PSGCAP Q
"RTN","PSGCAPP")
0^39^B13538831
"RTN","PSGCAPP",1,0)
PSGCAPP ;BIR/CML3-PRINT DATA FOR ACTION PROFILE ;05 Oct 98 / 10:21 AM
"RTN","PSGCAPP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,20,60,111**;16 DEC 97
"RTN","PSGCAPP",3,0)
LOOP ;
"RTN","PSGCAPP",4,0)
 D NOW^%DTC S PSGDT=%,PSGPDT=$$ENDTC2^PSGMI(PSGDT),CML=IO'=IO(0)!($E(IOST,1,2)'="C-")
"RTN","PSGCAPP",5,0)
 U IO I '$D(^TMP($J)) D  G DONE
"RTN","PSGCAPP",6,0)
 .W:$Y @IOF W !?26,"UNIT DOSE ACTION PROFILE #2",?62,PSGPDT,!?10,"NO ",$S(PSGAPO="E":"EXPIRING",1:"ACTIVE")," ORDERS FOUND FOR ",$S(PSGSS="G":"WARD GROUP: "_PSGAPWGN,PSGSS="W":"WARD: "_PSGAPWDN,1:"PATIENT(S) SELECTED"),"."
"RTN","PSGCAPP",7,0)
 S (LN,LINE,ALN,S1,WD,PN)="",$P(LN,"_",19)="",$P(LINE,"-",81)="",$P(ALN," -",18)="",ALN=ALN_" A C T I V E"_ALN
"RTN","PSGCAPP",8,0)
 S PSGVAMC=$$SITE^PSGMMAR2(80)
"RTN","PSGCAPP",9,0)
 F  S (PS1,S1,PSJTEAM)=$O(^TMP($J,S1)) Q:S1=""!$D(PSJDLW)  S:S1="zz" (PS1,PSJTEAM)="NOT FOUND" F  S WD=$O(^TMP($J,S1,WD)) Q:WD=""!$D(PSJDLW)  D
"RTN","PSGCAPP",10,0)
 . F  S PN=$O(^TMP($J,S1,WD,PN)) Q:PN=""!$D(PSJDLW)  S PI=$G(^(PN)) S:PI="" PI=$G(^TMP($J,S1,"zz",PN)) D H1
"RTN","PSGCAPP",11,0)
 ;
"RTN","PSGCAPP",12,0)
DONE ;
"RTN","PSGCAPP",13,0)
 W:CML&($Y) @IOF K AD,ALN,CML,DF,LINE,LN,MF,N,PG,PI,PPN,PS1,PSGPDT,RCT,RF,PID,TD,WD,PSJDLW,PSGVAMC Q
"RTN","PSGCAPP",14,0)
 ;
"RTN","PSGCAPP",15,0)
H1 ; first header for patient
"RTN","PSGCAPP",16,0)
 I $G(WD)="zz" N WD S WD="*NF*"
"RTN","PSGCAPP",17,0)
 D ^PSGCAPP0
"RTN","PSGCAPP",18,0)
END ;
"RTN","PSGCAPP",19,0)
 S (ON,DRG)="" F  S DRG=$O(^TMP($J,S1,WD,PN,DRG)) Q:DRG=""  F  S ON=$O(^TMP($J,S1,WD,PN,DRG,ON)) Q:ON=""  S ND=^(ON),SI=$G(^(ON,1)) D NP:$Y+12>IOSL Q:$D(PSJDLW)  D ORDP
"RTN","PSGCAPP",20,0)
 Q:$D(PSJDLW)
"RTN","PSGCAPP",21,0)
 I $D(^PS(53.1,"AC",PSGP)) W !!?13,"******** THIS PATIENT HAS NON-VERIFIED ORDERS. ********"
"RTN","PSGCAPP",22,0)
 S DF=1 W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE"
"RTN","PSGCAPP",23,0)
 D:$Y+10>IOSL NP1 W:'$D(PSJDLW) !!!?10,"MULTIDISCIPLINARY REVIEW",!?16,"(WHEN APPROPRIATE)",?40,LN_LN,!?40,"PHARMACIST'S SIGNATURE"
"RTN","PSGCAPP",24,0)
 D:$Y+6>IOSL NP1 W:'$D(PSJDLW) !!?40,LN_LN,!?40,"NURSE'S SIGNATURE"
"RTN","PSGCAPP",25,0)
 I IOSL-$Y>10 W !!?3,"ADDITIONAL MEDICATION ORDERS:" F  W !!,LINE Q:$Y+9>IOSL
"RTN","PSGCAPP",26,0)
 I  W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE",!
"RTN","PSGCAPP",27,0)
 E  F Q=$Y+5:1:IOSL-1 W !
"RTN","PSGCAPP",28,0)
 W:'$D(PSJDLW) !?2,PPN,?40,PID,?78-$L(PDOB),PDOB Q
"RTN","PSGCAPP",29,0)
 ;
"RTN","PSGCAPP",30,0)
ORDP ;
"RTN","PSGCAPP",31,0)
 S N=N+1 I ON["V" D PRT^PSGCAPIV(ON) Q
"RTN","PSGCAPP",32,0)
 N X,PSG S PSGP=$P(PN,U,2)
"RTN","PSGCAPP",33,0)
 D DRGDISP^PSJLMUT1(+PSGP,+ON_"U",39,69,.PSG,0)
"RTN","PSGCAPP",34,0)
 S SM=$P(ND,"^",5),NF=$P(ND,"^",6),DCU=$P(ND,"^",7),DCU=$S($E(DCU)=".":"0"_DCU,'DCU:"0.00",1:DCU) W !,$J(N,3)
"RTN","PSGCAPP",35,0)
 W ?5,PSG(1),?46,$P(DRG,"^"),?49,$P(ND,"^",2),?55,$P(ND,"^",3),?61,$P(ND,"^") I NF!SM!$P(ND,"^",4) W ?65 W:NF "NF " W:$P(ND,"^",4) "WS " W:SM $E("HSM",SM,3)
"RTN","PSGCAPP",36,0)
 N X F X=1:0 S X=$O(PSG(X)) Q:'X  W !?5,PSG(X)
"RTN","PSGCAPP",37,0)
 I SI]"" W !?8,"Special Instructions: " F X=1:1:$L(SI," ") S Y=$P(SI," ",X) W:$X+$L(Y)>78 !?31 W Y," "
"RTN","PSGCAPP",38,0)
ORDP1 ;*** Also being called from ^PSGCAPIV.
"RTN","PSGCAPP",39,0)
 W !!?5,"__TAKE NO ACTION     __DISCONTINUE     __RENEW   COST/DOSE: ",DCU,!?2,"------------------------------------------------------------------------",! Q
"RTN","PSGCAPP",40,0)
 ;
"RTN","PSGCAPP",41,0)
NP ;
"RTN","PSGCAPP",42,0)
 W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE"
"RTN","PSGCAPP",43,0)
 ;
"RTN","PSGCAPP",44,0)
NP1 ;
"RTN","PSGCAPP",45,0)
 Q:$D(PSJDLW)
"RTN","PSGCAPP",46,0)
 I $E(IOST,1)="C" K DIR S DIR(0)="E" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S PSJDLW=1 Q
"RTN","PSGCAPP",47,0)
 F Q=$Y:1:IOSL-4 W !
"RTN","PSGCAPP",48,0)
 ;* S PG=PG+1 W !?2,PPN,?40,PID,?78-$L(PDOB),PDOB W:$Y @IOF W !?28,"UNIT DOSE ACTION PROFILE #2",?73-$L(PG),"Page: "_PG,!?1,PPN,?40,PID,?60,PDOB I DF W !!,LINE Q
"RTN","PSGCAPP",49,0)
 S PG=PG+1 W !?2,PPN,?40,PID,?78-$L(PDOB),PDOB W:$Y @IOF
"RTN","PSGCAPP",50,0)
 W !?26,"UNIT DOSE ACTION PROFILE #2",?73-$L(PG),"Page: "_PG
"RTN","PSGCAPP",51,0)
 W !?+PSGVAMC,$P(PSGVAMC,U,2)
"RTN","PSGCAPP",52,0)
 W !?1,PPN,?40,PID,?60,PDOB
"RTN","PSGCAPP",53,0)
 I DF W !!,LINE Q
"RTN","PSGCAPP",54,0)
 W !!," No. Action",?16,"Drug",?46,"ST Start Stop  Status/Info",!,ALN
"RTN","PSGCAPP",55,0)
 Q
"RTN","PSGDL")
0^91^B13209027
"RTN","PSGDL",1,0)
PSGDL ;BIR/CML3-CALCULATE STOP DATE/TIME WITH DOSE LIMIT ;27 Aug 98 / 8:47 AM
"RTN","PSGDL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**16,50,64,58,111**;16 DEC 97
"RTN","PSGDL",3,0)
 ;
"RTN","PSGDL",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGDL",5,0)
 ;
"RTN","PSGDL",6,0)
EN ;
"RTN","PSGDL",7,0)
 K PSGDLS S ND2=^PS(53.1,DA,2) I $P(ND2,"^",5)!$P(ND2,"^",6) W " ...Dose Limit... " G ENGO
"RTN","PSGDL",8,0)
 G DONE
"RTN","PSGDL",9,0)
 ;
"RTN","PSGDL",10,0)
ENE ;
"RTN","PSGDL",11,0)
 S ND2=PSGSCH_"^"_PSGSD_"^^^"_PSGAT_"^"_PSGS0XT G ENGO
"RTN","PSGDL",12,0)
 ;
"RTN","PSGDL",13,0)
EN1 ;
"RTN","PSGDL",14,0)
 S ND2=$P(PSGNEDFD,"^",4)_"^"_PSGNESD_"^^^"_PSGS0Y_"^"_PSGS0XT G ENGO
"RTN","PSGDL",15,0)
 ;
"RTN","PSGDL",16,0)
EN2 ;
"RTN","PSGDL",17,0)
 K PSGDLS S ND2=^PS(55,DA(1),5,DA,2) I '$P(ND2,"^",5),'$P(ND2,"^",6) G DONE
"RTN","PSGDL",18,0)
 W " ...Dose Limit... "
"RTN","PSGDL",19,0)
 ;
"RTN","PSGDL",20,0)
ENGO ;
"RTN","PSGDL",21,0)
 S SCH=$P(ND2,"^")
"RTN","PSGDL",22,0)
 S ST=$S($D(PSGDLS):PSGDLS,1:$P(ND2,"^",2))
"RTN","PSGDL",23,0)
 S TS=$P(ND2,"^",5),MN=$P(ND2,"^",6)
"RTN","PSGDL",24,0)
 I $P(PSJSYSW0,U,5)=2 D
"RTN","PSGDL",25,0)
 . Q:'TS  S:TS'[$P(ST,".",2) $P(PSJSYSW0,U,5)=1 D
"RTN","PSGDL",26,0)
 .. I '$G(PSGSD) N PSGSD S PSGSD=$$DATE^PSJUTL2
"RTN","PSGDL",27,0)
 .. I '$G(PSGFD) N PSGFD S PSGFD=$$FMADD^XLFDT(PSGSD,30)
"RTN","PSGDL",28,0)
 .. N STRING,ND2,SCH,TS,MN S STRING=$G(PSGSD)_"^"_$G(PSGFD)_"^"_$G(PSGSCH)_"^"_$G(PSGST)_"^"_$G(PSGPDRG)_"^"_$G(PSGAT)
"RTN","PSGDL",29,0)
 .. I $G(PSGP) S ST=$$ENQ^PSJORP2(PSGP,STRING) S:'ST ST=$S($D(PSGDLS):PSGDLS,1:$P(ND2,"^",2))
"RTN","PSGDL",30,0)
 . S $P(PSJSYSW0,U,5)=2
"RTN","PSGDL",31,0)
 G MWF:SCH["@",DONE:'TS&'MN
"RTN","PSGDL",32,0)
 I 'TS S AM=MN*PSGDL,X=$$EN^PSGCT(ST,AM) G DONE
"RTN","PSGDL",33,0)
 S TM=$E(ST_"00000",9,8+$L($P(TS,"-")))
"RTN","PSGDL",34,0)
 F Q=1:1 Q:$P(TS,"-",Q)=""!(TM<$P(TS,"-",Q))
"RTN","PSGDL",35,0)
 S X=ST\1,C=0 F Q=Q:1 D:$P(TS,"-",Q)="" ADD S C=C+1 I C=PSGDL S X=X_"."_$P(TS,"-",Q) G DONE
"RTN","PSGDL",36,0)
 ;
"RTN","PSGDL",37,0)
MWF ; if schedule is similar to monday-wednesday-friday
"RTN","PSGDL",38,0)
 S TS=$P(SCH,"@",2),SCH=$P(SCH,"@"),X=$P(ST,"."),C=0 D SCHK G:C=PSGDL DONE F Q=1:1 S X1=$P(ST,"."),X2=Q D C^%DTC S X1=X D DW^%DTC D CHK G:C=PSGDL DONE
"RTN","PSGDL",39,0)
SCHK S X1=X D DW^%DTC F Q=1:1:$L(SCH,"-") S WKD=$P(SCH,"-",Q) I WKD=$E(X,1,$L(WKD)) Q
"RTN","PSGDL",40,0)
 E  Q
"RTN","PSGDL",41,0)
 S TM=$E(ST_"00000",9,8+$L($P(TS,"-"))) F Q=1:1:$L(TS,"-") I TM<$P(TS,"-",Q) S C=C+1 I C=PSGDL S X=X1_"."_$P(TS,"-",Q) Q
"RTN","PSGDL",42,0)
 Q
"RTN","PSGDL",43,0)
CHK F QQ=1:1:$L(SCH,"-") S WKD=$P(SCH,"-",QQ) I WKD=$E(X,1,$L(WKD)) D TS Q
"RTN","PSGDL",44,0)
 Q
"RTN","PSGDL",45,0)
TS F Q1=1:1:$L(TS,"-") S C=C+1 I C=PSGDL S X=X1_"."_$P(TS,"-",Q1) Q
"RTN","PSGDL",46,0)
 Q
"RTN","PSGDL",47,0)
 ;
"RTN","PSGDL",48,0)
DONE ;
"RTN","PSGDL",49,0)
 K %H,%T,%Y,MN,ND2,ND4,PSGDLS,PSGDL,Q1,QQ,SCH,TM,WKD,TS,X1,X2 Q
"RTN","PSGDL",50,0)
 ;
"RTN","PSGDL",51,0)
ADD ;
"RTN","PSGDL",52,0)
 S X1=$P(X,"."),X2=$S(MN&'(MN#1440):MN\1440,1:1) D C^%DTC S Q=1 Q
"RTN","PSGDL",53,0)
 ;
"RTN","PSGDL",54,0)
ENPREV ; when "P" is enter at start date
"RTN","PSGDL",55,0)
 W "REVIOUS" S (X,Y)=0 I '$D(PSGP)!'$D(PSGPDRG) G:$D(DA)[0 POUT S PSGP=$P($G(^PS(53.1,DA,0)),"^",15),PSGPDRG=+$G(^(.2)),Y=1 I 'PSGP!'PSGPDRG W:'PSGPDRG !?17,"Must have drug from formulary list." G POUT
"RTN","PSGDL",56,0)
 F Q=0:0 S Q=$O(^PS(53.1,"AC",PSGP,Q)) Q:'Q  I +$G(^PS(53.1,Q,.2))=PSGPDRG,$D(^PS(53.1,Q,2)),$P(^(2),"^",4)>X S X=$P(^(2),"^",4)
"RTN","PSGDL",57,0)
 F Q=0:0 S Q=$O(^PS(55,PSGP,5,"C",PSGPDRG,Q)) Q:'Q  I $D(^PS(55,PSGP,5,Q,2)),$P(^(2),"^",4)>X S X=$P(^(2),"^",4)
"RTN","PSGDL",58,0)
 W:'X !?17,"No other order found with this drug."
"RTN","PSGDL",59,0)
 ;
"RTN","PSGDL",60,0)
POUT ;
"RTN","PSGDL",61,0)
 K:'X X K:Y PSGPDRG,PSGP,Q Q
"RTN","PSGDL",62,0)
ENDL(SCH,DL) ;validate that dose limit should be allowed with this schedule
"RTN","PSGDL",63,0)
 ;and that the dose limit is a whole number
"RTN","PSGDL",64,0)
 I $G(SCH)="" Q 1
"RTN","PSGDL",65,0)
 I ",ON CALL,ON-CALL,ONCALL,"[(","_SCH_",")!($$ONE^PSJBCMA(DFN,"",SCH)="O") W " Dose limit invalid with this schedule" Q 0
"RTN","PSGDL",66,0)
 I DL'?1N.N W " Dose limit must be a whole number" Q 0
"RTN","PSGDL",67,0)
 Q 1
"RTN","PSGEUD")
0^15^B27851751
"RTN","PSGEUD",1,0)
PSGEUD ;BIR/CML3-EXTRA UNITS DISPENSED ;17 SEP 97 /  1:41 PM
"RTN","PSGEUD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**31,41,50,111**;16 DEC 97
"RTN","PSGEUD",3,0)
 ;
"RTN","PSGEUD",4,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGEUD",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSGEUD",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGEUD",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGEUD",8,0)
 ;
"RTN","PSGEUD",9,0)
 N PSJNEW,PSGPTMP,PPAGE,PSGEFN S PSJNEW=1
"RTN","PSGEUD",10,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  S (PSGONNV,PSGRETF)=1 K PSGPRP
"RTN","PSGEUD",11,0)
 ;
"RTN","PSGEUD",12,0)
GP ;
"RTN","PSGEUD",13,0)
 ;D ENDPT^PSGP G:PSGP'>0 DONE I '$O(^PS(55,PSGP,5,"AUS",+PSJPAD)) W $C(7),!,"(Patient has NO active or old orders.)" G GP
"RTN","PSGEUD",14,0)
 S PSGP="",DFN=""
"RTN","PSGEUD",15,0)
 D ENDPT^PSGP G:(PSGP'>0)&(DFN'>0) DONE S:PSGP<1 PSGP=DFN I '$O(^PS(55,PSGP,5,"AUS",+PSJPAD)) W $C(7),!,"(Patient has NO active or old orders.)" G GP
"RTN","PSGEUD",16,0)
 D ENL^PSGOU G:"^N"[PSGOL GP S PSGPTMP=0,PPAGE=1 D ^PSGO G:'PSGON GP S PSGLMT=PSGON,(PSGONC,PSGONR)=0
"RTN","PSGEUD",17,0)
 F  W !!,"Select ORDER",$E("S",PSGON>1)," 1-",PSGON,": " R X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" H I X'?1."?" D ENCHK^PSGON W:'$D(X) $C(7),"  ??" Q:$D(X)
"RTN","PSGEUD",18,0)
 G:"^"[X GP F PSGRET=1:1:PSGODDD F PSGRET1=1:1 S PSGRET2=$P(PSGODDD(PSGRET),",",PSGRET1) Q:'PSGRET2  S PSGORD=^TMP("PSJON",$J,PSGRET2) D R G:$D(DTOUT) GP
"RTN","PSGEUD",19,0)
 G GP
"RTN","PSGEUD",20,0)
 ;
"RTN","PSGEUD",21,0)
DONE ;
"RTN","PSGEUD",22,0)
 D ENKV^PSGSETU K ^TMP("PSJON",$J),DO,DRGN,MR,OD,PSGLMT,PSGODDD,PSGEUD,PSGEUDA,PSGOL,PSGON,PSGONC,PSGONR,PSGONV,PSGONNV,PSGORD,PSGQ,PSGRET,PSGRET1,PSGRET2,PSGRETF,PSGSPD,SCH,WG,Z,CST Q
"RTN","PSGEUD",23,0)
 ;
"RTN","PSGEUD",24,0)
R ;
"RTN","PSGEUD",25,0)
 S MR=$P($G(^PS(55,PSGP,5,+PSGORD,0)),"^",3),Y=$G(^(.2)),SCH=$P($G(^(2)),"^"),DO=$P(Y,"^",2),DRG=$P(Y,"^"),DRG=$S(DRG'=+DRG:"NOT FOUND",'$D(^PS(50.7,DRG,0)):DRG,$P(^(0),"^")]"":$P(^(0),"^"),1:DRG_";PS(50.7,")
"RTN","PSGEUD",26,0)
 S:MR]"" MR=$S(MR'=MR:MR,'$D(^PS(51.2,MR,0)):MR,$P(^(0),"^",3)]"":$P(^(0),"^",3),$P(^(0),"^")]"":$P(^(0),"^"),1:MR_";PS(51.2,") W !!,"----------------------------------------",!,DRG,!,"Give: " D
"RTN","PSGEUD",27,0)
 .N LN,MARX D TXT^PSGMUTL(DO_" "_MR_" "_SCH,65)
"RTN","PSGEUD",28,0)
 .S LN="" F  S LN=$O(MARX(LN)) Q:LN=""  W:LN>1 ! W ?6,MARX(LN)
"RTN","PSGEUD",29,0)
 I '$O(^PS(55,PSGP,5,+PSGORD,1,0)) D  Q
"RTN","PSGEUD",30,0)
 .W !!,"No Dispense drugs have been entered for this order. At least one Dispense drugs",!,"must be associated with an order before dispensing information may be entered.",!!
"RTN","PSGEUD",31,0)
 .N DIR S DIR(0)="E" D ^DIR S Y=$S(Y:0,1:1)
"RTN","PSGEUD",32,0)
 S PSGEUD=0,WG=$O(^PS(57.5,"AB",+PSJPWD,0)) F DRG=0:0 S DRG=$O(^PS(55,PSGP,5,+PSGORD,1,DRG)) Q:'DRG  S X=$G(^(DRG,0)) I X D  Q:$D(DTOUT)
"RTN","PSGEUD",33,0)
 .S UD=$P(X,"^",2),DRGN=$$ENDDN^PSGMI(+X) Q:DRGN=""  S:'$D(^PSDRUG(+X,212,"AC",+WG)) WG=""
"RTN","PSGEUD",34,0)
 .I ($P(X,"^",3)?7N)&($P(PSGDT,".")'<$P(X,"^",3)) W !!,"Dispense drug: ",DRGN," **ORDER INACTIVE**" Q
"RTN","PSGEUD",35,0)
 .I ($G(^PSDRUG(+X,"I"))?7N)&($P(PSGDT,".")'<$G(^PSDRUG(+X,"I"))) W !!,"Dispense drug: ",DRGN," **DRUG INACTIVE**" Q
"RTN","PSGEUD",36,0)
 .W !!,"Dispense drug: ",DRGN,"  (U/D: ",$S('UD:1,1:UD),")"
"RTN","PSGEUD",37,0)
 .K DA,DR S DA=+DRG,DA(2)=PSGP,DA(1)=+PSGORD,DIE="^PS(55,"_PSGP_",5,"_+PSGORD_",1,",DR=.11 S:$P($G(^PS(55,PSGP,5,+PSGORD,1,DA,0)),"^",11) $P(^(0),"^",11)=""
"RTN","PSGEUD",38,0)
 .D ^DIE S PSGEUD=PSGEUD+$P($G(^PS(55,PSGP,5,+PSGORD,1,DA,0)),U,11)
"RTN","PSGEUD",39,0)
 I PSGEUD,WG D QS
"RTN","PSGEUD",40,0)
 Q
"RTN","PSGEUD",41,0)
 ;
"RTN","PSGEUD",42,0)
QS ;
"RTN","PSGEUD",43,0)
 W !!,"THIS DRUG IS AN ATC ITEM." S Y=$G(^PS(57.5,WG,3)) I $P(Y,"^",3)="" W $C(7),"  BUT THE ATC DEVICE CANNOT BE FOUND!" S Y=0 Q
"RTN","PSGEUD",44,0)
 S IOP="`"_$P(Y,"^",3),PSGSPD=$P(Y,"^",2) F  W !,"Do you want to dispense ",$S(PSGEUD>1:"these",1:"this")," extra unit",$E("s",PSGEUD>1)," through the ATC" S %=2 D YN^DICN Q:%  D QSH
"RTN","PSGEUD",45,0)
 S Y=0 Q:%'=1  K %ZIS,IO("Q") S %ZIS="NQ",PSGION=ION,IOP=IOP_";255" D ^%ZIS I POP S IOP=PSGION D ^%ZIS W $C(7),!!?10,"** THE ATC MACHINE CANNOT BE FOUND! **" S Y=0 Q
"RTN","PSGEUD",46,0)
 K ZTSAVE S PSGTIR="ENQ^PSGEUD",PSGTID=$H,ZTDESC="EXTRA UNITS TO ATC" F X="PSGP","PSGORD","PSGP(0)","PSGSPD" S ZTSAVE(X)=""
"RTN","PSGEUD",47,0)
 D ENTSK^PSGTI W "...DONE" S Y=0 Q
"RTN","PSGEUD",48,0)
 ;
"RTN","PSGEUD",49,0)
ENQ ;
"RTN","PSGEUD",50,0)
 D NOW^%DTC S DFN=PSGP D PID^VADPT
"RTN","PSGEUD",51,0)
 S %=%_"0000000000000",BLKS="                    ",PN=$E($P(PSGP(0),"^")_BLKS,1,20),PID=$E(VA("PID")_BLKS,1,12),PL=$E($S($D(^DPT(PSGP,.1)):^(.1),1:"*N/F*")_BLKS,1,12)
"RTN","PSGEUD",52,0)
 X ^%ZOSF("LABOFF") F PSGDRG=0:0 S PSGDRG=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDRG)) Q:'PSGDRG  S X=$G(^(PSGDRG,0)) I X D
"RTN","PSGEUD",53,0)
 .S C=$P(X,U,11),PSGEUDA=$P($G(^PSDRUG(+X,8.5)),U,2) Q:(PSGEUDA="")!('C)
"RTN","PSGEUD",54,0)
 .S PSGEUDA=$E(PSGEUDA_BLKS,1,15) S:$L(C)<3 C=$E("000",1,3-$L(C))_C S C=C_$E(%,4,5)_$E(%,6,7)_$E(%,2,3)_$E(%,9,10)_$E(%,11,12) D @$S(PSGSPD:"S2",1:"S1")
"RTN","PSGEUD",55,0)
 Q
"RTN","PSGEUD",56,0)
 ;
"RTN","PSGEUD",57,0)
S1 ;
"RTN","PSGEUD",58,0)
 W $C(48) F Q=1:1:75 R X:$S(Q<15:1,1:5) G:X=49 S1 I X=48 Q
"RTN","PSGEUD",59,0)
 E  Q
"RTN","PSGEUD",60,0)
 W $C(50),$C(52),PN_PID_PL_"IMD"_PSGEUDA_"1 ",$C(53),$C(54),C,$C(55),$C(13) F Q=1:1:75 R X:$S(Q<15:1,1:5) G:X=49 S1 I X=48 Q
"RTN","PSGEUD",61,0)
 Q
"RTN","PSGEUD",62,0)
 ;
"RTN","PSGEUD",63,0)
S2 ;
"RTN","PSGEUD",64,0)
 W $C(48) F Q=1:1:75 R X:$S(Q<15:1,1:5) G:$A(X)=49 S2 I $A(X)=48 Q
"RTN","PSGEUD",65,0)
 E  Q
"RTN","PSGEUD",66,0)
 W $C(50),$C(52),PN_PID_PL_"IMD"_PSGEUDA_"1 ",$C(53),$C(54),C,$C(55),$C(13) F Q=1:1:75 R X:$S(Q<15:1,1:5) G:$A(X)=49 S2 I $A(X)=48 Q
"RTN","PSGEUD",67,0)
 Q
"RTN","PSGEUD",68,0)
 ;
"RTN","PSGEUD",69,0)
QSH ;
"RTN","PSGEUD",70,0)
 W !!?2,"This drug can be dispensed through the ATC machine.  Enter 'Y' to do so now.  Enter 'N' if you do not want to do so.",! Q
"RTN","PSGEUD",71,0)
 ;
"RTN","PSGEUD",72,0)
H ;
"RTN","PSGEUD",73,0)
 W !!?2,"Select the orders (by number) for which you want to enter extra units",!,"dispensed." D:X'="?" H2^PSGON
"RTN","PSGEUD",74,0)
 Q
"RTN","PSGEUDD")
0^16^B16167200
"RTN","PSGEUDD",1,0)
PSGEUDD ;BIR/MV-EXTRA UNITS DISPENSED REPORT ;14 JAN 97 / 9:22 AM
"RTN","PSGEUDD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**27,31,59,111**;16 DEC 97
"RTN","PSGEUDD",3,0)
 ;
"RTN","PSGEUDD",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSGEUDD",5,0)
 ; Reference to ^DIC(42 is supported by DBIA# 10039
"RTN","PSGEUDD",6,0)
 ;
"RTN","PSGEUDD",7,0)
NEW ;***New needed variables.
"RTN","PSGEUDD",8,0)
 K ^TMP($J)
"RTN","PSGEUDD",9,0)
 NEW AMT,DRG,ND,NO,PPN,TM,WHO,XDESC,XSAVE,XTRTN,PSJACNWP
"RTN","PSGEUDD",10,0)
 ;
"RTN","PSGEUDD",11,0)
ASK ;***Ask for date range and output device
"RTN","PSGEUDD",12,0)
 Q:$$STDATE^PSJMDIR  S PSGSDT=Y
"RTN","PSGEUDD",13,0)
 K DIR S DIR(0)="DAO^"_PSGSDT_"::,EXAR",DIR("A")="Enter Ending Date and Time: ",DIR("?")="Please enter a date and time that is greater than the Start Date" D ^DIR S PSGEDT=Y Q:$$STOP^PSJMDIR
"RTN","PSGEUDD",14,0)
 Q:$$GWP^PSJMDIR1(0)
"RTN","PSGEUDD",15,0)
 Q:$$SELDEV^PSJMUTL
"RTN","PSGEUDD",16,0)
 W:'$D(IO("Q")) !,"this may take a while...(you should QUEUE the Extra Units Dispensed report)"
"RTN","PSGEUDD",17,0)
 ;***Queue to sort in the background.
"RTN","PSGEUDD",18,0)
 I $D(IO("Q")) D  G EXIT
"RTN","PSGEUDD",19,0)
 . S XDESC="Extra Unit Dose Dispensed (Sort)"
"RTN","PSGEUDD",20,0)
 . ;Added PSGWGNM to XSAVE to enable printing of ward group total for queued prints
"RTN","PSGEUDD",21,0)
 . S XSAVE="PSGWGNM;PSGSDT;PSGEDT;PSGSS;PSGIO;PSGWG;PSGWD;PSGWN;PSGTMALL;PSGTM;PSGPAT(;PSGP(;PSGIODOC"
"RTN","PSGEUDD",22,0)
 . S XTRTN="START^PSGEUDD"
"RTN","PSGEUDD",23,0)
 . D SETSORTQ^PSJMUTL(XDESC,XSAVE,XTRTN)
"RTN","PSGEUDD",24,0)
 D START
"RTN","PSGEUDD",25,0)
 ;
"RTN","PSGEUDD",26,0)
EXIT ;***Exit report here.
"RTN","PSGEUDD",27,0)
 D ENKV^PSGSETU
"RTN","PSGEUDD",28,0)
 D EXIT^PSJMUTL
"RTN","PSGEUDD",29,0)
 K ^TMP($J),PSGDT,PSGEDT,PSGIO,PSGORD,PSGP,PSGPAT,PSGSDT,PSGSS,PSGTM,PSGTMALL,PSGWD,PSGWG,PSGWGNM,PSGWN,PSJSTOP
"RTN","PSGEUDD",30,0)
 Q
"RTN","PSGEUDD",31,0)
START ;***Start queuing here.
"RTN","PSGEUDD",32,0)
 D @PSGSS
"RTN","PSGEUDD",33,0)
 ;***Queue to the printer.
"RTN","PSGEUDD",34,0)
 I $D(PSGIO) D  G EXIT
"RTN","PSGEUDD",35,0)
 . S XDESC="Extra Unit Dose Dispensed (Print)"
"RTN","PSGEUDD",36,0)
 . S XSAVE="^TMP($J,;PSGWGNM;PSGTMALL;PSGTM;PSGSDT;PSGEDT;PSGSS;PSGIODOC"
"RTN","PSGEUDD",37,0)
 . S XTRTN="^PSGEUDP"
"RTN","PSGEUDD",38,0)
 . D SETPRTQ^PSJMUTL(XDESC,XSAVE,XTRTN)
"RTN","PSGEUDD",39,0)
 D ^PSGEUDP
"RTN","PSGEUDD",40,0)
 Q
"RTN","PSGEUDD",41,0)
 ;
"RTN","PSGEUDD",42,0)
P ;***Select by Patient
"RTN","PSGEUDD",43,0)
 S PPN="" F  S PPN=$O(PSGPAT(PPN)) Q:PPN=""  S PSGP=PSGPAT(PPN),PSJACNWP="" K PSJPPID,PSJPRB D ^PSJAC,LOOP
"RTN","PSGEUDD",44,0)
 Q
"RTN","PSGEUDD",45,0)
 ;
"RTN","PSGEUDD",46,0)
C ;***Select by CLINIC
"RTN","PSGEUDD",47,0)
 N DT,CLIN
"RTN","PSGEUDD",48,0)
 S TM="ZZ",PSJACNWP=""
"RTN","PSGEUDD",49,0)
 S DT=PSGSDT F  S DT=$O(^PS(55,"AUDC",DT)) Q:DT>PSGEDT!(DT="")  S CLIN=0 F  S CLIN=$O(^PS(55,"AUDC",DT,CLIN)) Q:'CLIN  D
"RTN","PSGEUDD",50,0)
 .S PSGP=0 F  S PSGP=$O(^PS(55,"AUDC",DT,CLIN,PSGP)) Q:'PSGP   D ^PSJAC S PPN=PSGP(0) D LOOP
"RTN","PSGEUDD",51,0)
 Q
"RTN","PSGEUDD",52,0)
G ;***Select by WARD GROUP
"RTN","PSGEUDD",53,0)
 D WARDGP
"RTN","PSGEUDD",54,0)
 Q
"RTN","PSGEUDD",55,0)
W ;***Select by Ward
"RTN","PSGEUDD",56,0)
 D WARD
"RTN","PSGEUDD",57,0)
 Q
"RTN","PSGEUDD",58,0)
WARDGP ;*** Find wards within a ward group
"RTN","PSGEUDD",59,0)
 S PSGWD="",TM="ZZ" F  S PSGWD=$O(^PS(57.5,"AC",PSGWG,PSGWD)) Q:'PSGWD  I $D(^DIC(42,+PSGWD,0)) S PSGWN=$P(^(0),U) D WARD
"RTN","PSGEUDD",60,0)
 Q
"RTN","PSGEUDD",61,0)
 ;
"RTN","PSGEUDD",62,0)
WARD ;*** Go through each patient within a given WARD
"RTN","PSGEUDD",63,0)
 ;*** Var used in PSJAC. Set to null to skip WP^PSJAC
"RTN","PSGEUDD",64,0)
 S PSJACNWP=""
"RTN","PSGEUDD",65,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGWN,PSGP)) Q:'PSGP  D ^PSJAC S PPN=PSGP(0) D:PSGSS="W" TEAM D:PSGSS="G" LOOP
"RTN","PSGEUDD",66,0)
 Q
"RTN","PSGEUDD",67,0)
TEAM ;*** Look up selected team.  PSGTMALL= All teams were selected.
"RTN","PSGEUDD",68,0)
 S TM=""
"RTN","PSGEUDD",69,0)
 I PSGTMALL D ALLTM,LOOP Q
"RTN","PSGEUDD",70,0)
 I 'PSGTM S TM="ZZ" D LOOP Q
"RTN","PSGEUDD",71,0)
 D ALLTM D:$D(PSGTM(TM)) LOOP
"RTN","PSGEUDD",72,0)
 Q
"RTN","PSGEUDD",73,0)
 ;
"RTN","PSGEUDD",74,0)
ALLTM ;*** Get UNIT DOSE information from ^PS(55
"RTN","PSGEUDD",75,0)
 ;
"RTN","PSGEUDD",76,0)
 S TM="ZZ"
"RTN","PSGEUDD",77,0)
 S TM=$S(PSJPRB="":0,1:+$O(^PS(57.7,"AWRT",PSGWD,PSJPRB,0))),TM=$S('TM:"ZZ",'$D(^PS(57.7,PSGWD,1,TM,0)):TM,$P(^(0),U)]"":$P(^(0),U),1:TM)
"RTN","PSGEUDD",78,0)
 Q
"RTN","PSGEUDD",79,0)
 ;
"RTN","PSGEUDD",80,0)
LOOP ;***Loop thru ^PS(55 on the Dispense log multiple.
"RTN","PSGEUDD",81,0)
 F PSGORD=0:0 S PSGORD=$O(^PS(55,+PSGP,5,PSGORD)) Q:'PSGORD  D
"RTN","PSGEUDD",82,0)
 . S PSGDT=PSGSDT-.000001
"RTN","PSGEUDD",83,0)
 . F  S PSGDT=$O(^PS(55,+PSGP,5,+PSGORD,11,"B",PSGDT)) Q:'PSGDT!(PSGEDT<PSGDT)  D
"RTN","PSGEUDD",84,0)
 ..F NO=0:0  S NO=$O(^PS(55,+PSGP,5,+PSGORD,11,"B",PSGDT,NO)) Q:'NO  S ND=^PS(55,+PSGP,5,+PSGORD,11,NO,0) D
"RTN","PSGEUDD",85,0)
 ...I $P(ND,U,5)=3 S DRG=$$ENDDN^PSGMI($P(ND,U,2)),AMT=$P(ND,U,3),WHO=$P(ND,U,6) D @($S(PSGSS="P":"TMPPT",1:"TMPWG"))
"RTN","PSGEUDD",86,0)
 Q
"RTN","PSGEUDD",87,0)
 ;
"RTN","PSGEUDD",88,0)
TMPWG ;***Set ^TMP global for selected by Ward/Ward Group.
"RTN","PSGEUDD",89,0)
 S ^TMP($J,PSGWN,TM,DRG,$E(PPN,1,10)_"^"_+PSGP,PSGDT)=AMT_U_WHO_U_PSJPBID
"RTN","PSGEUDD",90,0)
 Q
"RTN","PSGEUDD",91,0)
 ;
"RTN","PSGEUDD",92,0)
TMPPT ;***Set ^TMP global for selected by patient.
"RTN","PSGEUDD",93,0)
 S ^TMP($J,$E(PPN,1,10)_"^"_+PSGP,DRG,PSGDT)=AMT_U_WHO_U_PSJPPID_U_PSJPRB_U_PSJPWDN
"RTN","PSGEUDD",94,0)
 Q
"RTN","PSGFILED")
0^54^B24312261
"RTN","PSGFILED",1,0)
PSGFILED ;BIR/CML3-VARIOUS FILES' UPKEEP ;16 Mar 99 / 10:22 AM
"RTN","PSGFILED",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,50,63,119,110,111**;16 DEC 97
"RTN","PSGFILED",3,0)
 ;
"RTN","PSGFILED",4,0)
 ; Reference to ^PS(50.606 supported by DBIA# 2174.
"RTN","PSGFILED",5,0)
 ; Reference to ^PSDRUG supported by DBIA# 2192.
"RTN","PSGFILED",6,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSGFILED",7,0)
 ; Reference to ^PS(51 is supported by DBIA# 2176.
"RTN","PSGFILED",8,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSGFILED",9,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGFILED",10,0)
 ;
"RTN","PSGFILED",11,0)
DONE D ENKV^PSGSETU K D0,D1,D2,PSGRBS Q
"RTN","PSGFILED",12,0)
 ;
"RTN","PSGFILED",13,0)
GED ; generic edit
"RTN","PSGFILED",14,0)
 S DA=+Y,DR=".01;1" W ! D ^DIE Q
"RTN","PSGFILED",15,0)
 ;
"RTN","PSGFILED",16,0)
ENAT ; team file
"RTN","PSGFILED",17,0)
 F  S DIC="^PS(57.7,",DIC(0)="QEAMIL",DLAYGO=57.7,DIC("A")="Select WARD: " W ! D ^DIC K DIC,DLAYGO Q:Y'>0  S DA=+Y,DIE="^PS(57.7,",DR="[PSJUMATE]" D ^DIE
"RTN","PSGFILED",18,0)
 G DONE
"RTN","PSGFILED",19,0)
 ;
"RTN","PSGFILED",20,0)
ENAS ; schedules file - no longer used
"RTN","PSGFILED",21,0)
 ;
"RTN","PSGFILED",22,0)
ENMR ; med route file
"RTN","PSGFILED",23,0)
 NEW MRNO,MR K DIE,DIC,DR,Y
"RTN","PSGFILED",24,0)
 F  S DIC="^PS(51.2,",DIC(0)="QEAMIL",DLAYGO=51.2 W ! D ^DIC K DIC,DLAYGO Q:+Y'>0  S MRNO=+Y,MR=$P(Y,U,2),DA=+Y,DIE="^PS(51.2,",DR=".01;1;3;4" D ^DIE D DF
"RTN","PSGFILED",25,0)
 G DONE
"RTN","PSGFILED",26,0)
 ;
"RTN","PSGFILED",27,0)
ENWG ; ward group file
"RTN","PSGFILED",28,0)
 F  S DIC="^PS(57.5,",DIC(0)="QEAMIL",DLAYGO=57.5 W ! D ^DIC K DA,DIC,DR Q:+Y'>0  S DA=+Y,DIE="^PS(57.5,",DR="[PSJU WG]" D ^DIE
"RTN","PSGFILED",29,0)
 G DONE
"RTN","PSGFILED",30,0)
 ;
"RTN","PSGFILED",31,0)
ENMI ; medication instruction file
"RTN","PSGFILED",32,0)
 F  S DIC="^PS(51,",DIC(0)="QEAMIL",DLAYGO=51 W ! D ^DIC K DIC Q:+Y'>0  S DIE="^PS(51,",DA=+Y,DR=".01;1;30" D ^DIE
"RTN","PSGFILED",33,0)
 G DONE
"RTN","PSGFILED",34,0)
 ;
"RTN","PSGFILED",35,0)
ENDRG ; standard drug fields
"RTN","PSGFILED",36,0)
 D NOW^%DTC S PSGDT=% F  S DIC="^PSDRUG(",DIC(0)="AEIMOQ",DIC("A")="Select DISPENSE DRUG: " W ! D ^DIC K DIC Q:+Y'>0  D DE
"RTN","PSGFILED",37,0)
 K PSIUA,PSIUDA,PSIUX G DONE
"RTN","PSGFILED",38,0)
 ;
"RTN","PSGFILED",39,0)
DE ;
"RTN","PSGFILED",40,0)
 I $D(^PSDRUG(+Y,"I")),^("I"),^("I")<PSGDT W $C(7),$C(7),!!?3,"*** WARNING, THIS DRUG IS INACTIVE. ***",!
"RTN","PSGFILED",41,0)
 W ! S DIE="^PSDRUG(",(DA,PSIUDA)=+Y,DR="[PSJ FILED]"
"RTN","PSGFILED",42,0)
 S PSIUX="U^UNIT DOSE PHARMACY^1" D ^PSGIU,^DIE:PSIUA'["^" K DA,DIE,DR Q
"RTN","PSGFILED",43,0)
 ;
"RTN","PSGFILED",44,0)
ENOSE ; order set enter/edit
"RTN","PSGFILED",45,0)
 K DIC F  S DLAYGO=53.2,DIC="^PS(53.2,",DIC(0)="QEAML",DIC("A")="Select ORDER SET: " W ! D ^DIC K DIC Q:Y'>0  S DA=+Y S DIE="^PS(53.2,",DR="[PSJUOSE]" D ^DIE K D0,D1,DA,DIE,DR,PSGNEDFD,PSGS0XT,PSGS0Y
"RTN","PSGFILED",46,0)
 G DONE
"RTN","PSGFILED",47,0)
 ;
"RTN","PSGFILED",48,0)
RBCHK ; used to validate room-bed
"RTN","PSGFILED",49,0)
 ;No longer used.
"RTN","PSGFILED",50,0)
 ;F Z0=0:0 S Z0=$O(^PS(57.7,DA(2),1,Z0)) Q:'Z0  I Z0'=DA(1),$D(^(Z0,1,"B",X)) W !?19,X," is already under ",$S('$D(^PS(57.7,DA(2),1,Z0,0)):"another team ("_Z0_")!",$P(^(0),"^")]"":$P(^(0),"^")_"!",1:"another team ("_Z0_")!") Q
"RTN","PSGFILED",51,0)
 ;I 'Z0,$D(^DIC(42,DA(2),2,+$O(^DIC(42,DA(2),2,"B",$P(X,"-"),0)),1,"B",$P(X,"-",2))) K Z0 Q
"RTN","PSGFILED",52,0)
 ;K X,Z0 Q
"RTN","PSGFILED",53,0)
 ;
"RTN","PSGFILED",54,0)
RBQ ; show room-beds for a ward
"RTN","PSGFILED",55,0)
 ;No longer used.
"RTN","PSGFILED",56,0)
 Q
"RTN","PSGFILED",57,0)
 ;
"RTN","PSGFILED",58,0)
RBNP W """^"" TO STOP: " R Z3:DTIME W:'$T $C(7) S:'$T Z3="^" W $C(13),"            ",$C(13) Q
"RTN","PSGFILED",59,0)
 ;
"RTN","PSGFILED",60,0)
ENPPD ; edit pharmacy patient data
"RTN","PSGFILED",61,0)
 ; W !!?3,"...This option is still under development...",! Q
"RTN","PSGFILED",62,0)
 ;
"RTN","PSGFILED",63,0)
ENCPDD ; edit patient's default stop date (wall)
"RTN","PSGFILED",64,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGFILED",65,0)
 F  D ENAO^PSGGAO Q:PSGP'>0  D
"RTN","PSGFILED",66,0)
 .S WDN=$P($G(^DPT(PSGP,.1)),"^") W:WDN="" !!?2,"The patient is not currently on a ward."
"RTN","PSGFILED",67,0)
 .I WDN]"" S WD=$O(^DIC(42,"B",WDN,0)),WD=$O(^PS(59.6,"B",+WD,0)) I $S('WD:1,1:'$P($G(^PS(59.6,WD,0)),"^",4)) S X="PLEASE NOTE: The 'SAME STOP DATE' parameter for the ward ("_WDN_") is not turned on.  Any date entered here will be ignored "
"RTN","PSGFILED",68,0)
 .I  S X=X_"until the parameter is turned on for this ward." W $C(7),!!?2 F Y=1:1:$L(X," ") S X(1)=$P(X," ",Y) W:$L(X(1))+$X>78 ! W X(1)," "
"RTN","PSGFILED",69,0)
 .S DA=PSGP,DR="62.01T",DIE="^PS(55," W !! D ^DIE
"RTN","PSGFILED",70,0)
 K WD,WDN G DONE
"RTN","PSGFILED",71,0)
 ;
"RTN","PSGFILED",72,0)
ENSYS ; edit system file
"RTN","PSGFILED",73,0)
 ;/S DIE="^PS(59.7,",DA=1,DR="21;26;26.3;26.4;26.2;20.412ALLOW THE CHANGE OF ORDER TYPES ON ORDERS FROM OERR;32"
"RTN","PSGFILED",74,0)
 S DIE="^PS(59.7,",DA=1,DR="21;26;26.3;26.4;26.2;26.5;26.6;26.7;34;26.8"
"RTN","PSGFILED",75,0)
 W ! D ^DIE K DIE,DA,DR Q
"RTN","PSGFILED",76,0)
 ;
"RTN","PSGFILED",77,0)
ENPLSP ; edit pick list site parameters
"RTN","PSGFILED",78,0)
 ;
"RTN","PSGFILED",79,0)
ENCS ; change current site & parameters
"RTN","PSGFILED",80,0)
 I $D(PSJSYSW0)#2 W !!,"Current site: ",$P(PSJSYSW0,"^")
"RTN","PSGFILED",81,0)
 S PSGCSF=1 D ^PSGSET,ENKV^PSGSETU W:$D(XQUIT) !!?5,"(The Inpatient site you are currently working under has not changed.)" K PSGCSF,PSGORSET,XQUIT Q
"RTN","PSGFILED",82,0)
 ;
"RTN","PSGFILED",83,0)
DF ; Add/edit Med route, instruction... to the Dosage form file.
"RTN","PSGFILED",84,0)
 S DIR("A")="Would you like to update the Dosage Form file"
"RTN","PSGFILED",85,0)
 S DIR("?")="If your answer is Yes, you will be able to Add/edit the Med routes, Instructions, Verb, Noun and Preposition that associate with this Dosage form."
"RTN","PSGFILED",86,0)
 S DIR(0)="Y",DIR("B")="Y" D ^DIR Q:Y'=1
"RTN","PSGFILED",87,0)
 NEW Y,DFNO K DIE,DIC,DA,DR
"RTN","PSGFILED",88,0)
 F  S DIC="^PS(50.606,",DIC(0)="QEAMI" D ^DIC Q:+Y'>0  S DFNO=+Y D
"RTN","PSGFILED",89,0)
 . I $G(MR)]"",'$D(^PS(50.606,DFNO,"MR","B",MRNO)) S DIE="^PS(50.606,",DR="1///"_MR,DA=DFNO D ^DIE
"RTN","PSGFILED",90,0)
 . K DIE,DIC,DR,MR S DIE="^PS(50.606,",DR="1;3;4;5",DA=DFNO D ^DIE
"RTN","PSGFILED",91,0)
 ;. K DIE,DIC,DR,MR S DIE="^PS(50.606,",DR="1;2;3;4;5",DA=DFNO D ^DIE
"RTN","PSGFILED",92,0)
 Q
"RTN","PSGFILED",93,0)
ENCSD ;edit Clinc Stop Dates file
"RTN","PSGFILED",94,0)
 F  K DIC S DIC="^PS(53.46,",DIC(0)="AELMQ",DIC("A")="Select CLINIC: ",DLAYGO=53.46 D ^DIC K DIC Q:Y<0  D
"RTN","PSGFILED",95,0)
 . S DIE="^PS(53.46,",DA=+Y,DR=1 D ^DIE K DIE,DA,DR
"RTN","PSGFILED",96,0)
 Q
"RTN","PSGFILED",97,0)
ENCG ; clinic group file
"RTN","PSGFILED",98,0)
 F  S DIC="^PS(57.8,",DIC(0)="QEAMIL",DLAYGO=57.8 W ! D ^DIC K DA,DIC,DR Q:+Y'>0  S DA=+Y,DIE="^PS(57.8,",DR=".01;1" D ^DIE
"RTN","PSGFILED",99,0)
 G DONE
"RTN","PSGFILED",100,0)
 ;
"RTN","PSGL")
0^56^B35127952
"RTN","PSGL",1,0)
PSGL ;BIR/CML3-LABEL PRINT/REPRINT ;25 SEP 97 / 7:41 AM
"RTN","PSGL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**31,111**;16 DEC 97
"RTN","PSGL",3,0)
 ;
"RTN","PSGL",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSGL",5,0)
 ;
"RTN","PSGL",6,0)
 N PSGPTMP,PSJNEW,PPAGE,PSGEFN S PSJNEW=1
"RTN","PSGL",7,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  K PSGLSTOP S %=1 F PSGTOL=1,3 I $O(^PS(53.41,PSGTOL,1,0)) D ENACL^PSGL0
"RTN","PSGL",8,0)
 G:%<0 DONE
"RTN","PSGL",9,0)
CHK ;
"RTN","PSGL",10,0)
 I '$O(^PS(53.41,2,1,DUZ,1,0)) G ASK
"RTN","PSGL",11,0)
 F  W !!,"You have unprinted new labels.  Do you want them now" S %=1 D YN^DICN Q:%  D CHKM^PSGLH
"RTN","PSGL",12,0)
 G:%<0 DONE I %=1 D ENNL^PSGL0 G ASK
"RTN","PSGL",13,0)
 F  W !!,"Will you want them later" S %=1 D YN^DICN Q:%  D LM^PSGLH
"RTN","PSGL",14,0)
 G:%<0 DONE I %=2 S DIK="^PS(53.41,2,1,",DA=DUZ,DA(1)=2 D ^DIK
"RTN","PSGL",15,0)
 ;
"RTN","PSGL",16,0)
ASK ;
"RTN","PSGL",17,0)
 S PSGSSH="LBL" F  D ^PSGSEL Q:"^"[PSGSS  K PSGLWD,PSGLWG S PSGPTMP=0,PPAGE=1 D @PSGSS Q:+Y'>0  K ZTSAVE,IO("Q") S POP=0,Y=1 D:PSGSS'="P" DT Q:Y'>0  D:PSGSS'="P" DEV Q:POP!$D(IO("Q"))  D @("EN"_PSGSS) D ^%ZISC
"RTN","PSGL",18,0)
 ;
"RTN","PSGL",19,0)
DONE ;
"RTN","PSGL",20,0)
 D ENKV^PSGSETU K CF,DFN,NG,OD,ON,PSGCNT,PSGLMT,PSGODDD,PSGOL,PSGON,PSGOP,PSGORD,PSGODT,PSGSS,PSGPL1,PSGPL2,PSGPL3,PSGSSH,PSIVREA,PSJON,PSJOL,PSJORD,PSJIVOF,PSJOCNT,PSJON,RF,QO,QS,QSD,Q1,Q2,WG,ZTSAVE
"RTN","PSGL",21,0)
 K ORPV,ORSTOP,ORSTRT,ORSTS,P17 Q
"RTN","PSGL",22,0)
 ;
"RTN","PSGL",23,0)
DEV ;
"RTN","PSGL",24,0)
 K ZTSK,%ZIS,IOP,IO("Q") S PSGION=ION,%ZIS="Q",%ZIS("A")="Label Printing Device: ",%ZIS("B")=$P(PSJSYSL,"^",2) W ! D ^%ZIS K %ZIS I POP S IOP=PSGION D ^%ZIS K IOP S POP=1 W !?3,"(No device chosen for label print.)" Q
"RTN","PSGL",25,0)
 D EN2^PSGLBA S POP=0 Q:'$D(IO("Q"))
"RTN","PSGL",26,0)
 S ZTDESC="UD LABEL PRINT",PSGTIR=$S(PSGSS'="P":"EN"_PSGSS,1:"ENPLP")_"^PSGL" I PSGSS="G" F X="PSGLBLD","PSGLWG","PSGLWGN" S ZTSAVE(X)=""
"RTN","PSGL",27,0)
 I PSGSS="W" F X="PSGLBLD","PSGLWD","PSGLWDN" S ZTSAVE(X)=""
"RTN","PSGL",28,0)
 I PSGSS="P" F X="PSGP","PSGP(0)","PSJPAGE","PSJPDOB","PSJPDX","PSJPRB","PSJPSEX","PSJPSSN","PSJPWD","PSJPWDN","PSGODDD","PSGODDD(","VA(""PID"")","VA(""BID"")","^TMP(""PSJON"",$J," S ZTSAVE(X)=""
"RTN","PSGL",29,0)
 W ! D ENTSK^PSGTI W !,"Labels ",$S($D(ZTSK):"",1:"NOT "),"queued!"
"RTN","PSGL",30,0)
 Q
"RTN","PSGL",31,0)
 ;
"RTN","PSGL",32,0)
G ;
"RTN","PSGL",33,0)
 K DIC S DIC="^PS(57.5,",DIC(0)="QEAMIZ",DIC("A")="Select WARD GROUP: " W ! D ^DIC K DIC D  Q
"RTN","PSGL",34,0)
 . I X="^OTHER" S (PSGLWG,PSGLWGN)="^OTHER",Y=1 Q
"RTN","PSGL",35,0)
 . I Y>0 S PSGLWG=+Y,PSGLWGN=Y(0,0)
"RTN","PSGL",36,0)
 ;
"RTN","PSGL",37,0)
W ;
"RTN","PSGL",38,0)
 K DIC S DIC="^DIC(42,",DIC(0)="QEAMIZ",DIC("A")="Select WARD: " W ! D ^DIC K DIC S:Y>0 PSGLWD=+Y,PSGLWDN=Y(0,0) Q
"RTN","PSGL",39,0)
 ;
"RTN","PSGL",40,0)
P ;
"RTN","PSGL",41,0)
 K PSJPR D ^PSJP S Y=PSGP Q
"RTN","PSGL",42,0)
 ;
"RTN","PSGL",43,0)
C ;
"RTN","PSGL",44,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGL",45,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGL",46,0)
CDIC ;
"RTN","PSGL",47,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y
"RTN","PSGL",48,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGL",49,0)
 Q
"RTN","PSGL",50,0)
L ;
"RTN","PSGL",51,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGL",52,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGL",53,0)
LDIC ;
"RTN","PSGL",54,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y
"RTN","PSGL",55,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGL",56,0)
 Q
"RTN","PSGL",57,0)
ENG ;
"RTN","PSGL",58,0)
 F PSGLWD=0:0 S PSGLWD=$O(^PS(57.5,"AC",PSGLWG,PSGLWD)) Q:'PSGLWD  S PSGLWDN=$P($G(^DIC(42,PSGLWD,0)),"^") D ENW1
"RTN","PSGL",59,0)
 Q
"RTN","PSGL",60,0)
 ;
"RTN","PSGL",61,0)
ENW ;
"RTN","PSGL",62,0)
 S PSGLWG=$O(^PS(57.5,"AB",PSGLWD,0)),PSGLWGN="" I PSGLWG,$D(^PS(57.5,PSGLWG,0)),$P(^(0),"^")]"" S PSGLWG=$P(^(0),"^")
"RTN","PSGL",63,0)
 ;
"RTN","PSGL",64,0)
ENW1 ;
"RTN","PSGL",65,0)
 D NOW^%DTC S PSGDT=% U IO F PSGOP=0:0 S (DFN,PSGOP,PSGP)=$O(^DPT("CN",PSGLWDN,PSGOP)) Q:'PSGOP  D IWP
"RTN","PSGL",66,0)
 Q
"RTN","PSGL",67,0)
IWP ;
"RTN","PSGL",68,0)
 N PSJFIRST,PSJACND S (PSJACND,PSJFIRST)=1 K PSJACNWP D ^PSJAC,ENPVSET^PSGLPI
"RTN","PSGL",69,0)
 F QSD=PSGLAD:0 S QSD=$O(^PS(55,PSGOP,5,"AUS",QSD)) Q:'QSD  F ON=0:0 S ON=$O(^PS(55,PSGOP,5,"AUS",QSD,ON)) Q:'ON  D
"RTN","PSGL",70,0)
 .I PSJFIRST,$P(PSJSYSW0,U,18) D ENHEDER^PSGLPI S PSJFIRST=0
"RTN","PSGL",71,0)
 .I $D(^PS(55,PSGOP,5,ON,7)),+^(7)'<PSGLBLD S PSGORD=ON_"A" D ^PSGLOI,KL
"RTN","PSGL",72,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AC",PSGOP,ON)) Q:'ON  D
"RTN","PSGL",73,0)
 .I PSJFIRST,$P(PSJSYSW0,U,18) D ENHEDER^PSGLPI S PSJFIRST=0
"RTN","PSGL",74,0)
 .I $D(^PS(53.1,ON,7)),+^(7)'<PSGLBLD S PSGORD=ON_"N" D ^PSGLOI,KL
"RTN","PSGL",75,0)
 Q
"RTN","PSGL",76,0)
 ;
"RTN","PSGL",77,0)
ENL S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D ENC
"RTN","PSGL",78,0)
 Q
"RTN","PSGL",79,0)
ENC ;
"RTN","PSGL",80,0)
 K ^TMP("PSJCI",$J)
"RTN","PSGL",81,0)
 S STDTE=0 F  S STDTE=$O(^PS(55,"AUDC",STDTE)) Q:'STDTE  S CLINIC=0 F  S CLINIC=$O(^PS(55,"AUDC",STDTE,CLINIC)) Q:'CLINIC  D
"RTN","PSGL",82,0)
 . S JDFN=0 F  S JDFN=$O(^PS(55,"AUDC",STDTE,CLINIC,JDFN)) Q:'JDFN  S ^TMP("PSJCI",$J,JDFN)=""
"RTN","PSGL",83,0)
 S DFN="" F  S DFN=$O(^TMP("PSJCI",$J,DFN)) Q:'DFN  S (PSGOP,PSGP)=DFN D IWP
"RTN","PSGL",84,0)
 Q
"RTN","PSGL",85,0)
ENP ;
"RTN","PSGL",86,0)
 ;D ENL^PSJO3 Q:"^N"[PSJOL  S PSJOS=$P(PSJSYSP0,"^",11),PSGLPF=1 D ^PSJO K PSGLPF Q:'PSJON  S PSGLMT=PSJON
"RTN","PSGL",87,0)
 D ENL^PSJO3 Q:"^N"[PSJOL  S PSJOS=$P(PSJSYSP0,"^",11) D ^PSJO K PSGLPF Q:'PSJON  S PSGLMT=PSJON
"RTN","PSGL",88,0)
 F  R !!,"Select orders for labels: ",X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D  Q:$D(X)
"RTN","PSGL",89,0)
 .I X?2."?" D H2^PSGON K X Q
"RTN","PSGL",90,0)
 .I X?1."?" W !!?2,"Select the orders for which you want labels printed." K X Q
"RTN","PSGL",91,0)
 .I X="A" D AADR^PSJUTL K X Q
"RTN","PSGL",92,0)
 .I X'?1."?" D ^PSGON W:'$D(X) $C(7),"  ??" Q
"RTN","PSGL",93,0)
 I "^"[X K ^TMP("PSJON",$J) Q
"RTN","PSGL",94,0)
 D DEV I POP!$D(IO("Q")) K ^TMP("PSJON",$J) Q
"RTN","PSGL",95,0)
 ;
"RTN","PSGL",96,0)
ENPLP ;
"RTN","PSGL",97,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12),(DFN,PSGOP)=PSGP D:$D(ZTSK) ^PSJAC D ENPVSET^PSGLPI U IO
"RTN","PSGL",98,0)
 N PSJFIRST S PSJFIRST=1 F PSGPL1=1:1:PSGODDD F PSGPL2=1:1 S PSGPL3=$P(PSGODDD(PSGPL1),",",PSGPL2) Q:'PSGPL3  S (PSGORD,PSJORD)=^TMP("PSJON",$J,PSGPL3) D
"RTN","PSGL",99,0)
 .I PSJFIRST,$P(PSJSYSW0,U,18) D ENHEDER^PSGLPI S PSJFIRST=0
"RTN","PSGL",100,0)
 .I PSGORD["V" D EN^PSIVUDL(DFN,PSGORD,PSGLWD_U_PSGLWDN,PSGLRB),KL Q
"RTN","PSGL",101,0)
 .I PSGORD'["P" D ^PSGLOI,KL Q
"RTN","PSGL",102,0)
 .S X=$P($G(^PS(53.1,+PSGORD,0)),"^",4) I X="F" D EN^PSIVUDL(DFN,PSGORD,PSGLWD_U_PSGLWDN,PSGLRB),KL Q
"RTN","PSGL",103,0)
 .D ^PSGLOI,KL
"RTN","PSGL",104,0)
 Q
"RTN","PSGL",105,0)
 ;
"RTN","PSGL",106,0)
DT ;
"RTN","PSGL",107,0)
 F  K %DT S %DT="ET",%DT(0)="-NOW" R !!,"Enter label start date: ",X:DTIME D:X?1."?" DTM^PSGLH D ^%DT K %DT I Y>0!("^"[X) S PSGLBLD=Y,ZTSAVE("PSGLBLD")="" Q
"RTN","PSGL",108,0)
 W:Y'>0 $C(7),!?3,"(No date selected for label print.)" Q
"RTN","PSGL",109,0)
 ;
"RTN","PSGL",110,0)
KL ; kill other label records for the same order
"RTN","PSGL",111,0)
 S QS=$S(PSGORD["V":3,PSGORD["N":2,1:1) K ^PS(53.41,2,1,DUZ,1,PSGOP,1,QS,+PSGORD)
"RTN","PSGL",112,0)
 Q
"RTN","PSGLOI")
0^57^B33590707
"RTN","PSGLOI",1,0)
PSGLOI ;BIR/CML3-ORDER INFO (AND PRINT) FOR LABELS ;30 Apr 98 / 4:41 PM
"RTN","PSGLOI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,44,58,110,111**;16 DEC 97
"RTN","PSGLOI",3,0)
 ;
"RTN","PSGLOI",4,0)
 ;Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGLOI",5,0)
 ;Reference to ^PSD(58.8 is supported by DBIA 2283.
"RTN","PSGLOI",6,0)
 ;Reference to ^PSI(58.1 is supported by DBIA 2284.
"RTN","PSGLOI",7,0)
 ;Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGLOI",8,0)
 ;
"RTN","PSGLOI",9,0)
ENOI ;
"RTN","PSGLOI",10,0)
 S F="^PS("_$S(PSGORD["N":"53.1,",PSGORD["P":"53.1,",1:"55,"_PSGOP_",5,")_+PSGORD_","
"RTN","PSGLOI",11,0)
 ; the quit below corrects an error if the Order has been moved to 55
"RTN","PSGLOI",12,0)
 Q:'$D(@(F_"0)"))
"RTN","PSGLOI",13,0)
 S ND=$G(@(F_"0)")),PSGLPR=$P(ND,"^",2),PSGLMR=$P(ND,"^",3),PSGLST=$P(ND,"^",7),PSGLSTAT=$P(ND,"^",9),PSGLTD=$P(ND,"^",12),PSGLOD=$P(ND,"^",14),PSGLSM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),NG=$P(ND,"^",22)
"RTN","PSGLOI",14,0)
 S ND=$G(@(F_".2)")),PSGLDRG=$P(ND,"^"),PSGLDDA=+ND,PSGLDO=$P(ND,"^",2)
"RTN","PSGLOI",15,0)
 S PSGCLN=$G(@(F_"8)")) I PSGCLN]"" S PSGLWDN=$P(^SC($P(PSGCLN,"^"),0),"^")
"RTN","PSGLOI",16,0)
 ;
"RTN","PSGLOI",17,0)
SET ;
"RTN","PSGLOI",18,0)
 ; naked references below refer to full reference inside indirection @(F_"2)" for either file 53.1 or 55
"RTN","PSGLOI",19,0)
 K PSGLAT S ND=$G(@(F_"2)")),(PSGLSSD,PSGLSD)=$P(ND,"^",2),(PSGLFFD,PSGLFD)=$P(ND,"^",4),PSGLAT=$P(ND,"^",5),PSGLMN=$P(ND,"^",6),PSGLSCH=$P(ND,"^"),ND=$G(^(7)),PSGLDT=+ND,PSGLR=$P(ND,"^",2)
"RTN","PSGLOI",20,0)
 I PSGLST'="R",PSGLMN="D",PSGLAT="" S PSGLAT=$E($P(PSGLSD,".",2)_"0000",1,4)
"RTN","PSGLOI",21,0)
 I PSGLAT,PSGLSCH["@" S PSGLSCH=$P(PSGLSCH,"@")
"RTN","PSGLOI",22,0)
 S (PSGLAT(0),X)=0 I PSGLFD]"",PSGLFD'>PSGDT S (PSGLAT(0),X)=5,(PSGLAT(1),PSGLAT(2),PSGLAT(4),PSGLAT(5))="****",PSGLAT(3)=$S(PSGLSTAT["D":"DC'D",1:"EX'D")
"RTN","PSGLOI",23,0)
 E  I $S(PSGLSTAT="P":1,PSGLSTAT="U":1,PSGLST="OC":1,PSGLST="P":1,1:PSGLSCH["PRN") S PSGLAT=""
"RTN","PSGLOI",24,0)
 E  I PSGLAT S PSGLAT(0)=$L(PSGLAT,"-"),X=0 D
"RTN","PSGLOI",25,0)
 .F Q=1:1:5 S PSGLAT(Q)=""
"RTN","PSGLOI",26,0)
 .S Q=PSGLAT(0),Y=PSGLAT I Q=1 S PSGLAT(3)=$P(Y,"-") Q
"RTN","PSGLOI",27,0)
 .I Q=2 S PSGLAT(1)=$P(Y,"-"),PSGLAT(5)=$P(Y,"-",2) Q
"RTN","PSGLOI",28,0)
 .I Q=3 S PSGLAT(1)=$P(Y,"-"),PSGLAT(3)=$P(Y,"-",2),PSGLAT(5)=$P(Y,"-",3) Q
"RTN","PSGLOI",29,0)
 .F Q=1:1:PSGLAT(0) S X=X+1,PSGLAT(X)=$P(PSGLAT,"-",Q) I PSGLAT(0)<4 S X=X+1 S:Q<5 PSGLAT(X)=""
"RTN","PSGLOI",30,0)
 I X<5 F Q=X+1:1:5 S:'$G(PSGLAT(Q)) PSGLAT(Q)=""
"RTN","PSGLOI",31,0)
 I $G(DFN),$G(PSGORD) N PSGLREN S PSGLREN=+$$LASTREN^PSJLMPRI(DFN,PSGORD)
"RTN","PSGLOI",32,0)
 S ND=$G(@(F_"4)")),PSGLRN=+ND,PSGLRPH=+$P(ND,"^",3) N PSGLRNDT S PSGLRNDT=$P(ND,"^",2) I PSGLRNDT,$G(PSGLREN) I $G(PSGLREN)>PSGLRNDT S PSGLRN=0
"RTN","PSGLOI",33,0)
 I NG S PSGLSI="*** NOT TO BE GIVEN ***"
"RTN","PSGLOI",34,0)
 E  S PSGLSI=$P($G(@(F_"6)")),"^") S:PSGLSI]"" PSGLSI=$$ENSET^PSGSICHK(PSGLSI)
"RTN","PSGLOI",35,0)
 ;* I PSGLSI="",$P(@(F_"0)"),U,9)="P",$O(@(F_"12,0)")) S X=0 F  S X=$O(@(F_"12,"_X_")")) Q:'X  S Z=$G(^(X,0)),Y=$L(PSGLSI) S:Y+$L(Z)'>179 PSGLSI=PSGLSI_Z_" " I Y+$L(Z)>179 S PSGLSI=PSGLSI_$E(Z,1,177-Y)_"..." Q
"RTN","PSGLOI",36,0)
 ; naked references below refer to full reference inside indirection @(F_"2)" for either file 53.1 or 55
"RTN","PSGLOI",37,0)
 I PSGLSI="",$P(@(F_"0)"),U,9)="P",$O(@(F_"12,0)")) S X=0 F  S X=$O(@(F_"12,"_X_")")) Q:'X  S Z=$G(^(X,0)),Y=$L(PSGLSI) S:Y+$L(Z)'>179 PSGLSI=PSGLSI_Z_" " I Y+$L(Z)>179 S PSGLSI="SEE PROVIDER COMMENTS" Q
"RTN","PSGLOI",38,0)
 S PSGLDT=$$ENDTC^PSGMI(PSGLDT),PSGLOD=$E($$ENDTC^PSGMI(PSGLOD),1,5)
"RTN","PSGLOI",39,0)
 I PSGLSTAT="P"!(PSGLSTAT="U") S PSGLSD="           ",PSGLFD="              ",PSGLST=" "
"RTN","PSGLOI",40,0)
 E  S PSGLSD=$$ENDTC1^PSGMI(PSGLSD),PSGLSD=$E(PSGLSD,1,5)_$E(PSGLSD,9,14),PSGLFD=$$ENDTC1^PSGMI(PSGLFD)
"RTN","PSGLOI",41,0)
 ;I PSGLSTAT="P"!(PSGLSTAT="U") S (PSGLSD,PSGLFD)="     ",PSGLST=" "
"RTN","PSGLOI",42,0)
 ;E  S PSGLSD=$E($$ENDTC^PSGMI(PSGLSD),1,5),PSGLFD=$$ENDTC^PSGMI(PSGLFD)
"RTN","PSGLOI",43,0)
 S:'PSGLRN PSGLRN="_____" I PSGLRN,$D(^VA(200,+PSGLRN,0))#2 S X=^(0),X=$S($P(X,"^",2)]"":$P(X,"^",2),1:$P(X,"^")),PSGLRN=$S(X'[",":X,1:$E(X,$F(X,","))_$E(X))
"RTN","PSGLOI",44,0)
 S:'PSGLRPH PSGLRPH="_____" I PSGLRPH,$D(^VA(200,+PSGLRPH,0))#2 S X=^(0),X=$S($P(X,"^",2)]"":$P(X,"^",2),1:$P(X,"^")),PSGLRPH=$S(X'[",":X,1:$E(X,$F(X,","))_$E(X))
"RTN","PSGLOI",45,0)
 I $P($G(^PS(51.2,+PSGLMR,0)),"^")]"" S PSGLMR=$E($S($P(^(0),"^",3)]"":$P(^(0),"^",3),1:$P(^(0),"^")),1,5)
"RTN","PSGLOI",46,0)
 I $P($G(^VA(200,+PSGLPR,0)),"^")]"" S PSGLPR=$P(^(0),"^")
"RTN","PSGLOI",47,0)
 S Q=32-$L(PSGLDO)-$L(PSGLMR) I $L(PSGLSCH)>Q S PSGLSCH=$E(PSGLSCH,1,Q-3)_"..."
"RTN","PSGLOI",48,0)
 NEW DRUGNAME
"RTN","PSGLOI",49,0)
 D DRGDISP^PSJLMUT1(DFN,$S(PSGORD["A":+PSGORD_"U",PSGORD["U":+PSGORD_"U",1:+PSGORD_"P"),40,34,.DRUGNAME,0)
"RTN","PSGLOI",50,0)
 ;* N PSGNOW D NOW^%DTC S PSGNOW=% S (PSGLNF,PSGLWS)=0 F X=0:0 S X=$O(@(F_"1,"_X_")")) Q:'X!(PSGLWS)  S Y=$G(^(X,0)) I $P(Y,U,3)>PSGNOW!'$P(Y,U,3) S PSGLWS=$D(^PSI(58.1,"D",+Y,+PSGLWD))
"RTN","PSGLOI",51,0)
 ; naked references below refer to full reference inside indirection @(F_"2)" for either file 53.1 or 55
"RTN","PSGLOI",52,0)
 N PSGNOW D NOW^%DTC S PSGNOW=% S (PSGLNF,PSGLWS)=0 F X=0:0 S X=$O(@(F_"1,"_X_")")) Q:'X!(PSGLWS)  S Y=$G(^(X,0)) I $P(Y,U,3)>PSGNOW!'$P(Y,U,3) S PSGLWS=$S($D(^PSI(58.1,"D",+Y,+PSGLWD)):1,$D(^PSD(58.8,"D",+Y,+PSGLWD)):1,1:0)
"RTN","PSGLOI",53,0)
 I $D(PSGLSTOP) Q
"RTN","PSGLOI",54,0)
 ;
"RTN","PSGLOI",55,0)
ENP ;
"RTN","PSGLOI",56,0)
 ;W $C(13),?1,PSGLOD," | ",PSGLSD," | ",PSGLFD,?35,"(",PSGLBS5,")",?43,"|",PSGLAT(1),?52,PSGLPN,?88,$J($S(PSGLRB]"":PSGLRB,1:"*NF*"),12)
"RTN","PSGLOI",57,0)
 I PSGLSD["     ",+$G(@(F_"4)")) S X="P E N D I N G"
"RTN","PSGLOI",58,0)
 E  S X=PSGLSD_" |"_PSGLFD
"RTN","PSGLOI",59,0)
 W $C(13),?1,PSGLOD," |",X,?36,"(",PSGLBS5,")",?42,"|",PSGLAT(1),?52,PSGLPN,?88,$J($S(PSGLRB]"":PSGLRB,1:"*NF*"),12)
"RTN","PSGLOI",60,0)
 ;W $C(13),?1,PSGLOD," | ",X,?35,"(",PSGLBS5,")",?43,"|",PSGLAT(1),?52,PSGLPN,?88,$J($S(PSGLRB]"":PSGLRB,1:"*NF*"),12)
"RTN","PSGLOI",61,0)
 F X=0:0 S X=$O(DRUGNAME(X)) Q:'X  D
"RTN","PSGLOI",62,0)
 . I X=1 W !?1,DRUGNAME(X),?42,PSGLST,?43,"|",PSGLAT(2),?52,PSGLSSN,?70,PSGLDOB,"  (",PSGLAGE,")",?85,$J($S(PSGLTM]"":PSGLTM,1:"NOT FOUND"),15)
"RTN","PSGLOI",63,0)
 . I X=2 W !?1,DRUGNAME(X),?43,"|",PSGLAT(3),?52,PSGLSEX,?65,"DX: ",PSGLDX
"RTN","PSGLOI",64,0)
 . S L=X+1
"RTN","PSGLOI",65,0)
 . I L=5,PSGLSI]"" W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",66,0)
 . I X>2 W !?1,DRUGNAME(X) D NXTLNE
"RTN","PSGLOI",67,0)
 I L=5,PSGLSI]"" W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",68,0)
 F Y=1:1:$L(PSGLSI," ") S Y1=$P(PSGLSI," ",Y) D
"RTN","PSGLOI",69,0)
 .I $L(Y1)>42 F  Q:$L(Y1)<42  D
"RTN","PSGLOI",70,0)
 ..S LEN=43-$X W $E(Y1,1,LEN) S Y1=$E(Y1,LEN+1,255) D NXTLNE
"RTN","PSGLOI",71,0)
 ..I L#5=0 W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",72,0)
 .I ($X+$L(Y1))>42 D NXTLNE I L#5=0 W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",73,0)
 .W Y1," "
"RTN","PSGLOI",74,0)
 D:PSGLSI]"" NXTLNE
"RTN","PSGLOI",75,0)
 I $D(PSGLAT(L+1)) F  Q:'$D(PSGLAT(L+1))  D
"RTN","PSGLOI",76,0)
 .I L#5=0 W ?1,"See next label for continuation" D NXTLNE W ! Q
"RTN","PSGLOI",77,0)
 .D NXTLNE
"RTN","PSGLOI",78,0)
 I L#5>0 F  Q:L#5=0  D NXTLNE
"RTN","PSGLOI",79,0)
 W $E("WS",1,PSGLWS*2) W:PSGLSM ?4,$E("HSM",PSGLSM,3) W ?8,$E("NF",1,PSGLNF*2),?24,"RPH:",PSGLRPH,?33," RN:",PSGLRN D NXTLNE
"RTN","PSGLOI",80,0)
 W !
"RTN","PSGLOI",81,0)
 Q
"RTN","PSGLOI",82,0)
 ;
"RTN","PSGLOI",83,0)
NXTLNE ; Print info to right of drug
"RTN","PSGLOI",84,0)
 W ?43,"|",$G(PSGLAT(L))
"RTN","PSGLOI",85,0)
 I L=4 D
"RTN","PSGLOI",86,0)
 .N Y S Y=PSGLR W ?52 W:PSGLDT PSGLDT,?77,$S(Y="NR":"RENEWAL ",Y["N":"NEW ",1:""),"ORDER "
"RTN","PSGLOI",87,0)
 .W $S(Y="E":"EDITED",Y="DE":"DC'ED (EDIT)",Y["D":"DISCONTINUED",Y="NE":"(EDIT)",PSGLR="H1":"ON HOLD",PSGLR="H0":"OFF OF HOLD",PSGLR="RE":"REINSTATED",1:"")
"RTN","PSGLOI",88,0)
 .I PSGLFFD]"",PSGLFFD'>PSGDT,PSGLR'["D" W " (EXPIRED)"
"RTN","PSGLOI",89,0)
 W:L=5 ?52,$S(PSGLWGN]"":$E(PSGLWGN,1,21),1:"NOT FOUND"),?79,$J($S(PSGLWDN]"":$E(PSGLWDN,1,21),1:"NOT FOUND"),21)
"RTN","PSGLOI",90,0)
 W !,?1 S L=L+1
"RTN","PSGLOI",91,0)
 Q
"RTN","PSGLOI",92,0)
ENKV ;*** Kill var created from this routine
"RTN","PSGLOI",93,0)
 K PSGDT,PSGLAGE,PSGLAT,PSGLBS5,PSGLDDA,PSGLDO,PSGLDOB,PSGLDRG,PSGLDT,PSGLDX,PSGLFD,PSGLFFD,PSGLMN,PSGLMR,PSGLNF,PSGLOD,PSGLPN
"RTN","PSGLOI",94,0)
 K PSGLPR,PSGLR,PSGLRB,PSGLRN,PSGLRPH,PSGLSCH,PSGLSD,PSGLSEX,PSGLSI,PSGLSM,PSGLSSD,PSGLSSN,PSGLST
"RTN","PSGLOI",95,0)
 K PSGLSTAT,PSGLSTOP,PSGLTD,PSGLTM,PSGLWD,PSGLWDN,PSGLWGN,PSGLWS,PSGNOW,PSGOP,PSGORD
"RTN","PSGLOI",96,0)
 Q
"RTN","PSGMAR")
0^20^B40665758
"RTN","PSGMAR",1,0)
PSGMAR ;BIR/CML3-24 HOUR MAR - MAIN DRIVER ;14 Oct 98 / 4:27 PM
"RTN","PSGMAR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,15,20,111**;16 DEC 97
"RTN","PSGMAR",3,0)
 ;
"RTN","PSGMAR",4,0)
EN ;
"RTN","PSGMAR",5,0)
 NEW PSGOP
"RTN","PSGMAR",6,0)
 D ENCV^PSGSETU G:$D(XQUIT) DONE
"RTN","PSGMAR",7,0)
 D MARFORM^PSGMUTL G:PSGMARB=0 DONE S:PSGMARB'=1 PSGMARS=3
"RTN","PSGMAR",8,0)
 G:PSGMARB'=1 ENDATE F  R !!,"Print (C)ontinuous sheets, (P)RN sheets, or (B)oth? B// ",X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^CPB"[X&($L(X)<2)  W:X'?1."?" $C(7),"  ??" D:X?1."?" SHTH
"RTN","PSGMAR",9,0)
 G:X="^" DONE I X="" W "  (Both)" S PSGMARS=3
"RTN","PSGMAR",10,0)
 E  W $S(X="C":"ontinuous",X="P":"RN",1:"oth") S PSGMARS=$F("CPB",X)-1
"RTN","PSGMAR",11,0)
 ;
"RTN","PSGMAR",12,0)
ENDATE ; get start date
"RTN","PSGMAR",13,0)
 S %DT="ETX",Y=-1 F  W !!,"Enter START DATE/TIME for 24 hour MAR: " R X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" DH D ^%DT Q:Y>0
"RTN","PSGMAR",14,0)
 I Y'>0 W $C(7),!!?5,"(No date selected for MAR run.)" G DONE
"RTN","PSGMAR",15,0)
 S PSGMARDT=+$E(Y,1,10) D:$P(PSGMARDT,".",2)  ;
"RTN","PSGMAR",16,0)
 .S PSGPLS=PSGMARDT,PSGPLF=$$EN^PSGCT(PSGPLS,-1),ST=$P(PSGPLS_0,".",2),FT=$P(PSGPLF_0,".",2)
"RTN","PSGMAR",17,0)
 .S PSGMARSD=$E(ST,1,2),PSGMARFD=$E(FT,1,2) S:'PSGMARSD PSGMARSD="01" S PSGMARFD=$S(+PSGMARSD=1:24,PSGMARSD=PSGMARFD:PSGMARSD-1,1:PSGMARFD) S:$L(PSGMARFD)<2 PSGMARFD=0_PSGMARFD
"RTN","PSGMAR",18,0)
 .I ST>1 S X1=$P(PSGPLF,"."),X2=1 D C^%DTC S PSGPLF=X
"RTN","PSGMAR",19,0)
 .S PSGPLS=+(PSGPLS_"."_ST),PSGPLF=+(PSGPLF_"."_FT)
"RTN","PSGMAR",20,0)
 .S PSGMARSP=$$ENDTC2^PSGMI(PSGPLS),PSGMARFP=$$ENDTC2^PSGMI(PSGPLF)
"RTN","PSGMAR",21,0)
 D NOW^%DTC S PSGDT=%,(PSGMARWG,PSJPWDO)=0,PSGMARWD=+$G(PSJPWD),PSGRBPPN=""
"RTN","PSGMAR",22,0)
 I '$D(PSGOENOF) S (PSGP,PSGPAT)=0,PSGSSH="MAR" D ^PSGSEL G:"^"[PSGSS OUT D @PSGSS G:$G(PSJSTOP) OUT
"RTN","PSGMAR",23,0)
 G:$$MEDTYPE^PSJMDIR(PSGMARWD) OUT S PSGMTYPE=Y
"RTN","PSGMAR",24,0)
 D DEV I POP!$D(IO("Q")) G DONE
"RTN","PSGMAR",25,0)
 ;
"RTN","PSGMAR",26,0)
ENQ ; when queued
"RTN","PSGMAR",27,0)
 N F,P,DRGI,DRGN,DRGT,PSIVUP,PSJORIFN,PSGMSORT
"RTN","PSGMAR",28,0)
 S PSJACNWP=1 U IO D ^PSGMAR0 I $D(^TMP($J))>9 D ^PSGMAR1
"RTN","PSGMAR",29,0)
 D ^%ZISC G DONE
"RTN","PSGMAR",30,0)
 ;
"RTN","PSGMAR",31,0)
OUT W $C(7),!!?5,"(No patient(s) selected for MAR run.)" K PSGPLF,PSGPLS
"RTN","PSGMAR",32,0)
DONE ;
"RTN","PSGMAR",33,0)
 ;* I '$D(PSGOENOF) D ENKV^PSGSETU K PSGOP
"RTN","PSGMAR",34,0)
 I '$D(PSGOENOF) D ENKV^PSGSETU
"RTN","PSGMAR",35,0)
 K AD,ASTERS,BD,BLN,C,CNTR,DA1,DA2,DAO,DFN,DRG,DX,EXPIRE,FD,FT,HX,L,LN1,LN14,LN2,LN3,LN4,LN5,LN6,LN7,MOS,MSG1,MSG2,ND2,NG,OPST,PSJJORD,PAGE,PN,PND,PNN,PPN,PRB,PSEX,PSSN,PSGPLF,PSGPLS,PSGPLC,PSGPLO,QX,TMSTR,XX
"RTN","PSGMAR",36,0)
 K PSGADR,PSGALG,PSGD,PSGDW,PSGFORM,PSGMAR,PSGMARB,PSGMARDF,PSGMARDT,PSGMARED,PSGMARGD,PSGMARFD,PSGMARFP,PSGMAROC,PSGMARS,PSGMARSD,PSGL
"RTN","PSGMAR",37,0)
 K PSGMARSM,PSGMARSP,PSGMARTS,PSGMARWD,PSGMARWG,PSGMARWN,PSGMARWS,PSGMPG,PSGMPGN,PSGORD,PSGPAT,PSJDIET
"RTN","PSGMAR",38,0)
 K PSJSTOP,PSJPWDO,PSGMARO,ST,PSGSS,PSGSSH,PSTXDT,PST,PTM,PWDN,PSJACNWP,QST,R,RB,RCT,S,SD,SM,SPACES,TM,T,TD,TS,WD,WDN,WG,WGN,WS,WT,X1,X2,Y1,^TMP($J)
"RTN","PSGMAR",39,0)
 K PSGST,PSGTM,PSGTMALL,XTYPE,PSGLRPH,PSGMTYPE,PSGPG,PSGMFOR,PSGMTYPE,PSGPG,PSGRBPPN,PSGS0XT,PSGS0Y
"RTN","PSGMAR",40,0)
 K HT,ON,PSGOENOF,PSGOES,PSGRBPPN,PSGS0XT,PSGST,PSGTIR,PSGWD,XQUIT,ZTDES
"RTN","PSGMAR",41,0)
 D ENKV^PSGLOI
"RTN","PSGMAR",42,0)
 Q
"RTN","PSGMAR",43,0)
 ;
"RTN","PSGMAR",44,0)
G ; get ward group
"RTN","PSGMAR",45,0)
 S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select WARD GROUP: " W ! D ^DIC K DIC D  I $G(PSJSTOP)=1 Q
"RTN","PSGMAR",46,0)
 . I X="^OTHER" S PSGMARWG="^OTHER" Q
"RTN","PSGMAR",47,0)
 . S PSGMARWG=+Y
"RTN","PSGMAR",48,0)
 . I +Y'>0 S PSJSTOP=1
"RTN","PSGMAR",49,0)
 D RBPPN^PSJMDIR
"RTN","PSGMAR",50,0)
 Q
"RTN","PSGMAR",51,0)
 ;
"RTN","PSGMAR",52,0)
W ; get ward
"RTN","PSGMAR",53,0)
 S DIC="^DIC(42,",DIC(0)="QEAMI",DIC("A")="Select WARD: " W ! D ^DIC K DIC S PSGMARWD=+Y I +Y'>0 S PSJSTOP=1 Q
"RTN","PSGMAR",54,0)
 S PSGWD=PSGMARWD D ADMTM^PSJMDIR
"RTN","PSGMAR",55,0)
 D:'PSJSTOP RBPPN^PSJMDIR
"RTN","PSGMAR",56,0)
 Q
"RTN","PSGMAR",57,0)
 ;
"RTN","PSGMAR",58,0)
P ; get patient
"RTN","PSGMAR",59,0)
 K PSGPAT S PSGPAT=0 F CNTR=0:1 S:CNTR PSGDICA="another" D ENP^PSGGAO:'PSGMARB,ENDPT^PSGP:PSGMARB Q:PSGP'>0  D
"RTN","PSGMAR",60,0)
 . S PSGPAT(PSGP)="",PSGPAT=PSGP
"RTN","PSGMAR",61,0)
 . ;*** PSGMARWD=1 when all patients are select from the same ward.
"RTN","PSGMAR",62,0)
 . S:'$G(PSJPWDO) (PSGMARWD,PSJPWDO)=PSJPWD S PSGMARWD=$S('$G(PSGMARWD):0,PSJPWDO=PSJPWD:PSJPWD,1:0)
"RTN","PSGMAR",63,0)
 S Y=PSGPAT S:Y'>0 PSJSTOP=1 K PSGDICA
"RTN","PSGMAR",64,0)
 Q
"RTN","PSGMAR",65,0)
 ;
"RTN","PSGMAR",66,0)
C ;
"RTN","PSGMAR",67,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGMAR",68,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGMAR",69,0)
CDIC ;
"RTN","PSGMAR",70,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMAR",71,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGMAR",72,0)
 Q
"RTN","PSGMAR",73,0)
L ;
"RTN","PSGMAR",74,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGMAR",75,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGMAR",76,0)
LDIC ;
"RTN","PSGMAR",77,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMAR",78,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGMAR",79,0)
 Q
"RTN","PSGMAR",80,0)
DEV ; ask print device and queue if asked to
"RTN","PSGMAR",81,0)
 K ZTSAVE S PSGTIR="ENQ^PSGMAR",ZTDESC="24 HOUR MAR" S:PSGMARB ZTSAVE("PSGMARS")="" F X="PSGMARWG","PSGMARWD","PSGP","PSGPAT(","PSGDT","PSGMARDT","PSGSS","PSGMARB","PSGMARDF","PSGMTYPE","PSGRBPPN","^TMP($J," S ZTSAVE(X)=""
"RTN","PSGMAR",82,0)
 I $P(PSGMARDT,".",2) F X="PSGPLS","PSGPLF","PSGMARSD","PSGMARFD","PSGMARSP","PSGMARFP" S ZTSAVE(X)=""
"RTN","PSGMAR",83,0)
 I PSGSS="W" F X="PSGTMALL","PSGTM","PSGTM(" S ZTSAVE(X)=""
"RTN","PSGMAR",84,0)
 D ENDEV^PSGTI W:POP !!?3,"No device selected for 24 hour MAR run." W:$D(ZTSK) !?3,"24 hour MAR Queued!" K ZTSK Q
"RTN","PSGMAR",85,0)
 I 'IO("Q") U IO
"RTN","PSGMAR",86,0)
 ;
"RTN","PSGMAR",87,0)
BH ;
"RTN","PSGMAR",88,0)
 W !!,"  Enter a 'Y' to print BLANK (no data) MARs for the patient(s) you select.",!,"Enter an 'N' (or press the RETURN key) to print MARs complete with orders.",!,"Enter an  '^' to exit this option now." Q
"RTN","PSGMAR",89,0)
 ;
"RTN","PSGMAR",90,0)
DH ;
"RTN","PSGMAR",91,0)
 W !!?2,"Enter the START DATE of the 24 hour period for which this MAR is to print.",!,"Unless the BLANK MARs are selected, all orders for the patient(s) selected that",!,"are (or were) active during the date range selected will print."
"RTN","PSGMAR",92,0)
 W !?2,"Time is not required.  If time is not entered, the default time is used (if",!,"found in the site parameters).  If the default time is not found, the start of",!,"the day is used." Q
"RTN","PSGMAR",93,0)
 ;
"RTN","PSGMAR",94,0)
SHTH ;
"RTN","PSGMAR",95,0)
 W !!?2,"Enter 'C' to print ONLY CONTINUOUS blank sheets for the patients selected.",!,"Enter 'P' to print ONLY PRN sheets.  Enter 'B' (or press RETURN) to print BOTH",!,"sheets for each patient." Q
"RTN","PSGMAR",96,0)
 ;
"RTN","PSGMAR",97,0)
ENLM ;
"RTN","PSGMAR",98,0)
 ;NEW VADM,DRG,VAIN,PSJORD,ON,PSJL
"RTN","PSGMAR",99,0)
 S PSGOENOF=1,PSGPAT(PSGP)="",PSGSS="P" G EN
"RTN","PSGMAR0")
0^21^B31846437
"RTN","PSGMAR0",1,0)
PSGMAR0 ;BIR/CML3-GATHERS INFO FOR 24 HOUR MAR ;14 Oct 98 / 4:28 PM
"RTN","PSGMAR0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,15,20,111**;16 DEC 97
"RTN","PSGMAR0",3,0)
 ;
"RTN","PSGMAR0",4,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMAR0",5,0)
 ; Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSGMAR0",6,0)
 ; Reference to CUR^FHORD7 supported by DBIA #2019.
"RTN","PSGMAR0",7,0)
ENQ ;
"RTN","PSGMAR0",8,0)
 S PSGMSORT=$P($G(^PS(59.7,1,26)),U,4)
"RTN","PSGMAR0",9,0)
 K ^TMP($J) D NOW^%DTC S PSGDT=%,PSGMARWN="",PSJACNWP=1 D @("G"_PSGSS) I $D(^TMP($J))<10 U IO W:$Y @IOF W !!,"(No data found or 24 hour MAR run.)"
"RTN","PSGMAR0",10,0)
 ;
"RTN","PSGMAR0",11,0)
DONE ;
"RTN","PSGMAR0",12,0)
 K PSGMFOR
"RTN","PSGMAR0",13,0)
 Q
"RTN","PSGMAR0",14,0)
 ;
"RTN","PSGMAR0",15,0)
GG ; find individual wards in this ward group
"RTN","PSGMAR0",16,0)
 F PSGMARWD=0:0 S PSGMARWD=$O(^PS(57.5,"AC",PSGMARWG,PSGMARWD)) Q:'PSGMARWD  D GW
"RTN","PSGMAR0",17,0)
 Q
"RTN","PSGMAR0",18,0)
 ;
"RTN","PSGMAR0",19,0)
GW ; find patients in each ward
"RTN","PSGMAR0",20,0)
 I $D(^DIC(42,PSGMARWD,0)),$P(^(0),"^")]"" S PSGMARWN=$P(^(0),"^")
"RTN","PSGMAR0",21,0)
 E  Q
"RTN","PSGMAR0",22,0)
 I 'PSGMARWG S PSGMARWG=+$O(^PS(57.5,"AB",PSGMARWD,0))
"RTN","PSGMAR0",23,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGMARWN,PSGP)) Q:'PSGP  D PSJAC2^PSJAC(1),DTSET:'$P(PSGMARDT,".",2) D GPI
"RTN","PSGMAR0",24,0)
 Q
"RTN","PSGMAR0",25,0)
 ;
"RTN","PSGMAR0",26,0)
GP ; go thru selected patients
"RTN","PSGMAR0",27,0)
 F PSGP=0:0 S PSGP=$O(PSGPAT(PSGP)) Q:'PSGP  D PSJAC2^PSJAC(1),DTSET:'$P(PSGMARDT,".",2) D GPI
"RTN","PSGMAR0",28,0)
 Q
"RTN","PSGMAR0",29,0)
 ;
"RTN","PSGMAR0",30,0)
GL S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D GC
"RTN","PSGMAR0",31,0)
 Q
"RTN","PSGMAR0",32,0)
GC S PSGAPWDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGMAR0",33,0)
 S PSGCAD="" D DTSET:'$P(PSGMARDT,".",2)
"RTN","PSGMAR0",34,0)
 F  S PSGCAD=$O(^PS(55,"AIVC",PSGCAD)) Q:PSGCAD=""!(PSGCAD>PSGPLF)  D
"RTN","PSGMAR0",35,0)
 . S PSGP=0
"RTN","PSGMAR0",36,0)
 . F  S PSGP=$O(^PS(55,"AIVC",PSGCAD,CL,PSGP)) Q:PSGP=""  D PSJAC2^PSJAC(1),DTSET:'$P(PSGMARDT,".",2) S PSJPWDN="C!"_CL D GPI
"RTN","PSGMAR0",37,0)
 S PSGCAD=""
"RTN","PSGMAR0",38,0)
 F  S PSGCAD=$O(^PS(55,"AUDC",PSGCAD)) Q:PSGCAD=""!(PSGCAD>PSGPLF)  D
"RTN","PSGMAR0",39,0)
 . S PSGP=0
"RTN","PSGMAR0",40,0)
 . F  S PSGP=$O(^PS(55,"AUDC",PSGCAD,CL,PSGP)) Q:PSGP=""  D PSJAC2^PSJAC(1),DTSET:'$P(PSGMARDT,".",2) S PSJPWDN="C!"_CL D GPI
"RTN","PSGMAR0",41,0)
 Q
"RTN","PSGMAR0",42,0)
GPI ; get patient info
"RTN","PSGMAR0",43,0)
 ; PSGTMALL=1(sort by all team), PSGTM=1(individual team(S) selected).
"RTN","PSGMAR0",44,0)
 S TM="" S:PSGSS="P"!(PSGSS="C")!(PSGSS="L") PSGMARWN=$S(PSJPWDN]"":PSJPWDN,1:"NOT FOUND")
"RTN","PSGMAR0",45,0)
 S:PSJPRB="" PSJPRB="zz"
"RTN","PSGMAR0",46,0)
 S:"GPCL"[PSGSS!('$G(PSGTM)&'$G(PSGTMALL)) TM="zz"
"RTN","PSGMAR0",47,0)
 S:$G(TM)="" TM=$S(PSJPRB="zz":0,1:+$O(^PS(57.7,"AWRT",PSGMARWD,PSJPRB,0))),TM=$S('TM:"zz",'$D(^PS(57.7,PSGMARWD,1,TM,0)):TM,$P(^(0),"^")]"":$P(^(0),"^"),1:TM)
"RTN","PSGMAR0",48,0)
 Q:'$G(PSGTMALL)&$G(PSGTM)&'$D(PSGTM(TM))
"RTN","PSGMAR0",49,0)
 S PPN=$E($P(PSGP(0),"^"),1,15)_"^"_PSGP
"RTN","PSGMAR0",50,0)
 N SUB1,SUB2 S:PSGRBPPN="P" SUB1=PPN,SUB2=PSJPRB S:PSGRBPPN="R" SUB1=PSJPRB,SUB2=PPN
"RTN","PSGMAR0",51,0)
 I PSGMARB=1 D SPN Q
"RTN","PSGMAR0",52,0)
 I PSGMTYPE[1 F XTYPE=2:1:6 D @XTYPE
"RTN","PSGMAR0",53,0)
 I PSGMTYPE'[1 F XTYPE=2:1:6 D:PSGMTYPE[XTYPE @XTYPE
"RTN","PSGMAR0",54,0)
 D ^PSGMMAR5
"RTN","PSGMAR0",55,0)
 D:$S(PSGSS["P"!(PSGSS="C")!(PSGSS="L"):$D(^TMP($J,PPN)),1:$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2))) SPN
"RTN","PSGMAR0",56,0)
 Q
"RTN","PSGMAR0",57,0)
 ;
"RTN","PSGMAR0",58,0)
2 ;Loop thru UD orders       
"RTN","PSGMAR0",59,0)
 F PST="C","O","OC","P","R" F PSGMARED=PSGPLS-.0001:0 S PSGMARED=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED)) Q:'PSGMARED  F PSGMARO=0:0 S PSGMARO=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED,PSGMARO)) Q:'PSGMARO  D ORSET
"RTN","PSGMAR0",60,0)
 S PST="S" D ^PSGMIV
"RTN","PSGMAR0",61,0)
 Q
"RTN","PSGMAR0",62,0)
3 ;Loop thru IV orders that are Piggy back and Syringes types. 
"RTN","PSGMAR0",63,0)
 F PST="P","S" D ^PSGMIV
"RTN","PSGMAR0",64,0)
 Q
"RTN","PSGMAR0",65,0)
4 ;Loop thru IV orders(Additives).
"RTN","PSGMAR0",66,0)
 S PST="A" D ^PSGMIV
"RTN","PSGMAR0",67,0)
 Q
"RTN","PSGMAR0",68,0)
5 ;Loop thru IV orders(Hyperal).
"RTN","PSGMAR0",69,0)
 S PST="H" D ^PSGMIV
"RTN","PSGMAR0",70,0)
 Q
"RTN","PSGMAR0",71,0)
6 ;Loop thru IV order(Chemo).
"RTN","PSGMAR0",72,0)
 S PST="C" D ^PSGMIV
"RTN","PSGMAR0",73,0)
 Q
"RTN","PSGMAR0",74,0)
 ;
"RTN","PSGMAR0",75,0)
 ; PSGMFOR is set to bypass "fill on request" when call ^PSGPL0.
"RTN","PSGMAR0",76,0)
ORSET ; order record set
"RTN","PSGMAR0",77,0)
 S PSGMFOR="",ND2=$G(^PS(55,PSGP,5,PSGMARO,2)),(SD,X)=$P($P(ND2,"^",2),".") Q:X>PSGPLF  S FD=$P($P(ND2,"^",4),"."),T=$P(ND2,"^",6)
"RTN","PSGMAR0",78,0)
 S A=$G(^PS(55,PSGP,5,PSGMARO,8)) I $P(A,"^")]"" S PSGMARWN="C!"_$P(A,"^") I $G(SUB1)]"",$G(SUB2)]"",'$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2)) D SPN
"RTN","PSGMAR0",79,0)
 NEW MARX D DRGDISP^PSJLMUT1(PSGP,+PSGMARO_"U",20,0,.MARX,1)
"RTN","PSGMAR0",80,0)
 S DRG=MARX(1)_U_PSGMARO_"U",QST=$S(PST="C"!(PST="O"):PST,PST="OC":"OA",PST="P":"OP",$P(ND2,"^")["PRN":"OR",1:"CR")
"RTN","PSGMAR0",81,0)
 S X="" I "OB"]QST,$P(ND2,U)'["@",$P(ND2,U,2)'>PSGPLS,$P(ND2,U,4)'<PSGPLF,$P(ND2,U,5),$P(ND2,U,6)<1441,$P(ND2,U,6)'="D" S X=$P(ND2,U,5),PSGPLC=1
"RTN","PSGMAR0",82,0)
 E  I "OB"]QST S PSGPLO=PSGMARO K PSGMAR D ^PSGPL0 S (Q,X)="" F QX=0:0 S Q=$O(PSGMAR(Q)) Q:Q=""  S X=X_$E("0",2-$L(Q))_Q_"-"
"RTN","PSGMAR0",83,0)
 S X=$S(QST["C"!(QST["O"):$P(ND2,"^",5),1:"")_"^"_X
"RTN","PSGMAR0",84,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),$S(PSGMARWN'["C!":"A",1:PSGMARWN),DRG)=X Q
"RTN","PSGMAR0",85,0)
 S ^TMP($J,TM,PSGMARWN,SUB1,SUB2,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=X
"RTN","PSGMAR0",86,0)
 Q
"RTN","PSGMAR0",87,0)
 ;
"RTN","PSGMAR0",88,0)
SPN ; set patient node
"RTN","PSGMAR0",89,0)
 D DIET
"RTN","PSGMAR0",90,0)
 S X=$P(PSGP(0),U)_U_$E($P(PSJPDOB,U,2),1,10)_";"_PSJPAGE_U_VA("PID")_U_PSJPDX_U_PSJPWT_U_PSJPWTD_U_PSJPHT_U_PSJPHTD_U_$P(PSJPAD,U,2)_U_$P(PSJPTD,U,2)_U_$P(PSJPSEX,U,2)_U_PSJPWD_U_PSGPLS_U_PSGPLF_U_PSGMARSD_U_PSGMARFD_U_PSGMARSP_U_PSGMARFP
"RTN","PSGMAR0",91,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN)=X_U_PSGMARWN_U_PSJPRB Q
"RTN","PSGMAR0",92,0)
 S ^TMP($J,TM,PSGMARWN,SUB1,SUB2)=X
"RTN","PSGMAR0",93,0)
 Q
"RTN","PSGMAR0",94,0)
DIET ; Include abbr. diet label if indicated in the Site par.
"RTN","PSGMAR0",95,0)
 NEW ADM,DFN,PSJMPAR K PSJDIET
"RTN","PSGMAR0",96,0)
 S PSJMPAR=$G(^PS(59.7,1,26))
"RTN","PSGMAR0",97,0)
 Q:'$P(PSJMPAR,U,3)
"RTN","PSGMAR0",98,0)
 S DFN=PSGP,ADM=$G(^DPT("CN",PSGMARWN,DFN))
"RTN","PSGMAR0",99,0)
 I +ADM D CUR^FHORD7 S PSJDIET=Y
"RTN","PSGMAR0",100,0)
 Q
"RTN","PSGMAR0",101,0)
 ;
"RTN","PSGMAR0",102,0)
DTSET ;
"RTN","PSGMAR0",103,0)
 S (PSGPLS,PSGPLF)=PSGMARDT
"RTN","PSGMAR0",104,0)
 S PSJSYSW=$O(^PS(59.6,"B",+$G(PSJPWD),0))
"RTN","PSGMAR0",105,0)
 S:PSJSYSW PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSGMAR0",106,0)
 I $D(PSJSYSW0),$P(PSJSYSW0,"^",8) S ST=$P(PSJSYSW0,"^",8),FT=$P(PSJSYSW0,"^",9)
"RTN","PSGMAR0",107,0)
 E  S ST="0001",FT=24
"RTN","PSGMAR0",108,0)
SET S PSGMARSD=$E(ST,1,2),PSGMARFD=$E(FT,1,2) S:'PSGMARSD PSGMARSD="01" S PSGMARFD=$S(+PSGMARSD=1:24,PSGMARSD=PSGMARFD:PSGMARSD-1,1:PSGMARFD) S:$L(PSGMARFD)<2 PSGMARFD=0_PSGMARFD
"RTN","PSGMAR0",109,0)
 I ST>1 S X1=$P(PSGPLF,"."),X2=1 D C^%DTC S PSGPLF=X
"RTN","PSGMAR0",110,0)
 S PSGPLS=+(PSGPLS_"."_ST),PSGPLF=+(PSGPLF_"."_FT)
"RTN","PSGMAR0",111,0)
 S PSGMARSP=$$ENDTC2^PSGMI(PSGPLS),PSGMARFP=$$ENDTC2^PSGMI(PSGPLF)
"RTN","PSGMAR0",112,0)
 Q
"RTN","PSGMAR1")
0^117^B6611470
"RTN","PSGMAR1",1,0)
PSGMAR1 ;BIR/CML3-SORT ORDERS FOR 24 HOUR MAR ;22 JUL 96 / 7:06 AM
"RTN","PSGMAR1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,111**;16 DEC 97
"RTN","PSGMAR1",3,0)
 ;
"RTN","PSGMAR1",4,0)
 ;
"RTN","PSGMAR1",5,0)
SP ; start print
"RTN","PSGMAR1",6,0)
 U IO S (LN1,LN2,PSGOP,PN,RB,WDN,TM)="",PSGLSTOP=1,$P(LN1,"-",133)="",$P(LN2,"-",126)=""
"RTN","PSGMAR1",7,0)
 K BLN S BLN(1)=$E(LN1,1,20),BLN(2)=" Indicate RIGHT (R)",BLN(3)=" or LEFT (L)",BLN(4)=" 1. DELTOID",BLN(5)=" 2. ABDOMEN",BLN(6)=" 3. ILIAC CREST",BLN(7)=" 4. GLUTEAL",BLN(8)=" 5. THIGH",BLN(9)="PRN: E=Effective",BLN(10)="     N=Not Effective"
"RTN","PSGMAR1",8,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") D  Q
"RTN","PSGMAR1",9,0)
 . F  S PN=$O(^TMP($J,PN)) Q:PN=""  S PPN=^(PN),PWDN=$P(PPN,U,19),PRB=$P(PPN,U,20),PTM="zz" D PI,^PSGMAR2
"RTN","PSGMAR1",10,0)
 F  S (PTM,TM)=$O(^TMP($J,TM)) Q:TM=""  F  S (PWDN,WDN)=$O(^TMP($J,TM,WDN)) Q:WDN=""  D
"RTN","PSGMAR1",11,0)
 . I PSGRBPPN="P" F  S PN=$O(^TMP($J,TM,WDN,PN)) Q:PN=""  F  S (PRB,RB)=$O(^TMP($J,TM,WDN,PN,RB)) Q:RB=""  S PPN=^(RB) D PI,^PSGMAR2
"RTN","PSGMAR1",12,0)
 . I PSGRBPPN="R" F  S (PRB,RB)=$O(^TMP($J,TM,WDN,RB)) Q:RB=""  F  S PN=$O(^TMP($J,TM,WDN,RB,PN)) Q:PN=""  S PPN=^(PN) D PI,^PSGMAR2
"RTN","PSGMAR1",13,0)
 Q
"RTN","PSGMAR1",14,0)
 ;
"RTN","PSGMAR1",15,0)
PI ;
"RTN","PSGMAR1",16,0)
 K PSGMPG,PSGMPGN
"RTN","PSGMAR1",17,0)
 S:PTM="zz" PTM="NOT FOUND" S:PWDN="zz" PWDN="NOT FOUND" S:PRB="zz" PRB="NOT FOUND"
"RTN","PSGMAR1",18,0)
 S (PSGOP,PSGP)=+$P(PN,U,2),PSGP(0)=$P(PN,U),BD=$P(PPN,U,2),PSSN=$P(PPN,U,3),DX=$P(PPN,U,4),WT=$P(PPN,U,5)_" "_$P(PPN,U,6)
"RTN","PSGMAR1",19,0)
 S HT=$P(PPN,U,7)_" "_$P(PPN,U,8),AD=$P(PPN,U,9),TD=$P(PPN,U,10),PSEX=$P(PPN,U,11),PSGLWD=$P(PPN,U,12)
"RTN","PSGMAR1",20,0)
 S PSGPLS=$P(PPN,U,13),PSGPLF=$P(PPN,U,14),PSGMARSD=$P(PPN,U,15),PSGMARFD=$P(PPN,U,16),PSGMARSP=$P(PPN,U,17),PSGMARFP=$P(PPN,U,18)
"RTN","PSGMAR1",21,0)
 S PPN=$P(PPN,U),PAGE=$P(BD,";",2),BD=$P(BD,";"),DFN=PSGP
"RTN","PSGMAR1",22,0)
 D ATS^PSJMUTL(115,117,1)
"RTN","PSGMAR1",23,0)
 Q
"RTN","PSGMAR2")
0^22^B12041992
"RTN","PSGMAR2",1,0)
PSGMAR2 ;BIR/CML3-PRINT 24 HOUR MAR(UD) ;14 Oct 98 / 4:28 PM
"RTN","PSGMAR2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,111**;16 DEC 97
"RTN","PSGMAR2",3,0)
 ;
"RTN","PSGMAR2",4,0)
S1 I PSGMARB'=2 S:PSGMARS'=2 (PST,OPST)="C" D:PSGMARS'=2 HEADER^PSGMAR3,BOT^PSGMAR3 S:PSGMARS'=1 (PST,OPST)="P" D:PSGMARS'=1 HEADER^PSGMAR3,BOT^PSGMAR3 Q:PSGMARB=1
"RTN","PSGMAR2",5,0)
 D NOW^%DTC S PSGDT=%,(PST,OPST)=""
"RTN","PSGMAR2",6,0)
 S PSGMPG=0,PSGMPGN="PAGE: "
"RTN","PSGMAR2",7,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") D P Q
"RTN","PSGMAR2",8,0)
 D W
"RTN","PSGMAR2",9,0)
 Q
"RTN","PSGMAR2",10,0)
 ;
"RTN","PSGMAR2",11,0)
P ;***Print on Patient order
"RTN","PSGMAR2",12,0)
 I $O(^TMP($J,PN,0))'["C" S (PST,OPST)="C" D HEADER^PSGMAR3,BOT^PSGMAR3 S (PST,OPST)=""
"RTN","PSGMAR2",13,0)
 F  S PST=$O(^TMP($J,PN,PST)) Q:PST=""  D  D:$E(OPST)'=$E(PST) BOT^PSGMAR3:OPST]"" S OPST=PST
"RTN","PSGMAR2",14,0)
 . S PWDN="" F  S PWDN=$O(^TMP($J,PN,PST,PWDN)) Q:PWDN=""  D HEADER^PSGMAR3 S DAO="" F  S DAO=$O(^TMP($J,PN,PST,PWDN,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D PRT
"RTN","PSGMAR2",15,0)
 I $O(^TMP($J,PN,"CV6"))="" D BOT^PSGMAR3 S (PST,OPST)="O" D HEADER^PSGMAR3
"RTN","PSGMAR2",16,0)
 S PSGMPGN="LAST PAGE: " D BOT^PSGMAR3
"RTN","PSGMAR2",17,0)
 Q
"RTN","PSGMAR2",18,0)
 ;
"RTN","PSGMAR2",19,0)
W ;***Print Ward/Ward group
"RTN","PSGMAR2",20,0)
 I $S(PSGRBPPN="P":$O(^TMP($J,TM,WDN,PN,RB,0)),1:$O(^TMP($J,TM,WDN,RB,PN,0)))'["C" S (PST,OPST)="C" D HEADER^PSGMAR3,BOT^PSGMAR3 S (PST,OPST)=""
"RTN","PSGMAR2",21,0)
 D:PSGRBPPN="P" PPN D:PSGRBPPN="R" RB
"RTN","PSGMAR2",22,0)
 Q
"RTN","PSGMAR2",23,0)
 ;
"RTN","PSGMAR2",24,0)
PPN ;***Sort by Patient
"RTN","PSGMAR2",25,0)
 F  S PST=$O(^TMP($J,TM,WDN,PN,RB,PST)) Q:PST=""  D:$E(OPST)'=$E(PST) BOT^PSGMAR3:OPST]"",HEADER^PSGMAR3 S OPST=PST,DAO="" D
"RTN","PSGMAR2",26,0)
 . F  S DAO=$O(^TMP($J,TM,WDN,PN,RB,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D PRT
"RTN","PSGMAR2",27,0)
 I $O(^TMP($J,TM,WDN,PN,RB,"CV6"))="" D BOT^PSGMAR3 S (PST,OPST)="O" D HEADER^PSGMAR3
"RTN","PSGMAR2",28,0)
 S PSGMPGN="LAST PAGE: " D BOT^PSGMAR3
"RTN","PSGMAR2",29,0)
 Q
"RTN","PSGMAR2",30,0)
 ;
"RTN","PSGMAR2",31,0)
RB ;***Sort by Room bed
"RTN","PSGMAR2",32,0)
 F  S PST=$O(^TMP($J,TM,WDN,RB,PN,PST)) Q:PST=""  D:$E(OPST)'=$E(PST) BOT^PSGMAR3:OPST]"",HEADER^PSGMAR3 S OPST=PST,DAO="" D
"RTN","PSGMAR2",33,0)
 . F  S DAO=$O(^TMP($J,TM,WDN,RB,PN,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D PRT
"RTN","PSGMAR2",34,0)
 I $O(^TMP($J,TM,WDN,RB,PN,"CV6"))="" D BOT^PSGMAR3 S (PST,OPST)="O" D HEADER^PSGMAR3
"RTN","PSGMAR2",35,0)
 S PSGMPGN="LAST PAGE: " D BOT^PSGMAR3
"RTN","PSGMAR2",36,0)
 Q
"RTN","PSGMAR2",37,0)
 ;
"RTN","PSGMAR2",38,0)
PRT ; order info
"RTN","PSGMAR2",39,0)
 NEW MARLB,DRUGNAME,NAME
"RTN","PSGMAR2",40,0)
 S ON=$P(DAO,U,2)
"RTN","PSGMAR2",41,0)
 I +PSGMSORT,$S(ON["V":1,ON["P":$P($G(^PS(53.1,+ON,0)),U,4)="F",1:0) D PRT^PSGMIV Q
"RTN","PSGMAR2",42,0)
 D:PSGMAROC>5 ENB^PSGMAR3,HEADER^PSGMAR3 I PST["V" D PRT^PSGMIV Q
"RTN","PSGMAR2",43,0)
 ;* S TMSTR=$P(PSGMARTS,"^",2),PSGMARTS=$P(PSGMARTS,"^"),PSGORD=+$P(DAO,"^",2)_"A" D ^PSGLOI,TS^PSGMAR3(PSGMARTS),MARLB^PSGMUTL(47)
"RTN","PSGMAR2",44,0)
 ;*10/14 S TMSTR=$P(PSGMARTS,"^",2),PSGMARTS=$P(PSGMARTS,"^"),PSGORD=+$P(DAO,U,2)_$S(PST["Z":"P",1:"A") D ^PSGLOI,TS^PSGMAR3(PSGMARTS),MARLB^PSGMUTL(47)
"RTN","PSGMAR2",45,0)
 S TMSTR=$P(PSGMARTS,"^",2),PSGMARTS=$P(PSGMARTS,"^"),PSGORD=$P(DAO,U,2) S:PSGORD["P" PSJPSTO=PST,PST=$S(+PSGMSORT:"CZ",1:PST) D ^PSGLOI,TS^PSGMAR3(PSGMARTS),MARLB^PSGMUTL(47)
"RTN","PSGMAR2",46,0)
 I (PSGMAROC>4&(MARLB>6))!(TS/6>6)!((TS/6+PSGMAROC)>6) D BOT^PSGMAR3,HEADER^PSGMAR3
"RTN","PSGMAR2",47,0)
 S PSGMAROC=PSGMAROC+1
"RTN","PSGMAR2",48,0)
 NEW PSGX F PSGX=1:1:MARLB W !,MARLB(PSGX) W:PST["C" ?48,"|",$G(TS(PSGX)) D PRT2
"RTN","PSGMAR2",49,0)
 I $D(PSJPSTO) S PST=PSJPSTO K PSJPSTO
"RTN","PSGMAR2",50,0)
 Q
"RTN","PSGMAR2",51,0)
PRT2 ;
"RTN","PSGMAR2",52,0)
 W ?55,"|"
"RTN","PSGMAR2",53,0)
 ;* I PSGX=3,PST["C" D TMSTR^PSGMAR3
"RTN","PSGMAR2",54,0)
 I PSGX=3,(PST'["Z"),(PST["C") D TMSTR^PSGMAR3
"RTN","PSGMAR2",55,0)
 I PSGMAROC>5,(TS/6>7) D
"RTN","PSGMAR2",56,0)
 . S MSG1="*** CONTINUE ON NEXT PAGE ***"
"RTN","PSGMAR2",57,0)
 . D BOT^PSGMAR3,HEADER^PSGMAR3
"RTN","PSGMAR2",58,0)
 I PSGX#6=0 W:PSGMAROC<6 !?7,LN2 S:PSGX'=MARLB PSGMAROC=PSGMAROC+1
"RTN","PSGMAR2",59,0)
 Q
"RTN","PSGMAR3")
0^23^B17619773
"RTN","PSGMAR3",1,0)
PSGMAR3 ;BIR/CML3-24 HOUR MAR(HEADER,BOT) ;14 Oct 98 / 4:28 PM
"RTN","PSGMAR3",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,20,85,111**;16 DEC 97
"RTN","PSGMAR3",3,0)
 ;
"RTN","PSGMAR3",4,0)
 ;
"RTN","PSGMAR3",5,0)
HEADER ; pat info
"RTN","PSGMAR3",6,0)
 S:'$G(PSGXDT) PSGXDT=PSGDT
"RTN","PSGMAR3",7,0)
 S PSGFORM="VA FORM 10-"_$S(PST["C":"2970",1:"5568d")
"RTN","PSGMAR3",8,0)
 S PSGMAROC=0,(MSG1,MSG2)="",PSGL=$E("|",PST["C")_" " W:$G(PSGPG)&($Y) @IOF S PSGPG=1 W !,$S(PST["C":"CONTINUOUS",1:"ONE-TIME/PRN")_" SHEET",?60,"24 HOUR MAR",?86,PSGMARSP_"  through  "_PSGMARFP
"RTN","PSGMAR3",9,0)
 W !?5,$P($$SITE^PSGMMAR2(80),U,2),?101,"Printed on   "_$$ENDTC2^PSGMI(PSGXDT)
"RTN","PSGMAR3",10,0)
 W !?5,"Name:  "_PPN,?62,"Weight (kg): "_WT,?103,"Loc: "_$S(PWDN'["C!":PWDN,1:$P($G(^SC($P(PWDN,"!",2),0)),"^"))
"RTN","PSGMAR3",11,0)
 W !?6,"PID:  "_PSSN,?25,"DOB: "_BD_"  ("_PAGE_")",?62,"Height (cm): "_HT,?99,"Room-Bed: "_$S(PWDN'["C!":PRB,1:"")
"RTN","PSGMAR3",12,0)
 W !?6,"Sex:  "_PSEX,?25," Dx: "_DX,?$S(TD:94,1:99),$S(TD:"Last Transfer: "_TD,1:"Admitted: "_$S(PWDN'["C!":AD,1:""))
"RTN","PSGMAR3",13,0)
 I '$D(PSGALG) W !,"Allergies:  See attached list of Allergies/Adverse Reactions"
"RTN","PSGMAR3",14,0)
 NEW PSGX S PSGX=0 D ATS(.PSGX) D:PSGX HEADER Q:PSGX
"RTN","PSGMAR3",15,0)
 ;* W !,?49,"Admin" W !?1,"Order",?8,"Start",?20,"Stop",?49,"Times" W ?59 F X=PSGMARSD:1 S:X>24 X=1 W $S(X<10:0_X,1:X)," " Q:X=+PSGMARFD
"RTN","PSGMAR3",16,0)
 W !,?49,"Admin"
"RTN","PSGMAR3",17,0)
 W:$G(PSJDIET)]"" ?57,"Diet: ",PSJDIET
"RTN","PSGMAR3",18,0)
 W !?1,"Order",?8,"Start",?20,"Stop",?49,"Times" W ?59 F X=PSGMARSD:1 S:X>24 X=1 W $S(X<10:0_X,1:X)," " Q:X=+PSGMARFD
"RTN","PSGMAR3",19,0)
 W !,LN1
"RTN","PSGMAR3",20,0)
 Q
"RTN","PSGMAR3",21,0)
 ;
"RTN","PSGMAR3",22,0)
ATS(PSGX) ;*** Print allergies and reactions.
"RTN","PSGMAR3",23,0)
 I '$D(PSGALG),'$D(PSGVALG),'$D(PSGADR),'$D(PSGVADR) Q
"RTN","PSGMAR3",24,0)
 I (PSGALG+PSGADR+PSGVALG+PSGVADR)<116 D  Q
"RTN","PSGMAR3",25,0)
 . I PSGALG(1)["NKA",(PSGVALG(1)["NKA") S PSGALG(1)=""
"RTN","PSGMAR3",26,0)
 . I PSGALG=20,(PSGALG(1)["_______") S PSGALG(1)=""
"RTN","PSGMAR3",27,0)
 . I PSGALG(1)]"",(PSGVALG(1)["NKA") S PSGALG(1)=""
"RTN","PSGMAR3",28,0)
 . I PSGADR=20,(PSGADR(1)["_______") S PSGADR(1)=""
"RTN","PSGMAR3",29,0)
 . S:PSGVALG(1)="" PSGVALG(1)="No Allergy Assessment"
"RTN","PSGMAR3",30,0)
 . W !,"Allergies:  ",PSGVALG(1)," ",PSGALG(1),"   ADR: ",PSGVADR(1)," ",PSGADR(1)
"RTN","PSGMAR3",31,0)
 S PSGX=1
"RTN","PSGMAR3",32,0)
 W !!,"Verified Allergies:",!
"RTN","PSGMAR3",33,0)
 F X=0:0 S X=$O(PSGVALG(X)) Q:'X  W ?12,PSGVALG(X),!
"RTN","PSGMAR3",34,0)
 W !!,"Non-Verified Allergies:",!
"RTN","PSGMAR3",35,0)
 F X=0:0 S X=$O(PSGALG(X)) Q:'X  W ?12,PSGALG(X),!
"RTN","PSGMAR3",36,0)
 W !!,"Verified Adverse Reactions:",!
"RTN","PSGMAR3",37,0)
 F X=0:0 S X=$O(PSGVADR(X)) Q:'X  W ?12,PSGVADR(X),!
"RTN","PSGMAR3",38,0)
 W !!,"Non-Verified Adverse Reactions:",!
"RTN","PSGMAR3",39,0)
 F X=0:0 S X=$O(PSGADR(X)) Q:'X  W ?12,PSGADR(X),!
"RTN","PSGMAR3",40,0)
 K PSGALG,PSGADR,PSGVALG,PSGVADR
"RTN","PSGMAR3",41,0)
 Q
"RTN","PSGMAR3",42,0)
TMSTR ;*** Set up the Admin times to print across on the the 24 hour MAR.
"RTN","PSGMAR3",43,0)
 W ?59 S MPH=PSGPLS\1,(HRS,TIM)="" F MPH=1:1:$L(TMSTR,"-") S HRS=HRS_$E($P(TMSTR,"-",MPH),1,2)_"-"
"RTN","PSGMAR3",44,0)
 F Q=PSGMARSD:1 D:Q>24 ADD S:Q>24 Q=1 S QQ=$S(Q<10:"0"_Q,Q>24:"01",1:Q) S:HRS[QQ TIM=$P(HRS,"-",($F(HRS,QQ)/3)) S TIM=$S(HRS[QQ&(TIM=(QQ_"00")):QQ,HRS[QQ:TIM,1:"  ") W $S(MPH_"."_QQ'<PSGLFFD:"***",1:TIM_" ") Q:Q=+PSGMARFD
"RTN","PSGMAR3",45,0)
 K HRS,TIM,MPH Q
"RTN","PSGMAR3",46,0)
ADD ;
"RTN","PSGMAR3",47,0)
 S X1=$P(MPH,"."),X2=1 D C^%DTC S MPH=X
"RTN","PSGMAR3",48,0)
 Q
"RTN","PSGMAR3",49,0)
 ;
"RTN","PSGMAR3",50,0)
TS(X) ;
"RTN","PSGMAR3",51,0)
 K TS S TS=$S(PST["C":$L(X,"-"),1:0) F Q=1:1:$S(TS<6:6,1:TS) S TS(Q)=""
"RTN","PSGMAR3",52,0)
 S:TS=1 TS(3)=$P(X,"-")
"RTN","PSGMAR3",53,0)
 S:TS=2 TS(1)=$P(X,"-"),TS(5)=$P(X,"-",2)
"RTN","PSGMAR3",54,0)
 S:TS=3 TS(1)=$P(X,"-"),TS(3)=$P(X,"-",2),TS(5)=$P(X,"-",3)
"RTN","PSGMAR3",55,0)
 I TS>3 F Q=1:1:TS S TS(Q)=$P(X,"-",Q)
"RTN","PSGMAR3",56,0)
 Q
"RTN","PSGMAR3",57,0)
 ;
"RTN","PSGMAR3",58,0)
BOT ; bottom of MAR
"RTN","PSGMAR3",59,0)
 I MSG1]"" F QQ=1:1:6 W ! W:QQ=1 ?7,"|",?19,"|" W:34[QQ ?12,$S(QQ=3:MSG1,1:MSG2) W ?55,$S(1:"|",OPST'["C":LN5,QQ<6:LN4,1:LN7)
"RTN","PSGMAR3",60,0)
 I PSGMAROC<6 S PSGMAROC=6-PSGMAROC F Q=1:1:PSGMAROC F QQ=1:1:6 W ! W:QQ=1 ?7,"|",?19,"|" W:34[QQ ?12,$S(QQ=3:MSG1,1:MSG2) W ?55,$S(1:"",OPST'["C":LN5,QQ<6:LN4,1:LN7) I QQ=6,Q<PSGMAROC W !?7,LN2
"RTN","PSGMAR3",61,0)
ENB ;
"RTN","PSGMAR3",62,0)
 I $D(PSGMPG) S PSGMPG=PSGMPG+1 S PSGMPGN=$S(PSGMPGN'["LAST":"PAGE: ",1:PSGMPGN)_PSGMPG
"RTN","PSGMAR3",63,0)
 W !,LN1
"RTN","PSGMAR3",64,0)
 W !,"|",?12,"SIGNATURE/TITLE",?39,"| INIT |  ALLERGIES   |  INJECTION SITES   |",?87,"MED/DOSE OMITTED",?107,"|     REASON     | INIT |"
"RTN","PSGMAR3",65,0)
 F Q=1:1:10 W !,"|"_$E(LN1,1,38)_"|------|--------------|"_BLN(Q),?82,"|"_$E(LN1,1,24)_"|"_$E(LN1,1,16)_"|------|"
"RTN","PSGMAR3",66,0)
 W !,LN1,!?3,PPN,?45,PSSN,?58,"Room-Bed: "_$S(PWDN'["C!":PRB,1:""),?100,$S($D(PSGMPG):PSGMPGN,1:""),?116,PSGFORM
"RTN","PSGMAR3",67,0)
 Q
"RTN","PSGMIV")
0^24^B27367456
"RTN","PSGMIV",1,0)
PSGMIV ;BIR/MV-IV ORDER FOR THE 24 HOUR MAR. ;25 Nov 98 / 9:07 AM
"RTN","PSGMIV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,20,21,28,58,111**;16 DEC 97
"RTN","PSGMIV",3,0)
 ;
"RTN","PSGMIV",4,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMIV",5,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSGMIV",6,0)
 ;
"RTN","PSGMIV",7,0)
START ;*** Read IV orders
"RTN","PSGMIV",8,0)
 S ON=""
"RTN","PSGMIV",9,0)
 F PSGMARED=PSGPLS-.0001:0 S PSGMARED=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED)) Q:'PSGMARED  F  S ON=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED,ON)) Q:ON=""  D IV
"RTN","PSGMIV",10,0)
 Q
"RTN","PSGMIV",11,0)
IV ;*** Sort IV orders for 24 Hrs MAR.
"RTN","PSGMIV",12,0)
 K DRG,P N X,ON55,PSJLABEL S DFN=PSGP,PSJLABEL=1 D GT55^PSIVORFB
"RTN","PSGMIV",13,0)
 Q:P(2)>PSGPLF
"RTN","PSGMIV",14,0)
 S X=$P(P("MR"),U,2) Q:XTYPE=2&(X["IV")  Q:XTYPE=3&(PST="S")&'($S(X="IV":1,X="IVPB":1,1:0))
"RTN","PSGMIV",15,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGMIV",16,0)
 S QST=$S(P(9)["PRN":"OVP",QST="O":"OVO",1:"CV")_XTYPE
"RTN","PSGMIV",17,0)
 I DRG S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),X=$E($P(X,U,2),1,20)_U_ON_"V" D
"RTN","PSGMIV",18,0)
 . I PSGSS="P"!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),$S(PSGMARWN'["C!":"A",1:PSGMARWN),X)="" Q
"RTN","PSGMIV",19,0)
 . S:PSGRBPPN="P" ^TMP($J,TM,PSGMARWN,PPN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMIV",20,0)
 . S:PSGRBPPN="R" ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMIV",21,0)
 Q
"RTN","PSGMIV",22,0)
PRT ;*** Print IV orders.
"RTN","PSGMIV",23,0)
 K TS,P,DRG NEW ON55,LN,PSJLABEL S PSJLABEL=1
"RTN","PSGMIV",24,0)
 S ON=$P(DAO,U,2),DFN=$P(PN,U,2) D:ON["V" GT55^PSIVORFB
"RTN","PSGMIV",25,0)
 D:ON["P" GT531^PSIVORFA(DFN,ON)
"RTN","PSGMIV",26,0)
 S TS=1,TMSTR="" I P(9)]"" D ORSET,TS^PSGMAR3(P(11))
"RTN","PSGMIV",27,0)
 F X="LOG",2,3 S:P(X) P(X)=$$ENDTC1^PSGMI(P(X))
"RTN","PSGMIV",28,0)
 S PSGST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I PSGST'="O" S PSGST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSGMIV",29,0)
 S PSGLFFD=PSGPLF
"RTN","PSGMIV",30,0)
 D INITOPI^PSGMMIVC
"RTN","PSGMIV",31,0)
 NEW NAMENEED,NEED,X S NAMENEED=0
"RTN","PSGMIV",32,0)
 D LNNEED,PRTIV
"RTN","PSGMIV",33,0)
 Q
"RTN","PSGMIV",34,0)
LNNEED ;*** Find lined needed per label.
"RTN","PSGMIV",35,0)
 ;*** If OPI<29 char, it is ok to put INITs in the same line.
"RTN","PSGMIV",36,0)
 ;*** Add number lines needed for additives and solutions and 1 line
"RTN","PSGMIV",37,0)
 ;*** for infusion rate and x line for OPI. Divide by 5 to determine
"RTN","PSGMIV",38,0)
 ;*** of label(s) needed for this order.
"RTN","PSGMIV",39,0)
 F X="AD","SOL" D NAMENEED^PSJMUTL(X,47,.NEED) S NAMENEED=NAMENEED+NEED
"RTN","PSGMIV",40,0)
 S X=($L($P(P("OPI"),"^"))\47)+(($L($P(P("OPI"),"^"))#47)>28)+1+($P(P("OPI"),"^")]""&(P(4)="C"))
"RTN","PSGMIV",41,0)
 S X=(NAMENEED+X+2) S X=$S(X<6:1,1:((X-6)\5)+2)
"RTN","PSGMIV",42,0)
 S LN=$S(TS/6>X:TS/6,1:X)
"RTN","PSGMIV",43,0)
 Q
"RTN","PSGMIV",44,0)
 ;
"RTN","PSGMIV",45,0)
OS ; order record set
"RTN","PSGMIV",46,0)
 Q
"RTN","PSGMIV",47,0)
 ;
"RTN","PSGMIV",48,0)
PRTIV ;*** Print IV order on MAR
"RTN","PSGMIV",49,0)
 I PSGMAROC,(PSGMAROC+LN)>6 D BOT^PSGMAR3,HEADER^PSGMAR3
"RTN","PSGMIV",50,0)
 NEW PSGL S PSGL="|"
"RTN","PSGMIV",51,0)
 S PSGMAROC=PSGMAROC+1 W !?6,"|",?19,"|",?48,PSGL,$G(TS(1)),?55,"|"
"RTN","PSGMIV",52,0)
 W !,$E(P("LOG"),1,5)," |"
"RTN","PSGMIV",53,0)
 W:ON["V" $E(P(2),1,5)_$E(P(2),9,14)," |",P(3)
"RTN","PSGMIV",54,0)
 W:ON["P" "P E N D I N G"
"RTN","PSGMIV",55,0)
 W ?39,"(",$E(PSGP(0))_$E(PSSN,8,12)_")"
"RTN","PSGMIV",56,0)
 W ?48,PSGL,$G(TS(2)),?55,"|" S L=3
"RTN","PSGMIV",57,0)
 NEW NAME,PSIVX
"RTN","PSGMIV",58,0)
 F PSIVX=0:0 S PSIVX=$O(DRG("AD",PSIVX)) Q:'PSIVX  D NAME^PSIVUTL(DRG("AD",PSIVX),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  W !,NAME(Y) W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:(PSIVX=1&((PSGST="O")!(PSGST="C"))) TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",59,0)
 W:$G(DRG("SOL",0)) !,"in "
"RTN","PSGMIV",60,0)
 NEW PSJPRT2
"RTN","PSGMIV",61,0)
 F PSIVX=0:0 S PSIVX=$O(DRG("SOL",PSIVX)) Q:'PSIVX  D NAME^PSIVUTL(DRG("SOL",PSIVX),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  D
"RTN","PSGMIV",62,0)
 . W:(Y>1!(PSIVX>1)) ! W ?4,NAME(Y) W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:L=3 TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",63,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",PSIVX),0),U,4) I PSJPRT2]"" W !?7,PSJPRT2 W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:L=3 TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",64,0)
 W !,$P(P("MR"),U,2)," ",P(9)," ",P(8) W ?48,PSGL,$G(TS(L)),?55,"|" I L>5,(L#5) W !
"RTN","PSGMIV",65,0)
 I '$O(DRG("AD",0))!('$O(DRG("SOL",0))) W !?48,PSGL,$G(TS(L)),?55,"|" S L=5
"RTN","PSGMIV",66,0)
 I P(4)="C",'(L#5),P("OPI")="" W !,"*CAUTION-CHEMOTHERAPY*" S L=L+1 Q
"RTN","PSGMIV",67,0)
 I P(4)="C" D L(1) W !,"*CAUTION-CHEMOTHERAPY*",?48,PSGL,$G(TS(L)),?55,"|"
"RTN","PSGMIV",68,0)
 I (L#5)=0,($L($P(P("OPI"),"^"))<29),(TS<7) S L=L+1
"RTN","PSGMIV",69,0)
 E  D L(1)
"RTN","PSGMIV",70,0)
 W:P("OPI")=""&(TS>6) !
"RTN","PSGMIV",71,0)
 I P("OPI")'="" D
"RTN","PSGMIV",72,0)
 . W:(L#6)=1 !
"RTN","PSGMIV",73,0)
 . F Y=1:1:$L($P(P("OPI"),"^")," ") S Y1=$P($P(P("OPI"),"^")," ",Y) D  W Y1," "
"RTN","PSGMIV",74,0)
 . I ($X+$L(Y1))>47 W ?48,PSGL,$G(TS(L)),?55,"|" D L(1) W !
"RTN","PSGMIV",75,0)
 I L>TS,(L#6) W ?48,PSGL,$G(TS(L)),?55,"|" S L=L+1 W:L#6=0 !
"RTN","PSGMIV",76,0)
 I (TS-1)>L W ?48,PSGL,$G(TS(L)),?55,"|" D
"RTN","PSGMIV",77,0)
 . F L=L+1:1:TS-1 D L(0) W !?48,PSGL,$G(TS(L)),?55,"|"
"RTN","PSGMIV",78,0)
 . S L=L+1
"RTN","PSGMIV",79,0)
 F  Q:'(L#6)  W !?48,PSGL,$G(TS(L)),?55,"|" S L=L+1
"RTN","PSGMIV",80,0)
 I '(L#6),(P("OPI")="") W !
"RTN","PSGMIV",81,0)
 I P("OPI")]"",(L>6) W !
"RTN","PSGMIV",82,0)
 W ?29,"RPH: ",PSGLRPH,?38,"RN: ",PSGLRN,?48,PSGL,$G(TS(L)),?55,"|" W:PSGMAROC<6 !?7,LN2
"RTN","PSGMIV",83,0)
 Q
"RTN","PSGMIV",84,0)
 ;
"RTN","PSGMIV",85,0)
L(X) ;***Check to see if a new block if needed.
"RTN","PSGMIV",86,0)
 S L=L+X
"RTN","PSGMIV",87,0)
 I L#6=0,PSGMAROC<6 W !,"See next label for continuation",?48,PSGL,$G(TS(L)),?55,"|" W:PSGMAROC<6 !?7,LN2 S PSGMAROC=PSGMAROC+1,L=L+1 D
"RTN","PSGMIV",88,0)
 .I LN>6,(PSGMAROC>5) S MSG1="*** CONTINUE ON NEXT PAGE ***" D BOT^PSGMAR3,HEADER^PSGMAR3 S PSGMAROC=1
"RTN","PSGMIV",89,0)
 Q
"RTN","PSGMIV",90,0)
ORSET ; order record set
"RTN","PSGMIV",91,0)
 Q:PST["P"!P(9)=""
"RTN","PSGMIV",92,0)
 S PSGMFOR="",(SD,X)=$P(P(2),".") Q:X>PSGPLF  S FD=$P(P(3),"."),PSGOES="",X=P(9) D EN^PSGS0 S T=PSGS0XT
"RTN","PSGMIV",93,0)
 S X="" I "OB"]PST,$P(P(9),"^")'["@",P(2)'>PSGPLS,P(3)'<PSGPLF,P(11),T<1441,T'="D" S X=P(11),PSGPLC=1
"RTN","PSGMIV",94,0)
 E  I "OB"]PST!(PST["OV") K PSGMAR D SETL0 S (Q,X)="" F QX=0:0 S Q=$O(PSGMAR(Q)) Q:Q=""  S X=X_$E("0",2-$L(Q))_Q_"-"
"RTN","PSGMIV",95,0)
 S TMSTR=X
"RTN","PSGMIV",96,0)
 K HCD,HM,I,J,PSGD,PLSD,CD,M,MID,MN,ND,ND1,OD,ST,QD1,QD2,QQ,TS,UD,WDT,WS,WS1,X,X1,X2 Q
"RTN","PSGMIV",97,0)
 Q
"RTN","PSGMIV",98,0)
SETL0 ;*** Set variable to use in ^PSGPL0 to calculate admin time.
"RTN","PSGMIV",99,0)
 K PSGMAR S PSGPLC=0
"RTN","PSGMIV",100,0)
 S ND1=P(4),ST=P(2),PLSD=P(3),TS=P(11),MN=T,ND=P(9) I $S(ST'?7N1"."1N.E:1,1:PLSD'?7N1"."1N.E) S PSGPLC="OI" Q
"RTN","PSGMIV",101,0)
 D ENIV^PSGPL0
"RTN","PSGMIV",102,0)
 Q
"RTN","PSGMIV",103,0)
 ;
"RTN","PSGMIV",104,0)
RPHINIT(RPH) ; Find initial for the person who completed the IV order.
"RTN","PSGMIV",105,0)
 ;S RPH="" S:$D(^XUSEC("PSJ RPHARM",+P("CLRK"))) RPH=$$DEFINIT(+P("CLRK"))
"RTN","PSGMIV",106,0)
 ;Q:RPH]""
"RTN","PSGMIV",107,0)
 ;NEW X S X=$G(^PS(55,PSGP,"IV",+ON,"A",1,0)),RPH="_____" Q:X=""
"RTN","PSGMIV",108,0)
 ;I $P(X,U,4)["Completed" S X=$O(^VA(200,"B",$P(X,U,3),0)) S RPH=$$DEFINIT(+X)
"RTN","PSGMIV",109,0)
 S RPH=$P($G(^PS(55,PSGP,"IV",+ON,4)),U,4)
"RTN","PSGMIV",110,0)
 S:+RPH RPH=$$DEFINIT(+RPH)
"RTN","PSGMIV",111,0)
 I RPH="" S RPH="_____"
"RTN","PSGMIV",112,0)
 Q
"RTN","PSGMIV",113,0)
DEFINIT(X)         ;
"RTN","PSGMIV",114,0)
 S X=$G(^VA(200,X,0)),RPH=$P(X,U,2) Q:RPH]"" RPH
"RTN","PSGMIV",115,0)
 S X=$P(X,U),RPH=$E(X,$F(X,","))_$E(X) Q RPH
"RTN","PSGMMAR")
0^25^B25599735
"RTN","PSGMMAR",1,0)
PSGMMAR ;BIR/CML3-MULTIPLE DAY MARS - MAIN DRIVER ;14 Oct 98 / 4:28 PM
"RTN","PSGMMAR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**15,20,110,111**;16 DEC 97
"RTN","PSGMMAR",3,0)
 F  R !!,"HOW MANY DAYS? (7/14) ",PSGMARDF:DTIME S:'$T PSGMARDF="^" Q:"^"[PSGMARDF  Q:PSGMARDF=7!(PSGMARDF=14)  W $C(7),"  7 OR 14 DAY MAR!!"
"RTN","PSGMMAR",4,0)
 G:"^"[PSGMARDF DONE G EN
"RTN","PSGMMAR",5,0)
 ;
"RTN","PSGMMAR",6,0)
EN7 ;
"RTN","PSGMMAR",7,0)
 S PSGMARDF=7 G EN
"RTN","PSGMMAR",8,0)
 ;
"RTN","PSGMMAR",9,0)
EN14 ;
"RTN","PSGMMAR",10,0)
 S PSGMARDF=14
"RTN","PSGMMAR",11,0)
 ;
"RTN","PSGMMAR",12,0)
EN ;
"RTN","PSGMMAR",13,0)
 NEW DRUGNAME,F,MARLB,NAME,UP,PSGOP
"RTN","PSGMMAR",14,0)
 D ENCV^PSGSETU G:$D(XQUIT) DONE K PSGMAROF
"RTN","PSGMMAR",15,0)
 ;
"RTN","PSGMMAR",16,0)
EN1 ;
"RTN","PSGMMAR",17,0)
 D MARFORM^PSGMUTL G:'PSGMARB DONE
"RTN","PSGMMAR",18,0)
 ;
"RTN","PSGMMAR",19,0)
ENOE ;
"RTN","PSGMMAR",20,0)
 D SD^PSGMMARH W ! D ^DIR K DIR,DTOUT,DUOUT,DIRUT,DIROUT G:"^"[$E(Y) DONE S PSGMARS=$F("CPBO",Y)-1
"RTN","PSGMMAR",21,0)
 ;
"RTN","PSGMMAR",22,0)
DATE ;
"RTN","PSGMMAR",23,0)
 S %DT="ETSX",Y=-1 F  W !!,"Enter START DATE/TIME for "_PSGMARDF_" day MAR: " R X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" DH^PSGMMARH D ^%DT Q:Y>0
"RTN","PSGMMAR",24,0)
 I Y'>0 W $C(7),!!?5,"(No date selected, or MAR run.)" G DONE
"RTN","PSGMMAR",25,0)
 S PSGMARSD=+Y,X1=$P(+Y,"."),X2=PSGMARDF-1 D C^%DTC S PSGMARFD=X
"RTN","PSGMMAR",26,0)
 D NOW^%DTC S PSGDT=%,(PSGMARWG,PSJPWDO)=0,PSGRBPPN="",PSGMARWD=+$G(PSJPWD)
"RTN","PSGMMAR",27,0)
 I '$G(PSGMAROF),'$G(PSGOENOF)!($G(PSGSS)="") S (PSGP,PSGPAT,PSGMARWD)=0,PSGSSH="MAR" D ^PSGSEL G:"^"[PSGSS OUT D @PSGSS G:$G(PSJSTOP) OUT
"RTN","PSGMMAR",28,0)
 I PSGMARB'=1 G:$$MEDTYPE^PSJMDIR(PSGMARWD) OUT S PSGMTYPE=Y
"RTN","PSGMMAR",29,0)
 D DEV I POP!$D(IO("Q")) G DONE
"RTN","PSGMMAR",30,0)
 ;
"RTN","PSGMMAR",31,0)
ENQ ; when queued
"RTN","PSGMMAR",32,0)
 N DRGI,DRGN,DRGT,LN,P,PSIVUP,PSJORIFN,PSGMSORT
"RTN","PSGMMAR",33,0)
 D ^PSGMMAR0 I $D(^TMP($J))>9 D ^PSGMMAR1 K ^TMP($J)
"RTN","PSGMMAR",34,0)
 D ^%ZISC G DONE
"RTN","PSGMMAR",35,0)
 ;
"RTN","PSGMMAR",36,0)
OUT W $C(7),!!?5,"(No patient(s) selected for MAR run.)" K PSGPLF,PSGPLS
"RTN","PSGMMAR",37,0)
DONE ;
"RTN","PSGMMAR",38,0)
 ;* I '$D(PSGOENOF),'$D(PSGVBY) D ENKV^PSGSETU K PSGOP
"RTN","PSGMMAR",39,0)
 I '$D(PSGOENOF),'$D(PSGVBY) D ENKV^PSGSETU
"RTN","PSGMMAR",40,0)
 K:'$D(PSGVBY) PSGSS,PSGSSH
"RTN","PSGMMAR",41,0)
 D ENKV^PSGLOI
"RTN","PSGMMAR",42,0)
 K AD,ASTERS,BD,BLN,CNTR,DA1,DA2,DAO,DIC,DRG,DX,EXPIRE,FD,HX,L,LN1,LN14,LN2,LN3,LN31,LN32,LN4,LN5,LN6,LN7
"RTN","PSGMMAR",43,0)
 K MOS,MSG1,MSG2,N,ND2,NAMENEED,NEED,OPST,PSJJORD,PAGE,PN,PND,PNN,PPN,PRB,PSEX,PSSN,PSGMAPA,PSGMAPB,PSGMAPC,PSGMAPD,PSGADR,PSGALG,PSGS0Y,PSGXDT
"RTN","PSGMMAR",44,0)
 K PSGD,PSGDW,PSGMAR,PSGMARB,PSGMARDF,PSGMARED,PSGMARGD,PSGMARFD,PSGMARFP,PSGMAROC,PSGMAROF,PSGMARPT,PSGMARS,PSGMARSD,PSGMARSM,PSGMARSP
"RTN","PSGMMAR",45,0)
 K PSGMARTS,PSGMARWD,PSGMARWG,PSGMARWN,PSGMARWS,PSGMPG,PSGMPGN,PSGORD,PSGPAT,PSJDIET
"RTN","PSGMMAR",46,0)
 K DFN,NG,NO,ON,PST,PTM,PWDN,QST,PSJACNWP,R,RB,RCT,S,SD,SM,SPACES,TM,T,TD,TS,WD,WDN,WG,WGN,WS,WT,X1,X2,Y1
"RTN","PSGMMAR",47,0)
 K PSJSTOP,PSJPWDO,PSGMARO,PSGMTYPE,PSGTM,PSGTMALL,XTYPE,PSGLRPH,PSGPG
"RTN","PSGMMAR",48,0)
 K HT,PSGOENOF,PSGOES,PSGRBPPN,PSGS0XT,PSGST,PSGTIR,PSGWD,XQUIT,ZTDESC
"RTN","PSGMMAR",49,0)
 Q
"RTN","PSGMMAR",50,0)
 ;
"RTN","PSGMMAR",51,0)
G ;
"RTN","PSGMMAR",52,0)
 S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select WARD GROUP: " W ! D ^DIC K DIC D  I $G(PSJSTOP)=1 Q
"RTN","PSGMMAR",53,0)
 . I X="^OTHER" S PSGMARWG="^OTHER" Q
"RTN","PSGMMAR",54,0)
 . S PSGMARWG=+Y
"RTN","PSGMMAR",55,0)
 . I +Y'>0 S PSJSTOP=1
"RTN","PSGMMAR",56,0)
 D RBPPN^PSJMDIR
"RTN","PSGMMAR",57,0)
 Q
"RTN","PSGMMAR",58,0)
 ;
"RTN","PSGMMAR",59,0)
W ;
"RTN","PSGMMAR",60,0)
 S DIC="^DIC(42,",DIC(0)="QEAMI",DIC("A")="Select WARD: " W ! D ^DIC K DIC S PSGMARWD=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMMAR",61,0)
 S PSGWD=PSGMARWD D ADMTM^PSJMDIR S Y=PSGMARWD
"RTN","PSGMMAR",62,0)
 D:'PSJSTOP RBPPN^PSJMDIR
"RTN","PSGMMAR",63,0)
 Q
"RTN","PSGMMAR",64,0)
 ;
"RTN","PSGMMAR",65,0)
P ;
"RTN","PSGMMAR",66,0)
 K PSGPAT S PSGPAT=0 F CNTR=0:1 S:CNTR PSGDICA="another" D ENP^PSGGAO:'PSGMARB,ENDPT^PSGP:PSGMARB Q:PSGP'>0  D
"RTN","PSGMMAR",67,0)
 . S PSGPAT(PSGP)="",PSGPAT=PSGP
"RTN","PSGMMAR",68,0)
 . ;*** PSGMARWD=1 when all patients are select from the same ward.
"RTN","PSGMMAR",69,0)
 . S:'$G(PSJPWDO) (PSGMARWD,PSJPWDO)=PSJPWD S PSGMARWD=$S('$G(PSGMARWD):0,PSJPWDO=PSJPWD:PSJPWD,1:0)
"RTN","PSGMMAR",70,0)
 S Y=PSGPAT S:Y'>0 PSJSTOP=1 K PSGDICA
"RTN","PSGMMAR",71,0)
 Q
"RTN","PSGMMAR",72,0)
 ;
"RTN","PSGMMAR",73,0)
C ;
"RTN","PSGMMAR",74,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGMMAR",75,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGMMAR",76,0)
CDIC ;
"RTN","PSGMMAR",77,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMMAR",78,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGMMAR",79,0)
 Q
"RTN","PSGMMAR",80,0)
L ;
"RTN","PSGMMAR",81,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGMMAR",82,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGMMAR",83,0)
LDIC ;
"RTN","PSGMMAR",84,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMMAR",85,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGMMAR",86,0)
 Q
"RTN","PSGMMAR",87,0)
DEV ;
"RTN","PSGMMAR",88,0)
 K ZTSAVE S PSGTIR="ENQ^PSGMMAR",ZTDESC=PSGMARDF_" DAY MAR" F X="PSGMARWG","PSGMARWD","PSGP","PSGPAT(","PSGDT","PSGMARSD","PSGMARFD","PSGSS","PSGMARB","PSGMARDF","PSGMARS" S ZTSAVE(X)=""
"RTN","PSGMMAR",89,0)
 F X="PSGMTYPE","PSGRBPPN","^TMP($J," S ZTSAVE(X)=""
"RTN","PSGMMAR",90,0)
 I PSGSS="W" F X="PSGTMALL","PSGTM","PSGTM(" S ZTSAVE(X)=""
"RTN","PSGMMAR",91,0)
 D ENDEV^PSGTI W:POP !!?3,"No device selected for "_PSGMARDF_" day MAR run." W:$D(ZTSK) !?3,PSGMARDF_" Day MAR Queued!" K ZTSK Q
"RTN","PSGMMAR",92,0)
 I 'IO("Q") U IO
"RTN","PSGMMAR",93,0)
 ;
"RTN","PSGMMAR",94,0)
ENOR S PSGP=+ORVP
"RTN","PSGMMAR",95,0)
ENLM ;
"RTN","PSGMMAR",96,0)
 NEW VADM
"RTN","PSGMMAR",97,0)
 D ENCV^PSGSETU I $D(QUIT) K PSGMARDF Q
"RTN","PSGMMAR",98,0)
 D ^PSJAC S PSGPAT=1,PSGPAT(PSGP)="",PSGMAROF=1,PSGSS="P" G EN1
"RTN","PSGMMAR0")
0^26^B36138021
"RTN","PSGMMAR0",1,0)
PSGMMAR0 ;BIR/CML3-GATHERS INFO FOR MD CMR ;14 Oct 98 / 9:40 AM
"RTN","PSGMMAR0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,15,20,111**;16 DEC 97
"RTN","PSGMMAR0",3,0)
 ;
"RTN","PSGMMAR0",4,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMMAR0",5,0)
 ; Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSGMMAR0",6,0)
 ;
"RTN","PSGMMAR0",7,0)
ENQ ; start sort; where queue comes in at
"RTN","PSGMMAR0",8,0)
 N SUB1,SUB2 S (SUB1,SUB2)=""
"RTN","PSGMMAR0",9,0)
 S PSGMSORT=$P($G(^PS(59.7,1,26)),U,4)
"RTN","PSGMMAR0",10,0)
 K PSGD S X=$P(PSGMARSD,"."),PSGDW="" F Q=0:1:PSGMARDF-1 S X1=$P(PSGMARSD,"."),X2=Q D:Q C^%DTC S PSGD(X)=$E(X,4,5)_"/"_$E(X,6,7),HX=X D DW^%DTC S $P(PSGD(HX),U,2)=X
"RTN","PSGMMAR0",11,0)
 K ^TMP($J) D NOW^%DTC S PSGDT=%,PSGMARWN="",PSJACNWP=1 D @("G"_PSGSS)
"RTN","PSGMMAR0",12,0)
 ;* K ^TMP($J),PSJACNWP D NOW^%DTC S PSGDT=%,PSGMARWN="" D @("G"_PSGSS)
"RTN","PSGMMAR0",13,0)
 I $D(^TMP($J))<10 U IO W:$Y @IOF W !!,"(No data found or "_PSGMARDF_" day MAR run.)"
"RTN","PSGMMAR0",14,0)
 ;
"RTN","PSGMMAR0",15,0)
DONE ;
"RTN","PSGMMAR0",16,0)
 Q
"RTN","PSGMMAR0",17,0)
 ;
"RTN","PSGMMAR0",18,0)
GG ; find individual wards in this ward group
"RTN","PSGMMAR0",19,0)
 S ^TMP($J)=PSGMARWG F PSGMARWD=0:0 S PSGMARWD=$O(^PS(57.5,"AC",PSGMARWG,PSGMARWD)) Q:'PSGMARWD  D GW
"RTN","PSGMMAR0",20,0)
 Q
"RTN","PSGMMAR0",21,0)
 ;
"RTN","PSGMMAR0",22,0)
GW ; find patients in each ward
"RTN","PSGMMAR0",23,0)
 I $D(^DIC(42,PSGMARWD,0)),$P(^(0),U)]"" S PSGMARWN=$P(^(0),U)
"RTN","PSGMMAR0",24,0)
 E  Q
"RTN","PSGMMAR0",25,0)
 I 'PSGMARWG S PSGMARWG=+$O(^PS(57.5,"AB",PSGMARWD,0))
"RTN","PSGMMAR0",26,0)
 I $D(^TMP($J))[0,PSGMARWG S ^($J)=PSGMARWG
"RTN","PSGMMAR0",27,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGMARWN,PSGP)) Q:'PSGP  D PSJAC2^PSJAC(1) I PSGMARB!$O(^PS(55,PSGP,5,"AUS",PSGMARSD))!$O(^PS(55,PSGP,"IV","AIS",PSGMARSD)) D GPI
"RTN","PSGMMAR0",28,0)
 Q
"RTN","PSGMMAR0",29,0)
 ;
"RTN","PSGMMAR0",30,0)
GP ; go thru selected patients
"RTN","PSGMMAR0",31,0)
 F PSGP=0:0 S PSGP=$O(PSGPAT(PSGP)) Q:'PSGP  D PSJAC2^PSJAC(1) I PSGMARB!$O(^PS(55,PSGP,5,"AUS",PSGMARSD))!$O(^PS(55,PSGP,"IV","AIS",PSGMARSD)) D GPI
"RTN","PSGMMAR0",32,0)
 Q
"RTN","PSGMMAR0",33,0)
 ;
"RTN","PSGMMAR0",34,0)
GL S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D GC
"RTN","PSGMMAR0",35,0)
 Q
"RTN","PSGMMAR0",36,0)
GC S PSGAPWDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGMMAR0",37,0)
 S PSGP="" F  S PSGP=$O(^PS(53.1,"AD",CL,PSGP)) Q:PSGP=""  D PSJAC2^PSJAC(1)
"RTN","PSGMMAR0",38,0)
 S PSGCAD=PSGMARSD
"RTN","PSGMMAR0",39,0)
 F  S PSGCAD=$O(^PS(55,"AIVC",PSGCAD)) Q:PSGCAD=""  D
"RTN","PSGMMAR0",40,0)
 . S PSGP=0
"RTN","PSGMMAR0",41,0)
 . F  S PSGP=$O(^PS(55,"AIVC",PSGCAD,CL,PSGP)) Q:PSGP=""  D PSJAC2^PSJAC(1) S PSJPWDN="C!"_CL D GPI
"RTN","PSGMMAR0",42,0)
 S PSGCAD=PSGMARSD
"RTN","PSGMMAR0",43,0)
 F  S PSGCAD=$O(^PS(55,"AUDC",PSGCAD)) Q:PSGCAD=""  D
"RTN","PSGMMAR0",44,0)
 . S PSGP=0
"RTN","PSGMMAR0",45,0)
 . F  S PSGP=$O(^PS(55,"AUDC",PSGCAD,CL,PSGP)) Q:PSGP=""  D PSJAC2^PSJAC(1) S PSJPWDN="C!"_CL D GPI
"RTN","PSGMMAR0",46,0)
 Q
"RTN","PSGMMAR0",47,0)
 ;
"RTN","PSGMMAR0",48,0)
GPI ; get patient info
"RTN","PSGMMAR0",49,0)
 ; PSGTMALL=1(sort by all team), PSGTM=1(individual team(S) selected).
"RTN","PSGMMAR0",50,0)
 S TM="",PSGMARWN=PSJPWDN
"RTN","PSGMMAR0",51,0)
 S:PSJPRB="" PSJPRB="zz"
"RTN","PSGMMAR0",52,0)
 S:"GPCL"[PSGSS!('$G(PSGTM)&'$G(PSGTMALL)) TM="zz"
"RTN","PSGMMAR0",53,0)
 S:$G(TM)="" TM=$S(PSJPRB="zz":0,1:+$O(^PS(57.7,"AWRT",PSGMARWD,PSJPRB,0))),TM=$S('TM:"zz",'$D(^PS(57.7,PSGMARWD,1,TM,0)):TM,$P(^(0),U)]"":$P(^(0),U),1:TM)
"RTN","PSGMMAR0",54,0)
 Q:'$G(PSGTMALL)&$G(PSGTM)&'$D(PSGTM(TM))  ; Elimin. none selected team
"RTN","PSGMMAR0",55,0)
 S PPN=$E($P(PSGP(0),U),1,15)_U_PSGP
"RTN","PSGMMAR0",56,0)
 S:PSGRBPPN="P" SUB1=PPN,SUB2=PSJPRB S:PSGRBPPN="R" SUB1=PSJPRB,SUB2=PPN
"RTN","PSGMMAR0",57,0)
 I PSGMARB=1 D SPN Q
"RTN","PSGMMAR0",58,0)
 I PSGMTYPE[1 F XTYPE=2:1:6 D @XTYPE
"RTN","PSGMMAR0",59,0)
 I PSGMTYPE'[1 F XTYPE=2:1:6 D:PSGMTYPE[XTYPE @XTYPE
"RTN","PSGMMAR0",60,0)
 D ^PSGMMAR5
"RTN","PSGMMAR0",61,0)
 D:$S(PSGSS["P"!(PSGSS="L")!(PSGSS="C"):$D(^TMP($J,PPN)),1:$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2))) SPN
"RTN","PSGMMAR0",62,0)
 I $D(^TMP($J))'>10,(PSGMARB=3) D SPN
"RTN","PSGMMAR0",63,0)
 Q
"RTN","PSGMMAR0",64,0)
 ;
"RTN","PSGMMAR0",65,0)
2 ;Loop thru UD orders       
"RTN","PSGMMAR0",66,0)
 I PSGMARS'=2 F PST="C" F PSGMARED=PSGMARSD:0 S PSGMARED=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED)) Q:'PSGMARED  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED,ON)) Q:'ON  D OS
"RTN","PSGMMAR0",67,0)
 I PSGMARS'=1 F PST="O","OC","P" F PSGMARED=PSGMARSD:0 S PSGMARED=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED)) Q:'PSGMARED  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED,ON)) Q:'ON  D OS
"RTN","PSGMMAR0",68,0)
 S PST="R" F PSGMARED=PSGMARSD:0 S PSGMARED=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED)) Q:'PSGMARED  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED,ON)) Q:'ON  D OS
"RTN","PSGMMAR0",69,0)
 S PST="S" D ^PSGMMIV
"RTN","PSGMMAR0",70,0)
 Q
"RTN","PSGMMAR0",71,0)
3 ;Loop thru IV orders that are Piggy back and Syringes types.
"RTN","PSGMMAR0",72,0)
 F PST="P","S" D ^PSGMMIV
"RTN","PSGMMAR0",73,0)
 Q
"RTN","PSGMMAR0",74,0)
4 ;Loop thru IV orders(Admixtures).
"RTN","PSGMMAR0",75,0)
 S PST="A" D ^PSGMMIV
"RTN","PSGMMAR0",76,0)
 Q
"RTN","PSGMMAR0",77,0)
5 ;Loop thru IV orders(Hyperal).
"RTN","PSGMMAR0",78,0)
 S PST="H" D ^PSGMMIV
"RTN","PSGMMAR0",79,0)
 Q
"RTN","PSGMMAR0",80,0)
6 ;Loop thru IV order(Chemo).
"RTN","PSGMMAR0",81,0)
 S PST="C" D ^PSGMMIV
"RTN","PSGMMAR0",82,0)
 Q
"RTN","PSGMMAR0",83,0)
 ;
"RTN","PSGMMAR0",84,0)
OS ; order record set
"RTN","PSGMMAR0",85,0)
 N A
"RTN","PSGMMAR0",86,0)
 S ND2=$G(^PS(55,PSGP,5,ON,2)),SD=$P(ND2,U,2) I $S($P(SD,".")>PSGMARFD:1,PSGMARS=1:$P(ND2,U)["PRN",1:0) Q
"RTN","PSGMMAR0",87,0)
 S A=$G(^PS(55,PSGP,5,ON,8)) I $P(A,"^",2)]"" S PSGMARWN="C!"_$P(A,"^") I SUB1]"",SUB2]"",'$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2)) D SPN
"RTN","PSGMMAR0",88,0)
 S FD=$P($P(ND2,U,4),"."),T=$P(ND2,U,6)
"RTN","PSGMMAR0",89,0)
 NEW MARX D DRGDISP^PSJLMUT1(PSGP,+ON_"U",20,0,.MARX,1) S DRG=MARX(1)_$E(SD,2,7)_U_+ON_"U"
"RTN","PSGMMAR0",90,0)
 S QST=$S(PST="C"!(PST="O"):PST,PST="OC":"OA",PST="P":"OP",$P(ND2,U)["PRN":"OR",1:"CR")
"RTN","PSGMMAR0",91,0)
 S QQ="" I QST["C" D DTS($P(ND2,U)) S SD=$P(SD,"."),QQ="" F X=0:0 S X=$O(PSGD(X)) Q:'X  S QQ=QQ_$S(X<SD:"",X>FD:"",'S:$P(PSGD(X),U),$D(S(X)):$P(PSGD(X),U),1:"")
"RTN","PSGMMAR0",92,0)
 I $P(ND2,U,6)="D",$P(ND2,U,5)="" S $P(ND2,U,5)=$E($P($P(ND2,U,2),".",2)_"0000",1,4)
"RTN","PSGMMAR0",93,0)
 S X=$S(QST["C"!(QST="O"):$P(ND2,U,5),1:"")_U_QQ
"RTN","PSGMMAR0",94,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),$S(PSGMARWN'["C!":"A",1:PSGMARWN),DRG)=X Q
"RTN","PSGMMAR0",95,0)
 S ^TMP($J,TM,PSGMARWN,SUB1,SUB2,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=X
"RTN","PSGMMAR0",96,0)
 Q
"RTN","PSGMMAR0",97,0)
 ;
"RTN","PSGMMAR0",98,0)
DTS(SCHEDULE) ;
"RTN","PSGMMAR0",99,0)
 K S S S=0 I SCHEDULE["@"!(T="D") S WD=$S(SCHEDULE["@":$P(SCHEDULE,"@"),1:SCHEDULE) F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q  F QQ=1:1:$L(WD,"-") I $P($P(PSGD(Q),U,2),$P(WD,"-",QQ))="" S S(Q)="",S=S+1 Q
"RTN","PSGMMAR0",100,0)
 Q:SCHEDULE["@"!(T="D")  Q:T'>1440  S WD=$P(PSGMARSD,".") I '(T#1440) S (SD,X)=$P(SD,"."),PSGT=T\1440 F QQ=0:1 S X1=SD,X2=QQ*PSGT D:X2 C^%DTC I X'<WD S S=S+1 Q:X>PSGMARFD  Q:X>FD  S S(X)=""
"RTN","PSGMMAR0",101,0)
 K PSGT Q:'(T#1440)  S PSGT=T,X1=PSGMARSD,(ST,X2)=SD I PSGMARSD>SD D ^%DTC I X>1 S ST=$$EN^PSGCT(SD,X-1*1440\T*T)
"RTN","PSGMMAR0",102,0)
 S (PSGS,X)=ST F PSGX=0:1 S AM=PSGT*PSGX,ST=PSGS S:AM X=$$EN^PSGCT(ST,AM) S X=$P(X,".") I X'<WD Q:X>PSGMARFD  Q:X>FD  I '$D(S(X)) S S=S+1,S(X)=""
"RTN","PSGMMAR0",103,0)
 K AM,ST,PSGS,PSGT,PSGX Q
"RTN","PSGMMAR0",104,0)
 ;
"RTN","PSGMMAR0",105,0)
SPN ; set patient node
"RTN","PSGMMAR0",106,0)
 D DIET^PSGMAR0
"RTN","PSGMMAR0",107,0)
 S X=$P(PSGP(0),U)_U_$E($P(PSJPDOB,U,2),1,10)_";"_PSJPAGE_U_VA("PID")_U_PSJPDX_U_PSJPWT_U_PSJPWTD_U_PSJPHT_U_PSJPHTD_U_$P(PSJPAD,U,2)_U_$P(PSJPTD,U,2)_U_$P(PSJPSEX,U,2)_U_PSJPWD
"RTN","PSGMMAR0",108,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN)=X_U_PSGMARWN_U_PSJPRB Q
"RTN","PSGMMAR0",109,0)
 S ^TMP($J,TM,PSGMARWN,SUB1,SUB2)=X
"RTN","PSGMMAR0",110,0)
 Q
"RTN","PSGMMAR1")
0^118^B16034896
"RTN","PSGMMAR1",1,0)
PSGMMAR1 ;BIR/CML3-PRINTS MD MAR ;12 Mar 98 / 9:33 AM
"RTN","PSGMMAR1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,8,92,111**;16 DEC 97
"RTN","PSGMMAR1",3,0)
 ;
"RTN","PSGMMAR1",4,0)
 ;
"RTN","PSGMMAR1",5,0)
SP ; start print
"RTN","PSGMMAR1",6,0)
 U IO S WG=$S($D(^TMP($J))#2:+^($J),1:0),WGN=$S('$D(^PS(57.5,WG,0)):WG,$P(^(0),"^")]"":$P(^(0),"^"),1:WG),(LN1,LN2,PSGOP,PN,RB,WDN,TM)="",PSGLSTOP=1,$P(LN1,"-",133)="",$P(LN2,"-",126)=""
"RTN","PSGMMAR1",7,0)
 S MOS="JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC",(LN3,LN14,QQ)=""
"RTN","PSGMMAR1",8,0)
 F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q  S LN3=LN3_" "_$E("  ",1,PSGMARDF=7+1)_$S(PSGMARDF=7:$P(PSGD(Q),"^"),1:$E(Q,6,7))_$E("  ",1,PSGMARDF=7+1) S:PSGMARDF=7 QQ=Q I PSGMARDF=14 S LN14=LN14_"  "_$S($E(Q,4,5)'=$E(QQ,4,5):$P(MOS,"^",+PSGD(Q)),1:"   "),QQ=Q
"RTN","PSGMMAR1",9,0)
 S (LN4,LN7)="|" F Q=1:1:PSGMARDF S LN4=LN4_$E("_________",1,$S(PSGMARDF=7:9,1:4))_"|",LN7=LN7_$E("         ",1,$S(PSGMARDF=7:9,1:4))_"|"
"RTN","PSGMMAR1",10,0)
 S LN5="|-------|-------|----------------------|------|----------------------|------|",LN6="  DATE    TIME          REASON           INIT         RESULT           INIT"
"RTN","PSGMMAR1",11,0)
 S LN31="|--------|--------|-----------------------------------------|------|-----------------------|-----------------------|--------|------|"
"RTN","PSGMMAR1",12,0)
 S LN32="|        |        |                                       |       |                      |                      |        |       |"
"RTN","PSGMMAR1",13,0)
 K BLN S BLN(1)=$E(LN1,1,36),BLN(2)="   Indicate RIGHT (R) or LEFT (L)",BLN(3)="",BLN(4)="   (IM)                   (SUB Q)",BLN(5)="1. DELTOID             6. UPPER ARM",BLN(6)="2. VENTRAL GLUTEAL     7. ABDOMEN"
"RTN","PSGMMAR1",14,0)
 S BLN(7)="3. GLUTEUS MEDIUS      8. THIGH",BLN(8)="4. MID(ANTERIOR) THIGH 9. BUTTOCK",BLN(9)="5. VASTUS LATERALIS   10. UPPER BACK",BLN(10)=" PRN: E=Effective   N=Not Effective"
"RTN","PSGMMAR1",15,0)
 S ASTERS=$E("*********",1,PSGMARDF=7*5+4),EXPIRE=$S(PSGMARDF=14:"****",1:"*********"),SPACES=$E("         ",1,PSGMARDF=7*5+4) F X="PSGMARSD","PSGMARFD" S @($E(X,1,7)_"P")=$P($$ENDTC2^PSGMI(@X)," ")
"RTN","PSGMMAR1",16,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") F  S PN=$O(^TMP($J,PN)) Q:PN=""  D
"RTN","PSGMMAR1",17,0)
 .; naked ref below is from line above ^TMP($J,PN)
"RTN","PSGMMAR1",18,0)
 . S PPN=^(PN),PWDN=$P(PPN,U,13),PRB=$P(PPN,U,14),PTM="zz"
"RTN","PSGMMAR1",19,0)
 . D PI
"RTN","PSGMMAR1",20,0)
 . I PSGMARS'=2 D ^PSGMMAR2
"RTN","PSGMMAR1",21,0)
 . I PSGMARS'=1 D:(PSGMARS=2&(PSGMARB'=2)) BLANK^PSGMMAR3 D ^PSGMMAR3
"RTN","PSGMMAR1",22,0)
 F  S (PTM,TM)=$O(^TMP($J,TM)) Q:TM=""  F  S (PWDN,WDN)=$O(^TMP($J,TM,WDN)) Q:WDN=""  D
"RTN","PSGMMAR1",23,0)
 . I PSGRBPPN="P" F  S PN=$O(^TMP($J,TM,WDN,PN)) Q:PN=""  F  S (PRB,RB)=$O(^TMP($J,TM,WDN,PN,RB)) Q:RB=""  S PPN=^(RB) D PI,^PSGMMAR2:PSGMARS'=2,BLANK^PSGMMAR3:(PSGMARS=2&(PSGMARB'=2)),^PSGMMAR3:PSGMARS'=1
"RTN","PSGMMAR1",24,0)
 . I PSGRBPPN="R" F  S (PRB,RB)=$O(^TMP($J,TM,WDN,RB)) Q:RB=""  F  S PN=$O(^TMP($J,TM,WDN,RB,PN)) Q:PN=""  S PPN=^(PN) D PI,^PSGMMAR2:PSGMARS'=2,BLANK^PSGMMAR3:(PSGMARS=2&(PSGMARB'=2)),^PSGMMAR3:PSGMARS'=1
"RTN","PSGMMAR1",25,0)
 Q
"RTN","PSGMMAR1",26,0)
 ;
"RTN","PSGMMAR1",27,0)
PI ;
"RTN","PSGMMAR1",28,0)
 K PSGMPG,PSGMPGN
"RTN","PSGMMAR1",29,0)
 S:PTM="zz" PTM="NOT FOUND" S:PWDN="zz" PWDN="NOT FOUND" S:PRB="zz" PRB="NOT FOUND"
"RTN","PSGMMAR1",30,0)
 S (PSGOP,PSGP)=+$P(PN,U,2),PSGP(0)=$P(PN,U),BD=$P(PPN,U,2),PSSN=$P(PPN,U,3),DX=$P(PPN,U,4),WT=$P(PPN,U,5)_" "_$P(PPN,U,6)
"RTN","PSGMMAR1",31,0)
 S HT=$P(PPN,U,7)_" "_$P(PPN,U,8),AD=$P(PPN,U,9)
"RTN","PSGMMAR1",32,0)
 S TD=$P(PPN,U,10),PSEX=$P(PPN,U,11),PSGLWD=$P(PPN,U,12),PPN=$P(PPN,U),PAGE=$P(BD,";",2),BD=$P(BD,";"),DFN=PSGP
"RTN","PSGMMAR1",33,0)
 D ATS^PSJMUTL(115,117,1)
"RTN","PSGMMAR1",34,0)
 Q
"RTN","PSGMMAR2")
0^27^B30290130
"RTN","PSGMMAR2",1,0)
PSGMMAR2 ;BIR/CML3-MD MARS - PRINT C ORDERS(UD) ;09 Feb 99 / 12:50 PM
"RTN","PSGMMAR2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,20,111**;16 DEC 97
"RTN","PSGMMAR2",3,0)
S1 ;
"RTN","PSGMMAR2",4,0)
 I PSGMARB'=1 S:PSGRBPPN="P" X=PN,Y=RB S:PSGRBPPN="R" X=RB,Y=PN S NO=$S(PSGSS="P"!(PSGSS="C")!(PSGSS="L"):$O(^TMP($J,PN,0)),1:$O(^TMP($J,TM,WDN,X,Y,0)))'["C"
"RTN","PSGMMAR2",5,0)
 I $S(PSGMARB'=2:1,"34"[PSGMARS:NO,1:0) D:PSGMARS'=4 HEADER,BOT D:PSGMARS'=1 BLANK^PSGMMAR3 Q:PSGMARB=1
"RTN","PSGMMAR2",6,0)
 Q:NO  D NOW^%DTC S PSGDT=%,(DAO,PST)="" I PSGSS'="P",PSGSS'="C",PSGSS'="L" D HEADER
"RTN","PSGMMAR2",7,0)
 S PSGMPG=0,PSGMPGN="PAGE: "
"RTN","PSGMMAR2",8,0)
 D @($S(PSGSS="P"!(PSGSS="C")!(PSGSS="L"):"P",1:"W"))
"RTN","PSGMMAR2",9,0)
 D BOT
"RTN","PSGMMAR2",10,0)
 Q
"RTN","PSGMMAR2",11,0)
P ; Print on Patient order
"RTN","PSGMMAR2",12,0)
 F  S PST=$O(^TMP($J,PN,PST)) Q:PST'["C"  S A="" F  S A=$O(^TMP($J,PN,PST,A)) Q:A=""  D
"RTN","PSGMMAR2",13,0)
 . D HEADER
"RTN","PSGMMAR2",14,0)
 . S DAO="" F  S DAO=$O(^TMP($J,PN,PST,A,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) S:A["C!" PWDN=A D PRT
"RTN","PSGMMAR2",15,0)
 S:$O(^TMP($J,PN,"N"))="" PSGMPGN="LAST PAGE: "
"RTN","PSGMMAR2",16,0)
 Q
"RTN","PSGMMAR2",17,0)
W ; Print Ward/Ward group
"RTN","PSGMMAR2",18,0)
 I PSGRBPPN="P" D
"RTN","PSGMMAR2",19,0)
 . F  S PST=$O(^TMP($J,TM,WDN,PN,RB,PST)) Q:PST'["C"  F Q=0:0 S DAO=$O(^TMP($J,TM,WDN,PN,RB,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D PRT
"RTN","PSGMMAR2",20,0)
 . S:$O(^TMP($J,TM,WDN,PN,RB,"N"))="" PSGMPGN="LAST PAGE: "
"RTN","PSGMMAR2",21,0)
 I PSGRBPPN="R" D
"RTN","PSGMMAR2",22,0)
 . F  S PST=$O(^TMP($J,TM,WDN,RB,PN,PST)) Q:PST'["C"  F Q=0:0 S DAO=$O(^TMP($J,TM,WDN,RB,PN,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D PRT
"RTN","PSGMMAR2",23,0)
 . S:$O(^TMP($J,TM,WDN,RB,PN,"N"))="" PSGMPGN="LAST PAGE: "
"RTN","PSGMMAR2",24,0)
 Q
"RTN","PSGMMAR2",25,0)
HEADER ; pat info
"RTN","PSGMMAR2",26,0)
 S:'$G(PSGXDT) PSGXDT=PSGDT ;Reason was that PSGDT kept reset somewhere
"RTN","PSGMMAR2",27,0)
 S PSGMAROC=0,(MSG1,MSG2)="" W:$G(PSGPG)&($Y) @IOF S PSGPG=1 W !?1,"CONTINUOUS SHEET",?61,PSGMARDF," DAY MAR",?100,PSGMARSP,"  through  ",PSGMARFP
"RTN","PSGMMAR2",28,0)
 W !?5,$P($$SITE(80),U,2),?102,"Printed on  "_$$ENDTC2^PSGMI(PSGXDT)
"RTN","PSGMMAR2",29,0)
 W !?5,"Name:  "_PPN,?62,"Weight (kg): "_WT,?103,"Loc: "_$S(PWDN'["C!":PWDN,1:$P($G(^SC($P(PWDN,"!",2),0)),"^"))
"RTN","PSGMMAR2",30,0)
 W !?6,"PID:  "_PSSN,?25,"DOB: "_BD_"  ("_PAGE_")",?62,"Height (cm): "_HT,?99,"Room-Bed: "_$S(PWDN'["C!":PRB,1:"")
"RTN","PSGMMAR2",31,0)
 W !?6,"Sex:  "_PSEX,?25," Dx: "_DX,?$S(TD:94,1:99),$S(TD:"Last Transfer: "_TD,1:"Admitted: "_$S(PWDN'["C!":AD,1:""))
"RTN","PSGMMAR2",32,0)
 I '$D(PSGALG) W !,"Allergies:  See attached list of Allergies/Adverse Reactions"
"RTN","PSGMMAR2",33,0)
 NEW PSGX S PSGX=0 D ATS^PSGMAR3(.PSGX) D:PSGX HEADER Q:PSGX
"RTN","PSGMMAR2",34,0)
 ;* W !,?49,"Admin" W:PSGMARDF=14 ?55,LN14 W !?1,"Order",?9,"Start",?21,"Stop",?49,"Times" W ?55,LN3," notes",!,LN1
"RTN","PSGMMAR2",35,0)
 W !,?49,"Admin"
"RTN","PSGMMAR2",36,0)
 W:$G(PSJDIET)]"" ?57,"Diet: ",PSJDIET
"RTN","PSGMMAR2",37,0)
 W:PSGMARDF=14 ?55,LN14 W !?1,"Order",?9,"Start",?21,"Stop",?49,"Times" W ?55,LN3," notes",!,LN1
"RTN","PSGMMAR2",38,0)
 Q
"RTN","PSGMMAR2",39,0)
PRT ; order info
"RTN","PSGMMAR2",40,0)
 S ON=$P(DAO,U,2)
"RTN","PSGMMAR2",41,0)
 I +PSGMSORT,$S(ON["V":1,ON["P":$P($G(^PS(53.1,+ON,0)),U,4)="F",1:0) D PRT^PSGMMIVC Q
"RTN","PSGMMAR2",42,0)
 D:PSGMAROC>5 ENB,HEADER I PST["CV"!(PST["CZV") D PRT^PSGMMIVC Q
"RTN","PSGMMAR2",43,0)
 ;* S PSGMARGD=$P(PSGMARTS,"^",2),PSGMARTS=$P(PSGMARTS,"^"),PSGORD=+$P(DAO,U,2)_$S(PST["CZ":"P",1:"A") D ^PSGLOI
"RTN","PSGMMAR2",44,0)
 S PSGMARGD=$P(PSGMARTS,"^",2),PSGMARTS=$P(PSGMARTS,"^"),PSGORD=$P(DAO,U,2) S:PSGORD["P" PSJPSTO=PST,PST=$S(+PSGMSORT:"CZ",1:PST) D ^PSGLOI
"RTN","PSGMMAR2",45,0)
 D TS^PSGMAR3(PSGMARTS)
"RTN","PSGMMAR2",46,0)
 D MARLB^PSGMUTL(47)
"RTN","PSGMMAR2",47,0)
 I (PSGMAROC>4&(MARLB>6))!(TS/6>6)!((TS/6+PSGMAROC)>6) D BOT,HEADER
"RTN","PSGMMAR2",48,0)
 S PSGMAROC=PSGMAROC+1
"RTN","PSGMMAR2",49,0)
 NEW PRTLN F PRTLN=1:1:MARLB W !,MARLB(PRTLN),?48,"|",$G(TS(PRTLN)) D CELL(PRTLN,'(PRTLN#6)) D PRT2
"RTN","PSGMMAR2",50,0)
 I $D(PSJPSTO) S PST=PSJPSTO K PSJPSTO
"RTN","PSGMMAR2",51,0)
 Q
"RTN","PSGMMAR2",52,0)
PRT2 ;
"RTN","PSGMMAR2",53,0)
 I PSGMAROC>5,(TS/6>7) D
"RTN","PSGMMAR2",54,0)
 . S MSG1="*** CONTINUE ON NEXT PAGE ***"
"RTN","PSGMMAR2",55,0)
 . D BOT,HEADER
"RTN","PSGMMAR2",56,0)
 I PRTLN#6=0 W:PSGMAROC<6 !?7,LN2 S:PRTLN'=MARLB PSGMAROC=PSGMAROC+1
"RTN","PSGMMAR2",57,0)
 Q
"RTN","PSGMMAR2",58,0)
CHKLAB ; Check to see if next label is needed.
"RTN","PSGMMAR2",59,0)
 I '((L+1)#6) W ?48,"| ",$G(TS(L)) D CELL(L,0) W !?1,"See next label for continuation",?48,"| ",$G(TS(L+1)) D CELL(L+1,1) W:PSGMAROC<6 !?7,LN2,!?1 S L=L+2,PSGMAROC=PSGMAROC+1 D  Q
"RTN","PSGMMAR2",60,0)
 . I PSGMAROC>5,(TS/6>7) S MSG1="*** CONTINUE ON NEXT PAGE ***" D BOT,HEADER
"RTN","PSGMMAR2",61,0)
 E  W ?48,"| ",$G(TS(L)) D CELL(L,0) W !?1 S L=L+1
"RTN","PSGMMAR2",62,0)
 Q
"RTN","PSGMMAR2",63,0)
INIT ; Print the initials on the label.
"RTN","PSGMMAR2",64,0)
 W !?1,$E("WS",1,PSGLWS*2),?4,$S(PSGLSM:$E("HSM",PSGLSM,3),1:""),?8,$E("NF",1,PSGLNF*2),?30,"RPH: ",PSGLRPH,?39," RN: ",PSGLRN,?48,"| ",?50,$G(TS(L)) D CELL(L,1)
"RTN","PSGMMAR2",65,0)
 Q
"RTN","PSGMMAR2",66,0)
CELL(X,X1) ; Print the **** on the not to be given cells.
"RTN","PSGMMAR2",67,0)
 N QTS,CELL S CELL=$E($S(X1:"         ",1:"_________"),1,PSGMARDF=7*5+4)
"RTN","PSGMMAR2",68,0)
 I PST["CZ",(X=6) NEW PSGLFFD,PSGMARGD S P(9)="",PSGLFFD="9999999",PSGMARGD="" W ?55 D ASTERS Q
"RTN","PSGMMAR2",69,0)
 I TS=1,'PSGMARTS,(X=6) W ?55 S P(9)=1 D ASTERS K P(9) Q
"RTN","PSGMMAR2",70,0)
 I $G(TS(X))="" W ?55,$S(X1:LN7,1:LN4) Q
"RTN","PSGMMAR2",71,0)
 F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q  S QTS=Q_"."_TS(X) W ?55,"|"_$S(QTS<PSGLSSD:EXPIRE,QTS'<PSGLFFD:EXPIRE,PSGMARGD="":ASTERS,PSGMARGD[$P(PSGD(Q),"^"):CELL,1:ASTERS)
"RTN","PSGMMAR2",72,0)
 W "|"
"RTN","PSGMMAR2",73,0)
 Q
"RTN","PSGMMAR2",74,0)
ASTERS ; Print the **** on the first label.
"RTN","PSGMMAR2",75,0)
 S PSGLFFD=$P(PSGLFFD,".") F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q  W "|"_$S(Q<$P(PSGLSSD,"."):ASTERS,Q=PSGLFFD:EXPIRE,Q>PSGLFFD:ASTERS,(PSGMARGD=""&($G(P(9))="")):SPACES,PSGMARGD[$P(PSGD(Q),"^"):SPACES,1:ASTERS)
"RTN","PSGMMAR2",76,0)
 W "|"
"RTN","PSGMMAR2",77,0)
 Q
"RTN","PSGMMAR2",78,0)
BOT ; bottom of MAR
"RTN","PSGMMAR2",79,0)
 I MSG1]"" F QQ=1:1:6 W ! W:QQ=1 ?6,"|",?19,"|" W:34[QQ ?12,$S(QQ=3:MSG1,1:MSG2) W ?55,$S(QQ<6:LN4,1:LN7)
"RTN","PSGMMAR2",80,0)
 I PSGMAROC<6 S PSGMAROC=6-PSGMAROC F Q=1:1:PSGMAROC F QQ=1:1:6 W ! W:QQ=1 ?6,"|",?19,"|" W:34[QQ ?12,$S(QQ=3:MSG1,1:MSG2) W ?55,$S(QQ<6:LN4,1:LN7) I QQ=6,Q<PSGMAROC W !?7,LN2
"RTN","PSGMMAR2",81,0)
ENB ;
"RTN","PSGMMAR2",82,0)
 I $D(PSGMPG) S PSGMPG=PSGMPG+1 S PSGMPGN=$S(PSGMPGN'["LAST":"PAGE: ",1:PSGMPGN)_PSGMPG
"RTN","PSGMMAR2",83,0)
 W !,LN1
"RTN","PSGMMAR2",84,0)
 W !,"|",?11,"SIGNATURE/TITLE",?38,"| INIT |          INJECTION SITES           |",?87,"MED/DOSE OMITTED",?107,"|     REASON     | INIT |"
"RTN","PSGMMAR2",85,0)
 F Q=1:1:10 W !,"|"_$E(LN1,1,37)_"|------|"_BLN(Q),?82,"|"_$E(LN1,1,24)_"|"_$E(LN1,1,16)_"|------|"
"RTN","PSGMMAR2",86,0)
 W !,LN1,!?3,PPN,?45,PSSN,?58,"Room-Bed: "_$S(PWDN'["C!":PRB,1:""),?100,$S($D(PSGMPG):PSGMPGN,1:""),?116,"VA FORM 10-2970",*13
"RTN","PSGMMAR2",87,0)
 Q
"RTN","PSGMMAR2",88,0)
SITE(LEN) ;* Get the Institution name
"RTN","PSGMMAR2",89,0)
 ;* Input : LEN = Report width (80 or 132 colume)
"RTN","PSGMMAR2",90,0)
 ;* Output: space needed to center text ^ VAMC name
"RTN","PSGMMAR2",91,0)
 NEW X
"RTN","PSGMMAR2",92,0)
 S X=$$NAME^VASITE
"RTN","PSGMMAR2",93,0)
 I X="" S X=$$SITE^VASITE S:X]"" X="VAMC:  "_$P(X,U,2)_" ("_$P(X,U,3)_")"
"RTN","PSGMMAR2",94,0)
 I X="" Q ""
"RTN","PSGMMAR2",95,0)
 Q (LEN-$L(X))/2_U_X
"RTN","PSGMMAR3")
0^55^B7186458
"RTN","PSGMMAR3",1,0)
PSGMMAR3 ;BIR/CML3-MD MARS - SORT O/P ORDERS ;21 Oct 98 / 12:22 PM
"RTN","PSGMMAR3",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,111**;16 DEC 97
"RTN","PSGMMAR3",3,0)
 ;
"RTN","PSGMMAR3",4,0)
 ; Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSGMMAR3",5,0)
 ;
"RTN","PSGMMAR3",6,0)
S1 ; Print non-blank prn.
"RTN","PSGMMAR3",7,0)
 Q:PSGMARB=1
"RTN","PSGMMAR3",8,0)
 NEW INIT,NEED,LT,RT,BL,PG,LAB
"RTN","PSGMMAR3",9,0)
 S BL=$S($P($G(^PS(59.7,1,26)),U):6,1:4),(PG,LT,RT)=1
"RTN","PSGMMAR3",10,0)
 S NO=$S(PSGSS="P"!(PSGSS="C")!(PSGSS="L"):$O(^TMP($J,PN,"N"))="",PSGRBPPN="P":$O(^TMP($J,TM,WDN,PN,RB,"N"))="",1:$O(^TMP($J,TM,WDN,RB,PN,"N"))="")
"RTN","PSGMMAR3",11,0)
 Q:NO
"RTN","PSGMMAR3",12,0)
 D NOW^%DTC S PSGDT=%,DAO="",PST="N",PSGMAROC=0
"RTN","PSGMMAR3",13,0)
 K ^TMP($J,"1PRN")
"RTN","PSGMMAR3",14,0)
 I PSGSS'="P",PSGSS'="C",PSGSS'="L" D
"RTN","PSGMMAR3",15,0)
 . I PSGRBPPN="P" F  S PST=$O(^TMP($J,TM,WDN,PN,RB,PST)) Q:PST=""  F  S DAO=$O(^TMP($J,TM,WDN,PN,RB,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D SET
"RTN","PSGMMAR3",16,0)
 . I PSGRBPPN="R" F  S PST=$O(^TMP($J,TM,WDN,RB,PN,PST)) Q:PST=""  F  S DAO=$O(^TMP($J,TM,WDN,RB,PN,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D SET
"RTN","PSGMMAR3",17,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") F  S PST=$O(^TMP($J,PN,PST)) Q:PST=""  F  S DAO=$O(^TMP($J,PN,PST,DAO)) Q:DAO=""  D
"RTN","PSGMMAR3",18,0)
 .N DAOO S DAOO="" F  S DAOO=$O(^TMP($J,PN,PST,DAO,DAOO)) Q:DAOO=""  I $D(^TMP($J,PN,PST,DAO,DAOO))>10 S PSGMARTS=^(DAOO) D SET
"RTN","PSGMMAR3",19,0)
 D EN^PSGMMAR4
"RTN","PSGMMAR3",20,0)
 Q
"RTN","PSGMMAR3",21,0)
 ;
"RTN","PSGMMAR3",22,0)
SET ; set ^tmp array
"RTN","PSGMMAR3",23,0)
 ;* I PST["V" D IVPRN^PSGMMIV Q
"RTN","PSGMMAR3",24,0)
 ;* S PSGORD=+$P(DAO,"^",2)_$S(PST["OZ":"P",1:"A") D ^PSGLOI
"RTN","PSGMMAR3",25,0)
 S PSGORD=$P(DAO,U,2)
"RTN","PSGMMAR3",26,0)
 I PSGORD["V" D IVPRN^PSGMMIV Q
"RTN","PSGMMAR3",27,0)
 I +PSGMSORT,PSGORD["P" S PSJPSTO=PST,PST="OZ"
"RTN","PSGMMAR3",28,0)
 S PSGORD=+PSGORD_$S(PSGORD["P":"P",1:"A") D ^PSGLOI
"RTN","PSGMMAR3",29,0)
 S TS=0 D MARLB^PSGMUTL(47)
"RTN","PSGMMAR3",30,0)
 I ((MARLB/6)+PSGMAROC)>BL S:PSGMAROC PG=PG+1,(LT,RT)=1,PSGMAROC=0
"RTN","PSGMMAR3",31,0)
 I ((MARLB/6)+PSGMAROC)>(BL/2) S PSGMAROC=$S(PSGMAROC>(BL/2):PSGMAROC,1:(BL/2)) D LTRT(.RT,"^")
"RTN","PSGMMAR3",32,0)
 E  D LTRT(.LT,"")
"RTN","PSGMMAR3",33,0)
 D LAB
"RTN","PSGMMAR3",34,0)
 I $D(PSJPSTO) S PST=PSJPSTO K PSJPSTO
"RTN","PSGMMAR3",35,0)
 Q
"RTN","PSGMMAR3",36,0)
 ;
"RTN","PSGMMAR3",37,0)
LAB ;***Print the 1st label for the order.
"RTN","PSGMMAR3",38,0)
 NEW X,J S J=0
"RTN","PSGMMAR3",39,0)
 ;naked reference below goes with full reference on right of =
"RTN","PSGMMAR3",40,0)
 F X=1:1:MARLB S J=J+1,^(J)=$G(^TMP($J,"1PRN",PG,LAB,J))_UP_MARLB(X) D
"RTN","PSGMMAR3",41,0)
 . I X=6,(MARLB>6) D
"RTN","PSGMMAR3",42,0)
 . . S J=0
"RTN","PSGMMAR3",43,0)
 . . I PSGMAROC>(BL/2) D LTRT(.RT,"^")
"RTN","PSGMMAR3",44,0)
 . . E  D LTRT(.LT,"")
"RTN","PSGMMAR3",45,0)
 Q
"RTN","PSGMMAR3",46,0)
 ;
"RTN","PSGMMAR3",47,0)
LTRT(X,Y)         ;***Increment Left of Right label value.
"RTN","PSGMMAR3",48,0)
 S LAB=X,X=X+1,UP=Y,PSGMAROC=PSGMAROC+1
"RTN","PSGMMAR3",49,0)
 Q
"RTN","PSGMMAR3",50,0)
BLANK ; Print blank prn form
"RTN","PSGMMAR3",51,0)
 NEW INIT,NEED,LT,RT,BL,PG,LAB,UP
"RTN","PSGMMAR3",52,0)
 S BL=$S($P($G(^PS(59.7,1,26)),U):6,1:4),(PG,LT,RT)=1
"RTN","PSGMMAR3",53,0)
 I PSGMARB'=2 D PSGMARB^PSGMMAR4
"RTN","PSGMMAR3",54,0)
 Q
"RTN","PSGMMAR4")
0^28^B11251322
"RTN","PSGMMAR4",1,0)
PSGMMAR4 ;BIR/CML3-MD MARS - PRINT O/P ORDERS ;05 Oct 98 / 10:25 AM
"RTN","PSGMMAR4",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,12,20,111**;16 DEC 97
"RTN","PSGMMAR4",3,0)
 ;
"RTN","PSGMMAR4",4,0)
PSGMARB ;***Print blank MAR for PRN orders.
"RTN","PSGMMAR4",5,0)
 NEW L1 S L1="      |           |"
"RTN","PSGMMAR4",6,0)
 D HEADER F X=1:1:(BL/2) D
"RTN","PSGMMAR4",7,0)
 . F Q=1:1:6 W:Q=1 !,L1,?55,"|",?75,"| ",L1 W:Q'=1 !,?55,"|",?75,"| "
"RTN","PSGMMAR4",8,0)
 . W !,LN1
"RTN","PSGMMAR4",9,0)
 D BOT
"RTN","PSGMMAR4",10,0)
 K ^TMP($J,"1PRN")
"RTN","PSGMMAR4",11,0)
 Q
"RTN","PSGMMAR4",12,0)
 ;
"RTN","PSGMMAR4",13,0)
EN ;***Start print prn orders.
"RTN","PSGMMAR4",14,0)
 NEW LABX,L1,P1,P2 S (PG,LAB)=0,L1="      |            |"
"RTN","PSGMMAR4",15,0)
 S:'$D(PSGMPG) PSGMPG=0 S PSGMPGN="PAGE: "
"RTN","PSGMMAR4",16,0)
 F  S PG=$O(^TMP($J,"1PRN",PG)) Q:'PG  D
"RTN","PSGMMAR4",17,0)
 . D HEADER
"RTN","PSGMMAR4",18,0)
 . F LAB=0:0 S LABX=LAB,LAB=$O(^TMP($J,"1PRN",PG,LAB)) Q:'LAB  F LN=0:0 S LN=$O(^TMP($J,"1PRN",PG,LAB,LN)) Q:'LN  D
"RTN","PSGMMAR4",19,0)
 .. S P1=$P(^TMP($J,"1PRN",PG,LAB,LN),U,1),P2=$P(^(LN),U,2)
"RTN","PSGMMAR4",20,0)
 .. S:LN=1 P1=$S(P1]"":P1,1:L1),P2=$S(P2]"":P2,1:L1)
"RTN","PSGMMAR4",21,0)
 .. W !,P1,?55,"|",?75,"| ",P2
"RTN","PSGMMAR4",22,0)
 .. W:'(LN#6) !,LN1
"RTN","PSGMMAR4",23,0)
 . F LABX=LABX+1:1:(BL/2) D
"RTN","PSGMMAR4",24,0)
 . .F X=1:1:6 S:X=1 (P1,P2)=L1 W !,P1,?55,"|",?75,"| ",P2 S (P1,P2)=""
"RTN","PSGMMAR4",25,0)
 . .W !,LN1
"RTN","PSGMMAR4",26,0)
 . S:'$O(^TMP($J,"1PRN",PG)) PSGMPGN="LAST PAGE: " D BOT
"RTN","PSGMMAR4",27,0)
 Q
"RTN","PSGMMAR4",28,0)
 ;
"RTN","PSGMMAR4",29,0)
HEADER ;*** Patient info
"RTN","PSGMMAR4",30,0)
 S:'$G(PSGXDT) PSGXDT=PSGDT
"RTN","PSGMMAR4",31,0)
 W:$G(PSGPG) @IOF S PSGPG=1 W ?1,"ONE-TIME/PRN SHEET",?61,PSGMARDF_" DAY MAR",?100,PSGMARSP_"  through  "_PSGMARFP
"RTN","PSGMMAR4",32,0)
 W !?5,$P($$SITE^PSGMMAR2(80),U,2),?102,"Printed on  ",$$ENDTC2^PSGMI(PSGXDT)
"RTN","PSGMMAR4",33,0)
 W !?5,"Name:  "_PPN,?62,"Weight (kg): "_WT,?103,"Loc: "_$S(PWDN'["C!":PWDN,1:$P($G(^SC($P(PWDN,"!",2),0)),"^"))
"RTN","PSGMMAR4",34,0)
 W !?6,"PID:  "_PSSN,?25,"DOB: "_BD_"  ("_PAGE_")",?62,"Height (cm): "_HT,?99,"Room-Bed: "_$S(PWDN'["C!":PRB,1:"")
"RTN","PSGMMAR4",35,0)
 W !?6,"Sex:  "_PSEX,?25," Dx: "_DX,?$S(TD:94,1:99),$S(TD:"Last Transfer: "_TD,1:"Admitted: "_$S(PWDN'["C!":AD,1:""))
"RTN","PSGMMAR4",36,0)
 I '$D(PSGALG) W !,"Allergies:  See attached list of Allergies/Adverse Reactions"
"RTN","PSGMMAR4",37,0)
 NEW PSGX S PSGX=0 D ATS^PSGMAR3(.PSGX) D:PSGX HEADER Q:PSGX
"RTN","PSGMMAR4",38,0)
 I $G(PSJDIET)]"" W !?57,"Diet: ",PSJDIET
"RTN","PSGMMAR4",39,0)
 E  W !
"RTN","PSGMMAR4",40,0)
 ;* W !!?1,"Order",?9,"Start",?21,"Stop",?77,"Order",?85,"Start",?97,"Stop",!,LN1
"RTN","PSGMMAR4",41,0)
 W !?1,"Order",?9,"Start",?21,"Stop",?77,"Order",?85,"Start",?97,"Stop",!,LN1
"RTN","PSGMMAR4",42,0)
 Q
"RTN","PSGMMAR4",43,0)
 ;
"RTN","PSGMMAR4",44,0)
BOT ; rest of PRN sheet
"RTN","PSGMMAR4",45,0)
 W !,"|  DATE  |  TIME  |         MEDICATION/DOSE/ROUTE           | INIT |        REASON         |       RESULTS         |  TIME  | INIT |"
"RTN","PSGMMAR4",46,0)
 S X=$S(BL=4:26,1:20) F Q=1:1:X W !,LN31
"RTN","PSGMMAR4",47,0)
 ;W "|        |        |                                         |      |                       |                       |        |      |"
"RTN","PSGMMAR4",48,0)
ENB ;
"RTN","PSGMMAR4",49,0)
 I $D(PSGMPG) S PSGMPG=PSGMPG+1 S PSGMPGN=$S(PSGMPGN'["LAST":"PAGE: ",1:PSGMPGN)_PSGMPG
"RTN","PSGMMAR4",50,0)
 W !,LN1
"RTN","PSGMMAR4",51,0)
 W !,"|",?13,"SIGNATURE/TITLE",?40,"| INIT |          INJECTION SITES           |",?97,"SIGNATURE/TITLE",?124,"| INIT |"
"RTN","PSGMMAR4",52,0)
 F Q=1:1:10 W !,"|"_$E(LN1,1,39)_"|------|"_BLN(Q),?84,"|"_$E(LN1,1,39)_"|------|"
"RTN","PSGMMAR4",53,0)
 W !,LN1,!?3,PPN,?45,PSSN,?58,"Room-Bed: "_$S(PWDN'["C!":PRB,1:""),?100,$S($D(PSGMPG):PSGMPGN,1:""),?116,"VA FORM 10-5568d",*13
"RTN","PSGMMAR4",54,0)
 S PSGMAROC=0,(PSGMAPA(1),PSGMAPB(1),PSGMAPC(1),PSGMAPD(1))="      |       |" F Q=2:1:6 S (PSGMAPA(Q),PSGMAPB(Q),PSGMAPC(Q),PSGMAPD(Q))=""
"RTN","PSGMMAR4",55,0)
 Q
"RTN","PSGMMAR5")
0^119^B4624280
"RTN","PSGMMAR5",1,0)
PSGMMAR5 ;BIR/CML3-MD MARS - GATHER INFO FOR ACK ORDERS ;14 Oct 98 / 4:29 PM
"RTN","PSGMMAR5",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**15,20,111**;16 DEC 97
"RTN","PSGMMAR5",3,0)
 ;
"RTN","PSGMMAR5",4,0)
PEND ;*** Only select orders that were acknowledged by nurses and
"RTN","PSGMMAR5",5,0)
 ;*** still having pending status.
"RTN","PSGMMAR5",6,0)
 NEW PSJSYSW,PSJSYSW0
"RTN","PSGMMAR5",7,0)
 S PSJSYSW=$O(^PS(59.6,"B",+$G(PSJPWD),0))
"RTN","PSGMMAR5",8,0)
 S:PSJSYSW PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSGMMAR5",9,0)
 Q:'+$P($G(PSJSYSW0),U,6)
"RTN","PSGMMAR5",10,0)
 NEW ND,ON,TYPE,QST
"RTN","PSGMMAR5",11,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AV",PSGP,ON)) Q:'ON  D
"RTN","PSGMMAR5",12,0)
 . S ND=$G(^PS(53.1,ON,0)),TYPE=$P(ND,U,4)
"RTN","PSGMMAR5",13,0)
 . I $P(ND,U,7)="P"!($P($G(^PS(53.1,ON,2)),U)["PRN") S QST="OZ"_$S($P(ND,U,4)="F":"V",1:"A")
"RTN","PSGMMAR5",14,0)
 . E  S QST="CZ"_$S($P(ND,U,4)="F":"V",1:"A")
"RTN","PSGMMAR5",15,0)
 . I PSGMTYPE[1 D:TYPE'="F" SETTMP D:TYPE="F" IV
"RTN","PSGMMAR5",16,0)
 . I PSGMTYPE'[1 D
"RTN","PSGMMAR5",17,0)
 .. I PSGMTYPE[2,(TYPE="U") D SETTMP Q
"RTN","PSGMMAR5",18,0)
 .. I PSGMTYPE'[2,(TYPE="I") D SETTMP Q
"RTN","PSGMMAR5",19,0)
 .. I PSGMTYPE[4,(TYPE="F") D IV
"RTN","PSGMMAR5",20,0)
 Q
"RTN","PSGMMAR5",21,0)
 ;
"RTN","PSGMMAR5",22,0)
SETTMP ;*** Setup ^tmp for pending U/D and Inpatient med IVs.
"RTN","PSGMMAR5",23,0)
 ;*** OZ_(V/A) = PRN/One time orders (V=IV).
"RTN","PSGMMAR5",24,0)
 ;*** CZ_(V/A) = Continuous orders (A=U/D).
"RTN","PSGMMAR5",25,0)
 I PSGMARS=2,(QST["CZ") Q
"RTN","PSGMMAR5",26,0)
 I PSGMARS=1,(QST["OZ") Q
"RTN","PSGMMAR5",27,0)
 NEW MARX
"RTN","PSGMMAR5",28,0)
 D DRGDISP^PSJLMUT1(PSGP,+ON_"P",20,0,.MARX,1) S DRG=MARX(1)_U_+ON_"P"
"RTN","PSGMMAR5",29,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)="" Q
"RTN","PSGMMAR5",30,0)
 S ^TMP($J,TM,PSGMARWN,SUB1,SUB2,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=""
"RTN","PSGMMAR5",31,0)
 Q
"RTN","PSGMMAR5",32,0)
 ;
"RTN","PSGMMAR5",33,0)
IV ;*** Sort IV pending orders for 24 Hrs, 7/14 Day MAR.
"RTN","PSGMMAR5",34,0)
 K DRG,P N X,ON55,PSJLABEL S DFN=PSGP,PSJLABEL=1 D GT531^PSIVORFA(DFN,ON)
"RTN","PSGMMAR5",35,0)
 S X=$P(P("MR"),U,2)
"RTN","PSGMMAR5",36,0)
 S QST=QST_4
"RTN","PSGMMAR5",37,0)
 I DRG S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),X=$E($P(X,U,2),1,20)_U_+ON_"P" D
"RTN","PSGMMAR5",38,0)
 . I PSGSS="P"!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)="" Q
"RTN","PSGMMAR5",39,0)
 . S:PSGRBPPN="P" ^TMP($J,TM,PSGMARWN,PPN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMMAR5",40,0)
 . S:PSGRBPPN="R" ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMMAR5",41,0)
 Q
"RTN","PSGMMIV")
0^29^B24641228
"RTN","PSGMMIV",1,0)
PSGMMIV ;BIR/MV-IV ORDER FOR THE 7/14 DAY MAR. ;25 Nov 98 / 9:24 AM
"RTN","PSGMMIV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,21,58,111**;16 DEC 97
"RTN","PSGMMIV",3,0)
 ;
"RTN","PSGMMIV",4,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSGMMIV",5,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMMIV",6,0)
 ;
"RTN","PSGMMIV",7,0)
START ;*** Read IV orders
"RTN","PSGMMIV",8,0)
 NEW MULTIPG
"RTN","PSGMMIV",9,0)
 S ON=""
"RTN","PSGMMIV",10,0)
 F PSGMARED=PSGMARSD-.0001:0 S PSGMARED=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED)) Q:'PSGMARED  F  S ON=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED,ON)) Q:ON=""  D IV
"RTN","PSGMMIV",11,0)
 Q
"RTN","PSGMMIV",12,0)
IV ;*** Sort IV orders for 24 Hrs, 7/14 Day MAR.
"RTN","PSGMMIV",13,0)
 K DRG,P N X,ON55,PSJLABEL S DFN=PSGP,PSJLABEL=1 D GT55^PSIVORFB
"RTN","PSGMMIV",14,0)
 Q:P(2)>PSGMARFD
"RTN","PSGMMIV",15,0)
 S X=$P(P("MR"),U,2) Q:XTYPE=2&(X["IV")  Q:XTYPE=3&(PST="S")&'($S(X="IV":1,X="IVPB":1,1:0))
"RTN","PSGMMIV",16,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGMMIV",17,0)
 S QST=$S(P(9)["PRN":"OVP",QST="O":"OVO",1:"CV")_XTYPE
"RTN","PSGMMIV",18,0)
 Q:(PSGMARS=2&(QST["C"))
"RTN","PSGMMIV",19,0)
 Q:(PSGMARS=1&(QST["O"))
"RTN","PSGMMIV",20,0)
 I DRG S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),X=$E($P(X,U,2),1,20)_U_+ON_"V" D
"RTN","PSGMMIV",21,0)
 . I PSGSS="P" S ^TMP($J,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),$S(PSGMARWN'["C!":"A",1:PSGMARWN),X)="" Q
"RTN","PSGMMIV",22,0)
 . S:PSGRBPPN="P" ^TMP($J,TM,PSGMARWN,PPN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMMIV",23,0)
 . S:PSGRBPPN="R" ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMMIV",24,0)
 Q
"RTN","PSGMMIV",25,0)
IVPRN ;*** Set ^tmp to store IV orders that have schedule of PRN.
"RTN","PSGMMIV",26,0)
 K P,DRG NEW ON55,CHEMO,TXT,PSJLABEL
"RTN","PSGMMIV",27,0)
 S ON=$P(DAO,U,2),DFN=$P(PN,U,2),PSJLABEL=1
"RTN","PSGMMIV",28,0)
 ;* D:PST'["Z" GT55^PSIVORFB
"RTN","PSGMMIV",29,0)
 ;* I PST["Z" D GT531^PSIVORFA(DFN,ON)
"RTN","PSGMMIV",30,0)
 D:ON["V" GT55^PSIVORFB
"RTN","PSGMMIV",31,0)
 D:ON["P" GT531^PSIVORFA(DFN,ON)
"RTN","PSGMMIV",32,0)
 D SETVAR,SETLTRT
"RTN","PSGMMIV",33,0)
 ;the two naked references below refer to the full reference to the right of the = sign
"RTN","PSGMMIV",34,0)
 S ^(1)=$G(^TMP($J,"1PRN",PG,LAB,1))_UP_"      |            |"
"RTN","PSGMMIV",35,0)
 S ^(2)=$G(^TMP($J,"1PRN",PG,LAB,2))_UP_$E(P("LOG"),1,5)_" |",LN=3
"RTN","PSGMMIV",36,0)
 ;* S:PST["Z" ^(2)=^(2)_"P E N D I N G"
"RTN","PSGMMIV",37,0)
 ;* S:PST'["Z" ^(2)=^(2)_$E(P(2),1,5)_$E(P(2),9,14)_" |"_P(3)
"RTN","PSGMMIV",38,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",39,0)
 S:ON["P" ^(2)=^(2)_"P E N D I N G"
"RTN","PSGMMIV",40,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",41,0)
 S:ON["V" ^(2)=^(2)_$E(P(2),1,5)_$E(P(2),9,14)_" |"_P(3)
"RTN","PSGMMIV",42,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",43,0)
 S ^(2)=$$SETSTR^VALM1("("_$E(PSGP(0))_$E(PSSN,8,12)_")",^(2),40,7)
"RTN","PSGMMIV",44,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  S TXT=$$WRTDRG^PSIVUTL(DRG("AD",X),47) S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT)
"RTN","PSGMMIV",45,0)
 S TXT="in "
"RTN","PSGMMIV",46,0)
 ;; F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  S TXT=TXT_$$WRTDRG^PSIVUTL(DRG("SOL",X),47) S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT) S TXT="   "
"RTN","PSGMMIV",47,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D
"RTN","PSGMMIV",48,0)
 . S TXT=TXT_$$WRTDRG^PSIVUTL(DRG("SOL",X),47) S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT) S TXT="   "
"RTN","PSGMMIV",49,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",X),0),U,4) I PSJPRT2]"" S TXT=TXT_"   "_PSJPRT2 S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT) S TXT="   "
"RTN","PSGMMIV",50,0)
 S TXT=$P(P("MR"),U,2)_" "_P(9)_" "_P(8) D CHK(.TXT)
"RTN","PSGMMIV",51,0)
 I P(4)="C" S CHEMO="*CAUTION-CHEMOTHERAPY*" D:P("OPI")]"" CHK(CHEMO)
"RTN","PSGMMIV",52,0)
 S Y1="" F Y=1:1:$L($P(P("OPI"),"^")," ") S Y1=Y1_$P($P(P("OPI"),"^")," ",Y)_" " I $L(Y1)>47 D CHK(Y1) S Y1=""
"RTN","PSGMMIV",53,0)
 I $L(Y1)>28 D CHK(Y1) S Y1=""
"RTN","PSGMMIV",54,0)
 I Y1<29,'(LN#6) S TXT=$S((P("OPI")=""&$D(CHEMO)):CHEMO,1:Y1),X=29-$L(TXT),TXT=TXT_$$SP(X)_INIT
"RTN","PSGMMIV",55,0)
 E  D  S TXT=$$SP(29)_INIT,LN=LN+1
"RTN","PSGMMIV",56,0)
 . ;the following three naked references below refer to the full references to the right of the = sign
"RTN","PSGMMIV",57,0)
 .  I LN=5 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_Y1
"RTN","PSGMMIV",58,0)
 .  E  D:$L(Y1) CHK(Y1) F LN=LN:1:5 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_""
"RTN","PSGMMIV",59,0)
 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_TXT
"RTN","PSGMMIV",60,0)
 Q
"RTN","PSGMMIV",61,0)
SETVAR ;***Initialize variables.
"RTN","PSGMMIV",62,0)
 NEW TMSTR
"RTN","PSGMMIV",63,0)
 F X="LOG",2,3 S:P(X) P(X)=$$ENDTC^PSGMI(P(X))
"RTN","PSGMMIV",64,0)
 S PSGST=$S(P(9)["PRN":"P",P(2)=P(3):"O",1:"C"),TMSTR=P(11),PSGLFFD=PSGMARFD
"RTN","PSGMMIV",65,0)
 D INITOPI^PSGMMIVC
"RTN","PSGMMIV",66,0)
 ;;S INIT="RPH: "_PSGLRPH,INIT=INIT_$$SP(37-($L(INIT)+29))_"RN: "_PSGLRN
"RTN","PSGMMIV",67,0)
 S INIT="RPH: "_PSGLRPH,INIT=INIT_$$SP(38-($L(INIT)+29))_"RN: "_PSGLRN
"RTN","PSGMMIV",68,0)
 ;* S INIT="RPH: "_PSGLRPH_" RN: "_PSGLRN
"RTN","PSGMMIV",69,0)
 ;* S INIT="RPH: "_$S(PSGLRPH]"":PSGLRPH_" ",1:"_____")_" RN: "_$S($G(PSGLRN)]"":PSGLRN,1:"_____")
"RTN","PSGMMIV",70,0)
 ;*** If OPI<29 char, it is ok to put INITs in the same line.
"RTN","PSGMMIV",71,0)
 ;*** If OPI=""&it's a Chemo order, warning & Inits prt on same line.
"RTN","PSGMMIV",72,0)
 ;*** Add number lines needed for additives and solutions and 1 line
"RTN","PSGMMIV",73,0)
 ;*** for infusion rate and 1 line for start/stop date.
"RTN","PSGMMIV",74,0)
 ;*** Multiple labels can have up to 5 lines per label and the last
"RTN","PSGMMIV",75,0)
 ;*** label can have up to 6 lines..
"RTN","PSGMMIV",76,0)
 ;
"RTN","PSGMMIV",77,0)
 NEW X S NAMENEED=0
"RTN","PSGMMIV",78,0)
 F X="AD","SOL" D NAMENEED^PSJMUTL(X,47,.NEED) S NAMENEED=NAMENEED+NEED
"RTN","PSGMMIV",79,0)
 S MULTIPG=0,NEED=1
"RTN","PSGMMIV",80,0)
 ;* S X=($L(P("OPI"))>28)+1+(P("OPI")]""&(P(4)="C"))
"RTN","PSGMMIV",81,0)
 ;* Find # of lines needed for OPI -- (($L(P("OPI"))\47)
"RTN","PSGMMIV",82,0)
 ;* If the last line in OPI < 29 --(($L(P("OPI")#47)>28) include init.
"RTN","PSGMMIV",83,0)
 S X=($L($P(P("OPI"),"^"))\47)+(($L($P(P("OPI"),"^"))#47)>28)+1+($P(P("OPI"),"^")]""&(P(4)="C"))
"RTN","PSGMMIV",84,0)
 S X=(NAMENEED+X+2) S:X>5 NEED=((X-6)\5)+2
"RTN","PSGMMIV",85,0)
 S:NEED>BL MULTIPG=1
"RTN","PSGMMIV",86,0)
 Q
"RTN","PSGMMIV",87,0)
CHK(TXT) ;
"RTN","PSGMMIV",88,0)
 ;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",89,0)
 I '(LN#6) S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_"See next label for continuation",LN=1 D
"RTN","PSGMMIV",90,0)
 . I PSGMAROC+1>(BL/2) D
"RTN","PSGMMIV",91,0)
 . . I PSGMAROC=BL-1,MULTIPG D
"RTN","PSGMMIV",92,0)
 . . .;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",93,0)
 . . .F LN=LN:1:6 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_"" S:LN=3 ^(LN)=UP_"*** CONTINUE ON NEXT PAGE ***"
"RTN","PSGMMIV",94,0)
 . . .S PG=PG+1,(LN,LT,RT)=1,(PSGMAROC,MULTIPG)=0 D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",95,0)
 . . E  D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",96,0)
 . E  D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",97,0)
 ;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",98,0)
 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_TXT,LN=LN+1,TXT=""
"RTN","PSGMMIV",99,0)
 Q
"RTN","PSGMMIV",100,0)
SETLTRT ;*** Increment line number for left or right label on PRN sheet.
"RTN","PSGMMIV",101,0)
 I (NEED+PSGMAROC)>BL S:PSGMAROC PG=PG+1,(LT,RT)=1,PSGMAROC=0
"RTN","PSGMMIV",102,0)
 I NEED+PSGMAROC=BL D  Q
"RTN","PSGMMIV",103,0)
 . I PSGMAROC<(BL/2) D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",104,0)
 . E  D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",105,0)
 I PSGMAROC,((NEED+PSGMAROC)>(BL/2)) S PSGMAROC=$S(PSGMAROC>(BL/2):PSGMAROC,1:(BL/2)) D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",106,0)
 E  D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",107,0)
 Q
"RTN","PSGMMIV",108,0)
SP(X) ;***Set up spaces need between info on TXT for the label.
"RTN","PSGMMIV",109,0)
 N Y S $P(Y," ",X)=" "
"RTN","PSGMMIV",110,0)
 Q $G(Y)
"RTN","PSGMUTL")
0^84^B22496253
"RTN","PSGMUTL",1,0)
PSGMUTL ;BIR/MV-UTLILITY USE FOR THE MAR AND MEDWS. ;15 SEP 97 / 2:10 PM 
"RTN","PSGMUTL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,104,110,111**;16 DEC 97
"RTN","PSGMUTL",3,0)
 ;
"RTN","PSGMUTL",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGMUTL",5,0)
 ; 
"RTN","PSGMUTL",6,0)
MARFORM ;Prompt for the MAR form (Blank and Non-blank)
"RTN","PSGMUTL",7,0)
 S DIR(0)="SA^1:Print Blank MARs only;2:Print Non-Blank MARs only;3:Print both Blank and Non-Blank MARs"
"RTN","PSGMUTL",8,0)
 S DIR("A")="Select the MAR forms: ",DIR("B")="3"
"RTN","PSGMUTL",9,0)
 S DIR("?")=""
"RTN","PSGMUTL",10,0)
 S DIR("?",1)="Enter 1 to print BLANK (no data) MARs for the patient(s) you select."
"RTN","PSGMUTL",11,0)
 S DIR("?",2)="Enter 2 to print MARs complete with orders."
"RTN","PSGMUTL",12,0)
 S DIR("?",3)="Enter 3 to print both the blank MARs and the MARs complete with orders."
"RTN","PSGMUTL",13,0)
 S DIR("?",4)="Enter an  '^' to exit this option now."
"RTN","PSGMUTL",14,0)
 D ^DIR S PSGMARB=$S($D(DIRUT):0,1:Y)
"RTN","PSGMUTL",15,0)
 Q
"RTN","PSGMUTL",16,0)
BLANK(LEN) ;
"RTN","PSGMUTL",17,0)
 NEW X
"RTN","PSGMUTL",18,0)
 S $P(X," ",LEN)=" "
"RTN","PSGMUTL",19,0)
 Q $G(X)
"RTN","PSGMUTL",20,0)
 ;
"RTN","PSGMUTL",21,0)
TXT(TXT,LEN)   ;
"RTN","PSGMUTL",22,0)
 ;* Input: TXT = TXT string
"RTN","PSGMUTL",23,0)
 ;*        LEN = format length
"RTN","PSGMUTL",24,0)
 ;* Output: MARX array.
"RTN","PSGMUTL",25,0)
 ;*
"RTN","PSGMUTL",26,0)
 NEW OLD,X1,Y D SPLIT K MARX
"RTN","PSGMUTL",27,0)
 ;N OLD D SPLIT K MARX
"RTN","PSGMUTL",28,0)
 S X=0,X1=1,Y="" F  S X=$O(OLD(X)) Q:'X  D
"RTN","PSGMUTL",29,0)
 . I $L(Y_OLD(X))>LEN S MARX(X1)=Y,X1=X1+1,Y="" D
"RTN","PSGMUTL",30,0)
 .. I $E(MARX(X1-1),$L(MARX(X1-1)))'=" " Q
"RTN","PSGMUTL",31,0)
 .. S MARX(X1-1)=$E(MARX(X1-1),1,$L(MARX(X1-1))-1)
"RTN","PSGMUTL",32,0)
 . S Y=Y_OLD(X)
"RTN","PSGMUTL",33,0)
 S:Y]"" MARX(X1)=Y
"RTN","PSGMUTL",34,0)
 S MARX=X1
"RTN","PSGMUTL",35,0)
 Q
"RTN","PSGMUTL",36,0)
 ;
"RTN","PSGMUTL",37,0)
SPLIT ;* Split a word string into individual words.
"RTN","PSGMUTL",38,0)
 ;* Output: OLD(X)
"RTN","PSGMUTL",39,0)
 ;*
"RTN","PSGMUTL",40,0)
 NEW BSD,NEW,X,X1,Y
"RTN","PSGMUTL",41,0)
 S OLD(1)=TXT Q:$L(TXT)<LEN
"RTN","PSGMUTL",42,0)
 F BSD=" ","/","-" S:'$O(OLD(0)) OLD(1)=TXT D:TXT[BSD DELIM(BSD)
"RTN","PSGMUTL",43,0)
 I '$O(OLD(1)),($L(TXT)>LEN) D LEN(1,TXT) K OLD D
"RTN","PSGMUTL",44,0)
 . F X=0:0 S X=$O(NEW(X)) Q:'X  S OLD(X)=NEW(X)
"RTN","PSGMUTL",45,0)
 Q
"RTN","PSGMUTL",46,0)
LEN(X1,OLD) ;* Wrap word around if it doesn't fit the display lenght.
"RTN","PSGMUTL",47,0)
 NEW X
"RTN","PSGMUTL",48,0)
 Q:$L(OLD)'>LEN
"RTN","PSGMUTL",49,0)
 S X=$E(OLD,1,($L(OLD)-1)) I X["/"!((X["-")&(X'["ON-CALL")) Q
"RTN","PSGMUTL",50,0)
 I $L(OLD)>LEN F X=1:1 S NEW(X1)=$E(OLD,((LEN*X)-LEN+1),(LEN*X)),X1=X1+1 Q:($L(OLD)'>(LEN*X))
"RTN","PSGMUTL",51,0)
 Q
"RTN","PSGMUTL",52,0)
DELIM(BSD) ;* BSD=" ","/","-"
"RTN","PSGMUTL",53,0)
 K NEW
"RTN","PSGMUTL",54,0)
 S X=0,X1=0 F  S X=$O(OLD(X)) Q:'X  K ONCALL F Y=1:1:$L(OLD(X),BSD) D
"RTN","PSGMUTL",55,0)
 . Q:($G(ONCALL)=Y)   ; If ON-CALL is delimited string, ignore
"RTN","PSGMUTL",56,0)
 . S X1=X1+1
"RTN","PSGMUTL",57,0)
 . S NEW(X1)=$P(OLD(X),BSD,Y)
"RTN","PSGMUTL",58,0)
 . I $L(OLD(X),BSD)>1,(Y<$L(OLD(X),BSD)) S NEW(X1)=NEW(X1)_BSD
"RTN","PSGMUTL",59,0)
 . I BSD="-",OLD(X)["ON-CALL" D   ;If dashes, check for ON-CALL
"RTN","PSGMUTL",60,0)
 .. S NEW(X1)=OLD(X),ONCALL=Y+1   ;Keep ON-CALL intact
"RTN","PSGMUTL",61,0)
 . D LEN(.X1,NEW(X1))
"RTN","PSGMUTL",62,0)
 K OLD F X=0:0 S X=$O(NEW(X)) Q:'X  S OLD(X)=NEW(X)
"RTN","PSGMUTL",63,0)
 Q
"RTN","PSGMUTL",64,0)
 ;
"RTN","PSGMUTL",65,0)
MARLB(LEN)         ;
"RTN","PSGMUTL",66,0)
 ;;;LEN=LENGHT
"RTN","PSGMUTL",67,0)
 NEW L,X,TXT K MARLB,DRUGNAME
"RTN","PSGMUTL",68,0)
 S L=1
"RTN","PSGMUTL",69,0)
 S MARLB(L)=$$BLANK(6)_"|"_$$BLANK(12)_"|",L=L+1
"RTN","PSGMUTL",70,0)
 I $G(PST)["CZ"!($G(PST)["OZ") S MARLB(L)=PSGLOD_" | P E N D I N G"
"RTN","PSGMUTL",71,0)
 E  S MARLB(L)=PSGLOD_" |"_PSGLSD_" |"_PSGLFD
"RTN","PSGMUTL",72,0)
 S MARLB(L)=$$SETSTR^VALM1("("_$E(PPN)_$E(PSSN,8,12)_")",MARLB(L),40,7)
"RTN","PSGMUTL",73,0)
 S L=L+1
"RTN","PSGMUTL",74,0)
 D DRGDISP^PSJLMUT1(PSGP,+PSGORD_$S(PSGORD["P":"P",1:"U"),45,39,.DRUGNAME,0)
"RTN","PSGMUTL",75,0)
 F X=0:0 S X=$O(DRUGNAME(X)) Q:'X  S MARLB(L)=DRUGNAME(X)_$S(X=1:$$BLANK(47-$L(DRUGNAME(X)))_PSGLST,1:""),L=L+1
"RTN","PSGMUTL",76,0)
 D TXT^PSGMUTL(PSGLSI,LEN)
"RTN","PSGMUTL",77,0)
 S X=0 F  S X=$O(MARX(X)) Q:'X  S MARLB(L)=MARX(X),L=L+1
"RTN","PSGMUTL",78,0)
 K MARX
"RTN","PSGMUTL",79,0)
 I $G(PSGP),$G(PSGORD),(PSGLRN]""),(PSGLRN'="O") D
"RTN","PSGMUTL",80,0)
 .N ND4 S ND4=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,4)),PSGORD["P":$G(^PS(53.1,+PSGORD,4)),1:"")
"RTN","PSGMUTL",81,0)
 .N PSGLREN,PSGLRNDT S PSGLREN=+$$LASTREN^PSJLMPRI(PSGP,PSGORD),PSGLRNDT=$P(ND4,"^",2) I PSGLREN,PSGLRNDT I PSGLREN>PSGLRNDT S PSGLRN=""
"RTN","PSGMUTL",82,0)
 S X=$E("WS",1,PSGLWS*2)_$S(PSGLSM:$E("HSM",PSGLSM,3),1:"")_$E("NF",1,PSGLNF*2)
"RTN","PSGMUTL",83,0)
 I X="",($L(MARLB(L-1))<30),(L=7) S L=L-1 D
"RTN","PSGMUTL",84,0)
 . S X=MARLB(L)_$$BLANK(29-$L(MARLB(L)))_"RPH: "_$S(PSGLRPH]""&(PSGLRPH'="0"):PSGLRPH,1:"_____")
"RTN","PSGMUTL",85,0)
 . S X=X_$$BLANK(39-$L(X))_"RN: "_$S(PSGLRN]""&(PSGLRN'="0"):PSGLRN,1:"_____")
"RTN","PSGMUTL",86,0)
 . S MARLB(L)=X
"RTN","PSGMUTL",87,0)
 E  D
"RTN","PSGMUTL",88,0)
 . S:L=5 MARLB(5)="",L=6
"RTN","PSGMUTL",89,0)
 . S X=$E("WS",1,PSGLWS*2)
"RTN","PSGMUTL",90,0)
 . S X=X_$$BLANK(4-$L(X))_$S(PSGLSM:$E("HSM",PSGLSM,3),1:"")
"RTN","PSGMUTL",91,0)
 . S X=X_$$BLANK(8-$L(X))_$E("NF",1,PSGLNF*2)
"RTN","PSGMUTL",92,0)
 . S X=X_$$BLANK(29-$L(X))_"RPH: "_$S(PSGLRPH]""&(PSGLRPH'="0"):PSGLRPH,1:"____")
"RTN","PSGMUTL",93,0)
 . S X=X_$$BLANK(39-$L(X))_"RN: "_$S(PSGLRN]""&(PSGLRN'="0"):PSGLRN,1:"_____")
"RTN","PSGMUTL",94,0)
 . S MARLB(L)=X
"RTN","PSGMUTL",95,0)
 S MARLB=L
"RTN","PSGMUTL",96,0)
 I MARLB>6!($G(TS)>6) D MARLB2
"RTN","PSGMUTL",97,0)
 Q
"RTN","PSGMUTL",98,0)
 ;
"RTN","PSGMUTL",99,0)
MARLB2 ;Slit array into 2 labels.
"RTN","PSGMUTL",100,0)
 ;TS array must be defined. (TS^PSGMAR3(ADMIN TIMES))
"RTN","PSGMUTL",101,0)
 NEW INIT,X,Y
"RTN","PSGMUTL",102,0)
 S INIT=MARLB(MARLB),Y=6
"RTN","PSGMUTL",103,0)
 F X=6:1:MARLB S X(X)=MARLB(X)
"RTN","PSGMUTL",104,0)
 F X=6:1:($S(MARLB>TS:MARLB,1:TS)-1) D
"RTN","PSGMUTL",105,0)
 . I (X#6)=0 S MARLB(X)="See next label for continuation" Q
"RTN","PSGMUTL",106,0)
 . I Y<(MARLB) S MARLB(X)=X(Y),Y=Y+1 Q
"RTN","PSGMUTL",107,0)
 . S MARLB(X)=""
"RTN","PSGMUTL",108,0)
 S X=X+1 F Y=Y:1:MARLB-1 S MARLB(X)=$G(X(Y)),X=X+1
"RTN","PSGMUTL",109,0)
 F X=X:0 Q:(X#6)=0  S MARLB(X)="",X=X+1
"RTN","PSGMUTL",110,0)
 S MARLB(X)=INIT,MARLB=X
"RTN","PSGMUTL",111,0)
 Q
"RTN","PSGMUTL",112,0)
 N X F X=6:1:MARLB S X(X+1)=MARLB(X)
"RTN","PSGMUTL",113,0)
 S MARLB(6)="See next label for continuation"
"RTN","PSGMUTL",114,0)
 F X=7:1:MARLB S MARLB(X)=X(X)
"RTN","PSGMUTL",115,0)
 F X=X+1:1:11 S MARLB(X)=""
"RTN","PSGMUTL",116,0)
 S MARLB(12)=X(MARLB+1)
"RTN","PSGMUTL",117,0)
 S MARLB=12
"RTN","PSGMUTL",118,0)
 Q
"RTN","PSGMUTL",119,0)
 ;
"RTN","PSGNE3")
0^49^B29480677
"RTN","PSGNE3",1,0)
PSGNE3 ;BIR/CML3,MLM-DETERMINE DEFAULT FOR START & STOP TIMES ;09 Feb 99 / 7:50 AM
"RTN","PSGNE3",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,26,47,50,63,69,105,80,111**;16 DEC 97
"RTN","PSGNE3",3,0)
 ;
"RTN","PSGNE3",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGNE3",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGNE3",6,0)
 ;
"RTN","PSGNE3",7,0)
 N X1,X2,Y
"RTN","PSGNE3",8,0)
NOW ;
"RTN","PSGNE3",9,0)
 ;D NOW^%DTC S PSGDT=+$E(%,1,12),PSGNESD=$$ENSD(PSGSCH,PSGS0Y,PSGDT,PSGDT)
"RTN","PSGNE3",10,0)
 S:'$D(PSGST) PSGST=""
"RTN","PSGNE3",11,0)
 S PSGDT=$$DATE^PSJUTL2(),PSGNESD=$$ENSD($S(PSGST["P":"PRN",1:PSGSCH),PSGS0Y,PSGDT,PSGDT)
"RTN","PSGNE3",12,0)
 ;
"RTN","PSGNE3",13,0)
STOP ; exit when start date found
"RTN","PSGNE3",14,0)
 K ET,F,FT,LT,NT,PSGNE3,TT G:$D(PSGOES)!$D(PSGODF) SF S PSGNESDO=$$ENDD^PSGMI(PSGNESD)
"RTN","PSGNE3",15,0)
 Q
"RTN","PSGNE3",16,0)
 ;
"RTN","PSGNE3",17,0)
ENFD(PSGDT) ; find default stop date
"RTN","PSGNE3",18,0)
 N X1,X2,X3DMIN,Y
"RTN","PSGNE3",19,0)
SF I '$O(^PS(55,PSGP,5,"AUS",PSGDT)),'$D(^PS(53.1,"AC",PSGP)),+$G(^PS(55,PSGP,5.1)) S $P(^PS(55,PSGP,5.1),U)=""
"RTN","PSGNE3",20,0)
 I $G(PSGOEA)="R",$P(PSJSYSW0,"^",4) D ENWALL(%,0,PSGP)
"RTN","PSGNE3",21,0)
 S PSGNEFD="",PSGNEW=$S('$P(PSJSYSW0,U,4):0,+$G(^PS(55,PSGP,5.1))'>PSGDT:0,1:+$G(^PS(55,PSGP,5.1))) S:PSGNEW<PSGNESD PSGNEW=0
"RTN","PSGNE3",22,0)
 I PSGNEW,($G(PSGOEA)="R") S X1=$P(%,"."),X2=3 D C^%DTC S PSGNEW=$S($P(X,".")_(PSGNESD#1)'>PSGNEW:PSGNEW,1:0)
"RTN","PSGNE3",23,0)
 I PSGST="O" S PSGNEFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGNESD,PSGP) I PSGNEFD]"" G OUT
"RTN","PSGNE3",24,0)
 I PSGST'="O",PSGSCH]"",$S(PSGSCH="ONCE":1,PSGSCH="STAT":1,PSGSCH="ONE TIME":1,1:0)!($P($G(^PS(51.1,+$O(^PS(51.1,"B",PSGSCH,0)),0)),"^",5)="O") S PSGNEFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGNESD,PSGP) I PSGNEFD]"" G OUT
"RTN","PSGNE3",25,0)
 S X1=$P(PSGNESD,"."),X2=$S($P(PSJSYSW0,"^",3):+$P(PSJSYSW0,"^",3),1:14)
"RTN","PSGNE3",26,0)
 D
"RTN","PSGNE3",27,0)
 . N A,B
"RTN","PSGNE3",28,0)
 . Q:'$D(PSGORD)  S A=""
"RTN","PSGNE3",29,0)
 . I PSGORD["P" S A=$G(^PS(53.1,+PSGORD,"DSS"))
"RTN","PSGNE3",30,0)
 . I PSGORD["U" S A=$G(^PS(55,PSGP,5,+PSGORD,8))
"RTN","PSGNE3",31,0)
 . I PSGORD["I" S A=$G(^PS(55,PSGP,"IV",+PSGORD,"DSS"))
"RTN","PSGNE3",32,0)
 . S A=$P(A,"^") I A]"" S X2=14 I $D(^PS(53.46,"B",A)) S B=$O(^PS(53.46,"B",A,"")),X2=$P(^PS(53.46,B,0),"^",2) I X2="" S X2=14
"RTN","PSGNE3",33,0)
 D C^%DTC
"RTN","PSGNE3",34,0)
 I $G(PSGNEDFD) I $S($P(PSGNEDFD,"^")["L":PSGS0XT!PSGS0Y,1:1) D DFD
"RTN","PSGNE3",35,0)
 ;I PSGNEW S PSGNEFD=PSGNEW G OUT
"RTN","PSGNE3",36,0)
 I $G(PSGORD),$G(PSGFD) S X3DMIN=$$GETDUR^PSJLIVMD(PSGP,+$G(PSGORD),$S($G(PSGORD)["P":"P",$G(PSGORD)["V":"IV",1:5),1) I X3DMIN]"" D  I PSGNEFD]"" G OUT
"RTN","PSGNE3",37,0)
 . S X3DMIN=$$DURMIN^PSJLIVMD(X3DMIN) I $G(X3DMIN) S PSGNEFD=$$FMADD^XLFDT(PSGNESD,,,X3DMIN)
"RTN","PSGNE3",38,0)
 S X=+(X_$S($P(PSJSYSW0,"^",7):"."_$P(PSJSYSW0,"^",7),1:(PSGNESD#1)))
"RTN","PSGNE3",39,0)
 S PSGNEFD=$S('PSGNEFD:X,X<PSGNEFD:X,1:PSGNEFD) I PSGNEW,(PSGNEW<PSGNEFD),$P(PSJSYSW0,U,4) D
"RTN","PSGNE3",40,0)
 . I $G(PSGORD),$G(PSGRDTX) I PSGORD=$P(PSGRDTX,U,4),PSGNEW<PSGRDTX Q   ; Requested Start is after Stop
"RTN","PSGNE3",41,0)
 . S PSGNEFD=PSGNEW
"RTN","PSGNE3",42,0)
 ;
"RTN","PSGNE3",43,0)
OUT ;
"RTN","PSGNE3",44,0)
 S:$G(PSGSDX) PSGNESD=PSGSDX S:$G(PSGFDX) PSGNEFD=PSGFDX
"RTN","PSGNE3",45,0)
 I '$D(PSGODF),'$D(PSGOES) S PSGNEFDO=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGNE3",46,0)
 K PSGDL,PSGNEW Q
"RTN","PSGNE3",47,0)
 ;
"RTN","PSGNE3",48,0)
DFD ;
"RTN","PSGNE3",49,0)
 I $P(PSGNEDFD,"^")["D" S X1=$P(PSGNESD,"."),X2=+PSGNEDFD D C^%DTC S X=+(X_"."_$S($P(PSJSYSW0,"^",7):$P(PSJSYSW0,"^",7),1:$P(PSGNESD,".",2)))
"RTN","PSGNE3",50,0)
 I $P(PSGNEDFD,"^")["L" S PSGDL=+PSGNEDFD D EN1^PSGDL
"RTN","PSGNE3",51,0)
 S PSGNEFD=$S(PSGNEW<X&PSGNEW:PSGNEW,1:X) Q:$P(PSGNEDFD,"^")'["D"!'$P(PSJSYSW0,"^",4)!PSGNEW
"RTN","PSGNE3",52,0)
 Q
"RTN","PSGNE3",53,0)
 ;
"RTN","PSGNE3",54,0)
ENOR ;
"RTN","PSGNE3",55,0)
 K PSGOES,PSGODF S X=$P($G(^PS(53.1,DA,2)),"^")
"RTN","PSGNE3",56,0)
 S $P(^PS(53.1,DA,0),"^",7)=$S(X="PRN":"P",X="ONCE":"O",X="STAT":"O",X="ONE TIME":"O",X="ON CALL":"OC",$P(PSGNEDFD,"^",3)]"":$P(PSGNEDFD,"^",3),1:"C") D PSGNE3 S X=PSGNESD
"RTN","PSGNE3",57,0)
 Q
"RTN","PSGNE3",58,0)
 ;
"RTN","PSGNE3",59,0)
ENSET0(DFN) ; Set "0" node and build xrefs for entries found without one.
"RTN","PSGNE3",60,0)
 N DA,DIK S ^PS(55,DFN,0)=DFN,DIK="^PS(55,",DIK(1)=.01,DA=DFN D EN^DIK
"RTN","PSGNE3",61,0)
 S $P(^PS(55,DFN,5.1),"^",11)=2 ; Mark as converted for POE
"RTN","PSGNE3",62,0)
 Q
"RTN","PSGNE3",63,0)
 ;
"RTN","PSGNE3",64,0)
ENWALL(SD,FD,DFN) ; Update default stop date if appropriate.
"RTN","PSGNE3",65,0)
 N WALL,NWALL,X1,X2,X3
"RTN","PSGNE3",66,0)
 D NOW^%DTC S X3=%
"RTN","PSGNE3",67,0)
 S WALL=+$G(^PS(55,DFN,5.1)),X1=$P(SD,"."),X2=3 D C^%DTC I +(X_"."_$P(SD,".",2))'>+WALL Q
"RTN","PSGNE3",68,0)
 S X1=$P(X3,"."),X2=$S($P(PSJSYSW0,U,3):+$P(PSJSYSW0,U,3),1:14) D C^%DTC
"RTN","PSGNE3",69,0)
 S NWALL=X_$S($P(PSJSYSW0,U,7):"."_$P(PSJSYSW0,U,7),1:SD#1)
"RTN","PSGNE3",70,0)
 S $P(^PS(55,DFN,5.1),U)=+$S(FD>NWALL:FD,1:NWALL)
"RTN","PSGNE3",71,0)
 Q
"RTN","PSGNE3",72,0)
 ;
"RTN","PSGNE3",73,0)
ENSD(SCH,AT,LI,OSD) ;Find start date/time for orders.
"RTN","PSGNE3",74,0)
 ;SCH=schedule,AT=admin times,LI=login date/time,OSD=Renewed orders start
"RTN","PSGNE3",75,0)
 I $G(APPT),$G(PSGORD)["P" S XD=$$DATE2^PSJUTL2(APPT) Q XD
"RTN","PSGNE3",76,0)
 N X,OSDLI D
"RTN","PSGNE3",77,0)
 .I $L(LI)<13 S X=LI Q
"RTN","PSGNE3",78,0)
 .I $L(LI)=14 S X=$E(LI,13,14) S:X>29 X=$E(LI,1,12)_5 S:X'>29 X=$E(LI,1,12)_1 Q
"RTN","PSGNE3",79,0)
 .I $L(LI)=13 S X=$E(LI,13)_0 S:X>29 X=$E(LI,1,12)_5 S:X'>29 X=$E(LI,1,12)_1 Q
"RTN","PSGNE3",80,0)
 I $G(LI) S:(LI=$G(OSD)) OSDLI=1
"RTN","PSGNE3",81,0)
 S LI=+$FN(X,"",4) I '$P(LI,".",2) S LI=$$FMADD^XLFDT(LI,-1,0,0,0)_.24
"RTN","PSGNE3",82,0)
 I $G(OSDLI) S OSD=LI K OSDLI
"RTN","PSGNE3",83,0)
 ;S LI=+$E(LI,1,12) I '$P(LI,".",2) S LI=$$FMADD^XLFDT(LI,-1,0,0,0)_.24
"RTN","PSGNE3",84,0)
 I $G(PSJSYSW0)=""!($P(PSJSYSW0,U,5)=2) Q LI
"RTN","PSGNE3",85,0)
 S:SCH["PRN" AT=""
"RTN","PSGNE3",86,0)
 N INT,PSG S:(SCH'["PRN"&(SCH'?1"Q".N1"H")&(LI'=OSD)&('AT)&($G(PSGST)'="O")) AT=$E(OSD,9,10) S OSD=$E(OSD,1,10)
"RTN","PSGNE3",87,0)
 S INT=$S(SCH="QD":24,SCH="QOD":48,SCH="QH":1,SCH?1"Q".N1"D":(+$P(SCH,"Q",2)*24),SCH?1"Q".N1"H":+$P(SCH,"Q",2),LI=OSD:24,1:24)
"RTN","PSGNE3",88,0)
 S:INT=24 OSD=$$FMADD^XLFDT(LI,0,-INT,0,0)
"RTN","PSGNE3",89,0)
 I 'AT,INT>23 S:$P(PSJSYSW0,U,5)!($E(LI,11,12)>30) AT=$E($$FMADD^XLFDT(LI,0,1,0,0),9,10) S:AT="00" AT=24 S:'AT AT=$E(LI,9,10)
"RTN","PSGNE3",90,0)
 I SCH?1"Q".N1"H",'AT S ND=OSD,PSG(+ND)="" S:(INT>24)&('$G(PSJREN)) INT=24 S DAYS=INT\24,HRS=(-INT\24*24+INT) F  S ND=$$FMADD^XLFDT(ND,DAYS,HRS),PSG(+ND)="" Q:ND>LI
"RTN","PSGNE3",91,0)
 Q:INT=24&'$L(AT,"-") $E(LI,1,8)_AT
"RTN","PSGNE3",92,0)
 ;Q:$P(PSJSYSW0,U,5)&(AT=23) $E(LI,1,8)_24
"RTN","PSGNE3",93,0)
 I '$O(PSG(LI)) S X=$S(OSD>1:OSD,LI>1:LI,1:$$DATE^PSJUTL2) D
"RTN","PSGNE3",94,0)
 .F  S ND=X D  Q:ND>LI  S:(INT>24)&('$G(PSJREN)) INT=24 S DAYS=INT\24,HRS=(-INT\24*24+INT) S X=$$FMADD^XLFDT($S($P(ND,".",2)=24:$P(ND,".")_".23",1:ND),DAYS,HRS) S:$P(X,".")'>$P(ND,".") X=$$FMADD^XLFDT(X,1,0,0,0)
"RTN","PSGNE3",95,0)
 ..F Y=1:1 S AT1=$P(AT,"-",Y) Q:'AT1  S ND=ND\1_"."_AT1,PSG(+ND)=""
"RTN","PSGNE3",96,0)
 Q:$P(PSJSYSW0,U,5) $O(PSG(LI))
"RTN","PSGNE3",97,0)
 S INT="" F ND=0:0 S ND=$O(PSG(ND)) S X=$$FMDIFF^XLFDT(LI,ND,2) S:X<0 X=-X Q:INT&(X'<INT)  S INT=+X,OND=ND Q:INT=0
"RTN","PSGNE3",98,0)
 Q OND
"RTN","PSGOD")
0^94^B18806763
"RTN","PSGOD",1,0)
PSGOD ;BIR/CML3-CREATES NEW ORDER FROM OLD ONE ;22 SEP 97 / 2:56 PM 
"RTN","PSGOD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**67,58,111**;16 DEC 97
"RTN","PSGOD",3,0)
 ;
"RTN","PSGOD",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOD",5,0)
 ;
"RTN","PSGOD",6,0)
 I $P($G(^PS(55,PSGP,5,+PSJORD,0)),"^",22) D  Q
"RTN","PSGOD",7,0)
 .W !,"This order is marked 'Not To Be Given' and can't be copied!" H 2
"RTN","PSGOD",8,0)
 F  W !!,"Do you want to copy this order" S %=2 D YN^DICN Q:%  D CH
"RTN","PSGOD",9,0)
 G:%'=1 DONE
"RTN","PSGOD",10,0)
 ;
"RTN","PSGOD",11,0)
 W !!,"...copying..." N OLDON
"RTN","PSGOD",12,0)
 N PSGPDRG
"RTN","PSGOD",13,0)
 S PSGOEPR=$P($G(^PS(55,PSGP,5.1)),"^",2),OLDON=PSGORD
"RTN","PSGOD",14,0)
 ;K PSGODN S F=$S((PSGORD["N")!(PSGORD["P"):"^PS(53.1,"_+PSGORD_",",1:"^PS(55,"_PSGP_",5,"_+PSGORD_",") F N=0,.2,2,6 S PSGODN(N)=$G(@(F_N_")"))
"RTN","PSGOD",15,0)
 K PSGODN S F=$S(PSGORD["P":"^PS(53.1,"_+PSGORD_",",1:"^PS(55,"_PSGP_",5,"_+PSGORD_",") F N=0,.2,2,6 S PSGODN(N)=$G(@(F_N_")"))
"RTN","PSGOD",16,0)
 S PSGPR=$P(PSGODN(0),"^",2),PSGMR=$P(PSGODN(0),"^",3),PSGSM=$P(PSGODN(0),"^",5),PSGHSM=$P(PSGODN(0),"^",6),PSGST=$P(PSGODN(0),"^",7)
"RTN","PSGOD",17,0)
 S PSGPDRG=+PSGODN(.2),PSGDO=$P(PSGODN(.2),"^",2)
"RTN","PSGOD",18,0)
 S PSGSI=PSGODN(6)
"RTN","PSGOD",19,0)
 S PSGODN(3)=0 F Q=0:0 S Q=$O(@(F_"3,"_Q_")")) Q:'Q  I $D(^(Q,0)) S PSGODN(3,Q)=^(0),PSGODN(3)=PSGODN(3)+1 S ^PS(53.45,PSJSYSP,1,Q,0)=^(0)
"RTN","PSGOD",20,0)
 ;S:PSGODN(12)>0 ^PS(53.45,PSJSYSP,4,0)="^53.4504" S:PSGODN(3)>0 ^PS(53.45,PSJSYSP,1,0)="^53.4501"
"RTN","PSGOD",21,0)
 S:PSGODN(3)>0 ^PS(53.45,PSJSYSP,1,0)="^53.4501"
"RTN","PSGOD",22,0)
 S (PSGODN(1),Q)=0 F  S Q=$O(@(F_"1,"_Q_")")) Q:'Q  S ND=$G(^(Q,0)) I ND,'$P(ND,"^",3) S PSGODN(1)=PSGODN(1)+1,PSGODN(1,PSGODN(1))=$P(ND,"^",1,2) S ^PS(53.45,PSJSYSP,2,PSGODN(1),0)=^(0)
"RTN","PSGOD",23,0)
 S PSGS0Y=$P(PSGODN(2),"^",5),PSGS0XT=$P(PSGODN(2),"^",6),PSGNESD="",PSGSCH=$P(PSGODN(2),U)
"RTN","PSGOD",24,0)
 S PSGODF=1,PSGNEDFD=$P($$GTNEDFD^PSGOE7("U",+PSGPDRG),U)_"^^"_PSGST_"^"_PSGSCH
"RTN","PSGOD",25,0)
 W "." D ^PSGNE3
"RTN","PSGOD",26,0)
 K PSGEFN,PSGOEEF,PSGOEE,PSGOEOS S PSGEFN="1:13" F X=1:1:13 S PSGEFN(X)=""
"RTN","PSGOD",27,0)
 S PSGPDN=$$OINAME^PSJLMUTL(PSGPDRG),PSGOINST="",PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSGOD",28,0)
 S PSGAT=PSGS0Y,PSGEBN=DUZ,PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGEBN=$$ENNPN^PSGMI(DUZ),PSGSTAT=$S(PSGOEAV:"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOD",29,0)
 W "." D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGNESD_"^^"_PSGNEFD)
"RTN","PSGOD",30,0)
 I $G(PSGSCH)]"" D
"RTN","PSGOD",31,0)
 .N X S X=PSGSCH N SWD,SDW,XABB,QX D ENOS^PSGS0 I $G(X)=""!$G(PSJNSS) S CHK=1 K PSJNSS Q
"RTN","PSGOD",32,0)
 .I $G(PSGAT)="",$G(PSGS0Y) S PSGAT=PSGS0Y
"RTN","PSGOD",33,0)
 .I $G(PSGS0XT)="D",$G(PSGS0Y)="" S CHK=1 D  K PSJNSS
"RTN","PSGOD",34,0)
 ..W ! K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules    " D ^DIR K DIR
"RTN","PSGOD",35,0)
 S PSGSD=PSGNESD,PSGFD=PSGNEFD
"RTN","PSGOD",36,0)
 K PSJACEPT S VALMBCK="Q" D:$D(Y) EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOD",37,0)
 I $G(PSJACEPT)=1 S VALMBCK="",PSJNOO=$$ENNOO^PSJUTL5("N")
"RTN","PSGOD",38,0)
 I '$G(PSJACEPT)!($G(PSJNOO)<0) W !!,"Order not copied." D PAUSE^VALM1 G ORIG
"RTN","PSGOD",39,0)
 S PSGNESD=PSGSD,PSGNEFD=PSGFD
"RTN","PSGOD",40,0)
 K PSGOEE D ^PSGOETO S PSJORD=PSGORD I PSGOEAV D
"RTN","PSGOD",41,0)
 .I '$D(PSGOEE),+PSJSYSU=3 D EN^PSGPEN(PSGORD)
"RTN","PSGOD",42,0)
 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),^PSGOE1,EN^VALM("PSJ LM UD ACTION")
"RTN","PSGOD",43,0)
 ;
"RTN","PSGOD",44,0)
 S PSGCANFL=0,(PSGORD,PSJORD)=OLDON W !!,"You are finished with the new order.",!,"The following ACTION prompt is for the original order."
"RTN","PSGOD",45,0)
 K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOD",46,0)
ORIG ;Redisplay original order
"RTN","PSGOD",47,0)
 D GETUD^PSJLMGUD(PSGP,OLDON),INIT^PSJLMUDE(PSGP,OLDON)
"RTN","PSGOD",48,0)
DONE ;
"RTN","PSGOD",49,0)
 K %,%H,%I,DA,F,N,PSGODN,PSGODF,PSGS0XT,PSGS0Y,PSGNESD,PSGTOL,PSGTOO,PSGUOW,X,Y,^PS(53.45,PSJSYSP,1),^PS(53.45,PSJSYSP,2)
"RTN","PSGOD",50,0)
 K PSGPR,PSGMR,PSGSM,PSGHSM,PSGST,PSGPDRG,PSGDO,PSGNEDFD,PSGSCH,PSGNEFD
"RTN","PSGOD",51,0)
 Q
"RTN","PSGOD",52,0)
 ;
"RTN","PSGOD",53,0)
CH ;
"RTN","PSGOD",54,0)
 W !!?2,"Answer 'YES' to have a new, non-verified order created for this patient,",!,"using the information from this order.  (The START and STOP dates will be",!,"recalculated.)  Enter 'NO' (or '^') to stop now." Q
"RTN","PSGOD",55,0)
 ;
"RTN","PSGOD",56,0)
WH ;
"RTN","PSGOD",57,0)
 W !!?2,"Answer 'YES' to take action on this new order.  Enter 'NO' (or '^') to return",!,"to the original order now." Q
"RTN","PSGOE4")
0^101^B26615644
"RTN","PSGOE4",1,0)
PSGOE4 ;BIR/CML3-REGULAR ORDER ENTRY ;06 Feb 2001  4:31 PM
"RTN","PSGOE4",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**2,50,64,58,111**;16 DEC 97
"RTN","PSGOE4",3,0)
 ;
"RTN","PSGOE4",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGOE4",5,0)
 ;
"RTN","PSGOE4",6,0)
 ;K PSGOES S PSGMR=$S($P(PSGNEDFD,"^",2):$P(PSGNEDFD,"^",2),1:PSGOEDMR),PSGSCH=$P(PSGNEDFD,"^",4),PSGPR=$S($D(PSJOERR):PSJORPV,1:PSGOEPR),(PSGSD,PSGFD,PSGSM,PSGHSM,PSGUD,PSGSI,PSGOROE1,PSGNEFD,PSGMRN)=""
"RTN","PSGOE4",7,0)
 K PSGOES S PSGMR=$S($P(PSGNEDFD,"^",2):$P(PSGNEDFD,"^",2),1:PSGOEDMR),PSGSCH=$P(PSGNEDFD,"^",4),PSGPR=PSGOEPR,(PSGSD,PSGFD,PSGSM,PSGHSM,PSGUD,PSGSI,PSGOROE1,PSGNEFD,PSGMRN)=""
"RTN","PSGOE4",8,0)
 S:PSGMR PSGMRN=$S('$P(PSGNEDFD,"^",2):"ORAL",'$D(^PS(51.2,PSGMR,0)):PSGMR,$P(^(0),"^")]"":$P(^(0),"^"),1:PSGMR) I PSGPR S PSGPRN=$P($G(^VA(200,PSGPR,0)),"^") S:PSGPRN="" PSGPRN=PSGPR
"RTN","PSGOE4",9,0)
 S PSGST=$S($P(PSGNEDFD,"^",3)]"":$P(PSGNEDFD,"^",3),1:"C"),PSGSTN=$$ENSTN^PSGMI(PSGST),F1=53.1 K PSGFOK S PSGFOK(2)=""
"RTN","PSGOE4",10,0)
 S:$P(PSJSYSU,";",4) PSGFOK(2)="" K ^PS(53.45,PSJSYSP,1),^(2) I PSGDRG S ^(2,0)="^53.4502P^"_PSGDRG_"^1",^(1,0)=PSGDRG,^PS(53.45,PSJSYSP,2,"B",PSGDRG,1)=""
"RTN","PSGOE4",11,0)
 ;I '$D(PSJOERR) S PSJNOO=$S($P(PSJSYSU,";",2):"E",1:"W"),PSJNOON=$S(PSJNOO="E":"PROVIDER ENTERED",1:"WRITTEN")
"RTN","PSGOE4",12,0)
 ;
"RTN","PSGOE4",13,0)
109 ; dosage ordered
"RTN","PSGOE4",14,0)
 I $P(PSJSYSU,";",4) D GETDOSE^PSJDOSE(PSGDRG) G:PSGOROE1 DONE G:'$G(PSGOE3) 3
"RTN","PSGOE4",15,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE4",16,0)
 I X="" S X=PSGDO ;I X="" W $C(7),"  (Required)" G 109
"RTN","PSGOE4",17,0)
 S PSGF2=109 I X="@" S PSGDO="" ;W $C(7),"  (Required)" G 109
"RTN","PSGOE4",18,0)
 I X="@" D DEL G:%'=1 109 S (PSGDO,PSGFOK(109),PSGUD)="" G 3
"RTN","PSGOE4",19,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,109) G 109
"RTN","PSGOE4",20,0)
 I $E(X)="^" D FF G:Y>0 @Y G 109
"RTN","PSGOE4",21,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE4",22,0)
 I $S(X="":0,X?.E1C.E:1,$L(X)>20:1,X="":1,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(53.1,109) G 109
"RTN","PSGOE4",23,0)
 S PSGDO=X,PSGFOK(109)=""
"RTN","PSGOE4",24,0)
 ;
"RTN","PSGOE4",25,0)
13 ; units per dose
"RTN","PSGOE4",26,0)
 ;/** NO LONGER USE WITH POE
"RTN","PSGOE4",27,0)
 Q:$G(PSGOE3)
"RTN","PSGOE4",28,0)
 G:'$P(PSJSYSU,";",4) 3 I $D(PSGFOK(13)) S PSGFOK(13)=1 D 2^PSGOE42 S PSGFOK(13)="" G 3
"RTN","PSGOE4",29,0)
 ;
"RTN","PSGOE4",30,0)
A13 ;
"RTN","PSGOE4",31,0)
 W !,"UNITS PER DOSE: ",$S(PSGUD:PSGUD_"// ",1:"") R X:DTIME I X="^"!'$T S PSGOROE1=1 G DONE
"RTN","PSGOE4",32,0)
 I X="" W:'PSGUD "  (1)" G S13
"RTN","PSGOE4",33,0)
 S PSGF2=13 I X="@",'PSGUD W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,13) G A13
"RTN","PSGOE4",34,0)
 I X="@" D DEL G:%'=1 13 S PSGUD="" G S13
"RTN","PSGOE4",35,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,13) G A13
"RTN","PSGOE4",36,0)
 I $E(X)="^" D FF G:Y>0 @Y G A13
"RTN","PSGOE4",37,0)
 I X?1.2N1"/"1.2N S X=+$J(+X/$P(X,"/",2),0,2) W "  ("_$E("0",X<1)_X_")"
"RTN","PSGOE4",38,0)
 I $S($L(X)>12:1,X'=+X:1,X>50:1,X<0:1,1:X?.N1"."3.N) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,13) G 13
"RTN","PSGOE4",39,0)
 S PSGUD=X W:'X "  (1)"
"RTN","PSGOE4",40,0)
 ;
"RTN","PSGOE4",41,0)
S13 ;
"RTN","PSGOE4",42,0)
 S PSGFOK(13)="" I PSGDRG S $P(^PS(53.45,PSJSYSP,2,1,0),"^",2)=PSGUD
"RTN","PSGOE4",43,0)
 ;
"RTN","PSGOE4",44,0)
3 ; med route
"RTN","PSGOE4",45,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE4",46,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) S PSGFOK(3)="" G 7
"RTN","PSGOE4",47,0)
 S PSGF2=3 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,2) G 3
"RTN","PSGOE4",48,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE4",49,0)
 I $E(X)="^" D FF G:Y>0 @Y G 3
"RTN","PSGOE4",50,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G 3
"RTN","PSGOE4",51,0)
 S PSGMR=+Y,PSGMRN=$P(Y(0),"^") S PSGFOK(3)=""
"RTN","PSGOE4",52,0)
 ;
"RTN","PSGOE4",53,0)
7 ; schedule type
"RTN","PSGOE4",54,0)
 Q:$G(PSGOE3)
"RTN","PSGOE4",55,0)
 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOROE1=1 W $C(7) G DONE
"RTN","PSGOE4",56,0)
 I X="" S:PSGST="OC" PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" W "  "_PSGSTN S PSGFOK(7)="" S $P(PSGNEDFD,"^",3)=PSGST G:PSGST="OC" 8^PSGOE41 G 26
"RTN","PSGOE4",57,0)
 S PSGF2=7 I X="@"!(X?1."?") W:X="@" $C(7),"  ??  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,7) G 7
"RTN","PSGOE4",58,0)
 I $E(X)="^" D FF G:Y>0 @Y G 7
"RTN","PSGOE4",59,0)
 I X="OC"!(X="R") S PSGST=X,$P(PSGNEDFD,"^",3)=X,PSGSTN=$S(X="R":"FILL on REQUEST",1:"ON CALL") W "  "_PSGSTN S PSGFOK(7)="" G:X="R" 26 S PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE4",60,0)
 F Y="C^CONTINUOUS","O^ONE TIME","OC^ON CALL","P^PRN","R^FILL on REQUEST" I $P($P(Y,"^",2),X)="" W $P($P(Y,"^",2),X,2) S PSGST=$P(Y,"^"),PSGSTN=$P(Y,"^",2),$P(PSGNEDFD,"^",3)=PSGST Q
"RTN","PSGOE4",61,0)
 E  W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,7) G 7
"RTN","PSGOE4",62,0)
 I PSGST="OC"!(PSGST="R") S PSGFOK(7)="" G:PSGST="R" 26 S PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE4",63,0)
 S PSGFOK(7)=""
"RTN","PSGOE4",64,0)
 ;
"RTN","PSGOE4",65,0)
26 ; schedule
"RTN","PSGOE4",66,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE4",67,0)
 ;*S PSGF2=26 S:X="" X=PSGSCH I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE4",68,0)
 S PSGF2=26 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE4",69,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE4",70,0)
 I $E(X)="^" D FF G:Y>0 @Y G 26
"RTN","PSGOE4",71,0)
 N PSJSLUP S PSJSLUP=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE4",72,0)
 S PSGSCH=X,$P(PSGNEDFD,"^",4)=X,PSGFOK(26)="" I PSGS0XT="O" S $P(PSGNEDFD,"^",3)="O",PSGST="O",PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",73,0)
 I $G(PSGOE3) D  Q
"RTN","PSGOE4",74,0)
 . S PSGSCH=X,PSGST=$S(PSGS0XT="O":"O",PSGST="R":"R",X["PRN":"P",X="ON CALL":"OC",PSGST]"":PSGST,1:"C"),PSGFOK(26)=""
"RTN","PSGOE4",75,0)
 . S $P(PSGNEDFD,"^",3)=PSGST S:PSGSCH=""!(X?1." ") PSGSCH="PRN"
"RTN","PSGOE4",76,0)
 . S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",77,0)
 ;***
"RTN","PSGOE4",78,0)
 ;Q:$G(PSGOE3)
"RTN","PSGOE4",79,0)
 ;
"RTN","PSGOE4",80,0)
 G ^PSGOE41
"RTN","PSGOE4",81,0)
 ;
"RTN","PSGOE4",82,0)
DONE ;
"RTN","PSGOE4",83,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE4",84,0)
 K F,F0,F1,PSGF2,F3,PSG,PSGSD,SDT Q
"RTN","PSGOE4",85,0)
 ;
"RTN","PSGOE4",86,0)
FF ; up-arrow to another field
"RTN","PSGOE4",87,0)
 D ENFF^PSGOEM I Y>0,Y'=109,Y'=13,Y'=3,Y'=7,Y'=26 S:Y=2 FB=PSGF2_"^PSGOE4" S Y=Y_"^PSGOE4"_$S("^39^8^10^25^"[("^"_Y_"^"):1,1:2)
"RTN","PSGOE4",88,0)
 Q
"RTN","PSGOE4",89,0)
 ;
"RTN","PSGOE4",90,0)
DEL ; delete entry
"RTN","PSGOE4",91,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE4",92,0)
 Q
"RTN","PSGOE41")
0^104^B14905342
"RTN","PSGOE41",1,0)
PSGOE41 ;BIR/CML3-REGULAR ORDER ENTRY (CONT.) ;09 JAN 97 / 9:13 AM 
"RTN","PSGOE41",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,63,64,69,58,111**;16 DEC 97
"RTN","PSGOE41",3,0)
 ;
"RTN","PSGOE41",4,0)
 ; Reference to %DT is supported by DBIA 10003.
"RTN","PSGOE41",5,0)
 ; Reference to %DTC is supported by DBIA 10000.
"RTN","PSGOE41",6,0)
 ; Reference to ^DICN is supported by DBIA 10009.
"RTN","PSGOE41",7,0)
 ;
"RTN","PSGOE41",8,0)
39 ; admin times
"RTN","PSGOE41",9,0)
 G:$P(PSGNEDFD,"^",3)="P" 8
"RTN","PSGOE41",10,0)
 I $$ODD^PSGS0(PSGS0XT) G 8
"RTN","PSGOE41",11,0)
 W !,"ADMIN TIMES: "_$S(PSGS0Y:PSGS0Y_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",12,0)
 I X="",($G(PSGS0XT)'="D") S PSGFOK(39)="" G 8
"RTN","PSGOE41",13,0)
 I X="",$G(PSGS0XT)="D" I $L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGS0Y)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE41",14,0)
 S PSGF2=39 I $E(X)="^" D FF G:Y>0 @Y G 39
"RTN","PSGOE41",15,0)
 I (PSGS0XT="D")&('$G(X)!(X["@"&($P($G(X),"@",2)))) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G 39
"RTN","PSGOE41",16,0)
 .W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE41",17,0)
 ;I X="@",'PSGS0Y!(PSGS0XT="D")!(PSGSCH["@") W $C(7),"  ??" S X="?" W:PSGS0XT="D"!(PSGSCH["@") !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39) G 39
"RTN","PSGOE41",18,0)
 I X="@" D DEL G:%'=1 39 S (PSGFOK(39),PSGS0Y)="" G 8
"RTN","PSGOE41",19,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,39) G 39
"RTN","PSGOE41",20,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,39) G 39
"RTN","PSGOE41",21,0)
 S (PSGAT,PSGS0Y)=X,PSGFOK(39)=""
"RTN","PSGOE41",22,0)
 ;
"RTN","PSGOE41",23,0)
8 ; special instructions
"RTN","PSGOE41",24,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":$P(PSGSI,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",25,0)
 I X="" S X=PSGSI I X="" S PSGFOK(8)="" G:'$G(PSGOE3) 10
"RTN","PSGOE41",26,0)
 S PSGF2=8 I $E(X)="^" D FF G:Y>0 @Y G 8
"RTN","PSGOE41",27,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",28,0)
 I X="@" D DEL G:%'=1 8 S (PSGFOK(8),PSGSI)="" G:'$G(PSGOE3) 10
"RTN","PSGOE41",29,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",30,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",31,0)
 S PSGSI=X I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U"),PSGFOK(8)=""
"RTN","PSGOE41",32,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",33,0)
 ;
"RTN","PSGOE41",34,0)
10 ; start date/time
"RTN","PSGOE41",35,0)
 D ^PSGNE3
"RTN","PSGOE41",36,0)
 S:'$D(PSGNESDO) PSGNESDO=$$ENDD^PSGMI(PSGNESD) S PSGSD=PSGNESDO
"RTN","PSGOE41",37,0)
A10 W !,"START DATE/TIME: "_PSGSD_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",38,0)
 I X="",PSGNESD W "  "_PSGSD G O25
"RTN","PSGOE41",39,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGNESD=+X,PSGSD=$$ENDD^PSGMI(+X) W "  ",PSGSD G O25
"RTN","PSGOE41",40,0)
 S PSGF2=10 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE41",41,0)
 I $E(X)="^" D FF G:Y>0 @Y G A10
"RTN","PSGOE41",42,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE41",43,0)
 S PSGNESD=+Y,PSGSD=$$ENDD^PSGMI(+Y),(PSGNEFD,PSGFD)=""
"RTN","PSGOE41",44,0)
 ;
"RTN","PSGOE41",45,0)
O25 ;
"RTN","PSGOE41",46,0)
 S PSGFOK(10)="" I $P(PSGNEDFD,"^",3)="O" S PSGNEFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGNESD,PSGP) I PSGNEFD]"" S PSGFD=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGOE41",47,0)
 ;
"RTN","PSGOE41",48,0)
25 ; stop date
"RTN","PSGOE41",49,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",50,0)
 I 'PSGNEFD D ENFD^PSGNE3(PSGDT) S PSGFD=PSGNEFDO
"RTN","PSGOE41",51,0)
A25 W !,"STOP DATE/TIME: "_$S(PSGFD]"":PSGFD_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",52,0)
 I X="",PSGNEFD W "   "_PSGFD S PSGFOK(25)=""  G W25
"RTN","PSGOE41",53,0)
 S PSGF2=25 I $E(X)="^" D FF G:Y>0 @Y G A25
"RTN","PSGOE41",54,0)
 ;I X=+X,(X'>0) S X="?"
"RTN","PSGOE41",55,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE41",56,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D EN1^PSGDL
"RTN","PSGOE41",57,0)
 K %DT S %DT="ERTX",%DT(0)=PSGNESD D ^%DT K %DT G:Y'>0 A25 S PSGNEFD=+Y,PSGFD=$$ENDD^PSGMI(+Y),PSGFOK(25)=""
"RTN","PSGOE41",58,0)
W25 I PSGNEFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",!
"RTN","PSGOE41",59,0)
 ;
"RTN","PSGOE41",60,0)
NEXT ;
"RTN","PSGOE41",61,0)
 ;G:$S($D(PSJOERR):0,+PSJSYSU=3:1,1:'$P(PSJSYSU,";",2)) 1^PSGOE42 G:$P(PSJSYSW0,"^",24) 5^PSGOE42 G:PSGOEORF&'$P(PSJSYSU,";",2) 106^PSGOE42
"RTN","PSGOE41",62,0)
 G 1^PSGOE42
"RTN","PSGOE41",63,0)
 ;
"RTN","PSGOE41",64,0)
DONE ;
"RTN","PSGOE41",65,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE41",66,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE41",67,0)
 ;
"RTN","PSGOE41",68,0)
FF ; up-arrow to another field
"RTN","PSGOE41",69,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE4"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:$P(Y,U)=2 FB=PSGF2_"^PSGOE41"
"RTN","PSGOE41",70,0)
 Q
"RTN","PSGOE41",71,0)
 ;
"RTN","PSGOE41",72,0)
DEL ; delete entry
"RTN","PSGOE41",73,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE41",74,0)
 Q
"RTN","PSGOE7")
0^61^B18772802
"RTN","PSGOE7",1,0)
PSGOE7 ;BIR/CML3-SELECT DRUG ;15 MAY 00 / 1:43 PM
"RTN","PSGOE7",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**9,26,34,52,55,50,87,111**;16 DEC 97
"RTN","PSGOE7",3,0)
 ;
"RTN","PSGOE7",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180
"RTN","PSGOE7",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181
"RTN","PSGOE7",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOE7",7,0)
 ; NFI-UD chgs for FR#: 1
"RTN","PSGOE7",8,0)
 ; 
"RTN","PSGOE7",9,0)
 ;S PSGDICS="U"_$S($D(PSJOERR):",I",1:"")
"RTN","PSGOE7",10,0)
 S PSGDICS="U"
"RTN","PSGOE7",11,0)
 ;
"RTN","PSGOE7",12,0)
AD ; Ask Drug
"RTN","PSGOE7",13,0)
 K PSJDOSE,PSJDOX ;var array use in ^PSJDOSE
"RTN","PSGOE7",14,0)
 K PSGODO
"RTN","PSGOE7",15,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="EMQZVT",D="B^C" I '$P(PSJSYSU,";",4) S DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")"
"RTN","PSGOE7",16,0)
 E  S DIC("T")="",DIC="^PSDRUG(",DIC("S")="I +$G(^PSDRUG(+Y,2)),$P($G(^PSDRUG(+Y,2)),""^"",3)[""U"" S X(1)=+$G(^(""I"")) I $S('X(1):1,1:X(1)'<DT)",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSGOE7",17,0)
 ;
"RTN","PSGOE7",18,0)
AD1 ;
"RTN","PSGOE7",19,0)
 K PSGORD,PSJORD
"RTN","PSGOE7",20,0)
 S PSGORQF=0 R !!,"Select DRUG: ",X:DTIME I '$T W $C(7) S X="^"
"RTN","PSGOE7",21,0)
 I ("^"[X)!(X="") S PSGORQF=1 G DONE
"RTN","PSGOE7",22,0)
 G:X?1"S."1.E DONE
"RTN","PSGOE7",23,0)
 I X?1."?" W !!?2,"Select the medication you wish the patient to receive." W:PSJSYSU<3 "  You should consult",!,"with your pharmacy before ordering any non-formulary medication." W !
"RTN","PSGOE7",24,0)
 D MIX^DIC1 G:X?1."?" AD1 G:"^"[X!(Y'>0) AD1 S (PSGDO,PSGDRG,PSGDRGN,PSGNEDFD,PSGPDRG,PSGPDRGN)=""
"RTN","PSGOE7",25,0)
 I $P(PSJSYSU,";",4) D  G DO
"RTN","PSGOE7",26,0)
 .S PSGDRG=+Y,PSGDRGN=Y(0,0)
"RTN","PSGOE7",27,0)
 .D DIN^PSJDIN(+$G(^PSDRUG(PSGDRG,2)),PSGDRG)
"RTN","PSGOE7",28,0)
 .I $P(Y(0),"^",9) D NF S:Y>0 PSGDRG=+Y(0),PSGDRGN=Y(0,0) D SNFM
"RTN","PSGOE7",29,0)
 .S PSGPDRG=+$G(^PSDRUG(PSGDRG,2)),PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",30,0)
 S PSGPDRG=+Y,PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",31,0)
 ;F Q=1:1:$L(PSGDICS) S X=$P(PSGDICS,",",Q) Q:X=""  S PSJLUAPP=$O(^PS(50.3,PSGPDRG,1,"B",X,0)) I PSJLUAPP S X=$G(^PS(50.3,PSGPDRG,1,PSJLUAPP,0)) Q
"RTN","PSGOE7",32,0)
 S X=$O(^PSDRUG("ASP",PSGPDRG,0)) I X,'$O(^(X)) S PSGDRG=X,PSGDRGN=$$ENDDN^PSGMI(X)
"RTN","PSGOE7",33,0)
 ;
"RTN","PSGOE7",34,0)
DO ; dosage ordered
"RTN","PSGOE7",35,0)
 S PSGNEDFD=$$GTNEDFD("U",PSGPDRG)
"RTN","PSGOE7",36,0)
 I $G(PSGDRG),$P(PSJSYSU,";",4) D ENDDC^PSGSICHK(PSGP,PSGDRG) G:PSGORQF>0 AD
"RTN","PSGOE7",37,0)
 I '$P(PSJSYSU,";",4) S PSGX=PSGPDRG D END^PSGSICHK G:Y<0 AD
"RTN","PSGOE7",38,0)
 ;S PSGNEDFD="" I PSGPDRG S PSGX=PSGPDRG D END^PSGSICHK
"RTN","PSGOE7",39,0)
 S PSGDO=""
"RTN","PSGOE7",40,0)
 ;I PSGDO]"",'PSGDO,PSGDO?.E1N.E F  S PSGDO=$E(PSGDO,2,999) Q:PSGDO  Q:PSGDO=""
"RTN","PSGOE7",41,0)
 ;G:Y<0 AD
"RTN","PSGOE7",42,0)
 ;
"RTN","PSGOE7",43,0)
DONE ;
"RTN","PSGOE7",44,0)
 K DIC,%,%Y,PSGDICS,PSJLUAPP,Q1,Q2,Q3,Z Q
"RTN","PSGOE7",45,0)
 ;
"RTN","PSGOE7",46,0)
 ;
"RTN","PSGOE7",47,0)
NF ;
"RTN","PSGOE7",48,0)
 S Y=0 W $C(7),!!,"PLEASE NOTE: The selected item is not currently on your medical center's",!?13,"formulary." Q:'$P(PSJSYSU,";",2)
"RTN","PSGOE7",49,0)
 N CNT S CNT=0 F Q1=0:0 S Q1=$O(^PSDRUG(PSGDRG,65,Q1)) Q:'Q1  I $$CHKDRG(+$G(^(Q1,0))) S CNT=CNT+1
"RTN","PSGOE7",50,0)
 I CNT=0 W !!,"There are no formulary alternatives entered for this item." W:PSJSYSU>2 "  You should consult",!,"with your pharmacy before ordering this item." S Y=0 Q
"RTN","PSGOE7",51,0)
 I CNT=1 S Q1=$O(^PSDRUG(PSGDRG,65,0)),Q1=+$G(^(Q1,0)),Q3=$P(^PSDRUG(Q1,0),"^") W !!,Q3," has been entered as a formulary " W:$X>67 ! W "alternative."
"RTN","PSGOE7",52,0)
 I  F Q=1:1 S %=2 W !!,"Is ",$S(Q=1:"this",1:Q3)," acceptable" D YN^DICN Q:%  D NFOH
"RTN","PSGOE7",53,0)
 I CNT=1 S:%=1 (Y(0),Y)=Q1,Y(0,0)=Q3 S:%<0 Y=-1 Q
"RTN","PSGOE7",54,0)
 K DA,DIC S DA(1)=PSGDRG,DIC="^PSDRUG("_PSGDRG_",65,",DIC(0)="AEMQZ",DIC("A")="Select FORMULARY ALTERNATIVE: " W ! D ^DIC K DIC Q
"RTN","PSGOE7",55,0)
 ;
"RTN","PSGOE7",56,0)
NFOH ;
"RTN","PSGOE7",57,0)
 S X="Answer 'YES' to order this formulary alternative ("_Q3_") for the patient instead of the non-formulary item originally selected.  Answer 'NO' to use the drug originally selected."
"RTN","PSGOE7",58,0)
 W !!?2 F Y=1:1:$L(X," ") S Z=$P(X," ",Y) W:$L(Z)+$X+2>IOM ! W Z," "
"RTN","PSGOE7",59,0)
 Q
"RTN","PSGOE7",60,0)
CHKDRG(DRG) ; Determine if dispense drug is valid for Unit Dose.
"RTN","PSGOE7",61,0)
 I $D(^PSDRUG(DRG,0)),$P($G(^(2)),U,3)["U" S X=+$G(^("I")) I 'X!(X>DT) Q DRG
"RTN","PSGOE7",62,0)
 Q 0
"RTN","PSGOE7",63,0)
 ;
"RTN","PSGOE7",64,0)
SNFM ; show non-formulary message
"RTN","PSGOE7",65,0)
 S Y=1 Q:PSJSYSU=3!'$O(^PS(59.7,1,21,0))  W $C(7),! S Q=0 F  S Q=$O(^PS(59.7,1,21,Q)) Q:'Q  W !,$G(^(Q,0))
"RTN","PSGOE7",66,0)
 W ! D READ^PSJUTL S Y=1 Q
"RTN","PSGOE7",67,0)
 ;
"RTN","PSGOE7",68,0)
GTNEDFD(APP,PDRG) ; Find defaults from Orderable Item.
"RTN","PSGOE7",69,0)
 Q $P($G(^PS(50.7,+PDRG,0)),"^",5,8)
"RTN","PSGOE7",70,0)
 N Q,X S X=""
"RTN","PSGOE7",71,0)
 F Q=1:1:$L(APP) S X=$E(APP,Q) Q:X=""  S X=$O(^PS(50.3,+PDRG,1,"B",X,0)) I X S X=$P($G(^PS(50.3,+PDRG,1,X,0)),"^",5,8) Q
"RTN","PSGOE7",72,0)
 Q X
"RTN","PSGOE8")
0^102^B34977716
"RTN","PSGOE8",1,0)
PSGOE8 ;BIR/CML3-EDIT ORDERS IN 53.1 ;25 SEP 97 / 10:58 AM
"RTN","PSGOE8",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**47,50,65,72,110,111**;16 DEC 97
"RTN","PSGOE8",3,0)
 ;
"RTN","PSGOE8",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE8",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE8",6,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE8",7,0)
 ;
"RTN","PSGOE8",8,0)
101 ;Orderable Item
"RTN","PSGOE8",9,0)
 S MSG=0,F2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(F2) BACK="101^PSGOE8"
"RTN","PSGOE8",10,0)
 S %=1 I $P(PSJSYSU,";",3)>1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%
"RTN","PSGOE8",11,0)
 I %'=1 G DONE
"RTN","PSGOE8",12,0)
A101 ;
"RTN","PSGOE8",13,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",14,0)
 . W !!?5,"Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",15,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",16,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE8",17,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,101) G A101
"RTN","PSGOE8",18,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,101)
"RTN","PSGOE8",19,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A101
"RTN","PSGOE8",20,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")" D ^DIC K DIC I Y'>0 G A101
"RTN","PSGOE8",21,0)
 F  S %=2 D DH,YN^DICN Q:%
"RTN","PSGOE8",22,0)
 I %'=1 G A101
"RTN","PSGOE8",23,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE8",24,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE8",25,0)
 S PSGPDNX=1,PSGDO="",(PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG) K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) D
"RTN","PSGOE8",26,0)
 .S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)=""
"RTN","PSGOE8",27,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE8",28,0)
 G DONE
"RTN","PSGOE8",29,0)
 ;
"RTN","PSGOE8",30,0)
109 ; dosage ordered
"RTN","PSGOE8",31,0)
 S MSG=0,F2=109 S:PSGOEEF(F2) BACK="109^PSGOE8"
"RTN","PSGOE8",32,0)
A109 ;
"RTN","PSGOE8",33,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",34,0)
 . W !!?5,"Dosage may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",35,0)
 S PSGOEEF(F2)=PSGOEE
"RTN","PSGOE8",36,0)
 D EDITDOSE^PSJDOSE S X=PSGDO G DONE
"RTN","PSGOE8",37,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",38,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE8",39,0)
 I $$CHECK(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE8",40,0)
 I $$CHECK(PSJSYSP)&(X="@") W $C(7),"      (Required) " G A109
"RTN","PSGOE8",41,0)
 I '$$CHECK(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE8",42,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",43,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A109
"RTN","PSGOE8",44,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE8",45,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",46,0)
 S PSGDO=X G DONE
"RTN","PSGOE8",47,0)
 ;
"RTN","PSGOE8",48,0)
3 ; med route
"RTN","PSGOE8",49,0)
 S MSG=0,F2=3 S:PSGOEEF(F2) BACK="3^PSGOE8"
"RTN","PSGOE8",50,0)
A3 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",51,0)
 . W !!?5,"Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",52,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",53,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE8",54,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,3) G A3
"RTN","PSGOE8",55,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE8",56,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A3
"RTN","PSGOE8",57,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3
"RTN","PSGOE8",58,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE8",59,0)
 ;
"RTN","PSGOE8",60,0)
7 ; schedule type
"RTN","PSGOE8",61,0)
 S MSG=0,F2=7 S:PSGOEEF(F2) BACK="7^PSGOE8"
"RTN","PSGOE8",62,0)
A7 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE8",63,0)
 I X="" W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE8",64,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,7) G A7
"RTN","PSGOE8",65,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A7
"RTN","PSGOE8",66,0)
 ; I X="OC"!(X="R") S PSGST=X,$P(PSGNEDFD,"^",3)=X,PSGSTN=$S(X="R":"FILL on REQUEST",1:"ON CALL") W "  "_PSGSTN S PSGOEEF(7)="" G:X="R" 26 S PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE8",67,0)
 F Y="C^CONTINUOUS","O^ONE TIME","OC^ON CALL","P^PRN","R^FILL on REQUEST" I $S(X=$P(Y,"^"):1,1:$P($P(Y,"^",2),X)="") W $S(X=$P(Y,"^"):"  "_$P(Y,"^",2),1:$P($P(Y,"^",2),X,2)) S PSGST=$P(Y,"^"),PSGSTN=$P(Y,"^",2),$P(PSGNEDFD,"^",3)=PSGST Q
"RTN","PSGOE8",68,0)
 E  W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,7) G A7
"RTN","PSGOE8",69,0)
 ; I PSGST="OC"!(PSGST="R") S PSGOEEF(7)="" G:PSGST="R" 26 S PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE8",70,0)
 G DONE
"RTN","PSGOE8",71,0)
 ;
"RTN","PSGOE8",72,0)
26 ; schedule
"RTN","PSGOE8",73,0)
 S MSG=0,F2=26 S:PSGOEEF(F2) BACK="26^PSGOE8"
"RTN","PSGOE8",74,0)
A26 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",75,0)
 . W !!?5,"Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",76,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",77,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",78,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",79,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A26
"RTN","PSGOE8",80,0)
 N PSGOES,PSJSLUP S PSJSLUP=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",81,0)
 S PSGSCH=X I PSGS0Y'=PSGAT S PSGAT=PSGS0Y W !!,"NOTE: This change in schedule also changes the ADMIN TIMES.",! S MSG=1 D:$G(PSJNEWOE) PAUSE^VALM1
"RTN","PSGOE8",82,0)
 ;
"RTN","PSGOE8",83,0)
DONE ;
"RTN","PSGOE8",84,0)
 I PSGOEE G:'PSGOEEF(F2) @BACK S PSGOEE=PSGOEEF(F2)
"RTN","PSGOE8",85,0)
 K F,F0,F2 Q
"RTN","PSGOE8",86,0)
 ;
"RTN","PSGOE8",87,0)
DEL ; delete entry
"RTN","PSGOE8",88,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE8",89,0)
 Q
"RTN","PSGOE8",90,0)
 ;
"RTN","PSGOE8",91,0)
DH ;
"RTN","PSGOE8",92,0)
 W !!?2,"When the drug of an order is changed, the Dosage Ordered and Dispense Drug(s)",!,"for the order are no longer valid, and therefore deleted from the order.",!,"If possible, a new corresponding dispense drug will be added to the order."
"RTN","PSGOE8",93,0)
 W !!?2,"Answer 'YES' to continue with this change.  Answer 'NO' to select another",!,"drug or to accept the drug as it was.  Enter an '^' the exit this edit." Q
"RTN","PSGOE8",94,0)
 ;
"RTN","PSGOE8",95,0)
CHECK(PSJSYSP) ; Check to see if multiple dispense drugs
"RTN","PSGOE8",96,0)
 ; Input  -     PSJSYSP
"RTN","PSGOE8",97,0)
 ; Returns  0 = only one.
"RTN","PSGOE8",98,0)
 ;          1 = more than one
"RTN","PSGOE8",99,0)
 ; Checks Inactive Date and doesn't count if < or = today.
"RTN","PSGOE8",100,0)
 N PSJRSB,PSJINACT,PSJRBCNT S PSJRBCNT=0
"RTN","PSGOE8",101,0)
 F PSJRSB=0:0 S PSJRSB=$O(^PS(53.45,PSJSYSP,2,PSJRSB)) Q:'PSJRSB  D
"RTN","PSGOE8",102,0)
 .S PSJINACT=$P(^PS(53.45,PSJSYSP,2,PSJRSB,0),"^",3)
"RTN","PSGOE8",103,0)
 .I (PSJINACT="")!((PSJINACT>0)&(PSJINACT>DT)) D
"RTN","PSGOE8",104,0)
 ..S PSJRBCNT=$S('$D(PSJRBCNT):1,1:PSJRBCNT+1)
"RTN","PSGOE8",105,0)
 Q $S(PSJRBCNT>1:1,1:0)
"RTN","PSGOE8",106,0)
 ;
"RTN","PSGOE8",107,0)
PNDREN(PNDON) ;
"RTN","PSGOE8",108,0)
 I PNDON'["P" Q 0
"RTN","PSGOE8",109,0)
 S RNWL="^PS(53.1,"_+PNDON_",0)" S RNWL=$G(@(RNWL)) S RNWL=$S($P(RNWL,"^",24)="R":1,1:0)
"RTN","PSGOE8",110,0)
 Q RNWL
"RTN","PSGOE81")
0^105^B21103925
"RTN","PSGOE81",1,0)
PSGOE81 ;BIR/CML3-NON-VERIFIED ORDER EDIT (CONT.) ;10 Mar 99 / 10:55 AM
"RTN","PSGOE81",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**26,50,64,58,82,110,111**;16 DEC 97
"RTN","PSGOE81",3,0)
 ;
"RTN","PSGOE81",4,0)
39 ; admin times
"RTN","PSGOE81",5,0)
 S MSG=0,PSGF2=39 S:PSGOEEF(PSGF2) BACK="39^PSGOE81"
"RTN","PSGOE81",6,0)
A39 I $$ODD^PSGS0(PSGS0XT) G DONE
"RTN","PSGOE81",7,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",8,0)
 I X="" S:(($G(PSGS0XT)="D")&'PSGS0Y) PSGOEE=0 G DONE
"RTN","PSGOE81",9,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A39
"RTN","PSGOE81",10,0)
 I PSGS0XT="D"&'$G(X) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G A39
"RTN","PSGOE81",11,0)
 .W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE81",12,0)
 I X="@" D DEL G:%'=1 A39 S PSGAT="" G DONE
"RTN","PSGOE81",13,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSGOE81",14,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSGOE81",15,0)
 S (PSGS0Y,PSGAT)=X,PSGS0Y=PSGAT G DONE
"RTN","PSGOE81",16,0)
 ;
"RTN","PSGOE81",17,0)
8 ; special instructions
"RTN","PSGOE81",18,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE81"
"RTN","PSGOE81",19,0)
A8 N DIR S DIR(0)="FO^1:180^D ^PSGSICHK",DIR("A")="SPECIAL INSTRUCTIONS",DIR("??")="^D ENHLP^PSGOEM(53.1,8)" S:$G(PSGSI)]"" DIR("B")=$P(PSGSI,"^") D ^DIR I $D(DUOUT)!$D(DTOUT) S PSGOEE=0 G DONE
"RTN","PSGOE81",20,0)
 I $E(X)=U D ENFF^PSGOE82 G:Y>0 @Y G A8
"RTN","PSGOE81",21,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",22,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE81",23,0)
 I Y="",PSGSI="" G DONE
"RTN","PSGOE81",24,0)
 S PSGSI=$S(Y]"":Y,1:PSGSI),PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE81",25,0)
 Q
"RTN","PSGOE81",26,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":PSGSI_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",27,0)
 I X="" S X=PSGSI I X="" G DONE
"RTN","PSGOE81",28,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A8
"RTN","PSGOE81",29,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",30,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE81",31,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",32,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",33,0)
 S PSGSI=X G DONE
"RTN","PSGOE81",34,0)
 ;
"RTN","PSGOE81",35,0)
10 ; start date/time
"RTN","PSGOE81",36,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE81"
"RTN","PSGOE81",37,0)
A10 ;
"RTN","PSGOE81",38,0)
 K PSGSDX N DUR,DURMIN,TMPFD
"RTN","PSGOE81",39,0)
 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE81",40,0)
 . W !?5,"Start Date may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE81",41,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",42,0)
 I X="",PSGSD W "  "_$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",43,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",44,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE81",45,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A10
"RTN","PSGOE81",46,0)
 NEW TMPX S TMPX=X,X1=+$G(PSGLI),X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE81",47,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE81",48,0)
 S (PSGSDX,PSGSD,PSGNESD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD)
"RTN","PSGOE81",49,0)
 I $G(PSGORD)["P",$G(PSGP) S DUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,"P",1) I DUR]"" S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN D
"RTN","PSGOE81",50,0)
 . S TMPFD=$$FMADD^XLFDT(PSGSD,,,DURMIN) K:(TMPFD<PSGSD) TMPFD I $G(TMPFD) S PSGFD=TMPFD,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE81",51,0)
 G DONE
"RTN","PSGOE81",52,0)
 ;
"RTN","PSGOE81",53,0)
25 ; stop date
"RTN","PSGOE81",54,0)
 S MSG=0,PSGF2=25 S:PSGOEEF(PSGF2) BACK="25^PSGOE81"
"RTN","PSGOE81",55,0)
A25 ;
"RTN","PSGOE81",56,0)
 K PSGFDX
"RTN","PSGOE81",57,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",58,0)
 I X="",PSGFD W "   "_$P(PSGFDN,"^") G W25
"RTN","PSGOE81",59,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A25
"RTN","PSGOE81",60,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE81",61,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE81",62,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT G:Y'>0 A25 S (PSGFDX,PSGFD,PSGNEFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD) ; I $P(PSGNEDFD,"^",3)="O",PSGNESD'=PSGNEFD S PSGNESD=PSGNEFD,PSGSD=PSGFD
"RTN","PSGOE81",63,0)
W25 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE81",64,0)
 ;
"RTN","PSGOE81",65,0)
 ;
"RTN","PSGOE81",66,0)
DONE ;
"RTN","PSGOE81",67,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE81",68,0)
 Q
"RTN","PSGOE81",69,0)
 ;
"RTN","PSGOE81",70,0)
FF ; up-arrow to another field
"RTN","PSGOE81",71,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE8"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE81"
"RTN","PSGOE81",72,0)
 Q
"RTN","PSGOE81",73,0)
 ;
"RTN","PSGOE81",74,0)
DEL ; delete entry
"RTN","PSGOE81",75,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE81",76,0)
 Q
"RTN","PSGOE9")
0^103^B31080984
"RTN","PSGOE9",1,0)
PSGOE9 ;BIR/CML3-EDIT ORDERS IN 55 ;13 May 98 / 7:58 AM
"RTN","PSGOE9",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**11,47,50,72,110,111**;16 DEC 97
"RTN","PSGOE9",3,0)
 ;
"RTN","PSGOE9",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE9",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE9",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSGOE9",7,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE9",8,0)
 ;
"RTN","PSGOE9",9,0)
101 ; Orderable Item (AKA primary drug)
"RTN","PSGOE9",10,0)
 S MSG=0,PSGF2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(PSGF2) BACK="101^PSGOE9"
"RTN","PSGOE9",11,0)
 S %=1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%  D DH^PSGOE8
"RTN","PSGOE9",12,0)
 I %'=1 G DONE
"RTN","PSGOE9",13,0)
A101 ;
"RTN","PSGOE9",14,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",15,0)
 . W !!?5,"Orderable Item may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",16,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",17,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE9",18,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,101) G A101
"RTN","PSGOE9",19,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,101)
"RTN","PSGOE9",20,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A101
"RTN","PSGOE9",21,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")"
"RTN","PSGOE9",22,0)
 D ^DIC K DIC I Y'>0 G A101
"RTN","PSGOE9",23,0)
 F  S %=2 D DH^PSGOE8,YN^DICN Q:%
"RTN","PSGOE9",24,0)
 I %'=1 G A101
"RTN","PSGOE9",25,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE9",26,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE9",27,0)
 S PSGPDNX=1,PSGPD=+Y,PSGPDN=$$OINAME^PSJLMUTL(PSGPD),PSGDO="" K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)="" G DONE
"RTN","PSGOE9",28,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE9",29,0)
 G DONE
"RTN","PSGOE9",30,0)
 ;
"RTN","PSGOE9",31,0)
109 ; dosage ordered
"RTN","PSGOE9",32,0)
 S MSG=0,PSGF2=109 S:PSGOEEF(PSGF2) BACK="109^PSGOE9"
"RTN","PSGOE9",33,0)
A109 ;
"RTN","PSGOE9",34,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",35,0)
 . W !!?5,"Dosage may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",36,0)
 D EDITDOSE^PSJDOSE S X=PSGDO G DONE
"RTN","PSGOE9",37,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",38,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE9",39,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE9",40,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="@") W $C(7),"  (Required)" G A109
"RTN","PSGOE9",41,0)
 I '$$CHECK^PSGOE8(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE9",42,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",43,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A109
"RTN","PSGOE9",44,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE9",45,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",46,0)
 S PSGDO=X G DONE
"RTN","PSGOE9",47,0)
 ;
"RTN","PSGOE9",48,0)
3 ; med route
"RTN","PSGOE9",49,0)
 S MSG=0,PSGF2=3 S:PSGOEEF(PSGF2) BACK="3^PSGOE9"
"RTN","PSGOE9",50,0)
A3 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",51,0)
 . W !!?5,"Med Route may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",52,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",53,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE9",54,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,3) G A3
"RTN","PSGOE9",55,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,3)
"RTN","PSGOE9",56,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A3
"RTN","PSGOE9",57,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3
"RTN","PSGOE9",58,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE9",59,0)
 ;
"RTN","PSGOE9",60,0)
7 ; schedule type
"RTN","PSGOE9",61,0)
 S MSG=0,PSGF2=7 S:PSGOEEF(PSGF2) BACK="7^PSGOE9"
"RTN","PSGOE9",62,0)
A7 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE9",63,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE9",64,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE9",65,0)
 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE9",66,0)
 I X="" W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE9",67,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,7) G A7
"RTN","PSGOE9",68,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A7
"RTN","PSGOE9",69,0)
 ; I X="OC"!(X="R") S PSGST=X,$P(PSGNEDFD,"^",3)=X,PSGSTN=$S(X="R":"FILL on REQUEST",1:"ON CALL") W "  "_PSGSTN S PSGOEEF(7)="" G:X="R" 26 S PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE9",70,0)
 F Y="C^CONTINUOUS","O^ONE TIME","OC^ON CALL","P^PRN","R^FILL on REQUEST" I $S(X=$P(Y,"^"):1,1:$P($P(Y,"^",2),X)="") W $S(X=$P(Y,"^"):"  "_$P(Y,"^",2),1:$P($P(Y,"^",2),X,2)) S PSGST=$P(Y,"^"),PSGSTN=$P(Y,"^",2),$P(PSGNEDFD,"^",3)=PSGST Q
"RTN","PSGOE9",71,0)
 E  W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,7) G A7
"RTN","PSGOE9",72,0)
 ; I PSGST="OC"!(PSGST="R") S PSGOEEF(7)="" G:PSGST="R" 26 S PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE9",73,0)
 G DONE
"RTN","PSGOE9",74,0)
 ;
"RTN","PSGOE9",75,0)
26 ; schedule
"RTN","PSGOE9",76,0)
 S MSG=0,PSGF2=26 S:PSGOEEF(PSGF2) BACK="26^PSGOE9"
"RTN","PSGOE9",77,0)
A26 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",78,0)
 . W !!?5,"Schedule may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",79,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",80,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",81,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",82,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A26
"RTN","PSGOE9",83,0)
 N PSJSLUP S PSJSLUP=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",84,0)
 S PSGSCH=X I PSGS0Y'=PSGAT S PSGAT=PSGS0Y,MSG=1 W !!,"NOTE: This change in schedule also changes the ADMIN TIMES.",! S MSG=1 D:$G(PSJNEWOE) PAUSE^VALM1
"RTN","PSGOE9",85,0)
 ;
"RTN","PSGOE9",86,0)
DONE ;
"RTN","PSGOE9",87,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE9",88,0)
 K F,F0,PSGF2 Q
"RTN","PSGOE9",89,0)
 ;
"RTN","PSGOE9",90,0)
DEL ; delete entry
"RTN","PSGOE9",91,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE9",92,0)
 Q
"RTN","PSGOE91")
0^106^B24021176
"RTN","PSGOE91",1,0)
PSGOE91 ;BIR/CML3-ACTIVE ORDER EDIT (CONT.) ;10 JUL 96 / 7:54 AM
"RTN","PSGOE91",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,64,58,110,111**;16 DEC 97
"RTN","PSGOE91",3,0)
 ;
"RTN","PSGOE91",4,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE91",5,0)
 ;
"RTN","PSGOE91",6,0)
41 ; admin times
"RTN","PSGOE91",7,0)
 S MSG=0,PSGF2=41 S:PSGOEEF(PSGF2) BACK="41^PSGOE91"
"RTN","PSGOE91",8,0)
 I $$ODD^PSGS0(PSGS0XT) G DONE
"RTN","PSGOE91",9,0)
A41 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",10,0)
 . W !!?5,"ADMIN TIMES may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",11,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",12,0)
 I X="" G DONE
"RTN","PSGOE91",13,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A41
"RTN","PSGOE91",14,0)
 I X="@",'PSGAT!(PSGS0XT="D")!(PSGSCH["@") I ((",P,R,")'[(","_$G(PSGST)_",")) D  G A41
"RTN","PSGOE91",15,0)
 .W $C(7),"  ??" S X="?" W:PSGS0XT="D"!(PSGSCH["@") !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(55.06,41)
"RTN","PSGOE91",16,0)
 I X="@" D DEL G:%'=1 A41 S PSGAT="" G DONE
"RTN","PSGOE91",17,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",18,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",19,0)
 S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE91",20,0)
 ;
"RTN","PSGOE91",21,0)
8 ; special instructions
"RTN","PSGOE91",22,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE91"
"RTN","PSGOE91",23,0)
A8 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE91",24,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE91",25,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE91",26,0)
 N DIR S DIR(0)="FO^1:180^D ^PSGSICHK",DIR("A")="SPECIAL INSTRUCTIONS",DIR("??")="^D ENHLP^PSGOEM(55.06,8)" S:$G(PSGSI)]"" DIR("B")=$P(PSGSI,"^") D ^DIR I $D(DUOUT)!$D(DTOUT) S PSGOEE=0 G DONE
"RTN","PSGOE91",27,0)
 I $E(X)=U D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",28,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",29,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE91",30,0)
 I Y="",PSGSI="" G DONE
"RTN","PSGOE91",31,0)
 S PSGSI=$S(Y]"":Y,1:PSGSI),PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE91",32,0)
 Q
"RTN","PSGOE91",33,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":PSGSI_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",34,0)
 I X="" S X=PSGSI I X="" G DONE
"RTN","PSGOE91",35,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",36,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",37,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE91",38,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",39,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",40,0)
 S PSGSI=X G DONE
"RTN","PSGOE91",41,0)
 ;
"RTN","PSGOE91",42,0)
10 ; start date/time
"RTN","PSGOE91",43,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE91"
"RTN","PSGOE91",44,0)
A10 ;
"RTN","PSGOE91",45,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",46,0)
 . W !!?5,"Start Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",47,0)
 K PSGSDX
"RTN","PSGOE91",48,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",49,0)
 I X="",PSGSD W "  "_PSGSDN G DONE
"RTN","PSGOE91",50,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE91",51,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,10)
"RTN","PSGOE91",52,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A10
"RTN","PSGOE91",53,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(55.06,10) G A10
"RTN","PSGOE91",54,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE91",55,0)
 S (PSGSDX,PSGSD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) G DONE
"RTN","PSGOE91",56,0)
 ;
"RTN","PSGOE91",57,0)
34 ; stop date
"RTN","PSGOE91",58,0)
 S MSG=0,PSGF2=34 S:PSGOEEF(PSGF2) BACK="34^PSGOE91"
"RTN","PSGOE91",59,0)
A34 ;
"RTN","PSGOE91",60,0)
 K PSGFDX
"RTN","PSGOE91",61,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",62,0)
 . W !!?5,"Stop Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",63,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",64,0)
 I X="",PSGFD W "   "_$P(PSGFDN,"^") G W34
"RTN","PSGOE91",65,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A34
"RTN","PSGOE91",66,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,34)
"RTN","PSGOE91",67,0)
 I X=+X,(X>0),(X'>2000000) G A34:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE91",68,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT G:Y'>0 A34 S (PSGFDX,PSGFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE91",69,0)
W34 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE91",70,0)
 ;
"RTN","PSGOE91",71,0)
 ;
"RTN","PSGOE91",72,0)
DONE ;
"RTN","PSGOE91",73,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE91",74,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE91",75,0)
 ;
"RTN","PSGOE91",76,0)
FF ; up-arrow to another field
"RTN","PSGOE91",77,0)
 D ENFF^PSGOEM I Y>0,Y'=41,Y'=8,Y'=10,Y'=34 S Y=Y_"^PSGOE9"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE91"
"RTN","PSGOE91",78,0)
 Q
"RTN","PSGOE91",79,0)
 ;
"RTN","PSGOE91",80,0)
DEL ; delete entry
"RTN","PSGOE91",81,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE91",82,0)
 Q
"RTN","PSGOEE")
0^98^B62697986
"RTN","PSGOEE",1,0)
PSGOEE ;BIR/CML3-EDIT ACTIVE OR NON-VERIFIED ORDERS ;01 May 98 / 8:44 AM
"RTN","PSGOEE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,7,29,47,64,58,82,91,110,111**;16 DEC 97
"RTN","PSGOEE",3,0)
 ;
"RTN","PSGOEE",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEE",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA# 2789.
"RTN","PSGOEE",6,0)
 ;
"RTN","PSGOEE",7,0)
 D NOW^%DTC S PSGDT=% K PSGEFN,PSGOEEF S PSGOEEF=0 I PSGORD["A"!(PSGORD["O") G ACT
"RTN","PSGOEE",8,0)
531 ; edit orders in 53.1
"RTN","PSGOEE",9,0)
ENF ;
"RTN","PSGOEE",10,0)
 D EN2^PSGOEEW
"RTN","PSGOEE",11,0)
 K PSJACEPT D EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",12,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",13,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",14,0)
 E  D
"RTN","PSGOEE",15,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",16,0)
 I $G(PSGOEAV) D ACT1 Q
"RTN","PSGOEE",17,0)
 D DONE1
"RTN","PSGOEE",18,0)
 S PSGOEEF=0,PSJORD=PSGORD D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD)
"RTN","PSGOEE",19,0)
 Q
"RTN","PSGOEE",20,0)
ACT ;
"RTN","PSGOEE",21,0)
 D EN2^PSGOEEW,EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",22,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",23,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",24,0)
 E  D
"RTN","PSGOEE",25,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",26,0)
 S:$D(PSGOEF)!$G(PSGOEENO) PSGCANFL=-1
"RTN","PSGOEE",27,0)
ACT1 ;I 'PSGOEAV,PSJSYSL>1 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEE",28,0)
 D DONE1
"RTN","PSGOEE",29,0)
 S PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD) D:PSGOEAV UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOEE",30,0)
 Q
"RTN","PSGOEE",31,0)
EDIT ;
"RTN","PSGOEE",32,0)
 D FULL^VALM1
"RTN","PSGOEE",33,0)
 W ! S PSGOEER="" F Q=1:1 S Q1=$P(Y,",",Q) Q:'Q1  S X=$P($T(@(PSGOEEG_Q1)),";",3),PSGOEER=PSGOEER_X_";",PSGOEEF(+X)=Q
"RTN","PSGOEE",34,0)
 S LIMIT=$L(PSGOEER,";")-1,(PSGDEF,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>LIMIT  I +$P(PSGOEER,";",PSGOEE)=101 S PSGDEF=1
"RTN","PSGOEE",35,0)
 S PSGOEER=$E(PSGOEER,1,$L(PSGOEER)-1),(MSG,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>$L(PSGOEER,";")  S F1=$S(PSGOEEG=3:53.1,1:55.06) I 'PSGDEF!((PSGDEF)&(+$P(PSGOEER,";",PSGOEE)'=2)) D @$P(PSGOEER,";",PSGOEE) Q:'PSGOEE
"RTN","PSGOEE",36,0)
 Q
"RTN","PSGOEE",37,0)
EDLOOP ; Continue prompting for fields to edit.
"RTN","PSGOEE",38,0)
 D:$G(Y) EDIT
"RTN","PSGOEE",39,0)
 D ENNOU^PSGOEE0 I '$G(PSGOEENO),DR="" S VALMBCK="R" Q
"RTN","PSGOEE",40,0)
 K VALMSG
"RTN","PSGOEE",41,0)
 I '$G(PSGOEENO),$G(PSGPDNX) D CKDT
"RTN","PSGOEE",42,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",43,0)
 .S VALMSG="This change will cause a new order to be created." D GTSTATUS,CHKDD,CKDT
"RTN","PSGOEE",44,0)
 .S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT)
"RTN","PSGOEE",45,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGSD_"^^"_PSGFD)
"RTN","PSGOEE",46,0)
 K VALMBCK,PSJACEPT,PSGPDNX D EN^VALM("PSJU LM ACCEPT") Q:'$G(PSJACEPT)
"RTN","PSGOEE",47,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y) I ((",P,R,")'[(","_$G(PSGST)_",")) D  Q
"RTN","PSGOEE",48,0)
 .S PSJACEPT=0 W !!,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D PAUSE^VALM1
"RTN","PSGOEE",49,0)
 I $G(PSGOEENO) S PSJNOO=$$ENNOO^PSJUTL5("E")
"RTN","PSGOEE",50,0)
 D K1 S PSJACEPT=$S($G(PSJNOO)<0:0,1:1)
"RTN","PSGOEE",51,0)
 S VALMBCK=$S('PSJACEPT:"R",'PSGOEAV:"R",1:"Q")
"RTN","PSGOEE",52,0)
 Q
"RTN","PSGOEE",53,0)
CHKDD ;*** Check inactive Dispense drug within the order.
"RTN","PSGOEE",54,0)
 D CHKDRG^PSGOE2
"RTN","PSGOEE",55,0)
 Q
"RTN","PSGOEE",56,0)
CKDT ; Check if new start/stop dates should be calculated.
"RTN","PSGOEE",57,0)
 S PSGS0Y=$S($D(PSGS0Y):PSGS0Y,1:$G(PSGAT))
"RTN","PSGOEE",58,0)
 I ('$G(PSGNEWDT)&(PSGSD=$G(PSGOSD))&(PSGFD=$G(PSGOFD)))!($G(PSGOST)'=PSGST)!(PSGSCH'=$G(PSGOSCH))!($G(PSGPDNX)) D
"RTN","PSGOEE",59,0)
 .N PSGOES S PSGOES=1,PSGOFD=PSGFD D ^PSGNE3 S PSGSD=PSGNESD,PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFD=PSGNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD),PSGNEWDT=1
"RTN","PSGOEE",60,0)
 .I $D(PSGOFD),PSGOFD]"",PSGFD'=PSGOFD S PSGOEEF(25)=1
"RTN","PSGOEE",61,0)
 .I $D(PSGOSD),PSGOSD]"",PSGSD'=PSGOSD S PSGOEEF(10)=1
"RTN","PSGOEE",62,0)
 Q
"RTN","PSGOEE",63,0)
NEW3 ;
"RTN","PSGOEE",64,0)
 ;S:PSGOEAV PSGOEAV="0^1"
"RTN","PSGOEE",65,0)
NEW ;
"RTN","PSGOEE",66,0)
 W !,"...discontinuing original order..."
"RTN","PSGOEE",67,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D NEW^PSJCOM1 Q
"RTN","PSGOEE",68,0)
 ;DC and Unlock order.
"RTN","PSGOEE",69,0)
 S PSGEDIT="DE" D ENOR^PSGOECS,UNL^PSSLOCK(PSGP,PSGORD) K PSGEDIT
"RTN","PSGOEE",70,0)
 W !!," ...creating new order..." W:'PSGOEAV "(you will now work on this new order)"
"RTN","PSGOEE",71,0)
 S PSGS0Y=PSGAT,PSGNESD=PSGSD,PSGNEFD=PSGFD,PSGOEPR=PSGPR,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSGOEE",72,0)
 S PSGOORD=PSGORD D ^PSGOETO K PSGOEOS
"RTN","PSGOEE",73,0)
 I PSGOORD["U" S $P(^PS(55,PSGP,5,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",74,0)
 E  S $P(^PS(53.1,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",75,0)
 N CLINAPPT S CLINAPPT=$S(PSGOORD["U":$G(^PS(55,PSGP,5,+PSGOORD,8)),PSGOORD["P":$G(^PS(53.1,+PSGOORD,"DSS")),1:"") I CLINAPPT D
"RTN","PSGOEE",76,0)
 .N DIE,DA,DR
"RTN","PSGOEE",77,0)
 .I PSGORD["U" S DIE="^PS(55,"_PSGP_",5,",DA=+PSGORD,DA(1)=PSGP,DR="130////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"131////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOEE",78,0)
 .I PSGORD["P" S DIE="^PS(53.1,",DA=+PSGORD,DR="113////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"126////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOEE",79,0)
 .I $G(DR) D ^DIE
"RTN","PSGOEE",80,0)
 I 'PSGOEAV,($G(PSGORD)["P"),'$G(^PS(53.1,+PSGORD,2.5)),$G(^PS(53.1,+PSGORD,0)) D
"RTN","PSGOEE",81,0)
 . N DUR S DUR=$$GETDUR^PSJLIVMD(PSGP,PSGORD,$S(PSGORD["P":"P",1:5),1) I DUR]"" K DA,DR,DIE S DIE="^PS(53.1,",DA=+PSGORD,DR="116////"_DUR D ^DIE
"RTN","PSGOEE",82,0)
 I PSGOEAV,+PSJSYSU=3,'$D(PSGOES) D EN^PSGPEN(PSGORD),UNL^PSSLOCK(PSGP,PSGORD) Q
"RTN","PSGOEE",83,0)
 S PSJORD=PSGORD,PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD)
"RTN","PSGOEE",84,0)
 Q
"RTN","PSGOEE",85,0)
UPD ;
"RTN","PSGOEE",86,0)
 K DA W !!,"...updating order..."
"RTN","PSGOEE",87,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEE",88,0)
 N TMP,PSGSIF S TMP=PSGOEENO N PSGOEENO S PSGOEENO=TMP
"RTN","PSGOEE",89,0)
 N II F II=1:1:$L($G(DR),";") I $E($P($G(DR),";",II),1,7)="122////" S PSGSIF=$P(PSGSI,"^",2),PSGSI=$P(PSGSI,"^") Q
"RTN","PSGOEE",90,0)
 I $G(PSJCOM),$G(PSJCOMSI) K PSJCOMSI N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSGOEE",91,0)
 . S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSGOEE",92,0)
 .. Q:PSJCHILD=PSGORD  N DR,DA,DIE,ORD S DR=$S(PSJCHILD["V":"31////"_$G(P("OPI")),1:"8////"_$G(PSGSI)) S DR=DR_";"_$S(PSJCHILD["V":146,1:122)_"////"_+$G(PSGSIF)
"RTN","PSGOEE",93,0)
 .. I $E(DR)'="*" S DA=+PSJCHILD,DIE=$S(PSJCHILD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "." D EN1^PSJHL2(PSGP,"XX",+PSJCHILD_"U")
"RTN","PSGOEE",94,0)
 I $E(DR)'="*" S DA=+PSGORD,DIE=$S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "."
"RTN","PSGOEE",95,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."
"RTN","PSGOEE",96,0)
 S $P(@(PSGOEEWF_"1,0)"),"^",2)=$S(PSGORD["U":55.07,1:53.11)_"P"
"RTN","PSGOEE",97,0)
 ; Naked reference on the line below refers to full reference using indirection to either ^PS(55 or ^PS(53.1,
"RTN","PSGOEE",98,0)
 S ND=$G(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",0)")) I $P(ND,"^",21) S ORIFN=$P(ND,"^",21),ND1=$G(^(.2)),ND2=$G(^(2)) W !,"...updating OE/RR..." D EN1^PSJHL2(PSGP,"XX",PSGORD)
"RTN","PSGOEE",99,0)
 I $$ENACTION^PSGOE1(PSGP,PSGORD)["V" S VALMBCK="R"
"RTN","PSGOEE",100,0)
 I PSJSYSL,PSJSYSL<3 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEE",101,0)
 Q
"RTN","PSGOEE",102,0)
OUT ;
"RTN","PSGOEE",103,0)
 D ABORT K PSGNEWDT S PSGCANFL=1 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD)
"RTN","PSGOEE",104,0)
 Q
"RTN","PSGOEE",105,0)
DONE ;
"RTN","PSGOEE",106,0)
 I PSGORD["P",'$D(PSGOEF),PSGSCH]"",$O(^PS(53.1,+PSGORD,1,0)) D ENF^PSGOEE0
"RTN","PSGOEE",107,0)
DONE1 ;
"RTN","PSGOEE",108,0)
 I PSGORD["U" S X=+PSGORD L -^PS(55,PSGP,5,X)
"RTN","PSGOEE",109,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOEE",110,0)
 K ^PS(53.45,+PSJSYSP,1),^(2)
"RTN","PSGOEE",111,0)
 I '$D(PSGOEF) K PSGSD,PSGSCH,PSGST,PSGFD
"RTN","PSGOEE",112,0)
 K DA,DIE,DIR,DP,DR,DRG,ND,ND0,ND1,ND2,ORIFN,PSGAL,PSGALEF,PSGAT,PSGOEE,PSGOEEF,PSGOEEG,PSGOEEWF,PSGEFN,PSGTOL,PSGTOO,PSGUOW,XREF,PSGEFN,PSGMR,PSGMRN,PSGOROE1,PSGPD,PSGPDN,PSGSI,PSGPR,PSGSM,PSGHSM,PSGSTN,PSGSDN,PSGFDN,PSGPRN
"RTN","PSGOEE",113,0)
 K PSGDO,PSGOEENO Q
"RTN","PSGOEE",114,0)
K1 ;
"RTN","PSGOEE",115,0)
 K BACK,F1,F2,PSGF2,MSG,PSGEFN,PSGNEWDT,PSGOEEF,PSGOEEND,PSGOPD,PSGOPDN,PSGOMR,PSGOMRN,PSGOSCH,PSGOSI,PSGOPR,PSGOSM,PSGOHSM,PSGOSD,PSGOFD,PSGOST,PSGOPRN,PSGOSTN,PSGOSDN,PSGOFDN,PSGODO,PSGPDRG,PSGPDRGN,PSGOEER
"RTN","PSGOEE",116,0)
 Q
"RTN","PSGOEE",117,0)
 ;
"RTN","PSGOEE",118,0)
ABORT ; Display no change message and pause.
"RTN","PSGOEE",119,0)
 S (PSGDI,PSGDFLG)='$$DDOK^PSGOE2(PSGOEEWF_"1,",+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",120,0)
 S PSGPFLG='$$OIOK^PSGOE2(+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",121,0)
 W !!,$C(7),"No changes made to this order." D PAUSE^VALM1 K PSGOEEF S PSGOEEF=0
"RTN","PSGOEE",122,0)
 Q
"RTN","PSGOEE",123,0)
 ;
"RTN","PSGOEE",124,0)
GTSTATUS ; Determine status of new order and set LM title.
"RTN","PSGOEE",125,0)
 S PSGSTAT=$S($P($G(PSJSYSP0),U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEE",126,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S(PSGSTAT="PENDING":"("_PSGPRIO_")",1:"")
"RTN","PSGOEE",127,0)
 Q
"RTN","PSGOEE",128,0)
FIELDS ;
"RTN","PSGOEE",129,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",130,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",131,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEE",132,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",133,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEE",134,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEE",135,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",136,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",137,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEE",138,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",139,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",140,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEE",141,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEE",142,0)
51 ;;101^PSGOE9;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",143,0)
52 ;;109^PSGOE9;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",144,0)
53 ;;10^PSGOE91;PSGOSD;PSGSD;10;1
"RTN","PSGOEE",145,0)
54 ;;3^PSGOE9;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",146,0)
55 ;;34^PSGOE91;PSGOFD;PSGFD;34;1 
"RTN","PSGOEE",147,0)
56 ;;7^PSGOE9;PSGOST;PSGST;7;0
"RTN","PSGOEE",148,0)
57 ;;5^PSGOE92;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",149,0)
58 ;;26^PSGOE9;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",150,0)
59 ;;41^PSGOE91;PSGOAT;PSGAT;41;0
"RTN","PSGOEE",151,0)
510 ;;1^PSGOE92;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",152,0)
511 ;;8^PSGOE91;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",153,0)
512 ;;2^PSGOE92;;;2;0
"RTN","PSGOEE",154,0)
513 ;;15^PSGOE92;;;15;0
"RTN","PSGOEEW")
0^99^B28923213
"RTN","PSGOEEW",1,0)
PSGOEEW ;BIR/CML3-SHOW FIELDS FOR EDIT ;15 DEC 97 / 1:29 PM 
"RTN","PSGOEEW",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,58,111**;16 DEC 97
"RTN","PSGOEEW",3,0)
 ;
"RTN","PSGOEEW",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGOEEW",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGOEEW",6,0)
 ;
"RTN","PSGOEEW",7,0)
EN1 ;
"RTN","PSGOEEW",8,0)
 S PSGORD=^TMP("PSJON",$J,PSGOE2)
"RTN","PSGOEEW",9,0)
 ;
"RTN","PSGOEEW",10,0)
EN2 ;
"RTN","PSGOEEW",11,0)
 N %X,%Y,AT,DO,DRGI,FD,FL,FQC,NF,PRI,SD,SIG,ST,STD,STT,X,Y
"RTN","PSGOEEW",12,0)
 ;S NF=$S(PSGORD["P":0,PSGORD["A":0,PSGORD["O":0,1:1) I NF,$D(^PS(53.1,+PSGORD,0)),$P(^(0),"^",19),$D(^PS(55,PSGP,5,$P(^(0),"^",19))) S PSGORD=$P(^PS(53.1,+PSGORD,0),"^",19)_"A",NF=0
"RTN","PSGOEEW",13,0)
 ;naked references below refer to the full reference in the indirection @(PSGOEEWF_"0")
"RTN","PSGOEEW",14,0)
 S OD=$G(@(PSGOEEWF_"0)")),AT=$G(^(2)),PSGEB=$P($G(^(4)),"^",7),PSGOSI=$G(^(6)),DO=$G(^(.2)),PSGOINST=$G(^(.3)),PSGOPD=$P(DO,"^"),PSGODO=$P(DO,"^",2)
"RTN","PSGOEEW",15,0)
 S PSGOPR=$P(OD,"^",2),PSGOMR=$P(OD,"^",3),PSGOSM=$P(OD,"^",5),PSGOHSM=$P(OD,"^",6),(PSGOST,ST)=$P(OD,"^",7),(PSGSTAT,STT)=$P(OD,"^",9),PSGOMRN=$S('PSGOMR:"",1:$P($G(^PS(51.2,PSGOMR,0)),"^")) S:PSGOMRN="" PSGOMRN=PSGOMR
"RTN","PSGOEEW",16,0)
 S PSGLI=$P(OD,U,16),PSGNEDFD=$P($$GTNEDFD^PSGOE7("U",PSGOPD),U),PSGOSCH=$P(AT,"^"),(PSGOSD,SD)=$P(AT,"^",2),(FD,PSGOFD)=$P(AT,"^",4),(FQC,PSGS0XT)=$P(AT,"^",6),(PSGOAT,PSGS0Y)=$P(AT,"^",5)
"RTN","PSGOEEW",17,0)
 ;I FQC="D",PSGOAT="" S PSGOAT=$E($P(SD,".",2)_"0000",1,4)
"RTN","PSGOEEW",18,0)
 S PRI=$S('PSGOPR:0,1:$P($G(^VA(200,PSGOPR,"PS")),"^",4)),DRGI=$S(PSGOPD'=+PSGOPD:0,1:+$G(^PSDRUG(+PSGOPD,"I"))) S:PRI PRI=DT'<PRI S:DRGI DRGI=DT'<DRGI
"RTN","PSGOEEW",19,0)
 S PDRG=PSGOPD,PSGOPDN=$S('PSGOPD:"",1:$$OINAME^PSJLMUTL(+PSGOPD)) S:PSGOPDN="" PSGOPDN=PSGOPD S PSGOPRN=$S('PSGOPR:"",1:$P($G(^VA(200,PSGOPR,0)),"^")) S:PSGOPRN="" PSGOPRN=PSGOPR ; I PSGOSI]"" S PSGOSI=$$ENSET^PSGSICHK(PSGOSI)
"RTN","PSGOEEW",20,0)
 S PSGEBN=$$ENNPN^PSGMI(PSGEB)
"RTN","PSGOEEW",21,0)
 S PSGSTAT=$S(STT="":"NOT FOUND",STT="RE":"REINSTATED",1:$P(STT_"^ACTIVE^DISCONTINUED^EXPIRED^HOLD^INCOMPLETE^NON-VERIFIED^PENDING^RENEWED^UNRELEASED","^",$F("ADEHINPRU",STT)))
"RTN","PSGOEEW",22,0)
 ;
"RTN","PSGOEEW",23,0)
SET ;
"RTN","PSGOEEW",24,0)
 S PSGOSTN=$$ENSTN^PSGMI(ST),(PSGOFDN,PSGOSDN)="" I SD S PSGOSDN=$$ENDD^PSGMI(SD)_"^"_$$ENDTC^PSGMI(SD)
"RTN","PSGOEEW",25,0)
 I FD S PSGOFDN=$$ENDD^PSGMI(FD)_"^"_$$ENDTC^PSGMI(FD)
"RTN","PSGOEEW",26,0)
 F X="PD","PDN","MR","MRN","ST","STN","SCH","SI","SD","SDN","FD","FDN","SM","HSM","PR","PRN","DO","AT" S @("PSG"_X)=@("PSGO"_X)
"RTN","PSGOEEW",27,0)
 K ^PS(53.45,PSJSYSP,1),^(2) S %X=PSGOEEWF_"3,",%Y="^PS(53.45,"_PSJSYSP_",1," D %XY^%RCR S %X=PSGOEEWF_"1,",%Y="^PS(53.45,"_PSJSYSP_",2," D %XY^%RCR
"RTN","PSGOEEW",28,0)
 S $P(^PS(53.45,PSJSYSP,2,0),"^",2)="53.4502P"
"RTN","PSGOEEW",29,0)
 Q
"RTN","PSGOEEW",30,0)
 ;
"RTN","PSGOEEW",31,0)
ENW ;
"RTN","PSGOEEW",32,0)
 N D,ND,Q,QQ
"RTN","PSGOEEW",33,0)
 W:$Y @IOF,! W " Patient: ",$P(PSGP(0),"^")," (",PSJPPID,")",?55,"Ht(cm): " W:PSJPHT["_" PSJPHT W:PSJPHT'["_" $J(PSJPHT,6,2)
"RTN","PSGOEEW",34,0)
 W " ",PSJPHTD,!?4,"Ward: ",PSJPWDN,?55,"Wt(kg): " W:PSJPWT["_" PSJPWT W:PSJPWT'["_" $J(PSJPWT,6,2) W " ",PSJPWTD,!,"Room-Bed: ",PSJPRB
"RTN","PSGOEEW",35,0)
 W !,"Order Status: ",PSGSTAT,?37,"Entered By: ",PSGEBN,!,"--------------------------------------------------------------------------------"
"RTN","PSGOEEW",36,0)
 W !?1,$S($D(PSGEFN(1)):$E(" *",PSGEFN(1)+1)_"(1)",1:"    "),?16,"Drug: ",PSGPDN
"RTN","PSGOEEW",37,0)
 W !?1,$S($D(PSGEFN(2)):$E(" *",PSGEFN(2)+1)_"(2)",1:"    "),?6,"Dosage Ordered: ",PSGDO,?46,$S($D(PSGEFN(12)):$E(" *",PSGEFN(12)+1)_"(12)",1:"     "),"     Start: ",$P(PSGSDN,"^",2)
"RTN","PSGOEEW",38,0)
 W !?1,$S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    "),?11,"Med Route: ",PSGMRN,?46,$S($D(PSGEFN(13)):$E(" *",PSGEFN(13)+1)_"(13)",1:"     "),"      Stop: ",$P(PSGFDN,"^",2)
"RTN","PSGOEEW",39,0)
 W !?1,$S($D(PSGEFN(4)):$E(" *",PSGEFN(4)+1)_"(4)",1:"    "),?7,"Schedule Type: ",PSGSTN,?46,$S($D(PSGEFN(14)):$E(" *",PSGEFN(14)+1)_"(14)",1:"     "),"  Self Med: ",$P("NO^YES","^",PSGSM+1) I PSGSM,PSGHSM W "  (HS)"
"RTN","PSGOEEW",40,0)
 W !?1,$S($D(PSGEFN(5)):$E(" *",PSGEFN(5)+1)_"(5)",1:"    "),?12,"Schedule: ",PSGSCH
"RTN","PSGOEEW",41,0)
 W !?1,$S($D(PSGEFN(6)):$E(" *",PSGEFN(6)+1)_"(6)",1:"    "),?9,"Admin Times: ",PSGAT
"RTN","PSGOEEW",42,0)
 W !?1,$S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"    "),?12,"Provider: ",PSGPRN
"RTN","PSGOEEW",43,0)
 W !?1,$S($D(PSGEFN(8)):$E(" *",PSGEFN(8)+1)_"(8)",1:"    ")," Special Instructions: " I PSGSI]"" F Q=1:1:$L(PSGSI," ") S QQ=$P(PSGSI," ",Q) W:$L(QQ)+$X>79 !?28 W QQ," "
"RTN","PSGOEEW",44,0)
 W !!?1,$S($D(PSGEFN(9)):$E(" *",PSGEFN(9)+1)_"(9)",1:"    ")," Dispense Drug",?48,"U/D",?60,"Inactive Date",!,"-------------------------------------------------------------------------------"
"RTN","PSGOEEW",45,0)
 F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S ND=$G(^(Q,0)) D
"RTN","PSGOEEW",46,0)
 .S D=$P(ND,"^"),PSGID=$P(ND,"^",3) I PSGID S PSGID=$$ENDTC^PSGMI(PSGID)
"RTN","PSGOEEW",47,0)
 .S D=$S(D="":"NOT FOUND",'$D(^PSDRUG(D,0)):D,$P(^(0),"^")]"":$P(^(0),"^"),1:D_";PSDRUG(") W !?6,D,?48,$S($P(ND,"^",2):$P(ND,"^",2),1:1) W:PSGID ?60,PSGID
"RTN","PSGOEEW",48,0)
 W !!,$S($D(PSGEFN(10)):$E(" *",PSGEFN(10)+1)_"(10)",1:"     ")," Comments:" F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S Y=" "_$G(^(Q,0)) F Y1=2:1 S Y2=$P(Y," ",Y1) Q:Y2=""  W:$L(Y2)+$X>79 !?2 W " ",Y2
"RTN","PSGOEEW",49,0)
 ;W !!,$S($D(PSGEFN(11)):$E(" *",PSGEFN(11)+1)_"(11)",1:"     ")," Provider Comments:" F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,4,Q)) Q:'Q  W !?2,$G(^(Q,0))
"RTN","PSGOEEW",50,0)
 W !!,$S($D(PSGEFN(11)):$E(" *",PSGEFN(11)+1)_"(11)",1:"     ")," Provider Comments:"
"RTN","PSGOEEW",51,0)
 I $G(PSGORD) D
"RTN","PSGOEEW",52,0)
 .I $D(^PS(53.1,+PSGORD,12,1)) F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,12,Q)) Q:'Q  W !?2,$G(^(Q,0)) Q
"RTN","PSGOEEW",53,0)
 .I $D(^PS(53.1,+PSGORD,6)) W !?2,$G(^(6))
"RTN","PSGOEEW",54,0)
 K Q,Y,Y1,Y2
"RTN","PSGOEEW",55,0)
 Q
"RTN","PSGOEEW",56,0)
 ;
"RTN","PSGOEEW",57,0)
ENKILL ;
"RTN","PSGOEEW",58,0)
 K PSGAT,PSGEB,PSGFD,PSGHSM,PSGNEFD,PSGNESD,PSGOEEF,PSGOEER,PSGOFD,PSGOHSM,PSGOMR,PSGOMRN,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGOSD,PSGOSM,PSGOST,PSGPD,PSGPDN,PSGPR,PSGSD,PSGSM Q
"RTN","PSGOEEW",59,0)
HILIGHT ; 
"RTN","PSGOEEW",60,0)
 ;         
"RTN","PSGOEEW",61,0)
5 ;;3,46,34
"RTN","PSGOEEW",62,0)
7 ;;4,7,45
"RTN","PSGOEEW",63,0)
8 ;;8,5,80
"RTN","PSGOEEW",64,0)
10 ;;2,46,34
"RTN","PSGOEEW",65,0)
25 ;;3,46,34
"RTN","PSGOEEW",66,0)
26 ;;6,12,56
"RTN","PSGOEEW",67,0)
39 ;;6,9,71
"RTN","PSGOEEW",68,0)
40 ;;
"RTN","PSGOEEW",69,0)
66 ;;9,5,80
"RTN","PSGOEEW",70,0)
101 ;;1,6,74
"RTN","PSGOEEW",71,0)
109 ;;2,6,40
"RTN","PSGOEF")
0^87^B53688927
"RTN","PSGOEF",1,0)
PSGOEF ;BIR/CML3-FINISH ORDERS ENTERED THROUGH OE/RR ;14 May 98 / 2:17 PM
"RTN","PSGOEF",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,30,29,35,39,47,50,56,80,116,110,111**;16 DEC 97
"RTN","PSGOEF",3,0)
 ;
"RTN","PSGOEF",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOEF",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOEF",6,0)
 ; Reference to DOSE^PSSORPH is supported by DBIA 3234.
"RTN","PSGOEF",7,0)
 ;
"RTN","PSGOEF",8,0)
START ;
"RTN","PSGOEF",9,0)
 I '$D(^PS(53.1,+PSGORD)) W $C(7),!?3,"Cannot find this pending order (#",+PSGORD,")." Q
"RTN","PSGOEF",10,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12) K PSGFDX,PSGEFN,PSGOEEF,PSGOES,PSGONF,PSGRDTX S PSGOES=1,(PSGOEF,PSGOEEF)=0,PSGOEEG=3
"RTN","PSGOEF",11,0)
 I $D(PSJTUD) S PSGDO=$P($G(^PS(53.1,+PSGORD,.3)),U),(PSGPDRG,PSGPD)=PSJCOI,(PSGPDRGN,PSGPDN)=$$OINAME^PSJLMUTL(PSGPD)
"RTN","PSGOEF",12,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S X=PSGSCH D EN^PSGORS0 S:$D(X) PSGAT=PSGS0Y D
"RTN","PSGOEF",13,0)
 . NEW PSJDOX,PSJDOSE,PSJPIECE,PSJUNIT,PSJX,X
"RTN","PSGOEF",14,0)
 . S X=$G(^PS(53.1,+PSGORD,1,1,0)) Q:'+X
"RTN","PSGOEF",15,0)
 . D DOSE^PSSORPH(.PSJDOX,+X,"U")
"RTN","PSGOEF",16,0)
 . I $S('$D(PSJDOX):1,1:+PSJDOX(1)=-1) Q
"RTN","PSGOEF",17,0)
 . S PSJPIECE=$S($P(PSJDOX(1),U)="":3,1:1)
"RTN","PSGOEF",18,0)
 . S X=^PS(53.1,+PSGORD,.2)
"RTN","PSGOEF",19,0)
 . S:PSJPIECE=3 PSJDOSE=$P(X,U,2)
"RTN","PSGOEF",20,0)
 . S:PSJPIECE=1 PSJDOSE=$P(X,U,5),PSJUNIT=$P(X,U,6)
"RTN","PSGOEF",21,0)
 . F X=0:0 S X=$O(PSJDOX(X)) Q:+$G(PSJX)!'X  D
"RTN","PSGOEF",22,0)
 .. I PSJPIECE=3,($P(PSJDOX(X),U,3)'=PSJDOSE) Q
"RTN","PSGOEF",23,0)
 .. I PSJPIECE=1,($P(PSJDOX(X),U,1)_$P(PSJDOX(X),U,2)'=(PSJDOSE_PSJUNIT)) Q
"RTN","PSGOEF",24,0)
 .. S:+$P(PSJDOX(X),U,12) $P(^PS(53.45,PSJSYSP,2,1,0),U,2)=+$P(PSJDOX(X),U,12),PSJX=1
"RTN","PSGOEF",25,0)
 I PSGEB'=PSGOPR F X=7,11 S Y=$T(@(3_X)),@("PSGEFN("_X_")="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEF",26,0)
 D GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",27,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S PSGSD="" D:PSGS0Y]""
"RTN","PSGOEF",28,0)
 .N PSJX S PSJX=$P($G(^PS(53.1,+PSGORD,0)),U,25) I PSJX="" Q
"RTN","PSGOEF",29,0)
 .I PSJX["U" S PSGSD=$P($G(^PS(55,DFN,5,+PSJX,2)),U,2) Q
"RTN","PSGOEF",30,0)
 .I PSJX["V" S PSGSD=$P($G(^PS(55,DFN,"IV",+PSJX,0)),U,2) Q
"RTN","PSGOEF",31,0)
 .I PSJX["P" S PSGSD=$P($G(^PS(53.1,+PSJX,2)),U,2)
"RTN","PSGOEF",32,0)
 S:PSGSD="" PSGSD=PSGLI
"RTN","PSGOEF",33,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",+PSGPD)
"RTN","PSGOEF",34,0)
 S:$P($G(PSGNEDFD),U,3)="" $P(PSGNEDFD,U,3)=PSGST  ; N PSGOEA S PSGOEA="R"
"RTN","PSGOEF",35,0)
 S (PSGNESD,PSGSD)=$$ENSD^PSGNE3(PSGSCH,PSGS0Y,PSGLI,PSGSD)
"RTN","PSGOEF",36,0)
 ;if this is a renewal order, ignore any 'requested start date' received.  Use the system calculated start date.
"RTN","PSGOEF",37,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" D
"RTN","PSGOEF",38,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEF",39,0)
 E  D
"RTN","PSGOEF",40,0)
 . S X=$$DSTART^PSJDCU(DFN,$P(^PS(53.1,+PSGORD,0),U,25)) I X]"" S (PSGNESD,PSGSD)=X K PSGRSD
"RTN","PSGOEF",41,0)
 D ENFD^PSGNE3(PSGLI) S PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGFD")):PSGRDTX(+PSGORD,"PSGFD"),1:PSGNEFD)
"RTN","PSGOEF",42,0)
 N DUR,PSGRNSD S PSGRNSD=+$$LASTREN^PSJLMPRI(DFN,PSGORD) I PSGRNSD S DUR=$$GETDUR^PSJLIVMD(DFN,PSGORD,"P",1) I DUR]"" D
"RTN","PSGOEF",43,0)
 . N DURMIN S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN S PSGFD=$$FMADD^XLFDT(PSGRNSD,,,DURMIN)
"RTN","PSGOEF",44,0)
 S PSGOFD="",PSGSDN=$$ENDD^PSGMI(PSGSD)_U_$$ENDTC^PSGMI(PSGSD),PSGFDN=$$ENDD^PSGMI(PSGFD)_U_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOEF",45,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSGOEF",46,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) N DRG,DRGCNT S DRGCNT=0 D
"RTN","PSGOEF",47,0)
 .F X=0:0 S X=$O(^PSDRUG("ASP",+PSGPD,X)) Q:'X!(DRGCNT>1)  S:$P($G(^PSDRUG(+X,2)),U,3)["U" DRGCNT=DRGCNT+1,DRG=+X
"RTN","PSGOEF",48,0)
 .I DRGCNT=1 K ^PS(53.45,PSJSYSP,2) S ^PS(53.45,PSJSYSP,2,1,0)=DRG_U_1,^PS(53.45,PSJSYSP,2,0)="^53.4502^1^1",PS(53.45,PSJSYSP,2,"B",+DRG,1)=""
"RTN","PSGOEF",49,0)
 Q
"RTN","PSGOEF",50,0)
FINISH ;
"RTN","PSGOEF",51,0)
 ; force display of second screen if CPRS order checks exist
"RTN","PSGOEF",52,0)
 N NSFF,PSGOEF39 S NSFF=1 K PSJNSS
"RTN","PSGOEF",53,0)
 I $G(PSGORD),$D(PSGRDTX(+PSGORD)) D  K PSGRDTX
"RTN","PSGOEF",54,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRSD")) PSGSD=PSGRDTX(+PSGORD,"PSGRSD")
"RTN","PSGOEF",55,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRFD")) PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGRFD")):PSGRDTX(+PSGORD,"PSGRFD"),1:$G(PSGNEFD))
"RTN","PSGOEF",56,0)
 N PSJCOM S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8)
"RTN","PSGOEF",57,0)
 I $O(^PS(53.1,+PSGORD,12,0))!$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSGOEF",58,0)
 .Q:$G(PSJLMX)=1  ; there's no second screen to display
"RTN","PSGOEF",59,0)
 .S VALMBG=16 D RE^VALM4,PAUSE^VALM1
"RTN","PSGOEF",60,0)
 D FULL^VALM1
"RTN","PSGOEF",61,0)
 I $G(PSJPROT)=3,'$D(PSJTUD),'$$ENIVUD^PSGOEF1(PSGORD) Q
"RTN","PSGOEF",62,0)
 S CHK=0 S:$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" PSGSI=$$ENPC^PSJUTL("U",+PSJSYSP,180,PSGSI)
"RTN","PSGOEF",63,0)
 I $G(PSGOSCH)]"" D  S:$G(PSGS0XT)'<0 $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSGOEF",64,0)
 .N PSGOES,PSGS0Y,PSGSCH S X=PSGOSCH K:$G(PSJTUD) NSFF D ENOS^PSGS0 I $G(X)]""&$G(PSGS0Y) S PSGAT=PSGS0Y
"RTN","PSGOEF",65,0)
 .I $G(PSJNSS) S PSGOSCH="" K PSJNSS
"RTN","PSGOEF",66,0)
 I '$G(PSJTUD),$G(PSJNSS),($G(PSGOSCH)]"") D NSSCONT^PSGS0(PSGOSCH,PSGS0XT) K PSJNSS S PSGOSCH=""
"RTN","PSGOEF",67,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10)
"RTN","PSGOEF",68,0)
 I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")
"RTN","PSGOEF",69,0)
 I 'PSGOEFF I (($G(PSGS0XT)="D")&($G(PSGAT)="")) S X=" Admin Times",PSGOEFF=1,PSGOEF39=1
"RTN","PSGOEF",70,0)
 I PSGOEFF,X]"" S X=X_" before it can be finished."
"RTN","PSGOEF",71,0)
 I PSGOEFF S CHK=1 W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSGOEF",72,0)
 I $G(PSGOEF39) S PSGOEE=0,PSGOEFF=0 D  I 'PSGOEE D REFRESH^VALM G DONE
"RTN","PSGOEF",73,0)
 .S F1=53.1,MSG=0,Y=$T(39),@("PSGFN(39)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEEF,PSGOEE)=1 W ! D @$P($T(39),";",3) S CHK=0
"RTN","PSGOEF",74,0)
 I PSGOEFF=1 S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0 G:'PSGOEE DONE
"RTN","PSGOEF",75,0)
 I PSGOEFF=11 S F1=53.1,MSG=0,Y=$T(32),@("PSGFN(32)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(32),";",3) D  G:'PSGOEE DONE
"RTN","PSGOEF",76,0)
 .S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0
"RTN","PSGOEF",77,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(+PSGPD,0) I CHK D ABORTACC Q
"RTN","PSGOEF",78,0)
 I 'PSGOEFF D OC531^PSGOESF ; check every dispense drug from CPRS
"RTN","PSGOEF",79,0)
 S VALMBG=1
"RTN","PSGOEF",80,0)
 I 'PSGOEFF&($D(PSGORQF)) D RE^VALM4 Q
"RTN","PSGOEF",81,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSGOEF",82,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",83,0)
 S PSJLMFIN=1
"RTN","PSGOEF",84,0)
 K PSJACEPT I $O(^PS(53.1,+PSGORD,12,0)) S PSJLMP2=1
"RTN","PSGOEF",85,0)
 S PSGOEENO=0,PSGSTAT=$S($P(PSJSYSP0,U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEF",86,0)
 NEW PSJDOSE,PSJDOX,PSJDSFLG
"RTN","PSGOEF",87,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEF",88,0)
 S:+$G(PSJDSFLG) VALMSG="Dosage Ordered & Dispense Drug are not compatible"
"RTN","PSGOEF",89,0)
 I PSGODO=PSGDO S PSGOEEF(109)=""
"RTN","PSGOEF",90,0)
 I PSGODO'=PSGDO S PSGOEENO=1,VALMSG="This change will cause a new order to be created  "
"RTN","PSGOEF",91,0)
 D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEF",92,0)
 I $G(PSJNSS) D  S PSGOEEF(26)="" K PSJACEPT,PSJNSS
"RTN","PSGOEF",93,0)
 .K DIR S DIR(0)="FOA",DIR("A")="Invalid Schedule" D ^DIR K DIR
"RTN","PSGOEF",94,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y),'$G(PSGAT),((",P,R,")'[(","_$G(PSGST)_",")) D  S PSGOEEF(39)="" K PSJACEPT
"RTN","PSGOEF",95,0)
 .K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules  " D ^DIR K DIR
"RTN","PSGOEF",96,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",97,0)
 I $G(PSJRNF),$G(^PS(53.1,+PSGORD,4)) D
"RTN","PSGOEF",98,0)
 . W $C(7),!!,"ACCEPTING THIS ORDER WILL CHANGE THE STATUS TO ACTIVE."
"RTN","PSGOEF",99,0)
 . S DIR(0)="Y",DIR("A")="Do you wish to make this order Active",DIR("?",1)="Enter ""N"" if you wish to exit without Activating this order,"
"RTN","PSGOEF",100,0)
 . S DIR("?")="or ""Y"" to continue with the Activation process." D ^DIR S:'Y Y=-1 K DIR
"RTN","PSGOEF",101,0)
 I $G(PSJRNF),$G(Y)=-1 S PSJACEPT=0 D ABORTACC Q
"RTN","PSGOEF",102,0)
 I $G(PSJRNF),$G(Y)=1 S PSGOEAV=1
"RTN","PSGOEF",103,0)
 I PSGOEENO S PSJNOO=$$ENNOO^PSJUTL5("E"),PSJACEPT=$S(PSJNOO<0:0,1:1)
"RTN","PSGOEF",104,0)
ACCEPT ;
"RTN","PSGOEF",105,0)
 S VALMBCK=$S($G(PSJACEPT):"Q",1:"R")
"RTN","PSGOEF",106,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",107,0)
 K PSGOES,PSGRSD,PSGRSDN D:PSGOEENO NEW3^PSGOEE D:'PSGOEENO UPD^PSGOEF1 I $D(PSGOEF)!PSGOEENO S PSGCANFL=-1
"RTN","PSGOEF",108,0)
 D DONE1^PSGOEE
"RTN","PSGOEF",109,0)
 D DONE
"RTN","PSGOEF",110,0)
 Q
"RTN","PSGOEF",111,0)
BYPASS ;
"RTN","PSGOEF",112,0)
 S PSGCANFL=1
"RTN","PSGOEF",113,0)
 ;
"RTN","PSGOEF",114,0)
DONE ;
"RTN","PSGOEF",115,0)
 K CHK,DA,DIE,DR,DRG,MSG,Q1,Q2 ;PSGND,PSGOEE,PSGOEEF,PSGOEEND,PSGOEEG,PSGOEF,PSGOEFF,PSGOES,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGPDRG,PSGDRGN,PSG0XT,PSGS0Y,OSGSD,Q1,Q2
"RTN","PSGOEF",116,0)
 Q
"RTN","PSGOEF",117,0)
ABORTACC ; Abort Accept process.
"RTN","PSGOEF",118,0)
 D ABORT^PSGOEE K PSGOEEF D GETUD^PSJLMGUD(PSGP,PSGORD),^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD) S VALMBCK="R",PSGSD=PSGNESD,PSGFD=PSGNEFD Q
"RTN","PSGOEF",119,0)
 ;
"RTN","PSGOEF",120,0)
 ;
"RTN","PSGOEF",121,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEF",122,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEF",123,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEF",124,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEF",125,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEF",126,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEF",127,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEF",128,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1      
"RTN","PSGOEF",129,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEF",130,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEF",131,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEF",132,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEF",133,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEF",134,0)
 ;
"RTN","PSGOEF",135,0)
AH ;
"RTN","PSGOEF",136,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSGOEF",137,0)
 Q
"RTN","PSGOER")
0^95^B71999379
"RTN","PSGOER",1,0)
PSGOER ;BIR/CML3-RENEW A SINGLE ORDER ;07 MAR 96 / 1:23 PM
"RTN","PSGOER",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**11,30,29,35,70,58,95,110,111**;16 DEC 97
"RTN","PSGOER",3,0)
 ;
"RTN","PSGOER",4,0)
 ; Reference to ^PS(51.1 supported by DBIA 2177.
"RTN","PSGOER",5,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOER",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSGOER",7,0)
 ; Reference to ^PSBAPIPM is supported by DBIA 3564.
"RTN","PSGOER",8,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181.
"RTN","PSGOER",9,0)
 ;
"RTN","PSGOER",10,0)
 ; renew a single order
"RTN","PSGOER",11,0)
 I $G(PSJCOM) D ^PSJCOMR Q
"RTN","PSGOER",12,0)
 N PSJEXPIR S PSJEXPIR=$$EXPIRED(PSGP,PSGORD) I PSJEXPIR D  Q
"RTN","PSGOER",13,0)
 .W !!?3,"  THIS ORDER" W:PSJEXPIR'=2 " HAS BEEN INACTIVE FOR ONE OR MORE SCHEDULED",!?8," ADMINISTRATIONS AND"
"RTN","PSGOER",14,0)
 .W " CANNOT BE RENEWED!" D PAUSE^VALM1
"RTN","PSGOER",15,0)
 I $G(PSGSCH)]"",($G(PSGS0XT)="D"),($G(PSGAT)="") D  Q
"RTN","PSGOER",16,0)
 .N SWD,SDW,XABB,X,QX S X=$G(PSGSCH) D DW^PSGS0 Q:($G(X)="")  I $G(PSGS0XT)="" S PSGS0XT="D"
"RTN","PSGOER",17,0)
 .Q:((",P,R,")[(","_$G(PSGST)_","))
"RTN","PSGOER",18,0)
 .I $G(PSGS0XT)="D",$G(PSGAT)="" S CHK=1 W !!?3,"This order contains a 'DAY OF THE WEEK' schedule without admin times"
"RTN","PSGOER",19,0)
 .W !?11," and CANNOT be renewed!" D PAUSE^VALM1
"RTN","PSGOER",20,0)
 I $G(PSGSCH)]"",'$$DOW^PSIVUTL(PSGSCH),'$$PRNOK^PSGS0(PSGSCH) I '$D(^PS(51.1,"AC","PSJ",PSGSCH)) D  Q
"RTN","PSGOER",21,0)
 .W !!?3,"This order contains an invalid schedule and CANNOT be renewed!" D PAUSE^VALM1
"RTN","PSGOER",22,0)
 W !! K DIR S DIR(0)="Y",DIR("A")=$S($P(PSJSYSP0,"^",3):"RENEW THIS ORDER",1:"MARK THIS ORDER FOR RENEWAL"),DIR("B")="YES"
"RTN","PSGOER",23,0)
 S DIR("?")="Answer 'YES' to "_$S($P(PSJSYSP0,"^",3):"renew this order",1:"mark this order for renewal")_".  Answer 'NO' (or '^') to stop now." D ^DIR
"RTN","PSGOER",24,0)
 I '$D(DIRUT),Y D NEW S PSGCANFL=1 D DONE Q
"RTN","PSGOER",25,0)
 I '$D(DIRUT),PSJSYSU S PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I $P(PSGND4,"^",15),$P(PSGND4,"^",16) D UNMARK,DONE Q
"RTN","PSGOER",26,0)
 D DONE,ABORT^PSGOEE
"RTN","PSGOER",27,0)
 Q
"RTN","PSGOER",28,0)
 ;
"RTN","PSGOER",29,0)
UNMARK ;  
"RTN","PSGOER",30,0)
 W !!,"THIS ORDER HAS BEEN 'MARKED FOR RENEWAL'.",! K DIR S DIR(0)="Y",DIR("A")="DO YOU WANT TO 'UNMARK IT'",DIR("B")="NO"
"RTN","PSGOER",31,0)
 S DIR("?",1)="  Answer 'YES' to unmark this order.  Answer 'NO' (or '^') to leave the order",DIR("?")="marked.  (An answer is required.)" D ^DIR
"RTN","PSGOER",32,0)
 I 'Y D ABORT^PSGOEE G DONE
"RTN","PSGOER",33,0)
 S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=21180+PSJSYSU D ^PSGAL5 S $P(PSGND4,"^",15,17)="^^",^PS(55,PSGP,5,DA,4)=PSGND4 W "...DONE!"
"RTN","PSGOER",34,0)
 ;
"RTN","PSGOER",35,0)
DONE ;
"RTN","PSGOER",36,0)
 K %DT,DA,DIE,DIR,DR,FDSD,PSGAL,PSGALR,PSGDL,PSGDLS,PSGFD,PSGFOK,PSGND4,PSGOEE,PSGOER0,PSGOER1,PSGOER2,PSGOERDP,PSGOPR,PSGOSD,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGRD,PSGSD,PSGTOL,PSGTOO,PSGUOW,PSGWLL,RF Q
"RTN","PSGOER",37,0)
 ;
"RTN","PSGOER",38,0)
NEW ; get info, write record
"RTN","PSGOER",39,0)
EXTEND ; extend stop date on renewal order
"RTN","PSGOER",40,0)
 N DUOUT,PSJABT,PSGDRG,PSJREN,PSGOREAS S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^"),PSJREN=1
"RTN","PSGOER",41,0)
 I $G(PSGST)="O" N ACT S ACT=$$EN^PSBAPIPM(PSGP,PSGORD) I $P(ACT,"^",2),($P(ACT,"^",3)="G") I $P(ACT,"^",2)>$P($G(^PS(55,PSGP,5,+PSGORD,2)),"^",2) D  Q
"RTN","PSGOER",42,0)
 . W !!?5,"THIS ONE-TIME ORDER HAS ALREADY BEEN GIVEN AND CANNOT BE RENEWED",! S (DIRUT,PSGORQF)=1 D READ
"RTN","PSGOER",43,0)
 D OC55
"RTN","PSGOER",44,0)
 Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSGOER",45,0)
 D NOW^%DTC S PSGDT=%,PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I '$P(PSJSYSP0,"^",3) D MARK Q
"RTN","PSGOER",46,0)
 S PSGWLL=$S('$P(PSJSYSW0,"^",4):0,1:+$G(^PS(55,PSGP,5.1))),PSGOEE="R" K PSGOEOS
"RTN","PSGOER",47,0)
 K ^PS(53.45,PSJSYSP,1),^(2) D MOVE(3,1),MOVE(1,2)
"RTN","PSGOER",48,0)
 D DATE^PSGOER0(PSGP,PSGORD,PSGDT) I ($G(X)="^")!'$D(PSGFOK(106))!$G(DUOUT) D DONE,ABORT^PSGOEE S VALMBCK="R",COMQUIT=1 Q
"RTN","PSGOER",49,0)
SPEED ;
"RTN","PSGOER",50,0)
 I +$G(PSJSYSU)=3 D EN^PSGPEN(PSGORD)
"RTN","PSGOER",51,0)
 Q:$G(DUOUT)
"RTN","PSGOER",52,0)
 N PSGOEAV S PSGOEAV=+PSJSYSU
"RTN","PSGOER",53,0)
 W !!,"...updating order..." K DA S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5 W "."
"RTN","PSGOER",54,0)
 I $$LS^PSSLOCK(PSGP,PSGORD) D UPDREN(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO),UPDRENOE(PSGP,PSGORD,PSGDT) D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOER",55,0)
 ;
"RTN","PSGOER",56,0)
 I 'PSGOERDP,$P(PSJSYSW0,"^",4),PSGFD'<PSGWLL S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSGOER",57,0)
 W ".DONE!" S VALMBCK="Q" Q
"RTN","PSGOER",58,0)
 ;
"RTN","PSGOER",59,0)
MARK ;
"RTN","PSGOER",60,0)
 I $P(PSGND4,"^",15),$P(PSGND4,"^",16) W $C(7),!!?3,"...THIS ORDER IS ALREADY MARKED FOR RENEWAL!..." Q
"RTN","PSGOER",61,0)
 K DA S $P(PSGND4,"^",15,17)="1^"_DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=PSGND4,PSGAL("C")=13180,DA(1)=PSGP,DA=+PSGORD W "." D ^PSGAL5
"RTN","PSGOER",62,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="R",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOER",63,0)
 Q
"RTN","PSGOER",64,0)
MOVE(X,Y) ; Move comments/dispense drugs from 55 to 53.45.
"RTN","PSGOER",65,0)
 S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,X,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,Y,Q,0)=$G(^(Q,0))
"RTN","PSGOER",66,0)
 S:Q ^PS(53.45,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSGOER",67,0)
 Q
"RTN","PSGOER",68,0)
OC55 ;* Order checks for Speed finish and regular finish
"RTN","PSGOER",69,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG
"RTN","PSGOER",70,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOER",71,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,+$G(^PS(55,PSGP,5,+PSGORD,1,1,0)))
"RTN","PSGOER",72,0)
 I '$D(PSGORQF) K PSGORQF,^TMP($J,"DI") D
"RTN","PSGOER",73,0)
 . F PSGDDI=1:0 S PSGDDI=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDDI)) Q:'PSGDDI  S PSJDD=+$G(^PS(55,PSGP,5,+PSGORD,1,PSGDDI,0)) K PSJPDRG D IVSOL^PSGSICHK
"RTN","PSGOER",74,0)
 Q
"RTN","PSGOER",75,0)
UPDREN(PSGORD,RNWDT,PSGOEPR,PSGOFD,PSJNOO,RDUZ) ; update renewed order
"RTN","PSGOER",76,0)
 N DR,DA,DIC,DIE,DD,DO,PSGRZERO,PSGRFOUR
"RTN","PSGOER",77,0)
 S DR="",PSGOEENO=0,PSGOORD=PSGORD,PSGNESD=PSGSD Q:'PSGORD!'RNWDT!'PSGOEPR!'PSGOFD  S PSJNOO=$S($G(PSJNOO)]"":$G(PSJNOO),1:"E")
"RTN","PSGOER",78,0)
 S PSGRZERO="^PS(55,"_PSGP_",5,"_+PSGORD_",0)",PSGOEORD=$P(@PSGRZERO,"^",21)
"RTN","PSGOER",79,0)
 S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5," S DR="34////^S X=PSGFD" S:$G(PSGOEPR) DR=DR_";1////"_PSGOEPR_";110////"_PSJNOO D ^DIE
"RTN","PSGOER",80,0)
 K DR,DA,DIC,DIE,DD,DO S DIC="^PS(55,"_PSGP_",5,"_+PSGORD_",14,",DIC(0)="L",DIC("P")="55.6114DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=PSGP,DA(1)=+PSGORD D
"RTN","PSGOER",81,0)
 . S DIC("DR")=".01////"_$G(RNWDT)_";1////"_$S($G(RDUZ):RDUZ,1:$G(DUZ))_";2////"_$G(PSGOEPR)_";3////"_$G(PSGOFD)_";4////"_+PSGOEORD,X=$G(RNWDT) D FILE^DICN
"RTN","PSGOER",82,0)
 K DR,DA,DIC,DIE,DD,DO S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5,",DR="28////A;105////@;107////@"
"RTN","PSGOER",83,0)
 S PSGRFOUR="^PS(55,"_PSGP_",5,"_+PSGORD_",0)",PSGRFOUR=@PSGRFOUR I $P(PSGRFOUR,"^",2)<RNWDT S DR=DR_";16////@;17////@"
"RTN","PSGOER",84,0)
 I '$G(PSJSPEED) I $G(PSGAT)]"",$G(PSGAT)'=$P($G(@(DIE_+PSGORD_",2)")),"^",5) S DR=DR_";41////"_PSGAT
"RTN","PSGOER",85,0)
 D ^DIE
"RTN","PSGOER",86,0)
 Q
"RTN","PSGOER",87,0)
UPDRENOE(PSGP,PSGORD,RDATE) ;
"RTN","PSGOER",88,0)
 D EXPOE(PSGP,PSGORD,$G(RDATE)) ; expire original Orders File order
"RTN","PSGOER",89,0)
 I PSGORD'["P" K DA,DR,DIE S DA(1)=DFN,DA=+PSGORD,DIE="^PS(55,"_DFN_$S(PSGORD="U":",5,",1:",""IV"","),DR=$S(DIE["IV":110,1:66)_"////@" D ^DIE
"RTN","PSGOER",90,0)
 D ENUDTX^PSJOREN(PSGP,PSGORD,"NR")
"RTN","PSGOER",91,0)
 D EN1^PSJHL2(PSGP,"SN",PSGORD,"ORDER RENEWED")
"RTN","PSGOER",92,0)
 Q
"RTN","PSGOER",93,0)
READ ; hold screen
"RTN","PSGOER",94,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","PSGOER",95,0)
 W !?5,"Press return to continue  " R X:$S($D(DTIME):DTIME,1:300)
"RTN","PSGOER",96,0)
 Q
"RTN","PSGOER",97,0)
EXPOE(DFN,PSJORDER,EXPDT) ; expire old Orders File entry
"RTN","PSGOER",98,0)
 I PSJORDER["P" S FILE="^PS(53.1,"_+PSJORDER_",0)",PSJORDER=$P(@FILE,"^",25)
"RTN","PSGOER",99,0)
 I (PSJORDER'["U"),(PSJORDER'["V") Q
"RTN","PSGOER",100,0)
 N CURDAT D NOW^%DTC S CURDAT=$$DATE2^PSJUTL2(%)
"RTN","PSGOER",101,0)
 S PSJEXPOE=$S($G(EXPDT):EXPDT,1:CURDAT) D EN1^PSJHL2(DFN,"SC",PSJORDER) K PSJEXPOE
"RTN","PSGOER",102,0)
 Q
"RTN","PSGOER",103,0)
EXPIRED(PSJX,PSJY) ;
"RTN","PSGOER",104,0)
 ; INPUT 
"RTN","PSGOER",105,0)
 ;       PSJX - Pharmacy Patient, pointer to ^PS(55
"RTN","PSGOER",106,0)
 ;       PSJY - Inpatient Order Number, pointer to IV or UD multiple of Pharmacy Patient file (appended with "V" or "U")
"RTN","PSGOER",107,0)
 ; OUTPUT
"RTN","PSGOER",108,0)
 ;   0  -  Order has not exceeded the Expired Time Limit 
"RTN","PSGOER",109,0)
 ;   1  -  Order has exceeded the Expired Time Limit
"RTN","PSGOER",110,0)
 N STOP,STATUS,NOW,CUTOFF,FREQ,LAST,ST,X,DFN,U,PSGDT,SD,WD,PSJPSTO,PSGDW,PSGOC,ZZND,LASTAT,LSTSTR,PSBCNT S DFN=PSJX,U="^",CUTOFF=0
"RTN","PSGOER",111,0)
 S STATUS=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,0)),"^",9),PSJY["V":$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",17),1:"")
"RTN","PSGOER",112,0)
 S NOW=$S($G(PSGDT):PSGDT,1:$$DATE^PSJUTL2())
"RTN","PSGOER",113,0)
 S STOP=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,2)),U,4),1:$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",3))
"RTN","PSGOER",114,0)
 I NOW<STOP Q 0
"RTN","PSGOER",115,0)
 I PSJY["U" N ND2,ND0 S ND0=$G(^PS(55,PSJX,5,+PSJY,0)),ND2=$G(^PS(55,PSJX,5,+PSJY,2)),FREQ=$P(ND2,"^",6) D
"RTN","PSGOER",116,0)
 .N SCHED S SCHED=$P($G(^PS(55,PSJX,5,+PSJY,2)),"^") I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED)
"RTN","PSGOER",117,0)
 .S LSTSTR=$P(ND2,"^",2)_"^"_$P(ND2,"^",4)_"^"_SCHED_"^"_$P(ND0,"^",7)_"^^"_$P(ND2,"^",5)
"RTN","PSGOER",118,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,($P(ND0,"^",7)="O"),($P(LAST,"^",3)="G") I LAST>$P(ND2,"^",2) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",119,0)
 .I 'LAST!(LAST>$P(ND2,"^",4)) S LAST=$$LASTAT^PSJORP2(DFN,LSTSTR) S:LAST CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",120,0)
 .I SCHED["PRN",($P(LSTSTR,"^",6)="") S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",121,0)
 .I $$DOW^PSIVUTL(SCHED) S CUTOFF=$$NXTDOW(DFN,$P(LSTSTR,"^"),$P(LSTSTR,"^",2),$P(LSTSTR,"^",3),$P(LSTSTR,"^",6)) Q
"RTN","PSGOER",122,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND2,"^",4)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",123,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,,,FREQ) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",124,0)
 I PSJY["V" N LIMIT S LIMIT=$P($G(^PS(59.7,1,31)),"^",4) S LIMIT=$S((LIMIT]""):+LIMIT,1:24) S CUTOFF=$$FMADD^XLFDT(STOP,,LIMIT) D
"RTN","PSGOER",125,0)
 .I '($G(P(4))]"") N P,YP,XP S YP=$G(^PS(55,DFN,"IV",+PSJY,0)) F XP=1:1:23 S P(XP)=$P(YP,U,XP)
"RTN","PSGOER",126,0)
 .Q:'($G(P(4))]"")
"RTN","PSGOER",127,0)
 .Q:'$$SCHREQ^PSJLIVFD(.P)
"RTN","PSGOER",128,0)
 .N INTERVAL,LSTSTR,ND0,SCHED,IVSTYP S ND0=$G(^PS(55,PSJX,"IV",+PSJY,0)),INTERVAL=$P(ND0,"^",15),SCHED=$P(ND0,"^",9) Q:SCHED=""
"RTN","PSGOER",129,0)
 .S IVSTYP=$S($$DOW^PSIVUTL(SCHED):"D",INTERVAL="O":"O",1:"C"),LSTSTR=$P(ND0,"^",2)_"^"_$P(ND0,"^",3)_"^"_SCHED_"^"_IVSTYP_"^^"_$P(ND0,"^",11)
"RTN","PSGOER",130,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,IVSTYP="O",LAST>$P(ND0,"^",2),($P(LAST,"^",3)="G") S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",131,0)
 .I 'LAST!(LAST>$P(ND0,"^",3))!(LAST&(IVSTYP="O")) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",132,0)
 .I IVSTYP="D" S CUTOFF=$$NXTDOW(LAST,SCHED,$G(P(2)),$P($G(P(9)),"@"),$G(P(11))) Q
"RTN","PSGOER",133,0)
 .I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED) S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",134,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND0,"^",3)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",135,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,31) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",136,0)
 K LYN,PSBDT,PSBFLAG,PSBSTR
"RTN","PSGOER",137,0)
 Q $S(CUTOFF<NOW:1,1:0)
"RTN","PSGOER",138,0)
 ;
"RTN","PSGOER",139,0)
NXTDOW(DOWDFN,DOWSD,DOWFD,DOWSCH,DOWAT) ;
"RTN","PSGOER",140,0)
 N NXTADM,DOWSTR S DOWSTR=$$FMADD^XLFDT(DOWFD,,,,1)_"^"_$$FMADD^XLFDT(DOWFD,7)_"^"_DOWSCH_"^D^^"_DOWAT S NXTADM=$$ENQ^PSJORP2(DOWDFN,DOWSTR)
"RTN","PSGOER",141,0)
 Q $S(NXTADM:NXTADM,1:DOWSD)
"RTN","PSGOER",142,0)
 ;
"RTN","PSGOER",143,0)
PRNFREQ(SCHED) ;
"RTN","PSGOER",144,0)
 N ZZND,D,DA,X,PSGAT,PSGOES,PSGST,PSJNSS,PSJPWD,TEST,VALMBCK,PSGS0XT,PSGS0Y,PSGDT
"RTN","PSGOER",145,0)
 F X=$P(SCHED,"PRN"),$P(SCHED,"PRN",2),$P(SCHED," PRN"),$P(SCHED,"PRN ",2) Q:$P($G(ZZND),"^",4)  D ADMIN^PSJORPOE
"RTN","PSGOER",146,0)
 Q $S($G(PSGS0XT):PSGS0XT,1:1440)
"RTN","PSGOES")
0^114^B19404808
"RTN","PSGOES",1,0)
PSGOES ;BIR/CML3-CREATE ORDERS USING ORDER SET ;19 Feb 99 / 12:53 PM
"RTN","PSGOES",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**12,22,30,34,50,58,111**;16 DEC 97
"RTN","PSGOES",3,0)
 ;
"RTN","PSGOES",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSGOES",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOES",6,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSGOES",7,0)
 ;
"RTN","PSGOES",8,0)
 K DIC,PSGOEOS S X=$P(X,"S.",2),DIC="^PS(53.2,",DIC(0)="QEM" D ^DIC K DIC G:Y'>0 DONE W "  (ORDER SET)" S PSGOESDA=+Y,PSGOES=1
"RTN","PSGOES",9,0)
 I '$D(^PS(53.2,+Y,2)) W "    Invalid Order Set" Q
"RTN","PSGOES",10,0)
 I $P(PSJSYSU,";",2) S PSGOESPR=DUZ
"RTN","PSGOES",11,0)
 E  D  G:Y'>0 DONE
"RTN","PSGOES",12,0)
 .S DIC="^VA(200,",DIC(0)="QEAM",DIC("A")="Select PROVIDER: ",X=$P($G(^PS(55,PSGP,5.1)),"^",2) I X S X=$P($G(^VA(200,X,0)),"^") I X]"" S Y=^("PS") I Y,$S('$P(Y,"^",4):1,1:$P(Y,"^",4)>DT) S DIC("B")=X
"RTN","PSGOES",13,0)
 .S DIC("S")="S X(1)=$G(^(""PS"")) I X(1),$S('$P(X(1),""^"",4):1,1:$P(X(1),""^"",4)>DT)" W ! D ^DIC K DIC I Y'>0 W $C(7),!!,"Provider is required for order sets." Q
"RTN","PSGOES",14,0)
 .S PSGOESPR=+Y S:$P($G(^PS(55,PSGP,5.1)),"^",2)'=+Y $P(^(5.1),"^",2)=+Y
"RTN","PSGOES",15,0)
 S PSJNOO=$$ENNOO^PSJUTL5("N")
"RTN","PSGOES",16,0)
 I $G(PSJNOO)<0 W !,$C(7),"...order set not entered..." G DONE
"RTN","PSGOES",17,0)
 F PSGOESN=0:0 S PSGOESN=$O(^PS(53.2,PSGOESDA,2,PSGOESN)) Q:'PSGOESN  I $D(^(PSGOESN,0)) S OSND=^(0) I $S($P(OSND,"^",3)="":0,$P(OSND,"^",4)="":0,$P(OSND,"^",4)="OC":1,1:$P(OSND,"^",5)]"") S PSGSI=$P($G(^(1)),"^") D GND Q:PSGQUIT
"RTN","PSGOES",18,0)
 ;
"RTN","PSGOES",19,0)
DONE ;
"RTN","PSGOES",20,0)
 K PSJNOON,PSJNOO
"RTN","PSGOES",21,0)
 S X="S.X" K %DT,N,OSND,PSGOESDA,PSGDDRG,PSGOESI,PSGOES,PSGOEOS,PSGOESN,PSGOESPR,PSGQUIT,PSGX,SDT,STDAY,X1,X2 Q
"RTN","PSGOES",22,0)
 ;
"RTN","PSGOES",23,0)
GND ;
"RTN","PSGOES",24,0)
 K PSGOEE,PSGSCH
"RTN","PSGOES",25,0)
 S (PSGPDRG,PSGX)=+OSND,PSGPDRGN=$P($G(^PS(50.7,PSGPDRG,0)),"^") S:PSGPDRGN="" PSGPDRGN=PSGPDRG W !!,"...entering ",$S(PSGPDRGN'=PSGPDRG:PSGPDRGN,1:"** UNKNOWN **"),"..." K Y,DIRUT D END^PSGSICHK S PSGQUIT=$D(DIRUT) Q:$G(Y)<0
"RTN","PSGOES",26,0)
 S PSGNEDFD=$P(OSND,"^",2,5),PSGMR=$P(OSND,"^",3),PSGST=$P(OSND,"^",4),PSGDO=$P(OSND,"^",9),PSGMRN=$$ENMRN^PSGMI(PSGMR)
"RTN","PSGOES",27,0)
 S:PSGMRN="" PSGMRN=PSGMR D NOW^%DTC S PSGDT=+$E(%,1,12) I PSGST="OC" S PSGSCH="ON CALL",(PSGS0XT,PSGS0Y)=""
"RTN","PSGOES",28,0)
 E  S X=$P(OSND,"^",5) W "." S:X X="`"_X D ENOS^PSGS0 S:$D(X) PSGSCH=X I '$D(X) S (PSGSCH,PSGS0XT,PSGS0Y)=""
"RTN","PSGOES",29,0)
 S (PSGNESD,PSGNEFD)="" W "." I $P(OSND,"^",11)]"" S %DT="T",X=$P(OSND,"^",11) D ^%DT S PSGNESD=Y D ENFD^PSGNE3(PSGDT)
"RTN","PSGOES",30,0)
 D:$P(OSND,"^",11)="" ^PSGNE3 K PSGDRG,PSGORQF,^PS(53.45,PSJSYSP,1),^(2) S (N,Q)=0
"RTN","PSGOES",31,0)
 F  S Q=$O(^PS(53.2,PSGOESDA,2,PSGOESN,2,Q)) Q:'Q!$D(PSGORQF)  S PSGDRG=$G(^(Q,0)) I PSGDRG D
"RTN","PSGOES",32,0)
 .D ENDDC^PSGSICHK(PSGP,+PSGDRG) Q:$D(PSGORQF)
"RTN","PSGOES",33,0)
 .S:$P(PSGDRG,U,2)="" $P(PSGDRG,U,2)=1
"RTN","PSGOES",34,0)
 .S N=N+1,^PS(53.45,PSJSYSP,2,N,0)=PSGDRG,^PS(53.45,PSJSYSP,2,"B",+PSGDRG,N)="" W "."
"RTN","PSGOES",35,0)
 .I $P(^PSDRUG(+PSGDRG,2),U,3)'["U"!($S('+$G(^PSDRUG(+PSGDRG,"I")):0,^("I")'>DT:1,1:0)) S PSGOEAV="0^1" W:PSJSYSU $C(7),!?5,"...AS NON-VERIFIED - DATA INCOMPLETE..."
"RTN","PSGOES",36,0)
 I N S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^"_N_"^"_N
"RTN","PSGOES",37,0)
 I $D(PSGORQF) W !,?5,"...ORDER FOR ",PSGPDRGN," NOT ENTERED...",! Q
"RTN","PSGOES",38,0)
 ;I PSGOEAV,$S($D(PSGOEOS):1,'PSGPDRG:1,PSGPDRG=PSGPDRGN:1,'PSGMR:1,PSGMR=PSGMRN:1,PSGSCH="":1,PSGST="":1,'PSGNESD:1,'PSGNEFD:1,+PSJSYSU=3:'N,1:0) S PSGOEAV="0^1" W:('$D(PSGOEOS)&PSJSYSU) $C(7),!?5,"...AS NON-VERIFIED - DATA INCOMPLETE..."
"RTN","PSGOES",39,0)
 I PSGOEAV,$S('PSGPDRG:1,PSGPDRG=PSGPDRGN:1,'PSGMR:1,PSGMR=PSGMRN:1,PSGSCH="":1,PSGST="":1,'PSGNESD:1,'PSGNEFD:1,+PSJSYSU=3:'N,1:0) S PSGOEAV="0^1" W:('$D(PSGOES)&PSJSYSU) $C(7),!?5,"...AS NON-VERIFIED - DATA INCOMPLETE..."
"RTN","PSGOES",40,0)
 S (PSGHSM,PSGSM)="",PSGPR=PSGOESPR D ^PSGOETO S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSGOES",41,0)
 ; pharmacist label check, build label for order set only if auto verify turned on
"RTN","PSGOES",42,0)
 I PSJSYSL>0,(PSGOEAV),($P($G(^PS(55,PSGP,5,$S($D(DA):DA,1:+PSGORD),0)),U,9)="A") D
"RTN","PSGOES",43,0)
 .S $P(^PS(55,PSGP,5,$S($D(DA):DA,1:+PSGORD),7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N" S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOES",44,0)
 ; ward clerk label check 
"RTN","PSGOES",45,0)
 I PSJSYSL>0,$P(PSJSYSU,";",3)<3,"12"[$P(PSJSYSW0,"^",12),'(PSGOEAV) D
"RTN","PSGOES",46,0)
 .I PSGORD["P" S $P(^PS(53.1,$S($D(DA):DA,1:+PSGORD),7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"
"RTN","PSGOES",47,0)
 .I PSGORD'["P" S $P(^PS(55,PSGP,5,$S($D(DA):DA,1:+PSGORD),7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"
"RTN","PSGOES",48,0)
 .S PSGTOL=2,PSGUOW=DUZ,PSGTOO=2,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOES",49,0)
 Q
"RTN","PSGOETO")
0^96^B29781842
"RTN","PSGOETO",1,0)
PSGOETO ;BIR/CML3-TRANSCRIBE ORDERS ;25 Feb 99 / 1:17 PM
"RTN","PSGOETO",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,13,25,31,33,50,68,58,85,105,90,117,110,111**;16 DEC 97
"RTN","PSGOETO",3,0)
 ;
"RTN","PSGOETO",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSGOETO",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOETO",6,0)
 ; Reference to ^PS(59.7 is supported by DBIA #2181.
"RTN","PSGOETO",7,0)
 ;
"RTN","PSGOETO",8,0)
 W:'$D(PSGOEE)&'$D(PSGOES) !!,"...transcribing this ",$S($D(PSGOES):"",'PSGOEAV:"non-verified ",1:"active "),"order..." S PSGOETOF=1 S:PSGSM="" PSGSM=0
"RTN","PSGOETO",9,0)
 ;I '$D(PSJOERR),PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSGOETO",10,0)
 I PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSGOETO",11,0)
 K ND4,DA D ENGNN:'PSGOEAV,ENGNA:PSGOEAV S PSGDT=$$DATE^PSJUTL2() I $S($D(ORACTION):0,$G(PSGOEE)="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:$G(PSGOEE)'="E") D ENWALL^PSGNE3(PSGNESD,PSGNEFD,PSGP)
"RTN","PSGOETO",12,0)
 I $D(^PS(51.2,+PSGMR,0)),$P(^(0),U,3)]"" S PSGMRN=$P(^(0),U,3)
"RTN","PSGOETO",13,0)
 ;I PSGS0XT="D",'PSGS0Y S PSGS0Y=$E(PSGNESD_"00011",9,12)
"RTN","PSGOETO",14,0)
 ;S ND=DA_U_PSGPR_U_PSGMR_U_$E("UI",$D(PSGOEOS)+1)_U_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",$D(PSGOEOS):PSGOEOS,1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSGOETO",15,0)
 S ND=DA_U_PSGPR_U_PSGMR_"^U^"_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSGOETO",16,0)
 S:$D(PSGOEE) $P(ND,U,24,25)=PSGOEE_U_PSGOORD S:'PSGOEAV $P(ND,U,18)=DA S ND2=PSGSCH_U_$S(+PSGNESD=PSGNESD:+PSGNESD,1:"")_"^^"_+PSGNEFD_U_PSGS0Y_U_PSGS0XT_"^^^^"_+PSJPWD
"RTN","PSGOETO",17,0)
 I PSGOEAV S F=^PS(55,PSGP,0) I $P(F,"^",7)="" S $P(F,"^",7)=$P($P(ND,"^",16),"."),$P(F,"^",8)="A",^(0)=F
"RTN","PSGOETO",18,0)
 S $P(ND4,U,7)=DUZ I PSGOEAV,PSJSYSU D
"RTN","PSGOETO",19,0)
 .S $P(ND4,U,PSJSYSU,PSJSYSU+1)=DUZ_U_PSGDT,$P(ND4,U,+PSJSYSU=1+9)=1,$P(ND4,U,+PSJSYSU=3+9)=0
"RTN","PSGOETO",20,0)
 .S $P(ND4,U,9,10)=+$P(ND4,U,9)_U_+$P(ND4,U,10)
"RTN","PSGOETO",21,0)
 .I '$P(ND4,U,9) S ^PS(55,"APV",PSGP,DA)=""
"RTN","PSGOETO",22,0)
 .I '$P(ND4,U,10) S ^PS(55,"NPV",PSGP,DA)=""
"RTN","PSGOETO",23,0)
 .I $P(ND4,U,9) K ^PS(55,"APV",PSGP,DA)
"RTN","PSGOETO",24,0)
 .I $P(ND4,U,10) K ^PS(55,"NPV",PSGP,DA)
"RTN","PSGOETO",25,0)
 ;S F="^PS("_$S(PSGOEAV:"55,"_PSGP_",5",1:53.1)_","_DA_",",@(F_"0)")=ND,^(.2)=PSGPDRG_U_PSGDO,$P(^(.2),U,5,6)=$P($G(PSJDOSE("DO")),U,1,2),^(2)=$S(PSGOEAV:ND2,1:$P(ND2,"^",1,6)),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSGOETO",26,0)
 S F="^PS("_$S(PSGOEAV:"55,"_PSGP_",5",1:53.1)_","_DA_",",@(F_"0)")=ND
"RTN","PSGOETO",27,0)
 ;naked reference below refers to full reference inside indirection @(F_".2)") for either file 53.1 or 55
"RTN","PSGOETO",28,0)
 S @(F_".2)")=PSGPDRG_U_PSGDO_U_PSJNOO S:$G(PSJDOSE("DO"))]"" $P(^(.2),U,5,6)=$P(PSJDOSE("DO"),U,1,2)
"RTN","PSGOETO",29,0)
 I '$D(PSJDOSE("DO")),$D(PSGORD),PSGPDRG=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U) S $P(@(F_".2)"),U,5,6)=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U,5,6)
"RTN","PSGOETO",30,0)
 ;naked reference below refers to full reference inside indirection @(F_"2)") for either file 53.1 or 55
"RTN","PSGOETO",31,0)
 S @(F_"2)")=$S(PSGOEAV:ND2,1:$P(ND2,"^",1,6)),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSGOETO",32,0)
 S (C,X)=0 F  S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  S D=$G(^(X,0)) I D,$S('$P(D,U,3):1,1:$P(D,U,3)>DT) S C=C+1,@(F_"1,"_C_",0)")=$P(D,U,1,2),@(F_"1,""B"","_+D_","_C_")")=""
"RTN","PSGOETO",33,0)
 S:C @(F_"1,0)")=U_$S(PSGOEAV:55.07,1:53.11)_"P^"_C_U_C
"RTN","PSGOETO",34,0)
 S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"3,"_C_",0)")=X
"RTN","PSGOETO",35,0)
 S:C @(F_"3,0)")=U_$S(PSGOEAV:55.08,1:53.12)_U_C_U_C
"RTN","PSGOETO",36,0)
 ;S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,4,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"12,"_C_",0)")=X
"RTN","PSGOETO",37,0)
 ;S:C @(F_"12,0)")=U_$S(PSGOEAV:55.0612,1:53.1012)_U_C_U_C
"RTN","PSGOETO",38,0)
 I $P(ND,U,24)="R" S %X="^PS(55,"_PSGP_",5,"_+PSGORD_",12,",%Y=F_"12," D %XY^%RCR
"RTN","PSGOETO",39,0)
 W "." D CRN:'PSGOEAV,CRA:PSGOEAV
"RTN","PSGOETO",40,0)
 ; don't send message to CPRS if from Order Set and autoverify turned off
"RTN","PSGOETO",41,0)
 S PSGORD=DA_$S(PSGOEAV:"U",1:"P") D:('$D(PSGOES))!(($D(PSGOES)&(PSGOEAV))) ORSET^PSGOETO1
"RTN","PSGOETO",42,0)
 I $D(PSGOES),'$D(PSGOESON) N PSGOESON S PSGOESON=PSGORD D DISACTIO^PSJOE(DFN,PSGORD,0) D:PSGORD["U"&(PSGOESON=PSGORD)&($P(@(PSGOEEWF_"0)"),"^",9)'="D") EN^PSGPEN(PSGORD) G OUT
"RTN","PSGOETO",43,0)
 ;D DONE S PSGCANFL="" I '$D(PSGOEE),$P(PSJSYSP0,U,12)<2 S PSJLM=1,PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),EN^VALM("PSJ LM ACCEPT") I PSGCANFL=1 G OUT
"RTN","PSGOETO",44,0)
 D DONE S PSGCANFL="" I '$D(PSGOEE) S PSJLM=1,PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),EN^VALM("PSJ LM ACCEPT") I PSGCANFL=1 G OUT
"RTN","PSGOETO",45,0)
 I $D(PSJSYSO) S PSGPOSA="W",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOETO",46,0)
 S DA=+PSGORD,X=$P(PSGORD,DA,2) I PSJSYSL,$S(PSGOEAV:1,1:PSJSYSL<3),$S("AOU"[X:'$D(^PS(55,PSGP,5,+PSGORD,7)),1:'$D(^PS(53.1,+PSGORD,7))) D
"RTN","PSGOETO",47,0)
 .; naked ref below is from line above, ^PS(53.1,+PSGORD,7)
"RTN","PSGOETO",48,0)
 .S $P(^(7),U,1,2)=PSGDT_"^N"_$G(PSGOEE),PSGUOW=DUZ,PSGTOL=2,PSGTOO=$S("AOU"[X:1,1:2) D ENL^PSGVDS
"RTN","PSGOETO",49,0)
OUT ;
"RTN","PSGOETO",50,0)
 K PSGOETOF
"RTN","PSGOETO",51,0)
DONE ;
"RTN","PSGOETO",52,0)
 I PSGOEAV L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSGOETO",53,0)
 I 'PSGOEAV L -^PS(53.1,+PSGORD)
"RTN","PSGOETO",54,0)
 K C,D,ND,ND2,ND4,PSGDO,PSGDRG,PSGDRGN,PSGFOK,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGPDRG,PSGPDRGN,PSGSI,PSGSTN,PSJDOSE
"RTN","PSGOETO",55,0)
 Q
"RTN","PSGOETO",56,0)
CRA ;
"RTN","PSGOETO",57,0)
 S:PSGPDRG ^PS(55,PSGP,5,"C",PSGPDRG,DA)="" S (^PS(55,"AUE",PSGP,DA),^PS(55,PSGP,5,"AU",PSGST,+PSGNEFD,DA),^PS(55,PSGP,5,"AUS",+PSGNEFD,DA))="",^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)="",^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOETO",58,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+PSGNESD,X(2)=+PSGNEFD,DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOETO",59,0)
 S DA(1)=PSGP K DIK S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOETO",60,0)
 K PSGALO,PSGALR S DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+$S('$D(PSGOEE):22500,PSGOEE="E":22600,1:22700) D ^PSGAL5 Q
"RTN","PSGOETO",61,0)
CRN ;
"RTN","PSGOETO",62,0)
 S (^PS(53.1,"AC",PSGP,DA),^PS(53.1,"AS","N",PSGP,DA),^PS(53.1,"B",DA,DA),^PS(53.1,"C",PSGP,DA))="" S:PSGPDRG (^PS(53.1,"AOD",PSGP,PSGPDRG,DA),^PS(53.1,"D",PSGPDRG,DA))="" Q
"RTN","PSGOETO",63,0)
ENGNA ;
"RTN","PSGOETO",64,0)
 F  L +^PS(55,PSGP,5,0):1 S:'$D(^PS(55,PSGP,0)) ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="" S ND=$S($D(^PS(55,PSGP,5,0)):^(0),1:"^55.06IA") Q
"RTN","PSGOETO",65,0)
 F DA=$P(ND,U,3)+1:1 W "." I '$D(^PS(55,PSGP,5,DA)),'$D(^PS(55,PSGP,5,"B",DA)) L +^PS(55,PSGP,5,DA):1 I  S ^PS(55,PSGP,5,DA,0)=DA,^PS(55,PSGP,5,"B",DA,DA)="",$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^PS(55,PSGP,5,0)=ND Q
"RTN","PSGOETO",66,0)
 L -^PS(55,PSGP,5,0) Q
"RTN","PSGOETO",67,0)
ENGNN ;
"RTN","PSGOETO",68,0)
 N ND F  L +^PS(59.7,1,25):1 I  S DA=+$G(^PS(59.7,1,25)) Q
"RTN","PSGOETO",69,0)
 F DA=DA+1:1 I '$D(^PS(53.1,DA)),'$D(^PS(53.1,"B",DA)) L +^PS(53.1,DA):1 I  S ^PS(59.7,1,25)=DA,^PS(53.1,DA,0)=DA,^PS(53.1,"B",DA,DA)="" Q
"RTN","PSGOETO",70,0)
 F  L +^PS(53.1,0):1 I  S ND=$G(^PS(53.1,0)),$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^(0)=ND Q
"RTN","PSGOETO",71,0)
 L -^PS(59.7,1,25),-^PS(53.1,0)
"RTN","PSGOETO",72,0)
 Q
"RTN","PSGOEV")
0^88^B63648518
"RTN","PSGOEV",1,0)
PSGOEV ;BIR/CML3-VERIFY (MAKE ACTIVE) ORDERS ;4/8/99  08:16
"RTN","PSGOEV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**5,7,15,28,33,50,64,58,77,78,80,110,111**;16 DEC 97
"RTN","PSGOEV",3,0)
 ;
"RTN","PSGOEV",4,0)
 ; Reference to ^ORD(101 supported by DBIA #872.
"RTN","PSGOEV",5,0)
 ; Reference to ^PS(50.7 supported by DBIA #2180.
"RTN","PSGOEV",6,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGOEV",7,0)
 ; Reference to ^PSSLOCK supported by DBIA #2789.
"RTN","PSGOEV",8,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA #2410.
"RTN","PSGOEV",9,0)
 ;
"RTN","PSGOEV",10,0)
EN(PSGORD) ;
"RTN","PSGOEV",11,0)
ENSF ; This entry point is used by Speed finish only.
"RTN","PSGOEV",12,0)
 ; Send SN update to CPRS if autoverify off and from Order Set entry
"RTN","PSGOEV",13,0)
 S:'$D(PSGOEAV) PSGOEAV=$P($G(PSJSYSP0),"^",9)&$G(PSJSYSU)
"RTN","PSGOEV",14,0)
 I $D(PSGOES),'PSGOEAV,PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSGOEV",15,0)
 D FULL^VALM1 I 'PSJSYSU W $C(7),$C(7),!!," THIS FUNCTION NOT AVAILABLE TO WARD STAFF." Q
"RTN","PSGOEV",16,0)
 S CHK=0 I PSGORD["P" S X=$P($G(^PS(53.1,+PSGORD,0)),"^",19) I X,$D(^PS(55,PSGP,5,$P(^(0),"^",19))) S CHK=+PSGORD,PSGORD=X_"U" L -^PS(53.1,CHK) L +^PS(55,PSGP,5,+PSGORD):1 E  W !!,"Another terminal is editing this order." G DONE
"RTN","PSGOEV",17,0)
 I +PSJSYSU=3 D DDCHK G:CHK DONE
"RTN","PSGOEV",18,0)
 I PSGORD["P" D CHK($G(^PS(53.1,+PSGORD,0)),$G(^(.2)),$G(^(2)))
"RTN","PSGOEV",19,0)
 I $G(PSGSCH)]"" D
"RTN","PSGOEV",20,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=1 S X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",21,0)
 I $G(CHK) Q:$D(PSJSPEED)  D EN^VALM("PSJU LM ACCEPT") G:'$G(PSJACEPT) DONE ;G VFY
"RTN","PSGOEV",22,0)
 G:'$D(^PS(55,PSGP,5,+PSGORD,4)) VFY I +PSJSYSU=3,$P(^(4),"^",3) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A PHARMACIST." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",23,0)
 I +PSJSYSU=1,+^PS(55,PSGP,5,+PSGORD,4) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A NURSE." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",24,0)
 ;
"RTN","PSGOEV",25,0)
VFY ; change status, move to 55, and change label record
"RTN","PSGOEV",26,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D VFY^PSJCOM Q
"RTN","PSGOEV",27,0)
 NEW PSJDOSE,PSJDSFLG
"RTN","PSGOEV",28,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEV",29,0)
 I +$G(PSJDSFLG) D SETVAR^PSJDOSE W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1") I '$$CONT() W !,"...order was not verified..." D PAUSE^VALM1 D  Q:'$G(PSJACEPT)
"RTN","PSGOEV",30,0)
 . S PSGOEEF(109)=1
"RTN","PSGOEV",31,0)
 . S PSJACEPT=0
"RTN","PSGOEV",32,0)
 . ;D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEV",33,0)
 D DDCHK G:CHK DONE
"RTN","PSGOEV",34,0)
 I $G(PSGSCH)]"",((",P,R,")'[(","_PSGST_",")) D  I CHK G DONE
"RTN","PSGOEV",35,0)
 .N SWD,SDW,XABB,X,QX S X=$G(PSGSCH) D DW^PSGS0 Q:($G(X)="")  I $G(PSGS0XT)="" S PSGS0XT="D"
"RTN","PSGOEV",36,0)
 .I $G(PSGS0XT)="D",$G(PSGAT)="" S CHK=1 W !!,"This is a 'DAY OF WEEK' schedule and MUST have admin times.",! D PAUSE^VALM1
"RTN","PSGOEV",37,0)
 I $G(PSGSCH)]"" D  I CHK G DONE
"RTN","PSGOEV",38,0)
 .N X,Y,PSGS0XT,PSGS0Y,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",39,0)
 W !,"...a few moments, please..."
"RTN","PSGOEV",40,0)
 I PSGORD["P" D
"RTN","PSGOEV",41,0)
 . N PND0,PSGORDR,PSJPRIO,PSJSCHED S PND0=^PS(53.1,+PSGORD,0) I $P(PND0,U,24)="R" S PSGORDR=$P(PND0,U,25) D  Q
"RTN","PSGOEV",42,0)
 .. Q:'$$LS^PSSLOCK(PSGP,PSGORDR)
"RTN","PSGOEV",43,0)
 .. N OEORD,OOEORD,FILE55,FILE55N0 S FILE55="^PS(55,"_DFN_$S($P(PND0,U,4)="U":",5,",1:",""IV"","),FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSGOEV",44,0)
 .. S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,PSGORD,+$$LASTREN^PSJLMPRI(DFN,PSGORD))
"RTN","PSGOEV",45,0)
 .. S PSGORDP=PSGORD,DIE="^PS(53.1,",DA=+PSGORD,DR="28////A;104////@" W "." D ^DIE
"RTN","PSGOEV",46,0)
 .. D START^PSGOTR(PSGORD,+PSGORDR) I OEORD D
"RTN","PSGOEV",47,0)
 ... K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=$S(DIE["IV":110,1:66)_"////"_+OEORD D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSGOEV",48,0)
 ... D EN1^PSJHL2(DFN,"SC",PSGORDR),EN^PSGPEN(PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSGOEV",49,0)
 . S PSGORDP=PSGORD ;Used in ACTLOG to update activity log in 55
"RTN","PSGOEV",50,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEV",51,0)
 . S DIE="^PS(53.1,",DA=+PSGORD,DR="28////A" W "." D ^DIE,^PSGOT
"RTN","PSGOEV",52,0)
 . S PSJPRIO=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,.2)),"^",4),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,.2)),"^",4),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,.2)),"^",4))
"RTN","PSGOEV",53,0)
 . S PSJSCHED=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,2)),"^"),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,2)),"^"),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,0)),"^",15))
"RTN","PSGOEV",54,0)
 . I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCHED)="NOW")!($G(PSJSCHED)["STAT") D NOTIFY^PSJHL4(PSGORD,DFN,$G(PSJPRIO),$G(PSJSCHED))
"RTN","PSGOEV",55,0)
 S DA=+PSGORD,DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+22000 D ^PSGAL5 W "." S VND4=$G(^PS(55,PSGP,5,DA,4))
"RTN","PSGOEV",56,0)
 I $G(PSGRDTX) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Start Date",+$G(PSGRDTX))
"RTN","PSGOEV",57,0)
 I $P($G(PSGRDTX),U,3) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Stop Date",+$P($G(PSGRDTX),U,3))
"RTN","PSGOEV",58,0)
 N DUR,DURON S DURON=$S($G(PSGORD):$G(PSGORD),1:"") I DURON D
"RTN","PSGOEV",59,0)
 . S DUR=$S($P($G(PSGRDTX),U,2)]"":$P($G(PSGRDTX),U,2),1:$$GETDUR^PSJLIVMD(PSGP,+DURON,$S($G(DURON)["P":"P",1:5),1),1:"")
"RTN","PSGOEV",60,0)
 I $G(DUR)]"" S $P(^PS(55,PSGP,5,+PSGORD,2.5),"^",2)=DUR
"RTN","PSGOEV",61,0)
 D:$D(PSGORDP) ACTLOG(PSGORDP,PSGP,PSGORD)
"RTN","PSGOEV",62,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSGOEV",63,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSGOEV",64,0)
 I +PSJSYSU=3,PSGORD'["O",$S(X:0,'$P(VND4,"^",9):1,1:$P(VND4,"^",15)) D EN^PSGPEN(+PSGORD)
"RTN","PSGOEV",65,0)
 S $P(VND4,"^",+PSJSYSU=1+9)=1 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSGOEV",66,0)
 ;S $P(VND4,"^",+PSJSYSU=1+9)=1,$P(VND4,U,+PSJSYSU=3+9)=0
"RTN","PSGOEV",67,0)
 I PSJSYSL>1 S $P(^PS(55,PSGP,5,+PSGORD,7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"_$S($P(^PS(55,PSGP,5,+PSGORD,0),"^",24)="E":"E",1:"") S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEV",68,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=VND4
"RTN","PSGOEV",69,0)
 I '$P(VND4,U,9) S ^PS(55,"APV",PSGP,+PSGORD)=""
"RTN","PSGOEV",70,0)
 I '$P(VND4,U,10) S ^PS(55,"ANV",PSGP,+PSGORD)=""
"RTN","PSGOEV",71,0)
 I $P(VND4,U,9) K ^PS(55,"APV",PSGP,+PSGORD)
"RTN","PSGOEV",72,0)
 I $P(VND4,U,10) K ^PS(55,"ANV",PSGP,+PSGORD)
"RTN","PSGOEV",73,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSGOEV",74,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOEV",75,0)
 S:+PSJSYSU=3 ^PS(55,"AUE",PSGP,+PSGORD)="" S PSGACT="C"_$S('$D(^PS(55,PSGP,5,+PSGORD,4)):"E",$P(^(4),"^",16):"",1:"E")_"RS",PSGCANFL=2
"RTN","PSGOEV",76,0)
 S VALMBCK="Q" D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",+PSJSYSU=1:"SC",1:"XX"),+PSGORD_"U")     ; allow status change to be sent for pharmacists & nurses
"RTN","PSGOEV",77,0)
 D:+PSJSYSU=1 EN1^PSJHL2(PSGP,"ZV",+PSGORD_"U")
"RTN","PSGOEV",78,0)
DONE ;
"RTN","PSGOEV",79,0)
 W:CHK !!,"...order NOT verified..."
"RTN","PSGOEV",80,0)
 I '$D(PSJSPEED),'CHK,+PSJSYSU=3,$G(PSJPRI)="D" D
"RTN","PSGOEV",81,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSGOEV",82,0)
 .Q:Y="N"
"RTN","PSGOEV",83,0)
 .D MAIN^TIUEDIT(3,.TIUDA,PSGP,"","","","",1)
"RTN","PSGOEV",84,0)
 S VALMBCK="Q" K CHK,DA,DIE,F,DP,DR,ND,PSGAL,PSGODA,PSJDOSE,PSJVAR,VND4,X Q
"RTN","PSGOEV",85,0)
 ;
"RTN","PSGOEV",86,0)
LBL ;
"RTN","PSGOEV",87,0)
 Q
"RTN","PSGOEV",88,0)
 ;
"RTN","PSGOEV",89,0)
CHK(ND,DRG,ND2) ; checks for data in required fields
"RTN","PSGOEV",90,0)
 ; Input: ND  - ^(PS(53.1,PSGORD,0)
"RTN","PSGOEV",91,0)
 ;        DRG - ^(.2)
"RTN","PSGOEV",92,0)
 ;        ND2 - ^(2)
"RTN","PSGOEV",93,0)
 S CHK="" I DRG,$D(^PS(50.7,+DRG,0))
"RTN","PSGOEV",94,0)
 E  S CHK=1
"RTN","PSGOEV",95,0)
 I ND="" S CHK=CHK_23
"RTN","PSGOEV",96,0)
 E  S CHK=CHK_$S($P(ND,"^",3):"",1:2)_$S($P(ND,"^",7)]"":"",1:3)
"RTN","PSGOEV",97,0)
 ;The naked reference on the line below refers to the variable ND which is ^PS(53.1,PSGORD,0).
"RTN","PSGOEV",98,0)
 I ND2="" S CHK=CHK_$S('$D(^(0)):4,$P(^(0),"^",7)="OC":"",1:4)_56
"RTN","PSGOEV",99,0)
 E  S CHK=CHK_$S($P(ND2,"^")]"":"",ND="":4,$P(ND,"^",7)="OC":"",1:4)_$S($P(ND2,"^",2):"",1:5)_$S($P(ND2,"^",4):"",1:6)
"RTN","PSGOEV",100,0)
 I $$CHECK^PSGOE8(PSJSYSP),$P(DRG,U,2)="" S CHK=CHK_8
"RTN","PSGOEV",101,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSGOEV",102,0)
 S:'$$DDOK^PSGOE2("^PS(53.45,"_PSJSYSP_",2,",+DRG) CHK=CHK_7,(PSGDFLG,PSGDI)=1
"RTN","PSGOEV",103,0)
 S:'$$OIOK^PSGOE2(+DRG) PSGPFLG=1
"RTN","PSGOEV",104,0)
 I 'CHK,$G(PSGSCH)]"" D
"RTN","PSGOEV",105,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",106,0)
 Q:'CHK
"RTN","PSGOEV",107,0)
 W $C(7)
"RTN","PSGOEV",108,0)
 ;
"RTN","PSGOEV",109,0)
CHKM ;
"RTN","PSGOEV",110,0)
 D FULL^VALM1
"RTN","PSGOEV",111,0)
 ; changed to remove ^DD ref
"RTN","PSGOEV",112,0)
 W !!,"THE FOLLOWING ",$S($L(CHK)>1:"ARE",1:"IS")," EITHER INVALID OR MISSING FROM THIS ORDER:" F X=1:1:7 W:CHK[X !?5,$P("ORDERABLE ITEM^MED ROUTE^SCHEDULE TYPE^SCHEDULE^START DATE/TIME^STOP DATE/TIME^DISPENSE DRUG","^",X)
"RTN","PSGOEV",113,0)
 I CHK=7 W !,"Orders with no dispense drugs or multiple dispense drugs",!,"require dosage ordered"
"RTN","PSGOEV",114,0)
 W:CHK]"" !!,$S($L(CHK)>1:"THESE FIELDS ARE",1:"THIS FIELD IS")," NECESSARY FOR VERIFICATION."
"RTN","PSGOEV",115,0)
 N DIR S DIR(0)="E" D ^DIR I $D(DUOUT)!$D(DTOUT) S CHK=1 Q
"RTN","PSGOEV",116,0)
 Q
"RTN","PSGOEV",117,0)
 ;
"RTN","PSGOEV",118,0)
CONT() ;
"RTN","PSGOEV",119,0)
 NEW DIR,DIRUT,Y
"RTN","PSGOEV",120,0)
 W ! K DIR,DIRUT
"RTN","PSGOEV",121,0)
 S DIR(0)="Y",DIR("A")="Would you like to continue verifying the order",DIR("B")="Yes"
"RTN","PSGOEV",122,0)
 D ^DIR
"RTN","PSGOEV",123,0)
 Q Y
"RTN","PSGOEV",124,0)
 ;
"RTN","PSGOEV",125,0)
DDCHK ; dispense drug check
"RTN","PSGOEV",126,0)
 S DRGF="^PS("_$S(PSGORD["P":"53.1,"_+PSGORD,1:"55,"_PSGP_",5,"_+PSGORD)_",",CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSGOEV",127,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSGOEV",128,0)
 S CHK=$S('$$DDOK^PSGOE2(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSGOEV",129,0)
 Q:CHK=0
"RTN","PSGOEV",130,0)
 W $C(7),!!,"This order must have at least one valid, active dispense drug to be verified."
"RTN","PSGOEV",131,0)
 ;
"RTN","PSGOEV",132,0)
DDEDIT ;
"RTN","PSGOEV",133,0)
 ;*** Remove all dispense drug for this order
"RTN","PSGOEV",134,0)
 K @(DRGF_"1)")
"RTN","PSGOEV",135,0)
 ; The naked reference below refers to the indirect full reference in DRGF_"1,"_Q_")", which is either ^PS(53.1,+PSGORD,Q) or ^PS(55,DFN,5,+PSGORD,Q)
"RTN","PSGOEV",136,0)
 K ^PS(53.45,PSJSYSP,2) S (X,Q)=0 F  S Q=$O(@(DRGF_"1,"_Q_")")) Q:'Q  S Y=$G(^(Q,0)),X=Q S ^PS(53.45,PSJSYSP,2,Q,0)=Y I Y S ^PS(53.45,PSJSYSP,2,"B",+Y,Q)=""
"RTN","PSGOEV",137,0)
 I X S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^"_X_"^"_X
"RTN","PSGOEV",138,0)
 D ENDRG^PSGOEF1(PSGPD,X)
"RTN","PSGOEV",139,0)
 I 'CHK S %X="^PS(53.45,"_PSJSYSP_",2,",%Y=DRGF_"1," D %XY^%RCR S $P(@(DRGF_"1,0)"),"^",2)=$S(DRGF[53.1:"53.11P",1:"55.07P")
"RTN","PSGOEV",140,0)
 K DRG,DRGF Q
"RTN","PSGOEV",141,0)
 ;
"RTN","PSGOEV",142,0)
AESCREEN() ;
"RTN","PSGOEV",143,0)
 ; Output: 0 - Required fields missing and DON'T allow accept
"RTN","PSGOEV",144,0)
 ;         1 - Required fields found.
"RTN","PSGOEV",145,0)
 Q:'$G(CHK) 1
"RTN","PSGOEV",146,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSGOEV",147,0)
 I Y="PSJU LM ACCEPT EDIT" Q 1
"RTN","PSGOEV",148,0)
 Q 0
"RTN","PSGOEV",149,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSGOEV",150,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSGOEV",151,0)
 ;PSGORD : IEN from 55
"RTN","PSGOEV",152,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSGOEV",153,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSGOEV",154,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSGOEV",155,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55,09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSGOEV",156,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSGOEV",157,0)
 Q
"RTN","PSGORS0")
0^110^B14142586
"RTN","PSGORS0",1,0)
PSGORS0 ;BIR/CML3-SCHEDULE PROCESSOR FOR FINISH ;29 Jan 99 / 8:07 AM
"RTN","PSGORS0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**25,50,83,116,111**;16 DEC 97
"RTN","PSGORS0",3,0)
 ;
"RTN","PSGORS0",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGORS0",5,0)
 ; Reference to ^PS(55   is supported by DBIA 2191
"RTN","PSGORS0",6,0)
 ;
"RTN","PSGORS0",7,0)
ENA ; entry point for train option
"RTN","PSGORS0",8,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGORS0",9,0)
 F  S (PSGS0Y,PSGS0XT)="" R !!,"Select STANDARD SCHEDULE: ",X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" ENQ^PSGSH I X'?1."?" D EN W:$D(X)[0 $C(7),"  ??" I $D(X)#2,'PSGS0Y,PSGS0XT ;W "  Every ",PSGS0XT," minutes"
"RTN","PSGORS0",10,0)
 K DIC,DIE,PSGS0XT,PSGS0Y,Q,X,Y,PSGDT Q
"RTN","PSGORS0",11,0)
 ;
"RTN","PSGORS0",12,0)
EN3 ;
"RTN","PSGORS0",13,0)
 S PSGST=$P($G(^PS(53.1,DA,0)),"^",7) G EN
"RTN","PSGORS0",14,0)
 ;
"RTN","PSGORS0",15,0)
EN5 ;
"RTN","PSGORS0",16,0)
 S PSGST=$P($G(^PS(55,DA(1),5,DA,0)),"^",7)
"RTN","PSGORS0",17,0)
 ;
"RTN","PSGORS0",18,0)
EN ; validate
"RTN","PSGORS0",19,0)
 ;/I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>2)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N") K X Q
"RTN","PSGORS0",20,0)
 I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>3)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N") K X Q
"RTN","PSGORS0",21,0)
 I X?.E1L.E S X=$$ENLU^PSGMI(X) ; I '$D(PSGOES) W "  (",X,")"
"RTN","PSGORS0",22,0)
 I X["Q0" K X Q
"RTN","PSGORS0",23,0)
 ;
"RTN","PSGORS0",24,0)
ENOS ; order set entry
"RTN","PSGORS0",25,0)
 D ENOS^PSGS0 Q
"RTN","PSGORS0",26,0)
 ;
"RTN","PSGORS0",27,0)
 S (PSGS0XT,PSGS0Y,XT,Y)="" I X["PRN"!(X="ON CALL")!(X="ONCALL")!(X="ON-CALL") G Q
"RTN","PSGORS0",28,0)
 S X0=X I X,X'["X",(X?2.4N1"-".E!(X?2.4N)) D ENCHK S:$D(X) Y=X G Q
"RTN","PSGORS0",29,0)
 I X["@" D DW S:$D(X) Y=$P(X,"@",2) G Q
"RTN","PSGORS0",30,0)
 I $S($D(^PS(51.1,"AC","PSJ",X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC I XT]"" G Q
"RTN","PSGORS0",31,0)
 I Y'>0,$S(X="NOW":1,X="ONCE":1,X="STAT":1,X="ONE TIME":1,X="ONETIME":1,X="1TIME":1,X="1 TIME":1,X="1-TIME":1,1:X="ONE-TIME") W:'$D(PSGOES) "  (ONCE ONLY)" S Y="",XT="O" G Q
"RTN","PSGORS0",32,0)
 ;CHANGED LINE BELOW TO FIX THE NON-STANDARD SCHEDULES - RSB 2-10-97
"RTN","PSGORS0",33,0)
 ;THE FREQUENCY VARIABLE "PSGS0XT" WAS NOT GETTING SET
"RTN","PSGORS0",34,0)
 ;I $G(PSGSCH)=X S PSGS0Y=$G(PSGAT) Q
"RTN","PSGORS0",35,0)
 S PSGS0Y=$G(PSGAT)
"RTN","PSGORS0",36,0)
 ;
"RTN","PSGORS0",37,0)
NS ;I Y'>0 W:'$D(PSGOES) "  (Nonstandard schedule)" S X=X0,Y=""
"RTN","PSGORS0",38,0)
 ;I Y'>0 S X=X0,Y="",PSJNSS=1
"RTN","PSGORS0",39,0)
 ;I $E(X,1,2)="AD" K X G Q
"RTN","PSGORS0",40,0)
 ;I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S XT=1440/$F("BTQ",$E(X)) G Q
"RTN","PSGORS0",41,0)
 S:$E(X)="Q" X=$E(X,2,99) S:'X X="1"_X S X1=+X,X=$P(X,+X,2),X2=0 S:X1<0 X1=-X1 S:$E(X)="X" X2=1,X=$E(X,2,99)
"RTN","PSGORS0",42,0)
 ;S XT=$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:-1) I XT<0,Y'>0 K X G Q
"RTN","PSGORS0",43,0)
 S X=X0 I XT S:X2 XT=XT\X1 I 'X2 S:X["QO" XT=XT*2 S XT=XT*X1
"RTN","PSGORS0",44,0)
 ;
"RTN","PSGORS0",45,0)
Q ;
"RTN","PSGORS0",46,0)
 S PSGS0XT=$S(XT]"":XT,1:""),PSGS0Y=$S(Y:Y,1:"")
"RTN","PSGORS0",47,0)
 I $G(PSJNSS),$G(PSGS0XT)>0,($G(VALMBCK)'="Q") D
"RTN","PSGORS0",48,0)
 . I $G(PSGOES),$G(PSGS0XT)>0,($G(VALMBCK)'="Q"),'$G(NSFF) D NSSCONT^PSGS0(X,PSGS0XT) Q
"RTN","PSGORS0",49,0)
 K QX,SDW,SWD,X0,XT,Z,NSFF Q
"RTN","PSGORS0",50,0)
 ;
"RTN","PSGORS0",51,0)
ENCHK ;
"RTN","PSGORS0",52,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q
"RTN","PSGORS0",53,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q
"RTN","PSGORS0",54,0)
 S X(1)=$L(X(1)) I X'["-",X>$E(2400,1,X(1)) K X Q
"RTN","PSGORS0",55,0)
 F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$E(2400,1,X(1)):1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSGORS0",56,0)
 K:$D(X) X(1),X(2),X(3) Q
"RTN","PSGORS0",57,0)
 ;
"RTN","PSGORS0",58,0)
DIC ;
"RTN","PSGORS0",59,0)
 S Y="" F TEST=0:0 S TEST=$O(^PS(51.1,"APPSJ",X,TEST)) Q:'TEST!(Y]"")  D
"RTN","PSGORS0",60,0)
 .I $G(PSGST)="O",$P($G(^PS(51.1,TEST,0)),U,5)'="O" Q
"RTN","PSGORS0",61,0)
 .S:$D(^PS(51.1,TEST,0)) Y=TEST
"RTN","PSGORS0",62,0)
 Q:Y=""  K DIC S X="`"_Y,DIC="^PS(51.1,",DIC(0)="XISZ",D="APPSJ"
"RTN","PSGORS0",63,0)
 D IX^DIC K DIC S:$D(DIE)#2 DIC=DIE Q:Y'>0
"RTN","PSGORS0",64,0)
 S XT=$S("C"[$P(Y(0),"^",5):$P(Y(0),"^",3),1:$P(Y(0),"^",5)),X=+Y,Y="" I $D(PSJPWD),$D(^PS(51.1,X,1,+PSJPWD,0)) S Y=$P(^(0),"^",2)
"RTN","PSGORS0",65,0)
 S (X,X0)=Y(0,0) S:Y="" Y=$P(Y(0),"^",2) Q
"RTN","PSGORS0",66,0)
DW ;
"RTN","PSGORS0",67,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2) D ENCHK Q:'$D(X)  S X=$P(SDW,"@"),X(1)="-" I X?.E1P.E,X'["-" F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSGORS0",68,0)
 F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSGORS0",69,0)
 K X(1) S:$D(X) X=SDW Q
"RTN","PSGORS0",70,0)
DWC I $L(Z)<2 K X Q
"RTN","PSGORS0",71,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSGORS0",72,0)
 E  K X
"RTN","PSGORS0",73,0)
 Q
"RTN","PSGP")
0^17^B11482901
"RTN","PSGP",1,0)
PSGP ;BIR/CML3-PATIENT LOOK-UP ;15 Apr 98 / 9:05 AM
"RTN","PSGP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**10,53,111**;16 DEC 97
"RTN","PSGP",3,0)
 ;
"RTN","PSGP",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGP",5,0)
 ; Reference to ^SDAMA203 is supported by DBIA 4133.
"RTN","PSGP",6,0)
 ;
"RTN","PSGP",7,0)
ENDPT ; get any patient
"RTN","PSGP",8,0)
 N HIT
"RTN","PSGP",9,0)
 K DIC,PSGP,Y W !!,"Select "_$S($D(PSGDICA):PSGDICA_" ",1:"")_"PATIENT: " R X:DTIME S:X["^" PSJSTOP=1 I "^"[X S (Y,PSGP)=-1 G DONE
"RTN","PSGP",10,0)
 D EN^PSJDPT
"RTN","PSGP",11,0)
 I Y'>0 G ENDPT
"RTN","PSGP",12,0)
 K DIC
"RTN","PSGP",13,0)
 ;
"RTN","PSGP",14,0)
CHK ;
"RTN","PSGP",15,0)
 S (DFN,PSGP)=+Y,VA200=1 D INP^VADPT
"RTN","PSGP",16,0)
 I VAIN(4) S PSJPCAF=1_"^"_VAIN(1),PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),PSJPTS=+VAIN(3),PSJPTSP=+VAIN(2),PSJPRB=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPTD=$P($G(^PS(55,PSGP,5.1)),"^",4),PSJPDD="" G CNV
"RTN","PSGP",17,0)
 S PSJPCAF="",VAIP("D")="L" D IN5^VADPT I 'VAIP(13,1) W $C(7),!!?3,"PATIENT HAS NEVER BEEN ADMITTED." D COP I 'HIT G ENDPT
"RTN","PSGP",18,0)
 S PSJPAD=VAIP(13,1),PSGID=+VAIP(3),X=+VAIP(4)=12!(+VAIP(4)=38),PSGOD=$$ENDTC^PSGMI(PSGID) W $C(7),!!?3,"PATIENT IS FOUND TO BE D",$P("ISCHARG^ECEAS","^",X+1),"ED AS OF ",PSGOD,"." D COP I 'HIT G:'$D(PSGRETF) ENDPT
"RTN","PSGP",19,0)
 S PSJPAD=VAIP(13,1),PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),PSJPRB=$P(VAIP(6),"^",2),PSJPTSP=+VAIP(7),PSJPTS=+VAIP(8),PSJPDX=VAIP(9),PSJPTD="",PSJPDD=PSGID_"^"_PSGOD S:X PSJPDD=PSJPDD_"^1"
"RTN","PSGP",20,0)
 ;
"RTN","PSGP",21,0)
CNV ;
"RTN","PSGP",22,0)
 D DEM^VADPT,PID^VADPT,HTWT^PSJAC(DFN)
"RTN","PSGP",23,0)
 S PSGP(0)=VADM(1),PSJPSSN=VADM(2),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID"),PSJPBID=VA("BID")
"RTN","PSGP",24,0)
 F X="PSJPAD","PSJPDOB","PSJPTD" I +@X S $P(@X,"^",2)=$$ENDTC^PSGMI(+@X)
"RTN","PSGP",25,0)
 ;
"RTN","PSGP",26,0)
WP ; ward parameters
"RTN","PSGP",27,0)
 S PSJSYSW0="",PSJSYSW=0 I PSJPWD S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSGP",28,0)
 ;S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$P(PSJSYSW0,"^",X*4+12)
"RTN","PSGP",29,0)
 S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16))
"RTN","PSGP",30,0)
 I PSJSYSL D
"RTN","PSGP",31,0)
 .S:X X='$P(PSJSYSP0,"^",10) S IOP=$S($P(PSJSYSP0,"^",13)]"":$P(PSJSYSP0,"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSGP",32,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D ^%ZISC
"RTN","PSGP",33,0)
 ;
"RTN","PSGP",34,0)
DONE ;
"RTN","PSGP",35,0)
 K DA,DIC,NB,ND,NS,PSGID,PSGOD,VA200,VADM,VAIN,VAIP,VAMT,X,Y(0),Y(0,0) Q
"RTN","PSGP",36,0)
 ;
"RTN","PSGP",37,0)
COP ;check for appointments in clinics that allowed inpatient orders
"RTN","PSGP",38,0)
 S HIT=0 Q:'$$PATCH^XPDUTL("SD*5.3*285")
"RTN","PSGP",39,0)
 N SQ,A,VAIP,X,PSJF
"RTN","PSGP",40,0)
 D IN5^VADPT
"RTN","PSGP",41,0)
 D NOW^%DTC S (PSJF,VASD("F"))=$P(%,".")-1
"RTN","PSGP",42,0)
 D SDA^VADPT
"RTN","PSGP",43,0)
 S SQ=0 F  S SQ=$O(^UTILITY("VASD",$J,SQ)) Q:'SQ  S A=^(SQ,"I") I $$SDIMO^SDAMA203($P(A,"^",2),DFN)>0 S HIT=1 Q
"RTN","PSGP",44,0)
 I $O(^PS(55,DFN,5,"AUN",PSJF))!($O(^PS(55,DFN,"IV","AIN",PSJF))) S HIT=1
"RTN","PSGP",45,0)
 Q 
"RTN","PSGPR")
0^112^B40201649
"RTN","PSGPR",1,0)
PSGPR ;BIR/CML3-PATIENT PROFILE ;19 SEP 96 / 3:59 PM
"RTN","PSGPR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,111**;16 DEC 97
"RTN","PSGPR",3,0)
 ;* N PSJNEW,PSGPTMP,PPAGE,PSGOEPRF S PSJNEW=1
"RTN","PSGPR",4,0)
 N PSGLI,PSGOE,PSGOEEWF,PSGOH,PSGWD,PSJPWDO,PSJSTOP,PSJTEAM
"RTN","PSGPR",5,0)
 N ACTION,CONT,PAT,LD,LN2,PFLG,PSJNEW,PSGPTMP,PPAGE,PSGOEPRF S PSJNEW=1
"RTN","PSGPR",6,0)
 ;
"RTN","PSGPR",7,0)
 S PSJOPC="UD"
"RTN","PSGPR",8,0)
 D ENCV^PSGSETU
"RTN","PSGPR",9,0)
 ;I '$D(XQUIT) F PSGPR=0:0 S (PSGP,PSGPRWD,PSGPRWG)=0,(PSGPRWDN,PSGPRWGN)="",PSGSSH="PPR" S PSGPTMP=0,PPAGE=1 D GWP^PSJPDIR Q:'$D(PSJSEL)  D @PSJSEL("SELECT")  D ENL^PSGOU I "^N"'[PSGOL D GO
"RTN","PSGPR",10,0)
 I '$D(XQUIT) F PSGPR=0:0 S (PSGP,PSGPRWD,PSGPRWG)=0,(PSGPRWDN,PSGPRWGN)="",PSGSSH="PPR" S PSGPTMP=0,PPAGE=1 D  Q:'$D(PSJSEL("SELECT"))
"RTN","PSGPR",11,0)
 .K PSJSEL,Y F  K ^TMP("PSJSELECT",$J),PSJSEL D ^PSGSEL Q:"^"[PSGSS  S PSJSEL("SELECT")=PSGSS D
"RTN","PSGPR",12,0)
 ..D:(PSJSEL("SELECT")="P") P^PSJPDIR D:(PSJSEL("SELECT")="W") W^PSJPDIR D:(PSJSEL("SELECT")="G") G^PSJPDIR
"RTN","PSGPR",13,0)
 ..I PSJSEL("SELECT")'="P",PSJSEL("SELECT")'="L" D RBPPN^PSJPDIR
"RTN","PSGPR",14,0)
 ..Q:(((PSGSS="W")!(PSGSS="G"))&($G(Y)<0))  Q:((PSGSS="P")&'$D(PSJSEL("P")))
"RTN","PSGPR",15,0)
 ..S (PSGP,WD,WG)=0 S PSGPTMP=0,PPAGE=1 D @PSGSS Q:(((PSGSS="L")!(PSGSS="C"))&($G(Y)<0))  D ENL^PSGOU I "^N"'[PSGOL D GO
"RTN","PSGPR",16,0)
 ;
"RTN","PSGPR",17,0)
DONE ;
"RTN","PSGPR",18,0)
 D:'$D(PSGOEPRF) ENKV^PSGSETU K AND,AT,C,CA,DOB,DRGI,FQC,MF,ND,NF,O,ON,PG,PN,PSGON,PSGORD,PRI,PSGONC,PSGONR,PSGONV,PSGSEL,PX,^TMP("PSGPR",$J)
"RTN","PSGPR",19,0)
 K RCT,PSGAPTM,PSGOL,PSGOS,PSGPR,PSGSS,PSGSSH,PSGPATM,PSGPRWD,PSGPRWDN,PSGPRWG,PSGPRWGN,PSGPRA,PSGPRP,PSJOPC,PSJSEL,S1,S2,S3,S4,HDT,PSGODT,QFLG,RF,SD,SLS,SSN,TF,TM,UD,UDU,WD,WDP,WT,ZTOUT,ZTSK,OD,PDRG
"RTN","PSGPR",20,0)
 Q
"RTN","PSGPR",21,0)
 ;
"RTN","PSGPR",22,0)
GO ;
"RTN","PSGPR",23,0)
 S PSGPRP="P",PSGPRA="" S PSGSS=PSJSEL("SELECT") G:PSGSS'="P" ENDEV
"RTN","PSGPR",24,0)
 K DIR S DIR(0)="SAO^P:PROFILE;E:EXPANDED VIEWS;B:BOTH",DIR("A")="Show PROFILE only, EXPANDED VIEWS only, or BOTH: ",DIR("B")="PROFILE",DIR("?")="^D PH^PSGPR" W ! D ^DIR K DIR Q:"^"[Y  S PSGPRP=Y
"RTN","PSGPR",25,0)
 I "EB"[PSGPRP F  R !!,"Show SHORT, LONG, or NO activity log?  NO// ",AT:DTIME D ALC^PSGVW0 I Q S PSGPRA=AT Q
"RTN","PSGPR",26,0)
 Q:PSGPRA="^"
"RTN","PSGPR",27,0)
ENDEV ;
"RTN","PSGPR",28,0)
 K ZTSAVE S PSGTIR="ENQ^PSGPR",ZTDESC="PATIENT PROFILE" F X="PSGP","PSGP(","PSGSS","PSGPRWD","PSGPRWG","PSGPRWDN","PSGPRWGN","PSGOL","PSGPRA","PSGPRP","PSGPTMP","PSJSEL(","PPAGE" S ZTSAVE(X)=""
"RTN","PSGPR",29,0)
 D ENDEV^PSGTI I POP!$D(IO("Q")) G:$D(PSGOEPRF) DONE Q
"RTN","PSGPR",30,0)
 ;
"RTN","PSGPR",31,0)
ENQ ;
"RTN","PSGPR",32,0)
 K ^TMP("PSGPR",$J)
"RTN","PSGPR",33,0)
 K PSGVBY N RB,ATM S PSGPR=IO'=IO(0)!($E(IOST)'="C") N RBP S RBP=$S($D(PSJSEL("RBP")):PSJSEL("RBP"),1:"P") D @("P"_PSGSS) I PSGPR W:$Y @IOF D ^%ZISC
"RTN","PSGPR",34,0)
 G:$D(PSGOEPRF) DONE Q
"RTN","PSGPR",35,0)
 ;
"RTN","PSGPR",36,0)
G ; get ward group
"RTN","PSGPR",37,0)
 S PSGPRWG=+PSJSEL("WG"),PSGPRWGN=$P(PSJSEL("WG"),"^",2) Q
"RTN","PSGPR",38,0)
 ;
"RTN","PSGPR",39,0)
W ; get ward
"RTN","PSGPR",40,0)
 S PSGPRWD=+PSJSEL("W"),PSGPRWDN=$P(PSJSEL("W"),"^",2)
"RTN","PSGPR",41,0)
 I $D(PSJSEL("TM")) S TM="" F  S TM=$O(PSJSEL("TM",TM)) Q:TM=""  S PSGAPTM(TM)=TM
"RTN","PSGPR",42,0)
 Q
"RTN","PSGPR",43,0)
 ;
"RTN","PSGPR",44,0)
C ;
"RTN","PSGPR",45,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGPR",46,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGPR",47,0)
CDIC ;
"RTN","PSGPR",48,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y
"RTN","PSGPR",49,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGPR",50,0)
 Q
"RTN","PSGPR",51,0)
 ;
"RTN","PSGPR",52,0)
P ; get patient
"RTN","PSGPR",53,0)
 N PAT S PAT="" F  S PAT=$O(PSJSEL("P",PAT)) Q:PAT=""  S PSGP(PAT)=$O(PSJSEL("P",PAT,PSGP))
"RTN","PSGPR",54,0)
 Q
"RTN","PSGPR",55,0)
 ;
"RTN","PSGPR",56,0)
PG ;
"RTN","PSGPR",57,0)
 F PSGPRWD=0:0 S PSGPRWD=$O(^PS(57.5,"AC",PSGPRWG,PSGPRWD)) Q:'PSGPRWD  I $D(^DIC(42,PSGPRWD,0)),$P(^(0),"^")]"" S PSGPRWDN=$P(^(0),"^") D
"RTN","PSGPR",58,0)
 .F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGPRWDN,PSGP)) Q:'PSGP  D
"RTN","PSGPR",59,0)
 ..I RBP="R" S RB=$G(^DPT(PSGP,.101)) S:RB="" RB="zz" S ^TMP("PSGPR",$J,RB,PSGPRWDN,RB)=PSGP
"RTN","PSGPR",60,0)
 ..I RBP="P" D ^PSJAC S ^TMP("PSGPR",$J,PSGPRWDN,PSGP(0))=PSGP
"RTN","PSGPR",61,0)
 I $D(^TMP("PSGPR",$J)) N PSGX S PSGX="^TMP(""PSGPR"",$J)" F  S PSGX=$Q(@PSGX) Q:PSGX'[("""PSGPR"""_","_$J)  S PSGP=$G(@PSGX) D PP0 Q:$G(X)?1"^"."^"
"RTN","PSGPR",62,0)
 Q
"RTN","PSGPR",63,0)
 ;
"RTN","PSGPR",64,0)
PW ;
"RTN","PSGPR",65,0)
 I $D(PSJSEL("TM")) S TM="" F  S TM=$O(PSJSEL("TM",TM)) Q:TM=""  S PSGPATM(TM)=TM
"RTN","PSGPR",66,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGPRWDN,PSGP)) Q:'PSGP  S RB=$G(^DPT(PSGP,.101)),TM="zz" D
"RTN","PSGPR",67,0)
 .I '$D(PSGPATM) D SET Q
"RTN","PSGPR",68,0)
 .S:RB]"" TM=$O(^PS(57.7,"AWRT",PSGPRWD,RB,0)) S:'TM TM="zz" I $D(PSGPATM("ALL"))!$D(PSGPATM(TM))  D SET Q
"RTN","PSGPR",69,0)
 I $D(^TMP("PSGPR",$J)) N PSGX S PSGX="^TMP(""PSGPR"",$J)" F  S PSGX=$Q(@PSGX) Q:PSGX'[("""PSGPR"""_","_$J)  S PSGP=$G(@PSGX) D PP0 Q:$G(X)?1"^"."^"
"RTN","PSGPR",70,0)
 Q
"RTN","PSGPR",71,0)
 ;
"RTN","PSGPR",72,0)
L ;
"RTN","PSGPR",73,0)
 D L^PSGVBW
"RTN","PSGPR",74,0)
 Q
"RTN","PSGPR",75,0)
 ;
"RTN","PSGPR",76,0)
PL S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D PC
"RTN","PSGPR",77,0)
 Q
"RTN","PSGPR",78,0)
 ;
"RTN","PSGPR",79,0)
PC S WDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGPR",80,0)
 S PSGP="" F  S PSGP=$O(^PS(53.1,"AD",CL,PSGP)) Q:'PSGP  S RB=$G(^DPT(PSGP,.101)),TM="zz" D
"RTN","PSGPR",81,0)
 .D SET Q
"RTN","PSGPR",82,0)
 I $D(^TMP("PSGPR",$J)) N PSGX S PSGX="^TMP(""PSGPR"",$J)" F  S PSGX=$Q(@PSGX) Q:PSGX'[("""PSGPR"""_","_$J)  S PSGP=$G(@PSGX) D PP0 Q:$G(X)?1"^"."^"
"RTN","PSGPR",83,0)
 Q
"RTN","PSGPR",84,0)
 ;
"RTN","PSGPR",85,0)
SET ;
"RTN","PSGPR",86,0)
 S:TM'["zz" TM=$G(^PS(57.7,$G(PSGPRWD),1,TM,0)) I RB="" S RB="z"
"RTN","PSGPR",87,0)
 I RBP="P" D ^PSJAC S ^TMP("PSGPR",$J,TM,PSGP(0))=PSGP Q
"RTN","PSGPR",88,0)
 I RBP="R" S ^TMP("PSGPR",$J,TM,RB)=PSGP
"RTN","PSGPR",89,0)
 Q
"RTN","PSGPR",90,0)
 ;
"RTN","PSGPR",91,0)
PP ;
"RTN","PSGPR",92,0)
 S PAT="" F  S PAT=$O(PSGP(PAT)) Q:PAT=""  S PSGP=PSGP(PAT) D PP0 Q:$G(X)?1"^"."^"
"RTN","PSGPR",93,0)
 Q
"RTN","PSGPR",94,0)
 ;
"RTN","PSGPR",95,0)
PP0 ;
"RTN","PSGPR",96,0)
 N PSJACNWP S PSJACNWP=1 D ^PSJAC I PSGPRP'="E" D ^PSGO I PSGPRP="P",'PSGPR D:'PSGON READ^PSJUTL Q:$G(X)?1"^"."^"  I PSGON S (PSGONC,PSGONF,PSGONR,PSGONV,PSGPRF)=0 D ENVO^PSGOE0 K PSGPRF Q
"RTN","PSGPR",97,0)
 Q:PSGPRP="P"  I PSGPRP="E" U IO D ENGORD^PSGOU,ENPR^PSGO
"RTN","PSGPR",98,0)
 I 'PSGPR,PSGSS'="P",'$D(^TMP("PSG",$J)) D READ^PSJUTL Q
"RTN","PSGPR",99,0)
 S (S1,S2,S3,X)=""
"RTN","PSGPR",100,0)
 F  S S1=$O(^TMP("PSG",$J,S1)) Q:S1=""  F  S S2=$O(^TMP("PSG",$J,S1,S2)) Q:S2=""  F  S S3=$O(^TMP("PSG",$J,S1,S2,S3)) Q:S3=""  D PP1
"RTN","PSGPR",101,0)
 D:X'["^"&PSGPR BOT^PSGO K ^TMP("PSG",$J) Q
"RTN","PSGPR",102,0)
 ;
"RTN","PSGPR",103,0)
PP1 ;
"RTN","PSGPR",104,0)
 ;* S PSGORD=$P(S3,"^",2)_S1 D EN2^PSGVW I PSGPRA'="N" S AT=PSGPRA D ENA^PSGVW0
"RTN","PSGPR",105,0)
 S PSGORD=$P(S3,"^",2)_$S(S1["BD":"",S1["B":"P",S1["CD":"",S1["C":"P",1:"U") D EN2^PSGVW I PSGPRA'="N" S AT=PSGPRA D ENA^PSGVW0
"RTN","PSGPR",106,0)
 S X="" I 'PSGPR S DIR(0)="E" W ! D ^DIR S:$D(DIRUT) X="^" I X["^" S (S1,S2,S3)="~"
"RTN","PSGPR",107,0)
 Q
"RTN","PSGPR",108,0)
 ;
"RTN","PSGPR",109,0)
PH ;
"RTN","PSGPR",110,0)
 W !!?2,"Enter a 'P' to print ONLY the PROFILE of orders for this patient.  Enter an",!,"'E' to print ONLY the EXPANDED VIEW of the orders for this patient.  Enter a",!,"'B' to have BOTH the profile (first) and the expanded views print."
"RTN","PSGPR",111,0)
 W "  Enter an '^'to exit." Q
"RTN","PSGPR",112,0)
 ;
"RTN","PSGPR",113,0)
ENOR S (DFN,PSGP)=+ORVP
"RTN","PSGPR",114,0)
ENLM N PSJNEW,PSGPTMP,PPAGE,PSGOEPRF S PSJNEW=1
"RTN","PSGPR",115,0)
 S PSJOPC="UD",PSGPTMP=0,PPAGE=1
"RTN","PSGPR",116,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGPR",117,0)
 S PSJSEL("SELECT")="P",PSJSEL("P",$P($G(^DPT(DFN,0)),U),DFN)="" D ^VADPT
"RTN","PSGPR",118,0)
 D ^PSJAC,ENL^PSGOU I "^N"'[PSGOL D
"RTN","PSGPR",119,0)
 .S PSGSS="P",(PSGPRWD,PSGPRWG)=0,(PSGPRWDN,PSGPRWGN)=""
"RTN","PSGPR",120,0)
 .S PSGP(PSGP(0))=DFN K PSGP(0) D GO
"RTN","PSGPR",121,0)
 S PSJNKF=1 D READ^PSJUTL G DONE
"RTN","PSGS0")
0^76^B42463838
"RTN","PSGS0",1,0)
PSGS0 ;BIR/CML3-SCHEDULE PROCESSOR ;29 Jan 99 / 8:04 AM
"RTN","PSGS0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**12,25,26,50,63,74,83,116,110,111**;16 DEC 97
"RTN","PSGS0",3,0)
 ;
"RTN","PSGS0",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGS0",5,0)
 ; Reference to ^PS(55   is supported by DBIA 2191
"RTN","PSGS0",6,0)
 ;
"RTN","PSGS0",7,0)
ENA ; entry point for train option
"RTN","PSGS0",8,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGS0",9,0)
 F  S (PSGS0Y,PSGS0XT)="" R !!,"Select STANDARD SCHEDULE: ",X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" ENQ^PSGSH I X'?1."?" D EN W:$D(X)[0 $C(7),"  ??" I $D(X)#2,'PSGS0Y,PSGS0XT W "  Every ",PSGS0XT," minutes"
"RTN","PSGS0",10,0)
 K DIC,DIE,PSGS0XT,PSGS0Y,Q,X,Y,PSGDT Q
"RTN","PSGS0",11,0)
 ;
"RTN","PSGS0",12,0)
EN3 ;
"RTN","PSGS0",13,0)
 S PSGST=$P($G(^PS(53.1,DA,0)),"^",7) G EN
"RTN","PSGS0",14,0)
 ;
"RTN","PSGS0",15,0)
EN5 ;
"RTN","PSGS0",16,0)
 S PSGST=$P($G(^PS(55,DA(1),5,DA,0)),"^",7)
"RTN","PSGS0",17,0)
 ;
"RTN","PSGS0",18,0)
EN ; validate
"RTN","PSGS0",19,0)
 K PSGS0Y
"RTN","PSGS0",20,0)
 I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X)>70)!($L(X)<1) K X Q
"RTN","PSGS0",21,0)
 S X=$$TRIM^XLFSTR(X,"R"," ")
"RTN","PSGS0",22,0)
 I X?.E1L.E S X=$$ENLU^PSGMI(X) I '$D(PSGOES) D EN^DDIOL("  ("_X_")")
"RTN","PSGS0",23,0)
 ;
"RTN","PSGS0",24,0)
ENOS ; order set entry
"RTN","PSGS0",25,0)
 N X0,Y0,PSJXI,PSJDIC2
"RTN","PSGS0",26,0)
 I $G(X)="",$G(P(2)),$G(P(3)) S X=$G(P(9))
"RTN","PSGS0",27,0)
 I $G(X)="" Q
"RTN","PSGS0",28,0)
 S PSGXT=$G(PSGS0XT),(PSGS0XT,PSGS0Y,XT,Y,PSJNSS)=""
"RTN","PSGS0",29,0)
 S X0=X I X?2.4N1"-".E!(X?2.4N) D ENCHK S:$D(X) Y=X G Q
"RTN","PSGS0",30,0)
 I X["PRN",$$PRNOK(X),'$D(^PS(51.1,"AC","PSJ",X)) D  G Q
"RTN","PSGS0",31,0)
 .I X["@"!$$DOW^PSIVUTL($P(X," PRN")) N DOW D  I $G(DOW) S (Y0,Y,PSGS0Y)=$P($P(X,"@",2)," ")
"RTN","PSGS0",32,0)
 ..N TMP S TMP=X N X S X=$P(TMP," PRN") D DW I $G(X)]"" S DOW=1
"RTN","PSGS0",33,0)
 ..I DOW,$G(PSGST)]"" I ",P,R,"'[(","_PSGST_",") S (XT,PSGS0XT)="D"
"RTN","PSGS0",34,0)
 D DIC I $G(XT)]""!$G(Y0)!($G(X)]""&$G(PSJXI)) D  I $G(X)]"" G:$D(^PS(51.1,"AC","PSJ",X)) Q3 I $P(X,"@")]"" G:$D(^PS(51.1,"AC","PSJ",$P(X,"@"))) Q3
"RTN","PSGS0",35,0)
 .S PSGS0XT=XT S:$G(Y0) (Y,PSGS0Y)=Y0 S:'PSGS0Y&((PSGS0XT)="D")&(X["@") PSGS0Y=$P(X,"@",2)
"RTN","PSGS0",36,0)
 .S PSGS0Y=$P(PSGS0Y," ")
"RTN","PSGS0",37,0)
 N TMPSCHX S TMPSCHX=X I $L(X,"@")<3 S TMPX=X D DW I $G(X)]"" K PSJNSS S (PSGS0XT,XT)="D" D  G Q
"RTN","PSGS0",38,0)
 .S Y=$S(($G(TMPSCHX)["@"):$P(TMPSCHX,"@",2),1:"")
"RTN","PSGS0",39,0)
 .I Y,(X'["@"),(TMPSCHX["@") S X=TMPSCHX
"RTN","PSGS0",40,0)
 S X=TMPSCHX
"RTN","PSGS0",41,0)
 I X'="" I $D(^PS(51.1,"AC","PSJ",X)) K PSJNSS G Q
"RTN","PSGS0",42,0)
 ;
"RTN","PSGS0",43,0)
NS I ($G(X)="^")!($G(X)="") K X S Y="" Q
"RTN","PSGS0",44,0)
 N NS S NS=0,PSJNSS=0
"RTN","PSGS0",45,0)
 I $G(Y)'>0 S X=X0,Y="",NS=1,PSJNSS=1
"RTN","PSGS0",46,0)
Q ;
"RTN","PSGS0",47,0)
 S PSGS0XT=$S(XT]"":XT,1:$G(PSGS0XT)),PSGS0Y=$S($G(Y):Y,$G(PSGS0Y):PSGS0Y,1:"") S:PSGS0XT<0 PSGS0XT=""
"RTN","PSGS0",48,0)
 I ('$G(PSGS0Y)&'$G(PSJDIC2)&$G(PSGAT))&'$G(PSJNEWOE)&$G(PSGS0XT) I PSGS0XT<1441 I ($L($G(PSGAT),"-")=PSGS0XT/1440)!($G(X)]""&($G(PSGSCH)=$G(X))) S PSGS0Y=$G(PSGAT)
"RTN","PSGS0",49,0)
Q2 K YY
"RTN","PSGS0",50,0)
 I '$G(PSJNSS),'$G(PSGS0Y),$G(YY) S PSGS0Y=YY
"RTN","PSGS0",51,0)
 I ($G(PSJNSS)&($G(VALMBCK)'="Q"))!($G(PSJNSS)&$G(PSJLIFNI))!($G(PSJNSS)&$G(PSJTUD)) D
"RTN","PSGS0",52,0)
 .I $G(P(2))&$G(P(3)) Q
"RTN","PSGS0",53,0)
 .I ($G(X)]"") I ($G(PSGS0XT)'="D") D NSSCONT(X,PSGS0XT) S TMPX="" K X
"RTN","PSGS0",54,0)
 I $G(P(2))&$G(P(3)) I $G(X)]"",$$SCHREQ^PSJLIVFD(.P),'$$DOW^PSIVUTL(X),'$$PRNOK(X),'$D(^PS(51.1,"AC","PSJ",X)) D NSSCONT(X,PSGS0XT) S TMPX="" K X
"RTN","PSGS0",55,0)
Q3 K QX,SDW,SWD,X0,XT,Z Q
"RTN","PSGS0",56,0)
 ;
"RTN","PSGS0",57,0)
NSSCONT(SCH,FREQ) ;
"RTN","PSGS0",58,0)
 Q:SCH=""!($G(VALMBCK)]"")!$G(PSGMARSD)!$G(PSIVFN1)
"RTN","PSGS0",59,0)
 I $G(PSGOES),'$G(NSFF) Q
"RTN","PSGS0",60,0)
 N PSGS0XT,PSGSCH,DIR,X,Y S PSGSCH=SCH,PSGS0XT=FREQ,PSJNSS=1
"RTN","PSGS0",61,0)
 D NSSMSG I ($L(PSJNSS)>2),'$G(PSJXI) W !!,PSJNSS,! S PSJNSS=1
"RTN","PSGS0",62,0)
 S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR
"RTN","PSGS0",63,0)
 K NSFF Q
"RTN","PSGS0",64,0)
 ;
"RTN","PSGS0",65,0)
NSSMSG ;
"RTN","PSGS0",66,0)
 Q:$G(PSJXI)
"RTN","PSGS0",67,0)
 I '(",O,"[(","_$G(PSGST)_",")),$G(PSJNSS),$G(PSGSCH)]"" D
"RTN","PSGS0",68,0)
 .S PSJNSS=" WARNING - "_PSGSCH_" is an invalid schedule."
"RTN","PSGS0",69,0)
 S PSGSCH="",PSGS0XT=""
"RTN","PSGS0",70,0)
 Q
"RTN","PSGS0",71,0)
 ;
"RTN","PSGS0",72,0)
NSO(FQ) ;
"RTN","PSGS0",73,0)
 Q:'FQ!(FQ<0)!(",D,O,"[(","_$G(PSGST)_",")) ""
"RTN","PSGS0",74,0)
 K FRQOUT S FRQOUT=$S(FQ<60:(FQ_"minute"),(FQ<1440)&(FQ#60):(FQ_" minute"),(FQ<1440)!(FQ#1440):(FQ/60_" hour"),1:(FQ/1440_" day")) D
"RTN","PSGS0",75,0)
 . S:(+FRQOUT'=1) FRQOUT=FRQOUT_"s"
"RTN","PSGS0",76,0)
 Q FRQOUT
"RTN","PSGS0",77,0)
 ;
"RTN","PSGS0",78,0)
ENCHK ;
"RTN","PSGS0",79,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q
"RTN","PSGS0",80,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q
"RTN","PSGS0",81,0)
 S X(1)=$L(X(1)) I X'["-"&((X>$E(2400,1,X(1))!($E(X,3,4)>59))) K X Q
"RTN","PSGS0",82,0)
 F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$E(2400,1,X(1)):1,$E(X(3),3,4)>59:1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSGS0",83,0)
 K:$D(X) X(1),X(2),X(3) Q
"RTN","PSGS0",84,0)
 ;
"RTN","PSGS0",85,0)
DIC ;
"RTN","PSGS0",86,0)
 K Y0,PSJXI N Y
"RTN","PSGS0",87,0)
 S Z=0 F PSJXI=0:1 S Z=$O(^PS(51.1,"AC","PSJ",X,Z)) Q:'Z
"RTN","PSGS0",88,0)
 I $G(X)]"",'$G(PSJSLUP) D
"RTN","PSGS0",89,0)
 .I $D(^PS(51.1,"AC","PSJ",X)) D  Q:$G(PSGS0Y)&($G(PSGS0XT)]"")
"RTN","PSGS0",90,0)
 ..I $$DOW^PSIVUTL(X) S PSGS0XT="D",PSJNSS=0 S:X["@" (Y0,PSGS0Y)=$P(X,"@",2) Q
"RTN","PSGS0",91,0)
 ..I $G(NSFF) S Y0=$S($G(PSGS0Y):PSGS0Y,$G(PSGAT)&'$G(PSJNEWOE):PSGAT,1:"") S:Y0 PSGS0Y=Y0
"RTN","PSGS0",92,0)
 .; Check for duplicate schedules - force selection
"RTN","PSGS0",93,0)
 .Q:PSJXI>1&('$G(PSGOES))&($G(PSGS0XT)]"")
"RTN","PSGS0",94,0)
 .I $D(^PS(51.1,"AC","PSJ",X)) N FREQ,ADMATCH S FREQ=PSGS0XT D
"RTN","PSGS0",95,0)
 ..N PSGS0XT,PSGS0Y,PSGST,PSGS0XT D ADMIN^PSJORPOE S:$G(PSGS0XT) XT=PSGS0XT S:$G(PSGS0Y) (Y0,Y)=PSGS0Y
"RTN","PSGS0",96,0)
 .S:$G(XT)]"" PSGS0XT=XT S:$G(Y) PSGS0Y=Y
"RTN","PSGS0",97,0)
 .I $$DOW^PSIVUTL(X) S:PSGS0XT="" (XT,PSGS0XT)="D" S:PSGS0Y="" (Y0,PSGS0Y)=$S($P(X,"@",2):$P(X,"@",2),1:"")
"RTN","PSGS0",98,0)
 I $G(PSJLIFNI)!($G(P(4))]""&($G(P(2))]"")) I '$D(^PS(51.1,"AC","PSJ",X))!($G(PSJXI)>1) S PSJSLUP=1
"RTN","PSGS0",99,0)
 I $G(NSFF),$G(PSJXI)>1 D
"RTN","PSGS0",100,0)
 .I $G(PSGS0XT)="",$G(NSFF),$G(PSGXT)]"" S PSGS0XT=PSGXT Q
"RTN","PSGS0",101,0)
 .I $G(PSGS0XT)=""!($G(PSGS0Y)="") S PSJSLUP=1
"RTN","PSGS0",102,0)
 I '$G(PSJSLUP) Q:$G(PSGS0XT)]""&($G(PSGS0Y)]"")
"RTN","PSGS0",103,0)
 Q:$G(PSGOES)=2
"RTN","PSGS0",104,0)
 K PSJSLUP
"RTN","PSGS0",105,0)
 ;
"RTN","PSGS0",106,0)
 K DIC S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(PSGOES))_"ISZ",DIC("W")="W ""  "","_$S('$D(PSJPWD):"$P(^(0),""^"",2)",'PSJPWD:"$P(^(0),""^"",2)",1:"$S($D(^PS(51.1,+Y,1,+PSJPWD,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"),D="APPSJ"
"RTN","PSGS0",107,0)
 I $D(PSGST) ;S DIC("S")="I $P(^(0),""^"",5)"_$E("'",PSGST'="O")_"=""O"""
"RTN","PSGS0",108,0)
 S PSJDIC2=1
"RTN","PSGS0",109,0)
 D IX^DIC K DIC S:$D(DIE)#2 DIC=DIE I Y'>0 D  Q
"RTN","PSGS0",110,0)
 .I '$$DOW^PSIVUTL(X),'$$PRNOK(X) S X="",PSJNSS=1,XT="",PSJXI=""
"RTN","PSGS0",111,0)
 S XT=$S("C"[$P(Y(0),"^",5):$P(Y(0),"^",3),1:$P(Y(0),"^",5))
"RTN","PSGS0",112,0)
 S X=+Y,Y="" I $D(PSJPWD),$D(^PS(51.1,+X,1,+PSJPWD,0)) S Y=$P(^(0),"^",2)
"RTN","PSGS0",113,0)
 S (X,X0)=Y(0,0) S:$G(Y)="" Y=$P(Y(0),"^",2)
"RTN","PSGS0",114,0)
 S (PSGS0Y,Y0)=$G(Y),Y0(0)=Y(0) I $P(Y(0),"^",3) S XT=$P(Y(0),"^",3)
"RTN","PSGS0",115,0)
 I $G(PSGS0XT)="",$$DOW^PSIVUTL(X) S (XT,PSGS0XT)="D"
"RTN","PSGS0",116,0)
 Q
"RTN","PSGS0",117,0)
 ;
"RTN","PSGS0",118,0)
DW ;
"RTN","PSGS0",119,0)
 Q:($L(X,"@")>2)
"RTN","PSGS0",120,0)
 N AT I X["@" S AT=$P(X,"@",2)
"RTN","PSGS0",121,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2) N XABB S XABB=""
"RTN","PSGS0",122,0)
 I X]"" D ENCHK Q:'$D(X)
"RTN","PSGS0",123,0)
 S X=$P(SDW,"@"),X(1)="-" I X?.E1P.E,X'["-"  ;F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSGS0",124,0)
 F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSGS0",125,0)
 I $D(X) F II=1:1:$L(X,X(1)) S XABB=$G(XABB)_$E($P(X,X(1),II),1,2)_"-"
"RTN","PSGS0",126,0)
 K X(1) S:$D(X) X=SDW I $G(X)]"" I $TR(XABB,"-")]"" S X=$E($G(XABB),1,$L(XABB)-1)
"RTN","PSGS0",127,0)
 I $G(AT) S PSGS0Y=AT
"RTN","PSGS0",128,0)
 Q
"RTN","PSGS0",129,0)
DWC I $L(Z)<2 K X Q
"RTN","PSGS0",130,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSGS0",131,0)
 E  K X
"RTN","PSGS0",132,0)
 Q
"RTN","PSGS0",133,0)
 ;
"RTN","PSGS0",134,0)
PRNOK(PSCH) ;
"RTN","PSGS0",135,0)
 Q:PSCH'["PRN" 0
"RTN","PSGS0",136,0)
 I $TR(PSCH," ")="PRN" Q 1
"RTN","PSGS0",137,0)
 N BASE,I,OK S OK=0 S I=$P(PSCH," PRN") I I]"",$D(^PS(51.1,"AC","PSJ",I)) S OK=1
"RTN","PSGS0",138,0)
 I 'OK D
"RTN","PSGS0",139,0)
 .I PSCH["@" I $D(^PS(51.1,"AC","PSJ",$P(PSCH,"@")))!$$DOW^PSIVUTL($P(PSCH,"@")) S OK=1 Q
"RTN","PSGS0",140,0)
 .I $$DOW^PSIVUTL($P(PSCH," PRN")) S OK=1
"RTN","PSGS0",141,0)
 Q OK
"RTN","PSGS0",142,0)
ODD(PSF) ;determine if this is an odd schedule
"RTN","PSGS0",143,0)
 I PSF>1439,PSF#1440 Q 1
"RTN","PSGS0",144,0)
 I PSF,PSF<1440,1440#PSF Q 1
"RTN","PSGS0",145,0)
 Q 0
"RTN","PSGSEL")
0^77^B26408346
"RTN","PSGSEL",1,0)
PSGSEL ;BIR/CML3-SELECT ORDERS BY WARD, WARD GROUP, OR PATIENT ; 15 May 98 / 9:26 AM
"RTN","PSGSEL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,111**;16 DEC 97
"RTN","PSGSEL",3,0)
SELECT ; give user choice to select by
"RTN","PSGSEL",4,0)
 S:'$D(PSGSSH) PSGSSH="GENERIC"
"RTN","PSGSEL",5,0)
 ;F  R !!,"Select by WARD GROUP (G), WARD (W), or PATIENT (P): ",PSGSS:DTIME W:'$T $C(7) S:'$T PSGSS="^" Q:"^"[PSGSS  D CHK I "GPW"[PSGSS S ^DISV(DUZ,"PSGSEL")=PSGSS Q
"RTN","PSGSEL",6,0)
 F  R !!,"Select by GROUP (G), WARD (W), CLINIC (C), or PATIENT (P): ",PSGSS:DTIME W:'$T $C(7) S:'$T PSGSS="^" Q:"^"[PSGSS  D CHK I "CGPW"[PSGSS Q
"RTN","PSGSEL",7,0)
 K PSGSSA Q:PSGSS'="G"
"RTN","PSGSEL",8,0)
 F  R !!,"Select by WARD GROUP (W) or CLINIC GROUP (C): ",PSGSS2:DTIME W:'$T $C(7) S:'$T PSGSS2="^" Q:"^"[PSGSS2  D CHK2 I "CW"[PSGSS2 Q
"RTN","PSGSEL",9,0)
 G SELECT:PSGSS2="" S PSGSS=$S(PSGSS2="C":"L",1:"G")
"RTN","PSGSEL",10,0)
 K PSGSSA,PSGSS2 Q
"RTN","PSGSEL",11,0)
 ;
"RTN","PSGSEL",12,0)
CHK ;
"RTN","PSGSEL",13,0)
 ;I PSGSS=" ",$D(^DISV(DUZ,"PSGSEL")) S PSGSS=^("PSGSEL") W $S(PSGSS="P":"PATIENT",PSGSS="W":"WARD",PSGSS="G":"GROUP",1:"") Q:PSGSS]""&("GPW"[PSGSS)
"RTN","PSGSEL",14,0)
 I PSGSS=" " W $S(PSGSS="P":"PATIENT",PSGSS="W":"WARD",PSGSS="G":"GROUP",PSGSS="C":"CLINIC",1:"") Q:PSGSS]""&("GPWC"[PSGSS)
"RTN","PSGSEL",15,0)
 S PSGSSA="" F Q=1:1:$L(PSGSS) S PSGSSA=PSGSSA_$S($E(PSGSS,Q)'?1L:$E(PSGSS,Q),1:$C($A(PSGSS,Q)-32))
"RTN","PSGSEL",16,0)
 F X="CLINIC","GROUP","WARD","PATIENT" I $P(X,PSGSSA)="" W $P(X,PSGSSA,2,99) S PSGSS=$E(PSGSSA) Q
"RTN","PSGSEL",17,0)
 Q:$T  I PSGSS'?1."?" W $C(7),"  ??" S PSGSS="Z" Q
"RTN","PSGSEL",18,0)
 W ! D @PSGSSH W !!?2,"To leave this option, press the RETURN key or enter an '^'." Q
"RTN","PSGSEL",19,0)
 ;
"RTN","PSGSEL",20,0)
CHK2 ;
"RTN","PSGSEL",21,0)
 S PSGSSA="" F Q=1:1:$L(PSGSS2) S PSGSSA=PSGSSA_$S($E(PSGSS2,Q)'?1L:$E(PSGSS2,Q),1:$C($A(PSGSS2,Q)-32))
"RTN","PSGSEL",22,0)
 F X="WARD","CLINIC" I $P(X,PSGSSA)="" W $P(X,PSGSSA,2,99) S PSGSS2=$E(PSGSSA) Q
"RTN","PSGSEL",23,0)
 Q:$T  I PSGSS2'?1."?" W $C(7),"  ??" S PSGSS2="Z" Q
"RTN","PSGSEL",24,0)
 W ! D @PSGSSH W !!?2,"To leave this option, press the RETURN key or enter an '^'." Q
"RTN","PSGSEL",25,0)
 ;
"RTN","PSGSEL",26,0)
HELP ; the following are the help text messages for the various options
"RTN","PSGSEL",27,0)
 ;
"RTN","PSGSEL",28,0)
GENERIC W !!,?2,"To run this option for an entire WARD GROUP, enter a 'G'.  To run this option for a single WARD, enter a 'W'.  To run this option for a single PATIENT, enter a 'P'." Q
"RTN","PSGSEL",29,0)
 ;
"RTN","PSGSEL",30,0)
VBW W !!?2,"To verify all of the orders in an entire WARD GROUP, enter a 'G'. To verify   all of the orders in an entire CLNIC GROUP, enter 'CG'."
"RTN","PSGSEL",31,0)
 W " To verify all of the    orders in a single WARD, enter a 'W'. To verify all of the orders in a single   CLINIC, enter a 'C'."
"RTN","PSGSEL",32,0)
 W "To verify all of the orders for a single PATIENT, enter a   'P'." Q
"RTN","PSGSEL",33,0)
 ;
"RTN","PSGSEL",34,0)
EXP W !?2,"To print STOP ORDER NOTICES for an entire WARD GROUP, enter a 'G'.  To print  notices for a single WARD, enter a 'W'.  To print notices for a single PATIENT, enter a 'P'." Q
"RTN","PSGSEL",35,0)
 ;
"RTN","PSGSEL",36,0)
MAR W !?2,"To run a Medication Administration Record (MAR or CMR) for an entire WARD",!,"GROUP, enter a 'G'.  To run an MAR for a single WARD, enter a 'W'.  To run an   MAR for a single PATIENT, enter a 'P'." Q
"RTN","PSGSEL",37,0)
 ;
"RTN","PSGSEL",38,0)
LBL W !?2,"To print labels for all of the orders in an entire WARD GROUP, enter a 'G'.   To print labels for all of the orders in a WARD, enter a 'W'.  To print the",!,"labels for a single PATIENT, enter a 'P'." Q
"RTN","PSGSEL",39,0)
 ;
"RTN","PSGSEL",40,0)
TCR W !?2,"To run a TOTAL COST REPORT for an entire WARD GROUP, enter a 'G'.  To run the report for a single WARD, enter a 'W'.  To run the report for a single PATIENT,",!,"or a set of PATIENTS, enter a 'P'." Q
"RTN","PSGSEL",41,0)
 ;
"RTN","PSGSEL",42,0)
PPR W !?2,"To print PATIENT PROFILES for an entire WARD GROUP, enter a 'G'.  To print    profiles for a single WARD, enter a 'W'.  To print a profile for a single",!,"PATIENT, enter a 'P'." Q
"RTN","PSGSEL",43,0)
 ;
"RTN","PSGSEL",44,0)
AP W !?2,"To print ACTION PROFILES for an entire WARD GROUP, enter a 'G'.  To print",!,"ACTION PROFILES for a single WARD, enter a 'W'.  To print an ACTION PROFILE",!,"for a single patient, enter a 'P'.  PLEASE NOTE that only patients"
"RTN","PSGSEL",45,0)
 W " with active",!,"orders are selectable, and that only patients with active orders will print for",!,"a ward or ward group." Q
"RTN","PSGSEL",46,0)
ORVC W !?2,"To complete orders for an entire WARD GROUP, enter a 'G'. To complete orders for an entire CLINIC GROUP, enter 'CG'"
"RTN","PSGSEL",47,0)
 W "To complete orders for a single WARD, enter a 'W'.  To complete orders for a single PATIENT, enter",!,"a 'P'." Q
"RTN","PSGSH")
0^82^B9080011
"RTN","PSGSH",1,0)
PSGSH ;BIR/CML3-SCHEDULE HELP TEXT ;07 OCT 97 / 9:17 AM 
"RTN","PSGSH",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**111**;16 DEC 97
"RTN","PSGSH",3,0)
 ;
"RTN","PSGSH",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGSH",5,0)
 ; 
"RTN","PSGSH",6,0)
ENSH3 ; from ^DD(53.1,26,4)
"RTN","PSGSH",7,0)
 S:'$D(PSGST) PSGST=$P($G(^PS(53.1,DA,0)),"^",7),PSGDDFLG=1 G ENSH
"RTN","PSGSH",8,0)
 ;
"RTN","PSGSH",9,0)
ENSH5 ; from ^DD(55.06,26,4)
"RTN","PSGSH",10,0)
 S:'$D(PSGST) PSGST=$P($G(^PS(55,DA(1),5,DA,0)),"^",7),PSGDDFLG=1 G ENSH
"RTN","PSGSH",11,0)
 ;
"RTN","PSGSH",12,0)
ENQ ;
"RTN","PSGSH",13,0)
 ;W:$D(^DD(53.1,26,3)) !?3,^(3)
"RTN","PSGSH",14,0)
 D FIELD^DID(53.1,26,"N","HELP-PROMPT","PSJFDESC")
"RTN","PSGSH",15,0)
 I $D(PSJFDESC("HELP-PROMPT")) W PSJFDESC("HELP-PROMPT")
"RTN","PSGSH",16,0)
 ;
"RTN","PSGSH",17,0)
ENSH ;
"RTN","PSGSH",18,0)
 N D,DA,DIC,DIE,DZ,Y
"RTN","PSGSH",19,0)
 I X?1"???".E F Q=1:1 Q:$P($T(HT+Q),";",3)=""  W !?5,$P($T(HT+Q),";",3)
"RTN","PSGSH",20,0)
 I X?1"???".E R !,"(Press RETURN to continue.) ",Q:DTIME W:'$T $C(7) S:'$T Q="^" I Q="^" K:$D(PSGDDFLG) PSGDDFLG,PSGST Q
"RTN","PSGSH",21,0)
 K DIC S DIC="^PS(51.1,",DIC(0)="E",D="APPSJ",DIC("W")="W ""  ""," I $D(PSJPWD),PSJPWD S DIC("W")=DIC("W")_"$S($D(^PS(51.1,+Y,1,PSJPWD,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"
"RTN","PSGSH",22,0)
 E  S DIC("W")=DIC("W")_"$P(^(0),""^"",2)"
"RTN","PSGSH",23,0)
 I $D(PSGST) S DIC("S")="I $P(^(0),""^"",5)"_$E("'",PSGST'="O")_"=""O"""
"RTN","PSGSH",24,0)
 D IX^DIC K DIC K:$D(PSGDDFLG) PSGDDFLG,PSGST Q
"RTN","PSGSH",25,0)
 ;
"RTN","PSGSH",26,0)
 ;
"RTN","PSGSH",27,0)
HT ;
"RTN","PSGSH",28,0)
 ;;  This is the frequency (ONLY) with which the doses are to be administered.
"RTN","PSGSH",29,0)
 ;;Several forms of entry are acceptable, such as Q6H, 09-12-15, STAT, QOD,
"RTN","PSGSH",30,0)
 ;;and MO-WE-FR@AD (where MO-WE-FR are days of the week, and AD is the admin
"RTN","PSGSH",31,0)
 ;;times).  The schedule will show on the MAR, labels, etc.  No more than ONE
"RTN","PSGSH",32,0)
 ;;space (Q3H 4 or Q4H PRN) in the schedule is acceptable.  If the letters PRN
"RTN","PSGSH",33,0)
 ;;are found as part of the schedule, no admin times will print on the MAR or
"RTN","PSGSH",34,0)
 ;;labels, and the PICK LIST will always show a count of zero (0).
"RTN","PSGSH",35,0)
 ;;Avoid using notation such as W/F (with food) or WM (with meals) in the
"RTN","PSGSH",36,0)
 ;;schedule as it may cause erroneous calculations.  That information should
"RTN","PSGSH",37,0)
 ;;be entered into the SPECIAL INSTRUCTIONS.
"RTN","PSGSH",38,0)
 ;;  When using the MO-WE-FR@AD schedule, please remember that this type of
"RTN","PSGSH",39,0)
 ;;schedule will not work properly without the "@" character and at least one
"RTN","PSGSH",40,0)
 ;;admin time, and that at least the first two letters of each weekday entered
"RTN","PSGSH",41,0)
 ;;is needed.
"RTN","PSGVBW")
0^58^B57660299
"RTN","PSGVBW",1,0)
PSGVBW ;BIR/CML3,MV-VERIFY ORDERS BY WARD, WARD GROUP, OR PATIENT ;22 Oct 98 / 3:14 PM
"RTN","PSGVBW",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**5,16,39,59,62,67,58,81,80,110,111**;16 DEC 97
"RTN","PSGVBW",3,0)
 ;
"RTN","PSGVBW",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSGVBW",5,0)
 ;
"RTN","PSGVBW",6,0)
 N PSJNEW,PSGPTMP,PPAGE,CL,CG S PSJNEW=1
"RTN","PSGVBW",7,0)
START ;
"RTN","PSGVBW",8,0)
 D ENCV^PSGSETU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",9,0)
 ;I ($P(PSJSYSU,";")=3)!($P(PSJSYSU,";",3)=2) 
"RTN","PSGVBW",10,0)
 D ^PSIVXU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",11,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSGVBW",12,0)
 I '$D(^XTMP("PSJPVNV")) D
"RTN","PSGVBW",13,0)
 .K DIR S DIR(0)="Y",DIR("A")="Display an Order Summary",DIR("B")="NO"
"RTN","PSGVBW",14,0)
 .S DIR("?",1)="Enter 'YES' to see a summary of orders by type and ward group",DIR("?")="or 'NO' to go directly to patient selection."
"RTN","PSGVBW",15,0)
 .D ^DIR K DIR Q:$D(DIRUT)!$D(DUOUT)  I Y D CNTORDRS^PSGVBWU
"RTN","PSGVBW",16,0)
 K ^TMP("PSJ",$J) S PSGPXN=0 D GTOOP G:$D(DIRUT) DONE L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE
"RTN","PSGVBW",17,0)
 S PSGSSH="VBW",PSGPXN=0,PSJPROT=$S($P(PSJSYSU,";",3)=3:3,$G(PSJRNF):3,$G(PSJIRNF):3,1:1)
"RTN","PSGVBW",18,0)
 S PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING")
"RTN","PSGVBW",19,0)
 F  K ^TMP("PSJSELECT",$J) D ^PSGSEL Q:"^"[PSGSS  F  S (PSGP,WD,WG)=0 S PSGPTMP=0,PPAGE=1 D @PSGSS Q:+Y'>0  D GO
"RTN","PSGVBW",20,0)
 ;
"RTN","PSGVBW",21,0)
DONE ;
"RTN","PSGVBW",22,0)
 K ^TMP("PSGVBW",$J),^TMP("PSJSELECT",$J),^TMP("PSJLIST",$J),^TMP("PSJON",$J)
"RTN","PSGVBW",23,0)
 K CHK,D0,DRGI,FQC,J,ND,ON,PN,PSGODT,PSGOEA,PSGOP,PSGSS,PSGSSH,RB,SD,ST,TM,WD,WDN,WG,PRI,PSJPNV
"RTN","PSGVBW",24,0)
 K PSGODDD,PSGOEORF,PSJORL,PSJORPCL,PSJORTOU,PSJORVP,PSGTOL,PSJTOO,PSGUOW,PSGONV,PX,PSGOEAV,PSGPX,PSGVBWTO,PSGVBWW,PSJOPC,PSGOENOF,PSJPROT,PSJLM
"RTN","PSGVBW",25,0)
 L -^PS(53.45,PSJSYSP) G:(PSGPXN&'$$DEFON^PSGPER1) ^PSGPER1 D ENKV^PSGSETU K ND Q
"RTN","PSGVBW",26,0)
 ;
"RTN","PSGVBW",27,0)
GO ;
"RTN","PSGVBW",28,0)
 I PSGSS'="P" W !,"...a few moments, please..." K ^TMP("PSGVBW",$J) D ARRAY K CHK,ON,PN,RB,SD,TM,WD,WDN,WG,X,Y
"RTN","PSGVBW",29,0)
 I PSGSS'="P",'$D(^TMP("PSGVBW",$J)) W !,$C(7),"NO ",PSGVBWW," ORDERS FOR ",$S(PSGSS="P":"PATIENT",PSGSS="L":"CLINIC GROUP",PSGSS="C":"CLINIC",1:"WARD"),$S(PSGSS="G":" GROUP",1:"")," SELECTED." Q
"RTN","PSGVBW",30,0)
 D ^PSGVBW0 Q
"RTN","PSGVBW",31,0)
 ;
"RTN","PSGVBW",32,0)
 ; look-ups on ward group, ward, or patient; depending on value of SS
"RTN","PSGVBW",33,0)
G ;
"RTN","PSGVBW",34,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD GROUP: "
"RTN","PSGVBW",35,0)
 S DIR("?")="^D GDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",36,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",37,0)
 ;S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select WARD GROUP: "
"RTN","PSGVBW",38,0)
GDIC ;
"RTN","PSGVBW",39,0)
 K DIC S DIC="^PS(57.5,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 WG=+Y
"RTN","PSGVBW",40,0)
 W:X["?" !!,"Enter ""^OTHER"" to include all Outpatient IV orders and orders from the",!,"wards that do not belong to a ward group",!
"RTN","PSGVBW",41,0)
 Q
"RTN","PSGVBW",42,0)
C ;
"RTN","PSGVBW",43,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGVBW",44,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",45,0)
CDIC ;
"RTN","PSGVBW",46,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y
"RTN","PSGVBW",47,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGVBW",48,0)
 Q
"RTN","PSGVBW",49,0)
L ;
"RTN","PSGVBW",50,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGVBW",51,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",52,0)
LDIC ;
"RTN","PSGVBW",53,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y
"RTN","PSGVBW",54,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGVBW",55,0)
 Q
"RTN","PSGVBW",56,0)
W ;
"RTN","PSGVBW",57,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD: "
"RTN","PSGVBW",58,0)
 S DIR("?")="^D WDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",59,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",60,0)
WDIC ;
"RTN","PSGVBW",61,0)
 ;S DIC="^DIC(42,",DIC(0)="QEAMI",DIC("A")="Select WARD: "
"RTN","PSGVBW",62,0)
 K DIC S DIC="^DIC(42,",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 WD=+Y
"RTN","PSGVBW",63,0)
 W:X["?" !!,"Enter ""^OTHER"" for Outpatient IV orders",!
"RTN","PSGVBW",64,0)
 Q
"RTN","PSGVBW",65,0)
P ;
"RTN","PSGVBW",66,0)
 K ^TMP("PSJSELECT",$J) S PSJCNT=1 F  D ^PSJP Q:PSGP<0  D
"RTN","PSGVBW",67,0)
 .S PSJNV=0
"RTN","PSGVBW",68,0)
 .NEW ON,XX F ON=0:0 S ON=$O(^PS(53.1,"AS","N",PSGP,ON)) Q:'ON  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) I XX S PSJNV=1 Q
"RTN","PSGVBW",69,0)
 .;S PSJNV=$O(^PS(53.1,"AS","N",+PSGP,0)),PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",70,0)
 .S PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",71,0)
 .I 'PSJNV D ^PSJAC D
"RTN","PSGVBW",72,0)
 ..I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",73,0)
 ..S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",74,0)
 ..I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD!PSJNV  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  S PSJNV=1 Q
"RTN","PSGVBW",75,0)
 ..I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D" D IFT2 I  S PSJNV=1 Q
"RTN","PSGVBW",76,0)
 .S X=$S(PSJTOO=1:PSJNV,PSJTOO=2:PSJPEN,1:(PSJNV+PSJPEN))
"RTN","PSGVBW",77,0)
 .I X D SETPN S ^TMP("PSJSELECT",$J,PSJCNT)=PN,^TMP("PSJSELECT",$J,"B",$P(PN,U),PSJCNT)="",PSJCNT=PSJCNT+1 Q
"RTN","PSGVBW",78,0)
 .W !,"No ",PSGVBWW," orders found for this patient."
"RTN","PSGVBW",79,0)
 S:$D(^TMP("PSJSELECT",$J)) Y=1
"RTN","PSGVBW",80,0)
 Q
"RTN","PSGVBW",81,0)
 ;
"RTN","PSGVBW",82,0)
ARRAY ; put patient(s) with non-verified orders into array
"RTN","PSGVBW",83,0)
 I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",84,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING") I PSGSS="P" D IF S:$T ^TMP("PSGVBW",$J)=$P(PSGP(0),"^")_"^"_PSGP Q
"RTN","PSGVBW",85,0)
 G CG:PSGSS="L",CL:PSGSS="C",WD:PSGSS="W" F WD=0:0 S WD=$O(^PS(57.5,"AC",WG,WD)) Q:'WD  D WD
"RTN","PSGVBW",86,0)
 Q
"RTN","PSGVBW",87,0)
 ;
"RTN","PSGVBW",88,0)
CG S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D CL
"RTN","PSGVBW",89,0)
 Q
"RTN","PSGVBW",90,0)
CL S WDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGVBW",91,0)
 S PSGP="" F  S PSGP=$O(^PS(53.1,"AD",CL,PSGP)) Q:PSGP=""  D ^PSJAC,IF
"RTN","PSGVBW",92,0)
 Q
"RTN","PSGVBW",93,0)
WD S WDN=$S($D(^DIC(42,WD,0)):$P(^(0),"^"),1:"") I WDN]"" F PSGP=0:0 S PSGP=$O(^DPT("CN",WDN,PSGP)) Q:'PSGP  I $S($O(^PS(55,PSGP,5,"AUS",PSGDT)):1,1:$D(^PS(53.1,"AC",PSGP))) D ^PSJAC,IF
"RTN","PSGVBW",94,0)
 Q
"RTN","PSGVBW",95,0)
IF ;
"RTN","PSGVBW",96,0)
 W "." I PSJTOO'=1 F ON=0:0 S ON=$O(^PS(53.1,"AS","P",PSGP,ON)) Q:'ON  S X=$P($G(^PS(53.1,ON,0)),U,4),Y=0 I "FIU"[X D  G:Y SET
"RTN","PSGVBW",97,0)
 .I PSJPAC=3 S Y=1 Q
"RTN","PSGVBW",98,0)
 .I PSJPAC=2 S Y=X'="U" Q 
"RTN","PSGVBW",99,0)
 .I PSJPAC=1 S Y=X="U"
"RTN","PSGVBW",100,0)
 Q:PSJTOO=2
"RTN","PSGVBW",101,0)
 F X="N","I" I $D(^PS(53.1,"AS",X,PSGP)) NEW XX S XX=0 D  G:XX SET
"RTN","PSGVBW",102,0)
 . NEW ON F ON=0:0 S ON=$O(^PS(53.1,"AS",X,PSGP,ON)) Q:'ON  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) Q:XX
"RTN","PSGVBW",103,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",104,0)
 I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  G SET
"RTN","PSGVBW",105,0)
 I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D" D IFT2 I  G SET
"RTN","PSGVBW",106,0)
 Q
"RTN","PSGVBW",107,0)
 ;
"RTN","PSGVBW",108,0)
IFT ;
"RTN","PSGVBW",109,0)
 S ND=$G(^PS(55,PSGP,5,ON,4)) I $S(SD>PSGDT:$S(ND="":1,'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1)):1,$P(ND,"^",13):1,$P(ND,"^",19):1,$P(ND,"^",23):1,1:$P(ND,"^",16)),ST="O":$S(ND="":1,1:'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1))),1:$P(ND,"^",16))
"RTN","PSGVBW",110,0)
 Q
"RTN","PSGVBW",111,0)
 ;
"RTN","PSGVBW",112,0)
IFT2 ;
"RTN","PSGVBW",113,0)
 ;S ND=$G(^PS(55,PSGP,"IV",ON,4)) I $S((SD>PSGDT)&(ND=""):1,'$P(ND,"^",$S(+PSJSYSU=1:1,1:4)):1,1:0)
"RTN","PSGVBW",114,0)
 S ND=$G(^PS(55,PSGP,"IV",ON,4)) I $S((SD>PSGDT)&('$P(ND,"^",$S(+PSJSYSU=1:1,1:4))):1,1:0)
"RTN","PSGVBW",115,0)
 Q
"RTN","PSGVBW",116,0)
SET ;
"RTN","PSGVBW",117,0)
 S TM=$S(PSJPRB="":"",1:$P($G(^PS(57.7,WD,1,+$O(^PS(57.7,"AWRT",WD,PSJPRB,0)),0)),"^")) S:TM="" TM="zz"
"RTN","PSGVBW",118,0)
 ;
"RTN","PSGVBW",119,0)
SETPN ;
"RTN","PSGVBW",120,0)
 S PN=$P(PSGP(0),"^")_U_PSGP_U_PSJPBID S:PSGSS'="P" ^TMP("PSGVBW",$J,WDN,TM,PN)=""
"RTN","PSGVBW",121,0)
 Q
"RTN","PSGVBW",122,0)
 ;
"RTN","PSGVBW",123,0)
GTOOP ; Get 'Type Of Order' and Package
"RTN","PSGVBW",124,0)
 I $P(PSJSYSU,";",3)<2,'$G(PSJRNF),'$G(PSJIRNF) S PSJPAC=0,PSJTOO=1 D GTPAC Q
"RTN","PSGVBW",125,0)
 S (PSJPAC,PSJTOO)=0 W !!,"1) Non-Verified Orders",!,"2) Pending Orders",!!
"RTN","PSGVBW",126,0)
 N DIR S DIR(0)="LAO^1:2",DIR("A")="Select Order Type(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" D ^DIR
"RTN","PSGVBW",127,0)
 I 'Y D EXIT("TYPE OF ORDER") Q
"RTN","PSGVBW",128,0)
 S PSJTOO=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",129,0)
 D GTPAC
"RTN","PSGVBW",130,0)
 I 'PSJPAC D EXIT("PACKAGE") Q
"RTN","PSGVBW",131,0)
 Q
"RTN","PSGVBW",132,0)
GTPAC ;
"RTN","PSGVBW",133,0)
 ;S PSJTOO=$S($L(Y)>2:3,1:$P(Y,",")) Q:PSJTOO=1
"RTN","PSGVBW",134,0)
 ;I $G(PSJRNF) S PSJPAC=1 Q
"RTN","PSGVBW",135,0)
 I ($G(PSJRNF))&('$G(PSJIRNF))&(PSJTOO=2) S PSJPAC=1 Q
"RTN","PSGVBW",136,0)
 I ($G(PSJIRNF))&('$G(PSJRNF))&(PSJTOO=2) S PSJPAC=2 Q
"RTN","PSGVBW",137,0)
 W !!,"1) Unit Dose Orders",!,"2) IV Orders",!
"RTN","PSGVBW",138,0)
 K DIR S DIR(0)="LAO^1:2",DIR("A")="Select Package(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",139,0)
 S PSJPAC=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",140,0)
 Q
"RTN","PSGVBW",141,0)
EXIT(X) ;
"RTN","PSGVBW",142,0)
 W !!,X," not selected, option terminated."
"RTN","PSGVBW",143,0)
 Q
"RTN","PSGVBW",144,0)
 ;
"RTN","PSGVBW",145,0)
TOH ;
"RTN","PSGVBW",146,0)
 W !!,"SELECT FROM:",!?5,"1 - NON-VERIFIED ORDERS",!?5,"2 - PENDING ORDERS"
"RTN","PSGVBW",147,0)
 W !!?2,"Enter '1' if you want to verify non-verified orders.  Enter '2' if you",!,"want to complete pending orders.  Enter '1,2' or '1-2' if you want to do both." Q
"RTN","PSGVBW1")
0^59^B3427001
"RTN","PSGVBW1",1,0)
PSGVBW1 ;BIR/CML3,MV-NON-VERFIED ORDERS UTILITES ;03 Jul 2003  7:19 AM
"RTN","PSGVBW1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**5,111**;16 DEC 97
"RTN","PSGVBW1",3,0)
 ;
"RTN","PSGVBW1",4,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGVBW1",5,0)
 ;
"RTN","PSGVBW1",6,0)
ENPROF ;
"RTN","PSGVBW1",7,0)
 I +PSJSYSU=1 S PSGOENOF=0 D NOW^%DTC F Q=%:0 S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q  F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $D(^PS(55,PSGP,5,QQ,4)),$P(^(4),"^",10) S PSGOENOF=1 Q
"RTN","PSGVBW1",8,0)
 W !!,$S($P(PSGP(0),"^")]"":$P(PSGP(0),"^"),1:PSGP_";DPT(") W:PSJPBID "  (",PSJPBID,")"
"RTN","PSGVBW1",9,0)
 D ENL^PSGOU Q:PSGOL["^"
"RTN","PSGVBW1",10,0)
 K ZTSAVE S PSGTIR="^PSJAC,^PSGO",ZTDESC="PATIENT PROFILE",PSGPR=1 F X="PSGP","PSGP(0)","PSGPR","PSGOL","PSGPTMP","PPAGE" S ZTSAVE(X)=""
"RTN","PSGVBW1",11,0)
 Q:PSGOL="N"
"RTN","PSGVBW1",12,0)
 D ENDEV^PSGTI K PSGPR Q:POP!$D(IO("Q"))
"RTN","PSGVBW1",13,0)
 S PSGVBW=IO'=IO(0)!($E(IOST)'="C") D ^PSGO D ^%ZISC Q:PSGVBW
"RTN","PSGVBW1",14,0)
PEND K DIR S DIR(0)="E" W ! D ^DIR K DIR Q
"RTN","PSGVBW1",15,0)
 ;
"RTN","PSGVBW1",16,0)
OUTPT ;Set up Outpatient IV for non/ver pending option.
"RTN","PSGVBW1",17,0)
 K ^TMP("PSGVBW",$J)
"RTN","PSGVBW1",18,0)
 NEW PSJSTAT,PSJTOO1,PSJPAC1
"RTN","PSGVBW1",19,0)
 ;I PSJTOO'=2 S PSJSTAT="N" D PSGP
"RTN","PSGVBW1",20,0)
 ;I PSJTOO'=1 S PSJSTAT="P" D PSGP
"RTN","PSGVBW1",21,0)
 S PSJSTAT="N" D PSGP
"RTN","PSGVBW1",22,0)
 S PSJSTAT="P" D PSGP
"RTN","PSGVBW1",23,0)
 D ^PSGVBW0
"RTN","PSGVBW1",24,0)
 S Y=-1
"RTN","PSGVBW1",25,0)
 Q
"RTN","PSGVBW1",26,0)
PSGP ;
"RTN","PSGVBW1",27,0)
 F PSGP=0:0 S PSGP=$O(^PS(53.1,"AS",PSJSTAT,PSGP)) Q:'PSGP  D
"RTN","PSGVBW1",28,0)
 . NEW VAIN S DFN=PSGP D INP^VADPT
"RTN","PSGVBW1",29,0)
 . I '+VAIN(4)!(PSGSS="G"&'$D(^PS(57.5,"AB",+VAIN(4)))) D
"RTN","PSGVBW1",30,0)
 .. ;I PSJSTAT="N",'+VAIN(4) Q
"RTN","PSGVBW1",31,0)
 .. D ^PSJAC S WDN="ZZ" D IF^PSGVBW
"RTN","PSGVBW1",32,0)
 Q
"RTN","PSGVBWU")
0^78^B53189589
"RTN","PSGVBWU",1,0)
PSGVBWU ;BIR/CML3,MV-GET ORDERS FOR COMPLETE/VERIFY ;15 May 98 / 9:26 AM
"RTN","PSGVBWU",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,44,47,67,58,110,111**;16 DEC 97
"RTN","PSGVBWU",3,0)
 ;
"RTN","PSGVBWU",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGVBWU",5,0)
 ;
"RTN","PSGVBWU",6,0)
ECHK(DFN,O,DT,SD) ;
"RTN","PSGVBWU",7,0)
 N OK S OK=0
"RTN","PSGVBWU",8,0)
 I $P($G(^PS(55,DFN,5,O,0)),U,9)'["D" S ND=$G(^(0)) Q:ND="" 0  S ND4=$G(^(4)) D
"RTN","PSGVBWU",9,0)
 .;I "DE"'[$P($G(^PS(55,DFN,5,O,0)),U,9) S ND=$G(^(0)) Q:ND="" 0  S ND4=$G(^(4)) D
"RTN","PSGVBWU",10,0)
 .I $S(SD>PSGDT:$S(ND="":1,'$P(ND4,U,$S(PSJSYSU:PSJSYSU,1:1)):1,$P(ND4,U,13):1,$P(ND4,U,19):1,$P(ND4,U,23):1,1:$P(ND4,U,16)),$P(ND,U,7)="O":$S(ND4="":1,1:'$P(ND4,U,$S(PSJSYSU:PSJSYSU,1:1))),1:$P(ND4,U,16)) S OK=1
"RTN","PSGVBWU",11,0)
 Q OK
"RTN","PSGVBWU",12,0)
ECHK2(DFN,O,DT,SD) ;
"RTN","PSGVBWU",13,0)
 N OK S OK=0
"RTN","PSGVBWU",14,0)
 I $P($G(^PS(55,DFN,"IV",O,0)),U,17)'["D" S ND=$G(^(0)) Q:ND="" 0  S ND4=$G(^(4)) D:SD>PSGDT
"RTN","PSGVBWU",15,0)
 . I (+PSJSYSU=1)&('$P(ND4,U,+PSJSYSU)) S OK=1 Q
"RTN","PSGVBWU",16,0)
 . I (+PSJSYSU=3)&('$P(ND4,U,+PSJSYSU+1)) S OK=1 Q
"RTN","PSGVBWU",17,0)
 Q OK
"RTN","PSGVBWU",18,0)
 ;
"RTN","PSGVBWU",19,0)
SET ;
"RTN","PSGVBWU",20,0)
 I ON["P",$G(PSJCOM)]"",$G(PRNTON)=+PSJCOM Q
"RTN","PSGVBWU",21,0)
 I ON["P",$G(PSJCOM)]"" S PRNTON=+PSJCOM,ON=+PSJCOM
"RTN","PSGVBWU",22,0)
 S PSJPRIO=$S($G(PSJPRIO)="S":"A",1:"Z"),^TMP("PSJON",$J,PSJPRIO,LD_U_ON)=""
"RTN","PSGVBWU",23,0)
 Q
"RTN","PSGVBWU",24,0)
 ;
"RTN","PSGVBWU",25,0)
CNTORDRS ; Display # pending orders by type and ward group
"RTN","PSGVBWU",26,0)
 K ^TMP("PSJ",$J) D:$G(IOST(0)) ENS^%ZISS
"RTN","PSGVBWU",27,0)
 N DFN,DIRUT,ON,TYP,PSGODT,PSJWD,PSJWG,X,X1,X2
"RTN","PSGVBWU",28,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBWU",29,0)
 W !!,"Searching for Pending and Non-Verified orders"
"RTN","PSGVBWU",30,0)
 F STAT="P","N","I" F DFN=0:0 S DFN=$O(^PS(53.1,"AS",STAT,DFN)) Q:'DFN  D
"RTN","PSGVBWU",31,0)
 .W "." S PSJWG=$$WGNM($P($G(^DPT(DFN,.1)),U))
"RTN","PSGVBWU",32,0)
 .F ON=0:0 S ON=$O(^PS(53.1,"AS",STAT,DFN,ON)) Q:'ON  D
"RTN","PSGVBWU",33,0)
 .. N OWG,A
"RTN","PSGVBWU",34,0)
 .. S OWG=PSJWG I PSJWG="ZZ",$D(^PS(53.1,ON,"DSS")) S A=^("DSS"),PSJWG=$$CGNM(A,OWG)
"RTN","PSGVBWU",35,0)
 ..;S TYP=$S(STAT="N"!(STAT="I"):"N",1:$P($G(^PS(53.1,ON,0)),U,4)) D CNTSET(PSJWG,$F("FIUN",TYP)-1)
"RTN","PSGVBWU",36,0)
 ..S TYP=$P($G(^PS(53.1,ON,0)),U,4),OTYP=$S((STAT="P")&(TYP="F"):1,(STAT="P")&(TYP="I"):1,(STAT="P")&(TYP="U"):2,TYP="F":3,TYP="I":3,1:4) D CNTSET(PSJWG,OTYP) S PSJWG=OWG
"RTN","PSGVBWU",37,0)
 ;
"RTN","PSGVBWU",38,0)
 I '$D(^XTMP("PSJPVNV")) D
"RTN","PSGVBWU",39,0)
 .N PSJXR S PSJXR=$S(+PSJSYSU=3:"APV",1:"ANV") F DFN=0:0 S DFN=$O(^PS(55,PSJXR,DFN)) Q:'DFN  D
"RTN","PSGVBWU",40,0)
 ..W "." D IN5^VADPT S PSJPAD=+VAIP(3) K VAIP F PSGORD=0:0 S PSGORD=$O(^PS(55,PSJXR,DFN,PSGORD)) Q:'PSGORD  D
"RTN","PSGVBWU",41,0)
 ...S PSGST=$P($G(^PS(55,DFN,5,PSGORD,0)),U,7),PSGFD=$P($G(^(2)),U,4) I ((PSGST="O")&(PSJPAD>0)&(PSGFD>PSJPAD))!((PSGST'="O")&(PSGFD'<PSGODT)) I $$ECHK(DFN,PSGORD,PSGDT,PSGFD) S PSJWD=$P($G(^DPT(DFN,.1)),U) I PSJWD]"" D
"RTN","PSGVBWU",42,0)
 ....S PSJWG=$$WGNM(PSJWD)
"RTN","PSGVBWU",43,0)
 .... N OWG,A
"RTN","PSGVBWU",44,0)
 .... S OWG=PSJWG I PSJWG="ZZ",$D(^PS(55,DFN,5,PSGORD,8)) S A=^(8),PSJWG=$$CGNM(A,OWG)
"RTN","PSGVBWU",45,0)
 .... D CNTSET(PSJWG,4) S PSJWG=OWG
"RTN","PSGVBWU",46,0)
 .N PSJXR S PSJXR=$S(+PSJSYSU=3:"APIV",1:"ANIV") F DFN=0:0 S DFN=$O(^PS(55,PSJXR,DFN)) Q:'DFN  D
"RTN","PSGVBWU",47,0)
 ..W "." D IN5^VADPT S PSJPAD=+VAIP(3) K VAIP F PSGORD=0:0 S PSGORD=$O(^PS(55,PSJXR,DFN,PSGORD)) Q:'PSGORD  D
"RTN","PSGVBWU",48,0)
 ...S PSGFD=$P($G(^PS(55,DFN,"IV",PSGORD,0)),U,3) I $$ECHK2(DFN,PSGORD,PSGDT,PSGFD) S PSJWD=$P($G(^DPT(DFN,.1)),U) I PSJWD]"" D
"RTN","PSGVBWU",49,0)
 ....S PSJWG=$$WGNM(PSJWD)
"RTN","PSGVBWU",50,0)
 .... N OWG,A
"RTN","PSGVBWU",51,0)
 .... S OWG=PSJWG I PSJWG="ZZ",$D(^PS(55,DFN,"IV",PSGORD,"DSS")) S A=^("DSS"),PSJWG=$$CGNM(A,OWG)
"RTN","PSGVBWU",52,0)
 .... D CNTSET(PSJWG,3) S PSJWG=OWG
"RTN","PSGVBWU",53,0)
 I $D(^XTMP("PSJPVNV")) S PSJWD="" F  S PSJWD=$O(^DPT("CN",PSJWD)) Q:PSJWD=""  S PSJWG=$$WGNM(PSJWD) F DFN=0:0 S DFN=$O(^DPT("CN",PSJWD,DFN)) Q:'DFN  D
"RTN","PSGVBWU",54,0)
 .; removed ref to ^DGPM
"RTN","PSGVBWU",55,0)
 .;S PSJPAD=9999999.9999999-$O(^DGPM("ATID1",DFN,0))
"RTN","PSGVBWU",56,0)
 .D IN5^VADPT S PSJPAD=+VAIP(3) K VAIP
"RTN","PSGVBWU",57,0)
 .W "."
"RTN","PSGVBWU",58,0)
 .F PSJST="C","O","OC","P","R" F PSGFD=$S(PSJST="O":PSJPAD,1:PSGODT):0 S PSGFD=$O(^PS(55,DFN,5,"AU",PSJST,PSGFD)) Q:'PSGFD  D
"RTN","PSGVBWU",59,0)
 ..F PSGORD=0:0 S PSGORD=$O(^PS(55,DFN,5,"AU",PSJST,PSGFD,PSGORD)) Q:'PSGORD  I $$ECHK(DFN,PSGORD,PSGDT,PSGFD) D
"RTN","PSGVBWU",60,0)
 ... N OWG,A
"RTN","PSGVBWU",61,0)
 ... S OWG=PSJWG I PSJWG="ZZ",$D(^PS(55,DFN,"IV",PSGORD,"DSS")) S A=^("DSS"),PSJWG=$$CGNM(A,OWG)
"RTN","PSGVBWU",62,0)
 ... D CNTSET(PSJWG,3) S PSJWG=OWG
"RTN","PSGVBWU",63,0)
 .F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,"IV","AIS",SD,O)) Q:'O  S ON=O_"V" I $$ECHK2(PSGP,O,PSGDT,SD) D
"RTN","PSGVBWU",64,0)
 .. N OWG,A
"RTN","PSGVBWU",65,0)
 .. S OWG=PSJWG I PSJWG="ZZ",$D(^PS(55,DFN,"IV",PSGORD,"DSS")) S A=^("DSS"),PSJWG=$$CGNM(A,OWG)
"RTN","PSGVBWU",66,0)
 .. D CNTSET(PSJWG,3) S PSJWG=OWG
"RTN","PSGVBWU",67,0)
 ;
"RTN","PSGVBWU",68,0)
DISPLAY ;
"RTN","PSGVBWU",69,0)
 N H,I
"RTN","PSGVBWU",70,0)
 D CNTHEAD I '$D(^TMP("PSJ",$J)) W ?21,"No pending/non-verified orders found.",! Q
"RTN","PSGVBWU",71,0)
 S H("WG")="Ward Groups",H("CG")="Clinic Groups",H("C")="Clinics"
"RTN","PSGVBWU",72,0)
 F I="WG","CG","C" I $D(^TMP("PSJ",$J,I)) D
"RTN","PSGVBWU",73,0)
 . W !,H(I),!!
"RTN","PSGVBWU",74,0)
 . S WG="" F  S WG=$O(^TMP("PSJ",$J,I,WG)) Q:WG=""!$D(DIRUT)  S X=$G(^(WG)) D
"RTN","PSGVBWU",75,0)
 .. ;W $S(WG="ZZ":"^OTHER",1:WG),?30,$J(+X,6),?44,$J(+$P(X,U,2),6),?58,$J(+$P(X,U,3),6),?72,$J(+$P(X,U,4),6),!
"RTN","PSGVBWU",76,0)
 .. W $S(WG="ZZ":"^OTHER",1:WG),?26,$J(+X,6),?36,$J(+$P(X,U,2),6),?51,$J(+$P(X,U,3),6),?63,$J(+$P(X,U,4),6),!
"RTN","PSGVBWU",77,0)
 .. I $Y>(IOSL-2) N DIR S DIR(0)="E" D ^DIR Q:$D(DIRUT)  D CNTHEAD
"RTN","PSGVBWU",78,0)
 Q
"RTN","PSGVBWU",79,0)
CNTSET(WG,X) ; Update counters for ward group totals
"RTN","PSGVBWU",80,0)
 ; Input: WG - Ward Group IEN
"RTN","PSGVBWU",81,0)
 ;         X - piece identifying order type.
"RTN","PSGVBWU",82,0)
 I $P(WG,"^",2)="" S $P(^TMP("PSJ",$J,"WG",WG),U,X)=$P($G(^TMP("PSJ",$J,"WG",WG)),U,X)+1 Q
"RTN","PSGVBWU",83,0)
 I $P(WG,"^",2)]"" S $P(^TMP("PSJ",$J,$P(WG,"^",2),$P(WG,"^")),U,X)=$P($G(^TMP("PSJ",$J,$P(WG,"^",2),$P(WG,"^"))),U,X)+1 Q
"RTN","PSGVBWU",84,0)
 Q
"RTN","PSGVBWU",85,0)
 ;
"RTN","PSGVBWU",86,0)
WGNM(WD) ; DETERMINE WARD GROUP NAME
"RTN","PSGVBWU",87,0)
 N WG
"RTN","PSGVBWU",88,0)
 I WD]"" S WG=+$O(^PS(57.5,"AB",+$O(^DIC(42,"B",WD,0)),0)),WG=$P($G(^PS(57.5,WG,0)),U)
"RTN","PSGVBWU",89,0)
 S:$G(WG)="" WG="ZZ"
"RTN","PSGVBWU",90,0)
 Q WG
"RTN","PSGVBWU",91,0)
 ;
"RTN","PSGVBWU",92,0)
CGNM(A,WGN) ;DETERMINE CLINIC GROUP NAME
"RTN","PSGVBWU",93,0)
 N CGN,B
"RTN","PSGVBWU",94,0)
 ;I $P(A,"^",2)="" Q WGN
"RTN","PSGVBWU",95,0)
 S CGN="",B=$O(^PS(57.8,"AC",+A,"")) I B]"" S CGN=$P(^PS(57.8,B,0),"^")_"^CG"
"RTN","PSGVBWU",96,0)
 I $P(CGN,"^")="" S CGN=$P(^SC(+A,0),"^")_"^C"
"RTN","PSGVBWU",97,0)
 Q CGN
"RTN","PSGVBWU",98,0)
 ;
"RTN","PSGVBWU",99,0)
CNTHEAD ; Header for order count.
"RTN","PSGVBWU",100,0)
 ;W @IOF,!,?16,"Pending/Non-Verified Order Totals by Ward Group",!!,?29,"Pending",?43,"Pending",?57,"Pending",!
"RTN","PSGVBWU",101,0)
 ;W "Ward Group",?30,"Fluids",?48,"IV",?55,"Unit Dose",?66,"Non-Verified",!!
"RTN","PSGVBWU",102,0)
 W @IOF,!,?16,"Pending/Non-Verified Order Totals by Ward Group/Clinic Location",!!,?33,"Pending",?56,"Non-Verified",!
"RTN","PSGVBWU",103,0)
 W "Ward Group/Clinic Location",?30,"IV",?40,"UD",?55,"IV",?67,"UD",!
"RTN","PSGVBWU",104,0)
 Q
"RTN","PSGVBWU",105,0)
 ;
"RTN","PSGVBWU",106,0)
ENGORD ; get and sort order
"RTN","PSGVBWU",107,0)
 N PSJCOM,PRNTON
"RTN","PSGVBWU",108,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12),X1=$P(%,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),HDT=$$ENDTC^PSGMI(PSGDT),UDU=$P(PSJSYSU,";",3)>1 K ^TMP("PSJON",$J)
"RTN","PSGVBWU",109,0)
 W !!,"...a few moments, please..."
"RTN","PSGVBWU",110,0)
 I PSJTOO'=2 F PSGO2=+PSJPAD:0 S PSGO2=$O(^PS(55,PSGP,5,"AUS",PSGO2)) Q:'PSGO2  Q:PSGO2>PSGDT  F PSGO3=0:0 S PSGO3=$O(^PS(55,PSGP,5,"AUS",PSGO2,PSGO3)) Q:'PSGO3  I $D(^PS(55,PSGP,5,PSGO3,0)) S PSGO4=^(0) I "DEH"'[$E($P(PSGO4,"^",9)) D ENUH
"RTN","PSGVBWU",111,0)
 K PSGO1,PSGO2,PSGO3,PSGO4
"RTN","PSGVBWU",112,0)
 I PSJTOO'=1 F SD="I","P" F O=0:0 S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  D
"RTN","PSGVBWU",113,0)
 .S ND=$G(^PS(53.1,O,0)),PSJPRIO=$P($G(^(.2)),U,4),PSJCOM=$P($G(^(.2)),U,8),LD=$P($G(^PS(53.1,O,0)),U,16),ON=O_"P"
"RTN","PSGVBWU",114,0)
 .I $S(PSJPAC=3:1,PSJPAC=1&($P(ND,U,4)="U"):1,PSJPAC=2&($P(ND,U,4)'="U"):1,+$P(ND,U,13)&$G(PSJRNF):1,+$P(ND,U,13)&$G(PSJIRNF):1,1:0) D SET
"RTN","PSGVBWU",115,0)
 Q:PSJTOO=2
"RTN","PSGVBWU",116,0)
 F ST="C","O","OC","P","R" F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,5,"AU",ST,SD,O)) Q:'O  S ON=O_"U" I $$ECHK(PSGP,O,PSGDT,SD) S LD=$P($G(^PS(55,PSGP,5,O,0)),U,16) D SET
"RTN","PSGVBWU",117,0)
 F O=0:0 S O=$O(^PS(53.1,"AS","N",PSGP,O)) Q:'O  S LD=$P($G(^PS(53.1,O,0)),U,16),PSJCOM=$P($G(^(.2)),U,8) S ON=O_"P" D SET
"RTN","PSGVBWU",118,0)
 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,"IV","AIS",SD,O)) Q:'O  S ON=O_"V" I $$ECHK2(PSGP,O,PSGDT,SD) S LD=$P($G(^PS(55,PSGP,"IV",O,2)),U) D SET
"RTN","PSGVBWU",119,0)
 Q
"RTN","PSGVBWU",120,0)
 ;
"RTN","PSGVBWU",121,0)
ENUH ;
"RTN","PSGVBWU",122,0)
 S $P(^PS(55,PSGP,5,PSGO3,0),"^",9)="E" D EN1^PSJHL2(PSGP,"SC",PSGO3_"U")
"RTN","PSGVBWU",123,0)
 Q
"RTN","PSGVBWU",124,0)
GOTOP ; Skip to a specific patient in list.
"RTN","PSGVBWU",125,0)
 I '$$HIDDEN^PSJLMUTL("JUMP") S VALMBCK="R" Q
"RTN","PSGVBWU",126,0)
 K PSJGOTO,DIR S DIR(0)="SM^J:Jump to a specific patient;E:Exit",DIR("A")="Select Action: ",DIR("B")="Exit" D ^DIR
"RTN","PSGVBWU",127,0)
 Q:"JE"'[Y
"RTN","PSGVBWU",128,0)
 I Y="E" S PSJGOTO=Y Q
"RTN","PSGVBWU",129,0)
 K DIR S DIR(0)="PO^2:AEMQZ",DIR("S")="I $P(^(0),U)]"""",$D(^TMP(""PSJSELECT"",$J,""B"",$P(^(0),U)))",DIR("??")="^D GOTOPH^PSGVBWU" D ^DIR I Y<0 S PSGTOTO=Y Q
"RTN","PSGVBWU",130,0)
 S VALMBCK="R",PSJGOTO=$S($P(Y,U,2)="":"E",1:$O(^TMP("PSJSELECT",$J,"B",$P(Y,U,2),0)))
"RTN","PSGVBWU",131,0)
 Q
"RTN","PSGVBWU",132,0)
 ;
"RTN","PSGVBWU",133,0)
GOTOPH ;
"RTN","PSGVBWU",134,0)
 F X=0:0 S X=$O(^TMP("PSJSELECT",$J,X)) Q:'X  W !,$P($G(^TMP("PSJSELECT",$J,X)),U) I X#IOSL=0 N DIR S DIR(0)="E" D ^DIR Q:$D(DIRUT)
"RTN","PSGVBWU",135,0)
 Q
"RTN","PSGVBWU",136,0)
 Q
"RTN","PSIVCAL")
0^72^B54669382
"RTN","PSIVCAL",1,0)
PSIVCAL ;BIR/RGY,PR-CALCULATES START AND STOP DATES ;12 Mar 99 / 12:42 PM
"RTN","PSIVCAL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,26,41,47,63,67,69,58,94,80,110,111**;16 DEC 97
"RTN","PSIVCAL",3,0)
 ;
"RTN","PSIVCAL",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSIVCAL",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVCAL",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSIVCAL",7,0)
 ;
"RTN","PSIVCAL",8,0)
ENT ;NEEDS PSIVTYPE (P(4))
"RTN","PSIVCAL",9,0)
 I $G(PSJREN) D  Q:P(2)
"RTN","PSIVCAL",10,0)
 . I $G(P("OLDON")) N P2 S P2=$G(@("^PS(55,"_DFN_",""IV"","_+P("OLDON")_",0)")),P2=$P(P2,"^",2) I P2 S P(2)=P2
"RTN","PSIVCAL",11,0)
 I $G(PSJORD)["P",$G(P("APPT"))?7N1"."1.N S START=$$DATE2^PSJUTL2(P("APPT")) G Q
"RTN","PSIVCAL",12,0)
 I $G(PSJSYSW0)=""!($P(PSJSYSW0,U,5)=2) S START=+$E(P("LOG"),1,12) G Q
"RTN","PSIVCAL",13,0)
 ;I $G(P("RES"))="R" N PSIVAC S PSIVAC="PR" D ENAD I PSIVADM S P(2)=PSIVADM Q
"RTN","PSIVCAL",14,0)
 S PSIVSN=+P("IVRM"),START="",PSIVTYPE=$G(P(4)) Q:PSIVTYPE=""
"RTN","PSIVCAL",15,0)
 N PSIV X $S($E(PSIVAC)="C":"S X=+$E(P(""LOG""),1,12) D H^%DTC S PSIV=%T",1:"S PSIV=$P($H,"","",2)") G T2:PSIVTYPE'["P"&('P(5))
"RTN","PSIVCAL",16,0)
 I P(11)']"" X $S($E(PSIVAC)="C":"S Y=+$E(P(""LOG""),1,12)",1:"D NOW^%DTC S Y=%") S Y=Y+.007\.01/100 S:'$P(Y,".",2) Y=$$MDNGHT(Y) X ^DD("DD") S START=Y G Q
"RTN","PSIVCAL",17,0)
 S X=P(11) D CHK S PX=Y,X1=PSIV\3600,X2=PSIV#3600\60,X=$E(".0",1,$L(X1)#2+1)_X1_$E("0",X2<10)_X2,START=$S($E(PSIVAC)="C":$P(P("LOG"),"."),1:"T")
"RTN","PSIVCAL",18,0)
 S X1=$P(PX,"-"),X1=$E(".0",1,$L(X1)#2+1)_X1,X2=$P(PX,"-",PSGCNT),X2=$E(".0",1,$L(X2)#2+1)_X2
"RTN","PSIVCAL",19,0)
 S NAT=+$P($G(^PS(59.6,+$O(^PS(59.6,"B",+VAIN(4),0)),0)),U,5)
"RTN","PSIVCAL",20,0)
 I '$D(PSGDT) S PSGDT=$$DATE^PSJUTL2()
"RTN","PSIVCAL",21,0)
 I X<X1,'NAT S START=$$ENSD^PSGNE3(P(9),P(11),+$E(P("LOG"),1,12),PSGDT) G Q
"RTN","PSIVCAL",22,0)
 I X>X2 S START=$$ENSD^PSGNE3(P(9),P(11),+$E(P("LOG"),1,12),PSGDT) G Q
"RTN","PSIVCAL",23,0)
T6 F I=2:1:PSGCNT S X1="."_$P(PX,"-",I-1),X2="."_$P(PX,"-",I) Q:+X1<X&(+X2>X)
"RTN","PSIVCAL",24,0)
 S X1=X-X1,X2=$S(NAT:0,1:X2-X),START=$S(X1<X2:$P(PX,"-",I-1),1:$P(PX,"-",I)) S:START="" START=$P(PX,"-") X $S($E(PSIVAC)="C":"S Y=$P(P(""LOG""),""."") X ^DD(""DD"") S PSIV=Y",1:"S PSIV=""TODAY""") S START=PSIV_"@"_$E("0",$L(START)=3)_START G Q
"RTN","PSIVCAL",25,0)
T2 S X=+("."_$E(10000+(PSIV\3600*100)+(PSIV#3600\60),2,5)),START=$O(^PS(59.5,PSIVSN,3,"AT",X)) S:'START START=$O(^(0)),PSIVTOM=1 I 'START S START=X K PSIVTOM
"RTN","PSIVCAL",26,0)
 S START=$S($E(PSIVAC)="C":$P(P("LOG"),"."),1:DT)_START I $D(PSIVTOM) S X1=$S($E(PSIVAC)="C":$P(P("LOG"),"."),1:DT),X2=1 D C^%DTC S Y=$P(X,".")_START K PSIVTOM
"RTN","PSIVCAL",27,0)
 S X=START,%DT="XRTX" D ^%DT
"RTN","PSIVCAL",28,0)
Q ;
"RTN","PSIVCAL",29,0)
 I START["@" S X=START,%DT="RTX" D ^%DT S START=+Y
"RTN","PSIVCAL",30,0)
 S P(2)=START
"RTN","PSIVCAL",31,0)
 I $G(PSJORD)["P" D:'$G(PSGRDTX(+PSJORD,"PSGSD")) REQDT^PSJLIVMD(PSJORD) S START=$G(PSGRDTX(+PSJORD,"PSGSD")) S P(2)=$S(START:START,1:P(2))
"RTN","PSIVCAL",32,0)
 K NAT,START,PSIVTYPE,PSIVSTRT,PSGCNT,X1,X2,PX
"RTN","PSIVCAL",33,0)
 Q
"RTN","PSIVCAL",34,0)
CHK F Y=1:1 Q:$L(X)>240!($P(X,"-",Y)="")  S $P(X,"-",Y)=$P(X,"-",Y)_$E("0000",1,4-$L($P(X,"-",Y)))
"RTN","PSIVCAL",35,0)
 S Y=X,PSGCNT=$L(X,"-") S:X]""&(PSGCNT<1) PSGCNT=1 Q
"RTN","PSIVCAL",36,0)
 ;
"RTN","PSIVCAL",37,0)
ENSTOP ; WILL CALCULATE STOP DATE FOR ORDER
"RTN","PSIVCAL",38,0)
 ;NEEDS (DFN) & ON
"RTN","PSIVCAL",39,0)
 N WALL,P3,ADX,DDLX,OIX,DRGT,PSIDAY S (WALL,P3,PSIDAY)=0
"RTN","PSIVCAL",40,0)
 D:'$G(PSIVSITE) ^PSIVSET  Q:'P(2)
"RTN","PSIVCAL",41,0)
 I P(23)'="" S PSIVTYPE="C"
"RTN","PSIVCAL",42,0)
 S STOP="",X="",PSIVSTRT=P(2),PSIVTYPE=$G(P(4)) I $G(PSJREN) D
"RTN","PSIVCAL",43,0)
 . N RDT I $G(ON)["P" S RDT=+$$LASTREN^PSJLMPRI(DFN,ON)
"RTN","PSIVCAL",44,0)
 . S PSIVSTRT=$$DATE2^PSJUTL2($S($G(RDT):RDT,1:$G(PSGDT)))
"RTN","PSIVCAL",45,0)
 I $S("^NOW^STAT^ONCE^ONE-TIME^ONE TIME^ONETIME^1TIME^1-TIME^1 TIME^"[(U_P(9)_U):1,1:0),PSIVTYPE="P"!P(5)!(P(23)="P") S X=$$ENOSD^PSJDCU(PSJSYSW0,PSIVSTRT,DFN) I X]"" S:P(11)=""&($G(ON)["P") PSIVCAL=1 G END
"RTN","PSIVCAL",46,0)
 N DUR,DURMIN I $G(PSJORD)["V" S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,"IV",1) I DUR]"" S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN D  G END
"RTN","PSIVCAL",47,0)
 . S X=$$FMADD^XLFDT(PSIVSTRT,,,DURMIN)
"RTN","PSIVCAL",48,0)
 I $G(PSJORD)["P"!($G(PSJORD)["V") N PSIVLIM,MINS,LIM S PSIVLIM=$$GETLIM(DFN,PSJORD) I PSIVLIM]"" S MINS=$$GETMIN(PSIVLIM,DFN,PSJORD) I MINS S X=$$FMADD^XLFDT(PSIVSTRT,,,MINS) G END
"RTN","PSIVCAL",49,0)
 I $P(PSIVSITE,"^",5) D
"RTN","PSIVCAL",50,0)
 . N Z S Y=0
"RTN","PSIVCAL",51,0)
 . F  S Y=$O(^PS(55,DFN,"IV",Y)) Q:'Y  S Z=^(Y,0) D  Q:X]""
"RTN","PSIVCAL",52,0)
 .. I $P(Z,"^",17)="A",$$ONE^PSJBCMA(DFN,Y_"V",$P(Z,"^",9))'="O" S X=$P(Z,"^",3) Q
"RTN","PSIVCAL",53,0)
 S:X WALL=X
"RTN","PSIVCAL",54,0)
 S PSIDAY=$S(PSIVTYPE="A":$P(PSIVSITE,"^",4),PSIVTYPE="H":$P(PSIVSITE,"^",17),PSIVTYPE="P":$P(PSIVSITE,"^",18),PSIVTYPE="S":$P(PSIVSITE,"^",20),1:$P(PSIVSITE,"^",21))
"RTN","PSIVCAL",55,0)
 S PSJDAY="" D  I PSJDAY]"",PSJDAY<PSIDAY S PSIDAY=PSJDAY
"RTN","PSIVCAL",56,0)
 . N A,B
"RTN","PSIVCAL",57,0)
 . Q:'$D(PSJORD)  S A=""
"RTN","PSIVCAL",58,0)
 . I PSJORD["P" S A=$G(^PS(53.1,+PSJORD,"DSS"))
"RTN","PSIVCAL",59,0)
 . I PSJORD["U" S A=$G(^PS(55,PSGP,5,+PSJORD,8))
"RTN","PSIVCAL",60,0)
 . I PSJORD["I" S A=$G(^PS(55,PSGP,"IV",+PSJORD,"DSS"))
"RTN","PSIVCAL",61,0)
 . S A=$P(A,"^") Q:A=""  I $D(^PS(53.46,"B",A)) S B=$O(^PS(53.46,"B",A,"")),PSJDAY=$P(^PS(53.46,B,0),"^",2)
"RTN","PSIVCAL",62,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  I $P(^PS(52.6,+$P(DRG("AD",+X),U),0),"^",4),($P(^(0),"^",4))<+PSIDAY S PSIDAY=$P(^(0),"^",4)
"RTN","PSIVCAL",63,0)
 I WALL,($$FMADD^XLFDT(PSIVSTRT,PSIDAY,"D"))>WALL S PSIDAY=$$FMDIFF^XLFDT(WALL,PSIVSTRT,1) S:PSIDAY<1 PSIDAY=""
"RTN","PSIVCAL",64,0)
 S DRGT=$S($D(DRG("AD")):"AD",1:"SOL") F ADX=0:0 S ADX=$O(DRG(DRGT,ADX)) Q:'ADX!($G(DRGTMP)&($G(DRGTN)["AD")&(DRGT="SOL"))  D
"RTN","PSIVCAL",65,0)
 . I DRGT="AD",+$P(^PS(52.6,$P(DRG(DRGT,+ADX),U),0),"^",4),(+$P(^(0),"^",4))<+Y S Y=$P(^(0),"^",4)
"RTN","PSIVCAL",66,0)
 . S OIX=+$P(DRG(DRGT,ADX),"^",6),DDLX=$P(^PS(50.7,OIX,0),"^",5) Q:'DDLX  D DDLIM(.PSIDAY,.P3)
"RTN","PSIVCAL",67,0)
 I '$G(DRG("AD",0)),$G(DRGTMP),($G(DRGTN)["SOL") S OIX=$P($G(DRGTMP),"^",6) I OIX S DDLX=$P(^PS(50.7,OIX,0),"^",5) I DDLX  D DDLIM(.PSIDAY,.P3)
"RTN","PSIVCAL",68,0)
 I $G(P3),$G(P(2)) I P3>P(2) S X=P3 G END
"RTN","PSIVCAL",69,0)
 S:'PSIDAY PSIDAY=1
"RTN","PSIVCAL",70,0)
TIME S X2=PSIDAY,X1=PSIVSTRT D C^%DTC S X=$P(X,"."),X=X_$S($P(PSIVSITE,"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14))
"RTN","PSIVCAL",71,0)
END ;
"RTN","PSIVCAL",72,0)
 S P(3)=+X
"RTN","PSIVCAL",73,0)
 I $G(PSJORD)["P" D:'$G(PSGRDTX(+PSJORD,"PSGFD")) REQDT^PSJLIVMD(PSJORD) S P(3)=$S($G(PSGRDTX(+PSJORD,"PSGFD")):PSGRDTX(+PSJORD,"PSGFD"),1:P(3))
"RTN","PSIVCAL",74,0)
 S P(3)=$$DATE2^PSJUTL2(P(3)),P(2)=$$DATE2^PSJUTL2(P(2))
"RTN","PSIVCAL",75,0)
 Q
"RTN","PSIVCAL",76,0)
 ;
"RTN","PSIVCAL",77,0)
ENAD ;Will get last admin. time for order (needs dfn and on)
"RTN","PSIVCAL",78,0)
 N P4,PSIVX,PSIVY
"RTN","PSIVCAL",79,0)
 I $P(PSJSYSW0,U,5)=2 S PSIVADM=$$DATE^PSJUTL2() Q
"RTN","PSIVCAL",80,0)
 I $S($G(PSIVAC)["R":1,P(9)="QOD":1,1:P(9)?1"Q".N1"D") S PSIVADM=$$ENSD^PSGNE3(P(9),P(11),+$E(P("LOG"),1,12),+$P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,2)) Q:PSIVADM
"RTN","PSIVCAL",81,0)
 S PSIVX=X,PSIVY=Y,P4=P(4) S:P(4)="C" P4=P(23) S:P4="S" P4=$S(P(5):"P",1:"A") D NOW^%DTC S Y=%,PSIVNOW=Y I (P4="P"&(P(11)="")&'P(15))!("HA"[P4&'P(15)) S Y=Y+.007\.01/100 G QAD
"RTN","PSIVCAL",82,0)
 D P:P4="P"&('P(15)),AH:P(15)
"RTN","PSIVCAL",83,0)
QAD ;
"RTN","PSIVCAL",84,0)
 S:'$D(PSGSA) PSGSA=""
"RTN","PSIVCAL",85,0)
 S PSIVSD=Y I Y S OD=$L(PSGSA," ") I OD>2 S X=+PSGSA\1 F OD1=2:1:OD-1 I $P(PSGSA," ",OD1)'>$S(OD1>2:$P(PSGSA," ",OD1-1),1:PSGSA#1) S X1=X,X2=1 D C^%DTC
"RTN","PSIVCAL",86,0)
 I PSIVSD,OD>2 S Y=X_PSIVSD
"RTN","PSIVCAL",87,0)
 S PSIVADM=+Y,X=PSIVX,Y=PSIVY K PSGSA,PSIVSD,OD,OD1,PSIVMI,PSIVNOW S:PSIVADM<P(2) PSIVADM=P(2) Q
"RTN","PSIVCAL",88,0)
 ;
"RTN","PSIVCAL",89,0)
P S CD=PSIVNOW,PSGSA="",(PSIVSD,OD)=DT_.0001,X=P(11) D CHK S P(11)=X D ENP4^PSIVWL
"RTN","PSIVCAL",90,0)
 I PSGSA="" S PSIVSD=DT_.0001,PSIVMIN=-1440 D ENT^PSIVWL S $P(Y,".",2)=$P(P(11),"-",$L(P(11),"-")) Q
"RTN","PSIVCAL",91,0)
 S Y=$P(PSGSA," ",$L(PSGSA," ")-1) Q
"RTN","PSIVCAL",92,0)
AH F PSIVADM=0:-1 S CD=PSIVNOW,(X,X1)=DT,X2=PSIVADM D:X2 C^%DTC S X=$P(X,".") S (OD1,PSIVSD,OD)=X_.0001,PSIVMIN=P(15) D ENP3^PSIVWL Q:PSIVADM<-4!(PSGSA]"")
"RTN","PSIVCAL",93,0)
 S Y=$P(PSGSA," ",$L(PSGSA," ")-1) Q
"RTN","PSIVCAL",94,0)
MDNGHT(Y)          ;Sets Start Date/Time on orders placed between midnight and 12:30
"RTN","PSIVCAL",95,0)
 S Y=$$FMADD^XLFDT(Y,-1,0,0,0),Y=$P(Y,".")_".24" Q Y
"RTN","PSIVCAL",96,0)
 ;
"RTN","PSIVCAL",97,0)
DDLIM(PSIVDUR,STPDT) ;  
"RTN","PSIVCAL",98,0)
 N P3
"RTN","PSIVCAL",99,0)
 I DDLX["D" D  Q:(STPDT=0)
"RTN","PSIVCAL",100,0)
 . I +DDLX'<+PSIVDUR S STPDT=0 Q
"RTN","PSIVCAL",101,0)
 . S PSIVDUR=+DDLX,X2=PSIVDUR,X1=PSIVSTRT D C^%DTC S X=$P(X,"."),X=X_$S($P(PSIVSITE,"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14)) I X>P(2) S P(3)=X
"RTN","PSIVCAL",102,0)
 I DDLX["L",($G(P(9))]""),$G(P(15)),("AH"'[PSIVTYPE) D
"RTN","PSIVCAL",103,0)
 . Q:'$G(P(2))!'$G(OIX)  N FIRST,DOSAR,LAST,NEWDUR
"RTN","PSIVCAL",104,0)
 . S STRING=P(2)_"^"_$S($G(STPDT):STPDT,1:$$FMADD^XLFDT(PSGDT,30))_"^"_P(9)_"^C^"_OIX S FIRST=$$ENQ^PSJORP2(DFN,STRING)
"RTN","PSIVCAL",105,0)
 . S FIRST=$S($G(FIRST):FIRST,1:P(2)) Q:'FIRST  S DSTMP=FIRST,DOSAR(1)=DSTMP F I=2:1:DDLX+1 S DOSAR(I)=$$FMADD^XLFDT(DSTMP,,,P(15)),DSTMP=DOSAR(I)
"RTN","PSIVCAL",106,0)
 . I $D(DOSAR) S LAST=$O(DOSAR(""),-1) I LAST S LAST=DOSAR(LAST) I LAST>P(2) S NEWDUR=$$FMDIFF^XLFDT(LAST,P(2)) I NEWDUR<PSIVDUR S P(3)=LAST
"RTN","PSIVCAL",107,0)
 S P(3)=$$DATE2^PSJUTL2(P(3)),P(2)=$$DATE2^PSJUTL2(P(2)) S STPDT=P(3)
"RTN","PSIVCAL",108,0)
 Q
"RTN","PSIVCAL",109,0)
 ;
"RTN","PSIVCAL",110,0)
GETLIM(DFN,PSJORD) ;
"RTN","PSIVCAL",111,0)
 N ND2P5,F
"RTN","PSIVCAL",112,0)
 S F=$S(PSJORD["P":"^PS(53.1,+PSJORD,",PSJORD["V":"^PS(55,DFN,""IV"",+PSJORD,",1:"")
"RTN","PSIVCAL",113,0)
 S ND2P5=$G(@(F_"2.5)")) S LIM=$P(ND2P5,"^",4) Q:LIM="" 0
"RTN","PSIVCAL",114,0)
 S ND0=$G(@(F_"0)")) I PSJORD["P",($P(ND0,"^",4)'="F") Q 0
"RTN","PSIVCAL",115,0)
 N MULT S MULT=$S($E(LIM)="h":60,$E(LIM)="d":1440,$E(LIM)="m":LIM,$E(LIM)="l":LIM,1:0) I MULT S LIM=MULT*$E(LIM,2,99)
"RTN","PSIVCAL",116,0)
 Q LIM
"RTN","PSIVCAL",117,0)
 ;
"RTN","PSIVCAL",118,0)
GETMIN(LIM,DFN,PSJORD) ;
"RTN","PSIVCAL",119,0)
 N F
"RTN","PSIVCAL",120,0)
 I LIM!(LIM=0) Q LIM
"RTN","PSIVCAL",121,0)
 S F=$S(PSJORD["P":"^PS(53.1,+PSJORD,",PSJORD["V":"^PS(55,DFN,""IV"",+PSJORD,",1:"")
"RTN","PSIVCAL",122,0)
 N RATE S RATE=$S(PSJORD["P":+$P($G(@(F_"8)")),"^",5),PSJORD["V":+$P($G(@(F_"0)")),"^",8),1:0) I RATE D
"RTN","PSIVCAL",123,0)
 . S LIM=$S($E(LIM)="m":$E(LIM,2,99),$E(LIM)="l":($E(LIM,2,99)*1000),1:0)/RATE S LIM=LIM*60
"RTN","PSIVCAL",124,0)
 Q LIM
"RTN","PSIVCHK")
0^115^B15887140
"RTN","PSIVCHK",1,0)
PSIVCHK ;BIR/PR,MLM-CHECK ORDER FOR INTEGRITY ;12 DEC 97 / 10:16 AM
"RTN","PSIVCHK",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**54,58,81,111**;16 DEC 97
"RTN","PSIVCHK",3,0)
 ;
"RTN","PSIVCHK",4,0)
 ; Reference to ^PS(51.1 supported by DBIA# 2177.
"RTN","PSIVCHK",5,0)
 ; Reference to ^DIE supported by DBIA# 2053.
"RTN","PSIVCHK",6,0)
 ;
"RTN","PSIVCHK",7,0)
 ;Need DFN and ON
"RTN","PSIVCHK",8,0)
 W ! S ERR=0,P("TYP")=P(4) S:P("TYP")="C" P("TYP")=P(23) I P("TYP")="S" S P("TYP")=$S(+P(5):"P",1:"A")
"RTN","PSIVCHK",9,0)
 I '+P("MR") W !,"*** You have not specified a med route! ",! S ERR=1
"RTN","PSIVCHK",10,0)
 I P(11)]"" S X=P(11) D CHK^DIE(51.1,1,"",X,.PSJTIM) I PSJTIM="^" W !,"*** Your administration time(s) are in an invalid format !" S ERR=1
"RTN","PSIVCHK",11,0)
M I P(15)<0 S ERR=1 W !,"*** Time interval between doses is less than zero !"
"RTN","PSIVCHK",12,0)
 NEW X S X=0 S:P(9)]"" X=$O(^PS(51.1,"APPSJ",P(9),0))
"RTN","PSIVCHK",13,0)
 ;I P("TYP")="P",('X!("^NOW^STAT^ONCE^"[(U_$P(P(9)," ")_U))),P(11)["-" S:'ERR ERR=2 W !,"*** WARNING -- You have a non-standard schedule ...",!?15,"with an administration time."
"RTN","PSIVCHK",14,0)
 ;* I P("TYP")="P",(P(15)!("^NOW^STAT^ONCE^"[(U_$P(P(9)," ")_U))),P(11)["-" S:'ERR ERR=2 W !,"*** WARNING -- You have a non-standard schedule ...",!?15,"with an administration time."
"RTN","PSIVCHK",15,0)
 N XX F XX=2,3 I $P(P(XX),".",2)=""!($L(P(XX))>12) S ERR=1 W !,"*** ",$S(XX=2:"Start",1:"Stop")," date is in an invalid format or must contain time !"
"RTN","PSIVCHK",16,0)
 I P(2)>P(3) S ERR=1 W !,"*** Start date/time CANNOT be greater than the stop date/time"
"RTN","PSIVCHK",17,0)
 I $$SCHREQ^PSJLIVFD(.P),'X D
"RTN","PSIVCHK",18,0)
 .N PSJXSTMP S PSJXSTMP=P(9) I PSJXSTMP="" S ERR=1 Q
"RTN","PSIVCHK",19,0)
 .N X,Y,PSGS0XT,PSGS0Y,PSGOES S PSGOES=2,X=PSJXSTMP D ENOS^PSGS0 I $G(X)]""&($G(X)=$G(PSJXSTMP)) Q
"RTN","PSIVCHK",20,0)
 .W !," *** WARNING -- Missing or Invalid Schedule ...",! S ERR=1
"RTN","PSIVCHK",21,0)
INF I P(8)="","AH"[P("TYP") S ERR=1 W !,"*** You have no infusion rate defined !"
"RTN","PSIVCHK",22,0)
 ;I "AH"[P("TYP"),P(8)'?1N.N1" ml/hr",P(8)'?.E1"@"1N.N S ERR=1 W !,"*** Your infusion rate is in an invalid format !"
"RTN","PSIVCHK",23,0)
 I "AH"[P("TYP"),P(8)'?1N.N.1".".1N1" ml/hr",P(8)'?.E1"@"1N.N S ERR=1 W !,"*** Your infusion rate is in an invalid format !"
"RTN","PSIVCHK",24,0)
 I P(8)="",P("TYP")="P" S:'ERR ERR=2 W !,"*** WARNING -- You have not specified an infusion rate. "
"RTN","PSIVCHK",25,0)
 I '$$CODES1^PSIVUTL(P("TYP"),55.01,.04)!(P("TYP")="") S ERR=1 W !,"*** Type of order is invalid !"
"RTN","PSIVCHK",26,0)
 I '$$CODES1^PSIVUTL(P(17),55.01,100)!(P(17)="") S ERR=1 W !,"*** Status of order is invalid !"
"RTN","PSIVCHK",27,0)
AH ;
"RTN","PSIVCHK",28,0)
 I "HA"[P("TYP"),(P(11)]""!(P(9)]"")) W !,$C(7),"Order type is an admixture, hyperal, or continuous syringe, and you have",!,"a schedule and/or administration times defined!"
"RTN","PSIVCHK",29,0)
 I  F Q=0:0 W !,"Ok to delete these fields" S %=1 D YN^DICN D NULSET Q:%
"RTN","PSIVCHK",30,0)
 K % I P(6)="" S ERR=1 W !,"*** You have not entered a physician!"
"RTN","PSIVCHK",31,0)
 I P(6)]"",'$D(^VA(200,+P(6),"PS")) S ERR=1 W !,"*** Physician entered does not exist or is not authorized to write",!,"medication orders"
"RTN","PSIVCHK",32,0)
 I P(6)]"",$D(^VA(200,+P(6),"PS")),(+$P(^("PS"),U,4)),($P(^("PS"),U,4)'>DT) S ERR=1 W !,"*** Physician entered is no longer active."
"RTN","PSIVCHK",33,0)
 D ^PSIVCHK1
"RTN","PSIVCHK",34,0)
 Q
"RTN","PSIVCHK",35,0)
 ;
"RTN","PSIVCHK",36,0)
NULSET ;Delete admin/schedule fields for hyperals and/or admixtures
"RTN","PSIVCHK",37,0)
 I '% W !!?2,"Enter 'YES' to delete the schedule and/or administration times fields from",!,"this order.  Enter 'NO' (or '^') to leave the fields intact.",! Q
"RTN","PSIVCHK",38,0)
 S:%=1 P(9)="",P(11)=""
"RTN","PSIVCHK",39,0)
 Q
"RTN","PSIVCHK",40,0)
CKO S P16=0,PSIVEXAM=1,PSIVCT=1 D PSIVCHK S PSIVNOL=1 W ! D ^PSIVORLB K PSIVEXAM Q:'ERR
"RTN","PSIVCHK",41,0)
 I ERR=2 F J=0:0 W !!,"Since there is a warning with this order.",!,"do you wish to re-edit this order" S %=1 D YN^DICN Q:%  W !!,"Answer 'YES' to re-edit this order."
"RTN","PSIVCHK",42,0)
 I ERR=2,%=1 S PSIVOK="57^58^59^26^39^63^64^62^10^25^1" D ^PSIVORV2,GSTRING^PSIVORE1,GTFLDS^PSIVORFE K DA,DIE,DR G CKO
"RTN","PSIVCHK",43,0)
 Q
"RTN","PSIVCHK1")
0^116^B16087678
"RTN","PSIVCHK1",1,0)
PSIVCHK1 ;BIR/PR,MLM-CHECK ORDER FOR INTEGRITY ;23 Oct 98 / 10:00 AM
"RTN","PSIVCHK1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**21,41,50,74,111**;16 DEC 97
"RTN","PSIVCHK1",3,0)
 ;
"RTN","PSIVCHK1",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSIVCHK1",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSIVCHK1",6,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSIVCHK1",7,0)
 ;
"RTN","PSIVCHK1",8,0)
 ;Need DFN and ON
"RTN","PSIVCHK1",9,0)
 ;
"RTN","PSIVCHK1",10,0)
 I P(9)="",P("TYP")="P" S ERR=1 W !,"*** No schedule exists for this order!"
"RTN","PSIVCHK1",11,0)
 I P(11)="",P("TYP")="P",'P(15),$S(P(9)="ONE TIME"!(P(9)="ON CALL")!(P(9)="1 TIME"):0,"^NOW^STAT^ONCE^ONE-TIME^ONETIME^1TIME^1-TIME^ONCALL^ON-CALL^"[(U_$P(P(9)," ")_U):0,$$DOW^PSIVUTL($P(P(9)," PRN")):1,1:(P(9)'["PRN")) D
"RTN","PSIVCHK1",12,0)
 . I $$DOW^PSIVUTL(P(9)) S P(15)="D"
"RTN","PSIVCHK1",13,0)
 . I P(15)="D" S ERR=1 W !,"*** This is a 'DAY OF THE WEEK' schedule and MUST have admin times!" Q
"RTN","PSIVCHK1",14,0)
 . S ERR=1 W !,"*** There are no administration times defined for this order!"
"RTN","PSIVCHK1",15,0)
 S PDM=11 S PDM=0 F DRGT="AD","SOL" I $D(DRG(DRGT)) F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI!PDM  I $P(P("PD"),U)=$P(DRG(DRGT,DRGI),U,6) S PDM=11
"RTN","PSIVCHK1",16,0)
 I $E(P("OT"))'="I",'PDM D GTPD^PSIVORE2 S PDM=11
"RTN","PSIVCHK1",17,0)
 I $E(P("OT"))="I",'PDM W !!,"ERROR,",!,"The Orderable item does not match any of the additives or solutions entered.",!,"At least 1 additive or solution must match the Orderable item entered",!,"for this order!",!! S ERR=1
"RTN","PSIVCHK1",18,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  S CHK=DRG(DRGT,DRGI) D DRG,@DRGT
"RTN","PSIVCHK1",19,0)
 NEW DRGSOL,DRGAD,X S (DRGSOL,DRGAD)=0
"RTN","PSIVCHK1",20,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  S DRGSOL=DRGSOL+1
"RTN","PSIVCHK1",21,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  S DRGAD=DRGAD+1
"RTN","PSIVCHK1",22,0)
 I 'DRGAD,("P"[P("TYP")) S:'ERR ERR=2 W !,"WARNING, You have not defined an additive."
"RTN","PSIVCHK1",23,0)
 I DRGAD+DRGSOL<1 S ERR=1 W !,"ERROR, You have not defined any additives or solutions."
"RTN","PSIVCHK1",24,0)
 I 'DRGSOL,("P"'[P("TYP")) S ERR=1 W !,"ERROR, No solution entered for order."
"RTN","PSIVCHK1",25,0)
 I "AP"[P("TYP"),(DRGSOL'=1) S:'ERR ERR=2 W !,"WARNING, This order should have one solution defined, you have ",DRGSOL,!,"   solutions defined."
"RTN","PSIVCHK1",26,0)
 I ERR W $C(7) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSIVCHK1",27,0)
 K CHK,P("TYP")
"RTN","PSIVCHK1",28,0)
 Q
"RTN","PSIVCHK1",29,0)
 ;
"RTN","PSIVCHK1",30,0)
AD ; Check additives.
"RTN","PSIVCHK1",31,0)
 I '$D(^PS(FIL,+DRG(1),0)) S ERR=1 W !,"ERROR, Additive entered does not exist in additive file." Q
"RTN","PSIVCHK1",32,0)
 I $$ENU^PSIVUTL(DRG(1))'=$P(DRG(3)," ",2,99)!(+DRG(3)'>0) S ERR=1 W !,"ERROR, Invalid strength entered for ",DRG(2),!,"... should be in ",$$ENU^PSIVUTL(DRG(1))," ... please reenter."
"RTN","PSIVCHK1",33,0)
 I P("TYP")="P",DRG(4)]"" S ERR=1 W !,"ERROR, Piggyback or intermittent syringe type order and you have a bottle #",!,"defined for ",DRG(2)
"RTN","PSIVCHK1",34,0)
 Q
"RTN","PSIVCHK1",35,0)
 ;
"RTN","PSIVCHK1",36,0)
SOL ; Check solutions.
"RTN","PSIVCHK1",37,0)
 I '$D(^PS(FIL,+DRG(1),0)) S ERR=1 W !,"ERROR, Solution entered does not exist in solution file." Q
"RTN","PSIVCHK1",38,0)
 I DRG(3)>9999!(DRG(3)'>0) S ERR=1 W !,"ERROR, Volume on ",DRG(2)," is an invalid strength." Q
"RTN","PSIVCHK1",39,0)
 Q
"RTN","PSIVCHK1",40,0)
 ;
"RTN","PSIVCHK1",41,0)
DRG ; Put drug data in DRG and check if active.
"RTN","PSIVCHK1",42,0)
 F X=1:1:6 S DRG(X)=$P(CHK,U,X)
"RTN","PSIVCHK1",43,0)
 I $S('$G(^PS(FIL,+DRG(1),"I")):0,^("I")>DT:0,1:1)!($S('$G(^PSDRUG(+$P($G(^PS(FIL,DRG(1),0)),U,2),"I")):0,^("I")>DT:0,1:1)) S ERR=1 W !,"ERROR, ",DRG(2)," is an inactive drug!"
"RTN","PSIVCHK1",44,0)
 Q
"RTN","PSIVEDT1")
0^79^B28421245
"RTN","PSIVEDT1",1,0)
PSIVEDT1 ;BIR/MLM-EDIT IV ORDER (CONT) ;10 Mar 98 / 2:36 PM
"RTN","PSIVEDT1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,7,41,47,50,64,58,116,110,111**;16 DEC 97
"RTN","PSIVEDT1",3,0)
 ;
"RTN","PSIVEDT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVEDT1",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSIVEDT1",6,0)
 ;
"RTN","PSIVEDT1",7,0)
10 ; Start Date
"RTN","PSIVEDT1",8,0)
 D:'P(2)&P("IVRM")!($G(PSJREN)) ENT^PSIVCAL
"RTN","PSIVEDT1",9,0)
A10 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",10,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Start Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",11,0)
 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",12,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Start Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",13,0)
 S Y=P(2) X ^DD("DD") W !,"START DATE/TIME: "_$S(Y]"":Y_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(P(2)&X="") Q
"RTN","PSIVEDT1",14,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 10
"RTN","PSIVEDT1",15,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S F1=53.1,F2=10 S:X="@" X="?" D ENHLP^PSIVORC1 G A10
"RTN","PSIVEDT1",16,0)
 K %DT S:X="" X=P(2) S %DT="ERTX" D ^%DT K %DT G:Y'>0 A10
"RTN","PSIVEDT1",17,0)
 I $G(P("RES"))="R",(+Y<+$P($G(^PS(55,DFN,"IV",+$G(P("OLDON")),0)),U,2)) D  G 10
"RTN","PSIVEDT1",18,0)
 .; naked ref below refers to line above
"RTN","PSIVEDT1",19,0)
 .S Y=$P(^(0),U,2) X ^DD("DD") W $C(7),!!,"Start date of order being renewed is ",Y,".",!,"Start date of renewal order must be AFTER start date of order being renewed.",!
"RTN","PSIVEDT1",20,0)
 S X1=$G(P("LOG")),X2=-7 D C^%DTC I +Y<X W !!,"Start date/time may not be entered prior to 7 days from the order's LOGIN DATE.",! D A10
"RTN","PSIVEDT1",21,0)
 S P(2)=+Y,PSGSDX=1
"RTN","PSIVEDT1",22,0)
 Q
"RTN","PSIVEDT1",23,0)
 ;
"RTN","PSIVEDT1",24,0)
25 ; Stop Date
"RTN","PSIVEDT1",25,0)
 G:$D(PSGFDX) A25
"RTN","PSIVEDT1",26,0)
 I P("IVRM")]"",$S(P(3)<P(2):1,$G(PSIVAC)["E":0,1:1) S PSIVSITE=$G(^PS(59.5,+P("IVRM"),1)),$P(PSIVSITE,"^",20,21)=$G(^PS(59.5,+P("IVRM"),5)) D ENSTOP^PSIVCAL
"RTN","PSIVEDT1",27,0)
A25 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",28,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Stop Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",29,0)
 S Y=P(3) X ^DD("DD") W !,"STOP DATE/TIME: "_$S(Y]"":Y_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 Q:X=""&P(2)  I $E(X)=U!(X=""&P(2)) Q
"RTN","PSIVEDT1",30,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 25
"RTN","PSIVEDT1",31,0)
 I X="@"!(X["?") W $C(7),"  (Required)" S F1=53.1,F2=25,X="?" D ENHLP^PSIVORC1 G A25
"RTN","PSIVEDT1",32,0)
 K %DT S:X="" X=P(3) S %DT="ERTX" D:X'=+X ^%DT
"RTN","PSIVEDT1",33,0)
 I X=+X,X>0,X'>2000000 G A25:'$$ENDL^PSGDL(P(9),X) D ENDL^PSIVSP
"RTN","PSIVEDT1",34,0)
 S X=Y S:Y<1!Y'["." X="" G:Y'>0 A25 S P(3)=+Y,PSGFDX=1
"RTN","PSIVEDT1",35,0)
 Q
"RTN","PSIVEDT1",36,0)
26 ; Schedule
"RTN","PSIVEDT1",37,0)
 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",38,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",39,0)
 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",40,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",41,0)
 W !,"SCHEDULE: ",$S(P(9)]"":P(9)_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X="") Q
"RTN","PSIVEDT1",42,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(9)="" G 26
"RTN","PSIVEDT1",43,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 26
"RTN","PSIVEDT1",44,0)
 ;/I X?1."?"!($L(X)>22)!($L(X," ")>2) S F1=55.01,F2=.09 D ENHLP^PSIVORC1 G 26
"RTN","PSIVEDT1",45,0)
 I X?1."?"!($L(X)>22)!($L(X," ")>3) S F1=55.01,F2=.09 D ENHLP^PSIVORC1 G 26
"RTN","PSIVEDT1",46,0)
 S P(7)="" N PSGOES K PSGOES D EN^PSIVSP S:XT<0 X="" I $G(X)="" W $C(7),"??" G 26
"RTN","PSIVEDT1",47,0)
 S P(9)=X,P(11)=Y,P(15)=XT
"RTN","PSIVEDT1",48,0)
 Q
"RTN","PSIVEDT1",49,0)
 ;
"RTN","PSIVEDT1",50,0)
39 ; Admin Times
"RTN","PSIVEDT1",51,0)
 I $G(P("RES"))="R" I $G(ON)["P",($P($G(^PS(53.1,+ON,0)),"^",24)="R") D  Q
"RTN","PSIVEDT1",52,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Administration times may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",53,0)
 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",54,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Admin Times may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",55,0)
 I $$ODD^PSGS0(P(9)) Q
"RTN","PSIVEDT1",56,0)
 W !,"ADMINISTRATION TIMES: ",$S(P(11)]"":P(11)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I '($G(P(15))="D"&'DONE) I $E(X)=U!(X="") Q
"RTN","PSIVEDT1",57,0)
 I ($G(P(15))="D"!($G(P(9))["@"))&('$G(X)!(X["@")) W $C(7),"  ??" S X="?" W:(P(15)="D"!(X["@")) !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." G 39
"RTN","PSIVEDT1",58,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(11)="" G 39
"RTN","PSIVEDT1",59,0)
 I X["?" S F1=55.01,F2=.12 D ENHLP^PSIVORC1 G 39
"RTN","PSIVEDT1",60,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 39
"RTN","PSIVEDT1",61,0)
 ;K:X[""""!($A(X)=45) X D:$D(X) CHK^DIE(51.1,1,"",X,.X) W:$G(X)="^"!('$D(X)) $C(7),"  ??" G:$G(X)="^"!('$D(X)) 39 S P(11)=X D:$G(PSIVCAL) ENT^PSIVCAL,ENSTOP^PSIVCAL K PSIVCAL
"RTN","PSIVEDT1",62,0)
 K:X[""""!($A(X)=45) X D:$D(X) ENCHK^PSGS0 W:$G(X)="^"!('$D(X)) $C(7),"  ??" G:$G(X)="^"!('$D(X)) 39 S P(11)=X D:$G(PSIVCAL) ENT^PSIVCAL,ENSTOP^PSIVCAL K PSIVCAL
"RTN","PSIVEDT1",63,0)
 Q
"RTN","PSIVEDT1",64,0)
 ;
"RTN","PSIVEDT1",65,0)
59 ; Infusion Rate
"RTN","PSIVEDT1",66,0)
 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",67,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Infusion Rate may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",68,0)
 W !,"INFUSION RATE: ",$S(P(8)]"":P(8)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $S($E(X)=U:1,X]"":0,1:P(8)]"") Q
"RTN","PSIVEDT1",69,0)
 I X=""&(("C^P"[P(4))!(("C^S"[P(4))&(P(5)=1))) Q
"RTN","PSIVEDT1",70,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(8)="" G 59
"RTN","PSIVEDT1",71,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 59
"RTN","PSIVEDT1",72,0)
 I X["?" S F1=53.1,F2=59 D ENHLP^PSIVORC1 G 59
"RTN","PSIVEDT1",73,0)
 I X]"" D ENI^PSIVSP W:'$D(X) $C(7)," ??" G:'$D(X) 59 S P(8)=X
"RTN","PSIVEDT1",74,0)
 I P(8)="" W $C(7),!!,"An infusion rate must be entered!" G 59
"RTN","PSIVEDT1",75,0)
 Q
"RTN","PSIVEDT1",76,0)
 ;
"RTN","PSIVEDT1",77,0)
63 ; Remarks
"RTN","PSIVEDT1",78,0)
 N DIR S X="",DIR(0)="53.1,63" S:P("REM")]"" DIR("B")=P("REM") D ^DIR I X="^"!$D(DTOUT) S DONE=1 Q
"RTN","PSIVEDT1",79,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P("REM")="" G 63
"RTN","PSIVEDT1",80,0)
 I X]"",$E(X)'="^" S P("REM")=X
"RTN","PSIVEDT1",81,0)
 Q
"RTN","PSIVEDT1",82,0)
 ;
"RTN","PSIVEDT1",83,0)
64 ; Other Print Info
"RTN","PSIVEDT1",84,0)
 N DIR S X="",DIR(0)="53.1,64" S:P("OPI")]"" DIR("B")=$P(P("OPI"),"^") D ^DIR I X="^"!$D(DTOUT) S DONE=1 Q
"RTN","PSIVEDT1",85,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P("OPI")="" G 64
"RTN","PSIVEDT1",86,0)
 I X]"",$E(X)'="^" S P("OPI")=X,P("OPI")=$$ENBCMA^PSJUTL("V")
"RTN","PSIVEDT1",87,0)
 Q
"RTN","PSIVEDT1",88,0)
 ;
"RTN","PSIVEDT1",89,0)
ORFLDS ; Display OE/RR fields during edit.
"RTN","PSIVEDT1",90,0)
 D FULL^VALM1
"RTN","PSIVEDT1",91,0)
 W !!,"Orderable Item: ",$P(P("PD"),U,2),!,"Give: ",$P(P("MR"),U,2)," ",P(9),!!
"RTN","PSIVEDT1",92,0)
 Q
"RTN","PSIVORFA")
0^62^B26473261
"RTN","PSIVORFA",1,0)
PSIVORFA ;BIR/MLM-FILE/RETRIEVE ORDERS IN 53.1 ;26 Jun 98 / 9:16 AM
"RTN","PSIVORFA",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,7,18,28,50,71,58,91,80,110,111**;16 DEC 97
"RTN","PSIVORFA",3,0)
 ;
"RTN","PSIVORFA",4,0)
 ; Reference to ^PS(51.1 supported by DBIA 2177.
"RTN","PSIVORFA",5,0)
 ; Reference to ^PS(51.2 supported by DBIA 2178.
"RTN","PSIVORFA",6,0)
 ; Reference to ^PS(52.7 supported by DBIA 2173.
"RTN","PSIVORFA",7,0)
 ; Reference to ^PS(52.6 supported by DBIA 1231.
"RTN","PSIVORFA",8,0)
 ;
"RTN","PSIVORFA",9,0)
GT531(DFN,ON) ; Retrieve order data from 53.1 and place into local array
"RTN","PSIVORFA",10,0)
 ;
"RTN","PSIVORFA",11,0)
 NEW PSGOES S PSGOES=1
"RTN","PSIVORFA",12,0)
 F X="CUM","LF","LFA","LF","PRNTON" S P(X)=""
"RTN","PSIVORFA",13,0)
 S Y=$G(^PS(53.1,+ON,0)),P(17)=$P(Y,U,9),P("LOG")=$P(Y,U,16),(P(21),P("21FLG"),PSJORIFN)=$P(Y,U,21)
"RTN","PSIVORFA",14,0)
 S P("RES")=$P(Y,U,24),P("OLDON")=$P(Y,U,25),P("NEWON")=$P(Y,U,26),P("FRES")=$P(Y,U,27)
"RTN","PSIVORFA",15,0)
 S P("MR")=$P(Y,U,3),P(6)=+$P(Y,U,2),Y=$G(^VA(200,+P(6),0)),$P(P(6),U,2)=$P(Y,U),Y=$G(^PS(51.2,+P("MR"),0)),$P(P("MR"),U,2)=$S($P(Y,U,3)]"":$P(Y,U,3),1:$P(Y,U))
"RTN","PSIVORFA",16,0)
 S Y=$G(^PS(53.1,+ON,.2)),P("PD")=$S(+Y:$P(Y,U)_U_$$OIDF^PSJLMUT1(+Y),1:""),P("DO")=$P(Y,U,2),P("NAT")=$P(Y,U,3),P("PRY")=$P(Y,U,4),(PSJCOM,P("PRNTON"))=$P(Y,U,8)
"RTN","PSIVORFA",17,0)
 S P("INS")=$G(^PS(53.1,+ON,.3))
"RTN","PSIVORFA",18,0)
 I $G(^PS(53.1,+ON,4))]"" S P("NINIT")=$P(^(4),U),P("NINITDT")=$P(^(4),U,2)
"RTN","PSIVORFA",19,0)
 NEW NAME S NAME=""
"RTN","PSIVORFA",20,0)
 I $D(^PS(53.1,+ON,1,1)) D DD^PSJLMUT1("^PS(53.1,+ON,",.NAME)
"RTN","PSIVORFA",21,0)
 S P("INS")=P("INS")_$S(P("INS")]"":" of ",1:"")_NAME
"RTN","PSIVORFA",22,0)
 S P("APPT")=$G(^PS(53.1,+ON,"DSS")),P("CLIN")=$P(P("APPT"),"^"),P("APPT")=$P(P("APPT"),"^",2)
"RTN","PSIVORFA",23,0)
 ;;S Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(11)=$P(Y,U,5),P(15)=$P(Y,U,6),Y=$G(^PS(53.1,+ON,4)),P("CLRK")=$P(Y,U,7)_U_$P($G(^VA(200,+$P(Y,U,7),0)),U),P("REN")=$P(Y,U,9),X=P(9)
"RTN","PSIVORFA",24,0)
 S Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(11)=$P(Y,U,5),P(15)=$P(Y,U,6),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4)
"RTN","PSIVORFA",25,0)
 S Y=$G(^PS(53.1,+ON,4)),P("CLRK")=$P(Y,U,7)_U_$P($G(^VA(200,+$P(Y,U,7),0)),U),P("REN")=$P(Y,U,9),X=P(9)
"RTN","PSIVORFA",26,0)
 I $P($G(^PS(53.1,+ON,0)),U,7)="P",(P(9)'["PRN") S P(9)=P(9)_" PRN"
"RTN","PSIVORFA",27,0)
 K PSGST,XT
"RTN","PSIVORFA",28,0)
 I P(9)]"",(P(11)="") D  S P(15)=$S($G(XT)]""&'+$G(XT):XT,+$G(XT)>0:XT,1:1440),P(11)=Y
"RTN","PSIVORFA",29,0)
 . I $O(^PS(51.1,"APPSJ",P(9),0)) D DIC^PSGORS0 Q
"RTN","PSIVORFA",30,0)
 . I '$O(^PS(51.1,"APPSJ",P(9),0)) N NOECH,PSGSCH S NOECH=1 D EN^PSIVSP
"RTN","PSIVORFA",31,0)
 S Y=$G(^PS(53.1,+ON,8)),P(4)=$P(Y,U),P(23)=$P(Y,U,2),P("SYRS")=$P(Y,U,3),P(5)=$P(Y,U,4),P(8)=$P(Y,U,5),P(7)=$P(Y,U,7),P("IVRM")=$P(Y,U,8)
"RTN","PSIVORFA",32,0)
 S:'P("IVRM")&($D(PSIVSN)) P("IVRM")=+PSIVSN S Y=$G(^PS(59.5,+P("IVRM"),0)),$P(P("IVRM"),U,2)=$P(Y,U),Y=$G(^PS(53.1,+ON,9)),P("REM")=$P(Y,U),P("OPI")=$P(Y,U,2,3)
"RTN","PSIVORFA",33,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORFA",34,0)
 S P("PACT")=$G(^PS(53.1,+ON,"A",1,0))
"RTN","PSIVORFA",35,0)
 ;;D GTDRG,GTOT^PSIVUTL(P(4)) D:'$D(PSJLABEL) GTPC(ON) S (P(2),P(3))="" ;L -^PS(53.1,+ON)
"RTN","PSIVORFA",36,0)
 D GTDRG,GTOT^PSIVUTL(P(4)) D:'$D(PSJLABEL) GTPC(ON)
"RTN","PSIVORFA",37,0)
 Q
"RTN","PSIVORFA",38,0)
GTDRG ;
"RTN","PSIVORFA",39,0)
 K DRG F X="AD","SOL" S FIL=$S(X="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(53.1,+ON,X,Y)) Q:'Y  D
"RTN","PSIVORFA",40,0)
 .S (DRGI,DRG(X,0))=$G(DRG(X,0))+1,DRG=$G(^PS(53.1,+ON,X,Y,0)),ND=$G(^PS(FIL,+DRG,0)),DRGN=$P(ND,U),DRG(X,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORFA",41,0)
 Q
"RTN","PSIVORFA",42,0)
 ;
"RTN","PSIVORFA",43,0)
GTPC(ON) ; Retrieve Provider Comments and create "scratch" fields to edit
"RTN","PSIVORFA",44,0)
 ;S:'$D(PSIVUP) PSIVUP=+$$GTPCI^PSIVUTL K ^PS(53.45,PSIVUP,4) I $O(^PS(53.1,+ON,12,0)) S %X="^PS(53.1,"_+ON_",12,",%Y="^PS(53.45,"_PSIVUP_",4," D %XY^%RCR
"RTN","PSIVORFA",45,0)
 Q
"RTN","PSIVORFA",46,0)
 ;
"RTN","PSIVORFA",47,0)
PUT531 ; Move data in local variables to 53.1
"RTN","PSIVORFA",48,0)
 S ND(0)=+ON_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_$P(P("OT"),U)_U_U_U_"C",$P(ND(0),U,9)=P(17),$P(ND(0),U,21)=$G(P(21))
"RTN","PSIVORFA",49,0)
 ;;S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,21)=$S("AD"'[P(17):PSJORIFN,1:""),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON")) S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSIVORFA",50,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON")) S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSIVORFA",51,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7)_"^"_+P("IVRM"),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"")
"RTN","PSIVORFA",52,0)
 S $P(ND(4),U,1,2)=$G(P("NINIT"))_U_$G(P("NINITDT"))
"RTN","PSIVORFA",53,0)
 S:+$G(P("CLIN")) $P(^PS(53.1,+ON,"DSS"),"^")=P("CLIN")
"RTN","PSIVORFA",54,0)
 S:+$G(P("APPT")) $P(^PS(53.1,+ON,"DSS"),"^",2)=P("APPT")
"RTN","PSIVORFA",55,0)
 I $G(PSJORD)["V"!($G(PSJORD)["P") I $G(^PS(53.1,+ON,2.5))="" N DUR S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S((PSJORD["P"):"P",1:"IV"),1) I DUR]"" D
"RTN","PSIVORFA",56,0)
 .I $G(IVLIMIT) S $P(^PS(53.1,+ON,2.5),"^",4)=DUR K IVLIMIT Q
"RTN","PSIVORFA",57,0)
 .S $P(^PS(53.1,+ON,2.5),"^",2)=DUR
"RTN","PSIVORFA",58,0)
 F X=0,2,4,8,9 S ^PS(53.1,+ON,X)=ND(X)
"RTN","PSIVORFA",59,0)
 ;;S:+P("PD") ^PS(53.1,+ON,.2)=+P("PD")_U_P("DO")
"RTN","PSIVORFA",60,0)
 S:'+$G(^PS(53.1,+ON,.2)) $P(^(.2),U,1,3)=+P("PD")_U_P("DO")_U_$G(P("NAT"))
"RTN","PSIVORFA",61,0)
 ;;K ^PS(53.1,+ON,12) I $O(^PS(53.45,PSIVUP,4,0)) S %X="^PS(53.45,"_PSIVUP_",4,",%Y="^PS(53.1,"_+ON_",12," D %XY^%RCR
"RTN","PSIVORFA",62,0)
 ;;K ^PS(53.45,+PSIVUP,4)
"RTN","PSIVORFA",63,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSIVORFA",64,0)
 K DA,DIK S PSGS0Y=P(11),PSGS0XT=P(15),DA=+ON,DIK="^PS(53.1," D IX^DIK K DA,DIK,PSGS0Y,PSGS0XT,ND,^PS(53.1,"AS","P",DFN,+ON)
"RTN","PSIVORFA",65,0)
 K:P(17)="A" ^PS(53.1,"AS","N",DFN,+ON)
"RTN","PSIVORFA",66,0)
 S:P(15)="D" $P(^PS(53.1,+ON,2),U,6)="D"
"RTN","PSIVORFA",67,0)
 Q
"RTN","PSIVORFA",68,0)
 ;
"RTN","PSIVORFA",69,0)
UPD100 ; Update order data in file 100
"RTN","PSIVORFA",70,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF
"RTN","PSIVORFA",71,0)
 ;* S ORIFN=PSJORIFN,PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) D SET^PSIVORFE K ORETURN ;; F X="OREVENT","ORSTS","ORSTRT","ORSTOP","ORPK","ORPCL","ORNP","ORPK" S ORETURN(X)=@X
"RTN","PSIVORFA",72,0)
 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) D SET^PSIVORFE
"RTN","PSIVORFA",73,0)
 Q
"RTN","PSIVORFA",74,0)
 ;
"RTN","PSIVORFA",75,0)
PTD531 ; Move drug data from local array into 53.1
"RTN","PSIVORFA",76,0)
 K ^PS(53.1,+ON,DRGT) S ^PS(53.1,+ON,DRGT,0)=$S(DRGT="AD":"^53.157^0^0",1:"^53.158^0^0")
"RTN","PSIVORFA",77,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSIVORFA",78,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^PS(53.1,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSIVORFA",79,0)
 .S ^PS(53.1,+ON,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(53.1,+ON,DRGT,+DRG,0)=Y
"RTN","PSIVORFA",80,0)
 Q
"RTN","PSIVORFB")
0^63^B29730553
"RTN","PSIVORFB",1,0)
PSIVORFB ;BIR/MLM-FILE/RETRIEVE ORDERS IN ^PS(55 ;25 Sep 98 / 2:24 PM
"RTN","PSIVORFB",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,18,28,68,58,85,110,111**;16 DEC 97
"RTN","PSIVORFB",3,0)
 ;
"RTN","PSIVORFB",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSIVORFB",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSIVORFB",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVORFB",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA #2173.
"RTN","PSIVORFB",8,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSIVORFB",9,0)
 ;
"RTN","PSIVORFB",10,0)
NEW55 ; Get new order number in 55.
"RTN","PSIVORFB",11,0)
 N DA,DD,DO,DIC,DLAYGO,X,Y
"RTN","PSIVORFB",12,0)
 I $D(^PS(55,+DFN)),'$D(^PS(55,+DFN,0)) D ENSET0^PSGNE3(+DFN)
"RTN","PSIVORFB",13,0)
 S DIC="^PS(55,",DIC(0)="LN",DLAYGO=55,(DINUM,X)=+DFN D ^DIC Q:Y<0
"RTN","PSIVORFB",14,0)
LOCK0 F  L +^PS(55,DFN,"IV",0):0 I  Q
"RTN","PSIVORFB",15,0)
 S ND=$S($D(^PS(55,DFN,"IV",0)):^(0),1:"^55.01") F DA=$P(ND,"^",3)+1:1 W "." I '$D(^PS(55,DFN,"IV",DA)) S $P(ND,"^",3)=DA,$P(ND,"^",4)=$P(ND,"^",4)+1,^PS(55,DFN,"IV",0)=ND Q
"RTN","PSIVORFB",16,0)
 L +^PS(55,DFN,"IV",+DA):0 E  G LOCK0
"RTN","PSIVORFB",17,0)
 S ^PS(55,DFN,"IV",+DA,0)=+DA,^PS(55,DFN,"IV","B",+DA,+DA)=""
"RTN","PSIVORFB",18,0)
 L -^PS(55,DFN,"IV",0) S ON55=+DA_"V"
"RTN","PSIVORFB",19,0)
 Q
"RTN","PSIVORFB",20,0)
 ;
"RTN","PSIVORFB",21,0)
SET55 ; Move data from local variables to 55.
"RTN","PSIVORFB",22,0)
 I '$D(ON55) W !,"*** Can't create this order at this time ***" Q
"RTN","PSIVORFB",23,0)
 N DA,DIK,ND,PSIVACT,PSIVDUR
"RTN","PSIVORFB",24,0)
 S:'$D(P(21)) (P(21),P("21FLG"))="" S ND(0)=+ON55,P(22)=$S(VAIN(4):+VAIN(4),1:.5) F X=2:1:23 I $D(P(X)) S $P(ND(0),U,X)=P(X)
"RTN","PSIVORFB",25,0)
 S ND(.3)=$G(P("INS")),ND(2.5)="" N X S X=$S($G(PSGORD):PSGORD,1:$G(ON)) I X D
"RTN","PSIVORFB",26,0)
 .N PKG S PKG=$E(X,$L(X)) S PKG=$S(PKG="V":"""IV""",PKG="U":5,PKG="P":"P",1:"") Q:PKG=""
"RTN","PSIVORFB",27,0)
 .S PSIVDUR=$$GETDUR^PSJLIVMD(DFN,+X,$E(X,$L(X)),1) Q:PSIVDUR=""
"RTN","PSIVORFB",28,0)
 .I $G(IVLIMIT) S ND(2.5)="^^^"_PSIVDUR K IVLIMIT Q
"RTN","PSIVORFB",29,0)
 .S ND(2.5)="^"_PSIVDUR
"RTN","PSIVORFB",30,0)
 S $P(ND(0),U,17)="A",ND(1)=P("REM"),ND(3)=P("OPI"),ND(.2)=$P($G(P("PD")),U)_U_$G(P("DO"))_U_+P("MR")_U_$G(P("PRY"))_U_$G(P("NAT"))_U_U_U_$G(P("PRNTON"))
"RTN","PSIVORFB",31,0)
 F X=0,1,2.5,3,.2,.3 S ^PS(55,DFN,"IV",+ON55,X)=ND(X)
"RTN","PSIVORFB",32,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,1,4)=P("LOG")_U_+P("IVRM")_U_U_P("SYRS"),$P(^(2),U,8,10)=P("RES")_U_$G(P("FRES"))_U_$S($G(VAIN(4)):+VAIN(4),1:"")
"RTN","PSIVORFB",33,0)
 S X=^PS(55,DFN,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(P("LOG"),"^"),"."),$P(X,"^",8)="A",^(0)=X
"RTN","PSIVORFB",34,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,11)=+P("CLRK")
"RTN","PSIVORFB",35,0)
 S:+$G(P("CLIN")) $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^")=P("CLIN")
"RTN","PSIVORFB",36,0)
 S:+$G(P("APPT")) $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^",2)=P("APPT")
"RTN","PSIVORFB",37,0)
 S:+$G(P("NINIT")) ^PS(55,DFN,"IV",+ON55,4)=P("NINIT")_U_P("NINITDT")
"RTN","PSIVORFB",38,0)
 ;S:'$D(PSIVUP) PSIVUP=+$$GTPCI^PSIVUTL K ^PS(55,DFN,"IV",+ON55,5) I $O(^PS(53.45,PSIVUP,4,0)) S %X="^PS(53.45,"_PSIVUP_",4,",%Y="^PS(55,"_DFN_",""IV"","_+ON55_",5," D %XY^%RCR
"RTN","PSIVORFB",39,0)
 I '$G(PSIVCHG)!($G(PSJREN)&($G(PSIVCHG)=2)) I $G(P("PON")),P("PON")'=ON55 D
"RTN","PSIVORFB",40,0)
 . N X S X=$S(P("PON")["P":"^PS(53.1,+P(""PON""),12,0)",P("PON")["V"&$G(PSJREN):"^PS(55,DFN,""IV"",+P(""PON""),5,0)",1:"") Q:X=""
"RTN","PSIVORFB",41,0)
 . I $O(@X) S %X=X,%Y="^PS(55,"_DFN_",""IV"","_+ON55_",5," D %XY^%RCR
"RTN","PSIVORFB",42,0)
 F DRGT="AD","SOL" D PUTD55
"RTN","PSIVORFB",43,0)
 K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK
"RTN","PSIVORFB",44,0)
 I $G(PSJCOM),$G(PSJCOMSI),$G(PSJORD)["V" K PSJCOMSI N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSIVORFB",45,0)
 . N PSJCHILD S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  S PSJCHILD(+PSJCHILD)=PSJCOM
"RTN","PSIVORFB",46,0)
 . S PSJCHILD=0 F  S PSJCHILD=$O(PSJCHILD(PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSIVORFB",47,0)
 .. Q:PSJCHILD=PSJORD  K DR,DA,DIE,ORD S DR="31////"_$P($G(P("OPI")),"^",1,2),DA(1)=DFN
"RTN","PSIVORFB",48,0)
 .. N ON,ON55 S (ON,ON55)=+PSJCHILD_"V" S:+$G(PSJPINIT)'>0 PSJPINIT=DUZ S PSIVALT=1,PSIVAL="COMPLEX ORDER" D ENTACT^PSIVAL D
"RTN","PSIVORFB",49,0)
 ... I $P($G(^PS(55,DFN,"IV",+ON55,3)),"^")'=$P(P("OPI"),"^") S P("FC")="OTHER PRINT INFO^"_$P($G(^(3)),"^")_U_$P(P("OPI"),"^") D GTFC^PSIVORAL
"RTN","PSIVORFB",50,0)
 ... I $D(^PS(55,DFN,"IV",+ON55,0)) S ^PS(55,DFN,"IV",+ON55,3)=P("OPI") D EN1^PSJHL2(DFN,"XX",ON55)
"RTN","PSIVORFB",51,0)
 Q
"RTN","PSIVORFB",52,0)
 ;
"RTN","PSIVORFB",53,0)
PUTD55 ; Move drug data from local array into 55
"RTN","PSIVORFB",54,0)
 K ^PS(55,DFN,"IV",+ON55,DRGT) S ^PS(55,DFN,"IV",+ON55,DRGT,0)=$S(DRGT="AD":"^55.02PA",1:"^55.11IPA")
"RTN","PSIVORFB",55,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSIVORFB",56,0)
 .S Y=^PS(55,DFN,"IV",+ON55,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSIVORFB",57,0)
 .S ^PS(55,DFN,"IV",+ON55,DRGT,0)=Y,Y=$P(DRG(DRGT,X),U)_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(55,DFN,"IV",+ON55,DRGT,+DRG,0)=Y
"RTN","PSIVORFB",58,0)
 Q
"RTN","PSIVORFB",59,0)
GT55 ; Retrieve data from 55 into local array
"RTN","PSIVORFB",60,0)
 K DRG,DRGN,P S:'$D(ON55) ON55=ON S P("REN")="",Y=$G(^PS(55,DFN,"IV",+ON55,0)) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVORFB",61,0)
 S P("21FLG")=P(21)
"RTN","PSIVORFB",62,0)
 S P("PON")=ON55,PSJORIFN=P(21),P(6)=P(6)_U_$P($G(^VA(200,+P(6),0)),U),(DRG,DRGN)="",P("REM")=$G(^PS(55,DFN,"IV",+ON55,1))
"RTN","PSIVORFB",63,0)
 S Y=$G(^PS(55,DFN,"IV",+ON55,2)),P("LOG")=$P(Y,U),P("IVRM")=$P(Y,U,2)_U_$P($G(^PS(59.5,+$P(Y,U,2),0)),U)
"RTN","PSIVORFB",64,0)
 S P("CLRK")=$P(Y,U,11)_U_$P($G(^VA(200,+$P(Y,U,11),0)),U),P("RES")=$P(Y,U,8),P("FRES")=$P(Y,U,9),P("SYRS")=$P(Y,U,4),P("OPI")=$G(^PS(55,DFN,"IV",+ON55,3))
"RTN","PSIVORFB",65,0)
 S P("INS")=$G(^PS(55,DFN,"IV",+ON55,.3))
"RTN","PSIVORFB",66,0)
 S P("CLIN")=$P($G(^PS(55,DFN,"IV",+ON55,"DSS")),"^"),P("APPT")=$P($G(^PS(55,DFN,"IV",+ON55,"DSS")),"^",2)
"RTN","PSIVORFB",67,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORFB",68,0)
 D:'$D(PSJLABEL) GTPC(ON55) S ND=$G(^PS(55,DFN,"IV",+ON55,.2)),P("PD")=$S($P(ND,U):$P(ND,U)_U_$$OIDF^PSJLMUT1(+ND)_U_$P($G(^PS(50.7,+ND,0)),U),1:""),P("DO")=$P(ND,U,2),P("PRY")=$P(ND,U,4),P("NAT")=$P(ND,U,5),(PSJCOM,P("PRNTON"))=$P(ND,U,8)
"RTN","PSIVORFB",69,0)
 I P("PRY")="D",'+P("IVRM") S P("IVRM")=+$G(PSIVSN)_U_$P($G(^PS(59.5,+$G(PSIVSN),0)),U)
"RTN","PSIVORFB",70,0)
 S P("MR")=$P(ND,U,3),ND=$G(^PS(51.2,+P("MR"),0)),P("MR")=P("MR")_U_$S($P(ND,U,3)]"":$P(ND,U,3),1:$P(ND,U)) D GTCUM
"RTN","PSIVORFB",71,0)
 D GTDRG,GTOT^PSIVUTL(P(4))
"RTN","PSIVORFB",72,0)
K ; Kill and exit.
"RTN","PSIVORFB",73,0)
 K FIL,ND
"RTN","PSIVORFB",74,0)
 Q
"RTN","PSIVORFB",75,0)
GTDRG ; Get drug info and place in DRG(.
"RTN","PSIVORFB",76,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(55,DFN,"IV",+ON55,DRGT,Y)) Q:'Y  D
"RTN","PSIVORFB",77,0)
 .; naked ref below refers to line above
"RTN","PSIVORFB",78,0)
 .S DRG=$G(^(Y,0)),ND=$G(^PS(FIL,+DRG,0)),(DRGI,DRG(DRGT,0))=$G(DRG(DRGT,0))+1
"RTN","PSIVORFB",79,0)
 .S DRG(DRGT,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORFB",80,0)
 Q
"RTN","PSIVORFB",81,0)
 ;
"RTN","PSIVORFB",82,0)
GTCUM ; Retrieve dispensing info.
"RTN","PSIVORFB",83,0)
 S ND=$G(^PS(55,DFN,"IV",+ON55,9)),P("LF")=$P(ND,U),P("LFA")=$P(ND,U,2),P("CUM")=$P(ND,U,3)
"RTN","PSIVORFB",84,0)
 Q
"RTN","PSIVORFB",85,0)
 ;
"RTN","PSIVORFB",86,0)
GTPC(ON) ; Retrieve Provider Comments and create "scratch" fields to edit
"RTN","PSIVORFB",87,0)
 ;S:'$D(PSIVUP) PSIVUP=+$$GTPCI^PSIVUTL K ^PS(53.45,PSIVUP,4)
"RTN","PSIVORFB",88,0)
 ;K ^PS(53.45,PSIVUP,4) I $O(^PS(55,DFN,"IV",+ON,5,0)) S %X="^PS(55,"_DFN_",""IV"","_+ON_",5,",%Y="^PS(53.45,"_PSIVUP_",4," D %XY^%RCR
"RTN","PSIVORFB",89,0)
 Q
"RTN","PSIVORFB",90,0)
 ;
"RTN","PSIVORFB",91,0)
SETNEW ; Create new order and set
"RTN","PSIVORFB",92,0)
 D NEW55,SET55
"RTN","PSIVORFB",93,0)
 Q
"RTN","PSIVSP")
0^108^B33966081
"RTN","PSIVSP",1,0)
PSIVSP ;BIR/RGY,PR,CML3-DOSE PROCESSOR ;09 Feb 99 / 12:30 PM
"RTN","PSIVSP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**30,37,41,50,56,74,83,111**;16 DEC 97
"RTN","PSIVSP",3,0)
 ;
"RTN","PSIVSP",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177
"RTN","PSIVSP",5,0)
 ;
"RTN","PSIVSP",6,0)
EN ;
"RTN","PSIVSP",7,0)
 Q:'$D(X)
"RTN","PSIVSP",8,0)
 ;/S (PSIVAT,PSIVWAT,Y)="",XT=-1,X0=X,X=$S(X="ON CALL":X,X["ONE ":X,1:$P(X," "))
"RTN","PSIVSP",9,0)
 S ATZERO=0 I X["@",$P(X,"@",2)=0 S ATZERO=1,X=$P(X,"@")
"RTN","PSIVSP",10,0)
 D EN^PSGS0 S (P(9),PSIVSC1)=$S($G(X)]"":X,1:$G(P(9))),P(11)=$S(Y]"":Y,1:$G(P(11))),(XT,P(15))=$S(($G(PSGS0XT)!($G(PSGS0XT)="D")):$G(PSGS0XT),1:$G(P(15)))
"RTN","PSIVSP",11,0)
 I $G(ATZERO) S P(7)=1
"RTN","PSIVSP",12,0)
 K ATZERO Q
"RTN","PSIVSP",13,0)
EN1 ;
"RTN","PSIVSP",14,0)
 S (PSIVAT,PSIVWAT,Y)="",XT=-1,X0=X,X=$S(X="ON CALL":X,X="ONCALL":X,X="ON-CALL":X,X="ONETIME":X,X="ONE-TIME":X,X="ONE TIME":X,X="1TIME":X,X="1 TIME":X,X="1-TIME":X,$L(X," ")<3:$P(X," "),1:$P(X," ",1,2))
"RTN","PSIVSP",15,0)
 S:$E(X)="^" X=$E(X,2,999) G:X="" Q S:X["@0" ATZERO=1 S X=$S(X["@0":$P(X,"@"),1:X),P(7)=$S($D(ATZERO):1,1:"") K ATZERO
"RTN","PSIVSP",16,0)
 ;;I X0["@",$P(X0,"@",2)'=0 K X Q
"RTN","PSIVSP",17,0)
 I $S($D(^PS(51.1,"AC","PSJ",X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC I Y'<0 G SH
"RTN","PSIVSP",18,0)
 ;;I $S(X="NOW":1,X="ONCE":1,X="STAT":1,X="ONE-TIME":1,X="ONE TIME":1,1:0) S XT=0,Y(0)=X G SH
"RTN","PSIVSP",19,0)
NS0 S Y=""
"RTN","PSIVSP",20,0)
 I $E(X,1,2)="AD" S XT=-1 Q
"RTN","PSIVSP",21,0)
 I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S XT=1440\$F("BTQ",$E(X))
"RTN","PSIVSP",22,0)
 E  S:$E(X)="Q" X=$E(X,2,99) S:'X X=$E(X)["O"+1_X S I=+X,X=$P(X,I,2),XT=I*$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:0),X=X0 D 
"RTN","PSIVSP",23,0)
 . I 'XT,X'="NOW",X'="STAT",X'="ONCE",X'="ONE-TIME",X'="ONE TIME",X'="ONETIME",X'="1-TIME",X'="1 TIME",X'="1TIME",Y="" S XT=-1
"RTN","PSIVSP",24,0)
SH ;
"RTN","PSIVSP",25,0)
 I +Y<1,$E(X0)'="^" W:$G(ON)'["P" "  ",$S(XT=0&($S("^NOW^STAT^ONCE^ONE-TIME^ONETIME^1TIME^1-TIME^"[(U_$P(X," ")_U):1,X["1 TIME":1,1:X["ONE TIME")):"(ONCE ONLY)",XT>0:"Nonstandard schedule",XT<0:"",1:"(??)") W:XT>0 " (",XT," MINUTES)"
"RTN","PSIVSP",26,0)
Q Q:X="ONE TIME"
"RTN","PSIVSP",27,0)
 N I S X0=$P(X," ")_$S($L(X0," ")-1:" ",1:"")_$P(X0," ",2,99) K:XT<0!($L(X0)>22) X S:$D(X) X=X0 K X0 S:$G(P(7)) XT="" Q
"RTN","PSIVSP",28,0)
 ;N I S X0=$P(X," ")_$S($L(X0," ")-1:" ",1:"")_$P(X," ",2,99) K:XT<0!($L(X0)>22) X S:$D(X) X=X0 K X0 S:$G(P(7)) XT="" Q
"RTN","PSIVSP",29,0)
 ;S X0=X K:XT<0!($L(X0)>22) X S:$D(X) X=X0 K X0 S:$G(P(7)) XT="" Q
"RTN","PSIVSP",30,0)
NEWQ ;N I S X0=$P(X," ")_$S($L(X0," ")-1:" ",1:"")_$P(X0," ",2,99) K:XT<0!($L(X0)>22) X S:$D(X) X=X0 S:P(7) X=X0 K X0 K:XT>0&('P(7)) X Q
"RTN","PSIVSP",31,0)
 Q
"RTN","PSIVSP",32,0)
 ;
"RTN","PSIVSP",33,0)
ENDL W "   Dose limit ....  " S PSIVMIN=P(15)*X,PSIVSD=+P(2)
"RTN","PSIVSP",34,0)
 I PSIVMIN<0 W !!," --- There is something wrong with this order !!",!,"     Call inpatient supervisor ....." S Y=-1 K PSIVMIN Q
"RTN","PSIVSP",35,0)
 I P(4)="P"!(P(5))!(P(23)="P"),PSIVMIN=0,"^NOW^STAT^ONCE^ONE-TIME^ONE TIME^ON CALL^ONETIME^1TIME^1 TIME^1-TIME^"'[(U_P(9)_U) D DLP G QDL
"RTN","PSIVSP",36,0)
 D ENT^PSIVWL
"RTN","PSIVSP",37,0)
QDL I $D(X) S X=Y X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2) S Y=X
"RTN","PSIVSP",38,0)
 Q
"RTN","PSIVSP",39,0)
DLP ;
"RTN","PSIVSP",40,0)
 S X=X+1,$P(PSIVSD,".",2)=$P(PSIVSD,".",2)_$E("0000",1,4-$L($P(PSIVSD,".",2))) D CHK S X2=0,Y=1 I X<2 S Y=+PSIVSD G QDLP
"RTN","PSIVSP",41,0)
 I $P(PSIVSD,".",2)>$P(P(11),"-",$L(P(11),"-")) S X2=1 G OV
"RTN","PSIVSP",42,0)
 G:$P(P(11),"-")>$P(PSIVSD,".",2) OV
"RTN","PSIVSP",43,0)
 F Y=1:1 S X1=$P(P(11),"-",Y) I X1=$P(PSIVSD,".",2)!($P(PSIVSD,".",2)<X1) Q
"RTN","PSIVSP",44,0)
OV I P(11)="" W $C(7)," ???",!?15,"*** You have not defined any administration times !!" K X Q
"RTN","PSIVSP",45,0)
 F Y=Y:1 S:$P(P(11),"-",Y)="" X2=X2+1,Y=0,X=X+1 S X=X-1 Q:X<1
"RTN","PSIVSP",46,0)
 S X=PSIVSD\1 I X2>0 S X1=PSIVSD D C^%DTC S X=$P(X,".") ; install with version 17.3 of fileman
"RTN","PSIVSP",47,0)
 S Y=+(X_"."_$P(P(11),"-",Y))
"RTN","PSIVSP",48,0)
QDLP K X1,X2 Q
"RTN","PSIVSP",49,0)
 ;
"RTN","PSIVSP",50,0)
ENI ;
"RTN","PSIVSP",51,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X)!'$D(P(4)) Q
"RTN","PSIVSP",52,0)
 I P(4)="P"!(P(5))!(P(23)="P") Q:'X  S X="INFUSE OVER "_X_" MIN." W "   ",X Q
"RTN","PSIVSP",53,0)
 I X'=+X,($P(X,"@",2,999)'=+$P(X,"@",2,999)!(+$P(X,"@",2,999)<0)) K X Q
"RTN","PSIVSP",54,0)
 S SPSOL=$O(DRG("SOL",0)) I 'SPSOL K SPSOL,X W "  You must define at least one solution !!" Q
"RTN","PSIVSP",55,0)
 I X=+X S X=X_" ml/hr" W " ml/hr" D SPSOL S P(15)=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSIVSP",56,0)
 S SPSOL=$P(X,"@",2) S:$P(X,"@")=+X $P(X,"@")=$P(X,"@")_" ml/hr" W "   ",+SPSOL," Label",$S(SPSOL'=1:"s",1:"")," per day",!?15,"at an infusion rate of: ",$P(X,"@") S P(15)=$S('SPSOL:0,1:1440/SPSOL\1) K SPSOL
"RTN","PSIVSP",57,0)
 Q
"RTN","PSIVSP",58,0)
SPSOL S SPSOL=0 F XXX=0:0 S XXX=$O(DRG("SOL",XXX)) Q:'XXX  S SPSOL=SPSOL+$P(DRG("SOL",XXX),U,3)
"RTN","PSIVSP",59,0)
 K XXX Q
"RTN","PSIVSP",60,0)
CHK F Y=1:1 Q:$L(P(11))>240!($P(P(11),"-",Y)="")  S $P(P(11),"-",Y)=$P(P(11),"-",Y)_$E("0000",1,4-$L($P(P(11),"-",Y)))
"RTN","PSIVSP",61,0)
 Q
"RTN","PSIVSP",62,0)
 ;
"RTN","PSIVSP",63,0)
DIC ; 51.1 look-up
"RTN","PSIVSP",64,0)
 N PSJSCH S PSJSCH=X I '$D(WSCHADM) N VAIP D IN5^VADPT S WSCHADM=VAIP(5),X=PSJSCH
"RTN","PSIVSP",65,0)
 K DIC S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(NOECH))_"ISZ"
"RTN","PSIVSP",66,0)
 S DIC("W")="W ""  "","_$S('$D(WSCHADM):"$P(^(0),""^"",2)",'+WSCHADM:"$P(^(0),""^"",2)",1:"$S($D(^PS(51.1,+Y,1,+WSCHADM,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"),D="APPSJ" S:$D(PSIVSPQF) DIC(0)=DIC(0)_"O"
"RTN","PSIVSP",67,0)
 D IX^DIC K DIC
"RTN","PSIVSP",68,0)
 S:$D(DIE)#2 DIC=DIE Q:Y<0
"RTN","PSIVSP",69,0)
 S X=Y(0,0),ZZY=Y,(XT,Y)="" I $D(WSCHADM),$D(^PS(51.1,+ZZY,1,+WSCHADM,0)),$P(^(0),"^",2)]"" S (PSIVWAT,Y)=$P(^(0),"^",2)
"RTN","PSIVSP",70,0)
 K ZZY,WSCHADM S:Y="" (X,PSIVSC1)=$P(Y(0),U),(PSIVAT,Y)=$P(Y(0),"^",2) S XT=$P(Y(0),"^",3) Q
"RTN","PSIVSP",71,0)
 ;
"RTN","PSIVSP",72,0)
ORINF ;  OERR input transform for Infusion Rate
"RTN","PSIVSP",73,0)
 ;  X=data
"RTN","PSIVSP",74,0)
 N INFUSE
"RTN","PSIVSP",75,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","PSIVSP",76,0)
 I X?.E1L.E S INFUSE=$$ENLU^PSGMI(X) Q:(INFUSE="TITRATE")!(INFUSE="BOLUS")
"RTN","PSIVSP",77,0)
 Q:(X="TITRATE")!(X="BOLUS")
"RTN","PSIVSP",78,0)
 I X["=" D  Q   ; NOIS LOU-0501-42191
"RTN","PSIVSP",79,0)
 .N X2,X1 S X1=$P(X,"="),X2=$P(X,"=",2)
"RTN","PSIVSP",80,0)
 .I X1["ML/HR",(+X1=$P(X1,"ML/HR"))!(+X1=$P(X1," ML/HR")) D
"RTN","PSIVSP",81,0)
 ..S X1=$TR(X1,"ML/HR","ml/hr")
"RTN","PSIVSP",82,0)
 .I X2["ML/HR",(+X2=$P(X2,"ML/HR"))!(+X2=$P(X2," ML/HR")) D
"RTN","PSIVSP",83,0)
 ..S X2=$TR(X2,"ML/HR","ml/hr")
"RTN","PSIVSP",84,0)
 .I X1[" ml/hr",(+X1=$P(X1," ml/hr")) D
"RTN","PSIVSP",85,0)
 ..S X1=$P(X1," ml/hr")_$P(X1," ml/hr",2,9999)
"RTN","PSIVSP",86,0)
 .I X2[" ml/hr",(+X2=$P(X2," ml/hr")) D
"RTN","PSIVSP",87,0)
 ..S X2=$P(X2," ml/hr")_$P(X2," ml/hr",2,9999)
"RTN","PSIVSP",88,0)
 .I X1["ml/hr",(+X1=$P(X1,"ml/hr")) D
"RTN","PSIVSP",89,0)
 ..S X1=$P(X1,"ml/hr")_$P(X1,"ml/hr",2,9999)
"RTN","PSIVSP",90,0)
 .I X2["ml/hr",(+X2=$P(X2,"ml/hr")) D
"RTN","PSIVSP",91,0)
 ..S X2=$P(X2,"ml/hr")_$P(X2,"ml/hr",2,9999)
"RTN","PSIVSP",92,0)
 .I X2'=+X2 D
"RTN","PSIVSP",93,0)
 ..I ($P(X2,"@",2,999)'=+$P(X2,"@",2,999)!(+$P(X2,"@",2,999)<0)) K X Q
"RTN","PSIVSP",94,0)
 .I X1=+X1 S X1=X1_" ml/hr"
"RTN","PSIVSP",95,0)
 .I X2=+X2 S X2=X2_" ml/hr"
"RTN","PSIVSP",96,0)
 .S:$P(X2,"@")=+X2 $P(X2,"@")=$P(X2,"@")_" ml/hr"
"RTN","PSIVSP",97,0)
 .S X=X1_"="_X2
"RTN","PSIVSP",98,0)
 I X["ML/HR",(+X=$P(X,"ML/HR"))!(+X=$P(X," ML/HR")) S X=$TR(X,"ML/HR","ml/hr")
"RTN","PSIVSP",99,0)
 I X[" ml/hr",+X=$P(X," ml/hr") S X=$P(X," ml/hr")_$P(X," ml/hr",2,9999)
"RTN","PSIVSP",100,0)
 I X["ml/hr",+X=$P(X,"ml/hr") S X=$P(X,"ml/hr")_$P(X,"ml/hr",2,9999)
"RTN","PSIVSP",101,0)
 I X'=+X,($P(X,"@",2,999)'=+$P(X,"@",2,999)!(+$P(X,"@",2,999)<0)) K X Q
"RTN","PSIVSP",102,0)
 I X=+X S X=X_" ml/hr" Q
"RTN","PSIVSP",103,0)
 S:$P(X,"@")=+X $P(X,"@")=$P(X,"@")_" ml/hr"
"RTN","PSIVSP",104,0)
 Q
"RTN","PSIVSTAT")
0^6^B20250059
"RTN","PSIVSTAT",1,0)
PSIVSTAT ;BIR/PR-BUILD COST TRANS NODE, ENTER COMPILE ;6 Nov 98 / 4:45 PM
"RTN","PSIVSTAT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,18,84,81,104,111**;16 DEC 97
"RTN","PSIVSTAT",3,0)
 ;
"RTN","PSIVSTAT",4,0)
 ; Reference to ^ECXPIV1 is supported by DBIA# 1882.
"RTN","PSIVSTAT",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSIVSTAT",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSIVSTAT",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVSTAT",8,0)
 ; 
"RTN","PSIVSTAT",9,0)
 ;Needs dfn,on,psivnol,psivc (optional:dis/ret/des).
"RTN","PSIVSTAT",10,0)
 ;
"RTN","PSIVSTAT",11,0)
 S PSIVV=1 L +^PS(50.8,PSIVSN):5000
"RTN","PSIVSTAT",12,0)
 I '$G(PSIVC) S PSIVC=$S(($G(PSJRDC)="R"):2,($G(PSJRDC)="D"):3,($G(PSJRDC)]""):4,1:1)
"RTN","PSIVSTAT",13,0)
 ;D NOW^%DTC S (Y,PSIVNOW)=% I '$D(^PS(50.8,PSIVSN,0)) L +^PS(50.8,0) S ^PS(50.8,PSIVSN,0)=PSIVSN,$P(^(0),U,3,4)=PSIVSN_U_($P(^PS(50.8,0),U,4)+1) L -^PS(50.8,0)
"RTN","PSIVSTAT",14,0)
 D NOW^%DTC S (Y,PSIVNOW)=% I '$D(^PS(50.8,PSIVSN,0)) D  S ^PS(50.8,PSIVSN,0)=PSIVSN,$P(^(0),U,3,4)=PSIVSN_U_($P(^PS(50.8,0),U,4)+1) L -^PS(50.8,0)
"RTN","PSIVSTAT",15,0)
 .F  L +^PS(50.8,0):1 Q:$T
"RTN","PSIVSTAT",16,0)
 S $P(^PS(50.8,PSIVSN,1,0),U,1,3)="^50.801P^"_DFN S:'$D(^(DFN,0)) ^(0)=DFN,$P(^(0),U,3,4)=DFN_U_($P(^PS(50.8,PSIVSN,1,0),U,4)+1)
"RTN","PSIVSTAT",17,0)
 S PSIVTN=1 I $D(^PS(50.8,PSIVSN,1,DFN,1,0)) F PSIVTN=$P(^(0),U,3)+1:1 Q:'$D(^PS(50.8,PSIVSN,1,DFN,1,PSIVTN,0))
"RTN","PSIVSTAT",18,0)
 ;
"RTN","PSIVSTAT",19,0)
RETDET ;Get the ward that returns or destroyed need to be associated with.
"RTN","PSIVSTAT",20,0)
 ;RDFLAG & RDWARD ARE set in routine PSIVRD.
"RTN","PSIVSTAT",21,0)
 I $D(RDFLAG) S PSIVWD=RDWARD S:'$D(^PS(55,DFN,"IV",+ON,9)) $P(^(9),U,1,2)="" S $P(^(9),U,3)=$P(^(9),U,3)-PSIVNOL G SKIP
"RTN","PSIVSTAT",22,0)
 ;
"RTN","PSIVSTAT",23,0)
LBWD ;Get the ward we that we are printing labels on.
"RTN","PSIVSTAT",24,0)
 S PSIVWD=$P(^PS(55,DFN,"IV",+ON,0),U,22) G:PSIVWD SKIP
"RTN","PSIVSTAT",25,0)
 S PSIVWD=$S($D(^DPT(DFN,.1)):$O(^DIC(42,"B",^DPT(DFN,.1),0)),1:.5)
"RTN","PSIVSTAT",26,0)
 ;
"RTN","PSIVSTAT",27,0)
SKIP ;
"RTN","PSIVSTAT",28,0)
 ;Set up the transaction node here.
"RTN","PSIVSTAT",29,0)
 S ^PS(50.8,PSIVSN,1,DFN,1,0)="^50.802^"_PSIVTN_U_PSIVTN,^(PSIVTN,0)=PSIVTN_U_+ON_U_PSIVC_U_PSIVNOW_U_PSIVNOL_U_PSIVWD
"RTN","PSIVSTAT",30,0)
 ;
"RTN","PSIVSTAT",31,0)
DSS ; Update DSS for IV extract
"RTN","PSIVSTAT",32,0)
 ;
"RTN","PSIVSTAT",33,0)
 S X="ECXPIV1" X ^%ZOSF("TEST") Q:'$T
"RTN","PSIVSTAT",34,0)
 N ADSTR,ADUNITS,DCST,DDRG,DRG,PROV,SOLSTR,TYP,START
"RTN","PSIVSTAT",35,0)
 K ^TMP($J)
"RTN","PSIVSTAT",36,0)
 S X=$G(^PS(55,DFN,"IV",+ON,0)),PROV=$P(X,U,6),TYP=$P(X,U,4),START=$P(X,U,2)
"RTN","PSIVSTAT",37,0)
 F DRGTYP="AD","SOL" F DRG=0:0 S DRG=$O(^PS(55,DFN,"IV",+ON,DRGTYP,DRG)) Q:'DRG  D
"RTN","PSIVSTAT",38,0)
 .S ND=$G(^PS(55,DFN,"IV",+ON,DRGTYP,DRG,0)),(ADSTR,ADUNITS,SOLSTR)=""
"RTN","PSIVSTAT",39,0)
 .S @(DRGTYP_"STR")=$P(ND,U,2),ND=$G(^PS($S(DRGTYP="AD":52.6,1:52.7),+ND,0)),DDRG=$P(ND,U,2),DCST=$P(ND,U,7)
"RTN","PSIVSTAT",40,0)
 .I DRGTYP="AD" S Y=$P(ND,U,3) I Y S Y=$$CODES^PSIVUTL(Y,52.6,2) S ADUNITS=Y
"RTN","PSIVSTAT",41,0)
 .S ECUD=DFN_U_+ON_U_DDRG_U_PSIVNOW_U_PSIVC_U_ADSTR_U_ADUNITS_U_+SOLSTR_U_PROV_U_TYP_U_DCST S ^TMP($J,DFN,ON,DDRG)=ECUD_U_$P($G(^PS(55,DFN,"IV",+ON,"DSS")),"^")_U_START D ^ECXPIV1
"RTN","PSIVSTAT",42,0)
Q1 L -^PS(50.8,PSIVSN) K PSIVD,PSIVTN,PSIVV,PSIVWD,PSIVLP Q
"RTN","PSIVSTAT",43,0)
 ;
"RTN","PSIVSTAT",44,0)
EN ;Compile IV stats hold file here.
"RTN","PSIVSTAT",45,0)
 I $D(PSIVSITE),$D(PSIVSN) K ZTSAVE S ZTDTH=$H,ZTDESC="COMPILE IV STATS (FROM MENU)",ZTRTN="EN^PSIVSTAT",ZTIO="" D ^%ZTLOAD W:$D(ZTSK) !,"Queued." G Q
"RTN","PSIVSTAT",46,0)
 ;K ^TMP("PSIVNC",$J) S PSIVV=1,X="T-"_$S(+$G(^PS(59.7,1,31)):+^(31),1:100),%DT="" D ^%DT
"RTN","PSIVSTAT",47,0)
 ;F X=0:0 S X=$O(^PS(50.8,X)) Q:'X  F I=0:0 S I=$O(^PS(50.8,X,2,I)) Q:'I  I I<Y K ^PS(50.8,X,2,I) S $P(^(0),U,4)=$P(^(0),U,4)-1
"RTN","PSIVSTAT",48,0)
 K ^TMP("PSIVNC",$J) F Q=0:0 S Q=$O(^PS(50.8,Q)) Q:'Q  D
"RTN","PSIVSTAT",49,0)
 .S X="T-"_$S($P($G(^PS(59.5,Q,1)),U,19):$P(^(1),U,19),1:100) D ^%DT
"RTN","PSIVSTAT",50,0)
 .F I=0:0 S I=$O(^PS(50.8,Q,2,I)) Q:'I  I I<Y K ^PS(50.8,Q,2,I) S $P(^(0),U,4)=$P(^(0),U,4)-1
"RTN","PSIVSTAT",51,0)
 ;F PSIVS=0:0 S PSIVS=$O(^PS(50.8,PSIVS)) Q:'PSIVS  L +^PS(50.8,PSIVS,0) D CNT L -^PS(50.8,PSIVS,0)
"RTN","PSIVSTAT",52,0)
 F PSIVS=0:0 S PSIVS=$O(^PS(50.8,PSIVS)) Q:'PSIVS  D  D CNT L -^PS(50.8,PSIVS,0)
"RTN","PSIVSTAT",53,0)
 .F  L +^PS(50.8,PSIVS,0):1 Q:$T
"RTN","PSIVSTAT",54,0)
Q K D,PSGDT,PSIVNOL,PSIVD,PSIVC,PSIVS,PSIVV,%DT,Z,ZTSK,DFN,PSIV,PNL,POP,LO,IV,PSIVDG,PSIVDRG D ENIVKV^PSGSETU Q
"RTN","PSIVSTAT",55,0)
CNT F DFN=0:0 S DFN=$O(^PS(50.8,PSIVS,1,DFN)) Q:'DFN  F TN=0:0 S TN=$O(^PS(50.8,PSIVS,1,DFN,1,TN)) Q:'TN  D SET
"RTN","PSIVSTAT",56,0)
 S:$D(ZTQUEUED) ZTREQ="@" I $D(^TMP("PSIVNC",$J)) D MSG K TN,ZTIO,ZTRTN,X,Y Q
"RTN","PSIVSTAT",57,0)
 K ^PS(50.8,PSIVS,1),TN,ZTIO,ZTRTN,X,Y Q
"RTN","PSIVSTAT",58,0)
SET S TN=^PS(50.8,PSIVS,1,DFN,1,TN,0),ON=$P(TN,U,2),PSIVC=$P(TN,U,3),PSIVNOL=$P(TN,U,5),W42=$P(TN,U,6),PSIVD=$P(TN,U,4)\1
"RTN","PSIVSTAT",59,0)
 F PSIVDG=52.6,52.7 F I=0:0 S I=$O(^PS(55,DFN,"IV",+ON,$S(PSIVDG=52.6:"AD",1:"SOL"),I)) Q:'I!($D(NON))  S PSIVDRG=+^(I,0) I $P(^PS(PSIVDG,PSIVDRG,0),U,7)="" S NON=1 D NOCOST
"RTN","PSIVSTAT",60,0)
 I $D(NON) K PSIVDG,PSIVDRG,NON Q
"RTN","PSIVSTAT",61,0)
 D ^PSIVST2 K ^PS(50.8,PSIVS,1,DFN,1,+TN) Q
"RTN","PSIVSTAT",62,0)
NOCOST ;Send message if the drug is missing a unit cost.
"RTN","PSIVSTAT",63,0)
 ;
"RTN","PSIVSTAT",64,0)
 S $P(^PS(50.8,PSIVS,1,DFN,1,+TN,0),U,7)=PSIVDG_";"_PSIVDRG,NUM=$S('$D(NUM):1,1:NUM+1),^TMP($J,"PSIVNC",NUM,0)=$P(^PS(PSIVDG,PSIVDRG,0),U)_" IN THE "_$S(PSIVDG=52.6:"ADDITIVES",1:"SOLUTIONS")_" FILE." Q
"RTN","PSIVSTAT",65,0)
MSG S XMDUZ="IV PHARMACY PACKAGE",XMSUB="MISSING COST INFORMATION",XMTEXT="^TMP(""PSIVNC"",$J,"
"RTN","PSIVSTAT",66,0)
 F PSIVDUZ=0:0 S PSIVDUZ=$O(^XUSEC("PSJI MGR",PSIVDUZ)) Q:'PSIVDUZ  S XMY(PSIVDUZ)=""
"RTN","PSIVSTAT",67,0)
 D ^XMD K TMP("PSIVNC",$J),XMY,XMDUZ,NUM,XMTEXT,PSIVDUZ,XMSUB
"RTN","PSIVSTAT",68,0)
 Q
"RTN","PSIVUTL1")
0^64^B16891513
"RTN","PSIVUTL1",1,0)
PSIVUTL1 ;BIR/MLM-IV UTILITIES ;21 MAY 96 / 10:37 AM
"RTN","PSIVUTL1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,81,111**;16 DEC 97
"RTN","PSIVUTL1",3,0)
 ;
"RTN","PSIVUTL1",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180
"RTN","PSIVUTL1",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178
"RTN","PSIVUTL1",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231
"RTN","PSIVUTL1",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVUTL1",8,0)
 ;
"RTN","PSIVUTL1",9,0)
DRGSC(Y,PSJSCT) ; Called to set DIC("S") when selecting orderable item.
"RTN","PSIVUTL1",10,0)
 N OK,ND,NDU,NDI S OK=0 ;* I '$D(^PSDRUG("AP",+Y)) K PSJSCT Q 0
"RTN","PSIVUTL1",11,0)
 S ND=$G(^PS(50.7,+Y,0))
"RTN","PSIVUTL1",12,0)
 I $P(ND,U,3) S OK=$S('$P(ND,U,4):1,$P(ND,U,4)>DT:1,1:0)
"RTN","PSIVUTL1",13,0)
 Q OK
"RTN","PSIVUTL1",14,0)
 ;
"RTN","PSIVUTL1",15,0)
IVDRGSC(Y) ; Set DIC("S") for IV additive/solution selection.
"RTN","PSIVUTL1",16,0)
 N Y S Y="S X(1)=$G(^(0)),X(2)=$G(^(""I"")) I $S('X(2):1,X(2)>DT:1,1:0),$D(^PSDRUG(+$P(X(1),U,2),0)) S X(2)=$G(^(""I"")) I $S('X(2):1,X(2)>DT:1,1:0)"
"RTN","PSIVUTL1",17,0)
 Q Y
"RTN","PSIVUTL1",18,0)
 ;
"RTN","PSIVUTL1",19,0)
ENU(Y) ;Get IV additive strength.
"RTN","PSIVUTL1",20,0)
 N X S X=$P(^PS(52.6,+Y,0),U,3),Y=$$CODES^PSIVUTL(X,52.6,2)
"RTN","PSIVUTL1",21,0)
 Q Y
"RTN","PSIVUTL1",22,0)
 ;
"RTN","PSIVUTL1",23,0)
CODES(X,Y) ; Get name from code.
"RTN","PSIVUTL1",24,0)
 S Y=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSIVUTL1",25,0)
 Q Y
"RTN","PSIVUTL1",26,0)
 ;
"RTN","PSIVUTL1",27,0)
GTPCI(Y) ; Set up "work" area for provider comments.
"RTN","PSIVUTL1",28,0)
 N DIC,DINUM,DLAYGO,X S DIC="^PS(53.45,",DIC(0)="LNZ",DLAYGO=53.45,(DINUM,X)=+DUZ D ^DIC
"RTN","PSIVUTL1",29,0)
 Q Y
"RTN","PSIVUTL1",30,0)
 ;
"RTN","PSIVUTL1",31,0)
WDTE(Y) ; Format and print date.
"RTN","PSIVUTL1",32,0)
 I 'Y S Y="******"
"RTN","PSIVUTL1",33,0)
 E  X ^DD("DD") S Y=$P(Y,"@")_" "_$P($P(Y,"@",2),":",1,2)
"RTN","PSIVUTL1",34,0)
 Q Y
"RTN","PSIVUTL1",35,0)
GTOT(DFN,ON) ; Get order type for display.
"RTN","PSIVUTL1",36,0)
 N DRGT,DRGI,Y
"RTN","PSIVUTL1",37,0)
 S X=$P($G(^PS(55,DFN,"IV",ON,0)),U,4)
"RTN","PSIVUTL1",38,0)
 S Y=$S(X="A":"F",X="H":"H",1:"I")
"RTN","PSIVUTL1",39,0)
 I Y="F" F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(^PS(55,DFN,"IV",+ON,DRGT,DRGI)) Q:'DRGI  I '$P($G(^PS(55,DFN,"IV",+ON,DRGT,DRGI)),U,5) S Y="I" Q
"RTN","PSIVUTL1",40,0)
 Q Y
"RTN","PSIVUTL1",41,0)
 ;
"RTN","PSIVUTL1",42,0)
PIV(ON) ; Display IV orders.
"RTN","PSIVUTL1",43,0)
 N DRG,ON55,P,PSJORIFN,TYP,X,Y S TYP="?" I ON["V" D
"RTN","PSIVUTL1",44,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSIVUTL1",45,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSIVUTL1",46,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSIVUTL1",47,0)
 I ON'["V" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) I $E(P("OT"))="I"  D  Q
"RTN","PSIVUTL1",48,0)
 .S P("PD")=$P($$DRUGNAME^PSJLMUTL(PSGP,ON),"^"),P("DO")=$S($P(DN,"^",2)=.2:$P($G(^PS(55,PSGP,5,+PSJO,.2)),"^",2),1:$G(^PS(55,PSGP,5,+PSJO,.3))),P("DO")=$P(P("DO"),"^")
"RTN","PSIVUTL1",49,0)
 .S Y=$G(^PS(53.1,+ON,.2)),P("MR")=$P($G(^PS(53.1,+ON,0)),U,3)_U_$P($G(^PS(51.2,+$P($G(^PS(53.1,+ON,0)),U,3),0)),U,3)
"RTN","PSIVUTL1",50,0)
 .W ?9,P("PD") D PIV1 W !?11,"Give: ",P("DO")," ",$P(P("MR"),U,2)," ",$S(P(9)]"":P(9),1:P(8))
"RTN","PSIVUTL1",51,0)
 S DRG=0 F  S DRG=$O(DRG("AD",DRG)) Q:'DRG  D PIVAD
"RTN","PSIVUTL1",52,0)
SOL ;
"RTN","PSIVUTL1",53,0)
 NEW NAME
"RTN","PSIVUTL1",54,0)
 S DRG=0 F  S DRG=$O(DRG("SOL",DRG)) Q:'DRG  D
"RTN","PSIVUTL1",55,0)
 . D NAME(DRG("SOL",DRG),39,.NAME,0)
"RTN","PSIVUTL1",56,0)
 . W ! W:DRG=1 ?9,"in "
"RTN","PSIVUTL1",57,0)
 . F X=0:0 S X=$O(NAME(X)) Q:'X  W ?12 W NAME(X) I X=1,DRG=1,'$D(DRG("AD",1)) D PIV1
"RTN","PSIVUTL1",58,0)
 Q
"RTN","PSIVUTL1",59,0)
PIVAD ; Print IV Additives.
"RTN","PSIVUTL1",60,0)
 NEW NAME
"RTN","PSIVUTL1",61,0)
 D NAME(DRG("AD",DRG),39,.NAME,1)
"RTN","PSIVUTL1",62,0)
 F X=0:0 S X=$O(NAME(X)) Q:'X  W:DRG'=1 ! W ?9,NAME(X) I X=1,DRG=1 D PIV1
"RTN","PSIVUTL1",63,0)
 Q
"RTN","PSIVUTL1",64,0)
 ;
"RTN","PSIVUTL1",65,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSIVUTL1",66,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSIVUTL1",67,0)
 I '$D(PSJEXTP) W ?50,TYP,?53,P(2),?60,P(3),?67,P(17) Q
"RTN","PSIVUTL1",68,0)
 W ?50,TYP,?53,P(2),?63,P(3),?73,P(17)
"RTN","PSIVUTL1",69,0)
 Q
"RTN","PSIVUTL1",70,0)
59 ; Validate the Infusion rate entered using IV Quick order code.
"RTN","PSIVUTL1",71,0)
 N I F I=2,3,5,7,8,9,11,15,23 S P(I)=""
"RTN","PSIVUTL1",72,0)
 S P(4)="A",P(8)=$P($G(^PS(57.1,PSJQO,1)),U,5)
"RTN","PSIVUTL1",73,0)
 I $G(^PS(57.1,PSJQO,4,1,0)) S DRG("SOL",1)=^(0),DRG("SOL",0)=1
"RTN","PSIVUTL1",74,0)
 I X["?" S F1=53.1,F2=59 D ENHLP^PSIVORC1 G 59
"RTN","PSIVUTL1",75,0)
 I X]"" D ENI^PSIVSP S:$D(X) P(8)=X
"RTN","PSIVUTL1",76,0)
 Q
"RTN","PSIVUTL1",77,0)
WRTDRG(X,L)       ; Format and print drug name, strength and bottle no.
"RTN","PSIVUTL1",78,0)
 N Y S Y=" "_$P(X,U,3) S:$P(X,U,4) Y=Y_" ("_$P(X,U,4)_")"
"RTN","PSIVUTL1",79,0)
 Q $E($P(X,U,2),1,(L-$L(Y)))_Y
"RTN","PSIVUTL1",80,0)
 ;Q $E($$ENPDN^PSGMI($P(X,U,6)),1,(L-$L(Y)))_Y
"RTN","PSIVUTL1",81,0)
NAME(X,L,NAME,AD)        ; Format Additive display.
"RTN","PSIVUTL1",82,0)
 ;INPUT : X=DRG("AD",DRG)  L=Display length   AD=for Addtive(1/0)
"RTN","PSIVUTL1",83,0)
 ;OUTPUT: AD(X)  if X=2 that means there is a second line to display
"RTN","PSIVUTL1",84,0)
 K NAME
"RTN","PSIVUTL1",85,0)
 NEW Y S Y=$P(X,U,3) S:(AD&$P(X,U,4)) Y=Y_" ("_$P(X,U,4)_")"
"RTN","PSIVUTL1",86,0)
 S:'AD Y=Y_" "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@"))
"RTN","PSIVUTL1",87,0)
 I ($L($P(X,U,2))+$L(Y)+1)>L S NAME(1)=$P(X,U,2),NAME(2)="   "_Y Q
"RTN","PSIVUTL1",88,0)
 S NAME(1)=$P(X,U,2)_" "_Y
"RTN","PSIVUTL1",89,0)
 Q
"RTN","PSIVUTL1",90,0)
 ;
"RTN","PSIVUTL1",91,0)
CNVTOM(RATE,TVOL) ; Convert volume to minutes
"RTN","PSIVUTL1",92,0)
 N DAYS,ML,MLSHR
"RTN","PSIVUTL1",93,0)
 ; Get rate in terms of mils per hour
"RTN","PSIVUTL1",94,0)
 I 'RATE Q 0
"RTN","PSIVUTL1",95,0)
 S TVOL=$S($E(TVOL)="m":$E(TVOL,2,9),$E(TVOL)="l":$E(TVOL,2,9)*1000,1:0) Q:'TVOL 0
"RTN","PSIVUTL1",96,0)
 ; Find IV duration in minutes
"RTN","PSIVUTL1",97,0)
 S MINS=(TVOL/RATE)*60 S MINS=MINS+1
"RTN","PSIVUTL1",98,0)
 Q MINS
"RTN","PSIVWL")
0^80^B32855058
"RTN","PSIVWL",1,0)
PSIVWL ;BIR/RGY,PR-COMPILE AND PRT WARD LIST ;13 MAR 97 / 10:18 AM
"RTN","PSIVWL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**41,54,74,84,93,110,111**;16 DEC 97
"RTN","PSIVWL",3,0)
 ;
"RTN","PSIVWL",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSIVWL",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVWL",6,0)
 ;
"RTN","PSIVWL",7,0)
 K WRD W !!,"Run ward list for DATE: TODAY//" R X:DTIME S:'$T X="^" S:X="" X="T" G Q:X["^" K %DT S %DT="XE" D ^%DT G:Y<0 PSIVWL
"RTN","PSIVWL",8,0)
 S PSIVDT=Y\1 I Y<DT D ENRSET^PSIVWL1 G PSIVWL
"RTN","PSIVWL",9,0)
 D ^PSIVWL1 I '$D(PSIVOD)!('$D(PSIVCD)) G Q
"RTN","PSIVWL",10,0)
 I PSIVPR'=ION D QUE G Q
"RTN","PSIVWL",11,0)
DEQ ;
"RTN","PSIVWL",12,0)
 N PSJOK
"RTN","PSIVWL",13,0)
 D NOW^%DTC S Y=% L +^PS(55,"PSIVWL",PSIVSN):1 E  W:$Y @IOF W !!,"**** WARNING --- WARD LIST NOT RUN, LABEL RUN IN PROGRESS ****" G Q
"RTN","PSIVWL",14,0)
 D:$D(XRTL) T0^%ZOSV S NOFLG=0
"RTN","PSIVWL",15,0)
 S PSIVT="" D ENINIT^PSIVWL1 F PSIV1=0:0 S PSIVT=$O(PSIVOD(PSIVT)) Q:PSIVT=""  S PSIVDT1=PSIVOD(PSIVT)-.0001 F PSIV1=0:0 S PSIVDT1=$O(^PS(55,"AIV",PSIVDT1)) Q:'PSIVDT1  D MAN1
"RTN","PSIVWL",16,0)
 I $D(XRTL) S XRTN="PSIVWL" D T1^%ZOSV
"RTN","PSIVWL",17,0)
 D ENT^PSIVWL1
"RTN","PSIVWL",18,0)
Q L -^PS(55,"PSIVWL",PSIVSN) W:'$D(PSIVPR)&($Y) @IOF K MI,ON,NOFLG,PSCT,PSGCNT,PSGSA,PSIVMT,DIC,PSIVRUN,%DT,PSIVDT1,PSIVDT,PSIV,PSIVOD
"RTN","PSIVWL",19,0)
 K PSIVCD,PSM,%T,D,DFN,I,P,PSIV1,VAERR,X,Y,Z,Z1,Z2,ZTSK S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSIVWL",20,0)
 Q
"RTN","PSIVWL",21,0)
SETP S Y=^PS(55,DFN,"IV",ON,0) F X=1:1:23 S P(X)=$P(Y,"^",X)
"RTN","PSIVWL",22,0)
 N A,PSJST
"RTN","PSIVWL",23,0)
 S PSJST=$$ONE^PSJBCMA(DFN,ON,P(9))
"RTN","PSIVWL",24,0)
 S PSJOK=1 I PSJST="O" S A=0 F  S A=$O(^PS(55,DFN,"IV",+ON,"LAB",A)) Q:A=""  I $P($G(^(A,0)),"^",3)=1 S PSJOK=0 Q
"RTN","PSIVWL",25,0)
 Q
"RTN","PSIVWL",26,0)
MAN1 F DFN=0:0 S DFN=$O(^PS(55,"AIV",PSIVDT1,DFN)) Q:'DFN  S PSIV("NME")=$P($G(^DPT(DFN,0)),U) D INP^VADPT F ON=0:0 S ON=$O(^PS(55,"AIV",PSIVDT1,DFN,ON)) Q:'ON  Q:NOFLG=1  D SETP I PSJOK D MAN3
"RTN","PSIVWL",27,0)
 Q
"RTN","PSIVWL",28,0)
MAN2 S ^PS(55,"PSIVWL",PSIVSN,$S($P(VAIN(4),U,2)]"":$P(VAIN(4),U,2),1:"Outpatient IV"),P(4)_PSIVOD(P(4)),DFN,ON)=$S($P(P(8),"@",2)'=0:PSGCNT,1:0)_"^"_PSGSA_"^"_$P(^PS(55,DFN,"IV",ON,0),"^",16)
"RTN","PSIVWL",29,0)
 ;naked reference on line below refers to full global reference to right of = sign
"RTN","PSIVWL",30,0)
 S $P(^(0),"^",16)=$P(^PS(55,DFN,"IV",ON,0),"^",16)+PSGCNT Q
"RTN","PSIVWL",31,0)
 Q
"RTN","PSIVWL",32,0)
MAN3 ;I P(4)=""!(P(4)'=PSIVT) S NOFLG=1 D NOW^%DTC S PSIVRUN=$E(%,1,12) K %,%I,%H D HDR^PSIVWL1 W !!,"****NO DATA FOUND FOR THIS REPORT!***" Q
"RTN","PSIVWL",33,0)
 Q:P(4)=""!(P(4)'=PSIVT)
"RTN","PSIVWL",34,0)
 Q:'$D(PSIVOD(P(4)))!("DPN"[P(17))!($S($D(^PS(55,DFN,"IV",ON,2)):PSIVSN'=$P(^(2),"^",2),1:0))
"RTN","PSIVWL",35,0)
 I "OH"[P(17) S PSGSA="",PSGCNT=0 D MAN2 Q
"RTN","PSIVWL",36,0)
 S CD=$S(PSIVCD(PSIVT)<P(3):PSIVCD(PSIVT),1:P(3)),OD=$S(P(2)>PSIVOD(PSIVT):P(2),1:PSIVOD(PSIVT)) D ENP3,MAN2 Q
"RTN","PSIVWL",37,0)
QUE S ZTIO=PSIVPR,ZTDESC="IV WARD LIST",ZTRTN="DEQ^PSIVWL",PSIVT="" F I=0:0 S PSIVT=$O(PSIVMT(PSIVT)) Q:PSIVT=""  S (ZTSAVE("PSIVCD("""_PSIVT_""")"),ZTSAVE("PSIVMT("""_PSIVT_""")"),ZTSAVE("PSIVOD("""_PSIVT_""")"))=""
"RTN","PSIVWL",38,0)
 F X="PSIVSN","PSIVDT","PSIVSITE","PSJSYSW0","PSJSYSP0","PSJSYSU" S ZTSAVE(X)=""
"RTN","PSIVWL",39,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"Queued." Q
"RTN","PSIVWL",40,0)
ENP3 ;
"RTN","PSIVWL",41,0)
 ;Needs DFN,ON P-array, OD and CD
"RTN","PSIVWL",42,0)
 Q:'P(2)!'P(3)  S PSIVMI=P(15),PSIVSD=P(2),PSGSA="",PSGCNT=0 S:PSIVMI>1440 P(11)=""
"RTN","PSIVWL",43,0)
 I P(11) G:"AH"[P(4) QSP F X="STAT","ONCE","NOW","ONE-TIME","ONE TIME","ONETIME","1-TIME","1 TIME","1-TIME" I $S(X=P(9):1,1:(P(9)[X)),PSIVSD'<OD,PSIVSD'>CD S PSGSA=PSIVSD_" " G QSP
"RTN","PSIVWL",44,0)
 I P(4)="P"!(P(5))!(P(23)="P"),P(11) D CHK,ENP4 G QSP
"RTN","PSIVWL",45,0)
 G:P(11) QSP I PSIVMI,OD\1>(PSIVSD\1) S X1=OD,X2=PSIVSD D ^%DTC I X>1 S X=X-1,PSIVMIN=X*1440\PSIVMI*PSIVMI D ENT S PSIVSD=Y
"RTN","PSIVWL",46,0)
 I PSIVSD'<OD,PSIVSD<CD S Y=PSIVSD,PSGSA=Y_" "
"RTN","PSIVWL",47,0)
 I PSIVMI F X=0:0 S PSIVMIN=PSIVMI D ENT Q:Y>CD!(Y=CD&(CD=P(3)))  S PSIVSD=Y I Y'<OD,Y'>CD S:$L(PSGSA)+$L(Y)'>240 PSGSA=PSGSA_$S(PSGSA'="":"."_$P(Y,".",2),1:Y)_" "
"RTN","PSIVWL",48,0)
QSP S PSGCNT=$L(PSGSA," ")-1 K PSIVMI,OD,CD,PSIVSD Q
"RTN","PSIVWL",49,0)
CHK F Y=1:1 Q:$L(P(11))>240!($P(P(11),"-",Y)="")  S $P(P(11),"-",Y)=$P(P(11),"-",Y)_$E("0000",1,4-$L($P(P(11),"-",Y)))
"RTN","PSIVWL",50,0)
 Q
"RTN","PSIVWL",51,0)
ENP4 Q:PSIVSD>CD  S PSIVSD=OD\1 I $G(P(2)),PSIVSD<P(2) S PSIVSD=P(2)\1
"RTN","PSIVWL",52,0)
 NEW ODCDWD,ADM,ADMSD,ADMTM,PSIVX,P9
"RTN","PSIVWL",53,0)
 F X=OD,CD D DW^%DTC S ODCDWD=$G(ODCDWD)_$E(X,1,3)_U
"RTN","PSIVWL",54,0)
 I +$O(^PS(51.1,"APPSJ",P(9),0)) S PSIVX=1 S P9=$P(P(9),"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVWL",55,0)
 . I '("MON,TUE,WED,THU,FRI,SAT,SUN,"[$P(P9,"-",X)) S PSIVX=0 Q
"RTN","PSIVWL",56,0)
 . I ODCDWD[$E($P(P9,"-",X),1,2) D
"RTN","PSIVWL",57,0)
 .. S ADMSD=$S($P(ODCDWD,"^")[$P(P9,"-",X):OD,1:CD)\1
"RTN","PSIVWL",58,0)
 .. F ADM=1:1:$L(P(11),"-") S ADMTM=$P(P(11),"-",ADM) I OD'>(ADMSD_"."_ADMTM),(CD'<(ADMSD_"."_ADMTM)) S PSGSA=PSGSA_$S(PSGSA'="":"",1:ADMSD)_"."_ADMTM_" "
"RTN","PSIVWL",59,0)
 .. ;F ADM=1:1:$L(P(11),"-") S ADMTM=$P(P(11),"-",ADM) I OD'>(ADMSD_"."_ADMTM),(CD'<(ADMSD_"."_ADMTM)) S PSGSA=PSGSA_$S(PSGSA'="":"",1:PSIVSD)_"."_ADMTM_" "
"RTN","PSIVWL",60,0)
 Q:+$G(PSIVX)
"RTN","PSIVWL",61,0)
 I '$D(^PS(51.1,"APPSJ",P(9))) S PSIVX=1,P9=$P(P(9),"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVWL",62,0)
 . I '(",MO,TU,WE,TH,FR,SA,SU,"[(","_$P(P9,"-",X)_",")) S PSIVX=0 Q
"RTN","PSIVWL",63,0)
 . I ODCDWD[$E($P(P9,"-",X),1,2) D
"RTN","PSIVWL",64,0)
 .. S ADMSD=$S($P(ODCDWD,"^")[$P(P9,"-",X):OD,1:CD)\1
"RTN","PSIVWL",65,0)
 .. F ADM=1:1:$L(P(11),"-") S ADMTM=$P(P(11),"-",ADM) I OD'>(ADMSD_"."_ADMTM),(CD'<(ADMSD_"."_ADMTM)) S PSGSA=PSGSA_$S(PSGSA'="":"",1:ADMSD)_"."_ADMTM_" "
"RTN","PSIVWL",66,0)
 .. ;F ADM=1:1:$L(P(11),"-") S ADMTM=$P(P(11),"-",ADM) I OD'>(ADMSD_"."_ADMTM),(CD'<(ADMSD_"."_ADMTM)) S PSGSA=PSGSA_$S(PSGSA'="":"",1:PSIVSD)_"."_ADMTM_" "
"RTN","PSIVWL",67,0)
 Q:+$G(PSIVX)
"RTN","PSIVWL",68,0)
 F Y=1:1 S (PSIVMI,MI)=$P(P(11),"-",Y),PSIVSD=+(PSIVSD\1_"."_MI) Q:PSIVSD>CD  X:MI="" "S X1=PSIVSD,X2=1 D C^%DTC S PSIVSD=X,Y=0" I MI,PSIVSD'<OD,PSIVSD'>CD,PSIVSD'=P(3),'P(7) S PSGSA=PSGSA_$S(PSGSA'="":"."_$P(PSIVSD,".",2),1:PSIVSD)_" "
"RTN","PSIVWL",69,0)
 ; INSTALL PRECEEDING LINE WITH VERSION 17.3 OF FILEMAN
"RTN","PSIVWL",70,0)
 Q
"RTN","PSIVWL",71,0)
ENT ;PSIVMIN=# of min. to add or sub, PSIVSD=date to add or sub from in FM format -- Answer ret. in 'Y'
"RTN","PSIVWL",72,0)
 S X2=PSIVMIN\1440,HOUR=(PSIVMIN-(1440*X2))\60,MIN=(PSIVMIN-(1440*X2)-(60*HOUR))#$S(PSIVMIN<0:-60,1:60),X1=PSIVSD\1,HR=$E(PSIVSD,9,10),MI=$E(PSIVSD,11,12)
"RTN","PSIVWL",73,0)
 S:$L(HR)=1 HR=HR_0 S:$L(MI)=1 MI=MI_0 S MI=MI+MIN S:MI>59 MI=MI-60,HR=HR+1
"RTN","PSIVWL",74,0)
 S:MI<0 MI=MI+60,HR=HR-1 S HR=HR+HOUR S:HR>23 HR=HR-24,X2=X2+1 S:HR<0 HR=HR+24,X2=X2-1 S:HR+MI=0 X2=X2-1,HR=24,MI=0 S:HR<10 HR=0_HR S:MI<10 MI=0_MI S X=X1 D:X2 C^%DTC S X=$P(X,".") S Y=+(X_"."_HR_MI)
"RTN","PSIVWL",75,0)
 ; install with verson 17.3 of fm
"RTN","PSIVWL",76,0)
 K HR,MI,X1,X2,HOUR,MIN,PSIVMIN,O,MI Q
"RTN","PSJ0111")
0^^B1276964
"RTN","PSJ0111",1,0)
PSJ0111 ;BIR/JLC - Check for Non-Standard Schedules ;01-MAR-04
"RTN","PSJ0111",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**111**;16 DEC 97
"RTN","PSJ0111",3,0)
 ;
"RTN","PSJ0111",4,0)
 ;Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJ0111",5,0)
 ;
"RTN","PSJ0111",6,0)
 Q
"RTN","PSJ0111",7,0)
SENDMSG ;Send mail message when check is complete.
"RTN","PSJ0111",8,0)
 K PSG,XMY S XMDUZ="MEDICATIONS,INPATIENT",XMSUB="SCHEDULE FILE (#51.1)",XMTEXT="^XTMP(""PSJ"",1,",XMY("G.PHARMACY SCHEDULES@FO-BIRM.MED.VA.GOV")=""
"RTN","PSJ0111",9,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","PSJ0111",10,0)
 S OCNT=0,A="^PS(51.1,0)" F  S A=$Q(@A) Q:A=""  Q:$P(A,",",2)'?1.N  S OCNT=OCNT+1,^XTMP("PSJ",1,OCNT)=A_" = "_@A
"RTN","PSJ0111",11,0)
 D ^XMD
"RTN","PSJ0111",12,0)
 Q
"RTN","PSJ0111",13,0)
 ;
"RTN","PSJADT0")
0^51^B30353145
"RTN","PSJADT0",1,0)
PSJADT0 ;BIR/CML3,PR,MLM-AUTO DC/HOLD CANCEL ;11 Aug 98 / 8:25 AM
"RTN","PSJADT0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**17,111**;16 DEC 97
"RTN","PSJADT0",3,0)
 ;
"RTN","PSJADT0",4,0)
 ;Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSJADT0",5,0)
 ;Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSJADT0",6,0)
 ;
"RTN","PSJADT0",7,0)
ENDC ; dc active orders first, then non-verified orders
"RTN","PSJADT0",8,0)
 W:'$D(PSJQUIET)&'$D(DGQUIET) !,"...discontinuing Inpatient Medication orders..."
"RTN","PSJADT0",9,0)
 S $P(PSJPIND,"^")=""
"RTN","PSJADT0",10,0)
 D NOW^%DTC N PSJDCDT S (PSJDCDT,PSGDT)=+%,PSJSYSW0="" I PSJFW S PSJSYSW=$O(^PS(59.6,"B",PSJFW,0)) S:PSJSYSW PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJADT0",11,0)
 I PSGALO=1010!(PSGALO=1030)!(PSGALO=1050) D AUDDD
"RTN","PSJADT0",12,0)
 D ENUNM^PSGOU S PSGALR=10,DIE="^PS(55,"_PSGP_",5," S:PSJFW PSGTOL=1,PSGUOW=PSJFW,PSGTOO=1
"RTN","PSJADT0",13,0)
 F PSJS=PSGDT:0 S PSJS=$O(^PS(55,PSGP,5,"AUS",PSJS)) Q:'PSJS  F PSJDA=0:0 S PSJDA=$O(^PS(55,PSGP,5,"AUS",PSJS,PSJDA)) Q:'PSJDA  D
"RTN","PSJADT0",14,0)
 .Q:'$$DCIMO(PSGP,PSJDA,"U") 
"RTN","PSJADT0",15,0)
 .;first naked reference below refers to the full global reference to the right of the = sign (inside the $S)
"RTN","PSJADT0",16,0)
 .K DA S DA(1)=PSGP,DA=PSJDA,PSGAL("C")=0,$P(^(2),"^",3)=$S($D(^PS(55,PSGP,5,DA,2)):$P(^(2),"^",4),1:""),DIE="^PS(55,"_PSGP_",5,",DR="28////D;Q;34////"_PSJDCDT_";49////1" D ^PSGAL5,^DIE,EN1^PSJHL2(PSGP,"OD",PSJDA_"U","AUTO DC")
"RTN","PSJADT0",17,0)
 .I PSGALO'=1050 S DA=PSJDA,^PS(55,"AUE",PSGP,DA)="" I $P(PSJSYSW0,"^",15),(PSGALO'<1060) S $P(^PS(55,PSGP,5,PSJDA,7),"^",1,2)=PSJDCDT_"^D" D ENL^PSGVDS
"RTN","PSJADT0",18,0)
 S DIE="^PS(53.1,",DR="28////D;42////1",PSGTOO=2 F PSJDA=0:0 S PSJDA=$O(^PS(53.1,"AC",PSGP,PSJDA)) Q:'PSJDA  D
"RTN","PSJADT0",19,0)
 .Q:'$$DCIMO(PSGP,PSJDA,"P")
"RTN","PSJADT0",20,0)
 .I PSGALO'<1060,$P(PSJSYSW0,U,15),$P($G(^PS(53.1,PSJDA,0)),U,9)="N" K DA D ENLBL^PSIVOPT(PSGTOL,PSGUOW,DFN,2,+PSJDA,"AD")
"RTN","PSJADT0",21,0)
 .K DA S DA=PSJDA D ^DIE I $P($G(^PS(53.1,DA,0)),"^",21) D EN1^PSJHL2(PSGP,"OC",PSJDA_"P","AUTO DC")
"RTN","PSJADT0",22,0)
 ;
"RTN","PSJADT0",23,0)
ENIV ;
"RTN","PSJADT0",24,0)
 S DFN=PSGP F PSJIVON=0:0 S PSJIVON=$O(^PS(55,DFN,"IV",PSJIVON)) Q:'PSJIVON  S Y=$G(^(PSJIVON,0)) I "PDEN"'[$P(Y,U,17) S P(17)=$P(Y,U,17),P(3)=$P(Y,U,3) D DC
"RTN","PSJADT0",25,0)
 Q
"RTN","PSJADT0",26,0)
DC ;
"RTN","PSJADT0",27,0)
 Q:'$$DCIMO(DFN,PSJIVON,"V")
"RTN","PSJADT0",28,0)
 S (ON,ON55)=PSJIVON_"V" D NOW^%DTC I P(17)="H",P(3)<% D SIVDIE S DR="100///E" D ^DIE,EXPIR^PSIVOE Q
"RTN","PSJADT0",29,0)
 ;;K PSIVALT S PSIVAC="AD",PSIVALCK="STOP",PSIVREA="D",PSIVAL=$P($G(^PS(53.3,+PSGALO,0)),U) D D1^PSIVOPT2,AUTO^PSIVOE,LOG^PSIVORAL D SIVDIE S DR=".03////"_PSJDCDT_";121////1" D ^DIE,EN1^PSJHL2(DFN,"OD",+ON_"V","AUTO DC")
"RTN","PSJADT0",30,0)
 K PSIVALT S PSIVAC="AD",PSIVALCK="STOP",PSIVREA="D",PSIVAL=$S('+$G(PSGALO):$G(PSIVRES),1:$P($G(^PS(53.3,+PSGALO,0)),U)) D D1^PSIVOPT2,LOG^PSIVORAL D SIVDIE S DR=".03////"_PSJDCDT_";121////1" D ^DIE,EN1^PSJHL2(DFN,"OD",+ON_"V","AUTO DC")
"RTN","PSJADT0",31,0)
 S PSJIVDCF=1
"RTN","PSJADT0",32,0)
 Q
"RTN","PSJADT0",33,0)
 ;
"RTN","PSJADT0",34,0)
SIVDIE ; Setup DIE,DA for IV
"RTN","PSJADT0",35,0)
 K DA,DIE,DR S DA=+ON,DA(1)=DFN,DIE="^PS(55,"_DFN_",""IV"","
"RTN","PSJADT0",36,0)
 Q
"RTN","PSJADT0",37,0)
 ;
"RTN","PSJADT0",38,0)
AUDDD ; set up orders for discharge report and purging
"RTN","PSJADT0",39,0)
 S DIS=+VAIP(17,1) I $S('DIS:1,1:$D(^PS(55,"AUDDD",DIS,PSGP))) Q
"RTN","PSJADT0",40,0)
 S X=$$EN^PSGCT(+VAIP(13,1),-1)
"RTN","PSJADT0",41,0)
 F Q=X:0 S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q  F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $S($D(^PS(55,PSGP,5,QQ,0)):'$P(^(0),"^",20),1:1) S $P(^(0),"^",20)=DIS,^PS(55,"AUDDD",DIS,PSGP,QQ)=""
"RTN","PSJADT0",42,0)
 Q
"RTN","PSJADT0",43,0)
 ;
"RTN","PSJADT0",44,0)
ENHE ; status from hold to expired
"RTN","PSJADT0",45,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12),DIE="^PS(55,"_PSGP_",5,"
"RTN","PSJADT0",46,0)
 F PSJS=+PSJPAD:0 S PSJS=$O(^PS(55,PSGP,5,"AUS",PSJS)) Q:'PSJS  Q:PSJS>PSGDT  F PSJDA=0:0 S PSJDA=$O(^PS(55,PSGP,5,"AUS",PSJS,PSJDA)) Q:'PSJDA  K DA S DA(1)=PSGP,DA=PSJDA I $D(^PS(55,PSGP,5,DA,0)),$P(^(0),"^",9)="H" S DR="28////E" D ^DIE
"RTN","PSJADT0",47,0)
 Q
"RTN","PSJADT0",48,0)
 ;
"RTN","PSJADT0",49,0)
ENUNDC(PSJDCDT,PSGP,PSJUOW,PSGALO) ; Auto-reinstate orders DC'ed due to a patient movement.
"RTN","PSJADT0",50,0)
 N PSJSYSW0 D NOW^%DTC S PSJUNDC=1,PSGDT=%,PSJFIRST='$D(PSJQUIET),PSJSYSW0=$G(^PS(59.6,+$O(^PS(59.6,"B",+PSJUOW,0)),0))
"RTN","PSJADT0",51,0)
 S PSJS=$O(^PS(55,PSGP,5,"AUS",PSJDCDT-.0002)) F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,5,"AUS",+PSJS,PSGORD)) Q:'PSGORD  D
"RTN","PSJADT0",52,0)
 .I $P($G(^PS(55,PSGP,5,PSGORD,0)),U,9)["D",$P($G(^(4)),U,11) D DISREIN,ENRI^PSGOERI
"RTN","PSJADT0",53,0)
 ;
"RTN","PSJADT0",54,0)
 S:PSJS="" PSJS=$O(^PS(55,PSGP,"IV","AIS",PSJDCDT-.0002))
"RTN","PSJADT0",55,0)
 F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,"IV","AIS",+PSJS,PSGORD)) Q:'PSGORD  D
"RTN","PSJADT0",56,0)
 .I $P($G(^PS(55,PSGP,"IV",PSGORD,0)),U,12),$P($G(^(2)),U,7)>PSGDT S P(3)=$P($G(^(0)),U,3) D DISREIN,ENARI^PSIVOPT(PSGP,PSGORD,+PSJUOW,PSGALO)
"RTN","PSJADT0",57,0)
 I $D(^TMP("PSJUNDC")) S ^TMP("PSJUNDC",$J,DFN)=$P(^DPT(DFN,0),"^")_"^"_$G(^DPT(PSGP,.1))_"^"_PSGALO D ^PSJADT2
"RTN","PSJADT0",58,0)
 ;
"RTN","PSJADT0",59,0)
ENKL ;
"RTN","PSJADT0",60,0)
 F UW=0:0 S UW=$O(^PS(53.41,1,1,UW)) Q:'UW  D  I '$O(^PS(53.41,1,1,0)) K DA S DA=1,DIK="^PS(53.41," D ^DIK
"RTN","PSJADT0",61,0)
 .F PSGP=0:0 S PSGP=$O(^PS(53.41,1,1,UW,1,PSGP)) Q:'PSGP  D  I '$O(^PS(53.41,1,1,UW,1,0)) K DA S DIK="^PS(53.41,1,1,",DA(1)=1,DA=UW D ^DIK
"RTN","PSJADT0",62,0)
 ..F TO=0:0 S TO=$O(^PS(53.41,1,1,UW,1,PSGP,1,TO)) Q:'TO  D  I '$O(^PS(53.41,1,1,UW,1,PSGP,1,0)) K DA S DA(2)=1,DA(1)=UW,DA=PSGP,DIK="^PS(53.41,1,1,"_UW_",1," D ^DIK
"RTN","PSJADT0",63,0)
 ...I '$O(^PS(53.41,1,1,UW,1,PSGP,1,TO,1,0))  K DA S DA(3)=1,DA(2)=UW,DA(1)=PSGP,DA=TO,DIK="^PS(53.41,1,1,"_UW_",1,"_PSGP_",1," D ^DIK
"RTN","PSJADT0",64,0)
 K DA,DIK,P,PSGDT,PSGP,PSGORD,PSJS,PSJUNDC,TO,UW
"RTN","PSJADT0",65,0)
 Q
"RTN","PSJADT0",66,0)
 ;
"RTN","PSJADT0",67,0)
DISREIN ; Display reinstate msg. for first order.
"RTN","PSJADT0",68,0)
 W:PSJFIRST&'$D(DGQUIET) !,"...reinstating Inpatient Medication orders..." S PSJFIRST=0
"RTN","PSJADT0",69,0)
 Q
"RTN","PSJADT0",70,0)
 ;
"RTN","PSJADT0",71,0)
DCIMO(DFN,ON,TYP) ; Check parameter before DC'ing clinic order
"RTN","PSJADT0",72,0)
 S DCIMO=$P($G(^PS(59.7,1,26)),"^",8) Q:DCIMO 1
"RTN","PSJADT0",73,0)
 N GLO,IMOND S GLO=$S(TYP="P":"^PS(53.1,",TYP="U":"^PS(55,"_DFN_",5,",TYP="V":"^PS(55,"_PSGP_",""IV"",",1:"") I TYP="" Q 1
"RTN","PSJADT0",74,0)
 S IMOND=$S(TYP="P"!(TYP="V"):"""DSS""",TYP="U":8,1:"") I IMOND="" Q 1
"RTN","PSJADT0",75,0)
 S GLO=GLO_+ON_","_IMOND_")" Q:$$CLINIC^PSJBCMA($G(@(GLO))) 0
"RTN","PSJADT0",76,0)
 Q:$$CLINIC^PSJBCMA($G(CLINIC)) 0
"RTN","PSJADT0",77,0)
 Q 1
"RTN","PSJBCMA")
0^83^B61037114
"RTN","PSJBCMA",1,0)
PSJBCMA ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) ;16 Mar 99 / 10:13 AM
"RTN","PSJBCMA",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**32,41,46,57,63,66,56,69,58,81,91,104,111**;16 DEC 97
"RTN","PSJBCMA",3,0)
 ;
"RTN","PSJBCMA",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJBCMA",5,0)
 ; Reference to ^PS(51 is supported by DBIA 2176.
"RTN","PSJBCMA",6,0)
 ; Reference to ^PS(51.1 is supported by DIBA 2177.
"RTN","PSJBCMA",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJBCMA",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJBCMA",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJBCMA",10,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBCMA",11,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJBCMA",12,0)
 ; Usage of this routine by BCMA is supported by DBIA 2828.
"RTN","PSJBCMA",13,0)
 ;
"RTN","PSJBCMA",14,0)
EN(DFN,BDT,OTDATE)         ; return condensed list of inpat meds
"RTN","PSJBCMA",15,0)
 NEW CNT,DN,F,FON,ON,PST,WBDT,X,X1,X2,Y,%
"RTN","PSJBCMA",16,0)
 D:+$G(DFN) ORDER
"RTN","PSJBCMA",17,0)
 I '$D(^TMP("PSJ",$J,1,0)) S ^(0)=-1
"RTN","PSJBCMA",18,0)
 K PSJINX
"RTN","PSJBCMA",19,0)
 Q
"RTN","PSJBCMA",20,0)
ORDER ;Loop thru the orders.
"RTN","PSJBCMA",21,0)
 I '+$G(BDT) D NOW^%DTC S BDT=%
"RTN","PSJBCMA",22,0)
 I BDT'["." S BDT=BDT_".0001"
"RTN","PSJBCMA",23,0)
 S PSJINX=0
"RTN","PSJBCMA",24,0)
 ;* U/D orders
"RTN","PSJBCMA",25,0)
 S F="^PS(55,DFN,5,",WBDT=BDT
"RTN","PSJBCMA",26,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",27,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S FON=ON_"U",PSJON(FON)="" D UDVAR
"RTN","PSJBCMA",28,0)
 ;* IV orders
"RTN","PSJBCMA",29,0)
 S F="^PS(55,DFN,""IV"",",WBDT=BDT
"RTN","PSJBCMA",30,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",31,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S FON=ON_"V",PSJON(FON)="" D IVVAR
"RTN","PSJBCMA",32,0)
 ;* Pending orders
"RTN","PSJBCMA",33,0)
 S F="^PS(53.1,"
"RTN","PSJBCMA",34,0)
 F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  D
"RTN","PSJBCMA",35,0)
 . S FON=ON_"P"
"RTN","PSJBCMA",36,0)
 . S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="F":"IVVAR",1:"UDVAR")
"RTN","PSJBCMA",37,0)
 ;* One-time orders
"RTN","PSJBCMA",38,0)
 ;* When a one-time order is found, check against PSJON(FON) array to
"RTN","PSJBCMA",39,0)
 ;* make sure no duplicate orders is return on ^TMP.
"RTN","PSJBCMA",40,0)
 I '+$G(OTDATE) D NOW^%DTC S X1=$E(%,1,12),X2=-30 D C^%DTC S OTDATE=X
"RTN","PSJBCMA",41,0)
 I OTDATE'["." S OTDATE=OTDATE_".0001"
"RTN","PSJBCMA",42,0)
 Q:BDT'>OTDATE
"RTN","PSJBCMA",43,0)
 S F="^PS(55,DFN,5,",WBDT=OTDATE
"RTN","PSJBCMA",44,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AU","O",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",45,0)
 .  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AU","O",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",46,0)
 .. S FON=ON_"U" D:'$D(PSJON(FON)) UDVAR
"RTN","PSJBCMA",47,0)
 S F="^PS(55,DFN,""IV"",",WBDT=OTDATE
"RTN","PSJBCMA",48,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",49,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",50,0)
 .. S X=$P($G(^PS(55,DFN,"IV",ON,0)),U,9)
"RTN","PSJBCMA",51,0)
 .. I X]"",$$ONE(DFN,ON_"V",X,$P(X,"^",2),$P(X,"^",3))="O" D
"RTN","PSJBCMA",52,0)
 ... S FON=ON_"V" D:'$D(PSJON(FON)) IVVAR
"RTN","PSJBCMA",53,0)
 K PSJON
"RTN","PSJBCMA",54,0)
 Q
"RTN","PSJBCMA",55,0)
 ;
"RTN","PSJBCMA",56,0)
UDVAR ;* Set ^TMP for Unit dose & Pending orders
"RTN","PSJBCMA",57,0)
 D UDPEND Q:$$CLINIC($G(CLINIC))
"RTN","PSJBCMA",58,0)
 D TMP
"RTN","PSJBCMA",59,0)
 ;* Setup Dispense drug for ^TMP
"RTN","PSJBCMA",60,0)
 S CNT=0 D NOW^%DTC
"RTN","PSJBCMA",61,0)
 F X=0:0 S X=$O(@(F_ON_",1,"_X_")")) Q:'X  D
"RTN","PSJBCMA",62,0)
 . S PSJDD=@(F_ON_",1,"_X_",0)") I $P(PSJDD,"^",3)]"",$P(PSJDD,"^",3)'>% Q
"RTN","PSJBCMA",63,0)
 . S CNT=CNT+1
"RTN","PSJBCMA",64,0)
 . S ^TMP("PSJ",$J,PSJINX,700,CNT,0)=+PSJDD_U_$P($G(^PSDRUG(+PSJDD,0)),U)_U_$S((FON["U")&($P(PSJDD,U,2)=""):1,(FON["U")&($E($P(PSJDD,U,2))="."):"0"_$P(PSJDD,U,2),1:$P(PSJDD,U,2))_U_$P(PSJDD,U,3)
"RTN","PSJBCMA",65,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,700,0)=CNT
"RTN","PSJBCMA",66,0)
 K PSJ,PSJDD
"RTN","PSJBCMA",67,0)
 Q
"RTN","PSJBCMA",68,0)
IVVAR ;* Set variables for IV and pending orders
"RTN","PSJBCMA",69,0)
 NEW ND,X,Y
"RTN","PSJBCMA",70,0)
 I FON["P" D UDPEND Q:$$CLINIC(CLINIC)  S PSJ("INFRATE")=$P($G(^PS(53.1,ON,8)),U,5)
"RTN","PSJBCMA",71,0)
 I FON["V" D  Q:$$CLINIC(CLINIC)
"RTN","PSJBCMA",72,0)
 . S X=$G(^PS(55,DFN,"IV",ON,0)),CLINIC=$G(^("DSS")) Q:$$CLINIC(CLINIC)
"RTN","PSJBCMA",73,0)
 . S PSJ("STARTDT")=$P(X,U,2),PSJ("STOPDT")=$P(X,U,3)
"RTN","PSJBCMA",74,0)
 . S PSJ("INFRATE")=$P(X,U,8),PSJ("SCHD")=$P(X,U,9)
"RTN","PSJBCMA",75,0)
 . S PSJ("ADM")=$P(X,U,11),PSJ("AUTO")=$P(X,U,12),PSJ("STATUS")=$P(X,U,17)
"RTN","PSJBCMA",76,0)
 . S PSJ("IVTYPE")=$P(X,U,4),PSJ("INSYR")=$P(X,U,5)
"RTN","PSJBCMA",77,0)
 . S PSJ("CPRS")=$P(X,U,21),PSJ("CHEMO")=$P(X,U,23)
"RTN","PSJBCMA",78,0)
 . S X=$G(^PS(55,DFN,"IV",ON,.2))
"RTN","PSJBCMA",79,0)
 . S PSJ("DO")="",PSJ("MR")=$P(X,U,3)
"RTN","PSJBCMA",80,0)
 . S PSJ("OI")=+X
"RTN","PSJBCMA",81,0)
 . S X=$G(^PS(55,DFN,"IV",ON,2))
"RTN","PSJBCMA",82,0)
 . S PSJ("PREV")=$P(X,U,5) I PSJ("PREV")["V",(+PSJ("PREV")=+ON) S PSJ("PREV")=""
"RTN","PSJBCMA",83,0)
 . S PSJ("FOLLOW")=$P(X,U,6),PSJ("RFO")=$P(X,U,9) I PSJ("FOLLOW")["V",(+PSJ("FOLLOW")=+ON) S (PSJ("FOLLOW"),PSJ("RFO"))=""
"RTN","PSJBCMA",84,0)
 . S PSJ("SIOPI")=$S($P($G(^PS(55,DFN,"IV",+ON,3)),"^",2):"!",1:"")_$P($G(^(3)),"^")
"RTN","PSJBCMA",85,0)
 . N SCHD S SCHD=PSJ("SCHD")
"RTN","PSJBCMA",86,0)
 . S PSJ("STC")=$$ONE(DFN,ON_"V",SCHD,PSJ("STARTDT"),PSJ("STOPDT"))
"RTN","PSJBCMA",87,0)
 . I PSJ("STC")=""!(PSJ("STC")="C") S PSJ("STC")=$S(SCHD["PRN":"P",1:"C")
"RTN","PSJBCMA",88,0)
 . I PSJ("STC")="C" S PSJ("STC")=$S(SCHD["ON CALL":"OC",SCHD["ON-CALL":"OC",SCHD["ONCALL":"OC",1:"C")
"RTN","PSJBCMA",89,0)
 D TMP
"RTN","PSJBCMA",90,0)
 S CNT=0
"RTN","PSJBCMA",91,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  D
"RTN","PSJBCMA",92,0)
 . S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$G(^PS(52.6,+ND,0)) ;,AOINAME=$$OIDF^PSJLMUT1(+$P(DN,U,11)) I AOINAME["NOTFOUND" S AOINAME=""
"RTN","PSJBCMA",93,0)
 . ;S AOIDF=$$GET1^DIQ(50.7,+$P(DN,U,11),.02) I AOINAME="" S AOIDF=""
"RTN","PSJBCMA",94,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,850,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(ND,U,3) ;_U_U_$P(DN,U,11)_U_AOINAME_U_AOIDF
"RTN","PSJBCMA",95,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,850,0)=CNT,CNT=0
"RTN","PSJBCMA",96,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  D
"RTN","PSJBCMA",97,0)
 . S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)) ;,SOINAME=$$OIDF^PSJLMUT1(+$P(DN,U,11)) I SOINAME["NOTFOUND" S SOINAME=""
"RTN","PSJBCMA",98,0)
 . ;S SOIDF=$$GET1^DIQ(50.7,+$P(DN,U,11),.02) I SOINAME="" S SOIDF=""
"RTN","PSJBCMA",99,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,950,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4) ;_U_U_$P(DN,U,11)_U_SOINAME_U_SOIDF
"RTN","PSJBCMA",100,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,950,0)=CNT
"RTN","PSJBCMA",101,0)
 K PSJ
"RTN","PSJBCMA",102,0)
 S X1=0
"RTN","PSJBCMA",103,0)
 F  S X1=$O(^PS(55,DFN,"IVBCMA",X1)) Q:'X1  D
"RTN","PSJBCMA",104,0)
 . S XX=$G(^PS(55,DFN,"IVBCMA",X1,0)) Q:ON'=$P(XX,"^",2)  S PSJBCID=$P(XX,"^"),X2=0
"RTN","PSJBCMA",105,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"AD",X2)) Q:'X2  S X=^(X2,0),^TMP("PSJ",$J,PSJINX,800,PSJBCID,I)=+X_"^"_$S($D(^PS(52.6,+X,0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",106,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,800,PSJBCID,0)=I-1
"RTN","PSJBCMA",107,0)
 . S X2=0
"RTN","PSJBCMA",108,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"SOL",X2)) Q:'X2  S X=^(X2,0),^TMP("PSJ",$J,PSJINX,900,PSJBCID,I)=$P(X,"^")_"^"_$S($D(^PS(52.7,$P(X,"^"),0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",109,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,900,PSJBCID,0)=I-1
"RTN","PSJBCMA",110,0)
 Q
"RTN","PSJBCMA",111,0)
UDPEND ;
"RTN","PSJBCMA",112,0)
 S X=$G(@(F_ON_",0)")) I $P(F,",")[53.1 S CLINIC=$G(@(F_ON_",""DSS"")")) Q:$$CLINIC(CLINIC)
"RTN","PSJBCMA",113,0)
 I $P(F,",")[55 S CLINIC=$G(@(F_ON_",8)")) Q:$$CLINIC(CLINIC)
"RTN","PSJBCMA",114,0)
 S PSJ("MR")=$P(X,U,3),PSJ("SM")=$P(X,U,5),PSJ("HSM")=$P(X,U,6)
"RTN","PSJBCMA",115,0)
 S PSJ("ST")=$P(X,U,7),PSJ("STATUS")=$P(X,U,9)
"RTN","PSJBCMA",116,0)
 S PSJ("CPRS")=$P(X,U,21),PSJ("PREV")=$P(X,U,25),PSJ("FOLLOW")=$P(X,U,26),PSJ("RFO")=$P(X,U,27)
"RTN","PSJBCMA",117,0)
 S:FON["U" PSJ("NGIVEN")=$P(X,U,22)
"RTN","PSJBCMA",118,0)
 S X=$G(@(F_ON_",.2)"))
"RTN","PSJBCMA",119,0)
 S PSJ("DO")=$P(X,U,2)
"RTN","PSJBCMA",120,0)
 S PSJ("OI")=+X
"RTN","PSJBCMA",121,0)
 S X=$G(@(F_ON_",2)"))
"RTN","PSJBCMA",122,0)
 S PSJ("SCHD")=$P(X,U),PSJ("STARTDT")=$P(X,U,2)
"RTN","PSJBCMA",123,0)
 S PSJ("STOPDT")=$P(X,U,4),PSJ("ADM")=$P(X,U,5)
"RTN","PSJBCMA",124,0)
 S X=$G(@(F_ON_",4)"))
"RTN","PSJBCMA",125,0)
 S PSJ("AUTO")=$P(X,U,11)
"RTN","PSJBCMA",126,0)
 ;the naked reference on the line below refers to the full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJBCMA",127,0)
 S PSJ("SIOPI")=$S($P($G(@(F_ON_",6)")),"^",2):"!",1:"")_$$ENSET($P($G(^(6)),"^"))
"RTN","PSJBCMA",128,0)
 D SIOPI
"RTN","PSJBCMA",129,0)
 S PSJ("STC")=PSJ("ST")
"RTN","PSJBCMA",130,0)
 I PSJ("ST")="R"!(PSJ("ST")="C") S PSJ("STC")=$S(PSJ("SCHD")["PRN":"P","^ONCALL^ON-CALL^ON CALL^"[("^"_PSJ("SCHD")_"^"):"OC",$$ONE(DFN,FON,PSJ("SCHD"))="O":"O",1:"C")
"RTN","PSJBCMA",131,0)
 Q 
"RTN","PSJBCMA",132,0)
TMP ;* Setup ^TMP that have common fields between IV and U/D
"RTN","PSJBCMA",133,0)
 S PSJINX=PSJINX+1
"RTN","PSJBCMA",134,0)
 S PSJ("OINAME")=$$OIDF^PSJLMUT1(+PSJ("OI")) I PSJ("OINAME")["NOT FOUND" S PSJ("OINAME")=""
"RTN","PSJBCMA",135,0)
 S PSJ("OIDF")=$$GET1^DIQ(50.7,+PSJ("OI"),.02)
"RTN","PSJBCMA",136,0)
 I PSJ("OINAME")="" S PSJ("OIDF")=""
"RTN","PSJBCMA",137,0)
 S PSJ("MRABB")=$P($G(^PS(51.2,+PSJ("MR"),0)),U,3)
"RTN","PSJBCMA",138,0)
 S ^TMP("PSJ",$J,PSJINX,0)=DFN_U_+ON_U_FON_U_PSJ("PREV")_U_PSJ("FOLLOW")_U_$G(PSJ("IVTYPE"))_U_$G(PSJ("INSYR"))_U_$G(PSJ("CHEMO"))_U_PSJ("CPRS")_U_$G(PSJ("RFO"))
"RTN","PSJBCMA",139,0)
 S ^TMP("PSJ",$J,PSJINX,1)=PSJ("MRABB")_U_PSJ("STC")_U_$G(PSJ("SCHD"))_U_PSJ("STARTDT")_U_PSJ("STOPDT")_U_PSJ("ADM")_U_PSJ("STATUS")_U_$G(PSJ("NGIVEN"))_U_$G(PSJ("ST"))_U_$G(PSJ("AUTO"))
"RTN","PSJBCMA",140,0)
 S ^TMP("PSJ",$J,PSJINX,2)=PSJ("DO")_U_$G(PSJ("INFRATE"))_U_$G(PSJ("SM"))_U_$G(PSJ("HSM"))
"RTN","PSJBCMA",141,0)
 S ^TMP("PSJ",$J,PSJINX,3)=PSJ("OI")_U_PSJ("OINAME")_U_PSJ("OIDF")
"RTN","PSJBCMA",142,0)
 S ^TMP("PSJ",$J,PSJINX,4)=PSJ("SIOPI")
"RTN","PSJBCMA",143,0)
 Q
"RTN","PSJBCMA",144,0)
SIOPI ; Use provider comments if order is pending and there is no SI
"RTN","PSJBCMA",145,0)
 NEW X,Y,Z
"RTN","PSJBCMA",146,0)
 I FON["P",(PSJ("SIOPI")=""),$O(^PS(53.1,+ON,12,0)) D
"RTN","PSJBCMA",147,0)
 . F X=0:0 S X=$O(^PS(53.1,+ON,12,X)) Q:'X  S Z=$G(^(X,0)) D
"RTN","PSJBCMA",148,0)
 .. S Y=$L(PSJ("SIOPI"))
"RTN","PSJBCMA",149,0)
 .. S:Y+$L(Z)'>179 PSJ("SIOPI")=PSJ("SIOPI")_Z_""
"RTN","PSJBCMA",150,0)
 . I Y+$L(Z)>179 S PSJ("SIOPI")="SEE PROVIDER COMMENTS"
"RTN","PSJBCMA",151,0)
 Q
"RTN","PSJBCMA",152,0)
ENSET(X) ; expands the SPECIAL INSTRUCTIONS field contained in X into Y
"RTN","PSJBCMA",153,0)
 N X1,X2,Y S Y=""
"RTN","PSJBCMA",154,0)
 F X1=1:1:$L(X," ") S X2=$P(X," ",X1) I X2]"" S Y=Y_$S($L(X2)>30:X2,'$D(^PS(51,+$O(^PS(51,"B",X2,0)),0)):X2,$P(^(0),"^",2)]""&$P(^(0),"^",4):$P(^(0),"^",2),1:X2)_" "
"RTN","PSJBCMA",155,0)
 S Y=$E(Y,1,$L(Y)-1)
"RTN","PSJBCMA",156,0)
 Q Y
"RTN","PSJBCMA",157,0)
ONE(DFN,ORD,SCH,START,STOP) ;determine if order is a one-time
"RTN","PSJBCMA",158,0)
 ; Input:  DFN - patient's internal entry number
"RTN","PSJBCMA",159,0)
 ;         ORD - order number to check (must contain U or V)
"RTN","PSJBCMA",160,0)
 ;         SCH - schedule text (required)
"RTN","PSJBCMA",161,0)
 ;         START - order start date (optional)
"RTN","PSJBCMA",162,0)
 ;         STOP - order stop date (optional)
"RTN","PSJBCMA",163,0)
 N X
"RTN","PSJBCMA",164,0)
 I $G(PSJ("PREV")),$G(PSJ("FOLLOW")) I +PSJ("PREV")=+PSJ("FOLLOW") S (PSJ("PREV"),PSJ("FOLLOW"))=""
"RTN","PSJBCMA",165,0)
 I $G(DFN)]"",$G(ORD)]"",ORD["U",$P(^PS(55,DFN,5,+ORD,0),"^",7)'="R" Q $P(^PS(55,DFN,5,+ORD,0),"^",7)
"RTN","PSJBCMA",166,0)
 I $G(SCH)="" Q ""
"RTN","PSJBCMA",167,0)
 I SCH="TODAY"!(SCH="ONCE")!(SCH="NOW")!(SCH="ONE TIME")!(SCH="ONETIME")!(SCH="ONE-TIME")!(SCH="1TIME")!(SCH="1 TIME")!(SCH="1-TIME")!(SCH="STAT") Q "O"
"RTN","PSJBCMA",168,0)
 I $D(^PS(51.1,"AC","PSJ",SCH)) S X=$O(^(SCH,"")) S X=$P(^PS(51.1,X,0),"^",5) Q $S(X="D":"C",1:X)
"RTN","PSJBCMA",169,0)
 I $G(START)]"",$G(STOP)]"",START=STOP Q "O"
"RTN","PSJBCMA",170,0)
 Q ""
"RTN","PSJBCMA",171,0)
CLINIC(CL) ;
"RTN","PSJBCMA",172,0)
 I $P(CL,"^",2)?7N!($P(CL,"^",2)?7N1".".N) Q 1
"RTN","PSJBCMA",173,0)
 Q 0
"RTN","PSJDDUT")
0^109^B55719712
"RTN","PSJDDUT",1,0)
PSJDDUT ;BIR/LDT-INPATIENT MEDICATIONS DD UTILITY ;21 AUG 97  7:55 AM
"RTN","PSJDDUT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**40,44,50,83,116,111**;16 DEC 97
"RTN","PSJDDUT",3,0)
 ;
"RTN","PSJDDUT",4,0)
 ; Reference to ^PS(51 is supported by DBIA# 2176.
"RTN","PSJDDUT",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJDDUT",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJDDUT",7,0)
 ; 
"RTN","PSJDDUT",8,0)
SPCIN ;Called from Non-Verified Orders File (53.1), Special Instructions
"RTN","PSJDDUT",9,0)
 ;field 8
"RTN","PSJDDUT",10,0)
 S PSJHLP(1)="IF ABBREVIATIONS ARE USED, THE TOTAL LENGTH OF THE EXPANDED"
"RTN","PSJDDUT",11,0)
 S PSJHLP(2)="INSTRUCTIONS ALSO MAY NOT BE LONGER THAN 180 CHARACTERS."
"RTN","PSJDDUT",12,0)
 D WRITE
"RTN","PSJDDUT",13,0)
 Q
"RTN","PSJDDUT",14,0)
CHKSI ;Called from Non-Verified Orders File (53.1), Special Instructions
"RTN","PSJDDUT",15,0)
 ;field 8 (Replaces ^PSGSICHK)
"RTN","PSJDDUT",16,0)
 I $S(X'?.ANP:1,X["^":1,1:$L(X)>180) K X Q
"RTN","PSJDDUT",17,0)
 N Y S Y="" F Y(1)=1:1:$L(X," ") S Y(2)=$P(X," ",Y(1)) I Y(2)]"" D CHK1 Q:'$D(X)
"RTN","PSJDDUT",18,0)
 I $D(X),Y]"",X'=$E(Y,1,$L(Y)-1) D EN^DDIOL("EXPANDS TO:","","!?3") F Y(1)=1:1 S Y(2)=$P(Y," ",Y(1)) Q:Y(2)=""  D:$L(Y(2))+$X>78 EN^DDIOL("","","!") D EN^DDIOL(Y(2)_" ","","?0")
"RTN","PSJDDUT",19,0)
 K Y Q
"RTN","PSJDDUT",20,0)
CHK1 ;
"RTN","PSJDDUT",21,0)
 I $L(Y(2))<31,$D(^PS(51,+$O(^PS(51,"B",Y(2),0)),0)),$P(^(0),"^",2)]"",$P(^(0),"^",4) S Y(2)=$P(^(0),"^",2)
"RTN","PSJDDUT",22,0)
 I $L(Y)+$L(Y(2))>180 K X Q
"RTN","PSJDDUT",23,0)
 S Y=Y_Y(2)_" " Q
"RTN","PSJDDUT",24,0)
 ;
"RTN","PSJDDUT",25,0)
CHK F QQ=1:1:$L(SCH,"-") S WKD=$P(SCH,"-",QQ) I WKD=$E(X,1,$L(WKD)) D TS Q
"RTN","PSJDDUT",26,0)
 Q
"RTN","PSJDDUT",27,0)
TS F Q1=1:1:$L(TS,"-") S C=C+1 I C=PSGDL S X=X1_"."_$P(TS,"-",Q1) Q
"RTN","PSJDDUT",28,0)
 Q
"RTN","PSJDDUT",29,0)
STRDT ;Called from Non-Verified Orders File (53.1),Start Date/Time field 10
"RTN","PSJDDUT",30,0)
 ;(Replaces ENPREV^PSGDL)
"RTN","PSJDDUT",31,0)
 D EN^DDIOL("REVIOUS","","?0") S (X,Y)=0 I '$D(PSGP)!'$D(PSGPDRG) G:$D(DA)[0 POUT S PSGP=$P($G(^PS(53.1,DA,0)),"^",15),PSGPDRG=+$G(^(.2)),Y=1 I 'PSGP!'PSGPDRG D:'PSGPDRG EN^DDIOL("Must have drug from formulary list.","","!?17") G POUT
"RTN","PSJDDUT",32,0)
 F Q=0:0 S Q=$O(^PS(53.1,"AC",PSGP,Q)) Q:'Q  I +$G(^PS(53.1,Q,.2))=PSGPDRG,$D(^PS(53.1,Q,2)),$P(^(2),"^",4)>X S X=$P(^(2),"^",4)
"RTN","PSJDDUT",33,0)
 F Q=0:0 S Q=$O(^PS(55,PSGP,5,"C",PSGPDRG,Q)) Q:'Q  I $D(^PS(55,PSGP,5,Q,2)),$P(^(2),"^",4)>X S X=$P(^(2),"^",4)
"RTN","PSJDDUT",34,0)
 D:'X EN^DDIOL("No other order found with this drug.","","!?17")
"RTN","PSJDDUT",35,0)
 ;
"RTN","PSJDDUT",36,0)
POUT ;
"RTN","PSJDDUT",37,0)
 K:'X X K:Y PSGPDRG,PSGP,Q Q
"RTN","PSJDDUT",38,0)
 ;
"RTN","PSJDDUT",39,0)
UNPD ;Called from Non-Verified Orders File (53.1), Units Per Dose field 13
"RTN","PSJDDUT",40,0)
 S PSJHLP(1)="ONE (1) UNIT PER DOSE WILL BE ASSUMED IF THERE IS NO ENTRY (OR"
"RTN","PSJDDUT",41,0)
 S PSJHLP(2)="AN ENTRY OF ZERO (0)) INTO THIS FIELD."
"RTN","PSJDDUT",42,0)
 D WRITE
"RTN","PSJDDUT",43,0)
 Q
"RTN","PSJDDUT",44,0)
 ;
"RTN","PSJDDUT",45,0)
SCH ;Called from Non-Verified Orders File (53.1), Schedule field 26
"RTN","PSJDDUT",46,0)
 ;(Replaces EN^PSGS0)
"RTN","PSJDDUT",47,0)
 ;/I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>2)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N") K X Q
"RTN","PSJDDUT",48,0)
 I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>3)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N") K X Q
"RTN","PSJDDUT",49,0)
 I X?.E1L.E S X=$$ENLU^PSGMI(X) I '$D(PSGOES) D EN^DDIOL("  ("_X_")","","?0")
"RTN","PSJDDUT",50,0)
 I X["Q0" K X Q
"RTN","PSJDDUT",51,0)
 ;
"RTN","PSJDDUT",52,0)
ENOS ; order set entry
"RTN","PSJDDUT",53,0)
 S (PSGS0XT,PSGS0Y,XT,Y)="" I X["PRN"!(X="ON CALL")!(X="ONCALL")!(X="ON-CALL") G Q
"RTN","PSJDDUT",54,0)
 S X0=X I X,X'["X",(X?2.4N1"-".E!(X?2.4N)) D ENCHK^PSGS0 S:$D(X) Y=X G Q
"RTN","PSJDDUT",55,0)
 I $S($D(^PS(51.1,"AC","PSJ",X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC^PSGS0 I XT]"" G Q
"RTN","PSJDDUT",56,0)
 I X["@" D DW^PSGS0 S:$D(X) Y=$P(X,"@",2) G Q
"RTN","PSJDDUT",57,0)
 I Y'>0,$S(X="NOW":1,X="ONCE":1,X="STAT":1,X="ONE TIME":1,X="ONETIME":1,X="1TIME":1,X="1 TIME":1,X="T-TIME":1,1:X="ONE-TIME") D:'$D(PSGOES) EN^DDIOL("  (ONCE ONLY)","","?0") S Y="",XT="O" G Q
"RTN","PSJDDUT",58,0)
 I $G(PSGSCH)=X S PSGS0Y=$G(PSGAT) Q
"RTN","PSJDDUT",59,0)
 ;
"RTN","PSJDDUT",60,0)
NS K PSJNSS I Y'>0 D:'$D(PSGOES) EN^DDIOL("  (Nonstandard schedule)","","?0") S X=X0,Y="",PSJNSS=1
"RTN","PSJDDUT",61,0)
 I $E(X,1,2)="AD" K X Q
"RTN","PSJDDUT",62,0)
 I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S XT=1440/$F("BTQ",$E(X)) G Q
"RTN","PSJDDUT",63,0)
 S:$E(X)="Q" X=$E(X,2,99) S:'X X="1"_X S X1=+X,X=$P(X,+X,2),X2=0 S:X1<0 X1=-X1 S:$E(X)="X" X2=1,X=$E(X,2,99)
"RTN","PSJDDUT",64,0)
 S XT=$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:-1) I XT<0,Y'>0 K X G Q
"RTN","PSJDDUT",65,0)
 S X=X0 I XT S:X2 XT=XT\X1 I 'X2 S:$E(X,1,2)="QO" XT=XT*2 S XT=XT*X1
"RTN","PSJDDUT",66,0)
 ;
"RTN","PSJDDUT",67,0)
Q ;
"RTN","PSJDDUT",68,0)
 S PSGS0XT=$S(XT]"":XT,1:""),PSGS0Y=$S(Y:Y,1:"") K QX,SDW,SWD,X0,XT,Z Q
"RTN","PSJDDUT",69,0)
 ;
"RTN","PSJDDUT",70,0)
SCH3 ;Called from Non-Verified Orders File (53.1), Schedule field 26
"RTN","PSJDDUT",71,0)
 ;(Replaces ENSH3^PSGSH)
"RTN","PSJDDUT",72,0)
 S:'$D(PSGST) PSGST=$P($G(^PS(53.1,DA,0)),"^",7),PSGDDFLG=1
"RTN","PSJDDUT",73,0)
 N D,DA,DIC,DIE,DZ,Y
"RTN","PSJDDUT",74,0)
 D EN^DDIOL("'STAT', 'ONCE', 'NOW', and 'DAILY' are acceptable schedules.") I X?1"???".E F Q=1:1 Q:$P($T(HT+Q),";",3)=""  S PSJHLP(Q)=$P($T(HT+Q),";",3)
"RTN","PSJDDUT",75,0)
 I X?1"???".E D EN^DDIOL(.PSJHLP) K PSJHLP
"RTN","PSJDDUT",76,0)
 I X?1"???".E R !,"(Press RETURN to continue.) ",Q:DTIME D:'$T EN^DDIOL("","","$C(7)") S:'$T Q="^" I Q="^" K:$D(PSGDDFLG) PSGDDFLG,PSGST Q
"RTN","PSJDDUT",77,0)
 K DIC S DIC="^PS(51.1,",DIC(0)="E",D="APPSJ",DIC("W")="W ""  ""," I $D(PSJPWD),PSJPWD S DIC("W")=DIC("W")_"$S($D(^PS(51.1,+Y,1,PSJPWD,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"
"RTN","PSJDDUT",78,0)
 ; Naked references on the following two lines refer to the full reference on the line above
"RTN","PSJDDUT",79,0)
 E  S DIC("W")=DIC("W")_"$P(^(0),""^"",2)"
"RTN","PSJDDUT",80,0)
 I $D(PSGST) S DIC("S")="I $P(^(0),""^"",5)"_$E("'",PSGST'="O")_"=""O"""
"RTN","PSJDDUT",81,0)
 S DIC("?N",51.1)=12
"RTN","PSJDDUT",82,0)
 D IX^DIC K DIC K:$D(PSGDDFLG) PSGDDFLG,PSGST Q
"RTN","PSJDDUT",83,0)
 ;
"RTN","PSJDDUT",84,0)
HT ;
"RTN","PSJDDUT",85,0)
 ;;  This is the frequency (ONLY) with which the doses are to be
"RTN","PSJDDUT",86,0)
 ;;administered.  Several forms of entry are acceptable, such as
"RTN","PSJDDUT",87,0)
 ;;Q6H, 09-12-15, STAT, QOD, and MO-WE-FR@AD (where MO-WE-FR are
"RTN","PSJDDUT",88,0)
 ;;days of the week, and AD is the admin times).  The schedule
"RTN","PSJDDUT",89,0)
 ;;will show on the MAR, labels, etc.  No more than ONE space
"RTN","PSJDDUT",90,0)
 ;;(Q3H 4 or Q4H PRN) in the schedule is acceptable.  If the
"RTN","PSJDDUT",91,0)
 ;;letters PRN ;;are found as part of the schedule, no admin
"RTN","PSJDDUT",92,0)
 ;;times will print on the MAR or labels, and the PICK LIST will
"RTN","PSJDDUT",93,0)
 ;;always show a count of zero (0).
"RTN","PSJDDUT",94,0)
 ;;Avoid using notation such as W/F (with food) or WM (with meals)
"RTN","PSJDDUT",95,0)
 ;;in the schedule as it may cause erroneous calculations.  That
"RTN","PSJDDUT",96,0)
 ;;information should be entered into the SPECIAL INSTRUCTIONS.
"RTN","PSJDDUT",97,0)
 ;;  When using the MO-WE-FR@AD schedule, please remember that
"RTN","PSJDDUT",98,0)
 ;;this type of schedule will not work properly without the "@"
"RTN","PSJDDUT",99,0)
 ;;character and at least one admin time, and that at least the
"RTN","PSJDDUT",100,0)
 ;;first two letters of each weekday entered is needed.
"RTN","PSJDDUT",101,0)
 ;
"RTN","PSJDDUT",102,0)
ADTM2 ;Called from Non-Verified Orders File (53.1), Admin Times field 39    
"RTN","PSJDDUT",103,0)
 S PSJHLP(1)="EACH TIME MUST BE TWO DIGITS BETWEEN 01 AND 24. THE TIMES MUST BE"
"RTN","PSJDDUT",104,0)
 S PSJHLP(2)="SEPARATED WITH ""-""'S AND BE IN ASCENDING ORDER."
"RTN","PSJDDUT",105,0)
 D WRITE
"RTN","PSJDDUT",106,0)
 Q
"RTN","PSJDDUT",107,0)
 ;
"RTN","PSJDDUT",108,0)
WRDGP ;Called from Ward Group File (57.5), Ward Group field .01   
"RTN","PSJDDUT",109,0)
 S PSJHLP(1)="There is at least one PICK LIST for this WARD GROUP.  This WARD"
"RTN","PSJDDUT",110,0)
 S PSJHLP(1,"F")="$C(7),!!?2"
"RTN","PSJDDUT",111,0)
 S PSJHLP(2)="GROUP cannot be deleted until the PICK LIST(s) is purged or deleted."
"RTN","PSJDDUT",112,0)
 D WRITE
"RTN","PSJDDUT",113,0)
 Q
"RTN","PSJDDUT",114,0)
 ;
"RTN","PSJDDUT",115,0)
LBLS ;Called from Inpatient Ward Parameters file (59.6), field .11
"RTN","PSJDDUT",116,0)
 S PSJHLP(1)="ANY NEW LABELS OLDER THAN THE NUMBER OF DAYS SPECIFIED HERE WILL"
"RTN","PSJDDUT",117,0)
 S PSJHLP(2)="AUTOMATICALLY BE PURGED."
"RTN","PSJDDUT",118,0)
 D WRITE
"RTN","PSJDDUT",119,0)
 Q
"RTN","PSJDDUT",120,0)
 ;
"RTN","PSJDDUT",121,0)
SCHTP ;Called from the Unit Dose Multiple of file 55, Schedule Type field 7
"RTN","PSJDDUT",122,0)
 S PSJHLP(1)="CHOOSE FROM:"
"RTN","PSJDDUT",123,0)
 S PSJHLP(1,"F")="!!"
"RTN","PSJDDUT",124,0)
 S PSJHLP(2)="C - CONTINUOUS"
"RTN","PSJDDUT",125,0)
 S PSJHLP(2,"F")="!?3"
"RTN","PSJDDUT",126,0)
 S PSJHLP(3)="O - ONE-TIME"
"RTN","PSJDDUT",127,0)
 S PSJHLP(3,"F")="!?3"
"RTN","PSJDDUT",128,0)
 S PSJHLP(4)="OC - ON CALL"
"RTN","PSJDDUT",129,0)
 S PSJHLP(4,"F")="!?3"
"RTN","PSJDDUT",130,0)
 S PSJHLP(5)="P - PRN"
"RTN","PSJDDUT",131,0)
 S PSJHLP(5,"F")="!?3"
"RTN","PSJDDUT",132,0)
 S PSJHLP(6)="R - FILL ON REQUEST"
"RTN","PSJDDUT",133,0)
 S PSJHLP(6,"F")="!?3"
"RTN","PSJDDUT",134,0)
 D WRITE
"RTN","PSJDDUT",135,0)
 Q
"RTN","PSJDDUT",136,0)
 ;
"RTN","PSJDDUT",137,0)
EN ;Called from Non-Verified Orders file 53.1, Start/Date Time field 10
"RTN","PSJDDUT",138,0)
 ;and Stop Date/Time field 25 (Replaces EN^PSGDL)
"RTN","PSJDDUT",139,0)
 K PSGDLS S ND2=^PS(53.1,DA,2) I $P(ND2,"^",5)!$P(ND2,"^",6) D EN^DDIOL(" ...Dose Limit... ","","?0") G ENGO
"RTN","PSJDDUT",140,0)
 G DONE
"RTN","PSJDDUT",141,0)
 ;
"RTN","PSJDDUT",142,0)
ENGO ;
"RTN","PSJDDUT",143,0)
 S SCH=$P(ND2,"^")
"RTN","PSJDDUT",144,0)
 S ST=$S($D(PSGDLS):PSGDLS,1:$P(ND2,"^",2))
"RTN","PSJDDUT",145,0)
 S TS=$P(ND2,"^",5),MN=$P(ND2,"^",6)
"RTN","PSJDDUT",146,0)
 I $P(PSJSYSW0,U,5)=2 D
"RTN","PSJDDUT",147,0)
 . Q:'TS  S:TS'[$P(ST,".",2) $P(PSJSYSW0,U,5)=1 D
"RTN","PSJDDUT",148,0)
 .. N STRING,ND2,SCH,TS,MN S STRING=$G(PSGSD)_"^"_$G(PSGFD)_"^"_$G(PSGSCH)_"^"_$G(PSGST)_"^"_$G(PSGPDRG)_"^"_$G(PSGAT)
"RTN","PSJDDUT",149,0)
 .. S ST=$$ENQ^PSJORP2(PSGP,STRING) S:'ST ST=$S($D(PSGDLS):PSGDLS,1:$P(ND2,"^",2))
"RTN","PSJDDUT",150,0)
 . S $P(PSJSYSW0,U,5)=2
"RTN","PSJDDUT",151,0)
 S TS=$P(ND2,"^",5),MN=$P(ND2,"^",6)
"RTN","PSJDDUT",152,0)
 G MWF:SCH["@",DONE:'TS&'MN
"RTN","PSJDDUT",153,0)
 I 'TS S AM=MN*PSGDL,X=$$EN^PSGCT(ST,AM) G DONE
"RTN","PSJDDUT",154,0)
 S TM=$E(ST_"00000",9,8+$L($P(TS,"-")))
"RTN","PSJDDUT",155,0)
 F Q=1:1 Q:$P(TS,"-",Q)=""!(TM<$P(TS,"-",Q))
"RTN","PSJDDUT",156,0)
 S X=ST\1,C=0 F Q=Q:1 D:$P(TS,"-",Q)="" ADD S C=C+1 I C=PSGDL S X=X_"."_$P(TS,"-",Q) G DONE
"RTN","PSJDDUT",157,0)
 ;
"RTN","PSJDDUT",158,0)
MWF ; if schedule is similar to monday-wednesday-friday
"RTN","PSJDDUT",159,0)
 S TS=$P(SCH,"@",2),SCH=$P(SCH,"@"),X=$P(ST,"."),C=0 D SCHK G:C=PSGDL DONE F Q=1:1 S X1=$P(ST,"."),X2=Q D C^%DTC S X1=X D DW^%DTC D CHK G:C=PSGDL DONE
"RTN","PSJDDUT",160,0)
SCHK S X1=X D DW^%DTC F Q=1:1:$L(SCH,"-") S WKD=$P(SCH,"-",Q) I WKD=$E(X,1,$L(WKD)) Q
"RTN","PSJDDUT",161,0)
 E  Q
"RTN","PSJDDUT",162,0)
 S TM=$E(ST_"00000",9,8+$L($P(TS,"-"))) F Q=1:1:$L(TS,"-") I TM<$P(TS,"-",Q) S C=C+1 I C=PSGDL S X=X1_"."_$P(TS,"-",Q) Q
"RTN","PSJDDUT",163,0)
 Q
"RTN","PSJDDUT",164,0)
 ;
"RTN","PSJDDUT",165,0)
DONE ;
"RTN","PSJDDUT",166,0)
 K %H,%T,%Y,MN,ND2,ND4,PSGDLS,PSGDL,Q1,QQ,SCH,TM,WKD,TS,X1,X2 Q
"RTN","PSJDDUT",167,0)
 ;
"RTN","PSJDDUT",168,0)
ADD ;
"RTN","PSJDDUT",169,0)
 S X1=$P(X,"."),X2=$S(MN&'(MN#1440):MN\1440,1:1) D C^%DTC S Q=1 Q
"RTN","PSJDDUT",170,0)
 ;
"RTN","PSJDDUT",171,0)
WRITE ;Calls EN^DDIOL to write text
"RTN","PSJDDUT",172,0)
 D EN^DDIOL(.PSJHLP) K PSJHLP Q
"RTN","PSJDOSE")
0^85^B45005446
"RTN","PSJDOSE",1,0)
PSJDOSE ;BIR/MV-POSSIBLE DOSES UTILITY ;16 Jan 2001  1:53 PM
"RTN","PSJDOSE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,65,106,111**;16 DEC 97
"RTN","PSJDOSE",3,0)
 ;
"RTN","PSJDOSE",4,0)
 ; Reference to ^PSSORPH is supported by DBIA #3234.
"RTN","PSJDOSE",5,0)
 ;
"RTN","PSJDOSE",6,0)
 ;PSJDSFLG: Set to 1 if Dose and DD are not compatible
"RTN","PSJDOSE",7,0)
 ;PSJDSSEL: The selected dose in format:
"RTN","PSJDOSE",8,0)
 ;          Dosage Order^DD IEN^DUPD/BCMA DUPD^1(if BCMA DUPD exist
"RTN","PSJDOSE",9,0)
 ;PSJDSUPD: Set to 1 if need to prompt for the Units Per Dose
"RTN","PSJDOSE",10,0)
 ;
"RTN","PSJDOSE",11,0)
EDITDOSE ;Editing Dosage Ordered for active order
"RTN","PSJDOSE",12,0)
 ;*Need to set PSJDSFLG to null when call EDITDOSE.
"RTN","PSJDOSE",13,0)
 NEW PSGOER1,PSJDD,PSJDSUPD,PSJDSSEL,PSJX,Y
"RTN","PSJDOSE",14,0)
 ;Offer the possible doses from the only one or 1st DD
"RTN","PSJDOSE",15,0)
 S PSJX=$O(^PS(53.45,PSJSYSP,2,0)) S PSJDD=+$G(^(+PSJX,0))
"RTN","PSJDOSE",16,0)
 D DOSE(PSJDD)
"RTN","PSJDOSE",17,0)
 D DOSECHK
"RTN","PSJDOSE",18,0)
 I +PSJDSFLG D
"RTN","PSJDOSE",19,0)
 . W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1"),!
"RTN","PSJDOSE",20,0)
 . D PAUSE^VALM1
"RTN","PSJDOSE",21,0)
 S PSGOEE=2
"RTN","PSJDOSE",22,0)
 Q
"RTN","PSJDOSE",23,0)
GETDOSE(PSJDD) ;Dosage Order
"RTN","PSJDOSE",24,0)
 NEW PSJDSSEL,PSJDSUPD
"RTN","PSJDOSE",25,0)
 D DOSE(PSJDD)
"RTN","PSJDOSE",26,0)
 Q:'$D(PSJDSSEL)
"RTN","PSJDOSE",27,0)
 D:+$G(PSJDSUPD) DUPD
"RTN","PSJDOSE",28,0)
 D:'+$G(PSJDSUPD) SETDUPD($P(PSJDSSEL,U,3))
"RTN","PSJDOSE",29,0)
 D DOSECHK
"RTN","PSJDOSE",30,0)
 I +$G(PSJDSFLG) D
"RTN","PSJDOSE",31,0)
 . W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1"),!
"RTN","PSJDOSE",32,0)
 Q
"RTN","PSJDOSE",33,0)
 ;
"RTN","PSJDOSE",34,0)
SETVAR ;
"RTN","PSJDOSE",35,0)
 S PSJDOSE("WARN")="WARNING: Dosage Ordered and Dispense Units do not match."
"RTN","PSJDOSE",36,0)
 S PSJDOSE("WARN1")="         Please verify Dosage."
"RTN","PSJDOSE",37,0)
 Q
"RTN","PSJDOSE",38,0)
 ;
"RTN","PSJDOSE",39,0)
DOSE(PSJDD) ;Prompt for Dosage Ordered
"RTN","PSJDOSE",40,0)
 ;PSJDD: Dispense drug IEN
"RTN","PSJDOSE",41,0)
 ;
"RTN","PSJDOSE",42,0)
 NEW DA,DR,DIR,DTOUT,DUOUT,DIRUT,PSJDL,PSJX,PSJPIECE,PSJCONT
"RTN","PSJDOSE",43,0)
 D SETVAR
"RTN","PSJDOSE",44,0)
 D DOSE^PSSORPH(.PSJDOX,+PSJDD,"U")
"RTN","PSJDOSE",45,0)
 I '$D(PSJDOX) S PSJDOX(1)=-1
"RTN","PSJDOSE",46,0)
 S PSJPIECE=$S($P(PSJDOX(1),U,11)]"":11,1:3)
"RTN","PSJDOSE",47,0)
 I PSJPIECE=3 S:$S($P(PSJDOX(1),U,3)="":1,1:$P(PSJDOX(1),U)=-1) $P(PSJDOX(1),U)=-1
"RTN","PSJDOSE",48,0)
AGAIN ;Prompt for dosage order again
"RTN","PSJDOSE",49,0)
 S PSJX=0
"RTN","PSJDOSE",50,0)
 NEW DIR
"RTN","PSJDOSE",51,0)
 W:($P(PSJDOX(1),U)'=-1) !!,"Available Dosage(s)"
"RTN","PSJDOSE",52,0)
 F PSJDL=0:0 S PSJDL=$O(PSJDOX(PSJDL)) Q:$S('PSJDL:1,$G(DUOUT):1,1:+PSJDOX(PSJDL)=-1)  D
"RTN","PSJDOSE",53,0)
 . S PSJX=PSJX+1
"RTN","PSJDOSE",54,0)
 . W !?4,$J(PSJX,3),".    ",$P(PSJDOX(PSJDL),U,PSJPIECE)
"RTN","PSJDOSE",55,0)
 . I '(PSJX#16) S DIR(0)="E" D ^DIR
"RTN","PSJDOSE",56,0)
 W !
"RTN","PSJDOSE",57,0)
 K DIR S DIR(0)="FO^1:60"
"RTN","PSJDOSE",58,0)
 S DIR("A")=$S(+PSJX:"Select from list of Available Dosages or Enter Free Text Dose",1:"DOSAGE ORDERED")
"RTN","PSJDOSE",59,0)
 S:$G(PSGDO)]"" DIR("B")=PSGDO
"RTN","PSJDOSE",60,0)
 S DIR("?")="^D ENHLP^PSGOEM(53.1,109)" D ^DIR
"RTN","PSJDOSE",61,0)
 S PSJY=Y
"RTN","PSJDOSE",62,0)
 ;
"RTN","PSJDOSE",63,0)
 ;* Dosage Ordered entered is null
"RTN","PSJDOSE",64,0)
 I PSJY="" S PSJDSUPD=1,PSGDO="",PSJDSSEL=U_+PSJDD_U_1 Q
"RTN","PSJDOSE",65,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,$D(DIRUT):1,1:0) S PSGOROE1=1 Q
"RTN","PSJDOSE",66,0)
 ;
"RTN","PSJDOSE",67,0)
 ;* If select for the presented list (possible and local doses)
"RTN","PSJDOSE",68,0)
 I $D(PSJDOX(PSJY)) D  G:'PSJCONT AGAIN Q
"RTN","PSJDOSE",69,0)
 . NEW X S X=$P(PSJDOX(PSJY),U,PSJPIECE)
"RTN","PSJDOSE",70,0)
 . W "  ",X
"RTN","PSJDOSE",71,0)
 . S PSJCONT=$$CONT(X)
"RTN","PSJDOSE",72,0)
 . Q:'PSJCONT
"RTN","PSJDOSE",73,0)
 . D SELDOSE(PSJY,PSJDD)
"RTN","PSJDOSE",74,0)
 ;
"RTN","PSJDOSE",75,0)
 ;* Entered a numeric and choices are not local pos dose
"RTN","PSJDOSE",76,0)
 I PSJY?.N!(PSJY?.N1".".N),(PSJPIECE'=3) D  G:'PSJCONT AGAIN  Q
"RTN","PSJDOSE",77,0)
 . Q:$L(PSJY)>15
"RTN","PSJDOSE",78,0)
 . D DOSE^PSSORPH(.PSJDOX,+PSJDD,"U",,PSJY/+$P(PSJDOX(1),U,5))
"RTN","PSJDOSE",79,0)
 . S PSJCONT=$$CONT($P(PSJDOX(1),U,11))
"RTN","PSJDOSE",80,0)
 . I 'PSJCONT D DOSE^PSSORPH(.PSJDOX,+PSJDD,"U") Q
"RTN","PSJDOSE",81,0)
 . D SELDOSE(1,PSJDD)
"RTN","PSJDOSE",82,0)
 ;
"RTN","PSJDOSE",83,0)
 ;* Can't accept just a numeric value
"RTN","PSJDOSE",84,0)
 I PSJY?.N!(PSJY?.N1".".N) D ENHLP^PSGOEM(53.1,109) G AGAIN
"RTN","PSJDOSE",85,0)
 ;
"RTN","PSJDOSE",86,0)
 ;* Free text
"RTN","PSJDOSE",87,0)
 G:'$$CONT(PSJY) AGAIN
"RTN","PSJDOSE",88,0)
 K PSJDSSEL
"RTN","PSJDOSE",89,0)
 F X=0:0 S X=$O(PSJDOX(X)) Q:'X  S PSJXDOSE=$P(PSJDOX(X),U,PSJPIECE) I PSJY=PSJXDOSE D SELDOSE(X,PSJDD) Q
"RTN","PSJDOSE",90,0)
 I '$D(PSJDSSEL),($G(PSJY)]"") S PSJDSSEL=PSJY_U_+PSJDD_U_1,PSGDO=PSJY,PSJDSUPD=1
"RTN","PSJDOSE",91,0)
 Q
"RTN","PSJDOSE",92,0)
 ;
"RTN","PSJDOSE",93,0)
SELDOSE(X,PSJDD) ;
"RTN","PSJDOSE",94,0)
 S X=PSJDOX(X)
"RTN","PSJDOSE",95,0)
 S PSGDO=$P(X,U,PSJPIECE)
"RTN","PSJDOSE",96,0)
 S:$P(X,U)'=-1 PSJDOSE("DO")=$P(X,U,1,2)
"RTN","PSJDOSE",97,0)
 S PSJDSSEL=$P(X,U,PSJPIECE)_U_PSJDD
"RTN","PSJDOSE",98,0)
 I +$P(X,U,12) S $P(PSJDSSEL,U,3)=$P(X,U,12)_U_1 Q
"RTN","PSJDOSE",99,0)
 S $P(PSJDSSEL,U,3)=$S(PSJPIECE=11:$P(X,U,3),1:1)
"RTN","PSJDOSE",100,0)
 Q
"RTN","PSJDOSE",101,0)
CONT(X) ;Ask if user accepting the dose
"RTN","PSJDOSE",102,0)
 NEW DIR,DIRUT,Y
"RTN","PSJDOSE",103,0)
 W ! K DIR,DIRUT,DUOUT
"RTN","PSJDOSE",104,0)
 S DIR(0)="Y",DIR("A")="You entered "_X_" is this correct",DIR("B")="Yes"
"RTN","PSJDOSE",105,0)
 D ^DIR
"RTN","PSJDOSE",106,0)
 K DUOUT
"RTN","PSJDOSE",107,0)
 Q +Y
"RTN","PSJDOSE",108,0)
 ;
"RTN","PSJDOSE",109,0)
DUPD ;
"RTN","PSJDOSE",110,0)
 NEW PSJX,X
"RTN","PSJDOSE",111,0)
 S PSGUD=1
"RTN","PSJDOSE",112,0)
 W !,"UNITS PER DOSE: "_PSGUD_"// " R X:DTIME W "  ",X I X="^"!'$T S PSGOROE1=1 Q
"RTN","PSJDOSE",113,0)
 S:X="" X=1
"RTN","PSJDOSE",114,0)
 I X="@",'PSGUD W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.11,.02) G DUPD
"RTN","PSJDOSE",115,0)
 I X?1."?" D ENHLP^PSGOEM(53.11,.02) G DUPD
"RTN","PSJDOSE",116,0)
 I X?1.2N1"/"1.2N S X=+$J(+X/$P(X,"/",2),0,2) W "  ("_$E("0",X<1)_X_")"
"RTN","PSJDOSE",117,0)
 I $S($L(X)>12:1,X'=+X:1,X>50:1,X<0:1,1:X?.N1"."5.N) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.11,.02) G DUPD
"RTN","PSJDOSE",118,0)
 S $P(PSJDSSEL,U,3)=X
"RTN","PSJDOSE",119,0)
 D SETDUPD(X)
"RTN","PSJDOSE",120,0)
 Q
"RTN","PSJDOSE",121,0)
SETDUPD(X) ;
"RTN","PSJDOSE",122,0)
 S PSGUD=X,X=$S(PSJDSSEL]"":$P(PSJDSSEL,U,2),1:0)
"RTN","PSJDOSE",123,0)
 S PSJX=$O(^PS(53.45,PSJSYSP,2,"B",X,0))
"RTN","PSJDOSE",124,0)
 S PSGUD=+$FN(PSGUD,"",4) S:$E(PSGUD)="." PSGUD="0"_PSGUD
"RTN","PSJDOSE",125,0)
 S $P(^PS(53.45,PSJSYSP,2,+PSJX,0),U,2)=PSGUD
"RTN","PSJDOSE",126,0)
 Q
"RTN","PSJDOSE",127,0)
EDITDD ;Editing DDs
"RTN","PSJDOSE",128,0)
 NEW DA,DR,DIE
"RTN","PSJDOSE",129,0)
 S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=".02//1" D ^DIE
"RTN","PSJDOSE",130,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING:      This order must have at least one dispense drug before pharmacy can",!?9,"verify it!"
"RTN","PSJDOSE",131,0)
 Q
"RTN","PSJDOSE",132,0)
DOSECHK ;
"RTN","PSJDOSE",133,0)
 K PSJDSFLG S PSJDSFLG=0
"RTN","PSJDOSE",134,0)
 Q:'$P(PSJSYSU,";",4)
"RTN","PSJDOSE",135,0)
 Q:$G(PSGDO)=""
"RTN","PSJDOSE",136,0)
 NEW PSJX,PSJXDD,PSJCNT S PSJCNT=0
"RTN","PSJDOSE",137,0)
 F PSJX=0:0 S PSJX=$O(^PS(53.45,PSJSYSP,2,PSJX)) Q:'PSJX  D
"RTN","PSJDOSE",138,0)
 . S PSJXDD=$G(^PS(53.45,PSJSYSP,2,PSJX,0)) Q:PSJXDD=""
"RTN","PSJDOSE",139,0)
 . S:$P(PSJXDD,U,2)="" $P(^PS(53.45,PSJSYSP,2,PSJX,0),U,2)=1
"RTN","PSJDOSE",140,0)
 . S PSJCNT=PSJCNT+1
"RTN","PSJDOSE",141,0)
 D DOSECHK1
"RTN","PSJDOSE",142,0)
 Q
"RTN","PSJDOSE",143,0)
DOSECHK1 ;
"RTN","PSJDOSE",144,0)
 NEW PSJX,PSJXDD,PSJXUNIT,PSJUNIT,PSJXFLG,PSJTOT
"RTN","PSJDOSE",145,0)
 S PSJUNIT=$P(PSGDO,+PSGDO,2,$L(PSGDO,+PSGDO))
"RTN","PSJDOSE",146,0)
 S (PSJDSFLG,PSJXFLG,PSJTOT)=0
"RTN","PSJDOSE",147,0)
 S PSJX=0 F  S PSJX=$O(^PS(53.45,PSJSYSP,2,PSJX)) Q:'PSJX!PSJDSFLG!PSJXFLG  D
"RTN","PSJDOSE",148,0)
 . S PSJXDD=$G(^PS(53.45,PSJSYSP,2,PSJX,0))
"RTN","PSJDOSE",149,0)
 . S PSJXDUP=$S(+$P(PSJXDD,U,2):$P(PSJXDD,U,2),1:1)
"RTN","PSJDOSE",150,0)
 . D DOSE^PSSORPH(.PSJXDOX,+PSJXDD,"U")
"RTN","PSJDOSE",151,0)
 . I $S('$D(PSJXDOX):1,$P(PSJXDOX(1),U)="":1,1:+PSJXDOX(1)=-1) S PSJXFLG=1 Q
"RTN","PSJDOSE",152,0)
 . S PSJXUNIT=""
"RTN","PSJDOSE",153,0)
 . S:PSJUNIT["/" PSJXUNIT=PSJUNIT
"RTN","PSJDOSE",154,0)
 . I PSJUNIT'["/" F X=1:1:$L(PSJUNIT)  I $E(PSJUNIT,X)'?.N&($E(PSJUNIT,X)'?1" ") S PSJXUNIT=PSJXUNIT_$E(PSJUNIT,X)
"RTN","PSJDOSE",155,0)
 . I PSJCNT=1 D ONEDD Q:'PSJDSFLG
"RTN","PSJDOSE",156,0)
 . D BCMAUPD(PSJXDD),DOSE^PSSORPH(.PSJXDOX,+PSJXDD,"U",,PSJXDUP)
"RTN","PSJDOSE",157,0)
 . I PSJCNT=1 D ONEDD Q
"RTN","PSJDOSE",158,0)
 . S PSJTOT=+PSJXDOX(1)+$G(PSJTOT)
"RTN","PSJDOSE",159,0)
 I PSJCNT>1,(PSJTOT'=+PSGDO) S PSJDSFLG=1
"RTN","PSJDOSE",160,0)
 Q
"RTN","PSJDOSE",161,0)
ONEDD ;
"RTN","PSJDOSE",162,0)
 NEW X S PSJDSFLG=1
"RTN","PSJDOSE",163,0)
 F X=0:0 S X=$O(PSJXDOX(X)) Q:'X!'PSJDSFLG  D
"RTN","PSJDOSE",164,0)
 . I +PSJXDOX(X)'=+PSGDO,(PSJXUNIT=$P(PSJXDOX(X),U,2)),$S(PSJXDUP=$P(PSJXDOX(X),U,3):1,1:PSJXDUP=$P(PSJXDOX(X),U,12)) D  Q:PSJDSFLG
"RTN","PSJDOSE",165,0)
 .. N CHK S CHK=+PSGDO/$P(PSJXDOX(X),U,5) S CHK=+$FN(CHK,"",4) S:$E(CHK)="." CHK="0"_CHK I CHK=PSJXDUP S PSJDSFLG=0
"RTN","PSJDOSE",166,0)
 . I +PSJXDOX(X)=+PSGDO,$TR($P(PSJXDOX(X),U,11)," ")=$TR(PSGDO," "),$S(PSJXDUP=$P(PSJXDOX(X),U,3):1,1:PSJXDUP=$P(PSJXDOX(X),U,12)) S PSJDSFLG=0
"RTN","PSJDOSE",167,0)
 Q
"RTN","PSJDOSE",168,0)
BCMAUPD(PSJDD) ;
"RTN","PSJDOSE",169,0)
 NEW PSJCNT
"RTN","PSJDOSE",170,0)
 K PSJBCMA
"RTN","PSJDOSE",171,0)
 F X=0:0 S X=$O(PSJXDOX(X)) Q:'X  D
"RTN","PSJDOSE",172,0)
 . Q:'+$P(PSJXDOX(X),U,12)
"RTN","PSJDOSE",173,0)
 . S PSJCNT=+$G(PSJCNT)+1
"RTN","PSJDOSE",174,0)
 . S PSJBCMA(+PSJDD,$P(PSJXDOX(X),U,12),PSJCNT)=$P(PSJXDOX(X),U,1,2)
"RTN","PSJDOSE",175,0)
 Q
"RTN","PSJDOSE",176,0)
DSPWARN ;
"RTN","PSJDOSE",177,0)
 NEW PSJDOSE
"RTN","PSJDOSE",178,0)
 D SETVAR
"RTN","PSJDOSE",179,0)
 W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1"),!
"RTN","PSJDOSE",180,0)
 D PAUSE^VALM1
"RTN","PSJDOSE",181,0)
 Q
"RTN","PSJEXP")
0^40^B44592127
"RTN","PSJEXP",1,0)
PSJEXP ;BIR/CML3,KKA-MEDICATION EXPIRATION NOTICES ;13 FEB 96 / 10:04 AM
"RTN","PSJEXP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**111**;16 DEC 97
"RTN","PSJEXP",3,0)
 ;
"RTN","PSJEXP",4,0)
 ;Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSJEXP",5,0)
 ;
"RTN","PSJEXP",6,0)
 N OUT,PSJNEW,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSJEXP",7,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSJEXP",8,0)
 K %DT,DIC S (PSGP,WD,WG)=0,PSGSSH="EXP" S PSGPTMP=0,PPAGE=1 D ^PSGSEL G:"^"[PSGSS DONE D @PSGSS G:+Y'>0 DONE
"RTN","PSJEXP",9,0)
 I PSGSS="W" S PSJSEL("W")=WD D ADMTM^PSJPDIR
"RTN","PSJEXP",10,0)
 I PSGSS="C" S PSJSEL("C")="C"
"RTN","PSJEXP",11,0)
 S %DT="ETX",D="start" D DT G:Y'>0 DONE S (%DT(0),PSGEXPS)=+Y,D="stop" D DT K %DT G:Y'>0 DONE S:'$P(PSGEXPS,".",2) PSGEXPS=PSGEXPS+.0001 S PSGEXPF=Y+$S($P(Y,".",2):0,1:.24)
"RTN","PSJEXP",12,0)
 D LIST^PSJEXP0 G:$D(OUT) DONE
"RTN","PSJEXP",13,0)
 K ZTDTH,ZTSAVE S PSGTIR="ENQ^PSJEXP",ZTDESC="INPATIENT STOP ORDER NOTICES" F X="PSJMSG","WG","WD","PSGP","PSGOP","PSGDT","PSGEXPS","PSGEXPF","PSGSS","CHOICE","PSGPTMP","PPAGE","PSJSEL(" S ZTSAVE(X)=""
"RTN","PSJEXP",14,0)
 D ENDEV^PSGTI I POP!$D(ZTSK) W:POP !?3,"No device selected for report run." G DONE
"RTN","PSJEXP",15,0)
 W:$E(IOST)'="P" !,"...this may take a few minutes...",!?25,"...you really should QUEUE this report, if possible..."
"RTN","PSJEXP",16,0)
ENQ D NOW^%DTC S PSGDT=%,SD=$$EN^PSGCT(PSGEXPS,-1),FD=PSGEXPF F X="PSGEXPS","PSGEXPF" S @X=$$ENDTC^PSGMI(@X)
"RTN","PSJEXP",17,0)
 K ^TMP("PSG",$J) D @("L"_PSGSS),^PSJEXP0
"RTN","PSJEXP",18,0)
DONE D ^%ZISC D ENKV^PSGSETU K %,^TMP("PSG",$J),ADCNT,AM,CHOICE,CNT,D,DFN,DO,DOB,DRG,DRGI,DRGN,DRGT,DTOUT,DUOUT,FD,FSTFLG,GMRAREC,IR,JJ,LNCNT,MR,PSJMSG,ND,ND3,ND4,NF,ON,OPI,PRIMD,P,PSIVUP,PSJORIFN
"RTN","PSJEXP",19,0)
 K PSJACNWP,PSJAD,PSJJORD,PSJPAD,PSJPAGE,PSJPDOB,PSJPDX,PSJPRB,PSJPSEX,PSJPTD,PSJPWD,PSJPWDN,PSJPWT,PSJSEL,PSJSOL,SLS,Y1
"RTN","PSJEXP",20,0)
 K POP,PPN,PR,PSGDT,PSGEXPF,PSGEXPS,PSGOD,PSGP,PSGSS,PSGSSH,PSGTIR,PSEX,PSJOPC,PST,Q,RF,SCH,SD,SD1,SD1IV,SEX,SI,SM,SNDFLG,SOLCNT,SSN,ST,STD,TEAM,TEMPTM,TM,VA,WCNT,WD,WDN,WG,WRD,WS,WT,X,XQUIT,Y
"RTN","PSJEXP",21,0)
 Q
"RTN","PSJEXP",22,0)
LC ;
"RTN","PSJEXP",23,0)
 S STDTE=0 F  S STDTE=$O(^PS(55,"AIVC",STDTE)) Q:'STDTE  S CLINIC=0 F  S CLINIC=$O(^PS(55,"AIVC",STDTE,CLINIC)) Q:'CLINIC  D
"RTN","PSJEXP",24,0)
 . S JDFN=0 F  S JDFN=$O(^PS(55,"AIVC",STDTE,CLINIC,JDFN)) Q:'JDFN  S PSGP=JDFN D LP
"RTN","PSJEXP",25,0)
 S STDTE=0 F  S STDTE=$O(^PS(55,"AUDC",STDTE)) Q:'STDTE  S CLINIC=0 F  S CLINIC=$O(^PS(55,"AUDC",STDTE,CLINIC)) Q:'CLINIC  D
"RTN","PSJEXP",26,0)
 . S JDFN=0 F  S JDFN=$O(^PS(55,"AUDC",STDTE,CLINIC,JDFN)) Q:'JDFN  S PSGP=JDFN D LP
"RTN","PSJEXP",27,0)
 Q
"RTN","PSJEXP",28,0)
 ;
"RTN","PSJEXP",29,0)
LG F WD=0:0 S WD=$O(^PS(57.5,"AC",WG,WD)) Q:'WD  D LW
"RTN","PSJEXP",30,0)
 Q
"RTN","PSJEXP",31,0)
LW I $D(^DIC(42,WD,0)),$P(^(0),"^")]"" S WDN=$P(^(0),"^")
"RTN","PSJEXP",32,0)
 E  Q
"RTN","PSJEXP",33,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",WDN,PSGP)) Q:'PSGP  D LP
"RTN","PSJEXP",34,0)
 Q
"RTN","PSJEXP",35,0)
LL S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D LC
"RTN","PSJEXP",36,0)
 Q
"RTN","PSJEXP",37,0)
C ;
"RTN","PSJEXP",38,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSJEXP",39,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSJEXP",40,0)
CDIC ;
"RTN","PSJEXP",41,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y
"RTN","PSJEXP",42,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSJEXP",43,0)
 Q
"RTN","PSJEXP",44,0)
L ;
"RTN","PSJEXP",45,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSJEXP",46,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSJEXP",47,0)
LDIC ;
"RTN","PSJEXP",48,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y
"RTN","PSJEXP",49,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSJEXP",50,0)
 Q
"RTN","PSJEXP",51,0)
LP N PSJACNWP S PSJACNWP=1 D ^PSJAC,ENUNM^PSGOU Q:'$O(^PS(55,PSGP,5,"AUS",SD))
"RTN","PSJEXP",52,0)
 S PPN=$E($P(PSGP(0),"^"),1,12)_"^"_PSGP S:PSJPRB="" PSJPRB="zz"
"RTN","PSJEXP",53,0)
 S TM=$O(PSJSEL("TM","")),TM=$S(TM="":"ZZ",PSJPRB="":"zz",$D(^PS(57.7,+PSJPWD,1,+$O(^PS(57.7,"AWRT",+PSJPWD,PSJPRB,0)),0)):$P(^(0),"^"),1:"zz")
"RTN","PSJEXP",54,0)
 S TEMPTM=$O(^PS(57.7,+PSJPWD,1,"B",TM,0))
"RTN","PSJEXP",55,0)
 Q:$D(PSJSEL("TM"))&('$D(PSJSEL("TM","ALL")))&('$D(PSJSEL("TM",+TEMPTM)))
"RTN","PSJEXP",56,0)
 D:CHOICE'="IV" GS D:CHOICE'="UD" GSIV
"RTN","PSJEXP",57,0)
 Q
"RTN","PSJEXP",58,0)
GS F PST="C","P","R" F SD1=SD:0 S SD1=$O(^PS(55,PSGP,5,"AU",PST,SD1)) Q:'SD1!(SD1>FD)  F PSJJORD=0:0 S PSJJORD=$O(^PS(55,PSGP,5,"AU",PST,SD1,PSJJORD)) Q:'PSJJORD  I $D(^PS(55,PSGP,5,PSJJORD,0)),$P(^(0),U,9)'["D",$P(^(0),U,27)'["R" D ARSET
"RTN","PSJEXP",59,0)
 I $D(^TMP("PSG",$J,$E(TM,1,10),$E(PSJPWDN,1,10),$E(PSJPRB,1,12),PPN)) S ^(PPN)=TM_"^"_PSJPWDN_"^"_PSJPRB_"^"_$P(PSGP(0),"^")_"^"_$P(PSJPSEX,"^",2)_"^"_$P(PSJPDOB,"^",2)_";"_PSJPAGE_"^"_VA("PID")_"^"_PSJPDX_"^"_PSJPWT
"RTN","PSJEXP",60,0)
 ;naked reference below refers to the full global references to ^TMP on the line above
"RTN","PSJEXP",61,0)
 I  S ^(PPN)=^(PPN)_"^"_$P(PSJPAD,"^",2)_"^"_$P(PSJPTD,"^",2)
"RTN","PSJEXP",62,0)
 Q
"RTN","PSJEXP",63,0)
GSIV S PST="C"
"RTN","PSJEXP",64,0)
 S SD1IV=SD F  S SD1IV=$O(^PS(55,PSGP,"IV","AIS",SD1IV)) Q:'SD1IV!(SD1IV>FD)  F PSJJORD=0:0 S PSJJORD=$O(^PS(55,PSGP,"IV","AIS",SD1IV,PSJJORD)) Q:'PSJJORD  D
"RTN","PSJEXP",65,0)
 .I $D(^PS(55,PSGP,"IV",PSJJORD,0)),$P(^(0),U,17)'["D",$P(^PS(55,PSGP,"IV",PSJJORD,2),U,9)'["R" D ARSETIV
"RTN","PSJEXP",66,0)
 I $D(^TMP("PSG",$J,$E(TM,1,10),$E(PSJPWDN,1,10),$E(PSJPRB,1,12),PPN)) S ^(PPN)=TM_"^"_PSJPWDN_"^"_PSJPRB_"^"_$P(PSGP(0),"^")_"^"_$P(PSJPSEX,"^",2)_"^"_$P(PSJPDOB,"^",2)_";"_PSJPAGE_"^"_VA("PID")_"^"_PSJPDX_"^"_PSJPWT
"RTN","PSJEXP",67,0)
 ;naked reference below refers to the full global references to ^TMP on the line above
"RTN","PSJEXP",68,0)
 I  S ^(PPN)=^(PPN)_"^"_$P(PSJPAD,"^",2)_"^"_$P(PSJPTD,"^",2)
"RTN","PSJEXP",69,0)
 Q
"RTN","PSJEXP",70,0)
ARSET S ND=$G(^PS(55,PSGP,5,PSJJORD,0)),PR=$P(ND,"^",2),ST=$P(ND,"^",9),MR=$P(ND,"^",3),PR=$$ENNPN^PSGMI(PR)
"RTN","PSJEXP",71,0)
 S MR=$$ENMRN^PSGMI(MR) S X=$$NFWS^PSJUTL1(PSGP,PSJJORD_"U",PSJPWD),SM=$S('$P(X,U,3):0,$P(X,U,4):1,1:2)
"RTN","PSJEXP",72,0)
 S ND=$G(^PS(55,PSGP,5,PSJJORD,2)),DRG=$G(^(.2)),SCH=$P(ND,"^"),STD=$P(ND,"^",2)\1,DO=$P(DRG,"^",2) I DO]"",$E(DO,$L(DO))'=" " S DO=DO_" "
"RTN","PSJEXP",73,0)
 N X,PSG
"RTN","PSJEXP",74,0)
 D DRGDISP^PSJLMUT1(PSGP,PSJJORD_"U",15,0,.PSG,1)
"RTN","PSJEXP",75,0)
 S DRG=PSG(1) I $G(PSJPWDN)="" S PSJPWDN="UNKNOWN"
"RTN","PSJEXP",76,0)
 S ^TMP("PSG",$J,$E(TM,1,10),$E(PSJPWDN,1,10),$E(PSJPRB,1,12),PPN,SD1,PST,$S(DRG'="NOT FOUND":$E(DRG,1,15),1:"zz")_"^"_PSJJORD)=DRG_"^"_STD_"^"_DO_MR_" "_SCH_"^"_ST_"^"_PR_"^^^"_SM Q
"RTN","PSJEXP",77,0)
 ;
"RTN","PSJEXP",78,0)
ARSETIV N X,ON55 S DFN=PSGP,ON=PSJJORD D GT55^PSIVORFB
"RTN","PSJEXP",79,0)
 S DRG=$S($G(DRG("AD",1))]"":$P(DRG("AD",1),U,2),1:$P($G(DRG("SOL",1)),U,2)),STD=P(2)\1,MR=$P(P("MR"),U,2),SCH=P(9),IR=P(8),ST=P(17),PR=$P(P(6),U,2)
"RTN","PSJEXP",80,0)
 I $G(PSJPWDN)="" S PSJPWDN="UNKNOWN"
"RTN","PSJEXP",81,0)
 S ^TMP("PSG",$J,$E(TM,1,10),$E(PSJPWDN,1,10),$E(PSJPRB,1,12),PPN,SD1IV,PST,$S(DRG'="NOT FOUND":$E(DRG,1,15),1:"zz")_"^"_PSJJORD_"V")=DRG_"^"_STD_"^"_MR_" "_SCH_" "_IR_"^"_ST_"^"_PR Q
"RTN","PSJEXP",82,0)
 ;
"RTN","PSJEXP",83,0)
G S DIC="^PS(57.5,",DIC(0)="AEIMQZ" W ! D ^DIC K DIC W ! S:X="^OTHER" PSJMSG="^OTHER",PSGSS="C",Y(0,0)=2,Y=2 S WG=+Y S:+Y>0 PSJMSG=Y(0,0) Q
"RTN","PSJEXP",84,0)
W S DIC="^DIC(42,",DIC(0)="AEIMQZ",DIC("A")="Select WARD: " W ! D ^DIC K DIC S WD=+Y S:+Y>0 PSJMSG=Y(0,0) Q
"RTN","PSJEXP",85,0)
P D ENP^PSGGAO S Y=PSGP S:PSGP>0 PSJMSG=$P(PSGP(0),"^") Q
"RTN","PSJEXP",86,0)
DT S Y=-1 F  W !!,"Enter ",D," date: " R X:DTIME W:'$T $C(7) S:'$T X="^" D DTM:X?1."?",^%DT:"^"'[X I Y>0!("^"[X) W:Y<0 !,"No ",D," date chosen for notices run." Q
"RTN","PSJEXP",87,0)
 Q
"RTN","PSJEXP",88,0)
DTM W !!?2,"Enter the ",D," date of the range of dates to find orders about to expire.",!,"The start date and stop date may be the  same." W:D="stop" "  The stop date may not come before the start date." W ! Q
"RTN","PSJFTR")
0^86^B27993385
"RTN","PSJFTR",1,0)
PSJFTR ;BIR/JCH-INPATIENT MEDS FREE TEXT DOSAGE REPORT ;15 Nov 01 / 9:45 AM
"RTN","PSJFTR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**65,73,76,111**;16 Dec 97
"RTN","PSJFTR",3,0)
 ;
"RTN","PSJFTR",4,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJFTR",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJFTR",6,0)
 ; Reference to ^PSSORPH is supported by DBIA 3234.
"RTN","PSJFTR",7,0)
 ; 
"RTN","PSJFTR",8,0)
 ;List IP orders that have free text dosages for a given date range.
"RTN","PSJFTR",9,0)
 ;Report is sorted by drug and physician.
"RTN","PSJFTR",10,0)
 ;
"RTN","PSJFTR",11,0)
BEG ;Begin
"RTN","PSJFTR",12,0)
 N BEGDT,ENDT
"RTN","PSJFTR",13,0)
 W !,"This report searches for Free Text Dosages in Inpatient Unit Dose Orders"
"RTN","PSJFTR",14,0)
 W !,"for a range of dates. Orders with Stop Dates that fall within the range"
"RTN","PSJFTR",15,0)
 W !,"are included in the report."
"RTN","PSJFTR",16,0)
 W ! K %DT S %DT("A")="Beginning Date: ",%DT="APE"
"RTN","PSJFTR",17,0)
 D ^%DT G:Y<0!($D(DTOUT)) EXIT S (%DT(0),BEGDT)=Y
"RTN","PSJFTR",18,0)
 W ! S %DT("A")="Ending Date: "
"RTN","PSJFTR",19,0)
 D ^%DT G:Y<0!($D(DTOUT)) EXIT S ENDT=Y D:+$E(Y,6,7)=0 DTC
"RTN","PSJFTR",20,0)
 K %DT(0)
"RTN","PSJFTR",21,0)
 ;
"RTN","PSJFTR",22,0)
DEV ;Device
"RTN","PSJFTR",23,0)
 K %ZIS,IOP,POP,ZTSK S PSJION=$I,%ZIS="QM"
"RTN","PSJFTR",24,0)
 D ^%ZIS K %ZIS
"RTN","PSJFTR",25,0)
 I POP S IOP=PSJION D ^%ZIS K IOP,PSJION W !,"Please try later!" G EXIT
"RTN","PSJFTR",26,0)
 K PSJION I $D(IO("Q")) D  G EXIT
"RTN","PSJFTR",27,0)
 .S ZTDESC="Rx free text dosage report",ZTRTN="START^PSJFTR"
"RTN","PSJFTR",28,0)
 .F G="BEGDT","ENDT" S:$D(@G) ZTSAVE(G)=""
"RTN","PSJFTR",29,0)
 .K IO("Q") D ^%ZTLOAD W:$D(ZTSK) !,"Report is Queued to print!" K ZTSK
"RTN","PSJFTR",30,0)
START ;Start processing date range
"RTN","PSJFTR",31,0)
 N PSGND0,PSGDT,PSGORD,PSJDOSE,PSGDRG,PSJDRN,PSJPR,PSJCNT
"RTN","PSJFTR",32,0)
 N PSJL,PSJY,PSJC,STOPDT,DRGNODE,STDT
"RTN","PSJFTR",33,0)
 K ^TMP("PSJFTR",$J)
"RTN","PSJFTR",34,0)
 S Q=0 W:$E(IOST)="C" !!!,"Working - please wait.."
"RTN","PSJFTR",35,0)
UD ;
"RTN","PSJFTR",36,0)
ST1 ;
"RTN","PSJFTR",37,0)
 S PSGDFN=0,STOPDT=ENDT_".99999"
"RTN","PSJFTR",38,0)
 F  S PSGDFN=$O(^PS(55,PSGDFN)) Q:'PSGDFN!$D(DIRUT)  D
"RTN","PSJFTR",39,0)
 .S STDT=BEGDT-.0001
"RTN","PSJFTR",40,0)
 .F  S STDT=$O(^PS(55,PSGDFN,5,"AUS",STDT)) Q:'STDT!(STDT>STOPDT)!$D(DIRUT)  D
"RTN","PSJFTR",41,0)
 ..S PSGORD="" I PSGDFN=740 S JCH=$G(JCH)+1
"RTN","PSJFTR",42,0)
 ..F  S PSGORD=$O(^PS(55,PSGDFN,5,"AUS",STDT,PSGORD)) Q:PSGORD=""!$D(DIRUT)  D
"RTN","PSJFTR",43,0)
 ...Q:'$D(^PS(55,PSGDFN,5,PSGORD,1,0))
"RTN","PSJFTR",44,0)
 ...S PSGDCNT=0 F  S PSGDCNT=$O(^PS(55,PSGDFN,5,PSGORD,1,PSGDCNT)) Q:'PSGDCNT  D
"RTN","PSJFTR",45,0)
 ....N PKG,LOCNOD,ORDOSE,FMDOSE,FMUNIT,NOTXT,NXT,DARRAY,POSDOSE,LOCDOSE
"RTN","PSJFTR",46,0)
 ....S NOTXT=0
"RTN","PSJFTR",47,0)
 ....S PSGDRG=+$G(^PS(55,PSGDFN,5,PSGORD,1,PSGDCNT,0))
"RTN","PSJFTR",48,0)
 ....Q:'$D(^PSDRUG(PSGDRG))!'PSGDRG
"RTN","PSJFTR",49,0)
 ....S DRGNODE=$G(^PS(55,PSGDFN,5,PSGORD,.2)),PSGND0=^PS(55,PSGDFN,5,PSGORD,0)
"RTN","PSJFTR",50,0)
 ....S FMDOSE=$P(DRGNODE,"^",5),FMUNIT=$P(DRGNODE,"^",6)
"RTN","PSJFTR",51,0)
 ....I FMDOSE]"",FMUNIT]"" Q
"RTN","PSJFTR",52,0)
 ....S ORDOSE=$P(DRGNODE,"^",2) Q:ORDOSE=""   ; Nothing there?
"RTN","PSJFTR",53,0)
 ....I $E(IOST)="C" S Q=Q+1 W:'(Q#50) "."
"RTN","PSJFTR",54,0)
 ....K DARRAY S DARRAY="" D DOSE^PSSORPH(.DARRAY,PSGDRG,"U")
"RTN","PSJFTR",55,0)
 ....I '$G(DARRAY(1)) D CHKLOC  ; check local doses
"RTN","PSJFTR",56,0)
 ....I $G(DARRAY(1)) D CHKPOS   ; check possible doses
"RTN","PSJFTR",57,0)
 ....Q:NOTXT  ; Not free text
"RTN","PSJFTR",58,0)
 ....D PRD
"RTN","PSJFTR",59,0)
 U IO S PSJPG=1,PSJCNT=0 D HD
"RTN","PSJFTR",60,0)
 I '$D(^TMP("PSJFTR",$J,"B")) W !!,"***** No Records were found for this period *****",!! G EXIT
"RTN","PSJFTR",61,0)
DET ;
"RTN","PSJFTR",62,0)
 S J="" F  S J=$O(^TMP("PSJFTR",$J,"B",J)) Q:J=""  D  Q:$D(DIRUT)
"RTN","PSJFTR",63,0)
 .S L="",Q=0,Q2=0
"RTN","PSJFTR",64,0)
 .F  S L=$O(^TMP("PSJFTR",$J,"B",J,L)) Q:L=""  D  Q:$D(DIRUT)
"RTN","PSJFTR",65,0)
 ..S PSGDRG=$O(^TMP("PSJFTR",$J,"B",J,L,0))
"RTN","PSJFTR",66,0)
 ..Q:'PSGDRG
"RTN","PSJFTR",67,0)
 ..S Y=^TMP("PSJFTR",$J,"B",J,L,PSGDRG,0)
"RTN","PSJFTR",68,0)
 ..W:'Q !,$E(J,1,30)_" ("_PSGDRG_")"
"RTN","PSJFTR",69,0)
 ..W:Q2'=Q !,$E(J,1,30)_" ("_PSGDRG_")"," - (Continued)",!
"RTN","PSJFTR",70,0)
 ..W:$L(L)>35 ?40,$E(L,1,35),!,?40,$E(L,36,99) W:$L(L)'>35 ?40,L
"RTN","PSJFTR",71,0)
 ..W ?75,+Y,!,"    "
"RTN","PSJFTR",72,0)
 ..S Q=Q+1,Q2=Q
"RTN","PSJFTR",73,0)
 ..S PR=0 F  S PR=$O(^TMP("PSJFTR",$J,"B",J,L,PSGDRG,PR)) Q:'PR  D
"RTN","PSJFTR",74,0)
 ...S Y=^TMP("PSJFTR",$J,"B",J,L,PSGDRG,PR),T=$S(PR=.1:"PROVIDER NOT FOUND",1:$P(^VA(200,+PR,0),"^"))
"RTN","PSJFTR",75,0)
 ...S T=T_":"_Y_"  "
"RTN","PSJFTR",76,0)
 ...W:($X+$L(T))>74 !?4
"RTN","PSJFTR",77,0)
 ...W T
"RTN","PSJFTR",78,0)
 ..W ! I ($Y+5)>IOSL D HD S Q2=0
"RTN","PSJFTR",79,0)
EXIT W ! D ^%ZISC K DIR,DTOUT,DUOUT,DIROUT,DIRUT,^TMP("PSJFTR",$J),I,X,T,J,L,Q,Y
"RTN","PSJFTR",80,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSJFTR",81,0)
 Q
"RTN","PSJFTR",82,0)
PRD ;
"RTN","PSJFTR",83,0)
 S PSJDRN=$P(^PSDRUG(PSGDRG,0),"^"),PSJPR=+$P(PSGND0,"^",2)
"RTN","PSJFTR",84,0)
 I 'PSJPR S PSJPR=.1
"RTN","PSJFTR",85,0)
 I '$D(^TMP("PSJFTR",$J,"B",PSJDRN,ORDOSE,PSGDRG,PSJPR)) D  Q
"RTN","PSJFTR",86,0)
 .S ^TMP("PSJFTR",$J,"B",PSJDRN,ORDOSE,PSGDRG,PSJPR)=1
"RTN","PSJFTR",87,0)
 .S ^TMP("PSJFTR",$J,"B",PSJDRN,ORDOSE,PSGDRG,0)=$G(^TMP("PSJFTR",$J,"B",PSJDRN,ORDOSE,PSGDRG,0))+1
"RTN","PSJFTR",88,0)
 I $D(^TMP("PSJFTR",$J,"B",PSJDRN,ORDOSE,PSGDRG,PSJPR)) D  Q
"RTN","PSJFTR",89,0)
 .S Y=^TMP("PSJFTR",$J,"B",PSJDRN,ORDOSE,PSGDRG,PSJPR)
"RTN","PSJFTR",90,0)
 .S Y=Y+1,^TMP("PSJFTR",$J,"B",PSJDRN,ORDOSE,PSGDRG,PSJPR)=Y
"RTN","PSJFTR",91,0)
 .S X=^TMP("PSJFTR",$J,"B",PSJDRN,ORDOSE,PSGDRG,0)
"RTN","PSJFTR",92,0)
 .S X=X+1,^TMP("PSJFTR",$J,"B",PSJDRN,ORDOSE,PSGDRG,0)=X
"RTN","PSJFTR",93,0)
 Q
"RTN","PSJFTR",94,0)
 ;
"RTN","PSJFTR",95,0)
CHKPOS ; Check for possible doses
"RTN","PSJFTR",96,0)
 S NOTXT=0
"RTN","PSJFTR",97,0)
 S NXT="" F  S NXT=$O(DARRAY(NXT)) Q:'NXT!NOTXT  D
"RTN","PSJFTR",98,0)
 .Q:$P($G(^PSDRUG(PSGDRG,"DOS1",NXT,0)),"^",3)'["I"
"RTN","PSJFTR",99,0)
 .S POSDOSE=$P(DARRAY(NXT),"^",1)_$P(DARRAY(NXT),"^",2) I POSDOSE=ORDOSE S NOTXT=1
"RTN","PSJFTR",100,0)
 Q
"RTN","PSJFTR",101,0)
 ;
"RTN","PSJFTR",102,0)
CHKLOC ; Check for local doses
"RTN","PSJFTR",103,0)
 S NOTXT=0
"RTN","PSJFTR",104,0)
 S NXT="" F  S NXT=$O(DARRAY(NXT)) Q:'NXT!NOTXT  D
"RTN","PSJFTR",105,0)
 .Q:$P($G(^PSDRUG(PSGDRG,"DOS2",NXT,0)),"^",2)'["I"
"RTN","PSJFTR",106,0)
 .S LOCDOSE=$P(DARRAY(NXT),"^",3) I LOCDOSE=ORDOSE S NOTXT=1
"RTN","PSJFTR",107,0)
 Q
"RTN","PSJFTR",108,0)
 ;
"RTN","PSJFTR",109,0)
HD ;
"RTN","PSJFTR",110,0)
 I PSJPG>1,$E(IOST)="C" S DIR(0)="E",DIR("A")=" Press Return to Continue or ^ to Exit" D ^DIR K DIR
"RTN","PSJFTR",111,0)
 Q:$D(DIRUT)
"RTN","PSJFTR",112,0)
 N FMTDT
"RTN","PSJFTR",113,0)
 I PSJPG=1,$E(IOST)="C" W @IOF
"RTN","PSJFTR",114,0)
 I PSJPG>1 W @IOF W "Run Date: " S FMTDT=$$FMTE^XLFDT(DT) W FMTDT
"RTN","PSJFTR",115,0)
 W ?72,"Page "_PSJPG S PSJPG=PSJPG+1
"RTN","PSJFTR",116,0)
 W !,?15,"Inpatient Free Text Dosage Entry Report",!,?17,"Period: "
"RTN","PSJFTR",117,0)
 S FMTDT=$$FMTE^XLFDT(BEGDT) W FMTDT W " to "
"RTN","PSJFTR",118,0)
 S FMTDT=$$FMTE^XLFDT(ENDT) W FMTDT
"RTN","PSJFTR",119,0)
 W !,"Drug",?40,"Free Text Entry",?74,"Count",!,"    Provider:Count"
"RTN","PSJFTR",120,0)
 W ! F Y=1:1:79 W "-"
"RTN","PSJFTR",121,0)
 W ! Q
"RTN","PSJFTR",122,0)
DTC ;
"RTN","PSJFTR",123,0)
 N DD,MM S DD=31,MM=+$E(Y,4,5) I MM'=12 S MM=MM+1,MM=$S(MM<10:"0",1:"")_MM,X2=Y,X1=$E(Y,1,3)_MM_"00" D ^%DTC S DD=X
"RTN","PSJFTR",124,0)
 S ENDT=Y+DD
"RTN","PSJFTR",125,0)
 Q
"RTN","PSJHL2")
0^90^B30797471
"RTN","PSJHL2",1,0)
PSJHL2 ;BIR/RLW-PATIENT ID AND VISIT SEGMENTS ;22 Nov 1999  9:27 AM
"RTN","PSJHL2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,18,16,23,28,42,50,70,58,100,102,110,111**;16 DEC 97
"RTN","PSJHL2",3,0)
 ;
"RTN","PSJHL2",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL2",5,0)
 ; Reference to ^ORERR is supported by DBIA# 2187.
"RTN","PSJHL2",6,0)
 ;
"RTN","PSJHL2",7,0)
EN1(PSJHLDFN,PSOC,PSJORDER,PSREASON) ; start here
"RTN","PSJHL2",8,0)
 ; passed in are PSJHLDFN (patient ien)
"RTN","PSJHL2",9,0)
 ;               PSJORDER* (order_file (N,P,V, etc))
"RTN","PSJHL2",10,0)
 ;               PSOC* (order control code - NW for new order, OK to return filler number to OE/RR, OC for order canceled, SC for status change)
"RTN","PSJHL2",11,0)
 ;               PSREASON* (text reason)
"RTN","PSJHL2",12,0)
 ; *=optional, only required if an order segment is also to be generated
"RTN","PSJHL2",13,0)
START ;
"RTN","PSJHL2",14,0)
 K ^TMP("PSJHLS",$J,"PS")
"RTN","PSJHL2",15,0)
 N CLERK,J,LIMIT,NAME,NEXT,NODE1,NODE2,NODE4,NOO,PSJCLEAR,PSJHINST,PSJHLSDT,PROVIDER,PSJI,ROOMBED,RXORDER,STATUS,UNDO,VERIFY,WARD
"RTN","PSJHL2",16,0)
 S RXORDER=PSJORDER,PSJORDER=$S((PSJORDER["N")!(PSJORDER["P"):"^PS(53.1,"_+PSJORDER,PSJORDER["V":"^PS(55,"_PSJHLDFN_",""IV"","_+PSJORDER,1:"^PS(55,"_PSJHLDFN_",5,"_+PSJORDER)_","
"RTN","PSJHL2",17,0)
 I RXORDER["P",$P($G(@(PSJORDER_"0)")),U,15)'=PSJHLDFN S ORDCON="Patient does not match/PSJHL2" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON) Q
"RTN","PSJHL2",18,0)
 S UNDO=$S("OC^CR"[PSOC:1,1:0)
"RTN","PSJHL2",19,0)
 D INIT,PID,PV1,ORC
"RTN","PSJHL2",20,0)
 D @$S("SN^SC^OC^OD^DR^CR^OH^OR^XX^ZC^XR"[PSOC:"EN1^PSJHL3(PSJHLDFN,PSOC,PSJORDER)",1:"CALL^PSJHLU(PSJI)")
"RTN","PSJHL2",21,0)
 I UNDO D UNDO
"RTN","PSJHL2",22,0)
 K ^TMP("PSJHLS",$J,"PS"),FIELD
"RTN","PSJHL2",23,0)
 Q
"RTN","PSJHL2",24,0)
 ;
"RTN","PSJHL2",25,0)
INIT ; initialize HL7 variables, set master file identification segment
"RTN","PSJHL2",26,0)
 ; PSJHLMTN = message type - ORR for messages sent as a response to an OE/RR event; ORM for "unsolicited" messages.
"RTN","PSJHL2",27,0)
 S PSJI=0,PSJHLMTN=$S($G(PSJHLMTN)]"":PSJHLMTN,1:"ORM")
"RTN","PSJHL2",28,0)
 D INIT^PSJHLU
"RTN","PSJHL2",29,0)
 S LIMIT=17 X PSJCLEAR
"RTN","PSJHL2",30,0)
 S FIELD(0)="MSH",FIELD(1)="^~\&",FIELD(2)="PHARMACY",FIELD(3)=$G(PSJHINST),FIELD(8)=PSJHLMTN
"RTN","PSJHL2",31,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",32,0)
 Q
"RTN","PSJHL2",33,0)
 ;
"RTN","PSJHL2",34,0)
PID ; get patient data, format PID SEGMENT
"RTN","PSJHL2",35,0)
 S LIMIT=22 X PSJCLEAR
"RTN","PSJHL2",36,0)
 S FIELD(0)="PID"
"RTN","PSJHL2",37,0)
 S FIELD(3)=PSJHLDFN
"RTN","PSJHL2",38,0)
 N DFN S DFN=PSJHLDFN D DEM^VADPT S FIELD(5)=VADM(1)
"RTN","PSJHL2",39,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",40,0)
 Q
"RTN","PSJHL2",41,0)
 ;
"RTN","PSJHL2",42,0)
PV1 ; get patient visit information, format PV1 segment
"RTN","PSJHL2",43,0)
 S LIMIT=50 X PSJCLEAR
"RTN","PSJHL2",44,0)
 S FIELD(0)="PV1"
"RTN","PSJHL2",45,0)
 I PSJHLMTN="ORR" S FIELD(3)=LOC
"RTN","PSJHL2",46,0)
 I PSJHLMTN="ORM" D
"RTN","PSJHL2",47,0)
 .S LOC="",WARD=$G(^DPT(PSJHLDFN,.1)),LOC=$S($G(WARD)]"":$O(^SC("B",WARD,LOC)),1:LOC)
"RTN","PSJHL2",48,0)
 .I $G(LOC)="" D
"RTN","PSJHL2",49,0)
 .. N A
"RTN","PSJHL2",50,0)
 .. I RXORDER["P",($G(^PS(53.1,+RXORDER,"DSS"))) S A=^("DSS"),LOC=$P(A,"^"),PSJAPPT=$P(A,"^",2)
"RTN","PSJHL2",51,0)
 .. I RXORDER["V",($G(^PS(55,PSJHLDFN,"IV",+RXORDER,"DSS"))) S A=^("DSS"),LOC=$P(A,"^"),PSJAPPT=$P(A,"^",2)
"RTN","PSJHL2",52,0)
 .. I RXORDER["U",$G(^PS(55,PSJHLDFN,5,+RXORDER,8)) S A=^(8),LOC=$P(A,"^"),PSJAPPT=$P(A,"^",2)
"RTN","PSJHL2",53,0)
 .I $G(LOC)]"" S ROOMBED=$G(^DPT(PSJHLDFN,.101)),LOC=LOC_"^"_ROOMBED
"RTN","PSJHL2",54,0)
 .S FIELD(3)=LOC I $G(PSJAPPT)]"" S FIELD(44)=$$FMTHL7^XLFDT(PSJAPPT)
"RTN","PSJHL2",55,0)
 S FIELD(2)=$S($G(CLASS)="O":CLASS,1:"I")
"RTN","PSJHL2",56,0)
 I FIELD(2)="I" N DFN S DFN=PSJHLDFN D INP^VADPT S FIELD(19)=VAIN(1)
"RTN","PSJHL2",57,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",58,0)
 Q
"RTN","PSJHL2",59,0)
 ;
"RTN","PSJHL2",60,0)
ORC ; order control segment
"RTN","PSJHL2",61,0)
 S LIMIT=18 X PSJCLEAR
"RTN","PSJHL2",62,0)
 Q:'$D(PSJORDER)!'$D(PSOC)
"RTN","PSJHL2",63,0)
 S NODE1=$G(@(PSJORDER_"0)")),NODE2=$G(@(PSJORDER_"2)"))
"RTN","PSJHL2",64,0)
 S NODE4=$G(@(PSJORDER_"4)"))
"RTN","PSJHL2",65,0)
 S FIELD(0)="ORC"
"RTN","PSJHL2",66,0)
 S FIELD(1)=PSOC
"RTN","PSJHL2",67,0)
 S FIELD(2)=$S(PSOC="SN":"",1:$P(NODE1,"^",21))_"^OR" I $P(FIELD(2),"^")=0 S $P(FIELD(2),"^")="" ; IV orders are created with a zero in the oerr order number, for some reason
"RTN","PSJHL2",68,0)
 S FIELD(3)=RXORDER_"^PS"
"RTN","PSJHL2",69,0)
 ; translate Pharmacy status code to HL7 status code, set in FIELD(5)
"RTN","PSJHL2",70,0)
 S STATUS=$S($G(PSJEXPOE):"E",(($P(NODE1,"^",17)]"")&(RXORDER["V")):($P(NODE1,"^",17)),($P(NODE1,"^",9)]""):$P(NODE1,"^",9),$G(PSIVCOPY):"DE",1:"")
"RTN","PSJHL2",71,0)
 D @STATUS
"RTN","PSJHL2",72,0)
 I STATUS="U",RXORDER["P" S FIELD(3)="^PS"
"RTN","PSJHL2",73,0)
 S FIELD(9)=$S(RXORDER["V":$$FMTHL7^XLFDT($P(NODE2,"^")),1:$$FMTHL7^XLFDT($P(NODE1,"^",16)))
"RTN","PSJHL2",74,0)
 S CLERK=$S(RXORDER["V":$P(NODE2,"^",11),1:$P(NODE4,"^",7))
"RTN","PSJHL2",75,0)
 S NAME=$P($G(^VA(200,+CLERK,0)),"^")
"RTN","PSJHL2",76,0)
 S FIELD(10)=CLERK_"^"_NAME
"RTN","PSJHL2",77,0)
 I PSOC="ZV"!($G(PSJBCBU)) S VERIFY=$P($G(NODE4),"^"),FIELD(11)=VERIFY_"^"_$P($G(^VA(200,+VERIFY,0)),"^"),FIELD(9)=$$FMTHL7^XLFDT($P(NODE4,"^",2))
"RTN","PSJHL2",78,0)
 S PROVIDER=$S($G(PSJDCPRV)]"":$G(PSJDCPRV),RXORDER["V":$P(NODE1,"^",6),1:$P(NODE1,"^",2)) K PSJDCPRV
"RTN","PSJHL2",79,0)
 S NAME=$P($G(^VA(200,+PROVIDER,0)),"^")
"RTN","PSJHL2",80,0)
 S FIELD(12)=PROVIDER_"^"_NAME
"RTN","PSJHL2",81,0)
 S FIELD(15)=$S(RXORDER["V":$$FMTHL7^XLFDT($P(NODE1,"^",2)),1:$$FMTHL7^XLFDT($P(NODE2,"^",2)))
"RTN","PSJHL2",82,0)
 I $S(RXORDER["V":$P(NODE2,"^",8)="R",1:$P(NODE1,"^",24)="R")
"RTN","PSJHL2",83,0)
 N FIELD9 S FIELD9=$$FMTHL7^XLFDT($$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)) I FIELD9>FIELD(9) S FIELD(9)=FIELD9,FIELD(15)=FIELD9
"RTN","PSJHL2",84,0)
 S NOO=$S(PSJORDER["IV":$G(P("NAT")),(($G(PSJNOO)="")&($G(P("NAT"))]"")):$G(P("NAT")),1:$G(PSJNOO)),PSREASON=$S(NOO="D":"",1:$G(PSREASON))
"RTN","PSJHL2",85,0)
 S FIELD(16)=NOO_U_$S(NOO="P":"Telephoned",NOO="D":"Duplicate",NOO="X":"Rejected",NOO="A":"Auto",NOO="S":"Service Correction",NOO="W":"Written",NOO="V":"Verbal",NOO="E":"Physician Entered",NOO="I":"Policy",1:"")_U_"99ORN"_U_U_$G(PSREASON)_U
"RTN","PSJHL2",86,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",87,0)
 Q
"RTN","PSJHL2",88,0)
 ;
"RTN","PSJHL2",89,0)
DISPLAY ; just for testing
"RTN","PSJHL2",90,0)
 I $G(MSGTEST) W ! F NEXT=0:1:LIMIT W FIELD(NEXT)_"|"
"RTN","PSJHL2",91,0)
 Q
"RTN","PSJHL2",92,0)
UNDO ;Undo Renew if Pending Renewal is dc'd
"RTN","PSJHL2",93,0)
 I RXORDER["P",(STATUS="D"),($G(PSJNOO)'="A"),($P(NODE1,U,24)="R") D ENBKOUT^PSJOREN(PSJHLDFN,RXORDER)
"RTN","PSJHL2",94,0)
 Q
"RTN","PSJHL2",95,0)
 ;
"RTN","PSJHL2",96,0)
A S FIELD(5)="CM" Q  ; active
"RTN","PSJHL2",97,0)
D S FIELD(5)="DC" Q  ; discontinued
"RTN","PSJHL2",98,0)
I S FIELD(5)="IP" Q  ; incomplete
"RTN","PSJHL2",99,0)
N S FIELD(5)="IP" Q  ; non-verified
"RTN","PSJHL2",100,0)
U S FIELD(5)="ZX" Q  ; unreleased
"RTN","PSJHL2",101,0)
P S FIELD(5)="IP" Q  ; pending
"RTN","PSJHL2",102,0)
DE S FIELD(5)="RP" Q  ; discontinued (edit)
"RTN","PSJHL2",103,0)
E S FIELD(5)="ZE" Q  ; expired
"RTN","PSJHL2",104,0)
H S FIELD(5)="HD" Q  ; hold
"RTN","PSJHL2",105,0)
R S FIELD(5)="ZZ" Q  ; renewed
"RTN","PSJHL2",106,0)
RE S FIELD(5)="CM" Q  ; reinstated
"RTN","PSJHL2",107,0)
DR S FIELD(5)="DC" Q  ; discontinued (renewal)
"RTN","PSJHL2",108,0)
O S FIELD(5)="HD" Q  ; on call (is this kind of like HOLD?)
"RTN","PSJHL3")
0^120^B63058667
"RTN","PSJHL3",1,0)
PSJHL3 ;BIR/RLW-PHARMACY ORDER SEGMENTS ;04 Aug 98 / 10:10 AM
"RTN","PSJHL3",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,11,14,40,42,47,50,56,58,92,101,102,123,110,111**;16 DEC 97
"RTN","PSJHL3",3,0)
 ;
"RTN","PSJHL3",4,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJHL3",5,0)
 ; Reference to ^PS(50.607 is supported by DBIA# 2221.        
"RTN","PSJHL3",6,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL3",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL3",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL3",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL3",10,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL3",11,0)
 ; Reference to ^PSDRUG( is supported by DBIA# 2192.
"RTN","PSJHL3",12,0)
 ; Reference to ^PSNDF( is supported by DBIA# 2195.
"RTN","PSJHL3",13,0)
 ; Reference to ^VA(200 is supported by DBIA# 10060.
"RTN","PSJHL3",14,0)
 ; Reference to ^PSNAPIS is supported by DBIA# 2531.
"RTN","PSJHL3",15,0)
 ; Reference to ^XLFDT is supported by DBIA# 10103.
"RTN","PSJHL3",16,0)
 ; Reference to ^PSSUTIL1 is supported by DBIA# 3179.
"RTN","PSJHL3",17,0)
 ;
"RTN","PSJHL3",18,0)
EN1(PSJHLDFN,PSOC,PSJORDER) ; start here
"RTN","PSJHL3",19,0)
 ; passed in are PSJHLDFN (patient ien)
"RTN","PSJHL3",20,0)
 ;               PSJORDER (file root of order)
"RTN","PSJHL3",21,0)
 ;               OC (order control code - NW for new order, OK for finished order, OC for order canceled)
"RTN","PSJHL3",22,0)
 I $G(PSJHLDFN)']""!$G(PSOC)']""!$G(PSJORDER)']"" W !,"INSUFFICIENT DATA FOR ^PSJHL3" Q
"RTN","PSJHL3",23,0)
 N COMMENTS,DDIEA,DDNUM,DOSE,DOSEFORM,DOSEOR,NAME,DURATION,IVTYPE,NODE1,NODE2,NDNODE,OINODE,PSGPLS,PSGPLF,PRODNAME,SPDIEN,UNIT,UNITS,CNT,DDIEN,SCHEDULE
"RTN","PSJHL3",24,0)
 D INIT
"RTN","PSJHL3",25,0)
 S IVTYPE=$S(RXORDER["U":"",1:$$IVTYPE^PSJHLU(PSJORDER))
"RTN","PSJHL3",26,0)
 D RXO,RXE D:(IVTYPE'="F")!($G(PSJBCBU)) RXR D ZRX
"RTN","PSJHL3",27,0)
 D CALL^PSJHLU(PSJI)
"RTN","PSJHL3",28,0)
 Q
"RTN","PSJHL3",29,0)
 ;
"RTN","PSJHL3",30,0)
INIT ; initialize HL7 variables
"RTN","PSJHL3",31,0)
 D INIT^PSJHLU
"RTN","PSJHL3",32,0)
 Q
"RTN","PSJHL3",33,0)
 ;
"RTN","PSJHL3",34,0)
RXO ; pharmacy prescription order segment (used to send Orderable Item to OE/RR)
"RTN","PSJHL3",35,0)
 S LIMIT=17 X PSJCLEAR
"RTN","PSJHL3",36,0)
 S FIELD(0)="RXO"
"RTN","PSJHL3",37,0)
 S OINODE=$G(@(PSJORDER_".2)"))
"RTN","PSJHL3",38,0)
 S SPDIEN=+$P(OINODE,"^"),DOSEOR=$P(OINODE,"^",2),DOSE=$P(OINODE,"^",5),UNIT=$P(OINODE,"^",6)
"RTN","PSJHL3",39,0)
 S FIELD(1)=$S(SPDIEN=0:"^^^^",1:"^^^"_SPDIEN_"^")
"RTN","PSJHL3",40,0)
 I SPDIEN S DOSEFORM=$P($G(^PS(50.7,SPDIEN,0)),"^",2),NAME=$P($G(^PS(50.606,+DOSEFORM,0)),"^"),FIELD(1)=FIELD(1)_$P($G(^PS(50.7,SPDIEN,0)),"^")_" "_NAME
"RTN","PSJHL3",41,0)
 S FIELD(1)=FIELD(1)_"^99PSP"
"RTN","PSJHL3",42,0)
 N DURNOD S DURNOD=$G(@(PSJORDER_"2.5)")) I $P(DURNOD,"^",4)]"" S $P(FIELD(1),"^",3)=$P(DURNOD,"^",4)
"RTN","PSJHL3",43,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",44,0)
 Q
"RTN","PSJHL3",45,0)
 ;
"RTN","PSJHL3",46,0)
RXE ; pharmacy encoded order segment
"RTN","PSJHL3",47,0)
 S (UNITS,NDNODE,SPDIEN,PRODNAME,DDNUM,DDIEN,CNT)="",LIMIT=26 X PSJCLEAR
"RTN","PSJHL3",48,0)
 S FIELD(0)="RXE"
"RTN","PSJHL3",49,0)
 S NODE1=$G(@(PSJORDER_"0)")),NODE2=$G(@(PSJORDER_"2)"))
"RTN","PSJHL3",50,0)
 I RXORDER["V" D IVRXE Q
"RTN","PSJHL3",51,0)
 I RXORDER["P",IVTYPE="F" D IVRXE Q
"RTN","PSJHL3",52,0)
 I RXORDER["P",$P(NODE1,"^",4)="H" D IVRXE Q
"RTN","PSJHL3",53,0)
 ;S PSGPLS=$P(NODE2,"^",2),PSGPLF=$P(NODE2,"^",4),X1=PSGPLF,X2=PSGPLS D ^%DTC S DURATION="D"_X
"RTN","PSJHL3",54,0)
 N RENEW S RENEW=$$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)
"RTN","PSJHL3",55,0)
 S PSGPLS=$S($G(PSJEXPOE):$P(NODE2,"^",2),RENEW>$P(NODE2,"^",2):RENEW,1:$P(NODE2,"^",2))
"RTN","PSJHL3",56,0)
 S PSGPLF=$S($G(PSJEXPOE):PSJEXPOE,1:$P(NODE2,"^",4))
"RTN","PSJHL3",57,0)
 ;S FIELD(1)="^"_$P(NODE2,"^")_$S($G(PSJBCBU):"&"_$P(NODE2,"^",5),1:"")_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)
"RTN","PSJHL3",58,0)
 S FIELD(1)="^"_$P(NODE2,"^")_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)
"RTN","PSJHL3",59,0)
 S FIELD(21)="^"_$P(NODE2,"^",5)_"^99PSA^^^"
"RTN","PSJHL3",60,0)
 I ($G(DOSEOR)']"")!($O(@(PSJORDER_"1,"" "")"),-1)=1) D
"RTN","PSJHL3",61,0)
 .S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  Q:CNT=1  S DDIEN=+$G(@(PSJORDER_"1,"_DDNUM_",0)")) D
"RTN","PSJHL3",62,0)
 ..S FIELD(1)=$S($P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2)="":"1",1:$P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2))_"&"_FIELD(1)
"RTN","PSJHL3",63,0)
 ..S FIELD(1)=DOSE_"&"_UNIT_"&"_FIELD(1),$P(FIELD(1),"^",8)=$S($G(DOSEOR)]"":$G(DOSEOR),1:DOSE_UNIT)
"RTN","PSJHL3",64,0)
 ..S:$P(FIELD(1),"^",8)="" $P(FIELD(1),"^",8)=$G(@(PSJORDER_".3)"))
"RTN","PSJHL3",65,0)
 ..S NDNODE=$G(^PSDRUG(DDIEN,"ND"))
"RTN","PSJHL3",66,0)
 ..;  CHANGE FOR NEW NDF CALL
"RTN","PSJHL3",67,0)
 ..;S PRODNAME=$S($G(^PSNDF(+NDNODE,5,+$P(NDNODE,"^",3),0))]"":^(0),1:"N/A")
"RTN","PSJHL3",68,0)
 ..S PRODNAME=$S($T(^PSNAPIS)]"":$$PROD0^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),$G(^PSNDF(+NDNODE,5,+$P(NDNODE,"^",3),0))]"":^(0),1:"N/A")
"RTN","PSJHL3",69,0)
 ..S:PRODNAME="" PRODNAME="N/A"
"RTN","PSJHL3",70,0)
 ..S FIELD(2)=$S(PRODNAME="N/A":"^^",1:+NDNODE_"."_+$P(NDNODE,"^",3)_"^"_$P(NDNODE,"^",2)_"^"_"99NDF")_"^"_DDIEN_"^"_$P($G(^PSDRUG(DDIEN,0)),"^")_"^"_"99PSD"
"RTN","PSJHL3",71,0)
 ..;S UNITS=$S(PRODNAME="N/A":"N/A",1:$P($G(^PSNDF(+NDNODE,2,+$P(PRODNAME,"^",2),3,+$P(PRODNAME,"^",3),4,+$P(PRODNAME,"^",4),0)),"^"))
"RTN","PSJHL3",72,0)
 ..S UNITS=$S(PRODNAME="N/A":"N/A",1:$S($T(^PSNAPIS)]"":$P($$DFSU^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),"^",5),1:$P($G(^PSNDF(+NDNODE,2,+$P(PRODNAME,"^",2),3,+$P(PRODNAME,"^",3),4,+$P(PRODNAME,"^",4),0)),"^")))
"RTN","PSJHL3",73,0)
 ..S FIELD(5)="^^^"_UNITS_"^"_$P($G(^PS(50.607,UNITS,0)),"^")_"^99PSU"
"RTN","PSJHL3",74,0)
 ..S FIELD(6)="^^^"_$G(DOSEFORM)_"^"_$P($G(^PS(50.606,+$G(DOSEFORM),0)),"^")_"^99PSF"
"RTN","PSJHL3",75,0)
 ..S FIELD(25)=$$EN^PSSUTIL1(DDIEN),FIELD(26)=$P(FIELD(25),"|",2),FIELD(25)=$P(FIELD(25),"|")
"RTN","PSJHL3",76,0)
 ..S CNT=CNT+1
"RTN","PSJHL3",77,0)
 E  S $P(FIELD(1),"^",8)=DOSEOR
"RTN","PSJHL3",78,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^"),FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",79,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",80,0)
 K SEGMENT S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$G(@(PSJORDER_"12,"_JJ_",0)"))
"RTN","PSJHL3",81,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_SEGMENT(0) D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHL3",82,0)
 I $P($G(@(PSJORDER_"6)")),"^")]"" K SEGMENT S SEGMENT(0)="NTE|21|L|"_$P($G(@(PSJORDER_"6)")),"^") D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",83,0)
 I PSJORDER["P",$P($G(@(PSJORDER_"9)")),"^",2)]"" K SEGMENT S SEGMENT(0)="NTE|21|L|"_$P($G(@(PSJORDER_"9)")),"^",2) D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",84,0)
 Q
"RTN","PSJHL3",85,0)
 ;
"RTN","PSJHL3",86,0)
IVRXE ; RXE segment for IV orders
"RTN","PSJHL3",87,0)
 ; if it's an Inpatient Med IV order, send the RXE with dispense drug
"RTN","PSJHL3",88,0)
 ; information.  If it's an IV FLUID order, send just the start/stop
"RTN","PSJHL3",89,0)
 ; date, duration in the RXE and send an RXC for each additive and
"RTN","PSJHL3",90,0)
 ; solution.
"RTN","PSJHL3",91,0)
 N ADSNODE
"RTN","PSJHL3",92,0)
 I RXORDER["V" S PSGPLS=$P(NODE1,"^",2),PSGPLF=$P(NODE1,"^",3)
"RTN","PSJHL3",93,0)
 E  S PSGPLS=$P(NODE2,"^",2),PSGPLF=$P(NODE2,"^",4)
"RTN","PSJHL3",94,0)
 ;S X1=PSGPLF,X2=PSGPLS D ^%DTC S DURATION=$S(X]"":"D"_X,1:"")
"RTN","PSJHL3",95,0)
 S FIELD(1)="^"_$S(PSJORDER["IV":$P(NODE1,"^",9),1:$P(NODE2,"^"))_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)
"RTN","PSJHL3",96,0)
 ;S:$G(PSJBCBU) $P(FIELD(1),"^",2)=$P(FIELD(1),"^",2)_"&"_$S(PSJORDER["IV":$P(NODE1,"^",11),1:$P(NODE2,"^",5))
"RTN","PSJHL3",97,0)
 S FIELD(21)="^"_$S(PSJORDER["IV":$P(NODE1,"^",11),1:$P(NODE2,"^",5))_"^99PSA^^^"
"RTN","PSJHL3",98,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^")
"RTN","PSJHL3",99,0)
 S FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",100,0)
 N X,Y
"RTN","PSJHL3",101,0)
 I RXORDER["V" S INFUSE=$P(NODE1,"^",8)
"RTN","PSJHL3",102,0)
 E  S INFUSE=$P($G(@(PSJORDER_"8)")),"^",5)
"RTN","PSJHL3",103,0)
 I INFUSE?1N.N1" ml/hr" S FIELD(23)=+INFUSE,Y=$P(INFUSE,+INFUSE,2),Y=$$TRIM^XLFSTR(Y,"LR"," "),FIELD(24)="^^^^"_Y_"^PSU"
"RTN","PSJHL3",104,0)
 I FIELD(23)="",FIELD(24)="" S FIELD(23)=INFUSE
"RTN","PSJHL3",105,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",106,0)
 K SEGMENT I RXORDER["V" S JJ=0 F  S JJ=$O(@(PSJORDER_"5,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$G(@(PSJORDER_"5,"_JJ_",0)"))
"RTN","PSJHL3",107,0)
 E  S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$G(@(PSJORDER_"12,"_JJ_",0)"))
"RTN","PSJHL3",108,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_SEGMENT(0) D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHL3",109,0)
 I RXORDER["V",$P($G(@(PSJORDER_"3)")),"^")]"" K SEGMENT S SEGMENT(0)="NTE|21|L|"_$P($G(@(PSJORDER_"3)")),"^") D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",110,0)
 I RXORDER["P",$P($G(@(PSJORDER_"9)")),U,2)]"" S SEGMENT(0)="NTE|21|L|"_$P($G(@(PSJORDER_"9)")),U,2) D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",111,0)
 ;
"RTN","PSJHL3",112,0)
RXC ;component segments
"RTN","PSJHL3",113,0)
 N ADDITIVE,SOLUTION,SUB,TYPE,AD,SOL,PTR,NUM
"RTN","PSJHL3",114,0)
 S LIMIT=24 X PSJCLEAR
"RTN","PSJHL3",115,0)
 S FIELD(0)="RXC"
"RTN","PSJHL3",116,0)
 ; In the line below, the naked reference refers to the full global reference represented in PSJORDER_TYPE...
"RTN","PSJHL3",117,0)
 ; This could be a reference to either ^PS(53.1 or ^PS(55
"RTN","PSJHL3",118,0)
 S AD="AD",SOL="SOL" F TYPE="AD","SOL" S SUB=0 F  S SUB=$O(@(PSJORDER_TYPE_","_SUB_")")) Q:SUB=""  S NODE1=$G(^(SUB,0)) Q:NODE1=""  D
"RTN","PSJHL3",119,0)
 .S FIELD(1)=$S(TYPE="AD":"A",1:"B")
"RTN","PSJHL3",120,0)
 .S PTR=+$S(TYPE="AD":+$P($G(^PS(52.6,$P(NODE1,"^"),0)),"^",11),1:+$P($G(^PS(52.7,$P(NODE1,"^"),0)),"^",11))
"RTN","PSJHL3",121,0)
 .S FIELD(2)="^^^"_$S($G(PSJBCBU):+$P(NODE1,"^"),1:PTR)_"^"_$S($G(PSJBCBU):$S(TYPE="AD":$P($G(^PS(52.6,+$P(NODE1,"^"),0)),"^"),1:$P($G(^PS(52.7,+$P(NODE1,"^"),0)),"^")_" "_$P($G(^(0)),U,4)),1:$P($G(^PS(50.7,PTR,0)),"^"))
"RTN","PSJHL3",122,0)
 .S:(TYPE="AD"&$G(PSJBCBU)) FIELD(2)=FIELD(2)_$S($P(NODE1,"^",3)]"":" BOTTLE: "_$P(NODE1,"^",3),1:"")
"RTN","PSJHL3",123,0)
 .S FIELD(2)=FIELD(2)_"^99PSP"
"RTN","PSJHL3",124,0)
 .S FIELD(3)=$P($P(NODE1,"^",2)," ")
"RTN","PSJHL3",125,0)
 .S FIELD(4)=$P($P(NODE1,"^",2)," ",2)
"RTN","PSJHL3",126,0)
 .S NUM=$S(FIELD(4)="":"","ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU"[FIELD(4):$P($T(@(FIELD(4))),";",3),1:"")
"RTN","PSJHL3",127,0)
 .S FIELD(4)="^^^"_NUM_"^"_FIELD(4)_"^99OTH"
"RTN","PSJHL3",128,0)
 .D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",129,0)
 Q
"RTN","PSJHL3",130,0)
 ;
"RTN","PSJHL3",131,0)
RXR ; med route segment
"RTN","PSJHL3",132,0)
 S LIMIT=4 X PSJCLEAR
"RTN","PSJHL3",133,0)
 S FIELD(0)="RXR"
"RTN","PSJHL3",134,0)
 I PSJORDER["IV" S FIELD(1)="^^^"_$P($G(@(PSJORDER_".2)")),"^",3) Q:$P(FIELD(1),U,4)=""  D
"RTN","PSJHL3",135,0)
 .S FIELD(1)=FIELD(1)_"^"_$P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^")_"^99PSR"
"RTN","PSJHL3",136,0)
 .S:$G(PSJBCBU) FIELD(4)="^^^"_$P($G(@(PSJORDER_"0)")),"^",4)_"^"_$$CODES^PSIVUTL($P($G(@(PSJORDER_"0)")),"^",4),55.01,.04)_"^99PSR"
"RTN","PSJHL3",137,0)
 S:FIELD(1)="" FIELD(1)="^^^"_$P(NODE1,"^",3)_"^"_$P($G(^PS(51.2,+$P(NODE1,"^",3),0)),"^")_"^99PSR"
"RTN","PSJHL3",138,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",139,0)
 Q
"RTN","PSJHL3",140,0)
 ;
"RTN","PSJHL3",141,0)
ZRX ; pharmacy Z-segment
"RTN","PSJHL3",142,0)
 S LIMIT=6 X PSJCLEAR
"RTN","PSJHL3",143,0)
 S FIELD(0)="ZRX"
"RTN","PSJHL3",144,0)
 I '$G(PSJREN) N PREON,PSJREN I $G(PSJORD)["U"&($P(NODE1,"^",24)="R") S PSJREN=1
"RTN","PSJHL3",145,0)
 I $G(PSJORD)["V"&($P(NODE2,"^",8)="R") S PSJREN=1
"RTN","PSJHL3",146,0)
 S PREON=$S($G(PSJREN):$G(PSJORD),PSJORDER["IV":$P(NODE2,"^",5),1:$P(NODE1,"^",25))
"RTN","PSJHL3",147,0)
 S FIELD(1)=$S(PREON["P":$P($G(^PS(53.1,+PREON,0)),"^",21),PREON["V":$P($G(^PS(55,PSJHLDFN,"IV",+PREON,0)),"^",21),1:$P($G(^PS(55,PSJHLDFN,5,+PREON,0)),"^",21))
"RTN","PSJHL3",148,0)
 S FIELD(2)=$S(PSJORDER["IV":$G(P("NAT")),1:$G(PSJNOO))
"RTN","PSJHL3",149,0)
 S FIELD(3)=$S($G(PSJREN):"R",PSJORDER["IV":$P(NODE2,"^",8),1:$P(NODE1,"^",24))
"RTN","PSJHL3",150,0)
 I FIELD(3)="" I PSOC="SN" S FIELD(3)="N"
"RTN","PSJHL3",151,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^")
"RTN","PSJHL3",152,0)
 S FIELD(5)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",153,0)
 S FIELD(6)=$S($G(IVTYPE)="F":"IV",$P($G(@(PSJORDER_"0)")),U,4)="H":"TPN",1:"")
"RTN","PSJHL3",154,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",155,0)
 Q
"RTN","PSJHL3",156,0)
 ;
"RTN","PSJHL3",157,0)
CNT ;Count dispense drugs for an order
"RTN","PSJHL3",158,0)
 S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  S CNT=CNT+1
"RTN","PSJHL3",159,0)
 Q
"RTN","PSJHL3",160,0)
ML ;;PSIV-1
"RTN","PSJHL3",161,0)
LITER ;;PSIV-2
"RTN","PSJHL3",162,0)
MCG ;;PSIV-3
"RTN","PSJHL3",163,0)
MG ;;PSIV-4
"RTN","PSJHL3",164,0)
GM ;;PSIV-5
"RTN","PSJHL3",165,0)
UNITS ;;PSIV-6
"RTN","PSJHL3",166,0)
IU ;;PSIV-7
"RTN","PSJHL3",167,0)
MEQ ;;PSIV-8
"RTN","PSJHL3",168,0)
MM ;;PSIV-9
"RTN","PSJHL3",169,0)
MU ;;PSIV-10
"RTN","PSJHL3",170,0)
THOUU ;;PSIV-11
"RTN","PSJHL4")
0^65^B64911264
"RTN","PSJHL4",1,0)
PSJHL4 ;BIR/RLW-DECODE HL7 /MESSSAGE FROM OE/RR ;16 Mar 99 / 4:55 PM
"RTN","PSJHL4",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,12,27,34,40,42,55,47,50,56,58,98,85,105,107,110,111**;16 DEC 97
"RTN","PSJHL4",3,0)
 ;
"RTN","PSJHL4",4,0)
 ; Reference to $$EN^PSOHLNEW is supported by DBIA# 2188.
"RTN","PSJHL4",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL4",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL4",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL4",8,0)
 ;
"RTN","PSJHL4",9,0)
EN(PSJMSG) ; start here
"RTN","PSJHL4",10,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",11,0)
 N ADCNT,SOLCNT,OCCNT
"RTN","PSJHL4",12,0)
 N ACKDATE,ADDITIVE,ADMINSTR,APPL,COMMENT,PSJHLDFN,DISPENSE,DOSE,DURATION,II,INSTR,J,JJ,JJJ,K,LOGIN,NEWORDER,NURSEACK,OBXFL,OCNARR,OCPROV,OCRSN,ORDER,PRIORITY,PSITEM,ORDCON,PROCOM,PSJORDER,PSREASON
"RTN","PSJHL4",13,0)
 N LOC,PROVIDER,PSPR,PSOC,PTR,QQ,REQST,ROUTE,RXON,RXORDER,SCHEDULE,SEGMENT,SOLUTION,STPDT,STRENGTH,TEXT,CLERK,INFRT,IVTYP,SCHTYP,PREON,NOO,ROC,FREQ,CLASS,PSJHLMTN,UNIT,UNITS,QFLG,VOLUME,TVOLUME,PSGP
"RTN","PSJHL4",14,0)
 N PSJASTP,FLDATE,FLCMNT,PSJFLAG,PSJYN,PRNTON,APPT,IVLIMIT
"RTN","PSJHL4",15,0)
 S (ADCNT,SOLCNT,OCCNT,II,TVOLUME)="",(OBXFL,QFLG)=0,PSJHLMTN="ORR" F  S II=$O(PSJMSG(II)) Q:'II  D DECODE Q:QFLG  D @FIELD(0) Q:$G(CLASS)="O"  Q:QFLG
"RTN","PSJHL4",16,0)
 I ($G(CLASS)'="I")!(QFLG) G END
"RTN","PSJHL4",17,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") N DIK,DA S DIK="^PS(53.1,",DA=NEWORDER D EN1^DIK L -^PS(53.1,NEWORDER)
"RTN","PSJHL4",18,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") D EN1^PSJHL2(PSJHLDFN,$S(PSOC="NW":"OK",1:"XR"),NEWORDER_"P")
"RTN","PSJHL4",19,0)
END ;
"RTN","PSJHL4",20,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",21,0)
 I (",S,A,")[(","_$G(PRIORITY)_",")!($G(SCHEDULE)="NOW")!($G(SCHEDULE)["STAT") D
"RTN","PSJHL4",22,0)
 . I $G(PRIORITY)="ZD",$G(PSGORD) D NOTIFY(PSGORD_$S(PSGORD["V":"V",PSGORD["U":"U",1:""),PSJHLDFN,$G(PRIORITY),$G(SCHEDULE))
"RTN","PSJHL4",23,0)
 . I $G(NEWORDER) D NOTIFY(NEWORDER_"P",PSJHLDFN,$G(PRIORITY),$G(SCHEDULE))
"RTN","PSJHL4",24,0)
 Q
"RTN","PSJHL4",25,0)
 ;
"RTN","PSJHL4",26,0)
DECODE ;break segment down into fields 
"RTN","PSJHL4",27,0)
 K FIELD
"RTN","PSJHL4",28,0)
 S SEGMENT=$G(PSJMSG(II))
"RTN","PSJHL4",29,0)
 S J=0
"RTN","PSJHL4",30,0)
 F  Q:$G(SEGMENT)=""  D
"RTN","PSJHL4",31,0)
 .;get fields from segment
"RTN","PSJHL4",32,0)
 .I SEGMENT["|" S FIELD(J)=$P(SEGMENT,"|"),SEGMENT=$E(SEGMENT,$L(FIELD(J))+2,$L(SEGMENT)),J=J+1 Q
"RTN","PSJHL4",33,0)
 .I SEGMENT'["|" S FIELD(J)=SEGMENT,SEGMENT="" Q
"RTN","PSJHL4",34,0)
 Q
"RTN","PSJHL4",35,0)
 ;
"RTN","PSJHL4",36,0)
NOTIFY(ORDER,PSJHLDFN,PRIO,PSJSCHED) ;
"RTN","PSJHL4",37,0)
 N NTFYREAS,WARD,MGROUP,NTFSTAT,DRUG,DRIEN,PNAME,ORDATE,DO,PSG,XMY,VADPT,LASTFOUR
"RTN","PSJHL4",38,0)
 Q:($G(PRIO)=""&($G(PSJSCHED)=""))
"RTN","PSJHL4",39,0)
 S DFN=PSJHLDFN D DEM^VADPT S LASTFOUR=$P($P(VADM(2),"^",2),"-",3)
"RTN","PSJHL4",40,0)
 S NTFYREAS=$S((",S,A,")[(","_PRIO_","):1,($G(PSJSCHED)="NOW"):2,($G(PSJSCHED)="STAT"):3,1:0) Q:'NTFYREAS
"RTN","PSJHL4",41,0)
 S MGROUP="G.PSJ STAT NOW ACTIVE ORDER@"_$G(^XMB("NETNAME")),NTFSTAT="ACTIVE",XMY(MGROUP)=""
"RTN","PSJHL4",42,0)
 I ORDER["P" D PND
"RTN","PSJHL4",43,0)
 I ORDER["U" D UD
"RTN","PSJHL4",44,0)
 I ORDER["V" D IV
"RTN","PSJHL4",45,0)
 S PNAME=$P($G(^DPT(+PSJHLDFN,0)),"^") S:$G(RTE) RTE=$P(^PS(51.2,+RTE,0),"^",3)
"RTN","PSJHL4",46,0)
 S DRUG=$S(DRIEN:$P($G(^PS(50.7,+DRIEN,0)),"^"),1:""),WARD=$G(^DPT(PSJHLDFN,.1))
"RTN","PSJHL4",47,0)
 S XMDUZ="MEDICATIONS,INPATIENT",XMSUB=$G(WARD)
"RTN","PSJHL4",48,0)
 S XMSUB=XMSUB_"-"_NTFSTAT_" "_$S($G(PRIO)="A":"ASAP",$G(PRIO)="S":"STAT",$G(NTFYREAS)=2:"NOW",$G(NTFYREAS)=3:"STAT",1:"")_"-"
"RTN","PSJHL4",49,0)
 S XMSUB=XMSUB_$E(PNAME,1,65-$L(XMSUB))
"RTN","PSJHL4",50,0)
 S XMTEXT="PSG("
"RTN","PSJHL4",51,0)
 S PSG(1,0)="Inpatient Medications has received the following "_$S($G(PRIO)="A":"ASAP",$G(PRIO)="S":"STAT",$G(NTFYREAS)=2:"NOW",1:"")_" order ("_NTFSTAT_")"
"RTN","PSJHL4",52,0)
 S PSG(2,0)=""
"RTN","PSJHL4",53,0)
 S PSG(3,0)="          Patient:     "_PNAME I $G(LASTFOUR) S PSG(3,0)=PSG(3,0)_"  ("_LASTFOUR_")"
"RTN","PSJHL4",54,0)
 S PSG(4,0)="Order Information:     "_DRUG_" "_DO_" "_RTE_" "_$G(PSJSCHED)
"RTN","PSJHL4",55,0)
 S PSG(5,0)="       Order Date:     "_$$ENDTC^PSGMI(ORDATE)
"RTN","PSJHL4",56,0)
 D ^XMD
"RTN","PSJHL4",57,0)
 Q
"RTN","PSJHL4",58,0)
 ;
"RTN","PSJHL4",59,0)
PND ;
"RTN","PSJHL4",60,0)
 Q:'$D(^PS(53.1,+ORDER,0))  N WARD S WARD=$G(^DPT(PSJHLDFN,.1)) I WARD]"" D
"RTN","PSJHL4",61,0)
 .N DIC,X,Y S DIC="^DIC(42,",DIC(0)="BOXZ",X=WARD D ^DIC S WARD=+Y I WARD>0 N WDPARM,MGRP S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) I MGRP D
"RTN","PSJHL4",62,0)
 ..S MGRP=$$GET1^DIQ(3.8,MGRP,.01) I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))=""
"RTN","PSJHL4",63,0)
 I $G(MGROUP)]"" K XMY(MGROUP) S MGROUP="G.PSJ STAT NOW PENDING ORDER@"_$G(^XMB("NETNAME")),NTFSTAT="PENDING",XMY(MGROUP)=""
"RTN","PSJHL4",64,0)
 N NDP2,ND0 S NDP2=$G(^PS(53.1,+ORDER,.2)),ND0=$G(^PS(53.1,+ORDER,0))
"RTN","PSJHL4",65,0)
 S DRIEN=+$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(ND0,"^",3),ORDATE=$P(ND0,"^",14)
"RTN","PSJHL4",66,0)
 S SCHED=$P($G(^PS(53.1,+ORDER,2)),"^")
"RTN","PSJHL4",67,0)
 Q
"RTN","PSJHL4",68,0)
UD ;
"RTN","PSJHL4",69,0)
 Q:'$D(^PS(55,PSJHLDFN,5,+ORDER,0))  N WARD S WARD=$P($G(^(0)),"^",23) I WARD N WDPARM,MGRP S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) I MGRP D
"RTN","PSJHL4",70,0)
 .S MGRP=$P($G(^XMB(3.8,+MGRP,0)),"^") I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))=""
"RTN","PSJHL4",71,0)
 N ND2,ND0 S ND0=$G(^PS(55,PSJHLDFN,5,+ORDER,0)),ND2=$G(^PS(55,PSJHLDFN,5,+ORDER,2)),NDP2=$G(^PS(55,PSJHLDFN,5,+ORDER,.2))
"RTN","PSJHL4",72,0)
 S DRIEN=+$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(ND0,"^",3),ORDATE=$P(ND0,"^",14)
"RTN","PSJHL4",73,0)
 S SCHED=$P(ND2,"^")
"RTN","PSJHL4",74,0)
 Q
"RTN","PSJHL4",75,0)
IV ;
"RTN","PSJHL4",76,0)
 Q:'$D(^PS(55,PSJHLDFN,"IV",+ORDER,0))  N WARD S WARD=$P($G(^(0)),"^",22) I WARD N WDPARM,MGRP S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) I MGRP D
"RTN","PSJHL4",77,0)
 .S MGRP=$P($G(^XMB(3.8,+MGRP,0)),"^") I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))=""
"RTN","PSJHL4",78,0)
 N ND2,NDP2,ND0 S ND0=$G(^PS(55,PSJHLDFN,"IV",+ORDER,0)),ND2=$G(^PS(55,PSJHLDFN,"IV",+ORDER,2))
"RTN","PSJHL4",79,0)
 S NDP2=$G(^PS(55,PSJHLDFN,"IV",+ORDER,.2))
"RTN","PSJHL4",80,0)
 S DRIEN=$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(NDP2,"^",3)
"RTN","PSJHL4",81,0)
 S ORDATE=$P(ND2,"^"),SCHED=$P(ND0,"^",9)
"RTN","PSJHL4",82,0)
 Q
"RTN","PSJHL4",83,0)
MSH ;
"RTN","PSJHL4",84,0)
 S PSOC=FIELD(8)
"RTN","PSJHL4",85,0)
 Q
"RTN","PSJHL4",86,0)
 ;
"RTN","PSJHL4",87,0)
PID ;
"RTN","PSJHL4",88,0)
 S PSJHLDFN=FIELD(3)
"RTN","PSJHL4",89,0)
 Q
"RTN","PSJHL4",90,0)
 ;
"RTN","PSJHL4",91,0)
PV1 ;
"RTN","PSJHL4",92,0)
 N A
"RTN","PSJHL4",93,0)
 S CLASS=FIELD(2),LOC=$P(FIELD(3),"^"),APPT="" I $G(FIELD(44))]"" S APPT=+$$HL7TFM^XLFDT(FIELD(44))
"RTN","PSJHL4",94,0)
 I "IO"'[CLASS S PSREASON="Invalid patient class" Q
"RTN","PSJHL4",95,0)
 ;N II K PSJNVA S II="" F  S II=$O(PSJMSG(II)) Q:'II  D  Q:CLASS="O"
"RTN","PSJHL4",96,0)
 N QQ K PSJNVA S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  D  Q:$G(PSJNVA)
"RTN","PSJHL4",97,0)
 .S X=$G(PSJMSG(QQ))
"RTN","PSJHL4",98,0)
 .I $P(X,"|")="ZRN" S PSJNVA=1,CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",99,0)
 .;I $P(X,"|")="ZRN" S PSJNVA=1 D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",100,0)
 ; OBR check - enable outpatient flagging from backdoor
"RTN","PSJHL4",101,0)
 I $G(PSJNVA) K PSJNVA Q
"RTN","PSJHL4",102,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="OBR" D  Q:$P(PSJMSG(QQ),"|")="OBR"
"RTN","PSJHL4",103,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",104,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="ORC" D  Q:$P(PSJMSG(QQ),"|")="ORC"
"RTN","PSJHL4",105,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",106,0)
 I CLASS="O" N CHK,QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="RXO" D  Q:$P(PSJMSG(QQ),"|")="RXO"
"RTN","PSJHL4",107,0)
 .S CHK=$P(PSJMSG(QQ),"|",2),CHK=$S($P(CHK,"^",5)="IV":"IV",1:$P(CHK,"^",4))
"RTN","PSJHL4",108,0)
 .I CHK="IV" S CLASS="I" Q
"RTN","PSJHL4",109,0)
 .I 'CHK S PSREASON="Missing or Invalid Orderable Item",CLASS="I" Q
"RTN","PSJHL4",110,0)
 .I $P($G(^PS(50.7,CHK,0)),"^",3)=1 S CLASS="I" Q
"RTN","PSJHL4",111,0)
 D:CLASS="O" EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",112,0)
 Q
"RTN","PSJHL4",113,0)
 ;
"RTN","PSJHL4",114,0)
ORC ;
"RTN","PSJHL4",115,0)
 S PSOC=FIELD(1)
"RTN","PSJHL4",116,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",117,0)
 I $G(PSREASON)]"" D ERROR^PSJHL9 Q
"RTN","PSJHL4",118,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",119,0)
 I PSOC="NA" D ASSIGN^PSJHL5 Q
"RTN","PSJHL4",120,0)
 S CLERK=+$G(FIELD(10))
"RTN","PSJHL4",121,0)
 S PROVIDER=+$G(FIELD(12)) D:PSOC="NW"
"RTN","PSJHL4",122,0)
 .I PROVIDER=0 S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q 
"RTN","PSJHL4",123,0)
 .I PROVIDER>0 S PSPR=$G(^VA(200,+PROVIDER,"PS")) I '$D(PSPR)!'(PSPR)!$S($P(PSPR,"^",4)="":0,1:$P(PSPR,"^",4)'>DT) S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q
"RTN","PSJHL4",124,0)
 S UNITS=$P(FIELD(7),"^"),INSTR=$P(FIELD(7),"^",8)
"RTN","PSJHL4",125,0)
 S:UNITS["&" DOSE=$P(UNITS,"&"),UNIT=$P(UNITS,"&",2),UNITS=$P(UNITS,"&",3)
"RTN","PSJHL4",126,0)
 S SCHEDULE=$P(FIELD(7),"^",2),PRIORITY=$P(FIELD(7),"^",6) S:SCHEDULE["PRN" SCHTYP="P"
"RTN","PSJHL4",127,0)
 S DURATION=$P(FIELD(7),"^",3),REQST=$P(FIELD(7),"^",4) S:REQST'="" REQST=+$E(+$$HL7TFM^XLFDT(REQST),1,12) S REQST=$$DATE2^PSJUTL2(REQST)
"RTN","PSJHL4",128,0)
 S PRIORITY=$S($G(PRIORITY)]"":PRIORITY,1:"R")
"RTN","PSJHL4",129,0)
 I $E(SCHEDULE,1)=" " S:$TR(SCHEDULE," ")="PRN" SCHEDULE="PRN" I '(SCHEDULE="PRN")  S PSREASON="Invalid Schedule" D ERROR^PSJHL9 Q
"RTN","PSJHL4",130,0)
 S PRNTON=$P(FIELD(8),"^")
"RTN","PSJHL4",131,0)
 S NURSEACK=$G(FIELD(11))
"RTN","PSJHL4",132,0)
 S LOGIN=$G(FIELD(15)) S:LOGIN'="" LOGIN=+$E(+$$HL7TFM^XLFDT(FIELD(15)),1,12) S LOGIN=$$DATE2^PSJUTL2(LOGIN)
"RTN","PSJHL4",133,0)
 S:$G(NURSEACK)]"" ACKDATE=LOGIN
"RTN","PSJHL4",134,0)
 S ORDCON=$P($G(FIELD(16)),U) I ORDCON="A" S PSJASTP=$G(FIELD(9)) S:$G(PSJASTP)'="" PSJASTP=+$E(+$$HL7TFM^XLFDT(PSJASTP),1,12) S PSJASTP=$$DATE2^PSJUTL2(PSJASTP)
"RTN","PSJHL4",135,0)
 I (PSOC="CA")!(PSOC="DC") D CANCEL^PSJHL6 Q
"RTN","PSJHL4",136,0)
 I PSOC="HD" D HOLD^PSJHL6 Q
"RTN","PSJHL4",137,0)
 I PSOC="RL" D UNHOLD^PSJHL6 Q
"RTN","PSJHL4",138,0)
 I PSOC="ZV" D NURSEACK^PSJHL5 Q
"RTN","PSJHL4",139,0)
 I PSOC="SS" D STATUS^PSJHL5 Q
"RTN","PSJHL4",140,0)
 I PSOC="Z@" N X S X="PSJHL8" X ^%ZOSF("TEST") I  D PURGE^PSJHL8 Q
"RTN","PSJHL4",141,0)
 I PSOC="DE" S QFLG=1 Q
"RTN","PSJHL4",142,0)
 Q
"RTN","PSJHL4",143,0)
OBR ; This segment is used to pass flagging information from CPRS.
"RTN","PSJHL4",144,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",145,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",146,0)
 S PSJFLAG=FIELD(4)
"RTN","PSJHL4",147,0)
 S FLDATE=$G(FIELD(7)) S:FLDATE'="" FLDATE=+$E(+$$HL7TFM^XLFDT(FIELD(7)),1,12) S FLDATE=$$DATE2^PSJUTL2(FLDATE)
"RTN","PSJHL4",148,0)
 S CLERK=+$G(FIELD(16))
"RTN","PSJHL4",149,0)
 S PSJYN=$G(FIELD(24))
"RTN","PSJHL4",150,0)
 S FLCMNT=$G(FIELD(13))
"RTN","PSJHL4",151,0)
 I PSOC="ORU" D FLAG^PSJHL5
"RTN","PSJHL4",152,0)
 Q
"RTN","PSJHL4",153,0)
RXC ; IV order
"RTN","PSJHL4",154,0)
 D RXC^PSJHL4A
"RTN","PSJHL4",155,0)
 Q
"RTN","PSJHL4",156,0)
 ;
"RTN","PSJHL4",157,0)
RXO ;
"RTN","PSJHL4",158,0)
 D RXO^PSJHL4A
"RTN","PSJHL4",159,0)
 Q
"RTN","PSJHL4",160,0)
 ;
"RTN","PSJHL4",161,0)
RXR ;
"RTN","PSJHL4",162,0)
 S ROUTE=$P(FIELD(1),"^",4)
"RTN","PSJHL4",163,0)
 Q
"RTN","PSJHL4",164,0)
 ;
"RTN","PSJHL4",165,0)
OBX ;
"RTN","PSJHL4",166,0)
 D OBX^PSJHL4A
"RTN","PSJHL4",167,0)
 Q
"RTN","PSJHL4",168,0)
 ;
"RTN","PSJHL4",169,0)
NTE ;
"RTN","PSJHL4",170,0)
 D NTE^PSJHL4A
"RTN","PSJHL4",171,0)
 Q
"RTN","PSJHL4",172,0)
 ;
"RTN","PSJHL4",173,0)
ZRX ;
"RTN","PSJHL4",174,0)
 D ZRX^PSJHL4A
"RTN","PSJHL4",175,0)
 Q
"RTN","PSJHL4",176,0)
 ;
"RTN","PSJHL4",177,0)
ZSC ;Service Connected - Not Used by Inpatient
"RTN","PSJHL4",178,0)
 Q
"RTN","PSJHL4",179,0)
 ;
"RTN","PSJHL4",180,0)
ZRN ;Non-VA Med (Herbal/OTC)
"RTN","PSJHL4",181,0)
 S CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",182,0)
 Q
"RTN","PSJHL4",183,0)
DG1 ;Billing Awareness - Not used by Inpatient
"RTN","PSJHL4",184,0)
 Q
"RTN","PSJHL4A")
0^66^B30067390
"RTN","PSJHL4A",1,0)
PSJHL4A ;BIR/RLW-CONTINUE DECODE HL7 /MESSSAGE FROM OE/RR ;16 Mar 99 / 4:55 PM
"RTN","PSJHL4A",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**105,111**;16 DEC 97
"RTN","PSJHL4A",3,0)
 ;
"RTN","PSJHL4A",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL4A",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL4A",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL4A",7,0)
 ;
"RTN","PSJHL4A",8,0)
RXC ; IV order
"RTN","PSJHL4A",9,0)
 S APPL=FIELD(1)
"RTN","PSJHL4A",10,0)
 I APPL["B" S SOLCNT=SOLCNT+1,PTR=$P(FIELD(2),"^",4) Q:'PTR  S VOLUME=+FIELD(3)_" ML" D  I '$D(^TMP("PSJNVO",$J,"SOL",SOLCNT,0)) D SOLSRCH
"RTN","PSJHL4A",11,0)
 .S SOLUTION="" F  S SOLUTION=$O(^PS(52.7,"AOI",PTR,SOLUTION)) Q:'SOLUTION  S INACT=$G(^PS(52.7,SOLUTION,"I")) I 'INACT!(INACT>DT) I VOLUME=$P(^PS(52.7,SOLUTION,0),U,3) D
"RTN","PSJHL4A",12,0)
 ..S ^TMP("PSJNVO",$J,"SOL",0)=SOLCNT
"RTN","PSJHL4A",13,0)
 ..S ^TMP("PSJNVO",$J,"SOL",SOLCNT,0)=SOLUTION_"^"_VOLUME,TVOLUME=TVOLUME+(+VOLUME)
"RTN","PSJHL4A",14,0)
 I $G(INFRT)]"" S X=INFRT D ENI^PSJHLU S INFRT=$G(X)
"RTN","PSJHL4A",15,0)
 I APPL="A" S ADCNT=ADCNT+1,PTR=$P(FIELD(2),"^",4) Q:'PTR  S STRENGTH=$G(FIELD(3))_" "_$P($G(FIELD(4)),"^",5) D  I '$D(^TMP("PSJNVO",$J,"AD",ADCNT,0)) S PSREASON="Can't find matching additive" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",16,0)
 .S ADDITIVE="" F  S ADDITIVE=$O(^PS(52.6,"AOI",PTR,ADDITIVE)) Q:'ADDITIVE  S INACT=$G(^PS(52.6,ADDITIVE,"I")) I 'INACT!(INACT>DT)  Q:$G(^PS(52.6,ADDITIVE,0))']""  D  Q:ADDITIVE
"RTN","PSJHL4A",17,0)
 ..I $G(PSITEM)="" S PSITEM=PTR
"RTN","PSJHL4A",18,0)
 ..S ^TMP("PSJNVO",$J,"AD",0)=ADCNT
"RTN","PSJHL4A",19,0)
 ..S ^TMP("PSJNVO",$J,"AD",ADCNT,0)=ADDITIVE_"^"_STRENGTH
"RTN","PSJHL4A",20,0)
 Q
"RTN","PSJHL4A",21,0)
 ;
"RTN","PSJHL4A",22,0)
RXO ;
"RTN","PSJHL4A",23,0)
 I $O(PSJMSG(II,0)) D
"RTN","PSJHL4A",24,0)
 .K SEGMENT
"RTN","PSJHL4A",25,0)
 .N KK,JJ,XX
"RTN","PSJHL4A",26,0)
 .S SEGMENT(1)=$G(PSJMSG(II))
"RTN","PSJHL4A",27,0)
 .S KK=1,JJ="" F  S JJ=$O(PSJMSG(II,JJ)) Q:'JJ  S KK=KK+1,SEGMENT(KK)=$G(PSJMSG(II,JJ))
"RTN","PSJHL4A",28,0)
 .S KK=1,JJ=0
"RTN","PSJHL4A",29,0)
 .F  Q:'$D(SEGMENT(KK))  D
"RTN","PSJHL4A",30,0)
 ..I SEGMENT(KK)["|" S FIELD(JJ)=$P(SEGMENT(KK),"|"),SEGMENT(KK)=$E(SEGMENT(KK),$L(FIELD(JJ))+2,$L(SEGMENT(KK))),JJ=JJ+1 Q
"RTN","PSJHL4A",31,0)
 ..I SEGMENT(KK)'["|" S FIELD(JJ)=SEGMENT(KK),KK=KK+1 Q:'$D(SEGMENT(KK))  D
"RTN","PSJHL4A",32,0)
 ...S XX=$P(SEGMENT(KK),"|"),SEGMENT(KK)=$E(SEGMENT(KK),$L(X)+2,$L(SEGMENT(KK))),FIELD(JJ)=FIELD(JJ)_XX,JJ=JJ+1
"RTN","PSJHL4A",33,0)
 S APPL="",PSITEM=$S($P(FIELD(1),"^",5)="IV":"",1:$P(FIELD(1),"^",4))
"RTN","PSJHL4A",34,0)
 S:$P(FIELD(1),"^",6)="ORD" PSITEM=""
"RTN","PSJHL4A",35,0)
 S:$P(FIELD(1),"^",5)="IV" IVTYP="A",SCHTYP="C",INFRT=$G(FIELD(2))
"RTN","PSJHL4A",36,0)
 S DISPENSE=$P($G(FIELD(10)),"^",4)
"RTN","PSJHL4A",37,0)
 S IVLIMIT=$P($G(PSJMSG(II)),"^",3)
"RTN","PSJHL4A",38,0)
 Q
"RTN","PSJHL4A",39,0)
 ;
"RTN","PSJHL4A",40,0)
OBX ;
"RTN","PSJHL4A",41,0)
 S OBXFL=1,OCNARR=FIELD(5),OCPROV=CLERK,OCCNT=OCCNT+1
"RTN","PSJHL4A",42,0)
 S ^TMP("PSJNVO",$J,10,0)=OCCNT
"RTN","PSJHL4A",43,0)
 S ^TMP("PSJNVO",$J,10,OCCNT,0)=OCNARR
"RTN","PSJHL4A",44,0)
 S ^TMP("PSJNVO",$J,10,OCCNT,1)=$P($G(^VA(200,+OCPROV,0)),"^")
"RTN","PSJHL4A",45,0)
 Q
"RTN","PSJHL4A",46,0)
 ;
"RTN","PSJHL4A",47,0)
NTE ;
"RTN","PSJHL4A",48,0)
 S TEXT=$S((FIELD(1)=6)&('OBXFL):"PROCOM",(FIELD(1)=7)&('OBXFL):"ADMINSTR",1:"OCRSN")
"RTN","PSJHL4A",49,0)
 S @TEXT@(1)=$G(FIELD(3))
"RTN","PSJHL4A",50,0)
 S K=1,J="" F  S J=$O(PSJMSG(II,J)) Q:'J  S K=K+1,@TEXT@(K)=$G(PSJMSG(II,J))
"RTN","PSJHL4A",51,0)
 D:$D(OCRSN)
"RTN","PSJHL4A",52,0)
 .S QQ=0 F  S QQ=$O(OCRSN(QQ)) Q:'QQ  S ^TMP("PSJNVO",$J,10,OCCNT,2,QQ,0)=OCRSN(QQ)
"RTN","PSJHL4A",53,0)
 S OBXFL=0
"RTN","PSJHL4A",54,0)
 Q
"RTN","PSJHL4A",55,0)
 ;
"RTN","PSJHL4A",56,0)
ZRX ;
"RTN","PSJHL4A",57,0)
 N ND,ND2,CHK,FOLOR,STDT
"RTN","PSJHL4A",58,0)
 S PREON=$G(FIELD(1)),ROC=$G(FIELD(3))
"RTN","PSJHL4A",59,0)
 S ND=$S((PREON["N")!(PREON["P"):$G(^PS(53.1,+PREON,0)),PREON["V":$G(^PS(55,PSJHLDFN,"IV",+PREON,0)),1:$G(^PS(55,PSJHLDFN,5,+PREON,0)))
"RTN","PSJHL4A",60,0)
 S ND2=$S((PREON["N")!(PREON["P"):$G(^PS(53.1,+PREON,2)),PREON["V":$G(^PS(55,PSJHLDFN,"IV",+PREON,2)),1:$G(^PS(55,PSJHLDFN,5,+PREON,2)))
"RTN","PSJHL4A",61,0)
 I 'ND I ROC'="N" S PSREASON="Invalid Pharmacy order number" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",62,0)
 I ND I ROC="R" S FOLOR=$S(PREON["V":$P(ND2,U,6),1:$P(ND,U,26)) I FOLOR S PSREASON="Duplicate Renewal Request" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",63,0)
 I ND I ROC="R" S CHK=$S(PREON["V":$P(ND,U,17),1:$P(ND,U,9)) I "AE"'[CHK S PSREASON="Pharmacy orders with a status of "_CHK_" may not be renewed" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",64,0)
 I $G(CHK)="E" I PREON'["V" D NOW^%DTC S X1=+$E(%,1,12),X2=-4 D C^%DTC S STDT=$S(PREON["V":$P(ND,U,3),1:$P(ND2,U,4)) I STDT'>X S PSREASON="Pharmacy orders expired longer than 4 days may not be renewed" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",65,0)
 I ND I ROC="E" S FOLOR=$S(PREON["V":$P(ND2,U,6),1:$P(ND,U,26)) I FOLOR S PSREASON="Pharmacy orders may only be edited ONCE" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",66,0)
 I ND I ROC="E" S CHK=$S(PREON["V":$P(ND,U,17),1:$P(ND,U,9)) I "DEHO"[CHK N CHKRTN S CHKRTN=CHK_"^PSJHL6" D @CHKRTN S PSREASON=PSREASON_" orders may not be edited" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",67,0)
 D:ROC'="R" VALID^PSJHL9 Q:QFLG
"RTN","PSJHL4A",68,0)
 I $G(PSITEM)="",$D(^TMP("PSJNVO",$J,"SOL",1,0)) S PSITEM=$P($G(^PS(52.7,+^TMP("PSJNVO",$J,"SOL",1,0),0)),"^",11)
"RTN","PSJHL4A",69,0)
 I PRIORITY="ZD" D VALID^PSJHL10 S QFLG=1 Q
"RTN","PSJHL4A",70,0)
 I (PREON]"")&(ROC="E") D EDITCK^PSJHL5 Q:QFLG
"RTN","PSJHL4A",71,0)
 D NVO^PSJHL9
"RTN","PSJHL4A",72,0)
 I (PREON]"")&(ROC="R") D RENEW^PSJHL7 Q
"RTN","PSJHL4A",73,0)
 I (PREON]"")&(ROC="E") D EDIT^PSJHL5
"RTN","PSJHL4A",74,0)
 Q
"RTN","PSJHL4A",75,0)
 ;
"RTN","PSJHL4A",76,0)
SOLSRCH ;Find solution
"RTN","PSJHL4A",77,0)
 N SSSS,SEG,ON,ROC,SOL,SOL2
"RTN","PSJHL4A",78,0)
 F SSSS=II:0 S SSSS=$O(PSJMSG(SSSS)) Q:'SSSS  I $P(PSJMSG(SSSS),"|")="ZRX" D  Q
"RTN","PSJHL4A",79,0)
 .S SEG=$G(PSJMSG(SSSS)),ON=$P(SEG,"|",2),ROC=$P(SEG,"|",4)
"RTN","PSJHL4A",80,0)
 I $G(ROC)'="N" F SOL=0:0 S SOL=$O(^PS(55,PSJHLDFN,"IV",+ON,"SOL",SOL)) Q:'SOL  S SOL2=$G(^PS(55,PSJHLDFN,"IV",+ON,"SOL",SOL,0)) I $D(^PS(52.7,"AOI",PTR,+SOL2))&($P(SOL2,U,2)=VOLUME) S SOLUTION=+SOL2 D SET Q
"RTN","PSJHL4A",81,0)
 I 'SOLUTION S SOLUTION=$O(^PS(52.7,"AOI",PTR,SOLUTION)) D SET
"RTN","PSJHL4A",82,0)
 Q
"RTN","PSJHL4A",83,0)
SET ;Set solution tmp nodes
"RTN","PSJHL4A",84,0)
 Q:'+SOLUTION
"RTN","PSJHL4A",85,0)
 S ^TMP("PSJNVO",$J,"SOL",0)=SOLCNT
"RTN","PSJHL4A",86,0)
 S ^TMP("PSJNVO",$J,"SOL",SOLCNT,0)=SOLUTION_"^"_VOLUME,TVOLUME=TVOLUME+(+VOLUME)
"RTN","PSJHL9")
0^67^B51714224
"RTN","PSJHL9",1,0)
PSJHL9 ;BIR/LDT-VALIDATE INCOMING HL7 DATA/CREATE NEW ORDER ;08 Jul 99 / 10:50 AM
"RTN","PSJHL9",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,18,31,42,47,50,63,72,75,58,80,110,111**;16 DEC 97
"RTN","PSJHL9",3,0)
 ;
"RTN","PSJHL9",4,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJHL9",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL9",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL9",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL9",8,0)
 ; Reference to ^ORERR is supported by DBIA# 2187.
"RTN","PSJHL9",9,0)
 ;
"RTN","PSJHL9",10,0)
VALID ;
"RTN","PSJHL9",11,0)
 I APPL="",PSITEM="" S PSREASON="Missing or invalid Orderable Item" D ERROR Q
"RTN","PSJHL9",12,0)
 I PSITEM]"",'$D(^PS(50.7,+PSITEM,0)) S PSREASON="Missing or invalid Orderable Item" D ERROR Q
"RTN","PSJHL9",13,0)
 I $G(APPL)'["B",$G(APPL)'["A",+$G(ROUTE)'>0 S PSREASON="Missing or invalid Med Route" D ERROR Q
"RTN","PSJHL9",14,0)
 S APPL=$S($G(APPL)["B":"F",$G(APPL)["A":"F",$G(DISPENSE)]"":$$ORTYP(ROUTE,DISPENSE),1:$$TRYAGAIN(ROUTE,PSITEM))
"RTN","PSJHL9",15,0)
 S:APPL="" APPL="IP"
"RTN","PSJHL9",16,0)
 I APPL'="F" D
"RTN","PSJHL9",17,0)
 .I $G(SCHEDULE)]"" N X S X=SCHEDULE D  S SCHEDULE=X
"RTN","PSJHL9",18,0)
 ..I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>3)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N") S X="" Q
"RTN","PSJHL9",19,0)
 ..I X?.E1L.E S X=$$ENLU^PSGMI(X)
"RTN","PSJHL9",20,0)
 ..S X=$$TRIM^XLFSTR(X,"R"," ")
"RTN","PSJHL9",21,0)
 ..I X["Q0" S X="" Q
"RTN","PSJHL9",22,0)
 .I APPL["U",$G(SCHEDULE)="" S PSREASON="Missing or invalid schedule" D ERROR Q
"RTN","PSJHL9",23,0)
 .N DFN S DFN=PSJHLDFN D IN5^VADPT I 'VAIP(5) D:APPT=""  I APPL="UN",APPT="" S PSREASON="Cannot place Unit Dose orders for an Outpatient" D ERROR Q
"RTN","PSJHL9",24,0)
 .. I APPL="UP" S APPL="IN" Q
"RTN","PSJHL9",25,0)
 .. I APPL="IP" S APPL="IN" Q
"RTN","PSJHL9",26,0)
 .I $G(ROC)'="R",$G(ROUTE)'>0 S PSREASON="Missing or invalid Med Route" D ERROR Q
"RTN","PSJHL9",27,0)
 I APPL="F" D
"RTN","PSJHL9",28,0)
 .I '$O(^TMP("PSJNVO",$J,"SOL",0))&('$O(^TMP("PSJNVO",$J,"AD",0))) S PSREASON="IV Fluid orders must have at least one additive or solution" D ERROR Q
"RTN","PSJHL9",29,0)
 .I $G(INFRT)="" S PSREASON="Invalid Infusion Rate" D ERROR Q
"RTN","PSJHL9",30,0)
 Q
"RTN","PSJHL9",31,0)
 ;
"RTN","PSJHL9",32,0)
ERROR ;Sends error msg to CPRS, logs error in OE/RR Errors file
"RTN","PSJHL9",33,0)
 S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(PSREASON,.PSJMSG)
"RTN","PSJHL9",34,0)
 D EN1^PSJHLERR(PSJHLDFN,$S(PSOC="XO":"UX",1:"OC"),$P(ORDER,U),PSREASON) S QFLG=1 K ^TMP("PSJNVO",$J)
"RTN","PSJHL9",35,0)
 Q
"RTN","PSJHL9",36,0)
 ;
"RTN","PSJHL9",37,0)
NVO ; put new orders in non-verified orders file
"RTN","PSJHL9",38,0)
 I '$D(ROUTE) S ROUTE=""
"RTN","PSJHL9",39,0)
 S:APPL="F" ROUTE=$O(^PS(51.2,"B","INTRAVENOUS",0))
"RTN","PSJHL9",40,0)
 N DA,DR,DIE D ENGNN^PSGOETO S DIE="^PS(53.1,"
"RTN","PSJHL9",41,0)
 S DR="1////"_PROVIDER_";3////"_ROUTE_";4////"_$E(APPL)_";28////P"_";108////"_PSITEM_";27.1////"_LOGIN_";27////"_LOGIN_";.5////"_PSJHLDFN_";.24////"_PRIORITY_";125////"_$G(PRNTON)
"RTN","PSJHL9",42,0)
 I $G(LOC)]"" S:$P($G(^SC(+LOC,0)),U,3)="C" DR=DR_";113////"_LOC_";126////"_$G(APPT)
"RTN","PSJHL9",43,0)
 D ^DIE K PSJHLSKP S NEWORDER=DA,PSJORDER=DA_"P"
"RTN","PSJHL9",44,0)
 S $P(^PS(55,PSJHLDFN,5.1),"^",2)=PROVIDER
"RTN","PSJHL9",45,0)
 S:$G(ORDER)]"" $P(^PS(53.1,DA,0),"^",21)=$P(ORDER,"^")
"RTN","PSJHL9",46,0)
 S:$G(APPL)["P" $P(^PS(53.1,DA,0),"^",13)=1
"RTN","PSJHL9",47,0)
 S $P(^PS(53.1,DA,0),"^",18)=DA
"RTN","PSJHL9",48,0)
 S:$G(ROC)]"" $P(^PS(53.1,DA,0),"^",24)=ROC
"RTN","PSJHL9",49,0)
 S:$G(PREON)]"" $P(^PS(53.1,DA,0),"^",25)=PREON
"RTN","PSJHL9",50,0)
 S:$G(REQST)]"" $P(^PS(53.1,DA,2.5),"^")=REQST
"RTN","PSJHL9",51,0)
 S:$G(DURATION)]"" $P(^PS(53.1,DA,2.5),"^",2)=DURATION
"RTN","PSJHL9",52,0)
 S:$G(IVLIMIT)]"" $P(^PS(53.1,DA,2.5),"^",4)=IVLIMIT
"RTN","PSJHL9",53,0)
 I $G(REQST)]"",$G(DURATION)]"" S $P(^PS(53.1,DA,2.5),"^",3)=$$STOP(REQST,DURATION)
"RTN","PSJHL9",54,0)
 S:$G(INSTR)]"" $P(^PS(53.1,DA,.3),"^")=INSTR
"RTN","PSJHL9",55,0)
 S:$G(INFRT)]"" ^PS(53.1,DA,8)=IVTYP_"^^^^"_INFRT
"RTN","PSJHL9",56,0)
 S:$G(FREQ)]"" $P(^PS(53.1,DA,2),"^",6)=FREQ
"RTN","PSJHL9",57,0)
 S:$G(SCHTYP)]"" $P(^PS(53.1,DA,0),"^",7)=SCHTYP
"RTN","PSJHL9",58,0)
 I $G(APPL)'="I" I $G(INSTR)]"" N X S X=INSTR D STRIP I $S(X?.E1C.E:0,$L(X)>60:0,X="":0,X["^":0,X?1.P:1,1:1) S $P(^PS(53.1,DA,.2),"^",2)=X,$P(^PS(53.1,DA,.2),"^",5,6)=$G(DOSE)_"^"_$G(UNIT)
"RTN","PSJHL9",59,0)
 S $P(^PS(53.1,DA,.2),"^",3)=ORDCON
"RTN","PSJHL9",60,0)
 I $G(SCHEDULE)]"" S ^PS(53.1,DA,2)=SCHEDULE
"RTN","PSJHL9",61,0)
 I $G(APPL)="I" I $G(UNITS)]"" S $P(^PS(53.1,DA,.3),"^")=UNITS
"RTN","PSJHL9",62,0)
 S ^PS(53.1,DA,4)="^^^^^^"_CLERK
"RTN","PSJHL9",63,0)
 I $G(DISPENSE) S ^PS(53.1,DA,1,0)="^53.11P^1^1",^PS(53.1,DA,1,1,0)=DISPENSE_"^"_UNITS,^PS(53.1,DA,1,"B",$E(DISPENSE,1,30),1)=""
"RTN","PSJHL9",64,0)
 I $D(PROCOM) D
"RTN","PSJHL9",65,0)
 .I '$D(^PS(53.1,DA,12,0)) S ^(0)="^53.1012^0^0"
"RTN","PSJHL9",66,0)
 .S JJ=0 F  S JJ=$O(PROCOM(JJ)) Q:'JJ  S $P(^PS(53.1,DA,12,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,12,JJ,0)=PROCOM(JJ)
"RTN","PSJHL9",67,0)
 I $D(ADMINSTR) D
"RTN","PSJHL9",68,0)
 .I '$D(^PS(53.1,DA,3,0)) S ^(0)="^53.12^0^0"
"RTN","PSJHL9",69,0)
 .S JJ=0 F  S JJ=$O(ADMINSTR(JJ)) Q:'JJ  S $P(^PS(53.1,DA,3,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,3,JJ,0)=ADMINSTR(JJ)
"RTN","PSJHL9",70,0)
 I $D(^TMP("PSJNVO",$J,"AD")) D
"RTN","PSJHL9",71,0)
 .S ^PS(53.1,DA,"AD",0)="^53.157PA^0^0"
"RTN","PSJHL9",72,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,"AD",JJ)) Q:'JJ  S $P(^PS(53.1,DA,"AD",0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,"AD",JJ,0)=^TMP("PSJNVO",$J,"AD",JJ,0),^PS(53.1,DA,"AD","B",$P(^TMP("PSJNVO",$J,"AD",JJ,0),"^"),JJ)=""
"RTN","PSJHL9",73,0)
 I $D(^TMP("PSJNVO",$J,"SOL")) D
"RTN","PSJHL9",74,0)
 .S ^PS(53.1,DA,"SOL",0)="^53.158PA^0^0"
"RTN","PSJHL9",75,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,"SOL",JJ)) Q:'JJ  S $P(^PS(53.1,DA,"SOL",0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,"SOL",JJ,0)=^TMP("PSJNVO",$J,"SOL",JJ,0),^PS(53.1,DA,"SOL","B",$P(^TMP("PSJNVO",$J,"SOL",JJ,0),"^"),JJ)=""
"RTN","PSJHL9",76,0)
 I $O(^TMP("PSJNVO",$J,10,0)) D
"RTN","PSJHL9",77,0)
 .S ^PS(53.1,DA,10,0)="^53.1112A^0^0"
"RTN","PSJHL9",78,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,10,JJ)) Q:'JJ  S $P(^PS(53.1,DA,10,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,10,JJ,0)=^TMP("PSJNVO",$J,10,JJ,0),^PS(53.1,DA,10,"B",$E(^TMP("PSJNVO",$J,10,JJ,0),1,30),JJ)="" D
"RTN","PSJHL9",79,0)
 ..S ^PS(53.1,DA,10,JJ,1)=$P($G(^VA(200,+CLERK,0)),"^")
"RTN","PSJHL9",80,0)
 ..I $O(^TMP("PSJNVO",$J,10,JJ,2,0)) S ^PS(53.1,DA,10,JJ,2,0)="^53.11122^0^0" D
"RTN","PSJHL9",81,0)
 ...S QQ=0 F  S QQ=$O(^TMP("PSJNVO",$J,10,JJ,2,QQ)) Q:'QQ  S $P(^PS(53.1,DA,10,JJ,2,0),"^",3,4)=QQ_"^"_QQ,^PS(53.1,DA,10,JJ,2,QQ,0)=^TMP("PSJNVO",$J,10,JJ,2,QQ,0)
"RTN","PSJHL9",82,0)
 Q
"RTN","PSJHL9",83,0)
STRIP ;Strips spaces off the end of instructions.
"RTN","PSJHL9",84,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSJHL9",85,0)
 Q
"RTN","PSJHL9",86,0)
 ;
"RTN","PSJHL9",87,0)
ORTYP(MDRT,DDRG)        ;Entry point to determine order type for 53.1
"RTN","PSJHL9",88,0)
 ;MDRT=Med Route from 51.2, DDRG=Dispense Drug
"RTN","PSJHL9",89,0)
 I $P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PSDRUG(DDRG,2),"^",3)'["U" S ORTYP="" Q ORTYP
"RTN","PSJHL9",90,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PSDRUG(DDRG,2),"^",3)'["U",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="IN" Q ORTYP
"RTN","PSJHL9",91,0)
 I $P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="UP" Q ORTYP
"RTN","PSJHL9",92,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="IP" Q ORTYP
"RTN","PSJHL9",93,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PSDRUG(DDRG,2),"^",3)'["U",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="IP" Q ORTYP
"RTN","PSJHL9",94,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["U",$P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="UN" Q ORTYP
"RTN","PSJHL9",95,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["U",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="UP" Q ORTYP
"RTN","PSJHL9",96,0)
 S ORTYP="" Q ORTYP
"RTN","PSJHL9",97,0)
 ;
"RTN","PSJHL9",98,0)
TRYAGAIN(MDRT,OI)       ;
"RTN","PSJHL9",99,0)
 ;MDRT=Med Route from 51.2, OI=Orderable Item
"RTN","PSJHL9",100,0)
 N ORTYPI,ORTYPU,ORTYPP
"RTN","PSJHL9",101,0)
 S ORTYP="",ORTYPI=0,ORTYPU=0,ORTYPP=0
"RTN","PSJHL9",102,0)
 N DDRG S DDRG=0 F  S DDRG=$O(^PSDRUG("ASP",OI,DDRG)) Q:'DDRG  D 
"RTN","PSJHL9",103,0)
 .I $G(^PSDRUG(DDRG,"I"))]"" Q:^PSDRUG(DDRG,"I")'>DT
"RTN","PSJHL9",104,0)
 .S ORTYP=$$ORTYP(MDRT,DDRG)  D
"RTN","PSJHL9",105,0)
 ..I ORTYP["I" S ORTYPI=ORTYPI+1
"RTN","PSJHL9",106,0)
 ..I ORTYP["U" S ORTYPU=ORTYPU+1
"RTN","PSJHL9",107,0)
 ..I ORTYP["P" S ORTYPP=ORTYPP+1
"RTN","PSJHL9",108,0)
 S ORTYP=$S(ORTYPU>ORTYPI:"U",1:"I") S ORTYP=ORTYP_$S(ORTYPP>0:"P",1:"N")
"RTN","PSJHL9",109,0)
 Q ORTYP
"RTN","PSJHL9",110,0)
 ;
"RTN","PSJHL9",111,0)
STOP(REQST,DURA)   ;
"RTN","PSJHL9",112,0)
 ;REQST=Requested start date, DURA=Duration from CPRS
"RTN","PSJHL9",113,0)
 I DURA["L",DURA?1A1".".N S DAYS=$$DAY($E(REQST,1,5)),DURA="H"_((DAYS*$P(DURA,"L",2))*24)
"RTN","PSJHL9",114,0)
 I DURA["L",DURA?1A.1N.N1"."1N.N D  Q STOP
"RTN","PSJHL9",115,0)
 .S NUM=$E(REQST,4,5)+$P($P(DURA,"."),"L",2),NUM=$S(NUM<10:"0"_NUM,NUM<13:NUM,1:$S((NUM-12)<10:"0"_(NUM-12),1:(NUM-12))),DATE=$E(REQST,1,3)_NUM
"RTN","PSJHL9",116,0)
 .S DAYS=$$DAY(DATE),STOP=$$SCH^XLFDT($P($P(DURA,"."),"L",2)_"M",$P(REQST,"."))_"."_$P(REQST,".",2),DEL=$P($P(DURA,"L",2),"."),STOP=$$FMADD^XLFDT(STOP,"",((DAYS*$P(DURA,DEL,2))*24))
"RTN","PSJHL9",117,0)
 I DURA["L" S STOP=$P($$SCH^XLFDT($P(DURA,"L",2)_"M",$P(REQST,".")),".")_"."_$P(REQST,".",2) Q STOP
"RTN","PSJHL9",118,0)
 I DURA["W",DURA["." S DURA="H"_(($P(DURA,"W",2)*7)*24)
"RTN","PSJHL9",119,0)
 I DURA["D",DURA["." S DURA="H"_($P(DURA,"D",2)*24)
"RTN","PSJHL9",120,0)
 I +DURA=DURA,DURA["." S DURA="H"_(DURA*24)
"RTN","PSJHL9",121,0)
 S STOP=$$FMADD^XLFDT(REQST,$S(DURA["W":$P(DURA,"W",2)*7,DURA["D":$P(DURA,"D",2),+DURA=DURA:+DURA,1:""),$S(DURA["H":$P(DURA,"H",2),1:""),$S(DURA["M":$P(DURA,"M",2),1:""),$S(DURA["S":$P(DURA,"S",2),1:""))
"RTN","PSJHL9",122,0)
 Q STOP
"RTN","PSJHL9",123,0)
ZQDATE(DATE,MONTHS)  ;BUMP DATE BY A MONTH (OR SO)
"RTN","PSJHL9",124,0)
 ;;
"RTN","PSJHL9",125,0)
 S X=$E($P(DATE,"."),1,5)+($E($P(DATE,"."),4,5)>(12-MONTHS)*88+MONTHS)_$E($P(DATE,"."),6,7) F  D ^%DT Q:Y>0  S X=X-1
"RTN","PSJHL9",126,0)
 S NEWDATE=X_"."_$P(DATE,".",2)
"RTN","PSJHL9",127,0)
 Q NEWDATE
"RTN","PSJHL9",128,0)
DAY(DATE) ;DATE=FIRST FIVE DIGITS OF FM DATE
"RTN","PSJHL9",129,0)
 N X
"RTN","PSJHL9",130,0)
 I DATE'?5N Q -1
"RTN","PSJHL9",131,0)
 S X=$E(DATE,4,5) I X<1!(X>12) Q -1
"RTN","PSJHL9",132,0)
 S X=DATE+1+(X=12*88)_"01"
"RTN","PSJHL9",133,0)
 Q $E($$FMADD^XLFDT(X,-1),6,7)
"RTN","PSJLIACT")
0^68^B40797272
"RTN","PSJLIACT",1,0)
PSJLIACT ;BIR/MV-IV ACTION ;28 Jul 98 / 8:50 AM
"RTN","PSJLIACT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**15,47,62,58,82,97,80,110,111**;16 DEC 97
"RTN","PSJLIACT",3,0)
 ;
"RTN","PSJLIACT",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLIACT",5,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA 2410.
"RTN","PSJLIACT",6,0)
 ;
"RTN","PSJLIACT",7,0)
DC ; Discontinue order
"RTN","PSJLIACT",8,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",9,0)
 S PSJCOM=+$S(PSJORD["V":$P($G(^PS(55,DFN,"IV",+PSJORD,.2)),"^",8),1:$P($G(^PS(53.1,+PSJORD,.2)),"^",8))
"RTN","PSJLIACT",10,0)
 I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSJORD)
"RTN","PSJLIACT",11,0)
 I PSJCOM F  W !!,"Do you want to discontinue this order" S %=1 D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSJLIACT",12,0)
 I PSJCOM,%'=1 S VALMBK="" Q
"RTN","PSJLIACT",13,0)
 I PSJORD["V" D DC^PSIVORA,EN^PSJLIORD(DFN,ON) Q
"RTN","PSJLIACT",14,0)
 D:PSJORD["P" DISCONT^PSIVORC
"RTN","PSJLIACT",15,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",16,0)
 Q
"RTN","PSJLIACT",17,0)
ACEDIT ; Display LM screen and AC and EDit actions
"RTN","PSJLIACT",18,0)
 ;K PSIVFN1 ; if not set display the second screen when finish.
"RTN","PSJLIACT",19,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",20,0)
 S VALMBCK=$S($G(PSIVACEP):"Q",1:"R")
"RTN","PSJLIACT",21,0)
 Q
"RTN","PSJLIACT",22,0)
AEEXIT ; Call for EXIT CODE in PSJ LM IV AC/EDIT
"RTN","PSJLIACT",23,0)
 D:ON["V" GT55^PSIVORFB
"RTN","PSJLIACT",24,0)
 I ON["P" D GT531^PSIVORFA(DFN,ON) D:P("OT")'="I" GTDATA^PSJLIFN
"RTN","PSJLIACT",25,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",26,0)
 K PSIVENO
"RTN","PSJLIACT",27,0)
 Q
"RTN","PSJLIACT",28,0)
EDIT ; Edit order
"RTN","PSJLIACT",29,0)
 K PSIVFN1 NEW PSIVNBD
"RTN","PSJLIACT",30,0)
 I $D(PSGACT),PSGACT'["E" W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJLIACT",31,0)
 D EDIT1
"RTN","PSJLIACT",32,0)
 ;Q:$D(PSIVNBD)
"RTN","PSJLIACT",33,0)
 Q:$D(PSIVNBD)!($G(PSIVCOPY)&'$G(PSIVENO))
"RTN","PSJLIACT",34,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",35,0)
 S VALMBCK=$S($G(PSIVFN1):"Q",1:"R")
"RTN","PSJLIACT",36,0)
 Q
"RTN","PSJLIACT",37,0)
EDIT1 ;
"RTN","PSJLIACT",38,0)
 ;Ensure P() is defined
"RTN","PSJLIACT",39,0)
 I $D(P)<10 S XQORQUIT=1,P("PON")="",PSIVNBD=1 D  Q
"RTN","PSJLIACT",40,0)
 .W !,"WARNING: An error has occurred. Changes will not be saved"
"RTN","PSJLIACT",41,0)
 .D PAUSE^VALM1
"RTN","PSJLIACT",42,0)
 .S VALMBCK="Q"
"RTN","PSJLIACT",43,0)
 I "ANP"'[P(17) W !,"You cannot edit an inactive order" D PAUSE^VALM1 Q
"RTN","PSJLIACT",44,0)
 S:$G(ON55)="" ON55=$G(PSJORD)
"RTN","PSJLIACT",45,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",46,0)
 ;* Edit a new back door order
"RTN","PSJLIACT",47,0)
 ;;I ($G(ON55)["V"&($G(P(21))="")) D  Q
"RTN","PSJLIACT",48,0)
 I ($G(ON55)["V"&($G(P("21FLG"))="")) D  Q
"RTN","PSJLIACT",49,0)
 . D GSTRING^PSIVORE1,GTFLDS^PSIVORFE
"RTN","PSJLIACT",50,0)
 . I $G(ON55)["V",'$G(DONE) D OK^PSIVORE
"RTN","PSJLIACT",51,0)
 . S VALMBCK="Q",PSIVNBD=1
"RTN","PSJLIACT",52,0)
 ;* Edit an active order
"RTN","PSJLIACT",53,0)
 I $G(ON55)["V" NEW PSJEDIT1 D E^PSIVOPT1 D  Q
"RTN","PSJLIACT",54,0)
 . I $G(PSJIVBD) K PSJIVBD D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",55,0)
 I $G(ON55)["P" D EDIT^PSIVORC ;Edit incomplete order.
"RTN","PSJLIACT",56,0)
 Q
"RTN","PSJLIACT",57,0)
ACCEPT ; Accept order
"RTN","PSJLIACT",58,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",59,0)
 ;Accept IV from back door.
"RTN","PSJLIACT",60,0)
 I $G(PSJIVBD) K PSJIVBD D OK^PSIVORE S VALMBCK="Q" Q
"RTN","PSJLIACT",61,0)
 I ON["V" D ACCEPT^PSIVOPT1 Q
"RTN","PSJLIACT",62,0)
 S PSIVFN1=1
"RTN","PSJLIACT",63,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIACT",64,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",65,0)
 Q
"RTN","PSJLIACT",66,0)
R ; Renewal
"RTN","PSJLIACT",67,0)
 S PSJREN=1
"RTN","PSJLIACT",68,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",69,0)
 NEW PSIVAC S PSIVAC="PR" K PSGFDX
"RTN","PSJLIACT",70,0)
 D R^PSIVOPT
"RTN","PSJLIACT",71,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",72,0)
 K PSJREN
"RTN","PSJLIACT",73,0)
 Q
"RTN","PSJLIACT",74,0)
H ; Hold
"RTN","PSJLIACT",75,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",76,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",77,0)
 D H^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",78,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",79,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",80,0)
 Q
"RTN","PSJLIACT",81,0)
L ; Activity Log
"RTN","PSJLIACT",82,0)
 NEW PSIVLAB,PSIVLOG,PSJHIS S (PSIVLAB,PSIVLOG)=1
"RTN","PSJLIACT",83,0)
 D EN^PSIVVW1
"RTN","PSJLIACT",84,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",85,0)
 S VALMBCK="R"
"RTN","PSJLIACT",86,0)
 Q
"RTN","PSJLIACT",87,0)
O ; On Call
"RTN","PSJLIACT",88,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",89,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",90,0)
 D O^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",91,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",92,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",93,0)
 Q
"RTN","PSJLIACT",94,0)
VF ; Make the order active
"RTN","PSJLIACT",95,0)
 NEW PSIVCHG S PSIVCHG=0
"RTN","PSJLIACT",96,0)
 I ON["V" S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",97,0)
 D ACTIVE^PSIVORC2
"RTN","PSJLIACT",98,0)
 Q
"RTN","PSJLIACT",99,0)
VF1(PSIVREA,PSIVAL,PSIVLOG) ;
"RTN","PSJLIACT",100,0)
 ;Update 4 node and set activity log.
"RTN","PSJLIACT",101,0)
 ;PSIVREA: the reason use by LOG^PSIVORAL
"RTN","PSJLIACT",102,0)
 ;PSIVAL : the description reason
"RTN","PSJLIACT",103,0)
 ;PSIVLOG: Log an activity if = 1
"RTN","PSJLIACT",104,0)
 I '+$G(OD)!($L($G(OD))>16) K OD
"RTN","PSJLIACT",105,0)
 D:+PSJSYSU=3 ^PSIVORE1
"RTN","PSJLIACT",106,0)
 NEW DIE,DA,DR,PSJX,XX,PSIVACT,PSJRQND
"RTN","PSJLIACT",107,0)
 S PSIVACT=1
"RTN","PSJLIACT",108,0)
 S PSJX=$G(^PS(55,DFN,"IV",+ON55,4)),XX=""
"RTN","PSJLIACT",109,0)
 I $P(PSJX,U)="" S XX=";143////0"
"RTN","PSJLIACT",110,0)
 I $P(PSJX,U,4)="" S XX=XX_U_";142////0"
"RTN","PSJLIACT",111,0)
 D NOW^%DTC
"RTN","PSJLIACT",112,0)
 S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",113,0)
 I +PSJSYSU=3 S DR="140////"_DUZ_";141////"_$E(%,1,12)_";142////1"_$P(XX,U)
"RTN","PSJLIACT",114,0)
 I +PSJSYSU=1 S DR="16////"_DUZ_";17////"_$E(%,1,12)_";143////1"_$P(XX,U,2)
"RTN","PSJLIACT",115,0)
 I $G(P("PRY"))="D" S DR=DR_";.22////"_+P("IVRM")
"RTN","PSJLIACT",116,0)
 D ^DIE
"RTN","PSJLIACT",117,0)
 ; If pending IV renew is edited during finish, go back and DE the original active order left in RENEWED status
"RTN","PSJLIACT",118,0)
 S PREREN=$S(ON55["V":$G(@(DIE_"+ON55,2)")),1:""),PREREN=$P(PREREN,"^",5) I PREREN D  K PREREN
"RTN","PSJLIACT",119,0)
 . I PREREN["P" S PREREN=$G(@("^PS(53.1,+PREREN,0)")),PREREN=$P(PREREN,"^",25)
"RTN","PSJLIACT",120,0)
 . I PREREN["V" N PRERENOD S PRERENOD=$G(@("^PS(55,DFN,""IV"",+PREREN,0)")) I $P(PRERENOD,"^",17)="R",($G(P("RES"))="E") D
"RTN","PSJLIACT",121,0)
 ..  S DIE="^PS(55,"_DFN_",""IV"",",DA=+PREREN,DA(1)=DFN
"RTN","PSJLIACT",122,0)
 ..  S DR="100////D;.03////"_PSGDT S ORIGSTOP=$P($G(@("^PS(55,DFN,""IV"",+PREREN,2)")),"^",3) I ORIGSTOP S DR=DR_";116////"_ORIGSTOP
"RTN","PSJLIACT",123,0)
 ..  D ^DIE D EN1^PSJHL2(DFN,"SC",PREREN)
"RTN","PSJLIACT",124,0)
 K DR,DIE,DA
"RTN","PSJLIACT",125,0)
 ;I ((+PSJSYSU=3)&($G(PSJPRI)="D"))!((+PSJSYSU=3)&($G(P("PRY"))="D")) D
"RTN","PSJLIACT",126,0)
 I (+PSJSYSU=3)&($G(P("PRY"))="D") D
"RTN","PSJLIACT",127,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSJLIACT",128,0)
 .Q:Y="N"
"RTN","PSJLIACT",129,0)
 .D MAIN^TIUEDIT(3,.TIUDA,DFN,"","","","",1)
"RTN","PSJLIACT",130,0)
 Q:'$G(PSIVLOG)
"RTN","PSJLIACT",131,0)
 I $G(P("PACT"))]"",+$P(P("PACT"),U,2),+$P(P("PACT"),U,3) D
"RTN","PSJLIACT",132,0)
 . NEW DIC,DA,X,Y,XX,DO D NAME^PSJBCMA1($P(P("PACT"),U,2),.XX)
"RTN","PSJLIACT",133,0)
 . S DIC(0)="L",DA(1)=DFN,DA(2)=+ON55,X=1
"RTN","PSJLIACT",134,0)
 . S DIC="^PS(55,"_DA(1)_",""IV"","_DA(2)_",""A"","
"RTN","PSJLIACT",135,0)
 . S DIC("DR")=".02////F;.03////"_XX_";.04////"_$P($G(^PS(53.3,+$P(P("PACT"),U,3),0)),U)_";.05////"_$P(P("PACT"),U)_";.06////"_$P(P("PACT"),U,2)
"RTN","PSJLIACT",136,0)
 . D FILE^DICN
"RTN","PSJLIACT",137,0)
 NEW PSIVALCK
"RTN","PSJLIACT",138,0)
 S PSIVREA="V",PSIVALT=""
"RTN","PSJLIACT",139,0)
 S PSIVAL=PSIVAL_$S(+PSJSYSU=3:"PHARMACIST",1:"NURSE")
"RTN","PSJLIACT",140,0)
 D LOG^PSIVORAL K PSIVAL,PSIVREA,PSIVLN
"RTN","PSJLIACT",141,0)
 I $G(PSJORD)["P" S PSIVREA="V",PSIVALT="",PSGRDTX=$G(^PS(53.1,+PSJORD,2.5)) D
"RTN","PSJLIACT",142,0)
 . I $G(PSGRDTX) S PSIVAL="Requested Start Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U))) D LOG^PSIVORAL
"RTN","PSJLIACT",143,0)
 . I $P(PSGRDTX,U,3) S PSIVREA="V",PSIVALT="" S PSIVAL="Requested Stop Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U,3))) D LOG^PSIVORAL
"RTN","PSJLIACT",144,0)
 N DUR I $G(PSJORD) S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S(PSJORD["P":"P",1:"IV"),1) I DUR]""  D
"RTN","PSJLIACT",145,0)
 . K DR S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",146,0)
 . S DR=$S($G(IVLIMIT):"152////"_DUR,1:"151////"_DUR) K IVLIMIT
"RTN","PSJLIACT",147,0)
 . D ^DIE
"RTN","PSJLIACT",148,0)
 D EN1^PSJHL2(DFN,"SC",ON55)
"RTN","PSJLIACT",149,0)
 D:+PSJSYSU=1 EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSJLIACT",150,0)
 D GT55^PSIVORFB S OLDON=$P($G(^PS(55,DFN,"IV",+ON55,2)),"^",5),P("OLDON")=OLDON
"RTN","PSJLIACT",151,0)
 N PSJPRIO,PSJSCH,NODE0,NODEP2 S NODE0=$G(^PS(55,DFN,"IV",+ON55,0)),NODEP2=$G(^PS(55,DFN,"IV",+ON55,.2))
"RTN","PSJLIACT",152,0)
 S PSJPRIO=$P(NODEP2,"^",4),PSJSCH=$P(NODE0,"^",9)
"RTN","PSJLIACT",153,0)
 I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCH)="NOW")!($G(PSJSCH)["STAT") D NOTIFY^PSJHL4(ON55,DFN,$G(PSJPRIO),$G(PSJSCH))
"RTN","PSJLIACT",154,0)
 Q
"RTN","PSJLIFNI")
0^107^B11199375
"RTN","PSJLIFNI",1,0)
PSJLIFNI ;BIR/MV-U/D ORDER FINISHES AS IV ;13 Jan 98 / 11:32 AM
"RTN","PSJLIFNI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,29,34,37,50,94,116,110,111**;16 DEC 97
"RTN","PSJLIFNI",3,0)
 ;
"RTN","PSJLIFNI",4,0)
IV(PSJORD,OI) ; Prompt for missing data to be finished as IV.
"RTN","PSJLIFNI",5,0)
 L +^PS(53.1,+PSJORD):1 I '$T W !,$C(7),$C(7),"This order is being edited by another user. Try later." D PAUSE^VALM1 Q
"RTN","PSJLIFNI",6,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIFNI",7,0)
 ;** PSIVFN1 is use so it will dipslay the AC/Edit screen
"RTN","PSJLIFNI",8,0)
 ;** instead of go to the "IS this O.K." prompt
"RTN","PSJLIFNI",9,0)
 ;** PSJLIFNI is a flag to indicate U/D finishes as IV.
"RTN","PSJLIFNI",10,0)
 K PSJIVBD
"RTN","PSJLIFNI",11,0)
 NEW PSIVFN1,ON55,PSGORQF,PSIVACEP,DRGOC,PSJLIFNI,PSIVOI
"RTN","PSJLIFNI",12,0)
 S PSJLIFNI=1
"RTN","PSJLIFNI",13,0)
 S PSIVAC="CF" S (P("PON"),ON,ON55)=+PSJORD_"P",DFN=PSGP
"RTN","PSJLIFNI",14,0)
 S PSIVUP=+$$GTPCI^PSIVUTL D GT531^PSIVORFA(DFN,ON) S P("PD")=OI_U_$$OIDF^PSJLMUT1(+OI)
"RTN","PSJLIFNI",15,0)
 D:'$D(P("OT")) GTOT^PSIVUTL(P(4))
"RTN","PSJLIFNI",16,0)
 S P("OPI")=$$ENPC^PSJUTL("V",+PSIVUP,60,P("OPI"))
"RTN","PSJLIFNI",17,0)
 D 53^PSIVORC1
"RTN","PSJLIFNI",18,0)
 I $E(P("OT"))="I" D GTDATA^PSJLIFN Q:P(4)=""
"RTN","PSJLIFNI",19,0)
 ;I $$SCHREQ^PSJLIVFD(.P),(P(9))]"",'$$PRNOK^PSGS0(P(9)) N PSGOES,X,PSGS0XT,PSJNSS S PSJNSS=1,PSGOES=1,X=P(9),PSGS0XT=P(15) D Q2^PSGS0
"RTN","PSJLIFNI",20,0)
 I $$SCHREQ^PSJLIVFD(.P),(P(9))]"",'$$PRNOK^PSGS0(P(9)) N PSJNSS,PSGOES,PSGS0XT,PSGS0Y,PSGAT S X=P(9),PSGS0XT=P(15),PSGAT=P(11) D
"RTN","PSJLIFNI",21,0)
 .D EN^PSGS0 I $G(X)="" S PSGORQF=1 Q
"RTN","PSJLIFNI",22,0)
 .I $G(PSGS0Y)>1 S P(11)=PSGS0Y
"RTN","PSJLIFNI",23,0)
 I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) S DNE=0 D GTIVDRG^PSIVORC2 S P(3)="" D ENSTOP^PSIVCAL D ORDCHK^PSJLIFN
"RTN","PSJLIFNI",24,0)
 I $D(PSGORQF) S VALMBCK="R",P(4)="" K DRG Q
"RTN","PSJLIFNI",25,0)
 S ^TMP("PSJI",$J,0)=""
"RTN","PSJLIFNI",26,0)
 S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 D:EDIT]"" EDIT^PSIVEDT
"RTN","PSJLIFNI",27,0)
 I $G(DONE) S VALMBCK="R" D EXIT Q
"RTN","PSJLIFNI",28,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIFNI",29,0)
 S:$D(PSIVACEP) VALMBCK="Q"
"RTN","PSJLIFNI",30,0)
EXIT ;
"RTN","PSJLIFNI",31,0)
 L -^PS(53.1,+PSJORD)
"RTN","PSJLIFNI",32,0)
 Q
"RTN","PSJLIFNI",33,0)
ORDCHK(DFN,TYPE) ;
"RTN","PSJLIFNI",34,0)
 ;TYPE ="DD" - Duplicate drug
"RTN","PSJLIFNI",35,0)
 ;     ="DC" - Duplicate class
"RTN","PSJLIFNI",36,0)
 ;     -"DI" - Drug Interaction
"RTN","PSJLIFNI",37,0)
 ;
"RTN","PSJLIFNI",38,0)
 NEW ON,PSJL,PSIVX,PSJOC,PSJORIEN,PSJPACK,PSJLINE
"RTN","PSJLIFNI",39,0)
 S PSJOC=0,PSJLINE=1
"RTN","PSJLIFNI",40,0)
 F PSIVX=0:0 S PSIVX=$O(^TMP($J,TYPE,PSIVX)) Q:'PSIVX  D
"RTN","PSJLIFNI",41,0)
 . I TYPE="DI",($P(^TMP($J,TYPE,PSIVX,0),U,4)="CRITICAL") S PSJIREQ=1
"RTN","PSJLIFNI",42,0)
 . D WRITE(TYPE),CONT^PSGSICHK
"RTN","PSJLIFNI",43,0)
 .; I ON["V" D
"RTN","PSJLIFNI",44,0)
 .;. I '$O(^PS(55,DFN,"IV",+ON,0)) D SETPSJOC Q
"RTN","PSJLIFNI",45,0)
 .;. D DSPLORDV(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLIFNI",46,0)
 .; I ON'["V" D DSPLORDU(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLIFNI",47,0)
 .; S PSJOC(ON,PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJLIFNI",48,0)
 ;D:PSJOC WRITE(TYPE)
"RTN","PSJLIFNI",49,0)
 ;S ON="" F  S ON=$O(PSJOC(ON)) Q:ON=""  W ! S PSJLINE=PSJLINE+1 D
"RTN","PSJLIFNI",50,0)
 ;. F PSIVX=0:0 S PSIVX=$O(PSJOC(ON,PSIVX)) Q:'PSIVX  W !,PSJOC(ON,PSIVX)  S PSJLINE=PSJLINE+1 D:'(PSIVX#6) PAUSE
"RTN","PSJLIFNI",51,0)
 ;W !
"RTN","PSJLIFNI",52,0)
 Q
"RTN","PSJLIFNI",53,0)
WRITE(TYPE) ;Display order check description
"RTN","PSJLIFNI",54,0)
 S PSJPDRG=1
"RTN","PSJLIFNI",55,0)
 I TYPE="DD" W !!,"There are duplicate ",$P(^TMP($J,TYPE,PSIVX,0),U,2),!,"medications prescribed for this order.",! Q
"RTN","PSJLIFNI",56,0)
 I TYPE="DC" W !!,"This medication: ",$P(^TMP($J,TYPE,PSIVX,0),U,4),!,"is in the same class as the following medication(s) within this order: "
"RTN","PSJLIFNI",57,0)
 I TYPE="DI" W !!,"This medication: ",$P(^TMP($J,TYPE,PSIVX,0),U,2),!,"has an interaction with the following medication(s) within this order: "
"RTN","PSJLIFNI",58,0)
 F X=0:0 S X=$O(^TMP($J,TYPE,X)) Q:'X  W !,$S(TYPE="DC":$P(^TMP($J,TYPE,X,0),U,4),TYPE="DI":$P(^TMP($J,TYPE,X,0),U,6),1:$P(^TMP($J,TYPE,X,0),U,2)),!
"RTN","PSJLIFNI",59,0)
 Q
"RTN","PSJLIVFD")
0^69^B37728211
"RTN","PSJLIVFD",1,0)
PSJLIVFD ;BIR/MV-SETUP LM TEMPLATE FOR IV FLUID ;4 Aug 00 / 2:37 PM
"RTN","PSJLIVFD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,50,63,64,58,81,91,80,116,110,111**;16 DEC 97
"RTN","PSJLIVFD",3,0)
 ;
"RTN","PSJLIVFD",4,0)
 ; Reference to ^VALM0 is supported by DBIA # 2615.
"RTN","PSJLIVFD",5,0)
 ;
"RTN","PSJLIVFD",6,0)
 ;NFI changes for FR# 3@AD+4
"RTN","PSJLIVFD",7,0)
 ;
"RTN","PSJLIVFD",8,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVFD",9,0)
 K ^TMP("PSJI",$J)
"RTN","PSJLIVFD",10,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVFD",11,0)
 S PSJLN=1
"RTN","PSJLIVFD",12,0)
AD ;
"RTN","PSJLIVFD",13,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVFD",14,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVFD",15,0)
 S PSJL=PSJL_"Additives:"
"RTN","PSJLIVFD",16,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,30,14)_+P("PON")
"RTN","PSJLIVFD",17,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,57,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVFD",18,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG)
"RTN","PSJLIVFD",19,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,75,6)
"RTN","PSJLIVFD",20,0)
 I '$D(IORVON),$D(IOST(0)) D ENS^%ZISS,TERM^VALM0
"RTN","PSJLIVFD",21,0)
 I $D(IORVON),(PSJVD]"") D CNTRL^VALM10(1,76,5,IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVFD",22,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",23,0)
 D:+$G(PSJLMX) CLRDSPL^PSJLIVMD
"RTN","PSJLIVFD",24,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVFD",25,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVFD",26,0)
SOL ;
"RTN","PSJLIVFD",27,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVFD",28,0)
 S PSJL=PSJL_"Solutions:"
"RTN","PSJLIVFD",29,0)
 I P("SYRS")]"" D
"RTN","PSJLIVFD",30,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,10)_$E(P("SYRS"),1,13)
"RTN","PSJLIVFD",31,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVFD",32,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",33,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVFD",34,0)
DUR ;
"RTN","PSJLIVFD",35,0)
 S PSJL=""
"RTN","PSJLIVFD",36,0)
 N DUROUT,IVLIMIT S DUROUT=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVFD",37,0)
 S LABEL=$S($G(IVLIMIT):"IV Limit: ",1:"Duration: ") K IVLIMIT
"RTN","PSJLIVFD",38,0)
 S PSJL=$$SETSTR^VALM1(LABEL,PSJL,12,10)
"RTN","PSJLIVFD",39,0)
 S PSJL=PSJL_DUROUT
"RTN","PSJLIVFD",40,0)
START ;
"RTN","PSJLIVFD",41,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVFD",42,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVFD",43,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",44,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVFD",45,0)
 S PSJL="" I $G(PSJORD)["P",$G(PSGRDTX) D
"RTN","PSJLIVFD",46,0)
 . N RSDLABL,PSJRQB,PSJRQL,PSGRSD,PSGSRSDN
"RTN","PSJLIVFD",47,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVFD",48,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVFD",49,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVFD",50,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVFD",51,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT^PSJLIVMD(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL),SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",52,0)
INFRATE ;
"RTN","PSJLIVFD",53,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVFD",54,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVFD",55,0)
 D LONG^PSJLIUTL(P(8),22,24)
"RTN","PSJLIVFD",56,0)
LASTREN ;
"RTN","PSJLIVFD",57,0)
 N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGRNDT D
"RTN","PSJLIVFD",58,0)
 . S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVFD",59,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",60,0)
MR ;
"RTN","PSJLIVFD",61,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVFD",62,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVFD",63,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVFD",64,0)
STOP ;
"RTN","PSJLIVFD",65,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVFD",66,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$$STOPDT^PSJLIUTL
"RTN","PSJLIVFD",67,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",68,0)
 S PSJL=""
"RTN","PSJLIVFD",69,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(DFN,PSJORD)
"RTN","PSJLIVFD",70,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVFD",71,0)
 ;D:$G(PSGRFD) DSPLYDT^PSJLIVMD(PSJLMX+7,.PSGRFD,.PSGRFDN," REQUESTED STOP: ",P(3)'=PSGRFD)
"RTN","PSJLIVFD",72,0)
 I $G(PSGRDTX(+PSJORD,"PSGRFD")) S PSGRFD=PSGRDTX(+PSJORD,"PSGRFD"),PSGRFDN=$$ENDTC^PSGMI(PSGRFD) D
"RTN","PSJLIVFD",73,0)
 . D DSPLYDT^PSJLIVMD(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",0,51,29)
"RTN","PSJLIVFD",74,0)
 D:($G(PSJBCMA)]"")!($G(PSGRFD)]"") SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",75,0)
SCH ;
"RTN","PSJLIVFD",76,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVFD",77,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVFD",78,0)
 D LONG^PSJLIUTL(P(9),22,32) S PSJL=PSJL_$S(P(7):"@0 labels a day",1:"")
"RTN","PSJLIVFD",79,0)
LASTFL ;
"RTN","PSJLIVFD",80,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVFD",81,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVFD",82,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",83,0)
ADM ;
"RTN","PSJLIVFD",84,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVFD",85,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVFD",86,0)
 D LONG^PSJLIUTL(P(11),22,30)
"RTN","PSJLIVFD",87,0)
QTY ;
"RTN","PSJLIVFD",88,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVFD",89,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",90,0)
PROVIDER ;
"RTN","PSJLIVFD",91,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVFD",92,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVFD",93,0)
CUMDOSES ;
"RTN","PSJLIVFD",94,0)
 ;S PSJL=$$SETSTR^VALM1("Cumulative Doses:",PSJL,45,17)_P("CUM")
"RTN","PSJLIVFD",95,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVFD",96,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",97,0)
OPI ;
"RTN","PSJLIVFD",98,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVFD",99,0)
 S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)_$P(P("OPI"),"^")
"RTN","PSJLIVFD",100,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",101,0)
PC ;
"RTN","PSJLIVFD",102,0)
 S PSJL=""
"RTN","PSJLIVFD",103,0)
 ;S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D SETTMP^PSJLMPRU("PSJI",PSJL) D WTPC^PSJLIUTL
"RTN","PSJLIVFD",104,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVFD",105,0)
REMARK ;
"RTN","PSJLIVFD",106,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",107,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVFD",108,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVFD",109,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVFD",110,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",111,0)
IVROOM ;
"RTN","PSJLIVFD",112,0)
 S PSJL=""
"RTN","PSJLIVFD",113,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVFD",114,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",115,0)
ENTRY ;
"RTN","PSJLIVFD",116,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVFD",117,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,18),1:"*** Undefined")
"RTN","PSJLIVFD",118,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVFD",119,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",120,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVFD",121,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVFD",122,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S(ON["P":28,1:100))_" IV "
"RTN","PSJLIVFD",123,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVFD",124,0)
 I $G(P("PON"))["P" D ORDCHK
"RTN","PSJLIVFD",125,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVFD",126,0)
 Q
"RTN","PSJLIVFD",127,0)
 ;
"RTN","PSJLIVFD",128,0)
ORDCHK ;Display order check for pending order
"RTN","PSJLIVFD",129,0)
 Q:'$O(^PS(53.1,+ON,10,0))
"RTN","PSJLIVFD",130,0)
 NEW PSJIVX,PSJIVXX
"RTN","PSJLIVFD",131,0)
 F PSJIVX=0:0 S PSJIVX=$O(^PS(53.1,+ON,10,PSJIVX)) Q:'PSJIVX  D
"RTN","PSJLIVFD",132,0)
 . D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",133,0)
 . S PSJL="Order Checks       :" D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,0)),22,60)
"RTN","PSJLIVFD",134,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",135,0)
 . S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+ON,10,PSJIVX,1)),U)
"RTN","PSJLIVFD",136,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",137,0)
 . S PSJL="Overriding Reason  : "
"RTN","PSJLIVFD",138,0)
 . F PSJIVXX=0:0 S PSJIVXX=$O(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX)) Q:'PSJIVXX  D
"RTN","PSJLIVFD",139,0)
 .. D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX,0)),22,60)
"RTN","PSJLIVFD",140,0)
 .. D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIVFD",141,0)
 Q
"RTN","PSJLIVFD",142,0)
 ;
"RTN","PSJLIVFD",143,0)
SCHREQ(IVAR) ;
"RTN","PSJLIVFD",144,0)
 I $G(IVAR(4))="P"!($G(IVAR(23))="P")!($G(IVAR(5))) Q 1
"RTN","PSJLIVFD",145,0)
 Q 0
"RTN","PSJLIVMD")
0^70^B66254747
"RTN","PSJLIVMD",1,0)
PSJLIVMD ;BIR/MV-SETUP LM TEMPLATE FOR INPT MED. IV ;4 Aug 00 / 4:29 PM
"RTN","PSJLIVMD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**37,50,63,58,81,91,80,116,110,111**;16 DEC 97
"RTN","PSJLIVMD",3,0)
 ;
"RTN","PSJLIVMD",4,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVMD",5,0)
 D GTOT^PSIVUTL(P(4))
"RTN","PSJLIVMD",6,0)
 S:'$D(PSJSTAR) PSJSTAR="" S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",7,0)
 I $E(P("OT"))'="I" D EN^PSJLIVFD Q
"RTN","PSJLIVMD",8,0)
 K ^TMP("PSJI",$J)
"RTN","PSJLIVMD",9,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVMD",10,0)
 S PSJLN=1
"RTN","PSJLIVMD",11,0)
 I $G(PSIV531),P("PON")["P" S (P(2),P(3),P(4))=""
"RTN","PSJLIVMD",12,0)
AD ;
"RTN","PSJLIVMD",13,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVMD",14,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVMD",15,0)
 S PSJL=PSJL_" Additives:"
"RTN","PSJLIVMD",16,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,28,14)_+P("PON")
"RTN","PSJLIVMD",17,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,57,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVMD",18,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG)
"RTN","PSJLIVMD",19,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,75,6)
"RTN","PSJLIVMD",20,0)
 I $D(IORVON),(PSJVD]"") D CNTRL^VALM10(1,76,5,IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVMD",21,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",22,0)
 D:+$G(PSJLMX) CLRDSPL
"RTN","PSJLIVMD",23,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVMD",24,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVMD",25,0)
SOL ;
"RTN","PSJLIVMD",26,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVMD",27,0)
 S PSJL=PSJL_" Solutions:"
"RTN","PSJLIVMD",28,0)
 I P("SYRS")]"" D
"RTN","PSJLIVMD",29,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,11)_$E(P("SYRS"),1,13)
"RTN","PSJLIVMD",30,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVMD",31,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",32,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVMD",33,0)
 D DUR
"RTN","PSJLIVMD",34,0)
START ;
"RTN","PSJLIVMD",35,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVMD",36,0)
 D REQDT(ON)
"RTN","PSJLIVMD",37,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVMD",38,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVMD",39,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",40,0)
INFRATE ;
"RTN","PSJLIVMD",41,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVMD",42,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVMD",43,0)
 D LONG^PSJLIUTL(P(8),22,23)
"RTN","PSJLIVMD",44,0)
RSTART ;
"RTN","PSJLIVMD",45,0)
 I $G(ON)["P" N PSGNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) D
"RTN","PSJLIVMD",46,0)
 . I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32) Q
"RTN","PSJLIVMD",47,0)
 . Q:'$G(PSGRDTX)  N PSJRQB,PSJRQL,RSDLABL,PSGRSD,PSGRSDN
"RTN","PSJLIVMD",48,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVMD",49,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVMD",50,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVMD",51,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVMD",52,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL)  ;,SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",53,0)
 I $G(ON)["V" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVMD",54,0)
 I PSJL]"" D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",55,0)
 ;
"RTN","PSJLIVMD",56,0)
MR ;
"RTN","PSJLIVMD",57,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVMD",58,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVMD",59,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVMD",60,0)
STOP ;
"RTN","PSJLIVMD",61,0)
 S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",62,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVMD",63,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$$STOPDT^PSJLIUTL
"RTN","PSJLIVMD",64,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",65,0)
 S PSJL=""
"RTN","PSJLIVMD",66,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSJORD)
"RTN","PSJLIVMD",67,0)
 I $G(PSJBCMA)]"",$G(DFN) S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVMD",68,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$G(P(3)) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")) D
"RTN","PSJLIVMD",69,0)
 . D DSPLYDT(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",1,51,29)
"RTN","PSJLIVMD",70,0)
 I ($G(PSJBCMA)]"")!($G(PSGRDTX(+$G(PSJORD),"PSGRFD"))&$G(P(3))) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",71,0)
SCH ;
"RTN","PSJLIVMD",72,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVMD",73,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVMD",74,0)
 D LONG^PSJLIUTL(P(9)_$S(P(7):"@0 labels a day",1:"")_$G(SCHMSG),22,31)
"RTN","PSJLIVMD",75,0)
LASTFL ;
"RTN","PSJLIVMD",76,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVMD",77,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVMD",78,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",79,0)
ADM ;
"RTN","PSJLIVMD",80,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVMD",81,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVMD",82,0)
 NEW NOECH
"RTN","PSJLIVMD",83,0)
 D LONG^PSJLIUTL(P(11),22,29)
"RTN","PSJLIVMD",84,0)
QTY ;
"RTN","PSJLIVMD",85,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVMD",86,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",87,0)
PROVIDER ;
"RTN","PSJLIVMD",88,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVMD",89,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVMD",90,0)
CUMDOSES ;
"RTN","PSJLIVMD",91,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVMD",92,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",93,0)
OI ;
"RTN","PSJLIVMD",94,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVMD",95,0)
 S PSJL=$$SETSTR^VALM1("Orderable Item:",PSJL,6,16)_$P(P("PD"),U,2)_$$OINF^PSJDIN(+P("PD"))
"RTN","PSJLIVMD",96,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",97,0)
INS ;
"RTN","PSJLIVMD",98,0)
 S PSJL=""
"RTN","PSJLIVMD",99,0)
 S PSJL=$$SETSTR^VALM1("Instructions:",PSJL,8,14)
"RTN","PSJLIVMD",100,0)
 D LONG^PSJLIUTL(P("INS"),22,58)
"RTN","PSJLIVMD",101,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",102,0)
OPI ;
"RTN","PSJLIVMD",103,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVMD",104,0)
 S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)_$P(P("OPI"),"^")
"RTN","PSJLIVMD",105,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",106,0)
PC ;
"RTN","PSJLIVMD",107,0)
 S PSJL=""
"RTN","PSJLIVMD",108,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVMD",109,0)
REMARK ;
"RTN","PSJLIVMD",110,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVMD",111,0)
 S PSJL="" D FLDNO^PSJLIUTL("(12)",1)
"RTN","PSJLIVMD",112,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVMD",113,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVMD",114,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",115,0)
IVROOM ;
"RTN","PSJLIVMD",116,0)
 S PSJL=""
"RTN","PSJLIVMD",117,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVMD",118,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",119,0)
ENTRY ;
"RTN","PSJLIVMD",120,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVMD",121,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,24),1:"*** Undefined")
"RTN","PSJLIVMD",122,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVMD",123,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",124,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVMD",125,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVMD",126,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S($G(ON)["P":28,1:100))_" IV "
"RTN","PSJLIVMD",127,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVMD",128,0)
 I $G(P("PON"))["P" D ORDCHK^PSJLIVFD
"RTN","PSJLIVMD",129,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVMD",130,0)
 Q
"RTN","PSJLIVMD",131,0)
DSPLYDT(PSJLN,PSGRDT,PSGRDTN,TXT,PSJFSH,PSJRDBEG,PSJRDLEN)  ;
"RTN","PSJLIVMD",132,0)
 ;LINE   : Line number the Requested Start and Stop dates are display in
"RTN","PSJLIVMD",133,0)
 ;PSGRDT : Either it is the requested start or stop date in FM format
"RTN","PSJLIVMD",134,0)
 ;PSGRDTN: Either it is the requested start or stop date in IPM format
"RTN","PSJLIVMD",135,0)
 ;TXT    : The display text
"RTN","PSJLIVMD",136,0)
 ;PSJFSH     : if it is 1 then flash
"RTN","PSJLIVMD",137,0)
 ;
"RTN","PSJLIVMD",138,0)
 S:'$G(PSJRDBEG) PSJRDBEG=41,PSJRDLEN=39
"RTN","PSJLIVMD",139,0)
 S PSJL=$$SETSTR^VALM1(TXT_PSGRDTN,PSJL,PSJRDBEG,PSJRDLEN)
"RTN","PSJLIVMD",140,0)
 Q
"RTN","PSJLIVMD",141,0)
CLRDSPL ;
"RTN","PSJLIVMD",142,0)
 ;Clear the blinking after edit the pending order.
"RTN","PSJLIVMD",143,0)
 ;Without it more than the requested start and stop dates are blinking at the ac/edit screen
"RTN","PSJLIVMD",144,0)
 ;PSJLMX: # ad/sol counted in WRTDRG^PSJLIUTL
"RTN","PSJLIVMD",145,0)
 Q:'$D(IOBOFF)
"RTN","PSJLIVMD",146,0)
 NEW PSJX
"RTN","PSJLIVMD",147,0)
 F PSJX=5:1:PSJLMX+7 D CNTRL^VALM10(PSJX,36,80,IOBOFF,IOINORM)
"RTN","PSJLIVMD",148,0)
 Q
"RTN","PSJLIVMD",149,0)
REQDT(ORDER)       ;Get requested date if it is a pending order
"RTN","PSJLIVMD",150,0)
 ;ORDER  : Pending Order Number (PSJORD or PSGORD)
"RTN","PSJLIVMD",151,0)
 Q:ORDER'["P"  D REQDT^PSJLIUTL(ORDER)
"RTN","PSJLIVMD",152,0)
 Q
"RTN","PSJLIVMD",153,0)
 ;
"RTN","PSJLIVMD",154,0)
GETDUR(PAT,ORD,PKG,RAW) ;
"RTN","PSJLIVMD",155,0)
 ; PAT= Patient DFN
"RTN","PSJLIVMD",156,0)
 ; ORD= Order #
"RTN","PSJLIVMD",157,0)
 ; PKG= 5(UD), "IV"(IV), "P"(Pending)
"RTN","PSJLIVMD",158,0)
 N ACT,DUR,ND,ND25,F25,ND0,ND2,OLDORD S DUR="",ORD=+ORD K IVLIMIT
"RTN","PSJLIVMD",159,0)
 S:PKG="V" PKG="IV"
"RTN","PSJLIVMD",160,0)
 I PKG="P" S ND=$G(^PS(53.1,+ORD,0)) D  I '$G(OLDORD) Q DUR
"RTN","PSJLIVMD",161,0)
 . D PENDING(ORD) Q:DUR]""
"RTN","PSJLIVMD",162,0)
 . S ND0=$G(^PS(53.1,ORD,0)) I $P(ND0,U,24)="E" S OLDORD=$P(ND0,U,25) I OLDORD S PKG=$S(OLDORD["V":"IV",OLDORD["U":5,OLDORD["P":"P",1:"")
"RTN","PSJLIVMD",163,0)
 . Q:($G(OLDORD)'["P")
"RTN","PSJLIVMD",164,0)
 . D PENDING(OLDORD) S OLDORD=""
"RTN","PSJLIVMD",165,0)
 I PKG="IV" S ND2=$G(^PS(55,PAT,PKG,ORD,2)) I $P(ND2,U,8)="E" S OLDORD=$P(ND2,U,5) S:OLDORD'["V" OLDORD=""
"RTN","PSJLIVMD",166,0)
 I PKG=5 S ND0=$G(^PS(55,PAT,PKG,ORD,0)) I $P(ND0,U,24)="E" S OLDORD=$P(ND0,U,25) S:OLDORD'["U" OLDORD=""
"RTN","PSJLIVMD",167,0)
 S F25="^PS(55,PAT,PKG,ORD,2.5)" I '$G(OLDORD) Q:'$D(@(F25)) DUR
"RTN","PSJLIVMD",168,0)
 S ND25=$G(@(F25)) S DUR=$P(ND25,U,2) I DUR="" S DUR=$P(ND25,U,4) I DUR]"" S IVLIMIT=1
"RTN","PSJLIVMD",169,0)
 I DUR="",$G(OLDORD) S ORD=+OLDORD Q:'$D(@(F25)) DUR  D
"RTN","PSJLIVMD",170,0)
 . S ND25=$G(@(F25)) S DUR=$P(ND25,U,2) I DUR="" S DUR=$P(ND25,U,4) I DUR]"" S IVLIMIT=1
"RTN","PSJLIVMD",171,0)
 I '$G(RAW),DUR]"" S DUR=$$FMTDUR(DUR)
"RTN","PSJLIVMD",172,0)
 Q DUR
"RTN","PSJLIVMD",173,0)
 ;
"RTN","PSJLIVMD",174,0)
PENDING(PNDON) ;
"RTN","PSJLIVMD",175,0)
 S ND=$G(^PS(53.1,+ORD,0))
"RTN","PSJLIVMD",176,0)
 I ND S ND25=$S(($P(ND,U,15)=PAT):$G(^PS(53.1,+ORD,2.5)),1:"")
"RTN","PSJLIVMD",177,0)
 S DUR=$P(ND25,U,4) I DUR]"" S:$E(DUR)="m"!($E(DUR)="l")!($E(DUR)="d")!($E(DUR)="h") IVLIMIT=1 S DUR=$S($G(RAW):DUR,1:$$FMTDUR(DUR)) Q
"RTN","PSJLIVMD",178,0)
 S DUR=$P(ND25,U,2) I DUR]"" S DUR=$S($G(RAW):DUR,1:$$FMTDUR(DUR))
"RTN","PSJLIVMD",179,0)
 Q
"RTN","PSJLIVMD",180,0)
 ;
"RTN","PSJLIVMD",181,0)
FMTDUR(DURCODE) ;
"RTN","PSJLIVMD",182,0)
 N DUNIT,DNUM,BAD S BAD=0
"RTN","PSJLIVMD",183,0)
 S DUNIT=$E(DURCODE),DNUM=$P(DURCODE,DUNIT,2) I 'DNUM S BAD=1
"RTN","PSJLIVMD",184,0)
 S DUNIT=$S(DUNIT="D"!(DUNIT="d"):" day",DUNIT="H"!(DUNIT="h"):" hour",DUNIT="W":" week",DUNIT="L":" month",DUNIT="M":" minute",DUNIT="S":" second",DUNIT="m":" ml",DUNIT="l":" liter",1:"")
"RTN","PSJLIVMD",185,0)
 S:DUNIT="" BAD=1 I (DNUM'=1),(DUNIT'["ml") S DUNIT=DUNIT_"s"
"RTN","PSJLIVMD",186,0)
 Q $S(BAD:"",1:DNUM_DUNIT)
"RTN","PSJLIVMD",187,0)
 ;
"RTN","PSJLIVMD",188,0)
DURMIN(DCOD) ;
"RTN","PSJLIVMD",189,0)
 N DUR,DMIN,CHR S DUR="" F I=1:1:$L(DCOD) S CHR=$E(DCOD,I) I CHR?1N S DUR=DUR_CHR
"RTN","PSJLIVMD",190,0)
 S DMIN=DUR*$S(DCOD["L":43200,DCOD["W":10080,DCOD["M":1,DCOD["S":(1/60),DCOD["D":1440,1:0) S DMIN=+$FN(DMIN,"",1)
"RTN","PSJLIVMD",191,0)
 Q DMIN
"RTN","PSJLIVMD",192,0)
 ;
"RTN","PSJLIVMD",193,0)
DUR ;
"RTN","PSJLIVMD",194,0)
 N DUROUT,LABEL,IVLIMIT
"RTN","PSJLIVMD",195,0)
 Q:'$G(PSJORD)  S PSJL=""
"RTN","PSJLIVMD",196,0)
 S DUROUT=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVMD",197,0)
 S LABEL=$S($G(IVLIMIT):"IV Limit: ",1:"Duration: ") K IVLIMIT
"RTN","PSJLIVMD",198,0)
 S PSJL=$$SETSTR^VALM1(LABEL,PSJL,12,10)
"RTN","PSJLIVMD",199,0)
 S PSJL=PSJL_DUROUT
"RTN","PSJLIVMD",200,0)
 Q
"RTN","PSJLMGUD")
0^92^B30595874
"RTN","PSJLMGUD",1,0)
PSJLMGUD ;BIR/MLM-INITIALIZE UNIT DOSE ORDER FIELDS FOR DISPLAY ;05 Feb 99 / 9:46 AM
"RTN","PSJLMGUD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**25,58,85,116,110,111**;16 DEC 97
"RTN","PSJLMGUD",3,0)
 ;
"RTN","PSJLMGUD",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178
"RTN","PSJLMGUD",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192 
"RTN","PSJLMGUD",6,0)
 ; Reference to ^PS(55   is supported by DBIA 2191
"RTN","PSJLMGUD",7,0)
 ; Reference to ES^ORX8 is supported by DBIA 3632
"RTN","PSJLMGUD",8,0)
 ;
"RTN","PSJLMGUD",9,0)
GETUD(DFN,PSGORD) ;
"RTN","PSJLMGUD",10,0)
 ;
"RTN","PSJLMGUD",11,0)
EN2 ;
"RTN","PSJLMGUD",12,0)
 N %X,%Y,ND2,DO,DRGI,FD,FL,FQC,NF,ND,PRI,SD,SIG,ST,STD,X,Y,ESIG
"RTN","PSJLMGUD",13,0)
 K GMRAL,P
"RTN","PSJLMGUD",14,0)
 S NF=$S(PSGORD["U":0,PSGORD["A":0,PSGORD["O":0,1:1) I NF,$D(^PS(53.1,+PSGORD,0)),$P(^(0),"^",19),$D(^PS(55,DFN,5,$P(^(0),"^",19))),(+$P(^(0),"^",19)'=+$P(^(0),"^",25)) S PSGORD=+$P(^PS(53.1,+PSGORD,0),"^",19)_"U",NF=0
"RTN","PSJLMGUD",15,0)
 S (FL,Y)="",$P(FL,"-",71)="",PSGOEEWF="^PS("_$S(NF:"53.1,",1:"55,"_DFN_",5,")_+PSGORD_","
"RTN","PSJLMGUD",16,0)
 ; The naked reference on the line below refers to the full reference created by indirect reference to F, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJLMGUD",17,0)
 S ND=$G(@(PSGOEEWF_"0)")),ND2=$G(^(2)),PSGEB=$P($G(^(4)),"^",7),PSGOSI=$G(^(6)),SIG=$G(^(6.5)),DO=$G(^(.2)),PSGOINST=$G(^(.3)),ESIG=$P(DO,U,3),PSG14=$P($G(^(14,0)),"^",3)
"RTN","PSJLMGUD",18,0)
 I PSG14 S PSGLRN=$G(@(PSGOEEWF_"14,"_PSG14_",0)"))
"RTN","PSJLMGUD",19,0)
 S PSGOPD=+DO,PSGODO=$P(DO,U,2),PSGOPDN=$$OINAME^PSJLMUTL(+DO),X=$P(DO,U,4),PSGPRIO=$P("STAT^ASAP^ROUTINE^PREOP^TIME CRITICAL^DONE",U,$F("SARPTD",X)-1),PSJPRI=X
"RTN","PSJLMGUD",20,0)
 S PSGOPR=$P(ND,"^",2),PSGOMR=$P(ND,"^",3),PSGOSM=$P(ND,"^",5),PSGOHSM=$P(ND,"^",6),(PSGOST,ST)=$P(ND,"^",7),STT=$P(ND,"^",9),PSGOMRN=$S('PSGOMR:"",1:$P($G(^PS(51.2,PSGOMR,0)),"^")) S:PSGOMRN="" PSGOMRN=PSGOMR
"RTN","PSJLMGUD",21,0)
 S PSGLI=$P(ND,U,16),PSGOSCH=$P(ND2,"^"),(PSGOSD,SD)=$P(ND2,"^",2),(FD,PSGOFD)=$P(ND2,"^",4),(FQC,PSGS0XT)=$P(ND2,"^",6),(PSGOAT,PSGS0Y)=$P(ND2,"^",5)
"RTN","PSJLMGUD",22,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSJLMGUD",23,0)
 ;I FQC="D",PSGOAT="" S PSGOAT=$E($P(SD,".",2)_"0000",1,4)
"RTN","PSJLMGUD",24,0)
 S PRI=$S('PSGOPR:0,1:$P($G(^VA(200,PSGOPR,"PS")),"^",4)),DRGI=$S(PSGOPD'=+PSGOPD:0,1:+$G(^PSDRUG(+PSGOPD,"I"))) S:PRI PRI=DT'<PRI S:DRGI DRGI=DT'<DRGI
"RTN","PSJLMGUD",25,0)
 S PSGOPRN=$S('PSGOPR:"",1:$P($G(^VA(200,PSGOPR,0)),"^")) S:PSGOPRN="" PSGOPRN=PSGOPR I PSGOSI]"" S PSGOSI=$$ENSET^PSGSICHK(PSGOSI)
"RTN","PSJLMGUD",26,0)
 I $L($T(ES^ORX8)) N ESIG1 S ESIG1=$$ES^ORX8(+$P(ND,U,21)_";1") S:ESIG1=1 ESIG="ES"
"RTN","PSJLMGUD",27,0)
 S PSGOPRN=PSGOPRN_$S(ESIG]"":" ["_$$LOW^XLFSTR(ESIG)_"]",1:"")
"RTN","PSJLMGUD",28,0)
 S PSGEBN=$$ENNPN^PSGMI(PSGEB) S:$P(ND,U,27)="R" STT="R"
"RTN","PSJLMGUD",29,0)
 S X=STT,PSGSTAT=$S(X="":"NOT FOUND",X="DE":"DISCONTINUED (EDIT)",X="DR":"DISCONTINUED (RENEWAL)",X="RE":"REINSTATED",1:$P(X_"^ACTIVE^DISCONTINUED^EXPIRED^HOLD^INCOMPLETE^NON-VERIFIED^PENDING^RENEWED^UNRELEASED","^",$F("ADEHINPRU",X)))
"RTN","PSJLMGUD",30,0)
 ;
"RTN","PSJLMGUD",31,0)
SET ;
"RTN","PSJLMGUD",32,0)
 I STT="P" S (FD,SD,ST)=""
"RTN","PSJLMGUD",33,0)
 S PSGOSTN=$$ENSTN^PSGMI(ST),(PSGOFDN,PSGOSDN)="" I SD S PSGOSDN=$$ENDD^PSGMI(SD)_"^"_$$ENDTC^PSGMI(SD)
"RTN","PSJLMGUD",34,0)
 I FD S PSGOFDN=$$ENDD^PSGMI(FD)_"^"_$$ENDTC^PSGMI(FD)
"RTN","PSJLMGUD",35,0)
 F X="PD","PDN","MR","MRN","ST","STN","SCH","SI","SD","SDN","FD","FDN","SM","HSM","PR","PRN","DO","AT" S @("PSG"_X)=@("PSGO"_X)
"RTN","PSJLMGUD",36,0)
 K ^PS(53.45,PSJSYSP,1),^(2) S %X=PSGOEEWF_"3,",%Y="^PS(53.45,"_PSJSYSP_",1," D %XY^%RCR S %X=PSGOEEWF_"1,",%Y="^PS(53.45,"_PSJSYSP_",2," D %XY^%RCR
"RTN","PSJLMGUD",37,0)
 S $P(^PS(53.45,PSJSYSP,2,0),"^",2)="53.4502P"
"RTN","PSJLMGUD",38,0)
 K PSJNSS I $G(PSGSCH)'="" D  K PSJNSS
"RTN","PSJLMGUD",39,0)
 . ;N PSGS0XT,PSGOES,Y S X=PSGSCH N PSGSCH S PSGSCH="" S:($G(VALMBCK)]"")!'$G(NSFF)!$G(PSJTUD) PSGOES=1 D ENOS^PSGS0
"RTN","PSJLMGUD",40,0)
 . N PSGS0XTO,Y,PSGOES S X=PSGSCH S PSGS0XTO=PSGS0XT N PSGOSCH S PSGOSCH=PSGSCH S PSGSCH="",PSGOES=1
"RTN","PSJLMGUD",41,0)
 . D ENOS^PSGS0 S:$G(X)="" PSGS0XT=PSGS0XTO S PSGSCH=$S($G(X)]""&($G(PSGS0XT)="D"):X,1:PSGOSCH)
"RTN","PSJLMGUD",42,0)
 Q
"RTN","PSJLMGUD",43,0)
 ;
"RTN","PSJLMGUD",44,0)
FINISH ;
"RTN","PSJLMGUD",45,0)
 I '$G(PSGS0XT),PSGOSCH]"" D  S $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSJLMGUD",46,0)
 .N PSGOES,PSGS0Y S X=PSGOSCH,PSGOES=1 D ENOS^PSGS0
"RTN","PSJLMGUD",47,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10) I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")_" before it can be finished."
"RTN","PSJLMGUD",48,0)
 I PSGOEFF W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSJLMGUD",49,0)
 I PSGOEFF#2 S F1=53.1,MSG=0,Y=$T(35),@("PSGFN(35)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(35),";",3) G:'PSGOEE DONE
"RTN","PSJLMGUD",50,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(PSGOPD,0) G:CHK DONE
"RTN","PSJLMGUD",51,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSJLMGUD",52,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD) N XQORM D EN^VALM("PSJ LM OE DISPLAY") G DONE ;D ENW^PSGOEEW
"RTN","PSJLMGUD",53,0)
 ;
"RTN","PSJLMGUD",54,0)
ACCEPT ;
"RTN","PSJLMGUD",55,0)
 D UPD^PSGOEF1 G DONE
"RTN","PSJLMGUD",56,0)
BYPASS ;
"RTN","PSJLMGUD",57,0)
 S PSGCANFL=1 G DONE
"RTN","PSJLMGUD",58,0)
 ;
"RTN","PSJLMGUD",59,0)
EDIT ;    
"RTN","PSJLMGUD",60,0)
 S PSGPDRG=PSGOPD,PSGPDRGN=PSGOPDN K PSGOEEND D ENF^PSGOEE I PSGCANFL=-1 D UPD^PSGOEF1
"RTN","PSJLMGUD",61,0)
 ;
"RTN","PSJLMGUD",62,0)
DONE ;
"RTN","PSJLMGUD",63,0)
 K CHK,DA,DIE,DR,DRG,MSG,ORETURN,ORIFN,PSGEB,PSGEFN,PSGND,PSGOEE,PSGOEEF,PSGOEEND,PSGOEEG,PSGOEF,PSGOEFF,PSGOES,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGPDRG,PSGDRGN,PSG0XT,PSGS0Y,OSGSD,Q1,Q2
"RTN","PSJLMGUD",64,0)
 Q
"RTN","PSJLMGUD",65,0)
 ;
"RTN","PSJLMGUD",66,0)
 ;
"RTN","PSJLMGUD",67,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSJLMGUD",68,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;102;PSGODO]""
"RTN","PSJLMGUD",69,0)
33 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSJLMGUD",70,0)
34 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSJLMGUD",71,0)
35 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSJLMGUD",72,0)
36 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSJLMGUD",73,0)
37 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSJLMGUD",74,0)
38 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSJLMGUD",75,0)
39 ;;2^PSGOE82;;;2;0
"RTN","PSJLMGUD",76,0)
310 ;;40^PSGOE82;;;40;0
"RTN","PSJLMGUD",77,0)
311 ;;66^PSGOE82;;;66;1
"RTN","PSJLMGUD",78,0)
312 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSJLMGUD",79,0)
313 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSJLMGUD",80,0)
314 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSJLMGUD",81,0)
 ;
"RTN","PSJLMGUD",82,0)
AH ;
"RTN","PSJLMGUD",83,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSJLMGUD",84,0)
 Q
"RTN","PSJLMUDE")
0^89^B58744268
"RTN","PSJLMUDE",1,0)
PSJLMUDE ;BIR/MLM-SHOW FIELDS FOR EDIT (LISTMAN STYLE) ;01 JUNE 00 / 2:40 PM
"RTN","PSJLMUDE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,47,50,63,64,58,80,116,110,111**;16 DEC 97
"RTN","PSJLMUDE",3,0)
  ;NFI-UD Fr#:2 chgs@init+4 to display non-formulary (N/F)
"RTN","PSJLMUDE",4,0)
  ;also chgs @init+23
"RTN","PSJLMUDE",5,0)
 ;
"RTN","PSJLMUDE",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJLMUDE",7,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192
"RTN","PSJLMUDE",8,0)
 ;
"RTN","PSJLMUDE",9,0)
INIT(PSGP,PSGORD) ;
"RTN","PSJLMUDE",10,0)
 N D,ND,PSJBCMA,PSJL,PSJLM,PSJLN,Q,QQ,PSJDUR K ^TMP("PSJUDE",$J)
"RTN","PSJLMUDE",11,0)
 K:$G(PSJNORD) PSGOEEF S PSJLN=1
"RTN","PSJLMUDE",12,0)
 D CLEAN^VALM10
"RTN","PSJLMUDE",13,0)
 S PSJL=$S($D(PSGEFN(1)):$E(" *",PSGEFN(1)+1)_"(1)",1:"   "),PSJL=$$SETSTR^VALM1("Orderable Item: "_PSGPDN_$$OINF^PSJDIN(PSGPD),PSJL,5,74) D  D SETTMP D:$G(PSGOEEF(108))!($G(PSGOEEF(101))) HILITE(1)
"RTN","PSJLMUDE",14,0)
 . NEW Q,PSJDDA,PSJVD F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S PSJDDA(+$G(^(Q,0)))=""
"RTN","PSJLMUDE",15,0)
 . S PSJVD=$$DINFLUD^PSJDIN(PSGPD,.PSJDDA)
"RTN","PSJLMUDE",16,0)
 . S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,75,80)
"RTN","PSJLMUDE",17,0)
 . D:PSJVD]"" CNTRL^VALM10(1,75,5,IORVON,IORVOFF,0)
"RTN","PSJLMUDE",18,0)
 I $G(PSJORD)["P" D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJLMUDE",19,0)
 S PSJL="Instructions: "_PSGOINST D PTXT^PSJLMPRU(PSJL,"PSJUDE",6,80)
"RTN","PSJLMUDE",20,0)
 S PSJL=$S($D(PSGEFN(2)):$E(" *",PSGEFN(2)+1)_"(2)",1:"    "),PSJL=$$SETSTR^VALM1("Dosage Ordered: "_PSGDO,PSJL,5,76) D SETTMP D:$G(PSGOEEF(109)) HILITE(2)
"RTN","PSJLMUDE",21,0)
 I $G(PSGRDTX) S PSJDUR=$$FMTDUR^PSJLIVMD($P($G(PSGRDTX),U,2))
"RTN","PSJLMUDE",22,0)
 I $G(PSJORD),($G(PSJDUR)="") S P=$S(PSJORD["U":5,PSJORD["V":"IV",PSJORD["P":"P",1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,P)
"RTN","PSJLMUDE",23,0)
 S PSJL=$$SETSTR^VALM1("Duration: "_$G(PSJDUR),PSJL,11,25)
"RTN","PSJLMUDE",24,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_$P(PSGSDN,U,2),PSJL,54,26) D:$G(PSGOEEF(10)) HILITE(3)
"RTN","PSJLMUDE",25,0)
 I $G(PSGORD)["P" N ND0,OLDO S ND0=@(PSGOEEWF_"0)") I $P(ND0,"^",24)="R" S OLDO=$P(ND0,"^",25) I OLDO,(OLDO["U") D
"RTN","PSJLMUDE",26,0)
 . N OSTRT,OSTRTN S OSTRT=$G(@("^PS(55,"_PSGP_",5,"_+OLDO_",2)")),OSTRT=$P(OSTRT,"^",2) Q:'OSTRT  S OSTRTN=$$ENDTC^PSGMI(+OSTRT)
"RTN","PSJLMUDE",27,0)
 . S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_OSTRTN,PSJL,54,26)
"RTN","PSJLMUDE",28,0)
 D SETTMP
"RTN","PSJLMUDE",29,0)
 S PSJL=$S($D(PSGEFN(4)):$E(" *",PSGEFN(4)+1)_"(4)",1:"    "),PSJL=$$SETSTR^VALM1("Med Route: "_PSGMRN,PSJL,10,35) D:$G(PSGOEEF(3)) HILITE(4)
"RTN","PSJLMUDE",30,0)
 I $G(PSJORD)["P" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,PSGORD) S:PSGRNDT PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",31,0)
 I '$G(PSGRNDT),$G(PSGRDTX) D
"RTN","PSJLMUDE",32,0)
 . I $D(PSGRDTX)<10 S PSGRSDN=$$ENDTC^PSGMI(+PSGRDTX),PSJL=$$SETSTR^VALM1("REQUESTED START: "_PSGRSDN,PSJL,48,32) Q
"RTN","PSJLMUDE",33,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$P($G(PSGSDN),U,2) S PSGRSDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRSD")),PSJL=$$SETSTR^VALM1("Calc Start: "_PSGRSDN,PSJL,53,32) D
"RTN","PSJLMUDE",34,0)
 .. I PSGSD'=PSGRDTX(+PSJORD,"PSGRSD") D CNTRL^VALM10(5,53,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",35,0)
 ; Indirect reference in PSGOEEWF below refers to either ^PS(53.1 or ^PS(55,DFN,5,. Naked reference refers to full indirect reference
"RTN","PSJLMUDE",36,0)
 I $G(PSJORD)["U" N ND14 S ND14=$G(@(PSGOEEWF_"14,0)")) I ND14]"" S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^") I RNDT D
"RTN","PSJLMUDE",37,0)
 . N PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+RNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",38,0)
 D SETTMP
"RTN","PSJLMUDE",39,0)
 I PSGORD]"" S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSGORD)
"RTN","PSJLMUDE",40,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLMUDE",41,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(5)):$E(" *",PSGEFN(5)+1)_"(5)",1:"     ")_" Stop: "_$P(PSGFDN,U,2),PSJL,54,26) D SETTMP D:$G(PSGOEEF(25))!($G(PSGOEEF(34))) HILITE(5)
"RTN","PSJLMUDE",42,0)
 S PSJL=$S($D(PSGEFN(6)):$E(" *",PSGEFN(6)+1)_"(6)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule Type: "_PSGSTN,PSJL,6,45) D:$G(PSGOEEF(7)) HILITE(6)
"RTN","PSJLMUDE",43,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$P($G(PSGFDN),U,2) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")),PSJL=$$SETSTR^VALM1("Calc Stop: "_PSGRFDN,PSJL,54,26) D
"RTN","PSJLMUDE",44,0)
 . I PSGFD'=PSGRDTX(+PSJORD,"PSGRFD") D CNTRL^VALM10(7,54,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",45,0)
 D SETTMP
"RTN","PSJLMUDE",46,0)
 S PSGSMN=$P("NO^YES",U,PSGSM+1)
"RTN","PSJLMUDE",47,0)
 S PSJL=$S($D(PSGEFN(8)):$E(" *",PSGEFN(8)+1)_"(8)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule: "_PSGSCH_$G(SCHMSG),PSJL,11,68) D SETTMP D:$G(PSGOEEF(26)) HILITE(8)
"RTN","PSJLMUDE",48,0)
 S PSJL=$S($D(PSGEFN(9)):$E(" *",PSGEFN(9)+1)_"(9)",1:"   "),PSJL=$$SETSTR^VALM1("Admin Times: "_PSGAT,PSJL,8,71) D SETTMP D:$G(PSGOEEF(39))!($G(PSGOEEF(41))) HILITE(9)
"RTN","PSJLMUDE",49,0)
 S PSJL=$S($D(PSGEFN(10)):$E(" *",PSGEFN(10)+1)_"(10)",1:"   "),PSJL=$$SETSTR^VALM1("Provider: "_PSGPRN,PSJL,11,68) D:$G(PSGOEEF(1)) HILITE(10) D SETTMP
"RTN","PSJLMUDE",50,0)
 ;S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"   ")_"Self Med: "_PSGSMN,PSJL,56,24) S:PSGSM&PSGHSM PSJL=$$SETSTR^VALM1("  (HS)",PSJL,71,7) D SETTMP D:$G(PSGOEEF(5)) HILITE(7)
"RTN","PSJLMUDE",51,0)
 S PSJL=$S($D(PSGEFN(11)):$E(" *",PSGEFN(11))_"(11)",1:"   ")_" Special Instructions"_$S($P(PSGSI,"^",2)=1:"!: ",1:": ")_$P(PSGSI,"^") D PTXT^PSJLMPRU(PSJL,"PSJUDE",1,80)
"RTN","PSJLMUDE",52,0)
 S PSJL="" D SETTMP D:$G(PSGOEEF(8)) HILITE(11)
"RTN","PSJLMUDE",53,0)
 ; E3R 16130
"RTN","PSJLMUDE",54,0)
 I $O(^PS(53.45,PSJSYSP,2,1)) F  S PSJL="" D SETTMP Q:PSJLN>15
"RTN","PSJLMUDE",55,0)
 S PSJL=$S($D(PSGEFN(12)):$E(" *",PSGEFN(12))_" (12)",1:"   ")_" Dispense Drug",PSJL=$$SETSTR^VALM1("U/D",PSJL,54,60),PSJL=$$SETSTR^VALM1("Inactive Date",PSJL,65,16) D SETTMP,CNTRL^VALM10(13,1,80,IOUON,IOUOFF,0)
"RTN","PSJLMUDE",56,0)
 ;S $P(PSJL,"-",80)="" D SETTMP
"RTN","PSJLMUDE",57,0)
 NEW PSJX
"RTN","PSJLMUDE",58,0)
 F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S ND=$G(^(Q,0)) D
"RTN","PSJLMUDE",59,0)
 .S D=$P(ND,"^"),PSGID=$P(ND,"^",3) I PSGID S PSGID=$$ENDTC^PSGMI(PSGID)
"RTN","PSJLMUDE",60,0)
 .S D=$S(D="":"NOT FOUND",'$D(^PSDRUG(D,0)):D,$P(^(0),"^")]"":$P(^(0),"^"),1:D_";PSDRUG(")
"RTN","PSJLMUDE",61,0)
 .S PSJL="      "_D_$$DDNF^PSJDIN(+ND),PSJL=$$SETSTR^VALM1($S($P(ND,"^",2):$S($P(ND,"^",2)=.5:"1/2",$P(ND,"^",2)=.25:"1/4",1:$P(ND,"^",2)),1:1),PSJL,54,63) S:PSGID PSJL=$$SETSTR^VALM1(PSGID,PSJL,65,16) D  D SETTMP
"RTN","PSJLMUDE",62,0)
 ..S PSJX=$G(PSJX)+1
"RTN","PSJLMUDE",63,0)
 ..I $G(PSGOEEF(109)) D CNTRL^VALM10(13+PSJX,7,73,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",64,0)
 I $S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,0)),1:$O(^PS(55,PSGP,5,+PSGORD,12,0))) S PSJL="Provider Comments:" D SETTMP S PSJL="" D
"RTN","PSJLMUDE",65,0)
 .F Q=0:0 S Q=$S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,Q)),1:$O(^PS(55,PSGP,5,+PSGORD,12,Q))) Q:'Q  S PSJL=$G(^(Q,0)) D SETTMP
"RTN","PSJLMUDE",66,0)
 D SETTMP S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"   ")_"Self Med: "_PSGSMN,PSJL,1,24)
"RTN","PSJLMUDE",67,0)
 S:PSGSM&PSGHSM PSJL=$$SETSTR^VALM1("  (HS)",PSJL,16,7) D SETTMP D:$G(PSGOEEF(5)) HILITE(7)
"RTN","PSJLMUDE",68,0)
 D SETTMP S PSJL="Entry By: "_PSGEBN,PSJL=$$SETSTR^VALM1("Entry Date: "_$P(PSGLIN,U,2),PSJL,51,39) D SETTMP
"RTN","PSJLMUDE",69,0)
 I $G(PSGLRN) D SETTMP S PSJL="Renewed By: "_$$ENNPN^PSGMI($P(PSGLRN,"^",2)) D SETTMP
"RTN","PSJLMUDE",70,0)
 D SETTMP S PSJL="(13)"_" Comments:"
"RTN","PSJLMUDE",71,0)
 D:'$O(^PS(53.45,PSJSYSP,1,0)) SETTMP
"RTN","PSJLMUDE",72,0)
 D SETTMP F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S PSJWPL=PSJL_$S($E(PSJL)=" ":"",1:" ")_$G(^(Q,0)),PSJL="" D DISPLAY
"RTN","PSJLMUDE",73,0)
 D SETTMP
"RTN","PSJLMUDE",74,0)
 I PSGORD["P",($P($G(^PS(53.1,+PSGORD,0)),U,9)="P"),$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSJLMUDE",75,0)
 .D SETTMP S PSJL="Order Checks:" D SETTMP
"RTN","PSJLMUDE",76,0)
 .F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,10,Q)) Q:'Q  D
"RTN","PSJLMUDE",77,0)
 ..S PSJL="" D SETTMP S PSJL=$G(^PS(53.1,+PSGORD,10,Q,0)) D SETTMP
"RTN","PSJLMUDE",78,0)
 ..S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+PSGORD,10,Q,1)),U) D SETTMP
"RTN","PSJLMUDE",79,0)
 ..S PSJL="Overriding Reason: " F X=0:0 S X=$O(^PS(53.1,+PSGORD,10,Q,2,X)) Q:'X   D
"RTN","PSJLMUDE",80,0)
 ...S PSJL=PSJL_$G(^PS(53.1,+PSGORD,10,Q,2,X,0)) D SETTMP S PSJL="                   "
"RTN","PSJLMUDE",81,0)
ACTFLG ;
"RTN","PSJLMUDE",82,0)
 S ND4=$S(PSGORD["P":$G(^PS(53.1,+PSGORD,4)),1:$G(^PS(55,PSGP,5,+PSGORD,4)))
"RTN","PSJLMUDE",83,0)
 S AT="",Y="12,13,D,18,19,H1,22,23,H0,15,16,R" F X=1:3:12 I $P(ND4,"^",$P(Y,",",X)),$P(ND4,"^",$P(Y,",",X+1)) S AT=$P(Y,",",X+2) Q
"RTN","PSJLMUDE",84,0)
 I AT="",'$P(ND4,"^",$S($P(PSJSYSU,";",3)>1:3,1:1)) S AT="V"_$S($P(ND4,"^",18):"H1",$P(ND4,"^",22):"H0",$P(ND4,"^",15):"R",1:"")
"RTN","PSJLMUDE",85,0)
 I AT]"" D
"RTN","PSJLMUDE",86,0)
 .S PSJL="" D SETTMP
"RTN","PSJLMUDE",87,0)
 .S PSJL="ORDER "_$S(AT["V":"NOT VERIFIED"_$S($P(AT,"V",2)="":"",1:" ("_$S(AT["H1":"ON HOLD",AT["H0":"OFF HOLD",1:"RENEWAL")_")"),1:"MARKED TO BE "_$S(AT["D":"CANCELLED",AT["H1":"PLACED ON HOLD",AT["H0":"TAKEN OFF OF HOLD",1:"RENEWED"))
"RTN","PSJLMUDE",88,0)
 I AT'["V",AT["H1",$D(^PS(55,PSGP,5.1)) S AT=^(5.1) I $P(AT,"^",7),$P(AT,"^",10)]"" S PSJL=PSJL_"  ("_$P(AT,"^",10)_")"
"RTN","PSJLMUDE",89,0)
 D SETTMP
"RTN","PSJLMUDE",90,0)
 S VALMCNT=PSJLN-1
"RTN","PSJLMUDE",91,0)
 K PSGSMN,Q,Y,Y1,Y2,PSGLRN
"RTN","PSJLMUDE",92,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S((PSGSTAT="PENDING")&($G(PSGPRIO)]""):"("_PSGPRIO_")",$G(PSGPRIO)="DONE":"("_PSGPRIO_")",1:"") I $D(PSJLMP2) S VALMBG=16 K PSJLMP2
"RTN","PSJLMUDE",93,0)
TEST ;
"RTN","PSJLMUDE",94,0)
 I $G(PSGPFLG) S VALMSG="INVALID ORDERABLE ITEM"
"RTN","PSJLMUDE",95,0)
 I $G(PSGDI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" DISPENSE DRUG"
"RTN","PSJLMUDE",96,0)
 I $G(PSGPI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" PROVIDER"
"RTN","PSJLMUDE",97,0)
 Q
"RTN","PSJLMUDE",98,0)
DISPLAY ;
"RTN","PSJLMUDE",99,0)
 S PSJL=PSJWPL D SETTMP
"RTN","PSJLMUDE",100,0)
 ;F X=1:1 S WRD=$P(PSJWPL," ",X) Q:WRD=""  D
"RTN","PSJLMUDE",101,0)
 ;.I $L(PSJL_" "_WRD)'<80 D SETTMP S PSJL=$P(PSJWPL,PSJL,2) S:$E(PSJL,1)=" " PSJL=$E(PSJL,2,999),PSJWPL="" Q
"RTN","PSJLMUDE",102,0)
 ;.S PSJL=PSJL_$S(PSJL="":"",1:" ")_WRD
"RTN","PSJLMUDE",103,0)
 Q
"RTN","PSJLMUDE",104,0)
 ;
"RTN","PSJLMUDE",105,0)
SETTMP ;
"RTN","PSJLMUDE",106,0)
 S ^TMP("PSJUDE",$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1,PSJL=""
"RTN","PSJLMUDE",107,0)
 Q
"RTN","PSJLMUDE",108,0)
 ;
"RTN","PSJLMUDE",109,0)
HILITE(FLD) ; 
"RTN","PSJLMUDE",110,0)
 N COL,LIN,WID,X
"RTN","PSJLMUDE",111,0)
 ;Q:'$G(PSGOEENO)
"RTN","PSJLMUDE",112,0)
 S X="$T("_FLD_"^PSJLMUDE)",@("X="_X),X=$P(X,";;",2),LIN=+X,COL=$P(X,",",2),LAB=$P(X,",",3),X=$P(X,",",4),WID=(LAB+$L(@X))
"RTN","PSJLMUDE",113,0)
 ;D CNTRL^VALM10(LIN,COL,WID,IORVON_IOBON,IOINORM,0)
"RTN","PSJLMUDE",114,0)
 I FLD=7 S LIN=+$G(PSJLN)-1 Q:LIN<13
"RTN","PSJLMUDE",115,0)
 D CNTRL^VALM10(LIN,COL,WID,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",116,0)
 Q
"RTN","PSJLMUDE",117,0)
 ;
"RTN","PSJLMUDE",118,0)
1 ;;1,5,16,PSGPDN
"RTN","PSJLMUDE",119,0)
2 ;;3,5,16,PSGDO
"RTN","PSJLMUDE",120,0)
3 ;;4,58,7,PSGSDN
"RTN","PSJLMUDE",121,0)
4 ;;5,10,11,PSGMRN
"RTN","PSJLMUDE",122,0)
5 ;;6,59,6,PSGFDN
"RTN","PSJLMUDE",123,0)
6 ;;7,6,15,PSGSTN
"RTN","PSJLMUDE",124,0)
7 ;;18,5,14,PSGSMN
"RTN","PSJLMUDE",125,0)
8 ;;8,11,12,PSGSCH
"RTN","PSJLMUDE",126,0)
9 ;;9,8,13,PSGAT
"RTN","PSJLMUDE",127,0)
10 ;;10,11,10,PSGPRN
"RTN","PSJLMUDE",128,0)
11 ;;11,7,22,PSGSI
"RTN","PSJLMUDE",129,0)
ENKILL ;
"RTN","PSJLMUDE",130,0)
 K PSGAT,PSGEB,PSGEFN,PSGFD,PSGHSM,PSGNEFD,PSGNESD,PSGOEEF,PSGOEER,PSGOFD,PSGOHSM,PSGOMR,PSGOMRN,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGOSD,PSGOSM,PSGOST,PSGPD,PSGPDN,PSGPR,PSGSD,PSGSM Q
"RTN","PSJLMUTL")
0^33^B55430088
"RTN","PSJLMUTL",1,0)
PSJLMUTL ;BIR/MLM-INPATIENT LISTMAN UTILITIES ;29 May 98 / 8:35 AM
"RTN","PSJLMUTL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,67,58,85,111**;16 DEC 97
"RTN","PSJLMUTL",3,0)
 ;
"RTN","PSJLMUTL",4,0)
 ; Reference to ^ORD(101 is supported by DBIA #872.
"RTN","PSJLMUTL",5,0)
 ; Reference to ^PS(50.606 is supported by DBIA #2174.
"RTN","PSJLMUTL",6,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSJLMUTL",7,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJLMUTL",8,0)
 ; Reference to ^PSDRUG is supported by DBIA #2192.
"RTN","PSJLMUTL",9,0)
 ; Reference to ^GMRAPEM0 is supported by DBIA #190.
"RTN","PSJLMUTL",10,0)
 ; Reference to ^SDAMA203 is supported by DBIA #4133.
"RTN","PSJLMUTL",11,0)
 ; Reference to ^VSIT is supported by DBIA #1905.
"RTN","PSJLMUTL",12,0)
 ;
"RTN","PSJLMUTL",13,0)
NEWALL(DFN) ; Enter Allergy info.
"RTN","PSJLMUTL",14,0)
 ;
"RTN","PSJLMUTL",15,0)
 D FULL^VALM1,EN2^GMRAPEM0
"RTN","PSJLMUTL",16,0)
 Q
"RTN","PSJLMUTL",17,0)
DISALL(DFN) ; Display brief patient info list.
"RTN","PSJLMUTL",18,0)
 K ^TMP("PSJALL",$J) N PSJLN,X,Y,PSGALG,PSGLDR,PSJGMRAL,PSJWHERE S PSJWHERE="PSJLMUTL"
"RTN","PSJLMUTL",19,0)
 D ATS^PSJMUTL(57,57,2)
"RTN","PSJLMUTL",20,0)
 I (PSJGMRAL=0) S ^TMP("PSJALL",$J,1,0)=" Allergies/Reactions: "_"NKA",PSJLN=2 G NARRATIV
"RTN","PSJLMUTL",21,0)
 I (PSJGMRAL="") S ^TMP("PSJALL",$J,1,0)=" Allergies/Reactions: No Allergy Assessment",PSJLN=2 G NARRATIV
"RTN","PSJLMUTL",22,0)
 I ($G(PSGVALG(1))="NKA")!((PSGVALG=0)&(PSGALG=0)) D
"RTN","PSJLMUTL",23,0)
 .S ^TMP("PSJALL",$J,1,0)="           Allergies: "_$G(PSGVALG(1)),PSJLN=2,X=1
"RTN","PSJLMUTL",24,0)
 I ($G(PSGVALG(1))'="NKA")&((PSGVALG>0)!(PSGALG>0)) D
"RTN","PSJLMUTL",25,0)
 .S ^TMP("PSJALL",$J,1,0)="Allergies - Verified: "_$G(PSGVALG(1)),PSJLN=2,X=1
"RTN","PSJLMUTL",26,0)
 .F  S X=$O(PSGVALG(X)) Q:'X  S ^TMP("PSJALL",$J,PSJLN,0)="                        "_PSGVALG(X),PSJLN=PSJLN+1
"RTN","PSJLMUTL",27,0)
 .S ^TMP("PSJALL",$J,PSJLN,0)="        Non-Verified: "_$S($G(PSGALG(1))=0:"",1:$G(PSGALG(1))),PSJLN=PSJLN+1,X=1
"RTN","PSJLMUTL",28,0)
 .F  S X=$O(PSGALG(X)) Q:'X  S ^TMP("PSJALL",$J,PSJLN,0)="                        "_PSGALG(X),PSJLN=PSJLN+1
"RTN","PSJLMUTL",29,0)
 I ($G(PSGVADR(1))="NKA")!((PSGVADR=0)&(PSGADR=0)) D
"RTN","PSJLMUTL",30,0)
 .S ^TMP("PSJALL",$J,PSJLN,0)="",^TMP("PSJALL",$J,PSJLN+1,0)="   Adverse Reactions: "_$G(PSGADR(1)),PSJLN=PSJLN+2,X=1
"RTN","PSJLMUTL",31,0)
 I ($G(PSGVADR(1))'="NKA")&((PSGVADR>0)!(PSGADR>0)) D
"RTN","PSJLMUTL",32,0)
 .S ^TMP("PSJALL",$J,PSJLN,0)="",^TMP("PSJALL",$J,PSJLN+1,0)="Reactions - Verified: "_$G(PSGVADR(1)),PSJLN=PSJLN+2,X=1
"RTN","PSJLMUTL",33,0)
 .F  S X=$O(PSGVADR(X)) Q:'X  S ^TMP("PSJALL",$J,PSJLN,0)="              "_PSGVADR(X),PSJLN=PSJLN+1
"RTN","PSJLMUTL",34,0)
 .S ^TMP("PSJALL",$J,PSJLN,0)="        Non-Verified: "_$G(PSGADR(1)),PSJLN=PSJLN+2,X=1
"RTN","PSJLMUTL",35,0)
 .F  S X=$O(PSGADR(X)) Q:'X  S ^TMP("PSJALL",$J,PSJLN,0)="              "_PSGADR(X),PSJLN=PSJLN+1
"RTN","PSJLMUTL",36,0)
 ;
"RTN","PSJLMUTL",37,0)
NARRATIV ; print inpatient/outpatient narratives
"RTN","PSJLMUTL",38,0)
 N PSJCLHD
"RTN","PSJLMUTL",39,0)
 S ^TMP("PSJALL",$J,PSJLN,0)="" D SETNAR("PSJALL",$G(^PS(55,DFN,5.3)),"In")
"RTN","PSJLMUTL",40,0)
 S ^TMP("PSJALL",$J,PSJLN+1,0)="" D SETNAR("PSJALL",$G(^PS(55,DFN,1)),"Out")
"RTN","PSJLMUTL",41,0)
 ;S PSJLN=PSJLN+4 D SETNAR("PSJALL",$G(^PS(55,DFN,1)),"Out")
"RTN","PSJLMUTL",42,0)
 D SDA S PSJLN=0 F X=0:0 S X=$O(^TMP("PSJALL",$J,X)) Q:'X  S PSJLN=PSJLN+1
"RTN","PSJLMUTL",43,0)
 I '$G(PSJCLHD)!'$G(VALMCNT) S VALMCNT=PSJLN
"RTN","PSJLMUTL",44,0)
 Q
"RTN","PSJLMUTL",45,0)
 ;
"RTN","PSJLMUTL",46,0)
SDA N PSJPAD,PSJCLIN,PSJCLINO,PSJAPD,PSJSCI,PSJCLOK,VAERR K ^TMP("PSJVSIT"),PSJDBUN S $P(PSJPAD," ",26)=" "
"RTN","PSJLMUTL",47,0)
 Q:'$$PATCH^XPDUTL("SD*5.3*285")
"RTN","PSJLMUTL",48,0)
 D NOW^%DTC S VASD("F")=$P(%,".")-1
"RTN","PSJLMUTL",49,0)
 D SDA^VADPT S:$G(VAERR)=2 (PSJCLHD,PSJDBUN)=2 I $O(^UTILITY("VASD",$J,"")) M PSJUTL=^UTILITY("VASD",$J) D
"RTN","PSJLMUTL",50,0)
 . S PSJSCDT0=0
"RTN","PSJLMUTL",51,0)
 . F  S PSJSCDT0=$O(PSJUTL(PSJSCDT0)) Q:'PSJSCDT0  D
"RTN","PSJLMUTL",52,0)
 .. S PSJCLINO=$P($G(PSJUTL(PSJSCDT0,"E")),U,2),PSJCLIN=$P($G(PSJUTL(PSJSCDT0,"I")),U,2)
"RTN","PSJLMUTL",53,0)
 .. S PSJSCI=$G(PSJUTL(PSJSCDT0,"I")),PSJAPD=$$FMTE^XLFDT(+PSJSCI) Q:(PSJCLIN="")!(PSJAPD="")
"RTN","PSJLMUTL",54,0)
 .. S PSJCLOK=1 D SDAUTHCL^SDAMA203(PSJCLIN,.PSJCLOK) Q:(PSJCLOK<1)
"RTN","PSJLMUTL",55,0)
 .. S ^TMP("PSJVSIT",$J,+PSJSCI,PSJCLIN,"V")=$E(PSJCLINO_PSJPAD,1,25)_"  "_$TR(PSJAPD,"@","/"),PSJCLHD=1
"RTN","PSJLMUTL",56,0)
 .. D ENC(DFN,PSJCLIN)
"RTN","PSJLMUTL",57,0)
 I $G(PSJCLHD) S PSJLN=PSJLN+1 S ^TMP("PSJALL",$J,PSJLN,0)="Clinic:"_$E(PSJPAD,1,20)_"Date/Time of Appointment:",PSJLN=PSJLN+1 I $G(PSJCLHD)=2 D
"RTN","PSJLMUTL",58,0)
 . S ^TMP("PSJALL",$J,PSJLN,0)=" Scheduling database is unavailable",PSJLN=PSJLN+1
"RTN","PSJLMUTL",59,0)
 N VDAT S VDAT=0 F  S VDAT=$O(^TMP("PSJVSIT",$J,VDAT)) Q:'VDAT  S VCLIN=0 F  S VCLIN=$O(^TMP("PSJVSIT",$J,VDAT,VCLIN)) Q:'VCLIN  D
"RTN","PSJLMUTL",60,0)
 . F VTYP="E","V" S VDATA=$G(^TMP("PSJVSIT",$J,VDAT,VCLIN,VTYP)) I VDATA]"" S ^TMP("PSJALL",$J,PSJLN,0)=VDATA,PSJLN=PSJLN+1
"RTN","PSJLMUTL",61,0)
 I $G(PSJCLHD) S VALMCNT=((PSJLN+11\11)*11),PSJX=$O(^TMP("PSJALL",$J,9999),-1) ; F I=PSJX:1:VALMCNT S ^TMP("PSJALL",$J,I,0)=""
"RTN","PSJLMUTL",62,0)
 K PSJUTL,PSJCLHD
"RTN","PSJLMUTL",63,0)
 Q
"RTN","PSJLMUTL",64,0)
 ;
"RTN","PSJLMUTL",65,0)
ENC(SDPATDFN,SDCLIEN) ;
"RTN","PSJLMUTL",66,0)
 N SDFROM,DT,SUBVIS,VIS S SDSTART=$$FMADD^XLFDT($P(PSGDT,"."),-1),SDEND=$$FMADD^XLFDT($P(PSGDT,"."),+365) K ^TMP("VSIT",$J)
"RTN","PSJLMUTL",67,0)
 D SELECTED^VSIT(SDPATDFN,SDSTART,SDEND,SDCLIEN) N VIS S VIS=0 F  S VIS=$O(^TMP("VSIT",$J,VIS)) Q:'VIS  D
"RTN","PSJLMUTL",68,0)
 . S SUBVIS=0 F  S SUBVIS=$O(^TMP("VSIT",$J,VIS,SUBVIS)) Q:'SUBVIS  D
"RTN","PSJLMUTL",69,0)
 .. S PSJSCI=$P(^TMP("VSIT",$J,VIS,SUBVIS),U),PSJAPD=$$FMTE^XLFDT(PSJSCI,1) Q:PSJSCI<1!(PSJAPD="")
"RTN","PSJLMUTL",70,0)
 .. S ^TMP("PSJVSIT",$J,PSJSCI,PSJCLIN,"E")=$E(PSJCLINO_PSJPAD,1,25)_"  "_$TR(PSJAPD,"@","/")_" *Encounter",PSJCLHD=1
"RTN","PSJLMUTL",71,0)
 ;D SDVISIT^SDAMA203(SDPATDFN,SDCLIEN,$G(PSGDT),1,1,SDFROM)
"RTN","PSJLMUTL",72,0)
 Q
"RTN","PSJLMUTL",73,0)
 ;
"RTN","PSJLMUTL",74,0)
SETNAR(SUB,NARR,TYPE) ; Set up Narrative info.
"RTN","PSJLMUTL",75,0)
 S NARR=TYPE_"patient Narrative: "_NARR,Y="" S:TYPE="In" NARR=" "_NARR
"RTN","PSJLMUTL",76,0)
 S START=1 F  D  Q:NARR=""
"RTN","PSJLMUTL",77,0)
 .I $L($P(NARR," "))>79 S PSJ=$E(NARR,START,START+79),NARR=$E(NARR,START+80,$L(NARR)) Q
"RTN","PSJLMUTL",78,0)
 .I $L(NARR)>79 S PSJ=$P(NARR," ",1,$L($E(NARR,1,80)," ")-1),NARR=$E($P(NARR,PSJ,2),2,$L(NARR)) D SET Q
"RTN","PSJLMUTL",79,0)
 .S PSJ=NARR,NARR="" D SET
"RTN","PSJLMUTL",80,0)
 Q
"RTN","PSJLMUTL",81,0)
 ;
"RTN","PSJLMUTL",82,0)
SET ; Set ^TMP for narratives.
"RTN","PSJLMUTL",83,0)
 S ^TMP(SUB,$J,PSJLN,0)=PSJ,PSJLN=PSJLN+1
"RTN","PSJLMUTL",84,0)
 Q
"RTN","PSJLMUTL",85,0)
 ;
"RTN","PSJLMUTL",86,0)
ACTIONS() ;
"RTN","PSJLMUTL",87,0)
 N DIC,X,Y
"RTN","PSJLMUTL",88,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLMUTL",89,0)
 I Y="PSJ LM DC" Q $S(PSGACT["D":1,1:0)
"RTN","PSJLMUTL",90,0)
 I Y="PSJU LM EDIT" Q $S(PSGACT["E":1,1:0)
"RTN","PSJLMUTL",91,0)
 I Y="PSJU LM RENEW" Q $S(PSGACT["R":1,1:0)
"RTN","PSJLMUTL",92,0)
 I Y="PSJ LM HOLD" Q $S(PSGACT["H":1,1:0)
"RTN","PSJLMUTL",93,0)
 I Y="PSJU LM VERIFY" Q $S(PSGACT["V":1,1:0)
"RTN","PSJLMUTL",94,0)
 I Y="PSJ LM EDIT NEW" Q $S(PSGACT["E":1,1:0)
"RTN","PSJLMUTL",95,0)
 I Y="PSJ LM FLAG" Q $S(PSGACT["G":1,1:0)
"RTN","PSJLMUTL",96,0)
 Q 1
"RTN","PSJLMUTL",97,0)
RNACT() ;
"RTN","PSJLMUTL",98,0)
 I '$G(PSJRNF),'$G(PSJIRNF) Q 0
"RTN","PSJLMUTL",99,0)
 NEW X S X=$G(^PS(53.1,+PSJORD,0))
"RTN","PSJLMUTL",100,0)
 S PSGACT=""
"RTN","PSJLMUTL",101,0)
 I $S(+$P(X,U,13):1,$G(PSJRNF)&($P(X,U,4)="U"):1,$G(PSJIRNF)&($P(X,U,4)'="U"):1,1:0) S PSGACT="BFDE"
"RTN","PSJLMUTL",102,0)
 NEW X,Y
"RTN","PSJLMUTL",103,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLMUTL",104,0)
 I Y="PSJ LM DC" Q $S(PSGACT["D":1,1:0)
"RTN","PSJLMUTL",105,0)
 I Y="PSJ LM BYPASS" Q $S(PSGACT["B":1,1:0)
"RTN","PSJLMUTL",106,0)
 I Y="PSJ LM FINISH" Q $S(PSGACT["F":1,1:0)
"RTN","PSJLMUTL",107,0)
 I Y="PSJI LM DISCONTINUE" Q $S(PSGACT["D":1,1:0)
"RTN","PSJLMUTL",108,0)
 I Y="PSJI LM EDIT" Q $S(PSGACT["E":1,1:0)
"RTN","PSJLMUTL",109,0)
 I Y="PSJI LM FINISH" Q $S(PSGACT["F":1,1:0)
"RTN","PSJLMUTL",110,0)
 I Y="PSJ LM FLAG" Q 0
"RTN","PSJLMUTL",111,0)
 Q 1
"RTN","PSJLMUTL",112,0)
 ;
"RTN","PSJLMUTL",113,0)
TECHACT() ; Allowable actions for IV technician (PSJI PHARM TECH)
"RTN","PSJLMUTL",114,0)
 Q:'$G(PSJITECH) 0
"RTN","PSJLMUTL",115,0)
 NEW X S X=$G(^PS(53.1,+PSJORD,0))
"RTN","PSJLMUTL",116,0)
 I $S(+$P(X,U,13):1,$P(X,U,4)'="U":1,1:0) S PSGACT="F"
"RTN","PSJLMUTL",117,0)
 N DIC,X,Y
"RTN","PSJLMUTL",118,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLMUTL",119,0)
 I Y="PSJ LM DC" Q $S(PSGACT["D":1,1:0)
"RTN","PSJLMUTL",120,0)
 I Y="PSJ LM BYPASS" Q $S(PSGACT["B":1,1:0)
"RTN","PSJLMUTL",121,0)
 I Y="PSJ LM FINISH" Q $S(PSGACT["F":1,1:0)
"RTN","PSJLMUTL",122,0)
 I Y="PSJI LM DISCONTINUE" Q $S(PSGACT["D":1,1:0)
"RTN","PSJLMUTL",123,0)
 I Y="PSJI LM EDIT" Q $S(PSGACT["E":1,1:0)
"RTN","PSJLMUTL",124,0)
 I Y="PSJI LM FINISH" Q $S(PSGACT["F":1,1:0)
"RTN","PSJLMUTL",125,0)
 I Y="PSJ LM FLAG" Q 0
"RTN","PSJLMUTL",126,0)
 Q 1
"RTN","PSJLMUTL",127,0)
PATINFO()         ; Determines if detailed allergy info can be displayed.
"RTN","PSJLMUTL",128,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLMUTL",129,0)
 ;I Y="PSJ LM DETAILED ALLERGY",'$G(GMRAL) Q 0
"RTN","PSJLMUTL",130,0)
 I Y="PSJ LM SHOW PROFILE",$D(PSJLMPRO) Q 0
"RTN","PSJLMUTL",131,0)
 Q 1
"RTN","PSJLMUTL",132,0)
HIDDEN(CHK) ; Determines if certain Hidden actions are to be available.
"RTN","PSJLMUTL",133,0)
 ;N Y S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLMUTL",134,0)
 ;I Y="PSJ LM PNV JUMP",'$D(PSJPNV) Q 0
"RTN","PSJLMUTL",135,0)
 I CHK="JUMP",'$G(PSJPNV) D NA("Jump is only available through Non-Verified/Pending Orders option.") Q 0
"RTN","PSJLMUTL",136,0)
 I CHK="SPEED",'$D(PSJUDPRF) D NA("Speed options are only available from the Unit Dose Order Entry Profile.") Q 0
"RTN","PSJLMUTL",137,0)
 Q 1
"RTN","PSJLMUTL",138,0)
 ;
"RTN","PSJLMUTL",139,0)
NA(TXT) ;
"RTN","PSJLMUTL",140,0)
 D FULL^VALM1 W !!,TXT,!! N DIR S DIR(0)="E" D ^DIR
"RTN","PSJLMUTL",141,0)
 Q
"RTN","PSJLMUTL",142,0)
 ;
"RTN","PSJLMUTL",143,0)
UPR(DFN)         ; UPDATE PATIENT SPECIFIC DATA IN 55
"RTN","PSJLMUTL",144,0)
 N DIE,DR S PSJC10=VALMCNT
"RTN","PSJLMUTL",145,0)
 S DA=DFN,DIE="^PS(55,",DR="62.2;62.01" D ^DIE,DISALL^PSJLMUTL(DFN)
"RTN","PSJLMUTL",146,0)
 S VALMCNT=PSJC10 K PSJC10
"RTN","PSJLMUTL",147,0)
 Q
"RTN","PSJLMUTL",148,0)
 ;
"RTN","PSJLMUTL",149,0)
DETALL(DFN)        ; Enter Detailed Allergy Display list.
"RTN","PSJLMUTL",150,0)
 ;D EN^VALM("PSJ LM ALLERGY DETAIL"),DISALL^PSJLMUTL(DFN)
"RTN","PSJLMUTL",151,0)
 D EN^VALM("PSJ LM ALLERGY DISPLAY")
"RTN","PSJLMUTL",152,0)
 Q
"RTN","PSJLMUTL",153,0)
BRFALL(DFN)        ;
"RTN","PSJLMUTL",154,0)
 D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSJLMUTL",155,0)
 Q
"RTN","PSJLMUTL",156,0)
PAUSE ;
"RTN","PSJLMUTL",157,0)
 N DIR S DIR(0)="E" D ^DIR
"RTN","PSJLMUTL",158,0)
 Q
"RTN","PSJLMUTL",159,0)
DRUGNAME(DFN,ON) ; Find drug name to display
"RTN","PSJLMUTL",160,0)
 ;If order is in 55:
"RTN","PSJLMUTL",161,0)
 ;.If Dosage Ordered is found, returns OI_U_Dosage Ordered.
"RTN","PSJLMUTL",162,0)
 ;.If no Dosage Ordered, returns Dispense Drug only.
"RTN","PSJLMUTL",163,0)
 ;If order in 53.1:
"RTN","PSJLMUTL",164,0)
 ;.If Dosage Ordered, returns OI_U_Dosage Ordered.
"RTN","PSJLMUTL",165,0)
 ;.If Dispense Drug is found, returns Dispense Drug name_U_Instructions.
"RTN","PSJLMUTL",166,0)
 ;.If no dispense drug, returns OI_U_Instructions.
"RTN","PSJLMUTL",167,0)
 I ON["U" D  Q DN
"RTN","PSJLMUTL",168,0)
 .S OIND=$G(^PS(55,DFN,5,+ON,.2))
"RTN","PSJLMUTL",169,0)
 .I $P(OIND,U,2)]"",($G(^PS(50.7,+OIND,0))]"") S DN=$$OINAME(OIND)_U_.2 Q
"RTN","PSJLMUTL",170,0)
 .S X=+$O(^PS(55,DFN,5,+ON,1,0)),X=$G(^PS(55,DFN,5,+ON,1,X,0)) I $P(X,U)]"" S DN=$$DDNAME(+X)_"^^"_$P(X,"^",2) Q  ;$S($P(OIND,U,2)]"":.2,1:.3) Q
"RTN","PSJLMUTL",171,0)
 .S DN=$$OINAME(+OIND)_U_.3 Q
"RTN","PSJLMUTL",172,0)
 S OIND=$G(^PS(53.1,+ON,.2)) Q:$P(OIND,U,2)]"" $$OINAME(OIND)_U_.2
"RTN","PSJLMUTL",173,0)
 S X=+$O(^PS(53.1,+ON,1,0)) I X,'$O(^PS(53.1,+ON,1,X)) S X=$G(^PS(53.1,+ON,1,X,0)) I $P(X,U)]"" Q $$DDNAME(+X)_U_.3_$P(X,"^",2)
"RTN","PSJLMUTL",174,0)
 Q $$OINAME(OIND)_U_.3
"RTN","PSJLMUTL",175,0)
 ;
"RTN","PSJLMUTL",176,0)
DDNAME(X) ; Return Dispense Drug N$G(PS(53.1,+ON,.3))
"RTN","PSJLMUTL",177,0)
 Q $$FOUND($P($G(^PSDRUG(+X,0)),U),X,"PSDRUG(,")
"RTN","PSJLMUTL",178,0)
 ;
"RTN","PSJLMUTL",179,0)
OINAME(ND) ; Return Orderable Item Name_" "_Dose Form_U_Dosage Ordered
"RTN","PSJLMUTL",180,0)
 N DF,DNME,X
"RTN","PSJLMUTL",181,0)
 S X=$G(^PS(50.7,+ND,0)),DNME="" S:X]"" DF=$P($G(^PS(50.606,+$P(X,U,2),0)),U),DNME=$P(X,U)_" "_DF
"RTN","PSJLMUTL",182,0)
 Q $$FOUND(DNME,+ND,"PS(50.7")
"RTN","PSJLMUTL",183,0)
 ;
"RTN","PSJLMUTL",184,0)
FOUND(DNME,DN,FN) ; Valid Drug Name?
"RTN","PSJLMUTL",185,0)
 Q $S(DNME]"":DNME,1:"NOT FOUND "_DN_";"_FN)
"RTN","PSJMDIR1")
0^18^B4827032
"RTN","PSJMDIR1",1,0)
PSJMDIR1 ;BIR/MV-MED DUE WORKSHEET DIR CALLS CONT. ;17 JUN 96 / 1:40 PM
"RTN","PSJMDIR1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**111**;16 DEC 97
"RTN","PSJMDIR1",3,0)
 ;
"RTN","PSJMDIR1",4,0)
GWP(PSJMDWS) ;*** Ask for seletion from WARD GROUP,WARD,PATIENT
"RTN","PSJMDIR1",5,0)
 ;PSJMDWS=1 when called by Med Due Work Sheet function.
"RTN","PSJMDIR1",6,0)
 K DIR S DIR(0)="SAO^G:Ward Group;W:Ward;P:Patient",DIR("A")="Select by WARD GROUP (G), WARD (W), or PATIENT (P): "
"RTN","PSJMDIR1",7,0)
 S DIR("?")="To select by PATIENT, enter a 'P'."
"RTN","PSJMDIR1",8,0)
 S DIR("?",1)="To select the entire WARD GROUP, enter a 'G'."
"RTN","PSJMDIR1",9,0)
 S DIR("?",2)="To select a single WARD, enter a 'W'."
"RTN","PSJMDIR1",10,0)
 W !! D ^DIR S PSJSTOP=$S(Y="":1,Y<0:1,$$STOP:1,1:0)
"RTN","PSJMDIR1",11,0)
 I 'PSJSTOP S PSGSS=Y D @Y
"RTN","PSJMDIR1",12,0)
 Q PSJSTOP
"RTN","PSJMDIR1",13,0)
 ;
"RTN","PSJMDIR1",14,0)
P ;*** Select by Patient
"RTN","PSJMDIR1",15,0)
 ;
"RTN","PSJMDIR1",16,0)
 N PSJACNWP,PSGDICA,PAGPAT S PSJACNWP=""
"RTN","PSJMDIR1",17,0)
 F PFLG=0:1 S:PFLG PSGDICA="another" D ^PSJMP Q:PSGP<0  S PSGPAT(PPN)=PSGP I $G(PSJMDWS) S:'$G(PSJPWDO) (PSGWD,PSJPWDO)=PSJPWD S PSGWD=$S('$G(PSGWD):0,PSJPWDO=PSJPWD:PSJPWD,1:0)
"RTN","PSJMDIR1",18,0)
 S PSJSTOP=$S($D(DTOUT):1,$D(DUOUT):1,(Y<0)&'$D(PSGDICA):1,1:0)
"RTN","PSJMDIR1",19,0)
 Q
"RTN","PSJMDIR1",20,0)
 ;
"RTN","PSJMDIR1",21,0)
W ;*** Select by WARD
"RTN","PSJMDIR1",22,0)
 ;
"RTN","PSJMDIR1",23,0)
 K DIC S DIC="^DIC(42,",DIC(0)="QEAMIZ",DIC("A")="Select a Ward: " W !! D ^DIC
"RTN","PSJMDIR1",24,0)
 S PSJSTOP=$S(Y="":1,Y<0:1,$$STOP:1,1:0)
"RTN","PSJMDIR1",25,0)
 I 'PSJSTOP S PSGWD=+Y,PSGWN=Y(0,0) D ADMTM^PSJMDIR D:'PSJSTOP&(PSJMDWS) RBADM^PSJMDIR
"RTN","PSJMDIR1",26,0)
 Q
"RTN","PSJMDIR1",27,0)
 ;
"RTN","PSJMDIR1",28,0)
G ;***Select by WARD GROUP
"RTN","PSJMDIR1",29,0)
 ;
"RTN","PSJMDIR1",30,0)
 K DIC S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select a Ward Group: " W !!
"RTN","PSJMDIR1",31,0)
 D ^DIC
"RTN","PSJMDIR1",32,0)
 I Y<0,X="^OTHER" S PSJSTOP=0,PSGSS="C",(PSGWN,PSGWGNM)="OTHER" D:PSJMDWS RBADM^PSJMDIR Q
"RTN","PSJMDIR1",33,0)
 Q:$$STOP
"RTN","PSJMDIR1",34,0)
 S PSGWG=+Y,PSGWGNM=$P(Y,U,2) D:PSJMDWS RBADM^PSJMDIR
"RTN","PSJMDIR1",35,0)
 Q
"RTN","PSJMDIR1",36,0)
 ;
"RTN","PSJMDIR1",37,0)
 ;
"RTN","PSJMDIR1",38,0)
STOP() ;
"RTN","PSJMDIR1",39,0)
 ;
"RTN","PSJMDIR1",40,0)
 S PSJSTOP=$S($D(DTOUT):1,$D(DUOUT):1,$D(DIRUT):1,1:0)
"RTN","PSJMDIR1",41,0)
 Q PSJSTOP
"RTN","PSJMDWS")
0^35^B10884994
"RTN","PSJMDWS",1,0)
PSJMDWS ;BIR/MV-MAIN DRIVER FOR MED DUE WORKSHEET  ;18 JUN 96 / 2:58 PM
"RTN","PSJMDWS",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**31,34,111**;16 DEC 97
"RTN","PSJMDWS",3,0)
 ;
"RTN","PSJMDWS",4,0)
 ;
"RTN","PSJMDWS",5,0)
 S PSJSTOP=0 K ^TMP($J)
"RTN","PSJMDWS",6,0)
 D ASK G:PSJSTOP EXIT
"RTN","PSJMDWS",7,0)
EN I $D(IO("Q")) D  G EXIT
"RTN","PSJMDWS",8,0)
 . NEW XDESC,XSAVE,XTRTN
"RTN","PSJMDWS",9,0)
 . S XDESC="Med Due Worksheet (SORT)"
"RTN","PSJMDWS",10,0)
 . S XSAVE="PSGIO;PSGMTYPE;PSGP;PSGP(;PSGPAT(;PSGPLF;PSGPLS;PSGRBADM;PSGSS;PSGTM;PSGTM(;PSGTMALL;PSGWD;PSGWG;PSGWGNM;PSGWN;PSJMPRN;PSGIODOC"
"RTN","PSJMDWS",11,0)
 . S XTRTN="SORTQ^PSJMDWS" D SETSORTQ^PSJMUTL(XDESC,XSAVE,XTRTN)
"RTN","PSJMDWS",12,0)
 D SORTQ
"RTN","PSJMDWS",13,0)
 Q
"RTN","PSJMDWS",14,0)
SORTQ ;*** Entry when queue to do the sorting.
"RTN","PSJMDWS",15,0)
 NEW ADMIN,CD,DRG,DRGI,DRGN,DRGT,ON,MID,MN,ND,ND1,OD,PLSD,PSIVUP,PSJORIFN,PST,QST,RBNO,ST,T,TM,TMNO,TS,UD0,UD2,XTYPE
"RTN","PSJMDWS",16,0)
 D:PSGSS="G" ^PSJMEDS
"RTN","PSJMDWS",17,0)
 D:PSGSS="W" WARD^PSJMEDS
"RTN","PSJMDWS",18,0)
 I PSGSS="C" S PSGWG="^OTHER" D ^PSJMEDS
"RTN","PSJMDWS",19,0)
 I PSGSS="P" S PPN="" F  S PPN=$O(PSGPAT(PPN)) Q:PPN=""  S PSGP=PSGPAT(PPN) S PSJACNWP="" D ^PSJAC D MEDTYPE^PSJMEDS
"RTN","PSJMDWS",20,0)
 I $D(PSGIO) D  G EXIT
"RTN","PSJMDWS",21,0)
 . NEW XDESC,XSAVE,XTRTN
"RTN","PSJMDWS",22,0)
 . S XDESC="Med Due Worksheet (PRINT)"
"RTN","PSJMDWS",23,0)
 . S XSAVE="PSGMTYPE;PSGP;PSGP(;PSGPAT(;PSGPLF;PSGPLS;PSGRBADM;PSGSS;PSGTM;PSGTM(;PSGTMALL;PSGWD;PSGWG;PSGWGNM;PSGWN;PSJMPRN;^TMP($J,;PSGIODOC"
"RTN","PSJMDWS",24,0)
 . S XTRTN="PRTQ^PSJMDWS" D SETPRTQ^PSJMUTL(XDESC,XSAVE,XTRTN)
"RTN","PSJMDWS",25,0)
PRTQ ;*** Entry when queue to the printer.
"RTN","PSJMDWS",26,0)
 D ^PSJMPRT
"RTN","PSJMDWS",27,0)
 ;
"RTN","PSJMDWS",28,0)
 ;
"RTN","PSJMDWS",29,0)
EXIT ;
"RTN","PSJMDWS",30,0)
 K ^TMP($J)
"RTN","PSJMDWS",31,0)
 D EXITDEV^PSJMUTL,EXIT^PSJMUTL
"RTN","PSJMDWS",32,0)
 D ENKV^PSGSETU ;*** Kill var called from ^PSJAC
"RTN","PSJMDWS",33,0)
 K PFLG,PPN,PSGEXPDT,PSGIO,PSGLFD,PSGLOD,PSGLSD,PSGMAR,PSGMARWD,PSGMFOR,PSGMTYPE,PSGOES,PSGON,PSGP,PSGPAT,PSGPG,PSGPLC,PSGPLF,PSGPLO
"RTN","PSJMDWS",34,0)
 K PSGPLS,PSGRBADM,PSGRBPPN,PSGRETF,PSGS0XT,PSGS0Y,PSGSS,PSGTM,PSGTMALL,PSGTMP,PSGTMP1,PSGWD,PSGWG,PSGWGNM
"RTN","PSJMDWS",35,0)
 K PSGWN,PSGWN1,PSJACNWP,PSJADT,PSJADT1,PSJADTO,PSJADTME,PSJATME1,PSJATMEO
"RTN","PSJMDWS",36,0)
 K PSJASTR,PSJATME,PSJATMEO,PSJDOS,PSJHL1,PSJHL2,PSJHL3,PSJHL62,PSJHOLD,PSJLN,PSJMPRN,PSJMR,PSJNEED,PSJONCAL,PSJONETM
"RTN","PSJMDWS",37,0)
 K PSJPLC,PSJPRB,PSJPRT,PSJPWDN,PSJPWDO,PSJSCHE,PSJSI,PSJSTOP,PSJTOTLN,ZSTOP,ZTQUEUED
"RTN","PSJMDWS",38,0)
 Q
"RTN","PSJMDWS",39,0)
 ;
"RTN","PSJMDWS",40,0)
 ;
"RTN","PSJMDWS",41,0)
ASK ;***Prompt for selection creteria.  Quit when PSJSTOP=1
"RTN","PSJMDWS",42,0)
 ;
"RTN","PSJMDWS",43,0)
 Q:$$PRN^PSJMDIR  S PSJMPRN=Y
"RTN","PSJMDWS",44,0)
 Q:$$STDATE^PSJMDIR  S (X1,PSGTMP)=Y,X2=1 D C^%DTC S PSGTMP1=X,PSGPLS=Y
"RTN","PSJMDWS",45,0)
 Q:$$ENDATE^PSJMDIR(PSGTMP,PSGTMP1)  S PSGPLF=Y
"RTN","PSJMDWS",46,0)
 Q:$$GWP^PSJMDIR1(1)
"RTN","PSJMDWS",47,0)
 Q:$$MEDTYPE^PSJMDIR($G(PSGWD))  S PSGMTYPE=Y
"RTN","PSJMDWS",48,0)
 Q:$$SELDEV^PSJMUTL
"RTN","PSJMDWS",49,0)
 Q
"RTN","PSJMDWS",50,0)
 ;
"RTN","PSJMDWS",51,0)
ENLM ;Enrty Point for PSJ LM MDWS protocol
"RTN","PSJMDWS",52,0)
 ;
"RTN","PSJMDWS",53,0)
 NEW VADM S PSJSTOP=0 K ^TMP($J)
"RTN","PSJMDWS",54,0)
 I '$D(PSGP(0)) S DFN=PSGP D DEM^VADPT S PSGP(0)=VADM(1) K VADM
"RTN","PSJMDWS",55,0)
 S PSGSS="P",PPN=PSGP(0),PSGPAT(PPN)=PSGP,PSJMDWS=1
"RTN","PSJMDWS",56,0)
 Q:$$PRN^PSJMDIR  S PSJMPRN=Y
"RTN","PSJMDWS",57,0)
 Q:$$STDATE^PSJMDIR  S (X1,PSGTMP)=Y,X2=1 D C^%DTC S PSGTMP1=X,PSGPLS=Y
"RTN","PSJMDWS",58,0)
 Q:$$ENDATE^PSJMDIR(PSGTMP,PSGTMP1)  S PSGPLF=Y
"RTN","PSJMDWS",59,0)
 Q:$$MEDTYPE^PSJMDIR($G(PSGWD))  S PSGMTYPE=Y
"RTN","PSJMDWS",60,0)
 Q:$$SELDEV^PSJMUTL
"RTN","PSJMDWS",61,0)
 G EN
"RTN","PSJMDWS",62,0)
 ;
"RTN","PSJMEDS")
0^111^B19489029
"RTN","PSJMEDS",1,0)
PSJMEDS ;BIR/MV-FIND PATIENT INFO FOR SPECIFIC WARD ;07 Jul 98 / 4:05 PM
"RTN","PSJMEDS",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**34,111**;16 DEC 97
"RTN","PSJMEDS",3,0)
 ;
"RTN","PSJMEDS",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178
"RTN","PSJMEDS",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJMEDS",6,0)
 ;
"RTN","PSJMEDS",7,0)
WARDGP ;*** Find wards within a ward group
"RTN","PSJMEDS",8,0)
 S PSGWD="",TM="ZZ" F  S PSGWD=$O(^PS(57.5,"AC",PSGWG,PSGWD)) Q:'PSGWD  I $D(^DIC(42,+PSGWD,0)) S PSGWN=$P(^(0),U) D WARD
"RTN","PSJMEDS",9,0)
 Q:PSGWG'="^OTHER"
"RTN","PSJMEDS",10,0)
 N STDTE
"RTN","PSJMEDS",11,0)
 S PSGSS="G",PSJACNWP=""
"RTN","PSJMEDS",12,0)
 S STDTE=0 F  S STDTE=$O(^PS(55,"AUDC",STDTE)) Q:'STDTE  S CLINIC=0 F  S CLINIC=$O(^PS(55,"AUDC",STDTE,CLINIC)) Q:'CLINIC  D
"RTN","PSJMEDS",13,0)
 . S JDFN=0 F  S JDFN=$O(^PS(55,"AUDC",STDTE,CLINIC,JDFN)) Q:'JDFN  S PSGP=JDFN D ^PSJAC S PPN=PSGP(0) D MEDTYPE
"RTN","PSJMEDS",14,0)
 S STDTE=0 F  S STDTE=$O(^PS(55,"AIVC",STDTE)) Q:'STDTE  S CLINIC=0 F  S CLINIC=$O(^PS(55,"AIVC",STDTE,CLINIC)) Q:'CLINIC  D
"RTN","PSJMEDS",15,0)
 . S JDFN=0 F  S JDFN=$O(^PS(55,"AIVC",STDTE,CLINIC,JDFN)) Q:'JDFN  S PSGP=JDFN D ^PSJAC S PPN=PSGP(0) D MEDTYPE
"RTN","PSJMEDS",16,0)
 Q
"RTN","PSJMEDS",17,0)
 ;
"RTN","PSJMEDS",18,0)
WARD ;*** Go through each patient within a given WARD
"RTN","PSJMEDS",19,0)
 ;*** Var used in PSJAC. Set to null to skip WP^PSJAC
"RTN","PSJMEDS",20,0)
 ;
"RTN","PSJMEDS",21,0)
 S PSJACNWP=""
"RTN","PSJMEDS",22,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGWN,PSGP)) Q:'PSGP  D ^PSJAC S PPN=PSGP(0) D:PSGSS="W" TEAM D:PSGSS="G" MEDTYPE
"RTN","PSJMEDS",23,0)
 Q
"RTN","PSJMEDS",24,0)
 ;
"RTN","PSJMEDS",25,0)
TEAM ;*** Look up selected team.  PSGTMALL= All teams were selected.
"RTN","PSJMEDS",26,0)
 ;
"RTN","PSJMEDS",27,0)
 S TM="ZZ"
"RTN","PSJMEDS",28,0)
 I PSGTMALL D ALLTM,MEDTYPE Q
"RTN","PSJMEDS",29,0)
 I 'PSGTM D MEDTYPE Q
"RTN","PSJMEDS",30,0)
 I PSGTM,'PSGTMALL S TM="",RBNO=0 F  S TM=$O(PSGTM(TM)) Q:TM=""  S TMNO=PSGTM(TM) S:$G(PSJPRB) RBNO=$O(^PS(57.7,"AWRT",PSGWD,PSJPRB,TMNO,0)) D:RBNO MEDTYPE
"RTN","PSJMEDS",31,0)
 Q
"RTN","PSJMEDS",32,0)
 ;
"RTN","PSJMEDS",33,0)
ALLTM ;*** Get UNIT DOSE information from ^PS(55
"RTN","PSJMEDS",34,0)
 ;
"RTN","PSJMEDS",35,0)
 S TM=$S(PSJPRB="":0,1:+$O(^PS(57.7,"AWRT",PSGWD,PSJPRB,0))),TM=$S('$G(TM):"ZZ",'$D(^PS(57.7,PSGWD,1,TM,0)):TM,$P(^(0),U)]"":$P(^(0),U),1:TM)
"RTN","PSJMEDS",36,0)
 Q
"RTN","PSJMEDS",37,0)
 ;
"RTN","PSJMEDS",38,0)
MEDTYPE ;
"RTN","PSJMEDS",39,0)
 S:PSJPRB="" PSJPRB="NOT FOUND"
"RTN","PSJMEDS",40,0)
 I PSGMTYPE[1 F XTYPE=2:1:6 D LOOP(XTYPE)
"RTN","PSJMEDS",41,0)
 I PSGMTYPE'[1 F XTYPE=2:1:6 D:PSGMTYPE[XTYPE LOOP(XTYPE)
"RTN","PSJMEDS",42,0)
 D ^PSJMPEND
"RTN","PSJMEDS",43,0)
 Q
"RTN","PSJMEDS",44,0)
 ;
"RTN","PSJMEDS",45,0)
LOOP(XTYPE) ;*** Loop through stop date cross ref. to find unit dose nodes
"RTN","PSJMEDS",46,0)
 I XTYPE=2  F PST="C","O","OC","P","R"  F PSGEXPDT=PSGPLS-.0001:0 S PSGEXPDT=$O(^PS(55,PSGP,5,"AU",PST,PSGEXPDT)) Q:'PSGEXPDT  D
"RTN","PSJMEDS",47,0)
 . F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",PST,PSGEXPDT,ON)) Q:'ON  D UDOSE
"RTN","PSJMEDS",48,0)
 I XTYPE=2 S PST="S" D ^PSJMIV
"RTN","PSJMEDS",49,0)
 I XTYPE>2 S PST=$S(XTYPE=3:"P",XTYPE=4:"A",XTYPE=5:"H",XTYPE=6:"C") D ^PSJMIV
"RTN","PSJMEDS",50,0)
 I XTYPE=3 S PST="S" D ^PSJMIV
"RTN","PSJMEDS",51,0)
 Q
"RTN","PSJMEDS",52,0)
 ;
"RTN","PSJMEDS",53,0)
UDOSE ;
"RTN","PSJMEDS",54,0)
 ;*** Check on status for Hold,Discontinue,Expired,DE(discontinue Edit)
"RTN","PSJMEDS",55,0)
 S UD0=$G(^PS(55,PSGP,5,ON,0)) Q:"DE"[$P(UD0,U,9)
"RTN","PSJMEDS",56,0)
 S UD2=$G(^PS(55,PSGP,5,ON,2))  Q:$P(UD2,U,2)>PSGPLF
"RTN","PSJMEDS",57,0)
 ;
"RTN","PSJMEDS",58,0)
 ;*** Setup drug info
"RTN","PSJMEDS",59,0)
 S DRG=$E($$ENPDN^PSGMI(+$G(^PS(55,PSGP,5,ON,.2))),1,20)_U_ON,PSJDOS=$P($G(^PS(55,PSGP,5,ON,.2)),U,2)
"RTN","PSJMEDS",60,0)
 I $P($G(^PS(51.2,+$P(UD0,U,3),0)),U)]"" S PSJMR=$E($S($P(^(0),U,3)]"":$P(^(0),U,3),1:$P(^(0),U)),1,5)
"RTN","PSJMEDS",61,0)
 S PSJSCHE=$P(UD2,U),QST=$S(PSJSCHE["PRN":"P",1:PST)
"RTN","PSJMEDS",62,0)
 S PSGLOD=$P(UD0,U,14),PSGLSD=$P(UD2,U,2),PSGLFD=$P(UD2,U,4)
"RTN","PSJMEDS",63,0)
 Q:('PSJMPRN&(QST="P"))
"RTN","PSJMEDS",64,0)
 S PSJSI=$S($P(UD0,U,22):"*** NOT TO BE GIVEN ***",1:$P($G(^PS(55,PSGP,5,ON,6)),U))
"RTN","PSJMEDS",65,0)
 S PSJHOLD=$S($P(UD0,U,9)["H":1,1:0)
"RTN","PSJMEDS",66,0)
 D:QST'="P" ADMIN
"RTN","PSJMEDS",67,0)
 I QST="P" S PSJATME=9999,PSJADT=9999999 D @PSGSS
"RTN","PSJMEDS",68,0)
 Q
"RTN","PSJMEDS",69,0)
 ;
"RTN","PSJMEDS",70,0)
ADMIN ;
"RTN","PSJMEDS",71,0)
 S PSGPLO=ON,PSGMFOR="" D ^PSJPL0
"RTN","PSJMEDS",72,0)
 I PSJPLC=1 S PSJATME=8888,PSJADT=8888888 D @PSGSS
"RTN","PSJMEDS",73,0)
 F ADMIN=0:0 S ADMIN=$O(PSGMAR(ADMIN)) Q:'ADMIN  S PSJADT=$P(ADMIN,"."),PSJATME=+$E($P(ADMIN,".",2)_"0000",1,4) D @PSGSS
"RTN","PSJMEDS",74,0)
 Q
"RTN","PSJMEDS",75,0)
 ;
"RTN","PSJMEDS",76,0)
P ;*** Set up ^TMP for sort by patients
"RTN","PSJMEDS",77,0)
 NEW QST S QST=$S("CO"[PST:PST,PST="OC":"OA",1:"CR")
"RTN","PSJMEDS",78,0)
 S ^TMP($J,PSJADT,PPN_U_PSGP,PSJATME,QST,DRG)=PSGP_U_ON_U_PSJPPID_U_PSJPWDN_U_PSJPRB
"RTN","PSJMEDS",79,0)
 S ^TMP($J,QST,PSGP,ON)=PSJDOS_U_PSJMR_U_PSJSCHE_U_PSJHOLD_U_PSGLOD_U_PSGLSD_U_PSGLFD
"RTN","PSJMEDS",80,0)
 S ^TMP($J,QST,PSGP,ON,1)=PSJSI
"RTN","PSJMEDS",81,0)
 Q
"RTN","PSJMEDS",82,0)
 ;
"RTN","PSJMEDS",83,0)
G ;*** Goto W to set up ^TMP when print by WARD/WARD GROUP
"RTN","PSJMEDS",84,0)
 ;
"RTN","PSJMEDS",85,0)
W ;*** Set up ^TMP when listing by ward
"RTN","PSJMEDS",86,0)
 S:PSGRBADM="A" ^TMP($J,PSJADT,TM,PSJATME,PSJPRB,PPN,QST,DRG)=PSGP_U_ON_U_PSJPPID_U_PSGWN_U_PSJPRB
"RTN","PSJMEDS",87,0)
 S:PSGRBADM="R" ^TMP($J,PSJADT,TM,PSJPRB,PPN,PSJATME,QST,DRG)=PSGP_U_ON_U_PSJPPID_U_PSGWN_U_PSJPRB
"RTN","PSJMEDS",88,0)
 S:PSGRBADM="P" ^TMP($J,PSJADT,TM,PPN_U_PSGP,PSJATME,QST,DRG)=PSGP_U_ON_U_PSJPPID_U_PSGWN_U_PSJPRB
"RTN","PSJMEDS",89,0)
 S ^TMP($J,QST,PSGP,ON)=PSJDOS_U_PSJMR_U_PSJSCHE_U_PSJHOLD_U_PSGLOD_U_PSGLSD_U_PSGLFD
"RTN","PSJMEDS",90,0)
 S ^TMP($J,QST,PSGP,ON,1)=PSJSI
"RTN","PSJMEDS",91,0)
 Q
"RTN","PSJMP")
0^36^B3272025
"RTN","PSJMP",1,0)
PSJMP ;BIR/CML3-PATIENT LOOK-UP ;12 JAN 94 / 2:00 PM
"RTN","PSJMP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**53,111**;16 DEC 97
"RTN","PSJMP",3,0)
 ;
"RTN","PSJMP",4,0)
 ; Reference to ^VADPT is supported by DBIA 10061
"RTN","PSJMP",5,0)
 ;
"RTN","PSJMP",6,0)
ENDPT ;*** get patient ***
"RTN","PSJMP",7,0)
 K DIC,PSGP,Y W !!,"Select "_$S($D(PSGDICA):PSGDICA_" ",1:"")_"PATIENT: " R X:DTIME I "^"[X S (Y,PSGP)=-1 G DONE
"RTN","PSJMP",8,0)
 D EN^PSJDPT
"RTN","PSJMP",9,0)
 I Y'>0 G ENDPT
"RTN","PSJMP",10,0)
 K DIC
"RTN","PSJMP",11,0)
 ;
"RTN","PSJMP",12,0)
CHK ;*** Check patient status ***
"RTN","PSJMP",13,0)
 S PPN=$P(Y,U,2),(DFN,PSGP)=+Y,VA200=1 D INP^VADPT
"RTN","PSJMP",14,0)
 I VAIN(4) S PSJPWD=+VAIN(4) G DONE
"RTN","PSJMP",15,0)
 ;S PSJPCAF="",VAIP("D")="L" D IN5^VADPT I 'VAIP(13,1) W $C(7),!!?3,"PATIENT HAS NEVER BEEN ADMITTED." G ENDPT
"RTN","PSJMP",16,0)
 S PSJPCAF="",VAIP("D")="L" D IN5^VADPT I 'VAIP(13,1) W $C(7),!!?3,"PATIENT HAS NEVER BEEN ADMITTED." G:'$$CONT ENDPT S PSJPWD="OTHER"
"RTN","PSJMP",17,0)
 ;S PSJPAD=VAIP(13,1),PSGID=+VAIP(3),X=+VAIP(4)=12!(+VAIP(4)=38),PSGOD=$$ENDTC^PSGMI(PSGID) W $C(7),!!?3,"PATIENT IS FOUND TO BE D",$P("ISCHARG^ECEAS",U,X+1),"ED AS OF ",PSGOD,"." G:'$D(PSGRETF) ENDPT
"RTN","PSJMP",18,0)
 S PSJPAD=VAIP(13,1),PSGID=+VAIP(3),X=+VAIP(4)=12!(+VAIP(4)=38),PSGOD=$$ENDTC^PSGMI(PSGID) D  G:'$$CONT ENDPT S PSJPWD="OTHER"
"RTN","PSJMP",19,0)
 . W $C(7),!!?3,"PATIENT IS FOUND TO BE D",$P("ISCHARG^ECEAS",U,X+1),"ED AS OF ",PSGOD,"."
"RTN","PSJMP",20,0)
 ;
"RTN","PSJMP",21,0)
DONE ;
"RTN","PSJMP",22,0)
 K DA,DIC,NB,ND,NS,PSGID,PSGOD,VA200,VADM,VAIN,VAIP,VAMT,X,Y(0),Y(0,0) Q
"RTN","PSJMP",23,0)
 ;
"RTN","PSJMP",24,0)
CONT() ;
"RTN","PSJMP",25,0)
 K DIR S DIR("?")="A 'YES' or 'NO' response is required" W !
"RTN","PSJMP",26,0)
 S DIR(0)="Y",DIR("A")="Do you wish to continue with this patient" D ^DIR
"RTN","PSJMP",27,0)
 Q Y
"RTN","PSJOE")
0^121^B81173989
"RTN","PSJOE",1,0)
PSJOE ;BIR/MLM-INPATIENT ORDER ENTRY ;23 Jun 98 / 1:46 PM
"RTN","PSJOE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,26,29,33,42,50,56,72,58,85,95,80,110,111**;16 DEC 97
"RTN","PSJOE",3,0)
 ;
"RTN","PSJOE",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOE",5,0)
 ; Reference to EN^VALM is supported by DBIA #10118.
"RTN","PSJOE",6,0)
 ; Reference to FULL^VALM1 and PAUSE^VALM1 is supported by DBIA #10116.
"RTN","PSJOE",7,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSJOE",8,0)
 ; Reference to ^DPT is supported by DBIA #10035.
"RTN","PSJOE",9,0)
 ; Reference to ^ORCFLAG is supported by DBIA #3620.
"RTN","PSJOE",10,0)
 ; Reference to ^SDAMA203 is supported by DBIA #4133.
"RTN","PSJOE",11,0)
 ;
"RTN","PSJOE",12,0)
EN ; Start Inpatient LM OE
"RTN","PSJOE",13,0)
 N PSJLK,PSJNEWOE,PSJLMCON,PSJPROT,XQORS,VALMEVL D ENCV^PSGSETU,^PSIVXU
"RTN","PSJOE",14,0)
 I $D(XQUIT) K XQUIT G DONE
"RTN","PSJOE",15,0)
 K PSGVBY,PSJPR S (PSJOL,PSJACOK,PSGOP,PSGNEF,PSGOEAV,PSGPXN)="" L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE^PSJOE
"RTN","PSJOE",16,0)
 F  S (PSJLMCON,PSGPTMP)=0 D ^PSJP,HK Q:PSGP'>0  S PSJPROT=3,DFN=PSGP D ^PSJAC D  I PSJLK D UL^PSSLOCK(PSGP)
"RTN","PSJOE",17,0)
 .K ^TMP("PSJ",$J)
"RTN","PSJOE",18,0)
 .S PSJLK=$$L^PSSLOCK(PSGP,1) I 'PSJLK W !,$C(7),$P(PSJLK,U,2) Q
"RTN","PSJOE",19,0)
 .K PSJLMPRO D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSJOE",20,0)
 .N NXTPT S NXTPT=0 F  Q:$G(NXTPT)  D
"RTN","PSJOE",21,0)
 ..K PSGRDTX
"RTN","PSJOE",22,0)
 ..I $G(PSJLMCON)!$G(PSJNEWOE) D
"RTN","PSJOE",23,0)
 ...S PSJOL=$S(",S,L,"[(","_$G(PSJOL)_","):PSJOL,1:"S")
"RTN","PSJOE",24,0)
 ...S PSJLMPRO=1,PSJLMCON=1,PSJNEWOE=0 D EN^VALM("PSJ LM OE")
"RTN","PSJOE",25,0)
 ..I $G(PSJNEWOE)!($G(VALMBCK)="Q") S PSJNEWOE=0 Q
"RTN","PSJOE",26,0)
 ..I $G(PSJLMCON)&$G(PSJLMPRO)&'$D(^TMP("PSJ",$J)) D  Q
"RTN","PSJOE",27,0)
 ...S PSJLMCON=0,PSJLMPRO=0 D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSJOE",28,0)
 ...I $G(PSJNEWOE) S NXTPT=0 Q
"RTN","PSJOE",29,0)
 ...S NXTPT=1
"RTN","PSJOE",30,0)
 ..S NXTPT=1,PSJNEWOE=0
"RTN","PSJOE",31,0)
 .S PSJOL="S"
"RTN","PSJOE",32,0)
 .I $G(PSGPXN) I $P(PSJSYSW0,U,29)]""!($G(PSJCOM)) S PSGPXPT=PSGP D  K PSGPXPT S PSGPXN=0
"RTN","PSJOE",33,0)
 ..N DFN,PSGP,PSJPXDP
"RTN","PSJOE",34,0)
 ..I $P(PSJSYSW0,U,29)="" S PSJPDXP=1,$P(PSJSYSW0,U,29)=$I
"RTN","PSJOE",35,0)
 ..S (PSGP,DFN)=PSGPXPT D ^PSGPER S:$G(PSJPDXP) $P(PSJSYSW0,U,29)="" K PSJPDXP
"RTN","PSJOE",36,0)
 .D ENCV^PSGSETU,^PSIVXU
"RTN","PSJOE",37,0)
 K PSJLMPRO,^TMP("PSJPRO",$J),^TMP("PSJ",$J),^TMP("PSJON",$J)
"RTN","PSJOE",38,0)
 ;
"RTN","PSJOE",39,0)
DONE ;
"RTN","PSJOE",40,0)
 K AC,ACTION,D1,D2,MI,N,ON,P3,PNOW,PSIVAT,PSIVLN,PSIVSTR L -^PS(53.45,PSJSYSP)
"RTN","PSJOE",41,0)
 K DA,DRG,NE,PSGCF,PSGCANFL,PSGNEDFD,PSGNEF,PSGNEFD,PSGNEPR,PSGNESD,PSJACOK,PSJOE,PSJOECNT,PSJOEPF,PSJORD,PSGOEA,PSGOEAV,PSGOL,PSGOS,PSGON,PSGOP,PSGORD,PSGS0XT,PSGS0Y,RCT,ST,WD,XREF,Z,PSJIVORF,PSJIVPCL
"RTN","PSJOE",42,0)
 K PSGOEORF,PSIVREA,PSJOPC,PSJORL,PSJORPCL,PSJORTOI,RF,WSCHADM,PSJLM
"RTN","PSJOE",43,0)
 K DIU,DRGI,FLAG,FQC,ND2,PRI,PSGOE,PSGPRI,PSGSDN,PSGOEDMR,PSGOEPR,PSGPTS,PSGTOL,PSGTOO,PSGUOW,PSJIVOF,PSJOCNT,PSJON,PSJORQF,PSJORTOU,PSJORVP
"RTN","PSJOE",44,0)
 G:($G(PSGPXN)&'$$DEFON^PSGPER1) ^PSGPER1 D ENIVKV^PSGSETU
"RTN","PSJOE",45,0)
 Q
"RTN","PSJOE",46,0)
 ;
"RTN","PSJOE",47,0)
HK ; HouseKeeping (a nice COBOL term)
"RTN","PSJOE",48,0)
 I PSGOP,PSGOP'=PSGP D
"RTN","PSJOE",49,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSJOE",50,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,"^",2)]"" ENQL^PSGLW
"RTN","PSJOE",51,0)
 Q:PSGP<0
"RTN","PSJOE",52,0)
 S (DFN,PSGOP)=PSGP,X=""
"RTN","PSJOE",53,0)
 Q
"RTN","PSJOE",54,0)
 ;
"RTN","PSJOE",55,0)
SELECT ; Select order from list
"RTN","PSJOE",56,0)
 N PSGLMT,PSGODDD,PSJLMQT,PSJLMFIN,PSJUDPRF,PSGRDTX K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J)
"RTN","PSJOE",57,0)
 S PSGONC=1,PSGLMT=^TMP("PSJPRO",$J,0) D ENASR^PSGON
"RTN","PSJOE",58,0)
 I "^"[X S VALMQUIT=1 Q
"RTN","PSJOE",59,0)
 S PSJLM=1,PSJSEL=0 F  S PSJSEL=$O(PSGODDD(PSJSEL)) Q:'PSJSEL!($G(Y)<0)  F PSJSEL1=1:1:$L(PSGODDD(PSJSEL),",")-1 D
"RTN","PSJOE",60,0)
 .S PSJORD=$G(^TMP("PSJON",$J,+$P(PSGODDD(PSJSEL),",",PSJSEL1))) D:PSJORD=+PSJORD SELECT^PSJOEA Q:PSJORD=""!($G(Y)<0)  Q:PSJORD=+PSJORD  D
"RTN","PSJOE",61,0)
 ..Q:('$$LS^PSSLOCK(PSGP,PSJORD))
"RTN","PSJOE",62,0)
 ..Q:PSJORD=+PSJORD
"RTN","PSJOE",63,0)
 ..S PSGORD=""
"RTN","PSJOE",64,0)
 ..D DISACTIO(PSGP,PSJORD,"") S:PSJORD["V" PSJORD=ON
"RTN","PSJOE",65,0)
 ..D UNL^PSSLOCK(PSGP,PSJORD) Q:$G(Y)<0
"RTN","PSJOE",66,0)
 S VALMBCK="Q"
"RTN","PSJOE",67,0)
 K PSJLM
"RTN","PSJOE",68,0)
 Q
"RTN","PSJOE",69,0)
 ;
"RTN","PSJOE",70,0)
DISACTIO(DFN,PSJORD,PSJPNV)       ; Display UD order and allow actions.
"RTN","PSJOE",71,0)
 ; DFN    - Patient IEN
"RTN","PSJOE",72,0)
 ; PSJORD - Order #_location Code (P:53.1,V:55.01,U:55.06)
"RTN","PSJOE",73,0)
 ; PSJPNV - Invoked from Pending/NV option; (gets different hidden menu)
"RTN","PSJOE",74,0)
 N PSGP,PSJIVFLG,PSGSDX,PSGFDX,PSJXX1,ON55
"RTN","PSJOE",75,0)
 D OLDCOM^PSJOE0(DFN,PSJORD)
"RTN","PSJOE",76,0)
 S PSGP=DFN D ENIV^PSJAC I PSJORD["V" D EN^PSJLIORD(DFN,PSJORD) Q
"RTN","PSJOE",77,0)
 D GETUD^PSJLMGUD(DFN,PSJORD)
"RTN","PSJOE",78,0)
 ;S PSGPD=$S(PSJORD["P":$P($G(^PS(53.1,+PSJORD,.2)),U),1:$P($G(^PS(55,DFN,5,+PSJORD,.2)),U))
"RTN","PSJOE",79,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOE",80,0)
 S:$G(PSJTUD) PSGPD=$G(PSJCOI),PSGPDN=$$OINAME^PSJLMUTL(+PSGPD)
"RTN","PSJOE",81,0)
 K PSGOENG I '$D(PSGPRF) D  Q:$G(PSGOENG)
"RTN","PSJOE",82,0)
 . I PSJORD["U" L +^PS(55,PSGP,5,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOE",83,0)
 . I PSJORD["P" L +^PS(53.1,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOE",84,0)
 . I $G(PSGOENG) W !,"This order is being edited by another terminal.",! S PSGOENG=1 K DIR S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSJOE",85,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD)
"RTN","PSJOE",86,0)
 I PSJORD["P" S PSJXX1=$G(^PS(53.1,+PSJORD,0)) I PSGP'=$P(PSJXX1,U,15)!(DFN'=$P(PSJXX1,U,15)) L -^PS(53.1,+PSJORD) Q
"RTN","PSJOE",87,0)
 I PSJORD["P" D  S PSJXX1=$P($G(^PS(53.1,+PSJORD,0)),U,9) I $S($G(PSJIVFLG):1,$G(Y)<0:1,"PADE"[PSJXX1:1,1:0) L -^PS(53.1,+PSJORD) Q
"RTN","PSJOE",88,0)
 .I $P(PSJXX1,U,9)="N",($P(PSJXX1,U,4)'="U") D  Q
"RTN","PSJOE",89,0)
 .. S P("PON")=PSJORD,PSIVFLG=1
"RTN","PSJOE",90,0)
 .. N ON S ON=PSJORD D VF^PSIVORC2
"RTN","PSJOE",91,0)
 .I $P(PSJXX1,U,9)="P" D  Q
"RTN","PSJOE",92,0)
 ..S:$G(PSJTUD) $P(PSJXX1,U,4)="U"
"RTN","PSJOE",93,0)
 ..I $P(PSJXX1,U,4)="U" D  Q:$G(PSJIVFLG)
"RTN","PSJOE",94,0)
 ... N VAIP S CLINIC=$G(^PS(53.1,+PSJORD,"DSS")),APPT=$P(CLINIC,"^",2),CLINIC=$P(CLINIC,"^") I $$PATCH^XPDUTL("SD*5.3*285"),$$SDIMO^SDAMA203(CLINIC,DFN)>-1 Q
"RTN","PSJOE",95,0)
 ... Q:'PSJPDD  W !!,"Cannot process an Out-patient Unit Dose order for ",$P($G(^DPT(+PSGP,0)),U) D PAUSE^VALM1 S PSJIVFLG=1
"RTN","PSJOE",96,0)
 ..NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJOE",97,0)
 ..D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJOE",98,0)
 ..I $P(PSJXX1,U,4)="U",($G(PSGSCH)="") W !!,"Invalid schedule, can't finish this order" D PAUSE^VALM1 Q
"RTN","PSJOE",99,0)
 ..I $P(PSJXX1,U,4)="U" N PSJLM S PSJLM=1,PSGORD=PSJORD D START^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),@$S($G(PSJTUD):"FINISH^PSGOEF",1:"EN^VALM(""PSJ LM PENDING EDIT"")") Q
"RTN","PSJOE",100,0)
 ..I $P(PSJXX1,U,4)'="U",PSGP=$P(PSJXX1,U,15),DFN=$P(PSJXX1,U,15) S PSJLYN=PSJORD D EN^PSJLIFN S PSJIVFLG=1 K PSJLYN,PSJMAI
"RTN","PSJOE",101,0)
 I $G(PSIVFLG) K PSIVFLG Q
"RTN","PSJOE",102,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD),PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSJORD),ENSFE^PSGOEE0(PSGP,PSJORD),EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOE",103,0)
 I PSJORD["P" L -^PS(53.1,+PSJORD)
"RTN","PSJOE",104,0)
 I PSJORD["U" L -^PS(55,PSGP,5,+PSJORD)
"RTN","PSJOE",105,0)
 ;Send SN to CPRS if autoverify OFF and Order Set Entry and no 21st piece
"RTN","PSJOE",106,0)
 I $D(PSGOES),'PSGOEAV,$D(PSGORD),PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSJOE",107,0)
 D UNL^PSSLOCK(PSGP,PSJORD)
"RTN","PSJOE",108,0)
 Q
"RTN","PSJOE",109,0)
EDIT(PSGP,PSGORD,PROMPT) ;
"RTN","PSJOE",110,0)
 I "DE"[$$GTSTATUS(PSGP,PSGORD) W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJOE",111,0)
 I PSGACT'["E" W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJOE",112,0)
 S PSGNEDFD="" D HOLDHDR,@$S('PROMPT:"ENEFA2^PSGON",1:"ENEFA^PSGON") I 'Y D ABORT^PSGOEE Q
"RTN","PSJOE",113,0)
 I PSGORD["P" D ENF^PSGOEE Q
"RTN","PSJOE",114,0)
 D ACT^PSGOEE
"RTN","PSJOE",115,0)
 Q
"RTN","PSJOE",116,0)
RENEW(PSGP,PSGORD) ;
"RTN","PSJOE",117,0)
 D HOLDHDR
"RTN","PSJOE",118,0)
 I 'PSJSYSU,$P($G(^PS(55,PSGP,5,+PSGORD,4)),U,15),$P($G(^(4)),U,16) W !!,"This order is already marked for renewal!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSJOE",119,0)
 I 'PSGRRF D ^PSGOER Q
"RTN","PSJOE",120,0)
 D ^PSGOERI
"RTN","PSJOE",121,0)
 Q
"RTN","PSJOE",122,0)
 ;
"RTN","PSJOE",123,0)
GTSTATUS(DFN,ON)   ;
"RTN","PSJOE",124,0)
 I ON["P" Q $P($G(^PS(53.1,+ON,0)),U,9)
"RTN","PSJOE",125,0)
 I ON["U" Q $P($G(^PS(55,DFN,5,+ON,0)),U,9)
"RTN","PSJOE",126,0)
 Q $P($G(^PS(55,DFN,"IV",+ON,0)),U,17)
"RTN","PSJOE",127,0)
 ;
"RTN","PSJOE",128,0)
DC(DFN,PSJORD) ; DC IV, UD, or pending orders.
"RTN","PSJOE",129,0)
 D HOLDHDR
"RTN","PSJOE",130,0)
 S X=$$GTSTATUS(DFN,PSJORD) I X="D"!(X="DE") W !,"This order has already been DISCONTINUED." D PAUSE^VALM1 Q
"RTN","PSJOE",131,0)
 D ENO^PSGOEC(DFN,PSJORD) ;,GETUD^PSJLMGUD(DFN,PSJORD),INIT^PSJLMUDE(DFN,PSJORD) S VALMBCK="Q"
"RTN","PSJOE",132,0)
 S VALMBCK="Q"
"RTN","PSJOE",133,0)
 Q
"RTN","PSJOE",134,0)
HOLD(DFN,PSJORD) ; Change order's status from ACTIVE<->HOLD
"RTN","PSJOE",135,0)
 D HOLDHDR
"RTN","PSJOE",136,0)
 I PSJORD["V" D H^PSIVOPT(DFN,PSJORD,P(17),P(3))
"RTN","PSJOE",137,0)
 I PSJORD'["V" D H^PSGOE1(DFN,PSJORD)
"RTN","PSJOE",138,0)
 D GETUD^PSJLMGUD(DFN,PSJORD),INIT^PSJLMUDE(DFN,PSJORD) S PSGACT=$$ENACTION^PSGOE1(DFN,PSJORD),VALMBCK="R"
"RTN","PSJOE",139,0)
 Q
"RTN","PSJOE",140,0)
 ;
"RTN","PSJOE",141,0)
COPY(PSGP,PSGORD)  ; Copy an order (does not discontinue original order)
"RTN","PSJOE",142,0)
 I $D(PSGCOPY) W !!,"You cannot copy the order at this time" D PAUSE^VALM1 Q
"RTN","PSJOE",143,0)
 ;I PSGORD["V" N PSIVCOPY S PSIVCOPY=1 W !!,"You cannot copy an IV order." D PAUSE^VALM1 Q
"RTN","PSJOE",144,0)
 I PSGORD["P" W !!,"You cannot copy this "_$S($G(PSGSTAT)]"":PSGSTAT,1:"PENDING IV")_" order." D PAUSE^VALM1 Q
"RTN","PSJOE",145,0)
 I PSGORD["V" D  Q
"RTN","PSJOE",146,0)
 .I $G(PSIVCOPY) W !!,"You cannot copy the order at this time" D PAUSE^VALM1 Q
"RTN","PSJOE",147,0)
 .D COPY^PSIVOD(PSGP,PSGORD) Q
"RTN","PSJOE",148,0)
 Q:'$$HIDDEN^PSJLMUTL("COPY")
"RTN","PSJOE",149,0)
 D ^PSJHVARS
"RTN","PSJOE",150,0)
 I $P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,4)="D",'$P($G(^(4)),"^",3) W !!,"Nurse verified orders with a priority of DONE may not be Copied." D PAUSE^VALM1 Q
"RTN","PSJOE",151,0)
 S PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU
"RTN","PSJOE",152,0)
 S PSGCOPY=1
"RTN","PSJOE",153,0)
 D FULL^VALM1,^PSGOD
"RTN","PSJOE",154,0)
 S VALMBCK="R"
"RTN","PSJOE",155,0)
 K PSGCOPY
"RTN","PSJOE",156,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD) ; resets PSGACT after copy
"RTN","PSJOE",157,0)
 D RESTORE^PSJHVARS
"RTN","PSJOE",158,0)
 Q
"RTN","PSJOE",159,0)
 ;
"RTN","PSJOE",160,0)
UPDATE ; Refresh array, actions, & display.
"RTN","PSJOE",161,0)
 D GETUD^PSJLMGUD(DFN,ON),INIT^PSJLMUDE(DFN,ON) S VALMBCK="R"
"RTN","PSJOE",162,0)
 Q
"RTN","PSJOE",163,0)
FINISH ;
"RTN","PSJOE",164,0)
 D FINISH^PSGOEF,PAUSE^VALM1
"RTN","PSJOE",165,0)
 Q
"RTN","PSJOE",166,0)
 ;
"RTN","PSJOE",167,0)
LOG(DFN,PSGORD)        ;
"RTN","PSJOE",168,0)
 D FULL^VALM1,ENLM^PSGOEL(DFN,PSGORD),PAUSE^VALM1 S VALMBCK="R"
"RTN","PSJOE",169,0)
 Q
"RTN","PSJOE",170,0)
NEWSEL ;
"RTN","PSJOE",171,0)
 N PSGLMT,PSGODDD,PSJLMQT,PSJLMFIN,PSJUDPRF,PSGRDTX K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J)
"RTN","PSJOE",172,0)
 S X=$P(XQORNOD(0),"=",2)
"RTN","PSJOE",173,0)
 S PSGONC=1,PSGLMT=^TMP("PSJPRO",$J,0)
"RTN","PSJOE",174,0)
 D ENCHK^PSGON I '$O(PSGODDD(0)) S VALMQUIT=1 Q
"RTN","PSJOE",175,0)
 S PSJLM=1,PSJSEL=0 F  S PSJSEL=$O(PSGODDD(PSJSEL)) Q:'PSJSEL  F PSJSEL1=1:1:$L(PSGODDD(PSJSEL),",")-1 D
"RTN","PSJOE",176,0)
 .;S PSJORD=$G(^TMP("PSJON",$J,+$P(PSGODDD(PSJSEL),",",PSJSEL1))) Q:PSJORD=""  D DISACTIO(PSGP,PSJORD,$G(PSJPNV))
"RTN","PSJOE",177,0)
 .S PSJORD=$G(^TMP("PSJON",$J,+$P(PSGODDD(PSJSEL),",",PSJSEL1))) D:PSJORD=+PSJORD SELECT^PSJOEA
"RTN","PSJOE",178,0)
 .Q:PSJORD=+PSJORD 
"RTN","PSJOE",179,0)
 .Q:PSJORD=""!($G(Y)<0)  Q:('$$LS^PSSLOCK(PSGP,PSJORD))  D
"RTN","PSJOE",180,0)
 ..S PSGORD=""
"RTN","PSJOE",181,0)
 ..S ON=PSJORD
"RTN","PSJOE",182,0)
 ..D DISACTIO(PSGP,PSJORD,$G(PSJPNV)) S:PSJORD["V" PSJORD=ON
"RTN","PSJOE",183,0)
 ..D UNL^PSSLOCK(PSGP,PSJORD) Q:$G(Y)<0
"RTN","PSJOE",184,0)
 S VALMBCK="Q"
"RTN","PSJOE",185,0)
 K PSJLM
"RTN","PSJOE",186,0)
 Q
"RTN","PSJOE",187,0)
HOLDHDR ; Freeze header text while processing order actions
"RTN","PSJOE",188,0)
 I $D(VALM("TM")) S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSJOE",189,0)
 Q
"RTN","PSJOE",190,0)
LOCKERR ;
"RTN","PSJOE",191,0)
 W !!,$C(7),"You are entering or editing an Inpatient Medication order in another session.",!,"Only one order entry/edit session is allowed for a user at a time.",!! N DIR S DIR(0)="E" D ^DIR
"RTN","PSJOE",192,0)
 Q
"RTN","PSJOE",193,0)
FLAG(DFN,PSJORD) ;Flag order through CPRS entrypoint.
"RTN","PSJOE",194,0)
 N ORIFN,NODE0
"RTN","PSJOE",195,0)
 S NODE0=$S(PSJORD["V":$G(^PS(55,DFN,"IV",+PSJORD,0)),PSJORD["U":$G(^PS(55,DFN,5,+PSJORD,0)),1:^PS(53.1,+PSJORD,0))
"RTN","PSJOE",196,0)
 S ORIFN=$P(NODE0,"^",21)
"RTN","PSJOE",197,0)
 D EN1^ORCFLAG(ORIFN)
"RTN","PSJOE",198,0)
 D PAUSE^VALM1
"RTN","PSJOE",199,0)
 Q
"RTN","PSJOE",200,0)
 ;
"RTN","PSJOE",201,0)
COMPLEX(DFN,ON) ;
"RTN","PSJOE",202,0)
 N NDP2,COM
"RTN","PSJOE",203,0)
 S NDP2=$S(ON["P":$G(^PS(53.1,+ON,.2)),ON["U":$G(^PS(55,DFN,5,+ON,.2)),ON["V":$G(^PS(55,DFN,"IV",+ON,.2)),1:"")
"RTN","PSJOE",204,0)
 S COM=$P(NDP2,"^",8) I COM Q 1
"RTN","PSJOE",205,0)
 Q 0
"RTN","PSJORP2")
0^100^B17903646
"RTN","PSJORP2",1,0)
PSJORP2 ;BIR/JCH-CALCULATE FIRST DOSE FOR OE/RR 3.0 ;27 Feb 03 / 9:40 AM
"RTN","PSJORP2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**80,110,111**;16 DEC 97
"RTN","PSJORP2",3,0)
 ;
"RTN","PSJORP2",4,0)
 Q
"RTN","PSJORP2",5,0)
ENQ(PSGP,INFO) ; start
"RTN","PSJORP2",6,0)
 ; INFO (piece 1) = START DATE/TIME
"RTN","PSJORP2",7,0)
 ; INFO (piece 2) = STOP DATE/TIME
"RTN","PSJORP2",8,0)
 ; INFO (piece 3) = SCHEDULE
"RTN","PSJORP2",9,0)
 ; INFO (piece 4) = SCHEDULE TYPE
"RTN","PSJORP2",10,0)
 ; INFO (piece 5) = ORDERABLE ITEM
"RTN","PSJORP2",11,0)
 ; INFO (piece 6) = ADMIN TIMES
"RTN","PSJORP2",12,0)
 ;
"RTN","PSJORP2",13,0)
 N PSGNESD,PSGSD,PSGNEFD,PSGFD,PSGSCH,PSGST,PST,PSGS0XT,PSGS0Y,PSGED,SCHFREQ,FIRST,PSGDF,PSGS
"RTN","PSJORP2",14,0)
 S (PSGSD,PSGNESD)=$P(INFO,U),(PSGFD,PSGNEFD)=$P(INFO,U,2),PSGSCH=$P(INFO,U,3),(PSGST,PST)=$P(INFO,U,4),PSGS0Y=$P(INFO,U,6)
"RTN","PSJORP2",15,0)
 S PSGST=$S(PSGST="O":"O",1:"C"),PSGS0XT="",FIRST=""
"RTN","PSJORP2",16,0)
 Q:'PSGSD "" S X=PSGSCH D ADMIN^PSJORPOE
"RTN","PSJORP2",17,0)
 I ($P(INFO,"^",6)]""),($G(PSGS0Y)'=$P(INFO,"^",6)) S PSGS0Y=$P(INFO,"^",6)
"RTN","PSJORP2",18,0)
 I $G(PSJLSTAT),'$G(PSGS0XT),'$$DOW^PSIVUTL(PSGSCH) D
"RTN","PSJORP2",19,0)
 .N D,DA,X,PSGAT,PSGOES,PSGST,PSJNSS,PSJPWD,TEST,VALMBCK,PSGS0Y,PSGDT S X=$P(INFO,"^",3) I X]"" S PSGOES=1 D EN^PSGORS0
"RTN","PSJORP2",20,0)
 I '$G(PSJLSTAT) S X2=$S(PSGS0XT>1440:(PSGS0XT\1440)+1,1:7),X1=PSGSD D C^%DTC S (PSGFD,PSGNEFD)=X
"RTN","PSJORP2",21,0)
 I 'PSGS0Y S:PSGSCH["@" PSGS0Y=$P(PSGSCH,"@",2) I 'PSGS0Y S PSGS0Y=$P(PSGSD,".",2) I $G(PSGST)'="O",($E(PSGS0Y,1,2)<23) D
"RTN","PSJORP2",22,0)
 . N DCAL S DCAL=$E($$FMADD^XLFDT(PSGSD,0,1,0,0),9,10) S:DCAL PSGS0Y=DCAL
"RTN","PSJORP2",23,0)
 S PSGS=$S(PSGST="C":1,PSGST="P":2,PSGST="O":4,1:"")
"RTN","PSJORP2",24,0)
 S X2=PSGNESD,X1=PSGNEFD D ^%DTC S PSGDF=X+30
"RTN","PSJORP2",25,0)
 K PSGD S X=$P(PSGSD,"."),PSGDW="" F Q=0:1:PSGDF-1 S X1=$P(PSGSD,"."),X2=Q D:Q C^%DTC S PSGD(X)=$E(X,4,5)_"/"_$E(X,6,7),HX=X D DW^%DTC S $P(PSGD(HX),U,2)=X
"RTN","PSJORP2",26,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSJORP2",27,0)
 S PST=PSGST,PSGED=PSGSD D OS(PSGP,PSGST)
"RTN","PSJORP2",28,0)
 I $D(PSGD)<10 Q ""
"RTN","PSJORP2",29,0)
 D PRT(X) I $G(PSJLSTAT) S:$G(LAST)>PSGFD LAST=PSGFD Q +$G(LAST)
"RTN","PSJORP2",30,0)
 I $G(FIRST)<PSGSD S FIRST=PSGSD
"RTN","PSJORP2",31,0)
 K PSGD,TS,PSGGD,X,S,Q,QQ,QST
"RTN","PSJORP2",32,0)
 Q FIRST
"RTN","PSJORP2",33,0)
 ;
"RTN","PSJORP2",34,0)
OS(PSGP,PSGST) ; order record set
"RTN","PSJORP2",35,0)
 S SD=PSGNESD I $S($P(SD,".")>PSGNEFD:1,PSGS=1:PSGSCH["PRN",1:0) Q
"RTN","PSJORP2",36,0)
 S FD=PSGNEFD,T=PSGS0XT
"RTN","PSJORP2",37,0)
 S QST=$S(PST="C"!(PST="O"):PST,PST="OC":"OA",PST="P":"OP",PSGSCH["PRN":"OR",1:"CR")
"RTN","PSJORP2",38,0)
 S QQ="" I QST["C" D DTS(PSGSCH) S SD=$P(SD,"."),QQ="" F X=0:0 S X=$O(PSGD(X)) Q:'X  D
"RTN","PSJORP2",39,0)
 . S QQ=QQ_$S(X<SD:"",X>FD:"",'S:$P(PSGD(X),U),$D(S(X)):$P(PSGD(X),U),1:"")
"RTN","PSJORP2",40,0)
 I PSGS0XT="D",PSGS0Y="" S PSGS0Y=$P(PSGNESD,".",2)
"RTN","PSJORP2",41,0)
 S X=$S(QST["C"!(QST="O"):PSGS0Y,1:"")_U_QQ
"RTN","PSJORP2",42,0)
 Q
"RTN","PSJORP2",43,0)
 ;
"RTN","PSJORP2",44,0)
DTS(SCHEDULE) ;
"RTN","PSJORP2",45,0)
 K S S S=0 I SCHEDULE["@"!(PSGST="D") S WD=$S(SCHEDULE["@":$P(SCHEDULE,"@"),1:SCHEDULE) D
"RTN","PSJORP2",46,0)
 . F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q  F QQ=1:1:$L(WD,"-") I $P($P(PSGD(Q),U,2),$P(WD,"-",QQ))="" S S(Q)="",S=S+1 Q
"RTN","PSJORP2",47,0)
 Q:SCHEDULE["@"!(T="D")  Q:T'>1440  S WD=$P(PSGSD,".") I '(T#1440) S (SD,X)=$P(SD,"."),PSGT=T\1440 D
"RTN","PSJORP2",48,0)
 . F QQ=0:1 S X1=SD,X2=QQ*PSGT D:X2 C^%DTC I X'<WD S S=S+1 Q:X>PSGFD  Q:X>FD  S S(X)=""
"RTN","PSJORP2",49,0)
 K PSGT Q:'(T#1440)  S PSGT=T,X1=PSGSD,(ST,X2)=SD I PSGSD>SD D ^%DTC I X>1 S ST=$$EN^PSGCT(SD,X-1*1440\T*T)
"RTN","PSJORP2",50,0)
 S (PSGS,X)=ST F PSGX=0:1 S AM=PSGT*PSGX,ST=PSGS S:AM X=$$EN^PSGCT(ST,AM) S X=$P(X,".") I X'<WD Q:X>PSGFD  Q:X>FD  I '$D(S(X)) S S=S+1,S(X)=""
"RTN","PSJORP2",51,0)
 K AM,ST,PSGS,PSGT,PSGX Q
"RTN","PSJORP2",52,0)
 ;
"RTN","PSJORP2",53,0)
PRT(PSGTS) ; order info
"RTN","PSJORP2",54,0)
 S PSGGD=$P(PSGTS,"^",2),PSGTS=$P(PSGTS,"^") S PSJPSTO=PST
"RTN","PSJORP2",55,0)
 D TS(PSGTS) D FIRST D:$G(PSJLSTAT) LAST
"RTN","PSJORP2",56,0)
 S PSGOC=$G(PSGOC)+1
"RTN","PSJORP2",57,0)
 Q
"RTN","PSJORP2",58,0)
 ;
"RTN","PSJORP2",59,0)
FIRST ; find expected first dose
"RTN","PSJORP2",60,0)
 N QTS,ADMIN S FIRST=""
"RTN","PSJORP2",61,0)
 I PST["CZ" NEW PSGLFFD,PSGGD S P(9)="",PSGLFFD="9999999",PSGGD="" Q
"RTN","PSJORP2",62,0)
 I TS=1,'PSGTS S P(9)=1 K P(9) Q
"RTN","PSJORP2",63,0)
 F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q!$G(FIRST)  S ADMIN=0 F  S ADMIN=$O(TS(ADMIN)) Q:'ADMIN!$G(FIRST)  D
"RTN","PSJORP2",64,0)
 . S QTS=Q_"."_TS(ADMIN)
"RTN","PSJORP2",65,0)
 . S FIRST=$S(QTS<PSGSD:"",QTS'<PSGFD:"",PSGGD="":"",PSGGD[$P(PSGD(Q),"^"):QTS,1:"")
"RTN","PSJORP2",66,0)
 Q
"RTN","PSJORP2",67,0)
 ;
"RTN","PSJORP2",68,0)
LAST ; find expected last dose
"RTN","PSJORP2",69,0)
 N QTS,ADMIN S LAST=""
"RTN","PSJORP2",70,0)
 I PST["CZ" NEW PSGLFFD,PSGGD S P(9)="",PSGLFFD="9999999",PSGGD="" Q
"RTN","PSJORP2",71,0)
 I TS=1,'PSGTS S P(9)=1 K P(9) Q
"RTN","PSJORP2",72,0)
 S Q=99999999 F  S Q=$O(PSGD(Q),-1) Q:'Q!$G(LAST)  S ADMIN="" F  S ADMIN=$O(TS(ADMIN),-1) Q:'ADMIN!$G(LAST)  D
"RTN","PSJORP2",73,0)
 . S QTS=Q_"."_TS(ADMIN)
"RTN","PSJORP2",74,0)
 . S LAST=$S(QTS>PSGFD:"",QTS'>PSGSD:"",PSGGD="":"",PSGGD[$P(PSGD(Q),"^"):QTS,1:"")
"RTN","PSJORP2",75,0)
 Q
"RTN","PSJORP2",76,0)
 ;
"RTN","PSJORP2",77,0)
TS(X) ;
"RTN","PSJORP2",78,0)
 K TS S TS=$L(X,"-") F Q=1:1:TS S TS(Q)=$P(X,"-",Q)
"RTN","PSJORP2",79,0)
 Q
"RTN","PSJORP2",80,0)
 ;
"RTN","PSJORP2",81,0)
LASTAT(PSGP,INFO) ;
"RTN","PSJORP2",82,0)
 N LSTDT,PSJLSTAT S LASTAT=0,PSJLSTAT=1 S LASTAT=$$ENQ(PSGP,INFO)
"RTN","PSJORP2",83,0)
 I (LASTAT>$P(INFO,"^",2)!'LASTAT) S LASTAT=$P(INFO,"^",2)
"RTN","PSJORP2",84,0)
 K PSGD,TS,PSGGD,X,S,Q,QQ,QST
"RTN","PSJORP2",85,0)
 Q LASTAT
"RTN","PSJORRE")
0^60^B29873993
"RTN","PSJORRE",1,0)
PSJORRE ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) ;28 Jan 99 / 12:56 PM
"RTN","PSJORRE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**22,51,50,58,81,110,111**;16 DEC 97
"RTN","PSJORRE",3,0)
 ;
"RTN","PSJORRE",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRE",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRE",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRE",7,0)
 ;Reference to OTF^OR3CONV is supported by DBIA 2412.
"RTN","PSJORRE",8,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRE",9,0)
 ;
"RTN","PSJORRE",10,0)
OCL(DFN,BDT,EDT,TFN)         ; return condensed list of inpat meds
"RTN","PSJORRE",11,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y,PSJCLIN,A
"RTN","PSJORRE",12,0)
 ;Check if 5.0 order conversion should be run for the selected patient.
"RTN","PSJORRE",13,0)
 F  S X=$$OTF^OR3CONV(DFN,$S($E($G(IOST),1)="C":0,1:1)) Q:+X'<0  D
"RTN","PSJORRE",14,0)
 .I +X=-1 H 3
"RTN","PSJORRE",15,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRE",16,0)
 S:BDT="" BDT=DT S WBDT=BDT_".000001"
"RTN","PSJORRE",17,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRE",18,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRE",19,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  D UDTMP
"RTN","PSJORRE",20,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE",21,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT-1 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D IVTMP
"RTN","PSJORRE",22,0)
 Q
"RTN","PSJORRE",23,0)
 ;
"RTN","PSJORRE",24,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRE",25,0)
 N PROVIDER,RNWDT,EDTCMPLX,NDP2 S (MR,SCH,INST,PON)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRE",26,0)
 D TYPE
"RTN","PSJORRE",27,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE",28,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRE",29,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRE",30,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRE",31,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRE",32,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE",33,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRE",34,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRE",35,0)
 ;S UNITS="" I '$O(@(F_+ON_",1,1)")),DO="" S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2)
"RTN","PSJORRE",36,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(UNITS="") UNITS=1
"RTN","PSJORRE",37,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRE",38,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRE",39,0)
 S TFN=TFN+1
"RTN","PSJORRE",40,0)
 S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRE",41,0)
 S ^TMP("PS",$J,TFN,"CLINIC",0)=PSJCLIN
"RTN","PSJORRE",42,0)
 ;*S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_$P($G(^PS(55,DFN,5,+ON,0)),"^",22)_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))
"RTN","PSJORRE",43,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRE",44,0)
 I PROVIDER S ^TMP("PS",$J,TFN,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE",45,0)
 S ^TMP("PS",$J,TFN,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,TFN,"MDR",1,0)=MR
"RTN","PSJORRE",46,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PS",$J,TFN,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRE",47,0)
 ;S:$P(ND0,U,7)]"" ^TMP("PS",$J,TFN,"SCH",0)=1,$P(^TMP("PS",$J,TFN,"SCH",1,0),U,2)=$P(ND0,U,7)
"RTN","PSJORRE",48,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,TFN,"SIG",1,0)=INST
"RTN","PSJORRE",49,0)
 S ^TMP("PS",$J,TFN,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PS",$J,TFN,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRE",50,0)
 S ^TMP("PS",$J,TFN,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PS",$J,TFN,"SIO",1,0)=ND6
"RTN","PSJORRE",51,0)
 Q
"RTN","PSJORRE",52,0)
 ;
"RTN","PSJORRE",53,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRE",54,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM
"RTN","PSJORRE",55,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRE",56,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRE",57,0)
 D TYPE
"RTN","PSJORRE",58,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),TFN=TFN+1,CNT=0
"RTN","PSJORRE",59,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE",60,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PS",$J,TFN,"A",CNT,0)=Y
"RTN","PSJORRE",61,0)
 S ^TMP("PS",$J,TFN,"A",0)=CNT,CNT=0
"RTN","PSJORRE",62,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PS",$J,TFN,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRE",63,0)
 S ^TMP("PS",$J,TFN,"B",0)=CNT
"RTN","PSJORRE",64,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRE",65,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE",66,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRE",67,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRE",68,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRE",69,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE",70,0)
 ;S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN_U_INFUS_U_$P(ND0,U,3)_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT
"RTN","PSJORRE",71,0)
 S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRE",72,0)
 S ^TMP("PS",$J,TFN,"CLINIC",0)=PSJCLIN
"RTN","PSJORRE",73,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRE",74,0)
 I PROVIDER S ^TMP("PS",$J,TFN,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE",75,0)
 S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4)
"RTN","PSJORRE",76,0)
 I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRE",77,0)
 S ^TMP("PS",$J,TFN,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,TFN,"MDR",1,0)=MR
"RTN","PSJORRE",78,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,TFN,"SIG",1,0)=INST
"RTN","PSJORRE",79,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PS",$J,TFN,"SCH",1,0)=SCH
"RTN","PSJORRE",80,0)
 ;I FON["P" S:$P(ND0,U,7)]"" ^TMP("PS",$J,TFN,"SCH",0)=1,$P(^TMP("PS",$J,TFN,"SCH",1,0),U,2)=$P(ND0,U,7)
"RTN","PSJORRE",81,0)
 S ^TMP("PS",$J,TFN,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PS",$J,TFN,"ADM",1,0)=ADM
"RTN","PSJORRE",82,0)
 S ^TMP("PS",$J,TFN,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PS",$J,TFN,"SIO",1,0)=SIO
"RTN","PSJORRE",83,0)
 I $G(IVLIM)]"" S ^TMP("PS",$J,TFN,"IVLIM",0)=IVLIM
"RTN","PSJORRE",84,0)
 Q
"RTN","PSJORRE",85,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRE",86,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRE",87,0)
 Q X
"RTN","PSJORRE",88,0)
TYPE ;determine if this is an IMO order or not
"RTN","PSJORRE",89,0)
 S (A,PSJCLIN)="" I F["PS(53.1" S A=$G(^PS(53.1,ON,"DSS"))
"RTN","PSJORRE",90,0)
 I F["PS(55" S A=$S(F["IV":$G(^PS(55,DFN,"IV",ON,"DSS")),1:$G(^PS(55,DFN,5,ON,8)))
"RTN","PSJORRE",91,0)
 I $P(A,"^",2)'="" S PSJCLIN=+A
"RTN","PSJORRE",92,0)
 Q
"RTN","PSJORRE1")
0^113^B37494898
"RTN","PSJORRE1",1,0)
PSJORRE1 ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (EXPANDED) ;29 Jan 99 / 8:49 AM
"RTN","PSJORRE1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**22,51,50,58,81,91,110,111**;16 DEC 97
"RTN","PSJORRE1",3,0)
 ;
"RTN","PSJORRE1",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJORRE1",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRE1",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRE1",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRE1",8,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJORRE1",9,0)
 ; Reference to OTF^OR3CONV is supported by DBIA 2412.
"RTN","PSJORRE1",10,0)
 ; Reference to ^TMP("PS" is documented in DBIA #2384.
"RTN","PSJORRE1",11,0)
 ;
"RTN","PSJORRE1",12,0)
OEL(DFN,ON)         ; return list of expanded inpat meds
"RTN","PSJORRE1",13,0)
 K ^TMP("PS",$J)
"RTN","PSJORRE1",14,0)
 N ADM,CNT,DN,DO,F,INFUS,INST,MR,ND,ND0,ND2,ND2P5,ND6,NDOI,SCH,SIO,START,STAT,STOP,TYP,UNITS,X,Y
"RTN","PSJORRE1",15,0)
 ;Check if 5.0 order conversion should be run for the selected patient.
"RTN","PSJORRE1",16,0)
 ;I '$P($G(^PS(55,DFN,5.1)),U,11) D CONVERT^PSJUTL1(DFN,0)
"RTN","PSJORRE1",17,0)
 F  S X=$$OTF^OR3CONV(DFN,$S($E(IOST,1)="C":0,1:1)) Q:+X'<0  D
"RTN","PSJORRE1",18,0)
 .I +X=-1 H 3
"RTN","PSJORRE1",19,0)
 S F=$S(ON["P":"^PS(53.1,",ON["U":"^PS(55,DFN,5,",1:"^PS(55,"_DFN_",""IV"",")
"RTN","PSJORRE1",20,0)
 I ON'["P",'$D(@(F_+ON_")")) Q
"RTN","PSJORRE1",21,0)
 I ON["P" S X=$G(^PS(53.1,+ON,0)) Q:$P(X,U,15)'=DFN  S TYP=$P(X,U,4) D @$S(TYP="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE1",22,0)
 D:ON'["P" @$S(ON["U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE1",23,0)
 S Y=$S(ON["V":5,1:12),CNT=0
"RTN","PSJORRE1",24,0)
 I $O(@(F_+ON_","_Y_",0)")) D
"RTN","PSJORRE1",25,0)
 . F X=0:0 S X=$O(@(F_+ON_","_Y_","_X_")")) Q:'X  D
"RTN","PSJORRE1",26,0)
 ..S CNT=CNT+1,ND=$G(@(F_+ON_","_Y_","_X_",0)")),^TMP("PS",$J,"PC",CNT,0)=ND
"RTN","PSJORRE1",27,0)
 S ^TMP("PS",$J,"PC",0)=CNT
"RTN","PSJORRE1",28,0)
 Q
"RTN","PSJORRE1",29,0)
 ;
"RTN","PSJORRE1",30,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRE1",31,0)
 N DO,DN,INST,X,Y,PROVIDER,NOTGIVEN,RNWDT
"RTN","PSJORRE1",32,0)
 S (MR,SCH,INST)=""
"RTN","PSJORRE1",33,0)
 S ND2=$G(@(F_+ON_",2)")),ND0=$G(@(F_+ON_",0)"))
"RTN","PSJORRE1",34,0)
 S ND6=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE1",35,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,ON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE1",36,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(ON["P":53.1,1:55.06),28)
"RTN","PSJORRE1",37,0)
 D DRGDISP^PSJLMUT1(DFN,ON,40,0,.DN,1)
"RTN","PSJORRE1",38,0)
 S NDOI=$G(@(F_+ON_",.2)")),DO=$P(NDOI,U,2)
"RTN","PSJORRE1",39,0)
 ;S UNITS="" I '$O(@(F_+ON_",1,1)")),DO="" S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2)
"RTN","PSJORRE1",40,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(ON["U")&(UNITS="") UNITS=1
"RTN","PSJORRE1",41,0)
 S MR=$$MR(+$P(ND0,U,3)),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE1",42,0)
 S NOTGIVEN=$S(ON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRE1",43,0)
 S ^TMP("PS",$J,0)=DN(1)_"^^"_$P(ND2,U,4)_"^^"_$P(ND2,U,2)_U_STAT_"^^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_U_$G(RNWDT)
"RTN","PSJORRE1",44,0)
 ;S ^TMP("PS",$J,0)=DN(1)_"^^"_$P(ND2,U,4)_"^^"_$P(ND2,U,2)_U_STAT_"^^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_U_$P($G(^PS(55,DFN,5,+ON,0)),"^",22)_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))
"RTN","PSJORRE1",45,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRE1",46,0)
 I PROVIDER S ^TMP("PS",$J,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE1",47,0)
 S ^TMP("PS",$J,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,"MDR",1,0)=MR
"RTN","PSJORRE1",48,0)
 S ^TMP("PS",$J,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PS",$J,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRE1",49,0)
 S:$P(ND0,U,7)]"" ^TMP("PS",$J,"SCH",0)=1,$P(^TMP("PS",$J,"SCH",1,0),U,2)=$$GTSCHT($P(ND0,U,7))_"^"_$P(ND0,U,7)
"RTN","PSJORRE1",50,0)
 S ^TMP("PS",$J,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,"SIG",1,0)=INST
"RTN","PSJORRE1",51,0)
 S ^TMP("PS",$J,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PS",$J,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRE1",52,0)
 S ^TMP("PS",$J,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PS",$J,"SIO",1,0)=ND6
"RTN","PSJORRE1",53,0)
 NEW VERPHARM S:ON["U" VERPHARM=$P($G(@(F_+ON_",4)")),U,3)
"RTN","PSJORRE1",54,0)
 S:+$G(VERPHARM) $P(^TMP("PS",$J,"RXN",0),U,5)=VERPHARM
"RTN","PSJORRE1",55,0)
 NEW PSJDD,INACTDT,NDDD,OUTOI,PSJOUT S CNT=0
"RTN","PSJORRE1",56,0)
 F PSJDD=0:0 S PSJDD=$O(@(F_+ON_",1,PSJDD)")) Q:'PSJDD  D
"RTN","PSJORRE1",57,0)
 . S NDDD=@(F_+ON_",1,PSJDD,0)")
"RTN","PSJORRE1",58,0)
 . I $P(NDDD,U,3)]"",($P(NDDD,U,3)'>DT) Q
"RTN","PSJORRE1",59,0)
 . S PSJOUT=$P($G(^PSDRUG(+NDDD,8)),U,5)
"RTN","PSJORRE1",60,0)
 . I +PSJOUT D
"RTN","PSJORRE1",61,0)
 .. S INACTDT=$G(^PSDRUG(+PSJOUT,"I")),OUTOI=+$G(^PSDRUG(+PSJOUT,2))
"RTN","PSJORRE1",62,0)
 .. I INACTDT]"",(INACTDT'>DT) S (PSJOUT,OUTOI)=""
"RTN","PSJORRE1",63,0)
 . I '+PSJOUT,($P($G(^PSDRUG(+NDDD,2)),U,3)["O") D
"RTN","PSJORRE1",64,0)
 .. S PSJOUT=+NDDD,OUTOI=+NDOI
"RTN","PSJORRE1",65,0)
 .. S INACTDT=$G(^PSDRUG(+NDDD,"I"))
"RTN","PSJORRE1",66,0)
 .. I INACTDT]"",(INACTDT'>DT) S (PSJOUT,OUTOI)=""
"RTN","PSJORRE1",67,0)
 . ;* S UNITS=$S('+$P(NDDD,U,2):1,1:$P(NDDD,U,2))
"RTN","PSJORRE1",68,0)
 . S UNITS=$P(NDDD,U,2) S:(ON["U")&(UNITS="") UNITS=1
"RTN","PSJORRE1",69,0)
 . S CNT=CNT+1,^TMP("PS",$J,"DD",CNT,0)=+NDDD_U_UNITS_U_PSJOUT_U_$G(OUTOI)
"RTN","PSJORRE1",70,0)
 S ^TMP("PS",$J,"DD",0)=CNT
"RTN","PSJORRE1",71,0)
 Q
"RTN","PSJORRE1",72,0)
 ;
"RTN","PSJORRE1",73,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRE1",74,0)
 N PROVIDER,RNWDT,IVLIM S ND0=$G(@(F_+ON_",0)")),CNT=0
"RTN","PSJORRE1",75,0)
 F X=0:0 S X=$O(@(F_+ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_+ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PS",$J,"A",CNT,0)=Y
"RTN","PSJORRE1",76,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,ON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE1",77,0)
 S ^TMP("PS",$J,"A",0)=CNT,CNT=0
"RTN","PSJORRE1",78,0)
 F X=0:0 S X=$O(@(F_+ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_+ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PS",$J,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRE1",79,0)
 S ^TMP("PS",$J,"B",0)=CNT
"RTN","PSJORRE1",80,0)
 S INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE1",81,0)
 I ON["P" D
"RTN","PSJORRE1",82,0)
 . S SCH=$P($G(^PS(53.1,+ON,2)),U)
"RTN","PSJORRE1",83,0)
 . S PROVIDER=$P(ND0,U,2)
"RTN","PSJORRE1",84,0)
 . S MR=$$MR(+$P(ND0,U,3)),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28)
"RTN","PSJORRE1",85,0)
 . S INFUS=$P($G(^PS(53.1,+ON,8)),U,5)
"RTN","PSJORRE1",86,0)
 . S ND2=$G(@(F_+ON_",2)")),START=$P(ND2,U,2),STOP=$P(ND2,U,4)
"RTN","PSJORRE1",87,0)
 . S ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE1",88,0)
 . S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRE1",89,0)
 I ON'["P"  D
"RTN","PSJORRE1",90,0)
 . S PROVIDER=$P(ND0,U,6)
"RTN","PSJORRE1",91,0)
 . S SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100)
"RTN","PSJORRE1",92,0)
 . S MR=$$MR(+$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3))
"RTN","PSJORRE1",93,0)
 . S START=$P(ND0,U,2),STOP=$P(ND0,U,3)
"RTN","PSJORRE1",94,0)
 . S ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRE1",95,0)
 . NEW VERPHARM S VERPHARM=$P($G(^PS(55,DFN,"IV",+ON,4)),U,4)
"RTN","PSJORRE1",96,0)
 . S:+VERPHARM $P(^TMP("PS",$J,"RXN",0),U,5)=VERPHARM
"RTN","PSJORRE1",97,0)
 . S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRE1",98,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRE1",99,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRE1",100,0)
 S ^TMP("PS",$J,0)=DN_U_INFUS_U_STOP_"^^"_START_U_STAT_"^^^"_DO_"^^"_$P(ND0,U,21)_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_U_$G(RNWDT)
"RTN","PSJORRE1",101,0)
 ;*S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRE1",102,0)
 I PROVIDER S ^TMP("PS",$J,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE1",103,0)
 S ^TMP("PS",$J,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,"MDR",1,0)=MR
"RTN","PSJORRE1",104,0)
 S ^TMP("PS",$J,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PS",$J,"SCH",1,0)=SCH
"RTN","PSJORRE1",105,0)
 I ON["P" S:$P(ND0,U,7)]"" ^TMP("PS",$J,"SCH",0)=1,$P(^TMP("PS",$J,"SCH",1,0),U,2)=$$GTSCHT($P(ND0,U,7))_"^"_$P(ND0,U,7)
"RTN","PSJORRE1",106,0)
 S ^TMP("PS",$J,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,"SIG",1,0)=INST
"RTN","PSJORRE1",107,0)
 S ^TMP("PS",$J,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PS",$J,"ADM",1,0)=ADM
"RTN","PSJORRE1",108,0)
 S ^TMP("PS",$J,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PS",$J,"SIO",1,0)=SIO
"RTN","PSJORRE1",109,0)
 I $G(IVLIM)]"" S ^TMP("PS",$J,"IVLIM",0)=$G(IVLIM)
"RTN","PSJORRE1",110,0)
 Q
"RTN","PSJORRE1",111,0)
 ;
"RTN","PSJORRE1",112,0)
MR(X) ;RETURN MED ROUTE ABBR. IF THE ABBR="" RETURN MED ROUTE'S NAME.
"RTN","PSJORRE1",113,0)
 S X=$G(^PS(51.2,X,0))
"RTN","PSJORRE1",114,0)
 Q $S($P(X,U,3)]"":$P(X,U,3),1:$P(X,U))
"RTN","PSJORRE1",115,0)
 ;
"RTN","PSJORRE1",116,0)
GTSTAT(X) ;
"RTN","PSJORRE1",117,0)
 Q $S(X="A":"ACTIVE",X="D":"DISCONTINUED",X="I":"INCOMPLETE",X="N":"NON-VERFIED",X="U":"UNRELEASED",X="P":"PENDING",X="DE":"DISCONTINUED (EDIT)",X="O":"ON CALL",1:"NOT FOUND")
"RTN","PSJORRE1",118,0)
 ;
"RTN","PSJORRE1",119,0)
VA200(X) ;Return the IEN for the user.
"RTN","PSJORRE1",120,0)
 ; X = User name
"RTN","PSJORRE1",121,0)
 NEW DIC,Y S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSJORRE1",122,0)
 I +Y=-1 Q ""
"RTN","PSJORRE1",123,0)
 Q $P(Y,U)
"RTN","PSJORRE1",124,0)
GTSCHT(X)       ;
"RTN","PSJORRE1",125,0)
 Q $S(X="C":"CONTINUOUS",X="O":"ONE TIME",X="P":"PRN",X="R":"FILL ON REQUEST",X="OC":"ON CALL",1:"NOT FOUND")
"RTN","PSJPDIR")
0^13^B26737519
"RTN","PSJPDIR",1,0)
PSJPDIR ;BIR/MLM-PATIENT PROFILE CALLS ;10 MAY 96 / 9:56 AM
"RTN","PSJPDIR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**53,111**;16 DEC 97
"RTN","PSJPDIR",3,0)
 ;
"RTN","PSJPDIR",4,0)
 ; Reference to ^DIC is supported by DBIA 10006
"RTN","PSJPDIR",5,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSJPDIR",6,0)
 ; Reference to ^VADPT is supported by DBIA 10061
"RTN","PSJPDIR",7,0)
 ;
"RTN","PSJPDIR",8,0)
GWP ; Ask for seletion by WARD GROUP,WARD or PATIENT.
"RTN","PSJPDIR",9,0)
 K PSJSEL,DIR S PSJSTOP="",DIR(0)="SAO^G:Ward Group;W:Ward;P:Patient",DIR("A")="Select by WARD GROUP (G), WARD (W), or PATIENT (P): "
"RTN","PSJPDIR",10,0)
 S DIR("?")="To select by PATIENT, enter a 'P'."
"RTN","PSJPDIR",11,0)
 S DIR("?",1)="To select the entire WARD GROUP, enter a 'G'."
"RTN","PSJPDIR",12,0)
 S DIR("?",2)="To select a single WARD, enter a 'W'."
"RTN","PSJPDIR",13,0)
 W !! D ^DIR K DIR S PSJSTOP=$S(Y="":1,Y<0:1,$$STOP:1,1:0)
"RTN","PSJPDIR",14,0)
 I 'PSJSTOP S PSJSEL("SELECT")=Y D @Y Q:($G(PSJSEL("WG"))="^OTHER")  G:PSJSTOP GWP D:PSJSEL("SELECT")'="P" RBPPN G:PSJSTOP GWP
"RTN","PSJPDIR",15,0)
 Q
"RTN","PSJPDIR",16,0)
 ;
"RTN","PSJPDIR",17,0)
P ;*** Select by Patient
"RTN","PSJPDIR",18,0)
 N PSJACNWP,PSGDICA,PSGPAT S PSJACNWP=""
"RTN","PSJPDIR",19,0)
 F PFLG=0:1 S:PFLG PSGDICA="another" D ^PSJP Q:PSGP<0  S PSJSEL("P",PSGP(0),PSGP)="" S:'$G(PSJPWDO) (PSGWD,PSJPWDO)=PSJPWD S PSGWD=$S('$G(PSGWD):0,PSJPWDO=PSJPWD:PSJPWD,1:0)
"RTN","PSJPDIR",20,0)
 S PSJSTOP=$S($D(DTOUT):1,$D(DUOUT):1,(Y<0)&'$D(PSGDICA):1,1:0)
"RTN","PSJPDIR",21,0)
 Q
"RTN","PSJPDIR",22,0)
 ;
"RTN","PSJPDIR",23,0)
W ;*** Select by WARD
"RTN","PSJPDIR",24,0)
 K DIC S DIC="^DIC(42,",DIC(0)="QEAMIZ",DIC("A")="Select a Ward: " W !! D ^DIC
"RTN","PSJPDIR",25,0)
 S PSJSTOP=$S(Y="":1,Y<0:1,$$STOP:1,1:0)
"RTN","PSJPDIR",26,0)
 I 'PSJSTOP S PSJSEL("W")=Y D ADMTM
"RTN","PSJPDIR",27,0)
 Q
"RTN","PSJPDIR",28,0)
 ;
"RTN","PSJPDIR",29,0)
G ;***Select by WARD GROUP
"RTN","PSJPDIR",30,0)
 K DIC S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select a Ward Group: " W !! D ^DIC
"RTN","PSJPDIR",31,0)
 S PSJSTOP=$S(X="^OTHER":2,Y="":1,Y<0:1,$$STOP:1,1:0)
"RTN","PSJPDIR",32,0)
 ;I PSJSTOP=2 S PSJSTOP=0,PSJSEL("WG")="^OTHER" Q
"RTN","PSJPDIR",33,0)
 I PSJSTOP=2 S PSJSEL("WG")="^OTHER" Q
"RTN","PSJPDIR",34,0)
 I 'PSJSTOP S PSJSEL("WG")=Y
"RTN","PSJPDIR",35,0)
 Q
"RTN","PSJPDIR",36,0)
 ;
"RTN","PSJPDIR",37,0)
ADMTM ;*** Askif user want to sort by admin team
"RTN","PSJPDIR",38,0)
 N DIR S DIR(0)="YO",DIR("A")="Do you want to sort by Administration Team (Y/N)",DIR("B")="NO",DIR("?")="Enter ""YES"" to sort this report by Administration Team." W !! D ^DIR Q:$$STOP!'+Y
"RTN","PSJPDIR",39,0)
 ;
"RTN","PSJPDIR",40,0)
 ;*** Because "ALL" is not a team, must use DIR to include "ALL"
"RTN","PSJPDIR",41,0)
 ;    default and then call DIC to look up the selected team
"RTN","PSJPDIR",42,0)
 ;
"RTN","PSJPDIR",43,0)
 F  Q:$$STOP!(X="")!$D(PSJSEL("TM","ALL"))  D ADMTM2
"RTN","PSJPDIR",44,0)
 Q
"RTN","PSJPDIR",45,0)
ADMTM2 ;
"RTN","PSJPDIR",46,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select Administration Team: ",DIR("B")="ALL",DIR("?")="^D TM2HLP^PSJPDIR,DICTM^PSJPDIR"
"RTN","PSJPDIR",47,0)
 W !! D ^DIR Q:$$STOP  I Y="ALL" S PSJSEL("TM","ALL")="" Q
"RTN","PSJPDIR",48,0)
 D DICTM
"RTN","PSJPDIR",49,0)
 S PSJSTOP=$S($D(DTOUT):1,$D(DUOUT):1,(Y<0)&'$D(PFLG):1,1:0)
"RTN","PSJPDIR",50,0)
 Q
"RTN","PSJPDIR",51,0)
TM2HLP W !!,"Enter the name of an Administration Team that you want",!,"to include on the report."," Enter ""ALL"" (or accept the",!,"default) to include all teams on the report.",!
"RTN","PSJPDIR",52,0)
 Q
"RTN","PSJPDIR",53,0)
 ;
"RTN","PSJPDIR",54,0)
DICTM ;*** LooK up a team.
"RTN","PSJPDIR",55,0)
 ;
"RTN","PSJPDIR",56,0)
 K DIC S DIC="^PS(57.7,"_+PSJSEL("W")_",1,",DIC(0)="QEMIZ"
"RTN","PSJPDIR",57,0)
 F PFLG=0:1 D ^DIC Q:Y<0  I PFLG S DIC(0)=DIC(0)_"A",DIC("A")="Select another Administration Team: " S PSJSEL("TM",+Y)=Y(0,0)
"RTN","PSJPDIR",58,0)
 Q
"RTN","PSJPDIR",59,0)
 ;
"RTN","PSJPDIR",60,0)
RBPPN ;*** Sort by ROOM-BED or PATIENT
"RTN","PSJPDIR",61,0)
 ;
"RTN","PSJPDIR",62,0)
 K DIR S DIR(0)="SAO^R:Room-Bed;P:Patient",DIR("A")="Do you wish to sort by Room-Bed (R), Patient (P): ",DIR("B")="Patient"
"RTN","PSJPDIR",63,0)
 W !! D ^DIR Q:$$STOP  S PSJSEL("RBP")=Y
"RTN","PSJPDIR",64,0)
 Q
"RTN","PSJPDIR",65,0)
ENL ;
"RTN","PSJPDIR",66,0)
 F  W !!,"SHORT, LONG, or NO Profile?  ",$S('$D(PSJPWD):"SHORT",PSJPWD:"SHORT",1:"LONG"),"// " R PSJOL:DTIME W:'$T $C(7) S:'$T PSJOL="^" Q:PSJOL="^"  D LCHK Q:"^SLN"[PSJOL&($L(PSJOL)=1)
"RTN","PSJPDIR",67,0)
 Q
"RTN","PSJPDIR",68,0)
 ;
"RTN","PSJPDIR",69,0)
LCHK ;
"RTN","PSJPDIR",70,0)
 I PSJOL?1."?" D LM Q
"RTN","PSJPDIR",71,0)
 I PSJOL="" S PSJOL=$S('$D(PSJPWD):"S",PSJPWD:"S",1:"L") W $P("  SHORT^  LONG","^",PSJOL="L"+1) Q
"RTN","PSJPDIR",72,0)
 I PSJOL?.ANP,PSJOL?.E1L.E F Q=1:1:$L(PSJOL) I $E(PSJOL,Q)?.L S PSJOL=$E(PSJOL,1,Q-1)_$C($A(PSJOL,Q)-32)_$E(PSJOL,Q+1,$L(PSJOL))
"RTN","PSJPDIR",73,0)
 I PSJOL?.ANP F X="NO PROFILE","LONG","SHORT" I $P(X,PSJOL)="" W $P(X,PSJOL,2) S PSJOL=$E(PSJOL) Q
"RTN","PSJPDIR",74,0)
 W:'$T $C(7),"  ??" Q
"RTN","PSJPDIR",75,0)
 ;
"RTN","PSJPDIR",76,0)
LM ;Profile Type
"RTN","PSJPDIR",77,0)
 W !!?2,"Enter 'SHORT' (or 'S', or press the RETURN key) to exclude this patient's",!,"discontinued and expired orders in the following profile.  Enter 'LONG' (or 'L') to include those orders."
"RTN","PSJPDIR",78,0)
 W "  Enter 'NO' (or 'N') to bypass the profile com-",!,"pletely.  Enter '^' if you wish to go no further with this patient." Q
"RTN","PSJPDIR",79,0)
ENDPT ;*** get patient ***
"RTN","PSJPDIR",80,0)
 K DIC,PSGP,Y W !!,"Select "_$S($D(PSGDICA):PSGDICA_" ",1:"")_"PATIENT: " R X:DTIME I "^"[X S (Y,PSGP)=-1 G DONE
"RTN","PSJPDIR",81,0)
 D EN^PSJDPT
"RTN","PSJPDIR",82,0)
 I Y'>0 G ENDPT
"RTN","PSJPDIR",83,0)
 K DIC
"RTN","PSJPDIR",84,0)
 ;
"RTN","PSJPDIR",85,0)
CHK ;*** Check patient status ***
"RTN","PSJPDIR",86,0)
 S PPN=$P(Y,U,2),(DFN,PSGP)=+Y,VA200=1 D INP^VADPT Q:VAIN(4)
"RTN","PSJPDIR",87,0)
 S PSJPCAF="",VAIP("D")="L" D IN5^VADPT I 'VAIP(13,1) W $C(7),!!?3,"PATIENT HAS NEVER BEEN ADMITTED." G ENDPT
"RTN","PSJPDIR",88,0)
 S X=+VAIP(4)=12!(+VAIP(4)=38) W $C(7),!!?3,"PATIENT IS FOUND TO BE D",$P("ISCHARG^ECEAS",U,X+1),"ED AS OF ",$$ENDTC^PSGMI(+VAIP(3)),"." G ENDPT
"RTN","PSJPDIR",89,0)
 Q
"RTN","PSJPDIR",90,0)
 ;
"RTN","PSJPDIR",91,0)
STOP() ;
"RTN","PSJPDIR",92,0)
 ;
"RTN","PSJPDIR",93,0)
 S PSJSTOP=$S($D(DTOUT):1,$D(DUOUT):1,$D(DIRUT):1,1:0)
"RTN","PSJPDIR",94,0)
 Q PSJSTOP
"RTN","PSJPDIR",95,0)
 ;
"RTN","PSJPDIR",96,0)
DONE ;
"RTN","PSJPDIR",97,0)
 K DA,DIC,DIK
"RTN","PSJPDIR",98,0)
 Q
"RTN","PSJPR")
0^14^B40003412
"RTN","PSJPR",1,0)
PSJPR ;BIR/CML3-INPATIENT MEDICATIONS PROFILE ;25 SEP 97 / 7:43 AM
"RTN","PSJPR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**31,111**;16 DEC 97
"RTN","PSJPR",3,0)
 ;
"RTN","PSJPR",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJPR",5,0)
 ;
"RTN","PSJPR",6,0)
 N PFLG,PSJNEW,PSGPTMP,PPAGE,QFLG S PSJNEW=1
"RTN","PSJPR",7,0)
 N PSGLI,PSGWD,PSJAT,PSJPNRB,PSJPWDO,PSJSTOP,PSJTEAM
"RTN","PSJPR",8,0)
 ;
"RTN","PSJPR",9,0)
EN ;
"RTN","PSJPR",10,0)
 G:$D(XQUIT) DONE
"RTN","PSJPR",11,0)
 D @$S('$D(PSJEXTP):"^PSIVXU",1:"ENCV^PSGSETU")
"RTN","PSJPR",12,0)
 G:$D(XQUIT) DONE S PSGPTMP=0,PPAGE=1 K PSJSEL D @$S($D(PSJEXTP):"P^PSJPDIR",1:"GWP^PSJPDIR") G:$G(PSJSTOP)=1 DONE S:$D(PSJEXTP) PSJSEL("SELECT")="P"
"RTN","PSJPR",13,0)
 I $G(PSJSEL("WG"))="^OTHER",PSJSEL("SELECT")="G",PSJSTOP=2 S PSJSEL("SELECT")="C",PSJSEL("RBP")="P"
"RTN","PSJPR",14,0)
 D ENL^PSJO3 G:"^N"[PSJOL EN D GO
"RTN","PSJPR",15,0)
 ;
"RTN","PSJPR",16,0)
DONE ;
"RTN","PSJPR",17,0)
 K ^TMP("PSJON",$J),^TMP("PSJ",$J)
"RTN","PSJPR",18,0)
 D ENIVKV^PSGSETU K AND,AT,C,CA,DDH,DFN,DN,DOB,DRGI,DRGN,DRGT,FIL,FQC,HDR,I1,J,JJ,MF,NF,O,OD,ON,ON55,P,P1,PDRG,PG,PPN,PRI,PRIV,PSGLMT,PSGOE,PSGONC,PSGONR,PSGONV,PSGORD,PSGSS,PSGSSH,PSGON,PSGPR,PSGPRP
"RTN","PSJPR",19,0)
 K PSIVAC,PSIVCT,PSIVREA,PSIVSCR,PSIVUP,PSIVX
"RTN","PSJPR",20,0)
 K PSJACNWP,PSJACOK,PSJDEV,PSJDBL,PSJION,PSJOL,PSJON,PSJOS,PSJP,PSJSEL,PSJSS,PSJSSH,PSJPRW,PSJPRWN,PSJPRWG,PSJPRWGN
"RTN","PSJPR",21,0)
 K PSJOPC,PSJORD,PSJQ,PSJIVOF,PSJOCNT,PSJPR,PSJPRA,PSJPRF,PSJPRP,PSJON,PSJS1,PSJS2,PSJS3,PSJS4,PSJPR,PX,HDT,PSGODT,RF,SD,SLS,SSN,TF,UD,WD,WDP,WT,PSJORIFN,RB,RCT,SUB,XQUIT,ZTOUT
"RTN","PSJPR",22,0)
 ;* 
"RTN","PSJPR",23,0)
 ;* K PSGLI,PSGWD,PSJAT,PSJPNRB,PSJPWDO,PSJSTOP,PSJTEAM
"RTN","PSJPR",24,0)
 Q
"RTN","PSJPR",25,0)
 ;
"RTN","PSJPR",26,0)
GO ;
"RTN","PSJPR",27,0)
 S PSJPRP="P",PSJPRA="" G:PSJSEL("SELECT")'="P" DEV
"RTN","PSJPR",28,0)
 N DIR S DIR(0)="SAO^P:PROFILE;E:EXPANDED VIEWS;B:BOTH",DIR("A")="Show PROFILE only, EXPANDED VIEWS only, or BOTH: ",DIR("B")="PROFILE",DIR("?")="^D PH^PSJPR" W ! D ^DIR G:"^"[Y EN S PSJPRP=Y
"RTN","PSJPR",29,0)
 I "EB"[PSJPRP F  R !!,"Show SHORT, LONG, or NO activity log?  NO// ",AT:DTIME D ALC^PSGVW0 I Q S PSJPRA=AT Q
"RTN","PSJPR",30,0)
 G:PSJPRA="^" EN
"RTN","PSJPR",31,0)
DEV ;
"RTN","PSJPR",32,0)
 S PSJOS=$P(PSJSYSP0,"^",11)
"RTN","PSJPR",33,0)
 K ZTSAVE S PSGTIR="ENQ^PSJPR",ZTDESC="INPATIENT PATIENT PROFILE" F X="DFN","PSJSEL(","PSJOL","PSJOS","PSJPRA","PSJPRP","PSGPTMP","PPAGE","PSJEXTP","PSJHDATE" S ZTSAVE(X)=""
"RTN","PSJPR",34,0)
 D ENDEV^PSGTI Q:POP  D:'$D(IO("Q")) ENQ G EN
"RTN","PSJPR",35,0)
 Q
"RTN","PSJPR",36,0)
 ;
"RTN","PSJPR",37,0)
ENQ ;
"RTN","PSJPR",38,0)
 S Y="PSJPR" F X="W","WG" S:$D(PSJSEL(X)) @(Y_X)=+PSJSEL(X),@(Y_X_"N")=$P(PSJSEL(X),U,2)
"RTN","PSJPR",39,0)
 S PSJACNWP=1 K ^TMP("PSJAT",$J) S PSJPR=IO'=IO(0)!($E(IOST)'="C"),PSGPRP=PSJPRP
"RTN","PSJPR",40,0)
 I PSJSEL("SELECT")="P" S PPN="" F  S PPN=$O(PSJSEL("P",PPN)) Q:PPN=""  D  Q:$G(X)?1"^"."^"
"RTN","PSJPR",41,0)
 .F DFN=0:0 S (PSGP,DFN)=$O(PSJSEL("P",PPN,DFN)) Q:'DFN  D ENBOTH^PSJAC,PP Q:$G(X)?1"^"."^"
"RTN","PSJPR",42,0)
 D:PSJSEL("SELECT")'="P" @("P"_PSJSEL("SELECT")) I PSJPR W:$Y @IOF D ^%ZISC,DONE
"RTN","PSJPR",43,0)
 Q
"RTN","PSJPR",44,0)
PC ;
"RTN","PSJPR",45,0)
 K ^TMP("PSJPR",$J,"OUTPAT")
"RTN","PSJPR",46,0)
 S (STDTE,CLINIC,JDFN)=0
"RTN","PSJPR",47,0)
 F  S STDTE=$O(^PS(55,"AIVC",STDTE)) Q:STDTE=""  F  S CLINIC=$O(^PS(55,"AIVC",STDTE,CLINIC)) Q:CLINIC=""  D
"RTN","PSJPR",48,0)
 . F  S JDFN=$O(^PS(55,"AIVC",STDTE,CLINIC,JDFN)) Q:JDFN=""  I '$D(^TMP("PSJPR",$J,"OUTPAT",JDFN)) S DFN=JDFN K ^TMP("PSJAT",$J) D PAT,PJ
"RTN","PSJPR",49,0)
 S (STDTE,CLINIC,JDFN)=0
"RTN","PSJPR",50,0)
 F  S STDTE=$O(^PS(55,"AUDC",STDTE)) Q:STDTE=""  F  S CLINIC=$O(^PS(55,"AIVC",STDTE,CLINIC)) Q:CLINIC=""  D
"RTN","PSJPR",51,0)
 . F  S JDFN=$O(^PS(55,"AUDC",STDTE,CLINIC,JDFN)) Q:JDFN=""  I '$D(^TMP("PSJPR",$J,"OUTPAT",JDFN)) S DFN=JDFN K ^TMP("PSJAT",$J) D PAT,PJ
"RTN","PSJPR",52,0)
 Q
"RTN","PSJPR",53,0)
 ;
"RTN","PSJPR",54,0)
PJ ;
"RTN","PSJPR",55,0)
 S ^TMP("PSJPR",$J,"OUTPAT",JDFN)=""
"RTN","PSJPR",56,0)
 ;
"RTN","PSJPR",57,0)
PG ;
"RTN","PSJPR",58,0)
 F PSJPRW=0:0 S PSJPRW=$O(^PS(57.5,"AC",PSJPRWG,PSJPRW)) Q:'PSJPRW  S PSJPRWN=$P($G(^DIC(42,+PSJPRW,0)),"^") I PSJPRWN]"" D PW Q:$G(X)="^"
"RTN","PSJPR",59,0)
 Q
"RTN","PSJPR",60,0)
 ;
"RTN","PSJPR",61,0)
PW ;
"RTN","PSJPR",62,0)
 K ^TMP("PSJAT",$J) F DFN=0:0 S (DFN,PSGP)=$O(^DPT("CN",PSJPRWN,DFN)) Q:'DFN  K ^TMP("PSJAT",$J) D PAT
"RTN","PSJPR",63,0)
 Q
"RTN","PSJPR",64,0)
 ;
"RTN","PSJPR",65,0)
PAT ;
"RTN","PSJPR",66,0)
 S RB=$P($G(^DPT(DFN,.101)),U),PPN=$P($G(^(0)),U),X=$S(PSJSEL("RBP")="R":RB,1:PPN),AT=""
"RTN","PSJPR",67,0)
 I $D(PSJSEL("TM")) S:RB]"" AT=$O(^PS(57.7,"AWRT",PSJPRW,RB,0)) Q:$S($D(PSJSEL("TM","ALL")):0,AT="":1,1:'$D(PSJSEL("TM",AT)))
"RTN","PSJPR",68,0)
 F Y="AT","RB","X" S:@Y="" @Y="ZZ"
"RTN","PSJPR",69,0)
 S ^TMP("PSJAT",$J,AT,X,DFN)=""
"RTN","PSJPR",70,0)
 K PSJDBL S PSJAT="" F  S PSJAT=$O(^TMP("PSJAT",$J,PSJAT)) Q:PSJAT=""!$G(PSJDBL)  D
"RTN","PSJPR",71,0)
 .S PSJPNRB="" F  S PSJPNRB=$O(^TMP("PSJAT",$J,PSJAT,PSJPNRB)) Q:PSJPNRB=""  S (DFN,PSGP)=+$O(^TMP("PSJAT",$J,PSJAT,PSJPNRB,0)) D ENBOTH^PSJAC,PP I $G(X)["^" S:X="^^" PSJDBL=1 Q
"RTN","PSJPR",72,0)
 Q
"RTN","PSJPR",73,0)
 ;
"RTN","PSJPR",74,0)
PP ;
"RTN","PSJPR",75,0)
 I PSJPRP'="E" D ^PSJO I PSJPRP="P",'PSJPR D:'PSJON READ^PSJUTL Q:$G(X)?1"^"."^"  I PSJON S PSJPRF=1 D ENVW^PSJOE0 K PSGPRF Q
"RTN","PSJPR",76,0)
 Q:PSJPRP="P"  I PSJPRP="E" U IO S PSJON=0,PSJDEV=PSJPR D @$S($D(PSJEXTP):"EN^PSJH1,ENGET^PSJO3",1:"EN^PSJO1(3),ENGET^PSJO3")
"RTN","PSJPR",77,0)
 I 'PSJPR,PSJSEL("SELECT")'="P",'$D(^TMP("PSG",$J)) D READ^PSJUTL Q
"RTN","PSJPR",78,0)
 I PSJPRP'="E",'PSJPR D PP3 Q:$D(DUOUT)!$D(DTOUT)
"RTN","PSJPR",79,0)
 S (PSJS1,PSJS2,PSJS3,PSJS4,X)=""
"RTN","PSJPR",80,0)
 F PSJQ=0:0 S PSJS1=$O(^TMP("PSJ",$J,PSJS1)) Q:PSJS1=""  F PSJQ=0:0 S PSJS2=$O(^TMP("PSJ",$J,PSJS1,PSJS2)) Q:PSJS2=""  F PSJQ=0:0 S PSJS3=$O(^TMP("PSJ",$J,PSJS1,PSJS2,PSJS3)) Q:PSJS3=""  D PP1
"RTN","PSJPR",81,0)
 D:X'["^"&PSJPR BOT^PSJO3 K ^TMP("PSJ",$J) Q
"RTN","PSJPR",82,0)
 ;
"RTN","PSJPR",83,0)
PP1 ;
"RTN","PSJPR",84,0)
 F PSJQ=0:0 S PSJS4=$O(^TMP("PSJ",$J,PSJS1,PSJS2,PSJS3,PSJS4)) Q:PSJS4=""  D PP2
"RTN","PSJPR",85,0)
 Q
"RTN","PSJPR",86,0)
 ;
"RTN","PSJPR",87,0)
PP2 ; Display selected order.
"RTN","PSJPR",88,0)
 N PSJPRF,PSJLM S PSJORD=PSJS4 I $S(PSJORD["V":1,PSJORD["P":$P($G(^PS(53.1,+PSJORD,0)),U,4)="F",1:0) D  Q
"RTN","PSJPR",89,0)
 .S PSJPRF=1 D ENINP^PSIVOPT(PSGP,PSJORD),PP3 Q:$D(DUOUT)!$D(DTOUT)  I PSJPRA'="N" I PSJORD'["P" D ENLOG^PSIVVW1,PP3 Q
"RTN","PSJPR",90,0)
 S PSGORD=PSJORD D EN2^PSGVW,PP3 Q:$D(DUOUT)!$D(DTOUT)  I PSJPRA'="N",((PSJS1["A")!(PSJS1["O")) S AT=PSJPRA D ENA^PSGVW0 D PP3
"RTN","PSJPR",91,0)
 Q
"RTN","PSJPR",92,0)
PP3 S X="" I 'PSJPR K DIR S DIR(0)="E" D ^DIR S:$D(DUOUT)!$D(DTOUT) X="^" I X["^" S (PSJS1,PSJS2,PSJS3,PSJS4)="~"
"RTN","PSJPR",93,0)
 Q
"RTN","PSJPR",94,0)
 ;
"RTN","PSJPR",95,0)
PH ;
"RTN","PSJPR",96,0)
 W !!?2,"Enter a 'P' to print ONLY the PROFILE of orders for this patient.  Enter an",!,"'E' to print ONLY the EXPANDED VIEW of the orders for this patient.  Enter a",!,"'B' to have BOTH the profile (first) and the expanded views print."
"RTN","PSJPR",97,0)
 W "  Enter an '^'to exit." Q
"RTN","PSJPR",98,0)
 ;
"RTN","PSJPR",99,0)
ENOR(PSGP) ;S (PSGP,DFN)=+ORVP,PSGP(0)=^DPT(PSGP,0)
"RTN","PSJPR",100,0)
 S DFN=+PSGP,PSGP(0)=^DPT(PSGP,0)
"RTN","PSJPR",101,0)
ENLM N PSJNEW,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSJPR",102,0)
 S PSGPTMP=0,PPAGE=1
"RTN","PSJPR",103,0)
 D ENCV^PSGSETU
"RTN","PSJPR",104,0)
 D ENBOTH^PSJAC D:$D(PSJEXTP) CNV^PSJP D ENL^PSJO3 I "^N"'[PSJOL S PSJSEL("SELECT")="P",PSJSEL("P",PSGP(0),PSGP)="",(PSJPRW,PSJPRWG)=0,(PSJPRWN,PSJPRWGN)="",XQUIT="YES" D GO
"RTN","PSJPR",105,0)
 ;* S PSJNKF=1 D READ^PSJUTL G DONE
"RTN","PSJPR",106,0)
 S PSJNKF=1 G DONE
"RTN","PSJUTL2")
0^71^B9017401
"RTN","PSJUTL2",1,0)
PSJUTL2  ;BIR/LDT - MISC UTILITIES FOR INPATIENT MEDICATIONS ;18 Aug 98 / 2:48 PM
"RTN","PSJUTL2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**63,58,81,105,110,111**;16 DEC 97
"RTN","PSJUTL2",3,0)
 ;
"RTN","PSJUTL2",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJUTL2",5,0)
 ; Reference to ^PSBAPIPM is supported by DBIA# 3564.
"RTN","PSJUTL2",6,0)
 ; Reference to ^PSB(53.79 is supported by DBIA 3370.
"RTN","PSJUTL2",7,0)
 ;
"RTN","PSJUTL2",8,0)
BCMALG(PSJX,PSJY)     ;Returns BCMA Last Action formatted for printing
"RTN","PSJUTL2",9,0)
 N PSJLAST S PSJLACT=""
"RTN","PSJUTL2",10,0)
 I PSJY["V" Q:$G(^PS(55,PSJX,"IV",+PSJY,.2))="" ""
"RTN","PSJUTL2",11,0)
 S PSJLAST=$$EN^PSBAPIPM(PSJX,PSJY)
"RTN","PSJUTL2",12,0)
 I PSJLAST]"" S PSJLACT="BCMA ORDER LAST ACTION: "_$$ENDTC1^PSGMI($P(PSJLAST,"^",2))_" "_$$EXTERNAL^DILFD(53.79,.09,"",$P(PSJLAST,"^",3))
"RTN","PSJUTL2",13,0)
 I PSJLAST="" D PREV
"RTN","PSJUTL2",14,0)
 Q PSJLACT
"RTN","PSJUTL2",15,0)
 ;
"RTN","PSJUTL2",16,0)
PREV ;If the original order has no administration data logged against it then check to see if there is data for the previous order.
"RTN","PSJUTL2",17,0)
 N PREON
"RTN","PSJUTL2",18,0)
 S PREON=$S(PSJY["V":$P($G(^PS(55,PSJX,"IV",+PSJY,2)),"^",5),PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,0)),"^",25),1:$P($G(^PS(53.1,+PSJY,0)),"^",25))
"RTN","PSJUTL2",19,0)
 I PREON]"" S PSJLAST=$$EN^PSBAPIPM(PSJX,PREON)
"RTN","PSJUTL2",20,0)
 I PSJLAST]"" S PSJLACT="BCMA ORDER LAST ACTION: "_$$ENDTC1^PSGMI($P(PSJLAST,"^",2))_" "_$$EXTERNAL^DILFD(53.79,.09,"",$P(PSJLAST,"^",3))_"*"
"RTN","PSJUTL2",21,0)
 Q
"RTN","PSJUTL2",22,0)
 ;
"RTN","PSJUTL2",23,0)
DATE() ;Returns date in fileman format with a time in hours and minutes.
"RTN","PSJUTL2",24,0)
 S PSGDT="" N X,TIM
"RTN","PSJUTL2",25,0)
 D NOW^%DTC D
"RTN","PSJUTL2",26,0)
 .I $L(%)=12 S X=% Q
"RTN","PSJUTL2",27,0)
 .I $L(%)=14 S X=$E(%,13,14) S:X>29 X=$E(%,1,12)_5 S:X'>29 X=$E(%,1,12)_1 Q
"RTN","PSJUTL2",28,0)
 .I $L(%)=13 S X=$E(%,13)_0 S:X>29 X=$E(%,1,12)_5 S:X'>29 X=$E(%,1,12)_1 Q
"RTN","PSJUTL2",29,0)
 S PSGDT=$S($G(X)]"":+$FN($G(X),"",4),1:PSJDT) I '$P(PSGDT,".",2) S PSGDT=$$FMADD^XLFDT(PSGDT,-1,0,0,0)_.24
"RTN","PSJUTL2",30,0)
 S TIM=$P(PSGDT,".",2) I $E(TIM,3)=6 S TIM=$E(TIM,1,2)+1,PSGDT=$P(PSGDT,".")_"."_$TR($J(TIM,2)," ",0)
"RTN","PSJUTL2",31,0)
 Q PSGDT
"RTN","PSJUTL2",32,0)
 ;
"RTN","PSJUTL2",33,0)
DATE2(PSJDT) ;Returns date in fileman format with a time in hours and minutes
"RTN","PSJUTL2",34,0)
 Q:'$G(PSJDT) ""
"RTN","PSJUTL2",35,0)
 N X,TIM D
"RTN","PSJUTL2",36,0)
 .I $L(PSJDT)=12 S X=PSJDT Q
"RTN","PSJUTL2",37,0)
 .I $L(PSJDT)>13 S X=$E(PSJDT,13,14) S:X>29 X=$E(PSJDT,1,12)_5 S:X'>29 X=$E(PSJDT,1,12)_1 Q
"RTN","PSJUTL2",38,0)
 .I $L(PSJDT)=13 S X=$E(PSJDT,13)_0 S:X>29 X=$E(PSJDT,1,12)_5 S:X'>29 X=$E(PSJDT,1,12)_1 Q
"RTN","PSJUTL2",39,0)
 S PSJDT=$S($G(X)]"":+$FN($G(X),"",4),1:PSJDT) I '$P(PSJDT,".",2) S PSJDT=$$FMADD^XLFDT(PSJDT,-1,0,0,0)_.24
"RTN","PSJUTL2",40,0)
 S TIM=$P(PSJDT,".",2) I $E(TIM,3)=6 S TIM=$E(TIM,1,2)+1,PSJDT=$P(PSJDT,".")_"."_$TR($J(TIM,2)," ",0)
"RTN","PSJUTL2",41,0)
 Q PSJDT
"RTN","PSJUTL2",42,0)
 ;
"RTN","PSJUTL2",43,0)
RNEWOK(DAD,PSJDFN) ;Returns 1 or 0 if all in complex order series are active.
"RTN","PSJUTL2",44,0)
 N F,I,II,Y,NODE0,STAT S Y=1,I=0,II=""
"RTN","PSJUTL2",45,0)
 F  S I=$O(^PS(55,"ACX",DAD,I)) Q:'I  F  S II=$O(^PS(55,"ACX",DAD,I,II)) Q:II=""  D  Q:Y=0
"RTN","PSJUTL2",46,0)
 .S F=$S(II["V":"^PS(55,"_PSJDFN_",""IV"","_+II,II["U":"^PS(55,"_PSJDFN_",5,"_+II,1:"") S:F="" Y=0 Q:Y=0
"RTN","PSJUTL2",47,0)
 .S NODE0=$G(@(F_",0)")),STAT=$S(II["V":($P(NODE0,"^",17)),1:($P(NODE0,"^",9))) I STAT'="A" S Y=0 I STAT="E" D
"RTN","PSJUTL2",48,0)
 ..S Y='$$EXPIRED^PSGOER(PSJDFN,II)
"RTN","PSJUTL2",49,0)
 Q Y
"SEC","^DIC",53.46,53.46,0,"AUDIT")
@
"SEC","^DIC",53.46,53.46,0,"DD")
@
"SEC","^DIC",53.46,53.46,0,"DEL")
@
"SEC","^DIC",53.46,53.46,0,"LAYGO")
@
"SEC","^DIC",53.46,53.46,0,"RD")
@
"SEC","^DIC",53.46,53.46,0,"WR")
@
"SEC","^DIC",57.8,57.8,0,"AUDIT")
@
"SEC","^DIC",57.8,57.8,0,"DD")
@
"SEC","^DIC",57.8,57.8,0,"DEL")
@
"SEC","^DIC",57.8,57.8,0,"LAYGO")
@
"SEC","^DIC",57.8,57.8,0,"RD")
@
"SEC","^DIC",57.8,57.8,0,"WR")
@
"UP",53.2,53.22,-1)
53.2^2
"UP",53.2,53.22,0)
53.22
"VER")
8.0^22.0
"^DD",53.1,53.1,.5,0)
PATIENT NAME^RP2'^DPT(^0;15^Q
"^DD",53.1,53.1,.5,1,0)
^.1
"^DD",53.1,53.1,.5,1,1,0)
53.1^AP^MUMPS
"^DD",53.1,53.1,.5,1,1,1)
S XX=X,X="PSGAXR" X ^%ZOSF("TEST") I  S X=XX D ENNPS^PSGAXR
"^DD",53.1,53.1,.5,1,1,2)
S XX=X,X="PSGAXR" X ^%ZOSF("TEST") I  S X=XX D ENNPK^PSGAXR
"^DD",53.1,53.1,.5,1,1,3)
Used by Inpatient Meds to set several cross-references.
"^DD",53.1,53.1,.5,1,1,"%D",0)
^.101^11^11^3041101^^^
"^DD",53.1,53.1,.5,1,1,"%D",1,0)
  This is used to set and kill the following cross-references:
"^DD",53.1,53.1,.5,1,1,"%D",2,0)
 ^PS(53.1,"AC",patient,DA)=""
"^DD",53.1,53.1,.5,1,1,"%D",3,0)
 ^PS(53.1,"AOD",patient,primary drug,DA)=""
"^DD",53.1,53.1,.5,1,1,"%D",4,0)
 ^PS(53.1,"AS",status,patient,DA)=""
"^DD",53.1,53.1,.5,1,1,"%D",5,0)
 ^PS(53.1,"AV",patient,DA)=""
"^DD",53.1,53.1,.5,1,1,"%D",6,0)
 ^PS(53.1,"C",patient,DA)=""
"^DD",53.1,53.1,.5,1,1,"%D",7,0)
 
"^DD",53.1,53.1,.5,1,1,"%D",8,0)
  The AC and AOD x-refs are only set if the order has not been verified or
"^DD",53.1,53.1,.5,1,1,"%D",9,0)
discontinued.
"^DD",53.1,53.1,.5,1,1,"%D",10,0)
  The AV x-ref is only set if the order has a pending status and was 
"^DD",53.1,53.1,.5,1,1,"%D",11,0)
acknowledged by a nurse.
"^DD",53.1,53.1,.5,3)

"^DD",53.1,53.1,.5,20,0)
^.3LA^1^1
"^DD",53.1,53.1,.5,20,1,0)
PSJU
"^DD",53.1,53.1,.5,21,0)
^^1^1^2910305^^
"^DD",53.1,53.1,.5,21,1,0)
  This is the patient for which the medication has been ordered.
"^DD",53.1,53.1,.5,"DT")
3040501
"^DD",53.1,53.1,113,0)
CLINIC^P44'^SC(^DSS;1^Q
"^DD",53.1,53.1,113,3)
Enter the name of the clinic where the patient was seen.
"^DD",53.1,53.1,113,21,0)
^^1^1^2980923^^^
"^DD",53.1,53.1,113,21,1,0)
Entry must be a clinic.  Depending on the condition, INACTIVATE and REACTIVATE dates may exist.
"^DD",53.1,53.1,113,"DT")
3040501
"^DD",53.1,53.1,126,0)
APPOINTMENT DATE/TIME^D^^DSS;2^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",53.1,53.1,126,3)
Date and time of the appointment for this clinic location. 
"^DD",53.1,53.1,126,21,0)
^^2^2^3030729^
"^DD",53.1,53.1,126,21,1,0)
This is the date and time of the appointment this order is being placed
"^DD",53.1,53.1,126,21,2,0)
for.  
"^DD",53.1,53.1,126,"DT")
3030729
"^DD",53.1,53.1,127,0)
REQUESTED IV LIMITATION^F^^2.5;4^K:$L(X)>6!($L(X)<1)!'(X?1.2A1.5N) X
"^DD",53.1,53.1,127,3)
Answer must be 1-6 characters in length.
"^DD",53.1,53.1,127,21,0)
^^3^3^3041115^
"^DD",53.1,53.1,127,21,1,0)
This is the length of time to administer, or the total volume to 
"^DD",53.1,53.1,127,21,2,0)
administer, for IV fluid orders. The value may be in ML or CC for
"^DD",53.1,53.1,127,21,3,0)
milliliters, L for liters, D for days, or H for hours.
"^DD",53.1,53.1,127,"DT")
3041115
"^DD",53.2,53.22,8,0)
SCHEDULE^P51.1'^PS(51.1,^0;5^Q
"^DD",53.2,53.22,8,3)
Enter the schedule for this orderable item.
"^DD",53.2,53.22,8,20,0)
^.3LA^1^1
"^DD",53.2,53.22,8,20,1,0)
PSJU
"^DD",53.2,53.22,8,"DT")
3040302
"^DD",53.46,53.46,0)
FIELD^^1^2
"^DD",53.46,53.46,0,"DT")
3031030
"^DD",53.46,53.46,0,"IX","B",53.46,.01)

"^DD",53.46,53.46,0,"NM","CLINIC STOP DATES")

"^DD",53.46,53.46,0,"VRPK")
PSJ
"^DD",53.46,53.46,.01,0)
CLINIC^RP44^SC(^0;1^Q
"^DD",53.46,53.46,.01,1,0)
^.1
"^DD",53.46,53.46,.01,1,1,0)
53.46^B
"^DD",53.46,53.46,.01,1,1,1)
S ^PS(53.46,"B",$E(X,1,30),DA)=""
"^DD",53.46,53.46,.01,1,1,2)
K ^PS(53.46,"B",$E(X,1,30),DA)
"^DD",53.46,53.46,.01,3)
Enter the hospital location (clinic) for which you want to enter stop date information.
"^DD",53.46,53.46,.01,21,0)
^^3^3^3031029^
"^DD",53.46,53.46,.01,21,1,0)
This is the clinic for which the stop date calculations are being 
"^DD",53.46,53.46,.01,21,2,0)
entered. The clinic should allow the ordering of Inpatient Medications 
"^DD",53.46,53.46,.01,21,3,0)
for Outpatients.
"^DD",53.46,53.46,.01,"DT")
3031030
"^DD",53.46,53.46,1,0)
NUMBER OF DAYS UNTIL STOP^NJ3,0^^0;2^K:+X'=X!(X>365)!(X<1)!(X?.E1"."1.N) X
"^DD",53.46,53.46,1,3)
Type a number between 1 and 365, 0 Decimal Digits
"^DD",53.46,53.46,1,21,0)
^^2^2^3031024^
"^DD",53.46,53.46,1,21,1,0)
This is the number of days to default the length of an order. Cannot 
"^DD",53.46,53.46,1,21,2,0)
exceed 365 days.
"^DD",53.46,53.46,1,"DT")
3031024
"^DD",57.8,57.8,0)
FIELD^^1^2
"^DD",57.8,57.8,0,"DT")
3040205
"^DD",57.8,57.8,0,"IX","B",57.8,.01)

"^DD",57.8,57.8,0,"NM","CLINIC GROUP")

"^DD",57.8,57.8,0,"VRPK")
PSJ
"^DD",57.8,57.8,.01,0)
NAME^RF^^0;1^K:$L(X)>20!($L(X)<3)!'(X'?1P.E) X
"^DD",57.8,57.8,.01,1,0)
^.1
"^DD",57.8,57.8,.01,1,1,0)
57.8^B
"^DD",57.8,57.8,.01,1,1,1)
S ^PS(57.8,"B",$E(X,1,30),DA)=""
"^DD",57.8,57.8,.01,1,1,2)
K ^PS(57.8,"B",$E(X,1,30),DA)
"^DD",57.8,57.8,.01,1,1,"DT")
3040501
"^DD",57.8,57.8,.01,3)
Answer must be 3-20 characters in length
"^DD",57.8,57.8,.01,21,0)
^^2^2^3040206^
"^DD",57.8,57.8,.01,21,1,0)
Enter the name of the clinic group. This will be displayed in options 
"^DD",57.8,57.8,.01,21,2,0)
such as Non-Verified/Pending and will be selectable for reports.
"^DD",57.8,57.8,.01,"DT")
3040501
"^DD",57.8,57.8,1,0)
CLINIC^57.81P^^1;0
"^DD",57.8,57.8,1,21,0)
^^1^1^3040206^
"^DD",57.8,57.8,1,21,1,0)
This contains the list of all the clinics defined within this group.
"^DD",57.8,57.81,0)
CLINIC SUB-FIELD^^.01^1
"^DD",57.8,57.81,0,"DT")
3040205
"^DD",57.8,57.81,0,"NM","CLINIC")

"^DD",57.8,57.81,0,"UP")
57.8
"^DD",57.8,57.81,.01,0)
CLINIC^MP44'^SC(^0;1^Q
"^DD",57.8,57.81,.01,1,0)
^.1^^0
"^DD",57.8,57.81,.01,3)
Enter the clinic you wish to add to this group.
"^DD",57.8,57.81,.01,21,0)
^^2^2^3040206^
"^DD",57.8,57.81,.01,21,1,0)
Entry from the HOSPITAL LOCATION file (#44) that will be a part of this 
"^DD",57.8,57.81,.01,21,2,0)
clinic group.
"^DD",57.8,57.81,.01,"DT")
3040501
"^DIC",53.46,53.46,0)
CLINIC STOP DATES^53.46
"^DIC",53.46,53.46,0,"GL")
^PS(53.46,
"^DIC",53.46,53.46,"%D",0)
^^3^3^3031024
"^DIC",53.46,53.46,"%D",1,0)
This file is used to store information for calculating stop dates
"^DIC",53.46,53.46,"%D",2,0)
for clinics that allow administering Inpatient Medications for
"^DIC",53.46,53.46,"%D",3,0)
outpatients.
"^DIC",53.46,"B","CLINIC STOP DATES",53.46)

"^DIC",57.8,57.8,0)
CLINIC GROUP^57.8
"^DIC",57.8,57.8,0,"GL")
^PS(57.8,
"^DIC",57.8,57.8,"%D",0)
^^2^2^3040205^^^^
"^DIC",57.8,57.8,"%D",1,0)
  Allows the user to group clinics from the HOSPITAL LOCATION file (44) to
"^DIC",57.8,57.8,"%D",2,0)
facilitate the printing of reports and for other processes.
"^DIC",57.8,"B","CLINIC GROUP",57.8)

**INSTALL NAME**
OR*3.0*195
"BLD",4767,0)
OR*3.0*195^ORDER ENTRY/RESULTS REPORTING^0^3050120^y
"BLD",4767,4,0)
^9.64PA^101.24^3
"BLD",4767,4,100,0)
100
"BLD",4767,4,100,2,0)
^9.641^100^3
"BLD",4767,4,100,2,100,0)
ORDER  (File-top level)
"BLD",4767,4,100,2,100,1,0)
^9.6411^96^7
"BLD",4767,4,100,2,100,1,90,0)
BA SERVICE CONNECTED CONDITION
"BLD",4767,4,100,2,100,1,91,0)
BA MILITARY SEXUAL TRAUMA
"BLD",4767,4,100,2,100,1,92,0)
BA AGENT ORANGE EXPOSURE
"BLD",4767,4,100,2,100,1,93,0)
BA IONIZING RADIATION EXPOSURE
"BLD",4767,4,100,2,100,1,94,0)
BA ENVIRONMENTAL CONTAMINANTS
"BLD",4767,4,100,2,100,1,95,0)
BA HEAD AND/OR NECK CANCER
"BLD",4767,4,100,2,100,1,96,0)
BA COMBAT VETERAN
"BLD",4767,4,100,2,100.04,0)
V POV  (sub-file)
"BLD",4767,4,100,2,100.04,1,0)
^9.6411^^
"BLD",4767,4,100,2,100.051,0)
ORDER DIAGNOSES  (sub-file)
"BLD",4767,4,100,2,100.051,1,0)
^9.6411^^
"BLD",4767,4,100,222)
y^n^p^^^^n^^n
"BLD",4767,4,100,224)

"BLD",4767,4,101.24,0)
101.24
"BLD",4767,4,101.24,222)
n^n^f^^y^^y^r^n
"BLD",4767,4,101.24,224)
I Y=1004!(Y=1130)
"BLD",4767,4,101.41,0)
101.41
"BLD",4767,4,101.41,222)
n^n^f^^y^^y^r^n
"BLD",4767,4,101.41,224)
I $P(^ORD(101.41,+Y,0),"^")="PSJI OR PAT FLUID OE"!($P(^ORD(101.41,+Y,0),"^")="OR GTX SEVERITY")
"BLD",4767,4,"APDD",100,100)

"BLD",4767,4,"APDD",100,100,90)

"BLD",4767,4,"APDD",100,100,91)

"BLD",4767,4,"APDD",100,100,92)

"BLD",4767,4,"APDD",100,100,93)

"BLD",4767,4,"APDD",100,100,94)

"BLD",4767,4,"APDD",100,100,95)

"BLD",4767,4,"APDD",100,100,96)

"BLD",4767,4,"APDD",100,100.04)

"BLD",4767,4,"APDD",100,100.051)

"BLD",4767,4,"B",100,100)

"BLD",4767,4,"B",101.24,101.24)

"BLD",4767,4,"B",101.41,101.41)

"BLD",4767,"ABPKG")
n
"BLD",4767,"INI")
PRE^ORY195
"BLD",4767,"INID")
^n^n
"BLD",4767,"INIT")
POST^ORY195
"BLD",4767,"KRN",0)
^9.67PA^8989.52^19
"BLD",4767,"KRN",.4,0)
.4
"BLD",4767,"KRN",.401,0)
.401
"BLD",4767,"KRN",.402,0)
.402
"BLD",4767,"KRN",.403,0)
.403
"BLD",4767,"KRN",.5,0)
.5
"BLD",4767,"KRN",.84,0)
.84
"BLD",4767,"KRN",3.6,0)
3.6
"BLD",4767,"KRN",3.8,0)
3.8
"BLD",4767,"KRN",9.2,0)
9.2
"BLD",4767,"KRN",9.2,"NM",0)
^9.68A^7^7
"BLD",4767,"KRN",9.2,"NM",1,0)
ORBA-SC^^0
"BLD",4767,"KRN",9.2,"NM",2,0)
ORBA-HNC^^0
"BLD",4767,"KRN",9.2,"NM",3,0)
ORBA-MST^^0
"BLD",4767,"KRN",9.2,"NM",4,0)
ORBA-AO^^0
"BLD",4767,"KRN",9.2,"NM",5,0)
ORBA-IR^^0
"BLD",4767,"KRN",9.2,"NM",6,0)
ORBA-EC^^0
"BLD",4767,"KRN",9.2,"NM",7,0)
ORBA-CV^^0
"BLD",4767,"KRN",9.2,"NM","B","ORBA-AO",4)

"BLD",4767,"KRN",9.2,"NM","B","ORBA-CV",7)

"BLD",4767,"KRN",9.2,"NM","B","ORBA-EC",6)

"BLD",4767,"KRN",9.2,"NM","B","ORBA-HNC",2)

"BLD",4767,"KRN",9.2,"NM","B","ORBA-IR",5)

"BLD",4767,"KRN",9.2,"NM","B","ORBA-MST",3)

"BLD",4767,"KRN",9.2,"NM","B","ORBA-SC",1)

"BLD",4767,"KRN",9.8,0)
9.8
"BLD",4767,"KRN",9.8,"NM",0)
^9.68A^90^74
"BLD",4767,"KRN",9.8,"NM",1,0)
ORWDX^^0^B63550700
"BLD",4767,"KRN",9.8,"NM",2,0)
ORCSAVE^^0^B69137965
"BLD",4767,"KRN",9.8,"NM",3,0)
ORCDPS1^^0^B72403694
"BLD",4767,"KRN",9.8,"NM",4,0)
ORCMED^^0^B41444759
"BLD",4767,"KRN",9.8,"NM",9,0)
ORWDPS4^^0^B18747760
"BLD",4767,"KRN",9.8,"NM",10,0)
ORWDX1^^0^B11739165
"BLD",4767,"KRN",9.8,"NM",12,0)
ORWPCE^^0^B48169607
"BLD",4767,"KRN",9.8,"NM",15,0)
ORWPCE2^^0^B46743157
"BLD",4767,"KRN",9.8,"NM",16,0)
ORWU1^^0^B50649823
"BLD",4767,"KRN",9.8,"NM",17,0)
ORWDAL32^^0^B23860663
"BLD",4767,"KRN",9.8,"NM",18,0)
ORWORR^^0^B63607607
"BLD",4767,"KRN",9.8,"NM",19,0)
ORWPS^^0^B45940660
"BLD",4767,"KRN",9.8,"NM",20,0)
ORWDPS3^^0^B20118443
"BLD",4767,"KRN",9.8,"NM",27,0)
ORWDBA6^^0^B12217678
"BLD",4767,"KRN",9.8,"NM",28,0)
ORWDBA5^^0^B18240259
"BLD",4767,"KRN",9.8,"NM",29,0)
ORWDBA4^^0^B9537496
"BLD",4767,"KRN",9.8,"NM",30,0)
ORWDBA3^^0^B40156794
"BLD",4767,"KRN",9.8,"NM",31,0)
ORWDBA2^^0^B27608999
"BLD",4767,"KRN",9.8,"NM",32,0)
ORWDBA1^^0^B53124161
"BLD",4767,"KRN",9.8,"NM",33,0)
ORWDBA10^^0^B23502978
"BLD",4767,"KRN",9.8,"NM",34,0)
ORWDBA12^^0^B24052231
"BLD",4767,"KRN",9.8,"NM",35,0)
ORWDBA14^^0^B17169243
"BLD",4767,"KRN",9.8,"NM",36,0)
ORWDBA16^^0^B7959073
"BLD",4767,"KRN",9.8,"NM",37,0)
ORWDBA18^^0^B23979086
"BLD",4767,"KRN",9.8,"NM",38,0)
ORQ2^^0^B37070145
"BLD",4767,"KRN",9.8,"NM",39,0)
ORQ21^^0^B26090672
"BLD",4767,"KRN",9.8,"NM",40,0)
ORMBLD^^0^B41809197
"BLD",4767,"KRN",9.8,"NM",41,0)
ORMBLDGM^^0^B4563455
"BLD",4767,"KRN",9.8,"NM",42,0)
ORMBLDLR^^0^B19628986
"BLD",4767,"KRN",9.8,"NM",43,0)
ORMBLDPS^^0^B64695712
"BLD",4767,"KRN",9.8,"NM",44,0)
ORMBLDRA^^0^B8026244
"BLD",4767,"KRN",9.8,"NM",45,0)
ORMGMRC^^0^B43068026
"BLD",4767,"KRN",9.8,"NM",46,0)
ORMLR^^0^B55183610
"BLD",4767,"KRN",9.8,"NM",47,0)
ORMPS^^0^B75068050
"BLD",4767,"KRN",9.8,"NM",48,0)
ORMRA^^0^B56841321
"BLD",4767,"KRN",9.8,"NM",49,0)
ORWDXM2^^0^B61220482
"BLD",4767,"KRN",9.8,"NM",51,0)
ORWTPN^^0^B43115795
"BLD",4767,"KRN",9.8,"NM",52,0)
ORQPTQ2^^0^B40255442
"BLD",4767,"KRN",9.8,"NM",53,0)
ORQQVS^^0^B13142544
"BLD",4767,"KRN",9.8,"NM",54,0)
ORWTPO^^0^B12860836
"BLD",4767,"KRN",9.8,"NM",56,0)
ORWCV^^0^B69135314
"BLD",4767,"KRN",9.8,"NM",57,0)
ORWNSS^^0^B4680078
"BLD",4767,"KRN",9.8,"NM",58,0)
ORWDBA8^^0^B60097261
"BLD",4767,"KRN",9.8,"NM",59,0)
ORWDBA81^^0^B10519960
"BLD",4767,"KRN",9.8,"NM",60,0)
ORWDBA82^^0^B10638038
"BLD",4767,"KRN",9.8,"NM",61,0)
ORWDBA83^^0^B60163988
"BLD",4767,"KRN",9.8,"NM",62,0)
ORIMO^^0^B1801970
"BLD",4767,"KRN",9.8,"NM",64,0)
OREVNT1^^0^B46189289
"BLD",4767,"KRN",9.8,"NM",65,0)
ORMEVNT2^^0^B20345613
"BLD",4767,"KRN",9.8,"NM",66,0)
ORMEVNT^^0^B71407003
"BLD",4767,"KRN",9.8,"NM",67,0)
ORQ11^^0^B58490092
"BLD",4767,"KRN",9.8,"NM",68,0)
OREVNT^^0^B75703120
"BLD",4767,"KRN",9.8,"NM",69,0)
ORCSEND^^0^B56693058
"BLD",4767,"KRN",9.8,"NM",70,0)
ORWDBA7^^0^B17251389
"BLD",4767,"KRN",9.8,"NM",71,0)
ORX2^^0^B11359857
"BLD",4767,"KRN",9.8,"NM",72,0)
ORWTIU^^0^B9619968
"BLD",4767,"KRN",9.8,"NM",73,0)
ORWTPD^^0^B13844085
"BLD",4767,"KRN",9.8,"NM",74,0)
ORWTPD1^^0^B17655360
"BLD",4767,"KRN",9.8,"NM",75,0)
ORWU^^0^B58776444
"BLD",4767,"KRN",9.8,"NM",76,0)
ORWDXA^^0^B77703633
"BLD",4767,"KRN",9.8,"NM",77,0)
ORWDPS32^^0^B80062730
"BLD",4767,"KRN",9.8,"NM",78,0)
ORCD^^0^B50855381
"BLD",4767,"KRN",9.8,"NM",79,0)
ORDV04^^0^B65496283
"BLD",4767,"KRN",9.8,"NM",80,0)
ORWDXM3^^0^B35271488
"BLD",4767,"KRN",9.8,"NM",81,0)
ORMBLDAL^^0^B5473107
"BLD",4767,"KRN",9.8,"NM",82,0)
ORY195^^0^B61714416
"BLD",4767,"KRN",9.8,"NM",83,0)
ORY195A^^0^B17796256
"BLD",4767,"KRN",9.8,"NM",84,0)
ORCDPSIV^^0^B21933946
"BLD",4767,"KRN",9.8,"NM",85,0)
ORMPS1^^0^B63625403
"BLD",4767,"KRN",9.8,"NM",86,0)
ORY195V^^0^B1483542
"BLD",4767,"KRN",9.8,"NM",87,0)
ORWDXR01^^0^B14465007
"BLD",4767,"KRN",9.8,"NM",88,0)
ORM^^0^B17869206
"BLD",4767,"KRN",9.8,"NM",89,0)
ORWDPS2^^0^B61320975
"BLD",4767,"KRN",9.8,"NM",90,0)
ORMPS2^^0^B37370789
"BLD",4767,"KRN",9.8,"NM","B","ORCD",78)

"BLD",4767,"KRN",9.8,"NM","B","ORCDPS1",3)

"BLD",4767,"KRN",9.8,"NM","B","ORCDPSIV",84)

"BLD",4767,"KRN",9.8,"NM","B","ORCMED",4)

"BLD",4767,"KRN",9.8,"NM","B","ORCSAVE",2)

"BLD",4767,"KRN",9.8,"NM","B","ORCSEND",69)

"BLD",4767,"KRN",9.8,"NM","B","ORDV04",79)

"BLD",4767,"KRN",9.8,"NM","B","OREVNT",68)

"BLD",4767,"KRN",9.8,"NM","B","OREVNT1",64)

"BLD",4767,"KRN",9.8,"NM","B","ORIMO",62)

"BLD",4767,"KRN",9.8,"NM","B","ORM",88)

"BLD",4767,"KRN",9.8,"NM","B","ORMBLD",40)

"BLD",4767,"KRN",9.8,"NM","B","ORMBLDAL",81)

"BLD",4767,"KRN",9.8,"NM","B","ORMBLDGM",41)

"BLD",4767,"KRN",9.8,"NM","B","ORMBLDLR",42)

"BLD",4767,"KRN",9.8,"NM","B","ORMBLDPS",43)

"BLD",4767,"KRN",9.8,"NM","B","ORMBLDRA",44)

"BLD",4767,"KRN",9.8,"NM","B","ORMEVNT",66)

"BLD",4767,"KRN",9.8,"NM","B","ORMEVNT2",65)

"BLD",4767,"KRN",9.8,"NM","B","ORMGMRC",45)

"BLD",4767,"KRN",9.8,"NM","B","ORMLR",46)

"BLD",4767,"KRN",9.8,"NM","B","ORMPS",47)

"BLD",4767,"KRN",9.8,"NM","B","ORMPS1",85)

"BLD",4767,"KRN",9.8,"NM","B","ORMPS2",90)

"BLD",4767,"KRN",9.8,"NM","B","ORMRA",48)

"BLD",4767,"KRN",9.8,"NM","B","ORQ11",67)

"BLD",4767,"KRN",9.8,"NM","B","ORQ2",38)

"BLD",4767,"KRN",9.8,"NM","B","ORQ21",39)

"BLD",4767,"KRN",9.8,"NM","B","ORQPTQ2",52)

"BLD",4767,"KRN",9.8,"NM","B","ORQQVS",53)

"BLD",4767,"KRN",9.8,"NM","B","ORWCV",56)

"BLD",4767,"KRN",9.8,"NM","B","ORWDAL32",17)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA1",32)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA10",33)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA12",34)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA14",35)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA16",36)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA18",37)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA2",31)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA3",30)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA4",29)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA5",28)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA6",27)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA7",70)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA8",58)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA81",59)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA82",60)

"BLD",4767,"KRN",9.8,"NM","B","ORWDBA83",61)

"BLD",4767,"KRN",9.8,"NM","B","ORWDPS2",89)

"BLD",4767,"KRN",9.8,"NM","B","ORWDPS3",20)

"BLD",4767,"KRN",9.8,"NM","B","ORWDPS32",77)

"BLD",4767,"KRN",9.8,"NM","B","ORWDPS4",9)

"BLD",4767,"KRN",9.8,"NM","B","ORWDX",1)

"BLD",4767,"KRN",9.8,"NM","B","ORWDX1",10)

"BLD",4767,"KRN",9.8,"NM","B","ORWDXA",76)

"BLD",4767,"KRN",9.8,"NM","B","ORWDXM2",49)

"BLD",4767,"KRN",9.8,"NM","B","ORWDXM3",80)

"BLD",4767,"KRN",9.8,"NM","B","ORWDXR01",87)

"BLD",4767,"KRN",9.8,"NM","B","ORWNSS",57)

"BLD",4767,"KRN",9.8,"NM","B","ORWORR",18)

"BLD",4767,"KRN",9.8,"NM","B","ORWPCE",12)

"BLD",4767,"KRN",9.8,"NM","B","ORWPCE2",15)

"BLD",4767,"KRN",9.8,"NM","B","ORWPS",19)

"BLD",4767,"KRN",9.8,"NM","B","ORWTIU",72)

"BLD",4767,"KRN",9.8,"NM","B","ORWTPD",73)

"BLD",4767,"KRN",9.8,"NM","B","ORWTPD1",74)

"BLD",4767,"KRN",9.8,"NM","B","ORWTPN",51)

"BLD",4767,"KRN",9.8,"NM","B","ORWTPO",54)

"BLD",4767,"KRN",9.8,"NM","B","ORWU",75)

"BLD",4767,"KRN",9.8,"NM","B","ORWU1",16)

"BLD",4767,"KRN",9.8,"NM","B","ORX2",71)

"BLD",4767,"KRN",9.8,"NM","B","ORY195",82)

"BLD",4767,"KRN",9.8,"NM","B","ORY195A",83)

"BLD",4767,"KRN",9.8,"NM","B","ORY195V",86)

"BLD",4767,"KRN",19,0)
19
"BLD",4767,"KRN",19,"NM",0)
^9.68A^4^4
"BLD",4767,"KRN",19,"NM",1,0)
OR BDC MENU^^0
"BLD",4767,"KRN",19,"NM",2,0)
OR BDC MASTER SWITCH^^0
"BLD",4767,"KRN",19,"NM",3,0)
OR BDC PROVIDER SWITCH^^0
"BLD",4767,"KRN",19,"NM",4,0)
OR CPRS GUI CHART^^0
"BLD",4767,"KRN",19,"NM","B","OR BDC MASTER SWITCH",2)

"BLD",4767,"KRN",19,"NM","B","OR BDC MENU",1)

"BLD",4767,"KRN",19,"NM","B","OR BDC PROVIDER SWITCH",3)

"BLD",4767,"KRN",19,"NM","B","OR CPRS GUI CHART",4)

"BLD",4767,"KRN",19.1,0)
19.1
"BLD",4767,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4767,"KRN",101,0)
101
"BLD",4767,"KRN",409.61,0)
409.61
"BLD",4767,"KRN",771,0)
771
"BLD",4767,"KRN",870,0)
870
"BLD",4767,"KRN",8989.51,0)
8989.51
"BLD",4767,"KRN",8989.51,"NM",0)
^9.68A^9^9
"BLD",4767,"KRN",8989.51,"NM",1,0)
ORWIM NSS MESSAGE^^0
"BLD",4767,"KRN",8989.51,"NM",2,0)
OR BILLING AWARENESS STATUS^^0
"BLD",4767,"KRN",8989.51,"NM",3,0)
OR BILLING AWARENESS BY USER^^0
"BLD",4767,"KRN",8989.51,"NM",4,0)
ORQQCSDR CS RANGE START^^0
"BLD",4767,"KRN",8989.51,"NM",5,0)
ORQQCSDR CS RANGE STOP^^0
"BLD",4767,"KRN",8989.51,"NM",6,0)
ORQQEAPT ENC APPT START^^0
"BLD",4767,"KRN",8989.51,"NM",7,0)
ORQQEAPT ENC APPT STOP^^0
"BLD",4767,"KRN",8989.51,"NM",8,0)
ORQQEAFL ENC APPT FUTURE LIMIT^^0
"BLD",4767,"KRN",8989.51,"NM",9,0)
OR OREMAS NON-VA MED ORDERS^^0
"BLD",4767,"KRN",8989.51,"NM","B","OR BILLING AWARENESS BY USER",3)

"BLD",4767,"KRN",8989.51,"NM","B","OR BILLING AWARENESS STATUS",2)

"BLD",4767,"KRN",8989.51,"NM","B","OR OREMAS NON-VA MED ORDERS",9)

"BLD",4767,"KRN",8989.51,"NM","B","ORQQCSDR CS RANGE START",4)

"BLD",4767,"KRN",8989.51,"NM","B","ORQQCSDR CS RANGE STOP",5)

"BLD",4767,"KRN",8989.51,"NM","B","ORQQEAFL ENC APPT FUTURE LIMIT",8)

"BLD",4767,"KRN",8989.51,"NM","B","ORQQEAPT ENC APPT START",6)

"BLD",4767,"KRN",8989.51,"NM","B","ORQQEAPT ENC APPT STOP",7)

"BLD",4767,"KRN",8989.51,"NM","B","ORWIM NSS MESSAGE",1)

"BLD",4767,"KRN",8989.52,0)
8989.52
"BLD",4767,"KRN",8989.52,"NM",0)
^9.68A^4^4
"BLD",4767,"KRN",8989.52,"NM",1,0)
ORQQ SEARCH RANGE (DIVISION)^^0
"BLD",4767,"KRN",8989.52,"NM",2,0)
ORQQ SEARCH RANGE (SERVICE)^^0
"BLD",4767,"KRN",8989.52,"NM",3,0)
ORQQ SEARCH RANGE (SYSTEM)^^0
"BLD",4767,"KRN",8989.52,"NM",4,0)
ORQQ SEARCH RANGE (USER)^^0
"BLD",4767,"KRN",8989.52,"NM","B","ORQQ SEARCH RANGE (DIVISION)",1)

"BLD",4767,"KRN",8989.52,"NM","B","ORQQ SEARCH RANGE (SERVICE)",2)

"BLD",4767,"KRN",8989.52,"NM","B","ORQQ SEARCH RANGE (SYSTEM)",3)

"BLD",4767,"KRN",8989.52,"NM","B","ORQQ SEARCH RANGE (USER)",4)

"BLD",4767,"KRN",8994,0)
8994
"BLD",4767,"KRN",8994,"NM",0)
^9.68A^33^33
"BLD",4767,"KRN",8994,"NM",1,0)
ORWDX SAVE^^0
"BLD",4767,"KRN",8994,"NM",2,0)
ORWDPS4 ISUDIV^^0
"BLD",4767,"KRN",8994,"NM",3,0)
ORWPCE CXNOSHOW^^0
"BLD",4767,"KRN",8994,"NM",4,0)
ORWDAL32 LOAD FOR EDIT^^0
"BLD",4767,"KRN",8994,"NM",5,0)
ORWDAL32 SAVE ALLERGY^^0
"BLD",4767,"KRN",8994,"NM",6,0)
ORWDAL32 SITE PARAMS^^0
"BLD",4767,"KRN",8994,"NM",7,0)
ORWDBA1 BASTATUS^^0
"BLD",4767,"KRN",8994,"NM",8,0)
ORWDBA1 GETORDX^^0
"BLD",4767,"KRN",8994,"NM",9,0)
ORWDBA1 ORPKGTYP^^0
"BLD",4767,"KRN",8994,"NM",10,0)
ORWDBA1 RCVORCI^^0
"BLD",4767,"KRN",8994,"NM",11,0)
ORWDBA3 HINTS^^0
"BLD",4767,"KRN",8994,"NM",12,0)
ORWDBA4 GETTFCI^^0
"BLD",4767,"KRN",8994,"NM",13,0)
ORWDBA4 GETBAUSR^^0
"BLD",4767,"KRN",8994,"NM",14,0)
ORWDBA2 GETPDL^^0
"BLD",4767,"KRN",8994,"NM",15,0)
ORWDBA2 ADDPDL^^0
"BLD",4767,"KRN",8994,"NM",16,0)
ORWDBA2 DELPDL^^0
"BLD",4767,"KRN",8994,"NM",17,0)
ORWDBA2 GETDUDC^^0
"BLD",4767,"KRN",8994,"NM",18,0)
ORWDBA1 SCLST^^0
"BLD",4767,"KRN",8994,"NM",19,0)
ORWTPD1 GETEFDAT^^0
"BLD",4767,"KRN",8994,"NM",20,0)
ORWTPD1 GETEDATS^^0
"BLD",4767,"KRN",8994,"NM",21,0)
ORWTPD1 PUTEDATS^^0
"BLD",4767,"KRN",8994,"NM",22,0)
ORWTPD1 GETCSDEF^^0
"BLD",4767,"KRN",8994,"NM",23,0)
ORWTPD1 GETCSRNG^^0
"BLD",4767,"KRN",8994,"NM",24,0)
ORWTPD1 PUTCSRNG^^0
"BLD",4767,"KRN",8994,"NM",25,0)
ORWTPD1 GETEAFL^^0
"BLD",4767,"KRN",8994,"NM",26,0)
ORWNSS NSSMSG^^0
"BLD",4767,"KRN",8994,"NM",27,0)
ORWNSS VALSCH^^0
"BLD",4767,"KRN",8994,"NM",28,0)
ORWNSS QOSCH^^0
"BLD",4767,"KRN",8994,"NM",29,0)
ORWNSS CHKSCH^^0
"BLD",4767,"KRN",8994,"NM",30,0)
ORWTIU CHKTXT^^0
"BLD",4767,"KRN",8994,"NM",31,0)
ORIMO ISCLOC^^0
"BLD",4767,"KRN",8994,"NM",32,0)
ORIMO ISIVQO^^0
"BLD",4767,"KRN",8994,"NM",33,0)
ORWDBA7 GETIEN9^^0
"BLD",4767,"KRN",8994,"NM","B","ORIMO ISCLOC",31)

"BLD",4767,"KRN",8994,"NM","B","ORIMO ISIVQO",32)

"BLD",4767,"KRN",8994,"NM","B","ORWDAL32 LOAD FOR EDIT",4)

"BLD",4767,"KRN",8994,"NM","B","ORWDAL32 SAVE ALLERGY",5)

"BLD",4767,"KRN",8994,"NM","B","ORWDAL32 SITE PARAMS",6)

"BLD",4767,"KRN",8994,"NM","B","ORWDBA1 BASTATUS",7)

"BLD",4767,"KRN",8994,"NM","B","ORWDBA1 GETORDX",8)

"BLD",4767,"KRN",8994,"NM","B","ORWDBA1 ORPKGTYP",9)

"BLD",4767,"KRN",8994,"NM","B","ORWDBA1 RCVORCI",10)

"BLD",4767,"KRN",8994,"NM","B","ORWDBA1 SCLST",18)

"BLD",4767,"KRN",8994,"NM","B","ORWDBA2 ADDPDL",15)

"BLD",4767,"KRN",8994,"NM","B","ORWDBA2 DELPDL",16)

"BLD",4767,"KRN",8994,"NM","B","ORWDBA2 GETDUDC",17)

"BLD",4767,"KRN",8994,"NM","B","ORWDBA2 GETPDL",14)

"BLD",4767,"KRN",8994,"NM","B","ORWDBA3 HINTS",11)

"BLD",4767,"KRN",8994,"NM","B","ORWDBA4 GETBAUSR",13)

"BLD",4767,"KRN",8994,"NM","B","ORWDBA4 GETTFCI",12)

"BLD",4767,"KRN",8994,"NM","B","ORWDBA7 GETIEN9",33)

"BLD",4767,"KRN",8994,"NM","B","ORWDPS4 ISUDIV",2)

"BLD",4767,"KRN",8994,"NM","B","ORWDX SAVE",1)

"BLD",4767,"KRN",8994,"NM","B","ORWNSS CHKSCH",29)

"BLD",4767,"KRN",8994,"NM","B","ORWNSS NSSMSG",26)

"BLD",4767,"KRN",8994,"NM","B","ORWNSS QOSCH",28)

"BLD",4767,"KRN",8994,"NM","B","ORWNSS VALSCH",27)

"BLD",4767,"KRN",8994,"NM","B","ORWPCE CXNOSHOW",3)

"BLD",4767,"KRN",8994,"NM","B","ORWTIU CHKTXT",30)

"BLD",4767,"KRN",8994,"NM","B","ORWTPD1 GETCSDEF",22)

"BLD",4767,"KRN",8994,"NM","B","ORWTPD1 GETCSRNG",23)

"BLD",4767,"KRN",8994,"NM","B","ORWTPD1 GETEAFL",25)

"BLD",4767,"KRN",8994,"NM","B","ORWTPD1 GETEDATS",20)

"BLD",4767,"KRN",8994,"NM","B","ORWTPD1 GETEFDAT",19)

"BLD",4767,"KRN",8994,"NM","B","ORWTPD1 PUTCSRNG",24)

"BLD",4767,"KRN",8994,"NM","B","ORWTPD1 PUTEDATS",21)

"BLD",4767,"KRN","B",.4,.4)

"BLD",4767,"KRN","B",.401,.401)

"BLD",4767,"KRN","B",.402,.402)

"BLD",4767,"KRN","B",.403,.403)

"BLD",4767,"KRN","B",.5,.5)

"BLD",4767,"KRN","B",.84,.84)

"BLD",4767,"KRN","B",3.6,3.6)

"BLD",4767,"KRN","B",3.8,3.8)

"BLD",4767,"KRN","B",9.2,9.2)

"BLD",4767,"KRN","B",9.8,9.8)

"BLD",4767,"KRN","B",19,19)

"BLD",4767,"KRN","B",19.1,19.1)

"BLD",4767,"KRN","B",101,101)

"BLD",4767,"KRN","B",409.61,409.61)

"BLD",4767,"KRN","B",771,771)

"BLD",4767,"KRN","B",870,870)

"BLD",4767,"KRN","B",8989.51,8989.51)

"BLD",4767,"KRN","B",8989.52,8989.52)

"BLD",4767,"KRN","B",8994,8994)

"BLD",4767,"PRE")
ORY195V
"BLD",4767,"QUES",0)
^9.62^^
"BLD",4767,"REQB",0)
^9.611^19^16
"BLD",4767,"REQB",1,0)
OR*3.0*190^2
"BLD",4767,"REQB",2,0)
LEX*2.0*25^2
"BLD",4767,"REQB",3,0)
ICD*18.0*6^2
"BLD",4767,"REQB",4,0)
ICPT*6.0*14^2
"BLD",4767,"REQB",5,0)
IBD*3.0*51^2
"BLD",4767,"REQB",6,0)
XU*8.0*330^2
"BLD",4767,"REQB",7,0)
TIU*1.0*178^2
"BLD",4767,"REQB",8,0)
PSJ*5.0*111^2
"BLD",4767,"REQB",11,0)
OR*3.0*213^2
"BLD",4767,"REQB",12,0)
OR*3.0*183^2
"BLD",4767,"REQB",13,0)
OR*3.0*186^2
"BLD",4767,"REQB",15,0)
XU*8.0*352^2
"BLD",4767,"REQB",16,0)
XWB*1.1*35^2
"BLD",4767,"REQB",17,0)
TIU*1.0*179^2
"BLD",4767,"REQB",18,0)
OR*3.0*158^2
"BLD",4767,"REQB",19,0)
ORRC*1.0*1^2
"BLD",4767,"REQB","B","IBD*3.0*51",5)

"BLD",4767,"REQB","B","ICD*18.0*6",3)

"BLD",4767,"REQB","B","ICPT*6.0*14",4)

"BLD",4767,"REQB","B","LEX*2.0*25",2)

"BLD",4767,"REQB","B","OR*3.0*158",18)

"BLD",4767,"REQB","B","OR*3.0*183",12)

"BLD",4767,"REQB","B","OR*3.0*186",13)

"BLD",4767,"REQB","B","OR*3.0*190",1)

"BLD",4767,"REQB","B","OR*3.0*213",11)

"BLD",4767,"REQB","B","ORRC*1.0*1",19)

"BLD",4767,"REQB","B","PSJ*5.0*111",8)

"BLD",4767,"REQB","B","TIU*1.0*178",7)

"BLD",4767,"REQB","B","TIU*1.0*179",17)

"BLD",4767,"REQB","B","XU*8.0*330",6)

"BLD",4767,"REQB","B","XU*8.0*352",15)

"BLD",4767,"REQB","B","XWB*1.1*35",16)

"DATA",101.24,1004,0)
ORRPW DISCHARGE SUMMARY^OR_DS^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^TIUDCS^ORDV04^57
"DATA",101.24,1004,2)
^^Discharge Summary^Discharge Summary^^HSTYPEB^ORWRPP1^TDCS^ORDV04
"DATA",101.24,1004,3,0)
^101.243^11^9
"DATA",101.24,1004,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1004,3,2,0)
Admitted Date/Time^^3^^^18^1^Admitted^2
"DATA",101.24,1004,3,3,0)
Discharged Date/Time^^4^^^18^1^Discharged^2
"DATA",101.24,1004,3,4,0)
Author / Dictated By^^5^^^10^1
"DATA",101.24,1004,3,5,0)
Approved By        ^^6^^^12^1^Approved By
"DATA",101.24,1004,3,6,0)
Current Status^^7^^^10^1^Status
"DATA",101.24,1004,3,9,0)
ID^1^2
"DATA",101.24,1004,3,10,0)
Summary^1^8^1^1^^1
"DATA",101.24,1004,3,11,0)
[+]^0^9
"DATA",101.24,1004,4)
3:5
"DATA",101.24,1130,0)
ORRPW DOD DISCHARGE SUMMARY^OR_DODDS^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^TIUDCS^ORDV04^57
"DATA",101.24,1130,2)
^^Discharge Summary^DOD Discharge Summary^^HSTYPEB^ORWRPP1^TDCS^ORDV04
"DATA",101.24,1130,3,0)
^101.243^11^9
"DATA",101.24,1130,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1130,3,2,0)
Admitted Date/Time^^3^^^18^1^Admitted^2
"DATA",101.24,1130,3,3,0)
Discharged Date/Time^^4^^^18^1^Discharged^2
"DATA",101.24,1130,3,4,0)
Author / Dictated By^^5^^^10^1
"DATA",101.24,1130,3,5,0)
Approved By        ^^6^^^12^1^Approved By
"DATA",101.24,1130,3,6,0)
Current Status^^7^^^10^1^Status
"DATA",101.24,1130,3,9,0)
ID^1^2
"DATA",101.24,1130,3,10,0)
Summary^1^8^1^1^^1
"DATA",101.24,1130,3,11,0)
[+]^0^9
"DATA",101.24,1130,4)
3:5
"DATA",101.41,130,0)
PSJI OR PAT FLUID OE^IV Fluids^^D^24^2^60^1^2
"DATA",101.41,130,3)
D PROVIDER^ORCDPSIV
"DATA",101.41,130,3.1)
D:$G(ORNP) PROVIDER^ORCDPSIV
"DATA",101.41,130,4)
S:$G(ORXNP) ORNP=ORXNP K PSJNOPC,ORXNP
"DATA",101.41,130,5)
^^^IV Fluids^180
"DATA",101.41,130,10,0)
^101.412IA^13^10
"DATA",101.41,130,10,1,0)
1^4^^Solution: ^^1^1^^C^S.IVB RX^^^Solutions: 
"DATA",101.41,130,10,1,1)
Enter a base solution for this order.
"DATA",101.41,130,10,1,2)
2^^^^^1
"DATA",101.41,130,10,1,4)
I $$ACTIVE^ORDD43(Y)
"DATA",101.41,130,10,1,5)
I $G(ORESET),ORESET'=+Y D CHANGED^ORCDPSIV("B")
"DATA",101.41,130,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,130,10,1,9)
S:FIRST MULT=0
"DATA",101.41,130,10,1,10)
D INACTIVE^ORCDPSIV("B")
"DATA",101.41,130,10,2,0)
2^131^^Additive: ^^^1^^C^S.IVA RX^^^Additives: 
"DATA",101.41,130,10,2,1)
Enter an additive for these IV solutions.
"DATA",101.41,130,10,2,2)
1^^^^in^1
"DATA",101.41,130,10,2,3)
I '($$PREMIX^ORCDPSIV&FIRST)
"DATA",101.41,130,10,2,4)
I $$ACTIVE^ORDD43(Y)
"DATA",101.41,130,10,2,5)
I $G(ORESET),ORESET'=ORDIALOG(PROMPT,ORI) D CHANGED^ORCDPSIV("A")
"DATA",101.41,130,10,2,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,130,10,2,10)
D INACTIVE^ORCDPSIV("A")
"DATA",101.41,130,10,3,0)
2.1^152^^^^1^^^C^^131
"DATA",101.41,130,10,3,1)
Enter the strength of this additive, as a number.
"DATA",101.41,130,10,3,9)
D UNITS^ORCDPSIV
"DATA",101.41,130,10,5,0)
3^128^^Infusion Rate: ^^1^^^C
"DATA",101.41,130,10,5,.1)
D ORINF^PSIVSP
"DATA",101.41,130,10,5,1)
Enter the rate at which the IV is to be administered, as the number of ml/hr or Text@Number of Labels per day.
"DATA",101.41,130,10,5,2)
3^@170
"DATA",101.41,130,10,7,0)
6^15^^Provider Comments: ^^^^^C
"DATA",101.41,130,10,7,1)
Enter any additional comments or instructions for this order.
"DATA",101.41,130,10,7,2)
7^^^^^1
"DATA",101.41,130,10,7,3)
I '$G(PSJNOPC)!($G(ORTYPE)="Z")
"DATA",101.41,130,10,9,0)
2.2^30^^^^^^^C^^131
"DATA",101.41,130,10,9,1)
Enter the units of measurement for this additive.
"DATA",101.41,130,10,9,3)
I '$D(ORDIALOG(PROMPT,INST))
"DATA",101.41,130,10,9,6)
D SETLIST^ORCD
"DATA",101.41,130,10,10,0)
1.1^172^^Volume (in ml): ^^1^^^C^^4
"DATA",101.41,130,10,10,1)
Enter the volume to be administered, as the number of milliliters.
"DATA",101.41,130,10,10,2)
^^^^ml
"DATA",101.41,130,10,10,3)
I $G(ORDIALOG(PROMPT,"LIST"))>1
"DATA",101.41,130,10,10,6)
D LIST^ORCD
"DATA",101.41,130,10,10,7)
S Y=$O(ORDIALOG(PROMPT,"LIST",""),-1) K:'Y Y D:$G(ORDIALOG(PROMPT,"LIST"))>1 LIST^ORCD
"DATA",101.41,130,10,10,9)
D VOLUME^ORCDPSIV
"DATA",101.41,130,10,11,0)
5^7^^Priority: ^^^^^C^S.PSJ
"DATA",101.41,130,10,11,1)
Enter the urgency of this order.
"DATA",101.41,130,10,11,2)
6^^ROUTINE
"DATA",101.41,130,10,11,7)
S Y=+$$RECALL^ORCD(PROMPT) S:Y EDITONLY=1 S:'Y Y=9
"DATA",101.41,130,10,12,0)
4^170^^^^^^^C
"DATA",101.41,130,10,12,1)
Enter a schedule for administering this medication.
"DATA",101.41,130,10,12,2)
4
"DATA",101.41,130,10,12,3)
I $G(ORTYPE)="Z"!$D(ORDIALOG(PROMPT,INST)) ;from editor or backdoor only
"DATA",101.41,130,10,12,5)
N X,Y,D,DIC S X=ORDIALOG(PROMPT,ORI),DIC=51.1,DIC(0)="EQS",D="APPSJ" D IX^DIC S:Y>0 ORDIALOG(PROMPT,ORI)=$P(Y,U,2) I Y'>0 W $C(7),!,"Enter a standard schedule for administering this medication.",! K DONE
"DATA",101.41,130,10,12,6)
N DIC,D,DZ S DIC="^PS(51.1,",DIC(0)="EQS",D="APPSJ",DZ="??" D DQ^DICQ
"DATA",101.41,130,10,13,0)
7^153^^Limitation:^^^^^C
"DATA",101.41,130,10,13,.1)
D IVPSI^ORCDPSIV
"DATA",101.41,130,10,13,1)
Enter the length of administrative time or total volume for IV fluid order followed by ML for milliliters, L for liters, H for hours, D for days
"DATA",101.41,130,10,13,2)
5
"DATA",101.41,130,10,13,3)
D IVPSI1^ORCDPSIV
"DATA",101.41,130,99)
59920,40581
"DATA",101.41,158,0)
OR GTX SEVERITY^Severity: ^^P^^^22
"DATA",101.41,158,1)
S^3:Severe;2:Moderate;1:Mild;^SEVERITY
"DATA",101.41,158,99)
59920,40581
"FIA",100)
ORDER
"FIA",100,0)
^OR(100,
"FIA",100,0,0)
100I
"FIA",100,0,1)
y^n^p^^^^n^^n
"FIA",100,0,10)

"FIA",100,0,11)

"FIA",100,0,"RLRO")

"FIA",100,0,"VR")
3.0^OR
"FIA",100,100)
1
"FIA",100,100,5.1)

"FIA",100,100,80)

"FIA",100,100,90)

"FIA",100,100,91)

"FIA",100,100,92)

"FIA",100,100,93)

"FIA",100,100,94)

"FIA",100,100,95)

"FIA",100,100,96)

"FIA",100,100.04)
0
"FIA",100,100.051)
0
"FIA",101.24)
OE/RR REPORT
"FIA",101.24,0)
^ORD(101.24,
"FIA",101.24,0,0)
101.24I
"FIA",101.24,0,1)
n^n^f^^y^^y^r^n
"FIA",101.24,0,10)

"FIA",101.24,0,11)
I Y=1004!(Y=1130)
"FIA",101.24,0,"RLRO")

"FIA",101.24,0,"VR")
3.0^OR
"FIA",101.24,101.24)
0
"FIA",101.24,101.241)
0
"FIA",101.24,101.243)
0
"FIA",101.41)
ORDER DIALOG
"FIA",101.41,0)
^ORD(101.41,
"FIA",101.41,0,0)
101.41I
"FIA",101.41,0,1)
n^n^f^^y^^y^r^n
"FIA",101.41,0,10)

"FIA",101.41,0,11)
I $P(^ORD(101.41,+Y,0),"^")="PSJI OR PAT FLUID OE"!($P(^ORD(101.41,+Y,0),"^")="OR GTX SEVERITY")
"FIA",101.41,0,"RLRO")

"FIA",101.41,0,"VR")
3.0^OR
"FIA",101.41,101.41)
0
"FIA",101.41,101.411)
0
"FIA",101.41,101.412)
0
"FIA",101.41,101.41218)
0
"FIA",101.41,101.415)
0
"FIA",101.41,101.416)
0
"FIA",101.41,101.4162)
0
"FRV1",101.24,"1004,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1004,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1004,0",21)
DISCHARGE SUMMARY
"FRV1",101.24,"1004,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1130,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1130,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1130,0",21)
DISCHARGE SUMMARY
"FRV1",101.24,"1130,0",21,"F")
;GMT(142.1,
"FRV1",101.41,"130,0",5)
IV MEDICATIONS
"FRV1",101.41,"130,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"130,0",7)
INPATIENT MEDICATIONS
"FRV1",101.41,"130,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"130,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"130,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,10,0",2)
OR GTX VOLUME
"FRV1",101.41,"130,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,10,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"130,10,10,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,11,0",2)
OR GTX URGENCY
"FRV1",101.41,"130,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,12,0",2)
OR GTX SCHEDULE
"FRV1",101.41,"130,10,12,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,13,0",2)
OR GTX DURATION
"FRV1",101.41,"130,10,13,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,2,0",2)
OR GTX ADDITIVE
"FRV1",101.41,"130,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,3,0",2)
OR GTX STRENGTH PSIV
"FRV1",101.41,"130,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,3,0",11)
OR GTX ADDITIVE
"FRV1",101.41,"130,10,3,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,5,0",2)
OR GTX INFUSION RATE
"FRV1",101.41,"130,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,7,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"130,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,9,0",2)
OR GTX UNITS
"FRV1",101.41,"130,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,9,0",11)
OR GTX ADDITIVE
"FRV1",101.41,"130,10,9,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"158,0",7)
ORDER ENTRY/RESULTS REPORTING
"FRV1",101.41,"158,0",7,"F")
;DIC(9.4,
"INI")
PRE^ORY195
"INIT")
POST^ORY195
"KRN",9.2,1406,-1)
0^1
"KRN",9.2,1406,0)
ORBA-SC^ORBA-SC^3040209.132819^
"KRN",9.2,1406,1,0)
^^4^4^3040209^
"KRN",9.2,1406,1,1,0)
Veterans are eligible for medical care for treatment
"KRN",9.2,1406,1,2,0)
of service-connected (SC) conditions without
"KRN",9.2,1406,1,3,0)
incurring copayment charges or claims against their
"KRN",9.2,1406,1,4,0)
insurance.  See 'Help' for additional information.
"KRN",9.2,1406,3,0)
^9.23A^1^1
"KRN",9.2,1406,3,1,0)
ORWDBA3
"KRN",9.2,1407,-1)
0^3
"KRN",9.2,1407,0)
ORBA-MST^ORBA-MST^3040209.133003^
"KRN",9.2,1407,1,0)
^^6^6^3040209^
"KRN",9.2,1407,1,1,0)
Veterans who experienced sexual trauma while serving
"KRN",9.2,1407,1,2,0)
on active duty in the military are eligible to
"KRN",9.2,1407,1,3,0)
receive treatment and counseling services for the
"KRN",9.2,1407,1,4,0)
sexual trauma without incurring copayment charges or
"KRN",9.2,1407,1,5,0)
claims against their insurance.  See 'Help' for
"KRN",9.2,1407,1,6,0)
additional information.
"KRN",9.2,1407,3,0)
^9.23A^1^1
"KRN",9.2,1407,3,1,0)
ORWDBA3
"KRN",9.2,1408,-1)
0^4
"KRN",9.2,1408,0)
ORBA-AO^ORBA-AO^3040209.133218^
"KRN",9.2,1408,1,0)
^^11^11^3040805^
"KRN",9.2,1408,1,1,0)
Agent Orange (AO): herbicide used in Vietnam.
"KRN",9.2,1408,1,2,0)
Veterans who were present within the borders of the
"KRN",9.2,1408,1,3,0)
Republic of Vietnam from January 1962 through May
"KRN",9.2,1408,1,4,0)
1975 are presumed to have been exposed to Agent
"KRN",9.2,1408,1,5,0)
Orange and are eligible to receive care of conditions
"KRN",9.2,1408,1,6,0)
possibly for AO exposure without incurring copayment
"KRN",9.2,1408,1,7,0)
charges or claims against their insurance. Some
"KRN",9.2,1408,1,8,0)
conditions associated with AO exposure: diabetes
"KRN",9.2,1408,1,9,0)
(type 2), chloracne, porphyria cutanea tarda,
"KRN",9.2,1408,1,10,0)
peripheral neuropathy and some cancers.  See 'Help'
"KRN",9.2,1408,1,11,0)
for additional information.
"KRN",9.2,1408,3,0)
^9.23A^1^1
"KRN",9.2,1408,3,1,0)
ORWDBA3
"KRN",9.2,1409,-1)
0^5
"KRN",9.2,1409,0)
ORBA-IR^ORBA-IR^3040209.133624^
"KRN",9.2,1409,1,0)
^^9^9^3040209^
"KRN",9.2,1409,1,1,0)
Veterans exposed to ionizing radiation (IR) as a
"KRN",9.2,1409,1,2,0)
POW or while on active duty in Hiroshima and/or
"KRN",9.2,1409,1,3,0)
Nagasaki, Japan, or who served at a nuclear device
"KRN",9.2,1409,1,4,0)
atmospheric testing site are eligible to receive
"KRN",9.2,1409,1,5,0)
care of any malignant condition and certain other
"KRN",9.2,1409,1,6,0)
non-malignant conditions for IR exposure without
"KRN",9.2,1409,1,7,0)
incurring copayment charges or claims against
"KRN",9.2,1409,1,8,0)
their insurance.  See 'Help' for additional
"KRN",9.2,1409,1,9,0)
information.
"KRN",9.2,1409,3,0)
^9.23A^1^1
"KRN",9.2,1409,3,1,0)
ORWDBA3
"KRN",9.2,1410,-1)
0^6
"KRN",9.2,1410,0)
ORBA-EC^ORBA-EC^3040209.134014^
"KRN",9.2,1410,1,0)
^^9^9^3040209^
"KRN",9.2,1410,1,1,0)
Veterans who served in Southwest Asia during the
"KRN",9.2,1410,1,2,0)
Gulf War are eligible to receive treatment for
"KRN",9.2,1410,1,3,0)
conditions relating to this service, including
"KRN",9.2,1410,1,4,0)
exposure to depleted uranium, pesticides, anti-
"KRN",9.2,1410,1,5,0)
nerve gas pill, pyridostigmine bromide, infectious
"KRN",9.2,1410,1,6,0)
diseases, chemical and biological warfare agents,
"KRN",9.2,1410,1,7,0)
etc. without incurring copayment charges or claims
"KRN",9.2,1410,1,8,0)
against their insurance.  See 'Help' for additional
"KRN",9.2,1410,1,9,0)
information.
"KRN",9.2,1410,3,0)
^9.23A^1^1
"KRN",9.2,1410,3,1,0)
ORWDBA3
"KRN",9.2,1411,-1)
0^2
"KRN",9.2,1411,0)
ORBA-HNC^ORBA-HNC^3040209.13432^
"KRN",9.2,1411,1,0)
^^7^7^3040209^
"KRN",9.2,1411,1,1,0)
Veterans with cancer of the head or neck and a
"KRN",9.2,1411,1,2,0)
history of receipt of Nasopharyngeal (NP) radium
"KRN",9.2,1411,1,3,0)
therapy while in the military are eligible to
"KRN",9.2,1411,1,4,0)
receive treatment for the head or neck cancer
"KRN",9.2,1411,1,5,0)
without incurring copayment charges or claims
"KRN",9.2,1411,1,6,0)
against their insurance.  See 'Help' for additional
"KRN",9.2,1411,1,7,0)
information.
"KRN",9.2,1411,3,0)
^9.23A^1^1
"KRN",9.2,1411,3,1,0)
ORWDBA3
"KRN",9.2,1412,-1)
0^7
"KRN",9.2,1412,0)
ORBA-CV^ORBA-CV^3040209.134525^
"KRN",9.2,1412,1,0)
^9.21^11^11^3040209^^
"KRN",9.2,1412,1,1,0)
To receive Combat Veteran (CV) exemption, the veteran
"KRN",9.2,1412,1,2,0)
must have served in combat operations after the Gulf
"KRN",9.2,1412,1,3,0)
War or in combat against a hostile force after
"KRN",9.2,1412,1,4,0)
November 11, 1998.  In addition, the condition for which
"KRN",9.2,1412,1,5,0)
the veteran is treated must be related to that combat,
"KRN",9.2,1412,1,6,0)
the veteran must have registered as a combat veteran,
"KRN",9.2,1412,1,7,0)
and be within two years of separation from active
"KRN",9.2,1412,1,8,0)
military service.  Finally, the condition must not be
"KRN",9.2,1412,1,9,0)
already considered to be service related or that
"KRN",9.2,1412,1,10,0)
exemption should apply.  See 'Help' for additional
"KRN",9.2,1412,1,11,0)
information.
"KRN",9.2,1412,3,0)
^9.23A^1^1
"KRN",9.2,1412,3,1,0)
ORWDBA3
"KRN",19,10082,-1)
0^4
"KRN",19,10082,0)
OR CPRS GUI CHART^CPRSChart version 1.0.25.28^^B^^^^^^^^
"KRN",19,10082,1,0)
^19.06^2^2^3041209^^^^
"KRN",19,10082,1,1,0)
This option is required by the Kernel Broker to give access to the
"KRN",19,10082,1,2,0)
RPCs used by the CPRS GUI (CPRSChart.EXE).
"KRN",19,10082,99.1)
59876,23229
"KRN",19,10082,"RPC",0)
^19.05P^1977^1977
"KRN",19,10082,"RPC",1,0)
GMRC LIST CONSULT REQUESTS
"KRN",19,10082,"RPC",218,0)
XWB GET VARIABLE VALUE
"KRN",19,10082,"RPC",219,0)
TIU AUTHORIZATION
"KRN",19,10082,"RPC",220,0)
TIU CAN CHANGE COSIGNER?
"KRN",19,10082,"RPC",221,0)
TIU CREATE ADDENDUM RECORD
"KRN",19,10082,"RPC",222,0)
TIU CREATE RECORD
"KRN",19,10082,"RPC",223,0)
TIU DELETE RECORD
"KRN",19,10082,"RPC",224,0)
TIU DETAILED DISPLAY
"KRN",19,10082,"RPC",225,0)
TIU DOCUMENTS BY CONTEXT
"KRN",19,10082,"RPC",226,0)
TIU GET ADDITIONAL SIGNERS
"KRN",19,10082,"RPC",227,0)
TIU GET ALERT INFO
"KRN",19,10082,"RPC",228,0)
TIU GET DOCUMENT PARAMETERS
"KRN",19,10082,"RPC",229,0)
TIU GET DS TITLES
"KRN",19,10082,"RPC",230,0)
TIU GET DS URGENCIES
"KRN",19,10082,"RPC",231,0)
TIU GET PERSONAL PREFERENCES
"KRN",19,10082,"RPC",232,0)
TIU GET PN TITLES
"KRN",19,10082,"RPC",233,0)
TIU GET RECORD TEXT
"KRN",19,10082,"RPC",234,0)
TIU IDENTIFY CONSULTS CLASS
"KRN",19,10082,"RPC",235,0)
TIU IS THIS A CONSULT?
"KRN",19,10082,"RPC",236,0)
TIU JUSTIFY DELETE?
"KRN",19,10082,"RPC",237,0)
TIU LOAD BOILERPLATE TEXT
"KRN",19,10082,"RPC",238,0)
TIU LOAD RECORD FOR EDIT
"KRN",19,10082,"RPC",239,0)
TIU LOCK RECORD
"KRN",19,10082,"RPC",240,0)
TIU LONG LIST CONSULT TITLES
"KRN",19,10082,"RPC",241,0)
TIU LONG LIST OF TITLES
"KRN",19,10082,"RPC",242,0)
TIU NOTES
"KRN",19,10082,"RPC",243,0)
TIU NOTES 16 BIT
"KRN",19,10082,"RPC",244,0)
TIU NOTES BY VISIT
"KRN",19,10082,"RPC",245,0)
TIU PERSONAL TITLE LIST
"KRN",19,10082,"RPC",246,0)
TIU PRINT RECORD
"KRN",19,10082,"RPC",247,0)
TIU REQUIRES COSIGNATURE
"KRN",19,10082,"RPC",248,0)
TIU SIGN RECORD
"KRN",19,10082,"RPC",249,0)
TIU SUMMARIES
"KRN",19,10082,"RPC",250,0)
TIU SUMMARIES BY VISIT
"KRN",19,10082,"RPC",251,0)
TIU UNLOCK RECORD
"KRN",19,10082,"RPC",252,0)
TIU UPDATE ADDITIONAL SIGNERS
"KRN",19,10082,"RPC",253,0)
TIU UPDATE RECORD
"KRN",19,10082,"RPC",254,0)
TIU WHICH SIGNATURE ACTION
"KRN",19,10082,"RPC",1032,0)
ORB DELETE ALERT
"KRN",19,10082,"RPC",1033,0)
ORB FOLLOW-UP ARRAY
"KRN",19,10082,"RPC",1034,0)
ORB FOLLOW-UP STRING
"KRN",19,10082,"RPC",1035,0)
ORB FOLLOW-UP TYPE
"KRN",19,10082,"RPC",1036,0)
ORB SORT METHOD
"KRN",19,10082,"RPC",1037,0)
ORK TRIGGER
"KRN",19,10082,"RPC",1038,0)
ORQ NULL LIST
"KRN",19,10082,"RPC",1039,0)
ORQOR DETAIL
"KRN",19,10082,"RPC",1040,0)
TIU TEMPLATE CHECK BOILERPLATE
"KRN",19,10082,"RPC",1041,0)
TIU TEMPLATE CREATE/MODIFY
"KRN",19,10082,"RPC",1042,0)
TIU TEMPLATE DELETE
"KRN",19,10082,"RPC",1045,0)
TIU TEMPLATE GETPROOT
"KRN",19,10082,"RPC",1049,0)
TIU TEMPLATE LISTOWNR
"KRN",19,10082,"RPC",1050,0)
TIU TEMPLATE SET ITEMS
"KRN",19,10082,"RPC",1051,0)
TIU GET LIST OF OBJECTS
"KRN",19,10082,"RPC",1052,0)
ORQOR LIST
"KRN",19,10082,"RPC",1053,0)
ORQORB SORT
"KRN",19,10082,"RPC",1054,0)
ORQPT ATTENDING/PRIMARY
"KRN",19,10082,"RPC",1055,0)
ORQPT CLINIC PATIENTS
"KRN",19,10082,"RPC",1056,0)
ORQPT CLINICS
"KRN",19,10082,"RPC",1057,0)
ORQPT DEFAULT LIST SOURCE
"KRN",19,10082,"RPC",1058,0)
ORQPT DEFAULT PATIENT LIST
"KRN",19,10082,"RPC",1059,0)
ORQPT PATIENT TEAM PROVIDERS
"KRN",19,10082,"RPC",1060,0)
ORQPT PROVIDER PATIENTS
"KRN",19,10082,"RPC",1061,0)
ORQPT PROVIDERS
"KRN",19,10082,"RPC",1062,0)
ORQPT SPECIALTIES
"KRN",19,10082,"RPC",1063,0)
ORQPT SPECIALTY PATIENTS
"KRN",19,10082,"RPC",1064,0)
ORQPT TEAM PATIENTS
"KRN",19,10082,"RPC",1065,0)
ORQPT TEAMS
"KRN",19,10082,"RPC",1066,0)
ORQPT WARD PATIENTS
"KRN",19,10082,"RPC",1067,0)
ORQPT WARDRMBED
"KRN",19,10082,"RPC",1068,0)
ORQPT WARDS
"KRN",19,10082,"RPC",1069,0)
ORQQAL DETAIL
"KRN",19,10082,"RPC",1070,0)
ORQQAL LIST
"KRN",19,10082,"RPC",1071,0)
ORQQAL LIST REPORT
"KRN",19,10082,"RPC",1072,0)
ORQQCN ADDCMT
"KRN",19,10082,"RPC",1073,0)
ORQQCN ADMIN COMPLETE
"KRN",19,10082,"RPC",1074,0)
ORQQCN DETAIL
"KRN",19,10082,"RPC",1075,0)
ORQQCN DISCONTINUE
"KRN",19,10082,"RPC",1076,0)
ORQQCN FIND CONSULT
"KRN",19,10082,"RPC",1077,0)
ORQQCN FORWARD
"KRN",19,10082,"RPC",1078,0)
ORQQCN GET CONSULT
"KRN",19,10082,"RPC",1079,0)
ORQQCN GET ORDER NUMBER
"KRN",19,10082,"RPC",1080,0)
ORQQCN GET PROC SVCS
"KRN",19,10082,"RPC",1081,0)
ORQQCN LIST
"KRN",19,10082,"RPC",1082,0)
ORQQCN LOAD FOR EDIT
"KRN",19,10082,"RPC",1083,0)
ORQQCN MED RESULTS
"KRN",19,10082,"RPC",1084,0)
ORQQCN PRINT SF513
"KRN",19,10082,"RPC",1085,0)
ORQQCN RECEIVE
"KRN",19,10082,"RPC",1086,0)
ORQQCN RESUBMIT
"KRN",19,10082,"RPC",1087,0)
ORQQCN SET ACT MENUS
"KRN",19,10082,"RPC",1088,0)
ORQQCN SHOW SF513
"KRN",19,10082,"RPC",1089,0)
ORQQCN SIGFIND
"KRN",19,10082,"RPC",1090,0)
ORQQCN STATUS
"KRN",19,10082,"RPC",1091,0)
ORQQCN SVCLIST
"KRN",19,10082,"RPC",1092,0)
ORQQCN SVCTREE
"KRN",19,10082,"RPC",1093,0)
ORQQCN URGENCIES
"KRN",19,10082,"RPC",1094,0)
ORQQCN2 GET CONTEXT
"KRN",19,10082,"RPC",1095,0)
ORQQCN2 SAVE CONTEXT
"KRN",19,10082,"RPC",1096,0)
ORQQLR DETAIL
"KRN",19,10082,"RPC",1097,0)
ORQQLR SEARCH RANGE INPT
"KRN",19,10082,"RPC",1098,0)
ORQQLR SEARCH RANGE OUTPT
"KRN",19,10082,"RPC",1099,0)
ORQQPL ADD SAVE
"KRN",19,10082,"RPC",1100,0)
ORQQPL AUDIT HIST
"KRN",19,10082,"RPC",1101,0)
ORQQPL CHECK DUP
"KRN",19,10082,"RPC",1102,0)
ORQQPL CLIN FILTER LIST
"KRN",19,10082,"RPC",1103,0)
ORQQPL CLIN SRCH
"KRN",19,10082,"RPC",1104,0)
ORQQPL DELETE
"KRN",19,10082,"RPC",1105,0)
ORQQPL DETAIL
"KRN",19,10082,"RPC",1106,0)
ORQQPL EDIT LOAD
"KRN",19,10082,"RPC",1107,0)
ORQQPL EDIT SAVE
"KRN",19,10082,"RPC",1108,0)
ORQQPL INACTIVATE
"KRN",19,10082,"RPC",1109,0)
ORQQPL INIT PT
"KRN",19,10082,"RPC",1110,0)
ORQQPL INIT USER
"KRN",19,10082,"RPC",1111,0)
ORQQPL LIST
"KRN",19,10082,"RPC",1112,0)
ORQQPL PROB COMMENTS
"KRN",19,10082,"RPC",1113,0)
ORQQPL PROBLEM LEX SEARCH
"KRN",19,10082,"RPC",1114,0)
ORQQPL PROBLEM LIST
"KRN",19,10082,"RPC",1115,0)
ORQQPL PROV FILTER LIST
"KRN",19,10082,"RPC",1116,0)
ORQQPL PROVIDER LIST
"KRN",19,10082,"RPC",1117,0)
ORQQPL REPLACE
"KRN",19,10082,"RPC",1118,0)
ORQQPL SAVEVIEW
"KRN",19,10082,"RPC",1119,0)
ORQQPL SERV FILTER LIST
"KRN",19,10082,"RPC",1120,0)
ORQQPL SRVC SRCH
"KRN",19,10082,"RPC",1121,0)
ORQQPL UPDATE
"KRN",19,10082,"RPC",1122,0)
ORQQPL USER PROB CATS
"KRN",19,10082,"RPC",1123,0)
ORQQPL USER PROB LIST
"KRN",19,10082,"RPC",1124,0)
ORQQPL VERIFY
"KRN",19,10082,"RPC",1125,0)
ORQQPP LIST
"KRN",19,10082,"RPC",1126,0)
ORQQPS DETAIL
"KRN",19,10082,"RPC",1127,0)
ORQQPS LIST
"KRN",19,10082,"RPC",1133,0)
ORQQPX REMINDER DETAIL
"KRN",19,10082,"RPC",1135,0)
ORQQPX REMINDERS LIST
"KRN",19,10082,"RPC",1136,0)
ORQQVI NOTEVIT
"KRN",19,10082,"RPC",1137,0)
ORQQVI VITALS
"KRN",19,10082,"RPC",1138,0)
ORQQVI VITALS FOR DATE RANGE
"KRN",19,10082,"RPC",1139,0)
ORQQVI1 DETAIL
"KRN",19,10082,"RPC",1140,0)
ORQQVI1 GRID
"KRN",19,10082,"RPC",1141,0)
ORQQVI2 VITALS HELP
"KRN",19,10082,"RPC",1142,0)
ORQQVI2 VITALS RATE CHECK
"KRN",19,10082,"RPC",1144,0)
ORQQVI2 VITALS VAL & STORE
"KRN",19,10082,"RPC",1145,0)
ORQQVI2 VITALS VALIDATE
"KRN",19,10082,"RPC",1146,0)
ORQQVI2 VITALS VALIDATE TYPE
"KRN",19,10082,"RPC",1147,0)
ORQQVS DETAIL NOTES
"KRN",19,10082,"RPC",1148,0)
ORQQVS DETAIL SUMMARY
"KRN",19,10082,"RPC",1149,0)
ORQQVS VISITS/APPTS
"KRN",19,10082,"RPC",1150,0)
ORQQXMB MAIL GROUPS
"KRN",19,10082,"RPC",1151,0)
ORQQXQA PATIENT
"KRN",19,10082,"RPC",1152,0)
ORQQXQA USER
"KRN",19,10082,"RPC",1153,0)
ORWCH LOADALL
"KRN",19,10082,"RPC",1154,0)
ORWCH LOADSIZ
"KRN",19,10082,"RPC",1155,0)
ORWCH SAVEALL
"KRN",19,10082,"RPC",1156,0)
ORWCH SAVESIZ
"KRN",19,10082,"RPC",1157,0)
ORWCS LIST OF CONSULT REPORTS
"KRN",19,10082,"RPC",1158,0)
ORWCS PRINT REPORT
"KRN",19,10082,"RPC",1159,0)
ORWCS REPORT TEXT
"KRN",19,10082,"RPC",1160,0)
ORWCV DTLVST
"KRN",19,10082,"RPC",1161,0)
ORWCV LAB
"KRN",19,10082,"RPC",1162,0)
ORWCV POLL
"KRN",19,10082,"RPC",1163,0)
ORWCV START
"KRN",19,10082,"RPC",1164,0)
ORWCV STOP
"KRN",19,10082,"RPC",1165,0)
ORWCV VST
"KRN",19,10082,"RPC",1166,0)
ORWD DEF
"KRN",19,10082,"RPC",1167,0)
ORWD DT
"KRN",19,10082,"RPC",1168,0)
ORWD FORMID
"KRN",19,10082,"RPC",1169,0)
ORWD GET4EDIT
"KRN",19,10082,"RPC",1170,0)
ORWD KEY
"KRN",19,10082,"RPC",1171,0)
ORWD OI
"KRN",19,10082,"RPC",1172,0)
ORWD PROVKEY
"KRN",19,10082,"RPC",1173,0)
ORWD SAVE
"KRN",19,10082,"RPC",1174,0)
ORWD SAVEACT
"KRN",19,10082,"RPC",1175,0)
ORWD SIGN
"KRN",19,10082,"RPC",1176,0)
ORWD VALIDACT
"KRN",19,10082,"RPC",1177,0)
ORWD1 PARAM
"KRN",19,10082,"RPC",1178,0)
ORWD1 PRINTGUI
"KRN",19,10082,"RPC",1179,0)
ORWD1 RVPRINT
"KRN",19,10082,"RPC",1180,0)
ORWD2 DEVINFO
"KRN",19,10082,"RPC",1181,0)
ORWD2 MANUAL
"KRN",19,10082,"RPC",1182,0)
ORWDAL32 ALLERGY MATCH
"KRN",19,10082,"RPC",1183,0)
ORWDAL32 DEF
"KRN",19,10082,"RPC",1184,0)
ORWDAL32 SYMPTOMS
"KRN",19,10082,"RPC",1185,0)
ORWDCN32 DEF
"KRN",19,10082,"RPC",1186,0)
ORWDCN32 ORDRMSG
"KRN",19,10082,"RPC",1187,0)
ORWDCN32 PROCEDURES
"KRN",19,10082,"RPC",1188,0)
ORWDCSLT DEF
"KRN",19,10082,"RPC",1189,0)
ORWDCSLT LOOK200
"KRN",19,10082,"RPC",1190,0)
ORWDFH ADDLATE
"KRN",19,10082,"RPC",1191,0)
ORWDFH ATTR
"KRN",19,10082,"RPC",1192,0)
ORWDFH CURISO
"KRN",19,10082,"RPC",1193,0)
ORWDFH DIETS
"KRN",19,10082,"RPC",1194,0)
ORWDFH FINDTYP
"KRN",19,10082,"RPC",1195,0)
ORWDFH ISOIEN
"KRN",19,10082,"RPC",1196,0)
ORWDFH ISOLIST
"KRN",19,10082,"RPC",1197,0)
ORWDFH PARAM
"KRN",19,10082,"RPC",1198,0)
ORWDFH QTY2CC
"KRN",19,10082,"RPC",1199,0)
ORWDFH TFPROD
"KRN",19,10082,"RPC",1200,0)
ORWDFH TXT
"KRN",19,10082,"RPC",1201,0)
ORWDGX LOAD
"KRN",19,10082,"RPC",1202,0)
ORWDGX VMDEF
"KRN",19,10082,"RPC",1203,0)
ORWDLR ABBSPEC
"KRN",19,10082,"RPC",1204,0)
ORWDLR ALLSAMP
"KRN",19,10082,"RPC",1205,0)
ORWDLR DEF
"KRN",19,10082,"RPC",1206,0)
ORWDLR LOAD
"KRN",19,10082,"RPC",1207,0)
ORWDLR OIPARAM
"KRN",19,10082,"RPC",1208,0)
ORWDLR STOP
"KRN",19,10082,"RPC",1209,0)
ORWDLR32 ABBSPEC
"KRN",19,10082,"RPC",1210,0)
ORWDLR32 ALLSAMP
"KRN",19,10082,"RPC",1211,0)
ORWDLR32 ALLSPEC
"KRN",19,10082,"RPC",1212,0)
ORWDLR32 DEF
"KRN",19,10082,"RPC",1213,0)
ORWDLR32 IC DEFAULT
"KRN",19,10082,"RPC",1214,0)
ORWDLR32 IC VALID
"KRN",19,10082,"RPC",1215,0)
ORWDLR32 IMMED COLLECT
"KRN",19,10082,"RPC",1216,0)
ORWDLR32 LAB COLL TIME
"KRN",19,10082,"RPC",1217,0)
ORWDLR32 LOAD
"KRN",19,10082,"RPC",1218,0)
ORWDLR32 MAXDAYS
"KRN",19,10082,"RPC",1219,0)
ORWDLR32 ONE SAMPLE
"KRN",19,10082,"RPC",1220,0)
ORWDLR32 ONE SPECIMEN
"KRN",19,10082,"RPC",1221,0)
ORWDLR32 STOP
"KRN",19,10082,"RPC",1222,0)
ORWDOR VMSLCT
"KRN",19,10082,"RPC",1227,0)
ORWDPS32 ALLROUTE
"KRN",19,10082,"RPC",1228,0)
ORWDPS32 AUTH
"KRN",19,10082,"RPC",1229,0)
ORWDPS32 DLGSLCT
"KRN",19,10082,"RPC",1230,0)
ORWDPS32 DOSES
"KRN",19,10082,"RPC",1231,0)
ORWDPS32 DRUGMSG
"KRN",19,10082,"RPC",1232,0)
ORWDPS32 FORMALT
"KRN",19,10082,"RPC",1233,0)
ORWDPS32 ISSPLY
"KRN",19,10082,"RPC",1234,0)
ORWDPS32 IVAMT
"KRN",19,10082,"RPC",1235,0)
ORWDPS32 MEDISIV
"KRN",19,10082,"RPC",1236,0)
ORWDPS32 OISLCT
"KRN",19,10082,"RPC",1237,0)
ORWDPS32 SCSTS
"KRN",19,10082,"RPC",1238,0)
ORWDPS32 VALQTY
"KRN",19,10082,"RPC",1239,0)
ORWDPS32 VALRATE
"KRN",19,10082,"RPC",1240,0)
ORWDPS32 VALSCH
"KRN",19,10082,"RPC",1241,0)
ORWDRA DEF
"KRN",19,10082,"RPC",1242,0)
ORWDRA32 APPROVAL
"KRN",19,10082,"RPC",1243,0)
ORWDRA32 DEF
"KRN",19,10082,"RPC",1244,0)
ORWDRA32 IMTYPSEL
"KRN",19,10082,"RPC",1245,0)
ORWDRA32 ISOLATN
"KRN",19,10082,"RPC",1246,0)
ORWDRA32 LOCTYPE
"KRN",19,10082,"RPC",1247,0)
ORWDRA32 PROCMSG
"KRN",19,10082,"RPC",1248,0)
ORWDRA32 RADSRC
"KRN",19,10082,"RPC",1249,0)
ORWDRA32 RAORDITM
"KRN",19,10082,"RPC",1250,0)
ORWDX AGAIN
"KRN",19,10082,"RPC",1251,0)
ORWDX DGRP
"KRN",19,10082,"RPC",1252,0)
ORWDX DISMSG
"KRN",19,10082,"RPC",1253,0)
ORWDX DLGDEF
"KRN",19,10082,"RPC",1254,0)
ORWDX DLGID
"KRN",19,10082,"RPC",1255,0)
ORWDX DLGQUIK
"KRN",19,10082,"RPC",1256,0)
ORWDX FORMID
"KRN",19,10082,"RPC",1257,0)
ORWDX LOADRSP
"KRN",19,10082,"RPC",1258,0)
ORWDX LOCK
"KRN",19,10082,"RPC",1259,0)
ORWDX MSG
"KRN",19,10082,"RPC",1260,0)
ORWDX ORDITM
"KRN",19,10082,"RPC",1261,0)
ORWDX SAVE
"KRN",19,10082,"RPC",1262,0)
ORWDX SEND
"KRN",19,10082,"RPC",1263,0)
ORWDX SENDP
"KRN",19,10082,"RPC",1264,0)
ORWDX UNLOCK
"KRN",19,10082,"RPC",1265,0)
ORWDX WRLST
"KRN",19,10082,"RPC",1266,0)
ORWDXA ALERT
"KRN",19,10082,"RPC",1267,0)
ORWDXA COMPLETE
"KRN",19,10082,"RPC",1268,0)
ORWDXA DC
"KRN",19,10082,"RPC",1269,0)
ORWDXA DCREASON
"KRN",19,10082,"RPC",1270,0)
ORWDXA DCREQIEN
"KRN",19,10082,"RPC",1271,0)
ORWDXA FLAG
"KRN",19,10082,"RPC",1272,0)
ORWDXA FLAGTXT
"KRN",19,10082,"RPC",1273,0)
ORWDXA HOLD
"KRN",19,10082,"RPC",1274,0)
ORWDXA UNFLAG
"KRN",19,10082,"RPC",1275,0)
ORWDXA UNHOLD
"KRN",19,10082,"RPC",1276,0)
ORWDXA VALID
"KRN",19,10082,"RPC",1277,0)
ORWDXA VERIFY
"KRN",19,10082,"RPC",1278,0)
ORWDXA WCGET
"KRN",19,10082,"RPC",1279,0)
ORWDXA WCPUT
"KRN",19,10082,"RPC",1280,0)
ORWDXC ACCEPT
"KRN",19,10082,"RPC",1281,0)
ORWDXC DELAY
"KRN",19,10082,"RPC",1282,0)
ORWDXC DELORD
"KRN",19,10082,"RPC",1283,0)
ORWDXC DISPLAY
"KRN",19,10082,"RPC",1284,0)
ORWDXC FILLID
"KRN",19,10082,"RPC",1285,0)
ORWDXC ON
"KRN",19,10082,"RPC",1286,0)
ORWDXC SAVECHK
"KRN",19,10082,"RPC",1287,0)
ORWDXC SESSION
"KRN",19,10082,"RPC",1288,0)
ORWDXM AUTOACK
"KRN",19,10082,"RPC",1289,0)
ORWDXM DLGNAME
"KRN",19,10082,"RPC",1290,0)
ORWDXM FORMID
"KRN",19,10082,"RPC",1291,0)
ORWDXM LOADSET
"KRN",19,10082,"RPC",1292,0)
ORWDXM MENU
"KRN",19,10082,"RPC",1293,0)
ORWDXM MSTYLE
"KRN",19,10082,"RPC",1294,0)
ORWDXM PROMPTS
"KRN",19,10082,"RPC",1295,0)
ORWDXM1 BLDQRSP
"KRN",19,10082,"RPC",1296,0)
ORWDXM2 CLRRCL
"KRN",19,10082,"RPC",1297,0)
ORWDXQ DLGNAME
"KRN",19,10082,"RPC",1298,0)
ORWDXQ DLGSAVE
"KRN",19,10082,"RPC",1299,0)
ORWDXQ GETQLST
"KRN",19,10082,"RPC",1300,0)
ORWDXQ GETQNAM
"KRN",19,10082,"RPC",1301,0)
ORWDXQ PUTQLST
"KRN",19,10082,"RPC",1302,0)
ORWDXQ PUTQNAM
"KRN",19,10082,"RPC",1303,0)
ORWDXR ISREL
"KRN",19,10082,"RPC",1304,0)
ORWDXR RENEW
"KRN",19,10082,"RPC",1305,0)
ORWDXR RNWFLDS
"KRN",19,10082,"RPC",1306,0)
ORWGEPT CLINRNG
"KRN",19,10082,"RPC",1307,0)
ORWLR CUMULATIVE REPORT
"KRN",19,10082,"RPC",1308,0)
ORWLR CUMULATIVE SECTION
"KRN",19,10082,"RPC",1309,0)
ORWLR REPORT LISTS
"KRN",19,10082,"RPC",1310,0)
ORWLRR ALLTESTS
"KRN",19,10082,"RPC",1311,0)
ORWLRR ATESTS
"KRN",19,10082,"RPC",1312,0)
ORWLRR ATG
"KRN",19,10082,"RPC",1313,0)
ORWLRR ATOMICS
"KRN",19,10082,"RPC",1314,0)
ORWLRR CHART
"KRN",19,10082,"RPC",1315,0)
ORWLRR CHEMTEST
"KRN",19,10082,"RPC",1316,0)
ORWLRR GRID
"KRN",19,10082,"RPC",1317,0)
ORWLRR INTERIM
"KRN",19,10082,"RPC",1318,0)
ORWLRR INTERIMG
"KRN",19,10082,"RPC",1319,0)
ORWLRR INTERIMS
"KRN",19,10082,"RPC",1320,0)
ORWLRR MICRO
"KRN",19,10082,"RPC",1321,0)
ORWLRR NEWOLD
"KRN",19,10082,"RPC",1322,0)
ORWLRR PARAM
"KRN",19,10082,"RPC",1323,0)
ORWLRR SPEC
"KRN",19,10082,"RPC",1324,0)
ORWLRR TG
"KRN",19,10082,"RPC",1325,0)
ORWLRR USERS
"KRN",19,10082,"RPC",1326,0)
ORWLRR UTGA
"KRN",19,10082,"RPC",1327,0)
ORWLRR UTGD
"KRN",19,10082,"RPC",1328,0)
ORWLRR UTGR
"KRN",19,10082,"RPC",1329,0)
ORWMC PATIENT PROCEDURES
"KRN",19,10082,"RPC",1330,0)
ORWOR RESULT
"KRN",19,10082,"RPC",1331,0)
ORWOR SHEETS
"KRN",19,10082,"RPC",1332,0)
ORWOR TSALL
"KRN",19,10082,"RPC",1333,0)
ORWORB AUTOUNFLAG ORDERS
"KRN",19,10082,"RPC",1334,0)
ORWORB FASTUSER
"KRN",19,10082,"RPC",1335,0)
ORWORB GET TIU ALERT INFO
"KRN",19,10082,"RPC",1336,0)
ORWORB GETDATA
"KRN",19,10082,"RPC",1337,0)
ORWORB KILL UNSIG ORDERS ALERT
"KRN",19,10082,"RPC",1339,0)
ORWORDG ALLTREE
"KRN",19,10082,"RPC",1340,0)
ORWORDG GRPSEQB
"KRN",19,10082,"RPC",1341,0)
ORWORDG IEN
"KRN",19,10082,"RPC",1342,0)
ORWORDG MAPSEQ
"KRN",19,10082,"RPC",1343,0)
ORWORDG REVSTS
"KRN",19,10082,"RPC",1344,0)
ORWORR AGET
"KRN",19,10082,"RPC",1345,0)
ORWORR GET
"KRN",19,10082,"RPC",1346,0)
ORWORR GET4LST
"KRN",19,10082,"RPC",1347,0)
ORWORR GETBYIFN
"KRN",19,10082,"RPC",1348,0)
ORWORR GETTXT
"KRN",19,10082,"RPC",1349,0)
ORWPCE ACTIVE PROV
"KRN",19,10082,"RPC",1350,0)
ORWPCE ACTPROB
"KRN",19,10082,"RPC",1351,0)
ORWPCE CPTREQD
"KRN",19,10082,"RPC",1352,0)
ORWPCE DELETE
"KRN",19,10082,"RPC",1353,0)
ORWPCE DIAG
"KRN",19,10082,"RPC",1354,0)
ORWPCE GET EDUCATION TOPICS
"KRN",19,10082,"RPC",1355,0)
ORWPCE GET EXAM TYPE
"KRN",19,10082,"RPC",1356,0)
ORWPCE GET HEALTH FACTORS TY
"KRN",19,10082,"RPC",1357,0)
ORWPCE GET IMMUNIZATION TYPE
"KRN",19,10082,"RPC",1358,0)
ORWPCE GET SET OF CODES
"KRN",19,10082,"RPC",1359,0)
ORWPCE GET SKIN TEST TYPE
"KRN",19,10082,"RPC",1360,0)
ORWPCE GET TREATMENT TYPE
"KRN",19,10082,"RPC",1361,0)
ORWPCE HF
"KRN",19,10082,"RPC",1362,0)
ORWPCE IMM
"KRN",19,10082,"RPC",1363,0)
ORWPCE LEX
"KRN",19,10082,"RPC",1364,0)
ORWPCE LEXCODE
"KRN",19,10082,"RPC",1366,0)
ORWPCE NOTEVSTR
"KRN",19,10082,"RPC",1367,0)
ORWPCE PCE4NOTE
"KRN",19,10082,"RPC",1368,0)
ORWPCE PED
"KRN",19,10082,"RPC",1369,0)
ORWPCE PROC
"KRN",19,10082,"RPC",1370,0)
ORWPCE SAVE
"KRN",19,10082,"RPC",1371,0)
ORWPCE SCDIS
"KRN",19,10082,"RPC",1372,0)
ORWPCE SCSEL
"KRN",19,10082,"RPC",1373,0)
ORWPCE SK
"KRN",19,10082,"RPC",1374,0)
ORWPCE TRT
"KRN",19,10082,"RPC",1375,0)
ORWPCE VISIT
"KRN",19,10082,"RPC",1376,0)
ORWPCE XAM
"KRN",19,10082,"RPC",1377,0)
ORWPS ACTIVE
"KRN",19,10082,"RPC",1378,0)
ORWPS COVER
"KRN",19,10082,"RPC",1379,0)
ORWPS DETAIL
"KRN",19,10082,"RPC",1380,0)
ORWPS1 NEWDLG
"KRN",19,10082,"RPC",1381,0)
ORWPS1 PICKUP
"KRN",19,10082,"RPC",1382,0)
ORWPS1 REFILL
"KRN",19,10082,"RPC",1383,0)
ORWPT ADMITLST
"KRN",19,10082,"RPC",1384,0)
ORWPT APPTLST
"KRN",19,10082,"RPC",1385,0)
ORWPT CLINRNG
"KRN",19,10082,"RPC",1386,0)
ORWPT CWAD
"KRN",19,10082,"RPC",1387,0)
ORWPT DFLTSRC
"KRN",19,10082,"RPC",1388,0)
ORWPT DIEDON
"KRN",19,10082,"RPC",1389,0)
ORWPT DISCHARGE
"KRN",19,10082,"RPC",1390,0)
ORWPT ENCTITL
"KRN",19,10082,"RPC",1391,0)
ORWPT FULLSSN
"KRN",19,10082,"RPC",1392,0)
ORWPT ID INFO
"KRN",19,10082,"RPC",1393,0)
ORWPT LAST5
"KRN",19,10082,"RPC",1394,0)
ORWPT LIST ALL
"KRN",19,10082,"RPC",1395,0)
ORWPT PTINQ
"KRN",19,10082,"RPC",1396,0)
ORWPT SAVDFLT
"KRN",19,10082,"RPC",1397,0)
ORWPT SELCHK
"KRN",19,10082,"RPC",1398,0)
ORWPT SELECT
"KRN",19,10082,"RPC",1399,0)
ORWPT SHARE
"KRN",19,10082,"RPC",1400,0)
ORWPT TOP
"KRN",19,10082,"RPC",1401,0)
ORWPT1 PCDETAIL
"KRN",19,10082,"RPC",1402,0)
ORWPT1 PRCARE
"KRN",19,10082,"RPC",1403,0)
ORWPT16 ADMITLST
"KRN",19,10082,"RPC",1404,0)
ORWPT16 APPTLST
"KRN",19,10082,"RPC",1405,0)
ORWPT16 DEMOG
"KRN",19,10082,"RPC",1406,0)
ORWPT16 GETVSIT
"KRN",19,10082,"RPC",1407,0)
ORWPT16 ID INFO
"KRN",19,10082,"RPC",1408,0)
ORWPT16 LIST ALL
"KRN",19,10082,"RPC",1409,0)
ORWPT16 LOOKUP
"KRN",19,10082,"RPC",1410,0)
ORWPT16 PSCNVT
"KRN",19,10082,"RPC",1411,0)
ORWRA DEFAULT EXAM SETTINGS
"KRN",19,10082,"RPC",1412,0)
ORWRA IMAGING EXAMS
"KRN",19,10082,"RPC",1413,0)
ORWRA PRINT REPORT
"KRN",19,10082,"RPC",1414,0)
ORWRA REPORT TEXT
"KRN",19,10082,"RPC",1415,0)
ORWRP PRINT LAB REPORTS
"KRN",19,10082,"RPC",1416,0)
ORWRP PRINT REPORT
"KRN",19,10082,"RPC",1417,0)
ORWRP REPORT LISTS
"KRN",19,10082,"RPC",1418,0)
ORWRP REPORT TEXT
"KRN",19,10082,"RPC",1419,0)
ORWRP1 LISTNUTR
"KRN",19,10082,"RPC",1420,0)
ORWRP16 REPORT LISTS
"KRN",19,10082,"RPC",1421,0)
ORWRP16 REPORT TEXT
"KRN",19,10082,"RPC",1422,0)
ORWTIU GET DCSUMM CONTEXT
"KRN",19,10082,"RPC",1423,0)
ORWTIU GET TIU CONTEXT
"KRN",19,10082,"RPC",1424,0)
ORWTIU SAVE DCSUMM CONTEXT
"KRN",19,10082,"RPC",1425,0)
ORWTIU SAVE TIU CONTEXT
"KRN",19,10082,"RPC",1426,0)
ORWU CLINLOC
"KRN",19,10082,"RPC",1427,0)
ORWU DEVICE
"KRN",19,10082,"RPC",1428,0)
ORWU DT
"KRN",19,10082,"RPC",1429,0)
ORWU EXTNAME
"KRN",19,10082,"RPC",1430,0)
ORWU GBLREF
"KRN",19,10082,"RPC",1431,0)
ORWU GENERIC
"KRN",19,10082,"RPC",1432,0)
ORWU HASKEY
"KRN",19,10082,"RPC",1433,0)
ORWU HOSPLOC
"KRN",19,10082,"RPC",1434,0)
ORWU INPLOC
"KRN",19,10082,"RPC",1435,0)
ORWU NEWPERS
"KRN",19,10082,"RPC",1436,0)
ORWU NPHASKEY
"KRN",19,10082,"RPC",1437,0)
ORWU PATCH
"KRN",19,10082,"RPC",1438,0)
ORWU TOOLMENU
"KRN",19,10082,"RPC",1439,0)
ORWU USERINFO
"KRN",19,10082,"RPC",1440,0)
ORWU VALDT
"KRN",19,10082,"RPC",1441,0)
ORWU VALIDSIG
"KRN",19,10082,"RPC",1442,0)
ORWU VERSRV
"KRN",19,10082,"RPC",1443,0)
ORWU16 DEVICE
"KRN",19,10082,"RPC",1444,0)
ORWU16 HOSPLOC
"KRN",19,10082,"RPC",1445,0)
ORWU16 NEWPERS
"KRN",19,10082,"RPC",1446,0)
ORWU16 USERINFO
"KRN",19,10082,"RPC",1447,0)
ORWU16 VALDT
"KRN",19,10082,"RPC",1448,0)
ORWU16 VALIDSIG
"KRN",19,10082,"RPC",1449,0)
ORWUH POPUP
"KRN",19,10082,"RPC",1450,0)
ORWUX SYMTAB
"KRN",19,10082,"RPC",1451,0)
ORWUXT LST
"KRN",19,10082,"RPC",1452,0)
ORWUXT REF
"KRN",19,10082,"RPC",1453,0)
ORWUXT VAL
"KRN",19,10082,"RPC",1454,0)
ORQQCN DEFAULT REQUEST REASON
"KRN",19,10082,"RPC",1455,0)
ORWDX LOCK ORDER
"KRN",19,10082,"RPC",1456,0)
ORWDX UNLOCK ORDER
"KRN",19,10082,"RPC",1457,0)
ORWDCN32 NEWDLG
"KRN",19,10082,"RPC",1458,0)
ORQQCN GET SERVICE IEN
"KRN",19,10082,"RPC",1459,0)
ORQQCN PROVDX
"KRN",19,10082,"RPC",1460,0)
TIU TEMPLATE ACCESS LEVEL
"KRN",19,10082,"RPC",1461,0)
TIU GET DOCUMENT TITLE
"KRN",19,10082,"RPC",1462,0)
ORWPT BYWARD
"KRN",19,10082,"RPC",1463,0)
ORQQPX GET HIST LOCATIONS
"KRN",19,10082,"RPC",1464,0)
ORQQPX NEW REMINDERS ACTIVE
"KRN",19,10082,"RPC",1465,0)
ORWPCE GET VISIT
"KRN",19,10082,"RPC",1480,0)
TIU GET REQUEST
"KRN",19,10082,"RPC",1481,0)
ORWORB KILL EXPIR MED ALERT
"KRN",19,10082,"RPC",1482,0)
DG CHK BS5 XREF ARRAY
"KRN",19,10082,"RPC",1483,0)
DG CHK BS5 XREF Y/N
"KRN",19,10082,"RPC",1484,0)
DG CHK PAT/DIV MEANS TEST
"KRN",19,10082,"RPC",1485,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,10082,"RPC",1486,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,10082,"RPC",1487,0)
ORQQCN CANEDIT
"KRN",19,10082,"RPC",1488,0)
ORQQCN EDIT DEFAULT REASON
"KRN",19,10082,"RPC",1489,0)
ORQQCN SF513 WINDOWS PRINT
"KRN",19,10082,"RPC",1490,0)
ORWCIRN FACLIST
"KRN",19,10082,"RPC",1491,0)
ORWDLR32 GET LAB TIMES
"KRN",19,10082,"RPC",1492,0)
ORWPT LEGACY
"KRN",19,10082,"RPC",1493,0)
ORWRP GET DEFAULT PRINTER
"KRN",19,10082,"RPC",1494,0)
ORWRP PRINT WINDOWS REPORT
"KRN",19,10082,"RPC",1495,0)
ORWRP SAVE DEFAULT PRINTER
"KRN",19,10082,"RPC",1496,0)
ORWRP WINPRINT DEFAULT
"KRN",19,10082,"RPC",1497,0)
ORWRP WINPRINT LAB REPORTS
"KRN",19,10082,"RPC",1498,0)
ORWTIU WINPRINT NOTE
"KRN",19,10082,"RPC",1500,0)
ORWPCE GAFOK
"KRN",19,10082,"RPC",1501,0)
ORWPCE MHCLINIC
"KRN",19,10082,"RPC",1502,0)
ORWPCE LOADGAF
"KRN",19,10082,"RPC",1503,0)
ORWPCE SAVEGAF
"KRN",19,10082,"RPC",1504,0)
ORWPCE FORCE
"KRN",19,10082,"RPC",1505,0)
TIU GET DEFAULT PROVIDER
"KRN",19,10082,"RPC",1506,0)
TIU GET SITE PARAMETERS
"KRN",19,10082,"RPC",1507,0)
TIU IS USER A PROVIDER?
"KRN",19,10082,"RPC",1508,0)
ORWOR VWGET
"KRN",19,10082,"RPC",1509,0)
ORWOR VWSET
"KRN",19,10082,"RPC",1510,0)
ORWU PARAM
"KRN",19,10082,"RPC",1511,0)
ORWDOR LKSCRN
"KRN",19,10082,"RPC",1512,0)
ORWDOR VALNUM
"KRN",19,10082,"RPC",1513,0)
ORWDPS32 VALROUTE
"KRN",19,10082,"RPC",1515,0)
ORWORB UNSIG ORDERS FOLLOWUP
"KRN",19,10082,"RPC",1516,0)
ORWTIU GET LISTBOX ITEM
"KRN",19,10082,"RPC",1517,0)
ORWRP2 HS COMP FILES
"KRN",19,10082,"RPC",1518,0)
ORWRP2 HS COMPONENTS
"KRN",19,10082,"RPC",1519,0)
ORWRP2 HS FILE LOOKUP
"KRN",19,10082,"RPC",1520,0)
ORWRP2 HS REPORT TEXT
"KRN",19,10082,"RPC",1521,0)
ORWRP2 HS SUBITEMS
"KRN",19,10082,"RPC",1522,0)
ORWPCE HASCPT
"KRN",19,10082,"RPC",1523,0)
ORWPCE ASKPCE
"KRN",19,10082,"RPC",1524,0)
ORWPCE MHTESTOK
"KRN",19,10082,"RPC",1525,0)
ORWPCE GAFURL
"KRN",19,10082,"RPC",1526,0)
ORQQPXRM DIALOG PROMPTS
"KRN",19,10082,"RPC",1527,0)
ORQQPXRM EDUCATION SUBTOPICS
"KRN",19,10082,"RPC",1528,0)
ORQQPXRM EDUCATION SUMMARY
"KRN",19,10082,"RPC",1529,0)
ORQQPXRM EDUCATION TOPIC
"KRN",19,10082,"RPC",1530,0)
ORQQPXRM MENTAL HEALTH
"KRN",19,10082,"RPC",1531,0)
ORQQPXRM MENTAL HEALTH RESULTS
"KRN",19,10082,"RPC",1532,0)
ORQQPXRM MENTAL HEALTH SAVE
"KRN",19,10082,"RPC",1533,0)
ORQQPXRM PROGRESS NOTE HEADER
"KRN",19,10082,"RPC",1534,0)
ORQQPXRM REMINDER CATEGORIES
"KRN",19,10082,"RPC",1535,0)
ORQQPXRM REMINDER DETAIL
"KRN",19,10082,"RPC",1536,0)
ORQQPXRM REMINDER DIALOG
"KRN",19,10082,"RPC",1537,0)
ORQQPXRM REMINDER EVALUATION
"KRN",19,10082,"RPC",1538,0)
ORQQPXRM REMINDER INQUIRY
"KRN",19,10082,"RPC",1539,0)
ORQQPXRM REMINDER WEB
"KRN",19,10082,"RPC",1540,0)
ORQQPXRM REMINDERS APPLICABLE
"KRN",19,10082,"RPC",1541,0)
ORQQPXRM REMINDERS UNEVALUATED
"KRN",19,10082,"RPC",1542,0)
ORWLRR INFO
"KRN",19,10082,"RPC",1543,0)
TIU GET PRINT NAME
"KRN",19,10082,"RPC",1544,0)
TIU WAS THIS SAVED?
"KRN",19,10082,"RPC",1545,0)
ORWD1 COMLOC
"KRN",19,10082,"RPC",1546,0)
ORWD1 SIG4ANY
"KRN",19,10082,"RPC",1547,0)
ORWD1 SIG4ONE
"KRN",19,10082,"RPC",1548,0)
ORWOR UNSIGN
"KRN",19,10082,"RPC",1549,0)
ORWPT INPLOC
"KRN",19,10082,"RPC",1553,0)
ORQQCN2 GET PREREQUISITE
"KRN",19,10082,"RPC",1554,0)
ORQQCN2 SCHEDULE CONSULT
"KRN",19,10082,"RPC",1555,0)
YS GAF API
"KRN",19,10082,"RPC",1556,0)
TIU LONG LIST BOILERPLATED
"KRN",19,10082,"RPC",1557,0)
ORWDLR33 FUTURE LAB COLLECTS
"KRN",19,10082,"RPC",1558,0)
ORWRP PRINT REMOTE REPORT
"KRN",19,10082,"RPC",1559,0)
ORWRP PRINT WINDOWS REMOTE
"KRN",19,10082,"RPC",1560,0)
ORWRP PRINT LAB REMOTE
"KRN",19,10082,"RPC",1561,0)
ORWRP PRINT WINDOWS LAB REMOTE
"KRN",19,10082,"RPC",1562,0)
ORQQPXRM DIALOG ACTIVE
"KRN",19,10082,"RPC",1563,0)
ORWPCE MH TEST AUTHORIZED
"KRN",19,10082,"RPC",1564,0)
TIU GET BOILERPLATE
"KRN",19,10082,"RPC",1565,0)
ORWRP2 HS COMPONENT SUBS
"KRN",19,10082,"RPC",1566,0)
ORWCH SAVFONT
"KRN",19,10082,"RPC",1567,0)
ORWDLR33 LASTTIME
"KRN",19,10082,"RPC",1568,0)
ORWD1 SVONLY
"KRN",19,10082,"RPC",1569,0)
ORWPCE HASVISIT
"KRN",19,10082,"RPC",1570,0)
ORWPCE GETMOD
"KRN",19,10082,"RPC",1571,0)
ORWPCE CPTMODS
"KRN",19,10082,"RPC",1572,0)
XWB REMOTE CLEAR
"KRN",19,10082,"RPC",1573,0)
XWB REMOTE GETDATA
"KRN",19,10082,"RPC",1574,0)
XWB REMOTE RPC
"KRN",19,10082,"RPC",1575,0)
XWB REMOTE STATUS CHECK
"KRN",19,10082,"RPC",1576,0)
ORQQCN ASSIGNABLE MED RESULTS
"KRN",19,10082,"RPC",1577,0)
ORQQCN ATTACH MED RESULTS
"KRN",19,10082,"RPC",1578,0)
ORQQCN GET MED RESULT DETAILS
"KRN",19,10082,"RPC",1579,0)
ORQQCN REMOVABLE MED RESULTS
"KRN",19,10082,"RPC",1580,0)
ORQQCN REMOVE MED RESULTS
"KRN",19,10082,"RPC",1581,0)
ORQQCN SVC W/SYNONYMS
"KRN",19,10082,"RPC",1582,0)
ORWCV1 COVERSHEET LIST
"KRN",19,10082,"RPC",1583,0)
ORWORB KILL EXPIR OI ALERT
"KRN",19,10082,"RPC",1584,0)
ORWPCE GETSVC
"KRN",19,10082,"RPC",1585,0)
ORWRP LAB REPORT LISTS
"KRN",19,10082,"RPC",1587,0)
ORWTPN GETCLASS
"KRN",19,10082,"RPC",1588,0)
ORWTPN GETTC
"KRN",19,10082,"RPC",1589,0)
ORWTPO CSARNGD
"KRN",19,10082,"RPC",1590,0)
ORWTPO CSLABD
"KRN",19,10082,"RPC",1591,0)
ORWTPO GETTABS
"KRN",19,10082,"RPC",1592,0)
ORWTPP ADDLIST
"KRN",19,10082,"RPC",1593,0)
ORWTPP CHKSURR
"KRN",19,10082,"RPC",1594,0)
ORWTPP CLDAYS
"KRN",19,10082,"RPC",1595,0)
ORWTPP CLEARNOT
"KRN",19,10082,"RPC",1596,0)
ORWTPP CLRANGE
"KRN",19,10082,"RPC",1597,0)
ORWTPP CSARNG
"KRN",19,10082,"RPC",1598,0)
ORWTPP CSLAB
"KRN",19,10082,"RPC",1599,0)
ORWTPP DELLIST
"KRN",19,10082,"RPC",1600,0)
ORWTPP GETCOMBO
"KRN",19,10082,"RPC",1601,0)
ORWTPP GETCOS
"KRN",19,10082,"RPC",1602,0)
ORWTPP GETDCOS
"KRN",19,10082,"RPC",1603,0)
ORWTPP GETNOT
"KRN",19,10082,"RPC",1604,0)
ORWTPP GETNOTO
"KRN",19,10082,"RPC",1605,0)
ORWTPP GETOC
"KRN",19,10082,"RPC",1606,0)
ORWTPP GETOTHER
"KRN",19,10082,"RPC",1607,0)
ORWTPP GETREM
"KRN",19,10082,"RPC",1608,0)
ORWTPP GETSUB
"KRN",19,10082,"RPC",1609,0)
ORWTPP GETSURR
"KRN",19,10082,"RPC",1610,0)
ORWTPP GETTD
"KRN",19,10082,"RPC",1611,0)
ORWTPP GETTU
"KRN",19,10082,"RPC",1612,0)
ORWTPP LSDEF
"KRN",19,10082,"RPC",1613,0)
ORWTPP NEWLIST
"KRN",19,10082,"RPC",1614,0)
ORWTPP PLISTS
"KRN",19,10082,"RPC",1615,0)
ORWTPP PLTEAMS
"KRN",19,10082,"RPC",1616,0)
ORWTPP REMLIST
"KRN",19,10082,"RPC",1617,0)
ORWTPP SAVECD
"KRN",19,10082,"RPC",1618,0)
ORWTPP SAVECS
"KRN",19,10082,"RPC",1619,0)
ORWTPP SAVELIST
"KRN",19,10082,"RPC",1620,0)
ORWTPP SAVENOT
"KRN",19,10082,"RPC",1621,0)
ORWTPP SAVENOTO
"KRN",19,10082,"RPC",1622,0)
ORWTPP SAVEOC
"KRN",19,10082,"RPC",1623,0)
ORWTPP SAVEPLD
"KRN",19,10082,"RPC",1624,0)
ORWTPP SAVESURR
"KRN",19,10082,"RPC",1625,0)
ORWTPP SAVET
"KRN",19,10082,"RPC",1626,0)
ORWTPP SETCOMBO
"KRN",19,10082,"RPC",1627,0)
ORWTPP SETDCOS
"KRN",19,10082,"RPC",1628,0)
ORWTPP SETOTHER
"KRN",19,10082,"RPC",1629,0)
ORWTPP SETREM
"KRN",19,10082,"RPC",1630,0)
ORWTPP SETSUB
"KRN",19,10082,"RPC",1631,0)
ORWTPP SORTDEF
"KRN",19,10082,"RPC",1632,0)
ORWTPP TEAMS
"KRN",19,10082,"RPC",1633,0)
ORWTPT ATEAMS
"KRN",19,10082,"RPC",1634,0)
ORWTPT GETTEAM
"KRN",19,10082,"RPC",1635,0)
TIU TEMPLATE GET DEFAULTS
"KRN",19,10082,"RPC",1636,0)
TIU TEMPLATE GET DESCRIPTION
"KRN",19,10082,"RPC",1637,0)
TIU TEMPLATE SET DEFAULTS
"KRN",19,10082,"RPC",1638,0)
ORWTIU IDNOTES INSTALLED
"KRN",19,10082,"RPC",1639,0)
ORQQPX GET FOLDERS
"KRN",19,10082,"RPC",1640,0)
ORQQPX SET FOLDERS
"KRN",19,10082,"RPC",1641,0)
TIU FIELD CAN EDIT
"KRN",19,10082,"RPC",1642,0)
TIU FIELD DELETE
"KRN",19,10082,"RPC",1643,0)
TIU FIELD EXPORT
"KRN",19,10082,"RPC",1644,0)
TIU FIELD IMPORT
"KRN",19,10082,"RPC",1645,0)
TIU FIELD LIST
"KRN",19,10082,"RPC",1646,0)
TIU FIELD LOAD
"KRN",19,10082,"RPC",1647,0)
TIU FIELD LOAD BY IEN
"KRN",19,10082,"RPC",1648,0)
TIU FIELD LOCK
"KRN",19,10082,"RPC",1649,0)
TIU FIELD NAME IS UNIQUE
"KRN",19,10082,"RPC",1650,0)
TIU FIELD SAVE
"KRN",19,10082,"RPC",1651,0)
TIU FIELD UNLOCK
"KRN",19,10082,"RPC",1652,0)
ORWDPS1 CHK94
"KRN",19,10082,"RPC",1653,0)
ORWDPS1 ODSLCT
"KRN",19,10082,"RPC",1654,0)
ORWDPS1 SCHALL
"KRN",19,10082,"RPC",1655,0)
ORWDPS2 ADMIN
"KRN",19,10082,"RPC",1656,0)
ORWDPS2 DAY2QTY
"KRN",19,10082,"RPC",1657,0)
ORWDPS2 OISLCT
"KRN",19,10082,"RPC",1658,0)
ORWDPS2 REQST
"KRN",19,10082,"RPC",1659,0)
ORWDX DGNM
"KRN",19,10082,"RPC",1660,0)
ORWUL FV4DG
"KRN",19,10082,"RPC",1661,0)
ORWUL FVIDX
"KRN",19,10082,"RPC",1662,0)
ORWUL FVSUB
"KRN",19,10082,"RPC",1663,0)
ORWUL QV4DG
"KRN",19,10082,"RPC",1664,0)
ORWUL QVIDX
"KRN",19,10082,"RPC",1665,0)
ORWUL QVSUB
"KRN",19,10082,"RPC",1666,0)
ORWDPS1 DFLTSPLY
"KRN",19,10082,"RPC",1668,0)
PXRM REMINDER DIALOG (TIU)
"KRN",19,10082,"RPC",1669,0)
ORWPCE ANYTIME
"KRN",19,10082,"RPC",1670,0)
ORQQPX GET DEF LOCATIONS
"KRN",19,10082,"RPC",1671,0)
ORWTPP GETIMG
"KRN",19,10082,"RPC",1672,0)
ORWTPP SETIMG
"KRN",19,10082,"RPC",1673,0)
ORWTPO GETIMGD
"KRN",19,10082,"RPC",1674,0)
ORQQPX REM INSERT AT CURSOR
"KRN",19,10082,"RPC",1675,0)
TIU REMINDER DIALOGS
"KRN",19,10082,"RPC",1676,0)
TIU REM DLG OK AS TEMPLATE
"KRN",19,10082,"RPC",1677,0)
ORWDPS2 MAXREF
"KRN",19,10082,"RPC",1678,0)
ORWDPS2 SCHREQ
"KRN",19,10082,"RPC",1679,0)
ORWRP COLUMN HEADERS
"KRN",19,10082,"RPC",1680,0)
TIU FIELD DOLMTEXT
"KRN",19,10082,"RPC",1681,0)
TIU TEMPLATE PERSONAL OBJECTS
"KRN",19,10082,"RPC",1682,0)
ORWPCE AUTO VISIT TYPE SELECT
"KRN",19,10082,"RPC",1683,0)
ORWDPS2 QTY2DAY
"KRN",19,10082,"RPC",1684,0)
ORWU HAS OPTION ACCESS
"KRN",19,10082,"RPC",1685,0)
TIU TEMPLATE LOCK
"KRN",19,10082,"RPC",1686,0)
ORQQPX LVREMLST
"KRN",19,10082,"RPC",1687,0)
ORQQPX NEW COVER SHEET ACTIVE
"KRN",19,10082,"RPC",1688,0)
ORQQPX NEW COVER SHEET REMS
"KRN",19,10082,"RPC",1689,0)
ORQQPX SAVELVL
"KRN",19,10082,"RPC",1690,0)
PXRM REMINDER CATEGORY
"KRN",19,10082,"RPC",1691,0)
PXRM REMINDERS AND CATEGORIES
"KRN",19,10082,"RPC",1692,0)
TIU DIV AND CLASS INFO
"KRN",19,10082,"RPC",1693,0)
TIU TEMPLATE GETBOIL
"KRN",19,10082,"RPC",1694,0)
TIU TEMPLATE GETITEMS
"KRN",19,10082,"RPC",1695,0)
TIU TEMPLATE GETROOTS
"KRN",19,10082,"RPC",1696,0)
TIU TEMPLATE GETTEXT
"KRN",19,10082,"RPC",1697,0)
TIU TEMPLATE ISEDITOR
"KRN",19,10082,"RPC",1698,0)
TIU TEMPLATE UNLOCK
"KRN",19,10082,"RPC",1699,0)
TIU USER CLASS LONG LIST
"KRN",19,10082,"RPC",1700,0)
ORWPCE ALWAYS CHECKOUT
"KRN",19,10082,"RPC",1701,0)
ORWPCE GET EXCLUDED
"KRN",19,10082,"RPC",1702,0)
ORWDPS1 FORMALT
"KRN",19,10082,"RPC",1703,0)
ORQPT DEFAULT LIST SORT
"KRN",19,10082,"RPC",1704,0)
ORWDPS1 DOSEALT
"KRN",19,10082,"RPC",1705,0)
ORWTPR OCDESC
"KRN",19,10082,"RPC",1706,0)
ORWTPR NOTDESC
"KRN",19,10082,"RPC",1707,0)
ORWDPS1 FAILDEA
"KRN",19,10082,"RPC",1708,0)
ORQPT DEFAULT CLINIC DATE RANG
"KRN",19,10082,"RPC",1709,0)
ORWTIU CANLINK
"KRN",19,10082,"RPC",1710,0)
TIU ID ATTACH ENTRY
"KRN",19,10082,"RPC",1711,0)
TIU ID CAN ATTACH
"KRN",19,10082,"RPC",1712,0)
TIU ID CAN RECEIVE
"KRN",19,10082,"RPC",1713,0)
TIU ID DETACH ENTRY
"KRN",19,10082,"RPC",1714,0)
ORWCOM GETOBJS
"KRN",19,10082,"RPC",1715,0)
ORWCOM DETAILS
"KRN",19,10082,"RPC",1716,0)
ORWCOM PTOBJ
"KRN",19,10082,"RPC",1718,0)
TIU TEMPLATE GETLINK
"KRN",19,10082,"RPC",1719,0)
TIU TEMPLATE ALL TITLES
"KRN",19,10082,"RPC",1720,0)
ORWSR LIST
"KRN",19,10082,"RPC",1721,0)
ORWSR SHOW SURG TAB
"KRN",19,10082,"RPC",1722,0)
ORWSR GET SURG CONTEXT
"KRN",19,10082,"RPC",1723,0)
ORWSR SAVE SURG CONTEXT
"KRN",19,10082,"RPC",1724,0)
ORWSR ONECASE
"KRN",19,10082,"RPC",1727,0)
ORWSR SHOW OPTOP WHEN SIGNING
"KRN",19,10082,"RPC",1728,0)
ORWSR IS NON-OR PROCEDURE
"KRN",19,10082,"RPC",1729,0)
ORWSR CASELIST
"KRN",19,10082,"RPC",1730,0)
ORQQCN GET PROC IEN
"KRN",19,10082,"RPC",1731,0)
ORWRP PRINT V REPORT
"KRN",19,10082,"RPC",1732,0)
ORWRP3 EXPAND COLUMNS
"KRN",19,10082,"RPC",1733,0)
ORWTPD ACTDF
"KRN",19,10082,"RPC",1734,0)
ORWTPD DELDFLT
"KRN",19,10082,"RPC",1735,0)
ORWTPD GETDFLT
"KRN",19,10082,"RPC",1736,0)
ORWTPD RSDFLT
"KRN",19,10082,"RPC",1737,0)
ORWTPD SUDF
"KRN",19,10082,"RPC",1738,0)
ORWTPD SUINDV
"KRN",19,10082,"RPC",1739,0)
ORWTPD GETSETS
"KRN",19,10082,"RPC",1740,0)
ORWCOM ORDEROBJ
"KRN",19,10082,"RPC",1741,0)
ORWRP2 COMPABV
"KRN",19,10082,"RPC",1742,0)
ORWRP2 GETLKUP
"KRN",19,10082,"RPC",1743,0)
ORWRP2 SAVLKUP
"KRN",19,10082,"RPC",1744,0)
ORWRP2 COMPDISP
"KRN",19,10082,"RPC",1745,0)
ORWPCE ISCLINIC
"KRN",19,10082,"RPC",1746,0)
ORWCH SAVECOL
"KRN",19,10082,"RPC",1747,0)
ORWSR RPTLIST
"KRN",19,10082,"RPC",1748,0)
ORQQPXRM MST UPDATE
"KRN",19,10082,"RPC",1749,0)
ORWMC PATIENT PROCEDURES1
"KRN",19,10082,"RPC",1750,0)
ORWRA IMAGING EXAMS1
"KRN",19,10082,"RPC",1751,0)
ORWRA REPORT TEXT1
"KRN",19,10082,"RPC",1752,0)
ORWDPS4 CPINFO
"KRN",19,10082,"RPC",1753,0)
ORWDPS4 CPLST
"KRN",19,10082,"RPC",1754,0)
ORWORB KILL UNVER MEDS ALERT
"KRN",19,10082,"RPC",1755,0)
ORWORB KILL UNVER ORDERS ALERT
"KRN",19,10082,"RPC",1756,0)
ORWPCE HNCOK
"KRN",19,10082,"RPC",1757,0)
ORWPS MEDHIST
"KRN",19,10082,"RPC",1758,0)
TIU FIELD CHECK
"KRN",19,10082,"RPC",1759,0)
TIU FIELD LIST ADD
"KRN",19,10082,"RPC",1760,0)
TIU FIELD LIST IMPORT
"KRN",19,10082,"RPC",1761,0)
TIU SET DOCUMENT TEXT
"KRN",19,10082,"RPC",1762,0)
ORWDPS2 CHKPI
"KRN",19,10082,"RPC",1763,0)
ORWDXR GTORITM
"KRN",19,10082,"RPC",1764,0)
ORWDPS2 CHKGRP
"KRN",19,10082,"RPC",1765,0)
ORWDPS2 QOGRP
"KRN",19,10082,"RPC",1766,0)
ORWDXR GETPKG
"KRN",19,10082,"RPC",1767,0)
ORQPT MAKE RPL
"KRN",19,10082,"RPC",1768,0)
ORQPT READ RPL
"KRN",19,10082,"RPC",1769,0)
ORQPT KILL RPL
"KRN",19,10082,"RPC",1770,0)
ORWTIU GET SAVED CP FIELDS
"KRN",19,10082,"RPC",1771,0)
ORWDPS1 LOCPICK
"KRN",19,10082,"RPC",1772,0)
ORWPT LAST5 RPL
"KRN",19,10082,"RPC",1773,0)
ORWPT FULLSSN RPL
"KRN",19,10082,"RPC",1774,0)
ORWOR PKIUSE
"KRN",19,10082,"RPC",1775,0)
ORWOR1 SIG
"KRN",19,10082,"RPC",1776,0)
ORWOR1 CHKDIG
"KRN",19,10082,"RPC",1777,0)
ORWOR1 GETDTEXT
"KRN",19,10082,"RPC",1778,0)
ORWOR1 GETDSIG
"KRN",19,10082,"RPC",1779,0)
ORWTPD GETIMG
"KRN",19,10082,"RPC",1780,0)
OREVNTX1 PRMPTID
"KRN",19,10082,"RPC",1781,0)
ORECS01 CHKESSO
"KRN",19,10082,"RPC",1782,0)
ORECS01 VSITID
"KRN",19,10082,"RPC",1784,0)
OREVNTX LIST
"KRN",19,10082,"RPC",1785,0)
OREVNTX PAT
"KRN",19,10082,"RPC",1786,0)
OREVNTX1 GTEVT
"KRN",19,10082,"RPC",1787,0)
OREVNTX1 CPACT
"KRN",19,10082,"RPC",1788,0)
OREVNTX1 CURSPE
"KRN",19,10082,"RPC",1789,0)
OREVNTX1 CHGEVT
"KRN",19,10082,"RPC",1790,0)
OREVNTX1 DELPTEVT
"KRN",19,10082,"RPC",1791,0)
OREVNTX1 DFLTEVT
"KRN",19,10082,"RPC",1792,0)
OREVNTX ACTIVE
"KRN",19,10082,"RPC",1793,0)
OREVNTX1 PUTEVNT
"KRN",19,10082,"RPC",1794,0)
OREVNTX1 WRLSTED
"KRN",19,10082,"RPC",1795,0)
OREVNTX1 EVT
"KRN",19,10082,"RPC",1796,0)
OREVNTX1 NAME
"KRN",19,10082,"RPC",1797,0)
OREVNTX1 MATCH
"KRN",19,10082,"RPC",1798,0)
OREVNTX1 EMPTY
"KRN",19,10082,"RPC",1799,0)
OREVNTX1 EXISTS
"KRN",19,10082,"RPC",1800,0)
OREVNTX1 GTEVT1
"KRN",19,10082,"RPC",1801,0)
OREVNTX1 DIV
"KRN",19,10082,"RPC",1802,0)
OREVNTX1 DIV1
"KRN",19,10082,"RPC",1803,0)
OREVNTX1 LOC
"KRN",19,10082,"RPC",1804,0)
OREVNTX1 LOC1
"KRN",19,10082,"RPC",1805,0)
ORWDX SENDED
"KRN",19,10082,"RPC",1806,0)
OREVNTX1 GETDLG
"KRN",19,10082,"RPC",1807,0)
ORECS01 ECPRINT
"KRN",19,10082,"RPC",1811,0)
ORECS01 ECRPT
"KRN",19,10082,"RPC",1812,0)
OREVNTX1 ISDCOD
"KRN",19,10082,"RPC",1813,0)
OREVNTX1 SETDFLT
"KRN",19,10082,"RPC",1815,0)
TIU IS THIS A CLINPROC?
"KRN",19,10082,"RPC",1816,0)
TIU IDENTIFY CLINPROC CLASS
"KRN",19,10082,"RPC",1817,0)
TIU LONG LIST CLINPROC TITLES
"KRN",19,10082,"RPC",1819,0)
ORWDPS1 HASOIPI
"KRN",19,10082,"RPC",1821,0)
OREVNTX1 DEFLTS
"KRN",19,10082,"RPC",1822,0)
OREVNTX1 MULTS
"KRN",19,10082,"RPC",1823,0)
OREVNTX1 DONE
"KRN",19,10082,"RPC",1824,0)
OREVNTX1 PROMPT IDS
"KRN",19,10082,"RPC",1825,0)
ORWCIRN CHECKLINK
"KRN",19,10082,"RPC",1826,0)
XWB DIRECT RPC
"KRN",19,10082,"RPC",1827,0)
ORWDPS1 HASROUTE
"KRN",19,10082,"RPC",1828,0)
ORQQCN UNRESOLVED
"KRN",19,10082,"RPC",1829,0)
OREVNTX1 DELDFLT
"KRN",19,10082,"RPC",1830,0)
ORWCH LDFONT
"KRN",19,10082,"RPC",1831,0)
ORWU1 NAMECVT
"KRN",19,10082,"RPC",1832,0)
OREVNTX1 DFLTDLG
"KRN",19,10082,"RPC",1833,0)
ORWDPS5 LESAPI
"KRN",19,10082,"RPC",1834,0)
ORWDPS5 LESGRP
"KRN",19,10082,"RPC",1839,0)
OREVNTX1 TYPEXT
"KRN",19,10082,"RPC",1840,0)
ORWORR RGET
"KRN",19,10082,"RPC",1841,0)
OREVNTX1 AUTHMREL
"KRN",19,10082,"RPC",1842,0)
OREVNTX1 HAVEPRT
"KRN",19,10082,"RPC",1843,0)
OREVNTX1 CMEVTS
"KRN",19,10082,"RPC",1844,0)
OREVNTX1 ODPTEVID
"KRN",19,10082,"RPC",1845,0)
ORWOR PKISITE
"KRN",19,10082,"RPC",1846,0)
OREVNTX1 COMP
"KRN",19,10082,"RPC",1847,0)
OREVNTX1 ISHDORD
"KRN",19,10082,"RPC",1848,0)
ORWDXR ORCPLX
"KRN",19,10082,"RPC",1849,0)
OREVNTX1 ISPASS
"KRN",19,10082,"RPC",1850,0)
OREVNTX1 ISPASS1
"KRN",19,10082,"RPC",1851,0)
OREVNTX1 DLGIEN
"KRN",19,10082,"RPC",1852,0)
ORWDXR CANRN
"KRN",19,10082,"RPC",1853,0)
ORWDXR ISCPLX
"KRN",19,10082,"RPC",1854,0)
ORWDXA OFCPLX
"KRN",19,10082,"RPC",1855,0)
ORQQPX GET NOT PURPOSE
"KRN",19,10082,"RPC",1856,0)
ORWDPS1 IVDEA
"KRN",19,10082,"RPC",1857,0)
ORWDXR ISNOW
"KRN",19,10082,"RPC",1858,0)
ORRHCQ QRYITR
"KRN",19,10082,"RPC",1859,0)
OREVNTX1 GETSTS
"KRN",19,10082,"RPC",1860,0)
ORWU DEFAULT DIVISION
"KRN",19,10082,"RPC",1861,0)
ORWDXA ISACTOI
"KRN",19,10082,"RPC",1862,0)
ORECS01 SAVPATH
"KRN",19,10082,"RPC",1863,0)
ORWOR RESULT HISTORY
"KRN",19,10082,"RPC",1864,0)
XUS GET TOKEN
"KRN",19,10082,"RPC",1865,0)
ORQQPX IMMUN LIST
"KRN",19,10082,"RPC",1866,0)
XWB DEFERRED CLEARALL
"KRN",19,10082,"RPC",1867,0)
ORWOR1 SETDTEXT
"KRN",19,10082,"RPC",1868,0)
ORWOR1 GETDEA
"KRN",19,10082,"RPC",1869,0)
ORWOR1 GETDSCH
"KRN",19,10082,"RPC",1870,0)
ORWORB TEXT FOLLOWUP
"KRN",19,10082,"RPC",1871,0)
ORWU1 NEWLOC
"KRN",19,10082,"RPC",1872,0)
ORWPCE ACTIVE CODE
"KRN",19,10082,"RPC",1873,0)
ORQQPXRM GET WH LETTER TEXT
"KRN",19,10082,"RPC",1874,0)
ORQQPXRM GET WH LETTER TYPE
"KRN",19,10082,"RPC",1875,0)
ORQQPXRM GET WH PROC RESULT
"KRN",19,10082,"RPC",1876,0)
ORQQPXRM WOMEN HEALTH SAVE
"KRN",19,10082,"RPC",1877,0)
ORB FORWARD ALERT
"KRN",19,10082,"RPC",1878,0)
ORB RENEW ALERT
"KRN",19,10082,"RPC",1879,0)
ORPRF CLEAR
"KRN",19,10082,"RPC",1880,0)
ORPRF GETFLG
"KRN",19,10082,"RPC",1881,0)
ORPRF HASFLG
"KRN",19,10082,"RPC",1882,0)
ORWTPD GETOCM
"KRN",19,10082,"RPC",1883,0)
TIU ONE VISIT NOTE?
"KRN",19,10082,"RPC",1884,0)
VAFCTFU CONVERT ICN TO DFN
"KRN",19,10082,"RPC",1885,0)
ORIMO IMOLOC
"KRN",19,10082,"RPC",1886,0)
ORIMO IMOOD
"KRN",19,10082,"RPC",1887,0)
ORWDPS4 IPOD4OP
"KRN",19,10082,"RPC",1888,0)
ORWDPS4 UPDTDG
"KRN",19,10082,"RPC",1889,0)
TIU USER INACTIVE?
"KRN",19,10082,"RPC",1890,0)
ORWTPD PUTOCM
"KRN",19,10082,"RPC",1891,0)
ORWOR ACTION TEXT
"KRN",19,10082,"RPC",1892,0)
ORQQPXRM GEC DIALOG
"KRN",19,10082,"RPC",1893,0)
ORQQPXRM GET WH REPORT TEXT
"KRN",19,10082,"RPC",1894,0)
ORWDXR01 CANCHG
"KRN",19,10082,"RPC",1895,0)
ORWDXR01 SAVCHG
"KRN",19,10082,"RPC",1896,0)
TIU HAS AUTHOR SIGNED?
"KRN",19,10082,"RPC",1897,0)
ORQQPXRM CHECK REM VERSION
"KRN",19,10082,"RPC",1898,0)
ORQQPXRM GEC STATUS PROMPT
"KRN",19,10082,"RPC",1899,0)
ORQQPXRM GEC STATUS PROMPT
"KRN",19,10082,"RPC",1900,0)
ORWDAL32 SEND BULLETIN
"KRN",19,10082,"RPC",1901,0)
ORWDBA1 ORPKGTYP
"KRN",19,10082,"RPC",1902,0)
ORWDXR01 ISSPLY
"KRN",19,10082,"RPC",1903,0)
ORWDBA1 RCVORCI
"KRN",19,10082,"RPC",1904,0)
ORWPS REASON
"KRN",19,10082,"RPC",1905,0)
ORQQPXRM GEC FINISHED?
"KRN",19,10082,"RPC",1906,0)
ORWDXM3 ISUDQO
"KRN",19,10082,"RPC",1908,0)
ORWDBA1 SCLST
"KRN",19,10082,"RPC",1909,0)
ORWDXR01 OXDATA
"KRN",19,10082,"RPC",1914,0)
ORWDBA1 BASTATUS
"KRN",19,10082,"RPC",1920,0)
ORWORB SETSORT
"KRN",19,10082,"RPC",1921,0)
ORWORB GETSORT
"KRN",19,10082,"RPC",1922,0)
ORWOR EXPIRED
"KRN",19,10082,"RPC",1923,0)
ORPRF HASCAT1
"KRN",19,10082,"RPC",1928,0)
ORECS01 GETDIV
"KRN",19,10082,"RPC",1933,0)
ORWTPD1 GETEFDAT
"KRN",19,10082,"RPC",1934,0)
ORWTPD1 GETEDATS
"KRN",19,10082,"RPC",1935,0)
ORWTPD1 PUTEDATS
"KRN",19,10082,"RPC",1936,0)
ORWTPD1 GETCSDEF
"KRN",19,10082,"RPC",1937,0)
ORWTPD1 GETCSRNG
"KRN",19,10082,"RPC",1938,0)
ORWTPD1 PUTCSRNG
"KRN",19,10082,"RPC",1939,0)
ORWTPD1 GETEAFL
"KRN",19,10082,"RPC",1940,0)
ORWDBA1 GETORDX
"KRN",19,10082,"RPC",1941,0)
ORWDBA3 HINTS
"KRN",19,10082,"RPC",1942,0)
ORWDAL32 LOAD FOR EDIT
"KRN",19,10082,"RPC",1943,0)
ORWDAL32 SAVE ALLERGY
"KRN",19,10082,"RPC",1944,0)
ORWDAL32 SITE PARAMS
"KRN",19,10082,"RPC",1945,0)
ORWPCE CXNOSHOW
"KRN",19,10082,"RPC",1946,0)
ORWDBA2 ADDPDL
"KRN",19,10082,"RPC",1947,0)
ORWDBA2 DELPDL
"KRN",19,10082,"RPC",1948,0)
ORWDBA2 GETDUDC
"KRN",19,10082,"RPC",1949,0)
ORWDBA2 GETPDL
"KRN",19,10082,"RPC",1950,0)
ORWDBA4 GETBAUSR
"KRN",19,10082,"RPC",1951,0)
ORWDBA4 GETTFCI
"KRN",19,10082,"RPC",1952,0)
ORWNSS NSSMSG
"KRN",19,10082,"RPC",1953,0)
ORWNSS QOSCH
"KRN",19,10082,"RPC",1954,0)
ORWNSS VALSCH
"KRN",19,10082,"RPC",1955,0)
ORWNSS CHKSCH
"KRN",19,10082,"RPC",1956,0)
ORWDPS4 ISUDIV
"KRN",19,10082,"RPC",1957,0)
ORWDPS32 AUTHNVA
"KRN",19,10082,"RPC",1962,0)
ORWTIU CHKTXT
"KRN",19,10082,"RPC",1964,0)
ORWDPS5 ISVTP
"KRN",19,10082,"RPC",1965,0)
TIU IS THIS A SURGERY?
"KRN",19,10082,"RPC",1966,0)
TIU IDENTIFY SURGERY CLASS
"KRN",19,10082,"RPC",1967,0)
TIU LONG LIST SURGERY TITLES
"KRN",19,10082,"RPC",1968,0)
TIU GET DOCUMENTS FOR REQUEST
"KRN",19,10082,"RPC",1969,0)
TIU SET ADMINISTRATIVE CLOSURE
"KRN",19,10082,"RPC",1970,0)
ORBCMA5 GETUDID
"KRN",19,10082,"RPC",1973,0)
ORIMO ISCLOC
"KRN",19,10082,"RPC",1974,0)
ORIMO ISIVQO
"KRN",19,10082,"RPC",1975,0)
ORWDBA7 GETIEN9
"KRN",19,10082,"RPC",1976,0)
ORWGN GNLOC
"KRN",19,10082,"RPC",1977,0)
ORWGN AUTHUSR
"KRN",19,10082,"U")
CPRSCHART VERSION 1.0.25.28
"KRN",19,11699,-1)
0^1
"KRN",19,11699,0)
OR BDC MENU^Clinical Indicator Data Capture Configuration^^M^^^^^^^^ORDER ENTRY/RESULTS REPORTING
"KRN",19,11699,1,0)
^^6^6^3040316^
"KRN",19,11699,1,1,0)
This is the menu to start the Clinical Indicator Data Capture
"KRN",19,11699,1,2,0)
Configuration options. The first option will start the program to set the
"KRN",19,11699,1,3,0)
CIDC Master Switch.  This will turn the clinical indicator data capture on
"KRN",19,11699,1,4,0)
or off for the entire facility. The second option will start the program
"KRN",19,11699,1,5,0)
to allow for the  turning on and off of the clinical indicator data
"KRN",19,11699,1,6,0)
capture by individual providers.
"KRN",19,11699,10,0)
^19.01IP^2^2
"KRN",19,11699,10,1,0)
11700^MS^10
"KRN",19,11699,10,1,"^")
OR BDC MASTER SWITCH
"KRN",19,11699,10,2,0)
11701^PP^20
"KRN",19,11699,10,2,"^")
OR BDC PROVIDER SWITCH
"KRN",19,11699,99)
59920,40585
"KRN",19,11699,"U")
CLINICAL INDICATOR DATA CAPTUR
"KRN",19,11700,-1)
0^2
"KRN",19,11700,0)
OR BDC MASTER SWITCH^Clinical Indicator Data Capture Master Switch^^R^^^^^^^^ORDER ENTRY/RESULTS REPORTING^^
"KRN",19,11700,1,0)
^19.06^2^2^3040423^^
"KRN",19,11700,1,1,0)
This option runs the program to turn the Clinical Indicator Data Capture
"KRN",19,11700,1,2,0)
Master Switch on and off for the entire facility.
"KRN",19,11700,20)

"KRN",19,11700,25)
BAMSTR^ORWDBA5
"KRN",19,11700,"U")
CLINICAL INDICATOR DATA CAPTUR
"KRN",19,11701,-1)
0^3
"KRN",19,11701,0)
OR BDC PROVIDER SWITCH^CIDC By Provider Parameter^^R^^^^^^^^ORDER ENTRY/RESULTS REPORTING^^
"KRN",19,11701,1,0)
^19.06^12^12^3040316^^
"KRN",19,11701,1,1,0)
This program is used the manage the Clinical Indicator Data Capture
"KRN",19,11701,1,2,0)
parameter (CIDC). This parameter controls the display of the CIDC options
"KRN",19,11701,1,3,0)
in CPRS GUI. Once the parameter has been assigned to a provider its value
"KRN",19,11701,1,4,0)
can be set to enabled. This switches on the capture of the clinical 
"KRN",19,11701,1,5,0)
indicator data. The parameter can be set to disabled. This switches off
"KRN",19,11701,1,6,0)
the capture of the clinical indicator data.
"KRN",19,11701,1,7,0)
 
"KRN",19,11701,1,8,0)
The user is presented with the following options:
"KRN",19,11701,1,9,0)
Assign parameter to provider
"KRN",19,11701,1,10,0)
Edit provider's assigned parameter
"KRN",19,11701,1,11,0)
Delete provider's assigned parameter
"KRN",19,11701,1,12,0)
List providers with the assigned parameter
"KRN",19,11701,20)

"KRN",19,11701,25)
ORWDBA6
"KRN",19,11701,99.1)
59773,53488
"KRN",19,11701,"U")
CIDC BY PROVIDER PARAMETER
"KRN",8989.5,4995,0)
22;DIC(9.4,^ORQQEAFL ENC APPT FUTURE LIMIT^1
"KRN",8989.5,6970,0)
22;DIC(9.4,^ORQQCSDR CS RANGE START^1
"KRN",8989.5,6970,1)
T-365
"KRN",8989.5,6971,0)
22;DIC(9.4,^ORQQCSDR CS RANGE STOP^1
"KRN",8989.5,6971,1)
T+90
"KRN",8989.5,6972,0)
22;DIC(9.4,^ORQQEAPT ENC APPT START^1
"KRN",8989.5,6972,1)
365
"KRN",8989.51,52,0)
ORQQLR DATE RANGE OUTPT^Outpatient Lab Number of Days to Display^^^Outpatient Lab Number of Days to Display
"KRN",8989.51,52,1)
N^1:100000:0^Enter the number of days to search back in time for lab orders/results.
"KRN",8989.51,52,20,0)
^^3^3^2970307^^^^
"KRN",8989.51,52,20,1,0)
The number of days backwards in time to search for lab orders/results.  If 
"KRN",8989.51,52,20,2,0)
not indicated, the default period of 30 days will be used.  The
"KRN",8989.51,52,20,3,0)
maximum number of days is 100,000 or about 220 years. For outpatients.
"KRN",8989.51,52,30,0)
^8989.513I^6^5
"KRN",8989.51,52,30,1,0)
1^200
"KRN",8989.51,52,30,3,0)
2^49
"KRN",8989.51,52,30,4,0)
3^4
"KRN",8989.51,52,30,5,0)
4^4.2
"KRN",8989.51,52,30,6,0)
5^9.4
"KRN",8989.51,182,0)
ORQQLR DATE RANGE INPT^Inpatient Lab Number of Days to Display^^^Inpatient Lab Number of Days to Display
"KRN",8989.51,182,1)
N^1:100000:0^Enter the number of days to search back in time for lab orders/results.
"KRN",8989.51,182,20,0)
^8989.512^3^3^3010504^^^^
"KRN",8989.51,182,20,1,0)
The number of days backwards in time to search for lab orders/results. If
"KRN",8989.51,182,20,2,0)
not indicated, the default period of 2 days will be used. The
"KRN",8989.51,182,20,3,0)
maximum number of days is 100,000 or about 220 years.  For inpatients.
"KRN",8989.51,182,30,0)
^8989.513I^6^6
"KRN",8989.51,182,30,1,0)
1^200
"KRN",8989.51,182,30,2,0)
2^44
"KRN",8989.51,182,30,3,0)
3^49
"KRN",8989.51,182,30,4,0)
4^4
"KRN",8989.51,182,30,5,0)
5^4.2
"KRN",8989.51,182,30,6,0)
6^9.4
"KRN",8989.51,184,0)
ORQQPX SEARCH ITEMS^Clinical Reminders for Search^1^Display Sequence^Clinical Reminder
"KRN",8989.51,184,1)
P^811.9^Enter the Clinical Reminder(s) you wish to review with each patient.
"KRN",8989.51,184,3)
I $$ACT^ORQQPXRM(Y)
"KRN",8989.51,184,6)
N^^Enter a sequential number for identifying the reminder.
"KRN",8989.51,184,20,0)
^8989.512^3^3^3010904^^^^
"KRN",8989.51,184,20,1,0)
Returns an array of clinical reminders for a patient which can then be used
"KRN",8989.51,184,20,2,0)
for searches and displays similar to the way they are used in Health 
"KRN",8989.51,184,20,3,0)
Summary.
"KRN",8989.51,184,30,0)
^8989.513I^6^6
"KRN",8989.51,184,30,1,0)
1^200
"KRN",8989.51,184,30,2,0)
2^44
"KRN",8989.51,184,30,3,0)
3^49
"KRN",8989.51,184,30,4,0)
4^4
"KRN",8989.51,184,30,5,0)
5^4.2
"KRN",8989.51,184,30,6,0)
6^9.4
"KRN",8989.51,245,0)
ORWOR COVER RETRIEVAL NEW^Cover Sheet Retrieval Mode^1^Section^Background Retrieval
"KRN",8989.51,245,1)
Y^^Enter 'Yes' if this cover sheet section should be loaded in the background.
"KRN",8989.51,245,6)
P^101.24^Select a cover sheet section.
"KRN",8989.51,245,8)
I $P(^(0),"^",12)="S"
"KRN",8989.51,245,20,0)
^8989.512^2^2^3001017^^^^
"KRN",8989.51,245,20,1,0)
This parameter controls whether each cover sheet section is loaded in the
"KRN",8989.51,245,20,2,0)
foreground or background.
"KRN",8989.51,245,30,0)
^8989.513I^2^2
"KRN",8989.51,245,30,1,0)
1^4.2
"KRN",8989.51,245,30,2,0)
2^9.4
"KRN",8989.51,374,-1)
0^2
"KRN",8989.51,374,0)
OR BILLING AWARENESS STATUS^Status of Billing Awareness Utilization^0^^BILLING AWARENESS STATUS^0
"KRN",8989.51,374,1)
S^0:NO;1:YES^Enter '1' to enable Billing Awareness or '0' to disable Billing Awareness
"KRN",8989.51,374,4,0)
^8989.514^^0
"KRN",8989.51,374,6)

"KRN",8989.51,374,20,0)
^8989.512^1^1^3040212^^^^
"KRN",8989.51,374,20,1,0)
Status of Billing Awareness Utilization
"KRN",8989.51,374,30,0)
^8989.513I^1^1
"KRN",8989.51,374,30,1,0)
1^4.2
"KRN",8989.51,375,-1)
0^3
"KRN",8989.51,375,0)
OR BILLING AWARENESS BY USER^Enable Billing Awareness by User^0^^ENABLE BILLING AWARENESS BY USER^0
"KRN",8989.51,375,1)
S^0:NO;1:YES^Enter 1 to enable Billing Awareness for the Clinician or enter 0 to disable
"KRN",8989.51,375,20,0)
^8989.512^1^1^3040212^^
"KRN",8989.51,375,20,1,0)
This parameter enables the entry of Billing Awareness data in the sign order CPRS window if value is set to 1.  Otherwise the Clinician will not be required to enter Billing Awareness data if value is set to 0.
"KRN",8989.51,375,30,0)
^8989.513I^1^1
"KRN",8989.51,375,30,1,0)
1^200
"KRN",8989.51,376,-1)
0^1
"KRN",8989.51,376,0)
ORWIM NSS MESSAGE^MESSAGE FOR NON-STANDARD SCHEDULE^0
"KRN",8989.51,376,1)
F
"KRN",8989.51,376,6)
F
"KRN",8989.51,376,30,0)
^8989.513I^4^3
"KRN",8989.51,376,30,2,0)
2^4
"KRN",8989.51,376,30,3,0)
1^49
"KRN",8989.51,376,30,4,0)
3^4.2
"KRN",8989.51,377,-1)
0^4
"KRN",8989.51,377,0)
ORQQCSDR CS RANGE START^Cover Sheet Visit Range Start^0^^CS Visit Search Start
"KRN",8989.51,377,1)
F^^Enter start days for CS visits (E.g., T-120)
"KRN",8989.51,377,2)

"KRN",8989.51,377,4,0)
^8989.514^^0
"KRN",8989.51,377,20,0)
^8989.512^3^3^3040219^^^^
"KRN",8989.51,377,20,1,0)
Returns the relative date to start listing visits for a patient on the 
"KRN",8989.51,377,20,2,0)
Cover Sheet.  For example, 'T-90' will list visits beginning 90 days 
"KRN",8989.51,377,20,3,0)
before today.
"KRN",8989.51,377,30,0)
^8989.513I^5^5
"KRN",8989.51,377,30,1,0)
1^200
"KRN",8989.51,377,30,2,0)
2^49
"KRN",8989.51,377,30,3,0)
3^4
"KRN",8989.51,377,30,4,0)
4^4.2
"KRN",8989.51,377,30,5,0)
5^9.4
"KRN",8989.51,378,-1)
0^5
"KRN",8989.51,378,0)
ORQQCSDR CS RANGE STOP^Cover Sheet Visit Range Stop^0^^CS Visit Search Stop
"KRN",8989.51,378,1)
F^^Enter stop days for CS visits (E.g., T+30)
"KRN",8989.51,378,2)

"KRN",8989.51,378,20,0)
^8989.512^3^3^3031118^^
"KRN",8989.51,378,20,1,0)
Returns the relative date to stop listing visits for a patient on the 
"KRN",8989.51,378,20,2,0)
Cover Sheet.  For example, 'T+2' will list visits ending two days from 
"KRN",8989.51,378,20,3,0)
today.
"KRN",8989.51,378,30,0)
^8989.513I^5^5
"KRN",8989.51,378,30,1,0)
1^200
"KRN",8989.51,378,30,2,0)
2^49
"KRN",8989.51,378,30,3,0)
3^4
"KRN",8989.51,378,30,4,0)
4^4.2
"KRN",8989.51,378,30,5,0)
5^9.4
"KRN",8989.51,379,-1)
0^6
"KRN",8989.51,379,0)
ORQQEAPT ENC APPT START^Enc Appt Range Start Offset^0^^Enc Appt Range Start Offset
"KRN",8989.51,379,1)
N^^Enter start days before Today for Enc Appts (positive number up to 999)
"KRN",8989.51,379,2)
K:(X>999)!(X<0) X
"KRN",8989.51,379,20,0)
^8989.512^2^2^3031118^
"KRN",8989.51,379,20,1,0)
Returns the relative number of days before Today to begin listing 
"KRN",8989.51,379,20,2,0)
appointments (0=Today, 1=Today-1 Day, etc.).
"KRN",8989.51,379,30,0)
^8989.513I^5^5
"KRN",8989.51,379,30,1,0)
1^200
"KRN",8989.51,379,30,2,0)
2^49
"KRN",8989.51,379,30,3,0)
3^4
"KRN",8989.51,379,30,4,0)
4^4.2
"KRN",8989.51,379,30,5,0)
5^9.4
"KRN",8989.51,380,-1)
0^7
"KRN",8989.51,380,0)
ORQQEAPT ENC APPT STOP^Enc Appt Range Stop Offset^^^Enc Appt Range Stop Offset
"KRN",8989.51,380,1)
N^^Enter stop days after Today for Enc Appts (positive number up to 999)
"KRN",8989.51,380,2)
K:(X>999)!(X<0) X
"KRN",8989.51,380,20,0)
^8989.512^2^2^3031118^
"KRN",8989.51,380,20,1,0)
Returns the relative number of days from Today to stop listing 
"KRN",8989.51,380,20,2,0)
appointments (0=Today, 1=Today+1 Day, etc.).
"KRN",8989.51,380,30,0)
^8989.513I^5^5
"KRN",8989.51,380,30,1,0)
1^200
"KRN",8989.51,380,30,2,0)
2^49
"KRN",8989.51,380,30,3,0)
3^4
"KRN",8989.51,380,30,4,0)
4^4.2
"KRN",8989.51,380,30,5,0)
5^9.4
"KRN",8989.51,381,-1)
0^8
"KRN",8989.51,381,0)
ORQQEAFL ENC APPT FUTURE LIMIT^Future Days Limit For PCE Selection^^^Future Days Limit For PCE Selection
"KRN",8989.51,381,1)
N^^Enter number days from today for future appt warning
"KRN",8989.51,381,2)
K:(X>180)!(X<0) X
"KRN",8989.51,381,20,0)
^^2^2^3040310^
"KRN",8989.51,381,20,1,0)
Number of days from Today when warning is given to user upon selection of
"KRN",8989.51,381,20,2,0)
a future appointment for Encounters.
"KRN",8989.51,381,30,0)
^8989.513I^3^3
"KRN",8989.51,381,30,1,0)
2^4.2
"KRN",8989.51,381,30,2,0)
3^9.4
"KRN",8989.51,381,30,3,0)
1^4
"KRN",8989.51,383,-1)
0^9
"KRN",8989.51,383,0)
OR OREMAS NON-VA MED ORDERS^Allow Clerks to act on Non-VA Med Orders^^^ALLOW CLERKS TO ACT ON NON-VA MED ORDERS
"KRN",8989.51,383,1)
S^0:NO;2:YES^Enter 0 to prevent clerk entry of non-VA meds, 2 to allow entry and release
"KRN",8989.51,383,20,0)
^^5^5^3040504^
"KRN",8989.51,383,20,1,0)
This parameter determines if clerks (i.e. users holding the OREMAS key)
"KRN",8989.51,383,20,2,0)
are allowed to act on non-VA med orders.  Enter YES to permit a clerk to
"KRN",8989.51,383,20,3,0)
enter new or DC non-VA med orders and send them to Pharmacy for reports 
"KRN",8989.51,383,20,4,0)
and order checks. To prohibit clerks from handling non-VA med orders
"KRN",8989.51,383,20,5,0)
entirely, select NO.
"KRN",8989.51,383,30,0)
^8989.513I^1^1
"KRN",8989.51,383,30,1,0)
1^4.2
"KRN",8989.51,4707,0)
ORWCV1 COVERSHEET LIST^List of coversheet reports^1^Sequence^Coversheet Report
"KRN",8989.51,4707,1)
P^101.24^Select a report for the coversheet
"KRN",8989.51,4707,3)
I $P($G(^ORD(101.24,+Y,0)),"^",8)="C"
"KRN",8989.51,4707,6)
N^1:999:2^Enter the sequence in which the report should appear on the Cover Sheet
"KRN",8989.51,4707,20,0)
^8989.512^1^1^3001026^
"KRN",8989.51,4707,20,1,0)
This parameter allows a custom view of the Cover sheet in the CPRS Gui.
"KRN",8989.51,4707,30,0)
^8989.513I^4^4
"KRN",8989.51,4707,30,1,0)
4^4.2
"KRN",8989.51,4707,30,2,0)
2^200
"KRN",8989.51,4707,30,3,0)
6^9.4
"KRN",8989.51,4707,30,4,0)
3^4
"KRN",8989.52,301,-1)
0^4
"KRN",8989.52,301,0)
ORQQ SEARCH RANGE (USER)^GUI Cover Sheet - User^200
"KRN",8989.52,301,10,0)
^8989.521IA^13^9
"KRN",8989.52,301,10,1,0)
4^ORQQEAPT ENC APPT START
"KRN",8989.52,301,10,2,0)
5^ORQQEAPT ENC APPT STOP
"KRN",8989.52,301,10,3,0)
7^ORQQCSDR CS RANGE START
"KRN",8989.52,301,10,4,0)
8^ORQQCSDR CS RANGE STOP
"KRN",8989.52,301,10,5,0)
1^ORQQLR DATE RANGE INPT
"KRN",8989.52,301,10,6,0)
2^ORQQLR DATE RANGE OUTPT
"KRN",8989.52,301,10,9,0)
9^ORQQPX SEARCH ITEMS
"KRN",8989.52,301,10,12,0)
10^ORWCV1 COVERSHEET LIST
"KRN",8989.52,301,10,13,0)
6^ORQQEAFL ENC APPT FUTURE LIMIT
"KRN",8989.52,302,-1)
0^2
"KRN",8989.52,302,0)
ORQQ SEARCH RANGE (SERVICE)^GUI Cover Sheet - Service^49
"KRN",8989.52,302,10,0)
^8989.521IA^10^8
"KRN",8989.52,302,10,1,0)
4^ORQQEAPT ENC APPT START
"KRN",8989.52,302,10,2,0)
5^ORQQEAPT ENC APPT STOP
"KRN",8989.52,302,10,3,0)
7^ORQQCSDR CS RANGE START
"KRN",8989.52,302,10,4,0)
8^ORQQCSDR CS RANGE STOP
"KRN",8989.52,302,10,5,0)
1^ORQQLR DATE RANGE INPT
"KRN",8989.52,302,10,6,0)
2^ORQQLR DATE RANGE OUTPT
"KRN",8989.52,302,10,9,0)
9^ORQQPX SEARCH ITEMS
"KRN",8989.52,302,10,10,0)
6^ORQQEAFL ENC APPT FUTURE LIMIT
"KRN",8989.52,303,-1)
0^1
"KRN",8989.52,303,0)
ORQQ SEARCH RANGE (DIVISION)^GUI Cover Sheet - Division^4
"KRN",8989.52,303,10,0)
^8989.521IA^10^8
"KRN",8989.52,303,10,1,0)
4^ORQQEAPT ENC APPT START
"KRN",8989.52,303,10,2,0)
5^ORQQEAPT ENC APPT STOP
"KRN",8989.52,303,10,3,0)
7^ORQQCSDR CS RANGE START
"KRN",8989.52,303,10,4,0)
8^ORQQCSDR CS RANGE STOP
"KRN",8989.52,303,10,5,0)
1^ORQQLR DATE RANGE INPT
"KRN",8989.52,303,10,6,0)
2^ORQQLR DATE RANGE OUTPT
"KRN",8989.52,303,10,9,0)
9^ORQQPX SEARCH ITEMS
"KRN",8989.52,303,10,10,0)
6^ORQQEAFL ENC APPT FUTURE LIMIT
"KRN",8989.52,304,-1)
0^3
"KRN",8989.52,304,0)
ORQQ SEARCH RANGE (SYSTEM)^GUI Cover Sheet - System^4.2
"KRN",8989.52,304,10,0)
^8989.521IA^12^10
"KRN",8989.52,304,10,1,0)
4^ORQQEAPT ENC APPT START
"KRN",8989.52,304,10,2,0)
5^ORQQEAPT ENC APPT STOP
"KRN",8989.52,304,10,3,0)
7^ORQQCSDR CS RANGE START
"KRN",8989.52,304,10,4,0)
8^ORQQCSDR CS RANGE STOP
"KRN",8989.52,304,10,5,0)
1^ORQQLR DATE RANGE INPT
"KRN",8989.52,304,10,6,0)
2^ORQQLR DATE RANGE OUTPT
"KRN",8989.52,304,10,9,0)
9^ORQQPX SEARCH ITEMS
"KRN",8989.52,304,10,10,0)
10^ORWCV1 COVERSHEET LIST
"KRN",8989.52,304,10,11,0)
11^ORWOR COVER RETRIEVAL NEW
"KRN",8989.52,304,10,12,0)
6^ORQQEAFL ENC APPT FUTURE LIMIT
"KRN",8994,325,-1)
0^1
"KRN",8994,325,0)
ORWDX SAVE^SAVE^ORWDX^2
"KRN",8994,325,1,0)
^8994.01^9^9^3020604^^
"KRN",8994,325,1,1,0)
Save the order by passing in the following information:
"KRN",8994,325,1,2,0)
        ORVP=DFN
"KRN",8994,325,1,3,0)
        ORNP=Provider
"KRN",8994,325,1,4,0)
        ORL=Location
"KRN",8994,325,1,5,0)
        DLG=Order Dialog,
"KRN",8994,325,1,6,0)
        ORDG=Display Group
"KRN",8994,325,1,7,0)
        ORIT=Quick Order Dialog,
"KRN",8994,325,1,8,0)
        ORIFN=null if new order
"KRN",8994,325,1,9,0)
        ORDIALOG=Response List
"KRN",8994,1495,-1)
0^9
"KRN",8994,1495,0)
ORWDBA1 ORPKGTYP^ORPKGTYP^ORWDBA1^2
"KRN",8994,1495,1,0)
^8994.01^1^1^3030806^^^^
"KRN",8994,1495,1,1,0)
Array of Order Package Types
"KRN",8994,1495,2,0)
^8994.02A^1^1
"KRN",8994,1495,2,1,0)
ORLST^2^255^1^1
"KRN",8994,1495,2,1,1,0)
^8994.021^1^1^3030806^^^^
"KRN",8994,1495,2,1,1,1,0)
List of Order IENs
"KRN",8994,1495,2,"B","ORLST",1)

"KRN",8994,1495,2,"PARAMSEQ",1,1)

"KRN",8994,1496,-1)
0^10
"KRN",8994,1496,0)
ORWDBA1 RCVORCI^RCVORCI^ORWDBA1^1
"KRN",8994,1496,1,0)
^8994.01^1^1^3041201^^^^
"KRN",8994,1496,1,1,0)
Receive Order Entry Billing Aware data from CPRS.
"KRN",8994,1496,2,0)
^8994.02A^1^1
"KRN",8994,1496,2,1,0)
DIAG^2^255^1^2
"KRN",8994,1496,2,1,1,0)
^8994.021^1^1^3041201^^^
"KRN",8994,1496,2,1,1,1,0)
Array of Orders and Clinical Indicators returned from CPRS
"KRN",8994,1496,2,"B","DIAG",1)

"KRN",8994,1496,2,"PARAMSEQ",2,1)

"KRN",8994,1502,-1)
0^18
"KRN",8994,1502,0)
ORWDBA1 SCLST^SCLST^ORWDBA1^2
"KRN",8994,1502,1,0)
^8994.01^1^1^3030818^^^
"KRN",8994,1502,1,1,0)
Array of Order ID's and SC.
"KRN",8994,1502,2,0)
^8994.02A^2^2
"KRN",8994,1502,2,1,0)
DFN^1^50^1^1
"KRN",8994,1502,2,1,1,0)
^^1^1^3030606^
"KRN",8994,1502,2,1,1,1,0)
Patient IEN.
"KRN",8994,1502,2,2,0)
ORLST^2^255^1^2
"KRN",8994,1502,2,2,1,0)
^8994.021^1^1^3030818^^^
"KRN",8994,1502,2,2,1,1,0)
List of Orders.
"KRN",8994,1502,2,"B","DFN",1)

"KRN",8994,1502,2,"B","ORLST",1)

"KRN",8994,1502,2,"B","ORLST",2)

"KRN",8994,1502,2,"PARAMSEQ",1,1)

"KRN",8994,1502,2,"PARAMSEQ",2,1)

"KRN",8994,1502,2,"PARAMSEQ",2,2)

"KRN",8994,1505,-1)
0^7
"KRN",8994,1505,0)
ORWDBA1 BASTATUS^BASTATUS^ORWDBA1^1^P^0^^^1
"KRN",8994,1505,1,0)
^8994.01^2^2^3040301^^^^
"KRN",8994,1505,1,1,0)
Billing Awareness RPC.
"KRN",8994,1505,1,2,0)
Returns 0 if BA functionality is off or 1 if BA functionality is on.
"KRN",8994,1644,-1)
0^4
"KRN",8994,1644,0)
ORWDAL32 LOAD FOR EDIT^EDITLOAD^ORWDAL32^4^^^^1
"KRN",8994,1645,-1)
0^5
"KRN",8994,1645,0)
ORWDAL32 SAVE ALLERGY^EDITSAVE^ORWDAL32^1
"KRN",8994,1646,-1)
0^2
"KRN",8994,1646,0)
ORWDPS4 ISUDIV^ISUDIV^ORWDPS4^1
"KRN",8994,1647,-1)
0^3
"KRN",8994,1647,0)
ORWPCE CXNOSHOW^CXNOSHOW^ORWPCE2^1
"KRN",8994,1648,-1)
0^14
"KRN",8994,1648,0)
ORWDBA2 GETPDL^GETPDL^ORWDBA2^2
"KRN",8994,1648,1,0)
^8994.01^1^1^3040226^^
"KRN",8994,1648,1,1,0)
Returns a clinician's personal diagnosis codes.
"KRN",8994,1648,2,0)
^8994.02A^1^1
"KRN",8994,1648,2,1,0)
ORCIEN^4^255^1^2
"KRN",8994,1648,2,1,1,0)
^8994.021^1^1^3040226^^^
"KRN",8994,1648,2,1,1,1,0)
The clinician's internal ID number.
"KRN",8994,1648,2,"B","ORCIEN",1)

"KRN",8994,1648,2,"PARAMSEQ",2,1)

"KRN",8994,1649,-1)
0^15
"KRN",8994,1649,0)
ORWDBA2 ADDPDL^ADDPDL^ORWDBA2^1
"KRN",8994,1649,1,0)
^8994.01^3^3^3040226^^^
"KRN",8994,1649,1,1,0)
Add a new Clinician's Personal DX List or add new ICD9 codes to an 
"KRN",8994,1649,1,2,0)
existing Clinician's Personal DX List. The Personal DX list is stored in 
"KRN",8994,1649,1,3,0)
the CPRS Diagnosis Provider file, file # 5000017
"KRN",8994,1649,2,0)
^8994.02A^2^2
"KRN",8994,1649,2,1,0)
ORCIEN^4^255^1^2
"KRN",8994,1649,2,1,1,0)
^8994.021^1^1^3031211^^
"KRN",8994,1649,2,1,1,1,0)
The clinician's internal ID number.
"KRN",8994,1649,2,2,0)
ORDXA^4^255^1^3
"KRN",8994,1649,2,2,1,0)
^8994.021^2^2^3040226^^^^
"KRN",8994,1649,2,2,1,1,0)
The array variable of diagnosis codes to be added to the clinician's 
"KRN",8994,1649,2,2,1,2,0)
personal diagnoses list.
"KRN",8994,1649,2,"B","ORCIEN",1)

"KRN",8994,1649,2,"B","ORDXA",2)

"KRN",8994,1649,2,"PARAMSEQ",2,1)

"KRN",8994,1649,2,"PARAMSEQ",3,2)

"KRN",8994,1650,-1)
0^16
"KRN",8994,1650,0)
ORWDBA2 DELPDL^DELPDL^ORWDBA2^1
"KRN",8994,1650,1,0)
^8994.01^3^3^3040226^^
"KRN",8994,1650,1,1,0)
Delete a selected diagnosis code from a Clinician's Personal DX List. The 
"KRN",8994,1650,1,2,0)
personal dx list is stored in CPRS Diagnosis Provider file, file # 
"KRN",8994,1650,1,3,0)
5000017.
"KRN",8994,1650,2,0)
^8994.02A^2^2
"KRN",8994,1650,2,1,0)
ORCIEN^4^255^1^2
"KRN",8994,1650,2,1,1,0)
^8994.021^1^1^3031211^^
"KRN",8994,1650,2,1,1,1,0)
The clinician's internal ID number.
"KRN",8994,1650,2,2,0)
ORDXA^4^255^1^3
"KRN",8994,1650,2,2,1,0)
^8994.021^2^2^3040226^^^^
"KRN",8994,1650,2,2,1,1,0)
Array of diagnoses codes to be deleted from the clinician's personal
"KRN",8994,1650,2,2,1,2,0)
dx list.
"KRN",8994,1650,2,"B","ORCIEN",1)

"KRN",8994,1650,2,"B","ORDXA",2)

"KRN",8994,1650,2,"PARAMSEQ",2,1)

"KRN",8994,1650,2,"PARAMSEQ",3,2)

"KRN",8994,1651,-1)
0^17
"KRN",8994,1651,0)
ORWDBA2 GETDUDC^GETDUDC^ORWDBA2^2
"KRN",8994,1651,1,0)
^8994.01^3^3^3040226^^
"KRN",8994,1651,1,1,0)
This returns a list of unique ICD9 diagnoses codes and their descriptions 
"KRN",8994,1651,1,2,0)
on orders placed by a clinician for a patient for today. This will be 
"KRN",8994,1651,1,3,0)
used to help in filling out the encounter form.
"KRN",8994,1651,2,0)
^8994.02A^2^2
"KRN",8994,1651,2,1,0)
ORCIEN^4^255^1^2
"KRN",8994,1651,2,1,1,0)
^^1^1^3031218^
"KRN",8994,1651,2,1,1,1,0)
This is the clinician's internal ID number.
"KRN",8994,1651,2,2,0)
ORPTIEN^4^255^1^3
"KRN",8994,1651,2,2,1,0)
^8994.021^1^1^3040226^^
"KRN",8994,1651,2,2,1,1,0)
This is the patient's internal ID number.
"KRN",8994,1651,2,"B","ORCIEN",1)

"KRN",8994,1651,2,"B","ORPTIEN",2)

"KRN",8994,1651,2,"PARAMSEQ",2,1)

"KRN",8994,1651,2,"PARAMSEQ",3,2)

"KRN",8994,1651,3,0)
^8994.03^1^1^3040226^^
"KRN",8994,1651,3,1,0)
This is an array of ICD9 diagnoses codes and their descriptions. 
"KRN",8994,1652,-1)
0^8
"KRN",8994,1652,0)
ORWDBA1 GETORDX^GETORDX^ORWDBA1^2
"KRN",8994,1652,1,0)
^^1^1^3040116^
"KRN",8994,1652,1,1,0)
ARRAY OF DIAGNOSES ASSOCIATED WITH AN ORDER
"KRN",8994,1652,2,0)
^8994.02A^1^1
"KRN",8994,1652,2,1,0)
ORIEN^4^255^1^2
"KRN",8994,1652,2,1,1,0)
^^1^1^3040116^
"KRN",8994,1652,2,1,1,1,0)
ORDER INTERNAL REFERENCE NUMBER
"KRN",8994,1652,2,"B","ORIEN",1)

"KRN",8994,1652,2,"PARAMSEQ",2,1)

"KRN",8994,1653,-1)
0^13
"KRN",8994,1653,0)
ORWDBA4 GETBAUSR^GETBAUSR^ORWDBA4^1
"KRN",8994,1653,1,0)
^8994.01^3^3^3040130^^
"KRN",8994,1653,1,1,0)
Gets the value of the Enable Billing Awareness By User parameter. The 
"KRN",8994,1653,1,2,0)
value returned will be 1 for Yes, Billing Awareness Enabled, and 0 for 
"KRN",8994,1653,1,3,0)
No, Billing Awareness Disabled.
"KRN",8994,1653,2,0)
^8994.02A^1^1
"KRN",8994,1653,2,1,0)
ORCIEN^4^255^1^2
"KRN",8994,1653,2,1,1,0)
^8994.021^2^2^3040130^^
"KRN",8994,1653,2,1,1,1,0)
This is the interanl ID number of the clinicial who is being checked for 
"KRN",8994,1653,2,1,1,2,0)
the value of the Enable Billing Awareness Parameter.
"KRN",8994,1653,2,"B","ORCIEN",1)

"KRN",8994,1653,2,"PARAMSEQ",2,1)

"KRN",8994,1653,3,0)
^8994.03^2^2^3040130^^
"KRN",8994,1653,3,1,0)
The value of the return variable will be 1 for Yes, Billing Awareness 
"KRN",8994,1653,3,2,0)
Enabled or 0 for No, Billing Awareness Disabled.
"KRN",8994,1654,-1)
0^12
"KRN",8994,1654,0)
ORWDBA4 GETTFCI^GETTFCI^ORWDBA4^2
"KRN",8994,1654,2,0)
^8994.02A^1^1
"KRN",8994,1654,2,1,0)
ORIEN^2^^1^1
"KRN",8994,1654,2,"B","ORIEN",1)

"KRN",8994,1654,2,"PARAMSEQ",1,1)

"KRN",8994,1655,-1)
0^11
"KRN",8994,1655,0)
ORWDBA3 HINTS^HINTS^ORWDBA3^2
"KRN",8994,1655,1,0)
^8994.01^1^1^3040209^^
"KRN",8994,1655,1,1,0)
Returns an array of 'Hints' for Treatment Factors for CPRS CI/BA Project.
"KRN",8994,1655,3,0)
^8994.03^1^1^3040209^^
"KRN",8994,1655,3,1,0)
<none>
"KRN",8994,1656,-1)
0^6
"KRN",8994,1656,0)
ORWDAL32 SITE PARAMS^GMRASITE^ORWDAL32^1
"KRN",8994,1657,-1)
0^19
"KRN",8994,1657,0)
ORWTPD1 GETEFDAT^GETEFDAT^ORWTPD1^1
"KRN",8994,1657,3,0)
^8994.03^1^1^3031118^^
"KRN",8994,1657,3,1,0)
Returns a single integer value.
"KRN",8994,1658,-1)
0^20
"KRN",8994,1658,0)
ORWTPD1 GETEDATS^GETEDATS^ORWTPD1^1
"KRN",8994,1658,2,0)
^8994.02A^^0
"KRN",8994,1658,3,0)
^8994.03^1^1^3031118^^^^
"KRN",8994,1658,3,1,0)
Returns a single integer value.
"KRN",8994,1659,-1)
0^21
"KRN",8994,1659,0)
ORWTPD1 PUTEDATS^PUTEDATS^ORWTPD1^1
"KRN",8994,1660,-1)
0^22
"KRN",8994,1660,0)
ORWTPD1 GETCSDEF^GETCSDEF^ORWTPD1^1
"KRN",8994,1661,-1)
0^23
"KRN",8994,1661,0)
ORWTPD1 GETCSRNG^GETCSRNG^ORWTPD1^1
"KRN",8994,1662,-1)
0^24
"KRN",8994,1662,0)
ORWTPD1 PUTCSRNG^PUTCSRNG^ORWTPD1^2
"KRN",8994,1663,-1)
0^25
"KRN",8994,1663,0)
ORWTPD1 GETEAFL^GETEAFL^ORWTPD1^1
"KRN",8994,1664,-1)
0^26
"KRN",8994,1664,0)
ORWNSS NSSMSG^NSSMSG^ORWNSS^1^^^^1
"KRN",8994,1665,-1)
0^28
"KRN",8994,1665,0)
ORWNSS QOSCH^QOSCH^ORWNSS^1^^^^1
"KRN",8994,1666,-1)
0^27
"KRN",8994,1666,0)
ORWNSS VALSCH^VALSCH^ORWNSS^1^^^^1
"KRN",8994,1667,-1)
0^29
"KRN",8994,1667,0)
ORWNSS CHKSCH^CHKSCH^ORWNSS^1
"KRN",8994,1724,-1)
0^30
"KRN",8994,1724,0)
ORWTIU CHKTXT^CHKTXT^ORWTIU^1
"KRN",8994,1724,1,0)
^^2^2^3040510^
"KRN",8994,1724,1,1,0)
Check for existence of text in TIU(8925,TIUDA, either in "TEXT" or "TEMP" 
"KRN",8994,1724,1,2,0)
nodes, before allowing signature.
"KRN",8994,1724,2,0)
^8994.02A^1^1
"KRN",8994,1724,2,1,0)
ORTIUDA^1^^1^1
"KRN",8994,1724,2,1,1,0)
^^1^1^3040510^
"KRN",8994,1724,2,1,1,1,0)
Pointer to file 8925.
"KRN",8994,1724,2,"B","ORTIUDA",1)

"KRN",8994,1724,2,"PARAMSEQ",1,1)

"KRN",8994,1724,3,0)
^^2^2^3040510^
"KRN",8994,1724,3,1,0)
1 = text present
"KRN",8994,1724,3,2,0)
0 = no text present
"KRN",8994,1780,-1)
0^31
"KRN",8994,1780,0)
ORIMO ISCLOC^ISCLOC^ORIMO^1
"KRN",8994,1781,-1)
0^32
"KRN",8994,1781,0)
ORIMO ISIVQO^ISIVQO^ORIMO^1
"KRN",8994,1792,-1)
0^33
"KRN",8994,1792,0)
ORWDBA7 GETIEN9^GETIEN9^ORWDBA7^1
"KRN",8994,1792,1,0)
^8994.01^1^1^3041201^^^
"KRN",8994,1792,1,1,0)
Receive external ICD9 number and return IEN
"KRN",8994,1792,2,0)
^8994.02A^1^1
"KRN",8994,1792,2,1,0)
ICD9^2^9^1^2
"KRN",8994,1792,2,1,1,0)
^8994.021^1^1^3041201^^^
"KRN",8994,1792,2,1,1,1,0)
External ICD9 number
"KRN",8994,1792,2,"B","ICD9",1)

"KRN",8994,1792,2,"PARAMSEQ",2,1)

"KRN",8994,1792,3,0)
^8994.03^1^1^3041201^^^
"KRN",8994,1792,3,1,0)
Returns IEN for ICD9 number
"MBREQ")
1
"ORD",1,9.2)
9.2;1;;;HELP^XPDTA1;HLPF1^XPDIA1;HLPE1^XPDIA1;HLPF2^XPDIA1;;HLPDEL^XPDIA1
"ORD",1,9.2,0)
HELP FRAME
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"ORD",21,8989.52)
8989.52;21;1;;PAR2E1^XPDTA2;PAR2F1^XPDIA3;PAR2E1^XPDIA3;PAR2F2^XPDIA3;;PAR2DEL^XPDIA3(%)
"ORD",21,8989.52,0)
PARAMETER TEMPLATE
"PGL",101.24,0,13,.13)
RPC^P8994'^XWB(8994,^0;13^Q
"PGL",101.24,0,18,.18)
DETAIL REPORT^*P101.24'^ORD(101.24,^0;18^S DIC("S")="I $P(^(0),""^"",8)=""CD""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PGL",101.24,0,21,.192)
REPORT COMPONENT^P142.1'^GMT(142.1,^0;21^Q
"PGL",101.41,0,5,5)
DISPLAY GROUP^P100.98'^ORD(100.98,^0;5^Q
"PGL",101.41,0,7,7)
PACKAGE^P9.4'^DIC(9.4,^0;7^Q
"PGL",101.412,0,2,2)
ITEM^P101.41'X^ORD(101.41,^0;2^D TREE^ORDD41
"PGL",101.412,0,11,1)
PARENT^P101.41'^ORD(101.41,^0;11^Q
"PGL",101.415,0,2,2)
ITEM^P101.41'^ORD(101.41,^0;2^Q
"PGL",101.416,0,2,.02)
DIALOG^P101.41'^ORD(101.41,^0;2^Q
"PKG",22,-1)
1^1
"PKG",22,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",22,20,0)
^9.402P^^
"PKG",22,22,0)
^9.49I^1^1
"PKG",22,22,1,0)
3.0^2971217^2980204^64
"PKG",22,22,1,"PAH",1,0)
195^3050120^222222243
"PRE")
ORY195V
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
74
"RTN","ORCD")
0^78^B50855381
"RTN","ORCD",1,0)
ORCD ; SLC/MKB - Order Dialog utilities ;06/23/04 12:39
"RTN","ORCD",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**8,38,68,94,161,141,195**;Dec 17,1997
"RTN","ORCD",3,0)
INPT() ; -- Return 1 or 0, if patient/order sheet = inpatient
"RTN","ORCD",4,0)
 N Y S Y=$S($G(ORWARD):+ORWARD,$G(^DPT(+ORVP,.105)):1,1:0)
"RTN","ORCD",5,0)
 I $G(OREVENT) D  ;override if delayed order
"RTN","ORCD",6,0)
 . N X,X0 S X=$$EVT^OREVNTX(+OREVENT),X0=$G(^ORD(100.5,+X,0)),Y=1
"RTN","ORCD",7,0)
 . I $P(X0,U,2)="D",$P(X0,U,7)'=41 S Y=0 Q  ;From ASIH=Inpt
"RTN","ORCD",8,0)
 . I $P(X0,U,2)="T",$P(X0,U,7),$P(X0,U,7)<4 S Y=0 ;pass
"RTN","ORCD",9,0)
 Q Y
"RTN","ORCD",10,0)
 ;
"RTN","ORCD",11,0)
EXT(P,I,F) ; -- Returns external value of ORDIALOG(Prompt,Instance)
"RTN","ORCD",12,0)
 N TYPE,PARAM,FNUM,IENS,X,Y,J,Z
"RTN","ORCD",13,0)
 S TYPE=$E($G(ORDIALOG(P,0))),PARAM=$P($G(ORDIALOG(P,0)),U,2)
"RTN","ORCD",14,0)
 S X=$G(ORDIALOG(P,I)) I X="" Q ""
"RTN","ORCD",15,0)
 I "FNW"[TYPE Q X
"RTN","ORCD",16,0)
 I TYPE="Y" Q $S(X:"YES",X=0:"NO",1:"")
"RTN","ORCD",17,0)
 I TYPE="D" S:'$L($G(F)) F=1 Q $$FMTE^XLFDT(X,F)
"RTN","ORCD",18,0)
 I TYPE="R" Q $$FTDATE(X,$G(F)) ; DAY@TIME
"RTN","ORCD",19,0)
 I TYPE="P" D  Q Y
"RTN","ORCD",20,0)
 . S PARAM=$P(PARAM,":"),FNUM=$S(PARAM:+PARAM,1:+$P(@(U_PARAM_"0)"),U,2))
"RTN","ORCD",21,0)
 . S IENS=+X_",",J=$L(PARAM,",") I J>2 F  S J=J-2 Q:J'>0  S Z=$P(PARAM,",",J),IENS=IENS_$S(Z:Z,1:+$P(Z,"(",2))_","
"RTN","ORCD",22,0)
 . S:'+$G(F) F=.01 S Y=$$GET1^DIQ(FNUM,IENS,+F)
"RTN","ORCD",23,0)
 . I Y="",F'=.01 S Y=$$GET1^DIQ(FNUM,IENS,.01)
"RTN","ORCD",24,0)
 I TYPE="S" F J=1:1:$L(PARAM,";") S Z=$P(PARAM,";",J) I $P(Z,":")=X S Y=$S(+$G(F):X,1:$P(Z,":",2)) Q
"RTN","ORCD",25,0)
 Q $G(Y)
"RTN","ORCD",26,0)
 ;
"RTN","ORCD",27,0)
FTDATE(X,F) ; -- Returns free text form of date (i.e. TODAY)
"RTN","ORCD",28,0)
 N D,T,P,Y I X="" Q ""
"RTN","ORCD",29,0)
 S X=$$UP^XLFSTR(X),D=$P(X,"@"),T=$P(X,"@",2) ; D=date,T=time parts
"RTN","ORCD",30,0)
 I "NOW"[X Q "NOW"
"RTN","ORCD",31,0)
 I "NOON"[X Q "NOON"
"RTN","ORCD",32,0)
 I $E("MIDNIGHT",1,$L(X))=X Q "MIDNIGHT"
"RTN","ORCD",33,0)
 I (X="AM")!(X="NEXT") Q X_" Lab collection"
"RTN","ORCD",34,0)
 I (X="NEXTA")!(X="CLOSEST") Q $S(X="NEXTA":"NEXT",1:X)_" administration time"
"RTN","ORCD",35,0)
 I $E(D)'="T",$E(D)'="V",($E(D)'="N"!($E(D,1,3)="NOV")) D  Q $$FMTE^XLFDT(X,F)
"RTN","ORCD",36,0)
 . N %DT S %DT="TX" D ^%DT S:Y>0 X=Y S:'$G(F) F=1
"RTN","ORCD",37,0)
 S P=$S(D["+":"+",D["-":"-",1:"")
"RTN","ORCD",38,0)
 I P="" S Y=$S($E(D)="T":"TODAY",$E(D)="V":"NEXT VISIT",1:"NOW")
"RTN","ORCD",39,0)
FTD1 E  D
"RTN","ORCD",40,0)
 . N OFFSET,NUM,UNIT
"RTN","ORCD",41,0)
 . S OFFSET=$P(D,P,2),NUM=+OFFSET,UNIT=$E($P(OFFSET,NUM,2)) ; +/-#D
"RTN","ORCD",42,0)
 . I $E(D)="T",NUM=1,UNIT=""!(UNIT="D") S Y=$S(P="+":"TOMORROW",1:"YESTERDAY") Q
"RTN","ORCD",43,0)
 . S Y=NUM_" "_$S(UNIT="'":"MINUTE",UNIT="H":"HOUR",UNIT="W":"WEEK",UNIT="M":"MONTH",1:"DAY")
"RTN","ORCD",44,0)
 . S:NUM>1 Y=Y_"S" ; plural
"RTN","ORCD",45,0)
 . S:$E(D)="N" Y=Y_" "_$S(P="+":"FROM NOW",1:"AGO")
"RTN","ORCD",46,0)
 . S:$E(D)="T" Y=Y_" "_$S(P="+":"FROM TODAY",1:"AGO")
"RTN","ORCD",47,0)
 . S:$E(D)="V" Y=Y_" "_$S(P="+":"AFTER",1:"BEFORE")_" NEXT VISIT"
"RTN","ORCD",48,0)
 I $L(T) S Y=Y_"@"_$$TIME(T)
"RTN","ORCD",49,0)
 Q Y
"RTN","ORCD",50,0)
 ;
"RTN","ORCD",51,0)
FTDHELP ; -- Displays ??-help for R-type prompts
"RTN","ORCD",52,0)
 G R^ORCDLGH
"RTN","ORCD",53,0)
 Q
"RTN","ORCD",54,0)
 ;
"RTN","ORCD",55,0)
FTDCOMP(X1,X2,OPER) ; -- Compares free text dates from prompts X1 & X2
"RTN","ORCD",56,0)
 ;    Returns 1 or 0, IF $$VAL(X1)<OPER>$$VAL(X2) is true
"RTN","ORCD",57,0)
 N X,Y,Y1,Y2,Z,%DT
"RTN","ORCD",58,0)
 S X=$$VAL(X1),%DT="TX" D ^%DT S Y1=Y ; Y'>0 ??
"RTN","ORCD",59,0)
 S X=$$VAL(X2),%DT="TX" D ^%DT S Y2=Y ; Y'>0 ??
"RTN","ORCD",60,0)
 S Z="I "_Y1_OPER_Y2 X Z
"RTN","ORCD",61,0)
 Q $T
"RTN","ORCD",62,0)
 ;
"RTN","ORCD",63,0)
TIME(X) ; -- Returns 00:00 PM formatted time
"RTN","ORCD",64,0)
 N Y,Z,%DT
"RTN","ORCD",65,0)
 I "NOON"[X Q X
"RTN","ORCD",66,0)
 I "MIDNIGHT"[X Q "MIDNIGHT"
"RTN","ORCD",67,0)
 I X?1U,"BNE"[X Q $S(X="B":"BREAKFAST",X="N":"NOON",X="E":"EVENING",1:"")
"RTN","ORCD",68,0)
 S X="T@"_X,%DT="TX" D ^%DT I Y'>0 Q ""
"RTN","ORCD",69,0)
 S Z=$$FMTE^XLFDT(Y,"2P"),Z=$P(Z," ",2)_$$UP^XLFSTR($P(Z," ",3))
"RTN","ORCD",70,0)
 Q Z
"RTN","ORCD",71,0)
 ;
"RTN","ORCD",72,0)
VAL(TEXT,INST) ; -- Returns internal form of TEXT's current value
"RTN","ORCD",73,0)
 N I,X S X="" S:'$G(INST) INST=1
"RTN","ORCD",74,0)
 I '$D(ORDIALOG("B",TEXT)) S I=$O(ORDIALOG("B",TEXT)) Q:$E(I,1,$L(TEXT))'=TEXT X S TEXT=I ; partial match
"RTN","ORCD",75,0)
 S X=$P($G(ORDIALOG("B",TEXT)),U,2) ; ptr
"RTN","ORCD",76,0)
 Q $G(ORDIALOG(X,INST))
"RTN","ORCD",77,0)
 ;
"RTN","ORCD",78,0)
ORDMSG(OI) ; -- Display order message for orderable OI
"RTN","ORCD",79,0)
 Q:'$O(^ORD(101.43,OI,8,0))  ; no order message
"RTN","ORCD",80,0)
 N I S I=0 W !
"RTN","ORCD",81,0)
 F  S I=$O(^ORD(101.43,OI,8,I)) Q:I'>0  W !,$G(^(I,0))
"RTN","ORCD",82,0)
 W ! Q
"RTN","ORCD",83,0)
 ;
"RTN","ORCD",84,0)
PTR(NAME) ; -- Returns pointer to Dialog file for prompt NAME
"RTN","ORCD",85,0)
 Q +$O(^ORD(101.41,"AB",$E(NAME,1,63),0))
"RTN","ORCD",86,0)
 ;
"RTN","ORCD",87,0)
NMSP(PKG) ; -- Returns package namespace from pointer
"RTN","ORCD",88,0)
 N Y S Y=$$GET1^DIQ(9.4,+PKG_",",1)
"RTN","ORCD",89,0)
 S:$E(Y,1,2)="PS" Y="PS" S:Y="GMRV" Y="OR"
"RTN","ORCD",90,0)
 Q Y
"RTN","ORCD",91,0)
 ;
"RTN","ORCD",92,0)
GETQDLG(QIFN) ; -- define ORDIALOG(PROMPT) for quick order QIFN
"RTN","ORCD",93,0)
 S ORDIALOG=$$DEFDLG(QIFN) Q:'ORDIALOG
"RTN","ORCD",94,0)
 D GETDLG(ORDIALOG),GETORDER("^ORD(101.41,"_QIFN_",6)")
"RTN","ORCD",95,0)
 X:$D(^ORD(101.41,QIFN,3)) ^(3) ; entry action for quick order
"RTN","ORCD",96,0)
 Q
"RTN","ORCD",97,0)
 ;
"RTN","ORCD",98,0)
DEFDLG(QDLG) ; -- Returns default dialog for QDLG
"RTN","ORCD",99,0)
 N DG,DLG,TOP S DG=+$P($G(^ORD(101.41,+QDLG,0)),U,5)
"RTN","ORCD",100,0)
 S DLG=+$P($G(^ORD(100.98,DG,0)),U,4) ; default dialog
"RTN","ORCD",101,0)
 I 'DLG S TOP=+$O(^ORD(100.98,"AD",DG,0)),DLG=+$P($G(^ORD(100.98,TOP,0)),U,4)
"RTN","ORCD",102,0)
 Q DLG
"RTN","ORCD",103,0)
 ;
"RTN","ORCD",104,0)
GETDLG(IFN) ; -- define ORDIALOG(PROMPT) for dialog IFN
"RTN","ORCD",105,0)
 N SEQ,DA,ITEM,PTR,PROMPT,TEXT,INDEX,HELP,XHELP,SCREEN,ORD,INPUTXFM,LKP
"RTN","ORCD",106,0)
 S SEQ=0 K ^TMP("ORWORD",$J)
"RTN","ORCD",107,0)
 F  S SEQ=$O(^ORD(101.41,IFN,10,"B",SEQ)) Q:SEQ'>0  S DA=0 F  S DA=$O(^ORD(101.41,IFN,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORCD",108,0)
 . S ITEM=$G(^ORD(101.41,IFN,10,DA,0)),INPUTXFM=$G(^(.1)),HELP=$G(^(1)),SCREEN=$G(^(4)),XHELP=$G(^(6))
"RTN","ORCD",109,0)
 . S PTR=$P(ITEM,U,2),TEXT=$P(ITEM,U,4),INDEX=$P(ITEM,U,10) Q:'PTR
"RTN","ORCD",110,0)
 . S:'$L(TEXT) TEXT=$P(^ORD(101.41,PTR,0),U,2) K ORD
"RTN","ORCD",111,0)
 . S PROMPT=$G(^ORD(101.41,PTR,1)),ORD=DA_U_$P(PROMPT,U,3)
"RTN","ORCD",112,0)
 . S ORD(0)=$P(PROMPT,U)_$S($P(PROMPT,U)="S":"M",1:"")_U_$P(PROMPT,U,2)_$S($L(INPUTXFM):U_INPUTXFM,1:"")
"RTN","ORCD",113,0)
 . S ORD("A")=TEXT S:$L($P(ITEM,U,13)) ORD("TTL")=$P(ITEM,U,13)
"RTN","ORCD",114,0)
 . I $P(ITEM,U,7) S ORD("MAX")=$P(ITEM,U,12),ORD("MORE")=$P(ITEM,U,14) ; fields for multiples
"RTN","ORCD",115,0)
 . I $L(HELP) S LKP=$P(HELP,U,2),HELP=$P(HELP,U) S:$L(HELP) ORD("?")=HELP S:$L(LKP) ORD("LKP")=$S($L(LKP,";")>1:$TR(LKP,";","^"),1:U_LKP)
"RTN","ORCD",116,0)
 . S:$L(XHELP) ORD("??")=U_XHELP
"RTN","ORCD",117,0)
 . S:$L(INDEX) ORD("D")=INDEX
"RTN","ORCD",118,0)
 . S:$L(SCREEN) ORD("S")=SCREEN
"RTN","ORCD",119,0)
 . S ORDIALOG("B",$$UP^XLFSTR($P(TEXT,":")))=SEQ_U_PTR
"RTN","ORCD",120,0)
 . M ORDIALOG(PTR)=ORD
"RTN","ORCD",121,0)
 Q
"RTN","ORCD",122,0)
 ;
"RTN","ORCD",123,0)
GETDLG1(IFN) ; -- basic ORDIALOG(PROMPT) for dialog IFN
"RTN","ORCD",124,0)
 N SEQ,DA,PROMPT,PTR,WINCTRL
"RTN","ORCD",125,0)
 K ^TMP("ORWORD",$J) S SEQ=0
"RTN","ORCD",126,0)
 F  S SEQ=$O(^ORD(101.41,IFN,10,"B",SEQ)) Q:SEQ'>0  S DA=0 F  S DA=$O(^ORD(101.41,IFN,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORCD",127,0)
 . S PTR=$P($G(^ORD(101.41,IFN,10,DA,0)),U,2) Q:'PTR
"RTN","ORCD",128,0)
 . S WINCTRL=$P($G(^ORD(101.41,IFN,10,DA,"W")),U)
"RTN","ORCD",129,0)
 . S PROMPT=$G(^ORD(101.41,PTR,1)) Q:'$L(PROMPT)
"RTN","ORCD",130,0)
 . S ORDIALOG(PTR)=DA_U_$P(PROMPT,U,3)_U_WINCTRL
"RTN","ORCD",131,0)
 . S ORDIALOG(PTR,0)=$P(PROMPT,U,1,2)
"RTN","ORCD",132,0)
 Q
"RTN","ORCD",133,0)
 ;
"RTN","ORCD",134,0)
GETORDER(ROOT,ARRAY) ; -- retrieve order values from RESPONSES in ARRAY()
"RTN","ORCD",135,0)
 N ORI,ID,PTR,INST,TYPE,DA,X,ORTXT S:'$L($G(ARRAY)) ARRAY="ORDIALOG"
"RTN","ORCD",136,0)
 I +ROOT=ROOT S ROOT="^OR(100,"_ROOT_",4.5)" ; assume Orders file IFN
"RTN","ORCD",137,0)
 S ORI=0 F  S ORI=$O(@ROOT@(ORI)) Q:ORI'>0  S ID=$G(@ROOT@(ORI,0)) D
"RTN","ORCD",138,0)
 . S DA=$P(ID,U),PTR=$P(ID,U,2),INST=$P(ID,U,3) S:'INST INST=1
"RTN","ORCD",139,0)
 . S:'PTR PTR=$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,2) Q:'PTR
"RTN","ORCD",140,0)
 . Q:'$D(ORDIALOG(PTR))  S TYPE=$E($G(ORDIALOG(PTR,0))) Q:'$L(TYPE)
"RTN","ORCD",141,0)
 . I TYPE'="W" S X=$G(@ROOT@(ORI,1)) S:$L(X) @ARRAY@(PTR,INST)=X Q
"RTN","ORCD",142,0)
 . D RESTXT ;resolve objects
"RTN","ORCD",143,0)
 . I ARRAY="ORDIALOG" M ^TMP("ORWORD",$J,PTR,INST)=@ORTXT S @ARRAY@(PTR,INST)="^TMP(""ORWORD"","_$J_","_PTR_","_INST_")"
"RTN","ORCD",144,0)
 . I ARRAY'="ORDIALOG" M @ARRAY@(PTR,INST)=@ORTXT S @ARRAY@(PTR,INST)=$NA(@ARRAY@(PTR,INST))
"RTN","ORCD",145,0)
 . K @ORTXT
"RTN","ORCD",146,0)
 Q
"RTN","ORCD",147,0)
 ;
"RTN","ORCD",148,0)
RESTXT ; -- resolve objects in text [from GETORDER+8]
"RTN","ORCD",149,0)
 I $G(ORTYPE)="Z" M ^TMP("ORX",$J)=@ROOT@(ORI,2) S ORTXT=$NA(^TMP("ORX",$J)) Q  ;return text unresolved
"RTN","ORCD",150,0)
 N ARRAY,PTR,INST
"RTN","ORCD",151,0)
 D BLRPLT^TIUSRVD(.ORTXT,,+$G(ORVP),,$NA(@ROOT@(ORI,2)))
"RTN","ORCD",152,0)
 Q
"RTN","ORCD",153,0)
 ;
"RTN","ORCD",154,0)
DUP(PROMPT,CURRENT) ; -- Compare CURRENT instance of PROMPT for duplicates
"RTN","ORCD",155,0)
 N X,Y,I
"RTN","ORCD",156,0)
 S X=ORDIALOG(PROMPT,CURRENT),Y=0
"RTN","ORCD",157,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  I I'=CURRENT,$P(ORDIALOG(PROMPT,I),U)=$P(ORDIALOG(PROMPT,CURRENT),U) S Y=1 Q
"RTN","ORCD",158,0)
 Q Y
"RTN","ORCD",159,0)
 ;
"RTN","ORCD",160,0)
LIST ; -- Show contents of ORDIALOG(PROMPT,"LIST")
"RTN","ORCD",161,0)
 N NUM S NUM=$G(ORDIALOG(PROMPT,"LIST")) Q:'NUM
"RTN","ORCD",162,0)
 W !,"Choose from"_$S('$P(NUM,U,2):" (or enter another):",1:":")
"RTN","ORCD",163,0)
LIST1 N I,DONE,CNT S (I,CNT,DONE)=0
"RTN","ORCD",164,0)
 F  S I=$O(ORDIALOG(PROMPT,"LIST",I)) Q:I'>0  D  Q:DONE
"RTN","ORCD",165,0)
 . S CNT=CNT+1 I CNT>(IOSL-2) S CNT=0 I '$$MORE S DONE=1 Q
"RTN","ORCD",166,0)
 . W !,$J(I,6)_"   "_$P(ORDIALOG(PROMPT,"LIST",I),U,2)
"RTN","ORCD",167,0)
 Q
"RTN","ORCD",168,0)
 ;
"RTN","ORCD",169,0)
SETLIST ; -- Show allowable set of codes
"RTN","ORCD",170,0)
 W !,"Choose from:"
"RTN","ORCD",171,0)
SETLST1 N I,X F I=1:1:$L(DOMAIN,";") S X=$P(DOMAIN,";",I) I $L(X) D
"RTN","ORCD",172,0)
 . W !,?5,$P(X,":"),?15,$P(X,":",2)
"RTN","ORCD",173,0)
 Q
"RTN","ORCD",174,0)
 ;
"RTN","ORCD",175,0)
MORE() ; -- show more?
"RTN","ORCD",176,0)
 N X,Y,DIR
"RTN","ORCD",177,0)
 S DIR(0)="EA",DIR("A")="    press <return> to continue or ^ to exit ..."
"RTN","ORCD",178,0)
 D ^DIR
"RTN","ORCD",179,0)
 Q +Y
"RTN","ORCD",180,0)
 ;
"RTN","ORCD",181,0)
FIRST(P,I) ; -- Returns 1 or 0, if current instance I is first of multiple
"RTN","ORCD",182,0)
 Q '$O(ORDIALOG(P,I),-1)
"RTN","ORCD",183,0)
 ;
"RTN","ORCD",184,0)
RECALL(P,I) ; -- Returns first value for prompt P, instance I
"RTN","ORCD",185,0)
 N Y S:'$G(I) I=1 S Y=$G(^TMP("ORECALL",$J,+ORDIALOG,P,I))
"RTN","ORCD",186,0)
 Q Y
"RTN","ORCDPS1")
0^3^B72403694
"RTN","ORCDPS1",1,0)
ORCDPS1 ;SLC/MKB-Pharmacy dialog utilities ; 08 May 2002  2:12 PM
"RTN","ORCDPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,117,141,149,195**;Dec 17, 1997
"RTN","ORCDPS1",3,0)
EN(TYPE) ; -- entry action for Meds dialogs
"RTN","ORCDPS1",4,0)
 S ORINPT=$$INPT^ORCD,ORCAT=$G(TYPE)
"RTN","ORCDPS1",5,0)
 I 'ORINPT,ORCAT="I" D IMOLOC^ORIMO(.ORINPT,+ORL,+ORVP) S:ORINPT<0 ORINPT=0 ;allow inpt meds at this location?
"RTN","ORCDPS1",6,0)
 I ORCAT="" D
"RTN","ORCDPS1",7,0)
 . I $G(ORENEW)!$G(OREWRITE)!$D(OREDIT),$L($P($G(OR0),U,12)) S ORCAT=$P(OR0,U,12) Q  ;use value from order, via ORCACT4
"RTN","ORCDPS1",8,0)
 . S ORCAT=$S(ORINPT:"I",1:"O")
"RTN","ORCDPS1",9,0)
 S ORDG=+$O(^ORD(100.98,"B",$S(ORCAT="I":"UD RX",1:"O RX"),0))
"RTN","ORCDPS1",10,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",11,0)
 I $G(ORENEW)!$G(OREWRITE)!$D(OREDIT)!$G(ORXFER) D  Q:$G(ORQUIT)
"RTN","ORCDPS1",12,0)
 . I 'ORINPT,ORCAT="I" D  Q:$G(ORQUIT)
"RTN","ORCDPS1",13,0)
 .. N OI S OI=+$O(^OR(100,+$G(ORIFN),.1,"B",0)) Q:OI<1
"RTN","ORCDPS1",14,0)
 .. I '$O(^ORD(101.43,OI,9,"B","IVM RX",0)) S ORQUIT=1 W $C(7),!!,"This order may not be placed at this location!" Q
"RTN","ORCDPS1",15,0)
 . K ORDIALOG($$PTR("START DATE/TIME"),1)
"RTN","ORCDPS1",16,0)
 . K ORDIALOG($$PTR("NOW"),1) Q:ORCAT'="O"
"RTN","ORCDPS1",17,0)
 . I $G(OREDIT)!$G(OREWRITE) N PI S PI=$$PTR("PATIENT INSTRUCTIONS") K ORDIALOG(PI,1),^TMP("ORWORD",$J,PI) ;start over
"RTN","ORCDPS1",18,0)
 . I $D(OREDIT),'$O(ORDIALOG($$PTR^ORCD("OR GTX INSTRUCTIONS"),0)) K ^TMP("ORWORD",$J)
"RTN","ORCDPS1",19,0)
 I ORINPT,ORCAT="O" W $C(7),!!,"NOTE: This will create an outpatient prescription for an inpatient!",!
"RTN","ORCDPS1",20,0)
 Q
"RTN","ORCDPS1",21,0)
 ;
"RTN","ORCDPS1",22,0)
EN1 ; -- setup Meds dialog for quick order editor using ORDG
"RTN","ORCDPS1",23,0)
 N DG S DG=$P($G(^ORD(100.98,+$G(ORDG),0)),U,3)
"RTN","ORCDPS1",24,0)
 I $P(DG," ")="O"!(DG="SPLY") S ORINPT=0,ORCAT="O"
"RTN","ORCDPS1",25,0)
 E  S ORINPT=1,ORCAT="I"
"RTN","ORCDPS1",26,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",27,0)
 Q
"RTN","ORCDPS1",28,0)
 ;
"RTN","ORCDPS1",29,0)
ENOI ; -- setup OI prompt
"RTN","ORCDPS1",30,0)
 N D S D=$G(ORDIALOG(PROMPT,"D"))
"RTN","ORCDPS1",31,0)
 S:D="S.RX" ORDIALOG(PROMPT,"D")=$S(ORCAT="I":"S.UD RX",1:"S.O RX")
"RTN","ORCDPS1",32,0)
 I ORCAT="I",'ORINPT,D="S.UD RX" D  ;limit to IV meds for outpt's
"RTN","ORCDPS1",33,0)
 . S ORDIALOG(PROMPT,"D")="S.IVM RX" ;ORDG=+$O(^ORD(100.98,"B","O RX",0))
"RTN","ORCDPS1",34,0)
 . S ORDIALOG(PROMPT,"?")="Enter the IV medication you wish to order for this patient."
"RTN","ORCDPS1",35,0)
 Q
"RTN","ORCDPS1",36,0)
 ;
"RTN","ORCDPS1",37,0)
DEA ; -- ck DEA# of ordering provider if SchedII drug
"RTN","ORCDPS1",38,0)
 Q:$G(ORTYPE)="Z"  N DEAFLG,PSOI
"RTN","ORCDPS1",39,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(Y),0)),U,2) Q:PSOI'>0
"RTN","ORCDPS1",40,0)
 S DEAFLG=$$OIDEA^PSSUTLA1(PSOI,ORCAT) Q:DEAFLG'>0  ;ok
"RTN","ORCDPS1",41,0)
 I $G(ORNP),'$L($P($G(^VA(200,+ORNP,"PS")),U,2)),'$L($P($G(^("PS")),U,3)) W $C(7),!,$P($G(^(0)),U)_" must have a DEA# or VA# to order this drug!" K DONE Q
"RTN","ORCDPS1",42,0)
 I DEAFLG=1 W $C(7),!,"This order will require a wet signature!"
"RTN","ORCDPS1",43,0)
 Q
"RTN","ORCDPS1",44,0)
 ;
"RTN","ORCDPS1",45,0)
CHANGED(X) ; -- Kill dependent values when prompt X changes
"RTN","ORCDPS1",46,0)
 N PROMPTS,NAME,PTR,P,I
"RTN","ORCDPS1",47,0)
 S PROMPTS=X I X="OI" D
"RTN","ORCDPS1",48,0)
 . S PROMPTS="INSTRUCTIONS^ROUTE^SCHEDULE^START DATE/TIME^DURATION^AND/THEN^DOSE^DISPENSE DRUG^SIG^PATIENT INSTRUCTIONS^DAYS SUPPLY^QUANTITY^REFILLS^SERVICE CONNECTED"
"RTN","ORCDPS1",49,0)
 . K ORDRUG,ORDOSE,OROUTE,ORSCH,ORSD,ORDSUP,ORQTY,ORQTYUNT,OREFILLS,ORCOPAY
"RTN","ORCDPS1",50,0)
 . K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",51,0)
 I X="DS" S PROMPTS="QUANTITY^REFILLS" K OREFILLS
"RTN","ORCDPS1",52,0)
 F P=1:1:$L(PROMPTS,U) S NAME=$P(PROMPTS,U,P) D
"RTN","ORCDPS1",53,0)
 . S PTR=$$PTR(NAME) Q:'PTR
"RTN","ORCDPS1",54,0)
 . S I=0 F  S I=$O(ORDIALOG(PTR,I)) Q:I'>0  K ORDIALOG(PTR,I)
"RTN","ORCDPS1",55,0)
 . K ORDIALOG(PTR,"LIST"),^TMP("ORWORD",$J,PTR)
"RTN","ORCDPS1",56,0)
 Q
"RTN","ORCDPS1",57,0)
 ;
"RTN","ORCDPS1",58,0)
ORDITM(OI) ; -- Check OI, get dependent info
"RTN","ORCDPS1",59,0)
 Q:OI'>0  ;quit - no value
"RTN","ORCDPS1",60,0)
 N ORPS,PSOI S ORPS=$G(^ORD(101.43,+OI,"PS")),PSOI=+$P($G(^(0)),U,2)
"RTN","ORCDPS1",61,0)
 S ORIV=$S($P(ORPS,U)=2:1,1:0)
"RTN","ORCDPS1",62,0)
 I $G(ORCAT)="O",'$P(ORPS,U,2) W $C(7),!,"This drug may not be used in an outpatient order." S ORQUIT=1 D WAIT Q
"RTN","ORCDPS1",63,0)
 I $G(ORCAT)="I" D  Q:$G(ORQUIT)
"RTN","ORCDPS1",64,0)
 . I $G(ORINPT),'$P(ORPS,U) W $C(7),!,"This drug may not be used in an inpatient order." S ORQUIT=1 D WAIT Q
"RTN","ORCDPS1",65,0)
 . I '$G(ORINPT),'ORIV W $C(7),!,"This drug may not be ordered for an outpatient." S ORQUIT=1 D WAIT Q
"RTN","ORCDPS1",66,0)
 I $G(ORTYPE)="Q" D  I $G(ORQUIT) D WAIT Q
"RTN","ORCDPS1",67,0)
 . N DEAFLG S DEAFLG=$$OIDEA^PSSUTLA1(PSOI,ORCAT) Q:DEAFLG'>0  ;ok
"RTN","ORCDPS1",68,0)
 . I $G(ORNP),'$L($P($G(^VA(200,+ORNP,"PS")),U,2)),'$L($P($G(^("PS")),U,3)) W $C(7),!,$P($G(^(0)),U)_" must have a DEA# or VA# to order this drug!" S ORQUIT=1 Q
"RTN","ORCDPS1",69,0)
 . I DEAFLG=1 W $C(7),!,"This order will require a wet signature!"
"RTN","ORCDPS1",70,0)
OI1 ; -ck NF status
"RTN","ORCDPS1",71,0)
 I $P(ORPS,U,6),'$G(ORENEW) D  ;prompt for alternative
"RTN","ORCDPS1",72,0)
 . W !!,"*** This medication is not in the formulary! ***"
"RTN","ORCDPS1",73,0)
 . N PSX,CNT,ORX,DIR,X,Y,DTOUT,DUOUT
"RTN","ORCDPS1",74,0)
 . D EN1^PSSUTIL1(.PSOI,ORCAT) I '$O(PSOI(0)) D  Q
"RTN","ORCDPS1",75,0)
 .. W !,"    There are no formulary alternatives entered for this item."
"RTN","ORCDPS1",76,0)
 .. W !,"    Please consult with your pharmacy before ordering it."
"RTN","ORCDPS1",77,0)
 . S PSX=0,CNT=0 F  S PSX=$O(PSOI(PSX)) Q:PSX'>0  D
"RTN","ORCDPS1",78,0)
 .. S ORX=+$O(^ORD(101.43,"ID",PSX_";99PSP",0)) Q:ORX'>0
"RTN","ORCDPS1",79,0)
 .. S CNT=CNT+1,PSOI("OI",CNT)=ORX_U_PSX
"RTN","ORCDPS1",80,0)
 .. S DIR("A",CNT)=$J(CNT,3)_" "_$P($G(^ORD(101.43,ORX,0)),U)
"RTN","ORCDPS1",81,0)
 . S DIR(0)="NAO^1:"_CNT,DIR("A")="Select alternative (or <return> to continue): "
"RTN","ORCDPS1",82,0)
 . S DIR("?")="The medication selected is not in the formulary; you may select one of the above listed alternatives instead, or press <return> to continue processing this order."
"RTN","ORCDPS1",83,0)
 . Q:CNT'>0  W !,"    Formulary alternatives:" D ^DIR
"RTN","ORCDPS1",84,0)
 . I Y'>0 S:$D(DTOUT)!$D(DUOUT) ORQUIT=1 Q
"RTN","ORCDPS1",85,0)
 . D:OI'=+PSOI("OI",+Y) CHANGED("OI") ;reset parameters if different
"RTN","ORCDPS1",86,0)
 . S OI=+PSOI("OI",+Y),ORDIALOG(PROMPT,INST)=OI,OROI=OI
"RTN","ORCDPS1",87,0)
 . S PSOI=+$P(PSOI("OI",+Y),U,2)
"RTN","ORCDPS1",88,0)
OI2 ; -get routes, doses [also called from NF^ORCDPS]
"RTN","ORCDPS1",89,0)
 D:'$D(^TMP("PSJMR",$J)) START^PSSJORDF(PSOI,$G(ORCAT))
"RTN","ORCDPS1",90,0)
 I '$D(ORDOSE) D
"RTN","ORCDPS1",91,0)
 . D DOSE^PSSORUTL(.ORDOSE,PSOI,$S($G(ORCAT)="I":"U",1:"O"),+ORVP)
"RTN","ORCDPS1",92,0)
 . K:$G(ORDOSE(1))=-1 ORDOSE
"RTN","ORCDPS1",93,0)
 Q
"RTN","ORCDPS1",94,0)
 ;
"RTN","ORCDPS1",95,0)
NFI(OI) ; -- Show NFI restrictions, if exist
"RTN","ORCDPS1",96,0)
 N PSOI,I,J,LCNT,MAX,X,STOP
"RTN","ORCDPS1",97,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(OI),0)),U,2)
"RTN","ORCDPS1",98,0)
 D EN^PSSDIN(PSOI,"") Q:'$D(^TMP("PSSDIN",$J,"OI",PSOI))
"RTN","ORCDPS1",99,0)
 S I=0,LCNT=0,MAX=$S($G(IOBM)&$G(IOTM):IOBM-IOTM+1,1:24) W !
"RTN","ORCDPS1",100,0)
 F  S I=$O(^TMP("PSSDIN",$J,"OI",PSOI,I)) Q:I'>0  D
"RTN","ORCDPS1",101,0)
 . S J=0 F  S J=$O(^TMP("PSSDIN",$J,"OI",PSOI,I,J)) Q:J'>0  S X=$G(^(J)) D  Q:$G(STOP)
"RTN","ORCDPS1",102,0)
 .. S LCNT=LCNT+1 I LCNT'<MAX S:'$$CONT STOP=1 Q:$G(STOP)  S LCNT=1
"RTN","ORCDPS1",103,0)
 .. W !,X
"RTN","ORCDPS1",104,0)
 W ! K ^TMP("PSSDIN",$J,"OI",PSOI)
"RTN","ORCDPS1",105,0)
 Q
"RTN","ORCDPS1",106,0)
 ;
"RTN","ORCDPS1",107,0)
CONT() ; -- Cont or stop?
"RTN","ORCDPS1",108,0)
 N X,Y,DIR,DUOUT,DTOUT,DIRUT,DIROUT S DIR(0)="EA"
"RTN","ORCDPS1",109,0)
 S DIR("A")="Press <return> to continue or ^ to stop ..."
"RTN","ORCDPS1",110,0)
 D ^DIR S:$D(DUOUT)!$D(DTOUT) Y=""
"RTN","ORCDPS1",111,0)
 Q +Y
"RTN","ORCDPS1",112,0)
 ;
"RTN","ORCDPS1",113,0)
WAIT ; -- Wait for user
"RTN","ORCDPS1",114,0)
 N X W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCDPS1",115,0)
 Q
"RTN","ORCDPS1",116,0)
 ;
"RTN","ORCDPS1",117,0)
ROUTES ; -- Get med routes
"RTN","ORCDPS1",118,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  N I,X,CNT S (I,CNT)=0
"RTN","ORCDPS1",119,0)
 F  S I=$O(^TMP("PSJMR",$J,I)) Q:I'>0  S X=^(I),CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=$P(X,U,3)_U_$P(X,U,1,2),ORDIALOG(PROMPT,"LIST","B",$P(X,U))=$P(X,U,3)
"RTN","ORCDPS1",120,0)
 S:$G(CNT) ORDIALOG(PROMPT,"LIST")=CNT
"RTN","ORCDPS1",121,0)
 S:$G(ORTYPE)'="Z" REQD=$S(ORCAT="I":1,$P($G(^ORD(101.43,+$G(OROI),"PS")),U,5):0,1:1)
"RTN","ORCDPS1",122,0)
 Q
"RTN","ORCDPS1",123,0)
 ;
"RTN","ORCDPS1",124,0)
DEFRTE ; -- Get default route
"RTN","ORCDPS1",125,0)
 N INST1 S INST1=$O(ORDIALOG(PROMPT,0)) S:INST1'>0 INST1=INST ;1st inst
"RTN","ORCDPS1",126,0)
 I INST1=INST S Y=+$P($G(^TMP("PSJMR",$J,1)),U,3) K:Y'>0 Y Q
"RTN","ORCDPS1",127,0)
 S Y=+$G(ORDIALOG(PROMPT,INST1)) K:Y'>0 Y S:$G(Y) EDITONLY=1
"RTN","ORCDPS1",128,0)
 Q
"RTN","ORCDPS1",129,0)
 ;
"RTN","ORCDPS1",130,0)
CKSCH ; -- validate schedule [Called from P-S Action]
"RTN","ORCDPS1",131,0)
 N ORX S ORX=ORDIALOG(PROMPT,ORI) Q:ORX=$G(ORESET)  K ORSD ;reset
"RTN","ORCDPS1",132,0)
 D EN^PSSGS0(.ORX,$G(ORCAT))
"RTN","ORCDPS1",133,0)
 I $D(ORX) S ORDIALOG(PROMPT,ORI)=ORX D CHANGED("QUANTITY") Q  ;ok
"RTN","ORCDPS1",134,0)
 W $C(7),!,"Enter a standard administration schedule"
"RTN","ORCDPS1",135,0)
 K DONE I $G(ORCAT)="I" W ".",! Q
"RTN","ORCDPS1",136,0)
 W " or one of your own,",!,"up to 70 characters and no more than 2 spaces.",!
"RTN","ORCDPS1",137,0)
 Q
"RTN","ORCDPS1",138,0)
 ;
"RTN","ORCDPS1",139,0)
DEFCONJ ; -- Set default conjuction for previous instance [P-S Action]
"RTN","ORCDPS1",140,0)
 N LAST,DUR,CONJ
"RTN","ORCDPS1",141,0)
 S LAST=$O(ORDIALOG(PROMPT,ORI),-1) Q:LAST'>0  ;first instance
"RTN","ORCDPS1",142,0)
 S CONJ=$$PTR("AND/THEN") Q:$L($G(ORDIALOG(CONJ,LAST)))
"RTN","ORCDPS1",143,0)
 S DUR=$G(ORDIALOG($$PTR("DURATION"),LAST))
"RTN","ORCDPS1",144,0)
 S ORDIALOG(CONJ,LAST)=$S(+DUR'>0:"A",1:"T")
"RTN","ORCDPS1",145,0)
 Q
"RTN","ORCDPS1",146,0)
 ;
"RTN","ORCDPS1",147,0)
ENCONJ ; -- Get allowable values, if req'd for INST
"RTN","ORCDPS1",148,0)
 N P S P=$$PTR("INSTRUCTIONS")
"RTN","ORCDPS1",149,0)
 S REQD=$S($O(ORDIALOG(P,INST)):1,1:0)
"RTN","ORCDPS1",150,0)
 S ORDIALOG(PROMPT,"A")="And/then"_$S(ORCAT="O":"/except: ",1:": ")
"RTN","ORCDPS1",151,0)
 S $P(ORDIALOG(PROMPT,0),U,2)="A:AND;T:THEN;"_$S(ORCAT="O":"X:EXCEPT;",1:"")
"RTN","ORCDPS1",152,0)
 Q
"RTN","ORCDPS1",153,0)
 ;
"RTN","ORCDPS1",154,0)
DSUP ; -- Get max/default days supply
"RTN","ORCDPS1",155,0)
 N ORX,Y
"RTN","ORCDPS1",156,0)
 S ORX("PATIENT")=+$G(ORVP),ORX("DRUG")=+$G(ORDRUG)
"RTN","ORCDPS1",157,0)
 D DSUP^PSOSIGDS(.ORX) S Y=+$G(ORX("DAYS SUPPLY")) S:Y'>0 Y=90
"RTN","ORCDPS1",158,0)
 ;S $P(ORDIALOG(PROMPT,0),U,2)="1:"_Y ;max allowed
"RTN","ORCDPS1",159,0)
 I '$G(ORDIALOG(PROMPT,1)),$G(ORTYPE)'="Z" S ORDIALOG(PROMPT,1)=Y
"RTN","ORCDPS1",160,0)
 Q
"RTN","ORCDPS1",161,0)
 ;
"RTN","ORCDPS1",162,0)
QTY() ; -- Return default quantity [Expects ORDSUP]
"RTN","ORCDPS1",163,0)
 N INSTR,DOSE,DUR,SCH,I,ORX,X,Y
"RTN","ORCDPS1",164,0)
 S Y="" I $G(ORDSUP)'>0!'$G(ORDRUG) G QTYQ ;need days supply, disp drug
"RTN","ORCDPS1",165,0)
 S INSTR=$$PTR("INSTRUCTIONS")
"RTN","ORCDPS1",166,0)
 S DOSE=$$PTR("DOSE"),CONJ=$$PTR("AND/THEN")
"RTN","ORCDPS1",167,0)
 S DUR=$$PTR("DURATION"),SCH=$$PTR("SCHEDULE")
"RTN","ORCDPS1",168,0)
 S I=0 F  S I=$O(ORDIALOG(INSTR,I)) Q:I'>0  D  Q:'$D(ORX)
"RTN","ORCDPS1",169,0)
 . S X=$P($G(ORDIALOG(DOSE,I)),"&",3) I X'>0 K ORX Q
"RTN","ORCDPS1",170,0)
 . S ORX("DOSE ORDERED",I)=X,ORX("SCHEDULE",I)=$G(ORDIALOG(SCH,I))
"RTN","ORCDPS1",171,0)
 . S X=$G(ORDIALOG(DUR,I)),ORX("DURATION",I)=$$HL7DUR^ORMBLDPS
"RTN","ORCDPS1",172,0)
 . S ORX("CONJUNCTION",I)=$G(ORDIALOG(CONJ,I))
"RTN","ORCDPS1",173,0)
 G:'$D(ORX) QTYQ ;no doses
"RTN","ORCDPS1",174,0)
 S ORX("PATIENT")=+$G(ORVP),ORX("DRUG")=+$G(ORDRUG)
"RTN","ORCDPS1",175,0)
 S ORX("DAYS SUPPLY")=+$G(ORDSUP)
"RTN","ORCDPS1",176,0)
 D QTYX^PSOSIG(.ORX) S Y=$G(ORX("QTY"))
"RTN","ORCDPS1",177,0)
QTYQ Q Y
"RTN","ORCDPS1",178,0)
 ;
"RTN","ORCDPS1",179,0)
MAXREFS ; -- Get max refills allowed [Entry Action]
"RTN","ORCDPS1",180,0)
 Q:$G(ORCAT)'="O"  N ORX,X
"RTN","ORCDPS1",181,0)
 S ORX("ITEM")=+$P($G(^ORD(101.43,+$G(OROI),0)),U,2)
"RTN","ORCDPS1",182,0)
 S ORX("DRUG")=+$G(ORDRUG),ORX("PATIENT")=+$G(ORVP)
"RTN","ORCDPS1",183,0)
 I $G(OREVENT),$$TYPE^OREVNTX(OREVENT)="D" S ORX("DISCHARGE")=1
"RTN","ORCDPS1",184,0)
 S ORX("DAYS SUPPLY")=$G(ORDSUP) D MAX^PSOSIGDS(.ORX)
"RTN","ORCDPS1",185,0)
 S OREFILLS=$G(ORX("MAX")),X=$G(ORDIALOG(PROMPT,INST))
"RTN","ORCDPS1",186,0)
 I OREFILLS'>0 S ORDIALOG(PROMPT,INST)=0 W !,"No refills allowed." Q
"RTN","ORCDPS1",187,0)
 S $P(ORDIALOG(PROMPT,0),U,2)="0:"_OREFILLS
"RTN","ORCDPS1",188,0)
 S ORDIALOG(PROMPT,"A")="Refills (0-"_OREFILLS_"): "
"RTN","ORCDPS1",189,0)
 I X,X>OREFILLS S ORDIALOG(PROMPT,INST)=OREFILLS
"RTN","ORCDPS1",190,0)
 Q
"RTN","ORCDPS1",191,0)
 ;
"RTN","ORCDPS1",192,0)
ASKSC() ; -- Return 1 or 0, if SC prompt should be asked
"RTN","ORCDPS1",193,0)
 I $$SC^PSOCP(+ORVP,+$G(ORDRUG)) Q 0
"RTN","ORCDPS1",194,0)
 ;I $$RXST^IBARXEU(+ORVP)>0 Q 0 ;exempt from copay
"RTN","ORCDPS1",195,0)
 Q 1
"RTN","ORCDPS1",196,0)
 ;
"RTN","ORCDPS1",197,0)
PTR(X) ; -- Return ptr to prompt OR GTX X
"RTN","ORCDPS1",198,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"RTN","ORCDPS1",199,0)
 ;
"RTN","ORCDPS1",200,0)
EXIT ; -- exit action for Meds
"RTN","ORCDPS1",201,0)
 S:$G(ORXNP) ORNP=ORXNP
"RTN","ORCDPS1",202,0)
 K ORXNP,ORINPT,ORCAT,ORPKG,OROI,ORIV,ORDRUG,ORDOSE,OROUTE,ORSCH,ORSD,ORDSUP,OREFILLS,ORQTY,ORQTYUNT,ORCOPAY,PSJNOPC,ORCOMPLX
"RTN","ORCDPS1",203,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",204,0)
 Q
"RTN","ORCDPSIV")
0^84^B21933946
"RTN","ORCDPSIV",1,0)
ORCDPSIV ;SLC/MKB-Pharmacy IV dialog utilities ;11/25/02  09:47
"RTN","ORCDPSIV",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,38,48,158,195**;Dec 17, 1997
"RTN","ORCDPSIV",3,0)
PROVIDER ; -- Check provider, if authorized to write med orders
"RTN","ORCDPSIV",4,0)
 I $D(^XUSEC("OREMAS",DUZ)),'$$GET^XPAR("ALL","OR OREMAS MED ORDERS") W $C(7),!!,"OREMAS key holders may not enter medication orders." S ORQUIT=1 Q
"RTN","ORCDPSIV",5,0)
 N PS,NAME S PS=$G(^VA(200,+$G(ORNP),"PS")),NAME=$P($G(^(20)),U,2)
"RTN","ORCDPSIV",6,0)
 I '$L(NAME) S NAME=$P(^VA(200,+$G(ORNP),0),U)
"RTN","ORCDPSIV",7,0)
 I '$P(PS,U) W $C(7),!!,NAME_" is not authorized to write medication orders!" S ORQUIT=1
"RTN","ORCDPSIV",8,0)
 I $P(PS,U,4),$$NOW^XLFDT>$P(PS,U,4) W $C(7),!!,NAME_" is no longer authorized to write medication orders!" S ORQUIT=1
"RTN","ORCDPSIV",9,0)
 I $G(ORQUIT) W !,"You must select another provider to continue.",! S PS=$$MEDPROV I PS S ORXNP=ORNP,ORNP=PS K ORQUIT
"RTN","ORCDPSIV",10,0)
 Q
"RTN","ORCDPSIV",11,0)
 ;
"RTN","ORCDPSIV",12,0)
MEDPROV() ; -- Return ordering med provider
"RTN","ORCDPSIV",13,0)
 N X,Y,D,DIC
"RTN","ORCDPSIV",14,0)
 S DIC=200,DIC(0)="AEQ",DIC("A")="Select PROVIDER: ",D="AK.PROVIDER"
"RTN","ORCDPSIV",15,0)
 S DIC("S")="I $P($G(^(""PS"")),U),'$P(^(""PS""),U,4)!($P(^(""PS""),U,4)>$$NOW^XLFDT)"
"RTN","ORCDPSIV",16,0)
 D IX^DIC S:Y>0 Y=+Y I Y'>0 S Y="^"
"RTN","ORCDPSIV",17,0)
 Q Y
"RTN","ORCDPSIV",18,0)
 ;
"RTN","ORCDPSIV",19,0)
CHANGED(TYPE) ; -- Kill dependent values when OI changes
"RTN","ORCDPSIV",20,0)
 N PROMPTS,NAME,PTR,P,I
"RTN","ORCDPSIV",21,0)
 Q:'$L($G(TYPE))  S PROMPTS=""
"RTN","ORCDPSIV",22,0)
 S:TYPE="B" PROMPTS="VOLUME"
"RTN","ORCDPSIV",23,0)
 S:TYPE="A" PROMPTS="STRENGTH PSIV^UNITS"
"RTN","ORCDPSIV",24,0)
 F P=1:1:$L(PROMPTS,U) S NAME=$P(PROMPTS,U,P) D
"RTN","ORCDPSIV",25,0)
 . S PTR=$O(^ORD(101.41,"AB","OR GTX "_NAME,0)) Q:'PTR
"RTN","ORCDPSIV",26,0)
 . S I=0 F  S I=$O(ORDIALOG(PTR,I)) Q:I'>0  K ORDIALOG(PTR,I)
"RTN","ORCDPSIV",27,0)
 . K ORDIALOG(PTR,"LIST")
"RTN","ORCDPSIV",28,0)
 Q
"RTN","ORCDPSIV",29,0)
 ;
"RTN","ORCDPSIV",30,0)
INACTIVE(TYPE) ; -- Check OI inactive date
"RTN","ORCDPSIV",31,0)
 N OI,X,I,PSOI,DEA S:$G(TYPE)'="A" TYPE="S"
"RTN","ORCDPSIV",32,0)
 S OI=+$G(ORDIALOG(PROMPT,INST)) Q:OI'>0
"RTN","ORCDPSIV",33,0)
 I $G(^ORD(101.43,OI,.1)),^(.1)'>$$NOW^XLFDT D  Q  ;inactive
"RTN","ORCDPSIV",34,0)
 . S X=$S(TYPE="A":"additive",1:"solution"),ORQUIT=1
"RTN","ORCDPSIV",35,0)
 . W $C(7),!,"This "_X_" may not be ordered anymore.  Please select another."
"RTN","ORCDPSIV",36,0)
 S I=$S(TYPE="A":4,1:3) I '$P($G(^ORD(101.43,OI,"PS")),U,I) D  Q
"RTN","ORCDPSIV",37,0)
 . S X=$S(TYPE="A":"an additive",1:"a solution"),ORQUIT=1
"RTN","ORCDPSIV",38,0)
 . W $C(7),!,"This item may not be ordered as "_X_"."
"RTN","ORCDPSIV",39,0)
 Q:'$$INPT^ORCD  Q:'$L($T(IVDEA^PSSUTIL1))  ;DBIA #3784
"RTN","ORCDPSIV",40,0)
 S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2)
"RTN","ORCDPSIV",41,0)
 S DEA=$$IVDEA^PSSUTIL1(PSOI,TYPE) I DEA>0 D  Q:$G(ORQUIT)
"RTN","ORCDPSIV",42,0)
 . I $G(ORNP),'$L($P($G(^VA(200,+ORNP,"PS")),U,2)),'$L($P($G(^("PS")),U,3)) W $C(7),!,$P($G(^(0)),U)_" must have a DEA# or VA# to order this drug!" S ORQUIT=1 Q
"RTN","ORCDPSIV",43,0)
 . I DEA=1 W $C(7),!,"This order will require a wet signature!"
"RTN","ORCDPSIV",44,0)
 Q
"RTN","ORCDPSIV",45,0)
 ;
"RTN","ORCDPSIV",46,0)
VOLUME ; -- get allowable volumes for solution
"RTN","ORCDPSIV",47,0)
 N PSOI,ORY,CNT,I K ORDIALOG(PROMPT,"LIST")
"RTN","ORCDPSIV",48,0)
 S PSOI=+$P($G(^ORD(101.43,+$$VAL^ORCD("SOLUTION",INST),0)),U,2)_"B"
"RTN","ORCDPSIV",49,0)
 D ENVOL^PSJORUT2(PSOI,.ORY) Q:'ORY
"RTN","ORCDPSIV",50,0)
 S (I,CNT)=0 F  S I=$O(ORY(I)) Q:I'>0  S CNT=CNT+1,ORDIALOG(PROMPT,"LIST",+ORY(I))=+ORY(I)
"RTN","ORCDPSIV",51,0)
 S ORDIALOG(PROMPT,"LIST")=CNT_"^1"
"RTN","ORCDPSIV",52,0)
 Q
"RTN","ORCDPSIV",53,0)
 ;
"RTN","ORCDPSIV",54,0)
UNITS ; -- get allowable units for current additive
"RTN","ORCDPSIV",55,0)
 N PSOI,ORY,I,UNITS
"RTN","ORCDPSIV",56,0)
 S PSOI=+$P(^ORD(101.43,+ORDIALOG($$PTR^ORCD("OR GTX ADDITIVE"),INST),0),U,2)_"A"
"RTN","ORCDPSIV",57,0)
 D ENVOL^PSJORUT2(PSOI,.ORY)
"RTN","ORCDPSIV",58,0)
 S I=$O(ORY(0)) Q:'I  S UNITS=$P($G(ORY(I)),U,2)
"RTN","ORCDPSIV",59,0)
 S ORDIALOG($$PTR^ORCD("OR GTX UNITS"),INST)=UNITS
"RTN","ORCDPSIV",60,0)
 W !," (Units for this additive are "_UNITS_")"
"RTN","ORCDPSIV",61,0)
 Q
"RTN","ORCDPSIV",62,0)
 ;
"RTN","ORCDPSIV",63,0)
PREMIX() ; -- Returns 1 or 0, if IV base is a premix solution
"RTN","ORCDPSIV",64,0)
 N BASE,PS,I,Y
"RTN","ORCDPSIV",65,0)
 S BASE=$$PTR^ORCD("OR GTX ORDERABLE ITEM"),Y=0
"RTN","ORCDPSIV",66,0)
 S I=0 F  S I=$O(ORDIALOG(BASE,I)) Q:I'>0  D  Q:Y
"RTN","ORCDPSIV",67,0)
 . S PS=$G(^ORD(101.43,+$G(ORDIALOG(BASE,I)),"PS"))
"RTN","ORCDPSIV",68,0)
 . I $P(PS,U,3)&($P(PS,U,4)) S Y=1
"RTN","ORCDPSIV",69,0)
 Q Y
"RTN","ORCDPSIV",70,0)
 ;
"RTN","ORCDPSIV",71,0)
VALIDAYS(X) ; -- Validate IV duration
"RTN","ORCDPSIV",72,0)
 N UNITS,X1,X2,Y,I
"RTN","ORCDPSIV",73,0)
 I X'?1.N." "1.A Q 0 ; invalid format
"RTN","ORCDPSIV",74,0)
 S UNITS="^MIN^HOURS^DAYS^M^H^D^",(X1,X2)=""
"RTN","ORCDPSIV",75,0)
 F I=1:1:$L(X) S Y=$E(X,I) S:Y?1N X1=X1_Y S:Y?1A X2=X2_$$UP^XLFSTR(Y)
"RTN","ORCDPSIV",76,0)
 I 'X1 Q 0
"RTN","ORCDPSIV",77,0)
 I UNITS'[(U_X2_U) Q 0
"RTN","ORCDPSIV",78,0)
 Q 1
"RTN","ORCDPSIV",79,0)
 ;
"RTN","ORCDPSIV",80,0)
VALDURA(X) ;-- Validate IV duration/limitation
"RTN","ORCDPSIV",81,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","ORCDPSIV",82,0)
 ;
"RTN","ORCDPSIV",83,0)
IVPSI ;INPUT-TRANSFORM
"RTN","ORCDPSIV",84,0)
 I $L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) S X="" Q
"RTN","ORCDPSIV",85,0)
 S X=$$UP^XLFSTR(X)
"RTN","ORCDPSIV",86,0)
 I (X'?.N1.2A),(X'?.N1".".N1.2A) W !,!,"Invalid duration or total volume.",! S X="" Q
"RTN","ORCDPSIV",87,0)
 I (X?.N1A) D
"RTN","ORCDPSIV",88,0)
 . I (X["L")!(X["H")!(X["D") Q
"RTN","ORCDPSIV",89,0)
 . E  W !,!,"Invalid duration or total volume.",! S X="" Q
"RTN","ORCDPSIV",90,0)
 I (X?.N1".".N1A) D
"RTN","ORCDPSIV",91,0)
 . I X["L" Q
"RTN","ORCDPSIV",92,0)
 . E  W !,!,"Invalid duration or total volume.",!,"Duration has to be integer value!",! S X="" Q
"RTN","ORCDPSIV",93,0)
 I (X?.N2A)!(X?.N1".".N2A) D
"RTN","ORCDPSIV",94,0)
 . I (X["ML")!(X["CC") Q
"RTN","ORCDPSIV",95,0)
 . E  W !,!,"Invalid duration or total volume",! S X="" Q
"RTN","ORCDPSIV",96,0)
 I X="" K X
"RTN","ORCDPSIV",97,0)
 Q
"RTN","ORCDPSIV",98,0)
 ;
"RTN","ORCDPSIV",99,0)
IVPSI1 ; ASK ON CONDITION
"RTN","ORCDPSIV",100,0)
 W !,!,"Enter the length of administrative time or total volume for IV fluid order followed by ML or CC for milliliters, L for liters, D for days, H for hours to set limitation."
"RTN","ORCDPSIV",101,0)
 W !,"(Examples: 1500ML, 1000CC, 1.5L, 3D, or 72H)",!
"RTN","ORCDPSIV",102,0)
 Q
"RTN","ORCMED")
0^4^B41444759
"RTN","ORCMED",1,0)
ORCMED ;SLC/MKB-Medication actions ;4/2/02  16:45
"RTN","ORCMED",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,7,38,48,94,141,178,190,195**;Dec 17, 1997
"RTN","ORCMED",3,0)
XFER ; -- transfer to in/outpt meds
"RTN","ORCMED",4,0)
 N ORPTLK,ORTYPE,ORXFER,ORSRC,ORCAT,OREVENT,X,ORINPT,ORIDLG,ORODLG,ORIVDLG,ORNMSP,ORCNT,ORI,NMBR,ORIFN,OLDIFN,ORDIALOG,ORDG,ORCHECK,ORQUIT,ORDUZ,ORLOG,FIRST,ORDITM,ORD,ORERR
"RTN","ORCMED",5,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK D  G XFQ ; lock pt chart
"RTN","ORCMED",6,0)
 . W !!,$C(7),$P(ORPTLK,U,2) H 2
"RTN","ORCMED",7,0)
 . S:'$D(VALMBCK) VALMBCK=""
"RTN","ORCMED",8,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("transfer") G:'ORNMBR XFQ
"RTN","ORCMED",9,0)
 D FULL^VALM1 S VALMBCK="R",ORTYPE="Q",ORXFER=1,ORDUZ=DUZ,ORSRC="X"
"RTN","ORCMED",10,0)
 S X=$P($P($G(^TMP("OR",$J,"CURRENT",0)),U,3),";",3) S:X="" X=$G(ORWARD)
"RTN","ORCMED",11,0)
 S ORCAT=$S(X:"O",1:"I") I ORCAT="I"!$G(ORWARD) D  Q:$G(OREVENT)="^"
"RTN","ORCMED",12,0)
 . W !!,$$CURRENT^OREVNT
"RTN","ORCMED",13,0)
 . S X=$$DELAY^ORCACT I X="^" S OREVENT="^" Q
"RTN","ORCMED",14,0)
 . S:X OREVENT=+$$PTEVENT^OREVNT(+ORVP,1)
"RTN","ORCMED",15,0)
 I '$G(ORL) S ORL=$S($G(OREVENT):$$LOC^OREVNTX(OREVENT),1:$$LOCATION^ORCMENU1) G:ORL="^" XFQ
"RTN","ORCMED",16,0)
 S ORINPT=$$INPT^ORCD,ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" XFQ
"RTN","ORCMED",17,0)
 I 'ORINPT,ORCAT="I" D IMOLOC^ORIMO(.ORINPT,+ORL,+ORVP) S:ORINPT<0 ORINPT=0 ;allow inpt meds at this location?
"RTN","ORCMED",18,0)
 S ORIDLG=+$O(^ORD(101.41,"AB","PSJ OR PAT OE",0))
"RTN","ORCMED",19,0)
 S ORODLG=+$O(^ORD(101.41,"AB","PSO OERR",0))
"RTN","ORCMED",20,0)
 S ORIVDLG=+$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORCMED",21,0)
 D PROVIDER^ORCDPSIV G:$G(ORQUIT) XFQ ;X:$D(^ORD(101.41,ORDIALOG,3)) ^(3)
"RTN","ORCMED",22,0)
 S ORNMSP="PS" D DISPLAY^ORCHECK
"RTN","ORCMED",23,0)
 S ORCNT=$L(ORNMBR,",") S:$P(ORNMBR,",",ORCNT)'>0 ORCNT=ORCNT-1
"RTN","ORCMED",24,0)
XF1 F ORI=1:1:ORCNT S NMBR=$P(ORNMBR,",",ORI) D:NMBR  I $D(ORQUIT),ORI<ORCNT Q:'$$CONT  ;if not last one, ask
"RTN","ORCMED",25,0)
 . K ORIFN,ORDIALOG,ORDG,ORDOSE,ORCHECK,ORQUIT,ORERR
"RTN","ORCMED",26,0)
 . K ^TMP("PSJMR",$J),^TMP("ORWORD",$J),^TMP("ORSIG",$J)
"RTN","ORCMED",27,0)
 . S OLDIFN=+$P($G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),U,4)
"RTN","ORCMED",28,0)
 . S ORDITM=$$ORDITEM^ORCACT(OLDIFN) D SUBHDR^ORCACT(ORDITM)
"RTN","ORCMED",29,0)
 . I '$$VALID^ORCACT0(OLDIFN,"XFR",.ORERR) W !,ORERR H 2 Q
"RTN","ORCMED",30,0)
 . S ORD=$P($G(^OR(100,OLDIFN,0)),U,5) Q:ORD'["101.41"  ;error msg?
"RTN","ORCMED",31,0)
 . S ORDIALOG=$S(+ORD=ORIVDLG:ORIVDLG,ORCAT="I":ORIDLG,1:ORODLG)
"RTN","ORCMED",32,0)
 . S ORDG=+$P($G(^ORD(101.41,ORDIALOG,0)),U,5)
"RTN","ORCMED",33,0)
 . D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD(OLDIFN)
"RTN","ORCMED",34,0)
 . I ORDIALOG'=ORIVDLG D OUT:ORCAT="I",IN:ORCAT="O" ;convert data
"RTN","ORCMED",35,0)
 . K ORDIALOG($$PTR^ORCD("OR GTX START DATE/TIME"),1)
"RTN","ORCMED",36,0)
 . K ORDIALOG($$PTR^ORCD("OR GTX NOW"),1)
"RTN","ORCMED",37,0)
 . S ORLOG=+$E($$NOW^XLFDT,1,12),FIRST=1
"RTN","ORCMED",38,0)
XF2 . D DIALOG^ORCDLG Q:$G(ORQUIT)&FIRST  K ORQUIT
"RTN","ORCMED",39,0)
 . D ACCEPT^ORCHECK(),DISPLAY^ORCDLG S X=$$OK^ORCDLG I X="^" S ORQUIT=1 Q
"RTN","ORCMED",40,0)
 . I X="E" K ORCHECK S FIRST=0 G XF2
"RTN","ORCMED",41,0)
 . I X="C" W !?10,"... order cancelled.",! Q
"RTN","ORCMED",42,0)
 . I X="P" D
"RTN","ORCMED",43,0)
 . . D EN^ORCSAVE W !?10,$S(ORIFN:"... order placed.",1:"ERROR"),!
"RTN","ORCMED",44,0)
 . . S:$G(ORIFN) ^TMP("ORNEW",$J,ORIFN,1)=""
"RTN","ORCMED",45,0)
 . . I '$D(^TMP("ORECALL",$J,ORDIALOG)) M ^(ORDIALOG)=ORDIALOG M:$D(^TMP("ORWORD",$J)) ^TMP("ORECALL",$J,ORDIALOG)=^TMP("ORWORD",$J) ;save 1st values
"RTN","ORCMED",46,0)
XFQ D EXIT^ORCDPS1 ;X:$D(^ORD(101.41,ORDIALOG,4)) ^(4)
"RTN","ORCMED",47,0)
 K ^TMP("ORWORD",$J),^TMP("ORSIG",$J)
"RTN","ORCMED",48,0)
 D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) ;unlock if no new orders
"RTN","ORCMED",49,0)
 Q
"RTN","ORCMED",50,0)
 ;
"RTN","ORCMED",51,0)
IN ; -- Kill extra values, Reset ID's/DD from Inpt dialog
"RTN","ORCMED",52,0)
 N P F P="START DATE/TIME","NOW" K ORDIALOG($$PTR(P),1)
"RTN","ORCMED",53,0)
 D DOSES("O")
"RTN","ORCMED",54,0)
 Q
"RTN","ORCMED",55,0)
 ;
"RTN","ORCMED",56,0)
OUT ; -- Kill extra values, Reset ID's/DD from Outpt dialog
"RTN","ORCMED",57,0)
 N P I '$O(ORDIALOG($$PTR("INSTRUCTIONS"),0)) D  ;old sig in comments
"RTN","ORCMED",58,0)
 . N WP S WP=$$PTR("WORD PROCESSING 1") K ^TMP("ORSIG",$J)
"RTN","ORCMED",59,0)
 . M ^TMP("ORSIG",$J)=^TMP("ORWORD",$J,WP,1)
"RTN","ORCMED",60,0)
 . K ORDIALOG(WP,1),^TMP("ORWORD",$J,WP,1)
"RTN","ORCMED",61,0)
 F P="PATIENT INSTRUCTIONS","START DATE/TIME","DAYS SUPPLY","QUANTITY","REFILLS","ROUTING","SERVICE CONNECTED" K ORDIALOG($$PTR(P),1)
"RTN","ORCMED",62,0)
 I $G(ORDIALOG($$PTR("URGENCY"),1))=99 K ORDIALOG($$PTR("URGENCY"),1)
"RTN","ORCMED",63,0)
 D DOSES("I")
"RTN","ORCMED",64,0)
 Q
"RTN","ORCMED",65,0)
 ;
"RTN","ORCMED",66,0)
DOSES(TYPE)     ; -- Convert doses to new TYPE, reset ID strings
"RTN","ORCMED",67,0)
 N PSOI,ORMED,PROMPT,DOSE,DRUG,I,X,DD,DRUG0,STR
"RTN","ORCMED",68,0)
 F I="DISPENSE DRUG","STRENGTH","DRUG NAME","SIG" K ORDIALOG($$PTR(I),1)
"RTN","ORCMED",69,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(ORDIALOG($$PTR("ORDERABLE ITEM"),1)),0)),U,2),ORMED=$P($G(^(0)),U)
"RTN","ORCMED",70,0)
 D DOSE^PSSORUTL(.ORDOSE,PSOI,TYPE,+ORVP) I $G(ORDOSE(1))=-1 K ORDOSE
"RTN","ORCMED",71,0)
 S PROMPT=$$PTR("INSTRUCTIONS"),DOSE=$$PTR("DOSE")
"RTN","ORCMED",72,0)
 S DRUG=$$PTR("DISPENSE DRUG") D D1^ORCDPS2
"RTN","ORCMED",73,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  D
"RTN","ORCMED",74,0)
 . K ORDIALOG(DOSE,I) S X=$G(ORDIALOG(PROMPT,I)) Q:'$L(X)
"RTN","ORCMED",75,0)
 . S X=$$UP^XLFSTR(X),DD=+$G(ORDIALOG(PROMPT,"LIST","D",X)) Q:'DD
"RTN","ORCMED",76,0)
 . S ORDIALOG(DOSE,I)=$TR($G(ORDOSE("DD",DD,X)),"^","&")
"RTN","ORCMED",77,0)
 . S ORDIALOG(DRUG,I)=DD,DRUG0=$G(ORDOSE("DD",DD))
"RTN","ORCMED",78,0)
 . S STR=$P(DRUG0,U,5)_$P(DRUG0,U,6)
"RTN","ORCMED",79,0)
 . I STR'>0 S:'$G(ORDOSE(1)) ORDIALOG($$PTR("DRUG NAME"),1)=$P(DRUG0,U) Q
"RTN","ORCMED",80,0)
 . I ORMED'[STR,TYPE="O"!'$G(ORDOSE(1)) S ORDIALOG($$PTR("STRENGTH"),1)=STR
"RTN","ORCMED",81,0)
 Q
"RTN","ORCMED",82,0)
 ;
"RTN","ORCMED",83,0)
CONT() ; -- Want to continue processing orders?
"RTN","ORCMED",84,0)
 N X,Y,DIR
"RTN","ORCMED",85,0)
 S DIR(0)="YA",DIR("A")="Do you want to continue transferring orders? ",DIR("B")="YES"
"RTN","ORCMED",86,0)
 S DIR("?")="Enter YES to continue transferring the remaining orders selected, or NO to quit this option."
"RTN","ORCMED",87,0)
 D ^DIR
"RTN","ORCMED",88,0)
 Q +Y
"RTN","ORCMED",89,0)
 ;
"RTN","ORCMED",90,0)
SHOWSIG ; -- Show old sig for transfer in ^TMP("ORSIG",$J)
"RTN","ORCMED",91,0)
 N ORTX,I,X,ORMAX S ORMAX=72
"RTN","ORCMED",92,0)
 S I=0 F  S I=$O(^TMP("ORSIG",$J,I)) Q:I'>0  S X=$G(^(I,0)) D:$L(X) TXT^ORCHTAB
"RTN","ORCMED",93,0)
 S I=0 F  S I=$O(ORTX(I)) Q:I'>0  W !,$S(I=1:"(Sig: ",1:"      ")_ORTX(I)
"RTN","ORCMED",94,0)
 W ")"
"RTN","ORCMED",95,0)
 Q
"RTN","ORCMED",96,0)
 ;
"RTN","ORCMED",97,0)
PTR(NAME) ; -- Returns pointer to OR GTX NAME
"RTN","ORCMED",98,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORCMED",99,0)
 ;
"RTN","ORCMED",100,0)
REFILLS ; -- Request a refill for med orders
"RTN","ORCMED",101,0)
 ;    ORNMBR = #,#,...,# of selected orders
"RTN","ORCMED",102,0)
 ;
"RTN","ORCMED",103,0)
 N ORLK,ORI,NMBR,IDX,ORIFN,ORDITM,ORERR,ORQUIT,OROUT
"RTN","ORCMED",104,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") G:'ORNMBR RFQ
"RTN","ORCMED",105,0)
 D FREEZE^ORCMENU S VALMBCK="R"
"RTN","ORCMED",106,0)
 S ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" RFQ
"RTN","ORCMED",107,0)
 S:'$G(ORL) ORL=$$LOCATION^ORCMENU1 G:ORL="^" RFQ
"RTN","ORCMED",108,0)
 S OROUT=$$ROUTING G:OROUT="^" RFQ
"RTN","ORCMED",109,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCMED",110,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR)),ORIFN=+$P(IDX,U,4)
"RTN","ORCMED",111,0)
 . Q:'ORIFN  I '$D(^OR(100,ORIFN,0)) W !,"Invalid order number!" H 2 Q
"RTN","ORCMED",112,0)
 . S ORDITM=$$ORDITEM^ORCACT(ORIFN) D SUBHDR^ORCACT(ORDITM)
"RTN","ORCMED",113,0)
 . I '$$VALID^ORCACT0(ORIFN,"RF",.ORERR) W !,ORERR H 2 Q
"RTN","ORCMED",114,0)
 . S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK W !,$P(ORLK,U,2) H 2 Q
"RTN","ORCMED",115,0)
 . D REF^ORMBLDPS(ORIFN,OROUT),UNLK1^ORX2(+ORIFN)
"RTN","ORCMED",116,0)
 . W !?10,"... refill requested.",$$RETURN
"RTN","ORCMED",117,0)
RFQ Q
"RTN","ORCMED",118,0)
 ;
"RTN","ORCMED",119,0)
RETURN() ; -- press return to cont
"RTN","ORCMED",120,0)
 N X W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCMED",121,0)
 Q ""
"RTN","ORCMED",122,0)
 ;
"RTN","ORCMED",123,0)
ROUTING() ; -- Routing for refill
"RTN","ORCMED",124,0)
 N X,Y,DIR S DIR(0)="SAM^W:WINDOW;M:MAIL;C:ADMINISTERED IN CLINIC;"
"RTN","ORCMED",125,0)
 S DIR("A")="Routing: ",DIR("B")=$S($D(^PSX(550,"C")):"MAIL",1:"WINDOW")
"RTN","ORCMED",126,0)
 S DIR("?")="Select how the patient is to receive this refill, by mail or at the window or in the clinic"
"RTN","ORCMED",127,0)
 D ^DIR S:$D(DTOUT)!(X["^") Y="^"
"RTN","ORCMED",128,0)
 Q Y
"RTN","ORCMED",129,0)
 ;
"RTN","ORCMED",130,0)
NW ; -- Order New Medication from Meds tab
"RTN","ORCMED",131,0)
 ;    Requires ORDIALOG      = name of pkg dialog
"RTN","ORCMED",132,0)
 ;             OREVENT       = event, if delaying orders
"RTN","ORCMED",133,0)
 ;             OREVENT("TS") = treating spec, if admission or transfer
"RTN","ORCMED",134,0)
 N ORPTLK G:'$L($G(ORDIALOG)) NWQ
"RTN","ORCMED",135,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q
"RTN","ORCMED",136,0)
 D FREEZE^ORCMENU S VALMBCK="R"
"RTN","ORCMED",137,0)
 S ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" NWQ
"RTN","ORCMED",138,0)
 I '$G(ORL) S ORL=$S($G(OREVENT):$$LOC^OREVNTX(OREVENT),1:$$LOCATION^ORCMENU1) G:ORL["^" NWQ
"RTN","ORCMED",139,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",$E(ORDIALOG,1,63),0)) G:'ORDIALOG NWQ
"RTN","ORCMED",140,0)
 D ADD^ORCDLG,REBLD^ORCMENU:$D(^TMP("ORNEW",$J))
"RTN","ORCMED",141,0)
 K ORDIALOG,^TMP("ORWORD",$J),^TMP("ORECALL",$J) S VALMBCK="R"
"RTN","ORCMED",142,0)
NWQ D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) ;unlock if no new orders
"RTN","ORCMED",143,0)
 Q
"RTN","ORCSAVE")
0^2^B69137965
"RTN","ORCSAVE",1,0)
ORCSAVE ;SLC/MKB/JDL-Save ;9/13/04  14:05
"RTN","ORCSAVE",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,56,70,73,92,94,116,141,163,187,190,195**;Dec 17, 1997
"RTN","ORCSAVE",3,0)
NEW(ORDIALOG,ORDG,ORPKG,ORCAT,OREVENT,ORDUZ,ORLOG) ; -- New order
"RTN","ORCSAVE",4,0)
 ; Returns ORIFN = [new] order number, if created/saved
"RTN","ORCSAVE",5,0)
 D EN
"RTN","ORCSAVE",6,0)
 Q
"RTN","ORCSAVE",7,0)
 ;
"RTN","ORCSAVE",8,0)
XX ; -- save new/unreleased edited order into Orders file
"RTN","ORCSAVE",9,0)
 ;    Requires: ORDIALOG() = array of dialog values
"RTN","ORCSAVE",10,0)
 ;              ORIFN      = IFN of original order that was edited
"RTN","ORCSAVE",11,0)
 ;  
"RTN","ORCSAVE",12,0)
 N OLDIFN S ORIFN=+ORIFN,OLDIFN=0
"RTN","ORCSAVE",13,0)
 I $S($P(^OR(100,ORIFN,3),U,3)=11:0,$P(^(3),U,3)'=10:1,$P(^(8,1,0),U,4)=2:0,1:1) S OLDIFN=ORIFN K ORIFN ; create new order if released or delayed&signed
"RTN","ORCSAVE",14,0)
 D EN Q:'ORIFN  S:'$G(ORDA) ORDA=1
"RTN","ORCSAVE",15,0)
 I $G(OLDIFN) D  ;save links between orders
"RTN","ORCSAVE",16,0)
 . S $P(^OR(100,ORIFN,3),U,5)=OLDIFN,$P(^(3),U,11)=1
"RTN","ORCSAVE",17,0)
 . S $P(^OR(100,OLDIFN,3),U,6)=ORIFN S:$D(^(5)) ^OR(100,ORIFN,5)=^OR(100,OLDIFN,5)
"RTN","ORCSAVE",18,0)
 I $D(^OR(100,+OLDIFN,0)) D
"RTN","ORCSAVE",19,0)
 . Q:'$G(OREVTDF)
"RTN","ORCSAVE",20,0)
 . N OLDEVT,OLDSTS,LSTACT,PATID,NOW,WHEN
"RTN","ORCSAVE",21,0)
 . S (OLDEVT,OLDSTS,LSTACT)=0
"RTN","ORCSAVE",22,0)
 . S NOW=$$NOW^XLFDT
"RTN","ORCSAVE",23,0)
 . S OLDEVT=$P(^(0),U,17),OLDSTS=$P(^(3),U,3)
"RTN","ORCSAVE",24,0)
 . ; Active status = 6 from #100.01
"RTN","ORCSAVE",25,0)
 . I (OLDEVT>0),OLDSTS=6 D
"RTN","ORCSAVE",26,0)
 . . S $P(^OR(100,+ORIFN,0),U,17)=OLDEVT
"RTN","ORCSAVE",27,0)
 . . S $P(^OR(100,+ORIFN,3),U,3)=11
"RTN","ORCSAVE",28,0)
 . . S LSTACT=$P($G(^OR(100,+ORIFN,3)),U,7)
"RTN","ORCSAVE",29,0)
 . . I $D(^OR(100,+ORIFN,8,LSTACT,0)) D
"RTN","ORCSAVE",30,0)
 . . . S $P(^OR(100,+ORIFN,8,LSTACT,0),U,15)=11
"RTN","ORCSAVE",31,0)
 . . . S PATID=$P(^OR(100,+ORIFN,0),U,2)
"RTN","ORCSAVE",32,0)
 . . . S WHEN=$P(^OR(100,+ORIFN,8,LSTACT,0),U)
"RTN","ORCSAVE",33,0)
 . . . S ^OR(100,"AC",PATID,9999999-WHEN,+ORIFN,LSTACT)=""
"RTN","ORCSAVE",34,0)
 Q
"RTN","ORCSAVE",35,0)
 ;
"RTN","ORCSAVE",36,0)
RN ; -- save new/unreleased renewal order into Orders file
"RTN","ORCSAVE",37,0)
 ;    Requires: ORDIALOG() = array of new dialog values
"RTN","ORCSAVE",38,0)
 ;              ORIFN      = IFN of original order that was renewed
"RTN","ORCSAVE",39,0)
 ; 
"RTN","ORCSAVE",40,0)
 N OLDIFN S OLDIFN=+ORIFN K ORIFN
"RTN","ORCSAVE",41,0)
 D EN Q:'ORIFN  S:'$G(ORDA) ORDA=1
"RTN","ORCSAVE",42,0)
 S $P(^OR(100,ORIFN,3),U,5)=OLDIFN,$P(^(3),U,11)=2
"RTN","ORCSAVE",43,0)
 S $P(^OR(100,OLDIFN,3),U,6)=ORIFN S:$D(^(5)) ^OR(100,ORIFN,5)=^OR(100,OLDIFN,5)
"RTN","ORCSAVE",44,0)
 Q
"RTN","ORCSAVE",45,0)
 ;
"RTN","ORCSAVE",46,0)
EN ; -- save new/unreleased order in ORDIALOG() into Orders file
"RTN","ORCSAVE",47,0)
 ;    Requires: ORVP, ORNP [and ORL, ORTS, ORAPPT if available]
"RTN","ORCSAVE",48,0)
 ;    If defined: ORCAT,ORPKG,ORDG,ORLOG,ORDUZ,OREVENT,ORDCNTRL,ORSRC
"RTN","ORCSAVE",49,0)
 ;     (else use values from ORDIALOG and current state)
"RTN","ORCSAVE",50,0)
 ;
"RTN","ORCSAVE",51,0)
 N PKG,NOW,NODE,CNT,CDL,I,X,STS,SIGNREQD,LOC,TRSPEC,NATR,CATG,DG,LOG,USR,TYPE
"RTN","ORCSAVE",52,0)
 Q:'$G(ORVP)  Q:'$G(ORDIALOG)  Q:'$D(^ORD(101.41,+ORDIALOG,0))
"RTN","ORCSAVE",53,0)
 S NOW=$$NOW^XLFDT,SIGNREQD=+$P(^ORD(101.41,+ORDIALOG,0),U,6)
"RTN","ORCSAVE",54,0)
 S CATG=$S($L($G(ORCAT)):ORCAT,1:$S($$INPT^ORCD:"I",1:"O"))
"RTN","ORCSAVE",55,0)
 S PKG=$S($G(ORPKG):ORPKG,1:$P(^ORD(101.41,+ORDIALOG,0),U,7))
"RTN","ORCSAVE",56,0)
 I $G(ORIFN),$D(^OR(100,ORIFN,0)) S STS=$P(^(3),U,3) G EN2 ; unrel order
"RTN","ORCSAVE",57,0)
 S DG=$S($G(ORDG):+ORDG,1:$P(^ORD(101.41,+ORDIALOG,0),U,5))
"RTN","ORCSAVE",58,0)
 I $G(OREVENT),$$GET1^DIQ(9.4,+PKG_",",1)'="PSO",'$G(DGPMT) S LOC="",TRSPEC="" ;195
"RTN","ORCSAVE",59,0)
 E  S LOC=$G(ORL),TRSPEC=$G(ORTS)
"RTN","ORCSAVE",60,0)
 S TYPE=$S("^B^C^X^P^0^"[(U_$G(ORSRC)_U):ORSRC,$G(ORDCNTRL)="SN":"P",1:0)
"RTN","ORCSAVE",61,0)
 S LOG=$S($G(ORLOG):ORLOG,1:+$E(NOW,1,12)),USR=$S($G(ORDUZ):ORDUZ,1:DUZ)
"RTN","ORCSAVE",62,0)
 S NATR=+$O(^ORD(100.02,"C","E",0)) ;assume Elec Entered until changed
"RTN","ORCSAVE",63,0)
 S STS=$S($G(OREVENT):10,1:11),ORIFN=$$NEXTIFN Q:'ORIFN
"RTN","ORCSAVE",64,0)
EN1 S ^OR(100,ORIFN,0)=ORIFN_U_ORVP_U_U_$G(ORNP)_U_+ORDIALOG_";ORD(101.41,^"_USR_U_LOG_U_U_U_LOC_U_DG_U_CATG_U_TRSPEC_U_PKG_U_U_SIGNREQD_U_$G(OREVENT)_U_$G(ORAPPT)
"RTN","ORCSAVE",65,0)
 S ^OR(100,ORIFN,3)=LOG_"^90^"_STS_U_$S($G(ORIT):ORIT_";ORD(101.41,",1:"")_U_$G(ORDIALOG("PREV"))_"^^1^^^^"_TYPE
"RTN","ORCSAVE",66,0)
 S ^OR(100,ORIFN,8,0)="^100.008DA^1^1",^OR(100,ORIFN,8,1,0)=LOG_"^NW^"_$G(ORNP)_U_$S(SIGNREQD:2,1:3)_"^^^^^^^^"_NATR_U_USR_"^1^"_STS,^OR(100,ORIFN,8,"C","NW",1)=""
"RTN","ORCSAVE",67,0)
 S ^OR(100,"AF",LOG,ORIFN,1)=""
"RTN","ORCSAVE",68,0)
 S ^OR(100,"ACT",ORVP,9999999-LOG,+DG,ORIFN,1)=""
"RTN","ORCSAVE",69,0)
 S:STS'=10 ^OR(100,"AC",ORVP,9999999-LOG,ORIFN,1)=""
"RTN","ORCSAVE",70,0)
 S:SIGNREQD ^OR(100,"AS",ORVP,9999999-LOG,ORIFN,1)=""
"RTN","ORCSAVE",71,0)
 S:$G(OREVENT) ^OR(100,"AEVNT",ORVP,OREVENT,ORIFN)=""
"RTN","ORCSAVE",72,0)
EN2 S ORIFN=+ORIFN D RESPONSE ; save responses
"RTN","ORCSAVE",73,0)
 I $P(^OR(100,ORIFN,0),"^",5) D  ;Copy orders PKI fix
"RTN","ORCSAVE",74,0)
 . N OI
"RTN","ORCSAVE",75,0)
 . S OI=+$O(^OR(100,ORIFN,4.5,"ID","ORDERABLE",0)),OI=+$G(^OR(100,ORIFN,4.5,OI,1)) Q:'OI
"RTN","ORCSAVE",76,0)
 . I PKG'=$O(^DIC(9.4,"B","OUTPATIENT PHARMACY",0)) Q
"RTN","ORCSAVE",77,0)
 . D PKI^ORWDPS1(.ORY,OI,CATG,+ORVP,$$GET^XPAR("ALL^USR.`"_DUZ,"ORWOR PKI USE",1,"Q"))
"RTN","ORCSAVE",78,0)
 . I $E($G(ORY))=2 S ORDEA=ORY
"RTN","ORCSAVE",79,0)
 K ^OR(100,ORIFN,8,1,.1) D ORDTEXT^ORCSAVE1(ORIFN_";1") ; order text
"RTN","ORCSAVE",80,0)
 S NODE=$G(^OR(100,ORIFN,0)) D  S ^OR(100,ORIFN,0)=NODE
"RTN","ORCSAVE",81,0)
 . S $P(NODE,U,4)=$G(ORNP) ; COST?
"RTN","ORCSAVE",82,0)
 . S I=$O(^OR(100,ORIFN,4.5,"ID","LOCATION",0))
"RTN","ORCSAVE",83,0)
 . I I,$P(NODE,U,10) S X=+$G(^OR(100,ORIFN,4.5,+I,1)) S:X $P(NODE,U,10)=X_";SC(" ;reset Loc if prev value
"RTN","ORCSAVE",84,0)
 . S I=$O(^OR(100,ORIFN,4.5,"ID","CLASS",0))
"RTN","ORCSAVE",85,0)
 . I I S X=$G(^OR(100,ORIFN,4.5,+I,1)) S:"^I^O^"[(U_X_U) $P(NODE,U,12)=X
"RTN","ORCSAVE",86,0)
 S $P(^OR(100,ORIFN,3),U)=NOW
"RTN","ORCSAVE",87,0)
 K ^OR(100,ORIFN,9) I $G(ORCHECK) D  ; save order checks
"RTN","ORCSAVE",88,0)
 . S (CNT,CDL)=0 F  S CDL=$O(ORCHECK("NEW",CDL)) Q:CDL'>0  S I=0 D
"RTN","ORCSAVE",89,0)
 . . F  S I=$O(ORCHECK("NEW",CDL,I)) Q:I'>0  S X=ORCHECK("NEW",CDL,I) D
"RTN","ORCSAVE",90,0)
 . . . S CNT=CNT+1,^OR(100,ORIFN,9,"B",+X,CNT)=""
"RTN","ORCSAVE",91,0)
 . . . S ^OR(100,ORIFN,9,CNT,0)=$P(X,U,1,2),^(1)=$E($P(X,U,3),1,245)
"RTN","ORCSAVE",92,0)
 . S:CNT ^OR(100,ORIFN,9,0)="^100.09PA^"_CNT_U_CNT
"RTN","ORCSAVE",93,0)
 K ORDEA
"RTN","ORCSAVE",94,0)
ENQ Q
"RTN","ORCSAVE",95,0)
 ;
"RTN","ORCSAVE",96,0)
NEXTIFN() ; -- Returns next available ORIFN
"RTN","ORCSAVE",97,0)
 N I,HDR,LAST,TOTAL,DA
"RTN","ORCSAVE",98,0)
 F I=1:1:10 L +^OR(100,0):1 Q:$T  H 2
"RTN","ORCSAVE",99,0)
 I '$T Q "^"
"RTN","ORCSAVE",100,0)
 S HDR=$G(^OR(100,0)),TOTAL=+$P(HDR,U,4),LAST=$O(^OR(100,"?"),-1)
"RTN","ORCSAVE",101,0)
 S I=LAST\1 F I=(I+1):1 Q:'$D(^OR(100,I,0))
"RTN","ORCSAVE",102,0)
 S DA=I,^OR(100,DA,0)=DA,$P(HDR,U,3,4)=DA_U_(TOTAL+1)
"RTN","ORCSAVE",103,0)
 S ^OR(100,0)=HDR L -^OR(100,0)
"RTN","ORCSAVE",104,0)
 Q DA
"RTN","ORCSAVE",105,0)
 ;
"RTN","ORCSAVE",106,0)
RESPONSE ; -- Save responses in ORDIALOG() into ^OR(100,ORIFN,4.5)
"RTN","ORCSAVE",107,0)
 N PROMPT,CNT,ITM,TYPE,INST,VALUE,I,START,PAT,X
"RTN","ORCSAVE",108,0)
 S PAT=$P(^OR(100,ORIFN,0),U,2),START=$P(^(0),U,8) K ^(4.5)
"RTN","ORCSAVE",109,0)
 S (PROMPT,CNT)=0 F  S PROMPT=$O(ORDIALOG(PROMPT)) Q:PROMPT'>0  D
"RTN","ORCSAVE",110,0)
 . S ITM=$G(ORDIALOG(PROMPT)) Q:'ITM
"RTN","ORCSAVE",111,0)
 . S TYPE=$E($G(ORDIALOG(PROMPT,0))) Q:'$L(TYPE)
"RTN","ORCSAVE",112,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:INST'>0  D
"RTN","ORCSAVE",113,0)
 . . S VALUE=$G(ORDIALOG(PROMPT,INST)) Q:VALUE=""  S CNT=CNT+1
"RTN","ORCSAVE",114,0)
 . . S ^OR(100,ORIFN,4.5,CNT,0)=+ITM_U_PROMPT_U_INST_U_$P(ITM,U,2)
"RTN","ORCSAVE",115,0)
 . . S:$L($P(ITM,U,2)) ^OR(100,ORIFN,4.5,"ID",$P(ITM,U,2),CNT)=""
"RTN","ORCSAVE",116,0)
 . . S:TYPE'="W" ^OR(100,ORIFN,4.5,CNT,1)=VALUE
"RTN","ORCSAVE",117,0)
 . . M:TYPE="W" ^OR(100,ORIFN,4.5,CNT,2)=@VALUE ; array root
"RTN","ORCSAVE",118,0)
 S ^OR(100,ORIFN,4.5,0)="^100.045A^"_CNT_U_CNT
"RTN","ORCSAVE",119,0)
R1 ; [Reset] Orderables
"RTN","ORCSAVE",120,0)
 I $D(^OR(100,ORIFN,.1)) S I=0 F  S I=$O(^OR(100,ORIFN,.1,I)) Q:I'>0  S X=$G(^(I,0)) I X,PAT,START K ^OR(100,"AOI",X,PAT,9999999-START,ORIFN) ; kill xref
"RTN","ORCSAVE",121,0)
 K ^OR(100,ORIFN,.1) I $D(^OR(100,ORIFN,4.5,"ID","ORDERABLE")) D
"RTN","ORCSAVE",122,0)
 . S (I,CNT)=0
"RTN","ORCSAVE",123,0)
 . F  S I=$O(^OR(100,ORIFN,4.5,"ID","ORDERABLE",I)) Q:I'>0  D
"RTN","ORCSAVE",124,0)
 . . S X=$G(^OR(100,ORIFN,4.5,I,1)) Q:'X
"RTN","ORCSAVE",125,0)
 . . S CNT=CNT+1,^OR(100,ORIFN,.1,CNT,0)=X,^OR(100,ORIFN,.1,"B",X,CNT)=""
"RTN","ORCSAVE",126,0)
 . . I PAT,START S ^OR(100,"AOI",X,PAT,9999999-START,ORIFN)=""
"RTN","ORCSAVE",127,0)
 . S ^OR(100,ORIFN,.1,0)="^100.001PA^"_CNT_U_CNT
"RTN","ORCSAVE",128,0)
 Q
"RTN","ORCSAVE",129,0)
 ;
"RTN","ORCSAVE",130,0)
RESUME(IFN) ; -- add Response nodes for RESUME tray service
"RTN","ORCSAVE",131,0)
 ; S ^OR(100,+IFN,4.5,<next>,0)=DT_"^^^RESUME",^(1)=1
"RTN","ORCSAVE",132,0)
 ;
"RTN","ORCSAVE",133,0)
 N X,Y,DA,DIC
"RTN","ORCSAVE",134,0)
 S DIC="^OR(100,"_+IFN_",4.5,",DIC(0)="LX",DA(1)=+IFN,X=DT
"RTN","ORCSAVE",135,0)
 S DIC("DR")=".04///RESUME",DIC("P")=$P(^DD(100,4.5,0),U,2)
"RTN","ORCSAVE",136,0)
 D ^DIC S:Y ^OR(100,+IFN,4.5,+Y,1)=1
"RTN","ORCSAVE",137,0)
 Q
"RTN","ORCSAVE",138,0)
 ;
"RTN","ORCSAVE",139,0)
PROVIDER(ORDER,PROV) ; -- Change PROVider assigned to ORDER
"RTN","ORCSAVE",140,0)
 Q:'$G(ORDER)  Q:'$G(PROV)
"RTN","ORCSAVE",141,0)
 N ORACT S ORACT=+$P(ORDER,";",2) S:'ORACT ORACT=1
"RTN","ORCSAVE",142,0)
 S $P(^OR(100,+ORDER,8,ORACT,0),U,3)=PROV
"RTN","ORCSAVE",143,0)
 S:ORACT=1 $P(^OR(100,+ORDER,0),U,4)=PROV
"RTN","ORCSAVE",144,0)
 Q
"RTN","ORCSAVE",145,0)
 ;
"RTN","ORCSAVE",146,0)
ACTION(CODE,DA,PROV,REASON,WHEN,WHO) ; -- save new action
"RTN","ORCSAVE",147,0)
 N NEXT,TOTAL,HDR,LAST,X,PAT,DGRP,SIG,NATR,TXT S DA=+DA
"RTN","ORCSAVE",148,0)
 Q:'$D(^OR(100,DA,0)) 0 Q:$G(CODE)'?2U 0
"RTN","ORCSAVE",149,0)
 S:'$G(WHEN) WHEN=+$E($$NOW^XLFDT,1,12) S:'$G(WHO) WHO=DUZ
"RTN","ORCSAVE",150,0)
 S NATR=+$O(^ORD(100.02,"C","E",0)) ;assume Elec Entered until changed
"RTN","ORCSAVE",151,0)
 S PAT=$P(^OR(100,DA,0),U,2),DGRP=$P(^(0),U,11),SIG=$P(^(0),U,16),X=+$P($G(^(3)),U,7),HDR=$G(^(8,0))
"RTN","ORCSAVE",152,0)
 S:X'>0 X=1 S TXT=$P($G(^OR(100,DA,8,X,0)),U,14) ;current actn's txt ptr
"RTN","ORCSAVE",153,0)
 S:HDR="" HDR="^100.008DA^^" S TOTAL=+$P(HDR,U,4)
"RTN","ORCSAVE",154,0)
 S LAST=$O(^OR(100,DA,8,"C",CODE,"?"),-1) I LAST D
"RTN","ORCSAVE",155,0)
 . S X=$G(^OR(100,DA,8,LAST,0)) Q:$P(X,U,15)'=11  Q:$P(X,U,4)'=2
"RTN","ORCSAVE",156,0)
 . S NEXT=LAST I PAT,$P(X,U) D  ; kill old xref entries
"RTN","ORCSAVE",157,0)
 . . K:DGRP ^OR(100,"ACT",PAT,(9999999-$P(X,U)),DGRP,DA,NEXT)
"RTN","ORCSAVE",158,0)
 . . K ^OR(100,"AC",PAT,(9999999-$P(X,U)),DA,NEXT),^OR(100,"AS",PAT,(9999999-$P(X,U)),DA,NEXT),^OR(100,"AF",$P(X,U),DA,NEXT)
"RTN","ORCSAVE",159,0)
 S:'$G(NEXT) NEXT=$O(^OR(100,DA,8,"?"),-1)+1,TOTAL=TOTAL+1
"RTN","ORCSAVE",160,0)
 S ^OR(100,DA,8,NEXT,0)=WHEN_U_CODE_U_$G(PROV)_U_$S(SIG:2,1:3)_"^^^^^^^^"_NATR_U_WHO_U_TXT_"^11",^OR(100,DA,8,"C",CODE,NEXT)=""
"RTN","ORCSAVE",161,0)
 S ^OR(100,"AF",WHEN,DA,NEXT)=""
"RTN","ORCSAVE",162,0)
 I PAT,DGRP S ^OR(100,"ACT",PAT,9999999-WHEN,DGRP,DA,NEXT)=""
"RTN","ORCSAVE",163,0)
 I PAT S ^OR(100,"AC",PAT,9999999-WHEN,DA,NEXT)=""
"RTN","ORCSAVE",164,0)
 I SIG S ^OR(100,"AS",PAT,9999999-WHEN,DA,NEXT)=""
"RTN","ORCSAVE",165,0)
 S:$L($G(REASON)) ^OR(100,DA,8,NEXT,1)=REASON
"RTN","ORCSAVE",166,0)
 S $P(HDR,U,3,4)=NEXT_U_TOTAL,^OR(100,DA,8,0)=HDR
"RTN","ORCSAVE",167,0)
 Q NEXT
"RTN","ORCSAVE",168,0)
 ;
"RTN","ORCSAVE",169,0)
SET(DLG) ; -- Create new parent for order set ORDIALOG
"RTN","ORCSAVE",170,0)
 ; Returns ORPIFN = ifn of new parent order for set
"RTN","ORCSAVE",171,0)
 ;
"RTN","ORCSAVE",172,0)
 Q:'$G(ORVP)  Q:'$G(DLG)  N OR0,PKG,NOW,CATG,STS,ORLOC,TRSPEC,X
"RTN","ORCSAVE",173,0)
 S OR0=$G(^ORD(101.41,DLG,0)) Q:OR0=""  S ORPIFN=$$NEXTIFN Q:'ORPIFN
"RTN","ORCSAVE",174,0)
 S PKG=$O(^DIC(9.4,"C","OR",0)),CATG=$S($$INPT^ORCD:"I",1:"O"),STS=$S($G(OREVENT):10,1:11),NOW=$S($G(ORSLOG):ORSLOG,1:+$E($$NOW^XLFDT,1,12))
"RTN","ORCSAVE",175,0)
 I $G(OREVENT) S ORLOC="",TRSPEC=""
"RTN","ORCSAVE",176,0)
 S ^OR(100,ORPIFN,0)=ORPIFN_U_ORVP_U_U_$G(ORNP)_U_DLG_";ORD(101.41,^"_DUZ_U_NOW_U_U_U_ORLOC_U_U_CATG_U_TRSPEC_U_PKG_"^^^"_$G(OREVENT),^(3)=NOW_"^90^"_STS_U_$S($G(ORIT):ORIT_"ORD(101.41,",1:"")_"^^^1^^^^0^^"_+$P(OR0,U,6)
"RTN","ORCSAVE",177,0)
 S ^OR(100,ORPIFN,8,0)="^100.008DA^1^1",^(1,0)=NOW_"^NW^"_$G(ORNP)_"^^^^^^^^^^"_DUZ_"^^"_STS,^OR(100,ORPIFN,8,"C","NW",1)="",^OR(100,"AF",NOW,ORPIFN,1)=""
"RTN","ORCSAVE",178,0)
 S ^OR(100,"ACT",ORVP,9999999-NOW,ORPIFN,1)=""
"RTN","ORCSAVE",179,0)
 S:STS=11 ^OR(100,"AC",ORVP,9999999-NOW,ORPIFN,1)=""
"RTN","ORCSAVE",180,0)
 ; AEVNT ??
"RTN","ORCSAVE",181,0)
 S ^OR(100,ORPIFN,1,0)="^100.011^1^1",^(1,0)=$P(OR0,U,2) ; Order text
"RTN","ORCSAVE",182,0)
 Q
"RTN","ORCSEND")
0^69^B56693058
"RTN","ORCSEND",1,0)
ORCSEND ;SLC/MKB-Release orders ; 08 May 2002  2:12 PM
"RTN","ORCSEND",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,27,45,79,92,141,165,195**;Dec 17, 1997
"RTN","ORCSEND",3,0)
 ;
"RTN","ORCSEND",4,0)
EN(ORIFN,ACTION,SIGSTS,RELSTS,NATURE,REASON,ORERR) ; -- Release [actions on] orders
"RTN","ORCSEND",5,0)
 N ORDA,ORNOW,SIGNREQD,SIGNED,SIGNER
"RTN","ORCSEND",6,0)
 S SIGNREQD=+$P($G(^OR(100,+ORIFN,0)),U,16),ORERR=""
"RTN","ORCSEND",7,0)
 S SIGNED=$S(SIGSTS=2:0,1:1),SIGNER=$S(SIGSTS=1:DUZ,SIGSTS=7:DUZ,1:"")
"RTN","ORCSEND",8,0)
 S ORDA=+$P(ORIFN,";",2),ORIFN=+ORIFN,ORNOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORCSEND",9,0)
 S:"ES"[$G(ACTION) ACTION=$P($G(^OR(100,ORIFN,8,ORDA,0)),U,2)
"RTN","ORCSEND",10,0)
 I SIGNREQD,ORDA,"^NW^RW^XX^RN^DC^HD^RL^"[(U_ACTION_U) D  ; sign/alert
"RTN","ORCSEND",11,0)
 . I 'SIGNED D NOTIF^ORCSIGN Q
"RTN","ORCSEND",12,0)
 . D:SIGSTS'="" SIGN^ORCSAVE2(ORIFN,SIGNER,ORNOW,SIGSTS,ORDA)
"RTN","ORCSEND",13,0)
 . D:SIGSTS=4 CHART^ORCSIGN ; not used anymore
"RTN","ORCSEND",14,0)
 I '$L(ACTION) S ORERR="1^Invalid order action" Q
"RTN","ORCSEND",15,0)
 I $$READY(ORIFN,ORDA) D:$L($T(@ACTION)) @ACTION I 'ORERR,ACTION="NW" D
"RTN","ORCSEND",16,0)
 . N OREVT S OREVT=+$P($G(^OR(100,ORIFN,0)),U,17) Q:OREVT<1
"RTN","ORCSEND",17,0)
 . I '$$EVTORDER^OREVNTX(ORIFN) D SAVE^ORMEVNT1(ORIFN,OREVT,2,"ES")
"RTN","ORCSEND",18,0)
 ; If order originated from the back door, send Dx and TxF back to ancil.
"RTN","ORCSEND",19,0)
 I SIGNED,$P($G(^OR(100,+ORIFN,3)),U,11)="P" D BDOEDIT^ORWDBA7
"RTN","ORCSEND",20,0)
 Q
"RTN","ORCSEND",21,0)
 ;
"RTN","ORCSEND",22,0)
EN1(ORDER,ORERR) ; -- Delayed Release [from RELEASE^ORMEVNT]
"RTN","ORCSEND",23,0)
 ;
"RTN","ORCSEND",24,0)
 Q:$P($G(^OR(100,+ORDER,3)),U,3)'=10
"RTN","ORCSEND",25,0)
 N ORPKG,ORA0,ORNOW,ORIFN,ORDA,ORNP,ORNATR,ORQUIT,ORDUZ,SIGSTS,RELSTS
"RTN","ORCSEND",26,0)
 S ORPKG=$P($G(^OR(100,+ORDER,0)),U,14),ORA0=$G(^(8,1,0))
"RTN","ORCSEND",27,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORIFN=+ORDER,ORDA=1,ORNP=$P(ORA0,U,3)
"RTN","ORCSEND",28,0)
 S SIGSTS=$P(ORA0,U,4),ORNATR=$P($G(^ORD(100.02,+$P(ORA0,U,12),0)),U,2)
"RTN","ORCSEND",29,0)
 S RELSTS=$S(SIGSTS'=2:1,"^V^P^"[(U_ORNATR_U):1,1:0) I RELSTS D
"RTN","ORCSEND",30,0)
 . D STARTDT^ORCSAVE2(ORIFN),PKGSTUFF^ORCSEND1(ORPKG) Q:$G(ORQUIT)
"RTN","ORCSEND",31,0)
 . S ORDUZ=$S(SIGSTS=0:$P(ORA0,U,7),SIGSTS=1:$P(ORA0,U,5),SIGSTS=2:$P(ORA0,U,17),SIGSTS=3:$P(ORA0,U,13),1:DUZ)
"RTN","ORCSEND",32,0)
 . D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,ORDUZ),NEW^ORMBLD(ORIFN)
"RTN","ORCSEND",33,0)
 . I "^10^13^"[(U_$P($G(^OR(100,ORIFN,3)),U,3)_U) S ORERR=1 ;error
"RTN","ORCSEND",34,0)
 I 'RELSTS!$G(ORERR),$P($G(^OR(100,ORIFN,3)),U,3)=10 D STATUS^ORCSAVE2(ORIFN,11) S $P(^OR(100,ORIFN,8,1,0),U,15)=11
"RTN","ORCSEND",35,0)
 Q
"RTN","ORCSEND",36,0)
 ;
"RTN","ORCSEND",37,0)
EN2(ORIFN,SIGSTS,NATURE,ORERR)  ; -- Manual Release [from OREVNT1,SENDED^ORWDX]
"RTN","ORCSEND",38,0)
 N ORDA,ORNOW,OREVT,ORA0,ORNP,SIGNREQD,SIGNED,RELSTS
"RTN","ORCSEND",39,0)
 S ORDA=+$P(ORIFN,";",2),ORIFN=+ORIFN S:ORDA<1 ORDA=1
"RTN","ORCSEND",40,0)
 S OREVT=+$P($G(^OR(100,ORIFN,0)),U,17),ORA0=$G(^(8,ORDA,0))
"RTN","ORCSEND",41,0)
 S ORNP=$P(ORA0,U,3),SIGNREQD=($P(ORA0,U,4)'=3),(SIGNED,RELSTS)=1
"RTN","ORCSEND",42,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORERR="" I $P(ORA0,U,4)=2 D  ;needs ES
"RTN","ORCSEND",43,0)
 . N SIGNER S SIGNER=$S(SIGSTS=1:DUZ,1:"")
"RTN","ORCSEND",44,0)
 . I SIGSTS=2 D NOTIF^ORCSIGN S SIGNED=0 Q  ;still unsigned
"RTN","ORCSEND",45,0)
 . D:SIGSTS'="" SIGN^ORCSAVE2(ORIFN,SIGNER,ORNOW,SIGSTS,ORDA)
"RTN","ORCSEND",46,0)
 D NW I 'ORERR D SAVE^ORMEVNT1(+ORIFN,OREVT,2,"MN")
"RTN","ORCSEND",47,0)
 Q
"RTN","ORCSEND",48,0)
 ;
"RTN","ORCSEND",49,0)
NW ; -- New order ORIFN
"RTN","ORCSEND",50,0)
RW ; -- Rewritten order ORIFN
"RTN","ORCSEND",51,0)
XX ; -- Changed order ORIFN
"RTN","ORCSEND",52,0)
RN ; -- Renewed order ORIFN
"RTN","ORCSEND",53,0)
 N ORQUIT,STS,TYPE,OR0,OR3,CODE,ORIG,ORSAVE
"RTN","ORCSEND",54,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG,OREBUILD=1 Q
"RTN","ORCSEND",55,0)
 S:'ORDA ORDA=1 S ORSAVE=ORIFN
"RTN","ORCSEND",56,0)
 S OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)) D STARTDT^ORCSAVE2(ORIFN)
"RTN","ORCSEND",57,0)
 S TYPE=$P(OR3,U,11),ORIG=+$P(OR3,U,5),CODE="NW"
"RTN","ORCSEND",58,0)
 I TYPE=1,ORIG,$D(^OR(100,ORIG,4)) S CODE="XO",^OR(100,ORIG,6)=$O(^ORD(100.02,"C","C",0))_U_DUZ_U_ORNOW
"RTN","ORCSEND",59,0)
 D PKGSTUFF^ORCSEND1(+$P(OR0,U,14)) Q:$G(ORQUIT)
"RTN","ORCSEND",60,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",61,0)
 D NEW^ORMBLD(ORIFN,CODE) S ORIFN=ORSAVE,STS=$P($G(^OR(100,ORIFN,3)),U,3)
"RTN","ORCSEND",62,0)
 I (STS=1)!(STS=13) S ORERR="1^"_$$WHY(ORIFN,1) D:'SIGNED&SIGNREQD NOSIG K:ORIG ^OR(100,ORIG,6)
"RTN","ORCSEND",63,0)
 I STS=11 S ORERR="1^ERROR"
"RTN","ORCSEND",64,0)
 Q
"RTN","ORCSEND",65,0)
 ;
"RTN","ORCSEND",66,0)
DC ; -- DC order ORIFN
"RTN","ORCSEND",67,0)
 N PKG,CODE,ORCHLD,ORCHDA,STS,ORIDA,ORSAVE,OR3
"RTN","ORCSEND",68,0)
 I '$G(REASON),$G(NATURE)="D" S REASON=+$O(^ORD(100.03,"C","ORDUP",0))
"RTN","ORCSEND",69,0)
 S:$G(REASON) ^OR(100,ORIFN,6)=$S($G(NATURE):NATURE,$L($G(NATURE)):$O(^ORD(100.02,"C",NATURE,0)),1:"")_"^^^"_+REASON_U_$P(^ORD(100.03,+REASON,0),U)
"RTN","ORCSEND",70,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",71,0)
 S $P(^OR(100,ORIFN,6),U,2,3)=$S($G(DGPMT):"",1:DUZ)_U_ORNOW,ORSAVE=ORIFN S:'$G(REASON) REASON=$P(^(6),U,4)
"RTN","ORCSEND",72,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3),PKG=$P($G(^(0)),U,14),PKG=$$NMSP^ORCD(PKG),CODE=$S(PKG="LR":"CA",(PKG="PS")&(STS=5):"CA",(PKG="FH")&(STS=8):"CA",1:"DC")
"RTN","ORCSEND",73,0)
 D:ORDA RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",74,0)
DC1 I $O(^OR(100,ORIFN,2,0)) D  G DC2 ; DC children
"RTN","ORCSEND",75,0)
 . S ORCHLD=0 F  S ORCHLD=$O(^OR(100,ORIFN,2,ORCHLD)) Q:ORCHLD'>0  I $$VALID^ORCACT0(ORCHLD,"DC") D  Q:$G(ORERR)
"RTN","ORCSEND",76,0)
 . . S ORCHDA=$S(ORDA:$$ACTION^ORCSAVE("DC",ORCHLD,ORNP),1:0)
"RTN","ORCSEND",77,0)
 . . D:ORCHDA SIGN^ORCSAVE2(ORCHLD,,,"",ORCHDA) ;Sig on Parent only
"RTN","ORCSEND",78,0)
 . . D MSG^ORMBLD((ORCHLD_";"_ORCHDA),CODE,$G(REASON))
"RTN","ORCSEND",79,0)
 . . I "^1^13^"'[(U_$P(^OR(100,ORCHLD,3),U,3)_U) S ORERR="1^"_$$WHY(ORCHLD,ORCHDA)
"RTN","ORCSEND",80,0)
 . ;D:'$G(ORERR) STATUS^ORCSAVE2(ORIFN,1)
"RTN","ORCSEND",81,0)
 . S:$G(ORERR) ^OR(100,ORIFN,8,ORDA,1)=$P(ORERR,U,2)
"RTN","ORCSEND",82,0)
 D MSG^ORMBLD((ORIFN_";"_ORDA),CODE,$G(REASON))
"RTN","ORCSEND",83,0)
DC2 S ORIFN=ORSAVE,OR3=$G(^OR(100,ORIFN,3)),STS=$P(OR3,U,3)
"RTN","ORCSEND",84,0)
 I STS'=1,STS'=13,STS'=2 D  Q
"RTN","ORCSEND",85,0)
 . S ORERR="1^"_$S(ORDA:$$WHY(ORIFN,ORDA),1:"Unable to discontinue")
"RTN","ORCSEND",86,0)
 . I ORDA,'SIGNED&SIGNREQD D NOSIG ; sig no longer reqd
"RTN","ORCSEND",87,0)
 . K ^OR(100,ORIFN,6)
"RTN","ORCSEND",88,0)
 S $P(^OR(100,ORIFN,3),U,7)=$S(ORDA:ORDA,'$$ACTV^ORX1($G(NATURE)):0,1:$P(OR3,U,7))
"RTN","ORCSEND",89,0)
 D CANCEL(ORIFN),SETALL^ORDD100(ORIFN)
"RTN","ORCSEND",90,0)
 I $P(OR3,U,11)=2 D  ; dc a renewal
"RTN","ORCSEND",91,0)
 . N ORIG,ORIG3,NATR S ORIG=$P(OR3,U,5),ORIG3=$G(^OR(100,ORIG,3)) Q:'ORIG
"RTN","ORCSEND",92,0)
 . I CODE="CA" S $P(^OR(100,ORIG,3),U,6)="" Q  ;pend - remove fwd ptr
"RTN","ORCSEND",93,0)
 . Q:"^1^7^12^13^"[(U_$P(ORIG3,U,3)_U)  S NATR=$O(^ORD(100.02,"C","A",0))
"RTN","ORCSEND",94,0)
 . S ^OR(100,ORIG,6)=NATR_U_DUZ_U_ORNOW_"^^Renewal cancelled"
"RTN","ORCSEND",95,0)
 . D MSG^ORMBLD(ORIG,"DC") I "^1^13^"'[$P(^OR(100,ORIG,3),U,3) K ^(6) Q
"RTN","ORCSEND",96,0)
 . S:'$$ACTV^ORX1(NATR) $P(^OR(100,ORIG,3),U,7)=0
"RTN","ORCSEND",97,0)
 Q
"RTN","ORCSEND",98,0)
 ;
"RTN","ORCSEND",99,0)
CANCEL(IFN) ; -- Cancel any outstanding actions for order IFN 
"RTN","ORCSEND",100,0)
 N I S I=0
"RTN","ORCSEND",101,0)
 F  S I=$O(^OR(100,IFN,8,I)) Q:I'>0  I $P(^(I,0),U,15)=11 S $P(^(0),U,15)=13 D:$P(^(0),U,4)=2 SIGN^ORCSAVE2(IFN,"","",5,I) ; cancelled, sig not reqd now
"RTN","ORCSEND",102,0)
 Q
"RTN","ORCSEND",103,0)
 ;
"RTN","ORCSEND",104,0)
HD ; -- Hold order ORIFN
"RTN","ORCSEND",105,0)
 N STS,ORSAVE I 'ORDA S ORERR="1^Unable to hold" Q
"RTN","ORCSEND",106,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",107,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",108,0)
 S ORSAVE=ORIFN D MSG^ORMBLD((ORIFN_";"_ORDA),"HD") S ORIFN=ORSAVE
"RTN","ORCSEND",109,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3) I STS=3 S $P(^(3),U,7)=ORDA D SET^ORDD100(ORIFN,ORDA)
"RTN","ORCSEND",110,0)
 I STS'=3 S ORERR="1^"_$$WHY(ORIFN,ORDA) D:'SIGNED&SIGNREQD NOSIG
"RTN","ORCSEND",111,0)
 Q
"RTN","ORCSEND",112,0)
 ;
"RTN","ORCSEND",113,0)
RL ; -- Release hold on order ORIFN
"RTN","ORCSEND",114,0)
 N STS,ORSAVE,ORHD I 'ORDA S ORERR="1^Unable to release hold" Q
"RTN","ORCSEND",115,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",116,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",117,0)
 S ORSAVE=ORIFN D MSG^ORMBLD((ORIFN_";"_ORDA),"RL") S ORIFN=ORSAVE
"RTN","ORCSEND",118,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3),ORHD=+$P($G(^(3)),U,7)
"RTN","ORCSEND",119,0)
 I STS'=3 S $P(^OR(100,ORIFN,3),U,7)=ORDA,$P(^(8,ORHD,2),U,1,2)=ORNOW_U_DUZ D SET^ORDD100(ORIFN,ORDA)
"RTN","ORCSEND",120,0)
 I STS=3 S ORERR="1^"_$$WHY(ORIFN,ORDA) D:'SIGNED&SIGNREQD NOSIG
"RTN","ORCSEND",121,0)
 Q
"RTN","ORCSEND",122,0)
 ;
"RTN","ORCSEND",123,0)
FL ; -- Flag order ORIFN
"RTN","ORCSEND",124,0)
 Q
"RTN","ORCSEND",125,0)
 ;
"RTN","ORCSEND",126,0)
UF ; -- Unflag order ORIFN
"RTN","ORCSEND",127,0)
 Q
"RTN","ORCSEND",128,0)
 ;
"RTN","ORCSEND",129,0)
CM ; -- Add Ward comments to order ORIFN
"RTN","ORCSEND",130,0)
 Q
"RTN","ORCSEND",131,0)
 ;
"RTN","ORCSEND",132,0)
VR ; -- Verify order ORIFN
"RTN","ORCSEND",133,0)
 I 'ORDA!(SIGSTS=2) S ORERR="1^Unable to verify" Q
"RTN","ORCSEND",134,0)
 I "^N^C^R^"'[(U_$G(ORVER)_U) S ORERR="1^Unable to verify" Q
"RTN","ORCSEND",135,0)
 D VERIFY^ORCSAVE2(ORIFN,ORDA,ORVER,DUZ,ORNOW)
"RTN","ORCSEND",136,0)
 ; -- send HL7 msg to Pharmacy if Nurse-Verified, [Sts=pending]
"RTN","ORCSEND",137,0)
 Q:ORVER'="N"  N ORSTS,ORPKG,ORX
"RTN","ORCSEND",138,0)
 S ORX=$P($G(^OR(100,ORIFN,8,ORDA,0)),U,2) Q:ORX'="NW"&(ORX'="XX")
"RTN","ORCSEND",139,0)
 S ORPKG=+$P($G(^OR(100,ORIFN,0)),U,14),ORSTS=$P($G(^(3)),U,3)
"RTN","ORCSEND",140,0)
 ;I ORSTS=5!$L($T(ZV^ORMPS)),$$NMSP^ORCD(ORPKG)="PS" D VER^ORMBLDPS(ORIFN)
"RTN","ORCSEND",141,0)
 I $$NMSP^ORCD(ORPKG)="PS" D VER^ORMBLDPS(ORIFN)
"RTN","ORCSEND",142,0)
 Q
"RTN","ORCSEND",143,0)
 ;
"RTN","ORCSEND",144,0)
NEEDSIG() ; -- Msg
"RTN","ORCSEND",145,0)
 Q "1^This order requires a signature."
"RTN","ORCSEND",146,0)
 ;
"RTN","ORCSEND",147,0)
WHY(IFN,DA) ; -- Return reason request was rejected
"RTN","ORCSEND",148,0)
 N X S X=$G(^OR(100,IFN,8,DA,1))
"RTN","ORCSEND",149,0)
 S:'$L(X) X="Unable to "_$S(ACTION="HD":"hold",ACTION="RL":"release hold",ACTION="DC":"discontinue",ACTION="XX":"change",ACTION="RN":"renew",1:"release")
"RTN","ORCSEND",150,0)
 Q X
"RTN","ORCSEND",151,0)
 ;
"RTN","ORCSEND",152,0)
NOSIG ; -- Mark order as Sig not Req'd due to cancel/reject
"RTN","ORCSEND",153,0)
 D SIGN^ORCSAVE2(ORIFN,"","",5,ORDA) S SIGNREQD=0
"RTN","ORCSEND",154,0)
 Q
"RTN","ORCSEND",155,0)
 ;
"RTN","ORCSEND",156,0)
READY(IFN,ACT) ; -- Ready to release?
"RTN","ORCSEND",157,0)
 N X,Y,OR0,OR3,ORA
"RTN","ORCSEND",158,0)
 I ACTION="VR" S Y=1 G RQ ; no action to release
"RTN","ORCSEND",159,0)
 I 'ACT,ACTION="DC" S Y=1 G RQ ; cancel a duplicate
"RTN","ORCSEND",160,0)
 S Y=0,OR0=$G(^OR(100,IFN,0)),OR3=$G(^(3)),ORA=$G(^(8,ACT,0))
"RTN","ORCSEND",161,0)
 I $P(ORA,U,15)=11 S Y=1 G RQ ; unreleased
"RTN","ORCSEND",162,0)
 I $P(ORA,U,15)=10 D  G RQ ; delayed
"RTN","ORCSEND",163,0)
 . I $G(^DPT(+ORVP,.105)),$$GET1^DIQ(9.4,+$P(OR0,U,14)_",",1)="PSO" S Y=1 Q
"RTN","ORCSEND",164,0)
 . Q:'RELSTS  N ORIG S ORIG=+$P(OR3,U,5)
"RTN","ORCSEND",165,0)
 . I 'SIGNED,$L($G(NATURE)) S $P(ORA,U,17)=DUZ,$P(ORA,U,12)=$S(NATURE:NATURE,1:+$O(^ORD(100.02,"C",NATURE,0))),^OR(100,IFN,8,ACT,0)=ORA
"RTN","ORCSEND",166,0)
 . Q:$P(OR3,U,11)'=1!('ORIG)  ;dc original if signed edit
"RTN","ORCSEND",167,0)
 . D STATUS^ORCSAVE2(ORIG,12)
"RTN","ORCSEND",168,0)
 . S ^OR(100,ORIG,6)=+$O(^ORD(100.02,"C","C",0))_U_DUZ_U_ORNOW
"RTN","ORCSEND",169,0)
 . S $P(^OR(100,ORIG,3),U,7)=0,$P(^(8,1,0),U,15)=12 D:$P($G(^(0)),U,4)=2 SIGN^ORCSAVE2(ORIG,,,5,1)
"RTN","ORCSEND",170,0)
 I $P(OR3,U,3)=11,$P(ORA,U,2)="NW" S Y=1 ; Action Sts = "" (old)
"RTN","ORCSEND",171,0)
RQ Q Y
"RTN","ORDV04")
0^79^B65496283
"RTN","ORDV04",1,0)
ORDV04 ; SLC/DAN - OE/RR ;7/21/04  15:32
"RTN","ORDV04",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109,148,160,208,195**;Dec 17,1997
"RTN","ORDV04",3,0)
 ;OE/RR COMPONENT
"RTN","ORDV04",4,0)
ORC(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT)     ; Current Orders
"RTN","ORDV04",5,0)
 ;External calls to EN^ORQ1, ^OR(100
"RTN","ORDV04",6,0)
 N ORCNT,ORJ,ORSITE,SITE,ORX0,ORLIST,GO
"RTN","ORDV04",7,0)
 Q:'$L(OREXT)
"RTN","ORDV04",8,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",9,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",10,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04",11,0)
 K ^TMP("ORR",$J),^TMP("ORDATA",$J)
"RTN","ORDV04",12,0)
 D @GO
"RTN","ORDV04",13,0)
 I '$D(^TMP("ORR",$J)) Q
"RTN","ORDV04",14,0)
 S ORCNT=0,ORJ=0
"RTN","ORDV04",15,0)
 F  S ORJ=$O(^TMP("ORR",$J,ORLIST,ORJ)) Q:'+ORJ!(ORCNT'<ORMAX)  S ORX0=^(ORJ) D
"RTN","ORDV04",16,0)
 . S ORCNT=ORCNT+1,SITE=$S($L($G(^TMP("ORR",$J,ORLIST,ORJ,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04",17,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV04",18,0)
 . D SPMRG^ORDVU("^TMP(""ORR"","_$J_","""_ORLIST_""","_ORJ_",""TX"")","^TMP(""ORDATA"","_$J_","""_ORLIST_""","_ORJ_",""WP"",2)",2) ;order text
"RTN","ORDV04",19,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",3)="3^"_$P(ORX0,"^",6) ; status
"RTN","ORDV04",20,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",4)="4^"_$$DATE^ORDVU($P(ORX0,"^",4)) ;start date
"RTN","ORDV04",21,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",5)="5^"_$$DATE^ORDVU($P(ORX0,"^",5)) ;stop date
"RTN","ORDV04",22,0)
 . I $O(^TMP("ORR",$J,ORLIST,ORJ,"TX",1)) S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",6)="6^[+]" ;flag for details
"RTN","ORDV04",23,0)
 K ^TMP("ORR",$J)
"RTN","ORDV04",24,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",25,0)
 Q
"RTN","ORDV04",26,0)
ORCVA ;VA call to get Current Orders
"RTN","ORDV04",27,0)
 N ORVP
"RTN","ORDV04",28,0)
 S ORVP=DFN_";DPT("
"RTN","ORDV04",29,0)
 I '$D(^OR(100,"AC",ORVP)) Q
"RTN","ORDV04",30,0)
 D EN^ORQ1(ORVP,,2,,ORDBEG,ORDEND,1) ;get current orders. ORLIST is set in ORQ1
"RTN","ORDV04",31,0)
 Q
"RTN","ORDV04",32,0)
PLAILALL(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Problem list API returns ALL problems
"RTN","ORDV04",33,0)
 N GO
"RTN","ORDV04",34,0)
 Q:'$L(OREXT)
"RTN","ORDV04",35,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",36,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",37,0)
 D PLAIL
"RTN","ORDV04",38,0)
 Q
"RTN","ORDV04",39,0)
PLALL ;Jump here for All Problems
"RTN","ORDV04",40,0)
 D GETLIST^GMPLHS(DFN,"ALL")
"RTN","ORDV04",41,0)
 Q
"RTN","ORDV04",42,0)
PLAILI(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Problem list API returns INACTIVE problems
"RTN","ORDV04",43,0)
 N GO
"RTN","ORDV04",44,0)
 Q:'$L(OREXT)
"RTN","ORDV04",45,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",46,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",47,0)
 D PLAIL
"RTN","ORDV04",48,0)
 Q
"RTN","ORDV04",49,0)
PLI ;Jump here for Inactive Problems
"RTN","ORDV04",50,0)
 D GETLIST^GMPLHS(DFN,"I")
"RTN","ORDV04",51,0)
 Q
"RTN","ORDV04",52,0)
PLAILA(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Problem list API returns ACTIVE problems
"RTN","ORDV04",53,0)
 N GO
"RTN","ORDV04",54,0)
 Q:'$L(OREXT)
"RTN","ORDV04",55,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",56,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",57,0)
 D PLAIL
"RTN","ORDV04",58,0)
 Q
"RTN","ORDV04",59,0)
PLA ;Jump here for Active Problems
"RTN","ORDV04",60,0)
 D GETLIST^GMPLHS(DFN,"A")
"RTN","ORDV04",61,0)
 Q
"RTN","ORDV04",62,0)
PLAIL   ;problems(active, inactive or all)
"RTN","ORDV04",63,0)
 ;External calls to ^GMPLHS
"RTN","ORDV04",64,0)
 ; input:
"RTN","ORDV04",65,0)
 ;   STATUS = "A"   to produce active problems
"RTN","ORDV04",66,0)
 ;   STATUS = "I"   to produce inactive problems
"RTN","ORDV04",67,0)
 ;   STATUS = "ALL" to produce all problems
"RTN","ORDV04",68,0)
 ;
"RTN","ORDV04",69,0)
 N ORPROBNO,ORXREC0,ORLOC,I,K,X,ORSITE,SITE,ORMORE
"RTN","ORDV04",70,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04",71,0)
 K ^TMP("ORDATA",$J),^TMP("GMPLHS",$J)
"RTN","ORDV04",72,0)
 D @GO
"RTN","ORDV04",73,0)
 I '$D(^TMP("GMPLHS",$J)) Q
"RTN","ORDV04",74,0)
 S ORPROBNO=0
"RTN","ORDV04",75,0)
 F I=1:1:ORMAX S ORPROBNO=$O(^TMP("GMPLHS",$J,ORPROBNO)) Q:'ORPROBNO  D
"RTN","ORDV04",76,0)
 . S ORXREC0=$G(^TMP("GMPLHS",$J,ORPROBNO,0)),ORMORE=0
"RTN","ORDV04",77,0)
 . S SITE=$S($L($G(^TMP("GMPLHS",$J,ORPROBNO,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04",78,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV04",79,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",2)="2^"_$P(ORXREC0,U,5) ;status
"RTN","ORDV04",80,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",3)="3^"_$G(^TMP("GMPLHS",$J,ORPROBNO,"N")) ;provider narrative
"RTN","ORDV04",81,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",4)="4^"_$$DATE^ORDVU($P(ORXREC0,U,6)) ;onset date
"RTN","ORDV04",82,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",5)="5^"_$$DATE^ORDVU($P(ORXREC0,U,2)) ;last modified date
"RTN","ORDV04",83,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",6)="6^"_$P(ORXREC0,U,7) ;provider
"RTN","ORDV04",84,0)
 . S ORLOC=0,K=0
"RTN","ORDV04",85,0)
 . F  S ORLOC=$O(^TMP("GMPLHS",$J,ORPROBNO,"C",ORLOC)) Q:'ORLOC  D
"RTN","ORDV04",86,0)
 .. S X=0
"RTN","ORDV04",87,0)
 .. F  S X=$O(^TMP("GMPLHS",$J,ORPROBNO,"C",ORLOC,X)) Q:'X  D
"RTN","ORDV04",88,0)
 ... S K=K+1,ORMORE=1
"RTN","ORDV04",89,0)
 ... S ^TMP("ORDATA",$J,ORPROBNO,"WP",7,K)="7^"_$P($G(^TMP("GMPLHS",$J,ORPROBNO,"C",ORLOC,X,0)),U) ;note narrative
"RTN","ORDV04",90,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",8)="8^"_$P(ORXREC0,U,14) ;exposures
"RTN","ORDV04",91,0)
 . I ORMORE S ^TMP("ORDATA",$J,ORPROBNO,"WP",9)="9^[+]" ;flag for details
"RTN","ORDV04",92,0)
 K ^TMP("GMPLHS",$J)
"RTN","ORDV04",93,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",94,0)
 Q
"RTN","ORDV04",95,0)
SR(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Surgery Report
"RTN","ORDV04",96,0)
 ;External call to ^ORDV04A (external calls are noted in that routine)
"RTN","ORDV04",97,0)
 N ORCNT
"RTN","ORDV04",98,0)
 S ORCNT=0
"RTN","ORDV04",99,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV04",100,0)
 D ENSR^ORDV04A
"RTN","ORDV04",101,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",102,0)
 Q
"RTN","ORDV04",103,0)
VS(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT)      ; get vital Signs
"RTN","ORDV04",104,0)
 ;External calls to GMRVUT0
"RTN","ORDV04",105,0)
 N ORDT,I,TYPE,IEN,GMRVSTR,ORSITE,SITE,PLACE,GO
"RTN","ORDV04",106,0)
 Q:'$L(OREXT)
"RTN","ORDV04",107,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",108,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",109,0)
 K ^UTILITY($J,"GMRVD"),^TMP("ORDATA",$J)
"RTN","ORDV04",110,0)
 S GMRVSTR="T;P;R;BP;HT;WT",GMRVSTR(0)=ORDBEG_"^"_ORDEND_"^"_ORMAX_"^"_1
"RTN","ORDV04",111,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04",112,0)
 D @GO
"RTN","ORDV04",113,0)
 S ORDT=0
"RTN","ORDV04",114,0)
 F I=1:1 S ORDT=$O(^UTILITY($J,"GMRVD",ORDT)) Q:'+ORDT!(I>ORMAX)  D
"RTN","ORDV04",115,0)
 . S SITE=$S($L($G(^TMP("GMRVD",$J,ORDT,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04",116,0)
 . S ^TMP("ORDATA",$J,"WP",ORDT,1)="1^"_SITE
"RTN","ORDV04",117,0)
 . S ^TMP("ORDATA",$J,"WP",ORDT,2)="2^"_$$DATE^ORDVU(9999999-ORDT) ;date vitals taken
"RTN","ORDV04",118,0)
 . S TYPE=""
"RTN","ORDV04",119,0)
 . F  S TYPE=$O(^UTILITY($J,"GMRVD",ORDT,TYPE)) Q:TYPE=""  D
"RTN","ORDV04",120,0)
 .. S IEN=$O(^UTILITY($J,"GMRVD",ORDT,TYPE,0)) Q:'IEN
"RTN","ORDV04",121,0)
 .. S PLACE=$S(TYPE="T":3,TYPE="P":4,TYPE="R":5,TYPE="BP":6,TYPE="HT":7,1:8)
"RTN","ORDV04",122,0)
 .. S ^TMP("ORDATA",$J,"WP",ORDT,PLACE)=PLACE_"^"_$P($G(^UTILITY($J,"GMRVD",ORDT,TYPE,IEN)),"^",8) ;Get value of vitals from global
"RTN","ORDV04",123,0)
 K ^UTILITY($J,"GMRVD")
"RTN","ORDV04",124,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",125,0)
 Q
"RTN","ORDV04",126,0)
TIUPRG(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;  TIU version of progress reports
"RTN","ORDV04",127,0)
 ;External calls to TIUSRVLO,TIUSRVR1,VASITE
"RTN","ORDV04",128,0)
 N ORDT,DATE,ORCI,ORGLOB,ORGLOBA,ORTEMP,ORSITE,SITE,I,ORNODE,GO,ORIMAG
"RTN","ORDV04",129,0)
 Q:'$L(OREXT)
"RTN","ORDV04",130,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",131,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",132,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04",133,0)
 D @GO
"RTN","ORDV04",134,0)
 I '$D(@ORGLOB) Q
"RTN","ORDV04",135,0)
 S ORNODE=0,ORCI=0
"RTN","ORDV04",136,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV04",137,0)
 F  S ORNODE=$O(@ORGLOB@(ORNODE)) Q:'ORNODE!(ORCI'<ORMAX)  D
"RTN","ORDV04",138,0)
 . S ORTEMP=@ORGLOB@(ORNODE)
"RTN","ORDV04",139,0)
 . S ORIMAG=$P($$RESOLVE^TIUSRVLO($P(ORTEMP,U)),U,10)
"RTN","ORDV04",140,0)
 . S DATE=$P(ORTEMP,U,3)       ;date
"RTN","ORDV04",141,0)
 . S SITE=$S($L($G(@ORGLOB@(ORNODE,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04",142,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV04",143,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",2)="2^"_$P(ORTEMP,U) ;TIU ien
"RTN","ORDV04",144,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",3)="3^"_$$DATE^ORDVU(DATE) ;date
"RTN","ORDV04",145,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",4)="4^"_$P(ORTEMP,U,2) ;type
"RTN","ORDV04",146,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",5)="5^"_$P($P(ORTEMP,U,5),";",2) ;author
"RTN","ORDV04",147,0)
 . S ORCI=ORCI+1
"RTN","ORDV04",148,0)
 . D TGET^TIUSRVR1(.ORGLOBA,$P(ORTEMP,U)) ;Call back to get note text
"RTN","ORDV04",149,0)
 . D SPMRG^ORDVU($NA(@ORGLOBA),$NA(^TMP("ORDATA",$J,ORNODE,"WP",6)),6) ;Notes Text
"RTN","ORDV04",150,0)
 . I $O(@ORGLOBA@(0)) S ^TMP("ORDATA",$J,ORNODE,"WP",7)="7^[+]"
"RTN","ORDV04",151,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",8)="8^"_ORIMAG
"RTN","ORDV04",152,0)
 . K @ORGLOBA
"RTN","ORDV04",153,0)
 K @ORGLOB
"RTN","ORDV04",154,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",155,0)
 Q
"RTN","ORDV04",156,0)
TPRG ;Jump here for Tiu Progress Notes
"RTN","ORDV04",157,0)
 D CONTEXT^TIUSRVLO(.ORGLOB,3,5,DFN,ORDBEG,ORDEND,,ORMAX)
"RTN","ORDV04",158,0)
 Q
"RTN","ORDV04",159,0)
TIUDCS(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;  Discharge Summaries
"RTN","ORDV04",160,0)
 ;External calls to VASITE, DIQ1, TIUSRVLO
"RTN","ORDV04",161,0)
 I $L($T(GCPR^OMGCOAS1)) D  Q  ; Call if FHIE station 200
"RTN","ORDV04",162,0)
 . D GCPR^OMGCOAS1(DFN,"DS",ORDBEG,ORDEND,ORMAX)
"RTN","ORDV04",163,0)
 . S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",164,0)
 N ORGLOB,ORGLOBA,ORI,ORNODE,ORICDIEN,ORARRAY,ORTEMP,ORSITE,SITE,DIC,DR,DIQ,DA,GO
"RTN","ORDV04",165,0)
 Q:'$L(OREXT)
"RTN","ORDV04",166,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",167,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",168,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04",169,0)
 D @GO
"RTN","ORDV04",170,0)
 I '$D(@ORGLOB) Q
"RTN","ORDV04",171,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV04",172,0)
 S ORNODE=0,ORI=0
"RTN","ORDV04",173,0)
 F  S ORNODE=$O(@ORGLOB@(ORNODE)) Q:'ORNODE!(ORI'<ORMAX)  D
"RTN","ORDV04",174,0)
 . S ORTEMP=@ORGLOB@(ORNODE)
"RTN","ORDV04",175,0)
 . S SITE=$S($L($G(@ORGLOB@(ORNODE,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04",176,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV04",177,0)
 . K ORARRAY S DIC=8925,DA=$P(ORTEMP,U),DR=".05;.07;.08;1202;1502",DIQ="ORARRAY"
"RTN","ORDV04",178,0)
 . D EN^DIQ1
"RTN","ORDV04",179,0)
 . S DIQ="ORARRAY(8925,"_DA_")"
"RTN","ORDV04",180,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",2)="2^"_$$DATEMMM^ORDVU($G(@DIQ@(.07))) ;episode begin date/time
"RTN","ORDV04",181,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",3)="3^"_$$DATEMMM^ORDVU($G(@DIQ@(.08))) ;episode end date/time
"RTN","ORDV04",182,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",4)="4^"_$G(@DIQ@(1202)) ;author/dicator
"RTN","ORDV04",183,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",5)="5^"_$G(@DIQ@(1502)) ;signed by
"RTN","ORDV04",184,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",6)="6^"_$G(@DIQ@(.05)) ;status
"RTN","ORDV04",185,0)
 . S ORI=ORI+1
"RTN","ORDV04",186,0)
 . D TGET^TIUSRVR1(.ORGLOBA,$P(ORTEMP,U)) ;Call back to get summary text
"RTN","ORDV04",187,0)
 . D SPMRG^ORDVU($NA(@ORGLOBA),$NA(^TMP("ORDATA",$J,ORNODE,"WP",7)),7) ;summary Text
"RTN","ORDV04",188,0)
 . I $O(@ORGLOBA@(0)) S ^TMP("ORDATA",$J,ORNODE,"WP",8)="8^[+]" ;detail flag
"RTN","ORDV04",189,0)
 . K @ORGLOBA
"RTN","ORDV04",190,0)
 K @ORGLOB
"RTN","ORDV04",191,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",192,0)
 Q
"RTN","ORDV04",193,0)
TDCS ;Jump here for TIU Discharge Summary
"RTN","ORDV04",194,0)
 D CONTEXT^TIUSRVLO(.ORGLOB,244,5,DFN,ORDBEG,ORDEND,,ORMAX)
"RTN","ORDV04",195,0)
 Q
"RTN","OREVNT")
0^68^B75703120
"RTN","OREVNT",1,0)
OREVNT ; SLC/MKB - Event delayed orders ;3/31/04  13:42 [4/9/04 10:20am]
"RTN","OREVNT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,177,195**;Dec 17, 1997
"RTN","OREVNT",3,0)
 ;
"RTN","OREVNT",4,0)
EN ; -- view/add EVOs
"RTN","OREVNT",5,0)
 N X,ORP,ORQUIT S VALMBCK=""
"RTN","OREVNT",6,0)
 I $G(OREVENT) D  Q:$G(ORQUIT)
"RTN","OREVNT",7,0)
 . S X=$$ACTIVE I X D EX S ORQUIT=1 Q  ;return to Active Orders
"RTN","OREVNT",8,0)
 . I X="^" S ORQUIT=1 Q
"RTN","OREVNT",9,0)
 D FULL^VALM1 S VALMBCK="R"
"RTN","OREVNT",10,0)
 W !!,$$CURRENT
"RTN","OREVNT",11,0)
 S:'$G(ORL) ORL=$$LOCATION^ORCMENU1 Q:ORL="^"
"RTN","OREVNT",12,0)
 S ORP=$$PTEVENT(+ORVP) Q:ORP="^"
"RTN","OREVNT",13,0)
 S $P(^TMP("OR",$J,"ORDERS",0),U,3,4)=";;;;;;;"_+ORP_U,OREVENT=+ORP
"RTN","OREVNT",14,0)
 D TAB^ORCHART(ORTAB,1) ;redisplay new order sheet/view
"RTN","OREVNT",15,0)
 Q
"RTN","OREVNT",16,0)
 ;
"RTN","OREVNT",17,0)
EX ; -- Back to Active Orders
"RTN","OREVNT",18,0)
 I +$G(OREVENT),'$G(^ORE(100.2,OREVENT,1)),$$EMPTY^OREVNTX(OREVENT) D CANCEL^OREVNTX(OREVENT) ;cancel empty events
"RTN","OREVNT",19,0)
 K OREVENT S $P(^TMP("OR",$J,"ORDERS",0),U,3,4)="^1" ;default view
"RTN","OREVNT",20,0)
 D TAB^ORCHART(ORTAB,1)
"RTN","OREVNT",21,0)
 Q
"RTN","OREVNT",22,0)
 ;
"RTN","OREVNT",23,0)
ED ; -- Change delay event
"RTN","OREVNT",24,0)
 N ORI,NMBR,IDX,ORIFN,ORLK,ORDERS,OREVT,ORQUIT,X,EVT
"RTN","OREVNT",25,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("change the delay event") Q:'ORNMBR
"RTN","OREVNT",26,0)
 D FREEZE^ORCMENU S VALMBCK="R" K OREBUILD
"RTN","OREVNT",27,0)
 F ORI=1:1:$L(ORNMBR) S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","OREVNT",28,0)
 . S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),ORIFN=$P(IDX,U)
"RTN","OREVNT",29,0)
 . Q:'ORIFN  S:'$P(ORIFN,";",2) ORIFN=+ORIFN_";1" ;unsign/unrel only
"RTN","OREVNT",30,0)
 . I '$$VALID^ORCACT0(ORIFN,"EV",.ORERR) W !!,$$ORDITEM^ORCACT(ORIFN)_" invalid.",!,"  >> "_ORERR H 1 Q
"RTN","OREVNT",31,0)
 . S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK W !!,$$ORDITEM^ORCACT(ORIFN)_" invalid.",!,"  >> "_$P(ORLK,U,2) H 1 Q
"RTN","OREVNT",32,0)
 . S ORDERS(+ORIFN)=""
"RTN","OREVNT",33,0)
ED1 Q:'$O(ORDERS(0))  I $$DELAYED D  Q:$G(ORQUIT)  G:$G(OREBUILD) ED3
"RTN","OREVNT",34,0)
 . S X=$$NODELAY ;remove event?
"RTN","OREVNT",35,0)
 . I X="^" W !,"Nothing changed!" D UNLOCK S ORQUIT=1 H 1 Q
"RTN","OREVNT",36,0)
 . Q:'X  W !!,"Removing release event ..."
"RTN","OREVNT",37,0)
 . S ORIFN=0 F  S ORIFN=$O(ORDERS(ORIFN)) Q:ORIFN<1  D
"RTN","OREVNT",38,0)
 .. S EVT=+$P($G(^OR(100,ORIFN,0)),U,17),OREVT(EVT)=""
"RTN","OREVNT",39,0)
 .. D CHGEVT^OREVNTX(ORIFN,""),UNLK1^ORX2(ORIFN) W "."
"RTN","OREVNT",40,0)
 . W " done." S OREBUILD=1
"RTN","OREVNT",41,0)
ED2 W !!,$$CURRENT S ORP=$$PTEVENT(+ORVP,1)
"RTN","OREVNT",42,0)
 I ORP="^" W !,"Nothing changed!" D UNLOCK H 1 Q
"RTN","OREVNT",43,0)
 W !!,"Setting release event to "_$P(ORP,U,2)_" ..."
"RTN","OREVNT",44,0)
 S ORIFN=0 F  S ORIFN=$O(ORDERS(ORIFN)) Q:ORIFN<1  D
"RTN","OREVNT",45,0)
 . S EVT=+$P($G(^OR(100,ORIFN,0)),U,17) Q:EVT=+ORP  S OREVT(EVT)=""
"RTN","OREVNT",46,0)
 . D CHGEVT^OREVNTX(ORIFN,+ORP),UNLK1^ORX2(ORIFN) W "."
"RTN","OREVNT",47,0)
 W " done." S OREBUILD=1
"RTN","OREVNT",48,0)
ED3 S EVT=0 F  S EVT=$O(OREVT(EVT)) Q:EVT<1  D  ;terminate any events?
"RTN","OREVNT",49,0)
 . Q:$G(^ORE(100.2,EVT,1))  Q:'$$EMPTY^OREVNTX(EVT)  ;active,empty
"RTN","OREVNT",50,0)
 . ;W !!,$P($$NAME^OREVNTX(EVT)," ",2,99)_" has no more delayed orders."
"RTN","OREVNT",51,0)
 . ;S DIR(0)="YA",DIR("A")="Do you want to cancel this event? "
"RTN","OREVNT",52,0)
 . ;S DIR("?")="Enter NO if you wish to enter new delayed orders for this event, otherwise enter YES to terminate it."
"RTN","OREVNT",53,0)
 . ;S DIR("B")="YES" D ^DIR I $D(DTOUT)!$D(DUOUT) S ORQUIT=1 Q
"RTN","OREVNT",54,0)
 . D CANCEL^OREVNTX(EVT) S X=$P($$NAME^OREVNTX(EVT)," ",2,99)
"RTN","OREVNT",55,0)
 . W !,"   ... "_X_" event cancelled." H 1
"RTN","OREVNT",56,0)
 . D:$G(OREVENT) EX ;Change view back to Active
"RTN","OREVNT",57,0)
 Q
"RTN","OREVNT",58,0)
 ;
"RTN","OREVNT",59,0)
ACTIVE() ; -- Return to Active orders?
"RTN","OREVNT",60,0)
 N X,Y,DIR S DIR(0)="YA"
"RTN","OREVNT",61,0)
 S DIR("A")="Return to viewing Active Orders? ",DIR("B")="YES"
"RTN","OREVNT",62,0)
 S DIR("?")="Enter NO to select another delayed order sheet to view, or YES to exit delayed mode and return to your default Orders view."
"RTN","OREVNT",63,0)
 D ^DIR S:$D(DTOUT)!$D(DUOUT) Y="^"
"RTN","OREVNT",64,0)
 Q Y
"RTN","OREVNT",65,0)
 ;
"RTN","OREVNT",66,0)
DELAYED() ; -- Return 1 or 0, if current view=EDOs
"RTN","OREVNT",67,0)
 I $G(OREVENT) Q 1
"RTN","OREVNT",68,0)
 N X,Y S X=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),X=$P(X,";",3)
"RTN","OREVNT",69,0)
 S Y=$S("^15^16^17^24^25^"[(U_X_U):1,1:0)
"RTN","OREVNT",70,0)
 Q Y
"RTN","OREVNT",71,0)
 ;
"RTN","OREVNT",72,0)
NODELAY() ; -- Return 1 or 0, if event should be removed
"RTN","OREVNT",73,0)
 N X,Y,DIR S DIR(0)="YA"
"RTN","OREVNT",74,0)
 S DIR("A")="Remove the release event from these orders? ",DIR("B")="NO"
"RTN","OREVNT",75,0)
 S DIR("?")="Enter YES to allow these orders to be released immediately upon signature, or NO to continue and keep this event or select another."
"RTN","OREVNT",76,0)
 D ^DIR S:$D(DTOUT)!$D(DUOUT) Y="^"
"RTN","OREVNT",77,0)
 Q Y
"RTN","OREVNT",78,0)
 ;
"RTN","OREVNT",79,0)
UNLOCK ; -- Unlock orders after ^
"RTN","OREVNT",80,0)
 F  S ORIFN=$O(ORDERS(ORIFN)) Q:ORIFN'>0  D UNLK1^ORX2(+ORIFN)
"RTN","OREVNT",81,0)
 Q
"RTN","OREVNT",82,0)
 ;
"RTN","OREVNT",83,0)
CURRENT() ; -- Display current patient data
"RTN","OREVNT",84,0)
 N Y S Y=ORPNM_" is currently"_$S('$G(ORWARD):" not",1:"")_" admitted"_$S($G(ORWARD)&$G(ORTS):" to "_$P($G(^DIC(45.7,+ORTS,0)),U),1:"")_"."
"RTN","OREVNT",85,0)
 Q Y
"RTN","OREVNT",86,0)
 ;
"RTN","OREVNT",87,0)
PTEVENT(DFN,DLGONLY) ; -- Select Patient Event [or create new one]
"RTN","OREVNT",88,0)
 ;    Pass in DLGONLY=1 to skip new event's Order Set (from Copy, Xfer)
"RTN","OREVNT",89,0)
 ;    Returns Pt Evt ien ^ Event name
"RTN","OREVNT",90,0)
 I '$G(DFN)!'$D(^DPT(+$G(DFN),0)) Q "^" ;invalid patient
"RTN","OREVNT",91,0)
 N ORPTEVT,OREVT,X,Y,DIR,DTOUT,DUOUT,ORDIV,DOMAIN,OREV0,ORDAD,ORDIALOG,ORDSET,ORIFN,ORPTLK,OREBUILD,OREVENT
"RTN","OREVNT",92,0)
 I $D(^ORE(100.2,"AE",DFN)) D  ;pending events
"RTN","OREVNT",93,0)
 . N CNT,EVT S (CNT,EVT)=0,DOMAIN=100.2 K ORPTEVT,DIR
"RTN","OREVNT",94,0)
 . F  S EVT=+$O(^ORE(100.2,"AE",DFN,EVT)) Q:EVT'>0  S Y=+$O(^(EVT,0)) D
"RTN","OREVNT",95,0)
 .. Q:$G(^ORE(100.2,Y,1))  Q:$$LAPSED^OREVNTX(Y)  Q:$D(^ORE(100.2,"DAD",Y))
"RTN","OREVNT",96,0)
 .. S X=$P($G(^ORD(100.5,EVT,0)),U,8),CNT=CNT+1,ORPTEVT(CNT)=Y_U_X
"RTN","OREVNT",97,0)
 .. S X=$$UP^XLFSTR(X),ORPTEVT("B",X)=Y
"RTN","OREVNT",98,0)
 . Q:CNT'>0  S DIR("A",1)="Delayed orders exist for "_ORPNM_" for the following events:"
"RTN","OREVNT",99,0)
 . F I=1:1:CNT S DIR("A",I+1)=$J(I,5)_"  "_$P(ORPTEVT(I),U,2)
"RTN","OREVNT",100,0)
 . S DIR("A",CNT+2)="To review or add delayed orders, select from (1-"_CNT_") or enter a new event."
"RTN","OREVNT",101,0)
 S X=+$$GET^XPAR("ALL","OREVNT DEFAULT")
"RTN","OREVNT",102,0)
 I X S Y=$P($G(^ORD(100.5,X,0)),U,8),DIR("B")=$$UP^XLFSTR(Y)
"RTN","OREVNT",103,0)
PT1 S I=0 F  S I=+$O(DIR("A",I)) Q:I<1  W !,DIR("A",I)
"RTN","OREVNT",104,0)
 W !,"Select RELEASE EVENT: "_$S($L($G(DIR("B"))):DIR("B")_"//",1:"")
"RTN","OREVNT",105,0)
 R X:DTIME I '$T!(X["^")!(X=""&'$D(DIR("B"))) Q "^"
"RTN","OREVNT",106,0)
 S:X="" X=$G(DIR("B")) I X["?" D HELP^OREVNT(X) G PT1
"RTN","OREVNT",107,0)
 I $O(DIR("A",0)) S ORPTEVT=$$FIND^ORCDLG2("ORPTEVT",X) G:$L(ORPTEVT) PTQ
"RTN","OREVNT",108,0)
 S OREVT="" D  I OREVT<1 G PT1 ;reask
"RTN","OREVNT",109,0)
 . N DIC,DIR,D S DIC="^ORD(100.5,",DIC(0)="EQZS",D="C",DIC("W")=""
"RTN","OREVNT",110,0)
 . S DIC("S")="I '$D(^ORD(100.5,""DAD"",Y))"
"RTN","OREVNT",111,0)
 . ;S:'$G(ORWARD) DIC("S")="I $P(^(0),U,2)=""A"""
"RTN","OREVNT",112,0)
 . D IX^DIC S:Y>0 OREVT=+Y_U_$P(Y(0),U,8)
"RTN","OREVNT",113,0)
 I $$MATCH(DFN,+OREVT),'$$CONT G PT1 ;reask
"RTN","OREVNT",114,0)
 S OREV0=$G(^ORD(100.5,+OREVT,0)),ORDAD=+$P(OREV0,U,12)
"RTN","OREVNT",115,0)
 S ORDIALOG=+$P(OREV0,U,4),ORDSET=+$P(OREV0,U,5)
"RTN","OREVNT",116,0)
 I 'ORDIALOG,'ORDSET!$G(DLGONLY),'ORDAD S ORPTEVT=$$NEW(DFN,+OREVT) S:ORPTEVT<1 ORPTEVT="^" G PTQ
"RTN","OREVNT",117,0)
PT2 S ORPTLK=$$LOCK^ORX2(DFN) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q "^"
"RTN","OREVNT",118,0)
 S ORNP=$$PROVIDER^ORCMENU1 I ORNP="^" Q "^"
"RTN","OREVNT",119,0)
 I ORDAD D  I $G(ORIFN)="^" Q "^"  ;parent
"RTN","OREVNT",120,0)
 . N OREVT S OREVT=ORDAD,ORDIALOG=+$P($G(^ORD(100.5,ORDAD,0)),U,4)
"RTN","OREVNT",121,0)
 . I ORDIALOG S ORIFN=+$$ORDER^ORCDLG(ORDIALOG) I ORIFN<1 S ORIFN="^" Q
"RTN","OREVNT",122,0)
 . S ORPTEVT=$$NEW(DFN,ORDAD,$G(ORIFN)),ORDIALOG="" K ORIFN
"RTN","OREVNT",123,0)
 I ORDIALOG S ORIFN=+$$ORDER^ORCDLG(ORDIALOG) I ORIFN<1 Q "^"
"RTN","OREVNT",124,0)
 S ORPTEVT=$$NEW(DFN,+OREVT,$G(ORIFN)) I ORPTEVT<1 Q "^"
"RTN","OREVNT",125,0)
 I ORDSET,'$G(DLGONLY) S OREVENT=+ORPTEVT D EN^ORCDLG(ORDSET) K ^TMP("ORECALL",$J)
"RTN","OREVNT",126,0)
 D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(DFN) ;unlock if no new orders
"RTN","OREVNT",127,0)
PTQ Q ORPTEVT
"RTN","OREVNT",128,0)
 ;
"RTN","OREVNT",129,0)
HELP(RSP) ; -- ?help for DIR Event lookup
"RTN","OREVNT",130,0)
 N X,Y,Z,CNT,DONE
"RTN","OREVNT",131,0)
 W !,"Select the release event for which you wish to delay orders."
"RTN","OREVNT",132,0)
 W !,"Choose from:" S CNT=1
"RTN","OREVNT",133,0)
 S X="" F  S X=$O(^ORD(100.5,"C",X)) Q:X=""  D  Q:$G(DONE)
"RTN","OREVNT",134,0)
 . S Y=0 F  S Y=$O(^ORD(100.5,"C",X,Y)) Q:Y<1  D  Q:$G(DONE)
"RTN","OREVNT",135,0)
 .. Q:$O(^ORD(100.5,"DAD",Y,0))  ;Parent event
"RTN","OREVNT",136,0)
 .. S TYPE=$P($G(^ORD(100.5,Y,0)),U,2)
"RTN","OREVNT",137,0)
 .. I RSP="?" Q:TYPE="A"&$G(ORWARD)  Q:TYPE'="A"&'$G(ORWARD)
"RTN","OREVNT",138,0)
 .. W !,"   "_X S CNT=CNT+1 Q:CNT'>(IOSL-3)  S CNT=0
"RTN","OREVNT",139,0)
 .. W !,"   '^' TO STOP: " R Z:DTIME S:'$T!(Z["^") DONE=1
"RTN","OREVNT",140,0)
 Q
"RTN","OREVNT",141,0)
 ;
"RTN","OREVNT",142,0)
NEW(DFN,EVT,IFN) ; -- Create new Patient Event in #100.2
"RTN","OREVNT",143,0)
 I '$G(DFN) Q "^"
"RTN","OREVNT",144,0)
 N I,HDR,LAST,TOTAL,DA,ADM,DAD,X0
"RTN","OREVNT",145,0)
 F I=1:1:10 L +^ORE(100.2,0):1 Q:$T  H 2
"RTN","OREVNT",146,0)
 I '$T Q "^"
"RTN","OREVNT",147,0)
 S HDR=$G(^ORE(100.2,0)),TOTAL=+$P(HDR,U,4),LAST=$O(^ORE(100.2,"?"),-1)
"RTN","OREVNT",148,0)
 S I=LAST F I=(I+1):1 Q:'$D(^ORE(100.2,I,0))
"RTN","OREVNT",149,0)
 S DA=I,$P(HDR,U,3,4)=DA_U_(TOTAL+1),DFN=+DFN
"RTN","OREVNT",150,0)
 S ^ORE(100.2,0)=HDR ;195 Moved unlock to later in code
"RTN","OREVNT",151,0)
 S X0=$G(^ORD(100.5,+$G(EVT),0)) I $P(X0,U,12) D  ;link to parent event
"RTN","OREVNT",152,0)
 . S DAD=+$P(X0,U,12),$P(X0,U,2)=$P($G(^ORD(100.5,DAD,0)),U,2)
"RTN","OREVNT",153,0)
 . S DAD=+$O(^ORE(100.2,"AE",DFN,DAD,0)) Q:DAD<1
"RTN","OREVNT",154,0)
 . S $P(^ORE(100.2,DA,1),U,5)=DAD,^ORE(100.2,"DAD",DAD,DA)=""
"RTN","OREVNT",155,0)
 S ADM=$S('$G(EVT):$G(VAIP(13)),$P(X0,U,2)="A":"",$P(X0,U,2)="T"&$$NHCU(EVT):"",1:+$G(^DPT(DFN,.105)))
"RTN","OREVNT",156,0)
 S ^ORE(100.2,"B",DFN,DA)="" S:$G(IFN) IFN=+IFN
"RTN","OREVNT",157,0)
 S ^ORE(100.2,DA,0)=DFN_U_$G(EVT)_U_ADM_U_$G(IFN)_U_+$E($$NOW^XLFDT,1,12)_U_$G(DUZ)
"RTN","OREVNT",158,0)
 S:$G(EVT) ^ORE(100.2,"E",EVT,DA)="",^ORE(100.2,"AE",DFN,EVT,DA)=""
"RTN","OREVNT",159,0)
 I $G(IFN) S ^ORE(100.2,"AO",IFN,DA)="",$P(^OR(100,IFN,0),U,17)=DA,^OR(100,"AEVNT",DFN_";DPT(",DA,IFN)=""
"RTN","OREVNT",160,0)
 L -^ORE(100.2,0) ;195 Unlock after global is set
"RTN","OREVNT",161,0)
 Q DA
"RTN","OREVNT",162,0)
 ;
"RTN","OREVNT",163,0)
NHCU(OREVT) ; -- Returns 1 or 0, if EVT is to NHCU
"RTN","OREVNT",164,0)
 N ORI,ORX,ORY S (ORI,ORY)=0
"RTN","OREVNT",165,0)
 F  S ORI=$O(^ORD(100.5,+$G(OREVT),"TS",ORI)) Q:ORI<1  S ORX=+$G(^(ORI,0)) I $$GET1^DIQ(45.7,ORX_",","SPECIALTY:SERVICE")="NHCU" S ORY=1 Q  ;DBIA #1154
"RTN","OREVNT",166,0)
 Q ORY
"RTN","OREVNT",167,0)
 ;
"RTN","OREVNT",168,0)
DELETE(DA) ; -- Delete Patient Event
"RTN","OREVNT",169,0)
 N DIK S DIK="^ORE(100.2," D:$G(DA) ^DIK
"RTN","OREVNT",170,0)
 Q
"RTN","OREVNT",171,0)
 ;
"RTN","OREVNT",172,0)
MATCH(DFN,EVT) ; -- Does Pt's current data match selected Event?
"RTN","OREVNT",173,0)
 N X0,Y,LOC,WD,TS,PEVT ;177 This section updated to account for child events
"RTN","OREVNT",174,0)
 S PEVT=$P($G(^ORD(100.5,EVT,0)),U,12) ;177 Is this a child event?
"RTN","OREVNT",175,0)
 S X0=$G(^ORD(100.5,$S($G(PEVT):PEVT,1:EVT),0)),Y=1 ;177
"RTN","OREVNT",176,0)
 I "^D^O^M^"[(U_$P(X0,U,2)_U) S Y=0 G MQ
"RTN","OREVNT",177,0)
 S LOC=$S($G(ORL):+ORL,1:+$$CURRLOC(DFN)),WD=+$G(^SC(LOC,42))
"RTN","OREVNT",178,0)
 I $$DIV^ORMEVNT(LOC)'=$P(X0,U,3) S Y=0 G MQ
"RTN","OREVNT",179,0)
 S TS=$S($G(ORTS):+ORTS,1:+$G(^DPT(DFN,.103)))
"RTN","OREVNT",180,0)
 I $O(^ORD(100.5,$S($G(PEVT):PEVT,1:EVT),"TS",0)),'$D(^("B",TS)) S Y=0 G MQ ;177
"RTN","OREVNT",181,0)
 I $O(^ORD(100.5,$S($G(PEVT):PEVT,1:EVT),"LOC",0)),'$D(^("B",WD)) S Y=0 G MQ ;177
"RTN","OREVNT",182,0)
MQ Q Y
"RTN","OREVNT",183,0)
 ;
"RTN","OREVNT",184,0)
CURRLOC(DFN) ; -- Return current Hospital Location (ptr to #44) of patient DFN
"RTN","OREVNT",185,0)
 N X,Y S X=$P($G(^DPT(DFN,.1)),U),Y=""
"RTN","OREVNT",186,0)
 I $L(X) S X=+$O(^DIC(42,"B",X,0)),Y=+$G(^DIC(42,X,44))
"RTN","OREVNT",187,0)
 Q Y
"RTN","OREVNT",188,0)
 ;
"RTN","OREVNT",189,0)
CONT() ; -- ok to continue?
"RTN","OREVNT",190,0)
 N X,Y,DIR
"RTN","OREVNT",191,0)
 S DIR("A",1)=ORPNM_" is already assigned to "_$P($G(^DIC(45.7,+$G(ORTS),0)),U)_" on "_$P($G(^SC(+$G(ORL),0)),U)_"!"
"RTN","OREVNT",192,0)
 S DIR(0)="YA",DIR("A")="Do you still want to add future orders? "
"RTN","OREVNT",193,0)
 S DIR("?")="Enter YES to add orders that will be delayed until this event occurs in the future, or NO to quit."
"RTN","OREVNT",194,0)
 S DIR("B")="NO" W ! D ^DIR S:$D(DTOUT)!$D(DUOUT) Y="^"
"RTN","OREVNT",195,0)
 Q Y
"RTN","OREVNT1")
0^64^B46189289
"RTN","OREVNT1",1,0)
OREVNT1 ;SLC/MKB - Release delayed orders ;3/31/04  09:08
"RTN","OREVNT1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,195**;Dec 17, 1997
"RTN","OREVNT1",3,0)
 ;
"RTN","OREVNT1",4,0)
EN ; -- start here
"RTN","OREVNT1",5,0)
 I '$$CANREL^OREV3() W !,"Insufficient privilege!" H 1 Q
"RTN","OREVNT1",6,0)
 N ORPTLK,ORLR,ORACT,ORNATR,ORI,NMBR,IDX,ORDER,ORIFN,ORDA,ORQUIT,ORES,ORWAIT,ORSIG,OREL,ORPRNT,ORPRINT,ORCHART,ORWORK,ORLAB,OR0,ORA0,ORERR,ORCL,OREVT,OREVENT,J ;195
"RTN","OREVNT1",7,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q
"RTN","OREVNT1",8,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") G:'ORNMBR ENQ
"RTN","OREVNT1",9,0)
 D FREEZE^ORCMENU S VALMBCK="R" K OREBUILD
"RTN","OREVNT1",10,0)
 S ORL=$$LOCATION^ORCMENU1 G:ORL="^" ENQ ;I '$G(ORL)
"RTN","OREVNT1",11,0)
 S ORLR=+$O(^DIC(9.4,"C","LR",0)),(ORACT,ORNATR)=""
"RTN","OREVNT1",12,0)
 I $$NEEDSIG S ORACT=$S($D(^XUSEC("ORES",DUZ)):"ES",$D(^XUSEC("OREMAS",DUZ)):"OC",$D(^XUSEC("ORELSE",DUZ)):$$SELSIG^ORCSIGN,1:"^") G:ORACT="^" ENQ
"RTN","OREVNT1",13,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) I NMBR D
"RTN","OREVNT1",14,0)
 . S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),ORDER=$P(IDX,U)
"RTN","OREVNT1",15,0)
 . Q:'ORDER  S:'$P(ORDER,";",2) ORDER=+ORDER_";1"
"RTN","OREVNT1",16,0)
 . S ORIFN=+ORDER,ORDA=+$P(ORDER,";",2) K ORQUIT
"RTN","OREVNT1",17,0)
 . D VALID Q:$G(ORQUIT)  S ORES(ORDER)=""
"RTN","OREVNT1",18,0)
 . S:$P($G(^OR(100,ORIFN,0)),U,14)=ORLR ORES("LAB")=1
"RTN","OREVNT1",19,0)
EN1 G:'$O(ORES(0)) ENQ K ORQUIT,ORWAIT
"RTN","OREVNT1",20,0)
 ;D ORDCHK^ORCMENU1 G:'$O(ORES(0)) ENQ0
"RTN","OREVNT1",21,0)
 ;I $G(ORQUIT) D UNLOCK G ENQ ;quit - ^ at override reason
"RTN","OREVNT1",22,0)
 S ORSIG=$S($G(ORES("ES")):2,1:""),OREL=$S(ORSIG:0,1:1)
"RTN","OREVNT1",23,0)
 I ORSIG D  I ORSIG=2,'OREL W !,"Nothing signed or released!" D UNLOCK H 2 G ENQ
"RTN","OREVNT1",24,0)
 . I ORACT="ES" S:$$ESIG^ORCSIGN ORSIG=1,OREL=1 Q
"RTN","OREVNT1",25,0)
 . I ORACT="OC" S:$$ONCHART^ORCSIGN ORSIG=0,OREL=1,ORNATR="W" Q
"RTN","OREVNT1",26,0)
 . S ORNATR=$$NATURE^ORCSIGN Q:ORNATR="^"  ;ORACT="RS"
"RTN","OREVNT1",27,0)
 . W:ORNATR'="I" !!,"A signature is required to RELEASE these orders; the responsible provider will",!,"be alerted to electronically sign them."
"RTN","OREVNT1",28,0)
 . S:$$ESIG^ORCSIGN ORSIG=$S(ORNATR="I":1,1:$$SIGSTS^ORX1(ORNATR)),OREL=1
"RTN","OREVNT1",29,0)
 S ORPRNT=$$GET^XPAR("ALL","ORPF PRINT CHART COPY WHEN")
"RTN","OREVNT1",30,0)
 S (ORPRINT,ORCHART,ORWORK,ORLAB)=0
"RTN","OREVNT1",31,0)
 I '$D(^XUSEC("ORES",DUZ))!$$GET^XPAR("ALL","ORPF SHOW LAB #") S ORLAB=ORLR ;show Lab# when released
"RTN","OREVNT1",32,0)
 W !!,"Processing orders ..." D:$G(ORES("LAB")) BHS^ORMBLD(ORVP)
"RTN","OREVNT1",33,0)
EN2 S ORDER=0 F  S ORDER=$O(ORES(ORDER)) Q:ORDER'>0  D
"RTN","OREVNT1",34,0)
 . S OR0=$G(^OR(100,+ORDER,0)),ORA0=$G(^(8,+$P(ORDER,";",2),0))
"RTN","OREVNT1",35,0)
 . I '$$LCKEVT^ORX2($P(OR0,U,17)) S EVENT($P(OR0,U,17))="" Q  ;195 Don't process if event locked
"RTN","OREVNT1",36,0)
 . N ORNP S ORNP=$P(ORA0,U,3),ORIFN=+ORDER,ORDA=+$P(ORDER,";",2)
"RTN","OREVNT1",37,0)
 . S:$G(ORL) $P(^OR(100,ORIFN,0),U,10)=ORL ;set location
"RTN","OREVNT1",38,0)
 . S:$G(ORTS) $P(^OR(100,ORIFN,0),U,13)=ORTS ;set specialty
"RTN","OREVNT1",39,0)
 . D EN2^ORCSEND(ORDER,ORSIG,ORNATR,.ORERR),UNLK1^ORX2(ORIFN)
"RTN","OREVNT1",40,0)
 . I $D(^TMP("ORNEW",$J,ORIFN,ORDA)) K ^(ORDA) D UNLK1^ORX2(ORIFN)
"RTN","OREVNT1",41,0)
 . I $G(ORERR) D  S ORWAIT=1 Q
"RTN","OREVNT1",42,0)
 . . W !!,$$ORDITEM^ORCACT(ORDER)_" "_$$STATUS^ORCSIGN(ORDER)
"RTN","OREVNT1",43,0)
 . . W:$L($P($G(ORERR),U,2)) !,"  >> "_$P(ORERR,U,2)
"RTN","OREVNT1",44,0)
 . I $P(OR0,U,14)=ORLAB,$G(^OR(100,ORIFN,4)) W !,$$ORDITEM^ORCACT(ORIFN)_"  (LB #"_+^OR(100,ORIFN,4)_")" S ORWAIT=1
"RTN","OREVNT1",45,0)
 . S ORV=+$P(OR0,U,17),OREVT(ORV)="" D SETPRINT(ORNATR)
"RTN","OREVNT1",46,0)
 . D:$$TYPE^OREVNTX(ORV)="M" SAVE^ORMEVNT1(ORIFN,ORV,2) W "."
"RTN","OREVNT1",47,0)
 D:$G(ORES("LAB")) BTS^ORMBLD(ORVP)
"RTN","OREVNT1",48,0)
EN3 I $O(ORCHART(0))!$O(ORPRINT(0)) S ORCL=$$LOC^ORMEVNT I ORCL,ORCL'=ORL D
"RTN","OREVNT1",49,0)
 . N X,Y,DIR S DIR(0)="YA",DIR("B")="YES"
"RTN","OREVNT1",50,0)
 . S DIR("A",1)="This patient's location has been changed to "_$P($G(^SC(+ORCL,0)),U)_"."
"RTN","OREVNT1",51,0)
 . S DIR("A")="Should the orders be printed using the new location? "
"RTN","OREVNT1",52,0)
 . S DIR("?")="Enter NO to continue using "_$P($G(^SC(+ORL,0)),U)_" for ordering and printing, or YES to switch to the patient's current location instead"
"RTN","OREVNT1",53,0)
 . D ^DIR S:Y ORL=ORCL
"RTN","OREVNT1",54,0)
 D:$O(ORCHART(0)) PRINT^ORPR02(ORVP,.ORCHART,,ORL,"1^0^0^0^0")
"RTN","OREVNT1",55,0)
 D:$O(ORPRINT(0)) PRINT^ORPR02(ORVP,.ORPRINT,,ORL,"0^1^1^1^0")
"RTN","OREVNT1",56,0)
 D:$O(ORWORK(0)) PRINT^ORPR02(ORVP,.ORWORK,,ORL,"0^0^0^0^1")
"RTN","OREVNT1",57,0)
ENQ0 D UNOTIF^ORCSIGN,EMPTY S OREBUILD=1
"RTN","OREVNT1",58,0)
ENQ D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) D:$G(ORWAIT) READ ;output
"RTN","OREVNT1",59,0)
 I $D(EVENT) W !!,"Orders not released >> Delayed event being processed by another user!" D READ S J=0 F  S J=$O(EVENT(J)) Q:'+J  D UNLEVT^ORX2(J) ;195
"RTN","OREVNT1",60,0)
 Q
"RTN","OREVNT1",61,0)
 ;
"RTN","OREVNT1",62,0)
SETPRINT(NATR) ; -- Set print arrays
"RTN","OREVNT1",63,0)
 S:'$L(NATR)!($P(ORA0,U,4)'=2) NATR=$P(ORA0,U,12)
"RTN","OREVNT1",64,0)
 S ORPRINT=ORPRINT+1,ORPRINT(ORPRINT)=ORDER
"RTN","OREVNT1",65,0)
 I ("R"[ORPRNT)!(ORPRNT="S"&($P(ORA0,U,4)=2)&(ORSIG'=2)),$$CHART^ORX1(NATR) S ORCHART=ORCHART+1,ORCHART(ORCHART)=ORDER
"RTN","OREVNT1",66,0)
 S:$$WORK(NATR) ORWORK=ORWORK+1,ORWORK(ORWORK)=ORDER
"RTN","OREVNT1",67,0)
 Q
"RTN","OREVNT1",68,0)
 ;
"RTN","OREVNT1",69,0)
WORK(NATR) ; -- Returns 1 or 0, to print work copies for NATR
"RTN","OREVNT1",70,0)
 S:$G(NATR)="" NATR="E" S:'NATR NATR=+$O(^ORD(100.02,"C",NATR,0))
"RTN","OREVNT1",71,0)
 Q +$P($G(^ORD(100.02,NATR,1)),U,5)
"RTN","OREVNT1",72,0)
 ;
"RTN","OREVNT1",73,0)
NEEDSIG()       ; -- Return 1 or 0, if any selected orders need ES
"RTN","OREVNT1",74,0)
 N ORI,NMBR,ORIFN,ORDA,Y S Y=0
"RTN","OREVNT1",75,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) I NMBR D  Q:Y
"RTN","OREVNT1",76,0)
 . S ORIFN=$P($G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),U) Q:'ORIFN
"RTN","OREVNT1",77,0)
 . S ORDA=+$P(ORIFN,";",2),ORIFN=+ORIFN S:'ORDA ORDA=1
"RTN","OREVNT1",78,0)
 . S:$P($G(^OR(100,ORIFN,8,ORDA,0)),U,4)=2 ORES("ES")=1,Y=1
"RTN","OREVNT1",79,0)
 Q Y
"RTN","OREVNT1",80,0)
 ;
"RTN","OREVNT1",81,0)
VALID ; -- validate ORDER for signature/release
"RTN","OREVNT1",82,0)
 I '$$VALID^ORCACT0(ORDER,"MN",.ORERR) W !!,"Cannot release "_$$ORDITEM^ORCACT(ORDER),!,"  >> "_ORERR S (ORQUIT,ORWAIT)=1 Q
"RTN","OREVNT1",83,0)
 I $L(ORACT),$P($G(^OR(100,ORIFN,8,ORDA,0)),U,4)=2,'$$VALID^ORCACT0(ORDER,ORACT,.ORERR,ORNATR) W !!,"Cannot sign "_$$ORDITEM^ORCACT(ORDER),!,"  >> "_ORERR S (ORQUIT,ORWAIT)=1 Q
"RTN","OREVNT1",84,0)
 N ORLK,ORDIALOG S ORLK=$$LOCK1^ORX2(ORIFN)
"RTN","OREVNT1",85,0)
 I 'ORLK W !!,"Cannot release "_$$ORDITEM^ORCACT(ORDER),!,"  >> "_$P(ORLK,U,2) S (ORQUIT,ORWAIT)=1 Q  ;order locked
"RTN","OREVNT1",86,0)
 S ORDIALOG=+$P($G(^OR(100,ORIFN,0)),U,5)
"RTN","OREVNT1",87,0)
 I $L($G(^ORD(101.41,ORDIALOG,7))) X ^(7) D:$G(ORQUIT) UNLK1^ORX2(ORIFN)
"RTN","OREVNT1",88,0)
 Q
"RTN","OREVNT1",89,0)
 ;
"RTN","OREVNT1",90,0)
EMPTY ; -- check if no more orders for events in OREVT()
"RTN","OREVNT1",91,0)
 N EVT,X
"RTN","OREVNT1",92,0)
 S EVT=0 F  S EVT=$O(OREVT(EVT)) Q:EVT<1  D  ;terminate any events?
"RTN","OREVNT1",93,0)
 . Q:$G(^ORE(100.2,EVT,1))  Q:'$$EMPTY^OREVNTX(EVT)  ;active,empty
"RTN","OREVNT1",94,0)
 . ;W !!,$P($$NAME^OREVNTX(EVT)," ",2,99)_" has no more delayed orders."
"RTN","OREVNT1",95,0)
 . ;S DIR(0)="YA",DIR("A")="Do you want to terminate this event? "
"RTN","OREVNT1",96,0)
 . ;S DIR("?")="Enter NO if you wish to enter new delayed orders for this event, otherwise enter YES to terminate it."
"RTN","OREVNT1",97,0)
 . ;S DIR("B")="YES" D ^DIR I $D(DTOUT)!$D(DUOUT) S ORQUIT=1 Q
"RTN","OREVNT1",98,0)
 . D DONE^OREVNTX(EVT),ACTLOG^OREVNTX(EVT,"MN")
"RTN","OREVNT1",99,0)
 . S X=$P($$NAME^OREVNTX(EVT)," ",2,99)
"RTN","OREVNT1",100,0)
 . W !,"   ... "_X_" event completed." H 1
"RTN","OREVNT1",101,0)
 . D:$G(OREVENT) EX^OREVNT ;return view to Active
"RTN","OREVNT1",102,0)
 Q
"RTN","OREVNT1",103,0)
 ;
"RTN","OREVNT1",104,0)
UNLOCK ; -- Unlock orders in ORES(ORDER)
"RTN","OREVNT1",105,0)
 N ORIFN S ORIFN=0
"RTN","OREVNT1",106,0)
 F  S ORIFN=$O(ORES(ORIFN)) Q:ORIFN'>0  D UNLK1^ORX2(+ORIFN)
"RTN","OREVNT1",107,0)
 Q
"RTN","OREVNT1",108,0)
 ;
"RTN","OREVNT1",109,0)
READ ; -- Press return to continue
"RTN","OREVNT1",110,0)
 N X,Y,DIR
"RTN","OREVNT1",111,0)
 S DIR(0)="EA",DIR("A")="Press <return> to continue ..."
"RTN","OREVNT1",112,0)
 D ^DIR
"RTN","OREVNT1",113,0)
 Q
"RTN","OREVNT1",114,0)
 ;
"RTN","OREVNT1",115,0)
DONE() ; -- OREVENT done?
"RTN","OREVNT1",116,0)
 Q:'$G(^ORE(100.2,+$G(OREVENT),1)) 0  ;not done yet
"RTN","OREVNT1",117,0)
 D FULL^VALM1
"RTN","OREVNT1",118,0)
 W !!,"The event "_$$NAME^OREVNTX(OREVENT)_" has occurred since"
"RTN","OREVNT1",119,0)
 W !,"you started writing delayed orders.  The orders that were signed have now been"
"RTN","OREVNT1",120,0)
 W !,"released; any unsigned orders will be released immediately upon signature."
"RTN","OREVNT1",121,0)
 W !!,"To write new delayed orders for this event you must select the Delayed Orders"
"RTN","OREVNT1",122,0)
 W !,"action and this release event again.  Orders delayed to this same event will"
"RTN","OREVNT1",123,0)
 W !,"remain delayed until the event occurs again."
"RTN","OREVNT1",124,0)
 W !!,"The Orders tab will now be refreshed in the Active Orders view; you may then"
"RTN","OREVNT1",125,0)
 W !,"write active orders for this patient as usual."
"RTN","OREVNT1",126,0)
 D READ S XQORQUIT=1 D EX^OREVNT ;return view to Active
"RTN","OREVNT1",127,0)
 Q 1
"RTN","ORIMO")
0^62^B1801970
"RTN","ORIMO",1,0)
ORIMO ;SLC/JDL - Inpatient medication on outpatient ;12/19/04  12:01
"RTN","ORIMO",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**187,190,195**;Dec 17, 1997
"RTN","ORIMO",3,0)
IMOLOC(ORY,ORLOC,ORDFN) ;ORY>=0: LOC is an IMO authorized location
"RTN","ORIMO",4,0)
 S ORY=-1
"RTN","ORIMO",5,0)
 N PACH
"RTN","ORIMO",6,0)
 S PACH=$$PATCH^XPDUTL("PSJ*5.0*111")
"RTN","ORIMO",7,0)
 Q:'PACH
"RTN","ORIMO",8,0)
 I $L($TEXT(SDIMO^SDAMA203)) D
"RTN","ORIMO",9,0)
 . ;#DBIA 4133
"RTN","ORIMO",10,0)
 . S ORY=$$SDIMO^SDAMA203(ORLOC,ORDFN)
"RTN","ORIMO",11,0)
 . K SDIMO(1)
"RTN","ORIMO",12,0)
 Q
"RTN","ORIMO",13,0)
 ; 
"RTN","ORIMO",14,0)
IMOOD(ORY,ORDERID) ;Is it an IMO order?
"RTN","ORIMO",15,0)
 Q:'$D(^OR(100,+ORDERID,0))
"RTN","ORIMO",16,0)
 N PIMO,DGRP,IMOGRP,ISIMO
"RTN","ORIMO",17,0)
 S (PIMO,DGRP,ISIMO)=0
"RTN","ORIMO",18,0)
 I $P($G(^OR(100,+ORDERID,0)),U,18)>0 S PIMO=1
"RTN","ORIMO",19,0)
 S DGRP=$P($G(^OR(100,+ORDERID,0)),U,11)
"RTN","ORIMO",20,0)
 S IMOGRP=$O(^ORD(100.98,"B","CLINIC MEDICATIONS",0))
"RTN","ORIMO",21,0)
 I DGRP=IMOGRP S ISIMO=1
"RTN","ORIMO",22,0)
 I PIMO,ISIMO S ORY=1
"RTN","ORIMO",23,0)
 Q
"RTN","ORIMO",24,0)
 ;
"RTN","ORIMO",25,0)
ISCLOC(ORY,ALOC) ;Is it a clinical location
"RTN","ORIMO",26,0)
 S ORY=0
"RTN","ORIMO",27,0)
 Q:'$D(^SC(+ALOC,0))
"RTN","ORIMO",28,0)
 I $P(^SC(+ALOC,0),U,3)="C" S ORY=1
"RTN","ORIMO",29,0)
 Q
"RTN","ORIMO",30,0)
ISIVQO(ORY,DLGID) ;Is it an IV quick order
"RTN","ORIMO",31,0)
 S ORY=0
"RTN","ORIMO",32,0)
 Q:'$D(^ORD(101.41,DLGID,0))
"RTN","ORIMO",33,0)
 N IVGRP,DLGTYP,DLGGRP
"RTN","ORIMO",34,0)
 S IVGRP=$O(^ORD(100.98,"B","IV RX",0))
"RTN","ORIMO",35,0)
 S DLGTYP=$P($G(^ORD(101.41,DLGID,0)),U,4)
"RTN","ORIMO",36,0)
 S DLGGRP=$P($G(^ORD(101.41,DLGID,0)),U,5)
"RTN","ORIMO",37,0)
 I (DLGTYP="Q"),(DLGGRP=IVGRP) S ORY=1
"RTN","ORIMO",38,0)
 Q
"RTN","ORM")
0^88^B17869206
"RTN","ORM",1,0)
ORM ; SLC/MKB/JDL - ORM msg router ;11/17/00  10:58
"RTN","ORM",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,97,141,187,195**;Dec 17, 1997
"RTN","ORM",3,0)
EN(MSG) ; -- main entry point for OR RECEIVE where MSG contains HL7 msg
"RTN","ORM",4,0)
 N ORMSG,ORNMSP,ORTYPE,MSH,PID,PV1,ORC,ORVP,ORTS,ORL,ORCAT,ORAPPT
"RTN","ORM",5,0)
 S ORAPPT="",ORL=0
"RTN","ORM",6,0)
 S ORMSG=$S($L($G(MSG)):MSG,1:"MSG") ; MSG="NAME" or MSG(#)=message
"RTN","ORM",7,0)
 I '$O(@ORMSG@(0)) D EN^ORERR("Missing HL7 message",.ORMSG) Q
"RTN","ORM",8,0)
 S MSH=0 F  S MSH=$O(@ORMSG@(MSH)) Q:MSH'>0  Q:$E(@ORMSG@(MSH),1,3)="MSH"
"RTN","ORM",9,0)
 I 'MSH D EN^ORERR("Missing or invalid MSH segment",.ORMSG) Q
"RTN","ORM",10,0)
 S ORNMSP=$$NMSP($P(@ORMSG@(MSH),"|",3)),ORTYPE=$P(@ORMSG@(MSH),"|",9)
"RTN","ORM",11,0)
 I '$L(ORNMSP) D EN^ORERR("Missing or invalid sending application",.ORMSG) Q
"RTN","ORM",12,0)
 D PID I '$G(ORVP) D EN^ORERR("Missing or invalid patient ID",.ORMSG) Q
"RTN","ORM",13,0)
 D PV1 S ORC=PID
"RTN","ORM",14,0)
EN1 F  S ORC=$O(@ORMSG@(+ORC)) Q:ORC'>0  I $E(@ORMSG@(ORC),1,3)="ORC" D
"RTN","ORM",15,0)
 . N ORDCNTRL,ORDSTS,PKGIFN,ORIFN,ORNP,ORTN,ORERR,ORLOG,ORDUZ,ORQT,ORSTRT,ORSTOP,ORURG,ORNATR,OREASON
"RTN","ORM",16,0)
 . S ORC=ORC_U_@ORMSG@(ORC),ORDCNTRL=$TR($P(ORC,"|",2),"@","P")
"RTN","ORM",17,0)
 . I '$L(ORDCNTRL) S ORERR="Invalid control code" D ERROR Q
"RTN","ORM",18,0)
 . S ORIFN=$P($P(ORC,"|",3),U),PKGIFN=$P($P(ORC,"|",4),U)
"RTN","ORM",19,0)
 . I ORIFN,$D(^OR(100,+ORIFN,0)),$P(^(0),U,2)'=ORVP S ORERR="Patient doesn't match" D ERROR Q
"RTN","ORM",20,0)
 . S ORDSTS=$P(ORC,"|",6),ORQT=$P(ORC,"|",8)
"RTN","ORM",21,0)
 . S ORSTRT=$$FMDATE($P(ORQT,U,4)),ORSTOP=$$FMDATE($P(ORQT,U,5))
"RTN","ORM",22,0)
 . S ORURG=$$URGENCY($P(ORQT,U,6)),ORLOG=$$FMDATE($P(ORC,"|",10))
"RTN","ORM",23,0)
 . S ORDUZ=+$P(ORC,"|",11),ORNP=+$P(ORC,"|",13),OREASON=$P(ORC,"|",17)
"RTN","ORM",24,0)
 . S ORNATR=$S($P(OREASON,U,3)="99ORN":$P(OREASON,U),1:"")
"RTN","ORM",25,0)
 . S ORTN="EN^ORM"_ORNMSP D @ORTN I $D(ORERR) D ERROR Q
"RTN","ORM",26,0)
 . I ORDCNTRL="SN",$G(ORIFN) D MSG^ORMBLD(ORIFN,"NA")
"RTN","ORM",27,0)
 . I $G(DGPMT),ORDCNTRL="OD"!(ORDCNTRL="OC") D XTMP
"RTN","ORM",28,0)
 Q
"RTN","ORM",29,0)
 ;
"RTN","ORM",30,0)
NMSP(NAME) ; -- Returns pkg namespace
"RTN","ORM",31,0)
 I NAME="RADIOLOGY"!(NAME="IMAGING") Q "RA"
"RTN","ORM",32,0)
 I NAME="LABORATORY" Q "LR"
"RTN","ORM",33,0)
 I NAME="DIETETICS" Q "FH"
"RTN","ORM",34,0)
 I NAME="PHARMACY" Q "PS"
"RTN","ORM",35,0)
 I NAME="CONSULTS" Q "GMRC"
"RTN","ORM",36,0)
 I NAME="PROCEDURES" Q "GMRC"
"RTN","ORM",37,0)
 I NAME="ORDER ENTRY" Q "ORG"
"RTN","ORM",38,0)
 Q ""
"RTN","ORM",39,0)
 ;
"RTN","ORM",40,0)
PID ; -- Returns patient from PID segment in current msg
"RTN","ORM",41,0)
 ;    Sets PID, ORVP, ORTS if valid patient
"RTN","ORM",42,0)
 N I,DFN,SEG S I=MSH,PID=""
"RTN","ORM",43,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="PID" D  Q
"RTN","ORM",44,0)
 . S DFN=+$P(@ORMSG@(I),"|",4),PID=I
"RTN","ORM",45,0)
 . I $D(^DPT(DFN,0)) S ORVP=DFN_";DPT(",ORTS=$G(^DPT(DFN,.103)) Q
"RTN","ORM",46,0)
 . S:$L($P(@ORMSG@(I),"|",5)) ORVP=$P(@ORMSG@(I),"|",5) ; alt ID for Lab
"RTN","ORM",47,0)
 Q
"RTN","ORM",48,0)
 ;
"RTN","ORM",49,0)
PV1 ; -- Returns patient location in PV1 segment in current msg
"RTN","ORM",50,0)
 ;    Sets PV1, ORCAT, & ORL if valid location, ORAPPT: IMO appointment
"RTN","ORM",51,0)
 N I,X,SEG S I=PID,PV1=""
"RTN","ORM",52,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="PV1" D  Q
"RTN","ORM",53,0)
 . S X=+$P(@ORMSG@(I),"|",4),ORCAT=$P(@ORMSG@(I),"|",3),PV1=I
"RTN","ORM",54,0)
 . S:$D(^SC(X,0)) ORL=X_";SC("
"RTN","ORM",55,0)
 . S ORAPPT=$P(@ORMSG@(I),"|",45)
"RTN","ORM",56,0)
 . S:+$G(ORAPPT) ORAPPT=$$FMDATE($G(ORAPPT))
"RTN","ORM",57,0)
 Q
"RTN","ORM",58,0)
 ;
"RTN","ORM",59,0)
ORDITEM(USID) ; -- Returns pointer to Orderable Item file for USID
"RTN","ORM",60,0)
 N ID,OI
"RTN","ORM",61,0)
 S ID=$P(USID,U,4)_";"_$P(USID,U,6)
"RTN","ORM",62,0)
 S OI=+$O(^ORD(101.43,"ID",ID,0))
"RTN","ORM",63,0)
 Q OI
"RTN","ORM",64,0)
 ;
"RTN","ORM",65,0)
URGENCY(CODE) ; -- Return ptr to Order Urgency file #101.42
"RTN","ORM",66,0)
 S:'$L(CODE) CODE="R"
"RTN","ORM",67,0)
 Q $O(^ORD(101.42,"C",CODE,0))
"RTN","ORM",68,0)
 ;
"RTN","ORM",69,0)
FMDATE(Y) ; -- Convert HL7 date/time to FM format
"RTN","ORM",70,0)
 Q $$HL7TFM^XLFDT(Y)  ;**97
"RTN","ORM",71,0)
 ;
"RTN","ORM",72,0)
ERROR ; -- Sends a DE reply to current msg
"RTN","ORM",73,0)
 ; Uses ORVP, ORNMSP, ORDUZ, ORIFN, ORERR, and PKGIFN
"RTN","ORM",74,0)
 N ORV S ORV("XQY0")="" D EN^ORERR(ORERR,.ORMSG,.ORV)
"RTN","ORM",75,0)
 Q:ORTYPE="ORR"  Q:'$L($G(ORNMSP))
"RTN","ORM",76,0)
 N OREMSG,ORVP,ORTS S:'$G(ORDUZ) ORDUZ=DUZ D:'$G(ORVP) PID
"RTN","ORM",77,0)
 S OREMSG(1)=$$MSH^ORMBLD("ORR",ORNMSP),OREMSG(2)=$$PID^ORMBLD($G(ORVP))
"RTN","ORM",78,0)
 S OREMSG(3)="ORC|DE|"_$S($G(ORIFN):ORIFN_"^OR",1:"")_"|"_$S($L($G(PKGIFN)):PKGIFN_U_ORNMSP,1:"")_"|||||||"_ORDUZ_"||||||"_ORERR
"RTN","ORM",79,0)
 D MSG^XQOR("OR EVSEND "_ORNMSP,.OREMSG)
"RTN","ORM",80,0)
 Q
"RTN","ORM",81,0)
 ;
"RTN","ORM",82,0)
FIND(SEG,PIECE) ; -- Returns value in $P(@ORMSG@(SEG),"|",PIECE)
"RTN","ORM",83,0)
 N X,Y,FLDS,I,DONE
"RTN","ORM",84,0)
 S X=$G(@ORMSG@(SEG)),FLDS=$L(X,"|"),Y="",(I,DONE)=0
"RTN","ORM",85,0)
 F  D  Q:DONE
"RTN","ORM",86,0)
 . I PIECE<FLDS S Y=$P(X,"|",PIECE),DONE=1 Q
"RTN","ORM",87,0)
 . I PIECE=FLDS D  Q
"RTN","ORM",88,0)
 . . S Y=$P(X,"|",PIECE),I=$O(@ORMSG@(SEG,I)),DONE=1
"RTN","ORM",89,0)
 . . I I S Y=Y_$P($G(@ORMSG@(SEG,I)),"|")
"RTN","ORM",90,0)
 . S I=$O(@ORMSG@(SEG,I)) I 'I S Y="",DONE=1 Q
"RTN","ORM",91,0)
 . S PIECE=PIECE-(FLDS-1),X=$G(@ORMSG@(SEG,I)),FLDS=$L(X,"|")
"RTN","ORM",92,0)
FQ Q Y
"RTN","ORM",93,0)
 ;
"RTN","ORM",94,0)
XTMP ; -- Save package auto-dc'd order numbers in ^XTMP
"RTN","ORM",95,0)
 ;    Uses ORIFN, ORNMSP
"RTN","ORM",96,0)
 Q:'$G(ORIFN)  Q:"^1^13^"'[($P($G(^OR(100,+ORIFN,3)),U,3)_U)
"RTN","ORM",97,0)
 N ORNOW,ORDC S ORNOW=+$$NOW^XLFDT,ORDC="ORDC-"_$G(DGPMDA)
"RTN","ORM",98,0)
 I $G(^XTMP(ORDC,0)),+^(0)<ORNOW K ^XTMP(ORDC)
"RTN","ORM",99,0)
 I '$G(^XTMP(ORDC,0)) D
"RTN","ORM",100,0)
 . N ORNOW1H S ORNOW1H=$$FMADD^XLFDT(ORNOW,,1)
"RTN","ORM",101,0)
 . S ^XTMP(ORDC,0)=ORNOW1H_U_ORNOW_"^Orders AutoDC'd by Packages on Discharge"
"RTN","ORM",102,0)
 S ^XTMP(ORDC,+ORIFN)=$G(ORNMSP)
"RTN","ORM",103,0)
 Q
"RTN","ORMBLD")
0^40^B41809197
"RTN","ORMBLD",1,0)
ORMBLD ; SLC/MKB/JDL - Build outgoing ORM msgs ;4/12/04  12:33
"RTN","ORMBLD",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,33,26,45,79,97,133,168,187,190,195**;Dec 17, 1997
"RTN","ORMBLD",3,0)
NEW(IFN,CODE) ; -- Send NW order message to pkg
"RTN","ORMBLD",4,0)
 ;I $P($G(^ORD(101.42,+$$VALUE^ORCSAVE2(IFN,"URGENCY"),0)),U)="DONE" D STATUS^ORCSAVE2(IFN,2) Q  ; complete -> don't send to pkg
"RTN","ORMBLD",5,0)
 N ORPKG,ORMSG,DGQUIET K ^TMP("ORWORD",$J)
"RTN","ORMBLD",6,0)
 S DGQUIET=1 D  Q:'$O(ORMSG(0))  ;build msg, ORDIALOG gone when posted
"RTN","ORMBLD",7,0)
 . N OR0,OR3,OR8,ORVP,ORDG,ORDIALOG,ORPARENT S:'$D(CODE) CODE="NW"
"RTN","ORMBLD",8,0)
 . S OR0=$G(^OR(100,IFN,0)) Q:'$L(OR0)  S OR3=$G(^(3)),OR8=$G(^(8,1,0))
"RTN","ORMBLD",9,0)
 . S ORVP=$P(OR0,U,2),ORDG=$P(OR0,U,11),ORPKG=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORMBLD",10,0)
 . Q:"^GMRA^GMRC^FH^LR^PS^RA^OR^"'[(U_ORPKG_U)
"RTN","ORMBLD",11,0)
 . S ORDIALOG=+$P(OR0,U,5) Q:'ORDIALOG
"RTN","ORMBLD",12,0)
 . D GETDLG1^ORCD(ORDIALOG),GETORDER^ORCD(IFN)
"RTN","ORMBLD",13,0)
 . S ORMSG(1)=$$MSH("ORM",ORPKG),ORMSG(2)=$$PID(ORVP)
"RTN","ORMBLD",14,0)
 . S ORMSG(3)=$$PV1(ORVP,$P(OR0,U,12),+$P(OR0,U,10),"",$P(OR0,U,18))
"RTN","ORMBLD",15,0)
 . S ORPARENT=$P(OR3,U,9) I ORPARENT,$G(ORDIALOG($$PTR^ORCD("OR GTX SCHEDULE"),1))="NOW"!'$O(^OR(100,+ORPARENT,4.5,"ID","CONJ",0)) S ORPARENT="" ;no parent if NOW or only child
"RTN","ORMBLD",16,0)
 . S ORMSG(4)="ORC|"_CODE_"|"_+OR0_";1^OR||||||"_ORPARENT_"|"_$$HL7DATE($P(OR0,U,7))_"|"_+$P(OR0,U,6)_"||"_+$P(OR0,U,4)_"|||"_$$HL7DATE($$NOW^XLFDT)_"|"_$$NATURE($P(OR8,U,12))_"^^^"
"RTN","ORMBLD",17,0)
 . D @ORPKG K ^TMP("ORWORD",$J)
"RTN","ORMBLD",18,0)
 I $G(ORZTEST) M ORZTEST=ORMSG Q  ;testing only
"RTN","ORMBLD",19,0)
 D MSG^XQOR("OR EVSEND "_ORPKG,.ORMSG)
"RTN","ORMBLD",20,0)
 Q
"RTN","ORMBLD",21,0)
 ;
"RTN","ORMBLD",22,0)
MSG(IFN,CODE,REASON) ; -- Send all other order msgs
"RTN","ORMBLD",23,0)
 N ORPKG,ORMSG,DGQUIET K ^TMP("ORWORD",$J)
"RTN","ORMBLD",24,0)
 S DGQUIET=1 D  Q:'$O(ORMSG(0))  ; build message
"RTN","ORMBLD",25,0)
 . N OR0,OR8,DG,PKGID,I,TYPE,DA,PROV,NATR,STS,OI
"RTN","ORMBLD",26,0)
 . S OR0=$G(^OR(100,+IFN,0)),PKGID=$G(^(4)),STS=$P($G(^(3)),U,3)
"RTN","ORMBLD",27,0)
 . S ORPKG=$$NMSP^ORCD($P(OR0,U,14)) Q:"^GMRA^GMRC^FH^LR^PS^RA^OR^"'[(U_ORPKG_U)  S:ORPKG="LR" ORPKG="LRCH"
"RTN","ORMBLD",28,0)
 . S DA=+$P(IFN,";",2),OR8=$G(^OR(100,+IFN,8,DA,0))
"RTN","ORMBLD",29,0)
 . S PROV=$P(OR8,U,3),NATR=$P(OR8,U,12) S:'PROV PROV=$G(ORNP)
"RTN","ORMBLD",30,0)
 . S TYPE=$S(CODE="NA"!(CODE="DE"):"ORR",1:"ORM")
"RTN","ORMBLD",31,0)
 . S ORMSG(1)=$$MSH(TYPE,ORPKG),ORMSG(2)=$$PID($P(OR0,U,2)),I=2
"RTN","ORMBLD",32,0)
 . I ORPKG="PS"!(ORPKG="FH"&($P(OR0,U,12)="O")) S I=I+1,ORMSG(I)=$$PV1($P(OR0,U,2),$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORMBLD",33,0)
 . S I=I+1,ORMSG(I)="ORC|"_CODE_"|"_IFN_"^OR|"_PKGID_U_ORPKG_"||||||"_$S($G(DGPMA):$$HL7DATE($P(DGPMA,U)),1:"")_"|"_DUZ_"||"_PROV_"|||"_$$HL7DATE($$NOW^XLFDT)_"|"_$$REASON(+$G(REASON),NATR)
"RTN","ORMBLD",34,0)
 . I ORPKG="FH",CODE="SS" S $P(ORMSG(I),"|",6)=$S(STS=8:"SC",STS=6:"IP",1:"")
"RTN","ORMBLD",35,0)
 . I $E(ORPKG,1,2)="LR" S OI=+$O(^OR(100,+IFN,.1,0)),OI=+$G(^(OI,0)) S:OI I=I+1,ORMSG(I)="OBR||||"_$$USID(OI)
"RTN","ORMBLD",36,0)
 . I $P(^ORD(100.98,$P(OR0,U,11),0),U)="NON-VA MEDICATIONS" D
"RTN","ORMBLD",37,0)
 . . I (CODE="CA")!(CODE="DC") S I=I+1,ORMSG(I)="ZRN|N"
"RTN","ORMBLD",38,0)
 . K ^TMP("ORWORD",$J)
"RTN","ORMBLD",39,0)
 D MSG^XQOR("OR EVSEND "_ORPKG,.ORMSG)
"RTN","ORMBLD",40,0)
 Q
"RTN","ORMBLD",41,0)
 ;
"RTN","ORMBLD",42,0)
BHS(PAT) ; -- Send batch header segment/message to Lab
"RTN","ORMBLD",43,0)
 N ORMSG S ORMSG(1)="BHS|^~\&|ORDER ENTRY|"_$G(DUZ(2))_"|LABORATORY|"_$G(DUZ(2))_"|"_$$HL7DATE($$NOW^XLFDT)
"RTN","ORMBLD",44,0)
 S ORMSG(2)=$$PID($G(PAT))
"RTN","ORMBLD",45,0)
 D MSG^XQOR("OR EVSEND LRCH",.ORMSG)
"RTN","ORMBLD",46,0)
 Q
"RTN","ORMBLD",47,0)
 ;
"RTN","ORMBLD",48,0)
BTS(PAT) ; -- Send batch trailer segment/message to Lab
"RTN","ORMBLD",49,0)
 N ORMSG S ORMSG(1)="BTS",ORMSG(2)=$$PID($G(PAT))
"RTN","ORMBLD",50,0)
 D MSG^XQOR("OR EVSEND LRCH",.ORMSG)
"RTN","ORMBLD",51,0)
 Q
"RTN","ORMBLD",52,0)
 ;
"RTN","ORMBLD",53,0)
MSH(TYPE,TO) ; -- MSH segment
"RTN","ORMBLD",54,0)
 N MSH
"RTN","ORMBLD",55,0)
 S MSH="MSH|^~\&|ORDER ENTRY|"_$G(DUZ(2))_"|"_$$NAME(TO)_"|"_$G(DUZ(2))_"|"_$$HL7DATE($$NOW^XLFDT)_"||"_TYPE
"RTN","ORMBLD",56,0)
 Q MSH
"RTN","ORMBLD",57,0)
 ;
"RTN","ORMBLD",58,0)
NAME(NMSP) ; -- Returns name of pkg NMSP
"RTN","ORMBLD",59,0)
 I NMSP="GMRA" Q "ALLERGIES"
"RTN","ORMBLD",60,0)
 I NMSP="GMRC" Q "CONSULTS"
"RTN","ORMBLD",61,0)
 I NMSP="FH" Q "DIETETICS"
"RTN","ORMBLD",62,0)
 I NMSP?1"LR".E Q "LABORATORY"
"RTN","ORMBLD",63,0)
 I NMSP="PS" Q "PHARMACY"
"RTN","ORMBLD",64,0)
 I NMSP="RA" Q "RADIOLOGY"
"RTN","ORMBLD",65,0)
 I NMSP="OR" Q "ORDER ENTRY"
"RTN","ORMBLD",66,0)
 Q ""
"RTN","ORMBLD",67,0)
 ;
"RTN","ORMBLD",68,0)
PID(DFN) ; -- PID segment
"RTN","ORMBLD",69,0)
 N PID,PTR,ROOT
"RTN","ORMBLD",70,0)
 S PTR=+$P(DFN,";"),ROOT=$P(DFN,";",2),PID="PID|||"
"RTN","ORMBLD",71,0)
 I ROOT="DPT(" S PID=PID_PTR_"||"_$P($G(^DPT(PTR,0)),U)
"RTN","ORMBLD",72,0)
 E  S PID=PID_"|"_DFN_"|"_$S($L(ROOT):$P($G(@(U_ROOT_PTR_",0)")),U),1:"")
"RTN","ORMBLD",73,0)
 Q PID
"RTN","ORMBLD",74,0)
 ;
"RTN","ORMBLD",75,0)
PV1(OBJ,TYPE,LOC,VISIT,APPTDT) ; -- PV1 segment
"RTN","ORMBLD",76,0)
 N PV1,RB,PACH S RB=""
"RTN","ORMBLD",77,0)
 S:$G(APPTDT) APPTDT=$$FMTHL7^XLFDT(APPTDT)
"RTN","ORMBLD",78,0)
 I TYPE="I",+OBJ,$P(OBJ,";",2)="DPT(" S RB=$P($G(^DPT(+OBJ,.101)),U)
"RTN","ORMBLD",79,0)
 S PACH=$$PATCH^XPDUTL("PSJ*5.0*111")
"RTN","ORMBLD",80,0)
 S:PACH PV1="PV1||"_TYPE_"|"_LOC_$S($L(RB):U_RB,1:"")_"||||||||||||||||"_$G(VISIT)_"|||||||||||||||||||||||||"_$G(APPTDT)
"RTN","ORMBLD",81,0)
 S:'PACH PV1="PV1||"_TYPE_"|"_LOC_$S($L(RB):U_RB,1:"")_"||||||||||||||||"_$G(VISIT)
"RTN","ORMBLD",82,0)
 Q PV1
"RTN","ORMBLD",83,0)
 ;
"RTN","ORMBLD",84,0)
HL7DATE(DATE) ; -- FM -> HL7 format
"RTN","ORMBLD",85,0)
 Q $$FMTHL7^XLFDT(DATE)  ;**97
"RTN","ORMBLD",86,0)
 ;
"RTN","ORMBLD",87,0)
USID(OI) ; -- Returns Univ Serv ID for Orderable Item
"RTN","ORMBLD",88,0)
 N OITEM,NATL,LOCAL S OITEM=$G(^ORD(101.43,+OI,0))
"RTN","ORMBLD",89,0)
 S NATL=$P(OITEM,U,3)_U_U_$P(OITEM,U,4)
"RTN","ORMBLD",90,0)
 S LOCAL=$P($P(OITEM,U,2),";")_U_$P(OITEM,U)_U_$P($P(OITEM,U,2),";",2)
"RTN","ORMBLD",91,0)
 Q NATL_U_LOCAL
"RTN","ORMBLD",92,0)
 ;
"RTN","ORMBLD",93,0)
NATURE(X) ; -- Returns 3 ^-piece identifier for nature X
"RTN","ORMBLD",94,0)
 N ORN,Y S ORN=$G(^ORD(100.02,+$G(X),0))
"RTN","ORMBLD",95,0)
 S Y=$P(ORN,U,2)_U_$P(ORN,U)_"^99ORN"
"RTN","ORMBLD",96,0)
 Q Y
"RTN","ORMBLD",97,0)
 ;
"RTN","ORMBLD",98,0)
REASON(X,N) ; -- Returns 6 ^-piece format of reason X
"RTN","ORMBLD",99,0)
 ;    N ^ NATURE ^ 99ORN ^ # ^ Reason ^ 99ORR
"RTN","ORMBLD",100,0)
 N Y,ORR S ORR=$G(^ORD(100.03,+$G(X),0))
"RTN","ORMBLD",101,0)
 S:'$G(N) N=+$P(ORR,U,7) S Y=$$NATURE(N)
"RTN","ORMBLD",102,0)
 S:$G(X) Y=Y_U_$S(ORPKG'="RA":+X,1:"")_U_$P(ORR,U)_"^99ORR"
"RTN","ORMBLD",103,0)
 Q Y
"RTN","ORMBLD",104,0)
 ;
"RTN","ORMBLD",105,0)
IP() ; -- Returns ORIFN^Type if pt has active isolation order (or 0 if not)
"RTN","ORMBLD",106,0)
 N TYPE,START,ORIFN,Y
"RTN","ORMBLD",107,0)
 S TYPE=$O(^ORD(100.98,"B","PREC",0)),START=$$NOW^XLFDT,Y=0
"RTN","ORMBLD",108,0)
 F  S START=$O(^OR(100,"AW",ORVP,TYPE,START),-1) Q:START'>0  S ORIFN=$O(^(START,0)) I $P($G(^OR(100,ORIFN,3)),U,3)=6 S Y=ORIFN Q
"RTN","ORMBLD",109,0)
 I Y S TYPE=$$VALUE^ORCSAVE2(ORIFN,"ISOLATION"),Y=Y_U_$$GET1^DIQ(119.4,+TYPE_",",.01)
"RTN","ORMBLD",110,0)
 Q Y
"RTN","ORMBLD",111,0)
 ;
"RTN","ORMBLD",112,0)
OR ; -- new Generic order
"RTN","ORMBLD",113,0)
 I ORDG=$O(^ORD(100.98,"B","M.A.S.",0)) D ADT^ORMBLDOR Q
"RTN","ORMBLD",114,0)
 D EN^ORMBLDOR
"RTN","ORMBLD",115,0)
 Q
"RTN","ORMBLD",116,0)
 ;
"RTN","ORMBLD",117,0)
GMRA ; -- new Allergy order
"RTN","ORMBLD",118,0)
 Q:$$PATCH^XPDUTL("OR*3.0*216")  ;195 quit if patch 216 is in
"RTN","ORMBLD",119,0)
 D ALG^ORMBLDAL
"RTN","ORMBLD",120,0)
 Q
"RTN","ORMBLD",121,0)
 ;
"RTN","ORMBLD",122,0)
GMRC ; -- new Consult order
"RTN","ORMBLD",123,0)
 D CSLT^ORMBLDGM
"RTN","ORMBLD",124,0)
 Q
"RTN","ORMBLD",125,0)
 ;
"RTN","ORMBLD",126,0)
FH ; -- new Diet order
"RTN","ORMBLD",127,0)
 N ORPARAM D EN^FHWOR8(+ORVP,.ORPARAM) ; set parameters
"RTN","ORMBLD",128,0)
 S:'$L($G(ORPARAM(3))) ORPARAM(3)="T"
"RTN","ORMBLD",129,0)
 I ORDG=$O(^ORD(100.98,"B","PRECAUTIONS",0)) D IP^ORMBLDFH Q
"RTN","ORMBLD",130,0)
 I ORDG=$O(^ORD(100.98,"B","EARLY/LATE TRAYS",0)) D TRAY^ORMBLDFH Q
"RTN","ORMBLD",131,0)
 I ORDG=$O(^ORD(100.98,"B","TUBEFEEDINGS",0)) D TF^ORMBLDFH Q
"RTN","ORMBLD",132,0)
 I ORDG=$O(^ORD(100.98,"B","DIET ADDITIONAL ORDERS",0)) D ADDN^ORMBLDFH Q
"RTN","ORMBLD",133,0)
 D DIET^ORMBLDFH
"RTN","ORMBLD",134,0)
 Q
"RTN","ORMBLD",135,0)
 ;
"RTN","ORMBLD",136,0)
LR ; -- new Lab order
"RTN","ORMBLD",137,0)
 I CODE="XO" D XO^ORMBLDLR Q  ; change
"RTN","ORMBLD",138,0)
 D CH^ORMBLDLR S ORPKG="LRCH" Q  ;no difference by subscript at this time
"RTN","ORMBLD",139,0)
 N SUB S SUB=$P($G(^ORD(100.98,ORDG,0)),U,3)
"RTN","ORMBLD",140,0)
 S:(SUB="SP")!(SUB="EM")!(SUB="AU")!(SUB="CY") SUB="AP"
"RTN","ORMBLD",141,0)
 S:(SUB="LAB")!(SUB="MI")!(SUB="HEMA") SUB="CH"
"RTN","ORMBLD",142,0)
 D @(SUB_"^ORMBLDLR") S ORPKG=ORPKG_SUB
"RTN","ORMBLD",143,0)
 Q
"RTN","ORMBLD",144,0)
 ;
"RTN","ORMBLD",145,0)
PS ; -- new Pharmacy order
"RTN","ORMBLD",146,0)
 ;I ORDG=$O(^ORD(100.98,"B","OUTPATIENT MEDICATIONS",0)) D OUT^ORMBLDPS Q
"RTN","ORMBLD",147,0)
 ;D UD^ORMBLDPS
"RTN","ORMBLD",148,0)
 N IVDLG S IVDLG=+$P(OR0,U,5) ;JD
"RTN","ORMBLD",149,0)
 N PKG S PKG=$P(OR0,U,14),PKG=$$GET1^DIQ(9.4,+PKG_",",1)
"RTN","ORMBLD",150,0)
 I +$$VALUE^ORCSAVE2(IFN,"URGENCY")=99,$P(OR3,U,11)'="B" D  Q  ;only send DONE orders from BCMA
"RTN","ORMBLD",151,0)
 . D STATUS^ORCSAVE2(IFN,2) K ORMSG
"RTN","ORMBLD",152,0)
 . I $P(OR3,U,11)=1,$P($G(^OR(100,+$P(OR3,U,5),3)),U,3)=5 D MSG(+$P(OR3,U,5),"CA") ;cancel original instead
"RTN","ORMBLD",153,0)
 I ORDG=$O(^ORD(100.98,"B","IV RX",0))!(ORDG=$O(^ORD(100.98,"B","TPN",0)))!(IVDLG=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE",0))) D IV^ORMBLDPS Q
"RTN","ORMBLD",154,0)
 D @($S(PKG="PSIV":"IV",PKG="PSO":"OUT",PKG="PSH":"NVA",1:"UD")_"^ORMBLDPS")
"RTN","ORMBLD",155,0)
 Q
"RTN","ORMBLD",156,0)
 ;
"RTN","ORMBLD",157,0)
RA ; -- new Radiology order
"RTN","ORMBLD",158,0)
 D EN^ORMBLDRA
"RTN","ORMBLD",159,0)
 Q
"RTN","ORMBLD",160,0)
 ;
"RTN","ORMBLD",161,0)
TEST(ORIFN) ; -- Build/display HL7 msgs w/o sending
"RTN","ORMBLD",162,0)
 K ORZTEST S ORZTEST=1 D NEW(ORIFN) ; leaves msg in ORZTEST() on exit
"RTN","ORMBLD",163,0)
 Q
"RTN","ORMBLDAL")
0^81^B5473107
"RTN","ORMBLDAL",1,0)
ORMBLDAL ;SLC/MKB,JFR-Build outgoing GMRA ORM msgs ;8/9/04  12:39
"RTN","ORMBLDAL",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**33,39,97,195**;Dec 17, 1997
"RTN","ORMBLDAL",3,0)
HL7DATE(DATE) ; -- FM -> HL7 format
"RTN","ORMBLDAL",4,0)
 Q $$FMTHL7^XLFDT(DATE)  ;**97
"RTN","ORMBLDAL",5,0)
 ;
"RTN","ORMBLDAL",6,0)
PTR(NAME) ; -- Returns ptr value of prompt in Dialog file
"RTN","ORMBLDAL",7,0)
 Q $O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMBLDAL",8,0)
 ;
"RTN","ORMBLDAL",9,0)
ALG ; -- Segments for new Allergy order
"RTN","ORMBLDAL",10,0)
 N NKA,TYPE,AGENT,SYMP,OBSERVED,ENTERED,WP,I,J,K,DATE,SEV,SYMPDATE,PROV
"RTN","ORMBLDAL",11,0)
 S NKA=$G(ORDIALOG($$PTR("NKA"),1)) I $L(NKA) D  Q
"RTN","ORMBLDAL",12,0)
 . S ORMSG(4)="AL1|1|||||"_$$HL7DATE($P(OR0,U,7))
"RTN","ORMBLDAL",13,0)
 . S ORMSG(5)="ZAL||YES|"_$P(OR0,U,4)
"RTN","ORMBLDAL",14,0)
 S AGENT="^^^"_$$CODE(ORDIALOG($$PTR("FREE TEXT OI"),1))
"RTN","ORMBLDAL",15,0)
 S TYPE=ORDIALOG($$PTR("ALLERGY TYPE"),1) S:TYPE="O" TYPE="M"
"RTN","ORMBLDAL",16,0)
 S OBSERVED=(ORDIALOG($$PTR("OBSERVED/HISTORICAL"),1)="o")
"RTN","ORMBLDAL",17,0)
 S DATE=$G(ORDIALOG($$PTR("OBSERVATION DATE/TIME"),1))
"RTN","ORMBLDAL",18,0)
 S SEV=$G(ORDIALOG($$PTR("SEVERITY"),1))
"RTN","ORMBLDAL",19,0)
 S PROV=$G(ORDIALOG($$PTR("PROVIDER"),1))
"RTN","ORMBLDAL",20,0)
 S WP=$$PTR("WORD PROCESSING 1"),SYMP=$$PTR("REACTION")
"RTN","ORMBLDAL",21,0)
 S SYMPDATE=$$PTR("REACTION DATE/TIME") K ORMSG(4)
"RTN","ORMBLDAL",22,0)
 S ORMSG(4)="AL1|1|"_$E(TYPE_"A",1,2)_"|"_AGENT_"|||"_$$HL7DATE($P(OR0,U,7))
"RTN","ORMBLDAL",23,0)
 S ORMSG(5)="ZAL||NO|"_$P(OR0,U,4)_"|"_$S(OBSERVED:"OB",1:"HI"),I=5
"RTN","ORMBLDAL",24,0)
 I DATE S I=I+1,ORMSG(I)="ZAO||"_$$HL7DATE(DATE)_"|"_$S(SEV=3:"SV",SEV=2:"MO",1:"MI")_"|"_PROV ;195
"RTN","ORMBLDAL",25,0)
 S J=0 F  S J=$O(ORDIALOG(SYMP,J)) Q:J'>0  S I=I+1,ORMSG(I)="ZAS|"_J_"|^^^"_ORDIALOG(SYMP,J)_"^^99ALS|"_$$HL7DATE($G(ORDIALOG(SYMPDATE,J)))
"RTN","ORMBLDAL",26,0)
 S J=$O(^TMP("ORWORD",$J,WP,1,0)) Q:'J  S I=I+1,ORMSG(I)="NTE||P|"_^(J,0)
"RTN","ORMBLDAL",27,0)
 S K=0 F  S J=$O(^TMP("ORWORD",$J,WP,1,J)) Q:J'>0  S K=K+1,ORMSG(I,K)=^(J,0)
"RTN","ORMBLDAL",28,0)
 Q
"RTN","ORMBLDAL",29,0)
 ;
"RTN","ORMBLDAL",30,0)
CODE(X) ; -- Returns coded element form of Allergen - NDF aware
"RTN","ORMBLDAL",31,0)
 N D,DIC,TRD,Y
"RTN","ORMBLDAL",32,0)
 S Y=$O(^GMRD(120.82,"B",X,0)) I Y S Y=Y_U_X_"^99ALL" G CQ
"RTN","ORMBLDAL",33,0)
 S Y=$O(^PS(50.605,"C",X,0)) I Y S Y=Y_U_X_"^99PSC" G CQ
"RTN","ORMBLDAL",34,0)
 S DIC=50.6,DIC(0)="X",D="B" D IX^DIC I Y>0 S Y=+Y_U_X_"^99NDF" G CQ
"RTN","ORMBLDAL",35,0)
 S TRD=$$TTOG^PSNAPIS(X,.TRD) I TRD S Y=$O(TRD(0))_U_X_"^99NDF" G CQ
"RTN","ORMBLDAL",36,0)
 S Y="NOS^"_X_"^99OTH"
"RTN","ORMBLDAL",37,0)
CQ Q Y
"RTN","ORMBLDGM")
0^41^B4563455
"RTN","ORMBLDGM",1,0)
ORMBLDGM ;SLC/MKB-Build outgoing GMR* ORM msgs ;11/17/00  11:07
"RTN","ORMBLDGM",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**26,68,97,190,195**;Dec 17, 1997
"RTN","ORMBLDGM",3,0)
HL7DATE(DATE) ; -- FM -> HL7 format
"RTN","ORMBLDGM",4,0)
 Q $$FMTHL7^XLFDT(DATE)  ;**97
"RTN","ORMBLDGM",5,0)
 ;
"RTN","ORMBLDGM",6,0)
PTR(NAME) ; -- Returns ptr value of prompt in Dialog file
"RTN","ORMBLDGM",7,0)
 Q $O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMBLDGM",8,0)
 ;
"RTN","ORMBLDGM",9,0)
CSLT ; -- Segments for new Consult order
"RTN","ORMBLDGM",10,0)
 N OI,WP,URG,CATG,PLACE,ATTN,DIAG,CODE,QT,I,J,USID,CTYPE,RSERV,Z
"RTN","ORMBLDGM",11,0)
 S OI=$G(ORDIALOG($$PTR("ORDERABLE ITEM"),1))
"RTN","ORMBLDGM",12,0)
 S CTYPE=$G(ORDIALOG($$PTR("FREE TEXT OI"),1))
"RTN","ORMBLDGM",13,0)
 S RSERV=$G(ORDIALOG($$PTR("REQUEST SERVICE"),1))
"RTN","ORMBLDGM",14,0)
 S WP=$$PTR("WORD PROCESSING 1"),URG=+$G(ORDIALOG($$PTR("URGENCY"),1))
"RTN","ORMBLDGM",15,0)
 S CATG=$G(ORDIALOG($$PTR("CATEGORY"),1))
"RTN","ORMBLDGM",16,0)
 S PLACE=$G(ORDIALOG($$PTR("PLACE OF CONSULTATION"),1))
"RTN","ORMBLDGM",17,0)
 S ATTN=$G(ORDIALOG($$PTR("PROVIDER"),1))
"RTN","ORMBLDGM",18,0)
 S DIAG=$G(ORDIALOG($$PTR("FREE TEXT"),1))
"RTN","ORMBLDGM",19,0)
 S CODE=$G(ORDIALOG($$PTR("CODE"),1))
"RTN","ORMBLDGM",20,0)
CS1 S QT="^^^^^"_$P($G(^ORD(101.42,+URG,0)),U,2),$P(ORMSG(4),"|",8)=QT
"RTN","ORMBLDGM",21,0)
 S $P(ORMSG(3),"|",3)=CATG S:PLACE="C" PLACE="OC"
"RTN","ORMBLDGM",22,0)
 S USID=$$USID^ORMBLD(OI) ;S:$L(CTYPE) $P(USID,U,5)=CTYPE
"RTN","ORMBLDGM",23,0)
 S ORMSG(5)="OBR||||"_USID_"||||||||||||||"_PLACE_"|"_ATTN,Z=5
"RTN","ORMBLDGM",24,0)
 ; Create DG1 & ZCL segment(s) for Billing Awareness (BA) project
"RTN","ORMBLDGM",25,0)
 D DG1^ORWDBA3($G(IFN),"Z",5)
"RTN","ORMBLDGM",26,0)
 I RSERV'>0,$P(USID,U,6)="99CON" S RSERV=+$P(USID,U,4)
"RTN","ORMBLDGM",27,0)
 S:RSERV Z=Z+1,ORMSG(Z)="ZSV|^^^"_+RSERV_U_$$GET1^DIQ(123.5,+RSERV_",",.01)_"^99CON|"_CTYPE
"RTN","ORMBLDGM",28,0)
 S I=0,J=+$O(^TMP("ORWORD",$J,WP,1,0)),Z=Z+1 ; get first line
"RTN","ORMBLDGM",29,0)
 S ORMSG(Z)="OBX|1|TX|2000.02^REASON FOR REQUEST^AS4||"_$G(^TMP("ORWORD",$J,WP,1,J,0))
"RTN","ORMBLDGM",30,0)
 F  S J=$O(^TMP("ORWORD",$J,WP,1,J)) Q:J'>0  S I=I+1,ORMSG(Z,I)=^(+J,0)
"RTN","ORMBLDGM",31,0)
 I $L(DIAG) D
"RTN","ORMBLDGM",32,0)
 . N TYPE,VALUE S TYPE="TX",VALUE=DIAG
"RTN","ORMBLDGM",33,0)
 . S:$L(CODE) TYPE="CE",VALUE=CODE_U_DIAG_"^I9C"
"RTN","ORMBLDGM",34,0)
 . S Z=Z+1,ORMSG(Z)="OBX|2|"_TYPE_"|^PROVISIONAL DIAGNOSIS^||"_VALUE
"RTN","ORMBLDGM",35,0)
 Q
"RTN","ORMBLDLR")
0^42^B19628986
"RTN","ORMBLDLR",1,0)
ORMBLDLR ; SLC/MKB - Build outgoing Lab ORM msgs ;11/17/00  11:10
"RTN","ORMBLDLR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**97,190,195**;Dec 17, 1997
"RTN","ORMBLDLR",3,0)
HL7DATE(DATE) ; -- FM -> HL7 format
"RTN","ORMBLDLR",4,0)
 Q $$FMTHL7^XLFDT(DATE)  ;**97
"RTN","ORMBLDLR",5,0)
 ;
"RTN","ORMBLDLR",6,0)
PTR(NAME) ; -- Returns ptr value of prompt in Dialog file
"RTN","ORMBLDLR",7,0)
 Q $O(^ORD(101.41,"AB",$E(NAME,1,63),0))
"RTN","ORMBLDLR",8,0)
 ;
"RTN","ORMBLDLR",9,0)
AP ; -- new Lab AP order
"RTN","ORMBLDLR",10,0)
 ;    fall through to CH - no difference at this time
"RTN","ORMBLDLR",11,0)
CH ; -- new Lab CH order
"RTN","ORMBLDLR",12,0)
 N IP,OI,START,STOP,URG,CMMT,INST,I,J,X
"RTN","ORMBLDLR",13,0)
 S START=$P($G(^OR(100,IFN,0)),U,8),STOP=$P($G(^(0)),U,9)
"RTN","ORMBLDLR",14,0)
 S OI=$$PTR("OR GTX ORDERABLE ITEM"),URG=$$PTR("OR GTX LAB URGENCY")
"RTN","ORMBLDLR",15,0)
 S CMMT=$$PTR("OR GTX WORD PROCESSING 1")
"RTN","ORMBLDLR",16,0)
 S IP="" ;$S($D(^OR(100,<ISOLATION ORDER FOR DFN>)):1,1:0)
"RTN","ORMBLDLR",17,0)
 S $P(ORMSG(4),"|",8)="^^^"_$$HL7DATE(START)_U_$$HL7DATE(STOP)
"RTN","ORMBLDLR",18,0)
 S I=4,INST=0 F  S INST=$O(ORDIALOG(OI,INST)) Q:INST'>0  D
"RTN","ORMBLDLR",19,0)
 . S X=+$G(ORDIALOG(URG,INST)),X=$P($G(^LAB(62.05,X,0)),U,4)_";"_X
"RTN","ORMBLDLR",20,0)
 . S I=I+1,ORMSG(I)="OBR||||"_$$USID^ORMBLD(ORDIALOG(OI,INST))_"|||||||"_$$COLLTYPE_"|"_IP_"|||"_$$SPEC_"||||||||||||^^^^^"_X
"RTN","ORMBLDLR",21,0)
 . S J=$O(^TMP("ORWORD",$J,CMMT,INST,0)) Q:'J  ; no comments for test
"RTN","ORMBLDLR",22,0)
 . S I=I+1,ORMSG(I)="NTE|"_INST_"|P|"_^TMP("ORWORD",$J,CMMT,INST,J,0)
"RTN","ORMBLDLR",23,0)
 . S L=0 F  S J=$O(^TMP("ORWORD",$J,CMMT,INST,J)) Q:J'>0  S L=L+1,ORMSG(I,L)=^(J,0)
"RTN","ORMBLDLR",24,0)
 ; Add DG1 & ZCL segment(s) for Billing Aware
"RTN","ORMBLDLR",25,0)
 D DG1^ORWDBA3($G(IFN),"I",I)
"RTN","ORMBLDLR",26,0)
 Q
"RTN","ORMBLDLR",27,0)
 ;
"RTN","ORMBLDLR",28,0)
BB ; -- new Lab BB order
"RTN","ORMBLDLR",29,0)
 N START,QUAN,WP,I,J
"RTN","ORMBLDLR",30,0)
 S QUAN=+$G(ORDIALOG($$PTR("OR GTX QUANTITY"),1))
"RTN","ORMBLDLR",31,0)
 S START=$P(^OR(100,IFN,0),U,8),WP=$$PTR("OR GTX WORD PROCESSING 1")
"RTN","ORMBLDLR",32,0)
 S $P(ORMSG(4),"|",8)=QUAN_"^^^"_$$HL7DATE(START)
"RTN","ORMBLDLR",33,0)
 S ORMSG(5)="OBR||||"_$G(ORDIALOG($$PTR("OR GTX ORDERABLE ITEM"),1))
"RTN","ORMBLDLR",34,0)
 S I=$O(^TMP("ORWORD",$J,WP,1,0)) Q:'I
"RTN","ORMBLDLR",35,0)
 S ORMSG(6)="NTE|1|P|"_$G(^TMP("ORWORD",$J,WP,1,I,0)),J=0
"RTN","ORMBLDLR",36,0)
 F  S I=$O(^TMP("ORWORD",$J,WP,1,I)) Q:I'>0  S J=J+1,ORMSG(6,J)=$G(^(I,0))
"RTN","ORMBLDLR",37,0)
 Q
"RTN","ORMBLDLR",38,0)
 ;
"RTN","ORMBLDLR",39,0)
COLLTYPE() ; -- Returns collection type for current INST
"RTN","ORMBLDLR",40,0)
 N TYPE,X
"RTN","ORMBLDLR",41,0)
 S TYPE=$G(ORDIALOG($$PTR("OR GTX COLLECTION TYPE"),INST))
"RTN","ORMBLDLR",42,0)
 S X=$S(TYPE="LC":"L",TYPE="WC":"O",TYPE="SP":1,TYPE="I":2,1:"")
"RTN","ORMBLDLR",43,0)
 Q X
"RTN","ORMBLDLR",44,0)
 ;
"RTN","ORMBLDLR",45,0)
SPEC() ; -- Returns specimen/sample string for current INST
"RTN","ORMBLDLR",46,0)
 N SAMP,SPEC,X,X0
"RTN","ORMBLDLR",47,0)
 S SPEC=+$G(ORDIALOG($$PTR("OR GTX SPECIMEN"),INST))
"RTN","ORMBLDLR",48,0)
 S X0=$G(^LAB(61,SPEC,0)),X=$P(X0,U,2)_";"_$P(X0,U)_";SNM"
"RTN","ORMBLDLR",49,0)
 S SAMP=+$G(ORDIALOG($$PTR("OR GTX COLLECTION SAMPLE"),INST))
"RTN","ORMBLDLR",50,0)
 S X=X_";"_SAMP_";"_$P($G(^LAB(62,+SAMP,0)),U)_";99LRS^^^"_SPEC_";"_$P(X0,U)_";99LRX"
"RTN","ORMBLDLR",51,0)
 Q X
"RTN","ORMBLDLR",52,0)
 ;
"RTN","ORMBLDLR",53,0)
XO ; -- Send XO message to Lab
"RTN","ORMBLDLR",54,0)
 N OR0,DG,ORMSG,ORNEW,OI,URG,I,CNT,INST,ORDIALOG,TEST,CMMT,J,L,OROLD
"RTN","ORMBLDLR",55,0)
 S OR0=$G(^OR(100,+IFN,0)),DG=$P($G(^ORD(100.98,+$P(OR0,U,11),0)),U,3)
"RTN","ORMBLDLR",56,0)
 S DG="LR"_$S(DG="AP":"AP",DG="BB":"BB",1:"CH"),ORDIALOG=+$P(OR0,U,5)
"RTN","ORMBLDLR",57,0)
 S OROLD=+$P(^OR(100,IFN,3),U,5),$P(ORMSG(4),"|",4)=$G(^OR(100,+OROLD,4))_U_DG
"RTN","ORMBLDLR",58,0)
 S OI=$$PTR("OR GTX ORDERABLE ITEM"),URG=$$PTR("OR GTX URGENCY")
"RTN","ORMBLDLR",59,0)
 S CMMT=$$PTR("OR GTX WORD PROCESSING 1"),CNT=3
"RTN","ORMBLDLR",60,0)
 S I=0 F  S I=$O(^OR(100,+IFN,4.5,I)) Q:I'>0  I $P($G(^(I,0)),U,2)=OI S TEST=$G(^(1)),ORNEW(TEST)=^(0) ; new set of tests
"RTN","ORMBLDLR",61,0)
 S I=0 F  S I=$O(^OR(100,OROLD,4.5,I)) Q:I'>0  I $P($G(^(I,0)),U,2)=OI S TEST=$G(^(1)),OROLD(TEST)=^(0) ; orig set of tests
"RTN","ORMBLDLR",62,0)
XO1 D GETDLG1^ORCD(ORDIALOG),GETORDER^ORCD(+IFN)
"RTN","ORMBLDLR",63,0)
 S I=0 F  S I=$O(ORNEW(I)) Q:I'>0  I '$D(OROLD(I)) D
"RTN","ORMBLDLR",64,0)
 . S CNT=CNT+1,TEST=I,INST=$P(ORNEW(I),U,3)
"RTN","ORMBLDLR",65,0)
 . S ORMSG(CNT)="OBR|"_(CNT-3)_"|||"_$$USID^ORMBLD(TEST)_"|||||||A||||"_$$SPEC_"||||||||||||^^^^^"_$P($G(^ORD(101.42,+$G(ORDIALOG(URG,INST)),0)),U,2)
"RTN","ORMBLDLR",66,0)
 . S J=$O(^TMP("ORWORD",$J,CMMT,INST,0)) Q:'J  ; no comments for test
"RTN","ORMBLDLR",67,0)
 . S CNT=CNT+1,ORMSG(CNT)="NTE|"_INST_"|L|"_^TMP("ORWORD",$J,CMMT,INST,J,0)
"RTN","ORMBLDLR",68,0)
 . S L=0 F  S J=$O(^TMP("ORWORD",$J,CMMT,INST,J)) Q:J'>0  S L=L+1,ORMSG(CNT,L)=^(J,0)
"RTN","ORMBLDLR",69,0)
 S I=ORDIALOG K ORDIALOG S ORDIALOG=I
"RTN","ORMBLDLR",70,0)
 D GETDLG1^ORCD(ORDIALOG),GETORDER^ORCD(OROLD)
"RTN","ORMBLDLR",71,0)
 S I=0 F  S I=$O(OROLD(I)) Q:I'>0  I '$D(ORNEW(I)) D
"RTN","ORMBLDLR",72,0)
 . S CNT=CNT+1,TEST=I,INST=$P(OROLD(I),U,3)
"RTN","ORMBLDLR",73,0)
 . S ORMSG(CNT)="OBR|"_(CNT-3)_"|||"_$$USID^ORMBLD(TEST)_"|||||||3||||"_$$SPEC_"||||||||||||^^^^^"_$P($G(^ORD(101.42,+$G(ORDIALOG(URG,INST)),0)),U,2)
"RTN","ORMBLDLR",74,0)
 . S J=$O(^TMP("ORWORD",$J,CMMT,INST,0)) Q:'J  ; no comments for test
"RTN","ORMBLDLR",75,0)
 . S CNT=CNT+1,ORMSG(CNT)="NTE|"_INST_"|L|"_^TMP("ORWORD",$J,CMMT,INST,J,0)
"RTN","ORMBLDLR",76,0)
 . S L=0 F  S J=$O(^TMP("ORWORD",$J,CMMT,INST,J)) Q:J'>0  S L=L+1,ORMSG(CNT,L)=^(J,0)
"RTN","ORMBLDLR",77,0)
 D MSG^XQOR("OR EVSEND "_DG,.ORMSG)
"RTN","ORMBLDLR",78,0)
 Q
"RTN","ORMBLDPS")
0^43^B64695712
"RTN","ORMBLDPS",1,0)
ORMBLDPS ;SLC/MKB-Build outgoing Pharmacy ORM msgs ;11:26 AM  2 Apr 2001
"RTN","ORMBLDPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,38,54,86,97,94,116,129,141,190,195**;Dec 17, 1997
"RTN","ORMBLDPS",3,0)
PTR(NAME) ; -- Returns ptr value of prompt in Dialog file
"RTN","ORMBLDPS",4,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMBLDPS",5,0)
 ;
"RTN","ORMBLDPS",6,0)
NVA ; -- new Non-VA Meds order
"RTN","ORMBLDPS",7,0)
 N NVA S NVA=1
"RTN","ORMBLDPS",8,0)
OUT ; -- new Outpt Meds order
"RTN","ORMBLDPS",9,0)
 ;    fall through to UD: same msg, +3 fields
"RTN","ORMBLDPS",10,0)
UD ; -- new Inpt (Unit Dose) Meds order
"RTN","ORMBLDPS",11,0)
 N OI,DRUG,INSTR,DOSE,ROUTE,SCHED,DUR,URG,PROVCOMM,PI,DISPENSE,X,Y,I,J,K,L,QT1,QT2,QT3,QT4,QT6,QT9,CONJ,ORC,SC,OUTPT
"RTN","ORMBLDPS",12,0)
 S OUTPT=$S($P(OR0,U,12)="O":1,1:0) ;outpt flag
"RTN","ORMBLDPS",13,0)
 S X=$G(^OR(100,IFN,8,1,0)) I $P(X,U,5),$P(X,U,5)'=$P(X,U,3) S $P(ORMSG(4),"|",13)=$P(X,U,5) ; Send signer instead of orderer if different
"RTN","ORMBLDPS",14,0)
 S OI=$$PTR("ORDERABLE ITEM"),DRUG=$$PTR("DISPENSE DRUG")
"RTN","ORMBLDPS",15,0)
 S INSTR=$$PTR("INSTRUCTIONS"),SCHED=$$PTR("SCHEDULE")
"RTN","ORMBLDPS",16,0)
 S DUR=$$PTR("DURATION"),URG=$$PTR("URGENCY"),DOSE=$$PTR("DOSE")
"RTN","ORMBLDPS",17,0)
 S ROUTE=$$PTR("ROUTE"),PROVCOMM=$$PTR("WORD PROCESSING 1")
"RTN","ORMBLDPS",18,0)
 S PI=$$PTR("PATIENT INSTRUCTIONS"),CONJ=$$PTR("AND/THEN")
"RTN","ORMBLDPS",19,0)
 S J=1,ORC(J)=$P(ORMSG(4),"|",1,7)_"|"
"RTN","ORMBLDPS",20,0)
 I +$G(NVA)=1 G NVA1
"RTN","ORMBLDPS",21,0)
UD1 S I=0 F  S I=$O(ORDIALOG(INSTR,I)) Q:I'>0  D
"RTN","ORMBLDPS",22,0)
 . S QT2=$G(ORDIALOG(SCHED,I)),QT3=$$HL7DUR,X=$G(ORDIALOG(DOSE,I))
"RTN","ORMBLDPS",23,0)
 . ;S QT1=$S($L(X):$P(X,"&",1,4)_"&"_$P(X,"&",6),1:"")
"RTN","ORMBLDPS",24,0)
 . S QT1=$S($L(X):$P(X,"&",1,6),1:"")
"RTN","ORMBLDPS",25,0)
 . S QT6=$P($G(^ORD(101.42,+$G(ORDIALOG(URG,I)),0)),U,2)
"RTN","ORMBLDPS",26,0)
 . S QT9=$G(ORDIALOG(CONJ,I))_"~" S:$E(QT9)="T" QT9="S~"
"RTN","ORMBLDPS",27,0)
 . S J=J+1,ORC(J)=QT1_U_QT2_U_QT3_"^^^"_QT6_"^^"_$$INSTR_U_QT9
"RTN","ORMBLDPS",28,0)
 ;
"RTN","ORMBLDPS",29,0)
NVA1 I +$G(NVA)=1 D
"RTN","ORMBLDPS",30,0)
 . S I=1 ;only one dosage possible for non-va meds
"RTN","ORMBLDPS",31,0)
 . S QT2=$G(ORDIALOG(SCHED,I)),QT3=$$HL7DUR,X=$G(ORDIALOG(DOSE,I))
"RTN","ORMBLDPS",32,0)
 . S QT1=$S($L(X):$P(X,"&",1,6),1:"")
"RTN","ORMBLDPS",33,0)
 . S QT6=$P($G(^ORD(101.42,+$G(ORDIALOG(URG,I)),0)),U,2)
"RTN","ORMBLDPS",34,0)
 . S QT9=$G(ORDIALOG(CONJ,I))_"~" S:$E(QT9)="T" QT9="S~"
"RTN","ORMBLDPS",35,0)
 . S J=J+1,ORC(J)=QT1_U_QT2_U_QT3_"^^^"_QT6_"^^"_$$INSTR_U_QT9
"RTN","ORMBLDPS",36,0)
 ;
"RTN","ORMBLDPS",37,0)
 I $L($P(OR0,U,8)) S $P(ORC(2),U,4)=$$FMTHL7^XLFDT($P(OR0,U,8)) S:J<2 J=2
"RTN","ORMBLDPS",38,0)
 S J=J+1,ORC(J)="|"_$P(ORMSG(4),"|",9,999),ORC=J,X="ORMSG(4)",ORMSG(4)="",I=0
"RTN","ORMBLDPS",39,0)
 F J=1:1:ORC S Y=ORC(J) D  ;add to ORMSG(4)
"RTN","ORMBLDPS",40,0)
 . I $L(@X)+$L(Y)'>245 S @X=@X_Y
"RTN","ORMBLDPS",41,0)
 . E  S L=245-$L(@X),@X=@X_$E(Y,1,L),I=I+1,X="ORMSG(4,"_I_")",@X=$E(Y,L+1,$L(Y))
"RTN","ORMBLDPS",42,0)
 I $G(ORDIALOG(DRUG,1)) S X=$$ENDCM^PSJORUTL(ORDIALOG(DRUG,1)),DISPENSE=$P(X,U,3)_"^^99NDF^"_ORDIALOG(DRUG,1)_"^^99PSD"
"RTN","ORMBLDPS",43,0)
 S ORMSG(5)="RXO|"_$$USID^ORMBLD($G(ORDIALOG(OI,1)))_"|||||||||"_$G(DISPENSE)
"RTN","ORMBLDPS",44,0)
UD2 I $G(OUTPT) D
"RTN","ORMBLDPS",45,0)
 . N QTY,REFS,DSPY
"RTN","ORMBLDPS",46,0)
 . S QTY=$$PTR("QUANTITY"),REFS=$$PTR("REFILLS"),DSPY=$$PTR("DAYS SUPPLY")
"RTN","ORMBLDPS",47,0)
 . S ORMSG(5)=ORMSG(5)_"|"_$G(ORDIALOG(QTY,1))_"||"_$G(ORDIALOG(REFS,1))_"||||D"_$G(ORDIALOG(DSPY,1))
"RTN","ORMBLDPS",48,0)
 S I=5 I $L($G(ORDIALOG(PROVCOMM,1))) D
"RTN","ORMBLDPS",49,0)
 . S J=$O(^TMP("ORWORD",$J,PROVCOMM,1,0)) Q:'J
"RTN","ORMBLDPS",50,0)
 . S I=6,ORMSG(6)="NTE|6|P|"_$G(^TMP("ORWORD",$J,PROVCOMM,1,J,0))
"RTN","ORMBLDPS",51,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,PROVCOMM,1,J)) Q:J'>0  S K=K+1,ORMSG(6,K)=$G(^(J,0))
"RTN","ORMBLDPS",52,0)
 I $G(OUTPT),$L($G(ORDIALOG(PI,1))) D
"RTN","ORMBLDPS",53,0)
 . S J=$O(^TMP("ORWORD",$J,PI,1,0)) Q:'J
"RTN","ORMBLDPS",54,0)
 . S I=I+1,ORMSG(I)="NTE|7|P|"_$G(^TMP("ORWORD",$J,PI,1,J,0))
"RTN","ORMBLDPS",55,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,PI,1,J)) Q:J'>0  S K=K+1,ORMSG(I,K)=$G(^(J,0))
"RTN","ORMBLDPS",56,0)
UD3 S J=0 F  S J=$O(ORDIALOG(ROUTE,J)) Q:J'>0  S I=I+1,ORMSG(I)=$$RXR($G(ORDIALOG(ROUTE,J)))
"RTN","ORMBLDPS",57,0)
 I $D(^OR(100,IFN,9)) D ORDCHKS
"RTN","ORMBLDPS",58,0)
 S I=I+1,ORMSG(I)=$$ZRX(IFN)
"RTN","ORMBLDPS",59,0)
 I $G(OUTPT) D  ;add SC data
"RTN","ORMBLDPS",60,0)
 . N OR5 S OR5=$G(^OR(100,IFN,5))
"RTN","ORMBLDPS",61,0)
 . I $L(OR5),OR5'?5"^" S I=I+1,ORMSG(I)="ZSC|"_$TR(OR5,"^","|") Q
"RTN","ORMBLDPS",62,0)
 . S SC=$$PTR("SERVICE CONNECTED") S:$D(ORDIALOG(SC,1)) I=I+1,ORMSG(I)="ZSC|"_$S(ORDIALOG(SC,1):"SC",1:"NSC")
"RTN","ORMBLDPS",63,0)
 ; Create DG1 & ZCL segment(s) for Billing Awareness (BA) Project
"RTN","ORMBLDPS",64,0)
 D DG1^ORWDBA3($G(IFN),"I",I)
"RTN","ORMBLDPS",65,0)
 I $P(^ORD(100.98,$P(OR0,U,11),0),U)="NON-VA MEDICATIONS" D
"RTN","ORMBLDPS",66,0)
 . S I=I+1 D ZRN(IFN,.ORMSG,I)
"RTN","ORMBLDPS",67,0)
 Q
"RTN","ORMBLDPS",68,0)
 ;
"RTN","ORMBLDPS",69,0)
INSTR()  ; -- Return text instructions for QT-8, instance I
"RTN","ORMBLDPS",70,0)
 N Y S Y=$P($G(ORDIALOG(DOSE,I)),"&",5)
"RTN","ORMBLDPS",71,0)
 I $G(ORDIALOG(DRUG,1)),$L(Y) Q Y
"RTN","ORMBLDPS",72,0)
 S Y=$G(ORDIALOG(INSTR,I)) I $G(OUTPT) D
"RTN","ORMBLDPS",73,0)
 . N UNITS,UNT S UNITS=$$PTR("FREE TEXT"),UNT=$G(ORDIALOG(UNITS,I))
"RTN","ORMBLDPS",74,0)
 . S:$L(UNT) Y=Y_" "_UNT ;old format
"RTN","ORMBLDPS",75,0)
 Q Y
"RTN","ORMBLDPS",76,0)
 ;
"RTN","ORMBLDPS",77,0)
HL7DUR()  ; -- Returns HL7 form of duration X
"RTN","ORMBLDPS",78,0)
 N X,X1,X2,Y S X=$G(ORDIALOG(DUR,I))
"RTN","ORMBLDPS",79,0)
 S X1=+$G(X),Y="" G:X1'>0 HDQ
"RTN","ORMBLDPS",80,0)
 S X2=$$UP^XLFSTR($P(X,X1,2)) S:$E(X2)=" " X2=$E(X2,2,99)
"RTN","ORMBLDPS",81,0)
 S Y=$S($E(X2,1,2)="MO":"L",'$L(X2):"D",1:$E(X2))_X1
"RTN","ORMBLDPS",82,0)
HDQ Q Y
"RTN","ORMBLDPS",83,0)
 ;
"RTN","ORMBLDPS",84,0)
IV ; -- new IV Meds order
"RTN","ORMBLDPS",85,0)
 N SOLN,VOL,ADDS,STR,UNITS,RATE,URG,WP,QT,I,X1,X2,INST
"RTN","ORMBLDPS",86,0)
 N IVLIMIT ; duratioin or total volume for IV order
"RTN","ORMBLDPS",87,0)
 S IVLIMIT=$$PTR("DURATION")
"RTN","ORMBLDPS",88,0)
 S RATE=$$PTR("INFUSION RATE"),ADDS=$$PTR("ADDITIVE")
"RTN","ORMBLDPS",89,0)
 S STR=$$PTR("STRENGTH PSIV"),UNITS=$$PTR("UNITS")
"RTN","ORMBLDPS",90,0)
 S WP=$$PTR("WORD PROCESSING 1"),VOL=$$PTR("VOLUME")
"RTN","ORMBLDPS",91,0)
 S SOLN=$$PTR("ORDERABLE ITEM"),URG=+$G(ORDIALOG($$PTR("URGENCY"),1))
"RTN","ORMBLDPS",92,0)
 S QT=U_$G(ORDIALOG(+$$PTR("SCHEDULE"),1))_"^^^^"
"RTN","ORMBLDPS",93,0)
 S:URG QT=QT_$P($G(^ORD(101.42,URG,0)),U,2) S $P(ORMSG(4),"|",8)=QT
"RTN","ORMBLDPS",94,0)
 S X=$G(^OR(100,IFN,8,1,0)) I $P(X,U,5),$P(X,U,5)'=$P(X,U,3) S $P(ORMSG(4),"|",13)=$P(X,U,5) ; Send signer instead of orderer if different
"RTN","ORMBLDPS",95,0)
 S RATE=$G(ORDIALOG(RATE,1)) S:$E(RATE,$L(RATE))=" " RATE=$E(RATE,1,($L(RATE)-1)) S ORMSG(5)="RXO|^^^PS-1^IV^99OTH|"_RATE ;strip any trailing spaces
"RTN","ORMBLDPS",96,0)
 S IVLIMIT=$G(ORDIALOG(IVLIMIT,1))
"RTN","ORMBLDPS",97,0)
 I $L(IVLIMIT) S IVLIMIT=$$HL7IVLMT(IVLIMIT),ORMSG(5)="RXO|^^"_IVLIMIT_"^PS-1^IV^99OTH|"_RATE
"RTN","ORMBLDPS",98,0)
 S I=5 I $L($G(ORDIALOG(WP,1))) D
"RTN","ORMBLDPS",99,0)
 . N J,K S J=$O(^TMP("ORWORD",$J,WP,1,0)) Q:'J
"RTN","ORMBLDPS",100,0)
 . S I=6,ORMSG(6)="NTE|6|P|"_$G(^TMP("ORWORD",$J,WP,1,J,0))
"RTN","ORMBLDPS",101,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,WP,1,J)) Q:J'>0  S K=K+1,ORMSG(6,K)=^(J,0)
"RTN","ORMBLDPS",102,0)
IV1 S INST=0 F  S INST=$O(ORDIALOG(SOLN,INST)) Q:INST'>0  D
"RTN","ORMBLDPS",103,0)
 . S X1="B",X2=+$G(ORDIALOG(SOLN,INST))
"RTN","ORMBLDPS",104,0)
 . I $P($G(^ORD(101.43,X2,"PS")),U,4) S X1=X1_"A" ;pre-mix
"RTN","ORMBLDPS",105,0)
 . S I=I+1,ORMSG(I)="RXC|"_X1_"|"_$$USID^ORMBLD(X2)_"|"_$G(ORDIALOG(VOL,INST))_"|"_$$HL7UNIT("ML")
"RTN","ORMBLDPS",106,0)
 I $O(ORDIALOG(ADDS,0)) D
"RTN","ORMBLDPS",107,0)
 . S INST=0 F  S INST=$O(ORDIALOG(ADDS,INST)) Q:INST'>0  D
"RTN","ORMBLDPS",108,0)
 . . S X1=$G(ORDIALOG(ADDS,INST)),X2=$G(ORDIALOG(UNITS,INST))
"RTN","ORMBLDPS",109,0)
 . . S I=I+1,ORMSG(I)="RXC|A|"_$$USID^ORMBLD(X1)_"|"_$G(ORDIALOG(STR,INST))_"|"_$$HL7UNIT(X2)
"RTN","ORMBLDPS",110,0)
 I $D(^OR(100,IFN,9)) D ORDCHKS
"RTN","ORMBLDPS",111,0)
 S I=I+1,ORMSG(I)=$$ZRX(IFN)
"RTN","ORMBLDPS",112,0)
 ; Create DG1 & ZCL segment(s) for Billing Awareness (BA) Project
"RTN","ORMBLDPS",113,0)
 D DG1^ORWDBA3($G(IFN),"I",I)
"RTN","ORMBLDPS",114,0)
 Q
"RTN","ORMBLDPS",115,0)
 ;
"RTN","ORMBLDPS",116,0)
RXR(ROUTE) ; -- Returns RXR segment
"RTN","ORMBLDPS",117,0)
 N NAME S NAME=$$GET1^DIQ(51.2,+ROUTE_",",.01)
"RTN","ORMBLDPS",118,0)
 Q "RXR|^^^"_+ROUTE_U_NAME_"^99PSR"
"RTN","ORMBLDPS",119,0)
 ;
"RTN","ORMBLDPS",120,0)
ZRX(IFN) ; -- Returns ZRX segment
"RTN","ORMBLDPS",121,0)
 N NATURE,TYPE,ORIG,PSORIG,ZRX
"RTN","ORMBLDPS",122,0)
 S TYPE=$P($G(^OR(100,IFN,3)),U,11),NATURE=$P($G(^(8,1,0)),U,12)
"RTN","ORMBLDPS",123,0)
 S:NATURE NATURE=$P($G(^ORD(100.02,+NATURE,0)),U,2) ;code
"RTN","ORMBLDPS",124,0)
 S PSORIG="" I (TYPE=1)!(TYPE=2) D
"RTN","ORMBLDPS",125,0)
 . S ORIG=$P($G(^OR(100,IFN,3)),U,5),PSORIG=$G(^OR(100,+ORIG,4))
"RTN","ORMBLDPS",126,0)
 . I PSORIG'>0 S PSORIG="",TYPE=0 ;edit of unreleased order
"RTN","ORMBLDPS",127,0)
 S ZRX="ZRX|"_PSORIG_"|"_NATURE_"|"_$S(TYPE=1:"E",TYPE=2:"R",1:"N")
"RTN","ORMBLDPS",128,0)
 I $G(OUTPT) S ZRX=ZRX_"|"_$G(ORDIALOG($$PTR("ROUTING"),1))_$S($L($P($G(^OR(100,ORIFN,8,1,2)),"^",3)):"|||1",1:"")
"RTN","ORMBLDPS",129,0)
 Q ZRX
"RTN","ORMBLDPS",130,0)
 ;
"RTN","ORMBLDPS",131,0)
ZRN(IFN,ORMSG,I) ; -- Set ZRN segment
"RTN","ORMBLDPS",132,0)
 N ST,ZRN,J,K,TXT
"RTN","ORMBLDPS",133,0)
 S ORMSG(I)="ZRN|N|"
"RTN","ORMBLDPS",134,0)
 S ST=$$PTR("STATEMENTS")
"RTN","ORMBLDPS",135,0)
 I $L($G(ORDIALOG(ST,1))) D
"RTN","ORMBLDPS",136,0)
 . S J=$O(^TMP("ORWORD",$J,ST,1,0)) Q:'J
"RTN","ORMBLDPS",137,0)
 . S K=0,TXT=$G(^TMP("ORWORD",$J,ST,1,J,0))
"RTN","ORMBLDPS",138,0)
 . I $L(TXT) S K=K+1,ORMSG(I,K)=TXT
"RTN","ORMBLDPS",139,0)
 . F  S J=$O(^TMP("ORWORD",$J,ST,1,J)) Q:J'>0  S TXT=$G(^(J,0)) D
"RTN","ORMBLDPS",140,0)
 . . I $L(TXT) S K=K+1,ORMSG(I,K)=TXT
"RTN","ORMBLDPS",141,0)
 Q
"RTN","ORMBLDPS",142,0)
 ;
"RTN","ORMBLDPS",143,0)
ORDCHKS ; -- Include order checks in OBX segments
"RTN","ORMBLDPS",144,0)
 N OC,X,X1 S OC=0
"RTN","ORMBLDPS",145,0)
 F  S OC=$O(^OR(100,IFN,9,OC)) Q:OC'>0  S X=$G(^(OC,0)),X1=$G(^(1)) D
"RTN","ORMBLDPS",146,0)
 . S I=I+1,ORMSG(I)="OBX|"_OC_"|TX|^^^"_+X_"^^99OCX||"_$S($L(X1):X1,1:$P(X,U,3))_"|||||||||"_$$FMTHL7^XLFDT($P(X,U,6))_"||"_$P(X,U,5)
"RTN","ORMBLDPS",147,0)
 . I $L($P(X,U,4)) S I=I+1,ORMSG(I)="NTE|"_OC_"|P|"_$P(X,U,4)
"RTN","ORMBLDPS",148,0)
 Q
"RTN","ORMBLDPS",149,0)
 ;
"RTN","ORMBLDPS",150,0)
HL7UNIT(X) ; -- Return coded element for volume/strength units
"RTN","ORMBLDPS",151,0)
 N I,UNIT,Y
"RTN","ORMBLDPS",152,0)
 F I=1:1:$L(X) I $E(X,I)?1A Q  ; first letter
"RTN","ORMBLDPS",153,0)
 S UNIT=$$UP^XLFSTR($E(X,I,$L(X))),Y=""
"RTN","ORMBLDPS",154,0)
 F I=1:1:11 S X=$T(UNITS+I) I UNIT=$P(X,";",3) S Y="^^^PSIV-"_I_U_UNIT_"^99OTH" Q
"RTN","ORMBLDPS",155,0)
 Q Y
"RTN","ORMBLDPS",156,0)
 ;
"RTN","ORMBLDPS",157,0)
UNITS ; -- allowable PS units
"RTN","ORMBLDPS",158,0)
 ;;ML
"RTN","ORMBLDPS",159,0)
 ;;LITER
"RTN","ORMBLDPS",160,0)
 ;;MCG
"RTN","ORMBLDPS",161,0)
 ;;MG
"RTN","ORMBLDPS",162,0)
 ;;GM
"RTN","ORMBLDPS",163,0)
 ;;UNITS
"RTN","ORMBLDPS",164,0)
 ;;IU
"RTN","ORMBLDPS",165,0)
 ;;MEQ
"RTN","ORMBLDPS",166,0)
 ;;MM
"RTN","ORMBLDPS",167,0)
 ;;MU
"RTN","ORMBLDPS",168,0)
 ;;THOUU
"RTN","ORMBLDPS",169,0)
HL7TIME(X) ; -- Return HL7 formatted duration
"RTN","ORMBLDPS",170,0)
 N I,Y S Y=""
"RTN","ORMBLDPS",171,0)
 F I=1:1:$L(X) I $E(X,I)?1A S Y=$$UP^XLFSTR($E(X,I)) Q  ; first letter
"RTN","ORMBLDPS",172,0)
 S Y=Y_+X
"RTN","ORMBLDPS",173,0)
 Q Y
"RTN","ORMBLDPS",174,0)
 ;
"RTN","ORMBLDPS",175,0)
VER(IFN) ; -- Send msg for nurse-verified orders
"RTN","ORMBLDPS",176,0)
 N OR0,ORMSG S OR0=$G(^OR(100,+IFN,0)) Q:$P(OR0,U,12)'="I"  ;Inpt only
"RTN","ORMBLDPS",177,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORM","PS"),ORMSG(2)=$$PID^ORMBLD($P(OR0,U,2))
"RTN","ORMBLDPS",178,0)
 S ORMSG(3)=$$PV1^ORMBLD($P(OR0,U,2),$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORMBLDPS",179,0)
 S ORMSG(4)="ORC|ZV|"_IFN_"^OR|"_$G(^OR(100,+IFN,4))_"^PS||||||||"_DUZ_"||||"_$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ORMBLDPS",180,0)
 D MSG^XQOR("OR EVSEND PS",.ORMSG)
"RTN","ORMBLDPS",181,0)
 Q
"RTN","ORMBLDPS",182,0)
 ;
"RTN","ORMBLDPS",183,0)
REF(IFN,ROUTING,CLINIC) ; -- Send msg for refill request
"RTN","ORMBLDPS",184,0)
 N OR0,ORMSG S OR0=$G(^OR(100,+IFN,0)) Q:$P(OR0,U,12)'="O"
"RTN","ORMBLDPS",185,0)
 S:'$G(CLINIC) CLINIC=$S($G(ORL):+ORL,1:+$P(OR0,U,10))
"RTN","ORMBLDPS",186,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORM","PS"),ORMSG(2)=$$PID^ORMBLD($P(OR0,U,2))
"RTN","ORMBLDPS",187,0)
 S ORMSG(3)=$$PV1^ORMBLD($P(OR0,U,2),"O",CLINIC)
"RTN","ORMBLDPS",188,0)
 S ORMSG(4)="ORC|ZF|"_IFN_"^OR|"_$G(^OR(100,+IFN,4))_"^PS|||||||"_DUZ_"||"_$G(ORNP)_"|||"_$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ORMBLDPS",189,0)
 S ORMSG(5)="ZRX||||"_ROUTING
"RTN","ORMBLDPS",190,0)
 D MSG^XQOR("OR EVSEND PS",.ORMSG)
"RTN","ORMBLDPS",191,0)
 Q
"RTN","ORMBLDPS",192,0)
HL7IVLMT(STR) ;
"RTN","ORMBLDPS",193,0)
 N VAL,UNIT,IVLMT
"RTN","ORMBLDPS",194,0)
 S (UNIT,IVLMT)="",VAL=0
"RTN","ORMBLDPS",195,0)
 I $E($$LOW^XLFSTR(STR))="f" D
"RTN","ORMBLDPS",196,0)
 . S VAL=$P(STR," ",2)
"RTN","ORMBLDPS",197,0)
 . S UNIT=$E($P(STR," ",3))
"RTN","ORMBLDPS",198,0)
 I $E($$LOW^XLFSTR(STR))="w" D
"RTN","ORMBLDPS",199,0)
 . S VAL=+$P(STR," ",4)
"RTN","ORMBLDPS",200,0)
 . S UNIT=$E($P(STR," ",4),$L(VAL)+1)
"RTN","ORMBLDPS",201,0)
 I $L(UNIT),$L(VAL) S IVLMT=$$LOW^XLFSTR(UNIT)_VAL
"RTN","ORMBLDPS",202,0)
 Q IVLMT
"RTN","ORMBLDRA")
0^44^B8026244
"RTN","ORMBLDRA",1,0)
ORMBLDRA ; SLC/MKB - Build outgoing Radiology ORM msgs ;11/17/00  11:14
"RTN","ORMBLDRA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**75,97,190,195**;Dec 17, 1997
"RTN","ORMBLDRA",3,0)
HL7DATE(DATE) ; -- FM -> HL7 format
"RTN","ORMBLDRA",4,0)
 Q $$FMTHL7^XLFDT(DATE)  ;**97
"RTN","ORMBLDRA",5,0)
 ;
"RTN","ORMBLDRA",6,0)
PTR(NAME) ; -- Returns ptr value of prompt in Dialog file
"RTN","ORMBLDRA",7,0)
 Q $O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMBLDRA",8,0)
 ;
"RTN","ORMBLDRA",9,0)
EN ; -- Segments for new Radiology order
"RTN","ORMBLDRA",10,0)
 N ORSEX,OI,START,IP,URG,ILOC,MODE,CATG,PREOP,PREG,MODS,CLHIST,PROV,QT,I,J,Z
"RTN","ORMBLDRA",11,0)
 S OI=$G(ORDIALOG($$PTR("ORDERABLE ITEM"),1))
"RTN","ORMBLDRA",12,0)
 S START=$P($G(^OR(100,IFN,0)),U,8),IP=$G(ORDIALOG($$PTR("YES/NO"),1))
"RTN","ORMBLDRA",13,0)
 S URG=$P($G(^ORD(101.42,+$G(ORDIALOG($$PTR("URGENCY"),1)),0)),U,2)
"RTN","ORMBLDRA",14,0)
 S ILOC=$G(ORDIALOG($$PTR("IMAGING LOCATION"),1))
"RTN","ORMBLDRA",15,0)
 S MODE=$G(ORDIALOG($$PTR("MODE OF TRANSPORT"),1))
"RTN","ORMBLDRA",16,0)
 S CATG=$G(ORDIALOG($$PTR("CATEGORY"),1))
"RTN","ORMBLDRA",17,0)
 S PREOP=$G(ORDIALOG($$PTR("PRE-OP SCHEDULED DATE/TIME"),1))
"RTN","ORMBLDRA",18,0)
 S PREG=$G(ORDIALOG($$PTR("PREGNANT"),1))
"RTN","ORMBLDRA",19,0)
 S MODS=$$PTR("MODIFIERS"),CLHIST=$$PTR("WORD PROCESSING 1")
"RTN","ORMBLDRA",20,0)
 S MODS=$$MULT(MODS) S:ILOC ILOC=ILOC_U_$P($G(^RA(79.1,+ILOC,0)),U)
"RTN","ORMBLDRA",21,0)
 S MODE=$S(MODE="A":"WALK",MODE="P":"PORT",MODE="S":"CART",1:"WHLC")
"RTN","ORMBLDRA",22,0)
 S PREG=$S(PREG="Y":"YES",PREG="N":"NO",1:"UNKNOWN")
"RTN","ORMBLDRA",23,0)
 S QT="^^^"_$$HL7DATE(START)_"^^"_URG,$P(ORMSG(4),"|",8)=QT
"RTN","ORMBLDRA",24,0)
 S PROV=+$G(ORDIALOG($$PTR("PROVIDER"),1)) S:PROV $P(ORMSG(4),"|",12)=PROV
"RTN","ORMBLDRA",25,0)
 S ORMSG(5)="OBR||||"_$$USID^ORMBLD(OI)_"||||||||"_$S(IP:"isolation",1:"")_"||||||"_MODS_"|"_ILOC_"|||||||||||"_MODE,I=5
"RTN","ORMBLDRA",26,0)
 ; Create DG1 & ZCL segment(s) for Billing Awareness (BA) Project
"RTN","ORMBLDRA",27,0)
 D DG1^ORWDBA3($G(IFN),"I",I)
"RTN","ORMBLDRA",28,0)
OBX S J=0 F  S J=$O(^TMP("ORWORD",$J,CLHIST,1,J)) Q:J'>0  S I=I+1,ORMSG(I)="OBX|"_J_"|TX|2000.02^CLINICAL HISTORY^AS4|1|"_^(J,0)
"RTN","ORMBLDRA",29,0)
 S ORSEX=$P($G(^DPT(+ORVP,0)),U,2)
"RTN","ORMBLDRA",30,0)
 S:ORSEX="F" I=I+1,ORMSG(I)="OBX|1|TX|2000.33^PREGNANT^AS4||"_PREG
"RTN","ORMBLDRA",31,0)
 S:PREOP I=I+1,ORMSG(I)="OBX|1|TS|^PRE-OP SCHEDULED DATE/TIME||"_$$HL7DATE(PREOP)
"RTN","ORMBLDRA",32,0)
 I "CS"[CATG S Z=$$PTR("CONTRACT/SHARING SOURCE"),I=I+1,ORMSG(I)="OBX|1|CE|34^CONTRACT/SHARING SOURCE^99DD||"_+$G(ORDIALOG(Z,1))_U_$P($G(^DIC(34,+$G(ORDIALOG(Z,1)),0)),U)
"RTN","ORMBLDRA",33,0)
 I CATG="R" S Z=$$PTR("RESEARCH SOURCE"),I=I+1,ORMSG(I)="OBX|1|TX|^RESEARCH SOURCE||"_$G(ORDIALOG(Z,1))
"RTN","ORMBLDRA",34,0)
 Q
"RTN","ORMBLDRA",35,0)
 ;
"RTN","ORMBLDRA",36,0)
MULT(M) ; -- Returns string of MODIFIER~MODIFIER~...
"RTN","ORMBLDRA",37,0)
 N I,X S X="" Q:'$O(ORDIALOG(M,0)) X
"RTN","ORMBLDRA",38,0)
 S I=$O(ORDIALOG(M,0)),X=$P($G(^RAMIS(71.2,+ORDIALOG(M,I),0)),U)
"RTN","ORMBLDRA",39,0)
 F  S I=$O(ORDIALOG(M,I)) Q:I'>0  S X=X_"~"_$P($G(^RAMIS(71.2,+ORDIALOG(M,I),0)),U)
"RTN","ORMBLDRA",40,0)
 Q X
"RTN","ORMEVNT")
0^66^B71407003
"RTN","ORMEVNT",1,0)
ORMEVNT ;SLC/MKB-Trigger HL7 msg off MAS events ;3/31/04  09:21
"RTN","ORMEVNT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**24,45,70,79,141,165,177,186,195**;Dec 17, 1997
"RTN","ORMEVNT",3,0)
 ;
"RTN","ORMEVNT",4,0)
EN1 ; -- tasked entry point
"RTN","ORMEVNT",5,0)
 Q:'$G(DFN)  Q:$D(DGPMPC)  Q:DGPMT=4!(DGPMT=5)  ;skip lodger mvts
"RTN","ORMEVNT",6,0)
 N ZTDESC,ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTSK,I
"RTN","ORMEVNT",7,0)
 S ZTDESC="Auto-DC and/or Release orders on MAS movement",ZTIO=""
"RTN","ORMEVNT",8,0)
 S ZTRTN="EN^ORMEVNT",ZTDTH=$H,ZTSAVE("^UTILITY(""DGPM"",$J,")=""
"RTN","ORMEVNT",9,0)
 F I="DFN","DGPMDA","DGPMA","DGPMP","DGPMT" S ZTSAVE(I)=""
"RTN","ORMEVNT",10,0)
 D ^%ZTLOAD ;D EN^ORYDGPM
"RTN","ORMEVNT",11,0)
 Q
"RTN","ORMEVNT",12,0)
 ;
"RTN","ORMEVNT",13,0)
EN ; -- main entry point
"RTN","ORMEVNT",14,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ORMEVNT",15,0)
 Q:'$G(DFN)  Q:$D(DGPMPC)  Q:DGPMT=4!(DGPMT=5)
"RTN","ORMEVNT",16,0)
 I '$G(DGPMP) S ^XTMP("OREVENT",DFN,DGPMDA,0)=DT_U_$$FMADD^XLFDT(DT,2)_U_"Event process flag" ;195
"RTN","ORMEVNT",17,0)
 I $G(DGPMP),$D(^XTMP("OREVENT",DFN,DGPMDA)) D EN1 ;195 edits processed after new
"RTN","ORMEVNT",18,0)
 N XQORQUIT,XQORPOP,DTOUT,DUOUT,DIRUT,DIROUT ;protect protocol context
"RTN","ORMEVNT",19,0)
 N VAIP,DONE,ORVP,ORWARD,ORTS,ORL,ORDIV,ORLAST,X,Y,I,ORCURRNT,OREVENT,ORDCRULE,ORACT,ORPRINT
"RTN","ORMEVNT",20,0)
 S VAIP("E")=DGPMDA D IN5^VADPT M ORVP=VAIP I '$G(DGPMA) D  Q  ;deleted
"RTN","ORMEVNT",21,0)
 . N LAST,OREVT S LAST=+$O(^ORE(100.2,"ADT",DGPMDA,""),-1) Q:LAST<1
"RTN","ORMEVNT",22,0)
 . S OREVT=+$O(^ORE(100.2,"ADT",DGPMDA,LAST,0))
"RTN","ORMEVNT",23,0)
 . D ACTLOG^OREVNTX(OREVT,"DL")
"RTN","ORMEVNT",24,0)
A ;
"RTN","ORMEVNT",25,0)
 S ORVP=+DFN_";DPT(",ORTS=+$G(^DPT(DFN,.103)),ORWARD=$G(^(.1))
"RTN","ORMEVNT",26,0)
 S ORWARD=$S($L(ORWARD):+$O(^DIC(42,"B",ORWARD,0)),1:0)
"RTN","ORMEVNT",27,0)
 S ORL=$S(ORWARD:+$G(^DIC(42,ORWARD,44))_";SC(",1:""),ORDIV=$$DIV(+ORL)
"RTN","ORMEVNT",28,0)
 S ORLAST("TS")=$$PREVTS,X=+VAIP(15,4) F I="WD","LOC","DIV" S ORLAST(I)=""
"RTN","ORMEVNT",29,0)
 S:X ORLAST("WD")=X,Y=+$G(^DIC(42,X,44)),ORLAST("LOC")=Y_";SC(",ORLAST("DIV")=$$DIV(Y)
"RTN","ORMEVNT",30,0)
 S ORCURRNT=$$CURRENT,OREVENT=$$PATEVT,ORACT=$S($G(DGPMP):"ED",1:"NW")
"RTN","ORMEVNT",31,0)
 I OREVENT=-1 D EN1 Q  ;195 Can't lock, retry
"RTN","ORMEVNT",32,0)
 I $G(DGPMP),$D(^ORE(100.2,"ADT",DGPMDA)) D  Q:$G(DONE)  ;edited
"RTN","ORMEVNT",33,0)
 . N LAST,OREVT,DA,X,I S LAST=+$O(^ORE(100.2,"ADT",DGPMDA,""),-1) Q:LAST<1
"RTN","ORMEVNT",34,0)
 . S OREVT=+$O(^ORE(100.2,"ADT",DGPMDA,LAST,0)),DA=+$O(^(OREVT,0))
"RTN","ORMEVNT",35,0)
 . S X=$G(^ORE(100.2,OREVT,10,DA,0)) ;last activity on movement
"RTN","ORMEVNT",36,0)
 . I $P(X,U,5)=+$G(VAIP(4)),$P(X,U,6)=+$G(VAIP(8)),$P(X,U,7)=+$G(VAIP(5)) S DONE=1 Q  ;no change
"RTN","ORMEVNT",37,0)
 . I 'OREVENT D ACTLOG^OREVNTX(OREVT,"ED",$$TYPE(DGPMT),1) S DONE=1
"RTN","ORMEVNT",38,0)
B ;
"RTN","ORMEVNT",39,0)
 I '$G(DGPMP),ORCURRNT D  ;new mvt - autoDC
"RTN","ORMEVNT",40,0)
 . I $D(^ORE(100.2,"ADT",DGPMDA)) D  Q:$G(DONE)  ;ReEntered
"RTN","ORMEVNT",41,0)
 .. N LAST,OREVT S DONE=0
"RTN","ORMEVNT",42,0)
 .. S LAST=+$O(^ORE(100.2,"ADT",DGPMDA,""),-1),OREVT=+$O(^(LAST,0))
"RTN","ORMEVNT",43,0)
 .. Q:+ORVP'=+$G(^ORE(100.2,OREVT,0))  ;diff pat -> diff mvt
"RTN","ORMEVNT",44,0)
 .. S ORACT="RE",DONE=1 Q:OREVENT  ;log on new event instead
"RTN","ORMEVNT",45,0)
 .. D ACTLOG^OREVNTX(OREVT,ORACT,$$TYPE(DGPMT),1)
"RTN","ORMEVNT",46,0)
 . I DGPMT=3 D COMP("ALG") ;keep until GMRA*4*15 gets out
"RTN","ORMEVNT",47,0)
 . S ORDCRULE=$$DCEVT D:ORDCRULE AUTODC^ORMEVNT1(ORDCRULE,$P(DGPMA,U))
"RTN","ORMEVNT",48,0)
 . I DGPMT=1!(DGPMT=2&("^13^40^"[("^"_$P(DGPMA,U,18)_"^"))) I $G(^XTMP("ORDCOBS-"_+ORVP,0)) D REINST ;186 TO ASIH tran mvmt
"RTN","ORMEVNT",49,0)
C ;
"RTN","ORMEVNT",50,0)
 I OREVENT D  ;release delayed orders, complete event
"RTN","ORMEVNT",51,0)
 . D RELEASE^ORMEVNT1(OREVENT),DONE^OREVNTX(OREVENT,$P(DGPMA,U),DGPMDA)
"RTN","ORMEVNT",52,0)
 . I '$G(VAIP(1)) M VAIP=ORVP ;reset for ACTLOG use
"RTN","ORMEVNT",53,0)
 . D ACTLOG^OREVNTX(OREVENT,ORACT,$$TYPE(DGPMT),1)
"RTN","ORMEVNT",54,0)
 . I DGPMT=1,'$P($G(^ORE(100.2,+OREVENT,0)),U,3) S $P(^(0),U,3)=DGPMDA
"RTN","ORMEVNT",55,0)
 . ;D UNLEVT^ORX2(OREVENT)
"RTN","ORMEVNT",56,0)
 I $O(ORPRINT(0)),$G(ORL) D PRINTS^ORWD1(.ORPRINT,+ORL)
"RTN","ORMEVNT",57,0)
 I DGPMT=3,ORCURRNT,'$G(DGPMP) D DISCH ;lapse remaining events
"RTN","ORMEVNT",58,0)
 I '$G(DFN),$G(ORVP) S DFN=+ORVP ;just in case
"RTN","ORMEVNT",59,0)
 D:$G(OREVENT) UNLEVT^ORX2(OREVENT) K ^XTMP("OREVENT",DFN,DGPMDA) ;195
"RTN","ORMEVNT",60,0)
 Q
"RTN","ORMEVNT",61,0)
 ;
"RTN","ORMEVNT",62,0)
CURRENT() ; -- Returns 1 or 0, if DGPMDA is the latest movement
"RTN","ORMEVNT",63,0)
 N Y,LAST,LASTYPE,LASTDT S Y=0
"RTN","ORMEVNT",64,0)
 S LAST=+VAIP(14),LASTDT=+VAIP(14,1),LASTYPE=+VAIP(14,2)
"RTN","ORMEVNT",65,0)
 ; VAIP(14) = last physical movement for the admission
"RTN","ORMEVNT",66,0)
 I DGPMT=6 D  G CQ
"RTN","ORMEVNT",67,0)
 . N CA,IDT I LAST,LASTDT>+VAIP(3) Q  ;last physical mvt
"RTN","ORMEVNT",68,0)
 . S CA=+VAIP(13),IDT=9999999.9999999-VAIP(3)
"RTN","ORMEVNT",69,0)
 . I '$O(^DGPM("ATS",DFN,CA,IDT),-1) S Y=1 Q  ;last TS mvt
"RTN","ORMEVNT",70,0)
 I DGPMT=3 D  ;get last mvt overall
"RTN","ORMEVNT",71,0)
 . N VAIP,Y S VAIP("D")="LAST" D IN5^VADPT
"RTN","ORMEVNT",72,0)
 . S LAST=+VAIP(14),LASTYPE=+VAIP(14,2) ;reset
"RTN","ORMEVNT",73,0)
 I LAST=DGPMDA S Y=1 G CQ ;primary mvt
"RTN","ORMEVNT",74,0)
 I $D(^UTILITY("DGPM",$J,LASTYPE,LAST)) S Y=1 ;secondary mvt
"RTN","ORMEVNT",75,0)
CQ Q Y
"RTN","ORMEVNT",76,0)
 ;
"RTN","ORMEVNT",77,0)
PREVTS() ; -- Returns previous treating specialty
"RTN","ORMEVNT",78,0)
 N TS,TSP,CA,ID,LAST,Y
"RTN","ORMEVNT",79,0)
 S TS=+$O(^UTILITY("DGPM",$J,6,0)),TSP=$G(^(TS,"P"))
"RTN","ORMEVNT",80,0)
 I $G(TSP) S Y=+$P(TSP,U,9) G PRVQ ;edited TS mvt
"RTN","ORMEVNT",81,0)
 ; look for TS mvt since last phys mvt
"RTN","ORMEVNT",82,0)
 S CA=$P(DGPMA,U,14),ID=9999999.9999999-DGPMA
"RTN","ORMEVNT",83,0)
 S LAST=+$O(^DGPM("ATS",DFN,CA,ID)),Y=$S(LAST:+$O(^(LAST,0)),1:+VAIP(15,6))
"RTN","ORMEVNT",84,0)
PRVQ Q Y
"RTN","ORMEVNT",85,0)
 ;
"RTN","ORMEVNT",86,0)
TYPE(X) ; -- Return type of event from MAS code
"RTN","ORMEVNT",87,0)
 N Y S Y=$S(X=1:"A",X=2:"T",X=3:"D",X=6:"S",1:"")
"RTN","ORMEVNT",88,0)
 Q Y
"RTN","ORMEVNT",89,0)
 ;
"RTN","ORMEVNT",90,0)
DIV(LOC) ; -- Return Institution file #4 ptr for LOC
"RTN","ORMEVNT",91,0)
 N X0,Y S X0=$G(^SC(+LOC,0))
"RTN","ORMEVNT",92,0)
 S Y=$S($P(X0,U,4):$P(X0,U,4),$P(X0,U,15):$$SITE^VASITE(DT,$P(X0,U,15)),1:+$G(DUZ(2)))
"RTN","ORMEVNT",93,0)
 Q Y
"RTN","ORMEVNT",94,0)
 ;
"RTN","ORMEVNT",95,0)
PATEVT() ; -- Find match to new data in Patient Event file
"RTN","ORMEVNT",96,0)
 N TYPE,MVTYPE,EVT,IFN,X0,Y S Y="" G:'$G(ORCURRNT) PTQ
"RTN","ORMEVNT",97,0)
 S TYPE=$S(DGPMT=1:"A",DGPMT=3:"D",DGPMT=2!(DGPMT=6):"T",1:""),EVT=0
"RTN","ORMEVNT",98,0)
 S MVTYPE=$P(DGPMA,U,18),TYPE(1)="",MVTYPE(1)=""
"RTN","ORMEVNT",99,0)
 I DGPMT=2,MVTYPE=13 S TYPE(1)="A",MVTYPE(1)=40 ;To ASIH
"RTN","ORMEVNT",100,0)
 I DGPMT=3,MVTYPE=41 S TYPE(1)="T",MVTYPE(1)=14 ;From ASIH
"RTN","ORMEVNT",101,0)
 I DGPMT'=3,$$GET1^DIQ(45.7,+$G(ORTS)_",","SPECIALTY:SERVICE")="NHCU" S TYPE(1)=$S(TYPE="A":"T",1:"A") ;DBIA #1154
"RTN","ORMEVNT",102,0)
 F  S EVT=+$O(^ORE(100.2,"AE",DFN,EVT)) Q:EVT<1  S IFN=+$O(^(EVT,0)) D  Q:Y
"RTN","ORMEVNT",103,0)
 . Q:$$LAPSED^OREVNTX(+IFN)  Q:$P($G(^ORE(100.2,IFN,1)),U,5)
"RTN","ORMEVNT",104,0)
 . S X0=$G(^ORD(100.5,EVT,0)) Q:$P(X0,U,3)'=ORDIV
"RTN","ORMEVNT",105,0)
 . I $P(X0,U,2)'=TYPE,$P(X0,U,2)'=TYPE(1) Q  ;Xaction type
"RTN","ORMEVNT",106,0)
 . I $P(X0,U,7),$P(X0,U,7)'=MVTYPE,$P(X0,U,7)'=MVTYPE(1) Q  ;Mvt type
"RTN","ORMEVNT",107,0)
 . I $O(^ORD(100.5,EVT,"TS",0)) Q:'$D(^("B",ORTS))  Q:ORTS=ORLAST("TS")&(ORDIV=ORLAST("DIV"))
"RTN","ORMEVNT",108,0)
 . I $O(^ORD(100.5,EVT,"LOC",0)) Q:'$D(^("B",ORWARD))  Q:ORWARD=ORLAST("WD")
"RTN","ORMEVNT",109,0)
 . S Y=+IFN ;ok
"RTN","ORMEVNT",110,0)
 I Y S:'$$LCKEVT^ORX2(Y) Y=-1 ;195 Lock event if possible
"RTN","ORMEVNT",111,0)
PTQ Q Y
"RTN","ORMEVNT",112,0)
 ;
"RTN","ORMEVNT",113,0)
DCEVT() ; -- Find match to event in AutoDC Rules file for [new] ORDIV,ORTS,ORL
"RTN","ORMEVNT",114,0)
 N MVTYPE,DIV,XFER,ORY,EXC,OBS
"RTN","ORMEVNT",115,0)
 S OBS=$S(DGPMT=3:$$MVT^DGPMOBS(DGPMDA),1:0) ;observation mvt
"RTN","ORMEVNT",116,0)
 S MVTYPE=+$P(DGPMA,U,18) S:MVTYPE=41 MVTYPE=14 S:MVTYPE=40 MVTYPE=13 ;ASIH- 186
"RTN","ORMEVNT",117,0)
 S XFER=$S(DGPMT=2:1,DGPMT=6:1,MVTYPE'=14:0,OBS:0,1:1)
"RTN","ORMEVNT",118,0)
 I DGPMT=2,MVTYPE=13,$G(^XTMP("ORDCOBS-"_+ORVP,"READMIT")) S ORY=0 K ^XTMP("ORDCOBS-"_+ORVP,"READMIT") G DCQ ;186 Obs readmit from ASIH don't auto-dc
"RTN","ORMEVNT",119,0)
 I XFER,ORLAST("TS")'=ORTS,$D(^ORD(100.6,"AC",ORDIV,20)) S MVTYPE=20 ;TS
"RTN","ORMEVNT",120,0)
 S DIV=ORDIV I DGPMT=3,MVTYPE'=14 S DIV=ORLAST("DIV") ;discharge
"RTN","ORMEVNT",121,0)
 S ORY=+$O(^ORD(100.6,"AC",ORDIV,MVTYPE,0)) K:ORY<1&(DGPMT=3)&(OBS) ^XTMP("ORDCOBS-"_+ORVP) G:ORY<1 DCQ ;186, If obs, no active rule, no reinstate
"RTN","ORMEVNT",122,0)
 I MVTYPE=20,$D(^ORD(100.6,ORY,4,ORLAST("TS"),1,ORTS))!(ORTS=ORLAST("TS")) S ORY=0 G DCQ
"RTN","ORMEVNT",123,0)
 I MVTYPE=4 D  G DCQ ;ck Div and Loc multiples
"RTN","ORMEVNT",124,0)
 . I ORLAST("DIV")'=ORDIV S:'$D(^ORD(100.6,ORY,6,ORLAST("DIV"))) ORY=0 Q
"RTN","ORMEVNT",125,0)
 . N OLD,INCL S INCL=0 ;ck incl loc's
"RTN","ORMEVNT",126,0)
 . F OLD=+ORLAST("LOC"),"ALL" I $D(^ORD(100.6,ORY,5,"ADC",OLD,+ORL))!$D(^("ALL")) S INCL=1 Q
"RTN","ORMEVNT",127,0)
 . S:'INCL ORY=0
"RTN","ORMEVNT",128,0)
 I DGPMT=3,OBS D  ;readmitting from observation?
"RTN","ORMEVNT",129,0)
 . N TORY
"RTN","ORMEVNT",130,0)
 . S TORY=ORY
"RTN","ORMEVNT",131,0)
 . S EXC=+$P($G(^ORD(100.6,ORY,0)),U,6) S:EXC=2 ORY=0 ;ignore rule
"RTN","ORMEVNT",132,0)
 . I EXC=1,'$D(ZTQUEUED),$$READMIT S ORY=0
"RTN","ORMEVNT",133,0)
 . I ORY=0 D DCGEN^ORMEVNT2,TIMER^ORMEVNT2 S:"^14^41^"[("^"_$P(DGPMA,U,18)_"^") ^XTMP("ORDCOBS-"_+ORVP,"READMIT")=1 ;177,186 
"RTN","ORMEVNT",134,0)
 . K:ORY ^XTMP("ORDCOBS-"_+ORVP) ;have rule -> dc, don't reinstate meds
"RTN","ORMEVNT",135,0)
DCQ Q ORY
"RTN","ORMEVNT",136,0)
 ;
"RTN","ORMEVNT",137,0)
READMIT() ; -- Return 1 or 0, if patient is being readmitted
"RTN","ORMEVNT",138,0)
 N X,Y,DIR
"RTN","ORMEVNT",139,0)
 S DIR(0)="YA",DIR("A")="Will the patient be re-admitted immediately? "
"RTN","ORMEVNT",140,0)
 S DIR("?")="Enter YES if the patient is to be admitted to the hospital immediately following this discharge from observation."
"RTN","ORMEVNT",141,0)
 D ^DIR S:$D(DTOUT)!$D(DUOUT) Y="^"
"RTN","ORMEVNT",142,0)
 Q Y
"RTN","ORMEVNT",143,0)
 ;
"RTN","ORMEVNT",144,0)
COMP(ORDG) ; -- Complete orders on event [Keep until GMRA*4*15]
"RTN","ORMEVNT",145,0)
 N ORI,ORLIST,ORIFN,OREDT
"RTN","ORMEVNT",146,0)
 I 'ORDG S:ORDG?1.U ORDG=+$O(^ORD(100.98,"B",ORDG,0)) Q:ORDG'>0
"RTN","ORMEVNT",147,0)
 D EN^ORQ1(ORVP,ORDG,2) S ORI=0,OREDT=$P(DGPMA,U)
"RTN","ORMEVNT",148,0)
 F  S ORI=$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI'>0  S ORIFN=^(ORI) D STATUS^ORCSAVE2(+ORIFN,2) S:$G(OREDT) $P(^OR(100,+ORIFN,3),U)=OREDT,$P(^(6),U,6)=OREDT
"RTN","ORMEVNT",149,0)
 Q
"RTN","ORMEVNT",150,0)
 ;
"RTN","ORMEVNT",151,0)
LOC(NODE) ; -- Returns [new] patient location from NODE
"RTN","ORMEVNT",152,0)
 N X,Y S X=$P($G(NODE),U,6)
"RTN","ORMEVNT",153,0)
 I X'>0 S X=$P($G(^DPT(+ORVP,.1)),U) S:$L(X) X=$O(^DIC(42,"B",X,0))
"RTN","ORMEVNT",154,0)
 S Y=+$G(^DIC(42,+X,44))_";SC("
"RTN","ORMEVNT",155,0)
 Q Y
"RTN","ORMEVNT",156,0)
 ;
"RTN","ORMEVNT",157,0)
DISCH ; -- Lapse/cancel outstanding events on discharge
"RTN","ORMEVNT",158,0)
 D DISCH^ORMEVNT2 ;195 Code moved to ORMEVNT2 for space considerations
"RTN","ORMEVNT",159,0)
 Q
"RTN","ORMEVNT",160,0)
 ;
"RTN","ORMEVNT",161,0)
XTMP ; -- Save ORIFN to possibly reinstate on admission
"RTN","ORMEVNT",162,0)
 ;    Also uses ORVP, DGPMDA
"RTN","ORMEVNT",163,0)
 Q:'$G(DGPMDA)  Q:'$G(ORIFN)  Q:'$G(ORVP)
"RTN","ORMEVNT",164,0)
 N ORNOW S ORNOW=+$$NOW^XLFDT
"RTN","ORMEVNT",165,0)
 I $G(^XTMP("ORDCOBS-"_+ORVP,0)),+^(0)<ORNOW K ^XTMP("ORDCOBS-"_+ORVP)
"RTN","ORMEVNT",166,0)
 I '$G(^XTMP("ORDCOBS-"_+ORVP,0)) D
"RTN","ORMEVNT",167,0)
 . N ORNOW1H S ORNOW1H=$$FMADD^XLFDT(ORNOW,,1)
"RTN","ORMEVNT",168,0)
 . S ^XTMP("ORDCOBS-"_+ORVP,0)=ORNOW1H_U_ORNOW_"^InptMeds AutoDC'd on Discharge from Observation"
"RTN","ORMEVNT",169,0)
 S ^XTMP("ORDCOBS-"_+ORVP,+ORIFN)=$G(^OR(100,+ORIFN,4))
"RTN","ORMEVNT",170,0)
 S ^XTMP("ORDCOBS-"_+ORVP,"DISCHARGE")=DGPMDA
"RTN","ORMEVNT",171,0)
 Q
"RTN","ORMEVNT",172,0)
 ;
"RTN","ORMEVNT",173,0)
REINST ; -- Reinstate meds from observation
"RTN","ORMEVNT",174,0)
 I '$L($T(ENR^PSJOERI)) K ^XTMP("ORDCOBS-"_+ORVP) Q
"RTN","ORMEVNT",175,0)
 N ORIDT,ORLASTDC,X0,ORIFN,PSIFN
"RTN","ORMEVNT",176,0)
 S ORIDT=+$O(^DGPM("ATID3",+ORVP,0)) S:DGPMT=2 ORIDT=$O(^DGPM("ATID3",+ORVP,ORIDT)) Q:ORIDT<1  S ORLASTDC=+$O(^(ORIDT,0)) ;186 If reinstating for transfer TO ASIH then skip pseudo discharge for WHILE ASIH
"RTN","ORMEVNT",177,0)
 Q:$G(^XTMP("ORDCOBS-"_+ORVP,"DISCHARGE"))'=ORLASTDC  S X0=$G(^(0))
"RTN","ORMEVNT",178,0)
 I $P(X0,U)<$$NOW^XLFDT K ^XTMP("ORDCOBS-"_+ORVP) Q  ;readmit after one hour 177
"RTN","ORMEVNT",179,0)
 S ORIFN=0 F  S ORIFN=+$O(^XTMP("ORDCOBS-"_+ORVP,ORIFN))  Q:ORIFN<1  S PSIFN=$G(^(ORIFN)) D:PSIFN ENR^PSJOERI(+ORVP,PSIFN,+ORWARD)
"RTN","ORMEVNT",180,0)
 K ^XTMP("ORDCOBS-"_+ORVP)
"RTN","ORMEVNT",181,0)
 Q
"RTN","ORMEVNT",182,0)
 ;
"RTN","ORMEVNT",183,0)
 ; -- Moved code:
"RTN","ORMEVNT",184,0)
EXP(ORDER,ORSTOP) G EXP^ORMEVNT1
"RTN","ORMEVNT",185,0)
ACTIVE(ORDER,ORSTRT) G ACT^ORMEVNT1
"RTN","ORMEVNT",186,0)
PURGE(ORDER) G PUR^ORMEVNT1
"RTN","ORMEVNT2")
0^65^B20345613
"RTN","ORMEVNT2",1,0)
ORMEVNT2 ;SLC/DAN Additional event delayed order utilities ;3/31/04  09:12
"RTN","ORMEVNT2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**177,186,195**;Dec 17, 1997
"RTN","ORMEVNT2",3,0)
 ;
"RTN","ORMEVNT2",4,0)
 ;DBIA SECTION
"RTN","ORMEVNT2",5,0)
 ;10063 - %ZTLOAD
"RTN","ORMEVNT2",6,0)
 ;17    - DGPM("ATID3"
"RTN","ORMEVNT2",7,0)
 ;
"RTN","ORMEVNT2",8,0)
DCGEN ;Auto-dc admission generic order for observation episode of
"RTN","ORMEVNT2",9,0)
 ;care, if it exists and other orders are being carried over
"RTN","ORMEVNT2",10,0)
 ;
"RTN","ORMEVNT2",11,0)
 N ORLIST,ORADM,OREASON,ORNATR,X,ORCREATE,ORPRNT,ORSIG,ORI,ORPKG,ORDC,ORDT,ORN
"RTN","ORMEVNT2",12,0)
 S ORLIST=$H
"RTN","ORMEVNT2",13,0)
 S ORADM=$G(VAIP(13,1)) ;Admission date/time for this episode of care
"RTN","ORMEVNT2",14,0)
 D ADMORD^ORMEVNT1 ;See if admission order exists
"RTN","ORMEVNT2",15,0)
 Q:'$D(^TMP("ORR",$J,ORLIST))  ;no order found
"RTN","ORMEVNT2",16,0)
 S OREASON=$P($G(^ORD(100.6,TORY,0)),U,4) I OREASON<1 S OREASON=+$O(^ORD(100.3,"C","ORDIS",0)) ;If no reason assigned to rule, use discharge
"RTN","ORMEVNT2",17,0)
 S ORNATR=+$P($G(^ORD(100.03,+$G(OREASON),0)),U,7) I ORNATR<1 S ORNATR=+$O(^ORD(100.02,"C","A",0)) ;Get nature from reason, if none then use auto-dc
"RTN","ORMEVNT2",18,0)
 S X=$G(^ORD(100.02,ORNATR,1)),ORCREATE=+$P(X,U),ORPRNT=+$P(X,U,2) ;create order action, print?
"RTN","ORMEVNT2",19,0)
 S ORSIG=$S('ORCREATE:"",1:$P(X,U,4)) ;Signature required?
"RTN","ORMEVNT2",20,0)
 S ORI=0 F  S ORI=$O(^ORD(100.6,TORY,7,"B",ORI)) Q:ORI<1  S ORPKG(ORI)=1 ;Identify packages to be auto-dcd for the rule
"RTN","ORMEVNT2",21,0)
 S ORDT=$P($G(DGPMA),U),ORDC=TORY,ORN=""
"RTN","ORMEVNT2",22,0)
 D DC1^ORMEVNT1 ;Code to auto-dc order
"RTN","ORMEVNT2",23,0)
 Q
"RTN","ORMEVNT2",24,0)
 ;
"RTN","ORMEVNT2",25,0)
TIMER ;Start background job to make sure that patient was readmitted
"RTN","ORMEVNT2",26,0)
 ;following the discharge from observation.  Readmission must
"RTN","ORMEVNT2",27,0)
 ;occur within 1 hour
"RTN","ORMEVNT2",28,0)
 N ZTSK,ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSAVE
"RTN","ORMEVNT2",29,0)
 S ZTRTN="TIMERDQ^ORMEVNT2",ZTIO="",ZTDESC="Observation readmit"
"RTN","ORMEVNT2",30,0)
 S ZTDTH=$P($G(^XTMP("ORDCOBS-"_+$G(ORVP),0)),U) ;If inpatient med orders will be reinstated, match timing
"RTN","ORMEVNT2",31,0)
 I ZTDTH="" S ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT,,1) ;One hour from now
"RTN","ORMEVNT2",32,0)
 S ZTSAVE("*")="" ;Save everything for possible use in auto-dcing
"RTN","ORMEVNT2",33,0)
 D ^%ZTLOAD
"RTN","ORMEVNT2",34,0)
 Q
"RTN","ORMEVNT2",35,0)
 ;
"RTN","ORMEVNT2",36,0)
TIMERDQ ;Check if patient readmitted, if not, auto-dc orders that should have auto-dcd on discharge
"RTN","ORMEVNT2",37,0)
 N CVAIP
"RTN","ORMEVNT2",38,0)
 K VAIP("E") S VAIP("V")="CVAIP" D IN5^VADPT ;Is patient an inpatient?
"RTN","ORMEVNT2",39,0)
 I $G(^XTMP("ORDCOBS-"_$G(DFN),"READMIT")) G DEL ;186 If readmit from ASIH OBS hasn't happened then auto-dc orders
"RTN","ORMEVNT2",40,0)
 I CVAIP(13)'="",CVAIP(13)'=VAIP(13) Q  ;Check to see that patient is currently an inpatient and that they are in a different episode of care than the observation episode
"RTN","ORMEVNT2",41,0)
 I +$P($Q(^DGPM("ATID3",DFN)),",",4)'=VAIP(1) Q  ;Stop if there's been another discharge since the discharge from observation.
"RTN","ORMEVNT2",42,0)
DEL K ^XTMP("ORDCOBS-"_$G(DFN)) ;Inpatient meds waiting for reinstatement are no longer needed so XTMP can be deleted
"RTN","ORMEVNT2",43,0)
 D AUTODC^ORMEVNT1(TORY,$P($G(DGPMA),U)) ;Auto-dc orders from observation
"RTN","ORMEVNT2",44,0)
 I '$D(^ORE(100.2,$G(OREVENT),10)),$G(OREVENT) D ACTLOG^OREVNTX(OREVENT,"NW","D",1),DONE^OREVNTX(OREVENT,,DGPMDA) ;186 Log event in 100.2 if not previously done
"RTN","ORMEVNT2",45,0)
 Q
"RTN","ORMEVNT2",46,0)
 ;
"RTN","ORMEVNT2",47,0)
DISCH ; -- Lapse/cancel outstanding events on discharge ;Section moved with 195
"RTN","ORMEVNT2",48,0)
 N X,ADM,EVT,ORP,X0,IFN,STS,X8,ORNOW,J,ORX,ORCH,DAD S ORNOW=+$E($$NOW^XLFDT,1,12) ;195
"RTN","ORMEVNT2",49,0)
 S X=$P(DGPMA,U,18),ADM=$S(X=12!(X=38):"",1:+$G(VAIP(13))),EVT=0
"RTN","ORMEVNT2",50,0)
 F  S EVT=+$O(^ORE(100.2,"AE",+ORVP,EVT)) Q:EVT<1  S ORP=+$O(^(EVT,0)) D
"RTN","ORMEVNT2",51,0)
 . I $G(^ORE(100.2,ORP,1)) K ^ORE(100.2,"AE",+ORVP,EVT,ORP) Q
"RTN","ORMEVNT2",52,0)
 . Q:$$LAPSED^OREVNTX(ORP)  I $$EMPTY^OREVNTX(ORP) D CANCEL^OREVNTX(ORP) Q
"RTN","ORMEVNT2",53,0)
 . I ADM,$P($G(^ORE(100.2,ORP,0)),U,3)'=ADM Q  ;ck adm if not death
"RTN","ORMEVNT2",54,0)
 . S X0=$G(^ORE(100.2,ORP,0)),ORX=ORP ;195
"RTN","ORMEVNT2",55,0)
 . S DAD=0 I $D(^ORE(100.2,"DAD",ORP)) S ORCH=0,DAD=ORP F  S ORCH=$O(^ORE(100.2,"DAD",ORP,ORCH)) Q:'+ORCH  S ORX=ORX_","_ORCH ;195
"RTN","ORMEVNT2",56,0)
 . F J=1:1:$L(ORX,",") S ORP=$P(ORX,",",J) S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",ORVP,ORP,IFN)) Q:IFN<1  D  ;195
"RTN","ORMEVNT2",57,0)
 .. S STS=$P($G(^OR(100,IFN,3)),U,3) I (STS=10)!(IFN=+$P(X0,U,4)) D
"RTN","ORMEVNT2",58,0)
 ... D STATUS^ORCSAVE2(IFN,13) S X8=$G(^OR(100,IFN,8,1,0))
"RTN","ORMEVNT2",59,0)
 ... S:$P(X8,U,15) $P(^OR(100,IFN,8,1,0),U,15)=13
"RTN","ORMEVNT2",60,0)
 ... D:$P(X8,U,4)=2 SIGN^ORCSAVE2(IFN,"","",5,1)
"RTN","ORMEVNT2",61,0)
 ... S ^OR(100,IFN,6)=+$O(^ORD(100.02,"C","A",0))_U_U_ORNOW_U_+$O(^ORD(100.03,"C","ORDIS",0))_U_U_U_U_$G(OREVENT)
"RTN","ORMEVNT2",62,0)
 . S:$G(DAD) ORP=DAD D DONE^OREVNTX(ORP),ACTLOG^OREVNTX(ORP,"CA") ;195
"RTN","ORMEVNT2",63,0)
 Q
"RTN","ORMGMRC")
0^45^B43068026
"RTN","ORMGMRC",1,0)
ORMGMRC ; SLC/MKB - Process Consult ORM msgs ;7/14/04 13:29
"RTN","ORMGMRC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,26,68,92,153,174,195**;Dec 17, 1997
"RTN","ORMGMRC",3,0)
EN ; -- entry point for GMRC messges
"RTN","ORMGMRC",4,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMGMRC",5,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZP",'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMGMRC",6,0)
 S:ORDCNTRL="OC"&(ORTYPE="ORR") ORDCNTRL="UA" ;new code
"RTN","ORMGMRC",7,0)
 N ORSTS,OREASON1,NTE S ORSTS=$$STATUS(ORDSTS)
"RTN","ORMGMRC",8,0)
 S:'ORLOG ORLOG=$$NOW^XLFDT S:'ORDUZ ORDUZ=DUZ S:$G(DGPMT) ORDUZ=""
"RTN","ORMGMRC",9,0)
 S OREASON=$P(OREASON,U,5),NTE=$O(@ORMSG@(+ORC)),OREASON1=""
"RTN","ORMGMRC",10,0)
 I NTE,$E(@ORMSG@(NTE),1,3)="NTE" S OREASON1=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMGMRC",11,0)
 D @ORDCNTRL
"RTN","ORMGMRC",12,0)
 Q
"RTN","ORMGMRC",13,0)
 ;
"RTN","ORMGMRC",14,0)
ZP ; -- Purged
"RTN","ORMGMRC",15,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORMGMRC",16,0)
 K ^OR(100,+ORIFN,4) I "^3^5^6^8^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(+ORIFN,14) ; Remove pkg reference, sts=lapsed if still active
"RTN","ORMGMRC",17,0)
 Q
"RTN","ORMGMRC",18,0)
 ;
"RTN","ORMGMRC",19,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMGMRC",20,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMGMRC",21,0)
 Q
"RTN","ORMGMRC",22,0)
 ;
"RTN","ORMGMRC",23,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMGMRC",24,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; update Last Activity
"RTN","ORMGMRC",25,0)
 Q
"RTN","ORMGMRC",26,0)
 ;
"RTN","ORMGMRC",27,0)
OK ; -- Order accepted, GMRC order # assigned [ack]
"RTN","ORMGMRC",28,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:'$G(ORSTS) ORSTS=5
"RTN","ORMGMRC",29,0)
 D STATUS^ORCSAVE2(+ORIFN,ORSTS) ; 5=pending
"RTN","ORMGMRC",30,0)
 D DATES^ORCSAVE2(+ORIFN,+$E($$NOW^XLFDT,1,12))
"RTN","ORMGMRC",31,0)
 Q
"RTN","ORMGMRC",32,0)
 ;
"RTN","ORMGMRC",33,0)
XX ; -- Change order
"RTN","ORMGMRC",34,0)
 N ORDIALOG,ORDG,ORDA,ORX,ORP,ORSIG S:'$L(ORNATR) ORNATR="S"
"RTN","ORMGMRC",35,0)
 D DLG Q:$D(ORERR)  Q:'$D(ORDIALOG)  S ORIFN=+ORIFN
"RTN","ORMGMRC",36,0)
 S ORDA=$$ACTION^ORCSAVE("XX",ORIFN,ORNP,OREASON1,ORLOG,ORDUZ)
"RTN","ORMGMRC",37,0)
 I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMGMRC",38,0)
 ; -Update sts of order to active, last action to dc/edit:
"RTN","ORMGMRC",39,0)
 S ORX=+$P($G(^OR(100,ORIFN,3)),U,7) S:ORX'>0 ORX=+$O(^(8,ORDA),-1)
"RTN","ORMGMRC",40,0)
 I $D(^OR(100,ORIFN,8,ORX,0)),$P(^(0),U,15)="" S $P(^(0),U,15)=12
"RTN","ORMGMRC",41,0)
 S $P(^OR(100,ORIFN,3),U,7)=ORDA D:$G(ORSTS) STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMGMRC",42,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMGMRC",43,0)
 ; -If unsigned edit, leave XX unsigned & mark ORX as Sig Not Req'd
"RTN","ORMGMRC",44,0)
 S ORSIG=$S($P($G(^OR(100,ORIFN,8,ORX,0)),U,4)'=2:1,1:0)
"RTN","ORMGMRC",45,0)
 D SIGSTS^ORCSAVE2(ORIFN,ORDA):ORSIG,SIGN^ORCSAVE2(ORIFN,,,5,ORX):'ORSIG
"RTN","ORMGMRC",46,0)
 ; -Update responses, get/save new order text:
"RTN","ORMGMRC",47,0)
 K ^OR(100,ORIFN,4.5) D RESPONSE^ORCSAVE,ORDTEXT^ORCSAVE1(ORIFN_";"_ORDA)
"RTN","ORMGMRC",48,0)
 S $P(^OR(100,ORIFN,8,ORDA,0),U,14)=ORDA
"RTN","ORMGMRC",49,0)
 K:OREASON="RESUBMIT" ^OR(100,ORIFN,6) ;clear previous DC data
"RTN","ORMGMRC",50,0)
 I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMGMRC",51,0)
 Q
"RTN","ORMGMRC",52,0)
 ;
"RTN","ORMGMRC",53,0)
SN ; -- New backdoor order: return NA msg w/ORIFN, or DE msg
"RTN","ORMGMRC",54,0)
 N ORDIALOG,ORDG,ORP K ^TMP("ORWORD",$J) S:'$L(ORNATR) ORNATR="W"
"RTN","ORMGMRC",55,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMGMRC",56,0)
 I ORDUZ,'$D(^VA(200,ORDUZ,0)) S ORERR="Invalid entering person" Q
"RTN","ORMGMRC",57,0)
 I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMGMRC",58,0)
 D DLG Q:$D(ORERR)  Q:'$D(ORDIALOG)
"RTN","ORMGMRC",59,0)
SN1 D EN^ORCSAVE K ^TMP("ORWORD",$J) ; setting status, xrefs
"RTN","ORMGMRC",60,0)
 I '$G(ORIFN) S ORERR="Cannot create new order" Q
"RTN","ORMGMRC",61,0)
 ;Save DG1 and ZCL segments of HL7 message from backdoor orders
"RTN","ORMGMRC",62,0)
 D BDOSTR^ORWDBA3
"RTN","ORMGMRC",63,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR),SIGSTS^ORCSAVE2(ORIFN,1)
"RTN","ORMGMRC",64,0)
 S:'ORSTRT ORSTRT=$$NOW^XLFDT D DATES^ORCSAVE2(+ORIFN,ORSTRT)
"RTN","ORMGMRC",65,0)
 D:$G(ORSTS) STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMGMRC",66,0)
 I $G(ORL) S ORP(1)=ORIFN_";1^1" D PRINTS^ORWD1(.ORP,+ORL) ; chart copy
"RTN","ORMGMRC",67,0)
 S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMGMRC",68,0)
 Q
"RTN","ORMGMRC",69,0)
 ;
"RTN","ORMGMRC",70,0)
DLG ; -- Build ORDIALOG(),ORDG from msg
"RTN","ORMGMRC",71,0)
 N OBR,USID,TYPE,OI,ZSV,J,OBX,WP,I
"RTN","ORMGMRC",72,0)
 S OBR=$$OBR I 'OBR!($E($G(@ORMSG@(OBR)),1,3)'="OBR") S ORERR="Missing OBR segment" Q
"RTN","ORMGMRC",73,0)
 S USID=$P(@ORMSG@(OBR),"|",5),TYPE=$S(USID["99CON":"CONSULT",1:"REQUEST")
"RTN","ORMGMRC",74,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","GMRCOR "_TYPE,0))
"RTN","ORMGMRC",75,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMGMRC",76,0)
 S ORDIALOG($$PTR("URGENCY"),1)=ORURG
"RTN","ORMGMRC",77,0)
 S OI=$$ORDITEM^ORM(USID) I 'OI S ORERR="Invalid consult or procedure" Q
"RTN","ORMGMRC",78,0)
 S ORDIALOG($$PTR("ORDERABLE ITEM"),1)=OI
"RTN","ORMGMRC",79,0)
 S ZSV=$O(@ORMSG@(OBR)) I ZSV,$E(@ORMSG@(ZSV),1,3)="ZSV" D
"RTN","ORMGMRC",80,0)
 . N X1,X2 S X1=$P(@ORMSG@(ZSV),"|",2),X2=$P(@ORMSG@(ZSV),"|",3)
"RTN","ORMGMRC",81,0)
 . I TYPE="REQUEST" S ORDIALOG($$PTR("REQUEST SERVICE"),1)=+$P(X1,U,4)
"RTN","ORMGMRC",82,0)
 . I TYPE="CONSULT",$L(X2) S ORDIALOG($$PTR("FREE TEXT OI"),1)=X2
"RTN","ORMGMRC",83,0)
D1 S ORDIALOG($$PTR("CATEGORY"),1)=$G(ORCAT)
"RTN","ORMGMRC",84,0)
 S J=$P(@ORMSG@(OBR),"|",19),ORDIALOG($$PTR("PLACE OF CONSULTATION"),1)=$S(J="OC":"C",1:J)
"RTN","ORMGMRC",85,0)
 S ORDIALOG($$PTR("PROVIDER"),1)=$P(@ORMSG@(OBR),"|",20)
"RTN","ORMGMRC",86,0)
 S OBX=OBR F  S OBX=$O(@ORMSG@(OBX)) Q:OBX'>0  S J=$E(@ORMSG@(OBX),1,3) Q:J="ORC"  Q:J="MSH"  I J="OBX" D
"RTN","ORMGMRC",87,0)
 . N SEG,NAME,VALUE S SEG=@ORMSG@(OBX)
"RTN","ORMGMRC",88,0)
 . S NAME=$$UP^XLFSTR($P($P(SEG,"|",4),U,2)),VALUE=$P(SEG,"|",6)
"RTN","ORMGMRC",89,0)
 . I NAME="PROVISIONAL DIAGNOSIS" D  Q
"RTN","ORMGMRC",90,0)
 .. S:$P(SEG,"|",3)="CE" ORDIALOG($$PTR("CODE"),1)=$P(VALUE,U),VALUE=$P(VALUE,U,2)
"RTN","ORMGMRC",91,0)
 .. S ORDIALOG($$PTR("FREE TEXT"),1)=VALUE
"RTN","ORMGMRC",92,0)
 . S WP=$$PTR("WORD PROCESSING 1"),I=1,^TMP("ORWORD",$J,WP,1,I,0)=VALUE
"RTN","ORMGMRC",93,0)
 . S J=0 F  S J=$O(@ORMSG@(OBX,J)) Q:J'>0  S I=I+1,^TMP("ORWORD",$J,WP,1,I,0)=@ORMSG@(OBX,J)
"RTN","ORMGMRC",94,0)
 S:$G(I) ^TMP("ORWORD",$J,WP,1,0)="^^"_I_U_I_U_DT_U,ORDIALOG(WP,1)="^TMP(""ORWORD"",$J,"_WP_",1)"
"RTN","ORMGMRC",95,0)
 Q
"RTN","ORMGMRC",96,0)
 ;
"RTN","ORMGMRC",97,0)
OBR() ; -- Return subscript of RXE segment
"RTN","ORMGMRC",98,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMGMRC",99,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="OBR" S X=I Q
"RTN","ORMGMRC",100,0)
 Q X
"RTN","ORMGMRC",101,0)
 ;
"RTN","ORMGMRC",102,0)
SC ; -- Status changed (i.e. scheduled)
"RTN","ORMGMRC",103,0)
 S:'$G(ORSTS) ORSTS=6 D STATUS^ORCSAVE2(+ORIFN,ORSTS) ; 6=active
"RTN","ORMGMRC",104,0)
 Q
"RTN","ORMGMRC",105,0)
 ;
"RTN","ORMGMRC",106,0)
STATUS(X) ; -- Returns ptr to Order Status file #100.01
"RTN","ORMGMRC",107,0)
 Q $S(X="DC":1,X="CM":2,X="HD":3,X="IP":5,X="SC":6,X="A":9,X="RP":12,X="CA":13,X="ZC":8,1:5)
"RTN","ORMGMRC",108,0)
 ;
"RTN","ORMGMRC",109,0)
RE ; -- Completed, w/results
"RTN","ORMGMRC",110,0)
 N I,SEG,DA,DR,DIE,X,Y
"RTN","ORMGMRC",111,0)
 S:'$G(ORSTS) ORSTS=2 D STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMGMRC",112,0)
 S X="",DA=+ORIFN,DIE="^OR(100,"
"RTN","ORMGMRC",113,0)
 S DR="71////"_+$E($$NOW^XLFDT,1,12) D ^DIE
"RTN","ORMGMRC",114,0)
 S I=+ORC,X="" F  S I=$O(@ORMSG@(I)) Q:I<1  S SEG=$G(@ORMSG@(I)) Q:$E(SEG,1,3)="ORC"  I $E(SEG,1,3)="OBX",$P(SEG,"|",4)["SIG FINDINGS" S X=$P(SEG,"|",6) Q
"RTN","ORMGMRC",115,0)
 S $P(^OR(100,DA,7),U,2)=$S(X="Y":1,1:"")
"RTN","ORMGMRC",116,0)
 S:'$G(ORNP) ORNP=+$P($G(^OR(100,+ORIFN,0)),U,4)
"RTN","ORMGMRC",117,0)
 I $P(ORC,"|",17)["MAINTENANCE" Q  ;group update - no CM ack needed
"RTN","ORMGMRC",118,0)
 I $L($T(ADD^ORRCACK)) D ADD^ORRCACK(+ORIFN,ORNP) ;Ack stub for prov
"RTN","ORMGMRC",119,0)
 Q
"RTN","ORMGMRC",120,0)
 ;
"RTN","ORMGMRC",121,0)
UA ; -- Unable to Accept [ack]
"RTN","ORMGMRC",122,0)
 S ORDUZ="" I '$L(OREASON1),$L(OREASON) S OREASON1=OREASON
"RTN","ORMGMRC",123,0)
OC ; -- Cancelled/Denied
"RTN","ORMGMRC",124,0)
 S:'$L(ORNATR) ORNATR="X" ;Rejected
"RTN","ORMGMRC",125,0)
 S ^OR(100,+ORIFN,6)=$O(^ORD(100.02,"C",ORNATR,0))_U_ORDUZ_U_ORLOG_U_U_OREASON1
"RTN","ORMGMRC",126,0)
 D STATUS^ORCSAVE2(+ORIFN,13) I ORDCNTRL="OC" D UPDATE("DC") Q
"RTN","ORMGMRC",127,0)
UD ; -- Unable to discontinue [ack]
"RTN","ORMGMRC",128,0)
 N DA S DA=$P(ORIFN,";",2) I DA D
"RTN","ORMGMRC",129,0)
 . S $P(^OR(100,+ORIFN,8,DA,0),U,15)=13 ;request rejected
"RTN","ORMGMRC",130,0)
 . S:$L(OREASON1) ^OR(100,+ORIFN,8,DA,1)=OREASON1
"RTN","ORMGMRC",131,0)
 Q
"RTN","ORMGMRC",132,0)
 ;
"RTN","ORMGMRC",133,0)
OD ; -- Discontinued
"RTN","ORMGMRC",134,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORDUZ_U_ORLOG_U_U_OREASON1
"RTN","ORMGMRC",135,0)
 D STATUS^ORCSAVE2(+ORIFN,1),UPDATE("DC"):$L(ORNATR)
"RTN","ORMGMRC",136,0)
 Q
"RTN","ORMGMRC",137,0)
 ;
"RTN","ORMGMRC",138,0)
DR ; -- Discontinued [ack]
"RTN","ORMGMRC",139,0)
 D STATUS^ORCSAVE2(+ORIFN,1)
"RTN","ORMGMRC",140,0)
 Q
"RTN","ORMGMRC",141,0)
 ;
"RTN","ORMGMRC",142,0)
UPDATE(ORACT) ; -- continue processing
"RTN","ORMGMRC",143,0)
 N ORX,ORDA,ORP
"RTN","ORMGMRC",144,0)
 S ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMGMRC",145,0)
 . S ORDA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,OREASON1,ORLOG,ORDUZ)
"RTN","ORMGMRC",146,0)
 . I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMGMRC",147,0)
 . D RELEASE^ORCSAVE2(+ORIFN,ORDA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMGMRC",148,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,ORDA)
"RTN","ORMGMRC",149,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMGMRC",150,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=ORDA
"RTN","ORMGMRC",151,0)
 I 'ORX,ORACT="DC",'$$ACTV^ORX1(ORNATR) S $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMGMRC",152,0)
 D:$G(ORACT)="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMGMRC",153,0)
 Q
"RTN","ORMGMRC",154,0)
 ;
"RTN","ORMGMRC",155,0)
PTR(X) ; -- Returns ptr to prompt in Order Dialog file #101.41
"RTN","ORMGMRC",156,0)
 Q $O(^ORD(101.41,"AB",$E("OR GTX "_X,1,63),0))
"RTN","ORMLR")
0^46^B55183610
"RTN","ORMLR",1,0)
ORMLR ; SLC/MKB - Process Lab ORM msgs ;11:59 AM  26 Jul 2000
"RTN","ORMLR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,92,153,174,195**;Dec 17, 1997
"RTN","ORMLR",3,0)
EN ; -- entry point for LR messages
"RTN","ORMLR",4,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMLR",5,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZC",ORDCNTRL'="ZP" D  Q:$L($G(ORERR))
"RTN","ORMLR",6,0)
 . I 'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMLR",7,0)
 . S ORDUZ=DUZ,ORLOG=+$E($$NOW^XLFDT,1,12)
"RTN","ORMLR",8,0)
 S OREASON=$$REASON I 'ORNATR,OREASON S ORNATR=+$P($G(^ORD(100.03,+OREASON,0)),U,7)
"RTN","ORMLR",9,0)
 D @ORDCNTRL
"RTN","ORMLR",10,0)
 Q
"RTN","ORMLR",11,0)
 ;
"RTN","ORMLR",12,0)
STATUS(X) ; -- Returns Order Status for HL7 code X
"RTN","ORMLR",13,0)
 N Y S Y=$S(X="DC":1,X="CM":2,X="IP":5,X="SC":6,X="ZS":9,X="CA":13,1:"")
"RTN","ORMLR",14,0)
 Q Y
"RTN","ORMLR",15,0)
 ;
"RTN","ORMLR",16,0)
OK ; -- Order accepted, LR order # assigned [ack]
"RTN","ORMLR",17,0)
 S ^OR(100,+ORIFN,4)=PKGIFN ; LR identifier
"RTN","ORMLR",18,0)
 D STATUS^ORCSAVE2(+ORIFN,5) ; pending
"RTN","ORMLR",19,0)
 Q
"RTN","ORMLR",20,0)
 ;
"RTN","ORMLR",21,0)
ZC ; -- Convert existing 2.5 orders to 3.0 format
"RTN","ORMLR",22,0)
 S ORNATR="" I 'ORIFN!('$D(^OR(100,+ORIFN,0))) D  Q  ;create
"RTN","ORMLR",23,0)
 . K ORIFN D SN Q:'$G(ORIFN)  S ORDCNTRL="SN"
"RTN","ORMLR",24,0)
 . I ORSTOP,ORSTOP<$$NOW^XLFDT S $P(^OR(100,+ORIFN,3),U)=ORSTOP
"RTN","ORMLR",25,0)
 N ORDIALOG,I,X,OBR,NTE S ORIFN=+ORIFN
"RTN","ORMLR",26,0)
 S I=+ORC F  S I=$O(@ORMSG@(I)) Q:'I  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  Q:SEG="MSH"  I SEG="OBR" S OBR=I Q
"RTN","ORMLR",27,0)
 I '$G(OBR) S ORERR="Missing OBR segment" Q
"RTN","ORMLR",28,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","LR OTHER LAB TESTS",0))
"RTN","ORMLR",29,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMLR",30,0)
 S X=$$FIND^ORM(OBR,5),X=$$ORDITEM^ORM(X) I 'X S ORERR="Invalid test" Q
"RTN","ORMLR",31,0)
 S ORDIALOG($$PTR("ORDERABLE ITEM"),1)=X,X=$$FIND^ORM(OBR,16)
"RTN","ORMLR",32,0)
 S ORDIALOG($$PTR("COLLECTION SAMPLE"),1)=$P(X,";",4)
"RTN","ORMLR",33,0)
 S ORDIALOG($$PTR("SPECIMEN"),1)=$S($L($P(X,";")):+$O(^LAB(61,"C",$P(X,";"),0)),1:+$P(X,U,4))
"RTN","ORMLR",34,0)
 S X=$$FIND^ORM(OBR,28),ORDIALOG($$PTR("LAB URGENCY"),1)=+$P($P(X,U,6),";",2)
"RTN","ORMLR",35,0)
 S X=$$FIND^ORM(OBR,12),ORDIALOG($$PTR("COLLECTION TYPE"),1)=$S(X="L":"LC",X="O":"WC",X=2:"I",1:"SP")
"RTN","ORMLR",36,0)
ZC1 S NTE=$O(@ORMSG@(OBR)) I NTE,$E(@ORMSG@(NTE),1,3)="NTE" D
"RTN","ORMLR",37,0)
 . N LCNT,WP S WP=$$PTR("WORD PROCESSING 1") K ^TMP("ORWORD",$J)
"RTN","ORMLR",38,0)
 . S LCNT=1,^TMP("ORWORD",$J,WP,1,LCNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMLR",39,0)
 . S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORWORD",$J,WP,1,LCNT,0)=@ORMSG@(NTE,I)
"RTN","ORMLR",40,0)
 . S ^TMP("ORWORD",$J,WP,1,0)="^^"_LCNT_U_LCNT_U_DT_U
"RTN","ORMLR",41,0)
 . S ORDIALOG(WP,1)="^TMP(""ORWORD"","_$J_","_WP_",1)"
"RTN","ORMLR",42,0)
 S ORDIALOG($$PTR("START DATE/TIME"),1)=ORSTRT
"RTN","ORMLR",43,0)
 S ^OR(100,ORIFN,4)=PKGIFN,$P(^(0),U,5)=+ORDIALOG_";ORD(101.41,"
"RTN","ORMLR",44,0)
 D RESPONSE^ORCSAVE ; save ORDIALOG() into ^(4.5)
"RTN","ORMLR",45,0)
 K ^TMP("ORWORD",$J)
"RTN","ORMLR",46,0)
 Q
"RTN","ORMLR",47,0)
 ;
"RTN","ORMLR",48,0)
SN ; -- New backdoor order: return NA msg w/ORIFN, or DE msg
"RTN","ORMLR",49,0)
 N X,ORDIALOG,ORDG,OBR,NTE,CMMT,OI,LCNT,I,ORSTS,LRSUB,ORNEW,ORP
"RTN","ORMLR",50,0)
 I ORDUZ,'$D(^VA(200,+ORDUZ,0)) S ORERR="Invalid entering person" Q
"RTN","ORMLR",51,0)
 ; I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMLR",52,0)
 S LRSUB=$E($P($P(@ORMSG@(+ORC),"|",4),U,2),3,4),ORDG=$$DGRP(LRSUB)
"RTN","ORMLR",53,0)
 S ORDIALOG="LR OTHER LAB TESTS" ; $S(LRSUB="AP",LRSUB="BB")
"RTN","ORMLR",54,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",ORDIALOG,0)) D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMLR",55,0)
 S ORDIALOG($$PTR("START DATE/TIME"),1)=ORSTRT
"RTN","ORMLR",56,0)
 S CMMT=$$PTR("WORD PROCESSING 1") K ^TMP("ORWORD",$J)
"RTN","ORMLR",57,0)
SN1 S OBR=$O(@ORMSG@(+ORC)) I 'OBR!($E($G(@ORMSG@(OBR)),1,3)'="OBR") S ORERR="Missing OBR segment" Q
"RTN","ORMLR",58,0)
 S X=$$FIND^ORM(OBR,5),OI=$$ORDITEM^ORM(X) I 'OI S ORERR="Invalid test" Q
"RTN","ORMLR",59,0)
 S ORDIALOG($$PTR("ORDERABLE ITEM"),1)=OI
"RTN","ORMLR",60,0)
 I LRSUB="BB" S ORDIALOG($$PTR("QUANTITY"),1)=+ORQT G SN2
"RTN","ORMLR",61,0)
 S X=$$FIND^ORM(OBR,16),ORDIALOG($$PTR("COLLECTION SAMPLE"),1)=$P(X,";",4)
"RTN","ORMLR",62,0)
 S ORDIALOG($$PTR("SPECIMEN"),1)=$S($L($P(X,";")):$O(^LAB(61,"C",$P(X,";"),0)),1:+$P(X,U,4))
"RTN","ORMLR",63,0)
 S X=+$P($P($$FIND^ORM(OBR,28),U,6),";",2),ORDIALOG($$PTR("LAB URGENCY"),1)=$S(X:X,1:9)
"RTN","ORMLR",64,0)
 S X=$$FIND^ORM(OBR,12),ORDIALOG($$PTR("COLLECTION TYPE"),1)=$S(X="L":"LC",X="O":"WC",X=2:"I",1:"SP")
"RTN","ORMLR",65,0)
SN2 S NTE=$O(@ORMSG@(+OBR)) I NTE,$E(@ORMSG@(NTE),1,3)="NTE" D
"RTN","ORMLR",66,0)
 . S LCNT=1,^TMP("ORWORD",$J,CMMT,1,LCNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMLR",67,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORWORD",$J,CMMT,1,LCNT,0)=@ORMSG@(NTE,I)
"RTN","ORMLR",68,0)
 . S ^TMP("ORWORD",$J,CMMT,1,0)="^^"_LCNT_U_LCNT_U_DT_U,ORDIALOG(CMMT,1)="^TMP(""ORWORD"",$J,"_CMMT_",1)"
"RTN","ORMLR",69,0)
SNQ D EN^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMLR",70,0)
 I '$G(ORIFN) S ORERR="Cannot create new order" Q
"RTN","ORMLR",71,0)
 ;Save DG1 and ZCL segments of HL7 message from backdoor orders
"RTN","ORMLR",72,0)
 D BDOSTR^ORWDBA3
"RTN","ORMLR",73,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR),SIGSTS^ORCSAVE2(ORIFN,1)
"RTN","ORMLR",74,0)
 D:ORSTOP DATES^ORCSAVE2(ORIFN,,ORSTOP) ;Start date in order itself
"RTN","ORMLR",75,0)
 S ORSTS=$$STATUS(ORDSTS) D:ORSTS STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMLR",76,0)
 I ORDCNTRL="SN",$G(ORL) S ORP(1)=ORIFN_";1^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMLR",77,0)
 S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMLR",78,0)
 Q
"RTN","ORMLR",79,0)
 ;
"RTN","ORMLR",80,0)
PTR(NAME) ; -- Returns ien of prompt NAME in Order Dialog file #101.41
"RTN","ORMLR",81,0)
 Q $O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMLR",82,0)
 ;
"RTN","ORMLR",83,0)
DGRP(DG) ; -- Returns Display Group ptr based on Lab section
"RTN","ORMLR",84,0)
 N Y S:'$L($G(DG)) DG="CH" S Y=$O(^ORD(100.98,"B",DG,0))
"RTN","ORMLR",85,0)
 S:'Y Y=$O(^ORD(100.98,"B","LAB",0))
"RTN","ORMLR",86,0)
 Q Y
"RTN","ORMLR",87,0)
 ;
"RTN","ORMLR",88,0)
XX ; -- Changed: NOT IN USE
"RTN","ORMLR",89,0)
 D XX^ORMLR1
"RTN","ORMLR",90,0)
 Q
"RTN","ORMLR",91,0)
 ;
"RTN","ORMLR",92,0)
XR ; -- Changed [ack]: NOT IN USE
"RTN","ORMLR",93,0)
 N ORIG
"RTN","ORMLR",94,0)
 S ^OR(100,+ORIFN,4)=PKGIFN,ORIG=$P(^(3),U,5)
"RTN","ORMLR",95,0)
 D:ORIG STATUS^ORCSAVE2(ORIG,12)
"RTN","ORMLR",96,0)
 D STATUS^ORCSAVE2(+ORIFN,5) ; pending
"RTN","ORMLR",97,0)
 Q
"RTN","ORMLR",98,0)
 ;
"RTN","ORMLR",99,0)
ZP ; -- Purged
"RTN","ORMLR",100,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORMLR",101,0)
 S $P(^OR(100,+ORIFN,4),";",1,3)=";;" I "^5^6^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(+ORIFN,$S($P(^(4),";",5):2,1:14)) ; Remove pkg reference, sts=lapsed if still active
"RTN","ORMLR",102,0)
 Q
"RTN","ORMLR",103,0)
 ;
"RTN","ORMLR",104,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMLR",105,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMLR",106,0)
 Q
"RTN","ORMLR",107,0)
 ;
"RTN","ORMLR",108,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMLR",109,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; update Last Activity
"RTN","ORMLR",110,0)
 Q
"RTN","ORMLR",111,0)
 ;
"RTN","ORMLR",112,0)
SC ; -- Status changed (collected)
"RTN","ORMLR",113,0)
 N ORSTS D DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMLR",114,0)
 S ORSTS=$$STATUS(ORDSTS) D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMLR",115,0)
 S:$L($P(OREASON,U,2)) ^OR(100,+ORIFN,8,1,1)=$P(OREASON,U,2)
"RTN","ORMLR",116,0)
 Q
"RTN","ORMLR",117,0)
 ;
"RTN","ORMLR",118,0)
RE ; -- Completed, w/results
"RTN","ORMLR",119,0)
 N ORSTS,ORX,I,SEG,DONE,X,Y,ORABN,ORFIND,LRSA,LRSB
"RTN","ORMLR",120,0)
 S ORSTS=$$STATUS(ORDSTS) D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMLR",121,0)
 S ^OR(100,+ORIFN,4)=PKGIFN,ORX="" D  ;get Results D/T [from OBR]
"RTN","ORMLR",122,0)
 . N OBR S OBR=+$O(@ORMSG@(+ORC)),X=""
"RTN","ORMLR",123,0)
 . I OBR,$E($G(@ORMSG@(OBR)),1,3)="OBR" S X=$P(@ORMSG@(OBR),"|",23)
"RTN","ORMLR",124,0)
 . S X=$S(X:$$FMDATE^ORM(X),1:+$E($$NOW^XLFDT,1,12))
"RTN","ORMLR",125,0)
 . S $P(^OR(100,+ORIFN,7),U)=X,^OR(100,"ARS",ORVP,9999999-X,+ORIFN)=""
"RTN","ORMLR",126,0)
 D RR^LR7OR1(DFN,PKGIFN)
"RTN","ORMLR",127,0)
 S ORABN="",ORFIND=""
"RTN","ORMLR",128,0)
 I $D(^TMP("LRRR",$J)) D
"RTN","ORMLR",129,0)
 . N IDT,DNAM,ORSLT
"RTN","ORMLR",130,0)
 . S IDT=0 F  S IDT=$O(^TMP("LRRR",$J,DFN,"CH",IDT)) Q:'IDT  D
"RTN","ORMLR",131,0)
 .. S DNAM=0 F  S DNAM=$O(^TMP("LRRR",$J,DFN,"CH",IDT,DNAM)) Q:'DNAM  D
"RTN","ORMLR",132,0)
 ... S ORSLT=$G(^TMP("LRRR",$J,DFN,"CH",IDT,DNAM))
"RTN","ORMLR",133,0)
 ... I '$L($P(ORSLT,U,3)) Q
"RTN","ORMLR",134,0)
 ... S ORABN=1,ORFIND=$S($L(ORFIND):(ORFIND_", "),1:"")
"RTN","ORMLR",135,0)
 ... S ORFIND=ORFIND_$P(ORSLT,U,15)_"="_$P(ORSLT,U,2)
"RTN","ORMLR",136,0)
 . Q
"RTN","ORMLR",137,0)
 K ^TMP("LRRR",$J),^TMP("LRX",$J)
"RTN","ORMLR",138,0)
 S $P(^OR(100,+ORIFN,7),U,2,3)=ORABN_U_ORFIND
"RTN","ORMLR",139,0)
 S:'$G(ORNP) ORNP=+$P($G(^OR(100,+ORIFN,0)),U,4)
"RTN","ORMLR",140,0)
 I $L($T(ADD^ORRCACK)) D ADD^ORRCACK(+ORIFN,ORNP) ;Ack stub for prov
"RTN","ORMLR",141,0)
 Q
"RTN","ORMLR",142,0)
 ;
"RTN","ORMLR",143,0)
OC ; -- Cancelled
"RTN","ORMLR",144,0)
 G:ORTYPE="ORR" UA S:ORNATR=+$O(^ORD(100.02,"C","A",0)) ORDUZ=""
"RTN","ORMLR",145,0)
 S ^OR(100,+ORIFN,6)=ORNATR_U_ORDUZ_U_ORLOG_U_$P(OREASON,U)_U_$E($P(OREASON,U,2),1,80)
"RTN","ORMLR",146,0)
 D UPDATE(1,"DC")
"RTN","ORMLR",147,0)
 Q
"RTN","ORMLR",148,0)
 ;
"RTN","ORMLR",149,0)
CR ; -- Cancelled [ack]
"RTN","ORMLR",150,0)
 D STATUS^ORCSAVE2(+ORIFN,1)
"RTN","ORMLR",151,0)
 Q
"RTN","ORMLR",152,0)
 ;
"RTN","ORMLR",153,0)
UA ; -- Unable to accept [ack]
"RTN","ORMLR",154,0)
UX ; -- Unable to change [ack]: NOT IN USE
"RTN","ORMLR",155,0)
 S:'ORNATR ORNATR=$O(^ORD(100.02,"C","X",0)) ;rejected
"RTN","ORMLR",156,0)
 S ^OR(100,+ORIFN,6)=ORNATR_U_U_ORLOG_U_$P(OREASON,U)_U_$E($P(OREASON,U,2),1,80)
"RTN","ORMLR",157,0)
 D STATUS^ORCSAVE2(+ORIFN,13)
"RTN","ORMLR",158,0)
UC ; -- Unable to cancel [ack]
"RTN","ORMLR",159,0)
DE ; -- Data Error [ack]
"RTN","ORMLR",160,0)
 N DA S DA=$P(ORIFN,";",2) Q:'DA
"RTN","ORMLR",161,0)
 S $P(^OR(100,+ORIFN,8,DA,0),U,15)=13 ;request rejected
"RTN","ORMLR",162,0)
 S:$L($P(OREASON,U,2)) ^OR(100,+ORIFN,8,DA,1)=$E($P(OREASON,U,2),1,240)
"RTN","ORMLR",163,0)
 Q
"RTN","ORMLR",164,0)
 ;
"RTN","ORMLR",165,0)
UPDATE(ORSTS,ORACT) ; -- continue processing
"RTN","ORMLR",166,0)
 N DA,ORX,ORCMMT,ORP
"RTN","ORMLR",167,0)
 D DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMLR",168,0)
 D:$G(ORSTS) STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMLR",169,0)
 S ORCMMT=$E($P(OREASON,U,2),1,240),ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMLR",170,0)
 . S DA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,ORCMMT,ORLOG,ORDUZ)
"RTN","ORMLR",171,0)
 . I DA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMLR",172,0)
 . D RELEASE^ORCSAVE2(+ORIFN,DA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMLR",173,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,DA)
"RTN","ORMLR",174,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_DA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMLR",175,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=DA
"RTN","ORMLR",176,0)
 I 'ORX,'$$ACTV^ORX1(ORNATR) S $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMLR",177,0)
 D:ORACT="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMLR",178,0)
 Q
"RTN","ORMLR",179,0)
 ;
"RTN","ORMLR",180,0)
REASON() ; -- Get reason from OREASON or NTE segments
"RTN","ORMLR",181,0)
 N NTE,CMMT,X,Y,I,L
"RTN","ORMLR",182,0)
 S NTE=+$O(@ORMSG@(+ORC)),CMMT=$P(OREASON,U,4,5)
"RTN","ORMLR",183,0)
 G:'NTE RQ G:$E(@ORMSG@(NTE),1,3)'="NTE" RQ ; no add'l comments
"RTN","ORMLR",184,0)
 S Y=$P(@ORMSG@(NTE),"|",4),I=0
"RTN","ORMLR",185,0)
 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S X=$G(@ORMSG@(NTE,I)),L=$L(Y)+1+$L(X) S:L'>240 Y=Y_" "_X I L>240 S Y=Y_" "_$E(X,1,239-$L(Y)) Q
"RTN","ORMLR",186,0)
 S $P(CMMT,U,2)=Y
"RTN","ORMLR",187,0)
RQ Q CMMT
"RTN","ORMPS")
0^47^B75068050
"RTN","ORMPS",1,0)
ORMPS ; SLC/MKB - Process Pharmacy ORM msgs ;12/3/03  10:32
"RTN","ORMPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,54,62,86,92,94,116,138,152,141,165,149,213,195**;Dec 17, 1997
"RTN","ORMPS",3,0)
 ;
"RTN","ORMPS",4,0)
EN ; -- entry point
"RTN","ORMPS",5,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMPS",6,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZC",ORDCNTRL'="ZP",'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMPS",7,0)
 N ORSTS,RXE,ZRX,ORWHO,ORNOW
"RTN","ORMPS",8,0)
 S ORSTS=$$STATUS(ORDSTS),RXE=$$RXE,ZRX=$$ZRX D QT^ORMPS1 ;QT in RXE
"RTN","ORMPS",9,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORWHO=+$P(ZRX,"|",6) S:'ORWHO ORWHO=DUZ
"RTN","ORMPS",10,0)
 S:ORLOG ORLOG=+$E(ORLOG,1,12) ;no seconds
"RTN","ORMPS",11,0)
 S:'$L(ORNATR) ORNATR=$P(ZRX,"|",3) S:OREASON["^" OREASON=$P(OREASON,U,5)
"RTN","ORMPS",12,0)
 I ORNATR="D",'$L(OREASON) S OREASON="DUPLICATE"
"RTN","ORMPS",13,0)
 D @ORDCNTRL
"RTN","ORMPS",14,0)
 Q
"RTN","ORMPS",15,0)
 ;
"RTN","ORMPS",16,0)
ZV ; -- Verified
"RTN","ORMPS",17,0)
 N ORUSR,ORVER,ORDA,ORES,ORI
"RTN","ORMPS",18,0)
 S ORUSR=+$P(ORC,"|",12),ORVER="N" Q:'ORUSR
"RTN","ORMPS",19,0)
 S ORDA=+$P($G(^OR(100,+ORIFN,3)),U,7),ORES(+ORIFN_";"_ORDA)=""
"RTN","ORMPS",20,0)
 Q:$P($G(^OR(100,+ORIFN,8,ORDA,0)),U,8)  ;already verified
"RTN","ORMPS",21,0)
 D REPLCD^ORCACT1 ;get unverified replaced orders
"RTN","ORMPS",22,0)
 S ORI="" F  S ORI=$O(ORES(ORI)) Q:ORI=""  D
"RTN","ORMPS",23,0)
 . S ORDA=+$P(ORI,";",2)
"RTN","ORMPS",24,0)
 . D VERIFY^ORCSAVE2(+ORI,ORDA,"N",ORUSR,ORLOG)
"RTN","ORMPS",25,0)
 Q
"RTN","ORMPS",26,0)
 ;
"RTN","ORMPS",27,0)
ZP ; -- Purged
"RTN","ORMPS",28,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORMPS",29,0)
 K ^OR(100,+ORIFN,4) I "^3^5^6^15^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(+ORIFN,14) ;Remove pkg reference, sts=lapsed if still active
"RTN","ORMPS",30,0)
 Q
"RTN","ORMPS",31,0)
 ;
"RTN","ORMPS",32,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMPS",33,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMPS",34,0)
 Q
"RTN","ORMPS",35,0)
 ;
"RTN","ORMPS",36,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMPS",37,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ;update Last Activity
"RTN","ORMPS",38,0)
 Q
"RTN","ORMPS",39,0)
 ;
"RTN","ORMPS",40,0)
XR ; -- Changed as requested [ack]
"RTN","ORMPS",41,0)
 N ORIG S ORIG=$P(^OR(100,+ORIFN,3),U,5) I ORIG,$P(^OR(100,ORIG,3),U,3)'=12 D STATUS^ORCSAVE2(ORIG,12)
"RTN","ORMPS",42,0)
OK ; -- Order accepted, PS order # assigned [ack]
"RTN","ORMPS",43,0)
 S ^OR(100,+ORIFN,4)=PKGIFN ;PS identifier
"RTN","ORMPS",44,0)
 D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",45,0)
 Q
"RTN","ORMPS",46,0)
 ;
"RTN","ORMPS",47,0)
ZC ; -- convert orders
"RTN","ORMPS",48,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORP,ORSIG,ORIG,TYPE,EVNT
"RTN","ORMPS",49,0)
 I '$D(^VA(200,ORDUZ,0)) S ORERR="Missing or invalid entering person" Q
"RTN","ORMPS",50,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS",51,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS",52,0)
 S RXO=$$RXO,RXC=$$RXC K ^TMP("ORWORD",$J)
"RTN","ORMPS",53,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1")
"RTN","ORMPS",54,0)
ZC1 ; continue
"RTN","ORMPS",55,0)
 Q:$D(ORERR)  I 'ORIFN!('$D(^OR(100,+ORIFN,0))) D  Q  ;create
"RTN","ORMPS",56,0)
 . K ORIFN D SN1 Q:'$G(ORIFN)  S ORDCNTRL="SN"
"RTN","ORMPS",57,0)
 . I ORSTOP,ORSTOP<ORNOW S $P(^OR(100,ORIFN,3),U)=ORSTOP
"RTN","ORMPS",58,0)
 S ORIFN=+ORIFN D RESPONSE^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMPS",59,0)
 S ^OR(100,ORIFN,4)=PKGIFN,$P(^(0),U,5)=+ORDIALOG_";ORD(101.41,"
"RTN","ORMPS",60,0)
 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP),STATUS^ORCSAVE2(ORIFN,ORSTS):ORSTS
"RTN","ORMPS",61,0)
 Q
"RTN","ORMPS",62,0)
 ;
"RTN","ORMPS",63,0)
SN ; -- New backdoor order, return OE# via NA msg
"RTN","ORMPS",64,0)
 I $$FINISHED^ORMPS2 D RO^ORMPS2 Q  ;change action instead
"RTN","ORMPS",65,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORP,ORSIG,ORIG,TYPE,EVNT,ZSC
"RTN","ORMPS",66,0)
 I '$D(^VA(200,ORDUZ,0)) S ORERR="Missing or invalid entering person" Q
"RTN","ORMPS",67,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS",68,0)
 ; I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMPS",69,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS",70,0)
 S RXO=$$RXO,RXC=$$RXC K ^TMP("ORWORD",$J),ORIFN
"RTN","ORMPS",71,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1") Q:$D(ORERR)
"RTN","ORMPS",72,0)
SN1 ; save order
"RTN","ORMPS",73,0)
 D EN^ORCSAVE I '$G(ORIFN) S ORERR="Cannot create new order" G SNQ
"RTN","ORMPS",74,0)
 D BDOSTR^ORWDBA3 ;DG1 & ZCL data
"RTN","ORMPS",75,0)
 S ORIG=+$P(ZRX,"|",2),TYPE=$P(ZRX,"|",4) I ORIG D  ;set fwd/bwd ptrs
"RTN","ORMPS",76,0)
 . S TYPE=$S(TYPE="R":2,1:1) Q:'$D(^OR(100,ORIG,0))
"RTN","ORMPS",77,0)
 . S $P(^OR(100,ORIFN,3),U,5)=ORIG,$P(^(3),U,11)=TYPE
"RTN","ORMPS",78,0)
 . S $P(^OR(100,ORIG,3),U,6)=ORIFN,EVNT=$P(^(0),U,17)
"RTN","ORMPS",79,0)
 . I $L(EVNT),TYPE=1 S $P(^OR(100,ORIFN,0),U,17)=EVNT
"RTN","ORMPS",80,0)
 . I TYPE=2,$G(ORCAT)="I" S ORSTRT=ORLOG D PARENT^ORMPS3 ;ck if complex
"RTN","ORMPS",81,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS1 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,ORIFN,5)=$TR($P(ZSC,"|",2,7),"|","^") ;1 or 0 instead of [N]SC
"RTN","ORMPS",82,0)
SN2 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",83,0)
 D:ORSTS STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMPS",84,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR)
"RTN","ORMPS",85,0)
 ; if unsigned edit, leave ORIFN unsigned & mark ORIG as Sig Not Req'd
"RTN","ORMPS",86,0)
 S ORSIG=$S('ORIG:1,TYPE'=1:1,$P($G(^OR(100,ORIG,8,1,0)),U,4)'=2:1,1:0)
"RTN","ORMPS",87,0)
 D SIGSTS^ORCSAVE2(ORIFN,1):ORSIG,SIGN^ORCSAVE2(ORIG,,,5,1):'ORSIG
"RTN","ORMPS",88,0)
 I ORDCNTRL="SN" D  ;print
"RTN","ORMPS",89,0)
 . S:ORNATR="" $P(^OR(100,ORIFN,8,1,0),U,12)="" ;CHCS/OP orders
"RTN","ORMPS",90,0)
 . S ORP(1)=ORIFN_";1"_$S(ORNATR="":"^^^^1",$G(ORL):"^1",1:"")
"RTN","ORMPS",91,0)
 . I ORP(1)["^" D PRINTS^ORWD1(.ORP,+$G(ORL))
"RTN","ORMPS",92,0)
 S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMPS",93,0)
SNQ K ^TMP("ORWORD",$J)
"RTN","ORMPS",94,0)
 Q
"RTN","ORMPS",95,0)
 ;
"RTN","ORMPS",96,0)
XX ; -- Changed (new order not necessary)
"RTN","ORMPS",97,0)
 Q:$P($G(^OR(100,+ORIFN,3)),U,3)=5  ;pending - update when finished
"RTN","ORMPS",98,0)
 I '$$CHANGED^ORMPS2 D SC Q  ;ck sts/dates only
"RTN","ORMPS",99,0)
RO ; -- Replacement order (finished)
"RTN","ORMPS",100,0)
 S:ORNATR="" ORNATR="S" D RO^ORMPS2
"RTN","ORMPS",101,0)
 Q
"RTN","ORMPS",102,0)
 ;
"RTN","ORMPS",103,0)
SC ; -- Status changed (verified, expired, suspended, renewed, reinstate)
"RTN","ORMPS",104,0)
 N OR0,OR3,ZSC,DONE S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3))
"RTN","ORMPS",105,0)
 I $P(OR3,U,3)=5,ORSTS=6 D  Q:$G(DONE)
"RTN","ORMPS",106,0)
 . I $$CHANGED^ORMPS2 S ORNATR="S" D RO^ORMPS2 S DONE=1 Q
"RTN","ORMPS",107,0)
 . I $P(ZRX,"|",7)="TPN",+$P(OR0,U,11)'=$O(^ORD(100.98,"B","TPN",0)) D
"RTN","ORMPS",108,0)
 .. N DA,DR,DIE,ORDG S ORDG=+$O(^ORD(100.98,"B","TPN",0))
"RTN","ORMPS",109,0)
 .. S DA=+ORIFN,DR="23////"_ORDG,DIE="^OR(100," D ^DIE
"RTN","ORMPS",110,0)
 . I $P(OR3,U,11)=2,$P(OR0,U,12)="I" S ORSTRT=+$P($G(^OR(100,+ORIFN,8,1,0)),U,16) ;use Release Date for inpt renewals
"RTN","ORMPS",111,0)
 I $P(OR0,U,12)="I",$P(ZRX,"|",4)="R",+$P(ZRX,"|",2)=+ORIFN S ORSTRT=$P(OR0,U,8) ;keep orig start when renewed
"RTN","ORMPS",112,0)
 D DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",113,0)
 D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",114,0)
 I ORSTS=$P(OR3,U,3),ORSTOP'=$P(OR0,U,9) D SETALL^ORDD100(+ORIFN) ;AC xrf
"RTN","ORMPS",115,0)
 S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",116,0)
 I "^1^13^"[(U_$P(OR3,U,3)_U),"^3^5^6^15^"[(U_ORSTS_U) D  ;reinstated
"RTN","ORMPS",117,0)
 . I $P($G(^OR(100,+ORIFN,8,+$P(OR3,U,7),0)),U,2)="DC" S ^(2)=ORNOW_U_ORWHO ; When^Who reinstated order
"RTN","ORMPS",118,0)
 . S I="?" F  S I=$O(^OR(100,+ORIFN,8,I),-1) Q:'+I  I $P(^(I,0),U,15)="" S $P(^OR(100,+ORIFN,3),U,7)=I Q  ;138 Finds current action
"RTN","ORMPS",119,0)
 . K ^OR(100,+ORIFN,6) D SETALL^ORDD100(+ORIFN)
"RTN","ORMPS",120,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS1 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,+ORIFN,5)=$TR($P(ZSC,"|",2,7),"|","^") ;1 or 0 instead of [N]SC
"RTN","ORMPS",121,0)
 Q
"RTN","ORMPS",122,0)
 ;
"RTN","ORMPS",123,0)
STATUS(X) ; -- HL7 order status
"RTN","ORMPS",124,0)
 N Y S Y=$S(X="IP":5,X="CM":6,X="DC":1,X="ZE":7,X="HD":3,X="ZX":11,X="RP":12,X="ZZ":15,X="ZS":6,X="ZU":6,1:"")
"RTN","ORMPS",125,0)
 Q Y
"RTN","ORMPS",126,0)
 ;
"RTN","ORMPS",127,0)
DE ; -- Data Errors
"RTN","ORMPS",128,0)
 Q
"RTN","ORMPS",129,0)
 ;
"RTN","ORMPS",130,0)
UA ; -- Unable to accept [ack]
"RTN","ORMPS",131,0)
UX ; -- Unable to change [ack]
"RTN","ORMPS",132,0)
 S:'$L(ORNATR) ORNATR="X" ;Rejected
"RTN","ORMPS",133,0)
 S ^OR(100,+ORIFN,6)=$O(^ORD(100.02,"C",ORNATR,0))_U_U_ORNOW_U_U_OREASON
"RTN","ORMPS",134,0)
 I $P($G(^OR(100,+ORIFN,3)),U,11)=2 N ORIG S ORIG=$P(^(3),U,5) S:ORIG $P(^OR(100,ORIG,3),U,6)="" ;remove fwd ptr if pending renewal
"RTN","ORMPS",135,0)
 D STATUS^ORCSAVE2(+ORIFN,13)
"RTN","ORMPS",136,0)
UC ; -- Unable to cancel [ack]
"RTN","ORMPS",137,0)
UD ; -- Unable to discontinue [ack]
"RTN","ORMPS",138,0)
UH ; -- Unable to hold [ack]
"RTN","ORMPS",139,0)
UR ; -- Unable to release hold [ack]
"RTN","ORMPS",140,0)
 N ORDA S ORDA=+$P(ORIFN,";",2) I ORDA D
"RTN","ORMPS",141,0)
 . S $P(^OR(100,+ORIFN,8,ORDA,0),U,15)=13 ;request rejected
"RTN","ORMPS",142,0)
 . S:$L(OREASON) ^OR(100,+ORIFN,8,ORDA,1)=OREASON
"RTN","ORMPS",143,0)
 Q
"RTN","ORMPS",144,0)
 ;
"RTN","ORMPS",145,0)
OC ; -- Cancelled (before pharmacist's verification)
"RTN","ORMPS",146,0)
 G:ORTYPE="ORR" UA S:ORNATR="A" ORWHO=""
"RTN","ORMPS",147,0)
 S:'ORSTS ORSTS=13 S:ORSTS=12 ORNATR="S"
"RTN","ORMPS",148,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORWHO_U_ORNOW_U_U_OREASON
"RTN","ORMPS",149,0)
 I $P($G(^OR(100,+ORIFN,3)),U,11)=2 N ORIG S ORIG=$P(^(3),U,5) S:ORIG $P(^OR(100,ORIG,3),U,6)="" ;remove fwd ptr when pending renewal cancelled
"RTN","ORMPS",150,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:ORSTOP>ORNOW ORSTOP=ORNOW
"RTN","ORMPS",151,0)
 D UPDATE(ORSTS,"DC")
"RTN","ORMPS",152,0)
 Q
"RTN","ORMPS",153,0)
 ;
"RTN","ORMPS",154,0)
CR ; -- Cancelled [ack]
"RTN","ORMPS",155,0)
 D STATUS^ORCSAVE2(+ORIFN,13) S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",156,0)
 Q
"RTN","ORMPS",157,0)
 ;
"RTN","ORMPS",158,0)
OD ; -- Discontinued (cancelled after pharmacist's verification)
"RTN","ORMPS",159,0)
 S:'ORSTS ORSTS=1 S:ORSTS=12 ORNATR="C"
"RTN","ORMPS",160,0)
 I ORNATR="A" S ORWHO="" I $G(DGPMT)=3,$$MVT^DGPMOBS(DGPMDA) D XTMP^ORMEVNT ;save order#
"RTN","ORMPS",161,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORWHO_U_ORNOW_U_U_OREASON
"RTN","ORMPS",162,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:ORSTOP>ORNOW ORSTOP=ORNOW
"RTN","ORMPS",163,0)
 D UPDATE(ORSTS,"DC")
"RTN","ORMPS",164,0)
 Q
"RTN","ORMPS",165,0)
 ;
"RTN","ORMPS",166,0)
DR ; -- Discontinued [ack]
"RTN","ORMPS",167,0)
 D STATUS^ORCSAVE2(+ORIFN,1) S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",168,0)
 Q
"RTN","ORMPS",169,0)
 ;
"RTN","ORMPS",170,0)
OH ; -- Held
"RTN","ORMPS",171,0)
 S:'ORSTS ORSTS=3 D UPDATE(ORSTS,"HD")
"RTN","ORMPS",172,0)
 Q
"RTN","ORMPS",173,0)
 ;
"RTN","ORMPS",174,0)
HR ; -- Held [ack]
"RTN","ORMPS",175,0)
 D STATUS^ORCSAVE2(+ORIFN,3)
"RTN","ORMPS",176,0)
 Q
"RTN","ORMPS",177,0)
 ;
"RTN","ORMPS",178,0)
RL ; -- Released hold
"RTN","ORMPS",179,0)
OE ; -- Released hold
"RTN","ORMPS",180,0)
 N ORDA S ORDA=+$P(^OR(100,+ORIFN,3),U,7)
"RTN","ORMPS",181,0)
 I $P($G(^OR(100,+ORIFN,8,ORDA,0)),U,2)="HD" S $P(^(2),U,1,2)=ORNOW_U_ORWHO
"RTN","ORMPS",182,0)
 S:'$G(ORSTS) ORSTS=6 D UPDATE(ORSTS,"RL")
"RTN","ORMPS",183,0)
 Q
"RTN","ORMPS",184,0)
 ;
"RTN","ORMPS",185,0)
OR ; -- Released / [ack]
"RTN","ORMPS",186,0)
 S:'ORSTS ORSTS=6 D STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",187,0)
 D:ORSTRT!ORSTOP DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",188,0)
 Q
"RTN","ORMPS",189,0)
 ;
"RTN","ORMPS",190,0)
UPDATE(ORSTS,ORACT) ; -- continue
"RTN","ORMPS",191,0)
 N ORX,ORDA,ORP D:$G(ORSTS) STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",192,0)
 D:ORSTRT!ORSTOP DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",193,0)
 S ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMPS",194,0)
 . S ORDA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,OREASON,ORNOW,ORWHO)
"RTN","ORMPS",195,0)
 . I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMPS",196,0)
 . D RELEASE^ORCSAVE2(+ORIFN,ORDA,ORNOW,ORWHO,ORNATR)
"RTN","ORMPS",197,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,ORDA)
"RTN","ORMPS",198,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMPS",199,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=ORDA
"RTN","ORMPS",200,0)
 I 'ORX,ORACT="DC",'$$ACTV^ORX1(ORNATR) S $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMPS",201,0)
 D:$G(ORACT)="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMPS",202,0)
 Q
"RTN","ORMPS",203,0)
 ;
"RTN","ORMPS",204,0)
RXO() ; -- RXO segment
"RTN","ORMPS",205,0)
 N I,X S X="",I=$O(@ORMSG@(+ORC))
"RTN","ORMPS",206,0)
 I I,$E(@ORMSG@(I),1,3)="RXO" S X=I_U_@ORMSG@(I)
"RTN","ORMPS",207,0)
 Q X
"RTN","ORMPS",208,0)
 ;
"RTN","ORMPS",209,0)
RXE() ; -- RXE segment
"RTN","ORMPS",210,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMPS",211,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXE" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",212,0)
 Q X
"RTN","ORMPS",213,0)
 ;
"RTN","ORMPS",214,0)
RXR() ; -- RXR segment
"RTN","ORMPS",215,0)
 N X,I,SEG S X="",I=+RXE
"RTN","ORMPS",216,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXR" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",217,0)
 Q X
"RTN","ORMPS",218,0)
 ;
"RTN","ORMPS",219,0)
RXC() ; -- [First] RXC segment
"RTN","ORMPS",220,0)
 N X,I,SEG S X="",I=+RXE
"RTN","ORMPS",221,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXC" S X=I Q
"RTN","ORMPS",222,0)
 Q X
"RTN","ORMPS",223,0)
 ;
"RTN","ORMPS",224,0)
ZRX() ; -- ZRX segment
"RTN","ORMPS",225,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMPS",226,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="ZRX" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",227,0)
 Q X
"RTN","ORMPS1")
0^85^B63625403
"RTN","ORMPS1",1,0)
ORMPS1 ;SLC/MKB - Process Pharmacy ORM msgs cont ;12/9/04  12:01
"RTN","ORMPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**86,92,94,116,134,152,158,149,190,195**;Dec 17, 1997
"RTN","ORMPS1",3,0)
UDOSE ; -- new Unit Dose order
"RTN","ORMPS1",4,0)
 N QT,DRUG,INSTR,DOSE,RTE,SCH,OI,URG,WP,DUR,STR,DRGNM,X,PSOI,PSDD,S0,ID,LDOSE,XC,NTE,S0,RXR
"RTN","ORMPS1",5,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSJ OR PAT OE",0))
"RTN","ORMPS1",6,0)
 I $G(ORAPPT)>0 S ORDG=+$O(^ORD(100.98,"B","CLINIC MEDICATIONS",0))
"RTN","ORMPS1",7,0)
 E  S ORDG=+$O(^ORD(100.98,"B","UNIT DOSE MEDICATIONS",0))
"RTN","ORMPS1",8,0)
 S ORPKG=+$$PKG("PSJ")
"RTN","ORMPS1",9,0)
 D GETDLG1^ORCD(ORDIALOG) S QT=$G(ORQT(1))
"RTN","ORMPS1",10,0)
 S DRUG=$$PTR("DISPENSE DRUG"),INSTR=$$PTR("INSTRUCTIONS")
"RTN","ORMPS1",11,0)
 S DOSE=$$PTR("DOSE"),RTE=$$PTR("ROUTE"),SCH=$$PTR("SCHEDULE")
"RTN","ORMPS1",12,0)
 S OI=$$PTR("ORDERABLE ITEM"),URG=$$PTR("URGENCY")
"RTN","ORMPS1",13,0)
 S WP=$$PTR("WORD PROCESSING 1"),DUR=$$PTR("DURATION")
"RTN","ORMPS1",14,0)
 S STR=$$PTR("STRENGTH"),DRGNM=$$PTR("DRUG NAME")
"RTN","ORMPS1",15,0)
UD1 S:RXO X=$P(RXO,"|",2),ORDIALOG(OI,1)=$$ORDITEM^ORM(X),PSOI=$P(X,U,4,5)
"RTN","ORMPS1",16,0)
 I '$G(ORDIALOG(OI,1)) S ORERR="Missing or invalid orderable item" Q
"RTN","ORMPS1",17,0)
 S PSDD=$P($$FIND^ORM(+RXE,3),U,4,5),ORDIALOG(DRUG,1)=+PSDD
"RTN","ORMPS1",18,0)
 S S0=$$FIND^ORM(+RXE,26)_"&"_$P($$FIND^ORM(+RXE,27),U,5)
"RTN","ORMPS1",19,0)
 S ID=$P(QT,U),LDOSE=$P(QT,U,8) I 'ID,S0 D
"RTN","ORMPS1",20,0)
 . N UNT,PTRN S UNT=$P(S0,"&",2),PTRN="1.N1"""_UNT_""""
"RTN","ORMPS1",21,0)
 . I LDOSE?@PTRN S $P(ID,"&",1,2)=+LDOSE_"&"_UNT Q  ;pre-POE orders
"RTN","ORMPS1",22,0)
 . S:$P(PSOI,U,2)'[S0 ORDIALOG(STR,1)=$TR(S0,"&")
"RTN","ORMPS1",23,0)
 I 'ID,'S0 S ORDIALOG(DRGNM,1)=$P(PSDD,U,2)
"RTN","ORMPS1",24,0)
 S:$L(ID) ORDIALOG(DOSE,1)=$P(ID,"&",1,4)_"&"_LDOSE_"&"_+PSDD_"&"_S0
"RTN","ORMPS1",25,0)
 I LDOSE="" D  I LDOSE="" S ORERR="Unable to determine instructions" Q
"RTN","ORMPS1",26,0)
 . I $G(RXC)'>0 D  Q  ;look for units/dose
"RTN","ORMPS1",27,0)
 .. S LDOSE=$P(ID,"&",3),X=$P(ID,"&",4) I 'LDOSE S LDOSE="" Q
"RTN","ORMPS1",28,0)
 .. S:'$L(X) X=$P($$FIND^ORM(+RXE,7),U,5) S:$L(X) LDOSE=LDOSE_" "_X
"RTN","ORMPS1",29,0)
 .. S ORDIALOG(DRGNM,1)=$P(PSDD,U,2) ;force use of DD
"RTN","ORMPS1",30,0)
 . F  D  Q:LDOSE'=""  S RXC=$O(@ORMSG@(RXC)) Q:'RXC  Q:$E(@ORMSG@(RXC),1,3)'="RXC"
"RTN","ORMPS1",31,0)
 .. S XC=@ORMSG@(RXC) Q:+$P($P(XC,"|",3),U,4)'=+PSOI
"RTN","ORMPS1",32,0)
 .. S LDOSE=$P(XC,"|",4)_$P($P(XC,"|",5),U,5) ;strength_units
"RTN","ORMPS1",33,0)
 S ORDIALOG(INSTR,1)=LDOSE
"RTN","ORMPS1",34,0)
UD2 S NTE=$$NTE(21) I NTE D
"RTN","ORMPS1",35,0)
 . N CNT,I S CNT=1,^TMP("ORWORD",$J,WP,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",36,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,WP,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",37,0)
 . S ^TMP("ORWORD",$J,WP,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",38,0)
 . S ORDIALOG(WP,1)="^TMP(""ORWORD"",$J,"_WP_",1)"
"RTN","ORMPS1",39,0)
 S RXR=$$RXR^ORMPS I 'RXR S ORERR="Missing or invalid RXR segment" Q
"RTN","ORMPS1",40,0)
 S ORDIALOG(RTE,1)=$P($P(RXR,"|",2),U,4),ORDIALOG(URG,1)=ORURG
"RTN","ORMPS1",41,0)
 S ORDIALOG(SCH,1)=$P(QT,U,2),X=$P(QT,U,3)
"RTN","ORMPS1",42,0)
 I $L(X) D  ;set only if previous order had duration
"RTN","ORMPS1",43,0)
 . N IFN S IFN=$S($G(ORIFN):+ORIFN,$P(ZRX,"|",2):+$P(ZRX,"|",2),1:0)
"RTN","ORMPS1",44,0)
 . S:$O(^OR(100,+IFN,4.5,"ID","DAYS",0)) ORDIALOG(DUR,1)=$$DURATION(X)
"RTN","ORMPS1",45,0)
 D DOSETEXT^ORCDPS2 ;reset Instructions text, SIG
"RTN","ORMPS1",46,0)
 Q
"RTN","ORMPS1",47,0)
OUT ; -- new Outpt order
"RTN","ORMPS1",48,0)
 N OI,SIG,INSTR,DOSE,RTE,SCH,DUR,SC,STR,DRUG,PI,CONJ,PSOI,PSDD,S0,X,I,RXR,J,NTE,ZSC,CNT,PC
"RTN","ORMPS1",49,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSO OERR",0))
"RTN","ORMPS1",50,0)
 S ORDG=+$O(^ORD(100.98,"B","OUTPATIENT MEDICATIONS",0))
"RTN","ORMPS1",51,0)
 S ORPKG=+$$PKG("PSO") D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMPS1",52,0)
 S OI=$$PTR("ORDERABLE ITEM"),SIG=$$PTR("SIG")
"RTN","ORMPS1",53,0)
 S INSTR=$$PTR("INSTRUCTIONS"),DOSE=$$PTR("DOSE")
"RTN","ORMPS1",54,0)
 S SCH=$$PTR("SCHEDULE"),DUR=$$PTR("DURATION")
"RTN","ORMPS1",55,0)
 S RTE=$$PTR("ROUTE"),SC=$$PTR("SERVICE CONNECTED")
"RTN","ORMPS1",56,0)
 S STR=$$PTR("STRENGTH"),DRUG=$$PTR("DISPENSE DRUG")
"RTN","ORMPS1",57,0)
 S PI=$$PTR("PATIENT INSTRUCTIONS"),CONJ=$$PTR("AND/THEN")
"RTN","ORMPS1",58,0)
 S PC=$$PTR("WORD PROCESSING 1")
"RTN","ORMPS1",59,0)
 S:RXO X=$P(RXO,"|",2),ORDIALOG(OI,1)=$$ORDITEM^ORM(X),PSOI=$P(X,U,4,5)
"RTN","ORMPS1",60,0)
 I '$G(ORDIALOG(OI,1)) S ORERR="Missing or invalid orderable item" Q
"RTN","ORMPS1",61,0)
 S PSDD=$P($$FIND^ORM(+RXE,3),U,4,5),ORDIALOG(DRUG,1)=+PSDD
"RTN","ORMPS1",62,0)
 S S0=$$FIND^ORM(+RXE,26)_"&"_$P($$FIND^ORM(+RXE,27),U,5)
"RTN","ORMPS1",63,0)
 I S0,$P(PSOI,U,2)'[S0 S ORDIALOG(STR,1)=$TR(S0,"&")
"RTN","ORMPS1",64,0)
 I 'S0,'$G(ORQT(1)) S ORDIALOG($$PTR("DRUG NAME"),1)=$P(PSDD,U,2)
"RTN","ORMPS1",65,0)
OUT1 S ORDIALOG($$PTR("QUANTITY"),1)=$$FIND^ORM(+RXE,11)
"RTN","ORMPS1",66,0)
 S ORDIALOG($$PTR("REFILLS"),1)=$$FIND^ORM(+RXE,13)
"RTN","ORMPS1",67,0)
 S X=$$FIND^ORM(+RXE,23) S:$E(X)="D" X=+$E(X,2,99)
"RTN","ORMPS1",68,0)
 S:X ORDIALOG($$PTR("DAYS SUPPLY"),1)=X
"RTN","ORMPS1",69,0)
 I ZRX S X=$P(ZRX,"|",5) S:$L(X) ORDIALOG($$PTR("ROUTING"),1)=X
"RTN","ORMPS1",70,0)
 S:ORURG ORDIALOG($$PTR("URGENCY"),1)=ORURG F I=1:1:ORQT D
"RTN","ORMPS1",71,0)
 . S ORDIALOG(INSTR,I)=$P(ORQT(I),U,8),X=$P(ORQT(I),U)
"RTN","ORMPS1",72,0)
 . S:$L(X) ORDIALOG(DOSE,I)=$P(X,"&",1,4)_"&"_$P(ORQT(I),U,8)_"&"_+PSDD_"&"_S0
"RTN","ORMPS1",73,0)
 . S X=$P(ORQT(I),U,2) S:$L(X) ORDIALOG(SCH,I)=X
"RTN","ORMPS1",74,0)
 . S X=$P(ORQT(I),U,3) S:$L(X) ORDIALOG(DUR,I)=$$DURATION(X)
"RTN","ORMPS1",75,0)
 . S X=$P(ORQT(I),U,9) S:$L(X) ORDIALOG(CONJ,I)=$S(X="S":"T",1:X)
"RTN","ORMPS1",76,0)
 S RXR=$$RXR^ORMPS I RXR S ORDIALOG(RTE,1)=$P($P(RXR,"|",2),U,4) D
"RTN","ORMPS1",77,0)
 . S I=1,J=+RXR ;look for multiple RXR's
"RTN","ORMPS1",78,0)
 . F  S J=$O(@ORMSG@(J)) Q:J'>0  S RXR=@ORMSG@(J) Q:$E(RXR,1,3)'="RXR"  S I=I+1,ORDIALOG(RTE,I)=$P($P(RXR,"|",2),U,4)
"RTN","ORMPS1",79,0)
OUT2 S NTE=$$NTE(6) D:'NTE PCOMM I NTE D  ;Prov Comm
"RTN","ORMPS1",80,0)
 . S CNT=1,^TMP("ORWORD",$J,PC,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",81,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,PC,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",82,0)
 . S ^TMP("ORWORD",$J,PC,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",83,0)
 . S ORDIALOG(PC,1)="^TMP(""ORWORD"",$J,"_PC_",1)"
"RTN","ORMPS1",84,0)
 S NTE=$$NTE(7) I NTE D  ;Pat Instr
"RTN","ORMPS1",85,0)
 . S CNT=1,^TMP("ORWORD",$J,PI,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",86,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,PI,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",87,0)
 . S ^TMP("ORWORD",$J,PI,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",88,0)
 . S ORDIALOG(PI,1)="^TMP(""ORWORD"",$J,"_PI_",1)"
"RTN","ORMPS1",89,0)
 S NTE=$$NTE(21) I NTE D  ;Sig
"RTN","ORMPS1",90,0)
 . S CNT=1,^TMP("ORWORD",$J,SIG,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",91,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,SIG,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",92,0)
 . S ^TMP("ORWORD",$J,SIG,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",93,0)
 . S ORDIALOG(SIG,1)="^TMP(""ORWORD"",$J,"_SIG_",1)"
"RTN","ORMPS1",94,0)
 . S ORDIALOG(PI,"FORMAT")="@" ;PI already included in Sig
"RTN","ORMPS1",95,0)
OUT3 I '$G(ORQT(1))!('NTE) D DOSETEXT^ORCDPS2 ;reset Instructions text, Sig
"RTN","ORMPS1",96,0)
 S ZSC=$$ZSC,X=$P(ZSC,"|",2) I X?2.3U S ORDIALOG(SC,1)=$S(X="SC":1,1:0)
"RTN","ORMPS1",97,0)
 Q
"RTN","ORMPS1",98,0)
IV ; -- new IV order
"RTN","ORMPS1",99,0)
 N IVTYP S IVTYP=$P(ZRX,"|",7) I IVTYP="",$$NUMADDS'>1 G UDOSE
"RTN","ORMPS1",100,0)
 N SOLN,VOL,ADDS,STR,UNITS,RATE,URG,X,X1,X2,I,J,TYPE,OI,WP,NTE,SCH,DAYS
"RTN","ORMPS1",101,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORMPS1",102,0)
 I +$G(ORAPPT)>0 S ORDG=+$O(^ORD(100.98,"B","CLINIC MEDICATIONS",0))
"RTN","ORMPS1",103,0)
 E  S ORDG=+$O(^ORD(100.98,"B",$S($P(ZRX,"|",7)="TPN":"TPN",1:"IV RX"),0))
"RTN","ORMPS1",104,0)
 S ORPKG=+$$PKG("PSJ") D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMPS1",105,0)
 S SOLN=$$PTR("ORDERABLE ITEM"),VOL=$$PTR("VOLUME"),SCH=$$PTR("SCHEDULE")
"RTN","ORMPS1",106,0)
 S RATE=$$PTR("INFUSION RATE") S:ORURG ORDIALOG($$PTR("URGENCY"),1)=ORURG
"RTN","ORMPS1",107,0)
 S WP=$$PTR("WORD PROCESSING 1"),ADDS=$$PTR("ADDITIVE")
"RTN","ORMPS1",108,0)
 S STR=$$PTR("STRENGTH PSIV"),UNITS=$$PTR("UNITS")
"RTN","ORMPS1",109,0)
 S DAYS=$$PTR("DURATION")
"RTN","ORMPS1",110,0)
IV1 S NTE=$$NTE(21) I NTE D
"RTN","ORMPS1",111,0)
 . N CNT,I S CNT=1,^TMP("ORWORD",$J,WP,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",112,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,WP,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",113,0)
 . S ^TMP("ORWORD",$J,WP,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",114,0)
 . S ORDIALOG(WP,1)="^TMP(""ORWORD"",$J,"_WP_",1)"
"RTN","ORMPS1",115,0)
 N ORDAYS S ORDAYS=""
"RTN","ORMPS1",116,0)
 S:$D(RXO) ORDAYS=$P($P(RXO,"|",2),"^",3)
"RTN","ORMPS1",117,0)
 S:$L(ORDAYS) ORDAYS=$$IVLIM^ORMPS2(ORDAYS)
"RTN","ORMPS1",118,0)
 S:$L(ORDAYS) ORDIALOG(DAYS,1)=ORDAYS
"RTN","ORMPS1",119,0)
 S X=$P($$FIND^ORM(+RXE,25),U,5)
"RTN","ORMPS1",120,0)
 S ORDIALOG(RATE,1)=$$FIND^ORM(+RXE,24)_$S($L(X):" "_X,1:""),(I,J)=0
"RTN","ORMPS1",121,0)
 F  D  S RXC=$O(@ORMSG@(RXC)) Q:'RXC  Q:$E(@ORMSG@(RXC),1,3)'="RXC"
"RTN","ORMPS1",122,0)
 . S X=@ORMSG@(RXC),TYPE=$P(X,"|",2),OI=$$ORDITEM^ORM($P(X,"|",3)) Q:'OI
"RTN","ORMPS1",123,0)
 . S X1=$P(X,"|",4),X2=$P($P(X,"|",5),U,5)
"RTN","ORMPS1",124,0)
 . I $E(TYPE)="B" S J=J+1,ORDIALOG(SOLN,J)=OI,ORDIALOG(VOL,J)=X1 Q
"RTN","ORMPS1",125,0)
 . S I=I+1,ORDIALOG(ADDS,I)=OI,ORDIALOG(STR,I)=X1,ORDIALOG(UNITS,I)=X2
"RTN","ORMPS1",126,0)
 I IVTYP="" S X=$P($G(ORQT(1)),U,2) S:$L(X) ORDIALOG(SCH,1)=X
"RTN","ORMPS1",127,0)
 Q
"RTN","ORMPS1",128,0)
NTE(ID) ; -- Return subscript of NTE segment for RXE-<ID>
"RTN","ORMPS1",129,0)
 N I,SEG,Y S Y="",I=+RXE S:'$G(ID) ID=21
"RTN","ORMPS1",130,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=@ORMSG@(I) Q:$E(SEG,1,3)="ORC"  I $P(SEG,"|",1,2)=("NTE|"_ID) S Y=I Q
"RTN","ORMPS1",131,0)
 Q Y
"RTN","ORMPS1",132,0)
ZSC() ; -- Return subscript of ZSC segment
"RTN","ORMPS1",133,0)
 N I,SEG,Y S Y="",I=+RXE
"RTN","ORMPS1",134,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="ZSC" S Y=I_U_@ORMSG@(I) Q
"RTN","ORMPS1",135,0)
 Q Y
"RTN","ORMPS1",136,0)
NUMADDS() ; -- count number of additives to determine type
"RTN","ORMPS1",137,0)
 N CNT,I,X S CNT=0,I=+RXE
"RTN","ORMPS1",138,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S X=@ORMSG@(I) Q:$P(X,"|")="ORC"  I $E(X,1,6)="RXC|A|" S CNT=CNT+1
"RTN","ORMPS1",139,0)
 Q CNT
"RTN","ORMPS1",140,0)
PKG(NMSP) ; -- Return Package file ptr for NMSP
"RTN","ORMPS1",141,0)
 N I S I=0
"RTN","ORMPS1",142,0)
 F  S I=+$O(^DIC(9.4,"C",NMSP,I)) Q:I<1  Q:'$O(^(I,0))  ;no Addl Prefs
"RTN","ORMPS1",143,0)
 Q I
"RTN","ORMPS1",144,0)
PTR(NAME) ; -- Returns ien of prompt NAME in Order Dialog file #101.41
"RTN","ORMPS1",145,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMPS1",146,0)
DURATION(X) ; -- Returns "# units" from U# format
"RTN","ORMPS1",147,0)
 N Y,Y1,Y2 I X'?.1U1.N Q ""
"RTN","ORMPS1",148,0)
 S Y1=$E(X),Y2=+$E(X,2,$L(X)) I X=+X S Y1="D",Y2=+X
"RTN","ORMPS1",149,0)
 S Y=Y2_" "_$S(Y1="L":"MONTH",Y1="W":"WEEK",Y1="H":"HOUR",Y1="M":"MINUTE",Y1="S":"SECOND",1:"DAY")_$S(Y2>1:"S",1:"")
"RTN","ORMPS1",150,0)
 Q Y
"RTN","ORMPS1",151,0)
QT ; -- Unpiece the Q/T field from RXE
"RTN","ORMPS1",152,0)
 I 'RXE S ORQT(1)=ORQT,ORQT=1 Q  ; nothing to reset
"RTN","ORMPS1",153,0)
 N X,Y,I,J,P,SEG,DONE K ORQT
"RTN","ORMPS1",154,0)
 S SEG=$G(@ORMSG@(+RXE)),X=$P(SEG,"|",2),(I,J,P,DONE)=0
"RTN","ORMPS1",155,0)
 F  D  Q:DONE
"RTN","ORMPS1",156,0)
 . S P=P+1,Y=$P(X,"~",P) I Y="" S DONE=1 Q
"RTN","ORMPS1",157,0)
 . I P<$L(X,"~") S I=I+1,ORQT(I)=Y Q
"RTN","ORMPS1",158,0)
 . I $L(SEG,"|")>2 S I=I+1,ORQT(I)=Y,DONE=1 Q
"RTN","ORMPS1",159,0)
 . S J=+$O(@ORMSG@(+RXE,J)) I J'>0 S I=I+1,ORQT(I)=Y,DONE=1 Q
"RTN","ORMPS1",160,0)
 . S SEG=$G(@ORMSG@(+RXE,J)),X=$P(SEG,"|"),P=1,I=I+1,ORQT(I)=Y_$P(X,"~")
"RTN","ORMPS1",161,0)
 S ORQT=I Q:'ORQT  ; else reset ORSTRT, ORSTOP, ORURG
"RTN","ORMPS1",162,0)
 S ORSTRT=$P(ORQT(1),U,4),ORSTOP=$P(ORQT(ORQT),U,5),ORURG=$P(ORQT(1),U,6)
"RTN","ORMPS1",163,0)
 S:ORSTRT ORSTRT=$$FMDATE^ORM(ORSTRT) S:ORSTOP ORSTOP=$$FMDATE^ORM(ORSTOP) S:$L(ORURG) ORURG=$$URGENCY^ORM(ORURG)
"RTN","ORMPS1",164,0)
 Q
"RTN","ORMPS1",165,0)
PCOMM ; -- Get Provider Comments from previous order, when changed
"RTN","ORMPS1",166,0)
 N OLD,I
"RTN","ORMPS1",167,0)
 S OLD=+$G(ORIFN) I OLD<1 S OLD=+$P(ZRX,"|",2) Q:OLD<1
"RTN","ORMPS1",168,0)
 S I=+$O(^OR(100,OLD,4.5,"ID","COMMENT",0)) Q:I<1
"RTN","ORMPS1",169,0)
 Q:'$O(^OR(100,OLD,4.5,I,2,0))  ;none
"RTN","ORMPS1",170,0)
 M ^TMP("ORWORD",$J,PC,1)=^OR(100,OLD,4.5,I,2)
"RTN","ORMPS1",171,0)
 S ORDIALOG(PC,1)="^TMP(""ORWORD"",$J,"_PC_",1)"
"RTN","ORMPS1",172,0)
 S ORDIALOG(PC,"FORMAT")="@" ;text in Sig already
"RTN","ORMPS1",173,0)
 Q
"RTN","ORMPS2")
0^90^B37370789
"RTN","ORMPS2",1,0)
ORMPS2 ;SLC/MKB - Process Pharmacy ORM msgs cont ;12/9/04  12:01
"RTN","ORMPS2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,116,129,134,186,190,195**;Dec 17, 1997
"RTN","ORMPS2",3,0)
 ;
"RTN","ORMPS2",4,0)
FINISHED() ; -- new order [SN^ORMPS] due to finishing?
"RTN","ORMPS2",5,0)
 N Y,ORIG,TYPE,ORIG4 S Y=0
"RTN","ORMPS2",6,0)
 S ORIG=+$P(ZRX,"|",2),TYPE=$P(ZRX,"|",4),ORIG4=$G(^OR(100,ORIG,4))
"RTN","ORMPS2",7,0)
 I ORIG,TYPE="E",ORIG4?1.N1"P"!(ORIG4?1.N1"S") S ORIFN=+ORIG,Y=1
"RTN","ORMPS2",8,0)
 Q Y
"RTN","ORMPS2",9,0)
 ;
"RTN","ORMPS2",10,0)
WPX() ; -- Compare comments in @ORMSG@(NTE) with order ORIFN
"RTN","ORMPS2",11,0)
 ;     Returns 1 if different, or 0 if same
"RTN","ORMPS2",12,0)
 N NTE,SPINST,Y,I,J,X,X1 S Y=0
"RTN","ORMPS2",13,0)
 S NTE=+$$NTE^ORMPS1(21),SPINST=$S(NTE:$P(@ORMSG@(NTE),"|",4),1:"")
"RTN","ORMPS2",14,0)
 S I=+$O(^OR(100,+ORIFN,4.5,"ID","COMMENT",0)) I I'>0 S:$L(SPINST) Y=1 G WQ
"RTN","ORMPS2",15,0)
 S X=$G(^OR(100,+ORIFN,4.5,I,2,1,0)) ;1st line
"RTN","ORMPS2",16,0)
 I '$O(^OR(100,+ORIFN,4.5,I,2,1)) S:X'=SPINST Y=1 G WQ
"RTN","ORMPS2",17,0)
 S J=1 F  S J=$O(^OR(100,+ORIFN,4.5,I,2,J)) Q:J'>0  S X1=$G(^(J,0)) D  Q:$L(X)'<240
"RTN","ORMPS2",18,0)
 . I ($L(X)+$L(X1)+1)'>240 S X=X_" "_X1 Q
"RTN","ORMPS2",19,0)
 . S X=X_" "_$E(X1,1,239-$L(X))
"RTN","ORMPS2",20,0)
 S:X'=SPINST Y=1 ;changed
"RTN","ORMPS2",21,0)
WQ Q Y
"RTN","ORMPS2",22,0)
 ;
"RTN","ORMPS2",23,0)
IVX() ; -- Compare ORMSG to Inpt order ORIFN if IV, return 0 if 'diff or 'IV
"RTN","ORMPS2",24,0)
 N Y,RXC,DG,OI,PSOI,XC,RATE,ORA,ORB,ORX,I,J,OI0,INST,VOL,STR,UNT
"RTN","ORMPS2",25,0)
 S RXC=$$RXC^ORMPS,Y=0 I RXC'>0 Q Y  ;not IV of any kind
"RTN","ORMPS2",26,0)
 S DG=+$P($G(^OR(100,+ORIFN,0)),U,11),DG=$P($G(^ORD(100.98,DG,0)),U,3)
"RTN","ORMPS2",27,0)
 I DG'="IV RX",DG'="TPN" D  Q Y  ;not fluid
"RTN","ORMPS2",28,0)
 . I $P(ZRX,"|",7)'="" S Y=1 Q
"RTN","ORMPS2",29,0)
 . I $$NUMADDS^ORMPS1>1 S Y=1 Q
"RTN","ORMPS2",30,0)
 . S OI=$$VALUE("ORDERABLE"),PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORMPS2",31,0)
 . S XC=@ORMSG@(RXC) I PSOI'=$P(XC,U,4) S Y=1 Q
"RTN","ORMPS2",32,0)
 . N X1,X2,X3 S X1=$P(XC,"|",4),X2=$P($P(XC,"|",5),U,5)
"RTN","ORMPS2",33,0)
 . S X3=$$VALUE("INSTR") I (X1_X2)'=X3,(X1_" "_X2)'=X3 S Y=1 Q
"RTN","ORMPS2",34,0)
IV1 S RATE=$$FIND^ORM(+RXE,24),UNT=$P($$FIND^ORM(+RXE,25),U,5)
"RTN","ORMPS2",35,0)
 S:$L(UNT) RATE=RATE_" "_UNT I RATE'=$$VALUE("RATE") S Y=1 Q Y
"RTN","ORMPS2",36,0)
 S ORB=+$$PTR("ORDERABLE ITEM"),ORA=+$$PTR("ADDITIVE"),I=+RXC
"RTN","ORMPS2",37,0)
 F  S XC=@ORMSG@(I) Q:$E(XC,1,3)'="RXC"  D  S I=$O(@ORMSG@(I)) Q:I'>0
"RTN","ORMPS2",38,0)
 . S ORX($P(XC,"|",2),+$P(XC,U,4))=$P(XC,"|",4)_U_$P($P(XC,"|",5),U,5)
"RTN","ORMPS2",39,0)
 . ;ORX("A",PSOI)=str^units or ORX("B",PSOI)=volume^units
"RTN","ORMPS2",40,0)
 F I="STRENGTH","UNITS","VOLUME" D  ;ORX(I,inst)=value
"RTN","ORMPS2",41,0)
 . S J=0 F  S J=$O(^OR(100,+ORIFN,4.5,"ID",I,J)) Q:J'>0  D
"RTN","ORMPS2",42,0)
 .. S INST=+$P($G(^OR(100,+ORIFN,4.5,J,0)),U,3)
"RTN","ORMPS2",43,0)
 .. S:INST ORX(I,INST)=$G(^OR(100,+ORIFN,4.5,J,1))
"RTN","ORMPS2",44,0)
 S I=0 F  S I=$O(^OR(100,+ORIFN,4.5,"ID","ORDERABLE",I)) Q:I'>0  D  Q:Y
"RTN","ORMPS2",45,0)
 . S OI0=$G(^OR(100,+ORIFN,4.5,I,0)),OI=+$G(^(1))
"RTN","ORMPS2",46,0)
 . S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2)
"RTN","ORMPS2",47,0)
 . I $P(OI0,U,2)=ORA,$G(ORX("A",PSOI)) D  Q
"RTN","ORMPS2",48,0)
 .. S INST=$P(OI0,U,3),STR=+ORX("A",PSOI),UNT=$P(ORX("A",PSOI),U,2)
"RTN","ORMPS2",49,0)
 .. I STR'=$G(ORX("STRENGTH",INST)) S Y=1 Q
"RTN","ORMPS2",50,0)
 .. I UNT'=$G(ORX("UNITS",INST)) S Y=1 Q
"RTN","ORMPS2",51,0)
 .. K ORX("A",PSOI) ;same
"RTN","ORMPS2",52,0)
 . I $P(OI0,U,2)=ORB,$G(ORX("B",PSOI)) D  Q
"RTN","ORMPS2",53,0)
 .. S INST=$P(OI0,U,3),VOL=+$G(ORX("B",PSOI))
"RTN","ORMPS2",54,0)
 .. I VOL'=$G(ORX("VOLUME",INST)) S Y=1 Q
"RTN","ORMPS2",55,0)
 .. K ORX("B",PSOI) ;same
"RTN","ORMPS2",56,0)
 . S Y=1
"RTN","ORMPS2",57,0)
 I $O(ORX("A",0))!$O(ORX("B",0)) S Y=1 ;leftover items - changed
"RTN","ORMPS2",58,0)
 Q Y
"RTN","ORMPS2",59,0)
 ;
"RTN","ORMPS2",60,0)
CHANGED() ; -- Compare ORMSG to order ORIFN, return 1 if different
"RTN","ORMPS2",61,0)
 N X,Y,X1,ZSC,NTE,SIG,PI S Y=0
"RTN","ORMPS2",62,0)
 I $G(ORCAT)="I" D  G CHQ
"RTN","ORMPS2",63,0)
 . I $$WPX S Y=1 Q  ;Special Instructions
"RTN","ORMPS2",64,0)
 . ;S X=$$VALUE("DAYS") ;duration
"RTN","ORMPS2",65,0)
 . ;I X S X1=$$DURATION^ORMPS1($P($G(ORQT(1)),U,3)) I X'=X1 S Y=1 Q
"RTN","ORMPS2",66,0)
 . I $$IVX S Y=1 Q  ;IV fields
"RTN","ORMPS2",67,0)
 S X=$P($P(RXE,"|",3),U,4) I X'=$$VALUE("DRUG") S Y=1 G CHQ
"RTN","ORMPS2",68,0)
 I $P(RXE,"|",11)'=$$VALUE("QTY") S Y=1 G CHQ
"RTN","ORMPS2",69,0)
 I $P(RXE,"|",13)'=$$VALUE("REFILLS") S Y=1 G CHQ
"RTN","ORMPS2",70,0)
 S X=$P(RXE,"|",23) S:$E(X)="D" X=+$E(X,2,99) I X'=$$VALUE("SUPPLY") S Y=1 G CHQ
"RTN","ORMPS2",71,0)
 I $P(ZRX,"|",5)'=$$VALUE("PICKUP") S Y=1 G CHQ
"RTN","ORMPS2",72,0)
 S NTE=$$NTE^ORMPS1(21),SIG=+$O(^OR(100,+ORIFN,4.5,"ID","SIG",0)) ;verb
"RTN","ORMPS2",73,0)
 I NTE,SIG,$P($P(@ORMSG@(NTE),"|",4)," ")'=$P($G(^OR(100,+ORIFN,4.5,SIG,2,1,0))," ") S Y=1 G CHQ
"RTN","ORMPS2",74,0)
 S NTE=$$NTE^ORMPS1(7),PI=+$O(^OR(100,+ORIFN,4.5,"ID","PI",0))
"RTN","ORMPS2",75,0)
 I (NTE&'PI)!('NTE&PI) Q 1 ;added or deleted
"RTN","ORMPS2",76,0)
 I NTE,PI,$P(@ORMSG@(NTE),"|",4)'=$G(^OR(100,+ORIFN,4.5,PI,2,1,0)) S Y=1 G CHQ
"RTN","ORMPS2",77,0)
 Q:'$P($G(^OR(100,+ORIFN,8,0)),U,3)
"RTN","ORMPS2",78,0)
 N LSTACT,PREPRV,CURPRV S LSTACT="?",(PREPRV,CURPRV)=0
"RTN","ORMPS2",79,0)
 F  S LSTACT=$O(^OR(100,+ORIFN,8,LSTACT),-1) Q:LSTACT
"RTN","ORMPS2",80,0)
 S PREPRV=$P($G(^OR(100,+ORIFN,8,LSTACT,0)),U,3)
"RTN","ORMPS2",81,0)
 S CURPRV=$P($G(ORC),"|",13)
"RTN","ORMPS2",82,0)
 I (PREPRV'=CURPRV) S Y=1 G CHQ
"RTN","ORMPS2",83,0)
CHQ Q Y
"RTN","ORMPS2",84,0)
 ;
"RTN","ORMPS2",85,0)
VALUE(ID) ; -- Return value of ID in ^OR(100,+ORIFN,4.5,"ID")
"RTN","ORMPS2",86,0)
 N I,Y I '$L($G(ID)) Q ""
"RTN","ORMPS2",87,0)
 S I=+$O(^OR(100,+ORIFN,4.5,"ID",ID,0))
"RTN","ORMPS2",88,0)
 S Y=$G(^OR(100,+ORIFN,4.5,I,1))
"RTN","ORMPS2",89,0)
 Q Y
"RTN","ORMPS2",90,0)
 ;
"RTN","ORMPS2",91,0)
PTR(X) ; -- Return ptr to prompt OR GTX X
"RTN","ORMPS2",92,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"RTN","ORMPS2",93,0)
 ;
"RTN","ORMPS2",94,0)
RO ; -- Replacement order (finished)
"RTN","ORMPS2",95,0)
 ;
"RTN","ORMPS2",96,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORDA,ORX,ORSIG,ORP,ZSC,NEWSTS
"RTN","ORMPS2",97,0)
 K ^TMP("ORWORD",$J)
"RTN","ORMPS2",98,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS2",99,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS2",100,0)
 S RXO=$$RXO^ORMPS,RXC=$$RXC^ORMPS,ORIFN=+$G(ORIFN)
"RTN","ORMPS2",101,0)
 I ORIFN'>0 S ORERR="Missing or invalid order number" Q
"RTN","ORMPS2",102,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1") Q:$D(ORERR)
"RTN","ORMPS2",103,0)
 S ORDA=$$ACTION^ORCSAVE("XX",ORIFN,ORNP,"",ORNOW,ORWHO)
"RTN","ORMPS2",104,0)
 I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMPS2",105,0)
RO1 ; -Update sts of order to active, last action to dc/edit:
"RTN","ORMPS2",106,0)
 S ORX=ORDA F  S ORX=+$O(^OR(100,ORIFN,8,ORX),-1) Q:ORX'>0  I $D(^(ORX,0)),$P(^(0),U,15)="" Q  ;ORX=last released action
"RTN","ORMPS2",107,0)
 S:ORX $P(^OR(100,ORIFN,8,ORX,0),U,15)=12 ;dc/edit
"RTN","ORMPS2",108,0)
 S $P(^OR(100,ORIFN,3),U,7)=ORDA,NEWSTS=$S('$G(ORSTS):0,ORSTS=$P(^(3),U,3):0,1:1) K ^(6)
"RTN","ORMPS2",109,0)
 D STATUS^ORCSAVE2(ORIFN,ORSTS):NEWSTS,SETALL^ORDD100(ORIFN):'NEWSTS
"RTN","ORMPS2",110,0)
 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS2",111,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,ORWHO,ORNATR)
"RTN","ORMPS2",112,0)
 ; -If unsigned edit, leave XX unsigned & mark ORX as Sig Not Req'd
"RTN","ORMPS2",113,0)
 S ORSIG=$S($P($G(^OR(100,ORIFN,8,ORX,0)),U,4)'=2:1,1:0)
"RTN","ORMPS2",114,0)
 D SIGSTS^ORCSAVE2(ORIFN,ORDA):ORSIG,SIGN^ORCSAVE2(ORIFN,,,5,ORX):'ORSIG
"RTN","ORMPS2",115,0)
RO2 ; -Update responses, get/save new order text:
"RTN","ORMPS2",116,0)
 K ^OR(100,ORIFN,4.5) D RESPONSE^ORCSAVE,ORDTEXT^ORCSAVE1(ORIFN_";"_ORDA)
"RTN","ORMPS2",117,0)
 S $P(^OR(100,ORIFN,0),U,5)=ORDIALOG_";ORD(101.41,",$P(^(0),U,14)=ORPKG
"RTN","ORMPS2",118,0)
 I $P(^OR(100,ORIFN,0),U,11)'=ORDG D  ;update DG,xrefs
"RTN","ORMPS2",119,0)
 . N DA,DR,DIE
"RTN","ORMPS2",120,0)
 . S DA=ORIFN,DR="23////"_ORDG,DIE="^OR(100," D ^DIE
"RTN","ORMPS2",121,0)
 S ^OR(100,ORIFN,4)=PKGIFN,$P(^(8,ORDA,0),U,14)=ORDA
"RTN","ORMPS2",122,0)
 S ORIFN=ORIFN_";"_ORDA,ORDCNTRL="SN" ;to send NA msg back
"RTN","ORMPS2",123,0)
 I $G(ORL) S ORP(1)=ORIFN_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMPS2",124,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS1 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,+ORIFN,5)=$TR($P(ZSC,"|",2,7),"|","^") ;1 or 0 instead of [N]SC in #100
"RTN","ORMPS2",125,0)
 Q
"RTN","ORMPS2",126,0)
IVLIM(IVDUR)    ;
"RTN","ORMPS2",127,0)
 I $L(IVDUR) D
"RTN","ORMPS2",128,0)
 . N DURU,DURV S DURU="",DURV=0
"RTN","ORMPS2",129,0)
 . S DURU=$E(IVDUR,1),DURV=$E(IVDUR,2,$L(IVDUR))
"RTN","ORMPS2",130,0)
 . I (DURU="D")!(DURU="d") S IVDUR="for "_+DURV_$S(+DURV=1:" day",+DURV>1:" days",1:" day")
"RTN","ORMPS2",131,0)
 . I (DURU="H")!(DURU="h") S IVDUR="for "_+DURV_$S(+DURV=1:" hours",+DURV>1:" hours",1:" hour")
"RTN","ORMPS2",132,0)
 . I (DURU="M")!(DURU="m") S IVDUR="with total volume "_+DURV_" ml"
"RTN","ORMPS2",133,0)
 . I (DURU="L")!(DURU="l") S IVDUR="with total volume "_+DURV_" L"
"RTN","ORMPS2",134,0)
 Q IVDUR
"RTN","ORMRA")
0^48^B56841321
"RTN","ORMRA",1,0)
ORMRA ; SLC/MKB - Process Radiology ORM msgs ;2/21/02  15:44 [3/4/04 10:43am]
"RTN","ORMRA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,53,92,110,136,153,174,195**;Dec 17, 1997
"RTN","ORMRA",3,0)
 ;DBIA 2968 allows for reading ^DIC(34
"RTN","ORMRA",4,0)
EN ; -- entry point for RA messages
"RTN","ORMRA",5,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMRA",6,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZP",'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMRA",7,0)
 S OREASON=$S($P(OREASON,U,6)="99RAR":$P(OREASON,U,5),1:$P(OREASON,U,2))
"RTN","ORMRA",8,0)
 S:'ORDUZ ORDUZ=DUZ S:'ORLOG ORLOG=+$E($$NOW^XLFDT,1,12)
"RTN","ORMRA",9,0)
 D @ORDCNTRL
"RTN","ORMRA",10,0)
 Q
"RTN","ORMRA",11,0)
 ;
"RTN","ORMRA",12,0)
ZP ; -- Purged
"RTN","ORMRA",13,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))  K ^OR(100,+ORIFN,4)
"RTN","ORMRA",14,0)
 ; - Set status=lapsed, if still active
"RTN","ORMRA",15,0)
 I "^3^5^6^8^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(ORIFN,14)
"RTN","ORMRA",16,0)
 Q
"RTN","ORMRA",17,0)
 ;
"RTN","ORMRA",18,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMRA",19,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMRA",20,0)
 Q
"RTN","ORMRA",21,0)
 ;
"RTN","ORMRA",22,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMRA",23,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; update Last Activity
"RTN","ORMRA",24,0)
 Q
"RTN","ORMRA",25,0)
 ;
"RTN","ORMRA",26,0)
OK ; -- Order accepted, RA order # assigned [ack]
"RTN","ORMRA",27,0)
 N ORSTS,OBR S ^OR(100,+ORIFN,4)=PKGIFN,ORSTS=5 ; 5=pending
"RTN","ORMRA",28,0)
 ; Ck if also scheduled, else quit
"RTN","ORMRA",29,0)
 S OBR=$O(@ORMSG@(+ORC)) G:'OBR OKQ G:$E(@ORMSG@(OBR),1,3)'="OBR" OKQ
"RTN","ORMRA",30,0)
 S ORSTRT=$$FMDATE^ORM($P(@ORMSG@(OBR),"|",37))
"RTN","ORMRA",31,0)
 D:ORSTRT DATES^ORCSAVE2(+ORIFN,ORSTRT)
"RTN","ORMRA",32,0)
OKQ D STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMRA",33,0)
 Q
"RTN","ORMRA",34,0)
 ;
"RTN","ORMRA",35,0)
XX ; -- Change order
"RTN","ORMRA",36,0)
 N ORDIALOG,ORDG,ORDA,ORX,ORP S:'$L(ORNATR) ORNATR="S"
"RTN","ORMRA",37,0)
 D DLG Q:$D(ORERR)  Q:'$D(ORDIALOG)  S ORIFN=+ORIFN
"RTN","ORMRA",38,0)
 S ORDA=$$ACTION^ORCSAVE("XX",ORIFN,ORNP,OREASON,ORLOG,ORDUZ)
"RTN","ORMRA",39,0)
 I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMRA",40,0)
 ; -Update sts of order to active, last action to dc/edit:
"RTN","ORMRA",41,0)
 S ORX=+$P($G(^OR(100,ORIFN,3)),U,7)
"RTN","ORMRA",42,0)
 S:$P($G(^OR(100,ORIFN,8,ORX,0)),U,15)="" $P(^(0),U,15)=12
"RTN","ORMRA",43,0)
 S $P(^OR(100,ORIFN,3),U,7)=ORDA D STATUS^ORCSAVE2(ORIFN,6)
"RTN","ORMRA",44,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMRA",45,0)
 ; -If unsigned edit, leave XX unsigned & mark ORX as Sig Not Req'd
"RTN","ORMRA",46,0)
 S ORSIG=$S($P($G(^OR(100,ORIFN,8,ORX,0)),U,4)'=2:1,1:0)
"RTN","ORMRA",47,0)
 D SIGSTS^ORCSAVE2(ORIFN,ORDA):ORSIG,SIGN^ORCSAVE2(ORIFN,,,5,ORX):'ORSIG
"RTN","ORMRA",48,0)
 ; -Update responses, get/save new order text:
"RTN","ORMRA",49,0)
 K ^OR(100,ORIFN,4.5) D RESPONSE^ORCSAVE,ORDTEXT^ORCSAVE1(ORIFN_";"_ORDA)
"RTN","ORMRA",50,0)
 S $P(^OR(100,ORIFN,8,ORDA,0),U,14)=ORDA
"RTN","ORMRA",51,0)
 I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMRA",52,0)
 Q
"RTN","ORMRA",53,0)
 ;
"RTN","ORMRA",54,0)
SN ; -- New backdoor order: return NA msg w/ORIFN, or DE msg
"RTN","ORMRA",55,0)
 N ORDIALOG,ORDG,ORP K ^TMP("ORWORD",$J) S:'$L(ORNATR) ORNATR="W"
"RTN","ORMRA",56,0)
 I ORDUZ,'$D(^VA(200,ORDUZ,0)) S ORERR="Invalid entering person" Q
"RTN","ORMRA",57,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMRA",58,0)
 I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMRA",59,0)
 D DLG Q:$D(ORERR)  Q:'$D(ORDIALOG)
"RTN","ORMRA",60,0)
SNQ D EN^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMRA",61,0)
 I '$G(ORIFN) S ORERR="Cannot create new order" Q
"RTN","ORMRA",62,0)
 ;Save DG1 and ZCL segments of HL7 message from backdoor orders
"RTN","ORMRA",63,0)
 D BDOSTR^ORWDBA3
"RTN","ORMRA",64,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR),SIGSTS^ORCSAVE2(ORIFN,1)
"RTN","ORMRA",65,0)
 D STATUS^ORCSAVE2(ORIFN,5) S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMRA",66,0)
 I $G(ORL) S ORP(1)=ORIFN_";1^1" D PRINTS^ORWD1(.ORP,+ORL) ; chart copy
"RTN","ORMRA",67,0)
 Q
"RTN","ORMRA",68,0)
 ;
"RTN","ORMRA",69,0)
DLG ; -- Build ORDIALOG() from msg
"RTN","ORMRA",70,0)
 N OBR,OI,MODS,J,X,Y,ILOC,MODE,CH,CHI,OBX,NTE
"RTN","ORMRA",71,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","RA OERR EXAM",0))
"RTN","ORMRA",72,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMRA",73,0)
 S ORDIALOG($$PTR("CATEGORY"),1)=$G(ORCAT)
"RTN","ORMRA",74,0)
 S ORDIALOG($$PTR("START DATE/TIME"),1)=ORSTRT
"RTN","ORMRA",75,0)
 S ORDIALOG($$PTR("URGENCY"),1)=ORURG
"RTN","ORMRA",76,0)
 S:$P(ORC,"|",12) ORDIALOG($$PTR("PROVIDER"),1)=+$P(ORC,"|",12)
"RTN","ORMRA",77,0)
D1 S OBR=$O(@ORMSG@(+ORC)) I 'OBR!($E($G(@ORMSG@(OBR)),1,3)'="OBR") S ORERR="Missing OBR segment" Q
"RTN","ORMRA",78,0)
 S OI=$$ORDITEM^ORM($P(@ORMSG@(OBR),"|",5))
"RTN","ORMRA",79,0)
 I 'OI S ORERR="Invalid procedure" Q
"RTN","ORMRA",80,0)
 S ORDIALOG($$PTR("ORDERABLE ITEM"),1)=OI
"RTN","ORMRA",81,0)
 S ORDG=$P($G(^ORD(101.43,+OI,"RA")),U,3) S:$L(ORDG) ORDG=+$O(^ORD(100.98,"B",ORDG,0)) I 'ORDG S ORDG=$P(^ORD(101.41,+ORDIALOG,0),U,5) ; Im Type
"RTN","ORMRA",82,0)
 S MODS=$P(@ORMSG@(OBR),"|",19) I $L(MODS) D
"RTN","ORMRA",83,0)
 . F J=1:1:$L(MODS,"~") S X=$P(MODS,"~",J) I $L(X) S Y=$O(^RAMIS(71.2,"B",X,0)) S:Y ORDIALOG($$PTR("MODIFIERS"),J)=Y
"RTN","ORMRA",84,0)
 S ILOC=+$P(@ORMSG@(OBR),"|",20),MODE=$P(@ORMSG@(OBR),"|",31)
"RTN","ORMRA",85,0)
 S:ILOC ORDIALOG($$PTR("IMAGING LOCATION"),1)=ILOC
"RTN","ORMRA",86,0)
 S ORDIALOG($$PTR("MODE OF TRANSPORT"),1)=$S(MODE="WALK":"A",MODE="CART":"S",1:$E(MODE))
"RTN","ORMRA",87,0)
 I ORDCNTRL="XX" S NTE=+$O(@ORMSG@(OBR)) I NTE,$E($G(@ORMSG@(NTE)),1,3)="NTE" S OREASON=$P(@ORMSG@(NTE),"|",4) ;Tech's Comments
"RTN","ORMRA",88,0)
D2 ; might the procedure be scheduled at this point ??  Not in spec
"RTN","ORMRA",89,0)
 S CH=$$PTR("WORD PROCESSING 1"),CHI=0
"RTN","ORMRA",90,0)
 S OBX=OBR F  S OBX=$O(@ORMSG@(OBX)) Q:OBX'>0  S J=$E(@ORMSG@(OBX),1,3) Q:J="ORC"  Q:J="MSH"  I J="OBX" D
"RTN","ORMRA",91,0)
 . N NAME,VALUE,X0 S VALUE=$P(@ORMSG@(OBX),"|",6)
"RTN","ORMRA",92,0)
 . S NAME=$$UP^XLFSTR($P($P(@ORMSG@(OBX),"|",4),U,2))
"RTN","ORMRA",93,0)
 . I NAME="CONTRACT/SHARING SOURCE" S X0=$G(^DIC(34,+VALUE,0)) S:$L(X0) ORDIALOG($$PTR(NAME),1)=+VALUE,ORDIALOG($$PTR("CATEGORY"),1)=$P(X0,U,2) Q
"RTN","ORMRA",94,0)
 . I NAME="RESEARCH SOURCE" S ORDIALOG($$PTR(NAME),1)=VALUE,ORDIALOG($$PTR("CATEGORY"),1)="R" Q
"RTN","ORMRA",95,0)
 . I NAME="PREGNANT" S ORDIALOG($$PTR(NAME),1)=VALUE Q
"RTN","ORMRA",96,0)
 . I NAME="PRE-OP SCHEDULED DATE/TIME" S ORDIALOG($$PTR(NAME),1)=$$FMDATE^ORM(VALUE) Q
"RTN","ORMRA",97,0)
 . S CHI=CHI+1,^TMP("ORWORD",$J,CH,1,CHI,0)=VALUE
"RTN","ORMRA",98,0)
 S:CHI ^TMP("ORWORD",$J,CH,1,0)="^^"_CHI_U_CHI_U_DT_U,ORDIALOG(CH,1)="^TMP(""ORWORD"",$J,"_CH_",1)"
"RTN","ORMRA",99,0)
 Q
"RTN","ORMRA",100,0)
 ;
"RTN","ORMRA",101,0)
PTR(X) ; -- Returns ptr to prompt in Order Dialog file #101.41
"RTN","ORMRA",102,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_X,1,63),0))
"RTN","ORMRA",103,0)
 ;
"RTN","ORMRA",104,0)
SC ; -- Status changed (scheduled, registered, or unverified)
"RTN","ORMRA",105,0)
 N ORSTS,OBR,OR3 ;110
"RTN","ORMRA",106,0)
 S ORSTS=$S(ORDSTS="ZR":6,ORDSTS="ZU":6,1:8),OR3=$G(^OR(100,+ORIFN,3)) ;110
"RTN","ORMRA",107,0)
 G:ORSTS=6 SCQ ;136  Done if active, else get scheduled data
"RTN","ORMRA",108,0)
 S OBR=$O(@ORMSG@(+ORC)) I 'OBR!($E($G(@ORMSG@(OBR)),1,3)'="OBR") S ORERR="Missing OBR segment" Q
"RTN","ORMRA",109,0)
 S ORSTRT=$$FMDATE^ORM($P(@ORMSG@(OBR),"|",37))
"RTN","ORMRA",110,0)
 D:ORSTRT DATES^ORCSAVE2(+ORIFN,ORSTRT)
"RTN","ORMRA",111,0)
 I $P(OR3,U,3)=3,$P($G(^OR(100,+ORIFN,8,+$P(OR3,U,7),0)),U,2)="HD" D RL ;If status is hold and current action is hold then release.  Added with 110
"RTN","ORMRA",112,0)
SCQ D STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMRA",113,0)
 Q
"RTN","ORMRA",114,0)
 ;
"RTN","ORMRA",115,0)
RE ; -- Completed, w/results
"RTN","ORMRA",116,0)
 N I,SEG,OBX
"RTN","ORMRA",117,0)
 D STATUS^ORCSAVE2(ORIFN,2)
"RTN","ORMRA",118,0)
 S OBX="" D  ;get Results D/T [from OBR]
"RTN","ORMRA",119,0)
 . N DA,DR,DIE,X,Y,OBR
"RTN","ORMRA",120,0)
 . S DA=+ORIFN,DIE="^OR(100,",OBR=+$O(@ORMSG@(+ORC)),X=""
"RTN","ORMRA",121,0)
 . I OBR,$E($G(@ORMSG@(OBR)),1,3)="OBR" S X=$P(@ORMSG@(OBR),"|",23)
"RTN","ORMRA",122,0)
 . S DR="71////"_$S(X:$$FMDATE^ORM(X),1:+$E($$NOW^XLFDT,1,12)) D ^DIE
"RTN","ORMRA",123,0)
 S I=+ORC F  S I=$O(@ORMSG@(I)) Q:I<1  S SEG=$G(@ORMSG@(I)) Q:$E(SEG,1,3)="ORC"  I $E(SEG,1,3)="OBX" S OBX=I_U_SEG Q  ;first one
"RTN","ORMRA",124,0)
 S $P(^OR(100,+ORIFN,7),U,2)=$S($P(OBX,"|",9)="A":1,1:"")
"RTN","ORMRA",125,0)
 S:'$G(ORNP) ORNP=+$P($G(^OR(100,+ORIFN,0)),U,4)
"RTN","ORMRA",126,0)
 I $L($T(ADD^ORRCACK)) D ADD^ORRCACK(+ORIFN,ORNP) ;Ack stub for prov
"RTN","ORMRA",127,0)
 Q
"RTN","ORMRA",128,0)
 ;
"RTN","ORMRA",129,0)
OH ; -- Held
"RTN","ORMRA",130,0)
 D UPDATE(3,"HD")
"RTN","ORMRA",131,0)
 Q
"RTN","ORMRA",132,0)
 ;
"RTN","ORMRA",133,0)
OC ; -- Cancelled/Unable to accept [ack]
"RTN","ORMRA",134,0)
UA ; -- Unable to accept [ack]
"RTN","ORMRA",135,0)
 S:'$L(ORNATR) ORNATR="X" ;Rejected
"RTN","ORMRA",136,0)
 S ^OR(100,+ORIFN,6)=$O(^ORD(100.02,"C",ORNATR,0))_U_U_ORLOG_U_U_OREASON
"RTN","ORMRA",137,0)
 D STATUS^ORCSAVE2(ORIFN,13)
"RTN","ORMRA",138,0)
UD ; -- Unable to discontinue [ack]
"RTN","ORMRA",139,0)
 N DA S DA=+$P(ORIFN,";",2) I DA D
"RTN","ORMRA",140,0)
 . S $P(^OR(100,+ORIFN,8,DA,0),U,15)=13 ;Request rejected
"RTN","ORMRA",141,0)
 . S:$L(OREASON) ^OR(100,+ORIFN,8,DA,1)=OREASON
"RTN","ORMRA",142,0)
 Q
"RTN","ORMRA",143,0)
 ;
"RTN","ORMRA",144,0)
OD ; -- Discontinued
"RTN","ORMRA",145,0)
 S:$G(DGPMT) ORDUZ="" ;auto-dc on movement
"RTN","ORMRA",146,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORDUZ_U_ORLOG_U_U_OREASON
"RTN","ORMRA",147,0)
 D UPDATE(1,"DC")
"RTN","ORMRA",148,0)
 Q
"RTN","ORMRA",149,0)
 ;
"RTN","ORMRA",150,0)
DR ; -- Discontinued [ack]
"RTN","ORMRA",151,0)
 D STATUS^ORCSAVE2(ORIFN,1)
"RTN","ORMRA",152,0)
 Q
"RTN","ORMRA",153,0)
 ;
"RTN","ORMRA",154,0)
UPDATE(ORSTS,ORACT) ; -- continue processing
"RTN","ORMRA",155,0)
 N ORX,ORDA,ORP D:$G(ORSTS) STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMRA",156,0)
 S ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMRA",157,0)
 . S ORDA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,OREASON,ORLOG,ORDUZ)
"RTN","ORMRA",158,0)
 . I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMRA",159,0)
 . D RELEASE^ORCSAVE2(+ORIFN,ORDA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMRA",160,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,ORDA)
"RTN","ORMRA",161,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMRA",162,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=ORDA
"RTN","ORMRA",163,0)
 I 'ORX D  ;no new action created
"RTN","ORMRA",164,0)
 . I ORACT="DC" S:'$$ACTV^ORX1(ORNATR) $P(^OR(100,+ORIFN,3),U,7)=0 Q
"RTN","ORMRA",165,0)
 . S:ORACT="HD"&$L(OREASON) ^OR(100,+ORIFN,8,1,1)=OREASON ;pend/sch only
"RTN","ORMRA",166,0)
 D:ORACT="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMRA",167,0)
 Q
"RTN","ORMRA",168,0)
 ;
"RTN","ORMRA",169,0)
RL ;Release hold --entire section added with patch 110
"RTN","ORMRA",170,0)
 S ^OR(100,+ORIFN,8,$P(OR3,U,7),2)=ORLOG_"^"_ORDUZ  ;Set release hold date/time and release hold user
"RTN","ORMRA",171,0)
 S ORNATR=$S($L(ORNATR):ORNATR,1:$P(^OR(100,+ORIFN,8,$P(OR3,U,7),0),U,12)) ;set nature of order for release equal to nature of order for hold if it doesn't exist
"RTN","ORMRA",172,0)
 I $G(ORSTS)="" S ORSTS=6
"RTN","ORMRA",173,0)
 D UPDATE(ORSTS,"RL")
"RTN","ORMRA",174,0)
 Q
"RTN","ORQ11")
0^67^B58490092
"RTN","ORQ11",1,0)
ORQ11 ;slc/dcm-Get patient orders in context ;3/31/04  09:57
"RTN","ORQ11",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,27,48,72,78,99,94,148,141,177,186,190,195**;Dec 17, 1997
"RTN","ORQ11",3,0)
LOOP ; -- main loop through "ACT" x-ref
"RTN","ORQ11",4,0)
 I $G(XREF)="AW" D AW Q
"RTN","ORQ11",5,0)
 I $G(FLG)=27 D EXPD^ORQ12 Q
"RTN","ORQ11",6,0)
 K ^TMP("ORGOTIT",$J)
"RTN","ORQ11",7,0)
AWIN ;Jump in here to add active orders to AW context
"RTN","ORQ11",8,0)
 N TM,TO,IFN,X0,X3,X7,X8,USTS,NOW,ACTOR,X ;195
"RTN","ORQ11",9,0)
 S NOW=+$E($$NOW^XLFDT,1,12),TM=SDATE
"RTN","ORQ11",10,0)
 F  S TM=$O(^OR(100,"ACT",PAT,TM)) Q:'TM!(TM>EDATE)  S TO=0 F  S TO=$O(^OR(100,"ACT",PAT,TM,TO)) Q:'TO  I $D(ORGRP(TO)) D
"RTN","ORQ11",11,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"ACT",PAT,TM,TO,IFN)) Q:'IFN  I ('$D(^TMP("ORGOTIT",$J,IFN))!MULT),$D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D
"RTN","ORQ11",12,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"ACT",PAT,TM,TO,IFN,ACTOR)) Q:ACTOR<1  I '$D(^TMP("ORGOTIT",$J,IFN,ACTOR)),$D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13!(FLG=1) S X8=^(0),X7=$G(^(7)) D LP1
"RTN","ORQ11",13,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",14,0)
 Q
"RTN","ORQ11",15,0)
AW ; -- loop through "AW" x-ref
"RTN","ORQ11",16,0)
 K ^TMP("ORGOTIT",$J),^TMP("ORSORT",$J)
"RTN","ORQ11",17,0)
 N TM,TO,IFN,X0,X3,X7,X8,USTS,NOW,ACTOR,X ;195
"RTN","ORQ11",18,0)
 S NOW=+$E($$NOW^XLFDT,1,12),TO=0,SDATE=9999999-SDATE,EDATE=9999999-EDATE
"RTN","ORQ11",19,0)
 F  S TO=$O(^OR(100,"AW",PAT,TO)) Q:'TO  I $D(ORGRP(TO)) S TM=EDATE F  S TM=$O(^OR(100,"AW",PAT,TO,TM)) Q:'TM!(TM>SDATE)!(+TM<EDATE)  D
"RTN","ORQ11",20,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AW",PAT,TO,TM,IFN)) Q:'IFN  I ('$D(^TMP("ORGOTIT",$J,IFN))!MULT) D
"RTN","ORQ11",21,0)
 .. S ^TMP("ORSORT",$J,9999999-TM,TO,IFN)=""
"RTN","ORQ11",22,0)
 S TM=0 F  S TM=$O(^TMP("ORSORT",$J,TM)) Q:'TM  S TO=0 F  S TO=$O(^TMP("ORSORT",$J,TM,TO)) Q:'TO  D
"RTN","ORQ11",23,0)
 . S IFN=0 F  S IFN=$O(^TMP("ORSORT",$J,TM,TO,IFN)) Q:'IFN  I $D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D 
"RTN","ORQ11",24,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"ACT",PAT,9999999-$P(X0,U,7),TO,IFN,ACTOR)) Q:ACTOR<1  I '$D(^TMP("ORGOTIT",$J,IFN,ACTOR)),$D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13 S X8=^(0),X7=$G(^(7)) D LP1
"RTN","ORQ11",25,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",26,0)
 I +$$GET^XPAR("SYS","OR ORDER SUMMARY CONTEXT",1,"I")=2 S SDATE=9999999-SDATE,EDATE=9999999-EDATE D AWIN
"RTN","ORQ11",27,0)
 K ^TMP("ORSORT",$J),^TMP("ORGOTIT",$J)
"RTN","ORQ11",28,0)
 Q
"RTN","ORQ11",29,0)
LP1 ; -- main secondary loop
"RTN","ORQ11",30,0)
 N STS ;195
"RTN","ORQ11",31,0)
 Q:$P(X3,U,8)  Q:$P(X3,U,3)=99  S STS=$P(X3,U,3)
"RTN","ORQ11",32,0)
 I '$G(GETKID),$P(X3,U,9),'$P($G(^OR(100,$P(X3,U,9),3)),U,8),FLG'=11 Q
"RTN","ORQ11",33,0)
 I $L($P(X0,U,17)),"^10^11^"[(U_STS_U) S X=$$LAPSED^OREVNTX($P(X0,U,17))
"RTN","ORQ11",34,0)
 D @($S(FLG=2:"CUR1",FLG=3:"DC1",FLG=4:"COM1",FLG=5:"EXG1",FLG=7:"PEN1",FLG=8:"UVR1",FLG=9:"UVN1",FLG=10:"UVC1",FLG=12:"FLG1",FLG=13:"VP1",FLG=14:"VPU1",FLG=18:"HLD1",FLG=20:"CHT1",FLG=21:"CHTSUM",FLG=22:"LPS1",FLG=23:"AVT1",1:"ALL1"))
"RTN","ORQ11",35,0)
 Q
"RTN","ORQ11",36,0)
 ; ** FLG context specific loops:
"RTN","ORQ11",37,0)
 ;
"RTN","ORQ11",38,0)
ALL1 ; 1 -- secondary pass for All, Recent Orders, Unsigned
"RTN","ORQ11",39,0)
 D GET^ORQ12(IFN,ORLIST,DETAIL,$G(ACTOR))
"RTN","ORQ11",40,0)
 Q
"RTN","ORQ11",41,0)
 ;
"RTN","ORQ11",42,0)
CUR ; 2 -- Active/Current
"RTN","ORQ11",43,0)
 N X,X0,X1,X2,X3,%H,YD,%,TM,IFN,ACTOR
"RTN","ORQ11",44,0)
 I $G(GROUP)=$O(^ORD(100.98,"B","ALL SERVICES",0)),$G(ORWARD),$G(DGPMT)'=1 S X=$O(^ORD(100.98,"B","O RX",0)) K:X ORGRP(X) ; 177 screen out Outpt Meds if inpt
"RTN","ORQ11",45,0)
 S X2=+$$GET^XPAR("SYS","ORPF ACTIVE ORDERS CONTEXT HRS",1,"I"),X=$H,X=+X*24+($P(X,",",2)/3600),X1=X-X2,X3=X1#24,X1=X1\24,X2=$J(X3*3600,0,0),%H=X1_","_X2 D YMD^%DTC S YD=+(X_%)
"RTN","ORQ11",46,0)
 S TM=SDATE F  S TM=$O(^OR(100,"AC",PAT,TM)) Q:TM<1!(TM>EDATE)  S IFN=0 F  S IFN=$O(^OR(100,"AC",PAT,TM,IFN)) Q:IFN<1  I $D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D
"RTN","ORQ11",47,0)
 . Q:'$D(ORGRP($P(X0,U,11)))  S ACTOR=0
"RTN","ORQ11",48,0)
 . F  S ACTOR=$O(^OR(100,"AC",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  I $D(^OR(100,IFN,8,ACTOR,0)) S X=^(0) D
"RTN","ORQ11",49,0)
 .. I "^10^12^"[(U_$P(X,U,15)_U) K ^OR(100,"AC",PAT,TM,IFN,ACTOR) Q
"RTN","ORQ11",50,0)
 .. I $P(X,U,15)=13,$P(X,U)<YD K ^OR(100,"AC",PAT,TM,IFN,ACTOR) Q
"RTN","ORQ11",51,0)
 .. I $P(X,U,15)="",ACTOR'=$P(X3,U,7) K ^OR(100,"AC",PAT,TM,IFN,ACTOR) Q
"RTN","ORQ11",52,0)
 .. D LP1
"RTN","ORQ11",53,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",54,0)
 Q
"RTN","ORQ11",55,0)
CUR1 ; 2 -- secondary pass for Active/Current
"RTN","ORQ11",56,0)
 N STOP S STOP=$P(X0,U,9)
"RTN","ORQ11",57,0)
 I STS=10 K ^OR(100,"AC",PAT,TM,IFN) Q  ;no delayed orders
"RTN","ORQ11",58,0)
 I '$D(YD),"^1^2^7^12^13^14^"[(U_STS_U) K ^OR(100,"AC",PAT,TM,IFN) Q
"RTN","ORQ11",59,0)
 I $D(YD),"^1^2^7^12^13^14^"[(U_STS_U),STOP<YD K ^OR(100,"AC",PAT,TM,IFN) Q
"RTN","ORQ11",60,0)
 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",61,0)
 Q
"RTN","ORQ11",62,0)
 ;
"RTN","ORQ11",63,0)
DC1 ; 3 -- secondary pass for DC
"RTN","ORQ11",64,0)
 I STS=1!(STS=13)!(STS=12) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",65,0)
 Q
"RTN","ORQ11",66,0)
 ;
"RTN","ORQ11",67,0)
COM1 ; 4 -- secondary pass for Completed/Expired
"RTN","ORQ11",68,0)
 N STOP S STOP=$P(X0,U,9)
"RTN","ORQ11",69,0)
 I STS=2!(STS=7)!($L(STOP)&(STOP<NOW)&(STS'=1)&(STS'=13)&(STS'=12)) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",70,0)
 Q
"RTN","ORQ11",71,0)
 ;
"RTN","ORQ11",72,0)
EXG ; 5 -- Expiring
"RTN","ORQ11",73,0)
 N ORNG,ORDT,ORDW,ORHOL,X,Y,%DT,DIC,TMW,NOW ;195
"RTN","ORQ11",74,0)
 F ORNG=1:1 D  I ORHOL=0,ORDW=0 Q
"RTN","ORQ11",75,0)
 . S ORDT=$$FMADD^XLFDT(DT,ORNG),ORDW=$S($H-4+ORNG#7>4:1,1:0)
"RTN","ORQ11",76,0)
 . S DIC="^HOLIDAY(",X=$P(ORDT,".")
"RTN","ORQ11",77,0)
 . D ^DIC S ORHOL=$S(+$G(Y)>0:1,1:0)
"RTN","ORQ11",78,0)
 S %DT="",X="T+"_ORNG D ^%DT
"RTN","ORQ11",79,0)
 S TMW=Y_".9999",NOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORQ11",80,0)
 D CUR ;D LOOP
"RTN","ORQ11",81,0)
 Q
"RTN","ORQ11",82,0)
EXG1 ; 5 -- secondary pass for Expiring
"RTN","ORQ11",83,0)
 N STOP S STOP=$P(X0,U,9)
"RTN","ORQ11",84,0)
 I STS'=1,STS'=2,STS'=7,STS'>9,STOP>NOW,STOP'>TMW D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",85,0)
 Q
"RTN","ORQ11",86,0)
 ;
"RTN","ORQ11",87,0)
ACT ; 6 -- Recent Activity (Order Summary)
"RTN","ORQ11",88,0)
 ;N ORLSIGN S ORLSIGN=$$GET^XPAR("ALL","OR ORDER REVIEW DT","`"_+PAT,"Q")
"RTN","ORQ11",89,0)
 N TM,IFN,X0,X3,ACTOR,X8
"RTN","ORQ11",90,0)
 S TM=SDATE F  S TM=$O(^OR(100,"AR",PAT,TM)) Q:TM<1!(TM>EDATE)  D
"RTN","ORQ11",91,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AR",PAT,TM,IFN)) Q:IFN<1  S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)) I $D(ORGRP(+$P(X0,U,11))) D
"RTN","ORQ11",92,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"AR",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  I $D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13 S X8=^(0) D LP1
"RTN","ORQ11",93,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",94,0)
 Q
"RTN","ORQ11",95,0)
 ;
"RTN","ORQ11",96,0)
PEN1 ; 7 -- secondary pass for Pending
"RTN","ORQ11",97,0)
 I STS=5 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",98,0)
 Q
"RTN","ORQ11",99,0)
 ;
"RTN","ORQ11",100,0)
UVR1 ; 8 -- secondary pass for Unverified
"RTN","ORQ11",101,0)
 ;      Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",102,0)
 I '$P(X8,U,9),'$P(X8,U,11),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",103,0)
 Q
"RTN","ORQ11",104,0)
 ;
"RTN","ORQ11",105,0)
UVN1 ; 9 -- secondary pass for Unverified/Nurse
"RTN","ORQ11",106,0)
 ;      Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",107,0)
 I '$P(X8,U,9),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",108,0)
 Q
"RTN","ORQ11",109,0)
 ;
"RTN","ORQ11",110,0)
UVC1 ; 10 -- secondary pass for Unverified/Clerk
"RTN","ORQ11",111,0)
 ;       Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",112,0)
 I '$P(X8,U,11),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",113,0)
 Q
"RTN","ORQ11",114,0)
 ;
"RTN","ORQ11",115,0)
INPT() ; -- Returns 1 or 0, if inpt order using X0=^OR(100,IFN,0)
"RTN","ORQ11",116,0)
 I ($P(X0,U,12)="I")!($P(X0,U,17)="D") Q 1
"RTN","ORQ11",117,0)
 I $P($G(^SC(+$P(X0,U,10),0)),U,3)="W" Q 1
"RTN","ORQ11",118,0)
 Q 0
"RTN","ORQ11",119,0)
 ;
"RTN","ORQ11",120,0)
SIG ; 11 -- Unsigned
"RTN","ORQ11",121,0)
 N TM,IFN,X0,X3,ACTOR S TM=SDATE
"RTN","ORQ11",122,0)
 F  S TM=$O(^OR(100,"AS",PAT,TM)) Q:TM<1!(TM>EDATE)  S IFN=0 F  S IFN=$O(^OR(100,"AS",PAT,TM,IFN)) Q:IFN<1  D
"RTN","ORQ11",123,0)
 . S X0=$G(^OR(100,IFN,0)),X3=$G(^(3))
"RTN","ORQ11",124,0)
 . I X0="" K ^OR(100,"AS",PAT,TM,IFN) Q  ;deleted
"RTN","ORQ11",125,0)
 . Q:'$D(ORGRP(+$P(X0,U,11)))  ;not a selected DispGrp
"RTN","ORQ11",126,0)
 . S ACTOR=0 F  S ACTOR=$O(^OR(100,"AS",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  D
"RTN","ORQ11",127,0)
 .. I $P($G(^OR(100,IFN,8,ACTOR,0)),U,4)'=2 K ^OR(100,"AS",PAT,TM,IFN,ACTOR) Q  ;signed or deleted
"RTN","ORQ11",128,0)
 .. D LP1
"RTN","ORQ11",129,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",130,0)
 Q
"RTN","ORQ11",131,0)
 ;
"RTN","ORQ11",132,0)
FLG1 ; 12 -- secondary pass for Flagged
"RTN","ORQ11",133,0)
 I +$G(^OR(100,IFN,8,ACTOR,3)) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",134,0)
 Q
"RTN","ORQ11",135,0)
 ;
"RTN","ORQ11",136,0)
VP1 ; 13 -- secondary pass for Verbal/Phone
"RTN","ORQ11",137,0)
 N ORNATR S ORNATR=$P(X8,U,12)
"RTN","ORQ11",138,0)
 I ORNATR,"PV"[$P($G(^ORD(100.02,+ORNATR,0)),U,2) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) ;STS'=12
"RTN","ORQ11",139,0)
 Q
"RTN","ORQ11",140,0)
 ;
"RTN","ORQ11",141,0)
VPU1 ; 14 -- secondary pass for Verbal/Phone Unsigned
"RTN","ORQ11",142,0)
 N ORNATR S ORNATR=$P(X8,U,12)
"RTN","ORQ11",143,0)
 I ORNATR,"PV"[$P($G(^ORD(100.02,+ORNATR,0)),U,2),'$P(X8,U,5),$P(X8,U,4)=2 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) ;STS'=12
"RTN","ORQ11",144,0)
 Q
"RTN","ORQ11",145,0)
 ;
"RTN","ORQ11",146,0)
HLD1 ; 18 -- secondary pass for On Hold
"RTN","ORQ11",147,0)
 I STS=3 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",148,0)
 Q
"RTN","ORQ11",149,0)
 ;
"RTN","ORQ11",150,0)
NEW ; 19 -- New Orders, plus other unsigned orders by current provider
"RTN","ORQ11",151,0)
 N IFN,ACTOR,TM,X0,X3,X8,ORENT,ORPAR
"RTN","ORQ11",152,0)
 S IFN=0 F  S IFN=$O(^TMP("ORNEW",$J,IFN)) Q:IFN'>0  D  ;New orders
"RTN","ORQ11",153,0)
 . S ACTOR=0 F  S ACTOR=$O(^TMP("ORNEW",$J,IFN,ACTOR)) Q:ACTOR'>0  D
"RTN","ORQ11",154,0)
 .. Q:'$D(^OR(100,IFN,0))  Q:'$D(^(8,ACTOR,0))  ;deleted
"RTN","ORQ11",155,0)
 .. D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",156,0)
 G:'$D(^XUSEC("ORES",DUZ)) NW1 ;ck parameter for add'l orders
"RTN","ORQ11",157,0)
 S ORENT="ALL"_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+^(5),1:"")
"RTN","ORQ11",158,0)
 S ORPAR=$$GET^XPAR(ORENT,"OR UNSIGNED ORDERS ON EXIT")
"RTN","ORQ11",159,0)
 I ORPAR S TM=SDATE F  S TM=$O(^OR(100,"AS",PAT,TM)) Q:TM<1!(TM>EDATE)  D
"RTN","ORQ11",160,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AS",PAT,TM,IFN)) Q:IFN<1  D
"RTN","ORQ11",161,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"AS",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  D
"RTN","ORQ11",162,0)
 ... Q:$D(^TMP("ORNEW",$J,IFN,ACTOR))  ;already included
"RTN","ORQ11",163,0)
 ... S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)),X8=$G(^(8,ACTOR,0))
"RTN","ORQ11",164,0)
 ... I $S(ORPAR=1&($P(X8,U,3)=DUZ):1,ORPAR=2:1,1:0) D LP1
"RTN","ORQ11",165,0)
NW1 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",166,0)
 Q
"RTN","ORQ11",167,0)
 ;
"RTN","ORQ11",168,0)
CHT1 ; 20 -- secondary pass for Chart Review
"RTN","ORQ11",169,0)
 ;       Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",170,0)
 I '$P(X8,U,19),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",171,0)
 Q
"RTN","ORQ11",172,0)
 ;
"RTN","ORQ11",173,0)
CHTSUM ; 21 -- secondary pass for Chart copy summary
"RTN","ORQ11",174,0)
 ;       Included based on Nature of Order
"RTN","ORQ11",175,0)
 N XP,NAT
"RTN","ORQ11",176,0)
 S XP=+$$GET^XPAR("SYS","OR PRINT ALL ORDERS CHART SUM",1,"I")
"RTN","ORQ11",177,0)
 I XP=2 D  Q  ;depends on Nature of Order
"RTN","ORQ11",178,0)
 . S NAT=$P($G(^OR(100,IFN,6)),U)
"RTN","ORQ11",179,0)
 . I 'NAT S NAT=$P(X8,U,12)
"RTN","ORQ11",180,0)
 . I NAT,$$CHART^ORX1(NAT) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",181,0)
 I XP=0 D  Q  ;If original printed, print on sum
"RTN","ORQ11",182,0)
 . I X7 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",183,0)
 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) ;XP=1 gets All orders
"RTN","ORQ11",184,0)
 Q
"RTN","ORQ11",185,0)
 ;
"RTN","ORQ11",186,0)
LPS1 ; 22 -- secondary pass for Lapsed
"RTN","ORQ11",187,0)
 I STS=14 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",188,0)
 Q
"RTN","ORQ11",189,0)
 ;
"RTN","ORQ11",190,0)
AVT1 ; 23 -- secondary pass for Active/Pending sts only
"RTN","ORQ11",191,0)
 I (STS=6)!(STS=5) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",192,0)
 Q
"RTN","ORQ11",193,0)
 ;
"RTN","ORQ11",194,0)
QUIT ; -- stop
"RTN","ORQ11",195,0)
 Q
"RTN","ORQ2")
0^38^B37070145
"RTN","ORQ2",1,0)
ORQ2 ; SLC/MKB/GSS - Detailed Order Report ;7/1/04  10:58
"RTN","ORQ2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**12,56,75,94,141,213,195**;Dec 17, 1997
"RTN","ORQ2",3,0)
DETAIL(ORY,ORIFN) ; -- Returns details of order ORIFN in ORY(#)
"RTN","ORQ2",4,0)
 N X,X2,I,CNT,ORDIALOG,OR0,OR3,OR6,SEQ,ITEM,PRMT,MULT,FIRST,TITLE,INST,DIWL,DIWR,DIWF,ACTION,VAIN,ORIGVIEW,ORNMSP,ORYT
"RTN","ORQ2",5,0)
 S CNT=0,ORIFN=+ORIFN,OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)),OR6=$G(^(6))
"RTN","ORQ2",6,0)
 K @ORY,ORYT S ORIGVIEW=1 D TEXT^ORQ12(.ORYT,+ORIFN_";"_+$P(OR3,U,7),80) ;CurrTx
"RTN","ORQ2",7,0)
 M @ORY=ORYT ;Move text to global
"RTN","ORQ2",8,0)
 S I=0 F CNT=1:1 S I=$O(ORYT(I)) Q:I'>0  D:$D(IORVON) SETVIDEO(I,1,$L(ORYT(I)),IORVON,IORVOFF)
"RTN","ORQ2",9,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",10,0)
D1 I $O(^OR(100,+ORIFN,2,0)) D
"RTN","ORQ2",11,0)
 . S CNT=CNT+1,@ORY@(CNT)="Sub Orders:"
"RTN","ORQ2",12,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,11,IOUON,IOUOFF)
"RTN","ORQ2",13,0)
 . N IFN S IFN=0
"RTN","ORQ2",14,0)
 . F  S IFN=+$O(^OR(100,+ORIFN,2,IFN)) Q:IFN<1  I $D(^OR(100,IFN,0)) D SUB(IFN)
"RTN","ORQ2",15,0)
 . S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",16,0)
 I $P(OR3,U,9),$D(^OR(100,+$P(OR3,U,9),0)) D
"RTN","ORQ2",17,0)
 . S CNT=CNT+1,@ORY@(CNT)="Parent Order:"
"RTN","ORQ2",18,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,12,IOUON,IOUOFF)
"RTN","ORQ2",19,0)
 . D SUB(+$P(OR3,U,9))
"RTN","ORQ2",20,0)
 . S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",21,0)
 I $P(OR3,U,11)=1,$P(OR3,U,5) D  ;Changed - show previous order
"RTN","ORQ2",22,0)
 . S CNT=CNT+1,@ORY@(CNT)="Previous Order:"
"RTN","ORQ2",23,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,15,IOUON,IOUOFF) ;prev order original text
"RTN","ORQ2",24,0)
 . N ORZ,I,ORIGVIEW S ORIGVIEW=2 D TEXT^ORQ12(.ORZ,+$P(OR3,U,5),55)
"RTN","ORQ2",25,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Order Text:        "_$G(ORZ(1))
"RTN","ORQ2",26,0)
 . S I=1 F  S I=$O(ORZ(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORZ(I))
"RTN","ORQ2",27,0)
D2 S CNT=CNT+1,@ORY@(CNT)="Activity:"
"RTN","ORQ2",28,0)
 D:$D(IOUON) SETVIDEO(CNT,1,9,IOUON,IOUOFF)
"RTN","ORQ2",29,0)
 S DIWL=1,DIWR=64,DIWF="C64",ORI=0 K ^UTILITY($J,"W")
"RTN","ORQ2",30,0)
 F  S ORI=$O(^OR(100,ORIFN,8,ORI)) Q:ORI'>0  S ACTION=$G(^(ORI,0)) D ACT^ORQ20
"RTN","ORQ2",31,0)
 I "^1^12^13^"[(U_$P(OR3,U,3)_U),$L(OR6),$P(ACTION,U,2)'="DC" D DC^ORQ20
"RTN","ORQ2",32,0)
 I $P(OR3,U,3)=2,$P(OR6,U,6) S CNT=CNT+1,@ORY@(CNT)=$$DATE^ORQ20($P(OR6,U,6))_"  Completed"_$S($P(OR6,U,7):" by "_$$USER^ORQ20($P(OR6,U,7)),1:"")
"RTN","ORQ2",33,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",34,0)
D3 S CNT=CNT+1,@ORY@(CNT)="Current Data:"
"RTN","ORQ2",35,0)
 D:$D(IOUON) SETVIDEO(CNT,1,13,IOUON,IOUOFF)
"RTN","ORQ2",36,0)
 D VA I $G(VAIN(2)) S CNT=CNT+1,@ORY@(CNT)="Current Primary Provider:     "_$P(VAIN(2),"^",2)
"RTN","ORQ2",37,0)
 I $G(VAIN(11)) S CNT=CNT+1,@ORY@(CNT)="Current Attending Physician:  "_$P(VAIN(11),"^",2)
"RTN","ORQ2",38,0)
 S CNT=CNT+1,@ORY@(CNT)="Treating Specialty:           "_$P($G(^DIC(45.7,+$P(OR0,U,13),0)),U)
"RTN","ORQ2",39,0)
 S CNT=CNT+1,@ORY@(CNT)="Ordering Location:            "_$P($G(^SC(+$P(OR0,U,10),0)),U)
"RTN","ORQ2",40,0)
 S CNT=CNT+1,@ORY@(CNT)="Start Date/Time:              "_$S($P(OR0,U,8):$$DATE^ORQ20($P(OR0,U,8)),1:"")
"RTN","ORQ2",41,0)
 I $P(OR3,U,5),$P(OR3,U,11)=2 S X=$$ORIG(ORIFN),@ORY@(CNT)=@ORY@(CNT)_" (originally "_$$DATE^ORQ20(X)_")"
"RTN","ORQ2",42,0)
 S CNT=CNT+1,@ORY@(CNT)="Stop Date/Time:               "_$S($P(OR0,U,9):$$DATE^ORQ20($P(OR0,U,9)),1:"")
"RTN","ORQ2",43,0)
 S CNT=CNT+1,@ORY@(CNT)="Current Status:               "_$S($D(^ORD(100.01,+$P(OR3,U,3),0)):$P(^(0),"^"),1:"-")
"RTN","ORQ2",44,0)
 I $$GET^XPAR("ALL","ORPF SHOW STATUS DESCRIPTION",1,"I"),$P(OR3,U,3),$D(^ORD(100.01,$P(OR3,U,3),0)) N J S J=0 F  S J=$O(^ORD(100.01,$P(OR3,U,3),1,J)) Q:J<1  S CNT=CNT+1,@ORY@(CNT)="  "_^(J,0)
"RTN","ORQ2",45,0)
 S CNT=CNT+1,@ORY@(CNT)="Order #"_ORIFN
"RTN","ORQ2",46,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",47,0)
D4 S CNT=CNT+1,@ORY@(CNT)="Order:" D:$D(IOUON) SETVIDEO(CNT,1,6,IOUON,IOUOFF)
"RTN","ORQ2",48,0)
 S ORNMSP=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORQ2",49,0)
 I '$O(^OR(100,ORIFN,4.5,0)),ORNMSP="RA" D RAD^ORQ21("") Q
"RTN","ORQ2",50,0)
 S ORDIALOG=$P(OR0,U,5) Q:$P(ORDIALOG,";",2)="ORD(101,"  ; 2.5 order
"RTN","ORQ2",51,0)
 D GETDLG^ORCD(+ORDIALOG),GETORDER^ORCD(ORIFN)
"RTN","ORQ2",52,0)
 S DIWL=1,DIWR=50,DIWF="C50"
"RTN","ORQ2",53,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:SEQ'>0  S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORQ2",54,0)
 . S ITEM=$G(^ORD(101.41,+ORDIALOG,10,DA,0)) Q:$P(ITEM,U,11)  ; child
"RTN","ORQ2",55,0)
 . S PRMT=$P(ITEM,U,2),MULT=$P(ITEM,U,7) Q:$P(ITEM,U,9)["*"  ;hide
"RTN","ORQ2",56,0)
 . S FIRST=$O(ORDIALOG(PRMT,0)) Q:'FIRST  ; no values
"RTN","ORQ2",57,0)
 . S TITLE=$S(MULT&$L($G(ORDIALOG(PRMT,"TTL"))):ORDIALOG(PRMT,"TTL"),1:ORDIALOG(PRMT,"A"))
"RTN","ORQ2",58,0)
 . S TITLE=TITLE_$$REPEAT^XLFSTR(" ",30-$L(TITLE))
"RTN","ORQ2",59,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PRMT,INST)) Q:INST'>0  D
"RTN","ORQ2",60,0)
 . . I $E(ORDIALOG(PRMT,0))="W" D WP Q
"RTN","ORQ2",61,0)
 . . K ^UTILITY($J,"W") S X=$$EXT^ORCD(PRMT,INST) D ^DIWP
"RTN","ORQ2",62,0)
 . . D:$D(^ORD(101.41,+ORDIALOG,10,"DAD",PRMT)) CHILDREN(PRMT)
"RTN","ORQ2",63,0)
 . . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$S((INST=FIRST)&(I=1):TITLE,1:$$REPEAT^XLFSTR(" ",30))_^(I,0)
"RTN","ORQ2",64,0)
 I ORNMSP="GMRC",$G(^OR(100,ORIFN,4)) S CNT=CNT+1,@ORY@(CNT)="Consult No.:                  "_+^(4)
"RTN","ORQ2",65,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",66,0)
 D RAD^ORQ21(1):ORNMSP="RA",MED^ORQ21:ORNMSP="PS" ;add'l data
"RTN","ORQ2",67,0)
 D BA^ORQ21 ;call for CIDC data
"RTN","ORQ2",68,0)
D5 I $O(^OR(100,+ORIFN,9,0)) D
"RTN","ORQ2",69,0)
 . N CK,OK,X0,X,CDL,I S CNT=CNT+1,@ORY@(CNT)="Order Checks:"
"RTN","ORQ2",70,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,13,IOUON,IOUOFF)
"RTN","ORQ2",71,0)
 . S CK=0 F  S CK=$O(^OR(100,+ORIFN,9,CK)) Q:CK'>0  S X0=$G(^(CK,0)),X=$G(^(1)) D
"RTN","ORQ2",72,0)
 .. S CDL=$$CDL($P(X0,U,2)) I $P(X0,U,6),'$D(OK) S OK=$P(X0,U,4,6)
"RTN","ORQ2",73,0)
 .. I $L(X)'>68 S CNT=CNT+1,@ORY@(CNT)=CDL_X Q
"RTN","ORQ2",74,0)
 .. S DIWL=1,DIWR=68,DIWF="C68" K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ2",75,0)
 .. S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=CDL_^(I,0),CDL="            "
"RTN","ORQ2",76,0)
 . Q:'$L($G(OK))  S CNT=CNT+1,@ORY@(CNT)="Override:   "_$S($P(OK,U,2):$$USER^ORQ20($P(OK,U,2))_" on ",1:"")_$$DATE^ORQ20($P(OK,U,3))
"RTN","ORQ2",77,0)
 . I $L($P(OK,U))'>68 S CNT=CNT+1,@ORY@(CNT)="            "_$P(OK,U) Q
"RTN","ORQ2",78,0)
 . S DIWL=1,DIWR=68,DIWF="C68",X=$P(OK,U) K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ2",79,0)
 . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)="            "_^(I,0)
"RTN","ORQ2",80,0)
 K ^TMP("ORWORD",$J),^UTILITY($J,"W")
"RTN","ORQ2",81,0)
 Q
"RTN","ORQ2",82,0)
 ;
"RTN","ORQ2",83,0)
SUB(IFN) ; -- add suborder or parent
"RTN","ORQ2",84,0)
 N ORCY,STS,STRT,IG D TEXT^ORQ12(.ORCY,IFN,58)
"RTN","ORQ2",85,0)
 S STS=$G(^ORD(100.01,+$P($G(^OR(100,IFN,3)),U,3),.1))
"RTN","ORQ2",86,0)
 S STRT=$P(^OR(100,IFN,0),U,8) S:STRT'="" STRT=$$DATE^ORQ20(STRT)
"RTN","ORQ2",87,0)
 S IG=0 F  S IG=$O(ORCY(IG)) Q:IG<1  S CNT=CNT+1,@ORY@(CNT)=$J(STS,4)_" "_ORCY(IG)_" "_STRT,(STS,STRT)=" "
"RTN","ORQ2",88,0)
 Q
"RTN","ORQ2",89,0)
 ;
"RTN","ORQ2",90,0)
WP ; -- add word-processing
"RTN","ORQ2",91,0)
 N WP,ORI,X M WP=@ORDIALOG(PRMT,INST)
"RTN","ORQ2",92,0)
 S CNT=CNT+1,@ORY@(CNT)=TITLE
"RTN","ORQ2",93,0)
 S ORI=0 F  S ORI=$O(WP(ORI)) Q:ORI'>0  S X=WP(ORI,0) S:X'="" CNT=CNT+1,@ORY@(CNT)="  "_X
"RTN","ORQ2",94,0)
 Q
"RTN","ORQ2",95,0)
 ;
"RTN","ORQ2",96,0)
CHILDREN(PARENT) ; -- add children
"RTN","ORQ2",97,0)
 N SEQ,DA,ITM,PRMT,TYPE,X
"RTN","ORQ2",98,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)) D
"RTN","ORQ2",99,0)
 . S ITM=$G(^ORD(101.41,+ORDIALOG,10,DA,0)),PRMT=$P(ITM,U,2)
"RTN","ORQ2",100,0)
 . Q:$G(ORDIALOG(PRMT,INST))=""  Q:$P(ITM,U,9)["*"  ;no value or hide
"RTN","ORQ2",101,0)
 . S TYPE=$E(ORDIALOG(PRMT,0)) D:TYPE="W" WP
"RTN","ORQ2",102,0)
 . I TYPE'="W" S X=$$EXT^ORCD(PRMT,INST) D ^DIWP
"RTN","ORQ2",103,0)
 Q
"RTN","ORQ2",104,0)
 ;
"RTN","ORQ2",105,0)
SETVIDEO(LINE,COL,WIDTH,ON,OFF) ; -- set video attributes
"RTN","ORQ2",106,0)
 S ORY("VIDEO",LINE,COL,WIDTH)=ON
"RTN","ORQ2",107,0)
 S ORY("VIDEO",LINE,COL+WIDTH,0)=OFF
"RTN","ORQ2",108,0)
 Q
"RTN","ORQ2",109,0)
 ;
"RTN","ORQ2",110,0)
VA ; -- Call VADPT
"RTN","ORQ2",111,0)
 N ORY,DFN,Y S DFN=+$P(OR0,"^",2) D OERR^VADPT
"RTN","ORQ2",112,0)
 Q
"RTN","ORQ2",113,0)
 ;
"RTN","ORQ2",114,0)
CDL(X) ; -- Returns Clinical Danger Level X
"RTN","ORQ2",115,0)
 N Y S Y=$S(X=1:"HIGH:",X=2:"MODERATE:",X=3:"LOW:",1:"NONE:")
"RTN","ORQ2",116,0)
 S Y=$E(Y_"        ",1,12)
"RTN","ORQ2",117,0)
 Q Y
"RTN","ORQ2",118,0)
 ;
"RTN","ORQ2",119,0)
ORIG(IFN) ; -- Return original start date of [renewal] order
"RTN","ORQ2",120,0)
 N I,Y,X3,DONE
"RTN","ORQ2",121,0)
 S I=IFN,Y=$P($G(^OR(100,IFN,0)),U,8),DONE=0
"RTN","ORQ2",122,0)
 F  S X3=$G(^OR(100,I,3)) D  Q:DONE
"RTN","ORQ2",123,0)
 . I $P(X3,U,11)=2,$P(X3,U,5) S I=$P(X3,U,5) Q  ;loop
"RTN","ORQ2",124,0)
 . S Y=$P($G(^OR(100,I,0)),U,8),DONE=1
"RTN","ORQ2",125,0)
 Q Y
"RTN","ORQ21")
0^39^B26090672
"RTN","ORQ21",1,0)
ORQ21 ; SLC/MKB/GSS - Detailed Order Report cont ; 08 May 2002  2:12 PM
"RTN","ORQ21",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,190,195**;Dec 17, 1997
"RTN","ORQ21",3,0)
 ;
"RTN","ORQ21",4,0)
RAD(TCOM) ; -- add RA data for 2.5 orders
"RTN","ORQ21",5,0)
 N RAIFN,CASE,PROC,ORD,ORI,X,ORTTL,ORB
"RTN","ORQ21",6,0)
 S RAIFN=$G(^OR(100,ORIFN,4)) Q:RAIFN'>0
"RTN","ORQ21",7,0)
 D EN30^RAO7PC1(RAIFN) Q:'$D(^TMP($J,"RAE2",+ORVP))
"RTN","ORQ21",8,0)
 S ORD=$G(^TMP($J,"RAE2",+ORVP,"ORD")),CASE=$O(^(0)) Q:'CASE  S PROC=$O(^(CASE,""))
"RTN","ORQ21",9,0)
 I '$G(TCOM) D  ;else add only Tech Comments
"RTN","ORQ21",10,0)
 . S CNT=CNT+1,@ORY@(CNT)=$$LJ^XLFSTR("Procedure:",30)_$S($L(ORD):ORD,1:PROC)
"RTN","ORQ21",11,0)
 . S ORI=0,ORTTL="Procedure Modifiers:          ",ORB=1
"RTN","ORQ21",12,0)
 . F  S ORI=$O(^TMP($J,"RAE2",+ORVP,CASE,PROC,"M",ORI)) Q:ORI'>0  S CNT=CNT+1,@ORY@(CNT)=ORTTL_^(ORI),ORTTL=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",13,0)
 . S CNT=CNT+1,@ORY@(CNT)="History and Reason for Exam:"
"RTN","ORQ21",14,0)
 . F  S ORI=$O(^TMP($J,"RAE2",+ORVP,CASE,PROC,"H",ORI)) Q:ORI'>0  S CNT=CNT+1,@ORY@(CNT)="  "_^(ORI)
"RTN","ORQ21",15,0)
RAD1 I $L($G(^TMP($J,"RAE2",+ORVP,CASE,PROC,"TCOM",1))) S X=^(1) D
"RTN","ORQ21",16,0)
 . N DIWL,DIWR,DIWF,I K ^UTILITY($J,"W")
"RTN","ORQ21",17,0)
 . S DIWL=1,DIWR=72,DIWF="C72" D ^DIWP
"RTN","ORQ21",18,0)
 . S CNT=CNT+1,@ORY@(CNT)="Technologist's Comment:",ORB=1
"RTN","ORQ21",19,0)
 . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)="  "_^(I,0)
"RTN","ORQ21",20,0)
 K ^TMP($J,"RAE2",+ORVP),^UTILITY($J,"W")
"RTN","ORQ21",21,0)
 S:$G(ORB) CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ21",22,0)
 Q
"RTN","ORQ21",23,0)
 ;
"RTN","ORQ21",24,0)
MED ; -- Add Pharmacy order data
"RTN","ORQ21",25,0)
 Q:$G(^OR(100,ORIFN,4))["N"  ;non-VA med -- no refill history
"RTN","ORQ21",26,0)
 N TYPE,NODE,RXN,OR5 S TYPE=$P(OR0,U,12)
"RTN","ORQ21",27,0)
 I '$D(^TMP("PS",$J,0)) D  ;get PS data
"RTN","ORQ21",28,0)
 . N PSIFN S PSIFN=$G(^OR(100,ORIFN,4))
"RTN","ORQ21",29,0)
 . S:TYPE="O" PSIFN=$TR(PSIFN,"S","P")_$S(PSIFN?1.N:"R",1:"")
"RTN","ORQ21",30,0)
 . D OEL^PSOORRL(+ORVP,PSIFN_";"_TYPE)
"RTN","ORQ21",31,0)
 S NODE=$G(^TMP("PS",$J,0)),RXN=$G(^("RXN",0))
"RTN","ORQ21",32,0)
 I '$L(NODE) K ^TMP("PS",$J) Q  ;error
"RTN","ORQ21",33,0)
 I $O(^TMP("PS",$J,"DD",0)) D  ;Disp Drugs
"RTN","ORQ21",34,0)
 . N I,X,Y S X="Dispense Drugs (units/dose):  ",I=0
"RTN","ORQ21",35,0)
 . F  S I=$O(^TMP("PS",$J,"DD",I)) Q:I'>0  S Y=$G(^(I,0)) S:Y CNT=CNT+1,@ORY@(CNT)=X_$$GET1^DIQ(50,+Y_",",.01)_" ("_$P(Y,U,2)_")"
"RTN","ORQ21",36,0)
 S:$P(NODE,U,9) CNT=CNT+1,@ORY@(CNT)="Total Dose:                   "_$P(NODE,U,9)
"RTN","ORQ21",37,0)
M1 I TYPE="I" D  ;admin data
"RTN","ORQ21",38,0)
 . N I,X,Y I $O(^TMP("PS",$J,"B",0)) D
"RTN","ORQ21",39,0)
 .. S X="IV Print Name:                ",I=0
"RTN","ORQ21",40,0)
 .. F  S I=$O(^TMP("PS",$J,"B",I)) Q:I<1  S Y=$G(^(I,0)) S:$L(Y) CNT=CNT+1,@ORY@(CNT)=X_$P(Y,U),X=$$REPEAT^XLFSTR(" ",30) I $L($P(Y,U,3)) S CNT=CNT+1,@ORY@(CNT)=X_" "_$P(Y,U,3)
"RTN","ORQ21",41,0)
 . S I=+$O(^TMP("PS",$J,"SCH",0)),X=$P($G(^(I,0)),U,2)
"RTN","ORQ21",42,0)
 . S:$L(X) CNT=CNT+1,@ORY@(CNT)="Schedule Type:                "_X
"RTN","ORQ21",43,0)
 . S X="Administration Times:         ",I=0
"RTN","ORQ21",44,0)
 . F  S I=$O(^TMP("PS",$J,"ADM",I)) Q:I'>0  S Y=$G(^(I,0)) S:$L(Y) CNT=CNT+1,@ORY@(CNT)=X_Y,X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",45,0)
M2 I TYPE="O" D  ;fill history
"RTN","ORQ21",46,0)
 . N FILLD,X,Y,I
"RTN","ORQ21",47,0)
 . S:$P(NODE,U,12) CNT=CNT+1,@ORY@(CNT)="Last Filled:                  "_$$FMTE^XLFDT($P(NODE,U,12),2)
"RTN","ORQ21",48,0)
 . S CNT=CNT+1,@ORY@(CNT)="Refills Remaining:            "_$P(NODE,U,4)
"RTN","ORQ21",49,0)
 . I $P(RXN,U,6)!$G(^TMP("PS",$J,"REF",0)) S X="Filled:                       " D
"RTN","ORQ21",50,0)
 .. I $P(RXN,U,6) S FILLD=$P(RXN,U,6)_"^^^"_$P(RXN,U,7)_U_$P(RXN,U,3,4) D FILLED("R")
"RTN","ORQ21",51,0)
 .. S I=0 F  S I=$O(^TMP("PS",$J,"REF",I)) Q:I'>0  S FILLD=$G(^(I,0)) D FILLED("R")
"RTN","ORQ21",52,0)
 . I $G(^TMP("PS",$J,"PAR",0)) S I=0,X="Partial Fills:      " F  S I=$O(^TMP("PS",$J,"PAR",I)) Q:I'>0  S FILLD=$G(^(I,0)) D FILLED("P")
"RTN","ORQ21",53,0)
 . S:RXN CNT=CNT+1,@ORY@(CNT)="Prescription#:                "_$P(RXN,U)
"RTN","ORQ21",54,0)
M3 S:$P(RXN,U,5) CNT=CNT+1,@ORY@(CNT)="Pharmacist:                   "_$P($G(^VA(200,+$P(RXN,U,5),0)),U)
"RTN","ORQ21",55,0)
 S:$P(NODE,U,13) CNT=CNT+1,@ORY@(CNT)="NOT TO BE GIVEN" K ^TMP("PS",$J)
"RTN","ORQ21",56,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ21",57,0)
 S OR5=$G(^OR(100,ORIFN,5)) I $L(OR5) D  ;SC data
"RTN","ORQ21",58,0)
 . N X,Y,I
"RTN","ORQ21",59,0)
 . S CNT=CNT+1,@ORY@(CNT)="   " ;blank line
"RTN","ORQ21",60,0)
 . S CNT=CNT+1,@ORY@(CNT)="First Party Pay Exemptions"
"RTN","ORQ21",61,0)
 . S X="For conditions related to:    "
"RTN","ORQ21",62,0)
 . F I=1:1:7 S Y=$P(OR5,U,I) I Y S CNT=CNT+1,@ORY@(CNT)=X_$$SC(I),X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",63,0)
 Q
"RTN","ORQ21",64,0)
 ;
"RTN","ORQ21",65,0)
BA ;Billing Aware data display
"RTN","ORQ21",66,0)
 N DXIEN,DXV,ICD9,ICDR,OCT,ORFMDAT
"RTN","ORQ21",67,0)
 S OCT=0,X=""
"RTN","ORQ21",68,0)
 ; Get the date of the order for CSV/CTD usage
"RTN","ORQ21",69,0)
 S ORFMDAT=$$ORFMDAT^ORWDBA3(ORIFN)
"RTN","ORQ21",70,0)
 ; $O through diagnoses for an order
"RTN","ORQ21",71,0)
 F  S OCT=$O(^OR(100,ORIFN,5.1,OCT)) Q:OCT'?1N.N  D
"RTN","ORQ21",72,0)
 . ; DXIEN=Dx IEN
"RTN","ORQ21",73,0)
 . S DXIEN=+^OR(100,ORIFN,5.1,OCT,0)
"RTN","ORQ21",74,0)
 . ; Get Dx record for date ORFMDAT
"RTN","ORQ21",75,0)
 . S ICDR=$$ICDDX^ICDCODE(DXIEN,ORFMDAT)
"RTN","ORQ21",76,0)
 . ; Get Dx verbiage and ICD code
"RTN","ORQ21",77,0)
 . S DXV=$P(ICDR,U,4),ICD9=$P(ICDR,U,2)
"RTN","ORQ21",78,0)
 . S X="               "
"RTN","ORQ21",79,0)
 . I OCT=1 D
"RTN","ORQ21",80,0)
 .. S CNT=CNT+1,@ORY@(CNT)="   " ;blank line
"RTN","ORQ21",81,0)
 .. S CNT=CNT+1,@ORY@(CNT)="Clinical Indicators"
"RTN","ORQ21",82,0)
 .. S X="Diagnosis of:  "
"RTN","ORQ21",83,0)
 . S X=X_ICD9_" - "_DXV,CNT=CNT+1,@ORY@(CNT)=X
"RTN","ORQ21",84,0)
 I OCT'="" D  ;if there are diagnoses show Treatment Factors
"RTN","ORQ21",85,0)
 . S X="For conditions related to:    "
"RTN","ORQ21",86,0)
 . F I=1:1:7 S Y=$P(^OR(100,ORIFN,5.2),U,I) I Y D
"RTN","ORQ21",87,0)
 .. S CNT=CNT+1,@ORY@(CNT)=X_$$SC(I),X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",88,0)
 Q
"RTN","ORQ21",89,0)
 ;
"RTN","ORQ21",90,0)
FILLED(TYPE) ; -- add FILLD data
"RTN","ORQ21",91,0)
 N Y S Y=$$FMTE^XLFDT($P(FILLD,U),2)_" ("_$$ROUTING($P(FILLD,U,5))_")"
"RTN","ORQ21",92,0)
 S:TYPE="R"&$P(FILLD,U,4) Y=Y_" released "_$$FMTE^XLFDT($P(FILLD,U,4),2)
"RTN","ORQ21",93,0)
 S:TYPE="P"&$P(FILLD,U,3) Y=Y_" Qty: "_$P(FILLD,U,3)
"RTN","ORQ21",94,0)
 S CNT=CNT+1,@ORY@(CNT)=X_Y,X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",95,0)
 S:$L($P(FILLD,U,6)) CNT=CNT+1,@ORY@(CNT)=X_$P(FILLD,U,6)
"RTN","ORQ21",96,0)
 Q
"RTN","ORQ21",97,0)
 ;
"RTN","ORQ21",98,0)
ROUTING(X) ; -- Returns external form
"RTN","ORQ21",99,0)
 N Y S Y=$S($G(X)="M":"Mail",$G(X)="W":"Window",1:$G(X))
"RTN","ORQ21",100,0)
 Q Y
"RTN","ORQ21",101,0)
 ;
"RTN","ORQ21",102,0)
SC(J) ; -- Returns name of SC field by piece number
"RTN","ORQ21",103,0)
 I '$G(J) Q ""
"RTN","ORQ21",104,0)
 I J=1 Q "SERVICE CONNECTED CONDITION"
"RTN","ORQ21",105,0)
 I J=2 Q "MILITARY SEXUAL TRAUMA"
"RTN","ORQ21",106,0)
 I J=3 Q "AGENT ORANGE EXPOSURE"
"RTN","ORQ21",107,0)
 I J=4 Q "IONIZING RADIATION EXPOSURE"
"RTN","ORQ21",108,0)
 I J=5 Q "ENVIRONMENTAL CONTAMINANTS"
"RTN","ORQ21",109,0)
 I J=6 Q "HEAD OR NECK CANCER"
"RTN","ORQ21",110,0)
 I J=7 Q "COMBAT VETERAN"
"RTN","ORQ21",111,0)
 Q ""
"RTN","ORQPTQ2")
0^52^B40255442
"RTN","ORQPTQ2",1,0)
ORQPTQ2 ; slc/CLA - Functions which return patient lists and list sources pt 2 ;12/17/02  11:28 [4/23/04 4:23pm]
"RTN","ORQPTQ2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**9,10,85,187,190,195**;Dec 17, 1997
"RTN","ORQPTQ2",3,0)
CLIN(Y) ; RETURN LIST OF CLINICS
"RTN","ORQPTQ2",4,0)
 N ORLST,IEN,I
"RTN","ORQPTQ2",5,0)
 D GETLST^XPAR(.ORLST,"ALL","ORWD COMMON CLINIC")
"RTN","ORQPTQ2",6,0)
 S I=0 F  S I=$O(ORLST(I)) Q:'I  D
"RTN","ORQPTQ2",7,0)
 . S IEN=$P(ORLST(I),U,2) I $$ACTLOC^ORWU(IEN)=1 D
"RTN","ORQPTQ2",8,0)
 .. S Y(I)=IEN_U_$P(^SC(IEN,0),U,1)
"RTN","ORQPTQ2",9,0)
 Q
"RTN","ORQPTQ2",10,0)
 ;
"RTN","ORQPTQ2",11,0)
CLINPTS(Y,CLIN,ORBDATE,OREDATE) ; RETURN LIST OF PTS W/CLINIC APPT W/IN BEGINNING AND END DATES
"RTN","ORQPTQ2",12,0)
 ; PKS-8/2003: Modified for new scheduling pkg APIs.
"RTN","ORQPTQ2",13,0)
 I +$G(CLIN)<1 S Y(1)="^No clinic identified" Q 
"RTN","ORQPTQ2",14,0)
 I $$ACTLOC^ORWU(CLIN)'=1 S Y(1)="^Clinic is inactive or Occasion Of Service" Q
"RTN","ORQPTQ2",15,0)
 N DFN,NAME,I,J,X,ORJ,ORSRV,ORNOWDT,CHKX,CHKIN,MAXAPPTS,ORC,CLNAM,ORFLDS,ORCLIN,ORRESULT,ORSTART,OREND,ORSTAT,ORASTAT,ORERR,ORI,ORPT,ORPTSTAT,ORMAX,ORHOLD
"RTN","ORQPTQ2",16,0)
 S MAXAPPTS=200
"RTN","ORQPTQ2",17,0)
 S ORNOWDT=$$NOW^XLFDT
"RTN","ORQPTQ2",18,0)
 S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORQPTQ2",19,0)
 S DFN=0,I=1
"RTN","ORQPTQ2",20,0)
 I ORBDATE="" S ORBDATE=$$UP^XLFSTR($$GET^XPAR("USR^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORLP DEFAULT CLINIC START DATE",1,"E"))
"RTN","ORQPTQ2",21,0)
 I OREDATE="" S OREDATE=$$UP^XLFSTR($$GET^XPAR("USR^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORLP DEFAULT CLINIC STOP DATE",1,"E"))
"RTN","ORQPTQ2",22,0)
 ;
"RTN","ORQPTQ2",23,0)
 ; Convert ORBDATE, OREDATE to FM Date/Time:
"RTN","ORQPTQ2",24,0)
 D DT^DILF("T",ORBDATE,.ORBDATE,"","")
"RTN","ORQPTQ2",25,0)
 D DT^DILF("T",OREDATE,.OREDATE,"","")
"RTN","ORQPTQ2",26,0)
 I (ORBDATE=-1)!(OREDATE=-1) S Y(1)="^Error in date range." Q 
"RTN","ORQPTQ2",27,0)
 S OREDATE=$P(OREDATE,".")_.5 ; Add 1/2 day to end date.
"RTN","ORQPTQ2",28,0)
 ; IA# 3869:
"RTN","ORQPTQ2",29,0)
 K ^TMP($J,"SDAMA202","GETPLIST") ; Clean house before starting.
"RTN","ORQPTQ2",30,0)
 S ORRESULT=""
"RTN","ORQPTQ2",31,0)
 S ORCLIN=+CLIN,ORFLDS="1;3;4;12",ORASTAT="R;NT",ORSTART=ORBDATE,OREND=OREDATE,ORSTAT="" ; Assign parameters.
"RTN","ORQPTQ2",32,0)
 ; ORFLDS: 1;3;4;12 = ApptDateTime;ApptStatus;IEN^PtName;PtStatus.
"RTN","ORQPTQ2",33,0)
 D GETPLIST^SDAMA202(ORCLIN,ORFLDS,ORASTAT,ORSTART,OREND,.ORRESULT,ORSTAT) ; DBIA # 3869.
"RTN","ORQPTQ2",34,0)
 ;
"RTN","ORQPTQ2",35,0)
 ; Deal with server errors:
"RTN","ORQPTQ2",36,0)
 S ORERR=""
"RTN","ORQPTQ2",37,0)
 I ORRESULT=-1 D
"RTN","ORQPTQ2",38,0)
 .S ORERR=$O(^TMP($J,"SDAMA202","GETPLIST","ERROR",ORERR))
"RTN","ORQPTQ2",39,0)
 I ORERR'="" S Y(1)="Server Error: "_ORERR Q
"RTN","ORQPTQ2",40,0)
 ;
"RTN","ORQPTQ2",41,0)
 ; Reassign ^TMP array to local array:
"RTN","ORQPTQ2",42,0)
 S (ORPT,ORI)=0,ORMAX=MAXAPPTS
"RTN","ORQPTQ2",43,0)
 I ORRESULT'>0 S Y(1)="^No appointments." Q
"RTN","ORQPTQ2",44,0)
 F  S ORPT=$O(^TMP($J,"SDAMA202","GETPLIST",ORPT)) Q:ORPT=""!(ORI>ORMAX)  D
"RTN","ORQPTQ2",45,0)
 .S ORI=ORI+1
"RTN","ORQPTQ2",46,0)
 .S Y(ORI)=$G(^TMP($J,"SDAMA202","GETPLIST",ORPT,4)) ; IEN^Name.
"RTN","ORQPTQ2",47,0)
 .S Y(ORI)=Y(ORI)_U_ORCLIN ; ^Clinic IEN.
"RTN","ORQPTQ2",48,0)
 .S Y(ORI)=Y(ORI)_U_$G(^TMP($J,"SDAMA202","GETPLIST",ORPT,1)) ; App't.
"RTN","ORQPTQ2",49,0)
 .S ORPTSTAT=$G(^TMP($J,"SDAMA202","GETPLIST",ORPT,12)) ; Pt Status.
"RTN","ORQPTQ2",50,0)
 .S ORPTSTAT=$S(ORPTSTAT="I":"IPT",ORPTSTAT="O":"OPT",1:"")
"RTN","ORQPTQ2",51,0)
 .S ORHOLD=$G(^TMP($J,"SDAMA202","GETPLIST",ORPT,3)) ; Appt Status.
"RTN","ORQPTQ2",52,0)
 .I ORPTSTAT=""&(ORHOLD="NT") S ORPTSTAT="NT" ; "No Action Taken."
"RTN","ORQPTQ2",53,0)
 .S Y(ORI)=Y(ORI)_U_U_U_U_U_ORPTSTAT ; Pt I or O status (or "NT").
"RTN","ORQPTQ2",54,0)
 ;
"RTN","ORQPTQ2",55,0)
 K ^TMP($J,"SDAMA202","GETPLIST") ; Clean house after finishing.
"RTN","ORQPTQ2",56,0)
 ;
"RTN","ORQPTQ2",57,0)
 Q
"RTN","ORQPTQ2",58,0)
 ;
"RTN","ORQPTQ2",59,0)
CDATRANG(ORY) ; return default start and stop dates for clinics in form start^stop
"RTN","ORQPTQ2",60,0)
 N ORBDATE,OREDATE,ORSRV
"RTN","ORQPTQ2",61,0)
 S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORQPTQ2",62,0)
 S ORBDATE=$$UP^XLFSTR($$GET^XPAR("USR^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORLP DEFAULT CLINIC START DATE",1,"E"))
"RTN","ORQPTQ2",63,0)
 S OREDATE=$$UP^XLFSTR($$GET^XPAR("USR^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORLP DEFAULT CLINIC STOP DATE",1,"E"))
"RTN","ORQPTQ2",64,0)
 S ORBDATE=$S($L($G(ORBDATE)):ORBDATE,1:""),OREDATE=$S($L($G(OREDATE)):OREDATE,1:"")
"RTN","ORQPTQ2",65,0)
 S ORY=$$UP^XLFSTR(ORBDATE)_"^"_$$UP^XLFSTR(OREDATE)
"RTN","ORQPTQ2",66,0)
 Q
"RTN","ORQPTQ2",67,0)
PTAPPTS(Y,DFN,ORBDATE,OREDATE,CLIN) ; return appts for a patient between beginning and end dates for a clinic, if no clinic return all appointments
"RTN","ORQPTQ2",68,0)
 ;I +$G(CLIN)<1 S Y(1)="^No clinic identified" Q 
"RTN","ORQPTQ2",69,0)
 I +$G(CLIN)>0,$$ACTLOC^ORWU(CLIN)'=1 S Y(1)="^Clinic is inactive or Occasion Of Service" Q
"RTN","ORQPTQ2",70,0)
 N VASD,NUM,CNT,INVDT,INT,EXT,ORSRV S NUM=0,CNT=1
"RTN","ORQPTQ2",71,0)
 I (ORBDATE="")!(OREDATE="") D  ;get user's service and set up entities:
"RTN","ORQPTQ2",72,0)
 .S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORQPTQ2",73,0)
 I ORBDATE="" D
"RTN","ORQPTQ2",74,0)
 .I '$L(CLIN) S ORBDATE=$$UP^XLFSTR($$GET^XPAR("USR^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORQQEAPT ENC APPT START",1,"E"))
"RTN","ORQPTQ2",75,0)
 .S:ORBDATE="" ORBDATE="T" ;default start date across all clinics is today
"RTN","ORQPTQ2",76,0)
 I OREDATE="" D
"RTN","ORQPTQ2",77,0)
 .I '$L(CLIN) S OREDATE=$$UP^XLFSTR($$GET^XPAR("USR^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORQQEAPT ENC APPT STOP",1,"E"))
"RTN","ORQPTQ2",78,0)
 .S:OREDATE="" OREDATE="T" ;default end date across all clinics is today
"RTN","ORQPTQ2",79,0)
 ;CONVERT ORBDATE AND OREDATE INTO FILEMAN DATE/TIME
"RTN","ORQPTQ2",80,0)
 D DT^DILF("T",ORBDATE,.ORBDATE,"","")
"RTN","ORQPTQ2",81,0)
 D DT^DILF("T",OREDATE,.OREDATE,"","")
"RTN","ORQPTQ2",82,0)
 I (ORBDATE=-1)!(OREDATE=-1) S Y(1)="^Error in date range." Q 
"RTN","ORQPTQ2",83,0)
 S VASD("F")=ORBDATE
"RTN","ORQPTQ2",84,0)
 S VASD("T")=$P(OREDATE,".")_.5  ;ADD 1/2 DAY TO END DATE
"RTN","ORQPTQ2",85,0)
 I $L($G(CLIN)) S VASD("C",CLIN)=""
"RTN","ORQPTQ2",86,0)
 D SDA^VADPT
"RTN","ORQPTQ2",87,0)
 Q:VAERR=1
"RTN","ORQPTQ2",88,0)
 F  S NUM=$O(^UTILITY("VASD",$J,NUM)) Q:'NUM  D
"RTN","ORQPTQ2",89,0)
 .S INT=^UTILITY("VASD",$J,NUM,"I"),INVDT=9999999-$P(INT,U)
"RTN","ORQPTQ2",90,0)
 .S EXT=^UTILITY("VASD",$J,NUM,"E")
"RTN","ORQPTQ2",91,0)
 .S Y(CNT)=$P(INT,U)_U_$P(EXT,U,2)_U_$P(EXT,U,3)_U_$P(EXT,U,4)_U_INVDT
"RTN","ORQPTQ2",92,0)
 .S CNT=CNT+1
"RTN","ORQPTQ2",93,0)
 S:+$G(Y(1))<1 Y(1)="^No appointments."
"RTN","ORQPTQ2",94,0)
 K VAERR
"RTN","ORQPTQ2",95,0)
 Q
"RTN","ORQPTQ2",96,0)
PROV(Y) ; RETURN LIST OF PROVIDERS
"RTN","ORQPTQ2",97,0)
 N I,IEN,NAME,TDATE
"RTN","ORQPTQ2",98,0)
 S I=1,NAME=""
"RTN","ORQPTQ2",99,0)
 F  S NAME=$O(^VA(200,"B",NAME)) Q:NAME=""  S IEN=0,IEN=$O(^(NAME,IEN))  D
"RTN","ORQPTQ2",100,0)
 .Q:$E(NAME)="*"
"RTN","ORQPTQ2",101,0)
 .I $D(^XUSEC("PROVIDER",IEN)),$$ACTIVE^XUSER(IEN) S Y(I)=IEN_"^"_NAME,I=I+1
"RTN","ORQPTQ2",102,0)
 Q
"RTN","ORQPTQ2",103,0)
PROVPTS(Y,PROV) ; RETURN LIST OF PATIENTS LINKED TO A PRIMARY PROVIDER
"RTN","ORQPTQ2",104,0)
 I +$G(PROV)<1 S Y(1)="^No provider identified" Q
"RTN","ORQPTQ2",105,0)
 N ORI,DFN
"RTN","ORQPTQ2",106,0)
 S ORI=1,DFN=0
"RTN","ORQPTQ2",107,0)
 F  S DFN=$O(^DPT("APR",PROV,DFN)) Q:DFN'>0  S Y(ORI)=+DFN_"^"_$P(^DPT(+DFN,0),"^"),ORI=ORI+1
"RTN","ORQPTQ2",108,0)
 S:+$G(Y(1))<1 Y(1)="^No patients found."
"RTN","ORQPTQ2",109,0)
 Q
"RTN","ORQPTQ2",110,0)
SPEC(Y) ; RETURN LIST OF TREATING SPECIALTIES
"RTN","ORQPTQ2",111,0)
 N I,NAME,IEN
"RTN","ORQPTQ2",112,0)
 S I=1,NAME=""
"RTN","ORQPTQ2",113,0)
 ;access to DIC(45.7 global granted under DBIA #519:
"RTN","ORQPTQ2",114,0)
 F  S NAME=$O(^DIC(45.7,"B",NAME)) Q:NAME=""  S IEN=0,IEN=$O(^(NAME,IEN)) I $$ACTIVE^DGACT(45.7,IEN) S Y(I)=IEN_"^"_NAME,I=I+1
"RTN","ORQPTQ2",115,0)
 Q
"RTN","ORQPTQ2",116,0)
SPECPTS(Y,SPEC) ; RETURN LIST OF PATIENTS LINKED TO A TREATING SPECIALTY
"RTN","ORQPTQ2",117,0)
 I +$G(SPEC)<1 S Y(1)="^No specialty identified" Q 
"RTN","ORQPTQ2",118,0)
 N ORI,DFN
"RTN","ORQPTQ2",119,0)
 S ORI=1,DFN=0
"RTN","ORQPTQ2",120,0)
 F  S DFN=$O(^DPT("ATR",SPEC,DFN)) Q:DFN'>0  S Y(ORI)=+DFN_"^"_$P(^DPT(+DFN,0),"^"),ORI=ORI+1
"RTN","ORQPTQ2",121,0)
 S:+$G(Y(1))<1 Y(1)="^No patients found."
"RTN","ORQPTQ2",122,0)
 Q
"RTN","ORQPTQ2",123,0)
WARD(Y) ; RETURN LIST OF ACTIVE WARDS
"RTN","ORQPTQ2",124,0)
 N I,IEN,NAME,D0
"RTN","ORQPTQ2",125,0)
 S I=1,NAME=""
"RTN","ORQPTQ2",126,0)
 ;access to DIC(42 global granted under DBIA #36:
"RTN","ORQPTQ2",127,0)
 F  S NAME=$O(^DIC(42,"B",NAME)) Q:NAME=""  S IEN=$O(^(NAME,0)) D
"RTN","ORQPTQ2",128,0)
 . S D0=IEN D WIN^DGPMDDCF
"RTN","ORQPTQ2",129,0)
 . I X=0 S Y(I)=IEN_"^"_NAME,I=I+1
"RTN","ORQPTQ2",130,0)
 Q
"RTN","ORQPTQ2",131,0)
WARDPTS(Y,WARD) ; RETURN LIST OF PATIENTS IN A WARD
"RTN","ORQPTQ2",132,0)
 ; SLC/PKS - Modifications for Room/Bed data on  1/19/2001.
"RTN","ORQPTQ2",133,0)
 I +$G(WARD)<1 S Y(1)="^No ward identified" Q 
"RTN","ORQPTQ2",134,0)
 N ORI,DFN,RBDAT
"RTN","ORQPTQ2",135,0)
 S ORI=1,DFN=0
"RTN","ORQPTQ2",136,0)
 ; Access to DIC(42 global granted under DBIA #36:
"RTN","ORQPTQ2",137,0)
 S WARD=$P(^DIC(42,WARD,0),"^")   ;GET WARD NAME FOR "CN"  LOOKUP
"RTN","ORQPTQ2",138,0)
 ; Next section modified 1/19/2001 by PKS:
"RTN","ORQPTQ2",139,0)
 F  D  Q:DFN'>0
"RTN","ORQPTQ2",140,0)
 .S DFN=$O(^DPT("CN",WARD,DFN)) Q:DFN'>0
"RTN","ORQPTQ2",141,0)
 .S Y(ORI)=+DFN_"^"_$P(^DPT(+DFN,0),"^")
"RTN","ORQPTQ2",142,0)
 .S RBDAT=""
"RTN","ORQPTQ2",143,0)
 .; Add patient room/bed information where data exists:
"RTN","ORQPTQ2",144,0)
 .S RBDAT=$P($G(^DPT(+DFN,.101)),U)
"RTN","ORQPTQ2",145,0)
 .I RBDAT'="" D                                   ; Any R/B data?
"RTN","ORQPTQ2",146,0)
 ..I $L(RBDAT)<4 S RBDAT=RBDAT_"   "              ; Add if < 4 chars.
"RTN","ORQPTQ2",147,0)
 ..S RBDAT=$E(RBDAT,1,4)                          ; Get first 4 only.
"RTN","ORQPTQ2",148,0)
 .S Y(ORI)=Y(ORI)_U_RBDAT                         ; Add R/B to string
"RTN","ORQPTQ2",149,0)
 .S ORI=ORI+1                                     ; Increment counter.
"RTN","ORQPTQ2",150,0)
 ;
"RTN","ORQPTQ2",151,0)
 S:+$G(Y(1))<1 Y(1)="^No patients found."
"RTN","ORQPTQ2",152,0)
 Q
"RTN","ORQPTQ2",153,0)
NLIST(ORQY) ; return a null list
"RTN","ORQPTQ2",154,0)
 S ORQY(1)=""
"RTN","ORQPTQ2",155,0)
 Q
"RTN","ORQQVS")
0^53^B13142544
"RTN","ORQQVS",1,0)
ORQQVS ; slc/CLA,STAFF - Functions which return patient visits ;8/19/98@13:36:57 [2/19/04 5:04pm]
"RTN","ORQQVS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,195**;Dec 17, 1997
"RTN","ORQQVS",3,0)
LIST(ORY,PT,ORSDT,OREDT,LOC) ; return visits for a patient between start & end dates for a location, if no location return all visits
"RTN","ORQQVS",4,0)
 N VIEN,NUM,CNT,INVDT,ORSRV,CNTLIMIT,ORX
"RTN","ORQQVS",5,0)
 S CNTLIMIT=100  ;limit visits to 100 most recent Visit entries
"RTN","ORQQVS",6,0)
 S VIEN="A",NUM=0,CNT=1
"RTN","ORQQVS",7,0)
 S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORQQVS",8,0)
 I ORSDT="" D
"RTN","ORQQVS",9,0)
 .I '$L(LOC) S ORSDT=$$UP^XLFSTR($$GET^XPAR("USR^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORQQEAPT ENC APPT START",1,"E"))
"RTN","ORQQVS",10,0)
 .I ORSDT="" S ORSDT="T-730" ;default start date is two years ago
"RTN","ORQQVS",11,0)
 I OREDT="" D
"RTN","ORQQVS",12,0)
 .I '$L(LOC) S OREDT=$$UP^XLFSTR($$GET^XPAR("USR^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORQQEAPT ENC APPT STOP",1,"E"))
"RTN","ORQQVS",13,0)
 .I OREDT="" S OREDT="T" ;default end date is today
"RTN","ORQQVS",14,0)
 ;CONVERT ORSDT AND OREDT INTO FILEMAN DATE/TIME
"RTN","ORQQVS",15,0)
 D DT^DILF("T",ORSDT,.ORSDT,"","")
"RTN","ORQQVS",16,0)
 D DT^DILF("T",OREDT,.OREDT,"","")
"RTN","ORQQVS",17,0)
 I (ORSDT=-1)!(OREDT=-1) S ORY(1)="^Error in date range." Q 
"RTN","ORQQVS",18,0)
 K ^TMP("VSIT",$J)
"RTN","ORQQVS",19,0)
 D SELECTED^VSIT(PT,ORSDT,OREDT,LOC,"")
"RTN","ORQQVS",20,0)
 F  S VIEN=$O(^TMP("VSIT",$J,VIEN),-1) Q:VIEN=""!(CNT>CNTLIMIT)  D
"RTN","ORQQVS",21,0)
 .F  S NUM=$O(^TMP("VSIT",$J,VIEN,NUM)) Q:NUM=""  D
"RTN","ORQQVS",22,0)
 ..S ORX=^TMP("VSIT",$J,VIEN,NUM),INVDT=9999999-$P(ORX,U)
"RTN","ORQQVS",23,0)
 ..I $$ACTLOC^ORWU(+$P(ORX,U,2))=1 D
"RTN","ORQQVS",24,0)
 ...S ORY(CNT)=VIEN_U_ORX_U_INVDT,CNT=CNT+1
"RTN","ORQQVS",25,0)
 K ^TMP("VSIT",$J)
"RTN","ORQQVS",26,0)
 Q
"RTN","ORQQVS",27,0)
VSITAPPT(ORVY,PT,SDT,EDT,DUMMY) ; return past visits and future appointments for a patient between start and end dates
"RTN","ORQQVS",28,0)
 N NDT,CNT,I,TS,ORVSITY D NOW^%DTC S NDT=+%,CNT=1 K %
"RTN","ORQQVS",29,0)
 D PTAPPTS^ORQPTQ2(.ORYA,PT,NDT,EDT,"") ;get future appointments
"RTN","ORQQVS",30,0)
 S I=0 F  S I=$O(ORYA(I)) Q:I<1  I ORYA(I)'["No appts",+ORYA(I) D
"RTN","ORQQVS",31,0)
 .S ORVY(CNT)=$P(ORYA(I),U)_";s"_U_$P(ORYA(I),U,2)_U_"sched:"_U_$P(ORYA(I),U)
"RTN","ORQQVS",32,0)
 .S ORVY(CNT)=ORVY(CNT)_U_$P(ORYA(I),U,5),CNT=CNT+1
"RTN","ORQQVS",33,0)
 D LIST(.YV,PT,SDT,NDT,"") ;get past visits
"RTN","ORQQVS",34,0)
 S I=0 F  S I=$O(YV(I)) Q:I<1  D
"RTN","ORQQVS",35,0)
 .S ORVY(CNT)=$P(YV(I),U)_";v"_U_$P($P(YV(I),U,3),";",2)
"RTN","ORQQVS",36,0)
 .I $P(YV(I),U,4)="H" D
"RTN","ORQQVS",37,0)
 ..S ORVY(CNT)=$P(YV(I),U)_";a"_U_"Inpatient Stay"_U_"admitted:"
"RTN","ORQQVS",38,0)
 .I $P(YV(I),U,4)'="H" S ORVY(CNT)=ORVY(CNT)_U_"visited:"
"RTN","ORQQVS",39,0)
 .S ORVY(CNT)=ORVY(CNT)_U_$P(YV(I),U,2)_U_$P(YV(I),U,8),CNT=CNT+1
"RTN","ORQQVS",40,0)
 S:+$G(ORVY(1))<1 ORVY(1)="^No appts or visits found."
"RTN","ORQQVS",41,0)
 K ORYA,YV
"RTN","ORQQVS",42,0)
 Q
"RTN","ORQQVS",43,0)
DETNOTE(ORVY,ORPT,ORVIEN) ;return progress notes for a patient's visit
"RTN","ORQQVS",44,0)
 N ORTY,ORY,TDT,ORVI
"RTN","ORQQVS",45,0)
 S TDT=0
"RTN","ORQQVS",46,0)
 K ^TMP("TIULIST",$J)
"RTN","ORQQVS",47,0)
 D NOTES^TIUSRVLV(.ORY,ORVIEN)
"RTN","ORQQVS",48,0)
 I '+$O(^TMP("TIULIST",$J,0)) D  Q
"RTN","ORQQVS",49,0)
 . S ORVY(1)="No Progress Notes for this visit."
"RTN","ORQQVS",50,0)
 S ORVI=1
"RTN","ORQQVS",51,0)
 F  S TDT=$O(^TMP("TIULIST",$J,TDT)) Q:+TDT'>0  D
"RTN","ORQQVS",52,0)
 . N SEQ,TIEN S SEQ=0
"RTN","ORQQVS",53,0)
 . F  S SEQ=$O(^TMP("TIULIST",$J,TDT,SEQ)) Q:+SEQ'>0  D
"RTN","ORQQVS",54,0)
 . . N TSEQ K ^TMP("TIUVIEW",$J)
"RTN","ORQQVS",55,0)
 . . S TIEN=$P(^TMP("TIULIST",$J,TDT,SEQ),U)
"RTN","ORQQVS",56,0)
 . . D TGET^TIUSRVR1(.ORTY,TIEN)
"RTN","ORQQVS",57,0)
 . . S TSEQ=0
"RTN","ORQQVS",58,0)
 . . F  S TSEQ=$O(@ORTY@(TSEQ)) Q:TSEQ=""  D
"RTN","ORQQVS",59,0)
 . . . S ORVY(ORVI)=@ORTY@(TSEQ),ORVI=ORVI+1
"RTN","ORQQVS",60,0)
 . . S ORVY(ORVI)=" ",ORVI=ORVI+1
"RTN","ORQQVS",61,0)
 . . S ORVY(ORVI)=" ",ORVI=ORVI+1
"RTN","ORQQVS",62,0)
 K ^TMP("TIULIST",$J)
"RTN","ORQQVS",63,0)
 Q
"RTN","ORQQVS",64,0)
DETSUM(ORVY,ORPT,ORVIEN) ;return discharge summary for a patient's visit
"RTN","ORQQVS",65,0)
 N CR,ORTY,ORY,TDT
"RTN","ORQQVS",66,0)
 S TDT=0
"RTN","ORQQVS",67,0)
 K ^TMP("TIULIST",$J)
"RTN","ORQQVS",68,0)
 D SUMMARY^TIUSRVLV(.ORY,ORVIEN)
"RTN","ORQQVS",69,0)
 I '+$O(^TMP("TIULIST",$J,0)) D  Q
"RTN","ORQQVS",70,0)
 . S ORVY(1)="No Discharge Summary found for this stay."
"RTN","ORQQVS",71,0)
 F  S TDT=$O(^TMP("TIULIST",$J,TDT)) Q:+TDT'>0  D
"RTN","ORQQVS",72,0)
 . N SEQ,TIEN S SEQ=0
"RTN","ORQQVS",73,0)
 . F  S SEQ=$O(^TMP("TIULIST",$J,TDT,SEQ)) Q:+SEQ'>0  D
"RTN","ORQQVS",74,0)
 . . N TSEQ,ORVI K ^TMP("TIUVIEW",$J)
"RTN","ORQQVS",75,0)
 . . S TIEN=$P(^TMP("TIULIST",$J,TDT,SEQ),U)
"RTN","ORQQVS",76,0)
 . . D TGET^TIUSRVR1(.ORTY,TIEN)
"RTN","ORQQVS",77,0)
 . . S TSEQ=0,ORVI=1
"RTN","ORQQVS",78,0)
 . . F  S TSEQ=$O(@ORTY@(TSEQ)) Q:TSEQ=""  D
"RTN","ORQQVS",79,0)
 . . . S ORVY(ORVI)=@ORTY@(TSEQ),ORVI=ORVI+1
"RTN","ORQQVS",80,0)
 . . S ORVY(ORVI)=" ",ORVI=ORVI+1
"RTN","ORQQVS",81,0)
 . . S ORVY(ORVI)=" ",ORVI=ORVI+1
"RTN","ORQQVS",82,0)
 K ^TMP("TIULIST",$J)
"RTN","ORQQVS",83,0)
 Q
"RTN","ORWCV")
0^56^B69135314
"RTN","ORWCV",1,0)
ORWCV ; SLC/KCM - Background Cover Sheet Load; ;1/13/04  13:24 [1/13/04 2:47pm]
"RTN","ORWCV",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,132,209,214,195**;Dec 17, 1997
"RTN","ORWCV",3,0)
 ;
"RTN","ORWCV",4,0)
START(VAL,DFN,IP,HWND,LOC,NODO,NEWREM)  ; start cover sheet build in background
"RTN","ORWCV",5,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC,SECT,BACK,X,I,LIST,STR,FILE,NODE,ORHTIME
"RTN","ORWCV",6,0)
 ; Capacity planning timing code uses ORHTIME
"RTN","ORWCV",7,0)
 S ORHTIME=$H
"RTN","ORWCV",8,0)
 S LOC=$G(LOC),NODO=";"_$G(NODO),NEWREM=+$G(NEWREM)
"RTN","ORWCV",9,0)
 D GETLST^XPAR(.X,"SYS^PKG","ORWOR COVER RETRIEVAL NEW","Q")
"RTN","ORWCV",10,0)
 S I=0 F  S I=$O(X(I)) Q:'I  I $D(^ORD(101.24,+X(I),0)) S SECT(+$P(^(0),"^",2))=$P(X(I),"^",2)
"RTN","ORWCV",11,0)
 D GETLST^XPAR(.LIST,"ALL","ORWCV1 COVERSHEET LIST")
"RTN","ORWCV",12,0)
 S (VAL,BACK,STR,FILE)=""
"RTN","ORWCV",13,0)
 F  S I=$O(LIST(I)) Q:'I  I $D(^ORD(101.24,$P(LIST(I),"^",2),0))  S X0=^(0) D
"RTN","ORWCV",14,0)
 . Q:$P(X0,"^",8)'="C"
"RTN","ORWCV",15,0)
 . S X=$P(X0,"^",2)
"RTN","ORWCV",16,0)
 . I NODO[(";"_X_";") Q                                  ; if in NODO, dont do section
"RTN","ORWCV",17,0)
 . S STR=STR_X_";"
"RTN","ORWCV",18,0)
 . I '$G(SECT(X)) S VAL=VAL_X_";"                        ; load section in foreground
"RTN","ORWCV",19,0)
 . E  S BACK=BACK_X_";",FILE=FILE_$P(LIST(I),"^",2)_";"  ; load section in background
"RTN","ORWCV",20,0)
 Q:BACK=""
"RTN","ORWCV",21,0)
 S ZTIO="ORW THREAD RESOURCE",ZTRTN="BUILD^ORWCV",ZTDTH=$H
"RTN","ORWCV",22,0)
 S (ZTSAVE("DFN"),ZTSAVE("IP"),ZTSAVE("HWND"),ZTSAVE("NEWREM"),ZTSAVE("LOC"),ZTSAVE("BACK"),ZTSAVE("FILE"))=""
"RTN","ORWCV",23,0)
 S ZTDESC="CPRS GUI Background Data Retrieval"
"RTN","ORWCV",24,0)
 D ^%ZTLOAD I '$D(ZTSK) S VAL=STR Q
"RTN","ORWCV",25,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN
"RTN","ORWCV",26,0)
 K ^XTMP(NODE)
"RTN","ORWCV",27,0)
 S ^XTMP(NODE,0)=$$FMADD^XLFDT(DT,1)_U_DT_U_"Background CPRS "_ZTSK
"RTN","ORWCV",28,0)
 ; Start capacity planning timing clock - will be stopped in POLL code
"RTN","ORWCV",29,0)
 I +$G(^KMPTMP("KMPD-CPRS")) S ^KMPTMP("KMPDT","ORWCV",NODE)=$G(ORHTIME)_"^^"_$G(DUZ)_"^"_$G(IO("CLNM"))
"RTN","ORWCV",30,0)
 Q
"RTN","ORWCV",31,0)
BUILD ; called in background by task manager, expects DFN, JobID
"RTN","ORWCV",32,0)
 N NODE,IFLE,ORFNUM,ID,ENT,RTN,INODE,PARAM1,PARAM2,DETAIL,X0,X2
"RTN","ORWCV",33,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN
"RTN","ORWCV",34,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ORWCV",35,0)
 I $G(^XTMP(NODE,"STOP")) K ^XTMP(NODE) Q  ; client no longer polling
"RTN","ORWCV",36,0)
 I '$D(^XTMP(NODE,0)) Q                    ; XTMP node has been purged
"RTN","ORWCV",37,0)
 L +^XTMP(NODE)
"RTN","ORWCV",38,0)
 S ^XTMP(NODE,"DFN")=DFN
"RTN","ORWCV",39,0)
 ;N $ETRAP,$ESTACK
"RTN","ORWCV",40,0)
 ;S $ETRAP="D ERR^ORWCV Q"
"RTN","ORWCV",41,0)
 I $L($G(FILE),";")>0 F IFLE=1:1:$L(FILE,";") S ORFNUM=$P(FILE,";",IFLE)  Q:'$D(^ORD(101.24,+ORFNUM,0))  S X0=^(0),X2=$G(^(2)) D
"RTN","ORWCV",42,0)
 . S ID=$P(X0,"^",2),ENT=$P(X0,"^",6),RTN=$P(X0,"^",5),PARAM1=$P(X2,"^"),PARAM2=$P(X2,"^",2),INODE=$P(X2,"^",5),DETAIL=""
"RTN","ORWCV",43,0)
 . I $P(X0,"^",18) S DETAIL=$P($G(^ORD(101.24,+$P(X0,"^",18),0)),"^",13),DETAIL=$P($G(^XWB(8994,+DETAIL,0)),"^")
"RTN","ORWCV",44,0)
 . I '$L(INODE) Q
"RTN","ORWCV",45,0)
 . I '$L(ENT) S LST(IFLE)="0^ERROR: Missing ENTRY POINT field in file 101.24 for "_$P(X0,"^")_", IFN="_+ORFNUM D LST2XTMP(INODE) Q
"RTN","ORWCV",46,0)
 . I '$L(RTN) S LST(IFLE)="0^ERROR: Missing ROUTINE field in file 101.24 for "_$P(X0,"^")_", IFN="_+ORFNUM D LST2XTMP(INODE) Q
"RTN","ORWCV",47,0)
 . I '$L($T(@(ENT_"^"_RTN))) S LST(IFLE)="0^ERROR: "_ENT_"~"_RTN_" does not exist. See file 101.24 entry: "_$P(X0,"^")_", IFN="_+ORFNUM D LST2XTMP(INODE) Q
"RTN","ORWCV",48,0)
 . I ID=50 D:$L($T(STRT3^AWCMCPR1)) STRT3^AWCMCPR1 D  D:$L($T(END^AWCMCPR1)) END^AWCMCPR1 Q  ;Special case for reminders
"RTN","ORWCV",49,0)
 .. I $G(NEWREM) D APPL^ORQQPXRM(.LST,DFN,LOC) I 1
"RTN","ORWCV",50,0)
 .. E  D @(ENT_"^"_RTN_"(.LST,DFN)")
"RTN","ORWCV",51,0)
 .. D LST2XTMP(INODE)
"RTN","ORWCV",52,0)
 . I $L(PARAM1),$L(PARAM2) D @(ENT_"^"_RTN_"(.LST,DFN,PARAM1,PARAM2)"),LST2XTMP(INODE) Q
"RTN","ORWCV",53,0)
 . I $L(PARAM1) D @(ENT_"^"_RTN_"(.LST,DFN,PARAM1)"),LST2XTMP(INODE) Q
"RTN","ORWCV",54,0)
 . D @(ENT_"^"_RTN_"(.LST,DFN)"),LST2XTMP(INODE)
"RTN","ORWCV",55,0)
 S ^XTMP(NODE,"DONE")=1
"RTN","ORWCV",56,0)
 I $G(^XTMP(NODE,"STOP")) K ^XTMP(NODE)
"RTN","ORWCV",57,0)
 L -^XTMP(NODE)
"RTN","ORWCV",58,0)
 Q
"RTN","ORWCV",59,0)
ERR ;Error trap
"RTN","ORWCV",60,0)
 S $ETRAP="D UNWIND^ORWCV Q"
"RTN","ORWCV",61,0)
 I $D(NODE) D
"RTN","ORWCV",62,0)
 . I $D(INODE) S LST(0)="",LST(1)="0^ERROR DURING COVER SHEET BUILD:"_$ZERROR D LST2XTMP(INODE)
"RTN","ORWCV",63,0)
 . S ^XTMP(NODE,"DONE")=1
"RTN","ORWCV",64,0)
 . L -^XTMP(NODE)
"RTN","ORWCV",65,0)
 D @^%ZOSF("ERRTN") ;file error
"RTN","ORWCV",66,0)
 S $ECODE=",UOR70 error during Cover Sheet build,"
"RTN","ORWCV",67,0)
 Q
"RTN","ORWCV",68,0)
UNWIND ;Unwind Error stack
"RTN","ORWCV",69,0)
 Q:$ESTACK>1  ;pop the stack
"RTN","ORWCV",70,0)
 ;add additional code here, if needed
"RTN","ORWCV",71,0)
 Q
"RTN","ORWCV",72,0)
LST2XTMP(ID)     ; put the list in ^XTMP(NODE,ID)
"RTN","ORWCV",73,0)
 I $G(^XTMP(NODE,"STOP")) Q
"RTN","ORWCV",74,0)
 N I
"RTN","ORWCV",75,0)
 I $L($G(DETAIL)) S I=0 F  S I=$O(LST(I)) Q:'I  S $P(LST(I),"^",12)=DETAIL
"RTN","ORWCV",76,0)
 K ^XTMP(NODE,ID) M ^XTMP(NODE,ID)=LST S ^XTMP(NODE,ID)=1 K LST
"RTN","ORWCV",77,0)
 Q
"RTN","ORWCV",78,0)
POLL(LST,DFN,IP,HWND)       ; poll for completed cover sheet parts
"RTN","ORWCV",79,0)
 N I,ILST,ID,NODE,DONE
"RTN","ORWCV",80,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN,ILST=0,DONE=0
"RTN","ORWCV",81,0)
 I '$D(^XTMP(NODE,"DFN")) Q
"RTN","ORWCV",82,0)
 I ^XTMP(NODE,"DFN")'=DFN S LST(1)="~DONE=1" Q
"RTN","ORWCV",83,0)
 I $G(^XTMP(NODE,"DONE")) S ILST=ILST+1,LST(ILST)="~DONE=1",DONE=1
"RTN","ORWCV",84,0)
 F ID="PROB","CWAD","MEDS","RMND","LABS","VITL","VSIT" D
"RTN","ORWCV",85,0)
 . I '$G(^XTMP(NODE,ID)) Q
"RTN","ORWCV",86,0)
 . S ILST=ILST+1,LST(ILST)="~"_ID
"RTN","ORWCV",87,0)
 . S I=0 F  S I=$O(^XTMP(NODE,ID,I)) Q:'I  S ILST=ILST+1,LST(ILST)="i"_^(I)
"RTN","ORWCV",88,0)
 . K ^XTMP(NODE,ID)
"RTN","ORWCV",89,0)
 ; Stop capacity planning timing clock - was started in START code
"RTN","ORWCV",90,0)
 I DONE K ^XTMP(NODE) I +$G(^KMPTMP("KMPD-CPRS")) S $P(^KMPTMP("KMPDT","ORWCV",NODE),"^",2)=$H
"RTN","ORWCV",91,0)
 Q
"RTN","ORWCV",92,0)
STOP(OK,DFN,IP,HWND)    ; stop cover sheet data retrieval
"RTN","ORWCV",93,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN,ILST=0,DONE=0
"RTN","ORWCV",94,0)
 S ^XTMP(NODE,"STOP")=1,OK=1
"RTN","ORWCV",95,0)
 L +^XTMP(NODE)
"RTN","ORWCV",96,0)
 I $G(^XTMP(NODE,"DONE")) K ^XTMP(NODE)
"RTN","ORWCV",97,0)
 L -^XTMP(NODE)
"RTN","ORWCV",98,0)
 Q
"RTN","ORWCV",99,0)
CLEAN ; clean up ^XTMP nodes
"RTN","ORWCV",100,0)
 S X="ORWCV"
"RTN","ORWCV",101,0)
 F  S X=$O(^XTMP(X)) Q:$E(X,1,5)'="ORWCV"  W !,X K ^XTMP(X)
"RTN","ORWCV",102,0)
 Q
"RTN","ORWCV",103,0)
LAB(LST,DFN)    ; return labs for patient
"RTN","ORWCV",104,0)
 D:$L($T(STRT2^AWCMCPR1)) STRT2^AWCMCPR1
"RTN","ORWCV",105,0)
 D LIST^ORQOR1(.LST,DFN,"LAB",4,"T-"_$$RNGLAB(DFN),"T","AW",1)
"RTN","ORWCV",106,0)
 D:$L($T(END^AWCMCPR1)) END^AWCMCPR1
"RTN","ORWCV",107,0)
 Q
"RTN","ORWCV",108,0)
VST(ORVISIT,DFN,BEG,END,SKIP)    ; return appts/admissions for patient
"RTN","ORWCV",109,0)
 N VAERR,VASD,BDT,COUNT,DTM,EDT,LOC,NOW,ORQUERY,ORLST,STI,STS,TODAY,I,J,K,XI,XE,X
"RTN","ORWCV",110,0)
 S NOW=$$NOW^XLFDT(),TODAY=$P(NOW,".",1)
"RTN","ORWCV",111,0)
 I '$G(BEG) S BEG=$$X2FM($$RNGVBEG)
"RTN","ORWCV",112,0)
 I '$G(END) S END=$$X2FM($$RNGVEND)+0.2359
"RTN","ORWCV",113,0)
 S COUNT=0
"RTN","ORWCV",114,0)
 K ^TMP("ORVSTLIST",$J)
"RTN","ORWCV",115,0)
 I END>NOW D   ; get future encounters, past cancels/no-shows from VADPT
"RTN","ORWCV",116,0)
 . S VASD("F")=BEG
"RTN","ORWCV",117,0)
 . S VASD("T")=END
"RTN","ORWCV",118,0)
 . S VASD("W")="123456789"
"RTN","ORWCV",119,0)
 . D SDA^VADPT
"RTN","ORWCV",120,0)
 . S I=0 F  S I=$O(^UTILITY("VASD",$J,I)) Q:'I  D
"RTN","ORWCV",121,0)
 . . S XI=^UTILITY("VASD",$J,I,"I"),XE=^("E")
"RTN","ORWCV",122,0)
 . . S DTM=$P(XI,U),IEN=$P(XI,U,2),STI=$P(XI,U,3)
"RTN","ORWCV",123,0)
 . . S LOC=$P(XE,U,2),STS=$P(XE,U,3)
"RTN","ORWCV",124,0)
 . . I DTM<TODAY,(STI=""!(STI["I")!(STI="NT")) Q  ; no prior kept appts
"RTN","ORWCV",125,0)
 . . S ^TMP("ORVSTLIST",$J,DTM,"A",1)="A;"_DTM_";"_IEN_U_DTM_U_LOC_U_STS
"RTN","ORWCV",126,0)
 . K ^UTILITY("VASD",$J)
"RTN","ORWCV",127,0)
 I BEG'>NOW D  ;past encounters from ACRP Toolkit - set in CALLBACK
"RTN","ORWCV",128,0)
 . S BDT=BEG
"RTN","ORWCV",129,0)
 . S EDT=$S(END<NOW:END,1:NOW)
"RTN","ORWCV",130,0)
 . D OPEN^SDQ(.ORQUERY)
"RTN","ORWCV",131,0)
 . I '$$ERRCHK^SDQUT() D INDEX^SDQ(.ORQUERY,"PATIENT/DATE","SET")
"RTN","ORWCV",132,0)
 . I '$$ERRCHK^SDQUT() D PAT^SDQ(.ORQUERY,DFN,"SET")
"RTN","ORWCV",133,0)
 . I '$$ERRCHK^SDQUT() D DATE^SDQ(.ORQUERY,BDT,EDT,"SET")
"RTN","ORWCV",134,0)
 . I '$$ERRCHK^SDQUT() D
"RTN","ORWCV",135,0)
 . . S ORLST=$NA(^TMP("ORVSTLIST",$J))
"RTN","ORWCV",136,0)
 . . D SCANCB^SDQ(.ORQUERY,"D CALLBACK^ORWCV(Y,Y0,.ORLST,.ORSTOP)","SET")
"RTN","ORWCV",137,0)
 . I '$$ERRCHK^SDQUT() D ACTIVE^SDQ(.ORQUERY,"TRUE","SET")
"RTN","ORWCV",138,0)
 . I '$$ERRCHK^SDQUT() D SCAN^SDQ(.ORQUERY,"FORWARD")
"RTN","ORWCV",139,0)
 . D CLOSE^SDQ(.ORQUERY)
"RTN","ORWCV",140,0)
 ;
"RTN","ORWCV",141,0)
 I '$G(SKIP) D
"RTN","ORWCV",142,0)
 . N TIM,MOV,X0,Y,MTIM,XTYP,XLOC,HLOC,EARLY,DONE                ; admits
"RTN","ORWCV",143,0)
 . S EARLY=$$X2FM($$RNGVBEG),DONE=0
"RTN","ORWCV",144,0)
 . S TIM="" F  S TIM=$O(^DGPM("ATID1",DFN,TIM)) Q:TIM'>0  D  Q:DONE
"RTN","ORWCV",145,0)
 . . S MOV=0  F  S MOV=$O(^DGPM("ATID1",DFN,TIM,MOV)) Q:MOV'>0  D  Q:DONE
"RTN","ORWCV",146,0)
 . . . S X0=^DGPM(MOV,0),MTIM=$P(X0,U)
"RTN","ORWCV",147,0)
 . . . I MTIM<EARLY S DONE=1 Q
"RTN","ORWCV",148,0)
 . . . S XTYP=$P($G(^DG(405.1,+$P(X0,U,4),0)),U,1)
"RTN","ORWCV",149,0)
 . . . S XLOC=$P($G(^DIC(42,+$P(X0,U,6),0)),U,1),HLOC=+$G(^(44))
"RTN","ORWCV",150,0)
 . . . S ^TMP("ORVSTLIST",$J,MTIM,"I",1)="I;"_MTIM_";"_HLOC_U_MTIM_U_"Inpatient Stay"_U_XLOC_U_XTYP
"RTN","ORWCV",151,0)
 ;
"RTN","ORWCV",152,0)
 S COUNT=0
"RTN","ORWCV",153,0)
 S I=0 F  S I=$O(^TMP("ORVSTLIST",$J,I)) Q:'I  D
"RTN","ORWCV",154,0)
 . S J="" F  S J=$O(^TMP("ORVSTLIST",$J,I,J)) Q:J=""  D
"RTN","ORWCV",155,0)
 . . S K=0 F  S K=$O(^TMP("ORVSTLIST",$J,I,J,K)) Q:'K  D
"RTN","ORWCV",156,0)
 . . . S COUNT=COUNT+1
"RTN","ORWCV",157,0)
 . . . S ORVISIT(COUNT)=^TMP("ORVSTLIST",$J,I,J,K)
"RTN","ORWCV",158,0)
 K ^TMP("ORVSTLIST",$J)
"RTN","ORWCV",159,0)
 Q
"RTN","ORWCV",160,0)
CALLBACK(IEN,NODE0,ARRAY,STOP) ; called back from ACRP Toolkit for encounters
"RTN","ORWCV",161,0)
 ;
"RTN","ORWCV",162,0)
 ; IEN and NODE0 relate to Outpatient Encounter File
"RTN","ORWCV",163,0)
 ; set STOP to 1 if need to quit
"RTN","ORWCV",164,0)
 ;
"RTN","ORWCV",165,0)
 N COUNT,DTM,LOC,OOS,TYPE,XSTAT,XLOC
"RTN","ORWCV",166,0)
 S DTM=+NODE0,COUNT=1
"RTN","ORWCV",167,0)
 S LOC=$P(NODE0,"^",4)
"RTN","ORWCV",168,0)
 S XLOC=$P($G(^SC(+LOC,0)),U),OOS=$G(^("OOS"))
"RTN","ORWCV",169,0)
 I OOS Q              ; ignore OOS locations
"RTN","ORWCV",170,0)
 I $P(NODE0,"^",6) Q  ; not parent encounter
"RTN","ORWCV",171,0)
 S XSTAT=$P($G(^SD(409.63,+$P(NODE0,"^",12),0)),"^")
"RTN","ORWCV",172,0)
 S TYPE=$S($P(NODE0,"^",8)=1:"A",1:"V")
"RTN","ORWCV",173,0)
 I TYPE="V",$D(@ARRAY@(DTM,"V")) S COUNT=$O(@ARRAY@(DTM,"V","A"),-1)+1 ; same d/t
"RTN","ORWCV",174,0)
 S @ARRAY@(DTM,TYPE,COUNT)=TYPE_";"_DTM_";"_LOC_U_DTM_U_XLOC_U_XSTAT
"RTN","ORWCV",175,0)
 Q
"RTN","ORWCV",176,0)
DTLVST(RPT,DFN,IEN,X)   ; return progress notes / discharge summary
"RTN","ORWCV",177,0)
 N VISIT
"RTN","ORWCV",178,0)
 I $P(X,";")="A" D
"RTN","ORWCV",179,0)
 . S VISIT=$$APPT2VST^PXAPI(DFN,$P(X,";",2),$P(X,";",3))
"RTN","ORWCV",180,0)
 . I VISIT=0 S VISIT=+$$GETENC^PXAPI(DFN,$P(X,";",2),$P(X,";",3))
"RTN","ORWCV",181,0)
 . D DETNOTE^ORQQVS(.RPT,DFN,VISIT)
"RTN","ORWCV",182,0)
 I $P(X,";")="V" D
"RTN","ORWCV",183,0)
 . S VISIT=+$$GETENC^PXAPI(DFN,$P(X,";",2),$P(X,";",3))
"RTN","ORWCV",184,0)
 . D DETNOTE^ORQQVS(.RPT,DFN,VISIT)
"RTN","ORWCV",185,0)
 I $P(X,";")="I" D
"RTN","ORWCV",186,0)
 . S VISIT=+$$GETENC^PXAPI(DFN,$P(X,";",2),$P(X,";",3))
"RTN","ORWCV",187,0)
 . D DETSUM^ORQQVS(.RPT,DFN,VISIT)
"RTN","ORWCV",188,0)
 . K ^TMP("PXKENC",$J)
"RTN","ORWCV",189,0)
 Q
"RTN","ORWCV",190,0)
X2FM(X)       ; return FM date given relative date
"RTN","ORWCV",191,0)
 N %DT S %DT="TS" D ^%DT
"RTN","ORWCV",192,0)
 Q Y
"RTN","ORWCV",193,0)
RNGLAB(DFN)     ; return days back for patient
"RTN","ORWCV",194,0)
 N INPT,PAR
"RTN","ORWCV",195,0)
 S INPT=0 I $L($G(^DPT(DFN,.1))) S INPT=1
"RTN","ORWCV",196,0)
 S PAR="ORQQLR DATE RANGE "_$S(INPT:"INPT",1:"OUTPT")
"RTN","ORWCV",197,0)
 Q $$GET^XPAR("ALL",PAR,1,"I")
"RTN","ORWCV",198,0)
 ;
"RTN","ORWCV",199,0)
RNGVBEG()       ; return start date for encounters
"RTN","ORWCV",200,0)
 Q $$GET^XPAR("ALL","ORQQCSDR CS RANGE START",1,"I")
"RTN","ORWCV",201,0)
 ;
"RTN","ORWCV",202,0)
RNGVEND()       ; return stop date for encounters
"RTN","ORWCV",203,0)
 Q $$GET^XPAR("ALL","ORQQCSDR CS RANGE STOP",1,"I")
"RTN","ORWCV",204,0)
 ;
"RTN","ORWCV",205,0)
RANGES(REC,DFN) ; return ranges given a patient
"RTN","ORWCV",206,0)
 N REC
"RTN","ORWCV",207,0)
 S REC=$$RNGLAB(DFN)_U_$$RNGVBEG_U_$$RNGVEND
"RTN","ORWCV",208,0)
 Q
"RTN","ORWDAL32")
0^17^B23860663
"RTN","ORWDAL32",1,0)
ORWDAL32 ; SLC/REV - Allergy calls to support windows ;8/9/04  10:42
"RTN","ORWDAL32",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,190,195**;Dec 17, 1997
"RTN","ORWDAL32",3,0)
 ;
"RTN","ORWDAL32",4,0)
DEF(LST) ; Get dialog data for allergies
"RTN","ORWDAL32",5,0)
 N ILST,I,X S ILST=0
"RTN","ORWDAL32",6,0)
 S LST($$NXT)="~Allergy Types" D ALLGYTYP
"RTN","ORWDAL32",7,0)
 S LST($$NXT)="~Reactions" D ALLGYTYP
"RTN","ORWDAL32",8,0)
 S LST($$NXT)="~Nature of Reaction" D NATREACT
"RTN","ORWDAL32",9,0)
 S LST($$NXT)="~Top Ten" D TOPTEN
"RTN","ORWDAL32",10,0)
 S LST($$NXT)="~Observ/Hist" D OBSHIST
"RTN","ORWDAL32",11,0)
 S LST($$NXT)="~Severity" D SEVERITY
"RTN","ORWDAL32",12,0)
 Q
"RTN","ORWDAL32",13,0)
GMRASITE(ORY)   ;Return GMRA Site Params
"RTN","ORWDAL32",14,0)
 N GMRASITE
"RTN","ORWDAL32",15,0)
 D SITE^GMRAUTL
"RTN","ORWDAL32",16,0)
 S ORY=$G(^GMRD(120.84,GMRASITE,0))
"RTN","ORWDAL32",17,0)
 Q
"RTN","ORWDAL32",18,0)
TOPTEN ;  Get top ten symptoms from Allergy Site Parameters file
"RTN","ORWDAL32",19,0)
 N X0,I,CNT S I=0,X0="",CNT=0
"RTN","ORWDAL32",20,0)
 F  S I=$O(^GMRD(120.84,1,1,I)),CNT=CNT+1 Q:+I=0!(CNT>10)  D
"RTN","ORWDAL32",21,0)
 . S X0=^GMRD(120.84,1,1,I,0) Q:'$D(^GMRD(120.83,X0))  Q:$P(^GMRD(120.83,X0,0),"^")="OTHER REACTION"  ;Don't send this entry
"RTN","ORWDAL32",22,0)
 . S LST($$NXT)="i"_X0_U_$P($G(^GMRD(120.83,X0,0)),U,1)
"RTN","ORWDAL32",23,0)
 Q
"RTN","ORWDAL32",24,0)
ALLSRCH(Y,X) ; Return list of partial matches  ; CHANGED TO PRODUCE TREEVIEW IN GUI
"RTN","ORWDAL32",25,0)
 N ORX,ROOT,XP,CNT,ORFILE,ORSRC,ORIEN,ORREAX S ORIEN=0,CNT=0,ORSRC=0,ORFILE="",ORREAX=""
"RTN","ORWDAL32",26,0)
 S ORX=X,X=$$UP^XLFSTR(X)
"RTN","ORWDAL32",27,0)
 F ROOT="^GMRD(120.82,""B"")","^GMRD(120.82,""D"")",$$B^PSNAPIS,$$T^PSNAPIS,"^PSDRUG(""B"")","^PSDRUG(""C"")","^PS(50.416,""P"")","^PS(50.605,""C"")" D
"RTN","ORWDAL32",28,0)
 . S ORSRC=ORSRC+1,ORFILE=$P(ROOT,",",1)_")",ORSRC(ORSRC)=$P($T(FILENAME+ORSRC),";;",2)
"RTN","ORWDAL32",29,0)
 . I (ORSRC'=2),(ORSRC'=6) S CNT=CNT+1,Y(CNT)=ORSRC_U_ORSRC(ORSRC)_U_U_U_"TOP"_U_"+"
"RTN","ORWDAL32",30,0)
 . I $D(@ROOT@(X)) D
"RTN","ORWDAL32",31,0)
 . . I ORSRC=1,X="OTHER ALLERGY/ADVERSE REACTION" Q  ;don't send this entry
"RTN","ORWDAL32",32,0)
 . . S ORIEN=$O(@ROOT@(X,0))
"RTN","ORWDAL32",33,0)
 . . I ORSRC=2 S CNT=CNT+1,Y(CNT)=ORIEN_U_$P($G(^GMRD(120.82,+ORIEN,0)),U,1)_" <"_X_">"_ROOT
"RTN","ORWDAL32",34,0)
 . . E  I ORSRC=6 S CNT=CNT+1,Y(CNT)=ORIEN_U_$P($G(^PSDRUG(+ORIEN,0)),U,1)_" <"_X_">"_ROOT
"RTN","ORWDAL32",35,0)
 . . E  S CNT=CNT+1,Y(CNT)=ORIEN_U_X_ROOT
"RTN","ORWDAL32",36,0)
 . . S ORREAX=$S($P(Y(CNT),U,3)?1"GMR".E:$P($G(^GMRD(120.82,+Y(CNT),0)),U,2),1:"D")
"RTN","ORWDAL32",37,0)
 . . S Y(CNT)=Y(CNT)_U_ORREAX_U_$S(ORSRC=2:1,ORSRC=6:5,1:ORSRC)
"RTN","ORWDAL32",38,0)
 . S XP=X F  S XP=$O(@ROOT@(XP)) Q:XP=""  Q:$E(XP,1,$L(X))'=X  D
"RTN","ORWDAL32",39,0)
 . . I ORSRC=1,XP="OTHER ALLERGY/ADVERSE REACTION" Q  ;don't send this entry
"RTN","ORWDAL32",40,0)
 . . S ORIEN=$O(@ROOT@(XP,0))
"RTN","ORWDAL32",41,0)
 . . I ORSRC=2 S CNT=CNT+1,Y(CNT)=ORIEN_U_$P($G(^GMRD(120.82,+ORIEN,0)),U,1)_" <"_XP_">"_ROOT ; partial matches
"RTN","ORWDAL32",42,0)
 . . E  I ORSRC=6 S CNT=CNT+1,Y(CNT)=ORIEN_U_$P($G(^PSDRUG(+ORIEN,0)),U,1)_" <"_XP_">"_ROOT ; partial matches
"RTN","ORWDAL32",43,0)
 . . E  S CNT=CNT+1,Y(CNT)=ORIEN_U_XP_ROOT
"RTN","ORWDAL32",44,0)
 . . S ORREAX=$S($P(Y(CNT),U,3)?1"GMR".E:$P($G(^GMRD(120.82,+Y(CNT),0)),U,2),1:"D")
"RTN","ORWDAL32",45,0)
 . . S Y(CNT)=Y(CNT)_U_ORREAX_U_$S(ORSRC=2:1,ORSRC=6:5,1:ORSRC)
"RTN","ORWDAL32",46,0)
 Q
"RTN","ORWDAL32",47,0)
FILENAME        ; Display text of filenames for search treeview
"RTN","ORWDAL32",48,0)
 ;;VA Allergies File
"RTN","ORWDAL32",49,0)
 ;;VA Allergies File (Synonyms)  SPACER ONLY - NOT DISPLAYED
"RTN","ORWDAL32",50,0)
 ;;National Drug File - Generic Drug Name
"RTN","ORWDAL32",51,0)
 ;;National Drug file - Trade Name
"RTN","ORWDAL32",52,0)
 ;;Local Drug File
"RTN","ORWDAL32",53,0)
 ;;Local Drug File (Synonyms)  SPACER ONLY - NOT DISPLAYED
"RTN","ORWDAL32",54,0)
 ;;Drug Ingredients File
"RTN","ORWDAL32",55,0)
 ;;VA Drug Class File
"RTN","ORWDAL32",56,0)
 ;;
"RTN","ORWDAL32",57,0)
NATREACT ; Get the NATURE OF REACTION types
"RTN","ORWDAL32",58,0)
 ;Removing "R^Adverse Reaction" from choices below until we can add it as a choice in the nature of reaction/mechanism file
"RTN","ORWDAL32",59,0)
 F X="A^Allergy","P^Pharmacological","U^Unknown" D
"RTN","ORWDAL32",60,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDAL32",61,0)
 Q
"RTN","ORWDAL32",62,0)
ALLGYTYP ; Get the allergy types
"RTN","ORWDAL32",63,0)
 F X="D^Drug","F^Food","O^Other","DF^Drug,Food","DO^Drug,Other","FO^Food,Other","DFO^Drug,Food,Other" D
"RTN","ORWDAL32",64,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDAL32",65,0)
 Q
"RTN","ORWDAL32",66,0)
OBSHIST ; Observed or historical
"RTN","ORWDAL32",67,0)
 F X="o^Observed","h^Historical" D
"RTN","ORWDAL32",68,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDAL32",69,0)
 Q
"RTN","ORWDAL32",70,0)
SEVERITY ; Severity
"RTN","ORWDAL32",71,0)
 F X="3^Severe","2^Moderate","1^Mild" D
"RTN","ORWDAL32",72,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDAL32",73,0)
 Q
"RTN","ORWDAL32",74,0)
SYMPTOMS(Y,FROM,DIR) ; Return a subset of symptoms
"RTN","ORWDAL32",75,0)
 ; .Return Array, Starting Text, Direction
"RTN","ORWDAL32",76,0)
 N I,IEN,CNT,X S I=0,CNT=44
"RTN","ORWDAL32",77,0)
 F  Q:I'<CNT  S FROM=$O(^GMRD(120.83,"B",FROM),DIR) Q:FROM=""  D
"RTN","ORWDAL32",78,0)
 . I FROM="OTHER REACTION" Q  ;Don't send this entry
"RTN","ORWDAL32",79,0)
 . S IEN=0 F  S IEN=$O(^GMRD(120.83,"B",FROM,IEN)) Q:'IEN  D
"RTN","ORWDAL32",80,0)
 . . S I=I+1
"RTN","ORWDAL32",81,0)
 . . S Y(I)=IEN_U_FROM
"RTN","ORWDAL32",82,0)
 Q
"RTN","ORWDAL32",83,0)
NXT() ; Increment index of LST
"RTN","ORWDAL32",84,0)
 S ILST=ILST+1
"RTN","ORWDAL32",85,0)
 Q ILST
"RTN","ORWDAL32",86,0)
EDITLOAD(Y,ORALIEN)     ; Load an allergy/adverse reaction for editing
"RTN","ORWDAL32",87,0)
 Q:+$G(ORALIEN)=0
"RTN","ORWDAL32",88,0)
 N ORNODE,I
"RTN","ORWDAL32",89,0)
 S ORNODE=$NAME(^TMP("GMRA",$J)),I=0
"RTN","ORWDAL32",90,0)
 ;following patch check is made via GUI RPC call to ORWU PATCH instead
"RTN","ORWDAL32",91,0)
 ;I '$$PATCH^XPDUTL("GMRA*4.0*21") S @ORNODE@(0)="-1^Not yet implemented",Y=ORNODE Q
"RTN","ORWDAL32",92,0)
 D GETREC^GMRAGUI(ORALIEN,ORNODE)
"RTN","ORWDAL32",93,0)
 S Y=ORNODE
"RTN","ORWDAL32",94,0)
 Q
"RTN","ORWDAL32",95,0)
EDITSAVE(ORY,ORALIEN,ORDFN,OREDITED)      ; Save Edit/Add of an allergy/adverse reaction
"RTN","ORWDAL32",96,0)
 ;following patch check is made via GUI RPC call to ORWU PATCH instead
"RTN","ORWDAL32",97,0)
 ;I '$$PATCH^XPDUTL("GMRA*4.0*21") S Y="-1^Not yet implemented" Q
"RTN","ORWDAL32",98,0)
 N ORNODE
"RTN","ORWDAL32",99,0)
 S ORNODE=$NAME(^TMP("GMRA",$J))
"RTN","ORWDAL32",100,0)
 K @ORNODE M @ORNODE=OREDITED
"RTN","ORWDAL32",101,0)
 S ORY=0
"RTN","ORWDAL32",102,0)
 I $G(@ORNODE@("GMRAERR"))="YES" D EIE^GMRAGUI1(ORALIEN,ORDFN,ORNODE) Q  ;Handle entered in error
"RTN","ORWDAL32",103,0)
 I $G(@ORNODE@("GMRANKA"))="YES" D NKA^GMRAGUI1 Q
"RTN","ORWDAL32",104,0)
 D UPDATE^GMRAGUI1(ORALIEN,ORDFN,ORNODE) Q  ;Add/edit reactions
"RTN","ORWDAL32",105,0)
 Q
"RTN","ORWDAL32",106,0)
SENDBULL(Y,ORDUZ,ORDFN,ORTEXT,ORCMTS)      ; Send bulletin if user attempts free-text entry
"RTN","ORWDAL32",107,0)
 I '$$PATCH^XPDUTL("GMRA*4.0*17") S Y="-1^Unable to send bulletin." Q
"RTN","ORWDAL32",108,0)
 I '$D(ORCMTS) D
"RTN","ORWDAL32",109,0)
 . S Y=$$SENDREQ^GMRAPES0(ORDUZ,ORDFN,ORTEXT)
"RTN","ORWDAL32",110,0)
 E  D
"RTN","ORWDAL32",111,0)
 . S Y=$$SENDREQ^GMRAPES0(ORDUZ,ORDFN,ORTEXT,.ORCMTS)
"RTN","ORWDAL32",112,0)
 Q
"RTN","ORWDBA1")
0^32^B53124161
"RTN","ORWDBA1",1,0)
ORWDBA1 ;; SLC OIFO/DKK/GSS - Order Dialogs Billing Awareness;[10/21/03 3:16pm]
"RTN","ORWDBA1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**190,195**;Dec 17, 1997
"RTN","ORWDBA1",3,0)
 ;
"RTN","ORWDBA1",4,0)
 ; External References
"RTN","ORWDBA1",5,0)
 ;   DBIA    406  CL^SDCO21 - call to determine Treatment Factors
"RTN","ORWDBA1",6,0)
 ;
"RTN","ORWDBA1",7,0)
 ;Ref to ^DIC(9.4 - DBIA ___
"RTN","ORWDBA1",8,0)
 ;BA refers to Billing Awareness Project
"RTN","ORWDBA1",9,0)
 ;CIDC refers to Clinical Indicator Data Capture (same project 3/10/2004)
"RTN","ORWDBA1",10,0)
 ;Treatment Factors (TxF) refer to SC,AO,IR,EC,MST,HNC,CV
"RTN","ORWDBA1",11,0)
 ;
"RTN","ORWDBA1",12,0)
GETORDX(Y,ORIEN) ; Retrieve Diagnoses for an order - RPC
"RTN","ORWDBA1",13,0)
 ; Input:
"RTN","ORWDBA1",14,0)
 ;   ORIEN    Order Internal ID#
"RTN","ORWDBA1",15,0)
 ; Output:
"RTN","ORWDBA1",16,0)
 ;   Y        Array of Diagnoses (Dx) - Y(#)=#^DxInt#^ICD9^DxDesc^TxF
"RTN","ORWDBA1",17,0)
 ; Variables used:
"RTN","ORWDBA1",18,0)
 ;   CT       Counter for # of Dx related to order
"RTN","ORWDBA1",19,0)
 ;   DXIEN    Dx internal ID
"RTN","ORWDBA1",20,0)
 ;   DXN      Internal (to ^OR(100)) sequence # for Dx storage
"RTN","ORWDBA1",21,0)
 ;   DXREC    Dx record from Order file
"RTN","ORWDBA1",22,0)
 ;   DXV      Dx description
"RTN","ORWDBA1",23,0)
 ;   ICD9     External ICD9 #
"RTN","ORWDBA1",24,0)
 ;   TXFACTRS Treatment Factors (TxF)
"RTN","ORWDBA1",25,0)
 ;
"RTN","ORWDBA1",26,0)
 N CT,DXIEN,DXN,DXREC,DXV,ICD9,ICDR,ORFMDAT,TXFACTRS
"RTN","ORWDBA1",27,0)
 S (CT,DXN)=0
"RTN","ORWDBA1",28,0)
 I '$G(^OR(100,ORIEN,0)) S Y=-1
"RTN","ORWDBA1",29,0)
 I '$D(^OR(100,ORIEN,5.1,1,0)) S Y=0
"RTN","ORWDBA1",30,0)
 E  D  S Y=CT
"RTN","ORWDBA1",31,0)
 . ; Get order date for CSV/CTD/HIPAA usage
"RTN","ORWDBA1",32,0)
 . S ORFMDAT=$$ORFMDAT^ORWDBA3(ORIEN)
"RTN","ORWDBA1",33,0)
 . ; Go through all Dx's for an order
"RTN","ORWDBA1",34,0)
 . F  S DXN=$O(^OR(100,ORIEN,5.1,DXN)) Q:DXN'?1N.N  D
"RTN","ORWDBA1",35,0)
 .. ; Get diagnosis record and IEN
"RTN","ORWDBA1",36,0)
 .. S DXREC=$G(^OR(100,ORIEN,5.1,DXN,0)),DXIEN=$P(DXREC,U)
"RTN","ORWDBA1",37,0)
 .. S ICDR=$$ICDDX^ICDCODE($G(DXIEN),ORFMDAT)
"RTN","ORWDBA1",38,0)
 .. S DXV=$P(ICDR,U,4),ICD9=$P(ICDR,U,2)
"RTN","ORWDBA1",39,0)
 .. ; Convert internal to external Treatment Factors
"RTN","ORWDBA1",40,0)
 .. S TXFACTRS=$$TFGBLGUI(^OR(100,ORIEN,5.2))
"RTN","ORWDBA1",41,0)
 .. S CT=CT+1,Y(CT)=DXN_U_$G(DXIEN)_U_ICD9_U_DXV_U_TXFACTRS
"RTN","ORWDBA1",42,0)
 Q
"RTN","ORWDBA1",43,0)
 ;
"RTN","ORWDBA1",44,0)
SCLST(Y,DFN,ORLST) ; RPC for compiling appropriate TxF's
"RTN","ORWDBA1",45,0)
 ; RPC titled ORWDBA1 SCLST
"RTN","ORWDBA1",46,0)
 ;
"RTN","ORWDBA1",47,0)
 ;  Y       =    Returned value
"RTN","ORWDBA1",48,0)
 ;  DFN     =    Patient IEN
"RTN","ORWDBA1",49,0)
 ;  ORLST   =    List of orders
"RTN","ORWDBA1",50,0)
 ;
"RTN","ORWDBA1",51,0)
 ; call for BA/TF
"RTN","ORWDBA1",52,0)
 N GMRCPROS,ORD,ORI,ORPKG
"RTN","ORWDBA1",53,0)
 D CPLSTBA(.Y,DFN,.ORLST)
"RTN","ORWDBA1",54,0)
 Q
"RTN","ORWDBA1",55,0)
 ;
"RTN","ORWDBA1",56,0)
CPLSTBA(TEST,PTIFN,ORIFNS) ; set-up SC/TFs for BA
"RTN","ORWDBA1",57,0)
 ;
"RTN","ORWDBA1",58,0)
 ;  TEST    =  Returned value
"RTN","ORWDBA1",59,0)
 ;  PTIFN   =  Patient IEN
"RTN","ORWDBA1",60,0)
 ;  ORIFNS  =  List of orders
"RTN","ORWDBA1",61,0)
 ;
"RTN","ORWDBA1",62,0)
 S ORI=""
"RTN","ORWDBA1",63,0)
 ;
"RTN","ORWDBA1",64,0)
 ; define array of packages for which BA data collected (SC/CIs)
"RTN","ORWDBA1",65,0)
 ;  GMRC    =  Consult/Request Tracking (#128) - Prosthetics
"RTN","ORWDBA1",66,0)
 ;  LR      =  Lab Services (#26) - Lab
"RTN","ORWDBA1",67,0)
 ;  PSO     =  Outpt Pharmacy (#112) - Outpt Pharmacy (orig. Co-Pay)
"RTN","ORWDBA1",68,0)
 ;  RA      =  Radiology/Nuclear Medicine (#31) - Radiology
"RTN","ORWDBA1",69,0)
 ;
"RTN","ORWDBA1",70,0)
 F I=1:1 S ORPKG=$P("GMRC;LR;PSO;RA",";",I) Q:ORPKG=""  D
"RTN","ORWDBA1",71,0)
 . S ORPKG(+$O(^DIC(9.4,"C",ORPKG,0)))=1  ; ^DIC(9.4) is package file
"RTN","ORWDBA1",72,0)
 ;
"RTN","ORWDBA1",73,0)
 ; get Treatment Factors (TxF) for patient
"RTN","ORWDBA1",74,0)
 D SCPRE(.DR,DFN)
"RTN","ORWDBA1",75,0)
 ;
"RTN","ORWDBA1",76,0)
 ; set TxF's if order is for a package for which BA data is collected
"RTN","ORWDBA1",77,0)
 F  S ORI=$O(ORLST(ORI)) Q:'ORI  S ORD=+ORLST(ORI) D
"RTN","ORWDBA1",78,0)
 . I $G(^OR(100,ORD,0))="" Q
"RTN","ORWDBA1",79,0)
 . I $D(TEST(ORD))!'$D(ORPKG($P($G(^OR(100,ORD,0)),U,14))) Q
"RTN","ORWDBA1",80,0)
 . S TEST(ORD)=ORLST(ORI)_DR
"RTN","ORWDBA1",81,0)
 Q
"RTN","ORWDBA1",82,0)
 ;
"RTN","ORWDBA1",83,0)
SCPRE(DR,DFN) ; Dialog validation, to ask BA questions
"RTN","ORWDBA1",84,0)
 ;
"RTN","ORWDBA1",85,0)
 ;  DR    =  return value
"RTN","ORWDBA1",86,0)
 ;  DFN   =  input patient IEN
"RTN","ORWDBA1",87,0)
 ;
"RTN","ORWDBA1",88,0)
 Q:$G(DFN)=""
"RTN","ORWDBA1",89,0)
 N CPNODE,CT,I,ORX,ORSDCARY,TF,X
"RTN","ORWDBA1",90,0)
 K ORSDCARY
"RTN","ORWDBA1",91,0)
 S (CPNODE,DR,ORX,TF)="",CT=0,X="T"
"RTN","ORWDBA1",92,0)
 ; Call API to acquire Treatment Factors in force
"RTN","ORWDBA1",93,0)
 D NOW^%DTC,CL^SDCO21(DFN,%,"",.ORSDCARY)  ;DBIA 406
"RTN","ORWDBA1",94,0)
 ; Retrved array order: AO,IR,SC,EC,MST,HNC,CV, e.g., ORSDCARY(3) for SC
"RTN","ORWDBA1",95,0)
 ; Convert to ^OR/CPRS GUI order: SC,MST,AO,IR,EC,HNC,CV
"RTN","ORWDBA1",96,0)
 F I=3,5,1,2,4,6,7 S TF=0,CT=CT+1 S:$D(ORSDCARY(I)) TF=1 S $P(CPNODE,U,CT)=TF
"RTN","ORWDBA1",97,0)
 ;
"RTN","ORWDBA1",98,0)
 S X=$S($P(CPNODE,U)=1:"SC",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",99,0)
 S X=$S($P(CPNODE,U,2)=1:"MST",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",100,0)
 S X=$S($P(CPNODE,U,3)=1:"AO",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",101,0)
 S X=$S($P(CPNODE,U,4)=1:"IR",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",102,0)
 S X=$S($P(CPNODE,U,5)=1:"EC",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",103,0)
 S X=$S($P(CPNODE,U,6)=1:"HNC",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",104,0)
 S X=$S($P(CPNODE,U,7)=1:"CV",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",105,0)
 ;
"RTN","ORWDBA1",106,0)
 ; TxF's for patient (TxF's include SC,AO,IR,EC,MST,HNC,CV) where
"RTN","ORWDBA1",107,0)
 ;  SC      =  Service Connected
"RTN","ORWDBA1",108,0)
 ;  AO      =  Agent Orange
"RTN","ORWDBA1",109,0)
 ;  IR      =  Ionizing Radiation
"RTN","ORWDBA1",110,0)
 ;  EC      =  Environmental Contaminants
"RTN","ORWDBA1",111,0)
 ;  MST     =  Military Sexual Trauma
"RTN","ORWDBA1",112,0)
 ;  HNC     =  Head and Neck Cancer
"RTN","ORWDBA1",113,0)
 ;  CV      =  Combat Veteran
"RTN","ORWDBA1",114,0)
 F I="SC","AO","IR","EC","MST","HNC","CV" D
"RTN","ORWDBA1",115,0)
 . I $D(ORX(I)) S DR=DR_U_I_$S($L(ORX(I)):";"_ORX(I),1:"")
"RTN","ORWDBA1",116,0)
 Q
"RTN","ORWDBA1",117,0)
 ;
"RTN","ORWDBA1",118,0)
ORPKGTYP(Y,ORLST) ; Build BA supported packages array
"RTN","ORWDBA1",119,0)
 ; GMRC=Prosthetics, LR=Lab, PSO=Pharmacy, RA=Radiology
"RTN","ORWDBA1",120,0)
 N OIREC,OIV,OIVN
"RTN","ORWDBA1",121,0)
 F I=1:1 S ORPKG=$P("GMRC;LR;PSO;RA",";",I) Q:ORPKG=""  D
"RTN","ORWDBA1",122,0)
 . S ORPKG(+$O(^DIC(9.4,"C",ORPKG,0)))=ORPKG  ; ^DIC(9.4) is package file
"RTN","ORWDBA1",123,0)
 S GMRCPROS=+$O(^DIC(9.4,"C","GMRC",0))
"RTN","ORWDBA1",124,0)
 ; see if order is for a package which BA supports
"RTN","ORWDBA1",125,0)
 D ORPKG1(.Y,.ORLST)
"RTN","ORWDBA1",126,0)
 Q
"RTN","ORWDBA1",127,0)
 ;
"RTN","ORWDBA1",128,0)
ORPKG1(TEST,ORIFNS) ; Order for package BA supports?  TEST(ORI)=1 is YES
"RTN","ORWDBA1",129,0)
 S U="^",ORI=""
"RTN","ORWDBA1",130,0)
 F I=1:1:5 S OIV(I)=$P("PROSTHETICS REQUEST^EYEGLASS REQUEST^CONTACT LENS REQUEST^HOME OXYGEN REQUEST^AMPUTEE/PROSTHETICS CLINIC",U,I)
"RTN","ORWDBA1",131,0)
 F  S ORI=$O(ORIFNS(ORI)) Q:'ORI  S ORD=+ORIFNS(ORI),TEST(ORI)=0 D
"RTN","ORWDBA1",132,0)
 . I ORD=0 Q  ;document/note not an order
"RTN","ORWDBA1",133,0)
 . ;I ORD="CONSULT_DX" S TEST(ORI)=1 Q  ;consult dx prev entered
"RTN","ORWDBA1",134,0)
 . I '$D(^OR(100,ORD,0)) Q  ;invalid order #
"RTN","ORWDBA1",135,0)
 . I $D(^OR(100,ORD,5.1,1,0)) S TEST(ORI)=1 Q  ;
"RTN","ORWDBA1",136,0)
 . I $P(^OR(100,ORD,0),U,14)'?1N.N Q  ;invalid order # or entry
"RTN","ORWDBA1",137,0)
 . I $P(ORIFNS(ORI),";",2)=2 Q  ;canceled order
"RTN","ORWDBA1",138,0)
 . I '$D(ORPKG($P(^OR(100,ORD,0),U,14))) Q  ;pkg not supported
"RTN","ORWDBA1",139,0)
 . ;      IPt OPt (ask BA questions?)
"RTN","ORWDBA1",140,0)
 . ; Pros  Y   Y   GMRC
"RTN","ORWDBA1",141,0)
 . ; Rad   Y   Y   RA
"RTN","ORWDBA1",142,0)
 . ; Lab   N   Y   LR
"RTN","ORWDBA1",143,0)
 . ; Phrm  Y   Y   PSO
"RTN","ORWDBA1",144,0)
 . ; Pt Class = 'I' or 'O' in ^OR
"RTN","ORWDBA1",145,0)
 . I $P(^OR(100,ORD,0),U,12)="I"&(ORPKG($P(^OR(100,ORD,0),U,14))="LR") Q
"RTN","ORWDBA1",146,0)
 . I $P(^OR(100,ORD,0),U,14)=GMRCPROS D  Q  ;check for Pros consult order
"RTN","ORWDBA1",147,0)
 .. S OIREC=$G(^ORD(101.43,$G(^OR(100,ORD,4.5,1,1)),0)),OIVN=""
"RTN","ORWDBA1",148,0)
 .. F  S OIVN=$O(OIV(OIVN)) Q:OIVN=""  I OIV(OIVN)=$E($P(OIREC,U),1,$L(OIV(OIVN))) S TEST(ORI)=1 Q
"RTN","ORWDBA1",149,0)
 . S TEST(ORI)=1  ;order is for a supported pkg (also note Pros ck above)
"RTN","ORWDBA1",150,0)
 Q
"RTN","ORWDBA1",151,0)
 ;
"RTN","ORWDBA1",152,0)
BASTATUS(Y) ;RPC to retrieve the status of the Billing Awareness software
"RTN","ORWDBA1",153,0)
 ;   Y  =  Returned Value (1=BA usable, 0=BA not-usable)
"RTN","ORWDBA1",154,0)
 ; Check for installation of CIDC ancillary build
"RTN","ORWDBA1",155,0)
 S Y=$D(^XPD(9.7,"B","PX CLINICAL INDICATOR DATA CAPTURE 1.0"))
"RTN","ORWDBA1",156,0)
 Q:'Y
"RTN","ORWDBA1",157,0)
 ; Check if system parameter switch set
"RTN","ORWDBA1",158,0)
 S Y=$$CHKPS1^ORWDBA5
"RTN","ORWDBA1",159,0)
 Q
"RTN","ORWDBA1",160,0)
 ;
"RTN","ORWDBA1",161,0)
BASTAT() ; Internal version of BASTATUS
"RTN","ORWDBA1",162,0)
 ; Returns 0 if disabled or 1 if enabled
"RTN","ORWDBA1",163,0)
 Q $$CHKPS1^ORWDBA5
"RTN","ORWDBA1",164,0)
 ;
"RTN","ORWDBA1",165,0)
RCVORCI(Y,DIAG) ;Receive order related Clinical Indicators & Diagnoses from GUI
"RTN","ORWDBA1",166,0)
 ; Store data in ^OR(100,ODN,5.1) & ^OR(100,0DN,5.2)
"RTN","ORWDBA1",167,0)
 ;
"RTN","ORWDBA1",168,0)
 N DXIEN,ODN,ORIEN,SCI,OCDXCT,OCT
"RTN","ORWDBA1",169,0)
 S ODN="",OCDXCT=0
"RTN","ORWDBA1",170,0)
 F  S ODN=$O(DIAG(ODN)) Q:ODN=""  D
"RTN","ORWDBA1",171,0)
 . S ORIEN=$P(DIAG(ODN),";",1)  ;Order IEN
"RTN","ORWDBA1",172,0)
 . K ^OR(100,ORIEN,5.1) ;Clear currently stored diagnosis for rewrite
"RTN","ORWDBA1",173,0)
 . ; Data from Delphi format: 10000628;11CNNNCNN^exDx1^exDx2^exDx3^exDx4
"RTN","ORWDBA1",174,0)
 . S SCI=$$TFGUIGBL($E($P(DIAG(ODN),";",2),3,9))  ;convert 7 Tx Factors
"RTN","ORWDBA1",175,0)
 . S ^OR(100,ORIEN,5.2)=SCI  ;Store TFs (SC,MST,AO,IR,EC..)
"RTN","ORWDBA1",176,0)
 . ; Get order date for CSV/CTD/HIPAA
"RTN","ORWDBA1",177,0)
 . S ORFMDAT=$$ORFMDAT^ORWDBA3(ORIEN)
"RTN","ORWDBA1",178,0)
 . ; Go through the diagnoses entered
"RTN","ORWDBA1",179,0)
 . F OCT=2:1 Q:$P(DIAG(ODN),U,OCT)=""  D
"RTN","ORWDBA1",180,0)
 .. S DXIEN=$P($$ICDDX^ICDCODE($P(DIAG(ODN),U,OCT),ORFMDAT),U,1)  ;Dx IEN
"RTN","ORWDBA1",181,0)
 .. I DXIEN=-1!(DXIEN="") Q  ;No or invalid code passed in
"RTN","ORWDBA1",182,0)
 .. S OCDXCT=OCDXCT+1
"RTN","ORWDBA1",183,0)
 .. S ^OR(100,ORIEN,5.1,0)="^100.051PA^"_OCDXCT_U_OCDXCT ;Set 5.1 zero node
"RTN","ORWDBA1",184,0)
 .. S ^OR(100,ORIEN,5.1,OCDXCT,0)=DXIEN  ;Store a diagnosis for order
"RTN","ORWDBA1",185,0)
 .. S ^OR(100,ORIEN,5.1,"B",DXIEN,OCDXCT)="" ;Index diagnosis for order
"RTN","ORWDBA1",186,0)
 S Y=1
"RTN","ORWDBA1",187,0)
 Q
"RTN","ORWDBA1",188,0)
 ;
"RTN","ORWDBA1",189,0)
TFSTGS ; Set Treatment Factor strings sequence order
"RTN","ORWDBA1",190,0)
 ; TFGBL is order of TxFs in ^OR(100,ORIEN,5) & ^OR(100,ORIEN,5.2)
"RTN","ORWDBA1",191,0)
 ; TFGUI is order of TxFs to/from GUI
"RTN","ORWDBA1",192,0)
 ; TFTBL is order of TxFs for table SD008 (used in ZCL segment)
"RTN","ORWDBA1",193,0)
 ; NOTE: change examples in TFGUIGBL and TFGBLGUI if order changed
"RTN","ORWDBA1",194,0)
 S TFGBL="SC^MST^AO^IR^EC^HNC^CV"
"RTN","ORWDBA1",195,0)
 S TFGUI="SC^AO^IR^EC^MST^HNC^CV"
"RTN","ORWDBA1",196,0)
 S TFTBL="AO^IR^SC^EC^MST^HNC^CV"
"RTN","ORWDBA1",197,0)
 Q
"RTN","ORWDBA1",198,0)
 ;
"RTN","ORWDBA1",199,0)
TFGUIGBL(GUI) ;Convert Treatment Factors from GUI to Global order & format
"RTN","ORWDBA1",200,0)
 ;
"RTN","ORWDBA1",201,0)
 ; Input:  GUI in CNU?NCU: C=checked, N=not checked, U=unchecked
"RTN","ORWDBA1",202,0)
 ; Output: GBL in 1^^^0^?^1^0 (global) format (reordered for storage)
"RTN","ORWDBA1",203,0)
 ;
"RTN","ORWDBA1",204,0)
 N GBL,J,NTF,TF,TFGBL,TFGUI,TFTBL
"RTN","ORWDBA1",205,0)
 S GBL="",NTF=7  ;NTF=# of Treatment Factors (TxF)
"RTN","ORWDBA1",206,0)
 ;I $L(GUI)'=NTF Q -1  ;invalid # of TxF
"RTN","ORWDBA1",207,0)
 ; Get Treatment Factor sequence order strings
"RTN","ORWDBA1",208,0)
 D TFSTGS
"RTN","ORWDBA1",209,0)
 ; Convert from GBL to GUI format and sequence
"RTN","ORWDBA1",210,0)
 F J=1:1:NTF S TF=$E(GUI,J) D
"RTN","ORWDBA1",211,0)
 . S TF($P(TFGUI,U,J))=$S(TF="C":1,TF="U":0,TF="?":"?",1:"")
"RTN","ORWDBA1",212,0)
 F J=1:1:NTF S GBL=GBL_U_TF($P(TFGBL,U,J))
"RTN","ORWDBA1",213,0)
 Q $P(GBL,U,2,NTF+1)
"RTN","ORWDBA1",214,0)
 ;
"RTN","ORWDBA1",215,0)
TFGBLGUI(GBL) ;Convert Treatment Factors from Global to GUI order & format
"RTN","ORWDBA1",216,0)
 ;
"RTN","ORWDBA1",217,0)
 ; Input:  GBL in 1^0^1^1^^0^? (global) format
"RTN","ORWDBA1",218,0)
 ; Output: GUI in CCCNUU? (GUI) format (also reordered)
"RTN","ORWDBA1",219,0)
 ;
"RTN","ORWDBA1",220,0)
 N GUI,J,NTF,TF,TFGBL,TFGUI,TFTBL
"RTN","ORWDBA1",221,0)
 S GUI="",NTF=7  ;NCI=# of TxF
"RTN","ORWDBA1",222,0)
 ; Get Treatment Factor sequence order strings
"RTN","ORWDBA1",223,0)
 D TFSTGS
"RTN","ORWDBA1",224,0)
 ; Convert from GUI to GBL format and sequence
"RTN","ORWDBA1",225,0)
 F J=1:1:NTF S TF=$P(GBL,U,J) D
"RTN","ORWDBA1",226,0)
 . S TF($P(TFGBL,U,J))=$S(TF=1:"C",TF=0:"U",TF="?":"?",1:"N")
"RTN","ORWDBA1",227,0)
 F J=1:1:NTF S GUI=GUI_TF($P(TFGUI,U,J))
"RTN","ORWDBA1",228,0)
 Q GUI
"RTN","ORWDBA1",229,0)
 ;
"RTN","ORWDBA1",230,0)
PRVKEY(X) ;Check for active & provider key - to be deleted in CPRS v26
"RTN","ORWDBA1",231,0)
 N PTD
"RTN","ORWDBA1",232,0)
 Q:'+$G(X) 0
"RTN","ORWDBA1",233,0)
 Q:$G(^VA(200,X,0))="" 0
"RTN","ORWDBA1",234,0)
 S PTD=+$P(^VA(200,X,0),"^",11)
"RTN","ORWDBA1",235,0)
 I $$DT^XLFDT'<PTD,PTD>0 Q 0
"RTN","ORWDBA1",236,0)
 Q:$D(^XUSEC("PROVIDER",X)) 1
"RTN","ORWDBA1",237,0)
 Q 0
"RTN","ORWDBA1",238,0)
 ;
"RTN","ORWDBA1",239,0)
ORESKEY(X) ;Does 'X' hold ORES key, returns: 1=true, 0=false
"RTN","ORWDBA1",240,0)
 Q:'+$G(X) 0
"RTN","ORWDBA1",241,0)
 Q:$D(^XUSEC("ORES",X)) 1
"RTN","ORWDBA1",242,0)
 Q 0
"RTN","ORWDBA10")
0^33^B23502978
"RTN","ORWDBA10",1,0)
ORWDBA10 ; SLC/GDU - Billing Awareness - Phase I [11/24/04 13:42]
"RTN","ORWDBA10",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORWDBA10",3,0)
 ;Clinical Indicator Data Capture By Provider Parameter Module
"RTN","ORWDBA10",4,0)
 ;This program will assign the CIDC parameter to all active clinicians 
"RTN","ORWDBA10",5,0)
 ;who do not already have it assigned to them. The CIDC functionality
"RTN","ORWDBA10",6,0)
 ;will be enabled or disabled at time of CIDC parameter assignment
"RTN","ORWDBA10",7,0)
 ;based on user selection passed to this program.
"RTN","ORWDBA10",8,0)
 ;External Variable:
"RTN","ORWDBA10",9,0)
 ;  CIDC        Clinical Indicator Data Capture
"RTN","ORWDBA10",10,0)
 ;              A value of E for enable CIDC functionality.
"RTN","ORWDBA10",11,0)
 ;              A value of D for disable CIDC functionality.
"RTN","ORWDBA10",12,0)
 ;Internal Variables:
"RTN","ORWDBA10",13,0)
 ;  CNT         Counter variable, used to build temporary global
"RTN","ORWDBA10",14,0)
 ;  DIR         Input array variable for ^DIR
"RTN","ORWDBA10",15,0)
 ;  DT          Standard Fileman/Kernel variable for current date
"RTN","ORWDBA10",16,0)
 ;              DT is set, not newed or killed
"RTN","ORWDBA10",17,0)
 ;  DTOUT       Timeout indicator, output variable of ^DIR
"RTN","ORWDBA10",18,0)
 ;  DUOUT       Up arrow indicator, output variable of ^DIR
"RTN","ORWDBA10",19,0)
 ;  OREM        Error Message, output variable for XPAR
"RTN","ORWDBA10",20,0)
 ;  IEN         Internal Entry Number
"RTN","ORWDBA10",21,0)
 ;  LIST        Input variable of XPAR where output ENVAL^XAR
"RTN","ORWDBA10",22,0)
 ;              will be stored
"RTN","ORWDBA10",23,0)
 ;  PTD         Provider Termination Date
"RTN","ORWDBA10",24,0)
 ;  VAL         Input variable of XPAR
"RTN","ORWDBA10",25,0)
 ;              A value of 1 will enable CIDC functionality
"RTN","ORWDBA10",26,0)
 ;              A value of 0 will disable CIDC functionality
"RTN","ORWDBA10",27,0)
 ;  X           Work variable
"RTN","ORWDBA10",28,0)
 ;  Y           Processed user selection, output variable of ^DIR
"RTN","ORWDBA10",29,0)
 ;External References
"RTN","ORWDBA10",30,0)
 ;  ^DIR        DBIA 10026
"RTN","ORWDBA10",31,0)
 ;  ADD^XPAR    DBIA 2263
"RTN","ORWDBA10",32,0)
 ;  ENVAL^XPAR  DBIA 2263
"RTN","ORWDBA10",33,0)
 ;
"RTN","ORWDBA10",34,0)
EN(CIDC) ;Entry point for this program
"RTN","ORWDBA10",35,0)
 N CNT,DIR,DTOUT,DUOUT,OREM,IEN,LIST,PTD,VAL,X,Y
"RTN","ORWDBA10",36,0)
 K ^TMP($J,"OR","CIDC")
"RTN","ORWDBA10",37,0)
 S DT=$$DT^XLFDT
"RTN","ORWDBA10",38,0)
 ;Get list of clinicians with the CIDC functionality parameter assigned
"RTN","ORWDBA10",39,0)
 ;to them.
"RTN","ORWDBA10",40,0)
 S OREM="",LIST="^TMP($J,""OR"",""CIDC"",""A"")"
"RTN","ORWDBA10",41,0)
 D ENVAL^XPAR(LIST,"OR BILLING AWARENESS BY USER",1,.OREM,1)
"RTN","ORWDBA10",42,0)
 ;Build list of active clinicians with the CIDC functionality parameter 
"RTN","ORWDBA10",43,0)
 ;not assigned to them.
"RTN","ORWDBA10",44,0)
 S IEN="",(CNT,^TMP($J,"OR","CIDC","U",0))=0
"RTN","ORWDBA10",45,0)
 F  S IEN=$O(^XUSEC("PROVIDER",IEN)) Q:IEN=""  D
"RTN","ORWDBA10",46,0)
 . I $D(^TMP($J,"OR","CIDC","A",IEN_";VA(200,",1))=1 Q
"RTN","ORWDBA10",47,0)
 . I $$GET1^DIQ(200,IEN,7)="YES" Q
"RTN","ORWDBA10",48,0)
 . S PTD=$$GET1^DIQ(200,IEN,9.2,"I")
"RTN","ORWDBA10",49,0)
 . I PTD'="",(PTD=DT)!(PTD<DT) Q
"RTN","ORWDBA10",50,0)
 . S CNT=CNT+1
"RTN","ORWDBA10",51,0)
 . S ^TMP($J,"OR","CIDC","U",0)=CNT
"RTN","ORWDBA10",52,0)
 . S ^TMP($J,"OR","CIDC","U",CNT)=IEN_";VA(200,"
"RTN","ORWDBA10",53,0)
 I ^TMP($J,"OR","CIDC","U",0)=0 G APA
"RTN","ORWDBA10",54,0)
 ;Build and display user interface
"RTN","ORWDBA10",55,0)
 S DIR(0)="SX^;"_$P($T(OY),";",3)
"RTN","ORWDBA10",56,0)
 S DIR(0)=DIR(0)_$S(CIDC="E":$P($T(OYE),";",3),1:$P($T(OYD),";",3))_";"
"RTN","ORWDBA10",57,0)
 S DIR(0)=DIR(0)_$P($T(ON),";",3)
"RTN","ORWDBA10",58,0)
 S DIR(0)=DIR(0)_$S(CIDC="E":$P($T(ONE),";",3),1:$P($T(OND),";",3))
"RTN","ORWDBA10",59,0)
 S DIR("A",1)=^TMP($J,"OR","CIDC","U",0)_" "_$P($T(A1),";",3)
"RTN","ORWDBA10",60,0)
 S DIR("A",2)=$S(CIDC="E":$P($T(A2E),";",3),1:$P($T(A2D),";",3))
"RTN","ORWDBA10",61,0)
 S DIR("A",3)=$P($T(A3),";",3)
"RTN","ORWDBA10",62,0)
 S DIR("A")=$P($T(A4),";",3)
"RTN","ORWDBA10",63,0)
 S DIR("?",1)=$P($T(HY),";",3)
"RTN","ORWDBA10",64,0)
 S DIR("?",1)=DIR("?",1)_$S(CIDC="E":$P($T(HYE),";",3),1:$P($T(HYD),";",3))
"RTN","ORWDBA10",65,0)
 S DIR("?")=$P($T(HN),";",3)
"RTN","ORWDBA10",66,0)
 S DIR("?")=DIR("?")_$S(CIDC="E":$P($T(HNE),";",3),1:$P($T(HND),";",3))
"RTN","ORWDBA10",67,0)
 D SCRHDR,^DIR K DIR
"RTN","ORWDBA10",68,0)
 ;Process user's selection
"RTN","ORWDBA10",69,0)
 ;If the user selects no, times out, or enters "^" quit program
"RTN","ORWDBA10",70,0)
 I Y="NO"!($D(DTOUT))!($D(DUOUT)) Q
"RTN","ORWDBA10",71,0)
 ;Process the mass CIDC parameter assignment and enable/disable CIDC
"RTN","ORWDBA10",72,0)
 ;functionality.
"RTN","ORWDBA10",73,0)
 D SCRHDR
"RTN","ORWDBA10",74,0)
 W !!,$S(CIDC="E":$P($T(EP),";",3),1:$P($T(DP),";",3))
"RTN","ORWDBA10",75,0)
 S VAL=$S(CIDC="E":1,1:0)
"RTN","ORWDBA10",76,0)
 F X=1:1:^TMP($J,"OR","CIDC","U",0) D
"RTN","ORWDBA10",77,0)
 . W "."
"RTN","ORWDBA10",78,0)
 . D ADD^XPAR(^TMP($J,"OR","CIDC","U",X),"OR BILLING AWARENESS BY USER",1,VAL,.OREM)
"RTN","ORWDBA10",79,0)
 ;Alert the user the mass CIDC parameter assignment and the 
"RTN","ORWDBA10",80,0)
 ;enabling/disabling CIDC functionality is done.
"RTN","ORWDBA10",81,0)
 S DIR("A")=$S(CIDC="E":$P($T(EC),";",3),1:$P($T(DC),";",3)) G EXIT
"RTN","ORWDBA10",82,0)
APA ;All Providers Assigned
"RTN","ORWDBA10",83,0)
 S DIR("A")=$P($T(ALL),";",3)
"RTN","ORWDBA10",84,0)
 D SCRHDR W !!
"RTN","ORWDBA10",85,0)
EXIT ;Exit point of this routine
"RTN","ORWDBA10",86,0)
 S DIR(0)="E"
"RTN","ORWDBA10",87,0)
 D ^DIR K DIR
"RTN","ORWDBA10",88,0)
 K ^TMP($J,"OR","CIDC")
"RTN","ORWDBA10",89,0)
 Q
"RTN","ORWDBA10",90,0)
 ;
"RTN","ORWDBA10",91,0)
SCRHDR ;Screen Header
"RTN","ORWDBA10",92,0)
 W:$D(IOF) @IOF
"RTN","ORWDBA10",93,0)
 W !,$P($T(SH),";",3)
"RTN","ORWDBA10",94,0)
 W !,$S(CIDC="E":$P($T(SHE),";",3),1:$P($T(SHD),";",3))
"RTN","ORWDBA10",95,0)
 Q
"RTN","ORWDBA10",96,0)
SH ;;Enable Clinical Indicator Data Capture By Provider Parameter Management
"RTN","ORWDBA10",97,0)
SHE ;;Assign/Enable Parameter For All Active Providers Option
"RTN","ORWDBA10",98,0)
SHD ;;Assign/Disable Parameter For All Active Providers Option
"RTN","ORWDBA10",99,0)
OY ;;YES:Enter YES to begin process of assign/
"RTN","ORWDBA10",100,0)
ON ;;NO:Enter NO to cancel process of assign/
"RTN","ORWDBA10",101,0)
OYE ;;enable
"RTN","ORWDBA10",102,0)
ONE ;;enable and quit
"RTN","ORWDBA10",103,0)
OYD ;;disable
"RTN","ORWDBA10",104,0)
OND ;;disable and quit
"RTN","ORWDBA10",105,0)
A1 ;;active providers do not have this parameter assigned to them.
"RTN","ORWDBA10",106,0)
A2E ;;You have selected to assign the parameter and enable Clinical Indictor
"RTN","ORWDBA10",107,0)
A2D ;;You have selected to assign the parameter and disable Clinical Indicator
"RTN","ORWDBA10",108,0)
A3 ;;Data Capture for all of these providers. This may take some time.
"RTN","ORWDBA10",109,0)
A4 ;;Are you sure you want to do this? (YES/NO - must be all cap)
"RTN","ORWDBA10",110,0)
HY ;;Enter YES to begin the assign/
"RTN","ORWDBA10",111,0)
HN ;;Enter No to cancel the assign/
"RTN","ORWDBA10",112,0)
HYE ;;enable process.
"RTN","ORWDBA10",113,0)
HNE ;;enable process and quit.
"RTN","ORWDBA10",114,0)
HYD ;;disable process.
"RTN","ORWDBA10",115,0)
HND ;;disable process and quit.
"RTN","ORWDBA10",116,0)
EP ;;Now assigning CIDC parameter and enabling the functionality.
"RTN","ORWDBA10",117,0)
EC ;;CIDC parameter assignment and functionality enabling complete.
"RTN","ORWDBA10",118,0)
DP ;;Now assigning CIDC parameter and disabling the functionality.
"RTN","ORWDBA10",119,0)
DC ;;CIDC parameter assignment and functionality disabling complete.
"RTN","ORWDBA10",120,0)
ALL ;;All active providers have the CIDC parameter assigned to them
"RTN","ORWDBA12")
0^34^B24052231
"RTN","ORWDBA12",1,0)
ORWDBA12 ; SLC/GDU - Billing Awareness - Phase I [10/18/04 10:24]
"RTN","ORWDBA12",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORWDBA12",3,0)
 ;
"RTN","ORWDBA12",4,0)
 ;Enable Clinical Indicator Data Capture By Provider Parameter Module
"RTN","ORWDBA12",5,0)
 ;ORWDBA12 - Delete the assigned parameter
"RTN","ORWDBA12",6,0)
 ;
"RTN","ORWDBA12",7,0)
 ;This program is used to delete the assigned parameter of a selected
"RTN","ORWDBA12",8,0)
 ;provider.
"RTN","ORWDBA12",9,0)
 ;
"RTN","ORWDBA12",10,0)
 ;Programs Called:
"RTN","ORWDBA12",11,0)
 ; GETS^DIQ      Silent FileMan DBS call to get provider information
"RTN","ORWDBA12",12,0)
 ; ^DIR          General purpose response reader
"RTN","ORWDBA12",13,0)
 ; DEL^XPAR      Deletes the selected parameter
"RTN","ORWDBA12",14,0)
 ; ENVAL^XPAR    Returns list of records related to the parameter
"RTN","ORWDBA12",15,0)
 ;
"RTN","ORWDBA12",16,0)
 ;Variables used:
"RTN","ORWDBA12",17,0)
 ; BAEI       Billing Awareness Enabled Parameter Internal value
"RTN","ORWDBA12",18,0)
 ; DIR        Input array variable for ^DIR
"RTN","ORWDBA12",19,0)
 ; DTOUT      Timeout indicator output variable for ^DIR
"RTN","ORWDBA12",20,0)
 ; DUOUT      Up Arrow '^' indictor output variable for ^DIR
"RTN","ORWDBA12",21,0)
 ; ENT        Enitity, input variable for ^XPAR
"RTN","ORWDBA12",22,0)
 ; ORERR      Error, output variable for ^XPAR, and ^DIQ
"RTN","ORWDBA12",23,0)
 ; FILE       File number, input variable for ^DIQ
"RTN","ORWDBA12",24,0)
 ; FLD        Field number, input variable for ^DIQ
"RTN","ORWDBA12",25,0)
 ; FLG        Flag, input parameters variable for ^DIQ
"RTN","ORWDBA12",26,0)
 ; FST        Work variable controls build of user selection display
"RTN","ORWDBA12",27,0)
 ; GBL        Global, input parameter to direct ^XPAR output to a global
"RTN","ORWDBA12",28,0)
 ; HC         Help Count, work variable to set help text lines for ^DIR
"RTN","ORWDBA12",29,0)
 ; INST       Instance, input variable for ^XPAR
"RTN","ORWDBA12",30,0)
 ; LIST       List, output variable for ^XPAR
"RTN","ORWDBA12",31,0)
 ; OPTCNT     Option Count, counter variable to build options display
"RTN","ORWDBA12",32,0)
 ;            input variable for ^DIR
"RTN","ORWDBA12",33,0)
 ; PAR        Parameter, IEN of the parameter being worked with, input
"RTN","ORWDBA12",34,0)
 ;            variable for ^XPAR
"RTN","ORWDBA12",35,0)
 ; PRVCNT     Provider Count, counter variable to determine the number
"RTN","ORWDBA12",36,0)
 ;            of providers with the parameter assigned to them
"RTN","ORWDBA12",37,0)
 ; PRVIEN     Provider IEN, the internal entry number of the provider
"RTN","ORWDBA12",38,0)
 ; PRVNAME    Provider Name, the name of the provider
"RTN","ORWDBA12",39,0)
 ; RF         Record Found, output variable for ^DIQ
"RTN","ORWDBA12",40,0)
 ; SELKEY     Selected Key, work variable the IEN of the temp global
"RTN","ORWDBA12",41,0)
 ;            indicating the user's selection.
"RTN","ORWDBA12",42,0)
 ; U          Delemiter variable, defaulted to ^
"RTN","ORWDBA12",43,0)
 ; X          Standard work variable
"RTN","ORWDBA12",44,0)
 ; Y          Processed user selection output variable for ^DIC
"RTN","ORWDBA12",45,0)
 ;
"RTN","ORWDBA12",46,0)
 ;Globals Used:
"RTN","ORWDBA12",47,0)
 ;^XTV(8989.51,"B"
"RTN","ORWDBA12",48,0)
 ;    Standard B index for the Parameters file.
"RTN","ORWDBA12",49,0)
 ;    ^XTV(8989.51,"B",Parameter Name,Parameter IEN)
"RTN","ORWDBA12",50,0)
 ;^TMP("ORPAL",$J
"RTN","ORWDBA12",51,0)
 ;    Multipurpose temp global used for the delete process
"RTN","ORWDBA12",52,0)
 ;    Output global for ^XPAR
"RTN","ORWDBA12",53,0)
 ;    ^TMP("ORPAL",$J,"A")=total records returned
"RTN","ORWDBA12",54,0)
 ;    ^TMP("ORPAL",$J,"A",Provider IEN_";VA(200,",1)=parameter value
"RTN","ORWDBA12",55,0)
 ;    First pass processing of ^XPAR output
"RTN","ORWDBA12",56,0)
 ;    ^TMP("ORPAL",$J,"B",Provider Name)=IEN^param value
"RTN","ORWDBA12",57,0)
 ;    Second pass processing of ^XPAR output, work data for program
"RTN","ORWDBA12",58,0)
 ;    ^TMP("ORPAL",$J,"C",Record Count)=Name^IEN^param value
"RTN","ORWDBA12",59,0)
 ;    Third pass processing of ^XPAR output, input data for ^DIR, used
"RTN","ORWDBA12",60,0)
 ;    to create the user selection interface
"RTN","ORWDBA12",61,0)
 ;    ^TMP("ORPAL",$J,"D",Provider Name)=Record Count from "C"
"RTN","ORWDBA12",62,0)
MAIN ;Main starting point for the delete assigned Enable BA By User
"RTN","ORWDBA12",63,0)
 ;process
"RTN","ORWDBA12",64,0)
 N BAEI,DIR,DTOUT,DUOUT,ENT,ORERR,FILE,FLD,FLG,FST,GBL,HC,INST,LIST
"RTN","ORWDBA12",65,0)
 N OPTCNT,PAR,PRVCNT,PRVIEN,PRVNAME,RF,SELKEY,U,X,Y
"RTN","ORWDBA12",66,0)
 K ^TMP("ORPAL",$J),^TMP("SPL",$J)
"RTN","ORWDBA12",67,0)
 S U="^",(INST,GBL)=1
"RTN","ORWDBA12",68,0)
 S PAR=$QS($Q(^XTV(8989.51,"B","OR BILLING AWARENESS BY USER")),4)
"RTN","ORWDBA12",69,0)
BLDLST ;Build list of providers with the Enable CIDC By User parameter already
"RTN","ORWDBA12",70,0)
 ;assigned to them.
"RTN","ORWDBA12",71,0)
 S LIST="^TMP(""ORPAL"",$J,""A"")"
"RTN","ORWDBA12",72,0)
 D ENVAL^XPAR(LIST,PAR,INST,.ORERR,GBL)
"RTN","ORWDBA12",73,0)
 I ^TMP("ORPAL",$J,"A")=0 D  G EXIT
"RTN","ORWDBA12",74,0)
 . D SCRHDR
"RTN","ORWDBA12",75,0)
 . S DIR(0)="E"
"RTN","ORWDBA12",76,0)
 . S DIR("A",1)=$P($T(NPA1),";",2)
"RTN","ORWDBA12",77,0)
 . S DIR("A",2)=$P($T(NPA2),";",2)
"RTN","ORWDBA12",78,0)
 . S DIR("A",3)=$P($T(NPA3),";",2)
"RTN","ORWDBA12",79,0)
 . S DIR("A")=$P($T(NPA4),";",2)
"RTN","ORWDBA12",80,0)
 . W !!! D ^DIR K DIR
"RTN","ORWDBA12",81,0)
 S FILE=200,FLD=.01,(BAEI,FLG,PRVIEN,PRVNAME,X)=""
"RTN","ORWDBA12",82,0)
 F  S X=$O(^TMP("ORPAL",$J,"A",X)) Q:X=""  D
"RTN","ORWDBA12",83,0)
 . S PRVIEN=$P(X,";")
"RTN","ORWDBA12",84,0)
 . S BAEI=^TMP("ORPAL",$J,"A",X,1)
"RTN","ORWDBA12",85,0)
 . K RF,ERR
"RTN","ORWDBA12",86,0)
 . D GETS^DIQ(FILE,PRVIEN,FLD,FLG,"RF","ERR")
"RTN","ORWDBA12",87,0)
 . S PRVNAME=RF(FILE,PRVIEN_",",.01)
"RTN","ORWDBA12",88,0)
 . S ^TMP("ORPAL",$J,"B",PRVNAME)=PRVIEN_U_BAEI
"RTN","ORWDBA12",89,0)
 S PRVNAME="",PRVCNT=0
"RTN","ORWDBA12",90,0)
 F  S PRVNAME=$O(^TMP("ORPAL",$J,"B",PRVNAME)) Q:PRVNAME=""  D
"RTN","ORWDBA12",91,0)
 . S PRVCNT=PRVCNT+1
"RTN","ORWDBA12",92,0)
 . S ^TMP("ORPAL",$J,"C",PRVCNT)=PRVNAME_U_^TMP("ORPAL",$J,"B",PRVNAME)
"RTN","ORWDBA12",93,0)
 S PRVNAME="",PRVCNT=0
"RTN","ORWDBA12",94,0)
 F  S PRVCNT=$O(^TMP("ORPAL",$J,"C",PRVCNT)) Q:PRVCNT=""  D
"RTN","ORWDBA12",95,0)
 . S PRVNAME=$P(^TMP("ORPAL",$J,"C",PRVCNT),U)
"RTN","ORWDBA12",96,0)
 . S ^TMP("ORPAL",$J,"D",PRVNAME)=PRVCNT
"RTN","ORWDBA12",97,0)
 S FST=1  ;Prepare for display
"RTN","ORWDBA12",98,0)
DISOPT ;Display the list of providers with the Enable BDC By User parameter
"RTN","ORWDBA12",99,0)
 ;assigned to them. The user selects from this list the provider
"RTN","ORWDBA12",100,0)
 ;whose parameter is to be deleted.
"RTN","ORWDBA12",101,0)
DO1 S FST=1  ;Prepare for display
"RTN","ORWDBA12",102,0)
DO2 D SCRHDR  ;Display starts here
"RTN","ORWDBA12",103,0)
 S (OPTCNT,PRVNAME,X)="",DIR(0)="SO"_U
"RTN","ORWDBA12",104,0)
 F X=FST:1:10+(FST-1) Q:$D(^TMP("ORPAL",$J,"C",X))=0  D
"RTN","ORWDBA12",105,0)
 . S OPTCNT=OPTCNT+1
"RTN","ORWDBA12",106,0)
 . S:OPTCNT>10 OPTCNT=1
"RTN","ORWDBA12",107,0)
 . S PRVNAME=$P(^TMP("ORPAL",$J,"C",X),U)
"RTN","ORWDBA12",108,0)
 . S DIR(0)=DIR(0)_OPTCNT_":"_PRVNAME_";"
"RTN","ORWDBA12",109,0)
 S:OPTCNT=10 DIR(0)=DIR(0)_";"_$P($T(D0N),";",2)
"RTN","ORWDBA12",110,0)
 S:FST>10 DIR(0)=DIR(0)_";"_$P($T(D0P),";",2)
"RTN","ORWDBA12",111,0)
 S DIR(0)=DIR(0)_";"_$P($T(D0Q),";",2)
"RTN","ORWDBA12",112,0)
 S HC=1,DIR("?",HC)=$P($T(DHD),";",2)
"RTN","ORWDBA12",113,0)
 S:OPTCNT=10 HC=HC+1,DIR("?",HC)=$P($T(DHN),";",2)
"RTN","ORWDBA12",114,0)
 S:FST>10 HC=HC+1,DIR("?",HC)=$P($T(DHP),";",2)
"RTN","ORWDBA12",115,0)
 S DIR("A")=$P($T(DAD),";",2)
"RTN","ORWDBA12",116,0)
 S DIR("?")=$P($T(DHQ),";",2)
"RTN","ORWDBA12",117,0)
 D ^DIR K DIR
"RTN","ORWDBA12",118,0)
 I Y="Q"!(Y="")!($D(DTOUT))!($D(DUOUT)) G EXIT
"RTN","ORWDBA12",119,0)
 I Y="N" S FST=FST+10 G DO2
"RTN","ORWDBA12",120,0)
 I Y="P" S FST=FST-10 G DO2
"RTN","ORWDBA12",121,0)
 S PRVNAME=Y(0),(SELKEY,PRVIEN)=""
"RTN","ORWDBA12",122,0)
 S SELKEY=^TMP("ORPAL",$J,"D",PRVNAME)
"RTN","ORWDBA12",123,0)
 S PRVIEN=$P(^TMP("ORPAL",$J,"C",SELKEY),U,2)
"RTN","ORWDBA12",124,0)
 S BAEI=$P(^TMP("ORPAL",$J,"C",SELKEY),U,3)
"RTN","ORWDBA12",125,0)
DELETE ;Confirm the selected provider and delete the selected provider's
"RTN","ORWDBA12",126,0)
 ;assigned Enable BDC By User parameter
"RTN","ORWDBA12",127,0)
 D SCRHDR
"RTN","ORWDBA12",128,0)
 W !!,$P($P($T(DPM),";",2),"|"),PRVNAME,$P($P($T(DPM),";",2),"|",2)
"RTN","ORWDBA12",129,0)
 I BAEI=1 W !,$P($T(DPEM),";",2)
"RTN","ORWDBA12",130,0)
 E  W !,$P($T(DPDM),";",2)
"RTN","ORWDBA12",131,0)
 S DIR(0)="Y"
"RTN","ORWDBA12",132,0)
 S DIR("A")=$P($T(DPA),";",2)
"RTN","ORWDBA12",133,0)
 S DIR("B")="N"
"RTN","ORWDBA12",134,0)
 S DIR("?",1)=$P($T(DPHY),";",2)
"RTN","ORWDBA12",135,0)
 S DIR("?")=$P($T(DPHN),";",2)
"RTN","ORWDBA12",136,0)
 D ^DIR K DIR
"RTN","ORWDBA12",137,0)
 I $D(DTOUT)!($D(DUOUT)) Q
"RTN","ORWDBA12",138,0)
 I Y=1 D
"RTN","ORWDBA12",139,0)
 . S ENT=PRVIEN_";VA(200,"
"RTN","ORWDBA12",140,0)
 . D DEL^XPAR(ENT,PAR,INST,.ORERR)
"RTN","ORWDBA12",141,0)
AGAIN ;Ask the user if they want to do the delete process again.
"RTN","ORWDBA12",142,0)
 S DIR(0)="Y"
"RTN","ORWDBA12",143,0)
 S DIR("A")=$P($T(ADA),";",2)
"RTN","ORWDBA12",144,0)
 S DIR("B")="N"
"RTN","ORWDBA12",145,0)
 S DIR("?",1)=$P($T(ADHY),";",2)
"RTN","ORWDBA12",146,0)
 S DIR("?")=$P($T(ADHN),";",2)
"RTN","ORWDBA12",147,0)
 W !! D ^DIR K DIR
"RTN","ORWDBA12",148,0)
 I Y=1 G MAIN
"RTN","ORWDBA12",149,0)
 G EXIT
"RTN","ORWDBA12",150,0)
NPA ;No Parameter Set
"RTN","ORWDBA12",151,0)
 ;Error trap for no Enable BDC By User parameter are currently assigned
"RTN","ORWDBA12",152,0)
 D SCRHDR
"RTN","ORWDBA12",153,0)
 S DIR(0)="E"
"RTN","ORWDBA12",154,0)
 S DIR("A",1)=$P($T(NPA1),";",2)
"RTN","ORWDBA12",155,0)
 S DIR("A",2)=$P($T(NPA2),";",2)
"RTN","ORWDBA12",156,0)
 S DIR("A",3)=$P($T(NPA3),";",2)
"RTN","ORWDBA12",157,0)
 S DIR("A")=$P($T(NPA4),";",2)
"RTN","ORWDBA12",158,0)
EXIT ;Common exit point for this program
"RTN","ORWDBA12",159,0)
 K ^TMP("ORPAL",$J)
"RTN","ORWDBA12",160,0)
 Q
"RTN","ORWDBA12",161,0)
SCRHDR ;Screen Header Display
"RTN","ORWDBA12",162,0)
 W:$D(IOF) @IOF
"RTN","ORWDBA12",163,0)
 W !,"Enable Clinical Indicator Data Capture By Provider Parameter Management"
"RTN","ORWDBA12",164,0)
 W !,"Delete Assigned Parameter"
"RTN","ORWDBA12",165,0)
 Q
"RTN","ORWDBA12",166,0)
 ;Text for the user prompt in NPA
"RTN","ORWDBA12",167,0)
NPA1 ;No providers currently have the parameter assigned to them.
"RTN","ORWDBA12",168,0)
NPA2 ;You will need to select the 'Assign parameter to provider' option and
"RTN","ORWDBA12",169,0)
NPA3 ;assign this parameter to the providers.
"RTN","ORWDBA12",170,0)
NPA4 ;Press the return key or '^' to continue
"RTN","ORWDBA12",171,0)
 ;This is the text to build the DIR variables for use with ^DIR in
"RTN","ORWDBA12",172,0)
 ;DISOPT
"RTN","ORWDBA12",173,0)
D0N ;N:Next 10 Providers
"RTN","ORWDBA12",174,0)
D0P ;P:Previous 10 Providers
"RTN","ORWDBA12",175,0)
D0Q ;Q:Quit
"RTN","ORWDBA12",176,0)
DAD ;Select the provider to delete the assigned parameter
"RTN","ORWDBA12",177,0)
DHD ;Select the provider whose assigned parameter value is to be deleted.
"RTN","ORWDBA12",178,0)
DHN ;Enter N for the next 10 providers in the list.
"RTN","ORWDBA12",179,0)
DHP ;Enter P for the previous 10 providers in the list.
"RTN","ORWDBA12",180,0)
DHQ ;Enter Q to quit and return to the previous menu
"RTN","ORWDBA12",181,0)
 ;This is the text to build the DIR variable for use with ^DIR in DELETE
"RTN","ORWDBA12",182,0)
 ;and the user message.
"RTN","ORWDBA12",183,0)
DPM ;You have selected | to delete.
"RTN","ORWDBA12",184,0)
DPEM ;Clinical Indicator Data Capture for this provider is currently enabled.
"RTN","ORWDBA12",185,0)
DPDM ;Clinical Indicator Data Capture for this provider is currently disabled.
"RTN","ORWDBA12",186,0)
DPA ;Are you sure that you want to delete this provider's parameter
"RTN","ORWDBA12",187,0)
DPHY ;Enter Y for Yes to confirm deletion of this provider's parameter.
"RTN","ORWDBA12",188,0)
DPHN ;Enter N for No to not delete this provider's parameter.
"RTN","ORWDBA12",189,0)
 ;This is the text to build the DIR variable for use with ^DIR in AGAIN
"RTN","ORWDBA12",190,0)
ADA ;Delete another provider's parameter
"RTN","ORWDBA12",191,0)
ADHY ;Enter Y for Yes to delete another provider's parameter.
"RTN","ORWDBA12",192,0)
ADHN ;Enter N for No to not delete another provider's parameter.
"RTN","ORWDBA14")
0^35^B17169243
"RTN","ORWDBA14",1,0)
ORWDBA14 ; SLC/GDU - Billing Awareness - Phase I [10/18/04 10:26]
"RTN","ORWDBA14",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORWDBA14",3,0)
 ;
"RTN","ORWDBA14",4,0)
 ;Enable Billing Data Capture By Provider Parameter
"RTN","ORWDBA14",5,0)
 ;ORWDBA14 - Get a report of assigned parameters
"RTN","ORWDBA14",6,0)
 ;
"RTN","ORWDBA14",7,0)
 ;Report to print out the providers with the Billing Data Capture By
"RTN","ORWDBA14",8,0)
 ;Provider parameter set.
"RTN","ORWDBA14",9,0)
 ;Billing Data Capture By Provider will be referred to as BDCBP.
"RTN","ORWDBA14",10,0)
 ;Billing Data Capture will be referred to as BDC
"RTN","ORWDBA14",11,0)
 ;The user has the option to search by:
"RTN","ORWDBA14",12,0)
 ; 1. For all providers with the BDCBP parameter
"RTN","ORWDBA14",13,0)
 ; 2. For all providers with the BDCBP parameter and BDC enabled
"RTN","ORWDBA14",14,0)
 ; 3. For all providers with the BDCBP parameter and BDC disabled
"RTN","ORWDBA14",15,0)
 ;
"RTN","ORWDBA14",16,0)
 ;Programs called:
"RTN","ORWDBA14",17,0)
 ; ^%ZIS         DBIA 10086
"RTN","ORWDBA14",18,0)
 ; ^%ZISC        DBIA 10089
"RTN","ORWDBA14",19,0)
 ; ^%ZTLOAD      DBIA 10063
"RTN","ORWDBA14",20,0)
 ; ^DIR          DBIA 10026
"RTN","ORWDBA14",21,0)
 ; RPT^ORWDBA16  Generates and prints the report
"RTN","ORWDBA14",22,0)
 ; ENVAL^XPAR    DBIA 2263
"RTN","ORWDBA14",23,0)
 ;
"RTN","ORWDBA14",24,0)
 ;Variables Used:
"RTN","ORWDBA14",25,0)
 ; %ZIS     KERNEL device selection variable
"RTN","ORWDBA14",26,0)
 ; DIR      Input array variable for ^DIR
"RTN","ORWDBA14",27,0)
 ; DTOUT    Timeout indicator variable, output from ^DIR
"RTN","ORWDBA14",28,0)
 ; DUOUT    Up Arrow '^' indicator variable, output from ^DIR
"RTN","ORWDBA14",29,0)
 ; ORERR    Error message output array variable from ENVAL^XPAR
"RTN","ORWDBA14",30,0)
 ; IO       Input / Output array variable, System settings
"RTN","ORWDBA14",31,0)
 ; IOF      Page feed variable, System settings
"RTN","ORWDBA14",32,0)
 ; ION      Device name, System settings
"RTN","ORWDBA14",33,0)
 ; POP      Cancel device select, program run output from ^%ZIS
"RTN","ORWDBA14",34,0)
 ; SEARCH   User select of type of report to run
"RTN","ORWDBA14",35,0)
 ; Y        Processed user selection, output from ^DIR
"RTN","ORWDBA14",36,0)
 ; ZTDESC   Description of queued job, input for ^%ZTLOAD
"RTN","ORWDBA14",37,0)
 ; ZTIO     Device selected for the queued job, input for ^%ZTLOAD
"RTN","ORWDBA14",38,0)
 ; ZTRTN    Routine selected for the queued job, input for ^%ZTLOAD
"RTN","ORWDBA14",39,0)
 ; ZTSAVE   Input parameters for the queued job, input for ^%ZTLOAD
"RTN","ORWDBA14",40,0)
 ; ZTSK     Internal Entry Number of the queued job, output from ^%ZTLOAD
"RTN","ORWDBA14",41,0)
 ;
"RTN","ORWDBA14",42,0)
 ;Globals Used:
"RTN","ORWDBA14",43,0)
 ; ^TMP("ORCK"
"RTN","ORWDBA14",44,0)
 ; Temp global to hold value of LIST, output from ENVAL^XPAR. If
"RTN","ORWDBA14",45,0)
 ; ^TMP("ORCK",$J,"A") has a count of 0 the user is alerted that there
"RTN","ORWDBA14",46,0)
 ; are no parameter assigned to providers. This is acknowledged by the
"RTN","ORWDBA14",47,0)
 ; user and the program quits.
"RTN","ORWDBA14",48,0)
 ;
"RTN","ORWDBA14",49,0)
MAIN ;Main starting point for this program
"RTN","ORWDBA14",50,0)
 ;User selects the type of report to run. Then selects the device the
"RTN","ORWDBA14",51,0)
 ;reports output will go.
"RTN","ORWDBA14",52,0)
 N %ZIS,DIR,DTOUT,DUOUT,ORERR,POP,SEARCH,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","ORWDBA14",53,0)
 ;Check for assigned parameters.
"RTN","ORWDBA14",54,0)
 D ENVAL^XPAR("^TMP(""ORCK"",$J,""A"")","OR BILLING AWARENESS BY USER",1,.ORERR,1)
"RTN","ORWDBA14",55,0)
 ;If none found alert user, exit program
"RTN","ORWDBA14",56,0)
 I ^TMP("ORCK",$J,"A")=0 D  G EXIT
"RTN","ORWDBA14",57,0)
 . D SCRHDR
"RTN","ORWDBA14",58,0)
 . S DIR(0)="E"
"RTN","ORWDBA14",59,0)
 . S DIR("A",1)=$P($T(NPA1),";",3)
"RTN","ORWDBA14",60,0)
 . S DIR("A",2)=$P($T(NPA2),";",3)
"RTN","ORWDBA14",61,0)
 . S DIR("A",3)=$P($T(NPA3),";",3)
"RTN","ORWDBA14",62,0)
 . S DIR("A")=$P($T(NPA4),";",3)
"RTN","ORWDBA14",63,0)
 . W !! D ^DIR K DIR
"RTN","ORWDBA14",64,0)
 K ^TMP("ORCK",$J)
"RTN","ORWDBA14",65,0)
 S SEARCH=""
"RTN","ORWDBA14",66,0)
 S DIR(0)="SO^"_$P($T(L0A),";",3)_";"
"RTN","ORWDBA14",67,0)
 S DIR(0)=DIR(0)_$P($T(L0E),";",3)_";"
"RTN","ORWDBA14",68,0)
 S DIR(0)=DIR(0)_$P($T(L0D),";",3)
"RTN","ORWDBA14",69,0)
 S DIR("?",1)=$P($T(LHA),";",3)
"RTN","ORWDBA14",70,0)
 S DIR("?",2)=$P($T(LHE),";",3)
"RTN","ORWDBA14",71,0)
 S DIR("?")=$P($T(LHD),";",3)
"RTN","ORWDBA14",72,0)
 S DIR("A")=$P($T(LA),";",3)
"RTN","ORWDBA14",73,0)
 D SCRHDR,^DIR K DIR S SEARCH=Y
"RTN","ORWDBA14",74,0)
 I SEARCH="Q"!(SEARCH="")!($D(DTOUT))!($D(DUOUT)) G EXIT
"RTN","ORWDBA14",75,0)
 S %ZIS="Q" D ^%ZIS I POP G EXIT
"RTN","ORWDBA14",76,0)
 I $D(IO("Q")) D  K IO("Q") G EXIT
"RTN","ORWDBA14",77,0)
 . S ZTIO=ION
"RTN","ORWDBA14",78,0)
 . S ZTDESC="BA Enabled By User Report"
"RTN","ORWDBA14",79,0)
 . S ZTRTN="RPT^ORWDBA16"
"RTN","ORWDBA14",80,0)
 . S ZTSAVE("SEARCH")=""
"RTN","ORWDBA14",81,0)
 . D ^%ZTLOAD I $D(ZTSK) W !?32,"REQUEST QUEUED"
"RTN","ORWDBA14",82,0)
 U IO D RPT^ORWDBA16
"RTN","ORWDBA14",83,0)
 D ^%ZISC
"RTN","ORWDBA14",84,0)
AGAIN ;Ask if the user would like to repeat the parameter report process
"RTN","ORWDBA14",85,0)
 ;If yes, the program starts over.
"RTN","ORWDBA14",86,0)
 ;If no, the program quits and the user is returned to the previous menu.
"RTN","ORWDBA14",87,0)
 S DIR(0)="Y"
"RTN","ORWDBA14",88,0)
 S DIR("A")=$P($T(ALA),";",3)
"RTN","ORWDBA14",89,0)
 S DIR("B")="N"
"RTN","ORWDBA14",90,0)
 S DIR("?",1)=$P($T(ALHY),";",3)
"RTN","ORWDBA14",91,0)
 S DIR("?")=$P($T(ALHN),";",3)
"RTN","ORWDBA14",92,0)
 W !! D ^DIR K DIR
"RTN","ORWDBA14",93,0)
 I Y=1 G MAIN
"RTN","ORWDBA14",94,0)
EXIT ;Exit point for this program
"RTN","ORWDBA14",95,0)
 K ^TMP("ORCK",$J)
"RTN","ORWDBA14",96,0)
 D ^%ZISC
"RTN","ORWDBA14",97,0)
 Q
"RTN","ORWDBA14",98,0)
SCRHDR ;Screen Header Display
"RTN","ORWDBA14",99,0)
 W:$D(IOF) @IOF
"RTN","ORWDBA14",100,0)
 W !,"Enable Clinical Indicator Data Capture By Provider Parameter Management"
"RTN","ORWDBA14",101,0)
 W !,"Assigned Parameter Report"
"RTN","ORWDBA14",102,0)
 Q
"RTN","ORWDBA14",103,0)
 ;Text to build the DIR variable for ^DIR in LIST
"RTN","ORWDBA14",104,0)
L0A ;;A:All providers with CIDC parameter
"RTN","ORWDBA14",105,0)
L0E ;;E:Only providers with CIDC enabled
"RTN","ORWDBA14",106,0)
L0D ;;D:Only providers with CIDC disabled
"RTN","ORWDBA14",107,0)
LA ;;Enter the search criteria
"RTN","ORWDBA14",108,0)
LHA ;;Enter A to list all providers with Clinical Indicator Data Capture parameter.
"RTN","ORWDBA14",109,0)
LHE ;;Enter E to list only providers with Clinical Indicator Data Capture enabled.
"RTN","ORWDBA14",110,0)
LHD ;;Enter D to list only providers with Clinical Indicator Data Capture disabled.
"RTN","ORWDBA14",111,0)
 ;Text to build the DIR variable for ^DIR in NPA
"RTN","ORWDBA14",112,0)
NPA1 ;;No providers currently have the parameter assigned to them.
"RTN","ORWDBA14",113,0)
NPA2 ;;You will need to select the 'Manage parameter by provider' option and
"RTN","ORWDBA14",114,0)
NPA3 ;;assign this parameter to the providers.
"RTN","ORWDBA14",115,0)
NPA4 ;;Press the return key or '^' to continue.
"RTN","ORWDBA14",116,0)
 ;Text to build the DIR variable for ^DIR in AGAIN
"RTN","ORWDBA14",117,0)
ALA ;;Run another report
"RTN","ORWDBA14",118,0)
ALHY ;;Enter Y for Yes to run another report.
"RTN","ORWDBA14",119,0)
ALHN ;;Enter N for No to not run another report.
"RTN","ORWDBA16")
0^36^B7959073
"RTN","ORWDBA16",1,0)
ORWDBA16 ;SLC/GDU Billing Awareness - Phase I [10/18/04 10:26]
"RTN","ORWDBA16",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17,1997
"RTN","ORWDBA16",3,0)
 ;
"RTN","ORWDBA16",4,0)
 ;Enable Billing Data Capture By Provider Parameter
"RTN","ORWDBA16",5,0)
 ;ORWDBA16 - Generates and prints parameter report
"RTN","ORWDBA16",6,0)
 ;
"RTN","ORWDBA16",7,0)
 ;Programs Called:
"RTN","ORWDBA16",8,0)
 ; $$GETS1^DIQ      DBIA 2056
"RTN","ORWDBA16",9,0)
 ; ^DIR             DBIA 10026
"RTN","ORWDBA16",10,0)
 ; $$FMTE^XLFDT     DBIA 10103
"RTN","ORWDBA16",11,0)
 ; $$NOW^XLFDT      DBIA 10103
"RTN","ORWDBA16",12,0)
 ; $$REPEAT^XLFSTR  DBIA 10103
"RTN","ORWDBA16",13,0)
 ; ENVAL^XPAR       DBIA 2263
"RTN","ORWDBA16",14,0)
 ;
"RTN","ORWDBA16",15,0)
 ;Variables Used:
"RTN","ORWDBA16",16,0)
 ; BAEE     External value of the CIDC functionality parameter
"RTN","ORWDBA16",17,0)
 ; DIR      Input array variable for ^DIR
"RTN","ORWDBA16",18,0)
 ; DTOUT    Timeout indicator variable, output from ^DIR
"RTN","ORWDBA16",19,0)
 ; DUOUT    Up Arrow '^' indicator variable, output from ^DIR
"RTN","ORWDBA16",20,0)
 ; ORERR    Error message array variable, output from ENVAL^XPAR
"RTN","ORWDBA16",21,0)
 ; IEN      Internal Entry Number
"RTN","ORWDBA16",22,0)
 ; LF       Line Feed
"RTN","ORWDBA16",23,0)
 ; LFC      Line Feed Count variable
"RTN","ORWDBA16",24,0)
 ; PAGE     Page Counter variable
"RTN","ORWDBA16",25,0)
 ; RPDT     Date the report is run, printed on hardcopy and terminal
"RTN","ORWDBA16",26,0)
 ; SEARCH   Type of report being run. Passed from ORWDBA14
"RTN","ORWDBA16",27,0)
 ; STOP     Report finished control variable, used by hardcopy report.
"RTN","ORWDBA16",28,0)
 ; U        Delimiter variable, defaulted to "^"
"RTN","ORWDBA16",29,0)
 ; X        Work variable
"RTN","ORWDBA16",30,0)
 ; X1       Work variable
"RTN","ORWDBA16",31,0)
 ; Y        Processed user selection varaible, output from ^DIR
"RTN","ORWDBA16",32,0)
 ;
"RTN","ORWDBA16",33,0)
 ;Globals Uses:
"RTN","ORWDBA16",34,0)
 ; ^TMP("ORPAL"
"RTN","ORWDBA16",35,0)
 ; Temp global to store raw and processed output of ENVAL^PAR
"RTN","ORWDBA16",36,0)
 ; Raw output of ENVAL^PAR
"RTN","ORWDBA16",37,0)
 ; ^TMP("ORPAL",$J,"A")=# Records Returned
"RTN","ORWDBA16",38,0)
 ; ^TMP("ORPAL",$J,"A",Provider IEN_";VA(200,",1)=Parameter value
"RTN","ORWDBA16",39,0)
 ; Processed output of ENVAL^PAR
"RTN","ORWDBA16",40,0)
 ; ^TMP("ORPAL",$J,"B",Name|IEN)=Name^Section^Parameter value
"RTN","ORWDBA16",41,0)
 ;
"RTN","ORWDBA16",42,0)
RPT ;Build and print parameter report
"RTN","ORWDBA16",43,0)
 N BAEE,DIR,DTOUT,DUOUT,ORERR,IEN,LF,LFC,PAGE,NAME,SEC,RPDT,STOP,X,X1,Y
"RTN","ORWDBA16",44,0)
 K ^TMP("ORPAL",$J)
"RTN","ORWDBA16",45,0)
 S RPDT=$$FMTE^XLFDT($$NOW^XLFDT),(IEN,X)="",U="^"
"RTN","ORWDBA16",46,0)
 D ENVAL^XPAR("^TMP(""ORPAL"",$J,""A"")","OR BILLING AWARENESS BY USER",1,.ORERR,1)
"RTN","ORWDBA16",47,0)
 F  S X=$O(^TMP("ORPAL",$J,"A",X)) Q:X=""  D
"RTN","ORWDBA16",48,0)
 . S IEN=$P(X,";")
"RTN","ORWDBA16",49,0)
 . S BAEE=$S(^TMP("ORPAL",$J,"A",X,1)=0:"No",1:"Yes")
"RTN","ORWDBA16",50,0)
 . S NAME=$$GET1^DIQ(200,IEN,.01)
"RTN","ORWDBA16",51,0)
 . S SEC=$$GET1^DIQ(200,IEN,29)
"RTN","ORWDBA16",52,0)
 . S:SEARCH="A" ^TMP("ORPAL",$J,"B",NAME_"|"_IEN)=NAME_U_SEC_U_BAEE
"RTN","ORWDBA16",53,0)
 . S:SEARCH="E"&(BAEE="Yes") ^TMP("ORPAL",$J,"B",NAME_"|"_IEN)=NAME_U_SEC_U_BAEE
"RTN","ORWDBA16",54,0)
 . S:SEARCH="D"&(BAEE="No") ^TMP("ORPAL",$J,"B",NAME_"|"_IEN)=NAME_U_SEC_U_BAEE
"RTN","ORWDBA16",55,0)
 S (X1,Y)="",PAGE=1,STOP=0
"RTN","ORWDBA16",56,0)
 D HDR
"RTN","ORWDBA16",57,0)
 F  S X1=$O(^TMP("ORPAL",$J,"B",X1)) Q:X1=""!(STOP=1)  D
"RTN","ORWDBA16",58,0)
 . W !,$P(^TMP("ORPAL",$J,"B",X1),U)
"RTN","ORWDBA16",59,0)
 . W ?40,$P(^TMP("ORPAL",$J,"B",X1),U,2)
"RTN","ORWDBA16",60,0)
 . W ?70,$P(^TMP("ORPAL",$J,"B",X1),U,3)
"RTN","ORWDBA16",61,0)
 . I $Y>(IOSL-4) D EOSP
"RTN","ORWDBA16",62,0)
 I STOP=0 S STOP=1
"RTN","ORWDBA16",63,0)
 I $E(IOST,1,2)'="C-" D FTR
"RTN","ORWDBA16",64,0)
 K ^TMP("ORPAL",$J)
"RTN","ORWDBA16",65,0)
 Q
"RTN","ORWDBA16",66,0)
HDR ;Print report page header
"RTN","ORWDBA16",67,0)
 W:$E(IOST)="C"!(PAGE>2) @IOF
"RTN","ORWDBA16",68,0)
 W !,$P($T(RH),";",2)
"RTN","ORWDBA16",69,0)
 W !,RPDT,!!
"RTN","ORWDBA16",70,0)
 W:SEARCH="A" $P($T(HDRA),";",2),!
"RTN","ORWDBA16",71,0)
 W:SEARCH="E" $P($T(HDRE),";",2),!
"RTN","ORWDBA16",72,0)
 W:SEARCH="D" $P($T(HDRD),";",2),!
"RTN","ORWDBA16",73,0)
 W !,"Provider",?40,"Section",?70,"Enabled"
"RTN","ORWDBA16",74,0)
 W !,$$REPEAT^XLFSTR("-",IOM)
"RTN","ORWDBA16",75,0)
 Q
"RTN","ORWDBA16",76,0)
EOSP ;End of Screen/Page
"RTN","ORWDBA16",77,0)
 S PAGE=PAGE+1
"RTN","ORWDBA16",78,0)
 I $E(IOST,1,2)="C-" D SFTR Q:STOP=1
"RTN","ORWDBA16",79,0)
 E  D FTR
"RTN","ORWDBA16",80,0)
 D HDR
"RTN","ORWDBA16",81,0)
 Q
"RTN","ORWDBA16",82,0)
 ;
"RTN","ORWDBA16",83,0)
SFTR ;Screen report footer
"RTN","ORWDBA16",84,0)
 S DIR(0)="E"
"RTN","ORWDBA16",85,0)
 D ^DIR K DIR
"RTN","ORWDBA16",86,0)
 I $D(DTOUT)!($D(DUOUT)) S STOP=1
"RTN","ORWDBA16",87,0)
 E  S STOP=0
"RTN","ORWDBA16",88,0)
 Q
"RTN","ORWDBA16",89,0)
 ;
"RTN","ORWDBA16",90,0)
FTR ;Print report page footer
"RTN","ORWDBA16",91,0)
 ;Used when output is directed to printer or spool device
"RTN","ORWDBA16",92,0)
 I STOP=1 D
"RTN","ORWDBA16",93,0)
 . S LFC=(IOSL-4)-$Y
"RTN","ORWDBA16",94,0)
 . F LF=1:1:LFC W !," "
"RTN","ORWDBA16",95,0)
 W:SEARCH="A" !,$P($T(FTRA),";",2)
"RTN","ORWDBA16",96,0)
 W:SEARCH="E" !,$P($T(FTRE),";",2)
"RTN","ORWDBA16",97,0)
 W:SEARCH="D" !,$P($T(FTRD),";",2)
"RTN","ORWDBA16",98,0)
 W ?60,"Page: ",PAGE
"RTN","ORWDBA16",99,0)
 Q
"RTN","ORWDBA16",100,0)
 ;Text used for building page/screen header/footer in HDR
"RTN","ORWDBA16",101,0)
RH ;Clinical Indicator Data Capture By Provider Parameter Report
"RTN","ORWDBA16",102,0)
HDRA ;All Providers With Clinical Indicator Data Capture Parameter
"RTN","ORWDBA16",103,0)
HDRE ;Only Providers With Clinical Indicator Data Capture Enabled
"RTN","ORWDBA16",104,0)
HDRD ;Only Providers With Clinical Indicator Data Capture Disabled
"RTN","ORWDBA16",105,0)
 ;Text used for building page footer in FTR
"RTN","ORWDBA16",106,0)
PF ;Clinical Data Capture By Provider Parameter Report
"RTN","ORWDBA16",107,0)
FTRA ;All With Parameter
"RTN","ORWDBA16",108,0)
FTRE ;Only Clinical Indicator Data Capture Enabled
"RTN","ORWDBA16",109,0)
FTRD ;Only Clinical Indicator Data Capture Disabled
"RTN","ORWDBA18")
0^37^B23979086
"RTN","ORWDBA18",1,0)
ORWDBA18 ; SLC/GDU - Billing Awareness - Phase I [10/18/04 10:30]
"RTN","ORWDBA18",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORWDBA18",3,0)
 ;
"RTN","ORWDBA18",4,0)
 ;Enable Billing Awareness By User Parameter Module
"RTN","ORWDBA18",5,0)
 ;ORWDBA18 - Assign the parameter utilities
"RTN","ORWDBA18",6,0)
 ;
"RTN","ORWDBA18",7,0)
SETUP ;Run temp global kill, build assigned list, build unassigned list
"RTN","ORWDBA18",8,0)
 D KTG,LISTA,LISTU Q
"RTN","ORWDBA18",9,0)
 ;
"RTN","ORWDBA18",10,0)
KTG ;Kill the temp globals used by this program
"RTN","ORWDBA18",11,0)
 K ^TMP("ORPAL",$J),^TMP("ORPUL",$J) Q
"RTN","ORWDBA18",12,0)
LISTA ;Build a list of providers with the parameter already assigned to them.
"RTN","ORWDBA18",13,0)
 N ORERR,PIV,NAME,X
"RTN","ORWDBA18",14,0)
 S (ORERR,X)="",U="^"
"RTN","ORWDBA18",15,0)
 D ENVAL^XPAR("^TMP(""ORPAL"",$J,""A"")","OR BILLING AWARENESS BY USER",1,.ORERR,1)
"RTN","ORWDBA18",16,0)
 Q:^TMP("ORPAL",$J,"A")=0
"RTN","ORWDBA18",17,0)
 F  S X=$O(^TMP("ORPAL",$J,"A",X)) Q:X=""  D
"RTN","ORWDBA18",18,0)
 . S IEN=$P(X,";"),PIV=^TMP("ORPAL",$J,"A",X,1)
"RTN","ORWDBA18",19,0)
 . S NAME=$$GET1^DIQ(200,IEN,.01)
"RTN","ORWDBA18",20,0)
 . S ^TMP("ORPAL",$J,"B",IEN)=NAME_U_PIV
"RTN","ORWDBA18",21,0)
 Q
"RTN","ORWDBA18",22,0)
LISTU ;Build a list of providers who have not been assigned the parameter
"RTN","ORWDBA18",23,0)
 N CNT,IEN,PRVKEY,NAME
"RTN","ORWDBA18",24,0)
 S (NAME,IEN,PRVKEY)="",(CNT,^TMP("ORPUL",$J,"A"))=0
"RTN","ORWDBA18",25,0)
 F  S NAME=$O(^VA(200,"B",NAME)) Q:NAME=""  D
"RTN","ORWDBA18",26,0)
 . S IEN=$QS($Q(^VA(200,"B",NAME)),4)
"RTN","ORWDBA18",27,0)
 . S PRVKEY=$$PRVKEY^ORWDBA1(IEN)  ;Check for provider key
"RTN","ORWDBA18",28,0)
 . I PRVKEY=0 Q  ;If not a provider quit
"RTN","ORWDBA18",29,0)
 . I $D(^TMP("ORPAL",$J,"B",IEN))=1 Q  ;If already assigned quit
"RTN","ORWDBA18",30,0)
 . ;Build ^TMP("ORPUL"
"RTN","ORWDBA18",31,0)
 . S CNT=CNT+1,^TMP("ORPUL",$J,"A")=CNT
"RTN","ORWDBA18",32,0)
 . S ^TMP("ORPUL",$J,"B",CNT)=NAME_U_IEN
"RTN","ORWDBA18",33,0)
 . S ^TMP("ORPUL",$J,"C",NAME)=CNT
"RTN","ORWDBA18",34,0)
 Q
"RTN","ORWDBA18",35,0)
ALERT ;Alert the user, all providers have been assigned the parameter
"RTN","ORWDBA18",36,0)
 ;Kill temp globals and quit
"RTN","ORWDBA18",37,0)
 N DIR
"RTN","ORWDBA18",38,0)
 D SCRHDR S DIR(0)="E"
"RTN","ORWDBA18",39,0)
 W !!,$P($T(ALLPA),";",2),!!
"RTN","ORWDBA18",40,0)
 D ^DIR K DIR
"RTN","ORWDBA18",41,0)
 D KTG Q
"RTN","ORWDBA18",42,0)
 ;
"RTN","ORWDBA18",43,0)
DISPRV ;Displays the providers in the unassigned list for user selection
"RTN","ORWDBA18",44,0)
 ;PRVNAME is set to null in ORWDBA8 and is reset based on user selection
"RTN","ORWDBA18",45,0)
 ;Selection of Q for quit, timeout, and up arrow will set PRVNAME to Q
"RTN","ORWDBA18",46,0)
 ;Selection of provider will set PRVNAME to the selected provider's name
"RTN","ORWDBA18",47,0)
 ;Prepare for display of providers
"RTN","ORWDBA18",48,0)
 ;N CNT,DIR,DTOUT,DUOUT,FST,HC,U,X,Y
"RTN","ORWDBA18",49,0)
 S FST=1,U="^"
"RTN","ORWDBA18",50,0)
DPO ;Display process starts here
"RTN","ORWDBA18",51,0)
 D SCRHDR
"RTN","ORWDBA18",52,0)
 S (X,Y)="",CNT=0,HC=1,DIR(0)=$P($T(SOOPT),";",3)
"RTN","ORWDBA18",53,0)
 F X=FST:1:10+(FST-1) Q:$D(^TMP("ORPUL",$J,"B",X))=0  D
"RTN","ORWDBA18",54,0)
 . S CNT=CNT+1 S:CNT>10 CNT=1
"RTN","ORWDBA18",55,0)
 . S DIR(0)=DIR(0)_CNT_":"_$P(^TMP("ORPUL",$J,"B",X),U)_";"
"RTN","ORWDBA18",56,0)
 S:CNT=10 DIR(0)=DIR(0)_";"_$P($T(D0N),";",3)
"RTN","ORWDBA18",57,0)
 S:FST>10 DIR(0)=DIR(0)_";"_$P($T(D0P),";",3)
"RTN","ORWDBA18",58,0)
 S DIR(0)=DIR(0)_";"_$P($TEXT(D0Q),";",3)
"RTN","ORWDBA18",59,0)
 S DIR("A")=$P($T(DA),";",3)
"RTN","ORWDBA18",60,0)
 S DIR("?",HC)=$P($T(DH),";",3)
"RTN","ORWDBA18",61,0)
 S:CNT=10 HC=HC+1,DIR("?",HC)=$P($T(DHN),";",3)
"RTN","ORWDBA18",62,0)
 S:FST>10 HC=HC+1,DIR("?",HC)=$P($T(DHP),";",3)
"RTN","ORWDBA18",63,0)
 S DIR("?")=$P($T(DHQ),";",3)
"RTN","ORWDBA18",64,0)
 D ^DIR K DIR
"RTN","ORWDBA18",65,0)
 I Y="Q"!(Y="")!($D(DTOUT))!($D(DUOUT)) S PRVNAME="Q" Q
"RTN","ORWDBA18",66,0)
 I Y="N"!(Y="P") S FST=$S(Y="N":FST+10,1:FST-10) G DPO
"RTN","ORWDBA18",67,0)
 S PRVNAME=Y(0) Q
"RTN","ORWDBA18",68,0)
CONMAS ;Confirm the mass assignment of the parameter
"RTN","ORWDBA18",69,0)
 ;MRC is set to null and ORWDBA8 and reset based on user selection here
"RTN","ORWDBA18",70,0)
 ;DIR array is set to values based on user selection in ORWDBA8
"RTN","ORWDBA18",71,0)
 ;Selection of NO, timeout, and up arrow will set MRC=0
"RTN","ORWDBA18",72,0)
 ;Selection of YES will set MRC=1
"RTN","ORWDBA18",73,0)
 S Y="" D SCRHDR,^DIR K DIR I Y="NO"!($D(DTOUT))!($D(DUOUT)) S MRC=0 Q
"RTN","ORWDBA18",74,0)
 S MRC=1 Q
"RTN","ORWDBA18",75,0)
MASASN ;Mass Assignment of the parameter
"RTN","ORWDBA18",76,0)
 ;SEL is set in ORWDBA8 by user selection.
"RTN","ORWDBA18",77,0)
 ;SEL="E", the parameter is set to 1 to enable Billing Data Capture
"RTN","ORWDBA18",78,0)
 ;SEL="D", the parameter is set to 0 to disable Billing Data Capture
"RTN","ORWDBA18",79,0)
 N DIR,ENT,ORERR,INST,PAR,U,VAL,X
"RTN","ORWDBA18",80,0)
 S (ENT,X)="",U="^",INST=1,VAL=$S(SEL="E":1,1:0)
"RTN","ORWDBA18",81,0)
 S PAR=$QS($Q(^XTV(8989.1,"B","OR BILLING AWARENESS BY USER")),4)
"RTN","ORWDBA18",82,0)
 D SCRHDR W !!
"RTN","ORWDBA18",83,0)
 F X=1:1:^TMP("ORPUL",$J,"A") D
"RTN","ORWDBA18",84,0)
 . W "."
"RTN","ORWDBA18",85,0)
 . S ENT=$P(^TMP("ORPUL",$J,"B",X),U,2)_";VA(200,"
"RTN","ORWDBA18",86,0)
 . D ADD^XPAR(ENT,PAR,INST,VAL,.ORERR)
"RTN","ORWDBA18",87,0)
 S DIR(0)="E",DIR("A")=$S(SEL="E":$P($T(MEC),";",3),1:$P($T(MDC),";",3))
"RTN","ORWDBA18",88,0)
 D ^DIR K DIR Q
"RTN","ORWDBA18",89,0)
SCRHDR ;Screen Header
"RTN","ORWDBA18",90,0)
 W:$D(IOF) @IOF
"RTN","ORWDBA18",91,0)
 W !,$P($T(SH),";",3),!
"RTN","ORWDBA18",92,0)
 W:SEL="" $P($T(SHA),";",3)
"RTN","ORWDBA18",93,0)
 W:SEL="E" $P($T(SHAE),";",3)
"RTN","ORWDBA18",94,0)
 W:SEL="D" $P($T(SHAD),";",3)
"RTN","ORWDBA18",95,0)
 W:SEL="I" $P($T(SHAI),";",3)
"RTN","ORWDBA18",96,0)
 Q
"RTN","ORWDBA18",97,0)
 ;;Text for user messages, selection options, user help
"RTN","ORWDBA18",98,0)
ALLPA ;;All providers have been assigned the parameter.
"RTN","ORWDBA18",99,0)
SOOPT ;;SO^
"RTN","ORWDBA18",100,0)
SXOPT ;;SX^
"RTN","ORWDBA18",101,0)
SH ;;Enable Clinical Indicator Data Capture By Provider Parameter Management
"RTN","ORWDBA18",102,0)
SHA ;;Assign Parameter To Provider Option
"RTN","ORWDBA18",103,0)
SHAE ;;Assign/Enable Parameter For All Providers Option
"RTN","ORWDBA18",104,0)
SHAD ;;Assign/Disable Parameter For All Providers Option
"RTN","ORWDBA18",105,0)
SHAI ;;Assign and Enable/Disable Parameter By Individual Provider Option
"RTN","ORWDBA18",106,0)
MMPA ;;All providers have the Enable CIDC By User parameter assigned.
"RTN","ORWDBA18",107,0)
DH ;;Select the provider who the parameter will be assigned to.
"RTN","ORWDBA18",108,0)
DHN ;;Enter N to get the next 10 providers in the list.
"RTN","ORWDBA18",109,0)
DHP ;;Enter P to get the previous 10 providers in the list.
"RTN","ORWDBA18",110,0)
DHQ ;;Enter Q to quit and return to previous menu.
"RTN","ORWDBA18",111,0)
D0N ;;N:Next 10 providers
"RTN","ORWDBA18",112,0)
D0P ;;P:Previous 10 providers
"RTN","ORWDBA18",113,0)
D0Q ;;Q:Quit
"RTN","ORWDBA18",114,0)
DA ;;Select the provider to assign the parameter
"RTN","ORWDBA18",115,0)
MEP ;;Now assigning and enabling the Clinical Indicatr Data Capture parameter
"RTN","ORWDBA18",116,0)
MEC ;;Assignment and enable Clinical Indicator Data Capture complete
"RTN","ORWDBA18",117,0)
MDP ;;Now assigning and disabling the Clinical Indicator Data Capture parameter
"RTN","ORWDBA18",118,0)
MDC ;;Assignment and disable Clinical Indicator Data Capture complete
"RTN","ORWDBA2")
0^31^B27608999
"RTN","ORWDBA2",1,0)
ORWDBA2 ; SLC/GDU - Billing Awareness - Phase I [11/26/04 15:43]
"RTN","ORWDBA2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORWDBA2",3,0)
 ;
"RTN","ORWDBA2",4,0)
 ;Clinician's Personal Diagnoses List
"RTN","ORWDBA2",5,0)
 ;The personal diagnoses list is stored in the NEW PERSON file # 200.
"RTN","ORWDBA2",6,0)
 ;In file # 200 it is stored in the multi-valued field PERSONAL DIAGNOSIS
"RTN","ORWDBA2",7,0)
 ;LIST, field # 351, sub-file 200.0351. This is unique to the individual
"RTN","ORWDBA2",8,0)
 ;clinician. It is designed to aid the clinician with the CIDC process
"RTN","ORWDBA2",9,0)
 ;by providing a list of diagnoses codes most frequently used by that
"RTN","ORWDBA2",10,0)
 ;clinician.
"RTN","ORWDBA2",11,0)
 ;
"RTN","ORWDBA2",12,0)
 ;External References:
"RTN","ORWDBA2",13,0)
 ;  NOW^%DTC             DBIA 10000
"RTN","ORWDBA2",14,0)
 ;  FILE^DIE             DBIA 2053
"RTN","ORWDBA2",15,0)
 ;  UPDATE^DIE           DBIA 2053
"RTN","ORWDBA2",16,0)
 ;  DT^DILF              DBIA 2054
"RTN","ORWDBA2",17,0)
 ;  FDA^FILF             DBIA 2054
"RTN","ORWDBA2",18,0)
 ;  $$GET1^DIQ           DBIA 2056
"RTN","ORWDBA2",19,0)
 ;  GETS^DIQ             DBIA 2056
"RTN","ORWDBA2",20,0)
 ;  $$STATCHK^ICDAPIU    DBIA 3991
"RTN","ORWDBA2",21,0)
 ;  $$ICDDX^ICDCODE      DBIA 3990
"RTN","ORWDBA2",22,0)
 ;  $$NOW^XLFDT          DBIA 10103
"RTN","ORWDBA2",23,0)
 ;
"RTN","ORWDBA2",24,0)
ADDPDL(Y,ORCIEN,ORDXA) ;Add to Personal Diagnosis List
"RTN","ORWDBA2",25,0)
 ;Add a new personal diagnosis list or new ICD9 code to an existing
"RTN","ORWDBA2",26,0)
 ;personal diagnosis list for a clinician. It will filter out duplicate
"RTN","ORWDBA2",27,0)
 ;entries before updating an existing PDL.
"RTN","ORWDBA2",28,0)
 ;Input Variables:
"RTN","ORWDBA2",29,0)
 ;  ORCIEN       Clinician Internal Entry Number
"RTN","ORWDBA2",30,0)
 ;  ORDXA        Array of dx codes to be added to personal dx list
"RTN","ORWDBA2",31,0)
 ;               format: ORDXA(#)=ICD9_Code^Lexicon_Expression_IEN
"RTN","ORWDBA2",32,0)
 ;Output Variable:
"RTN","ORWDBA2",33,0)
 ;  Y            Return value, 1 successful, 0 unsuccessful
"RTN","ORWDBA2",34,0)
 ;Local Variables:
"RTN","ORWDBA2",35,0)
 ;  DXI          Diagnosis Array Index
"RTN","ORWDBA2",36,0)
 ;  DXIEN        Diagnosis Code Internal Entry Number
"RTN","ORWDBA2",37,0)
 ;  EM           Error Message
"RTN","ORWDBA2",38,0)
 ;  FDXR         Found Diagnoses Records Array
"RTN","ORWDBA2",39,0)
 ;  FDXRI        Found Diagnoses Records Array Index
"RTN","ORWDBA2",40,0)
 ;  IEN          Internal Entry Number
"RTN","ORWDBA2",41,0)
 ;  PDL          Personal Diagnoses List Array
"RTN","ORWDBA2",42,0)
 ;  PDLI         Personal Diagnoses List Array Index
"RTN","ORWDBA2",43,0)
 N DXI,DXIEN,EM,FDXR,FDXRI,IEN,PDL,PDLI
"RTN","ORWDBA2",44,0)
 ;Gets clinician's Personal Diagnosis List and removes duplicates from
"RTN","ORWDBA2",45,0)
 ;dx input array. Quits if all are duplicates.
"RTN","ORWDBA2",46,0)
 D GETS^DIQ(200,ORCIEN,"351*,","","PDL","EM")
"RTN","ORWDBA2",47,0)
 I $D(PDL) D
"RTN","ORWDBA2",48,0)
 . S DXI="" F  S DXI=$O(ORDXA(DXI)) Q:DXI=""  D
"RTN","ORWDBA2",49,0)
 .. S PDLI="" F  S PDLI=$O(PDL(200.0351,PDLI)) Q:PDLI=""  D
"RTN","ORWDBA2",50,0)
 ... I PDL(200.0351,PDLI,.01)=$P($G(ORDXA(DXI)),U) K ORDXA(DXI)
"RTN","ORWDBA2",51,0)
 I $D(ORDXA)=0 S Y=0 Q
"RTN","ORWDBA2",52,0)
 ;Process dx input array
"RTN","ORWDBA2",53,0)
 S DXI="" F  S DXI=$O(ORDXA(DXI)) Q:DXI=""!($D(EM))  D
"RTN","ORWDBA2",54,0)
 . K FDXR,EM
"RTN","ORWDBA2",55,0)
 . ;Get the IEN for the current diagnosis code
"RTN","ORWDBA2",56,0)
 . D FIND^DIC(80,"","","CM",$P(ORDXA(DXI),U),"*","","","","FDXR","EM")
"RTN","ORWDBA2",57,0)
 . I $P(FDXR("DILIST",0),U)=0 Q
"RTN","ORWDBA2",58,0)
 . I $P(FDXR("DILIST",0),U)=1 S DXIEN=FDXR("DILIST",2,1)
"RTN","ORWDBA2",59,0)
 . I $P(FDXR("DILIST",0),U)>1 D
"RTN","ORWDBA2",60,0)
 .. F FDXRI=1:1:FDXR("DILIST",0) D
"RTN","ORWDBA2",61,0)
 ... I FDXR("DILIST",1,FDXRI)=$P($G(ORDXA(DXI)),U) S DXIEN=FDXR("DILIST",2,FDXRI)
"RTN","ORWDBA2",62,0)
 . ;Add IDC9 code to personal diagnoses list
"RTN","ORWDBA2",63,0)
 . K IEN
"RTN","ORWDBA2",64,0)
 . S IEN="1,"_ORCIEN_",",IEN="+"_IEN
"RTN","ORWDBA2",65,0)
 . D FDA^DILF(200.0351,IEN,.01,"",DXIEN,"FDA","EM")
"RTN","ORWDBA2",66,0)
 . D UPDATE^DIE("","FDA","IEN","EM")
"RTN","ORWDBA2",67,0)
 . ;Add Lexicon Expression list
"RTN","ORWDBA2",68,0)
 . I $P(ORDXA(DXI),U,2)'="" D
"RTN","ORWDBA2",69,0)
 .. S IEN=IEN(1)_","_ORCIEN_","
"RTN","ORWDBA2",70,0)
 .. D FDA^DILF(200.0351,IEN,1,"",$P(ORDXA(DXI),U,2),"FDA","EM")
"RTN","ORWDBA2",71,0)
 .. D FILE^DIE("","FDA","EM")
"RTN","ORWDBA2",72,0)
 I $D(EM) S Y=0 Q
"RTN","ORWDBA2",73,0)
 S Y=1
"RTN","ORWDBA2",74,0)
 Q
"RTN","ORWDBA2",75,0)
 ;
"RTN","ORWDBA2",76,0)
DELPDL(Y,ORCIEN,ORDXA) ;Delete from Personal Diagnosis List
"RTN","ORWDBA2",77,0)
 ;Delete a selected diagnosis code or group of diagnoses codes from a
"RTN","ORWDBA2",78,0)
 ;Clinician's Personal DX List.
"RTN","ORWDBA2",79,0)
 ;Input Variables:
"RTN","ORWDBA2",80,0)
 ;  ORCIEN    Clinician Internal ID number
"RTN","ORWDBA2",81,0)
 ;  ORDXA     Array of dx codes to be deleted from personal dx list
"RTN","ORWDBA2",82,0)
 ;Output Variable:
"RTN","ORWDBA2",83,0)
 ;  Y         Return value, 1 successful, 0 unsuccessful
"RTN","ORWDBA2",84,0)
 ;Local Variables:
"RTN","ORWDBA2",85,0)
 ;  DXI       Diagnosis code array index
"RTN","ORWDBA2",86,0)
 ;  EM        Error Message
"RTN","ORWDBA2",87,0)
 ;  FDA       FileMan Data Array
"RTN","ORWDBA2",88,0)
 ;  IEN       Interanl Entry Number
"RTN","ORWDBA2",89,0)
 ;  RF        Record Found
"RTN","ORWDBA2",90,0)
 N DXI,EM,FDA,IEN,RF
"RTN","ORWDBA2",91,0)
 D GETS^DIQ(200,ORCIEN,"351*,","","RF","EM")
"RTN","ORWDBA2",92,0)
 I $D(RF)=0 S Y=0 Q
"RTN","ORWDBA2",93,0)
 S IEN="" F  S IEN=$O(RF(200.0351,IEN)) Q:IEN=""  D
"RTN","ORWDBA2",94,0)
 .S DXI="" F  S DXI=$O(ORDXA(DXI)) Q:DXI=""  D
"RTN","ORWDBA2",95,0)
 .. I RF(200.0351,IEN,.01)=ORDXA(DXI) D
"RTN","ORWDBA2",96,0)
 ... D FDA^DILF(200.0351,IEN,.01,"","@","FDA","EM")
"RTN","ORWDBA2",97,0)
 ... D FILE^DIE("","FDA","EM")
"RTN","ORWDBA2",98,0)
 S Y=1
"RTN","ORWDBA2",99,0)
 Q
"RTN","ORWDBA2",100,0)
 ;
"RTN","ORWDBA2",101,0)
GETPDL(Y,ORCIEN) ;Get Personal Diagnosis List
"RTN","ORWDBA2",102,0)
 ;This gets the clinician's personal diagnosis list. Using the personal
"RTN","ORWDBA2",103,0)
 ;diagnosis list, builds and returns an array variable with the ICD9
"RTN","ORWDBA2",104,0)
 ;codes and descriptions stored in the ICD DIAGNOSIS file, # 80.
"RTN","ORWDBA2",105,0)
 ;Flagging any inactive ICD9 code with a "#".
"RTN","ORWDBA2",106,0)
 ;Input Variable:
"RTN","ORWDBA2",107,0)
 ;  ORCIEN    Clinician Internal ID number
"RTN","ORWDBA2",108,0)
 ;Output Variable:
"RTN","ORWDBA2",109,0)
 ;  Y         Array of ICD9 codes and descriptions
"RTN","ORWDBA2",110,0)
 ;            Y(#)=ICD9_code^DX_description^DX_Inactive
"RTN","ORWDBA2",111,0)
 ;                 If inactive # in third piece
"RTN","ORWDBA2",112,0)
 ;                 If active null in third piece
"RTN","ORWDBA2",113,0)
 ;Local Variables:
"RTN","ORWDBA2",114,0)
 ;  DXC       Diagnosis Code (for sorting)
"RTN","ORWDBA2",115,0)
 ;  DXD       Diagnosis Description
"RTN","ORWDBA2",116,0)
 ;  DXDT      Diagnosis Date
"RTN","ORWDBA2",117,0)
 ;  DXI       Diagnosis Inactive Flag
"RTN","ORWDBA2",118,0)
 ;  EM        Error Message
"RTN","ORWDBA2",119,0)
 ;  ICD9      ICD9 code (for GUI)
"RTN","ORWDBA2",120,0)
 ;  IEN       Internal Entry Number
"RTN","ORWDBA2",121,0)
 ;  RF        Record Found
"RTN","ORWDBA2",122,0)
 N DXC,DXD,DXDT,DXI,EM,ICD9,IEN,RF
"RTN","ORWDBA2",123,0)
 S DXDT=$$NOW^XLFDT
"RTN","ORWDBA2",124,0)
 D GETS^DIQ(200,ORCIEN,"351*,","EI","RF","EM")
"RTN","ORWDBA2",125,0)
 I $D(RF) D
"RTN","ORWDBA2",126,0)
 . S (DXC,DXD,DXI,ICD9,IEN)=""
"RTN","ORWDBA2",127,0)
 . F  S IEN=$O(RF(200.0351,IEN)) Q:IEN=""  D
"RTN","ORWDBA2",128,0)
 .. S ICD9=RF(200.0351,IEN,.01,"E")
"RTN","ORWDBA2",129,0)
 .. S DXC=$$SETDXC(ICD9)
"RTN","ORWDBA2",130,0)
 .. I $G(RF(200.0351,IEN,1,"I"))="" S DXD=$$SETDXD($P($$ICDDX^ICDCODE(ICD9,DXDT),U,4))
"RTN","ORWDBA2",131,0)
 .. I $G(RF(200.0351,IEN,1,"I"))=1 S DXD=$$SETDXD($P($$ICDDX^ICDCODE(ICD9,DXDT),U,4))
"RTN","ORWDBA2",132,0)
 .. I $G(RF(200.0351,IEN,1,"I"))>1 S DXD=RF(200.0351,IEN,1,"E")
"RTN","ORWDBA2",133,0)
 .. S DXI=$$SETDXI($$STATCHK^ICDAPIU(ICD9,DXDT))
"RTN","ORWDBA2",134,0)
 .. S Y(DXC)=ICD9_U_DXD_U_DXI
"RTN","ORWDBA2",135,0)
 E  S Y=0
"RTN","ORWDBA2",136,0)
 Q
"RTN","ORWDBA2",137,0)
 ;  
"RTN","ORWDBA2",138,0)
GETDUDC(Y,ORCIEN,ORPTIEN) ;Get Day's Unique Diagnoses Codes
"RTN","ORWDBA2",139,0)
 ;Gets all the unique ICD9 codes for the orders placed today by the
"RTN","ORWDBA2",140,0)
 ;clinician for this patient. Using the ICD9 codes it builds an array
"RTN","ORWDBA2",141,0)
 ;variable with the ICD9 code, its description from the ICD DIAGNOSIS
"RTN","ORWDBA2",142,0)
 ;file, #80. Flagging any inactive ICD9 codes with a "#".
"RTN","ORWDBA2",143,0)
 ;Input Variables:
"RTN","ORWDBA2",144,0)
 ;  ORCIEN    Clinician's internal ID number
"RTN","ORWDBA2",145,0)
 ;  ORPTIEN   Patient's internal ID number
"RTN","ORWDBA2",146,0)
 ;Output Variable:
"RTN","ORWDBA2",147,0)
 ;  Y         Array of ICD9 codes and descriptions
"RTN","ORWDBA2",148,0)
 ;            Y(#)=ICD9_code^DX_Description^DX_Inactive
"RTN","ORWDBA2",149,0)
 ;                 If inactive # in third piece
"RTN","ORWDBA2",150,0)
 ;                 If active null in third piece
"RTN","ORWDBA2",151,0)
 ;Local Variables:
"RTN","ORWDBA2",152,0)
 ;  CKDATE    Check Date (stops loop)
"RTN","ORWDBA2",153,0)
 ;  DXC       Diagnosis Code (for sorting)
"RTN","ORWDBA2",154,0)
 ;  DXD       Diagnosis Description
"RTN","ORWDBA2",155,0)
 ;  DXI       Diagnosis Inactive Flag
"RTN","ORWDBA2",156,0)
 ;  DXIEN     Diagnosis Internal Entry Number
"RTN","ORWDBA2",157,0)
 ;  ICD9      ICD9 code (for GUI display)
"RTN","ORWDBA2",158,0)
 ;  IEN       Internal Entry Number
"RTN","ORWDBA2",159,0)
 ;  OBJORD    Object of Order
"RTN","ORWDBA2",160,0)
 ;  ORDATE    Order Date
"RTN","ORWDBA2",161,0)
 ;  ORDG      Order Group (ACT index variable)
"RTN","ORWDBA2",162,0)
 ;  OREM      Order Error Message
"RTN","ORWDBA2",163,0)
 ;  ORIEN     Order Internal Entry Number
"RTN","ORWDBA2",164,0)
 ;  ORRF      Order Record Found
"RTN","ORWDBA2",165,0)
 ;  RCODI     Reverse Cronological Order Date Index
"RTN","ORWDBA2",166,0)
 ;  SUBFILE   Subfile Number
"RTN","ORWDBA2",167,0)
 N CKDATE,DXC,DXD,DXEM,DXI,DXIEN,DXRF,ICD9,IEN,OBJORD,ORDATE,ORDG,OREM
"RTN","ORWDBA2",168,0)
 N ORIEN,ORRF,RCODI,SUBFILE
"RTN","ORWDBA2",169,0)
 S OBJORD=ORPTIEN_";DPT("
"RTN","ORWDBA2",170,0)
 S (DXIEN,ORDATE,ORDG,ORIEN,RCODI)="",CKDATE=$$F24HA
"RTN","ORWDBA2",171,0)
 F  S RCODI=$O(^OR(100,"ACT",OBJORD,RCODI)) S ORDATE=9999999-RCODI Q:ORDATE<CKDATE!(RCODI="")  D
"RTN","ORWDBA2",172,0)
 . F  S ORDG=$O(^OR(100,"ACT",OBJORD,RCODI,ORDG)) Q:ORDG=""  D
"RTN","ORWDBA2",173,0)
 .. S ORIEN=$QS($Q(^OR(100,"ACT",OBJORD,RCODI,ORDG)),6)
"RTN","ORWDBA2",174,0)
 .. K ORRF,OREM
"RTN","ORWDBA2",175,0)
 .. D GETS^DIQ(100,ORIEN,"1;5.1*","I","ORRF","OREM")
"RTN","ORWDBA2",176,0)
 .. S IEN=$QS($Q(ORRF(100)),2)
"RTN","ORWDBA2",177,0)
 .. Q:ORRF(100,IEN,1,"I")'=ORCIEN
"RTN","ORWDBA2",178,0)
 .. Q:$D(ORRF(100.051))=0
"RTN","ORWDBA2",179,0)
 .. S (DXC,DXD,DXI,DXIEN,ICD9,IEN)=""
"RTN","ORWDBA2",180,0)
 .. F  S IEN=$O(ORRF(100.051,IEN)) Q:IEN=""  D
"RTN","ORWDBA2",181,0)
 ... Q:ORRF(100.051,IEN,.01,"I")=""
"RTN","ORWDBA2",182,0)
 ... S DXIEN=ORRF(100.051,IEN,.01,"I")
"RTN","ORWDBA2",183,0)
 ... S ICD9=$$GET1^DIQ(80,DXIEN,.01,"")
"RTN","ORWDBA2",184,0)
 ... S DXC=$$SETDXC(ICD9)
"RTN","ORWDBA2",185,0)
 ... S DXD=$$SETDXD($P($$ICDDX^ICDCODE(ICD9,ORDATE),U,4))
"RTN","ORWDBA2",186,0)
 ... S DXI=$$SETDXI($$STATCHK^ICDAPIU(ICD9,ORDATE))
"RTN","ORWDBA2",187,0)
 ... S Y(DXC)=ICD9_U_DXD_U_DXI
"RTN","ORWDBA2",188,0)
 Q
"RTN","ORWDBA2",189,0)
 ;
"RTN","ORWDBA2",190,0)
SETDXC(X) ;Set diagnosis code variable for sorting 
"RTN","ORWDBA2",191,0)
 S X=$S($E(X)?1A:X,1:+X) Q X
"RTN","ORWDBA2",192,0)
 ;
"RTN","ORWDBA2",193,0)
SETDXD(X) ;Set upper case diagnosis discription to mixed case
"RTN","ORWDBA2",194,0)
 N X1,X2
"RTN","ORWDBA2",195,0)
 F X1=2:1:$L(X) D
"RTN","ORWDBA2",196,0)
 . I $E(X,X1)?1U,$E(X,X1-1)?1A D
"RTN","ORWDBA2",197,0)
 .. S X2=$E(X,X1)
"RTN","ORWDBA2",198,0)
 .. S X2=$C($A(X2)+32)
"RTN","ORWDBA2",199,0)
 .. S $E(X,X1)=X2
"RTN","ORWDBA2",200,0)
 Q X
"RTN","ORWDBA2",201,0)
 ;
"RTN","ORWDBA2",202,0)
SETDXI(X) ;Set the diagnosis inactive indicator
"RTN","ORWDBA2",203,0)
 S X=$S($P(X,U)=0:"#",1:"") Q X
"RTN","ORWDBA2",204,0)
 ;
"RTN","ORWDBA2",205,0)
CI(CNT) ;Counter Incrementer
"RTN","ORWDBA2",206,0)
 ; CNT - Counter
"RTN","ORWDBA2",207,0)
 S CNT=CNT+1 Q CNT
"RTN","ORWDBA2",208,0)
 ;
"RTN","ORWDBA2",209,0)
F24HA() ;Returns date and time from exactly 24 hours ago
"RTN","ORWDBA2",210,0)
 N %,%H,%I,X
"RTN","ORWDBA2",211,0)
 D NOW^%DTC
"RTN","ORWDBA2",212,0)
 Q %-1
"RTN","ORWDBA2",213,0)
 ;
"RTN","ORWDBA2",214,0)
ERRMSG(MT) ;Display Error Message
"RTN","ORWDBA2",215,0)
 ; to be determined
"RTN","ORWDBA2",216,0)
 Q
"RTN","ORWDBA3")
0^30^B40156794
"RTN","ORWDBA3",1,0)
ORWDBA3 ; SLC/GSS Billing Awareness (CIDC) [8/20/03 9:19am]
"RTN","ORWDBA3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**190,195**;Dec 17, 1997
"RTN","ORWDBA3",3,0)
 ;
"RTN","ORWDBA3",4,0)
ORFMDAT(ORDFN) ; Return date in FM format regarding order for CSV/CTD/HIPAA
"RTN","ORWDBA3",5,0)
 ; Pass in Order IEN
"RTN","ORWDBA3",6,0)
 Q ($P($G(^OR(100,ORDFN,8,1,0)),"^",16)\1)
"RTN","ORWDBA3",7,0)
 ;
"RTN","ORWDBA3",8,0)
DISPLAY ; Display of BA data from original copied order (ORIT = ORIEN)
"RTN","ORWDBA3",9,0)
 ; Displayed in window with all order info and user can accept/edit
"RTN","ORWDBA3",10,0)
 ; Note: TxF = Treatment Factor
"RTN","ORWDBA3",11,0)
 ; BA data (Dx,TxF's) not editable but in signature window, not in above
"RTN","ORWDBA3",12,0)
 ; ORIT defined in ORWDXM1, DISPLAY called from ORWDXM2
"RTN","ORWDBA3",13,0)
 ;
"RTN","ORWDBA3",14,0)
 ; Input:
"RTN","ORWDBA3",15,0)
 ;  ORIT, ILST, and LST() from ORWDXM* routines
"RTN","ORWDBA3",16,0)
 ; Output:
"RTN","ORWDBA3",17,0)
 ;  ILST and LST() appropriately incremented/populated for order display
"RTN","ORWDBA3",18,0)
 ; Variables:
"RTN","ORWDBA3",19,0)
 ;  CUN     = TxF's in C, U, or N format
"RTN","ORWDBA3",20,0)
 ;  I       = counter
"RTN","ORWDBA3",21,0)
 ;  ILST    = line counter, initially from ORWDXM* routines
"RTN","ORWDBA3",22,0)
 ;  LST()   = array of lines to output, initially from ORWDXM* routines
"RTN","ORWDBA3",23,0)
 ;  NTF     = # of Treatment Factors
"RTN","ORWDBA3",24,0)
 ;  ORITARY = ORIT array of 1 needed to access GETTFCI^ORWDBA4
"RTN","ORWDBA3",25,0)
 ;  SPCS    = # of characters to space to left of ':'
"RTN","ORWDBA3",26,0)
 ;  TF1     = first TxF output? (0/1)
"RTN","ORWDBA3",27,0)
 ;  TFGBL   = TxF's in Global stored order
"RTN","ORWDBA3",28,0)
 ;  TFGUI   = TxF's in GUI returned order
"RTN","ORWDBA3",29,0)
 ;  TFV     = TxF verbiage
"RTN","ORWDBA3",30,0)
 ;
"RTN","ORWDBA3",31,0)
 N CUN,I,NTF,ORITARY,SPCS,TF1,TFGBL,TFGUI,TFV,Y
"RTN","ORWDBA3",32,0)
 S NTF=7,SPCS=28,ORITARY(1)=+ORIT
"RTN","ORWDBA3",33,0)
 ; Get Y(+ORIT) string in ORIEN^CUUUCCN^Dx1^Desc1^Dx2^Desc2^... format
"RTN","ORWDBA3",34,0)
 D GETTFCI^ORWDBA4(.Y,.ORITARY)
"RTN","ORWDBA3",35,0)
 S CUN=$P($G(Y(1)),U,2)  ;CUN = Treatment Factors in CUN syntax
"RTN","ORWDBA3",36,0)
 ; First output Diagnosis information - if any
"RTN","ORWDBA3",37,0)
 F I=3:2:9 I $P($G(Y(1)),U,I)'="" D
"RTN","ORWDBA3",38,0)
 . S ILST=ILST+1,LST(ILST)=$S(I=3:"Diagnoses",1:"")
"RTN","ORWDBA3",39,0)
 . S LST(ILST)=LST(ILST)_":"_$P(Y(1),U,I)_" - "_$P(Y(1),U,I+1)
"RTN","ORWDBA3",40,0)
 . D FRMTLST
"RTN","ORWDBA3",41,0)
 ; Get GUI and GBL Treatment Factor sequence strings
"RTN","ORWDBA3",42,0)
 D TFSTGS^ORWDBA1
"RTN","ORWDBA3",43,0)
 ; Assumes SC will always be first in sequence! - not likely to change
"RTN","ORWDBA3",44,0)
 S ILST=ILST+1
"RTN","ORWDBA3",45,0)
 S LST(ILST)="Service Connected:"_$S($E(CUN)="C":"YES",1:"NO")
"RTN","ORWDBA3",46,0)
 D FRMTLST
"RTN","ORWDBA3",47,0)
 S ILST=ILST+1,LST(ILST)="Treatment Factors:"
"RTN","ORWDBA3",48,0)
 ; If no TxF's (no 'C'hecked) {SC output above} then output '<none>'
"RTN","ORWDBA3",49,0)
 I '$F($E(CUN,2,NTF),"C") S LST(ILST)=LST(ILST)_"<none>" D FRMTLST Q
"RTN","ORWDBA3",50,0)
 S TF1=0  ;No TxF yet output
"RTN","ORWDBA3",51,0)
 ; Verbiage for TxF's
"RTN","ORWDBA3",52,0)
 S TFV("MST")="MILITARY SEXUAL TRAUMA",TFV("AO")="AGENT ORANGE"
"RTN","ORWDBA3",53,0)
 S TFV("IR")="IONIZING RADIATION",TFV("EC")="ENVIRONMENTAL CONTAMINANTS"
"RTN","ORWDBA3",54,0)
 S TFV("HNC")="HEAD AND NECK CANCER",TFV("CV")="COMBAT VETERAN"
"RTN","ORWDBA3",55,0)
 ; Output Checked TxF's
"RTN","ORWDBA3",56,0)
 F I=2:1:NTF I $E(CUN,I)="C" D
"RTN","ORWDBA3",57,0)
 . I 'TF1 S LST(ILST)=LST(ILST)_TFV($P(TFGUI,U,I)),TF1=1 D FRMTLST Q
"RTN","ORWDBA3",58,0)
 . S ILST=ILST+1,LST(ILST)=":"_TFV($P(TFGUI,U,I)) D FRMTLST
"RTN","ORWDBA3",59,0)
 Q
"RTN","ORWDBA3",60,0)
 ;
"RTN","ORWDBA3",61,0)
FRMTLST ; Format the variable LST(ILST) for DISPLAY tag
"RTN","ORWDBA3",62,0)
 S LST(ILST)=$J($P(LST(ILST),":"),SPCS)_": "_$P(LST(ILST),":",2)
"RTN","ORWDBA3",63,0)
 Q
"RTN","ORWDBA3",64,0)
 ;
"RTN","ORWDBA3",65,0)
HINTS(Y) ; Return HINTS for ORBA Treatment Factors - used by Delphi
"RTN","ORWDBA3",66,0)
 ; The hints returned in the Y array will be used in the CPRS GUI and
"RTN","ORWDBA3",67,0)
 ; displayed on fly-over of the cursor over the TxF text in the window
"RTN","ORWDBA3",68,0)
 ;
"RTN","ORWDBA3",69,0)
 ; Input
"RTN","ORWDBA3",70,0)
 ;  <none>
"RTN","ORWDBA3",71,0)
 ; Output
"RTN","ORWDBA3",72,0)
 ;  Y array of the hints for TxF's> Y(#)=TxFA ^ TxF line # ^ hint text
"RTN","ORWDBA3",73,0)
 ;    where TxFA is Treatment Factor acronym, e.g., CV=Combat Veteran
"RTN","ORWDBA3",74,0)
 ; Variables
"RTN","ORWDBA3",75,0)
 ;  CT      = line number count, used in Y(#) where #=CT
"RTN","ORWDBA3",76,0)
 ;  I       = incrementor index #
"RTN","ORWDBA3",77,0)
 ;  ORTFIEN = the IEN for the TxF in the Help Frame (^DIC(9.2)) file
"RTN","ORWDBA3",78,0)
 ;  TF      = TxF acronym
"RTN","ORWDBA3",79,0)
 ;  TFLN    = TxF text line number, e.g., ^DIC(9.2,ORTFIEN,1,TFLN,0)
"RTN","ORWDBA3",80,0)
 ;  TFS     = string of TxF acronyms
"RTN","ORWDBA3",81,0)
 ;  TFV     = TxF description/text
"RTN","ORWDBA3",82,0)
 ;
"RTN","ORWDBA3",83,0)
 N CT,I,ORTFIEN,TF,TFLN,TFS,TFV
"RTN","ORWDBA3",84,0)
 ;
"RTN","ORWDBA3",85,0)
 S TFS="SC^MST^AO^IR^EC^HNC^CV",CT=0
"RTN","ORWDBA3",86,0)
 ; Get next TxF from TFS
"RTN","ORWDBA3",87,0)
 F I=1:1 S TF=$P(TFS,U,I) Q:TF=""  D
"RTN","ORWDBA3",88,0)
 . S ORTFIEN=$O(^DIC(9.2,"B","ORBA-"_TF,"")),TFV="",TFLN=0
"RTN","ORWDBA3",89,0)
 . ; Get next line of hint text
"RTN","ORWDBA3",90,0)
 . F  S TFLN=$O(^DIC(9.2,ORTFIEN,1,TFLN)) Q:'TFLN  D
"RTN","ORWDBA3",91,0)
 .. S CT=CT+1,Y(CT)=TF_U_TFLN_U_^DIC(9.2,ORTFIEN,1,TFLN,0)
"RTN","ORWDBA3",92,0)
 Q
"RTN","ORWDBA3",93,0)
 ;
"RTN","ORWDBA3",94,0)
DG1(ORDFN,COUNTER,CTVALUE) ; Create DG1 segment(s) & make call for ZCL seg.
"RTN","ORWDBA3",95,0)
 ;
"RTN","ORWDBA3",96,0)
 ;  Input
"RTN","ORWDBA3",97,0)
 ;    ORDFN      Internal Order ID#
"RTN","ORWDBA3",98,0)
 ;    COUNTER    Variable used as counter from calling routine
"RTN","ORWDBA3",99,0)
 ;    CTVALUE    Value of COUNTER when DG1 called
"RTN","ORWDBA3",100,0)
 ;  Output
"RTN","ORWDBA3",101,0)
 ;    DG1 & ZCL HL7 segments
"RTN","ORWDBA3",102,0)
 ;
"RTN","ORWDBA3",103,0)
 I $$BASTAT^ORWDBA1=0 Q  ;BA not used
"RTN","ORWDBA3",104,0)
 N DG13,DXIEN,DXR,DXV,FROMFILE,ICD9,OCT,OREC,ORFMDAT
"RTN","ORWDBA3",105,0)
 ; zero order count variable
"RTN","ORWDBA3",106,0)
 S OCT=0
"RTN","ORWDBA3",107,0)
 ; Get the date of order (for CSV/CTD usage)
"RTN","ORWDBA3",108,0)
 S ORFMDAT=$$ORFMDAT(ORDFN)
"RTN","ORWDBA3",109,0)
 ; Get the diagnoses for an order
"RTN","ORWDBA3",110,0)
 F  S OCT=$O(^OR(100,ORDFN,5.1,OCT)) Q:OCT'?1N.N  D
"RTN","ORWDBA3",111,0)
 . S OREC=^OR(100,ORDFN,5.1,OCT,0)
"RTN","ORWDBA3",112,0)
 . S DXIEN=$P(OREC,U)  ; DXIEN=pointer to diagnosis (ICD9) file #80
"RTN","ORWDBA3",113,0)
 . ; the DXIEN pointer should point to a valid diagnosis (after all is
"RTN","ORWDBA3",114,0)
 . ;   was previously entered .. but just in case ...)
"RTN","ORWDBA3",115,0)
 . S (DXV,ICD9)=""
"RTN","ORWDBA3",116,0)
 . I DXIEN'="" D
"RTN","ORWDBA3",117,0)
 .. S DXR=$$ICDDX^ICDCODE(DXIEN,ORFMDAT) Q:+DXR=-1
"RTN","ORWDBA3",118,0)
 .. ; Get diagnosis verbiage and ICD code
"RTN","ORWDBA3",119,0)
 .. S DXV=$P(DXR,U,4),ICD9=$P(DXR,U,2)
"RTN","ORWDBA3",120,0)
 . S FROMFILE=80
"RTN","ORWDBA3",121,0)
 . S DG13=DXIEN_U_DXV_U_FROMFILE_U_ICD9_U_DXV_U_"ICD9"
"RTN","ORWDBA3",122,0)
 . S CTVALUE=CTVALUE+1
"RTN","ORWDBA3",123,0)
 . S ORMSG(CTVALUE)="DG1"_"|"_OCT_"||"_DG13_"|||||||||||||"
"RTN","ORWDBA3",124,0)
 . D ZCL
"RTN","ORWDBA3",125,0)
 S @COUNTER=CTVALUE
"RTN","ORWDBA3",126,0)
 Q
"RTN","ORWDBA3",127,0)
 ;
"RTN","ORWDBA3",128,0)
ZCL ;create all the ZCL segments (currently 7 TxF's) for order number OCT
"RTN","ORWDBA3",129,0)
 ;
"RTN","ORWDBA3",130,0)
 N I,J,TABLE,TF,TFGBL,TFGUI,TFTBL,TFIN,TFS,VALUE
"RTN","ORWDBA3",131,0)
 D TFSTGS^ORWDBA1  ;set string sequence of treatment factors
"RTN","ORWDBA3",132,0)
 ; TFS is TxF data in ^OR(100,ORIEN,5.2) order
"RTN","ORWDBA3",133,0)
 S TFS=$G(^OR(100,ORDFN,5.2)),TABLE=""
"RTN","ORWDBA3",134,0)
 ; conversion order from ^OR stored data and Table SD008 for HL7 msg
"RTN","ORWDBA3",135,0)
 ; convert so that the ZCL segments will be in Table SD008 order (1-7)
"RTN","ORWDBA3",136,0)
 F I=1:1:7 S TF=$P(TFTBL,U,I) F J=1:1:7 I $P(TFGBL,U,J)=TF S TABLE=TABLE_J Q
"RTN","ORWDBA3",137,0)
 F TFIN=1:1:7 D
"RTN","ORWDBA3",138,0)
 . ; ORMSG counter incremented
"RTN","ORWDBA3",139,0)
 . S CTVALUE=CTVALUE+1
"RTN","ORWDBA3",140,0)
 . ; TF VALUE=0 for no or 1 for yes (only if not req. is it null)
"RTN","ORWDBA3",141,0)
 . S VALUE=$P(TFS,U,$E(TABLE,TFIN))
"RTN","ORWDBA3",142,0)
 . I VALUE="?" S VALUE=0  ;temp fix if sending '?' to ancillary???
"RTN","ORWDBA3",143,0)
 . ; for Table SD008: OCT=Set ID, SCIN=O/P Classif. Type, VALUE=Value
"RTN","ORWDBA3",144,0)
 . S ORMSG(CTVALUE)="ZCL|"_OCT_"|"_TFIN_"|"_VALUE
"RTN","ORWDBA3",145,0)
 Q
"RTN","ORWDBA3",146,0)
 ;
"RTN","ORWDBA3",147,0)
BDOSTR ;Store backdoor order DG1 and ZCL messages from HL7
"RTN","ORWDBA3",148,0)
 ;Processes one order per entry into BDOSTR, e.g., ROUT(1)
"RTN","ORWDBA3",149,0)
 ;Depends upon ORM* routines to set-up a number of variables including
"RTN","ORWDBA3",150,0)
 ;  ORMSG array and ORIFN.
"RTN","ORWDBA3",151,0)
 ;ORM* routines calling BDOSTR: ORMGMRC, ORMLR, ORMPS, & ORMRA
"RTN","ORWDBA3",152,0)
 ;
"RTN","ORWDBA3",153,0)
 ; Input:   HL7 messages and related data
"RTN","ORWDBA3",154,0)
 ; Output:  ROUT array in Delphi GUI format, i.e.
"RTN","ORWDBA3",155,0)
 ;          OrderIEN;11CNNNCNN^exDx1^exDx2^exDx3^exDx4
"RTN","ORWDBA3",156,0)
 ;
"RTN","ORWDBA3",157,0)
 ; Variables Used
"RTN","ORWDBA3",158,0)
 ;  DG1      = sequential numbered array with a value of DXIEN
"RTN","ORWDBA3",159,0)
 ;  I,J      = counters
"RTN","ORWDBA3",160,0)
 ;  GUITF    = GUI order treatment factors (TxF)
"RTN","ORWDBA3",161,0)
 ;  NDX      = number of diagnoses being passed
"RTN","ORWDBA3",162,0)
 ;  NTF      = number of TxF
"RTN","ORWDBA3",163,0)
 ;  OBX      = @ORMSG Dx array element # (max of 4 diagnoses stored)
"RTN","ORWDBA3",164,0)
 ;  REC      = set to sequential HL7 messages, contains HL7 message data
"RTN","ORWDBA3",165,0)
 ;  ROUT     = record sent for storage processing to RCVORCI
"RTN","ORWDBA3",166,0)
 ;  TF       = individual TxF values
"RTN","ORWDBA3",167,0)
 ;  TFGBL    = TxF acronyms in ^ delimited string in ^OR sequence
"RTN","ORWDBA3",168,0)
 ;  TFGUI    = TxF acronyms in ^ delimited string in from GUI sequence
"RTN","ORWDBA3",169,0)
 ;  TFTBL    = TxF acronyms in ^ delimited string in Table SD008 sequence
"RTN","ORWDBA3",170,0)
 ;  VAL      = individual TxF values
"RTN","ORWDBA3",171,0)
 ;  ZCL      = TxF in Table SD008 format and sequence
"RTN","ORWDBA3",172,0)
 ;
"RTN","ORWDBA3",173,0)
 ; See if CIDC master switch set, if not then no DG1/ZCL seg, to store
"RTN","ORWDBA3",174,0)
 I $$BASTAT^ORWDBA1=0 Q  ;CIDC (nee BA) not used
"RTN","ORWDBA3",175,0)
 ;
"RTN","ORWDBA3",176,0)
 N CPNODE,CT,DG1,I,J,GUITF,NDX,NTF,OBX,REC,ROUT,ORSDCARY,SDCARYA
"RTN","ORWDBA3",177,0)
 N TF,TFGBL,TFGUI,TFTBL,VAL,X,ZCL
"RTN","ORWDBA3",178,0)
 ;
"RTN","ORWDBA3",179,0)
 K ORSDCARY,SDCARYA
"RTN","ORWDBA3",180,0)
 D TFSTGS^ORWDBA1  ;set string sequence of treatment factors
"RTN","ORWDBA3",181,0)
 S (CT,NDX,OBX)=0,NTF=7,(CPNODE,GUITF,TF,Y,ZCL)="",X="T"
"RTN","ORWDBA3",182,0)
 ; Call API to acquire Treatment Factors in force
"RTN","ORWDBA3",183,0)
 D NOW^%DTC,CL^SDCO21(DFN,%,"",.ORSDCARY)  ;DBIA 406
"RTN","ORWDBA3",184,0)
 ; Retrved array order: AO,IR,SC,EC,MST,HNC,CV, e.g., ORSDCARY(3) for SC
"RTN","ORWDBA3",185,0)
 ; Convert to character array, e.g., SDCARYA("SC")=""
"RTN","ORWDBA3",186,0)
 F I=1:1:NTF S:$D(ORSDCARY(I)) SDCARYA($P("AO^IR^SC^EC^MST^HNC^CV",U,I))=""
"RTN","ORWDBA3",187,0)
 ; Process only four DG1 segments and first set of ZCL segments
"RTN","ORWDBA3",188,0)
 F  S OBX=$O(@ORMSG@(OBX)) Q:OBX'>0  S J=$E(@ORMSG@(OBX),1,3) I J="DG1"!(J="ZCL"&($P(@ORMSG@(OBX),"|",2)=1)) D
"RTN","ORWDBA3",189,0)
 . S REC=@ORMSG@(OBX)
"RTN","ORWDBA3",190,0)
 . ; Setting DG1(#)=DXIEN where # is Dx sequence # (1=primary)
"RTN","ORWDBA3",191,0)
 . I J="DG1"&(NDX<4) S DG1($P(REC,"|",2))=$P(REC,U,4),NDX=NDX+1 Q
"RTN","ORWDBA3",192,0)
 . ; Create ZCL string of TxFs, e.g., 1101011
"RTN","ORWDBA3",193,0)
 . I J="ZCL" D
"RTN","ORWDBA3",194,0)
 .. S:$P(REC,"|",4)="" $P(REC,"|",4)=" "
"RTN","ORWDBA3",195,0)
 .. S $E(ZCL,$P(REC,"|",3))=$P(REC,"|",4)
"RTN","ORWDBA3",196,0)
 ; convert order and format from Table SD008 to GUI
"RTN","ORWDBA3",197,0)
 F I=1:1:NTF S TF=$P(TFGUI,U,I) F J=1:1:NTF I $P(TFTBL,U,J)=TF D
"RTN","ORWDBA3",198,0)
 . ; If patient does not have that Tx Factor (TF) then ghost in GUI ("N")
"RTN","ORWDBA3",199,0)
 . I '$D(SDCARYA(TF)) S GUITF=GUITF_"N" Q
"RTN","ORWDBA3",200,0)
 . ; If patient has TF then format for GUI (C=ck'd, U=unck'd, ?=not ans)
"RTN","ORWDBA3",201,0)
 . S VAL=$E(ZCL,J),GUITF=GUITF_$S(VAL=1:"C",VAL=0:"U",1:"?")
"RTN","ORWDBA3",202,0)
 ; Create output string in a format that can be stored by RCVORCI^ORWDBA1
"RTN","ORWDBA3",203,0)
 S ROUT(1)=ORIFN_";11"_GUITF_U_$G(DG1(1))_U_$G(DG1(2))_U_$G(DG1(3))_U_$G(DG1(4))
"RTN","ORWDBA3",204,0)
 ; Store diagnoses and treatment factors
"RTN","ORWDBA3",205,0)
 D RCVORCI^ORWDBA1(Y,.ROUT)
"RTN","ORWDBA3",206,0)
 Q
"RTN","ORWDBA3",207,0)
 ;
"RTN","ORWDBA3",208,0)
ERRMSG(VISIT) ; Error handling and message
"RTN","ORWDBA3",209,0)
 ; to be determined
"RTN","ORWDBA3",210,0)
 Q
"RTN","ORWDBA4")
0^29^B9537496
"RTN","ORWDBA4",1,0)
ORWDBA4 ; SLC/GU Billing Awareness - Phase II [11/26/04 15:44]
"RTN","ORWDBA4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORWDBA4",3,0)
 ;
"RTN","ORWDBA4",4,0)
 ;Miscellaneous CIDC functions utility.
"RTN","ORWDBA4",5,0)
 ;
"RTN","ORWDBA4",6,0)
 ;External References used by this routine
"RTN","ORWDBA4",7,0)
 ;  $$GETS^DIQ            DBIA 2056
"RTN","ORWDBA4",8,0)
 ;  GETS^DIQ              DBIA 2056
"RTN","ORWDBA4",9,0)
 ;  $$ICDDX^ICDCODE       DBIA 3990
"RTN","ORWDBA4",10,0)
 ;  $$TFGBLGUI^ORWDBA1    DBIA none listed
"RTN","ORWDBA4",11,0)
 ;  $$SETDXD^ORWDBA2      DBIA none listed
"RTN","ORWDBA4",12,0)
 ;  $$NOW^XLFDT           DBIA 10103
"RTN","ORWDBA4",13,0)
 ;  $$GET^XPAR            DBIA 2263
"RTN","ORWDBA4",14,0)
 ;
"RTN","ORWDBA4",15,0)
GETTFCI(Y,ORIEN) ;Get Treatment Factors Clinical Indicators
"RTN","ORWDBA4",16,0)
 ;Input Variable:
"RTN","ORWDBA4",17,0)
 ;  ORIEN    Order Internal Entry Number (array variable)
"RTN","ORWDBA4",18,0)
 ;Ouput Variable:
"RTN","ORWDBA4",19,0)
 ;  Y        Y(AI)=Order_IEN^Treatment_Factors^ICD9^ICD9_Description
"RTN","ORWDBA4",20,0)
 ;           There can be up to 4 ICD9 codes and thier descriptions
"RTN","ORWDBA4",21,0)
 ;           ICD901^DESC01^ICD902^DESC02^ICD903^DESC03^ICD904^DESC04
"RTN","ORWDBA4",22,0)
 ;Local Variables:
"RTN","ORWDBA4",23,0)
 ;  AI       Array Index
"RTN","ORWDBA4",24,0)
 ;  CI       Clinical Index
"RTN","ORWDBA4",25,0)
 ;  TF       Treatment Factors
"RTN","ORWDBA4",26,0)
 ;  TFCI     Treatment Factors Clinical Indicators
"RTN","ORWDBA4",27,0)
 N AI,CI,CNT,DXS,TF,TFCI
"RTN","ORWDBA4",28,0)
 S U="^",(CNT,TF)=""
"RTN","ORWDBA4",29,0)
 F  S CNT=$O(ORIEN(CNT)) Q:CNT=""  D
"RTN","ORWDBA4",30,0)
 . S TF=$$GTF(ORIEN(CNT))
"RTN","ORWDBA4",31,0)
 . S DXS=$$GDCD(ORIEN(CNT))
"RTN","ORWDBA4",32,0)
 . I TF="NNNNNNN"&(DXS="") Q
"RTN","ORWDBA4",33,0)
 . S TFCI(CNT)=ORIEN(CNT)_U_TF_$S(DXS="":"",1:U_DXS)
"RTN","ORWDBA4",34,0)
 M Y=TFCI
"RTN","ORWDBA4",35,0)
 Q
"RTN","ORWDBA4",36,0)
 ;
"RTN","ORWDBA4",37,0)
GTF(IEN) ;Get Treatment Factors
"RTN","ORWDBA4",38,0)
 ;Gets the Treatment Factors for the current order converted to the
"RTN","ORWDBA4",39,0)
 ;format used by the CPRS GUI display.
"RTN","ORWDBA4",40,0)
 ;
"RTN","ORWDBA4",41,0)
 ;Input Variable:
"RTN","ORWDBA4",42,0)
 ;  IEN     Internal Entry Number
"RTN","ORWDBA4",43,0)
 ;Local Variables:
"RTN","ORWDBA4",44,0)
 ;  ORTF    Order Record Treatment Factors
"RTN","ORWDBA4",45,0)
 ;  OREM    Order Record Error Message
"RTN","ORWDBA4",46,0)
 ;  OTF     Order Treatment Factors
"RTN","ORWDBA4",47,0)
 ;          (Converted to GUI values and returned)
"RTN","ORWDBA4",48,0)
 N ORTF,OREM,OTF
"RTN","ORWDBA4",49,0)
 S OTF=""
"RTN","ORWDBA4",50,0)
 D GETS^DIQ(100,IEN,"90;91;92;93;94;95;96","I","ORTF","OREM")
"RTN","ORWDBA4",51,0)
 S OTF=$G(ORTF(100,IEN_",",90,"I"))
"RTN","ORWDBA4",52,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",91,"I"))
"RTN","ORWDBA4",53,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",92,"I"))
"RTN","ORWDBA4",54,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",93,"I"))
"RTN","ORWDBA4",55,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",94,"I"))
"RTN","ORWDBA4",56,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",95,"I"))
"RTN","ORWDBA4",57,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",96,"I"))
"RTN","ORWDBA4",58,0)
 S OTF=$$TFGBLGUI^ORWDBA1(OTF)
"RTN","ORWDBA4",59,0)
 I OTF'="NNNNNNN" Q OTF
"RTN","ORWDBA4",60,0)
 S OTF=""
"RTN","ORWDBA4",61,0)
 K ORTF,OREM
"RTN","ORWDBA4",62,0)
 D GETS^DIQ(100,IEN,"51;52;53;54;55;56;57","I","ORTF","OREM")
"RTN","ORWDBA4",63,0)
 S OTF=$G(ORTF(100,IEN_",",51,"I"))
"RTN","ORWDBA4",64,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",52,"I"))
"RTN","ORWDBA4",65,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",53,"I"))
"RTN","ORWDBA4",66,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",54,"I"))
"RTN","ORWDBA4",67,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",55,"I"))
"RTN","ORWDBA4",68,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",56,"I"))
"RTN","ORWDBA4",69,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",57,"I"))
"RTN","ORWDBA4",70,0)
 S OTF=$$TFGBLGUI^ORWDBA1(OTF)
"RTN","ORWDBA4",71,0)
 Q OTF
"RTN","ORWDBA4",72,0)
 ;
"RTN","ORWDBA4",73,0)
GDCD(IEN) ;Get Diagnoses Codes / Description
"RTN","ORWDBA4",74,0)
 ;Builds and returns a text string delimited by the "^". The text string
"RTN","ORWDBA4",75,0)
 ;made from the ICD9 codes associated with the current order and thier
"RTN","ORWDBA4",76,0)
 ;descriptions pulled from the ICD DIAGNOSIS file #80. The string can
"RTN","ORWDBA4",77,0)
 ;contain up to four diagnoses codes and thier descriptions. The string
"RTN","ORWDBA4",78,0)
 ;with all four possiable diagnoses codes is formatted:
"RTN","ORWDBA4",79,0)
 ;ICD901^DESC01^ICD902^DESC02^ICD903^DESC03^ICD904^DESC04
"RTN","ORWDBA4",80,0)
 ;
"RTN","ORWDBA4",81,0)
 ;Input Variable:
"RTN","ORWDBA4",82,0)
 ;  IEN
"RTN","ORWDBA4",83,0)
 ;Local Variables:
"RTN","ORWDBA4",84,0)
 ;  DCD      Diagnosis Code Description (retrun variable)
"RTN","ORWDBA4",85,0)
 ;  DXDT     Diagnosis Date (either Order date or system date)
"RTN","ORWDBA4",86,0)
 ;  DXD      Diagnosis Description
"RTN","ORWDBA4",87,0)
 ;  DXIEN    Diagnosis Internal Entry Number
"RTN","ORWDBA4",88,0)
 ;  ICD9     ICD9 code (for GUI display)
"RTN","ORWDBA4",89,0)
 ;  IENS     Internale Entry Number Sequence
"RTN","ORWDBA4",90,0)
 ;           (Array index variable for data returned from lookup)
"RTN","ORWDBA4",91,0)
 ;  ORRF     Order Record Found (returned data from lookup)
"RTN","ORWDBA4",92,0)
 ;  OREM     Order Record Error Message
"RTN","ORWDBA4",93,0)
 N DCD,DXDT,DXD,DXIEN,ICD9,IENS,ORRF,OREM
"RTN","ORWDBA4",94,0)
 S DCD=""
"RTN","ORWDBA4",95,0)
 D GETS^DIQ(100,IEN,".8*;5.1*","I","ORRF","OREM")
"RTN","ORWDBA4",96,0)
 I $D(ORRF) D
"RTN","ORWDBA4",97,0)
 . S DXDT=""
"RTN","ORWDBA4",98,0)
 . I $D(ORRF(100.008)) S DXDT=$G(ORRF(100.008,"1,"_IEN_",",.01,"I"))
"RTN","ORWDBA4",99,0)
 . I DXDT="" S DXDT=$$NOW^XLFDT
"RTN","ORWDBA4",100,0)
 . I $D(ORRF(100.051)) D
"RTN","ORWDBA4",101,0)
 .. S IENS="" F  S IENS=$O(ORRF(100.051,IENS)) Q:IENS=""  D
"RTN","ORWDBA4",102,0)
 ... I ORRF(100.051,IENS,.01,"I")="" S DCD=DCD_U Q
"RTN","ORWDBA4",103,0)
 ... S DXIEN=ORRF(100.051,IENS,.01,"I")
"RTN","ORWDBA4",104,0)
 ... S ICD9=$$GET1^DIQ(80,DXIEN,.01,"")
"RTN","ORWDBA4",105,0)
 ... S DXD=$$SETDXD^ORWDBA2($P($$ICDDX^ICDCODE(ICD9,DT),U,4))
"RTN","ORWDBA4",106,0)
 ... S DCD=$S(DCD="":ICD9_U_DXD,1:DCD_U_ICD9_U_DXD)
"RTN","ORWDBA4",107,0)
 Q DCD
"RTN","ORWDBA4",108,0)
 ;
"RTN","ORWDBA4",109,0)
GETBAUSR(Y,ORCIEN) ;GUI RPC CALL
"RTN","ORWDBA4",110,0)
 ;Get Billing Awareness By User parameter value
"RTN","ORWDBA4",111,0)
 ;Gets and returns the value of the Enabled Billing Awareness By User 
"RTN","ORWDBA4",112,0)
 ;parameter assigned to a provider.
"RTN","ORWDBA4",113,0)
 ;Input Variable:
"RTN","ORWDBA4",114,0)
 ;  ORCIEN    Ordering Clinician's Internal Entry Number
"RTN","ORWDBA4",115,0)
 ;Output Variable:
"RTN","ORWDBA4",116,0)
 ;  Y         Parameter value, 1 if enabled, 0 if disabled
"RTN","ORWDBA4",117,0)
 S Y=$$GET^XPAR(ORCIEN_";VA(200,","OR BILLING AWARENESS BY USER",1,"Q")
"RTN","ORWDBA4",118,0)
 Q
"RTN","ORWDBA5")
0^28^B18240259
"RTN","ORWDBA5",1,0)
ORWDBA5 ; SLC/GSS Billing Awareness ;12/9/04  12:02
"RTN","ORWDBA5",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORWDBA5",3,0)
 ;
"RTN","ORWDBA5",4,0)
 ; ORWDBA5 contains code for the testing, enabling and disabling the
"RTN","ORWDBA5",5,0)
 ; Billing Awareness Master Switch which is tested by the GUI in order
"RTN","ORWDBA5",6,0)
 ; to know what to present to the user.  Note also the BA by User
"RTN","ORWDBA5",7,0)
 ; switch which is coded in ORWDBA6, ORWDBA8, and ORWDBA10. 
"RTN","ORWDBA5",8,0)
 ;
"RTN","ORWDBA5",9,0)
BAMSTR ;Billing Awareness Master Switch via Parameter Setting
"RTN","ORWDBA5",10,0)
 N DIR,ENT,ORERR,INST,OPT,PAR
"RTN","ORWDBA5",11,0)
 D VARSET
"RTN","ORWDBA5",12,0)
 I $G(PAR)="" D  Q
"RTN","ORWDBA5",13,0)
 . S ORERR="99;Clinical Indicator Data Capture Master Switch parameter not defined"
"RTN","ORWDBA5",14,0)
 . D ORERR
"RTN","ORWDBA5",15,0)
 D OPT
"RTN","ORWDBA5",16,0)
 Q
"RTN","ORWDBA5",17,0)
 ;
"RTN","ORWDBA5",18,0)
VARSET ;Set variables - used by tags BAMSTR and CHKPS1
"RTN","ORWDBA5",19,0)
 ; ENT=Entity, INST=Instance, PAR=Parameter
"RTN","ORWDBA5",20,0)
 S ENT="SYS",INST=1
"RTN","ORWDBA5",21,0)
 S PAR=$O(^XTV(8989.51,"B","OR BILLING AWARENESS STATUS",0))
"RTN","ORWDBA5",22,0)
 Q
"RTN","ORWDBA5",23,0)
 ;
"RTN","ORWDBA5",24,0)
OPT ;Functionality control
"RTN","ORWDBA5",25,0)
 D HDR
"RTN","ORWDBA5",26,0)
 I OPT="D" D DISABLE G OPT
"RTN","ORWDBA5",27,0)
 I OPT="E" D ENABLE G OPT
"RTN","ORWDBA5",28,0)
 Q
"RTN","ORWDBA5",29,0)
 ;
"RTN","ORWDBA5",30,0)
ORERR ;Error trap message - pass error in via ORERR w/ 2nd piece being ER text
"RTN","ORWDBA5",31,0)
 S DIR(0)="F"
"RTN","ORWDBA5",32,0)
 S DIR("A")="Enter '^' to exit"
"RTN","ORWDBA5",33,0)
 S DIR("A",1)="ERROR:",DIR("A",2)=$P(ORERR,U,2)
"RTN","ORWDBA5",34,0)
 D ^DIR K DIR
"RTN","ORWDBA5",35,0)
 Q
"RTN","ORWDBA5",36,0)
 ;
"RTN","ORWDBA5",37,0)
ENABLE ;Enable Billing Awareness Master Switch
"RTN","ORWDBA5",38,0)
 N DIR,Y
"RTN","ORWDBA5",39,0)
 ; Check and see if CIDC ancillary package installed
"RTN","ORWDBA5",40,0)
 S Y=$D(^XPD(9.7,"B","PX CLINICAL INDICATOR DATA CAPTURE 1.0"))
"RTN","ORWDBA5",41,0)
 I 'Y S ORERR="^The package 'PX CLINICAL INDICATOR DATA CAPTURE 1.0' must first be installed" D ORERR Q
"RTN","ORWDBA5",42,0)
 W !!,"You have selected to ENABLE Clinical Indicators Data Capture Functionality!",!
"RTN","ORWDBA5",43,0)
 S DIR(0)="Y"
"RTN","ORWDBA5",44,0)
 S DIR("A")="Are you sure you want to ENABLE Clinical Indicators Data Capture Functionality"
"RTN","ORWDBA5",45,0)
 S DIR("B")="N"
"RTN","ORWDBA5",46,0)
 S DIR("?")="To exit ENABLE enter '^'."
"RTN","ORWDBA5",47,0)
 S DIR("?",1)="To confirm ENABLING Clinical Indicators Data Capture Functionality enter 'Y' for Yes."
"RTN","ORWDBA5",48,0)
 S DIR("?",2)="To abort ENABLING enter 'N' for NO."
"RTN","ORWDBA5",49,0)
 D ^DIR K DIR
"RTN","ORWDBA5",50,0)
 I Y=0 K OPT Q
"RTN","ORWDBA5",51,0)
 D CHG^XPAR(ENT,PAR,INST,1,.ORERR)
"RTN","ORWDBA5",52,0)
 I $G(ORERR) D ORERR Q
"RTN","ORWDBA5",53,0)
 Q
"RTN","ORWDBA5",54,0)
 ;
"RTN","ORWDBA5",55,0)
DISABLE ;Disable Billing Awareness Functionality
"RTN","ORWDBA5",56,0)
 N DIR
"RTN","ORWDBA5",57,0)
 W !!,"You have selected to DISABLE Clinical Indicators Data Capture Functionality!",!
"RTN","ORWDBA5",58,0)
 S DIR(0)="Y"
"RTN","ORWDBA5",59,0)
 S DIR("A")="Are you sure you want to DISABLE Clinical Indicators Data Capture Functionality"
"RTN","ORWDBA5",60,0)
 S DIR("B")="N"
"RTN","ORWDBA5",61,0)
 S DIR("?")="To exit DISABLE enter '^'."
"RTN","ORWDBA5",62,0)
 S DIR("?",1)="To confirm DISABLING Clinical Indicators Data Capture Functionality enter 'Y' for Yes."
"RTN","ORWDBA5",63,0)
 S DIR("?",2)="To abort DISABLING enter 'N' for NO."
"RTN","ORWDBA5",64,0)
 D ^DIR K DIR
"RTN","ORWDBA5",65,0)
 I Y=0 K OPT Q
"RTN","ORWDBA5",66,0)
 D CHG^XPAR(ENT,PAR,INST,0,.ORERR)
"RTN","ORWDBA5",67,0)
 I $G(ORERR) D ORERR Q
"RTN","ORWDBA5",68,0)
 Q
"RTN","ORWDBA5",69,0)
 ;
"RTN","ORWDBA5",70,0)
HDR ;Screen Header, Switch Status, and Options
"RTN","ORWDBA5",71,0)
 N DIR
"RTN","ORWDBA5",72,0)
 D:'$D(IO)!('$D(IOF)) HOME^%ZIS
"RTN","ORWDBA5",73,0)
 W @IOF,"Enable/Disable Clinical Indicators Data Capture Master Switch"
"RTN","ORWDBA5",74,0)
 W !!,"Clinical Indicators Data Capture Master Switch is now *> ",$S($$CHKPS=0:"OFF",1:"ON")," <*"
"RTN","ORWDBA5",75,0)
 S DIR("?")="Enter Q to Quit"
"RTN","ORWDBA5",76,0)
 I $$CHKPS D
"RTN","ORWDBA5",77,0)
 . S DIR(0)="SX^D:Disable Clinical Indicators Data Capture Functionality;Q:Quit"
"RTN","ORWDBA5",78,0)
 . S DIR("?",1)="Enter D to disable capture of Clinical Indicators"
"RTN","ORWDBA5",79,0)
 E  D
"RTN","ORWDBA5",80,0)
 . S DIR(0)="SX^E:Enable Clinical Indicators Capture Functionality;Q:Quit"
"RTN","ORWDBA5",81,0)
 . S DIR("?",2)="Enter E to enable the capture of Clinical Indicator data"
"RTN","ORWDBA5",82,0)
 S DIR("A")="Selection"
"RTN","ORWDBA5",83,0)
 D ^DIR K DIR S OPT=Y
"RTN","ORWDBA5",84,0)
 Q
"RTN","ORWDBA5",85,0)
 ;
"RTN","ORWDBA5",86,0)
CHKPS() ;Check master switch parameter status
"RTN","ORWDBA5",87,0)
 ; Returns 0 if switch is OFF or 1 if ON 
"RTN","ORWDBA5",88,0)
 ; If master switch not previously defined then defines it as 0
"RTN","ORWDBA5",89,0)
 ; For use via List Mgr (thus error messages)
"RTN","ORWDBA5",90,0)
 N ORERR,VAL
"RTN","ORWDBA5",91,0)
 I $G(PAR)="" D  Q
"RTN","ORWDBA5",92,0)
 . S ORERR="99;Clinical Indicator Data Capture Master Switch parameter not defined"
"RTN","ORWDBA5",93,0)
 . D ORERR
"RTN","ORWDBA5",94,0)
 S VAL=$$GET^XPAR(ENT,PAR,INST)
"RTN","ORWDBA5",95,0)
 I VAL="" D ADD^XPAR(ENT,PAR,INST,0) S VAL=$$GET^XPAR(ENT,PAR,INST,.ORERR)
"RTN","ORWDBA5",96,0)
 I $G(ORERR) D ORERR Q ""
"RTN","ORWDBA5",97,0)
 Q VAL
"RTN","ORWDBA5",98,0)
 ;
"RTN","ORWDBA5",99,0)
CHKPS1() ;Check master switch parameter status
"RTN","ORWDBA5",100,0)
 ; Used by RPC and BA status check in ORWDBA1 (BASTATUS & BASTAT)
"RTN","ORWDBA5",101,0)
 N ENT,ORERR,INST,PAR,VAL
"RTN","ORWDBA5",102,0)
 D VARSET
"RTN","ORWDBA5",103,0)
 ; Return BA Master Switch is off if parameter is not defined/set-up
"RTN","ORWDBA5",104,0)
 I $G(PAR)="" Q 0
"RTN","ORWDBA5",105,0)
 S VAL=$$GET^XPAR(ENT,PAR,INST)
"RTN","ORWDBA5",106,0)
 I VAL="" D ADD^XPAR(ENT,PAR,INST,0) S VAL=$$GET^XPAR(ENT,PAR,INST,.ORERR)
"RTN","ORWDBA5",107,0)
 ; If there's an error then return BA Master Switch is off
"RTN","ORWDBA5",108,0)
 I $G(ORERR) Q 0
"RTN","ORWDBA5",109,0)
 Q VAL
"RTN","ORWDBA6")
0^27^B12217678
"RTN","ORWDBA6",1,0)
ORWDBA6 ; SLC/GDU - Clinical Indicator Data Capture - Phase I [10/12/04 15:40]
"RTN","ORWDBA6",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17,1997
"RTN","ORWDBA6",3,0)
MAIN ;Main starting point for this program
"RTN","ORWDBA6",4,0)
 N DIR,DTOUT,DUOUT,OPT,Y
"RTN","ORWDBA6",5,0)
 D CHKINS
"RTN","ORWDBA6",6,0)
 S DIR(0)="SO^"_$P($T(B0A),";",3)_";"
"RTN","ORWDBA6",7,0)
 S DIR(0)=DIR(0)_$P($T(B0E),";",3)_";"
"RTN","ORWDBA6",8,0)
 S DIR(0)=DIR(0)_$P($T(B0D),";",3)_";"
"RTN","ORWDBA6",9,0)
 S DIR(0)=DIR(0)_$P($T(B0L),";",3)_";"
"RTN","ORWDBA6",10,0)
 S DIR("?",1)=$P($T(BHA),";",3)
"RTN","ORWDBA6",11,0)
 S DIR("?",2)=$P($T(BHE),";",3)
"RTN","ORWDBA6",12,0)
 S DIR("?",3)=$P($T(BHD),";",3)
"RTN","ORWDBA6",13,0)
 S DIR("?",4)=$P($T(BHL),";",3)
"RTN","ORWDBA6",14,0)
 S DIR("?",5)=$P($T(BH1),";",3)
"RTN","ORWDBA6",15,0)
 S DIR("?")=$P($T(BH2),";",3)
"RTN","ORWDBA6",16,0)
 S DIR("A")=$P($T(BA),";",3)
"RTN","ORWDBA6",17,0)
 W:$D(IOF) @IOF
"RTN","ORWDBA6",18,0)
 W !,$P($T(SH),";",3),!,$P($T(SH0),";",3)
"RTN","ORWDBA6",19,0)
 D ^DIR K DIR
"RTN","ORWDBA6",20,0)
 I Y="M" D ^ORWDBA8 G MAIN
"RTN","ORWDBA6",21,0)
 I Y="E" D EN^ORWDBA10("E") G MAIN
"RTN","ORWDBA6",22,0)
 I Y="D" D EN^ORWDBA10("D") G MAIN
"RTN","ORWDBA6",23,0)
 I Y="L" D ^ORWDBA14 G MAIN
"RTN","ORWDBA6",24,0)
 Q
"RTN","ORWDBA6",25,0)
 ;Text for MAIN user interface
"RTN","ORWDBA6",26,0)
SH ;;Enable Clinical Indicator Data Capture By Provider Parameter Management
"RTN","ORWDBA6",27,0)
SH0 ;;Select Parameter Management Option
"RTN","ORWDBA6",28,0)
B0A ;;M:Manage parameter by provider
"RTN","ORWDBA6",29,0)
B0E ;;E:Assign parameter and Enable for all providers
"RTN","ORWDBA6",30,0)
B0D ;;D:Assign parameter and Disable for all providers
"RTN","ORWDBA6",31,0)
B0L ;;L:List providers with the assigned parameter
"RTN","ORWDBA6",32,0)
BA ;;Select Enable CIDC By Provider parameter option
"RTN","ORWDBA6",33,0)
BHA ;;Enter M to manage the Enable CIDC By Provider parameter by provider.
"RTN","ORWDBA6",34,0)
BHE ;;Enter E to assign the parameter and enable it for all providers
"RTN","ORWDBA6",35,0)
BHD ;;Enter D to assign the parameter and disable it for all providers
"RTN","ORWDBA6",36,0)
BHL ;;Enter L to get a list of providers with the parameter and its value.
"RTN","ORWDBA6",37,0)
BH1 ;;  ** Options E and D will not impact providers with the parameter already
"RTN","ORWDBA6",38,0)
BH2 ;;     assigned and the functionality enabled / disabled.
"RTN","ORWDBA6",39,0)
 ;
"RTN","ORWDBA6",40,0)
CHKINS ;Check Install
"RTN","ORWDBA6",41,0)
 N DIR,DTOUT,DUOUT,ERR,MSG,RF,X,X1,Y
"RTN","ORWDBA6",42,0)
 S MSG(0)=0
"RTN","ORWDBA6",43,0)
 D FIND^DIC(9.7,"","","","PX CLINICAL INDICATOR DATA CAPTURE 1.0","*","","","","RF","ERR")
"RTN","ORWDBA6",44,0)
 I $D(ERR) D
"RTN","ORWDBA6",45,0)
 . F X=1:1:$P(ERR("DIERR"),U) D
"RTN","ORWDBA6",46,0)
 .. S MSG(0)=X
"RTN","ORWDBA6",47,0)
 .. S MSG(X)=$P($T(PLF),";",3)_" "_ERR("DIERR",X)
"RTN","ORWDBA6",48,0)
 .. S X1=0 F  S X1=$O(ERR("DIERR",X,"TEXT",X1)) Q:X1=""  D
"RTN","ORWDBA6",49,0)
 ... S MSG(X,X1)=ERR("DIERR",X,"TEXT",X1)
"RTN","ORWDBA6",50,0)
 I $D(RF) D
"RTN","ORWDBA6",51,0)
 . I $P(RF("DILIST",0),U)=0 D
"RTN","ORWDBA6",52,0)
 .. S MSG(0)=MSG(0)+1
"RTN","ORWDBA6",53,0)
 .. S MSG(MSG(0))=$P($T(NRF),";",3)
"RTN","ORWDBA6",54,0)
 I $$CHKPS1^ORWDBA5=0 D
"RTN","ORWDBA6",55,0)
 . S MSG(0)=MSG(0)+1
"RTN","ORWDBA6",56,0)
 . S MSG(MSG(0))=$P($T(MSD),";",3)
"RTN","ORWDBA6",57,0)
 I MSG(0)=0 Q
"RTN","ORWDBA6",58,0)
 W:$D(IOF) @IOF
"RTN","ORWDBA6",59,0)
 W !,$P($T(SH),";",3),!,$P($T(SH0),";",3)
"RTN","ORWDBA6",60,0)
 S DIR(0)="E"
"RTN","ORWDBA6",61,0)
 W !!,$P($P($T(MH),";",3),"|"),!!,$P($P($T(MH),";",3),"|",2)
"RTN","ORWDBA6",62,0)
 F X=1:1:MSG(0) D
"RTN","ORWDBA6",63,0)
 . W !,MSG(X)
"RTN","ORWDBA6",64,0)
 . S X1=0 F  S X1=$O(MSG(X,X1)) Q:X1=""  W !,MSG(X,X1)
"RTN","ORWDBA6",65,0)
 W !!,$P($T(MF1),";",3),!,$P($T(MF2),";",3),!!
"RTN","ORWDBA6",66,0)
 D ^DIR K DIR
"RTN","ORWDBA6",67,0)
 Q
"RTN","ORWDBA6",68,0)
 ;Error message UI text
"RTN","ORWDBA6",69,0)
PLF ;;Package Lookup Failure, Error Code:
"RTN","ORWDBA6",70,0)
NRF ;;No record found in INSTALL file for PX CLINICAL INDICATOR DATA CAPTURE 1.0
"RTN","ORWDBA6",71,0)
MSD ;;CIDC Master Switch is disabled.
"RTN","ORWDBA6",72,0)
MH ;;ALERT!|Please note the following errors.
"RTN","ORWDBA6",73,0)
MF1 ;;The above error(s) will need to be resolved before the CIDC functionality will
"RTN","ORWDBA6",74,0)
MF2 ;;work. You can still assign the Enable CIDC parameter to providers.
"RTN","ORWDBA7")
0^70^B17251389
"RTN","ORWDBA7",1,0)
ORWDBA7 ;;SLC/GSS Billing Awareness (CIDC-Clinical Indicators Data Capture) ;12/9/04  12:02
"RTN","ORWDBA7",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORWDBA7",3,0)
 ;
"RTN","ORWDBA7",4,0)
BDOEDIT ; Backdoor entered orders edit in CPRS - entry point
"RTN","ORWDBA7",5,0)
 ; Data Flow> Ancillary creates a back door order which is incomplete
"RTN","ORWDBA7",6,0)
 ;            and thus edited in CPRS GUI. The ancillary needs to know
"RTN","ORWDBA7",7,0)
 ;            what Dx and TF's are edited thus this tag calls three
"RTN","ORWDBA7",8,0)
 ;            ancillary APIs, passing the Dx and TF data to them.
"RTN","ORWDBA7",9,0)
 ;
"RTN","ORWDBA7",10,0)
 ; Variable  Description
"RTN","ORWDBA7",11,0)
 ; ANCILARY  Acronym of ancillary/package relative to order
"RTN","ORWDBA7",12,0)
 ; DXN       Diagnosis sequence number in ^OR file
"RTN","ORWDBA7",13,0)
 ; MSG       Error message
"RTN","ORWDBA7",14,0)
 ; ORDX      Array of diagnoses (1-n) with value from ICD file (#80)
"RTN","ORWDBA7",15,0)
 ; ORIFN     Order internal reference number (defined in ORCSEND)
"RTN","ORWDBA7",16,0)
 ; ORITEM    Package reference or ^OR(100,ORIFN,4)
"RTN","ORWDBA7",17,0)
 ; ORSCEI    String of Treatment Factors in table SD008 order/format
"RTN","ORWDBA7",18,0)
 ; PTIEN     Patient IEN
"RTN","ORWDBA7",19,0)
 ; TAGROU    Tag^Routine of ancillary routine to store edited data
"RTN","ORWDBA7",20,0)
 ; TFO       Treatment Factors in ^OR (GBL) order
"RTN","ORWDBA7",21,0)
 ;
"RTN","ORWDBA7",22,0)
 ; If CIDC master switch set, then no back door orders to store
"RTN","ORWDBA7",23,0)
 I $$BASTAT^ORWDBA1=0 Q  ;CIDC (nee BA) not used
"RTN","ORWDBA7",24,0)
 ; If ORIFN not defined (God only knows why) then log error and quit
"RTN","ORWDBA7",25,0)
 I '$D(ORIFN) S MSG="ORIFN not defined" D VAR,EN^ORERR(MSG,"",.VAR) Q
"RTN","ORWDBA7",26,0)
 ;
"RTN","ORWDBA7",27,0)
 N ANCILARY,DXN,MSG,ORDX,ORITEM,ORSCEI,PTIEN,RT,SUCCESS,TAGROU,TFO,VAR
"RTN","ORWDBA7",28,0)
 ;
"RTN","ORWDBA7",29,0)
 S DXN=0,(RT,SUCCESS)="",PTIEN=+$P($G(^OR(100,ORIFN,0)),U,2)
"RTN","ORWDBA7",30,0)
 ; Package (ancillary) reference data
"RTN","ORWDBA7",31,0)
 S ORITEM=$G(^OR(100,ORIFN,4))
"RTN","ORWDBA7",32,0)
 ; Create an array (ORDX) of diagnoses
"RTN","ORWDBA7",33,0)
 F  S DXN=$O(^OR(100,ORIFN,5.1,DXN)) Q:'DXN  D
"RTN","ORWDBA7",34,0)
 . S ORDX(DXN)=$G(^OR(100,ORIFN,5.1,DXN,0))
"RTN","ORWDBA7",35,0)
 ; Treatment Factors - converted and reformatted
"RTN","ORWDBA7",36,0)
 S ORSCEI=$$TFGBLTBL($G(^OR(100,ORIFN,5.2)))
"RTN","ORWDBA7",37,0)
 ; Get the acronym of the package generating this order
"RTN","ORWDBA7",38,0)
 S ANCILARY=$P($G(^DIC(9.4,$P($G(^OR(100,ORIFN,0)),U,14),0)),U,2)  ;D???
"RTN","ORWDBA7",39,0)
 ; Send data to the appropriate ancillary API based on package
"RTN","ORWDBA7",40,0)
 D OUTPUT
"RTN","ORWDBA7",41,0)
 ; If ancillary routine or tag w/in the routine doesn't exist check
"RTN","ORWDBA7",42,0)
 I 'RT D
"RTN","ORWDBA7",43,0)
 . S MSG="NON-EXISTANT ROUTINE/TAG FOR "_ANCILARY
"RTN","ORWDBA7",44,0)
 . D VAR,EN^ORERR(MSG,"",.VAR)
"RTN","ORWDBA7",45,0)
 ; If we don't get back a thumbs-up from the ancillary re: the order data
"RTN","ORWDBA7",46,0)
 I 'SUCCESS,RT D
"RTN","ORWDBA7",47,0)
 . S MSG="ANCILLARY API RETURNED ERROR FOR CPRS EDITED BACK DOOR DATA"
"RTN","ORWDBA7",48,0)
 . D VAR,EN^ORERR(MSG,"",.VAR)
"RTN","ORWDBA7",49,0)
 Q
"RTN","ORWDBA7",50,0)
 ;
"RTN","ORWDBA7",51,0)
OUTPUT ; Call ancillary's API to store data after checking for it's existence
"RTN","ORWDBA7",52,0)
 ;
"RTN","ORWDBA7",53,0)
 ; Laboratory
"RTN","ORWDBA7",54,0)
 I ANCILARY?1"LR".U D  Q
"RTN","ORWDBA7",55,0)
 . S RT=$$CKROUTAG("UPDOR^LRBEBA4") Q:'RT
"RTN","ORWDBA7",56,0)
 . S SUCCESS=$$UPDOR^LRBEBA4(PTIEN,ORITEM,ORIFN,.ORDX,ORSCEI)
"RTN","ORWDBA7",57,0)
 ;
"RTN","ORWDBA7",58,0)
 ; Pharmacy
"RTN","ORWDBA7",59,0)
 I ANCILARY?1"PS".U D  Q
"RTN","ORWDBA7",60,0)
 . S RT=$$CKROUTAG("EN^PSOHLNE3") Q:'RT
"RTN","ORWDBA7",61,0)
 . S SUCCESS=$$EN^PSOHLNE3(PTIEN,ORITEM,ORIFN,.ORDX,ORSCEI)
"RTN","ORWDBA7",62,0)
 ;
"RTN","ORWDBA7",63,0)
 ; Radiolgy
"RTN","ORWDBA7",64,0)
 I ANCILARY?1"RA".U D  Q
"RTN","ORWDBA7",65,0)
 . S RT=$$CKROUTAG("CPRSUPD^RABWORD1") Q:'RT
"RTN","ORWDBA7",66,0)
 . S SUCCESS=$$CPRSUPD^RABWORD1(PTIEN,ORITEM,ORIFN,.ORDX,ORSCEI)
"RTN","ORWDBA7",67,0)
 Q
"RTN","ORWDBA7",68,0)
 ;
"RTN","ORWDBA7",69,0)
CKROUTAG(TAGROU) ;Check if valid tag and routine
"RTN","ORWDBA7",70,0)
 ; Temporary check until all the ancillaries have their API's built
"RTN","ORWDBA7",71,0)
 Q $L($T(@TAGROU))
"RTN","ORWDBA7",72,0)
 ;
"RTN","ORWDBA7",73,0)
TFGBLTBL(GBL) ;Convert Tx Factors from Global to TBL (HL7) order & format
"RTN","ORWDBA7",74,0)
 ; Note: this does not set Tx Factors in ZCL segment format but rather
"RTN","ORWDBA7",75,0)
 ;       AO^IR^SC^EC^MST^HNC^CV ('^' delimited string) format
"RTN","ORWDBA7",76,0)
 ;
"RTN","ORWDBA7",77,0)
 ; Input:  GBL in 1^1^0^0^^^0 (global) format
"RTN","ORWDBA7",78,0)
 ; Output: TBL in 0^0^1^^1^^0 (TBL) format (also reordered)
"RTN","ORWDBA7",79,0)
 ;
"RTN","ORWDBA7",80,0)
 N J,NTF,TBL,TF,TFGBL,TFGUI,TFTBL
"RTN","ORWDBA7",81,0)
 S TBL="",NTF=7  ;NCI=# of TxF
"RTN","ORWDBA7",82,0)
 ; Get Treatment Factor sequence order strings
"RTN","ORWDBA7",83,0)
 D TFSTGS^ORWDBA1
"RTN","ORWDBA7",84,0)
 ; Convert from GBL to TBL format and sequence
"RTN","ORWDBA7",85,0)
 F J=1:1:NTF S TF=$P(GBL,U,J) D
"RTN","ORWDBA7",86,0)
 . ;OK..just in case there is a '?' we'll return a null for a '?'
"RTN","ORWDBA7",87,0)
 . S TF($P(TFGBL,U,J))=$S(TF=1:1,TF=0:0,TF="?":"",1:"")
"RTN","ORWDBA7",88,0)
 F J=1:1:NTF S TBL=TBL_U_TF($P(TFTBL,U,J))
"RTN","ORWDBA7",89,0)
 ; Remove the first '^' and pass TBL formatted TF's
"RTN","ORWDBA7",90,0)
 Q $E(TBL,2,99)
"RTN","ORWDBA7",91,0)
 ;
"RTN","ORWDBA7",92,0)
VAR ;Create VAR array for tracking error in ^ORYX("ORERR",err#)
"RTN","ORWDBA7",93,0)
 S VAR("DFN")=PTIEN
"RTN","ORWDBA7",94,0)
 S VAR("ORITEM")=ORITEM
"RTN","ORWDBA7",95,0)
 S VAR("ORIFN")=ORIFN
"RTN","ORWDBA7",96,0)
 M VAR("ORDX")=ORDX
"RTN","ORWDBA7",97,0)
 S VAR("ORSCEI")=ORSCEI
"RTN","ORWDBA7",98,0)
 Q
"RTN","ORWDBA7",99,0)
 ;
"RTN","ORWDBA7",100,0)
GETIEN9(Y,ICD9) ;Return IEN for an ICD9 code (RPC: ORWDBA7 GETIEN9)
"RTN","ORWDBA7",101,0)
 S Y=$P($$CODEN^ICDCODE(ICD9,80),"~")
"RTN","ORWDBA7",102,0)
 Q
"RTN","ORWDBA7",103,0)
 ;
"RTN","ORWDBA7",104,0)
CONDTLD ;Consult Detailed Display Compile for CIDC/BA (called by GMRCSLM2)
"RTN","ORWDBA7",105,0)
 ; Input:  ORIFN and GMRCCT defined in GMRCSLM2
"RTN","ORWDBA7",106,0)
 ; Output: CIDCARY = array of CIDC display lines for GMRCSLM2 display
"RTN","ORWDBA7",107,0)
 N BGNRCCT,DXIEN,DXOF,DXV,EYE,ICD9,ICDR,LINE,OCT,ORFMDAT,TF
"RTN","ORWDBA7",108,0)
 S BGNRCCT=GMRCCT,OCT=0
"RTN","ORWDBA7",109,0)
 ; Get the date of the order for CSV/CTD usage
"RTN","ORWDBA7",110,0)
 S ORFMDAT=$$ORFMDAT^ORWDBA3(ORIFN)
"RTN","ORWDBA7",111,0)
 ; $O through diagnoses for an order
"RTN","ORWDBA7",112,0)
 F  S OCT=$O(^OR(100,ORIFN,5.1,OCT)) Q:OCT'?1N.N  D
"RTN","ORWDBA7",113,0)
 . S DXOF="               "
"RTN","ORWDBA7",114,0)
 . ; DXIEN=Dx IEN
"RTN","ORWDBA7",115,0)
 . S DXIEN=+^OR(100,ORIFN,5.1,OCT,0)
"RTN","ORWDBA7",116,0)
 . ; Get Dx record for date ORFMDAT
"RTN","ORWDBA7",117,0)
 . S ICDR=$$ICDDX^ICDCODE(DXIEN,ORFMDAT)
"RTN","ORWDBA7",118,0)
 . ; Get Dx verbiage and ICD code
"RTN","ORWDBA7",119,0)
 . S DXV=$P(ICDR,U,4),ICD9=$P(ICDR,U,2)
"RTN","ORWDBA7",120,0)
 . I OCT=1 D
"RTN","ORWDBA7",121,0)
 .. S CIDCARY(GMRCCT,0)=" ",GMRCCT=GMRCCT+1 ;blank line
"RTN","ORWDBA7",122,0)
 .. S CIDCARY(GMRCCT,0)="Clinical Indicators",GMRCCT=GMRCCT+1
"RTN","ORWDBA7",123,0)
 .. S DXOF="Diagnosis of:  "
"RTN","ORWDBA7",124,0)
 . S LINE=DXOF_ICD9_" - "_DXV
"RTN","ORWDBA7",125,0)
 . S CIDCARY(GMRCCT,0)=LINE,GMRCCT=GMRCCT+1
"RTN","ORWDBA7",126,0)
 I OCT'="" D  ;if there are diagnoses then show Treatment Factors
"RTN","ORWDBA7",127,0)
 . S LINE="For conditions related to:    "
"RTN","ORWDBA7",128,0)
 . F EYE=1:1:7 S TF=$P(^OR(100,ORIFN,5.2),U,EYE) I TF D
"RTN","ORWDBA7",129,0)
 .. S CIDCARY(GMRCCT,0)=LINE_$$SC^ORQ21(EYE)
"RTN","ORWDBA7",130,0)
 .. S X=$$REPEAT^XLFSTR(" ",30),GMRCCT=GMRCCT+1
"RTN","ORWDBA7",131,0)
 Q
"RTN","ORWDBA8")
0^58^B60097261
"RTN","ORWDBA8",1,0)
ORWDBA8 ; SLC/GDU - Billing Awareness - Phase I [11/16/04 15:39]
"RTN","ORWDBA8",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORWDBA8",3,0)
 ;Clinical Indicator Data Capture By Provider Parameter Management
"RTN","ORWDBA8",4,0)
 ;
"RTN","ORWDBA8",5,0)
 ;Varaibles
"RTN","ORWDBA8",6,0)
 ;  CIDC   Clinical Indicator Data Capture Parameter, current value
"RTN","ORWDBA8",7,0)
 ;  CNT    Counter, incremented counter variable
"RTN","ORWDBA8",8,0)
 ;  DIR    Input array variable for ^DIR
"RTN","ORWDBA8",9,0)
 ;  DT     Standard Fileman/Kernel variable for current date
"RTN","ORWDBA8",10,0)
 ;         DT is set, but not newed or killed
"RTN","ORWDBA8",11,0)
 ;  DTOUT  Timeout indicator, output variable of ^DIR
"RTN","ORWDBA8",12,0)
 ;  DUOUT  Up arrow indicator, output variable of ^DIR
"RTN","ORWDBA8",13,0)
 ;  OREM   Error Message, output variable of ^DIC, and ^XPAR
"RTN","ORWDBA8",14,0)
 ;  FST    First, display control varible
"RTN","ORWDBA8",15,0)
 ;  HC     Help Counter, help text line count
"RTN","ORWDBA8",16,0)
 ;  IEN    Internal Entry Number
"RTN","ORWDBA8",17,0)
 ;  IOF    Standard Kernel variable to clear screen
"RTN","ORWDBA8",18,0)
 ;  NAME   Provider Name, parsed from RF output array from FIND^DIC
"RTN","ORWDBA8",19,0)
 ;  NX0    Next group of providers prompt, used to help build DIR(0)
"RTN","ORWDBA8",20,0)
 ;  NXC    Next group of providers count, used to help build DIR(0)
"RTN","ORWDBA8",21,0)
 ;  NXH    Next group of providers help, used to help build DIR("?"
"RTN","ORWDBA8",22,0)
 ;  PTD    Provider Termination Date, internal value
"RTN","ORWDBA8",23,0)
 ;  RF     Records Found, initial user search results
"RTN","ORWDBA8",24,0)
 ;  ORSCR  Screen, input variable to filter search
"RTN","ORWDBA8",25,0)
 ;  SP     Selected Provider
"RTN","ORWDBA8",26,0)
 ;  SV     Search Value
"RTN","ORWDBA8",27,0)
 ;  U      Standard FileMan, Kernel field delimiter
"RTN","ORWDBA8",28,0)
 ;  US     User Selection
"RTN","ORWDBA8",29,0)
 ;  WA     Work Array, filtered array of providers for user selection
"RTN","ORWDBA8",30,0)
 ;  X      Standard FileMan work varaible
"RTN","ORWDBA8",31,0)
 ;  Y      Processed output of user selection, output variable of ^DIR
"RTN","ORWDBA8",32,0)
 ;
"RTN","ORWDBA8",33,0)
 ;External References
"RTN","ORWDBA8",34,0)
 ;  FIND^DIC    DBIA 2051, FileMan record(s) finder
"RTN","ORWDBA8",35,0)
 ;  ^DIR        DBIA 10026, FileMan input reader
"RTN","ORWDBA8",36,0)
 ;  $$GET^XPAR  DBIA 2263, Get current value of single parameter
"RTN","ORWDBA8",37,0)
 ;  ADD^XPAR    DBIA 2263, Add new parameter
"RTN","ORWDBA8",38,0)
 ;  CHG^XPAR    DBIA 2263, Change current value of parameter
"RTN","ORWDBA8",39,0)
 ;  $$DT^XLFDT  DBIA 10103, Gets today's date from the system
"RTN","ORWDBA8",40,0)
 ;
"RTN","ORWDBA8",41,0)
EN ;Starting point of this program
"RTN","ORWDBA8",42,0)
 ;Ask user for provider
"RTN","ORWDBA8",43,0)
 N APS,CIDC,CNT,DIR,DTOUT,DUOUT,OREM,FST,HC,IEN,NAME,NX0,NXC,NXH,RF
"RTN","ORWDBA8",44,0)
 N ORSCR,PTD,SP,SV,US,VAL,WA,X,Y
"RTN","ORWDBA8",45,0)
 S DT=$$DT^XLFDT
"RTN","ORWDBA8",46,0)
 S DIR(0)=$P($T(FT0),";",3)
"RTN","ORWDBA8",47,0)
 S DIR("A")=$P($T(FA),";",3)
"RTN","ORWDBA8",48,0)
 S DIR("?",1)=$P($T(FH1),";",3)
"RTN","ORWDBA8",49,0)
 S DIR("?",2)=$P($T(FH2),";",3)
"RTN","ORWDBA8",50,0)
 S DIR("?")=$P($T(FH3),";",3)
"RTN","ORWDBA8",51,0)
 D SCRHDR W ! D ^DIR S SV=Y K DIR
"RTN","ORWDBA8",52,0)
 I SV=""!($D(DTOUT))!($D(DUOUT)) G EXIT
"RTN","ORWDBA8",53,0)
 S ORSCR="I $D(^XUSEC(""PROVIDER"",Y))=1"
"RTN","ORWDBA8",54,0)
 D FIND^DIC(200,"","@;.01;7;9.2I;9.2","CP",SV,"*","",.ORSCR,"","RF","OREM")
"RTN","ORWDBA8",55,0)
 ;Test if no matching records found. If true alert user.
"RTN","ORWDBA8",56,0)
 I $P(RF("DILIST",0),U)=0 D  G:Y=1 EN G EXIT
"RTN","ORWDBA8",57,0)
 . S DIR(0)="E"
"RTN","ORWDBA8",58,0)
 . S DIR("A",1)=$P($T(UAA1),";",3)_" "_SV
"RTN","ORWDBA8",59,0)
 . S DIR("A")=$P($T(UAA5),";",3)
"RTN","ORWDBA8",60,0)
 . D SCRHDR W ! D ^DIR K DIR
"RTN","ORWDBA8",61,0)
 S (SP,PTD)=""
"RTN","ORWDBA8",62,0)
 ;If search returns only 1 match
"RTN","ORWDBA8",63,0)
 I $P(RF("DILIST",0),U)=1 D
"RTN","ORWDBA8",64,0)
 . S SP=1,PTD=$P(RF("DILIST",SP,0),U,4)
"RTN","ORWDBA8",65,0)
 .;Test if provider is DISUSERED. If true alert user and quit
"RTN","ORWDBA8",66,0)
 . I $P(RF("DILIST",SP,0),U,3)="YES" D  Q
"RTN","ORWDBA8",67,0)
 .. S DIR(0)="E"
"RTN","ORWDBA8",68,0)
 .. S DIR("A",1)=$P(RF("DILIST",SP,0),U,2)_" "_$P($T(UAA2),";",3)
"RTN","ORWDBA8",69,0)
 .. S DIR("A")=$P($T(UAA5),";",3)
"RTN","ORWDBA8",70,0)
 .. D SCRHDR W ! D ^DIR K DIR
"RTN","ORWDBA8",71,0)
 .. S SP=$S(Y=1:"",1:"Q")
"RTN","ORWDBA8",72,0)
 .;Test if provider is terminated. If true alert user and quit
"RTN","ORWDBA8",73,0)
 . I PTD'="",(PTD=DT)!(PTD<DT) D  Q
"RTN","ORWDBA8",74,0)
 .. S DIR(0)="E"
"RTN","ORWDBA8",75,0)
 .. S DIR("A",1)=$P(RF("DILIST",SP,0),U,2)_" "_$P($T(UAA3),";",3)
"RTN","ORWDBA8",76,0)
 .. S DIR("A",1)=DIR("A",1)_" "_$P(RF("DILIST",SP,0),U,5)
"RTN","ORWDBA8",77,0)
 .. S DIR("A")=$P($T(UAA5),";",3)
"RTN","ORWDBA8",78,0)
 .. D SCRHDR W ! D ^DIR K DIR
"RTN","ORWDBA8",79,0)
 .. S SP=$S(Y=1:"",1:"Q")
"RTN","ORWDBA8",80,0)
 . S IEN=$P(RF("DILIST",1,0),U)
"RTN","ORWDBA8",81,0)
 . S NAME=$P(RF("DILIST",1,0),U,2)
"RTN","ORWDBA8",82,0)
 I $P(RF("DILIST",0),U)>1 D
"RTN","ORWDBA8",83,0)
 . S WA(0)=0
"RTN","ORWDBA8",84,0)
 . F X=1:1:$P(RF("DILIST",0),U) D
"RTN","ORWDBA8",85,0)
 .. S PTD=$P(RF("DILIST",X,0),U,4)
"RTN","ORWDBA8",86,0)
 .. I $P(RF("DILIST",X,0),U,3)="",(PTD="")!(PTD>DT) D
"RTN","ORWDBA8",87,0)
 ... S WA(0)=WA(0)+1
"RTN","ORWDBA8",88,0)
 ... S WA(WA(0))=RF("DILIST",X,0)
"RTN","ORWDBA8",89,0)
 . I WA(0)=0 D
"RTN","ORWDBA8",90,0)
 .. ;Alerting the user that this search failed because all providers
"RTN","ORWDBA8",91,0)
 .. ;returned are inactive
"RTN","ORWDBA8",92,0)
 .. S DIR(0)="E"
"RTN","ORWDBA8",93,0)
 .. S DIR("A",1)=$P($T(UAA4),";",3)_" "_SV
"RTN","ORWDBA8",94,0)
 .. S DIR("A")=$P($T(UAA5),";",3)
"RTN","ORWDBA8",95,0)
 .. D SCRHDR W ! D ^DIR K DIR
"RTN","ORWDBA8",96,0)
 .. S SP=$S(Y=1:"",1:"Q")
"RTN","ORWDBA8",97,0)
 . I WA(0)=0 Q
"RTN","ORWDBA8",98,0)
 . I WA(0)=1 S SP=1  ;Default to the single active provider
"RTN","ORWDBA8",99,0)
 . I WA(0)>1 D SPFL  ;Additional selection if several active providers
"RTN","ORWDBA8",100,0)
 . I SP="Q"!(SP="") Q
"RTN","ORWDBA8",101,0)
 . S IEN=$P(WA(SP),U)
"RTN","ORWDBA8",102,0)
 . S NAME=$P(WA(SP),U,2)
"RTN","ORWDBA8",103,0)
 I SP="Q" G EXIT
"RTN","ORWDBA8",104,0)
 I SP="" G EN
"RTN","ORWDBA8",105,0)
 D PSP G EN
"RTN","ORWDBA8",106,0)
EXIT ;Exit point for this program
"RTN","ORWDBA8",107,0)
 Q
"RTN","ORWDBA8",108,0)
FT0 ;;FO^1:40
"RTN","ORWDBA8",109,0)
FA ;;Select the provider to manage the parameter
"RTN","ORWDBA8",110,0)
FH1 ;;Enter the name/partial name of the provider.
"RTN","ORWDBA8",111,0)
FH2 ;;This is free text, 1 to 40 characters in length.
"RTN","ORWDBA8",112,0)
FH3 ;;This search will only return those with the PROVIDER key.
"RTN","ORWDBA8",113,0)
UAA1 ;;Found no provider records matching the search criteria of
"RTN","ORWDBA8",114,0)
UAA2 ;;is a provider who has been DISUSERED.
"RTN","ORWDBA8",115,0)
UAA3 ;;is an inactive provider with a termination date of
"RTN","ORWDBA8",116,0)
UAA4 ;;Found no active provider records matching the search criteria of
"RTN","ORWDBA8",117,0)
UAA5 ;;Hit enter to continue or "^" to quit
"RTN","ORWDBA8",118,0)
SPFL ;Select Provider From List
"RTN","ORWDBA8",119,0)
 I $D(FST)=0 S FST=1
"RTN","ORWDBA8",120,0)
 S DIR(0)="SO^"
"RTN","ORWDBA8",121,0)
 S DIR("?",1)=$P($T(DH),";",3)
"RTN","ORWDBA8",122,0)
 S DIR("?")=$P($T(DHS),";",3)
"RTN","ORWDBA8",123,0)
 S DIR("A")=$P($T(DA),";",3)
"RTN","ORWDBA8",124,0)
 I WA(0)<10 D
"RTN","ORWDBA8",125,0)
 . F X=1:1:WA(0)  S DIR(0)=DIR(0)_X_":"_$P(WA(X),U,2)_";"
"RTN","ORWDBA8",126,0)
 I WA(0)=10 D
"RTN","ORWDBA8",127,0)
 . F X=1:1:10  S DIR(0)=DIR(0)_X_":"_$P(WA(X),U,2)_";"
"RTN","ORWDBA8",128,0)
 I WA(0)>10 D
"RTN","ORWDBA8",129,0)
 . S CNT=0,HC=1,(NXC,NX0,NXH,SP,X,Y)=""
"RTN","ORWDBA8",130,0)
 . F X=FST:1:10+(FST-1) Q:$D(WA(X))=0  D
"RTN","ORWDBA8",131,0)
 .. S CNT=CNT+1
"RTN","ORWDBA8",132,0)
 .. S DIR(0)=DIR(0)_X_":"_$P(WA(X),U,2)_";"
"RTN","ORWDBA8",133,0)
 . S NXC=WA(0)-X,NXC=$S(NXC>10:10,1:NXC)
"RTN","ORWDBA8",134,0)
 . S NX0=$P($P($T(D0N),";",3),"|")_NXC_$P($P($T(D0N),";",3),"|",2)
"RTN","ORWDBA8",135,0)
 . S NXH=$P($P($T(DHN),";",3),"|")_NXC_$P($P($T(DHN),";",3),"|",2)
"RTN","ORWDBA8",136,0)
 . I CNT=10 D
"RTN","ORWDBA8",137,0)
 .. S DIR(0)=DIR(0)_";"_NX0
"RTN","ORWDBA8",138,0)
 .. S HC=HC+1,DIR("?",HC)=NXH
"RTN","ORWDBA8",139,0)
 . I FST>10 D
"RTN","ORWDBA8",140,0)
 .. S DIR(0)=DIR(0)_";"_$P($T(D0P),";",3)
"RTN","ORWDBA8",141,0)
 .. S HC=HC+1,DIR("?",HC)=$P($T(DHP),";",3)
"RTN","ORWDBA8",142,0)
 D SCRHDR,^DIR K DIR
"RTN","ORWDBA8",143,0)
 S SP=Y
"RTN","ORWDBA8",144,0)
 I SP="" Q
"RTN","ORWDBA8",145,0)
 I $D(DTOUT)!($D(DUOUT)) S SP="Q" Q
"RTN","ORWDBA8",146,0)
 I SP="N"!(SP="P") S FST=$S(SP="N":FST+10,1:FST-10) G SPFL
"RTN","ORWDBA8",147,0)
 I SP=""!(SP="Q") Q
"RTN","ORWDBA8",148,0)
 Q
"RTN","ORWDBA8",149,0)
D0N ;;N:Next | provider(s)
"RTN","ORWDBA8",150,0)
D0P ;;P:Previous 10 providers
"RTN","ORWDBA8",151,0)
DH ;;Select the provider for parameter management.
"RTN","ORWDBA8",152,0)
DHN ;;Enter N to get the next | providers.
"RTN","ORWDBA8",153,0)
DHP ;;Enter P to get the previous 10 providers.
"RTN","ORWDBA8",154,0)
DHS ;;Enter "^" to exit or the Enter key to return to provider lookup.
"RTN","ORWDBA8",155,0)
DA ;;Select the provider to assign the parameter
"RTN","ORWDBA8",156,0)
PSP ;Process Selected Provider
"RTN","ORWDBA8",157,0)
 S CIDC=$$GET^XPAR(IEN_";VA(200,","OR BILLING AWARENESS BY USER",1,"Q")
"RTN","ORWDBA8",158,0)
 I CIDC="" D
"RTN","ORWDBA8",159,0)
 . ;Assign the CIDC parameter and enable/disable it
"RTN","ORWDBA8",160,0)
 . S DIR(0)="SO^"_$P($T(AE),";",3)_";"_$P($T(AD),";",3)
"RTN","ORWDBA8",161,0)
 . S DIR("A")=$P($T(AA),";",3)
"RTN","ORWDBA8",162,0)
 . S DIR("?",1)=$P($T(AHE),";",3),DIR("?")=$P($T(AHD),";",3)
"RTN","ORWDBA8",163,0)
 . D SCRHDR
"RTN","ORWDBA8",164,0)
 . W !,$P($T(ASH1),";",3)," ",NAME,!,$P($T(ASH2),";",3)
"RTN","ORWDBA8",165,0)
 . D ^DIR S US=Y K DIR
"RTN","ORWDBA8",166,0)
 . I US=""!($D(DTOUT))!($D(DUOUT)) Q
"RTN","ORWDBA8",167,0)
 . S VAL=$S(US="E":1,1:0),OREM=""
"RTN","ORWDBA8",168,0)
 . D ADD^XPAR(IEN_";VA(200,","OR BILLING AWARENESS BY USER",1,VAL,.OREM)
"RTN","ORWDBA8",169,0)
 E  D
"RTN","ORWDBA8",170,0)
 . ;Edit the CIDC parameter to enable or disable it
"RTN","ORWDBA8",171,0)
 . S DIR(0)="Y"
"RTN","ORWDBA8",172,0)
 . I CIDC=0 S DIR("A")=$P($T(EEA),";",3),DIR("?",1)=$P($T(EHEY),";",3)
"RTN","ORWDBA8",173,0)
 . E  S DIR("A")=$P($T(EDA),";",3),DIR("?",1)=$P($T(EHDY),";",3)
"RTN","ORWDBA8",174,0)
 . S DIR("B")="YES",DIR("?")=$P($T(EHN),";",3)
"RTN","ORWDBA8",175,0)
 . D SCRHDR
"RTN","ORWDBA8",176,0)
 . W !,$P($T(ESH),";",3)_" "_NAME
"RTN","ORWDBA8",177,0)
 . W:CIDC=0 !,$P($T(EESH),";",3)
"RTN","ORWDBA8",178,0)
 . W:CIDC=1 !,$P($T(EDSH),";",3)
"RTN","ORWDBA8",179,0)
 . W ! D ^DIR S US=Y K DIR
"RTN","ORWDBA8",180,0)
 . I US=""!(US=0)!($D(DTOUT))!($D(DUOUT)) Q
"RTN","ORWDBA8",181,0)
 . S OREM="",VAL=$S(CIDC=0:1,1:0)
"RTN","ORWDBA8",182,0)
 . D CHG^XPAR(IEN_";VA(200,","OR BILLING AWARENESS BY USER",1,VAL,.OREM)
"RTN","ORWDBA8",183,0)
 Q
"RTN","ORWDBA8",184,0)
ASH1 ;;Assign CIDC Functionality Parameter to
"RTN","ORWDBA8",185,0)
ASH2 ;;Enable / Disable CIDC Functionality
"RTN","ORWDBA8",186,0)
AE ;;E:Enable CIDC functionality
"RTN","ORWDBA8",187,0)
AD ;;D:Disable CIDC functionality
"RTN","ORWDBA8",188,0)
AA ;;Assign the parameter and enable / disable CIDC functionality
"RTN","ORWDBA8",189,0)
AHE ;;Enter E to assign the parameter and enable CIDC for this provider.
"RTN","ORWDBA8",190,0)
AHD ;;Enter D to assign the parameter and disable CIDC for this provider
"RTN","ORWDBA8",191,0)
ESH ;;Edit Assigned CIDC Functionality Parameter of
"RTN","ORWDBA8",192,0)
EESH ;;CIDC Functionality for this provider is currently DISABLED
"RTN","ORWDBA8",193,0)
EDSH ;;CIDC Functionality for this provider is currently ENABLED
"RTN","ORWDBA8",194,0)
EEA ;;Enable CIDC Functionality (YES/NO)
"RTN","ORWDBA8",195,0)
EDA ;;Disable CIDC Functionality (YES/NO)
"RTN","ORWDBA8",196,0)
EHEY ;;Enter YES to ENABLE CIDC Functionality
"RTN","ORWDBA8",197,0)
EHDY ;;Enter YES to DISABLE CIDC Functionality
"RTN","ORWDBA8",198,0)
EHN ;;Enter NO to leave CIDC Functionality unchanged
"RTN","ORWDBA8",199,0)
 ;
"RTN","ORWDBA8",200,0)
SCRHDR ;Screen Header
"RTN","ORWDBA8",201,0)
 W:$D(IOF) @IOF
"RTN","ORWDBA8",202,0)
 W !,$P($T(SH1),";",3)
"RTN","ORWDBA8",203,0)
 Q
"RTN","ORWDBA8",204,0)
SH1 ;;Clinical Indicator Data Capture By Provider Parameter Management
"RTN","ORWDBA81")
0^59^B10519960
"RTN","ORWDBA81",1,0)
ORWDBA81 ; SLC/GDU - Billing Awareness - Phase I [10/18/04 10:42]
"RTN","ORWDBA81",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORWDBA81",3,0)
 ;
"RTN","ORWDBA81",4,0)
 ;Enable Clinical Indicator Data Capture By Provider Parameter Module
"RTN","ORWDBA81",5,0)
 ;ORWDBA81 - Mass assign the parameter to all providers without the 
"RTN","ORWDBA81",6,0)
 ;           parameter and set it to 1 to enable the CIDC functionality.
"RTN","ORWDBA81",7,0)
 ;
"RTN","ORWDBA81",8,0)
 ;Local Variables
"RTN","ORWDBA81",9,0)
 ;DIR          Input array variable for ^DIR
"RTN","ORWDBA81",10,0)
 ;DTOUT        Timeout indicator, output variable of ^DIR
"RTN","ORWDBA81",11,0)
 ;DUOUT        Up arrow indicator, output variable of ^DIR
"RTN","ORWDBA81",12,0)
 ;ENT          Entity the parameter is assigned to, input variable for
"RTN","ORWDBA81",13,0)
 ;             ADD^XPAR
"RTN","ORWDBA81",14,0)
 ;ORERR        Error Message, output variable of ADD^XPAR
"RTN","ORWDBA81",15,0)
 ;INST         Instance indicator, input variable for ADD^XPAR
"RTN","ORWDBA81",16,0)
 ;IOF          Clear Screen and move cursor to top of screen, standard
"RTN","ORWDBA81",17,0)
 ;             Kernal IO variable
"RTN","ORWDBA81",18,0)
 ;PAR          The Name or IEN of a parameter in the PARAMETER DEFINITION
"RTN","ORWDBA81",19,0)
 ;             FILE, input variable for ADD^XPAR 
"RTN","ORWDBA81",20,0)
 ;VAL          Value of the parameter being added, input variable for
"RTN","ORWDBA81",21,0)
 ;             ADD^XPAR
"RTN","ORWDBA81",22,0)
 ;X            Standard FileMan work varaible
"RTN","ORWDBA81",23,0)
 ;Y            Processed output of user selection, output variable for
"RTN","ORWDBA81",24,0)
 ;             ^DIR
"RTN","ORWDBA81",25,0)
 ;
"RTN","ORWDBA81",26,0)
 ;Global Variables
"RTN","ORWDBA81",27,0)
 ;^TMP("ORPUL" Temp global for providers who do not have the
"RTN","ORWDBA81",28,0)
 ;             Enable/Disable CIDC By Provider parameter assigned to them
"RTN","ORWDBA81",29,0)
 ;^XTV(8989.51 PARAMETER DEFINITION FILE, file # 8989.51
"RTN","ORWDBA81",30,0)
 ;
"RTN","ORWDBA81",31,0)
 ;External References
"RTN","ORWDBA81",32,0)
 ;^DIR         FileMan general purpose response reader
"RTN","ORWDBA81",33,0)
 ;ADD^XPAR     PARAMETER TOOLS, API to add a new parameter value
"RTN","ORWDBA81",34,0)
 ;
"RTN","ORWDBA81",35,0)
MAIN ;Starting point of this program
"RTN","ORWDBA81",36,0)
 N DIR,DTOUT,DUOUT,ENT,ORERR,INST,PAR,VAL,X,Y
"RTN","ORWDBA81",37,0)
 ;Prepare and display user options for this program
"RTN","ORWDBA81",38,0)
 S DIR(0)=$P($T(SXOPT),";",3)_";"
"RTN","ORWDBA81",39,0)
 S DIR(0)=DIR(0)_$P($T(OY),";",3)_";"_$P($T(ON),";",3)
"RTN","ORWDBA81",40,0)
 S DIR("A",1)=^TMP("ORPUL",$J,"A")_" "_$P($T(A1),";",3)
"RTN","ORWDBA81",41,0)
 S DIR("A",2)=$P($T(A2),";",3)
"RTN","ORWDBA81",42,0)
 S DIR("A",3)=$P($T(A3),";",3)
"RTN","ORWDBA81",43,0)
 S DIR("A")=$P($T(A4),";",3)
"RTN","ORWDBA81",44,0)
 S DIR("?",1)=$P($T(HY),";",3)
"RTN","ORWDBA81",45,0)
 S DIR("?")=$P($T(HN),";",3)
"RTN","ORWDBA81",46,0)
 D SCRHDR,^DIR K DIR
"RTN","ORWDBA81",47,0)
 ;Process user selection.
"RTN","ORWDBA81",48,0)
 I Y="NO"!($D(DTOUT))!($D(DUOUT)) Q  ;If NO, timeout, or up arrow quit
"RTN","ORWDBA81",49,0)
 ;Process the mass parameter assignment and functionality enabling
"RTN","ORWDBA81",50,0)
 S (ENT,X)="",(INST,VAL)=1
"RTN","ORWDBA81",51,0)
 S PAR=$QS($Q(^XTV(8989.51,"B","OR BILLING AWARENESS BY USER")),4)
"RTN","ORWDBA81",52,0)
 D SCRHDR
"RTN","ORWDBA81",53,0)
 W !!,$P($T(EP),";",3),!
"RTN","ORWDBA81",54,0)
 S X="" F  S X=$O(^TMP("ORPUL",$J,"A",X)) Q:X=""  D
"RTN","ORWDBA81",55,0)
 . W "."
"RTN","ORWDBA81",56,0)
 . S ENT=^TMP("ORPUL",$J,"A",X)
"RTN","ORWDBA81",57,0)
 . D ADD^XPAR(ENT,PAR,INST,VAL,.ORERR)
"RTN","ORWDBA81",58,0)
 ;Alert user the mass parameter assignment and functionality enabling is
"RTN","ORWDBA81",59,0)
 ;done.
"RTN","ORWDBA81",60,0)
 S DIR(0)="E",DIR("A")=$P($T(EC),";",3)
"RTN","ORWDBA81",61,0)
 D ^DIR K DIR Q
"RTN","ORWDBA81",62,0)
SCRHDR ;Screen Header
"RTN","ORWDBA81",63,0)
 W:$D(IOF) @IOF
"RTN","ORWDBA81",64,0)
 W !,$P($T(SH1),";",3),!,$P($T(SH2),";",3)
"RTN","ORWDBA81",65,0)
 Q
"RTN","ORWDBA81",66,0)
SXOPT ;;SX^
"RTN","ORWDBA81",67,0)
SH1 ;;Enable Clinical Indicator Data Capture By Provider Parameter Management
"RTN","ORWDBA81",68,0)
SH2 ;;Assign/Enable Parameter For All Providers Option
"RTN","ORWDBA81",69,0)
OY ;;YES:Enter YES to begin process of assign/enable
"RTN","ORWDBA81",70,0)
ON ;;NO:Enter NO to cancel process of assign/enable and quit
"RTN","ORWDBA81",71,0)
A1 ;;providers do not have this parameter assigned to them.
"RTN","ORWDBA81",72,0)
A2 ;;You have selected to assign the parameter and enable Clinical Indictor
"RTN","ORWDBA81",73,0)
A3 ;;Data Capture for all of these providers. This may take some time.
"RTN","ORWDBA81",74,0)
A4 ;;Are you sure you want to do this? (YES/NO - must be all caps)
"RTN","ORWDBA81",75,0)
HY ;;Enter YES to begin the assign/enable process.
"RTN","ORWDBA81",76,0)
HN ;;Enter NO to cancel the assign/enable process and quit.
"RTN","ORWDBA81",77,0)
EP ;;Now assigning CIDC parameter and enabling the functionality.
"RTN","ORWDBA81",78,0)
EC ;;CIDC parameter assignment and functionality enabling complete.
"RTN","ORWDBA82")
0^60^B10638038
"RTN","ORWDBA82",1,0)
ORWDBA82 ; SLC/GDU - Billing Awareness - Phase I [10/18/04 10:48]
"RTN","ORWDBA82",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORWDBA82",3,0)
 ; SLC/GU Billing Awareness - Phase I [2/10/04 9:45 am]
"RTN","ORWDBA82",4,0)
 ;Enable Clinical Indicator Data Capture By Provider Parameter Module
"RTN","ORWDBA82",5,0)
 ;ORWDBA82 - Mass the parameter to all providers without the parameter
"RTN","ORWDBA82",6,0)
 ;           and set it to 0 to disable the CIDC functionality.
"RTN","ORWDBA82",7,0)
 ;
"RTN","ORWDBA82",8,0)
 ;Local Variables
"RTN","ORWDBA82",9,0)
 ;DIR          Input array variable for ^DIR
"RTN","ORWDBA82",10,0)
 ;DTOUT        Timeout indicator, output variable of ^DIR
"RTN","ORWDBA82",11,0)
 ;DUOUT        Up arrow indicator, output variable of ^DIR
"RTN","ORWDBA82",12,0)
 ;ENT          Entity the parameter is assigned to, input variable for
"RTN","ORWDBA82",13,0)
 ;             ADD^XPAR
"RTN","ORWDBA82",14,0)
 ;ORERR        Error Message, output variable of ADD^XPAR
"RTN","ORWDBA82",15,0)
 ;INST         Instance indicator, input variable for ADD^XPAR
"RTN","ORWDBA82",16,0)
 ;IOF          Clear Screen and move cursor to top of screen, standard
"RTN","ORWDBA82",17,0)
 ;             Kernal IO variable
"RTN","ORWDBA82",18,0)
 ;PAR          The Name or IEN of a parameter in the PARAMETER DEFINITION
"RTN","ORWDBA82",19,0)
 ;             FILE, input variable for ADD^XPAR 
"RTN","ORWDBA82",20,0)
 ;VAL          Value of the parameter being added, input variable for
"RTN","ORWDBA82",21,0)
 ;             ADD^XPAR
"RTN","ORWDBA82",22,0)
 ;X            Standard FileMan work varaible
"RTN","ORWDBA82",23,0)
 ;Y            Processed output of user selection, output variable for
"RTN","ORWDBA82",24,0)
 ;             ^DIR
"RTN","ORWDBA82",25,0)
 ;
"RTN","ORWDBA82",26,0)
 ;Global Variables
"RTN","ORWDBA82",27,0)
 ;^TMP("ORPUL" Temp global for providers who do not have the
"RTN","ORWDBA82",28,0)
 ;             Enable/Disable CIDC By Provider parameter assigned to them
"RTN","ORWDBA82",29,0)
 ;^XTV(8989.51 PARAMETER DEFINITION FILE, file # 8989.51
"RTN","ORWDBA82",30,0)
 ;
"RTN","ORWDBA82",31,0)
 ;External References
"RTN","ORWDBA82",32,0)
 ;^DIR         FileMan general purpose response reader
"RTN","ORWDBA82",33,0)
 ;ADD^XPAR     PARAMETER TOOLS, API to add a new parameter value
"RTN","ORWDBA82",34,0)
 ;
"RTN","ORWDBA82",35,0)
MAIN ;Starting point of this program
"RTN","ORWDBA82",36,0)
 N DIR,DTOUT,DUOUT,ENT,ORERR,INST,PAR,VAL,X,Y
"RTN","ORWDBA82",37,0)
 ;Prepare and display the user options for this program
"RTN","ORWDBA82",38,0)
 S DIR(0)=$P($T(SXOPT),";",3)_";"
"RTN","ORWDBA82",39,0)
 S DIR(0)=DIR(0)_$P($T(OY),";",3)_";"_$P($T(ON),";",3)
"RTN","ORWDBA82",40,0)
 S DIR("A",1)=^TMP("ORPUL",$J,"A")_" "_$P($T(A1),";",3)
"RTN","ORWDBA82",41,0)
 S DIR("A",2)=$P($T(A2),";",3)
"RTN","ORWDBA82",42,0)
 S DIR("A",3)=$P($T(A3),";",3)
"RTN","ORWDBA82",43,0)
 S DIR("A")=$P($T(A4),";",3)
"RTN","ORWDBA82",44,0)
 S DIR("?",1)=$P($T(HY),";",3)
"RTN","ORWDBA82",45,0)
 S DIR("?")=$P($T(HN),";",3)
"RTN","ORWDBA82",46,0)
 D SCRHDR,^DIR K DIR
"RTN","ORWDBA82",47,0)
 ;Process user selection
"RTN","ORWDBA82",48,0)
 I Y="NO"!($D(DTOUT))!($D(DUOUT)) Q  ;If NO, timeout, or up arrow quit
"RTN","ORWDBA82",49,0)
 ;Process the mass parameter assignment and functionality disabling
"RTN","ORWDBA82",50,0)
 S (ENT,X)="",INST=1,VAL=0
"RTN","ORWDBA82",51,0)
 S PAR=$QS($Q(^XTV(8989.51,"B","OR BILLING AWARENESS BY USER")),4)
"RTN","ORWDBA82",52,0)
 D SCRHDR
"RTN","ORWDBA82",53,0)
 W !!,$P($T(DP),";",3),!
"RTN","ORWDBA82",54,0)
 S X="" F  S X=$O(^TMP("ORPUL",$J,"A",X)) Q:X=""  D
"RTN","ORWDBA82",55,0)
 . W "."
"RTN","ORWDBA82",56,0)
 . S ENT=^TMP("ORPUL",$J,"A",X)
"RTN","ORWDBA82",57,0)
 . D ADD^XPAR(ENT,PAR,INST,VAL,.ORERR)
"RTN","ORWDBA82",58,0)
 ;Alert user the mass parameter assignment and functionality disabling is
"RTN","ORWDBA82",59,0)
 ;done.
"RTN","ORWDBA82",60,0)
 S DIR(0)="E",DIR("A")=$P($T(DC),";",3)
"RTN","ORWDBA82",61,0)
 D ^DIR K DIR Q
"RTN","ORWDBA82",62,0)
SCRHDR ;Screen Header
"RTN","ORWDBA82",63,0)
 W:$D(IOF) @IOF
"RTN","ORWDBA82",64,0)
 W !,$P($T(SH1),";",3),!,$P($T(SH2),";",3)
"RTN","ORWDBA82",65,0)
 Q
"RTN","ORWDBA82",66,0)
SXOPT ;;SX^
"RTN","ORWDBA82",67,0)
SH1 ;;Enable Clinical Indicator Data Capture By Provider Parameter Management
"RTN","ORWDBA82",68,0)
SH2 ;;Assign/Disable Parameter For All Providers Option
"RTN","ORWDBA82",69,0)
OY ;;YES:Enter YES to begin process of assign/disable
"RTN","ORWDBA82",70,0)
ON ;;NO:Enter NO to cancel process of assign/disable and quit
"RTN","ORWDBA82",71,0)
A1 ;;providers do not have this parameter assigned to them.
"RTN","ORWDBA82",72,0)
A2 ;;You have selected to assign the parameter and disable Clinical Indicator
"RTN","ORWDBA82",73,0)
A3 ;;Data Capture for all of these providers. This may take some time.
"RTN","ORWDBA82",74,0)
A4 ;;Are you sure you want to do this? (YES/NO - must be all cap)
"RTN","ORWDBA82",75,0)
HY ;;Enter YES to begin the assign/disable process.
"RTN","ORWDBA82",76,0)
HN ;;Enter No to cancel the assign/disable process and quit.
"RTN","ORWDBA82",77,0)
DP ;;Now assigning CIDC parameter and disabling the functionality.
"RTN","ORWDBA82",78,0)
DC ;;CIDC parameter assignment and functionality disabling complete.
"RTN","ORWDBA83")
0^61^B60163988
"RTN","ORWDBA83",1,0)
ORWDBA83 ; SLC/GDU - Billing Awareness - Phase I [10/18/04 10:52]
"RTN","ORWDBA83",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORWDBA83",3,0)
 ;
"RTN","ORWDBA83",4,0)
 ;Enable Clinical Indicator Data Capture By Provider Parameter Module
"RTN","ORWDBA83",5,0)
 ;ORWDBA83 - Assign the parameter to a selected provider and manually set
"RTN","ORWDBA83",6,0)
 ;           the CIDC by provider parameter to enable/disable the CIDC
"RTN","ORWDBA83",7,0)
 ;           functionality
"RTN","ORWDBA83",8,0)
 ;
"RTN","ORWDBA83",9,0)
 ;Local Variables
"RTN","ORWDBA83",10,0)
 ;CNT          Counter - Used to get count of providers who do not have 
"RTN","ORWDBA83",11,0)
 ;             the parameter assigned to them.
"RTN","ORWDBA83",12,0)
 ;DIR          Input array variable for ^DIR
"RTN","ORWDBA83",13,0)
 ;DTOUT        Timeout indicator, output variable of ^DIR
"RTN","ORWDBA83",14,0)
 ;DUOUT        Up arrow indicator, output variable of ^DIR
"RTN","ORWDBA83",15,0)
 ;OREM         Error Message, output from FIND^DIC
"RTN","ORWDBA83",16,0)
 ;ENT          Entity the parameter is assigned to, input variable for
"RTN","ORWDBA83",17,0)
 ;             ADD^XPAR
"RTN","ORWDBA83",18,0)
 ;FILE         File Number of file searched, input variable for FIND^DIC
"RTN","ORWDBA83",19,0)
 ;FLD          Field Number of fields to be returned in oputput, input
"RTN","ORWDBA83",20,0)
 ;             variable for FIND^DIC
"RTN","ORWDBA83",21,0)
 ;FLG          Flags for search method and output format, input variable
"RTN","ORWDBA83",22,0)
 ;             for FIND^DIC
"RTN","ORWDBA83",23,0)
 ;FST          First, a control variable to help build DIR(0) in MT10P
"RTN","ORWDBA83",24,0)
 ;HC           Help Count, a control variable to help build DIR("?"
"RTN","ORWDBA83",25,0)
 ;             in MT10P.
"RTN","ORWDBA83",26,0)
 ;ID           Indentifier, input variable for FIND^DIC
"RTN","ORWDBA83",27,0)
 ;IEN          Internal Entry Number, standard FileMan variable for a
"RTN","ORWDBA83",28,0)
 ;             record's internal id number. Input variable for
"RTN","ORWDBA83",29,0)
 ;             FIND^DIC. Used to build ENT.
"RTN","ORWDBA83",30,0)
 ;IND          Index, input variable for FIND^DIC
"RTN","ORWDBA83",31,0)
 ;INST         Instance indicator, input variable for ENVAL^XPAR
"RTN","ORWDBA83",32,0)
 ;IOF          Clear Screen and move cursor to top of screen, standard
"RTN","ORWDBA83",33,0)
 ;             Kernal IO variable
"RTN","ORWDBA83",34,0)
 ;NAME         Provider Name, parsed from RF output array from FIND^DIC
"RTN","ORWDBA83",35,0)
 ;NUM          Maximum number of records to return, input variable for
"RTN","ORWDBA83",36,0)
 ;             FIND^DIC
"RTN","ORWDBA83",37,0)
 ;NX0          Next group of providers prompt, used to help build DIR(0)
"RTN","ORWDBA83",38,0)
 ;NXC          Next group of providers count, used to help build DIR(0)
"RTN","ORWDBA83",39,0)
 ;NXH          Next group of providers help, used to help build DIR("?"
"RTN","ORWDBA83",40,0)
 ;PAR          The Name or IEN of a parameter in the PARAMETER DEFINITION
"RTN","ORWDBA83",41,0)
 ;             FILE, input variable for ADD^XPAR 
"RTN","ORWDBA83",42,0)
 ;RF           Records Found, the array variable with the results found
"RTN","ORWDBA83",43,0)
 ;             by FIND^DIC
"RTN","ORWDBA83",44,0)
 ;RFC          Records Found Count, The first piece of the zero node in
"RTN","ORWDBA83",45,0)
 ;             the output array from FIND^DIC with the total number
"RTN","ORWDBA83",46,0)
 ;             records returned
"RTN","ORWDBA83",47,0)
 ;ORSCR        Screen, an input variable for FIND^DIC to filter out
"RTN","ORWDBA83",48,0)
 ;             records from the search.
"RTN","ORWDBA83",49,0)
 ;SP           Selected Provider, set to the value of Y when the user
"RTN","ORWDBA83",50,0)
 ;             selects a provider from the list of providers returned
"RTN","ORWDBA83",51,0)
 ;             by FIND^DIC
"RTN","ORWDBA83",52,0)
 ;U            FileMan standard variable for data delimiter, equals "^"
"RTN","ORWDBA83",53,0)
 ;VAL          Value of the parameter being added, input variable for
"RTN","ORWDBA83",54,0)
 ;             ADD^XPAR
"RTN","ORWDBA83",55,0)
 ;X            Standard FileMan work varaible
"RTN","ORWDBA83",56,0)
 ;X1
"RTN","ORWDBA83",57,0)
 ;Y            Processed output of user selection, output variable for
"RTN","ORWDBA83",58,0)
 ;             ^DIR
"RTN","ORWDBA83",59,0)
 ;
"RTN","ORWDBA83",60,0)
 ;Global Variables
"RTN","ORWDBA83",61,0)
 ;^XTV(8989.51 PARAMETER DEFINITION FILE, file # 8989.51
"RTN","ORWDBA83",62,0)
 ;
"RTN","ORWDBA83",63,0)
 ;External References
"RTN","ORWDBA83",64,0)
 ;FIND^DIC     FileMan silent database call, returns an array of records
"RTN","ORWDBA83",65,0)
 ;             matching or partly matching a value searched on.
"RTN","ORWDBA83",66,0)
 ;^DIR         FileMan general purpose response reader
"RTN","ORWDBA83",67,0)
 ;KTG^ORWDBA8  Kills the temp globals
"RTN","ORWDBA83",68,0)
 ;LISTA^ORWDBA8
"RTN","ORWDBA83",69,0)
 ;             Builds temp global ^TMP("ORPAL", a list of providers who
"RTN","ORWDBA83",70,0)
 ;             have the Enable CIDC parameter assigned to them.
"RTN","ORWDBA83",71,0)
 ;LISTU^ORWDBA8
"RTN","ORWDBA83",72,0)
 ;             Builds temp global ^TMP("ORPUL", a list of providers who
"RTN","ORWDBA83",73,0)
 ;             do not have the Enable CIDC parameter assigned to them.
"RTN","ORWDBA83",74,0)
 ;ADD^XPAR     PARAMETER TOOLS, API to add a new parameter value
"RTN","ORWDBA83",75,0)
 ;
"RTN","ORWDBA83",76,0)
START ;Starting point of this program
"RTN","ORWDBA83",77,0)
 N CNT,DIR,DTOUT,DUOUT,OREM,ENT,FILE,FLD,FLG,FST,HC,ID,IEN,IND,INST,NAME
"RTN","ORWDBA83",78,0)
 N NUM,NX0,NXC,NXH,PAR,RF,RFC,ORSCR,SP,VAL,X,X1,Y
"RTN","ORWDBA83",79,0)
 ;Ask user for provider
"RTN","ORWDBA83",80,0)
 S DIR(0)=$P($T(FT0),";",3)
"RTN","ORWDBA83",81,0)
 S DIR("A")=$P($T(FA),";",3)
"RTN","ORWDBA83",82,0)
 S DIR("?",1)=$P($T(FH1),";",3)
"RTN","ORWDBA83",83,0)
 S DIR("?",2)=$P($T(FH2),";",3)
"RTN","ORWDBA83",84,0)
 S DIR("?",3)=$P($T(FH3),";",3)
"RTN","ORWDBA83",85,0)
 S DIR("?")=$P($T(FH4),";",3)
"RTN","ORWDBA83",86,0)
 D SCRHDR,^DIR
"RTN","ORWDBA83",87,0)
 ;Process user entry, search for provider
"RTN","ORWDBA83",88,0)
 I Y=""!($D(DTOUT))!($D(DUOUT)) G EXIT
"RTN","ORWDBA83",89,0)
 S FILE=200,FLD="@;.01",FLG="CP",(ID,IEN,IND,SP)="",NUM="*",VAL=Y
"RTN","ORWDBA83",90,0)
 S ORSCR="I $D(^XUSEC(""PROVIDER"",Y)"
"RTN","ORWDBA83",91,0)
 S ORSCR("S")="I $D(^TMP(""ORPUL"",$J,""A"",Y))=1"
"RTN","ORWDBA83",92,0)
 D FIND^DIC(FILE,IEN,FLD,FLG,VAL,NUM,IND,.ORSCR,ID,"RF","OREM")
"RTN","ORWDBA83",93,0)
 S RFC=$P(RF("DILIST",0),U)
"RTN","ORWDBA83",94,0)
 ;No matchs found alert user
"RTN","ORWDBA83",95,0)
 I RFC=0 D ALERT G START
"RTN","ORWDBA83",96,0)
 ;Single match found skip to parameter assign
"RTN","ORWDBA83",97,0)
 I RFC=1 S SP=RFC D ASSIGN G START
"RTN","ORWDBA83",98,0)
 ;10 or less matchs found, present for user selection
"RTN","ORWDBA83",99,0)
 I RFC<10!(RFC=10) D LTE10P
"RTN","ORWDBA83",100,0)
 ;More than 10 matchs found, present for user selection
"RTN","ORWDBA83",101,0)
 I RFC>10 S FST=1 D MT10P
"RTN","ORWDBA83",102,0)
 ;Process user selection from LTE10P or MT10P
"RTN","ORWDBA83",103,0)
 I SP="Q" G EXIT
"RTN","ORWDBA83",104,0)
 I SP="" D KILLVAR G START
"RTN","ORWDBA83",105,0)
 D ASSIGN G START
"RTN","ORWDBA83",106,0)
EXIT ;Exit point for this program
"RTN","ORWDBA83",107,0)
 Q
"RTN","ORWDBA83",108,0)
ALERT ;Alert the user that the selection returned no records.
"RTN","ORWDBA83",109,0)
 K DIR,X1
"RTN","ORWDBA83",110,0)
 S DIR(0)="E",X1=""
"RTN","ORWDBA83",111,0)
 S DIR("A",1)=$P($T(UA1),";",3)_" "_VAL_"."
"RTN","ORWDBA83",112,0)
 F X=2:1:5 S X1="UA"_X,DIR("A",X)=$P($T(@X1),";",3)
"RTN","ORWDBA83",113,0)
 S DIR("A")=$P($T(UA6),";",3)
"RTN","ORWDBA83",114,0)
 D SCRHDR,^DIR
"RTN","ORWDBA83",115,0)
 D KILLVAR
"RTN","ORWDBA83",116,0)
 Q
"RTN","ORWDBA83",117,0)
ASSIGN ;Assign the parameter and enable/disable CIDC functionality
"RTN","ORWDBA83",118,0)
 S IEN=$P(RF("DILIST",SP,0),U),NAME=$P(RF("DILIST",SP,0),U,2)
"RTN","ORWDBA83",119,0)
 S DIR(0)=$P($T(SCO),";",3)_$P($T(PE),";",3)_";"_$P($T(PD),";",3)
"RTN","ORWDBA83",120,0)
 S DIR("A")=$P($T(PA),";",3)
"RTN","ORWDBA83",121,0)
 S DIR("?",1)=$P($T(PHE),";",3),DIR("?")=$P($T(PHE),";",3)
"RTN","ORWDBA83",122,0)
 D SCRHDR
"RTN","ORWDBA83",123,0)
 W !!,$P($T(M1),";",3)," ",NAME," ",$P($T(M2),";",3),!,$P($T(M3),";",3)
"RTN","ORWDBA83",124,0)
 D ^DIR
"RTN","ORWDBA83",125,0)
 I Y=""!($D(DTOUT))!($D(DUOUT)) Q
"RTN","ORWDBA83",126,0)
 S VAL=$S(Y="E":1,1:0),ENT=IEN_";VA(200,",INST=1,OREM=""
"RTN","ORWDBA83",127,0)
 S PAR=$QS($Q(^XTV(8989.51,"B","OR BILLING AWARENESS BY USER")),4)
"RTN","ORWDBA83",128,0)
 D ADD^XPAR(ENT,PAR,INST,VAL,.OREM)
"RTN","ORWDBA83",129,0)
 D KILLVAR,KTG,LISTA,LISTU
"RTN","ORWDBA83",130,0)
 Q
"RTN","ORWDBA83",131,0)
LTE10P ;If search returned a list less then or equal to 10
"RTN","ORWDBA83",132,0)
 D SETDIR
"RTN","ORWDBA83",133,0)
 F X=1:1:RFC  S DIR(0)=DIR(0)_X_":"_$P(RF("DILIST",X,0),U,2)_";"
"RTN","ORWDBA83",134,0)
 D SCRHDR,^DIR
"RTN","ORWDBA83",135,0)
 I $D(DTOUT)!($D(DUOUT)) S SP="Q"
"RTN","ORWDBA83",136,0)
 E  S SP=Y
"RTN","ORWDBA83",137,0)
 Q
"RTN","ORWDBA83",138,0)
MT10P ;If search returned more then 10 providers
"RTN","ORWDBA83",139,0)
 D SETDIR
"RTN","ORWDBA83",140,0)
 S CNT=0,HC=1,(NXC,NX0,NXH,SP,X,Y)=""
"RTN","ORWDBA83",141,0)
 F X=FST:1:10+(FST-1) Q:$D(RF("DILIST",X,0))=0  D
"RTN","ORWDBA83",142,0)
 . S CNT=CNT+1
"RTN","ORWDBA83",143,0)
 . S DIR(0)=DIR(0)_X_":"_$P(RF("DILIST",X,0),U,2)_";"
"RTN","ORWDBA83",144,0)
 S NXC=RFC-X,NXC=$S(NXC>10:10,1:NXC)
"RTN","ORWDBA83",145,0)
 S NX0=$P($P($T(D0N),";",3),"|",1)_NXC_$P($P($T(D0N),";",3),"|",2)
"RTN","ORWDBA83",146,0)
 S NXH=$P($P($T(DHN),";",3),"|",1)_NXC_$P($P($T(DHN),";",3),"|",2)
"RTN","ORWDBA83",147,0)
 S:CNT=10 DIR(0)=DIR(0)_";"_NX0
"RTN","ORWDBA83",148,0)
 S:FST>10 DIR(0)=DIR(0)_";"_$P($T(D0P),";",3)
"RTN","ORWDBA83",149,0)
 S:CNT=10 HC=HC+1,DIR("?",HC)=NXH
"RTN","ORWDBA83",150,0)
 S:FST>10 HC=HC+1,DIR("?",HC)=$P($T(DHP),";",3)
"RTN","ORWDBA83",151,0)
 D SCRHDR,^DIR
"RTN","ORWDBA83",152,0)
 I $D(DTOUT)!($D(DUOUT)) S SP="Q" Q
"RTN","ORWDBA83",153,0)
 I Y="N"!(Y="P") S FST=$S(Y="N":FST+10,1:FST-10) G MT10P
"RTN","ORWDBA83",154,0)
 S SP=Y Q
"RTN","ORWDBA83",155,0)
 ;
"RTN","ORWDBA83",156,0)
SETDIR ;Set common values for DIR used by LTE10P and MT10P 
"RTN","ORWDBA83",157,0)
 K DIR
"RTN","ORWDBA83",158,0)
 S DIR(0)=$P($T(SCO),";",3)
"RTN","ORWDBA83",159,0)
 S DIR("?",1)=$P($T(DH),";",3)
"RTN","ORWDBA83",160,0)
 S DIR("?")=$P($T(DHS),";",3)
"RTN","ORWDBA83",161,0)
 S DIR("A")=$P($T(DA),";",3)
"RTN","ORWDBA83",162,0)
 Q
"RTN","ORWDBA83",163,0)
SCRHDR ;Screen Header
"RTN","ORWDBA83",164,0)
 W:$D(IOF) @IOF
"RTN","ORWDBA83",165,0)
 W !,$P($T(SH1),";",3),!,$P($T(SH2),";",3),!
"RTN","ORWDBA83",166,0)
 Q
"RTN","ORWDBA83",167,0)
KILLVAR ;Kill variables to prepare for next look up
"RTN","ORWDBA83",168,0)
 K DIR,DTOUT,DUOUT,OREM,ENT,FILE,FLD,FLG,ID,IEN,IND,INST,NAME,NUM,NXC,NX0
"RTN","ORWDBA83",169,0)
 K NXH,RF,RFC,ORSCR,SP,VAL,X,X1,Y
"RTN","ORWDBA83",170,0)
 Q
"RTN","ORWDBA83",171,0)
KTG ;Kill the temp globals used by this program
"RTN","ORWDBA83",172,0)
 K ^TMP("ORPAL",$J),^TMP("ORPUL",$J) Q
"RTN","ORWDBA83",173,0)
LISTA ;Build a list of providers with the parameter already assigned to them.
"RTN","ORWDBA83",174,0)
 N ORERR,GBL,IEN,INST,LIST,PAR,X
"RTN","ORWDBA83",175,0)
 S LIST="^TMP(""ORPAL"",$J,""A"")",(INST,GBL)=1,ORERR=""
"RTN","ORWDBA83",176,0)
 S PAR=$QS($Q(^XTV(8989.51,"B","OR BILLING AWARENESS BY USER")),4)
"RTN","ORWDBA83",177,0)
 D ENVAL^XPAR(LIST,PAR,INST,.ORERR,GBL)
"RTN","ORWDBA83",178,0)
 S (IEN,X)="" F  S X=$O(^TMP("ORPAL",$J,"A",X)) Q:X=""  D
"RTN","ORWDBA83",179,0)
 . S IEN=$P(X,";"),^TMP("ORPAL",$J,"B",IEN)=""
"RTN","ORWDBA83",180,0)
 Q
"RTN","ORWDBA83",181,0)
LISTU ;Build a list of providers who have not been assigned the parameter
"RTN","ORWDBA83",182,0)
 N CNT,IEN
"RTN","ORWDBA83",183,0)
 S IEN="",CNT=0,^TMP("ORPUL",$J,"A")=CNT
"RTN","ORWDBA83",184,0)
 F  S IEN=$O(^XUSEC("PROVIDER",IEN)) Q:IEN=""  D
"RTN","ORWDBA83",185,0)
 . I $D(^TMP("ORPAL",$J,"A",IEN_";VA(200,",1))=1 Q
"RTN","ORWDBA83",186,0)
 . S CNT=CNT+1,^TMP("ORPUL",$J,"A")=CNT
"RTN","ORWDBA83",187,0)
 . S ^TMP("ORPUL",$J,"A",IEN)=IEN_";VA(200,"
"RTN","ORWDBA83",188,0)
 Q
"RTN","ORWDBA83",189,0)
 ;;Text used to build options, user messages, and help
"RTN","ORWDBA83",190,0)
FT0 ;;FO^1:40
"RTN","ORWDBA83",191,0)
FA ;;Select the provider to assign the parameter
"RTN","ORWDBA83",192,0)
FH1 ;;Enter the name/partial name of the provider to assign the parameter.
"RTN","ORWDBA83",193,0)
FH2 ;;This is free text, 1 to 40 characters in length.
"RTN","ORWDBA83",194,0)
FH3 ;;This search will only return those with the PROVIDER key and who
"RTN","ORWDBA83",195,0)
FH4 ;;do not have the CIDC parameter assigned to them. 
"RTN","ORWDBA83",196,0)
SCO ;;SO^
"RTN","ORWDBA83",197,0)
SH1 ;;Enable Clinical Indicator Data Capture By Provider Parameter Management
"RTN","ORWDBA83",198,0)
SH2 ;;Assign and Enable/Disable Parameter By Individual Provider Option
"RTN","ORWDBA83",199,0)
UA1 ;;Found no records matching the search criteria of
"RTN","ORWDBA83",200,0)
UA2 ;;The reasons for this could be that during the search:
"RTN","ORWDBA83",201,0)
UA3 ;;   1. The parameter is already assigned to any provider found.
"RTN","ORWDBA83",202,0)
UA4 ;;   2. No providers found.
"RTN","ORWDBA83",203,0)
UA5 ;;   3. No records found.
"RTN","ORWDBA83",204,0)
UA6 ;;Please try again
"RTN","ORWDBA83",205,0)
M1 ;;You have selected
"RTN","ORWDBA83",206,0)
M2 ;;to assign the Enable Clinical Indicator Data
"RTN","ORWDBA83",207,0)
M3 ;;Capture By Provider parameter to.
"RTN","ORWDBA83",208,0)
PE ;;E:Assign parameter and Enable CIDC for this provider
"RTN","ORWDBA83",209,0)
PD ;;D:Assign parameter and Disable CIDC for this provider
"RTN","ORWDBA83",210,0)
PA ;;Assign the parameter to this provider
"RTN","ORWDBA83",211,0)
PHE ;;Enter E to assign the parameter and enable CIDC for this provider.
"RTN","ORWDBA83",212,0)
PHD ;;Enter D to assign the parameter and disable CIDC for this provider.
"RTN","ORWDBA83",213,0)
D0N ;;N:Next | providers
"RTN","ORWDBA83",214,0)
D0P ;;P:Previous 10 providers
"RTN","ORWDBA83",215,0)
DH ;;Select the provider who the parameter will be assigned to.
"RTN","ORWDBA83",216,0)
DHN ;;Enter N to get the next | providers.
"RTN","ORWDBA83",217,0)
DHP ;;Enter P to get the previous 10 providers.
"RTN","ORWDBA83",218,0)
DHS ;;Enter "^" to exit or the Enter key to return to provider lookup.
"RTN","ORWDBA83",219,0)
DA ;;Select the provider to assign the parameter
"RTN","ORWDPS2")
0^89^B61320975
"RTN","ORWDPS2",1,0)
ORWDPS2 ; SLC/KCM/JLI - Pharmacy Calls for Windows Dialog ;12/9/04  12:02
"RTN","ORWDPS2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,116,125,131,132,148,141,195**;Dec 17, 1997
"RTN","ORWDPS2",3,0)
 ;
"RTN","ORWDPS2",4,0)
OISLCT(LST,OI,PSTYPE,ORVP,NEEDPI,PKIACTIV) ; return for defaults for pharmacy orderable item
"RTN","ORWDPS2",5,0)
 N ILST,ORDOSE,ORWPSOI,ORWDOSES,X1,X2
"RTN","ORWDPS2",6,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS2",7,0)
 S ILST=0
"RTN","ORWDPS2",8,0)
 S ORWPSOI=0
"RTN","ORWDPS2",9,0)
 S:+OI ORWPSOI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS2",10,0)
 D START^PSSJORDF(ORWPSOI,$S(PSTYPE="U":"I",1:"O")) ; dflt route, schedule, etc.
"RTN","ORWDPS2",11,0)
 I '$L($T(DOSE^PSSOPKI1)) D DOSE^PSSORUTL(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses
"RTN","ORWDPS2",12,0)
 I $L($T(DOSE^PSSOPKI1)) D DOSE^PSSOPKI1(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses NEW PKI CODE from pharmacy
"RTN","ORWDPS2",13,0)
 D EN^PSSDIN(ORWPSOI)                               ; nfi text
"RTN","ORWDPS2",14,0)
 S ILST=ILST+1,LST(ILST)="~Medication"
"RTN","ORWDPS2",15,0)
 S ILST=ILST+1,LST(ILST)="d"_OI_U_$S(+OI:$P(^ORD(101.43,OI,0),U),1:"")
"RTN","ORWDPS2",16,0)
 S ILST=ILST+1,LST(ILST)="~Verb"
"RTN","ORWDPS2",17,0)
 S ILST=ILST+1,LST(ILST)="d"_$P($G(ORDOSE("MISC")),U)
"RTN","ORWDPS2",18,0)
 S ILST=ILST+1,LST(ILST)="~Preposition"
"RTN","ORWDPS2",19,0)
 S ILST=ILST+1,LST(ILST)="d"_$P($G(ORDOSE("MISC")),U,2)
"RTN","ORWDPS2",20,0)
 I $D(NEEDPI),(NEEDPI="Y") S ILST=ILST+1,LST(ILST)="~PtInstr" D PTINSTR
"RTN","ORWDPS2",21,0)
 ;S:NEEDPI="Y" ILST=ILST+1,LST(ILST)="~PtInstr"   D PTINSTR
"RTN","ORWDPS2",22,0)
 S ILST=ILST+1,LST(ILST)="~AllDoses"  D ALLDOSE ; must do before DOSAGE
"RTN","ORWDPS2",23,0)
 S ILST=ILST+1,LST(ILST)="~Dosage"    D DOSAGE
"RTN","ORWDPS2",24,0)
 S ILST=ILST+1,LST(ILST)="~Dispense"  D DISPLST
"RTN","ORWDPS2",25,0)
 S ILST=ILST+1,LST(ILST)="~Route"     D ROUTE
"RTN","ORWDPS2",26,0)
 S ILST=ILST+1,LST(ILST)="~Schedule"  D SCHED
"RTN","ORWDPS2",27,0)
 S ILST=ILST+1,LST(ILST)="~Guideline" D GUIDE
"RTN","ORWDPS2",28,0)
 S ILST=ILST+1,LST(ILST)="~Message"   D OIMSG
"RTN","ORWDPS2",29,0)
 S ILST=ILST+1,LST(ILST)="~DEASchedule" ;PKI
"RTN","ORWDPS2",30,0)
 ;S ILST=ILST+1,LST(ILST)="d"_$P($G(ORDOSE("DEA")),U) ;PKI
"RTN","ORWDPS2",31,0)
 S ILST=ILST+1,LST(ILST)="d" ;PKI
"RTN","ORWDPS2",32,0)
 I $D(ORDOSE("DEA")) S X="",X1=$P(ORDOSE("DEA"),";"),X2=$P(ORDOSE("DEA"),";",2) D
"RTN","ORWDPS2",33,0)
 . I '$L(X2) Q
"RTN","ORWDPS2",34,0)
 . I $G(PKIACTIV)="Y" S X=X2
"RTN","ORWDPS2",35,0)
 S LST(ILST)=LST(ILST)_X
"RTN","ORWDPS2",36,0)
 I PSTYPE="U" D
"RTN","ORWDPS2",37,0)
 . ; start, expires, next admin
"RTN","ORWDPS2",38,0)
 I PSTYPE="O" D
"RTN","ORWDPS2",39,0)
 . ; days supply, quantity, refills
"RTN","ORWDPS2",40,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS2",41,0)
 Q
"RTN","ORWDPS2",42,0)
 ;
"RTN","ORWDPS2",43,0)
PTINSTR ; from OISLCT, set up patient instructions
"RTN","ORWDPS2",44,0)
 N I
"RTN","ORWDPS2",45,0)
 S I=0 F  S I=$O(ORDOSE("PI",I)) Q:I'>0  S ILST=ILST+1,LST(ILST)="t"_ORDOSE("PI",I)
"RTN","ORWDPS2",46,0)
 Q
"RTN","ORWDPS2",47,0)
DOSAGE ; from OISLCT, set up the list of dosages
"RTN","ORWDPS2",48,0)
 ; LST(n)=iDrugName^Strength^NF^... (see BLDDOSE)
"RTN","ORWDPS2",49,0)
 ; must be called after ALLDOSE so ORWDOSES is set up
"RTN","ORWDPS2",50,0)
 N I
"RTN","ORWDPS2",51,0)
 S I=0 F  S I=$O(ORWDOSES(I)) Q:I'>0  S ILST=ILST+1,LST(ILST)=ORWDOSES(I)
"RTN","ORWDPS2",52,0)
 Q
"RTN","ORWDPS2",53,0)
DISPLST ; from OISLCT, set up list of dispense drugs
"RTN","ORWDPS2",54,0)
 ; DrugIEN^Strength^Units^Name^Split
"RTN","ORWDPS2",55,0)
 N DD
"RTN","ORWDPS2",56,0)
 S DD=0 F  S DD=$O(ORDOSE("DD",DD)) Q:'DD  D
"RTN","ORWDPS2",57,0)
 . S ILST=ILST+1
"RTN","ORWDPS2",58,0)
 . S LST(ILST)="i"_DD_U_$P(ORDOSE("DD",DD),U,5,6)_U_$P(ORDOSE("DD",DD),U)_U_$P(ORDOSE("DD",DD),U,11)
"RTN","ORWDPS2",59,0)
 Q
"RTN","ORWDPS2",60,0)
ALLDOSE ; from OISLCT, set up a list of all possible doses
"RTN","ORWDPS2",61,0)
 ; LST(n)=iDrugName^Strength^NF^... (see BLDDOSE)
"RTN","ORWDPS2",62,0)
 N I,J,CONJ,DD,DRUG,DDNM,LDOSE,TEXT,STREN,UD,COST,NF,ID,X
"RTN","ORWDPS2",63,0)
 S CONJ=$P($G(ORDOSE("MISC")),U,3),ORWDOSES=0
"RTN","ORWDPS2",64,0)
 S:$L(CONJ) CONJ=" "_CONJ_" " S:'$L(CONJ) CONJ=" "
"RTN","ORWDPS2",65,0)
 S I=0 F  S I=$O(ORDOSE(I)) Q:I'>0  D
"RTN","ORWDPS2",66,0)
 . S X=$$BLDDOSE(ORDOSE(I))
"RTN","ORWDPS2",67,0)
 . S ORWDOSES=ORWDOSES+1,ORWDOSES(ORWDOSES)=X
"RTN","ORWDPS2",68,0)
 . S ILST=ILST+1
"RTN","ORWDPS2",69,0)
 . S LST(ILST)="i"_$P(X,U,5)_U_$P($P(X,U,4),"&",6)_U_$P(X,U,4)
"RTN","ORWDPS2",70,0)
 . S J=0 F  S J=$O(ORDOSE(I,J)) Q:J'>0  D
"RTN","ORWDPS2",71,0)
 . . S X=$$BLDDOSE(ORDOSE(I,J))
"RTN","ORWDPS2",72,0)
 . . S ILST=ILST+1
"RTN","ORWDPS2",73,0)
 . . S LST(ILST)="i"_$P(X,U,5)_U_$P($P(X,U,4),"&",6)_U_$P(X,U,4)
"RTN","ORWDPS2",74,0)
 Q
"RTN","ORWDPS2",75,0)
BLDDOSE(X)  ; build dose info where X is ORDOSE node
"RTN","ORWDPS2",76,0)
 ; from ALLDOSE
"RTN","ORWDPS2",77,0)
 ;    X=TotalDose^Units^U/D^Noun^LocalDose^DispDrugIEN
"RTN","ORWDPS2",78,0)
 ;    Y=iDrugName^Strength^NF^TDose&Units&U/D&Noun&LDose&Drug&Stren&Units^
"RTN","ORWDPS2",79,0)
 ;      DoseText^CostText^MaxRefills^DispUnits^CanSplit
"RTN","ORWDPS2",80,0)
 ; DRUG=Name^Cost^NF^DispUnit^Strength^Units^DoseForm^MaxRefills^
"RTN","ORWDPS2",81,0)
 ; No TotalDose,           use LocalDose
"RTN","ORWDPS2",82,0)
 ; TotalDose & Strength,   use LocalDose+Conjunction+Strength+Units
"RTN","ORWDPS2",83,0)
 ; TotalDose, No Strength, use LocalDose+Conjunction+DispenseName
"RTN","ORWDPS2",84,0)
 S DD=+$P(X,U,6),DRUG=ORDOSE("DD",DD),DDNM=$P(DRUG,U),ID=$P(X,U,1,6)
"RTN","ORWDPS2",85,0)
 S LDOSE=$P(X,U,5),TEXT=LDOSE,STREN=$P(DRUG,U,5)_$P(DRUG,U,6)
"RTN","ORWDPS2",86,0)
 S $P(ID,U,7)=$P(DRUG,U,5) S $P(ID,U,8)=$P(DRUG,U,6) ; add strength
"RTN","ORWDPS2",87,0)
 I '$L($P(X,U)),$L($P(DRUG,U,5))  S TEXT=TEXT_CONJ_STREN
"RTN","ORWDPS2",88,0)
 I '$L($P(X,U)),'$L($P(DRUG,U,5)) S TEXT=TEXT_CONJ_$P(DRUG,U)
"RTN","ORWDPS2",89,0)
 S UD=$P(X,U,3),COST=$P(X,U,7),NF=$S($P(DRUG,U,3):"NF",1:"")
"RTN","ORWDPS2",90,0)
 ;I UD S COST="$"_$J(UD*$P(DRUG,U,2),1,3) ;_" per "_UD_" "_$P(X,U,4)
"RTN","ORWDPS2",91,0)
 S Y="i"_DDNM_U_STREN_U_NF_U_$TR(ID,U,"&")_U_TEXT_U_COST_U_$P(DRUG,U,8)_U_$P(DRUG,U,4)
"RTN","ORWDPS2",92,0)
 Q Y
"RTN","ORWDPS2",93,0)
ROUTE ; from OISLCT, get list of routes for the drug form
"RTN","ORWDPS2",94,0)
 ; ** NEED BOTH ABBREVIATION & NAME IN LIST BOX
"RTN","ORWDPS2",95,0)
 N I,CNT,ABBR,IEN,ROUT,EXP,X
"RTN","ORWDPS2",96,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS2",97,0)
 . S X=^TMP("PSJMR",$J,I)
"RTN","ORWDPS2",98,0)
 . S ROUT=$P(X,U),ABBR=$P(X,U,2),IEN=$P(X,U,3),EXP=$P(X,U,4)
"RTN","ORWDPS2",99,0)
 . S ILST=ILST+1,LST(ILST)="i"_IEN_U_ROUT_U_ABBR_U_EXP_U_$P(X,U,5)
"RTN","ORWDPS2",100,0)
 . I I=1,IEN S ILST=ILST+1,LST(ILST)="d"_IEN_U_ROUT ;_U_ABBR ; assume first always default
"RTN","ORWDPS2",101,0)
 ; add abbreviations to list of routes, commented out for 15.5 on
"RTN","ORWDPS2",102,0)
 ; S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS2",103,0)
 ; . S X=^TMP("PSJMR",$J,I)
"RTN","ORWDPS2",104,0)
 ; . S ROUT=$P(X,U),ABBR=$P(X,U,2),IEN=$P(X,U,3),EXP=$P(X,U,4)
"RTN","ORWDPS2",105,0)
 ; . I $L(ABBR),(ABBR'=ROUT) S ILST=ILST+1,LST(ILST)="i"_IEN_U_ABBR_" ("_ROUT_")"_U_ABBR_U_EXP
"RTN","ORWDPS2",106,0)
 Q
"RTN","ORWDPS2",107,0)
SCHED ; from OISLCT, get default schedule for this medication
"RTN","ORWDPS2",108,0)
 I $L($G(^TMP("PSJSCH",$J))) S ILST=ILST+1,LST(ILST)="d"_^($J)
"RTN","ORWDPS2",109,0)
 Q
"RTN","ORWDPS2",110,0)
GUIDE ; from OISLCT, get guidelines associated with this medication
"RTN","ORWDPS2",111,0)
 N IEN,I
"RTN","ORWDPS2",112,0)
 S IEN=0 F  S IEN=$O(^TMP("PSSDIN",$J,"OI",ORWPSOI,IEN)) Q:'IEN  D
"RTN","ORWDPS2",113,0)
 . S I=0 F  S I=$O(^TMP("PSSDIN",$J,"OI",ORWPSOI,IEN,I)) Q:'I  D
"RTN","ORWDPS2",114,0)
 . . S ILST=ILST+1,LST(ILST)="t"_^TMP("PSSDIN",$J,"OI",ORWPSOI,IEN,I)
"RTN","ORWDPS2",115,0)
 Q
"RTN","ORWDPS2",116,0)
OIMSG ; from OISLCT, get the orderable item message for this medication
"RTN","ORWDPS2",117,0)
 S I=0 F  S I=$O(^ORD(101.43,OI,8,I)) Q:I'>0  S ILST=ILST+1,LST(ILST)="t"_^(I,0)
"RTN","ORWDPS2",118,0)
 Q
"RTN","ORWDPS2",119,0)
ADMIN(REC,DFN,SCH,OI,LOC)       ; return administration time info
"RTN","ORWDPS2",120,0)
 ; REC: StartText^StartTime^Duration^FirstAdmin
"RTN","ORWDPS2",121,0)
 S OI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS2",122,0)
 S LOC=+$G(^SC(LOC,42)),REC=""
"RTN","ORWDPS2",123,0)
 I $L($G(^DPT(DFN,.1))) S REC=$$FIRST^ORCDPS3(DFN,LOC,OI,SCH)
"RTN","ORWDPS2",124,0)
 Q
"RTN","ORWDPS2",125,0)
REQST(VAL,DFN,SCH,OI,LOC,TXT)   ; return requested start time
"RTN","ORWDPS2",126,0)
 ; VAL: FirstAdmin time
"RTN","ORWDPS2",127,0)
 S VAL=""
"RTN","ORWDPS2",128,0)
 Q:'$L($G(SCH))  Q:'$G(OI)
"RTN","ORWDPS2",129,0)
 S OI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS2",130,0)
 S LOC=+$G(^SC(LOC,42))
"RTN","ORWDPS2",131,0)
 S VAL=$P($$RESOLVE^PSJORPOE(DFN,SCH,OI,TXT,LOC),U,2)
"RTN","ORWDPS2",132,0)
 Q
"RTN","ORWDPS2",133,0)
DAY2QTY(VAL,DAY,UPD,SCH,DUR,PAT,DRG)        ; return qty for days supply
"RTN","ORWDPS2",134,0)
 ; VAL: quantity
"RTN","ORWDPS2",135,0)
 N ORWX,I,X,ADUR,ADURNM
"RTN","ORWDPS2",136,0)
 S ORWX("DAYS SUPPLY")=DAY
"RTN","ORWDPS2",137,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS2",138,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORWDPS2",139,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORWDPS2",140,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORWDPS2",141,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORWDPS2",142,0)
 . S ADUR=$P(DUR,U,I),ADURNM=$P($P(ADUR," ",2),"~")
"RTN","ORWDPS2",143,0)
 . S:ADURNM="MONTHS" X=+ADUR_"L"
"RTN","ORWDPS2",144,0)
 . S:ADURNM'="MONTHS" X=+ADUR_$E($P(ADUR," ",2))
"RTN","ORWDPS2",145,0)
 . I $L(X) S ORWX("DURATION",I)=X
"RTN","ORWDPS2",146,0)
 . S X=$E($P(ADUR,"~",2))
"RTN","ORWDPS2",147,0)
 . I $L(X) S ORWX("CONJUNCTION",I)=X
"RTN","ORWDPS2",148,0)
 D QTYX^PSOSIG(.ORWX)
"RTN","ORWDPS2",149,0)
 S VAL=$G(ORWX("QTY"))
"RTN","ORWDPS2",150,0)
 Q
"RTN","ORWDPS2",151,0)
QTY2DAY(VAL,QTY,UPD,SCH,DUR,PAT,DRG)        ; return days supply given quantity
"RTN","ORWDPS2",152,0)
 ; VAL: days supply
"RTN","ORWDPS2",153,0)
 N ORWX,I,X,ADUR
"RTN","ORWDPS2",154,0)
 S ORWX("QTY")=QTY
"RTN","ORWDPS2",155,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS2",156,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORWDPS2",157,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORWDPS2",158,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORWDPS2",159,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORWDPS2",160,0)
 . S ADUR=$P(DUR,U,I),X=+ADUR_$E($P(ADUR," ",2))
"RTN","ORWDPS2",161,0)
 . I $L(X) S ORWX("DURATION",I)=X
"RTN","ORWDPS2",162,0)
 . S X=$E($P(ADUR,"~",2))
"RTN","ORWDPS2",163,0)
 . I $L(X) S ORWX("CONJUNCTION",I)=X
"RTN","ORWDPS2",164,0)
 D QTYX^PSOSIG(.ORWX)
"RTN","ORWDPS2",165,0)
 S VAL=$G(ORWX("DAYS SUPPLY"))
"RTN","ORWDPS2",166,0)
 Q
"RTN","ORWDPS2",167,0)
MAXREF(VAL,PAT,DRG,SUP,OI,OUT)      ; return the maximum number of refills
"RTN","ORWDPS2",168,0)
 ; PAT=Patient DFN, DRG=ptr50, SUP=days supply, OI=orderable item
"RTN","ORWDPS2",169,0)
 ; VAL: maximum refills allowed
"RTN","ORWDPS2",170,0)
 N ORWX
"RTN","ORWDPS2",171,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS2",172,0)
 I $G(DRG) S ORWX("DRUG")=+DRG
"RTN","ORWDPS2",173,0)
 I $G(SUP) S ORWX("DAYS SUPPLY")=SUP
"RTN","ORWDPS2",174,0)
 I $G(OI)  S ORWX("ITEM")=+$P(^ORD(101.43,+OI,0),U,2)
"RTN","ORWDPS2",175,0)
 I $G(OUT) S ORWX("DISCHARGE")=1
"RTN","ORWDPS2",176,0)
 D MAX^PSOSIGDS(.ORWX)
"RTN","ORWDPS2",177,0)
 S VAL=$G(ORWX("MAX"))
"RTN","ORWDPS2",178,0)
 Q
"RTN","ORWDPS2",179,0)
SCHREQ(VAL,OI,RTE,DRG)  ; return 1 if schedule is required
"RTN","ORWDPS2",180,0)
 ; OI=orderable item, RTE=ptr route, DRG=ptr dispense drug
"RTN","ORWDPS2",181,0)
 S VAL=1
"RTN","ORWDPS2",182,0)
 Q:'$G(OI)  Q:'$G(RTE)
"RTN","ORWDPS2",183,0)
 S VAL=$$SCHREQ^PSJORPOE(RTE,OI,+$G(DRG))
"RTN","ORWDPS2",184,0)
 Q
"RTN","ORWDPS2",185,0)
CHKPI(VAL,ODIFN) ; return pre-existing patient instruct
"RTN","ORWDPS2",186,0)
 N IDNUM,IDPI
"RTN","ORWDPS2",187,0)
 S (IDNUM,IDPI)=0,VAL=""
"RTN","ORWDPS2",188,0)
 I '$D(^OR(100,ODIFN,4.5,"ID","PI")) S VAL="" Q
"RTN","ORWDPS2",189,0)
 F  S IDNUM=$O(^OR(100,ODIFN,4.5,"ID","PI",IDNUM)) Q:'IDNUM  D
"RTN","ORWDPS2",190,0)
 . F  S IDPI=$O(^OR(100,ODIFN,4.5,IDNUM,2,IDPI)) Q:'IDPI  D
"RTN","ORWDPS2",191,0)
 .. S VAL=VAL_^OR(100,ODIFN,4.5,IDNUM,2,IDPI,0)
"RTN","ORWDPS2",192,0)
 K IDNUM,IDPI
"RTN","ORWDPS2",193,0)
 Q
"RTN","ORWDPS2",194,0)
CHKGRP(VAL,ORIFN) ;
"RTN","ORWDPS2",195,0)
 ;Inpatient Med Order Group or Clin Meds Group: return 1
"RTN","ORWDPS2",196,0)
 ;If order belong to Outpatient Med Order Grpoup: return 2 
"RTN","ORWDPS2",197,0)
 ;Otherwise, return 0
"RTN","ORWDPS2",198,0)
 S VAL=0
"RTN","ORWDPS2",199,0)
 I '$L(ORIFN) Q
"RTN","ORWDPS2",200,0)
 N UDGRP,IPGRP,OPGRP,ODGRP,ODID,CLMED
"RTN","ORWDPS2",201,0)
 S ODID=+ORIFN
"RTN","ORWDPS2",202,0)
 Q:ODID<1
"RTN","ORWDPS2",203,0)
 S (UDGRP,IPGRP,OPGRP,ODGRP,CLMED)=0
"RTN","ORWDPS2",204,0)
 S UDGRP=$O(^ORD(100.98,"B","UD RX",UDGRP))
"RTN","ORWDPS2",205,0)
 S OPGRP=$O(^ORD(100.98,"B","OUTPATIENT MEDICATIONS",OPGRP))
"RTN","ORWDPS2",206,0)
 S IPGRP=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",IPGRP))
"RTN","ORWDPS2",207,0)
 S CLMED=$O(^ORD(100.98,"B","CLINIC MEDICATIONS",CLMED))
"RTN","ORWDPS2",208,0)
 S:IPGRP=0 IPGRP=$O(^ORD(100.98,"B","I RX",IPGRP))
"RTN","ORWDPS2",209,0)
 I $L($G(^OR(100,ODID,0)))<1 Q
"RTN","ORWDPS2",210,0)
 S ODGRP=$P(^OR(100,ODID,0),U,11)
"RTN","ORWDPS2",211,0)
 I (UDGRP=ODGRP)!(CLMED=ODGRP) S VAL=1
"RTN","ORWDPS2",212,0)
 I IPGRP=ODGRP S VAL=1
"RTN","ORWDPS2",213,0)
 I OPGRP=ODGRP S VAL=2
"RTN","ORWDPS2",214,0)
 K UDGRP,ODGRP,OPGRP,IPGRP,ODID,CLMED
"RTN","ORWDPS2",215,0)
 Q
"RTN","ORWDPS2",216,0)
QOGRP(VAL,QOIFN) ;
"RTN","ORWDPS2",217,0)
 ;If quick order belong to Inpatient Med Order Group: return 1
"RTN","ORWDPS2",218,0)
 ;Otherwise, return 0
"RTN","ORWDPS2",219,0)
 S VAL=0
"RTN","ORWDPS2",220,0)
 I '$L(QOIFN) Q
"RTN","ORWDPS2",221,0)
 N UDGRP,IPGRP,QOGRP,QOID,CLMED
"RTN","ORWDPS2",222,0)
 S QOID=+QOIFN
"RTN","ORWDPS2",223,0)
 Q:QOID<1
"RTN","ORWDPS2",224,0)
 S (UDGRP,IPGRP,QOGRP,CLMED)=0
"RTN","ORWDPS2",225,0)
 S UDGRP=$O(^ORD(100.98,"B","UD RX",UDGRP))
"RTN","ORWDPS2",226,0)
 S IPGRP=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",IPGRP))
"RTN","ORWDPS2",227,0)
 S CLMED=$O(^ORD(100.98,"B","CLINIC MEDICATIONS",CLMED))
"RTN","ORWDPS2",228,0)
 S:IPGRP=0 IPGRP=$O(^ORD(100.98,"B","I RX",IPGRP))
"RTN","ORWDPS2",229,0)
 I $L($G(^ORD(101.41,QOID,0)))<1 Q
"RTN","ORWDPS2",230,0)
 S QOGRP=$P(^ORD(101.41,QOID,0),U,5)
"RTN","ORWDPS2",231,0)
 I UDGRP=QOGRP S VAL=1
"RTN","ORWDPS2",232,0)
 I (IPGRP=QOGRP)!(CLMED=QOGRP) S VAL=1
"RTN","ORWDPS2",233,0)
 K UDGRP,QOGRP,QOID,IPGRP,CLMED
"RTN","ORWDPS2",234,0)
 Q
"RTN","ORWDPS3")
0^20^B20118443
"RTN","ORWDPS3",1,0)
ORWDPS3 ; SLC/KCM/JLI - Order Dialogs, Menus;10:42 AM  3/29/2002 4/10/02 11:00AM
"RTN","ORWDPS3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,94,116,132,187,195**;Dec 17, 1997
"RTN","ORWDPS3",3,0)
MEDXFER ; -- setup ORDIALOG for a med that is transferred (from SETUP^ORWDXM4)
"RTN","ORWDPS3",4,0)
 N IVDIALOG,OI K ^TMP("PS",$J)
"RTN","ORWDPS3",5,0)
 S IVDIALOG=$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORWDPS3",6,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","PS MEDS",0))
"RTN","ORWDPS3",7,0)
 I $P($G(^OR(100,+ORIT,0)),U,5)=IVDIALOG S ORDIALOG=IVDIALOG
"RTN","ORWDPS3",8,0)
 S ORDG=+$P(^ORD(101.41,ORDIALOG,0),U,5)
"RTN","ORWDPS3",9,0)
 D GETDLG^ORCD(ORDIALOG)
"RTN","ORWDPS3",10,0)
 D GETORDER^ORCD("^OR(100,"_+ORIT_",4.5)")
"RTN","ORWDPS3",11,0)
 S OI=$$VAL^ORCD("MEDICATION")
"RTN","ORWDPS3",12,0)
 I '$$MEDOK(OI,ORCAT) D SETERR(ORIT,"This may not be ordered as an "_$S(ORCAT="I":"in",1:"out")_"patient drug.") Q
"RTN","ORWDPS3",13,0)
 I $G(^ORD(101.43,OI,.1)),(^(.1)<$$NOW^XLFDT) D SETERR(ORIT,"This may no longer be ordered.") Q
"RTN","ORWDPS3",14,0)
 I (ORDIALOG'=IVDIALOG),(ORCAT="I") D OUT^ORCMED
"RTN","ORWDPS3",15,0)
 I (ORDIALOG'=IVDIALOG),(ORCAT="O") D IN^ORCMED
"RTN","ORWDPS3",16,0)
 S ORWPSWRG="" ; force interactive dialog for transfers
"RTN","ORWDPS3",17,0)
 Q
"RTN","ORWDPS3",18,0)
MEDOK(OI,CAT)   ; return 1 if med may be ordered for this patient category
"RTN","ORWDPS3",19,0)
 N P S P=$S(CAT="I":1,1:2)
"RTN","ORWDPS3",20,0)
 I ORIMO S P=1
"RTN","ORWDPS3",21,0)
 N THEGRP,INPTGRP
"RTN","ORWDPS3",22,0)
 S THEGRP=0
"RTN","ORWDPS3",23,0)
 I $D(ORIT),+ORIT S THEGRP=$P($G(^OR(100,+ORIT,0)),U,11)
"RTN","ORWDPS3",24,0)
 S INPTGRP=$O(^ORD(100.98,"B","UD RX",0))
"RTN","ORWDPS3",25,0)
 I P=2,(INPTGRP=THEGRP),($P($G(^ORD(101.43,+OI,"PS")),U,1)=2) Q 2
"RTN","ORWDPS3",26,0)
 E  Q $P($G(^ORD(101.43,+OI,"PS")),U,P)
"RTN","ORWDPS3",27,0)
 ;
"RTN","ORWDPS3",28,0)
SETERR(ID,X)       ; sets LST to rejection with error message
"RTN","ORWDPS3",29,0)
 D GETTXT^ORWORR(.LST,ID)
"RTN","ORWDPS3",30,0)
 S LST(0)="8^0",LST(.5)=X,LST(.6)=""
"RTN","ORWDPS3",31,0)
 Q
"RTN","ORWDPS3",32,0)
 ;
"RTN","ORWDPS3",33,0)
PS ; setup environment for medications
"RTN","ORWDPS3",34,0)
 D AUTHMED Q:$G(ORQUIT)  ; checks authorized to write meds
"RTN","ORWDPS3",35,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORWDPS3",36,0)
 N PROMPT,OI
"RTN","ORWDPS3",37,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDPS3",38,0)
 S OI=""
"RTN","ORWDPS3",39,0)
 I $D(ORDIALOG(PROMPT,1)) S OI=ORDIALOG(PROMPT,1) D MEDACTV Q:$G(ORQUIT)
"RTN","ORWDPS3",40,0)
 N PSOI
"RTN","ORWDPS3",41,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2) D START^PSSJORDF(PSOI,ORCAT)
"RTN","ORWDPS3",42,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX SCHEDULE",0))
"RTN","ORWDPS3",43,0)
 I $D(ORDIALOG(PROMPT,1)) S ORSCH=ORDIALOG(PROMPT,1)
"RTN","ORWDPS3",44,0)
 I (ORCAT="I"),$L($G(ORSCH)) D
"RTN","ORWDPS3",45,0)
 . S ORSD=""
"RTN","ORWDPS3",46,0)
 . I $L($G(^DPT(+ORVP,.1))) S ORSD=$$STARTSTP^PSJORPOE(+ORVP,ORSCH,PSOI,+$G(ORWARD),"")
"RTN","ORWDPS3",47,0)
 . I $P(ORSD,U)="NEXT" S $P(ORSD,U)="NEXTA"
"RTN","ORWDPS3",48,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX DAYS SUPPLY",0))
"RTN","ORWDPS3",49,0)
 I $D(ORDIALOG(PROMPT,1)) S ORDSUP=ORDIALOG(PROMPT,1)
"RTN","ORWDPS3",50,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX DISPENSE DRUG",0))
"RTN","ORWDPS3",51,0)
 I $D(ORDIALOG(PROMPT,1)) S ORDRUG=ORDIALOG(PROMPT,1)
"RTN","ORWDPS3",52,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX REFILLS",0))
"RTN","ORWDPS3",53,0)
 I $D(ORDIALOG(PROMPT,1)) S OREFILLS=ORDIALOG(PROMPT,1)
"RTN","ORWDPS3",54,0)
 I ORCAT="O" S ORCOPAY=$$ASKSC^ORCDPS1
"RTN","ORWDPS3",55,0)
 I ORCAT="I" S PROMPT=$O(^ORD(101.41,"AB","OR GTX START DATE/TIME",0)) D
"RTN","ORWDPS3",56,0)
 . I $L($P($G(ORSD),U)),'$D(ORDIALOG(PROMPT,1)) S ORDIALOG(PROMPT,1)=$P(ORSD,U)
"RTN","ORWDPS3",57,0)
 ; create a SIG if none exists (i.e., when copying pre-POE orders)
"RTN","ORWDPS3",58,0)
 I '$L($G(ORDIALOG($$PTR^ORCD("OR GTX SIG"),1))) D
"RTN","ORWDPS3",59,0)
 . N ORDOSE,ORDRUG,ORWPSOI,PROMPT,DRUG
"RTN","ORWDPS3",60,0)
 . S PROMPT=$$PTR^ORCD("OR GTX INSTRUCTIONS")
"RTN","ORWDPS3",61,0)
 . S ORDRUG=$G(ORDIALOG($$PTR^ORCD("OR GTX DISPENSE DRUG"),1))
"RTN","ORWDPS3",62,0)
 . S ORWPSOI=+$G(ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1))
"RTN","ORWDPS3",63,0)
 . I ORWPSOI S ORWPSOI=+$P($G(^ORD(101.43,+ORWPSOI,0)),U,2)
"RTN","ORWDPS3",64,0)
 . D DOSE^PSSORUTL(.ORDOSE,ORWPSOI,$S(ORCAT="I":"U",1:"O"),ORVP)       ; dflt doses
"RTN","ORWDPS3",65,0)
 . D D1^ORCDPS2  ; set up ORDOSE & xrefs in ORDIALOG
"RTN","ORWDPS3",66,0)
 . S DRUG=$G(ORDOSE("DD",+ORDRUG))
"RTN","ORWDPS3",67,0)
 . I DRUG,ORCAT="O" D RESETID^ORCDPS
"RTN","ORWDPS3",68,0)
 . D SIG^ORCDPS2
"RTN","ORWDPS3",69,0)
 Q
"RTN","ORWDPS3",70,0)
AUTHMED ; sets ORQUIT if not authorized to write meds
"RTN","ORWDPS3",71,0)
 N NOAUTH,NAME
"RTN","ORWDPS3",72,0)
 D AUTH^ORWDPS32(.NOAUTH,ORNP)
"RTN","ORWDPS3",73,0)
 I +NOAUTH D
"RTN","ORWDPS3",74,0)
 . S ORQUIT=1
"RTN","ORWDPS3",75,0)
 . S LST(0)="8^0"
"RTN","ORWDPS3",76,0)
 . S NAME=$P($G(^VA(200,+ORNP,20)),U,2)
"RTN","ORWDPS3",77,0)
 . I '$L(NAME) S NAME=$P($G(^VA(200,+ORNP,0)),U,1)
"RTN","ORWDPS3",78,0)
 . S LST(.5)=NAME_" is not authorized to write med orders."
"RTN","ORWDPS3",79,0)
 Q
"RTN","ORWDPS3",80,0)
MEDACTV ; sets ORQUIT if the orderable item is not active for a med
"RTN","ORWDPS3",81,0)
 Q:'$G(OI)
"RTN","ORWDPS3",82,0)
 I $G(^ORD(101.43,OI,.1)),^(.1)'>$$NOW^XLFDT D
"RTN","ORWDPS3",83,0)
 . S ORQUIT=1
"RTN","ORWDPS3",84,0)
 . S LST(0)="8^0"
"RTN","ORWDPS3",85,0)
 . S LST(.5)=$P($G(^ORD(101.43,OI,0)),U)_" has been inactivated and may not be ordered anymore."
"RTN","ORWDPS3",86,0)
 I $D(ORQUIT) Q:ORQUIT
"RTN","ORWDPS3",87,0)
 ; copied from ORDITM^ORCDPS1 to make sure quick order if for right dialog
"RTN","ORWDPS3",88,0)
 N ORPS,PSOI,ORIV,ORINPT
"RTN","ORWDPS3",89,0)
 S ORINPT=$$INPT^ORCD
"RTN","ORWDPS3",90,0)
 S ORPS=$G(^ORD(101.43,+OI,"PS")),PSOI=+$P($G(^(0)),U,2)
"RTN","ORWDPS3",91,0)
 S ORIV=$S($P(ORPS,U)=2:1,1:0)
"RTN","ORWDPS3",92,0)
 I $G(ORCAT)="O",'$P(ORPS,U,2),'ORIMO S LST(.5)="This drug may not be used in an outpatient order."
"RTN","ORWDPS3",93,0)
 I $G(ORCAT)="I" D
"RTN","ORWDPS3",94,0)
 . I $G(ORINPT),'$P(ORPS,U),'ORIMO S LST(.5)="This drug may not be used in an inpatient order."
"RTN","ORWDPS3",95,0)
 . I '$G(ORINPT),'ORIV,'ORIMO S LST(.5)="This drug may not be ordered for an outpatient."
"RTN","ORWDPS3",96,0)
 I $L($G(LST(.5))) S ORQUIT=1,LST(0)="8^0"
"RTN","ORWDPS3",97,0)
 Q
"RTN","ORWDPS32")
0^77^B80062730
"RTN","ORWDPS32",1,0)
ORWDPS32 ; SLC/KCM - Pharmacy Calls for GUI Dialog [ 08/04/96  6:57 PM ];02:03 PM  4 Sep 1998;2/2/98  23:53 ;1/22/01  11:39 [1/22/01 2:48pm]
"RTN","ORWDPS32",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,94,190,195**;Dec 17, 1997
"RTN","ORWDPS32",3,0)
 ;
"RTN","ORWDPS32",4,0)
NXT() ; -- ret next available index in data array
"RTN","ORWDPS32",5,0)
 S ILST=ILST+1
"RTN","ORWDPS32",6,0)
 Q ILST
"RTN","ORWDPS32",7,0)
 ;
"RTN","ORWDPS32",8,0)
DLGSLCT(LST,PSTYPE) ; return def lists for dialog
"RTN","ORWDPS32",9,0)
 ; PSTYPE: pharmacy type (U=unit dose, F=IV fluids, O=outpt)
"RTN","ORWDPS32",10,0)
 N ILST S ILST=0
"RTN","ORWDPS32",11,0)
 I PSTYPE="F" D  Q                       ; IV Fluids
"RTN","ORWDPS32",12,0)
 . S LST($$NXT)="~ShortList"  D SHORT
"RTN","ORWDPS32",13,0)
 . S LST($$NXT)="~Priorities" D PRIOR
"RTN","ORWDPS32",14,0)
 ;
"RTN","ORWDPS32",15,0)
 S LST($$NXT)="~ShortList"  D SHORT      ; Unit Dose & Outpt
"RTN","ORWDPS32",16,0)
 S LST($$NXT)="~Schedules"  D SCHED
"RTN","ORWDPS32",17,0)
 S LST($$NXT)="~Priorities" D PRIOR
"RTN","ORWDPS32",18,0)
 I PSTYPE="O" D                          ; Outpt
"RTN","ORWDPS32",19,0)
 . S LST($$NXT)="~Pickup"   D PICKUP
"RTN","ORWDPS32",20,0)
 . S LST($$NXT)="~SCStatus" D SCLIST
"RTN","ORWDPS32",21,0)
 Q
"RTN","ORWDPS32",22,0)
SHORT ; from DLGSLCT, get short list of med quick orders
"RTN","ORWDPS32",23,0)
 ; !!! change this so that it uses the ORWDXQ call!!!
"RTN","ORWDPS32",24,0)
 N I,X,TMP
"RTN","ORWDPS32",25,0)
 I PSTYPE="U" S X="UD RX"
"RTN","ORWDPS32",26,0)
 I PSTYPE="F" S X="IV RX"
"RTN","ORWDPS32",27,0)
 I PSTYPE="O" S X="O RX"
"RTN","ORWDPS32",28,0)
 D GETQLST^ORWDXQ(.TMP,X,"iQ")
"RTN","ORWDPS32",29,0)
 S I=0 F  S I=$O(TMP(I)) Q:'I  S LST($$NXT)=TMP(I)
"RTN","ORWDPS32",30,0)
 Q
"RTN","ORWDPS32",31,0)
SCHED ; from DLGSLCT, get all pharm admin scheds
"RTN","ORWDPS32",32,0)
 N X
"RTN","ORWDPS32",33,0)
 S X="" F  S X=$O(^PS(51.1,"APPSJ",X)) Q:X=""  S LST($$NXT)="i"_X
"RTN","ORWDPS32",34,0)
 Q
"RTN","ORWDPS32",35,0)
SCHEDA ; (similar to SCHED, but also rtns admin times)
"RTN","ORWDPS32",36,0)
 N X,IEN,SCH
"RTN","ORWDPS32",37,0)
 S SCH="" F  S SCH=$O(^PS(51.1,"APPSJ",SCH)) Q:SCH=""  D
"RTN","ORWDPS32",38,0)
 . S IEN=0 F  S IEN=$O(^PS(51.1,"APPSJ",SCH,IEN)) Q:IEN'>0  D
"RTN","ORWDPS32",39,0)
 . . S X=^PS(51.1,IEN,0) S X=$S($L($P(X,U,2)):"  ("_$P(X,U,2)_")",1:"")
"RTN","ORWDPS32",40,0)
 . . S LST($$NXT)="i"_IEN_U_SCH_X
"RTN","ORWDPS32",41,0)
 Q
"RTN","ORWDPS32",42,0)
PRIOR ; from DLGSLCT, get list of allowed priorities
"RTN","ORWDPS32",43,0)
 N X,XREF
"RTN","ORWDPS32",44,0)
 S XREF=$S(PSTYPE="O":"S.PSO",1:"S.PSJ")
"RTN","ORWDPS32",45,0)
 S X="" F  S X=$O(^ORD(101.42,XREF,X)) Q:'$L(X)  D
"RTN","ORWDPS32",46,0)
 . S LST($$NXT)="i"_$O(^ORD(101.42,XREF,X,0))_U_X
"RTN","ORWDPS32",47,0)
 S LST($$NXT)="d"_$O(^ORD(101.42,"B","ROUTINE",0))_U_"ROUTINE"
"RTN","ORWDPS32",48,0)
 Q
"RTN","ORWDPS32",49,0)
PICKUP ; from DLGSLCT, get prescription routing
"RTN","ORWDPS32",50,0)
 N X,EDITONLY
"RTN","ORWDPS32",51,0)
 F X="W^at Window","M^by Mail","C^in Clinic" S LST($$NXT)="i"_X
"RTN","ORWDPS32",52,0)
 S X=$$DEFPICK I $L(X) S LST($$NXT)="d"_X
"RTN","ORWDPS32",53,0)
 Q
"RTN","ORWDPS32",54,0)
DEFPICK()       ; ret def routing
"RTN","ORWDPS32",55,0)
 N X,DLG,PRMT
"RTN","ORWDPS32",56,0)
 S DLG=$O(^ORD(101.41,"AB","PSO OERR",0)),X=""
"RTN","ORWDPS32",57,0)
 S PRMT=$O(^ORD(101.41,"AB","OR GTX ROUTING",0))
"RTN","ORWDPS32",58,0)
 I $D(^TMP("ORECALL",$J,+DLG,+PRMT,1)) S X=^(1)
"RTN","ORWDPS32",59,0)
 I X'="" S EDITONLY=1 Q X  ; EDITONLY used by def action
"RTN","ORWDPS32",60,0)
 ;
"RTN","ORWDPS32",61,0)
 S X=$$GET^XPAR("ALL","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS32",62,0)
 I X="C" S X="C^in Clinic" G XPICK
"RTN","ORWDPS32",63,0)
 I X="M" S X="M^by Mail"   G XPICK
"RTN","ORWDPS32",64,0)
 I X="W" S X="W^at Window" G XPICK
"RTN","ORWDPS32",65,0)
 I X="N" S X=""             G XPICK
"RTN","ORWDPS32",66,0)
 I X=""  S X=$S($D(^PSX(550,"C")):"M^by Mail",1:"W^at Window")
"RTN","ORWDPS32",67,0)
XPICK Q X
"RTN","ORWDPS32",68,0)
 ;
"RTN","ORWDPS32",69,0)
SCLIST ; from DLGSLCT, get options for service connected
"RTN","ORWDPS32",70,0)
 F X="0^No","1^Yes" S LST($$NXT)="i"_X
"RTN","ORWDPS32",71,0)
 Q
"RTN","ORWDPS32",72,0)
 ;
"RTN","ORWDPS32",73,0)
OISLCT(LST,OI,PSTYPE,ORVP) ; rtn for defaults for pharm OI
"RTN","ORWDPS32",74,0)
 N ILST S ILST=0
"RTN","ORWDPS32",75,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORWDPS32",76,0)
 S LST($$NXT)="~Dispense" D DISPDRG
"RTN","ORWDPS32",77,0)
 S LST($$NXT)="~Instruct" D INSTRCT
"RTN","ORWDPS32",78,0)
 S LST($$NXT)="~Route"    D ROUTE
"RTN","ORWDPS32",79,0)
 S LST($$NXT)="~Message"  D MESSAGE
"RTN","ORWDPS32",80,0)
 I $L($G(^TMP("PSJSCH",$J))) S LST($$NXT)="~DefSched",LST($$NXT)="d"_^($J)
"RTN","ORWDPS32",81,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORWDPS32",82,0)
 Q
"RTN","ORWDPS32",83,0)
 ;
"RTN","ORWDPS32",84,0)
DISPDRUG(LST,OI) ; list dispense drugs for an OI
"RTN","ORWDPS32",85,0)
 N ILST,PSTYPE S ILST=0,PSTYPE="U" D DISPDRG
"RTN","ORWDPS32",86,0)
 Q
"RTN","ORWDPS32",87,0)
 ;
"RTN","ORWDPS32",88,0)
DISPDRG ; from OISLCT, get disp drugs for this pharm OI
"RTN","ORWDPS32",89,0)
 N I,ORTMP,ORX
"RTN","ORWDPS32",90,0)
 S ORX=$T(ENDD^PSJORUTL),ORX=$L($P(ORX,";"),",")
"RTN","ORWDPS32",91,0)
 I ORX>3 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP,+ORVP)
"RTN","ORWDPS32",92,0)
 I ORX'>3 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP)
"RTN","ORWDPS32",93,0)
 S I="" F  S I=$O(ORTMP(I)) Q:I=""  D
"RTN","ORWDPS32",94,0)
 . I $P(ORTMP(I),U,4)="1" S $P(ORTMP(I),U,4)="NF"
"RTN","ORWDPS32",95,0)
 . S $P(ORTMP(I),U,3)="$"_$P(ORTMP(I),U,3)_" per "_$P(ORTMP(I),U,5)
"RTN","ORWDPS32",96,0)
 . S LST($$NXT)="i"_ORTMP(I)
"RTN","ORWDPS32",97,0)
 Q
"RTN","ORWDPS32",98,0)
INSTRCT ; from OISLCT, get list of potential instructs (based on drug form)
"RTN","ORWDPS32",99,0)
 N INOUN,NOUN,IINS,INS,VERB,INSREC
"RTN","ORWDPS32",100,0)
 D START^PSSJORDF(+$P(^ORD(101.43,OI,0),U,2))
"RTN","ORWDPS32",101,0)
 I PSTYPE="U" Q  ; don't use the instructions list for inpatients
"RTN","ORWDPS32",102,0)
 S IINS=0 F  S IINS=$O(^TMP("PSJINS",$J,IINS)) Q:'IINS  D
"RTN","ORWDPS32",103,0)
 . S INSREC=$G(^TMP("PSJINS",$J,IINS))
"RTN","ORWDPS32",104,0)
 . I '$D(VERB) S VERB=$P(INSREC,U)
"RTN","ORWDPS32",105,0)
 . I $L($P(INSREC,U,2)) S LST($$NXT)="i"_$P(INSREC,U,2)
"RTN","ORWDPS32",106,0)
 S LST($$NXT)="~Nouns"
"RTN","ORWDPS32",107,0)
 S INOUN=0 F  S INOUN=$O(^TMP("PSJNOUN",$J,INOUN)) Q:'INOUN  D
"RTN","ORWDPS32",108,0)
 . S LST($$NXT)="i"_$P(^TMP("PSJNOUN",$J,INOUN),U)
"RTN","ORWDPS32",109,0)
 I $D(VERB) S LST($$NXT)="~Verb",LST($$NXT)="d"_VERB
"RTN","ORWDPS32",110,0)
 ;
"RTN","ORWDPS32",111,0)
 Q
"RTN","ORWDPS32",112,0)
MIXED(X)   ; Return mixed case
"RTN","ORWDPS32",113,0)
 Q X  ;$E(X)_$TR($E(X,2,$L(X)),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","ORWDPS32",114,0)
 ;
"RTN","ORWDPS32",115,0)
ROUTE ; from OISLCT, get list of routes for the drug form
"RTN","ORWDPS32",116,0)
 ; ** NEED BOTH ABBREVIATION & NAME IN LIST BOX
"RTN","ORWDPS32",117,0)
 N I,CNT,ABBR,IEN,ROUT,X
"RTN","ORWDPS32",118,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS32",119,0)
 . S ROUT=$P(^TMP("PSJMR",$J,I),U),ABBR=$P(^(I),U,2),IEN=$P(^(I),U,3)
"RTN","ORWDPS32",120,0)
 . S LST($$NXT)="i"_IEN_U_ROUT_U_ABBR
"RTN","ORWDPS32",121,0)
 . I I=1,IEN S LST($$NXT)="d"_IEN_U_ROUT ;_U_ABBR ; assume first always default
"RTN","ORWDPS32",122,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS32",123,0)
 . S ROUT=$P(^TMP("PSJMR",$J,I),U),ABBR=$P(^(I),U,2),IEN=$P(^(I),U,3)
"RTN","ORWDPS32",124,0)
 . I $L(ABBR),(ABBR'=ROUT) S LST($$NXT)="i"_IEN_U_ABBR_" ("_ROUT_")"_U_ABBR
"RTN","ORWDPS32",125,0)
 Q
"RTN","ORWDPS32",126,0)
MESSAGE ; message
"RTN","ORWDPS32",127,0)
 S I=0 F  S I=$O(^ORD(101.43,OI,8,I)) Q:I'>0  S LST($$NXT)="t"_^(I,0)
"RTN","ORWDPS32",128,0)
 Q
"RTN","ORWDPS32",129,0)
ALLROUTE(LST) ; returns a list of all available med routes
"RTN","ORWDPS32",130,0)
 N I,X,ILST S ILST=0
"RTN","ORWDPS32",131,0)
 S I=0 F  S I=$O(^PS(51.2,I)) Q:'I  S X=^(I,0) D
"RTN","ORWDPS32",132,0)
 . I $P(X,U,4) S LST($$NXT)=I_U_$P(X,U)_U_$P(X,U,3)
"RTN","ORWDPS32",133,0)
 Q
"RTN","ORWDPS32",134,0)
VALROUTE(REC,X)        ; validates route name & returns IEN + abbreviation
"RTN","ORWDPS32",135,0)
 N ORLST,ABBR
"RTN","ORWDPS32",136,0)
 D FIND^DIC(51.2,"",1,"MO",X,1,,"I $P(^(0),U,4)=1",,"ORLST")
"RTN","ORWDPS32",137,0)
 I 'ORLST("DILIST",0) S REC=0 Q
"RTN","ORWDPS32",138,0)
 S X=$$UPPER(X),ABBR=ORLST("DILIST","ID",1,1)
"RTN","ORWDPS32",139,0)
 I '$L(ABBR) S ABBR=ORLST("DILIST",1,1)
"RTN","ORWDPS32",140,0)
 I ($$UPPER(ORLST("DILIST",1,1))'=X),($$UPPER(ABBR)'=X) S REC=0 Q
"RTN","ORWDPS32",141,0)
 S REC=ORLST("DILIST",2,1)_U_ABBR
"RTN","ORWDPS32",142,0)
 Q
"RTN","ORWDPS32",143,0)
AUTH(VAL,PRV) ; For inpatient meds, check restrictions
"RTN","ORWDPS32",144,0)
 N NAME,AUTH,INACT,X S VAL=0
"RTN","ORWDPS32",145,0)
 S NAME=$P($G(^VA(200,PRV,20)),U,2) S:'$L(NAME) NAME=$P(^(0),U)
"RTN","ORWDPS32",146,0)
 S X=$G(^VA(200,PRV,"PS")),AUTH=$P(X,U),INACT=$P(X,U,4)
"RTN","ORWDPS32",147,0)
 I 'AUTH!(INACT&(DT>INACT)) D  Q
"RTN","ORWDPS32",148,0)
 . S VAL="1^"_NAME_" is not authorized to write medication orders."
"RTN","ORWDPS32",149,0)
 I $D(^XUSEC("OREMAS",DUZ)),'$$GET^XPAR("ALL","OR OREMAS MED ORDERS") D  Q
"RTN","ORWDPS32",150,0)
 . S VAL="1^OREMAS key holders may not enter medication orders."
"RTN","ORWDPS32",151,0)
 Q
"RTN","ORWDPS32",152,0)
AUTHNVA(VAL,PRV) ; For Non-VA meds, check restrictions
"RTN","ORWDPS32",153,0)
 N NAME,AUTH,INACT,X S VAL=0
"RTN","ORWDPS32",154,0)
 I $D(^XUSEC("OREMAS",DUZ)),$$GET^XPAR("ALL","OR OREMAS NON-VA MED ORDERS")=2 Q
"RTN","ORWDPS32",155,0)
 I $D(^XUSEC("OREMAS",DUZ)),'$$GET^XPAR("ALL","OR OREMAS NON-VA MED ORDERS") D  Q
"RTN","ORWDPS32",156,0)
 . S VAL="1^OREMAS key holders may not enter non-VA medication orders."
"RTN","ORWDPS32",157,0)
 S NAME=$P($G(^VA(200,PRV,20)),U,2) S:'$L(NAME) NAME=$P(^(0),U)
"RTN","ORWDPS32",158,0)
 S X=$G(^VA(200,PRV,"PS")),AUTH=$P(X,U),INACT=$P(X,U,4)
"RTN","ORWDPS32",159,0)
 I 'AUTH!(INACT&(DT>INACT)) D  Q
"RTN","ORWDPS32",160,0)
 . S VAL="1^"_NAME_" is not authorized to write medication orders."
"RTN","ORWDPS32",161,0)
 Q
"RTN","ORWDPS32",162,0)
DRUGMSG(VAL,IEN)        ; return any message associated with a dispense drug
"RTN","ORWDPS32",163,0)
 N X S X=$$ENDCM^PSJORUTL(IEN)
"RTN","ORWDPS32",164,0)
 S VAL=$P(X,U,2)_U_$P(X,U,4)
"RTN","ORWDPS32",165,0)
 Q
"RTN","ORWDPS32",166,0)
MEDISIV(VAL,IEN)        ; return true if orderable item is IV medication
"RTN","ORWDPS32",167,0)
 S VAL=0
"RTN","ORWDPS32",168,0)
 I $P($G(^ORD(101.43,IEN,"PS")),U)=2 S VAL=1
"RTN","ORWDPS32",169,0)
 Q
"RTN","ORWDPS32",170,0)
ISSPLY(VAL,IEN) ; return true if orderable item is a supply
"RTN","ORWDPS32",171,0)
 S VAL=0
"RTN","ORWDPS32",172,0)
 I $P($G(^ORD(101.43,IEN,"PS")),U,5)=1 S VAL=1
"RTN","ORWDPS32",173,0)
 Q
"RTN","ORWDPS32",174,0)
IVAMT(VAL,OI,ORWTYP)     ; return UNITS^AMOUNT |^AMOUNT^AMOUNT...| for IV soln
"RTN","ORWDPS32",175,0)
 N I,PSOI,ORWY,AMT
"RTN","ORWDPS32",176,0)
 S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2)_ORWTYP,VAL=""
"RTN","ORWDPS32",177,0)
 D ENVOL^PSJORUT2(PSOI,.ORWY)
"RTN","ORWDPS32",178,0)
 I ORWTYP="B" D
"RTN","ORWDPS32",179,0)
 . S I=0 F  S I=$O(ORWY(I)) Q:I'>0  S AMT(+ORWY(I))=""
"RTN","ORWDPS32",180,0)
 . S AMT=0,VAL="ML" F  S AMT=$O(AMT(AMT)) Q:AMT'>0  S VAL=VAL_U_AMT
"RTN","ORWDPS32",181,0)
 I ORWTYP="A" D
"RTN","ORWDPS32",182,0)
 . S I=+$O(ORWY(0)) S VAL=$P($G(ORWY(I)),U,2)
"RTN","ORWDPS32",183,0)
 . I '$L(VAL) S VAL="ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU"
"RTN","ORWDPS32",184,0)
 Q
"RTN","ORWDPS32",185,0)
VALRATE(VAL,X)   ; return "1" (true) if IV rate text is valid
"RTN","ORWDPS32",186,0)
 I $E($RE($$UPPER(X)),1,5)="RH/LM"  S X=$E(X,1,$L(X)-5)
"RTN","ORWDPS32",187,0)
 S X=$$TRIM(X)
"RTN","ORWDPS32",188,0)
 D ORINF^PSIVSP S VAL=$G(X) ;S OK=$S($D(X):1,1:0)
"RTN","ORWDPS32",189,0)
 Q
"RTN","ORWDPS32",190,0)
UPPER(X)        ; return uppercase
"RTN","ORWDPS32",191,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ORWDPS32",192,0)
 ;
"RTN","ORWDPS32",193,0)
TRIM(X) ; trim leading and trailing spaces
"RTN","ORWDPS32",194,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;trail
"RTN","ORWDPS32",195,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;lead
"RTN","ORWDPS32",196,0)
 Q X
"RTN","ORWDPS32",197,0)
SCSTS(VAL,ORVP,ORDRUG)  ; return service connected eligibility for patient
"RTN","ORWDPS32",198,0)
 N ORWP94 S ORWP94=$O(^ORD(101.41,"AB","PS MEDS",0))>0
"RTN","ORWDPS32",199,0)
 I $L($T(SC^PSOCP)),$$SC^PSOCP(+ORVP,+$G(ORDRUG)) S VAL=0 G XSCSTS
"RTN","ORWDPS32",200,0)
 I 'ORWP94,(+$$RXST^IBARXEU(+ORVP)>0) S VAL=0 G XSCSTS
"RTN","ORWDPS32",201,0)
 S VAL=1
"RTN","ORWDPS32",202,0)
XSCSTS Q
"RTN","ORWDPS32",203,0)
FORMALT(ORLST,IEN,PSTYPE) ; return a list of formulary alternatives
"RTN","ORWDPS32",204,0)
 D ENRFA^PSJORUTL(IEN,PSTYPE,.ORLST)
"RTN","ORWDPS32",205,0)
 S I=0 F  S I=$O(ORLST(I)) Q:'I  D
"RTN","ORWDPS32",206,0)
 . S OI=+$O(^ORD(101.43,"ID",+$P(ORLST(I),U,4)_";99PSP",0))
"RTN","ORWDPS32",207,0)
 . S $P(ORLST(I),U,4)=OI I OI S $P(ORLST(I),U,5)=$P(^ORD(101.43,OI,0),U)
"RTN","ORWDPS32",208,0)
 Q
"RTN","ORWDPS32",209,0)
VALSCH(OK,X,PSTYPE)    ; validate a schedule, return 1 if valid, 0 if not
"RTN","ORWDPS32",210,0)
 I '$L($T(EN^PSSGSGUI)) S OK=-1 Q
"RTN","ORWDPS32",211,0)
 I $E($T(EN^PSSGSGUI),1,4)="EN(X" D
"RTN","ORWDPS32",212,0)
 . N ORX S ORX=$G(X) D EN^PSSGSGUI(.ORX,$G(PSTYPE,"I"))
"RTN","ORWDPS32",213,0)
 . K X S:$D(ORX) X=ORX
"RTN","ORWDPS32",214,0)
 E  D
"RTN","ORWDPS32",215,0)
 . D EN^PSSGSGUI
"RTN","ORWDPS32",216,0)
 S OK=$S($D(X):1,1:0)
"RTN","ORWDPS32",217,0)
 Q
"RTN","ORWDPS32",218,0)
VALQTY(OK,X)    ; validate a quantity, return 1 if valid, 0 if not
"RTN","ORWDPS32",219,0)
 ; to be compatible with LM, make sure X is integer from 1 to 240
"RTN","ORWDPS32",220,0)
 ; this is based on the input transform from 52,7
"RTN","ORWDPS32",221,0)
 K:(+X'>0)!(+X>99999999)!(X'?.8N.1".".2N)!($L(X)>12) X
"RTN","ORWDPS32",222,0)
 S OK=$S($D(X):1,1:0)
"RTN","ORWDPS32",223,0)
 Q
"RTN","ORWDPS32",224,0)
DOSES(LST,OI) ; return doses for an orderable item  -  TEST ONLY
"RTN","ORWDPS32",225,0)
 N ORTMP,ORI,ORJ,ILST,NDF,VAPN,X,PSTYPE S PSTYPE="O"
"RTN","ORWDPS32",226,0)
 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP)
"RTN","ORWDPS32",227,0)
 S ORI=0 F  S ORI=$O(ORTMP(ORI)) Q:'ORI  S ORWDRG=+ORTMP(ORI) D
"RTN","ORWDPS32",228,0)
 . S NDF=$G(^PSDRUG(+ORWDRG,"ND")),VAPN=$P(NDF,U,3),NDF=+NDF
"RTN","ORWDPS32",229,0)
 . S X=$$DFSU^PSNAPIS(NDF,VAPN)
"RTN","ORWDPS32",230,0)
 . S LSTA($P(X,U,4),$P(X,U,6))=""
"RTN","ORWDPS32",231,0)
 . I +$P(X,U,4)=$P(X,U,4) S LSTA($P(X,U,4)*2,$P(X,U,6))=""
"RTN","ORWDPS32",232,0)
 S ORI="",ILST=0 F  S ORI=$O(LSTA(ORI)) Q:ORI=""  D
"RTN","ORWDPS32",233,0)
 . S ORJ="" F  S ORJ=$O(LSTA(ORI,ORJ)) Q:ORJ=""  D
"RTN","ORWDPS32",234,0)
 . . S ILST=ILST+1,LST(ILST)=ORI_" "_ORJ
"RTN","ORWDPS32",235,0)
 Q
"RTN","ORWDPS4")
0^9^B18747760
"RTN","ORWDPS4",1,0)
ORWDPS4 ;; SLC/JDL - Order Dialogs CO-PAY and Other;[12/31/01 6:38pm]
"RTN","ORWDPS4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**116,125,131,141,173,187,190,195**;Dec 17, 1997
"RTN","ORWDPS4",3,0)
 ;
"RTN","ORWDPS4",4,0)
CPLST(TEST,PTIFN,ORIFNS) ; --Get CP questions
"RTN","ORWDPS4",5,0)
 N ORIFN,ORDA,ORI,ORPSO,CPX
"RTN","ORWDPS4",6,0)
 S ORI=0,ORPSO=+$O(^DIC(9.4,"C","PSO",0))
"RTN","ORWDPS4",7,0)
 F  S ORI=$O(ORIFNS(ORI)) Q:'ORI  D
"RTN","ORWDPS4",8,0)
 .S ORIFN=+ORIFNS(ORI),ORDA=$P(ORIFNS(ORI),";",2)
"RTN","ORWDPS4",9,0)
 .I $D(^OR(100,ORIFN,0)),($P(^OR(100,ORIFN,0),U,14)=ORPSO) D
"RTN","ORWDPS4",10,0)
 ..N PRIO S PRIO=0
"RTN","ORWDPS4",11,0)
 ..I $D(^OR(100,ORIFN,4.5,"ID","URGENCY")) S PRIO=$O(^("URGENCY",0))
"RTN","ORWDPS4",12,0)
 ..S PRIO=$G(^OR(100,ORIFN,4.5,+PRIO,1))
"RTN","ORWDPS4",13,0)
 ..Q:PRIO=99
"RTN","ORWDPS4",14,0)
 ..S CPX=$$SC(ORIFN)
"RTN","ORWDPS4",15,0)
 ..I $L(CPX)>1 S TEST(ORIFN)=ORIFN_";"_ORDA_CPX
"RTN","ORWDPS4",16,0)
 K PTIFN,ORIFN,ORDA,ORI,CPX
"RTN","ORWDPS4",17,0)
 Q
"RTN","ORWDPS4",18,0)
 ;
"RTN","ORWDPS4",19,0)
CPINFO(Y,ORINFO) ; -- Save reponses to CP questions
"RTN","ORWDPS4",20,0)
 Q:'$D(ORINFO)
"RTN","ORWDPS4",21,0)
 N ORIFN,ORI,ORX,ANS S ORI=0
"RTN","ORWDPS4",22,0)
 F  S ORI=$O(ORINFO(ORI)) Q:'ORI  D
"RTN","ORWDPS4",23,0)
 .S ORIFN=$P($P(ORINFO(ORI),U,1),";",1)
"RTN","ORWDPS4",24,0)
 .S ANS=$P(ORINFO(ORI),U,2)
"RTN","ORWDPS4",25,0)
 .D REFMT(.ORX,ANS)
"RTN","ORWDPS4",26,0)
 .D SC^ORCSAVE2(.ORX,ORIFN)
"RTN","ORWDPS4",27,0)
 S Y=1
"RTN","ORWDPS4",28,0)
 K ORIFN,ORX,ORI,ANS
"RTN","ORWDPS4",29,0)
 Q
"RTN","ORWDPS4",30,0)
 ;
"RTN","ORWDPS4",31,0)
SC(ORIFN) ; -- Dialog validation, to ask CP questions
"RTN","ORWDPS4",32,0)
 ;Expects ORIFN and ORDA
"RTN","ORWDPS4",33,0)
 ;
"RTN","ORWDPS4",34,0)
 N DR S DR=""
"RTN","ORWDPS4",35,0)
 I '$L($T(SCNEW^PSOCP))!('$G(ORIFN))!('$G(ORDA)) Q DR
"RTN","ORWDPS4",36,0)
 I $P($G(^OR(100,ORIFN,8,ORDA,0)),U,2)'="NW" Q DR
"RTN","ORWDPS4",37,0)
 ;
"RTN","ORWDPS4",38,0)
 N OR3,ORDRUG,ORENEW,ORX,I,XACT,YACT,CPNODE,ASC,AAO,AIR,AEC,AMST,AHNC,ACV
"RTN","ORWDPS4",39,0)
 S ORX="",XACT=""
"RTN","ORWDPS4",40,0)
 ;--Only new, renew, edited, copied outpatient order can continue...
"RTN","ORWDPS4",41,0)
 S OR3=$G(^OR(100,ORIFN,3)),XACT=$P(OR3,U,11) I (XACT'=0)&((XACT'=2)&(XACT'="C")) Q DR
"RTN","ORWDPS4",42,0)
 I (XACT=1)&($D(^OR(100,ORIFN,5))=0) Q DR
"RTN","ORWDPS4",43,0)
 I $D(^OR(100,ORIFN,5))>0 D
"RTN","ORWDPS4",44,0)
 .S CPNODE=$G(^OR(100,ORIFN,5))
"RTN","ORWDPS4",45,0)
 .S ASC=$S($L($P(CPNODE,"^",1)):"SC;"_$P(CPNODE,"^",1),1:"")
"RTN","ORWDPS4",46,0)
 .S DR=$S($L(ASC):DR_U_ASC,1:DR)
"RTN","ORWDPS4",47,0)
 .S AAO=$S($L($P(CPNODE,"^",3)):"AO;"_$P(CPNODE,"^",3),1:"")
"RTN","ORWDPS4",48,0)
 .S DR=$S($L(AAO):DR_U_AAO,1:DR)
"RTN","ORWDPS4",49,0)
 .S AIR=$S($L($P(CPNODE,"^",4)):"IR;"_$P(CPNODE,"^",4),1:"")
"RTN","ORWDPS4",50,0)
 .S DR=$S($L(AIR):DR_U_AIR,1:DR)
"RTN","ORWDPS4",51,0)
 .S AEC=$S($L($P(CPNODE,"^",5)):"EC;"_$P(CPNODE,"^",5),1:"")
"RTN","ORWDPS4",52,0)
 .S DR=$S($L(AEC):DR_U_AEC,1:DR)
"RTN","ORWDPS4",53,0)
 .S AMST=$S($L($P(CPNODE,"^",2)):"MST;"_$P(CPNODE,"^",2),1:"")
"RTN","ORWDPS4",54,0)
 .S DR=$S($L(AMST):DR_U_AMST,1:DR)
"RTN","ORWDPS4",55,0)
 .S AHNC=$S($L($P(CPNODE,"^",6)):"HNC;"_$P(CPNODE,"^",6),1:"")
"RTN","ORWDPS4",56,0)
 .S DR=$S($L(AHNC):DR_U_AHNC,1:DR)
"RTN","ORWDPS4",57,0)
 .S ACV=$S($L($P(CPNODE,"^",7)):"CV;"_$P(CPNODE,"^",7),1:"")
"RTN","ORWDPS4",58,0)
 .S DR=$S($L(ACV):DR_U_ACV,1:DR)
"RTN","ORWDPS4",59,0)
 .D CPCOMP(.DR)
"RTN","ORWDPS4",60,0)
 .K ASC,AAO,AIR,AEC,AMST,AHNC,CPNODE
"RTN","ORWDPS4",61,0)
 I $L(DR)>0 Q DR
"RTN","ORWDPS4",62,0)
 I XACT=2 S YACT=$P(OR3,U,5),ORENEW=$G(^OR(100,YACT,4)) ;get PS# if renewal
"RTN","ORWDPS4",63,0)
 S ORDRUG=$$VALUE^ORCSAVE2(ORIFN,"DRUG")
"RTN","ORWDPS4",64,0)
 D SCNEW^PSOCP(.ORX,+PTIFN,ORDRUG,$G(ORENEW)) I '$D(ORX) Q DR
"RTN","ORWDPS4",65,0)
 F I="SC","AO","IR","EC","MST","HNC","CV" D
"RTN","ORWDPS4",66,0)
 . I $D(ORX(I)) S DR=DR_U_I_$S($L(ORX(I)):";"_ORX(I),1:"")
"RTN","ORWDPS4",67,0)
 Q DR
"RTN","ORWDPS4",68,0)
REFMT(ORX,INFO) ;
"RTN","ORWDPS4",69,0)
 ;"U": Unchecked ("NO") 
"RTN","ORWDPS4",70,0)
 ;"C": Checked ("YES")
"RTN","ORWDPS4",71,0)
 ;"N" : Question not asked
"RTN","ORWDPS4",72,0)
 N RST,RST1
"RTN","ORWDPS4",73,0)
 S RST=""
"RTN","ORWDPS4",74,0)
 F I=1:1:$L(INFO)  S RST=RST_U_$S($E(INFO,I)="U":0,$E(INFO,I)="C":1,1:"")
"RTN","ORWDPS4",75,0)
 S RST1=$E(RST,2,$L(RST))
"RTN","ORWDPS4",76,0)
 S ORX("SC")=$P(RST1,U,1)
"RTN","ORWDPS4",77,0)
 S ORX("MST")=$P(RST1,U,5)
"RTN","ORWDPS4",78,0)
 S ORX("AO")=$P(RST1,U,2)
"RTN","ORWDPS4",79,0)
 S ORX("IR")=$P(RST1,U,3)
"RTN","ORWDPS4",80,0)
 S ORX("EC")=$P(RST1,U,4)
"RTN","ORWDPS4",81,0)
 S ORX("HNC")=$P(RST1,U,6)
"RTN","ORWDPS4",82,0)
 S ORX("CV")=$P(RST1,U,7)
"RTN","ORWDPS4",83,0)
 K RST,RST1
"RTN","ORWDPS4",84,0)
 Q
"RTN","ORWDPS4",85,0)
CPCOMP(PREX) ; -- Compare the existed exemptions with new exemption questions
"RTN","ORWDPS4",86,0)
 N ORX1,ORDRUG1,CPI,LSTCP,TMPVAL
"RTN","ORWDPS4",87,0)
 S LSTCP=""
"RTN","ORWDPS4",88,0)
 S ORDRUG1=$$VALUE^ORCSAVE2(ORIFN,"DRUG")
"RTN","ORWDPS4",89,0)
 D SCNEW^PSOCP(.ORX1,+PTIFN,ORDRUG1,$G(ORENEW)) I '$D(ORX1) Q
"RTN","ORWDPS4",90,0)
 F CPI="SC","AO","IR","EC","MST","HNC","CV" D
"RTN","ORWDPS4",91,0)
 . I $D(ORX1(CPI)) D
"RTN","ORWDPS4",92,0)
 . . S TMPVAL=""
"RTN","ORWDPS4",93,0)
 . . I $F(PREX,CPI) D
"RTN","ORWDPS4",94,0)
 . . . S TMPVAL=+$E(PREX,$F(PREX,CPI)+1)
"RTN","ORWDPS4",95,0)
 . . . I $L(TMPVAL),((TMPVAL=0)!(TMPVAL=1)) S TMPVAL=CPI_";"_TMPVAL
"RTN","ORWDPS4",96,0)
 . . . E  S TMPVAL=CPI
"RTN","ORWDPS4",97,0)
 . . E  S TMPVAL=CPI
"RTN","ORWDPS4",98,0)
 . . S LSTCP=LSTCP_U_TMPVAL
"RTN","ORWDPS4",99,0)
 S PREX=LSTCP
"RTN","ORWDPS4",100,0)
 Q
"RTN","ORWDPS4",101,0)
IPOD4OP(ORY,ORID) ;True: is an Inpt (IV OI) order on an OutPatient
"RTN","ORWDPS4",102,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDPS4",103,0)
 S ORY=0
"RTN","ORWDPS4",104,0)
 N APKG,ADLG,ADG,APTCLS,RXDG,UDDLG,IPPKG
"RTN","ORWDPS4",105,0)
 S (RXDG,UDDLG,IPPKG)=0
"RTN","ORWDPS4",106,0)
 S RXDG=+$O(^ORD(100.98,"B","O RX",0))
"RTN","ORWDPS4",107,0)
 S UDDLG=+$O(^ORD(101.41,"B","PSJ OR PAT OE",0))
"RTN","ORWDPS4",108,0)
 S IPPKG=+$O(^DIC(9.4,"B","INPATIENT MEDICATIONS",0))
"RTN","ORWDPS4",109,0)
 S ADLG=+$P($G(^OR(100,+ORID,0)),U,5)
"RTN","ORWDPS4",110,0)
 S ADG=$P($G(^OR(100,+ORID,0)),U,11)
"RTN","ORWDPS4",111,0)
 S APKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDPS4",112,0)
 S APTCLS=$P($G(^OR(100,+ORID,0)),U,12)
"RTN","ORWDPS4",113,0)
 I ADG=RXDG,(ADLG=UDDLG),(APKG=IPPKG),(APTCLS="I") S ORY=1
"RTN","ORWDPS4",114,0)
 Q
"RTN","ORWDPS4",115,0)
 ;
"RTN","ORWDPS4",116,0)
UPDTDG(ORY,ORID) ;Update Inpt order for outpatient DG to Inpt DG
"RTN","ORWDPS4",117,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDPS4",118,0)
 N UDDG
"RTN","ORWDPS4",119,0)
 S UDDG=$O(^ORD(100.98,"B","UD RX",0))
"RTN","ORWDPS4",120,0)
 S $P(^OR(100,+ORID,0),U,11)=UDDG
"RTN","ORWDPS4",121,0)
 Q
"RTN","ORWDPS4",122,0)
ISUDIV(ORY,ORIFN) ;True: OI of the order is for both UD and IV
"RTN","ORWDPS4",123,0)
 N OI
"RTN","ORWDPS4",124,0)
 S (OI,ORY)=0
"RTN","ORWDPS4",125,0)
 S OI=+$O(^OR(100,+$G(ORIFN),.1,"B",0)) Q:OI<1
"RTN","ORWDPS4",126,0)
 I $O(^ORD(101.43,OI,9,"B","IVM RX",0)) S ORY=1
"RTN","ORWDPS4",127,0)
 Q
"RTN","ORWDX")
0^1^B63550700
"RTN","ORWDX",1,0)
ORWDX ; SLC/KCM/REV/JLI - Order dailog utilities ;3/31/04  13:09
"RTN","ORWDX",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,125,131,132,141,164,178,187,190,195**;Dec 17, 1997
"RTN","ORWDX",3,0)
NXT() ; -- Gets index in array
"RTN","ORWDX",4,0)
 S ILST=ILST+1
"RTN","ORWDX",5,0)
 Q ILST
"RTN","ORWDX",6,0)
ORDITM(Y,FROM,DIR,XREF) ; Subset of orderable items
"RTN","ORWDX",7,0)
 ; Y(n)=IEN^.01 Name^.01 Name  -or-  IEN^Synonym <.01 Name>^.01 Name
"RTN","ORWDX",8,0)
 N I,IEN,CNT,X,DTXT,CURTM
"RTN","ORWDX",9,0)
 S I=0,CNT=44,CURTM=$$NOW^XLFDT
"RTN","ORWDX",10,0)
 F  Q:I'<CNT  S FROM=$O(^ORD(101.43,XREF,FROM),DIR) Q:FROM=""  D
"RTN","ORWDX",11,0)
 . S IEN="" F  S IEN=$O(^ORD(101.43,XREF,FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWDX",12,0)
 . . S X=^ORD(101.43,XREF,FROM,IEN)
"RTN","ORWDX",13,0)
 . . I +$P(X,U,3),$P(X,U,3)<CURTM Q
"RTN","ORWDX",14,0)
 . . Q:$P(X,U,5)  S I=I+1
"RTN","ORWDX",15,0)
 . . I 'X S Y(I)=IEN_U_$P(X,U,2)_U_$P(X,U,2)
"RTN","ORWDX",16,0)
 . . E  S Y(I)=IEN_U_$P(X,U,2)_$C(9)_"<"_$P(X,U,4)_">"_U_$P(X,U,4)
"RTN","ORWDX",17,0)
 Q
"RTN","ORWDX",18,0)
ODITMBC(Y,XREF,ODLST) ;
"RTN","ORWDX",19,0)
 N CNT,NM,XRF
"RTN","ORWDX",20,0)
 S CNT=0,NM=0,XRF=XREF
"RTN","ORWDX",21,0)
 F  S CNT=$O(ODLST(CNT)) Q:'CNT  D FNDINFO(.Y,ODLST(CNT))
"RTN","ORWDX",22,0)
 Q
"RTN","ORWDX",23,0)
FNDINFO(Y,ODIEN) ;
"RTN","ORWDX",24,0)
 D FNDINFO^ORWDX1(.Y,.ODIEN)
"RTN","ORWDX",25,0)
 Q
"RTN","ORWDX",26,0)
DLGDEF(LST,DLG) ; Format mapping for a dlg
"RTN","ORWDX",27,0)
 D DLGDEF^ORWDX1(.LST,.DLG)
"RTN","ORWDX",28,0)
 Q
"RTN","ORWDX",29,0)
DLGQUIK(LST,QO) ;(NOT USED)
"RTN","ORWDX",30,0)
 D LOADRSP(.LST,QO)
"RTN","ORWDX",31,0)
 Q
"RTN","ORWDX",32,0)
LOADRSP(LST,RSPID)      ; Load responses from 101.41 or 100
"RTN","ORWDX",33,0)
 ; RSPID:  C123456;1-3243 = cached copy,   134-3234 = cached quick
"RTN","ORWDX",34,0)
 ;         X123456;1      = change order,  134      = quick dialog
"RTN","ORWDX",35,0)
 N I,J,DLG,INST,ID,VAL,ILST,ROOT S ROOT=""
"RTN","ORWDX",36,0)
 I RSPID["-" S ROOT="^TMP(""ORWDXMQ"",$J,"""_RSPID_""")" G XROOT
"RTN","ORWDX",37,0)
 I $E(RSPID)="X" S ROOT="^OR(100,"_+$P(RSPID,"X",2)_",4.5)"  G XROOT
"RTN","ORWDX",38,0)
 I +RSPID=RSPID  S ROOT="^ORD(101.41,"_+RSPID_",6)" G XROOT
"RTN","ORWDX",39,0)
 Q:ROOT=""
"RTN","ORWDX",40,0)
XROOT S (ILST,I)=0 F  S I=$O(@ROOT@(I)) Q:I'>0  D
"RTN","ORWDX",41,0)
 . S DLG=$P(@ROOT@(I,0),U,2),INST=$P(^(0),U,3)
"RTN","ORWDX",42,0)
 . S ID=$P($G(^ORD(101.41,DLG,1)),U,3)
"RTN","ORWDX",43,0)
 . I '$L(ID) S ID="ID"_DLG
"RTN","ORWDX",44,0)
 . S VAL=$G(@ROOT@(I,1))
"RTN","ORWDX",45,0)
 . I $P($G(^ORD(101.41,DLG,0)),U)="OR GTX ADDITIVE" S ID="ADDITIVE"
"RTN","ORWDX",46,0)
 . I $E(RSPID)="C",(ID="START"),VAL Q  ; skip literal start time on copy
"RTN","ORWDX",47,0)
 . S LST($$NXT)="~"_DLG_U_INST_U_ID
"RTN","ORWDX",48,0)
 . I $L(VAL) D
"RTN","ORWDX",49,0)
 .. S LST($$NXT)="i"_VAL,LST($$NXT)="e"_$$EXTVAL(VAL,DLG)
"RTN","ORWDX",50,0)
 . I $D(@ROOT@(I,2))>1 D
"RTN","ORWDX",51,0)
 .. S J=0 F  S J=$O(@ROOT@(I,2,J)) Q:J'>0  D
"RTN","ORWDX",52,0)
 ... S LST($$NXT)="t"_$G(@ROOT@(I,2,J,0))
"RTN","ORWDX",53,0)
 I $E(ROOT,1,4)="^TMP" K ^TMP("ORWDXMQ",$J)
"RTN","ORWDX",54,0)
 Q
"RTN","ORWDX",55,0)
SAVE(REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,ORDIALOG,ORDEA,ORAPPT,ORSRC,OREVTDF) ;
"RTN","ORWDX",56,0)
 ; ORVP=DFN, ORNP=Provider, ORL=Location, DLG=Order Dialog,
"RTN","ORWDX",57,0)
 ; ORDG=Display Group, ORIT=Quick Order Dialog, ORAPPT=Appointment
"RTN","ORWDX",58,0)
 N ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORNEW,ORCHECK,ORLOG,ORLEAD,ORTRAIL,ORPKG,ORWP94,ORCATFN,OREVTYPE,ONPASS
"RTN","ORWDX",59,0)
 ; JD FIX FOR WASHINGTON DC
"RTN","ORWDX",60,0)
 ;I '$L(ORSRC)!($G(ORSRC)=" ")!($G(ORSRC)=0) S ORSRC=$P(ORVP,U,2)
"RTN","ORWDX",61,0)
 ;S ORVP=$P(ORVP,U)
"RTN","ORWDX",62,0)
 ; END FIX JD
"RTN","ORWDX",63,0)
 S ORCATFN=""
"RTN","ORWDX",64,0)
 I $L($P(DLG,U,2)) S ORCATFN=$P(DLG,U,2),DLG=$P(DLG,U,1)
"RTN","ORWDX",65,0)
 I $G(ORDIALOG("ORTS")) S ORTS=ORDIALOG("ORTS") K ORDIALOG("ORTS")
"RTN","ORWDX",66,0)
 I $G(ORDIALOG("ORSLOG")) S ORLOG=ORDIALOG("ORSLOG") K ORDIALOG("ORSLOG")
"RTN","ORWDX",67,0)
 I $D(ORDIALOG("OREVENT")) S OREVENT=ORDIALOG("OREVENT") K ORDIALOG("OREVENT")
"RTN","ORWDX",68,0)
 I $L($G(OREVENT)) D
"RTN","ORWDX",69,0)
 . S ONPASS=0
"RTN","ORWDX",70,0)
 . S OREVTYPE=$$TYPE^OREVNTX(OREVENT)
"RTN","ORWDX",71,0)
 . I OREVTYPE="T" D ISPASS^OREVNTX1(.ONPASS,+OREVENT,"T")
"RTN","ORWDX",72,0)
 . S ORCAT=$S(OREVTYPE="A":"I",OREVTYPE="T":"I",ONPASS=1:"O",1:"O")
"RTN","ORWDX",73,0)
 E  S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWDX",74,0)
 I DLG="PS MEDS" S ORWP94=1 D
"RTN","ORWDX",75,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO SUPPLY",0)) S DLG="PSO SUPPLY"
"RTN","ORWDX",76,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO OERR",0)) S DLG="PSO OERR"
"RTN","ORWDX",77,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSJ OR PAT OE",0)) S DLG="PSJ OR PAT OE"
"RTN","ORWDX",78,0)
 I DLG="PSO OERR" S ORCAT="O" I $G(OREVENT("EFFECTIVE")) D
"RTN","ORWDX",79,0)
 . S ORDIALOG($O(^ORD(101.41,"B","OR GTX START DATE"_$S($G(ORWP94):"/TIME",1:""),0)),1)=OREVENT("EFFECTIVE")
"RTN","ORWDX",80,0)
 I DLG="PSJ OR PAT OE" S ORCAT="I"
"RTN","ORWDX",81,0)
 S ORVP=ORVP_";DPT(",ORL(2)=ORL_";SC(",ORL=ORL(2)
"RTN","ORWDX",82,0)
 K:'ORDG ORDG K:'ORIT ORIT ; Dgrp & Quick must be non-zero
"RTN","ORWDX",83,0)
 M ORCHECK=ORDIALOG("ORCHECK") K ORDIALOG("ORCHECK")
"RTN","ORWDX",84,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",DLG,0))
"RTN","ORWDX",85,0)
 I 'ORDIALOG S ORDIALOG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWDX",86,0)
 I $D(ORDIALOG("ORLEAD")) S ORLEAD=ORDIALOG("ORLEAD")
"RTN","ORWDX",87,0)
 I $D(ORDIALOG("ORTRAIL")) S ORTRAIL=ORDIALOG("ORTRAIL")
"RTN","ORWDX",88,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORWDX",89,0)
 I $L(ORCATFN) S ORCAT=ORCATFN
"RTN","ORWDX",90,0)
 I $G(ORWP94) D
"RTN","ORWDX",91,0)
 . N SIGPRMT S SIGPRMT=$O(^ORD(101.41,"B","OR GTX SIG",0))
"RTN","ORWDX",92,0)
 . N INSPRMT S INSPRMT=$O(^ORD(101.41,"B","OR GTX INSTRUCTIONS",0))
"RTN","ORWDX",93,0)
 . I $L($G(ORDIALOG(SIGPRMT,1))) S ORDIALOG(INSPRMT,"FORMAT")="@"
"RTN","ORWDX",94,0)
 . I ORCAT="O" S ORPKG=$O(^DIC(9.4,"C","PSO",0))
"RTN","ORWDX",95,0)
 . I ORCAT="I" S ORPKG=$O(^DIC(9.4,"C","PSJ",0))
"RTN","ORWDX",96,0)
 S ORSRC=$G(ORSRC)
"RTN","ORWDX",97,0)
 D DELPI^ORWDX1 ;delete empty PI
"RTN","ORWDX",98,0)
 I $G(ORIFN)="" D  ; new order
"RTN","ORWDX",99,0)
 . D EN^ORCSAVE
"RTN","ORWDX",100,0)
 . S REC="" I ORIFN D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",101,0)
 . I '$D(^TMP("ORECALL",$J,ORDIALOG)) M ^TMP("ORECALL",$J,ORDIALOG)=ORDIALOG
"RTN","ORWDX",102,0)
 E  D
"RTN","ORWDX",103,0)
 . N OR0
"RTN","ORWDX",104,0)
 . S OR0=$G(^OR(100,+ORIFN,0)),ORSTS=$P($G(^(3)),U,3),ORDG=$P(OR0,U,11)
"RTN","ORWDX",105,0)
 . I $L($P(OR0,U,17)),ORSTS=10 S OREVENT=$P(OR0,U,17),OREVENT("TS")=$P(OR0,U,13)
"RTN","ORWDX",106,0)
 . D XX^ORCSAVE ; edit order
"RTN","ORWDX",107,0)
 . S REC="" S ORIFN=+ORIFN_";"_ORDA D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",108,0)
 Q
"RTN","ORWDX",109,0)
SENDED(ORWLST,ORIENS,TS,LOC) ; Release EDOs to svc
"RTN","ORWDX",110,0)
 N OK,ORVP,ORWERR,ORSIGST,ORDA,ORNATURE,ORIX,X,PTEVT,ORIFN,J,EVENT,LOCK
"RTN","ORWDX",111,0)
 S ORWERR="",ORIX=0,LOC=LOC_";SC("
"RTN","ORWDX",112,0)
 F  S ORIX=$O(ORIENS(ORIX)) Q:'ORIX  D
"RTN","ORWDX",113,0)
 . S ORIFN=ORIENS(ORIX)
"RTN","ORWDX",114,0)
 . S PTEVT=$P(^OR(100,+ORIFN,0),U,17) I PTEVT S LOCK=$$LCKEVT^ORX2(PTEVT) S:LOCK EVENT(PTEVT)="" I 'LOCK S ORWERR="1^delayed event is locked - another user is processing orders for this event" ;195
"RTN","ORWDX",115,0)
 . S ORDA=$P(ORIFN,";",2) S:'ORDA ORDA=1
"RTN","ORWDX",116,0)
 . S ORVP=$P($G(^OR(100,+ORIFN,0)),U,2)
"RTN","ORWDX",117,0)
 . I $D(^OR(100,+ORIFN,8,ORDA,0)) D
"RTN","ORWDX",118,0)
 .. S ORSIGST=$P($G(^(0)),U,4)
"RTN","ORWDX",119,0)
 .. S ORNATURE=$P($G(^(0)),U,12)
"RTN","ORWDX",120,0)
 . S:$G(LOC) $P(^OR(100,+ORIFN,0),U,10)=LOC ;set location
"RTN","ORWDX",121,0)
 . S:$G(TS) $P(^OR(100,+ORIFN,0),U,13)=TS ;set specialty
"RTN","ORWDX",122,0)
 . S OK=$$LOCK1^ORX2(ORIFN) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",123,0)
 . I OK,$G(LOCK) D EN2^ORCSEND(ORIENS(ORIX),ORSIGST,ORNATURE,.ORWERR),UNLK1^ORX2(ORIENS(ORIX)) ;add ,LOCK to if statement for 195
"RTN","ORWDX",124,0)
 . S ORWLST(ORIX)=ORIENS(ORIX)
"RTN","ORWDX",125,0)
 . I $L(ORWERR) S ORWLST(ORIX)=ORWLST(ORIX)_"^E^"_ORWERR Q
"RTN","ORWDX",126,0)
 . E  D
"RTN","ORWDX",127,0)
 .. S PTEVT=$P($G(^OR(100,+ORIENS(ORIX),0)),U,17)
"RTN","ORWDX",128,0)
 .. D:$$TYPE^OREVNTX(PTEVT)="M" SAVE^ORMEVNT1(ORIENS(ORIX),PTEVT,2)
"RTN","ORWDX",129,0)
 . S X="RS"
"RTN","ORWDX",130,0)
 . S $P(ORWLST(ORIX),U,2)=X
"RTN","ORWDX",131,0)
 S J=0 F  S J=$O(EVENT(J)) Q:'+J  D UNLEVT^ORX2(J) ;195
"RTN","ORWDX",132,0)
 Q
"RTN","ORWDX",133,0)
SEND(ORWLST,DFN,ORNP,ORL,ES,ORWREC) ; Sign
"RTN","ORWDX",134,0)
 ; DFN=Patient, ORNP=Provider, ORL=Location, ES=Encrypted ES code
"RTN","ORWDX",135,0)
 ; ORWREC(n)=ORIFN;Action^Signature Sts^Release Sts^Nature of Order
"RTN","ORWDX",136,0)
SEND1 N ORVP,ORWI,ORWERR,ORWREL,ORWSIG,ORWNATR,ORDERID,ORBEF,ORLR,ORLAB,X
"RTN","ORWDX",137,0)
 S ORVP=DFN_";DPT(",ORL=ORL_";SC(",ORL(2)=ORL,ORWLST=0
"RTN","ORWDX",138,0)
 S ORLR=+$O(^DIC(9.4,"C","LR",0))
"RTN","ORWDX",139,0)
 S ORWI=0 F  S ORWI=$O(ORWREC(ORWI)) Q:'ORWI  D
"RTN","ORWDX",140,0)
 . S X=ORWREC(ORWI),ORWERR=""
"RTN","ORWDX",141,0)
 . S ORDERID=$P(X,U),ORWSIG=$P(X,U,2),ORWREL=$P(X,U,3),ORWNATR=$P(X,U,4)
"RTN","ORWDX",142,0)
 . S ORBEF=0
"RTN","ORWDX",143,0)
 . I '$D(^OR(100,+ORDERID,0)) Q
"RTN","ORWDX",144,0)
 . I $D(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0)) S ORBEF=$P(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0),U,15)
"RTN","ORWDX",145,0)
 . S:$D(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0)) ORWNATR=$S($P(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0),"^",4)=3:"",1:ORWNATR)
"RTN","ORWDX",146,0)
 . S ORWERR=$$CHKACT^ORWDXR(ORDERID,ORWSIG,ORWREL,ORWNATR)
"RTN","ORWDX",147,0)
 . I $L(ORWERR) S ORWERR="1^"_ORWERR
"RTN","ORWDX",148,0)
 . I '$L(ORWERR) D
"RTN","ORWDX",149,0)
 .. I $P(^OR(100,+ORDERID,0),U,14)=ORLR,'$G(ORLAB) D  ; lab batch start
"RTN","ORWDX",150,0)
 ... I $L($T(BHS^ORMBLD)) D BHS^ORMBLD(ORVP) S ORLAB=1
"RTN","ORWDX",151,0)
 .. N OK S OK=$$LOCK1^ORX2(ORDERID) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",152,0)
 .. I OK D EN^ORCSEND(ORDERID,"",ORWSIG,ORWREL,ORWNATR,"",.ORWERR),UNLK1^ORX2(ORDERID)
"RTN","ORWDX",153,0)
 . S ORWLST(ORWI)=ORDERID,X=""
"RTN","ORWDX",154,0)
 . I $L(ORWERR) S ORWLST(ORWI)=ORWLST(ORWI)_"^E^"_ORWERR Q
"RTN","ORWDX",155,0)
 . I ORWREL,((ORBEF=10)!(ORBEF=11)),($P(^OR(100,+ORDERID,3),U,3)'=10) S X="R"
"RTN","ORWDX",156,0)
 . I ORWSIG'=2 S X=X_"S"
"RTN","ORWDX",157,0)
 . S $P(ORWLST(ORWI),U,2)=X
"RTN","ORWDX",158,0)
 I $G(ORLAB) D BTS^ORMBLD(ORVP)
"RTN","ORWDX",159,0)
 Q
"RTN","ORWDX",160,0)
EXTVAL(IVAL,DLG) ; External value given a dlg ptr
"RTN","ORWDX",161,0)
 N ORDIALOG
"RTN","ORWDX",162,0)
 S ORDIALOG(DLG,0)=$P($G(^ORD(101.41,DLG,1)),U,1,2)
"RTN","ORWDX",163,0)
 S ORDIALOG(DLG,1)=IVAL
"RTN","ORWDX",164,0)
 I $E(ORDIALOG(DLG,0))="R",(+IVAL'=IVAL) Q IVAL  ; free text date/time
"RTN","ORWDX",165,0)
 Q $$EXT^ORCD(DLG,1)  ; all others
"RTN","ORWDX",166,0)
DLGID(VAL,ORIFN) ; return dlg IEN for order
"RTN","ORWDX",167,0)
 S VAL=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",168,0)
 S VAL=$S($P(VAL,";",2)="ORD(101.41,":+VAL,1:0)
"RTN","ORWDX",169,0)
 Q
"RTN","ORWDX",170,0)
FORMID(VAL,ORIFN)  ; Base dlg FormID for an order
"RTN","ORWDX",171,0)
 N DLG
"RTN","ORWDX",172,0)
 S VAL=0,DLG=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",173,0)
 Q:$P(DLG,";",2)'="ORD(101.41,"
"RTN","ORWDX",174,0)
 D FORMID^ORWDXM(.VAL,+DLG)
"RTN","ORWDX",175,0)
 Q
"RTN","ORWDX",176,0)
AGAIN(VAL,DLG)  ; return true to keep dlg for another order
"RTN","ORWDX",177,0)
 S VAL=''$P($G(^ORD(101.41,DLG,0)),U,9)
"RTN","ORWDX",178,0)
 Q
"RTN","ORWDX",179,0)
DGRP(VAL,DLG)   ; Display grp pointer for a dlg
"RTN","ORWDX",180,0)
 S DLG=$S($E(DLG)="`":+$P(DLG,"`",2),1:$O(^ORD(101.41,"AB",DLG,0))) ;kcm
"RTN","ORWDX",181,0)
 S VAL=$P($G(^ORD(101.41,DLG,0)),U,5)
"RTN","ORWDX",182,0)
 Q
"RTN","ORWDX",183,0)
DGNM(VAL,NM) ; Display grp pointer for name
"RTN","ORWDX",184,0)
 S VAL=$O(^ORD(100.98,"B",NM,0))
"RTN","ORWDX",185,0)
 Q
"RTN","ORWDX",186,0)
WRLST(LST,LOC) ; List of dlgs for writing orders
"RTN","ORWDX",187,0)
 G WRLST1^ORWDX1
"RTN","ORWDX",188,0)
MSG(LST,IEN) ; Msg text for orderable item
"RTN","ORWDX",189,0)
 N I
"RTN","ORWDX",190,0)
 S I=0 F  S I=$O(^ORD(101.43,IEN,8,I)) Q:I'>0  S LST(I)=^(I,0)
"RTN","ORWDX",191,0)
 Q
"RTN","ORWDX",192,0)
DISMSG(VAL,IEN) ; Disabled mge for ordering dlg
"RTN","ORWDX",193,0)
 S VAL=$P($G(^ORD(101.41,+IEN,0)),U,3)
"RTN","ORWDX",194,0)
 Q
"RTN","ORWDX",195,0)
LOCK(OK,DFN) ; Attempt to lock pt for ordering
"RTN","ORWDX",196,0)
 S OK=$$LOCK^ORX2(DFN)
"RTN","ORWDX",197,0)
 Q
"RTN","ORWDX",198,0)
UNLOCK(OK,DFN) ; Unlock pt for ordering
"RTN","ORWDX",199,0)
 D UNLOCK^ORX2(DFN) S OK=1
"RTN","ORWDX",200,0)
 Q
"RTN","ORWDX",201,0)
LOCKORD(OK,ORIFN) ; Attempt to lock order
"RTN","ORWDX",202,0)
 S OK=$$LOCK1^ORX2(ORIFN)
"RTN","ORWDX",203,0)
 Q
"RTN","ORWDX",204,0)
UNLKORD(OK,ORIFN) ; Unlock order
"RTN","ORWDX",205,0)
 D UNLK1^ORX2(ORIFN) S OK=1
"RTN","ORWDX",206,0)
 Q
"RTN","ORWDX1")
0^10^B11739165
"RTN","ORWDX1",1,0)
ORWDX1 ; SLC/KCM/REV - Utilities for Order Dialogs ;28-JAN-1999 12:37
"RTN","ORWDX1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,187,195**;Dec 17, 1997
"RTN","ORWDX1",3,0)
 ;
"RTN","ORWDX1",4,0)
WRLST(LST,LOC) ; Return list of dialogs for writing orders
"RTN","ORWDX1",5,0)
 ; .Y(n): DlgName^ListBox Text
"RTN","ORWDX1",6,0)
WRLST1 N ANENT
"RTN","ORWDX1",7,0)
 S LOC=+$G(LOC)_";SC(" I 'LOC S LOC=""
"RTN","ORWDX1",8,0)
 S ANENT="ALL^"_LOC_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+$G(^(5)),1:"")
"RTN","ORWDX1",9,0)
 D WRLSTB(.LST) Q:$D(LST)>1  ; check ORWDX WRITE ORDERS first
"RTN","ORWDX1",10,0)
 N ORX,X0,X5,ORERR,I,SEQ,IEN,DGRP,FID,TXT,TYP
"RTN","ORWDX1",11,0)
 D GETLST^XPAR(.ORX,ANENT,"ORWOR WRITE ORDERS LIST","Q",.ORERR) Q:ORERR
"RTN","ORWDX1",12,0)
 S I=0 F  S I=$O(ORX(I)) Q:'I  D
"RTN","ORWDX1",13,0)
 . S SEQ=+ORX(I),IEN=$P(ORX(I),U,2),X0=^ORD(101.41,IEN,0),X5=$G(^(5))
"RTN","ORWDX1",14,0)
 . S DGRP=+$P(X0,U,5),FID=+$P(X5,U,5),TXT=$P(X5,U,4),TYP=$P(X0,U,4)
"RTN","ORWDX1",15,0)
 . S:'$L(TXT) TXT=$P(X0,U,2)
"RTN","ORWDX1",16,0)
 . I $P(X0,U,4)="M" S:'FID FID=1001
"RTN","ORWDX1",17,0)
 . S LST(SEQ)=IEN_";"_FID_";"_DGRP_";"_TYP_U_TXT
"RTN","ORWDX1",18,0)
 Q
"RTN","ORWDX1",19,0)
WRLSTB(LST)     ; return menu from which Write Orders list is built
"RTN","ORWDX1",20,0)
 N MNU,SEQ,IEN,ITM,TXT,FID,DGRP,X,TYP
"RTN","ORWDX1",21,0)
 S MNU=$$GET^XPAR(ANENT,"ORWDX WRITE ORDERS LIST",1,"I") Q:'MNU
"RTN","ORWDX1",22,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,MNU,10,"B",SEQ)) Q:'SEQ  D
"RTN","ORWDX1",23,0)
 . S IEN=0 F  S IEN=$O(^ORD(101.41,MNU,10,"B",SEQ,IEN)) Q:'IEN  D
"RTN","ORWDX1",24,0)
 . . S X=$G(^ORD(101.41,MNU,10,IEN,0)),ITM=+$P(X,U,2),TXT=$P(X,U,4)
"RTN","ORWDX1",25,0)
 . . S X=$G(^ORD(101.41,ITM,5)),FID=+$P(X,U,5)
"RTN","ORWDX1",26,0)
 . . S X=$G(^ORD(101.41,ITM,0)),TYP=$P(X,U,4),DGRP=+$P(X,U,5)
"RTN","ORWDX1",27,0)
 . . S:'$L(TXT) TXT=$P(X,U,2)
"RTN","ORWDX1",28,0)
 . . I TYP="M" S:'FID FID=1001
"RTN","ORWDX1",29,0)
 . . S LST(SEQ)=ITM_";"_FID_";"_DGRP_";"_TYP_U_TXT
"RTN","ORWDX1",30,0)
 Q
"RTN","ORWDX1",31,0)
DELPI ; delete PI from ORDIALOG if PI = ""
"RTN","ORWDX1",32,0)
 ;Called from SAVE^ORWDX
"RTN","ORWDX1",33,0)
 N ORPI S ORPI=0
"RTN","ORWDX1",34,0)
 S ORPI=$O(^ORD(101.41,"B","OR GTX PATIENT INSTRUCTIONS",ORPI))
"RTN","ORWDX1",35,0)
 Q:'$D(ORDIALOG(ORPI))
"RTN","ORWDX1",36,0)
 I '$D(ORDIALOG(ORPI,1)) K ORDIALOG(ORPI),ORDIALOG("WP",ORPI) Q
"RTN","ORWDX1",37,0)
 N PINODE,PITX
"RTN","ORWDX1",38,0)
 S PITX="",PINODE=$G(ORDIALOG(ORPI,1))
"RTN","ORWDX1",39,0)
 S PITX=$G(@PINODE@(1,0))
"RTN","ORWDX1",40,0)
 S PITX=$TR(PITX," ","")
"RTN","ORWDX1",41,0)
 I '$L(PITX) K ORDIALOG(ORPI),ORDIALOG("WP",ORPI)
"RTN","ORWDX1",42,0)
 Q
"RTN","ORWDX1",43,0)
FNDINFO(Y,ODIEN) ;
"RTN","ORWDX1",44,0)
 N ODI,CRTM,FRM,XX
"RTN","ORWDX1",45,0)
 S FRM="",CRTM=$$NOW^XLFDT
"RTN","ORWDX1",46,0)
 F  S FRM=$O(^ORD(101.43,XRF,FRM)) Q:FRM=""  D
"RTN","ORWDX1",47,0)
 . S ODI=0 F  S ODI=$O(^ORD(101.43,XRF,FRM,ODI)) Q:'ODI  D
"RTN","ORWDX1",48,0)
 .. S XX=^ORD(101.43,XRF,FRM,ODI)
"RTN","ORWDX1",49,0)
 .. I +$P(XX,U,3),$P(XX,U,3)<CRTM Q
"RTN","ORWDX1",50,0)
 .. I ODI=ODIEN D
"RTN","ORWDX1",51,0)
 ... S NM=NM+1
"RTN","ORWDX1",52,0)
 ... I 'XX S Y(NM)=ODIEN_U_$P(XX,U,2)_U_$P(XX,U,2)
"RTN","ORWDX1",53,0)
 ... E  S Y(NM)=ODIEN_U_$P(XX,U,2)_$C(9)_"<"_$P(XX,U,4)_">"_U_$P(XX,U,4)
"RTN","ORWDX1",54,0)
 Q
"RTN","ORWDX1",55,0)
DLGDEF(LST,DLG) ; Format mapping for a dlg
"RTN","ORWDX1",56,0)
 N I,IEN,ILST,X0,X2,XW  S ILST=0
"RTN","ORWDX1",57,0)
 I $O(^ORD(101.41,"AB",DLG,0))>0 S DLG=$O(^ORD(101.41,"AB",DLG,0))
"RTN","ORWDX1",58,0)
 E  S DLG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWDX1",59,0)
 Q:'DLG
"RTN","ORWDX1",60,0)
 S I=0 F  S I=$O(^ORD(101.41,DLG,10,I)) Q:I'>0  D
"RTN","ORWDX1",61,0)
 . S X0=$G(^ORD(101.41,DLG,10,I,0)),X2=$G(^(2)),IEN=+$P(X0,U,2)
"RTN","ORWDX1",62,0)
 . S ILST=ILST+1,LST(ILST)=U_IEN_U_$P(X2,U,1,7)
"RTN","ORWDX1",63,0)
 . I $P(X0,U,11) S $P(LST(ILST),U,11)=1
"RTN","ORWDX1",64,0)
 . S $P(LST(ILST),U)=$P($G(^ORD(101.41,IEN,1)),U,3)
"RTN","ORWDX1",65,0)
 . I $P($G(^ORD(101.41,IEN,0)),U)="OR GTX ADDITIVE" S $P(LST(ILST),U)="ADDITIVE"
"RTN","ORWDX1",66,0)
 . I $L($P(LST(ILST),U))=0 S $P(LST(ILST),U)="ID"_IEN
"RTN","ORWDX1",67,0)
 . I $D(^ORD(101.41,DLG,10,"DAD",IEN)) D
"RTN","ORWDX1",68,0)
 .. N SEQ,DA,CHILD S CHILD=""
"RTN","ORWDX1",69,0)
 .. S SEQ=0 F  S SEQ=$O(^ORD(101.41,DLG,10,"DAD",IEN,SEQ)) Q:'SEQ  D
"RTN","ORWDX1",70,0)
 ... S DA=0 F  S DA=$O(^ORD(101.41,DLG,10,"DAD",IEN,SEQ,DA)) Q:'DA  D
"RTN","ORWDX1",71,0)
 .... S CHILD=CHILD_+$P($G(^ORD(101.41,DLG,10,DA,0)),U,2)_"~"
"RTN","ORWDX1",72,0)
 .. S $P(LST(ILST),U,10)=CHILD
"RTN","ORWDX1",73,0)
 Q
"RTN","ORWDX1",74,0)
ISPEND(ORIFN) ;Is the order's status pending?
"RTN","ORWDX1",75,0)
 N ISPEND,PENDST,N3 S ISPEND=0
"RTN","ORWDX1",76,0)
 Q:'$D(^OR(100,+ORIFN,3))
"RTN","ORWDX1",77,0)
 S PENDST=$O(^ORD(100.01,"B","PENDING",0))
"RTN","ORWDX1",78,0)
 S N3=$G(^OR(100,+ORIFN,3))
"RTN","ORWDX1",79,0)
 I $P(N3,U,3)=PENDST S ISPEND=1
"RTN","ORWDX1",80,0)
 Q ISPEND
"RTN","ORWDXA")
0^76^B77703633
"RTN","ORWDXA",1,0)
ORWDXA ; SLC/KCM/JLI - Utilites for Order Actions; 2/10/03 9:13Am
"RTN","ORWDXA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,132,148,141,149,187,213,195**;Dec 17, 1997
"RTN","ORWDXA",3,0)
 ;
"RTN","ORWDXA",4,0)
VALID(VAL,ORID,ACTION,ORNP,ORWNAT) ; Return error message if not valid action for order
"RTN","ORWDXA",5,0)
 N ORACT,ORVP,ORVER,ORIFN,PRTID S VAL="",PRTID=0
"RTN","ORWDXA",6,0)
 I +ORID=0 S VAL="This order has been deleted." Q
"RTN","ORWDXA",7,0)
 I '$D(^OR(100,+ORID,0)) S VAL="This order has been deleted!" Q
"RTN","ORWDXA",8,0)
 I ACTION="XFR",'$L($T(XFR^ORCACT01)) S ACTION="RW" ; for pre-POE
"RTN","ORWDXA",9,0)
 N ORNSS S ORNSS=1
"RTN","ORWDXA",10,0)
 I (ACTION="RN") D VALSCH^ORWNSS(.ORNSS,ORID)
"RTN","ORWDXA",11,0)
 I ORNSS=0 S VAL="This order contains an invalid administration schedule." Q
"RTN","ORWDXA",12,0)
 S ORIFN=ORID,ORVP=$P(^OR(100,+ORID,0),U,2)  ; ORCACT0 expects defined
"RTN","ORWDXA",13,0)
 I (ACTION="RN") D  Q:$L(VAL)  ; ** There's got to be a better way!
"RTN","ORWDXA",14,0)
 . N DLG S DLG=$P(^OR(100,+ORID,0),U,5) Q:DLG'[";ORD(101.41,"
"RTN","ORWDXA",15,0)
 . I $G(^ORD(101.41,+DLG,3))'["PROVIDER^ORCDPSIV" Q
"RTN","ORWDXA",16,0)
 . D AUTH^ORWDPS32(.VAL,ORNP)
"RTN","ORWDXA",17,0)
 . I VAL S VAL=$P(VAL,U,2)
"RTN","ORWDXA",18,0)
 . E  S VAL=""
"RTN","ORWDXA",19,0)
 S ORVER=$S(ACTION="CR":"R",$D(^XUSEC("ORELSE",DUZ)):"N",$D(^XUSEC("OREMAS",DUZ)):"C",1:"^")
"RTN","ORWDXA",20,0)
 I ACTION="CR" S ACTION="VR"
"RTN","ORWDXA",21,0)
 I (ACTION="ES")!(ACTION="OC")!(ACTION="RS") S ORACT=ACTION ; why not defined???
"RTN","ORWDXA",22,0)
 I (ACTION="VR"),'($D(^XUSEC("ORELSE",DUZ))!$D(^XUSEC("OREMAS",DUZ))) D  Q
"RTN","ORWDXA",23,0)
 . S VAL="You are not authorized to verify these orders."
"RTN","ORWDXA",24,0)
 I $L(VAL) Q
"RTN","ORWDXA",25,0)
 N OIIEN,ISIV,IVOD
"RTN","ORWDXA",26,0)
 S (ISIV,OIIEN,IVOD)=0
"RTN","ORWDXA",27,0)
 I (ACTION="RW")!(ACTION="XX")!(ACTION="XFR") D  Q:$L(VAL)
"RTN","ORWDXA",28,0)
 . S ISIV=$P(^OR(100,+ORID,0),U,11)
"RTN","ORWDXA",29,0)
 . I ISIV,($P(^ORD(100.98,ISIV,0),U,3)="IV RX") S IVOD=1
"RTN","ORWDXA",30,0)
 . D:'IVOD GTORITM^ORWDXR(.OIIEN,+ORID)
"RTN","ORWDXA",31,0)
 . D:OIIEN ISACTOI(.VAL,OIIEN) I $L(VAL)>0 Q
"RTN","ORWDXA",32,0)
 . N DLG,FRM
"RTN","ORWDXA",33,0)
 . S DLG=$P(^OR(100,+ORID,0),U,5),FRM=0
"RTN","ORWDXA",34,0)
 . I $P(DLG,";",2)'="ORD(101.41," S DLG=0
"RTN","ORWDXA",35,0)
 . I DLG D FORMID^ORWDXM(.FRM,+DLG)
"RTN","ORWDXA",36,0)
 . I '(DLG&FRM) D
"RTN","ORWDXA",37,0)
 . . S VAL="Copy & Change are not implemented for this order that predates CPRS."
"RTN","ORWDXA",38,0)
 N OREBUILD  ; sometimes left defined by $$VALID
"RTN","ORWDXA",39,0)
 I $$VALID^ORCACT0(ORID,ACTION,.VAL,$G(ORWNAT)) S VAL="" ; VAL=error
"RTN","ORWDXA",40,0)
 Q
"RTN","ORWDXA",41,0)
HOLD(REC,ORID,ORNP)  ; Place an order on hold
"RTN","ORWDXA",42,0)
 N ACTDA
"RTN","ORWDXA",43,0)
 S ACTDA=$$ACTION^ORCSAVE("HD",+ORID,ORNP)
"RTN","ORWDXA",44,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",45,0)
 Q
"RTN","ORWDXA",46,0)
UNHOLD(REC,ORID,ORNP)  ; Release an order from hold
"RTN","ORWDXA",47,0)
 N ACTDA
"RTN","ORWDXA",48,0)
 S ACTDA=$$ACTION^ORCSAVE("RL",+ORID,ORNP)
"RTN","ORWDXA",49,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",50,0)
 Q
"RTN","ORWDXA",51,0)
DC(REC,ORID,ORNP,ORL,REASON)   ; Discontinue/Cancel/Delete an order
"RTN","ORWDXA",52,0)
 N NATURE,CREATE,PRINT,STATUS,ACTDA,SIGSTS
"RTN","ORWDXA",53,0)
 N X3,X8,CURRACT
"RTN","ORWDXA",54,0)
 Q:'+ORID
"RTN","ORWDXA",55,0)
 S CURRACT=0
"RTN","ORWDXA",56,0)
 S ORL(2)=ORL_";SC(",ORL=ORL(2),NATURE=""
"RTN","ORWDXA",57,0)
 I REASON S NATURE=$P(^ORD(100.02,$P(^ORD(100.03,REASON,0),U,7),0),U,2)
"RTN","ORWDXA",58,0)
 S:NATURE="" NATURE="W"  ; S:ORNP=DUZ NATURE="E" 
"RTN","ORWDXA",59,0)
 S CREATE=$$CREATE^ORX1(NATURE),PRINT=$$PRINT^ORCACT2(NATURE)
"RTN","ORWDXA",60,0)
 S X3=$G(^OR(100,+ORID,3))
"RTN","ORWDXA",61,0)
 S CURRACT=$P(X3,U,7) S:CURRACT<1 CURRACT=+$O(^OR(100,+ORID,8,"?"),-1)
"RTN","ORWDXA",62,0)
 I '$D(^OR(100,+ORID,8,+$P(ORID,";",2),0)) D
"RTN","ORWDXA",63,0)
 . S X8=$G(^OR(100,+ORID,8,CURRACT,0))
"RTN","ORWDXA",64,0)
 . S SIGSTS=$P(X8,U,4)
"RTN","ORWDXA",65,0)
 . S $P(ORID,";",2)=CURRACT
"RTN","ORWDXA",66,0)
 E  D
"RTN","ORWDXA",67,0)
 . S X8=^OR(100,+ORID,8,+$P(ORID,";",2),0)
"RTN","ORWDXA",68,0)
 . S SIGSTS=$P(X8,U,4)
"RTN","ORWDXA",69,0)
 I '$D(SIGSTS) S SIGSTS=1
"RTN","ORWDXA",70,0)
 S STATUS=$P($G(^OR(100,+ORID,8,+$P(ORID,";",2),0)),U,15)
"RTN","ORWDXA",71,0)
 I (STATUS=10)!(STATUS=11) D  Q   ; delete/cancel unreleased order
"RTN","ORWDXA",72,0)
 . N RPLORD
"RTN","ORWDXA",73,0)
 . S RPLORD=$P($G(^OR(100,+ORID,3)),U,5)    ; replaced order
"RTN","ORWDXA",74,0)
 . D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",75,0)
 . I STATUS=10,($P(X8,U,4)'=2) D  ; CANCEL signed, delayed, unreleased
"RTN","ORWDXA",76,0)
 . . ; taken from CLRDLY^ORCACT2
"RTN","ORWDXA",77,0)
 . . I REASON D SET^ORCACT2(+ORID,NATURE,REASON)
"RTN","ORWDXA",78,0)
 . . I 'REASON D SET^ORCACT2(+ORID,"M","","Delayed Order Cancelled")
"RTN","ORWDXA",79,0)
 . . D STATUS^ORCSAVE2(+ORID,13) S $P(^OR(100,+ORID,8,1,0),U,15)=13
"RTN","ORWDXA",80,0)
 . E  D                           ; DELETE unsigned, unreleased
"RTN","ORWDXA",81,0)
 . . I $P(X8,U,2)="DC" K ^OR(100,+ORID,6)
"RTN","ORWDXA",82,0)
 . . ; delete fwd ptr to order about to be deleted
"RTN","ORWDXA",83,0)
 . . I RPLORD,$P(X8,U,2)="NW" S $P(^OR(100,RPLORD,3),U,6)=""
"RTN","ORWDXA",84,0)
 . . ; delete ptr to order in Patient Event file #100.2
"RTN","ORWDXA",85,0)
 . . N EVT S EVT=$P($G(^OR(100,+ORID,0)),U,17) I EVT,EVT=+$O(^ORE(100.2,"AO",+ORID,0)) S $P(^ORE(100.2,EVT,0),U,4)="" K ^ORE(100.2,"AO",+ORID,EVT)
"RTN","ORWDXA",86,0)
 . . D DELETE^ORCSAVE2(ORID)
"RTN","ORWDXA",87,0)
 . I RPLORD,'(SIGSTS=1) S ORID=RPLORD  ; for Renews & Changes, show replaced order
"RTN","ORWDXA",88,0)
 . I '$D(^OR(100,+ORID)) D
"RTN","ORWDXA",89,0)
 . . S $P(REC(1),U)="~0",REC(2)="tDELETED: "_$E(REC(2),2,245)
"RTN","ORWDXA",90,0)
 . E  D
"RTN","ORWDXA",91,0)
 . . K REC
"RTN","ORWDXA",92,0)
 . . D GETBYIFN^ORWORR(.REC,+ORID_";"_$P($G(^OR(100,+ORID,3)),U,7))
"RTN","ORWDXA",93,0)
 . S $P(REC(1),U,14)=2 ; DCType = deletion
"RTN","ORWDXA",94,0)
 I CREATE D
"RTN","ORWDXA",95,0)
 . S ACTDA=$$ACTION^ORCSAVE("DC",+ORID,ORNP)
"RTN","ORWDXA",96,0)
 . D SET^ORCACT2(+ORID,NATURE,REASON)
"RTN","ORWDXA",97,0)
 E  D 
"RTN","ORWDXA",98,0)
 . D EN^ORCSEND(+ORID,"DC",3,1,NATURE,REASON)
"RTN","ORWDXA",99,0)
 . S ACTDA=$P(ORID,";",2)
"RTN","ORWDXA",100,0)
 . I PRINT ; do something to print this
"RTN","ORWDXA",101,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",102,0)
 S $P(REC(1),U,14)=$S(CREATE:1,1:3)  ;DCType - 1=NewOrder, 3=NewStatus
"RTN","ORWDXA",103,0)
 Q
"RTN","ORWDXA",104,0)
DCREASON(LST)   ; Return a list of DC reasons
"RTN","ORWDXA",105,0)
 N IEN,ILST,X
"RTN","ORWDXA",106,0)
 S ILST=1,LST(ILST)="~DCReason"
"RTN","ORWDXA",107,0)
 S IEN=0 F  S IEN=$O(^ORD(100.03,IEN)) Q:'IEN  S X=^(IEN,0) D
"RTN","ORWDXA",108,0)
 . I $P(X,U,4) Q                              ; inactive
"RTN","ORWDXA",109,0)
 . I $P(X,U,5)'=+$O(^DIC(9.4,"C","OR",0)) Q   ; not OR pkg
"RTN","ORWDXA",110,0)
 . I $P(X,U,7)=+$O(^ORD(100.02,"C","A",0)) Q  ; nature=auto
"RTN","ORWDXA",111,0)
 . S ILST=ILST+1,LST(ILST)="i"_IEN_U_$P(X,U)
"RTN","ORWDXA",112,0)
 S IEN=$O(^ORD(100.03,"C","ORREQ",0))
"RTN","ORWDXA",113,0)
 I IEN S ILST=ILST+1,LST(ILST)="d"_IEN_U_$P(^ORD(100.03,IEN,0),U)
"RTN","ORWDXA",114,0)
 Q
"RTN","ORWDXA",115,0)
DCREQIEN(VAL)   ; Return the IEN for Requesting Physician Cancelled reason
"RTN","ORWDXA",116,0)
 S VAL=$O(^ORD(100.03,"S","REQ",0))
"RTN","ORWDXA",117,0)
 Q
"RTN","ORWDXA",118,0)
COMPLETE(REC,ORID,ESCODE)      ; Complete an order (generic orders)
"RTN","ORWDXA",119,0)
 ;N X S X=+$E($$NOW^XLFDT,1,12)
"RTN","ORWDXA",120,0)
 ;D DATES^ORCSAVE2(+ORID,,X)
"RTN","ORWDXA",121,0)
 ;D STATUS^ORCSAVE2(+ORID,2)
"RTN","ORWDXA",122,0)
 ; validate ESCode
"RTN","ORWDXA",123,0)
 D COMP^ORCSAVE2(ORID)
"RTN","ORWDXA",124,0)
 D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",125,0)
 Q
"RTN","ORWDXA",126,0)
VERIFY(REC,ORID,ESCODE,ORVER) ; Verify an order
"RTN","ORWDXA",127,0)
 ; validate ESCode
"RTN","ORWDXA",128,0)
 S ORVER=$G(ORVER,$S($D(^XUSEC("ORELSE",DUZ)):"N",$D(^XUSEC("OREMAS",DUZ)):"C",1:U))
"RTN","ORWDXA",129,0)
 I ORVER'=U D
"RTN","ORWDXA",130,0)
 . N ORIFN,ORES,ORI
"RTN","ORWDXA",131,0)
 . ; to match 56, need to VERIFY any replaced orders:
"RTN","ORWDXA",132,0)
 . S ORIFN=ORID,ORES(ORIFN)="" D REPLCD^ORCACT1
"RTN","ORWDXA",133,0)
 . S ORI="" F  S ORI=$O(ORES(ORI)) Q:ORI=""  D EN^ORCSEND(ORI,"VR","",""),UNLK1^ORX2(+ORI):ORI'=ORID ;ORID locked prior
"RTN","ORWDXA",134,0)
 D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",135,0)
 Q
"RTN","ORWDXA",136,0)
ALERT(DUMMY,ORID,ORDUZ)       ;send alert to user (ORDUZ) when order (ORID) resulted
"RTN","ORWDXA",137,0)
 ;if no user passed from GUI, use ordering provider:
"RTN","ORWDXA",138,0)
 I $G(ORDUZ)<1 S ORDUZ=+$$ORDERER^ORQOR2(+ORID)
"RTN","ORWDXA",139,0)
 I $L($G(ORDUZ))<1 S ORDUZ=DUZ
"RTN","ORWDXA",140,0)
 S DUMMY=1,$P(^OR(100,+ORID,3),U,10)=ORDUZ
"RTN","ORWDXA",141,0)
 Q
"RTN","ORWDXA",142,0)
FLAG(REC,ORIFN,OREASON,ORNP)   ; Flag an order
"RTN","ORWDXA",143,0)
 N ORB,ORVP,DA,ORPS
"RTN","ORWDXA",144,0)
 D BULLETIN
"RTN","ORWDXA",145,0)
 S DA=$P(ORIFN,";",2),ORVP=+$P(^OR(100,+ORIFN,0),U,2)
"RTN","ORWDXA",146,0)
 K ^OR(100,+ORIFN,8,DA,3) S ^(3)="1^"_$G(XMZ)_U_+$E($$NOW^XLFDT,1,12)_U_DUZ_U_OREASON
"RTN","ORWDXA",147,0)
 D KILL^XM,MSG^ORCFLAG(ORIFN)
"RTN","ORWDXA",148,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; Last Activity
"RTN","ORWDXA",149,0)
 I +$G(ORNP)<1 S ORNP=+$P($G(^OR(100,+ORIFN,8,DA,0)),U,3)
"RTN","ORWDXA",150,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^1" D EN^OCXOERR(ORB) ; notification
"RTN","ORWDXA",151,0)
 D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXA",152,0)
 Q
"RTN","ORWDXA",153,0)
BULLETIN        ; Send flagged order bulletin (USED BY FLAG)
"RTN","ORWDXA",154,0)
 N OR0,OR3,ORDTXT,XMB,XMY,XMDUZ,ORENT,BULL,ORSRV,ORUSR
"RTN","ORWDXA",155,0)
 S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3))
"RTN","ORWDXA",156,0)
 ;CLA - 3/21/96:
"RTN","ORWDXA",157,0)
 S ORUSR=+$P(OR0,U,4)
"RTN","ORWDXA",158,0)
 S ORSRV=$G(^VA(200,ORUSR,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORWDXA",159,0)
 S ORENT="USR.`"_ORUSR_"^SRV.`"_$G(ORSRV)_"^DIV^SYS^PKG"
"RTN","ORWDXA",160,0)
 S BULL=$$GET^XPAR(ORENT,"ORB FLAGGED ORDERS BULLETIN",1,"Q")
"RTN","ORWDXA",161,0)
 Q:$G(BULL)'="Y"   ;quit if parameter value is not 'Y'es
"RTN","ORWDXA",162,0)
 ;
"RTN","ORWDXA",163,0)
 S XMB="OR FLAGGED ORDER",XMDUZ=DUZ,XMY(+$P(OR0,U,4))=""
"RTN","ORWDXA",164,0)
 S XMB(1)=$P(^DPT(+$P(OR0,U,2),0),U),XMB(2)=$P(^(0),U,9),XMB(3)="" ;sb AGE
"RTN","ORWDXA",165,0)
 S XMB(4)=$$FMTE^XLFDT($P(OR0,U,7))
"RTN","ORWDXA",166,0)
 D TEXT^ORQ12(.ORDTXT,+ORIFN,80)
"RTN","ORWDXA",167,0)
 S XMB(5)=$G(ORDTXT(1)),XMB(6)=$G(ORDTXT(2)),XMB(7)=$G(ORDTXT(3))
"RTN","ORWDXA",168,0)
 S XMB(8)=$$FMTE^XLFDT($P(OR0,U,8)),XMB(9)=$$FMTE^XLFDT($P(OR0,U,9)),XMB(10)=OREASON
"RTN","ORWDXA",169,0)
 S XMB(11)=$P($G(^ORD(100.01,+$P(OR3,U,3),0)),U)
"RTN","ORWDXA",170,0)
 D EN^XMB
"RTN","ORWDXA",171,0)
 Q
"RTN","ORWDXA",172,0)
UNFLAG(REC,ORIFN,OREASON)       ; Unflag an order
"RTN","ORWDXA",173,0)
 N DA,ORB,ORNP,ORVP,ORPS
"RTN","ORWDXA",174,0)
 S DA=$P(ORIFN,";",2),ORVP=+$P(^OR(100,+ORIFN,0),U,2)
"RTN","ORWDXA",175,0)
 S $P(^OR(100,+ORIFN,8,DA,3),U)=0,$P(^(3),U,6,8)=+$E($$NOW^XLFDT,1,12)_U_DUZ_U_OREASON D MSG^ORCFLAG(ORIFN)
"RTN","ORWDXA",176,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT  ; Last Activity
"RTN","ORWDXA",177,0)
 S ORNP=+$P($G(^OR(100,+ORIFN,8,DA,0)),U,3)
"RTN","ORWDXA",178,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^0" D EN^OCXOERR(ORB) ; notification
"RTN","ORWDXA",179,0)
 D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXA",180,0)
 Q
"RTN","ORWDXA",181,0)
FLAGTXT(LST,ORID)      ; Return flag reason
"RTN","ORWDXA",182,0)
 N FLAG
"RTN","ORWDXA",183,0)
 S FLAG=$G(^OR(100,+ORID,8,$P(ORID,";",2),3))
"RTN","ORWDXA",184,0)
 S LST(1)="FLAGGED: "_$$FMTE^XLFDT($P(FLAG,U,3))_" by "_$P($G(^VA(200,+$P(FLAG,U,4),0)),U)
"RTN","ORWDXA",185,0)
 S LST(2)=$P(FLAG,U,5) ; reason
"RTN","ORWDXA",186,0)
 Q
"RTN","ORWDXA",187,0)
WCGET(LST,ORID) ; Return ward comments
"RTN","ORWDXA",188,0)
 N I,ORIFN,ACT S ORIFN=+ORID,ACT=+$P(ORID,";",2)
"RTN","ORWDXA",189,0)
 S I=0 F  S I=$O(^OR(100,ORIFN,8,ACT,5,I)) Q:'I  S LST(I)=$G(^(I,0))
"RTN","ORWDXA",190,0)
 Q
"RTN","ORWDXA",191,0)
WCPUT(ERR,ORID,WCLST) ; Set ward comments for order
"RTN","ORWDXA",192,0)
 N DIERR,ERRLST,ORIFN,ACT S ORIFN=+ORID,ACT=+$P(ORID,";",2)
"RTN","ORWDXA",193,0)
 D WP^DIE(100.008,ACT_","_ORIFN_",",50,"","WCLST","ERRLST")
"RTN","ORWDXA",194,0)
 S ERR="" I $D(DIERR) S ERR="An error occurred while saving comments."
"RTN","ORWDXA",195,0)
 Q
"RTN","ORWDXA",196,0)
OFCPLX(ORY,ORID,PRTORDER) ;Check if ORID is an child of the PRTORDER
"RTN","ORWDXA",197,0)
 N NUMCHDS,NOWID,NOWVAL,X3,ORDA,ISNOW
"RTN","ORWDXA",198,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXA",199,0)
 S ISNOW=0
"RTN","ORWDXA",200,0)
 D ISNOW^ORWDXR(.ISNOW,+ORID)
"RTN","ORWDXA",201,0)
 Q:ISNOW
"RTN","ORWDXA",202,0)
 N PKG
"RTN","ORWDXA",203,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXA",204,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXA",205,0)
 I PKG'="PS" Q
"RTN","ORWDXA",206,0)
 I $L($G(^OR(100,+ORID,3))),('$L($P(^(3),U,9))) Q
"RTN","ORWDXA",207,0)
 S (NUMCHDS,NOWID,NOWVAL,X3,ORDA)=0
"RTN","ORWDXA",208,0)
 S PRTORDER=+$P(^(3),U,9)
"RTN","ORWDXA",209,0)
 S X3=$G(^OR(100,PRTORDER,3)),ORDA=$P(X3,U,7)
"RTN","ORWDXA",210,0)
 S PRTORDER=PRTORDER_";"_ORDA
"RTN","ORWDXA",211,0)
 S NUMCHDS=$P($G(^OR(100,+PRTORDER,2,0)),U,4)
"RTN","ORWDXA",212,0)
 I NUMCHDS>2 S ORY="COMPLEX-PSI"_U_PRTORDER
"RTN","ORWDXA",213,0)
 S:$D(^OR(100,+PRTORDER,4.5,"ID","NOW")) NOWID=$O(^("NOW",0))
"RTN","ORWDXA",214,0)
 S:NOWID NOWVAL=$G(^OR(100,+PRTORDER,4.5,NOWID,1))
"RTN","ORWDXA",215,0)
 I NOWVAL=1 Q
"RTN","ORWDXA",216,0)
 E  S ORY="COMPLEX-PSI"_U_PRTORDER
"RTN","ORWDXA",217,0)
 Q
"RTN","ORWDXA",218,0)
ISACTOI(ORY,OI) ;If it's an active orderable item
"RTN","ORWDXA",219,0)
 I $G(^ORD(101.43,+OI,.1)),^(.1)'>$$NOW^XLFDT D
"RTN","ORWDXA",220,0)
 . S ORY=$P($G(^ORD(101.43,OI,0)),U)_" has been inactivated and may not be ordered anymore."
"RTN","ORWDXA",221,0)
 Q
"RTN","ORWDXM2")
0^49^B61220482
"RTN","ORWDXM2",1,0)
ORWDXM2 ; SLC/KCM - Quick Orders ;11/25/02  09:49
"RTN","ORWDXM2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,116,132,158,187,195**;Dec 17, 1997
"RTN","ORWDXM2",3,0)
 ;
"RTN","ORWDXM2",4,0)
CLRRCL(OK)      ; clear ORECALL
"RTN","ORWDXM2",5,0)
 S OK=1
"RTN","ORWDXM2",6,0)
 K ^TMP("ORECALL",$J),^TMP("ORWDXMQ",$J)
"RTN","ORWDXM2",7,0)
 Q
"RTN","ORWDXM2",8,0)
VERTXT ; set verify text for order
"RTN","ORWDXM2",9,0)
 N SEQ,DA,X,PROMPT,MULT,CHILD,INST,TITLE,ILST,SPACES
"RTN","ORWDXM2",10,0)
 S ILST=0,$P(SPACES," ",31)=""
"RTN","ORWDXM2",11,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:SEQ'>0  D
"RTN","ORWDXM2",12,0)
 . S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORWDXM2",13,0)
 . . S X0=$G(^ORD(101.41,+ORDIALOG,10,DA,0))
"RTN","ORWDXM2",14,0)
 . . Q:$P(X0,U,9)["*"  ; hidden prompt
"RTN","ORWDXM2",15,0)
 . . S PROMPT=$P(X0,U,2),MULT=$P(X0,U,7),CHILD=$P(X0,U,11) Q:CHILD
"RTN","ORWDXM2",16,0)
 . . Q:'PROMPT  S INST=$O(ORDIALOG(PROMPT,0)) Q:'INST  ; no values
"RTN","ORWDXM2",17,0)
 . . S TITLE=$S($L($G(ORDIALOG(PROMPT,"TTL"))):ORDIALOG(PROMPT,"TTL"),1:ORDIALOG(PROMPT,"A"))
"RTN","ORWDXM2",18,0)
 . . I $E(ORDIALOG(PROMPT,0))="W" D
"RTN","ORWDXM2",19,0)
 . . . N IWP,WP,CNT
"RTN","ORWDXM2",20,0)
 . . . S IWP=0,CNT=0
"RTN","ORWDXM2",21,0)
 . . . F  S IWP=$O(^TMP("ORWORD",$J,PROMPT,INST,IWP)) Q:'IWP  D
"RTN","ORWDXM2",22,0)
 . . . . S CNT=CNT+1,WP(CNT)=^TMP("ORWORD",$J,PROMPT,INST,IWP,0)
"RTN","ORWDXM2",23,0)
 . . . I CNT=1 S ILST=ILST+1,LST(ILST)=$J(TITLE,30)_WP(1)
"RTN","ORWDXM2",24,0)
 . . . I CNT>1 D 
"RTN","ORWDXM2",25,0)
 . . . . S ILST=ILST+1,LST(ILST)=TITLE,IWP=0
"RTN","ORWDXM2",26,0)
 . . . . F  S IWP=$O(WP(IWP)) Q:'IWP  S ILST=ILST+1,LST(ILST)=WP(IWP)
"RTN","ORWDXM2",27,0)
 . . E  D
"RTN","ORWDXM2",28,0)
 . . . S ILST=ILST+1,LST(ILST)=$J(TITLE,30)
"RTN","ORWDXM2",29,0)
 . . . S LST(ILST)=LST(ILST)_$$ITEM^ORCDLG(PROMPT,INST)
"RTN","ORWDXM2",30,0)
 . . Q:'MULT  Q:'$O(ORDIALOG(PROMPT,INST))  ; done
"RTN","ORWDXM2",31,0)
 . . F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:INST'>0  S ILST=ILST+1,LST(ILST)=SPACES_$$ITEM^ORCDLG(PROMPT,INST)
"RTN","ORWDXM2",32,0)
 D DISPLAY^ORWDBA3  ;for display of Billing Aware data from orig order
"RTN","ORWDXM2",33,0)
 Q
"RTN","ORWDXM2",34,0)
RA ; setup environment for radiology
"RTN","ORWDXM2",35,0)
 ; -- get imaging types based on display group of quick order and
"RTN","ORWDXM2",36,0)
 ;    setup list of imaging locations based on imaging type
"RTN","ORWDXM2",37,0)
 N ORY,ITYPE,IFN,CNT,ORIMLOC,PROMPT
"RTN","ORWDXM2",38,0)
 S ORDIV=$$DIV^ORCDRA1,ITYPE=$P($G(^ORD(100.98,+ORDG,0)),U,3)
"RTN","ORWDXM2",39,0)
 S ORIMTYPE=$O(^RA(79.2,"C",ITYPE,0))
"RTN","ORWDXM2",40,0)
 D EN4^RAO7PC1(ITYPE,"ORY")
"RTN","ORWDXM2",41,0)
 S (IFN,CNT)=0 F  S IFN=$O(ORY(IFN)) Q:IFN'>0  D
"RTN","ORWDXM2",42,0)
 . S CNT=CNT+1,ORIMLOC(CNT)=ORY(IFN),ORIMLOC("B",$P(ORY(IFN),U,2))=IFN
"RTN","ORWDXM2",43,0)
 I '$$GET^XPAR("ALL","RA SUBMIT PROMPT",1,"Q"),CNT>1 K ORIMLOC
"RTN","ORWDXM2",44,0)
 E  S ORIMLOC=CNT_"^1"
"RTN","ORWDXM2",45,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX IMAGING LOCATION",0))
"RTN","ORWDXM2",46,0)
 I $G(ORIMLOC) M ORDIALOG(PROMPT,"LIST")=ORIMLOC
"RTN","ORWDXM2",47,0)
 Q
"RTN","ORWDXM2",48,0)
LR ; setup environment for lab
"RTN","ORWDXM2",49,0)
 ; -- setup ORTIME, ORIMTIME & ORTEST arrays
"RTN","ORWDXM2",50,0)
 ;    setup ORMAX, ORDG, & ORCOLLCT variables
"RTN","ORWDXM2",51,0)
 N PROMPT,INST,EDITONLY
"RTN","ORWDXM2",52,0)
 D GETIMES^ORCDLR1  ; sets up ORTIME and ORIMTIME arrays
"RTN","ORWDXM2",53,0)
 S ORMAX=$$GET^XPAR("ALL^LOC.`"_+ORL,"LR MAX DAYS CONTINUOUS",1,"Q")
"RTN","ORWDXM2",54,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0)),INST=1
"RTN","ORWDXM2",55,0)
 D LRTEST           ; sets up ORTEST array and ORDG
"RTN","ORWDXM2",56,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX COLLECTION TYPE",0))
"RTN","ORWDXM2",57,0)
 I $D(ORDIALOG(PROMPT,1)) S ORCOLLCT=ORDIALOG(PROMPT,1) I 1
"RTN","ORWDXM2",58,0)
 E  S EDITONLY=0,ORCOLLCT=$$COLLTYPE^ORCDLR1
"RTN","ORWDXM2",59,0)
 I ORCOLLCT="I" D
"RTN","ORWDXM2",60,0)
 . S PROMPT=$O(^ORD(101.41,"AB","OR GTX START DATE/TIME",0))
"RTN","ORWDXM2",61,0)
 . D LRICTMOK
"RTN","ORWDXM2",62,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ADMIN SCHEDULE",0))
"RTN","ORWDXM2",63,0)
 I $D(ORDIALOG(PROMPT,1)) S ORSCH=ORDIALOG(PROMPT,1)
"RTN","ORWDXM2",64,0)
 Q
"RTN","ORWDXM2",65,0)
LRTEST ; -- Setup ORTEST() array of ordering parameters (copied from ORCDLR)
"RTN","ORWDXM2",66,0)
 N OI,TST,DG
"RTN","ORWDXM2",67,0)
 S OI=+$G(ORDIALOG(PROMPT,INST)) Q:'OI
"RTN","ORWDXM2",68,0)
 I '$D(ORTEST) S TST=+$P($G(^ORD(101.43,OI,0)),U,2) D TEST^LR7OR3(TST,.ORTEST) S ORTEST=TST
"RTN","ORWDXM2",69,0)
 S DG=$P($G(^ORD(101.43,+OI,"LR")),U,6) S:'$L(DG) DG="LAB"
"RTN","ORWDXM2",70,0)
 S DG=$O(^ORD(100.98,"B",DG,0)) S:DG ORDG=DG
"RTN","ORWDXM2",71,0)
 Q
"RTN","ORWDXM2",72,0)
LRRQCM()        ; return true if lab test has required comments
"RTN","ORWDXM2",73,0)
 I $O(^TMP("ORWORD",$J,PROMPT,INST,0)) Q 1 ; edit via WP
"RTN","ORWDXM2",74,0)
 N LRTEST,LRSAMP,LRSPEC,LRTSTN,LRTCOM,LRCCOM,DA,CNT,I,REQDCOMM,OI,TST
"RTN","ORWDXM2",75,0)
 S LRSAMP=$$VAL^ORCD("COLLECTION SAMPLE"),LRSPEC=$$VAL^ORCD("SPECIMEN")
"RTN","ORWDXM2",76,0)
 S OI=+$G(ORDIALOG(PROMPT,INST)) Q:'OI 0
"RTN","ORWDXM2",77,0)
 I '$D(ORTEST) S TST=+$P($G(^ORD(101.43,OI,0)),U,2) D TEST^LR7OR3(TST,.ORTEST) S ORTEST=TST
"RTN","ORWDXM2",78,0)
 S LRTSTN=1,LRTEST(1)=+ORTEST,DA=$O(^LAB(60,LRTEST(1),3,"B",+LRSAMP,0))
"RTN","ORWDXM2",79,0)
 S REQDCOMM=$P($G(^LAB(60,LRTEST(1),3,+DA,0)),U,6)
"RTN","ORWDXM2",80,0)
 S:'REQDCOMM REQDCOMM=+$P($G(^LAB(60,LRTEST(1),0)),U,19)
"RTN","ORWDXM2",81,0)
 Q REQDCOMM
"RTN","ORWDXM2",82,0)
LRASMP()       ; return true to ask collection sample (from ASKSAMP^ORCDLR)
"RTN","ORWDXM2",83,0)
 N DEFSAMP,SAMP0
"RTN","ORWDXM2",84,0)
 S DEFSAMP=$G(ORDIALOG(PROMPT,INST)),SAMP0=$G(^LAB(62,+DEFSAMP,0))
"RTN","ORWDXM2",85,0)
 I (ORCOLLCT="LC")!(ORCOLLCT="I"),$G(ORTEST("Lab CollSamp")) Q 0
"RTN","ORWDXM2",86,0)
 I $G(ORTEST("Unique CollSamp")),DEFSAMP Q 0 ; unique -> don't ask
"RTN","ORWDXM2",87,0)
 I 'DEFSAMP!('FIRST) Q 1 ; no default or edit -> ask
"RTN","ORWDXM2",88,0)
 I $G(ORDIALOG(PROMPT,"LIST"))="1^1" Q 0 ; only one choice
"RTN","ORWDXM2",89,0)
 Q 1
"RTN","ORWDXM2",90,0)
LRICTMOK        ;
"RTN","ORWDXM2",91,0)
 Q:'$D(ORDIALOG(PROMPT,1))
"RTN","ORWDXM2",92,0)
 N ORY
"RTN","ORWDXM2",93,0)
 D VALDT^ORWU(.ORY,ORDIALOG(PROMPT,1))
"RTN","ORWDXM2",94,0)
 I +$$VALID^LR7OV4(DUZ(2),ORY)=0 S ORDIALOG(PROMPT,1)=""
"RTN","ORWDXM2",95,0)
 Q
"RTN","ORWDXM2",96,0)
DO ; setup environment for diet order
"RTN","ORWDXM2",97,0)
 ; partially copied from EN^ORCDFH
"RTN","ORWDXM2",98,0)
 I ORCAT'="I" D  Q
"RTN","ORWDXM2",99,0)
 . S ORQUIT=1
"RTN","ORWDXM2",100,0)
 . S LST(0)="8^0"
"RTN","ORWDXM2",101,0)
 . S LST(.5)="Diet orders allowed for inpatients only."
"RTN","ORWDXM2",102,0)
 D EN^FHWOR8(+ORVP,.ORPARAM)          ; set FH ordering parameters
"RTN","ORWDXM2",103,0)
 S:'$L($G(ORPARAM(3))) ORPARAM(3)="T" ; for now
"RTN","ORWDXM2",104,0)
 N PROMPT,OI                          ; set NPO flag if NPO diet
"RTN","ORWDXM2",105,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDXM2",106,0)
 S OI=+$G(ORDIALOG(PROMPT,1))
"RTN","ORWDXM2",107,0)
 S ORNPO=($P($G(^ORD(101.43,OI,0)),U)="NPO")
"RTN","ORWDXM2",108,0)
 Q
"RTN","ORWDXM2",109,0)
EL ; setup environment for early/late tray
"RTN","ORWDXM2",110,0)
 D EN^FHWOR8(+ORVP,.ORPARAM)          ; set FH ordering parameters
"RTN","ORWDXM2",111,0)
 S:'$L($G(ORPARAM(3))) ORPARAM(3)="T" ; for now
"RTN","ORWDXM2",112,0)
 D EN2^ORCDFH                         ; setup ORTIME array
"RTN","ORWDXM2",113,0)
 N PROMPT                             ; set ORMEAL,ORTRAY
"RTN","ORWDXM2",114,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX MEAL",0))
"RTN","ORWDXM2",115,0)
 I $D(ORDIALOG(PROMPT,1)) S ORMEAL=ORDIALOG(PROMPT,1)
"RTN","ORWDXM2",116,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDXM2",117,0)
 I $D(ORDIALOG(PROMPT,1)) S ORTRAY=ORDIALOG(PROMPT,1)
"RTN","ORWDXM2",118,0)
 Q
"RTN","ORWDXM2",119,0)
UD ; setup environment for unit dose med
"RTN","ORWDXM2",120,0)
 I $G(ORWP94) G PS^ORWDPS3  ; if patch 94 installed
"RTN","ORWDXM2",121,0)
 ;
"RTN","ORWDXM2",122,0)
 D AUTHMED Q:$G(ORQUIT)  ; checks authorized to write meds
"RTN","ORWDXM2",123,0)
 N PROMPT,OI
"RTN","ORWDXM2",124,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDXM2",125,0)
 I $D(ORDIALOG(PROMPT,1)) S OI=ORDIALOG(PROMPT,1) D MEDACTV(1) Q:$G(ORQUIT)
"RTN","ORWDXM2",126,0)
 D INSTR^ORCDPS(OI)      ; sets up instructions, routes, etc.
"RTN","ORWDXM2",127,0)
 D CHOICES^ORCDPS("U")   ; gets list of dispense drugs       
"RTN","ORWDXM2",128,0)
 Q
"RTN","ORWDXM2",129,0)
IV ; setup environment for IV fluid
"RTN","ORWDXM2",130,0)
 D AUTHMED Q:$G(ORQUIT)  ; checks authorized to write meds
"RTN","ORWDXM2",131,0)
 ; sets up list of volumes if only one solution
"RTN","ORWDXM2",132,0)
 ; otherwise, let the dialog go interactive
"RTN","ORWDXM2",133,0)
 N PROMPT,INST,CNT,OI
"RTN","ORWDXM2",134,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDXM2",135,0)
 S (CNT,INST)=0
"RTN","ORWDXM2",136,0)
 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:'INST  D  Q:$G(ORQUIT)
"RTN","ORWDXM2",137,0)
 . S CNT=CNT+1
"RTN","ORWDXM2",138,0)
 . S OI=ORDIALOG(PROMPT,INST) D MEDACTV(3) ; check active solutions
"RTN","ORWDXM2",139,0)
 I CNT=1 S INST=1 D VOLUME^ORCDPSIV
"RTN","ORWDXM2",140,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ADDITIVE",0))
"RTN","ORWDXM2",141,0)
 S INST=0
"RTN","ORWDXM2",142,0)
 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:'INST  D  Q:$G(ORQUIT)
"RTN","ORWDXM2",143,0)
 . S OI=ORDIALOG(PROMPT,INST) D MEDACTV(4) ; check active additives
"RTN","ORWDXM2",144,0)
 Q
"RTN","ORWDXM2",145,0)
OP ; setup environment for outpatient pharmacy
"RTN","ORWDXM2",146,0)
 I $G(ORWP94) G PS^ORWDPS3  ; if patch 94 installed
"RTN","ORWDXM2",147,0)
 ;
"RTN","ORWDXM2",148,0)
 D AUTHMED Q:$G(ORQUIT)       ; checks authorized to write meds
"RTN","ORWDXM2",149,0)
 N PROMPT,INST,CNT,OI
"RTN","ORWDXM2",150,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0)),OI=0
"RTN","ORWDXM2",151,0)
 I $D(ORDIALOG(PROMPT,1)) S OI=$G(ORDIALOG(PROMPT,1)) D MEDACTV(2) Q:$G(ORQUIT)
"RTN","ORWDXM2",152,0)
 D:+OI INSTR^ORCDPS(OI)           ; sets up instructions, routes, etc.
"RTN","ORWDXM2",153,0)
 D CHOICES^ORCDPS("O")        ; gets list of dispense drugs      
"RTN","ORWDXM2",154,0)
 ; get defaults for drug, refills if only one dispense drug
"RTN","ORWDXM2",155,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX DISPENSE DRUG",0))
"RTN","ORWDXM2",156,0)
 S (CNT,INST)=0
"RTN","ORWDXM2",157,0)
 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:'INST  S CNT=CNT+1
"RTN","ORWDXM2",158,0)
 I CNT=1 D
"RTN","ORWDXM2",159,0)
 . S ORDRUG=+$G(ORDIALOG(PROMPT,1)),ORCOMPLX=0
"RTN","ORWDXM2",160,0)
 . S OREFILLS=$P($G(ORDIALOG(PROMPT,"LIST","D",ORDRUG)),U,3)
"RTN","ORWDXM2",161,0)
 . S:'$L(OREFILLS) OREFILLS=11
"RTN","ORWDXM2",162,0)
 E  S ORCOMPLX=1,OREFILLS=11  ; force interactive on complex order
"RTN","ORWDXM2",163,0)
 S ORCOPAY=1                  ; ask SC if can't determine copay
"RTN","ORWDXM2",164,0)
 I $G(ORDRUG),$L($T(ASKSC^ORCDPS)) S ORCOPAY=$$ASKSC^ORCDPS
"RTN","ORWDXM2",165,0)
 Q
"RTN","ORWDXM2",166,0)
AUTHMED ; sets ORQUIT if not authorized to write meds
"RTN","ORWDXM2",167,0)
 N NOAUTH,NAME
"RTN","ORWDXM2",168,0)
 D AUTH^ORWDPS32(.NOAUTH,ORNP)
"RTN","ORWDXM2",169,0)
 I +NOAUTH D
"RTN","ORWDXM2",170,0)
 . S ORQUIT=1
"RTN","ORWDXM2",171,0)
 . S LST(0)="8^0"
"RTN","ORWDXM2",172,0)
 . S NAME=$P($G(^VA(200,+ORNP,20)),U,2)
"RTN","ORWDXM2",173,0)
 . I '$L(NAME) S NAME=$P($G(^VA(200,+ORNP,0)),U,1)
"RTN","ORWDXM2",174,0)
 . S LST(.5)=NAME_" is not authorized to write med orders."
"RTN","ORWDXM2",175,0)
 Q
"RTN","ORWDXM2",176,0)
MEDACTV(USAGE) ; sets ORQUIT if the orderable item is not active for a med
"RTN","ORWDXM2",177,0)
 Q:'$G(OI)  S USAGE=+$G(USAGE)
"RTN","ORWDXM2",178,0)
 I $G(^ORD(101.43,OI,.1)),^(.1)'>$$NOW^XLFDT D  Q
"RTN","ORWDXM2",179,0)
 . S ORQUIT=1,LST(0)="8^0"
"RTN","ORWDXM2",180,0)
 . S LST(.5)=$P($G(^ORD(101.43,OI,0)),U)_" has been inactivated and may not be ordered anymore."
"RTN","ORWDXM2",181,0)
 I USAGE,'$P($G(^ORD(101.43,OI,"PS")),U,USAGE) D  Q
"RTN","ORWDXM2",182,0)
 . S ORQUIT=1,LST(0)="8^0"
"RTN","ORWDXM2",183,0)
 . S LST(.5)=$P($G(^ORD(101.43,OI,0)),U)_" may not be ordered as an "_$S(USAGE=1:"inpatient medication",USAGE=2:"outpatient medication",USAGE=3:"IV solution",1:"IV additive")_" anymore."
"RTN","ORWDXM2",184,0)
 Q
"RTN","ORWDXM2",185,0)
SCHEDULD() ; Is patient scheduled for PREOP (Imaging)
"RTN","ORWDXM2",186,0)
 I $G(ORDIALOG(PROMPT,1)) Q 1 ; don't ask - already have date
"RTN","ORWDXM2",187,0)
 E  Q 0
"RTN","ORWDXM2",188,0)
 Q
"RTN","ORWDXM3")
0^80^B35271488
"RTN","ORWDXM3",1,0)
ORWDXM3 ; SLC/KCM/JLI - Quick Orders ;10:42 AM 6/20/2002
"RTN","ORWDXM3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,131,132,141,185,187,190,195**;Dec 17, 1997
"RTN","ORWDXM3",3,0)
 ;
"RTN","ORWDXM3",4,0)
KEYVAR(DLG)  ; Parse entry action for key variables & return in string
"RTN","ORWDXM3",5,0)
 ; RV=CollTp^Samp^Spec^CollDt^Urg^Sched^NoComm^NoDiag^NoProv^NoRsn
"RTN","ORWDXM3",6,0)
 N XCODE,RV,POS,Z
"RTN","ORWDXM3",7,0)
 S XCODE=$G(^ORD(101.41,DLG,3)),RV=""
"RTN","ORWDXM3",8,0)
 I '$L(XCODE) Q ""
"RTN","ORWDXM3",9,0)
 S POS=$F(XCODE,"LRFZX=")    I POS S $P(RV,U,1)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",10,0)
 S POS=$F(XCODE,"LRFSAMP=")  I POS S $P(RV,U,2)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",11,0)
 S POS=$F(XCODE,"LRFSPEC=")  I POS S $P(RV,U,3)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",12,0)
 S POS=$F(XCODE,"LRFDATE=")  I POS S $P(RV,U,4)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",13,0)
 S POS=$F(XCODE,"LRFURG=")   I POS S $P(RV,U,5)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",14,0)
 S POS=$F(XCODE,"LRFSCH=")   I POS S $P(RV,U,6)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",15,0)
 S POS=$F(XCODE,"PSJNOPC=")  I POS S $P(RV,U,7)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",16,0)
 S POS=$F(XCODE,"GMRCNOPD=") I POS S $P(RV,U,8)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",17,0)
 S POS=$F(XCODE,"GMRCNOAT=") I POS S $P(RV,U,9)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",18,0)
 S POS=$F(XCODE,"GMRCREAF=") I POS S $P(RV,U,10)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",19,0)
 S POS=$F(XCODE,"ORFORGET=") I POS D
"RTN","ORWDXM3",20,0)
 . ; need to change this so that it is executed in SETKEYV so
"RTN","ORWDXM3",21,0)
 . ; that it is executed each time menu is revisited
"RTN","ORWDXM3",22,0)
 . N ORFORGET S ORFORGET=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",23,0)
 . I ORFORGET K ^TMP("ORECALL",$J,+ORFORGET)
"RTN","ORWDXM3",24,0)
 . E  K ^TMP("ORECALL",$J)
"RTN","ORWDXM3",25,0)
 Q RV
"RTN","ORWDXM3",26,0)
VALUE(STR,BEG) ; Return value of "var=" (copied from ORCONVRT)
"RTN","ORWDXM3",27,0)
 N X,Y,I S X=$E(STR,BEG,999),Y=""
"RTN","ORWDXM3",28,0)
 S:$E(X)="""" X=$E(X,2,999) ; strip leading "
"RTN","ORWDXM3",29,0)
 F I=1:1:$L(X) S Z=$E(X,I) Q:(Z=",")!(Z=" ")!(Z="""")  S Y=Y_Z
"RTN","ORWDXM3",30,0)
 Q $TR(Y,U,"")
"RTN","ORWDXM3",31,0)
 ;
"RTN","ORWDXM3",32,0)
SETKEYV(X)      ; Set the key variables based on contents of X
"RTN","ORWDXM3",33,0)
 I $L($P(X,U,1))  S LRFZX=$P(X,U,1)
"RTN","ORWDXM3",34,0)
 I $L($P(X,U,2))  S LRFSAMP=$P(X,U,2)
"RTN","ORWDXM3",35,0)
 I $L($P(X,U,3))  S LRFSPEC=$P(X,U,3)
"RTN","ORWDXM3",36,0)
 I $L($P(X,U,4))  S LRFDATE=$P(X,U,4)
"RTN","ORWDXM3",37,0)
 I $L($P(X,U,5))  S LRFURG=$P(X,U,5)
"RTN","ORWDXM3",38,0)
 I $L($P(X,U,6))  S LRFSCH=$P(X,U,6)
"RTN","ORWDXM3",39,0)
 I $L($P(X,U,7))  S PSJNOPC=$P(X,U,7)
"RTN","ORWDXM3",40,0)
 I $L($P(X,U,8))  S GMRCNOPD=$P(X,U,8)
"RTN","ORWDXM3",41,0)
 I $L($P(X,U,9))  S GMRCNOAT=$P(X,U,9)
"RTN","ORWDXM3",42,0)
 I $L($P(X,U,10)) S GMRCREAF=$P(X,U,10)
"RTN","ORWDXM3",43,0)
 Q
"RTN","ORWDXM3",44,0)
DLGINFO(IEN,MODE)    ; return information about a dialog
"RTN","ORWDXM3",45,0)
 ; IEN=DlgIEN or ORIFN, MODE=0:Dlg,1:Copy,2:Change
"RTN","ORWDXM3",46,0)
 ; RESULT=DlgIEN^DlgType^FormID^DGrp
"RTN","ORWDXM3",47,0)
 ; If MODE="1;T",don't check "PS MEDS" for transfer order
"RTN","ORWDXM3",48,0)
 ; PSMDGP=1: Unit/Dose  Group
"RTN","ORWDXM3",49,0)
 ; PSMDGP=2: OutPatient Group
"RTN","ORWDXM3",50,0)
 N X0,DLGIEN,TYP,FID,DGRP,PSMDGP,ISXF
"RTN","ORWDXM3",51,0)
 S PSMDGP=0,ISXF=""
"RTN","ORWDXM3",52,0)
 S ISXF=$P(MODE,";",2)
"RTN","ORWDXM3",53,0)
 S MODE=+MODE
"RTN","ORWDXM3",54,0)
 S DLGIEN=IEN I MODE,(ISXF'="T") D
"RTN","ORWDXM3",55,0)
 . S DLGIEN=+$P($G(^OR(100,+IEN,0)),U,5)
"RTN","ORWDXM3",56,0)
 . I $P(^ORD(101.41,DLGIEN,0),U)="PS MEDS" D
"RTN","ORWDXM3",57,0)
 . . N PTCAT S PTCAT=$P($G(^OR(100,+IEN,0)),U,12)
"RTN","ORWDXM3",58,0)
 . . I PTCAT="I" S DLGIEN=$O(^ORD(101.41,"B","PSJ OR PAT OE",0)),PSMDGP=1
"RTN","ORWDXM3",59,0)
 . . I PTCAT="O" S DLGIEN=$O(^ORD(101.41,"B","PSO OERR",0)),PSMDGP=2
"RTN","ORWDXM3",60,0)
 I MODE,(ISXF="T") S DLGIEN=+$P($G(^OR(100,+IEN,0)),U,5)
"RTN","ORWDXM3",61,0)
 S X0=$G(^ORD(101.41,DLGIEN,0)),TYP=$P(X0,U,4),DGRP=$P(X0,U,5)
"RTN","ORWDXM3",62,0)
 I MODE S DGRP=+$P($G(^OR(100,+IEN,0)),U,11)
"RTN","ORWDXM3",63,0)
 ;JD NEW START 11/13/02
"RTN","ORWDXM3",64,0)
 I DLGIEN=$O(^ORD(101.41,"B","PSJ OR PAT OE",0)) S PSMDGP=1
"RTN","ORWDXM3",65,0)
 I DLGIEN=$O(^ORD(101.41,"B","PSO OERR",0)) S PSMDGP=2
"RTN","ORWDXM3",66,0)
 ;JD NEW END 11/13/02
"RTN","ORWDXM3",67,0)
 ; for copy or change, if the base dialog has changed, use it's info 
"RTN","ORWDXM3",68,0)
 I MODE,$G(ORDIALOG),(+DLGIEN'=+ORDIALOG),(PSMDGP=0) D
"RTN","ORWDXM3",69,0)
 . S DLGIEN=+ORDIALOG,DGRP=$P(^ORD(101.41,+ORDIALOG,0),U,5)
"RTN","ORWDXM3",70,0)
 D FORMID^ORWDXM(.FID,DLGIEN)
"RTN","ORWDXM3",71,0)
 Q DLGIEN_U_TYP_U_FID_U_DGRP
"RTN","ORWDXM3",72,0)
 ;
"RTN","ORWDXM3",73,0)
CHKDSBL(LST,ID,MODE)  ; return message if dialog disabled
"RTN","ORWDXM3",74,0)
 ; ID=DlgIEN or ORIFN, MODE=0:Dialog,1:Copy,2:Change
"RTN","ORWDXM3",75,0)
 ; LST=QL_REJECT + disabled message or unchanged
"RTN","ORWDXM3",76,0)
 S DLGIEN=+ID I MODE S DLGIEN=+$P($G(^OR(100,+ID,0)),U,5)
"RTN","ORWDXM3",77,0)
 S X0=$G(^ORD(101.41,DLGIEN,0)),X=$P(X0,U,3)
"RTN","ORWDXM3",78,0)
 I '$L(X),($P(X0,U,4)="Q") D  ; check default dialog
"RTN","ORWDXM3",79,0)
 . S DLGIEN=+$$DEFDLG^ORWDXQ($P(X0,U,5))
"RTN","ORWDXM3",80,0)
 . S X=$P($G(^ORD(101.41,DLGIEN,0)),U,3)
"RTN","ORWDXM3",81,0)
 I $L(X) D
"RTN","ORWDXM3",82,0)
 . I MODE D GETTXT^ORWORR(.LST,ID) S LST(.6)="",LST(.7)="Cannot "_$S(MODE=1:"Copy",1:"Change")_" -"
"RTN","ORWDXM3",83,0)
 . S LST(0)="8^0",LST(.5)="Dialog Disabled:  "_X
"RTN","ORWDXM3",84,0)
 Q
"RTN","ORWDXM3",85,0)
CHKVACT(LST,ID,MODE,ORNP)  ; return message if action not valid
"RTN","ORWDXM3",86,0)
 ; ID=DlgIEN or ORIFN, MODE=0:Dialog,1:Copy,2:Change
"RTN","ORWDXM3",87,0)
 ; LST=QL_REJECT + invalid action message or unchanged
"RTN","ORWDXM3",88,0)
 Q:'MODE  ; not an action on an order
"RTN","ORWDXM3",89,0)
 N X,ACT S ACT=$S(MODE=1:"RW",MODE=2:"XX",1:"")
"RTN","ORWDXM3",90,0)
 D VALID^ORWDXA(.X,ID,ACT,ORNP)
"RTN","ORWDXM3",91,0)
 I $L(X) D GETTXT^ORWORR(.LST,ID) D
"RTN","ORWDXM3",92,0)
 . S LST(0)="8^0",LST(.5)=X,LST(.6)="",LST(.7)="Cannot "_$S(MODE=1:"Copy",1:"Change")_" -"
"RTN","ORWDXM3",93,0)
 Q
"RTN","ORWDXM3",94,0)
CHKCOPY(LST,ID,FLDS)  ; return message if can't copy this order
"RTN","ORWDXM3",95,0)
 ; ID=ORIFN;ACT FLDS=EventType in 7th piece
"RTN","ORWDXM3",96,0)
 ; LST=QL_REJECT + cannot copy message or unchanged
"RTN","ORWDXM3",97,0)
 I "^A^D^T^"'[(U_$E($P(FLDS,U,7))_U) Q             ; not event delayed
"RTN","ORWDXM3",98,0)
 N PKG S PKG=$P($G(^OR(100,+ID,0)),U,14)
"RTN","ORWDXM3",99,0)
 S PKG=$$NMSP^ORCD(PKG) I PKG="OR"!(PKG="PS") Q    ; xfer meds, generics
"RTN","ORWDXM3",100,0)
 N ORWCAT S ORWCAT=$P($G(^OR(100,+ID,0)),U,12)
"RTN","ORWDXM3",101,0)
 I ORWCAT="I",("^A^T^"[(U_$E($P(FLDS,U,7))_U)) Q   ; admit, xfer inpt
"RTN","ORWDXM3",102,0)
 I ORWCAT="O",$E($P(FLDS,U,7))="D" Q               ; discharge outpt
"RTN","ORWDXM3",103,0)
 D GETTXT^ORWORR(.LST,ID)
"RTN","ORWDXM3",104,0)
 I ORWCAT="I" S LST(.5)="inpatient order to outpatient -"
"RTN","ORWDXM3",105,0)
 I ORWCAT="O" S LST(.5)="outpatient order to inpatient -"
"RTN","ORWDXM3",106,0)
 S:$D(LST(.5)) LST(.5)="Cannot copy the following "_LST(.5)
"RTN","ORWDXM3",107,0)
 S LST(0)="8^0",LST(.7)=""
"RTN","ORWDXM3",108,0)
 Q
"RTN","ORWDXM3",109,0)
BLD4CHG(LST,ID,FLDS)  ; build responses for an edit
"RTN","ORWDXM3",110,0)
 ; ID=ORIFN;ACT FLDS=unused right now
"RTN","ORWDXM3",111,0)
 ; LST(0)=Qlvl^RespID(XOrderID)^DlgIEN^DlgType^FormID^DGrp
"RTN","ORWDXM3",112,0)
 N OIDX,OI,CNT
"RTN","ORWDXM3",113,0)
 S (OI,OIDX,CNT)=0
"RTN","ORWDXM3",114,0)
 S:$D(^OR(100,+ID,4.5,"ID","ORDERABLE")) OIDX=$O(^OR(100,+ID,4.5,"ID","ORDERABLE",0))
"RTN","ORWDXM3",115,0)
 I $D(^OR(100,+ID,4.5,OIDX)) D
"RTN","ORWDXM3",116,0)
 . F  S CNT=$O(^OR(100,+ID,4.5,OIDX,CNT)) Q:'CNT  D
"RTN","ORWDXM3",117,0)
 . . S OI=^(CNT) D VALDOI
"RTN","ORWDXM3",118,0)
 I +LST(0)=8 S LST(.5)="You can not change this order." Q
"RTN","ORWDXM3",119,0)
 S LST(0)="0^X"_ID_U_$$DLGINFO(+ID,2)
"RTN","ORWDXM3",120,0)
 S $P(LST(0),U,4)="X"
"RTN","ORWDXM3",121,0)
 Q
"RTN","ORWDXM3",122,0)
VALDOI ; Validate the Orderable Items
"RTN","ORWDXM3",123,0)
 N ORQUIT,ORPS
"RTN","ORWDXM3",124,0)
 I $G(^ORD(101.43,OI,.1)),^(.1)'>$$NOW^XLFDT D
"RTN","ORWDXM3",125,0)
 . S ORQUIT=1
"RTN","ORWDXM3",126,0)
 . S LST(0)="8^0"
"RTN","ORWDXM3",127,0)
 I $D(ORQUIT) Q:ORQUIT
"RTN","ORWDXM3",128,0)
 S ORPS=$G(^ORD(101.43,+OI,"PS"))
"RTN","ORWDXM3",129,0)
 I $P(ORPS,U,1,4)="0^0^0^0",($P(ORPS,U,7)=0) S LST(0)="8^0"
"RTN","ORWDXM3",130,0)
 Q
"RTN","ORWDXM3",131,0)
VALQO(IFN) ;Check to see if it's a good QO med
"RTN","ORWDXM3",132,0)
 ;If it's an IV QO: check if infusion rate entered
"RTN","ORWDXM3",133,0)
 ;If it's an UD QO: check if dosage entered
"RTN","ORWDXM3",134,0)
 ;regular order treated as good QO
"RTN","ORWDXM3",135,0)
 ;
"RTN","ORWDXM3",136,0)
 I $P($G(^ORD(101.41,IFN,0)),U,4)'="Q" Q 1
"RTN","ORWDXM3",137,0)
 N ODP,ODG,INFUID,DSAGEID,SUCC
"RTN","ORWDXM3",138,0)
 S SUCC=0
"RTN","ORWDXM3",139,0)
 S ODP=+$P($G(^ORD(101.41,IFN,0)),U,7),ODG=+$P($G(^(0)),U,5)
"RTN","ORWDXM3",140,0)
 S ODP=$$GET1^DIQ(9.4,+ODP_",",1),ODG=$P($G(^ORD(100.98,ODG,0)),U,3)
"RTN","ORWDXM3",141,0)
 ;check infusion rate for IV QO
"RTN","ORWDXM3",142,0)
 I ODG="IV RX"!(ODG="TPN") D
"RTN","ORWDXM3",143,0)
 . S INFUID=$O(^ORD(101.41,"B","OR GTX INFUSION RATE",0))
"RTN","ORWDXM3",144,0)
 . I $D(ORDIALOG(INFUID,1)) S SUCC=1
"RTN","ORWDXM3",145,0)
 ;check dosage for UD QO
"RTN","ORWDXM3",146,0)
 I (ODP="PSJ")!(ODP="PSO"),ODG'="IV RX",ODG'="TPN" D
"RTN","ORWDXM3",147,0)
 . S DSAGEID=$O(^ORD(101.41,"B","OR GTX INSTRUCTIONS",0))
"RTN","ORWDXM3",148,0)
 . I $D(ORDIALOG(DSAGEID,1)) S SUCC=1
"RTN","ORWDXM3",149,0)
 Q SUCC
"RTN","ORWDXM3",150,0)
ISUDQO(ORY,DLGID) ;True: is unit dose quick order
"RTN","ORWDXM3",151,0)
 S ORY=0
"RTN","ORWDXM3",152,0)
 Q:'$D(^ORD(101.41,DLGID,0))
"RTN","ORWDXM3",153,0)
 N UDGRP1,UDGRP2,DLGTYP,DLGGRP
"RTN","ORWDXM3",154,0)
 S UDGRP1=$O(^ORD(100.98,"B","UD RX",0))
"RTN","ORWDXM3",155,0)
 S UDGRP2=$O(^ORD(100.98,"B","I RX",0))
"RTN","ORWDXM3",156,0)
 S DLGTYP=$P($G(^ORD(101.41,DLGID,0)),U,4)
"RTN","ORWDXM3",157,0)
 S DLGGRP=$P($G(^ORD(101.41,DLGID,0)),U,5)
"RTN","ORWDXM3",158,0)
 I (DLGTYP="Q"),((DLGGRP=UDGRP1)!(DLGGRP=UDGRP2)) S ORY=1
"RTN","ORWDXM3",159,0)
 Q
"RTN","ORWDXR01")
0^87^B14465007
"RTN","ORWDXR01",1,0)
ORWDXR01 ;SLC/JDL - Utilities for Order Actions;; 6/30/03 11:48
"RTN","ORWDXR01",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**187,190,195**;Dec 17, 1997
"RTN","ORWDXR01",3,0)
CANCHG(ORY,ORIFN,TXTOD) ;
"RTN","ORWDXR01",4,0)
 ;If it's an pending or unsigned unreleased renewed order, can edit=True
"RTN","ORWDXR01",5,0)
 S ORY=0
"RTN","ORWDXR01",6,0)
 Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORWDXR01",7,0)
 I TXTOD D TXTCAN(.ORY) Q
"RTN","ORWDXR01",8,0)
 N OUTGRP,URELSTS,USIGSTS,RNTYPE
"RTN","ORWDXR01",9,0)
 N ODGRP,ODREL,ODSIG,ODTYPE,LSTACT
"RTN","ORWDXR01",10,0)
 S OUTGRP=$O(^ORD(100.98,"B","O RX",0))
"RTN","ORWDXR01",11,0)
 S URELSTS=$O(^ORD(100.01,"B","UNRELEASED",0))
"RTN","ORWDXR01",12,0)
 S PDSTS=$O(^ORD(100.01,"B","PENDING",0))
"RTN","ORWDXR01",13,0)
 S USIGSTS=2 ; unsigned order
"RTN","ORWDXR01",14,0)
 S RNTYPE=2 ; renew action
"RTN","ORWDXR01",15,0)
 ;Data from the order entry
"RTN","ORWDXR01",16,0)
 S LSTACT=$P($G(^OR(100,+ORIFN,3)),U,7)
"RTN","ORWDXR01",17,0)
 S ODGRP=$P($G(^OR(100,+ORIFN,0)),U,11)
"RTN","ORWDXR01",18,0)
 S ODREL=$P($G(^OR(100,+ORIFN,3)),U,3)
"RTN","ORWDXR01",19,0)
 S ODSIG=$P($G(^OR(100,+ORIFN,8,LSTACT,0)),U,4)
"RTN","ORWDXR01",20,0)
 S ODTYPE=$P($G(^OR(100,+ORIFN,3)),U,11)
"RTN","ORWDXR01",21,0)
 I (ODGRP=OUTGRP),(ODREL=URELSTS),(ODSIG=USIGSTS),(ODTYPE=RNTYPE) S ORY=1
"RTN","ORWDXR01",22,0)
 Q
"RTN","ORWDXR01",23,0)
 ;
"RTN","ORWDXR01",24,0)
TXTCAN(ORY) ;
"RTN","ORWDXR01",25,0)
 ;if it's an unsigned unreleased renewed text order, can change=true
"RTN","ORWDXR01",26,0)
 N URELSTS,USIGSTS,RNTYPE
"RTN","ORWDXR01",27,0)
 N ODREL,ODSIG,ODTYPE,LSTACT
"RTN","ORWDXR01",28,0)
 S URELSTS=$O(^ORD(100.01,"B","UNRELEASED",0))
"RTN","ORWDXR01",29,0)
 S USIGSTS=2 ; unsigned order
"RTN","ORWDXR01",30,0)
 S RNTYPE=2 ; renew action
"RTN","ORWDXR01",31,0)
 ;Data from the order entry
"RTN","ORWDXR01",32,0)
 S LSTACT=$P($G(^OR(100,+ORIFN,3)),U,7)
"RTN","ORWDXR01",33,0)
 S ODREL=$P($G(^OR(100,+ORIFN,8,LSTACT,0)),U,15)
"RTN","ORWDXR01",34,0)
 S ODSIG=$P($G(^OR(100,+ORIFN,8,LSTACT,0)),U,4)
"RTN","ORWDXR01",35,0)
 S ODTYPE=$P($G(^OR(100,+ORIFN,3)),U,11)
"RTN","ORWDXR01",36,0)
 I (ODREL=URELSTS),(ODSIG=USIGSTS),(ODTYPE=RNTYPE) S ORY=1
"RTN","ORWDXR01",37,0)
 Q
"RTN","ORWDXR01",38,0)
 ;
"RTN","ORWDXR01",39,0)
SAVCHG(ORY,ORID,PARM1,PARM2,TXTOD) ;
"RTN","ORWDXR01",40,0)
 ;save new changes on the unreleased unsigned renewed order
"RTN","ORWDXR01",41,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXR01",42,0)
 ;Update new start and stop date the text order
"RTN","ORWDXR01",43,0)
 I TXTOD D TXTSAV(.ORY,ORID,PARM1,PARM2) Q
"RTN","ORWDXR01",44,0)
 ;Update new refills and pickup for the med order
"RTN","ORWDXR01",45,0)
 N REFID,PICKID,ACT,IX,TXT,REFPOS,NDQUIT
"RTN","ORWDXR01",46,0)
 S (REFID,PICKID,ACT,REFPOS,NDQUIT)=0,ORY=""
"RTN","ORWDXR01",47,0)
 S ACT=+$P(ORID,";",2) S:ACT'>0 ACT=1
"RTN","ORWDXR01",48,0)
 S REFID=$O(^OR(100,+ORID,4.5,"ID","REFILLS",0))
"RTN","ORWDXR01",49,0)
 S PICKID=$O(^OR(100,+ORID,4.5,"ID","PICKUP",0))
"RTN","ORWDXR01",50,0)
 S:$D(^OR(100,+ORID,4.5,REFID,1)) ^(1)=PARM1
"RTN","ORWDXR01",51,0)
 S:$D(^OR(100,+ORID,4.5,PICKID,1)) ^(1)=PARM2
"RTN","ORWDXR01",52,0)
 S IX=0 F  S IX=$O(^OR(100,+ORID,8,ACT,.1,IX)) Q:('IX)!(NDQUIT)  D
"RTN","ORWDXR01",53,0)
 . S TXT=$G(^OR(100,+ORID,8,ACT,.1,IX,0))
"RTN","ORWDXR01",54,0)
 . I ($$UP^XLFSTR(TXT)["QUANTITY:"),($$UP^XLFSTR(TXT)["REFILLS:") D
"RTN","ORWDXR01",55,0)
 . . S REFPOS=$F($$UP^XLFSTR(TXT),"REFILLS")-$L("REFILLS")-1
"RTN","ORWDXR01",56,0)
 . . S TXT=$E(TXT,1,REFPOS)_"Refills: "_PARM1
"RTN","ORWDXR01",57,0)
 . . S ^OR(100,+ORID,8,ACT,.1,IX,0)=TXT,NDQUIT=1 Q
"RTN","ORWDXR01",58,0)
 D GETBYIFN^ORWORR(.ORY,+ORID)
"RTN","ORWDXR01",59,0)
 Q
"RTN","ORWDXR01",60,0)
 ;
"RTN","ORWDXR01",61,0)
TXTSAV(ORY,ORID,PARM1,PARM2) ;
"RTN","ORWDXR01",62,0)
 ; Update new start and stop date for the unsigned unreleased 
"RTN","ORWDXR01",63,0)
 ; renewed text order
"RTN","ORWDXR01",64,0)
 N STRTID,STOPID
"RTN","ORWDXR01",65,0)
 S STRTID=$O(^OR(100,+ORID,4.5,"ID","START",0))
"RTN","ORWDXR01",66,0)
 S STOPID=$O(^OR(100,+ORID,4.5,"ID","STOP",0))
"RTN","ORWDXR01",67,0)
 S:$D(^OR(100,+ORID,4.5,STRTID,1)) ^(1)=PARM1
"RTN","ORWDXR01",68,0)
 S:$D(^OR(100,+ORID,4.5,STOPID,1)) ^(1)=PARM2
"RTN","ORWDXR01",69,0)
 D GETBYIFN^ORWORR(.ORY,+ORID)
"RTN","ORWDXR01",70,0)
 Q
"RTN","ORWDXR01",71,0)
 ;
"RTN","ORWDXR01",72,0)
ISSPLY(ORY,DLGID,QODLG) ;
"RTN","ORWDXR01",73,0)
 ; ORY=1: is "PSO SUPPLY" dialog
"RTN","ORWDXR01",74,0)
 S ORY=""
"RTN","ORWDXR01",75,0)
 Q:'$D(^ORD(101.41,DLGID,0))
"RTN","ORWDXR01",76,0)
 I 'QODLG,($P(^ORD(101.41,DLGID,0),U)="PSO SUPPLY") S ORY=1
"RTN","ORWDXR01",77,0)
 I QODLG D
"RTN","ORWDXR01",78,0)
 . N SPLYDG S SPLYDG=$O(^ORD(100.98,"B","SPLY",0))
"RTN","ORWDXR01",79,0)
 . I $P(^ORD(101.41,DLGID,0),U,5)=SPLYDG S ORY=1
"RTN","ORWDXR01",80,0)
 Q
"RTN","ORWDXR01",81,0)
 ;
"RTN","ORWDXR01",82,0)
OXDATA(ORY,ORIEN) ; Return orderable item data for order check usage
"RTN","ORWDXR01",83,0)
 Q:'$D(^OR(100,+ORIEN,0))
"RTN","ORWDXR01",84,0)
 N DRUGID,OIID,IDX,IDY,DISPIN,DISPOUT,DISPID
"RTN","ORWDXR01",85,0)
 S (DRUGID,OIID,IDX,IDY,DISPIN,DISPOUT)=0
"RTN","ORWDXR01",86,0)
 S DISPID=""
"RTN","ORWDXR01",87,0)
 S DISPIN=$O(^ORD(100.98,"B","UD RX",0))
"RTN","ORWDXR01",88,0)
 S DISPOUT=$O(^ORD(100.98,"B","O RX",0))
"RTN","ORWDXR01",89,0)
 N DISPCM S DISPCM=$O(^ORD(100.98,"B","CLINIC MEDICATIONS",0))
"RTN","ORWDXR01",90,0)
 S DRUGID=$O(^OR(100,+ORIEN,4.5,"ID","DRUG",0))
"RTN","ORWDXR01",91,0)
 S OIID=$O(^OR(100,+ORIEN,4.5,"ID","ORDERABLE",0))
"RTN","ORWDXR01",92,0)
 S DISPID=$P(^OR(100,+ORIEN,0),U,11)
"RTN","ORWDXR01",93,0)
 I DISPID=DISPIN S DISPID="PSI"
"RTN","ORWDXR01",94,0)
 I DISPID=DISPOUT S DISPID="PSO"
"RTN","ORWDXR01",95,0)
 I DISPID=DISPCM S DISPID="PSI"
"RTN","ORWDXR01",96,0)
 I (DISPID'="PSI"),(DISPID'="PSO") Q
"RTN","ORWDXR01",97,0)
 Q:'DRUGID
"RTN","ORWDXR01",98,0)
 Q:'OIID
"RTN","ORWDXR01",99,0)
 S IDX=$O(^OR(100,+ORIEN,4.5,DRUGID,0))
"RTN","ORWDXR01",100,0)
 S IDY=$O(^OR(100,+ORIEN,4.5,OIID,0))
"RTN","ORWDXR01",101,0)
 I IDX,IDY,'+DISPID S ORY=$G(^OR(100,+ORIEN,4.5,OIID,IDY))_U_DISPID_U_$G(^OR(100,+ORIEN,4.5,DRUGID,IDX))
"RTN","ORWDXR01",102,0)
 Q
"RTN","ORWNSS")
0^57^B4680078
"RTN","ORWNSS",1,0)
ORWNSS ;JDL/SLC Non-Standard Schedule ;12/9/04  12:02
"RTN","ORWNSS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORWNSS",3,0)
NSSOK(ORY,ORX) ;Check availability for Non-standard schedule
"RTN","ORWNSS",4,0)
 N VAL
"RTN","ORWNSS",5,0)
 S VAL=$$PATCH^XPDUTL("PSJ*5.0*113")
"RTN","ORWNSS",6,0)
 S ORY=VAL
"RTN","ORWNSS",7,0)
 Q
"RTN","ORWNSS",8,0)
NSSMSG(ORY) ;Retrieve site message for None-Standard Schedule
"RTN","ORWNSS",9,0)
 N ORSRV
"RTN","ORWNSS",10,0)
 S ORY=""
"RTN","ORWNSS",11,0)
 S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORWNSS",12,0)
 S ORY=$$GET^XPAR("SRV.`"_+$G(ORSRV)_"^DIV^SYS","ORWIM NSS MESSAGE",1,"I")
"RTN","ORWNSS",13,0)
 Q
"RTN","ORWNSS",14,0)
VALSCH(ORY,ORID) ;Validate a schedule for IM order; 1: valid, 0: invalid
"RTN","ORWNSS",15,0)
 ;
"RTN","ORWNSS",16,0)
 S ORY=0
"RTN","ORWNSS",17,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWNSS",18,0)
 N IPGRP,ORGRP
"RTN","ORWNSS",19,0)
 S IPGRP=$O(^ORD(100.98,"B","UD RX",0))
"RTN","ORWNSS",20,0)
 S ORGRP=$P($G(^OR(100,+ORID,0)),U,11)
"RTN","ORWNSS",21,0)
 I ORGRP'=IPGRP S ORY=1 Q
"RTN","ORWNSS",22,0)
 N SCH,IDX,SCHVAL S (SCH,SCHVAL)=""
"RTN","ORWNSS",23,0)
 I $D(^OR(100,+ORID,4.5,"ID","SCHEDULE")) S SCH=$O(^OR(100,+ORID,4.5,"ID","SCHEDULE",0))
"RTN","ORWNSS",24,0)
 I SCH="" S ORY=1 Q
"RTN","ORWNSS",25,0)
 S IDX=0 F  S IDX=$O(^OR(100,+ORID,4.5,SCH,IDX)) Q:'IDX  D
"RTN","ORWNSS",26,0)
 . S SCHVAL=$G(^OR(100,+ORID,4.5,SCH,IDX))
"RTN","ORWNSS",27,0)
 . Q:'$L(SCHVAL)
"RTN","ORWNSS",28,0)
 . D VALSCH^ORWDPS32(.ORY,SCHVAL,"I")
"RTN","ORWNSS",29,0)
 . I ORY=0 Q
"RTN","ORWNSS",30,0)
 Q
"RTN","ORWNSS",31,0)
QOSCH(ORY,QOID) ;Validate IM QO schedule
"RTN","ORWNSS",32,0)
 ;QOID: Inpt Pharmacy QO
"RTN","ORWNSS",33,0)
 S ORY=""
"RTN","ORWNSS",34,0)
 N QOSCH,SCHID,SCHVAL,RST
"RTN","ORWNSS",35,0)
 S SCHID=$O(^ORD(101.41,"B","OR GTX SCHEDULE",0))
"RTN","ORWNSS",36,0)
 S (QOSCH,SCHVAL)="",RST=1
"RTN","ORWNSS",37,0)
 I '$D(^ORD(101.41,+QOID,6,"D",SCHID)) S ORY="schedule is not defined." Q
"RTN","ORWNSS",38,0)
 S QOSCH=$O(^ORD(101.41,+QOID,6,"D",SCHID,0))
"RTN","ORWNSS",39,0)
 I 'QOSCH S ORY="schedule is not defined." Q
"RTN","ORWNSS",40,0)
 N IDX S IDX=0
"RTN","ORWNSS",41,0)
 F  S IDX=$O(^ORD(101.41,+QOID,6,QOSCH,IDX)) Q:'IDX!('RST)  D
"RTN","ORWNSS",42,0)
 . S SCHVAL=^ORD(101.41,+QOID,6,QOSCH,IDX)
"RTN","ORWNSS",43,0)
 . I $$UP^XLFSTR(SCHVAL)="OTHER" S ORY="OTHER" Q
"RTN","ORWNSS",44,0)
 . D VALSCH^ORWDPS32(.RST,SCHVAL,"I")
"RTN","ORWNSS",45,0)
 . I RST=0 S ORY="This quick order contains a non-standard administration schedule." Q
"RTN","ORWNSS",46,0)
 Q
"RTN","ORWNSS",47,0)
CHKSCH(ORY,SCH) ;Validate schedule
"RTN","ORWNSS",48,0)
 Q:SCH=""
"RTN","ORWNSS",49,0)
 D VALSCH^ORWDPS32(.ORY,SCH,"I")
"RTN","ORWNSS",50,0)
 Q
"RTN","ORWORR")
0^18^B63607607
"RTN","ORWORR",1,0)
ORWORR ; SLC/KCM/JLI - Retrieve Orders for Broker ;2/5/03 3PM
"RTN","ORWORR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,92,116,110,132,141,163,189,195**;Dec 17, 1997
"RTN","ORWORR",3,0)
 ;
"RTN","ORWORR",4,0)
GET(LST,DFN,FILTER,GROUPS) ; procedure
"RTN","ORWORR",5,0)
 Q  ; don't call until using same treating specialty logic as AGET
"RTN","ORWORR",6,0)
 ;    also until MULT, ORWARD, & ORIGVIEW implemented
"RTN","ORWORR",7,0)
 ;    also until the date ranges are implemented
"RTN","ORWORR",8,0)
 ; Get orders for a patient
"RTN","ORWORR",9,0)
 ;        1   2    3     4      5     6   7   8   9   10     11    12    13    14     15     16 17    18
"RTN","ORWORR",10,0)
 ; .LST=~IFN^Grp^ActTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^ActDA^Flag^DCType^ChrtRev^DEA#^^Schedule
"RTN","ORWORR",11,0)
 ; .LST=tOrder Text (repeating as necessary)
"RTN","ORWORR",12,0)
 ;     DFN=Patient ID
"RTN","ORWORR",13,0)
 ;  FILTER=number indicates which orders to return, default=2 (current)
"RTN","ORWORR",14,0)
 ;  GROUPS=display group of orders to show (default=ALL)
"RTN","ORWORR",15,0)
 ; -- this section uses ORQ1 to get the orders list rather than XGET --
"RTN","ORWORR",16,0)
 N ORLIST,ORIFN,X0,X3,X8,IDX,IFN,ACT,PRV,LN,TXT,STRT,STOP,CSTS,EYE,DEA ;PKI
"RTN","ORWORR",17,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",18,0)
 S (IDX,LST)=0 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",19,0)
 D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"","","",0,1)
"RTN","ORWORR",20,0)
 S EYE=0 F  S EYE=$O(^TMP("ORR",$J,ORLIST,EYE)) Q:'EYE  S IFN=^(EYE) D
"RTN","ORWORR",21,0)
 . S ACT=$P(IFN,";",2),IFN=+IFN,X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",22,0)
 . D GETFLDS
"RTN","ORWORR",23,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",24,0)
 G EXIT
"RTN","ORWORR",25,0)
AGET(REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT) ;Get an abbreviated event delayed order list for a patient 
"RTN","ORWORR",26,0)
 ; returns ^TMP("ORR",$J,ORLIST,n)=IFN^DGrp^ActTm
"RTN","ORWORR",27,0)
 ; see above for input parameters
"RTN","ORWORR",28,0)
 ; -- from ORWORR
"RTN","ORWORR",29,0)
 ; -- this section uses ORQ1 to get the orders list rather than XGET --
"RTN","ORWORR",30,0)
 N ORLIST,ORIFN,IFN,I,ORWTS,TOT,MULT,ORWARD,TXTVW,ORYD,PTEVTID,EVTNAME
"RTN","ORWORR",31,0)
 S (PTEVTID,EVTNAME)=""
"RTN","ORWORR",32,0)
 K ^TMP("ORR",$J),^TMP("ORRJD",$J)
"RTN","ORWORR",33,0)
 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",34,0)
 S ORWTS=+$P(FILTER,U,2),FILTER=+FILTER
"RTN","ORWORR",35,0)
 S MULT=$S("^1^6^8^9^10^11^13^14^20^22^"[(U_FILTER_U):1,1:0)
"RTN","ORWORR",36,0)
 I $L($G(^DPT(DFN,.1))) S ORWARD=1 ; should normally be ptr to 42
"RTN","ORWORR",37,0)
 S:'$L($G(DTFROM)) DTFROM=0
"RTN","ORWORR",38,0)
 S:'$L($G(DTTHRU)) DTTHRU=0
"RTN","ORWORR",39,0)
 S:'$L($G(EVENT)) EVENT=0
"RTN","ORWORR",40,0)
 I $G(EVTDCREL)="TRUE" D
"RTN","ORWORR",41,0)
 . D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"",DTFROM,DTTHRU,2,MULT,"",1,EVENT)
"RTN","ORWORR",42,0)
 . D GET2^ORWORR1
"RTN","ORWORR",43,0)
 E  D
"RTN","ORWORR",44,0)
 . D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"",DTFROM,DTTHRU,0,MULT,"",1,EVENT)
"RTN","ORWORR",45,0)
 . D GET1^ORWORR1
"RTN","ORWORR",46,0)
 Q
"RTN","ORWORR",47,0)
RGET(REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT) ;Orders of AutoDC/Release Event
"RTN","ORWORR",48,0)
 N EVTDCREL
"RTN","ORWORR",49,0)
 S EVTDCREL="TRUE"
"RTN","ORWORR",50,0)
 D AGET(.REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT)
"RTN","ORWORR",51,0)
 Q
"RTN","ORWORR",52,0)
XGET ; -- this was the retrieval algorithm before all the AC xref changes
"RTN","ORWORR",53,0)
 N X,X0,X3,IDX,IFN,LN,TIME,DGRP,MASK,TXT,ACT,PRV,ID,DEA,PASS ;PKI
"RTN","ORWORR",54,0)
 S DFN=DFN_";DPT(",IDX=0,LST=0
"RTN","ORWORR",55,0)
 I '$G(FILTER) S FILTER=2                    ; Default: Current/Active
"RTN","ORWORR",56,0)
 I $D(GROUPS)=1 D
"RTN","ORWORR",57,0)
 . S:'GROUPS GROUPS=$O(^ORD(100.98,"B",GROUPS,0))
"RTN","ORWORR",58,0)
 . D XPND(GROUPS)
"RTN","ORWORR",59,0)
 I FILTER=1  D DOALL G EXIT                  ; All
"RTN","ORWORR",60,0)
 I FILTER=2  D DOCUR G EXIT                  ; Current
"RTN","ORWORR",61,0)
 I FILTER=3  S PASS=";1;"                    ; Discontinued
"RTN","ORWORR",62,0)
 I FILTER=4  S PASS=";2;7;"                  ; Comp/Expired
"RTN","ORWORR",63,0)
 I FILTER=5  S PASS=";3;4;5;6;8;9;"          ; Expiring
"RTN","ORWORR",64,0)
 I FILTER=6  S PASS=";1;2;3;4;5;6;7;8;9;11;" ; New Activity
"RTN","ORWORR",65,0)
 I FILTER=7  S PASS=";5;"                    ; Pending
"RTN","ORWORR",66,0)
 I FILTER=8  Q                               ; Expanded
"RTN","ORWORR",67,0)
 I FILTER=9  S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Nurse
"RTN","ORWORR",68,0)
 I FILTER=10 S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Clerk
"RTN","ORWORR",69,0)
 I FILTER=11 S PASS=";3;4;5;6;7;8;11;"       ; Unsigned
"RTN","ORWORR",70,0)
 I FILTER=12 S PASS=";4;"                    ; Flagged
"RTN","ORWORR",71,0)
 I FILTER=13 S PASS=""                       ; Verbal/Phone
"RTN","ORWORR",72,0)
 I FILTER=14 S PASS=""                       ; Verbal/Phone Unsigned
"RTN","ORWORR",73,0)
 D DOGET
"RTN","ORWORR",74,0)
EXIT I LST=0 D
"RTN","ORWORR",75,0)
 . N %,X,%I D NOW^%DTC
"RTN","ORWORR",76,0)
 . S LST(1)="~0^0^"_%_"^^^97",LST(2)="tNo Orders Found."
"RTN","ORWORR",77,0)
 Q
"RTN","ORWORR",78,0)
DOGET ; Come here if need to filter the orders 
"RTN","ORWORR",79,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",80,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",81,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",82,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",83,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",84,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",85,0)
 . . . I $L(PASS),(PASS'[(";"_$P(X3,U,3)_";")) Q  ;filter by status
"RTN","ORWORR",86,0)
 . . . ; do any other filtering
"RTN","ORWORR",87,0)
 . . . D GETFLDS
"RTN","ORWORR",88,0)
 Q
"RTN","ORWORR",89,0)
DOALL ; Come here if retrieve all orders (no filter by status)
"RTN","ORWORR",90,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",91,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",92,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",93,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",94,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",95,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",96,0)
 . . . D GETFLDS
"RTN","ORWORR",97,0)
 Q
"RTN","ORWORR",98,0)
DOCUR ; Come here to retrieve all current orders
"RTN","ORWORR",99,0)
 N AOCTXT,STS,STOP,%
"RTN","ORWORR",100,0)
 S X=-$$GET^XPAR("ALL","ORPF ACTIVE ORDERS CONTEXT HRS")
"RTN","ORWORR",101,0)
 S %H=$H,X=(%H*86400+$P(%H,",",2))+(X*3600),%H=(X\86400)_","_(X#86400)
"RTN","ORWORR",102,0)
 D YMD^%DTC S AOCTXT=X_%
"RTN","ORWORR",103,0)
 S MASK="110000100101110"   ; mask out STS=1,2,7,10,12,13,14
"RTN","ORWORR",104,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AC",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",105,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AC",DFN,TIME,IFN)) Q:'IFN  D
"RTN","ORWORR",106,0)
 . . ; filter out display groups here
"RTN","ORWORR",107,0)
 . . S ACT=0 F  S ACT=$O(^OR(100,"AC",DFN,TIME,IFN,ACT)) Q:'ACT  D
"RTN","ORWORR",108,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",109,0)
 . . . S STS=$P(X3,U,3),STOP=$P(X0,U,9)
"RTN","ORWORR",110,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!(STS=99) Q
"RTN","ORWORR",111,0)
 . . . I $P(X8,U,15)=13,($P(X8,U)<AOCTXT) D ACKILL Q
"RTN","ORWORR",112,0)
 . . . I $P(X8,U,15)=13!($P(X8,U,15)=""),("RN^XX"[$P(X8,U,2)) D ACKILL Q
"RTN","ORWORR",113,0)
 . . . I $E(MASK,STS),STOP<AOCTXT D ACKILL Q
"RTN","ORWORR",114,0)
 . . . D GETFLDS
"RTN","ORWORR",115,0)
 Q
"RTN","ORWORR",116,0)
ACKILL ; called only from DOCUR - kill AC xref
"RTN","ORWORR",117,0)
 ; K ^OR(100,"AC",DFN,TIME,IFN,ACT)  ; let ORQ1 kill if for now
"RTN","ORWORR",118,0)
 Q
"RTN","ORWORR",119,0)
GET4V11(LST,TXTVW,ORYD,IFNLST) ; get the order fields TEMPORARY
"RTN","ORWORR",120,0)
 G GET41
"RTN","ORWORR",121,0)
GET4LST(LST,IFNLST)     ; get the order fields for a list of orders
"RTN","ORWORR",122,0)
GET41 N ACT,ACTID,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,IFN,IFNIDX,ORIGVIEW,DEA ;PKI
"RTN","ORWORR",123,0)
 N LOC ;IMO
"RTN","ORWORR",124,0)
 S (IDX,LST,IFNIDX)=0
"RTN","ORWORR",125,0)
 F  S IFNIDX=$O(IFNLST(IFNIDX)) Q:'IFNIDX  S IFN=IFNLST(IFNIDX) D
"RTN","ORWORR",126,0)
 . S ACT=$S($P(IFN,";",2):$P(IFN,";",2),1:1),IFN=+IFN
"RTN","ORWORR",127,0)
 . S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)),X8=$G(^(8,ACT,0))
"RTN","ORWORR",128,0)
 . D GETFLDS
"RTN","ORWORR",129,0)
 Q
"RTN","ORWORR",130,0)
GETBYIFN(LST,IFN) ; procedure
"RTN","ORWORR",131,0)
 ; get the fields for a single order
"RTN","ORWORR",132,0)
 ; .LST(n)=as described above in GET
"RTN","ORWORR",133,0)
 ;     IFN=internal entry number for order
"RTN","ORWORR",134,0)
 I 'IFN Q
"RTN","ORWORR",135,0)
 N ACT,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,ACTID,ORIGVIEW,ORYD,TXTVW,DEA ;PKI
"RTN","ORWORR",136,0)
 S IDX=0,LST=0,ORYD=0
"RTN","ORWORR",137,0)
 S X0=$G(^OR(100,+IFN,0)),X3=$G(^(3))
"RTN","ORWORR",138,0)
 S ACT=$S($P(IFN,";",2):$P(IFN,";",2),$P(X3,U,7):$P(X3,U,7),1:1)
"RTN","ORWORR",139,0)
 S IFN=+IFN,X8=$G(^OR(100,IFN,8,ACT,0))
"RTN","ORWORR",140,0)
GETFLDS ; used by entry points to place order fields into list
"RTN","ORWORR",141,0)
 ; expects IDX=sequence #, IFN=order, X0=node 0, X3=node 3, LST=results
"RTN","ORWORR",142,0)
 ; LST(IDX)=~IFN^Grp^OrdTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^Act^Flagged[^DCType]^ChartRev^DEA#^^DigSig^LOC
"RTN","ORWORR",143,0)
 S PRV=$P(X8,U,5) S:'PRV PRV=$P(X8,U,3) S PRV=PRV_U
"RTN","ORWORR",144,0)
 I PRV S PRV=PRV_$P(^VA(200,+PRV,0),U)
"RTN","ORWORR",145,0)
 S DEA=$$DEA^XUSER(,+PRV) ; get user DEA info - PKI
"RTN","ORWORR",146,0)
 S IDX=IDX+1,LST=LST+1,ID=IFN_";"_ACT,ACTID=$P(X8,U,2)
"RTN","ORWORR",147,0)
 S CSTS=$S($P(X8,U,15):$P(X8,U,15),1:$P(X3,U,3))
"RTN","ORWORR",148,0)
 I $P(X8,U,15)=10,$P(X3,U,3)=14 S CSTS=14 ;delayed-lapsed order
"RTN","ORWORR",149,0)
 S STRT=$S($P(X3,U,3)=11:$$RSTRT,ACTID="NW"!(ACTID="XX")!(ACTID="RL"):$P(X0,U,8),ACTID="DC":"",1:$P(X8,U)) ;110
"RTN","ORWORR",150,0)
 S STOP=$S($P(X3,U,3)=11:$$RSTOP,ACTID="HD":$P($G(^OR(100,+IFN,8,ACT,2)),U),1:$P(X0,U,9))
"RTN","ORWORR",151,0)
 S LST(IDX)="~"_ID_U_$P(X0,U,11)_U_$P(X8,U)_U_STRT_U_STOP_U_CSTS_U_$P(X8,U,4)_U_$P(X8,U,8)_U_$P(X8,U,10)_U_PRV
"RTN","ORWORR",152,0)
 S $P(LST(IDX),U,13)=+$G(^OR(100,IFN,8,ACT,3))    ; flagged
"RTN","ORWORR",153,0)
 I +$P(X8,U,8) S $P(LST(IDX),U,8)=$$INITIALS^ORCHTAB2(+$P(X8,U,8))    ;nurse
"RTN","ORWORR",154,0)
 I +$P(X8,U,10) S $P(LST(IDX),U,9)=$$INITIALS^ORCHTAB2(+$P(X8,U,10))  ;clerk
"RTN","ORWORR",155,0)
 I +$P(X8,U,18) S $P(LST(IDX),U,15)=$$INITIALS^ORCHTAB2(+$P(X8,U,18)) ;chart review
"RTN","ORWORR",156,0)
 I $L($G(DEA)) S $P(LST(IDX),U,16)=DEA ;PKI
"RTN","ORWORR",157,0)
 I $P($G(^OR(100,IFN,8,ACT,2)),"^",5) S $P(LST(IDX),U,18)=$P(^(2),"^",4)
"RTN","ORWORR",158,0)
 I '$P($G(^OR(100,IFN,8,ACT,2)),"^",5),$P(X0,"^",5) D  ;Copy orders PKI fix
"RTN","ORWORR",159,0)
 . N OI,ORVP,ORCAT,PKG
"RTN","ORWORR",160,0)
 . S OI=+$O(^OR(100,IFN,4.5,"ID","ORDERABLE",0)),OI=+$G(^OR(100,IFN,4.5,OI,1)) Q:'OI
"RTN","ORWORR",161,0)
 . S ORVP=$P(X0,"^",2),PKG=$P(X0,"^",14)
"RTN","ORWORR",162,0)
 . S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWORR",163,0)
 . I PKG'=$O(^DIC(9.4,"B","OUTPATIENT PHARMACY",0)) Q
"RTN","ORWORR",164,0)
 . D PKI^ORWDPS1(.ORY,OI,ORCAT,+ORVP,$$GET^XPAR("ALL^USR.`"_DUZ,"ORWOR PKI USE",1,"Q"))
"RTN","ORWORR",165,0)
 . I $E($G(ORY))=2 S $P(LST(IDX),U,18)=ORY
"RTN","ORWORR",166,0)
 S LOC="" ;IMO
"RTN","ORWORR",167,0)
 I $P(X0,U,18) S LOC=$P(X0,U,10) ;IMO
"RTN","ORWORR",168,0)
 S:+LOC LOC=$P($G(^SC(+LOC,0)),U)_":"_+LOC ;IMO
"RTN","ORWORR",169,0)
 S $P(LST(IDX),U,19)=LOC ;IMO
"RTN","ORWORR",170,0)
 S ORIGVIEW=$S($G(TXTVW)=0:0,$G(TXTVW)=1:1,ORYD=-1:1,'ORYD:1,$P(X8,U)'<ORYD:0,1:1)
"RTN","ORWORR",171,0)
 K TXT D TEXT^ORQ12(.TXT,ID,255)                  ; optimize this later
"RTN","ORWORR",172,0)
 I $O(^OR(100,+IFN,2,0)) S LN=$O(TXT(0)),TXT(LN)="+"_TXT(LN)
"RTN","ORWORR",173,0)
 I $O(^OR(100,+IFN,8,"C","XX",0)) S LN=$O(TXT(0)),TXT(LN)="*"_TXT(LN)
"RTN","ORWORR",174,0)
 S LN=0 F  S LN=$O(TXT(LN)) Q:'LN  S IDX=IDX+1,LST(IDX)="t"_TXT(LN)
"RTN","ORWORR",175,0)
 I $O(^OR(100,+IFN,8,1,.2,0)) S IDX=IDX+1,LST(IDX)="|" D  ;PKI XMLText
"RTN","ORWORR",176,0)
 . S I=0 F  S I=$O(^OR(100,+IFN,8,1,.2,I)) Q:'I  S IDX=IDX+1,LST(IDX)="x"_^(I,0)
"RTN","ORWORR",177,0)
 Q
"RTN","ORWORR",178,0)
RSTRT() ; return start date from responses
"RTN","ORWORR",179,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","START",0)),1))
"RTN","ORWORR",180,0)
RSTOP() ; return stop date from responses
"RTN","ORWORR",181,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","STOP",0)),1))
"RTN","ORWORR",182,0)
GETTXT(LST,IFN)     ; get the text of an order
"RTN","ORWORR",183,0)
 I $L(IFN,";")=1 S IFN=IFN_";1"
"RTN","ORWORR",184,0)
 D TEXT^ORQ12(.LST,IFN,255)
"RTN","ORWORR",185,0)
 Q
"RTN","ORWORR",186,0)
XPND(AGRP) ; procedure
"RTN","ORWORR",187,0)
 ; Expand a display group (GROUPS must be defined outside of call)
"RTN","ORWORR",188,0)
 N I,CHLD
"RTN","ORWORR",189,0)
 S GROUPS(AGRP)=^ORD(100.98,AGRP,0),I=0
"RTN","ORWORR",190,0)
 F  S I=$O(^ORD(100.98,AGRP,1,I)) Q:'I  S CHLD=$P(^(I,0),U) D XPND(CHLD)
"RTN","ORWORR",191,0)
 Q
"RTN","ORWORR",192,0)
GETPKG(Y,IFN) ; get package for an order
"RTN","ORWORR",193,0)
 N ORDERID,PKGID
"RTN","ORWORR",194,0)
 Q:+IFN<1
"RTN","ORWORR",195,0)
 S ORDERID=+IFN,Y=""
"RTN","ORWORR",196,0)
 S PKGID=$P(OR(100,ORDERID,0),U,14)
"RTN","ORWORR",197,0)
 S:PKGID>0 Y=$P(^DIC(9.4,PKGID,0),U,2)
"RTN","ORWORR",198,0)
 Q
"RTN","ORWPCE")
0^12^B48169607
"RTN","ORWPCE",1,0)
ORWPCE ; SLC/JM/REV - wrap calls to PCE and AICS;04/01/2003 ;11/21/03
"RTN","ORWPCE",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,173,190,195**;Dec 17, 1997
"RTN","ORWPCE",3,0)
 Q
"RTN","ORWPCE",4,0)
VISIT(LST,CLINIC,ORDATE) ; get list of visit types for clinic
"RTN","ORWPCE",5,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",6,0)
 D GETLST^IBDF18A(CLINIC,"DG SELECT VISIT TYPE CPT PROCEDURES","LST",,,,ORDATE)
"RTN","ORWPCE",7,0)
 Q
"RTN","ORWPCE",8,0)
PROC(LST,CLINIC,ORDATE) ; get list of procedures for clinic P12 for CPTMods
"RTN","ORWPCE",9,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",10,0)
 D GETLST^IBDF18A(CLINIC,"DG SELECT CPT PROCEDURE CODES","LST",,,1,ORDATE)
"RTN","ORWPCE",11,0)
 N IDX,MOD,CODES,FIRST S IDX=0
"RTN","ORWPCE",12,0)
 F  S IDX=$O(LST(IDX)) Q:'+IDX  D
"RTN","ORWPCE",13,0)
 . I LST(IDX)="" K LST(IDX) Q
"RTN","ORWPCE",14,0)
 . S MOD=0,CODES="",FIRST=1
"RTN","ORWPCE",15,0)
 . F  S MOD=$O(LST(IDX,"MODIFIER",MOD)) Q:(MOD="")  D
"RTN","ORWPCE",16,0)
 . . I FIRST S FIRST=0
"RTN","ORWPCE",17,0)
 . . E  S CODES=CODES_";"
"RTN","ORWPCE",18,0)
 . . S CODES=CODES_LST(IDX,"MODIFIER",MOD)
"RTN","ORWPCE",19,0)
 . K LST(IDX,"MODIFIER")
"RTN","ORWPCE",20,0)
 . I 'FIRST S $P(LST(IDX),U,12)=CODES
"RTN","ORWPCE",21,0)
 Q
"RTN","ORWPCE",22,0)
CPTMODS(LST,ORCPTCOD,ORDATE) ;Return CPT Modifiers for a CPT Code
"RTN","ORWPCE",23,0)
 N ORM,ORIDX,ORI,MODNAME
"RTN","ORWPCE",24,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",25,0)
 I +($$CODM^ICPTCOD(ORCPTCOD,$NA(ORM),0,ORDATE)),+$D(ORM) D
"RTN","ORWPCE",26,0)
 . S ORIDX="",ORI=0
"RTN","ORWPCE",27,0)
 . F  S ORIDX=$O(ORM(ORIDX)) Q:(ORIDX="")  D
"RTN","ORWPCE",28,0)
 . . S ORI=ORI+1,MODNAME=$P(ORM(ORIDX),U,1)
"RTN","ORWPCE",29,0)
 . . S LST(MODNAME_ORI)=$P(ORM(ORIDX),U,2)_U_MODNAME_U_ORIDX
"RTN","ORWPCE",30,0)
 Q
"RTN","ORWPCE",31,0)
GETMOD(MODINFO,ORMODIEN,ORDATE) ;Returns info for a specific CPT Modifier
"RTN","ORWPCE",32,0)
 N ORDATA
"RTN","ORWPCE",33,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",34,0)
 S ORDATA=$$MOD^ICPTMOD(ORMODIEN,"I",ORDATE,1)
"RTN","ORWPCE",35,0)
 I +ORDATA>0 S MODINFO=ORMODIEN_U_$P(ORDATA,U,3)_U_$P(ORDATA,U,2)
"RTN","ORWPCE",36,0)
 Q
"RTN","ORWPCE",37,0)
DIAG(LST,CLINIC,ORDATE) ; get list of diagnoses for clinic
"RTN","ORWPCE",38,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",39,0)
 D GETLST^IBDF18A(CLINIC,"DG SELECT ICD-9 DIAGNOSIS CODES","LST",,,,ORDATE)
"RTN","ORWPCE",40,0)
 Q
"RTN","ORWPCE",41,0)
IMM(LST,CLINIC) ;get list of immunizations for clinic
"RTN","ORWPCE",42,0)
 D GETLST^IBDF18A(CLINIC,"PX SELECT IMMUNIZATIONS","LST")
"RTN","ORWPCE",43,0)
 Q
"RTN","ORWPCE",44,0)
SK(LST,CLINIC) ;get list of skin test for clinic
"RTN","ORWPCE",45,0)
 D GETLST^IBDF18A(CLINIC,"PX SELECT SKIN TESTS","LST")
"RTN","ORWPCE",46,0)
 Q
"RTN","ORWPCE",47,0)
HF(LST,CLINIC) ;get list of health factors for clinic
"RTN","ORWPCE",48,0)
 D GETLST^IBDF18A(CLINIC,"PX SELECT HEALTH FACTORS","LST")
"RTN","ORWPCE",49,0)
 Q
"RTN","ORWPCE",50,0)
PED(LST,CLINIC) ;get list of education topices for clinic
"RTN","ORWPCE",51,0)
 D GETLST^IBDF18A(CLINIC,"PX SELECT EDUCATION TOPICS","LST")
"RTN","ORWPCE",52,0)
 Q
"RTN","ORWPCE",53,0)
TRT(LST,CLINIC) ;get list of treatments for clinic
"RTN","ORWPCE",54,0)
 D GETLST^IBDF18A(CLINIC,"PX SELECT TREATMENTS","LST")
"RTN","ORWPCE",55,0)
 Q
"RTN","ORWPCE",56,0)
XAM(LST,CLINIC) ;get list of exams for clinic
"RTN","ORWPCE",57,0)
 D GETLST^IBDF18A(CLINIC,"PX SELECT EXAMS","LST")
"RTN","ORWPCE",58,0)
 Q
"RTN","ORWPCE",59,0)
ACTPROB(GLST,DFN,ORDATE) ;get list of patient's active problems
"RTN","ORWPCE",60,0)
 K ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS")
"RTN","ORWPCE",61,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",62,0)
 D DSELECT^GMPLENFM
"RTN","ORWPCE",63,0)
 N ORPROB,ORPROBIX,ORPRCNT
"RTN","ORWPCE",64,0)
 S ORPRCNT=0
"RTN","ORWPCE",65,0)
 S ORPROBIX=0
"RTN","ORWPCE",66,0)
 F  S ORPROBIX=$O(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORPROBIX)) Q:'ORPROBIX  D
"RTN","ORWPCE",67,0)
 . S ORPROB=$P(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORPROBIX),"^",2,3)
"RTN","ORWPCE",68,0)
 . I $E(ORPROB,1)="$" S ORPROB=$E(ORPROB,2,255)
"RTN","ORWPCE",69,0)
 . I '$D(ORPROB(ORPROB)) D
"RTN","ORWPCE",70,0)
 .. S ORPROB(ORPROB)=""
"RTN","ORWPCE",71,0)
 .. S ORPRCNT=ORPRCNT+1
"RTN","ORWPCE",72,0)
 .. S $P(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORPROBIX),"^",2,3)=ORPROB
"RTN","ORWPCE",73,0)
 . E  K ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORPROBIX)
"RTN","ORWPCE",74,0)
 ; DBIA   10082     NAME: ICD DIAGNOSIS FILE
"RTN","ORWPCE",75,0)
 N ORWINDEX,ORITEM
"RTN","ORWPCE",76,0)
 S ORWINDEX=0
"RTN","ORWPCE",77,0)
 F  S ORWINDEX=$O(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORWINDEX)) Q:'ORWINDEX  D:$P(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORWINDEX),"^",1)]""
"RTN","ORWPCE",78,0)
 . S ORITEM=^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORWINDEX)
"RTN","ORWPCE",79,0)
 . I '+$$STATCHK^ICDAPIU($P(ORITEM,"^",3),ORDATE) S $P(ORITEM,"^",11)="#"
"RTN","ORWPCE",80,0)
 . S ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORWINDEX)=ORITEM
"RTN","ORWPCE",81,0)
 S ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",0)=ORPRCNT
"RTN","ORWPCE",82,0)
 S GLST="^TMP(""IB"","_$J_",""INTERFACES"",""GMP SELECT PATIENT ACTIVE PROBLEMS"")"
"RTN","ORWPCE",83,0)
 Q
"RTN","ORWPCE",84,0)
SCSEL(VAL,DFN,ATM,LOC,VST) ; return SC conditions that may be selected
"RTN","ORWPCE",85,0)
 ; VAL=SCallow^SCdflt;AOallow^AOdflt;IRallow^IRdflt;ECallow^ECdflt;
"RTN","ORWPCE",86,0)
 ;     MSTallow^MSTdflt;HNCallow^HNCdflt;CVAllow^CVDflt
"RTN","ORWPCE",87,0)
 N ORX,S S S=";"
"RTN","ORWPCE",88,0)
 D SCCOND^PXUTLSCC(DFN,ATM,LOC,$G(VST),.ORX)
"RTN","ORWPCE",89,0)
 S VAL=$G(ORX("SC"))_S_$G(ORX("AO"))_S_$G(ORX("IR"))_S_$G(ORX("EC"))_S_$G(ORX("MST"))_S_$G(ORX("HNC"))_S_$G(ORX("CV"))
"RTN","ORWPCE",90,0)
 Q
"RTN","ORWPCE",91,0)
SCDIS(LST,DFN) ; Return service connected % and rated disabilities
"RTN","ORWPCE",92,0)
 N VAEL,VAERR,I,ILST,DIS,SC,X
"RTN","ORWPCE",93,0)
 D ELIG^VADPT
"RTN","ORWPCE",94,0)
 S LST(1)="Service Connected: "_$S(+VAEL(3):$P(VAEL(3),U,2)_"%",1:"NO")
"RTN","ORWPCE",95,0)
 I 'VAEL(4),'$P($G(^DG(391,+VAEL(6),0)),U,2) S LST(2)="NOT A VETERAN." Q
"RTN","ORWPCE",96,0)
 S I=0,ILST=1 F  S I=$O(^DPT(DFN,.372,I)) Q:'I  S X=^(I,0) D
"RTN","ORWPCE",97,0)
 . S DIS=$P($G(^DIC(31,+X,0)),U) Q:DIS=""
"RTN","ORWPCE",98,0)
 . S SC=$S($P(X,U,3):"SC",$P(X,U,3)']"":"not specified",1:"NSC")
"RTN","ORWPCE",99,0)
 . S ILST=ILST+1,LST(ILST)=DIS_" ("_$P(X,U,2)_"% "_SC_")"
"RTN","ORWPCE",100,0)
 I ILST=1 S LST(2)="Rated Disabilities: NONE STATED"
"RTN","ORWPCE",101,0)
 Q
"RTN","ORWPCE",102,0)
CPTREQD(VAL,IEN) ; return 1 in VAL if note still needs a CPT code
"RTN","ORWPCE",103,0)
 S VAL=+$P(^TIU(8925,IEN,0),U,11)
"RTN","ORWPCE",104,0)
 Q
"RTN","ORWPCE",105,0)
NOTEVSTR(VAL,IEN) ; return the VSTR^AUTHOR for a note
"RTN","ORWPCE",106,0)
 N X0,X12,VISIT
"RTN","ORWPCE",107,0)
 S X0=$G(^TIU(8925,+IEN,0)),X12=$G(^(12)),VISIT=$P(X12,U,7)
"RTN","ORWPCE",108,0)
 I +VISIT S VAL=$$VSTRBLD^TIUSRVP(VISIT) I 1
"RTN","ORWPCE",109,0)
 E  S VAL=$P(X12,U,11)_";"_$P(X0,U,7)_";"_$P(X0,U,13)
"RTN","ORWPCE",110,0)
 Q
"RTN","ORWPCE",111,0)
HASVISIT(ORY,IEN,DFN,ORLOC,ORDTE) ;Has visit or is stand alone
"RTN","ORWPCE",112,0)
 N ORVISIT
"RTN","ORWPCE",113,0)
 S ORY=-1
"RTN","ORWPCE",114,0)
 I +$G(IEN)>0 S ORVISIT=+$P($G(^TIU(8925,+IEN,0)),U,3)
"RTN","ORWPCE",115,0)
 I +$G(ORVISIT)'>0 S ORVISIT=$$GETENC^PXAPI(DFN,ORDTE,ORLOC)
"RTN","ORWPCE",116,0)
 I +$G(ORVISIT)>0 S ORY=$$VST2APPT^PXAPI(ORVISIT)
"RTN","ORWPCE",117,0)
 Q
"RTN","ORWPCE",118,0)
DELETE(VAL,VSTR,DFN) ; delete PCE info when deleting a note
"RTN","ORWPCE",119,0)
 N VISIT,ORCOUNT
"RTN","ORWPCE",120,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC,ZTSYNC,ZTSK
"RTN","ORWPCE",121,0)
 I '$D(^TMP("ORWPCE",$J,VSTR)) S VAL=0 Q  ; no PCE data saved yet
"RTN","ORWPCE",122,0)
 I $P(VSTR,";",3)="H" S VAL=0 Q           ; leave inpatient alone
"RTN","ORWPCE",123,0)
 I $L($T(DOCCNT^TIUSRVLV))=0 S VAL=0 Q    ; leave if no tiu entry point
"RTN","ORWPCE",124,0)
 D DOCCNT^TIUSRVLV(.ORCOUNT,DFN,VSTR)     ; Do not delete if another
"RTN","ORWPCE",125,0)
 I ORCOUNT>0 S VAL=0 Q                    ; title points to visit
"RTN","ORWPCE",126,0)
 S ZTIO="ORW/PXAPI RESOURCE",ZTRTN="DQDEL^ORWPCE1",ZTDTH=$H
"RTN","ORWPCE",127,0)
 S (ZTSAVE("VSTR"),ZTSAVE("DFN"))="",ZTDESC="CPRS Delete Note/PCE"
"RTN","ORWPCE",128,0)
 S ZTSYNC="ORW"_VSTR
"RTN","ORWPCE",129,0)
 D ^%ZTLOAD I '$D(ZTSK) D DQDEL^ORWPCE1
"RTN","ORWPCE",130,0)
 Q
"RTN","ORWPCE",131,0)
SAVE(OK,PCELIST,NOTEIEN,ORLOC) ; save PCE information
"RTN","ORWPCE",132,0)
 N VSTR,GMPLUSER
"RTN","ORWPCE",133,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC,ZTSYNC,ZTSK
"RTN","ORWPCE",134,0)
 S VSTR=$P(PCELIST(1),U,4) K ^TMP("ORWPCE",$J,VSTR)
"RTN","ORWPCE",135,0)
 M ^TMP("ORWPCE",$J,VSTR)=PCELIST
"RTN","ORWPCE",136,0)
 S GMPLUSER=$$CLINUSER^ORQQPL1(DUZ),NOTEIEN=+$G(NOTEIEN)
"RTN","ORWPCE",137,0)
 S ZTIO="ORW/PXAPI RESOURCE",ZTRTN="DQSAVE^ORWPCE1",ZTDTH=$H
"RTN","ORWPCE",138,0)
 S ZTSAVE("PCELIST(")="",ZTDESC="Data from CPRS to PCE"
"RTN","ORWPCE",139,0)
 S ZTSAVE("GMPLUSER")="",ZTSAVE("NOTEIEN")="",ZTSAVE("DUZ")=""
"RTN","ORWPCE",140,0)
 I VSTR'["E" S ZTSYNC="ORW"_VSTR
"RTN","ORWPCE",141,0)
 S ZTSAVE("ORLOC")=""
"RTN","ORWPCE",142,0)
 D ^%ZTLOAD I '$D(ZTSK) D DQSAVE^ORWPCE1
"RTN","ORWPCE",143,0)
 Q
"RTN","ORWPCE",144,0)
LEX(LST,X,APP,ORDATE)   ; return list after lexicon lookup
"RTN","ORWPCE",145,0)
 N LEX,ILST,I,IEN
"RTN","ORWPCE",146,0)
 S:APP="CPT" APP="CHP" ; LEX PATCH 10
"RTN","ORWPCE",147,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",148,0)
 D CONFIG^LEXSET(APP,APP,ORDATE)
"RTN","ORWPCE",149,0)
 D LOOK^LEXA(X,APP,1,"",ORDATE)
"RTN","ORWPCE",150,0)
 I '$D(LEX("LIST",1)) S LST(1)="-1^No matches found." Q
"RTN","ORWPCE",151,0)
 S LST(1)=LEX("LIST",1),ILST=1
"RTN","ORWPCE",152,0)
 S I="" F  S I=$O(^TMP("LEXFND",$J,I)) Q:I'<0  D
"RTN","ORWPCE",153,0)
 . S IEN=$O(^TMP("LEXFND",$J,I,0))
"RTN","ORWPCE",154,0)
 . S ILST=ILST+1,LST(ILST)=IEN_U_^TMP("LEXFND",$J,I,IEN)
"RTN","ORWPCE",155,0)
 K ^TMP("LEXFND",$J),^TMP("LEXHIT",$J)
"RTN","ORWPCE",156,0)
 Q
"RTN","ORWPCE",157,0)
LEXCODE(VAL,IEN,APP,ORDATE)     ; return code for a lexicon entry
"RTN","ORWPCE",158,0)
 S VAL=""
"RTN","ORWPCE",159,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",160,0)
 I APP="ICD" S VAL=$$ICDONE^LEXU(IEN,ORDATE)
"RTN","ORWPCE",161,0)
 I APP="CPT"!(APP="CHP") S VAL=$$CPTONE^LEXU(IEN,ORDATE) ; LEX PATCH 10
"RTN","ORWPCE",162,0)
 I VAL="",(APP="CHP") S VAL=$$CPCONE^LEXU(IEN,ORDATE) ; LEX PATCH 10
"RTN","ORWPCE",163,0)
 Q
"RTN","ORWPCE",164,0)
ADDRES ; Add the ORW/PXAPI RESOURCE device
"RTN","ORWPCE",165,0)
 N X
"RTN","ORWPCE",166,0)
 S X=$$RES^XUDHSET("ORW/PXAPI RESOURCE",,5,"CPRS to PCE transactions")
"RTN","ORWPCE",167,0)
 Q
"RTN","ORWPCE",168,0)
GETSVC(NEWSVC,SVC,LOC,INP) ; Returns the correct Service Connected Category
"RTN","ORWPCE",169,0)
 N DSS
"RTN","ORWPCE",170,0)
 S DSS=$P($G(^SC(+LOC,0)),U,7)
"RTN","ORWPCE",171,0)
 Q:'+DSS
"RTN","ORWPCE",172,0)
 S NEWSVC=$$SVC^PXKCO(.SVC,DSS,INP,LOC) ; DBIA #3225
"RTN","ORWPCE",173,0)
 Q
"RTN","ORWPCE2")
0^15^B46743157
"RTN","ORWPCE2",1,0)
ORWPCE2 ; ISL/JM - wrap calls to PCE ;9/25/2001
"RTN","ORWPCE2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,116,173,195**;Dec 17, 1997
"RTN","ORWPCE2",3,0)
GETSET(ORWLST,ORWFILE,ORWFIELD,ORWNULL) ;gets set of codes 
"RTN","ORWPCE2",4,0)
 ; ORWLST(n)=code^text for code
"RTN","ORWPCE2",5,0)
 N ORWPCE,ORWPCEL,ORWPCEC,ORWPCELO,ORWPCEHI,ORWPCECD,ORWPCET
"RTN","ORWPCE2",6,0)
 S ORWPCELO="abcdefghijklmnopqrstuvwxyz"
"RTN","ORWPCE2",7,0)
 S ORWPCEHI="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
"RTN","ORWPCE2",8,0)
 D FIELD^DID(ORWFILE,ORWFIELD,"","POINTER","ORWPCE","ORWPCE")
"RTN","ORWPCE2",9,0)
 S ORWPCEL=$L(ORWPCE("POINTER"),";")-1
"RTN","ORWPCE2",10,0)
 F ORWPCEC=1:1:ORWPCEL D
"RTN","ORWPCE2",11,0)
 . S ORWPCECD=$P($P(ORWPCE("POINTER"),";",ORWPCEC),":",1)
"RTN","ORWPCE2",12,0)
 . S ORWPCET=$P($P(ORWPCE("POINTER"),";",ORWPCEC),":",2)
"RTN","ORWPCE2",13,0)
 . S ORWLST(ORWPCEC)=ORWPCECD_"^"_$E(ORWPCET)_$TR($E(ORWPCET,2,99),ORWPCEHI,ORWPCELO)
"RTN","ORWPCE2",14,0)
 S:$G(ORWNULL) ORWLST(0)="@^(None selected)"
"RTN","ORWPCE2",15,0)
 Q
"RTN","ORWPCE2",16,0)
 ;
"RTN","ORWPCE2",17,0)
IMMTYPE(ORWLST) ;get the list of active immunizations
"RTN","ORWPCE2",18,0)
 N IEN,CNT,BINDEX S (IEN,CNT,BINDEX)=0
"RTN","ORWPCE2",19,0)
 F  S BINDEX=$O(^AUTTIMM("B",BINDEX)) Q:BINDEX']""  F  S IEN=$O(^(BINDEX,IEN)) Q:'+IEN  I $D(^AUTTIMM(IEN,0))#2,+$P(^(0),"^",7)=0 S CNT=CNT+1,ORWLST(CNT)=IEN_"^"_$P(^(0),"^")
"RTN","ORWPCE2",20,0)
 Q
"RTN","ORWPCE2",21,0)
 ;
"RTN","ORWPCE2",22,0)
SKTYPE(ORWLST) ;get the list of active skin test
"RTN","ORWPCE2",23,0)
 N IEN,CNT,BINDEX S (IEN,CNT,BINDEX)=0
"RTN","ORWPCE2",24,0)
 F  S BINDEX=$O(^AUTTSK("B",BINDEX)) Q:BINDEX']""  F  S IEN=$O(^(BINDEX,IEN)) Q:'+IEN  I $D(^AUTTSK(IEN,0))#2,+$P(^(0),"^",3)=0 S CNT=CNT+1,ORWLST(CNT)=IEN_"^"_$P(^(0),"^")
"RTN","ORWPCE2",25,0)
 Q
"RTN","ORWPCE2",26,0)
 ;
"RTN","ORWPCE2",27,0)
EDTTYPE(ORWLST) ;get the list of active education topics
"RTN","ORWPCE2",28,0)
 N IEN,CNT,BINDEX S (IEN,CNT,BINDEX)=0
"RTN","ORWPCE2",29,0)
 F  S BINDEX=$O(^AUTTEDT("B",BINDEX)) Q:BINDEX']""  F  S IEN=$O(^(BINDEX,IEN)) Q:'+IEN  I $D(^AUTTEDT(IEN,0))#2,+$P(^(0),"^",3)=0 S CNT=CNT+1,ORWLST(CNT)=IEN_"^"_$P(^(0),"^")
"RTN","ORWPCE2",30,0)
 Q
"RTN","ORWPCE2",31,0)
 ;
"RTN","ORWPCE2",32,0)
HFTYPE(ORWLST,ADDCATS) ;get the list of active  health factors
"RTN","ORWPCE2",33,0)
 N IEN,CNT,BINDEX,REC
"RTN","ORWPCE2",34,0)
 S (IEN,CNT,BINDEX)=0,ADDCATS=+$G(ADDCATS)
"RTN","ORWPCE2",35,0)
 F  S BINDEX=$O(^AUTTHF("B",BINDEX)) Q:BINDEX']""  D
"RTN","ORWPCE2",36,0)
 .F  S IEN=$O(^AUTTHF("B",BINDEX,IEN)) Q:'+IEN  D
"RTN","ORWPCE2",37,0)
 ..S REC=$G(^AUTTHF(IEN,0))
"RTN","ORWPCE2",38,0)
 ..I +$P(REC,U,11) S REC=""
"RTN","ORWPCE2",39,0)
 ..I 'ADDCATS,$P(REC,U,10)="C" S REC=""
"RTN","ORWPCE2",40,0)
 ..I REC'="" D
"RTN","ORWPCE2",41,0)
 ...S CNT=CNT+1,ORWLST(CNT)=IEN_U_$P(REC,U)
"RTN","ORWPCE2",42,0)
 ...I ADDCATS S ORWLST(CNT)=ORWLST(CNT)_U_$P(REC,U,10)_U_$P(REC,U,3)
"RTN","ORWPCE2",43,0)
 Q
"RTN","ORWPCE2",44,0)
 ;
"RTN","ORWPCE2",45,0)
EXAMTYPE(ORWLST) ;get the list of active exams
"RTN","ORWPCE2",46,0)
 N IEN,CNT,BINDEX S (IEN,CNT,BINDEX)=0
"RTN","ORWPCE2",47,0)
 F  S BINDEX=$O(^AUTTEXAM("B",BINDEX)) Q:BINDEX']""  F  S IEN=$O(^(BINDEX,IEN)) Q:'+IEN  I $D(^AUTTEXAM(IEN,0))#2,+$P(^(0),"^",4)=0 S CNT=CNT+1,ORWLST(CNT)=IEN_"^"_$P(^(0),"^")
"RTN","ORWPCE2",48,0)
 Q
"RTN","ORWPCE2",49,0)
 ;
"RTN","ORWPCE2",50,0)
TRTTYPE(ORWLST) ;get the list of active treatments
"RTN","ORWPCE2",51,0)
 N IEN,CNT,BINDEX S (IEN,CNT,BINDEX)=0
"RTN","ORWPCE2",52,0)
 F  S BINDEX=$O(^AUTTTRT("B",BINDEX)) Q:BINDEX']""  F  S IEN=$O(^(BINDEX,IEN)) Q:'+IEN  I $D(^AUTTTRT(IEN,0))#2,+$P(^(0),"^",4)=0 S CNT=CNT+1,ORWLST(CNT)=IEN_"^"_$P(^(0),"^")
"RTN","ORWPCE2",53,0)
 Q
"RTN","ORWPCE2",54,0)
 ;
"RTN","ORWPCE2",55,0)
ACTIVPRV(ORRETURN,ORWPROV,ORWDT) ;get if provider is active or not
"RTN","ORWPCE2",56,0)
 S ORRETURN=$$ACTIVPRV^PXAPI(ORWPROV,ORWDT)
"RTN","ORWPCE2",57,0)
 Q
"RTN","ORWPCE2",58,0)
GETVISIT(VISIT,IEN,DFN,VSITSTR) ;Get the visit IEN
"RTN","ORWPCE2",59,0)
 I +$G(IEN)<1 D  I 1
"RTN","ORWPCE2",60,0)
 .S VISIT=$$GETENC^PXAPI(DFN,$P(VSITSTR,";",2),$P(VSITSTR,";"))
"RTN","ORWPCE2",61,0)
 E  S VISIT=$P(^TIU(8925,IEN,0),U,3)
"RTN","ORWPCE2",62,0)
 Q
"RTN","ORWPCE2",63,0)
GAFOK(ORY) ; Returns true if all supporting MH GAF Code exists
"RTN","ORWPCE2",64,0)
 S ORY=0
"RTN","ORWPCE2",65,0)
 I $T(GAFHX^YSGAFAPI)'="",$T(ENT^YSGAFAP1)'="" S ORY=1
"RTN","ORWPCE2",66,0)
 Q
"RTN","ORWPCE2",67,0)
MHCLINIC(ORY,ORIEN)     ; See if this is a mental health clinic
"RTN","ORWPCE2",68,0)
 I $T(MHCLIN^SDUTL2)="" S ORY=1
"RTN","ORWPCE2",69,0)
 E  S ORY=$$MHCLIN^SDUTL2(ORIEN)
"RTN","ORWPCE2",70,0)
 Q
"RTN","ORWPCE2",71,0)
LOADGAF(ORY,ORINPUT) ; Retrieve GAF scores
"RTN","ORWPCE2",72,0)
 D GAFHX^YSGAFAPI(.ORY,.ORINPUT)
"RTN","ORWPCE2",73,0)
 Q
"RTN","ORWPCE2",74,0)
SAVEGAF(ORY,ORINPUT) ; Save new GAF score
"RTN","ORWPCE2",75,0)
 N ORDATA
"RTN","ORWPCE2",76,0)
 D ENT^YSGAFAP1(.ORDATA,.ORINPUT)
"RTN","ORWPCE2",77,0)
 S ORY=($G(ORDATA(1))="[DATA]")
"RTN","ORWPCE2",78,0)
 Q
"RTN","ORWPCE2",79,0)
FORCE(ORY,USER,LOC) ; Retrieve FORCE GUI PCE Entry for a given User/Location
"RTN","ORWPCE2",80,0)
 N SRV,ORTMP,ORERR
"RTN","ORWPCE2",81,0)
 S USER=$G(USER,DUZ)
"RTN","ORWPCE2",82,0)
 S SRV=$P($G(^VA(200,USER,5)),U)
"RTN","ORWPCE2",83,0)
 D GETLST^XPAR(.ORTMP,"USR^LOC.`"_$G(LOC)_"^SRV.`"_+$G(SRV)_"^DIV^SYS^PKG","ORWPCE FORCE PCE ENTRY","Q",.ORERR)
"RTN","ORWPCE2",84,0)
 S ORY=+$P($G(ORTMP(1)),U,2)
"RTN","ORWPCE2",85,0)
 Q
"RTN","ORWPCE2",86,0)
HASCPT(ORY,ORLIST)        ; Returns true if there are any mapped CPT Codes
"RTN","ORWPCE2",87,0)
 N IEN,IDX,FOUND
"RTN","ORWPCE2",88,0)
 S IDX=0
"RTN","ORWPCE2",89,0)
 F  S IDX=$O(ORLIST(IDX)) Q:'+IDX  D
"RTN","ORWPCE2",90,0)
 . S FOUND=0
"RTN","ORWPCE2",91,0)
 . S IEN=$$FIND1^DIC(811.1,"","QX",ORLIST(IDX))
"RTN","ORWPCE2",92,0)
 . I +IEN S FOUND=+$$GET1^DIQ(811.1,IEN,.05,"I")
"RTN","ORWPCE2",93,0)
 . S ORY(IDX)=ORLIST(IDX)_"="_FOUND
"RTN","ORWPCE2",94,0)
 Q
"RTN","ORWPCE2",95,0)
ASKPCE(ORY,USER,LOC) ; Returns ORWPCE ASK ENCOUNTER UPDATE parameter value
"RTN","ORWPCE2",96,0)
 N SRV,ORTMP,ORERR
"RTN","ORWPCE2",97,0)
 S USER=$G(USER,DUZ)
"RTN","ORWPCE2",98,0)
 S SRV=$P($G(^VA(200,USER,5)),U)
"RTN","ORWPCE2",99,0)
 D GETLST^XPAR(.ORTMP,"USR^LOC.`"_$G(LOC)_"^SRV.`"_+$G(SRV)_"^DIV^SYS^PKG","ORWPCE ASK ENCOUNTER UPDATE","Q",.ORERR)
"RTN","ORWPCE2",100,0)
 S ORY=+$P($G(ORTMP(1)),U,2)
"RTN","ORWPCE2",101,0)
 Q
"RTN","ORWPCE2",102,0)
GAFURL(URL) ;Returns the MH GAF Web Page URL
"RTN","ORWPCE2",103,0)
 S URL=""
"RTN","ORWPCE2",104,0)
 I $T(GAFURL^YTAPI5)'="" D
"RTN","ORWPCE2",105,0)
 .N ORY
"RTN","ORWPCE2",106,0)
 .D GAFURL^YTAPI5(.ORY)
"RTN","ORWPCE2",107,0)
 .I $G(ORY(1))="[DATA]" S URL=$G(ORY(2))
"RTN","ORWPCE2",108,0)
 Q
"RTN","ORWPCE2",109,0)
MHTESTOK(ORY) ; Returns True if all supporting MH Test APIs exist
"RTN","ORWPCE2",110,0)
 D GAFOK(.ORY)
"RTN","ORWPCE2",111,0)
 I +ORY,+$G(DUZ),$T(SAVEIT^YTAPI1)'="",$T(PREVIEW^YTAPI4)'="",$T(SHOWALL^YTAPI3)'="",$T(LISTONE^YTAPI)'="",$T(MHS^PXRMRPCC)'="",$T(MHR^PXRMRPCC)'="",$T(MH^PXRMRPCC)'="" D
"RTN","ORWPCE2",112,0)
 . N SRV
"RTN","ORWPCE2",113,0)
 . S SRV=$P($G(^VA(200,DUZ,5)),U)
"RTN","ORWPCE2",114,0)
 . S ORY=$$GET^XPAR(DUZ_";VA(200,^SRV.`"_+$G(SRV)_"^DIV^SYS","PXRM MENTAL HEALTH ACTIVE",1,"Q")
"RTN","ORWPCE2",115,0)
 . I +ORY S ORY=1
"RTN","ORWPCE2",116,0)
 Q
"RTN","ORWPCE2",117,0)
MHATHRZD(ORY,TEST,USER) ;Indicates that user can score test
"RTN","ORWPCE2",118,0)
 N ORYS,ORANS
"RTN","ORWPCE2",119,0)
 I $T(PRIVL^YTAPI5)="" S ORY=1 Q
"RTN","ORWPCE2",120,0)
 S ORY=0
"RTN","ORWPCE2",121,0)
 S ORYS("CODE")=TEST
"RTN","ORWPCE2",122,0)
 S ORYS("STAFF")=USER
"RTN","ORWPCE2",123,0)
 D PRIVL^YTAPI5(.ORANS,.ORYS)
"RTN","ORWPCE2",124,0)
 I $G(ORANS(1))="[DATA]" S ORY=+$P($G(ORANS(2)),U,1)
"RTN","ORWPCE2",125,0)
 Q
"RTN","ORWPCE2",126,0)
ANYTIME(ORY) ;Returns status of the ORWPCE ANYTIME ENCOUNTERS parameter
"RTN","ORWPCE2",127,0)
 N SRV
"RTN","ORWPCE2",128,0)
 S SRV=$P($G(^VA(200,DUZ,5)),U)
"RTN","ORWPCE2",129,0)
 S ORY=$$GET^XPAR(DUZ_";VA(200,^SRV.`"_+$G(SRV)_"^DIV^SYS","ORWPCE ANYTIME ENCOUNTERS",1,"Q")
"RTN","ORWPCE2",130,0)
 I +ORY S ORY=1
"RTN","ORWPCE2",131,0)
 Q
"RTN","ORWPCE2",132,0)
AUTOVSIT(ORY,LOC) ; Returns TRUE if automatic selection of Visit Type
"RTN","ORWPCE2",133,0)
 N SRV
"RTN","ORWPCE2",134,0)
 S SRV=$P($G(^VA(200,DUZ,5)),U)
"RTN","ORWPCE2",135,0)
 S ORY=$$GET^XPAR(DUZ_";VA(200,^LOC.`"_$G(LOC)_"^SRV.`"_+$G(SRV)_"^DIV^SYS","ORWPCE DISABLE AUTO VISIT TYPE",1,"Q")
"RTN","ORWPCE2",136,0)
 I +ORY S ORY=1
"RTN","ORWPCE2",137,0)
 S ORY='ORY
"RTN","ORWPCE2",138,0)
 Q
"RTN","ORWPCE2",139,0)
DOCHKOUT(ORY,LOC) ; Returns TRUE if automatic selection of Visit Type
"RTN","ORWPCE2",140,0)
 N SRV
"RTN","ORWPCE2",141,0)
 S SRV=$P($G(^VA(200,DUZ,5)),U)
"RTN","ORWPCE2",142,0)
 S ORY=$$GET^XPAR(DUZ_";VA(200,^LOC.`"_$G(LOC)_"^SRV.`"_+$G(SRV)_"^DIV^SYS","ORWPCE DISABLE AUTO CHECKOUT",1,"Q")
"RTN","ORWPCE2",143,0)
 I +ORY S ORY=1
"RTN","ORWPCE2",144,0)
 S ORY='ORY
"RTN","ORWPCE2",145,0)
 Q
"RTN","ORWPCE2",146,0)
CHKOUT(LOC) ; Returns TRUE if automatic selection of Visit Type
"RTN","ORWPCE2",147,0)
 N ORY
"RTN","ORWPCE2",148,0)
 D DOCHKOUT(.ORY,LOC)
"RTN","ORWPCE2",149,0)
 Q ORY
"RTN","ORWPCE2",150,0)
EXCLUDED(ORY,LOC,TYPE) ; Returns list of excluded PCE data elements
"RTN","ORWPCE2",151,0)
 N SRV,PARAM
"RTN","ORWPCE2",152,0)
 S PARAM=$S(TYPE=1:"IMMUNIZATIONS",TYPE=2:"SKIN TESTS",TYPE=3:"PATIENT ED",TYPE=4:"HEALTH FACTORS",TYPE=5:"EXAMS",1:"")
"RTN","ORWPCE2",153,0)
 Q:PARAM=""
"RTN","ORWPCE2",154,0)
 S SRV=$P($G(^VA(200,DUZ,5)),U)
"RTN","ORWPCE2",155,0)
 S PARAM="ORWPCE EXCLUDE "_PARAM
"RTN","ORWPCE2",156,0)
 D GETLST^XPAR(.ORY,"USR^LOC.`"_$G(LOC)_"^SRV.`"_+$G(SRV)_"^DIV^SYS^PKG",PARAM,"Q",.ORERR)
"RTN","ORWPCE2",157,0)
 Q
"RTN","ORWPCE2",158,0)
ISCLINIC(ORY,ORLOC) ; Returns TRUE if location is a clinic
"RTN","ORWPCE2",159,0)
 N ORTYP
"RTN","ORWPCE2",160,0)
 S ORY=0
"RTN","ORWPCE2",161,0)
 S ORTYP=$$GET1^DIQ(44,+ORLOC,2,"I")
"RTN","ORWPCE2",162,0)
 I (ORTYP="C")!(ORTYP="M") S ORY=1
"RTN","ORWPCE2",163,0)
 Q
"RTN","ORWPCE2",164,0)
HNCOK(ORY) ; Returns true if Head and/or Neck Cancer is enabled
"RTN","ORWPCE2",165,0)
 S ORY=0
"RTN","ORWPCE2",166,0)
 I $$PATCH^XPDUTL("DG*5.3*397"),$$PATCH^XPDUTL("SD*5.3*244"),$$PATCH^XPDUTL("PX*1.0*111"),$$PATCH^XPDUTL("IVM*2.0*46") S ORY=1
"RTN","ORWPCE2",167,0)
 Q
"RTN","ORWPCE2",168,0)
 ;
"RTN","ORWPCE2",169,0)
CODACTIV(ORY,ORCODE,ORAPP,ORDATE)       ; Is code active on the given date?
"RTN","ORWPCE2",170,0)
 ; Remote procedure:  ORWPCE ACTIVE CODE
"RTN","ORWPCE2",171,0)
 ; ORCODE = ICD or CPT code to be checked
"RTN","ORWPCE2",172,0)
 ; ORAPP  = "ICD" or "CHP"
"RTN","ORWPCE2",173,0)
 ; ORDATE = Date to be checked (defaults to current date)
"RTN","ORWPCE2",174,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE2",175,0)
 S ORY=1
"RTN","ORWPCE2",176,0)
 I ORAPP="ICD" D
"RTN","ORWPCE2",177,0)
 . S ORY=+$$STATCHK^ICDAPIU(ORCODE,ORDATE)
"RTN","ORWPCE2",178,0)
 E  I ORAPP="CHP" D
"RTN","ORWPCE2",179,0)
 . S ORY=+$$STATCHK^ICPTAPIU(ORCODE,ORDATE)
"RTN","ORWPCE2",180,0)
 Q
"RTN","ORWPCE2",181,0)
ICDACTIV(ORCODE,ORDATE) ; Check for active ICD code
"RTN","ORWPCE2",182,0)
 D CODACTIV(.ORY,ORCODE,"ICD",$G(ORDATE))
"RTN","ORWPCE2",183,0)
 Q +ORY
"RTN","ORWPCE2",184,0)
CPTACTIV(ORCODE,ORDATE) ; Check for active CPT code
"RTN","ORWPCE2",185,0)
 D CODACTIV(.ORY,ORCODE,"CHP",$G(ORDATE))
"RTN","ORWPCE2",186,0)
 Q +ORY
"RTN","ORWPCE2",187,0)
CXNOSHOW(ORY,ORDOCIEN) ; Should workload requirement be skipped for this note's visit?
"RTN","ORWPCE2",188,0)
 ; RETURN VALUE:  0=SKIP ALL GUI WORKLOAD REQUIREMENTS
"RTN","ORWPCE2",189,0)
 ;                1=CONTINUE WITH OTHER GUI WORKLOAD LOGIC
"RTN","ORWPCE2",190,0)
 N ORTIU
"RTN","ORWPCE2",191,0)
 D DOCPARM^TIUSRVP1(.ORTIU,ORDOCIEN)          ; DBIA #4331
"RTN","ORWPCE2",192,0)
 S ORY=+$$CHKWKL^TIUPXAP2(ORDOCIEN,ORTIU(0))  ; DBIA #4332
"RTN","ORWPCE2",193,0)
 Q
"RTN","ORWPS")
0^19^B45940660
"RTN","ORWPS",1,0)
ORWPS ; SLC/KCM/JLI/REV/CLA - Meds Tab; 05/22/03
"RTN","ORWPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,132,141,173,203,190,195**;Dec 17, 1997
"RTN","ORWPS",3,0)
COVER(LST,DFN)  ; retrieve meds for cover sheet
"RTN","ORWPS",4,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",5,0)
 D OCL^PSOORRL(DFN,"","")
"RTN","ORWPS",6,0)
 N ILST,ITMP,X S ILST=0
"RTN","ORWPS",7,0)
 S ITMP="" F  S ITMP=$O(^TMP("PS",$J,ITMP)) Q:'ITMP  D
"RTN","ORWPS",8,0)
 . S X=^TMP("PS",$J,ITMP,0)
"RTN","ORWPS",9,0)
 . I '$L($P(X,U,2)) S X="??"  ; show something if drug empty
"RTN","ORWPS",10,0)
 . I $D(^TMP("PS",$J,ITMP,"CLINIC",0)) S LST($$NXT)=$P(X,U,1,2)_U_$P(X,U,8,9)_U_"C"
"RTN","ORWPS",11,0)
 . E  S LST($$NXT)=$P(X,U,1,2)_U_$P(X,U,8,9)
"RTN","ORWPS",12,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",13,0)
 Q
"RTN","ORWPS",14,0)
DT(X) ; -- Returns FM date for X
"RTN","ORWPS",15,0)
 N Y,%DT S %DT="T",Y="" D:X'="" ^%DT
"RTN","ORWPS",16,0)
 Q Y
"RTN","ORWPS",17,0)
 ;
"RTN","ORWPS",18,0)
ACTIVE(LST,DFN) ; retrieve active inpatient & outpatient meds
"RTN","ORWPS",19,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",20,0)
 K ^TMP("ORACT",$J)
"RTN","ORWPS",21,0)
 N BEG,END,CTX
"RTN","ORWPS",22,0)
 S (BEG,END,CTX)=""
"RTN","ORWPS",23,0)
 S CTX=$$GET^XPAR("ALL","ORCH CONTEXT MEDS")
"RTN","ORWPS",24,0)
 I CTX=";" D DEL^XPAR("USR.`"_DUZ,"ORCH CONTEXT MEDS")
"RTN","ORWPS",25,0)
 S CTX=$$GET^XPAR("ALL","ORCH CONTEXT MEDS")
"RTN","ORWPS",26,0)
 S BEG=$$DT($P(CTX,";")),END=$$DT($P(CTX,";",2))
"RTN","ORWPS",27,0)
 D OCL^PSOORRL(DFN,BEG,END)
"RTN","ORWPS",28,0)
 N ITMP,FIELDS,INSTRUCT,COMMENTS,REASON,NVSDT,TYPE,ILST,J S ILST=0
"RTN","ORWPS",29,0)
 S ITMP="" F  S ITMP=$O(^TMP("PS",$J,ITMP),-1) Q:'ITMP  D
"RTN","ORWPS",30,0)
 . K INSTRUCT,COMMENTS,REASON
"RTN","ORWPS",31,0)
 . K ^TMP("ORACT",$J,"COMMENTS")
"RTN","ORWPS",32,0)
 . S COMMENTS="^TMP(""ORACT"",$J,""COMMENTS"")"
"RTN","ORWPS",33,0)
 . S (INSTRUCT,@COMMENTS)="",FIELDS=^TMP("PS",$J,ITMP,0)
"RTN","ORWPS",34,0)
 . I +$P(FIELDS,"^",8),$D(^OR(100,+$P(FIELDS,"^",8),8,"C","XX")) D
"RTN","ORWPS",35,0)
 . . S $P(^TMP("PS",$J,ITMP,0),"^",2)="*"_$P(^TMP("PS",$J,ITMP,0),"^",2) ;dan testing
"RTN","ORWPS",36,0)
 . S TYPE=$S($P($P(FIELDS,U),";",2)="O":"OP",1:"UD")
"RTN","ORWPS",37,0)
 . I $D(^TMP("PS",$J,ITMP,"CLINIC",0)) S TYPE="CP"
"RTN","ORWPS",38,0)
 . N LOC,LOCEX S (LOC,LOCEX)=""
"RTN","ORWPS",39,0)
 . I TYPE="CP" S LOC=$G(^TMP("PS",$J,ITMP,"CLINIC",0))
"RTN","ORWPS",40,0)
 . S:LOC LOCEX=$P($G(^SC(+LOC,0)),U)_":"_+LOC ;IMO NEW
"RTN","ORWPS",41,0)
 . I TYPE="OP",$P(FIELDS,";")["N" S TYPE="NV"          ;non-VA med
"RTN","ORWPS",42,0)
 . I $O(^TMP("PS",$J,ITMP,"A",0))>0 S TYPE="IV"
"RTN","ORWPS",43,0)
 . I $O(^TMP("PS",$J,ITMP,"B",0))>0 S TYPE="IV"
"RTN","ORWPS",44,0)
 . I (TYPE="UD")!(TYPE="CP") D UDINST(.INSTRUCT,ITMP)
"RTN","ORWPS",45,0)
 . I TYPE="OP" D OPINST(.INSTRUCT,ITMP)
"RTN","ORWPS",46,0)
 . I TYPE="IV" D IVINST(.INSTRUCT,ITMP)
"RTN","ORWPS",47,0)
 . I TYPE="NV" D NVINST(.INSTRUCT,ITMP),NVREASON(.REASON,.NVSDT,ITMP)
"RTN","ORWPS",48,0)
 . I (TYPE="UD")!(TYPE="IV")!(TYPE="NV")!(TYPE="CP") D SETMULT(COMMENTS,ITMP,"SIO")
"RTN","ORWPS",49,0)
 . M COMMENTS=@COMMENTS
"RTN","ORWPS",50,0)
 . I $D(COMMENTS(1)) S COMMENTS(1)="\"_COMMENTS(1)
"RTN","ORWPS",51,0)
 . S:TYPE="NV" $P(FIELDS,U,4)=$G(NVSDT)
"RTN","ORWPS",52,0)
 . I LOC S LST($$NXT)="~CP:"_LOCEX_U_FIELDS
"RTN","ORWPS",53,0)
 . E  S LST($$NXT)="~"_TYPE_U_FIELDS
"RTN","ORWPS",54,0)
 . S J=0 F  S J=$O(INSTRUCT(J)) Q:'J  S LST($$NXT)=INSTRUCT(J)
"RTN","ORWPS",55,0)
 . S J=0 F  S J=$O(COMMENTS(J)) Q:'J  S LST($$NXT)="t"_COMMENTS(J)
"RTN","ORWPS",56,0)
 . S J=0 F  S J=$O(REASON(J)) Q:'J  S LST($$NXT)="t"_REASON(J)
"RTN","ORWPS",57,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",58,0)
 K ^TMP("ORACT",$J)
"RTN","ORWPS",59,0)
 Q
"RTN","ORWPS",60,0)
NXT() ; increment ILST
"RTN","ORWPS",61,0)
 S ILST=ILST+1
"RTN","ORWPS",62,0)
 Q ILST
"RTN","ORWPS",63,0)
 ;
"RTN","ORWPS",64,0)
UDINST(Y,INDEX) ; assembles instructions for a unit dose order
"RTN","ORWPS",65,0)
 N I,X,RST
"RTN","ORWPS",66,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",67,0)
 S RST="^TMP(""ORACT"",$J,""INSTRUCT"")"
"RTN","ORWPS",68,0)
 S @RST@(1)=" "_$P(X,U,2),@RST=1
"RTN","ORWPS",69,0)
 S X=$S($L($P(X,U,6)):$P(X,U,6),1:$P(X,U,7))
"RTN","ORWPS",70,0)
 I $L(X) S @RST=2,@RST@(2)=X
"RTN","ORWPS",71,0)
 E  S @RST=1 D SETMULT(.RST,INDEX,"SIG")
"RTN","ORWPS",72,0)
 S @RST@(2)="\Give: "_$G(@RST@(2)),@RST=$G(@RST,2)
"RTN","ORWPS",73,0)
 D SETMULT(RST,INDEX,"MDR"),SETMULT(RST,INDEX,"SCH")
"RTN","ORWPS",74,0)
 F I=3:1:@RST S @RST@(I)=" "_@RST@(I)
"RTN","ORWPS",75,0)
 M Y=@RST K @RST
"RTN","ORWPS",76,0)
 Q
"RTN","ORWPS",77,0)
OPINST(Y,INDEX) ; assembles instructions for an outpatient prescription
"RTN","ORWPS",78,0)
 N I,X,RST
"RTN","ORWPS",79,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",80,0)
 S RST="^TMP(""ORACT"",$J,""INSTRUCT"")"
"RTN","ORWPS",81,0)
 S @RST@(1)=" "_$P(X,U,2),@RST=1
"RTN","ORWPS",82,0)
 I $L($P(X,U,12)) S @RST@(1)=@RST@(1)_"  Qty: "_$P(X,U,12)
"RTN","ORWPS",83,0)
 I $L($P(X,U,11)) S @RST@(1)=@RST@(1)_" for "_$P(X,U,11)_" days"
"RTN","ORWPS",84,0)
 D SETMULT(RST,INDEX,"SIG")
"RTN","ORWPS",85,0)
 I @RST=1 D
"RTN","ORWPS",86,0)
 . D SETMULT(RST,INDEX,"SIO")
"RTN","ORWPS",87,0)
 . D SETMULT(RST,INDEX,"MDR")
"RTN","ORWPS",88,0)
 . D SETMULT(RST,INDEX,"SCH")
"RTN","ORWPS",89,0)
 S @RST@(2)="\ Sig: "_$G(@RST@(2))
"RTN","ORWPS",90,0)
 F I=3:1:@RST S @RST@(I)=" "_@RST@(I)
"RTN","ORWPS",91,0)
 M Y=@RST K @RST
"RTN","ORWPS",92,0)
 Q
"RTN","ORWPS",93,0)
IVINST(Y,INDEX) ; assembles instructions for an IV order
"RTN","ORWPS",94,0)
 N SOLN1,I,RST,IVDUR
"RTN","ORWPS",95,0)
 S IVDUR=""
"RTN","ORWPS",96,0)
 S RST="^TMP(""ORACT"",$J,""INSTRUCT"")"
"RTN","ORWPS",97,0)
 S @RST=0 D SETMULT(RST,INDEX,"A") S SOLN1=@RST+1
"RTN","ORWPS",98,0)
 D SETMULT(RST,INDEX,"B")
"RTN","ORWPS",99,0)
 I $D(@RST@(SOLN1)),$L($P(FIELDS,U,2)) S @RST@(SOLN1)="in "_@RST@(SOLN1)
"RTN","ORWPS",100,0)
 S SOLN1=@RST+1
"RTN","ORWPS",101,0)
 D SETMULT(RST,INDEX,"SCH") S:$D(@RST@(SOLN1)) @RST@(SOLN1)=" "_@RST@(SOLN1)
"RTN","ORWPS",102,0)
 F I=1:1:@RST S @RST@(I)="\"_$TR(@RST@(I),U," ")
"RTN","ORWPS",103,0)
 I $D(@RST@(1)) S @RST@(1)=" "_$E(@RST@(1),2,999)
"RTN","ORWPS",104,0)
 S @RST@(@RST)=@RST@(@RST)_" "_$P(^TMP("PS",$J,INDEX,0),U,3)
"RTN","ORWPS",105,0)
 S:$D(^TMP("PS",$J,INDEX,"IVLIM",0)) IVDUR=$G(^TMP("PS",$J,INDEX,"IVLIM",0))
"RTN","ORWPS",106,0)
 I $L(IVDUR) D
"RTN","ORWPS",107,0)
 . N DURU,DURV S DURU="",DURV=0
"RTN","ORWPS",108,0)
 . S DURU=$E(IVDUR,1),DURV=$E(IVDUR,2,$L(IVDUR))
"RTN","ORWPS",109,0)
 . I (DURU="D")!(DURU="d") S IVDUR="for "_+DURV_$S(+DURV=1:" day",+DURV>1:" days",1:" day")
"RTN","ORWPS",110,0)
 . I (DURU="H")!(DURU="h") S IVDUR="for "_+DURV_$S(+DURV=1:" hours",+DURV>1:" hours",1:" hour")
"RTN","ORWPS",111,0)
 . I (DURU="M")!(DURU="m") S IVDUR="with total volume "_+DURV_" ml"
"RTN","ORWPS",112,0)
 . I (DURU="L")!(DURU="l") S IVDUR="with total volume "_+DURV_" L"
"RTN","ORWPS",113,0)
 . S @RST@(@RST)=@RST@(@RST)_" "_IVDUR
"RTN","ORWPS",114,0)
 M Y=@RST K @RST
"RTN","ORWPS",115,0)
 Q
"RTN","ORWPS",116,0)
NVINST(Y,INDEX) ; assembles instructions for a non-VA med
"RTN","ORWPS",117,0)
 N I,X,RST
"RTN","ORWPS",118,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",119,0)
 S RST="^TMP(""ORACT"",$J,""INSTRUCT"")"
"RTN","ORWPS",120,0)
 S @RST@(1)=" "_$P(X,U,2),@RST=1
"RTN","ORWPS",121,0)
 D SETMULT(RST,INDEX,"SIG")
"RTN","ORWPS",122,0)
 I @RST=1 D
"RTN","ORWPS",123,0)
 . D SETMULT(RST,INDEX,"SIO")
"RTN","ORWPS",124,0)
 . D SETMULT(RST,INDEX,"MDR")
"RTN","ORWPS",125,0)
 . D SETMULT(RST,INDEX,"SCH")
"RTN","ORWPS",126,0)
 S @RST@(2)="\ "_$G(@RST@(2))
"RTN","ORWPS",127,0)
 F I=3:1:@RST S @RST@(I)=" "_@RST@(I)
"RTN","ORWPS",128,0)
 M Y=@RST K @RST
"RTN","ORWPS",129,0)
 Q
"RTN","ORWPS",130,0)
NVREASON(ORR,NVSDT,INDEX) ; assembles start date and reasons for a non-VA med
"RTN","ORWPS",131,0)
 N ORI,J,X,ORN,ORA
"RTN","ORWPS",132,0)
 S ORI=0 K ORR
"RTN","ORWPS",133,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",134,0)
 S ORN=+$P(X,U,8)
"RTN","ORWPS",135,0)
 I $D(^OR(100,ORN,0)) D
"RTN","ORWPS",136,0)
 .S NVSDT=$P(^OR(100,ORN,0),U,8)
"RTN","ORWPS",137,0)
 .D WPVAL^ORWDXR(.ORA,ORN,"STATEMENTS") I $D(ORA) D
"RTN","ORWPS",138,0)
 ..S J=0 F  S J=$O(ORA(J)) Q:J<1  S ORI=ORI+1,ORR(ORI)=ORA(J)
"RTN","ORWPS",139,0)
 Q
"RTN","ORWPS",140,0)
SETMULT(Y,INDEX,SUB) ; appends the multiple at the subscript to Y
"RTN","ORWPS",141,0)
 N I,X,J
"RTN","ORWPS",142,0)
 S J=$G(@Y)
"RTN","ORWPS",143,0)
 S I=0 F  S I=$O(^TMP("PS",$J,INDEX,SUB,I)) Q:'I  S X=$G(^(I,0)) D
"RTN","ORWPS",144,0)
 . I SUB="B",$L($P(X,U,3)) S X=$P(X,U)_" "_$P(X,U,3)_"^"_$P(X,U,2)
"RTN","ORWPS",145,0)
 . S J=J+1,@Y@(J)=X
"RTN","ORWPS",146,0)
 S @Y=J
"RTN","ORWPS",147,0)
 Q
"RTN","ORWPS",148,0)
COMPRESS(Y) ; concatenate Y subscripts into smallest possible number
"RTN","ORWPS",149,0)
 N I,J,X S J=1,X(J)=""
"RTN","ORWPS",150,0)
 S I=0 F  S I=$O(Y(I)) Q:'I  D
"RTN","ORWPS",151,0)
 . I ($L(Y(I))+$L(X(J)))>245 S J=J+1,X(J)=""
"RTN","ORWPS",152,0)
 . S X(J)=X(J)_$S($L(X(J)):" ",1:"")_Y(I)
"RTN","ORWPS",153,0)
 K Y M Y=X
"RTN","ORWPS",154,0)
 Q
"RTN","ORWPS",155,0)
DETAIL(ROOT,DFN,ID) ; -- show details for a med order
"RTN","ORWPS",156,0)
 K ^TMP("ORXPND",$J)
"RTN","ORWPS",157,0)
 N LCNT,ORVP
"RTN","ORWPS",158,0)
 S LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWPS",159,0)
 D MEDS^ORCXPND1
"RTN","ORWPS",160,0)
 S ROOT=$NA(^TMP("ORXPND",$J))
"RTN","ORWPS",161,0)
 Q
"RTN","ORWPS",162,0)
MEDHIST(ORROOT,DFN,ORIFN)       ; -- show admin history for a med  (RV)
"RTN","ORWPS",163,0)
 N ORPSID,ISIV,CKPKG,ORPHMID
"RTN","ORWPS",164,0)
 S ORPSID=+$P($$OI^ORX8(ORIFN),U,3),ISIV=0
"RTN","ORWPS",165,0)
 S ORROOT=$NA(^TMP("ORHIST",$J)) K @ORROOT
"RTN","ORWPS",166,0)
 S ISIV=$O(^ORD(100.98,"B","IV RX",ISIV))
"RTN","ORWPS",167,0)
 S CKPKG=$$PATCH^XPDUTL("PSB*2.0*19")
"RTN","ORWPS",168,0)
 I $P($G(^OR(100,+ORIFN,0)),U,11)=ISIV D  Q
"RTN","ORWPS",169,0)
 . I 'CKPKG S @ORROOT@(0)="Medication Administration History is not available at this time for IV fluids."
"RTN","ORWPS",170,0)
 . I CKPKG D
"RTN","ORWPS",171,0)
 . . S ORPHMID=$G(^OR(100,+ORIFN,4))  ;Pharmacy order number
"RTN","ORWPS",172,0)
 . . D RPC^PSBO(.ORROOT,"PM",DFN,"","","","","","","","","",ORPHMID)  ;DBIA #3955
"RTN","ORWPS",173,0)
 . . I '$D(@ORROOT) S @ORROOT@(0)="No Medication Administration History found for the IV order."
"RTN","ORWPS",174,0)
 I '$L($T(HISTORY^PSBMLHS)) D  Q
"RTN","ORWPS",175,0)
 . S @ORROOT@(0)="This report is only available using BCMA version 2.0."
"RTN","ORWPS",176,0)
 D HISTORY^PSBMLHS(.ORROOT,DFN,ORPSID)  ; DBIA #3459 for BCMA v2.0
"RTN","ORWPS",177,0)
 Q
"RTN","ORWPS",178,0)
 ;
"RTN","ORWPS",179,0)
REASON(ORY) ; -- Return Non-VA Med Statement/Reasons
"RTN","ORWPS",180,0)
 N ORE
"RTN","ORWPS",181,0)
 D GETLST^XPAR(.ORY,"ALL","ORWD NONVA REASON","E")
"RTN","ORWPS",182,0)
 Q
"RTN","ORWTIU")
0^72^B9619968
"RTN","ORWTIU",1,0)
ORWTIU ; slc/REV - Functions for GUI PARAMETER ACTIONS ; 08 Feb 2001  09:02AM
"RTN","ORWTIU",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,132,195**;Dec 17, 1997
"RTN","ORWTIU",3,0)
 ;
"RTN","ORWTIU",4,0)
GTTIUCTX(Y,ORUSER) ; Returns current Notes view context for user
"RTN","ORWTIU",5,0)
 N OCCLIM,SHOWSUB
"RTN","ORWTIU",6,0)
 S Y=$$GET^XPAR("ALL","ORCH CONTEXT NOTES",1)
"RTN","ORWTIU",7,0)
 I +$P(Y,";",5)=0 D
"RTN","ORWTIU",8,0)
 . S OCCLIM=$P($$PERSPRF^TIULE(DUZ),U,10)
"RTN","ORWTIU",9,0)
 . S:+OCCLIM>0 $P(Y,";",5)=OCCLIM
"RTN","ORWTIU",10,0)
 S SHOWSUB=$P(Y,";",6)
"RTN","ORWTIU",11,0)
 S $P(Y,";",6)=$S(SHOWSUB'="":SHOWSUB,1:0)
"RTN","ORWTIU",12,0)
 Q
"RTN","ORWTIU",13,0)
SVTIUCTX(Y,ORCTXT) ; Save new Notes view preferences for user
"RTN","ORWTIU",14,0)
 N TMP
"RTN","ORWTIU",15,0)
 S TMP=$$GET^XPAR(DUZ_";VA(200,","ORCH CONTEXT NOTES",1)
"RTN","ORWTIU",16,0)
 I TMP'="" D  Q
"RTN","ORWTIU",17,0)
 . D CHG^XPAR(DUZ_";VA(200,","ORCH CONTEXT NOTES",1,ORCTXT)
"RTN","ORWTIU",18,0)
 D ADD^XPAR(DUZ_";VA(200,","ORCH CONTEXT NOTES",1,ORCTXT)
"RTN","ORWTIU",19,0)
 Q
"RTN","ORWTIU",20,0)
 ;
"RTN","ORWTIU",21,0)
GTDCCTX(Y,ORUSER) ; Returns current DC Summary view context for user
"RTN","ORWTIU",22,0)
 N OCCLIM,SHOWSUB
"RTN","ORWTIU",23,0)
 S Y=$$GET^XPAR("ALL","ORCH CONTEXT SUMMRIES",1)
"RTN","ORWTIU",24,0)
 I +$P(Y,";",5)=0 D
"RTN","ORWTIU",25,0)
 . S OCCLIM=$P($$PERSPRF^TIULE(DUZ),U,10)
"RTN","ORWTIU",26,0)
 . S:+OCCLIM>0 $P(Y,";",5)=OCCLIM
"RTN","ORWTIU",27,0)
 S SHOWSUB=$P(Y,";",6)
"RTN","ORWTIU",28,0)
 S $P(Y,";",6)=$S(SHOWSUB'="":SHOWSUB,1:0)
"RTN","ORWTIU",29,0)
 Q
"RTN","ORWTIU",30,0)
SVDCCTX(Y,ORCTXT) ; Save new DC Summary view preferences for user
"RTN","ORWTIU",31,0)
 N TMP
"RTN","ORWTIU",32,0)
 S TMP=$$GET^XPAR(DUZ_";VA(200,","ORCH CONTEXT SUMMRIES",1)
"RTN","ORWTIU",33,0)
 I TMP'="" D  Q
"RTN","ORWTIU",34,0)
 . D CHG^XPAR(DUZ_";VA(200,","ORCH CONTEXT SUMMRIES",1,ORCTXT)
"RTN","ORWTIU",35,0)
 D ADD^XPAR(DUZ_";VA(200,","ORCH CONTEXT SUMMRIES",1,ORCTXT)
"RTN","ORWTIU",36,0)
 Q
"RTN","ORWTIU",37,0)
 ;
"RTN","ORWTIU",38,0)
PRINTW(ORY,ORDA,ORFLG) ;TIU print to windows printer
"RTN","ORWTIU",39,0)
 N ZTQUEUED,ORHFS,ORSUB,ORIO,ORSTATUS,ROOT,ORERR,ORWIN,ORHANDLE
"RTN","ORWTIU",40,0)
 N IOM,IOSL,IOST,IOF,IOT,IOS
"RTN","ORWTIU",41,0)
 S (ORSUB,ROOT)="ORDATA",ORIO="OR WINDOWS HFS",ORWIN=1,ORHANDLE="ORWTIU"
"RTN","ORWTIU",42,0)
 S ORY=$NA(^TMP(ORSUB,$J,1))
"RTN","ORWTIU",43,0)
 S ORHFS=$$HFS^ORWRP()
"RTN","ORWTIU",44,0)
 D HFSOPEN^ORWRP(ORHANDLE,ORHFS,"W")
"RTN","ORWTIU",45,0)
 I POP D  Q
"RTN","ORWTIU",46,0)
 . I $D(ROOT) D SETITEM^ORWRP(.ROOT,"ERROR: Unable to open HFS file for TIU print")
"RTN","ORWTIU",47,0)
 D IOVAR^ORWRP(.ORIO,,,"P-WINHFS80")
"RTN","ORWTIU",48,0)
 N $ETRAP,$ESTACK
"RTN","ORWTIU",49,0)
 S $ETRAP="D ERR^ORWRP Q"
"RTN","ORWTIU",50,0)
 U IO
"RTN","ORWTIU",51,0)
 D RPC^TIUPD(.ORERR,ORDA,ORIO,ORFLG,ORWIN)
"RTN","ORWTIU",52,0)
 D HFSCLOSE^ORWRP(ORHANDLE,ORHFS)
"RTN","ORWTIU",53,0)
 Q
"RTN","ORWTIU",54,0)
GTLSTITM(ORY,ORTIUDA) ; Return single listbox item for document
"RTN","ORWTIU",55,0)
 Q:+$G(ORTIUDA)=0
"RTN","ORWTIU",56,0)
 S ORY=ORTIUDA_U_$$RESOLVE^TIUSRVLO(ORTIUDA)
"RTN","ORWTIU",57,0)
 Q
"RTN","ORWTIU",58,0)
IDNOTES(ORY)    ; Is ID Notes installed?
"RTN","ORWTIU",59,0)
 S ORY=$$PATCH^XPDUTL("TIU*1.0*100")
"RTN","ORWTIU",60,0)
 Q
"RTN","ORWTIU",61,0)
CANLINK(ORY,ORTITLE)    ;Can the title be an ID child?
"RTN","ORWTIU",62,0)
 ; DBIA #2322
"RTN","ORWTIU",63,0)
 S ORY=$$CANLINK^TIULP(ORTITLE)
"RTN","ORWTIU",64,0)
 Q
"RTN","ORWTIU",65,0)
GETCP(ORY,ORTIUDA) ; Checks required CP fields before signature
"RTN","ORWTIU",66,0)
 S ORY=""
"RTN","ORWTIU",67,0)
 N ORTITLE,ORAUTH,ORCOS,ORPSUMCD,ORPROCDT,ORROOT,ORERR
"RTN","ORWTIU",68,0)
 S ORERR="",ORROOT=$NA(^TMP("ORTIU",$J))
"RTN","ORWTIU",69,0)
 D EXTRACT^TIULQ(ORTIUDA,.ORROOT,.ORERR,".01;1202;1208;70201;70202",,,"I")
"RTN","ORWTIU",70,0)
 S ORTITLE=@ORROOT@(ORTIUDA,".01","I")
"RTN","ORWTIU",71,0)
 S ORAUTH=@ORROOT@(ORTIUDA,"1202","I")
"RTN","ORWTIU",72,0)
 S ORCOS=@ORROOT@(ORTIUDA,"1208","I")
"RTN","ORWTIU",73,0)
 S ORPSUMCD=@ORROOT@(ORTIUDA,"70201","I")
"RTN","ORWTIU",74,0)
 S ORPROCDT=@ORROOT@(ORTIUDA,"70202","I")
"RTN","ORWTIU",75,0)
 S ORY=ORAUTH_U_ORCOS_U_ORPSUMCD_U_ORPROCDT_U_ORTITLE
"RTN","ORWTIU",76,0)
 K @ORROOT
"RTN","ORWTIU",77,0)
 Q
"RTN","ORWTIU",78,0)
CHKTXT(ORY,ORTIUDA) ; Checks for presence of text before signature
"RTN","ORWTIU",79,0)
 S ORY='$$EMPTYDOC^TIULF(ORTIUDA)  ;DBIA #4426
"RTN","ORWTIU",80,0)
 Q
"RTN","ORWTPD")
0^73^B13844085
"RTN","ORWTPD",1,0)
ORWTPD ; slc/jdl - Personal Reference Tool ;6/20/02 11:40am [7/22/03 11:27am]
"RTN","ORWTPD",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109,120,132,148,141,173,195**;Dec 17,1997
"RTN","ORWTPD",3,0)
 ;; Allow user to customize the CPRS reports date/time
"RTN","ORWTPD",4,0)
 ;; and max occurences setting
"RTN","ORWTPD",5,0)
 ;
"RTN","ORWTPD",6,0)
SUDF(Y,VALUE) ;----Set user default for all CPRS reports
"RTN","ORWTPD",7,0)
 N ORERR S ORERR=""
"RTN","ORWTPD",8,0)
 I VALUE=$$GET^XPAR("DIV^SYS^PKG","ORWRP TIME/OCC LIMITS ALL",1,"I") D DEL^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS ALL",1,.ORERR) K ORERR Q
"RTN","ORWTPD",9,0)
 E  D EN^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS ALL",1,VALUE,.ORERR)
"RTN","ORWTPD",10,0)
 S Y=1
"RTN","ORWTPD",11,0)
 K ORERR,VALUES1
"RTN","ORWTPD",12,0)
 Q
"RTN","ORWTPD",13,0)
 ;
"RTN","ORWTPD",14,0)
SUINDV(Y,RPTS,VALUE) ;----Set user individual time/occ setting
"RTN","ORWTPD",15,0)
 ; RPTS format: RPTIen^RPTIen^RPTIen such as 1^2^3
"RTN","ORWTPD",16,0)
 I $L(RPTS)=0 Q
"RTN","ORWTPD",17,0)
 N ORERR,RPTID,P1,P7 S ORERR=0
"RTN","ORWTPD",18,0)
 S (P1,P7)=""
"RTN","ORWTPD",19,0)
 F I=1:1:$L(RPTS,"^") S RPTID=$P(RPTS,U,I) D
"RTN","ORWTPD",20,0)
 . S P1=$P($G(^ORD(101.24,RPTID,0)),U),P7=$P($G(^(0)),U,7)
"RTN","ORWTPD",21,0)
 . I "02345"[P7,(P1'="ORRP IMAGING") D DEL^XPAR("USR.`"_DUZ,"ORWRP TIME/OCC LIMITS INDV",RPTID,.ORERR) Q
"RTN","ORWTPD",22,0)
 . D EN^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS INDV",RPTID,VALUE,.ORERR)
"RTN","ORWTPD",23,0)
 Q
"RTN","ORWTPD",24,0)
 ;
"RTN","ORWTPD",25,0)
GETIMG(Y,RPT) ; ----Get Image (local only) Time/Occ
"RTN","ORWTPD",26,0)
 N IMGID,BEG,END,MAX
"RTN","ORWTPD",27,0)
 S IMGID=0,Y=""
"RTN","ORWTPD",28,0)
 S IMGID=$O(^ORD(101.24,"B","ORRP IMAGING",0))
"RTN","ORWTPD",29,0)
 D GETINDV(.Y,IMGID)
"RTN","ORWTPD",30,0)
 I $L(Y) D
"RTN","ORWTPD",31,0)
 . S BEG=$$DT^ORCHTAB1($P(Y,";"))
"RTN","ORWTPD",32,0)
 . S END=$$DT^ORCHTAB1($P(Y,";",2))
"RTN","ORWTPD",33,0)
 . S MAX=$P(Y,";",3)
"RTN","ORWTPD",34,0)
 . S Y=BEG_"^"_END_"^"_MAX
"RTN","ORWTPD",35,0)
 I Y="" D GETDEF^ORWRA(.Y)
"RTN","ORWTPD",36,0)
 Q
"RTN","ORWTPD",37,0)
 ;
"RTN","ORWTPD",38,0)
GETINDV(Y,RPT) ;----Get time/occ limits for this report
"RTN","ORWTPD",39,0)
 ;RPT:  Report IEN of 101.24
"RTN","ORWTPD",40,0)
 N CTX,X0,X4,X,IMGCTX
"RTN","ORWTPD",41,0)
 S X0=$G(^ORD(101.24,RPT,0)),X4=$G(^(4))
"RTN","ORWTPD",42,0)
 I "02345"[($P(X0,U,7)),($P(X0,U)'="ORRP IMAGING") Q
"RTN","ORWTPD",43,0)
 S CTX="^DIV^SYS^PKG"
"RTN","ORWTPD",44,0)
 S Y=$$GET^XPAR("USR.`"_DUZ_CTX,"ORWRP TIME/OCC LIMITS INDV",RPT,"I")
"RTN","ORWTPD",45,0)
 S:'$L(Y) Y=$$GET^XPAR("USR.`"_DUZ_CTX,"ORWRP TIME/OCC LIMITS ALL",1,"I")
"RTN","ORWTPD",46,0)
 I $P(^ORD(101.24,RPT,0),U,7)=1 S $P(Y,";",3)=""
"RTN","ORWTPD",47,0)
 I $P(X4,"^",2) S X=$P($P(Y,";"),"-",2) I X,X>$P(X4,"^",2) S Y="T-"_$P(X4,"^",2)_";"_$P(Y,";",2,99)
"RTN","ORWTPD",48,0)
 Q
"RTN","ORWTPD",49,0)
 ;
"RTN","ORWTPD",50,0)
GETSETS(Y) ;----Get time/occ limit set for each report
"RTN","ORWTPD",51,0)
 N I,CNT,CAT S I=0,CNT=1,RST=""
"RTN","ORWTPD",52,0)
 F  S I=$O(^ORD(101.24,I)) Q:'I   D
"RTN","ORWTPD",53,0)
 .I $P($G(^ORD(101.24,I,0)),U,8)="R",$P($G(^ORD(101.24,I,0)),U,12)'="M" D
"RTN","ORWTPD",54,0)
 ..S CAT=$P(^ORD(101.24,I,0),U,7) I $S(CAT=1:1,CAT=6:1,1:0)!($P(^(0),U)="ORRP IMAGING") D
"RTN","ORWTPD",55,0)
 ...D GETINDV(.RST,I)
"RTN","ORWTPD",56,0)
 ...I $L($P(^ORD(101.24,I,2),U,4))>0 S Y(CNT)=I_U_$P(^ORD(101.24,I,2),U,4)_U_RST
"RTN","ORWTPD",57,0)
 ...E  S Y(CNT)=I_U_$P(^ORD(101.24,I,2),U,3)_U_RST
"RTN","ORWTPD",58,0)
 ... S CNT=CNT+1
"RTN","ORWTPD",59,0)
 K I,CNT,RST,CAT
"RTN","ORWTPD",60,0)
 Q
"RTN","ORWTPD",61,0)
 ;
"RTN","ORWTPD",62,0)
GETDFLT(Y) ;----Get default time/occ limits for all reports
"RTN","ORWTPD",63,0)
 N VALUE
"RTN","ORWTPD",64,0)
 S Y=$$GET^XPAR("USR.`"_DUZ_"^DIV^SYS^PKG","ORWRP TIME/OCC LIMITS ALL",1,"I")
"RTN","ORWTPD",65,0)
 K VALUE
"RTN","ORWTPD",66,0)
 Q
"RTN","ORWTPD",67,0)
 ;
"RTN","ORWTPD",68,0)
RSDFLT(Y) ;----Retrieve sys/pkg level default time/occ setting
"RTN","ORWTPD",69,0)
 N VALUE
"RTN","ORWTPD",70,0)
 S Y=$$GET^XPAR("DIV^SYS^PKG","ORWRP TIME/OCC LIMITS ALL",1,"I")
"RTN","ORWTPD",71,0)
 Q
"RTN","ORWTPD",72,0)
 ;
"RTN","ORWTPD",73,0)
DELDFLT(Y) ;----Delete user's default setting 
"RTN","ORWTPD",74,0)
 N ORERR S ORERR=""
"RTN","ORWTPD",75,0)
 D NDEL^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS INDV",.ORERR)
"RTN","ORWTPD",76,0)
 D DEL^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS ALL",1,.ORERR)
"RTN","ORWTPD",77,0)
 K ORERR
"RTN","ORWTPD",78,0)
 Q
"RTN","ORWTPD",79,0)
 ;
"RTN","ORWTPD",80,0)
ACTDF(Y) ;----Make default setting take action for each report
"RTN","ORWTPD",81,0)
 N IND,DFLT,VALUE,X,X0,X4,MAX,DFLT1
"RTN","ORWTPD",82,0)
 S DFLT=$$GET^XPAR("USR.`"_DUZ_"^DIV^SYS^PKG","ORWRP TIME/OCC LIMITS ALL",1,"I")
"RTN","ORWTPD",83,0)
 S IND=0,X=$P($P(DFLT,";"),"-",2)
"RTN","ORWTPD",84,0)
 F  S IND=$O(^ORD(101.24,IND)) Q:'IND  S X0=$G(^(IND,0)),X4=$G(^(4)) D
"RTN","ORWTPD",85,0)
 . I $P(X0,"^",8)="R",$P(X0,"^",12)'="M" D
"RTN","ORWTPD",86,0)
 .. S MAX=$P(X4,"^",2),DFLT1=DFLT
"RTN","ORWTPD",87,0)
 .. I MAX,X,X>MAX S DFLT1="T-"_MAX_";"_$P(DFLT,";",2,99)
"RTN","ORWTPD",88,0)
 .. D SUINDV(.Y,IND,DFLT1)
"RTN","ORWTPD",89,0)
 Q
"RTN","ORWTPD",90,0)
GETOCM(ORY) ;Get value of "ORCH CONTEXT MEDS"
"RTN","ORWTPD",91,0)
 S ORY=$$GET^XPAR("ALL","ORCH CONTEXT MEDS")
"RTN","ORWTPD",92,0)
 Q
"RTN","ORWTPD",93,0)
 ;
"RTN","ORWTPD",94,0)
PUTOCM(ORY,ORVAL) ;Set value of "ORCH CONTEXT MEDS"
"RTN","ORWTPD",95,0)
 I '$L(ORVAL) D DEL^XPAR("USR.`"_DUZ,"ORCH CONTEXT MEDS",1) Q
"RTN","ORWTPD",96,0)
 N ORERR S ORERR=""
"RTN","ORWTPD",97,0)
 D EN^XPAR(DUZ_";VA(200,","ORCH CONTEXT MEDS",1,ORVAL,.ORERR)
"RTN","ORWTPD",98,0)
 S ORY=ORERR
"RTN","ORWTPD",99,0)
 Q
"RTN","ORWTPD",100,0)
 ;
"RTN","ORWTPD1")
0^74^B17655360
"RTN","ORWTPD1",1,0)
ORWTPD1 ; SLC/PKS - Personal Preferences. [7/22/04 10:53am]
"RTN","ORWTPD1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17,1997
"RTN","ORWTPD1",3,0)
 ;
"RTN","ORWTPD1",4,0)
 Q
"RTN","ORWTPD1",5,0)
 ;
"RTN","ORWTPD1",6,0)
GETEFDAT(INFO) ; Get non-user level Encounter appointment date range params.
"RTN","ORWTPD1",7,0)
 ;
"RTN","ORWTPD1",8,0)
 N ORSTART,ORSTOP
"RTN","ORWTPD1",9,0)
 S INFO=""
"RTN","ORWTPD1",10,0)
 ;
"RTN","ORWTPD1",11,0)
 S ORSTART=$$GET^XPAR("DIV^SYS^PKG","ORQQEAPT ENC APPT START",1,"I")
"RTN","ORWTPD1",12,0)
 I 'ORSTART S ORSTART=60
"RTN","ORWTPD1",13,0)
 ;
"RTN","ORWTPD1",14,0)
 S ORSTOP=$$GET^XPAR("DIV^SYS^PKG","ORQQEAPT ENC APPT STOP",1,"I")
"RTN","ORWTPD1",15,0)
 I 'ORSTOP S ORSTOP=0
"RTN","ORWTPD1",16,0)
 ;
"RTN","ORWTPD1",17,0)
 S INFO=ORSTART_U_ORSTOP
"RTN","ORWTPD1",18,0)
 ;
"RTN","ORWTPD1",19,0)
 Q
"RTN","ORWTPD1",20,0)
 ;
"RTN","ORWTPD1",21,0)
GETEDATS(INFO) ; Get user's (all levels) Encounter app't date range params.
"RTN","ORWTPD1",22,0)
 ;
"RTN","ORWTPD1",23,0)
 N ORSRV,ORUSER
"RTN","ORWTPD1",24,0)
 S ORUSER=DUZ
"RTN","ORWTPD1",25,0)
 ;
"RTN","ORWTPD1",26,0)
 S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U) ; Get S/S.
"RTN","ORWTPD1",27,0)
 S INFO=$$GET^XPAR("USR.`"_ORUSER_"^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORQQEAPT ENC APPT START",1,"I")_U
"RTN","ORWTPD1",28,0)
 S INFO=INFO_$$GET^XPAR("USR.`"_ORUSER_"^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORQQEAPT ENC APPT STOP",1,"I")
"RTN","ORWTPD1",29,0)
 ;
"RTN","ORWTPD1",30,0)
 Q
"RTN","ORWTPD1",31,0)
 ;
"RTN","ORWTPD1",32,0)
PUTEDATS(OK,Y) ; Save Encounter app't date range params at user level.
"RTN","ORWTPD1",33,0)
 ;
"RTN","ORWTPD1",34,0)
 N ORSTART,ORSTOP,ORUSER
"RTN","ORWTPD1",35,0)
 ;
"RTN","ORWTPD1",36,0)
 S OK=1,ORUSER=DUZ
"RTN","ORWTPD1",37,0)
 S ORSTART=$P(Y,U,1)
"RTN","ORWTPD1",38,0)
 S ORSTOP=$P(Y,U,2)
"RTN","ORWTPD1",39,0)
 I ORSTART="" S ORSTART=0
"RTN","ORWTPD1",40,0)
 I ORSTOP="" S ORSTOP=0
"RTN","ORWTPD1",41,0)
 I ORSTART>999 S ORSTART=999
"RTN","ORWTPD1",42,0)
 I ORSTOP>999 S ORSTART=999
"RTN","ORWTPD1",43,0)
 ;
"RTN","ORWTPD1",44,0)
 D EN^XPAR(ORUSER_";VA(200,","ORQQEAPT ENC APPT START",1,ORSTART)
"RTN","ORWTPD1",45,0)
 D EN^XPAR(ORUSER_";VA(200,","ORQQEAPT ENC APPT STOP",1,ORSTOP)
"RTN","ORWTPD1",46,0)
 ;
"RTN","ORWTPD1",47,0)
 Q
"RTN","ORWTPD1",48,0)
 ;
"RTN","ORWTPD1",49,0)
GETCSDEF(INFO) ; Get Div/Sys/Pkg Cover Sheet default range parameters.
"RTN","ORWTPD1",50,0)
 ;
"RTN","ORWTPD1",51,0)
 N ORVAL
"RTN","ORWTPD1",52,0)
 ;
"RTN","ORWTPD1",53,0)
 S ORVAL=""
"RTN","ORWTPD1",54,0)
 S ORVAL=$$GET^XPAR("DIV^SYS^PKG","ORQQCSDR CS RANGE START",1,"I")
"RTN","ORWTPD1",55,0)
 S ORVAL=$$CHKRNG(ORVAL,999)
"RTN","ORWTPD1",56,0)
 S INFO=ORVAL_U,ORVAL=""
"RTN","ORWTPD1",57,0)
 S ORVAL=$$GET^XPAR("DIV^SYS^PKG","ORQQCSDR CS RANGE STOP",1,"I")
"RTN","ORWTPD1",58,0)
 S ORVAL=$$CHKRNG(ORVAL,999)
"RTN","ORWTPD1",59,0)
 S INFO=INFO_ORVAL
"RTN","ORWTPD1",60,0)
 ;
"RTN","ORWTPD1",61,0)
 Q
"RTN","ORWTPD1",62,0)
 ;
"RTN","ORWTPD1",63,0)
GETCSRNG(VAL) ; Get user's Cover Sheet date range defaults.
"RTN","ORWTPD1",64,0)
 ;
"RTN","ORWTPD1",65,0)
 N ORSRV,ORUSER,ORVAL
"RTN","ORWTPD1",66,0)
 S ORUSER=DUZ
"RTN","ORWTPD1",67,0)
 ;
"RTN","ORWTPD1",68,0)
 S ORVAL=""
"RTN","ORWTPD1",69,0)
 S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U) ; Get S/S.
"RTN","ORWTPD1",70,0)
 S ORVAL=$$GET^XPAR("USR.`"_ORUSER_"^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORQQCSDR CS RANGE START",1,"I")
"RTN","ORWTPD1",71,0)
 S ORVAL=$$CHKRNG(ORVAL,999)
"RTN","ORWTPD1",72,0)
 S VAL=ORVAL_U,ORVAL=""
"RTN","ORWTPD1",73,0)
 S ORVAL=$$GET^XPAR("USR.`"_ORUSER_"^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORQQCSDR CS RANGE STOP",1,"I")
"RTN","ORWTPD1",74,0)
 S ORVAL=$$CHKRNG(ORVAL,999)
"RTN","ORWTPD1",75,0)
 S VAL=VAL_ORVAL
"RTN","ORWTPD1",76,0)
 ;
"RTN","ORWTPD1",77,0)
 Q
"RTN","ORWTPD1",78,0)
 ;
"RTN","ORWTPD1",79,0)
PUTCSRNG(OK,INFO) ; Save user's Cover Sheet data range defaults.
"RTN","ORWTPD1",80,0)
 ;
"RTN","ORWTPD1",81,0)
 N ORINPT,OROUTPT,ORSTART,ORSTOP,ORUSER
"RTN","ORWTPD1",82,0)
 ;
"RTN","ORWTPD1",83,0)
 S OK=1,ORUSER=DUZ
"RTN","ORWTPD1",84,0)
 S ORSTART=+$P(INFO,U,3) S:ORSTART>999 ORSTART=999 S ORSTART=$S(ORSTART=0:"T",ORSTART<0:"T"_ORSTART,1:"T+"_ORSTART)
"RTN","ORWTPD1",85,0)
 S ORSTOP=+$P(INFO,U,4) S:ORSTOP>999 ORSTART=999 S ORSTOP=$S(ORSTOP=0:"T",ORSTOP<0:"T"_ORSTOP,1:"T+"_ORSTOP)
"RTN","ORWTPD1",86,0)
 S ORINPT=+$P(INFO,U,1),ORINPT=$S('ORINPT:"@",1:ORINPT)
"RTN","ORWTPD1",87,0)
 S OROUTPT=+$P(INFO,U,2),OROUTPT=$S('OROUTPT:"@",1:OROUTPT)
"RTN","ORWTPD1",88,0)
 D EN^XPAR(ORUSER_";VA(200,","ORQQCSDR CS RANGE START",1,ORSTART)
"RTN","ORWTPD1",89,0)
 D EN^XPAR(ORUSER_";VA(200,","ORQQCSDR CS RANGE STOP",1,ORSTOP)
"RTN","ORWTPD1",90,0)
 D EN^XPAR(ORUSER_";VA(200,","ORQQLR DATE RANGE INPT",1,ORINPT)
"RTN","ORWTPD1",91,0)
 D EN^XPAR(ORUSER_";VA(200,","ORQQLR DATE RANGE OUTPT",1,OROUTPT)
"RTN","ORWTPD1",92,0)
 ;
"RTN","ORWTPD1",93,0)
 Q
"RTN","ORWTPD1",94,0)
 ;
"RTN","ORWTPD1",95,0)
GETEAFL(Y) ; Get "future days limit" parameter setting for Enc appt selection.
"RTN","ORWTPD1",96,0)
 ;
"RTN","ORWTPD1",97,0)
 S Y=$$GET^XPAR("DIV^SYS^PKG^USR","ORQQEAFL ENC APPT FUTURE LIMIT",1,"I")
"RTN","ORWTPD1",98,0)
 ;
"RTN","ORWTPD1",99,0)
 Q
"RTN","ORWTPD1",100,0)
 ;
"RTN","ORWTPD1",101,0)
CHKRNG(ORV,ORLIMIT) ; Check a "T-xx" or "T+xx" value.
"RTN","ORWTPD1",102,0)
 ;
"RTN","ORWTPD1",103,0)
 ; ORLIMIT must be a positive number.
"RTN","ORWTPD1",104,0)
 ;
"RTN","ORWTPD1",105,0)
 N ORNEG,ORPOS,ORT,ORTT,ORVALUE
"RTN","ORWTPD1",106,0)
 ;
"RTN","ORWTPD1",107,0)
 S (ORNEG,ORPOS,ORT,ORTT)=0
"RTN","ORWTPD1",108,0)
 I $G(ORV)="" Q ORV
"RTN","ORWTPD1",109,0)
 I $G(ORLIMIT)=0 Q ORV
"RTN","ORWTPD1",110,0)
 ;
"RTN","ORWTPD1",111,0)
 I ORV["-" S ORNEG=1
"RTN","ORWTPD1",112,0)
 I ORV["+" S ORPOS=1
"RTN","ORWTPD1",113,0)
 I ORV["T" S ORT=1
"RTN","ORWTPD1",114,0)
 I ORV["t" S ORTT=1
"RTN","ORWTPD1",115,0)
 S ORVALUE=ORV
"RTN","ORWTPD1",116,0)
 I ORT S ORVALUE=$P(ORV,"T",2)
"RTN","ORWTPD1",117,0)
 I ORTT S ORVALUE=$P(ORV,"t",2)
"RTN","ORWTPD1",118,0)
 I ORPOS S ORVALUE=$P(ORVALUE,"+",2)
"RTN","ORWTPD1",119,0)
 I ORNEG S ORVALUE=$P(ORVALUE,"-",2)
"RTN","ORWTPD1",120,0)
 I ORVALUE>ORLIMIT S ORVALUE=ORLIMIT
"RTN","ORWTPD1",121,0)
 ;
"RTN","ORWTPD1",122,0)
 S ORV="T+"_ORVALUE
"RTN","ORWTPD1",123,0)
 I ORNEG S ORV="T-"_ORVALUE
"RTN","ORWTPD1",124,0)
 ;
"RTN","ORWTPD1",125,0)
 Q ORV
"RTN","ORWTPD1",126,0)
 ;
"RTN","ORWTPN")
0^51^B43115795
"RTN","ORWTPN",1,0)
ORWTPN ; SLC/STAFF Personal Preference - Notes ;2/21/01  08:11 [1/29/04 2:32pm]
"RTN","ORWTPN",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,149,187,195**;Dec 17, 1997
"RTN","ORWTPN",3,0)
 ;
"RTN","ORWTPN",4,0)
GETSUB(VALUE,USER) ; from ORWTPP
"RTN","ORWTPN",5,0)
 ; get Ask for Subject on notes for user
"RTN","ORWTPN",6,0)
 N NODE
"RTN","ORWTPN",7,0)
 S NODE=+$O(^TIU(8926,"B",USER,0))
"RTN","ORWTPN",8,0)
 S VALUE=+$P($G(^TIU(8926,NODE,0)),U,8)
"RTN","ORWTPN",9,0)
 Q
"RTN","ORWTPN",10,0)
 ;
"RTN","ORWTPN",11,0)
SETSUB(OK,VALUE,USER) ; from ORWTPP
"RTN","ORWTPN",12,0)
 ; set Ask for Subject on note for user
"RTN","ORWTPN",13,0)
 N DA,DIE,DIK,DR,NODE,NUM
"RTN","ORWTPN",14,0)
 S OK=1
"RTN","ORWTPN",15,0)
 S VALUE=+$G(VALUE),VALUE=$S(VALUE=1:1,VALUE=0:0,1:"")
"RTN","ORWTPN",16,0)
 I VALUE="" S OK=0 Q
"RTN","ORWTPN",17,0)
 S NODE=+$O(^TIU(8926,"B",USER,0))
"RTN","ORWTPN",18,0)
 I 'NODE D  Q  ; make new entry if user does not have TIU preferences
"RTN","ORWTPN",19,0)
 .I 'VALUE Q  ; no need to set since default for no user preference is 0
"RTN","ORWTPN",20,0)
 .L +^TIU(8926,0):5 I '$T S OK=0 Q
"RTN","ORWTPN",21,0)
 .S NUM=1+$P(^TIU(8926,0),U,3)
"RTN","ORWTPN",22,0)
 .F  Q:'$D(^TIU(8926,NUM,0))  S NUM=NUM+1
"RTN","ORWTPN",23,0)
 .S $P(^(0),U,4)=1+$P(^TIU(8926,0),U,4),$P(^(0),U,3)=NUM
"RTN","ORWTPN",24,0)
 .S ^TIU(8926,NUM,0)=USER_"^^^^^^^1"
"RTN","ORWTPN",25,0)
 .L -^TIU(8926,0)
"RTN","ORWTPN",26,0)
 .S DA=NUM,DIK="^TIU(8926,"
"RTN","ORWTPN",27,0)
 .D IX1^DIK
"RTN","ORWTPN",28,0)
 I USER'=+$G(^TIU(8926,NODE,0)) Q
"RTN","ORWTPN",29,0)
 S DA=NODE,DIE="^TIU(8926,",DR=".08///"_VALUE
"RTN","ORWTPN",30,0)
 D ^DIE
"RTN","ORWTPN",31,0)
 Q
"RTN","ORWTPN",32,0)
 ;
"RTN","ORWTPN",33,0)
GETCOS(ORY,ORUSER,ORFROM,ORDIR,ORVIZ) ; Get cosigners for user (from ORWTPP).
"RTN","ORWTPN",34,0)
 ; (Keep this code matched with NP1^ORWU1 / NEWPERS^ORWU.)
"RTN","ORWTPN",35,0)
 ;
"RTN","ORWTPN",36,0)
 ; Params:
"RTN","ORWTPN",37,0)
 ;  .ORY=returned list, ORFROM=text to $O from, ORDIR=$O direction.
"RTN","ORWTPN",38,0)
 ;  ORDIR=Direction to move through x-ref.
"RTN","ORWTPN",39,0)
 ;  ORFROM=Starting value to use.
"RTN","ORWTPN",40,0)
 ;  ORUSER=User seeking a Cosigner.
"RTN","ORWTPN",41,0)
 ;  ORVIZ=If true, includes RDV users; otherwise not (optional).
"RTN","ORWTPN",42,0)
 ;
"RTN","ORWTPN",43,0)
 N OR1DIV,ORCNT,ORDATE,ORDD,ORDIV,ORDUP,ORGOOD,ORI,ORIEN1,ORIEN2,ORKEY,ORLAST,ORMAX,ORMRK,ORMULTI,ORNODE,ORPREV,ORSRV,ORTTL
"RTN","ORWTPN",44,0)
 ;
"RTN","ORWTPN",45,0)
 S ORI=0,ORMAX=44,(ORLAST,ORPREV)="",ORKEY=$G(ORKEY),ORDATE=$G(ORDATE)
"RTN","ORWTPN",46,0)
 S ORMULTI=$$ALL^VASITE ; Do once at beginning of call.
"RTN","ORWTPN",47,0)
 ;
"RTN","ORWTPN",48,0)
 ; NP3^ORWU1 tag includes visitors, uses full "B" x-ref.
"RTN","ORWTPN",49,0)
 I +$G(ORVIZ)=1 D NP3^ORWU1(1) Q  ; Use alt. version, skip rest.
"RTN","ORWTPN",50,0)
 ;
"RTN","ORWTPN",51,0)
 F  Q:ORI'<ORMAX  S ORFROM=$O(^VA(200,"AUSER",ORFROM),ORDIR) Q:ORFROM=""  D
"RTN","ORWTPN",52,0)
 .S ORIEN1=""
"RTN","ORWTPN",53,0)
 .F  S ORIEN1=$O(^VA(200,"AUSER",ORFROM,ORIEN1),ORDIR) Q:'ORIEN1  D
"RTN","ORWTPN",54,0)
 ..;
"RTN","ORWTPN",55,0)
 ..; Screen default cosigner selection:
"RTN","ORWTPN",56,0)
 ..I '$$SCRDFCS^TIULA3(ORUSER,ORIEN1) Q
"RTN","ORWTPN",57,0)
 ..S ORNODE=$P($G(^VA(200,ORIEN1,0)),U)
"RTN","ORWTPN",58,0)
 ..I '$L(ORNODE) Q
"RTN","ORWTPN",59,0)
 ..S ORI=ORI+1,ORY(ORI)=ORIEN1_"^"_$$NAMEFMT^XLFNAME(ORFROM,"F","DcMPC")
"RTN","ORWTPN",60,0)
 ..S ORDUP=0                            ; Init flag, check dupe.
"RTN","ORWTPN",61,0)
 ..I ($P(ORPREV_" "," ")=$P(ORFROM_" "," ")) S ORDUP=1
"RTN","ORWTPN",62,0)
 ..;
"RTN","ORWTPN",63,0)
 ..; Append Title if not duplicated:
"RTN","ORWTPN",64,0)
 ..I 'ORDUP D
"RTN","ORWTPN",65,0)
 ...S ORIEN2=ORIEN1
"RTN","ORWTPN",66,0)
 ...D NP4^ORWU1(0)                      ; Get Title.
"RTN","ORWTPN",67,0)
 ...I ORTTL="" Q
"RTN","ORWTPN",68,0)
 ...S ORY(ORI)=ORY(ORI)_U_"- "_ORTTL
"RTN","ORWTPN",69,0)
 ..;
"RTN","ORWTPN",70,0)
 ..; Get data in case of dupes:
"RTN","ORWTPN",71,0)
 ..I ORDUP D
"RTN","ORWTPN",72,0)
 ...S ORIEN2=ORLAST                     ; Prev IEN for NP2^ORWU1 call.
"RTN","ORWTPN",73,0)
 ...;
"RTN","ORWTPN",74,0)
 ...; Reset, use previous array element, call for extended data:
"RTN","ORWTPN",75,0)
 ...S ORI=ORI-1,ORY(ORI)=$P(ORY(ORI),U)_U_$P(ORY(ORI),U,2)  D NP2^ORWU1
"RTN","ORWTPN",76,0)
 ...;
"RTN","ORWTPN",77,0)
 ...; Then return to current user for second extended data call:
"RTN","ORWTPN",78,0)
 ...S ORIEN2=ORIEN1,ORI=ORI+1  D NP2^ORWU1
"RTN","ORWTPN",79,0)
 ..S ORLAST=ORIEN1,ORPREV=ORFROM        ; Reassign vars for next pass.
"RTN","ORWTPN",80,0)
 ;
"RTN","ORWTPN",81,0)
 Q
"RTN","ORWTPN",82,0)
 ;
"RTN","ORWTPN",83,0)
GETDCOS(VALUE,USER) ; from ORWTPP
"RTN","ORWTPN",84,0)
 ; get default cosigner for user
"RTN","ORWTPN",85,0)
 N IEN,NAME,NODE
"RTN","ORWTPN",86,0)
 S NODE=+$O(^TIU(8926,"B",USER,0))
"RTN","ORWTPN",87,0)
 S IEN=+$P($G(^TIU(8926,NODE,0)),U,9)
"RTN","ORWTPN",88,0)
 S NAME=$P($G(^VA(200,IEN,0)),U)
"RTN","ORWTPN",89,0)
 S VALUE=IEN_U_NAME
"RTN","ORWTPN",90,0)
 Q
"RTN","ORWTPN",91,0)
 ;
"RTN","ORWTPN",92,0)
SETDCOS(OK,VALUE,USER) ; from ORWTPP
"RTN","ORWTPN",93,0)
 ; set default cosigner for user
"RTN","ORWTPN",94,0)
 N DA,DIE,DIK,DR,NODE,NUM
"RTN","ORWTPN",95,0)
 S OK=1
"RTN","ORWTPN",96,0)
 S VALUE=+$G(VALUE)
"RTN","ORWTPN",97,0)
 I 'VALUE S VALUE="@"
"RTN","ORWTPN",98,0)
 S NODE=+$O(^TIU(8926,"B",USER,0))
"RTN","ORWTPN",99,0)
 I 'NODE D  Q  ; make new entry if user does not have TIU preferences
"RTN","ORWTPN",100,0)
 .I 'VALUE Q
"RTN","ORWTPN",101,0)
 .I '$$SCRDFCS^TIULA3(USER,VALUE) Q
"RTN","ORWTPN",102,0)
 .L +^TIU(8926,0):5 I '$T S OK=0 Q
"RTN","ORWTPN",103,0)
 .S NUM=1+$P(^TIU(8926,0),U,3)
"RTN","ORWTPN",104,0)
 .F  Q:'$D(^TIU(8926,NUM,0))  S NUM=NUM+1
"RTN","ORWTPN",105,0)
 .S $P(^(0),U,4)=1+$P(^TIU(8926,0),U,4),$P(^(0),U,3)=NUM
"RTN","ORWTPN",106,0)
 .S ^TIU(8926,NUM,0)=USER_"^^^^^^^^"_VALUE
"RTN","ORWTPN",107,0)
 .L -^TIU(8926,0)
"RTN","ORWTPN",108,0)
 .S DA=NUM,DIK="^TIU(8926,"
"RTN","ORWTPN",109,0)
 .D IX1^DIK
"RTN","ORWTPN",110,0)
 I USER'=+$G(^TIU(8926,NODE,0)) Q
"RTN","ORWTPN",111,0)
 S DA=NODE,DIE="^TIU(8926,",DR=".09///"_$S(VALUE:"`"_VALUE,1:"@")
"RTN","ORWTPN",112,0)
 D ^DIE
"RTN","ORWTPN",113,0)
 Q
"RTN","ORWTPN",114,0)
 ;
"RTN","ORWTPN",115,0)
GETCLASS(VALUES) ; RPC
"RTN","ORWTPN",116,0)
 ; get available document classes
"RTN","ORWTPN",117,0)
 N CNT,NODE,NUM K VALUES
"RTN","ORWTPN",118,0)
 S CNT=0
"RTN","ORWTPN",119,0)
 S NUM=0 F  S NUM=$O(^TIU(8925.1,"AT","CL",NUM)) Q:NUM<1  D
"RTN","ORWTPN",120,0)
 .I '$$CLASPICK^TIULA4(38,NUM,"CL") Q
"RTN","ORWTPN",121,0)
 .S NODE=$G(^TIU(8925.1,NUM,0))
"RTN","ORWTPN",122,0)
 .I '$L(NODE) Q
"RTN","ORWTPN",123,0)
 .S CNT=CNT+1
"RTN","ORWTPN",124,0)
 .S VALUES(CNT)=NUM_U_NODE
"RTN","ORWTPN",125,0)
 Q
"RTN","ORWTPN",126,0)
 ;
"RTN","ORWTPN",127,0)
GETTC(VALUES,CLASS,FROM,DIR) ; RPC
"RTN","ORWTPN",128,0)
 ; get titles for a class
"RTN","ORWTPN",129,0)
 N CNT,IEN,NODE,NUM K VALUES
"RTN","ORWTPN",130,0)
 S CNT=44,NUM=0
"RTN","ORWTPN",131,0)
 F  Q:NUM>CNT  S FROM=$O(^TIU(8925.1,"B",FROM),DIR) Q:FROM=""  D
"RTN","ORWTPN",132,0)
 .S IEN=0 F  S IEN=$O(^TIU(8925.1,"B",FROM,IEN)) Q:IEN<1  D
"RTN","ORWTPN",133,0)
 ..I '$D(^TIU(8925.1,"AT","DOC",IEN)) Q
"RTN","ORWTPN",134,0)
 ..I '$$ISA^TIULX(IEN,CLASS) Q
"RTN","ORWTPN",135,0)
 ..I '$$CANPICK^TIULP(IEN) Q
"RTN","ORWTPN",136,0)
 ..I '$$CANENTR^TIULP(IEN) Q
"RTN","ORWTPN",137,0)
 ..S NODE=$G(^TIU(8925.1,IEN,0))
"RTN","ORWTPN",138,0)
 ..I '$L(NODE) Q
"RTN","ORWTPN",139,0)
 ..S NUM=NUM+1
"RTN","ORWTPN",140,0)
 ..S VALUES(NUM)=IEN_U_NODE
"RTN","ORWTPN",141,0)
 Q
"RTN","ORWTPN",142,0)
 ;
"RTN","ORWTPN",143,0)
GETTU(VALUES,CLASS,USER) ; from ORWTPP
"RTN","ORWTPN",144,0)
 ; get titles for a user
"RTN","ORWTPN",145,0)
 N CNT,IEN,NUM,NUM1,NODE K VALUES
"RTN","ORWTPN",146,0)
 S CNT=0
"RTN","ORWTPN",147,0)
 S NUM=+$O(^TIU(8925.98,"AC",USER,CLASS,0))
"RTN","ORWTPN",148,0)
 I 'NUM Q
"RTN","ORWTPN",149,0)
 S NUM1=0 F  S NUM1=$O(^TIU(8925.98,NUM,10,NUM1)) Q:NUM1<1  D
"RTN","ORWTPN",150,0)
 .S IEN=+$G(^TIU(8925.98,NUM,10,NUM1,0))
"RTN","ORWTPN",151,0)
 .S NODE=$P($G(^TIU(8925.1,IEN,0)),U)
"RTN","ORWTPN",152,0)
 .I '$L(NODE) Q
"RTN","ORWTPN",153,0)
 .S CNT=CNT+1
"RTN","ORWTPN",154,0)
 .S VALUES(CNT)=IEN_U_NODE_U_(.0000001*$P(^TIU(8925.98,NUM,10,NUM1,0),U,2))_U_$P(^(0),U,3)
"RTN","ORWTPN",155,0)
 Q
"RTN","ORWTPN",156,0)
 ;
"RTN","ORWTPN",157,0)
GETTD(VALUE,CLASS,USER) ; from ORWTPP
"RTN","ORWTPN",158,0)
 ; get default title for user
"RTN","ORWTPN",159,0)
 N IEN,NUM,NODE
"RTN","ORWTPN",160,0)
 S VALUE=-1,USER=+$G(USER)
"RTN","ORWTPN",161,0)
 S NUM=+$O(^TIU(8925.98,"AC",USER,CLASS,0))
"RTN","ORWTPN",162,0)
 I 'NUM Q
"RTN","ORWTPN",163,0)
 S IEN=+$P($G(^TIU(8925.98,NUM,0)),U,3)
"RTN","ORWTPN",164,0)
 S NODE=$G(^TIU(8925.1,IEN,0))
"RTN","ORWTPN",165,0)
 I '$L(NODE) Q
"RTN","ORWTPN",166,0)
 S VALUE=IEN
"RTN","ORWTPN",167,0)
 Q
"RTN","ORWTPN",168,0)
 ;
"RTN","ORWTPN",169,0)
SAVET(OK,CLASS,DEFAULT,VALUES,USER) ; from ORWTPP
"RTN","ORWTPN",170,0)
 ; save titles for user
"RTN","ORWTPN",171,0)
 N CNT,DA,DIK,IEN,NUM,VALUE K DA
"RTN","ORWTPN",172,0)
 S CLASS=+$G(CLASS),DEFAULT=+$G(DEFAULT),OK=1
"RTN","ORWTPN",173,0)
 I DEFAULT'>0 S DEFAULT=""
"RTN","ORWTPN",174,0)
 S IEN=+$O(^TIU(8925.98,"AC",USER,CLASS,0))
"RTN","ORWTPN",175,0)
 I IEN D  Q
"RTN","ORWTPN",176,0)
 .S DA(1)=IEN
"RTN","ORWTPN",177,0)
 .S DIK="^TIU(8925.98,"_DA(1)_",10,"
"RTN","ORWTPN",178,0)
 .L +^TIU(8925.98,IEN):5 I '$T S OK=0 Q
"RTN","ORWTPN",179,0)
 .S DA=0 F  S DA=$O(^TIU(8925.98,IEN,10,DA)) Q:DA<1  D
"RTN","ORWTPN",180,0)
 ..D ^DIK
"RTN","ORWTPN",181,0)
 .S CNT=0
"RTN","ORWTPN",182,0)
 .S NUM=0 F  S NUM=$O(VALUES(NUM)) Q:NUM<1  D
"RTN","ORWTPN",183,0)
 ..S VALUE=+VALUES(NUM) I 'VALUE Q
"RTN","ORWTPN",184,0)
 ..S CNT=CNT+1
"RTN","ORWTPN",185,0)
 ..S ^TIU(8925.98,IEN,10,CNT,0)=VALUE_U_CNT_U_$P(VALUES(NUM),U,4)
"RTN","ORWTPN",186,0)
 .S ^TIU(8925.98,IEN,10,0)="^8925.9801IP^"_CNT_U_CNT
"RTN","ORWTPN",187,0)
 .S $P(^TIU(8925.98,IEN,0),U,3)=DEFAULT
"RTN","ORWTPN",188,0)
 .K DA S DA=IEN,DIK="^TIU(8925.98,"
"RTN","ORWTPN",189,0)
 .D IX1^DIK
"RTN","ORWTPN",190,0)
 .L -^TIU(8925.98,IEN)
"RTN","ORWTPN",191,0)
 S DA=1+$P(^TIU(8925.98,0),U,3)
"RTN","ORWTPN",192,0)
 L +^TIU(8925.98,0):5 I '$T S OK=0 Q
"RTN","ORWTPN",193,0)
 F  Q:'$D(^TIU(8925.98,DA))  S DA=DA+1
"RTN","ORWTPN",194,0)
 S ^TIU(8925.98,DA,0)=USER_U_CLASS_U_DEFAULT
"RTN","ORWTPN",195,0)
 S $P(^(0),U,4)=1+$P(^TIU(8925.98,0),U,4),$P(^(0),U,3)=DA
"RTN","ORWTPN",196,0)
 L -^TIU(8925.98,0)
"RTN","ORWTPN",197,0)
 S CNT=0
"RTN","ORWTPN",198,0)
 S NUM=0 F  S NUM=$O(VALUES(NUM)) Q:NUM<1  D
"RTN","ORWTPN",199,0)
 .S VALUE=+VALUES(NUM)
"RTN","ORWTPN",200,0)
 .I 'VALUE Q
"RTN","ORWTPN",201,0)
 .S CNT=CNT+1
"RTN","ORWTPN",202,0)
 .S ^TIU(8925.98,DA,10,CNT,0)=VALUE
"RTN","ORWTPN",203,0)
 S ^TIU(8925.98,DA,10,0)="^8925.9801IP^"_CNT_U_CNT
"RTN","ORWTPN",204,0)
 S DIK="^TIU(8925.98,"
"RTN","ORWTPN",205,0)
 D IX1^DIK
"RTN","ORWTPN",206,0)
 Q
"RTN","ORWTPO")
0^54^B12860836
"RTN","ORWTPO",1,0)
ORWTPO ; SLC/STAFF Personal Preference - Order Checks ;5/1/01  12:27 [11/29/04 11:19am]
"RTN","ORWTPO",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,195**;Dec 17, 1997
"RTN","ORWTPO",3,0)
 ;
"RTN","ORWTPO",4,0)
GETOTHER(INFO,USER) ; from ORWTPP
"RTN","ORWTPO",5,0)
 ; get user's other parameter settings
"RTN","ORWTPO",6,0)
 S INFO=$$GET^XPAR("ALL^USR.`"_USER,"ORCH INITIAL TAB")
"RTN","ORWTPO",7,0)
 S INFO=INFO_U_$$GET^XPAR("ALL^USR.`"_USER,"ORCH USE LAST TAB")
"RTN","ORWTPO",8,0)
 S INFO=INFO_U_$$GET^XPAR("ALL^USR.`"_USER,"ORWOR AUTOSAVE NOTE")
"RTN","ORWTPO",9,0)
 S INFO=INFO_U_$$GET^XPAR("ALL^USR.`"_USER,"ORWOR VERIFY NOTE TITLE")
"RTN","ORWTPO",10,0)
 Q
"RTN","ORWTPO",11,0)
 ;
"RTN","ORWTPO",12,0)
SETOTHER(OK,INFO,USER) ; from ORWTPP
"RTN","ORWTPO",13,0)
 ; save user's other parameter settings
"RTN","ORWTPO",14,0)
 N AUTO,LAST,TAB,VER
"RTN","ORWTPO",15,0)
 S OK=1
"RTN","ORWTPO",16,0)
 S TAB=$P(INFO,U),LAST=$P(INFO,U,2),AUTO=$P(INFO,U,3),VER=$P(INFO,U,4)
"RTN","ORWTPO",17,0)
 I $L(TAB) D EN^XPAR(USER_";VA(200,","ORCH INITIAL TAB",1,TAB)
"RTN","ORWTPO",18,0)
 I $L(LAST) D EN^XPAR(USER_";VA(200,","ORCH USE LAST TAB",1,$S(LAST:"YES",1:"NO"))
"RTN","ORWTPO",19,0)
 I $L(AUTO) D EN^XPAR(USER_";VA(200,","ORWOR AUTOSAVE NOTE",1,AUTO)
"RTN","ORWTPO",20,0)
 I $L(VER) D EN^XPAR(USER_";VA(200,","ORWOR VERIFY NOTE TITLE",1,$S(VER:"YES",1:"NO"))
"RTN","ORWTPO",21,0)
 Q
"RTN","ORWTPO",22,0)
 ;
"RTN","ORWTPO",23,0)
GETTABS(VALUES) ; RPC
"RTN","ORWTPO",24,0)
 ; get tab names for patient chart
"RTN","ORWTPO",25,0)
 K VALUES
"RTN","ORWTPO",26,0)
 D PDSET^ORWTPUP("ORCH INITIAL TAB",.VALUES)
"RTN","ORWTPO",27,0)
 Q
"RTN","ORWTPO",28,0)
 ;
"RTN","ORWTPO",29,0)
CSLABD(INFO) ; RPC
"RTN","ORWTPO",30,0)
 ; get lab defaults
"RTN","ORWTPO",31,0)
 N RNG
"RTN","ORWTPO",32,0)
 S INFO=""
"RTN","ORWTPO",33,0)
 F RNG="INPT","OUTPT" D
"RTN","ORWTPO",34,0)
 .S INFO=INFO_$$GET^XPAR("DIV^SYS^PKG","ORQQLR DATE RANGE "_RNG,1,"I")_U
"RTN","ORWTPO",35,0)
 Q
"RTN","ORWTPO",36,0)
 ;
"RTN","ORWTPO",37,0)
CSLAB(VAL,USER) ; from ORWTPP
"RTN","ORWTPO",38,0)
 ; get user's lab date range defaults
"RTN","ORWTPO",39,0)
 N RNG
"RTN","ORWTPO",40,0)
 S VAL=""
"RTN","ORWTPO",41,0)
 F RNG="INPT","OUTPT" D
"RTN","ORWTPO",42,0)
 .S VAL=VAL_$$GET^XPAR("USR.`"_USER_"^DIV^SYS^PKG","ORQQLR DATE RANGE "_RNG,1,"I")_U
"RTN","ORWTPO",43,0)
 Q
"RTN","ORWTPO",44,0)
 ;
"RTN","ORWTPO",45,0)
CSARNGD(INFO) ; RPC
"RTN","ORWTPO",46,0)
 ; get start, stop defaults
"RTN","ORWTPO",47,0)
 S INFO=$$GET^XPAR("DIV^SYS^PKG","ORQQCSDR CS RANGE START",1,"I")_U
"RTN","ORWTPO",48,0)
 S INFO=INFO_$$GET^XPAR("DIV^SYS^PKG","ORQQCSDR CS RANGE STOP",1,"I")
"RTN","ORWTPO",49,0)
 Q
"RTN","ORWTPO",50,0)
 ;
"RTN","ORWTPO",51,0)
CSARNG(VAL,USER) ; from ORWTPP
"RTN","ORWTPO",52,0)
 ; get user's appt date range defaults
"RTN","ORWTPO",53,0)
 N ORSRV
"RTN","ORWTPO",54,0)
 S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U) ; Get S/S.
"RTN","ORWTPO",55,0)
 S VAL=$$GET^XPAR("USR.`"_USER_"^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORQQCSDR CS RANGE START",1,"I")_U
"RTN","ORWTPO",56,0)
 S VAL=VAL_$$GET^XPAR("USR.`"_USER_"^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORQQCSDR CS RANGE STOP",1,"I")
"RTN","ORWTPO",57,0)
 Q
"RTN","ORWTPO",58,0)
 ;
"RTN","ORWTPO",59,0)
SAVECS(OK,INFO,USER) ; from ORWTPP
"RTN","ORWTPO",60,0)
 ; save user's date range defaults
"RTN","ORWTPO",61,0)
 N INPT,OUTPT,START,STOP
"RTN","ORWTPO",62,0)
 S OK=1
"RTN","ORWTPO",63,0)
 S START=+$P(INFO,U,3) S START=$S(START=0:"T",START<0:"T"_START,1:"T+"_START)
"RTN","ORWTPO",64,0)
 S STOP=+$P(INFO,U,4) S STOP=$S(STOP=0:"T",STOP<0:"T"_STOP,1:"T+"_STOP)
"RTN","ORWTPO",65,0)
 S INPT=+$P(INFO,U,1),INPT=$S('INPT:"@",1:INPT)
"RTN","ORWTPO",66,0)
 S OUTPT=+$P(INFO,U,2),OUTPT=$S('OUTPT:"@",1:OUTPT)
"RTN","ORWTPO",67,0)
 D EN^XPAR(USER_";VA(200,","ORQQCSDR CS RANGE START",1,START)
"RTN","ORWTPO",68,0)
 D EN^XPAR(USER_";VA(200,","ORQQCSDR CS RANGE STOP",1,STOP)
"RTN","ORWTPO",69,0)
 D EN^XPAR(USER_";VA(200,","ORQQLR DATE RANGE INPT",1,INPT)
"RTN","ORWTPO",70,0)
 D EN^XPAR(USER_";VA(200,","ORQQLR DATE RANGE OUTPT",1,OUTPT)
"RTN","ORWTPO",71,0)
 Q
"RTN","ORWTPO",72,0)
GETIMGD(INFO) ; RPC
"RTN","ORWTPO",73,0)
 S INFO=$$GET^XPAR("SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORCH CONTEXT REPORTS")
"RTN","ORWTPO",74,0)
 Q
"RTN","ORWTPO",75,0)
 ;
"RTN","ORWTPO",76,0)
GETIMG(INFO,USER) ; from ORWTPP
"RTN","ORWTPO",77,0)
 ; get user's image report defaults
"RTN","ORWTPO",78,0)
 S INFO=$$GET^XPAR("USR.`"_USER_"^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORCH CONTEXT REPORTS")
"RTN","ORWTPO",79,0)
 Q
"RTN","ORWTPO",80,0)
 ;
"RTN","ORWTPO",81,0)
SETIMG(OK,MAX,START,STOP,USER) ; from ORWTPP
"RTN","ORWTPO",82,0)
 ; save user's image report defaults
"RTN","ORWTPO",83,0)
 N VALUE S OK=0
"RTN","ORWTPO",84,0)
 I MAX'>0 Q
"RTN","ORWTPO",85,0)
 S START=$S(START=0:"T",START<0:"T"_START,1:"T+"_START)
"RTN","ORWTPO",86,0)
 S STOP=$S(STOP=0:"T",STOP<0:"T"_STOP,1:"T+"_STOP)
"RTN","ORWTPO",87,0)
 S VALUE=START_";"_STOP_";;;"_MAX
"RTN","ORWTPO",88,0)
 S OK=1
"RTN","ORWTPO",89,0)
 D EN^XPAR(USER_";VA(200,","ORCH CONTEXT REPORTS",1,VALUE)
"RTN","ORWTPO",90,0)
 Q
"RTN","ORWU")
0^75^B58776444
"RTN","ORWU",1,0)
ORWU ; SLC/KCM - General Utilites for Windows Calls; 2/28/01 [10/6/03 10:38am]
"RTN","ORWU",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,132,148,149,187,195**;Dec 17, 1997
"RTN","ORWU",3,0)
 ;
"RTN","ORWU",4,0)
DT(Y,X,%DT) ; Internal Fileman Date/Time
"RTN","ORWU",5,0)
 ; change '00:00' so if passed, Fileman doesn't reject
"RTN","ORWU",6,0)
 I $L($P(X,"@",2)),("00000000"[$TR($P(X,"@",2),":","")) S $P(X,"@",2)="00:00:01"
"RTN","ORWU",7,0)
 S %DT=$G(%DT,"TS") D ^%DT K %DT
"RTN","ORWU",8,0)
 Q
"RTN","ORWU",9,0)
VALDT(Y,X,%DT) ; Validate date/time
"RTN","ORWU",10,0)
 S:'$D(%DT) %DT="TX" D ^%DT
"RTN","ORWU",11,0)
 Q
"RTN","ORWU",12,0)
USERINFO(REC) ; Current user relevant info
"RTN","ORWU",13,0)
 ; return DUZ^NAME^USRCLS^CANSIGN^ISPROVIDER^ORDERROLE^NOORDER^DTIME^
"RTN","ORWU",14,0)
 ;        COUNTDOWN^ENABLEVERIFY^NOTIFYAPPS^MSGHANG^DOMAIN^SERVICE^
"RTN","ORWU",15,0)
 ;        AUTOSAVE^INITTAB^LASTTAB^WEBACCESS^ALLOWHOLD^ISRPL^RPLLIST^
"RTN","ORWU",16,0)
 ;        CORTABS^RPTTAB^STANUM^GECSTATUS^PRODACCT
"RTN","ORWU",17,0)
 N X,ORRPL,ORRPL1,ORRPL2,ORTAB,CORTABS,RPTTAB,ORDT,OREFF,OREXP,ORDATEOK
"RTN","ORWU",18,0)
 S REC=DUZ_U_$P(^VA(200,DUZ,0),U)
"RTN","ORWU",19,0)
 S $P(REC,U,3)=$S($D(^XUSEC("ORES",DUZ)):3,$D(^XUSEC("ORELSE",DUZ)):2,$D(^XUSEC("OREMAS",DUZ)):1,1:0)
"RTN","ORWU",20,0)
 S $P(REC,U,4)=$D(^XUSEC("ORES",DUZ))&$D(^XUSEC("PROVIDER",DUZ))
"RTN","ORWU",21,0)
 S $P(REC,U,5)=$D(^XUSEC("PROVIDER",DUZ))
"RTN","ORWU",22,0)
 S $P(REC,U,6)=$$ORDROLE
"RTN","ORWU",23,0)
 S $P(REC,U,7)=$$GET^XPAR("USR^SYS^PKG","ORWOR DISABLE ORDERING",1,"I")
"RTN","ORWU",24,0)
 S $P(REC,U,8)=$$GET^XPAR("USR^SYS","ORWOR TIMEOUT CHART",1,"I")
"RTN","ORWU",25,0)
 I '$P(REC,U,8),$G(DTIME) S $P(REC,U,8)=DTIME
"RTN","ORWU",26,0)
 S $P(REC,U,9)=$$GET^XPAR("USR^SYS^PKG","ORWOR TIMEOUT COUNTDOWN",1,"I")
"RTN","ORWU",27,0)
 S X=$$GET^XPAR("USR^SYS^PKG","ORWOR ENABLE VERIFY",1,"I")
"RTN","ORWU",28,0)
 S $P(REC,U,10)=$S(X=1:1,X=2:0,1:'$P(REC,U,7))
"RTN","ORWU",29,0)
 S $P(REC,U,11)=$$GET^XPAR("USR^SYS^PKG","ORWOR BROADCAST MESSAGES",1,"I")
"RTN","ORWU",30,0)
 S $P(REC,U,12)=$$GET^XPAR("USR^SYS^PKG","ORWOR AUTO CLOSE PT MSG",1,"I")
"RTN","ORWU",31,0)
 S $P(REC,U,13)=$$KSP^XUPARAM("WHERE")  ; domain
"RTN","ORWU",32,0)
 S $P(REC,U,14)=+$G(^VA(200,DUZ,5))     ; service/section
"RTN","ORWU",33,0)
 S $P(REC,U,15)=$$GET^XPAR("USR^SYS^PKG","ORWOR AUTOSAVE NOTE",1,"I")
"RTN","ORWU",34,0)
 S $P(REC,U,16)=$$GET^XPAR("USR^DIV^SYS^PKG","ORCH INITIAL TAB",1,"I")
"RTN","ORWU",35,0)
 S $P(REC,U,17)=$$GET^XPAR("USR^DIV^SYS^PKG","ORCH USE LAST TAB",1,"I")
"RTN","ORWU",36,0)
 S $P(REC,U,18)=$$GET^XPAR("USR^DIV^SYS^PKG","ORWOR DISABLE WEB ACCESS",1,"I")
"RTN","ORWU",37,0)
 S $P(REC,U,19)=$$GET^XPAR("SYS^PKG","ORWOR DISABLE HOLD ORDERS",1,"I")
"RTN","ORWU",38,0)
 ; 2 pieces added by PKS on 11/5/2001 for "Reports Only:"
"RTN","ORWU",39,0)
 ; IA# 10060 allows read access to ^VA(200 file.
"RTN","ORWU",40,0)
 S ORRPL=$G(^VA(200,DUZ,101))           ; RPL node.
"RTN","ORWU",41,0)
 S ORRPL1=$P(ORRPL,U)
"RTN","ORWU",42,0)
 S $P(REC,U,20)=ORRPL1                  ; ISRPL piece.
"RTN","ORWU",43,0)
 S ORRPL2=$P(ORRPL,U,2)
"RTN","ORWU",44,0)
 S $P(REC,U,21)=ORRPL2                  ; RPLLIST piece.
"RTN","ORWU",45,0)
 ;
"RTN","ORWU",46,0)
 ; More pieces for CPRS tabs access:
"RTN","ORWU",47,0)
 ; IA# 10060 allows read access to ^VA(200.01013 multiple.
"RTN","ORWU",48,0)
 S ORDT=DT                              ; Today.
"RTN","ORWU",49,0)
 S (CORTABS,RPTTAB)=0
"RTN","ORWU",50,0)
 S ORRPL=0
"RTN","ORWU",51,0)
 F  S ORRPL=$O(^VA(200,DUZ,"ORD",ORRPL)) Q:ORRPL<1  D
"RTN","ORWU",52,0)
 .S ORTAB=$G(^VA(200,DUZ,"ORD",ORRPL,0))
"RTN","ORWU",53,0)
 .I ORTAB="" Q
"RTN","ORWU",54,0)
 .S OREFF=$P(ORTAB,U,2)
"RTN","ORWU",55,0)
 .S OREXP=$P(ORTAB,U,3)
"RTN","ORWU",56,0)
 .S ORTAB=$P(ORTAB,U)
"RTN","ORWU",57,0)
 .I ORTAB="" Q
"RTN","ORWU",58,0)
 .S ORTAB=$G(^ORD(101.13,ORTAB,0))
"RTN","ORWU",59,0)
 .I ORTAB="" Q
"RTN","ORWU",60,0)
 .S ORTAB=$P(ORTAB,U)
"RTN","ORWU",61,0)
 .I ORTAB="" Q
"RTN","ORWU",62,0)
 .S ORTAB=$$UP^XLFSTR(ORTAB)
"RTN","ORWU",63,0)
 .S ORDATEOK=1                             ; Default.
"RTN","ORWU",64,0)
 .I ((OREFF="")!(OREFF>ORDT)) S ORDATEOK=0 ; Eff. date NG.
"RTN","ORWU",65,0)
 .I ORDATEOK  D
"RTN","ORWU",66,0)
 ..I OREXP="" Q                            ; No exp. date.
"RTN","ORWU",67,0)
 ..I (OREXP<ORDT) S ORDATEOK=0             ; Exp. date NG.
"RTN","ORWU",68,0)
 ..I (OREXP=ORDT) S ORDATEOK=0             ; Exp. date NG.
"RTN","ORWU",69,0)
 .;
"RTN","ORWU",70,0)
 .; Set TRUE if OK:
"RTN","ORWU",71,0)
 .I ((ORTAB="COR")&(ORDATEOK)) S CORTABS=1
"RTN","ORWU",72,0)
 .I ((ORTAB="RPT")&(ORDATEOK)) S RPTTAB=1
"RTN","ORWU",73,0)
 ;
"RTN","ORWU",74,0)
 ; When done, set all valid tabs for access:
"RTN","ORWU",75,0)
 S $P(REC,U,22)=CORTABS                 ; "Core" tabs.
"RTN","ORWU",76,0)
 S $P(REC,U,23)=RPTTAB                  ; "Reports" tab.
"RTN","ORWU",77,0)
 ;
"RTN","ORWU",78,0)
 S $P(REC,U,24)=$P($$SITE^VASITE,U,3)
"RTN","ORWU",79,0)
 S $P(REC,U,25)=$$GET^XPAR("USR^TEA","PXRM GEC STATUS CHECK",1,"I")
"RTN","ORWU",80,0)
 S $P(REC,U,26)=$$PROD^XUPROD
"RTN","ORWU",81,0)
 Q
"RTN","ORWU",82,0)
 ;
"RTN","ORWU",83,0)
HASKEY(VAL,KEY) ; returns TRUE if user has the security key
"RTN","ORWU",84,0)
 S VAL=''$D(^XUSEC(KEY,DUZ))
"RTN","ORWU",85,0)
 Q
"RTN","ORWU",86,0)
HASOPTN(VAL,OPTION) ; returns TRUE if the user has access to a menu option
"RTN","ORWU",87,0)
 S VAL=+$$ACCESS^XQCHK(DUZ,OPTION)
"RTN","ORWU",88,0)
 I VAL'>0 S VAL=0
"RTN","ORWU",89,0)
 E  S VAL=1
"RTN","ORWU",90,0)
 Q
"RTN","ORWU",91,0)
NPHASKEY(VAL,NP,KEY)    ; returns TRUE if the person has the security key
"RTN","ORWU",92,0)
 S VAL=''$D(^XUSEC(KEY,NP))
"RTN","ORWU",93,0)
 Q
"RTN","ORWU",94,0)
ORDROLE()    ; returns person's role in ordering
"RTN","ORWU",95,0)
 ; VAL: 0=nokey, 1=clerk, 2=nurse, 3=physician, 4=student, 5=bad keys
"RTN","ORWU",96,0)
 ;I '$G(ORWCLVER) Q 0  ; version of client is to old for ordering
"RTN","ORWU",97,0)
 I ($D(^XUSEC("OREMAS",DUZ))+$D(^XUSEC("ORELSE",DUZ))+$D(^XUSEC("ORES",DUZ)))>1 Q 5
"RTN","ORWU",98,0)
 I $D(^XUSEC("OREMAS",DUZ)) Q 1                           ; clerk
"RTN","ORWU",99,0)
 I $D(^XUSEC("ORELSE",DUZ)) Q 2                           ; nurse
"RTN","ORWU",100,0)
 I $D(^XUSEC("ORES",DUZ)),$D(^XUSEC("PROVIDER",DUZ)) Q 3  ; doctor
"RTN","ORWU",101,0)
 I $D(^XUSEC("PROVIDER",DUZ)) Q 4                         ; student
"RTN","ORWU",102,0)
 Q 0
"RTN","ORWU",103,0)
VALIDSIG(ESOK,X) ; returns TRUE if valid electronic sig.
"RTN","ORWU",104,0)
 S X=$$DECRYP^XUSRB1(X),ESOK=0                   ; network encrypted
"RTN","ORWU",105,0)
 D HASH^XUSHSHP
"RTN","ORWU",106,0)
 I X=$P($G(^VA(200,+DUZ,20)),U,4) S ESOK=1
"RTN","ORWU",107,0)
 Q
"RTN","ORWU",108,0)
TOOLMENU(ORLST) ; returns a list of items for Tools menu
"RTN","ORWU",109,0)
 N ANENT
"RTN","ORWU",110,0)
 S ANENT="ALL^"_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+$G(^(5)),1:"")
"RTN","ORWU",111,0)
 D GETLST^XPAR(.ORLST,ANENT,"ORWT TOOLS MENU","N")
"RTN","ORWU",112,0)
 Q
"RTN","ORWU",113,0)
ACTLOC(LOC) ; Function: returns TRUE if active hospital loc.
"RTN","ORWU",114,0)
 ; IA# 10040:
"RTN","ORWU",115,0)
 N D0,X I +$G(^SC(LOC,"OOS")) Q 0                ; screen out OOS entry
"RTN","ORWU",116,0)
 S D0=+$G(^SC(LOC,42)) I D0 D WIN^DGPMDDCF Q 'X  ; chk out of svc wards
"RTN","ORWU",117,0)
 S X=$G(^SC(LOC,"I")) I +X=0 Q 1                 ; no inactivate date
"RTN","ORWU",118,0)
 I DT>$P(X,U)&($P(X,U,2)=""!(DT<$P(X,U,2))) Q 0  ; chk reactivate date
"RTN","ORWU",119,0)
 Q 1                                             ; must still be active
"RTN","ORWU",120,0)
 ;
"RTN","ORWU",121,0)
CLINLOC(Y,FROM,DIR) ; Return set of clinics from HOSPITAL LOCATION
"RTN","ORWU",122,0)
 ; .Y=returned list, FROM=text to $O from, DIR=$O direction,
"RTN","ORWU",123,0)
 N I,IEN,CNT S I=0,CNT=44
"RTN","ORWU",124,0)
 F  Q:I'<CNT  S FROM=$O(^SC("B",FROM),DIR) Q:FROM=""  D  ; IA# 10040.
"RTN","ORWU",125,0)
 . S IEN="" F  S IEN=$O(^SC("B",FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWU",126,0)
 . . I ($P($G(^SC(IEN,0)),U,3)'="C")!('$$ACTLOC(IEN)) Q
"RTN","ORWU",127,0)
 . . S I=I+1,Y(I)=IEN_"^"_FROM
"RTN","ORWU",128,0)
 Q
"RTN","ORWU",129,0)
INPLOC(Y,FROM,DIR) ;Return set of wards from HOSPITAL LOCATION
"RTN","ORWU",130,0)
 ; .Y=returned list, FROM=text to $O from, DIR=$O direction,
"RTN","ORWU",131,0)
 N I,IEN,CNT S I=0,CNT=44
"RTN","ORWU",132,0)
 F  Q:I'<CNT  S FROM=$O(^SC("B",FROM),DIR) Q:FROM=""  D  ; IA# 10040.
"RTN","ORWU",133,0)
 . S IEN="" F  S IEN=$O(^SC("B",FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWU",134,0)
 . . I ($P($G(^SC(IEN,0)),U,3)'="W") Q
"RTN","ORWU",135,0)
 . . I '$$ACTLOC(IEN) Q
"RTN","ORWU",136,0)
 . . S I=I+1,Y(I)=IEN_"^"_FROM
"RTN","ORWU",137,0)
 Q
"RTN","ORWU",138,0)
HOSPLOC(Y,FROM,DIR) ; Return set of locations from HOSPITAL LOCATION
"RTN","ORWU",139,0)
 ; .Y=returned list, FROM=text to $O from, DIR=$O direction,
"RTN","ORWU",140,0)
 N I,IEN,CNT S I=0,CNT=44
"RTN","ORWU",141,0)
 F  Q:I'<CNT  S FROM=$O(^SC("B",FROM),DIR) Q:FROM=""  D  ; IA# 10040.
"RTN","ORWU",142,0)
 . S IEN="" F  S IEN=$O(^SC("B",FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWU",143,0)
 . . I '$$ACTLOC(IEN) Q
"RTN","ORWU",144,0)
 . . S I=I+1,Y(I)=IEN_"^"_FROM
"RTN","ORWU",145,0)
 Q
"RTN","ORWU",146,0)
NEWPERS(ORY,ORFROM,ORDIR,ORKEY,ORDATE,ORALLUSE,ORVIZ) ; Return set of names from the NEW PERSON file.
"RTN","ORWU",147,0)
 ; SLC/PKS: Code moved to ORWU1 on 12/3/2002.
"RTN","ORWU",148,0)
 D NP1^ORWU1
"RTN","ORWU",149,0)
 Q
"RTN","ORWU",150,0)
GBLREF(VAL,FN) ; return global reference for file #
"RTN","ORWU",151,0)
 S VAL="" Q:'FN
"RTN","ORWU",152,0)
 S VAL=$$ROOT^DILFD(+FN)
"RTN","ORWU",153,0)
 ; I $E($RE(VAL))="," S VAL=$E(VAL,1,$L(VAL)-1)_")"
"RTN","ORWU",154,0)
 ; I $E($RE(VAL))="(" S VAL=$P(VAL,"(",1) 
"RTN","ORWU",155,0)
 Q
"RTN","ORWU",156,0)
GENERIC(Y,FROM,DIR,REF) ; Return a set of entries from xref in REF
"RTN","ORWU",157,0)
 ; .Y=returned list, FROM=text to $O from, DIR=$O direction,
"RTN","ORWU",158,0)
 N I,IEN,CNT S I=0,CNT=44
"RTN","ORWU",159,0)
 F  Q:I'<CNT  S FROM=$O(@REF@(FROM),DIR) Q:FROM=""  D
"RTN","ORWU",160,0)
 . S IEN="" F  S IEN=$O(@REF@(FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWU",161,0)
 . . S I=I+1,Y(I)=IEN_"^"_FROM
"RTN","ORWU",162,0)
 Q
"RTN","ORWU",163,0)
EXTNAME(VAL,IEN,FN) ; return external form of pointer
"RTN","ORWU",164,0)
 ; IEN=internal number, FN=file number
"RTN","ORWU",165,0)
 N REF S REF=$G(^DIC(FN,0,"GL")),VAL=""
"RTN","ORWU",166,0)
 I $L(REF),+IEN S VAL=$P($G(@(REF_IEN_",0)")),U)
"RTN","ORWU",167,0)
 Q
"RTN","ORWU",168,0)
PARAM(VAL,APARAM)       ; return parameter value for a user
"RTN","ORWU",169,0)
 ; call assumes current user, default entities, single instance
"RTN","ORWU",170,0)
 S VAL=$$GET^XPAR("ALL",APARAM,1,"I")
"RTN","ORWU",171,0)
 Q
"RTN","ORWU",172,0)
DEVICE(Y,FROM,DIR) ; Return subset of entries from the Device file
"RTN","ORWU",173,0)
 ; .LST(n)=IEN;Name^DisplayName^Location^RMar^PLen
"RTN","ORWU",174,0)
 ; FROM=text to $O from, DIR=$O direction
"RTN","ORWU",175,0)
 N I,IEN,CNT,SHOW,X S I=0,CNT=20
"RTN","ORWU",176,0)
 I FROM["<" S FROM=$RE($P($RE(FROM),"<  ",2))
"RTN","ORWU",177,0)
 F  Q:I'<CNT  S FROM=$O(^%ZIS(1,"B",FROM),DIR) Q:FROM=""  D
"RTN","ORWU",178,0)
 . S IEN=0 F  S IEN=$O(^%ZIS(1,"B",FROM,IEN)) Q:'IEN  D
"RTN","ORWU",179,0)
 .. N X0,X1,X90,X91,X95,XTYPE,XSTYPE,XTIME,%A,%X,POP
"RTN","ORWU",180,0)
 .. Q:'$D(^%ZIS(1,IEN,0))  S X0=^(0),X1=$G(^(1)),X90=$G(^(90)),X91=$G(^(91)),X95=$G(^(95)),XSTYPE=$G(^("SUBTYPE")),XTIME=$G(^("TIME")),XTYPE=$G(^("TYPE"))
"RTN","ORWU",181,0)
 .. I $E($G(^%ZIS(2,+XSTYPE,0)))'="P" Q  ;Printers only
"RTN","ORWU",182,0)
 .. S X=$P(XTYPE,"^") I X'="TRM",X'="HG",X'="HFS",X'="CHAN" Q  ;Device Types
"RTN","ORWU",183,0)
 .. S X=X0 I ($P(X,U,2)="0")!($P(X,U,12)=2) Q  ;Queuing allowed
"RTN","ORWU",184,0)
 .. S X=+X90 I X,(X'>DT) Q  ;Out of Service
"RTN","ORWU",185,0)
 .. I XTIME]"" S %A=$P(XTIME,"^"),%X=$P($H,",",2),%=%X\60#60+(%X\3600*100),%X=$P(%A,"-",2) I %X'<%A&(%'>%X&(%'<%A))!(%X<%A&(%'<%A!(%'>%X))) Q  ;Prohibited Times
"RTN","ORWU",186,0)
 .. S POP=0
"RTN","ORWU",187,0)
 .. I X95]"" S %X=$G(DUZ(0)) I %X'="@" S POP=1 F %A=1:1:$L(%X) I X95[$E(%X,%A) S POP=0 Q
"RTN","ORWU",188,0)
 .. Q:POP  ;Security check
"RTN","ORWU",189,0)
 .. S SHOW=$P(X0,U) I SHOW'=FROM S SHOW=FROM_"  <"_SHOW_">"
"RTN","ORWU",190,0)
 .. S I=I+1,Y(I)=IEN_";"_$P(X0,U)_U_SHOW_U_$P(X1,U)_U_$P(X91,U)_U_$P(X91,U,3)
"RTN","ORWU",191,0)
 Q
"RTN","ORWU",192,0)
URGENCY(Y) ; -- retrieve set values from dd for discharge summary urgency
"RTN","ORWU",193,0)
 N ORDD,I,X
"RTN","ORWU",194,0)
 D FIELD^DID(8925,.09,"","POINTER","ORDD")
"RTN","ORWU",195,0)
 F I=1:1 S X=$P(ORDD("POINTER"),";",I) Q:X=""   S Y(I)=$TR(X,":","^")
"RTN","ORWU",196,0)
 Q
"RTN","ORWU",197,0)
PATCH(VAL,X) ; Return 1 if patch X is installed
"RTN","ORWU",198,0)
 S VAL=$$PATCH^XPDUTL(X)
"RTN","ORWU",199,0)
 Q
"RTN","ORWU",200,0)
VERSRV(VAL,X,CLVER)   ; Return server version of option name
"RTN","ORWU",201,0)
 S ORWCLVER=$G(CLVER)  ; leave in partition for session
"RTN","ORWU",202,0)
 N BADVAL,ORLST
"RTN","ORWU",203,0)
 D FIND^DIC(19,"",1,"X",X,1,,,,"ORLST")
"RTN","ORWU",204,0)
 I 'ORLST("DILIST",0) S VAL="0.0.0.0" Q
"RTN","ORWU",205,0)
 S VAL=ORLST("DILIST","ID",1,1)
"RTN","ORWU",206,0)
 S VAL=$P(VAL,"version ",2)
"RTN","ORWU",207,0)
 S BADVAL=0
"RTN","ORWU",208,0)
 I $P(VAL,".",1)="" S BADVAL=1
"RTN","ORWU",209,0)
 I $P(VAL,".",2)="" S BADVAL=1
"RTN","ORWU",210,0)
 I $P(VAL,".",3)="" S BADVAL=1
"RTN","ORWU",211,0)
 I $P(VAL,".",4)="" S BADVAL=1
"RTN","ORWU",212,0)
 I ((BADVAL)!('VAL)!(VAL="")) S VAL="0.0.0.0"
"RTN","ORWU",213,0)
 ;N IEN S VAL="",IEN=$O(^DIC(19,"B",X,0)) Q:'IEN
"RTN","ORWU",214,0)
 ;S VAL=$P($P($G(^DIC(19,IEN,0)),U,2),"version ",2)
"RTN","ORWU",215,0)
 Q
"RTN","ORWU1")
0^16^B50649823
"RTN","ORWU1",1,0)
ORWU1 ;SLC/GRE - General Utilities for Windows Calls [2/25/04 11:10am]
"RTN","ORWU1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**149,187,195**;Dec 17, 1997
"RTN","ORWU1",3,0)
 ;
"RTN","ORWU1",4,0)
 Q
"RTN","ORWU1",5,0)
 ;
"RTN","ORWU1",6,0)
NP1 ; Return a set of names from the NEW PERSON file.
"RTN","ORWU1",7,0)
 ; (PKS/8/5/2003: Now called by NEWPERS^ORWU; internal mods made.)
"RTN","ORWU1",8,0)
 ; (Keep GETCOS^ORWTPN up to date with matching logic/code, too.)
"RTN","ORWU1",9,0)
 ;
"RTN","ORWU1",10,0)
 ; PARAMS from NEWPERS^ORWU call:
"RTN","ORWU1",11,0)
 ;  .ORY=returned list.
"RTN","ORWU1",12,0)
 ;  ORDATE=Checks for an active person class on this date (optional).
"RTN","ORWU1",13,0)
 ;  ORDIR=Direction to move through the x-ref with $O.  
"RTN","ORWU1",14,0)
 ;  ORFROM=Starting name for this set.
"RTN","ORWU1",15,0)
 ;  ORKEY=Screen users by security key (optional).
"RTN","ORWU1",16,0)
 ;  ORVIZ=If true, includes RDV users; otherwise not (optional).
"RTN","ORWU1",17,0)
 ;  
"RTN","ORWU1",18,0)
 N ORDD,ORDIV,ORDUP,ORGOOD,ORI,ORIEN1,ORIEN2,ORLAST,ORMAX,ORMRK,ORMULTI,ORPREV,ORSRV,ORTTL
"RTN","ORWU1",19,0)
 ;
"RTN","ORWU1",20,0)
 S ORI=0,ORMAX=44,(ORLAST,ORPREV)="",ORKEY=$G(ORKEY),ORDATE=$G(ORDATE)
"RTN","ORWU1",21,0)
 S ORMULTI=$$ALL^VASITE ; IA# 10112.  Do once at beginning of call.
"RTN","ORWU1",22,0)
 ;
"RTN","ORWU1",23,0)
 ; NP3 tag includes visitors, uses full "B" x-ref.
"RTN","ORWU1",24,0)
 I +$G(ORVIZ)=1 D NP3(0) Q  ; Use alt. version, skip rest.
"RTN","ORWU1",25,0)
 ;
"RTN","ORWU1",26,0)
 F  Q:ORI'<ORMAX  S ORFROM=$O(^VA(200,"AUSER",ORFROM),ORDIR) Q:ORFROM=""  D
"RTN","ORWU1",27,0)
 .S ORIEN1=""
"RTN","ORWU1",28,0)
 .F  S ORIEN1=$O(^VA(200,"AUSER",ORFROM,ORIEN1),ORDIR) Q:'ORIEN1  D
"RTN","ORWU1",29,0)
 ..;
"RTN","ORWU1",30,0)
 ..I $L(ORKEY),'$D(^XUSEC(ORKEY,+ORIEN1)) Q       ; Check for key?
"RTN","ORWU1",31,0)
 ..I ORDATE>0,$$GET^XUA4A72(ORIEN1,ORDATE)<1 Q    ; Check date?
"RTN","ORWU1",32,0)
 ..S ORI=ORI+1,ORY(ORI)=ORIEN1_"^"_$$NAMEFMT^XLFNAME(ORFROM,"F","DcMPC")
"RTN","ORWU1",33,0)
 ..S ORDUP=0                            ; Init flag, check dupe.
"RTN","ORWU1",34,0)
 ..I ($P(ORPREV_" "," ")=$P(ORFROM_" "," ")) S ORDUP=1
"RTN","ORWU1",35,0)
 ..;
"RTN","ORWU1",36,0)
 ..; Append Title if not duplicated:
"RTN","ORWU1",37,0)
 ..I 'ORDUP D
"RTN","ORWU1",38,0)
 ...S ORIEN2=ORIEN1
"RTN","ORWU1",39,0)
 ...D NP4(0)                            ; Get Title. 
"RTN","ORWU1",40,0)
 ...I ORTTL="" Q
"RTN","ORWU1",41,0)
 ...S ORY(ORI)=ORY(ORI)_U_"- "_ORTTL
"RTN","ORWU1",42,0)
 ..;
"RTN","ORWU1",43,0)
 ..; Get data in case of dupes:
"RTN","ORWU1",44,0)
 ..I ORDUP D
"RTN","ORWU1",45,0)
 ...S ORIEN2=ORLAST                     ; Prev IEN for NP2 call.
"RTN","ORWU1",46,0)
 ...;
"RTN","ORWU1",47,0)
 ...; Reset, use previous array element, call for extended data:
"RTN","ORWU1",48,0)
 ...S ORI=ORI-1,ORY(ORI)=$P(ORY(ORI),U)_U_$P(ORY(ORI),U,2)  D NP2
"RTN","ORWU1",49,0)
 ...;
"RTN","ORWU1",50,0)
 ...; Then return to current user for second extended data call:
"RTN","ORWU1",51,0)
 ...S ORIEN2=ORIEN1,ORI=ORI+1  D NP2
"RTN","ORWU1",52,0)
 ..S ORLAST=ORIEN1,ORPREV=ORFROM        ; Reassign vars for next pass.
"RTN","ORWU1",53,0)
 ;
"RTN","ORWU1",54,0)
 Q
"RTN","ORWU1",55,0)
 ;
"RTN","ORWU1",56,0)
NP2 ; Retrieve subset of data for dupes in NP1.
"RTN","ORWU1",57,0)
 ; (Assumes certain vars already set/new'd in calling code.)
"RTN","ORWU1",58,0)
 ;
"RTN","ORWU1",59,0)
 ; Variables used:
"RTN","ORWU1",60,0)
 ;   ORZ    = Memory array storage variable.
"RTN","ORWU1",61,0)
 ;   ORZERR = Error storage for LIST^DIC call.
"RTN","ORWU1",62,0)
 ;
"RTN","ORWU1",63,0)
 N ORZ,ORZERR                           ; Initialize variables.
"RTN","ORWU1",64,0)
 S ORDIV=""                             ; Reset each time.
"RTN","ORWU1",65,0)
 D NP4(1)                               ; Get Title, Service/Section.
"RTN","ORWU1",66,0)
 ;
"RTN","ORWU1",67,0)
 ; For multi-divisional site, get Division if determinable:
"RTN","ORWU1",68,0)
 I ORMULTI D
"RTN","ORWU1",69,0)
 .D LIST^DIC(200.02,","_ORIEN2_",","@;.01;1","QP","","","","","","","ORZ","ORZERR")
"RTN","ORWU1",70,0)
 .S (ORDD,ORGOOD)=0                     ; Initialize variables.
"RTN","ORWU1",71,0)
 .I $P(ORZ("DILIST",0),U)=0 Q           ; Division not listed.
"RTN","ORWU1",72,0)
 .I $P(ORZ("DILIST",0),U)=1 D  Q        ; Only one, so use it.
"RTN","ORWU1",73,0)
 ..S ORDD=$O(ORZ("DILIST",ORDD))        ; Get the node's entry.
"RTN","ORWU1",74,0)
 ..S ORDIV=$P(ORDD,U,2)                 ; Get actual name value.
"RTN","ORWU1",75,0)
 .;
"RTN","ORWU1",76,0)
 .; More than one Division entry, so:
"RTN","ORWU1",77,0)
 .F  S ORDD=$O(ORZ("DILIST",ORDD)) Q:+ORDD=0!'($L(ORDD))  D  Q:ORGOOD
"RTN","ORWU1",78,0)
 ..;
"RTN","ORWU1",79,0)
 ..; See if current entry being processed is "Default" (done if so):
"RTN","ORWU1",80,0)
 ..I $P(ORZ("DILIST",ORDD,0),U,3)["Y" S ORDIV=$P(ORZ("DILIST",ORDD,0),U,2),ORGOOD=1  Q                       ; Division text.
"RTN","ORWU1",81,0)
 ;
"RTN","ORWU1",82,0)
 ; Append new pieces to array string:
"RTN","ORWU1",83,0)
 S ORMRK=""
"RTN","ORWU1",84,0)
 I (ORTTL="")&(ORSRV="")&(ORDIV="")  Q  ; Nothing to append.
"RTN","ORWU1",85,0)
 S ORY(ORI)=ORY(ORI)_U_"- "             ; At least something exists.
"RTN","ORWU1",86,0)
 I (ORTTL'="") S ORY(ORI)=ORY(ORI)_ORTTL,ORMRK=", "       ; Title.
"RTN","ORWU1",87,0)
 I (ORSRV'="") S ORY(ORI)=ORY(ORI)_ORMRK_ORSRV,ORMRK=", " ; Service.
"RTN","ORWU1",88,0)
 I (ORDIV'="") S ORY(ORI)=ORY(ORI)_ORMRK_ORDIV            ; Division.
"RTN","ORWU1",89,0)
 ;
"RTN","ORWU1",90,0)
 Q
"RTN","ORWU1",91,0)
 ;
"RTN","ORWU1",92,0)
NP3(COSFLAG) ; Retrieve diff. data when all users are involved, using "B" x-ref.
"RTN","ORWU1",93,0)
 ;
"RTN","ORWU1",94,0)
 ; COSFLAG=If TRUE, called by ORWTPN.
"RTN","ORWU1",95,0)
 ; (Assumes certain vars already set/new'd in calling code.)
"RTN","ORWU1",96,0)
 ;
"RTN","ORWU1",97,0)
 N ORNODE,COSQUIT
"RTN","ORWU1",98,0)
 S COSQUIT=0 ; Flag used in section for COSFLAG.
"RTN","ORWU1",99,0)
 ;
"RTN","ORWU1",100,0)
 F  Q:ORI'<ORMAX  S ORFROM=$O(^VA(200,"B",ORFROM),ORDIR) Q:ORFROM=""  D
"RTN","ORWU1",101,0)
 .S ORIEN1=""
"RTN","ORWU1",102,0)
 .F  S ORIEN1=$O(^VA(200,"B",ORFROM,ORIEN1),ORDIR) Q:'ORIEN1  D
"RTN","ORWU1",103,0)
 ..;
"RTN","ORWU1",104,0)
 ..; Screen default cosigner if appropriate (ORUSER set in ORWTPN):
"RTN","ORWU1",105,0)
 ..I COSFLAG D
"RTN","ORWU1",106,0)
 ...S COSQUIT=0
"RTN","ORWU1",107,0)
 ...I '$$SCRDFCS^TIULA3(ORUSER,ORIEN1) S COSFLAG=1 Q
"RTN","ORWU1",108,0)
 ...S ORNODE=$P($G(^VA(200,ORIEN1,0)),U)
"RTN","ORWU1",109,0)
 ...I '$L(ORNODE) S COSFLAG=1 Q
"RTN","ORWU1",110,0)
 ..I COSQUIT Q
"RTN","ORWU1",111,0)
 ..;
"RTN","ORWU1",112,0)
 ..I '$$PROVIDER^XUSER(ORIEN1,1) Q                ; Terminated?
"RTN","ORWU1",113,0)
 ..I ORDATE>0,$$GET^XUA4A72(ORIEN1,ORDATE)<1 Q    ; Check date?
"RTN","ORWU1",114,0)
 ..I $L(ORKEY),'$D(^XUSEC(ORKEY,+ORIEN1)) Q       ; Check for key?
"RTN","ORWU1",115,0)
 ..S ORI=ORI+1,ORY(ORI)=ORIEN1_"^"_$$NAMEFMT^XLFNAME(ORFROM,"F","DcMPC")
"RTN","ORWU1",116,0)
 ..S ORDUP=0                           ; Init flag, check duplication.
"RTN","ORWU1",117,0)
 ..I ($P(ORPREV_" "," ")=$P(ORFROM_" "," ")) S ORDUP=1
"RTN","ORWU1",118,0)
 ..;
"RTN","ORWU1",119,0)
 ..; Append Title if not duplicated:
"RTN","ORWU1",120,0)
 ..I 'ORDUP D
"RTN","ORWU1",121,0)
 ...S ORIEN2=ORIEN1
"RTN","ORWU1",122,0)
 ...D NP4(0)                           ; Get Title. 
"RTN","ORWU1",123,0)
 ...I ORTTL="" Q
"RTN","ORWU1",124,0)
 ...S ORY(ORI)=ORY(ORI)_U_"- "_ORTTL
"RTN","ORWU1",125,0)
 ..;
"RTN","ORWU1",126,0)
 ..; Get data in case of dupes:
"RTN","ORWU1",127,0)
 ..I ORDUP D
"RTN","ORWU1",128,0)
 ...S ORIEN2=ORLAST                   ; Set to prev. IEN for NP2.
"RTN","ORWU1",129,0)
 ...;
"RTN","ORWU1",130,0)
 ...; Reset, use previous array element, call for extended data:
"RTN","ORWU1",131,0)
 ...S ORI=ORI-1,ORY(ORI)=$P(ORY(ORI),U)_U_$P(ORY(ORI),U,2)  D NP2
"RTN","ORWU1",132,0)
 ...;
"RTN","ORWU1",133,0)
 ...; Now return to current user for second extended data call:
"RTN","ORWU1",134,0)
 ...S ORIEN2=ORIEN1,ORI=ORI+1  D NP2
"RTN","ORWU1",135,0)
 ..S ORLAST=ORIEN1,ORPREV=ORFROM       ; Reassign vars for next pass.
"RTN","ORWU1",136,0)
 ;
"RTN","ORWU1",137,0)
 Q
"RTN","ORWU1",138,0)
 ;
"RTN","ORWU1",139,0)
NP4(ORSS) ; Retrieve Title or Title and Service/Section.
"RTN","ORWU1",140,0)
 ; (Assumes certain vars already set/new'd in calling code.)
"RTN","ORWU1",141,0)
 ;
"RTN","ORWU1",142,0)
 ; Passed variable ORSS: If true, get Service/Section also.
"RTN","ORWU1",143,0)
 ;
"RTN","ORWU1",144,0)
 S (ORTTL,ORSRV)=""                            ; Init each time.
"RTN","ORWU1",145,0)
 ; DBIA# 4329:
"RTN","ORWU1",146,0)
 S ORTTL=$P($G(^VA(200,ORIEN2,0)),U,9)         ; Get Title pointer.
"RTN","ORWU1",147,0)
 I ORTTL<1 S ORTTL=""                          ; Reset var if none.
"RTN","ORWU1",148,0)
 ; DBIA# 1234:
"RTN","ORWU1",149,0)
 I ORTTL>0 S ORTTL=$G(^DIC(3.1,ORTTL,0))       ; Actual Title value.
"RTN","ORWU1",150,0)
 S ORSS=$G(ORSS)
"RTN","ORWU1",151,0)
 I ORSS D                                      ; Get Service/Section?
"RTN","ORWU1",152,0)
 .; DBIA# 4329:
"RTN","ORWU1",153,0)
 .S ORSRV=$P($G(^VA(200,ORIEN2,5)),U,1)        ; Get S/S pointer.
"RTN","ORWU1",154,0)
 .I ORSRV<1 S ORSRV=""                         ; Reset var if none.
"RTN","ORWU1",155,0)
 .; DBIA# 4330:
"RTN","ORWU1",156,0)
 .I ORSRV>0 S ORSRV=$P($G(^DIC(49,ORSRV,0)),U) ; Actual S/S value.
"RTN","ORWU1",157,0)
 ;
"RTN","ORWU1",158,0)
 Q
"RTN","ORWU1",159,0)
 ;
"RTN","ORWU1",160,0)
NAMECVT(Y,IEN) ; Returns text name(mixed-case) derived from IEN xref.
"RTN","ORWU1",161,0)
 ; GRE/2002
"RTN","ORWU1",162,0)
 ; PKS-12/20/2002 Tag not presently used.
"RTN","ORWU1",163,0)
 ; Y=Returned value, IEN=Internal number
"RTN","ORWU1",164,0)
 N ORNAME
"RTN","ORWU1",165,0)
 S IEN=IEN_","
"RTN","ORWU1",166,0)
 S ORNAME=$$GET1^DIQ(200,IEN,20.2)
"RTN","ORWU1",167,0)
 S Y=$$NAMEFMT^XLFNAME(.ORNAME,"F","DcMPC")
"RTN","ORWU1",168,0)
 Q
"RTN","ORWU1",169,0)
 ;
"RTN","ORWU1",170,0)
DEFDIV(Y) ; Return user's default division, if specified.
"RTN","ORWU1",171,0)
 ;
"RTN","ORWU1",172,0)
 ; Variables used:
"RTN","ORWU1",173,0)
 ;   ORDD   = Default division.
"RTN","ORWU1",174,0)
 ;   ORDIV  = Division holder variable.
"RTN","ORWU1",175,0)
 ;   ORGOOD = Flag for successful default division found.
"RTN","ORWU1",176,0)
 ;   ORIEN  = IEN of user.
"RTN","ORWU1",177,0)
 ;   ORZ    = Memory array storage variable.
"RTN","ORWU1",178,0)
 ;   ORZERR = Error storage for LIST^DIC call.
"RTN","ORWU1",179,0)
 ;   Y      = Returned value.
"RTN","ORWU1",180,0)
 ;
"RTN","ORWU1",181,0)
 N ORDD,ORDIV,ORGOOD,ORIEN,ORZ,ORZERR
"RTN","ORWU1",182,0)
 ;
"RTN","ORWU1",183,0)
 S ORIEN=DUZ,ORDIV=""
"RTN","ORWU1",184,0)
 S Y=0,(ORDD,ORGOOD)=0             ; Initialize variables.
"RTN","ORWU1",185,0)
 ;
"RTN","ORWU1",186,0)
 ; Get list of divisions from NEW PERSON file multiple:
"RTN","ORWU1",187,0)
 D LIST^DIC(200.02,","_ORIEN_",","@;.01;1","QP","","","","","","","ORZ","ORZERR")
"RTN","ORWU1",188,0)
 I $P(ORZ("DILIST",0),U)=0 Q       ; No Divisions listed.
"RTN","ORWU1",189,0)
 ;
"RTN","ORWU1",190,0)
 ; Iterate through list:
"RTN","ORWU1",191,0)
 F  S ORDD=$O(ORZ("DILIST",ORDD)) Q:+ORDD=0!'($L(ORDD))  D  Q:ORGOOD
"RTN","ORWU1",192,0)
 .;
"RTN","ORWU1",193,0)
 .; See if current entry being processed is "Default" (done if so):
"RTN","ORWU1",194,0)
 .I $P(ORZ("DILIST",ORDD,0),U,3)["Y" S ORDIV=$P(ORZ("DILIST",ORDD,0),U,2),ORGOOD=1                      ; Division text.
"RTN","ORWU1",195,0)
 .;
"RTN","ORWU1",196,0)
 I (ORDIV="") Q                    ; Punt if no default division.
"RTN","ORWU1",197,0)
 I $$UP^XLFSTR(ORDIV)="SALT LAKE CITY OIFO" S Y=1
"RTN","ORWU1",198,0)
 ;
"RTN","ORWU1",199,0)
 Q
"RTN","ORWU1",200,0)
 ;
"RTN","ORWU1",201,0)
NEWLOC(Y,ORFROM,DIR) ; Return "CZ" locations from HOSPITAL LOCATION file.
"RTN","ORWU1",202,0)
 ; C=Clinics, Z=Other, screened by $$ACTLOC^ORWU.
"RTN","ORWU1",203,0)
 ; .Y=returned list, ORFROM=text to $O from, DIR=$O direction.
"RTN","ORWU1",204,0)
 N I,IEN,CNT S I=0,CNT=44
"RTN","ORWU1",205,0)
 F  Q:I'<CNT  S ORFROM=$O(^SC("B",ORFROM),DIR) Q:ORFROM=""  D  ; IA# 10040.
"RTN","ORWU1",206,0)
 . S IEN="" F  S IEN=$O(^SC("B",ORFROM,IEN),DIR) Q:'IEN  D
"RTN","ORWU1",207,0)
 . . Q:("CZ"'[$P($G(^SC(IEN,0)),U,3)!('$$ACTLOC^ORWU(IEN)))
"RTN","ORWU1",208,0)
 . . S I=I+1,Y(I)=IEN_"^"_ORFROM
"RTN","ORWU1",209,0)
 Q
"RTN","ORWU1",210,0)
 ;
"RTN","ORX2")
0^71^B11359857
"RTN","ORX2",1,0)
ORX2 ; slc/dcm - OE/RR Patient lock entry points ;4/21/04  09:46
"RTN","ORX2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**16,48,158,168,183,190,195**;Dec 17, 1997
"RTN","ORX2",3,0)
PT1 ;;Entry point to unlock patient when done adding orders - NO LONGER USED
"RTN","ORX2",4,0)
 ;;Required variable ORVP.
"RTN","ORX2",5,0)
 Q:'$D(ORVP)  Q:'$L(ORVP)  Q:ORVP'["DPT("
"RTN","ORX2",6,0)
 D UNLOCK(+ORVP) K ORPTLK,ORELK
"RTN","ORX2",7,0)
 Q
"RTN","ORX2",8,0)
LK ;;Entry point for locking patient when updating orders
"RTN","ORX2",9,0)
 ;;Entry: X=VP to Patient "DFN;DPT("  Exit: Y=1 if lock succeeds
"RTN","ORX2",10,0)
 Q:'$D(X)  Q:'$L(X)  Q:X'["DPT("  Q:'$D(@("^"_$P(X,";",2)_+X_",0)"))
"RTN","ORX2",11,0)
 S Y=$$LOCK(+X) Q:Y
"RTN","ORX2",12,0)
 W !!,$C(7),$P(Y,U,2) D READ
"RTN","ORX2",13,0)
 S Y=0 K X
"RTN","ORX2",14,0)
 Q
"RTN","ORX2",15,0)
ULK ;;Entry point to unlock patient
"RTN","ORX2",16,0)
 ;;Required variable X=VP to patient.
"RTN","ORX2",17,0)
 Q:'$D(X)  Q:'$L(X)  Q:X'["DPT("  Q:'$D(@("^"_$P(X,";",2)_+X_",0)"))
"RTN","ORX2",18,0)
 D UNLOCK(+X)
"RTN","ORX2",19,0)
 Q
"RTN","ORX2",20,0)
 ;
"RTN","ORX2",21,0)
LOCK(DFN) ; -- Lock patient chart (silent)
"RTN","ORX2",22,0)
 ; Returns 1 if successful, or 0^Message if could not get lock
"RTN","ORX2",23,0)
 ;
"RTN","ORX2",24,0)
 Q:'$G(DFN) "0^Invalid patient" N Y,ORLK,NOW,NOW1
"RTN","ORX2",25,0)
 S ORLK=$G(^XTMP("ORPTLK-"_DFN,1)) Q:ORLK=(DUZ_U_$J) 1 ;locked
"RTN","ORX2",26,0)
 L +^XTMP("ORPTLK-"_DFN):1 I '$T S Y="0^"_$S(+ORLK:$P($G(^VA(200,+ORLK,0)),U),1:"Another person")_" is editing orders for this patient." Q Y
"RTN","ORX2",27,0)
 S NOW=$$NOW^XLFDT,NOW1=$$FMADD^XLFDT(NOW,1)
"RTN","ORX2",28,0)
 S ^XTMP("ORPTLK-"_DFN,0)=NOW1_U_NOW_"^CPRS Chart Lock",^(1)=DUZ_U_$J
"RTN","ORX2",29,0)
 Q 1
"RTN","ORX2",30,0)
 ;
"RTN","ORX2",31,0)
UNLOCK(DFN) ; -- Unlock patient chart (silent)
"RTN","ORX2",32,0)
 L -^XTMP("ORPTLK-"_DFN)
"RTN","ORX2",33,0)
 I $G(^XTMP("ORPTLK-"_DFN,1))=(DUZ_U_$J) K ^XTMP("ORPTLK-"_DFN)
"RTN","ORX2",34,0)
 Q
"RTN","ORX2",35,0)
 ;
"RTN","ORX2",36,0)
INC(IFN) ;Increment zero node on file 100.2
"RTN","ORX2",37,0)
 N X,X3,X4
"RTN","ORX2",38,0)
 Q:'$G(IFN) 1 Q:$D(^OR(100.2,IFN)) 1
"RTN","ORX2",39,0)
 L +^OR(100.2,0):5 I '$T Q 0
"RTN","ORX2",40,0)
 S:'$D(^OR(100.2,0)) ^(0)="OE/RR PATIENT^100.2P" S X=^(0)
"RTN","ORX2",41,0)
 S X4=+$P(X,U,4)+1,X3=$S(IFN>$P(X,U,3):IFN,1:$P(X,U,3))
"RTN","ORX2",42,0)
 S $P(^OR(100.2,0),U,3,4)=X3_U_X4
"RTN","ORX2",43,0)
 L -^OR(100.2,0)
"RTN","ORX2",44,0)
 Q 1
"RTN","ORX2",45,0)
 ;
"RTN","ORX2",46,0)
LOCK1(ORDER) ; -- Lock ORDER in file #100
"RTN","ORX2",47,0)
 ; Returns 1 if successful or 0^Message if could not get lock
"RTN","ORX2",48,0)
 ;
"RTN","ORX2",49,0)
 N X,Y,NOW,NOW1 I '$G(ORDER) Q "0^Invalid order number"
"RTN","ORX2",50,0)
 ;DBIA #4001 Private DBIA w CMOP
"RTN","ORX2",51,0)
 I $D(^XTMP("ORLK-"_ORDER,0)),(^(0)["CPRS/CMOP") Q "0^CMOP Transmission"
"RTN","ORX2",52,0)
 L +^OR(100,+ORDER):1 I '$T S X=+$G(^XTMP("ORLK-"_+ORDER,1)),Y="0^"_$S(X:$P($G(^VA(200,X,0)),U),1:"Another person")_" is working on this order." Q Y
"RTN","ORX2",53,0)
 I $P($G(^OR(100,+ORDER,0)),U,12)="I" S Y=+$P($G(^(3)),U,6) I Y,$P($G(^OR(100,Y,3)),U,3)=11 D  Q Y
"RTN","ORX2",54,0)
 . S X=$S($P(^OR(100,Y,3),U,11)=2:"renewal",1:"edit")
"RTN","ORX2",55,0)
 . S Y="0^An unreleased "_X_" exists for this order." L -^OR(100,+ORDER)
"RTN","ORX2",56,0)
 S NOW=$$NOW^XLFDT,NOW1=$$FMADD^XLFDT(NOW,1)
"RTN","ORX2",57,0)
 S ^XTMP("ORLK-"_+ORDER,0)=NOW1_U_NOW_"^CPRS Order Lock",^(1)=DUZ_U_$J
"RTN","ORX2",58,0)
 Q 1
"RTN","ORX2",59,0)
 ;
"RTN","ORX2",60,0)
UNLK1(ORDER) ; -- Unlock ORDER in file #100
"RTN","ORX2",61,0)
 ;DBIA #4001 CMOP
"RTN","ORX2",62,0)
 S ORDER=+ORDER Q:'ORDER
"RTN","ORX2",63,0)
 I $D(^XTMP("ORLK-"_ORDER,0)),(^(0)["CPRS/CMOP") D  Q
"RTN","ORX2",64,0)
 . I $J'=$P($G(^XTMP("ORLK-"_ORDER,1)),U,2) Q
"RTN","ORX2",65,0)
 . L -^OR(100,ORDER) K ^XTMP("ORLK-"_ORDER)
"RTN","ORX2",66,0)
 L +^OR(100,ORDER):1
"RTN","ORX2",67,0)
 I '$T Q
"RTN","ORX2",68,0)
 E  L -^OR(100,ORDER)
"RTN","ORX2",69,0)
 L -^OR(100,ORDER) K ^XTMP("ORLK-"_ORDER)
"RTN","ORX2",70,0)
 Q
"RTN","ORX2",71,0)
 ;
"RTN","ORX2",72,0)
READ ; -- instead of READ^ORUTL
"RTN","ORX2",73,0)
 N X,Y,DIR
"RTN","ORX2",74,0)
 S DIR(0)="EA",DIR("A")="     Press return to continue  "
"RTN","ORX2",75,0)
 D ^DIR
"RTN","ORX2",76,0)
 Q
"RTN","ORX2",77,0)
 ;
"RTN","ORX2",78,0)
LCKEVT(EVT) ;Function atttempts to lock event, added w/patch 194
"RTN","ORX2",79,0)
 N J
"RTN","ORX2",80,0)
 F J=1:1:5 L +^ORE(100.2,EVT,0):1 Q:$T  H 1
"RTN","ORX2",81,0)
 Q $T
"RTN","ORX2",82,0)
 ;
"RTN","ORX2",83,0)
UNLEVT(EVT) ;Unlocks global, added w/patch 195
"RTN","ORX2",84,0)
 L -^ORE(100.2,EVT,0)
"RTN","ORX2",85,0)
 Q
"RTN","ORY195")
0^82^B61714416
"RTN","ORY195",1,0)
ORY195 ;SLCOIFO - Pre and Post-init for patch OR*3*195 [10/4/04 7:21am] ; [1/20/05 9:26am]
"RTN","ORY195",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORY195",3,0)
 ;
"RTN","ORY195",4,0)
PRE ; initiate pre-init processes
"RTN","ORY195",5,0)
 ;
"RTN","ORY195",6,0)
 ; Dump previously-installed param templates w/bad "B" x-ref entries:
"RTN","ORY195",7,0)
 ;
"RTN","ORY195",8,0)
 N DA,DIK
"RTN","ORY195",9,0)
 ;
"RTN","ORY195",10,0)
 S DA=$O(^XTV(8989.52,"B","ORQQ SEARCH RANGE (DIVISION)",0))
"RTN","ORY195",11,0)
 I +DA>0 S DIK="^XTV(8989.52," D ^DIK
"RTN","ORY195",12,0)
 ;
"RTN","ORY195",13,0)
 S DA=$O(^XTV(8989.52,"B","ORQQ SEARCH RANGE (SERVICE)",0))
"RTN","ORY195",14,0)
 I +DA>0 S DIK="^XTV(8989.52," D ^DIK
"RTN","ORY195",15,0)
 ;
"RTN","ORY195",16,0)
 S DA=$O(^XTV(8989.52,"B","ORQQ SEARCH RANGE (SYSTEM)",0))
"RTN","ORY195",17,0)
 I +DA>0 S DIK="^XTV(8989.52," D ^DIK
"RTN","ORY195",18,0)
 ;
"RTN","ORY195",19,0)
 S DA=$O(^XTV(8989.52,"B","ORQQ SEARCH RANGE (USER)",0))
"RTN","ORY195",20,0)
 I +DA>0 S DIK="^XTV(8989.52," D ^DIK
"RTN","ORY195",21,0)
 ;
"RTN","ORY195",22,0)
 Q
"RTN","ORY195",23,0)
 ;
"RTN","ORY195",24,0)
POST ; initiate post-init processes
"RTN","ORY195",25,0)
 ;
"RTN","ORY195",26,0)
 I +$$PATCH^XPDUTL("TIU*1.0*112") D SURGREG
"RTN","ORY195",27,0)
 I +$$PATCH^XPDUTL("OR*3.0*222") D GNRPCS
"RTN","ORY195",28,0)
 I +$$PATCH^XPDUTL("MAG*3.0*7") D MAGRPC1
"RTN","ORY195",29,0)
 I +$$PATCH^XPDUTL("MAG*3.0*37") D MAGRPC2
"RTN","ORY195",30,0)
 D SETIMO
"RTN","ORY195",31,0)
 D PARVAL
"RTN","ORY195",32,0)
 D STUFDTRG
"RTN","ORY195",33,0)
 D MAIL
"RTN","ORY195",34,0)
 D Q^ORY195A ;Queue lab order check routine
"RTN","ORY195",35,0)
 Q
"RTN","ORY195",36,0)
 ;
"RTN","ORY195",37,0)
MAIL ; send bulletin of installation time
"RTN","ORY195",38,0)
 N COUNT,DIFROM,I,START,TEXT,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","ORY195",39,0)
 S COUNT=0,XMDUZ="CPRS PACKAGE",XMTEXT="TEXT("
"RTN","ORY195",40,0)
 S XMSUB="Version "_$P($T(VERSION),";;",2)_" Installed"
"RTN","ORY195",41,0)
 F I="G.CPRS GUI INSTALL@ISC-SLC.VA.GOV",DUZ S XMY(I)=""
"RTN","ORY195",42,0)
 ;
"RTN","ORY195",43,0)
 S X=$P($T(VERSION),";;",2)
"RTN","ORY195",44,0)
 D LINE("Version "_X_" has been installed.")
"RTN","ORY195",45,0)
 D LINE(" ")
"RTN","ORY195",46,0)
 D LINE("Install complete:  "_$$FMTE^XLFDT($$NOW^XLFDT()))
"RTN","ORY195",47,0)
 ;
"RTN","ORY195",48,0)
 D ^XMD
"RTN","ORY195",49,0)
 Q
"RTN","ORY195",50,0)
 ;
"RTN","ORY195",51,0)
LINE(DATA) ; set text into array
"RTN","ORY195",52,0)
 S COUNT=COUNT+1
"RTN","ORY195",53,0)
 S TEXT(COUNT)=DATA
"RTN","ORY195",54,0)
 Q
"RTN","ORY195",55,0)
 ;
"RTN","ORY195",56,0)
SURGREG ; Register TIU SURGERY RPCs if TIU*1.0*112 present
"RTN","ORY195",57,0)
 N MENU,RPC
"RTN","ORY195",58,0)
 S MENU="OR CPRS GUI CHART"
"RTN","ORY195",59,0)
 F RPC="TIU IS THIS A SURGERY?","TIU IDENTIFY SURGERY CLASS","TIU LONG LIST SURGERY TITLES","TIU GET DOCUMENTS FOR REQUEST" D INSERT(MENU,RPC)
"RTN","ORY195",60,0)
 Q
"RTN","ORY195",61,0)
 ;
"RTN","ORY195",62,0)
INSERT(OPTION,RPC) ; Call FM Updater with each RPC
"RTN","ORY195",63,0)
 ; Input  -- OPTION   Option file (#19) Name field (#.01)
"RTN","ORY195",64,0)
 ;           RPC      RPC sub-file (#19.05) RPC field (#.01)
"RTN","ORY195",65,0)
 ; Output -- None
"RTN","ORY195",66,0)
 N FDA,FDAIEN,ERR,DIERR
"RTN","ORY195",67,0)
 S FDA(19,"?1,",.01)=OPTION
"RTN","ORY195",68,0)
 S FDA(19.05,"?+2,?1,",.01)=RPC
"RTN","ORY195",69,0)
 D UPDATE^DIE("E","FDA","FDAIEN","ERR")
"RTN","ORY195",70,0)
 Q
"RTN","ORY195",71,0)
 ;
"RTN","ORY195",72,0)
SETIMO ; Create "CLINIC MEDICATIONS" display group
"RTN","ORY195",73,0)
 N NDATA,DLG,IEN,X
"RTN","ORY195",74,0)
 S (NDATA,DLG,IEN,X)=""
"RTN","ORY195",75,0)
 S NDATA="CLINIC MEDICATIONS^Clin. Meds^C RX^"
"RTN","ORY195",76,0)
 N DIC
"RTN","ORY195",77,0)
 S DIC="^ORD(100.98,",DIC(0)="BX",X=$P(NDATA,U)
"RTN","ORY195",78,0)
 D ^DIC
"RTN","ORY195",79,0)
 I Y'=-1 S ^ORD(100.98,+Y,0)=NDATA Q
"RTN","ORY195",80,0)
 I Y=-1 S DIC(0)="L" D ^DIC
"RTN","ORY195",81,0)
 S DIC(0)="BX" D ^DIC
"RTN","ORY195",82,0)
 S IEN=+Y
"RTN","ORY195",83,0)
 I 'IEN Q
"RTN","ORY195",84,0)
 N DIE,DA,DR
"RTN","ORY195",85,0)
 S DIE="^ORD(100.98,",DA=IEN,DR="2///Clin. Meds;3///C RX"
"RTN","ORY195",86,0)
 D ^DIE
"RTN","ORY195",87,0)
 N DLAYGO
"RTN","ORY195",88,0)
 S DA(1)=$O(^ORD(100.98,"B","PHARMACY",0)) Q:'DA(1)
"RTN","ORY195",89,0)
 S:'$D(^ORD(100.98,DA(1),1,0)) ^(0)="^100.981P^^"
"RTN","ORY195",90,0)
 S DIC="^ORD(100.98,"_DA(1)_",1,",DIC(0)="NLX",DLAYGO=100.98
"RTN","ORY195",91,0)
 S X="CLINIC MEDICATIONS" D ^DIC
"RTN","ORY195",92,0)
 K Y
"RTN","ORY195",93,0)
 Q
"RTN","ORY195",94,0)
PARVAL ;add Clin. Meds display group to SEQUENCE parameter
"RTN","ORY195",95,0)
 N X
"RTN","ORY195",96,0)
 Q:'$D(^ORD(100.98,"B","CLINIC MEDICATIONS"))
"RTN","ORY195",97,0)
 S X=0,X=$O(^ORD(100.98,"B","CLINIC MEDICATIONS",X)) Q:'X  D 
"RTN","ORY195",98,0)
 . D PUT^XPAR("PKG","ORWOR CATEGORY SEQUENCE",69,X)
"RTN","ORY195",99,0)
 Q
"RTN","ORY195",100,0)
 ;
"RTN","ORY195",101,0)
SCH ; -- Adjust admin schedule Help Msg for Non-Std Schedules
"RTN","ORY195",102,0)
 N SCH,I,DG,PKG,IPKG,DLG,PRMT,OR0
"RTN","ORY195",103,0)
 S SCH=+$O(^ORD(101.41,"B","OR GTX SCHEDULE",0)) Q:SCH<1
"RTN","ORY195",104,0)
 F I="I","UD","O","C" S X=+$O(^ORD(100.98,"B",I_" RX",0)) S:X DG(X)=""
"RTN","ORY195",105,0)
 F I="RX","SPLY" S X=+$O(^ORD(100.98,"B",I,0)) S:X DG(X)=""
"RTN","ORY195",106,0)
 F PKG="PSJ","PSO","PSS" D
"RTN","ORY195",107,0)
 . S IPKG=+$O(^DIC(9.4,"C",PKG,0))
"RTN","ORY195",108,0)
 . S DLG=0 F  S DLG=+$O(^ORD(101.41,"APKG",IPKG,DLG)) Q:DLG<1  D
"RTN","ORY195",109,0)
 .. S OR0=$G(^ORD(101.41,DLG,0)) Q:$P(OR0,U,4)'="D"  Q:'$D(DG($P(OR0,U,5)))
"RTN","ORY195",110,0)
 .. S PRMT=+$O(^ORD(101.41,DLG,10,"D",SCH,0)) Q:PRMT<1
"RTN","ORY195",111,0)
 .. S ^ORD(101.41,DLG,10,PRMT,1)="Enter a standard administration schedule."
"RTN","ORY195",112,0)
 Q
"RTN","ORY195",113,0)
 ;
"RTN","ORY195",114,0)
STUFDTRG ; Stuff existing date ranges into new parameters for CS and PCE.
"RTN","ORY195",115,0)
 ;
"RTN","ORY195",116,0)
 ; Get existing settings, stuff into new parameters.
"RTN","ORY195",117,0)
 ;
"RTN","ORY195",118,0)
 ; NOTE: ORQQCSDR params will allow "T, T+, T- settings.
"RTN","ORY195",119,0)
 ;       ORQQEAPT params allow single value number entries only.
"RTN","ORY195",120,0)
 ;
"RTN","ORY195",121,0)
 N ORBE,ORBX,ORBZ,ORDUZ,ORERR,ORLST,ORNEG,ORSTART,ORSTOP,ORVAL
"RTN","ORY195",122,0)
 ;
"RTN","ORY195",123,0)
 ; First deal with PKG level settings.
"RTN","ORY195",124,0)
 ;
"RTN","ORY195",125,0)
 ; Clean out any existing settings:
"RTN","ORY195",126,0)
 D NDEL^XPAR("PKG","ORQQEAPT ENC APPT START",.ORERR)
"RTN","ORY195",127,0)
 D NDEL^XPAR("PKG","ORQQEAPT ENC APPT STOP",.ORERR)
"RTN","ORY195",128,0)
 D NDEL^XPAR("PKG","ORQQCSDR CS RANGE START",.ORERR)
"RTN","ORY195",129,0)
 D NDEL^XPAR("PKG","ORQQCSDR CS RANGE STOP",.ORERR)
"RTN","ORY195",130,0)
 ;
"RTN","ORY195",131,0)
 ; Get settings of previously-used high level params:
"RTN","ORY195",132,0)
 S ORSTART=$$GET^XPAR("DIV^SYS^PKG","ORQQVS SEARCH RANGE START",1,"I")
"RTN","ORY195",133,0)
 I '$L(ORSTART) S ORSTART=90
"RTN","ORY195",134,0)
 S ORSTOP=$$GET^XPAR("DIV^SYS^PKG","ORQQAP SEARCH RANGE STOP",1,"I")
"RTN","ORY195",135,0)
 I '$L(ORSTOP) S ORSTOP=90
"RTN","ORY195",136,0)
 ;
"RTN","ORY195",137,0)
 ; Stuff retrieved values into PKG level of first set of new params:
"RTN","ORY195",138,0)
 D EN^XPAR("PKG","ORQQCSDR CS RANGE START",1,ORSTART)
"RTN","ORY195",139,0)
 D EN^XPAR("PKG","ORQQCSDR CS RANGE STOP",1,ORSTOP)
"RTN","ORY195",140,0)
 ;
"RTN","ORY195",141,0)
 ; Treat "start" value and stuff it:
"RTN","ORY195",142,0)
 S ORVAL=ORSTART,ORNEG=0
"RTN","ORY195",143,0)
 I ORVAL["T" S ORVAL=$P(ORVAL,"T",2)
"RTN","ORY195",144,0)
 I ORVAL["t" S ORVAL=$P(ORVAL,"t",2)
"RTN","ORY195",145,0)
 I ORVAL["-" S ORNEG=1,ORVAL=$P(ORVAL,"-",2)
"RTN","ORY195",146,0)
 I ORVAL["+" S ORVAL=$P(ORVAL,"+",2)
"RTN","ORY195",147,0)
 S ORVAL=+ORVAL
"RTN","ORY195",148,0)
 I 'ORNEG S ORVAL=0 ; Can't have later than "Today" for "start."
"RTN","ORY195",149,0)
 D EN^XPAR("PKG","ORQQEAPT ENC APPT START",1,ORVAL)
"RTN","ORY195",150,0)
 ;
"RTN","ORY195",151,0)
 ; Treat "stop" value and stuff it:
"RTN","ORY195",152,0)
 S ORVAL=ORSTOP,ORNEG=0
"RTN","ORY195",153,0)
 I ORVAL["T" S ORVAL=$P(ORVAL,"T",2)
"RTN","ORY195",154,0)
 I ORVAL["t" S ORVAL=$P(ORVAL,"t",2)
"RTN","ORY195",155,0)
 I ORVAL["-" S ORNEG=1,ORVAL=$P(ORVAL,"-",2)
"RTN","ORY195",156,0)
 I ORVAL["+" S ORVAL=$P(ORVAL,"+",2)
"RTN","ORY195",157,0)
 S ORVAL=+ORVAL
"RTN","ORY195",158,0)
 I ORNEG S ORVAL=0 ; Won't allow earlier than "Today" for "stop."
"RTN","ORY195",159,0)
 D EN^XPAR("PKG","ORQQEAPT ENC APPT STOP",1,ORSTOP)
"RTN","ORY195",160,0)
 ;
"RTN","ORY195",161,0)
 ; Deal with User level settings.
"RTN","ORY195",162,0)
 ;
"RTN","ORY195",163,0)
 S (ORBE,ORBX,ORBZ,ORDUZ,ORERR,ORLST,ORNEG,ORVAL)=""
"RTN","ORY195",164,0)
 ;
"RTN","ORY195",165,0)
 ; Begin with the START parameter:
"RTN","ORY195",166,0)
 D ENVAL^XPAR(.ORLST,"ORQQAP SEARCH RANGE START",1,.ORERR)
"RTN","ORY195",167,0)
 I 'ORERR,$G(ORLST)>0 D
"RTN","ORY195",168,0)
 .F ORBX=1:1:ORLST S ORBE=$O(ORLST(ORBE)) D
"RTN","ORY195",169,0)
 ..S ORBZ=$P(ORBE,";",2)
"RTN","ORY195",170,0)
 ..I ORBZ="VA(200," S ORDUZ=$P(ORBE,";") I $L($G(ORDUZ)) D
"RTN","ORY195",171,0)
 ...S ORVAL=ORLST(ORBE,1) ; Current setting.
"RTN","ORY195",172,0)
 ...;
"RTN","ORY195",173,0)
 ...; Eliminate any existing entries:
"RTN","ORY195",174,0)
 ...D NDEL^XPAR("USR.`"_ORDUZ,"ORQQCSDR CS RANGE START",.ORERR)
"RTN","ORY195",175,0)
 ...;
"RTN","ORY195",176,0)
 ...; Stuff value:
"RTN","ORY195",177,0)
 ...D EN^XPAR("USR.`"_ORDUZ,"ORQQCSDR CS RANGE START",1,ORVAL)
"RTN","ORY195",178,0)
 ...;
"RTN","ORY195",179,0)
 ...; Treat value:
"RTN","ORY195",180,0)
 ...S ORNEG=0
"RTN","ORY195",181,0)
 ...I ORVAL["T" S ORVAL=$P(ORVAL,"T",2)
"RTN","ORY195",182,0)
 ...I ORVAL["t" S ORVAL=$P(ORVAL,"t",2)
"RTN","ORY195",183,0)
 ...I ORVAL["-" S ORNEG=1,ORVAL=$P(ORVAL,"-",2)
"RTN","ORY195",184,0)
 ...I ORVAL["+" S ORVAL=$P(ORVAL,"+",2)
"RTN","ORY195",185,0)
 ...S ORVAL=+ORVAL
"RTN","ORY195",186,0)
 ...I 'ORNEG S ORVAL=0 ; Can't have later than "Today" for "start."
"RTN","ORY195",187,0)
 ...;
"RTN","ORY195",188,0)
 ...; Eliminate any existing entries:
"RTN","ORY195",189,0)
 ...D NDEL^XPAR("USR.`"_ORDUZ,"ORQQEAPT ENC APPT START",.ORERR)
"RTN","ORY195",190,0)
 ...;
"RTN","ORY195",191,0)
 ...; Stuff value:
"RTN","ORY195",192,0)
 ...D EN^XPAR("USR.`"_ORDUZ,"ORQQEAPT ENC APPT START",1,ORVAL)
"RTN","ORY195",193,0)
 ;
"RTN","ORY195",194,0)
 ; Now do the STOP parameter:
"RTN","ORY195",195,0)
 S (ORBE,ORBX,ORBZ,ORDUZ,ORERR,ORLST,ORNEG,ORVAL)=""
"RTN","ORY195",196,0)
 ;
"RTN","ORY195",197,0)
 D ENVAL^XPAR(.ORLST,"ORQQVS SEARCH RANGE STOP",1,.ORERR)
"RTN","ORY195",198,0)
 I 'ORERR,$G(ORLST)>0 D
"RTN","ORY195",199,0)
 .F ORBX=1:1:ORLST S ORBE=$O(ORLST(ORBE)) D
"RTN","ORY195",200,0)
 ..S ORBZ=$P(ORBE,";",2)
"RTN","ORY195",201,0)
 ..I ORBZ="VA(200," S ORDUZ=$P(ORBE,";") I $L($G(ORDUZ)) D
"RTN","ORY195",202,0)
 ...S ORVAL=ORLST(ORBE,1) ; Current setting.
"RTN","ORY195",203,0)
 ...;
"RTN","ORY195",204,0)
 ...; Eliminate any existing entries:
"RTN","ORY195",205,0)
 ...D NDEL^XPAR("USR.`"_ORDUZ,"ORQQCSDR CS RANGE STOP",.ORERR)
"RTN","ORY195",206,0)
 ...;
"RTN","ORY195",207,0)
 ...; Stuff value:
"RTN","ORY195",208,0)
 ...D EN^XPAR("USR.`"_ORDUZ,"ORQQCSDR CS RANGE STOP",1,ORVAL)
"RTN","ORY195",209,0)
 ...;
"RTN","ORY195",210,0)
 ...; Treat parameter value:
"RTN","ORY195",211,0)
 ...S ORNEG=0
"RTN","ORY195",212,0)
 ...I ORVAL["T" S ORVAL=$P(ORVAL,"T",2)
"RTN","ORY195",213,0)
 ...I ORVAL["t" S ORVAL=$P(ORVAL,"t",2)
"RTN","ORY195",214,0)
 ...I ORVAL["-" S ORNEG=1,ORVAL=$P(ORVAL,"-",2)
"RTN","ORY195",215,0)
 ...I ORVAL["+" S ORVAL=$P(ORVAL,"+",2)
"RTN","ORY195",216,0)
 ...S ORVAL=+ORVAL
"RTN","ORY195",217,0)
 ...I ORNEG S ORVAL=0 ; Can't have earlier than "Today" for "stop."
"RTN","ORY195",218,0)
 ...;
"RTN","ORY195",219,0)
 ...; Eliminate any existing entries:
"RTN","ORY195",220,0)
 ...D NDEL^XPAR("USR.`"_ORDUZ,"ORQQEAPT ENC APPT STOP",.ORERR)
"RTN","ORY195",221,0)
 ...;
"RTN","ORY195",222,0)
 ...; Stuff value:
"RTN","ORY195",223,0)
 ...D EN^XPAR("USR.`"_ORDUZ,"ORQQEAPT ENC APPT STOP",1,ORVAL)
"RTN","ORY195",224,0)
 ;
"RTN","ORY195",225,0)
 Q
"RTN","ORY195",226,0)
 ;
"RTN","ORY195",227,0)
GNRPCS ;
"RTN","ORY195",228,0)
 N MENU,I
"RTN","ORY195",229,0)
 S MENU="OR CPRS GUI CHART"
"RTN","ORY195",230,0)
 F I="ORWGN GNLOC","ORWGN AUTHUSR" D INSERT(MENU,I)
"RTN","ORY195",231,0)
 Q
"RTN","ORY195",232,0)
 ;
"RTN","ORY195",233,0)
MAGRPC1 ;  Register Imaging RPC if MAG*3.0*7 present (DBIA 4526)
"RTN","ORY195",234,0)
 D INSERT("OR CPRS GUI CHART","MAG4 REMOTE IMPORT")
"RTN","ORY195",235,0)
 Q
"RTN","ORY195",236,0)
 ;
"RTN","ORY195",237,0)
MAGRPC2 ; Register Imaging RPCS if MAG*3.0*37 installed (DBIA 4528/4530)
"RTN","ORY195",238,0)
 D INSERT("OR CPRS GUI CHART","MAG IMPORT CHECK STATUS")
"RTN","ORY195",239,0)
 D INSERT("OR CPRS GUI CHART","MAG IMPORT CLEAR STATUS")
"RTN","ORY195",240,0)
 Q
"RTN","ORY195",241,0)
 ;
"RTN","ORY195",242,0)
VERSION ;;25.28
"RTN","ORY195A")
0^83^B17796256
"RTN","ORY195A",1,0)
ORY195A ;SLC/DAN Post-install for patch 195 ;10/7/04  11:49
"RTN","ORY195A",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORY195A",3,0)
 ;
"RTN","ORY195A",4,0)
 ;DBIA SECTION
"RTN","ORY195A",5,0)
 ;10063 - %ZTLOAD
"RTN","ORY195A",6,0)
 ;10141 - XPDUTL
"RTN","ORY195A",7,0)
 ;10070 - XMD
"RTN","ORY195A",8,0)
 ;10035 - ^DPT("CN" references
"RTN","ORY195A",9,0)
 ;10061 - VADPT
"RTN","ORY195A",10,0)
 ;
"RTN","ORY195A",11,0)
Q ;Entry point to queue process during install
"RTN","ORY195A",12,0)
 N ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSK
"RTN","ORY195A",13,0)
 S ZTRTN="DQ^ORY195A",ZTDESC="OR*3*195 LAB CHILD ORDER CHECK ROUTINE",ZTIO="",ZTDTH=$H
"RTN","ORY195A",14,0)
 D ^%ZTLOAD I '$G(ZTSK) D BMES^XPDUTL("POST INSTALL NOT QUEUED - RUN DQ^ORY195A AFTER INSTALL FINISHES") Q
"RTN","ORY195A",15,0)
 D BMES^XPDUTL("Lab Child Order Check queued as task # "_$G(ZTSK))
"RTN","ORY195A",16,0)
 Q
"RTN","ORY195A",17,0)
 ;
"RTN","ORY195A",18,0)
DQ ;
"RTN","ORY195A",19,0)
 D SRCH,MAIL
"RTN","ORY195A",20,0)
 Q
"RTN","ORY195A",21,0)
 ;
"RTN","ORY195A",22,0)
SRCH ;Search for lab orders without locations
"RTN","ORY195A",23,0)
 N LAB,LOC,IEN,CHD,ORD,SUB,ORLIST
"RTN","ORY195A",24,0)
 K ^TMP($J,"TEXT"),^TMP($J,"ERR")
"RTN","ORY195A",25,0)
 S LAB=$O(^ORD(100.98,"B","LAB",0)) Q:'+LAB  ;quit if no lab display group
"RTN","ORY195A",26,0)
 S LOC="" F  S LOC=$O(^DPT("CN",LOC)) Q:LOC=""  S IEN=0 F  S IEN=$O(^DPT("CN",LOC,IEN)) Q:'+IEN  D
"RTN","ORY195A",27,0)
 .K ^TMP("ORR",$J)
"RTN","ORY195A",28,0)
 .D EN^ORQ1(IEN_";DPT(",LAB,2) ;Get active lab orders
"RTN","ORY195A",29,0)
 .S SUB=0 F  S SUB=$O(^TMP("ORR",$J,ORLIST,SUB)) Q:'+SUB  S ORD=+^(SUB) I $D(^OR(100,ORD,2)) D
"RTN","ORY195A",30,0)
 ..I '$P(^OR(100,ORD,0),U,17) Q  ;Quit if not delayed order
"RTN","ORY195A",31,0)
 ..S CHD=0 F  S CHD=$O(^OR(100,ORD,2,CHD)) Q:'+CHD  I $P(^OR(100,CHD,0),U,10)="" S ^TMP($J,"ERR",LOC,CHD)=+$P(^OR(100,CHD,0),U,2)
"RTN","ORY195A",32,0)
 K ^TMP("ORR",$J),^TMP($J,"TEXT")
"RTN","ORY195A",33,0)
 Q
"RTN","ORY195A",34,0)
 ;
"RTN","ORY195A",35,0)
MAIL ;Send message with findings
"RTN","ORY195A",36,0)
 N CNT,XMSUB,XMTEXT,XMDUZ,XMY,XMZ,LOC,ORD,DFN,VADM
"RTN","ORY195A",37,0)
 S CNT=1
"RTN","ORY195A",38,0)
 S ^TMP($J,"TEXT",CNT)="The search for active lab orders without a location has finished.",CNT=CNT+1
"RTN","ORY195A",39,0)
 S ^TMP($J,"TEXT",CNT)="",CNT=CNT+1
"RTN","ORY195A",40,0)
 I '$D(^TMP($J,"ERR")) S ^TMP($J,"TEXT",CNT)="No problems were found so no additional work is required.",CNT=CNT+1
"RTN","ORY195A",41,0)
 I $D(^TMP($J,"ERR")) D
"RTN","ORY195A",42,0)
 .S ^TMP($J,"TEXT",CNT)="Complex lab orders (e.g. CBC Q12Hx3) that were delayed were not being",CNT=CNT+1
"RTN","ORY195A",43,0)
 .S ^TMP($J,"TEXT",CNT)="assigned a location upon release.  As a result, the lab orders were not",CNT=CNT+1
"RTN","ORY195A",44,0)
 .S ^TMP($J,"TEXT",CNT)="appearing on the lab collection lists.",CNT=CNT+1
"RTN","ORY195A",45,0)
 .S ^TMP($J,"TEXT",CNT)="",CNT=CNT+1
"RTN","ORY195A",46,0)
 .S ^TMP($J,"TEXT",CNT)="The following patients have active lab orders without a location.",CNT=CNT+1
"RTN","ORY195A",47,0)
 .S ^TMP($J,"TEXT",CNT)="It is very likely that these tests have not been done.  Please review",CNT=CNT+1
"RTN","ORY195A",48,0)
 .S ^TMP($J,"TEXT",CNT)="each order to ensure that the test has been done.  You may need to DC the",CNT=CNT+1
"RTN","ORY195A",49,0)
 .S ^TMP($J,"TEXT",CNT)="existing order and enter a new order so the test appears on the",CNT=CNT+1
"RTN","ORY195A",50,0)
 .S ^TMP($J,"TEXT",CNT)="collection list.",CNT=CNT+1
"RTN","ORY195A",51,0)
 .S ^TMP($J,"TEXT",CNT)="",CNT=CNT+1
"RTN","ORY195A",52,0)
 .S ^TMP($J,"TEXT",CNT)="Please note that existing delayed complex lab orders will release correctly.",CNT=CNT+1
"RTN","ORY195A",53,0)
 .S LOC="" F  S LOC=$O(^TMP($J,"ERR",LOC)) Q:LOC=""  S ^TMP($J,"TEXT",CNT)="",CNT=CNT+1,^TMP($J,"TEXT",CNT)="Location: "_LOC,CNT=CNT+1,^(CNT)="",CNT=CNT+1 S ORD=0 F  S ORD=$O(^TMP($J,"ERR",LOC,ORD)) Q:'+ORD  D
"RTN","ORY195A",54,0)
 ..K VADM
"RTN","ORY195A",55,0)
 ..S DFN=^TMP($J,"ERR",LOC,ORD)
"RTN","ORY195A",56,0)
 ..D DEM^VADPT
"RTN","ORY195A",57,0)
 ..S ^TMP($J,"TEXT",CNT)=VADM(1)_"  ("_$E(+VADM(2),6,9)_")  ORDER #: "_ORD,CNT=CNT+1,^TMP($J,"TEXT",CNT)="  ORDER TEXT: "_$G(^OR(100,ORD,8,1,.1,1,0)),CNT=CNT+1
"RTN","ORY195A",58,0)
 S XMDUZ="PATCH OR*3*195 LAB CHILD ORDERS CHECK",XMY(.5)="" S:$G(DUZ) XMY(DUZ)=""
"RTN","ORY195A",59,0)
 S XMTEXT="^TMP($J,""TEXT"",",XMSUB="PATCH OR*3*195 Lab Order Check COMPLETED"
"RTN","ORY195A",60,0)
 D ^XMD
"RTN","ORY195A",61,0)
 Q
"RTN","ORY195V")
0^86^B1483542
"RTN","ORY195V",1,0)
ORY195V ;SLC/JDL -- environment check, if BCMA, then need PSB*3*6 [10/7/04 4:28pm]
"RTN","ORY195V",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195**;Dec 17, 1997
"RTN","ORY195V",3,0)
 ;
"RTN","ORY195V",4,0)
 N VAL1,VAL2,ANS,RA
"RTN","ORY195V",5,0)
 S VAL1=+$$VERSION^XPDUTL("PSB")
"RTN","ORY195V",6,0)
 S VAL2=$$PATCH^XPDUTL("PSB*3.0*6")
"RTN","ORY195V",7,0)
 S ANS=""
"RTN","ORY195V",8,0)
 I (VAL1>1),(VAL2=0) D
"RTN","ORY195V",9,0)
 . W !,!,"--- PATCH PSB*3.0*6 was not found on your site. ---"
"RTN","ORY195V",10,0)
 . W !,!,"PATCH PSB*3.0*6 need to be installed before installing OR*3.0*195, otherwise, BCMA MED ORDER BUTTON will not function properly."
"RTN","ORY195V",11,0)
 . W !,!,"--- OR*3.0*195 installation process terminated. ---",!
"RTN","ORY195V",12,0)
 . S XPDQUIT=1
"RTN","ORY195V",13,0)
 Q
"RTN","ORY195V",14,0)
 ;
"UP",100,100.04,-1)
100^10.5
"UP",100,100.04,0)
100.04
"UP",100,100.051,-1)
100^5.1
"UP",100,100.051,0)
100.051
"VER")
8.0^22.0
"^DD",100,100,5.1,0)
ORDER DIAGNOSES^100.051PA^^5.1;0
"^DD",100,100,5.1,21,0)
^^1^1^3031216^
"^DD",100,100,5.1,21,1,0)
These are the the diagnoses associated with this order.
"^DD",100,100,80,0)
V POV^100.04PA^^10.5;0
"^DD",100,100,90,0)
BA SERVICE CONNECTED CONDITION^S^1:YES;0:NO;^5.2;1^Q
"^DD",100,100,90,3)
Enter YES if this order is for treatment of a service-connected condition.
"^DD",100,100,90,21,0)
^.001^1^1^3040123^^
"^DD",100,100,90,21,1,0)
When signing orders, the provider may be asked if this order is for treatment of a service-connected condition; his/her response to this question will be stored in this field.
"^DD",100,100,90,"DT")
3040123
"^DD",100,100,91,0)
BA MILITARY SEXUAL TRAUMA^S^1:YES;0:NO;^5.2;2^Q
"^DD",100,100,91,3)
Enter YES if this order is for treatment of a condition due to MST.
"^DD",100,100,91,"DT")
3040123
"^DD",100,100,92,0)
BA AGENT ORANGE EXPOSURE^S^1:YES;0:NO;^5.2;3^Q
"^DD",100,100,92,3)
Enter YES if this order is for treatment of a condition due to Agent Oragne exposure during Vietnam service.
"^DD",100,100,92,"DT")
3040123
"^DD",100,100,93,0)
BA IONIZING RADIATION EXPOSURE^S^1:YES;0:NO;^5.2;4^Q
"^DD",100,100,93,3)
Enter YES if this order is for treatment of a condition due to ionizing radiation exposure during military service.
"^DD",100,100,93,"DT")
3040123
"^DD",100,100,94,0)
BA ENVIRONMENTAL CONTAMINANTS^S^1:YES;0:NO;^5.2;5^Q
"^DD",100,100,94,3)
Enter YES if this ordre is for treatmetn of a condition due to environmental contaminant exposure during the Persian Gulf War.
"^DD",100,100,94,"DT")
3040123
"^DD",100,100,95,0)
BA HEAD AND/OR NECK CANCER^S^1:YES;0:NO;^5.2;6^Q
"^DD",100,100,95,3)
Enter YES if this order is for treatment of head or neck cancer due to nose or throat radium treatments while in the military.
"^DD",100,100,95,"DT")
3040123
"^DD",100,100,96,0)
BA COMBAT VETERAN^S^1:YES;0:NO;^5.2;7^Q
"^DD",100,100,96,3)
Enter YES if this order is for treatment of a condition related to combat.
"^DD",100,100,96,"DT")
3040123
"^DD",100,100.04,0)
V POV SUB-FIELD^^.01^1
"^DD",100,100.04,0,"DIK")
ORD2
"^DD",100,100.04,0,"DT")
3030620
"^DD",100,100.04,0,"IX","B",100.04,.01)

"^DD",100,100.04,0,"NM","V POV")

"^DD",100,100.04,0,"UP")
100
"^DD",100,100.04,.01,0)
V POV^P9000010.07'^AUPNVPOV(^0;1^Q
"^DD",100,100.04,.01,1,0)
^.1
"^DD",100,100.04,.01,1,1,0)
100.04^B
"^DD",100,100.04,.01,1,1,1)
S ^OR(100,DA(1),10.5,"B",$E(X,1,30),DA)=""
"^DD",100,100.04,.01,1,1,2)
K ^OR(100,DA(1),10.5,"B",$E(X,1,30),DA)
"^DD",100,100.04,.01,3)
This is a pointer to the V POV File and a multiple.
"^DD",100,100.04,.01,"DT")
3030620
"^DD",100,100.051,0)
ORDER DIAGNOSES SUB-FIELD^^1^2
"^DD",100,100.051,0,"DIK")
ORD2
"^DD",100,100.051,0,"DT")
3031216
"^DD",100,100.051,0,"IX","B",100.051,.01)

"^DD",100,100.051,0,"NM","ORDER DIAGNOSES")

"^DD",100,100.051,0,"UP")
100
"^DD",100,100.051,.01,0)
ORDER DIAGNOSES^P80'^ICD9(^0;1^Q
"^DD",100,100.051,.01,1,0)
^.1
"^DD",100,100.051,.01,1,1,0)
100.051^B
"^DD",100,100.051,.01,1,1,1)
S ^OR(100,DA(1),5.1,"B",$E(X,1,30),DA)=""
"^DD",100,100.051,.01,1,1,2)
K ^OR(100,DA(1),5.1,"B",$E(X,1,30),DA)
"^DD",100,100.051,.01,3)
Enter the diagnosis code for this order.
"^DD",100,100.051,.01,"DT")
3031216
"^DD",100,100.051,1,0)
EXPRESSION^P757.01'^LEX(757.01,^0;2^Q
"^DD",100,100.051,1,"DT")
3040714
"^DD",101.24,101.24,0)
FIELD^^10^36
"^DD",101.24,101.24,0,"DDA")
N
"^DD",101.24,101.24,0,"DT")
3031008
"^DD",101.24,101.24,0,"ID",.23)
W:$D(^(2)) "   ",$P(^(2),U,3)
"^DD",101.24,101.24,0,"ID",.24)
W:$D(^(2)) "   ",$P(^(2),U,4)
"^DD",101.24,101.24,0,"IX","AC",101.24,.02)

"^DD",101.24,101.24,0,"IX","B",101.24,.01)

"^DD",101.24,101.24,0,"NM","OE/RR REPORT")

"^DD",101.24,101.24,0,"PT",101.24,.18)

"^DD",101.24,101.24,0,"PT",101.241,.01)

"^DD",101.24,101.24,0,"VRPK")
OR
"^DD",101.24,101.24,.001,0)
NUMBER^NJ5,0^^ ^K:+X'=X!(X>10000)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.24,101.24,.001,3)
Type a Number between 1 and 10000, 0 Decimal Digits
"^DD",101.24,101.24,.001,21,0)
^^1^1^3000921^
"^DD",101.24,101.24,.001,21,1,0)
This is the Number field for the file.
"^DD",101.24,101.24,.001,"DT")
3000920
"^DD",101.24,101.24,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",101.24,101.24,.01,1,0)
^.1^^-1
"^DD",101.24,101.24,.01,1,1,0)
101.24^B
"^DD",101.24,101.24,.01,1,1,1)
S ^ORD(101.24,"B",$E(X,1,30),DA)=""
"^DD",101.24,101.24,.01,1,1,2)
K ^ORD(101.24,"B",$E(X,1,30),DA)
"^DD",101.24,101.24,.01,3)
Answer must be 3-30 characters in length.
"^DD",101.24,101.24,.01,21,0)
^^1^1^3000921^
"^DD",101.24,101.24,.01,21,1,0)
This is the Name of the report.
"^DD",101.24,101.24,.01,"DT")
3010510
"^DD",101.24,101.24,.02,0)
ID^RF^^0;2^K:$L(X)>10!($L(X)<1) X
"^DD",101.24,101.24,.02,1,0)
^.1
"^DD",101.24,101.24,.02,1,1,0)
101.24^AC
"^DD",101.24,101.24,.02,1,1,1)
S ^ORD(101.24,"AC",$E(X,1,30),DA)=""
"^DD",101.24,101.24,.02,1,1,2)
K ^ORD(101.24,"AC",$E(X,1,30),DA)
"^DD",101.24,101.24,.02,1,1,"DT")
3001005
"^DD",101.24,101.24,.02,3)
Answer must be 1-10 characters in length.
"^DD",101.24,101.24,.02,21,0)
^^4^4^3000921^
"^DD",101.24,101.24,.02,21,1,0)
This is the code that identifies the report.  Each tab in CPRS that
"^DD",101.24,101.24,.02,21,2,0)
uses reports looks for this ID in order to process the report.
"^DD",101.24,101.24,.02,21,3,0)
Each tab also uses a unique set of ID's.  An ID of 5 on the Reports
"^DD",101.24,101.24,.02,21,4,0)
Tab may not identify the same report on a different tab.
"^DD",101.24,101.24,.02,"DT")
3001005
"^DD",101.24,101.24,.03,0)
REMOTE^S^1:YES;^0;3^Q
"^DD",101.24,101.24,.03,21,0)
^^2^2^3000921^
"^DD",101.24,101.24,.03,21,1,0)
This field is used to identify which reports allow remote access through
"^DD",101.24,101.24,.03,21,2,0)
Remote Data Views.
"^DD",101.24,101.24,.03,"DT")
3000907
"^DD",101.24,101.24,.04,0)
QUALIFIER^S^1:HSType;2:DateTime;3:Imaging;4:NutrAssess;19:MedicineProcedure;39:ListView;5:HSComponent;6:HSWPComponent;28:Surgery;^0;4^Q
"^DD",101.24,101.24,.04,21,0)
^.001^2^2^3010531^^^
"^DD",101.24,101.24,.04,21,1,0)
This field identifies which qualifier to use when processing the report.
"^DD",101.24,101.24,.04,21,2,0)
Examples of qualifiers are HSType, DateTime, Imaging and NutrAssess.
"^DD",101.24,101.24,.04,"DT")
3011004
"^DD",101.24,101.24,.05,0)
ROUTINE^FI^^0;5^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.05,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.05,8.5)
@
"^DD",101.24,101.24,.05,9)
@
"^DD",101.24,101.24,.05,21,0)
^.001^1^1^3001026^^^
"^DD",101.24,101.24,.05,21,1,0)
This is the routine that is invoked to produce the report.
"^DD",101.24,101.24,.05,23,0)
^.001^2^2^3001026^^
"^DD",101.24,101.24,.05,23,1,0)
The Labs Tab does not have a value for this field.  The CPRS executable
"^DD",101.24,101.24,.05,23,2,0)
calls separate RPC's for each report.
"^DD",101.24,101.24,.05,"DT")
3040126
"^DD",101.24,101.24,.06,0)
ENTRY POINT^FI^^0;6^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.06,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.06,8.5)
@
"^DD",101.24,101.24,.06,9)
@
"^DD",101.24,101.24,.06,21,0)
^.001^2^2^3001026^^
"^DD",101.24,101.24,.06,21,1,0)
This is the entry point for the ROUTINE that is invoked to produce the
"^DD",101.24,101.24,.06,21,2,0)
report.
"^DD",101.24,101.24,.06,23,0)
^.001^2^2^3001026^^
"^DD",101.24,101.24,.06,23,1,0)
The Labs Tab does not have a value for this field.  The CPRS executable
"^DD",101.24,101.24,.06,23,2,0)
calls separate RPC's for each report.
"^DD",101.24,101.24,.06,"DT")
3040126
"^DD",101.24,101.24,.07,0)
CATEGORY^S^0:FIXED;1:FIXED W/DATE;2:FIXED W/HEADER;3:FIXED W/DATE&HEADER;4:SPECIALIZED;5:GRAPHIC;6:LISTVIEW;^0;7^Q
"^DD",101.24,101.24,.07,3)
Enter a category for this report
"^DD",101.24,101.24,.07,21,0)
^^2^2^3001004^
"^DD",101.24,101.24,.07,21,1,0)
This field puts reports into a category that is evaluated by the GUI
"^DD",101.24,101.24,.07,21,2,0)
when the report is processed.
"^DD",101.24,101.24,.07,"DT")
3010215
"^DD",101.24,101.24,.08,0)
TAB^S^R:REPORTS TAB;L:LABS TAB;C:COVER SHEET;CD:COVER SHEET DETAILS;^0;8^Q
"^DD",101.24,101.24,.08,3)
Enter the appropriate code for this report.
"^DD",101.24,101.24,.08,21,0)
^.001^1^1^3001003^^
"^DD",101.24,101.24,.08,21,1,0)
This fields identifies the appropriate tab for a report in CPRS.
"^DD",101.24,101.24,.08,"DT")
3001011
"^DD",101.24,101.24,.09,0)
MIXEDCASE^S^1:YES;^0;9^Q
"^DD",101.24,101.24,.09,3)
Enter YES to display the list in mixed case
"^DD",101.24,101.24,.09,21,0)
^^2^2^3001004^
"^DD",101.24,101.24,.09,21,1,0)
This is used in the cover sheet and is used to display the returned
"^DD",101.24,101.24,.09,21,2,0)
list in mixed case.
"^DD",101.24,101.24,.09,"DT")
3001004
"^DD",101.24,101.24,.1,0)
INVERT^S^1:YES;^0;10^Q
"^DD",101.24,101.24,.1,3)
Enter YES to have the returned list inverted.
"^DD",101.24,101.24,.1,21,0)
^^1^1^3001004^
"^DD",101.24,101.24,.1,21,1,0)
This field is used to invert a list of data returned in the Cover sheet
"^DD",101.24,101.24,.1,"DT")
3001004
"^DD",101.24,101.24,.11,0)
TEXT COLOR^S^Black:BLACK;Maroon:MAROON;Green:GREEN;Olive:OLIVE;Purple:PURPLE;Teal:TEAL;Red:RED;Lime:LIME;Yellow:YELLOW;Blue:BLUE;Fuchsia:FUCHSIA;Aqua:AQUA;^0;11^Q
"^DD",101.24,101.24,.11,3)
Enter the color for the text
"^DD",101.24,101.24,.11,21,0)
^^1^1^3001004^
"^DD",101.24,101.24,.11,21,1,0)
This field determines the text color for the returned data.
"^DD",101.24,101.24,.11,"DT")
3001004
"^DD",101.24,101.24,.12,0)
TYPE^S^R:REPORT;H:HTML;L:LISTMAN ONLY;S:SELECTION LIST;V:LISTVIEW;M:MENU;G:GRAPH;^0;12^Q
"^DD",101.24,101.24,.12,3)
Enter the type for this entry.
"^DD",101.24,101.24,.12,21,0)
^.001^1^1^3001017^^
"^DD",101.24,101.24,.12,21,1,0)
This field identifies the type for an entry.
"^DD",101.24,101.24,.12,"DT")
3041208
"^DD",101.24,101.24,.13,0)
RPC^P8994'^XWB(8994,^0;13^Q
"^DD",101.24,101.24,.13,3)
Select the RPC that produces this report.
"^DD",101.24,101.24,.13,21,0)
^^1^1^3001004^
"^DD",101.24,101.24,.13,21,1,0)
This is the RPC that is called inside the GUI to produce the report.
"^DD",101.24,101.24,.13,"DT")
3001004
"^DD",101.24,101.24,.14,0)
DATE FORMAT^S^D:DATE ONLY;T:DATE WITH TIME;^0;14^Q
"^DD",101.24,101.24,.14,3)
Enter the code for the desired date format.
"^DD",101.24,101.24,.14,21,0)
^^1^1^3001004^
"^DD",101.24,101.24,.14,21,1,0)
This field determines what kind of format to display date/time fields.
"^DD",101.24,101.24,.14,"DT")
3001004
"^DD",101.24,101.24,.15,0)
DATE PIECE^NJ2,0^^0;15^K:+X'=X!(X>15)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.24,101.24,.15,3)
Type a Number between 1 and 15, 0 Decimal Digits
"^DD",101.24,101.24,.15,21,0)
^^2^2^3001004^
"^DD",101.24,101.24,.15,21,1,0)
This is used on the Cover Sheet to determine which piece the date field
"^DD",101.24,101.24,.15,21,2,0)
occupies.
"^DD",101.24,101.24,.15,"DT")
3001004
"^DD",101.24,101.24,.16,0)
TAB POSITIONS^F^^0;16^K:$L(X)>15!($L(X)<1) X
"^DD",101.24,101.24,.16,3)
Answer must be 1-15 characters in length.
"^DD",101.24,101.24,.16,21,0)
^^2^2^3001005^
"^DD",101.24,101.24,.16,21,1,0)
This is the value that will be used for the Tab property for the listbox
"^DD",101.24,101.24,.16,21,2,0)
associated with this report on the Cover Sheet.
"^DD",101.24,101.24,.16,"DT")
3001005
"^DD",101.24,101.24,.17,0)
PIECES^F^^0;17^K:$L(X)>20!($L(X)<1) X
"^DD",101.24,101.24,.17,3)
Answer must be 1-20 characters in length.
"^DD",101.24,101.24,.17,21,0)
^^2^2^3001011^
"^DD",101.24,101.24,.17,21,1,0)
This field is used by the Cover Sheet to determine what pieces of data
"^DD",101.24,101.24,.17,21,2,0)
to display in the listbox.
"^DD",101.24,101.24,.17,"DT")
3001011
"^DD",101.24,101.24,.18,0)
DETAIL REPORT^*P101.24'^ORD(101.24,^0;18^S DIC("S")="I $P(^(0),""^"",8)=""CD""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",101.24,101.24,.18,3)
Enter the report to get the details for this report.
"^DD",101.24,101.24,.18,12)
Allow only Cover sheet detail type reports
"^DD",101.24,101.24,.18,12.1)
S DIC("S")="I $P(^(0),""^"",8)=""CD"""
"^DD",101.24,101.24,.18,21,0)
^^1^1^3001011^
"^DD",101.24,101.24,.18,21,1,0)
This field is used to get the details of an item on the cover sheet.
"^DD",101.24,101.24,.18,"DT")
3001011
"^DD",101.24,101.24,.19,0)
REPORT TAG^FI^^0;19^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.19,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.19,21,0)
^.001^1^1^3010503^^
"^DD",101.24,101.24,.19,21,1,0)
This is the entry point tag for a report extract.
"^DD",101.24,101.24,.19,"DT")
3040126
"^DD",101.24,101.24,.191,0)
REPORT ROUTINE^FI^^0;20^K:$L(X)>8!($L(X)<3) X
"^DD",101.24,101.24,.191,3)
Answer must be 3-8 characters in length.
"^DD",101.24,101.24,.191,21,0)
^.001^1^1^3010503^^
"^DD",101.24,101.24,.191,21,1,0)
This is the routine associated with the REPORT TAG for report extracts.
"^DD",101.24,101.24,.191,"DT")
3040126
"^DD",101.24,101.24,.192,0)
REPORT COMPONENT^P142.1'^GMT(142.1,^0;21^Q
"^DD",101.24,101.24,.192,21,0)
^.001^1^1^3010503^^
"^DD",101.24,101.24,.192,21,1,0)
This is the report component associated with this report.
"^DD",101.24,101.24,.192,"DT")
3010503
"^DD",101.24,101.24,.21,0)
PARAM 1^F^^2;1^K:$L(X)>30!($L(X)<1) X
"^DD",101.24,101.24,.21,3)
Answer must be 1-30 characters in length.
"^DD",101.24,101.24,.21,21,0)
^^1^1^3001004^
"^DD",101.24,101.24,.21,21,1,0)
This is the 1st parameter passed to the RPC, if needed.
"^DD",101.24,101.24,.21,"DT")
3001004
"^DD",101.24,101.24,.22,0)
PARAM 2^F^^2;2^K:$L(X)>30!($L(X)<1) X
"^DD",101.24,101.24,.22,3)
Answer must be 1-30 characters in length.
"^DD",101.24,101.24,.22,21,0)
^^1^1^3001004^
"^DD",101.24,101.24,.22,21,1,0)
This is the 2nd parameter passed to the RPC, if needed.
"^DD",101.24,101.24,.22,"DT")
3001004
"^DD",101.24,101.24,.23,0)
HEADING^F^^2;3^K:$L(X)>75!($L(X)<1) X
"^DD",101.24,101.24,.23,1,0)
^.1^^0
"^DD",101.24,101.24,.23,3)
Answer must be 1-75 characters in length.
"^DD",101.24,101.24,.23,21,0)
^^1^1^3001031^
"^DD",101.24,101.24,.23,21,1,0)
This is the heading used on the Cover sheet for the list of items.
"^DD",101.24,101.24,.23,"DT")
3010510
"^DD",101.24,101.24,.24,0)
DESCRIPTIVE TEXT^RF^^2;4^K:$L(X)>55!($L(X)<2) X
"^DD",101.24,101.24,.24,3)
Answer must be 2-55 characters in length.
"^DD",101.24,101.24,.24,21,0)
^.001^2^2^3010510^^
"^DD",101.24,101.24,.24,21,1,0)
This is a more descriptive name than what might be included in the 
"^DD",101.24,101.24,.24,21,2,0)
NAME field.
"^DD",101.24,101.24,.24,"DT")
3010510
"^DD",101.24,101.24,.25,0)
NODE^F^^2;5^K:$L(X)>10!($L(X)<1) X
"^DD",101.24,101.24,.25,3)
Answer must be 1-10 characters in length.
"^DD",101.24,101.24,.25,21,0)
^^2^2^3001005^
"^DD",101.24,101.24,.25,21,1,0)
This is used by the Cover Sheet routines to define the node in the ^XTMP
"^DD",101.24,101.24,.25,21,2,0)
global to store the data.
"^DD",101.24,101.24,.25,"DT")
3001005
"^DD",101.24,101.24,.26,0)
PRINT TAG^FI^^2;6^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.26,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.26,21,0)
^^2^2^3010614^
"^DD",101.24,101.24,.26,21,1,0)
This is the entry point tag used when printing reports that do their own
"^DD",101.24,101.24,.26,21,2,0)
Write statements.
"^DD",101.24,101.24,.26,"DT")
3040126
"^DD",101.24,101.24,.27,0)
PRINT ROUTINE^FI^^2;7^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.27,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.27,21,0)
^^2^2^3010614^
"^DD",101.24,101.24,.27,21,1,0)
This is the entry point routine used when printing reports that do their own
"^DD",101.24,101.24,.27,21,2,0)
Write statements.
"^DD",101.24,101.24,.27,"DT")
3040126
"^DD",101.24,101.24,.28,0)
EXTRACT TAG^FI^^2;8^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.28,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.28,21,0)
^^2^2^3010711^
"^DD",101.24,101.24,.28,21,1,0)
This is the entry point for the extract routine that pulls the data from
"^DD",101.24,101.24,.28,21,2,0)
package API's and/or package files.
"^DD",101.24,101.24,.28,"DT")
3040126
"^DD",101.24,101.24,.29,0)
EXTRACT ROUTINE^FI^^2;9^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.29,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.29,21,0)
^^2^2^3010711^
"^DD",101.24,101.24,.29,21,1,0)
This is the extract routine that pulls data from package API's and/or
"^DD",101.24,101.24,.29,21,2,0)
package files.
"^DD",101.24,101.24,.29,"DT")
3040126
"^DD",101.24,101.24,.41,0)
SORT ORDER^F^^4;1^K:$L(X)>15!($L(X)<3)!'(X?1N1":"1N) X
"^DD",101.24,101.24,.41,3)
Answer must be 3-15 characters in length.
"^DD",101.24,101.24,.41,21,0)
^^6^6^3010717^
"^DD",101.24,101.24,.41,21,1,0)
This field is used when sorting columns of data on at grid within CPRS.
"^DD",101.24,101.24,.41,21,2,0)
It determines the sort order to be used in a multi-column sort.  The
"^DD",101.24,101.24,.41,21,3,0)
primary sort column is always the column header clicked on by the user.
"^DD",101.24,101.24,.41,21,4,0)
If this field has values in the form #:#, then a multi-column sort is
"^DD",101.24,101.24,.41,21,5,0)
done, using the column numbers identified in this field for the second
"^DD",101.24,101.24,.41,21,6,0)
and third level sorting.
"^DD",101.24,101.24,.41,"DT")
3010717
"^DD",101.24,101.24,.42,0)
MAXIMUM DAYS BACK^NJ4,0^^4;2^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.24,101.24,.42,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",101.24,101.24,.42,21,0)
^^1^1^3011004^
"^DD",101.24,101.24,.42,21,1,0)
This field restricts the report date range to the maximum value specified.
"^DD",101.24,101.24,.42,"DT")
3011004
"^DD",101.24,101.24,.43,0)
FHIE REPORT^F^^4;3^K:$L(X)>10!($L(X)<2) X
"^DD",101.24,101.24,.43,3)
Answer must be 2-10 characters in length.
"^DD",101.24,101.24,.43,21,0)
^.001^3^3^3040126^^^^
"^DD",101.24,101.24,.43,21,1,0)
This field identifies reports that are available through FHIE.
"^DD",101.24,101.24,.43,21,2,0)
The item in this field is the code for the report available through
"^DD",101.24,101.24,.43,21,3,0)
the FHIE server.
"^DD",101.24,101.24,.43,23,0)
^.001^3^3^3040126^^^^
"^DD",101.24,101.24,.43,23,1,0)
This field is not looked at by reports that have a 'listview' format.
"^DD",101.24,101.24,.43,23,2,0)
It is only used by straight text reports that go through the routine:
"^DD",101.24,101.24,.43,23,3,0)
  ORDV01
"^DD",101.24,101.24,.43,"DT")
3031008
"^DD",101.24,101.24,3,0)
COLUMN HEADERS^101.243^^3;0
"^DD",101.24,101.24,10,0)
ITEM^101.241P^^10;0
"^DD",101.24,101.241,0)
ITEM SUB-FIELD^^.03^3
"^DD",101.24,101.241,0,"DT")
3010215
"^DD",101.24,101.241,0,"IX","B",101.241,.01)

"^DD",101.24,101.241,0,"NM","ITEM")

"^DD",101.24,101.241,0,"UP")
101.24
"^DD",101.24,101.241,.01,0)
ITEM^MP101.24^ORD(101.24,^0;1^Q
"^DD",101.24,101.241,.01,1,0)
^.1
"^DD",101.24,101.241,.01,1,1,0)
101.241^B
"^DD",101.24,101.241,.01,1,1,1)
S ^ORD(101.24,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",101.24,101.241,.01,1,1,2)
K ^ORD(101.24,DA(1),10,"B",$E(X,1,30),DA)
"^DD",101.24,101.241,.01,3)

"^DD",101.24,101.241,.01,21,0)
^^1^1^3010215^
"^DD",101.24,101.241,.01,21,1,0)
This is used in building a treeview of reports for CPRS GUI.
"^DD",101.24,101.241,.01,"DT")
3010215
"^DD",101.24,101.241,.02,0)
HEADER TEXT^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",101.24,101.241,.02,3)
Answer must be 1-30 characters in length.
"^DD",101.24,101.241,.02,21,0)
^^1^1^3010215^
"^DD",101.24,101.241,.02,21,1,0)
This is the header to be used.
"^DD",101.24,101.241,.02,"DT")
3010215
"^DD",101.24,101.241,.03,0)
SEQUENCE^NJ7,1^^0;3^K:+X'=X!(X>99999)!(X<.1)!(X?.E1"."2N.N) X
"^DD",101.24,101.241,.03,3)
Type a Number between .1 and 99999, 1 Decimal Digit
"^DD",101.24,101.241,.03,21,0)
^^1^1^3010215^
"^DD",101.24,101.241,.03,21,1,0)
This is the sequence number for this report.
"^DD",101.24,101.241,.03,"DT")
3010215
"^DD",101.24,101.243,0)
COLUMN HEADERS SUB-FIELD^^.1^10
"^DD",101.24,101.243,0,"DT")
3010727
"^DD",101.24,101.243,0,"IX","B",101.243,.01)

"^DD",101.24,101.243,0,"IX","C",101.243,.03)

"^DD",101.24,101.243,0,"NM","COLUMN HEADERS")

"^DD",101.24,101.243,0,"UP")
101.24
"^DD",101.24,101.243,.01,0)
COLUMN HEADERS^MF^^0;1^K:$L(X)>60!($L(X)<1) X
"^DD",101.24,101.243,.01,1,0)
^.1
"^DD",101.24,101.243,.01,1,1,0)
101.243^B
"^DD",101.24,101.243,.01,1,1,1)
S ^ORD(101.24,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",101.24,101.243,.01,1,1,2)
K ^ORD(101.24,DA(1),3,"B",$E(X,1,30),DA)
"^DD",101.24,101.243,.01,3)
Answer must be 1-60 characters in length.
"^DD",101.24,101.243,.01,21,0)
^.001^1^1^3010709^^^^
"^DD",101.24,101.243,.01,21,1,0)
These are the column headings used on a report in ListView format.
"^DD",101.24,101.243,.01,"DT")
3010709
"^DD",101.24,101.243,.02,0)
VISIBLE^S^0:YES;1:NO;^0;2^Q
"^DD",101.24,101.243,.02,3)
Set this field to NO to hide the column.
"^DD",101.24,101.243,.02,21,0)
^^1^1^3010420^
"^DD",101.24,101.243,.02,21,1,0)
This field determines the visible property of the column.
"^DD",101.24,101.243,.02,"DT")
3010420
"^DD",101.24,101.243,.03,0)
SEQUENCE^NJ6,1^^0;3^K:+X'=X!(X>9999)!(X<.1)!(X?.E1"."2N.N) X
"^DD",101.24,101.243,.03,1,0)
^.1
"^DD",101.24,101.243,.03,1,1,0)
101.243^C
"^DD",101.24,101.243,.03,1,1,1)
S ^ORD(101.24,DA(1),3,"C",$E(X,1,30),DA)=""
"^DD",101.24,101.243,.03,1,1,2)
K ^ORD(101.24,DA(1),3,"C",$E(X,1,30),DA)
"^DD",101.24,101.243,.03,1,1,"DT")
3010321
"^DD",101.24,101.243,.03,3)
Type a Number between .1 and 9999, 1 Decimal Digit
"^DD",101.24,101.243,.03,21,0)
^^1^1^3010215^
"^DD",101.24,101.243,.03,21,1,0)
This is the sequence for the column header.
"^DD",101.24,101.243,.03,"DT")
3010321
"^DD",101.24,101.243,.04,0)
TYPE^S^0:SINGLE PIECE VALUE;1:WORD PROCESSING;^0;4^Q
"^DD",101.24,101.243,.04,3)
Enter '1' if the value of this column contains multiple lines of text.
"^DD",101.24,101.243,.04,21,0)
^^1^1^3010420^
"^DD",101.24,101.243,.04,21,1,0)
This field identifies columns that contain multiple lines of text.
"^DD",101.24,101.243,.04,"DT")
3010420
"^DD",101.24,101.243,.05,0)
INCLUDE ON DETAIL^S^0:NO;1:YES;^0;5^Q
"^DD",101.24,101.243,.05,3)
Enter YES to include this field in detailed report
"^DD",101.24,101.243,.05,21,0)
^.001^2^2^3010628^^^^
"^DD",101.24,101.243,.05,21,1,0)
This field is used to determine what data to include in the details of
"^DD",101.24,101.243,.05,21,2,0)
a report.
"^DD",101.24,101.243,.05,"DT")
3010628
"^DD",101.24,101.243,.06,0)
PRINT LENGTH^NJ2,0^^0;6^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.24,101.243,.06,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",101.24,101.243,.06,21,0)
^^1^1^3010628^
"^DD",101.24,101.243,.06,21,1,0)
This is the field length used when printing this column on a report.
"^DD",101.24,101.243,.06,"DT")
3010628
"^DD",101.24,101.243,.07,0)
INCLUDE ON PRINT^S^0:NO;1:YES;^0;7^Q
"^DD",101.24,101.243,.07,21,0)
^^2^2^3010628^
"^DD",101.24,101.243,.07,21,1,0)
This field determines which columns are included when a printout is
"^DD",101.24,101.243,.07,21,2,0)
requested.
"^DD",101.24,101.243,.07,"DT")
3010628
"^DD",101.24,101.243,.08,0)
PRINT TITLE^F^^0;8^K:$L(X)>20!($L(X)<1) X
"^DD",101.24,101.243,.08,3)
Answer must be 1-20 characters in length.
"^DD",101.24,101.243,.08,21,0)
^^1^1^3010628^
"^DD",101.24,101.243,.08,21,1,0)
This field is used when printing this field in lieu of the Column Header.
"^DD",101.24,101.243,.08,"DT")
3010628
"^DD",101.24,101.243,.09,0)
DATA TYPE^S^0:FREE TEXT;1:NUMERIC;2:DATE/TIME;^0;9^Q
"^DD",101.24,101.243,.09,3)
Enter the type of data that is in this column.
"^DD",101.24,101.243,.09,21,0)
^.001^3^3^3010718^^
"^DD",101.24,101.243,.09,21,1,0)
This is the data type of the column.  It is used when sorting columns.
"^DD",101.24,101.243,.09,21,2,0)
The default data type is 0 - FREE TEXT.  If no value is entered, it is
"^DD",101.24,101.243,.09,21,3,0)
assumed to be FREE TEXT.
"^DD",101.24,101.243,.09,"DT")
3010718
"^DD",101.24,101.243,.1,0)
WIDTH^NJ4,0^^0;10^K:+X'=X!(X>4000)!(X<-2)!(X?.E1"."1N.N) X
"^DD",101.24,101.243,.1,3)
Type a Number between -2 and 4000, 0 Decimal Digits
"^DD",101.24,101.243,.1,21,0)
^^5^5^3010727^
"^DD",101.24,101.243,.1,21,1,0)
This field is for the column width.  No value needs to be entered because
"^DD",101.24,101.243,.1,21,2,0)
the value is actually obtained from a User level parameter.  The field
"^DD",101.24,101.243,.1,21,3,0)
is defined here to reserve the 10 piece of this node so that future
"^DD",101.24,101.243,.1,21,4,0)
field definitions won't break the RPC used in CPRS to get column properties
"^DD",101.24,101.243,.1,21,5,0)
where the width is stored in the 10 piece.
"^DD",101.24,101.243,.1,"DT")
3010727
"^DD",101.41,101.41,0)
FIELD^^99^30
"^DD",101.41,101.41,0,"DDA")
N
"^DD",101.41,101.41,0,"DT")
2980501
"^DD",101.41,101.41,0,"IX","AB",101.41,.01)

"^DD",101.41,101.41,0,"IX","AD",101.412,2)

"^DD",101.41,101.41,0,"IX","AM",101.41,99)

"^DD",101.41,101.41,0,"IX","AM2",101.41,2)

"^DD",101.41,101.41,0,"IX","AM51",101.41,51)

"^DD",101.41,101.41,0,"IX","AM52",101.41,52)

"^DD",101.41,101.41,0,"IX","AMM",101.412,.01)

"^DD",101.41,101.41,0,"IX","AMM2",101.412,2)

"^DD",101.41,101.41,0,"IX","AMM3",101.412,3)

"^DD",101.41,101.41,0,"IX","AMM4",101.412,4)

"^DD",101.41,101.41,0,"IX","AMM5",101.412,5)

"^DD",101.41,101.41,0,"IX","APKG",101.41,7)

"^DD",101.41,101.41,0,"IX","B",101.41,.01)

"^DD",101.41,101.41,0,"IX","C",101.41,2)

"^DD",101.41,101.41,0,"NM","ORDER DIALOG")

"^DD",101.41,101.41,0,"PT",100,2)

"^DD",101.41,101.41,0,"PT",100,7)

"^DD",101.41,101.41,0,"PT",100.045,.02)

"^DD",101.41,101.41,0,"PT",100.5,4)

"^DD",101.41,101.41,0,"PT",100.5,5)

"^DD",101.41,101.41,0,"PT",100.98,4)

"^DD",101.41,101.41,0,"PT",101.412,1)

"^DD",101.41,101.41,0,"PT",101.412,2)

"^DD",101.41,101.41,0,"PT",101.415,2)

"^DD",101.41,101.41,0,"PT",101.416,.02)

"^DD",101.41,101.41,0,"PT",101.441,.01)

"^DD",101.41,101.41,0,"PT",801.41,15)

"^DD",101.41,101.41,0,"PT",801.4118,.01)

"^DD",101.41,101.41,0,"VRPK")
OR
"^DD",101.41,101.41,.01,0)
NAME^RF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>63!($L(X)<3)!'(X'?1P.E) X
"^DD",101.41,101.41,.01,1,0)
^.1
"^DD",101.41,101.41,.01,1,1,0)
101.41^B
"^DD",101.41,101.41,.01,1,1,1)
S ^ORD(101.41,"B",$E(X,1,30),DA)=""
"^DD",101.41,101.41,.01,1,1,2)
K ^ORD(101.41,"B",$E(X,1,30),DA)
"^DD",101.41,101.41,.01,1,2,0)
101.41^AB
"^DD",101.41,101.41,.01,1,2,1)
S ^ORD(101.41,"AB",$E(X,1,63),DA)=""
"^DD",101.41,101.41,.01,1,2,2)
K ^ORD(101.41,"AB",$E(X,1,63),DA)
"^DD",101.41,101.41,.01,1,2,"%D",0)
^^1^1^2971020^
"^DD",101.41,101.41,.01,1,2,"%D",1,0)
This is a regular index on the full 63 characters of the Name field.
"^DD",101.41,101.41,.01,1,2,"DT")
2971020
"^DD",101.41,101.41,.01,3)
Answer must be 3-63 characters in length.
"^DD",101.41,101.41,.01,21,0)
^^3^3^2971219^
"^DD",101.41,101.41,.01,21,1,0)
This is the name of the dialog; entries that were converted from the
"^DD",101.41,101.41,.01,21,2,0)
Protocol file will retain the same name.  Namespacing is not required,
"^DD",101.41,101.41,.01,21,3,0)
but still encouraged.
"^DD",101.41,101.41,.01,"DT")
2971020
"^DD",101.41,101.41,2,0)
DISPLAY TEXT^FX^^0;2^K:$L(X)>80!($L(X)<3)!($$CHKNAM^ORUTL(X)) X
"^DD",101.41,101.41,2,1,0)
^.1
"^DD",101.41,101.41,2,1,1,0)
101.41^C
"^DD",101.41,101.41,2,1,1,1)
S ^ORD(101.41,"C",$$UP^XLFSTR($E(X,1,63)),DA)=""
"^DD",101.41,101.41,2,1,1,2)
K ^ORD(101.41,"C",$$UP^XLFSTR($E(X,1,63)),DA)
"^DD",101.41,101.41,2,1,1,"DT")
2950112
"^DD",101.41,101.41,2,1,2,0)
101.41^AM2^MUMPS
"^DD",101.41,101.41,2,1,2,1)
D REDOM^ORDD41
"^DD",101.41,101.41,2,1,2,2)
D REDOM^ORDD41
"^DD",101.41,101.41,2,1,2,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,2,1,2,"%D",1,0)
Update TIMESTAMP whenever DISPLAY TEXT is changed.
"^DD",101.41,101.41,2,1,2,"DT")
2990210
"^DD",101.41,101.41,2,3)
Answer must be 3-80 characters in length and cannot contain a semicolon (;), a comma (,), an up-arrow (^), a dash (-), or an equal sign (=). 
"^DD",101.41,101.41,2,21,0)
^.001^1^1^3010913^^^^
"^DD",101.41,101.41,2,21,1,0)
The text of this dialog's name as it appears on a menu or subheader.
"^DD",101.41,101.41,2,"DT")
3000823
"^DD",101.41,101.41,3,0)
DISABLE^F^^0;3^K:$L(X)>40!($L(X)<1) X
"^DD",101.41,101.41,3,3)
Enter a message here to disable this dialog, 1-40 characters in length.
"^DD",101.41,101.41,3,21,0)
^^3^3^2950112^
"^DD",101.41,101.41,3,21,1,0)
This field disables use of this dialog when it contains text.  The text
"^DD",101.41,101.41,3,21,2,0)
should be a short message explaining why use of this dialog has been
"^DD",101.41,101.41,3,21,3,0)
disabled, as it will be displayed if this dialog is selected.
"^DD",101.41,101.41,3,"DT")
2950112
"^DD",101.41,101.41,4,0)
TYPE^RS^P:prompt;D:dialog;Q:quick order;O:order set;M:menu;A:action;^0;4^Q
"^DD",101.41,101.41,4,3)
Specify a type for this dialog.
"^DD",101.41,101.41,4,21,0)
^^5^5^2950716^^^^
"^DD",101.41,101.41,4,21,1,0)
This field defines the type of order dialog to be processed.  Control
"^DD",101.41,101.41,4,21,2,0)
will be passed to the OE/RR Dialog Processor for dialog items; menu types
"^DD",101.41,101.41,4,21,3,0)
are used for displaying and selecting dialog items.  Action types will only
"^DD",101.41,101.41,4,21,4,0)
execute the entry and exit actions, ignoring any items that may exist; these
"^DD",101.41,101.41,4,21,5,0)
dialogs should not create entries in the Orders file.
"^DD",101.41,101.41,4,"DT")
2950716
"^DD",101.41,101.41,5,0)
DISPLAY GROUP^P100.98'^ORD(100.98,^0;5^Q
"^DD",101.41,101.41,5,3)
Enter the display group containing orderable items defined by this dialog.
"^DD",101.41,101.41,5,21,0)
^^3^3^2950112^
"^DD",101.41,101.41,5,21,1,0)
This field determines what display group this dialog has been defined for.
"^DD",101.41,101.41,5,21,2,0)
It will define which orderable items are selectable with this dialog,
"^DD",101.41,101.41,5,21,3,0)
as well as what service to send the order to when it is complete.
"^DD",101.41,101.41,5,"DT")
2950112
"^DD",101.41,101.41,6,0)
SIGNATURE REQUIRED^S^0:NONE;1:ORELSE;2:ORES;^0;6^Q
"^DD",101.41,101.41,6,3)
Enter the OR key required to sign orders created by this dialog
"^DD",101.41,101.41,6,21,0)
^^6^6^2970318^^
"^DD",101.41,101.41,6,21,1,0)
This field indicates what signature will be required for orders created by
"^DD",101.41,101.41,6,21,2,0)
this dialog, to be considered complete and ready to release to the service
"^DD",101.41,101.41,6,21,3,0)
for action.  If this flag is set to NO and the dialog contains a prompt
"^DD",101.41,101.41,6,21,4,0)
for item(s) from the Orderable Item file, the order created may still
"^DD",101.41,101.41,6,21,5,0)
require a signature if any of the items ordered are individually flagged
"^DD",101.41,101.41,6,21,6,0)
as requiring a signature.
"^DD",101.41,101.41,6,"DT")
2970318
"^DD",101.41,101.41,7,0)
PACKAGE^P9.4'^DIC(9.4,^0;7^Q
"^DD",101.41,101.41,7,1,0)
^.1
"^DD",101.41,101.41,7,1,1,0)
101.41^APKG
"^DD",101.41,101.41,7,1,1,1)
S ^ORD(101.41,"APKG",$E(X,1,30),DA)=""
"^DD",101.41,101.41,7,1,1,2)
K ^ORD(101.41,"APKG",$E(X,1,30),DA)
"^DD",101.41,101.41,7,1,1,"DT")
2970325
"^DD",101.41,101.41,7,3)
Enter the VISTA package that is to receive orders created by this dialog.
"^DD",101.41,101.41,7,21,0)
^^3^3^2950208^
"^DD",101.41,101.41,7,21,1,0)
This is the VISTA package that is intended to receive orders created by
"^DD",101.41,101.41,7,21,2,0)
this dialog; this is required for creating the HL7 messages to pass the
"^DD",101.41,101.41,7,21,3,0)
order.
"^DD",101.41,101.41,7,"DT")
2970325
"^DD",101.41,101.41,8,0)
VERIFY ORDER^S^1:YES;0:NO;^0;8^Q
"^DD",101.41,101.41,8,3)
Enter YES to have orders created by this dialog presented to the user before saving, with the opportunity to edit.
"^DD",101.41,101.41,8,21,0)
^^3^3^2950623^
"^DD",101.41,101.41,8,21,1,0)
This field is a flag, which determines if the order created by this dialog
"^DD",101.41,101.41,8,21,2,0)
will be presented to the user for verification before saving in the Orders
"^DD",101.41,101.41,8,21,3,0)
file; for most quick orders, this flag should be set to 0 (no).
"^DD",101.41,101.41,8,"DT")
2950623
"^DD",101.41,101.41,9,0)
ASK FOR ANOTHER ORDER^S^0:NO;1:YES;2:YES-DON'T ASK;^0;9^Q
"^DD",101.41,101.41,9,3)
Enter YES to have the user asked to enter another order from this dialog before exiting.
"^DD",101.41,101.41,9,21,0)
^^6^6^2970616^^^
"^DD",101.41,101.41,9,21,1,0)
This field allows the user to add another order from this dialog, when the
"^DD",101.41,101.41,9,21,2,0)
initial order is accepted and placed; if set to YES, the user will be
"^DD",101.41,101.41,9,21,3,0)
asked "Add another <dialog display text> order?" to allow for either
"^DD",101.41,101.41,9,21,4,0)
exiting the processor or adding an additional order of the same type.
"^DD",101.41,101.41,9,21,5,0)
This field can also be set to YES-DON'T ASK to force the processor to
"^DD",101.41,101.41,9,21,6,0)
automatically drop into prompting for another order without asking first.
"^DD",101.41,101.41,9,"DT")
2970616
"^DD",101.41,101.41,10,0)
ITEMS^101.412IA^^10;0
"^DD",101.41,101.41,10,21,0)
^^5^5^2990211^^^^
"^DD",101.41,101.41,10,21,1,0)
This field contains the components for dialogs:
"^DD",101.41,101.41,10,21,2,0)
     Dialogs      -> prompts
"^DD",101.41,101.41,10,21,3,0)
     Quick orders -> prompts (completed)
"^DD",101.41,101.41,10,21,4,0)
     Order sets   -> dialogs or quick orders
"^DD",101.41,101.41,10,21,5,0)
     Menus        -> dialogs, quick orders, or order sets
"^DD",101.41,101.41,11,0)
DATA TYPE^S^D:date/time;R:free text date/time;F:free text;N:numeric;S:set of codes;Y:yes/no;P:pointer;W:word processing;^1;1^Q
"^DD",101.41,101.41,11,3)
Enter the type of data to be collected at this prompt.
"^DD",101.41,101.41,11,21,0)
^^2^2^2950823^^
"^DD",101.41,101.41,11,21,1,0)
This is the type of data being prompted for; this field is used to define
"^DD",101.41,101.41,11,21,2,0)
a call to the reader (^DIR) in most cases.
"^DD",101.41,101.41,11,23,0)
^^1^1^2950823^^
"^DD",101.41,101.41,11,23,1,0)
Used with Prompt-type only.
"^DD",101.41,101.41,11,"DT")
2950407
"^DD",101.41,101.41,12,0)
DOMAIN^F^^1;2^K:$L(X)>235!($L(X)<1) X
"^DD",101.41,101.41,12,3)
Answer must be 1-235 characters in length.
"^DD",101.41,101.41,12,21,0)
^^3^3^2990225^^^^
"^DD",101.41,101.41,12,21,1,0)
This is a parameter that may be used to further specify the data type.
"^DD",101.41,101.41,12,21,2,0)
The string stored here should be appropriate for the second ^-piece of
"^DD",101.41,101.41,12,21,3,0)
DIR(0) when used with the data type field.
"^DD",101.41,101.41,12,23,0)
^^1^1^2990225^^^^
"^DD",101.41,101.41,12,23,1,0)
Used with Prompt-type only.
"^DD",101.41,101.41,12,"DT")
2990225
"^DD",101.41,101.41,13,0)
ID^F^^1;3^K:$L(X)>10!($L(X)<2) X
"^DD",101.41,101.41,13,3)
Answer must be 2-10 characters in length.
"^DD",101.41,101.41,13,21,0)
^.001^20^20^3010727^^
"^DD",101.41,101.41,13,21,1,0)
This field may contain a single word identifier which will be
"^DD",101.41,101.41,13,21,2,0)
stored with the user response in the Orders file #100, where it
"^DD",101.41,101.41,13,21,3,0)
will be indexed for quick reference to certain values in the
"^DD",101.41,101.41,13,21,4,0)
order dialog.  The following are some examples of values
"^DD",101.41,101.41,13,21,5,0)
currently in use:
"^DD",101.41,101.41,13,21,6,0)
 
"^DD",101.41,101.41,13,21,7,0)
   START      -> Start date/time
"^DD",101.41,101.41,13,21,8,0)
   STOP       -> Stop date/time
"^DD",101.41,101.41,13,21,9,0)
   SCHEDULE   -> Administration Schedule
"^DD",101.41,101.41,13,21,10,0)
   ORDERABLE  -> Orderable Item
"^DD",101.41,101.41,13,21,11,0)
   DRUG       -> Dispense Drug
"^DD",101.41,101.41,13,21,12,0)
   CANCEL     -> Cancel Future Orders flag
"^DD",101.41,101.41,13,21,13,0)
   COMMENT    -> Word processing comments
"^DD",101.41,101.41,13,21,14,0)
 
"^DD",101.41,101.41,13,21,15,0)
These values must be unique among entries within an order dialog
"^DD",101.41,101.41,13,21,16,0)
but do not need to be unique across the entire file.  Be sure to
"^DD",101.41,101.41,13,21,17,0)
check the IDs assigned to generic text entries to make sure that
"^DD",101.41,101.41,13,21,18,0)
all IDs are unique.  In order to avoid potential problems it's
"^DD",101.41,101.41,13,21,19,0)
recommended that you use unique IDs for any local entries that you
"^DD",101.41,101.41,13,21,20,0)
create.
"^DD",101.41,101.41,13,"DT")
2960215
"^DD",101.41,101.41,17,0)
VALIDATION^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,17,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,17,9)
@
"^DD",101.41,101.41,17,21,0)
^^3^3^2960912^
"^DD",101.41,101.41,17,21,1,0)
This is MUMPS code that will be executed at the time of releasing an
"^DD",101.41,101.41,17,21,2,0)
order created with this dialog; dialog responses may be checked again
"^DD",101.41,101.41,17,21,3,0)
here before releasing the order to the service.
"^DD",101.41,101.41,17,"DT")
2960912
"^DD",101.41,101.41,19,0)
ADDITIONAL TEXT^K^^9;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,19,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,19,9)
@
"^DD",101.41,101.41,19,21,0)
^^3^3^2960405^^
"^DD",101.41,101.41,19,21,1,0)
This is MUMPS code that will be executed when order ORIFN created by this
"^DD",101.41,101.41,19,21,2,0)
dialog is about to be displayed; any string that should be appended to the
"^DD",101.41,101.41,19,21,3,0)
order text should be returned in Y.
"^DD",101.41,101.41,19,"DT")
2960405
"^DD",101.41,101.41,20,0)
DESCRIPTION^101.411^^2;0
"^DD",101.41,101.41,20,21,0)
^^1^1^2971219^
"^DD",101.41,101.41,20,21,1,0)
This is a description of the dialog and its uses.
"^DD",101.41,101.41,21,0)
RESPONSES^101.416^^6;0
"^DD",101.41,101.41,21,21,0)
^^2^2^2971219^
"^DD",101.41,101.41,21,21,1,0)
This multiple contains any responses to prompts that have been pre-answered
"^DD",101.41,101.41,21,21,2,0)
to create a quick order.
"^DD",101.41,101.41,30,0)
ENTRY ACTION^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,30,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,30,9)
@
"^DD",101.41,101.41,30,21,0)
^^4^4^2950425^
"^DD",101.41,101.41,30,21,1,0)
This is MUMPS code that will be executed at the top of a dialog, prior to
"^DD",101.41,101.41,30,21,2,0)
the execution of any prompts; it may perform functions such as listing
"^DD",101.41,101.41,30,21,3,0)
the recent Radiology exams before ordering a new one, or alerting the
"^DD",101.41,101.41,30,21,4,0)
user to an existing diet order before making a change.
"^DD",101.41,101.41,30,"DT")
2950425
"^DD",101.41,101.41,31,0)
QUICK SETUP^K^^3.1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,31,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,31,9)
@
"^DD",101.41,101.41,31,21,0)
^^3^3^2970113^
"^DD",101.41,101.41,31,21,1,0)
This is MUMPS code that will be executed in the place of the Entry Action
"^DD",101.41,101.41,31,21,2,0)
when creating quick orders for this dialog; variables may be set here
"^DD",101.41,101.41,31,21,3,0)
instead to bypass the usual dependence on specific patient values.
"^DD",101.41,101.41,31,"DT")
2970113
"^DD",101.41,101.41,40,0)
EXIT ACTION^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,40,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,40,9)
@
"^DD",101.41,101.41,40,21,0)
^^2^2^2950622^
"^DD",101.41,101.41,40,21,1,0)
This is MUMPS code that will be executed upon completion of processing the
"^DD",101.41,101.41,40,21,2,0)
dialog; it is currently used only with dialog-type entries.
"^DD",101.41,101.41,40,"DT")
2950622
"^DD",101.41,101.41,50,0)
CONTROLS^101.415A^^50;0
"^DD",101.41,101.41,51,0)
COLUMN WIDTH^NJ3,0^^5;1^K:+X'=X!(X>240)!(X<20)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,51,1,0)
^.1
"^DD",101.41,101.41,51,1,1,0)
101.41^AM51^MUMPS
"^DD",101.41,101.41,51,1,1,1)
D REDO^ORDD41
"^DD",101.41,101.41,51,1,1,2)
D REDO^ORDD41
"^DD",101.41,101.41,51,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,51,1,1,"%D",1,0)
Update TIMESTAMP whenever COLUMN WIDTH is changed.
"^DD",101.41,101.41,51,1,1,"DT")
2990210
"^DD",101.41,101.41,51,3)
Type a Number between 20 and 240, 0 Decimal Digits
"^DD",101.41,101.41,51,21,0)
^^2^2^2950623^
"^DD",101.41,101.41,51,21,1,0)
This is the width, in characters, for each column in a menu.  For example,
"^DD",101.41,101.41,51,21,2,0)
to have 3 columns on an 80 character device, enter a width of 26.
"^DD",101.41,101.41,51,"DT")
2990210
"^DD",101.41,101.41,52,0)
MNEMONIC WIDTH^NJ1,0^^5;2^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,52,1,0)
^.1
"^DD",101.41,101.41,52,1,1,0)
101.41^AM52^MUMPS
"^DD",101.41,101.41,52,1,1,1)
D REDO^ORDD41
"^DD",101.41,101.41,52,1,1,2)
D REDO^ORDD41
"^DD",101.41,101.41,52,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,52,1,1,"%D",1,0)
Update TIMESTAMP whenever MNEMONIC WIDTH is changed.
"^DD",101.41,101.41,52,1,1,"DT")
2990210
"^DD",101.41,101.41,52,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",101.41,101.41,52,21,0)
^^2^2^2950623^
"^DD",101.41,101.41,52,21,1,0)
This field allows the width of item mnemonics to be varied; the default
"^DD",101.41,101.41,52,21,2,0)
value is 5.
"^DD",101.41,101.41,52,"DT")
2990210
"^DD",101.41,101.41,53,0)
PATH SWITCH^S^1:YES;0:NO;^5;3^Q
"^DD",101.41,101.41,53,3)
Enter YES if this menu should be redisplayed when traversing back up the menu tree.
"^DD",101.41,101.41,53,21,0)
^^5^5^2950623^
"^DD",101.41,101.41,53,21,1,0)
This switch allows the user, when traversing back UP the tree of menus and
"^DD",101.41,101.41,53,21,2,0)
items, to select a new path back down the tree.  In other words, the menu
"^DD",101.41,101.41,53,21,3,0)
is redisplayed when returning to that menu's level in the tree and
"^DD",101.41,101.41,53,21,4,0)
processing back down the tree is possible from that point.  If nothing is
"^DD",101.41,101.41,53,21,5,0)
selected from the menu, the path continues back up the tree.
"^DD",101.41,101.41,53,"DT")
2950623
"^DD",101.41,101.41,54,0)
LISTBOX TEXT^F^^5;4^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.41,54,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.41,54,"DT")
2960524
"^DD",101.41,101.41,55,0)
WINDOW FORM ID^NJ4,0^^5;5^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,55,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",101.41,101.41,55,21,0)
^.001^23^23^3010727^^
"^DD",101.41,101.41,55,21,1,0)
This field tells the GUI DELPHI code which form to use to process the
"^DD",101.41,101.41,55,21,2,0)
order dialog.  Each number represents a unique form.  Following are some
"^DD",101.41,101.41,55,21,3,0)
of the more common codes and their corresponding form in DELPHI.
"^DD",101.41,101.41,55,21,4,0)
 
"^DD",101.41,101.41,55,21,5,0)
    Form Name     Windows Form ID
"^DD",101.41,101.41,55,21,6,0)
    ---------     ---------------
"^DD",101.41,101.41,55,21,7,0)
  OD_ACTIVITY           100
"^DD",101.41,101.41,55,21,8,0)
  OD_ALLERGY            105
"^DD",101.41,101.41,55,21,9,0)
  OD_CONSULT            110
"^DD",101.41,101.41,55,21,10,0)
  OD_PROCEDURE          112
"^DD",101.41,101.41,55,21,11,0)
  OD_DIET_TXT           115
"^DD",101.41,101.41,55,21,12,0)
  OD_DIET               117
"^DD",101.41,101.41,55,21,13,0)
  OD_LAB                120
"^DD",101.41,101.41,55,21,14,0)
  OD_MEDINPT            130
"^DD",101.41,101.41,55,21,15,0)
  OD_MEDS               135
"^DD",101.41,101.41,55,21,16,0)
  OD_MEDOUTPT           140
"^DD",101.41,101.41,55,21,17,0)
  OD_NURSING            150
"^DD",101.41,101.41,55,21,18,0)
  OD_MISC               151
"^DD",101.41,101.41,55,21,19,0)
  OD_GENERIC            152
"^DD",101.41,101.41,55,21,20,0)
  OD_IMAGING            160
"^DD",101.41,101.41,55,21,21,0)
  OD_VITALS             171 
"^DD",101.41,101.41,55,21,22,0)
  OD_MEDIV              180
"^DD",101.41,101.41,55,21,23,0)
  OD_TEXTONLY           999
"^DD",101.41,101.41,55,"DT")
2960804
"^DD",101.41,101.41,56,0)
CREATE PARENT ORDER^S^1:YES;0:NO;^5;6^Q
"^DD",101.41,101.41,56,3)
Enter YES if a parent order should be created for this order set
"^DD",101.41,101.41,56,21,0)
^^6^6^2970227^
"^DD",101.41,101.41,56,21,1,0)
This flag indicates whether a parent order should be created to group
"^DD",101.41,101.41,56,21,2,0)
together all the orders created by this order set; this flag is only
"^DD",101.41,101.41,56,21,3,0)
valid with SET type order dialogs.  If this value is YES, a parent
"^DD",101.41,101.41,56,21,4,0)
order will be created, and only the parent will be presented on the
"^DD",101.41,101.41,56,21,5,0)
orders list for display and action; NO will prevent a parent from being
"^DD",101.41,101.41,56,21,6,0)
created and all orders will be created and displayed independently.
"^DD",101.41,101.41,56,"DT")
2970227
"^DD",101.41,101.41,57,0)
DISPLAY SUBHEADER^S^1:YES;0:NO;^5;7^Q
"^DD",101.41,101.41,57,3)
Enter YES if a subheader should be displayed as each order in this set is processed
"^DD",101.41,101.41,57,21,0)
^^3^3^2970227^
"^DD",101.41,101.41,57,21,1,0)
This flag indicates whether a subheader is to be displayed for each order
"^DD",101.41,101.41,57,21,2,0)
in this set as it is processed and placed; this flag is only valid with
"^DD",101.41,101.41,57,21,3,0)
SET type order dialogs.
"^DD",101.41,101.41,57,"DT")
2970227
"^DD",101.41,101.41,58,0)
AUTO-ACCEPT QUICK ORDER^S^1:YES;^5;8^Q
"^DD",101.41,101.41,58,3)
Enter 'Yes' if the order should be placed without displaying the dialog window.
"^DD",101.41,101.41,58,21,0)
^^2^2^2980902^
"^DD",101.41,101.41,58,21,1,0)
This can be set to yes for a quick order so that it can be placed simply
"^DD",101.41,101.41,58,21,2,0)
by clicking on it in the GUI (no ordering dialog is displayed).
"^DD",101.41,101.41,58,"DT")
2980902
"^DD",101.41,101.41,99,0)
TIMESTAMP^F^^99;1^K:$L(X)>15!($L(X)<1) X
"^DD",101.41,101.41,99,1,0)
^.1
"^DD",101.41,101.41,99,1,1,0)
101.41^AM^MUMPS
"^DD",101.41,101.41,99,1,1,1)
D SET^ORDD41(DA)
"^DD",101.41,101.41,99,1,1,2)
D KILL^ORDD41(DA)
"^DD",101.41,101.41,99,1,1,"%D",0)
^^2^2^2990210^
"^DD",101.41,101.41,99,1,1,"%D",1,0)
Recompiles order dialog menus in ^XUTL("XQORM",<dialog#>_";ORD(101.41,")
"^DD",101.41,101.41,99,1,1,"%D",2,0)
whenever fields necessary to displaying the menu are changed.
"^DD",101.41,101.41,99,1,1,"DT")
2990210
"^DD",101.41,101.41,99,3)
Answer must be 1-15 characters in length.
"^DD",101.41,101.41,99,21,0)
^^2^2^2980501^
"^DD",101.41,101.41,99,21,1,0)
For menus, this contains the $H time the menu was last compiled for use
"^DD",101.41,101.41,99,21,2,0)
with the Unwinder utility (^XQOR).
"^DD",101.41,101.41,99,"DT")
2990210
"^DD",101.41,101.411,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",101.41,101.411,0,"DT")
2950407
"^DD",101.41,101.411,0,"NM","DESCRIPTION")

"^DD",101.41,101.411,0,"UP")
101.41
"^DD",101.41,101.411,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",101.41,101.411,.01,3)
Enter a description of this dialog.
"^DD",101.41,101.411,.01,21,0)
^^1^1^2950425^^
"^DD",101.41,101.411,.01,21,1,0)
This field contains a description of the content and use of this dialog.
"^DD",101.41,101.411,.01,"DT")
2950407
"^DD",101.41,101.412,0)
ITEMS SUB-FIELD^^117^37
"^DD",101.41,101.412,0,"DT")
2971117
"^DD",101.41,101.412,0,"ID","WRITE")
N OR0,ORNM S OR0=^(0) I $P(OR0,U,2) S ORNM=$P($G(^ORD(101.41,+$P(OR0,U,2),0)),U) D:$L(ORNM) EN^DDIOL(ORNM,,"?10")
"^DD",101.41,101.412,0,"IX","ATXT",101.412,21)

"^DD",101.41,101.412,0,"IX","B",101.412,.01)

"^DD",101.41,101.412,0,"IX","D",101.412,2)

"^DD",101.41,101.412,0,"IX","DAD",101.412,1)

"^DD",101.41,101.412,0,"IX","DAD1",101.412,.01)

"^DD",101.41,101.412,0,"NM","ITEMS")

"^DD",101.41,101.412,0,"UP")
101.41
"^DD",101.41,101.412,.01,0)
SEQUENCE^MNJ5,1^^0;1^K:+X'=X!(X>999.9)!(X<.1)!(X?.E1"."2N.N) X
"^DD",101.41,101.412,.01,1,0)
^.1
"^DD",101.41,101.412,.01,1,1,0)
101.412^B
"^DD",101.41,101.412,.01,1,1,1)
S ^ORD(101.41,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",101.41,101.412,.01,1,1,2)
K ^ORD(101.41,DA(1),10,"B",$E(X,1,30),DA)
"^DD",101.41,101.412,.01,1,2,0)
101.412^DAD1^MUMPS
"^DD",101.41,101.412,.01,1,2,1)
N ORP S ORP=$P(^ORD(101.41,DA(1),10,DA,0),U,11) S:ORP ^ORD(101.41,DA(1),10,"DAD",ORP,X,DA)=""
"^DD",101.41,101.412,.01,1,2,2)
N ORP S ORP=$P(^ORD(101.41,DA(1),10,DA,0),U,11) K:ORP ^ORD(101.41,DA(1),10,"DAD",ORP,X,DA)
"^DD",101.41,101.412,.01,1,2,"%D",0)
^^1^1^2950511^
"^DD",101.41,101.412,.01,1,2,"%D",1,0)
Allows retrieval of 'child' prompts in sequence by parent.
"^DD",101.41,101.412,.01,1,2,"DT")
2950511
"^DD",101.41,101.412,.01,1,3,0)
101.41^AMM^MUMPS
"^DD",101.41,101.412,.01,1,3,1)
D REDOX^ORDD41
"^DD",101.41,101.412,.01,1,3,2)
D REDOX^ORDD41
"^DD",101.41,101.412,.01,1,3,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,.01,1,3,"%D",1,0)
Update TIMESTAMP whenever SEQUENCE is changed.
"^DD",101.41,101.412,.01,1,3,"DT")
2990210
"^DD",101.41,101.412,.01,3)
Type a Number between .1 and 999.9, 1 Decimal Digit
"^DD",101.41,101.412,.01,21,0)
^^2^2^2971117^^^^
"^DD",101.41,101.412,.01,21,1,0)
This field specifies the order in which this item will be displayed or
"^DD",101.41,101.412,.01,21,2,0)
processed.
"^DD",101.41,101.412,.01,"DT")
2990210
"^DD",101.41,101.412,.1,0)
INPUT TRANSFORM^K^^.1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,.1,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,.1,9)
@
"^DD",101.41,101.412,.1,21,0)
^^2^2^2950816^
"^DD",101.41,101.412,.1,21,1,0)
This is code that will be used as the third piece of DIR(0) when asking
"^DD",101.41,101.412,.1,21,2,0)
this prompt.
"^DD",101.41,101.412,.1,"DT")
2950816
"^DD",101.41,101.412,1,0)
PARENT^P101.41'^ORD(101.41,^0;11^Q
"^DD",101.41,101.412,1,1,0)
^.1
"^DD",101.41,101.412,1,1,1,0)
101.412^DAD^MUMPS
"^DD",101.41,101.412,1,1,1,1)
S ^ORD(101.41,DA(1),10,"DAD",X,$P(^ORD(101.41,DA(1),10,DA,0),U),DA)=""
"^DD",101.41,101.412,1,1,1,2)
K ^ORD(101.41,DA(1),10,"DAD",X,$P(^ORD(101.41,DA(1),10,DA,0),U),DA)
"^DD",101.41,101.412,1,1,1,"%D",0)
^^1^1^2950511^^
"^DD",101.41,101.412,1,1,1,"%D",1,0)
Allows retrieval of 'child' prompts in sequence by parent.
"^DD",101.41,101.412,1,1,1,"DT")
2950511
"^DD",101.41,101.412,1,3)
If this prompt is subordinate to another in this dialog, enter the parent prompt here
"^DD",101.41,101.412,1,21,0)
^^4^4^2950511^
"^DD",101.41,101.412,1,21,1,0)
This field controls the behavior of this prompt.  If a parent is defined
"^DD",101.41,101.412,1,21,2,0)
here, this prompt will be asked from within the parent's dialog; when it
"^DD",101.41,101.412,1,21,3,0)
is invoked independently based on its position sequence number, the child
"^DD",101.41,101.412,1,21,4,0)
prompt will be ignored.
"^DD",101.41,101.412,1,"DT")
2950511
"^DD",101.41,101.412,2,0)
ITEM^P101.41'X^ORD(101.41,^0;2^D TREE^ORDD41
"^DD",101.41,101.412,2,1,0)
^.1
"^DD",101.41,101.412,2,1,1,0)
101.41^AD
"^DD",101.41,101.412,2,1,1,1)
S ^ORD(101.41,"AD",$E(X,1,30),DA(1),DA)=""
"^DD",101.41,101.412,2,1,1,2)
K ^ORD(101.41,"AD",$E(X,1,30),DA(1),DA)
"^DD",101.41,101.412,2,1,1,"DT")
2950123
"^DD",101.41,101.412,2,1,2,0)
101.412^D
"^DD",101.41,101.412,2,1,2,1)
S ^ORD(101.41,DA(1),10,"D",$E(X,1,30),DA)=""
"^DD",101.41,101.412,2,1,2,2)
K ^ORD(101.41,DA(1),10,"D",$E(X,1,30),DA)
"^DD",101.41,101.412,2,1,2,"DT")
2950411
"^DD",101.41,101.412,2,1,3,0)
101.41^AMM2^MUMPS
"^DD",101.41,101.412,2,1,3,1)
D REDOX^ORDD41
"^DD",101.41,101.412,2,1,3,2)
D REDOX^ORDD41
"^DD",101.41,101.412,2,1,3,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,2,1,3,"%D",1,0)
Update TIMESTAMP whenever ITEM is changed.
"^DD",101.41,101.412,2,1,3,"DT")
2990210
"^DD",101.41,101.412,2,3)
Enter an order dialog; a dialog that is an ancestor may not also be a sub-item.
"^DD",101.41,101.412,2,21,0)
^^3^3^2950123^
"^DD",101.41,101.412,2,21,1,0)
This field points to an order dialog which is subordinate to this dialog.
"^DD",101.41,101.412,2,21,2,0)
NOTE:  The parent dialog menu or one of its ancestors may not be entered
"^DD",101.41,101.412,2,21,3,0)
as an item.
"^DD",101.41,101.412,2,"DT")
2990217
"^DD",101.41,101.412,3,0)
MNEMONIC^FX^^0;3^K:$L(X)>4!($L(X)<1)!(+X=X&($L(X,".")>1))!($$CHKMNE^ORUTL(X)) X
"^DD",101.41,101.412,3,1,0)
^.1
"^DD",101.41,101.412,3,1,1,0)
101.41^AMM3^MUMPS
"^DD",101.41,101.412,3,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,3,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,3,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,3,1,1,"%D",1,0)
Update TIMESTAMP whenever MNEMONIC is changed.
"^DD",101.41,101.412,3,1,1,"DT")
2990210
"^DD",101.41,101.412,3,3)
Enter a mnemonic to be used when this dialog is displayed for selection, 1-4 characters in length with no decimal places if numeric. Standard list manager mnemonics may not be used.
"^DD",101.41,101.412,3,21,0)
^.001^2^2^3010727^^^^
"^DD",101.41,101.412,3,21,1,0)
This is a short abbreviation for this item dialog to be used when this
"^DD",101.41,101.412,3,21,2,0)
dialog is displayed for selection.
"^DD",101.41,101.412,3,"DT")
3000822
"^DD",101.41,101.412,4,0)
DISPLAY TEXT^FX^^0;4^K:$L(X)>80!($L(X)<1)!($$CHKNAM^ORUTL(X)) X
"^DD",101.41,101.412,4,1,0)
^.1
"^DD",101.41,101.412,4,1,1,0)
101.41^AMM4^MUMPS
"^DD",101.41,101.412,4,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,4,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,4,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,4,1,1,"%D",1,0)
Update TIMESTAMP whenever DISPLAY TEXT is changed.
"^DD",101.41,101.412,4,1,1,"DT")
2990210
"^DD",101.41,101.412,4,3)
Answer must be 1-80 characters in length and cannot contain a semicolon (;), a comma (,), an up-arrow (^), a dash (-), or an equal sign (=).
"^DD",101.41,101.412,4,21,0)
^.001^2^2^3010419^^^^
"^DD",101.41,101.412,4,21,1,0)
This field allows the text that normally appears for this item to be
"^DD",101.41,101.412,4,21,2,0)
replaced with alternate text for use in this dialog or menu.
"^DD",101.41,101.412,4,"DT")
3000823
"^DD",101.41,101.412,5,0)
DISPLAY ONLY?^S^0:NO;1:YES;2:YES-HEADER;^0;5^Q
"^DD",101.41,101.412,5,1,0)
^.1
"^DD",101.41,101.412,5,1,1,0)
101.41^AMM5^MUMPS
"^DD",101.41,101.412,5,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,5,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,5,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,5,1,1,"%D",1,0)
Update TIMESTAMP whenever DISPLAY ONLY? is changed.
"^DD",101.41,101.412,5,1,1,"DT")
2990210
"^DD",101.41,101.412,5,3)
Enter YES if this item is text for display only and not a selectable item.
"^DD",101.41,101.412,5,21,0)
^^3^3^2970409^^^^
"^DD",101.41,101.412,5,21,1,0)
This field identifies an item as being free text for display purposes
"^DD",101.41,101.412,5,21,2,0)
only.  The text in the Display Text field will be displayed, but it
"^DD",101.41,101.412,5,21,3,0)
is not selectable; if designated as a header, the text will be underlined.
"^DD",101.41,101.412,5,"DT")
2990210
"^DD",101.41,101.412,6,0)
REQUIRED^S^1:YES;0:NO;^0;6^Q
"^DD",101.41,101.412,6,3)
Enter YES if a response to this prompt is mandatory.
"^DD",101.41,101.412,6,21,0)
^^1^1^2950407^
"^DD",101.41,101.412,6,21,1,0)
This field indicates that the user must enter a response to this prompt.
"^DD",101.41,101.412,6,"DT")
2950407
"^DD",101.41,101.412,7,0)
MULTIPLE VALUED^S^1:YES;0:NO;^0;7^Q
"^DD",101.41,101.412,7,3)
Enter YES if this prompt is to be asked multiple times.
"^DD",101.41,101.412,7,21,0)
^^3^3^2950407^
"^DD",101.41,101.412,7,21,1,0)
This field determines if this prompt will be allowed to have multiple
"^DD",101.41,101.412,7,21,2,0)
values, or be prompted for only once; if this prompt is a sub-dialog,
"^DD",101.41,101.412,7,21,3,0)
the entire dialog will be asked once or many times, as a group.
"^DD",101.41,101.412,7,"DT")
2950407
"^DD",101.41,101.412,7.1,0)
MAX NUMBER OF MULTIPLES^NJ2,0^^0;12^K:+X'=X!(X>99)!(X<2)!(X?.E1"."1N.N) X
"^DD",101.41,101.412,7.1,3)
Type a Number between 2 and 99, 0 Decimal Digits
"^DD",101.41,101.412,7.1,21,0)
^^4^4^2950815^
"^DD",101.41,101.412,7.1,21,1,0)
This is the maximum number of values that may be entered for this prompt,
"^DD",101.41,101.412,7.1,21,2,0)
if it is flagged as being multiple-valued.  For example, a diet order may
"^DD",101.41,101.412,7.1,21,3,0)
have up to 5 diet modifications entered, where 5 is the maximum allowed
"^DD",101.41,101.412,7.1,21,4,0)
that would be entered here.
"^DD",101.41,101.412,7.1,"DT")
2950815
"^DD",101.41,101.412,7.2,0)
TITLE^F^^0;13^K:$L(X)>30!($L(X)<3) X
"^DD",101.41,101.412,7.2,3)
Answer must be 3-30 characters in length.
"^DD",101.41,101.412,7.2,21,0)
^^8^8^2970430^^
"^DD",101.41,101.412,7.2,21,1,0)
This is text that will be used in place of the prompt when the order is
"^DD",101.41,101.412,7.2,21,2,0)
displayed for place, edit, or cancel, or at the top of a multiple-valued
"^DD",101.41,101.412,7.2,21,3,0)
prompt.  The Display Text for the prompt will be used together with the
"^DD",101.41,101.412,7.2,21,4,0)
instance number to prompt for user input; for example if Title="Lab Tests:"
"^DD",101.41,101.412,7.2,21,5,0)
and Display Text="Test:" the user would see
"^DD",101.41,101.412,7.2,21,6,0)
  Lab Tests:
"^DD",101.41,101.412,7.2,21,7,0)
  1. Test:
"^DD",101.41,101.412,7.2,21,8,0)
  2. Test:
"^DD",101.41,101.412,7.2,"DT")
2950815
"^DD",101.41,101.412,7.3,0)
PROMPT^F^^0;14^K:$L(X)>10!($L(X)<1) X
"^DD",101.41,101.412,7.3,3)
Answer must be 1-10 characters in length.
"^DD",101.41,101.412,7.3,21,0)
^^3^3^2970618^
"^DD",101.41,101.412,7.3,21,1,0)
This field contains text that will be appended to the beginning of the
"^DD",101.41,101.412,7.3,21,2,0)
display text when prompting for additional values; if this field is
"^DD",101.41,101.412,7.3,21,3,0)
empty, then "Another " will be used.
"^DD",101.41,101.412,7.3,"DT")
2970618
"^DD",101.41,101.412,8,0)
ASK ON EDIT ONLY^S^1:YES;0:NO;^0;8^Q
"^DD",101.41,101.412,8,3)
Enter YES if this prompt should not be asked initially when creating this order, only if the user chooses to edit the order.
"^DD",101.41,101.412,8,21,0)
^^4^4^2960112^^^
"^DD",101.41,101.412,8,21,1,0)
This field determines the behaviour of the dialog driver for this prompt;
"^DD",101.41,101.412,8,21,2,0)
if no value or the defined default is usually correct for this prompt,
"^DD",101.41,101.412,8,21,3,0)
enter YES here to have this prompt skipped on the first pass through this
"^DD",101.41,101.412,8,21,4,0)
dialog when creating an order.
"^DD",101.41,101.412,8,"DT")
2950407
"^DD",101.41,101.412,9,0)
ASK ON ACTION^F^^0;9^K:$L(X)>3!($L(X)<1) X
"^DD",101.41,101.412,9,3)
Answer must be 1-3 characters in length.
"^DD",101.41,101.412,9,21,0)
^^6^6^2970708^^^
"^DD",101.41,101.412,9,21,1,0)
This field determines the behaviour of the dialog driver for this prompt
"^DD",101.41,101.412,9,21,2,0)
when taking a particular action on an order created by this dialog.  If
"^DD",101.41,101.412,9,21,3,0)
this string contains "R", this prompt will be asked when renewing an order;
"^DD",101.41,101.412,9,21,4,0)
if this string contains "C", this prompt will be asked when changing an
"^DD",101.41,101.412,9,21,5,0)
order; if this string contains "W", this prompt will be asked when
"^DD",101.41,101.412,9,21,6,0)
rewriting an order.
"^DD",101.41,101.412,9,"DT")
2970708
"^DD",101.41,101.412,10,0)
INDEX^F^^0;10^K:$L(X)>25!($L(X)<1) X
"^DD",101.41,101.412,10,3)
Answer must be 1-25 characters in length.
"^DD",101.41,101.412,10,21,0)
^^3^3^2950713^^^
"^DD",101.41,101.412,10,21,1,0)
For pointer-type prompts, this is the index to use when searching the file;
"^DD",101.41,101.412,10,21,2,0)
it must be in the form of a regular cross-reference.  To search on multiple
"^DD",101.41,101.412,10,21,3,0)
indices, enter a string of index names separated by semi-colons, i.e. "B;C".
"^DD",101.41,101.412,10,"DT")
2950713
"^DD",101.41,101.412,11,0)
HELP MESSAGE^F^^1;1^K:$L(X)>160!($L(X)<1) X
"^DD",101.41,101.412,11,3)
Answer must be 1-160 characters in length.
"^DD",101.41,101.412,11,21,0)
^^2^2^2970609^^
"^DD",101.41,101.412,11,21,1,0)
This field contains the help message to be presented when the user enters
"^DD",101.41,101.412,11,21,2,0)
a question mark at this prompt.
"^DD",101.41,101.412,11,"DT")
2970609
"^DD",101.41,101.412,12,0)
SPECIAL LOOKUP ROUTINE^F^^1;2^K:$L(X)>20!($L(X)<3) X
"^DD",101.41,101.412,12,3)
Enter the routine to use instead of DIC to do this lookup, as [TAG;]ROUTINE
"^DD",101.41,101.412,12,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,12,21,1,0)
This field contains a routine to execute that will replace the standard
"^DD",101.41,101.412,12,21,2,0)
DIC lookup for this prompt; it must be entered here as LINETAG;ROUTINE
"^DD",101.41,101.412,12,21,3,0)
using a ; instead of ^ and where LINETAG is optional.
"^DD",101.41,101.412,12,"DT")
2970609
"^DD",101.41,101.412,13,0)
ASK ON CONDITION^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,13,3)
This is MUMPS code that sets $T to determine if this prompt should be asked, or given a default value and bypassed.
"^DD",101.41,101.412,13,9)
@
"^DD",101.41,101.412,13,21,0)
^^5^5^2950407^
"^DD",101.41,101.412,13,21,1,0)
This is MUMPS code that sets $T to determine if this prompt should be asked
"^DD",101.41,101.412,13,21,2,0)
or simply given a default value and presented to the user for acceptance
"^DD",101.41,101.412,13,21,3,0)
or editing.  For example, the prompt "Pregnant: " may have code here to
"^DD",101.41,101.412,13,21,4,0)
check the sex of the current patient, i.e. I ORSEX="F" will allow it to be
"^DD",101.41,101.412,13,21,5,0)
asked only for female patients.
"^DD",101.41,101.412,13,"DT")
2950407
"^DD",101.41,101.412,14,0)
SCREEN^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,14,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,14,9)
@
"^DD",101.41,101.412,14,21,0)
^^2^2^2950407^
"^DD",101.41,101.412,14,21,1,0)
For pointer-type prompts, this field may contain MUMPS code that will be
"^DD",101.41,101.412,14,21,2,0)
set into DIC("S") to screen the possible choices in the pointed-to file.
"^DD",101.41,101.412,14,"DT")
2950407
"^DD",101.41,101.412,15,0)
POST-SELECTION ACTION^K^^5;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,15,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,15,9)
@
"^DD",101.41,101.412,15,21,0)
^^3^3^2970923^^^^
"^DD",101.41,101.412,15,21,1,0)
This is code that will be executed after a response is entered to this
"^DD",101.41,101.412,15,21,2,0)
prompt; if this prompt should be re-asked, kill the variable DONE.
"^DD",101.41,101.412,15,21,3,0)
If execution of the ordering dialog should be stopped, set ORQUIT=1.
"^DD",101.41,101.412,15,"DT")
2970923
"^DD",101.41,101.412,16,0)
XECUTABLE HELP^K^^6;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,16,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,16,9)
@
"^DD",101.41,101.412,16,21,0)
^^2^2^2950407^
"^DD",101.41,101.412,16,21,1,0)
This is code that is to be executed when the user enters two or more
"^DD",101.41,101.412,16,21,2,0)
question marks at this prompt.
"^DD",101.41,101.412,16,"DT")
2950407
"^DD",101.41,101.412,17,0)
DEFAULT^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,17,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,17,9)
@
"^DD",101.41,101.412,17,21,0)
^^2^2^2971219^^^^
"^DD",101.41,101.412,17,21,1,0)
This is code that is to be executed to determine the appropriate default
"^DD",101.41,101.412,17,21,2,0)
value for this prompt, setting Y=internal form of this value.
"^DD",101.41,101.412,17,"DT")
2950519
"^DD",101.41,101.412,18,0)
DEFAULT WORD-PROCESSING TEXT^101.41218^^8;0
"^DD",101.41,101.412,18,21,0)
^^1^1^2971219^
"^DD",101.41,101.412,18,21,1,0)
This is default text to be stuffed into this word-processing prompt.
"^DD",101.41,101.412,19,0)
ENTRY ACTION^K^^9;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,19,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,19,9)
@
"^DD",101.41,101.412,19,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,19,21,1,0)
This is code that will be executed at the beginning of the processing of
"^DD",101.41,101.412,19,21,2,0)
this prompt, before the Default and Ask on Condition fields are executed;
"^DD",101.41,101.412,19,21,3,0)
any special setup required for this field should be done here.
"^DD",101.41,101.412,19,"DT")
2970609
"^DD",101.41,101.412,20,0)
EXIT ACTION^K^^10;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,20,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,20,9)
@
"^DD",101.41,101.412,20,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,20,21,1,0)
This is code that will be executed at the very end of the processing of
"^DD",101.41,101.412,20,21,2,0)
this prompt, after prompting and the Validation field is executed;
"^DD",101.41,101.412,20,21,3,0)
any special cleanup should be done here.
"^DD",101.41,101.412,20,"DT")
2970609
"^DD",101.41,101.412,21,0)
ORDER TEXT SEQUENCE^NJ5,2^^2;1^K:+X'=X!(X>99.99)!(X<1)!(X?.E1"."3N.N) X
"^DD",101.41,101.412,21,1,0)
^.1
"^DD",101.41,101.412,21,1,1,0)
101.412^ATXT
"^DD",101.41,101.412,21,1,1,1)
S ^ORD(101.41,DA(1),10,"ATXT",$E(X,1,30),DA)=""
"^DD",101.41,101.412,21,1,1,2)
K ^ORD(101.41,DA(1),10,"ATXT",$E(X,1,30),DA)
"^DD",101.41,101.412,21,1,1,"%D",0)
^^1^1^2960226^
"^DD",101.41,101.412,21,1,1,"%D",1,0)
Used to build order text.
"^DD",101.41,101.412,21,1,1,"DT")
2960226
"^DD",101.41,101.412,21,3)
Enter the order in which this value should be added to the order text, as a number between 1 and 99.99; leave this field blank to prevent this value from being included
"^DD",101.41,101.412,21,21,0)
^^3^3^2970607^^^
"^DD",101.41,101.412,21,21,1,0)
This field indicates the order in which values will be concatenated
"^DD",101.41,101.412,21,21,2,0)
together to build the order text; this may differ from the prompting
"^DD",101.41,101.412,21,21,3,0)
order defined in the .01 Sequence field.
"^DD",101.41,101.412,21,"DT")
2960226
"^DD",101.41,101.412,22,0)
FORMAT^F^^2;2^K:$L(X)>10!($L(X)<1) X
"^DD",101.41,101.412,22,3)
Answer must be 1-10 characters in length.
"^DD",101.41,101.412,22,21,0)
^^15^15^2971207^^^^
"^DD",101.41,101.412,22,21,1,0)
This is a string of characters that will define any exceptions to how
"^DD",101.41,101.412,22,21,2,0)
the external form of this value is generated.  Possible values include:
"^DD",101.41,101.412,22,21,3,0)
  Pointer         -> <field #>~<piece in RPC list of field #>, default =.01
"^DD",101.41,101.412,22,21,4,0)
  Set of Codes    -> 1~<piece in RPC list of code> to use code for name
"^DD",101.41,101.412,22,21,5,0)
  Date/Time       -> Format string to pass $$FMTE^XLFDT (default = 2)
"^DD",101.41,101.412,22,21,6,0)
  
"^DD",101.41,101.412,22,21,7,0)
  Suppress value  -> @
"^DD",101.41,101.412,22,21,8,0)
  Replace value   -> @<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,9,0)
                      whose value, when present, supersedes this value
"^DD",101.41,101.412,22,21,10,0)
  Required value  -> *<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,11,0)
                      whose value is required to be present to include
"^DD",101.41,101.412,22,21,12,0)
                      this value
"^DD",101.41,101.412,22,21,13,0)
  Ignore if same  -> =<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,14,0)
                      whose value, if the external form is the same,
"^DD",101.41,101.412,22,21,15,0)
                      supersedes this value
"^DD",101.41,101.412,22,"DT")
2960226
"^DD",101.41,101.412,23,0)
OMIT TEXT^F^^2;3^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,23,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,23,21,0)
^^3^3^2970829^^^^
"^DD",101.41,101.412,23,21,1,0)
This is the external form of a value that is not to be included when building
"^DD",101.41,101.412,23,21,2,0)
the order text.  E.g. to include the urgency in the order text unless it
"^DD",101.41,101.412,23,21,3,0)
is routine, enter "ROUTINE" here.
"^DD",101.41,101.412,23,"DT")
2970829
"^DD",101.41,101.412,24,0)
LEADING TEXT^F^^2;4^K:$L(X)>80!($L(X)<1) X
"^DD",101.41,101.412,24,3)
Answer must be 1-80 characters in length.
"^DD",101.41,101.412,24,21,0)
^^3^3^2970724^^^^
"^DD",101.41,101.412,24,21,1,0)
This field contains text that will be appended to the order text
"^DD",101.41,101.412,24,21,2,0)
immediately in front of this value, e.g. "Instructions:".  If this text
"^DD",101.41,101.412,24,21,3,0)
is contained in a variable, enter @NAME where NAME is the variable name.
"^DD",101.41,101.412,24,"DT")
2970724
"^DD",101.41,101.412,25,0)
TRAILING TEXT^F^^2;5^K:$L(X)>80!($L(X)<1) X
"^DD",101.41,101.412,25,3)
Answer must be 1-80 characters in length.
"^DD",101.41,101.412,25,21,0)
^^3^3^2970724^^^^
"^DD",101.41,101.412,25,21,1,0)
This field contains text that will be appended to the order text
"^DD",101.41,101.412,25,21,2,0)
immediately following this value, e.g. "refills".  If this text is
"^DD",101.41,101.412,25,21,3,0)
contained in a variable, enter @NAME where NAME is the variable name.
"^DD",101.41,101.412,25,"DT")
2970724
"^DD",101.41,101.412,26,0)
START NEW LINE^S^1:YES;0:NO;^2;6^Q
"^DD",101.41,101.412,26,3)
Enter YES if this value should begin on a new line in the order text.
"^DD",101.41,101.412,26,21,0)
0^^2^2^2970911^
"^DD",101.41,101.412,26,21,1,0)
This field determines if this value is concatenated onto the current line
"^DD",101.41,101.412,26,21,2,0)
when building the order text, or if a new line is started with this value.
"^DD",101.41,101.412,26,"DT")
2970911
"^DD",101.41,101.412,27,0)
WORD-WRAP^S^1:DON'T WRAP;0:WRAP;^2;7^Q
"^DD",101.41,101.412,27,3)
Enter 'Don't Wrap' to have the text be added line-by-line as it is stored; the default formatting is 'Wrap'.
"^DD",101.41,101.412,27,21,0)
^^3^3^2970926^^^
"^DD",101.41,101.412,27,21,1,0)
This field determines if this text should be wrapped when added to the
"^DD",101.41,101.412,27,21,2,0)
order text, or appended line by line as stored in the file; this is only
"^DD",101.41,101.412,27,21,3,0)
used for word-processing type prompts.
"^DD",101.41,101.412,27,"DT")
2970926
"^DD",101.41,101.412,101,0)
WINDOWS CONTROL^F^^W;1^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,101,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,101,21,0)
^^2^2^2950715^
"^DD",101.41,101.412,101,21,1,0)
Stores the type of Windows control necessary to get the data for this
"^DD",101.41,101.412,101,21,2,0)
prompt.
"^DD",101.41,101.412,101,"DT")
2960517
"^DD",101.41,101.412,102,0)
API NAME^F^^W;2^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,102,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,102,21,0)
^^3^3^2950715^
"^DD",101.41,101.412,102,21,1,0)
This is the API that should be called when the control is used.  How the API
"^DD",101.41,101.412,102,21,2,0)
is used varys with the control.  Examples are: filling list boxes, getting
"^DD",101.41,101.412,102,21,3,0)
boilerplate text, etc.
"^DD",101.41,101.412,102,"DT")
2951002
"^DD",101.41,101.412,103,0)
API PARAMETER #1^F^^W;3^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,103,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,103,21,0)
^^1^1^2950715^
"^DD",101.41,101.412,103,21,1,0)
A parameter that is used by the API call may be stored here.
"^DD",101.41,101.412,103,"DT")
2950715
"^DD",101.41,101.412,113,0)
WINDOWS CONDITION^K^^W3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,113,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,113,9)
@
"^DD",101.41,101.412,113,21,0)
^^3^3^2950715^
"^DD",101.41,101.412,113,21,1,0)
This is silent code that is executed when building the dialog for windows.
"^DD",101.41,101.412,113,21,2,0)
It identifies which prompts should be included in the dialog.  The condition
"^DD",101.41,101.412,113,21,3,0)
should leave $T false if the prompt should not be asked.
"^DD",101.41,101.412,113,"DT")
2950715
"^DD",101.41,101.412,117,0)
WINDOWS DEFAULT^K^^W7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,117,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,117,9)
@
"^DD",101.41,101.412,117,21,0)
^^2^2^2950715^
"^DD",101.41,101.412,117,21,1,0)
This code should silently set the default value of a prompt when it is 
"^DD",101.41,101.412,117,21,2,0)
selected.
"^DD",101.41,101.412,117,"DT")
2950715
"^DD",101.41,101.41218,0)
DEFAULT WORD-PROCESSING TEXT SUB-FIELD^^.01^1
"^DD",101.41,101.41218,0,"DT")
2950407
"^DD",101.41,101.41218,0,"NM","DEFAULT WORD-PROCESSING TEXT")

"^DD",101.41,101.41218,0,"UP")
101.412
"^DD",101.41,101.41218,.01,0)
DEFAULT WORD-PROCESSING TEXT^W^^0;1^Q
"^DD",101.41,101.41218,.01,3)
Enter the default response for a word-processing type prompt.
"^DD",101.41,101.41218,.01,21,0)
^^2^2^2950407^
"^DD",101.41,101.41218,.01,21,1,0)
This field contains the text to be presented as the default for this prompt,
"^DD",101.41,101.41218,.01,21,2,0)
for word-processing type prompts.
"^DD",101.41,101.41218,.01,"DT")
2950407
"^DD",101.41,101.415,0)
CONTROLS SUB-FIELD^^14^14
"^DD",101.41,101.415,0,"DT")
2960202
"^DD",101.41,101.415,0,"IX","AC",101.415,3)

"^DD",101.41,101.415,0,"IX","B",101.415,.01)

"^DD",101.41,101.415,0,"NM","CONTROLS")

"^DD",101.41,101.415,0,"UP")
101.41
"^DD",101.41,101.415,.01,0)
LOGICAL NAME^MF^^0;1^K:$L(X)>8!($L(X)<1)!'(X?1.8U) X
"^DD",101.41,101.415,.01,1,0)
^.1
"^DD",101.41,101.415,.01,1,1,0)
101.415^B
"^DD",101.41,101.415,.01,1,1,1)
S ^ORD(101.41,DA(1),50,"B",$E(X,1,30),DA)=""
"^DD",101.41,101.415,.01,1,1,2)
K ^ORD(101.41,DA(1),50,"B",$E(X,1,30),DA)
"^DD",101.41,101.415,.01,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,.01,21,0)
^^1^1^2960202^
"^DD",101.41,101.415,.01,21,1,0)
This is the name by which controls can refer to each other.
"^DD",101.41,101.415,.01,"DT")
2960202
"^DD",101.41,101.415,2,0)
ITEM^P101.41'^ORD(101.41,^0;2^Q
"^DD",101.41,101.415,2,"DT")
2960202
"^DD",101.41,101.415,3,0)
CREATE SEQUENCE^NJ2,0^^0;3^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,3,1,0)
^.1
"^DD",101.41,101.415,3,1,1,0)
101.415^AC
"^DD",101.41,101.415,3,1,1,1)
S ^ORD(101.41,DA(1),50,"AC",$E(X,1,30),DA)=""
"^DD",101.41,101.415,3,1,1,2)
K ^ORD(101.41,DA(1),50,"AC",$E(X,1,30),DA)
"^DD",101.41,101.415,3,1,1,"%D",0)
^^2^2^2960202^
"^DD",101.41,101.415,3,1,1,"%D",1,0)
The 'AC' cross-reference puts in window controls in order by creation 
"^DD",101.41,101.415,3,1,1,"%D",2,0)
sequence.
"^DD",101.41,101.415,3,1,1,"DT")
2960202
"^DD",101.41,101.415,3,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",101.41,101.415,3,"DT")
2960202
"^DD",101.41,101.415,4,0)
CONTROL TYPE^S^0:Label;1:Button;2:Edit;3:Memo;4:ListBox;5:SimpleCombo;6:DropDownList;7:LongCombo;^0;4^Q
"^DD",101.41,101.415,4,"DT")
2960202
"^DD",101.41,101.415,5,0)
LABEL^F^^0;5^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.415,5,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.415,5,"DT")
2960202
"^DD",101.41,101.415,6,0)
BESIDE^F^^0;6^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,6,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,6,"DT")
2960202
"^DD",101.41,101.415,7,0)
BELOW^F^^0;7^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,7,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,7,"DT")
2960202
"^DD",101.41,101.415,8,0)
WIDTH^NJ6,4^^0;8^K:+X'=X!(X>1)!(X<0)!(X?.E1"."5N.N) X
"^DD",101.41,101.415,8,3)
Type a Number between 0 and 1, 4 Decimal Digits
"^DD",101.41,101.415,8,"DT")
2960202
"^DD",101.41,101.415,9,0)
LEFT CONTROL^F^^0;9^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,9,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,9,"DT")
2960202
"^DD",101.41,101.415,10,0)
RIGHT CONTROL^F^^0;10^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,10,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,10,"DT")
2960202
"^DD",101.41,101.415,11,0)
HEIGHT^NJ2,0^^0;11^K:+X'=X!(X>15)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,11,3)
Type a Number between 1 and 15, 0 Decimal Digits
"^DD",101.41,101.415,11,"DT")
2960202
"^DD",101.41,101.415,12,0)
UPPER CONTROL^F^^0;12^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,12,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,12,"DT")
2960202
"^DD",101.41,101.415,13,0)
LOWER CONTROL^F^^0;13^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,13,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,13,"DT")
2960202
"^DD",101.41,101.415,14,0)
TAB SEQUENCE^NJ2,0^^0;14^K:+X'=X!(X>89)!(X<0)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,14,3)
Type a Number between 0 and 89, 0 Decimal Digits
"^DD",101.41,101.415,14,"DT")
2960202
"^DD",101.41,101.416,0)
RESPONSES SUB-FIELD^^2^5
"^DD",101.41,101.416,0,"DT")
2960717
"^DD",101.41,101.416,0,"IX","D",101.416,.02)

"^DD",101.41,101.416,0,"NM","RESPONSES")

"^DD",101.41,101.416,0,"UP")
101.41
"^DD",101.41,101.416,.01,0)
ITEM ENTRY^MNJ7,0^^0;1^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.416,.01,1,0)
^.1^^0
"^DD",101.41,101.416,.01,3)
Type a Number between 1 and 9999999, 0 Decimal Digits
"^DD",101.41,101.416,.01,21,0)
^^2^2^2971219^^^
"^DD",101.41,101.416,.01,21,1,0)
This is the internal entry number of the prompt in the Item multiple
"^DD",101.41,101.416,.01,21,2,0)
by which this response was obtained.
"^DD",101.41,101.416,.01,"DT")
2961118
"^DD",101.41,101.416,.02,0)
DIALOG^P101.41'^ORD(101.41,^0;2^Q
"^DD",101.41,101.416,.02,1,0)
^.1
"^DD",101.41,101.416,.02,1,1,0)
101.416^D
"^DD",101.41,101.416,.02,1,1,1)
S ^ORD(101.41,DA(1),6,"D",$E(X,1,30),DA)=""
"^DD",101.41,101.416,.02,1,1,2)
K ^ORD(101.41,DA(1),6,"D",$E(X,1,30),DA)
"^DD",101.41,101.416,.02,1,1,"DT")
2961118
"^DD",101.41,101.416,.02,3)
Select the dialog prompt from which this response was generated.
"^DD",101.41,101.416,.02,21,0)
^^2^2^2960717^
"^DD",101.41,101.416,.02,21,1,0)
This is a pointer to the dialog prompt, which is in the Order Dialog file
"^DD",101.41,101.416,.02,21,2,0)
as type prompt.
"^DD",101.41,101.416,.02,"DT")
2961118
"^DD",101.41,101.416,.03,0)
INSTANCE^NJ7,0^^0;3^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.416,.03,3)
Type a Number between 1 and 9999999, 0 Decimal Digits
"^DD",101.41,101.416,.03,21,0)
^^2^2^2960717^
"^DD",101.41,101.416,.03,21,1,0)
In the case of multiple answers for the same item, this identifies the
"^DD",101.41,101.416,.03,21,2,0)
individual instance.
"^DD",101.41,101.416,.03,"DT")
2960717
"^DD",101.41,101.416,1,0)
VALUE^FO^^1;1^K:$L(X)>245!($L(X)<1) X
"^DD",101.41,101.416,1,2)
S Y(0)=Y S Y=$$OUTPUT^ORCMEDT5(Y)
"^DD",101.41,101.416,1,2.1)
S Y=$$OUTPUT^ORCMEDT5(Y)
"^DD",101.41,101.416,1,3)
Answer must be 1-245 characters in length.
"^DD",101.41,101.416,1,21,0)
^^2^2^2971219^^
"^DD",101.41,101.416,1,21,1,0)
This contains the actual response, unless the value is a word processing
"^DD",101.41,101.416,1,21,2,0)
type.
"^DD",101.41,101.416,1,"DT")
2980717
"^DD",101.41,101.416,2,0)
TEXT^101.4162^^2;0
"^DD",101.41,101.416,2,21,0)
^^1^1^2971219^
"^DD",101.41,101.416,2,21,1,0)
This contains the actual response, for word-processing type prompts.
"^DD",101.41,101.416,2,"DT")
2960717
"^DD",101.41,101.4162,0)
TEXT SUB-FIELD^^.01^1
"^DD",101.41,101.4162,0,"DT")
2960717
"^DD",101.41,101.4162,0,"NM","TEXT")

"^DD",101.41,101.4162,0,"UP")
101.416
"^DD",101.41,101.4162,.01,0)
TEXT^WL^^0;1^Q
"^DD",101.41,101.4162,.01,21,0)
^^1^1^2960717^^
"^DD",101.41,101.4162,.01,21,1,0)
This contains responses to items that are a word processing type.
"^DD",101.41,101.4162,.01,"DT")
2960717
"^DIC",101.24,101.24,0)
OE/RR REPORT^101.24
"^DIC",101.24,101.24,0,"GL")
^ORD(101.24,
"^DIC",101.24,101.24,"%",0)
^1.005^^0
"^DIC",101.24,101.24,"%D",0)
^1.001^7^7^3020924^^^
"^DIC",101.24,101.24,"%D",1,0)
This file contains definitions and parameters used in various reports
"^DIC",101.24,101.24,"%D",2,0)
within CPRS.
"^DIC",101.24,101.24,"%D",3,0)
 
"^DIC",101.24,101.24,"%D",4,0)
Entry numbers >1000 are reserved for national use.  Any local entries
"^DIC",101.24,101.24,"%D",5,0)
should be added to a number <1000.  If this convention is not followed,
"^DIC",101.24,101.24,"%D",6,0)
you run the risk of having your local entries overwritten by a patch
"^DIC",101.24,101.24,"%D",7,0)
or future release of CPRS.
"^DIC",101.24,"B","OE/RR REPORT",101.24)

"^DIC",101.41,101.41,0)
ORDER DIALOG^101.41
"^DIC",101.41,101.41,0,"GL")
^ORD(101.41,
"^DIC",101.41,101.41,"%D",0)
^^2^2^2960819^^
"^DIC",101.41,101.41,"%D",1,0)
This file contains the information needed to define how to prompt for each
"^DIC",101.41,101.41,"%D",2,0)
order, what values are acceptable, etc.
"^DIC",101.41,"B","ORDER DIALOG",101.41)

**END**
**END**
