Released LBR*2.5*3 SEQ #4
Extracted from mail message
**KIDS**:LBR*2.5*3^

**INSTALL NAME**
LBR*2.5*3
"BLD",12,0)
LBR*2.5*3^Library^0^^y
"BLD",12,1,0)
^^3^3^2971121^^^^
"BLD",12,1,1,0)
Patch to version 2.5 which allows for Primary Stations and Legacy Stations
"BLD",12,1,2,0)
on one system.  Will merge data from a Legacy Station into a Primary Station's
"BLD",12,1,3,0)
database.
"BLD",12,4,0)
^9.64PA^^0
"BLD",12,"ABPKG")
n
"BLD",12,"INI")
LBRVCONP
"BLD",12,"INIT")
LBRVCONS
"BLD",12,"KRN",0)
^9.67PA^.84^11
"BLD",12,"KRN",.4,0)
.4
"BLD",12,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",12,"KRN",.401,0)
.401
"BLD",12,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",12,"KRN",.402,0)
.402
"BLD",12,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",12,"KRN",.403,0)
.403
"BLD",12,"KRN",.403,"NM",0)
^9.68A^^
"BLD",12,"KRN",.5,0)
.5
"BLD",12,"KRN",.5,"NM",0)
^9.68A^^
"BLD",12,"KRN",.84,0)
.84
"BLD",12,"KRN",.84,"NM",0)
^9.68A^^
"BLD",12,"KRN",3.6,0)
3.6
"BLD",12,"KRN",3.6,"NM",0)
^9.68A^^0
"BLD",12,"KRN",9.2,0)
9.2
"BLD",12,"KRN",9.2,"NM",0)
^9.68A^^0
"BLD",12,"KRN",9.8,0)
9.8
"BLD",12,"KRN",9.8,"NM",0)
^9.68A^69^6
"BLD",12,"KRN",9.8,"NM",62,0)
LBRVCON2^^0^B12869206
"BLD",12,"KRN",9.8,"NM",63,0)
LBRVCONE^^0^B19520509
"BLD",12,"KRN",9.8,"NM",64,0)
LBRVCONP^^0^B11522672
"BLD",12,"KRN",9.8,"NM",65,0)
LBRVCONS^^0^B25664417
"BLD",12,"KRN",9.8,"NM",68,0)
LBRVCON3^^0^B9082027
"BLD",12,"KRN",9.8,"NM",69,0)
LBRVCON1^^0^B2218746
"BLD",12,"KRN",9.8,"NM","B","LBRVCON1",69)

"BLD",12,"KRN",9.8,"NM","B","LBRVCON2",62)

"BLD",12,"KRN",9.8,"NM","B","LBRVCON3",68)

"BLD",12,"KRN",9.8,"NM","B","LBRVCONE",63)

"BLD",12,"KRN",9.8,"NM","B","LBRVCONP",64)

"BLD",12,"KRN",9.8,"NM","B","LBRVCONS",65)

"BLD",12,"KRN",19,0)
19
"BLD",12,"KRN",19,"NM",0)
^9.68A^^0
"BLD",12,"KRN",19.1,0)
19.1
"BLD",12,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",12,"KRN","B",.4,.4)

"BLD",12,"KRN","B",.401,.401)

"BLD",12,"KRN","B",.402,.402)

"BLD",12,"KRN","B",.403,.403)

"BLD",12,"KRN","B",.5,.5)

"BLD",12,"KRN","B",.84,.84)

"BLD",12,"KRN","B",3.6,3.6)

"BLD",12,"KRN","B",9.2,9.2)

"BLD",12,"KRN","B",9.8,9.8)

"BLD",12,"KRN","B",19,19)

"BLD",12,"KRN","B",19.1,19.1)

"BLD",12,"PRE")
LBRVCONE
"BLD",12,"QUES",0)
^9.62^1^1
"BLD",12,"QUES",1,0)
PRE1
"BLD",12,"QUES",1,1)
Y
"BLD",12,"QUES",1,"A")
 
"BLD",12,"QUES",1,"M")
D QUES^LBRVCONE S:QUIT XPDQUIT=2 K DIR
"BLD",12,"QUES","B","PRE1",1)

"BLD",12,"REQB",0)
^9.611^3^1
"BLD",12,"REQB",3,0)
LBR*2.5*2^1
"BLD",12,"REQB","B","LBR*2.5*2",3)

"INI")
LBRVCONP
"INIT")
LBRVCONS
"PKG",10,-1)
1^1
"PKG",10,0)
Library^LBR^LIBRARY SERIALS PACKAGE^LBRY MANAGEMENT
"PKG",10,22,0)
^9.49I^1^1
"PKG",10,22,1,0)
2.5^2960227^
"PKG",10,22,1,"PAH",1,0)
3
"PKG",10,22,1,"PAH",1,1,0)
^^3^3^2980316
"PKG",10,22,1,"PAH",1,1,1,0)
Patch to version 2.5 which allows for Primary Stations and Legacy Stations
"PKG",10,22,1,"PAH",1,1,2,0)
on one system.  Will merge data from a Legacy Station into a Primary Station's
"PKG",10,22,1,"PAH",1,1,3,0)
database.
"PRE")
LBRVCONE
"QUES","PRE1",0)
Y
"QUES","PRE1","A")
 
"QUES","PRE1","M")
D QUES^LBRVCONE S:QUIT XPDQUIT=2 K DIR
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","LBRVCON1")
0^69^B2218746
"RTN","LBRVCON1",1,0)
LBRVCON1 ;SSI/ALA-Consolidate library files continued ;[ 02/04/98  4:59 PM ]
"RTN","LBRVCON1",2,0)
 ;;2.5;Library;**3**;Mar 11, 1996
"RTN","LBRVCON1",3,0)
INF ;  Inform FORUM when integration is completed for VA library sites
"RTN","LBRVCON1",4,0)
 S CODE="" F I=1:1 S CODE=$O(^LBRY(680.6,"C",CODE)) Q:CODE=""  D
"RTN","LBRVCON1",5,0)
 . S MES(I)="Library Station "_$G(CODE)_" has been integrated." Q
"RTN","LBRVCON1",6,0)
 S MES(I+1)="Please update associated DOMAINs."
"RTN","LBRVCON1",7,0)
 S TRNSM=$S($G(^XMB("NETNAME"))["SENTIENT":"BBB.SENTIENT.ISC-WASH.VA.GOV",1:"FORUM.VA.GOV")
"RTN","LBRVCON1",8,0)
 S XMDUZ=DUZ,XMSUB="LIBRARY PATCH 3 LOADED",XMY("G.LBRYRECV@"_TRNSM)=""
"RTN","LBRVCON1",9,0)
 S XMTEXT="MES("
"RTN","LBRVCON1",10,0)
 D ^XMD K XMSUB,XMY,XMTEXT,MSG,XMZ,XMDUZ,MES,TRNSM
"RTN","LBRVCON1",11,0)
EXIT D MES^XPDUTL("I am now re-indexing all cross-references")
"RTN","LBRVCON1",12,0)
 D REINDX
"RTN","LBRVCON1",13,0)
 Q
"RTN","LBRVCON1",14,0)
REINDX ; reindex crossreferences
"RTN","LBRVCON1",15,0)
 W !
"RTN","LBRVCON1",16,0)
 F J=680,681,682,680.4,680.7,680.3,680.5 S LX="A" F  S LX=$O(^LBRY(J,LX)) Q:LX=""  K ^LBRY(J,LX)
"RTN","LBRVCON1",17,0)
 F DIK="^LBRY(680,","^LBRY(681,","^LBRY(682,","^LBRY(680.4,","^LBRY(680.7,","^LBRY(680.3,","^LBRY(680.5," D
"RTN","LBRVCON1",18,0)
 . W DIK,! D IXALL^DIK
"RTN","LBRVCON1",19,0)
 Q
"RTN","LBRVCON2")
0^62^B12869206
"RTN","LBRVCON2",1,0)
LBRVCON2 ;SSI/ALA-Consolidate files continued ;[ 10/15/97  5:00 PM ]
"RTN","LBRVCON2",2,0)
 ;;2.5;Library;**3**;Mar 11, 1996
"RTN","LBRVCON2",3,0)
EN ;  Continue with update
"RTN","LBRVCON2",4,0)
 I $P(^LBRY(680.6,0),U,4)=1 Q
"RTN","LBRVCON2",5,0)
 I '$$VERCP^XPDUTL("ODA4"_NUM) D STP4 S %=$$COMCP^XPDUTL("ODA4"_NUM)
"RTN","LBRVCON2",6,0)
 S DA=0 F  S DA=$O(^XTMP("LBRY",LBRVSTA,681,DA)) Q:'DA  D
"RTN","LBRVCON2",7,0)
 . S TDA=$P(^XTMP("LBRY",LBRVSTA,681,DA,0),U,2)
"RTN","LBRVCON2",8,0)
 . I TDA="" K ^XTMP("LBRY",LBRVSTA,681,DA) Q
"RTN","LBRVCON2",9,0)
 . S ^XTMP("LBRY",LBRVSTA,681,"C",TDA,DA)=""
"RTN","LBRVCON2",10,0)
 S DA=0 F  S DA=$O(^XTMP("LBRY",LBRVSTA,682,DA)) Q:'DA  D
"RTN","LBRVCON2",11,0)
 . S TDA=$P(^XTMP("LBRY",LBRVSTA,682,DA,0),U,2)
"RTN","LBRVCON2",12,0)
 . I TDA="" K ^XTMP("LBRY",LBRVSTA,682,DA) Q
"RTN","LBRVCON2",13,0)
 . S ^XTMP("LBRY",LBRVSTA,682,"C",TDA,DA)=""
"RTN","LBRVCON2",14,0)
 I '$$VERCP^XPDUTL("ODA5"_NUM) D STP5 S %=$$COMCP^XPDUTL("ODA5"_NUM)
"RTN","LBRVCON2",15,0)
 I '$$VERCP^XPDUTL("CON3"_NUM) D ^LBRVCON3 S %=$$COMCP^XPDUTL("CON3"_NUM)
"RTN","LBRVCON2",16,0)
 K NDA,ODA,USRN,LDA,TDA,Y,%X,%Y,DA,TDA1,VNDN,X,LBRYCLS,USR
"RTN","LBRVCON2",17,0)
 Q
"RTN","LBRVCON2",18,0)
STP4 D MES^XPDUTL("I am beginning Step 4....for "_LBRVSTA_" at "_$$HTE^XLFDT($H))
"RTN","LBRVCON2",19,0)
 ;  For each local title moved from original site, set into new site
"RTN","LBRVCON2",20,0)
 S T1=99000 F  S T1=$O(^XTMP("LBRY",LBRVSTA,680.5,T1)) Q:'T1  S LT1=T1
"RTN","LBRVCON2",21,0)
 S T2=99000 F  S T2=$O(^LBRY(680.5,T2)) Q:'T2  S LT2=T2
"RTN","LBRVCON2",22,0)
 Q:'$D(LT1)
"RTN","LBRVCON2",23,0)
 S LT=$S(LT1>LT2:LT1,1:LT2)
"RTN","LBRVCON2",24,0)
 S $P(^LBRY(680.5,0),"^",3)=LT
"RTN","LBRVCON2",25,0)
 S ODA=+$$PARCP^XPDUTL("ODA4"_NUM)
"RTN","LBRVCON2",26,0)
GDA4 S ODA=$O(^XTMP("LBRY",LBRVSTA,680.5,ODA)) Q:ODA'>0
"RTN","LBRVCON2",27,0)
 S DINUM=LT
"RTN","LBRVCON2",28,0)
 F  S DINUM=DINUM+1 Q:'$D(^LBRY(680.5,DINUM,0))
"RTN","LBRVCON2",29,0)
 S X=DINUM,DLAYGO=680.5,DIC(0)="L",DIC="^LBRY(680.5,"
"RTN","LBRVCON2",30,0)
 D FILE^DICN S (NDA,LBRYCLS)=+Y
"RTN","LBRVCON2",31,0)
 ;  Set Local Serials
"RTN","LBRVCON2",32,0)
 S TDA="" F  S TDA=$O(^XTMP("LBRY",LBRVSTA,680,"B",ODA,TDA)) Q:TDA=""  D
"RTN","LBRVCON2",33,0)
 . K ^XTMP("LBRY",LBRVSTA,680,"B",ODA,TDA)
"RTN","LBRVCON2",34,0)
 . S $P(^XTMP("LBRY",LBRVSTA,680,TDA,0),U,1)=NDA
"RTN","LBRVCON2",35,0)
 S TDA="" F  S TDA=$O(^XTMP("LBRY",LBRVSTA,681,"C",ODA,TDA)) Q:TDA=""  D
"RTN","LBRVCON2",36,0)
 . K ^XTMP("LBRY",LBRVSTA,681,"C",ODA,TDA)
"RTN","LBRVCON2",37,0)
 . S $P(^XTMP("LBRY",LBRVSTA,681,TDA,0),U,2)=NDA
"RTN","LBRVCON2",38,0)
 S TDA="" F  S TDA=$O(^XTMP("LBRY",LBRVSTA,682,"C",ODA,TDA)) Q:TDA=""  D
"RTN","LBRVCON2",39,0)
 . K ^XTMP("LBRY",LBRVSTA,682,"C",ODA,TDA)
"RTN","LBRVCON2",40,0)
 . S $P(^XTMP("LBRY",LBRVSTA,682,TDA,0),U,2)=NDA
"RTN","LBRVCON2",41,0)
 ;  Move data over in TAF
"RTN","LBRVCON2",42,0)
 S %X="^XTMP(""LBRY"",LBRVSTA,680.5,"_ODA_",",%Y="^LBRY(680.5,"_NDA_"," D %XY^%RCR
"RTN","LBRVCON2",43,0)
 ;  Reset cross-references
"RTN","LBRVCON2",44,0)
 ;S DA=NDA D ^LBRYX53
"RTN","LBRVCON2",45,0)
 ;  Create transaction for FORUM
"RTN","LBRVCON2",46,0)
 I ODA>99000&(NDA>99000) D ^LBRYLTF
"RTN","LBRVCON2",47,0)
 S %=$$UPCP^XPDUTL("ODA4"_NUM,ODA) G GDA4
"RTN","LBRVCON2",48,0)
STP5 D MES^XPDUTL("I am beginning Step 5....for "_LBRVSTA_" at "_$$HTE^XLFDT($H))
"RTN","LBRVCON2",49,0)
 S $P(^LBRY(680,0),"^",3)=1,ODA=+$$PARCP^XPDUTL("ODA5"_NUM)
"RTN","LBRVCON2",50,0)
GDA5 S ODA=$O(^XTMP("LBRY",LBRVSTA,680,ODA)) Q:ODA'>0
"RTN","LBRVCON2",51,0)
 S VND=$P($G(^XTMP("LBRY",LBRVSTA,680,ODA,2)),U,5)
"RTN","LBRVCON2",52,0)
 I VND'="" D
"RTN","LBRVCON2",53,0)
 . S VND=$P(VND,"*",1)
"RTN","LBRVCON2",54,0)
 . S VNDN=$O(^PRC(440,"B",VND,""))
"RTN","LBRVCON2",55,0)
 . I VNDN'="" S $P(^XTMP("LBRY",LBRVSTA,680,ODA,2),U,5)=VND
"RTN","LBRVCON2",56,0)
NNDA ;  Get next available DA
"RTN","LBRVCON2",57,0)
 S DINUM=0 F  S DINUM=DINUM+1 Q:'$D(^LBRY(680,DINUM,0))
"RTN","LBRVCON2",58,0)
 S X=DINUM,DLAYGO=680,DIC(0)="L",DIC="^LBRY(680,"
"RTN","LBRVCON2",59,0)
 D FILE^DICN S (DA,NDA)=+Y
"RTN","LBRVCON2",60,0)
 S %X="^XTMP(""LBRY"",LBRVSTA,680,"_ODA_",",%Y="^LBRY(680,"_NDA_"," D %XY^%RCR
"RTN","LBRVCON2",61,0)
 S OTDA=$P(^XTMP("LBRY",LBRVSTA,680,ODA,0),U)
"RTN","LBRVCON2",62,0)
 S DIE=DIC,DR=".01////^S X=OTDA" D ^DIE
"RTN","LBRVCON2",63,0)
 F I=3,4,6,13 K ^LBRY(680,NDA,I,"B")
"RTN","LBRVCON2",64,0)
 I $G(^LBRY(680,NDA,3,0))'="" S $P(^(0),U,2)="680.03PA"
"RTN","LBRVCON2",65,0)
 I $G(^LBRY(680,NDA,4,0))'="" S $P(^(0),U,2)="680.01SA"
"RTN","LBRVCON2",66,0)
 I $G(^LBRY(680,NDA,6,0))'="" S $P(^(0),U,2)="680.02SA"
"RTN","LBRVCON2",67,0)
 S DA=ODA D ^LBRYX12 S DA=NDA D ^LBRYX14
"RTN","LBRVCON2",68,0)
 S PDA=$P(^LBRY(680,NDA,0),U)
"RTN","LBRVCON2",69,0)
 S TDA=""
"RTN","LBRVCON2",70,0)
 F  S TDA=$O(^XTMP("LBRY",LBRVSTA,681,"C",PDA,TDA)) Q:TDA=""  D
"RTN","LBRVCON2",71,0)
 . S $P(^XTMP("LBRY",LBRVSTA,681,TDA,0),U,2)=NDA K ^XTMP("LBRY",LBRVSTA,681,"C",ODA,TDA)
"RTN","LBRVCON2",72,0)
 F  S TDA=$O(^XTMP("LBRY",LBRVSTA,682,"C",PDA,TDA)) Q:TDA=""  D
"RTN","LBRVCON2",73,0)
 . S $P(^XTMP("LBRY",LBRVSTA,682,TDA,0),U,2)=NDA
"RTN","LBRVCON2",74,0)
 . K ^XTMP("LBRY",LBRVSTA,682,"C",ODA,TDA)
"RTN","LBRVCON2",75,0)
 S %=$$UPCP^XPDUTL("ODA5"_NUM,ODA) G GDA5
"RTN","LBRVCON3")
0^68^B9082027
"RTN","LBRVCON3",1,0)
LBRVCON3 ;SSI/ALA/KMB - STEPS 6 AND 7 [ 08/28/97  1:50 PM ]
"RTN","LBRVCON3",2,0)
 ;;2.5;Library;**3**;Mar 11, 1996
"RTN","LBRVCON3",3,0)
EN I '$$VERCP^XPDUTL("ODA6"_NUM) D STP6 S %=$$COMCP^XPDUTL("ODA6"_NUM)
"RTN","LBRVCON3",4,0)
 I '$$VERCP^XPDUTL("ODA7"_NUM) D STP7 S %=$$COMCP^XPDUTL("ODA7"_NUM)
"RTN","LBRVCON3",5,0)
 Q
"RTN","LBRVCON3",6,0)
STP6 S ODA=+$$PARCP^XPDUTL("ODA6"_NUM)
"RTN","LBRVCON3",7,0)
 D MES^XPDUTL("I am beginning Step 6....for "_LBRVSTA_" at "_$$HTE^XLFDT($H))
"RTN","LBRVCON3",8,0)
 F I="AC","B","C","D","E" K ^LBRY(681,I)
"RTN","LBRVCON3",9,0)
 S $P(^LBRY(681,0),"^",3)=1,$P(^LBRY(682,0),"^",3)=1
"RTN","LBRVCON3",10,0)
GDA6 S ODA=$O(^XTMP("LBRY",LBRVSTA,681,ODA)) Q:ODA'>0
"RTN","LBRVCON3",11,0)
 S USR=$P($G(^XTMP("LBRY",LBRVSTA,681,ODA,1)),U,3)
"RTN","LBRVCON3",12,0)
 I USR'="" D
"RTN","LBRVCON3",13,0)
 . S USR=$P(USR,"*",1)
"RTN","LBRVCON3",14,0)
 . S USRN=$O(^VA(200,"B",USR,""))
"RTN","LBRVCON3",15,0)
 . I USRN'="" S $P(^XTMP("LBRY",LBRVSTA,681,ODA,1),U,3)=USRN
"RTN","LBRVCON3",16,0)
 S VND=$P($G(^XTMP("LBRY",LBRVSTA,681,ODA,1)),U,5)
"RTN","LBRVCON3",17,0)
 I VND'="" D
"RTN","LBRVCON3",18,0)
 . S VND=$P(VND,"*",1)
"RTN","LBRVCON3",19,0)
 . S VNDN=$O(^PRC(440,"B",VND,""))
"RTN","LBRVCON3",20,0)
 . I VNDN'="" S $P(^XTMP("LBRY",LBRVSTA,681,ODA,1),U,5)=VND
"RTN","LBRVCON3",21,0)
MNDA ;  Get next available DA
"RTN","LBRVCON3",22,0)
 S DINUM=$P(^LBRY(681,0),"^",3)
"RTN","LBRVCON3",23,0)
 F  S DINUM=DINUM+1 Q:'$D(^LBRY(681,DINUM,0))
"RTN","LBRVCON3",24,0)
 S X=DINUM,DLAYGO=681,DIC(0)="L",DIC="^LBRY(681,"
"RTN","LBRVCON3",25,0)
 D FILE^DICN S (DA,NDA)=+Y
"RTN","LBRVCON3",26,0)
 S %X="^XTMP(""LBRY"",LBRVSTA,681,"_ODA_",",%Y="^LBRY(681,"_NDA_"," D %XY^%RCR
"RTN","LBRVCON3",27,0)
 F I="AC","B" K ^LBRY(681,NDA,2,I)
"RTN","LBRVCON3",28,0)
 S $P(^LBRY(681,NDA,2,0),"^",2)="681.02IPA"
"RTN","LBRVCON3",29,0)
 S $P(^LBRY(681,NDA,0),U)=NDA
"RTN","LBRVCON3",30,0)
 F  S TDA=$O(^XTMP("LBRY",LBRVSTA,682,"ZC",ODA,TDA)) Q:TDA=""  D
"RTN","LBRVCON3",31,0)
 . S TDA1="" F  S TDA1=$O(^XTMP("LBRY",LBRVSTA,682,"ZC",ODA,TDA,TDA1)) Q:TDA1=""  D
"RTN","LBRVCON3",32,0)
 .. S $P(^XTMP("LBRY",LBRVSTA,682,TDA,4,TDA1,0),U,3)=NDA
"RTN","LBRVCON3",33,0)
 .. K ^XTMP("LBRY",LBRVSTA,682,"ZC",ODA,TDA,TDA1)
"RTN","LBRVCON3",34,0)
 S %=$$UPCP^XPDUTL("ODA6"_NUM,ODA) G GDA6
"RTN","LBRVCON3",35,0)
STP7 S ODA=+$$PARCP^XPDUTL("ODA7"_NUM)
"RTN","LBRVCON3",36,0)
 D MES^XPDUTL("I am beginning Step 7....for "_LBRVSTA_" at "_$$HTE^XLFDT($H))
"RTN","LBRVCON3",37,0)
GDA7 S ODA=$O(^XTMP("LBRY",LBRVSTA,682,ODA)) Q:ODA'>0
"RTN","LBRVCON3",38,0)
 S USR=$P($G(^XTMP("LBRY",LBRVSTA,682,ODA,1)),U,6)
"RTN","LBRVCON3",39,0)
 I USR'="" D
"RTN","LBRVCON3",40,0)
 . S USR=$P(USR,"*",1)
"RTN","LBRVCON3",41,0)
 . S USRN=$O(^VA(200,"B",USR,""))
"RTN","LBRVCON3",42,0)
 . I USRN'="" S $P(^XTMP("LBRY",LBRVSTA,682,ODA,1),U,6)=USRN
"RTN","LBRVCON3",43,0)
 S LDA=0 F  S LDA=$O(^XTMP("LBRY",LBRVSTA,682,ODA,4,LDA)) Q:LDA'>0  D
"RTN","LBRVCON3",44,0)
 . S USR=$P($G(^XTMP("LBRY",LBRVSTA,682,ODA,4,LDA,0)),U,4)
"RTN","LBRVCON3",45,0)
 . I USR'="" D
"RTN","LBRVCON3",46,0)
 . . S USR=$P(USR,"*",1)
"RTN","LBRVCON3",47,0)
 . . S USRN=$O(^VA(200,"B",USR,""))
"RTN","LBRVCON3",48,0)
 . . I USRN'="" S $P(^XTMP("LBRY",LBRVSTA,682,ODA,4,LDA,0),U,4)=USRN
"RTN","LBRVCON3",49,0)
 . S USR=$P($G(^XTMP("LBRY",LBRVSTA,682,ODA,4,LDA,0)),U,8)
"RTN","LBRVCON3",50,0)
 . I USR'="" D
"RTN","LBRVCON3",51,0)
 . . S USR=$P(USR,"*",1)
"RTN","LBRVCON3",52,0)
 . . S USRN=$O(^VA(200,"B",USR,""))
"RTN","LBRVCON3",53,0)
 . . I USRN'="" S $P(^XTMP("LBRY",LBRVSTA,682,ODA,4,LDA,0),U,8)=USRN
"RTN","LBRVCON3",54,0)
NNDA ;  Get next available DA
"RTN","LBRVCON3",55,0)
 S DINUM=$P(^LBRY(682,0),"^",3)
"RTN","LBRVCON3",56,0)
 F  S DINUM=DINUM+1 Q:'$D(^LBRY(682,DINUM,0))
"RTN","LBRVCON3",57,0)
 S X=DINUM,DLAYGO=682,DIC(0)="L",DIC="^LBRY(682,"
"RTN","LBRVCON3",58,0)
 D FILE^DICN S (DA,NDA)=+Y
"RTN","LBRVCON3",59,0)
 S %X="^XTMP(""LBRY"",LBRVSTA,682,"_ODA_",",%Y="^LBRY(682,"_NDA_"," D %XY^%RCR
"RTN","LBRVCON3",60,0)
 K ^LBRY(682,NDA,4,"B")
"RTN","LBRVCON3",61,0)
 S $P(^LBRY(682,NDA,0),U)=NDA D ^LBRYX33
"RTN","LBRVCON3",62,0)
 S %=$$UPCP^XPDUTL("ODA7"_NUM,ODA) G GDA7
"RTN","LBRVCONE")
0^63^B19520509
"RTN","LBRVCONE",1,0)
LBRVCONE ;SSI/ALA-Consolidate library files env check ;[ 03/13/98  10:17 AM ]
"RTN","LBRVCONE",2,0)
 ;;2.5;Library;**3**;Mar 11, 1996
"RTN","LBRVCONE",3,0)
 ;
"RTN","LBRVCONE",4,0)
EN ; Checking for patch load requirements
"RTN","LBRVCONE",5,0)
 N QUIT
"RTN","LBRVCONE",6,0)
 I '$G(DUZ)!($G(DUZ(0))'["@") W !,"USER 'DUZ' VARIABLES **NOT** CORRECTLY DEFINED.  CONFIRM THAT DUZ(0)='@'.  THEN D ^XUP." S XPDQUIT=1 Q
"RTN","LBRVCONE",7,0)
 ;
"RTN","LBRVCONE",8,0)
 ;
"RTN","LBRVCONE",9,0)
 S LBRPT2=$$PATCH^XPDUTL("LBR*2.5*2")
"RTN","LBRVCONE",10,0)
 I LBRPT2'=1 D  S XPDQUIT=1 Q
"RTN","LBRVCONE",11,0)
 . W !!,"*** Patch LBR*2.5*2 must be installed prior to loading"
"RTN","LBRVCONE",12,0)
 . W !,"this patch.  This install will now abort.",!
"RTN","LBRVCONE",13,0)
 ;
"RTN","LBRVCONE",14,0)
RX ; re-index file 680.6 for checks
"RTN","LBRVCONE",15,0)
 F LBRXREF="B","C" K ^LBRY(680.6,LBRXREF)
"RTN","LBRVCONE",16,0)
 S DIK="^LBRY(680.6," D IXALL^DIK
"RTN","LBRVCONE",17,0)
LEG ;Check for Legacy Station
"RTN","LBRVCONE",18,0)
 S LBRPRT=$P($G(^XTMP("LBRV",0)),"^",3),LBRSYS=$P(LBRPRT,";",2)
"RTN","LBRVCONE",19,0)
 I LBRSYS="LEG" K LBRSYS,LBRPRT,LBRPT2,LBRXREF Q
"RTN","LBRVCONE",20,0)
 ;
"RTN","LBRVCONE",21,0)
CHK ; check to see if ^XTMP already integrated
"RTN","LBRVCONE",22,0)
 I '$D(^XTMP("LBRY",0)) G WRN
"RTN","LBRVCONE",23,0)
 S LBRCODE=0
"RTN","LBRVCONE",24,0)
ORD S LBRCODE=$O(^XTMP("LBRY",LBRCODE)) G WRN:LBRCODE=""
"RTN","LBRVCONE",25,0)
 S LBRPTR=$O(^LBRY(680.6,"C",LBRCODE,""))
"RTN","LBRVCONE",26,0)
 I LBRPTR="" G WRN
"RTN","LBRVCONE",27,0)
 S LBRDA=0
"RTN","LBRVCONE",28,0)
L680 S LBRDA=$O(^XTMP("LBRY",LBRCODE,680,LBRDA)) G ORD:LBRDA=""
"RTN","LBRVCONE",29,0)
 I $P($G(^XTMP("LBRY",LBRCODE,680,LBRDA,0)),U,4)=LBRPTR G MESS
"RTN","LBRVCONE",30,0)
 G L680
"RTN","LBRVCONE",31,0)
WRN ;  Warning on existence of XTMP global
"RTN","LBRVCONE",32,0)
 I $O(^XTMP("LBRY",0))'="" S QUIT=0 D  I QUIT S XPDQUIT=1,DIRUT=1 Q
"RTN","LBRVCONE",33,0)
 . D MES^XPDUTL("*** WARNING - XTMP global exists! ***")
"RTN","LBRVCONE",34,0)
 . D MES^XPDUTL("This data file will be merged with your data file!")
"RTN","LBRVCONE",35,0)
 . D BMES^XPDUTL("If you are a PRIMARY STATION and need to have this global present,")
"RTN","LBRVCONE",36,0)
 . D MES^XPDUTL(" Enter 'Y'es to install or 'N'o to stop the install.")
"RTN","LBRVCONE",37,0)
 . D MES^XPDUTL("  ")
"RTN","LBRVCONE",38,0)
 . S DIR(0)="Y",DIR("A")="Enter 'N' to quit, or 'Y' to continue: "
"RTN","LBRVCONE",39,0)
 . S DIR("B")="NO" D ^DIR
"RTN","LBRVCONE",40,0)
 . I Y=0!$D(DIRUT) K DIR,X,Y S QUIT=1 Q
"RTN","LBRVCONE",41,0)
CNF I $O(^XTMP("LBRY",0))="" S QUIT=0 D  Q:QUIT
"RTN","LBRVCONE",42,0)
 . D MES^XPDUTL("No LEGACY'S TEMPORARY GLOBAL present.")
"RTN","LBRVCONE",43,0)
 . D BMES^XPDUTL("If you are a PRIMARY STATION and need to have these globals present,")
"RTN","LBRVCONE",44,0)
 . D MES^XPDUTL(" Enter 'Y' to quit install and then load the LEGACY'S TEMPORARY GLOBAL.")
"RTN","LBRVCONE",45,0)
 . D MES^XPDUTL("If you want to continue with this install, Press ENTER.")
"RTN","LBRVCONE",46,0)
 . D MES^XPDUTL("  ")
"RTN","LBRVCONE",47,0)
 . S DIR(0)="Y",DIR("A")="Enter 'Y' to quit, or Press ENTER to continue: "
"RTN","LBRVCONE",48,0)
 . S DIR("B")="NO" D ^DIR
"RTN","LBRVCONE",49,0)
 . I Y'=0!($G(DIRUT)) K DIR,X,Y S XPDQUIT=1,DIRUT=1 Q
"RTN","LBRVCONE",50,0)
STA ;
"RTN","LBRVCONE",51,0)
 S LBRVSTA=0,CT=0
"RTN","LBRVCONE",52,0)
 F  S LBRVSTA=$O(^XTMP("LBRY",LBRVSTA)) Q:LBRVSTA=""  S CT=CT+1
"RTN","LBRVCONE",53,0)
 I CT>0 S $P(^XTMP("LBRY",0),"^",3)=CT
"RTN","LBRVCONE",54,0)
 I CT>1 D
"RTN","LBRVCONE",55,0)
 . D MES^XPDUTL("**WARNING** Temporary global contains multiple stations.")
"RTN","LBRVCONE",56,0)
 . D MES^XPDUTL("The integration may take a couple of hours.")
"RTN","LBRVCONE",57,0)
 K CT,LBRPT2,LBRVSTA
"RTN","LBRVCONE",58,0)
 Q
"RTN","LBRVCONE",59,0)
QUES ;  Check to see if 5-letter code has been set and finds a match
"RTN","LBRVCONE",60,0)
 S QUIT=0,LBRVSTA=0
"RTN","LBRVCONE",61,0)
LP S LBRVSTA=$O(^XTMP("LBRY",LBRVSTA))
"RTN","LBRVCONE",62,0)
 I LBRVSTA="" G EXIT
"RTN","LBRVCONE",63,0)
LP2 S LBRVNM=$O(^LBRY(680.6,"C",LBRVSTA,""))
"RTN","LBRVCONE",64,0)
 I LBRVNM="" D PROC G EXIT:QUIT
"RTN","LBRVCONE",65,0)
 K DIC,DIE,D,DA,D0,DR,X,Y
"RTN","LBRVCONE",66,0)
 G LP
"RTN","LBRVCONE",67,0)
PROC ; get new site name for integrating site if not already setup
"RTN","LBRVCONE",68,0)
 D MES^XPDUTL("No Division Site Name defined in Library Parameter file")
"RTN","LBRVCONE",69,0)
 D MES^XPDUTL("for integrating site:  ***  "_LBRVSTA_"   ***")
"RTN","LBRVCONE",70,0)
 D BMES^XPDUTL("Enter the corresponding SITE NAME to match the above 5 letter code.")
"RTN","LBRVCONE",71,0)
 D MES^XPDUTL("  ")
"RTN","LBRVCONE",72,0)
Q2 S DIC="^LBRY(680.6,",DIC("A")="Select the LIBRARY PARAMETERS SITE NAME for '"_LBRVSTA_"': "
"RTN","LBRVCONE",73,0)
 S DIC(0)="AELQ" D ^DIC
"RTN","LBRVCONE",74,0)
 I $G(DTOUT)!($G(DUOUT)) S QUIT=1 Q
"RTN","LBRVCONE",75,0)
 I Y<0 W !,"You must select a site name." G Q2
"RTN","LBRVCONE",76,0)
 S (DA,LBRVNM)=+Y
"RTN","LBRVCONE",77,0)
 I $P($G(^LBRY(680.6,DA,0)),U,7)'="" W !,"Already matched with another 5 letter code.  Select a NEW site name.." G Q2
"RTN","LBRVCONE",78,0)
 S DR=".07///^S X=LBRVSTA",DIE=DIC D ^DIE
"RTN","LBRVCONE",79,0)
 Q
"RTN","LBRVCONE",80,0)
MESS ; display exit message that data must be removed
"RTN","LBRVCONE",81,0)
 D BMES^XPDUTL(LBRCODE_"'s integrating data is present!")
"RTN","LBRVCONE",82,0)
 D MES^XPDUTL("You will need to remove this data, in order to continue with this install.")
"RTN","LBRVCONE",83,0)
 D BMES^XPDUTL("At the command line:  K ^XMTP(""LBRY"","""_LBRCODE_""")")
"RTN","LBRVCONE",84,0)
 D BMES^XPDUTL("Then re-load this patch to continue.")
"RTN","LBRVCONE",85,0)
 D MES^XPDUTL("  ")
"RTN","LBRVCONE",86,0)
 S XPDQUIT=1
"RTN","LBRVCONE",87,0)
 K LBRVCODE,LBRVPTR,LBRYDA,LBRXREF Q
"RTN","LBRVCONE",88,0)
EXIT ;Kill local variables
"RTN","LBRVCONE",89,0)
 K LBRVSTA,LBRVNM,DIR,DIC,DIE,D,DA,D0,DR,X,Y
"RTN","LBRVCONE",90,0)
 I QUIT S DIRUT=1
"RTN","LBRVCONE",91,0)
 Q
"RTN","LBRVCONP")
0^64^B11522672
"RTN","LBRVCONP",1,0)
LBRVCONP ;SSI/ALA-Preinstall of consolidation ;[ 10/15/97  4:58 PM ]
"RTN","LBRVCONP",2,0)
 ;;2.5;Library;**3**;Mar 11, 1996
"RTN","LBRVCONP",3,0)
CHKPT ; 
"RTN","LBRVCONP",4,0)
 ;  Clean up version number
"RTN","LBRVCONP",5,0)
 S N=679.9999 F  S N=$O(^DD(N)) Q:N>689.4  I $G(^DD(N,0,"VR"))?1"2.5"1A.N S ^DD(N,0,"VR")=2.5
"RTN","LBRVCONP",6,0)
 ;  If single primary site quit
"RTN","LBRVCONP",7,0)
 I $P(^LBRY(680.6,0),U,4)=1 Q
"RTN","LBRVCONP",8,0)
 S LBRVSTA=0
"RTN","LBRVCONP",9,0)
STA ;get 5-letter code and number reference
"RTN","LBRVCONP",10,0)
 S LBRVSTA=$O(^XTMP("LBRY",LBRVSTA))
"RTN","LBRVCONP",11,0)
 I LBRVSTA="" G EXIT
"RTN","LBRVCONP",12,0)
 S LBRVNM=$O(^LBRY(680.6,"C",LBRVSTA,""))
"RTN","LBRVCONP",13,0)
 G EXIT:$G(DUOUT)=1
"RTN","LBRVCONP",14,0)
 D L680
"RTN","LBRVCONP",15,0)
 G STA
"RTN","LBRVCONP",16,0)
L680 ;  Set those pointers that don't have a cross-reference
"RTN","LBRVCONP",17,0)
 D MES^XPDUTL("Starting pre-consolidation steps...")
"RTN","LBRVCONP",18,0)
 S TDA=0 D MES^XPDUTL("File 680 for "_LBRVSTA)
"RTN","LBRVCONP",19,0)
 F I="B","E" K ^XTMP("LBRY",LBRVSTA,680,I)
"RTN","LBRVCONP",20,0)
 F  S TDA=$O(^XTMP("LBRY",LBRVSTA,680,TDA)) Q:TDA'>0  D  W:TDA#50=0 "."
"RTN","LBRVCONP",21,0)
 . S $P(^XTMP("LBRY",LBRVSTA,680,TDA,0),U,4)=LBRVNM
"RTN","LBRVCONP",22,0)
 . S PDA=$P(^XTMP("LBRY",LBRVSTA,680,TDA,0),U)
"RTN","LBRVCONP",23,0)
 . I PDA'="" S ^XTMP("LBRY",LBRVSTA,680,"B",PDA,TDA)=""
"RTN","LBRVCONP",24,0)
 . S LD1=$P($G(^XTMP("LBRY",LBRVSTA,680,TDA,10)),U,7)
"RTN","LBRVCONP",25,0)
 . I LD1'="" S ^XTMP("LBRY",LBRVSTA,680,"ZN",LD1,TDA)=""
"RTN","LBRVCONP",26,0)
 . S LD2=$P($G(^XTMP("LBRY",LBRVSTA,680,TDA,1)),U,3)
"RTN","LBRVCONP",27,0)
 . I LD2'="" S ^XTMP("LBRY",LBRVSTA,680,"ZL",LD2,TDA)=""
"RTN","LBRVCONP",28,0)
L681 S TDA=0 D MES^XPDUTL("File 681 for "_LBRVSTA)
"RTN","LBRVCONP",29,0)
 F I="AC","B","C","D","E" K ^XTMP("LBRY",LBRVSTA,681,I)
"RTN","LBRVCONP",30,0)
 F  S TDA=$O(^XTMP("LBRY",LBRVSTA,681,TDA)) Q:TDA'>0  D  W:TDA#50=0 "."
"RTN","LBRVCONP",31,0)
 . S $P(^XTMP("LBRY",LBRVSTA,681,TDA,0),U,4)=LBRVNM
"RTN","LBRVCONP",32,0)
 . S PDA=$P(^XTMP("LBRY",LBRVSTA,681,TDA,0),U,2)
"RTN","LBRVCONP",33,0)
 . I PDA'="" S ^XTMP("LBRY",LBRVSTA,681,"C",PDA,TDA)=""
"RTN","LBRVCONP",34,0)
 . S D1=0 F  S D1=$O(^XTMP("LBRY",LBRVSTA,681,TDA,2,D1)) Q:'D1  D
"RTN","LBRVCONP",35,0)
 . . S PTR=$P(^XTMP("LBRY",LBRVSTA,681,TDA,2,D1,0),U)
"RTN","LBRVCONP",36,0)
 . . S ^XTMP("LBRY",LBRVSTA,681,"D",PTR,TDA,D1)=""
"RTN","LBRVCONP",37,0)
 . S LD1=$P($G(^XTMP("LBRY",LBRVSTA,681,TDA,1)),U,8)
"RTN","LBRVCONP",38,0)
 . I LD1'="" S ^XTMP("LBRY",LBRVSTA,681,"ZN",LD1,TDA)=""
"RTN","LBRVCONP",39,0)
 . S LD2=$P($G(^XTMP("LBRY",LBRVSTA,681,TDA,1)),U,2)
"RTN","LBRVCONP",40,0)
 . I LD2'="" S ^XTMP("LBRY",LBRVSTA,681,"ZL",LD2,TDA)=""
"RTN","LBRVCONP",41,0)
L682 S TDA=0 D MES^XPDUTL("File 682 for "_LBRVSTA)
"RTN","LBRVCONP",42,0)
 F I="A1","A3","A4","AC","B","C","D","E" K ^XTMP("LBRY",LBRVSTA,682,I)
"RTN","LBRVCONP",43,0)
 F  S TDA=$O(^XTMP("LBRY",LBRVSTA,682,TDA)) Q:TDA'>0  D  W:TDA#50=0 "."
"RTN","LBRVCONP",44,0)
 . S $P(^XTMP("LBRY",LBRVSTA,682,TDA,0),U,4)=LBRVNM
"RTN","LBRVCONP",45,0)
 . S PDA=$P(^XTMP("LBRY",LBRVSTA,682,TDA,0),U,2)
"RTN","LBRVCONP",46,0)
 . I PDA'="" S ^XTMP("LBRY",LBRVSTA,682,"C",PDA,TDA)=""
"RTN","LBRVCONP",47,0)
 . S TDA1=0 F  S TDA1=$O(^XTMP("LBRY",LBRVSTA,682,TDA,4,TDA1)) Q:TDA1'>0  D
"RTN","LBRVCONP",48,0)
 .. S LD3=$P(^XTMP("LBRY",LBRVSTA,682,TDA,4,TDA1,0),U,3)
"RTN","LBRVCONP",49,0)
 .. I LD3'="" S ^XTMP("LBRY",LBRVSTA,682,"ZC",LD3,TDA,TDA1)=""
"RTN","LBRVCONP",50,0)
L685 S TDA=0 D MES^XPDUTL("File 680.5 for "_LBRVSTA)
"RTN","LBRVCONP",51,0)
 F  S TDA=$O(^XTMP("LBRY",LBRVSTA,680.5,TDA)) Q:TDA>99000!(TDA="")  D  W:TDA#50=0 "."
"RTN","LBRVCONP",52,0)
 . I $D(^LBRY(680.5,TDA)) K ^XTMP("LBRY",LBRVSTA,680.5,TDA) Q
"RTN","LBRVCONP",53,0)
 . F ND=0,3,4 S:$G(^XTMP("LBRY",LBRVSTA,680.5,TDA,ND))'="" ^LBRY(680.5,TDA,ND)=^XTMP("LBRY",LBRVSTA,680.5,TDA,ND)
"RTN","LBRVCONP",54,0)
 . F ND=1,2 I $G(^XTMP("LBRY",LBRVSTA,680.5,TDA,ND,0))'="" D
"RTN","LBRVCONP",55,0)
 .. S ^LBRY(680.5,TDA,ND,0)=^XTMP("LBRY",LBRVSTA,680.5,TDA,ND,0)
"RTN","LBRVCONP",56,0)
 .. S NN=0 F  S NN=$O(^XTMP("LBRY",LBRVSTA,680.5,TDA,ND,NN)) Q:'NN  D
"RTN","LBRVCONP",57,0)
 ... S ^LBRY(680.5,TDA,ND,NN,0)=^XTMP("LBRY",LBRVSTA,680.5,TDA,ND,NN,0)
"RTN","LBRVCONP",58,0)
 . K ^XTMP("LBRY",LBRVSTA,680.5,TDA)
"RTN","LBRVCONP",59,0)
 S DIK="^LBRY(680.5," D IXALL^DIK
"RTN","LBRVCONP",60,0)
 Q
"RTN","LBRVCONP",61,0)
EXIT K LBRVSTA,LBRVNM,TDA,LD1,PDA,TDA1,LD3,ND,NN,DIK,LD2,TDA1,DIC,DIE,D1,PTR
"RTN","LBRVCONP",62,0)
 Q
"RTN","LBRVCONS")
0^65^B25664417
"RTN","LBRVCONS",1,0)
LBRVCONS ;SSI/ALA-Consolidate library files ;[ 02/12/98  4:28 PM ]
"RTN","LBRVCONS",2,0)
 ;;2.5;Library;**3**;Mar 11, 1996
"RTN","LBRVCONS",3,0)
EN ;Check for Legacy Station
"RTN","LBRVCONS",4,0)
 I '$D(^XTMP("LBRV",0)) G EXIT^LBRVCON1
"RTN","LBRVCONS",5,0)
 S LBRPRT=$P(^XTMP("LBRV",0),"^",3),LBRSYS=$P(LBRPRT,";",2)
"RTN","LBRVCONS",6,0)
 I LBRSYS="LEG" K LBRSYS,LBRPRT G EXIT^LBRVCON1
"RTN","LBRVCONS",7,0)
NEW NEW %
"RTN","LBRVCONS",8,0)
 I '$$NEWCP^XPDUTL("STA","STRT^LBRVCONS","") D BMES^XPDUTL("error in creating checkpoint, STA")
"RTN","LBRVCONS",9,0)
 S %=$$NEWCP^XPDUTL("CNT")
"RTN","LBRVCONS",10,0)
 S LBRVSTA=0,NUM=0
"RTN","LBRVCONS",11,0)
LOOP S LBRVSTA=$O(^XTMP("LBRY",LBRVSTA)),NUM=NUM+1 Q:LBRVSTA="" 
"RTN","LBRVCONS",12,0)
 S %=$$NEWCP^XPDUTL("ODA1"_NUM)
"RTN","LBRVCONS",13,0)
 S %=$$NEWCP^XPDUTL("ODA2"_NUM)
"RTN","LBRVCONS",14,0)
 S %=$$NEWCP^XPDUTL("ODA3"_NUM)
"RTN","LBRVCONS",15,0)
 S %=$$NEWCP^XPDUTL("ODA4"_NUM)
"RTN","LBRVCONS",16,0)
 S %=$$NEWCP^XPDUTL("ODA5"_NUM)
"RTN","LBRVCONS",17,0)
 S %=$$NEWCP^XPDUTL("ODA6"_NUM)
"RTN","LBRVCONS",18,0)
 S %=$$NEWCP^XPDUTL("ODA7"_NUM)
"RTN","LBRVCONS",19,0)
 S %=$$NEWCP^XPDUTL("CON3"_NUM)
"RTN","LBRVCONS",20,0)
 S %=$$NEWCP^XPDUTL("CON2"_NUM)
"RTN","LBRVCONS",21,0)
 G LOOP
"RTN","LBRVCONS",22,0)
STRT S LBRVSTA=+$$PARCP^XPDUTL("STA"),NUM=+$$PARCP^XPDUTL("CNT")
"RTN","LBRVCONS",23,0)
MN S LBRVSTA=$O(^XTMP("LBRY",LBRVSTA)),NUM=NUM+1 G EXIT:LBRVSTA=""
"RTN","LBRVCONS",24,0)
 S LBRVNM=$O(^LBRY(680.6,"C",LBRVSTA,""))
"RTN","LBRVCONS",25,0)
 I '$$VERCP^XPDUTL("ODA1"_NUM) D STP1 S %=$$COMCP^XPDUTL("ODA1"_NUM)
"RTN","LBRVCONS",26,0)
 I '$$VERCP^XPDUTL("ODA2"_NUM) D STP2 S %=$$COMCP^XPDUTL("ODA2"_NUM)
"RTN","LBRVCONS",27,0)
 I '$$VERCP^XPDUTL("ODA3"_NUM) D STP3 S %=$$COMCP^XPDUTL("ODA3"_NUM)
"RTN","LBRVCONS",28,0)
 I '$$VERCP^XPDUTL("CON2"_NUM) D ^LBRVCON2 S %=$$COMCP^XPDUTL("CON2"_NUM)
"RTN","LBRVCONS",29,0)
 D MES^XPDUTL("I am done with integrating "_LBRVSTA_"'s data at "_$$HTE^XLFDT($H))
"RTN","LBRVCONS",30,0)
 S %=$$UPCP^XPDUTL("STA",LBRVSTA),%=$$UPCP^XPDUTL("CNT",NUM)
"RTN","LBRVCONS",31,0)
 K ^XTMP("LBRY",LBRVSTA)
"RTN","LBRVCONS",32,0)
 G MN
"RTN","LBRVCONS",33,0)
STP1 S ODA=+$$PARCP^XPDUTL("ODA1"_NUM)
"RTN","LBRVCONS",34,0)
 D MES^XPDUTL("I am beginning Step 1....for "_LBRVSTA_" at "_$$HTE^XLFDT($H))
"RTN","LBRVCONS",35,0)
 K ^XTMP("LBRY",LBRVSTA,680.3,"B")
"RTN","LBRVCONS",36,0)
GDA1 S ODA=$O(^XTMP("LBRY",LBRVSTA,680.3,ODA)) Q:ODA'>0
"RTN","LBRVCONS",37,0)
 S SUB=$P(^XTMP("LBRY",LBRVSTA,680.3,ODA,0),U)
"RTN","LBRVCONS",38,0)
GD1 S NDA=$O(^LBRY(680.3,"B",SUB,""))
"RTN","LBRVCONS",39,0)
 I NDA'="" D  K ^XTMP("LBRY",LBRVSTA,680.3,ODA) S %=$$UPCP^XPDUTL("ODA1"_NUM,ODA) G GDA1
"RTN","LBRVCONS",40,0)
 . I $G(^XTMP("LBRY",LBRVSTA,680.3,NDA,0))'="" Q
"RTN","LBRVCONS",41,0)
 . S L1="" F  S L1=$O(^XTMP("LBRY",LBRVSTA,681,"C",ODA,L1)) Q:L1=""  D
"RTN","LBRVCONS",42,0)
 . . S L0=$O(^XTMP("LBRY",LBRVSTA,681,"C",ODA,L1,""))
"RTN","LBRVCONS",43,0)
 . . S $P(^XTMP("LBRY",LBRVSTA,681,L1,3,L0,0),U)=NDA
"RTN","LBRVCONS",44,0)
 S DINUM=$P(^LBRY(680.3,0),"^",3)
"RTN","LBRVCONS",45,0)
 F  S DINUM=DINUM+1 Q:'$D(^LBRY(680.3,DINUM,0))
"RTN","LBRVCONS",46,0)
 S X=DINUM,DLAYGO=680.3,DIC(0)="L",DIC="^LBRY(680.3,"
"RTN","LBRVCONS",47,0)
 D FILE^DICN S DA=+Y
"RTN","LBRVCONS",48,0)
 S DIE=DIC,DR=".01////^S X=SUB" D ^DIE
"RTN","LBRVCONS",49,0)
 G GDA1
"RTN","LBRVCONS",50,0)
STP2 S ODA=+$$PARCP^XPDUTL("ODA2"_NUM)
"RTN","LBRVCONS",51,0)
 D MES^XPDUTL("I am beginning Step 2....for "_LBRVSTA_" at "_$$HTE^XLFDT($H))
"RTN","LBRVCONS",52,0)
GDA2 S ODA=$O(^XTMP("LBRY",LBRVSTA,680.4,ODA)) Q:ODA'>0
"RTN","LBRVCONS",53,0)
 I '$D(^XTMP("LBRY",LBRVSTA,681,"ZN",ODA)),'$D(^XTMP("LBRY",LBRVSTA,681,"D",ODA)),'$D(^XTMP("LBRY",LBRVSTA,681,"ZN",ODA)) S %=$$UPCP^XPDUTL("ODA2"_NUM,ODA) G GDA2
"RTN","LBRVCONS",54,0)
 S $P(^XTMP("LBRY",LBRVSTA,680.4,ODA,0),U,9)=LBRVNM
"RTN","LBRVCONS",55,0)
 S SRV=$P($G(^XTMP("LBRY",LBRVSTA,680.4,ODA,0)),U,2)
"RTN","LBRVCONS",56,0)
 I SRV'="" D
"RTN","LBRVCONS",57,0)
 . S SRV=$P(SRV,"*",1),DIC(0)="X",DIC="^DIC(49,",X=SRV D ^DIC
"RTN","LBRVCONS",58,0)
 . S SRVN=+Y
"RTN","LBRVCONS",59,0)
 . I SRVN>0 S $P(^XTMP("LBRY",LBRVSTA,680.4,ODA,0),U,2)=SRVN
"RTN","LBRVCONS",60,0)
 S DINUM=$P(^LBRY(680.4,0),"^",3)
"RTN","LBRVCONS",61,0)
 F  S DINUM=DINUM+1 Q:'$D(^LBRY(680.4,DINUM,0))
"RTN","LBRVCONS",62,0)
 S X=DINUM,DLAYGO=680.4,DIC(0)="L",DIC="^LBRY(680.4,"
"RTN","LBRVCONS",63,0)
 D FILE^DICN S DA=+Y
"RTN","LBRVCONS",64,0)
 S %X="^XTMP(""LBRY"",LBRVSTA,680.4,"_ODA_",",%Y="^LBRY(680.4,"_DA_"," D %XY^%RCR
"RTN","LBRVCONS",65,0)
 S TDA=""
"RTN","LBRVCONS",66,0)
 F  S TDA=$O(^XTMP("LBRY",LBRVSTA,680,"ZN",ODA,TDA)) Q:TDA=""  S $P(^XTMP("LBRY",LBRVSTA,680,TDA,10),U,7)=DA K ^XTMP("LBRY",LBRVSTA,680,"ZN",ODA,TDA)
"RTN","LBRVCONS",67,0)
 F  S TDA=$O(^XTMP("LBRY",LBRVSTA,681,"ZN",ODA,TDA)) Q:TDA=""  S $P(^XTMP("LBRY",LBRVSTA,681,TDA,1),U,8)=DA K ^XTMP("LBRY",LBRVSTA,681,"ZN",ODA,TDA)
"RTN","LBRVCONS",68,0)
 F  S TDA=$O(^XTMP("LBRY",LBRVSTA,681,"D",ODA,TDA)) Q:TDA=""   S NDA="" D
"RTN","LBRVCONS",69,0)
 . K ^XTMP("LBRY",LBRVSTA,681,TDA,2,"AC"),^XTMP("LBRY",LBRVSTA,681,TDA,2,"B")
"RTN","LBRVCONS",70,0)
 . F  S NDA=$O(^XTMP("LBRY",LBRVSTA,681,"D",ODA,TDA,NDA)) Q:NDA=""  S $P(^XTMP("LBRY",LBRVSTA,681,TDA,2,NDA,0),U)=DA K ^XTMP("LBRY",LBRVSTA,681,"D",ODA,TDA,NDA)
"RTN","LBRVCONS",71,0)
 S %=$$UPCP^XPDUTL("ODA2"_NUM,ODA)
"RTN","LBRVCONS",72,0)
 G GDA2
"RTN","LBRVCONS",73,0)
STP3 S ODA=+$$PARCP^XPDUTL("ODA3"_NUM)
"RTN","LBRVCONS",74,0)
 D MES^XPDUTL("I am beginning Step 3....for "_LBRVSTA_" at "_$$HTE^XLFDT($H))
"RTN","LBRVCONS",75,0)
GDA3 S ODA=$O(^XTMP("LBRY",LBRVSTA,680.7,ODA)) Q:ODA'>0
"RTN","LBRVCONS",76,0)
 I '$D(^XTMP("LBRY",LBRVSTA,680,"ZL",ODA))&('$D(^XTMP("LBRY",LBRVSTA,681,"ZL",ODA))) S %=$$UPCP^XPDUTL("ODA3"_NUM,ODA) G GDA3
"RTN","LBRVCONS",77,0)
 S $P(^XTMP("LBRY",LBRVSTA,680.7,ODA,0),U,2)=LBRVNM
"RTN","LBRVCONS",78,0)
 S DINUM=0
"RTN","LBRVCONS",79,0)
 F  S DINUM=DINUM+1 Q:'$D(^LBRY(680.7,DINUM,0))
"RTN","LBRVCONS",80,0)
 S X=DINUM,DLAYGO=680.7,DIC(0)="L",DIC="^LBRY(680.7,"
"RTN","LBRVCONS",81,0)
 D FILE^DICN S DA=+Y
"RTN","LBRVCONS",82,0)
 S %X="^XTMP(""LBRY"",LBRVSTA,680.7,"_ODA_",",%Y="^LBRY(680.7,"_DA_"," D %XY^%RCR
"RTN","LBRVCONS",83,0)
 S TDA=""
"RTN","LBRVCONS",84,0)
 F  S TDA=$O(^XTMP("LBRY",LBRVSTA,680,"ZL",ODA,TDA)) Q:TDA=""  S $P(^XTMP("LBRY",LBRVSTA,680,TDA,1),U,3)=DA K ^XTMP("LBRY",LBRVSTA,680,"ZL",ODA,TDA)
"RTN","LBRVCONS",85,0)
 F  S TDA=$O(^XTMP("LBRY",LBRVSTA,681,"ZL",ODA,TDA)) Q:TDA=""  S $P(^XTMP("LBRY",LBRVSTA,681,TDA,1),U,2)=DA K ^XTMP("LBRY",LBRVSTA,681,"ZL",ODA,TDA)
"RTN","LBRVCONS",86,0)
 S %=$$UPCP^XPDUTL("ODA3"_NUM,ODA)
"RTN","LBRVCONS",87,0)
 G GDA3
"RTN","LBRVCONS",88,0)
EXIT D ^LBRVCON1
"RTN","LBRVCONS",89,0)
 K L0,L1,NDA,ODA,TDA,LBRVSTA,LBRVNM,DIC,DLAYGO,DA
"RTN","LBRVCONS",90,0)
 K Y,J,LX,DIK,SUB,SRV,SRVN,NUM,I,CODE
"RTN","LBRVCONS",91,0)
 S %=$$COMCP^XPDUTL("CNT")
"RTN","LBRVCONS",92,0)
 Q
"VER")
8.0^21.0
**END**
**END**
