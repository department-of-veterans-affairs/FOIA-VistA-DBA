Released PRS*4*109 SEQ #99
Extracted from mail message
**KIDS**:PRS*4.0*109^

**INSTALL NAME**
PRS*4.0*109
"BLD",6898,0)
PRS*4.0*109^PAID^0^3070221^y
"BLD",6898,1,0)
^^6^6^3070221^
"BLD",6898,1,1,0)
This patch addresses four issues:
"BLD",6898,1,2,0)
1. Labor Distribution Audit report errors out
"BLD",6898,1,3,0)
2. Error received when payroll processes automatically 
"BLD",6898,1,4,0)
   after system shutdown
"BLD",6898,1,5,0)
3. Employee not charged with enough Military Leave
"BLD",6898,1,6,0)
4. Meal time incorrectly being deducted from Annual Leave
"BLD",6898,4,0)
^9.64PA^^
"BLD",6898,6.3)
5
"BLD",6898,"ABPKG")
n
"BLD",6898,"INID")
^
"BLD",6898,"INIT")

"BLD",6898,"KRN",0)
^9.67PA^8989.52^19
"BLD",6898,"KRN",.4,0)
.4
"BLD",6898,"KRN",.401,0)
.401
"BLD",6898,"KRN",.402,0)
.402
"BLD",6898,"KRN",.403,0)
.403
"BLD",6898,"KRN",.5,0)
.5
"BLD",6898,"KRN",.84,0)
.84
"BLD",6898,"KRN",3.6,0)
3.6
"BLD",6898,"KRN",3.8,0)
3.8
"BLD",6898,"KRN",9.2,0)
9.2
"BLD",6898,"KRN",9.8,0)
9.8
"BLD",6898,"KRN",9.8,"NM",0)
^9.68A^5^3
"BLD",6898,"KRN",9.8,"NM",1,0)
PRSALDA^^0^B26068322
"BLD",6898,"KRN",9.8,"NM",2,0)
PRSDPROC^^0^B14648155
"BLD",6898,"KRN",9.8,"NM",5,0)
PRS8MT^^0^B28085680
"BLD",6898,"KRN",9.8,"NM","B","PRS8MT",5)

"BLD",6898,"KRN",9.8,"NM","B","PRSALDA",1)

"BLD",6898,"KRN",9.8,"NM","B","PRSDPROC",2)

"BLD",6898,"KRN",19,0)
19
"BLD",6898,"KRN",19.1,0)
19.1
"BLD",6898,"KRN",101,0)
101
"BLD",6898,"KRN",409.61,0)
409.61
"BLD",6898,"KRN",771,0)
771
"BLD",6898,"KRN",870,0)
870
"BLD",6898,"KRN",8989.51,0)
8989.51
"BLD",6898,"KRN",8989.52,0)
8989.52
"BLD",6898,"KRN",8994,0)
8994
"BLD",6898,"KRN","B",.4,.4)

"BLD",6898,"KRN","B",.401,.401)

"BLD",6898,"KRN","B",.402,.402)

"BLD",6898,"KRN","B",.403,.403)

"BLD",6898,"KRN","B",.5,.5)

"BLD",6898,"KRN","B",.84,.84)

"BLD",6898,"KRN","B",3.6,3.6)

"BLD",6898,"KRN","B",3.8,3.8)

"BLD",6898,"KRN","B",9.2,9.2)

"BLD",6898,"KRN","B",9.8,9.8)

"BLD",6898,"KRN","B",19,19)

"BLD",6898,"KRN","B",19.1,19.1)

"BLD",6898,"KRN","B",101,101)

"BLD",6898,"KRN","B",409.61,409.61)

"BLD",6898,"KRN","B",771,771)

"BLD",6898,"KRN","B",870,870)

"BLD",6898,"KRN","B",8989.51,8989.51)

"BLD",6898,"KRN","B",8989.52,8989.52)

"BLD",6898,"KRN","B",8994,8994)

"BLD",6898,"QUES",0)
^9.62^^
"BLD",6898,"REQB",0)
^9.611^2^2
"BLD",6898,"REQB",1,0)
PRS*4.0*82^2
"BLD",6898,"REQB",2,0)
PRS*4.0*102^2
"BLD",6898,"REQB","B","PRS*4.0*102",2)

"BLD",6898,"REQB","B","PRS*4.0*82",1)

"MBREQ")
0
"PKG",408,-1)
1^1
"PKG",408,0)
PAID^PRS^PAID
"PKG",408,20,0)
^9.402P^^
"PKG",408,22,0)
^9.49I^1^1
"PKG",408,22,1,0)
4.0^2950912^2960130
"PKG",408,22,1,"PAH",1,0)
109^3070221
"PKG",408,22,1,"PAH",1,1,0)
^^6^6^3070221
"PKG",408,22,1,"PAH",1,1,1,0)
This patch addresses four issues:
"PKG",408,22,1,"PAH",1,1,2,0)
1. Labor Distribution Audit report errors out
"PKG",408,22,1,"PAH",1,1,3,0)
2. Error received when payroll processes automatically 
"PKG",408,22,1,"PAH",1,1,4,0)
   after system shutdown
"PKG",408,22,1,"PAH",1,1,5,0)
3. Employee not charged with enough Military Leave
"PKG",408,22,1,"PAH",1,1,6,0)
4. Meal time incorrectly being deducted from Annual Leave
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PRS8MT")
0^5^B28085680^B24828322
"RTN","PRS8MT",1,0)
PRS8MT ;HISC/MRL-DECOMPOSITION, MEALTIME ;11/22/06
"RTN","PRS8MT",2,0)
 ;;4.0;PAID;**2,40,69,102,109**;Sep 21, 1995;Build 5
"RTN","PRS8MT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8MT",4,0)
 ;
"RTN","PRS8MT",5,0)
 ;This routine is used to determine placement of mealtime where
"RTN","PRS8MT",6,0)
 ;necessary.
"RTN","PRS8MT",7,0)
 ;
"RTN","PRS8MT",8,0)
 ;Called by Routines:  PRS8ST
"RTN","PRS8MT",9,0)
 ;
"RTN","PRS8MT",10,0)
MULT ; --- checking 1 node
"RTN","PRS8MT",11,0)
 I $$HOLIDAY^PRS8UT(PY,DFN,MDY),$G(^PRST(458,PY,"E",DFN,"D",MDY,2))["MID^MID^ON" Q  ;don't add meal if mid-mid on-call on a holiday, quit routine
"RTN","PRS8MT",12,0)
 S TWO=DAY(MDY,"TWO")
"RTN","PRS8MT",13,0)
 S S=1 D SET D:'Q  I TWO S S=2 D SET D:'Q
"RTN","PRS8MT",14,0)
 .S D1="",$P(D1,"0",193)="",V(1)=97,V(2)=0
"RTN","PRS8MT",15,0)
 .F I=1:3:28 S V=$P(N,"^",I,I+2) Q:$P(V,"^",1)=""  D
"RTN","PRS8MT",16,0)
 ..S X=$P(V,"^",3) I "^^6^7^3^8^"'[("^"_X_"^") Q  ;quit if not NH
"RTN","PRS8MT",17,0)
 ..F M=$P(V,"^"):1:$P(V,"^",2) D  ; build up tour
"RTN","PRS8MT",18,0)
 ...S D1=$E(D1,1,M-1)_$S(X=""!(X=3):1,X=6:2,1:3)_$E(D1,M+1,192)
"RTN","PRS8MT",19,0)
 ...I V(1)>M S V(1)=M
"RTN","PRS8MT",20,0)
 ...I V(2)<M S V(2)=M
"RTN","PRS8MT",21,0)
 ..Q
"RTN","PRS8MT",22,0)
 .D:V(2) GETY
"RTN","PRS8MT",23,0)
 .F I="N","W" F J=MDY,MDY+1 S X=$G(DAY(J,I)) D
"RTN","PRS8MT",24,0)
 ..I X'="" S ^TMP($J,"PRS8",J,I)=X
"RTN","PRS8MT",25,0)
 ..Q
"RTN","PRS8MT",26,0)
 .Q
"RTN","PRS8MT",27,0)
 ;
"RTN","PRS8MT",28,0)
END ; --- all done here
"RTN","PRS8MT",29,0)
 K A,B,C,D,DIF,DIF1,J,L,M,M1,MID,MT,N,PM,T,SPL,SPLX,USE,V(1),V(2),VT,X,X1,X2,Y
"RTN","PRS8MT",30,0)
 Q
"RTN","PRS8MT",31,0)
 ;
"RTN","PRS8MT",32,0)
GETY ; --- this is where Y (placement of mealtime) is defined
"RTN","PRS8MT",33,0)
 S X=$E(D,V(1),V(2)),D1=$E(D1,V(1),V(2))
"RTN","PRS8MT",34,0)
 I X["5" D
"RTN","PRS8MT",35,0)
 . N DAYP
"RTN","PRS8MT",36,0)
 . ; loop thru string X and replace 5s by a leave code if one exists
"RTN","PRS8MT",37,0)
 . S DAYP=$E(DAY(MDY,"P"),V(1),V(2)) ; leave may be hidden here
"RTN","PRS8MT",38,0)
 . F M=1:1:$L(X) D
"RTN","PRS8MT",39,0)
 . . I $E(X,M)=5,$E(DAYP,M)'=0 S $E(X,M)=$E(DAYP,M)
"RTN","PRS8MT",40,0)
 S MID=V(2)-V(1)+1-MT\2,MID=MID+V(1) ;middle of tour
"RTN","PRS8MT",41,0)
 S PM=+$P($G(^PRST(457.1,+$P(DAY(MDY,0),"^",$S(S=1:2,1:13)),0)),"^",7) ;0=non=prem meal/1=prem. meal
"RTN","PRS8MT",42,0)
 S X1=$E(X),Q=1
"RTN","PRS8MT",43,0)
 F M=1:1:$L(X) D  Q:'Q
"RTN","PRS8MT",44,0)
 .S Y=$E(X,M)
"RTN","PRS8MT",45,0)
 .I "1235C"[Y,"1235C"[X1 Q  ; scheduled work time
"RTN","PRS8MT",46,0)
 .I Y'="O",Y'=X1 S Q=0 Q  ; not same type of time, and non-OT
"RTN","PRS8MT",47,0)
 .I Y="O",($E(DAY($S(V(1)+M-1<97:MDY,1:MDY+1),"HOL"),$S(V(1)+M-1<97:V(1)+M-1,1:V(1)+M-1-96))'=2) S Q=0 Q  ; OT indicatin' non-holiday worked gets no meal
"RTN","PRS8MT",48,0)
 .I Y="O",($E(DAY($S(V(1)+M-1<97:MDY,1:MDY+1),"HOL"),$S(V(1)+M-1<97:V(1)+M-1,1:V(1)+M-1-96))=2),"123C"[X1 S Q=0 Q  ; OT indicatin holiday worked and Excused.
"RTN","PRS8MT",49,0)
 .Q
"RTN","PRS8MT",50,0)
 I X["0" D
"RTN","PRS8MT",51,0)
 .S SPL=$TR(X,"1235"),SPLX=$TR(X,SPL,$TR($J("",$L(SPL))," "))
"RTN","PRS8MT",52,0)
 .I SPLX="" S Q=1
"RTN","PRS8MT",53,0)
 ; --- one activity for entire tour
"RTN","PRS8MT",54,0)
 K M I Q S Q=0 D  F M=1:1:MT S M(M)=Y+M-1
"RTN","PRS8MT",55,0)
 .I V(1)>24,V(2)<73 S Y=MID Q  ;no premium time involved/ meal in middle
"RTN","PRS8MT",56,0)
 .S Q=0 D  ;check for all premium
"RTN","PRS8MT",57,0)
 ..I V(1)<25,V(2)<25 S Q=1 Q  ;all hours before 6am
"RTN","PRS8MT",58,0)
 ..I V(1)>72,V(2)>72,V(2)'>120 S Q=1 Q  ;all hours after 6pm
"RTN","PRS8MT",59,0)
 .I Q S Y=MID Q  ; all time premium time/ meal in middle
"RTN","PRS8MT",60,0)
 .I PM S Y=0 D
"RTN","PRS8MT",61,0)
 ..I V(2)>72 S Y=73-$S(V(2)-73>MT&(V(1)'>73):0,V(1)<25!(V(2)'<121):73,1:MT-(V(2)-73))
"RTN","PRS8MT",62,0)
 ..I 'Y,V(1)<25 S Y=$S(25-V(1)>MT:25-MT,1:V(1))
"RTN","PRS8MT",63,0)
 ..I 'Y S Y=$S(121-V(1)>MT:121-MT,1:V(1))
"RTN","PRS8MT",64,0)
 .E  S Y=0 D
"RTN","PRS8MT",65,0)
 ..I V(2)>72 S Y=$S(73-MT>V(1):73-MT,V(1)<25!(V(2)'<121):0,1:V(1))
"RTN","PRS8MT",66,0)
 ..I 'Y,V(1)<25 S Y=$S(V(2)-MT>24:25,1:V(2)-MT+1)
"RTN","PRS8MT",67,0)
 ..I 'Y S Y=$S(V(2)-MT>120:121,1:V(2)-MT+1)
"RTN","PRS8MT",68,0)
 .I 'Y S Y=MID
"RTN","PRS8MT",69,0)
 .Q
"RTN","PRS8MT",70,0)
 ; --- multiple activities per tour
"RTN","PRS8MT",71,0)
 E  D
"RTN","PRS8MT",72,0)
 .  S Z=$TR(X,"1235"),X=$TR(X,Z,$TR($J("",$L(Z))," ","0"))
"RTN","PRS8MT",73,0)
 .  S ZRIK=$TR(Z,"HC") I MT>0,$L(ZRIK)'<(($P(DAY(DAY,0),"^",8)*4)+MT) S X="",$P(X,"1",$L(ZRIK)+1)="" ;if leave posted > or = to tour length + mt (ie didn't post around lunch) it was resulting in OT (ZRIK strips HOL & OC)
"RTN","PRS8MT",74,0)
 .  Q:X?1"0"."0"
"RTN","PRS8MT",75,0)
 .  S M=0 F A=1,2 Q:M=MT  F B=MID,MID+1,MID-1:-1:V(1),MID+2:1:V(2) D  Q:M=MT
"RTN","PRS8MT",76,0)
 .  .  Q:'$E(X,B-V(1)+1)
"RTN","PRS8MT",77,0)
 .  .  I A=1,PM,B<25!(B>72&(B<121)) S M=M+1,M(M)=B
"RTN","PRS8MT",78,0)
 .  .  I A=1,'PM,B>24&(B<73)!(B>120) S M=M+1,M(M)=B
"RTN","PRS8MT",79,0)
 .  .  I A=2 S M=M+1,M(M)=B
"RTN","PRS8MT",80,0)
 .  .  Q
"RTN","PRS8MT",81,0)
 .  Q
"RTN","PRS8MT",82,0)
 Q:'$O(M(0))
"RTN","PRS8MT",83,0)
Y ; --- this is where meals get placed in string
"RTN","PRS8MT",84,0)
 F Y=0:0 S Y=$O(M(Y)) Q:Y'>0  D
"RTN","PRS8MT",85,0)
 . N ORIGAC ; original activity code
"RTN","PRS8MT",86,0)
 .  S M=M(Y),(X,ORIGAC)=$E(D,M),X=$S(X="J":"A",X=5:$E(DAY(MDY,"P"),M),1:X),D=$E(D,0,M-1)_"m"_$E(D,M+1,999)
"RTN","PRS8MT",87,0)
 .  S X=$S(X'="M":$F("LSWnAR*U************************V********YXFGD",X)-1,1:5)
"RTN","PRS8MT",88,0)
 .  I "Ff"[TYP,NH'=480!(NH(1)'=NH(2)) S X=32
"RTN","PRS8MT",89,0)
 .  ;I X'=4,CYA2806>0 S CYA2806=CYA2806-1 ; << ADDED-> DROP LUNCH FROM CY ALSO>>
"RTN","PRS8MT",90,0)
 .  Q:X'>0
"RTN","PRS8MT",91,0)
 .  Q:MDY=0&(M(Y)<96)!(MDY=14&(M(Y)>97))
"RTN","PRS8MT",92,0)
 .  S W=$S(MDY<8:1,1:2) I MDY=7&(M(Y)>96) S W=2
"RTN","PRS8MT",93,0)
 .  I $P(WK(W),"^",+X)>0 S $P(WK(W),"^",+X)=$P(WK(W),"^",+X)-1 ;subtract
"RTN","PRS8MT",94,0)
 .  ; If Military Leave subtract the mealtime out of the WK(3) array.
"RTN","PRS8MT",95,0)
 .  I ORIGAC="M",$P(WK(3),U,11)>0 S $P(WK(3),U,11)=$P(WK(3),U,11)-1
"RTN","PRS8MT",96,0)
 .  ;I WPCYA>0 S WPCYA=WPCYA-1 ;lunch from total << AND FROM CA TOTAL >>
"RTN","PRS8MT",97,0)
 . ; PRS*4*40 added 8 (U), 44 (F), 45 (G), 46 (D) to following line
"RTN","PRS8MT",98,0)
 . ; because PRS8AC also increments LU for those types of time
"RTN","PRS8MT",99,0)
 .  I +X,"^1^2^6^8^44^45^46^"[("^"_+X_"^") S LU=LU-1 ;reduce leave used
"RTN","PRS8MT",100,0)
 .  I +X,"^3^"[("^"_+X_"^"),"P"[TYP S TH=TH+1,TH(W)=TH(W)+1
"RTN","PRS8MT",101,0)
 .   Q
"RTN","PRS8MT",102,0)
 S DAY(MDY,"W")=$E(D,1,96)
"RTN","PRS8MT",103,0)
 S X=$E(D,97,999) I $L(X) D
"RTN","PRS8MT",104,0)
 .I $D(DAY(MDY+1,"W")) S DAY(MDY+1,"W")=X_$E(DAY(MDY+1,"W"),$L(X)+1,999)
"RTN","PRS8MT",105,0)
 .S DAY(MDY,"N")=X
"RTN","PRS8MT",106,0)
 Q
"RTN","PRS8MT",107,0)
 ;
"RTN","PRS8MT",108,0)
SET ; --- set up for processing
"RTN","PRS8MT",109,0)
 K A,B S (A,B,Q,Y)=0
"RTN","PRS8MT",110,0)
 S MT=$G(DAY(MDY,"MT"_S)) I MT'>0 S Q=1 Q  ; mealtime for tour?
"RTN","PRS8MT",111,0)
 S D=DAY(MDY,"W")_$G(DAY(MDY,"N")) ; get daily activity
"RTN","PRS8MT",112,0)
 S N=DAY(MDY,S*S) ; get tour
"RTN","PRS8MT",113,0)
 Q
"RTN","PRSALDA")
0^1^B26068322^B21208885
"RTN","PRSALDA",1,0)
PRSALDA ;HISC/MGD-Labor Distribution Audit ;02/13/2007
"RTN","PRSALDA",2,0)
 ;;4.0;PAID;**82,109**;Sep 21, 1995;Build 5
"RTN","PRSALDA",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRSALDA",4,0)
 Q
"RTN","PRSALDA",5,0)
TL W @IOF
"RTN","PRSALDA",6,0)
 S PRSTLV=3 D ^PRSAUTL G:TLI<1 EX
"RTN","PRSALDA",7,0)
 W !
"RTN","PRSALDA",8,0)
 ;
"RTN","PRSALDA",9,0)
PP ;select pay period
"RTN","PRSALDA",10,0)
 K DIC S DIC="^PRST(458,",DIC(0)="AEMQZ"
"RTN","PRSALDA",11,0)
 D ^DIC
"RTN","PRSALDA",12,0)
 I Y'>0 D EX Q
"RTN","PRSALDA",13,0)
 S PPI=+Y,PPNAME=$P(^PRST(458,PPI,0),U,1)
"RTN","PRSALDA",14,0)
 ;
"RTN","PRSALDA",15,0)
D2 W !!,"Would you like to review the Labor Distributions "
"RTN","PRSALDA",16,0)
 W !,"in alphabetical order"
"RTN","PRSALDA",17,0)
 S %=1 D YN^DICN
"RTN","PRSALDA",18,0)
 Q:%=-1
"RTN","PRSALDA",19,0)
 I %=0 D  G D2
"RTN","PRSALDA",20,0)
 . W !!,"Answer YES if you want the Labor Distribution and any changes"
"RTN","PRSALDA",21,0)
 . W !,"that have occurred during the selected Pay Period for all"
"RTN","PRSALDA",22,0)
 . W !,"employees."
"RTN","PRSALDA",23,0)
 I %=1 D  Q
"RTN","PRSALDA",24,0)
 . D DVC
"RTN","PRSALDA",25,0)
 . I POP D EX Q
"RTN","PRSALDA",26,0)
 . Q
"RTN","PRSALDA",27,0)
 I %=2 D EMP Q
"RTN","PRSALDA",28,0)
 Q
"RTN","PRSALDA",29,0)
 ;
"RTN","PRSALDA",30,0)
DVC N PRSALST,PRSAPGM,PRTC S PRTC=""
"RTN","PRSALDA",31,0)
 W ! K IOP,%ZIS S %ZIS("A")="Select Device: ",%ZIS="MQ"
"RTN","PRSALDA",32,0)
 D ^%ZIS K %ZIS,IOP
"RTN","PRSALDA",33,0)
 Q:POP
"RTN","PRSALDA",34,0)
 I $D(IO("Q")) D  Q
"RTN","PRSALDA",35,0)
 . S PRSAPGM="LOOP^PRSALDA",PRSALST="TLE^PPE^PPI^PPNAME"
"RTN","PRSALDA",36,0)
 . D QUE^PRSAUTL
"RTN","PRSALDA",37,0)
 U IO D LOOP
"RTN","PRSALDA",38,0)
 ; pause screen when employee to prevent scroll (other users prompted)
"RTN","PRSALDA",39,0)
 ; I $E(IOST,1,2)="C-",'QT,PRSTLV=1,'$D(DIRUT) S PG=PG+1 D H1
"RTN","PRSALDA",40,0)
 D ^%ZISC K %ZIS,IOP
"RTN","PRSALDA",41,0)
 Q
"RTN","PRSALDA",42,0)
 ;
"RTN","PRSALDA",43,0)
LOOP N DASH,PRTC
"RTN","PRSALDA",44,0)
 S LP=1,NN="",PRTC="",$P(DASH,"-",80)=""
"RTN","PRSALDA",45,0)
 F  S NN=$O(^PRSPC("ATL"_TLE,NN)) Q:NN=""  D  Q:PRTC=0
"RTN","PRSALDA",46,0)
 . F DFN=0:0 S DFN=$O(^PRSPC("ATL"_TLE,NN,DFN)) Q:DFN<1  D LD Q:PRTC=0
"RTN","PRSALDA",47,0)
 Q:PRTC=0
"RTN","PRSALDA",48,0)
 D:$E(IOST,1)="C" CHECK
"RTN","PRSALDA",49,0)
 D:$E(IOST,1)'="C" ^%ZISC
"RTN","PRSALDA",50,0)
 Q
"RTN","PRSALDA",51,0)
 ;
"RTN","PRSALDA",52,0)
EMP W @IOF
"RTN","PRSALDA",53,0)
 K DIC
"RTN","PRSALDA",54,0)
 S DIC("A")="Select EMPLOYEE: ",DIC(0)="AEQM",DIC="^PRSPC("
"RTN","PRSALDA",55,0)
 W ! D ^DIC S DFN=+Y K DIC G:DFN<1 EX
"RTN","PRSALDA",56,0)
 I DFN<1 D EX Q
"RTN","PRSALDA",57,0)
 W ! K IOP,%ZIS S %ZIS("A")="Select Device: ",%ZIS="MQ"
"RTN","PRSALDA",58,0)
 D ^%ZIS K %ZIS,IOP
"RTN","PRSALDA",59,0)
 I POP D EX Q
"RTN","PRSALDA",60,0)
 U IO
"RTN","PRSALDA",61,0)
 D LD
"RTN","PRSALDA",62,0)
 D:$E(IOST,1)'="C" ^%ZISC
"RTN","PRSALDA",63,0)
 G EMP
"RTN","PRSALDA",64,0)
 Q
"RTN","PRSALDA",65,0)
LD ; Display changes to the Labor Distribution Codes within the Pay
"RTN","PRSALDA",66,0)
 ; Period.
"RTN","PRSALDA",67,0)
 ;
"RTN","PRSALDA",68,0)
 N I,LDAUD,LDCC,LDCCB,LDCCEX,LDCODE,LDCODNUM,LDCNT,LDDATA,LDDIS
"RTN","PRSALDA",69,0)
 N LDDOA,LDFCP,LDHOLD,LDPCT,LDTOI,Y S PRTC=""
"RTN","PRSALDA",70,0)
 S NAME=$$GET1^DIQ(450,DFN,.01,"E")
"RTN","PRSALDA",71,0)
 I $E(IOST,1)="C" W @IOF
"RTN","PRSALDA",72,0)
 D LDHDR
"RTN","PRSALDA",73,0)
 W !!,"Current Labor Distribution Values:"
"RTN","PRSALDA",74,0)
 S LDDOA=$$GET1^DIQ(450,DFN,756,"E")
"RTN","PRSALDA",75,0)
 S LDCCB=$$GET1^DIQ(450,DFN,755,"E")
"RTN","PRSALDA",76,0)
 S LDTOI=$$GET1^DIQ(450,DFN,755.1,"E")
"RTN","PRSALDA",77,0)
 S LDTOI=$S(LDTOI="I":"INITIAL",LDTOI="E":"EDIT & UPDATE",LDTOI="T":"TRANSFER",LDTOI="P":"PAYROLL",1:"")
"RTN","PRSALDA",78,0)
 W !,LDDOA,?24,LDCCB,?61,LDTOI
"RTN","PRSALDA",79,0)
 F LDDIS=1:1:4 D  Q:PRTC=0
"RTN","PRSALDA",80,0)
 . S LDDATA=$G(^PRSPC(DFN,"LD",LDDIS,0))
"RTN","PRSALDA",81,0)
 . S LDCODE=$P(LDDATA,U,2),LDPCT=$P(LDDATA,U,3)
"RTN","PRSALDA",82,0)
 . S LDCC=$P(LDDATA,U,4),LDFCP=$P(LDDATA,U,5)
"RTN","PRSALDA",83,0)
 . S Y=LDCC,SUB454="CC" D OT^PRSDUTIL K SUB454
"RTN","PRSALDA",84,0)
 . S LDCCEX=$E(Y,1,30)
"RTN","PRSALDA",85,0)
 . W !,"Code",LDDIS,": ",LDCODE,?15
"RTN","PRSALDA",86,0)
 . I LDPCT>0 W $J(LDPCT,3,2)
"RTN","PRSALDA",87,0)
 . W ?24,LDCC
"RTN","PRSALDA",88,0)
 . I LDCC'="" W " - ",LDCCEX
"RTN","PRSALDA",89,0)
 . W ?70,LDFCP
"RTN","PRSALDA",90,0)
 ; Check for changes within the Pay Period.
"RTN","PRSALDA",91,0)
 S LDCNT="A"
"RTN","PRSALDA",92,0)
 S LDCNT=$O(^PRST(458,PPI,"E",DFN,"LDAUD",LDCNT),-1)
"RTN","PRSALDA",93,0)
 I 'LDCNT D  Q
"RTN","PRSALDA",94,0)
 . W !!,"There were no Labor Distribution changes for this employee"
"RTN","PRSALDA",95,0)
 . W !,"during the Pay Period: ",PPNAME,".",!!
"RTN","PRSALDA",96,0)
 . I $E(IOST,1)="C" D PRTC
"RTN","PRSALDA",97,0)
 F I=LDCNT:-1:1 D  Q:PRTC=0
"RTN","PRSALDA",98,0)
 . W !!,"Previous Change # ",I
"RTN","PRSALDA",99,0)
 . S IENS=I_","_DFN_","_PPI_","
"RTN","PRSALDA",100,0)
 . S LDDOA=$$GET1^DIQ(458.1105,IENS,1,"E")
"RTN","PRSALDA",101,0)
 . S LDCCB=$$GET1^DIQ(458.1105,IENS,2,"E")
"RTN","PRSALDA",102,0)
 . S LDTOI=$$GET1^DIQ(458.1105,IENS,3,"E")
"RTN","PRSALDA",103,0)
 . S LDTOI=$S(LDTOI="I":"INITIAL",LDTOI="E":"EDIT & UPDATE",LDTOI="T":"TRANSFER",LDTOI="P":"PAYROLL",1:"")
"RTN","PRSALDA",104,0)
 . W !,LDDOA,?24,LDCCB,?61,LDTOI
"RTN","PRSALDA",105,0)
 . F PRSLD=1:1:4 D  Q:PRTC=0
"RTN","PRSALDA",106,0)
 . . S IENS=PRSLD_","_LDCNT_","_DFN_","_PPI_","
"RTN","PRSALDA",107,0)
 . . S LDCODE=$$GET1^DIQ(458.11054,IENS,1)
"RTN","PRSALDA",108,0)
 . . S LDPCT=$$GET1^DIQ(458.11054,IENS,2)
"RTN","PRSALDA",109,0)
 . . S LDCC=$$GET1^DIQ(458.11054,IENS,3)
"RTN","PRSALDA",110,0)
 . . S Y=LDCC,SUB454="CC"
"RTN","PRSALDA",111,0)
 . . D OT^PRSDUTIL K SUB454
"RTN","PRSALDA",112,0)
 . . S LDCCEX=$E(Y,1,30)
"RTN","PRSALDA",113,0)
 . . S LDFCP=$$GET1^DIQ(458.11054,IENS,4)
"RTN","PRSALDA",114,0)
 . . W !,"Code",PRSLD,": ",LDCODE,?15
"RTN","PRSALDA",115,0)
 . . I LDPCT>0 W $J(LDPCT,3,2)
"RTN","PRSALDA",116,0)
 . . W ?24,LDCC
"RTN","PRSALDA",117,0)
 . . I LDCC'="" W " - ",LDCCEX
"RTN","PRSALDA",118,0)
 . . W ?70,LDFCP
"RTN","PRSALDA",119,0)
 . I I'=1 D CHECK
"RTN","PRSALDA",120,0)
 . Q:PRTC=0
"RTN","PRSALDA",121,0)
 . I PRTC&(I'=1) W @IOF D LDHDR S PRTC=""
"RTN","PRSALDA",122,0)
 . I I=1&($E(IOST,1)="C") D PRTC
"RTN","PRSALDA",123,0)
 Q
"RTN","PRSALDA",124,0)
 ;
"RTN","PRSALDA",125,0)
LDHDR ;Labor Distribution Header information
"RTN","PRSALDA",126,0)
 ;
"RTN","PRSALDA",127,0)
 N TAB,DASH
"RTN","PRSALDA",128,0)
 S TAB=($L(NAME)\2),$P(DASH,"-",80)=""
"RTN","PRSALDA",129,0)
 W $J(NAME,40+TAB)
"RTN","PRSALDA",130,0)
 W !?15,"Labor Distribution Changes within the Pay Period:"
"RTN","PRSALDA",131,0)
 W !,"Date/Time",?24,"Changed by",?61,"Type of Interface"
"RTN","PRSALDA",132,0)
 W !,"Code",?14,"Percent",?24,"Cost Center - Description"
"RTN","PRSALDA",133,0)
 W ?65,"Fund Ctrl Pt"
"RTN","PRSALDA",134,0)
 W !,DASH
"RTN","PRSALDA",135,0)
 Q
"RTN","PRSALDA",136,0)
 ;
"RTN","PRSALDA",137,0)
LDHOLD ; Pause of more LD changes that will fit on 1 screen.
"RTN","PRSALDA",138,0)
 ;
"RTN","PRSALDA",139,0)
 S LDHOLD=$$ASK^PRSLIB00(1)
"RTN","PRSALDA",140,0)
 S X=$G(^PRSPC(DFN,0))
"RTN","PRSALDA",141,0)
 W !,@IOF,?3,$P(X,"^",1)
"RTN","PRSALDA",142,0)
 S X=$P(X,"^",9)
"RTN","PRSALDA",143,0)
 I X W ?68,$E(X,1,3),"-",$E(X,4,5),"-",$E(X,6,9)
"RTN","PRSALDA",144,0)
 W !,DASH
"RTN","PRSALDA",145,0)
 D LDHDR
"RTN","PRSALDA",146,0)
 Q
"RTN","PRSALDA",147,0)
 ;
"RTN","PRSALDA",148,0)
CHECK I $E(IOST,1)="C",$Y>(IOSL-7) D PRTC
"RTN","PRSALDA",149,0)
 Q
"RTN","PRSALDA",150,0)
 ;
"RTN","PRSALDA",151,0)
PRTC W ! K DIR,DIRUT,DIROUT,DTOUT,DUOUT
"RTN","PRSALDA",152,0)
 S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR S PRTC=Y
"RTN","PRSALDA",153,0)
 S:$D(DIRUT) PRTC=0
"RTN","PRSALDA",154,0)
 Q
"RTN","PRSALDA",155,0)
 ;
"RTN","PRSALDA",156,0)
EX K DFN,DIC,IEN,IENS,IOFSAV,LP,NAME,NN,POP,PPI,PPNAME,PRSLD,PRSTLV
"RTN","PRSALDA",157,0)
 K TLE,TLI,X,%
"RTN","PRSALDA",158,0)
 Q
"RTN","PRSDPROC")
0^2^B14648155^B14186606
"RTN","PRSDPROC",1,0)
PRSDPROC ;SC/GWB-PAID DOWNLOAD PRS GLOBAL PROCESSOR ;5/6/93  13:12
"RTN","PRSDPROC",2,0)
 ;;4.0;PAID;**109**;Sep 21, 1995;Build 5
"RTN","PRSDPROC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRSDPROC",4,0)
 I '$D(^XTMP("PRS","TMP")) W !!,"There is no unprocessed PAID download data." R !!,"Press return to continue ",A:DTIME K A Q
"RTN","PRSDPROC",5,0)
TASK S ANS=""
"RTN","PRSDPROC",6,0)
 S %=0 W !!,"Do you want to task this job" D YN^DICN
"RTN","PRSDPROC",7,0)
 I %=-1 G EXIT
"RTN","PRSDPROC",8,0)
 I %=0 W !,?4,*7,"ANSWER 'YES' OR 'NO':" G TASK
"RTN","PRSDPROC",9,0)
 I %=1 S ZTRTN="PROC^PRSDPROC",ZTIO="",ZTDESC="PAID DOWNLOAD PROCESSOR" D ^%ZTLOAD Q
"RTN","PRSDPROC",10,0)
 S:%=2 ANS="N"
"RTN","PRSDPROC",11,0)
PROC S DATE="",SUB="TMP" D NOW^%DTC S TIME=%
"RTN","PRSDPROC",12,0)
 F L1=1:1 S DATE=$O(^XTMP("PRS",SUB,DATE)) Q:DATE=""  S TYPE="" F L2=1:1 S TYPE=$O(^XTMP("PRS",SUB,DATE,TYPE)) Q:TYPE=""  S STA="" F L3=1:1 S STA=$O(^XTMP("PRS",SUB,DATE,TYPE,STA)) Q:STA=""  S ECNT=0 D MSG,START^PRSDSERV,^PRSDSTAT
"RTN","PRSDPROC",13,0)
EXIT D EXIT^PRSDSERV
"RTN","PRSDPROC",14,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PRSDPROC",15,0)
 K ANS,L1,L2,L3,TIME
"RTN","PRSDPROC",16,0)
 Q
"RTN","PRSDPROC",17,0)
ERR I '$D(^XTMP("PRS","ERR")) W !!,"There are no unprocessed PAID download errors." R !!,"Press return to continue ",A:DTIME K A Q
"RTN","PRSDPROC",18,0)
 S DATE="",SUB="ERR"
"RTN","PRSDPROC",19,0)
 F L1=1:1 S DATE=$O(^XTMP("PRS",SUB,DATE)) Q:DATE=""  S TYPE="" F L2=1:1 S TYPE=$O(^XTMP("PRS",SUB,DATE,TYPE)) Q:TYPE=""  S STA="" F L3=1:1 S STA=$O(^XTMP("PRS",SUB,DATE,TYPE,STA)) Q:STA=""  S ECNT=0,ANS="" D MSG,START^PRSDSERV
"RTN","PRSDPROC",20,0)
 G EXIT
"RTN","PRSDPROC",21,0)
MSG S MTYPE=$S(TYPE="I":"Initial",TYPE="E":"Edit & Update",TYPE="P":"Payrun",TYPE="T":"Transfer",1:"")
"RTN","PRSDPROC",22,0)
 Q:'$D(ANS)
"RTN","PRSDPROC",23,0)
 W !!,"Processing ",MTYPE," data for station ",STA," for ",$E(DATE,5,6),"/",$E(DATE,7,8),"/",$E(DATE,3,4)," "
"RTN","PRSDPROC",24,0)
 Q
"RTN","PRSDPROC",25,0)
PRSD ;R !,"SSN: ",SSN:DTIME G:(SSN["^")!(SSN="") PRSDEX
"RTN","PRSDPROC",26,0)
 ;R !,"START WITH MSG #: ",MSGNUM:DTIME G:(MSGNUM["^")!(MSGNUM="") PRSDEX
"RTN","PRSDPROC",27,0)
 ;S BSKTIEN=0,BSKTIEN=$O(^XMB(3.7,.5,2,"B","S.PRSD",BSKTIEN))
"RTN","PRSDPROC",28,0)
 ;S XMZ=MSGNUM-1 F  S XMZ=$O(^XMB(3.7,.5,2,BSKTIEN,1,XMZ)) Q:XMZ'>0  W "." S XMPOS=0 F  D REC^XMS3 Q:XMER<0  D
"RTN","PRSDPROC",29,0)
 ;.I XMRG["****PDH" S TYPE=XMRG
"RTN","PRSDPROC",30,0)
 ;.I XMRG[SSN W !!,XMZ_"-"_XMPOS_TYPE,!!,XMRG
"RTN","PRSDPROC",31,0)
PRSDEX ;K SSN,MSGNUM,BSKTIEN,XMZ,TYPE,XMRG,XMER,XMPOS
"RTN","PRSDPROC",32,0)
 ;Q
"RTN","PRSDPROC",33,0)
XMB R !,"APPLICATION: ",APP:DTIME G:(APP["^")!(APP="") XMBEX
"RTN","PRSDPROC",34,0)
 R !,"ROUTING IND: ",RI:DTIME G:(RI["^")!(RI="") XMBEX
"RTN","PRSDPROC",35,0)
 R !,"DAY NUMBER: ",DN:DTIME G:(DN["^")!(DN="") XMBEX
"RTN","PRSDPROC",36,0)
 R !,"SSN: ",SSN:DTIME G:(SSN["^")!(SSN="") XMBEX
"RTN","PRSDPROC",37,0)
 S SUB=APP_"/"_RI_" #"_DN,TYPE=""
"RTN","PRSDPROC",38,0)
 F  S SUB=$O(^XMB(3.9,"B",SUB)) Q:SUB'[APP  W "." S XMZ=0,XMZ=$O(^XMB(3.9,"B",SUB,XMZ)) S XMPOS=0 F  D REC^XMS3 Q:XMER<0  D
"RTN","PRSDPROC",39,0)
 .I XMRG["****PDH" S TYPE=XMRG
"RTN","PRSDPROC",40,0)
 .I XMRG[SSN W !!,XMZ_"-"_XMPOS_TYPE,!!,XMRG
"RTN","PRSDPROC",41,0)
XMBEX K APP,RI,DN,SSN,SUB,TYPE,XMZ,XMRG,XMER,XMPOS
"RTN","PRSDPROC",42,0)
 Q
"RTN","PRSDPROC",43,0)
FIX R !,"IEN#1: ",IEN1:DTIME G:(IEN1["^")!(IEN1="") FIXEX
"RTN","PRSDPROC",44,0)
 R !,"IEN#2: ",IEN2:DTIME G:(IEN2["^")!(IEN2="") FIXEX
"RTN","PRSDPROC",45,0)
 S PPIEN=0 F  S PPIEN=$O(^PRST(459,PPIEN)) Q:PPIEN'>0  I $D(^PRST(459,PPIEN,"P",IEN1)) D
"RTN","PRSDPROC",46,0)
 .W !,"PAY PERIOD ",^PRST(459,PPIEN,0)
"RTN","PRSDPROC",47,0)
 .S %X="^PRST(459,PPIEN,""P"","_IEN1_","
"RTN","PRSDPROC",48,0)
 .S %Y="^PRST(459,PPIEN,""P"","_IEN2_","
"RTN","PRSDPROC",49,0)
 .I '$D(^PRST(459,PPIEN,"P",IEN2)) D %XY^%RCR S $P(^PRST(459,PPIEN,"P",IEN2,0),"^",1)=IEN2,^PRST(459,PPIEN,"P","B",IEN2,IEN2)=""
"RTN","PRSDPROC",50,0)
 .K ^PRST(459,PPIEN,"P",IEN1),^PRST(459,PPIEN,"P","B",IEN1,IEN1)
"RTN","PRSDPROC",51,0)
 S PPIEN=0 F  S PPIEN=$O(^PRST(455,PPIEN)) Q:PPIEN'>0  I $D(^PRST(455,PPIEN,1,IEN1)) D
"RTN","PRSDPROC",52,0)
 .W !,"PAY PERIOD ",$P(^PRST(455,PPIEN,0),"^",1)
"RTN","PRSDPROC",53,0)
 .S %X="^PRST(455,PPIEN,1,"_IEN1_","
"RTN","PRSDPROC",54,0)
 .S %Y="^PRST(455,PPIEN,1,"_IEN2_","
"RTN","PRSDPROC",55,0)
 .I '$D(^PRST(455,PPIEN,1,IEN2)) D %XY^%RCR S $P(^PRST(455,PPIEN,1,IEN2,0),"^",1)=IEN2,^PRST(455,PPIEN,1,"B",IEN2,IEN2)=""
"RTN","PRSDPROC",56,0)
 .K ^PRST(455,PPIEN,1,IEN1),^PRST(455,PPIEN,1,"B",IEN1,IEN1)
"RTN","PRSDPROC",57,0)
 D FIXEX G FIX
"RTN","PRSDPROC",58,0)
FIXEX K IEN1,IEN2,PPIEN,%X,%Y
"RTN","PRSDPROC",59,0)
 Q
"VER")
8.0^22.0
"BLD",6898,6)
^99
**END**
**END**
