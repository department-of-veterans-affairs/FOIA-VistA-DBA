Released OR*3*225 SEQ #202
Extracted from mail message
**KIDS**:OR*3.0*225^

**INSTALL NAME**
OR*3.0*225
"BLD",16819,0)
OR*3.0*225^ORDER ENTRY/RESULTS REPORTING^0^3041007^y
"BLD",16819,1,0)
^^1^1^3040930^
"BLD",16819,1,1,0)
Update to performance monitor to exclude Non-VA med entries.
"BLD",16819,4,0)
^9.64PA^^
"BLD",16819,"ABPKG")
n
"BLD",16819,"KRN",0)
^9.67PA^8989.52^19
"BLD",16819,"KRN",.4,0)
.4
"BLD",16819,"KRN",.401,0)
.401
"BLD",16819,"KRN",.402,0)
.402
"BLD",16819,"KRN",.403,0)
.403
"BLD",16819,"KRN",.5,0)
.5
"BLD",16819,"KRN",.84,0)
.84
"BLD",16819,"KRN",3.6,0)
3.6
"BLD",16819,"KRN",3.8,0)
3.8
"BLD",16819,"KRN",9.2,0)
9.2
"BLD",16819,"KRN",9.8,0)
9.8
"BLD",16819,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",16819,"KRN",9.8,"NM",1,0)
ORPRPM^^0^B62405390
"BLD",16819,"KRN",9.8,"NM","B","ORPRPM",1)

"BLD",16819,"KRN",19,0)
19
"BLD",16819,"KRN",19.1,0)
19.1
"BLD",16819,"KRN",101,0)
101
"BLD",16819,"KRN",409.61,0)
409.61
"BLD",16819,"KRN",771,0)
771
"BLD",16819,"KRN",870,0)
870
"BLD",16819,"KRN",8989.51,0)
8989.51
"BLD",16819,"KRN",8989.52,0)
8989.52
"BLD",16819,"KRN",8994,0)
8994
"BLD",16819,"KRN","B",.4,.4)

"BLD",16819,"KRN","B",.401,.401)

"BLD",16819,"KRN","B",.402,.402)

"BLD",16819,"KRN","B",.403,.403)

"BLD",16819,"KRN","B",.5,.5)

"BLD",16819,"KRN","B",.84,.84)

"BLD",16819,"KRN","B",3.6,3.6)

"BLD",16819,"KRN","B",3.8,3.8)

"BLD",16819,"KRN","B",9.2,9.2)

"BLD",16819,"KRN","B",9.8,9.8)

"BLD",16819,"KRN","B",19,19)

"BLD",16819,"KRN","B",19.1,19.1)

"BLD",16819,"KRN","B",101,101)

"BLD",16819,"KRN","B",409.61,409.61)

"BLD",16819,"KRN","B",771,771)

"BLD",16819,"KRN","B",870,870)

"BLD",16819,"KRN","B",8989.51,8989.51)

"BLD",16819,"KRN","B",8989.52,8989.52)

"BLD",16819,"KRN","B",8994,8994)

"BLD",16819,"QUES",0)
^9.62^^
"BLD",16819,"REQB",0)
^9.611^1^1
"BLD",16819,"REQB",1,0)
OR*3.0*190^1
"BLD",16819,"REQB","B","OR*3.0*190",1)

"MBREQ")
0
"PKG",22,-1)
1^1
"PKG",22,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",22,20,0)
^9.402P^^
"PKG",22,22,0)
^9.49I^1^1
"PKG",22,22,1,0)
3.0^2971217^2980204^64
"PKG",22,22,1,"PAH",1,0)
225^3041007
"PKG",22,22,1,"PAH",1,1,0)
^^1^1^3041007
"PKG",22,22,1,"PAH",1,1,1,0)
Update to performance monitor to exclude Non-VA med entries.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORPRPM")
0^1^B62405390
"RTN","ORPRPM",1,0)
ORPRPM ;DAN/SLC Performance Measure; ;10/7/04  09:08
"RTN","ORPRPM",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**107,114,119,196,190,225**;Dec 17, 1997
"RTN","ORPRPM",3,0)
 ;
"RTN","ORPRPM",4,0)
 ;DBIA SECTION
"RTN","ORPRPM",5,0)
 ;4195 - EN^PSOTPCUL
"RTN","ORPRPM",6,0)
 ;3744 - $$TESTPAT^VADPT
"RTN","ORPRPM",7,0)
 ;10060- Reference to file 200
"RTN","ORPRPM",8,0)
 ;
"RTN","ORPRPM",9,0)
 ;This routine will print a report indicating the percent of
"RTN","ORPRPM",10,0)
 ;orders entered for a provider by a provider holding the ORES key.
"RTN","ORPRPM",11,0)
 ;The data for the report will be stored in ^TMP as follows:
"RTN","ORPRPM",12,0)
 ;^TMP($J,"SUM",Provider Name,Patient Status)=Total # of order (universe)^Denominator^Numerator^Verbal^Written^Telephone^Policy^Electronically entered^Student entered^Outpatient narcotic orders
"RTN","ORPRPM",13,0)
 ;Where Patient Status is I for inpatient or O for outpatient.
"RTN","ORPRPM",14,0)
 ;
"RTN","ORPRPM",15,0)
 N DIR,ORSD,ORED,ORPROV,ORTYPE,ORPT,ORREP,ORPIECE,Y,DIRUT,DUOUT,DTOUT,ZTRTN,ORDT,ORIEN,ORACT0,ORPVID,PG,REPDT,ORSTOP,ORI,ORJ,ORPAT,ORTOT,ORSTOT,X,ORPVNM,ORORD,ORPTST,ORP,ORWROTE,ORNS,ORFS,ORPFILE
"RTN","ORPRPM",16,0)
 D GETDATE K DIR Q:$D(DIRUT)  ;quit if no dates selected ;get start and end dates
"RTN","ORPRPM",17,0)
 D GETPROV K DIR Q:'$D(ORPROV)!($G(ORPROV)'="ALL"&($D(ORPROV)'=11))!($D(DUOUT))!($D(DTOUT))  ;quit if user didn't select all providers or if didn't choose individual providers or if user timed out or up-arrowed out
"RTN","ORPRPM",18,0)
 D GETOTHER Q:$D(DIRUT)  ;quit if any questions were unanswered in this section
"RTN","ORPRPM",19,0)
 S ZTRTN="DQ^ORPRPM" D QUE^ORUTL1(ZTRTN,"CPRS Performance Monitor")
"RTN","ORPRPM",20,0)
 Q
"RTN","ORPRPM",21,0)
 ;
"RTN","ORPRPM",22,0)
GETDATE ;Prompt for start and end dates
"RTN","ORPRPM",23,0)
 S DIR(0)="DO^:DT:AE",DIR("A")="Enter starting date",DIR("?")="Enter date to begin searching from" D ^DIR Q:$D(DIRUT)  S ORSD=Y
"RTN","ORPRPM",24,0)
 S DIR(0)="DOA^"_ORSD_":DT:AE",DIR("A")="Enter ending date: ",DIR("?")="Enter date to stop searching.  Must be between "_$$FMTE^XLFDT(ORSD,2)_" and "_$$FMTE^XLFDT(DT,2) D ^DIR Q:$D(DIRUT)
"RTN","ORPRPM",25,0)
 S ORED=Y_.24,ORSD=ORSD-.1 ;Set end date to end of day, start date back to include current day
"RTN","ORPRPM",26,0)
 Q  ;End GETDATE
"RTN","ORPRPM",27,0)
 ;
"RTN","ORPRPM",28,0)
GETPROV ;Allow selection of all/single/multiple providers
"RTN","ORPRPM",29,0)
 ;return ORPROV="ALL" for all providers or ORPROV array for individual providers
"RTN","ORPRPM",30,0)
 S DIR(0)="Y",DIR("A")="Do you want ALL providers to appear on this report",DIR("B")="Y",DIR("?")="Enter Yes to search for all providers.  Enter No to select individual providers"  D ^DIR Q:$D(DIRUT)  S ORPROV=$S(Y=1:"ALL",1:"") Q:ORPROV="ALL"
"RTN","ORPRPM",31,0)
 K DIR ;clear DIR variables before getting individual providers
"RTN","ORPRPM",32,0)
 F  D  Q:$D(DIRUT)  ;quit when finished selecting
"RTN","ORPRPM",33,0)
 .S DIR(0)="PO^200:AEQM",DIR("S")="I $D(^VA(200,""AK.PROVIDER"",$P(^(0),U)))",DIR("A")="Select "_$S($D(ORPROV)=11:"another ",1:"")_"provider"
"RTN","ORPRPM",34,0)
 .S DIR("?")="Select providers to appear on report.  Return when finished, ^ to stop processing" D ^DIR Q:$D(DIRUT)  S ORPROV(+Y)=""
"RTN","ORPRPM",35,0)
 Q  ;End GETPROV
"RTN","ORPRPM",36,0)
 ;
"RTN","ORPRPM",37,0)
GETOTHER ;Get order type, patient type, and summary only report response
"RTN","ORPRPM",38,0)
 ;Get order type first
"RTN","ORPRPM",39,0)
 S DIR(0)="S^A:All orders;P:Pharmacy orders only",DIR("A")="Select order category",DIR("B")="P",DIR("?")="Enter P to see pharmacy orders only.  Enter A to see all orders. Enter ^ to quit" D ^DIR Q:$D(DIRUT)  S ORTYPE=Y
"RTN","ORPRPM",40,0)
 K DIR
"RTN","ORPRPM",41,0)
 ;Get patient status
"RTN","ORPRPM",42,0)
 S DIR(0)="S^I:Inpatient;O:Outpatient;B:Both",DIR("A")="Select patient status",DIR("B")="B",DIR("?")="Enter patient status at time of order.  Enter ^ to quit" D ^DIR Q:$D(DIRUT)  S ORPT=Y
"RTN","ORPRPM",43,0)
 K DIR
"RTN","ORPRPM",44,0)
 ;Ask if user desires facility subtotal, summary, detail, or both (detail and summary) reports
"RTN","ORPRPM",45,0)
 S DIR(0)="S^S:Summary (includes provider details);D:Detail (includes order details);B:Both (Summary & Detail);T:Summary Report Totals Only (no provider details)",DIR("A")="Select report",DIR("B")="S"
"RTN","ORPRPM",46,0)
 D ^DIR Q:$D(DIRUT)  S ORREP=Y,ORFS=0 I Y="T" S ORREP="S",ORFS=1
"RTN","ORPRPM",47,0)
 K DIR
"RTN","ORPRPM",48,0)
 Q  ;End GETOTHER
"RTN","ORPRPM",49,0)
 ;
"RTN","ORPRPM",50,0)
DQ ;Come here to do build and print from QUE^ORUTL either direct or tasked
"RTN","ORPRPM",51,0)
 U IO K ^TMP($J) ;clean out temp space
"RTN","ORPRPM",52,0)
 S ORDT=ORSD F  S ORDT=$O(^OR(100,"AF",ORDT)) Q:'ORDT!(ORDT>ORED)  S ORIEN="" F  S ORIEN=$O(^OR(100,"AF",ORDT,ORIEN)) Q:'ORIEN  I $O(^OR(100,"AF",ORDT,ORIEN,0))=1 I $D(^OR(100,ORIEN,8,1,0)) D CHECK
"RTN","ORPRPM",53,0)
 D PRINT^ORPRPM1
"RTN","ORPRPM",54,0)
 K ^TMP($J)
"RTN","ORPRPM",55,0)
 Q
"RTN","ORPRPM",56,0)
 ;
"RTN","ORPRPM",57,0)
CHECK ;If order matches requirements then save
"RTN","ORPRPM",58,0)
 S ORPFILE=$P($G(^OR(100,ORIEN,0)),"^",2) Q:ORPFILE=""  ;Quit if no object of order
"RTN","ORPRPM",59,0)
 I $P(ORPFILE,";",2)["DPT" Q:$$TESTPAT^VADPT(+$P($G(^OR(100,ORIEN,0)),"^",2))  ;225 Quit if test patient
"RTN","ORPRPM",60,0)
 Q:+$P($G(^OR(100,ORIEN,3)),"^",11)'=0  ;190 quit if order type not standard
"RTN","ORPRPM",61,0)
 Q:$P(^ORD(100.98,$P(^OR(100,ORIEN,0),U,11),0),U)="NON-VA MEDICATIONS"  ;225 Quit if Non-VA med entry
"RTN","ORPRPM",62,0)
 S ORPTST=$P($G(^OR(100,ORIEN,0)),"^",12) ;patient status (in/out)
"RTN","ORPRPM",63,0)
 I ORPT'="B" Q:ORPTST'=ORPT  ;Quit if patient status is not 'both' and status doesn't match selected status
"RTN","ORPRPM",64,0)
 S ORNS=$$NMSP^ORCD($P($G(^OR(100,ORIEN,0)),"^",14))
"RTN","ORPRPM",65,0)
 I ORTYPE'="A"&(ORNS'="PS") Q  ;if not getting all types of orders then quit if order is not from pharmacy
"RTN","ORPRPM",66,0)
 I ORPTST="O",ORNS="PS",$G(^OR(100,ORIEN,4))=+$G(^OR(100,ORIEN,4)),$L($T(EN^PSOTPCUL)) Q:$$EN^PSOTPCUL($G(^OR(100,ORIEN,4)))  ;196 Don't count if outpatient pharm order is a transitional pharmacy benefit order
"RTN","ORPRPM",67,0)
 S ORACT0=$G(^OR(100,ORIEN,8,1,0)),ORORD=$P(ORACT0,"^",12) ;ORORD holds nature of order ien
"RTN","ORPRPM",68,0)
 S ORPVID=$P(ORACT0,"^",3) I ORPROV'="ALL" Q:'$D(ORPROV(ORPVID))  ;quit if ordering provider doesn't match user selected provider
"RTN","ORPRPM",69,0)
 S ORPVNM=$$GET1^DIQ(200,ORPVID_",",.01) ;225 get provider name
"RTN","ORPRPM",70,0)
 Q:'$D(^XUSEC("ORES",ORPVID))  ;quit if ordering provider doesn't have ORES key DBIA # 10076 allows direct read of XUSEC
"RTN","ORPRPM",71,0)
 Q:"^1^2^3^5^8^"'[("^"_ORORD_"^")  ;quit if NATURE OF ORDER is not verbal, written, telephoned, policy, or electronically entered
"RTN","ORPRPM",72,0)
 D COUNT ;Count order
"RTN","ORPRPM",73,0)
 Q
"RTN","ORPRPM",74,0)
 ;
"RTN","ORPRPM",75,0)
COUNT ;This section determines how the order should be counted
"RTN","ORPRPM",76,0)
 N OREB,ORPIECE
"RTN","ORPRPM",77,0)
 D ADD(1) ;Add one to universe (total # of orders)
"RTN","ORPRPM",78,0)
 S OREB=$P(ORACT0,"^",13) ;Entered by
"RTN","ORPRPM",79,0)
 S ^TMP($J,"DET",ORPVNM,ORIEN)=$D(^XUSEC("ORES",OREB))&(OREB=ORPVID) ;Mark "HAS ORES" column for detailed listing if entered by = provider and has ORES key
"RTN","ORPRPM",80,0)
 I OREB=ORPVID D ADD(2),ADD(3) Q  ;if order entered by provider then add one to denominator and numerator
"RTN","ORPRPM",81,0)
 I ORNS="PS" I $$OIDEA=1 D ADD(10) Q  ;If order requires wet signature add one to narcotic group
"RTN","ORPRPM",82,0)
 I $$STUDENT D ADD(9) Q  ;If order entered by student add one to student group
"RTN","ORPRPM",83,0)
 S ORPIECE=$S(ORORD=1:4,ORORD=2:5,ORORD=3:6,ORORD=8:7,1:8) D ADD(ORPIECE) ;add to exceptions group for orders not entered by provider
"RTN","ORPRPM",84,0)
 I ORORD'=5 D ADD(2) ;Add to denominator if not policy order
"RTN","ORPRPM",85,0)
 Q
"RTN","ORPRPM",86,0)
 ;
"RTN","ORPRPM",87,0)
ADD(PIECE) ;Add one to storage
"RTN","ORPRPM",88,0)
 S $P(^TMP($J,"SUM",ORPVNM,ORPTST),"^",PIECE)=$P($G(^TMP($J,"SUM",ORPVNM,ORPTST)),"^",PIECE)+1 Q
"RTN","ORPRPM",89,0)
 ;
"RTN","ORPRPM",90,0)
OIDEA() ;Check to see if pharmacy order requires wet signature
"RTN","ORPRPM",91,0)
 ;dbia 3373 allows call to pharmacy API or dbia 221 allows direct read of ^PSDRUG if routine doesn't exist yet
"RTN","ORPRPM",92,0)
 N OI,PSOI,SIGREQ,PSSXOLP,PSSXOLPD,PSSXOLPX,PSSXNODD,PSSPKLX
"RTN","ORPRPM",93,0)
 Q:ORPTST'="O" 0 ;quit if inpatient
"RTN","ORPRPM",94,0)
 S OI=$$VALUE^ORX8(ORIEN,"ORDERABLE") ;get orderable item
"RTN","ORPRPM",95,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2) I PSOI'>0 Q 0 ;quit if no pharmacy orderable item
"RTN","ORPRPM",96,0)
 I $L($T(OIDEA^PSSUTLA1)) S SIGREQ=$$OIDEA^PSSUTLA1(PSOI,"O") Q:SIGREQ=1 1 Q 0 ;If SIGREQ = 1 then wet signature required
"RTN","ORPRPM",97,0)
 S (PSSXOLPD,PSSXNODD)=0
"RTN","ORPRPM",98,0)
 S PSSPKLX=0
"RTN","ORPRPM",99,0)
 F PSSXOLP=0:0 S PSSXOLP=$O(^PSDRUG("ASP",PSOI,PSSXOLP)) Q:'PSSXOLP!(PSSXOLPD=1)  D
"RTN","ORPRPM",100,0)
 .I $P($G(^PSDRUG(PSSXOLP,"I")),"^"),$P($G(^("I")),"^")<DT Q
"RTN","ORPRPM",101,0)
 .I 'PSSPKLX,$P($G(^PSDRUG(PSSXOLP,2)),"^",3)'["O" Q
"RTN","ORPRPM",102,0)
 .I PSSPKLX I $P($G(^PSDRUG(PSSXOLP,2)),"^",3)'["U",$P($G(^(2)),"^",3)'["I" Q
"RTN","ORPRPM",103,0)
 .S PSSXNODD=1
"RTN","ORPRPM",104,0)
 .S PSSXOLPX=$P($G(^PSDRUG(PSSXOLP,0)),"^",3)
"RTN","ORPRPM",105,0)
 .I PSSXOLPX[1!(PSSXOLPX[2)!((PSSXOLPX[3)&(PSSXOLPX["A")) S PSSXOLPD=1 Q
"RTN","ORPRPM",106,0)
 .I PSSXOLPX[3!(PSSXOLPX[4)!(PSSXOLPX[5) S PSSXOLPD=2
"RTN","ORPRPM",107,0)
 I PSSXOLPD=0,'PSSXNODD S PSSXOLPD=""
"RTN","ORPRPM",108,0)
 Q PSSXOLPD
"RTN","ORPRPM",109,0)
 ;
"RTN","ORPRPM",110,0)
STUDENT() ;Check to see if entered by is a student
"RTN","ORPRPM",111,0)
 ;Check USER CLASS for membership in "STUDENT" CLASS - DBIA 2324
"RTN","ORPRPM",112,0)
 ;Then check PROVIDER CLASS in NEW PERSON file for "STUDENT" - DBIA 10060
"RTN","ORPRPM",113,0)
 N ORCLASS,ORSUB,EXPIRE,ORUSR
"RTN","ORPRPM",114,0)
 D WHATIS^USRLM(OREB,"ORCLASS") ;API to get user class membership
"RTN","ORPRPM",115,0)
 S ORSUB=0,ORUSR=0 F  S ORSUB=$O(ORCLASS(ORSUB)) Q:ORSUB=""!ORUSR  D
"RTN","ORPRPM",116,0)
 .I $$UP^XLFSTR(ORSUB)'["STUDENT" Q  ;User not a member of student class
"RTN","ORPRPM",117,0)
 .I ORDT'<+$P(ORCLASS(ORSUB),"^",4) S EXPIRE=$S(+$P(ORCLASS(ORSUB),"^",5):$P(ORCLASS(ORSUB),"^",5),1:9999999) I ORDT'>EXPIRE S ORUSR=1 ;member of student class and within date range for class
"RTN","ORPRPM",118,0)
 I ORUSR Q 1 ;User identified as a student
"RTN","ORPRPM",119,0)
 K ORCLASS
"RTN","ORPRPM",120,0)
 S DIC=200,DR=53.5,DA=OREB,DIQ="ORCLASS",DIQ(0)="E" D EN^DIQ1
"RTN","ORPRPM",121,0)
 I $G(ORCLASS(200,OREB,53.5,"E"))["STUDENT" Q 1 ;Provider class set to student
"RTN","ORPRPM",122,0)
 Q 0 ;User not a student
"VER")
8.0^22.0
**END**
**END**
