Released MC*2.3*30 SEQ #29
Extracted from mail message
**KIDS**:MC*2.3*30^

**INSTALL NAME**
MC*2.3*30
"BLD",2951,0)
MC*2.3*30^MEDICINE^0^3010226^y
"BLD",2951,1,0)
^^1^1^3010212^
"BLD",2951,1,1,0)
See the Patch MC*2.3*30 Description on FORUM for Details.
"BLD",2951,4,0)
^9.64PA^^
"BLD",2951,"KRN",0)
^9.67PA^19^17
"BLD",2951,"KRN",.4,0)
.4
"BLD",2951,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",2951,"KRN",.401,0)
.401
"BLD",2951,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",2951,"KRN",.402,0)
.402
"BLD",2951,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",2951,"KRN",.403,0)
.403
"BLD",2951,"KRN",.5,0)
.5
"BLD",2951,"KRN",.84,0)
.84
"BLD",2951,"KRN",3.6,0)
3.6
"BLD",2951,"KRN",3.8,0)
3.8
"BLD",2951,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",2951,"KRN",9.2,0)
9.2
"BLD",2951,"KRN",9.8,0)
9.8
"BLD",2951,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",2951,"KRN",9.8,"NM",1,0)
MCARUTL2^^0^B25925561
"BLD",2951,"KRN",9.8,"NM",2,0)
MCARUTL3^^0^B7270223
"BLD",2951,"KRN",9.8,"NM","B","MCARUTL2",1)

"BLD",2951,"KRN",9.8,"NM","B","MCARUTL3",2)

"BLD",2951,"KRN",19,0)
19
"BLD",2951,"KRN",19,"NM",0)
^9.68A^^0
"BLD",2951,"KRN",19.1,0)
19.1
"BLD",2951,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",2951,"KRN",101,0)
101
"BLD",2951,"KRN",101,"NM",0)
^9.68A^^0
"BLD",2951,"KRN",409.61,0)
409.61
"BLD",2951,"KRN",771,0)
771
"BLD",2951,"KRN",771,"NM",0)
^9.68A^^0
"BLD",2951,"KRN",870,0)
870
"BLD",2951,"KRN",870,"NM",0)
^9.68A^^0
"BLD",2951,"KRN",8994,0)
8994
"BLD",2951,"KRN","B",.4,.4)

"BLD",2951,"KRN","B",.401,.401)

"BLD",2951,"KRN","B",.402,.402)

"BLD",2951,"KRN","B",.403,.403)

"BLD",2951,"KRN","B",.5,.5)

"BLD",2951,"KRN","B",.84,.84)

"BLD",2951,"KRN","B",3.6,3.6)

"BLD",2951,"KRN","B",3.8,3.8)

"BLD",2951,"KRN","B",9.2,9.2)

"BLD",2951,"KRN","B",9.8,9.8)

"BLD",2951,"KRN","B",19,19)

"BLD",2951,"KRN","B",19.1,19.1)

"BLD",2951,"KRN","B",101,101)

"BLD",2951,"KRN","B",409.61,409.61)

"BLD",2951,"KRN","B",771,771)

"BLD",2951,"KRN","B",870,870)

"BLD",2951,"KRN","B",8994,8994)

"MBREQ")
0
"PKG",31,-1)
1^1
"PKG",31,0)
MEDICINE^MC^MEDICINE PACKAGE INCLUDES ALL AREAS OF MEDICINE
"PKG",31,20,0)
^9.402P^^
"PKG",31,22,0)
^9.49I^1^1
"PKG",31,22,1,0)
2.3^2960913^2980615^4558
"PKG",31,22,1,"PAH",1,0)
30^3010226
"PKG",31,22,1,"PAH",1,1,0)
^^1^1^3010226
"PKG",31,22,1,"PAH",1,1,1,0)
See the Patch MC*2.3*30 Description on FORUM for Details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","MCARUTL2")
0^1^B25925561
"RTN","MCARUTL2",1,0)
MCARUTL2 ;HOIFO/WAA-Utility Routine #2;11/29/00  09:55
"RTN","MCARUTL2",2,0)
 ;;2.3;Medicine;**30**;09/13/1996
"RTN","MCARUTL2",3,0)
 ;;
"RTN","MCARUTL2",4,0)
 ;;These APIs are referenced in DBIA 3279
"RTN","MCARUTL2",5,0)
 ;Input:
"RTN","MCARUTL2",6,0)
 ;   Required: 
"RTN","MCARUTL2",7,0)
 ;     ARRAY = Array that data is to be stored in
"RTN","MCARUTL2",8,0)
 ;     DFN = Patient DFN
"RTN","MCARUTL2",9,0)
 ;     SUB = Sub Speciality on file 697.2
"RTN","MCARUTL2",10,0)
 ;   Optional:
"RTN","MCARUTL2",11,0)
 ;     FROM = From date
"RTN","MCARUTL2",12,0)
 ;     TO = To date
"RTN","MCARUTL2",13,0)
 ;
"RTN","MCARUTL2",14,0)
SUB(ARRAY,DFN,SUB,FROM,TO) ; Set a Screen for certain Speciality
"RTN","MCARUTL2",15,0)
 N PATNAM,SPEC,CNT,FLG,PDATE,PEDATE,SUBTXT,FILE,FNAME,FN,IEN,%,I,X
"RTN","MCARUTL2",16,0)
 N %I,%H,DISYS
"RTN","MCARUTL2",17,0)
 K ARRAY ; Purge Array
"RTN","MCARUTL2",18,0)
 S PATNAM="",CNT=0 ; init
"RTN","MCARUTL2",19,0)
 I DFN'="" S PATNAM=$$GET1^DIQ(2,DFN_",",.01,"I") ; Get patient name
"RTN","MCARUTL2",20,0)
 I PATNAM="" S ARRAY(CNT)="0^No patient has been defined." Q  ; no patient name
"RTN","MCARUTL2",21,0)
 I '$D(^MCAR(690,DFN,0)) S ARRAY(CNT)="0^"_PATNAM_" has NO Medicine Procedures on file." Q  ; Patient is not in Medicine patient
"RTN","MCARUTL2",22,0)
 I $G(FROM)="" S FROM=0 ; get from the beginning of time
"RTN","MCARUTL2",23,0)
 I $G(TO)="" D NOW^%DTC S TO=% ; get to now
"RTN","MCARUTL2",24,0)
 I SUB="" S ARRAY(CNT)="0^No Procedure defined." Q
"RTN","MCARUTL2",25,0)
 S SUBTXT=SUB ; if passing Text name saving it
"RTN","MCARUTL2",26,0)
 I SUB'?1N.N S SUB=$O(^MCAR(697.2,"B",SUB,0))
"RTN","MCARUTL2",27,0)
 I SUB<1 S ARRAY(CNT)="0^"_SUBTXT_"is an invalid Sub Speciality." Q
"RTN","MCARUTL2",28,0)
 ; ^----Will quit id Sub is not found in the 697.2,"B"
"RTN","MCARUTL2",29,0)
 S SPEC=$G(^MCAR(697.2,SUB,0)) ; Getting Sub Spec
"RTN","MCARUTL2",30,0)
 I SPEC="" S ARRAY(CNT)="0^"_SUBTXT_"is an invalid Sub Speciality." Q
"RTN","MCARUTL2",31,0)
 ; ^--- No Sub Spec.
"RTN","MCARUTL2",32,0)
 S FILE=$P(SPEC,U,2) ; Extended Reference
"RTN","MCARUTL2",33,0)
 S FN=$P(FILE,"(",2) ; file Number in MCAR name Range
"RTN","MCARUTL2",34,0)
 S FNAME=$P(SPEC,U) ; Procedure Name
"RTN","MCARUTL2",35,0)
 S IEN=0 ; v--- Looping in file FN for Patient DFN
"RTN","MCARUTL2",36,0)
 F  S IEN=$O(^MCAR(FN,"C",DFN,IEN)) Q:IEN<1  D
"RTN","MCARUTL2",37,0)
 . N LIN
"RTN","MCARUTL2",38,0)
 . S LIN=$G(^MCAR(FN,IEN,0))
"RTN","MCARUTL2",39,0)
 . Q:LIN=""  ; Invalid entry
"RTN","MCARUTL2",40,0)
 . ;Filter 699 and 699.5 for valid procedures
"RTN","MCARUTL2",41,0)
 . I FN=699,$P(LIN,U,12)'=SUB Q
"RTN","MCARUTL2",42,0)
 . I FN=699.5,$P(LIN,U,6)'=SUB Q
"RTN","MCARUTL2",43,0)
 . ;Filter dates
"RTN","MCARUTL2",44,0)
 . S PDATE=$P(LIN,U) ; Procedure date 
"RTN","MCARUTL2",45,0)
 . I PDATE<FROM Q  ; quit out of range
"RTN","MCARUTL2",46,0)
 . I PDATE>TO Q  ; quit out of range
"RTN","MCARUTL2",47,0)
 . S PEDATE=$$FMTE^XLFDT(PDATE,8) ; convert date to external format
"RTN","MCARUTL2",48,0)
 . S CNT=CNT+1
"RTN","MCARUTL2",49,0)
 . S ARRAY(CNT)=PEDATE_U_FNAME_U_PATNAM_U_FILE_U_IEN
"RTN","MCARUTL2",50,0)
 . ; getting Imaging PT
"RTN","MCARUTL2",51,0)
 . I (+$P($G(^MCAR(FN,IEN,2005,0)),U,3)) N CNT2,IMAGE S (IMAGE,CNT2)=0 F  S IMAGE=$O(^MCAR(FN,IEN,2005,IMAGE)) Q:IMAGE<1  D
"RTN","MCARUTL2",52,0)
 . . N IEN2005
"RTN","MCARUTL2",53,0)
 . . S IEN2005=$P($G(^MCAR(FN,IEN,2005,IMAGE,0)),U) Q:IEN2005<1
"RTN","MCARUTL2",54,0)
 . . S CNT2=CNT2+1
"RTN","MCARUTL2",55,0)
 . . S ARRAY(CNT,2005,CNT2)=IEN2005
"RTN","MCARUTL2",56,0)
 . . Q
"RTN","MCARUTL2",57,0)
 . ; ^------ Building Array for entry
"RTN","MCARUTL2",58,0)
 . I $D(ARRAY(CNT,2005,1)) S ARRAY(CNT)=ARRAY(CNT)_U_"1"_U
"RTN","MCARUTL2",59,0)
 . E  S ARRAY(CNT)=ARRAY(CNT)_U_"0"_U
"RTN","MCARUTL2",60,0)
 . Q
"RTN","MCARUTL2",61,0)
 I CNT<1 S ARRAY(CNT)="0^No "_FNAME_" procedure found for Patient "_PATNAM
"RTN","MCARUTL2",62,0)
 ; ^------- No entries found for patient
"RTN","MCARUTL2",63,0)
 E  S ARRAY(0)="1^"_CNT_" "_FNAME_" Procedure"_$S(CNT=1:"",1:"s")_" found for Patient "_PATNAM
"RTN","MCARUTL2",64,0)
 ; ^------- Processing 0 node on array if data was found
"RTN","MCARUTL2",65,0)
 S ARRAY=CNT ; passing total number of entries found for patient
"RTN","MCARUTL2",66,0)
 Q
"RTN","MCARUTL2",67,0)
PATLK() ; Lookup patient in medicine file.
"RTN","MCARUTL2",68,0)
 N DIC,X,Y,DILN,%,I,%I,DGMT,DGMTE,DGWRT,DISYS,DST,DGNOCOPF
"RTN","MCARUTL2",69,0)
 S DIC="^MCAR(690,",DIC(0)="AEMQ"
"RTN","MCARUTL2",70,0)
 D ^DIC
"RTN","MCARUTL2",71,0)
 Q +Y
"RTN","MCARUTL2",72,0)
PATSUB(ARRAY,DFN) ; Find all Subs for a patient
"RTN","MCARUTL2",73,0)
 N PATNAM,SPEC,CNT,FLG,PDATE,PEDATE,IMAGE,SUBTXT,FILE,FNAME,FN,IEN,SUB,DISYS
"RTN","MCARUTL2",74,0)
 K ARRAY ; Purge Array
"RTN","MCARUTL2",75,0)
 S PATNAM="",CNT=0 ; init
"RTN","MCARUTL2",76,0)
 I DFN'="" S PATNAM=$$GET1^DIQ(2,DFN_",",.01,"I") ; Get patient name
"RTN","MCARUTL2",77,0)
 I PATNAM="" S ARRAY(CNT)="0^No patient has been defined." Q  ; no patient name
"RTN","MCARUTL2",78,0)
 I '$D(^MCAR(690,DFN,0)) S ARRAY(CNT)="0^"_PATNAM_" has NO Medicine Procedures on file." Q  ; Patient is not in Medicine patient
"RTN","MCARUTL2",79,0)
 S SUB=0
"RTN","MCARUTL2",80,0)
 F  S SUB=$O(^MCAR(697.2,SUB)) Q:SUB<1  D
"RTN","MCARUTL2",81,0)
 . ; Go thur all the entries in 697.2
"RTN","MCARUTL2",82,0)
 . N LN,IEN,PCNT
"RTN","MCARUTL2",83,0)
 . S LN=$G(^MCAR(697.2,SUB,0)) ; insure that the entry is valid
"RTN","MCARUTL2",84,0)
 . Q:LN=""
"RTN","MCARUTL2",85,0)
 . S FILE=$P(LN,U,2) ; get the MCAR file name
"RTN","MCARUTL2",86,0)
 . S FN=$P(FILE,"(",2) ; get the file number
"RTN","MCARUTL2",87,0)
 . S FNAME=$P(LN,U) ; get the procedure name
"RTN","MCARUTL2",88,0)
 . Q:'$D(^MCAR(FN,"C",DFN))  ; quit if there is no entry for that patient
"RTN","MCARUTL2",89,0)
 . S PCNT=$$VALDT(DFN,FN,SUB) I PCNT=0 Q  ; Validate that there are SUBs
"RTN","MCARUTL2",90,0)
 . S CNT=CNT+1
"RTN","MCARUTL2",91,0)
 . S ARRAY(CNT)=FNAME_U_SUB_U_PCNT ; Build array string
"RTN","MCARUTL2",92,0)
 . Q
"RTN","MCARUTL2",93,0)
 S ARRAY=CNT
"RTN","MCARUTL2",94,0)
 I CNT=0 S ARRAY(CNT)="0^There are no Procedures on file for "_PATNAM
"RTN","MCARUTL2",95,0)
 E  S ARRAY=CNT S ARRAY(0)="1^There were "_CNT_" procedures found for patient "_PATNAM
"RTN","MCARUTL2",96,0)
 Q
"RTN","MCARUTL2",97,0)
VALDT(DFN,FN,SUB) ; Validate that there is a report for that patient
"RTN","MCARUTL2",98,0)
 N ANS,IEN
"RTN","MCARUTL2",99,0)
 S (ANS,IEN)=0 ; Init
"RTN","MCARUTL2",100,0)
 F  S IEN=$O(^MCAR(FN,"C",DFN,IEN)) Q:IEN<1  D
"RTN","MCARUTL2",101,0)
 . ; Loop thru and validate each entry for a subspeciality
"RTN","MCARUTL2",102,0)
 . N LIN ; init
"RTN","MCARUTL2",103,0)
 . S LIN=$G(^MCAR(FN,IEN,0)) ; check the 0 node valid
"RTN","MCARUTL2",104,0)
 . Q:LIN=""  ; Invalid entry
"RTN","MCARUTL2",105,0)
 . ;Filter 699 and 699.5 for valid procedures
"RTN","MCARUTL2",106,0)
 . I FN=699,$P(LIN,U,12)'=SUB Q
"RTN","MCARUTL2",107,0)
 . I FN=699.5,$P(LIN,U,6)'=SUB Q
"RTN","MCARUTL2",108,0)
 . S ANS=ANS+1 ; If it is valid then add 1 to the count
"RTN","MCARUTL2",109,0)
 . Q
"RTN","MCARUTL2",110,0)
 Q ANS ; pass back the total number of valid entries found
"RTN","MCARUTL3")
0^2^B7270223
"RTN","MCARUTL3",1,0)
MCARUTL3 ;HOIFO/WAA-Utility Routine #3;11/29/00  09:55
"RTN","MCARUTL3",2,0)
 ;;2.3;Medicine;**30**;09/13/1996
"RTN","MCARUTL3",3,0)
 ;;
"RTN","MCARUTL3",4,0)
 ;;This API is referenced in DBIA 3280
"RTN","MCARUTL3",5,0)
 ;
"RTN","MCARUTL3",6,0)
MEDLKUP(ARRAY,FN,IEN) ; This sub-routine will return the following information
"RTN","MCARUTL3",7,0)
 ; Input:
"RTN","MCARUTL3",8,0)
 ;    ARRAY = the array for the return array
"RTN","MCARUTL3",9,0)
 ;    FN = the medicine file number
"RTN","MCARUTL3",10,0)
 ;    IEN = the Internal Entry Number
"RTN","MCARUTL3",11,0)
 ; Output:
"RTN","MCARUTL3",12,0)
 ;    piece 1 =0 (failure) or 1 (success, 2nd piece is message text.)
"RTN","MCARUTL3",13,0)
 ;    piece 2     = Medicine file
"RTN","MCARUTL3",14,0)
 ;    piece 3     = Medicine ien
"RTN","MCARUTL3",15,0)
 ;    piece 4 & 5 =Medicine patient (internal ^ external)
"RTN","MCARUTL3",16,0)
 ;    piece 6 & 7 =Medicine date/time   (internal ^ external)
"RTN","MCARUTL3",17,0)
 ;    piece 8 & 9 =Medicine Procedure (internal ^ external)
"RTN","MCARUTL3",18,0)
 ;    piece 10 & 11 =i~_Image (Med,2005,IEN) ^ external pointer to 2005)
"RTN","MCARUTL3",19,0)
 N LINE,PDATE,EDATE,DFN,PATNAM,PROC,PROCN,IMG,IMAGE,DILN,%,I,DISYS
"RTN","MCARUTL3",20,0)
 S ARRAY=0
"RTN","MCARUTL3",21,0)
 S FN=$G(FN) I FN="" S ARRAY="0^No File indicated." Q
"RTN","MCARUTL3",22,0)
 I FN=690 S ARRAY="0^Cannot look-up on MEDICAL PATIENT File." Q
"RTN","MCARUTL3",23,0)
 I FN<690!(FN>701) S ARRAY="0^Non-Medicine File indicated." Q 
"RTN","MCARUTL3",24,0)
 I FN=697.2 S ARRAY="0^Cannot look-up on PROCEDURE/SUBSPECIALTY File." Q
"RTN","MCARUTL3",25,0)
 I ($O(^MCAR(697.2,"C","MCAR("_FN,0)))<1 S ARRAY="0^"_FN_" is not a procedure file." Q
"RTN","MCARUTL3",26,0)
 S IEN=$G(IEN) I IEN="" S ARRAY="0^No IEN indicated." Q 
"RTN","MCARUTL3",27,0)
 S LINE=$G(^MCAR(FN,IEN,0))
"RTN","MCARUTL3",28,0)
 I LINE="" S ARRAY="0^Entry "_IEN_" in file "_FN_" not found." Q
"RTN","MCARUTL3",29,0)
 S PDATE=$P(LINE,U,1) ; Procedure Date
"RTN","MCARUTL3",30,0)
 I PDATE<1 S ARRAY="0^Incomplete data, NO Procedure Date in entry "_IEN_" for file "_FN Q
"RTN","MCARUTL3",31,0)
 S EDATE=$$FMTE^XLFDT(PDATE,8) ; External Date
"RTN","MCARUTL3",32,0)
 S DFN=$P(LINE,U,2) ; Get Patient
"RTN","MCARUTL3",33,0)
 I DFN<1 S ARRAY="0^Incomplete data, NO Patient in entry "_IEN_" for file "_FN Q
"RTN","MCARUTL3",34,0)
 S PATNAM=$$GET1^DIQ(2,DFN_",",.01,"I") ; Patient Name
"RTN","MCARUTL3",35,0)
 S PROC="" ; setup for getting indicated procedure
"RTN","MCARUTL3",36,0)
 I FN=699 S PROC=$P(LINE,U,12) ; Screening
"RTN","MCARUTL3",37,0)
 I FN=699.5 S PROC=$P(LINE,U,6) ; Screening
"RTN","MCARUTL3",38,0)
 I FN=694 S PROC=$P(LINE,U,3) ; Screening
"RTN","MCARUTL3",39,0)
 I PROC="" S PROC=$O(^MCAR(697.2,"C","MCAR("_FN,0)) ; Verify the procedure
"RTN","MCARUTL3",40,0)
 I PROC<1 S ARRAY="0^No Procedure indicated." Q  ; Bad Procedure
"RTN","MCARUTL3",41,0)
 S PROCN=$P($G(^MCAR(697.2,PROC,0)),U) ; get procedure number
"RTN","MCARUTL3",42,0)
 I PROCN="" S ARRAY="0^No Procedure Name indicated." Q  ; again Bad
"RTN","MCARUTL3",43,0)
 S ARRAY="1"_U_FN_U_IEN_U_DFN_U_PATNAM_U_PDATE_U_EDATE_U_PROC_U_PROCN
"RTN","MCARUTL3",44,0)
 S IMG=+$P($G(^MCAR(FN,IEN,2005,0)),U,3) I IMG D
"RTN","MCARUTL3",45,0)
 . S IMAGE=+$P($G(^MCAR(FN,IEN,2005,IMG,0)),U)
"RTN","MCARUTL3",46,0)
 . S ARRAY=ARRAY_U_IMG_U_IMAGE
"RTN","MCARUTL3",47,0)
 . Q
"RTN","MCARUTL3",48,0)
 ; Getting Image and passing back
"RTN","MCARUTL3",49,0)
 Q
"VER")
8.0^22
**END**
**END**
