Released PSJ*5*147 SEQ #133
Extracted from mail message
**KIDS**:PSJ*5.0*147^

**INSTALL NAME**
PSJ*5.0*147
"BLD",6212,0)
PSJ*5.0*147^INPATIENT MEDICATIONS^0^3050912^y
"BLD",6212,1,0)
^^13^13^3050615^
"BLD",6212,1,1,0)
 1. When a provider enters an IV order and the Pharmacist finishes the
"BLD",6212,1,2,0)
    order and tries to delete an additive and make changes in the solution
"BLD",6212,1,3,0)
    field the additive shows as deleted. When the order is accepted, the
"BLD",6212,1,4,0)
    order re-displays shows with the same additive that was deleted.  This
"BLD",6212,1,5,0)
    correction makes the needed code changes so that the deleted additive
"BLD",6212,1,6,0)
    will actually be deleted as requested.
"BLD",6212,1,7,0)
 
"BLD",6212,1,8,0)
 2. The pharmacist is unable to edit the solution field of a newly entered
"BLD",6212,1,9,0)
    TPN order.  It was noted in the original NOIS report and supporting
"BLD",6212,1,10,0)
    screen captures that the pharmacist was using lower case.  The system
"BLD",6212,1,11,0)
    responded differently because of the lower case letters.  The changes
"BLD",6212,1,12,0)
    included in this patch will cause the system to function equally for
"BLD",6212,1,13,0)
    upper and lower case letters in the standard VISTA operation.
"BLD",6212,4,0)
^9.64PA^^
"BLD",6212,6)
5^
"BLD",6212,"KRN",0)
^9.67PA^8989.52^19
"BLD",6212,"KRN",.4,0)
.4
"BLD",6212,"KRN",.401,0)
.401
"BLD",6212,"KRN",.402,0)
.402
"BLD",6212,"KRN",.403,0)
.403
"BLD",6212,"KRN",.5,0)
.5
"BLD",6212,"KRN",.84,0)
.84
"BLD",6212,"KRN",3.6,0)
3.6
"BLD",6212,"KRN",3.8,0)
3.8
"BLD",6212,"KRN",9.2,0)
9.2
"BLD",6212,"KRN",9.8,0)
9.8
"BLD",6212,"KRN",9.8,"NM",0)
^9.68A^3^1
"BLD",6212,"KRN",9.8,"NM",3,0)
PSIVEDRG^^0^44029620
"BLD",6212,"KRN",9.8,"NM","B","PSIVEDRG",3)

"BLD",6212,"KRN",19,0)
19
"BLD",6212,"KRN",19.1,0)
19.1
"BLD",6212,"KRN",101,0)
101
"BLD",6212,"KRN",409.61,0)
409.61
"BLD",6212,"KRN",771,0)
771
"BLD",6212,"KRN",870,0)
870
"BLD",6212,"KRN",8989.51,0)
8989.51
"BLD",6212,"KRN",8989.52,0)
8989.52
"BLD",6212,"KRN",8994,0)
8994
"BLD",6212,"KRN","B",.4,.4)

"BLD",6212,"KRN","B",.401,.401)

"BLD",6212,"KRN","B",.402,.402)

"BLD",6212,"KRN","B",.403,.403)

"BLD",6212,"KRN","B",.5,.5)

"BLD",6212,"KRN","B",.84,.84)

"BLD",6212,"KRN","B",3.6,3.6)

"BLD",6212,"KRN","B",3.8,3.8)

"BLD",6212,"KRN","B",9.2,9.2)

"BLD",6212,"KRN","B",9.8,9.8)

"BLD",6212,"KRN","B",19,19)

"BLD",6212,"KRN","B",19.1,19.1)

"BLD",6212,"KRN","B",101,101)

"BLD",6212,"KRN","B",409.61,409.61)

"BLD",6212,"KRN","B",771,771)

"BLD",6212,"KRN","B",870,870)

"BLD",6212,"KRN","B",8989.51,8989.51)

"BLD",6212,"KRN","B",8989.52,8989.52)

"BLD",6212,"KRN","B",8994,8994)

"BLD",6212,"QUES",0)
^9.62^^
"BLD",6212,"REQB",0)
^9.611^3^1
"BLD",6212,"REQB",3,0)
PSJ*5.0*128^2
"BLD",6212,"REQB","B","PSJ*5.0*128",3)

"MBREQ")
0
"PKG",203,-1)
1^1
"PKG",203,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",203,22,0)
^9.49I^1^1
"PKG",203,22,1,0)
5.0^2971215^2980417^1271
"PKG",203,22,1,"PAH",1,0)
147^3050912^33249
"PKG",203,22,1,"PAH",1,1,0)
^^13^13^3050912
"PKG",203,22,1,"PAH",1,1,1,0)
 1. When a provider enters an IV order and the Pharmacist finishes the
"PKG",203,22,1,"PAH",1,1,2,0)
    order and tries to delete an additive and make changes in the solution
"PKG",203,22,1,"PAH",1,1,3,0)
    field the additive shows as deleted. When the order is accepted, the
"PKG",203,22,1,"PAH",1,1,4,0)
    order re-displays shows with the same additive that was deleted.  This
"PKG",203,22,1,"PAH",1,1,5,0)
    correction makes the needed code changes so that the deleted additive
"PKG",203,22,1,"PAH",1,1,6,0)
    will actually be deleted as requested.
"PKG",203,22,1,"PAH",1,1,7,0)
 
"PKG",203,22,1,"PAH",1,1,8,0)
 2. The pharmacist is unable to edit the solution field of a newly entered
"PKG",203,22,1,"PAH",1,1,9,0)
    TPN order.  It was noted in the original NOIS report and supporting
"PKG",203,22,1,"PAH",1,1,10,0)
    screen captures that the pharmacist was using lower case.  The system
"PKG",203,22,1,"PAH",1,1,11,0)
    responded differently because of the lower case letters.  The changes
"PKG",203,22,1,"PAH",1,1,12,0)
    included in this patch will cause the system to function equally for
"PKG",203,22,1,"PAH",1,1,13,0)
    upper and lower case letters in the standard VISTA operation.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSIVEDRG")
0^3^B44029620
"RTN","PSIVEDRG",1,0)
PSIVEDRG ;BIR/MLM-ENTER/EDIT DRUGS FOR IV ORDER ;16 Mar 99 / 2:14 PM
"RTN","PSIVEDRG",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**21,33,50,65,74,84,128,147**;16 DEC 97
"RTN","PSIVEDRG",3,0)
 ;
"RTN","PSIVEDRG",4,0)
 ; References to ^PS(52.6 supported by DBIA# 1231.
"RTN","PSIVEDRG",5,0)
 ; References to ^PS(52.7 supported by DBIA# 2173.
"RTN","PSIVEDRG",6,0)
 ; Reference to EN^PSOORDRG supported by DBIA# 2190.
"RTN","PSIVEDRG",7,0)
 ;
"RTN","PSIVEDRG",8,0)
DRG ; Edit Additive/Solution data
"RTN","PSIVEDRG",9,0)
 NEW DRGOC,PSGORQF ;If PSGORQF=1 abort order after order check.
"RTN","PSIVEDRG",10,0)
 K PSIVOLD S DRG(2)="" I $D(DRG(DRGT)) S DRGI=+$O(DRG(DRGT,0)) I DRGI S PSIVOLD=1 D SETDRG
"RTN","PSIVEDRG",11,0)
DRG1 ;
"RTN","PSIVEDRG",12,0)
 Q:$G(PSGORQF)
"RTN","PSIVEDRG",13,0)
 I $G(X)="?" K DUOUT
"RTN","PSIVEDRG",14,0)
 D FULL^VALM1
"RTN","PSIVEDRG",15,0)
 W !,"Select ",DRGTN,": "
"RTN","PSIVEDRG",16,0)
 I DRGT=$G(PSIVOI),($G(PSIVOI("DILIST",0))>1) D GTADSOL Q
"RTN","PSIVEDRG",17,0)
 W:DRG(2)]"" DRG(2),"//" R X:DTIME S:'$T X="^" S:X=U DONE=1 Q:X["^"!(X=""&(DRG(2)=""))
"RTN","PSIVEDRG",18,0)
DRG1A I X="" W !,DRGTN,": ",DRG(2),"//" R X:DTIME S:'$T X="^" Q:X="^"  I X="" S Y=1 D DRG3 G:DRGT="AD"!($G(P(4))="H") DRG1 Q
"RTN","PSIVEDRG",19,0)
 I X="@",DRG(2)]"" D DEL G:%'=1 DRG1A K DRG(DRGT,DRGI) S DRGI=+$O(DRG(DRGT,0)) S:'DRGI DRG(DRGT,0)=0 D SETDRG G DRG1
"RTN","PSIVEDRG",20,0)
 I X["???",($E(P("OT"))="M"),(PSIVAC["C") D ORFLDS^PSIVEDT1 G DRG1
"RTN","PSIVEDRG",21,0)
 I X'["?" S %=0 D:$D(DRG(DRGT)) CHK G:%=1 DRG1A D DRG2 Q:$G(Y)>0&($G(P(4))'="H"&(DRGT="SOL"))  G DRG1
"RTN","PSIVEDRG",22,0)
 I $D(DRG(DRGT)) W !,"This order includes the following ",DRGTN,"S:",! F Y=0:0 S Y=$O(DRG(DRGT,Y)) Q:'Y  W !,$P(DRG(DRGT,Y),U,2)
"RTN","PSIVEDRG",23,0)
 W !,"YOU MAY ENTER A NEW ",DRGTN,", IF YOU WISH",! D GTSCRN(X) S DIC(0)="EQM" D ^DIC K DIC G DRG1
"RTN","PSIVEDRG",24,0)
 Q
"RTN","PSIVEDRG",25,0)
 ;
"RTN","PSIVEDRG",26,0)
SETDRG ; Put Drug data into DRG(x).
"RTN","PSIVEDRG",27,0)
 F X=1:1:6 S DRG(X)=$P(DRG(DRGT,DRGI),U,X)
"RTN","PSIVEDRG",28,0)
 S X="" I DRG(2)="",DRG(1) S DRG(2)="*** Undefined ***"
"RTN","PSIVEDRG",29,0)
 Q
"RTN","PSIVEDRG",30,0)
DRG2 ;
"RTN","PSIVEDRG",31,0)
 D GTSCRN(X) N PSIVX S PSIVX=X,DIC(0)="EQMZ" D ^DIC K DIC Q:Y<0
"RTN","PSIVEDRG",32,0)
 S PSJIVIEN=+Y
"RTN","PSIVEDRG",33,0)
 NEW PSJNF D NFIV^PSJDIN($S(DRGT="AD":52.6,1:52.7),+PSJIVIEN,.PSJNF)
"RTN","PSIVEDRG",34,0)
 W PSJNF("NF")
"RTN","PSIVEDRG",35,0)
 S PSIVNEW=1,DRGTMP=+Y_U_$P(Y(0),U)_U_$S(DRGT="SOL":$P(Y(0),U,3),1:"")_U_U_$P(Y(0),U,13)_U_$P(Y(0),U,11)
"RTN","PSIVEDRG",36,0)
 I '$D(ON55) NEW ON55 S ON55=ON
"RTN","PSIVEDRG",37,0)
 D ORDERCHK(DFN,ON55,1) I $G(PSGORQF) S X=U,DONE=1 Q
"RTN","PSIVEDRG",38,0)
 D DINIV^PSJDIN($S(DRGT="AD":52.6,1:52.7),+DRGTMP)
"RTN","PSIVEDRG",39,0)
 S (DRG(DRGT,0),DRGI)=$G(DRG(DRGT,0))+1,DRG(DRGT,DRGI)=DRGTMP K PSIVOLD
"RTN","PSIVEDRG",40,0)
 I (PSIVAC="PN"!(PSIVAC="CF")),(DRGT="AD"),$D(^PS(52.6,"C",PSIVX,+DRGTMP)) D ^PSIVQUI Q:$G(PSIVSTR)="QUICK CODE"!$G(PSGORQF)
"RTN","PSIVEDRG",41,0)
DRG3 ;
"RTN","PSIVEDRG",42,0)
 D:DRG(2)]"" DINIV^PSJDIN(FIL,+DRG(1))
"RTN","PSIVEDRG",43,0)
 D SETDRG
"RTN","PSIVEDRG",44,0)
 I DRGT="AD" S X=$P($G(^PS(FIL,+DRG(1),0)),U,3) W !!,"(The units of strength for this additive are in ",$$ENU^PSIVUTL(DRG(1)),")"
"RTN","PSIVEDRG",45,0)
AMT ;
"RTN","PSIVEDRG",46,0)
 I DRGT="SOL",'$G(PSIVOLD),($G(P(4))_$G(P(23))'["S") G DRG4
"RTN","PSIVEDRG",47,0)
1 ; Strength/Volume
"RTN","PSIVEDRG",48,0)
 W !,$S(DRGT="AD":"Strength: ",1:"Volume: ") W:+DRG(3) DRG(3),"//" R X:DTIME S:'$T X="^" Q:X="^"  G:X=""&DRG(3) 2 I X="" W $C(7),$S(DRGT="AD":"Strength",1:"Volume")," is REQUIRED!" G 1
"RTN","PSIVEDRG",49,0)
 D:$D(X) IT G:'$D(X)!($G(X)["?") AMT S DRG(3)=X I X="" D FIELD^DID($S(DRGT="AD":53.157,1:53.158),1,"","XECUTABLE HELP","PSJEX") X PSJEX("XECUTABLE HELP") K PSJEX G AMT
"RTN","PSIVEDRG",50,0)
2 I DRGT="AD",$G(P("DTYP"))>1,P(4)'="S",P(23)'="S" K DIR S DIR(0)="53.157,2" S:DRG(4)]"" DIR("B")=DRG(4) D ^DIR Q:$D(DTOUT)!$D(DUOUT)  S:Y DRG(4)=Y
"RTN","PSIVEDRG",51,0)
DRG4 ;
"RTN","PSIVEDRG",52,0)
 F X=1:1:6 S $P(DRG(DRGT,DRGI),U,X)=DRG(X)
"RTN","PSIVEDRG",53,0)
 S DRG(2)=""
"RTN","PSIVEDRG",54,0)
 Q
"RTN","PSIVEDRG",55,0)
 ;
"RTN","PSIVEDRG",56,0)
GTSCRN(PSIVX) ;Set DIC("S") if MD OE or matching drug has already been selected.
"RTN","PSIVEDRG",57,0)
 D:"?"[PSIVX HOLDHDR^PSJOE
"RTN","PSIVEDRG",58,0)
 S X=PSIVX
"RTN","PSIVEDRG",59,0)
 K DA,DIC S DIC=FIL,DIC("S")=$$IVDRGSC^PSIVUTL
"RTN","PSIVEDRG",60,0)
 I $E(PSIVAC)'="P",($P(P("OT"),U)="F") S X(1)=" I $P(X(1),U,13)",DIC("S")=$G(DIC("S"))_$S(DRGT="AD":X(1),$E(PSIVAC)="O":X(1),1:"")
"RTN","PSIVEDRG",61,0)
 Q
"RTN","PSIVEDRG",62,0)
 ;
"RTN","PSIVEDRG",63,0)
IT ; Input Transform for Strength/Volume.
"RTN","PSIVEDRG",64,0)
 I X?1.N,$L(X)>20 S X="?"
"RTN","PSIVEDRG",65,0)
 I X["?" W $C(7) S F1=53.15_$S(DRGT="AD":7,1:8),F2=1 D ENHLP^PSIVORC1 Q
"RTN","PSIVEDRG",66,0)
 I DRGT="AD" K:X'?.6N0.1".".8N!('X) X I $D(X) S:(X<1)&($P(X,".")'=0) X=0_X S X=X_" "_$$ENU^PSIVUTL(DRG(1)) W "   ",X Q
"RTN","PSIVEDRG",67,0)
 I $D(X) K:X=""!(X'?.N0.1".".N)!(X>9999)!(X<.01) X I $D(X) S:(X<1)&($P(X,".")'=0) X=0_X S X=X_" ML" W "   ",X
"RTN","PSIVEDRG",68,0)
 W:'$D(X) $C(7),"??"
"RTN","PSIVEDRG",69,0)
 Q
"RTN","PSIVEDRG",70,0)
 ;
"RTN","PSIVEDRG",71,0)
ORDERCHK(DFN,ON,X) ; Do order check
"RTN","PSIVEDRG",72,0)
 ;* If X is define, include the DRG(X) to the order check
"RTN","PSIVEDRG",73,0)
 I X M:$D(DRG) DRGOC(ON)=DRG
"RTN","PSIVEDRG",74,0)
 NEW TMPDRG,X,XX,Y,PSIVNEW,PSGDRG,PSGDRGN,PSJDD,PSGP
"RTN","PSIVEDRG",75,0)
 D SAVEDRG(.TMPDRG,.DRG) ;Store DRG array in TMPDRG array
"RTN","PSIVEDRG",76,0)
 S PSIVNEW=1,PSGDRGN=$P($G(DRGTMP),U,2)
"RTN","PSIVEDRG",77,0)
 S (PSJDD,PSGDRG)=$P(^PS(FIL,+DRGTMP,0),U,2),PSGP=DFN
"RTN","PSIVEDRG",78,0)
 I FIL="52.6"  D ENDDC^PSGSICHK(DFN,PSGDRG)
"RTN","PSIVEDRG",79,0)
 I FIL="52.7" D
"RTN","PSIVEDRG",80,0)
 . D EN^PSOORDRG(DFN,PSGDRG)
"RTN","PSIVEDRG",81,0)
 . N INTERVEN,PSJIREQ,PSJRXREQ S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSIVEDRG",82,0)
 . S DFN=PSGP K PSJPDRG
"RTN","PSIVEDRG",83,0)
 . D IVSOL^PSGSICHK
"RTN","PSIVEDRG",84,0)
 D SAVEDRG(.DRG,.TMPDRG) ;Restore DRG array from TMPDRG array
"RTN","PSIVEDRG",85,0)
 D ENSTOP^PSIVCAL
"RTN","PSIVEDRG",86,0)
 Q
"RTN","PSIVEDRG",87,0)
SAVEDRG(NEW,OLD)   ;Store/restore DRG array.
"RTN","PSIVEDRG",88,0)
 S:$G(OLD) NEW=OLD
"RTN","PSIVEDRG",89,0)
 F X=0:0 S X=$O(OLD(X)) Q:'X  S NEW(X)=OLD(X)
"RTN","PSIVEDRG",90,0)
 F XX="AD","SOL" D
"RTN","PSIVEDRG",91,0)
 . I $D(OLD(XX,0))#10=1 S NEW(XX,0)=OLD(XX,0)
"RTN","PSIVEDRG",92,0)
 . F X=0:0 S X=$O(OLD(XX,X)) Q:'X  S NEW(XX,X)=OLD(XX,X)
"RTN","PSIVEDRG",93,0)
 Q
"RTN","PSIVEDRG",94,0)
 ;
"RTN","PSIVEDRG",95,0)
CHK ; Check if drug is already part of order
"RTN","PSIVEDRG",96,0)
 N DDONE,I,TDRG,TDRGP F TDRG=0:0 S TDRG=$O(DRG(DRGT,TDRG)) Q:'TDRG!$G(DDONE)  D
"RTN","PSIVEDRG",97,0)
 .I $$UPPER^VALM1($E($P(DRG(DRGT,+TDRG),U,2),1,$L(X)))=$$UPPER^VALM1(X) W $P($$UPPER^VALM1($P(DRG(DRGT,+TDRG),U,2)),$$UPPER^VALM1(X),2) D ASKCHK Q
"RTN","PSIVEDRG",98,0)
 .S TDRGP=$P(DRG(DRGT,TDRG),U) F J=0:0 S J=$O(^PS(FIL,TDRGP,3,J)) Q:'J!$G(DDONE)  I $$UPPER^VALM1($E($P(^PS(FIL,TDRGP,3,J,0),U),1,$L(X)))=$$UPPER^VALM1(X) D  D ASKCHK Q
"RTN","PSIVEDRG",99,0)
 ..W $P($$UPPER^VALM1($P(^PS(FIL,TDRGP,3,J,0),U)),$$UPPER^VALM1(X),2)," ",$P(DRG(DRGT,TDRG),U,2)
"RTN","PSIVEDRG",100,0)
 Q
"RTN","PSIVEDRG",101,0)
 ;
"RTN","PSIVEDRG",102,0)
ASKCHK ; Do you want a drug that was previously selected.
"RTN","PSIVEDRG",103,0)
 S I=DRG(DRGT,TDRG) W " ",$P(I,U,3),$S($P(I,U,4):" ("_$P(I,U,4)_")",1:""),!,"...OK" S %=1 D YN^DICN
"RTN","PSIVEDRG",104,0)
 I %=1 S X="",DRGI=TDRG,(DDONE,PSIVOLD)=1 D SETDRG Q
"RTN","PSIVEDRG",105,0)
 W !,X
"RTN","PSIVEDRG",106,0)
 Q
"RTN","PSIVEDRG",107,0)
 ;
"RTN","PSIVEDRG",108,0)
DEL ;
"RTN","PSIVEDRG",109,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN S X="" I %'=1 W "  <NOTHING DELETED>"
"RTN","PSIVEDRG",110,0)
 Q
"RTN","PSIVEDRG",111,0)
GTADSOL ;If there're multiple ad/sol matched to an OI then display so user to select ad/sol
"RTN","PSIVEDRG",112,0)
 ;PSIVOI array is defined in GTIVDRG^PSIVORC2
"RTN","PSIVEDRG",113,0)
 NEW DIR,ND,X,Y
"RTN","PSIVEDRG",114,0)
 S DIR(0)="LA^1:"_+PSIVOI("DILIST",0)
"RTN","PSIVEDRG",115,0)
 S DIR("?")="Please select "_$S(PSIVOI="AD":"an Additive or Quick Code",1:"a Solution")_" from the list"
"RTN","PSIVEDRG",116,0)
 F X=0:0 S X=$O(PSIVOI("DILIST",X)) Q:'X  D
"RTN","PSIVEDRG",117,0)
 . S DIR("A",X)="  "_X_"  "_$S($P(PSIVOI("DILIST",X,0),U,4)="QC":"  - "_$P(PSIVOI("DILIST",X,0),U,2)_" -",1:$P(PSIVOI("DILIST",X,0),U,2))_$S(PSIVOI="SOL":"  "_$P(PSIVOI("DILIST",X,0),U,3),1:"")
"RTN","PSIVEDRG",118,0)
 S DIR("A")="Select (1 - "_+PSIVOI("DILIST",0)_"): "
"RTN","PSIVEDRG",119,0)
 D ^DIR
"RTN","PSIVEDRG",120,0)
 I +Y D
"RTN","PSIVEDRG",121,0)
 . NEW PSIVOIND S PSIVOIND=PSIVOI("DILIST",+Y,0)
"RTN","PSIVEDRG",122,0)
 . W "  "_$P(PSIVOIND,U,2)_$S(PSIVOI="SOL":"  "_$P(PSIVOIND,U,3),1:"")
"RTN","PSIVEDRG",123,0)
 . S ND=$G(^PS($S(PSIVOI="AD":52.6,1:52.7),+PSIVOIND,0))
"RTN","PSIVEDRG",124,0)
 . S DRG(PSIVOI,0)=1
"RTN","PSIVEDRG",125,0)
 . S DRG(PSIVOI,1)=+PSIVOIND_U_$P(ND,U)_U_$S(PSIVOI="SOL":$P(ND,U,3),1:"")_U_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVEDRG",126,0)
 . S DRGI=1 D SETDRG
"RTN","PSIVEDRG",127,0)
 . I $P(PSIVOI("DILIST",+Y,0),U,4)="QC",DRGT="AD",$D(^PS(52.6,"C",$P(PSIVOI("DILIST",+Y,0),U,2),+PSIVOI("DILIST",+Y,0))) D   Q:$G(PSIVSTR)="QUICK CODE"!$G(PSGORQF)
"RTN","PSIVEDRG",128,0)
 .. S (X,PSIVX)=$P(PSIVOI("DILIST",+Y,0),U,2),(PSJIVIEN,Y)=+PSIVOI("DILIST",+Y,0) D
"RTN","PSIVEDRG",129,0)
 ... N PSJNF D NFIV^PSJDIN(52.6,+PSJIVIEN,.PSJNF) W PSJNF("NF")
"RTN","PSIVEDRG",130,0)
 ... S DRGTMP=DRG(DRGT,1)
"RTN","PSIVEDRG",131,0)
 ... I '$D(ON55) N ON55 S ON55=ON
"RTN","PSIVEDRG",132,0)
 ... D ORDERCHK(DFN,ON55,1) I $G(PSGORQF) S X=U,DONE=1 Q
"RTN","PSIVEDRG",133,0)
 ... D DINIV^PSJDIN(52.6,+DRGTMP)
"RTN","PSIVEDRG",134,0)
 ... D ^PSIVQUI
"RTN","PSIVEDRG",135,0)
 . I $P(PSIVOI("DILIST",+Y,0),U,4)'="QC" S DRGTMP=DRG(DRGT,1) D ORDERCHK(DFN,ON55,1) I $G(PSGORQF) S X=U,DONE=1 Q
"RTN","PSIVEDRG",136,0)
 . I PSIVOI="AD" D
"RTN","PSIVEDRG",137,0)
 .. N FIL S FIL=52.6 D DRG3
"RTN","PSIVEDRG",138,0)
 K PSIVOI
"RTN","PSIVEDRG",139,0)
 Q
"VER")
8.0^22.0
"BLD",6212,6)
^SEQ #133
**END**
**END**
