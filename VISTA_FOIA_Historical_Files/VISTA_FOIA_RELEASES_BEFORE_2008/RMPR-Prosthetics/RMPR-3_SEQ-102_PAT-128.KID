Released RMPR*3*128 SEQ #102
Extracted from mail message
**KIDS**:RMPR*3.0*128^

**INSTALL NAME**
RMPR*3.0*128
"BLD",6032,0)
RMPR*3.0*128^PROSTHETICS^0^3060425^y
"BLD",6032,1,0)
^^6^6^3060425^^^
"BLD",6032,1,1,0)
1. UNDEF ITM+9^RMPR29 - variable rmtype NULL
"BLD",6032,1,2,0)
 
"BLD",6032,1,3,0)
2. Institution IEN appears instead of station number on PSAS HCPCS HISTORY
"BLD",6032,1,4,0)
   and Nightly PCE Background mail message
"BLD",6032,1,5,0)
 
"BLD",6032,1,6,0)
3. Inventory does not always update correctly with quantity issued 
"BLD",6032,4,0)
^9.64PA^^
"BLD",6032,6.3)
3
"BLD",6032,"ABPKG")
n
"BLD",6032,"KRN",0)
^9.67PA^8989.52^19
"BLD",6032,"KRN",.4,0)
.4
"BLD",6032,"KRN",.401,0)
.401
"BLD",6032,"KRN",.402,0)
.402
"BLD",6032,"KRN",.403,0)
.403
"BLD",6032,"KRN",.5,0)
.5
"BLD",6032,"KRN",.84,0)
.84
"BLD",6032,"KRN",3.6,0)
3.6
"BLD",6032,"KRN",3.8,0)
3.8
"BLD",6032,"KRN",9.2,0)
9.2
"BLD",6032,"KRN",9.8,0)
9.8
"BLD",6032,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",6032,"KRN",9.8,"NM",1,0)
RMPRPIYS^^0^84869709
"BLD",6032,"KRN",9.8,"NM",2,0)
RMPRPIYJ^^0^18984837
"BLD",6032,"KRN",9.8,"NM",3,0)
RMPRSE21^^0^29249805
"BLD",6032,"KRN",9.8,"NM",4,0)
RMPRPCEA^^0^52809233
"BLD",6032,"KRN",9.8,"NM",5,0)
RMPR29^^0^32625638
"BLD",6032,"KRN",9.8,"NM",6,0)
RMPRPIYI^^0^60374802
"BLD",6032,"KRN",9.8,"NM","B","RMPR29",5)

"BLD",6032,"KRN",9.8,"NM","B","RMPRPCEA",4)

"BLD",6032,"KRN",9.8,"NM","B","RMPRPIYI",6)

"BLD",6032,"KRN",9.8,"NM","B","RMPRPIYJ",2)

"BLD",6032,"KRN",9.8,"NM","B","RMPRPIYS",1)

"BLD",6032,"KRN",9.8,"NM","B","RMPRSE21",3)

"BLD",6032,"KRN",19,0)
19
"BLD",6032,"KRN",19.1,0)
19.1
"BLD",6032,"KRN",101,0)
101
"BLD",6032,"KRN",409.61,0)
409.61
"BLD",6032,"KRN",771,0)
771
"BLD",6032,"KRN",870,0)
870
"BLD",6032,"KRN",8989.51,0)
8989.51
"BLD",6032,"KRN",8989.52,0)
8989.52
"BLD",6032,"KRN",8994,0)
8994
"BLD",6032,"KRN","B",.4,.4)

"BLD",6032,"KRN","B",.401,.401)

"BLD",6032,"KRN","B",.402,.402)

"BLD",6032,"KRN","B",.403,.403)

"BLD",6032,"KRN","B",.5,.5)

"BLD",6032,"KRN","B",.84,.84)

"BLD",6032,"KRN","B",3.6,3.6)

"BLD",6032,"KRN","B",3.8,3.8)

"BLD",6032,"KRN","B",9.2,9.2)

"BLD",6032,"KRN","B",9.8,9.8)

"BLD",6032,"KRN","B",19,19)

"BLD",6032,"KRN","B",19.1,19.1)

"BLD",6032,"KRN","B",101,101)

"BLD",6032,"KRN","B",409.61,409.61)

"BLD",6032,"KRN","B",771,771)

"BLD",6032,"KRN","B",870,870)

"BLD",6032,"KRN","B",8989.51,8989.51)

"BLD",6032,"KRN","B",8989.52,8989.52)

"BLD",6032,"KRN","B",8994,8994)

"BLD",6032,"QUES",0)
^9.62^^
"BLD",6032,"REQB",0)
^9.611^3^3
"BLD",6032,"REQB",1,0)
RMPR*3.0*120^2
"BLD",6032,"REQB",2,0)
RMPR*3.0*90^2
"BLD",6032,"REQB",3,0)
RMPR*3.0*108^2
"BLD",6032,"REQB","B","RMPR*3.0*108",3)

"BLD",6032,"REQB","B","RMPR*3.0*120",1)

"BLD",6032,"REQB","B","RMPR*3.0*90",2)

"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
128^3060425
"PKG",101,22,1,"PAH",1,1,0)
^^6^6^3060425
"PKG",101,22,1,"PAH",1,1,1,0)
1. UNDEF ITM+9^RMPR29 - variable rmtype NULL
"PKG",101,22,1,"PAH",1,1,2,0)
 
"PKG",101,22,1,"PAH",1,1,3,0)
2. Institution IEN appears instead of station number on PSAS HCPCS HISTORY
"PKG",101,22,1,"PAH",1,1,4,0)
   and Nightly PCE Background mail message
"PKG",101,22,1,"PAH",1,1,5,0)
 
"PKG",101,22,1,"PAH",1,1,6,0)
3. Inventory does not always update correctly with quantity issued 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","RMPR29")
0^5^B32625638^B32511441
"RTN","RMPR29",1,0)
RMPR29 ;PHX/JLT-ENTER/EDIT 2529-3 [ 10/01/94  5:29 AM ]
"RTN","RMPR29",2,0)
 ;;3.0;PROSTHETICS;**12,41,62,128**;Feb 09, 1996
"RTN","RMPR29",3,0)
 ;RVD patch #62 - PCE and suspense link
"RTN","RMPR29",4,0)
CREATE ;CREATE 2529-3
"RTN","RMPR29",5,0)
 K RMPREDIT,RMPRTMP,RMPR25,^TMP($J,"RMPRPCE") D DIV4^RMPRSIT G:$D(X) EXIT1
"RTN","RMPR29",6,0)
 D GETPAT^RMPRUTIL I '$D(RMPRDFN) G EXIT1
"RTN","RMPR29",7,0)
VIEW ;CREATE 2529-3 VIA LAB MENU
"RTN","RMPR29",8,0)
 N RMPRDA,RMPRWO,RMPRJOB S RMPRF=4 D ^RMPRPAT I $D(RMPRKILL) G EXIT
"RTN","RMPR29",9,0)
 S DIC="^RMPR(664.1,",DIC(0)="ZL",X=DT
"RTN","RMPR29",10,0)
 S DLAYGO=664.1 D FILE^DICN K DLAYGO,DIC
"RTN","RMPR29",11,0)
 G:+Y'>0 EXIT1
"RTN","RMPR29",12,0)
 S RMPRDA=+Y,$P(^RMPR(664.1,RMPRDA,0),U,2)=RMPRDFN,$P(^(0),U,3)=RMPR("STA"),$P(^(0),U,17)="I"
"RTN","RMPR29",13,0)
 S IDEF=$$STA^RMPR31U(RMPR("STA"))
"RTN","RMPR29",14,0)
 S DA=RMPRDA,DIK="^RMPR(664.1," D IX1^DIK
"RTN","RMPR29",15,0)
 K DR,DA,DIC,Y,DIE D KVAR^VADPT
"RTN","RMPR29",16,0)
 S DFN=$P(^RMPR(664.1,RMPRDA,0),U,2),VAIP("D")="L"
"RTN","RMPR29",17,0)
 D IN5^VADPT S VAINDT=$P($G(VAIP(3)),U) D INP^VADPT
"RTN","RMPR29",18,0)
 I VAIN(1) S DR=".11R;.04R//^S X=$G(IDEF);2R;12//^S X=$P(VAIN(4),U,2);12.1//^S X=$P(VAIN(2),U,2);12.2//^S X=VAIN(9);12.3//^S X=$P(VAIN(3),U,2);12.4;.09R"
"RTN","RMPR29",19,0)
 I 'VAIN(1) S DR=".11R;.04R//^S X=$G(IDEF);2R;.09R"
"RTN","RMPR29",20,0)
EDT ;EDIT/DELETE 2529-3
"RTN","RMPR29",21,0)
 I $G(RMPRDA)>0,$G(RMPRDA)'="" G ST
"RTN","RMPR29",22,0)
 K DR,DIC D DIV4^RMPRSIT G:$D(X) EXIT1
"RTN","RMPR29",23,0)
 S RMPREDIT=1
"RTN","RMPR29",24,0)
 S DIC="^RMPR(664.1,",DIC(0)="AEQM",DR=".01"
"RTN","RMPR29",25,0)
 ;screen on complete, delete status
"RTN","RMPR29",26,0)
 S DIC("S")="I $P(^(0),U,17)'=""D""&($P(^(0),U,17)'=""C"")"
"RTN","RMPR29",27,0)
 S DIC("W")="D EN3^RMPRD1"
"RTN","RMPR29",28,0)
 D ^DIC K DIC
"RTN","RMPR29",29,0)
 G:+Y'>0 EXIT1 S RMPRDA=+Y
"RTN","RMPR29",30,0)
 I $G(RMPRDA)'>0 Q
"RTN","RMPR29",31,0)
 L +^RMPR(664.1,RMPRDA,0):1
"RTN","RMPR29",32,0)
 I '$T W $C(7),!!,?5,"Someone is already editing this entry" G EXIT
"RTN","RMPR29",33,0)
 D DSP^RMPR29R K DIR
"RTN","RMPR29",34,0)
 S DIR(0)="Y",DIR("A")="Would you like to Edit this Entry"
"RTN","RMPR29",35,0)
 S DIR("B")="YES" D ^DIR
"RTN","RMPR29",36,0)
 G:$D(DTOUT)!($D(DIRUT)) EXIT K DKILL,IKILL G:+Y=0 DEL
"RTN","RMPR29",37,0)
ST ;set data in 2529-3 file
"RTN","RMPR29",38,0)
 S RMPRDFN=$P(^RMPR(664.1,RMPRDA,0),U,2),DA=RMPRDA,DIE="^RMPR(664.1,"
"RTN","RMPR29",39,0)
 I '$D(DR),'$D(^RMPR(664.1,RMPRDA,"CDR")) S DR=".11R;.04;2R;.09R"
"RTN","RMPR29",40,0)
 I '$D(DR),$D(^RMPR(664.1,RMPRDA,"CDR")) S DR=".11R;.04R;2R;12;12.1;12.2;12.3;12.4;.09R"
"RTN","RMPR29",41,0)
 D ^DIE G:$D(Y)!($D(DTOUT)) CHK^RMPR29D
"RTN","RMPR29",42,0)
GD ;Display work order
"RTN","RMPR29",43,0)
 D DIS^RMPR29W(RMPRDFN,RMPRDA) G:$G(X)="^" CHK^RMPR29D G:+Y'>0 ITM
"RTN","RMPR29",44,0)
 K DR,DA,DIC,DIE
"RTN","RMPR29",45,0)
 S DIC="^RMPR(664.1,"_RMPRDA_",1,"
"RTN","RMPR29",46,0)
 S DIC("P")="664.15PA",DA(1)=RMPRDA
"RTN","RMPR29",47,0)
 S DIC(0)="EQMZL",X=Y(0,0),ELG=$P(Y(0),U,3)
"RTN","RMPR29",48,0)
 D ^DIC
"RTN","RMPR29",49,0)
 I +Y'>0 K DIC G GD
"RTN","RMPR29",50,0)
 S DIE=DIC K DIC
"RTN","RMPR29",51,0)
 S DA(1)=RMPRDA,DA=+Y
"RTN","RMPR29",52,0)
 S DR="1///^S X=ELG;.01;1"
"RTN","RMPR29",53,0)
 D ^DIE G:$D(DTOUT)!($D(Y)) CHK^RMPR29D G GD
"RTN","RMPR29",54,0)
ITM ;EDIT 2529-3 ITEM
"RTN","RMPR29",55,0)
 K DIR S DA=RMPRDA,DIC="^RMPR(664.1,"_RMPRDA_",2,"
"RTN","RMPR29",56,0)
 S DIC("P")="664.16PA",DA(1)=RMPRDA,DIC(0)="AEQMZL"
"RTN","RMPR29",57,0)
 S DIC("W")="S RA=$P(^(0),U,1) I +RA W ?16,$$ITM^RMPR31U(RA)"
"RTN","RMPR29",58,0)
 D ^DIC K DIC G:+Y'>0 CHK^RMPR29D
"RTN","RMPR29",59,0)
 S RY=$P(Y,U,2) D ITA^RMPR29U(RY)
"RTN","RMPR29",60,0)
 S DA=+Y,DIE="^RMPR(664.1,"_RMPRDA_",2,"
"RTN","RMPR29",61,0)
 S DR="8R;9R;13;7;2R;3R;12"
"RTN","RMPR29",62,0)
 D ^DIE G:$D(DTOUT) CHK^RMPR29D
"RTN","RMPR29",63,0)
 S RMTYPE=$P(^RMPR(664.1,RMPRDA,2,DA,0),U,7)
"RTN","RMPR29",64,0)
 I $D(DA) S RDATA=RMTYPE_"^"_RMPRDA_"^"_DA D CHKCPT^RMPR29U(RDATA)
"RTN","RMPR29",65,0)
 I $D(DA) S RY=$P(^RMPR(664.1,DA(1),2,DA,0),U),HCPCS=$P($G(^(2)),U,1),RMCPT=$P($G(^(2)),U,2) D ITA^RMPR29U(RY)
"RTN","RMPR29",66,0)
 K RMTYPE,RDATA,RMCPT
"RTN","RMPR29",67,0)
D G ITM
"RTN","RMPR29",68,0)
LAB ;ASK TO POST REQUEST
"RTN","RMPR29",69,0)
 S DIR(0)="Y",DIR("A")="Would you like to review this request"
"RTN","RMPR29",70,0)
 S DIR("B")="YES" D ^DIR G:$D(DTOUT)!($D(DIRUT)) EXIT
"RTN","RMPR29",71,0)
 I Y=1 S IOP="HOME" D PRT^RMPR29R
"RTN","RMPR29",72,0)
 K DIR S DIR(0)="Y",DIR("A")="Would you like to post this request"
"RTN","RMPR29",73,0)
 S DIR("B")="YES" D ^DIR G:$D(DTOUT)!($D(DIRUT)) EXIT
"RTN","RMPR29",74,0)
 I +Y=0 W !!,?5,$C(7),"Request not posted!!" G:$D(RMPR25) RDL G EXIT
"RTN","RMPR29",75,0)
 ;set temp transaction flag if needed
"RTN","RMPR29",76,0)
 K RMPRTMP I $P(^RMPR(664.1,RMPRDA,0),U,15)'=RMPR("STA") S RMPRTMP=1
"RTN","RMPR29",77,0)
 S RMPRWO=$P(^RMPR(664.1,RMPRDA,0),U,13) G:RMPRWO'="" SG S SCR=$P(^(0),U,11)
"RTN","RMPR29",78,0)
 D CR^RMPR29U(SCR)
"RTN","RMPR29",79,0)
 I '$D(RMPRWO) W !!,?5,$C(7),"Request not posted!!" G EXIT
"RTN","RMPR29",80,0)
SG ;set 2529-3 global
"RTN","RMPR29",81,0)
 S $P(^RMPR(664.1,RMPRDA,0),U,13)=$G(RMPRWO)
"RTN","RMPR29",82,0)
 ;set no admin count/no lab count
"RTN","RMPR29",83,0)
 I $P(^RMPR(664.1,RMPRDA,0),U,15)=RMPR("STA")&($P(^(0),U,4)'=RMPR("STA")) S $P(^(0),U,23)=1
"RTN","RMPR29",84,0)
 I $P(^RMPR(664.1,RMPRDA,0),U,15)'=RMPR("STA") S $P(^(0),U,20)=1 S:$D(RMPR25) $P(^RMPR(664.1,RMPRDA,0),U,23)=1 S DIE="^RMPR(664.1,",DA=RMPRDA,DR="16///^S X=""PC""" D ^DIE
"RTN","RMPR29",85,0)
 I '$P(^RMPR(664.1,RMPRDA,0),U,20) S DIE="^RMPR(664.1,",DA=RMPRDA,DR="16///^S X=""P""" D ^DIE
"RTN","RMPR29",86,0)
 S $P(^RMPR(664.1,RMPRDA,0),U,5)=DUZ,$P(^(0),U,18)=DT D ^RMPR29A
"RTN","RMPR29",87,0)
 I $G(RMPRWO)'="" W !!,?5,"Assigned Work Order Number: ",RMPRWO D:'$D(RMPRTMP) LOC^RMPR29R
"RTN","RMPR29",88,0)
 ;added by #62
"RTN","RMPR29",89,0)
 I $G(DA660),'$D(^RMPR(660,DA660,10)) D
"RTN","RMPR29",90,0)
 .S (RMPCAMIS,RMPRDFN)=""
"RTN","RMPR29",91,0)
 .S RMPCAMIS=$G(^RMPR(660,DA660,"AMS"))
"RTN","RMPR29",92,0)
 .S:$D(^RMPR(660,DA660,0)) RMPRDFN=$P(^RMPR(660,DA660,0),U,2)
"RTN","RMPR29",93,0)
 .I RMPCAMIS,RMPRDFN S ^TMP($J,"RMPRPCE",660,DA660)=RMPCAMIS_"^"_RMPRDFN
"RTN","RMPR29",94,0)
 ;suspense record inquiry
"RTN","RMPR29",95,0)
 D LINK^RMPRS
"RTN","RMPR29",96,0)
 W !! S DIR(0)="Y",DIR("A")="Would you like to print this 2529-3  request"
"RTN","RMPR29",97,0)
 S DIR("B")="YES" D ^DIR G:$D(DTOUT)!($D(DIRUT)) EXIT
"RTN","RMPR29",98,0)
 I Y=1 D PRT^RMPR29R
"RTN","RMPR29",99,0)
 ;
"RTN","RMPR29",100,0)
EXIT ;common exit point for both RMPR29 and RMPR29A
"RTN","RMPR29",101,0)
 ;
"RTN","RMPR29",102,0)
 L:+$G(RMPRDA) -^RMPR(664.1,+RMPRDA,0)
"RTN","RMPR29",103,0)
 S:$D(RMPR25)&($D(RMPRDA)) RMPRRDA=RMPRDA
"RTN","RMPR29",104,0)
 I '$D(RMPR25)&('$D(RMPREDIT)) W !! S DIR(0)="Y",DIR("A")="Would you like to Process another 2529-3 Request",DIR("B")="YES" D ^DIR G:+Y=1 CREATE
"RTN","RMPR29",105,0)
 D KVAR^VADPT
"RTN","RMPR29",106,0)
 K ^TMP($J,"RMPRPCE")
"RTN","RMPR29",107,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPR29",108,0)
 Q
"RTN","RMPR29",109,0)
EXIT1 ;exit on error
"RTN","RMPR29",110,0)
 L:+$G(RMPRDA) -^RMPR(664.1,+RMPRDA,0)
"RTN","RMPR29",111,0)
 N RMPR,RMPRSITE D KVAR^VADPT,KILL^XUSCLEAN Q
"RTN","RMPR29",112,0)
DEL ;delete status 2529-3
"RTN","RMPR29",113,0)
 K DIR,Y
"RTN","RMPR29",114,0)
 S DIR(0)="Y",DIR("A")="Would you like to Delete this 2529-3 Entry"
"RTN","RMPR29",115,0)
 S DIR("B")="NO" D ^DIR G:$D(DTOUT)!($D(DIRUT)) EXIT1
"RTN","RMPR29",116,0)
 ;if not drop into edit mode
"RTN","RMPR29",117,0)
 I +Y=0 G:$D(DKILL) GD G:$D(IKILL) ITM G CHK^RMPR29D
"RTN","RMPR29",118,0)
 ;if it has a work order number, only mark as deleted
"RTN","RMPR29",119,0)
 ;delete entry in the 2319 record.
"RTN","RMPR29",120,0)
 N BO
"RTN","RMPR29",121,0)
 S BO=0
"RTN","RMPR29",122,0)
 F  S BO=$O(^RMPR(664.1,RMPRDA,2,BO)) Q:BO'>0  D
"RTN","RMPR29",123,0)
 .S DA=$P(^RMPR(664.1,RMPRDA,2,BO,0),U,5)
"RTN","RMPR29",124,0)
 .Q:DA=""
"RTN","RMPR29",125,0)
 .S DIK="^RMPR(660," D ^DIK
"RTN","RMPR29",126,0)
 W !,?5,"Updated 10-2319"
"RTN","RMPR29",127,0)
 K DA,DIK
"RTN","RMPR29",128,0)
 I $P(^RMPR(664.1,RMPRDA,0),U,13)'="" S DIE="^RMPR(664.1,",DA=RMPRDA,DR="16///^S X=""D""" D ^DIE W !,?5,$C(7),"Marked As Deleted..." G EXIT
"RTN","RMPR29",129,0)
RDL ;delete record
"RTN","RMPR29",130,0)
 ;the record is only deleted from 664.1 when the user creats a new
"RTN","RMPR29",131,0)
 ;and then at end say's no do not post.  Once it is posted, then
"RTN","RMPR29",132,0)
 ;it must only be marked as deleted.
"RTN","RMPR29",133,0)
 S DA=RMPRDA,DIK="^RMPR(664.1,"
"RTN","RMPR29",134,0)
 D ^DIK K DIK W !!,?5,$C(7),"Deleted..."
"RTN","RMPR29",135,0)
 ;delete the 2319 record
"RTN","RMPR29",136,0)
 N BO
"RTN","RMPR29",137,0)
 S DA=0,BO=0
"RTN","RMPR29",138,0)
 F  S BO=$O(^RMPR(664.1,RMPRDA,2,BO)) Q:BO'>0  D
"RTN","RMPR29",139,0)
 .S DA=$P(^RMPR(664.1,RMPRDA,2,BO,0),U,5)
"RTN","RMPR29",140,0)
 .Q:DA=""
"RTN","RMPR29",141,0)
 .S DIK="^RMPR(660," D ^DIK
"RTN","RMPR29",142,0)
 K DIK,DA,RMPRDA
"RTN","RMPR29",143,0)
 W !!,?5,"Updated 10-2319",!
"RTN","RMPR29",144,0)
 G EXIT
"RTN","RMPRPCEA")
0^4^B52809233^B52102527
"RTN","RMPRPCEA",1,0)
RMPRPCEA ;HCIOFO/RVD - Prosthetics/PCE Interface; 05/31/01
"RTN","RMPRPCEA",2,0)
 ;;3.0;PROSTHETICS;**62,82,78,114,120,128**;Feb 09, 1996
"RTN","RMPRPCEA",3,0)
 ;
"RTN","RMPRPCEA",4,0)
 ; RMS  10/1/03 Patch 78 - Change Service connected, and environmental
"RTN","RMPRPCEA",5,0)
 ;                         indicators (Agent Orange, Ionizing Radiation,
"RTN","RMPRPCEA",6,0)
 ;                         Environmental Contaminants, Military Sexual
"RTN","RMPRPCEA",7,0)
 ;                         Trauma, Head/Neck Cancer, and Combat Veteran
"RTN","RMPRPCEA",8,0)
 ;                         Status) to come from new BA fields if they
"RTN","RMPRPCEA",9,0)
 ;                         exist.
"RTN","RMPRPCEA",10,0)
 ;
"RTN","RMPRPCEA",11,0)
 ;This routine contains the code for sending a Prosthetic visit to PCE.
"RTN","RMPRPCEA",12,0)
 ;
"RTN","RMPRPCEA",13,0)
 ;DBIA #1889-A  - this API is used to add, edit and delete the
"RTN","RMPRPCEA",14,0)
 ;                of encounter, provider, diagnosis and procedure
"RTN","RMPRPCEA",15,0)
 ;                data to VISIT and V files in the PCE module.
"RTN","RMPRPCEA",16,0)
 ; 04/23/2004 KAM RMPR*3*82 Make Background Message more Robust
"RTN","RMPRPCEA",17,0)
 ;
"RTN","RMPRPCEA",18,0)
 ;RMIE60 - ien in file #660
"RTN","RMPRPCEA",19,0)
SENDPCE(RMIE60) ; send a Prosthetic Visit to PCE.
"RTN","RMPRPCEA",20,0)
 ; D NEWVAR subroutine removed for functionality  01/31/05  WLC
"RTN","RMPRPCEA",21,0)
 ;
"RTN","RMPRPCEA",22,0)
 N RMPCE,RME2,RMSENT,RMLOCK,RMERR,RMPKG,RMSRC,RMDIAG,RMQTY
"RTN","RMPRPCEA",23,0)
 N RMSCAT,RMPROC,RMUPD,RMIEPCE,RMHLOC,RMLOC,RMPAT,RMDATE,RMINST
"RTN","RMPRPCEA",24,0)
 N RMETYP,RMCDAT,RMPCAT,RMDANOW,DIE,DA,DIC,RMAO,RMEC,RMIR,DFN,RMSCON
"RTN","RMPRPCEA",25,0)
 N RMMST,RMHNC,RMCBV,RMPRTPCE
"RTN","RMPRPCEA",26,0)
 ; PATCH 78, RMS - 10/1/2003, Billing aware related variables
"RTN","RMPRPCEA",27,0)
 N RMBASCON,RMBAAO,RMBAIR,RMBAEC,RMBAMST,RMBAHNC,RMBACBV,RMBAICD9,RMLOOP
"RTN","RMPRPCEA",28,0)
 N RMPROV,RMCPDT,DXERR,SICD
"RTN","RMPRPCEA",29,0)
 ;
"RTN","RMPRPCEA",30,0)
 S RMERR=1
"RTN","RMPRPCEA",31,0)
 S RMSRC="PROSTHETICS DATA"
"RTN","RMPRPCEA",32,0)
 S RMPKG=$O(^DIC(9.4,"B","PROSTHETICS",0))
"RTN","RMPRPCEA",33,0)
 I '$G(RMPKG) S RMERR=-2 G SENDPCEX
"RTN","RMPRPCEA",34,0)
 S RMSTA=$P(^RMPR(660,RMIE60,0),U,10)
"RTN","RMPRPCEA",35,0)
 S (RMLOC,RERRMSG,RERRMSG2)=""
"RTN","RMPRPCEA",36,0)
 F I=0:0 S I=$O(^RMPR(669.9,"C",RMSTA,I)) Q:I'>0  D
"RTN","RMPRPCEA",37,0)
 .I ($D(^RMPR(669.9,I,0))),($D(^RMPR(669.9,I,"PCE"))) S RMLOC=$P(^RMPR(669.9,I,"PCE"),U,3)
"RTN","RMPRPCEA",38,0)
 ;exit if Hospital Location (clinic) not defined.
"RTN","RMPRPCEA",39,0)
 I '$G(RMLOC) D  G SENDPCEX
"RTN","RMPRPCEA",40,0)
 .S RMERR=-2
"RTN","RMPRPCEA",41,0)
 .;RMPR*3*82 04/23/2004 KAM Added next 8 lines
"RTN","RMPRPCEA",42,0)
 .N SPACES,VNAME,ENDAT
"RTN","RMPRPCEA",43,0)
 .S VNAME=$$GET1^DIQ(2,$P(^RMPR(660,RMIE60,0),U,2),.01)
"RTN","RMPRPCEA",44,0)
 .S ENDAT=$$GET1^DIQ(660,RMIE60,.01),SPACES=""
"RTN","RMPRPCEA",45,0)
 .I $G(ENDAT)="" S ENDAT=" No Entry Data Found"
"RTN","RMPRPCEA",46,0)
 .F I=1:1:42-($L(VNAME)+$L(ENDAT)) S SPACES=$G(SPACES)_" "
"RTN","RMPRPCEA",47,0)
 .S RERRMSG="              *** NAME = "_VNAME_"   ENTRY DATE = "_ENDAT_SPACES
"RTN","RMPRPCEA",48,0)
 .I $G(RMSTA),$D(^DIC(4,RMSTA,99)) S RMSTAW=$P(^DIC(4,RMSTA,99),U)
"RTN","RMPRPCEA",49,0)
 .S RERRMSG=RERRMSG_"              *** Clinic is not defined....Please ask your ADPAC to enter a prosthetics      *** clinic in the Prosthetics Site Parameters file for station # = "_$G(RMSTAW)
"RTN","RMPRPCEA",50,0)
 .S RERRMSG2="         *** Using option 'Enter/Edit Station Site Parameters'"
"RTN","RMPRPCEA",51,0)
 .W !,"*** Clinic is not defined....."
"RTN","RMPRPCEA",52,0)
 .W !,"*** Please ask your ADPAC to enter a prosthetics clinic in the"
"RTN","RMPRPCEA",53,0)
 .W !,"*** Prosthetics Site Parameters file for station # = ",RMSTAW
"RTN","RMPRPCEA",54,0)
 .W !,"*** Using option 'Enter/Edit Station Site Parameters'"
"RTN","RMPRPCEA",55,0)
 S RMSENT=0,RMLOCK=0
"RTN","RMPRPCEA",56,0)
 ; initialize temp file.
"RTN","RMPRPCEA",57,0)
 K ^TMP("RMPRPCE1",$J),RMSTAW
"RTN","RMPRPCEA",58,0)
 ;
"RTN","RMPRPCEA",59,0)
 ; get the visit data (#660) and place in temp file.
"RTN","RMPRPCEA",60,0)
 D GETDATA G:$G(DXERR) SENDPCEX   ;quit if inactive diagnosis RMPR*120
"RTN","RMPRPCEA",61,0)
 ;don't create a PCE encounter if Date of Death is before the transaction
"RTN","RMPRPCEA",62,0)
 I $D(VADM(6)),$P(VADM(6),U,1),$P(VADM(6),U,1)<(RMDATE) G SENDPCEX
"RTN","RMPRPCEA",63,0)
 ;
"RTN","RMPRPCEA",64,0)
 ; build the temp file for sending to PCE
"RTN","RMPRPCEA",65,0)
 D BUILD
"RTN","RMPRPCEA",66,0)
 ;
"RTN","RMPRPCEA",67,0)
 ; now send
"RTN","RMPRPCEA",68,0)
 D SENDIT
"RTN","RMPRPCEA",69,0)
 ;
"RTN","RMPRPCEA",70,0)
SENDPCEX ; exit point
"RTN","RMPRPCEA",71,0)
 ;
"RTN","RMPRPCEA",72,0)
 ; clear the temp file
"RTN","RMPRPCEA",73,0)
 K ^TMP("RMPRPCE1",$J)
"RTN","RMPRPCEA",74,0)
 ;
"RTN","RMPRPCEA",75,0)
 ; return
"RTN","RMPRPCEA",76,0)
 Q RMERR
"RTN","RMPRPCEA",77,0)
 ;
"RTN","RMPRPCEA",78,0)
GETDATA ; get the visit data and place in temp file
"RTN","RMPRPCEA",79,0)
 K RMDA,RMDA2
"RTN","RMPRPCEA",80,0)
 S RMDA=$NA(^TMP("RMPRPCE1",$J,"RM"))
"RTN","RMPRPCEA",81,0)
 D GETS^DIQ(660,RMIE60_",","*","I",RMDA,"")
"RTN","RMPRPCEA",82,0)
 S RMDA2=$NA(^TMP("RMPRPCE1",$J,"RM",660,RMIE60_","))
"RTN","RMPRPCEA",83,0)
 D NOW^%DTC
"RTN","RMPRPCEA",84,0)
 S RMDANOW=%
"RTN","RMPRPCEA",85,0)
 S RMDATE=@RMDA2@(.01,"I"),RMDATE=RMDATE_"."_$P(%,".",2)
"RTN","RMPRPCEA",86,0)
 S (DFN,RMPAT)=@RMDA2@(.02,"I")
"RTN","RMPRPCEA",87,0)
 S RMHLOC=RMLOC
"RTN","RMPRPCEA",88,0)
 S RMINST=@RMDA2@(8.11,"I")
"RTN","RMPRPCEA",89,0)
 S RMPCAT=@RMDA2@(62,"I")
"RTN","RMPRPCEA",90,0)
 S RMSCON=0
"RTN","RMPRPCEA",91,0)
 I (RMPCAT=1)!(RMPCAT=2) S RMSCON=1
"RTN","RMPRPCEA",92,0)
 ;==============================
"RTN","RMPRPCEA",93,0)
 S RMSCAT="A"
"RTN","RMPRPCEA",94,0)
 S RMETYP="P"
"RTN","RMPRPCEA",95,0)
 S RMUSER=@RMDA2@(27,"I")
"RTN","RMPRPCEA",96,0)
 S RMDIAG=@RMDA2@(8.8,"I")
"RTN","RMPRPCEA",97,0)
 S RMPROC=@RMDA2@(4.1,"I")
"RTN","RMPRPCEA",98,0)
 S RMPROV=@RMDA2@(8.6,"I")
"RTN","RMPRPCEA",99,0)
 S RMCPDT=@RMDA2@(8.4,"I")
"RTN","RMPRPCEA",100,0)
 S RMQTY=@RMDA2@(5,"I")
"RTN","RMPRPCEA",101,0)
 S RMCDAT=@RMDA2@(10,"I")
"RTN","RMPRPCEA",102,0)
 S (RMPCE,RMIEPCE)=@RMDA2@(8.12,"I")
"RTN","RMPRPCEA",103,0)
 ; PATCH 78, RMS - 10/1/2003, billing aware related variables
"RTN","RMPRPCEA",104,0)
 K RMBAICD9,RMBAAO,RMBASCON,RMBAAIR,RMBAEC,RMBAMST,RMBAHNC,RMBACBV
"RTN","RMPRPCEA",105,0)
 I '$D(^RMPR(660,RMIE60,"BA1")) G GTDT  ; no BA data, skip retrieval
"RTN","RMPRPCEA",106,0)
 F RMLOOP=30:1:33 D
"RTN","RMPRPCEA",107,0)
 . N RMBAREC S RMBAREC=RMLOOP-29
"RTN","RMPRPCEA",108,0)
 . S RMBAICD9(RMBAREC)=@RMDA2@(RMLOOP,"I"),SICD=RMBAICD9(RMBAREC) I SICD'="" S:$P($G(^ICD9(SICD,0)),U,9) DXERR=1
"RTN","RMPRPCEA",109,0)
 . S RMBAAO(RMBAREC)=@RMDA2@((RMLOOP+.1),"I")
"RTN","RMPRPCEA",110,0)
 . S RMBAIR(RMBAREC)=@RMDA2@((RMLOOP+.2),"I")
"RTN","RMPRPCEA",111,0)
 . S RMBASCON(RMBAREC)=@RMDA2@((RMLOOP+.3),"I")
"RTN","RMPRPCEA",112,0)
 . S RMBAEC(RMBAREC)=@RMDA2@((RMLOOP+.4),"I")
"RTN","RMPRPCEA",113,0)
 . S RMBAMST(RMBAREC)=@RMDA2@((RMLOOP+.5),"I")
"RTN","RMPRPCEA",114,0)
 . S RMBAHNC(RMBAREC)=@RMDA2@((RMLOOP+.6),"I")
"RTN","RMPRPCEA",115,0)
 . S RMBACBV(RMBAREC)=@RMDA2@((RMLOOP+.7),"I")
"RTN","RMPRPCEA",116,0)
 ; Retrieve order number
"RTN","RMPRPCEA",117,0)
GTDT S RMPTR123=@RMDA2@(8.9,"I")
"RTN","RMPRPCEA",118,0)
 S RMODENT=$$GET1^DIQ(123,RMPTR123_",",.03)
"RTN","RMPRPCEA",119,0)
 ;get Date of Death.
"RTN","RMPRPCEA",120,0)
 D DEM^VADPT
"RTN","RMPRPCEA",121,0)
 ;get Agent Orange and Radiation.
"RTN","RMPRPCEA",122,0)
 D SVC^VADPT S RMAO=VASV(2),RMIR=VASV(3)
"RTN","RMPRPCEA",123,0)
 ;get environmental contaminants.
"RTN","RMPRPCEA",124,0)
 S RMEC=$$GET1^DIQ(2,DFN,.322013,"I") I RMEC="Y" S RMEC=1
"RTN","RMPRPCEA",125,0)
 S:RMEC'=1 RMEC=0
"RTN","RMPRPCEA",126,0)
 ;
"RTN","RMPRPCEA",127,0)
 S RMMST="",RMCBV="",RMHNC=""
"RTN","RMPRPCEA",128,0)
 Q
"RTN","RMPRPCEA",129,0)
 ;
"RTN","RMPRPCEA",130,0)
BUILD ; now build array for passing data to PCE
"RTN","RMPRPCEA",131,0)
 K ^TMP("RMPRPCE1",$J,"PXAPI"),RMAPI
"RTN","RMPRPCEA",132,0)
 S RMAPI=$NA(^TMP("RMPRPCE1",$J,"PXAPI"))
"RTN","RMPRPCEA",133,0)
 ; ---------encounter date/time----------------
"RTN","RMPRPCEA",134,0)
 S @RMAPI@("ENCOUNTER",1,"ENC D/T")=RMDATE
"RTN","RMPRPCEA",135,0)
 ; --------------patient-----------------------
"RTN","RMPRPCEA",136,0)
 S @RMAPI@("ENCOUNTER",1,"PATIENT")=RMPAT
"RTN","RMPRPCEA",137,0)
 ; ---------------clinic-----------------------
"RTN","RMPRPCEA",138,0)
 S @RMAPI@("ENCOUNTER",1,"HOS LOC")=RMHLOC
"RTN","RMPRPCEA",139,0)
 ; -------------checkout date/time-------------
"RTN","RMPRPCEA",140,0)
 S @RMAPI@("ENCOUNTER",1,"CHECKOUT D/T")=RMDATE
"RTN","RMPRPCEA",141,0)
 ; ------------agent orange--------------------
"RTN","RMPRPCEA",142,0)
 S @RMAPI@("ENCOUNTER",1,"AO")=RMAO
"RTN","RMPRPCEA",143,0)
 ;--------------ionizing radiation-------------
"RTN","RMPRPCEA",144,0)
 S @RMAPI@("ENCOUNTER",1,"IR")=RMIR
"RTN","RMPRPCEA",145,0)
 ;-----------environmental contaminants--------
"RTN","RMPRPCEA",146,0)
 S @RMAPI@("ENCOUNTER",1,"EC")=RMEC
"RTN","RMPRPCEA",147,0)
 ; --------------service connected--------------
"RTN","RMPRPCEA",148,0)
 S @RMAPI@("ENCOUNTER",1,"SC")=RMSCON
"RTN","RMPRPCEA",149,0)
 ; ------------Military Sexual Trauma----------
"RTN","RMPRPCEA",150,0)
 S @RMAPI@("ENCOUNTER",1,"MST")=RMMST
"RTN","RMPRPCEA",151,0)
 ; -------------Head/Neck Cancer---------------
"RTN","RMPRPCEA",152,0)
 S @RMAPI@("ENCOUNTER",1,"HNC")=RMHNC
"RTN","RMPRPCEA",153,0)
 ; --------------Combat Veteran---------
"RTN","RMPRPCEA",154,0)
 S @RMAPI@("ENCOUNTER",1,"CV")=RMCBV
"RTN","RMPRPCEA",155,0)
 ; --------------service category--------------
"RTN","RMPRPCEA",156,0)
 S @RMAPI@("ENCOUNTER",1,"SERVICE CATEGORY")=RMSCAT
"RTN","RMPRPCEA",157,0)
 ; ---------------encounter type---------------
"RTN","RMPRPCEA",158,0)
 S @RMAPI@("ENCOUNTER",1,"ENCOUNTER TYPE")=RMETYP
"RTN","RMPRPCEA",159,0)
 ; ------------primary provider----------------
"RTN","RMPRPCEA",160,0)
 S @RMAPI@("PROVIDER",1,"NAME")=RMUSER
"RTN","RMPRPCEA",161,0)
 ; ----------------diagnosis------------------
"RTN","RMPRPCEA",162,0)
 S @RMAPI@("DX/PL",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",163,0)
 S @RMAPI@("DX/PL",1,"PRIMARY")=1
"RTN","RMPRPCEA",164,0)
 ; -------------- procedures -----------------
"RTN","RMPRPCEA",165,0)
 S @RMAPI@("PROCEDURE",1,"PROCEDURE")=RMPROC
"RTN","RMPRPCEA",166,0)
 ; ---------------- Quantity -----------------
"RTN","RMPRPCEA",167,0)
 S @RMAPI@("PROCEDURE",1,"QTY")=RMQTY
"RTN","RMPRPCEA",168,0)
 ; -------------- Procedures -----------------
"RTN","RMPRPCEA",169,0)
 I '$D(RMBAICD9(1)) D  G BLD1
"RTN","RMPRPCEA",170,0)
 . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",171,0)
 ;
"RTN","RMPRPCEA",172,0)
 F RMLOOP=1:1:99 Q:$G(RMBAICD9(RMLOOP))=""  D
"RTN","RMPRPCEA",173,0)
 . S @RMAPI@("DX/PL",RMLOOP,"DIAGNOSIS")=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",174,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL AO")=$G(RMBAAO(RMLOOP))
"RTN","RMPRPCEA",175,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL IR")=$G(RMBAIR(RMLOOP))
"RTN","RMPRPCEA",176,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL SC")=$G(RMBASCON(RMLOOP))
"RTN","RMPRPCEA",177,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL EC")=$G(RMBAEC(RMLOOP))
"RTN","RMPRPCEA",178,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL MST")=$G(RMBAMST(RMLOOP))
"RTN","RMPRPCEA",179,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL HNC")=$G(RMBAHNC(RMLOOP))
"RTN","RMPRPCEA",180,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL CV")=$G(RMBACBV(RMLOOP))
"RTN","RMPRPCEA",181,0)
 . I RMLOOP=1 D  Q
"RTN","RMPRPCEA",182,0)
 . . S @RMAPI@("DX/PL",RMLOOP,"PRIMARY")=RMLOOP
"RTN","RMPRPCEA",183,0)
 . . S RMDIAG=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",184,0)
 . . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",185,0)
 . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS "_RMLOOP)=$G(RMBAICD9(RMLOOP))  ; only one procedure per send
"RTN","RMPRPCEA",186,0)
 ;
"RTN","RMPRPCEA",187,0)
 ; -----------------procedures----------------
"RTN","RMPRPCEA",188,0)
BLD1 S @RMAPI@("PROCEDURE",1,"PROCEDURE")=RMPROC
"RTN","RMPRPCEA",189,0)
 S @RMAPI@("PROCEDURE",1,"ORD PROVIDER")=RMPROV
"RTN","RMPRPCEA",190,0)
 S @RMAPI@("PROCEDURE",1,"EVENT D/T")=RMCPDT
"RTN","RMPRPCEA",191,0)
 ; ------------- Order Reference -------------
"RTN","RMPRPCEA",192,0)
 S @RMAPI@("PROCEDURE",1,"ORD REFERENCE")=RMODENT
"RTN","RMPRPCEA",193,0)
 ; -----------------Quantity------------------
"RTN","RMPRPCEA",194,0)
 S @RMAPI@("PROCEDURE",1,"QTY")=RMQTY
"RTN","RMPRPCEA",195,0)
 ; -----------------diagnosis-----------------
"RTN","RMPRPCEA",196,0)
 S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",197,0)
 Q
"RTN","RMPRPCEA",198,0)
 ;
"RTN","RMPRPCEA",199,0)
SENDIT ; send the data to PCE. API (1891)
"RTN","RMPRPCEA",200,0)
 K RMPROB,RMPRTPCE
"RTN","RMPRPCEA",201,0)
 S (RMPRCPER,RMPROB)=0
"RTN","RMPRPCEA",202,0)
 ; call the PCE package API.
"RTN","RMPRPCEA",203,0)
 S RMERR=$$DATA2PCE^PXAPI($NA(^TMP("RMPRPCE1",$J,"PXAPI")),RMPKG,RMSRC,.RMPCE,RMUSER,0,,"",.RMPROB)
"RTN","RMPRPCEA",204,0)
 ;To check for returned error messages, list the RMPROB array.
"RTN","RMPRPCEA",205,0)
 I RMERR<1 W !,"File #660 IEN="_RMIE60_" - Error in PCE interface !!!"
"RTN","RMPRPCEA",206,0)
 ;delete PCE entry if Provider and CPT CODE error, but send an error
"RTN","RMPRPCEA",207,0)
 ;message to RMPR PCE mailgroup.
"RTN","RMPRPCEA",208,0)
 I $D(RMPROB($J)) D CHECK^RMPRPCED
"RTN","RMPRPCEA",209,0)
 I $G(RMPCE),$G(RMPRCPER) S RMPRTPCE=RJ_"^"_RMHLOC,RMCHK=$$DELVFILE^PXAPI("ALL",.RMPCE,RMPKG,RMSRC,0,0,"") Q
"RTN","RMPRPCEA",210,0)
 ;
"RTN","RMPRPCEA",211,0)
 Q:'$G(RMPCE)
"RTN","RMPRPCEA",212,0)
 ;update PCE pointer and date last sent in #660.
"RTN","RMPRPCEA",213,0)
 K RMUPD
"RTN","RMPRPCEA",214,0)
 S RMUPD(660,RMIE60_",",8.12)=RMPCE
"RTN","RMPRPCEA",215,0)
 S RMUPD(660,RMIE60_",",8.13)=RMDANOW
"RTN","RMPRPCEA",216,0)
 D FILE^DIE("","RMUPD","")
"RTN","RMPRPCEA",217,0)
 Q
"RTN","RMPRPCEA",218,0)
 ;
"RTN","RMPRPIYI")
0^6^B60374802^B60353445
"RTN","RMPRPIYI",1,0)
RMPRPIYI ;HINCIO/RVD-ISSUE FROM STOCK ;6/16/04  08:18
"RTN","RMPRPIYI",2,0)
 ;;3.0;PROSTHETICS;**61,128**;Feb 09, 1996
"RTN","RMPRPIYI",3,0)
 ; RVD #61 - phase IIIa of PIP
"RTN","RMPRPIYI",4,0)
 ;
"RTN","RMPRPIYI",5,0)
 S RMPR699("AMIS GROUPER")=""
"RTN","RMPRPIYI",6,0)
 S (RMPRG,RMPRF)="" D HOME^%ZIS W @IOF
"RTN","RMPRPIYI",7,0)
 I '$D(RMPR) D DIV4^RMPRSIT G:$D(X) EXIT^RMPRPIYJ
"RTN","RMPRPIYI",8,0)
 I $D(RMPRDFN),$D(^TMP($J,"RMPRPCE")) D LINK^RMPRS
"RTN","RMPRPIYI",9,0)
 I $D(RMPRDFN),'$D(^TMP($J,"RMPRPCE")) G EXIT^RMPRPIYJ
"RTN","RMPRPIYI",10,0)
 K ^TMP($J,"RMPRPCE")
"RTN","RMPRPIYI",11,0)
 D GETPAT^RMPRUTIL G:'$D(RMPRDFN) EXIT^RMPRPIYJ
"RTN","RMPRPIYI",12,0)
VIEW ;
"RTN","RMPRPIYI",13,0)
 N RMPRBAC1,RMDES,RMITQTY
"RTN","RMPRPIYI",14,0)
 S (RSTCK,RMPRBAC1)=1 D ^RMPRPAT K RMPRBAC1
"RTN","RMPRPIYI",15,0)
 I $D(RMPRKILL)!($D(DTOUT)) W $C(7),!,"Deleted..." G EXIT^RMPRPIYJ
"RTN","RMPRPIYI",16,0)
 S CK="W:$D(DUOUT) @IOF,!!!?28,$C(7),""Deleted..."" G EXIT^RMPRPIYJ"
"RTN","RMPRPIYI",17,0)
 S CK2="W @IOF,!!!?28,$C(7),""Deleted..."" H 2"
"RTN","RMPRPIYI",18,0)
 S CK1="W $C(7),!,""Timed-Out, Deleted..."" G EXIT^RMPRPIYJ"
"RTN","RMPRPIYI",19,0)
 S R3("D")=""
"RTN","RMPRPIYI",20,0)
 ;
"RTN","RMPRPIYI",21,0)
RES ;ENTRY POINT TO ADD ADDITIONAL ITEMS FOR ISSUE FROM STOCK
"RTN","RMPRPIYI",22,0)
 Q:$G(RMPRDFN)<1
"RTN","RMPRPIYI",23,0)
 K DA,DD,DIC,PRC,X,Y,RMSO,RMQTY,RMDAHC,RMLACO,RMITDA,RMHCOLD,RMPRVEN
"RTN","RMPRPIYI",24,0)
 K RMPR11IS,RMPR5SA,RMPR6SA
"RTN","RMPRPIYI",25,0)
 S (R1(1),R1(0),R3("D"),R4("D"),R1("AM"),RMPRI("AMS"),R1("D"),RMLOC)=""
"RTN","RMPRPIYI",26,0)
 S RMLODES=""
"RTN","RMPRPIYI",27,0)
 S (RMLOCOLD,R1,RMIT,RMHCNEW,RMHCOLD,RMITDESC,RMITIEN,R1(2))="",REDIT=0
"RTN","RMPRPIYI",28,0)
 S R1(0)=DT_U_RMPRDFN_U_DT,$P(R1(0),U,10)=RMPR("STA"),$P(R1(0),U,27)=DUZ
"RTN","RMPRPIYI",29,0)
 ;
"RTN","RMPRPIYI",30,0)
1 ;ENTRY POINT TO EDIT ITEM ON ISSUE FROM STOCK
"RTN","RMPRPIYI",31,0)
 S (RMHCNEW,RMHCOLD)=$P(R1(1),U,4),RMLOCOLD=RMLOC,RMITOLD=RMIT
"RTN","RMPRPIYI",32,0)
 K RQUIT S RMHCFLG=0
"RTN","RMPRPIYI",33,0)
 W @IOF,!?30,RMPRNAM,!
"RTN","RMPRPIYI",34,0)
 W:$G(REDIT) !!,"Editing a Stock Item!!!"
"RTN","RMPRPIYI",35,0)
 W:'$G(REDIT) !!,"Entering a Stock Item!!!"
"RTN","RMPRPIYI",36,0)
 ;
"RTN","RMPRPIYI",37,0)
TRAN ;TYPE OF TRANSACTION
"RTN","RMPRPIYI",38,0)
 W !
"RTN","RMPRPIYI",39,0)
 ;S DIR(0)="660,2"
"RTN","RMPRPIYI",40,0)
 K DIR
"RTN","RMPRPIYI",41,0)
 S:$P(R1(0),U,4)?.E&($P(R3("D"),U,4)'="") DIR("B")=$P(R3("D"),U,4)
"RTN","RMPRPIYI",42,0)
 S DIR(0)="SO^I:INITIAL ISSUE;X:REPAIR;R:REPLACE;S:SPARE"
"RTN","RMPRPIYI",43,0)
 S DIR("A")="TYPE OF TRANSACTION"
"RTN","RMPRPIYI",44,0)
 D ^DIR
"RTN","RMPRPIYI",45,0)
 I (Y=""),($P(R3("D"),U,4)="") G ^RMPRPIYI
"RTN","RMPRPIYI",46,0)
 I $P(R3("D"),U,4)'=""&($D(DUOUT)) G LIST^RMPRPIYJ
"RTN","RMPRPIYI",47,0)
 I $D(DTOUT) X CK1 Q
"RTN","RMPRPIYI",48,0)
 I $D(DUOUT) G ^RMPRPIYI
"RTN","RMPRPIYI",49,0)
 S $P(R1(0),U,4)=Y K DIR
"RTN","RMPRPIYI",50,0)
 S $P(R3("D"),U,4)=$S(Y="I":"INITIAL ISSUE",Y="X":"REPAIR",Y="R":"REPLACE",Y="S":"SPARE",1:"")
"RTN","RMPRPIYI",51,0)
 ;
"RTN","RMPRPIYI",52,0)
PCAT ;
"RTN","RMPRPIYI",53,0)
 S DIR(0)="660,62" S:$P(R1("AM"),U,3)?1N.N DIR("B")=$P(R4("D"),U,3)
"RTN","RMPRPIYI",54,0)
 D ^DIR I $P(R1("AM"),U,3)'=""&($D(DUOUT)) G LIST^RMPRPIYJ
"RTN","RMPRPIYI",55,0)
 I $D(DTOUT) X CK1 Q
"RTN","RMPRPIYI",56,0)
 I $D(DUOUT) X CK2 G ^RMPRPIYI
"RTN","RMPRPIYI",57,0)
 S $P(R1("AM"),U,3)=Y,$P(R4("D"),U,3)=$S(Y=1:"SC/OP",Y=2:"SC/IP",Y=3:"NSC/IP",Y=4:"NSC/OP",1:"") K DIR
"RTN","RMPRPIYI",58,0)
 I Y<4 S $P(R1("AM"),U,4)="",$P(R4("D"),U,4)="" G 2
"RTN","RMPRPIYI",59,0)
 ;
"RTN","RMPRPIYI",60,0)
SPE I Y=4 S DIR(0)="660,63" S:$P(R1("AM"),U,4)?1N.N DIR("B")=$P(R4("D"),U,4) D ^DIR I $D(DTOUT) X CK1 Q
"RTN","RMPRPIYI",61,0)
 I $G(REDIT)&($D(DUOUT)) G LIST^RMPRPIYJ
"RTN","RMPRPIYI",62,0)
 I $D(DUOUT) X CK2 G ^RMPRPIYI
"RTN","RMPRPIYI",63,0)
 I $P(R1("AM"),U,3)=4 S $P(R1("AM"),U,4)=Y,$P(R4("D"),U,4)=$S(Y=1:"SPECIAL LEGISLATION",Y=2:"A&A",Y=3:"PHC",Y=4:"ELIGIBILITY REFORM",1:"")
"RTN","RMPRPIYI",64,0)
 ;
"RTN","RMPRPIYI",65,0)
 ; prompt for and scan barcode label
"RTN","RMPRPIYI",66,0)
 ; if scan is successful then all vars will be set and go to Edit prompt
"RTN","RMPRPIYI",67,0)
2 I $G(REDIT),$D(RMPR11I) M RMPR11IS=RMPR11I,RMPR5SA=RMPR5,RMPR6SA=RMPR6
"RTN","RMPRPIYI",68,0)
 W ! D SCAN^RMPRPIYS
"RTN","RMPRPIYI",69,0)
 I $P(R3("D"),U,6)&((RMPREXC="^")!(RMPREXC="P")) G LIST^RMPRPIYJ
"RTN","RMPRPIYI",70,0)
 I (RMPREXC="^"),$G(REDIT) G LIST^RMPRPIYJ
"RTN","RMPRPIYI",71,0)
 I RMPREXC="^" X CK2 G ^RMPRPIYI
"RTN","RMPRPIYI",72,0)
 I RMPREXC="P" G PCAT
"RTN","RMPRPIYI",73,0)
 I RMPREXC="T" X CK1 Q
"RTN","RMPRPIYI",74,0)
 I RMPRBARC="",$G(REDIT) M RMPR11I=RMPR11IS,RMPR5=RMPR5SA,RMPR6=RMPR6SA G ^RMPRPIYJ
"RTN","RMPRPIYI",75,0)
 I RMPRBARC="" G 2
"RTN","RMPRPIYI",76,0)
 D HCPCS3^RMPRPIY1
"RTN","RMPRPIYI",77,0)
 G ^RMPRPIYJ
"RTN","RMPRPIYI",78,0)
HCPCS ;HCPCS code
"RTN","RMPRPIYI",79,0)
 S (RMITFLG,RMHCFLG,RMHCDA,RMITDA,RMAV,RMAVA,RMCO,RMBAL)=0
"RTN","RMPRPIYI",80,0)
 S RMPRHCPC="" I $D(RMHCPC) S RMPRHCPC=RMHCPC
"RTN","RMPRPIYI",81,0)
 D HCPCS^RMPRPIY1(RMPR("STA"),RMPRHCPC,.RMPR1,.RMPR11,.RMPREXC)
"RTN","RMPRPIYI",82,0)
 I RMPREXC="T" X CK1 Q
"RTN","RMPRPIYI",83,0)
 I RMPREXC="P" G 2
"RTN","RMPRPIYI",84,0)
 I $G(REDIT),(RMPREXC="^") G LIST^RMPRPIYJ
"RTN","RMPRPIYI",85,0)
 I RMPREXC="^" X CK2 G ^RMPRPIYI
"RTN","RMPRPIYI",86,0)
 W !
"RTN","RMPRPIYI",87,0)
 S RMITNO=RMPR11("ITEM")
"RTN","RMPRPIYI",88,0)
 S RMHCPC=RMPR1("HCPCS")
"RTN","RMPRPIYI",89,0)
 S (RMHCNEW,RMDAHC,RMHCDA)=RMPR1("IEN")
"RTN","RMPRPIYI",90,0)
 S RDESC=RMPR1("SHORT DESC")
"RTN","RMPRPIYI",91,0)
 K RMPR11I
"RTN","RMPRPIYI",92,0)
 S RMPRERR=$$ETOI^RMPRPIX1(.RMPR11,.RMPR11I)
"RTN","RMPRPIYI",93,0)
 I RMPR11I("ITEM MASTER IEN")="" D  G 2
"RTN","RMPRPIYI",94,0)
 . W !,"This item is not associated with an IFCAP Item.",!
"RTN","RMPRPIYI",95,0)
 . W "Please use the Edit Inventory option before trying to issue this item."
"RTN","RMPRPIYI",96,0)
 . W !
"RTN","RMPRPIYI",97,0)
 . Q
"RTN","RMPRPIYI",98,0)
 I '$D(^RMPR(661.7,"XSHIDS",RMPR("STA"),RMHCPC,RMITNO)) D  G 2
"RTN","RMPRPIYI",99,0)
 . W !,"This HCPCS-ITEM is not associated with any Location."
"RTN","RMPRPIYI",100,0)
 . W !,"Please update your inventory!!.",!
"RTN","RMPRPIYI",101,0)
 . W !
"RTN","RMPRPIYI",102,0)
 . Q
"RTN","RMPRPIYI",103,0)
 S $P(R1(0),U,6)=RMPR11I("ITEM MASTER IEN")
"RTN","RMPRPIYI",104,0)
 S $P(R1(0),U,8)=$G(RMPR11("UNIT"))
"RTN","RMPRPIYI",105,0)
 S $P(R3("D"),U,6)=RMPR11("ITEM MASTER")
"RTN","RMPRPIYI",106,0)
 ;check for location if multiple then ask for LOCATION
"RTN","RMPRPIYI",107,0)
 S RMLCNT=0
"RTN","RMPRPIYI",108,0)
 F I=0:0 S I=$O(^RMPR(661.7,"XSLHIDS",RMPR("STA"),I)) Q:I'>0  I $D(^(I,RMHCPC)) S RMLCNT=RMLCNT+1,(RMPR5("IEN"),RMLOC)=I
"RTN","RMPRPIYI",109,0)
 I RMLCNT<2 G ITEM
"RTN","RMPRPIYI",110,0)
 ;
"RTN","RMPRPIYI",111,0)
ASKLOC ;ask for location
"RTN","RMPRPIYI",112,0)
 K DIC,Y,X,RQUIT,RMPR5
"RTN","RMPRPIYI",113,0)
 S DZ="??",D="B"
"RTN","RMPRPIYI",114,0)
 S DIC("S")="I ($P(^RMPR(661.5,+Y,0),U,2)=RMPR(""STA"")),($P(^(0),U,4)=""A""),($D(^RMPR(661.7,""XSLHIDS"",RMPR(""STA""),+Y,RMHCPC,RMITNO)))"
"RTN","RMPRPIYI",115,0)
 S:RMLOCOLD'="" DIC("B")=RMLOCOLD
"RTN","RMPRPIYI",116,0)
 S DIC="^RMPR(661.5,",DIC(0)="AEQMN"
"RTN","RMPRPIYI",117,0)
 S DIC("A")="Enter Pros Location: " D MIX^DIC1
"RTN","RMPRPIYI",118,0)
 I $G(REDIT)&$D(DUOUT) G LIST^RMPRPIYJ
"RTN","RMPRPIYI",119,0)
 I $D(DUOUT) G 2^RMPRPIYI
"RTN","RMPRPIYI",120,0)
 I $D(DTOUT) X CK1 Q
"RTN","RMPRPIYI",121,0)
 I X="" W !,"This is a mandatory field!!!",! G ASKLOC
"RTN","RMPRPIYI",122,0)
 S RMLOC=+Y
"RTN","RMPRPIYI",123,0)
 S RMPR5("IEN")=RMLOC
"RTN","RMPRPIYI",124,0)
 G:'$D(^RMPR(661.5,RMLOC,0)) ASKLOC
"RTN","RMPRPIYI",125,0)
 ;
"RTN","RMPRPIYI",126,0)
ITEM ;PSAS Item details.
"RTN","RMPRPIYI",127,0)
 K RMPR11I
"RTN","RMPRPIYI",128,0)
 S RMCHCK=$$ETOI^RMPRPIX1(.RMPR11,.RMPR11I)
"RTN","RMPRPIYI",129,0)
 I RMCHCK W !,"*** ERROR IN API RMPRPIX1 !!!!",! X CK1 Q
"RTN","RMPRPIYI",130,0)
 S RMIT=RMPR11("HCPCS-ITEM")
"RTN","RMPRPIYI",131,0)
 S $P(R1(2),U,1)=RMIT S $P(R1(2),U,2)=RMPR11("DESCRIPTION")
"RTN","RMPRPIYI",132,0)
 I RMDAHC=RMHCOLD S DIR("B")=$G(RMIT)
"RTN","RMPRPIYI",133,0)
 ;
"RTN","RMPRPIYI",134,0)
 ;call stock record in 661.7
"RTN","RMPRPIYI",135,0)
 S RMR("STATION IEN")=RMPR("STA")
"RTN","RMPRPIYI",136,0)
 S RMR("LOCATION IEN")=RMLOC
"RTN","RMPRPIYI",137,0)
 S RMR("HCPCS")=RMHCPC
"RTN","RMPRPIYI",138,0)
 S RMR("ITEM")=RMPR11("ITEM")
"RTN","RMPRPIYI",139,0)
 S RMR("VENDOR IEN")=$P(R1(0),U,9)
"RTN","RMPRPIYI",140,0)
 S RMCHCK=$$STOCK^RMPRPIUE(.RMR)
"RTN","RMPRPIYI",141,0)
 I RMCHCK W !,"*** ERROR IN API RMPRPIUE !!!!",! X CK1 Q
"RTN","RMPRPIYI",142,0)
 S (RMITDES,RMDES)=RMIT K DIC("B"),DIC("S")
"RTN","RMPRPIYI",143,0)
 S RMUBA=RMR("QOH")
"RTN","RMPRPIYI",144,0)
 I RMUBA<1 D LOWBA G 2
"RTN","RMPRPIYI",145,0)
 ;
"RTN","RMPRPIYI",146,0)
 I $D(RMLOC),$D(RMHCDA) S RMSO=RMPR11I("SOURCE")
"RTN","RMPRPIYI",147,0)
 I $D(RMSO),RMSO="" D MESSO G 2
"RTN","RMPRPIYI",148,0)
 S:$D(RMSO) $P(R1(0),U,14)=RMSO
"RTN","RMPRPIYI",149,0)
 S $P(R3("D"),U,14)=$S(RMSO="C":"COMMERCIAL",RMSO="V":"VA",1:"")
"RTN","RMPRPIYI",150,0)
 I $P(R1(1),U,4)'="",$D(DUOUT) G LIST^RMPRPIYJ
"RTN","RMPRPIYI",151,0)
 ;I $G(RMLOC),'($G(RMHCDA)&$G(RMITDA)) W !,"PSAS Item was not selected!!" G 2
"RTN","RMPRPIYI",152,0)
 I $G(RMLOC),$G(RMHCDA) S RMPRUCST=RMR("UNIT COST")
"RTN","RMPRPIYI",153,0)
 I '$G(RMPRUCST) D MESSI G 2
"RTN","RMPRPIYI",154,0)
 S:$G(REDIT) $P(R1(0),U,16)=RMPRUCST*$P(R1(0),U,7),$P(R3("D"),U,16)=RMPRUCST*$P(R1(0),U,7)
"RTN","RMPRPIYI",155,0)
 K DIC
"RTN","RMPRPIYI",156,0)
 ;
"RTN","RMPRPIYI",157,0)
CPT ;ask for CPT Modifier
"RTN","RMPRPIYI",158,0)
 D CPT^RMPRPIYS(RMDAHC_"^"_$P(R1(0),U,4)_"^"_$P(R1(0),U,14)_"^"_660)
"RTN","RMPRPIYI",159,0)
 I RMPREXC="T" X CK1 Q
"RTN","RMPRPIYI",160,0)
 I RMPREXC="^" G 2
"RTN","RMPRPIYI",161,0)
 I RMPREXC="P" G 2
"RTN","RMPRPIYI",162,0)
 ;
"RTN","RMPRPIYI",163,0)
VEN ;vendor
"RTN","RMPRPIYI",164,0)
 ;call routine RMPRPIYV for vendor from file 661.6.
"RTN","RMPRPIYI",165,0)
 S $P(R1(1),U,4)=RMDAHC,$P(R1(0),U,22)=$P(^RMPR(661.1,RMDAHC,0),U,4)
"RTN","RMPRPIYI",166,0)
 ;If there is only one vendor use it as a default.  
"RTN","RMPRPIYI",167,0)
 K RMPRVEN
"RTN","RMPRPIYI",168,0)
 S RMERR=$$STOCK^RMPRPIUV(.RMR,.RMPRVEN)
"RTN","RMPRPIYI",169,0)
 I RMERR W !,"*** ERROR IN API RMPRPIUV !!!!",! X CK1 Q
"RTN","RMPRPIYI",170,0)
 I RMPRVEN=1 S DIC("B")=$O(RMPRVEN(0))
"RTN","RMPRPIYI",171,0)
 I $G(REDIT) S DIC("B")=$P(R1(0),U,9)
"RTN","RMPRPIYI",172,0)
 S DIC(0)="AEQM"
"RTN","RMPRPIYI",173,0)
 S DIC("A")="VENDOR: ",DIC=440,DIC("S")="I $D(RMPRVEN(+Y))"
"RTN","RMPRPIYI",174,0)
 D ^DIC I $P(R3("D"),U,9)'=""&$D(DUOUT) G LIST^RMPRPIYJ
"RTN","RMPRPIYI",175,0)
 I $D(DTOUT) X CK1 Q
"RTN","RMPRPIYI",176,0)
 I $D(DUOUT) G 2
"RTN","RMPRPIYI",177,0)
 I +Y'>0 W !!,?5,$C(7),"This is a required response.  Enter '^' to exit",! G VEN
"RTN","RMPRPIYI",178,0)
 S $P(R1(0),U,9)=+Y,$P(R3("D"),U,9)=$P(Y,U,2) K DIC,Y,X
"RTN","RMPRPIYI",179,0)
 G ^RMPRPIYJ
"RTN","RMPRPIYI",180,0)
 ;
"RTN","RMPRPIYI",181,0)
 ;
"RTN","RMPRPIYI",182,0)
MESSI ;print message if COST is not defined in the inventory (661.5)
"RTN","RMPRPIYI",183,0)
 S:'$D(RMIT) RMIT=""
"RTN","RMPRPIYI",184,0)
 W !!,"***ITEM COST is not define @:"
"RTN","RMPRPIYI",185,0)
 W !,"    PSAS Item = ",RMIT
"RTN","RMPRPIYI",186,0)
 W !,"    Location  = ",$P($G(^RMPR(661.5,RMLOC,0)),U,1)
"RTN","RMPRPIYI",187,0)
 W !,"***Fix your inventory or use a different PSAS ITEM!!",!!
"RTN","RMPRPIYI",188,0)
 Q
"RTN","RMPRPIYI",189,0)
 ;
"RTN","RMPRPIYI",190,0)
MESSO ;print message if SOURCE is not defined in the inventory (661.11)
"RTN","RMPRPIYI",191,0)
 W !!,"***PSAS ITEM has no SOURCE at this location..."
"RTN","RMPRPIYI",192,0)
 W !,"***Fix your inventory or use a different PSAS ITEM!!",!!
"RTN","RMPRPIYI",193,0)
 Q
"RTN","RMPRPIYI",194,0)
 ;
"RTN","RMPRPIYI",195,0)
INACT ;print message if HCPCS is inactive.
"RTN","RMPRPIYI",196,0)
 W !!,"*** You have selected an INACTIVE HCPCS..."
"RTN","RMPRPIYI",197,0)
 W !,"*** Please REMOVE this HCPCS from inventory..."
"RTN","RMPRPIYI",198,0)
 W !,"*** And use a different HCPCS!!!",!
"RTN","RMPRPIYI",199,0)
 Q
"RTN","RMPRPIYI",200,0)
 ;
"RTN","RMPRPIYI",201,0)
LOWBA ;print message if inventory balance is low.
"RTN","RMPRPIYI",202,0)
 S:'$D(RMUBA) RMUBA="" S:'$D(RMIT) RMIT=""
"RTN","RMPRPIYI",203,0)
 W !!,"*** PSAS Item ",RMIT," balance is = ",RMUBA
"RTN","RMPRPIYI",204,0)
 W !,"*** You are unable to use this PSAS ITEM..."
"RTN","RMPRPIYI",205,0)
 W !,"*** Please use a different HCPCS or PSAS Item !!!!",!
"RTN","RMPRPIYI",206,0)
 Q
"RTN","RMPRPIYI",207,0)
 ;
"RTN","RMPRPIYI",208,0)
LKP ;print a message if PSAS HCPCS not in PIP or invalid HCPCS.
"RTN","RMPRPIYI",209,0)
 Q:'$G(RMF)!(X=" ")
"RTN","RMPRPIYI",210,0)
 S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","RMPRPIYI",211,0)
 K RX
"RTN","RMPRPIYI",212,0)
 I $D(RSTCK),$D(^RMPR(661.7,"XSHIDS",RMPR("STA"),X)) S RX=1
"RTN","RMPRPIYI",213,0)
 I '$D(RSTCK),$D(^RMPR(661.11,"ASHD",RMPR("STA"),X)) S RX=1
"RTN","RMPRPIYI",214,0)
 I '$G(RX),$D(^RMPR(661.1,"B",X)) D EN^DDIOL("*** Only PSAS HCPCS in PIP can be accessed.  Please verify your Location and PSAS HCPCS!!","","!!")
"RTN","RMPRPIYI",215,0)
 K RX
"RTN","RMPRPIYI",216,0)
 Q
"RTN","RMPRPIYJ")
0^2^B18984837^B18204956
"RTN","RMPRPIYJ",1,0)
RMPRPIYJ ;HINCIO/RVD-ISSUE FROM STOCK / CONT. ;9/18/02  07:39
"RTN","RMPRPIYJ",2,0)
 ;;3.0;PROSTHETICS;**61,128**;Feb 09, 1996
"RTN","RMPRPIYJ",3,0)
 ; RVD #61 - pip INVENTORY PHASE IIIa
"RTN","RMPRPIYJ",4,0)
 ;
"RTN","RMPRPIYJ",5,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RMPRPIYJ",6,0)
QTY K DIR,Y S DIR(0)="660,5",DIR("B")=1 S:$P(R1(0),U,7) DIR("B")=$P(R1(0),U,7)
"RTN","RMPRPIYJ",7,0)
 D ^DIR I $P(R1(0),U,7)'=""&$D(DUOUT) G LIST
"RTN","RMPRPIYJ",8,0)
 I $D(DTOUT) X CK2 G ^RMPRPIYI
"RTN","RMPRPIYJ",9,0)
 I $D(DIRUT) G ^RMPRPIYI
"RTN","RMPRPIYJ",10,0)
 I $G(RMUBA),((RMUBA-Y)<0) D LOWBA^RMPRPIYI G 2^RMPRPIYI
"RTN","RMPRPIYJ",11,0)
 I $G(RMITQTY),RMITQTY<Y W !,"Issue quantity exceeds on-hand (",RMITQTY,") for scanned item bar code!!",! G QTY
"RTN","RMPRPIYJ",12,0)
 S $P(R1(0),U,7)=Y,$P(R1(0),U,16)=Y*RMPRUCST K DIR
"RTN","RMPRPIYJ",13,0)
 ;
"RTN","RMPRPIYJ",14,0)
DATE ;delivery date is set to today's date
"RTN","RMPRPIYJ",15,0)
 S $P(R1(0),U,12)=DT,Y=DT D DD^%DT S $P(R3("D"),U,12)=Y
"RTN","RMPRPIYJ",16,0)
 ;
"RTN","RMPRPIYJ",17,0)
SERV ;date of service
"RTN","RMPRPIYJ",18,0)
 S Y=DT D DD^%DT S DIR("B")=Y,DIR("A")="DATE OF SERVICE",DIR(0)="660,39"
"RTN","RMPRPIYJ",19,0)
 I $G(REDIT) S DIR("B")=$P(R1("D"),U,8)
"RTN","RMPRPIYJ",20,0)
 D ^DIR K DIR I $D(DTOUT) X CK2 G ^RMPRPIYI
"RTN","RMPRPIYJ",21,0)
 I $D(DUOUT),$G(REDIT) G LIST
"RTN","RMPRPIYJ",22,0)
 I (X="")!(X="@") W !,"This field is mandatory!!!",! G SERV
"RTN","RMPRPIYJ",23,0)
 S $P(R1(1),U,8)=Y D DD^%DT S $P(R1("D"),U,8)=Y
"RTN","RMPRPIYJ",24,0)
 ;
"RTN","RMPRPIYJ",25,0)
LI S DIR(0)="660,9" S:$P(R1(0),U,11)'="" DIR("B")=$P(R1(0),U,11)
"RTN","RMPRPIYJ",26,0)
 D ^DIR I $D(DTOUT) X CK1 Q
"RTN","RMPRPIYJ",27,0)
 G:$D(DUOUT) LIST
"RTN","RMPRPIYJ",28,0)
 I X["^" W !,"Jumping not allowed" G LI
"RTN","RMPRPIYJ",29,0)
 I $P(R1(0),U,11)'=""&(X="@") S $P(R1(0),U,11)="" W $C(7),!?5,"Deleted..." H 1 G LOT
"RTN","RMPRPIYJ",30,0)
 S $P(R1(0),U,11)=X
"RTN","RMPRPIYJ",31,0)
 ;
"RTN","RMPRPIYJ",32,0)
LOT ;
"RTN","RMPRPIYJ",33,0)
 ;
"RTN","RMPRPIYJ",34,0)
 K DIR S DIR(0)="660,21" S:$P(R1(0),U,24)'="" DIR("B")=$P(R1(0),U,24)
"RTN","RMPRPIYJ",35,0)
 D ^DIR I $D(DTOUT) X CK1 Q
"RTN","RMPRPIYJ",36,0)
 G:$D(DUOUT) LIST
"RTN","RMPRPIYJ",37,0)
 I X["^" W !,"Jumping not allowed" G LOT
"RTN","RMPRPIYJ",38,0)
 I $P(R1(0),U,24)'=""&(X="@") S $P(R1(0),U,24)="" W $C(7),!?5,"Deleted..." H 1 G REMA
"RTN","RMPRPIYJ",39,0)
 S $P(R1(0),U,24)=X
"RTN","RMPRPIYJ",40,0)
 ;
"RTN","RMPRPIYJ",41,0)
REMA ;
"RTN","RMPRPIYJ",42,0)
 ;
"RTN","RMPRPIYJ",43,0)
 K DIR S DIR(0)="660,16" S:$P(R1(0),U,18)'="" DIR("B")=$P(R1(0),U,18)
"RTN","RMPRPIYJ",44,0)
 D ^DIR I $D(DTOUT) X CK1 Q
"RTN","RMPRPIYJ",45,0)
 G:$D(DUOUT) LIST
"RTN","RMPRPIYJ",46,0)
 I X["^" W !,"Jumping not allowed" G REMA
"RTN","RMPRPIYJ",47,0)
 I $P(R1(0),U,18)'=""&(X="@") S $P(R1(0),U,18)="" W $C(7),!?5,"Deleted..." H 1 G LIST
"RTN","RMPRPIYJ",48,0)
 S $P(R1(0),U,18)=X
"RTN","RMPRPIYJ",49,0)
 ;
"RTN","RMPRPIYJ",50,0)
LIST ;ENTRY POINT FOR STOCK ISSUE ROUTINES TO DISPLAY TRANSACTION DATA
"RTN","RMPRPIYJ",51,0)
 S RMDAHC=$P(R1(1),U,4)
"RTN","RMPRPIYJ",52,0)
 D:$D(RMCPT) CHK^RMPRED5
"RTN","RMPRPIYJ",53,0)
 D ^RMPRPIYK
"RTN","RMPRPIYJ",54,0)
 K DIR,RQUIT
"RTN","RMPRPIYJ",55,0)
 S DIR(0)="SBO^P:POST;E:EDIT;D:DELETE"
"RTN","RMPRPIYJ",56,0)
 S DIR("A")="Would you like to POST/EDIT/DELETE this entry"
"RTN","RMPRPIYJ",57,0)
 S DIR("B")="P"
"RTN","RMPRPIYJ",58,0)
 S DIR("?")="Answer `P` to post the transaction, `E` to edit the transaction,'D' to delete the transaction"
"RTN","RMPRPIYJ",59,0)
 D ^DIR K DIR G:Y="P" POST G:Y="D" DEA
"RTN","RMPRPIYJ",60,0)
 I Y="E" S REDIT=1 G 1^RMPRPIYI
"RTN","RMPRPIYJ",61,0)
 I $D(DIRUT)!$D(DUOUT)!$D(DTOUT) G ^RMPRPIYI
"RTN","RMPRPIYJ",62,0)
 ;
"RTN","RMPRPIYJ",63,0)
DEA ;
"RTN","RMPRPIYJ",64,0)
 K DIR
"RTN","RMPRPIYJ",65,0)
 S DIR("A")="Are you sure you want to DELETE this entry"
"RTN","RMPRPIYJ",66,0)
 S DIR("B")="N",DIR(0)="Y"
"RTN","RMPRPIYJ",67,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT)!$D(DIRUT) X CK Q
"RTN","RMPRPIYJ",68,0)
 I Y=1 W !!,$C(7),?50," Deleted..." H 2 K DIR G RES^RMPRPIYI
"RTN","RMPRPIYJ",69,0)
 G LIST
"RTN","RMPRPIYJ",70,0)
 ;
"RTN","RMPRPIYJ",71,0)
POST ;
"RTN","RMPRPIYJ",72,0)
 I RMPR699("AMIS GROUPER")'="" G GGC
"RTN","RMPRPIYJ",73,0)
 S RMPRAMIS=0
"RTN","RMPRPIYJ",74,0)
 S RMPR699("IEN")=RMPRSITE
"RTN","RMPRPIYJ",75,0)
 S RMPRAMIS=$$AMGR^RMPRPIX2(.RMPR699)
"RTN","RMPRPIYJ",76,0)
 I RMPRAMIS X CK Q
"RTN","RMPRPIYJ",77,0)
GGC ;
"RTN","RMPRPIYJ",78,0)
 D SETARR(.RMPR60)
"RTN","RMPRPIYJ",79,0)
 S RMPRERR=$$ISS^RMPRPIU6(.RMPR60,.RMPR11I,.RMPR5)
"RTN","RMPRPIYJ",80,0)
 I RMPRERR=9 D LOWBA^RMPRPIYI G 2^RMPRPIYI
"RTN","RMPRPIYJ",81,0)
 I RMPRERR W !,"*** ERROR in API RMPRPIU6, ERROR = ",RMPRERR," !!!" G EXIT
"RTN","RMPRPIYJ",82,0)
 S ^TMP($J,"RMPRPCE",660,RMPR60("IEN"))=RMPR699("AMIS GROUPER")_"^"_$G(RMPRDFN)
"RTN","RMPRPIYJ",83,0)
 ;
"RTN","RMPRPIYJ",84,0)
 W !,"Posted to 2319..." H 3
"RTN","RMPRPIYJ",85,0)
 G RES^RMPRPIYI
"RTN","RMPRPIYJ",86,0)
 ;
"RTN","RMPRPIYJ",87,0)
EXIT ;EXIT FOR STOCK ISSUES
"RTN","RMPRPIYJ",88,0)
 N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPRPIYJ",89,0)
 Q
"RTN","RMPRPIYJ",90,0)
 ;
"RTN","RMPRPIYJ",91,0)
INV1 I $P(R1(0),U,14)="C" S $P(R1(0),U,16)=RMPRUCST*$P(R1(0),U,7)
"RTN","RMPRPIYJ",92,0)
 G QTY
"RTN","RMPRPIYJ",93,0)
 ;
"RTN","RMPRPIYJ",94,0)
 ; Set up arrays for Stock Issue Transaction
"RTN","RMPRPIYJ",95,0)
SETARR(RMPR60) ;
"RTN","RMPRPIYJ",96,0)
 K RMPR60
"RTN","RMPRPIYJ",97,0)
 S RMPR60("ENTRY DATE")=$P(R1(0),U,1)
"RTN","RMPRPIYJ",98,0)
 S RMPR60("PATIENT IEN")=$P(R1(0),U,2)
"RTN","RMPRPIYJ",99,0)
 S RMPR60("ISSUE TYPE")=$P(R1(0),U,4)
"RTN","RMPRPIYJ",100,0)
 S RMPR60("QUANTITY")=$P(R1(0),U,7)
"RTN","RMPRPIYJ",101,0)
 S RMPR60("IFCAP ITEM")=$P(R1(0),U,6)
"RTN","RMPRPIYJ",102,0)
 S RMPR60("UNIT")=$P(R1(0),U,8)
"RTN","RMPRPIYJ",103,0)
 S RMPR60("VENDOR IEN")=$P(R1(0),U,9)
"RTN","RMPRPIYJ",104,0)
 S RMPR60("SERIAL NUM")=$P(R1(0),U,11)
"RTN","RMPRPIYJ",105,0)
 S RMPR60("DELIV DATE")=$P(R1(0),U,12)
"RTN","RMPRPIYJ",106,0)
 S RMPR60("DATE OF SERVICE")=$P(R1(1),U,8)
"RTN","RMPRPIYJ",107,0)
 S RMPR60("SOURCE")=$P(R1(0),U,14)
"RTN","RMPRPIYJ",108,0)
 S RMPR60("COST")=$P(R1(0),U,16)
"RTN","RMPRPIYJ",109,0)
 S RMPR60("REMARKS")=$P(R1(0),U,18)
"RTN","RMPRPIYJ",110,0)
 S RMPR60("LOT NUM")=$P(R1(0),U,24)
"RTN","RMPRPIYJ",111,0)
 S RMPR60("HCPCS")=$P(R1(1),U,4)
"RTN","RMPRPIYJ",112,0)
 S RMPR60("CPT IEN")=$P(R1(0),U,22)
"RTN","RMPRPIYJ",113,0)
 S RMPR60("CPT MOD")=$P(R1(1),U,6)
"RTN","RMPRPIYJ",114,0)
 S RMPR60("PAT CAT")=$P(R1("AM"),U,3)
"RTN","RMPRPIYJ",115,0)
 S RMPR60("SPEC CAT")=$P(R1("AM"),U,4)
"RTN","RMPRPIYJ",116,0)
 S RMPR60("USER")=$P(R1(0),U,27)
"RTN","RMPRPIYJ",117,0)
 S RMPR60("SITE IEN")=RMPRSITE
"RTN","RMPRPIYJ",118,0)
 S RMPR60("GROUPER")=RMPR699("AMIS GROUPER")
"RTN","RMPRPIYJ",119,0)
 S RMPR60("DATE&TIME")=R1("DATE&TIME")
"RTN","RMPRPIYJ",120,0)
 Q
"RTN","RMPRPIYS")
0^1^B84869709^B84190403
"RTN","RMPRPIYS",1,0)
RMPRPIYS ;HINCIO/ODJ - RC - PIP Receive Stock ;10/8/02  13:11
"RTN","RMPRPIYS",2,0)
 ;;3.0;PROSTHETICS;**61,108,128**;Feb 09, 1996
"RTN","RMPRPIYS",3,0)
 Q
"RTN","RMPRPIYS",4,0)
 ;
"RTN","RMPRPIYS",5,0)
 ;***** PB - Print Bar Code labels
"RTN","RMPRPIYS",6,0)
 ;           RMPR INV BAR CODE
"RTN","RMPRPIYS",7,0)
 ;           Callable from VISTA menu, no vars required other than
"RTN","RMPRPIYS",8,0)
 ;           global VISTA vars (DUZ, etc)
"RTN","RMPRPIYS",9,0)
 ;
"RTN","RMPRPIYS",10,0)
PB N RMPRERR,RMPRSTN,RMPRLCN,RMPREXC,RMPR1,RMPR11,RMPROVAL,RMPRNLAB
"RTN","RMPRPIYS",11,0)
 N RMPR6,RMPR7,RMPR7I,RMPRBARC,RMPRITXT,RMPRBCP,RMPRQ,RMPRIOP
"RTN","RMPRPIYS",12,0)
 ;
"RTN","RMPRPIYS",13,0)
 ;***** STN - prompt for Site/Station
"RTN","RMPRPIYS",14,0)
STN S RMPROVAL=$G(RMPRSTN("IEN"))
"RTN","RMPRPIYS",15,0)
 W @IOF S RMPRERR=$$STN^RMPRPIY1(.RMPRSTN,.RMPREXC)
"RTN","RMPRPIYS",16,0)
 I RMPRERR G PBX
"RTN","RMPRPIYS",17,0)
 I RMPREXC'="" G PBX
"RTN","RMPRPIYS",18,0)
 I RMPROVAL'=RMPRSTN("IEN") K RMPR1,RMPR11
"RTN","RMPRPIYS",19,0)
 ;
"RTN","RMPRPIYS",20,0)
 ;***** HCPCS - prompt for HCPCS and Item
"RTN","RMPRPIYS",21,0)
HCPCS W !!,"Print Bar code Labels for current inventory...",!
"RTN","RMPRPIYS",22,0)
HCPCS2 D HCPCS^RMPRPIY7(RMPRSTN("IEN"),$G(RMPR1("HCPCS")),.RMPR1,.RMPR11,.RMPREXC)
"RTN","RMPRPIYS",23,0)
 I RMPREXC="T" G PBX
"RTN","RMPRPIYS",24,0)
 I RMPREXC="P" G STN
"RTN","RMPRPIYS",25,0)
 I RMPREXC="^" D  G PBX
"RTN","RMPRPIYS",26,0)
 . W !,"** No HCPCS selected..." H 1
"RTN","RMPRPIYS",27,0)
 . Q
"RTN","RMPRPIYS",28,0)
 I $G(RMPR11("IEN"))'="" G HCPCS3A
"RTN","RMPRPIYS",29,0)
HCPCS3 D ITEM^RMPRPIYP(RMPRSTN("IEN"),RMPR1("HCPCS"),.RMPR11,.RMPREXC)
"RTN","RMPRPIYS",30,0)
 I RMPREXC="T" G PBX
"RTN","RMPRPIYS",31,0)
 I RMPREXC="P"!(RMPREXC="^") G HCPCS
"RTN","RMPRPIYS",32,0)
HCPCS3A S RMPR11("STATION")=RMPRSTN("IEN")
"RTN","RMPRPIYS",33,0)
 S RMPR11("STATION IEN")=RMPRSTN("IEN")
"RTN","RMPRPIYS",34,0)
 ;
"RTN","RMPRPIYS",35,0)
 ; display selected HCPCS and item and continue
"RTN","RMPRPIYS",36,0)
HCPCS4 W !!,"HCPCS: "_RMPR1("HCPCS")_" "_RMPR1("SHORT DESC")
"RTN","RMPRPIYS",37,0)
 W !!,"IFCAP Item: ",RMPR11("ITEM MASTER")
"RTN","RMPRPIYS",38,0)
 W !!,"PIP Item desc.: ",RMPR11("DESCRIPTION")
"RTN","RMPRPIYS",39,0)
 ;
"RTN","RMPRPIYS",40,0)
 ;***** CURST - call prompt for current stock record
"RTN","RMPRPIYS",41,0)
CURST S RMPRLCN=""
"RTN","RMPRPIYS",42,0)
 D PVEN^RMPRPIYR(RMPRSTN("IEN"),.RMPRLCN,RMPR11("HCPCS"),RMPR11("ITEM"),.RMPR6,.RMPR7,.RMPREXC)
"RTN","RMPRPIYS",43,0)
 I RMPREXC="T" G PBX
"RTN","RMPRPIYS",44,0)
 I RMPREXC="P" G HCPCS3
"RTN","RMPRPIYS",45,0)
 I RMPREXC="^" G HCPCS
"RTN","RMPRPIYS",46,0)
 I '+$G(RMPR7("QUANTITY")) D  G HCPCS2
"RTN","RMPRPIYS",47,0)
 . W !,"This item is not currently in stock.",!!
"RTN","RMPRPIYS",48,0)
 . Q
"RTN","RMPRPIYS",49,0)
 K RMPR7I
"RTN","RMPRPIYS",50,0)
 S RMPRERR=$$ETOI^RMPRPIX7(.RMPR7,.RMPR7I)
"RTN","RMPRPIYS",51,0)
 S RMPRBARC=RMPR11("HCPCS")_"-"_$P(RMPR7I("DATE&TIME"),".",1)_$P(RMPR7I("DATE&TIME"),".",2)
"RTN","RMPRPIYS",52,0)
 S RMPRITXT("DATE")=$E(RMPR7I("DATE&TIME"),4,5)_"/"_$E(RMPR7I("DATE&TIME"),6,7)_"/"_(1700+$E(RMPR7I("DATE&TIME"),1,3))
"RTN","RMPRPIYS",53,0)
 S RMPRITXT("ITEM")=RMPR11("HCPCS-ITEM")
"RTN","RMPRPIYS",54,0)
 S RMPRITXT("MASTER DESC")=RMPR11("ITEM MASTER")
"RTN","RMPRPIYS",55,0)
 S RMPRITXT("ITEM DESC")=RMPR11("DESCRIPTION")
"RTN","RMPRPIYS",56,0)
 S RMPRITXT("UNIT PRICE")=+$J(RMPR7("VALUE")/RMPR7("QUANTITY"),0,2)
"RTN","RMPRPIYS",57,0)
 S RMPRITXT("VENDOR")=RMPR6("VENDOR")
"RTN","RMPRPIYS",58,0)
 S RMPRITXT("LOCATION")=RMPR7("LOCATION")
"RTN","RMPRPIYS",59,0)
 ;
"RTN","RMPRPIYS",60,0)
 ;***** NLAB - call prompt for number of labels to print
"RTN","RMPRPIYS",61,0)
NLAB S RMPRNLAB=RMPR7("QUANTITY")
"RTN","RMPRPIYS",62,0)
 W ! D NLABP(.RMPRNLAB,RMPR7("QUANTITY"),.RMPREXC)
"RTN","RMPRPIYS",63,0)
 I RMPREXC="T" G PBX
"RTN","RMPRPIYS",64,0)
 I RMPREXC="P" G HCPCS
"RTN","RMPRPIYS",65,0)
 I RMPREXC="^" G HCPCS
"RTN","RMPRPIYS",66,0)
 ;
"RTN","RMPRPIYS",67,0)
 ;***** SELP - call prompt for bar code print device
"RTN","RMPRPIYS",68,0)
SELP D PRINT G HCPCS
"RTN","RMPRPIYS",69,0)
 G HCPCS
"RTN","RMPRPIYS",70,0)
PBX D KILL^XUSCLEAN
"RTN","RMPRPIYS",71,0)
 Q
"RTN","RMPRPIYS",72,0)
 ;
"RTN","RMPRPIYS",73,0)
 ;***** PRINT - print bar code labels
"RTN","RMPRPIYS",74,0)
 ;              requires RMPRNLAB (number of labels) and
"RTN","RMPRPIYS",75,0)
 ;                       RMPRBCP (bar code printer name) to be set
"RTN","RMPRPIYS",76,0)
 ;                       RMPRBARC (bar code to print)
"RTN","RMPRPIYS",77,0)
 ;                       RMPRIOP (the device to open)
"RTN","RMPRPIYS",78,0)
PRINT I '$D(RMPRNLAB) S RMPRNLAB=1
"RTN","RMPRPIYS",79,0)
 ;allows queing of bar code labels
"RTN","RMPRPIYS",80,0)
SELD S %ZIS("A")="Select Bar Code Printer: "
"RTN","RMPRPIYS",81,0)
 S %ZIS="QM" K IOP W ! D ^%ZIS G:POP PRINTX
"RTN","RMPRPIYS",82,0)
 I $G(IOST)'["P-ZEBRA" D
"RTN","RMPRPIYS",83,0)
 . W !!,"** WARNING - This is NOT a Zebra Bar Code Printer!!",!!
"RTN","RMPRPIYS",84,0)
 I '$D(IO("Q")) U IO G PNOW
"RTN","RMPRPIYS",85,0)
 K IO("Q") S ZTDESC="PRINT BAR CODE LABELS",ZTRTN="PNOW^RMPRPIYS"
"RTN","RMPRPIYS",86,0)
 S ZTIO=ION,ZTSAVE("RMPRBARC")="",ZTSAVE("RMPRITXT(")=""
"RTN","RMPRPIYS",87,0)
 S ZTSAVE("RMPRNLAB")="",ZTSAVE("RMPR(")="",ZTSAVE("RMPRSTN(")=""
"RTN","RMPRPIYS",88,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 2 G PRINTC
"RTN","RMPRPIYS",89,0)
 ;
"RTN","RMPRPIYS",90,0)
PNOW ;jump here if not queued.
"RTN","RMPRPIYS",91,0)
 D ZPLII^RMPRPI11(RMPRBARC,.RMPRITXT,RMPRNLAB)
"RTN","RMPRPIYS",92,0)
 S IONOFF=1
"RTN","RMPRPIYS",93,0)
PRINTC D ^%ZISC K IONOFF
"RTN","RMPRPIYS",94,0)
PRINTX Q
"RTN","RMPRPIYS",95,0)
 ;
"RTN","RMPRPIYS",96,0)
 ;***** NLABP - Number of labels prompt
"RTN","RMPRPIYS",97,0)
NLABP(RMPRNLAB,RMPRMAX,RMPREXC) ;
"RTN","RMPRPIYS",98,0)
 N RMPRERR,DIR,X,Y,DUOUT,DTOUT,DIROUT,DIRUT,DA
"RTN","RMPRPIYS",99,0)
 S RMPRNLAB=$G(RMPRNLAB)
"RTN","RMPRPIYS",100,0)
 S RMPRERR=0
"RTN","RMPRPIYS",101,0)
 S DIR(0)="NAO^1:"_RMPRMAX_":0"
"RTN","RMPRPIYS",102,0)
 S DIR("A")="Number of Labels to print: "
"RTN","RMPRPIYS",103,0)
 S:RMPRNLAB'="" DIR("B")=RMPRNLAB
"RTN","RMPRPIYS",104,0)
 S DIR("??")="^D NLABPH2^RMPRPIYS"
"RTN","RMPRPIYS",105,0)
 D ^DIR
"RTN","RMPRPIYS",106,0)
 I $D(DTOUT) S RMPREXC="T" G NLABPX
"RTN","RMPRPIYS",107,0)
 I $D(DIROUT) S RMPREXC="P" G NLABPX
"RTN","RMPRPIYS",108,0)
 I X=""!(X["^")!($D(DUOUT)) S RMPREXC="^" G NLABPX
"RTN","RMPRPIYS",109,0)
 S RMPREXC=""
"RTN","RMPRPIYS",110,0)
 S RMPRNLAB=+Y
"RTN","RMPRPIYS",111,0)
NLABPX Q
"RTN","RMPRPIYS",112,0)
NLABPH2 W "Type in the number of bar code labels you want to print for the",!
"RTN","RMPRPIYS",113,0)
 W "inventory item you have selected.",!
"RTN","RMPRPIYS",114,0)
 Q
"RTN","RMPRPIYS",115,0)
 ;
"RTN","RMPRPIYS",116,0)
 ;***** BARC - bar code prompt
"RTN","RMPRPIYS",117,0)
BARC(RMPRBARC,RMPREXC) ;
"RTN","RMPRPIYS",118,0)
 N RMPRERR,DIR,X,Y,DUOUT,DTOUT,DIROUT,DIRUT,DA
"RTN","RMPRPIYS",119,0)
 S RMPRBARC=""
"RTN","RMPRPIYS",120,0)
 S RMPREXC=""
"RTN","RMPRPIYS",121,0)
 S RMPRERR=0
"RTN","RMPRPIYS",122,0)
 S DIR(0)="FAO"
"RTN","RMPRPIYS",123,0)
 S DIR("A")="Scan in item bar code: "
"RTN","RMPRPIYS",124,0)
 S DIR("?")="^D BARCH^RMPRPIYS"
"RTN","RMPRPIYS",125,0)
BARC1 D ^DIR
"RTN","RMPRPIYS",126,0)
 I $D(DTOUT) S RMPREXC="T" G BARCX
"RTN","RMPRPIYS",127,0)
 I $D(DIROUT) S RMPREXC="P" G BARCX
"RTN","RMPRPIYS",128,0)
 I X["^"!($D(DUOUT)) S RMPREXC="^" G BARCX
"RTN","RMPRPIYS",129,0)
 I X="",$G(REDIT) G BARCX
"RTN","RMPRPIYS",130,0)
 I X="" G BARC1
"RTN","RMPRPIYS",131,0)
 S RMPRBARC=X
"RTN","RMPRPIYS",132,0)
BARCX Q
"RTN","RMPRPIYS",133,0)
BARCH W "If you have access to a bar code scanner, use it to scan the item bar code now.",!
"RTN","RMPRPIYS",134,0)
 W "Don't press the [Enter] key as the scanner should do this automatically.",!
"RTN","RMPRPIYS",135,0)
 W "If the scanner cannot read the bar code, type in the character sequence",!
"RTN","RMPRPIYS",136,0)
 W "immediately below the bar code.",!
"RTN","RMPRPIYS",137,0)
 ;W "If there is no bar code or you prefer to enter the transaction manually",!
"RTN","RMPRPIYS",138,0)
 ;W "leave this prompt blank.",!
"RTN","RMPRPIYS",139,0)
 Q
"RTN","RMPRPIYS",140,0)
 ;
"RTN","RMPRPIYS",141,0)
 ;***** SCAN - scan bar code and set up stock issue vars.
"RTN","RMPRPIYS",142,0)
 ;             (to be called by RMPRPIYI (too big))
"RTN","RMPRPIYS",143,0)
SCAN K RMPR7,RMPR7I,RMPR1,RMPR1I,RMPR11,RMPR11I,RMPR6,RMDAHC,RMITQTY
"RTN","RMPRPIYS",144,0)
SCAN1 D BARC(.RMPRBARC,.RMPREXC)
"RTN","RMPRPIYS",145,0)
 I RMPREXC'="" S RMPRBARC="" G SCANX
"RTN","RMPRPIYS",146,0)
 I RMPRBARC="" G SCANX
"RTN","RMPRPIYS",147,0)
 S RMPRBARC=$$UPCASE(RMPRBARC)
"RTN","RMPRPIYS",148,0)
 ;
"RTN","RMPRPIYS",149,0)
 ; If we get a good bar code then populate all the fields and go
"RTN","RMPRPIYS",150,0)
 ; straight to the Post/Edit prompt
"RTN","RMPRPIYS",151,0)
 K RMPR7
"RTN","RMPRPIYS",152,0)
 S (RMPR7("STATION"),RMPRSTN)=RMPR("STA")
"RTN","RMPRPIYS",153,0)
 S RMPR7("HCPCS")=$P(RMPRBARC,"-",1)
"RTN","RMPRPIYS",154,0)
 S RMDAHC=$O(^RMPR(661.1,"B",RMPR7("HCPCS"),0))
"RTN","RMPRPIYS",155,0)
 I $G(RMDAHC),$D(^RMPR(661.1,RMDAHC,0)),($P(^RMPR(661.1,RMDAHC,0),U,5)'=1) S RMDAHC=$P(^RMPR(661.1,RMDAHC,0),U,3)
"RTN","RMPRPIYS",156,0)
 I '$G(RMDAHC) W !,"** No HCPCS Selected or Unable to Select Inactive HCPCS..." G SCAN
"RTN","RMPRPIYS",157,0)
 S RMPR7("DATE&TIME")=$E($P(RMPRBARC,"-",2),1,7)_"."_$E($P(RMPRBARC,"-",2),8,$L(RMPRBARC))
"RTN","RMPRPIYS",158,0)
 ;
"RTN","RMPRPIYS",159,0)
 ; look up current stock record with bar coded key fields
"RTN","RMPRPIYS",160,0)
 S RMPRERR=$$SCAN^RMPRPIUA(.RMPR7,.RMPREXC)
"RTN","RMPRPIYS",161,0)
 I $G(RMPR7("IEN"))="" W !,"*** The Item scanned is not available, please update your inventory !!!" G SCAN1
"RTN","RMPRPIYS",162,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",163,0)
 S RMPRERR=$$ETOI^RMPRPIX7(.RMPR7,.RMPR7I)
"RTN","RMPRPIYS",164,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",165,0)
 S R1("DATE&TIME")=$G(RMPR7I("DATE&TIME"))
"RTN","RMPRPIYS",166,0)
 S $P(R1(0),U,8)=$G(RMPR7I("UNIT"))
"RTN","RMPRPIYS",167,0)
 ;
"RTN","RMPRPIYS",168,0)
 ; set vars. for HCPCS
"RTN","RMPRPIYS",169,0)
 K RMPR1,RMPR1I
"RTN","RMPRPIYS",170,0)
 S RMPR1("HCPCS")=RMPR7("HCPCS")
"RTN","RMPRPIYS",171,0)
 S RMPRERR=$$HPACT^RMPRPIX1(.RMPR1)
"RTN","RMPRPIYS",172,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",173,0)
 S RMPRERR=$$HPETOI^RMPRPIX1(.RMPR1,.RMPR1I)
"RTN","RMPRPIYS",174,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",175,0)
 ;
"RTN","RMPRPIYS",176,0)
 ; set vars. for Item
"RTN","RMPRPIYS",177,0)
 K RMPR11,RMPR11I
"RTN","RMPRPIYS",178,0)
 S RMPR11("STATION")=RMPR("STA")
"RTN","RMPRPIYS",179,0)
 S RMPR11("HCPCS")=RMPR7("HCPCS")
"RTN","RMPRPIYS",180,0)
 S RMPR11("ITEM")=RMPR7("ITEM")
"RTN","RMPRPIYS",181,0)
 S RMPRERR=$$GET^RMPRPIX1(.RMPR11)
"RTN","RMPRPIYS",182,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",183,0)
 S RMPRERR=$$ETOI^RMPRPIX1(.RMPR11,.RMPR11I)
"RTN","RMPRPIYS",184,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",185,0)
 I RMPR11I("ITEM MASTER IEN")="" D  G SCAN1
"RTN","RMPRPIYS",186,0)
 . W !,"This item is not associated with an IFCAP Item.",!
"RTN","RMPRPIYS",187,0)
 . W "Please use the Edit Inventory option before trying to issue this item."
"RTN","RMPRPIYS",188,0)
 . W !
"RTN","RMPRPIYS",189,0)
 . Q
"RTN","RMPRPIYS",190,0)
 ;S RMDAHC=RMPR1("IEN")
"RTN","RMPRPIYS",191,0)
 D CPT(RMDAHC_"^"_$P(R1(0),U,4)_"^"_RMPR11I("SOURCE")_"^660")
"RTN","RMPRPIYS",192,0)
 I RMPREXC="T" G SCANX
"RTN","RMPRPIYS",193,0)
 I RMPREXC'="" G SCAN1
"RTN","RMPRPIYS",194,0)
 ;
"RTN","RMPRPIYS",195,0)
 ; get Vendor
"RTN","RMPRPIYS",196,0)
 S RMPR6("DATE&TIME")=RMPR7I("DATE&TIME")
"RTN","RMPRPIYS",197,0)
 S RMPR6("HCPCS")=RMPR7("HCPCS")
"RTN","RMPRPIYS",198,0)
 S RMPR6("SEQUENCE")=RMPR7("SEQUENCE")
"RTN","RMPRPIYS",199,0)
 S RMPRERR=$$GET^RMPRPIX6(.RMPR6)
"RTN","RMPRPIYS",200,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",201,0)
 S RMPRERR=$$VNDIEN^RMPRPIX6(.RMPR6)
"RTN","RMPRPIYS",202,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",203,0)
 S $P(R1(0),U,9)=RMPR6("VENDOR IEN")
"RTN","RMPRPIYS",204,0)
 S $P(R3("D"),U,9)=RMPR6("VENDOR")
"RTN","RMPRPIYS",205,0)
 ;
"RTN","RMPRPIYS",206,0)
 ; set vars for issue
"RTN","RMPRPIYS",207,0)
 S RMCPTC=""
"RTN","RMPRPIYS",208,0)
 I $G(RMDAHC),$D(^RMPR(661.1,RMDAHC,0)) S RMCPTC=$P(^RMPR(661.1,RMDAHC,0),U,4)
"RTN","RMPRPIYS",209,0)
 S $P(R1(1),U,4)=RMDAHC
"RTN","RMPRPIYS",210,0)
 S $P(R1(0),U,22)=$G(RMCPTC)
"RTN","RMPRPIYS",211,0)
 S $P(R1(0),U,6)=RMPR11I("ITEM MASTER IEN")
"RTN","RMPRPIYS",212,0)
 S (RMHCNEW,RMHCDA)=RMDAHC
"RTN","RMPRPIYS",213,0)
 S RMITDA=RMPR11("IEN")
"RTN","RMPRPIYS",214,0)
 S RMHCPC=RMPR11("HCPCS")
"RTN","RMPRPIYS",215,0)
 S RMIT=RMPR11("HCPCS-ITEM")
"RTN","RMPRPIYS",216,0)
 S RDESC=RMPR1("SHORT DESC")
"RTN","RMPRPIYS",217,0)
 S $P(R3("D"),U,14)=RMPR11("SOURCE")
"RTN","RMPRPIYS",218,0)
 S RMSO=RMPR11I("SOURCE")
"RTN","RMPRPIYS",219,0)
 S $P(R1(0),U,14)=RMSO
"RTN","RMPRPIYS",220,0)
 S $P(R3("D"),U,6)=RMPR11("ITEM MASTER")
"RTN","RMPRPIYS",221,0)
 S $P(R1(0),U,6)=RMPR11I("ITEM MASTER IEN")
"RTN","RMPRPIYS",222,0)
 S $P(R1(2),U,1)=RMIT
"RTN","RMPRPIYS",223,0)
 S $P(R1(2),U,2)=RMPR11("DESCRIPTION")
"RTN","RMPRPIYS",224,0)
 S RMLOC=RMPR7I("LOCATION"),RMUBA=0,RMPR11("ITEM")=$P(RMIT,"-",2)
"RTN","RMPRPIYS",225,0)
 S RMPR11("LOCATION")=RMLOC,RMPR11("STATION")=RMPRSTN
"RTN","RMPRPIYS",226,0)
 I '$G(RMPR11("LOCATION")) S RMUBA=RMPR7("QUANTITY")
"RTN","RMPRPIYS",227,0)
 S:'$G(RMUBA) RMUBA=$$BAL^RMPRPIX7(.RMPR11)
"RTN","RMPRPIYS",228,0)
 S RMITQTY=RMPR7("QUANTITY")
"RTN","RMPRPIYS",229,0)
 K RMPR5
"RTN","RMPRPIYS",230,0)
 S RMPR5("IEN")=RMLOC
"RTN","RMPRPIYS",231,0)
 S RMPRUCST=RMPR7("VALUE")/RMPR7("QUANTITY")
"RTN","RMPRPIYS",232,0)
 S $P(R1(0),U,16)=$J(RMPRUCST,0,2)
"RTN","RMPRPIYS",233,0)
 S $P(R3("D"),U,16)=$J(RMPRUCST,0,2)
"RTN","RMPRPIYS",234,0)
 S $P(R1(0),U,7)=1   ;qty.
"RTN","RMPRPIYS",235,0)
 S $P(R1(0),U,11)="" ;serial num
"RTN","RMPRPIYS",236,0)
 S $P(R1(0),U,24)="" ;lot num
"RTN","RMPRPIYS",237,0)
 S $P(R1(0),U,18)="" ;remarks
"RTN","RMPRPIYS",238,0)
SCANX Q
"RTN","RMPRPIYS",239,0)
SCANE W !,"A problem has occurred with the scan, please try again.",!
"RTN","RMPRPIYS",240,0)
 Q
"RTN","RMPRPIYS",241,0)
 ;
"RTN","RMPRPIYS",242,0)
 ;***** CPT - prompt for CPT modifier
"RTN","RMPRPIYS",243,0)
 ; (extension of RMPRPIYI and to be used only by that routine)
"RTN","RMPRPIYS",244,0)
CPT(RDA) ;
"RTN","RMPRPIYS",245,0)
 N DIC,Y,RQUIT,X,DA,DIR,DUOUT,DTOUT
"RTN","RMPRPIYS",246,0)
 N RMPR1,RMPR11,RMPR11I,RMPR7,RMPR7I
"RTN","RMPRPIYS",247,0)
 S RMPREXC=""
"RTN","RMPRPIYS",248,0)
 D:$D(RMCPT) CHK^RMPRED5
"RTN","RMPRPIYS",249,0)
 W:$G(REDIT) !,"OLD CPT MODIFIER: ",$P(R1(1),U,6)
"RTN","RMPRPIYS",250,0)
 I RMHCOLD'=RMDAHC D CPT^RMPRCPTU(RDA)
"RTN","RMPRPIYS",251,0)
 I $D(DUOUT) S RMPREXC="^" G CPTX
"RTN","RMPRPIYS",252,0)
 I $D(DTOUT) S RMPREXC="T" G CPTX
"RTN","RMPRPIYS",253,0)
 S $P(R1(1),U,6)=$G(RMCPT)
"RTN","RMPRPIYS",254,0)
 W:$G(REDIT) !,"NEW CPT MODIFIER: ",$G(RMCPT)
"RTN","RMPRPIYS",255,0)
 I RMHCOLD'="",(RMHCOLD=RMDAHC),$G(REDIT) D
"RTN","RMPRPIYS",256,0)
 .S DIR(0)="Y",DIR("A")="Would you like to Edit CPT MODIFIER Entry  ",DIR("B")="N" D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","RMPRPIYS",257,0)
 .I $G(Y) D
"RTN","RMPRPIYS",258,0)
 ..D CPT^RMPRCPTU(RDA)
"RTN","RMPRPIYS",259,0)
 ..I $D(DUOUT) S RMPREXC="^"
"RTN","RMPRPIYS",260,0)
 ..I $D(DTOUT) S RMPREXC="T"
"RTN","RMPRPIYS",261,0)
 ..W:RMCPT=$P(R1(1),U,6) !!,"***Based on the information given above, CPT modifier string has not changed!!!",!
"RTN","RMPRPIYS",262,0)
 ..W:RMCPT'=$P(R1(1),U,6) !,"NEW CPT MODIFIER: ",$G(RMCPT)
"RTN","RMPRPIYS",263,0)
 ..S $P(R1(1),U,6)=$G(RMCPT)
"RTN","RMPRPIYS",264,0)
CPTX Q
"RTN","RMPRPIYS",265,0)
UPCASE(RMPRSTR) ;
"RTN","RMPRPIYS",266,0)
 Q $TR(RMPRSTR,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","RMPRSE21")
0^3^B29249805^B28209992
"RTN","RMPRSE21",1,0)
RMPRSE21 ;HINES CIOFO/HNB-SEARCH FILE 660 ENTRIES PSAS HCPCS HISTORY;1/23/1998
"RTN","RMPRSE21",2,0)
 ;;3.0;PROSTHETICS;**36,62,77,92,90,128**;Feb 09, 1996
"RTN","RMPRSE21",3,0)
 ; RVD patch #62 - add ICD9 code and Description in the output
"RTN","RMPRSE21",4,0)
 ; RVD patch #77 3/17/03 - use RMPR("STA") instead of $$STA^RMPRUTIL
"RTN","RMPRSE21",5,0)
 ;
"RTN","RMPRSE21",6,0)
 ; AAC Patch 92 08/03/04 - Code Set Versioning (CSV)
"RTN","RMPRSE21",7,0)
 ;                       - Used API=ICDDX^ICDCODE to replace direct calls to global ICD9(80).
"RTN","RMPRSE21",8,0)
 ;
"RTN","RMPRSE21",9,0)
EN S (ITEM,RMPRARR,RMPRI,RMPRDA)=""
"RTN","RMPRSE21",10,0)
 K KILL
"RTN","RMPRSE21",11,0)
 D HOME^%ZIS,DIV4^RMPRSIT G:$D(X) EXIT1
"RTN","RMPRSE21",12,0)
 W !!!
"RTN","RMPRSE21",13,0)
 S DIC="^RMPR(661.1,",DIC(0)="AEQM"
"RTN","RMPRSE21",14,0)
 F ITEM=1:1 S DIC("A")="Select PSAS HCPCS ("_ITEM_"): " D ^DIC G:$D(DTOUT)!(X["^")!(X=""&(ITEM=1)) EXIT1 Q:X=""  D
"RTN","RMPRSE21",15,0)
 .I $D(RMPRI(+Y)) W !,$C(7)," ??",?40,"..Duplicate PSAS HCPCS" S ITEM=ITEM-1 Q
"RTN","RMPRSE21",16,0)
 .S RMPRARR(ITEM)=+Y,RMPRI(+Y)=""
"RTN","RMPRSE21",17,0)
 S RMPRCOUN=0 W !! S %DT("A")="Beginning Date: ",%DT="AEPX",%DT("B")="T-30" D ^%DT S RMPRBDT=Y G:Y<0 EXIT1
"RTN","RMPRSE21",18,0)
ENDATE S %DT("A")="Ending Date: ",%DT="AEX",%DT("B")="TODAY"
"RTN","RMPRSE21",19,0)
 D ^%DT G:Y<0 EXIT1
"RTN","RMPRSE21",20,0)
 I RMPRBDT>Y W !,$C(7),"Invalid Date Range Selection!!" G ENDATE
"RTN","RMPRSE21",21,0)
 G:Y<0 EXIT
"RTN","RMPRSE21",22,0)
 S RMPREDT=Y,Y=RMPRBDT D DD^%DT S RMPRX=Y,Y=RMPREDT  D DD^%DT S RMPRY=Y
"RTN","RMPRSE21",23,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT
"RTN","RMPRSE21",24,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPRSE21",25,0)
 K IO("Q") S ZTDESC="SEARCH FOR PSAS HCPCS",ZTRTN="PRINT^RMPRSE21",ZTIO=ION,ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPRI(")="",ZTSAVE("RMPRX")="",ZTSAVE("RMPRY")="",ZTSAVE("RMPR(""STA"")")="",ZTSAVE("RMPRARR(")=""
"RTN","RMPRSE21",26,0)
 S ZTSAVE("RMPR(")="",ZTSAVE("RMPRSITE")=""
"RTN","RMPRSE21",27,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT1
"RTN","RMPRSE21",28,0)
PRINT ;ENTRY POINT FOR PRINTING REPORT
"RTN","RMPRSE21",29,0)
 S PAGE=1,(RMPRCOUN,RP,QTYT,COSTT)=0
"RTN","RMPRSE21",30,0)
 S RQ=0
"RTN","RMPRSE21",31,0)
 F  S RQ=$O(RMPRARR(RQ)) Q:RQ'>0!($D(KILL))  D  D REST
"RTN","RMPRSE21",32,0)
 .S RO=$P(RMPRARR(RQ),U,1),RO=RO-1
"RTN","RMPRSE21",33,0)
 .F  S RO=$O(^RMPR(660,"H",RO)) Q:RO'>0  D
"RTN","RMPRSE21",34,0)
 . .Q:RO=""!(RO'=$P(RMPRARR(RQ),U))!($D(KILL))
"RTN","RMPRSE21",35,0)
 . .K ENDD
"RTN","RMPRSE21",36,0)
 . .F  S RP=$O(^RMPR(660,"H",RO,RP)) Q:RP=""!($D(KILL))  D CK
"RTN","RMPRSE21",37,0)
 G EXIT
"RTN","RMPRSE21",38,0)
 Q
"RTN","RMPRSE21",39,0)
EXIT ;EXIT FROM REPORT HERE
"RTN","RMPRSE21",40,0)
 I RMPRCOUN>0,$D(RMPREDT),'$D(KILL) W !!?32,"END OF REPORT"
"RTN","RMPRSE21",41,0)
 I $E(IOST)["C"&($Y<22),'$D(ENDD) F  W ! Q:$Y>20
"RTN","RMPRSE21",42,0)
 I $D(RMPREDT),$E(IOST)["C",'$D(RMPRFLL),'$D(KILL),'$D(DUOUT),'$D(DTOUT),'$D(ENDD) K DIR S DIR(0)="E" D ^DIR
"RTN","RMPRSE21",43,0)
EXIT1 K RMPRARR,%DT,GOTO,QTYT,ITEM,KILL,ENDD,RQ,RP,RO,ITEM,RMPRI,COSTT,DIC,DIR,PAGE,RO,RMPRCOUN,RMPRSE,RMPRBDT,RMPREDT,RMPRX,RMPRY D ^%ZISC
"RTN","RMPRSE21",44,0)
 Q
"RTN","RMPRSE21",45,0)
CK Q:'$D(^RMPR(660,RP,0))
"RTN","RMPRSE21",46,0)
 ;hcpcs
"RTN","RMPRSE21",47,0)
 I ('$P(^RMPR(660,RP,1),U,4))!($P(^(0),U,3)<RMPRBDT)!($P(^(0),U,3)>RMPREDT)  Q
"RTN","RMPRSE21",48,0)
 I $P(^RMPR(660,RP,0),U,10)'=RMPR("STA") Q
"RTN","RMPRSE21",49,0)
 ;
"RTN","RMPRSE21",50,0)
 I $P(RMPRARR(RQ),U,1)=$P(^RMPR(660,RP,1),U,4) D CON
"RTN","RMPRSE21",51,0)
 Q
"RTN","RMPRSE21",52,0)
 ;
"RTN","RMPRSE21",53,0)
CON I $Y>(IOSL-6),PAGE=1,'RMPRCOUN W @IOF
"RTN","RMPRSE21",54,0)
 D HEAD S RMPRCOUN=RMPRCOUN+1
"RTN","RMPRSE21",55,0)
 S (RMPRDA,Y)=$P(^RMPR(660,RP,0),U,3) D DD^%DT
"RTN","RMPRSE21",56,0)
 W !,Y,?15,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,1),1,13),?30,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,9),6,9)
"RTN","RMPRSE21",57,0)
 W:$P(^RMPR(660,RP,0),U,9)'="" ?36,$E($P(^PRC(440,$P(^RMPR(660,RP,0),U,9),0),U,1),1,35)
"RTN","RMPRSE21",58,0)
 W !,"ITEM: " S ITMP=$P(^RMPR(660,RP,0),U,6)
"RTN","RMPRSE21",59,0)
 W:ITMP'="" $E($P(^PRC(441,$P(^RMPR(661,ITMP,0),U,1),0),U,2),1,20)
"RTN","RMPRSE21",60,0)
 K ITMP
"RTN","RMPRSE21",61,0)
 I $P(^RMPR(660,RP,0),U,13)=4 D
"RTN","RMPRSE21",62,0)
 .W ?27,"QTY: ",$J($P(^RMPR(660,RP,0),U,7),4),?38,"TOTAL COST: ",$J($FN($P(^("LB"),U,9),"P",2),8) S QTYT=QTYT+$P(^(0),U,7),COSTT=COSTT+$P(^("LB"),U,9)
"RTN","RMPRSE21",63,0)
 I $P(^RMPR(660,RP,0),U,13)'=4 W ?27,"QTY: ",$J($P(^RMPR(660,RP,0),U,7),4),?38,"TOTAL COST: ",$J($FN($P(^(0),U,16),"P",2),8) S QTYT=QTYT+$P(^(0),U,7),COSTT=COSTT+$P(^(0),U,16)
"RTN","RMPRSE21",64,0)
 W ?60,$S($P(^RMPR(660,RP,0),U,4)="I":"INITIAL ISSUE",$P(^(0),U,4)="R":"REPLACEMENT",$P(^(0),U,4)="S":"SPARE",$P(^(0),U,4)="X":"REPAIR",$P(^(0),U,4)="5":"RENTAL",1:"UNK"),!,"INITIATOR: "
"RTN","RMPRSE21",65,0)
 I $P(^RMPR(660,RP,0),U,27),$D(^VA(200,$P(^(0),U,27),0)) W ?15,$P(^(0),U)
"RTN","RMPRSE21",66,0)
 ;
"RTN","RMPRSE21",67,0)
 ; Patch 92 - Code Set Versioning (CSV) changes below
"RTN","RMPRSE21",68,0)
 ; AAC - 08/03/04
"RTN","RMPRSE21",69,0)
 ;
"RTN","RMPRSE21",70,0)
 S (RMPRICD,RMPRIC9,RMPRCOD,RMPRDAT)="" S RMPRERR=0
"RTN","RMPRSE21",71,0)
 S RMPRDAT=$P($G(^RMPR(660,RP,0)),U,1)
"RTN","RMPRSE21",72,0)
 I $D(^RMPR(660,RP,10)) S RMPRIC9=$P(^RMPR(660,RP,10),U,8)
"RTN","RMPRSE21",73,0)
 I RMPRIC9'=""  D
"RTN","RMPRSE21",74,0)
 .S RMPRICD=$$ICDDX^ICDCODE(RMPRIC9,RMPRDAT)
"RTN","RMPRSE21",75,0)
 .S RMPRERR=$P(RMPRICD,U,1)
"RTN","RMPRSE21",76,0)
 .I RMPRERR<0 W !,"ICD-9 Message: ",$P(RMPRICD,U,2)
"RTN","RMPRSE21",77,0)
 W !,"ICD-9 Code: "
"RTN","RMPRSE21",78,0)
 I $G(RMPRICD)'="" W $P(RMPRICD,U,2),?19,$E($P(RMPRICD,U,4),1,55) I $P(RMPRICD,U,10)'>0 W " ","** Inactive ** Date: " S Y=$P(RMPRICD,U,12) D DD^%DT W Y
"RTN","RMPRSE21",79,0)
 W !
"RTN","RMPRSE21",80,0)
 ;
"RTN","RMPRSE21",81,0)
 ; END PATCH 92
"RTN","RMPRSE21",82,0)
 ;
"RTN","RMPRSE21",83,0)
 I $E(IOST)["C"&($Y>(IOSL-6)) S DIR(0)="E" D ^DIR S:Y<1 KILL=1 Q:Y<1  K DIR W @IOF D HEAD Q
"RTN","RMPRSE21",84,0)
 I $Y>(IOSL-6) W @IOF D HEAD
"RTN","RMPRSE21",85,0)
 Q
"RTN","RMPRSE21",86,0)
 ;
"RTN","RMPRSE21",87,0)
HEAD I $Y<2!(PAGE=1) D
"RTN","RMPRSE21",88,0)
 .N RMPRSTAW
"RTN","RMPRSE21",89,0)
 .S RMPRSTAW=RMPR("STA")
"RTN","RMPRSE21",90,0)
 .I RMPRSTAW'="",$D(^DIC(4,RMPRSTAW,99)) S RMPRSTAW=$P(^DIC(4,RMPRSTAW,99),U)
"RTN","RMPRSE21",91,0)
 .W !,"PSAS HCPCS HISTORY:",?15
"RTN","RMPRSE21",92,0)
 .W $E($P(^RMPR(661.1,$P(^RMPR(660,RP,1),U,4),0),U,1),1,39)
"RTN","RMPRSE21",93,0)
 .W ?63,"STA ",RMPRSTAW,?72,"PAGE ",PAGE S PAGE=PAGE+1
"RTN","RMPRSE21",94,0)
 .W !!,"REQUEST DATE",?15,"PATIENT NAME",?30,"SSN",?36,"VENDOR"
"RTN","RMPRSE21",95,0)
 .S Y=RMPRBDT D DD^%DT W ?55,Y,"-" S Y=RMPREDT D DD^%DT W Y
"RTN","RMPRSE21",96,0)
 .W ! F BH=1:1:IOM W "="
"RTN","RMPRSE21",97,0)
 Q
"RTN","RMPRSE21",98,0)
 ;
"RTN","RMPRSE21",99,0)
REST D:'RMPRCOUN NONE Q:$D(KILL)!('RMPRCOUN)  W !,"TOTAL DOLLARS SPENT ON THIS HCPCS: ","$"_$J($FN(COSTT,"P",2),9),?45,"TOTAL QUANTITY ISSUED: ",$J(QTYT,4)
"RTN","RMPRSE21",100,0)
 I $O(RMPRARR(RQ)),$E(IOST)["C" W ! K DIR S DIR(0)="E" D ^DIR S:Y<1 KILL=1 W:'$D(KILL) @IOF
"RTN","RMPRSE21",101,0)
 I $E(IOST)'["C",$O(RMPRARR(RQ)) W @IOF
"RTN","RMPRSE21",102,0)
 S (COSTT,QTYT,RMPRCOUN)=""
"RTN","RMPRSE21",103,0)
 Q
"RTN","RMPRSE21",104,0)
 ;
"RTN","RMPRSE21",105,0)
NONE W @IOF,!!,"No '",$P(^RMPR(661.1,RMPRARR(RQ),0),U,1),"' PSAS HCPCS History for this date range.",!
"RTN","RMPRSE21",106,0)
 ;,$P(^PRC(441,$P(^RMPR(661,$P(RMPRARR(RQ),U),0),U),0),U,2)
"RTN","RMPRSE21",107,0)
 I $E(IOST)["C" K DIR S DIR(0)="E" W !!!! D ^DIR W @IOF S:Y<1 KILL=1 S ENDD=1
"RTN","RMPRSE21",108,0)
 Q
"RTN","RMPRSE21",109,0)
XREF ;set new x-ref for the field HCPCS in 660
"RTN","RMPRSE21",110,0)
 ;fix HCPCS VA117, REMOVE BLANK SPACE IN R90
"RTN","RMPRSE21",111,0)
 S $P(^RMPR(661.1,2801,0),U,6)="R90"
"RTN","RMPRSE21",112,0)
 W !!,"New Cross Reference for HCPCS..."
"RTN","RMPRSE21",113,0)
 S DIK="^RMPR(660,",DIK(1)="4.5^H" D ENALL^DIK
"RTN","RMPRSE21",114,0)
 W !!,"Done"
"RTN","RMPRSE21",115,0)
 Q
"RTN","RMPRSE21",116,0)
 ;END
"VER")
8.0^22.0
"BLD",6032,6)
^102
**END**
**END**
