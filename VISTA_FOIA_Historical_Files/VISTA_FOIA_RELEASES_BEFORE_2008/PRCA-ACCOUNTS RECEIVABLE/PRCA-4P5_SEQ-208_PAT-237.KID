EMERGENCY Released PRCA*4.5*237 SEQ #208
Extracted from mail message
**KIDS**:PRCA*4.5*237^

**INSTALL NAME**
PRCA*4.5*237
"BLD",6412,0)
PRCA*4.5*237^ACCOUNTS RECEIVABLE^0^3051123^y
"BLD",6412,1,0)
^^10^10^3051123^^^^
"BLD",6412,1,1,0)
This patch exempts interest and administrative charges 
"BLD",6412,1,2,0)
for Katrina affected veterans, calculated from 9/1/05
"BLD",6412,1,3,0)
to patch installation. It also suspends the addition of
"BLD",6412,1,4,0)
new interest and administrative charges for Katrina
"BLD",6412,1,5,0)
affected patients. It also suspends the printing of CCPC
"BLD",6412,1,6,0)
statements for those affected by Katrina.
"BLD",6412,1,7,0)
This patch also adds code to run the postinit to exempt 
"BLD",6412,1,8,0)
interest and administrative charges for newly flagged Katrina
"BLD",6412,1,9,0)
patients. This will run prior to the TOP, DMC and CCPC statements
"BLD",6412,1,10,0)
are generated.
"BLD",6412,4,0)
^9.64PA^^
"BLD",6412,"ABPKG")
n
"BLD",6412,"INIT")
RCYPO237
"BLD",6412,"KRN",0)
^9.67PA^8989.52^19
"BLD",6412,"KRN",.4,0)
.4
"BLD",6412,"KRN",.401,0)
.401
"BLD",6412,"KRN",.402,0)
.402
"BLD",6412,"KRN",.403,0)
.403
"BLD",6412,"KRN",.5,0)
.5
"BLD",6412,"KRN",.84,0)
.84
"BLD",6412,"KRN",3.6,0)
3.6
"BLD",6412,"KRN",3.8,0)
3.8
"BLD",6412,"KRN",9.2,0)
9.2
"BLD",6412,"KRN",9.8,0)
9.8
"BLD",6412,"KRN",9.8,"NM",0)
^9.68A^8^7
"BLD",6412,"KRN",9.8,"NM",1,0)
RCCPCPS^^0^B70423807
"BLD",6412,"KRN",9.8,"NM",2,0)
RCBECHGS^^0^B12081486
"BLD",6412,"KRN",9.8,"NM",3,0)
RCYPO237^^0^B33903672
"BLD",6412,"KRN",9.8,"NM",5,0)
RCCPCBJ^^0^B6288491
"BLD",6412,"KRN",9.8,"NM",6,0)
PRCABJ^^0^B31725810
"BLD",6412,"KRN",9.8,"NM",7,0)
RCDMC90^^0^B58237113
"BLD",6412,"KRN",9.8,"NM",8,0)
RCEXINAD^^0^B27913240
"BLD",6412,"KRN",9.8,"NM","B","PRCABJ",6)

"BLD",6412,"KRN",9.8,"NM","B","RCBECHGS",2)

"BLD",6412,"KRN",9.8,"NM","B","RCCPCBJ",5)

"BLD",6412,"KRN",9.8,"NM","B","RCCPCPS",1)

"BLD",6412,"KRN",9.8,"NM","B","RCDMC90",7)

"BLD",6412,"KRN",9.8,"NM","B","RCEXINAD",8)

"BLD",6412,"KRN",9.8,"NM","B","RCYPO237",3)

"BLD",6412,"KRN",19,0)
19
"BLD",6412,"KRN",19.1,0)
19.1
"BLD",6412,"KRN",101,0)
101
"BLD",6412,"KRN",409.61,0)
409.61
"BLD",6412,"KRN",771,0)
771
"BLD",6412,"KRN",870,0)
870
"BLD",6412,"KRN",8989.51,0)
8989.51
"BLD",6412,"KRN",8989.52,0)
8989.52
"BLD",6412,"KRN",8994,0)
8994
"BLD",6412,"KRN","B",.4,.4)

"BLD",6412,"KRN","B",.401,.401)

"BLD",6412,"KRN","B",.402,.402)

"BLD",6412,"KRN","B",.403,.403)

"BLD",6412,"KRN","B",.5,.5)

"BLD",6412,"KRN","B",.84,.84)

"BLD",6412,"KRN","B",3.6,3.6)

"BLD",6412,"KRN","B",3.8,3.8)

"BLD",6412,"KRN","B",9.2,9.2)

"BLD",6412,"KRN","B",9.8,9.8)

"BLD",6412,"KRN","B",19,19)

"BLD",6412,"KRN","B",19.1,19.1)

"BLD",6412,"KRN","B",101,101)

"BLD",6412,"KRN","B",409.61,409.61)

"BLD",6412,"KRN","B",771,771)

"BLD",6412,"KRN","B",870,870)

"BLD",6412,"KRN","B",8989.51,8989.51)

"BLD",6412,"KRN","B",8989.52,8989.52)

"BLD",6412,"KRN","B",8994,8994)

"BLD",6412,"QUES",0)
^9.62^^
"BLD",6412,"REQB",0)
^9.611^6^5
"BLD",6412,"REQB",1,0)
PRCA*4.5*153^1
"BLD",6412,"REQB",2,0)
PRCA*4.5*223^1
"BLD",6412,"REQB",3,0)
PRCA*4.5*236^1
"BLD",6412,"REQB",5,0)
PRCA*4.5*217^1
"BLD",6412,"REQB",6,0)
PRCA*4.5*201^1
"BLD",6412,"REQB","B","PRCA*4.5*153",1)

"BLD",6412,"REQB","B","PRCA*4.5*201",6)

"BLD",6412,"REQB","B","PRCA*4.5*217",5)

"BLD",6412,"REQB","B","PRCA*4.5*223",2)

"BLD",6412,"REQB","B","PRCA*4.5*236",3)

"INIT")
RCYPO237
"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
237^3051123^1258
"PKG",142,22,1,"PAH",1,1,0)
^^10^10^3051123
"PKG",142,22,1,"PAH",1,1,1,0)
This patch exempts interest and administrative charges 
"PKG",142,22,1,"PAH",1,1,2,0)
for Katrina affected veterans, calculated from 9/1/05
"PKG",142,22,1,"PAH",1,1,3,0)
to patch installation. It also suspends the addition of
"PKG",142,22,1,"PAH",1,1,4,0)
new interest and administrative charges for Katrina
"PKG",142,22,1,"PAH",1,1,5,0)
affected patients. It also suspends the printing of CCPC
"PKG",142,22,1,"PAH",1,1,6,0)
statements for those affected by Katrina.
"PKG",142,22,1,"PAH",1,1,7,0)
This patch also adds code to run the postinit to exempt 
"PKG",142,22,1,"PAH",1,1,8,0)
interest and administrative charges for newly flagged Katrina
"PKG",142,22,1,"PAH",1,1,9,0)
patients. This will run prior to the TOP, DMC and CCPC statements
"PKG",142,22,1,"PAH",1,1,10,0)
are generated.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","PRCABJ")
0^6^B31725810
"RTN","PRCABJ",1,0)
PRCABJ ;WASH-ISC@ALTOONA,PA/LDB,TJK-NIGHTLY PROCESS FOR ACCOUNTS RECEIVABLE ;11/8/96  3:54 PM
"RTN","PRCABJ",2,0)
 ;;4.5;Accounts Receivable;**11,34,101,114,155,153,141,165,167,173,201,237**;Mar 20, 1995
"RTN","PRCABJ",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCABJ",4,0)
 ;
"RTN","PRCABJ",5,0)
 ;This routine is called by the PRCA NIGHTLY PROCESS option which should be run nightly to call the following tasks
"RTN","PRCABJ",6,0)
 ;1) Update of interest/admin charges on patients' accounts
"RTN","PRCABJ",7,0)
 ;2) Update statement days
"RTN","PRCABJ",8,0)
 ;3) Print of Patient Statements, Uniform Billing forms, and non-patient follow-up letters
"RTN","PRCABJ",9,0)
 ;4) Purge of Receipts
"RTN","PRCABJ",10,0)
 ;5) Creation of TOP (Treasury Offset Program) documents
"RTN","PRCABJ",11,0)
 ;6) Print of the Follow-up list
"RTN","PRCABJ",12,0)
 ;7) Purge AR Events
"RTN","PRCABJ",13,0)
 ;8) Flag prepayments for refund review
"RTN","PRCABJ",14,0)
 ;9) Print Comment List
"RTN","PRCABJ",15,0)
 ;10) Starts the Repayment Plan Monitor
"RTN","PRCABJ",16,0)
 ;11) Generates Diagnostic Measures Workload Reports
"RTN","PRCABJ",17,0)
 ;12) Matches EFT with ERA
"RTN","PRCABJ",18,0)
 ;13) Generates CBO Data Extract files for Boston ARC
"RTN","PRCABJ",19,0)
 ;
"RTN","PRCABJ",20,0)
 ;Process will first check and Validate AR pointer files 341.1,
"RTN","PRCABJ",21,0)
 ;430.2, and 430.3.
"RTN","PRCABJ",22,0)
 ;Process will terminate and send bulletin if files are not valid
"RTN","PRCABJ",23,0)
 ;
"RTN","PRCABJ",24,0)
EN ;Start of nightly process-check to see if process is already running
"RTN","PRCABJ",25,0)
 L +^RC("PRCABJ"):5 Q:'$T
"RTN","PRCABJ",26,0)
 NEW ERROR S ERROR=0
"RTN","PRCABJ",27,0)
 D VERIFY I ERROR L -^RC("PRCABJ") Q
"RTN","PRCABJ",28,0)
 ;
"RTN","PRCABJ",29,0)
DRIVER ;All processes are called from this point
"RTN","PRCABJ",30,0)
 N CHK,POP,% S CHK=0
"RTN","PRCABJ",31,0)
 D CHK,INT,CHK,EN^RCCPCBJ,CHK,STM,CHK,RECPT,CHK,TOP,CHK,EVNT,CHK,BNUM
"RTN","PRCABJ",32,0)
 D CHK,ENUM,CHK,PURFMS,CHK,EN3^RCFMOBR,CHK,START^RCRJR,CHK,UB
"RTN","PRCABJ",33,0)
 D CHK,STATMNT,CHK,UDLIST^PRCABJ1,CHK,LIST,CHK,COMMENT,CHK,REPAY
"RTN","PRCABJ",34,0)
 D CHK,WRKLD,CHK,EFT,CHK,CBO
"RTN","PRCABJ",35,0)
 D NOW^%DTC S $P(^RC(342,1,0),"^",10)=%
"RTN","PRCABJ",36,0)
 L -^RC("PRCABJ")
"RTN","PRCABJ",37,0)
 K ^RC("PRCABJ")
"RTN","PRCABJ",38,0)
 Q
"RTN","PRCABJ",39,0)
 ;
"RTN","PRCABJ",40,0)
CHK ;checkpoint of process
"RTN","PRCABJ",41,0)
 S CHK=CHK+1 S ^RC("PRCABJ")=CHK
"RTN","PRCABJ",42,0)
 Q
"RTN","PRCABJ",43,0)
 ;
"RTN","PRCABJ",44,0)
VERIFY ;Verifies Pointer Files--Will HALT Process if Pointer Files Invalid
"RTN","PRCABJ",45,0)
 NEW A,B,FILE
"RTN","PRCABJ",46,0)
 F FILE=341.1,430.2,430.3 D  Q:ERROR
"RTN","PRCABJ",47,0)
    .S A=$S(FILE=341.1:"AC;0;2",FILE=430.2:"AC;0;7",1:"AC;0;3")
"RTN","PRCABJ",48,0)
    .S B=$S(FILE=341.1:"",1:"C;0;2")
"RTN","PRCABJ",49,0)
    .D EN1^PRCABJV(FILE,A,B,.ERROR)
"RTN","PRCABJ",50,0)
    .Q:'ERROR
"RTN","PRCABJ",51,0)
    .;SEND BULLETIN HERE IF FILE IN ERROR
"RTN","PRCABJ",52,0)
    .NEW XMB,XMTEXT,XMDUZ
"RTN","PRCABJ",53,0)
    .S XMDUZ="ACCOUNTS RECEIVABLE PACKAGE"
"RTN","PRCABJ",54,0)
    .S XMB="PRCA NIGHTLY PROCESS ABORT"
"RTN","PRCABJ",55,0)
    .S XMTEXT="ERROR("
"RTN","PRCABJ",56,0)
    .D ^XMB
"RTN","PRCABJ",57,0)
    .Q
"RTN","PRCABJ",58,0)
 Q
"RTN","PRCABJ",59,0)
 ;
"RTN","PRCABJ",60,0)
INT ;  update interest and admin charges for non-benefit debts
"RTN","PRCABJ",61,0)
 ;  example: vendor, employee, ex-employee
"RTN","PRCABJ",62,0)
 D NONBENE^RCBECHGS
"RTN","PRCABJ",63,0)
 Q
"RTN","PRCABJ",64,0)
 ;
"RTN","PRCABJ",65,0)
STM ;Update statement days for PERSONS, VENDORS, and Institutions
"RTN","PRCABJ",66,0)
 D STM^PRCABJ1
"RTN","PRCABJ",67,0)
 Q
"RTN","PRCABJ",68,0)
 ;
"RTN","PRCABJ",69,0)
STATMNT ;Print patient statements
"RTN","PRCABJ",70,0)
 N IOP,ZTIO,ZTSAVE,ZTRTN,ZTDESC,ZTASK,%ZIS,ZTDTH,PRCADEV
"RTN","PRCABJ",71,0)
 S (IOP,PRCADEV)=$P($G(^RC(342,1,0)),"^",8)
"RTN","PRCABJ",72,0)
 I IOP]"" D
"RTN","PRCABJ",73,0)
 .S ZTRTN="PRCAGS",ZTDTH=$H,ZTDESC="Print AR Statements/Letters"
"RTN","PRCABJ",74,0)
 .S %ZIS="N0" D ^%ZIS Q:POP
"RTN","PRCABJ",75,0)
 .S ZTSAVE("PRCADEV")="" D ^%ZTLOAD,^%ZISC
"RTN","PRCABJ",76,0)
 Q
"RTN","PRCABJ",77,0)
 ;
"RTN","PRCABJ",78,0)
RECPT ;Manage Receipts and Deposits
"RTN","PRCABJ",79,0)
 N IOP,ZTIO,ZTSAVE,ZTRTN,ZTDESC,ZTASK,%ZIS,ZTDTH
"RTN","PRCABJ",80,0)
 S ZTIO="",ZTRTN="MAN^RCDPUT",ZTDTH=$H,ZTDESC="Manage Receipts and Deposits"
"RTN","PRCABJ",81,0)
 D ^%ZTLOAD
"RTN","PRCABJ",82,0)
 Q
"RTN","PRCABJ",83,0)
 ;
"RTN","PRCABJ",84,0)
TOP ;Transmit TOP documents
"RTN","PRCABJ",85,0)
 Q:$$DOW^XLFDT(DT,1)'=1
"RTN","PRCABJ",86,0)
 I DT'<$P($G(^RC(342,1,30)),"^",1)&(DT'>$P($G(^RC(342,1,30)),"^",2)) D ^RCEXINAD
"RTN","PRCABJ",87,0)
 N RCM,RCDOC
"RTN","PRCABJ",88,0)
 ;Run of TOP documents every Monday
"RTN","PRCABJ",89,0)
 I +$E(DT,6,7)>7,$E(DT,6,7)<15 S RCM=1
"RTN","PRCABJ",90,0)
 I '$D(^RCD(340,"TOP")),'$G(RCM) Q
"RTN","PRCABJ",91,0)
 S RCDOC=$S($G(RCM):"M",1:"U")
"RTN","PRCABJ",92,0)
 I $E(DT,4,5)=12,RCDOC="M" S RCDOC="Y"
"RTN","PRCABJ",93,0)
TOPQUE N ZTDESC,ZTASK,ZTDTH,ZTIO,ZTRTN,ARDUZ,ZTSAVE
"RTN","PRCABJ",94,0)
 S ZTIO="",ZTRTN="^RCTOPD",ZTSAVE("RCDOC")=""
"RTN","PRCABJ",95,0)
 S ZTDESC="TOP REFERRAL DOCUMENTS",ZTDTH=$H
"RTN","PRCABJ",96,0)
 D ^%ZTLOAD
"RTN","PRCABJ",97,0)
 Q
"RTN","PRCABJ",98,0)
 ;
"RTN","PRCABJ",99,0)
UB ;Print Uniform Billing forms
"RTN","PRCABJ",100,0)
 N IOP,ZTIO,ZTSAVE,ZTRTN,ZTDESC,ZTASK,%ZIS,ZTDTH
"RTN","PRCABJ",101,0)
 S ZTIO="",ZTRTN="PRCALT2",ZTDTH=$H,ZTDESC="Print Reimbursable Health Insurance Uniform Billing forms"
"RTN","PRCABJ",102,0)
 D ^%ZTLOAD,^%ZISC
"RTN","PRCABJ",103,0)
 Q
"RTN","PRCABJ",104,0)
 ;
"RTN","PRCABJ",105,0)
LIST ;Print Follow-up List
"RTN","PRCABJ",106,0)
 N IOP,ZTIO,ZTSAVE,ZTRTN,ZTDESC,ZTASK,%ZIS,ZTDTH,BEG,END,PRCADEV
"RTN","PRCABJ",107,0)
 S IOP=$P($G(^RC(342,1,0)),"^",8)
"RTN","PRCABJ",108,0)
 I IOP]"" D
"RTN","PRCABJ",109,0)
 .S %ZIS="N0" D ^%ZIS Q:POP
"RTN","PRCABJ",110,0)
 .S ZTRTN="DQ1^PRCACM",ZTDTH=$H,PRCADEV=ION_";"_IOST_";"_IOM_";"_IOSL_";"_$G(IO("DOC"))
"RTN","PRCABJ",111,0)
 .S (ZTSAVE("BEG"),ZTSAVE("END"))=DT,ZTSAVE("PRCADEV")="",ZTDESC="Bill Comment Follow-Up List"
"RTN","PRCABJ",112,0)
 .D ^%ZTLOAD,^%ZISC
"RTN","PRCABJ",113,0)
 Q
"RTN","PRCABJ",114,0)
 ;
"RTN","PRCABJ",115,0)
COMMENT ;Print Comment List
"RTN","PRCABJ",116,0)
 N IOP,ZTIO,ZTSAVE,ZTRTN,ZTDESC,ZTASK,%ZIS,ZTDTH,BEG,END,PRCADEV
"RTN","PRCABJ",117,0)
 S IOP=$P($G(^RC(342,1,0)),"^",8)
"RTN","PRCABJ",118,0)
 I IOP]"" D
"RTN","PRCABJ",119,0)
 .S %ZIS="N0" D ^%ZIS Q:POP
"RTN","PRCABJ",120,0)
 .S ZTRTN="DQ2^PRCACM",ZTDTH=$H,PRCADEV=ION_";"_IOST_";"_IOM_";"_IOSL_";"_$G(IO("DOC"))
"RTN","PRCABJ",121,0)
 .S (ZTSAVE("BEG"),ZTSAVE("END"))=DT,ZTSAVE("PRCADEV")="",ZTDESC="Debtor Comment Follow-up List"
"RTN","PRCABJ",122,0)
 .D ^%ZTLOAD,^%ZISC
"RTN","PRCABJ",123,0)
 Q
"RTN","PRCABJ",124,0)
 ;
"RTN","PRCABJ",125,0)
REPAY ; Starts the Repayment Plan Monitor
"RTN","PRCABJ",126,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","PRCABJ",127,0)
 S ZTIO="",ZTRTN="EN^RCDMB1MT",ZTDTH=$H,ZTDESC="Repayment Plan Monitor"
"RTN","PRCABJ",128,0)
 D ^%ZTLOAD
"RTN","PRCABJ",129,0)
 Q
"RTN","PRCABJ",130,0)
 ;
"RTN","PRCABJ",131,0)
WRKLD ; Generates Diagnostic Measures Workload Reports
"RTN","PRCABJ",132,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","PRCABJ",133,0)
 S ZTIO="",ZTRTN="DQ^RCDMBWLR",ZTDTH=$H,ZTDESC="Diagnostic Measures Workload Reports"
"RTN","PRCABJ",134,0)
 D ^%ZTLOAD
"RTN","PRCABJ",135,0)
 Q
"RTN","PRCABJ",136,0)
 ;
"RTN","PRCABJ",137,0)
EVNT ;Purge AR Events
"RTN","PRCABJ",138,0)
 N IOP,ZTIO,ZTDESC,ZTASK,ZTIO,ZTRTN,ZTSAVE,%ZIS
"RTN","PRCABJ",139,0)
 S ZTIO="",ZTRTN="PUR^RCEVDRV1",ZTDTH=$H,ZTDESC="Purge AR Event Information" D ^%ZTLOAD
"RTN","PRCABJ",140,0)
 Q
"RTN","PRCABJ",141,0)
PURFMS ;Purge FMS documents
"RTN","PRCABJ",142,0)
 NEW ZTRTN,ZTIO,ZTDTH,ZTSK,ZTDESC
"RTN","PRCABJ",143,0)
 S ZTIO="",ZTRTN="EN^RCFMPUR",ZTDESC="AR/FMS DOC PURGE",ZTDTH=$H D ^%ZTLOAD
"RTN","PRCABJ",144,0)
 Q
"RTN","PRCABJ",145,0)
 ;
"RTN","PRCABJ",146,0)
EFT ; Starts matching of EFTs to EOBs job
"RTN","PRCABJ",147,0)
 NEW ZTRTN,ZTIO,ZTDTH,ZTSK,ZTDESC
"RTN","PRCABJ",148,0)
 S ZTIO="",ZTRTN="EN^RCDPEM",ZTDESC="AR/EDI LOCKBOX MATCHING EFTs",ZTDTH=$H D ^%ZTLOAD
"RTN","PRCABJ",149,0)
 Q
"RTN","PRCABJ",150,0)
 ;
"RTN","PRCABJ",151,0)
BNUM ;Check bill numbering series
"RTN","PRCABJ",152,0)
 I $P(^RC(342,1,0),"^",3)="" S $P(^RC(342,1,0),"^",3)="K"_$E($$FY^RCFN01,2)_"00000"
"RTN","PRCABJ",153,0)
 I $E($P(^RC(342,1,0),"^",3),2)'=$E($$FY^RCFN01,2) S $P(^RC(342,1,0),"^",3)="K"_$E($$FY^RCFN01,2)_"00000"
"RTN","PRCABJ",154,0)
 Q
"RTN","PRCABJ",155,0)
ENUM ;Check event numbering series
"RTN","PRCABJ",156,0)
 I $P(^RC(342,1,0),"^",6)="" S $P(^RC(342,1,0),"^",6)="K"_$E($$FY^RCFN01,2)_"A0000"
"RTN","PRCABJ",157,0)
 I $E($P(^RC(342,1,0),"^",6),2)'=$E($$FY^RCFN01,2) S $P(^RC(342,1,0),"^",6)="K"_$E($$FY^RCFN01,2)_"A0000"
"RTN","PRCABJ",158,0)
 Q
"RTN","PRCABJ",159,0)
 ;
"RTN","PRCABJ",160,0)
CBO ; Create Extract Files for ARC
"RTN","PRCABJ",161,0)
 NEW ZTRTN,ZTIO,ZTDTH,ZTSK,ZTDESC
"RTN","PRCABJ",162,0)
 S ZTIO="",ZTRTN="EN^RCXVTSK",ZTDESC="CBO DATA EXTRACT",ZTDTH=$H
"RTN","PRCABJ",163,0)
 D ^%ZTLOAD
"RTN","PRCABJ",164,0)
 Q
"RTN","RCBECHGS")
0^2^B12081486
"RTN","RCBECHGS",1,0)
RCBECHGS ;WISC/RFJ-add charges to an account or bill (top routine) ;1 Jun 00
"RTN","RCBECHGS",2,0)
 ;;4.5;Accounts Receivable;**153,237**;Mar 20, 1995
"RTN","RCBECHGS",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCBECHGS",4,0)
 Q
"RTN","RCBECHGS",5,0)
 ;
"RTN","RCBECHGS",6,0)
 ;
"RTN","RCBECHGS",7,0)
FIRSTPTY ;  add int/admin charges to all benefit debts
"RTN","RCBECHGS",8,0)
 ;  this entry point is called from CCPC on the
"RTN","RCBECHGS",9,0)
 ;  statement day
"RTN","RCBECHGS",10,0)
 ;  variable rclasdat passed equal to statement date
"RTN","RCBECHGS",11,0)
 ;
"RTN","RCBECHGS",12,0)
 N RCDEBTDA
"RTN","RCBECHGS",13,0)
 K ^TMP("RCBECHGS REPORT",$J)  ;used to generate mailman report
"RTN","RCBECHGS",14,0)
 ;
"RTN","RCBECHGS",15,0)
 ;  check statement date
"RTN","RCBECHGS",16,0)
 I +$E(RCLASDAT,6,7)'=+$P($G(^RC(342,1,0)),"^",11) Q
"RTN","RCBECHGS",17,0)
 ;
"RTN","RCBECHGS",18,0)
 ;  lock the int/admin update to prevent two jobs from applying
"RTN","RCBECHGS",19,0)
 ;  the charges at the same time
"RTN","RCBECHGS",20,0)
 L +^RCD(340,"RCBECHGS")
"RTN","RCBECHGS",21,0)
 ;
"RTN","RCBECHGS",22,0)
 S RCDEBTDA=0 F  S RCDEBTDA=$O(^RCD(340,"AB","DPT(",RCDEBTDA)) Q:'RCDEBTDA  D CHGACCT(RCDEBTDA,RCLASDAT)
"RTN","RCBECHGS",23,0)
 ;
"RTN","RCBECHGS",24,0)
 ;  clear the lock
"RTN","RCBECHGS",25,0)
 L -^RCD(340,"RCBECHGS")
"RTN","RCBECHGS",26,0)
 ;
"RTN","RCBECHGS",27,0)
 ;  generate mailman report showing all charges added
"RTN","RCBECHGS",28,0)
 D REPORT^RCBECHGU
"RTN","RCBECHGS",29,0)
 ;
"RTN","RCBECHGS",30,0)
 K ^TMP("RCBECHGS REPORT",$J)
"RTN","RCBECHGS",31,0)
 Q
"RTN","RCBECHGS",32,0)
 ;
"RTN","RCBECHGS",33,0)
 ;
"RTN","RCBECHGS",34,0)
NONBENE ;  add int/adm/penalty charges to all non-benefit debts
"RTN","RCBECHGS",35,0)
 ;  this includes vendor, employee, ex-employee.
"RTN","RCBECHGS",36,0)
 ;  this is called by prcabj.  it does not update first party
"RTN","RCBECHGS",37,0)
 ;  debts since they work off a set statement day where as
"RTN","RCBECHGS",38,0)
 ;  non-benefit debts could be any statement day.
"RTN","RCBECHGS",39,0)
 ;
"RTN","RCBECHGS",40,0)
 N RCDEBTDA,RCLASDAT
"RTN","RCBECHGS",41,0)
 K ^TMP("RCBECHGS REPORT",$J)  ;used to generate mailman report
"RTN","RCBECHGS",42,0)
 ;
"RTN","RCBECHGS",43,0)
 ;  lock the int/admin update to prevent two jobs from applying
"RTN","RCBECHGS",44,0)
 ;  the charges at the same time
"RTN","RCBECHGS",45,0)
 L +^RCD(340,"RCBECHGS")
"RTN","RCBECHGS",46,0)
 ;
"RTN","RCBECHGS",47,0)
 ;  get the last date the system was last updated
"RTN","RCBECHGS",48,0)
 S RCLASDAT=$P($P(^RC(342,1,0),"^",10),".")
"RTN","RCBECHGS",49,0)
 ;  loop all days from the last update date up to today
"RTN","RCBECHGS",50,0)
 ;  this will make sure all accounts are updated for missed days
"RTN","RCBECHGS",51,0)
 F  S RCLASDAT=$$FMADD^XLFDT(RCLASDAT,1) Q:RCLASDAT>DT  D
"RTN","RCBECHGS",52,0)
 .   S RCDEBTDA=0
"RTN","RCBECHGS",53,0)
 .   F  S RCDEBTDA=$O(^RCD(340,"AC",+$E(RCLASDAT,6,7),RCDEBTDA)) Q:'RCDEBTDA  D
"RTN","RCBECHGS",54,0)
 .   .   ;  do not look at first party debts here
"RTN","RCBECHGS",55,0)
 .   .   I $P($G(^RCD(340,RCDEBTDA,0)),"^")["DPT(" Q
"RTN","RCBECHGS",56,0)
 .   .   ;  add int/admin to non-benefit debts
"RTN","RCBECHGS",57,0)
 .   .   D CHGACCT(RCDEBTDA,RCLASDAT)
"RTN","RCBECHGS",58,0)
 ;
"RTN","RCBECHGS",59,0)
 ;  clear the lock
"RTN","RCBECHGS",60,0)
 L -^RCD(340,"RCBECHGS")
"RTN","RCBECHGS",61,0)
 ;
"RTN","RCBECHGS",62,0)
 ;  generate mailman report showing all charges added
"RTN","RCBECHGS",63,0)
 D REPORT^RCBECHGU
"RTN","RCBECHGS",64,0)
 ;
"RTN","RCBECHGS",65,0)
 K ^TMP("RCBECHGS REPORT",$J)
"RTN","RCBECHGS",66,0)
 Q
"RTN","RCBECHGS",67,0)
 ;
"RTN","RCBECHGS",68,0)
 ;
"RTN","RCBECHGS",69,0)
CHGACCT(RCDEBTDA,RCUPDATE) ;  get bills for debtor and add charges
"RTN","RCBECHGS",70,0)
 ;  for a given date in rcupdate
"RTN","RCBECHGS",71,0)
 N DAYSINT,DFN,FROMDATE,RCBILLDA,RCDATA0,RCDATA6,RCDATE,RCLASTDT,RCSTATUS,VA,VADM,VAERR,X
"RTN","RCBECHGS",72,0)
 S RCDATA0=$G(^RCD(340,RCDEBTDA,0))
"RTN","RCBECHGS",73,0)
 ;  do not add charges for insurance companies
"RTN","RCBECHGS",74,0)
 I $P(RCDATA0,"^")["DIC(36" Q
"RTN","RCBECHGS",75,0)
 ;  if first party and patient is dead, do not add charges
"RTN","RCBECHGS",76,0)
 I $P(RCDATA0,"^")["DPT(" S DFN=+$P(RCDATA0,"^") D DEM^VADPT I +VADM(6) Q
"RTN","RCBECHGS",77,0)
 ;If Emergency Response Indicator flag is set quit out, do not add charges.
"RTN","RCBECHGS",78,0)
 I $P(RCDATA0,"^")["DPT(",$$EMERES^PRCAUTL(+$P(RCDATA0,"^"))]"" Q
"RTN","RCBECHGS",79,0)
 ;  lock the debtor to show charges being applied
"RTN","RCBECHGS",80,0)
 L +^RCD(340,RCDEBTDA)
"RTN","RCBECHGS",81,0)
 ;
"RTN","RCBECHGS",82,0)
 ;  loop thru all bills in active (16) and suspended (40) status
"RTN","RCBECHGS",83,0)
 ;  build a list of bills sorted by the date bill prepared
"RTN","RCBECHGS",84,0)
 K ^TMP("RCBECHGS",$J)
"RTN","RCBECHGS",85,0)
 F RCSTATUS=16,40 D
"RTN","RCBECHGS",86,0)
 .   S RCBILLDA=0 F  S RCBILLDA=$O(^PRCA(430,"AS",RCDEBTDA,RCSTATUS,RCBILLDA)) Q:'RCBILLDA  D
"RTN","RCBECHGS",87,0)
 .   .   ;  hold letter date (field 21) is set for bill
"RTN","RCBECHGS",88,0)
 .   .   I $G(^PRCA(430,RCBILLDA,1)) Q
"RTN","RCBECHGS",89,0)
 .   .   ;  no letter1 sent
"RTN","RCBECHGS",90,0)
 .   .   I '$G(^PRCA(430,RCBILLDA,6)) Q
"RTN","RCBECHGS",91,0)
 .   .   ;  no principal balance
"RTN","RCBECHGS",92,0)
 .   .   I '$P($G(^PRCA(430,RCBILLDA,7)),"^") Q
"RTN","RCBECHGS",93,0)
 .   .   ;  no date bill prepared
"RTN","RCBECHGS",94,0)
 .   .   I '$P(^PRCA(430,RCBILLDA,0),"^",10) Q
"RTN","RCBECHGS",95,0)
 .   .   ;  store the bills in date prepared order
"RTN","RCBECHGS",96,0)
 .   .   S ^TMP("RCBECHGS",$J,"LIST",$P(^PRCA(430,RCBILLDA,0),"^",10),RCBILLDA)=""
"RTN","RCBECHGS",97,0)
 ;
"RTN","RCBECHGS",98,0)
 ;  *** calculate interest ***
"RTN","RCBECHGS",99,0)
 D INTEREST^RCBECHGI
"RTN","RCBECHGS",100,0)
 ;
"RTN","RCBECHGS",101,0)
 ;  *** calculate admin ***
"RTN","RCBECHGS",102,0)
 D ADMIN^RCBECHGA
"RTN","RCBECHGS",103,0)
 ;
"RTN","RCBECHGS",104,0)
 ;  *** calculate penalty ***
"RTN","RCBECHGS",105,0)
 ;  penalty charges are not assessed on a first party account
"RTN","RCBECHGS",106,0)
 I $P(RCDATA0,"^")'["DPT(" D PENALTY^RCBECHGP
"RTN","RCBECHGS",107,0)
 ;
"RTN","RCBECHGS",108,0)
 ;  *** add charges to bills for this account ***
"RTN","RCBECHGS",109,0)
 D ADDCHARG^RCBECHGU
"RTN","RCBECHGS",110,0)
 ;
"RTN","RCBECHGS",111,0)
 ;  clear the lock on the debtor
"RTN","RCBECHGS",112,0)
 L -^RCD(340,RCDEBTDA)
"RTN","RCBECHGS",113,0)
 ;
"RTN","RCBECHGS",114,0)
 K ^TMP("RCBECHGS",$J)
"RTN","RCBECHGS",115,0)
 Q
"RTN","RCCPCBJ")
0^5^B6288491
"RTN","RCCPCBJ",1,0)
RCCPCBJ ;WASH-ISC@ALTOONA,PA/NYB-Background Driver for CCPC ;1/7/97  9:42 AM
"RTN","RCCPCBJ",2,0)
 ;;4.5;Accounts Receivable;**34,76,130,153,166,195,217,237**;Mar 20, 1995
"RTN","RCCPCBJ",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCCPCBJ",4,0)
EN ;Starts the background job for CCPC 5 days before statement day
"RTN","RCCPCBJ",5,0)
 N X,X1,X2,X3,ZTRTN,ZTIO,ZTDTH,ZTSK,ZTDESC
"RTN","RCCPCBJ",6,0)
 D ACK
"RTN","RCCPCBJ",7,0)
 S X1=$$STD^RCCPCFN,X2=-2 D C^%DTC
"RTN","RCCPCBJ",8,0)
 ;10-process end time/18-ccpc file built
"RTN","RCCPCBJ",9,0)
 I X=DT D  Q
"RTN","RCCPCBJ",10,0)
 . S X3=$O(^RCPS(349.2,0)) Q:'X3
"RTN","RCCPCBJ",11,0)
 . Q:'$P($P($G(^RCPS(349.2,X3,0)),"^",10),".")
"RTN","RCCPCBJ",12,0)
 . Q:'$P($G(^RCPS(349.2,X3,0)),"^",18)
"RTN","RCCPCBJ",13,0)
 . D EN^RCCPCML
"RTN","RCCPCBJ",14,0)
 ;quit if date created is yesterday's date
"RTN","RCCPCBJ",15,0)
 S X1=$$STD^RCCPCFN,X2=-1 D C^%DTC
"RTN","RCCPCBJ",16,0)
 I X=DT D  Q
"RTN","RCCPCBJ",17,0)
 . S X3=+$O(^RCT(349,0))
"RTN","RCCPCBJ",18,0)
 . S X3=$P($P($G(^RCT(349,X3,0)),"^",11),".")
"RTN","RCCPCBJ",19,0)
 . S X1=DT,X2=-1 D C^%DTC
"RTN","RCCPCBJ",20,0)
 . I X=X3 Q
"RTN","RCCPCBJ",21,0)
 . D EN^RCCPCML
"RTN","RCCPCBJ",22,0)
 ;
"RTN","RCCPCBJ",23,0)
 S X1=$$STD^RCCPCFN,X2=-3 D C^%DTC
"RTN","RCCPCBJ",24,0)
 I X'=DT Q
"RTN","RCCPCBJ",25,0)
 I DT'<$P($G(^RC(342,1,30)),"^",1)&(DT'>$P($G(^RC(342,1,30)),"^",2)) D ^RCEXINAD
"RTN","RCCPCBJ",26,0)
 S ZTIO="",ZTRTN="OPEN^RCCPCBJ",ZTDESC="CCPC PATIENT STATEMENT"
"RTN","RCCPCBJ",27,0)
 S ZTDTH=$H D ^%ZTLOAD
"RTN","RCCPCBJ",28,0)
 Q
"RTN","RCCPCBJ",29,0)
OPEN ;Update Open status bills to Active or Cancellation status
"RTN","RCCPCBJ",30,0)
 N DAY,BN,DEBTOR,DA,DIE,DR,P,AMT
"RTN","RCCPCBJ",31,0)
 N ZTSAVE,ZTRTN,ZTDESC,ZTASK,%ZIS,ZTDTH
"RTN","RCCPCBJ",32,0)
 S DATE=$$STD^RCCPCFN,DAY=+$$STDY^RCCPCFN,DEBTOR=0 F  S DEBTOR=$O(^RCD(340,"AC",DAY,DEBTOR)) Q:'DEBTOR  D
"RTN","RCCPCBJ",33,0)
    .S BN=0 F  S BN=$O(^PRCA(430,"AS",DEBTOR,$O(^PRCA(430.3,"AC",112,0)),BN)) Q:'BN  D
"RTN","RCCPCBJ",34,0)
       ..S AMT=0 F P=1:1:5 S AMT=$P($G(^PRCA(430,+BN,7)),"^",P)+AMT
"RTN","RCCPCBJ",35,0)
       ..I $P($G(^PRCA(430,+BN,0)),"^",2)=$O(^PRCA(430.2,"AC",33,0)),AMT Q
"RTN","RCCPCBJ",36,0)
       ..S DIE="^PRCA(430,",DA=+BN,DR="8////^S X="_$S(AMT:$O(^PRCA(430.3,"AC",102,0)),1:$O(^PRCA(430.3,"AC",111,0))) D ^DIE K DA,DIE,DR
"RTN","RCCPCBJ",37,0)
       ..Q
"RTN","RCCPCBJ",38,0)
    .Q
"RTN","RCCPCBJ",39,0)
 ;
"RTN","RCCPCBJ",40,0)
 ;  update patient accounts with interest and admin
"RTN","RCCPCBJ",41,0)
 N RCLASDAT
"RTN","RCCPCBJ",42,0)
 S RCLASDAT=DATE
"RTN","RCCPCBJ",43,0)
 I DT>3010101 D FIRSTPTY^RCBECHGS
"RTN","RCCPCBJ",44,0)
 D ^RCCPCPS
"RTN","RCCPCBJ",45,0)
 D REFUND
"RTN","RCCPCBJ",46,0)
 Q
"RTN","RCCPCBJ",47,0)
 ;
"RTN","RCCPCBJ",48,0)
 ;
"RTN","RCCPCBJ",49,0)
REFUND ;Update Open status PREPAYMENT bills to REFUND REVIEW
"RTN","RCCPCBJ",50,0)
 S DEBTOR=0,DAY=+$$STDY^RCCPCFN
"RTN","RCCPCBJ",51,0)
 F  S DEBTOR=$O(^RCD(340,"AC",DAY,DEBTOR)) Q:'DEBTOR  D
"RTN","RCCPCBJ",52,0)
    .S BN=0 F  S BN=$O(^PRCA(430,"AS",DEBTOR,$O(^PRCA(430.3,"AC",112,0)),BN)) Q:'BN  D
"RTN","RCCPCBJ",53,0)
       ..I $P($G(^PRCA(430,+BN,0)),"^",2)=$O(^PRCA(430.2,"AC",33,0)) S X=$$EN^PRCARFU(+BN)
"RTN","RCCPCBJ",54,0)
       ..Q
"RTN","RCCPCBJ",55,0)
    .Q
"RTN","RCCPCBJ",56,0)
 Q
"RTN","RCCPCBJ",57,0)
 ;
"RTN","RCCPCBJ",58,0)
ACK ;CHECK FOR ACKNOWLEDGEMENTS
"RTN","RCCPCBJ",59,0)
 N DEB,MSG,NO,RCX,X,X1,X2
"RTN","RCCPCBJ",60,0)
 S X1=$$STD^RCCPCFN,X2=DT D ^%DTC I X>3 D
"RTN","RCCPCBJ",61,0)
 .D TRANCHK^RCCPCSV1
"RTN","RCCPCBJ",62,0)
 Q
"RTN","RCCPCPS")
0^1^B70423807
"RTN","RCCPCPS",1,0)
RCCPCPS ;WASH-ISC@ALTOONA,PA/NYB-Build Patient Statement File ;12/19/96  4:14 PM
"RTN","RCCPCPS",2,0)
V ;;4.5;Accounts Receivable;**34,70,80,48,104,116,149,170,181,190,223,237**;Mar 20, 1995
"RTN","RCCPCPS",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCCPCPS",4,0)
EN N CCPC,CNT,DAT,DEB,DIK,END,INADFL,LDT1,LDT3,PCC,PRN,RCDATE,RCT,SVADM,SVAMT,SVINT,SVOTH,SITE,TXT,VAR,X,%
"RTN","RCCPCPS",5,0)
 N RCINFULL,RCINPART
"RTN","RCCPCPS",6,0)
 K ^RCPS(349.2)
"RTN","RCCPCPS",7,0)
 F X="PA","IS" S RCT=$O(^RCT(349.1,"B",X,0)) Q:'RCT  K ^RCT(349.1,+RCT,4),^RCT(349.1,+RCT,5)
"RTN","RCCPCPS",8,0)
 K ^XTMP("RCCPC")
"RTN","RCCPCPS",9,0)
 D DT^DICRW,SITE^PRCAGU
"RTN","RCCPCPS",10,0)
 I '$D(SITE) W !!,"AR SITE PARAMETER ENTRIES NOT DEFINED!",?50 D NOW^%DTC S Y=% D DD^%DT W Y W !!,"COULD NOT PROCESS AR PATIENT STATEMENTS" Q
"RTN","RCCPCPS",11,0)
 D NOW^%DTC S END=%
"RTN","RCCPCPS",12,0)
 S LDT1=$$FPS^RCAMFN01(DT,-1),RCDATE=DT
"RTN","RCCPCPS",13,0)
 S (CNT,DEB)=0,PRN=1
"RTN","RCCPCPS",14,0)
 F  S DEB=$O(^RCD(340,"AB","DPT(",DEB)) Q:DEB=""  D
"RTN","RCCPCPS",15,0)
 .   N AMT,BBAL,BEG,BN,CAT,DESC,ETY,FC,ND,PAT,PBAL,PC
"RTN","RCCPCPS",16,0)
 .   N PDAT,PEND,ST,SVINT,SVADM,SVOTH,ADDR
"RTN","RCCPCPS",17,0)
 .   I $L(+$$SSN^RCFN01(DEB))<5 Q
"RTN","RCCPCPS",18,0)
 .   ;Check for Emergency Response Indicator (ERI) Flag.
"RTN","RCCPCPS",19,0)
 .   N RCDFN S RCDFN=$P($G(^RCD(340,DEB,0)),"^",1) I $$EMERES^PRCAUTL(+RCDFN)]"" Q
"RTN","RCCPCPS",20,0)
 .   S INADFL=0
"RTN","RCCPCPS",21,0)
 .   S (SVADM,SVAMT,SVINT,SVOTH)=0
"RTN","RCCPCPS",22,0)
 .   N REF,SBAL,SDT,TBAL,TN,TTY,X,Y
"RTN","RCCPCPS",23,0)
 .   K ^TMP("PRCAGT",$J)
"RTN","RCCPCPS",24,0)
 .   S BEG=+$$LST^RCFN01(DEB,2)
"RTN","RCCPCPS",25,0)
 .   S LDT3=$S(BEG>0:$$FPS^RCAMFN01($P(BEG,"."),-3),1:0)
"RTN","RCCPCPS",26,0)
 .   I $P(BEG,".")'<$P(RCDATE,".") Q
"RTN","RCCPCPS",27,0)
 .   D NOW^%DTC S END=%
"RTN","RCCPCPS",28,0)
 .   I BEG<1 S PDAT="",BEG=0,PBAL=0
"RTN","RCCPCPS",29,0)
 .   I BEG S PDAT=BEG,BEG=9999999.999999-BEG,PBAL=0 D PBAL^PRCAGU(DEB,.BEG,.PBAL) ;get prev bal
"RTN","RCCPCPS",30,0)
 .   D EN^PRCAGT(DEB,BEG,.END)
"RTN","RCCPCPS",31,0)
 .   S TBAL=0 D TBAL^PRCAGT(DEB,.TBAL) ;get trans bal
"RTN","RCCPCPS",32,0)
 .   S BBAL=0 D BBAL^PRCAGU(DEB,.BBAL) ;get bill bal
"RTN","RCCPCPS",33,0)
 .   S X=$$PRE^PRCAGU(DEB) S PEND=$P(X,U,2),X=+X I X,BBAL D REF^PRCAGD(DEB,X,$G(REP)) Q
"RTN","RCCPCPS",34,0)
 .   I BBAL=0,PEND,-PEND=PBAL+TBAL Q
"RTN","RCCPCPS",35,0)
 .   I BBAL'=(PBAL+TBAL) D EN^PRCAGD(DEB,BBAL,TBAL,PBAL,BEG,$G(REP)) Q
"RTN","RCCPCPS",36,0)
 .   I BBAL'>0,'$D(^TMP("PRCAGT",$J,DEB)) Q
"RTN","RCCPCPS",37,0)
 .   I BBAL=0,$G(SITE("ZERO")) Q
"RTN","RCCPCPS",38,0)
 .   I BBAL<0,BBAL>-.99 Q
"RTN","RCCPCPS",39,0)
 .   I BBAL'<0,'$$ACT^PRCAGT(DEB,LDT3) Q
"RTN","RCCPCPS",40,0)
 .   S TBAL=TBAL+PBAL
"RTN","RCCPCPS",41,0)
 .   I '$D(^RCPS(349.2,0)) S ^(0)="AR CCPC STATEMENTS RECORDS^349.2I^"
"RTN","RCCPCPS",42,0)
 .   S ^RCPS(349.2,DEB,0)=DEB_"^"_$$SSN^RCFN01(DEB)_"^"
"RTN","RCCPCPS",43,0)
 .   S ADDR=$$DADD^RCAMADD(DEB,1) ;get patient's address, confidential if applicable
"RTN","RCCPCPS",44,0)
 .   S ^RCPS(349.2,DEB,1)=$P(ADDR,"^",1,6)
"RTN","RCCPCPS",45,0)
 .   S ST=$P(ADDR,"^",5)
"RTN","RCCPCPS",46,0)
 .   S ^RCPS(349.2,DEB,7)=$P(^RCD(340,DEB,0),U,7) ;large print
"RTN","RCCPCPS",47,0)
 .   I $G(ST)'="" S ST=$O(^DIC(5,"C",ST,0))
"RTN","RCCPCPS",48,0)
 .   I $G(ST)>90 S FC=$P($G(^DIC(5,ST,0)),"^")
"RTN","RCCPCPS",49,0)
 .   S $P(^RCPS(349.2,DEB,1),"^",7)=$G(FC) S:$G(FC)]"" $P(^RCPS(349.2,DEB,1),"^",5)="FX"
"RTN","RCCPCPS",50,0)
 .   S:$G(FC)]"" $P(^RCPS(349.2,DEB,1),"^",6)=$P(ADDR,"^",8)
"RTN","RCCPCPS",51,0)
 .   D NOW^%DTC S $P(^RCPS(349.2,DEB,0),"^",10)=%
"RTN","RCCPCPS",52,0)
 .   S $P(^RCPS(349.2,DEB,0),"^",3)=$$NAM^RCFN01(DEB)
"RTN","RCCPCPS",53,0)
 .   S $P(^RCPS(349.2,DEB,0),"^",4,7)=$S(TBAL'>0:0,1:TBAL)_"^"_PBAL_"^"_TBAL("CH")_"^"_TBAL("PC"),$P(^(0),"^",8)=PBAL+TBAL("CH")+TBAL("PC")+TBAL("RF")
"RTN","RCCPCPS",54,0)
 .   S $P(^RCPS(349.2,DEB,0),"^",13,17)=BBAL("PB")_"^"_BBAL("INT")_"^"_BBAL("ADM")_"^"_BBAL("MF")_"^"_BBAL("CT")
"RTN","RCCPCPS",55,0)
 .   ;
"RTN","RCCPCPS",56,0)
 .   N RCBILLDA,RCDATA1,RCDEBTDA,RCDESC,RCPSDA,RCTOTAL,RCTRANDA,RCTRDATE,VALUE,RCCOM1,RCCOM2,RCCOM3
"RTN","RCCPCPS",57,0)
 .   S RCDEBTDA=DEB
"RTN","RCCPCPS",58,0)
 .   I '$D(^RCPS(349.2,RCDEBTDA,2,0)) S ^(0)="^349.21DA^^"
"RTN","RCCPCPS",59,0)
 .   ;
"RTN","RCCPCPS",60,0)
 .   S RCCOM1=$E($TR($G(SITE("COM1")),"~|^",""),1,80),(RCCOM2,RCCOM3)=""
"RTN","RCCPCPS",61,0)
 .   ; Add second comment line for the GMT-reduced status
"RTN","RCCPCPS",62,0)
 .   I $$GMT^PRCAGST(RCDEBTDA) S RCCOM2="REDUCTION OF INPATIENT COPAYMENT DUE TO GEOGRAPHIC MEANS TEST STATUS"
"RTN","RCCPCPS",63,0)
 .   I TBAL'>0 S RCCOM3=" *THIS IS NOT A BILL*"
"RTN","RCCPCPS",64,0)
 .   I RCCOM1'="",RCCOM2'="" S $E(RCCOM1,80)=" " ;Make sure GMT message will be printed on separate line.
"RTN","RCCPCPS",65,0)
 .   S ^RCPS(349.2,RCDEBTDA,3)=RCCOM1_RCCOM2_RCCOM3
"RTN","RCCPCPS",66,0)
 .   ;
"RTN","RCCPCPS",67,0)
 .   S RCPSDA=0 ; this variable used to set the description on the PS segment
"RTN","RCCPCPS",68,0)
 .   S RCTRDATE=0 F  S RCTRDATE=$O(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE)) Q:'RCTRDATE  S RCBILLDA=0 F  S RCBILLDA=$O(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE,RCBILLDA)) Q:'RCBILLDA  D
"RTN","RCCPCPS",69,0)
 .   .   I $P($G(^RCPS(349.2,RCDEBTDA,0)),"^",8)<0 S PC(75)=75
"RTN","RCCPCPS",70,0)
 .   .   I $P($G(^PRCA(430,RCBILLDA,6)),"^",2)]"",($P($G(^PRCA(430,RCBILLDA,7)),"^")>0) S PC(1)="01"
"RTN","RCCPCPS",71,0)
 .   .   S CAT=$P($G(^PRCA(430,RCBILLDA,0)),"^",2)
"RTN","RCCPCPS",72,0)
 .   .   S PC=$P($G(^PRCA(430.2,CAT,0)),"^",14)
"RTN","RCCPCPS",73,0)
 .   .   F X=1:1:100 I $P(PC,",",X)'="" S PCC=$P(PC,",",X),PC(+PCC)=PCC Q:PCC=""
"RTN","RCCPCPS",74,0)
 .   .   S PC="",X=0 F  S X=$O(PC(X)) Q:X=""  I $G(PC(X))'="" S PC=PC_PC(X)
"RTN","RCCPCPS",75,0)
 .   .   S $P(^RCPS(349.2,RCDEBTDA,4),"^")=PC
"RTN","RCCPCPS",76,0)
 .   .   ;
"RTN","RCCPCPS",77,0)
 .   .   I $D(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE,RCBILLDA,0)) S AMT=+^(0) I AMT D
"RTN","RCCPCPS",78,0)
 .   .   .   ;  get the description for the bill
"RTN","RCCPCPS",79,0)
 .   .   .   K RCDESC D BILLDESC^RCCPCPS1(RCBILLDA)
"RTN","RCCPCPS",80,0)
 .   .   .   ;
"RTN","RCCPCPS",81,0)
 .   .   .   ;  store the description in file 349.2, PS segment
"RTN","RCCPCPS",82,0)
 .   .   .   S RCPSDA=RCPSDA+1
"RTN","RCCPCPS",83,0)
 .   .   .   S $P(^RCPS(349.2,RCDEBTDA,2,RCPSDA,0),"^",1,4)=$P(RCTRDATE,".")_"^"_$G(RCDESC(1))_"^"_$G(AMT)_"^"_$P(^PRCA(430,RCBILLDA,0),"^")
"RTN","RCCPCPS",84,0)
 .   .   .   F X=2:1 Q:$G(RCDESC(X))=""  S RCPSDA=RCPSDA+1,^RCPS(349.2,RCDEBTDA,2,RCPSDA,0)="^"_RCDESC(X)_"^^"
"RTN","RCCPCPS",85,0)
 .   .   ;
"RTN","RCCPCPS",86,0)
 .   .   S RCTRANDA=0 F  S RCTRANDA=$O(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE,RCBILLDA,RCTRANDA)) D:'RCTRANDA NO Q:'RCTRANDA  D
"RTN","RCCPCPS",87,0)
 .   .   .   ;  get the description for the transaction
"RTN","RCCPCPS",88,0)
 .   .   .   K RCDESC D TRANDESC^RCCPCPS1(RCTRANDA),RCDESC
"RTN","RCCPCPS",89,0)
 .   .   .   ;  if it is an interest/admin charge, summarize it below
"RTN","RCCPCPS",90,0)
 .   .   .   I $G(RCDESC(1))["INTEREST" Q
"RTN","RCCPCPS",91,0)
 .   .   .   ;  get the value of the transaction for the statement
"RTN","RCCPCPS",92,0)
 .   .   .   S VALUE=$$TRANVALU^RCDPBTLM(RCTRANDA)
"RTN","RCCPCPS",93,0)
 .   .   .   S VALUE=$P(VALUE,"^",2)+$P(VALUE,"^",3)+$P(VALUE,"^",4)+$P(VALUE,"^",5)+$P(VALUE,"^",6)
"RTN","RCCPCPS",94,0)
 .   .   .   ;  if it is a suspended (47) or unsuspended (46) transaction, show value
"RTN","RCCPCPS",95,0)
 .   .   .   ;  make suspended charges appear as negative
"RTN","RCCPCPS",96,0)
 .   .   .   S RCDATA1=$G(^PRCA(433,RCTRANDA,1))
"RTN","RCCPCPS",97,0)
 .   .   .   I $P(RCDATA1,"^",2)=47!($P(RCDATA1,"^",2)=46) S VALUE=$P(RCDATA1,"^",5) I $P(RCDATA1,"^",2)=47 S VALUE=-VALUE
"RTN","RCCPCPS",98,0)
 .   .   .   ;  if it is an amended bill, show value
"RTN","RCCPCPS",99,0)
 .   .   .   I $P(RCDATA1,"^",2)=33 S VALUE=$P(RCDATA1,"^",5)
"RTN","RCCPCPS",100,0)
 .   .   .   ;  store the description in file 349.2, PS segment
"RTN","RCCPCPS",101,0)
 .   .   .   S RCPSDA=RCPSDA+1
"RTN","RCCPCPS",102,0)
 .   .   .   S $P(^RCPS(349.2,RCDEBTDA,2,RCPSDA,0),"^",1,5)=$P(RCTRDATE,".")_"^"_$G(RCDESC(1))_"^"_VALUE_"^"_$P(^PRCA(430,RCBILLDA,0),"^")
"RTN","RCCPCPS",103,0)
 .   .   .   F X=2:1 Q:$G(RCDESC(X))=""  S RCPSDA=RCPSDA+1,^RCPS(349.2,RCDEBTDA,2,RCPSDA,0)="^"_RCDESC(X)_"^^"
"RTN","RCCPCPS",104,0)
 .   .   .   ;
"RTN","RCCPCPS",105,0)
 .   .   .   ;  for comment transaction ... not sure what this is for ?
"RTN","RCCPCPS",106,0)
 .   .   .   I $P(RCDATA1,"^",2)=45,$P($G(^PRCA(433,RCTRANDA,5)),"^",2)["your waiver rights" S ^RCPS(349.2,+RCDEBTDA,4)="0150"
"RTN","RCCPCPS",107,0)
 .   ;
"RTN","RCCPCPS",108,0)
 .   ;  if interest, admin, or other, add them here
"RTN","RCCPCPS",109,0)
 .   S X=$G(RCTOTAL("INT"))+$G(RCTOTAL("ADM"))+$G(RCTOTAL("OTH"))
"RTN","RCCPCPS",110,0)
 .   I X>0 D
"RTN","RCCPCPS",111,0)
 .   .   S RCDESC="INTEREST/ADM. CHARGE (Int:"_$J($G(RCTOTAL("INT")),1,2)_" Adm:"_$J($G(RCTOTAL("ADM")),1,2)_" Other:"_$J($G(RCTOTAL("OTH")),1,2)_")"
"RTN","RCCPCPS",112,0)
 .   .   S RCPSDA=RCPSDA+1
"RTN","RCCPCPS",113,0)
 .   .   S ^RCPS(349.2,RCDEBTDA,2,RCPSDA,0)="^"_RCDESC_"^"_$J(X,1,2)
"RTN","RCCPCPS",114,0)
 .   .   S ^RCPS(349.2,RCDEBTDA,2,0)="^349.21DA^"_RCPSDA_"^"_RCPSDA
"RTN","RCCPCPS",115,0)
 .   ;
"RTN","RCCPCPS",116,0)
 .   ;  set 0th node
"RTN","RCCPCPS",117,0)
 .   I RCPSDA S ^RCPS(349.2,RCDEBTDA,2,0)="^349.21DA^"_RCPSDA_"^"_RCPSDA
"RTN","RCCPCPS",118,0)
 .   ;
"RTN","RCCPCPS",119,0)
 .   I RCPSDA'<287 S ^XTMP("RCCPC",0)=DT,^XTMP("RCCPC",RCDEBTDA)="" Q
"RTN","RCCPCPS",120,0)
 .   D NO
"RTN","RCCPCPS",121,0)
 ;
"RTN","RCCPCPS",122,0)
 S DIK="^RCPS(349.2," D IXALL^DIK
"RTN","RCCPCPS",123,0)
 S DEB=0 S DEB=$O(^RCPS(349.2,DEB)) Q:DEB=""  S $P(^(DEB,0),"^",18)=1
"RTN","RCCPCPS",124,0)
 ;
"RTN","RCCPCPS",125,0)
OSTM ;Process old statements
"RTN","RCCPCPS",126,0)
 S DIK="^RCPS(349.2,",DA=0 F  S DA=$O(^XTMP("RCCPC",DA)) Q:'DA  D ^DIK
"RTN","RCCPCPS",127,0)
 K DA
"RTN","RCCPCPS",128,0)
 ;
"RTN","RCCPCPS",129,0)
STATMNT ;Print patient statements
"RTN","RCCPCPS",130,0)
 N IOP,ZTIO,ZTSAVE,ZTRTN,ZTDESC,ZTASK,%ZIS,ZTDTH,PRCADEV
"RTN","RCCPCPS",131,0)
 S (IOP,PRCADEV)=$P($G(^RC(342,1,0)),"^",8)
"RTN","RCCPCPS",132,0)
 I IOP]"" D
"RTN","RCCPCPS",133,0)
 .S ZTRTN="STM^RCCPCSTM",ZTDTH=$H,ZTDESC="Print old AR Statements"
"RTN","RCCPCPS",134,0)
 .S %ZIS="N0" D ^%ZIS Q:POP
"RTN","RCCPCPS",135,0)
 .S ZTSAVE("PRCADEV")="" D ^%ZTLOAD,^%ZISC
"RTN","RCCPCPS",136,0)
 Q
"RTN","RCCPCPS",137,0)
 ;
"RTN","RCCPCPS",138,0)
NO ;If there is no activity
"RTN","RCCPCPS",139,0)
 I $G(^RCPS(349.2,+DEB,4))["0150" D
"RTN","RCCPCPS",140,0)
 .S ^RCPS(349.2,+DEB,2,1,0)="^NOTICE: You now have delinquent charges. Please^^"
"RTN","RCCPCPS",141,0)
 .S ^RCPS(349.2,+DEB,2,2,0)="^review Enforcement of Involuntary Collections^^"
"RTN","RCCPCPS",142,0)
 .S ^RCPS(349.2,+DEB,2,3,0)="^on reverse.^^"
"RTN","RCCPCPS",143,0)
 .S ^RCPS(349.2,+DEB,2,0)="^^3^3"
"RTN","RCCPCPS",144,0)
 I $G(^RCPS(349.2,DEB,2,1,0))="" D
"RTN","RCCPCPS",145,0)
 .S ^RCPS(349.2,DEB,2,1,0)="^No Activity in the Last 30 Days!^^"
"RTN","RCCPCPS",146,0)
 .S ^RCPS(349.2,DEB,2,2,0)="^Please refer to previous statement of rights.^^"
"RTN","RCCPCPS",147,0)
 .S ^RCPS(349.2,DEB,2,0)="^^2^2"
"RTN","RCCPCPS",148,0)
 .I $G(^RCPS(349.2,DEB,4))="" S ^(4)="90"
"RTN","RCCPCPS",149,0)
 Q
"RTN","RCCPCPS",150,0)
BUILD ;This is the entry point from the BUILD CCPC file option
"RTN","RCCPCPS",151,0)
 N TDT,QDT,ZTDESC,ZTASK,ZTSK,ZDTDTH,ZTIO,ZTRTN
"RTN","RCCPCPS",152,0)
 S TDT=$O(^RCPS(349.2,0)) I TDT D
"RTN","RCCPCPS",153,0)
 .S TDT=$$ASOF^RCCPCFN($P($G(^RCPS(349.2,+TDT,0)),"^",10))
"RTN","RCCPCPS",154,0)
 .S TDT=$TR($$SLH^RCFN01(TDT),"/","")
"RTN","RCCPCPS",155,0)
 .S TDT("T")=$P($G(^RCT(349,1,0)),"^",10),TDT("T")=$E(TDT("T"),1,4)_$E(TDT("T"),7,8)
"RTN","RCCPCPS",156,0)
 .I TDT("T")=TDT D
"RTN","RCCPCPS",157,0)
 ..W *7,!,"The current file reflects activity as of ",$E(TDT,1,2)_"/"_$E(TDT,3,4)_"/"_$E(TDT,5,8)_".",!
"RTN","RCCPCPS",158,0)
 ..W !,"IT WAS TRANSMITTED ON ",$TR($P($P($G(^RCT(349,1,0)),"^"),".",2,4),".","/"),!
"RTN","RCCPCPS",159,0)
 ..S TDT=$P($G(^RCT(349,1,0)),"^",9)
"RTN","RCCPCPS",160,0)
 ..W !,"For statement date: ",$E(TDT,1,2)_"/"_$E(TDT,3,4)_"/"_$E(TDT,5,8)
"RTN","RCCPCPS",161,0)
 ..W !!,"PLEASE CONTACT CUSTOMER SUPPORT BEFORE PROCEEDING.",!!
"RTN","RCCPCPS",162,0)
TIME S ZTIO="",ZTRTN="EN^RCCPCPS",ZTDESC="Build CCPC Statement File"
"RTN","RCCPCPS",163,0)
 S ZTDTH="" D ^%ZTLOAD Q:$G(ZTSK)=""
"RTN","RCCPCPS",164,0)
 S %H=ZTSK("D") D YMD^%DTC S QDT=X_%
"RTN","RCCPCPS",165,0)
 I (QDT>DT_"."_0800)&(QDT<(DT_"."_1801)) D  G TIME
"RTN","RCCPCPS",166,0)
 .W !!,*7,"You Can Not Queue this Job Between 8:00am and 6:00pm.",!
"RTN","RCCPCPS",167,0)
 .D KILL^%ZTLOAD
"RTN","RCCPCPS",168,0)
 W !,"Queued for Building."
"RTN","RCCPCPS",169,0)
 Q
"RTN","RCCPCPS",170,0)
 ;
"RTN","RCCPCPS",171,0)
RCDESC ;Remove "IN PART" & "IN FULL" from the the bill description
"RTN","RCCPCPS",172,0)
 QUIT:$G(RCDESC(1))=""
"RTN","RCCPCPS",173,0)
 S RCINFULL=" (IN FULL)"
"RTN","RCCPCPS",174,0)
 S RCINPART=" (IN PART)"
"RTN","RCCPCPS",175,0)
 I RCDESC(1)[RCINFULL S RCDESC(1)=$P(RCDESC(1),RCINFULL)_$P(RCDESC(1),RCINFULL,2)
"RTN","RCCPCPS",176,0)
 I RCDESC(1)[RCINPART S RCDESC(1)=$P(RCDESC(1),RCINPART)_$P(RCDESC(1),RCINPART,2)
"RTN","RCCPCPS",177,0)
 Q
"RTN","RCDMC90")
0^7^B58237113
"RTN","RCDMC90",1,0)
RCDMC90 ;WASH IRMFO@ALTOONA,PA/TJK-DMC 90 DAY ;7/17/97  8:13 AM
"RTN","RCDMC90",2,0)
V ;;4.5;Accounts Receivable;**45,108,133,121,163,190,192,236,237**;Mar 20, 1995
"RTN","RCDMC90",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDMC90",4,0)
ENTER ;Entry point from nightly process
"RTN","RCDMC90",5,0)
 Q:'$D(RCDOC)
"RTN","RCDMC90",6,0)
 ;run the interest and admin for newly flagged Katrina Patients.
"RTN","RCDMC90",7,0)
 I DT'<$P($G(^RC(342,1,30)),"^",1)&(DT'>$P($G(^RC(342,1,30)),"^",2)) D ^RCEXINAD
"RTN","RCDMC90",8,0)
 N DEBTOR,BILL,DEBTOR0,B0,B6,B7,LTRDT3,P30DT,PRIN,INT,ADMIN,B4,B12
"RTN","RCDMC90",9,0)
 N TPRIN,TINT,TADMIN,ESTDT,CATYP,DFN,CNTR,SITE,LN,FN,MN,STNM,DOB,SITE
"RTN","RCDMC90",10,0)
 N PHONE,QUIT,TOTAL,ZIPCODE,FULLNM,XN,P91DT,OFFAMT,RCNT,TLINE,REPAY,X1,X2
"RTN","RCDMC90",11,0)
 N LKUP,ADDR,ADDRPHO,CHKPHONE,PSSN
"RTN","RCDMC90",12,0)
 K ^XTMP("RCDMC90",$J),^TMP($J,"RCDMC90") S ^XTMP("RCDMC90",0)=DT
"RTN","RCDMC90",13,0)
 S SITE=$$SITE^RCMSITE(),TLINE="0^0^0"
"RTN","RCDMC90",14,0)
 S X1=DT,X2=-91 D C^%DTC S P91DT=X
"RTN","RCDMC90",15,0)
 S X1=DT,X2=-30 D C^%DTC S P30DT=X
"RTN","RCDMC90",16,0)
 S (CNTR,DEBTOR)=0,RCNT=2 G UPDATE:$G(RCDOC)="W"
"RTN","RCDMC90",17,0)
 ;MASTER SHEET COMPILATION
"RTN","RCDMC90",18,0)
 F  S DEBTOR=$O(^PRCA(430,"C",DEBTOR)) Q:DEBTOR'?1N.N  D
"RTN","RCDMC90",19,0)
 .N X,RCDFN
"RTN","RCDMC90",20,0)
 .S RCDFN=$P($G(^RCD(340,DEBTOR,0)),"^",1) I $P(RCDFN,";",2)'["DPT" Q
"RTN","RCDMC90",21,0)
 .S X=$$EMERES^PRCAUTL(+RCDFN) I X]""&('$D(^RCD(340,"DMC",1,DEBTOR))) Q  ;stop the master sheet compilation for hurricane Katrina sites
"RTN","RCDMC90",22,0)
 .K ^TMP($J,"RCDMC90","BILL")
"RTN","RCDMC90",23,0)
 .S QUIT=1,OFFAMT=+$P($G(^RCD(340,DEBTOR,3)),U,9)
"RTN","RCDMC90",24,0)
 .D PROC(DEBTOR,.QUIT) Q:QUIT
"RTN","RCDMC90",25,0)
 .;COMPILES FIELDS UNIQUE TO MASTER CODE SHEETS
"RTN","RCDMC90",26,0)
 .S FULLNM=$$NM(DFN),FN=$P(FULLNM,U,3),MN=$P(FULLNM,U,4)
"RTN","RCDMC90",27,0)
 .S LN=$P(FULLNM,U,1),XN=$P(FULLNM,U,2)
"RTN","RCDMC90",28,0)
 .S FULLNM=FN_" "_$S(MN'="":$P(MN,".")_" ",1:"")_LN_$S(XN'="":" "_$P(XN,"."),1:"")
"RTN","RCDMC90",29,0)
 .S STNM=$$LJ^XLFSTR($E(FN)_$S(MN'="":$E(MN),1:" ")_$E(LN,1,5),7," ")
"RTN","RCDMC90",30,0)
 .S DOB=$$DATE8(+VADM(3))
"RTN","RCDMC90",31,0)
 .;SET HOLDING GLOBAL FOR MASTER SHEETS
"RTN","RCDMC90",32,0)
 .S CNTR=CNTR+1
"RTN","RCDMC90",33,0)
 .S ^XTMP("RCDMC90",$J,CNTR)=$E($$LJ^XLFSTR($P(VADM(2),U),9),1,9)_STNM_SITE_DOB_PHONE_$$LJ^XLFSTR(FULLNM,40)_$$LJ^XLFSTR($E($P(ADDR,U,1),1,2),2)
"RTN","RCDMC90",34,0)
 .S CNTR=CNTR+1
"RTN","RCDMC90",35,0)
 .S ^XTMP("RCDMC90",$J,CNTR)=$$LJ^XLFSTR($E($P(ADDR,U,1),3,40),38)_$$LJ^XLFSTR($E($P(ADDR,U,2),1,40),40)_$$LJ^XLFSTR($E($P(ADDR,U,3)),1)
"RTN","RCDMC90",36,0)
 .S CNTR=CNTR+1
"RTN","RCDMC90",37,0)
 .S ^XTMP("RCDMC90",$J,CNTR)=$$LJ^XLFSTR($E($P(ADDR,U,3),2,40),39)_$$LJ^XLFSTR($E($P(ADDR,U,4),1,40),40)
"RTN","RCDMC90",38,0)
 .S CNTR=CNTR+1
"RTN","RCDMC90",39,0)
 .S ^XTMP("RCDMC90",$J,CNTR)=$$LJ^XLFSTR($E($P(ADDR,U,5),1,40),40)_$$LJ^XLFSTR(ZIPCODE,9)_$$DATE8(ESTDT)_$$AMT(TPRIN)_$$AMT(TINT)_$E($$AMT(TADMIN),1,4)
"RTN","RCDMC90",40,0)
 .S CNTR=CNTR+1
"RTN","RCDMC90",41,0)
 .S ^XTMP("RCDMC90",$J,CNTR)=$E($$AMT(TADMIN),5,9)_$$DATE8(DT)_CATYP_$$AMT(OFFAMT)_$$AMT($$BAL(DEBTOR))_$E("0000000000",1,10-$L(DEBTOR))_DEBTOR_"$"
"RTN","RCDMC90",42,0)
 .S $P(^RCD(340,DEBTOR,3),U)=1,$P(^(3),U,2)=DT,$P(^(3),U,3)=ESTDT,$P(^(3),U,5)=TOTAL,$P(^(3),U,6)=TPRIN,$P(^(3),U,7)=TINT,$P(^(3),U,8)=TADMIN,^RCD(340,"DMC",1,DEBTOR)=""
"RTN","RCDMC90",43,0)
 .S X=0 F  S X=$O(^TMP($J,"RCDMC90","BILL",X)) Q:'X  S ^PRCA(430,X,12)=^(X)
"RTN","RCDMC90",44,0)
 .D SETREC
"RTN","RCDMC90",45,0)
 .Q
"RTN","RCDMC90",46,0)
 D COMPILE^RCDMC90U(375,CNTR,5,TLINE),KVAR
"RTN","RCDMC90",47,0)
 Q
"RTN","RCDMC90",48,0)
UPDATE ;WEEKLY UPDATE COMPILATION
"RTN","RCDMC90",49,0)
 F  S DEBTOR=$O(^RCD(340,"DMC",1,DEBTOR)) Q:DEBTOR'?1N.N  D
"RTN","RCDMC90",50,0)
 .I '$G(^RCD(340,DEBTOR,3)) K ^RCD(340,"DMC",1,DEBTOR) Q
"RTN","RCDMC90",51,0)
 .S QUIT=1,OFFAMT=+$P(^RCD(340,DEBTOR,3),U,9)
"RTN","RCDMC90",52,0)
 .D PROC(DEBTOR,.QUIT) Q:QUIT
"RTN","RCDMC90",53,0)
 .;SET HOLDING GLOBAL FOR WEEKLY UPDATES
"RTN","RCDMC90",54,0)
 .S CNTR=CNTR+1
"RTN","RCDMC90",55,0)
 .S ^XTMP("RCDMC90",$J,CNTR)=$E($$LJ^XLFSTR($P(VADM(2),U),9),1,9)_$$LJ^XLFSTR($E($P(ADDR,U,1),1,40),40)_$$LJ^XLFSTR($E($P(ADDR,U,2),1,30),30)
"RTN","RCDMC90",56,0)
 .S CNTR=CNTR+1
"RTN","RCDMC90",57,0)
 .S ^XTMP("RCDMC90",$J,CNTR)=$$LJ^XLFSTR($E($P(ADDR,U,2),31,40),10)_$$LJ^XLFSTR($E($P(ADDR,U,3),1,40),40)_$$LJ^XLFSTR($E($P(ADDR,U,4),1,29),29)
"RTN","RCDMC90",58,0)
 .S CNTR=CNTR+1
"RTN","RCDMC90",59,0)
 .S ^XTMP("RCDMC90",$J,CNTR)=$$LJ^XLFSTR($E($P(ADDR,U,4),30,40),11)_$$LJ^XLFSTR($E($P(ADDR,U,5),1,40),40)_$$LJ^XLFSTR(ZIPCODE,9)_SITE_PHONE_$E($$AMT(TPRIN),1,6)
"RTN","RCDMC90",60,0)
 .S CNTR=CNTR+1
"RTN","RCDMC90",61,0)
 .S ^XTMP("RCDMC90",$J,CNTR)=$E($$AMT(TPRIN),7,9)_$$AMT(TINT)_$$AMT(TADMIN)_$$DATE8(DT)_CATYP_$$AMT(OFFAMT)_$$AMT($$BAL(DEBTOR))_"$"
"RTN","RCDMC90",62,0)
 .S:TOTAL $P(^RCD(340,DEBTOR,3),U,5)=TOTAL,$P(^(3),U,6)=TPRIN,$P(^(3),U,7)=TINT,$P(^(3),U,8)=TADMIN
"RTN","RCDMC90",63,0)
 .D SETREC
"RTN","RCDMC90",64,0)
 .Q
"RTN","RCDMC90",65,0)
 D COMPILE^RCDMC90U(300,CNTR,4,TLINE),KVAR
"RTN","RCDMC90",66,0)
 Q
"RTN","RCDMC90",67,0)
KVAR D KVAR^VADPT
"RTN","RCDMC90",68,0)
 K RCDOC,^XTMP("RCDMC90",$J),VA("BID"),XMDUZ
"RTN","RCDMC90",69,0)
 Q
"RTN","RCDMC90",70,0)
PROC(DEBTOR,QUIT) ;PROCESS BILLS FOR A SPECIFIC DEBTOR
"RTN","RCDMC90",71,0)
 ;SETS DATA COMMON TO BOTH WEEKLY & MASTER CODESHEETS
"RTN","RCDMC90",72,0)
 S DEBTOR0=$G(^RCD(340,DEBTOR,0))
"RTN","RCDMC90",73,0)
 Q:$P(DEBTOR0,U)'["DPT"
"RTN","RCDMC90",74,0)
 S DFN=+DEBTOR0 D DEM^VADPT Q:$E(VADM(2),1,5)="00000"
"RTN","RCDMC90",75,0)
 F X=1:1:6 S CATYP(X)=""
"RTN","RCDMC90",76,0)
 S (BILL,TOTAL,TPRIN,TINT,TADMIN,REPAY)=0,ESTDT=P91DT
"RTN","RCDMC90",77,0)
 I RCDOC="W",$P(^RCD(340,DEBTOR,3),U,10) G TOTAL
"RTN","RCDMC90",78,0)
 F  S BILL=$O(^PRCA(430,"C",DEBTOR,BILL)) Q:BILL'?1N.N  D  K:PRIN=0 ^PRCA(430,BILL,12) Q:REPAY
"RTN","RCDMC90",79,0)
 .S (PRIN,INT,ADMIN)=0
"RTN","RCDMC90",80,0)
 .I +VADM(6) Q
"RTN","RCDMC90",81,0)
 .S B0=$G(^PRCA(430,BILL,0)),B4=$G(^(4)),B6=$G(^(6)),B7=$G(^(7)),B12=$G(^(12))
"RTN","RCDMC90",82,0)
 .Q:$P(B0,U,8)'=16
"RTN","RCDMC90",83,0)
 .I B4 D  Q
"RTN","RCDMC90",84,0)
 ..S (TOTAL,TPRIN,TINT,TADMIN)=0
"RTN","RCDMC90",85,0)
 ..S X=0 F  S X=$O(^PRCA(430,"C",DEBTOR,X)) Q:X'?1N.N  K ^PRCA(430,X,12)
"RTN","RCDMC90",86,0)
 ..S REPAY=1
"RTN","RCDMC90",87,0)
 ..Q
"RTN","RCDMC90",88,0)
 .I RCDOC="W",'$P(B12,U) Q
"RTN","RCDMC90",89,0)
 .S PRIN=$P(B7,U),INT=$P(B7,U,2),ADMIN=$P(B7,U,3)+$P(B7,U,4)+$P(B7,U,5)
"RTN","RCDMC90",90,0)
 .I PRIN'>0,INT+ADMIN>0 D  Q
"RTN","RCDMC90",91,0)
 ..N XMSUB,XMY,XMTEXT,MSG
"RTN","RCDMC90",92,0)
 ..S XMSUB="Notice Of Active Bill Without Principal Balance"
"RTN","RCDMC90",93,0)
 ..S XMY("G.DMR")=""
"RTN","RCDMC90",94,0)
 ..S XMDUZ="AR PACKAGE"
"RTN","RCDMC90",95,0)
 ..S XMTEXT="MSG("
"RTN","RCDMC90",96,0)
 ..S MSG(1)="The following bill has a 0 principal balance,"
"RTN","RCDMC90",97,0)
 ..S MSG(2)="but has interest/admin charges remaining."
"RTN","RCDMC90",98,0)
 ..S MSG(3)="These charges should be exempted"
"RTN","RCDMC90",99,0)
 ..S MSG(4)=" "
"RTN","RCDMC90",100,0)
 ..S MSG(5)="BILL #:  "_$P(B0,U)
"RTN","RCDMC90",101,0)
 ..D ^XMD
"RTN","RCDMC90",102,0)
 ..Q
"RTN","RCDMC90",103,0)
 .Q:$P(B4,U)
"RTN","RCDMC90",104,0)
 .S LTRDT3=$P(B6,U,3) Q:'LTRDT3  Q:LTRDT3>P30DT
"RTN","RCDMC90",105,0)
 .;CHECK FOR DC REFERRAL HERE
"RTN","RCDMC90",106,0)
 .I $P(B6,U,4),($P(B6,U,5)="DC")!($P(B6,U,5)="RC") Q
"RTN","RCDMC90",107,0)
 .;Q:$$INSURED^IBCNS1(DFN,$P(B0,U,10))  ;Commented out w/patch *121
"RTN","RCDMC90",108,0)
 .S X=$P(B0,U,2),X=$S(X=22:1,X=23:1,(X>2)&(X<6):2,X=18:2,X=24:2,X=25:2,X=1:3,X=2:4,(X>26)&(X<30):5,X>29:6,1:"")
"RTN","RCDMC90",109,0)
 .Q:X=""  K CATYP(X)
"RTN","RCDMC90",110,0)
 .I $P(B6,U,21),$P(B6,U,21)<ESTDT S ESTDT=$P($P(B6,U,21),".")
"RTN","RCDMC90",111,0)
 .I $P(B12,U,2),PRIN>$P(B12,U,2) S PRIN=$P(B12,U,2)
"RTN","RCDMC90",112,0)
 .S ^TMP($J,"RCDMC90","BILL",BILL)=$S($P(B12,U):$P(B12,U),1:DT)_U_PRIN_U_INT_U_ADMIN
"RTN","RCDMC90",113,0)
 .S TPRIN=TPRIN+PRIN,TINT=TINT+INT,TADMIN=TADMIN+ADMIN
"RTN","RCDMC90",114,0)
 .Q
"RTN","RCDMC90",115,0)
TOTAL S TOTAL=TPRIN+TINT+TADMIN
"RTN","RCDMC90",116,0)
 I RCDOC="M" Q:TOTAL<25  Q:TPRIN'>0
"RTN","RCDMC90",117,0)
 I RCDOC="M",$P(VADM(2),U)["P" S PSSN=$P(VADM(2),U) D PSEUDO^RCDMC90U(DFN,PSSN) Q
"RTN","RCDMC90",118,0)
 I RCDOC="W" Q:(TOTAL_U_TPRIN_U_TINT_U_TADMIN)=$P(^RCD(340,DEBTOR,3),U,5,8)
"RTN","RCDMC90",119,0)
 S DFN=+DEBTOR0
"RTN","RCDMC90",120,0)
 ;SETS CATEGORY CODE 1=MEANS TEST,2=PHARMACY,3=INEL.,4=EMER./HUM.
"RTN","RCDMC90",121,0)
 ;5=CHAMPVA,6=TRICARE OR ANY COMBINATION THEREOF
"RTN","RCDMC90",122,0)
 S CATYP="" F X=1:1:6 S:'$D(CATYP(X)) CATYP=CATYP_X
"RTN","RCDMC90",123,0)
 S CATYP=$$LJ^XLFSTR(CATYP,6)
"RTN","RCDMC90",124,0)
 ;
"RTN","RCDMC90",125,0)
 ;Send Master/Weekly error msg if Unknown or Invalid address
"RTN","RCDMC90",126,0)
 ;If Master update, quit and don't refer to DMC
"RTN","RCDMC90",127,0)
 ;If Weekly update, send a zero balance
"RTN","RCDMC90",128,0)
 S LKUP=$$CHKADD(DEBTOR)
"RTN","RCDMC90",129,0)
 I LKUP D ERROR^RCDMC90U(RCDOC,LKUP,DFN)  Q:RCDOC="M"  S (TOTAL,TPRIN,TINT,TADMIN)=0
"RTN","RCDMC90",130,0)
 ;
"RTN","RCDMC90",131,0)
 S ZIPCODE=$TR($P(ADDR,U,6),"-")
"RTN","RCDMC90",132,0)
 ;
"RTN","RCDMC90",133,0)
 ;Retrieve and format patient phone number
"RTN","RCDMC90",134,0)
 S ADDRPHO=$P(ADDR,U,7),PHONE=""
"RTN","RCDMC90",135,0)
 F I=1:1:$L(ADDRPHO) S CHKPHONE=$E(ADDRPHO,I) I CHKPHONE?1N S PHONE=PHONE_CHKPHONE
"RTN","RCDMC90",136,0)
 S PHONE=$S(PHONE?10N:PHONE,PHONE?7N:"   "_PHONE,1:"          ")
"RTN","RCDMC90",137,0)
 ;
"RTN","RCDMC90",138,0)
 I RCDOC="W",TOTAL=0 D
"RTN","RCDMC90",139,0)
 .K ^RCD(340,"DMC",1,DEBTOR),^RCD(340,DEBTOR,3)
"RTN","RCDMC90",140,0)
 .N NM,XMSUB,XMY,XMTEXT,MSG
"RTN","RCDMC90",141,0)
 .S XMSUB="Deletion of Debtor from DMC"
"RTN","RCDMC90",142,0)
 .S XMY("G.DMX")=""
"RTN","RCDMC90",143,0)
 .S XMDUZ="AR PACKAGE"
"RTN","RCDMC90",144,0)
 .S XMTEXT="MSG("
"RTN","RCDMC90",145,0)
 .S MSG(1)="The following patient has a DMC balance of '0'"
"RTN","RCDMC90",146,0)
 .S MSG(2)="and will be deleted from the DMC system:"
"RTN","RCDMC90",147,0)
 .S MSG(3)=" "
"RTN","RCDMC90",148,0)
 .S MSG(4)=$P(^DPT(DFN,0),U)_"   SSN:  "_$P(^(0),U,9)
"RTN","RCDMC90",149,0)
 .D ^XMD
"RTN","RCDMC90",150,0)
 .Q
"RTN","RCDMC90",151,0)
 S QUIT=0
"RTN","RCDMC90",152,0)
PROCQ Q
"RTN","RCDMC90",153,0)
DATE8(X) ;CHANGES FILEMAN DATE INTO 8 DIGIT DATE IN FORMAT MMDDYYYY
"RTN","RCDMC90",154,0)
 S X=$E(X,4,7)_($E(X,1,3)+1700)
"RTN","RCDMC90",155,0)
 Q X
"RTN","RCDMC90",156,0)
AMT(X) ;CHANGES AMOUNT TO ZERO FILLED, RIGHT JUSTIFIED
"RTN","RCDMC90",157,0)
 S X=$TR($J(X,0,2),".")
"RTN","RCDMC90",158,0)
 S X=$E("000000000",1,9-$L(X))_X
"RTN","RCDMC90",159,0)
 Q X
"RTN","RCDMC90",160,0)
NM(DFN) ;Returns first, middle, and last name in 3 different variables
"RTN","RCDMC90",161,0)
 N FN,LN,MN,NM,XN
"RTN","RCDMC90",162,0)
 S NM=$P($G(^DPT(DFN,0)),"^")
"RTN","RCDMC90",163,0)
 S LN=$TR($P(NM,",")," .'-"),MN=$P($P(NM,",",2)," ",2)
"RTN","RCDMC90",164,0)
 I ($E(MN,1,2)="SR")!($E(MN,1,2)="JR")!(MN?2.3"I")!(MN?0.1"I"1"V"1.3"I") S XN=MN,MN=""
"RTN","RCDMC90",165,0)
 I $G(XN)="" S XN=$P($P($G(NM),",",2)," ",3)
"RTN","RCDMC90",166,0)
 S FN=$P($P(NM,",",2)," ")
"RTN","RCDMC90",167,0)
QNM Q LN_"^"_XN_"^"_FN_"^"_MN
"RTN","RCDMC90",168,0)
BAL(DEBTOR) ;COMPUTES TOTAL OF ACTIVE BILLS THAT COULD BE SENT TO DMC
"RTN","RCDMC90",169,0)
 N BILL,BAL
"RTN","RCDMC90",170,0)
 S (BILL,BAL)=0
"RTN","RCDMC90",171,0)
 F  S BILL=$O(^PRCA(430,"C",DEBTOR,BILL)) Q:BILL'?1N.N  D
"RTN","RCDMC90",172,0)
 .S B0=$G(^PRCA(430,BILL,0)),B7=$G(^(7))
"RTN","RCDMC90",173,0)
 .Q:$P(B0,U,8)'=16
"RTN","RCDMC90",174,0)
 .S X=$P(B0,U,2),X=$S((X>0)&(X<6):1,X=18:1,(X>21)&(X<26):1,(X>26)&(X<33):1,1:"")
"RTN","RCDMC90",175,0)
 .Q:X=""
"RTN","RCDMC90",176,0)
 .S BAL=BAL+$P(B7,U)+$P(B7,U,2)+$P(B7,U,3)+$P(B7,U,4)+$P(B7,U,5)
"RTN","RCDMC90",177,0)
 .Q
"RTN","RCDMC90",178,0)
BALQ Q BAL
"RTN","RCDMC90",179,0)
SETREC ;SETS TEMPORARY GLOBAL FOR MAIL MESSAGE TO USERS
"RTN","RCDMC90",180,0)
 S RCNT=RCNT+1 D PID^VADPT S:$L(VA("BID"))=4 VA("BID")=" "_VA("BID")
"RTN","RCDMC90",181,0)
 S TLINE=($P(TLINE,U)+TPRIN)_U_($P(TLINE,U,2)+TINT)_U_($P(TLINE,U,3)+TADMIN)
"RTN","RCDMC90",182,0)
 S ^XTMP("RCDMC90",$J,"REC",$P(^DPT(DFN,0),U)_";"_DFN)=$$LJ^XLFSTR($E($P(^DPT(DFN,0),U),1,28),29)_" "_VA("BID")_" "_$J(TPRIN,10,2)_$J(TINT,10,2)_$J(TADMIN,10,2)_$J(TOTAL,10,2)
"RTN","RCDMC90",183,0)
 Q
"RTN","RCDMC90",184,0)
 ;
"RTN","RCDMC90",185,0)
CHKADD(DEBTOR) ; Checks for invalid and unknown addresses
"RTN","RCDMC90",186,0)
 N CHK S CHK=0,ADDR=""
"RTN","RCDMC90",187,0)
 I $P($G(^RCD(340,+DEBTOR,1)),"^",9)=1 S CHK=1 G CHKADDQ
"RTN","RCDMC90",188,0)
 S ADDR=$$DADD^RCAMADD(+DEBTOR,1) ;get address (confidential if possible) 
"RTN","RCDMC90",189,0)
 I ADDR'?.ANP!(ADDR["$")!(ADDR["**")!(ADDR["///")!(ADDR["ZZZ") S CHK=2
"RTN","RCDMC90",190,0)
CHKADDQ Q CHK
"RTN","RCDMC90",191,0)
 ;
"RTN","RCEXINAD")
0^8^B27913240
"RTN","RCEXINAD",1,0)
RCEXINAD ;ALB/MAF - Exempt int/admin for Katrina victims from 9/1/05 - patch install;3 Oct 05
"RTN","RCEXINAD",2,0)
 ;;4.5;Accounts Receivable;**237**;Mar 20, 1995
"RTN","RCEXINAD",3,0)
 ;;
"RTN","RCEXINAD",4,0)
 ;
"RTN","RCEXINAD",5,0)
START ;
"RTN","RCEXINAD",6,0)
 N ADMIN,BILLDA,DATE,INTEREST,PRINBAL,TRANDA,TRANTYPE,VALUE,RCNOHSIF,RCDFN,DATEEND,RCDEB,X
"RTN","RCEXINAD",7,0)
 ;  needs datebeg, dateend
"RTN","RCEXINAD",8,0)
 ;  total is total by category
"RTN","RCEXINAD",9,0)
 ;
"RTN","RCEXINAD",10,0)
 ;
"RTN","RCEXINAD",11,0)
 S RCNOHSIF=$$NOHSIF^RCRJRCO() ; no HSIF (disabled)
"RTN","RCEXINAD",12,0)
 ;
"RTN","RCEXINAD",13,0)
 K ^TMP("RCINTADM",$J)
"RTN","RCEXINAD",14,0)
 F TRANTYPE=13 D
"RTN","RCEXINAD",15,0)
 .   S DATE=3050901-1,DATEEND=9999999
"RTN","RCEXINAD",16,0)
 .   F  S DATE=$O(^PRCA(433,"AT",TRANTYPE,DATE)) Q:'DATE!(DATE>DATEEND)  D
"RTN","RCEXINAD",17,0)
 .   .   S TRANDA=0
"RTN","RCEXINAD",18,0)
 .   .   F  S TRANDA=$O(^PRCA(433,"AT",TRANTYPE,DATE,TRANDA)) Q:'TRANDA  D
"RTN","RCEXINAD",19,0)
 .   .   .   S BILLDA=+$P($G(^PRCA(433,TRANDA,0)),"^",2) I 'BILLDA Q
"RTN","RCEXINAD",20,0)
 .   .   .   ;  bill not linked to a site
"RTN","RCEXINAD",21,0)
 .   .   .   I '$P($G(^PRCA(430,BILLDA,0)),"^",12) Q
"RTN","RCEXINAD",22,0)
 .   .   .   S RCDEB=$P($G(^PRCA(430,BILLDA,0)),"^",9) Q:'+RCDEB  D  Q:'+RCDFN
"RTN","RCEXINAD",23,0)
 .   .   .   .   S RCDFN=0
"RTN","RCEXINAD",24,0)
 .   .   .   .   Q:$P($G(^RCD(340,+RCDEB,0)),"^",1)'["DPT"
"RTN","RCEXINAD",25,0)
 .   .   .   .   S RCDFN=+$P($G(^RCD(340,+RCDEB,0)),"^",1)
"RTN","RCEXINAD",26,0)
 .   .   .   .   Q
"RTN","RCEXINAD",27,0)
 .   .   .   ;Check if emergency response victim
"RTN","RCEXINAD",28,0)
 .   .   .   I $$EMERES^PRCAUTL(+RCDFN)']"" Q
"RTN","RCEXINAD",29,0)
 .   .   .   S ^TMP("RCINTADM",$J,RCDFN,BILLDA)=""
"RTN","RCEXINAD",30,0)
 .   .   .   Q
"RTN","RCEXINAD",31,0)
 I '$D(^TMP("RCINTADM",$J)) Q
"RTN","RCEXINAD",32,0)
 N BILLDA,RCDFN,PAYDAT
"RTN","RCEXINAD",33,0)
 S (RCDFN,BILLDA)=0,PAYDAT=3050901
"RTN","RCEXINAD",34,0)
 F  S RCDFN=$O(^TMP("RCINTADM",$J,RCDFN)) Q:RCDFN']""  F  S BILLDA=$O(^TMP("RCINTADM",$J,RCDFN,BILLDA)) Q:BILLDA']""  D EXEMPT(BILLDA,PAYDAT)
"RTN","RCEXINAD",35,0)
 Q
"RTN","RCEXINAD",36,0)
 ;
"RTN","RCEXINAD",37,0)
 ;
"RTN","RCEXINAD",38,0)
EXEMPT(RCBILLDA,RCPAYDAT) ;  exempt interest/admin/penalty charges
"RTN","RCEXINAD",39,0)
 ;  added after the payment date
"RTN","RCEXINAD",40,0)
 N ADMIN,BILLBAL,COMMENT,INTEREST,PENALTY,RCDATE,RCEXTRAN,RCFLAG,RCLIST,RCTRANDA,TRANDA,DATE,RCEND,RCEXEM
"RTN","RCEXINAD",41,0)
 ;
"RTN","RCEXINAD",42,0)
 S BILLBAL=$$GETTRANS^RCDPBTLM(RCBILLDA)
"RTN","RCEXINAD",43,0)
 ;  no interest or admin to exempt
"RTN","RCEXINAD",44,0)
 I ($P(BILLBAL,"^",2)+$P(BILLBAL,"^",3))=0 Q
"RTN","RCEXINAD",45,0)
 ;  loop thru transactions after payment date and look for
"RTN","RCEXINAD",46,0)
 ;  interest/admin charge transactions to exempt
"RTN","RCEXINAD",47,0)
 S RCDATE=RCPAYDAT-.1
"RTN","RCEXINAD",48,0)
 ;set an end date so that no transactions beyond the emergency response end date are exempted
"RTN","RCEXINAD",49,0)
 S X=$P($G(^RC(342,1,30)),"^",2)
"RTN","RCEXINAD",50,0)
 S RCEND=$S('X:DT,DT<X:DT,1:X)
"RTN","RCEXINAD",51,0)
 F  S RCDATE=$O(RCLIST(RCDATE)) Q:'RCDATE!(RCDATE>RCEND)  D
"RTN","RCEXINAD",52,0)
 .   S RCTRANDA=0
"RTN","RCEXINAD",53,0)
 .   F  S RCTRANDA=$O(RCLIST(RCDATE,RCTRANDA)) Q:'RCTRANDA  D
"RTN","RCEXINAD",54,0)
 .   .   I RCLIST(RCDATE,RCTRANDA)'["INTEREST/ADM. CHARGE" Q
"RTN","RCEXINAD",55,0)
 .   .   ;  interest/admin/penalty charge added after payment date
"RTN","RCEXINAD",56,0)
 .   .   ;  exempt the charge
"RTN","RCEXINAD",57,0)
 .   .   ;
"RTN","RCEXINAD",58,0)
 .   .   ;  check to see if charge is already exempted
"RTN","RCEXINAD",59,0)
 .   .   ;  the charge would be on the same date
"RTN","RCEXINAD",60,0)
 .   .   ;  for example:
"RTN","RCEXINAD",61,0)
 .   .   ;    rclist(3000424,2742117)=INTEREST/ADM. CHARGE^^ .68^ .45^0^0
"RTN","RCEXINAD",62,0)
 .   .   ;    rclist(3000424,2750151)=EXEMPT INT/ADM. COST^^-.68^-.45^0^0
"RTN","RCEXINAD",63,0)
 .   .   S RCFLAG=0
"RTN","RCEXINAD",64,0)
 .   .   S TRANDA=RCTRANDA,DATE=RCDATE-.1
"RTN","RCEXINAD",65,0)
 .   .   F  S DATE=$O(RCLIST(DATE)) Q:'DATE!(RCFLAG)  F  S TRANDA=$O(RCLIST(DATE,TRANDA)) Q:'TRANDA!(RCFLAG)  D  I RCFLAG Q
"RTN","RCEXINAD",66,0)
 .   .   .   I RCLIST(DATE,TRANDA)'["EXEMPT INT/ADM. COST" Q
"RTN","RCEXINAD",67,0)
 .   .   .   ;skip exemption if it has already been matched with another interest charge
"RTN","RCEXINAD",68,0)
 .   .   .   Q:$D(RCEXEM(TRANDA))
"RTN","RCEXINAD",69,0)
 .   .   .   ;  compare interest values (p3) and admin (p4)
"RTN","RCEXINAD",70,0)
 .   .   .   I +$P(RCLIST(RCDATE,RCTRANDA),"^",3)'=-$P(RCLIST(DATE,TRANDA),"^",3) Q
"RTN","RCEXINAD",71,0)
 .   .   .   I +$P(RCLIST(RCDATE,RCTRANDA),"^",4)'=-$P(RCLIST(DATE,TRANDA),"^",4) Q
"RTN","RCEXINAD",72,0)
 .   .   .   ;  transaction already exempted; save transaction as one already matched
"RTN","RCEXINAD",73,0)
 .   .   .   S RCFLAG=1,RCEXEM(TRANDA)=""
"RTN","RCEXINAD",74,0)
 .   .   I $G(RCFLAG) Q
"RTN","RCEXINAD",75,0)
 .   .   ;
"RTN","RCEXINAD",76,0)
 .   .   S INTEREST=$P(RCLIST(RCDATE,RCTRANDA),"^",3)
"RTN","RCEXINAD",77,0)
 .   .   S ADMIN=$P(RCLIST(RCDATE,RCTRANDA),"^",4)
"RTN","RCEXINAD",78,0)
 .   .   I 'INTEREST,'ADMIN Q
"RTN","RCEXINAD",79,0)
 .   .   ;
"RTN","RCEXINAD",80,0)
 .   .   ;  check to make sure the amount being exempted does not
"RTN","RCEXINAD",81,0)
 .   .   ;  exceed the balance of the bill
"RTN","RCEXINAD",82,0)
 .   .   I INTEREST>$P(BILLBAL,"^",2) Q
"RTN","RCEXINAD",83,0)
 .   .   I ADMIN>$P(BILLBAL,"^",3) Q
"RTN","RCEXINAD",84,0)
 .   .   ;
"RTN","RCEXINAD",85,0)
 .   .   ;  get the penalty charge from the transaction.  this charge is computed in the
"RTN","RCEXINAD",86,0)
 .   .   ;  admin value, so subtract it from admin
"RTN","RCEXINAD",87,0)
 .   .   S PENALTY=$P($G(^PRCA(433,RCTRANDA,2)),"^",9)
"RTN","RCEXINAD",88,0)
 .   .   I PENALTY S ADMIN=ADMIN-PENALTY S:ADMIN<0 ADMIN=0
"RTN","RCEXINAD",89,0)
 .   .   ;
"RTN","RCEXINAD",90,0)
 .   .   ;  add the exempt transaction to file 433 with the date
"RTN","RCEXINAD",91,0)
 .   .   ;  equal to the date the int/admin charge created
"RTN","RCEXINAD",92,0)
 .   .   S COMMENT(1)="Auto exemption of "_RCTRANDA_", charges applied "_$S(RCDATE=RCPAYDAT:"on ",1:"after ")_$$FORMATDT^RCBECHGA(RCPAYDAT)_" for Hurricane Katrina victims."
"RTN","RCEXINAD",93,0)
 .   .   ;  make sure the time is entered for date processed in file 433 1;9
"RTN","RCEXINAD",94,0)
 .   .   ;  if not, it will show as being out of balance on patient statement
"RTN","RCEXINAD",95,0)
 .   .   ;  this was added for patch 162.
"RTN","RCEXINAD",96,0)
 .   .   ;
"RTN","RCEXINAD",97,0)
 .   .   ;  patch 165 removed the process date passed so the current date
"RTN","RCEXINAD",98,0)
 .   .   ;  and time would be used.  this will prevent statements from
"RTN","RCEXINAD",99,0)
 .   .   ;  being out of balance.
"RTN","RCEXINAD",100,0)
 .   .   ;N %,%H,%I,PROCDATE
"RTN","RCEXINAD",101,0)
 .   .   ;D NOW^%DTC S PROCDATE=$P(RCDATE,".")_"."_$P(%,".",2)
"RTN","RCEXINAD",102,0)
 .   .   S RCEXTRAN=$$EXEMPT^RCBEUTR2(RCBILLDA,INTEREST_"^"_ADMIN_"^"_PENALTY,.COMMENT,0)
"RTN","RCEXINAD",103,0)
 Q
"RTN","RCYPO237")
0^3^B33903672
"RTN","RCYPO237",1,0)
RCYPO237 ;ALB/MAF - Post-init to cancel int/admin for Katrina victims from 9/1/05 - patch install;3 Oct 05
"RTN","RCYPO237",2,0)
 ;;4.5;Accounts Receivable;**237**;Mar 20, 1995
"RTN","RCYPO237",3,0)
 ;;
"RTN","RCYPO237",4,0)
 ;
"RTN","RCYPO237",5,0)
START ;
"RTN","RCYPO237",6,0)
 N ADMIN,BILLDA,DATE,INTEREST,PRINBAL,TRANDA,TRANTYPE,VALUE,RCNOHSIF,RCDFN,DATEEND,RCDEB,X
"RTN","RCYPO237",7,0)
 D BMES^XPDUTL(">>>>>>> Exempting the interest and administrative charges calculated <<<<<<<")
"RTN","RCYPO237",8,0)
 D MES^XPDUTL("              for Katrina affected patients from 9/1/05 - Today. ")
"RTN","RCYPO237",9,0)
 D BMES^XPDUTL("The post-init RCYPO237, will exempt interest and administrative charges")
"RTN","RCYPO237",10,0)
 D MES^XPDUTL("accrued for affected veterans from 9/1/05 until the installation of this ")
"RTN","RCYPO237",11,0)
 D MES^XPDUTL("patch. For all Hurricane Katrina affected veterans, on every outstanding ")
"RTN","RCYPO237",12,0)
 D MES^XPDUTL("bill, the interest and administrative charges accrued from 9/1/05 until ")
"RTN","RCYPO237",13,0)
 D MES^XPDUTL("the installation of this patch will be exempted.")
"RTN","RCYPO237",14,0)
 ;  needs datebeg, dateend
"RTN","RCYPO237",15,0)
 ;  total is total by category
"RTN","RCYPO237",16,0)
 ;
"RTN","RCYPO237",17,0)
 ;
"RTN","RCYPO237",18,0)
 S RCNOHSIF=$$NOHSIF^RCRJRCO() ; no HSIF (disabled)
"RTN","RCYPO237",19,0)
 ;
"RTN","RCYPO237",20,0)
 K ^TMP("RCINTADM",$J)
"RTN","RCYPO237",21,0)
 F TRANTYPE=13 D
"RTN","RCYPO237",22,0)
 .   S DATE=3050901-1,DATEEND=9999999
"RTN","RCYPO237",23,0)
 .   F  S DATE=$O(^PRCA(433,"AT",TRANTYPE,DATE)) Q:'DATE!(DATE>DATEEND)  D
"RTN","RCYPO237",24,0)
 .   .   S TRANDA=0
"RTN","RCYPO237",25,0)
 .   .   F  S TRANDA=$O(^PRCA(433,"AT",TRANTYPE,DATE,TRANDA)) Q:'TRANDA  D
"RTN","RCYPO237",26,0)
 .   .   .   S BILLDA=+$P($G(^PRCA(433,TRANDA,0)),"^",2) I 'BILLDA Q
"RTN","RCYPO237",27,0)
 .   .   .   ;  bill not linked to a site
"RTN","RCYPO237",28,0)
 .   .   .   I '$P($G(^PRCA(430,BILLDA,0)),"^",12) Q
"RTN","RCYPO237",29,0)
 .   .   .   S RCDEB=$P($G(^PRCA(430,BILLDA,0)),"^",9) Q:'+RCDEB  D  Q:'+RCDFN
"RTN","RCYPO237",30,0)
 .   .   .   .   S RCDFN=0
"RTN","RCYPO237",31,0)
 .   .   .   .   Q:$P($G(^RCD(340,+RCDEB,0)),"^",1)'["DPT"
"RTN","RCYPO237",32,0)
 .   .   .   .   S RCDFN=+$P($G(^RCD(340,+RCDEB,0)),"^",1)
"RTN","RCYPO237",33,0)
 .   .   .   .   Q
"RTN","RCYPO237",34,0)
 .   .   .   ;Check if emergency response victim
"RTN","RCYPO237",35,0)
 .   .   .   I $$EMERES^PRCAUTL(+RCDFN)']"" Q
"RTN","RCYPO237",36,0)
 .   .   .   S ^TMP("RCINTADM",$J,RCDFN,BILLDA)=""
"RTN","RCYPO237",37,0)
 .   .   .   Q
"RTN","RCYPO237",38,0)
 I '$D(^TMP("RCINTADM",$J)) D BMES^XPDUTL("* There are no Katrina affected patients at this facility.  No charges exempted.") Q
"RTN","RCYPO237",39,0)
 N BILLDA,RCDFN,PAYDAT
"RTN","RCYPO237",40,0)
 S (RCDFN,BILLDA)=0,PAYDAT=3050901
"RTN","RCYPO237",41,0)
 F  S RCDFN=$O(^TMP("RCINTADM",$J,RCDFN)) Q:RCDFN']""  F  S BILLDA=$O(^TMP("RCINTADM",$J,RCDFN,BILLDA)) Q:BILLDA']""  D EXEMPT(BILLDA,PAYDAT)
"RTN","RCYPO237",42,0)
 D BMES^XPDUTL("Done")
"RTN","RCYPO237",43,0)
 Q
"RTN","RCYPO237",44,0)
 ;
"RTN","RCYPO237",45,0)
 ;
"RTN","RCYPO237",46,0)
EXEMPT(RCBILLDA,RCPAYDAT) ;  exempt interest/admin/penalty charges
"RTN","RCYPO237",47,0)
 ;  added after the payment date
"RTN","RCYPO237",48,0)
 N ADMIN,BILLBAL,COMMENT,INTEREST,PENALTY,RCDATE,RCEXTRAN,RCFLAG,RCLIST,RCTRANDA,TRANDA,DATE,RCEND,RCEXEM
"RTN","RCYPO237",49,0)
 ;
"RTN","RCYPO237",50,0)
 S BILLBAL=$$GETTRANS^RCDPBTLM(RCBILLDA)
"RTN","RCYPO237",51,0)
 ;  no interest or admin to exempt
"RTN","RCYPO237",52,0)
 I ($P(BILLBAL,"^",2)+$P(BILLBAL,"^",3))=0 Q
"RTN","RCYPO237",53,0)
 ;  loop thru transactions after payment date and look for
"RTN","RCYPO237",54,0)
 ;  interest/admin charge transactions to exempt
"RTN","RCYPO237",55,0)
 S RCDATE=RCPAYDAT-.1
"RTN","RCYPO237",56,0)
 ;set an end date so that no transactions beyond the emergency response end date are exempted
"RTN","RCYPO237",57,0)
 S X=$P($G(^RC(342,1,30)),"^",2)
"RTN","RCYPO237",58,0)
 S RCEND=$S('X:DT,DT<X:DT,1:X)
"RTN","RCYPO237",59,0)
 F  S RCDATE=$O(RCLIST(RCDATE)) Q:'RCDATE!(RCDATE>RCEND)  D
"RTN","RCYPO237",60,0)
 .   S RCTRANDA=0
"RTN","RCYPO237",61,0)
 .   F  S RCTRANDA=$O(RCLIST(RCDATE,RCTRANDA)) Q:'RCTRANDA  D
"RTN","RCYPO237",62,0)
 .   .   I RCLIST(RCDATE,RCTRANDA)'["INTEREST/ADM. CHARGE" Q
"RTN","RCYPO237",63,0)
 .   .   ;  interest/admin/penalty charge added after payment date
"RTN","RCYPO237",64,0)
 .   .   ;  exempt the charge
"RTN","RCYPO237",65,0)
 .   .   ;
"RTN","RCYPO237",66,0)
 .   .   ;  check to see if charge is already exempted
"RTN","RCYPO237",67,0)
 .   .   ;  the charge would be on the same date
"RTN","RCYPO237",68,0)
 .   .   ;  for example:
"RTN","RCYPO237",69,0)
 .   .   ;    rclist(3000424,2742117)=INTEREST/ADM. CHARGE^^ .68^ .45^0^0
"RTN","RCYPO237",70,0)
 .   .   ;    rclist(3000424,2750151)=EXEMPT INT/ADM. COST^^-.68^-.45^0^0
"RTN","RCYPO237",71,0)
 .   .   S RCFLAG=0
"RTN","RCYPO237",72,0)
 .   .   S TRANDA=RCTRANDA,DATE=RCDATE-.1
"RTN","RCYPO237",73,0)
 .   .   F  S DATE=$O(RCLIST(DATE)) Q:'DATE!(RCFLAG)  F  S TRANDA=$O(RCLIST(DATE,TRANDA)) Q:'TRANDA!(RCFLAG)  D  I RCFLAG Q
"RTN","RCYPO237",74,0)
 .   .   .   I RCLIST(DATE,TRANDA)'["EXEMPT INT/ADM. COST" Q
"RTN","RCYPO237",75,0)
 .   .   .   ;skip exemption if it has already been matched with another interest charge
"RTN","RCYPO237",76,0)
 .   .   .   Q:$D(RCEXEM(TRANDA))
"RTN","RCYPO237",77,0)
 .   .   .   ;  compare interest values (p3) and admin (p4)
"RTN","RCYPO237",78,0)
 .   .   .   I +$P(RCLIST(RCDATE,RCTRANDA),"^",3)'=-$P(RCLIST(DATE,TRANDA),"^",3) Q
"RTN","RCYPO237",79,0)
 .   .   .   I +$P(RCLIST(RCDATE,RCTRANDA),"^",4)'=-$P(RCLIST(DATE,TRANDA),"^",4) Q
"RTN","RCYPO237",80,0)
 .   .   .   ;  transaction already exempted; save transaction as one already matched
"RTN","RCYPO237",81,0)
 .   .   .   S RCFLAG=1,RCEXEM(TRANDA)=""
"RTN","RCYPO237",82,0)
 .   .   I $G(RCFLAG) Q
"RTN","RCYPO237",83,0)
 .   .   ;
"RTN","RCYPO237",84,0)
 .   .   S INTEREST=$P(RCLIST(RCDATE,RCTRANDA),"^",3)
"RTN","RCYPO237",85,0)
 .   .   S ADMIN=$P(RCLIST(RCDATE,RCTRANDA),"^",4)
"RTN","RCYPO237",86,0)
 .   .   I 'INTEREST,'ADMIN Q
"RTN","RCYPO237",87,0)
 .   .   ;
"RTN","RCYPO237",88,0)
 .   .   ;  check to make sure the amount being exempted does not
"RTN","RCYPO237",89,0)
 .   .   ;  exceed the balance of the bill
"RTN","RCYPO237",90,0)
 .   .   I INTEREST>$P(BILLBAL,"^",2) Q
"RTN","RCYPO237",91,0)
 .   .   I ADMIN>$P(BILLBAL,"^",3) Q
"RTN","RCYPO237",92,0)
 .   .   ;
"RTN","RCYPO237",93,0)
 .   .   ;  get the penalty charge from the transaction.  this charge is computed in the
"RTN","RCYPO237",94,0)
 .   .   ;  admin value, so subtract it from admin
"RTN","RCYPO237",95,0)
 .   .   S PENALTY=$P($G(^PRCA(433,RCTRANDA,2)),"^",9)
"RTN","RCYPO237",96,0)
 .   .   I PENALTY S ADMIN=ADMIN-PENALTY S:ADMIN<0 ADMIN=0
"RTN","RCYPO237",97,0)
 .   .   ;
"RTN","RCYPO237",98,0)
 .   .   ;  add the exempt transaction to file 433 with the date
"RTN","RCYPO237",99,0)
 .   .   ;  equal to the date the int/admin charge created
"RTN","RCYPO237",100,0)
 .   .   S COMMENT(1)="Auto exemption of "_RCTRANDA_", charges applied "_$S(RCDATE=RCPAYDAT:"on ",1:"after ")_$$FORMATDT^RCBECHGA(RCPAYDAT)_" for Hurricane Katrina victims."
"RTN","RCYPO237",101,0)
 .   .   ;  make sure the time is entered for date processed in file 433 1;9
"RTN","RCYPO237",102,0)
 .   .   ;  if not, it will show as being out of balance on patient statement
"RTN","RCYPO237",103,0)
 .   .   ;  this was added for patch 162.
"RTN","RCYPO237",104,0)
 .   .   ;
"RTN","RCYPO237",105,0)
 .   .   ;  patch 165 removed the process date passed so the current date
"RTN","RCYPO237",106,0)
 .   .   ;  and time would be used.  this will prevent statements from
"RTN","RCYPO237",107,0)
 .   .   ;  being out of balance.
"RTN","RCYPO237",108,0)
 .   .   ;N %,%H,%I,PROCDATE
"RTN","RCYPO237",109,0)
 .   .   ;D NOW^%DTC S PROCDATE=$P(RCDATE,".")_"."_$P(%,".",2)
"RTN","RCYPO237",110,0)
 .   .   S RCEXTRAN=$$EXEMPT^RCBEUTR2(RCBILLDA,INTEREST_"^"_ADMIN_"^"_PENALTY,.COMMENT,0)
"RTN","RCYPO237",111,0)
 Q
"VER")
8.0^22.0
"BLD",6412,6)
^208
**END**
**END**
