Released PSD*3*50 SEQ #41
Extracted from mail message
**KIDS**:PSD*3.0*50^

**INSTALL NAME**
PSD*3.0*50
"BLD",4933,0)
PSD*3.0*50^CONTROLLED SUBSTANCES^0^3040920^y
"BLD",4933,1,0)
^^2^2^3040728^
"BLD",4933,1,1,0)
This patch will correct the problem of the same person being
"BLD",4933,1,2,0)
entered as the witness and the nurse that signed out the dose.
"BLD",4933,4,0)
^9.64PA^^
"BLD",4933,"ABPKG")
n
"BLD",4933,"KRN",0)
^9.67PA^8989.52^19
"BLD",4933,"KRN",.4,0)
.4
"BLD",4933,"KRN",.401,0)
.401
"BLD",4933,"KRN",.402,0)
.402
"BLD",4933,"KRN",.403,0)
.403
"BLD",4933,"KRN",.5,0)
.5
"BLD",4933,"KRN",.84,0)
.84
"BLD",4933,"KRN",3.6,0)
3.6
"BLD",4933,"KRN",3.8,0)
3.8
"BLD",4933,"KRN",9.2,0)
9.2
"BLD",4933,"KRN",9.8,0)
9.8
"BLD",4933,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4933,"KRN",9.8,"NM",1,0)
PSDRFS^^0^B22721083
"BLD",4933,"KRN",9.8,"NM",2,0)
PSDRFU^^0^B6733503
"BLD",4933,"KRN",9.8,"NM","B","PSDRFS",1)

"BLD",4933,"KRN",9.8,"NM","B","PSDRFU",2)

"BLD",4933,"KRN",19,0)
19
"BLD",4933,"KRN",19.1,0)
19.1
"BLD",4933,"KRN",101,0)
101
"BLD",4933,"KRN",409.61,0)
409.61
"BLD",4933,"KRN",771,0)
771
"BLD",4933,"KRN",870,0)
870
"BLD",4933,"KRN",8989.51,0)
8989.51
"BLD",4933,"KRN",8989.52,0)
8989.52
"BLD",4933,"KRN",8994,0)
8994
"BLD",4933,"KRN","B",.4,.4)

"BLD",4933,"KRN","B",.401,.401)

"BLD",4933,"KRN","B",.402,.402)

"BLD",4933,"KRN","B",.403,.403)

"BLD",4933,"KRN","B",.5,.5)

"BLD",4933,"KRN","B",.84,.84)

"BLD",4933,"KRN","B",3.6,3.6)

"BLD",4933,"KRN","B",3.8,3.8)

"BLD",4933,"KRN","B",9.2,9.2)

"BLD",4933,"KRN","B",9.8,9.8)

"BLD",4933,"KRN","B",19,19)

"BLD",4933,"KRN","B",19.1,19.1)

"BLD",4933,"KRN","B",101,101)

"BLD",4933,"KRN","B",409.61,409.61)

"BLD",4933,"KRN","B",771,771)

"BLD",4933,"KRN","B",870,870)

"BLD",4933,"KRN","B",8989.51,8989.51)

"BLD",4933,"KRN","B",8989.52,8989.52)

"BLD",4933,"KRN","B",8994,8994)

"BLD",4933,"QUES",0)
^9.62^^
"BLD",4933,"REQB",0)
^9.611^1^1
"BLD",4933,"REQB",1,0)
PSD*3.0*25^1
"BLD",4933,"REQB","B","PSD*3.0*25",1)

"MBREQ")
0
"PKG",276,-1)
1^1
"PKG",276,0)
CONTROLLED SUBSTANCES^PSD^Controlled Substances Inventory and Tracking module.
"PKG",276,20,0)
^9.402P^^
"PKG",276,22,0)
^9.49I^1^1
"PKG",276,22,1,0)
3.0^2970213^2970430^11595
"PKG",276,22,1,"PAH",1,0)
50^3040920
"PKG",276,22,1,"PAH",1,1,0)
^^2^2^3040920
"PKG",276,22,1,"PAH",1,1,1,0)
This patch will correct the problem of the same person being
"PKG",276,22,1,"PAH",1,1,2,0)
entered as the witness and the nurse that signed out the dose.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSDRFS")
0^1^B22721083
"RTN","PSDRFS",1,0)
PSDRFS ;BIR/JPW,LTL-Nurse RF Delayed Dispensing ;8 Aug 94
"RTN","PSDRFS",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;**25,50**;13 Feb 97
"RTN","PSDRFS",3,0)
 ;Reference to ^PSD(58.8 are covered by DBIA #2711
"RTN","PSDRFS",4,0)
 ;Reference to ^PSD(58.81 are covered by DBIA #2808
"RTN","PSDRFS",5,0)
 ;Reference to ^PSDRUG( are covered by DBIA #221
"RTN","PSDRFS",6,0)
 ;Reference to $$WITNESS^XUVERIFY are covered by DBIA #1513
"RTN","PSDRFS",7,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRFS",8,0)
 ;S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,1:0) I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to order",!,?12,"narcotic supplies.",! K OK Q
"RTN","PSDRFS",9,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH G END
"RTN","PSDRFS",10,0)
 S PSDUZ=DUZ,(MSG,MSG1)=0,Y=DT X ^DD("DD") S REQD=Y
"RTN","PSDRFS",11,0)
NURSE N X,X1 D SIG^XUSESIG I X1="" G END
"RTN","PSDRFS",12,0)
NAOU ;select NAOU to dispense from
"RTN","PSDRFS",13,0)
 I $G(NAOU) S PSDS=+$P(^PSD(58.8,NAOU,0),U,4) G PATIENT
"RTN","PSDRFS",14,0)
 W !!,"Please enter the ward from which the drug(s) will be signed out."
"RTN","PSDRFS",15,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Ward: "
"RTN","PSDRFS",16,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDRFS",17,0)
 W ! D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDRFS",18,0)
 I '$D(^PSD(58.8,NAOU,0)) S MSG=1 D MSG G END
"RTN","PSDRFS",19,0)
 I '$O(^PSD(58.8,NAOU,1,0)) S MSG=1,MSG1=2 D MSG G END
"RTN","PSDRFS",20,0)
 I '$P(^PSD(58.8,NAOU,0),U,4) S MSG=2 D MSG G END
"RTN","PSDRFS",21,0)
 S PSDS=+$P(^PSD(58.8,NAOU,0),"^",4),PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5) I '+PSDS S (MSG,MSG1)=1 D MSG G END
"RTN","PSDRFS",22,0)
 I '$D(^PSD(58.8,+PSDS,0)) S MSG=2 D MSG G END
"RTN","PSDRFS",23,0)
 I '$O(^PSD(58.8,+PSDS,1,0)) S MSG=2,MSG1=2 D MSG G END
"RTN","PSDRFS",24,0)
 ;S TYPE=$P(^PSD(58.8,+PSDS,0),"^",2),OKTYP=$S(TYPE="M":1,TYPE="S":1,1:0) I 'OKTYP W !!,"Contact your Pharmacy Coordinator.",!,"The Pharmacy Dispensing Site is invalid for this NAOU." G END
"RTN","PSDRFS",25,0)
PATIENT N DIC,DTOUT,DUOUT,X,Y,PSDOUT S DIC="^DPT(",DIC(0)="AEMQ"
"RTN","PSDRFS",26,0)
 S DIC("A")="Scan/Enter Patient: "
"RTN","PSDRFS",27,0)
 W ! D ^DIC K DIC G:Y<1 END S PAT=+Y
"RTN","PSDRFS",28,0)
DRUG ;select drug
"RTN","PSDRFS",29,0)
 N DIR,PSD,PSDR,PSDQ,WQTY
"RTN","PSDRFS",30,0)
 S DIR(0)="FAO^1:40"
"RTN","PSDRFS",31,0)
 S DIR("A")="Scan Drug Label or Enter Label # or Drug: "
"RTN","PSDRFS",32,0)
 W ! D ^DIR K DIR G:Y="" PATIENT G:$D(DIRUT) END
"RTN","PSDRFS",33,0)
 I $L(Y)=1,Y'=" " W $C(7),!!,"Please enter more than one character.",! G DRUG
"RTN","PSDRFS",34,0)
 I $O(^PSD(58.81,"D",Y,0)) D  I '$G(PSDR) W $C(7),!!,"This is not a valid Pharmacy Dispensing number for this ward.",!! G END
"RTN","PSDRFS",35,0)
 .S PSD=0
"RTN","PSDRFS",36,0)
 .F  S PSD=$O(^PSD(58.81,"D",Y,PSD)) Q:'PSD  S PSD(1)=$G(^PSD(58.81,PSD,0)) I $P(PSD(1),U,11)>3,$P(PSD(1),U,18)=NAOU S PSDR=$P(PSD(1),U,5),PSDPN=$P(PSD(1),U,17),PSDTYP=17 Q
"RTN","PSDRFS",37,0)
 W:$G(PSDR) !!,$P($G(^PSDRUG(PSDR,0)),U)
"RTN","PSDRFS",38,0)
 D:'$G(PSDR)  G:$D(DTOUT)!($D(DUOUT)) END G:Y<1 PATIENT
"RTN","PSDRFS",39,0)
 .S DIC="^PSD(58.8,NAOU,1,",DIC(0)="EMQSZ",DA(1)=NAOU
"RTN","PSDRFS",40,0)
 .S DIC("S")="I $P($G(^(0)),U,4)"
"RTN","PSDRFS",41,0)
 .W ! D ^DIC K DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)
"RTN","PSDRFS",42,0)
 .S PSDR=+Y,PSDTYP=17
"RTN","PSDRFS",43,0)
 ;S DIC="^PSD(58.81,",DIC(0)="EMQSZ"
"RTN","PSDRFS",44,0)
 ;S DIC("S")="I $P(^(0),U,11)>3,$P(^(0),U,18)=NAOU"
"RTN","PSDRFS",45,0)
 ;W ! D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT)) END G:Y<1 PATIENT
"RTN","PSDRFS",46,0)
 ;S PSDR=$P(Y(0),U,5),PSDPN=$P(Y(0),U,17),PSDTYP=17
"RTN","PSDRFS",47,0)
BAL S PSDR(1)=$G(^PSD(58.8,NAOU,1,PSDR,0)),OQTY=$P(PSDR(1),U,4)
"RTN","PSDRFS",48,0)
 I 'OQTY,'$P($G(^PSD(58.81,+$G(PSD),9)),U) W !!,"Sorry, this drug has a zero balance." G DRUG
"RTN","PSDRFS",49,0)
 ;PSD*3*25 (DAVE B)
"RTN","PSDRFS",50,0)
 K PSDDAVE D ^PSDRFV I $G(PSDDAVE)=1 K PSDDAVE S PSDOUT=1 G END
"RTN","PSDRFS",51,0)
 S DIR(0)="Y",DIR("A")="Starting Balance:  "_OQTY_" "_$P(PSDR(1),U,8)_"     Correct count"
"RTN","PSDRFS",52,0)
 S DIR("B")="Yes",NUR1=DUZ
"RTN","PSDRFS",53,0)
 S DIR("?")="Answer Yes if the amount on hand equals the starting balance."
"RTN","PSDRFS",54,0)
 W ! D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDRFS",55,0)
 I Y=0 D ^PSDRF2 G:$G(PSDOUT) END S $P(PSDR(1),U,4)=PSDQ(1),OQTY=PSDQ(1),PSDTYP=17
"RTN","PSDRFS",56,0)
LIQ G:$P($G(^PSD(58.8,+PSDS,1,PSDR,7)),U) ^PSDRFU
"RTN","PSDRFS",57,0)
QTY S DIR(0)="NA^.01:"_OQTY_":2",DIR("A")="Amount given: "
"RTN","PSDRFS",58,0)
 S DIR("B")=1 W ! D ^DIR K DIR G:Y'>0 END S (PSDQ,OQTY)=Y
"RTN","PSDRFS",59,0)
WASTE I PSDQ#1 D  G:$G(PSDOUT) END
"RTN","PSDRFS",60,0)
 .W ?30,"Amount wasted: ",1-PSDQ#1,! S WQTY=1-PSDQ#1
"RTN","PSDRFS",61,0)
WIT .S NUR2=$$WITNESS^XUVERIFY("WITNESS")
"RTN","PSDRFS",62,0)
 .I NUR2=DUZ W !!,"Wait a minute, you can't witness yourself!",$C(7) G WIT
"RTN","PSDRFS",63,0)
 .I NUR2'>0 S PSDOUT=1 Q
"RTN","PSDRFS",64,0)
 .W !!,"Thank you, ",$S($P($G(^VA(200,NUR2,.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($G(^VA(200,NUR2,0)),U)) S PSDQ=PSDQ+(1-PSDQ#1)
"RTN","PSDRFS",65,0)
 S %DT="AEPRX",%DT(0)="-NOW",%DT("A")="Date/time given: "
"RTN","PSDRFS",66,0)
 W ! D ^%DT K %DT G:Y<1 END S PSDT=Y D ^PSDRFZ
"RTN","PSDRFS",67,0)
 ; PSD*3*50 RJS - MODIFY TO CHECK SIGN OUT NURSE AGAINST WITNESS
"RTN","PSDRFS",68,0)
ADMN S DIC="^VA(200,",DIC(0)="AEMQ",DIC("A")="Nurse that signed out dose: "
"RTN","PSDRFS",69,0)
 W ! D ^DIC K DIC G:Y<1 END S NUR1=+Y,NUR1(1)=DUZ
"RTN","PSDRFS",70,0)
 I $D(NUR2),NUR1=NUR2 W !,"Witness and Sign Out Nurse can not be the same person" G:NUR1=NUR2 ADMN
"RTN","PSDRFS",71,0)
 W !!,"Remaining Balance: ",$P(PSDR(1),U,4)-PSDQ," ",$P(PSDR(1),U,8)
"RTN","PSDRFS",72,0)
 D UPDAT^PSDRFT G DRUG
"RTN","PSDRFS",73,0)
END W:$G(PSDOUT) !!,"No dose signed out.",$C(7),!! K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDRFS",74,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDRFS",75,0)
 Q
"RTN","PSDRFS",76,0)
MSG ;display error message
"RTN","PSDRFS",77,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDRFS",78,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDRFS",79,0)
 Q
"RTN","PSDRFU")
0^2^B6733503
"RTN","PSDRFU",1,0)
PSDRFU ;BIR/JPW,LTL-Nurse RF Delayed Dispensing Liquid ;8 Aug 94
"RTN","PSDRFU",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;**50**;13 Feb 97
"RTN","PSDRFU",3,0)
QTY S DIR(0)="NA^.01:"_OQTY_":2",DIR("A")="Amount given: "
"RTN","PSDRFU",4,0)
 W ! D ^DIR K DIR G:Y'>0 END S (PSDQ,OQTY)=Y
"RTN","PSDRFU",5,0)
WASTE I PSDQ#1 D  G:$G(PSDOUT) END
"RTN","PSDRFU",6,0)
 .S DIR(0)="Y",DIR("A")="Will you be wasting any of this dose"
"RTN","PSDRFU",7,0)
 .W ! D ^DIR K DIR S:$D(DIRUT) PSDOUT=1 Q:Y'=1
"RTN","PSDRFU",8,0)
 .W ?44,"Amount to be wasted: ",1-PSDQ#1,! S WQTY=1-PSDQ#1
"RTN","PSDRFU",9,0)
WIT .S NUR2=$$WITNESS^XUVERIFY("WITNESS")
"RTN","PSDRFU",10,0)
 .I NUR2=DUZ W !!,"Wait a minute, you can't witness yourself!",$C(7) G WIT
"RTN","PSDRFU",11,0)
 .I NUR2'>0 S PSDOUT=1 Q
"RTN","PSDRFU",12,0)
 .W !!,"Thank you, ",$S($P($G(^VA(200,NUR2,.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($G(^VA(200,NUR2,0)),U))
"RTN","PSDRFU",13,0)
 .S PSDQ=PSDQ+WQTY ;S DUZ=PSDUZ
"RTN","PSDRFU",14,0)
 S %DT="AEPRX",%DT(0)="-NOW",%DT("A")="Date/time given: "
"RTN","PSDRFU",15,0)
 W ! D ^%DT K %DT G:Y<1 END S PSDT=Y
"RTN","PSDRFU",16,0)
 S DIC="^VA(200,",DIC(0)="AEMQ",DIC("A")="Nurse that signed out dose: "
"RTN","PSDRFU",17,0)
 ; PSD*3*50 RJS - MODIFY TO CHECK SIGN OUT NURSE AGAINST WITNESS
"RTN","PSDRFU",18,0)
ADMN W ! D ^DIC K DIC G:Y<1 END S NUR1=+Y,NUR1(1)=DUZ
"RTN","PSDRFU",19,0)
 I $D(NUR2),NUR1=NUR2 W !,"Witness and Sign Out Nurse can not be the same person" G:NUR1=NUR2 ADMN
"RTN","PSDRFU",20,0)
 W !!,"Remaining Balance: ",$P(PSDR(1),U,4)-PSDQ," ",$P(PSDR(1),U,8)
"RTN","PSDRFU",21,0)
 D UPDAT^PSDRFT G DRUG^PSDRFS
"RTN","PSDRFU",22,0)
END W:$G(PSDOUT) !!,"No dose signed out.",$C(7),!! K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDRFU",23,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDRFU",24,0)
 Q
"RTN","PSDRFU",25,0)
MSG ;display error message
"RTN","PSDRFU",26,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDRFU",27,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDRFU",28,0)
 Q
"VER")
8.0^22.0
**END**
**END**
