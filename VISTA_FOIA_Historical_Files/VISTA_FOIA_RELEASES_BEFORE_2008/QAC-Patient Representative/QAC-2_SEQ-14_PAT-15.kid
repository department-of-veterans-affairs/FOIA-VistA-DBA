Released QAC*2*15 SEQ #14
Extracted from mail message
**KIDS**:QAC*2.0*15^

**INSTALL NAME**
QAC*2.0*15
"BLD",2534,0)
QAC*2.0*15^PATIENT REPRESENTATIVE^0^3010108^y
"BLD",2534,1,0)
^^3^3^3010104^^^
"BLD",2534,1,1,0)
This patch creates an option that can be used to transmit data from
"BLD",2534,1,2,0)
one month to the national database.  The name of the option is Manual
"BLD",2534,1,3,0)
Rollup.
"BLD",2534,4,0)
^9.64PA^^
"BLD",2534,"ABNS",0)
^9.66A^1^1
"BLD",2534,"ABNS",1,0)
QAC
"BLD",2534,"ABNS",1,1,0)
^9.661A^^
"BLD",2534,"ABNS","B","QAC",1)

"BLD",2534,"ABPKG")
n^n
"BLD",2534,"KRN",0)
^9.67PA^19^17
"BLD",2534,"KRN",.4,0)
.4
"BLD",2534,"KRN",.401,0)
.401
"BLD",2534,"KRN",.402,0)
.402
"BLD",2534,"KRN",.403,0)
.403
"BLD",2534,"KRN",.5,0)
.5
"BLD",2534,"KRN",.84,0)
.84
"BLD",2534,"KRN",3.6,0)
3.6
"BLD",2534,"KRN",3.8,0)
3.8
"BLD",2534,"KRN",9.2,0)
9.2
"BLD",2534,"KRN",9.8,0)
9.8
"BLD",2534,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",2534,"KRN",9.8,"NM",1,0)
QACMAIL0^^0^B53861231
"BLD",2534,"KRN",9.8,"NM",2,0)
QACMAIL1^^0^B52235812
"BLD",2534,"KRN",9.8,"NM","B","QACMAIL0",1)

"BLD",2534,"KRN",9.8,"NM","B","QACMAIL1",2)

"BLD",2534,"KRN",19,0)
19
"BLD",2534,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",2534,"KRN",19,"NM",1,0)
QAC MAIN MENU^^2
"BLD",2534,"KRN",19,"NM",2,0)
QAC ROLLUP (MANUAL)^^0
"BLD",2534,"KRN",19,"NM","B","QAC MAIN MENU",1)

"BLD",2534,"KRN",19,"NM","B","QAC ROLLUP (MANUAL)",2)

"BLD",2534,"KRN",19.1,0)
19.1
"BLD",2534,"KRN",101,0)
101
"BLD",2534,"KRN",409.61,0)
409.61
"BLD",2534,"KRN",771,0)
771
"BLD",2534,"KRN",870,0)
870
"BLD",2534,"KRN",8994,0)
8994
"BLD",2534,"KRN","B",.4,.4)

"BLD",2534,"KRN","B",.401,.401)

"BLD",2534,"KRN","B",.402,.402)

"BLD",2534,"KRN","B",.403,.403)

"BLD",2534,"KRN","B",.5,.5)

"BLD",2534,"KRN","B",.84,.84)

"BLD",2534,"KRN","B",3.6,3.6)

"BLD",2534,"KRN","B",3.8,3.8)

"BLD",2534,"KRN","B",9.2,9.2)

"BLD",2534,"KRN","B",9.8,9.8)

"BLD",2534,"KRN","B",19,19)

"BLD",2534,"KRN","B",19.1,19.1)

"BLD",2534,"KRN","B",101,101)

"BLD",2534,"KRN","B",409.61,409.61)

"BLD",2534,"KRN","B",771,771)

"BLD",2534,"KRN","B",870,870)

"BLD",2534,"KRN","B",8994,8994)

"BLD",2534,"QUES",0)
^9.62^^
"BLD",2534,"REQB",0)
^9.611^1^1
"BLD",2534,"REQB",1,0)
QAC*2.0*14^1
"BLD",2534,"REQB","B","QAC*2.0*14",1)

"KRN",19,5430,-1)
2^1
"KRN",19,5430,0)
QAC MAIN MENU^Patient Representative Manager Menu^^M^.5^^^^^^^380
"KRN",19,5430,10,0)
^19.01IP^10^9
"KRN",19,5430,10,10,0)
10863
"KRN",19,5430,10,10,"^")
QAC ROLLUP (MANUAL)
"KRN",19,5430,"U")
PATIENT REPRESENTATIVE MANAGER
"KRN",19,10863,-1)
0^2
"KRN",19,10863,0)
QAC ROLLUP (MANUAL)^Manual Rollup^^R^^^^^^^^PATIENT REPRESENTATIVE
"KRN",19,10863,1,0)
^^1^1^3001003^
"KRN",19,10863,1,1,0)
This option will manually run the Patient Representative database rollup.
"KRN",19,10863,25)
REQUE^QACMAIL0
"KRN",19,10863,"U")
MANUAL ROLLUP
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",380,-1)
1^1
"PKG",380,0)
PATIENT REPRESENTATIVE^QAC^PATIENT REPRESENTATIVE PACKAGE
"PKG",380,20,0)
^9.402P^^
"PKG",380,22,0)
^9.49I^1^1
"PKG",380,22,1,0)
2.0^2950725^2950914
"PKG",380,22,1,"PAH",1,0)
15^3010108
"PKG",380,22,1,"PAH",1,1,0)
^^3^3^3010108
"PKG",380,22,1,"PAH",1,1,1,0)
This patch creates an option that can be used to transmit data from
"PKG",380,22,1,"PAH",1,1,2,0)
one month to the national database.  The name of the option is Manual
"PKG",380,22,1,"PAH",1,1,3,0)
Rollup.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","QACMAIL0")
0^1^B53861231
"RTN","QACMAIL0",1,0)
QACMAIL0 ;ERC/WASHCIOFO-Send data to reposititory ;11/29/99
"RTN","QACMAIL0",2,0)
 ;;2.0;Patient Representative;**4,14,15**;07/25/1995
"RTN","QACMAIL0",3,0)
 ;
"RTN","QACMAIL0",4,0)
 N QACREQUE
"RTN","QACMAIL0",5,0)
 D ZTDTH
"RTN","QACMAIL0",6,0)
 ;
"RTN","QACMAIL0",7,0)
 Q
"RTN","QACMAIL0",8,0)
 ;
"RTN","QACMAIL0",9,0)
TASK ;Set up tasking for routine.   Roll-up will be queued for
"RTN","QACMAIL0",10,0)
 ; 01:30am, so that it doesn't run at a busy time of day.
"RTN","QACMAIL0",11,0)
 S ZTRTN="START^QACMAIL0"
"RTN","QACMAIL0",12,0)
 S ZTDESC="Routine collects data from local Patient Rep file for rollup"
"RTN","QACMAIL0",13,0)
 S ZTDTH=QACSTART
"RTN","QACMAIL0",14,0)
 S ZTSAVE("XMTXT")="",ZTSAVE("QACNOT")="",ZTSAVE("QACREQUE")=""
"RTN","QACMAIL0",15,0)
 S ZTIO=""
"RTN","QACMAIL0",16,0)
 F QAC1=1:1:20 D ^%ZTLOAD Q:$G(ZTSK)
"RTN","QACMAIL0",17,0)
 I $G(ZTSK)']"" S QACERR=7 D ERROR
"RTN","QACMAIL0",18,0)
 S DA=1,DR="754///^S X=ZTSK"
"RTN","QACMAIL0",19,0)
 S DIE="^QA(740,"
"RTN","QACMAIL0",20,0)
 D ^DIE K DIE
"RTN","QACMAIL0",21,0)
 D EXIT
"RTN","QACMAIL0",22,0)
 Q
"RTN","QACMAIL0",23,0)
START ;
"RTN","QACMAIL0",24,0)
 N QAC1,QACC,QACD,QACE,QACEE,QACF,QACHK,QACJ,QACK
"RTN","QACMAIL0",25,0)
 N QA,QACBDAT,QACCONT,QACDOM,QACEDAT,QACELIG,QACEM,QACEMP
"RTN","QACMAIL0",26,0)
 N QACERR,QACERROR,QACEXIT,QACLIN,QANLINE,QACLSAT,QACMADE
"RTN","QACMAIL0",27,0)
 N QACMON,QACNO,QACNOCNT,QACNOT,QACQUIT,QACRST,QACSERV,QACSITE,QACSOR
"RTN","QACMAIL0",28,0)
 N QACSR,QACSTA,QACST,QACTMP,QACVISN,QACVZ,QACYR,QACZERO
"RTN","QACMAIL0",29,0)
 ;QACLCNT is message line count
"RTN","QACMAIL0",30,0)
 ;QACRCNT is the number of records processed
"RTN","QACMAIL0",31,0)
 ;QACCHCNT is a count of characters on the EMP line
"RTN","QACMAIL0",32,0)
 ;QACTCNT is number of characters in message
"RTN","QACMAIL0",33,0)
 ;QACNOCNT is the number of records not sent
"RTN","QACMAIL0",34,0)
 N QACCHCNT,QACLCNT,QACNOCNT,QACRCNT,QACTCNT
"RTN","QACMAIL0",35,0)
 S (QACCHCNT,QACLCNT,QACNOCNT,QACRCNT,QACTCNT)=0
"RTN","QACMAIL0",36,0)
 ;set executable to cut down on keying
"RTN","QACMAIL0",37,0)
 S QACINC="S QACTCNT=$G(QACTCNT)+$L($G(^TMP(""QAC MAIL"",$J,QACLCNT))),QACLCNT=$G(QACLCNT)+1"
"RTN","QACMAIL0",38,0)
 K ^TMP("QAC MAIL",$J)
"RTN","QACMAIL0",39,0)
 S QACEXIT=0
"RTN","QACMAIL0",40,0)
 S QACZERO=$S($D(^QA(740,1,0))#2:^(0),1:0) I +QACZERO'>0 S QACERR=1 D ERROR G EXIT
"RTN","QACMAIL0",41,0)
 S QACSITNO=+QACZERO
"RTN","QACMAIL0",42,0)
 I $G(QACSITNO)]"" D VISN(QACSITNO)
"RTN","QACMAIL0",43,0)
 S QACSTA="" D SITE^QACUTL0(+QACZERO,.QACSTA) I '$L(QACSTA) S QACERR=3 D ERROR G EXIT
"RTN","QACMAIL0",44,0)
 ;reset ZTDTH, ^%ZTLOAD
"RTN","QACMAIL0",45,0)
 I $G(QACREQUE)<1 D ZTDTH ;re-tasks job for next run
"RTN","QACMAIL0",46,0)
 I $G(QACHK)=1 Q
"RTN","QACMAIL0",47,0)
 ;
"RTN","QACMAIL0",48,0)
 I $G(QACREQUE)'=1 D LOOP^QACMAIL1
"RTN","QACMAIL0",49,0)
 I $G(QACREQUE)=1 D REQLOOP
"RTN","QACMAIL0",50,0)
 I $D(^TMP("QAC MAIL",$J)) D SEND
"RTN","QACMAIL0",51,0)
EXIT ;
"RTN","QACMAIL0",52,0)
 K ^TMP("QAC MAIL",$J)
"RTN","QACMAIL0",53,0)
 K DIROUT,DIRUT
"RTN","QACMAIL0",54,0)
 K QACDUZ,QACINT,QACMSG,QACNO,QACNOCNT
"RTN","QACMAIL0",55,0)
 N QACQBEG,QACQEND,QACRCNT,QACREQUE,QACST,QACTCNT,QACVISN,QACZTSK
"RTN","QACMAIL0",56,0)
 K X,X1,X2
"RTN","QACMAIL0",57,0)
 K XMSUB,XMTEXT,XMY
"RTN","QACMAIL0",58,0)
 K ZTDESC,ZTDTH,ZTRTN,ZTSAVE
"RTN","QACMAIL0",59,0)
 Q
"RTN","QACMAIL0",60,0)
ERROR ;
"RTN","QACMAIL0",61,0)
 ; Need to send message with error codes if QACERR is set.
"RTN","QACMAIL0",62,0)
 ; QACERR is set if site and domain information is missing
"RTN","QACMAIL0",63,0)
 ; or if no task number assigned to queueing.
"RTN","QACMAIL0",64,0)
 ; Then need to re-queue for next run.
"RTN","QACMAIL0",65,0)
 D KILL^XM
"RTN","QACMAIL0",66,0)
 S QACERROR(QACERR)=$P($T(ERR+QACERR),";;",2)
"RTN","QACMAIL0",67,0)
 S XMTEXT="QACERROR("
"RTN","QACMAIL0",68,0)
 S XMY("G.IRM")=""
"RTN","QACMAIL0",69,0)
 S XMSUB="ERROR MSG FROM PATIENT REP DATABASE ROLLUP - PATCH QAC*2*4"
"RTN","QACMAIL0",70,0)
 D ^XMD
"RTN","QACMAIL0",71,0)
 D KILL^XM
"RTN","QACMAIL0",72,0)
 K QACERROR(QACERR)
"RTN","QACMAIL0",73,0)
 Q
"RTN","QACMAIL0",74,0)
SEND ;Send message. 
"RTN","QACMAIL0",75,0)
 ;This message is the roll-up.
"RTN","QACMAIL0",76,0)
 S ^TMP("QAC MAIL",$J,QACLCNT)=^TMP("QAC MAIL",$J,QACLCNT)_"#"
"RTN","QACMAIL0",77,0)
 D KILL^XM
"RTN","QACMAIL0",78,0)
 S XMY("XXX@Q-PSS.MED.VA.GOV")=""
"RTN","QACMAIL0",79,0)
 S XMSUB="QAC ROC LIST: "_^DD("SITE")_" ("_^DD("SITE",1)_")"
"RTN","QACMAIL0",80,0)
 S XMTEXT="^TMP(""QAC MAIL"",$J,"
"RTN","QACMAIL0",81,0)
 D ^XMD D KILL^XM
"RTN","QACMAIL0",82,0)
 I $G(QACCONT)=1 S QACCONT=0 Q
"RTN","QACMAIL0",83,0)
 D EXIT
"RTN","QACMAIL0",84,0)
 Q
"RTN","QACMAIL0",85,0)
ERR ;;Text for error messages to be included in mail message
"RTN","QACMAIL0",86,0)
 ;;Site not found in QA Site Parameter file
"RTN","QACMAIL0",87,0)
 ;;Site not found in Institute file
"RTN","QACMAIL0",88,0)
 ;;Site number not found in Institution file
"RTN","QACMAIL0",89,0)
 ;;Mail group not found in QA Site Parameter file
"RTN","QACMAIL0",90,0)
 ;;Domain not found in QA Site Parameter file
"RTN","QACMAIL0",91,0)
 ;;Domain not found in Domain file
"RTN","QACMAIL0",92,0)
 ;;Message not sent - no task number
"RTN","QACMAIL0",93,0)
 ;;No VISN number - VISN association not set up in Institution file
"RTN","QACMAIL0",94,0)
 Q
"RTN","QACMAIL0",95,0)
ZTDTH ;set the kernel ZTDTH variable for the first run and rescheduled runs.
"RTN","QACMAIL0",96,0)
 ;
"RTN","QACMAIL0",97,0)
 H 20
"RTN","QACMAIL0",98,0)
 D CHKTSK
"RTN","QACMAIL0",99,0)
 I $G(QACHK)=1 Q
"RTN","QACMAIL0",100,0)
 N QACSTART
"RTN","QACMAIL0",101,0)
 S (X,X1)=DT
"RTN","QACMAIL0",102,0)
 D H^%DTC
"RTN","QACMAIL0",103,0)
 S X2=$S(%Y=0:2,%Y=6:3,1:1)
"RTN","QACMAIL0",104,0)
 D C^%DTC
"RTN","QACMAIL0",105,0)
 S QACSTART=X_".013"
"RTN","QACMAIL0",106,0)
 D TASK
"RTN","QACMAIL0",107,0)
 S DA=1
"RTN","QACMAIL0",108,0)
 S DR="754///^S X=ZTSK"
"RTN","QACMAIL0",109,0)
 S DIE="^QA(740,"
"RTN","QACMAIL0",110,0)
 D ^DIE K DIE
"RTN","QACMAIL0",111,0)
 Q
"RTN","QACMAIL0",112,0)
NEWMSG ;send message, set variables for continuation message.
"RTN","QACMAIL0",113,0)
 ;S (QACCHCNT,QACLCNT,QACRCNT,QACTCNT)=0
"RTN","QACMAIL0",114,0)
 ;flag for continuation message - don't go to EXIT at end of SEND
"RTN","QACMAIL0",115,0)
 S QACCONT=1
"RTN","QACMAIL0",116,0)
 D SEND
"RTN","QACMAIL0",117,0)
 S (QACCHCNT,QACLCNT,QACRCNT,QACTCNT)=0
"RTN","QACMAIL0",118,0)
 K ^TMP("QAC MAIL")
"RTN","QACMAIL0",119,0)
 Q
"RTN","QACMAIL0",120,0)
ROLL(QACODE) ;set new Roll-Up Status field
"RTN","QACMAIL0",121,0)
 ;if record is not being rolled up set field to "1" (Rejected).
"RTN","QACMAIL0",122,0)
 ;if record is has been rolled up and is closed, set field to "0".
"RTN","QACMAIL0",123,0)
 ;if record was sent, but status is still open, set to "2".
"RTN","QACMAIL0",124,0)
 N DA,DIE,DR
"RTN","QACMAIL0",125,0)
 S DIE="^QA(745.1,"
"RTN","QACMAIL0",126,0)
 S DA=QACJ
"RTN","QACMAIL0",127,0)
 S DR="41///^S X=QACODE"
"RTN","QACMAIL0",128,0)
 D ^DIE K DIE
"RTN","QACMAIL0",129,0)
 Q
"RTN","QACMAIL0",130,0)
REQUE ;this subroutine will task this extract once, for one month or for 
"RTN","QACMAIL0",131,0)
 ;a portion of one month.
"RTN","QACMAIL0",132,0)
 N QACREQUE
"RTN","QACMAIL0",133,0)
 N QACCHCNT,QACLCNT,QACNOCNT,QACRCNT,QACTCNT
"RTN","QACMAIL0",134,0)
 S (QACCHCNT,QACLCNT,QACNOCNT,QACRCNT,QACTCNT)=0
"RTN","QACMAIL0",135,0)
 ;set re-queue flag so that task will not be re-tasked during this run
"RTN","QACMAIL0",136,0)
 S QACREQUE=1
"RTN","QACMAIL0",137,0)
 D START
"RTN","QACMAIL0",138,0)
 Q
"RTN","QACMAIL0",139,0)
VISN(QACSITNO) ;find VISN for this site
"RTN","QACMAIL0",140,0)
 N QACV
"RTN","QACMAIL0",141,0)
 I $D(^DIC(4,QACSITNO,7,0)) D PARENT^XUAF4("QACV",QACSITNO,"VISN")
"RTN","QACMAIL0",142,0)
 I '$D(^DIC(4,QACSITNO,7,0)) S QACERR=8 D ERROR
"RTN","QACMAIL0",143,0)
 S QACVZ=$O(QACV("P",0))
"RTN","QACMAIL0",144,0)
 I $G(QACVZ)]"" S QACVISN=$P(QACV("P",QACVZ),U)
"RTN","QACMAIL0",145,0)
 I $G(QACVZ)']"" D
"RTN","QACMAIL0",146,0)
 . S QACEE=0
"RTN","QACMAIL0",147,0)
 . F  S QACEE=$O(^DIC(4,QACSITNO,7,QACEE)) Q:QACEE'>0  D
"RTN","QACMAIL0",148,0)
 . . I +^DIC(4,QACSITNO,7,QACEE,0)'=1 S QACERR=8 D ERROR Q
"RTN","QACMAIL0",149,0)
 . . S QACVISN=$P(^DIC(4,QACSITNO,7,QACEE,0),U,2)
"RTN","QACMAIL0",150,0)
 . . S QACVISN=$P(^DIC(4,QACVISN,0),U)
"RTN","QACMAIL0",151,0)
 I $G(QACERR)=8 S QACVISN=0 Q
"RTN","QACMAIL0",152,0)
 I $G(QACVISN)["VISN " S QACVISN=$E(QACVISN,6,9)
"RTN","QACMAIL0",153,0)
 Q
"RTN","QACMAIL0",154,0)
CHKTSK ;check to see if this job has already been tasked (i.e. on an earlier 
"RTN","QACMAIL0",155,0)
 ;installation, or if it has already started running).
"RTN","QACMAIL0",156,0)
 S ZTSK=$P(^QA(740,1,"QAC"),U,5)
"RTN","QACMAIL0",157,0)
 I $G(ZTSK)>0 D
"RTN","QACMAIL0",158,0)
 . D STAT^%ZTLOAD
"RTN","QACMAIL0",159,0)
 . I $G(ZTSK(1))=2 Q
"RTN","QACMAIL0",160,0)
 . S QACZTSK=ZTSK K ZTSK S ZTSK=QACZTSK
"RTN","QACMAIL0",161,0)
 . D ISQED^%ZTLOAD
"RTN","QACMAIL0",162,0)
 . I $P($G(ZTSK("D")),",")>$P($H,",") S QACHK=1 Q
"RTN","QACMAIL0",163,0)
 . I $P($G(ZTSK("D")),",")=$P($H,",") I $P(ZTSK("D"),",",2)>$P($H,",",2) S QACHK=1
"RTN","QACMAIL0",164,0)
 Q
"RTN","QACMAIL0",165,0)
REQLOOP ; this subroutine will run the rollup manually for a month or a part
"RTN","QACMAIL0",166,0)
 ; of one month.
"RTN","QACMAIL0",167,0)
 W !!,"This option will run the Patient Representative data roll-up"
"RTN","QACMAIL0",168,0)
 W !,"for one month."
"RTN","QACMAIL0",169,0)
 K %DT S %DT="AE",%DT("A")="Enter Month and Year: " D ^%DT
"RTN","QACMAIL0",170,0)
 I Y'>0!(Y<2991000)!(Y>DT)!(+$E(Y,4,5)'>0) W !!,"Valid date not entered - exiting." Q
"RTN","QACMAIL0",171,0)
 S QACQBEG=$E(Y,1,5)_"00"
"RTN","QACMAIL0",172,0)
 S QACQEND=$E(Y,1,5)_"31"
"RTN","QACMAIL0",173,0)
 S Y=QACQBEG D DD^%DT
"RTN","QACMAIL0",174,0)
 I Y<0 W !!,"Invalid Date" Q
"RTN","QACMAIL0",175,0)
 S QACMONTH=Y
"RTN","QACMAIL0",176,0)
 S DIR(0)="Y"
"RTN","QACMAIL0",177,0)
 S QACMONTH=Y
"RTN","QACMAIL0",178,0)
 S DIR("A")="Would you like only a part of "_QACMONTH_"?"
"RTN","QACMAIL0",179,0)
 S DIR("B")="NO"
"RTN","QACMAIL0",180,0)
 S DIR("?")="Enter ""Y"" if to limit the date range, ""N"" if you want the whole month."
"RTN","QACMAIL0",181,0)
 D ^DIR I $D(DIRUT)!($D(DIROUT)) Q
"RTN","QACMAIL0",182,0)
 K QACFAIL
"RTN","QACMAIL0",183,0)
REQLOOP1 I Y=1 D
"RTN","QACMAIL0",184,0)
 . K DIR
"RTN","QACMAIL0",185,0)
 . S DIR(0)="N^1:31"
"RTN","QACMAIL0",186,0)
 . S DIR("A")="Enter the number of the earliest day."
"RTN","QACMAIL0",187,0)
 . D ^DIR I $D(DIRUT)!($D(DIROUT)) Q
"RTN","QACMAIL0",188,0)
 . S QACQBEG=$E(QACQBEG,1,5)_$S($L(+Y)<2:"0"_Y,1:Y)
"RTN","QACMAIL0",189,0)
 . S DIR("A")="Enter the number of the last day."
"RTN","QACMAIL0",190,0)
 . D ^DIR I $D(DIRUT)!($D(DIROUT)) Q
"RTN","QACMAIL0",191,0)
 . S QACQEND=$E(QACQEND,1,5)_$S($L(+Y)<2:"0"_Y,1:Y)
"RTN","QACMAIL0",192,0)
 . I QACQBEG>QACQEND S QACFAIL=1 W !!,"End date must be later than beginning date."
"RTN","QACMAIL0",193,0)
 I $G(QACFAIL)=1 K QACFAIL S QACQBEG=$E(QACQBEG,1,5)_"00",QACQEND=$E(QACQEND,1,5)_"32" S Y=1 G REQLOOP1
"RTN","QACMAIL0",194,0)
 N QACA,QACJ,QACOUNT
"RTN","QACMAIL0",195,0)
 S QACOUNT=0
"RTN","QACMAIL0",196,0)
 S QACQBEG=QACQBEG-.001
"RTN","QACMAIL0",197,0)
 S QACA=QACQBEG
"RTN","QACMAIL0",198,0)
 S QACQEND=QACQEND_.999
"RTN","QACMAIL0",199,0)
 F  S QACA=$O(^QA(745.1,"D",QACA)) Q:QACA'>0!($G(QACOUNT)>700)!(QACA>QACQEND)  D
"RTN","QACMAIL0",200,0)
 . S QACJ=""
"RTN","QACMAIL0",201,0)
 . F  S QACJ=$O(^QA(745.1,"D",QACA,QACJ)) Q:QACJ'>0  D
"RTN","QACMAIL0",202,0)
 . . D NODE0^QACMAIL1
"RTN","QACMAIL0",203,0)
 . . I $D(^QA(745.1,QACJ,3,0)),($P(^QA(745.1,QACJ,3,0),U,3)>0) S QACOUNT=QACOUNT+1
"RTN","QACMAIL0",204,0)
 I $G(QACOUNT)=0 W !!,"No Contacts for this date range." Q
"RTN","QACMAIL0",205,0)
 D SITEMSG(QACOUNT,QACMONTH)
"RTN","QACMAIL0",206,0)
 I $G(QACOUNT)>0 W !!,"Number of records transmitted to the national database - "_QACOUNT
"RTN","QACMAIL0",207,0)
 W !!,"End of Manual Rollup Option."
"RTN","QACMAIL0",208,0)
 Q
"RTN","QACMAIL0",209,0)
SITEMSG(QACOUNT,QACMONTH) ;sends a message with the number of records 
"RTN","QACMAIL0",210,0)
 ;sent from the manual option
"RTN","QACMAIL0",211,0)
 D KILL^XM
"RTN","QACMAIL0",212,0)
 S QACDUZ=$P(^VA(200,DUZ,0),U)
"RTN","QACMAIL0",213,0)
 S XMY(QACDUZ)=""
"RTN","QACMAIL0",214,0)
 S XMSUB="MANUAL ROLLUP STATUS"
"RTN","QACMAIL0",215,0)
 S QACMSG(1)="Manual Rollup for "_QACMONTH_"."
"RTN","QACMAIL0",216,0)
 S QACMSG(2)="Total number of records sent: "_QACOUNT
"RTN","QACMAIL0",217,0)
 S XMTEXT="QACMSG("
"RTN","QACMAIL0",218,0)
 D ^XMD D KILL^XM
"RTN","QACMAIL0",219,0)
 Q
"RTN","QACMAIL1")
0^2^B52235812
"RTN","QACMAIL1",1,0)
QACMAIL1 ;ERC/WASHCIOFO-Send data to reposititory ;11/29/99
"RTN","QACMAIL1",2,0)
 ;;2.0;Patient Representative;**4,14,15**;07/25/1995
"RTN","QACMAIL1",3,0)
 ;continuation routine - contains looping code, assigns variables
"RTN","QACMAIL1",4,0)
 ;and stuffs values into temporary global ^TMP("QAC MAIL",$J,linecount)
"RTN","QACMAIL1",5,0)
 ;
"RTN","QACMAIL1",6,0)
ENV ;environment check - to ensure that the Mailman patch creating
"RTN","QACMAIL1",7,0)
 ;domain has beem installed.
"RTN","QACMAIL1",8,0)
 N QACQ,QACE
"RTN","QACMAIL1",9,0)
 S QACQ="Q-PSS.MED.VA.GOV"
"RTN","QACMAIL1",10,0)
 Q:$$FIND1^DIC(4.2,,"QX",QACQ,"B",,"QACE")
"RTN","QACMAIL1",11,0)
 W !!?5,$C(7),"**** Installation of this patch requires that domain "
"RTN","QACMAIL1",12,0)
 W !?10,QACQ," be defined."
"RTN","QACMAIL1",13,0)
 S XPDQUIT=1
"RTN","QACMAIL1",14,0)
 W !!!?5,"Refer to patch XM*999*133 for domain definition information."
"RTN","QACMAIL1",15,0)
 W !?15,"<Patch QAC*2.0*4 installation aborted!>",!!
"RTN","QACMAIL1",16,0)
 Q
"RTN","QACMAIL1",17,0)
LOOP ;first look at entries previously given Roll-up Status of "1" or "2"
"RTN","QACMAIL1",18,0)
 ;to see if they have issues codes, now, or if they have been closed
"RTN","QACMAIL1",19,0)
 D LOOP1
"RTN","QACMAIL1",20,0)
 ;
"RTN","QACMAIL1",21,0)
 ;then loop through file 745.1 looking for entries entered or closed
"RTN","QACMAIL1",22,0)
 ;since the previous rollup that have at least one issue code.
"RTN","QACMAIL1",23,0)
 N QACDD,QACJ,QACLAST,QACOUNT
"RTN","QACMAIL1",24,0)
 S QACJ=0
"RTN","QACMAIL1",25,0)
 S QACLAST=$P($G(^QA(740,1,"QAC")),U,4)
"RTN","QACMAIL1",26,0)
 ;(DBIA #3061 for lookup of value of QAC LAST RECORD in file #740)
"RTN","QACMAIL1",27,0)
 ;if this is the first rollup, set starting record to the first record
"RTN","QACMAIL1",28,0)
 ;with a date of contact in FY 2000
"RTN","QACMAIL1",29,0)
 I $G(QACLAST)'>0 S QACDD=$O(^QA(745.1,"D",2991000)) Q:QACDD'>0
"RTN","QACMAIL1",30,0)
 S QACJ=$S($G(QACLAST)>0:QACLAST,1:$O(^QA(745.1,"D",QACDD,0)))
"RTN","QACMAIL1",31,0)
 I $G(QACJ)'>0 Q
"RTN","QACMAIL1",32,0)
 S QACOUNT=0
"RTN","QACMAIL1",33,0)
 ;adding the 700 record limit for sites that are doing the rollup for 
"RTN","QACMAIL1",34,0)
 ;first time or have to catch up on a large number of records
"RTN","QACMAIL1",35,0)
 F  S QACJ=$O(^QA(745.1,QACJ)) Q:QACJ'>0!($G(QACOUNT)>700)  D
"RTN","QACMAIL1",36,0)
 . D NODE0
"RTN","QACMAIL1",37,0)
 . S QACLAST=QACJ
"RTN","QACMAIL1",38,0)
 . S QACOUNT=QACOUNT+1
"RTN","QACMAIL1",39,0)
 . I $G(QACST)="O" D ROLL^QACMAIL0(2)
"RTN","QACMAIL1",40,0)
 S DIE="^QA(740,",DA=1,DR="753////^S X=QACLAST"
"RTN","QACMAIL1",41,0)
 D ^DIE K DA,DIE,DR
"RTN","QACMAIL1",42,0)
 ;
"RTN","QACMAIL1",43,0)
 Q
"RTN","QACMAIL1",44,0)
DATA ; Set data into local variables and then into ^TMP global for
"RTN","QACMAIL1",45,0)
 ; inclusion in mail message and set "F" values, if needed.
"RTN","QACMAIL1",46,0)
 N QACNODE2,QACNODE7
"RTN","QACMAIL1",47,0)
 N QACK,QACL,QACM,QACN
"RTN","QACMAIL1",48,0)
 N QACCOM,QACDAT,QACDATE,QACDAYS,QACDISC,QACDIV,QACDOB,QACELIG,QACISSC
"RTN","QACMAIL1",49,0)
 N QACLSAT,QACMADE,QACNO,QACPGV,QACPSRV,QACRDAT,QACRDATE,QACROC
"RTN","QACMAIL1",50,0)
 N QACSEAT,QACSEX,QACSSN,QACSTAT,QACTST
"RTN","QACMAIL1",51,0)
 ;if record was previously rejected and is now closed set Roll-up status
"RTN","QACMAIL1",52,0)
 ;to "0" (call ROLL(0)) - if still open but has IC call ROLL(2)
"RTN","QACMAIL1",53,0)
 ;if record previously sent but "open", but is now closed, call ROLL(0)
"RTN","QACMAIL1",54,0)
 N QACNOT
"RTN","QACMAIL1",55,0)
 S QACROC=$P($G(QACNODE0),U)
"RTN","QACMAIL1",56,0)
 S QACST=$P($G(^QA(745.1,QACJ,7)),U,2) ;status
"RTN","QACMAIL1",57,0)
 I $D(^QA(745.1,"F",1,QACJ))=1,($G(QACREQUE)'=1) D
"RTN","QACMAIL1",58,0)
 . I $G(QACST)="C" D ROLL^QACMAIL0(0) Q
"RTN","QACMAIL1",59,0)
 . I $P($G(^QA(745.1,QACJ,3,0)),U,3)>0 D ROLL^QACMAIL0(2) Q
"RTN","QACMAIL1",60,0)
 . S QACNOT=1
"RTN","QACMAIL1",61,0)
 I $D(^QA(745.1,"F",2,QACJ))=1,($G(QACREQUE)'=1) D
"RTN","QACMAIL1",62,0)
 . I $G(QACST)="C" D ROLL^QACMAIL0(0) Q
"RTN","QACMAIL1",63,0)
 . I $G(QACST)="O" S QACNOT=1
"RTN","QACMAIL1",64,0)
 I $G(QACNOT)=1 S QACNOT=0 Q
"RTN","QACMAIL1",65,0)
 I $G(QACNODE0)]"" D
"RTN","QACMAIL1",66,0)
 . I $P($G(QACNODE0),U,3)]"" D
"RTN","QACMAIL1",67,0)
 . . S QACSSN=$P(VADM(2),U) ;SSN
"RTN","QACMAIL1",68,0)
 . . S QACDOB=$P(VADM(3),U) ;DOB
"RTN","QACMAIL1",69,0)
 . . I $G(QACDOB) D  ;Austin wanted dates in MMDDYYYY
"RTN","QACMAIL1",70,0)
 . . . S QACDOB=$P($$FMTHL7^XLFDT(QACDOB),"-")
"RTN","QACMAIL1",71,0)
 . . . S QACDOB=$E(QACDOB,5,8)_$E(QACDOB,1,4)
"RTN","QACMAIL1",72,0)
 . . S QACSEX=$P(VADM(5),U)
"RTN","QACMAIL1",73,0)
 . S QACDATE=$P(QACNODE0,U,2) ;date of contact
"RTN","QACMAIL1",74,0)
 . I $G(QACDATE) D
"RTN","QACMAIL1",75,0)
 . . S QACDATE=$P($$FMTHL7^XLFDT(QACDATE),"-")
"RTN","QACMAIL1",76,0)
 . . S QACDATE=$E(QACDATE,5,8)_$E(QACDATE,1,4)
"RTN","QACMAIL1",77,0)
 . S QACPSRV=$P($G(QACNODE0),U,14) ;period of service
"RTN","QACMAIL1",78,0)
 . S QACPGV=$P($G(QACNODE0),U,15) ;Persian Gulf vet?
"RTN","QACMAIL1",79,0)
 . S QACNO=$P($G(QACNODE0),U,16) ;division
"RTN","QACMAIL1",80,0)
 . S QACDIV="" D INST^QACUTL0(QACNO,.QACDIV)
"RTN","QACMAIL1",81,0)
 . S QACDIV=$E(QACDIV,1,30)
"RTN","QACMAIL1",82,0)
 . I $G(QACDIV)["Unknown" S QACDIV=""
"RTN","QACMAIL1",83,0)
 . S QACELIG=$S($P($G(QACNODE0),U,4)]"":$O(^DIC(8,"B",$P($G(QACNODE0),U,4),0)),1:"UNK") ;eligibility
"RTN","QACMAIL1",84,0)
 . S QACMADE=$P(QACNODE0,U,10)
"RTN","QACMAIL1",85,0)
NODE2 ; set variables for node 2
"RTN","QACMAIL1",86,0)
 S QACNODE2=$G(^QA(745.1,QACJ,2))
"RTN","QACMAIL1",87,0)
 I QACNODE2]"" S QACTST=$P($G(QACNODE2),U,2) ;treatment status
"RTN","QACMAIL1",88,0)
NODE3 ;issue code info
"RTN","QACMAIL1",89,0)
 S QACK=0
"RTN","QACMAIL1",90,0)
 F  S QACK=$O(^QA(745.1,QACJ,3,QACK)) Q:QACK'>0  D
"RTN","QACMAIL1",91,0)
 . S QACISSC(QACK)=$P(^QA(745.2,^QA(745.1,QACJ,3,QACK,0),0),U)
"RTN","QACMAIL1",92,0)
 . I $P($G(^QA(745.1,QACJ,3,QACK,3,0)),U,3)'>0 S QACDISC(QACK,1)=QACISSC(QACK)_"^"
"RTN","QACMAIL1",93,0)
 . S QACL=0
"RTN","QACMAIL1",94,0)
 . F  S QACL=$O(^QA(745.1,QACJ,3,QACK,3,QACL)) Q:QACL'>0  D
"RTN","QACMAIL1",95,0)
 . . ;get code for discipline
"RTN","QACMAIL1",96,0)
 . . N QACTEMP,QACTMP
"RTN","QACMAIL1",97,0)
 . . S QACTMP=$P($G(^QA(745.1,QACJ,3,QACK,3,QACL,0)),U,2)
"RTN","QACMAIL1",98,0)
 . . S QACTEMP=$S($G(QACTMP)]"":$P($G(^QA(745.5,QACTMP,0)),U),1:"")
"RTN","QACMAIL1",99,0)
 . . S QACDISC(QACK,QACL)=QACISSC(QACK)_"^"_$G(QACTEMP)
"RTN","QACMAIL1",100,0)
NODE7 ;set variables for node 7
"RTN","QACMAIL1",101,0)
 S QACNODE7=$G(^QA(745.1,QACJ,7)) I $G(QACNODE7)]"" D
"RTN","QACMAIL1",102,0)
 . S QACSTAT=$P($G(QACNODE7),U,2) ;status
"RTN","QACMAIL1",103,0)
 . S QACRDATE=$P(QACNODE7,U) ;resolution date
"RTN","QACMAIL1",104,0)
 . I $G(QACRDATE) D
"RTN","QACMAIL1",105,0)
 . . S QACRDATE=$P($$FMTHL7^XLFDT(QACRDATE),"-")
"RTN","QACMAIL1",106,0)
 . . S QACRDATE=$E(QACRDATE,5,8)_$E(QACRDATE,1,4)
"RTN","QACMAIL1",107,0)
 . S QACDAYS=$P($G(QACNODE7),U,4) ;days to resolution
"RTN","QACMAIL1",108,0)
NODE8 ; set variables for employee multiple
"RTN","QACMAIL1",109,0)
 N QACC
"RTN","QACMAIL1",110,0)
 S QACC=0
"RTN","QACMAIL1",111,0)
 K QACEM,QACEMP
"RTN","QACMAIL1",112,0)
 F  S QACC=$O(^QA(745.1,QACJ,8,QACC)) Q:QACC'>0  D
"RTN","QACMAIL1",113,0)
 . S QACEM=^QA(745.1,QACJ,8,QACC,0) Q:QACEM'>0
"RTN","QACMAIL1",114,0)
 . S QACEM=$P($G(^VA(200,QACEM,0)),U)
"RTN","QACMAIL1",115,0)
 . I $G(QACEM)]"" S QACEMP(QACJ,QACC)=QACEM
"RTN","QACMAIL1",116,0)
NODE12 ; set variables for source(s) of contact multiple
"RTN","QACMAIL1",117,0)
 N QACD,QACSOR,QACSR
"RTN","QACMAIL1",118,0)
 S QACD=0
"RTN","QACMAIL1",119,0)
 F  S QACD=$O(^QA(745.1,QACJ,12,QACD)) Q:QACD'>0  D
"RTN","QACMAIL1",120,0)
 . S QACSR=^QA(745.1,QACJ,12,QACD,0) Q:QACSR']""
"RTN","QACMAIL1",121,0)
 . I $G(QACSR)]"" S QACSOR(QACJ,QACD)=QACSR
"RTN","QACMAIL1",122,0)
STUFF ; Stuff variables into ^TMP global for use in ^XMD
"RTN","QACMAIL1",123,0)
 ;      field delimiter = "^"
"RTN","QACMAIL1",124,0)
 ;       line delimiter = "&"
"RTN","QACMAIL1",125,0)
 ;     record delimiter = "$"
"RTN","QACMAIL1",126,0)
 ;    message delimiter = "#"
"RTN","QACMAIL1",127,0)
 N QACJJ,QACKK,QACLL
"RTN","QACMAIL1",128,0)
 S QACRCNT=QACRCNT+1
"RTN","QACMAIL1",129,0)
 ;check message size - need to ensure message < 32000
"RTN","QACMAIL1",130,0)
 I $G(QACTCNT)>29000 D NEWMSG^QACMAIL0
"RTN","QACMAIL1",131,0)
 X QACINC
"RTN","QACMAIL1",132,0)
 S ^TMP("QAC MAIL",$J,QACLCNT)=$G(QACROC)_"^ROC^"_$G(QACDATE)_"^"_$G(QACSSN)_"^"_$G(QACSEX)_"^"_$G(QACDOB)_"^"_$G(QACSTAT)_"^"_$G(QACRDATE)_"^"_$G(QACTST)_"^"_$G(QACPSRV)
"RTN","QACMAIL1",133,0)
 S ^TMP("QAC MAIL",$J,QACLCNT)=^TMP("QAC MAIL",$J,QACLCNT)_"^"_$G(QACPGV)_"^"_$G(QACDIV)_"^"_$G(QACDAYS)_"^"_$G(QACELIG)_"^"_$G(QACMADE)_"^"_$G(QACVISN)_"&"
"RTN","QACMAIL1",134,0)
STFFISSC ;stuff issue code values into ^TMP
"RTN","QACMAIL1",135,0)
 ;using "~" as an Issue Code delimiter
"RTN","QACMAIL1",136,0)
 N QACCHCNT
"RTN","QACMAIL1",137,0)
 S (QACJJ,QACKK)=0
"RTN","QACMAIL1",138,0)
 I $O(QACISSC(0))'>0 Q
"RTN","QACMAIL1",139,0)
 X QACINC S ^TMP("QAC MAIL",$J,QACLCNT)=$G(QACROC)_"^ISSC^"
"RTN","QACMAIL1",140,0)
 F  S QACJJ=$O(QACDISC(QACJJ)) Q:QACJJ'>0  D
"RTN","QACMAIL1",141,0)
 . S QACKK=0
"RTN","QACMAIL1",142,0)
 . F  S QACKK=$O(QACDISC(QACJJ,QACKK)) Q:QACKK'>0  D
"RTN","QACMAIL1",143,0)
 . . N QACLIN,QACLINE
"RTN","QACMAIL1",144,0)
 . . S QACLINE=QACDISC(QACJJ,QACKK)
"RTN","QACMAIL1",145,0)
 . . ; adding employee(s) to each issue code.  In future employee (and
"RTN","QACMAIL1",146,0)
 . . ; location) will be associated with Issue Code - code will change
"RTN","QACMAIL1",147,0)
 . . ; here.  For now, location will be represented by "" in last piece
"RTN","QACMAIL1",148,0)
 . . ; There will be one IC, one Disc., one location and one employee
"RTN","QACMAIL1",149,0)
 . . ; separated by "^", and each 4 field set separated by "~"
"RTN","QACMAIL1",150,0)
 . . S (QACE,QACCHCNT)=0
"RTN","QACMAIL1",151,0)
 . . I $O(QACEMP(0))'>0 S ^TMP("QAC MAIL",$J,QACLCNT)=^TMP("QAC MAIL",$J,QACLCNT)_QACLINE_"^^~"
"RTN","QACMAIL1",152,0)
 . . F  S QACE=$O(QACEMP(QACJ,QACE)) Q:QACE'>0  D
"RTN","QACMAIL1",153,0)
 . . . S QACLIN=QACLINE_"^"_$G(QACEMP(QACJ,QACE))_"^~" ;space for loc
"RTN","QACMAIL1",154,0)
 . . . I $L(QACLIN)+$L(^TMP("QAC MAIL",$J,QACLCNT))>200 D
"RTN","QACMAIL1",155,0)
 . . . . X QACINC
"RTN","QACMAIL1",156,0)
 . . . . S ^TMP("QAC MAIL",$J,QACLCNT)="^"
"RTN","QACMAIL1",157,0)
 . . . S ^TMP("QAC MAIL",$J,QACLCNT)=^TMP("QAC MAIL",$J,QACLCNT)_QACLIN
"RTN","QACMAIL1",158,0)
 . . . S QACLIN=""
"RTN","QACMAIL1",159,0)
 S ^TMP("QAC MAIL",$J,QACLCNT)=^TMP("QAC MAIL",$J,QACLCNT)_"&"
"RTN","QACMAIL1",160,0)
STFFSOUR ;stuff values for source(s) of contact into ^TMP
"RTN","QACMAIL1",161,0)
 X QACINC
"RTN","QACMAIL1",162,0)
 S ^TMP("QAC MAIL",$J,QACLCNT)=$G(QACROC)_"^SOUR"
"RTN","QACMAIL1",163,0)
 N QACF
"RTN","QACMAIL1",164,0)
 S QACF=0
"RTN","QACMAIL1",165,0)
 F  S QACF=$O(QACSOR(QACJ,QACF)) Q:QACF'>0  D
"RTN","QACMAIL1",166,0)
 . S ^TMP("QAC MAIL",$J,QACLCNT)=^TMP("QAC MAIL",$J,QACLCNT)_"^"_$G(QACSOR(QACJ,QACF))
"RTN","QACMAIL1",167,0)
 S ^TMP("QAC MAIL",$J,QACLCNT)=^TMP("QAC MAIL",$J,QACLCNT)_"$"
"RTN","QACMAIL1",168,0)
 Q
"RTN","QACMAIL1",169,0)
NODE0 ;set values from zero node
"RTN","QACMAIL1",170,0)
 N QACNAME,QACNODE0,QACNOFLG,VADM
"RTN","QACMAIL1",171,0)
 S QACNODE0=^QA(745.1,QACJ,0)
"RTN","QACMAIL1",172,0)
 I $P($G(QACNODE0),U,3)]"" D
"RTN","QACMAIL1",173,0)
 . S DFN=$P(QACNODE0,U,3)
"RTN","QACMAIL1",174,0)
 . D ^VADPT
"RTN","QACMAIL1",175,0)
 S QACNAME=$S($G(VADM(1))]"":VADM(1),1:"No Patient Involved")
"RTN","QACMAIL1",176,0)
 ;If no issue code count record and go to next entry.
"RTN","QACMAIL1",177,0)
 I $P($G(^QA(745.1,QACJ,3,0)),U,3)<1 D
"RTN","QACMAIL1",178,0)
 . S QACNOCNT=$G(QACNOCNT)+1,QACNOT=1
"RTN","QACMAIL1",179,0)
 . D ROLL^QACMAIL0(1) ;sets Roll-Up Status to rejected
"RTN","QACMAIL1",180,0)
 . Q
"RTN","QACMAIL1",181,0)
 I $G(QACNOT)=1 S QACNOT=0 Q
"RTN","QACMAIL1",182,0)
 D DATA
"RTN","QACMAIL1",183,0)
 Q
"RTN","QACMAIL1",184,0)
LOOP1 ;check "F" cross reference for older records
"RTN","QACMAIL1",185,0)
 ;if formerly rejected re-evaluate
"RTN","QACMAIL1",186,0)
 ;if previously sent as open record but is now closed, send again, update
"RTN","QACMAIL1",187,0)
 N QACAA,QACEE,QACJ S QACEE=0
"RTN","QACMAIL1",188,0)
 F  S QACEE=$O(^QA(745.1,"F",QACEE)) Q:QACEE'>0  D
"RTN","QACMAIL1",189,0)
 . S QACJ=0
"RTN","QACMAIL1",190,0)
 . F  S QACJ=$O(^QA(745.1,"F",QACEE,QACJ)) Q:QACJ'>0  D
"RTN","QACMAIL1",191,0)
 . . ;check to see if the record has already been evaluated/sent
"RTN","QACMAIL1",192,0)
 . . I $G(QACAA(QACJ))=1 Q
"RTN","QACMAIL1",193,0)
 . . S QACAA(QACJ)=1
"RTN","QACMAIL1",194,0)
 . . D NODE0
"RTN","QACMAIL1",195,0)
 Q
"VER")
8.0^22.0
**END**
**END**
