Released XU*8*346 SEQ #295
Extracted from mail message
**KIDS**:XU*8.0*346^

**INSTALL NAME**
XU*8.0*346
"BLD",817,0)
XU*8.0*346^KERNEL^0^3040426^y
"BLD",817,4,0)
^9.64PA^^
"BLD",817,"ABPKG")
n
"BLD",817,"KRN",0)
^9.67PA^8989.52^19
"BLD",817,"KRN",.4,0)
.4
"BLD",817,"KRN",.401,0)
.401
"BLD",817,"KRN",.402,0)
.402
"BLD",817,"KRN",.403,0)
.403
"BLD",817,"KRN",.5,0)
.5
"BLD",817,"KRN",.84,0)
.84
"BLD",817,"KRN",3.6,0)
3.6
"BLD",817,"KRN",3.8,0)
3.8
"BLD",817,"KRN",9.2,0)
9.2
"BLD",817,"KRN",9.8,0)
9.8
"BLD",817,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",817,"KRN",9.8,"NM",1,0)
XPDIK^^0^B39787924
"BLD",817,"KRN",9.8,"NM",2,0)
XPDDP^^0^B38279798
"BLD",817,"KRN",9.8,"NM","B","XPDDP",2)

"BLD",817,"KRN",9.8,"NM","B","XPDIK",1)

"BLD",817,"KRN",19,0)
19
"BLD",817,"KRN",19.1,0)
19.1
"BLD",817,"KRN",101,0)
101
"BLD",817,"KRN",409.61,0)
409.61
"BLD",817,"KRN",771,0)
771
"BLD",817,"KRN",870,0)
870
"BLD",817,"KRN",8989.51,0)
8989.51
"BLD",817,"KRN",8989.52,0)
8989.52
"BLD",817,"KRN",8994,0)
8994
"BLD",817,"KRN","B",.4,.4)

"BLD",817,"KRN","B",.401,.401)

"BLD",817,"KRN","B",.402,.402)

"BLD",817,"KRN","B",.403,.403)

"BLD",817,"KRN","B",.5,.5)

"BLD",817,"KRN","B",.84,.84)

"BLD",817,"KRN","B",3.6,3.6)

"BLD",817,"KRN","B",3.8,3.8)

"BLD",817,"KRN","B",9.2,9.2)

"BLD",817,"KRN","B",9.8,9.8)

"BLD",817,"KRN","B",19,19)

"BLD",817,"KRN","B",19.1,19.1)

"BLD",817,"KRN","B",101,101)

"BLD",817,"KRN","B",409.61,409.61)

"BLD",817,"KRN","B",771,771)

"BLD",817,"KRN","B",870,870)

"BLD",817,"KRN","B",8989.51,8989.51)

"BLD",817,"KRN","B",8989.52,8989.52)

"BLD",817,"KRN","B",8994,8994)

"BLD",817,"QUES",0)
^9.62^^
"BLD",817,"REQB",0)
^9.611^2^2
"BLD",817,"REQB",1,0)
XU*8.0*146^1
"BLD",817,"REQB",2,0)
XU*8.0*304^1
"BLD",817,"REQB","B","XU*8.0*146",1)

"BLD",817,"REQB","B","XU*8.0*304",2)

"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
346^3040426
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XPDDP")
0^2^B38279798
"RTN","XPDDP",1,0)
XPDDP ;SFISC/RSD - Display a package ;04/26/2004  11:23
"RTN","XPDDP",2,0)
 ;;8.0;KERNEL;**21,28,44,68,100,108,229,304,346**;Jul 10, 1995
"RTN","XPDDP",3,0)
EN1 ;print from Build file
"RTN","XPDDP",4,0)
 N DIC,D0,XPD,XPDT,XPDST,Y,Z
"RTN","XPDDP",5,0)
 S XPDST=$$LOOK^XPDB1 Q:XPDST<0
"RTN","XPDDP",6,0)
 S XPD("XPDT(")="",Y="LST1^XPDDP",Z="Build File Print"
"RTN","XPDDP",7,0)
 D EN^XUTMDEVQ(Y,Z,.XPD)
"RTN","XPDDP",8,0)
 Q
"RTN","XPDDP",9,0)
EN2 ;print from Distribution
"RTN","XPDDP",10,0)
 N D0,DIC,POP,XPD,XPDA,XPDNM,XPDT,XPDST,Y,Z,%ZIS
"RTN","XPDDP",11,0)
 S XPDST=$$LOOK^XPDI1("I $D(^XTMP(""XPDI"",Y))",1)
"RTN","XPDDP",12,0)
 S XPD("XPDT(")="",Y="LST2^XPDDP",Z="Transport Global Print",D0=$O(^XTMP("XPDI",XPDST,"BLD",0))
"RTN","XPDDP",13,0)
 Q:'D0
"RTN","XPDDP",14,0)
 D EN^XUTMDEVQ(Y,Z,.XPD)
"RTN","XPDDP",15,0)
 Q
"RTN","XPDDP",16,0)
 ;
"RTN","XPDDP",17,0)
LST1 ;
"RTN","XPDDP",18,0)
 K DIRUT N XPDIT S XPDIT=0
"RTN","XPDDP",19,0)
 F  S XPDIT=$O(XPDT(XPDIT)) Q:$D(DIRUT)!(XPDIT'>0)  D
"RTN","XPDDP",20,0)
 . S D0=+XPDT(XPDIT) D PNT("XPD(9.6,D0)")
"RTN","XPDDP",21,0)
 Q
"RTN","XPDDP",22,0)
 ;
"RTN","XPDDP",23,0)
LST2 ;Print from XPDT array
"RTN","XPDDP",24,0)
 K DIRUT N XPDIT S XPDIT=0
"RTN","XPDDP",25,0)
 F  S XPDIT=$O(XPDT(XPDIT)) Q:$D(DIRUT)!(XPDIT'>0)  D
"RTN","XPDDP",26,0)
 . S XPDA=+XPDT(XPDIT),D0=$O(^XTMP("XPDI",XPDA,"BLD",0)) D PNT("XTMP(""XPDI"",XPDA,""BLD"",D0)")
"RTN","XPDDP",27,0)
 Q
"RTN","XPDDP",28,0)
 ;
"RTN","XPDDP",29,0)
PNT(XPDGR) ;print a package, XPDGR=global root
"RTN","XPDDP",30,0)
 ;XPDFL=0 - Build - ^XPD(9.7 global root, 1 - Install - ^XTMP global root
"RTN","XPDDP",31,0)
 ;2 - Packman ^TMP($J, global root
"RTN","XPDDP",32,0)
 N I,J,K,X,XPD,XPDDT,XPDI,XPD0,XPDFL,XPDPG,XPDUL,XPDTYPE,XPDTRACK,XPDTXT,XPDOUT
"RTN","XPDDP",33,0)
 Q:$G(XPDGR)=""  S XPDGR="^"_XPDGR
"RTN","XPDDP",34,0)
 Q:'$D(@XPDGR@(0))
"RTN","XPDDP",35,0)
 S XPD0=^(0),XPDPG=1,XPDFL=$S($E(XPDGR,1,5)="^TMP(":2,1:$E(XPDGR,1,5)="^XTMP"),$P(XPDUL,"-",IOM)="",XPDDT=$$HTE^XLFDT($H,"1PM"),XPDTYPE=+$P(XPD0,U,3),XPDTRACK=$P(XPD0,U,5)
"RTN","XPDDP",36,0)
 W:$E(IOST,1,2)="C-" @IOF D HDR W XPDUL,!
"RTN","XPDDP",37,0)
 W "TYPE: ",$$EXTERNAL^DILFD(9.6,2,"",XPDTYPE)
"RTN","XPDDP",38,0)
 W !,"TRACK NATIONALLY: ",$$EXTERNAL^DILFD(9.6,5,"",XPDTRACK)
"RTN","XPDDP",39,0)
 W !,"NATIONAL PACKAGE: ",$P($G(^DIC(9.4,+$P(XPD0,U,2),0),$P(XPD0,U,2)),U)
"RTN","XPDDP",40,0)
 W !,"DESCRIPTION:",!
"RTN","XPDDP",41,0)
 S (XPDI,XPDOUT)=0
"RTN","XPDDP",42,0)
 F  S XPDI=$O(@XPDGR@(1,XPDI)) Q:'XPDI  S XPDTXT=$G(^(XPDI,0)) D  Q:XPDOUT
"RTN","XPDDP",43,0)
 . I $L(XPDTXT)'<IOM,$E(XPDTXT,$L(XPDTXT))=" " F  S XPDTXT=$E(XPDTXT,1,$L(XPDTXT)-1) Q:$E(XPDTXT,$L(XPDTXT))'=" "
"RTN","XPDDP",44,0)
 . F  D  Q:$L(XPDTXT)<IOM!XPDOUT!(IOM<2)  S XPDTXT=$E(XPDTXT,IOM,999)
"RTN","XPDDP",45,0)
 . . W $S(IOM>1:$E(XPDTXT,1,IOM-1),1:XPDTXT),!
"RTN","XPDDP",46,0)
 . . S XPDOUT=$$CHK(2)
"RTN","XPDDP",47,0)
 Q:$D(DIRUT)  G:XPDTYPE=1 MULT
"RTN","XPDDP",48,0)
 W !,"ENVIRONMENT CHECK : ",$G(@XPDGR@("PRE"))
"RTN","XPDDP",49,0)
 W ?47,"DELETE ENV ROUTINE: ",$S($P($G(@XPDGR@("INID")),U)="y":"Yes",1:"No")
"RTN","XPDDP",50,0)
 W !
"RTN","XPDDP",51,0)
 I 'XPDTYPE D
"RTN","XPDDP",52,0)
 . W " PRE-INIT ROUTINE : ",$G(@XPDGR@("INI"))
"RTN","XPDDP",53,0)
 . W ?42,"DELETE PRE-INIT ROUTINE: ",$S($P($G(@XPDGR@("INID")),U,3)="y":"Yes",1:"No")
"RTN","XPDDP",54,0)
 . W !
"RTN","XPDDP",55,0)
 Q:$$CHK(4)  W "POST-INIT ROUTINE : ",$G(@XPDGR@("INIT"))
"RTN","XPDDP",56,0)
 W ?41,"DELETE POST-INIT ROUTINE: ",$S($P($G(@XPDGR@("INID")),U,2)="y":"Yes",1:"No")
"RTN","XPDDP",57,0)
 W !
"RTN","XPDDP",58,0)
 W:'XPDTYPE "PRE-TRANSPORT RTN : ",$G(@XPDGR@("PRET")),!
"RTN","XPDDP",59,0)
 G:XPDTYPE=2 GLOBAL
"RTN","XPDDP",60,0)
 I '$O(@XPDGR@(4,0)) Q:$$CHK(4)  G COMP
"RTN","XPDDP",61,0)
 S I=$$CHK(10,1) Q:I  I '$P(I,"^",2) W !! D HDR1 W XPDUL,!
"RTN","XPDDP",62,0)
PNT2 S XPDI=0 F  S XPDI=$O(@XPDGR@(4,XPDI)) Q:'XPDI  S XPD=$G(^(XPDI,222)) Q:$$CHK(4,1)  D
"RTN","XPDDP",63,0)
 .;file number, file name, partial DD
"RTN","XPDDP",64,0)
 .W !,XPDI,?12,$S('XPDFL:$P($G(^DIC(XPDI,0),"**unknown**"),U),1:$G(^XTMP("XPDI",XPDA,"FIA",XPDI)))
"RTN","XPDDP",65,0)
 .W ?41,$$EXTERNAL^DILFD(9.64,222.1,"",$P(XPD,U)),?47,$$EXTERNAL^DILFD(9.64,222.2,"",$P(XPD,U,2)),?53,$$EXTERNAL^DILFD(9.64,222.7,"",$P(XPD,U,7))
"RTN","XPDDP",66,0)
 .W ?60,$E($$EXTERNAL^DILFD(9.64,222.8,"",$P(XPD,U,8)),1,4),?67,$$EXTERNAL^DILFD(9.64,222.5,"",$P(XPD,U,5)),?73,$$EXTERNAL^DILFD(9.64,222.9,"",$P(XPD,U,9)),!
"RTN","XPDDP",67,0)
 .;print partial DD information
"RTN","XPDDP",68,0)
 .I $P(XPD,U,3)="p" S J=0 D
"RTN","XPDDP",69,0)
 ..W "Partial DD:"
"RTN","XPDDP",70,0)
 ..F  S J=$O(@XPDGR@(4,"APDD",XPDI,J)) Q:'J  W ?12,"subDD: ",J D  Q:$$CHK(4,1)
"RTN","XPDDP",71,0)
 ...I '$O(@XPDGR@(4,"APDD",XPDI,J,0)) W ! Q
"RTN","XPDDP",72,0)
 ...S I=0 F  S I=$O(@XPDGR@(4,"APDD",XPDI,J,I)) Q:'I  W ?30,"fld: ",I,!
"RTN","XPDDP",73,0)
 .I $D(@XPDGR@(4,XPDI,223)) W ?2,"DD SCREEN  : ",^(223),!
"RTN","XPDDP",74,0)
 .I $D(@XPDGR@(4,XPDI,224)) W ?2,"DATA SCREEN: ",^(224),!
"RTN","XPDDP",75,0)
COMP Q:$D(DIRUT)  W ! Q:$$CHK(3)  S I=0,XPD=$P(^DD(9.68,.03,0),U,3)
"RTN","XPDDP",76,0)
 ;print build components
"RTN","XPDDP",77,0)
 F  S I=$O(@XPDGR@("KRN",I)),K=0,J="" Q:$D(DIRUT)!'I  F  S J=$O(@XPDGR@("KRN",I,"NM","B",J)) Q:J=""  S X=$O(^(J,0)) Q:$$CHK(4)  D:X
"RTN","XPDDP",78,0)
 .S X=$G(@XPDGR@("KRN",I,"NM",X,0)) Q:X=""
"RTN","XPDDP",79,0)
 .;K is flag to write type of component
"RTN","XPDDP",80,0)
 .I 'K W !,$S($D(^DIC(I,0)):$P(^(0),U),XPDFL:$G(^XTMP("XPDI",XPDA,"FIA",I),"UNKNOWN"),1:"UNKNOWN")_":",! S K=1
"RTN","XPDDP",81,0)
 .;write the entry name and write the action
"RTN","XPDDP",82,0)
 .W ?3,$P(X,U),?50,$P($P(XPD,";",$P(X,U,3)+1),":",2),!
"RTN","XPDDP",83,0)
 Q:XPDFL=2
"RTN","XPDDP",84,0)
 ;XPDFL=2 this is a Packman message, called from XMP2 - Summarize
"RTN","XPDDP",85,0)
 ;XPDFL=1 this is a Install, the call backs are already Build Components
"RTN","XPDDP",86,0)
 Q:$D(DIRUT)  Q:$$CHK(3)
"RTN","XPDDP",87,0)
 I $O(@XPDGR@("QUES",0)) W !,"INSTALL QUESTIONS: " S I=0 D
"RTN","XPDDP",88,0)
 .F  S I=$O(@XPDGR@("QUES",I)) Q:'I  S X=$P(^(I,0),U),J=$G(^(1)),K=$G(^("A")) Q:$$CHK(5)  D
"RTN","XPDDP",89,0)
 ..W !?5,"SUBSCRIPT: ",X,!,"DIR(0)=",J W:K]"" !,"DIR(""A"")=",K,!
"RTN","XPDDP",90,0)
 ..F J=1:1 Q:'$D(@XPDGR@("QUES",I,"A1",J,0))  W "DIR(""A"",",J,")=",^(0),!
"RTN","XPDDP",91,0)
 ..I $G(@XPDGR@("QUES",I,"B"))]"" W "DIR(""B"")=",^("B"),!
"RTN","XPDDP",92,0)
 ..I $G(@XPDGR@("QUES",I,"Q"))]"" W "DIR(""?"")=",^("Q"),!
"RTN","XPDDP",93,0)
 ..F J=1:1 Q:'$D(@XPDGR@("QUES",I,"Q1",J,0))  W "DIR(""?"",",J,")=",^(0),!
"RTN","XPDDP",94,0)
 ..I $G(@XPDGR@("QUES",I,"QQ"))]"" W "DIR(""??"")=",^("QQ"),!
"RTN","XPDDP",95,0)
 ..I $G(@XPDGR@("QUES",I,"M"))]"" W "M CODE: ",^("M"),!
"RTN","XPDDP",96,0)
 Q:$D(DIRUT)  Q:$$CHK(3)
"RTN","XPDDP",97,0)
 I $L($G(@XPDGR@("ABPKG"))) S XPD=^("ABPKG") D:$P(XPD,U)="y"
"RTN","XPDDP",98,0)
 .W !,"ALPHA/BETA TESTING:",$$EXTERNAL^DILFD(9.6,20,"",$P(XPD,U)),?40,"INSTALLATION MESSAGE: ",$$EXTERNAL^DILFD(9.6,21,"",$P(XPD,U,2))
"RTN","XPDDP",99,0)
 .W !,"ADDRESS: ",$P(XPD,U,3),!!,"INCLUDE NAMESPACE",?30,"EXCLUDE NAMESPACE" S I=0
"RTN","XPDDP",100,0)
 .F  S I=$O(@XPDGR@("ABNS",I)),J=0 Q:'I  W !?5,^(I,0) F  S J=$O(@XPDGR@("ABNS",I,1,J)) Q:'J  W ?35,^(J,0),! Q:$$CHK(3)
"RTN","XPDDP",101,0)
REQB Q:$D(DIRUT)  Q:$$CHK(4)
"RTN","XPDDP",102,0)
 I $O(@XPDGR@("REQB",0)) W !,"REQUIRED BUILDS:",?50,"ACTION:" D
"RTN","XPDDP",103,0)
 .S XPDI=0 F  S XPDI=$O(@XPDGR@("REQB",XPDI)) Q:'XPDI  S XPD=$G(^(XPDI,0)) Q:$$CHK(4,1)  D
"RTN","XPDDP",104,0)
 ..W !?3,$P(XPD,U),?50,$$EXTERNAL^DILFD(9.611,1,"",$P(XPD,U,2))
"RTN","XPDDP",105,0)
 Q
"RTN","XPDDP",106,0)
GLOBAL ;globals listing
"RTN","XPDDP",107,0)
 S I=$$CHK(8,1) Q:I  I '$P(I,"^",2) W !!,"GLOBAL:",?20,"KILL GLOBAL BEFORE INSTALL:"
"RTN","XPDDP",108,0)
 S XPDI=0 F  S XPDI=$O(@XPDGR@("GLO",XPDI)) Q:'XPDI  S XPD=$G(^(XPDI,0)) Q:$$CHK(4,1)  D
"RTN","XPDDP",109,0)
 .W !?3,$P(XPD,U),?33,$$EXTERNAL^DILFD(9.65,1,"",$P(XPD,U,2))
"RTN","XPDDP",110,0)
 W ! Q
"RTN","XPDDP",111,0)
 ;
"RTN","XPDDP",112,0)
MULT ;multiple-package
"RTN","XPDDP",113,0)
 S I=$$CHK(10,1) Q:I  I '$P(I,"^",2) W !,"SEQUENCE OF BUILDS:"
"RTN","XPDDP",114,0)
 S XPDI=0 F  S XPDI=$O(@XPDGR@(10,XPDI)) Q:'XPDI  S XPD=$G(^(XPDI,0)) Q:$$CHK(4,1)  D
"RTN","XPDDP",115,0)
 .W !?2,XPDI,?8,$E($P(XPD,U),1,44),?54,$S($P(XPD,U,2)=1:"",1:"Not ")_"Required to Continue"
"RTN","XPDDP",116,0)
 W ! Q
"RTN","XPDDP",117,0)
 ;
"RTN","XPDDP",118,0)
 ;return 0 if header was not written, else "0^1"
"RTN","XPDDP",119,0)
CHK(Y,XPD) ;Y=excess lines XPD=1 print file header, return 1 to exit
"RTN","XPDDP",120,0)
 Q:$Y<(IOSL-Y) 0
"RTN","XPDDP",121,0)
 I $E(IOST,1,2)="C-" D  Q:'Y 1
"RTN","XPDDP",122,0)
 .N DIR,I,J,K,X
"RTN","XPDDP",123,0)
 .S DIR(0)="E" D ^DIR
"RTN","XPDDP",124,0)
 S XPD=$G(XPD),XPDPG=XPDPG+1
"RTN","XPDDP",125,0)
 W @IOF D HDR,HDR1:XPD
"RTN","XPDDP",126,0)
 W XPDUL,!
"RTN","XPDDP",127,0)
 Q "0^1"
"RTN","XPDDP",128,0)
 ;
"RTN","XPDDP",129,0)
XMP2(X,D0) ;called from ^XMP2
"RTN","XPDDP",130,0)
 N XPDA S XPDA=-1
"RTN","XPDDP",131,0)
 D PNT(X) Q
"RTN","XPDDP",132,0)
 ;
"RTN","XPDDP",133,0)
HDR W !,"PACKAGE: ",$P(XPD0,U),"     ",XPDDT,?70,"PAGE ",XPDPG,!
"RTN","XPDDP",134,0)
 Q
"RTN","XPDDP",135,0)
HDR1 W ?41,"UP",?47,"SEND",?53,"DATA",?73,"USER",!,?41,"DATE",?47,"SEC.",?53,"COMES",?60,"SITE",?67,"RSLV",?73,"OVER"
"RTN","XPDDP",136,0)
 W !,"FILE #",?12,"NAME",?41,"DD",?47,"CODE",?53,"W/FILE",?60,"DATA",?67,"PTS",?73,"RIDE",!
"RTN","XPDDP",137,0)
 Q
"RTN","XPDIK")
0^1^B39787924
"RTN","XPDIK",1,0)
XPDIK ;SFISC/RSD - Install Kernel Files & FM Files ;04/26/2004  11:20
"RTN","XPDIK",2,0)
 ;;8.0;KERNEL;**15,58,108,124,146,346**;Jul 10, 1995
"RTN","XPDIK",3,0)
 Q
"RTN","XPDIK",4,0)
KRN ;
"RTN","XPDIK",5,0)
 ;XPDA=package ien in INSTALL FILE, XPDNM=package name, XPDCP= check points
"RTN","XPDIK",6,0)
 N DA,DIC,DIOVRD,EPOS,EPRE,FDEL,FPOS,FPRE,OLDA,ORD,X,XGCEDITR,XPDFIL,XPDFILNM,XPDFL,XPDNEW,XREF,Y,%
"RTN","XPDIK",7,0)
 ;DIOVRD is used to override write protection on a file
"RTN","XPDIK",8,0)
 ;XGCEDITR is check in file 8995, at 'SCR' node of DD
"RTN","XPDIK",9,0)
 S ORD=0,XPDCP="KRN",(DIOVRD,XGCEDITR)=1
"RTN","XPDIK",10,0)
 F  S ORD=$O(^XTMP("XPDI",XPDA,"ORD",ORD)) Q:'ORD  S XPDFIL=+$O(^(ORD,0)),XREF=$G(^(XPDFIL)),XPDFILNM=$G(^(XPDFIL,0)) D:XPDFIL
"RTN","XPDIK",11,0)
 .;sets up EPOS,EPRE,FDEL,FPOS,FPRE variables
"RTN","XPDIK",12,0)
 .F DA=1:1:5 S @$P("FPRE^EPRE^FPOS^EPOS^FDEL",U,DA)=$P(XREF,";",DA+5)
"RTN","XPDIK",13,0)
 .K DIC,^TMP($J,"XPDEL")
"RTN","XPDIK",14,0)
 .S DIC=$G(^DIC(XPDFIL,0,"GL")),XREF=+$P(XREF,";",3)
"RTN","XPDIK",15,0)
 .;check if file, XPDFIL, exist at this site
"RTN","XPDIK",16,0)
 .I $P($G(^DIC(XPDFIL,0)),U)'=XPDFILNM D BMES^XPDUTL(" File "_XPDFIL_" is not "_XPDFILNM_", nothing installed.") Q
"RTN","XPDIK",17,0)
 .;check if XPDFIL has already been installed
"RTN","XPDIK",18,0)
 .I $P(^XPD(9.7,XPDA,"KRN",XPDFIL,0),U,2) D BMES^XPDUTL(" "_XPDFILNM_" already installed.") Q
"RTN","XPDIK",19,0)
 .D BMES^XPDUTL(" Installing "_XPDFILNM),SETTOT^XPDID(XPDFIL)
"RTN","XPDIK",20,0)
 .;do File Pre-install action, continue if ok
"RTN","XPDIK",21,0)
 .;XPDFL= 0-send,1-delete,2-link,3-merge,4-attach,5-disable
"RTN","XPDIK",22,0)
 .;loops thru the entries for this file
"RTN","XPDIK",23,0)
 .I '$$ACT(FPRE) S OLDA=0 F  S OLDA=$O(^XTMP("XPDI",XPDA,"KRN",XPDFIL,OLDA)) Q:'OLDA  S XPDFL=+$G(^(OLDA,-1)),OLDA(0)=^(0) D
"RTN","XPDIK",24,0)
 ..;if we are doing VT graphic display, set counter
"RTN","XPDIK",25,0)
 ..I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+1 D:'(XPDIDCNT#XPDIDMOD) UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIK",26,0)
 ..;quit if disable or attach (4 or 5).  Attach will be processed under the parent menu.
"RTN","XPDIK",27,0)
 ..Q:XPDFL>3
"RTN","XPDIK",28,0)
 ..;if FM file, need to set screening logic
"RTN","XPDIK",29,0)
 ..I XPDFIL<.44 S %=$S(XPDFIL'=.403:4,1:8),DIC("S")="I $P(^(0),U,"_%_")="_$P(OLDA(0),U,%)
"RTN","XPDIK",30,0)
 ..;if deleting at site and a template, reset the lookup value and DIC("S")
"RTN","XPDIK",31,0)
 ..I XPDFL=1,XPDFIL<.44 S %=$P(OLDA(0),U),$P(OLDA(0),U)=$P(%,"    FILE #"),DIC("S")="I $P(^(0),U,"_$S(XPDFIL'=.403:4,1:8)_")="_+$P(%,"    FILE #",2)
"RTN","XPDIK",32,0)
 ..;XPDNEW=1 if entry is new, laygo
"RTN","XPDIK",33,0)
 ..S X=$P(OLDA(0),U),Y=$$DIC(XPDFIL,X,$G(DIC("S")),XPDFL) Q:'Y  S DA=+Y,XPDNEW=$P(Y,U,3)
"RTN","XPDIK",34,0)
 ..;if deleting then save and process after FPOS
"RTN","XPDIK",35,0)
 ..I XPDFL=1 S ^TMP($J,"XPDEL",DA)="" Q
"RTN","XPDIK",36,0)
 ..;do Entries Pre-install action
"RTN","XPDIK",37,0)
 ..Q:$$ACT(EPRE)
"RTN","XPDIK",38,0)
 ..;merges the data, if you want the data deleted before the merge, you must
"RTN","XPDIK",39,0)
 ..;do it in the Entry Pre-install node, EPRE.
"RTN","XPDIK",40,0)
 ..M @(DIC_DA_")")=^XTMP("XPDI",XPDA,"KRN",XPDFIL,OLDA)
"RTN","XPDIK",41,0)
 ..;kill the flag node from the live data node
"RTN","XPDIK",42,0)
 ..K @(DIC_DA_",-1)") Q:$$ACT(EPOS)
"RTN","XPDIK",43,0)
 ..;XREF is flag to x-ref file after each entry, it is set in file 9.6
"RTN","XPDIK",44,0)
 ..I XREF N DIK S DIK=DIC D IX1^DIK
"RTN","XPDIK",45,0)
 .;do File Post Install Action
"RTN","XPDIK",46,0)
 .S %=$$ACT(FPOS)
"RTN","XPDIK",47,0)
 .;process the deleting of entries, FDEL should allow the passing of all entries
"RTN","XPDIK",48,0)
 .;to delete in array ^TMP($J,"XPDEL",DA)=""
"RTN","XPDIK",49,0)
 .I $L(FDEL),$D(^TMP($J,"XPDEL")) S %="^TMP($J,""XPDEL"")" D @FDEL
"RTN","XPDIK",50,0)
 .;complete check point
"RTN","XPDIK",51,0)
 .S %=$$XPCOM(XPDFIL)
"RTN","XPDIK",52,0)
 .K ^TMP($J,"XPDEL")
"RTN","XPDIK",53,0)
 .I $D(XPDIDVT) D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIK",54,0)
 Q
"RTN","XPDIK",55,0)
FIA ;
"RTN","XPDIK",56,0)
 ;XPFIL2=file is new^DD screen failed^data already exists^change file name^don't add data; 1=yes, 0=no
"RTN","XPDIK",57,0)
 N XPGR,XPFIL,XPFILO,XPFIL2,Z
"RTN","XPDIK",58,0)
 S XPFIL=0,XPGR=$NA(^XTMP("XPDI",XPDA))
"RTN","XPDIK",59,0)
 F  S XPFIL=$O(^XTMP("XPDI",XPDA,"FIA",XPFIL)) Q:'XPFIL  S XPFILO=^(XPFIL,0,1),XPFIL2=^(2) D
"RTN","XPDIK",60,0)
 .;if we are doing VT graphic display, set counter
"RTN","XPDIK",61,0)
 .I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+1 D:'(XPDIDCNT#XPDIDMOD) UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIK",62,0)
 .;file is new, alway install DD
"RTN","XPDIK",63,0)
 .S:XPFIL2 $P(XPFILO,U)="y",$P(^XTMP("XPDI",XPDA,"FIA",XPFIL,0,1),U)="y"
"RTN","XPDIK",64,0)
 .;DD failed screen
"RTN","XPDIK",65,0)
 .I $P(XPFIL2,U,2) D  Q
"RTN","XPDIK",66,0)
 ..N XPD
"RTN","XPDIK",67,0)
 ..S XPD(1)=" ",XPD(2)="Data Dictionary for File #"_XPFIL_" not installed, failed DD screen."
"RTN","XPDIK",68,0)
 ..D MES^XPDUTL(.XPD) S %=$$XPCOM(XPFIL)
"RTN","XPDIK",69,0)
 .;if udate DD question = no & file is not new update checkpoint
"RTN","XPDIK",70,0)
 .I $P(XPFILO,U)'="y"&'XPFIL2 S %=$$XPCOM(XPFIL)
"RTN","XPDIK",71,0)
 .;check if XPFIL has already been installed
"RTN","XPDIK",72,0)
 .Q:$P(^XPD(9.7,XPDA,4,XPFIL,0),U,2)
"RTN","XPDIK",73,0)
 .;update file name
"RTN","XPDIK",74,0)
 .I $P(XPFIL2,U,4) D
"RTN","XPDIK",75,0)
 ..N DIE,DR,DA
"RTN","XPDIK",76,0)
 ..S DR=".01////"_^XTMP("XPDI",XPDA,"FIA",XPFIL),DA=XPFIL,DIE=1
"RTN","XPDIK",77,0)
 ..D ^DIE
"RTN","XPDIK",78,0)
 .;move DD and check for errors
"RTN","XPDIK",79,0)
 .D DDIN^DIFROMS(XPFIL,"","",XPGR),DIERR("** ERROR IN DATA DICTIONARY FOR FILE # "_XPFIL_" **"):$D(DIERR)
"RTN","XPDIK",80,0)
 .S %=$$XPCOM(XPFIL)
"RTN","XPDIK",81,0)
 I $D(XPDIDVT) D UPDATE^XPDID(XPDIDTOT)
"RTN","XPDIK",82,0)
 Q
"RTN","XPDIK",83,0)
DAT ;
"RTN","XPDIK",84,0)
 N XPGR,XPFIL,XPFILO,XPFIL2,Z
"RTN","XPDIK",85,0)
 S XPFIL=0,XPGR=$NA(^XTMP("XPDI",XPDA))
"RTN","XPDIK",86,0)
 ;DO if they are sending data
"RTN","XPDIK",87,0)
 F  S XPFIL=$O(^XTMP("XPDI",XPDA,"FIA",XPFIL)) Q:'XPFIL  S XPFILO=^(XPFIL,0,1),XPFIL2=^(2) D:$P(XPFILO,U,7)="y"
"RTN","XPDIK",88,0)
 .;DD failed screen or answer no to adding data or 'Add if new' & data already exists or file doesn't exist
"RTN","XPDIK",89,0)
 .I $P(XPFIL2,U,2)!$P(XPFIL2,U,5)!($P(XPFILO,U,8)="a"&$P(XPFIL2,U,3))!'$D(^DIC(XPFIL,0)) S %=$$XPCOM(XPFIL,1) Q
"RTN","XPDIK",90,0)
 .;check if XPFIL has already been installed or no data to input
"RTN","XPDIK",91,0)
 .Q:$P(^XPD(9.7,XPDA,4,XPFIL,0),U,3)!('$D(^XTMP("XPDI",XPDA,"DATA",XPFIL)))
"RTN","XPDIK",92,0)
 .;bring in Data and check for error
"RTN","XPDIK",93,0)
 .D DATAIN^DIFROMS(XPFIL,"","",XPGR),DIERR("** ERROR IN DATA FOR FILE # "_XPFIL_" **"):$D(DIERR)
"RTN","XPDIK",94,0)
 .S %=$$XPCOM(XPFIL,1)
"RTN","XPDIK",95,0)
 D RP^DIFROMSR("","",XPGR),DIERR("** ERROR IN POINTER RESOLUTION OF DATA **"):$D(DIERR)
"RTN","XPDIK",96,0)
 Q
"RTN","XPDIK",97,0)
 ;record error
"RTN","XPDIK",98,0)
DIERR(XPDI) N XPD
"RTN","XPDIK",99,0)
 D MSG^DIALOG("AE",.XPD) Q:'$D(XPD)
"RTN","XPDIK",100,0)
 D BMES^XPDUTL(XPDI),MES^XPDUTL(.XPD)
"RTN","XPDIK",101,0)
 Q
"RTN","XPDIK",102,0)
 ;
"RTN","XPDIK",103,0)
 ;XPDF=file #,X=input,XPDS=screen logic, XPDACT=action
"RTN","XPDIK",104,0)
DIC(XPDF,XPDX,XPDS,XPDACT) ;
"RTN","XPDIK",105,0)
 N DIC,DIERR,XPD,XPDN
"RTN","XPDIK",106,0)
 S DIC=$G(^DIC(XPDF,0,"GL"))
"RTN","XPDIK",107,0)
 D FIND^DIC(XPDF,"","","XQf",XPDX,5,"",$G(XPDS),"","XPD")
"RTN","XPDIK",108,0)
 ;one or more matches, just return first one
"RTN","XPDIK",109,0)
 I $G(XPD(0)) D:XPD(0)>1  Q XPD(1)
"RTN","XPDIK",110,0)
 .N %
"RTN","XPDIK",111,0)
 .S %(1)=$P($G(^DIC(XPDF,0)),U)_"  "_XPDX_"  is Duplicated,",%(2)=" only ien #"_XPD(1)_" was updated."
"RTN","XPDIK",112,0)
 .D MES^XPDUTL(.%)
"RTN","XPDIK",113,0)
 ;no match and action=(delete,link, or attach), don't write message if deleting
"RTN","XPDIK",114,0)
 I $G(XPDACT),XPDACT'=3 D:XPDACT'=1 BMES^XPDUTL(" "_$P($G(^DIC(XPDF,0)),U)_" "_XPDX_" Lookup failed, NO Action Taken.") Q 0
"RTN","XPDIK",115,0)
 ;add a new entry
"RTN","XPDIK",116,0)
 N DLAYGO,X,Y
"RTN","XPDIK",117,0)
 S X=XPDX,DIC(0)="LX",DLAYGO=XPDF,DIC("S")=$G(XPDS) D ^DIC
"RTN","XPDIK",118,0)
 I Y<0 D BMES^XPDUTL(" "_$P($G(^DIC(XPDF,0)),U)_" "_XPDX_" **Couldn't Add to file**") Q 0
"RTN","XPDIK",119,0)
 Q Y
"RTN","XPDIK",120,0)
 ;code can't be used until UPDATE^DIE allows the creation of a record
"RTN","XPDIK",121,0)
 ;without required identifiers
"RTN","XPDIK",122,0)
 ;K XPD,DIERR
"RTN","XPDIK",123,0)
 ;S XPD(XPDF,"+1,",.01)=XPDX
"RTN","XPDIK",124,0)
 ;D UPDATE^DIE("","XPD","XPDN")
"RTN","XPDIK",125,0)
 ;couldn't add as new
"RTN","XPDIK",126,0)
 ;I $D(DIERR) D DIERR(" "_$P($G(^DIC(XPDF,0)),U)_" "_XPDX_" **Couldn't Add to file**") Q 0
"RTN","XPDIK",127,0)
 ;I '$G(XPDN(1)) D BMES^XPDUTL(" "_$P($G(^DIC(XPDF,0)),U)_" "_XPDX_" **Couldn't Add to file**") Q 0
"RTN","XPDIK",128,0)
 ;Q XPDN(1)
"RTN","XPDIK",129,0)
 ;
"RTN","XPDIK",130,0)
ACT(%) ;execute action, returns 0 to continue, 1 to quit
"RTN","XPDIK",131,0)
 ;user can count on DIC,DA,XPDFIL,OLDA,XPDNM,XPDFL,X,Y being around
"RTN","XPDIK",132,0)
 ;XPDNEW is set only for Entry Pre-install action
"RTN","XPDIK",133,0)
 Q:%="" 0
"RTN","XPDIK",134,0)
 N %1,%2,%3 S %1=$G(DIC),%2=$G(DA),%3=$G(OLDA)
"RTN","XPDIK",135,0)
 N DA,DIC,DIOVRD,OLDA,EPOS,EPRE,FPOS,FPRE,ORD,XREF,XPDQUIT
"RTN","XPDIK",136,0)
 S DIC=%1,DA=%2,OLDA=%3
"RTN","XPDIK",137,0)
 S:%'["^" %="^"_%
"RTN","XPDIK",138,0)
 ;XPDQUIT=quit this level of processing
"RTN","XPDIK",139,0)
 D @% Q $D(XPDQUIT)
"RTN","XPDIK",140,0)
 Q
"RTN","XPDIK",141,0)
 ;
"RTN","XPDIK",142,0)
XPCOM(XPDF,XPDJ) ;complete checkpoint for file XPDF
"RTN","XPDIK",143,0)
 ;XPDJ=1 only for data of fm files, it set the field to edit = 2
"RTN","XPDIK",144,0)
 N XPD,%,Z
"RTN","XPDIK",145,0)
 S %=$$NOW^XLFDT,Z=$S(XPDCP="KRN":9.715,1:9.714),XPD(Z,XPDF_","_XPDA_",",$G(XPDJ)+1)=%
"RTN","XPDIK",146,0)
 ;if Build Components, save the ORDer number
"RTN","XPDIK",147,0)
 S:Z=9.715 XPD(Z,XPDF_","_XPDA_",",2)=ORD
"RTN","XPDIK",148,0)
 D FILE^DIE("","XPD")
"RTN","XPDIK",149,0)
 Q 1
"RTN","XPDIK",150,0)
 ;
"RTN","XPDIK",151,0)
XPCK(XPDI) ;setup check points for file type XPDI
"RTN","XPDIK",152,0)
 ;XPDI="KRN"-components, ="FIA"-files
"RTN","XPDIK",153,0)
 N %,XPD,XPDF,XPDJ,XPDK
"RTN","XPDIK",154,0)
 ;XPDK=sub DD
"RTN","XPDIK",155,0)
 S XPDK=$S(XPDI="KRN":9.715,1:9.714),XPDF=0
"RTN","XPDIK",156,0)
 F %=1:1 S XPDF=$O(^XTMP("XPDI",XPDA,XPDI,XPDF)) Q:'XPDF  S (XPDJ(%),XPD(XPDK,"+"_%_","_XPDA_",",.01))=XPDF
"RTN","XPDIK",157,0)
 D:$D(XPD)>9 UPDATE^DIE("","XPD","XPDJ")
"RTN","XPDIK",158,0)
 Q
"VER")
8.0^22.0
**END**
**END**
