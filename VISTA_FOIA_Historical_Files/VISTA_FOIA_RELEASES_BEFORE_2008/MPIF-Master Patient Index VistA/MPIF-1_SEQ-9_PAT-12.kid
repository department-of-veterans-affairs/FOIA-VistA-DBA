EMERGENCY Released MPIF*1*12 SEQ #9
Extracted from mail message
**KIDS**:MPIF*1.0*12^

**INSTALL NAME**
MPIF*1.0*12
"BLD",1829,0)
MPIF*1.0*12^MASTER PATIENT INDEX VISTA^0^3001206^y
"BLD",1829,4,0)
^9.64PA^^
"BLD",1829,"ABPKG")
n
"BLD",1829,"KRN",0)
^9.67PA^19^17
"BLD",1829,"KRN",.4,0)
.4
"BLD",1829,"KRN",.401,0)
.401
"BLD",1829,"KRN",.402,0)
.402
"BLD",1829,"KRN",.403,0)
.403
"BLD",1829,"KRN",.5,0)
.5
"BLD",1829,"KRN",.84,0)
.84
"BLD",1829,"KRN",3.6,0)
3.6
"BLD",1829,"KRN",3.8,0)
3.8
"BLD",1829,"KRN",9.2,0)
9.2
"BLD",1829,"KRN",9.8,0)
9.8
"BLD",1829,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1829,"KRN",9.8,"NM",1,0)
MPIFQ1^^0^B35761799
"BLD",1829,"KRN",9.8,"NM","B","MPIFQ1",1)

"BLD",1829,"KRN",19,0)
19
"BLD",1829,"KRN",19.1,0)
19.1
"BLD",1829,"KRN",101,0)
101
"BLD",1829,"KRN",409.61,0)
409.61
"BLD",1829,"KRN",771,0)
771
"BLD",1829,"KRN",870,0)
870
"BLD",1829,"KRN",8994,0)
8994
"BLD",1829,"KRN","B",.4,.4)

"BLD",1829,"KRN","B",.401,.401)

"BLD",1829,"KRN","B",.402,.402)

"BLD",1829,"KRN","B",.403,.403)

"BLD",1829,"KRN","B",.5,.5)

"BLD",1829,"KRN","B",.84,.84)

"BLD",1829,"KRN","B",3.6,3.6)

"BLD",1829,"KRN","B",3.8,3.8)

"BLD",1829,"KRN","B",9.2,9.2)

"BLD",1829,"KRN","B",9.8,9.8)

"BLD",1829,"KRN","B",19,19)

"BLD",1829,"KRN","B",19.1,19.1)

"BLD",1829,"KRN","B",101,101)

"BLD",1829,"KRN","B",409.61,409.61)

"BLD",1829,"KRN","B",771,771)

"BLD",1829,"KRN","B",870,870)

"BLD",1829,"KRN","B",8994,8994)

"BLD",1829,"QUES",0)
^9.62^^
"BLD",1829,"REQB",0)
^9.611^2^2
"BLD",1829,"REQB",1,0)
MPIF*1.0*8^1
"BLD",1829,"REQB",2,0)
MPIF*1.0*1^1
"BLD",1829,"REQB","B","MPIF*1.0*1",2)

"BLD",1829,"REQB","B","MPIF*1.0*8",1)

"MBREQ")
0
"PKG",474,-1)
1^1
"PKG",474,0)
MASTER PATIENT INDEX VISTA^MPIF^Master Patient Index VistA side
"PKG",474,20,0)
^9.402P^^
"PKG",474,22,0)
^9.49I^1^1
"PKG",474,22,1,0)
1.0^2990428^2990603^9139
"PKG",474,22,1,"PAH",1,0)
12^3001206
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","MPIFQ1")
0^1^B35761799
"RTN","MPIFQ1",1,0)
MPIFQ1 ;ALB/RJS-CIRN QUERY HANDLER ;JUN 30, 1997
"RTN","MPIFQ1",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**1,8,12**;30 Apr 99
"RTN","MPIFQ1",3,0)
INIT ;Entry point for List Manager Template - MPIF REAL-TIME QUERY
"RTN","MPIFQ1",4,0)
 ; It is started from outside of the template.
"RTN","MPIFQ1",5,0)
 Q
"RTN","MPIFQ1",6,0)
HDR ;Header code for List Manager Template - MPIF REAL-TIME QUERY
"RTN","MPIFQ1",7,0)
 N SSN,DOB,MPIFQ1,NAME1
"RTN","MPIFQ1",8,0)
 D GETDATA^MPIFQ0("^DPT(",DFN,"MPIFQ1",".01;.03;.09","EI")
"RTN","MPIFQ1",9,0)
 S NAME1=$G(MPIFQ1(2,DFN,.01,"E"))
"RTN","MPIFQ1",10,0)
 S SSN=$G(MPIFQ1(2,DFN,.09,"E"))
"RTN","MPIFQ1",11,0)
 S DOB=$G(MPIFQ1(2,DFN,.03,"I"))
"RTN","MPIFQ1",12,0)
 I DOB]"" S DOB=$$IN2EXDT^VAFCMGU0(DOB,0)
"RTN","MPIFQ1",13,0)
 S VALMHDR(1)=" Possible MPI Matches for Patient: "_IOINHI_NAME1_IOINORM
"RTN","MPIFQ1",14,0)
 S VALMHDR(2)="                              SSN: "_IOINHI_SSN_IOINORM
"RTN","MPIFQ1",15,0)
 S VALMHDR(3)="                              DOB: "_IOINHI_DOB_IOINORM
"RTN","MPIFQ1",16,0)
 Q
"RTN","MPIFQ1",17,0)
START(INDEX) ;
"RTN","MPIFQ1",18,0)
 ;Starting entry point for envoking the List Manager Template MPIF Real-time query
"RTN","MPIFQ1",19,0)
 S VALMCNT=INDEX
"RTN","MPIFQ1",20,0)
 D EN^VALM("MPIF REAL-TIME QUERY")
"RTN","MPIFQ1",21,0)
 Q
"RTN","MPIFQ1",22,0)
SELECT ;
"RTN","MPIFQ1",23,0)
 N VALMY
"RTN","MPIFQ1",24,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","MPIFQ1",25,0)
 I '$D(VALMY) Q
"RTN","MPIFQ1",26,0)
 N DATA,INDEX,ICN,CHKSUM,NODE2,HERESSN
"RTN","MPIFQ1",27,0)
 S INDEX=$O(VALMY(0))
"RTN","MPIFQ1",28,0)
 S DATA=^TMP("MPIFQ0",$J,INDEX,"DATA")
"RTN","MPIFQ1",29,0)
 S NODE2=$G(^TMP("MPIFQ0",$J,INDEX,"INDICATOR"))
"RTN","MPIFQ1",30,0)
 S DATA(.01)=$P(DATA,"^",1) I $E(DATA(.01),$L(DATA(.01)))=" " S DATA(.01)=$E(DATA(.01),1,$L(DATA(.01))-1) ;NAME
"RTN","MPIFQ1",31,0)
 S DATA(.03)=$P(DATA,"^",3) ;DOB
"RTN","MPIFQ1",32,0)
 S DATA(.09)=$P(DATA,"^",2) ;SSN
"RTN","MPIFQ1",33,0)
 S ICN=$P(DATA,"^",4)
"RTN","MPIFQ1",34,0)
 S CHKSUM=$P(ICN,"V",2)
"RTN","MPIFQ1",35,0)
 S ICN=$P(ICN,"V",1) ;ICN
"RTN","MPIFQ1",36,0)
 S DATA(991.01)=ICN
"RTN","MPIFQ1",37,0)
 S DATA(991.02)=CHKSUM ;CHKSUM
"RTN","MPIFQ1",38,0)
 S DATA(991.03)=$P(DATA,"^",5) ;CMOR
"RTN","MPIFQ1",39,0)
 ;
"RTN","MPIFQ1",40,0)
 ;If NODE2["*" it means we got a match on ICN for a patient in our
"RTN","MPIFQ1",41,0)
 ;list, with a patient in our local database. Since we don't allow more 
"RTN","MPIFQ1",42,0)
 ;than one patient to have the same ICN, we log an Exception and assign 
"RTN","MPIFQ1",43,0)
 ;a Local ICN for this patient.
"RTN","MPIFQ1",44,0)
 ;
"RTN","MPIFQ1",45,0)
 I NODE2["*",$O(^DPT("AICN",ICN,""))'=DFN D  Q
"RTN","MPIFQ1",46,0)
 . D CLEAR^VALM1
"RTN","MPIFQ1",47,0)
 . D MSG1
"RTN","MPIFQ1",48,0)
 . D START^RGHLLOG()
"RTN","MPIFQ1",49,0)
 . D EXC^RGHLLOG(227,"Attempted to assign same ICN to Patient DFN "_DFN_". ICN is already used for Name: "_DATA(.01)_" SSN: "_DATA(.09)_" DOB: "_DATA(.03)_" Checkout pair to determine if a Duplicate.",DFN)
"RTN","MPIFQ1",50,0)
 . D STOP^RGHLLOG(0)
"RTN","MPIFQ1",51,0)
 . W !!,"Assigning Local ICN"
"RTN","MPIFQ1",52,0)
 . D LOCAL^MPIFQ0(DFN)
"RTN","MPIFQ1",53,0)
 . D PROMPT
"RTN","MPIFQ1",54,0)
 . S MPIFRTN="CONTINUE"
"RTN","MPIFQ1",55,0)
 ;
"RTN","MPIFQ1",56,0)
 ;User selected one from the list that doesn't exist already in this
"RTN","MPIFQ1",57,0)
 ; Patient file. 
"RTN","MPIFQ1",58,0)
 ;Does SSN and Name match?  If no - ask if they are sure before 
"RTN","MPIFQ1",59,0)
 ;updating ICN and CMOR fields
"RTN","MPIFQ1",60,0)
 ;
"RTN","MPIFQ1",61,0)
 D GETDATA^MPIFQ0("^DPT(",DFN,"MPIFQ1",".01;.09","EI")
"RTN","MPIFQ1",62,0)
 S SSN=$G(MPIFQ1(2,DFN,.09,"E")),NAME=$G(MPIFQ1(2,DFN,.01,"E"))
"RTN","MPIFQ1",63,0)
 ;SSN and Name both match on site and MPI -- Update ICN and CMOR
"RTN","MPIFQ1",64,0)
 I DATA(.09)=SSN,DATA(.01)=NAME  K DATA(.09),DATA(.01),DATA(.03) D EDIT^MPIFQED(DFN,"DATA") D MSG3,PROMPT,TF(DFN,.DATA) Q
"RTN","MPIFQ1",65,0)
 ;
"RTN","MPIFQ1",66,0)
 ;SSN and/or Name doesn't match
"RTN","MPIFQ1",67,0)
 D CLEAR^VALM1
"RTN","MPIFQ1",68,0)
 D MSG2
"RTN","MPIFQ1",69,0)
 D MSG(SSN,NAME,DATA(.09),DATA(.01))
"RTN","MPIFQ1",70,0)
 N ANS
"RTN","MPIFQ1",71,0)
 S ANS=$$PROMPT1()
"RTN","MPIFQ1",72,0)
 I ANS K DATA(.09),DATA(.01),DATA(.03) D EDIT^MPIFQED(DFN,"DATA") S MPIFRTN="CONTINUE" W !!,"ICN and CMOR Updated" D PROMPT,TF(DFN,.DATA) Q
"RTN","MPIFQ1",73,0)
 D MSG5,PROMPT
"RTN","MPIFQ1",74,0)
 S VALMBCK="R"
"RTN","MPIFQ1",75,0)
 ;
"RTN","MPIFQ1",76,0)
 Q
"RTN","MPIFQ1",77,0)
 ;
"RTN","MPIFQ1",78,0)
 ;
"RTN","MPIFQ1",79,0)
ADD ;
"RTN","MPIFQ1",80,0)
 ;Add List Manager Action (MPIF REAL-TIME QUERY (ADD PATIENT)) to add
"RTN","MPIFQ1",81,0)
 ; patient to the MPI Austin.
"RTN","MPIFQ1",82,0)
 D A28^MPIFQ0(DFN)
"RTN","MPIFQ1",83,0)
 D MSG3,PROMPT
"RTN","MPIFQ1",84,0)
 S MPIFRTN="CONTINUE"
"RTN","MPIFQ1",85,0)
 Q
"RTN","MPIFQ1",86,0)
 ;
"RTN","MPIFQ1",87,0)
HELP ; Help List Manager Action (MPIF REAL-TIME QUERY (HELP))
"RTN","MPIFQ1",88,0)
 D CLEAR^VALM1
"RTN","MPIFQ1",89,0)
 D MSG4
"RTN","MPIFQ1",90,0)
 D PROMPT
"RTN","MPIFQ1",91,0)
 S VALMBCK="R"
"RTN","MPIFQ1",92,0)
 Q
"RTN","MPIFQ1",93,0)
 ;
"RTN","MPIFQ1",94,0)
MSG(LOCSSN,LOCNAME,MPISSN,MPINAME) ;
"RTN","MPIFQ1",95,0)
 ;
"RTN","MPIFQ1",96,0)
 W !!!,"Local SSN = "_LOCSSN,?35,"MPI SSN = "_MPISSN
"RTN","MPIFQ1",97,0)
 W !,"Local NAME = "_LOCNAME,?40,"MPI NAME = "_MPINAME
"RTN","MPIFQ1",98,0)
 Q
"RTN","MPIFQ1",99,0)
 ;
"RTN","MPIFQ1",100,0)
MSG3 ;
"RTN","MPIFQ1",101,0)
 W !!,"Updating ICN and CMOR"
"RTN","MPIFQ1",102,0)
 Q
"RTN","MPIFQ1",103,0)
MSG1 ;
"RTN","MPIFQ1",104,0)
 W !!,"You are attempting to assign an ICN that has already been assigned"
"RTN","MPIFQ1",105,0)
 W !,"to another patient in your Patient file."
"RTN","MPIFQ1",106,0)
 W !,"An Exception will be recorded noting that these 2 patients "
"RTN","MPIFQ1",107,0)
 W !,"need to be reviewed to determine in they are a duplicate."
"RTN","MPIFQ1",108,0)
 Q
"RTN","MPIFQ1",109,0)
MSG2 ;
"RTN","MPIFQ1",110,0)
 W !!,"You have selected a patient from the list of potential matches"
"RTN","MPIFQ1",111,0)
 W !," where the SSN and/or the Name is different than what the MPI has."
"RTN","MPIFQ1",112,0)
 W !," Are you sure this is the correct patient?"
"RTN","MPIFQ1",113,0)
 Q
"RTN","MPIFQ1",114,0)
 ;
"RTN","MPIFQ1",115,0)
MSG5 ;
"RTN","MPIFQ1",116,0)
 W !!,"No Action Taken"
"RTN","MPIFQ1",117,0)
 Q
"RTN","MPIFQ1",118,0)
MSG4 ;
"RTN","MPIFQ1",119,0)
 W !!,"When you have reached MPI QUERY RESULTS screen, the software has"
"RTN","MPIFQ1",120,0)
 W !,"queried the Master Patient Index, for possible matches to the patient"
"RTN","MPIFQ1",121,0)
 W !,"you are adding, or selected (pre-existing record)."
"RTN","MPIFQ1",122,0)
 W !!,"The MPI has returned a list of possible matches for that patient"
"RTN","MPIFQ1",123,0)
 W !,"An '*' indicates the Integration Control Number of a patient"
"RTN","MPIFQ1",124,0)
 W !,"on the list, matches one in your Patient file already."
"RTN","MPIFQ1",125,0)
 W !,"To select a patient from the list, choose SP."
"RTN","MPIFQ1",126,0)
 W !,"If the patients listed as potential matches aren't the same patient"
"RTN","MPIFQ1",127,0)
 W !,"select ADD to create a new entry on the MPI for this patient"
"RTN","MPIFQ1",128,0)
 Q
"RTN","MPIFQ1",129,0)
 ;
"RTN","MPIFQ1",130,0)
PROMPT ;
"RTN","MPIFQ1",131,0)
 W !!
"RTN","MPIFQ1",132,0)
 S DIR("A")="Hit the Enter key, to Continue "
"RTN","MPIFQ1",133,0)
 S DIR(0)="EA"
"RTN","MPIFQ1",134,0)
 D ^DIR
"RTN","MPIFQ1",135,0)
 K DIR(0),DIR("A")
"RTN","MPIFQ1",136,0)
 Q
"RTN","MPIFQ1",137,0)
PROMPT1() ;
"RTN","MPIFQ1",138,0)
 N DIR,X,Y
"RTN","MPIFQ1",139,0)
 W !
"RTN","MPIFQ1",140,0)
 S DIR("A")="Are you sure this is the correct patient? Enter YES or NO "
"RTN","MPIFQ1",141,0)
 S DIR(0)="YA"
"RTN","MPIFQ1",142,0)
 D ^DIR
"RTN","MPIFQ1",143,0)
 K DIR(0),DIR("A")
"RTN","MPIFQ1",144,0)
 Q Y
"RTN","MPIFQ1",145,0)
HERESSN(SSN) ;
"RTN","MPIFQ1",146,0)
 N DFN
"RTN","MPIFQ1",147,0)
 I $G(SSN)="" Q 0
"RTN","MPIFQ1",148,0)
 S DFN=$O(^DPT("SSN",SSN,0))
"RTN","MPIFQ1",149,0)
 Q:$G(DFN)']"" 0
"RTN","MPIFQ1",150,0)
 Q DFN
"RTN","MPIFQ1",151,0)
 ;
"RTN","MPIFQ1",152,0)
CHECK(DFN) ;
"RTN","MPIFQ1",153,0)
 N CHECK
"RTN","MPIFQ1",154,0)
 D GETDATA^MPIFQ0("^DPT(",DFN,"CHECK",".01;.02;.03;.09;.301;391;1901")
"RTN","MPIFQ1",155,0)
 I $G(CHECK(2,DFN,.01))']"" Q 0
"RTN","MPIFQ1",156,0)
 I $G(CHECK(2,DFN,.02))']"" Q 0
"RTN","MPIFQ1",157,0)
 I $G(CHECK(2,DFN,.03))']"" Q 0
"RTN","MPIFQ1",158,0)
 I $G(CHECK(2,DFN,.09))']"" Q 0
"RTN","MPIFQ1",159,0)
 I $G(CHECK(2,DFN,.301))']"" Q 0
"RTN","MPIFQ1",160,0)
 I $G(CHECK(2,DFN,391))']"" Q 0
"RTN","MPIFQ1",161,0)
 I $G(CHECK(2,DFN,1901))']"" Q 0
"RTN","MPIFQ1",162,0)
 Q 1
"RTN","MPIFQ1",163,0)
 ;
"RTN","MPIFQ1",164,0)
EXIT ;Exit for List Manager Template MPIF REAL-TIME QUERY
"RTN","MPIFQ1",165,0)
 K VALMBCK,VALMCNT,VALMHDR
"RTN","MPIFQ1",166,0)
 Q
"RTN","MPIFQ1",167,0)
 ;
"RTN","MPIFQ1",168,0)
TF(DFN,ARR) ;Add you to TF list and trigger TF and Sub msgs
"RTN","MPIFQ1",169,0)
 N SITE
"RTN","MPIFQ1",170,0)
 S SITE=$P($$SITE^VASITE(),"^",3)
"RTN","MPIFQ1",171,0)
 I SITE=ARR(991.03) D TFLIST^MPIFBT2(SITE,DFN) Q
"RTN","MPIFQ1",172,0)
 I '$$PATCH^XPDUTL("DG*5.3*261") D
"RTN","MPIFQ1",173,0)
 .D TFLIST^MPIFBT2(HERE,DFN),TFUPDT^MPIFBT2(DFN,0,0),INSERT^RGJCTS01(DFN)
"RTN","MPIFQ1",174,0)
 I $$PATCH^XPDUTL("DG*5.3*261") D FILE^VAFCTFU(DFN,+$$SITE^VASITE)
"RTN","MPIFQ1",175,0)
 Q
"VER")
8.0^22.0
**END**
**END**
