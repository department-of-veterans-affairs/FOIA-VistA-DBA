Released DG*5.3*498 SEQ #437
Extracted from mail message
**KIDS**:DG*5.3*498^

**INSTALL NAME**
DG*5.3*498
"BLD",3841,0)
DG*5.3*498^REGISTRATION^0^3030331^y
"BLD",3841,4,0)
^9.64PA^2^2
"BLD",3841,4,2,0)
2
"BLD",3841,4,2,2,0)
^9.641^2^1
"BLD",3841,4,2,2,2,0)
PATIENT  (File-top level)
"BLD",3841,4,2,2,2,1,0)
^9.6411^.109^1
"BLD",3841,4,2,2,2,1,.109,0)
EXCLUDE FROM FACILITY DIR
"BLD",3841,4,2,222)
y^n^p^^^^n^^n
"BLD",3841,4,2,224)

"BLD",3841,4,405,0)
405
"BLD",3841,4,405,2,0)
^9.641^405^1
"BLD",3841,4,405,2,405,0)
PATIENT MOVEMENT  (File-top level)
"BLD",3841,4,405,2,405,1,0)
^9.6411^43^4
"BLD",3841,4,405,2,405,1,40,0)
EXCLUDE FROM FACILITY DIR
"BLD",3841,4,405,2,405,1,41,0)
FACILITY DIRECTORY EXCLUSION
"BLD",3841,4,405,2,405,1,42,0)
FACILITY DIRECTORY TIME STAMP
"BLD",3841,4,405,2,405,1,43,0)
FACILITY DIRECTORY USER
"BLD",3841,4,405,222)
y^n^p^^^^n^^n
"BLD",3841,4,405,224)

"BLD",3841,4,"APDD",2,2)

"BLD",3841,4,"APDD",2,2,.109)

"BLD",3841,4,"APDD",405,405)

"BLD",3841,4,"APDD",405,405,40)

"BLD",3841,4,"APDD",405,405,41)

"BLD",3841,4,"APDD",405,405,42)

"BLD",3841,4,"APDD",405,405,43)

"BLD",3841,4,"B",2,2)

"BLD",3841,4,"B",405,405)

"BLD",3841,"KRN",0)
^9.67PA^8989.52^19
"BLD",3841,"KRN",.4,0)
.4
"BLD",3841,"KRN",.401,0)
.401
"BLD",3841,"KRN",.402,0)
.402
"BLD",3841,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",3841,"KRN",.402,"NM",1,0)
DGPM ADMIT    FILE #405^405^0
"BLD",3841,"KRN",.402,"NM",2,0)
DGPM ASIH ADMIT    FILE #405^405^0
"BLD",3841,"KRN",.402,"NM","B","DGPM ADMIT    FILE #405",1)

"BLD",3841,"KRN",.402,"NM","B","DGPM ASIH ADMIT    FILE #405",2)

"BLD",3841,"KRN",.403,0)
.403
"BLD",3841,"KRN",.5,0)
.5
"BLD",3841,"KRN",.84,0)
.84
"BLD",3841,"KRN",3.6,0)
3.6
"BLD",3841,"KRN",3.8,0)
3.8
"BLD",3841,"KRN",9.2,0)
9.2
"BLD",3841,"KRN",9.8,0)
9.8
"BLD",3841,"KRN",9.8,"NM",0)
^9.68A^11^11
"BLD",3841,"KRN",9.8,"NM",1,0)
DGOIL^^0^B27689558
"BLD",3841,"KRN",9.8,"NM",2,0)
DGOIL1^^0^B8570407
"BLD",3841,"KRN",9.8,"NM",3,0)
DGOINPT1^^0^B24736450
"BLD",3841,"KRN",9.8,"NM",4,0)
DGPMDDCN^^0^B21262731
"BLD",3841,"KRN",9.8,"NM",5,0)
DGPMV10^^0^B27434621
"BLD",3841,"KRN",9.8,"NM",6,0)
VADPT^^0^B16792533
"BLD",3841,"KRN",9.8,"NM",7,0)
VADPT0^^0^B12262577
"BLD",3841,"KRN",9.8,"NM",8,0)
VADPT30^^0^B14142046
"BLD",3841,"KRN",9.8,"NM",9,0)
VADPT31^^0^B17036513
"BLD",3841,"KRN",9.8,"NM",10,0)
DGOIL2^^0^B18999612
"BLD",3841,"KRN",9.8,"NM",11,0)
DGRPD^^0^B50758361
"BLD",3841,"KRN",9.8,"NM","B","DGOIL",1)

"BLD",3841,"KRN",9.8,"NM","B","DGOIL1",2)

"BLD",3841,"KRN",9.8,"NM","B","DGOIL2",10)

"BLD",3841,"KRN",9.8,"NM","B","DGOINPT1",3)

"BLD",3841,"KRN",9.8,"NM","B","DGPMDDCN",4)

"BLD",3841,"KRN",9.8,"NM","B","DGPMV10",5)

"BLD",3841,"KRN",9.8,"NM","B","DGRPD",11)

"BLD",3841,"KRN",9.8,"NM","B","VADPT",6)

"BLD",3841,"KRN",9.8,"NM","B","VADPT0",7)

"BLD",3841,"KRN",9.8,"NM","B","VADPT30",8)

"BLD",3841,"KRN",9.8,"NM","B","VADPT31",9)

"BLD",3841,"KRN",19,0)
19
"BLD",3841,"KRN",19.1,0)
19.1
"BLD",3841,"KRN",101,0)
101
"BLD",3841,"KRN",409.61,0)
409.61
"BLD",3841,"KRN",771,0)
771
"BLD",3841,"KRN",870,0)
870
"BLD",3841,"KRN",8989.51,0)
8989.51
"BLD",3841,"KRN",8989.52,0)
8989.52
"BLD",3841,"KRN",8994,0)
8994
"BLD",3841,"KRN","B",.4,.4)

"BLD",3841,"KRN","B",.401,.401)

"BLD",3841,"KRN","B",.402,.402)

"BLD",3841,"KRN","B",.403,.403)

"BLD",3841,"KRN","B",.5,.5)

"BLD",3841,"KRN","B",.84,.84)

"BLD",3841,"KRN","B",3.6,3.6)

"BLD",3841,"KRN","B",3.8,3.8)

"BLD",3841,"KRN","B",9.2,9.2)

"BLD",3841,"KRN","B",9.8,9.8)

"BLD",3841,"KRN","B",19,19)

"BLD",3841,"KRN","B",19.1,19.1)

"BLD",3841,"KRN","B",101,101)

"BLD",3841,"KRN","B",409.61,409.61)

"BLD",3841,"KRN","B",771,771)

"BLD",3841,"KRN","B",870,870)

"BLD",3841,"KRN","B",8989.51,8989.51)

"BLD",3841,"KRN","B",8989.52,8989.52)

"BLD",3841,"KRN","B",8994,8994)

"BLD",3841,"QUES",0)
^9.62^^
"BLD",3841,"REQB",0)
^9.611^7^7
"BLD",3841,"REQB",1,0)
DG*5.3*415^2
"BLD",3841,"REQB",2,0)
DG*5.3*279^2
"BLD",3841,"REQB",3,0)
DG*5.3*111^2
"BLD",3841,"REQB",4,0)
DG*5.3*93^2
"BLD",3841,"REQB",5,0)
DG*5.3*84^2
"BLD",3841,"REQB",6,0)
DG*5.3*445^2
"BLD",3841,"REQB",7,0)
DG*5.3*489^2
"BLD",3841,"REQB","B","DG*5.3*111",3)

"BLD",3841,"REQB","B","DG*5.3*279",2)

"BLD",3841,"REQB","B","DG*5.3*415",1)

"BLD",3841,"REQB","B","DG*5.3*445",6)

"BLD",3841,"REQB","B","DG*5.3*489",7)

"BLD",3841,"REQB","B","DG*5.3*84",5)

"BLD",3841,"REQB","B","DG*5.3*93",4)

"FIA",2)
PATIENT
"FIA",2,0)
^DPT(
"FIA",2,0,0)
2I
"FIA",2,0,1)
y^n^p^^^^n^^n
"FIA",2,0,10)

"FIA",2,0,11)

"FIA",2,0,"RLRO")

"FIA",2,0,"VR")
5.3^DG
"FIA",2,2)
1
"FIA",2,2,.109)

"FIA",405)
PATIENT MOVEMENT
"FIA",405,0)
^DGPM(
"FIA",405,0,0)
405ID
"FIA",405,0,1)
y^n^p^^^^n^^n
"FIA",405,0,10)

"FIA",405,0,11)

"FIA",405,0,"RLRO")

"FIA",405,0,"VR")
5.3^DG
"FIA",405,405)
1
"FIA",405,405,40)

"FIA",405,405,41)

"FIA",405,405,42)

"FIA",405,405,43)

"KRN",.402,1098,-1)
0^1
"KRN",.402,1098,0)
DGPM ADMIT^3030218.1445^^405^^^3030311
"KRN",.402,1098,"%D",0)
^^3^3^2890921^^^
"KRN",.402,1098,"%D",1,0)
This template is used by routine DGPMV3 to capture admission data for a
"KRN",.402,1098,"%D",2,0)
particular patient.  This template can not be used without the
"KRN",.402,1098,"%D",3,0)
interaction of the 'Admit a Patient' option in MAS.
"KRN",.402,1098,"DIAB",1,0,405,3)
103///NOW
"KRN",.402,1098,"DIAB",4,0,405,0)
41;"DOES THE PATIENT WISH TO BE EXCLUDED FROM THE FACILITY DIRECTORY?";REQ
"KRN",.402,1098,"DIAB",6,0,405,1)
.04;"TYPE OF ADMISSION"
"KRN",.402,1098,"DR",1,405)
S:$S(DGPMN:1,DGPMY=+^DGPM(DA,0):1,1:0) Y=41;.01///^S X=DGPMY;Q;41R~DOES THE PATIENT WISH TO BE EXCLUDED FROM THE FACILITY DIRECTORY?~;.12;Q;54////^S X=$$ADCAT^DGSAUTL($P(^DGPM(DA,0),U,12));
"KRN",.402,1098,"DR",1,405,1)
I $S('$D(^DPT(DFN,.3)):1,$P(^(.3),"^",1)'="Y":1,1:0) S Y="@11";Q;.11;@11;S ^DISV(DUZ,"^DG(405.1,")=$S($D(^DISV(DUZ,"DGPM1")):^("DGPM1"),1:"");.04TYPE OF ADMISSION~;
"KRN",.402,1098,"DR",1,405,2)
S ^DISV(DUZ,"DGPM1")=$S($D(^DISV(DUZ,"^DG(405.1,")):^("^DG(405.1,"),1:"");I $P(^DGPM(DA,0),"^",18)'=9 S Y=.1;.05;.1;Q;Q;Q;.06;.07;Q;Q;D DFN^DGYZODS S:'DGODS Y="@12";11500.01////1;@12;I DGPMP=^DGPM(DA,0) S Y="";102////^S X=DUZ;Q;
"KRN",.402,1098,"DR",1,405,3)
103///^S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100);
"KRN",.402,1098,"ROU")
^DGPMX1
"KRN",.402,1098,"ROUOLD")
DGPMX1
"KRN",.402,1104,-1)
0^2
"KRN",.402,1104,0)
DGPM ASIH ADMIT^3030219.1157^^405^^^3030219
"KRN",.402,1104,"%D",0)
^.4021^3^3^3000425^^^^
"KRN",.402,1104,"%D",1,0)
This template is used when transfering a patient TO ASIH or CONTINUED ASIH,
"KRN",.402,1104,"%D",2,0)
both of which cause a new admission to be created.  This template edits the
"KRN",.402,1104,"%D",3,0)
hospital admission.
"KRN",.402,1104,"DIAB",3,0,405,0)
41;"DOES THE PATIENT WISH TO BE EXCLUDED FROM THE FACILITY DIRECTORY?";REQ
"KRN",.402,1104,"DIAB",8,0,405,1)
103///NOW
"KRN",.402,1104,"DR",1,405)
S:DGPMNA Y=41;.01///^S X=+DGPMA;41R~DOES THE PATIENT WISH TO BE EXCLUDED FROM THE FACILITY DIRECTORY?~;.06////^S X=$P(DGPMA,"^",6);.07////^S X=$P(DGPMA,"^",7);.12;I $S('$D(^DPT(DFN,.3)):1,$P(^(.3),"^",1)'="Y":1,1:0) S Y="@1";.11;
"KRN",.402,1104,"DR",1,405,1)
@1;.1;Q;D DFN^DGYZODS S:'DGODS Y=102;11500.01////1;102////^S X=DUZ;Q;103///^S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100);
"KRN",.402,1104,"ROU")
^DGPMXA
"KRN",.402,1104,"ROUOLD")
DGPMXA
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",114,-1)
1^1
"PKG",114,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",114,20,0)
^9.402P^^
"PKG",114,22,0)
^9.49I^1^1
"PKG",114,22,1,0)
5.3^2930813^2930821
"PKG",114,22,1,"PAH",1,0)
498^3030331
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","DGOIL")
0^1^B27689558
"RTN","DGOIL",1,0)
DGOIL ;ALB/AAS - INPATIENT LIST ; 28-SEPT-90
"RTN","DGOIL",2,0)
 ;;5.3;Registration;**162,279,498**;Aug 13, 1993
"RTN","DGOIL",3,0)
 ;
"RTN","DGOIL",4,0)
% ; -- start here
"RTN","DGOIL",5,0)
 D HOME^%ZIS W @IOF
"RTN","DGOIL",6,0)
 W !!,?32,"Inpatient List",!!!
"RTN","DGOIL",7,0)
 ;
"RTN","DGOIL",8,0)
WARD ; -- by ward or by name
"RTN","DGOIL",9,0)
 S DIR("B")="WARD",DIR(0)="S^1:WARD;0:NAME",DIR("A")="SORT BY" D ^DIR K DIR G:$D(DIRUT) END1 S DGWARD=+Y
"RTN","DGOIL",10,0)
 ;
"RTN","DGOIL",11,0)
FIRST ; -- get range of the output
"RTN","DGOIL",12,0)
 S DIR("B")="FIRST",DIR(0)="F^1:30",DIR("A")="START WITH "_$S(DGWARD:"WARD LOCATION",1:"NAME")
"RTN","DGOIL",13,0)
 S DIR("?",1)="Enter all or part of a ward name.  If the FROM and TO wards are pure"
"RTN","DGOIL",14,0)
 S DIR("?")="numbers (no alphas), no wards with an alpha suffix will appear on the sort."
"RTN","DGOIL",15,0)
 D ^DIR K DIR G:$D(DIRUT) END1
"RTN","DGOIL",16,0)
 S DGBEG=$$CAP(Y)
"RTN","DGOIL",17,0)
 S:DGBEG="FIRST" DGBEG=""
"RTN","DGOIL",18,0)
 ;
"RTN","DGOIL",19,0)
 S DIR("B")="LAST",DIR(0)="F^1:30",DIR("A")="GO TO "_$S(DGWARD:"WARD LOCATION",1:"NAME") D ^DIR K DIR G:$D(DIRUT) END1
"RTN","DGOIL",20,0)
 S DGEND=$$CAP(Y)
"RTN","DGOIL",21,0)
 S:DGEND="LAST" DGEND="ZZZZZZZ"
"RTN","DGOIL",22,0)
 ;
"RTN","DGOIL",23,0)
 I DGBEG'=DGEND,DGBEG]DGEND W !!,"End must be after beginning",! G FIRST
"RTN","DGOIL",24,0)
 ; Ask Division (sets VAUTD)
"RTN","DGOIL",25,0)
 I '$$ASKDIV^DGUTL() G END1
"RTN","DGOIL",26,0)
 ;
"RTN","DGOIL",27,0)
BRKOUT ; -- with ward breakout
"RTN","DGOIL",28,0)
 W !! S DIR("B")="YES",DIR(0)="Y",DIR("A")="PRINT WITH WARD BREAKOUT" D ^DIR K DIR G:$D(DIRUT) END1 S DGBRK=+Y
"RTN","DGOIL",29,0)
 ;
"RTN","DGOIL",30,0)
DRG ; -- with DGR breakout
"RTN","DGOIL",31,0)
 S DGDRG=0 I DGBRK S DIR("B")="YES",DIR(0)="Y",DIR("A")="PRINT WITH DRG BREAKOUT" D ^DIR G:$D(DIRUT) END1 S DGDRG=+Y
"RTN","DGOIL",32,0)
 ;
"RTN","DGOIL",33,0)
DEV W:DGDRG !,*7,"This output requires 132 column output"
"RTN","DGOIL",34,0)
 S DGPGM="DQ^DGOIL",DGVAR="DGWARD^DGBEG^DGEND^DGBRK^DGDRG^VAUTD#"
"RTN","DGOIL",35,0)
 D ZIS^DGUTQ G:POP END U IO
"RTN","DGOIL",36,0)
 ;
"RTN","DGOIL",37,0)
DQ ;  -- entry point to start processing
"RTN","DGOIL",38,0)
 K ^UTILITY($J)
"RTN","DGOIL",39,0)
 S (POP,DGPG)=0 D NOW^%DTC S Y=$E(%,1,12) D D^DIQ S DGDATE=Y
"RTN","DGOIL",40,0)
 S AFFIL=$S($D(^DG(43,1,"GL")):$P(^("GL"),"^",4),1:0)
"RTN","DGOIL",41,0)
 S:DGBEG]""&(+DGBEG'=DGBEG) DGBEG=$E(DGBEG,1,($L(DGBEG)-1))_$C($A($E(DGBEG,$L(DGBEG)))-1)_"~"
"RTN","DGOIL",42,0)
 S:DGBEG]""&(+DGBEG=DGBEG) DGBEG=DGBEG-.0000001
"RTN","DGOIL",43,0)
 ;
"RTN","DGOIL",44,0)
SORT ;  -- sort inpatients, store in ^utility($j,
"RTN","DGOIL",45,0)
 S W=$S(DGWARD:DGBEG,1:"") ;if sorting by ward start with DGBEG
"RTN","DGOIL",46,0)
 F I=0:0 Q:W=DGEND  S W=$O(^DPT("CN",W)) Q:W']""!(DGWARD&(W]DGEND))  S DFN="" F J=0:0 S DFN=$O(^DPT("CN",W,DFN)) Q:'DFN  S DGPM=^(DFN) D
"RTN","DGOIL",47,0)
 .I 'VAUTD S DGWD=$O(^DIC(42,"B",W,0)) Q:'DGWD  S DGWD=$S('$D(^DIC(42,DGWD,0)):0,+$P(^(0),U,11):$P(^(0),U,11),1:0) Q:'$D(VAUTD(DGWD))
"RTN","DGOIL",48,0)
 .D SETU
"RTN","DGOIL",49,0)
 ;
"RTN","DGOIL",50,0)
 D HDR1 I '$D(^UTILITY($J)) W !,"No Matches Found" G END
"RTN","DGOIL",51,0)
BYWARD ; -- if by ward get entries to print
"RTN","DGOIL",52,0)
 I DGWARD S W="" F I=0:0 S W=$O(^UTILITY($J,W)) Q:W']""!($D(DUOUT))  D HDR:$D(N) S N="" F J=0:0 S N=$O(^UTILITY($J,W,N)) Q:N']""!($D(DUOUT))  S DFN="" F K=0:0 S DFN=$O(^UTILITY($J,W,N,DFN)) Q:'DFN!($D(DUOUT))  S DGPM=^(DFN) D ^DGOIL1
"RTN","DGOIL",53,0)
 ;
"RTN","DGOIL",54,0)
BYNAME ;  -- if by name get entries to print
"RTN","DGOIL",55,0)
 I 'DGWARD S N=DGBEG F I=0:0 S N=$O(^UTILITY($J,N)) Q:N']""!(N]DGEND)!($D(DUOUT))  S W="" F J=0:0 S W=$O(^UTILITY($J,N,W)) Q:W']""!($D(DUOUT))  S DFN="" F K=0:0 S DFN=$O(^UTILITY($J,N,W,DFN)) Q:'DFN!($D(DUOUT))  S DGPM=^(DFN) D ^DGOIL1
"RTN","DGOIL",56,0)
 G END
"RTN","DGOIL",57,0)
 ;
"RTN","DGOIL",58,0)
SETU ;  -- set utility($j,$s(sort by ward:ward,1:name),$s(sort by ward:name,1:ward),dfn)=pointer to dgpm
"RTN","DGOIL",59,0)
 Q:'$D(^DPT(DFN,0))
"RTN","DGOIL",60,0)
 S NAME=$P(^DPT(DFN,0),"^")
"RTN","DGOIL",61,0)
 S ^UTILITY($J,$S(DGWARD:W,1:NAME),$S(DGWARD:NAME,1:W),DFN)=DGPM
"RTN","DGOIL",62,0)
 Q
"RTN","DGOIL",63,0)
 ;
"RTN","DGOIL",64,0)
HDR D LEGEND Q:$D(DUOUT)
"RTN","DGOIL",65,0)
HDR1 S DGPG=DGPG+1 W @IOF,"INPATIENT LIST",?(IOM-29) W DGDATE,"  PAGE: ",DGPG
"RTN","DGOIL",66,0)
 W !,"Patient name",?19,"PT ID",?27,"Admit/Tran Ward",?51,"LOS   AA Pass   UA ASIH" I DGDRG W ?76,"DRG",?83,"Avg",?88,$S('AFFIL:"non-",AFFIL=2:"Int-",1:"Affil"),?96,"L/H",?104,"local",?112,"Days to",?120,"% in ",?128,"flag"
"RTN","DGOIL",67,0)
 W !?30,"date",?38,"location" I DGDRG W ?83,"LOS",?88,$S(AFFIL'=1:"Affil",1:""),?96,"Trim",?104,"L/H",?112,"Trim",?120,"Trim"
"RTN","DGOIL",68,0)
 I DGDRG W !?104,"Trim",?112,"Nat/Loc",?120,"Nat/Loc"
"RTN","DGOIL",69,0)
 W ! F I=1:1:IOM W "="
"RTN","DGOIL",70,0)
 I $D(^UTILITY($J)),DGWARD W !,?8,"WARD LOCATION: ",$S('$D(N):$O(^UTILITY($J,"")),$D(W):W,1:"") D
"RTN","DGOIL",71,0)
 .S I=0 F  S I=$O(VAUTD(I)) Q:'I  W ?45,"DIVISION(S): ",VAUTD(I),!
"RTN","DGOIL",72,0)
 Q
"RTN","DGOIL",73,0)
END K ^UTILITY($J) D:'$D(DUOUT)&('POP)&('$D(DIRUT)) LEGEND Q:$D(ZTQUEUED)
"RTN","DGOIL",74,0)
END1 K %,I,J,K,L,N,M,W,NAME,X,X1,X2,X3,Y,Z,AFFIL,DFN,VA,DGBEG,DGBRK,DGDATE,DGDRG,DGEND,DGPM,DGPGM,DGVAR,DGWARD,DIR,DUOUT,DGOUT,DGL,DRG,DRGCAL,DGPG,DIRUT,VAIN,DGASIH,ADM,DIS,VAUTD
"RTN","DGOIL",75,0)
 D ^%ZISC Q
"RTN","DGOIL",76,0)
 ;
"RTN","DGOIL",77,0)
LEGEND ;  -legend for flag column
"RTN","DGOIL",78,0)
 F L=1:1 Q:IOSL<($Y+6)  W !
"RTN","DGOIL",79,0)
 W !,"'+' Before the Patient name indicates patient is currently ASIH, '!' Indicates patient chose not to be in Facility Directory"
"RTN","DGOIL",80,0)
 W:DGDRG&($E(IOST,1,2)'="C-") !,"LEGEND:  '####' - Stay exceeds high trim,  '**' - Stay exceeds 69% of high trim,  '@' Stay exceeds 49% of high trim"
"RTN","DGOIL",81,0)
 I $E(IOST,1,2)="C-" R !,"Press '^' to QUIT or Return to Continue",Z:DTIME I '$T!(Z["^") S DUOUT=1 Q
"RTN","DGOIL",82,0)
 Q
"RTN","DGOIL",83,0)
CAP(X)  ; -convert lower case input to upper case.
"RTN","DGOIL",84,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","DGOIL",85,0)
 ;
"RTN","DGOIL1")
0^2^B8570407
"RTN","DGOIL1",1,0)
DGOIL1 ;ALB/AAS - INPATIENT LIST (CONT.) ; 28-SEPT-90
"RTN","DGOIL1",2,0)
 ;;5.3;Registration;**162,498**;Aug 13, 1993
"RTN","DGOIL1",3,0)
 ;
"RTN","DGOIL1",4,0)
PRINT ;  -- print line for one entry
"RTN","DGOIL1",5,0)
 I IOSL<($Y+6) D HDR^DGOIL Q:$D(DUOUT)
"RTN","DGOIL1",6,0)
 N I,J,K D INP^VADPT,PID^VADPT
"RTN","DGOIL1",7,0)
 I $D(^DGPM(DGPM,0)),$P(^(0),"^",3)'=DFN W !!,"BAD 'CN' CROSS REFERENCE FOR WARD ",W,", PATIENT NUMBER",DFN,!! Q
"RTN","DGOIL1",8,0)
 S DGPMIFN=DGPM D ^DGOIL2 S X=X3,DGL=+X3
"RTN","DGOIL1",9,0)
 W !,$P(X,"^",10),$P(X,"^",9),$E(N,1,17),?19,VA("BID")
"RTN","DGOIL1",10,0)
 D PRINT2:DGBRK,PRINT1:'DGBRK
"RTN","DGOIL1",11,0)
 D END
"RTN","DGOIL1",12,0)
 Q
"RTN","DGOIL1",13,0)
 ;
"RTN","DGOIL1",14,0)
PRINT2 ; -- Print with ward breakout, if DGDRG add DRG data
"RTN","DGOIL1",15,0)
 I '$O(X(0)) D PRINT1 Q
"RTN","DGOIL1",16,0)
 F M=0:0 S M=$O(X(M)) Q:'M  S X=X(M),Y=$P(X,"^",7),W1=W,W=$P(X,"^",8) D PRINT1 S W=W1 W:$O(X(M)) !
"RTN","DGOIL1",17,0)
 I $O(X(1)) S X=X3 W !?41,"TOTAL" D NUM
"RTN","DGOIL1",18,0)
 I DGDRG D DRG
"RTN","DGOIL1",19,0)
 D BED
"RTN","DGOIL1",20,0)
 Q
"RTN","DGOIL1",21,0)
 ;
"RTN","DGOIL1",22,0)
PRINT1 ; -- Print without ward breakout
"RTN","DGOIL1",23,0)
 S Y=$P(X,"^",7) I Y S Y=$$FMTE^XLFDT(Y,"5DF"),Y=$TR(Y," ","0")
"RTN","DGOIL1",24,0)
 W ?27,Y,?38,$E(W,1,10)
"RTN","DGOIL1",25,0)
NUM W ?49 F L=1:1:5 W $J(+$P(X,"^",L),5)
"RTN","DGOIL1",26,0)
 D:'DGBRK BED
"RTN","DGOIL1",27,0)
 Q
"RTN","DGOIL1",28,0)
 ;
"RTN","DGOIL1",29,0)
DRG ;  - calculate DRG from PTF and print on total line
"RTN","DGOIL1",30,0)
 S PTF=$S($D(^DGPM(DGPM,0)):$P(^(0),U,16),1:"") Q:PTF'>0
"RTN","DGOIL1",31,0)
 S (DRG,DRGCAL)="",AGE=$P(^DPT(DFN,0),U,3),SEX=$P(^(0),U,2),DGCPT=1 D EN1^DGPTFD K DGCPT I DRG="" W ?76,"No DRG can be calculated" Q
"RTN","DGOIL1",32,0)
 S DRGCAL=$S($D(^ICD(DRG,0)):^(0),1:"") W ?76,DRG,?83,$J($P(DRGCAL,"^",8),3,1),?88,$J($P(DRGCAL,"^",$S('AFFIL:7,AFFIL=2:11,1:2)),3,1),?96,$P(DRGCAL,U,3),"/",$P(DRGCAL,"^",4),?104,$P(DRGCAL,"^",9),"/",$P(DRGCAL,"^",10)
"RTN","DGOIL1",33,0)
 S NTT=$P(DRGCAL,U,4)-DGL,LTT=$P(DRGCAL,U,10)-DGL,PNT=$S($P(DRGCAL,U,4)>0:DGL/$P(DRGCAL,U,4)*100\1,1:"*"),PLT=$S($P(DRGCAL,U,10)>0:DGL/$P(DRGCAL,U,10)*100\1,1:"*")
"RTN","DGOIL1",34,0)
 S FLG=$S($P(DRGCAL,U,10)&(LTT<0)!(('$P(DRGCAL,U,10))&(NTT<0)):"####",$S(+PLT=0:PNT,1:PLT)>69:"**",$S(+PLT=0:PNT,1:PLT)>49:"@",1:"") S:LTT<0 LTT=0 S:NTT<0 NTT=0
"RTN","DGOIL1",35,0)
 W ?112,NTT,"/",LTT,?120,PNT,"/",PLT,?128,FLG
"RTN","DGOIL1",36,0)
 ;I DGL'=+XW W !,?48,$J("("_DGL_")",7)
"RTN","DGOIL1",37,0)
 Q
"RTN","DGOIL1",38,0)
 ;
"RTN","DGOIL1",39,0)
END K AGE,SEX,NTT,LTT,PLT,PLN,VA,W1,VAERR,PTF,DGL,DRG,DRGCAL,PNT,FLG
"RTN","DGOIL1",40,0)
 Q
"RTN","DGOIL1",41,0)
% D %^DGOIL
"RTN","DGOIL1",42,0)
 Q
"RTN","DGOIL1",43,0)
 ;
"RTN","DGOIL1",44,0)
EN1 ;
"RTN","DGOIL1",45,0)
 ;  - tasked entry , no ward breakout
"RTN","DGOIL1",46,0)
 ;
"RTN","DGOIL1",47,0)
 S DGBEG="",DGEND="ZZZZZZZ",DGWARD=1,DGBRK=0,DGDRG=0 G DQ^DGOIL
"RTN","DGOIL1",48,0)
 Q
"RTN","DGOIL1",49,0)
 ;
"RTN","DGOIL1",50,0)
EN2 ;
"RTN","DGOIL1",51,0)
 ;  - tasked entry, with ward breakout, no drg
"RTN","DGOIL1",52,0)
 ;
"RTN","DGOIL1",53,0)
 S DGBEG="",DGEND="ZZZZZZZ",DGWRD=1,DGBRK=1,DGDRG=0 G DQ^DGOIL
"RTN","DGOIL1",54,0)
 Q
"RTN","DGOIL1",55,0)
 ;
"RTN","DGOIL1",56,0)
EN3 ;
"RTN","DGOIL1",57,0)
 ;  - tasked entry, with ward breakout, with drg info
"RTN","DGOIL1",58,0)
 ;
"RTN","DGOIL1",59,0)
 S DGBEG="",DGEND="ZZZZZZZ",DGWRD=1,DGBRK=1,DGDRG=1 G DQ^DGOIL
"RTN","DGOIL1",60,0)
 Q
"RTN","DGOIL1",61,0)
BED ;  -- Print room and treating specialty
"RTN","DGOIL1",62,0)
 W !?38,"Rm: ",VAIN(5),?55,"Spec: ",$E($P(VAIN(3),"^",2),1,19)
"RTN","DGOIL1",63,0)
 Q
"RTN","DGOIL2")
0^10^B18999612
"RTN","DGOIL2",1,0)
DGOIL2 ;ALB/AAS - CALCULATE LOS BY TRANSFER ; 28-SEPT-90
"RTN","DGOIL2",2,0)
 ;;5.3;Registration;**93,498**;Aug 13, 1993
"RTN","DGOIL2",3,0)
 ;
"RTN","DGOIL2",4,0)
 ;INPUT   -   Admission ifn in DGPMIFN - call EN^
"RTN","DGOIL2",5,0)
 ;
"RTN","DGOIL2",6,0)
 ;OUTPUT  - x(t)=net los^auth absence days^pass days^unauth days^asih days^gross los^trf date^ward
"RTN","DGOIL2",7,0)
 ;          x3=sum of x(t's)
"RTN","DGOIL2",8,0)
 ;
"RTN","DGOIL2",9,0)
EN N T,I S (LOP,LOA,LOUA,LOAS)=0
"RTN","DGOIL2",10,0)
 S (X,X3)="0^0^0^0^0^0^0"
"RTN","DGOIL2",11,0)
 I $S('$D(DGPMIFN):1,'$D(^DGPM(+DGPMIFN,0)):1,$P(^(0),"^",2)'=1:1,1:0) G END
"RTN","DGOIL2",12,0)
 S B=^DGPM(DGPMIFN,0),DFN=$P(B,"^",3),A=+B
"RTN","DGOIL2",13,0)
 I $P(B,"^",22) S:$L(A)=7 A=A_"." S A=A_"000000",A=$E(A,1,14)_$P(B,"^",22)
"RTN","DGOIL2",14,0)
ASIH S DGASIH="" I $P(B,"^",18)=40,$P(B,"^",21),$P(^DGPM($P(B,"^",21),0),"^",14) S ADM=^DGPM($P(^DGPM($P(B,"^",21),0),"^",14),0),DIS=$P(ADM,"^",17) I DIS]"",$D(^DGPM(DIS,0)),+^(0)>DT S DGASIH="+" ;currently asih flag
"RTN","DGOIL2",15,0)
 D MAX
"RTN","DGOIL2",16,0)
 ;
"RTN","DGOIL2",17,0)
 S (I,DGT)=1
"RTN","DGOIL2",18,0)
ADM F DGT=DGT:1 S A1=A,DGPMIFN1=$O(^DGPM("APCA",DFN,DGPMIFN,A,0)) Q:'DGPMIFN1!('A)!('I)  D TRANS
"RTN","DGOIL2",19,0)
 Q:$D(DGPMIFN(1))
"RTN","DGOIL2",20,0)
 S $P(X3,"^",9)=DGASIH
"RTN","DGOIL2",21,0)
 S $P(X3,"^",10)=$S($P($G(^DGPM(DGPMIFN,"DIR")),"^",1)'=0:"!",1:"")
"RTN","DGOIL2",22,0)
 G END
"RTN","DGOIL2",23,0)
 ;
"RTN","DGOIL2",24,0)
EN1 ; - entry to find los for one transfer
"RTN","DGOIL2",25,0)
 ; - input DGPMIFN1 = transfer
"RTN","DGOIL2",26,0)
 ; - output in X(t) if '$d(DGT) t=1
"RTN","DGOIL2",27,0)
 ;
"RTN","DGOIL2",28,0)
 I $S('$D(DGPMIFN1):1,'$D(^DGPM(DGPMIFN1,0)):1,$P(^(0),"^",2)>2:1,1:0) S DGOUT=1 G EN1Q
"RTN","DGOIL2",29,0)
 S DGPMIFN=$P(^DGPM(DGPMIFN1,0),"^",14) I $S('DGPMIFN:1,'$D(^DGPM(DGPMIFN,0)):1,1:0) S DGOUT=1 G EN1Q
"RTN","DGOIL2",30,0)
 S B=^DGPM(DGPMIFN,0)
"RTN","DGOIL2",31,0)
 S DGT=1 D MAX
"RTN","DGOIL2",32,0)
TRANS S (DGOUT,LOP,LOA,LOUA,LOAS)=0
"RTN","DGOIL2",33,0)
 S X(DGT)="0^0^0^0^0^0^0^0^"
"RTN","DGOIL2",34,0)
 S B(DGT)=^DGPM(DGPMIFN1,0)
"RTN","DGOIL2",35,0)
 S DGWRD=+$P(B(DGT),"^",6) I +DGWRD,$D(^DIC(42,+DGWRD,0)) S DGWRD=$P(^(0),"^")
"RTN","DGOIL2",36,0)
 E  S DGWRD=""
"RTN","DGOIL2",37,0)
 ;
"RTN","DGOIL2",38,0)
 S DGDONE=0
"RTN","DGOIL2",39,0)
 F I=A:0 S I=$O(^DGPM("APCA",DFN,DGPMIFN,I)) Q:'I  S:$E(I,1,$L(D))'=D A=I S DGS=$O(^(I,0)) I $D(^DGPM(+DGS,0)) S Z=DGS,DGS=^(0) I "^1^2^3^4^25^26^13^14^43^44^45^"[("^"_$P(DGS,"^",18)_"^") S X2=+DGS,DGS=("^"_$P(DGS,"^",18)_"^") D ABS Q:'I!DGOUT
"RTN","DGOIL2",40,0)
 I 'DGDONE,'I S A1=A,A=D ;end of movements, a1=start of last trf, a=dschrg or now
"RTN","DGOIL2",41,0)
 D TRFTOT
"RTN","DGOIL2",42,0)
 I $D(DGS),"^13^"[DGS D ^DGOIL3
"RTN","DGOIL2",43,0)
EN1Q K DGWRD
"RTN","DGOIL2",44,0)
 Q
"RTN","DGOIL2",45,0)
 ;
"RTN","DGOIL2",46,0)
ABS ; - if patient was on absence, find return.
"RTN","DGOIL2",47,0)
 ; - DGS = mvt type at start of absence
"RTN","DGOIL2",48,0)
 ; - DGE = mvt type at end of absence
"RTN","DGOIL2",49,0)
 ;
"RTN","DGOIL2",50,0)
 I "^43^"[DGS S DGOF=$S($P(^DGPM(Z,0),"^",5):$S($D(^DIC(4,$P(^DGPM(Z,0),"^",5),0)):$P(^(0),"^"),1:"UNK"),1:"UNK")
"RTN","DGOIL2",51,0)
 I "^4^13^43^"[DGS S DGOUT=1 Q  ;start new transfers
"RTN","DGOIL2",52,0)
 ;
"RTN","DGOIL2",53,0)
 I "^14^"[DGS S:$D(DGOF) DGOFF=1 S X1=A,X2=A1 D ^%DTC S LOAS=LOAS+X,DGOUT=1 Q
"RTN","DGOIL2",54,0)
 ;
"RTN","DGOIL2",55,0)
TF S X1=0 F I=I:0 S I=$O(^DGPM("APCA",DFN,DGPMIFN,I)) Q:'I  S DGE=$O(^(I,0)) I $D(^DGPM(+DGE,0)) S DGE=^(0) I "^4^13^14^22^23^24^25^26^43^"[("^"_$P(DGE,"^",18)_"^") S (X1,DGET)=+DGE,DGE="^"_$P(DGE,"^",18)_"^" Q
"RTN","DGOIL2",56,0)
 ;
"RTN","DGOIL2",57,0)
 I 'X1 S (A,X1)=D D ^%DTC S DGOUT=1 D NORET Q  ;if no return from absence use discharge or now 
"RTN","DGOIL2",58,0)
 D ^%DTC
"RTN","DGOIL2",59,0)
 ;
"RTN","DGOIL2",60,0)
 ;if 22 or 26 add time in unauth
"RTN","DGOIL2",61,0)
 I "^22^26^"[DGE S LOUA=LOUA+X,A=A1
"RTN","DGOIL2",62,0)
 ;
"RTN","DGOIL2",63,0)
 ;if 23 add time in pass
"RTN","DGOIL2",64,0)
 I "^23^"[DGE S LOP=LOP+X,A=A1
"RTN","DGOIL2",65,0)
 ;
"RTN","DGOIL2",66,0)
 ;if 24 or 25 add time in auth
"RTN","DGOIL2",67,0)
 I "^24^25^"[DGE S LOA=LOA+X,A=A1
"RTN","DGOIL2",68,0)
 ;
"RTN","DGOIL2",69,0)
 I "^14^"[DGE S LOAS=LOAS+X,DGOUT=1
"RTN","DGOIL2",70,0)
 ;
"RTN","DGOIL2",71,0)
 ;if 25 or 26 sets tranf to and looks for next return
"RTN","DGOIL2",72,0)
 I "^25^26"[DGE S DGS=DGE,X2=DGET G TF
"RTN","DGOIL2",73,0)
 ;
"RTN","DGOIL2",74,0)
 I "^14^44^"[DGE S DGOUT=1 Q  ;I wonder if this is really necessary?
"RTN","DGOIL2",75,0)
 Q
"RTN","DGOIL2",76,0)
 ;
"RTN","DGOIL2",77,0)
TOT ; -- total los from transfer x(t) into x3
"RTN","DGOIL2",78,0)
 F JJ=1:1:6 S $P(X3,"^",JJ)=$P(X3,"^",JJ)+($P(X(DGT),"^",JJ))
"RTN","DGOIL2",79,0)
 F JJ=7:1:8 S $P(X3,"^",JJ)=$P(X(DGT),"^",JJ)
"RTN","DGOIL2",80,0)
 Q
"RTN","DGOIL2",81,0)
 ;
"RTN","DGOIL2",82,0)
TRFTOT ; los for transfer, set x(t)
"RTN","DGOIL2",83,0)
 S X1=A,X2=A1 D ^%DTC
"RTN","DGOIL2",84,0)
 S X(DGT)=(X-(LOA+LOUA))_"^"_LOA_"^"_LOP_"^"_LOUA_"^"_$S($D(DGPMIFN(1)):X,1:LOAS)_"^"_X_"^"_A1_"^"_$S($D(DGOFF):DGOF,1:DGWRD),DGOUT=1 K:$D(DGOFF) DGOFF,DGOF
"RTN","DGOIL2",85,0)
 D TOT
"RTN","DGOIL2",86,0)
 Q
"RTN","DGOIL2",87,0)
 ;
"RTN","DGOIL2",88,0)
NORET ;  -- If discharge while absent find absence up to discharge
"RTN","DGOIL2",89,0)
 S DGDONE=1
"RTN","DGOIL2",90,0)
 I "^1^"[DGS S LOP=LOP+X
"RTN","DGOIL2",91,0)
 I "^2^26^"[DGS S LOA=LOA+X
"RTN","DGOIL2",92,0)
 I "^3^25^"[DGS S LOUA=LOUA+X
"RTN","DGOIL2",93,0)
 I "^14^43^44^45^"[DGS S LOAS=LOAS+X
"RTN","DGOIL2",94,0)
 Q
"RTN","DGOIL2",95,0)
END K A,A1,B,D,DGDONE,DGE,DGET,DGMAX,DGOUT,DGPMIFN,DGPMIFN1,DGS,DGT,DGWRD,I,JJ,LOA,LOAS,LOP,LOUA,T,X1,X2
"RTN","DGOIL2",96,0)
 Q
"RTN","DGOIL2",97,0)
MAX D NOW^%DTC S D=$S($D(^DGPM(+$P(B,"^",17),0)):+^(0),1:0) S D=$S('D:%,D>%:%,1:D) S X1=D,X2=A D ^%DTC S DGMAX=$S(X:X,1:1)
"RTN","DGOIL2",98,0)
 Q
"RTN","DGOINPT1")
0^3^B24736450
"RTN","DGOINPT1",1,0)
DGOINPT1 ;ALB/REW - BUILDS,PRINTS INPATIENT ROSTER ; 7 JAN 1992
"RTN","DGOINPT1",2,0)
 ;;5.3;Registration;**162,498**;Aug 13, 1993
"RTN","DGOINPT1",3,0)
 ;
"RTN","DGOINPT1",4,0)
 ;
"RTN","DGOINPT1",5,0)
 ; DGS1 IS USED FOR SORTING PRINT
"RTN","DGOINPT1",6,0)
 ; DGS2 IS USED FOR X-REF LOOKUP
"RTN","DGOINPT1",7,0)
ROSTER ;
"RTN","DGOINPT1",8,0)
 S X=132 X ^%ZOSF("RM")
"RTN","DGOINPT1",9,0)
 D NOW^%DTC S Y=$E(%,1,12),DGADMT=$$FMTE^XLFDT(Y,1)
"RTN","DGOINPT1",10,0)
 S TOT=0,DGS="",DGS1=""
"RTN","DGOINPT1",11,0)
 I DGHOW="W" S DGXREF="CN" D ROST
"RTN","DGOINPT1",12,0)
 I DGHOW="P","EP"[DGPVAR S DGXREF="APR" D ROST
"RTN","DGOINPT1",13,0)
 I DGHOW="P","EA"[DGPVAR S DGXREF="AAP" D ROST
"RTN","DGOINPT1",14,0)
 I DGHOW="P",DGPVAR="E" D FIXTOT
"RTN","DGOINPT1",15,0)
 D DOLIST
"RTN","DGOINPT1",16,0)
QUIT W !
"RTN","DGOINPT1",17,0)
 K ^TMP($J),DGLIST,DGS,ROOMB,CPS,DFN,DGADMT,DGADM,DGCPYS,DGDAYS,DGDS,DGDV,DGI,DGJ,DGPGM,DGPMDD("DA"),DGVAR,DGWD,DGX,I,J,K,NM,TOT,VAUTD,VAUTW,WD,X,Y
"RTN","DGOINPT1",18,0)
 K DGHOW,DGPVAR,DGS1,DGSUBS,DGTM,DGUTV,DIC,X1,XMDT,XMM,DGXREF,ZZ,DGPMIFN,DGS2,VADAT,VADATE,VADM,VAEL,VAIN,Z,DGTMPV,DGFL,DIR,DGBID
"RTN","DGOINPT1",19,0)
 D KVAR^VADPT,KVAR^VADATE,CLOSE^DGUTQ,ENDREP^DGUTL
"RTN","DGOINPT1",20,0)
 Q
"RTN","DGOINPT1",21,0)
FIXTOT ;
"RTN","DGOINPT1",22,0)
 S DGS=""
"RTN","DGOINPT1",23,0)
 F DGI=0:0 S DGS=$O(^TMP($J,"DGLIST",DGS)) Q:DGS=""  D
"RTN","DGOINPT1",24,0)
 .S DGUTV="^TMP("_$J_","""_DGS_""")"
"RTN","DGOINPT1",25,0)
 .F ZZ=0:1 S DGUTV=$Q(@DGUTV) Q:DGUTV=""!($TR(DGUTV,"""")'[($J_","_DGS_","))
"RTN","DGOINPT1",26,0)
 .S ^TMP($J,"DGLIST",DGS)=ZZ
"RTN","DGOINPT1",27,0)
 Q
"RTN","DGOINPT1",28,0)
ROST ;
"RTN","DGOINPT1",29,0)
 F DGI=0:0 S:DGS]""&TOT ^TMP($J,"DGLIST",DGS1)=TOT S TOT=0,DGS=$S((VAUTW):$O(^DPT(DGXREF,DGS)),1:$O(VAUTW(DGS))) Q:DGS=""  D CHECK I DGFL S DFN="" F DGJ=0:0 S DFN=$O(^DPT(DGXREF,DGS2,DFN)) Q:DFN=""  D ADMDT
"RTN","DGOINPT1",30,0)
 Q
"RTN","DGOINPT1",31,0)
ADMDT ;
"RTN","DGOINPT1",32,0)
 N DGVAIN7,VAL
"RTN","DGOINPT1",33,0)
 D QKVADPT Q:'VAIN(7)  S DGBID=VA("BID") S TOT=TOT+1,X=+VAIN(7),DGVAIN7="" I X S X=$$FMTE^XLFDT(X,"5DF"),X=$TR(X," ","0"),X=$TR(X,"/","-"),DGVAIN7=X
"RTN","DGOINPT1",34,0)
 S DGPMIFN=VAIN(1) D ^DGPMLOS S DGDAYS=$P(X,"^",5)
"RTN","DGOINPT1",35,0)
 S VAL=VADM(1)_U_DGBID_U_VADM(4)_U_DGVAIN7_U_DGDAYS_U_VAIN(4)_U_VAIN(5)_U_$P(VAIN(2),U,2)
"RTN","DGOINPT1",36,0)
 S VAL=VAL_U_$P(VAIN(11),U,2)_U_$P(VAIN(3),U,2)_U_$P(VAEL(9),U,1)_U_$P(VAIP(19,1),U,1)
"RTN","DGOINPT1",37,0)
 S ^TMP($J,DGS1,$S(DGSUBS="R":+$$RM(VAIN(5)),1:VADM(1)),+DGBID)=VAL
"RTN","DGOINPT1",38,0)
 Q
"RTN","DGOINPT1",39,0)
CHECK ;
"RTN","DGOINPT1",40,0)
 S DGFL=1
"RTN","DGOINPT1",41,0)
 I DGHOW="P",VAUTW S DGS1=$S($D(^VA(200,DGS,0)):$P($G(^VA(200,DGS,0)),U,1),1:DGS),DGS2=DGS Q
"RTN","DGOINPT1",42,0)
 I DGHOW="P",'VAUTW S DGS1=DGS,DGS2=VAUTW(DGS) Q
"RTN","DGOINPT1",43,0)
 S DGWD=$O(^DIC(42,"B",DGS,0)) I DGWD S DGDV=$S('$D(^DIC(42,DGWD,0)):0,+$P(^(0),"^",11):$P(^(0),"^",11),1:$O(^DG(40.8,0)))
"RTN","DGOINPT1",44,0)
 I 'VAUTD,'$D(VAUTD(DGDV)) S DGFL=0
"RTN","DGOINPT1",45,0)
 S (DGS1,DGS2)=DGS
"RTN","DGOINPT1",46,0)
 Q
"RTN","DGOINPT1",47,0)
WAIT I $E(IOST)="C" S DIR(0)="E" D ^DIR S:'Y DGX=1
"RTN","DGOINPT1",48,0)
 Q
"RTN","DGOINPT1",49,0)
DOLIST ;
"RTN","DGOINPT1",50,0)
 S DGX=0
"RTN","DGOINPT1",51,0)
 F CPS=1:1:DGCPYS S DGS="" F I=0:0 S DGS=$O(^TMP($J,"DGLIST",DGS)) Q:DGS=""  D HEAD,OUT G QTDOL:DGX D WAIT G QTDOL:DGX
"RTN","DGOINPT1",52,0)
QTDOL Q
"RTN","DGOINPT1",53,0)
HEAD S X=$S(DGHOW="W":"WARD",DGPVAR="E":"PROVIDER",DGPVAR="P":"PRIMARY PHYSICIAN",1:"ATTENDING PHYSICIAN")_": "_DGS_"   "_^TMP($J,"DGLIST",DGS)_" PATIENTS"
"RTN","DGOINPT1",54,0)
 W:IOF]"" @IOF W !!?4,"INPATIENT ROSTER",?(61-($L(X)/2)),X,?99 W DGADMT
"RTN","DGOINPT1",55,0)
 W !!?33,"ADMISSION",?77,"PRIMARY",?94,"ATTENDING",?111,"TREATING",?126,"MEANS"
"RTN","DGOINPT1",56,0)
 W !,"PATIENT NAME",?21,"ID",?28,"AGE",?33,"DATE",?46,"DAYS",?52,"WARD",?67,"ROOM-BED",?77,"PHYSICIAN",?94,"PHYSICIAN",?111,"SPECIALTY",?126,"TEST" K X S $P(X,"-",133)="" W !,X,! Q
"RTN","DGOINPT1",57,0)
OUT ;
"RTN","DGOINPT1",58,0)
 S DGUTV="^TMP("_$J_","""_DGS_""")"
"RTN","DGOINPT1",59,0)
 F ZZ=0:1 S DGUTV=$Q(@DGUTV) Q:DGUTV=""!($TR(DGUTV,"""")'[($J_","_DGS_","))  S DGADM=@DGUTV D PRINT I $Y>(IOSL-6),($TR($Q(@DGUTV),"""")[($J_","_DGS_",")) D LEGEND,WAIT G QTOUT:DGX D HEAD
"RTN","DGOINPT1",60,0)
 I $Y<(IOSL-5) D LEGEND
"RTN","DGOINPT1",61,0)
QTOUT Q
"RTN","DGOINPT1",62,0)
PRINT ;
"RTN","DGOINPT1",63,0)
 W !,$S($P(DGADM,U,12):"!",1:""),$E($P(DGADM,U,1),1,19),?21,$P(DGADM,U,2),?28,$J($P(DGADM,U,3),3)
"RTN","DGOINPT1",64,0)
 W ?33,$P(DGADM,U,4),?46,$J($P(DGADM,U,5),4),?52,$E($P(DGADM,U,6),1,14),?67,$E($P(DGADM,U,7),1,8),?77,$E($P(DGADM,U,8),1,15)
"RTN","DGOINPT1",65,0)
 W ?94,$E($P(DGADM,U,9),1,15),?111,$E($P(DGADM,U,10),1,13),?127,$P(DGADM,U,11) W:DGDS !
"RTN","DGOINPT1",66,0)
 Q
"RTN","DGOINPT1",67,0)
RM(ROOMB) ;
"RTN","DGOINPT1",68,0)
 ;IGNORES CHARACTERS BEFORE THE FIRST NON-ZERO NUMBER
"RTN","DGOINPT1",69,0)
 ;RETURNS NUMBERS IN ROOM-BED BEFORE THE FIRST '-' OR '/' THE REMAINING
"RTN","DGOINPT1",70,0)
 ;NUMBERS ARE DIVIDED BY 100,000 AND ADDED TO THE FIRST PART
"RTN","DGOINPT1",71,0)
 ; E.G.        'A-12E-A103C'
"RTN","DGOINPT1",72,0)
 ;WILL RETURN:  12.000103
"RTN","DGOINPT1",73,0)
 ;
"RTN","DGOINPT1",74,0)
 NEW ROOM1,BEG
"RTN","DGOINPT1",75,0)
 S ROOM1=$TR(ROOMB,"123456789","111111111")
"RTN","DGOINPT1",76,0)
 S BEG=$F(ROOM1,1)-1
"RTN","DGOINPT1",77,0)
 S ROOMB=$TR($E(ROOMB,BEG,99),"-/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz ~!@#$%^&*()_+=`|\{}[]:"";'<>?,.","..")
"RTN","DGOINPT1",78,0)
 S:$L(ROOMB,".")>1 ROOMB=$P(ROOMB,".",1)+(($TR(($P(ROOMB,".",2,99)),"."))/1000000)
"RTN","DGOINPT1",79,0)
 Q +ROOMB
"RTN","DGOINPT1",80,0)
QKVADPT ;QUICK SUBSTITUTE FOR VADPT:REQUIRES DFN
"RTN","DGOINPT1",81,0)
 NEW K,I,DGX
"RTN","DGOINPT1",82,0)
 S K=0
"RTN","DGOINPT1",83,0)
 F I=.105,.104,.103,.1,.101 S K=K+1,VAIN(K)=$G(^DPT(DFN,I))
"RTN","DGOINPT1",84,0)
 S VAIN(11)=$G(^DPT(DFN,.1041))
"RTN","DGOINPT1",85,0)
 S VAIN(7)=+$G(^DGPM(+VAIN(1),0))
"RTN","DGOINPT1",86,0)
 F I=2,11 S:$D(^VA(200,+VAIN(I),0)) VAIN(I)=VAIN(I)_U_$P(^(0),U,1)
"RTN","DGOINPT1",87,0)
 S:$D(^DIC(45.7,+VAIN(3),0)) VAIN(3)=VAIN(3)_U_$P(^(0),U,1)
"RTN","DGOINPT1",88,0)
DEM S VADM(1)=$P($G(^DPT(DFN,0)),U,1)
"RTN","DGOINPT1",89,0)
 S VAIP(19,1)=$P($G(^DGPM(+VAIN(1),"DIR")),"^",1)
"RTN","DGOINPT1",90,0)
 S:VAIP(19,1)="" VAIP(19,1)=1
"RTN","DGOINPT1",91,0)
 S DGX=$P($G(^DPT(DFN,0)),U,3)
"RTN","DGOINPT1",92,0)
 S VADM(4)=$E(DT,1,3)-$E(DGX,1,3)-($E(DT,4,7)<$E(DGX,4,7))
"RTN","DGOINPT1",93,0)
 D PID^VADPT6
"RTN","DGOINPT1",94,0)
MT S VAEL(9)=$P($$MTS^DGMTU(DFN),U,2)
"RTN","DGOINPT1",95,0)
 Q
"RTN","DGOINPT1",96,0)
LEGEND F  Q:($Y>(IOSL-5))  W !
"RTN","DGOINPT1",97,0)
 W !,"'!' Before the Patient name indicates the patient chose not to be listed in the Facility Directory"
"RTN","DGOINPT1",98,0)
 Q
"RTN","DGPMDDCN")
0^4^B21262731
"RTN","DGPMDDCN",1,0)
DGPMDDCN ;ALB/MRL - DETERMINE INPATIENT X-REF'S; 9 FEB 89
"RTN","DGPMDDCN",2,0)
 ;;5.3;Registration;**54,498**;Aug 13, 1993
"RTN","DGPMDDCN",3,0)
 ;
"RTN","DGPMDDCN",4,0)
1 ; 
"RTN","DGPMDDCN",5,0)
 I $S($D(DGPMT):1,('$D(DA)#2):1,'$D(DGPMDDF):1,'$D(DGPMDDT):1,1:0) G KX
"RTN","DGPMDDCN",6,0)
 N DFN S DFN=+$P(^DGPM(+DA,0),"^",3) I '$D(^DPT(DFN,0)) G KX
"RTN","DGPMDDCN",7,0)
 I 'DGPMDDT D @("K"_+DGPMDDF) G Q
"RTN","DGPMDDCN",8,0)
 D INPTCK
"RTN","DGPMDDCN",9,0)
 I $S('VAWD:1,1:$P(VAWD,"^",2)="") D  G Q
"RTN","DGPMDDCN",10,0)
 . N DGWD
"RTN","DGPMDDCN",11,0)
 . D FIND^DGPMDDLD
"RTN","DGPMDDCN",12,0)
 . I DGWD,($P(DGWD,"^",2)]"") D EN^DGPMDDLD Q
"RTN","DGPMDDCN",13,0)
 . K X
"RTN","DGPMDDCN",14,0)
 D @("S"_+DGPMDDF) G Q
"RTN","DGPMDDCN",15,0)
 ;
"RTN","DGPMDDCN",16,0)
KX K X
"RTN","DGPMDDCN",17,0)
Q D KVAR^VADPT30 K DGPMX,DGPMX1,DGFLD,DGPMDD,DGPMDDF,DGPMDDT,I Q
"RTN","DGPMDDCN",18,0)
 ;
"RTN","DGPMDDCN",19,0)
S6 ; -- ward x-ref
"RTN","DGPMDDCN",20,0)
 S DGFLD=.1 I $D(^DPT(DFN,.1)) S DGPMX=^(.1) K:$D(^(.105)) ^DGPM("CN",DGPMX,+^(.105)) D KILL
"RTN","DGPMDDCN",21,0)
 S DGPMX=$P(VAWD,"^",2),^DGPM("CN",DGPMX,+$P(^DGPM(+VAMV,0),"^",14))=""
"RTN","DGPMDDCN",22,0)
 D SET
"RTN","DGPMDDCN",23,0)
 S DGFLD=.102 I $D(^DPT(DFN,.102)) S DGPMX=^(.102) D KILL
"RTN","DGPMDDCN",24,0)
 S DGPMX=+VAMV D SET:DGPMX
"RTN","DGPMDDCN",25,0)
 S DGFLD=.105 I $D(^DPT(DFN,.105)) S DGPMX=^(.105) D KILL
"RTN","DGPMDDCN",26,0)
 S DGPMX=+$P(^DGPM(+VAMV,0),"^",14) D SET:DGPMX
"RTN","DGPMDDCN",27,0)
 Q
"RTN","DGPMDDCN",28,0)
 ;
"RTN","DGPMDDCN",29,0)
K6 ;
"RTN","DGPMDDCN",30,0)
 I X S W=$S($D(^DIC(42,+X,0)):$P(^(0),"^",1),1:"") I W]"" K ^DGPM("CN",W,+$P(^DGPM(DA,0),"^",14)) I $D(^DPT(DFN,.1)),^(.1)=W S DGPMX=W,DGFLD=.1 D KILL
"RTN","DGPMDDCN",31,0)
 K W
"RTN","DGPMDDCN",32,0)
 I $D(^DPT(DFN,.102)),^(.102)=DA S DGPMX=DA,DGFLD=.102 D KILL
"RTN","DGPMDDCN",33,0)
 I $D(^DPT(DFN,.105)),^(.105)=$P(^DGPM(DA,0),"^",14) S DGPMX=$P(^DGPM(DA,0),"^",14),DGFLD=.105 D KILL
"RTN","DGPMDDCN",34,0)
 Q
"RTN","DGPMDDCN",35,0)
 ;
"RTN","DGPMDDCN",36,0)
S7 ; -- room-bed x-ref
"RTN","DGPMDDCN",37,0)
 I $D(^DPT(DFN,.108)) S DGPMX=^(.108),DGFLD=.108 D KILL F DGPMX1=0:0 S DGPMX1=+$O(^DGPM("ARM",DGPMX,DGPMX1)) D CHK I $T K ^DGPM("ARM",DGPMX,DGPMX1) Q
"RTN","DGPMDDCN",38,0)
 S DGFLD=.101 I $D(^DPT(DFN,.101)) S DGPMX=^(.101) D KILL
"RTN","DGPMDDCN",39,0)
 S DGPMX=$P(VARM,"^",2) D SET
"RTN","DGPMDDCN",40,0)
 I +VARM S DGFLD=.108,DGPMX=+VARM,^DGPM("ARM",DGPMX,VAWDA)=0 D SET
"RTN","DGPMDDCN",41,0)
 Q
"RTN","DGPMDDCN",42,0)
 ;
"RTN","DGPMDDCN",43,0)
K7 ;
"RTN","DGPMDDCN",44,0)
 I $D(^DPT(DFN,.108)),X=+^(.108) S DGPMX=X I $D(^DGPM("ARM",DGPMX,DA)) K ^(DA) S DGFLD=.108 D KILL
"RTN","DGPMDDCN",45,0)
 I X S R=$S($D(^DG(405.4,+X,0)):$P(^(0),"^",1),1:"") I R]"",$D(^DPT(DFN,.101)),^(.101)=R S DGPMX=R,DGFLD=.101 D KILL
"RTN","DGPMDDCN",46,0)
 Q
"RTN","DGPMDDCN",47,0)
 ;
"RTN","DGPMDDCN",48,0)
CHK ;
"RTN","DGPMDDCN",49,0)
 I '$D(^DGPM(DGPMX1,0)) Q
"RTN","DGPMDDCN",50,0)
 I $P(^DGPM(DGPMX1,0),"^",3)=DFN Q
"RTN","DGPMDDCN",51,0)
 Q
"RTN","DGPMDDCN",52,0)
 ;
"RTN","DGPMDDCN",53,0)
S8 ; -- doc x-ref
"RTN","DGPMDDCN",54,0)
 S DGFLD=.104 I $D(^DPT(DFN,.104)) S DGPMX=+^(.104) D KILL
"RTN","DGPMDDCN",55,0)
 S DGPMX=+VAPP D SET:DGPMX
"RTN","DGPMDDCN",56,0)
 Q
"RTN","DGPMDDCN",57,0)
 ;
"RTN","DGPMDDCN",58,0)
K8 ;
"RTN","DGPMDDCN",59,0)
 I X,$D(^DPT(DFN,.104)),^(.104)=X S DGPMX=X,DGFLD=.104 D KILL
"RTN","DGPMDDCN",60,0)
 Q
"RTN","DGPMDDCN",61,0)
 ;
"RTN","DGPMDDCN",62,0)
S9 ; -- tr. spec x-ref
"RTN","DGPMDDCN",63,0)
 S DGFLD=.103 I $D(^DPT(DFN,.103)) S DGPMX=+^(.103) D KILL
"RTN","DGPMDDCN",64,0)
 S DGPMX=+VATS D SET:DGPMX
"RTN","DGPMDDCN",65,0)
 Q
"RTN","DGPMDDCN",66,0)
 ;
"RTN","DGPMDDCN",67,0)
K9 ;
"RTN","DGPMDDCN",68,0)
 I X,$D(^DPT(DFN,.103)),^(.103)=X S DGPMX=X,DGFLD=.103 D KILL
"RTN","DGPMDDCN",69,0)
 Q
"RTN","DGPMDDCN",70,0)
 ;
"RTN","DGPMDDCN",71,0)
S19 ; -- attend x-ref
"RTN","DGPMDDCN",72,0)
 S DGFLD=.1041 I $D(^DPT(DFN,.1041)) S DGPMX=+^(.1041) D KILL
"RTN","DGPMDDCN",73,0)
 S DGPMX=+VAAP D SET:DGPMX
"RTN","DGPMDDCN",74,0)
 Q
"RTN","DGPMDDCN",75,0)
 ;
"RTN","DGPMDDCN",76,0)
K19 ;
"RTN","DGPMDDCN",77,0)
 I X,$D(^DPT(DFN,.1041)),^(.1041)=X S DGPMX=X,DGFLD=.1041 D KILL
"RTN","DGPMDDCN",78,0)
 Q
"RTN","DGPMDDCN",79,0)
 ;
"RTN","DGPMDDCN",80,0)
S41 ; -- fac dir x-ref (AFD)
"RTN","DGPMDDCN",81,0)
 S DGFLD=.109 S DGPMX=$P($G(^DPT(DFN,.109)),"^",1) D KILL:(DGPMX'="")
"RTN","DGPMDDCN",82,0)
 S DGPMX=$P(VAFD,"^",1) D SET:(DGPMX'="")
"RTN","DGPMDDCN",83,0)
 Q
"RTN","DGPMDDCN",84,0)
 ;
"RTN","DGPMDDCN",85,0)
K41 ;
"RTN","DGPMDDCN",86,0)
 I X'="",$P($G(^DPT(DFN,.109)),"^",1)=X S DGPMX=X,DGFLD=.109 D KILL
"RTN","DGPMDDCN",87,0)
 Q
"RTN","DGPMDDCN",88,0)
 ;
"RTN","DGPMDDCN",89,0)
SET ; -- generic set x-ref logic
"RTN","DGPMDDCN",90,0)
 Q:DGPMX']""
"RTN","DGPMDDCN",91,0)
 N X,DA S DA=DFN,(^DPT(DA,DGFLD),X)=DGPMX
"RTN","DGPMDDCN",92,0)
 F DGIX=0:0 S DGIX=$O(^DD(2,DGFLD,1,DGIX)) Q:'DGIX  X ^(DGIX,1) S X=DGPMX
"RTN","DGPMDDCN",93,0)
 K DGIX Q
"RTN","DGPMDDCN",94,0)
 ;
"RTN","DGPMDDCN",95,0)
KILL ; -- generic kill x-ref logic
"RTN","DGPMDDCN",96,0)
 Q:DGPMX']""
"RTN","DGPMDDCN",97,0)
 N X,DA S DA=DFN,X=DGPMX
"RTN","DGPMDDCN",98,0)
 F DGIX=0:0 S DGIX=$O(^DD(2,DGFLD,1,DGIX)) Q:'DGIX  X ^(DGIX,2) S X=DGPMX
"RTN","DGPMDDCN",99,0)
 K DGIX,^DPT(DA,DGFLD) Q
"RTN","DGPMDDCN",100,0)
 ;
"RTN","DGPMDDCN",101,0)
CN ; -- set "CN" x-ref for file #2 equal to corresp adm mv
"RTN","DGPMDDCN",102,0)
 N DFN,VAMV0,VAMV,VAMT,VAID,DGX
"RTN","DGPMDDCN",103,0)
 S DGX=X D NOW^%DTC S VAID=9999999.999999-%,DFN=DA D MV^VADPT30
"RTN","DGPMDDCN",104,0)
 I $P(VAMV0,U,2),$P(VAMV0,U,2)'=3 S ^DPT("CN",DGX,DA)=$P(VAMV0,"^",14)
"RTN","DGPMDDCN",105,0)
 Q
"RTN","DGPMDDCN",106,0)
 ;
"RTN","DGPMDDCN",107,0)
RESET ; -- reset ^DPT nodes and x-refs
"RTN","DGPMDDCN",108,0)
 ;    input: DFN
"RTN","DGPMDDCN",109,0)
 ;
"RTN","DGPMDDCN",110,0)
 ; -- kill data and x-refs
"RTN","DGPMDDCN",111,0)
 I $D(^DPT(DFN,.105)),$D(^(.1)),^(.1)]"" K ^DGPM("CN",^(.1),+^(.105))
"RTN","DGPMDDCN",112,0)
 I $D(^DPT(DFN,.108)) S DGPMX=^(.108),DGFLD=.108 D KILL F DGPMX1=0:0 S DGPMX1=+$O(^DGPM("ARM",DGPMX,DGPMX1)) D CHK I $T K ^DGPM("ARM",DGPMX,DGPMX1) Q
"RTN","DGPMDDCN",113,0)
 F DGFLD=.1,.101,.102,.103,.104,.1041,.105,.109 I $D(^DPT(DFN,DGFLD)) S DGPMX=^(DGFLD) D KILL
"RTN","DGPMDDCN",114,0)
 ; -- reset data and x-refs
"RTN","DGPMDDCN",115,0)
 D INPTCK
"RTN","DGPMDDCN",116,0)
 I $S('VAWD:1,1:$P(VAWD,"^",2)="") D  G RESETQ
"RTN","DGPMDDCN",117,0)
 . N DGWD
"RTN","DGPMDDCN",118,0)
 . D FIND^DGPMDDLD
"RTN","DGPMDDCN",119,0)
 . I DGWD,($P(DGWD,"^",2)]"") D RESET^DGPMDDLD
"RTN","DGPMDDCN",120,0)
 D SETALL
"RTN","DGPMDDCN",121,0)
RESETQ D KVAR^VADPT30 K DGPMX,DGPMX1,DGFLD,I Q
"RTN","DGPMDDCN",122,0)
 ;
"RTN","DGPMDDCN",123,0)
SETALL D S6,S7,S8,S9,S19,S41 Q
"RTN","DGPMDDCN",124,0)
 ;
"RTN","DGPMDDCN",125,0)
XREF I $D(^DGPM(DA,0)),$P(^(0),"^",2)=4!($P(^(0),"^",2)=5) G XREF^DGPMDDLD
"RTN","DGPMDDCN",126,0)
 Q:$D(DGPMT)
"RTN","DGPMDDCN",127,0)
 I $D(^DGPM(DA,0)) N DFN S DFN=+$P(^(0),U,3) D RESET
"RTN","DGPMDDCN",128,0)
 Q
"RTN","DGPMDDCN",129,0)
 ;
"RTN","DGPMDDCN",130,0)
INPTCK ; check to see if patient is current inpatient
"RTN","DGPMDDCN",131,0)
 D NOW^%DTC S VAPRT=0,VATD=9999999.999999-%,(VACN,VAPRC)=1
"RTN","DGPMDDCN",132,0)
 S VA200="" D VAR^VADPT30 K VA200
"RTN","DGPMDDCN",133,0)
 Q
"RTN","DGPMV10")
0^5^B27434621
"RTN","DGPMV10",1,0)
DGPMV10 ;ALB/MRL/MIR - PATIENT MOVEMENT, CONT.; 11 APR 89
"RTN","DGPMV10",2,0)
 ;;5.3;Registration;**84,498**;Aug 13, 1993
"RTN","DGPMV10",3,0)
CS ;Current Status
"RTN","DGPMV10",4,0)
 ;first print primary care team/practitioner/attending
"RTN","DGPMV10",5,0)
 D PCMM^SCRPU4(DFN,DT)
"RTN","DGPMV10",6,0)
 S X=$S('DGPMT:1,DGPMT<4:2,DGPMT>5:2,1:3) ;DGPMT=0 if from pt inq (DGRPD)
"RTN","DGPMV10",7,0)
 I '$D(^DGPM("C",DFN)) W !!,"Status      : PATIENT HAS NO INPATIENT OR LODGER ACTIVITY IN THE COMPUTER",*7 D CS2 Q
"RTN","DGPMV10",8,0)
 S A=$S("^3^5^"[("^"_+DGPMVI(2)_"^"):0,1:+DGPMVI(2)) W !!,"Status      : ",$S('A:"IN",1:""),"ACTIVE ",$S("^4^5^"[("^"_+DGPMVI(2)_"^"):"LODGER",1:"INPATIENT")
"RTN","DGPMV10",9,0)
 G CS1:'A W "-" S X=+DGPMVI(4) I X=1 W "on PASS" G CS1
"RTN","DGPMV10",10,0)
 I "^2^3^25^26^"[("^"_X_"^") W "on ",$S("^2^26^"[X:"A",1:"U"),"A" G CS1
"RTN","DGPMV10",11,0)
 I "^13^43^44^45^"[("^"_X_"^") W "ASIH" G CS1
"RTN","DGPMV10",12,0)
 I X=6 W "OTHER FAC" G CS1
"RTN","DGPMV10",13,0)
 W "on WARD"
"RTN","DGPMV10",14,0)
CS1 I +DGPMVI(2)=3,$D(^DGPM(+DGPMVI(17),0)) W ?39,"Discharge Type : ",$S($D(^DG(405.1,+$P(^(0),"^",4),0)):$P(^(0),"^",1),1:"UNKNOWN")
"RTN","DGPMV10",15,0)
 I "^3^4^5^"'[("^"_+DGPMVI(2)_"^"),$D(^DPT(DFN,"DAC")),($P(^("DAC"),"^",1)="S") W "  (Seriously ill)"
"RTN","DGPMV10",16,0)
 W ! I +DGPMVI(19,1) W "Patient chose not to be included in the Facility Directory for this admission"
"RTN","DGPMV10",17,0)
 W !,$S("^4^5^"'[("^"_+DGPMVI(2)_"^"):"Admitted    ",1:"Checked-in  "),": "_$P(DGPMVI(13,1),"^",2)
"RTN","DGPMV10",18,0)
 W ?39,$S("^4^5^"[("^"_+DGPMVI(2)_"^"):"Checked-out",+DGPMVI(2)=3:"Discharged ",1:"Transferred"),"    : ",$S("^1^4^"'[("^"_+DGPMVI(2)_"^"):$P(DGPMVI(3),"^",2),$P(DGPMVI(3),"^",2)'=$P(DGPMVI(13,1),"^",2):$P(DGPMVI(3),"^",2),1:"")
"RTN","DGPMV10",19,0)
 W !,"Ward        : ",$E($P(DGPMVI(5),"^",2),1,24),?39,"Room-Bed       : ",$E($P(DGPMVI(6),"^",2),1,21) I "^4^5^"'[("^"_+DGPMVI(2)_"^") W !,"Provider    : ",$E($P(DGPMVI(7),"^",2),1,26),?39,"Specialty      : ",$E($P(DGPMVI(8),"^",2),1,21)
"RTN","DGPMV10",20,0)
 W !,"Attending   : ",$E($P(DGPMVI(18),"^",2),1,26)
"RTN","DGPMV10",21,0)
 D CS2
"RTN","DGPMV10",22,0)
 S DGPMIFN=DGPMVI(13) I +DGPMVI(2)'=4&(+DGPMVI(2)'=5) D ^DGPMLOS W !!,"Admission LOS: ",+$P(X,"^",5),"  Absence days: ",+$P(X,"^",2),"  Pass Days: ",+$P(X,"^",3),"  ASIH days: ",+$P(X,"^",4)
"RTN","DGPMV10",23,0)
 K A,C,I,J,X
"RTN","DGPMV10",24,0)
 Q
"RTN","DGPMV10",25,0)
 ;
"RTN","DGPMV10",26,0)
CS2 ;-- additional fields for admission screen
"RTN","DGPMV10",27,0)
 Q:DGPMT'=1
"RTN","DGPMV10",28,0)
 S DGHOLD=$S($D(^DPT(DFN,0)):^(0),1:"")
"RTN","DGPMV10",29,0)
 W !!,"Religion    : ",$S($D(^DIC(13,+$P(DGHOLD,U,8),0)):$E($P(^(0),U),1,24),1:"")
"RTN","DGPMV10",30,0)
 W ?39,"Marital Status : ",$S($D(^DIC(11,+$P(DGHOLD,U,5),0)):$P(^(0),U),1:"")
"RTN","DGPMV10",31,0)
 S DGHOLD=$S($D(^DPT(DFN,.36)):$P(^(.36),U),1:"")
"RTN","DGPMV10",32,0)
 W !,"Eligibility : ",$S($D(^DIC(8,+$P(DGHOLD,U),0)):$P(^(0),U),1:"")
"RTN","DGPMV10",33,0)
 S DGHOLD=$S($D(^DPT(DFN,.361)):^(.361),1:"")
"RTN","DGPMV10",34,0)
 W:$P(DGHOLD,U)]"" " (",$P($P($P(^DD(2,.3611,0),U,3),$P(DGHOLD,U)_":",2),";"),")"
"RTN","DGPMV10",35,0)
 W:$P(DGHOLD,U)']"" " (NOT VERIFIED)"
"RTN","DGPMV10",36,0)
 K DGHOLD
"RTN","DGPMV10",37,0)
 Q
"RTN","DGPMV10",38,0)
 ;
"RTN","DGPMV10",39,0)
LODGER ;set-up necessary variables if getting last lodger episode
"RTN","DGPMV10",40,0)
 ;only need 1,2,13,17 - date/time,TT,check-in IFN,check-out IFN
"RTN","DGPMV10",41,0)
 S I=$O(^DGPM("ATID4",DFN,0)),I=$O(^(+I,0))
"RTN","DGPMV10",42,0)
 S X=$S($D(^DGPM(+I,0)):^(0),1:"") I 'X D NULL Q
"RTN","DGPMV10",43,0)
 I $D(^DGPM(+$P(X,"^",17),0)) S (DGPMDCD,DGPMVI(1))=+^(0),DGPMVI(2)=5,DGPMVI(13)=I,DGPMVI(17)=$P(X,"^",17) Q
"RTN","DGPMV10",44,0)
 S (DGPMDCD,DGPMVI(17))="",DGPMVI(1)=+X,DGPMVI(2)=4,DGPMVI(13)=I
"RTN","DGPMV10",45,0)
 Q
"RTN","DGPMV10",46,0)
NULL S DGPMDCD="" F I=1,2,13,17 S DGPMVI(I)=""
"RTN","DGPMV10",47,0)
 Q
"RTN","DGPMV10",48,0)
 ;
"RTN","DGPMV10",49,0)
INP ;set-up inpt vbls needed (mimic VAIP array)
"RTN","DGPMV10",50,0)
 ;
"RTN","DGPMV10",51,0)
 ;Called from scheduling, too
"RTN","DGPMV10",52,0)
 ;
"RTN","DGPMV10",53,0)
 D NOW^%DTC S (VAX("DAT"),NOW)=%,NOWI=9999999.999999-% I '$D(VAIP("E")) D LAST^VADPT3
"RTN","DGPMV10",54,0)
 F I=1:1:8,13,17 S DGPMVI(I)=""
"RTN","DGPMV10",55,0)
 F I=13,19 S DGPMVI(I,1)=""
"RTN","DGPMV10",56,0)
 S DGPMVI(1)=$S($D(VAIP("E")):VAIP("E"),1:E) ;use ifn of last mvt from VADPT call or one passed from DGPMV
"RTN","DGPMV10",57,0)
 S DGX=$G(^DGPM(+DGPMVI(1),0)),DGPMVI(2)=$P(DGX,"^",2),DGPMVI(4)=$P(DGX,"^",18) S Y=+DGX X ^DD("DD") S DGPMVI(3)=$P(DGX,"^",1)_"^"_Y
"RTN","DGPMV10",58,0)
 S DGPMVI(5)=$P(DGX,"^",6)_"^"_$S($D(^DIC(42,+$P(DGX,"^",6),0)):$P(^(0),"^",1),1:""),DGPMVI(6)=$P(DGX,"^",7)_"^"_$S($D(^DG(405.4,+$P(DGX,"^",7),0)):$P(^(0),"^",1),1:""),DGPMVI(13)=$P(DGX,"^",14)
"RTN","DGPMV10",59,0)
 I "^3^5^"[("^"_DGPMVI(2)_"^") D GETWD ;get from ward if d/c or check-out
"RTN","DGPMV10",60,0)
 S DGX=$G(^DGPM(+DGPMVI(13),0)) I DGX]"" S Y=+DGX X ^DD("DD") S DGPMVI(13,1)=$P(DGX,"^",1)_"^"_Y,DGPMVI(17)=$P(DGX,"^",17) I $D(DGPMSVC) S DGPMSV=$P($G(^DIC(42,+$P(DGX,"^",6),0)),"^",3)
"RTN","DGPMV10",61,0)
 S DGPMDCD=$S($D(^DGPM(+DGPMVI(17),0)):$P(^(0),"^",1),1:"")
"RTN","DGPMV10",62,0)
 S (DGTS,DGPP,DGAP)="" ;t.s., primary care physician, attending
"RTN","DGPMV10",63,0)
 F I=NOWI:0 S I=$O(^DGPM("ATS",DFN,+DGPMVI(13),I)) Q:'I  F J=0:0 S J=$O(^DGPM("ATS",DFN,+DGPMVI(13),I,J)) Q:'J  F IFN=0:0 S IFN=$O(^DGPM("ATS",DFN,+DGPMVI(13),I,J,IFN)) Q:'IFN  D TS1 G TSQ:DGTS&DGPP&DGAP
"RTN","DGPMV10",64,0)
TSQ S DGPMVI(7)=DGPP,DGPMVI(8)=DGTS,DGPMVI(18)=DGAP
"RTN","DGPMV10",65,0)
 S DGX=$G(^DGPM(+DGPMVI(13),"DIR"))
"RTN","DGPMV10",66,0)
 S DGX=$P(DGX,"^",1) S:DGX="" DGX=1
"RTN","DGPMV10",67,0)
 S DGPMVI(19,1)=DGX_"^"_$$EXTERNAL^DILFD(405,41,,DGX)
"RTN","DGPMV10",68,0)
 D Q^VADPT3 K DGAP,DGPP,DGTS,DGX,IFN
"RTN","DGPMV10",69,0)
 Q
"RTN","DGPMV10",70,0)
 ;
"RTN","DGPMV10",71,0)
TS1 ; set DGTS, DGPP, and DGAP
"RTN","DGPMV10",72,0)
 Q:'$D(^DGPM(IFN,0))  S DGX=^(0)
"RTN","DGPMV10",73,0)
 I 'DGPP,$D(^VA(200,+$P(DGX,"^",8),0)) S Y=$P(DGX,"^",8)_"^"_$P(^(0),"^") S DGPP=Y
"RTN","DGPMV10",74,0)
 I 'DGAP,$D(^VA(200,+$P(DGX,"^",19),0)) S Y=$P(DGX,"^",19)_"^"_$P(^(0),"^") S DGAP=Y
"RTN","DGPMV10",75,0)
 I 'DGTS,$D(^DIC(45.7,+$P(DGX,"^",9),0)) S DGTS=$P(DGX,"^",9)_"^"_$P(^(0),"^")
"RTN","DGPMV10",76,0)
 Q
"RTN","DGPMV10",77,0)
GETWD ;get the from ward if last mvt is discharge or check-out
"RTN","DGPMV10",78,0)
 I DGPMVI(2)=5 S J=DGPMVI(13) D SETWD Q
"RTN","DGPMV10",79,0)
 F I=0:0 S I=$O(^DGPM("APMV",DFN,DGPMVI(13),I)) Q:'I!+DGPMVI(5)  F J=0:0 S J=$O(^DGPM("APMV",DFN,DGPMVI(13),I,J)) Q:'J  D SETWD Q:+DGPMVI(5)
"RTN","DGPMV10",80,0)
 Q
"RTN","DGPMV10",81,0)
 ;
"RTN","DGPMV10",82,0)
SETWD ;set ward and room-bed variables for discharge/check-out mvts
"RTN","DGPMV10",83,0)
 S X=$G(^DGPM(J,0))
"RTN","DGPMV10",84,0)
 I $D(^DIC(42,+$P(X,"^",6),0)) S DGPMVI(5)=$P(X,"^",6)_"^"_$P(^(0),"^",1)
"RTN","DGPMV10",85,0)
 I $D(^DG(405.4,+$P(X,"^",7),0)) S DGPMVI(6)=$P(X,"^",7)_"^"_$P(^(0),"^",1)
"RTN","DGPMV10",86,0)
 Q
"RTN","DGRPD")
0^11^B50758361
"RTN","DGRPD",1,0)
DGRPD ;ALB/MRL/MLR/JAN-PATIENT INQUIRY (NEW) ; 03/22/02
"RTN","DGRPD",2,0)
 ;;5.3;Registration;**109,124,121,57,161,149,286,358,436,445,489,498**;Aug 13, 1993
"RTN","DGRPD",3,0)
 ;  *286*  Newing variables X,Y in OKLINE subroutine
"RTN","DGRPD",4,0)
 ;  *358*  If a patient is on a domiciliary ward, don't display MEANS
"RTN","DGRPD",5,0)
 ;         TEST required/Medication Copayment Exemption messages
"RTN","DGRPD",6,0)
 ;  *436*  If an inpatient is not on a domiciliary ward, don't display
"RTN","DGRPD",7,0)
 ;         Medication Copayment Exemption message
"RTN","DGRPD",8,0)
 ;
"RTN","DGRPD",9,0)
SEL K DFN,DGRPOUT W ! S DIC="^DPT(",DIC(0)="AEQMZ" D ^DIC G Q:Y'>0 S DFN=+Y D EN G SEL
"RTN","DGRPD",10,0)
 ;
"RTN","DGRPD",11,0)
EN ;call to display patient inquiry - input DFN
"RTN","DGRPD",12,0)
 ;MPI/PD CHANGE
"RTN","DGRPD",13,0)
 S DGCMOR="UNSPECIFIED",DGMPI=$G(^DPT(+DFN,"MPI"))
"RTN","DGRPD",14,0)
 S DGLOCATN=$$FIND1^DIC(4,"","MX","`"_+$P(DGMPI,U,3)),DGLOCATN=$S(+DGLOCATN>0:$P($$NS^XUAF4(DGLOCATN),U),1:"NOT LISTED")
"RTN","DGRPD",15,0)
 I $D(DGMPI),$D(DGLOCATN) S DGCMOR=$P(DGLOCATN,"^")
"RTN","DGRPD",16,0)
 ;END MPI/PD CHANGE
"RTN","DGRPD",17,0)
 K DGRPOUT,DGHOW S DGABBRV=$S($D(^DG(43,1,0)):+$P(^(0),"^",38),1:0),DGRPU="UNSPECIFIED" D DEM^VADPT,HDR F I=0,.11,.13,.121,.31,.32,.36,.361,.141 S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"")
"RTN","DGRPD",18,0)
 S DGAD=.11,(DGA1,DGA2)=1 D A^DGRPU S DGTMPAD=0 I $P(DGRP(.121),"^",9)="Y" S DGTMPAD=$S('$P(DGRP(.121),"^",8):1,$P(DGRP(.121),"^",8)'<DT:1,1:0) I DGTMPAD S DGAD=.121,DGA1=1,DGA2=2 D A^DGRPU
"RTN","DGRPD",19,0)
 W "Address: ",$S($D(DGA(1)):DGA(1),1:"NONE ON FILE"),?40,"Temporary: ",$S($D(DGA(2)):DGA(2),1:"NO TEMPORARY ADDRESS")
"RTN","DGRPD",20,0)
 S I=2 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>50) !?9 W:'(I#2) ?51 W DGA(I)
"RTN","DGRPD",21,0)
 S DGCC=+$P(DGRP(.11),U,7),DGST=+$P(DGRP(.11),U,5),DGCC=$S($D(^DIC(5,DGST,1,DGCC,0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU) W !?1,"County: ",DGCC
"RTN","DGRPD",22,0)
 S X="NOT APPLICABLE" I DGTMPAD S Y=$P(DGRP(.121),U,7) X:Y]"" ^DD("DD") S X=$S(Y]"":Y,1:DGRPU)_"-",Y=$P(DGRP(.121),U,8) X:Y]"" ^DD("DD") S X=X_$S(Y]"":Y,1:DGRPU)
"RTN","DGRPD",23,0)
 W ?42,"From/To: ",X,!?2,"Phone: ",$S($P(DGRP(.13),U,1)]"":$P(DGRP(.13),U,1),1:DGRPU),?44,"Phone: ",$S('DGTMPAD:X,$P(DGRP(.121),U,10)]"":$P(DGRP(.121),U,10),1:DGRPU) K DGTMPAD
"RTN","DGRPD",24,0)
 W !?1,"Office: ",$S($P(DGRP(.13),U,2)]"":$P(DGRP(.13),U,2),1:DGRPU)
"RTN","DGRPD",25,0)
 D CA
"RTN","DGRPD",26,0)
 I 'DGABBRV W !!?4,"POS: ",$S($D(^DIC(21,+$P(DGRP(.32),"^",3),0)):$P(^(0),"^",1),1:DGRPU),?42,"Claim #: ",$S($P(DGRP(.31),"^",3)]"":$P(DGRP(.31),"^",3),1:"UNSPECIFIED")
"RTN","DGRPD",27,0)
 I 'DGABBRV W !?2,"Relig: ",$S($D(^DIC(13,+$P(DGRP(0),"^",8),0)):$P(^(0),"^",1),1:DGRPU),?46,"Sex: ",$S($P(VADM(5),"^",2)]"":$P(VADM(5),"^",2),1:"UNSPECIFIED")
"RTN","DGRPD",28,0)
 I 'DGABBRV W ! D
"RTN","DGRPD",29,0)
 .N RACE,ETHNIC,PTR,VAL,X,DIWL,DIWR,DIWF
"RTN","DGRPD",30,0)
 .K ^UTILITY($J,"W")
"RTN","DGRPD",31,0)
 .S PTR=0 F  S PTR=+$O(^DPT(DFN,.02,PTR)) Q:'PTR  D
"RTN","DGRPD",32,0)
 ..S VAL=+$G(^DPT(DFN,.02,PTR,0))
"RTN","DGRPD",33,0)
 ..Q:$$INACTIVE^DGUTL4(VAL,1)
"RTN","DGRPD",34,0)
 ..S VAL=$$PTR2TEXT^DGUTL4(VAL,1) S:+$O(^DPT(DFN,.02,PTR)) VAL=VAL_", "
"RTN","DGRPD",35,0)
 ..S X=VAL,DIWL=0,DIWR=30,DIWF="" D ^DIWP
"RTN","DGRPD",36,0)
 .M RACE=^UTILITY($J,"W",0) S:$G(RACE(1,0))="" RACE(1,0)="UNANSWERED"
"RTN","DGRPD",37,0)
 .K ^UTILITY($J,"W")
"RTN","DGRPD",38,0)
 .S PTR=0 F  S PTR=+$O(^DPT(DFN,.06,PTR)) Q:'PTR  D
"RTN","DGRPD",39,0)
 ..S VAL=+$G(^DPT(DFN,.06,PTR,0))
"RTN","DGRPD",40,0)
 ..Q:$$INACTIVE^DGUTL4(VAL,2)
"RTN","DGRPD",41,0)
 ..S VAL=$$PTR2TEXT^DGUTL4(VAL,2) S:+$O(^DPT(DFN,.06,PTR)) VAL=VAL_", "
"RTN","DGRPD",42,0)
 ..S X=VAL,DIWL=0,DIWR=30,DIWF="" D ^DIWP
"RTN","DGRPD",43,0)
 .M ETHNIC=^UTILITY($J,"W",0) S:$G(ETHNIC(1,0))="" ETHNIC(1,0)="UNANSWERED"
"RTN","DGRPD",44,0)
 .K ^UTILITY($J,"W")
"RTN","DGRPD",45,0)
 .W ?3,"Race: ",RACE(1,0),?40,"Ethnicity: ",ETHNIC(1,0)
"RTN","DGRPD",46,0)
 .F X=2:1 Q:'$D(RACE(X,0))&'$D(ETHNIC(X,0))  W !,?9,$G(RACE(X,0)),?51,$G(ETHNIC(X,0))
"RTN","DGRPD",47,0)
 I '$$OKLINE(16) G Q
"RTN","DGRPD",48,0)
 S X1=DGRP(.36),X=$P(DGRP(.361),"^",1) W !!,"Primary Eligibility: ",$S($D(^DIC(8,+X1,0)):$P(^(0),"^",1)_" ("_$S(X="V":"VERIFIED",X="P":"PENDING VERIFICATION",X="R":"PENDING REVERIFICATION",1:"NOT VERIFIED")_")",1:DGRPU)
"RTN","DGRPD",49,0)
 W !,"Other Eligibilities: " F I=0:0 S I=$O(^DIC(8,I)) Q:'I  I $D(^DIC(8,I,0)),I'=+X1 S X=$P(^(0),"^",1)_", " I $D(^DPT("AEL",DFN,I)) W:$X+$L(X)>79 !?21 W X
"RTN","DGRPD",50,0)
 ;
"RTN","DGRPD",51,0)
 ;display the catastrophic disability review date if there is one
"RTN","DGRPD",52,0)
 D CATDIS
"RTN","DGRPD",53,0)
 ;
"RTN","DGRPD",54,0)
 I $G(DGPRFLG)=1 G Q:'$$OKLINE(19) D
"RTN","DGRPD",55,0)
 . N DGPDT,DGPTM
"RTN","DGRPD",56,0)
 . W !,$$REPEAT^XLFSTR("-",78)
"RTN","DGRPD",57,0)
 . S DGPDT="",DGPDT=$O(^DGS(41.41,"ADC",DFN,DGPDT),-1)
"RTN","DGRPD",58,0)
 . W !,"[PRE-REGISTER DATE:]  "_$S(DGPDT]"":$$FMTE^XLFDT(DGPDT,"1D"),1:"NONE ON FILE")
"RTN","DGRPD",59,0)
 . S DGPTM=$$OUTPTTM^SDUTL3(DFN)
"RTN","DGRPD",60,0)
 . I $P(DGPTM,U,2)]"" W !,"[PRIMARY CARE TEAM:] "_$P(DGPTM,U,2)
"RTN","DGRPD",61,0)
 . W !,$$REPEAT^XLFSTR("-",78)
"RTN","DGRPD",62,0)
 ; Check if patient is an inpatient and on a DOM ward
"RTN","DGRPD",63,0)
 ; If inpatient is on a DOM ward, don't display MT or CP messages
"RTN","DGRPD",64,0)
 ; If inpatient is NOT on a DOM ward, don't display CP message
"RTN","DGRPD",65,0)
 N DGDOM,DGDOM1,VAHOW,VAROOT,VAINDT,VAIP,VAERR
"RTN","DGRPD",66,0)
 G Q:'$$OKLINE(14)
"RTN","DGRPD",67,0)
 D DOM^DGMTR
"RTN","DGRPD",68,0)
 I '$G(DGDOM) D
"RTN","DGRPD",69,0)
 .D DIS^DGMTU(DFN)
"RTN","DGRPD",70,0)
 .D IN5^VADPT
"RTN","DGRPD",71,0)
 .I $G(VAIP(1))="" D DISP^IBARXEU(DFN,DT,3,1)
"RTN","DGRPD",72,0)
 ;I 'DGABBRV,$E(IOST,1,2)="C-" F I=$Y:1:20 W !
"RTN","DGRPD",73,0)
 S VAIP("L")=""
"RTN","DGRPD",74,0)
 I $$OKLINE(14) D INP
"RTN","DGRPD",75,0)
 I '$G(DGRPOUT),($$OKLINE(17)) D SA
"RTN","DGRPD",76,0)
 ;MPI/PD CHANGE
"RTN","DGRPD",77,0)
Q D KVA^VADPT K %DT,D0,D1,DGA,DGA1,DGA2,DGABBRV,DGAD,DGCC,DGCMOR,DGDOM,DGLOCATN,DGMPI,DGRP,DGRPU,DGS,DGST,DGXFR0,DIC,DIR,DTOUT,DUOUT,DIRUT,DIROUT,I,I1,L,LDM,POP,SDCT,VA,X,X1,Y Q
"RTN","DGRPD",78,0)
CA ;Confidential Address
"RTN","DGRPD",79,0)
 W !!?1,"Confidential Address:  ",?44,"Confidential Address Categories:"
"RTN","DGRPD",80,0)
 N DGCABEG,DGCAEND,DGA,DGARRAY,DGERROR
"RTN","DGRPD",81,0)
 S DGCABEG=$P(DGRP(.141),U,7),DGCAEND=$P(DGRP(.141),U,8)
"RTN","DGRPD",82,0)
 I 'DGCABEG!(DGCABEG>DT)!(DGCAEND&(DGCAEND<DT)) D  Q
"RTN","DGRPD",83,0)
 .W !?9,"NO CONFIDENTIAL ADDRESS"
"RTN","DGRPD",84,0)
 .W !?1,"From/To: NOT APPLICABLE"
"RTN","DGRPD",85,0)
 S DGAD=.141,(DGA1,DGA2)=1
"RTN","DGRPD",86,0)
 D AL^DGRPU(30)
"RTN","DGRPD",87,0)
 D GETS^DIQ(2,DFN,".141*,","E","DGARRAY","DGERROR")
"RTN","DGRPD",88,0)
 ;Format Confidential Address categories
"RTN","DGRPD",89,0)
 N DGIEN,DGCAST
"RTN","DGRPD",90,0)
 S DGIEN=0
"RTN","DGRPD",91,0)
 S DGA2=2
"RTN","DGRPD",92,0)
 F  S DGIEN=$O(DGARRAY(2.141,DGIEN)) Q:'DGIEN  D
"RTN","DGRPD",93,0)
 .S DGA(DGA2)=DGARRAY(2.141,DGIEN,.01,"E")
"RTN","DGRPD",94,0)
 .S DGCAST=DGARRAY(2.141,DGIEN,1,"E")
"RTN","DGRPD",95,0)
 .S DGA(DGA2)=DGA(DGA2)_"("_$S(DGCAST="YES":"Active",1:"Inactive")_")"
"RTN","DGRPD",96,0)
 .S DGA2=DGA2+2
"RTN","DGRPD",97,0)
 S I=0 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>43) !?9 W:'(I#2) ?44 W DGA(I)
"RTN","DGRPD",98,0)
 W !?1,"From/To:  ",$$FMTE^XLFDT(DGCABEG)_"-"_$S(DGCAEND'="":$$FMTE^XLFDT(DGCAEND),1:"UNANSWERED")
"RTN","DGRPD",99,0)
 Q
"RTN","DGRPD",100,0)
HDR I '$D(IOF) S IOP="HOME" D ^%ZIS K IOP
"RTN","DGRPD",101,0)
 ;MPI/PD CHANGE
"RTN","DGRPD",102,0)
 W @IOF,!,$P(VADM(1),"^",1),?40,$P(VADM(2),"^",2),?65,$P(VADM(3),"^",2) S X="",$P(X,"=",78)="" W !,X,!?15,"COORDINATING MASTER OF RECORD: ",DGCMOR,! Q
"RTN","DGRPD",103,0)
 ;END MPI/PD CHANGE
"RTN","DGRPD",104,0)
INP S VAIP("D")="L" D INP^DGPMV10
"RTN","DGRPD",105,0)
 S DGPMT=0
"RTN","DGRPD",106,0)
 D CS^DGPMV10 K DGPMT,DGPMIFN K:'$D(DGSWITCH) DGPMVI,DGPMDCD Q
"RTN","DGRPD",107,0)
SA F I=0:0 S I=$O(^DGS(41.1,"B",DFN,I)) G CL:'I S X=^DGS(41.1,I,0) I $P(X,"^",2)>(DT-1),$P(X,"^",13)']"",'$P(X,"^",17) S L=$P(X,"^",2) D:$$OKLINE(17) SAA Q:$G(DGRPOUT)
"RTN","DGRPD",108,0)
 Q
"RTN","DGRPD",109,0)
SAA ;Scheduled Admit Data
"RTN","DGRPD",110,0)
 W !!?14,"Scheduled Admit"
"RTN","DGRPD",111,0)
 W:$D(^DIC(42,+$P(X,U,8),0)) " on ward "_$P(^(0),U)
"RTN","DGRPD",112,0)
 W:$D(^DIC(45.7,+$P(X,U,9),0)) " for treating specialty "_$P(^(0),U)
"RTN","DGRPD",113,0)
 W " on "_$$FMTE^XLFDT(L,"5DZ")
"RTN","DGRPD",114,0)
 Q  ;SAA
"RTN","DGRPD",115,0)
 ;
"RTN","DGRPD",116,0)
CL G FA:$O(^DPT(DFN,"DE",0))="" S SDCT=0 F I=0:0 S I=$O(^DPT(DFN,"DE",I)) Q:'I  I $D(^(I,0)),$P(^(0),"^",2)'="I",$O(^(0)) S SDCT=SDCT+1 W:SDCT=1 !!,"Currently enrolled in " W:$X>50 !?22 W $S($D(^SC(+^(0),0)):$P(^(0),"^",1)_", ",1:"")
"RTN","DGRPD",117,0)
 ;
"RTN","DGRPD",118,0)
FA G:'$$OKLINE(20) RMK
"RTN","DGRPD",119,0)
 S CT=0 W !!,"Future Appointments: " I $O(^DPT(DFN,"S",DT))'>0 W "NONE" G RMK
"RTN","DGRPD",120,0)
 W ?22,"Date",?33,"Time",?39,"Clinic",!?22 F I=22:1:75 W "="
"RTN","DGRPD",121,0)
 F FA=DT:0 S FA=$O(^DPT(DFN,"S",FA)) G RMK:'FA S L=^(FA,0),C=+L I $P(L,"^",2)'["C" D COV D  Q:CT>5
"RTN","DGRPD",122,0)
 .N DGAPPT
"RTN","DGRPD",123,0)
 .S DGAPPT=$$FMTE^XLFDT($E(FA,1,12),"5Z")
"RTN","DGRPD",124,0)
 .W !?22,$P(DGAPPT,"@")
"RTN","DGRPD",125,0)
 .W ?33,$P(DGAPPT,"@",2)
"RTN","DGRPD",126,0)
 .W ?39,$P($S($D(^SC(C,0)):^(0),1:""),"^")," ",COV
"RTN","DGRPD",127,0)
 .Q
"RTN","DGRPD",128,0)
 I $O(^DPT(DFN,"S",FA))>0 W !,"See Scheduling options for additional appointments."
"RTN","DGRPD",129,0)
RMK I '$G(DGRPOUT),($$OKLINE(21)) W !!,"Remarks: ",$P(^DPT(DFN,0),"^",10)
"RTN","DGRPD",130,0)
 K ADM,L,TRN,DIS,SSN,FA,C,COV,NOW,CT,DGD,DGD1,I ;Y killed after dghinqky 
"RTN","DGRPD",131,0)
 Q
"RTN","DGRPD",132,0)
COV S COV=$S($P(L,"^",7)=7:" (Collateral) ",1:""),COV=COV_$S($P(L,"^",2)["NT":" * NO ACTION TAKEN *",$P(L,"^",2)["N":" * NO-SHOW *",1:""),CT=CT+1 Q
"RTN","DGRPD",133,0)
 Q
"RTN","DGRPD",134,0)
 ;
"RTN","DGRPD",135,0)
OREN S XQORQUIT=1 Q:'$D(ORVP)  S DFN=+ORVP D EN R !!,"Press RETURN to CONTINUE: ",X:DTIME
"RTN","DGRPD",136,0)
 Q
"RTN","DGRPD",137,0)
OKLINE(DGLINE) ;DOES PAUSE/HEADER IF $Y EXCEEDS DGLINE
"RTN","DGRPD",138,0)
 ;
"RTN","DGRPD",139,0)
 ;IN:   DGLINE --MAX LINE COUNT W/O PAUSE
"RTN","DGRPD",140,0)
 ;OUT:  DGLINE[RETURNED] -- 0 IF TIMEOUT/UP ARROW
"RTN","DGRPD",141,0)
 ;      DGRPOUT[SET]     -- 1 IF "
"RTN","DGRPD",142,0)
 N X,Y  ;**286** MLR 09/25/00  Newing X & Y variables prior to ^DIR
"RTN","DGRPD",143,0)
 I $G(IOST)["P-" Q DGLINE ; if printer, quit
"RTN","DGRPD",144,0)
 I $Y>DGLINE N DIR S DIR(0)="E" D ^DIR D:Y HDR I 'Y S DGRPOUT=1,DGLINE=0
"RTN","DGRPD",145,0)
 Q DGLINE
"RTN","DGRPD",146,0)
 ;
"RTN","DGRPD",147,0)
CATDIS ;
"RTN","DGRPD",148,0)
 ;displays catastrophic disabity review date if there is one
"RTN","DGRPD",149,0)
 N DGCDIS
"RTN","DGRPD",150,0)
 I $$GET^DGENCDA(DFN,.DGCDIS) D
"RTN","DGRPD",151,0)
 .Q:'DGCDIS("REVDTE")
"RTN","DGRPD",152,0)
 .W !!,"Catastrophically Disabled Review Date: ",$$FMTE^XLFDT(DGCDIS("REVDTE"),1)
"RTN","DGRPD",153,0)
 Q
"RTN","DGRPD",154,0)
 ;
"RTN","VADPT")
0^6^B16792533
"RTN","VADPT",1,0)
VADPT ;ALB/MRL/MJK - RETURN PATIENT VARIABLE ARRAYS [DRIVER];07 DEC 1988
"RTN","VADPT",2,0)
 ;;5.3;Registration;**193,343,389,415,489,498**;Aug 13, 1993
"RTN","VADPT",3,0)
 ;DFN = Patient IFN [if not passed entire array returned as null]
"RTN","VADPT",4,0)
 ;
"RTN","VADPT",5,0)
DEM ;Demographic Variables
"RTN","VADPT",6,0)
 S VAN=1,VAN(1)=12,VAV="VADM" D ^VADPT0 Q
"RTN","VADPT",7,0)
 ;
"RTN","VADPT",8,0)
OPD ;Other Patient Data
"RTN","VADPT",9,0)
 S VAN=2,VAN(1)=7,VAV="VAPD" D ^VADPT0 Q
"RTN","VADPT",10,0)
 ;
"RTN","VADPT",11,0)
ADD ;Current Address
"RTN","VADPT",12,0)
 S VAN=3,VAN(1)=22,VAV="VAPA" D ^VADPT0 Q
"RTN","VADPT",13,0)
 ;
"RTN","VADPT",14,0)
OAD ;Other Patient Variables
"RTN","VADPT",15,0)
 S VAN=4,VAN(1)=11,VAV="VAOA" D ^VADPT0 Q
"RTN","VADPT",16,0)
 ;
"RTN","VADPT",17,0)
INP ;Inpatient Data [pre-version 5]
"RTN","VADPT",18,0)
 N VAINDTT S VAN=5,VAN(1)=11,VAV="VAIN",VAINDTT=$G(VAINDT) N VAINDT S:VAINDTT VAINDT=$$DATIM(VAINDTT) D ^VADPT0 Q
"RTN","VADPT",19,0)
 ;
"RTN","VADPT",20,0)
IN5 ;Inpatient Data [v5.0 and above]
"RTN","VADPT",21,0)
 N VAINDTT S VAN=6,VAN(1)=19,VAV=$S('$D(VAIP("V")):"VAIP",VAIP("V")'?1A.E:"VAIP",1:VAIP("V")),VAINDTT=$G(VAIP("D")) S:$L(VAINDTT) VAIP("D")=VAINDTT S:VAINDTT VAIP("D")=$$DATIM(VAINDTT) D ^VADPT0 S:$L(VAINDTT) VAIP("D")=VAINDTT Q
"RTN","VADPT",22,0)
 ;
"RTN","VADPT",23,0)
ELIG ;Eligibility Information
"RTN","VADPT",24,0)
 S VAN=7,VAN(1)=9,VAV="VAEL" D ^VADPT0 Q
"RTN","VADPT",25,0)
 ;
"RTN","VADPT",26,0)
MB ;Monetary Benefits
"RTN","VADPT",27,0)
 S VAN=8,VAN(1)=9,VAV="VAMB" D ^VADPT0 Q
"RTN","VADPT",28,0)
 ;
"RTN","VADPT",29,0)
SVC ;Service Information
"RTN","VADPT",30,0)
 S VAN=9,VAN(1)=9,VAV="VASV" D ^VADPT0 Q
"RTN","VADPT",31,0)
 ;
"RTN","VADPT",32,0)
REG ;Registration data
"RTN","VADPT",33,0)
 S VAN=10,VAV="VARP" D ^VADPT0 Q
"RTN","VADPT",34,0)
 ;
"RTN","VADPT",35,0)
SDE ;Enrollment Information
"RTN","VADPT",36,0)
 S VAN=11,VAV="VAEN" D ^VADPT0 Q
"RTN","VADPT",37,0)
 ;
"RTN","VADPT",38,0)
SDA ;Appointment Information
"RTN","VADPT",39,0)
 S VAN=12,VAV="VASD" D ^VADPT0 Q
"RTN","VADPT",40,0)
 ;
"RTN","VADPT",41,0)
PID ;Patient Id
"RTN","VADPT",42,0)
 S VAN=13,VAV="VA" D ^VADPT0 Q
"RTN","VADPT",43,0)
 ;
"RTN","VADPT",44,0)
TESTPAT(DFN)    ;Test patient ?  Returns 0 (No) or 1 (Yes)
"RTN","VADPT",45,0)
 S DFN=+$G(DFN) I 'DFN Q 0
"RTN","VADPT",46,0)
 I $D(^DPT("ATEST",DFN)) Q 1
"RTN","VADPT",47,0)
 N NODE S NODE=$G(^DPT(DFN,0))
"RTN","VADPT",48,0)
 I $P(NODE,"^",21)=1 Q 1
"RTN","VADPT",49,0)
 I $E($P(NODE,"^",9),1,5)="00000" Q 1
"RTN","VADPT",50,0)
 Q 0
"RTN","VADPT",51,0)
 ;
"RTN","VADPT",52,0)
V5 S X=$S($D(^DG(43,1,"VERSION")):+^("VERSION"),1:""),VADPT("V")=$S(X<5:0,1:1) K X Q
"RTN","VADPT",53,0)
OERR ;
"RTN","VADPT",54,0)
1 S VATAG=1 D MULT Q
"RTN","VADPT",55,0)
2 S VATAG=2 D MULT Q
"RTN","VADPT",56,0)
3 S VATAG=3 D MULT Q
"RTN","VADPT",57,0)
4 S VATAG=4 D MULT Q
"RTN","VADPT",58,0)
5 S VATAG=5 D MULT Q
"RTN","VADPT",59,0)
6 S VATAG=6 D MULT Q
"RTN","VADPT",60,0)
7 S VATAG=7 D MULT Q
"RTN","VADPT",61,0)
8 S VATAG=8 D MULT Q
"RTN","VADPT",62,0)
9 S VATAG=9 D MULT Q
"RTN","VADPT",63,0)
10 S VATAG=10 D MULT Q
"RTN","VADPT",64,0)
51 S VATAG=11 D MULT Q
"RTN","VADPT",65,0)
52 S VATAG=12 D MULT Q
"RTN","VADPT",66,0)
53 S VATAG=13 D MULT Q
"RTN","VADPT",67,0)
ALL S VATAG=14 D MULT Q
"RTN","VADPT",68,0)
A5 S VATAG=15 D MULT Q
"RTN","VADPT",69,0)
SEL Q:$O(VARRAY(0))']""  S VATAG=0,VATAG(2)=$P($T(TAG),";;",2)
"RTN","VADPT",70,0)
 F VATAG(1)=0:0 S VATAG=$O(VARRAY(VATAG)) Q:VATAG=""  I VATAG(2)[("^"_VATAG_"^") S VARRAY(VATAG)=1,VAROOT=$S($D(VAROOT(VATAG)):VAROOT(VATAG),1:"") D @VATAG
"RTN","VADPT",71,0)
 G Q
"RTN","VADPT",72,0)
 ;
"RTN","VADPT",73,0)
MULT S VATAG=$P($T(TG+VATAG),";;",2)
"RTN","VADPT",74,0)
 F VATAG(1)=1:1 S VATAG(2)=$P(VATAG,"^",VATAG(1)) Q:VATAG(2)=""  S VAROOT=$S($D(VAROOT(VATAG(2))):VAROOT(VATAG(2)),1:"") D @(VATAG(2))
"RTN","VADPT",75,0)
Q S VAROOT="" K:$D(VAROOT)'=11 VAROOT K VATAG Q
"RTN","VADPT",76,0)
 ;
"RTN","VADPT",77,0)
KVA K VA
"RTN","VADPT",78,0)
KVAR D KVAR^VADPT0 K:$D(VAIP("V")) @(VAIP("V")) K I,X,Y,VARRAY,VADM,VAPD,VADPT,VAOA,VASV,VAEL,VAMB,VARP,VAEN,VASD,VAIN,VAIP,VAPA,VAHOW,VAINDT,VAERR,^UTILITY("VADPT",$J),VA200,VATEST Q
"RTN","VADPT",79,0)
DATIM(DATIM) ;If time not specified see if movement on that date
"RTN","VADPT",80,0)
 Q:DATIM'?7N DATIM
"RTN","VADPT",81,0)
 N A,B S A=$O(^DGPM("ADFN"_DFN,DATIM)),B=+$O(^(+A,0))
"RTN","VADPT",82,0)
 I 'A Q DATIM
"RTN","VADPT",83,0)
 I $P($G(^DGPM(+B,0)),"^",2)=3 Q DATIM  ;Next movement is discharge
"RTN","VADPT",84,0)
 F  Q:"^4^5^7^"'[(U_$P($G(^DGPM(+B,0)),"^",2))  S A=$O(^DGPM("ADFN"_DFN,A)),B=+$O(^(+A,0)) I $E(A,1,7)'=DATIM Q
"RTN","VADPT",85,0)
 I 'A Q DATIM
"RTN","VADPT",86,0)
 I $E(A,1,7)'=DATIM Q DATIM
"RTN","VADPT",87,0)
 Q A
"RTN","VADPT",88,0)
 ;
"RTN","VADPT",89,0)
TG ;
"RTN","VADPT",90,0)
 ;;DEM^INP
"RTN","VADPT",91,0)
 ;;DEM^ELIG
"RTN","VADPT",92,0)
 ;;ELIG^INP
"RTN","VADPT",93,0)
 ;;DEM^ADD
"RTN","VADPT",94,0)
 ;;ADD^INP
"RTN","VADPT",95,0)
 ;;DEM^ELIG^ADD
"RTN","VADPT",96,0)
 ;;ELIG^SVC
"RTN","VADPT",97,0)
 ;;ELIG^SVC^MB
"RTN","VADPT",98,0)
 ;;DEM^REG^SDE^SDA
"RTN","VADPT",99,0)
 ;;SDE^SDA
"RTN","VADPT",100,0)
 ;;DEM^IN5
"RTN","VADPT",101,0)
 ;;ELIG^IN5
"RTN","VADPT",102,0)
 ;;ADD^IN5
"RTN","VADPT",103,0)
 ;;DEM^OPD^INP^ADD^ELIG^SVC^OAD^MB^REG^SDE^SDA
"RTN","VADPT",104,0)
 ;;DEM^OPD^IN5^ADD^ELIG^SVC^OAD^MB^REG^SDE^SDA
"RTN","VADPT",105,0)
 ;
"RTN","VADPT",106,0)
TAG ;;^DEM^OPD^INP^IN5^ADD^OAD^ELIG^SVC^MB^REG^SDE^SDA^
"RTN","VADPT0")
0^7^B12262577
"RTN","VADPT0",1,0)
VADPT0 ;ALB/MRL/MJK - PATIENT VARIABLE ROUTINE DRIVER, CONT.; 12 DEC 1988
"RTN","VADPT0",2,0)
 ;;5.3;Registration;**343,342,415,489,498**;Aug 13, 1993
"RTN","VADPT0",3,0)
 ;
"RTN","VADPT0",4,0)
 ;Initialize variables
"RTN","VADPT0",5,0)
 N I1
"RTN","VADPT0",6,0)
 S U="^" D DT^DICRW:'$D(DT)
"RTN","VADPT0",7,0)
 S VAERR=$S('$D(DFN)#2:1,'$D(^DPT(DFN,0)):1,1:0)
"RTN","VADPT0",8,0)
 S Y=VAN'=13 I Y,$D(VAROOT)'[0,VAROOT]"" S Y=0,VAV=VAROOT K @VAV
"RTN","VADPT0",9,0)
 I Y S:$S(VAN>9:1,'$D(VAHOW):0,1:VAHOW[2) VAV="^UTILITY("_""""_VAV_""""_","_$J_")"
"RTN","VADPT0",10,0)
 D @VAN
"RTN","VADPT0",11,0)
Q K X,Y,VAC,VAS,VAV,VAW,VAN,I,VAX,VAZ Q
"RTN","VADPT0",12,0)
 ;
"RTN","VADPT0",13,0)
INIT ; -- determine #'s or names then init array
"RTN","VADPT0",14,0)
 ;
"RTN","VADPT0",15,0)
 S VAS="1^2^3^4^5^6^7^8^9^10^11^12^13^14^15^16^17^18^19^20^21^22^23^24^25"
"RTN","VADPT0",16,0)
 I VAN<10,$D(VAHOW),VAHOW[1 S VAS=$P($T(SS+VAN),";;",2)
"RTN","VADPT0",17,0)
 I $D(VAN(1)) F I=1:1:VAN(1) S @VAV@($P(VAS,"^",I))=""
"RTN","VADPT0",18,0)
 Q
"RTN","VADPT0",19,0)
 ;
"RTN","VADPT0",20,0)
1 ; -- [DEM] demos 
"RTN","VADPT0",21,0)
 D C1,INIT I 'VAERR D 1^VADPT1,13 Q
"RTN","VADPT0",22,0)
 ;
"RTN","VADPT0",23,0)
2 ; -- [OPD] other pt vars
"RTN","VADPT0",24,0)
 D C2,INIT,2^VADPT1:'VAERR Q
"RTN","VADPT0",25,0)
 ;
"RTN","VADPT0",26,0)
3 ; -- [ADD] current address
"RTN","VADPT0",27,0)
 D C3,INIT,3^VADPT1:'VAERR Q
"RTN","VADPT0",28,0)
 ;
"RTN","VADPT0",29,0)
4 ; -- [OAD] other pt vars
"RTN","VADPT0",30,0)
 D C4,INIT,4^VADPT1:'VAERR Q
"RTN","VADPT0",31,0)
 ;
"RTN","VADPT0",32,0)
5 ; -- [INP] inpt data -v5
"RTN","VADPT0",33,0)
 D C5,INIT,5^VADPT2:'VAERR Q
"RTN","VADPT0",34,0)
 ;
"RTN","VADPT0",35,0)
6 ; -- [IN5] inpt data v5
"RTN","VADPT0",36,0)
 D C6,INIT F I=13:1:17 F I1=1:1:7 S @VAV@($P(VAS,"^",I),I1)=""
"RTN","VADPT0",37,0)
 F I=1:1:3 S @VAV@($P(VAS,"^",19),I)=""
"RTN","VADPT0",38,0)
 D 6^VADPT3:'VAERR Q
"RTN","VADPT0",39,0)
 ;
"RTN","VADPT0",40,0)
7 ; -- [ELIG] elig data
"RTN","VADPT0",41,0)
 D C7,INIT F I=1:1:6 S @VAV@($P(VAS,"^",5),I)=""
"RTN","VADPT0",42,0)
 D 7^VADPT4:'VAERR Q
"RTN","VADPT0",43,0)
 ;
"RTN","VADPT0",44,0)
8 ; -- [MB] $ benefits
"RTN","VADPT0",45,0)
 D C8,INIT D 8^VADPT4:'VAERR Q
"RTN","VADPT0",46,0)
 ;
"RTN","VADPT0",47,0)
9 ; -- [SVC] service data
"RTN","VADPT0",48,0)
 D C9,INIT F I=1:1:9 S @VAV@($P(VAS,"^",I),1)="",@VAV@($P(VAS,"^",I),2)=""
"RTN","VADPT0",49,0)
 S @VAV@($P(VAS,"^",4),3)="",@VAV@($P(VAS,"^",5),3)=""
"RTN","VADPT0",50,0)
 F I=2,6,7,8 F I1=3,4,5 S @VAV@($P(VAS,"^",I),I1)=""
"RTN","VADPT0",51,0)
 D 9^VADPT4:'VAERR Q
"RTN","VADPT0",52,0)
 ;
"RTN","VADPT0",53,0)
10 ; -- [REG] registration data
"RTN","VADPT0",54,0)
 D C10,INIT D 10^VADPT5:'VAERR Q
"RTN","VADPT0",55,0)
 ;
"RTN","VADPT0",56,0)
11 ; -- [SDE] clinic enrollment data
"RTN","VADPT0",57,0)
 D C11,INIT D 11^VADPT5:'VAERR Q
"RTN","VADPT0",58,0)
 ;
"RTN","VADPT0",59,0)
12 ; -- [SDA] appt data
"RTN","VADPT0",60,0)
 D C12,INIT D 12^VADPT5:'VAERR Q
"RTN","VADPT0",61,0)
 ;
"RTN","VADPT0",62,0)
13 ; -- [PID] pt id's
"RTN","VADPT0",63,0)
 S (VA("PID"),VA("BID"))="" D 13^VADPT6:'VAERR Q
"RTN","VADPT0",64,0)
 ;
"RTN","VADPT0",65,0)
KVAR ; kill all vadpt data
"RTN","VADPT0",66,0)
 K VAN
"RTN","VADPT0",67,0)
C1 K ^UTILITY("VADM",$J),VADM Q:$D(VAN)
"RTN","VADPT0",68,0)
C2 K ^UTILITY("VAPD",$J),VAPD Q:$D(VAN)
"RTN","VADPT0",69,0)
C3 K X S:$D(VAPA("P")) X("P")=VAPA("P")
"RTN","VADPT0",70,0)
 S:$D(VAPA("CD")) X("CD")=VAPA("CD")
"RTN","VADPT0",71,0)
 K ^UTILITY("VAPA",$J),VAPA
"RTN","VADPT0",72,0)
 S:$D(X("P")) VAPA("P")=X("P") K X("P")
"RTN","VADPT0",73,0)
 S:$D(X("CD")) VAPA("CD")=X("CD") K X Q:$D(VAN)
"RTN","VADPT0",74,0)
C4 K X S:$D(VAOA("A")) X("A")=VAOA("A")
"RTN","VADPT0",75,0)
 K ^UTILITY("VAOA",$J),VAOA
"RTN","VADPT0",76,0)
 S:$D(X("A")) VAOA("A")=X("A") K X Q:$D(VAN)
"RTN","VADPT0",77,0)
C5 K ^UTILITY("VAIN",$J),VAIN Q:$D(VAN)
"RTN","VADPT0",78,0)
C6 K X F I="D","E","L","M","V" I $D(VAIP(I)) S X(I)=VAIP(I)
"RTN","VADPT0",79,0)
 S Y=$S('$D(VAIP("V")):"VAIP",VAIP("V")'?1A.E:"VAIP",1:VAIP("V")) K ^UTILITY(Y,$J),@Y
"RTN","VADPT0",80,0)
 F I="D","E","L","M","V" I $D(X(I)) S VAIP(I)=X(I)
"RTN","VADPT0",81,0)
 K X Q:$D(VAN)
"RTN","VADPT0",82,0)
C7 K ^UTILITY("VAEL",$J),VAEL Q:$D(VAN)
"RTN","VADPT0",83,0)
C8 K ^UTILITY("VAMB",$J),VAMB Q:$D(VAN)
"RTN","VADPT0",84,0)
C9 K ^UTILITY("VASV",$J),VASV Q:$D(VAN)
"RTN","VADPT0",85,0)
C10 K ^UTILITY("VARP",$J) Q:$D(VAN)
"RTN","VADPT0",86,0)
C11 K ^UTILITY("VAEN",$J) Q:$D(VAN)
"RTN","VADPT0",87,0)
C12 K ^UTILITY("VASD",$J) Q
"RTN","VADPT0",88,0)
C13 Q
"RTN","VADPT0",89,0)
 ;
"RTN","VADPT0",90,0)
SS ;  1^ 2^ 3^ 4^ 5^ 6^ 7^ 8^ 9^10^11^12^13^14^15^16^17^18^19^20^21^22^23^24^25
"RTN","VADPT0",91,0)
 ;;NM^SS^DB^AG^SX^EX^RE^RA^RP^MS^ET^RC
"RTN","VADPT0",92,0)
 ;;BC^BS^FN^MN^MM^OC^ES
"RTN","VADPT0",93,0)
 ;;L1^L2^L3^CI^ST^ZP^CO^PN^TS^TE^Z4^CCA^CL1^CL2^CL3^CCI^CST^CZP^CCO^CCS^CCE^CTY
"RTN","VADPT0",94,0)
 ;;L1^L2^L3^CI^ST^ZP^CO^PN^NM^RE^Z4
"RTN","VADPT0",95,0)
 ;;AN^DR^TS^WL^RB^BS^AD^AT^AF^PT^AP
"RTN","VADPT0",96,0)
 ;;MN^TT^MD^MT^WL^RB^DR^TS^MF^BS^RD^PT^AN^LN^PN^NN^DN^AP^FD
"RTN","VADPT0",97,0)
 ;;EL^PS^SC^VT^IN^TY^CN^ES^MT
"RTN","VADPT0",98,0)
 ;;AA^HB^SS^PE^MR^SI^DI^OR^GI
"RTN","VADPT0",99,0)
 ;;VN^AO^IR^PW^CS^S1^S2^S3^PH
"RTN","VADPT30")
0^8^B14142046
"RTN","VADPT30",1,0)
VADPT30 ;ALB/MJK - Current Inpatient Variables; 12 DEC 1988
"RTN","VADPT30",2,0)
 ;;5.3;Registration;**111,498**;Aug 13, 1993
"RTN","VADPT30",3,0)
 ;
"RTN","VADPT30",4,0)
VAR ; -- inpatient demographics variables
"RTN","VADPT30",5,0)
 ;  input: DFN, VATD  = inverse date ; VACN  =
"RTN","VADPT30",6,0)
 ;              VAPRC =              ; VAPRT =
"RTN","VADPT30",7,0)
 ;
"RTN","VADPT30",8,0)
 ; output: VAWD = ward ; VATS = tr. spec. ; VARM = room/bed
"RTN","VADPT30",9,0)
 ;         VAPP = doc  ; VADX = diagnosis ; VAMV = mv entry
"RTN","VADPT30",10,0)
 ;         VAAP = attending physician
"RTN","VADPT30",11,0)
 ;         VAFD = answer to facility directory question
"RTN","VADPT30",12,0)
 ;
"RTN","VADPT30",13,0)
 S (VAWDA,VAWD,VATS,VAMV,VARM,VAPP,VAAP,VADX,VAFD)="",VAID=VATD
"RTN","VADPT30",14,0)
 ; -- get mv
"RTN","VADPT30",15,0)
 D MV G VARQ:VAMV0']""
"RTN","VADPT30",16,0)
 S Y=$P($G(^DGPM(+$P(VAMV0,"^",14),"DIR")),"^",1) S:Y="" Y=1
"RTN","VADPT30",17,0)
 S VAFD=Y_"^"_$$EXTERNAL^DILFD(405,41,,Y)
"RTN","VADPT30",18,0)
 ; quit if not an adm or xfr
"RTN","VADPT30",19,0)
 I "^1^2^"'[("^"_$P(VAMV0,"^",2)_"^") G VARQ
"RTN","VADPT30",20,0)
 I 'VAPRC,"^2^3^13^25^26^43^44^45^"[("^"_VAMT_"^") G VARQ
"RTN","VADPT30",21,0)
 I VAPRC,"^13^43^44^45^"[("^"_VAMT_"^") G VARQ
"RTN","VADPT30",22,0)
 S:VAPRC VABO=$S(VAMT<4:VAMT,1:4) D GET
"RTN","VADPT30",23,0)
 ;I 'VACN,'VATS S VATS=TSD ;what is this
"RTN","VADPT30",24,0)
VARQ K VAMV0,VAMT,VAID
"RTN","VADPT30",25,0)
 Q
"RTN","VADPT30",26,0)
 ;
"RTN","VADPT30",27,0)
GET ; -- get variables and quit when all set(Y=1)
"RTN","VADPT30",28,0)
 S VACA=+$P(VAMV0,"^",14)
"RTN","VADPT30",29,0)
 D TS,SET G GETQ:Y
"RTN","VADPT30",30,0)
 F VAID=VATD:0 S VAID=$O(^DGPM("APMV",DFN,VACA,VAID)) Q:'VAID  F VAIFN=0:0 S VAIFN=$O(^DGPM("APMV",DFN,VACA,VAID,VAIFN)) Q:'VAIFN  I $D(^DGPM(VAIFN,0)) S VAMV0=^(0) D SET G GETQ:Y
"RTN","VADPT30",31,0)
GETQ K VACA,VAIFN,VAID Q
"RTN","VADPT30",32,0)
 ;
"RTN","VADPT30",33,0)
KVAR K VAMV,VAWDA,VAWD,VARM,VAPP,VAAP,VATS,VATD,VAPRC,VAPRT,VACN,VADX,VABO,VAFD Q
"RTN","VADPT30",34,0)
 ;
"RTN","VADPT30",35,0)
SET ; -- set variables if null
"RTN","VADPT30",36,0)
 S Y=0
"RTN","VADPT30",37,0)
 I 'VAWD,$D(^DIC(42,+$P(VAMV0,"^",6),0)) S VAWDA=$S($D(VAIFN):VAIFN,1:VAMV),VAWD=$P(VAMV0,"^",6)_"^"_$P(^(0),"^") S VARM="" I $D(^DG(405.4,+$P(VAMV0,"^",7),0)) S VARM=$P(VAMV0,"^",7)_"^"_$P(^(0),"^")
"RTN","VADPT30",38,0)
 I 'VACN,VAWD S Y=1
"RTN","VADPT30",39,0)
 N VARSTR
"RTN","VADPT30",40,0)
 S VARSTR="^^^^^VAWD^VARM^VAPP^VATS^VADX^^^^^^^^^VAAP^"
"RTN","VADPT30",41,0)
 S $P(VARSTR,"^",41)="VAFD"
"RTN","VADPT30",42,0)
 I VACN,'VAPRT,$D(DGPMDDF),@$P(VARSTR,"^",+DGPMDDF),VAMV S Y=1
"RTN","VADPT30",43,0)
 I VACN,VAPRT,VAWD,VAMV,VADX]"" S Y=1
"RTN","VADPT30",44,0)
 Q
"RTN","VADPT30",45,0)
 ;
"RTN","VADPT30",46,0)
TS ; set VADX, VATS, VAAP, and VAPP via VACA x-refs
"RTN","VADPT30",47,0)
 N VAMV0
"RTN","VADPT30",48,0)
 S:$D(^DGPM(VACA,0)) VADX=$P(^(0),"^",10)
"RTN","VADPT30",49,0)
 F VAID=VATD:0 S VAID=$O(^DGPM("ATS",DFN,VACA,VAID)) Q:'VAID  F VAT=0:0 S VAT=$O(^DGPM("ATS",DFN,VACA,VAID,VAT)) Q:'VAT  F VAIFN=0:0 S VAIFN=$O(^DGPM("ATS",DFN,VACA,VAID,VAT,VAIFN)) Q:'VAIFN  D TS1 G TSQ:VAPP&VATS&VAAP
"RTN","VADPT30",50,0)
TSQ K VAIFN,VAT Q
"RTN","VADPT30",51,0)
 ;
"RTN","VADPT30",52,0)
TS1 ; set VATS, VAPP, and VAAP
"RTN","VADPT30",53,0)
 Q:'$D(^DGPM(VAIFN,0))  S VAMV0=^(0)
"RTN","VADPT30",54,0)
 I 'VAPP,$D(^VA(200,+$P(VAMV0,"^",8),0)) S Y=$P(VAMV0,"^",8)_"^"_$P(^(0),"^") S VAPP=Y
"RTN","VADPT30",55,0)
 I 'VAAP,$D(^VA(200,+$P(VAMV0,"^",19),0)) S Y=$P(VAMV0,"^",19)_"^"_$P(^(0),"^") S VAAP=Y
"RTN","VADPT30",56,0)
 I 'VATS,$D(^DIC(45.7,+$P(VAMV0,"^",9),0)) S VATS=$P(VAMV0,"^",9)_"^"_$P(^(0),"^")
"RTN","VADPT30",57,0)
 Q
"RTN","VADPT30",58,0)
 ;
"RTN","VADPT30",59,0)
MV ; -- get latest mv for pt before VAID and not ASIH mv
"RTN","VADPT30",60,0)
 S (VAMV,VAMV0)=""
"RTN","VADPT30",61,0)
 F VAID=VAID:0 S VAID=$O(^DGPM("APID",DFN,VAID)) G MVQ:'VAID S VAMV=$O(^DGPM("APID",DFN,VAID,0)) I $D(^DGPM(+VAMV,0)) S VAMT=$P(^(0),"^",18) G MVQ:'VAMT Q:"^13^41^42^47^"'[("^"_VAMT_"^")
"RTN","VADPT30",62,0)
 S VAMV0=^DGPM(VAMV,0)
"RTN","VADPT30",63,0)
MVQ Q
"RTN","VADPT30",64,0)
 ;
"RTN","VADPT30",65,0)
A ;return current admission or last admission for patient
"RTN","VADPT30",66,0)
 S Y=$S($D(^DPT(DFN,.105)):+^(.105),1:0) G AQ:$D(^DGPM(Y,0))
"RTN","VADPT30",67,0)
 N VAID,VAMV,VAMV0
"RTN","VADPT30",68,0)
 F VAID=0:0 S VAID=$O(^DGPM("ATID1",DFN,VAID)) Q:'VAID  F VAMV=0:0 S VAMV=$O(^DGPM("ATID1",DFN,VAID,VAMV)) Q:'VAMV  I $D(^DGPM(VAMV,0)) S VAMV0=^(0) D DIS G AQ:Y
"RTN","VADPT30",69,0)
 S Y=0
"RTN","VADPT30",70,0)
AQ Q
"RTN","VADPT30",71,0)
 ;
"RTN","VADPT30",72,0)
DIS ; check for ASIH discharges
"RTN","VADPT30",73,0)
 S Y=$S('$D(^DGPM(+$P(VAMV0,"^",17),0)):VAMV,"^41^46"[(U_$P(^(0),"^",18)_U):0,1:VAMV)
"RTN","VADPT30",74,0)
 Q
"RTN","VADPT30",75,0)
 ;
"RTN","VADPT31")
0^9^B17036513
"RTN","VADPT31",1,0)
VADPT31 ;ALB/MRL/MJK - PATIENT VARIABLES [IN5], CONT.; 12 DEC 1988
"RTN","VADPT31",2,0)
 ;;5.3;Registration;**498**;Aug 13, 1993
"RTN","VADPT31",3,0)
 ;Inpatient variables [Version 5.0 and above]
"RTN","VADPT31",4,0)
EN N VAINDT,VAMV,VAMV0
"RTN","VADPT31",5,0)
 S VAMV=+E,VAMV0=^DGPM(VAMV,0),VAX("CA")=+$P(VAMV0,"^",14) G ENQ:'$D(^DGPM(+VAX("CA"),0))
"RTN","VADPT31",6,0)
 I $D(VAIP("M")) D CE G ENQ:'$D(^DGPM(+E,0)) S VAMV=+E,VAMV0=^(0)
"RTN","VADPT31",7,0)
 S @VAV@($P(VAS,"^",1))=E
"RTN","VADPT31",8,0)
 S Y=$P(VAMV0,"^",2),@VAV@($P(VAS,"^",2))=Y_"^"_$S($D(^DG(405.3,+Y,0)):$P(^(0),"^"),1:"")
"RTN","VADPT31",9,0)
 S Y=$S(+VAMV0:+VAMV0,1:"") X:Y ^DD("DD") S @VAV@($P(VAS,"^",3))=+VAMV0_"^"_Y
"RTN","VADPT31",10,0)
 S Y=$P(VAMV0,"^",18),@VAV@($P(VAS,"^",4))=Y_"^"_$S($D(^DG(405.2,+Y,0)):$P(^(0),"^"),1:"")
"RTN","VADPT31",11,0)
 S Y=+$P(^DGPM(VAX("CA"),0),"^",16) S:Y @VAV@($P(VAS,"^",12))=Y
"RTN","VADPT31",12,0)
 ;
"RTN","VADPT31",13,0)
 S VATD=VAX("DT") D FIND
"RTN","VADPT31",14,0)
 S @VAV@($P(VAS,"^",5))=VAWD,@VAV@($P(VAS,"^",6))=VARM,@VAV@($P(VAS,"^",7))=VAPP,@VAV@($P(VAS,"^",8))=VATS,@VAV@($P(VAS,"^",9))=VADX,@VAV@($P(VAS,"^",18))=VAAP
"RTN","VADPT31",15,0)
 S VANODE=$G(^DGPM(VAX("CA"),"DIR"))
"RTN","VADPT31",16,0)
 S Y=$P(VANODE,"^",1) S:Y="" Y=1 S @VAV@($P(VAS,"^",19),1)=Y_"^"_$$EXTERNAL^DILFD(405,41,,Y)
"RTN","VADPT31",17,0)
 S Y=$P(VANODE,"^",2) S @VAV@($P(VAS,"^",19),2)=Y_"^"_$$EXTERNAL^DILFD(405,42,,Y)
"RTN","VADPT31",18,0)
 S Y=$P(VANODE,"^",3) S @VAV@($P(VAS,"^",19),3)=Y_"^"_$$EXTERNAL^DILFD(405,43,,Y)
"RTN","VADPT31",19,0)
 ;
"RTN","VADPT31",20,0)
 S VAINDT=+VAMV0 D IB^VADPT2 S @VAV@($P(VAS,"^",10))=+VAZ
"RTN","VADPT31",21,0)
 I 'VAZ,$D(VAZ(2)),VAZ(2)?7N!(VAZ(2)?7N1".".N) S Y=VAZ(2) X ^DD("DD") S @VAV@($P(VAS,"^",11))=VAZ(2)_"^"_Y
"RTN","VADPT31",22,0)
 ;
"RTN","VADPT31",23,0)
 I $D(VAIP("M")) S VASET=$S(VAIP("M"):14,1:13),VASET(VASET)="",VANODE=$P(VAS,"^",VASET) D COPY ; last or adm
"RTN","VADPT31",24,0)
 I '$D(VAIP("M")),$D(VAIP("D")),"^l^L^"[("^"_$E(VAIP("D"))_"^") S VASET(14)="",VANODE=$P(VAS,"^",14) D COPY ; last
"RTN","VADPT31",25,0)
 I "^3^5^"[("^"_$P(VAMV0,"^",2)_"^") S VASET(17)="",VANODE=$P(VAS,"^",17) D COPY ; d/c
"RTN","VADPT31",26,0)
 I '$D(VASET(13)) S VAMV=VAX("CA"),VAMV0=^DGPM(VAMV,0),VANODE=$P(VAS,"^",13) D STORE ; adm
"RTN","VADPT31",27,0)
 D BLD^VADPT32 G ENQ:'$D(^UTILITY("VADPTZ",$J,DFN))
"RTN","VADPT31",28,0)
 S VAXE=$S($D(^UTILITY("VADPTZ",$J,DFN,1)):^(1),1:""),VAMV0=$P(VAXE,"||",2),VAMV=+VAXE
"RTN","VADPT31",29,0)
 I VAMV,"^3^5^"[("^"_$P(VAMV0,"^",2)_"^"),'$D(VASET(17)) S VANODE=$P(VAS,"^",17) D STORE ; d/c
"RTN","VADPT31",30,0)
 I VAMV,'$D(VASET(14)) S VANODE=$P(VAS,"^",14) D STORE ;last
"RTN","VADPT31",31,0)
 I $S('VANN:1,'$D(^UTILITY("VADPTZ",$J,DFN,+VANN)):1,1:0) G ENQ
"RTN","VADPT31",32,0)
 I $D(^UTILITY("VADPTZ",$J,DFN,VANN-1)) S VAXE=^(VANN-1),VAMV=+VAXE,VAMV0=$P(VAXE,"||",2) I VAMV S VANODE=$P(VAS,"^",16) D STORE ; following
"RTN","VADPT31",33,0)
 I $D(^UTILITY("VADPTZ",$J,DFN,VANN+1)) S VAXE=^(VANN+1),VAMV=+VAXE,VAMV0=$P(VAXE,"||",2) I VAMV S VANODE=$P(VAS,"^",15) D STORE ; prior
"RTN","VADPT31",34,0)
 ;
"RTN","VADPT31",35,0)
ENQ K VAMVX,VANODE,VAMCC,VAXE,VANN D KVAR^VADPT30 Q
"RTN","VADPT31",36,0)
 ;
"RTN","VADPT31",37,0)
FIND ;
"RTN","VADPT31",38,0)
 S VAMVX=VAMV,VAMV0X=VAMV0
"RTN","VADPT31",39,0)
 S (VAWD,VATS,VAMV,VARM,VAPP,VAAP,VADX)=""
"RTN","VADPT31",40,0)
 I $P(VAMV0,"^",2)=4!($P(VAMV0,"^",2)=5) D LODGER G FINDQ
"RTN","VADPT31",41,0)
 S VATD=9999999.999999-VATD,(VACN,VAPRC,VAPRT)=1 D GET^VADPT30
"RTN","VADPT31",42,0)
FINDQ S VAMV=VAMVX,VAMV0=VAMV0X K VAMVX,VAMV0X
"RTN","VADPT31",43,0)
 Q
"RTN","VADPT31",44,0)
 ;
"RTN","VADPT31",45,0)
CE I 'VAIP("M") S E=+VAX("CA") Q
"RTN","VADPT31",46,0)
 S E=$O(^DGPM("APMV",DFN,+VAX("CA"),0)) Q:E'>0  S E=$O(^DGPM("APMV",DFN,+VAX("CA"),E,0)) Q
"RTN","VADPT31",47,0)
 ;
"RTN","VADPT31",48,0)
STORE ; store 'other nodes'
"RTN","VADPT31",49,0)
 S @VAV@(VANODE)=+VAMV
"RTN","VADPT31",50,0)
 S Y=+VAMV0 X:Y ^DD("DD") S @VAV@(VANODE,1)=+VAMV0_"^"_Y
"RTN","VADPT31",51,0)
 S Y=$P(VAMV0,"^",2),@VAV@(VANODE,2)=Y_"^"_$S($D(^DG(405.3,+Y,0)):$P(^(0),"^"),1:"")
"RTN","VADPT31",52,0)
 S Y=$P(VAMV0,"^",18),@VAV@(VANODE,3)=Y_"^"_$S($D(^DG(405.2,+Y,0)):$P(^(0),"^"),1:"")
"RTN","VADPT31",53,0)
 S VATD=+VAMV0 D FIND
"RTN","VADPT31",54,0)
 S @VAV@(VANODE,4)=VAWD,@VAV@(VANODE,5)=VAPP,@VAV@(VANODE,6)=VATS,@VAV@(VANODE,7)=VADX
"RTN","VADPT31",55,0)
 Q
"RTN","VADPT31",56,0)
 ;
"RTN","VADPT31",57,0)
COPY ; copy from primary to other nodes
"RTN","VADPT31",58,0)
 S @VAV@(VANODE)=VAMV
"RTN","VADPT31",59,0)
 ; 1-mvt d/t ; 2-transaction type ; 3-mvt type
"RTN","VADPT31",60,0)
 S @VAV@(VANODE,1)=@VAV@($P(VAS,"^",3)),@VAV@(VANODE,2)=@VAV@($P(VAS,"^",2)),@VAV@(VANODE,3)=@VAV@($P(VAS,"^",4))
"RTN","VADPT31",61,0)
 ; 4-ward ; 5-doc ; 6-treat spec ; 7-dx
"RTN","VADPT31",62,0)
 S @VAV@(VANODE,4)=@VAV@($P(VAS,"^",5)),@VAV@(VANODE,5)=@VAV@($P(VAS,"^",7)),@VAV@(VANODE,6)=@VAV@($P(VAS,"^",8)),@VAV@(VANODE,7)=@VAV@($P(VAS,"^",9))
"RTN","VADPT31",63,0)
 Q
"RTN","VADPT31",64,0)
 ;
"RTN","VADPT31",65,0)
LODGER ; -- get lodger data
"RTN","VADPT31",66,0)
 S VAWD=$S($P(VAMV0,"^",2)=4:$P(VAMV0,"^",6),$D(^DGPM(+$P(VAMV0,"^",14),0)):$P(^(0),"^",6),1:"")
"RTN","VADPT31",67,0)
 S VAWD=$S($D(^DIC(42,+VAWD,0)):VAWD_"^"_$P(^(0),"^"),1:"")
"RTN","VADPT31",68,0)
 S VARM=$S($P(VAMV0,"^",2)=4:$P(VAMV0,"^",7),$D(^DGPM(+$P(VAMV0,"^",14),0)):$P(^(0),"^",7),1:"")
"RTN","VADPT31",69,0)
 S VARM=$S($D(^DG(405.4,+VARM,0)):VARM_"^"_$P(^(0),"^"),1:"")
"RTN","VADPT31",70,0)
 Q
"VER")
8.0^22.0
"^DD",2,2,.109,0)
EXCLUDE FROM FACILITY DIR^S^0:NO;1:YES;^.109;1^Q
"^DD",2,2,.109,21,0)
^^4^4^3030218^
"^DD",2,2,.109,21,1,0)
Denotes whether or not the patient wished to be excluded from the 
"^DD",2,2,.109,21,2,0)
Facility Directory for current admission.  This field is only stored for 
"^DD",2,2,.109,21,3,0)
current inpatients.  It must NOT be edited as this could affect the 
"^DD",2,2,.109,21,4,0)
integrity of many options within PIMS and other packages.
"^DD",2,2,.109,"DT")
3030218
"^DD",405,405,40,0)
EXCLUDE FROM FACILITY DIR^CJ3^^ ; ^X ^DD(405,40,9.2) S Y(405,40,101)=$S($D(^DGPM(D0,"DIR")):^("DIR"),1:"") S X=$P($P(Y(405,40,102),$C(59)_$P(Y(405,40,101),U,1)_":",2),$C(59)) S D0=Y(405,40,80)
"^DD",405,405,40,9.01)
405^41;405^.14
"^DD",405,405,40,9.1)
ADMISSION/CHECK-IN MOVEMENT:FACILITY DIRECTORY EXCLUSION
"^DD",405,405,40,9.2)
S Y(405,40,80)=$G(D0),Y(405,40,1)=$S($D(^DGPM(D0,0)):^(0),1:""),D0=$P(Y(405,40,1),U,14) S:'D0!'$D(^DGPM(+D0,0)) D0=-1 S Y(405,40,102)=$C(59)_$P($G(^DD(405,41,0)),U,3)
"^DD",405,405,40,21,0)
^^2^2^3030218^
"^DD",405,405,40,21,1,0)
This computed field will determine if the patient wished to be excluded 
"^DD",405,405,40,21,2,0)
from the Facility Directory for the corresponding admission.
"^DD",405,405,40,"DT")
3030218
"^DD",405,405,41,0)
FACILITY DIRECTORY EXCLUSION^SX^0:NO;1:YES;^DIR;1^I $D(X),'$D(DGPMT) D EN^DDIOL("USE BED CONTROL MOVEMENT OPTIONS!",,"!") K X
"^DD",405,405,41,1,0)
^.1
"^DD",405,405,41,1,1,0)
^^TRIGGER^405^42
"^DD",405,405,41,1,1,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DGPM(D0,"DIR")):^("DIR"),1:"") S X=$P(Y(1),U,2),X=X S DIU=X K Y S X=DIV S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) X ^DD(405,41,1,1,1.4)
"^DD",405,405,41,1,1,1.4)
S DIH=$G(^DGPM(DIV(0),"DIR")),DIV=X S $P(^("DIR"),U,2)=DIV,DIH=405,DIG=42 D ^DICR
"^DD",405,405,41,1,1,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DGPM(D0,"DIR")):^("DIR"),1:"") S X=$P(Y(1),U,2),X=X S DIU=X K Y S X="" S DIH=$G(^DGPM(DIV(0),"DIR")),DIV=X S $P(^("DIR"),U,2)=DIV,DIH=405,DIG=42 D ^DICR
"^DD",405,405,41,1,1,"%D",0)
^^2^2^3030218^
"^DD",405,405,41,1,1,"%D",1,0)
Stuffs the current date/time into the FACILITY DIRECTORY TIME STAMP field 
"^DD",405,405,41,1,1,"%D",2,0)
(#42).
"^DD",405,405,41,1,1,"CREATE VALUE")
NOW
"^DD",405,405,41,1,1,"DELETE VALUE")
@
"^DD",405,405,41,1,1,"FIELD")
#42
"^DD",405,405,41,1,2,0)
^^TRIGGER^405^43
"^DD",405,405,41,1,2,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DGPM(D0,"DIR")):^("DIR"),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X=DIV S X=$G(DUZ) S DIH=$G(^DGPM(DIV(0),"DIR")),DIV=X S $P(^("DIR"),U,3)=DIV,DIH=405,DIG=43 D ^DICR
"^DD",405,405,41,1,2,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DGPM(D0,"DIR")):^("DIR"),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X="" S DIH=$G(^DGPM(DIV(0),"DIR")),DIV=X S $P(^("DIR"),U,3)=DIV,DIH=405,DIG=43 D ^DICR
"^DD",405,405,41,1,2,"%D",0)
^^1^1^3030218^
"^DD",405,405,41,1,2,"%D",1,0)
Stuffs the current user into the FACILITY DIRECTORY USER field (#43).
"^DD",405,405,41,1,2,"CREATE VALUE")
S X=$G(DUZ)
"^DD",405,405,41,1,2,"DELETE VALUE")
@
"^DD",405,405,41,1,2,"DT")
3030218
"^DD",405,405,41,1,2,"FIELD")
#43
"^DD",405,405,41,1,3,0)
405^AFD^MUMPS
"^DD",405,405,41,1,3,1)
S DGPMDDF=41,DGPMDDT=1 D ^DGPMDDCN
"^DD",405,405,41,1,3,2)
S DGPMDDF=41,DGPMDDT=0 D ^DGPMDDCN
"^DD",405,405,41,1,3,"%D",0)
^.101^2^2^3030218^^
"^DD",405,405,41,1,3,"%D",1,0)
Sets the FACILITY DIRECTORY EXCLUSION field (#.109) of the PATIENT file 
"^DD",405,405,41,1,3,"%D",2,0)
(#2).
"^DD",405,405,41,1,3,"DT")
3030218
"^DD",405,405,41,3)
Enter 'YES' if the patient wishes to "opt out" from the Facility Directory for this admission.  Otherwise answer 'NO'.
"^DD",405,405,41,21,0)
^^7^7^3030219^
"^DD",405,405,41,21,1,0)
Denotes whether or not the patient wished to be excluded from the 
"^DD",405,405,41,21,2,0)
Facility Directory for this admisison.
"^DD",405,405,41,21,3,0)
 
"^DD",405,405,41,21,4,0)
The Facility Directory is the directory of current inpatients in the 
"^DD",405,405,41,21,5,0)
facility.  If the patient wishes to be excluded from the Facility 
"^DD",405,405,41,21,6,0)
Directory, then the VAMC can not make a positive statement to family, 
"^DD",405,405,41,21,7,0)
friends, or others as to whether the patient is here or not.
"^DD",405,405,41,"DT")
3030219
"^DD",405,405,42,0)
FACILITY DIRECTORY TIME STAMP^DI^^DIR;2^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",405,405,42,3)
(No range limit on date)
"^DD",405,405,42,5,1,0)
405^41^1
"^DD",405,405,42,9)
^
"^DD",405,405,42,21,0)
^^1^1^3030218^
"^DD",405,405,42,21,1,0)
Date/time answer to Facility Directory exclusion question was entered.
"^DD",405,405,42,"DT")
3030218
"^DD",405,405,43,0)
FACILITY DIRECTORY USER^P200'I^VA(200,^DIR;3^Q
"^DD",405,405,43,5,1,0)
405^41^2
"^DD",405,405,43,9)
^
"^DD",405,405,43,21,0)
^^2^2^3030218^
"^DD",405,405,43,21,1,0)
User entering the patient's response to the Facility Directory exclusion 
"^DD",405,405,43,21,2,0)
question.
"^DD",405,405,43,"DT")
3030218
**END**
**END**
