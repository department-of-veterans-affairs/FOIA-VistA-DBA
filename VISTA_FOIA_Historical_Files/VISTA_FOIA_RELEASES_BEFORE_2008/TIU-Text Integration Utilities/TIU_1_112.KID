KIDS Distribution saved on Mar 26, 2004@16:30:57
Version 27
**KIDS**:TIU*1.0*112^

**INSTALL NAME**
TIU*1.0*112
"BLD",3128,0)
TIU*1.0*112^TEXT INTEGRATION UTILITIES^0^3040326^y
"BLD",3128,1,0)
^^2^2^3030915^
"BLD",3128,1,1,0)
The description of this build is found in the National Patch Module under
"BLD",3128,1,2,0)
patch TIU*1*112.
"BLD",3128,4,0)
^9.64PA^811.8^3
"BLD",3128,4,811.8,0)
811.8
"BLD",3128,4,811.8,222)
n^y^f^^n^^y^o^n
"BLD",3128,4,811.8,224)
I Y=2
"BLD",3128,4,8925,0)
8925
"BLD",3128,4,8925,2,0)
^9.641^8925^1
"BLD",3128,4,8925,2,8925,0)
TIU DOCUMENT  (File-top level)
"BLD",3128,4,8925,2,8925,1,0)
^9.6411^1405^1
"BLD",3128,4,8925,2,8925,1,1405,0)
REQUESTING PACKAGE REFERENCE
"BLD",3128,4,8925,222)
y^y^p^^^^n
"BLD",3128,4,8925.1,0)
8925.1
"BLD",3128,4,8925.1,2,0)
^9.641^8925.1^1
"BLD",3128,4,8925.1,2,8925.1,0)
TIU DOCUMENT DEFINITION  (File-top level)
"BLD",3128,4,8925.1,2,8925.1,1,0)
^9.6411^.03^5
"BLD",3128,4,8925.1,2,8925.1,1,.01,0)
NAME
"BLD",3128,4,8925.1,2,8925.1,1,.02,0)
ABBREVIATION
"BLD",3128,4,8925.1,2,8925.1,1,.03,0)
PRINT NAME
"BLD",3128,4,8925.1,2,8925.1,1,6.5,0)
ON BROWSE EVENT
"BLD",3128,4,8925.1,2,8925.1,1,6.51,0)
ON RETRACT EVENT
"BLD",3128,4,8925.1,222)
y^y^p^^^^n
"BLD",3128,4,"APDD",8925,8925)

"BLD",3128,4,"APDD",8925,8925,1405)

"BLD",3128,4,"APDD",8925.1,8925.1)

"BLD",3128,4,"APDD",8925.1,8925.1,.01)

"BLD",3128,4,"APDD",8925.1,8925.1,.02)

"BLD",3128,4,"APDD",8925.1,8925.1,.03)

"BLD",3128,4,"APDD",8925.1,8925.1,6.5)

"BLD",3128,4,"APDD",8925.1,8925.1,6.51)

"BLD",3128,4,"B",811.8,811.8)

"BLD",3128,4,"B",8925,8925)

"BLD",3128,4,"B",8925.1,8925.1)

"BLD",3128,"ABNS",0)
^9.66A^^0
"BLD",3128,"ABPKG")
n^n^
"BLD",3128,"INI")
TIUPR112
"BLD",3128,"INIT")
TIUPS112
"BLD",3128,"KRN",0)
^9.67PA^19^17
"BLD",3128,"KRN",.4,0)
.4
"BLD",3128,"KRN",.4,"NM",0)
^9.68A^^
"BLD",3128,"KRN",.401,0)
.401
"BLD",3128,"KRN",.402,0)
.402
"BLD",3128,"KRN",.402,"NM",0)
^9.68A^2^1
"BLD",3128,"KRN",.402,"NM",2,0)
TIU ENTER/EDIT SURGICAL REPORT    FILE #8925^8925^0
"BLD",3128,"KRN",.402,"NM","B","TIU ENTER/EDIT SURGICAL REPORT    FILE #8925",2)

"BLD",3128,"KRN",.403,0)
.403
"BLD",3128,"KRN",.5,0)
.5
"BLD",3128,"KRN",.84,0)
.84
"BLD",3128,"KRN",3.6,0)
3.6
"BLD",3128,"KRN",3.8,0)
3.8
"BLD",3128,"KRN",9.2,0)
9.2
"BLD",3128,"KRN",9.8,0)
9.8
"BLD",3128,"KRN",9.8,"NM",0)
^9.68A^28^26
"BLD",3128,"KRN",9.8,"NM",1,0)
TIUBR^^0^B41348643
"BLD",3128,"KRN",9.8,"NM",2,0)
TIUSRVLR^^0^B2293640
"BLD",3128,"KRN",9.8,"NM",3,0)
TIUSRV^^0^B70831969
"BLD",3128,"KRN",9.8,"NM",4,0)
TIUSRV1^^0^B17032930
"BLD",3128,"KRN",9.8,"NM",5,0)
TIUSRVR1^^0^B31783728
"BLD",3128,"KRN",9.8,"NM",6,0)
TIULC1^^0^B53707048
"BLD",3128,"KRN",9.8,"NM",7,0)
TIURD2^^0^B70952985
"BLD",3128,"KRN",9.8,"NM",9,0)
TIUSROI^^0^B63760309
"BLD",3128,"KRN",9.8,"NM",10,0)
TIUR1^^0^B14794635
"BLD",3128,"KRN",9.8,"NM",12,0)
TIUR^^0^B36847949
"BLD",3128,"KRN",9.8,"NM",13,0)
TIURA2^^0^B33239814
"BLD",3128,"KRN",9.8,"NM",14,0)
TIUPS112^^0^B5946128
"BLD",3128,"KRN",9.8,"NM",15,0)
TIUPUTS^^0^B32496755
"BLD",3128,"KRN",9.8,"NM",16,0)
TIUSRVD^^0^B41088251
"BLD",3128,"KRN",9.8,"NM",17,0)
TIUSRVR^^0^B16915874
"BLD",3128,"KRN",9.8,"NM",18,0)
TIUADD^^0^B38278097
"BLD",3128,"KRN",9.8,"NM",19,0)
TIUSRVP1^^0^B37579653
"BLD",3128,"KRN",9.8,"NM",20,0)
TIUPEFIX^^0^B42748448
"BLD",3128,"KRN",9.8,"NM",21,0)
TIUSRVP^^0^B72721912
"BLD",3128,"KRN",9.8,"NM",22,0)
TIUPUTC^^0^B28257433
"BLD",3128,"KRN",9.8,"NM",23,0)
TIUEDITR^^0^B15432270
"BLD",3128,"KRN",9.8,"NM",24,0)
TIUEDIT^^0^B39405291
"BLD",3128,"KRN",9.8,"NM",25,0)
TIUEDIM^^0^B18777304
"BLD",3128,"KRN",9.8,"NM",26,0)
TIURD3^^0^B66718658
"BLD",3128,"KRN",9.8,"NM",27,0)
TIUSROI1^^0^B40110118
"BLD",3128,"KRN",9.8,"NM",28,0)
TIURB2^^0^B35815970
"BLD",3128,"KRN",9.8,"NM","B","TIUADD",18)

"BLD",3128,"KRN",9.8,"NM","B","TIUBR",1)

"BLD",3128,"KRN",9.8,"NM","B","TIUEDIM",25)

"BLD",3128,"KRN",9.8,"NM","B","TIUEDIT",24)

"BLD",3128,"KRN",9.8,"NM","B","TIUEDITR",23)

"BLD",3128,"KRN",9.8,"NM","B","TIULC1",6)

"BLD",3128,"KRN",9.8,"NM","B","TIUPEFIX",20)

"BLD",3128,"KRN",9.8,"NM","B","TIUPS112",14)

"BLD",3128,"KRN",9.8,"NM","B","TIUPUTC",22)

"BLD",3128,"KRN",9.8,"NM","B","TIUPUTS",15)

"BLD",3128,"KRN",9.8,"NM","B","TIUR",12)

"BLD",3128,"KRN",9.8,"NM","B","TIUR1",10)

"BLD",3128,"KRN",9.8,"NM","B","TIURA2",13)

"BLD",3128,"KRN",9.8,"NM","B","TIURB2",28)

"BLD",3128,"KRN",9.8,"NM","B","TIURD2",7)

"BLD",3128,"KRN",9.8,"NM","B","TIURD3",26)

"BLD",3128,"KRN",9.8,"NM","B","TIUSROI",9)

"BLD",3128,"KRN",9.8,"NM","B","TIUSROI1",27)

"BLD",3128,"KRN",9.8,"NM","B","TIUSRV",3)

"BLD",3128,"KRN",9.8,"NM","B","TIUSRV1",4)

"BLD",3128,"KRN",9.8,"NM","B","TIUSRVD",16)

"BLD",3128,"KRN",9.8,"NM","B","TIUSRVLR",2)

"BLD",3128,"KRN",9.8,"NM","B","TIUSRVP",21)

"BLD",3128,"KRN",9.8,"NM","B","TIUSRVP1",19)

"BLD",3128,"KRN",9.8,"NM","B","TIUSRVR",17)

"BLD",3128,"KRN",9.8,"NM","B","TIUSRVR1",5)

"BLD",3128,"KRN",19,0)
19
"BLD",3128,"KRN",19,"NM",0)
^9.68A^8^8
"BLD",3128,"KRN",19,"NM",1,0)
TIU REVIEW UNDICTATED DOCS^^0
"BLD",3128,"KRN",19,"NM",2,0)
TIU MAIN MENU MIXED CLINICIAN^^2
"BLD",3128,"KRN",19,"NM",3,0)
TIU REVIEW UNTRANSCRIBED DOCS^^0
"BLD",3128,"KRN",19,"NM",4,0)
TIU MAIN MENU TRANSCRIPTION^^2
"BLD",3128,"KRN",19,"NM",5,0)
TIU BROWSE DOC TRANSCRIPTION^^0
"BLD",3128,"KRN",19,"NM",6,0)
TIU REVIEW UNSIGNED^^4^
"BLD",3128,"KRN",19,"NM",7,0)
TIU REVIEW SCREEN CLINICIAN^^4^
"BLD",3128,"KRN",19,"NM",8,0)
TIU ENTER/EDIT^^4^
"BLD",3128,"KRN",19,"NM","B","TIU BROWSE DOC TRANSCRIPTION",5)

"BLD",3128,"KRN",19,"NM","B","TIU ENTER/EDIT",8)

"BLD",3128,"KRN",19,"NM","B","TIU MAIN MENU MIXED CLINICIAN",2)

"BLD",3128,"KRN",19,"NM","B","TIU MAIN MENU TRANSCRIPTION",4)

"BLD",3128,"KRN",19,"NM","B","TIU REVIEW SCREEN CLINICIAN",7)

"BLD",3128,"KRN",19,"NM","B","TIU REVIEW UNDICTATED DOCS",1)

"BLD",3128,"KRN",19,"NM","B","TIU REVIEW UNSIGNED",6)

"BLD",3128,"KRN",19,"NM","B","TIU REVIEW UNTRANSCRIBED DOCS",3)

"BLD",3128,"KRN",19.1,0)
19.1
"BLD",3128,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",3128,"KRN",101,0)
101
"BLD",3128,"KRN",101,"NM",0)
^9.68A^18^18
"BLD",3128,"KRN",101,"NM",1,0)
TIU ACTION MENU DICTATION^^0
"BLD",3128,"KRN",101,"NM",2,0)
TIU BROWSE ACTION DOCUMENT DICTATED^^0
"BLD",3128,"KRN",101,"NM",3,0)
TIU ACTION DICTATE DOCUMENTS^^0
"BLD",3128,"KRN",101,"NM",4,0)
TIU BROWSE MENU DICTATION^^0
"BLD",3128,"KRN",101,"NM",5,0)
TIU ACTION PRINT^^4^
"BLD",3128,"KRN",101,"NM",6,0)
TIU ACTION DETAILED DISPLAY^^4^
"BLD",3128,"KRN",101,"NM",7,0)
TIU ACTION QUIT^^4^
"BLD",3128,"KRN",101,"NM",8,0)
TIU ACTION CHANGE VIEW CLINICIAN^^4^
"BLD",3128,"KRN",101,"NM",9,0)
TIU ACTION SEARCH LIST^^4^
"BLD",3128,"KRN",101,"NM",10,0)
TIU BROWSE ACTION PRINT^^4^
"BLD",3128,"KRN",101,"NM",11,0)
TIU BROWSE ACTION SEARCH^^4^
"BLD",3128,"KRN",101,"NM",12,0)
TIU ACTION MENU TRANSCRIPTION^^0
"BLD",3128,"KRN",101,"NM",13,0)
TIU BROWSE MENU TRANSCRIPTION^^0
"BLD",3128,"KRN",101,"NM",14,0)
TIU ACTION BROWSE FOR TRANSCRIPTION^^0
"BLD",3128,"KRN",101,"NM",15,0)
TIU ACTION EDIT^^4^
"BLD",3128,"KRN",101,"NM",16,0)
TIU BROWSE ACTION EDIT^^4^
"BLD",3128,"KRN",101,"NM",17,0)
TIU ACTION BLANK1^^4^
"BLD",3128,"KRN",101,"NM",18,0)
TIU ACTION BLANK2^^4^
"BLD",3128,"KRN",101,"NM","B","TIU ACTION BLANK1",17)

"BLD",3128,"KRN",101,"NM","B","TIU ACTION BLANK2",18)

"BLD",3128,"KRN",101,"NM","B","TIU ACTION BROWSE FOR TRANSCRIPTION",14)

"BLD",3128,"KRN",101,"NM","B","TIU ACTION CHANGE VIEW CLINICIAN",8)

"BLD",3128,"KRN",101,"NM","B","TIU ACTION DETAILED DISPLAY",6)

"BLD",3128,"KRN",101,"NM","B","TIU ACTION DICTATE DOCUMENTS",3)

"BLD",3128,"KRN",101,"NM","B","TIU ACTION EDIT",15)

"BLD",3128,"KRN",101,"NM","B","TIU ACTION MENU DICTATION",1)

"BLD",3128,"KRN",101,"NM","B","TIU ACTION MENU TRANSCRIPTION",12)

"BLD",3128,"KRN",101,"NM","B","TIU ACTION PRINT",5)

"BLD",3128,"KRN",101,"NM","B","TIU ACTION QUIT",7)

"BLD",3128,"KRN",101,"NM","B","TIU ACTION SEARCH LIST",9)

"BLD",3128,"KRN",101,"NM","B","TIU BROWSE ACTION DOCUMENT DICTATED",2)

"BLD",3128,"KRN",101,"NM","B","TIU BROWSE ACTION EDIT",16)

"BLD",3128,"KRN",101,"NM","B","TIU BROWSE ACTION PRINT",10)

"BLD",3128,"KRN",101,"NM","B","TIU BROWSE ACTION SEARCH",11)

"BLD",3128,"KRN",101,"NM","B","TIU BROWSE MENU DICTATION",4)

"BLD",3128,"KRN",101,"NM","B","TIU BROWSE MENU TRANSCRIPTION",13)

"BLD",3128,"KRN",409.61,0)
409.61
"BLD",3128,"KRN",409.61,"NM",0)
^9.68A^7^7
"BLD",3128,"KRN",409.61,"NM",1,0)
TIU REVIEW UNDICTATED DOCS^^0
"BLD",3128,"KRN",409.61,"NM",2,0)
TIU DOCUMENT DICTATED^^0
"BLD",3128,"KRN",409.61,"NM",3,0)
TIU REVIEW UNTRANSCRIBED DOCS^^0
"BLD",3128,"KRN",409.61,"NM",4,0)
TIU BROWSE FOR TRANSCRIPTION^^0
"BLD",3128,"KRN",409.61,"NM",5,0)
TIU REVIEW SCREEN CLINICIAN^^0
"BLD",3128,"KRN",409.61,"NM",6,0)
TIU SEARCH LIST MGR^^0
"BLD",3128,"KRN",409.61,"NM",7,0)
TIU SEARCH LIST MRT^^0
"BLD",3128,"KRN",409.61,"NM","B","TIU BROWSE FOR TRANSCRIPTION",4)

"BLD",3128,"KRN",409.61,"NM","B","TIU DOCUMENT DICTATED",2)

"BLD",3128,"KRN",409.61,"NM","B","TIU REVIEW SCREEN CLINICIAN",5)

"BLD",3128,"KRN",409.61,"NM","B","TIU REVIEW UNDICTATED DOCS",1)

"BLD",3128,"KRN",409.61,"NM","B","TIU REVIEW UNTRANSCRIBED DOCS",3)

"BLD",3128,"KRN",409.61,"NM","B","TIU SEARCH LIST MGR",6)

"BLD",3128,"KRN",409.61,"NM","B","TIU SEARCH LIST MRT",7)

"BLD",3128,"KRN",771,0)
771
"BLD",3128,"KRN",771,"NM",0)
^9.68A^^
"BLD",3128,"KRN",870,0)
870
"BLD",3128,"KRN",8994,0)
8994
"BLD",3128,"KRN",8994,"NM",0)
^9.68A^4^4
"BLD",3128,"KRN",8994,"NM",1,0)
TIU GET DOCUMENTS FOR REQUEST^^0
"BLD",3128,"KRN",8994,"NM",2,0)
TIU IS THIS A SURGERY?^^0
"BLD",3128,"KRN",8994,"NM",3,0)
TIU IDENTIFY SURGERY CLASS^^0
"BLD",3128,"KRN",8994,"NM",4,0)
TIU LONG LIST SURGERY TITLES^^0
"BLD",3128,"KRN",8994,"NM","B","TIU GET DOCUMENTS FOR REQUEST",1)

"BLD",3128,"KRN",8994,"NM","B","TIU IDENTIFY SURGERY CLASS",3)

"BLD",3128,"KRN",8994,"NM","B","TIU IS THIS A SURGERY?",2)

"BLD",3128,"KRN",8994,"NM","B","TIU LONG LIST SURGERY TITLES",4)

"BLD",3128,"KRN","B",.4,.4)

"BLD",3128,"KRN","B",.401,.401)

"BLD",3128,"KRN","B",.402,.402)

"BLD",3128,"KRN","B",.403,.403)

"BLD",3128,"KRN","B",.5,.5)

"BLD",3128,"KRN","B",.84,.84)

"BLD",3128,"KRN","B",3.6,3.6)

"BLD",3128,"KRN","B",3.8,3.8)

"BLD",3128,"KRN","B",9.2,9.2)

"BLD",3128,"KRN","B",9.8,9.8)

"BLD",3128,"KRN","B",19,19)

"BLD",3128,"KRN","B",19.1,19.1)

"BLD",3128,"KRN","B",101,101)

"BLD",3128,"KRN","B",409.61,409.61)

"BLD",3128,"KRN","B",771,771)

"BLD",3128,"KRN","B",870,870)

"BLD",3128,"KRN","B",8994,8994)

"BLD",3128,"PRE")
TIUEC112
"BLD",3128,"QUES",0)
^9.62^^
"BLD",3128,"REQB",0)
^9.611^15^11
"BLD",3128,"REQB",2,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",3128,"REQB",5,0)
PXRM*1.5*7^2
"BLD",3128,"REQB",7,0)
TIU*1.0*61^2
"BLD",3128,"REQB",8,0)
TIU*1.0*100^2
"BLD",3128,"REQB",9,0)
TIU*1.0*109^2
"BLD",3128,"REQB",10,0)
TIU*1.0*115^2
"BLD",3128,"REQB",11,0)
TIU*1.0*123^2
"BLD",3128,"REQB",12,0)
TIU*1.0*131^2
"BLD",3128,"REQB",13,0)
TIU*1.0*124^2
"BLD",3128,"REQB",14,0)
TIU*1.0*162^2
"BLD",3128,"REQB",15,0)
TIU*1.0*154^2
"BLD",3128,"REQB","B","PXRM*1.5*7",5)

"BLD",3128,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",2)

"BLD",3128,"REQB","B","TIU*1.0*100",8)

"BLD",3128,"REQB","B","TIU*1.0*109",9)

"BLD",3128,"REQB","B","TIU*1.0*115",10)

"BLD",3128,"REQB","B","TIU*1.0*123",11)

"BLD",3128,"REQB","B","TIU*1.0*124",13)

"BLD",3128,"REQB","B","TIU*1.0*131",12)

"BLD",3128,"REQB","B","TIU*1.0*154",15)

"BLD",3128,"REQB","B","TIU*1.0*162",14)

"BLD",3128,"REQB","B","TIU*1.0*61",7)

"DATA",811.8,2,0)
TIU*1*112 20040325^BAKKE,ANDREW at ALBANY^3040325.142047
"DATA",811.8,2,100,0)
^811.801A^508^508
"DATA",811.8,2,100,1,0)
<?xml version="1.0" standalone="yes"?>
"DATA",811.8,2,100,2,0)
<REMINDER_EXCHANGE_FILE_ENTRY>
"DATA",811.8,2,100,3,0)
<PACKAGE_VERSION>1.5</PACKAGE_VERSION>
"DATA",811.8,2,100,4,0)
<INDEX_AT>446</INDEX_AT>
"DATA",811.8,2,100,5,0)
<SOURCE>
"DATA",811.8,2,100,6,0)
<NAME>TIU*1*112 20040325</NAME>
"DATA",811.8,2,100,7,0)
<USER>BAKKE,ANDREW</USER>
"DATA",811.8,2,100,8,0)
<SITE>ALBANY</SITE>
"DATA",811.8,2,100,9,0)
<DATE_PACKED>03/25/2004@14:20:47</DATE_PACKED>
"DATA",811.8,2,100,10,0)
</SOURCE>
"DATA",811.8,2,100,11,0)
<DESCRIPTION><![CDATA[
"DATA",811.8,2,100,12,0)
Document definition heirarcy for TIU/Surgery.
"DATA",811.8,2,100,13,0)
]]></DESCRIPTION>
"DATA",811.8,2,100,14,0)
<KEYWORDS>
"DATA",811.8,2,100,15,0)
<KEYWORD>TIU</KEYWORD>
"DATA",811.8,2,100,16,0)
<KEYWORD>SURGERY</KEYWORD>
"DATA",811.8,2,100,17,0)
<KEYWORD>INTERFACE</KEYWORD>
"DATA",811.8,2,100,18,0)
</KEYWORDS>
"DATA",811.8,2,100,19,0)
<FILEMAN_FILE>
"DATA",811.8,2,100,20,0)
<FILE_NAME>TIU DOCUMENT DEFINITION</FILE_NAME>
"DATA",811.8,2,100,21,0)
<FILE_NUMBER>8925.1</FILE_NUMBER>
"DATA",811.8,2,100,22,0)
<POINT_01>ANESTHESIA REPORT</POINT_01>
"DATA",811.8,2,100,23,0)
<INTERNAL_ENTRY_NUMBER>621</INTERNAL_ENTRY_NUMBER>
"DATA",811.8,2,100,24,0)
<FILEMAN_FDA>
"DATA",811.8,2,100,25,0)
<![CDATA[
"DATA",811.8,2,100,26,0)
8925.1;+621,;.01~ANESTHESIA REPORT
"DATA",811.8,2,100,27,0)
8925.1;+621,;.02~ANES
"DATA",811.8,2,100,28,0)
8925.1;+621,;.03~ANESTHESIA REPORT
"DATA",811.8,2,100,29,0)
8925.1;+621,;.04~TITLE
"DATA",811.8,2,100,30,0)
8925.1;+621,;.06~CLINICAL COORDINATOR
"DATA",811.8,2,100,31,0)
8925.1;+621,;.07~ACTIVE
"DATA",811.8,2,100,32,0)
8925.1;+621,;.13~YES
"DATA",811.8,2,100,33,0)
8925.1;+621,;3.02~YES
"DATA",811.8,2,100,34,0)
8925.1;+621,;3.03~NO
"DATA",811.8,2,100,35,0)
8925.1;+621,;99~59618,55007
"DATA",811.8,2,100,36,0)
]]>
"DATA",811.8,2,100,37,0)
</FILEMAN_FDA>
"DATA",811.8,2,100,38,0)
</FILEMAN_FILE>
"DATA",811.8,2,100,39,0)
<FILEMAN_FILE>
"DATA",811.8,2,100,40,0)
<FILE_NAME>TIU DOCUMENT DEFINITION</FILE_NAME>
"DATA",811.8,2,100,41,0)
<FILE_NUMBER>8925.1</FILE_NUMBER>
"DATA",811.8,2,100,42,0)
<POINT_01>ANESTHESIA REPORTS</POINT_01>
"DATA",811.8,2,100,43,0)
<INTERNAL_ENTRY_NUMBER>624</INTERNAL_ENTRY_NUMBER>
"DATA",811.8,2,100,44,0)
<FILEMAN_FDA>
"DATA",811.8,2,100,45,0)
<![CDATA[
"DATA",811.8,2,100,46,0)
8925.1;+624,;.01~ANESTHESIA REPORTS
"DATA",811.8,2,100,47,0)
8925.1;+624,;.02~ANRS
"DATA",811.8,2,100,48,0)
8925.1;+624,;.03~ANESTHESIA REPORTS
"DATA",811.8,2,100,49,0)
8925.1;+624,;.04~DOCUMENT CLASS
"DATA",811.8,2,100,50,0)
8925.1;+624,;.06~CLINICAL COORDINATOR
"DATA",811.8,2,100,51,0)
8925.1;+624,;.07~ACTIVE
"DATA",811.8,2,100,52,0)
8925.1;+624,;.13~YES
"DATA",811.8,2,100,53,0)
8925.1;+624,;3.02~YES
"DATA",811.8,2,100,54,0)
8925.1;+624,;3.03~NO
"DATA",811.8,2,100,55,0)
8925.1;+624,;4.4~D ANESTIUSROI1(TIUDA)
"DATA",811.8,2,100,56,0)
8925.1;+624,;6.1~Anesthesia Report
"DATA",811.8,2,100,57,0)
8925.1;+624,;6.12~Vice SF 517
"DATA",811.8,2,100,58,0)
8925.1;+624,;6.13~3
"DATA",811.8,2,100,59,0)
8925.1;+624,;99~59618,55009
"DATA",811.8,2,100,60,0)
8925.14;+1,+624,;.01~ANESTHESIA REPORT
"DATA",811.8,2,100,61,0)
8925.14;+1,+624,;4~Anesthesia Report
"DATA",811.8,2,100,62,0)
]]>
"DATA",811.8,2,100,63,0)
</FILEMAN_FDA>
"DATA",811.8,2,100,64,0)
<IEN_ROOT>
"DATA",811.8,2,100,65,0)
<![CDATA[
"DATA",811.8,2,100,66,0)
11
"DATA",811.8,2,100,67,0)
]]>
"DATA",811.8,2,100,68,0)
</IEN_ROOT>
"DATA",811.8,2,100,69,0)
</FILEMAN_FILE>
"DATA",811.8,2,100,70,0)
<FILEMAN_FILE>
"DATA",811.8,2,100,71,0)
<FILE_NAME>TIU DOCUMENT DEFINITION</FILE_NAME>
"DATA",811.8,2,100,72,0)
<FILE_NUMBER>8925.1</FILE_NUMBER>
"DATA",811.8,2,100,73,0)
<POINT_01>NURSE INTRAOPERATIVE REPORT</POINT_01>
"DATA",811.8,2,100,74,0)
<INTERNAL_ENTRY_NUMBER>620</INTERNAL_ENTRY_NUMBER>
"DATA",811.8,2,100,75,0)
<FILEMAN_FDA>
"DATA",811.8,2,100,76,0)
<![CDATA[
"DATA",811.8,2,100,77,0)
8925.1;+620,;.01~NURSE INTRAOPERATIVE REPORT
"DATA",811.8,2,100,78,0)
8925.1;+620,;.02~NRP
"DATA",811.8,2,100,79,0)
8925.1;+620,;.03~NURSE INTRAOPERATIVE REPORT
"DATA",811.8,2,100,80,0)
8925.1;+620,;.04~TITLE
"DATA",811.8,2,100,81,0)
8925.1;+620,;.06~CLINICAL COORDINATOR
"DATA",811.8,2,100,82,0)
8925.1;+620,;.07~ACTIVE
"DATA",811.8,2,100,83,0)
8925.1;+620,;.13~YES
"DATA",811.8,2,100,84,0)
8925.1;+620,;3.02~YES
"DATA",811.8,2,100,85,0)
8925.1;+620,;3.03~NO
"DATA",811.8,2,100,86,0)
8925.1;+620,;99~59618,55011
"DATA",811.8,2,100,87,0)
]]>
"DATA",811.8,2,100,88,0)
</FILEMAN_FDA>
"DATA",811.8,2,100,89,0)
</FILEMAN_FILE>
"DATA",811.8,2,100,90,0)
<FILEMAN_FILE>
"DATA",811.8,2,100,91,0)
<FILE_NAME>TIU DOCUMENT DEFINITION</FILE_NAME>
"DATA",811.8,2,100,92,0)
<FILE_NUMBER>8925.1</FILE_NUMBER>
"DATA",811.8,2,100,93,0)
<POINT_01>NURSE INTRAOPERATIVE REPORTS</POINT_01>
"DATA",811.8,2,100,94,0)
<INTERNAL_ENTRY_NUMBER>623</INTERNAL_ENTRY_NUMBER>
"DATA",811.8,2,100,95,0)
<FILEMAN_FDA>
"DATA",811.8,2,100,96,0)
<![CDATA[
"DATA",811.8,2,100,97,0)
8925.1;+623,;.01~NURSE INTRAOPERATIVE REPORTS
"DATA",811.8,2,100,98,0)
8925.1;+623,;.02~NIRS
"DATA",811.8,2,100,99,0)
8925.1;+623,;.03~NURSE INTRAOPERATIVE REPORTS
"DATA",811.8,2,100,100,0)
8925.1;+623,;.04~DOCUMENT CLASS
"DATA",811.8,2,100,101,0)
8925.1;+623,;.06~CLINICAL COORDINATOR
"DATA",811.8,2,100,102,0)
8925.1;+623,;.07~ACTIVE
"DATA",811.8,2,100,103,0)
8925.1;+623,;.13~YES
"DATA",811.8,2,100,104,0)
8925.1;+623,;3.02~YES
"DATA",811.8,2,100,105,0)
8925.1;+623,;3.03~NO
"DATA",811.8,2,100,106,0)
8925.1;+623,;4.4~D NURSTIUSROI1(TIUDA)
"DATA",811.8,2,100,107,0)
8925.1;+623,;6.1~Nurse Intraoperative Report
"DATA",811.8,2,100,108,0)
8925.1;+623,;6.12~Vice SF 509
"DATA",811.8,2,100,109,0)
8925.1;+623,;6.13~2
"DATA",811.8,2,100,110,0)
8925.1;+623,;99~59618,55012
"DATA",811.8,2,100,111,0)
8925.14;+1,+623,;.01~NURSE INTRAOPERATIVE REPORT
"DATA",811.8,2,100,112,0)
8925.14;+1,+623,;4~Nurse Intraoperative
"DATA",811.8,2,100,113,0)
]]>
"DATA",811.8,2,100,114,0)
</FILEMAN_FDA>
"DATA",811.8,2,100,115,0)
<IEN_ROOT>
"DATA",811.8,2,100,116,0)
<![CDATA[
"DATA",811.8,2,100,117,0)
11
"DATA",811.8,2,100,118,0)
]]>
"DATA",811.8,2,100,119,0)
</IEN_ROOT>
"DATA",811.8,2,100,120,0)
</FILEMAN_FILE>
"DATA",811.8,2,100,121,0)
<FILEMAN_FILE>
"DATA",811.8,2,100,122,0)
<FILE_NAME>TIU DOCUMENT DEFINITION</FILE_NAME>
"DATA",811.8,2,100,123,0)
<FILE_NUMBER>8925.1</FILE_NUMBER>
"DATA",811.8,2,100,124,0)
<POINT_01>OPERATION REPORT</POINT_01>
"DATA",811.8,2,100,125,0)
<INTERNAL_ENTRY_NUMBER>619</INTERNAL_ENTRY_NUMBER>
"DATA",811.8,2,100,126,0)
<FILEMAN_FDA>
"DATA",811.8,2,100,127,0)
<![CDATA[
"DATA",811.8,2,100,128,0)
8925.1;+619,;.01~OPERATION REPORT
"DATA",811.8,2,100,129,0)
8925.1;+619,;.02~ORPT
"DATA",811.8,2,100,130,0)
8925.1;+619,;.03~OPERATION REPORT
"DATA",811.8,2,100,131,0)
8925.1;+619,;.04~TITLE
"DATA",811.8,2,100,132,0)
8925.1;+619,;.06~CLINICAL COORDINATOR
"DATA",811.8,2,100,133,0)
8925.1;+619,;.07~ACTIVE
"DATA",811.8,2,100,134,0)
8925.1;+619,;.13~YES
"DATA",811.8,2,100,135,0)
8925.1;+619,;1.01~TIU DOCUMENT
"DATA",811.8,2,100,136,0)
8925.1;+619,;1.02~NO
"DATA",811.8,2,100,137,0)
8925.1;+619,;1.03~2;TEXT
"DATA",811.8,2,100,138,0)
8925.1;+619,;3.02~YES
"DATA",811.8,2,100,139,0)
8925.1;+619,;3.03~NO
"DATA",811.8,2,100,140,0)
8925.1;+619,;4~D LOOKUPTIUPUTS
"DATA",811.8,2,100,141,0)
8925.1;+619,;4.5~D FOLLOWUPTIUPUTS(+$G(TIUREC("#")))
"DATA",811.8,2,100,142,0)
8925.1;+619,;4.8~D FIXTIUPUTS
"DATA",811.8,2,100,143,0)
8925.1;+619,;6~D ENTRYSROESPR
"DATA",811.8,2,100,144,0)
8925.1;+619,;6.5~D GETOPTIUSROI(.TIUY,TIUDA,"OP")
"DATA",811.8,2,100,145,0)
8925.1;+619,;99~59618,55013
"DATA",811.8,2,100,146,0)
8925.12;+1,+619,;.01~PATIENT NAME
"DATA",811.8,2,100,147,0)
8925.12;+1,+619,;.02~PT NAME
"DATA",811.8,2,100,148,0)
8925.12;+1,+619,;.03~.02
"DATA",811.8,2,100,149,0)
8925.12;+1,+619,;.05~DOE,JOHN B.
"DATA",811.8,2,100,150,0)
8925.12;+1,+619,;.06~YES
"DATA",811.8,2,100,151,0)
8925.12;+1,+619,;.07~NO
"DATA",811.8,2,100,152,0)
8925.12;+10,+619,;.01~DICTATION DATE
"DATA",811.8,2,100,153,0)
8925.12;+10,+619,;.02~DICTATION DATE
"DATA",811.8,2,100,154,0)
8925.12;+10,+619,;.03~1307
"DATA",811.8,2,100,155,0)
8925.12;+10,+619,;.05~04/28/2001
"DATA",811.8,2,100,156,0)
8925.12;+10,+619,;.06~NO
"DATA",811.8,2,100,157,0)
8925.12;+10,+619,;.07~YES
"DATA",811.8,2,100,158,0)
8925.12;+2,+619,;.01~TRANSCRIPTIONIST
"DATA",811.8,2,100,159,0)
8925.12;+2,+619,;.02~TRANSCRIPTIONIST ID
"DATA",811.8,2,100,160,0)
8925.12;+2,+619,;.03~1302
"DATA",811.8,2,100,161,0)
8925.12;+2,+619,;.05~T1212
"DATA",811.8,2,100,162,0)
8925.12;+2,+619,;.06~NO
"DATA",811.8,2,100,163,0)
8925.12;+2,+619,;.07~NO
"DATA",811.8,2,100,164,0)
8925.12;+3,+619,;.01~PATIENT SSN
"DATA",811.8,2,100,165,0)
8925.12;+3,+619,;.02~PT SSN
"DATA",811.8,2,100,166,0)
8925.12;+3,+619,;.03~.02
"DATA",811.8,2,100,167,0)
8925.12;+3,+619,;.04~TIUSSN
"DATA",811.8,2,100,168,0)
8925.12;+3,+619,;.05~***********
"DATA",811.8,2,100,169,0)
8925.12;+3,+619,;.06~YES
"DATA",811.8,2,100,170,0)
8925.12;+3,+619,;.07~YES
"DATA",811.8,2,100,171,0)
8925.12;+3,+619,;1~S X=$TR(X,"-/","")
"DATA",811.8,2,100,172,0)
8925.12;+4,+619,;.01~DOCUMENT NUMBER
"DATA",811.8,2,100,173,0)
8925.12;+4,+619,;.02~DOCUMENT NUMBER
"DATA",811.8,2,100,174,0)
8925.12;+4,+619,;.03~.001
"DATA",811.8,2,100,175,0)
8925.12;+4,+619,;.04~TIUSDA
"DATA",811.8,2,100,176,0)
8925.12;+4,+619,;.05~134567
"DATA",811.8,2,100,177,0)
8925.12;+4,+619,;.06~YES
"DATA",811.8,2,100,178,0)
8925.12;+4,+619,;.07~NO
"DATA",811.8,2,100,179,0)
8925.12;+5,+619,;.01~SURGICAL CASE
"DATA",811.8,2,100,180,0)
8925.12;+5,+619,;.02~SURGICAL CASE
"DATA",811.8,2,100,181,0)
8925.12;+5,+619,;.03~1405
"DATA",811.8,2,100,182,0)
8925.12;+5,+619,;.04~TIUSRCN
"DATA",811.8,2,100,183,0)
8925.12;+5,+619,;.05~143342
"DATA",811.8,2,100,184,0)
8925.12;+5,+619,;.06~YES
"DATA",811.8,2,100,185,0)
8925.12;+5,+619,;.07~NO
"DATA",811.8,2,100,186,0)
8925.12;+5,+619,;1~S X="S.`"_X
"DATA",811.8,2,100,187,0)
8925.12;+6,+619,;.01~OPERATION DATE
"DATA",811.8,2,100,188,0)
8925.12;+6,+619,;.02~OPERATION DATE
"DATA",811.8,2,100,189,0)
8925.12;+6,+619,;.03~.07
"DATA",811.8,2,100,190,0)
8925.12;+6,+619,;.04~TIUODT
"DATA",811.8,2,100,191,0)
8925.12;+6,+619,;.05~04/29/2001
"DATA",811.8,2,100,192,0)
8925.12;+6,+619,;.06~YES
"DATA",811.8,2,100,193,0)
8925.12;+6,+619,;.07~YES
"DATA",811.8,2,100,194,0)
8925.12;+6,+619,;1~S X=$$IDATETIULC(X)
"DATA",811.8,2,100,195,0)
8925.12;+7,+619,;.01~DICTATED BY
"DATA",811.8,2,100,196,0)
8925.12;+7,+619,;.02~DICTATING SURGEON
"DATA",811.8,2,100,197,0)
8925.12;+7,+619,;.03~1202
"DATA",811.8,2,100,198,0)
8925.12;+7,+619,;.05~CASEY,BEN
"DATA",811.8,2,100,199,0)
8925.12;+7,+619,;.06~YES
"DATA",811.8,2,100,200,0)
8925.12;+7,+619,;.07~YES
"DATA",811.8,2,100,201,0)
8925.12;+8,+619,;.01~ATTENDING SURGEON
"DATA",811.8,2,100,202,0)
8925.12;+8,+619,;.02~ATTENDING SURGEON
"DATA",811.8,2,100,203,0)
8925.12;+8,+619,;.03~1209
"DATA",811.8,2,100,204,0)
8925.12;+8,+619,;.05~WELBY,MARCUS
"DATA",811.8,2,100,205,0)
8925.12;+8,+619,;.06~YES
"DATA",811.8,2,100,206,0)
8925.12;+8,+619,;.07~YES
"DATA",811.8,2,100,207,0)
8925.12;+9,+619,;.01~URGENCY
"DATA",811.8,2,100,208,0)
8925.12;+9,+619,;.02~STAT or ROUTINE
"DATA",811.8,2,100,209,0)
8925.12;+9,+619,;.03~.09
"DATA",811.8,2,100,210,0)
8925.12;+9,+619,;.05~PRIORITY
"DATA",811.8,2,100,211,0)
8925.12;+9,+619,;.06~YES
"DATA",811.8,2,100,212,0)
8925.12;+9,+619,;.07~NO
"DATA",811.8,2,100,213,0)
]]>
"DATA",811.8,2,100,214,0)
</FILEMAN_FDA>
"DATA",811.8,2,100,215,0)
<IEN_ROOT>
"DATA",811.8,2,100,216,0)
<![CDATA[
"DATA",811.8,2,100,217,0)
11
"DATA",811.8,2,100,218,0)
210
"DATA",811.8,2,100,219,0)
32
"DATA",811.8,2,100,220,0)
43
"DATA",811.8,2,100,221,0)
54
"DATA",811.8,2,100,222,0)
65
"DATA",811.8,2,100,223,0)
76
"DATA",811.8,2,100,224,0)
87
"DATA",811.8,2,100,225,0)
98
"DATA",811.8,2,100,226,0)
109
"DATA",811.8,2,100,227,0)
]]>
"DATA",811.8,2,100,228,0)
</IEN_ROOT>
"DATA",811.8,2,100,229,0)
</FILEMAN_FILE>
"DATA",811.8,2,100,230,0)
<FILEMAN_FILE>
"DATA",811.8,2,100,231,0)
<FILE_NAME>TIU DOCUMENT DEFINITION</FILE_NAME>
"DATA",811.8,2,100,232,0)
<FILE_NUMBER>8925.1</FILE_NUMBER>
"DATA",811.8,2,100,233,0)
<POINT_01>OPERATION REPORTS</POINT_01>
"DATA",811.8,2,100,234,0)
<INTERNAL_ENTRY_NUMBER>622</INTERNAL_ENTRY_NUMBER>
"DATA",811.8,2,100,235,0)
<FILEMAN_FDA>
"DATA",811.8,2,100,236,0)
<![CDATA[
"DATA",811.8,2,100,237,0)
8925.1;+622,;.01~OPERATION REPORTS
"DATA",811.8,2,100,238,0)
8925.1;+622,;.02~OPR
"DATA",811.8,2,100,239,0)
8925.1;+622,;.03~OPERATION REPORTS
"DATA",811.8,2,100,240,0)
8925.1;+622,;.04~DOCUMENT CLASS
"DATA",811.8,2,100,241,0)
8925.1;+622,;.06~CLINICAL COORDINATOR
"DATA",811.8,2,100,242,0)
8925.1;+622,;.07~ACTIVE
"DATA",811.8,2,100,243,0)
8925.1;+622,;.13~YES
"DATA",811.8,2,100,244,0)
8925.1;+622,;3.02~YES
"DATA",811.8,2,100,245,0)
8925.1;+622,;4.4~D RBORTIUSROI(TIUDA)
"DATA",811.8,2,100,246,0)
8925.1;+622,;4.45~D CHANGETIUSROI1(TIUDA)
"DATA",811.8,2,100,247,0)
8925.1;+622,;6.1~Operation Report
"DATA",811.8,2,100,248,0)
8925.1;+622,;6.12~Vice SF 516
"DATA",811.8,2,100,249,0)
8925.1;+622,;6.13~1
"DATA",811.8,2,100,250,0)
8925.1;+622,;99~59618,55014
"DATA",811.8,2,100,251,0)
8925.14;+1,+622,;.01~OPERATION REPORT
"DATA",811.8,2,100,252,0)
8925.14;+1,+622,;4~Operation Report
"DATA",811.8,2,100,253,0)
]]>
"DATA",811.8,2,100,254,0)
</FILEMAN_FDA>
"DATA",811.8,2,100,255,0)
<IEN_ROOT>
"DATA",811.8,2,100,256,0)
<![CDATA[
"DATA",811.8,2,100,257,0)
11
"DATA",811.8,2,100,258,0)
]]>
"DATA",811.8,2,100,259,0)
</IEN_ROOT>
"DATA",811.8,2,100,260,0)
</FILEMAN_FILE>
"DATA",811.8,2,100,261,0)
<FILEMAN_FILE>
"DATA",811.8,2,100,262,0)
<FILE_NAME>TIU DOCUMENT DEFINITION</FILE_NAME>
"DATA",811.8,2,100,263,0)
<FILE_NUMBER>8925.1</FILE_NUMBER>
"DATA",811.8,2,100,264,0)
<POINT_01>PROCEDURE REPORT</POINT_01>
"DATA",811.8,2,100,265,0)
<INTERNAL_ENTRY_NUMBER>618</INTERNAL_ENTRY_NUMBER>
"DATA",811.8,2,100,266,0)
<FILEMAN_FDA>
"DATA",811.8,2,100,267,0)
<![CDATA[
"DATA",811.8,2,100,268,0)
8925.1;+618,;.01~PROCEDURE REPORT
"DATA",811.8,2,100,269,0)
8925.1;+618,;.02~PR
"DATA",811.8,2,100,270,0)
8925.1;+618,;.03~PROCEDURE REPORT
"DATA",811.8,2,100,271,0)
8925.1;+618,;.04~TITLE
"DATA",811.8,2,100,272,0)
8925.1;+618,;.06~CLINICAL COORDINATOR
"DATA",811.8,2,100,273,0)
8925.1;+618,;.07~ACTIVE
"DATA",811.8,2,100,274,0)
8925.1;+618,;.13~YES
"DATA",811.8,2,100,275,0)
8925.1;+618,;1.01~TIU DOCUMENT
"DATA",811.8,2,100,276,0)
8925.1;+618,;1.02~NO
"DATA",811.8,2,100,277,0)
8925.1;+618,;1.03~2;TEXT
"DATA",811.8,2,100,278,0)
8925.1;+618,;3.02~YES
"DATA",811.8,2,100,279,0)
8925.1;+618,;3.03~NO
"DATA",811.8,2,100,280,0)
8925.1;+618,;4~D LOOKUPTIUPUTS
"DATA",811.8,2,100,281,0)
8925.1;+618,;4.5~D FOLLOWUPTIUPUTS(+$G(TIUREC("#")))
"DATA",811.8,2,100,282,0)
8925.1;+618,;4.8~D FIXTIUPUTS
"DATA",811.8,2,100,283,0)
8925.1;+618,;6~D ENTRYSROESPR
"DATA",811.8,2,100,284,0)
8925.1;+618,;99~59618,55016
"DATA",811.8,2,100,285,0)
8925.12;+1,+618,;.01~PATIENT NAME
"DATA",811.8,2,100,286,0)
8925.12;+1,+618,;.02~PT NAME
"DATA",811.8,2,100,287,0)
8925.12;+1,+618,;.03~.02
"DATA",811.8,2,100,288,0)
8925.12;+1,+618,;.05~DOE, JOHN B.
"DATA",811.8,2,100,289,0)
8925.12;+1,+618,;.06~YES
"DATA",811.8,2,100,290,0)
8925.12;+1,+618,;.07~NO
"DATA",811.8,2,100,291,0)
8925.12;+10,+618,;.01~DICTATION DATE
"DATA",811.8,2,100,292,0)
8925.12;+10,+618,;.02~DICTATION DATE
"DATA",811.8,2,100,293,0)
8925.12;+10,+618,;.03~1307
"DATA",811.8,2,100,294,0)
8925.12;+10,+618,;.05~01/11/2002
"DATA",811.8,2,100,295,0)
8925.12;+10,+618,;.06~YES
"DATA",811.8,2,100,296,0)
8925.12;+10,+618,;.07~YES
"DATA",811.8,2,100,297,0)
8925.12;+2,+618,;.01~TRANSCRIPTIONIST
"DATA",811.8,2,100,298,0)
8925.12;+2,+618,;.02~TRANSCRIPTIONIST ID
"DATA",811.8,2,100,299,0)
8925.12;+2,+618,;.03~1302
"DATA",811.8,2,100,300,0)
8925.12;+2,+618,;.05~T2121
"DATA",811.8,2,100,301,0)
8925.12;+2,+618,;.06~NO
"DATA",811.8,2,100,302,0)
8925.12;+2,+618,;.07~NO
"DATA",811.8,2,100,303,0)
8925.12;+3,+618,;.01~PATIENT SSN
"DATA",811.8,2,100,304,0)
8925.12;+3,+618,;.02~PT SSN
"DATA",811.8,2,100,305,0)
8925.12;+3,+618,;.03~.02
"DATA",811.8,2,100,306,0)
8925.12;+3,+618,;.04~TIUSSN
"DATA",811.8,2,100,307,0)
8925.12;+3,+618,;.05~***********
"DATA",811.8,2,100,308,0)
8925.12;+3,+618,;.06~YES
"DATA",811.8,2,100,309,0)
8925.12;+3,+618,;.07~YES
"DATA",811.8,2,100,310,0)
8925.12;+3,+618,;1~S X=$TR(X,"-/","")
"DATA",811.8,2,100,311,0)
8925.12;+4,+618,;.01~DOCUMENT NUMBER
"DATA",811.8,2,100,312,0)
8925.12;+4,+618,;.02~DOCUMENT NUMBER
"DATA",811.8,2,100,313,0)
8925.12;+4,+618,;.03~.001
"DATA",811.8,2,100,314,0)
8925.12;+4,+618,;.04~TIUSDA
"DATA",811.8,2,100,315,0)
8925.12;+4,+618,;.05~134567
"DATA",811.8,2,100,316,0)
8925.12;+4,+618,;.06~YES
"DATA",811.8,2,100,317,0)
8925.12;+4,+618,;.07~NO
"DATA",811.8,2,100,318,0)
8925.12;+5,+618,;.01~SURGICAL CASE
"DATA",811.8,2,100,319,0)
8925.12;+5,+618,;.02~SURGICAL CASE
"DATA",811.8,2,100,320,0)
8925.12;+5,+618,;.03~1405
"DATA",811.8,2,100,321,0)
8925.12;+5,+618,;.04~TIUSRCN
"DATA",811.8,2,100,322,0)
8925.12;+5,+618,;.05~14335
"DATA",811.8,2,100,323,0)
8925.12;+5,+618,;.06~YES
"DATA",811.8,2,100,324,0)
8925.12;+5,+618,;.07~NO
"DATA",811.8,2,100,325,0)
8925.12;+5,+618,;1~S X="S.'"_X
"DATA",811.8,2,100,326,0)
8925.12;+6,+618,;.01~OPERATION DATE
"DATA",811.8,2,100,327,0)
8925.12;+6,+618,;.02~OPERATION DATE
"DATA",811.8,2,100,328,0)
8925.12;+6,+618,;.03~.07
"DATA",811.8,2,100,329,0)
8925.12;+6,+618,;.04~TIUODT
"DATA",811.8,2,100,330,0)
8925.12;+6,+618,;.05~01/11/2002
"DATA",811.8,2,100,331,0)
8925.12;+6,+618,;.06~YES
"DATA",811.8,2,100,332,0)
8925.12;+6,+618,;.07~YES
"DATA",811.8,2,100,333,0)
8925.12;+7,+618,;.01~DICTATED BY
"DATA",811.8,2,100,334,0)
8925.12;+7,+618,;.02~DICTATING SURGEON
"DATA",811.8,2,100,335,0)
8925.12;+7,+618,;.03~1202
"DATA",811.8,2,100,336,0)
8925.12;+7,+618,;.05~CASEY,BEN
"DATA",811.8,2,100,337,0)
8925.12;+7,+618,;.06~YES
"DATA",811.8,2,100,338,0)
8925.12;+7,+618,;.07~YES
"DATA",811.8,2,100,339,0)
8925.12;+8,+618,;.01~ATTENDING PHYSICIAN
"DATA",811.8,2,100,340,0)
8925.12;+8,+618,;.02~ATTENDING PHYSICIAN
"DATA",811.8,2,100,341,0)
8925.12;+8,+618,;.03~1209
"DATA",811.8,2,100,342,0)
8925.12;+8,+618,;.05~WELBY,MARCUS
"DATA",811.8,2,100,343,0)
8925.12;+8,+618,;.06~YES
"DATA",811.8,2,100,344,0)
8925.12;+8,+618,;.07~YES
"DATA",811.8,2,100,345,0)
8925.12;+9,+618,;.01~URGENCY
"DATA",811.8,2,100,346,0)
8925.12;+9,+618,;.02~STAT or ROUTINE
"DATA",811.8,2,100,347,0)
8925.12;+9,+618,;.03~.09
"DATA",811.8,2,100,348,0)
8925.12;+9,+618,;.05~PRIORITY
"DATA",811.8,2,100,349,0)
8925.12;+9,+618,;.06~YES
"DATA",811.8,2,100,350,0)
8925.12;+9,+618,;.07~NO
"DATA",811.8,2,100,351,0)
]]>
"DATA",811.8,2,100,352,0)
</FILEMAN_FDA>
"DATA",811.8,2,100,353,0)
<IEN_ROOT>
"DATA",811.8,2,100,354,0)
<![CDATA[
"DATA",811.8,2,100,355,0)
11
"DATA",811.8,2,100,356,0)
210
"DATA",811.8,2,100,357,0)
32
"DATA",811.8,2,100,358,0)
43
"DATA",811.8,2,100,359,0)
54
"DATA",811.8,2,100,360,0)
65
"DATA",811.8,2,100,361,0)
76
"DATA",811.8,2,100,362,0)
87
"DATA",811.8,2,100,363,0)
98
"DATA",811.8,2,100,364,0)
109
"DATA",811.8,2,100,365,0)
]]>
"DATA",811.8,2,100,366,0)
</IEN_ROOT>
"DATA",811.8,2,100,367,0)
</FILEMAN_FILE>
"DATA",811.8,2,100,368,0)
<FILEMAN_FILE>
"DATA",811.8,2,100,369,0)
<FILE_NAME>TIU DOCUMENT DEFINITION</FILE_NAME>
"DATA",811.8,2,100,370,0)
<FILE_NUMBER>8925.1</FILE_NUMBER>
"DATA",811.8,2,100,371,0)
<POINT_01>PROCEDURE REPORT (NON-O.R.)</POINT_01>
"DATA",811.8,2,100,372,0)
<INTERNAL_ENTRY_NUMBER>617</INTERNAL_ENTRY_NUMBER>
"DATA",811.8,2,100,373,0)
<FILEMAN_FDA>
"DATA",811.8,2,100,374,0)
<![CDATA[
"DATA",811.8,2,100,375,0)
8925.1;+617,;.01~PROCEDURE REPORT (NON-O.R.)
"DATA",811.8,2,100,376,0)
8925.1;+617,;.02~PRR
"DATA",811.8,2,100,377,0)
8925.1;+617,;.03~PROCEDURE REPORT (NON-O.R.)
"DATA",811.8,2,100,378,0)
8925.1;+617,;.04~DOCUMENT CLASS
"DATA",811.8,2,100,379,0)
8925.1;+617,;.06~CLINICAL COORDINATOR
"DATA",811.8,2,100,380,0)
8925.1;+617,;.07~ACTIVE
"DATA",811.8,2,100,381,0)
8925.1;+617,;.13~YES
"DATA",811.8,2,100,382,0)
8925.1;+617,;3.02~YES
"DATA",811.8,2,100,383,0)
8925.1;+617,;3.03~NO
"DATA",811.8,2,100,384,0)
8925.1;+617,;4.4~D RBPRTIUSROI(TIUDA)
"DATA",811.8,2,100,385,0)
8925.1;+617,;4.45~D CHANGETIUSROI1(TIUDA)
"DATA",811.8,2,100,386,0)
8925.1;+617,;6.1~Procedure Report
"DATA",811.8,2,100,387,0)
8925.1;+617,;6.12~Vice SF 509
"DATA",811.8,2,100,388,0)
8925.1;+617,;6.13~4
"DATA",811.8,2,100,389,0)
8925.1;+617,;6.5~D GETOPTIUSROI(.TIUY,TIUDA,"NORP")
"DATA",811.8,2,100,390,0)
8925.1;+617,;99~59618,55018
"DATA",811.8,2,100,391,0)
8925.14;+1,+617,;.01~PROCEDURE REPORT
"DATA",811.8,2,100,392,0)
8925.14;+1,+617,;4~Procedure Report
"DATA",811.8,2,100,393,0)
]]>
"DATA",811.8,2,100,394,0)
</FILEMAN_FDA>
"DATA",811.8,2,100,395,0)
<IEN_ROOT>
"DATA",811.8,2,100,396,0)
<![CDATA[
"DATA",811.8,2,100,397,0)
11
"DATA",811.8,2,100,398,0)
]]>
"DATA",811.8,2,100,399,0)
</IEN_ROOT>
"DATA",811.8,2,100,400,0)
</FILEMAN_FILE>
"DATA",811.8,2,100,401,0)
<FILEMAN_FILE>
"DATA",811.8,2,100,402,0)
<FILE_NAME>TIU DOCUMENT DEFINITION</FILE_NAME>
"DATA",811.8,2,100,403,0)
<FILE_NUMBER>8925.1</FILE_NUMBER>
"DATA",811.8,2,100,404,0)
<POINT_01>SURGICAL REPORTS</POINT_01>
"DATA",811.8,2,100,405,0)
<INTERNAL_ENTRY_NUMBER>616</INTERNAL_ENTRY_NUMBER>
"DATA",811.8,2,100,406,0)
<FILEMAN_FDA>
"DATA",811.8,2,100,407,0)
<![CDATA[
"DATA",811.8,2,100,408,0)
8925.1;+616,;.01~SURGICAL REPORTS
"DATA",811.8,2,100,409,0)
8925.1;+616,;.02~SRS
"DATA",811.8,2,100,410,0)
8925.1;+616,;.03~SURGICAL REPORTS
"DATA",811.8,2,100,411,0)
8925.1;+616,;.04~CLASS
"DATA",811.8,2,100,412,0)
8925.1;+616,;.06~CLINICAL COORDINATOR
"DATA",811.8,2,100,413,0)
8925.1;+616,;.07~ACTIVE
"DATA",811.8,2,100,414,0)
8925.1;+616,;.13~YES
"DATA",811.8,2,100,415,0)
8925.1;+616,;3.02~YES
"DATA",811.8,2,100,416,0)
8925.1;+616,;3.03~NO
"DATA",811.8,2,100,417,0)
8925.1;+616,;5~[TIU ENTER/EDIT SURGICAL REPORT]
"DATA",811.8,2,100,418,0)
8925.1;+616,;6~D ENTRYSROESPR
"DATA",811.8,2,100,419,0)
8925.1;+616,;6.14~NO
"DATA",811.8,2,100,420,0)
8925.1;+616,;7~D ENPNTIUVSIT(.TIU,.DFN,1)
"DATA",811.8,2,100,421,0)
8925.1;+616,;8~S TIUASK=$$CHEKPNTIULD(.TIU,.TIUBY)
"DATA",811.8,2,100,422,0)
8925.1;+616,;99~59618,55019
"DATA",811.8,2,100,423,0)
8925.14;+1,+616,;.01~OPERATION REPORTS
"DATA",811.8,2,100,424,0)
8925.14;+1,+616,;3~1
"DATA",811.8,2,100,425,0)
8925.14;+1,+616,;4~Operation Reports
"DATA",811.8,2,100,426,0)
8925.14;+2,+616,;.01~NURSE INTRAOPERATIVE REPORTS
"DATA",811.8,2,100,427,0)
8925.14;+2,+616,;3~5
"DATA",811.8,2,100,428,0)
8925.14;+2,+616,;4~Nurse Intraop Rep
"DATA",811.8,2,100,429,0)
8925.14;+3,+616,;.01~ANESTHESIA REPORTS
"DATA",811.8,2,100,430,0)
8925.14;+3,+616,;3~10
"DATA",811.8,2,100,431,0)
8925.14;+3,+616,;4~Anesthesia Reports
"DATA",811.8,2,100,432,0)
8925.14;+4,+616,;.01~PROCEDURE REPORT (NON-O.R.)
"DATA",811.8,2,100,433,0)
8925.14;+4,+616,;3~15
"DATA",811.8,2,100,434,0)
8925.14;+4,+616,;4~Proc Rep (non-OR)
"DATA",811.8,2,100,435,0)
]]>
"DATA",811.8,2,100,436,0)
</FILEMAN_FDA>
"DATA",811.8,2,100,437,0)
<IEN_ROOT>
"DATA",811.8,2,100,438,0)
<![CDATA[
"DATA",811.8,2,100,439,0)
14
"DATA",811.8,2,100,440,0)
25
"DATA",811.8,2,100,441,0)
36
"DATA",811.8,2,100,442,0)
47
"DATA",811.8,2,100,443,0)
]]>
"DATA",811.8,2,100,444,0)
</IEN_ROOT>
"DATA",811.8,2,100,445,0)
</FILEMAN_FILE>
"DATA",811.8,2,100,446,0)
<INDEX>
"DATA",811.8,2,100,447,0)
<NUMBER_OF_COMPONENTS>9</NUMBER_OF_COMPONENTS>
"DATA",811.8,2,100,448,0)
<COMPONENT>
"DATA",811.8,2,100,449,0)
<FDA_END>35</FDA_END>
"DATA",811.8,2,100,450,0)
<FDA_START>26</FDA_START>
"DATA",811.8,2,100,451,0)
<FILE_START>19</FILE_START>
"DATA",811.8,2,100,452,0)
</COMPONENT>
"DATA",811.8,2,100,453,0)
<COMPONENT>
"DATA",811.8,2,100,454,0)
<FDA_END>61</FDA_END>
"DATA",811.8,2,100,455,0)
<FDA_START>46</FDA_START>
"DATA",811.8,2,100,456,0)
<FILE_START>39</FILE_START>
"DATA",811.8,2,100,457,0)
<IEN_ROOT_END>66</IEN_ROOT_END>
"DATA",811.8,2,100,458,0)
<IEN_ROOT_START>66</IEN_ROOT_START>
"DATA",811.8,2,100,459,0)
</COMPONENT>
"DATA",811.8,2,100,460,0)
<COMPONENT>
"DATA",811.8,2,100,461,0)
<FDA_END>86</FDA_END>
"DATA",811.8,2,100,462,0)
<FDA_START>77</FDA_START>
"DATA",811.8,2,100,463,0)
<FILE_START>70</FILE_START>
"DATA",811.8,2,100,464,0)
</COMPONENT>
"DATA",811.8,2,100,465,0)
<COMPONENT>
"DATA",811.8,2,100,466,0)
<FDA_END>112</FDA_END>
"DATA",811.8,2,100,467,0)
<FDA_START>97</FDA_START>
"DATA",811.8,2,100,468,0)
<FILE_START>90</FILE_START>
"DATA",811.8,2,100,469,0)
<IEN_ROOT_END>117</IEN_ROOT_END>
"DATA",811.8,2,100,470,0)
<IEN_ROOT_START>117</IEN_ROOT_START>
"DATA",811.8,2,100,471,0)
</COMPONENT>
"DATA",811.8,2,100,472,0)
<COMPONENT>
"DATA",811.8,2,100,473,0)
<FDA_END>212</FDA_END>
"DATA",811.8,2,100,474,0)
<FDA_START>128</FDA_START>
"DATA",811.8,2,100,475,0)
<FILE_START>121</FILE_START>
"DATA",811.8,2,100,476,0)
<IEN_ROOT_END>226</IEN_ROOT_END>
"DATA",811.8,2,100,477,0)
<IEN_ROOT_START>217</IEN_ROOT_START>
"DATA",811.8,2,100,478,0)
</COMPONENT>
"DATA",811.8,2,100,479,0)
<COMPONENT>
"DATA",811.8,2,100,480,0)
<FDA_END>252</FDA_END>
"DATA",811.8,2,100,481,0)
<FDA_START>237</FDA_START>
"DATA",811.8,2,100,482,0)
<FILE_START>230</FILE_START>
"DATA",811.8,2,100,483,0)
<IEN_ROOT_END>257</IEN_ROOT_END>
"DATA",811.8,2,100,484,0)
<IEN_ROOT_START>257</IEN_ROOT_START>
"DATA",811.8,2,100,485,0)
</COMPONENT>
"DATA",811.8,2,100,486,0)
<COMPONENT>
"DATA",811.8,2,100,487,0)
<FDA_END>350</FDA_END>
"DATA",811.8,2,100,488,0)
<FDA_START>268</FDA_START>
"DATA",811.8,2,100,489,0)
<FILE_START>261</FILE_START>
"DATA",811.8,2,100,490,0)
<IEN_ROOT_END>364</IEN_ROOT_END>
"DATA",811.8,2,100,491,0)
<IEN_ROOT_START>355</IEN_ROOT_START>
"DATA",811.8,2,100,492,0)
</COMPONENT>
"DATA",811.8,2,100,493,0)
<COMPONENT>
"DATA",811.8,2,100,494,0)
<FDA_END>392</FDA_END>
"DATA",811.8,2,100,495,0)
<FDA_START>375</FDA_START>
"DATA",811.8,2,100,496,0)
<FILE_START>368</FILE_START>
"DATA",811.8,2,100,497,0)
<IEN_ROOT_END>397</IEN_ROOT_END>
"DATA",811.8,2,100,498,0)
<IEN_ROOT_START>397</IEN_ROOT_START>
"DATA",811.8,2,100,499,0)
</COMPONENT>
"DATA",811.8,2,100,500,0)
<COMPONENT>
"DATA",811.8,2,100,501,0)
<FDA_END>434</FDA_END>
"DATA",811.8,2,100,502,0)
<FDA_START>408</FDA_START>
"DATA",811.8,2,100,503,0)
<FILE_START>401</FILE_START>
"DATA",811.8,2,100,504,0)
<IEN_ROOT_END>442</IEN_ROOT_END>
"DATA",811.8,2,100,505,0)
<IEN_ROOT_START>439</IEN_ROOT_START>
"DATA",811.8,2,100,506,0)
</COMPONENT>
"DATA",811.8,2,100,507,0)
</INDEX>
"DATA",811.8,2,100,508,0)
</REMINDER_EXCHANGE_FILE_ENTRY>
"DATA",811.8,2,110,0)
^811.804^11^11
"DATA",811.8,2,110,1,0)
Reminder:    TIU*1*112 20040325
"DATA",811.8,2,110,2,0)
Source:      BAKKE,ANDREW at ALBANY
"DATA",811.8,2,110,3,0)
Date Packed: 03/25/2004@14:20:47
"DATA",811.8,2,110,4,0)

"DATA",811.8,2,110,5,0)
Description:
"DATA",811.8,2,110,6,0)
Document definition heirarcy for TIU/Surgery.
"DATA",811.8,2,110,7,0)

"DATA",811.8,2,110,8,0)
Keywords:
"DATA",811.8,2,110,9,0)
TIU,SURGERY,INTERFACE
"DATA",811.8,2,110,10,0)

"DATA",811.8,2,110,11,0)
Components:
"DATA",811.8,2,119)
1
"DATA",811.8,2,120,0)
^811.802A^9^9
"DATA",811.8,2,120,1,0)
TIU DOCUMENT DEFINITION^8925.1^9
"DATA",811.8,2,120,1,1,0)
^811.8021A^9^9
"DATA",811.8,2,120,1,1,1,0)
ANESTHESIA REPORT^26^35^^
"DATA",811.8,2,120,1,1,2,0)
ANESTHESIA REPORTS^46^61^66^66
"DATA",811.8,2,120,1,1,3,0)
NURSE INTRAOPERATIVE REPORT^77^86^^
"DATA",811.8,2,120,1,1,4,0)
NURSE INTRAOPERATIVE REPORTS^97^112^117^117
"DATA",811.8,2,120,1,1,5,0)
OPERATION REPORT^128^212^217^226
"DATA",811.8,2,120,1,1,6,0)
OPERATION REPORTS^237^252^257^257
"DATA",811.8,2,120,1,1,7,0)
PROCEDURE REPORT^268^350^355^364
"DATA",811.8,2,120,1,1,8,0)
PROCEDURE REPORT (NON-O.R.)^375^392^397^397
"DATA",811.8,2,120,1,1,9,0)
SURGICAL REPORTS^408^434^439^442
"DATA",811.8,2,130,0)
^811.803DA^1^1
"DATA",811.8,2,130,1,0)
3040326.160632^BAKKE,ANDREW
"DATA",811.8,2,130,1,1,0)
^811.8031A^9^9
"DATA",811.8,2,130,1,1,1,0)
1^TIU DOCUMENT DEFINITION^ANESTHESIA REPORT^O^
"DATA",811.8,2,130,1,1,2,0)
2^TIU DOCUMENT DEFINITION^ANESTHESIA REPORTS^O^
"DATA",811.8,2,130,1,1,3,0)
3^TIU DOCUMENT DEFINITION^NURSE INTRAOPERATIVE REPORT^O^
"DATA",811.8,2,130,1,1,4,0)
4^TIU DOCUMENT DEFINITION^NURSE INTRAOPERATIVE REPORTS^O^
"DATA",811.8,2,130,1,1,5,0)
5^TIU DOCUMENT DEFINITION^OPERATION REPORT^O^
"DATA",811.8,2,130,1,1,6,0)
6^TIU DOCUMENT DEFINITION^OPERATION REPORTS^O^
"DATA",811.8,2,130,1,1,7,0)
7^TIU DOCUMENT DEFINITION^PROCEDURE REPORT^O^
"DATA",811.8,2,130,1,1,8,0)
8^TIU DOCUMENT DEFINITION^PROCEDURE REPORT (NON-O.R.)^O^
"DATA",811.8,2,130,1,1,9,0)
9^TIU DOCUMENT DEFINITION^SURGICAL REPORTS^O^
"FIA",811.8)
REMINDER EXCHANGE FILE
"FIA",811.8,0)
^PXD(811.8,
"FIA",811.8,0,0)
811.8s
"FIA",811.8,0,1)
n^y^f^^n^^y^o^n
"FIA",811.8,0,10)

"FIA",811.8,0,11)
I Y=2
"FIA",811.8,0,"RLRO")

"FIA",811.8,0,"VR")
1.0^TIU
"FIA",811.8,811.8)
0
"FIA",811.8,811.801)
0
"FIA",811.8,811.802)
0
"FIA",811.8,811.8021)
0
"FIA",811.8,811.803)
0
"FIA",811.8,811.8031)
0
"FIA",811.8,811.80315)
0
"FIA",811.8,811.804)
0
"FIA",8925)
TIU DOCUMENT
"FIA",8925,0)
^TIU(8925,
"FIA",8925,0,0)
8925IsP
"FIA",8925,0,1)
y^y^p^^^^n
"FIA",8925,0,10)

"FIA",8925,0,11)

"FIA",8925,0,"RLRO")

"FIA",8925,0,"VR")
1.0^TIU
"FIA",8925,8925)
1
"FIA",8925,8925,1405)

"FIA",8925.1)
TIU DOCUMENT DEFINITION
"FIA",8925.1,0)
^TIU(8925.1,
"FIA",8925.1,0,0)
8925.1I
"FIA",8925.1,0,1)
y^y^p^^^^n
"FIA",8925.1,0,10)

"FIA",8925.1,0,11)

"FIA",8925.1,0,"RLRO")

"FIA",8925.1,0,"VR")
1.0^TIU
"FIA",8925.1,8925.1)
1
"FIA",8925.1,8925.1,.01)

"FIA",8925.1,8925.1,.02)

"FIA",8925.1,8925.1,.03)

"FIA",8925.1,8925.1,6.5)

"FIA",8925.1,8925.1,6.51)

"INI")
TIUPR112
"INIT")
TIUPS112
"IX",811.8,811.8,"B",0)
811.8^B^Uniqueness Index for Key 'A' of File #811.8^R^^R^IR^I^811.8^^^^^LS
"IX",811.8,811.8,"B",1)
S ^PXD(811.8,"B",X(1),X(2),DA)=""
"IX",811.8,811.8,"B",2)
K ^PXD(811.8,"B",X(1),X(2),DA)
"IX",811.8,811.8,"B",2.5)
K ^PXD(811.8,"B")
"IX",811.8,811.8,"B",11.1,0)
^.114IA^2^2
"IX",811.8,811.8,"B",11.1,1,0)
1^F^811.8^.01^^1
"IX",811.8,811.8,"B",11.1,2,0)
2^F^811.8^.03^^2
"IX",811.8,811.8,"D",0)
811.8^D^Cross-reference on date and time^R^^F^IR^I^811.8^^^^^LS
"IX",811.8,811.8,"D",1)
S ^PXD(811.8,"D",X,DA)=""
"IX",811.8,811.8,"D",2)
K ^PXD(811.8,"D",X,DA)
"IX",811.8,811.8,"D",2.5)
K ^PXD(811.8,"D")
"IX",811.8,811.8,"D",11.1,0)
^.114IA^1^1
"IX",811.8,811.8,"D",11.1,1,0)
1^F^811.8^.03^^1^F
"IX",811.8,811.8,"D",11.1,1,3)

"IX",811.8,811.802,"B",0)
811.802^B^New style B cross-reference^R^^F^IR^I^811.802^^^^^LS
"IX",811.8,811.802,"B",1)
S ^PXD(811.8,DA(1),120,"B",$E(X,1,64),DA)=""
"IX",811.8,811.802,"B",2)
K ^PXD(811.8,DA(1),120,"B",$E(X,1,64),DA)
"IX",811.8,811.802,"B",2.5)
K ^PXD(811.8,DA(1),120,"B")
"IX",811.8,811.802,"B",11.1,0)
^.114IA^1^1
"IX",811.8,811.802,"B",11.1,1,0)
1^F^811.802^.01^64^1^F
"IX",811.8,811.802,"B",11.1,1,3)

"IX",811.8,811.803,"B",0)
811.803^B^New style B cross-reference^R^^F^IR^I^811.803^^^^^LS
"IX",811.8,811.803,"B",1)
S ^PXD(811.8,DA(1),130,"B",X,DA)=""
"IX",811.8,811.803,"B",2)
K ^PXD(811.8,DA(1),130,"B",X,DA)
"IX",811.8,811.803,"B",2.5)
K ^PXD(811.8,DA(1),130,"B")
"IX",811.8,811.803,"B",11.1,0)
^.114IA^1^1
"IX",811.8,811.803,"B",11.1,1,0)
1^F^811.803^.01^^1^F
"KEY",811.8,811.8,"A",0)
811.8^A^P^33
"KEY",811.8,811.8,"A",2,0)
^.312IA^2^2
"KEY",811.8,811.8,"A",2,1,0)
.01^811.8^1
"KEY",811.8,811.8,"A",2,2,0)
.03^811.8^2
"KEYPTR",811.8,811.8,"A")
811.8^B
"KRN",.402,2108,-1)
0^2
"KRN",.402,2108,0)
TIU ENTER/EDIT SURGICAL REPORT^3040227.1831^@^8925^^@^3040326
"KRN",.402,2108,"DIAB",2,0,8925,3)
AUTHOR/DICTATOR//^S X=$$PERSNAME^TIULC1($S($D(TIUAUTH):+TIUAUTH,1:+DUZ));T;REQ
"KRN",.402,2108,"DIAB",5,0,8925,5)
ATTENDING PHYSICIAN;"ATTENDING SURGEON";REQ
"KRN",.402,2108,"DIAB",7,0,8925,2)
REFERENCE DATE//^S X=$$DATE^TIULS($$NOW^XLFDT,"MM/DD/YY@HR:MIN");OPERATION DATE/TIME
"KRN",.402,2108,"DIAB",8,0,8925,5)
ATTENDING PHYSICIAN;"ATTENDING SURGEON"
"KRN",.402,2108,"DR",1,8925)
.02////^S X=DFN;.03////^S X=$P($G(TIU("VISIT")),U);.07////^S X=$P($G(TIU("EDT")),U);.08////^S X=$P($G(TIU("LDT")),U);1401////^S X=$P($G(TIU("AD#")),U);I '+$G(TIUBY) S Y="@1";I +$P($G(^TIU(8925,+DA,12)),U,5) S Y="@13";
"KRN",.402,2108,"DR",1,8925,1)
1205////^S X=$P($G(TIU("LOC")),U);@13;I +$G(^TIU(8925,+DA,13)) S Y="@14";1301////^S X=$$NOW^TIULC;@14;I +$P($G(^TIU(8925,+DA,12)),U,2) S Y="@1";1202////^S X=$S($D(TIUAUTH):+TIUAUTH,1:+$G(DUZ));@1;I +$G(TIUBY) S Y="@2";
"KRN",.402,2108,"DR",1,8925,2)
I $P($G(^SC(+$G(TIU("LOC")),0)),U,3)="W" S Y="@3";1205////^S X=$P($G(TIU("LOC")),U);S Y="@4";@3;1205//^S X=$P($G(TIU("LOC")),U,2);@4;1301OPERATION DATE/TIME~//^S X=$$DATE^TIULS($$NOW^XLFDT,"MM/DD/YY@HR:MIN");
"KRN",.402,2108,"DR",1,8925,3)
I +$$DATENOTE^TIULA3($$DATE^TIULS(X,"MM/DD/YY@HR:MIN:SEC"))'>0 S Y="@4";1202R~T~//^S X=$$PERSNAME^TIULC1($S($D(TIUAUTH):+TIUAUTH,1:+DUZ));
"KRN",.402,2108,"DR",1,8925,4)
I +$G(TIUAUTH),(+$P(^TIU(8925,+DA,12),U,2)'=+$G(TIUAUTH)) S TIU("SVC")=$$PROVSVC^TIULV(+$P(^(12),U,2)),TIUAUTH=+$P(^TIU(8925,+DA,12),U,2);@2;I +$P($G(^TIU(8925,+DA,13)),U,2) S Y="@5";1302//^S X=DUZ;@5;
"KRN",.402,2108,"DR",1,8925,5)
I +$P($G(^TIU(8925,+DA,12)),U) S Y="@6";1201////^S X=$$NOW^TIULC;@6;I +$$PROVIDER^TIUPXAP1(DUZ,DT)'>0 S Y="@7";1209R~ATTENDING SURGEON~;S Y="@8";@7;1209ATTENDING SURGEON~;@8;1204////^S X=$$WHOSIGNS^TIULC1(DA);
"KRN",.402,2108,"DR",1,8925,6)
1208////^S X=$$WHOCOSIG^TIULC1(DA);1506////^S X=$S(+$P($G(^TIU(8925,+DA,12)),U,4)=+$P($G(^(12)),U,9):0,1:1);1404;1402;I +$P($G(TIUPREF),U,8)'>0,($G(^TIU(8925,+DA,17))']"") S Y="@10";1701;@10;
"KRN",.402,2108,"DR",1,8925,7)
I $P($G(^TIU(8925,+DA,13)),U,3)="D" S Y="@12";1303////^S X="D";@12;I +$P($G(^TIU(8925,+DA,12)),U,5) S Y="@15";1212////^S X=+$G(DUZ(2));S Y="@16";@15;1212////^S X=+$$DIVISION^TIULC1(+$P($G(^TIU(8925,+DA,12)),U,5));@16;
"KRN",19,10360,-1)
4^7
"KRN",19,10360,0)
TIU REVIEW SCREEN CLINICIAN
"KRN",19,10362,-1)
4^8
"KRN",19,10362,0)
TIU ENTER/EDIT
"KRN",19,10363,-1)
2^2
"KRN",19,10363,0)
TIU MAIN MENU MIXED CLINICIAN^Integrated Document Management^^M^11712^^^^^^y^516^^1^^^1
"KRN",19,10363,10,0)
^19.01IP^15^15
"KRN",19,10363,10,5,0)
10360^4^4
"KRN",19,10363,10,5,"^")
TIU REVIEW SCREEN CLINICIAN
"KRN",19,10363,10,8,0)
10364^3^3
"KRN",19,10363,10,8,"^")
TIU REVIEW UNSIGNED
"KRN",19,10363,10,14,0)
10362^5^5
"KRN",19,10363,10,14,"^")
TIU ENTER/EDIT
"KRN",19,10363,10,15,0)
11852^2^2
"KRN",19,10363,10,15,"^")
TIU REVIEW UNDICTATED DOCS
"KRN",19,10363,"U")
INTEGRATED DOCUMENT MANAGEMENT
"KRN",19,10364,-1)
4^6
"KRN",19,10364,0)
TIU REVIEW UNSIGNED
"KRN",19,10369,-1)
2^4
"KRN",19,10369,0)
TIU MAIN MENU TRANSCRIPTION^Text Integration Utilities (Transcriptionist)^^M^11712^^^^^^y^516^^1^^^1
"KRN",19,10369,10,0)
^19.01IP^5^5
"KRN",19,10369,10,4,0)
12066^4^4
"KRN",19,10369,10,4,"^")
TIU REVIEW UNTRANSCRIBED DOCS
"KRN",19,10369,10,5,0)
12067^5^5
"KRN",19,10369,10,5,"^")
TIU BROWSE DOC TRANSCRIPTION
"KRN",19,10369,"U")
TEXT INTEGRATION UTILITIES (TR
"KRN",19,11852,-1)
0^1
"KRN",19,11852,0)
TIU REVIEW UNDICTATED DOCS^All MY UNDICTATED Documents^^A^^^^^^^n^TEXT INTEGRATION UTILITIES^^1^1
"KRN",19,11852,1,0)
^^1^1^3010501^
"KRN",19,11852,1,1,0)
Gets all UNDICTATED Documents for review, edit, and signature.
"KRN",19,11852,15)
K TIUQUIK,TIUEDT,TIULDT
"KRN",19,11852,20)
S TIUQUIK=2 D EN^VALM("TIU REVIEW UNDICTATED DOCS")
"KRN",19,11852,99)
55441,53727
"KRN",19,11852,"U")
ALL MY UNDICTATED DOCUMENTS
"KRN",19,12066,-1)
0^3
"KRN",19,12066,0)
TIU REVIEW UNTRANSCRIBED DOCS^List Documents for Transcription^^A^^^^^^^n^TEXT INTEGRATION UTILITIES^^1^1
"KRN",19,12066,1,0)
^^2^2^3020419^
"KRN",19,12066,1,1,0)
Gets all UNDICTATED and UNTRANSCRIBED Documents for review, edit, and
"KRN",19,12066,1,2,0)
signature.
"KRN",19,12066,15)
K TIUQUIK,TIUEDT,TIULDT
"KRN",19,12066,20)
S TIUQUIK=3 D EN^VALM("TIU REVIEW UNTRANSCRIBED DOCS")
"KRN",19,12066,99)
55441,53727
"KRN",19,12066,"U")
LIST DOCUMENTS FOR TRANSCRIPTI
"KRN",19,12067,-1)
0^5
"KRN",19,12067,0)
TIU BROWSE DOC TRANSCRIPTION^Review/Edit Documents^^A^^^^^^^^TEXT INTEGRATION UTILITIES^^1
"KRN",19,12067,1,0)
^^1^1^3020423^
"KRN",19,12067,1,1,0)
Allows the user to interactively review, edit, or print documents.
"KRN",19,12067,20)
K ORVP D MAIN^TIUBRWS("TIU BROWSE FOR TRANSCRIPTION")
"KRN",19,12067,"U")
REVIEW/EDIT DOCUMENTS
"KRN",101,3074,-1)
4^15
"KRN",101,3074,0)
TIU ACTION EDIT
"KRN",101,3075,-1)
4^5
"KRN",101,3075,0)
TIU ACTION PRINT
"KRN",101,3077,-1)
4^6
"KRN",101,3077,0)
TIU ACTION DETAILED DISPLAY
"KRN",101,3081,-1)
4^7
"KRN",101,3081,0)
TIU ACTION QUIT
"KRN",101,3082,-1)
4^8
"KRN",101,3082,0)
TIU ACTION CHANGE VIEW CLINICIAN
"KRN",101,3099,-1)
4^16
"KRN",101,3099,0)
TIU BROWSE ACTION EDIT
"KRN",101,3100,-1)
4^10
"KRN",101,3100,0)
TIU BROWSE ACTION PRINT
"KRN",101,3102,-1)
4^11
"KRN",101,3102,0)
TIU BROWSE ACTION SEARCH
"KRN",101,3138,-1)
4^17
"KRN",101,3138,0)
TIU ACTION BLANK1
"KRN",101,3139,-1)
4^18
"KRN",101,3139,0)
TIU ACTION BLANK2
"KRN",101,3251,-1)
4^9
"KRN",101,3251,0)
TIU ACTION SEARCH LIST
"KRN",101,4595,-1)
0^3
"KRN",101,4595,0)
TIU ACTION DICTATE DOCUMENTS^Document(s) Dictated^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4595,.1)
Dictate
"KRN",101,4595,1,0)
^^4^4^3010501^
"KRN",101,4595,1,1,0)
Allows users to mark documents as "Dictated/Not Transcribed."
"KRN",101,4595,1,2,0)
 
"KRN",101,4595,1,3,0)
NOTE:  This step is only applicable when an UNDICTATED document is created
"KRN",101,4595,1,4,0)
in anticipation of Dictation/Transcription and Upload.
"KRN",101,4595,20)
D DICTATED^TIURA2
"KRN",101,4595,24)
I '$G(TIUGLINK)
"KRN",101,4595,99)
59620,57992
"KRN",101,4596,-1)
0^2
"KRN",101,4596,0)
TIU BROWSE ACTION DOCUMENT DICTATED^Dictation Finished^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4596,1,0)
^^1^1^2980305^
"KRN",101,4596,1,1,0)
Allows MIS clerks to mark current document as "signed on chart."
"KRN",101,4596,20)
D DICTATE1^TIURA2(TIUDA)
"KRN",101,4596,99)
59620,57992
"KRN",101,4597,-1)
0^1
"KRN",101,4597,0)
TIU ACTION MENU DICTATION^Select Action^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4597,1,0)
^101.06^1^1^3010601^^^
"KRN",101,4597,1,1,0)
Menu of actions supporting dictation. 
"KRN",101,4597,4)
26
"KRN",101,4597,10,0)
^101.01PA^10^8
"KRN",101,4597,10,1,0)
3075^^7^
"KRN",101,4597,10,1,"^")
TIU ACTION PRINT
"KRN",101,4597,10,2,0)
3077^^3^
"KRN",101,4597,10,2,"^")
TIU ACTION DETAILED DISPLAY
"KRN",101,4597,10,5,0)
4595^^5^
"KRN",101,4597,10,5,"^")
TIU ACTION DICTATE DOCUMENTS
"KRN",101,4597,10,6,0)
3081^^11^
"KRN",101,4597,10,6,"^")
TIU ACTION QUIT
"KRN",101,4597,10,7,0)
3082^^9^
"KRN",101,4597,10,7,"^")
TIU ACTION CHANGE VIEW CLINICIAN
"KRN",101,4597,10,10,0)
3251^^1^
"KRN",101,4597,10,10,"^")
TIU ACTION SEARCH LIST
"KRN",101,4597,20)
S XQORM("SH")=0 S:$G(VALMSG)'["*" VALMSG="+ Next Screen  - Prev Screen  ?? More Actions",VALM("MAX")=+$G(VALMCNT)
"KRN",101,4597,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,4597,26)
S XQORM("#")=$G(^TMP("TIUR",$J,"#")) D RESIZE^TIULM(21,18),SHOW^VALM K XQORM("XLATE","FIND")
"KRN",101,4597,28)
Select Action: 
"KRN",101,4597,99)
59620,57992
"KRN",101,4598,-1)
0^4
"KRN",101,4598,0)
TIU BROWSE MENU DICTATION^Dictation Menu^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4598,1,0)
^101.06^1^1^3010601^^
"KRN",101,4598,1,1,0)
Menu of actions supporting dictatation.
"KRN",101,4598,4)
26
"KRN",101,4598,10,0)
^101.01PA^8^6
"KRN",101,4598,10,3,0)
3100^^3^
"KRN",101,4598,10,3,"^")
TIU BROWSE ACTION PRINT
"KRN",101,4598,10,4,0)
3081^^6^
"KRN",101,4598,10,4,"^")
TIU ACTION QUIT
"KRN",101,4598,10,5,0)
3102^^1^
"KRN",101,4598,10,5,"^")
TIU BROWSE ACTION SEARCH
"KRN",101,4598,10,8,0)
4596^^5^
"KRN",101,4598,10,8,"^")
TIU BROWSE ACTION DOCUMENT DICTATED
"KRN",101,4598,15)
S:$D(DIROUT) TIUQUIT=1
"KRN",101,4598,20)
S VALMSG="+ Next Screen  - Prev Screen  ?? More Actions"
"KRN",101,4598,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,4598,26)
D RESIZE^TIULM(21,18),SHOW^VALM S XQORM("B")=$S(VALMLST<VALMCNT:"Next Screen",1:"Dictation Finished")
"KRN",101,4598,28)
Select Action: 
"KRN",101,4598,99)
59620,57992
"KRN",101,4598,101.07,0)
^101.07
"KRN",101,4679,-1)
0^12
"KRN",101,4679,0)
TIU ACTION MENU TRANSCRIPTION^Act on Documents^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4679,1,0)
^^1^1^3020418^
"KRN",101,4679,1,1,0)
Menu of actions which may be executed by transcriptionists.
"KRN",101,4679,4)
26
"KRN",101,4679,10,0)
^101.01PA^11^11
"KRN",101,4679,10,1,0)
3075^^7^
"KRN",101,4679,10,1,"^")
TIU ACTION PRINT
"KRN",101,4679,10,5,0)
4681^^3^
"KRN",101,4679,10,5,"^")
TIU ACTION BROWSE FOR TRANSCRIPTION
"KRN",101,4679,10,6,0)
3081^^11^
"KRN",101,4679,10,6,"^")
TIU ACTION QUIT
"KRN",101,4679,10,7,0)
3082^^9^
"KRN",101,4679,10,7,"^")
TIU ACTION CHANGE VIEW CLINICIAN
"KRN",101,4679,10,10,0)
3251^^1^
"KRN",101,4679,10,10,"^")
TIU ACTION SEARCH LIST
"KRN",101,4679,10,11,0)
3074^^5^
"KRN",101,4679,10,11,"^")
TIU ACTION EDIT
"KRN",101,4679,20)
S XQORM("SH")=0 S:$G(VALMSG)'["*" VALMSG="+ Next Screen  - Prev Screen  ?? More Actions",VALM("MAX")=+$G(VALMCNT)
"KRN",101,4679,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,4679,26)
S XQORM("#")=$G(^TMP("TIUR",$J,"#")) D RESIZE^TIULM(21,18),SHOW^VALM K XQORM("XLATE","FIND")
"KRN",101,4679,28)
Select Action: 
"KRN",101,4679,99)
59620,57992
"KRN",101,4680,-1)
0^13
"KRN",101,4680,0)
TIU BROWSE MENU TRANSCRIPTION^Review/edit/sign^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4680,1,0)
^^1^1^2950628^^^^
"KRN",101,4680,1,1,0)
Menu of actions which may be executed by clinicians.
"KRN",101,4680,4)
26
"KRN",101,4680,10,0)
^101.01PA^8^8
"KRN",101,4680,10,3,0)
3100^^5^
"KRN",101,4680,10,3,"^")
TIU BROWSE ACTION PRINT
"KRN",101,4680,10,4,0)
3081^^7^
"KRN",101,4680,10,4,"^")
TIU ACTION QUIT
"KRN",101,4680,10,5,0)
3102^^1^
"KRN",101,4680,10,5,"^")
TIU BROWSE ACTION SEARCH
"KRN",101,4680,10,6,0)
3099^^3^
"KRN",101,4680,10,6,"^")
TIU BROWSE ACTION EDIT
"KRN",101,4680,10,7,0)
3138^^2^
"KRN",101,4680,10,7,"^")
TIU ACTION BLANK1
"KRN",101,4680,10,8,0)
3139^^4^
"KRN",101,4680,10,8,"^")
TIU ACTION BLANK2
"KRN",101,4680,15)
S:$D(DIROUT) TIUQUIT=1
"KRN",101,4680,20)
S XQORM("SH")=0
"KRN",101,4680,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,4680,26)
S VALMSG="+ Next Screen  - Prev Screen  ?? More actions" D RESIZE^TIULM(21,18),SHOW^VALM
"KRN",101,4680,28)
Select Action: 
"KRN",101,4680,99)
59620,57992
"KRN",101,4681,-1)
0^14
"KRN",101,4681,0)
TIU ACTION BROWSE FOR TRANSCRIPTION^Browse^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4681,1,0)
^^4^4^2950426^^
"KRN",101,4681,1,1,0)
Allows users to browse through Documents from the Review Screen.
"KRN",101,4681,1,2,0)
In addition to scrolling sequentially through the selected documents
"KRN",101,4681,1,3,0)
and their addenda, the user may Search for a particular word or
"KRN",101,4681,1,4,0)
phrase, or Print draft copies to a selected device.
"KRN",101,4681,20)
D BROWSE^TIURA2("TIU BROWSE FOR TRANSCRIPTION")
"KRN",101,4681,99)
59620,57992
"KRN",409.61,357,-1)
0^5
"KRN",409.61,357,0)
TIU REVIEW SCREEN CLINICIAN^1^^135^4^17^1^1^Document^TIU ACTION MENU CLINICIAN^Clinical Documents^
"KRN",409.61,357,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,357,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,357,"COL",0)
^409.621^14^10
"KRN",409.61,357,"COL",1,0)
NUMBER^1^5^^
"KRN",409.61,357,"COL",2,0)
STATUS^70^10^Status
"KRN",409.61,357,"COL",3,0)
PATIENT NAME^6^14^Patient^^
"KRN",409.61,357,"COL",4,0)
REF DATE^60^8^Ref Date
"KRN",409.61,357,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,357,"COL",10,0)
LAST I/LAST 4^20^7^^^0
"KRN",409.61,357,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,357,"COL",12,0)
EXPECTED COSIGNER^109^15^Exp. Cos.
"KRN",409.61,357,"COL",13,0)
DOCUMENT TYPE^28^31^Document^^1
"KRN",409.61,357,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,357,"COL","AIDENT",0,10)

"KRN",409.61,357,"COL","AIDENT",1,13)

"KRN",409.61,357,"COL","B","AUTHOR",11)

"KRN",409.61,357,"COL","B","DIVISION",14)

"KRN",409.61,357,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,357,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,357,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,357,"COL","B","NUMBER",1)

"KRN",409.61,357,"COL","B","PATIENT NAME",3)

"KRN",409.61,357,"COL","B","REF DATE",4)

"KRN",409.61,357,"COL","B","SIG DATE",5)

"KRN",409.61,357,"COL","B","STATUS",2)

"KRN",409.61,357,"FNL")
D CLEAN^TIUR
"KRN",409.61,357,"HDR")
D HDR^TIURH
"KRN",409.61,357,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,357,"INIT")
D MAKELIST^TIUR(38)
"KRN",409.61,363,-1)
0^6
"KRN",409.61,363,0)
TIU SEARCH LIST MGR^1^^135^4^18^1^1^Document^TIU ACTION MENU MGR^CLINICAL DOCUMENTS
"KRN",409.61,363,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,363,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,363,"COL",0)
^409.621^14^10
"KRN",409.61,363,"COL",1,0)
NUMBER^1^5
"KRN",409.61,363,"COL",2,0)
STATUS^70^10^Status
"KRN",409.61,363,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,363,"COL",4,0)
REF DATE^60^8^Ref Date
"KRN",409.61,363,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,363,"COL",10,0)
LAST I/LAST 4^20^7^^^
"KRN",409.61,363,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,363,"COL",12,0)
EXPECTED COSIGNER^109^15^Exp. Cos.
"KRN",409.61,363,"COL",13,0)
DOCUMENT TYPE^28^31^Document^^1
"KRN",409.61,363,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,363,"COL","AIDENT",1,13)

"KRN",409.61,363,"COL","B","AUTHOR",11)

"KRN",409.61,363,"COL","B","DIVISION",14)

"KRN",409.61,363,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,363,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,363,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,363,"COL","B","NUMBER",1)

"KRN",409.61,363,"COL","B","PATIENT NAME",3)

"KRN",409.61,363,"COL","B","REF DATE",4)

"KRN",409.61,363,"COL","B","SIG DATE",5)

"KRN",409.61,363,"COL","B","STATUS",2)

"KRN",409.61,363,"FNL")
D CLEAN^TIUR
"KRN",409.61,363,"HDR")
D HDR^TIURH
"KRN",409.61,363,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,363,"INIT")
D MAKELIST^TIUR(38)
"KRN",409.61,364,-1)
0^7
"KRN",409.61,364,0)
TIU SEARCH LIST MRT^1^^135^4^18^1^1^Document^TIU ACTION MENU MRT^CLINICAL DOCUMENTS
"KRN",409.61,364,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,364,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,364,"COL",0)
^409.621^14^10
"KRN",409.61,364,"COL",1,0)
NUMBER^1^5
"KRN",409.61,364,"COL",2,0)
STATUS^70^10^Status
"KRN",409.61,364,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,364,"COL",4,0)
REF DATE^60^8^Ref Date
"KRN",409.61,364,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,364,"COL",10,0)
LAST I/LAST 4^20^7
"KRN",409.61,364,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,364,"COL",12,0)
EXPECTED COSIGNER^109^15^Exp. Cos.
"KRN",409.61,364,"COL",13,0)
DOCUMENT TYPE^28^31^Document^^1
"KRN",409.61,364,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,364,"COL","AIDENT",1,13)

"KRN",409.61,364,"COL","B","AUTHOR",11)

"KRN",409.61,364,"COL","B","DIVISION",14)

"KRN",409.61,364,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,364,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,364,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,364,"COL","B","NUMBER",1)

"KRN",409.61,364,"COL","B","PATIENT NAME",3)

"KRN",409.61,364,"COL","B","REF DATE",4)

"KRN",409.61,364,"COL","B","SIG DATE",5)

"KRN",409.61,364,"COL","B","STATUS",2)

"KRN",409.61,364,"FNL")
D CLEAN^TIUR
"KRN",409.61,364,"HDR")
D HDR^TIURH
"KRN",409.61,364,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,364,"INIT")
D MAKELIST^TIUR(38)
"KRN",409.61,562,-1)
0^1
"KRN",409.61,562,0)
TIU REVIEW UNDICTATED DOCS^1^^135^4^17^1^1^Document^TIU ACTION MENU DICTATION^Clinical Documents
"KRN",409.61,562,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,562,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,562,"COL",0)
^409.621^13^9
"KRN",409.61,562,"COL",1,0)
NUMBER^1^5
"KRN",409.61,562,"COL",2,0)
STATUS^70^10^Status
"KRN",409.61,562,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,562,"COL",4,0)
REF DATE^60^8^Ref Date
"KRN",409.61,562,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,562,"COL",10,0)
LAST I/LAST 4^20^7^^^0
"KRN",409.61,562,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,562,"COL",12,0)
EXPECTED COSIGNER^109^15^Cosigner
"KRN",409.61,562,"COL",13,0)
DOCUMENT TYPE^28^31^Document^^1
"KRN",409.61,562,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,562,"COL","AIDENT",0,10)

"KRN",409.61,562,"COL","AIDENT",1,13)

"KRN",409.61,562,"COL","B","AUTHOR",11)

"KRN",409.61,562,"COL","B","DIVISION",14)

"KRN",409.61,562,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,562,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,562,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,562,"COL","B","NUMBER",1)

"KRN",409.61,562,"COL","B","PATIENT NAME",3)

"KRN",409.61,562,"COL","B","REF DATE",4)

"KRN",409.61,562,"COL","B","SIG DATE",5)

"KRN",409.61,562,"COL","B","STATUS",2)

"KRN",409.61,562,"FNL")
D CLEAN^TIUR
"KRN",409.61,562,"HDR")
D HDR^TIURH
"KRN",409.61,562,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,562,"INIT")
D MAKELIST^TIUR(38)
"KRN",409.61,563,-1)
0^2
"KRN",409.61,563,0)
TIU DOCUMENT DICTATED^1^^^5^18^1^1^Document^TIU BROWSE MENU DICTATION^Document Dictated
"KRN",409.61,563,1)
^TIU HIDDEN ACTIONS BROWSE
"KRN",409.61,563,"ARRAY")
 ^TMP("TIUAUDIT",$J)
"KRN",409.61,563,"FNL")
D CLEAN^TIUAUDIT S VALMBCK="Q"
"KRN",409.61,563,"HDR")
D HDR^TIUAUDIT
"KRN",409.61,563,"HLP")
D FULL^VALM1,PROTOCOL^TIUHELP S VALMBCK="R"
"KRN",409.61,563,"INIT")
D MAIN^TIUAUDIT
"KRN",409.61,584,-1)
0^3
"KRN",409.61,584,0)
TIU REVIEW UNTRANSCRIBED DOCS^1^^135^4^17^1^1^Document^TIU ACTION MENU TRANSCRIPTION^Clinical Documents
"KRN",409.61,584,1)
^TIU HIDDEN ACTIONS ADVANCED
"KRN",409.61,584,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,584,"COL",0)
^409.621^13^9
"KRN",409.61,584,"COL",1,0)
NUMBER^1^5
"KRN",409.61,584,"COL",2,0)
STATUS^70^10^Status
"KRN",409.61,584,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,584,"COL",4,0)
REF DATE^60^8^Ref Date
"KRN",409.61,584,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,584,"COL",10,0)
LAST I/LAST 4^20^7^^^0
"KRN",409.61,584,"COL",11,0)
AUTHOR^92^15^Author
"KRN",409.61,584,"COL",12,0)
EXPECTED COSIGNER^109^15^Cosigner
"KRN",409.61,584,"COL",13,0)
DOCUMENT TYPE^28^31^Document^^1
"KRN",409.61,584,"COL",14,0)
DIVISION^126^8^Division
"KRN",409.61,584,"COL","AIDENT",0,10)

"KRN",409.61,584,"COL","AIDENT",1,13)

"KRN",409.61,584,"COL","B","AUTHOR",11)

"KRN",409.61,584,"COL","B","DIVISION",14)

"KRN",409.61,584,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,584,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,584,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,584,"COL","B","NUMBER",1)

"KRN",409.61,584,"COL","B","PATIENT NAME",3)

"KRN",409.61,584,"COL","B","REF DATE",4)

"KRN",409.61,584,"COL","B","SIG DATE",5)

"KRN",409.61,584,"COL","B","STATUS",2)

"KRN",409.61,584,"FNL")
D CLEAN^TIUR
"KRN",409.61,584,"HDR")
D HDR^TIURH
"KRN",409.61,584,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,584,"INIT")
D MAKELIST^TIUR(38)
"KRN",409.61,585,-1)
0^4
"KRN",409.61,585,0)
TIU BROWSE FOR TRANSCRIPTION^1^^^5^18^1^1^Document^TIU BROWSE MENU TRANSCRIPTION^Browse Document
"KRN",409.61,585,1)
^TIU HIDDEN ACTIONS BROWSE
"KRN",409.61,585,"ARRAY")
 ^TMP("TIUVIEW",$J)
"KRN",409.61,585,"FNL")
D CLEAN^TIUBR
"KRN",409.61,585,"HDR")
D HDR^TIUBR
"KRN",409.61,585,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,585,"INIT")
D EN^TIUBR
"KRN",8994,997,-1)
0^1
"KRN",8994,997,0)
TIU GET DOCUMENTS FOR REQUEST^GETDOCS^TIUSRVLR^4^S
"KRN",8994,997,1,0)
^^2^2^3010605^
"KRN",8994,997,1,1,0)
This Remote Procedure returns the list of documents associated with a
"KRN",8994,997,1,2,0)
given Request (e.g., Consult Request, or Surgical Case).
"KRN",8994,997,2,0)
^8994.02A^1^1
"KRN",8994,997,2,1,0)
OVP^1^^1^1
"KRN",8994,997,2,1,1,0)
^^2^2^3010605^
"KRN",8994,997,2,1,1,1,0)
This is the variable pointer (e.g., "12745;GMR(123," or "14672;SRF(") that
"KRN",8994,997,2,1,1,2,0)
identifies the record in the requesting application.
"KRN",8994,997,2,"B","OVP",1)

"KRN",8994,997,2,"PARAMSEQ",1,1)

"KRN",8994,997,3,0)
^^6^6^3010605^
"KRN",8994,997,3,1,0)
The return array has elements with the following positional values:
"KRN",8994,997,3,2,0)
  
"KRN",8994,997,3,3,0)
 IEN^TITLE^REFERENCE DATE/TIME (INT)^PATIENT NAME (LAST I/LAST 4)^AUTHOR
"KRN",8994,997,3,4,0)
    (INT;EXT)^HOSPITAL LOCATION^SIGNATURE STATUS^Visit Date/Time^
"KRN",8994,997,3,5,0)
    Discharge Date/time^Variable Pointer to Request (e.g., Consult)^# of
"KRN",8994,997,3,6,0)
    Associated Images^Subject^Has Children^IEN of Parent Document
"KRN",8994,1011,-1)
0^2
"KRN",8994,1011,0)
TIU IS THIS A SURGERY?^ISSURG^TIUSROI^1^S
"KRN",8994,1011,1,0)
^^2^2^3010614^
"KRN",8994,1011,1,1,0)
BOOLEAN RPC which evaluates whether the title indicated is that of a
"KRN",8994,1011,1,2,0)
SURGICAL REPORT or PROCEDURE REPORT (NON-O.R.).
"KRN",8994,1011,2,0)
^8994.02A^1^1
"KRN",8994,1011,2,1,0)
TITLE^1^^^1
"KRN",8994,1011,2,1,1,0)
^8994.021^1^1^3010614^^
"KRN",8994,1011,2,1,1,1,0)
This is the record number in file 8925.1 for the title selected.
"KRN",8994,1011,2,"B","TITLE",1)

"KRN",8994,1011,2,"PARAMSEQ",1,1)

"KRN",8994,1011,3,0)
^^4^4^3010614^
"KRN",8994,1011,3,1,0)
Scalar value indicating the truth value of the result (i.e., 0 indicates
"KRN",8994,1011,3,2,0)
FALSE - the title is NOT that of a SURGICAL REPORT or PROCEDURE REPORT
"KRN",8994,1011,3,3,0)
(NON-O.R.); 1 indicates TRUE - the title IS that of a SURGICAL REPORT or
"KRN",8994,1011,3,4,0)
PROCEDURE REPORT (NON-O.R.).
"KRN",8994,1012,-1)
0^3
"KRN",8994,1012,0)
TIU IDENTIFY SURGERY CLASS^SURGCLAS^TIUSRVD^1^S
"KRN",8994,1012,1,0)
^^2^2^3010614^
"KRN",8994,1012,1,1,0)
This RPC returns the record number of the class identified by the CLNAME
"KRN",8994,1012,1,2,0)
parameter in the TIU DOCUMENT DEFINITION file (#8925.1).
"KRN",8994,1012,2,0)
^8994.02A^1^1
"KRN",8994,1012,2,1,0)
CLNAME^1^^1^1
"KRN",8994,1012,2,1,1,0)
^^2^2^3010614^
"KRN",8994,1012,2,1,1,1,0)
This is the name (ASCII LITERAL) of the Class for which the calling
"KRN",8994,1012,2,1,1,2,0)
application needs an IEN.
"KRN",8994,1012,2,"B","CLNAME",1)

"KRN",8994,1012,2,"PARAMSEQ",1,1)

"KRN",8994,1012,3,0)
^^4^4^3010614^
"KRN",8994,1012,3,1,0)
The value returned will be either a positive integer, corresponding to the
"KRN",8994,1012,3,2,0)
record number identifying the class identified by the CLNAME parameter, or
"KRN",8994,1012,3,3,0)
zero, indicating that the Surgery interface is not yet implemented in
"KRN",8994,1012,3,4,0)
TIU.
"KRN",8994,1013,-1)
0^4
"KRN",8994,1013,0)
TIU LONG LIST SURGERY TITLES^LNGSURG^TIUSRVD^2^S
"KRN",8994,1013,1,0)
^8994.01^2^2^3010614^^
"KRN",8994,1013,1,1,0)
This RPC serves data to a longlist of selectable TITLES for the class
"KRN",8994,1013,1,2,0)
named in the CLNAME parameter.
"KRN",8994,1013,2,0)
^8994.02A^4^3
"KRN",8994,1013,2,2,0)
FROM^1^^1^1
"KRN",8994,1013,2,2,1,0)
^^1^1^2971118^^
"KRN",8994,1013,2,2,1,1,0)
This is the reference title from which the longlist is scrolling.
"KRN",8994,1013,2,3,0)
DIR^1^^^2
"KRN",8994,1013,2,3,1,0)
^8994.021^2^2^3010614^^^^
"KRN",8994,1013,2,3,1,1,0)
This is the direction in which the longlist is scrolling from the
"KRN",8994,1013,2,3,1,2,0)
reference title.
"KRN",8994,1013,2,4,0)
CLNAME^1^^1^3
"KRN",8994,1013,2,4,1,0)
^^5^5^3010614^
"KRN",8994,1013,2,4,1,1,0)
This is the name of the class for which titles are being presented.
"KRN",8994,1013,2,4,1,2,0)
Allowable values are:
"KRN",8994,1013,2,4,1,3,0)
 
"KRN",8994,1013,2,4,1,4,0)
"SURGICAL REPORTS"
"KRN",8994,1013,2,4,1,5,0)
"PROCEDURE REPORTS (NON-O.R.)"
"KRN",8994,1013,2,"B","CLNAME",4)

"KRN",8994,1013,2,"B","DIR",3)

"KRN",8994,1013,2,"B","FROM",2)

"KRN",8994,1013,2,"PARAMSEQ",1,2)

"KRN",8994,1013,2,"PARAMSEQ",2,3)

"KRN",8994,1013,2,"PARAMSEQ",3,4)

"KRN",8994,1013,3,0)
^8994.03^2^2^3010614^^
"KRN",8994,1013,3,1,0)
This is an array of the 44 nearest titles to that indicated by the user in
"KRN",8994,1013,3,2,0)
the direction passed by the longlist component.
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",516,-1)
1^1
"PKG",516,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",516,20,0)
^9.402P^^
"PKG",516,22,0)
^9.49I^1^1
"PKG",516,22,1,0)
1.0^3000126^2970815^11712
"PKG",516,22,1,"PAH",1,0)
112^3040326^1788
"PKG",516,22,1,"PAH",1,1,0)
^^2^2^3040326
"PKG",516,22,1,"PAH",1,1,1,0)
The description of this build is found in the National Patch Module under
"PKG",516,22,1,"PAH",1,1,2,0)
patch TIU*1*112.
"PRE")
TIUEC112
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
28
"RTN","TIUADD")
0^18^B38278097
"RTN","TIUADD",1,0)
TIUADD ; SLC/JER - Enter/Edit an addendum online ;2/13/02
"RTN","TIUADD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,88,100,112**;Jun 20, 1997
"RTN","TIUADD",3,0)
 ; 2/3: Update TEXTEDIT from TIUEDIT to TIUEDI4
"RTN","TIUADD",4,0)
ADDENDUM(TIUDA,TIUADD,TIUCHNG,TIUNOASK) ; Control branching
"RTN","TIUADD",5,0)
 N TIUY,TIUEDIT,TIUDADD K ^TMP("TIUADD",$J)
"RTN","TIUADD",6,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUADD",7,0)
 S TIUCHNG("ADDM")=1
"RTN","TIUADD",8,0)
 ; -- Get list of existing addenda, edit existing one --
"RTN","TIUADD",9,0)
 D ADDLIST(.TIUY,TIUDA)
"RTN","TIUADD",10,0)
 I +$D(TIUY),+$D(@TIUY) D  G:$D(DIRUT) ADDENX
"RTN","TIUADD",11,0)
 . W !
"RTN","TIUADD",12,0)
 . S TIUEDIT=+$$READ^TIUU("YO","Do you wish to EDIT an existing ADDENDUM","YES")
"RTN","TIUADD",13,0)
 . I +TIUEDIT D EDIT(TIUY) S TIUADD=1
"RTN","TIUADD",14,0)
 G:+$G(TIUADD) ADDENX
"RTN","TIUADD",15,0)
 ; -- Create new addendum to TIUDA: --
"RTN","TIUADD",16,0)
 I +$P($G(^TIU(8925,+TIUDA,0)),U,6)'>0 D  Q:$D(DIROUT)!(+TIUDADD'>0)
"RTN","TIUADD",17,0)
 . S TIUDADD=$$CANDO^TIULP(TIUDA,"MAKE ADDENDUM")
"RTN","TIUADD",18,0)
 . I '+TIUDADD D  Q
"RTN","TIUADD",19,0)
 . . W !!,$C(7),$P(TIUDADD,U,2),!
"RTN","TIUADD",20,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUADD",21,0)
 . I +TIUDADD D  Q:$D(DIROUT)
"RTN","TIUADD",22,0)
 . . I +$G(TIUNOASK)'>0,'+$$READ^TIUU("YO","Do you wish to ADD a new ADDENDUM","NO") Q
"RTN","TIUADD",23,0)
 . . D ADD(TIUDA,.TIUCHNG)
"RTN","TIUADD",24,0)
 . . ; -- Update ADDENDED? if browsing ID Note
"RTN","TIUADD",25,0)
 . . I TIUCHNG,$P($G(TIUGDATA),U,2) K VALMHDR
"RTN","TIUADD",26,0)
 I +$P(^TIU(8925,+TIUDA,0),U,6)>0 D
"RTN","TIUADD",27,0)
 . W !!,$C(7)," You may not make an ADDENDUM to an ADDENDUM.",!
"RTN","TIUADD",28,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUADD",29,0)
ADDENX ;Exit for ADDENDUM
"RTN","TIUADD",30,0)
 K ^TMP("TIUADD",$J)
"RTN","TIUADD",31,0)
 ;I $D(VALMAR),$$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUADD",32,0)
 Q
"RTN","TIUADD",33,0)
EDIT(TIUY) ;Edit existing addendum
"RTN","TIUADD",34,0)
 N TIUED,TIUDA,DA,DIC,DIE,TIUDAUTH,TIUPT,TIURDOC,DR,X,Y,TIUCNT
"RTN","TIUADD",35,0)
 S TIUCNT=0 F  S TIUCNT=$O(@TIUY@(TIUCNT)) Q:TIUCNT'>0  D  Q:$D(DIROUT)
"RTN","TIUADD",36,0)
 . N TIUQUIT
"RTN","TIUADD",37,0)
 . S TIUDA=+$G(@TIUY@(TIUCNT))
"RTN","TIUADD",38,0)
 . D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUADD",39,0)
 . W !!,"Displaying Addendum #",TIUCNT
"RTN","TIUADD",40,0)
 . D EN^VALM("TIU EDIT ADDENDUM") Q:$D(DIROUT)
"RTN","TIUADD",41,0)
 Q
"RTN","TIUADD",42,0)
EDADD ; Edit action
"RTN","TIUADD",43,0)
 N DA,DIC,DIE,DLAYGO,DIWESUB,TIUDAUTH,TIUMD,TIUPT,TIUECOS,TIUXINI,DR,X,Y
"RTN","TIUADD",44,0)
 N TIUDAD,TIUD0,TIUD12,TIUD13,TIUD14,TIUQUIT,TIUTYP,TIUT0,TIU
"RTN","TIUADD",45,0)
 K TIUBY,TIUCANED
"RTN","TIUADD",46,0)
 S TIUCANED=$$CANDO^TIULP(TIUDA,"EDIT RECORD")
"RTN","TIUADD",47,0)
 I +TIUCANED'>0 D  Q
"RTN","TIUADD",48,0)
 . W !!,$P(TIUCANED,U,2)
"RTN","TIUADD",49,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUADD",50,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD13=$G(^(13))
"RTN","TIUADD",51,0)
 S TIUD14=$G(^TIU(8925,+TIUDA,14))
"RTN","TIUADD",52,0)
 S TIUDAD=+$P($G(^TIU(8925,+TIUDA,0)),U,6)
"RTN","TIUADD",53,0)
 S DA=+TIUDA
"RTN","TIUADD",54,0)
 W !!,"Editing ADDENDUM"
"RTN","TIUADD",55,0)
 S TIUTYP=+$G(^TIU(8925,+DA,0)),TIUT0=$G(^TIU(8925.1,+TIUTYP,0))
"RTN","TIUADD",56,0)
 S TIUTYP(1)="1^"_+TIUTYP_U_$P(TIUT0,U,3)_U
"RTN","TIUADD",57,0)
 S TIUMD=$$ISA^USRLM(+$G(DUZ),"PROVIDER")
"RTN","TIUADD",58,0)
 S TIUPT=$P($G(^DPT(+$P(TIUD0,U,2),0)),U)
"RTN","TIUADD",59,0)
 S DIWESUB="Patient: "_TIUPT
"RTN","TIUADD",60,0)
 S DR=$$GETTMPL^TIUEDI1(+$P(^TIU(8925,+TIUDAD,0),U))
"RTN","TIUADD",61,0)
 D GETTIU^TIULD(.TIU,TIUDAD)
"RTN","TIUADD",62,0)
 ; -- Do DIE; get text, release, verify: --
"RTN","TIUADD",63,0)
 D ADDDIE(DA,DR,TIUDAD)
"RTN","TIUADD",64,0)
 I '$D(^TIU(8925,+DA,0)) S TIUCHNG=0,TIUCHNG("DELETE")=1 Q
"RTN","TIUADD",65,0)
 ; -- Update status, visit type, visit location: --
"RTN","TIUADD",66,0)
 S DR=".05///"_$$STATUS^TIULC(DA)_";.13////"_$P($G(TIU("VSTR")),";",3)_";1211////"_$P($G(TIU("VLOC")),U),DIE=8925 D ^DIE
"RTN","TIUADD",67,0)
 ; -- Set TIUCHNG: e.g. TIUCHNG = 2^addmIFN  (2 for entered/edited text);
"RTN","TIUADD",68,0)
 ;    TIUCHNG("EXIST") for edited EXISTING not new addm
"RTN","TIUADD",69,0)
 S TIUCHNG=2_"^"_+$G(DA),TIUCHNG("EXIST")=1,VALMBCK="Q"
"RTN","TIUADD",70,0)
 ; -- Sign, print: --
"RTN","TIUADD",71,0)
 I +$P(TIUPRM0,U,2) D
"RTN","TIUADD",72,0)
 . N TIUSIGN S TIUSIGN=$$CANDO^TIULP(DA,"SIGNATURE")
"RTN","TIUADD",73,0)
 . I '+TIUSIGN D  Q
"RTN","TIUADD",74,0)
 . . I +$$ISA^USRLM(+$G(DUZ),"TRANSCRIPTIONIST") Q
"RTN","TIUADD",75,0)
 . . W !,$C(7),$P(TIUSIGN,U,2)
"RTN","TIUADD",76,0)
 . . I '$D(VALMAR),$$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUADD",77,0)
 . I +TIUSIGN D EDSIG^TIURS(DA)
"RTN","TIUADD",78,0)
 . I +$P($G(TIUDPRM(0)),U,8) D PRINT^TIUEPRNT(DA)
"RTN","TIUADD",79,0)
 ; NOIS LOU-0598-40899
"RTN","TIUADD",80,0)
 I $G(TIUQUIT),+$$EMPTYDOC^TIULF(DA) D DELETE^TIUEDIT(DA) S TIUCHNG=0,TIUCHNG("DELETE")=1 H 2 Q
"RTN","TIUADD",81,0)
 Q
"RTN","TIUADD",82,0)
ADD(TIUDA,TIUCHNG) ;Add new addendum
"RTN","TIUADD",83,0)
 N DA,DIC,DIE,DLAYGO,DIWESUB,DR,TIUDAUTH,TIUMD,TIUPT,TIUECOS,TIUXINI,X,Y
"RTN","TIUADD",84,0)
 N TIUD0,TIUDV,TIUD12,TIUD13,TIUD14,TIUTYP,TIUT0,TIU,TIUFPRIV,TIUQUIT
"RTN","TIUADD",85,0)
 N LINENO,EXPANDED
"RTN","TIUADD",86,0)
 S TIUFPRIV=1
"RTN","TIUADD",87,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD13=$G(^(13))
"RTN","TIUADD",88,0)
 S TIUD14=$G(^TIU(8925,+TIUDA,14)),TIUDV=$P(TIUD0,U,3)
"RTN","TIUADD",89,0)
 S LINENO=+$O(^TMP("TIUR",$J,"IEN",TIUDA,0))
"RTN","TIUADD",90,0)
 I LINENO,$D(^TMP("TIUR",$J,"EXPAND",LINENO)) S EXPANDED=1
"RTN","TIUADD",91,0)
 I '$G(EXPANDED),$$HASIDKID^TIUGBR(TIUDA) W !!,"  You are addending an interdisciplinary note.  Your addendum will be added to",!,"the parent entry of the note." H 2
"RTN","TIUADD",92,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_$$ADDPTR_""""
"RTN","TIUADD",93,0)
 D ^DIC
"RTN","TIUADD",94,0)
 I +Y>0 S DA=+Y D
"RTN","TIUADD",95,0)
 . W !!,"Adding ADDENDUM"
"RTN","TIUADD",96,0)
 . S DIE="^TIU(8925,"
"RTN","TIUADD",97,0)
 . S DR=".03////"_TIUDV_";.04////"_+$$ADDCLASS_";.05////3;.06////"_TIUDA
"RTN","TIUADD",98,0)
 . S DR=DR_";1405////^S X=$P(TIUD14,U,5)"
"RTN","TIUADD",99,0)
 . D ^DIE
"RTN","TIUADD",100,0)
 . S TIUTYP=+$G(^TIU(8925,+DA,0)),TIUT0=$G(^TIU(8925.1,+TIUTYP,0))
"RTN","TIUADD",101,0)
 . S TIUTYP(1)="1^"_+TIUTYP_U_$P(TIUT0,U,3)_U
"RTN","TIUADD",102,0)
 . S TIUMD=$$ISA^USRLM(+$G(DUZ),"PROVIDER")
"RTN","TIUADD",103,0)
 . S TIUPT=$P($G(^DPT(+$P(TIUD0,U,2),0)),U)
"RTN","TIUADD",104,0)
 . S DIWESUB="Patient: "_TIUPT
"RTN","TIUADD",105,0)
 . S DR=$$GETTMPL^TIUEDI1(+$P(^TIU(8925,+TIUDA,0),U))
"RTN","TIUADD",106,0)
 . D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUADD",107,0)
 . D ADDDIE(DA,DR,TIUDA) I '$D(^TIU(8925,+DA,0)) S TIUCHNG=0,TIUCHNG("DELETE")=1 Q
"RTN","TIUADD",108,0)
 . S DR=".05///"_$$STATUS^TIULC(DA),DIE=8925 D ^DIE
"RTN","TIUADD",109,0)
 . S TIUCHNG=2_"^"_+$G(DA)
"RTN","TIUADD",110,0)
 . I +$P(TIUPRM0,U,2) D
"RTN","TIUADD",111,0)
 . . N TIUSIGN S TIUSIGN=$$CANDO^TIULP(DA,"SIGNATURE")
"RTN","TIUADD",112,0)
 . . I '+TIUSIGN D  Q
"RTN","TIUADD",113,0)
 . . . W !,$C(7),$P(TIUSIGN,U,2)
"RTN","TIUADD",114,0)
 . . . I '$D(VALMAR),$$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUADD",115,0)
 . . I +TIUSIGN D EDSIG^TIURS(DA)
"RTN","TIUADD",116,0)
 . I +$P($G(TIUDPRM(0)),U,8) D PRINT^TIUEPRNT(DA)
"RTN","TIUADD",117,0)
 . I $G(TIUQUIT) D DELETE^TIUEDIT(DA) S TIUCHNG=0,TIUCHNG("DELETE")=1 Q
"RTN","TIUADD",118,0)
 Q
"RTN","TIUADD",119,0)
ADDPTR() ; Get record # of ADDENDUM in 8925.1
"RTN","TIUADD",120,0)
 N DIC,X,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUADD",121,0)
 S DIC=8925.1,DIC(0)="FMX",X="ADDENDUM"
"RTN","TIUADD",122,0)
 S DIC("S")="I $P($G(^TIU(8925.1,+Y,0)),U,4)=""DOC"""
"RTN","TIUADD",123,0)
 D ^DIC K DIC("S")
"RTN","TIUADD",124,0)
 Q +Y
"RTN","TIUADD",125,0)
ADDCLASS() ; Get record # of ADDENDUM Document Class in 8925.1
"RTN","TIUADD",126,0)
 N DIC,X,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUADD",127,0)
 S DIC=8925.1,DIC(0)="FMX",X="ADDENDUM"
"RTN","TIUADD",128,0)
 S DIC("S")="I $P($G(^TIU(8925.1,+Y,0)),U,4)=""DC"""
"RTN","TIUADD",129,0)
 D ^DIC K DIC("S")
"RTN","TIUADD",130,0)
 Q +Y
"RTN","TIUADD",131,0)
ADDDIE(DA,DR,TIUDA) ; Call DIE to conduct dialog
"RTN","TIUADD",132,0)
 N TIUREL,TIUD0,TIUD12,TIUD13,TIUD14,DTOUT,Y,DWPK
"RTN","TIUADD",133,0)
 S DIE=8925 D ^DIE
"RTN","TIUADD",134,0)
 I $D(Y)!($D(DTOUT)) S TIUQUIT=1
"RTN","TIUADD",135,0)
 D:+$G(TIUQUIT) SEND^TIUALRT(DA)
"RTN","TIUADD",136,0)
 I '+$G(TIUQUIT) D
"RTN","TIUADD",137,0)
 . D TEXTEDIT^TIUEDI4(DA)
"RTN","TIUADD",138,0)
 . I $$EMPTYDOC^TIULF(DA) D DELETE^TIUEDIT(DA,0) Q
"RTN","TIUADD",139,0)
 . ; -- Not clear why I need these nodes 0,12,13,14: --
"RTN","TIUADD",140,0)
 . S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^(12)),TIUD13=$G(^(13))
"RTN","TIUADD",141,0)
 . S TIUD14=$G(^TIU(8925,+DA,14))
"RTN","TIUADD",142,0)
 . ; Execute RELEASE Logic
"RTN","TIUADD",143,0)
 . D RELEASE^TIUT(DA) S TIUREL=""
"RTN","TIUADD",144,0)
 . ; Execute VERIFY Logic
"RTN","TIUADD",145,0)
 . D VERIFY^TIUT(DA)
"RTN","TIUADD",146,0)
 . ; Send Addendum Alert
"RTN","TIUADD",147,0)
 . D SENDADD^TIUALRT(DA)
"RTN","TIUADD",148,0)
 Q
"RTN","TIUADD",149,0)
ADDLIST(Y,TIUDA) ; Get list of addenda for a record
"RTN","TIUADD",150,0)
 N TIUI,TIUCNT S (TIUCNT,TIUI)=0 K ^TMP("TIUADD",$J)
"RTN","TIUADD",151,0)
 F  S TIUI=$O(^TIU(8925,"DAD",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUADD",152,0)
 . Q:+$$ISADDNDM^TIULC1(TIUI)'>0
"RTN","TIUADD",153,0)
 . Q:+$$CANDO^TIULP(TIUI,"EDIT RECORD")'>0
"RTN","TIUADD",154,0)
 . S TIUCNT=TIUCNT+1,^TMP("TIUADD",$J,TIUCNT)=TIUI
"RTN","TIUADD",155,0)
 I $D(^TMP("TIUADD",$J)) S Y=$NA(^TMP("TIUADD",$J))
"RTN","TIUADD",156,0)
 Q
"RTN","TIUBR")
0^1^B41348643
"RTN","TIUBR",1,0)
TIUBR ; SLC/JER - Browse Action Subroutines ;4/18/2001 16:36
"RTN","TIUBR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**32,87,93,58,100,162,112**;Jun 20, 1997
"RTN","TIUBR",3,0)
 ; Move LOADSIG, XTRASIG, LOADFOR, LOADREC to TIUBR1.
"RTN","TIUBR",4,0)
EN ; Entry code for LM templates TIU BROWSE
"RTN","TIUBR",5,0)
 N TIUY
"RTN","TIUBR",6,0)
 ;Kill TIUGDATA in CLEAN; don't new it here
"RTN","TIUBR",7,0)
 ; -- Set TIUGDATA, which describes the note originally
"RTN","TIUBR",8,0)
 ;    selected to be browsed. --
"RTN","TIUBR",9,0)
 ; TIUGDATA = 0 or
"RTN","TIUBR",10,0)
 ;          = TIUDA^HASIDKID^TIUD21^PRMSORT, where
"RTN","TIUBR",11,0)
 ;            PRMSORT = "TITLE" or "REFDT".  See 8925.95, fld .18
"RTN","TIUBR",12,0)
 S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIUBR",13,0)
 D BLDTMP(TIUDA)
"RTN","TIUBR",14,0)
 Q
"RTN","TIUBR",15,0)
HDR ; Build Header
"RTN","TIUBR",16,0)
 N TIUDTYP,DFN
"RTN","TIUBR",17,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUBR",18,0)
 D:$D(TIU)'>9 GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUBR",19,0)
 S VALMHDR(1)=$$CENTER^TIULS($P($G(TIU("DOCTYP")),U,2))
"RTN","TIUBR",20,0)
 ;  Docmt header line Patname, SSN, [Location, Visit]:
"RTN","TIUBR",21,0)
 S VALMHDR(2)=$$SETREC(TIUGDATA)
"RTN","TIUBR",22,0)
 Q
"RTN","TIUBR",23,0)
BLDTMP(TIUDA) ; Build ^TMP("TIUVIEW",$J,
"RTN","TIUBR",24,0)
 ; Requires TIUDA = IFN of note selected to be browsed.
"RTN","TIUBR",25,0)
 ; Needs TIUGDATA, set in EN
"RTN","TIUBR",26,0)
 N TIUI,TIUL,TIUREC,TIUDADD,ONBROWSE S (TIUDADD,TIUI)=0
"RTN","TIUBR",27,0)
 N TIUNAME K ^TMP("TIUVIEW",$J),^TMP("TIU FOCUS",$J)
"RTN","TIUBR",28,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUBR",29,0)
 S ^TMP("TIU FOCUS",$J)=TIUDA
"RTN","TIUBR",30,0)
 D INQUIRE^TIUGBR(TIUDA,.TIUREC)
"RTN","TIUBR",31,0)
 I $D(TIUREC)>9 W !!,"Opening "_TIUREC(8925,+TIUDA,.01)_" record for review..."
"RTN","TIUBR",32,0)
 ; --- if the document has a browse action, execute it ---
"RTN","TIUBR",33,0)
 S ONBROWSE=$$ONBROWSE^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUBR",34,0)
 I $L(ONBROWSE) D LOADSUPP(ONBROWSE,TIUDA,.TIUL)
"RTN","TIUBR",35,0)
 ; ---- Load dictation, transcription data, etc.: ----
"RTN","TIUBR",36,0)
 D LOADTOP(.TIUREC,TIUDA,.TIUL,TIUGDATA)
"RTN","TIUBR",37,0)
 ; ---- Load the remainder of the record: ----
"RTN","TIUBR",38,0)
 D LOADREC^TIUBR1(TIUDA,.TIUL,TIUGDATA)
"RTN","TIUBR",39,0)
 K ^TMP("TIU FOCUS",$J)
"RTN","TIUBR",40,0)
 S ^TMP("TIUVIEW",$J,0)=$G(^TIU(8925,+TIUDA,"TEXT",0))
"RTN","TIUBR",41,0)
 S $P(^TMP("TIUVIEW",$J,0),U,3,4)=$G(TIUL)_U_$G(TIUL),VALMCNT=+$G(TIUL)
"RTN","TIUBR",42,0)
 Q
"RTN","TIUBR",43,0)
LOADSUPP(METHOD,TIUDA,TIUL)     ; Execute OnBrowse/Load Supplementary data
"RTN","TIUBR",44,0)
 N TIUY,TIUI S TIUI=0
"RTN","TIUBR",45,0)
 X METHOD I '$D(@TIUY) Q
"RTN","TIUBR",46,0)
 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUBR",47,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=$G(@TIUY@(TIUI))
"RTN","TIUBR",48,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR",49,0)
 K @TIUY
"RTN","TIUBR",50,0)
 Q
"RTN","TIUBR",51,0)
LOADTOP(TIUREC,TIUDA,TIUL,TIUGDATA) ; Load dictation, transcription data, etc.
"RTN","TIUBR",52,0)
 ; Requires array TIUREC, TIUDA, array TIUL, TIUGDATA
"RTN","TIUBR",53,0)
 N TIUY,SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT
"RTN","TIUBR",54,0)
 ; ---- For ID note, include Title, [Location, & Visit] with each
"RTN","TIUBR",55,0)
 ;      entry, since they vary by entry.
"RTN","TIUBR",56,0)
 ; ---- Follow with Date, Author, etc.
"RTN","TIUBR",57,0)
 ; ---- For ID children in whole note display, shorten top info:
"RTN","TIUBR",58,0)
 ;      Instead of Title, Location, Visit, Date, Author, etc.,
"RTN","TIUBR",59,0)
 ;      use just Title, followed by just Date and Status:
"RTN","TIUBR",60,0)
 S (SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT)=0
"RTN","TIUBR",61,0)
 I $P(TIUGDATA,U,3) S SELCHLD=1 ; Selected record was IDchild
"RTN","TIUBR",62,0)
 I $P(TIUGDATA,U,2) S SELPRNT=1
"RTN","TIUBR",63,0)
 I SELCHLD,TIUDA'=$P(TIUGDATA,U,3) S CURCHLD=1 ; Current rec is IDchild
"RTN","TIUBR",64,0)
 I SELCHLD,TIUDA=$P(TIUGDATA,U,3) S CURPRNT=1
"RTN","TIUBR",65,0)
 I SELPRNT,TIUDA=+TIUGDATA S CURPRNT=1
"RTN","TIUBR",66,0)
 I SELPRNT,TIUDA'=+TIUGDATA S CURCHLD=1
"RTN","TIUBR",67,0)
 I SELPRNT,CURCHLD S SHORT=1 ;Child in whole note: shorten top info
"RTN","TIUBR",68,0)
 I SELCHLD,CURCHLD,$G(TIUGWHOL) S SHORT=1
"RTN","TIUBR",69,0)
 I SELCHLD!SELPRNT D
"RTN","TIUBR",70,0)
 . D IDTOP^TIUGBR(TIUDA,.TIUL,SHORT,CURPRNT)
"RTN","TIUBR",71,0)
 S TIUL=+$G(TIUL)+1,TIUY=""
"RTN","TIUBR",72,0)
 I SHORT D
"RTN","TIUBR",73,0)
 . S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),$G(TIUY),1,39)
"RTN","TIUBR",74,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),$G(TIUY),42,38)
"RTN","TIUBR",75,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",76,0)
 I 'SHORT D
"RTN","TIUBR",77,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUBR",78,0)
 . . S TIUY=$$SETSTR^VALM1("DICT DATE: "_TIUREC(8925,+TIUDA,1307),$G(TIUY),4,39)
"RTN","TIUBR",79,0)
 . E  S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),$G(TIUY),1,39)
"RTN","TIUBR",80,0)
 . S TIUY=$$SETSTR^VALM1("ENTRY DATE: "_TIUREC(8925,+TIUDA,1201),$G(TIUY),38,39)
"RTN","TIUBR",81,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",82,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",83,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUBR",84,0)
 . . S TIUY=$$SETSTR^VALM1("DICTATED BY: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),2,32)
"RTN","TIUBR",85,0)
 . E  S TIUY=$$SETSTR^VALM1("AUTHOR: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),7,32)
"RTN","TIUBR",86,0)
 . I $L(TIUREC(8925,+TIUDA,1209)) D  I 1
"RTN","TIUBR",87,0)
 . . S TIUY=$$SETSTR^VALM1("ATTENDING: "_TIUREC(8925,+TIUDA,1209),$G(TIUY),39,40)
"RTN","TIUBR",88,0)
 . E  S TIUY=$$SETSTR^VALM1("EXP COSIGNER: "_TIUREC(8925,+TIUDA,1208),$G(TIUY),36,40)
"RTN","TIUBR",89,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",90,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",91,0)
 . S TIUY=$$SETSTR^VALM1("URGENCY: "_TIUREC(8925,+TIUDA,.09),$G(TIUY),6,36)
"RTN","TIUBR",92,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),$G(TIUY),42,38)
"RTN","TIUBR",93,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",94,0)
 S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",95,0)
 I '$L($G(^TIU(8925,+TIUDA,17))) S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",96,0)
 E  D
"RTN","TIUBR",97,0)
 . S TIUY=$$SETSTR^VALM1("SUBJECT: "_$G(^TIU(8925,+TIUDA,17)),$G(TIUY),6,74)
"RTN","TIUBR",98,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",99,0)
 . S TIUL=TIUL+1,TIUY="",@VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",100,0)
 I +$$HASADDEN^TIULC1(TIUDA) D
"RTN","TIUBR",101,0)
 . S TIUY="   *** "_$$PNAME^TIULC1(+$G(^TIU(8925,TIUDA,0)))_" Has ADDENDA ***"
"RTN","TIUBR",102,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",103,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR",104,0)
 Q
"RTN","TIUBR",105,0)
 ;
"RTN","TIUBR",106,0)
LOADKIDS(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load ID kids of TIUDA
"RTN","TIUBR",107,0)
 ; Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUBR",108,0)
 N TIUK,PRMSORT,KIDDA,TIUD0,TIUD21
"RTN","TIUBR",109,0)
 I $G(^TMP("TIUR",$J,"IDDATA",TIUDA)) S PRMSORT=$P(^TMP("TIUR",$J,"IDDATA",TIUDA),U,4)
"RTN","TIUBR",110,0)
 E  S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD21=$G(^TIU(8925,TIUDA,21)),PRMSORT=$P($$IDDATA^TIURECL1(TIUDA,TIUD0,TIUD21),U,4)
"RTN","TIUBR",111,0)
 D GETIDKID^TIURECL2(TIUDA,PRMSORT) ; sets array ^TMP("TIUIDKID",$J,
"RTN","TIUBR",112,0)
 S TIUK=0
"RTN","TIUBR",113,0)
 F  S TIUK=$O(^TMP("TIUIDKID",$J,TIUDA,TIUK)) Q:+TIUK'>0  D
"RTN","TIUBR",114,0)
 . S KIDDA=^TMP("TIUIDKID",$J,TIUDA,TIUK)
"RTN","TIUBR",115,0)
 . D LOADID^TIUGBR(KIDDA,.TIUL,TIUGDATA,$G(TIUGWHOL))
"RTN","TIUBR",116,0)
 K ^TMP("TIUIDKID",$J)
"RTN","TIUBR",117,0)
 Q
"RTN","TIUBR",118,0)
 ;
"RTN","TIUBR",119,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUBR",120,0)
 N TIUY,TIUTYP
"RTN","TIUBR",121,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUBR",122,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUBR",123,0)
 Q TIUY
"RTN","TIUBR",124,0)
LOADADD(TIUDADD,TIUL) ; Load addenda
"RTN","TIUBR",125,0)
 N TIUDADT,TIUJ,CANSEE
"RTN","TIUBR",126,0)
 S CANSEE=$$CANDO^TIULP(+TIUDADD,"VIEW")
"RTN","TIUBR",127,0)
 S TIUJ=0,TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR",128,0)
 S TIUDADT=$$DATE^TIULS($P($G(^TIU(8925,+TIUDADD,13)),U),"MM/DD/CCYY")
"RTN","TIUBR",129,0)
 S TIUL=TIUL+1,@VALMAR@(TIUL,0)=TIUDADT_" ADDENDUM"_"                      STATUS: "_$$STATUS^TIULF(TIUDADD) ;P162
"RTN","TIUBR",130,0)
 I +CANSEE'>0 D  Q
"RTN","TIUBR",131,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR",132,0)
 . S @VALMAR@(TIUL,0)=$P(CANSEE,U,2)
"RTN","TIUBR",133,0)
 F  S TIUJ=$O(^TIU(8925,+TIUDADD,"TEXT",TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUBR",134,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR",135,0)
 . S @VALMAR@(TIUL,0)=$G(^TIU(8925,+TIUDADD,"TEXT",TIUJ,0))
"RTN","TIUBR",136,0)
 D LOADSIG^TIUBR1(TIUDADD,.TIUL)
"RTN","TIUBR",137,0)
 Q
"RTN","TIUBR",138,0)
 ;
"RTN","TIUBR",139,0)
SETREC(TIUGDATA) ; Sets docmt header line Patname, SSN, [Location, Visit]
"RTN","TIUBR",140,0)
 ; Requires TIUGDATA
"RTN","TIUBR",141,0)
 N Y
"RTN","TIUBR",142,0)
 S Y=$$SETSTR^VALM1($$NAME^TIULS($G(TIU("PNM")),"LAST,FI MI"),$G(Y),1,15)
"RTN","TIUBR",143,0)
 S Y=$$SETSTR^VALM1($G(TIU("SSN")),$G(Y),16,12)
"RTN","TIUBR",144,0)
 ; ---- If TIUDA is an ID entry, write ID, ADDENDED? in header
"RTN","TIUBR",145,0)
 ;      and leave out entry-specific info (Location, Visit)
"RTN","TIUBR",146,0)
 ;      since that goes with each individual entry: ----
"RTN","TIUBR",147,0)
 I $P(TIUGDATA,U,2)!$P(TIUGDATA,U,3) D  G SETRX
"RTN","TIUBR",148,0)
 . S Y=$$SETSTR^VALM1("Interdisciplinary "_$S($P(TIUGDATA,U,2):"Note",1:"Entry"),$G(Y),29,23)
"RTN","TIUBR",149,0)
 . I $P(TIUGDATA,U,2) S Y=$$SETSTR^VALM1("ADDENDED?"_$S($$HASADDEN^TIULC1(+TIUDA,1):" Yes",1:" No"),$G(Y),66,13)
"RTN","TIUBR",150,0)
 S Y=$$SETSTR^VALM1($P($G(TIU("LOC")),U,2),$G(Y),30,17)
"RTN","TIUBR",151,0)
 I $L($G(TIU("WARD"))) D
"RTN","TIUBR",152,0)
 . S Y=$$SETSTR^VALM1("Adm: "_$$DATE^TIULS(+TIU("EDT"),"MM/DD/CCYY"),$G(Y),48,15)
"RTN","TIUBR",153,0)
 . S Y=$$SETSTR^VALM1("Dis: "_$$DATE^TIULS(+TIU("LDT"),"MM/DD/CCYY"),$G(Y),65,15)
"RTN","TIUBR",154,0)
 I '$L($G(TIU("WARD"))) D
"RTN","TIUBR",155,0)
 . S Y=$$SETSTR^VALM1("Visit Date: "_$$DATE^TIULS(+$G(TIU("EDT")),"MM/DD/CCYY HR:MIN"),$G(Y),51,28)
"RTN","TIUBR",156,0)
SETRX Q Y
"RTN","TIUBR",157,0)
 ;
"RTN","TIUBR",158,0)
CLEAN ; Die, filthy spawn!!!
"RTN","TIUBR",159,0)
 D CLEAN^VALM10 K VALMHDR,TIU,TIUPRM0,TIUPRM1,TIUGDATA
"RTN","TIUBR",160,0)
 Q
"RTN","TIUEC112")
0^^B3751626
"RTN","TIUEC112",1,0)
TIUEC112 ; SLC/AJB Environment Check for TIU*1*112;07/31/2003 11:30
"RTN","TIUEC112",2,0)
 ;;1.0;Text Integration Utilities;**112**;Jun 20, 1997
"RTN","TIUEC112",3,0)
ECHK ;
"RTN","TIUEC112",4,0)
 N TMP
"RTN","TIUEC112",5,0)
 D
"RTN","TIUEC112",6,0)
 .N DC,LINE S LINE=0
"RTN","TIUEC112",7,0)
 .F  S LINE=LINE+1,DC=$P($T(TITLES+LINE),";;",2) Q:DC="EOM"  D
"RTN","TIUEC112",8,0)
 ..N DIC,X,Y
"RTN","TIUEC112",9,0)
 ..S DIC="8925.1",DIC(0)="X"
"RTN","TIUEC112",10,0)
 ..S X=DC
"RTN","TIUEC112",11,0)
 ..D ^DIC
"RTN","TIUEC112",12,0)
 ..I +Y>0,$P(^TIU(8925.1,+Y,0),U,13)'=1 S TMP(LINE)=$$GET1^DIQ(8925.1,+Y,.01)_" ("_$$GET1^DIQ(8925.1,+Y,.04)_") is not a NATIONAL STANDARD entry."
"RTN","TIUEC112",13,0)
 I $D(TMP) D
"RTN","TIUEC112",14,0)
 .D MES^XPDUTL("The following entries in the TIU DOCUMENT DEFINITION FILE conflict with")
"RTN","TIUEC112",15,0)
 .D MES^XPDUTL("the DOCUMENT CLASSES and TITLES needed for this installation."),MES^XPDUTL(" ")
"RTN","TIUEC112",16,0)
 .S TMP="" F  S TMP=$O(TMP(TMP)) Q:TMP=""  D MES^XPDUTL(TMP(TMP))
"RTN","TIUEC112",17,0)
 I  D BMES^XPDUTL("Please rename the entries before restarting the installation of this patch.") S XPDABORT=2 Q
"RTN","TIUEC112",18,0)
 D BMES^XPDUTL("The environment check has completed successfully.")
"RTN","TIUEC112",19,0)
 Q
"RTN","TIUEC112",20,0)
TITLES ;
"RTN","TIUEC112",21,0)
 ;;SURGICAL REPORTS
"RTN","TIUEC112",22,0)
 ;;OPERATION REPORTS
"RTN","TIUEC112",23,0)
 ;;OPERATION REPORT
"RTN","TIUEC112",24,0)
 ;;NURSE INTRAOPERATIVE REPORTS
"RTN","TIUEC112",25,0)
 ;;NURSE INTRAOPERATIVE REPORT
"RTN","TIUEC112",26,0)
 ;;ANESTHESIA REPORTS
"RTN","TIUEC112",27,0)
 ;;ANESTHESIA REPORT
"RTN","TIUEC112",28,0)
 ;;PROCEDURE REPORT (NON-O.R.)
"RTN","TIUEC112",29,0)
 ;;PROCEDURE REPORT
"RTN","TIUEC112",30,0)
 ;;EOM
"RTN","TIUEC112",31,0)
 Q
"RTN","TIUEDIM")
0^25^B18777304
"RTN","TIUEDIM",1,0)
TIUEDIM ; SLC/JER - Enter/Edit Multiple Document ; 6/14/2002
"RTN","TIUEDIM",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,41,52,100,109,112**;Jun 20, 1997
"RTN","TIUEDIM",3,0)
 ; 2/2: Update DIE from TIUEDIT to TIUEDI4
"RTN","TIUEDIM",4,0)
MAIN(TIUCLASS,TIUOUT,TIUNDA,TIUCHNG) ; Control Branching
"RTN","TIUEDIM",5,0)
 N TIUREL,TIUCHK,TIUDA,TIUEDIT,TIUY,TIUNEW,TIUTYP,TIUPAT
"RTN","TIUEDIM",6,0)
 N TIUI,DTOUT S TIUDFLT=""
"RTN","TIUEDIM",7,0)
 K DIROUT
"RTN","TIUEDIM",8,0)
 ; --- Get one or more patients ---
"RTN","TIUEDIM",9,0)
 I '$L($T(PATIENT^ORU1)) Q
"RTN","TIUEDIM",10,0)
 D PATIENT^ORU1(.TIUPAT) I +TIUPAT'>0 S TIUOUT=1 Q
"RTN","TIUEDIM",11,0)
 S TIUI=0 F  S TIUI=+$O(TIUPAT(TIUI)) Q:+TIUI'>0!+$G(TIUOUT)  D
"RTN","TIUEDIM",12,0)
 . N DFN,DUOUT,TIUDPRM,TIU,TIULMETH,TIUVMETH,VAIN,VADM,TIUDA,TIUEDIT
"RTN","TIUEDIM",13,0)
 . N TIUENTRY,TIUCMMTX,TIUVSUPP,CANEDIT
"RTN","TIUEDIM",14,0)
 . S TIUVSUPP=0
"RTN","TIUEDIM",15,0)
 . S DFN=+$G(TIUPAT(TIUI)) Q:+DFN'>0
"RTN","TIUEDIM",16,0)
 . W !!,"For Patient ",$P(TIUPAT(TIUI),U,2)
"RTN","TIUEDIM",17,0)
 . S TIUCLASS=$G(TIUCLASS,38)
"RTN","TIUEDIM",18,0)
 . I TIUCLASS=3,$S(+$$ISA^USRLM(DUZ,"TRANSCRIPTIONIST"):0,1:1),(+$G(NOSAVE)'>0) D EXSTNOTE^TIUEDI2(DFN) D:$G(VALMAR)="^TMP(""OR"",$J,""CURRENT"")" FULL^VALM1
"RTN","TIUEDIM",19,0)
 . I +$G(DIROUT)!+$G(DUOUT)!+$G(DTOUT) S TIUOUT=1 Q
"RTN","TIUEDIM",20,0)
 . ; -- Set title array TIUTYP (use TIUTITLE or ask user) --
"RTN","TIUEDIM",21,0)
 . D SETTL^TIUEDI4(.TIUTYP,TIUCLASS,$G(TIUTITLE)) I +$G(TIUTYP)'>0 S TIUOUT=1 Q
"RTN","TIUEDIM",22,0)
 . ; --- Re-direct surgical reports ---
"RTN","TIUEDIM",23,0)
 . I +$$ISA^TIULX(TIUTYP,+$$CLASS^TIUSROI("SURGICAL REPORTS")) D ENTEROP^TIUSROI(DFN,TIUTYP) Q
"RTN","TIUEDIM",24,0)
 . ; -- Get doc parameters for title, X entry action --
"RTN","TIUEDIM",25,0)
 . D DOCPRM^TIULC1(TIUTYP,.TIUDPRM)
"RTN","TIUEDIM",26,0)
 . S TIUENTRY=$$GETENTRY^TIUEDI2(+TIUTYP)
"RTN","TIUEDIM",27,0)
 . I $L(TIUENTRY) X TIUENTRY
"RTN","TIUEDIM",28,0)
 . Q:+$G(TIUOUT)  ; If ENTRY ACTION sets TIUOUT=1 Abort Entry
"RTN","TIUEDIM",29,0)
 . ; -- Set visit array TIU --
"RTN","TIUEDIM",30,0)
 . ; NOTE: EVNTFLAG is set in TIUEDIT, prior to calling this routine
"RTN","TIUEDIM",31,0)
 . D GETVST^TIUEDI4(DFN,TIUTYP,.TIU,EVNTFLAG)
"RTN","TIUEDIM",32,0)
 . I $S($G(TIUQUIT):1,'$D(TIU("VSTR")):1,1:0) Q
"RTN","TIUEDIM",33,0)
 . ; -- Ask OK --
"RTN","TIUEDIM",34,0)
 . S TIUVMETH=$$GETVMETH^TIUEDI1(TIUTYP)
"RTN","TIUEDIM",35,0)
 . I '$L(TIUVMETH) D  S TIUOUT=1 Q
"RTN","TIUEDIM",36,0)
 . . W !,$C(7),"No Validation Method defined for "
"RTN","TIUEDIM",37,0)
 . . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIUEDIM",38,0)
 . X TIUVMETH
"RTN","TIUEDIM",39,0)
 . I $S($D(DIROUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 Q
"RTN","TIUEDIM",40,0)
 . I $D(DUOUT) Q
"RTN","TIUEDIM",41,0)
 . ; -- If user OK'd basic info, go on to get text, etc.: --
"RTN","TIUEDIM",42,0)
 . I $D(TIU),+$G(TIUASK) D
"RTN","TIUEDIM",43,0)
 . . ; -- Get record DA --
"RTN","TIUEDIM",44,0)
 . . ; DA is either: new stub record, ready for edit, or
"RTN","TIUEDIM",45,0)
 . . ;               existing record, for edit, or
"RTN","TIUEDIM",46,0)
 . . ;               existing record, for addendum      
"RTN","TIUEDIM",47,0)
 . . N DA
"RTN","TIUEDIM",48,0)
 . . S DA=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM,1,DUZ,.CANEDIT)
"RTN","TIUEDIM",49,0)
 . . I +DA'>0 W !,"Unable to enter/edit." Q
"RTN","TIUEDIM",50,0)
 . . ; -- [Addend DA and Quit] --
"RTN","TIUEDIM",51,0)
 . . ;  If record not new & user can't edit it, user said
"RTN","TIUEDIM",52,0)
 . . ;  in GETRECNW they wanted to addend, so let user write
"RTN","TIUEDIM",53,0)
 . . ;  addendum and quit:
"RTN","TIUEDIM",54,0)
 . . I 'TIUNEW,'CANEDIT D ADDENDUM^TIUADD(DA,"",.TIUCHNG,1) Q
"RTN","TIUEDIM",55,0)
 . . N TIUQUIT,TIUADD,TIUTDA
"RTN","TIUEDIM",56,0)
 . . ; -- Edit new or existing DA --
"RTN","TIUEDIM",57,0)
 . . D DIE^TIUEDI4(DA,.TIUQUIT)
"RTN","TIUEDIM",58,0)
 . . Q:+$G(TIUQUIT)=2  ; DA doesn't exist (e.g. uparrowed w/ bad record)
"RTN","TIUEDIM",59,0)
 . . ;If (CP) and (Timeout or Not Select Consult) and (Consult Associated), Quit before EMPTYDOC check
"RTN","TIUEDIM",60,0)
 . . I +$$ISA^TIULX(TIUTYP,+$$CLASS^TIUCP),+$G(TIUQUIT)=1,+$P($G(^TIU(8925,+DA,14)),U,5)>0 Q
"RTN","TIUEDIM",61,0)
 . . I $$EMPTYDOC^TIULF(DA) D DELETE^TIUEDIT(DA,0) S:$G(VALMAR)="^TMP(""TIUVIEW"",$J)" VALMBCK="Q" S:'+$G(TIUNEW) TIUCHNG("DELETE")=1 H:'+$G(TIUNEW) 2 Q
"RTN","TIUEDIM",62,0)
 . . Q:+$G(TIUQUIT)
"RTN","TIUEDIM",63,0)
 . . S:+DA SUCCESS=+DA
"RTN","TIUEDIM",64,0)
 . . I +$G(TIUONCE) S TIUNDA(+$G(DA))="" ; See TIURC, Across Patients
"RTN","TIUEDIM",65,0)
 . . ; -- Misc after-edit-stuff for DA --
"RTN","TIUEDIM",66,0)
 . . ; -- Mark to ask workload at signature;
"RTN","TIUEDIM",67,0)
 . . ;    (STOP for Stop codes for stand-alone visits): --
"RTN","TIUEDIM",68,0)
 . . I +$G(TIU("STOP")),(+$P($G(TIUDPRM(0)),U,14)'=1) D DEFER^TIUVSIT(DA,TIU("STOP")) I 1
"RTN","TIUEDIM",69,0)
 . . E  D QUE^TIUPXAP1 ; Post workload now in background
"RTN","TIUEDIM",70,0)
 . . S TIUCMMTX=$$COMMIT^TIULC1(+$P(TIUTYP(1),U,2))
"RTN","TIUEDIM",71,0)
 . . I TIUCMMTX]"" X TIUCMMTX
"RTN","TIUEDIM",72,0)
 . . D RELEASE^TIUT(DA)
"RTN","TIUEDIM",73,0)
 . . D VERIFY^TIUT(DA)
"RTN","TIUEDIM",74,0)
 . . ; -- Get signature for DA 
"RTN","TIUEDIM",75,0)
 . . D EDSIG^TIURS(DA)
"RTN","TIUEDIM",76,0)
 . . ; - execute EXIT ACTION -
"RTN","TIUEDIM",77,0)
 . . S TIUEXIT=$$GETEXIT^TIUEDI2(+$P(TIUTYP(1),U,2))
"RTN","TIUEDIM",78,0)
 . . I $L(TIUEXIT) S TIUTDA=DA X TIUEXIT S DA=TIUTDA
"RTN","TIUEDIM",79,0)
 . . ; --  [Prompt to print DA] --
"RTN","TIUEDIM",80,0)
 . . I +$P($G(TIUDPRM(0)),U,8) D PRINT^TIUEPRNT(DA)
"RTN","TIUEDIM",81,0)
 Q
"RTN","TIUEDIT")
0^24^B39405291
"RTN","TIUEDIT",1,0)
TIUEDIT ; SLC/JER - Enter/Edit a Document ; 6/11/2002
"RTN","TIUEDIT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,7,22,52,100,109,112**;Jun 20, 1997
"RTN","TIUEDIT",3,0)
 ; Moved LOADDFLT, BOIL, CANXEC, REPLACE, INSMULT to TIUEDI4
"RTN","TIUEDIT",4,0)
 ; Moved DIE, TEXTEDIT from TIUEDIT to TIUEDI4
"RTN","TIUEDIT",5,0)
 ; Separated out modules SETTL, GETVST, ASKOK
"RTN","TIUEDIT",6,0)
 ; Moved SETTL, GETVST, ASKOK from TIUEDIT to TIUEDI4
"RTN","TIUEDIT",7,0)
 ; Changed call to GETREC^TIUEDI1 to call GETRECNW^TIUEDI3
"RTN","TIUEDIT",8,0)
MAIN(TIUCLASS,SUCCESS,DFN,TIUTITLE,EVNTFLAG,NOSAVE,TIUNDA,TIUSNGL,TIUCHNG) ; Create new document(s)
"RTN","TIUEDIT",9,0)
 ; May branch off to edit existing docmt instead of creating new one.
"RTN","TIUEDIT",10,0)
 ; Call with: [TIUCLASS] --> pointer to file (8925) corresponding to
"RTN","TIUEDIT",11,0)
 ;                           the class (e.g., Progress Notes=3)
"RTN","TIUEDIT",12,0)
 ;                           from which to select a title
"RTN","TIUEDIT",13,0)
 ;    [by ref] [SUCCESS] --> Boolean flag returned as IFN when a
"RTN","TIUEDIT",14,0)
 ;                           record is created, or 0 when record
"RTN","TIUEDIT",15,0)
 ;                           creation fails
"RTN","TIUEDIT",16,0)
 ;                 [DFN] --> IEN in patient file (#2)
"RTN","TIUEDIT",17,0)
 ;            [TIUTITLE] --> Pointer or NAME or PTR^NAME of the
"RTN","TIUEDIT",18,0)
 ;                           TITLE from file 8925.1 to be used as
"RTN","TIUEDIT",19,0)
 ;                           the default.
"RTN","TIUEDIT",20,0)
 ;            [EVNTFLAG] --> Boolean flag for visit prompt (0 to
"RTN","TIUEDIT",21,0)
 ;                           prompt, 1 to force event type visit)
"RTN","TIUEDIT",22,0)
 ;              [NOSAVE] --> Boolean flag to suppress saving the data
"RTN","TIUEDIT",23,0)
 ;                           (e.g., when testing new Boilerplates
"RTN","TIUEDIT",24,0)
 ;                           using DDEF action TRY, etc.).
"RTN","TIUEDIT",25,0)
 ;     [by ref] [TIUNDA] --> array of form: TIUNDA(IFN)="".
"RTN","TIUEDIT",26,0)
 ;                           Used in SHOW NOTES ACROSS PATIENTS.
"RTN","TIUEDIT",27,0)
 ;                           See TIURC, which sets TIUONCE.
"RTN","TIUEDIT",28,0)
 ;                           Also used in TIUEDIM, for mult pts.
"RTN","TIUEDIT",29,0)
 ;             [TIUSNGL] --> Boolean flag to create only ONE note
"RTN","TIUEDIT",30,0)
 ;                           regardless of multiple pt preference.
"RTN","TIUEDIT",31,0)
 ;    [by ref] [TIUCHNG] --> If received, passes back TIUCHNG array,
"RTN","TIUEDIT",32,0)
 ;                           which collects info across records about
"RTN","TIUEDIT",33,0)
 ;                           actions taken. Used in feedback
"RTN","TIUEDIT",34,0)
 ;                           msgs to user.
"RTN","TIUEDIT",35,0)
 ; Other variables:
"RTN","TIUEDIT",36,0)
 ; sets [TIUTYP] --> array with form similar to that of XQORNOD:
"RTN","TIUEDIT",37,0)
 ;                           TIUTYP = title IFN
"RTN","TIUEDIT",38,0)
 ;                           TIUTYP(1) = 1^title IFN^title name,
"RTN","TIUEDIT",39,0)
 ;                           where 1 for us is just a positive #
"RTN","TIUEDIT",40,0)
 ; sets  [TIUBY] --> used in some input templates to BYpass fields.
"RTN","TIUEDIT",41,0)
 ; Called by:
"RTN","TIUEDIT",42,0)
 ;   Outpt Pharmacy, Consults, ...
"RTN","TIUEDIT",43,0)
 N TIUASK,TIUOUT,TIUREL,TIUCHK,TIUDA,TIUEDIT,TIUY,TIUTYP,TIUDPRM
"RTN","TIUEDIT",44,0)
 N TIUDFLT,TIUPREF,TIULMETH,TIUVMETH,DIRUT,DUOUT,DTOUT,TIUPRM0
"RTN","TIUEDIT",45,0)
 N TIUPRM1,TIUPRM3,TIUENTRY,TIUEXIT,TIUBY,TIUPNAME,TIUST
"RTN","TIUEDIT",46,0)
 S EVNTFLAG=+$G(EVNTFLAG,0)
"RTN","TIUEDIT",47,0)
 ; --Get user's division parameters, preferences: --
"RTN","TIUEDIT",48,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUEDIT",49,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUEDIT",50,0)
 ; -- multiple pts; not in OERR, not TRYing DDEF, not single docmt: --
"RTN","TIUEDIT",51,0)
 I $P(TIUPREF,U,6)="M",(+$G(ORVP)'>0),(+$G(NOSAVE)'>0),'+$G(TIUSNGL) D MAIN^TIUEDIM(TIUCLASS,.TIUOUT,.TIUNDA,.TIUCHNG) Q
"RTN","TIUEDIT",52,0)
 ; -- Loop: Create docmt --
"RTN","TIUEDIT",53,0)
 F  D  Q:+$G(ORVP)!+$G(TIUOUT)!+$G(NOSAVE)!+$G(TIUSNGL)
"RTN","TIUEDIT",54,0)
 . N TIU,TIUCMMTX,TIUBY,TIUEDIT,TIUNEW,TIUTYP,VADM,VAIN,CANEDIT
"RTN","TIUEDIT",55,0)
 . ; -- User specifies basic info for new docmt --
"RTN","TIUEDIT",56,0)
 . ; -- Get patient --
"RTN","TIUEDIT",57,0)
 . I +$G(ORVP) S DFN=+$G(ORVP)
"RTN","TIUEDIT",58,0)
 . I +$G(DFN)'>0 D  I +DFN'>0 S TIUOUT=1 Q
"RTN","TIUEDIT",59,0)
 . . S DFN=+$$PATIENT^TIULA
"RTN","TIUEDIT",60,0)
 . ; -- [For progress notes, show available notes]: --
"RTN","TIUEDIT",61,0)
 . S TIUCLASS=$G(TIUCLASS,38)
"RTN","TIUEDIT",62,0)
 . I TIUCLASS=3,$S(+$$ISA^USRLM(DUZ,"TRANSCRIPTIONIST"):0,1:1),(+$G(NOSAVE)'>0) D EXSTNOTE^TIUEDI2(DFN) D:$G(VALMAR)="^TMP(""OR"",$J,""CURRENT"")" FULL^VALM1
"RTN","TIUEDIT",63,0)
 . I +$G(DIROUT)!+$G(DUOUT)!+$G(DTOUT) S TIUOUT=1 Q
"RTN","TIUEDIT",64,0)
 . ; -- Set title array TIUTYP (use TIUTITLE or ask user) --
"RTN","TIUEDIT",65,0)
 . D SETTL^TIUEDI4(.TIUTYP,TIUCLASS,$G(TIUTITLE)) I +$G(TIUTYP)'>0 S TIUOUT=1 Q
"RTN","TIUEDIT",66,0)
 . ; --- Re-direct SURGICAL REPORTS ---
"RTN","TIUEDIT",67,0)
 . I +$$ISA^TIULX(TIUTYP,+$$CLASS^TIUSROI("SURGICAL REPORTS")) D ENTEROP^TIUSROI(DFN,TIUTYP) Q
"RTN","TIUEDIT",68,0)
 . ; -- Get doc parameters for title, X entry action --
"RTN","TIUEDIT",69,0)
 . D DOCPRM^TIULC1(TIUTYP,.TIUDPRM)
"RTN","TIUEDIT",70,0)
 . S TIUENTRY=$$GETENTRY^TIUEDI2(+TIUTYP)
"RTN","TIUEDIT",71,0)
 . I $L(TIUENTRY) X TIUENTRY
"RTN","TIUEDIT",72,0)
 . Q:+$G(TIUOUT)  ; If ENTRY ACTION sets TIUOUT=1 Abort entry
"RTN","TIUEDIT",73,0)
 . ; -- Set visit array TIU --
"RTN","TIUEDIT",74,0)
 . D GETVST^TIUEDI4(DFN,TIUTYP,.TIU,EVNTFLAG)
"RTN","TIUEDIT",75,0)
 . I '$D(TIU("VSTR")) K DFN,TIUTYP Q
"RTN","TIUEDIT",76,0)
 . ; -- Ask OK --
"RTN","TIUEDIT",77,0)
 . D ASKOK^TIUEDI4(TIUTYP,.TIU,.TIUBY,.TIUASK) I '$D(TIU("VSTR")) K DFN,TIUTYP Q
"RTN","TIUEDIT",78,0)
 . ; -- If user OK'd basic info, go on to get text, etc.: --
"RTN","TIUEDIT",79,0)
 . I $D(TIU),+$G(TIUASK) D
"RTN","TIUEDIT",80,0)
 . . ; -- Get record DA --
"RTN","TIUEDIT",81,0)
 . . ; DA is either: new stub record, ready for edit, or
"RTN","TIUEDIT",82,0)
 . . ;               existing record, for edit, or
"RTN","TIUEDIT",83,0)
 . . ;               existing record, for addendum      
"RTN","TIUEDIT",84,0)
 . . N DA
"RTN","TIUEDIT",85,0)
 . . S DA=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM,1,DUZ,.CANEDIT)
"RTN","TIUEDIT",86,0)
 . . I +DA'>0 W !,"Unable to enter/edit." Q
"RTN","TIUEDIT",87,0)
 . . ; -- [Addend DA and Quit] --
"RTN","TIUEDIT",88,0)
 . . ;    If record not new & user can't edit it, let user
"RTN","TIUEDIT",89,0)
 . . ;    write addendum and quit:
"RTN","TIUEDIT",90,0)
 . . I 'TIUNEW,'CANEDIT D  Q
"RTN","TIUEDIT",91,0)
 . . . D ADDENDUM^TIUADD(DA,"",.TIUCHNG,1)
"RTN","TIUEDIT",92,0)
 . . N TIUQUIT,TIUADD,TIUTDA
"RTN","TIUEDIT",93,0)
 . . ; -- Edit new or existing DA --
"RTN","TIUEDIT",94,0)
 . . D DIE^TIUEDI4(DA,.TIUQUIT)
"RTN","TIUEDIT",95,0)
 . . Q:+$G(TIUQUIT)=2  ; DA doesn't exist (e.g. uparrowed w/ bad record)
"RTN","TIUEDIT",96,0)
 . . ;If (CP) and (Timeout or Not Select Consult) and (Consult Associated), Quit before EMPTYDOC check
"RTN","TIUEDIT",97,0)
 . . I +$$ISA^TIULX(TIUTYP,+$$CLASS^TIUCP),+$G(TIUQUIT)=1,+$P($G(^TIU(8925,+DA,14)),U,5)>0 Q
"RTN","TIUEDIT",98,0)
 . . I $$EMPTYDOC^TIULF(DA) D DELETE(DA,0) S:$G(VALMAR)="^TMP(""TIUVIEW"",$J)" VALMBCK="Q" S:'+$G(TIUNEW) TIUCHNG("DELETE")=1 H:'+$G(TIUNEW) 2 Q
"RTN","TIUEDIT",99,0)
 . . Q:+$G(TIUQUIT)
"RTN","TIUEDIT",100,0)
 . . S:+DA SUCCESS=+DA
"RTN","TIUEDIT",101,0)
 . . I +$G(TIUONCE) S TIUNDA(+$G(DA))="" ; See TIURC, Across Patients
"RTN","TIUEDIT",102,0)
 . . ; -- Misc after-edit-stuff for DA --
"RTN","TIUEDIT",103,0)
 . . ; -- Mark to ask workload at signature;
"RTN","TIUEDIT",104,0)
 . . ;    (STOP for Stop codes for stand-alone visits): --
"RTN","TIUEDIT",105,0)
 . . I +$G(TIU("STOP")),(+$P($G(TIUDPRM(0)),U,14)'=1) D DEFER^TIUVSIT(DA,TIU("STOP")) I 1 ;piece 14 = suppress DX/CPT on entry
"RTN","TIUEDIT",106,0)
 . . E  D QUE^TIUPXAP1 ; Post workload now in background
"RTN","TIUEDIT",107,0)
 . . S TIUCMMTX=$$COMMIT^TIULC1(+$P(TIUTYP(1),U,2))
"RTN","TIUEDIT",108,0)
 . . I TIUCMMTX]"" X TIUCMMTX
"RTN","TIUEDIT",109,0)
 . . D RELEASE^TIUT(DA)
"RTN","TIUEDIT",110,0)
 . . D VERIFY^TIUT(DA)
"RTN","TIUEDIT",111,0)
 . . ; -- Get signature for DA 
"RTN","TIUEDIT",112,0)
 . . D EDSIG^TIURS(DA)
"RTN","TIUEDIT",113,0)
 . . ; - execute EXIT ACTION -
"RTN","TIUEDIT",114,0)
 . . S TIUEXIT=$$GETEXIT^TIUEDI2(+$P(TIUTYP(1),U,2))
"RTN","TIUEDIT",115,0)
 . . I $L(TIUEXIT) S TIUTDA=DA X TIUEXIT S DA=TIUTDA
"RTN","TIUEDIT",116,0)
 . . ; --  [Prompt to add ID stub] --
"RTN","TIUEDIT",117,0)
 . . ; I +$P($G(TIUDPRM(0)),U,20) D ADDSTUB^TIUGEDIT(DA)
"RTN","TIUEDIT",118,0)
 . . ; --  [Prompt to print DA] --
"RTN","TIUEDIT",119,0)
 . . I +$P($G(TIUDPRM(0)),U,8) D PRINT^TIUEPRNT(DA)
"RTN","TIUEDIT",120,0)
 . K DFN ; Free patient
"RTN","TIUEDIT",121,0)
 . S TIUPNAME=$$PNAME^TIULC1(TIUCLASS)
"RTN","TIUEDIT",122,0)
 . I $$UP^XLFSTR($E(TIUPNAME,$L(TIUPNAME)))="S" S TIUPNAME=$E(TIUPNAME,1,$L(TIUPNAME)-1)
"RTN","TIUEDIT",123,0)
 . ; -- [loop again] --
"RTN","TIUEDIT",124,0)
 . I '+$G(NOSAVE),'+$G(ORVP),'+$G(TIUSNGL) W !!,"You may enter another ",TIUPNAME,". Press RETURN to exit.",!
"RTN","TIUEDIT",125,0)
 Q
"RTN","TIUEDIT",126,0)
 ;
"RTN","TIUEDIT",127,0)
DELETE(TIUDA,PROMPT,MSG,HUSH) ; Delete record
"RTN","TIUEDIT",128,0)
 N DIDEL,DIE,DR,TIUD0,TIUVSIT,TIUVKILL,TIUDELX,TIUTYPE
"RTN","TIUEDIT",129,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUVSIT=$P(TIUD0,U,3),TIUTYPE=+TIUD0
"RTN","TIUEDIT",130,0)
 I +$G(PROMPT),'+$$READ^TIUU("YO",MSG,"NO") W !,"Nothing Deleted." Q
"RTN","TIUEDIT",131,0)
 K ^TIU(8925,"ASAVE",DUZ,TIUDA)
"RTN","TIUEDIT",132,0)
 D DELIRT^TIUDIRT(TIUDA)
"RTN","TIUEDIT",133,0)
 ; If a DELETE Action exists for the document definition, execute it
"RTN","TIUEDIT",134,0)
 S TIUDELX=$$DELETE^TIULC1(TIUTYPE)
"RTN","TIUEDIT",135,0)
 I TIUDELX]"" X TIUDELX
"RTN","TIUEDIT",136,0)
 S DA=TIUDA,(DIDEL,DIE)=8925,DR=".01///@"
"RTN","TIUEDIT",137,0)
 D ^DIE W:'+$G(HUSH) !,"<NOTHING ENTERED. "
"RTN","TIUEDIT",138,0)
 I '+$G(HUSH) W:+TIUD0 $$PNAME^TIULC1(+TIUD0)," DELETED>"
"RTN","TIUEDIT",139,0)
 D DELCOMP^TIUEDI1(TIUDA),DELAUDIT^TIUEDI1(TIUDA)
"RTN","TIUEDIT",140,0)
 K ^TIU(8925,"ASAVE",DUZ,TIUDA) ; Remove Save Flag
"RTN","TIUEDIT",141,0)
 D ALERTDEL^TIUALRT(TIUDA),ADDENDEL^TIUALRT(TIUDA)
"RTN","TIUEDIT",142,0)
 ; I +TIUVSIT S TIUVKILL=$$DELVFILE^PXAPI("ALL",TIUVSIT,"","TEXT INTEGRATION UTILITIES")
"RTN","TIUEDIT",143,0)
 Q
"RTN","TIUEDIT",144,0)
 ;
"RTN","TIUEDITR")
0^23^B15432270
"RTN","TIUEDITR",1,0)
TIUEDITR ; SLC/JER - Enter/Edit a Document for Transcriber ;6/11/2002
"RTN","TIUEDITR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,41,48,100,109,112**;Jun 20, 1997
"RTN","TIUEDITR",3,0)
 ; 2/2: Update DIE from TIUEDIT to TIUEDI4
"RTN","TIUEDITR",4,0)
MAIN(TIUCLASS) ; Control Branching
"RTN","TIUEDITR",5,0)
 N TIUPREF,TIUOUT,TIUAUTH
"RTN","TIUEDITR",6,0)
 ; --- Get user's preferences ---
"RTN","TIUEDITR",7,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUEDITR",8,0)
 ; --- Get the author to be used for multiple patients
"RTN","TIUEDITR",9,0)
 S TIUAUTH=+$$AUTHOR^TIULA2
"RTN","TIUEDITR",10,0)
 I TIUAUTH'>0 Q
"RTN","TIUEDITR",11,0)
 F  D  Q:+$G(TIUOUT)
"RTN","TIUEDITR",12,0)
 . N DFN,TIUREL,TIUCHK,TIUDA,TIUEDIT,TIUY,TIUNEW,TIUTYP,TIUDPRM
"RTN","TIUEDITR",13,0)
 . N TIUASK,TIU,VAIN,VADM,TIULMETH,TIUVMETH,TIUENTRY,TIUEXIT,TIUCMMTX
"RTN","TIUEDITR",14,0)
 . N DA ;10/3/00
"RTN","TIUEDITR",15,0)
 . ;Removed with TIU*1*41 - Joel didn't think it was appropriate
"RTN","TIUEDITR",16,0)
 . ;I $P(TIUPREF,U,6)="M" D MAIN^TIUEDIM(TIUCLASS,.TIUOUT) Q
"RTN","TIUEDITR",17,0)
 . ; --- Get a patient ---
"RTN","TIUEDITR",18,0)
 . S DFN=+$$PATIENT^TIULA I +DFN'>0 S TIUOUT=1 Q
"RTN","TIUEDITR",19,0)
 . S TIUCLASS=$G(TIUCLASS,38)
"RTN","TIUEDITR",20,0)
 . ; --- Get a document type ---
"RTN","TIUEDITR",21,0)
 . D DOCSPICK^TIULA2(.TIUTYP,TIUCLASS,"1A","LAST","","$P(^TIU(8925.1,+Y,0),U,7)'=13,+$$CANENTR^TIULP(+Y)")
"RTN","TIUEDITR",22,0)
 . I +$G(TIUTYP)'>0 S TIUOUT=1 Q
"RTN","TIUEDITR",23,0)
 . S TIUTYP=+$P($G(TIUTYP(1)),U,2)
"RTN","TIUEDITR",24,0)
 . ; --- Re-direct surgical reports ---
"RTN","TIUEDITR",25,0)
 . I +$$ISA^TIULX(TIUTYP,+$$CLASS^TIUSROI("SURGICAL REPORTS")) D ENTEROP^TIUSROI(DFN,TIUTYP) Q
"RTN","TIUEDITR",26,0)
 . ; --- Initialize document parameters ---
"RTN","TIUEDITR",27,0)
 . D DOCPRM^TIULC1(TIUTYP,.TIUDPRM)
"RTN","TIUEDITR",28,0)
 . ; --- If an ENTRY ACTION exists, execute it ---
"RTN","TIUEDITR",29,0)
 . S TIUENTRY=$$GETENTRY^TIUEDI2(+TIUTYP)
"RTN","TIUEDITR",30,0)
 . I $L(TIUENTRY) X TIUENTRY
"RTN","TIUEDITR",31,0)
 . Q:+$G(TIUOUT)  ; If entry action sets TIUOUT=1 Abort Entry
"RTN","TIUEDITR",32,0)
 . ; --- Get associated visit ---
"RTN","TIUEDITR",33,0)
 . I +$$SUPPVSIT^TIULC1(TIUTYP)'>0 D  I 1
"RTN","TIUEDITR",34,0)
 . . S TIULMETH=$$GETLMETH^TIUEDI1(TIUTYP)
"RTN","TIUEDITR",35,0)
 . . I '$L(TIULMETH) D  S TIUOUT=1 Q
"RTN","TIUEDITR",36,0)
 . . . W !,$C(7),"No Visit Linkage Method defined for "
"RTN","TIUEDITR",37,0)
 . . . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIUEDITR",38,0)
 . . X TIULMETH
"RTN","TIUEDITR",39,0)
 . E  D
"RTN","TIUEDITR",40,0)
 . . D EVENT^TIUSRVP1(.TIU,DFN)
"RTN","TIUEDITR",41,0)
 . I $S($D(DIROUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 Q
"RTN","TIUEDITR",42,0)
 . I '$D(TIU("VSTR")) D  Q
"RTN","TIUEDITR",43,0)
 . . W !,$C(7),"Patient & Visit required." H 2
"RTN","TIUEDITR",44,0)
 . ; --- Validate Selection ---
"RTN","TIUEDITR",45,0)
 . S TIUVMETH=$$GETVMETH^TIUEDI1(TIUTYP)
"RTN","TIUEDITR",46,0)
 . I '$L(TIUVMETH) D  S TIUOUT=1 Q
"RTN","TIUEDITR",47,0)
 . . W !,$C(7),"No Validation Method defined for "
"RTN","TIUEDITR",48,0)
 . . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIUEDITR",49,0)
 . X TIUVMETH
"RTN","TIUEDITR",50,0)
 . I $D(TIU),+$G(TIUASK) D
"RTN","TIUEDITR",51,0)
 . . ;S DA=$$GETREC^TIUEDI1(DFN,.TIU,1,.TIUNEW,.TIUDPRM,1)
"RTN","TIUEDITR",52,0)
 . . S DA=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM,1)
"RTN","TIUEDITR",53,0)
 . . I +DA'>0 W !,"Unable to enter/edit." Q
"RTN","TIUEDITR",54,0)
 . . S TIUEDIT=$S('+$G(TIUNEW):$$CANDO^TIULP(DA,"EDIT RECORD"),1:1)
"RTN","TIUEDITR",55,0)
 . . I '+TIUEDIT D  Q
"RTN","TIUEDITR",56,0)
 . . . W !,$P(TIUEDIT,U,2) ; Echo denial message
"RTN","TIUEDITR",57,0)
 . . . D ADDENDUM^TIUADD(DA,"",.TIUCHNG)
"RTN","TIUEDITR",58,0)
 . . N TIUQUIT,TIUADD
"RTN","TIUEDITR",59,0)
 . . D DIE^TIUEDI4(DA,.TIUQUIT) Q:+$G(TIUQUIT)=2  ; **100**
"RTN","TIUEDITR",60,0)
 . . ;If (CP) and (Timeout or Not Select Consult) and (Consult Associated), Quit before EMPTYDOC check
"RTN","TIUEDITR",61,0)
 . . I +$$ISA^TIULX(TIUTYP,+$$CLASS^TIUCP),+$G(TIUQUIT)=1,+$P($G(^TIU(8925,+DA,14)),U,5)>0 Q
"RTN","TIUEDITR",62,0)
 . . I $$EMPTYDOC^TIULF(DA) D DELETE^TIUEDIT(DA,0) S:'+$G(TIUNEW) TIUCHNG("DELETE")=1 H:'+$G(TIUNEW) 2 Q
"RTN","TIUEDITR",63,0)
 . . Q:+$G(TIUQUIT)
"RTN","TIUEDITR",64,0)
 . . I +$G(TIUONCE) S TIUNDA(+$G(DA))=""
"RTN","TIUEDITR",65,0)
 . . I +$G(TIU("STOP")) D DEFER^TIUVSIT(DA,TIU("STOP")) I 1
"RTN","TIUEDITR",66,0)
 . . E  D QUE^TIUPXAP1
"RTN","TIUEDITR",67,0)
 . . ; --- Execute COMMIT procedure ---
"RTN","TIUEDITR",68,0)
 . . S TIUCMMTX=$$COMMIT^TIULC1(+$G(^TIU(8925,+DA,0)))
"RTN","TIUEDITR",69,0)
 . . I TIUCMMTX]"" X TIUCMMTX
"RTN","TIUEDITR",70,0)
 . . ; --- Execute RELEASE procedure ---
"RTN","TIUEDITR",71,0)
 . . D RELEASE^TIUT(DA)
"RTN","TIUEDITR",72,0)
 . . ; --- Execute VERIFY procedure ---
"RTN","TIUEDITR",73,0)
 . . D VERIFY^TIUT(DA)
"RTN","TIUEDITR",74,0)
 . . ; --- Execute SIGNATURE procedure ---
"RTN","TIUEDITR",75,0)
 . . D EDSIG^TIURS(DA)
"RTN","TIUEDITR",76,0)
 . . ; --- If an EXIT ACTION exists, execute it ---
"RTN","TIUEDITR",77,0)
 . . S TIUEXIT=$$GETEXIT^TIUEDI2(+$P(TIUTYP(1),U,2))
"RTN","TIUEDITR",78,0)
 . . I $L(TIUEXIT) X TIUEXIT
"RTN","TIUEDITR",79,0)
 . . ; --- If required, prompt for print
"RTN","TIUEDITR",80,0)
 . . I +$P($G(TIUDPRM(0)),U,8) D PRINT^TIUEPRNT(DA)
"RTN","TIUEDITR",81,0)
 Q
"RTN","TIULC1")
0^6^B53707048
"RTN","TIULC1",1,0)
TIULC1 ; SLC/JER - More computational functions ;11/01/03
"RTN","TIULC1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,4,40,49,100,131,113,112**;Jun 20, 1997
"RTN","TIULC1",3,0)
 ; External References
"RTN","TIULC1",4,0)
 ; DBIA 2324  $$ISA^USRLM
"RTN","TIULC1",5,0)
 ; Any patch which makes ANY changes to this rtn must include a
"RTN","TIULC1",6,0)
 ;note in the patch desc reminding sites to update the Imaging
"RTN","TIULC1",7,0)
 ;Gateway.  See IA # 3622.
"RTN","TIULC1",8,0)
 ; IN ADDITION, if changes are made to components used by Imaging, 
"RTN","TIULC1",9,0)
 ;namely PNAME, backward compatibility may not be enough. If
"RTN","TIULC1",10,0)
 ;changes call additional rtns, TIU should consult with Imaging
"RTN","TIULC1",11,0)
 ;on need to add additional rtns to list of TIU rtns copied for
"RTN","TIULC1",12,0)
 ;Imaging Gateway.
"RTN","TIULC1",13,0)
 ;                         ****
"RTN","TIULC1",14,0)
 ;
"RTN","TIULC1",15,0)
ENCRYPT(X,X1,X2) ; Encrypt Text Strings
"RTN","TIULC1",16,0)
 D EN^XUSHSHP
"RTN","TIULC1",17,0)
 Q X
"RTN","TIULC1",18,0)
DECRYPT(X,X1,X2) ; Decrypt Text Strings
"RTN","TIULC1",19,0)
 D DE^XUSHSHP
"RTN","TIULC1",20,0)
 Q X
"RTN","TIULC1",21,0)
WHOSIGNS(DA) ; Evaluate who should be the expected signer
"RTN","TIULC1",22,0)
 N Y,TIU12
"RTN","TIULC1",23,0)
 S TIU12=$G(^TIU(8925,+DA,12))
"RTN","TIULC1",24,0)
 I $P(TIU12,U,2)'=$P(TIU12,U,9) S Y=$P(TIU12,U,2)
"RTN","TIULC1",25,0)
 E  S Y=$P(TIU12,U,9)
"RTN","TIULC1",26,0)
 Q Y
"RTN","TIULC1",27,0)
WHOCOSIG(DA) ; Evaluate who should be the expected cosigner
"RTN","TIULC1",28,0)
 N Y,TIU12
"RTN","TIULC1",29,0)
 S TIU12=$G(^TIU(8925,+DA,12))
"RTN","TIULC1",30,0)
 I $P(TIU12,U,2)=$P(TIU12,U,9) D
"RTN","TIULC1",31,0)
 . I $P(TIU12,U,8)]"" S Y="@"
"RTN","TIULC1",32,0)
 . E  S Y=""
"RTN","TIULC1",33,0)
 E  S Y=$P(TIU12,U,9)
"RTN","TIULC1",34,0)
 Q Y
"RTN","TIULC1",35,0)
 ;
"RTN","TIULC1",36,0)
HASADDEN(DA,IDKIDFLG) ; Evaluate whether a given record has addenda
"RTN","TIULC1",37,0)
 ; **100**:
"RTN","TIULC1",38,0)
 ; If +IDKIDFLG, check interdisciplinary kids of DA, as well as DA.
"RTN","TIULC1",39,0)
 N TIUI,TIUY,TIUJ,TIUK
"RTN","TIULC1",40,0)
 S (TIUI,TIUJ,TIUY)=0
"RTN","TIULC1",41,0)
 F  S TIUI=$O(^TIU(8925,"DAD",+DA,TIUI)) Q:+TIUI'>0  D  Q:TIUY
"RTN","TIULC1",42,0)
 . I $P($G(^TIU(8925.1,+$G(^TIU(8925,+TIUI,0)),0)),U)["ADDENDUM" S TIUY=1
"RTN","TIULC1",43,0)
 I TIUY!'$G(IDKIDFLG) G HASX
"RTN","TIULC1",44,0)
 ;**100** Check ID kids for addenda:
"RTN","TIULC1",45,0)
 F  S TIUJ=$O(^TIU(8925,"GDAD",+DA,TIUJ)) Q:+TIUJ'>0  D  Q:TIUY
"RTN","TIULC1",46,0)
 . S TIUK=0
"RTN","TIULC1",47,0)
 . F  S TIUK=$O(^TIU(8925,"DAD",TIUJ,TIUK)) Q:+TIUK'>0  D  Q:TIUY
"RTN","TIULC1",48,0)
 . . I $P($G(^TIU(8925.1,+$G(^TIU(8925,+TIUK,0)),0)),U)["ADDENDUM" S TIUY=1
"RTN","TIULC1",49,0)
HASX Q TIUY
"RTN","TIULC1",50,0)
 ;
"RTN","TIULC1",51,0)
ISADDNDM(DA) ; Evaluate whether a given record IS an addendum
"RTN","TIULC1",52,0)
 N TIUY S TIUY=0
"RTN","TIULC1",53,0)
 I $P($G(^TIU(8925.1,+$G(^TIU(8925,+DA,0)),0)),U)["ADDENDUM",+$P($G(^TIU(8925,+DA,0)),U,6)>0 S TIUY=1
"RTN","TIULC1",54,0)
 Q TIUY
"RTN","TIULC1",55,0)
PNAME(DA) ; Receives pointer to 8925.1, returns display name of
"RTN","TIULC1",56,0)
 ; document class
"RTN","TIULC1",57,0)
 N TIUY,TIUMOM S TIUMOM=0
"RTN","TIULC1",58,0)
 I +$G(DA)'>0 Q "UNKNOWN"
"RTN","TIULC1",59,0)
 S TIUMOM=$O(^TIU(8925.1,"AD",DA,TIUMOM))
"RTN","TIULC1",60,0)
 I $P($G(^TIU(8925.1,+DA,0)),U,4)="CO" S TIUMOM=0
"RTN","TIULC1",61,0)
 I +$P($G(^TIU(8925.1,+DA,0)),U,9)=0 S TIUMOM=0
"RTN","TIULC1",62,0)
 I +TIUMOM>0  D
"RTN","TIULC1",63,0)
 . S TIUY=$P($G(^TIU(8925.1,+TIUMOM,0)),U,3)
"RTN","TIULC1",64,0)
 . I TIUY']"" S TIUY=$$MIXED^TIULS($P($G(^TIU(8925.1,+TIUMOM,0)),U))
"RTN","TIULC1",65,0)
 I +TIUMOM'>0 D
"RTN","TIULC1",66,0)
 . S TIUY=$P($G(^TIU(8925.1,+DA,0)),U,3)
"RTN","TIULC1",67,0)
 . I TIUY']"" S TIUY=$$MIXED^TIULS($P($G(^TIU(8925.1,+DA,0)),U))
"RTN","TIULC1",68,0)
 Q TIUY
"RTN","TIULC1",69,0)
ABBREV(DA) ; Get abbreviaton for a document type or class
"RTN","TIULC1",70,0)
 Q $P($G(^TIU(8925.1,+DA,0)),U,2)
"RTN","TIULC1",71,0)
PERSNAME(USER) ; Receives pointer to 200, returns name field
"RTN","TIULC1",72,0)
 N X S X=$$GET1^DIQ(200,USER,.01)
"RTN","TIULC1",73,0)
 Q $S($L(X):X,1:"UNKNOWN")
"RTN","TIULC1",74,0)
BEEP(USER) ; Get beeper #'s 
"RTN","TIULC1",75,0)
 Q $P($G(^VA(200,+USER,.13)),U,7,8)
"RTN","TIULC1",76,0)
DOCPRM(TIUTYP,TIUDPRM,TIUDA) ; Get Document Parameters, support inheritance
"RTN","TIULC1",77,0)
 N TIUI,TIUDAD
"RTN","TIULC1",78,0)
 S (TIUDPRM(0),TIUDPRM(5))=""
"RTN","TIULC1",79,0)
 I $P($G(^TIU(8925.1,+TIUTYP,0)),U)["ADDENDUM",+$G(TIUDA) S TIUTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIULC1",80,0)
 S TIUI=+$O(^TIU(8925.95,"B",+TIUTYP,0))
"RTN","TIULC1",81,0)
 I +TIUI D  Q
"RTN","TIULC1",82,0)
 . S TIUDPRM(0)=$G(^TIU(8925.95,+TIUI,0))
"RTN","TIULC1",83,0)
 . I +$O(^TIU(8925.95,+TIUI,5,0)) D
"RTN","TIULC1",84,0)
 . . N TIUJ S TIUJ=0
"RTN","TIULC1",85,0)
 . . F  S TIUJ=$O(^TIU(8925.95,+TIUI,5,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIULC1",86,0)
 . . . S $P(TIUDPRM(5),U,TIUJ)=+$G(^TIU(8925.95,+TIUI,5,+TIUJ,0))
"RTN","TIULC1",87,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",88,0)
 I +TIUDAD D DOCPRM(TIUDAD,.TIUDPRM)
"RTN","TIULC1",89,0)
 Q
"RTN","TIULC1",90,0)
POSTFILE(TIUTYP) ; Get Post-filing Code, support inheritance
"RTN","TIULC1",91,0)
 N TIUPOST,TIUDAD
"RTN","TIULC1",92,0)
 S TIUPOST=$G(^TIU(8925.1,+TIUTYP,4.5))
"RTN","TIULC1",93,0)
 I TIUPOST]"" G POSTFILX
"RTN","TIULC1",94,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",95,0)
 I +TIUDAD S TIUPOST=$$POSTFILE(TIUDAD)
"RTN","TIULC1",96,0)
POSTFILX Q TIUPOST
"RTN","TIULC1",97,0)
FIXCODE(TIUTYP) ; Get Error Resolution Code, support inheritance
"RTN","TIULC1",98,0)
 N TIUFIX,TIUDAD
"RTN","TIULC1",99,0)
 S TIUFIX=$G(^TIU(8925.1,+TIUTYP,4.8))
"RTN","TIULC1",100,0)
 I TIUFIX]"" G FIXCODX
"RTN","TIULC1",101,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",102,0)
 ; Don't inherit PN code for consults: TIU*1*131
"RTN","TIULC1",103,0)
 I +TIUTYP=$$CLASS^TIUCNSLT,TIUDAD=3 G FIXCODX
"RTN","TIULC1",104,0)
 I +TIUDAD S TIUFIX=$$FIXCODE(TIUDAD)
"RTN","TIULC1",105,0)
FIXCODX Q TIUFIX
"RTN","TIULC1",106,0)
DOCCLASS(TIUTYP) ; Given a document type, find its parent document class
"RTN","TIULC1",107,0)
 Q +$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",108,0)
CLINDOC(TIUTYP,TIUDA) ; Given a document type, find the Clinical Document
"RTN","TIULC1",109,0)
 ;                 subclass to which it belongs
"RTN","TIULC1",110,0)
 N TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIULC1",111,0)
 I +$G(TIUDA),+$$ISADDNDM(TIUDA) S TIUTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIULC1",112,0)
 S TIUI=$O(^TIU(8925.1,"AD",+TIUTYP,TIUI))
"RTN","TIULC1",113,0)
 I +TIUI'>0 G CLINDOX
"RTN","TIULC1",114,0)
 I TIUI=38 S TIUY=TIUTYP
"RTN","TIULC1",115,0)
 I TIUI'=38 S TIUY=$$CLINDOC(TIUI)
"RTN","TIULC1",116,0)
CLINDOX Q TIUY
"RTN","TIULC1",117,0)
REQVER(TIUTYP,TIUDA) ; Does a given document type require verification
"RTN","TIULC1",118,0)
 N TIUDPRM,TIUY
"RTN","TIULC1",119,0)
 I +$G(TIUDA),+$$ISADDNDM(TIUDA) S TIUTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIULC1",120,0)
 D DOCPRM(TIUTYP,.TIUDPRM)
"RTN","TIULC1",121,0)
 I +$P($G(TIUDPRM(0)),U,3) S TIUY=1
"RTN","TIULC1",122,0)
 Q +$G(TIUY)
"RTN","TIULC1",123,0)
REFDATE(TIU,TIUDICDT) ; Identify Reference date
"RTN","TIULC1",124,0)
 N TIURDT
"RTN","TIULC1",125,0)
 I +$G(TIU("LDT")) S TIURDT=+$G(TIU("LDT"))_"^0"
"RTN","TIULC1",126,0)
 I +$G(TIU("LDT"))'>0 D
"RTN","TIULC1",127,0)
 . S TIURDT=$S(+$G(TIUDICDT):+$G(TIUDICDT),1:+$$NOW^TIULC)_"^1"
"RTN","TIULC1",128,0)
 . S TIU("LDT")=TIURDT_U_$$DATE^TIULS(TIURDT,"AMTH DD, CCYY@HR:MIN:SEC")
"RTN","TIULC1",129,0)
 Q TIURDT
"RTN","TIULC1",130,0)
WHATMPL(USER) ; What List Template should a given user get?
"RTN","TIULC1",131,0)
 N TIUY
"RTN","TIULC1",132,0)
 I +$$ISA^USRLM(USER,"PROVIDER") S TIUY="TIU BROWSE FOR CLINICIAN" G WHAX
"RTN","TIULC1",133,0)
 I +$$ISA^USRLM(USER,"MEDICAL RECORDS TECHNICIAN") S TIUY="TIU BROWSE FOR MRT" G WHAX
"RTN","TIULC1",134,0)
 I +$$ISA^USRLM(USER,"CHIEF, MIS") S TIUY="TIU BROWSE FOR MGR" G WHAX
"RTN","TIULC1",135,0)
 I +$$ISA^USRLM(USER,"MEDICAL STUDENT") S TIUY="TIU BROWSE FOR CLINICIAN" G WHAX
"RTN","TIULC1",136,0)
 S TIUY="TIU BROWSE FOR READ ONLY"
"RTN","TIULC1",137,0)
WHAX Q TIUY
"RTN","TIULC1",138,0)
SUPPVSIT(TIUTYP) ; Evaluate whether to suppress visit matching
"RTN","TIULC1",139,0)
 N TIUI,TIUY S TIUY=0
"RTN","TIULC1",140,0)
 I +$P($G(^TIU(8925.1,+TIUTYP,3)),U,3) S TIUY=1 G SUPPVSIX
"RTN","TIULC1",141,0)
 I $L($P($G(^TIU(8925.1,+TIUTYP,3)),U,3)),($P($G(^(3)),U,3)=0) S TIUY=0 G SUPPVSIX ; ** SLC/JER - NOIS NYC-1298-11472
"RTN","TIULC1",142,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925.1,"AD",+TIUTYP,TIUI)) Q:+TIUI'>0!(+TIUY>0)  D
"RTN","TIULC1",143,0)
 . S TIUY=+$$SUPPVSIT(+TIUI)
"RTN","TIULC1",144,0)
SUPPVSIX Q TIUY
"RTN","TIULC1",145,0)
PTNAME(DFN) ; Resolve Patient Name
"RTN","TIULC1",146,0)
 N TIUY S TIUY=$P($G(^DPT(DFN,0)),U)
"RTN","TIULC1",147,0)
 S:TIUY']"" TIUY="NAME UNKNOWN"
"RTN","TIULC1",148,0)
 Q TIUY
"RTN","TIULC1",149,0)
POSTSIGN(TIUTYP) ; Get Post-Signature Code, support inheritance
"RTN","TIULC1",150,0)
 N TIUPOST,TIUDAD
"RTN","TIULC1",151,0)
 S TIUPOST=$G(^TIU(8925.1,+TIUTYP,4.9))
"RTN","TIULC1",152,0)
 I TIUPOST]"" G POSTSIGX
"RTN","TIULC1",153,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",154,0)
 I +TIUDAD S TIUPOST=$$POSTSIGN(TIUDAD)
"RTN","TIULC1",155,0)
POSTSIGX Q TIUPOST
"RTN","TIULC1",156,0)
COMMIT(TIUTYP) ; Get Commitment action, support inheritance
"RTN","TIULC1",157,0)
 N TIUCOMM,TIUDAD
"RTN","TIULC1",158,0)
 S TIUCOMM=$G(^TIU(8925.1,+TIUTYP,4.1))
"RTN","TIULC1",159,0)
 I TIUCOMM]"" G COMMITX
"RTN","TIULC1",160,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",161,0)
 I +TIUDAD S TIUCOMM=$$COMMIT(TIUDAD)
"RTN","TIULC1",162,0)
COMMITX Q TIUCOMM
"RTN","TIULC1",163,0)
RELEASE(TIUTYP) ; Get Release Action, support inheritance
"RTN","TIULC1",164,0)
 N TIUREL,TIUDAD
"RTN","TIULC1",165,0)
 S TIUREL=$G(^TIU(8925.1,+TIUTYP,4.2))
"RTN","TIULC1",166,0)
 I TIUREL]"" G RELEASX
"RTN","TIULC1",167,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",168,0)
 I +TIUDAD S TIUREL=$$RELEASE(TIUDAD)
"RTN","TIULC1",169,0)
RELEASX Q TIUREL
"RTN","TIULC1",170,0)
VERIFY(TIUTYP) ; Get Verification action, support inheritance
"RTN","TIULC1",171,0)
 N TIUVER,TIUDAD
"RTN","TIULC1",172,0)
 S TIUVER=$G(^TIU(8925.1,+TIUTYP,4.3))
"RTN","TIULC1",173,0)
 I TIUVER]"" G VERIFYX
"RTN","TIULC1",174,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",175,0)
 I +TIUDAD S TIUVER=$$VERIFY(TIUDAD)
"RTN","TIULC1",176,0)
VERIFYX Q TIUVER
"RTN","TIULC1",177,0)
DELETE(TIUTYP) ; Get Delete Action, support inheritance
"RTN","TIULC1",178,0)
 N TIUDEL,TIUDAD
"RTN","TIULC1",179,0)
 S TIUDEL=$G(^TIU(8925.1,+TIUTYP,4.4))
"RTN","TIULC1",180,0)
 I TIUDEL]"" G DELETEX
"RTN","TIULC1",181,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",182,0)
 I +TIUDAD S TIUDEL=$$DELETE(TIUDAD)
"RTN","TIULC1",183,0)
DELETEX Q TIUDEL
"RTN","TIULC1",184,0)
REASSIGN(TIUTYP) ; Get Package Reassign Action, support inheritance
"RTN","TIULC1",185,0)
 N TIUREASS,TIUDAD
"RTN","TIULC1",186,0)
 S TIUREASS=$G(^TIU(8925.1,+TIUTYP,4.45))
"RTN","TIULC1",187,0)
 I TIUREASS]"" G REASSIX
"RTN","TIULC1",188,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",189,0)
 I +TIUDAD S TIUREASS=$$REASSIGN(TIUDAD)
"RTN","TIULC1",190,0)
REASSIX Q TIUREASS
"RTN","TIULC1",191,0)
ONBROWSE(TIUTYP)        ; Get OnBrowse Event, support inheritance
"RTN","TIULC1",192,0)
 N TIUBRWS,TIUDAD
"RTN","TIULC1",193,0)
 S TIUBRWS=$G(^TIU(8925.1,+TIUTYP,6.5))
"RTN","TIULC1",194,0)
 I TIUBRWS]"" G ONBRWSX
"RTN","TIULC1",195,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",196,0)
 I +TIUDAD S TIUBRWS=$$ONBROWSE(TIUDAD)
"RTN","TIULC1",197,0)
ONBRWSX Q TIUBRWS
"RTN","TIULC1",198,0)
ONRTRCT(TIUTYP) ; Get OnRetract Event, support inheritance
"RTN","TIULC1",199,0)
 N TIURTRCT,TIUDAD
"RTN","TIULC1",200,0)
 S TIURTRCT=$G(^TIU(8925.1,+TIUTYP,6.51))
"RTN","TIULC1",201,0)
 I TIURTRCT]"" G ONRTRX
"RTN","TIULC1",202,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",203,0)
 I +TIUDAD S TIURTRCT=$$ONRTRCT(TIUDAD)
"RTN","TIULC1",204,0)
ONRTRX Q TIURTRCT
"RTN","TIULC1",205,0)
DIVISION(TIULOC) ; Get Division
"RTN","TIULC1",206,0)
 ; Input  -- TIULOC  HOSPITAL LOCATION file (#44) IEN
"RTN","TIULC1",207,0)
 ; Output -- TIUIN   INSTITUTION file (#4) IEN^
"RTN","TIULC1",208,0)
 ;                   INSTITUTION file (#4) NAME
"RTN","TIULC1",209,0)
 N TIUDVHL,TIUSTN,TIUIN
"RTN","TIULC1",210,0)
 S TIUDVHL=$P($G(^SC(+TIULOC,0)),U,15)
"RTN","TIULC1",211,0)
 I +TIUDVHL D
"RTN","TIULC1",212,0)
 . S TIUSTN=$$SITE^VASITE(,TIUDVHL)
"RTN","TIULC1",213,0)
 . I $P(TIUSTN,U)>0,($P(TIUSTN,U,2)]"") D
"RTN","TIULC1",214,0)
 . . S TIUIN=$P(TIUSTN,U)_U_$P(TIUSTN,U,2)
"RTN","TIULC1",215,0)
 I '$G(TIUIN) D
"RTN","TIULC1",216,0)
 . S TIUIN=+$G(DUZ(2))_U_$P($$NS^XUAF4(+$G(DUZ(2))),U)
"RTN","TIULC1",217,0)
 Q TIUIN
"RTN","TIUPEFIX")
0^20^B42748448
"RTN","TIUPEFIX",1,0)
TIUPEFIX ; SLC/JER - Resolve Filing errors for TIU Documents ;11/01/03
"RTN","TIUPEFIX",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,21,100,167,113,112**;Jun 20, 1997
"RTN","TIUPEFIX",3,0)
MAKE(SUCCESS,DFN,TITLE,TIU,TIUBUF) ; File new TIU Document
"RTN","TIUPEFIX",4,0)
 ; SUCCESS = (by ref) SUCCESS Returns TIU DOCUMENT # (PTR to 8925)
"RTN","TIUPEFIX",5,0)
 ;         = 0^Explanatory message if no SUCCESS
"RTN","TIUPEFIX",6,0)
 ; DFN     = Patient (#2)
"RTN","TIUPEFIX",7,0)
 ; TITLE   = Pointer to TIU Document Definition (#8925.1)
"RTN","TIUPEFIX",8,0)
 ; TIU     = Array of demographic and visit attributes
"RTN","TIUPEFIX",9,0)
 ; TIUBUF  = Record number (ien) of entry in TIU Buffer file (#8925.2)
"RTN","TIUPEFIX",10,0)
 ;
"RTN","TIUPEFIX",11,0)
 ; -- first, get TIU Document record --
"RTN","TIUPEFIX",12,0)
 ;
"RTN","TIUPEFIX",13,0)
 N TIUDA,LDT,NEWREC,TIUX,TIUTYP,TIUDPRM,HAPPY,TIUCLASS,TIUDTYP,TIUPOST
"RTN","TIUPEFIX",14,0)
 N TIUDFLT,TIUREC
"RTN","TIUPEFIX",15,0)
 S SUCCESS=0 ; Initialize SUCCESS to false
"RTN","TIUPEFIX",16,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,+$G(TIUTYPE)'>0:1,1:0) S SUCCESS="0^"_$$EZBLD^DIALOG(89250001) Q
"RTN","TIUPEFIX",17,0)
 ; If target file is not 8925 QUIT
"RTN","TIUPEFIX",18,0)
 I +$G(^TIU(8925.1,+TIUTYPE,1))'=8925 Q
"RTN","TIUPEFIX",19,0)
 S TIUDTYP=$P($G(^TIU(8925.1,+TIUTYPE,0)),U,4)
"RTN","TIUPEFIX",20,0)
 S TIUCLASS=$S(TIUDTYP="CL":+TIUTYPE,1:38)
"RTN","TIUPEFIX",21,0)
 S TIUDFLT=$S(TIUCLASS'=TIUTYPE:TIUTYPE,1:"")
"RTN","TIUPEFIX",22,0)
 I +$G(TITLE)'>0 S TITLE=$$ASKTITLE^TIULA3(TIUCLASS,TIUDFLT)
"RTN","TIUPEFIX",23,0)
 Q:+TITLE'>0
"RTN","TIUPEFIX",24,0)
 S TIUTYP=TITLE,TIUTYP(1)=1_U_TITLE
"RTN","TIUPEFIX",25,0)
 D DOCPRM^TIULC1(TITLE,.TIUDPRM)
"RTN","TIUPEFIX",26,0)
 ;S TIUDA=$$GETREC^TIUEDI1(DFN,.TIU,1,.NEWREC,.TIUDPRM) ;10/27/00
"RTN","TIUPEFIX",27,0)
 S TIUDA=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.NEWREC,.TIUDPRM)
"RTN","TIUPEFIX",28,0)
 I +TIUDA'>0 S SUCCESS="0^"_$$EZBLD^DIALOG(89250002) Q
"RTN","TIUPEFIX",29,0)
 I +$$CANEDIT^TIUPUTU(TIUDA)'>0 D  G MAKEX
"RTN","TIUPEFIX",30,0)
 . D MAKEADD(.TIUADD,+TIUDA,TIUBUF) S SUCCESS=TIUADD
"RTN","TIUPEFIX",31,0)
 S SUCCESS=1
"RTN","TIUPEFIX",32,0)
 ;
"RTN","TIUPEFIX",33,0)
 ; -- second, load the header elements & text into TIUX array
"RTN","TIUPEFIX",34,0)
 ;
"RTN","TIUPEFIX",35,0)
 D STUFREC(TIUDA,$G(DFN),$P($G(^TIU(8925,TIUDA,0)),U,6),.TIU)
"RTN","TIUPEFIX",36,0)
 D LOADTIUX(.TIUX,TIUBUF)
"RTN","TIUPEFIX",37,0)
 ;
"RTN","TIUPEFIX",38,0)
 ; -- third, file the data in TIU Document record --
"RTN","TIUPEFIX",39,0)
 ;
"RTN","TIUPEFIX",40,0)
 K ^TIU(8925,+TIUDA,"TEMP"),TIUX(.01),TIUX(.02),TIUX(.03),TIUX(.05)
"RTN","TIUPEFIX",41,0)
 K TIUX(.13),TIUX(1205),TIUX(1211)
"RTN","TIUPEFIX",42,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUPEFIX",43,0)
 D FILE(.HAPPY,+TIUDA,.TIUX,TIUTYP)
"RTN","TIUPEFIX",44,0)
 D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUPEFIX",45,0)
 S TIUPOST=$$POSTFILE^TIULC1(TITLE)
"RTN","TIUPEFIX",46,0)
 S TIUREC("#")=TIUDA
"RTN","TIUPEFIX",47,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPEFIX",48,0)
MAKEX D ALERTDEL^TIUPEVNT(+TIUBUF)
"RTN","TIUPEFIX",49,0)
 D RESOLVE^TIUPEVNT($S($D(XQADATA):+$P(XQADATA,";",3),1:$G(ERRDA)),1)
"RTN","TIUPEFIX",50,0)
 D BUFPURGE^TIUPUTC(+TIUBUF)
"RTN","TIUPEFIX",51,0)
 K ^TIU(8925,+TIUDA,"TEMP") W "Done."
"RTN","TIUPEFIX",52,0)
 I +$G(TIUDA),+$D(^TIU(8925,+$G(TIUDA),0)) D
"RTN","TIUPEFIX",53,0)
 . N TIU D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUPEFIX",54,0)
 . D EN^VALM("TIU BROWSE FOR MRT")
"RTN","TIUPEFIX",55,0)
 Q
"RTN","TIUPEFIX",56,0)
LOADTIUX(TIUARR,TIUBUF) ; Load TIUX array with header and text
"RTN","TIUPEFIX",57,0)
 N TIUI,TIUHSIG,TIUBGN,TIULINE,X,Y,TYPE I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUPEFIX",58,0)
 S TIUHSIG=$P(TIUPRM0,U,10),TIUBGN=$P(TIUPRM0,U,12)
"RTN","TIUPEFIX",59,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925.2,+TIUBUF,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUPEFIX",60,0)
 . S TIULINE=$G(^TIU(8925.2,+TIUBUF,"TEXT",TIUI,0))
"RTN","TIUPEFIX",61,0)
 . I TIULINE[TIUHSIG D
"RTN","TIUPEFIX",62,0)
 . . N TIUD1,TIUD4
"RTN","TIUPEFIX",63,0)
 . . S X=$$STRIP^TIULS($P(TIULINE,":",2)),Y=$$WHATYPE^TIUPUTU(X)
"RTN","TIUPEFIX",64,0)
 . . I +Y'>0 D MAIN^TIUPEVNT(TIUBUF,1,3,X) Q
"RTN","TIUPEFIX",65,0)
 . . S TIUD1=$G(^TIU(8925.1,+Y,1)),TIUD4=$G(^TIU(8925.1,+Y,4))
"RTN","TIUPEFIX",66,0)
 . . S TYPE=+Y
"RTN","TIUPEFIX",67,0)
 . . F  D  Q:TIULINE[TIUBGN!(+TIUI'>0)
"RTN","TIUPEFIX",68,0)
 . . . N TIUN,TIUCAP,TIUFLD,TIUREQ S TIUREQ=0
"RTN","TIUPEFIX",69,0)
 . . . S TIUI=$O(^TIU(8925.2,+TIUBUF,"TEXT",TIUI)) Q:+TIUI'>0
"RTN","TIUPEFIX",70,0)
 . . . S TIULINE=$G(^TIU(8925.2,+TIUBUF,"TEXT",TIUI,0)) Q:TIULINE[TIUBGN
"RTN","TIUPEFIX",71,0)
 . . . S TIUCAP=$P(TIULINE,":") Q:TIUCAP']""
"RTN","TIUPEFIX",72,0)
 . . . S TIUN=$O(^TIU(8925.1,+TYPE,"HEAD","B",TIUCAP,0))
"RTN","TIUPEFIX",73,0)
 . . . Q:+TIUN'>0
"RTN","TIUPEFIX",74,0)
 . . . S TIUFLD=$P(^TIU(8925.1,+TYPE,"HEAD",+TIUN,0),U,3)
"RTN","TIUPEFIX",75,0)
 . . . Q:TIUFLD']""
"RTN","TIUPEFIX",76,0)
 . . . S TIUREQ=$P(^TIU(8925.1,+TYPE,"HEAD",+TIUN,0),U,7)
"RTN","TIUPEFIX",77,0)
 . . . S TIUARR(TIUFLD)=$$STRIP^TIULS($P(TIULINE,":",2,99))
"RTN","TIUPEFIX",78,0)
 . . . S:TIUFLD'=.001 TIUARR(TIUFLD)=$$TRNSFRM(+TYPE,TIUFLD,TIUARR(TIUFLD))
"RTN","TIUPEFIX",79,0)
 . . . I +TIUREQ,TIUARR(TIUFLD)="" S TIUARR(TIUFLD)="** REQUIRED FIELD MISSING FROM UPLOAD **"
"RTN","TIUPEFIX",80,0)
 . . . I $S(TIUFLD=.01:1,TIUFLD=.02:1,TIUFLD=.07:1,TIUFLD=1301:1,1:0) K TIUARR(TIUFLD)
"RTN","TIUPEFIX",81,0)
 . . I TIULINE[TIUBGN D
"RTN","TIUPEFIX",82,0)
 . . . N TIUJ S TIUJ=0
"RTN","TIUPEFIX",83,0)
 . . . F  D  Q:+TIUI'>0
"RTN","TIUPEFIX",84,0)
 . . . . S TIUI=$O(^TIU(8925.2,+TIUBUF,"TEXT",TIUI)) Q:+TIUI'>0
"RTN","TIUPEFIX",85,0)
 . . . . S TIUJ=TIUJ+1
"RTN","TIUPEFIX",86,0)
 . . . . S TIUARR("TEXT",TIUJ,0)=$G(^TIU(8925.2,+TIUBUF,"TEXT",TIUI,0))
"RTN","TIUPEFIX",87,0)
 Q
"RTN","TIUPEFIX",88,0)
STUFREC(DA,DFN,PARENT,TIU) ; Stuff fixed field data
"RTN","TIUPEFIX",89,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIURDT
"RTN","TIUPEFIX",90,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPEFIX",91,0)
 I +$G(PARENT)'>0 D
"RTN","TIUPEFIX",92,0)
 . S @FDARR@(.02)=$G(DFN),@FDARR@(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUPEFIX",93,0)
 . S @FDARR@(.05)=$S(+$$REQVER(+$P($G(TIUDPRM(0)),U,3)):4,1:5)
"RTN","TIUPEFIX",94,0)
 . S @FDARR@(.07)=$P(TIU("EDT"),U)
"RTN","TIUPEFIX",95,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U),@FDARR@(1401)=$P($G(TIU("AD#")),U)
"RTN","TIUPEFIX",96,0)
 . S @FDARR@(1402)=$P($G(TIU("TS")),U),@FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPEFIX",97,0)
 . S @FDARR@(1205)=$S(+$P($G(TIU("LOC")),U):$P($G(TIU("LOC")),U),1:$P($G(TIU("VLOC")),U))
"RTN","TIUPEFIX",98,0)
 . S @FDARR@(1212)=$S(+$P($G(TIU("INST")),U):$P($G(TIU("INST")),U),1:DUZ(2))
"RTN","TIUPEFIX",99,0)
 . S @FDARR@(1404)=$P($G(TIU("SVC")),U)
"RTN","TIUPEFIX",100,0)
 I +$G(PARENT)>0 D
"RTN","TIUPEFIX",101,0)
 . S @FDARR@(.02)=+$P(^TIU(8925,+PARENT,0),U,2)
"RTN","TIUPEFIX",102,0)
 . S @FDARR@(.03)=$P(^TIU(8925,+PARENT,0),U,3)
"RTN","TIUPEFIX",103,0)
 . S @FDARR@(.05)=$S(+$$REQVER(+$P($G(TIUDPRM(0)),U,3)):4,1:5)
"RTN","TIUPEFIX",104,0)
 . S @FDARR@(.06)=PARENT
"RTN","TIUPEFIX",105,0)
 . S @FDARR@(.07)=$P($G(TIU("EDT")),U),@FDARR@(.08)=$P($G(TIU("LDT")),U)
"RTN","TIUPEFIX",106,0)
 . S @FDARR@(1205)=$P($G(^TIU(8925,+PARENT,12)),U,5)
"RTN","TIUPEFIX",107,0)
 . S @FDARR@(1212)=$P($G(^TIU(8925,+PARENT,12)),U,12) ; if parent's div null so is addendum's div
"RTN","TIUPEFIX",108,0)
 . S @FDARR@(1401)=$P($G(^TIU(8925,+PARENT,14)),U)
"RTN","TIUPEFIX",109,0)
 . S @FDARR@(1402)=$P($G(^TIU(8925,+PARENT,14)),U,2)
"RTN","TIUPEFIX",110,0)
 . S @FDARR@(1404)=$P($G(^TIU(8925,+PARENT,14)),U,4)
"RTN","TIUPEFIX",111,0)
 . S @FDARR@(1405)=$P($G(^TIU(8925,+PARENT,14)),U,5)
"RTN","TIUPEFIX",112,0)
 S @FDARR@(1201)=$$NOW^XLFDT
"RTN","TIUPEFIX",113,0)
 I +$G(TIU("LDT")) S TIURDT=+$G(TIU("LDT"))
"RTN","TIUPEFIX",114,0)
 I +$G(TIU("LDT"))'>0 D
"RTN","TIUPEFIX",115,0)
 . S TIUDICDT=+$$IDATE^TIULC($G(TIUDICDT))
"RTN","TIUPEFIX",116,0)
 . I +TIUDICDT,($P(TIUDICDT,".",2)'>0) D
"RTN","TIUPEFIX",117,0)
 . . S TIUDICDT=$S($P(TIU("VSTR"),";",3)'="H":$P($G(TIU("EDT")),U),1:"")
"RTN","TIUPEFIX",118,0)
 . S TIURDT=$S(+$G(TIUDICDT)>0:+$G(TIUDICDT),1:+$$NOW^TIULC)
"RTN","TIUPEFIX",119,0)
 . S:+$G(TIUTYPE)=1 @FDARR@(.12)=1
"RTN","TIUPEFIX",120,0)
 . K TIUDICDT
"RTN","TIUPEFIX",121,0)
 S @FDARR@(1301)=TIURDT,@FDARR@(1303)="U"
"RTN","TIUPEFIX",122,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPEFIX",123,0)
 Q
"RTN","TIUPEFIX",124,0)
REQVER(VPARM) ; Evaluate whether verification is required
"RTN","TIUPEFIX",125,0)
 Q $S(VPARM=1:1,VPARM=2:1,1:0)
"RTN","TIUPEFIX",126,0)
MAKEADD(TIUDADD,TIUDA,TIUBUF) ; Create an addendum record
"RTN","TIUPEFIX",127,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUCAN,TIUFPRIV,TIU,TIUX S TIUFPRIV=1
"RTN","TIUPEFIX",128,0)
 N TIUDTTL,TIUPOST,TIUREC
"RTN","TIUPEFIX",129,0)
 S TIUDTTL=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIUPEFIX",130,0)
 S TIUATYP=+$$WHATITLE^TIUPUTU("ADDENDUM")
"RTN","TIUPEFIX",131,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUPEFIX",132,0)
 D ^DIC
"RTN","TIUPEFIX",133,0)
 S TIUDADD=+Y
"RTN","TIUPEFIX",134,0)
 I +Y'>0 S TIUDADD=TIUDADD_"^Could not create addendum." Q
"RTN","TIUPEFIX",135,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPEFIX",136,0)
 S TIU("DOCTYP")=TIUATYP_U_$$PNAME^TIULC1(TIUATYP)
"RTN","TIUPEFIX",137,0)
 D STUFREC(TIUDADD,DFN,+TIUDA,.TIU)
"RTN","TIUPEFIX",138,0)
 D LOADTIUX(.TIUX,TIUBUF)
"RTN","TIUPEFIX",139,0)
 K ^TIU(8925,+TIUDADD,"TEMP"),TIUX(.001),TIUX(1405)
"RTN","TIUPEFIX",140,0)
 M ^TIU(8925,+TIUDADD,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUPEFIX",141,0)
 D FILE(.SUCCESS,+TIUDADD,.TIUX,TIUATYP)
"RTN","TIUPEFIX",142,0)
 D MERGTEXT^TIUEDI1(+TIUDADD,.TIU)
"RTN","TIUPEFIX",143,0)
 S TIUPOST=$$POSTFILE^TIULC1(TIUDTTL)
"RTN","TIUPEFIX",144,0)
 S TIUREC("#")=TIUDADD
"RTN","TIUPEFIX",145,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPEFIX",146,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUPEFIX",147,0)
 Q
"RTN","TIUPEFIX",148,0)
FILE(SUCCESS,TIUDA,TIUX,RTYPE) ; Call FM Filer to commit updates to DB
"RTN","TIUPEFIX",149,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG
"RTN","TIUPEFIX",150,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="KE"
"RTN","TIUPEFIX",151,0)
 M @FDARR=TIUX
"RTN","TIUPEFIX",152,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPEFIX",153,0)
 I $D(TIUMSG)>9 D
"RTN","TIUPEFIX",154,0)
 . S SUCCESS=0_U_$G(TIUMSG("DIERR",1,"TEXT",1))
"RTN","TIUPEFIX",155,0)
 . D MAIN^TIUPEVNT(TIUBUF,2,"",$P($G(^TIU(8925.1,+RTYPE,0)),U),.FDA,.TIUMSG)
"RTN","TIUPEFIX",156,0)
 E  S SUCCESS=TIUDA
"RTN","TIUPEFIX",157,0)
 Q
"RTN","TIUPEFIX",158,0)
TRNSFRM(RTYPE,FLD,X) ; Executes Transform code for a given header field
"RTN","TIUPEFIX",159,0)
 N XFORM
"RTN","TIUPEFIX",160,0)
 S FLD=$O(^TIU(8925.1,+RTYPE,"HEAD","D",+FLD,0))
"RTN","TIUPEFIX",161,0)
 I +FLD'>0 G TRNSFRMX
"RTN","TIUPEFIX",162,0)
 S XFORM=$G(^TIU(8925.1,+RTYPE,"HEAD",+FLD,1))
"RTN","TIUPEFIX",163,0)
 I XFORM']"" G TRNSFRMX
"RTN","TIUPEFIX",164,0)
 X XFORM
"RTN","TIUPEFIX",165,0)
TRNSFRMX Q X
"RTN","TIUPR112")
0^^B1565444
"RTN","TIUPR112",1,0)
TIUPR112 ; SLC/JER - PRE-Install for TIU*1*112;09/12/2003
"RTN","TIUPR112",2,0)
 ;;1.0;Text Integration Utilities;**112**;Jun 20, 1997
"RTN","TIUPR112",3,0)
MAIN ; Control subroutine
"RTN","TIUPR112",4,0)
 N TEXT,TIUNAME,TIUDA,TIUDT,TIULIST
"RTN","TIUPR112",5,0)
 S (TIUNAME,TIUDA,TIUDT)=0
"RTN","TIUPR112",6,0)
 F  S TIUNAME=$O(^PXD(811.8,"B",TIUNAME)) Q:TIUNAME=""  F  S TIUDT=$O(^PXD(811.8,"B",TIUNAME,TIUDT)) Q:TIUDT=""  F  S TIUDA=$O(^PXD(811.8,"B",TIUNAME,TIUDT,TIUDA)) Q:TIUDA=""  D
"RTN","TIUPR112",7,0)
 . I TIUNAME["TIU*1*112" S TIULIST(TIUDA)=""
"RTN","TIUPR112",8,0)
 S TEXT=" Removing Reminders Exchange File Entry from prior install..."
"RTN","TIUPR112",9,0)
 D BMES^XPDUTL(TEXT)
"RTN","TIUPR112",10,0)
 D DELETE^PXRMEXU1(.TIULIST)
"RTN","TIUPR112",11,0)
 Q
"RTN","TIUPS112")
0^14^B5946128
"RTN","TIUPS112",1,0)
TIUPS112 ; SLC/JER - Post-Install for TIU*1*112 ; 02/04/2004
"RTN","TIUPS112",2,0)
 ;;1.0;Text Integration Utilities;**112**;Jun 20, 1997
"RTN","TIUPS112",3,0)
MAIN ; Control subroutine
"RTN","TIUPS112",4,0)
 N DA,TIUDA,TIUFPRIV,TIUFWHO,TIULUV,TEXT
"RTN","TIUPS112",5,0)
 S TIUFPRIV=1,TIUFWHO="N"
"RTN","TIUPS112",6,0)
 ; Find REMINDER EXCHANGE file Entry
"RTN","TIUPS112",7,0)
 S TIULUV(1)="TIU*1*112 20040325"
"RTN","TIUPS112",8,0)
 S TIULUV(2)="03/25/2004@14:20:47"
"RTN","TIUPS112",9,0)
 S TIUDA=+$$FIND1^DIC(811.8,"","KU",.TIULUV)
"RTN","TIUPS112",10,0)
 I TIUDA=0 D  Q
"RTN","TIUPS112",11,0)
 . S TEXT=" Couldn't find Exchange File for SURGICAL REPORTS..."
"RTN","TIUPS112",12,0)
 . D BMES^XPDUTL(TEXT)
"RTN","TIUPS112",13,0)
 S TEXT=" Installing Document Definitions for SURGICAL REPORTS..."
"RTN","TIUPS112",14,0)
 D BMES^XPDUTL(TEXT)
"RTN","TIUPS112",15,0)
 D POSTKIDS^PXRMEXU5(TIUDA)
"RTN","TIUPS112",16,0)
 D INSTALL^PXRMEXSI(TIUDA)
"RTN","TIUPS112",17,0)
 ; Attach the new SURGICAL REPORTS Class to CLINICAL DOCUMENTS
"RTN","TIUPS112",18,0)
 S TIUDA=+$$CLASS("SURGICAL REPORTS")
"RTN","TIUPS112",19,0)
 I 'TIUDA D  Q
"RTN","TIUPS112",20,0)
 . D BMES^XPDUTL(" Unable to attach SURGICAL REPORTS to Root Class...")
"RTN","TIUPS112",21,0)
 D ADDITEM(TIUDA)
"RTN","TIUPS112",22,0)
 S TEXT=" Registering RPCs for SURGICAL REPORTS..."
"RTN","TIUPS112",23,0)
 D BMES^XPDUTL(TEXT)
"RTN","TIUPS112",24,0)
 D REG
"RTN","TIUPS112",25,0)
 Q
"RTN","TIUPS112",26,0)
CLASS(TIUDNM) ; Find the class
"RTN","TIUPS112",27,0)
 N TIUY,POP S (POP,TIUY)=0
"RTN","TIUPS112",28,0)
 F  S TIUY=$O(^TIU(8925.1,"B",TIUDNM,TIUY)) Q:+TIUY'>0  D  Q:POP
"RTN","TIUPS112",29,0)
 . I $P($G(^TIU(8925.1,+TIUY,0)),U,4)="CL" S POP=1
"RTN","TIUPS112",30,0)
 Q TIUY
"RTN","TIUPS112",31,0)
ADDITEM(TIUDA) ; Add SURGICAL REPORTS to CLINICAL DOCUMENTS
"RTN","TIUPS112",32,0)
 N D,D0,DI,DIY,DQ,DA,DIC,DLAYGO,DIE,DR,I,TIUI,TIUFPRIV,X,Y,XQORM
"RTN","TIUPS112",33,0)
 S TIUFPRIV=1
"RTN","TIUPS112",34,0)
 S DIC="^TIU(8925.1,38,10,",DLAYGO=8925.14,DIC(0)="LNX"
"RTN","TIUPS112",35,0)
 S X="`"_TIUDA,DA(1)=38
"RTN","TIUPS112",36,0)
 D ^DIC Q:+Y'>0
"RTN","TIUPS112",37,0)
 S TIUI=$P(^TIU(8925.1,38,10,0),U,4)
"RTN","TIUPS112",38,0)
 S DA(1)=38,DA=+Y,DIE=DIC
"RTN","TIUPS112",39,0)
 S DR="4////Surgical Reports"
"RTN","TIUPS112",40,0)
 D ^DIE
"RTN","TIUPS112",41,0)
 ; Serialize menu items
"RTN","TIUPS112",42,0)
 S (DA,TIUI)=0
"RTN","TIUPS112",43,0)
 F  S DA=$O(^TIU(8925.1,38,10,DA)) Q:+DA'>0  D
"RTN","TIUPS112",44,0)
 . S TIUI=TIUI+1,DR="2////^S X=TIUI;3////^S X=TIUI" D ^DIE
"RTN","TIUPS112",45,0)
 ; Re-compile menu
"RTN","TIUPS112",46,0)
 K ^XUTL("XQORM","38;TIU(8925.1,")
"RTN","TIUPS112",47,0)
 S XQORM="38;TIU(8925.1,",XQORM(0)="" D ^XQORM
"RTN","TIUPS112",48,0)
 Q
"RTN","TIUPS112",49,0)
 ;
"RTN","TIUPS112",50,0)
REG ; Register RPCs
"RTN","TIUPS112",51,0)
 N MENU,RPC
"RTN","TIUPS112",52,0)
 S MENU="OR CPRS GUI CHART"
"RTN","TIUPS112",53,0)
 F RPC="TIU GET DOCUMENTS FOR REQUEST","TIU IDENTIFY SURGERY CLASS","TIU IS THIS A SURGERY?","TIU LONG LIST SURGERY TITLES" D INSERT(MENU,RPC)
"RTN","TIUPS112",54,0)
 Q
"RTN","TIUPS112",55,0)
 ;
"RTN","TIUPS112",56,0)
INSERT(OPTION,RPC) ; Call FM Updater with each RPC
"RTN","TIUPS112",57,0)
 ; Input  -- OPTION   Option file (#19) Name field (#.01)
"RTN","TIUPS112",58,0)
 ;           RPC      RPC sub-file (#19.05) RPC field (#.01)
"RTN","TIUPS112",59,0)
 ; Output -- None
"RTN","TIUPS112",60,0)
 N FDA,FDAIEN,ERR,DIERR
"RTN","TIUPS112",61,0)
 S FDA(19,"?1,",.01)=OPTION
"RTN","TIUPS112",62,0)
 S FDA(19.05,"?+2,?1,",.01)=RPC
"RTN","TIUPS112",63,0)
 D UPDATE^DIE("E","FDA","FDAIEN","ERR")
"RTN","TIUPS112",64,0)
 Q
"RTN","TIUPUTC")
0^22^B28257433
"RTN","TIUPUTC",1,0)
TIUPUTC ; SLC/JER - Document filer - captioned header ;11/01/03
"RTN","TIUPUTC",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,21,81,100,113,112**;Jun 20, 1997
"RTN","TIUPUTC",3,0)
 ;
"RTN","TIUPUTC",4,0)
MAIN ; ---- Controls branching.
"RTN","TIUPUTC",5,0)
 ;      Attempts to file upload documents in the target file.
"RTN","TIUPUTC",6,0)
 ;      Requires DA = IEN of 8925.2 upload buffer entry.
"RTN","TIUPUTC",7,0)
 N TIUDA,TIUBGN,TIUI,TIUHSIG,TIULIM,TIULCNT,TIULINE,TIUREC,TIUPOST
"RTN","TIUPUTC",8,0)
 N TIUTYPE,TIUINST K ^TMP("TIUPUTC",$J)
"RTN","TIUPUTC",9,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUPUTC",10,0)
 S TIUHSIG=$P(TIUPRM0,U,10),TIUBGN=$P(TIUPRM0,U,12)
"RTN","TIUPUTC",11,0)
 I TIUHSIG']"" D MAIN^TIUPEVNT(DA,1,1) Q
"RTN","TIUPUTC",12,0)
 I TIUBGN']"" D MAIN^TIUPEVNT(DA,1,7) Q
"RTN","TIUPUTC",13,0)
 ; ---- Strip controls when kermit:
"RTN","TIUPUTC",14,0)
 I $P(TIUPRM0,U,17)="k" D PREPROC(DA)
"RTN","TIUPUTC",15,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925.2,+DA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUPUTC",16,0)
 . S TIULINE=$G(^TIU(8925.2,+DA,"TEXT",TIUI,0))
"RTN","TIUPUTC",17,0)
 . I TIULINE[TIUHSIG D  Q
"RTN","TIUPUTC",18,0)
 . . ; ---- Hdr signal line.  GETREC^TIUPUTC1 resets TIUI to $TXT line:
"RTN","TIUPUTC",19,0)
 . . N TIUHDR,TIUFRST,TIUJ S TIUFRST=TIUI
"RTN","TIUPUTC",20,0)
 . . ; ---- If after first hdr signal, finish previous docmt
"RTN","TIUPUTC",21,0)
 . . ;      before going on w/ current docmt:
"RTN","TIUPUTC",22,0)
 . . I +$G(TIULCNT),$D(TIUREC("TROOT")),$D(@(TIUREC("TROOT")_"0)")) D FINISH
"RTN","TIUPUTC",23,0)
 . . K TIUREC D GETREC^TIUPUTC1(TIULINE,.TIUREC,.TIUHDR)
"RTN","TIUPUTC",24,0)
 . . I +$G(TIUREC("#"))'>0!($G(TIUREC("ROOT"))']"") Q
"RTN","TIUPUTC",25,0)
 . . D STUFREC(.TIUHDR,.TIUREC)
"RTN","TIUPUTC",26,0)
 . . S TIUREC("TROOT")=TIUREC("ROOT")_TIUREC("#")_","_TIUREC("TEXT")_","
"RTN","TIUPUTC",27,0)
 . . S:'$D(@(TIUREC("TROOT")_"0)")) @(TIUREC("TROOT")_"0)")="^^^^^"
"RTN","TIUPUTC",28,0)
 . . S TIULCNT=+$P(@(TIUREC("TROOT")_"0)"),U,4)
"RTN","TIUPUTC",29,0)
 . . F TIUJ=TIUFRST:1:TIUI D
"RTN","TIUPUTC",30,0)
 . . . ; ---- Delete header lines from buffer once filed;
"RTN","TIUPUTC",31,0)
 . . . ;      (TIUI was reset in GETREC^TIUPUTC1 to $TXT line):
"RTN","TIUPUTC",32,0)
 . . . K ^TIU(8925.2,+DA,"TEXT",TIUJ,0)
"RTN","TIUPUTC",33,0)
 . . I TIUREC("FILE")=8925,+$G(TIUREC("#")),+$G(TIUREC("BOILON")) D BOILRPLT(.TIUREC)
"RTN","TIUPUTC",34,0)
 . I TIULINE'[TIUHSIG,(TIULINE'[TIUBGN),(+$G(TIUREC("FILE"))=8925),+$G(TIUREC("BOILON")) D
"RTN","TIUPUTC",35,0)
 . . I TIULINE]"",$D(^TIU(8925.1,"B",$P(TIULINE,":"))) D  I 1
"RTN","TIUPUTC",36,0)
 . . . S TIULCNT=$$LOCATE(TIULINE,TIUREC("#"))
"RTN","TIUPUTC",37,0)
 . . E  S TIULCNT=+$G(TIULCNT)+.01
"RTN","TIUPUTC",38,0)
 . . S ^TIU(8925,+TIUREC("#"),"TEMP",TIULCNT,0)=TIULINE
"RTN","TIUPUTC",39,0)
 . . ; ---- Delete text line from buffer once xferred:
"RTN","TIUPUTC",40,0)
 . . K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",41,0)
 . I TIULINE'[TIUHSIG,(TIULINE'[TIUBGN),$D(TIUREC("TROOT")),$D(@(TIUREC("TROOT")_"0)")),(+$G(TIUREC("BOILON"))'>0) D
"RTN","TIUPUTC",42,0)
 . . S TIULCNT=+$G(TIULCNT)+1,@(TIUREC("TROOT")_TIULCNT_",0)")=TIULINE
"RTN","TIUPUTC",43,0)
 . . ; ---- Delete text line once xferred:
"RTN","TIUPUTC",44,0)
 . . K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",45,0)
 . . ; ---- Remove leading buffer garbage
"RTN","TIUPUTC",46,0)
 . I TIULINE'[TIUHSIG,(TIULINE'[TIUBGN),'$D(TIUREC("TROOT")),($G(TIUREC("#"))'=-1) K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",47,0)
 . I TIULINE[TIUBGN K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",48,0)
 ; ---- Finish last docmt in buffer file:
"RTN","TIUPUTC",49,0)
 I +$G(TIULCNT),$D(TIUREC("TROOT")),$D(@(TIUREC("TROOT")_"0)")) D FINISH
"RTN","TIUPUTC",50,0)
 I '+$O(^TIU(8925.2,+DA,"TEXT",0)) D BUFPURGE(DA)
"RTN","TIUPUTC",51,0)
 ; ---- Write upload results:
"RTN","TIUPUTC",52,0)
 I '$D(ZTQUEUED),$D(^TMP("TIUPUTC",$J)) D
"RTN","TIUPUTC",53,0)
 . W !!,"TOTALS FOR CURRENT BATCH:",!
"RTN","TIUPUTC",54,0)
 . W !?14,"TOTAL Document(s) RECEIVED: ",$J((+$G(^TMP("TIUPUTC",$J,"SUCC"))+$G(^("MISS"))+$G(^("FAIL"))),5),!
"RTN","TIUPUTC",55,0)
 . W !?18," Document(s) NOT FILED: ",$J(+$G(^TMP("TIUPUTC",$J,"FAIL")),5)
"RTN","TIUPUTC",56,0)
 . W !?3,"Document(s) FILED with MISSING FIELDS: ",$J(+$G(^TMP("TIUPUTC",$J,"MISS")),5),!
"RTN","TIUPUTC",57,0)
 K ^TMP("TIUPUTC",$J)
"RTN","TIUPUTC",58,0)
 Q
"RTN","TIUPUTC",59,0)
LOCATE(LINE,REC) ; ---- Locate line in boilerplate text
"RTN","TIUPUTC",60,0)
 N TIUJ,HIT,BTXT S (TIUJ,HIT)=0
"RTN","TIUPUTC",61,0)
 F  Q:+HIT  S TIUJ=$O(^TIU(8925,+REC,"TEMP",TIUJ)) Q:+TIUJ'>0!HIT  D
"RTN","TIUPUTC",62,0)
 . S BTXT=$G(^TIU(8925,+REC,"TEMP",TIUJ,0))
"RTN","TIUPUTC",63,0)
 . I BTXT[$P(LINE,":")_":" S HIT=1
"RTN","TIUPUTC",64,0)
 Q +$G(TIUJ)
"RTN","TIUPUTC",65,0)
 ;
"RTN","TIUPUTC",66,0)
STUFREC(HEADER,RECORD) ; ---- Stuffs record with known fixed fields;
"RTN","TIUPUTC",67,0)
 ;                      Checks for missing fields.
"RTN","TIUPUTC",68,0)
 N FDA,FDARR,IENS,FLAGS,TIUI,TIUMSG,TIUPC
"RTN","TIUPUTC",69,0)
 S IENS=""""_+RECORD("#")_","""
"RTN","TIUPUTC",70,0)
 S FDARR="FDA("_+RECORD("FILE")_","_IENS_")",FLAGS="KE"
"RTN","TIUPUTC",71,0)
 ; ---- Set up FDA Array:
"RTN","TIUPUTC",72,0)
 S TIUI=0
"RTN","TIUPUTC",73,0)
 F  S TIUI=$O(HEADER(TIUI)) Q:+TIUI'>0  D
"RTN","TIUPUTC",74,0)
 . S:TIUI'=.001 @FDARR@(TIUI)=$$TRNSFRM^TIULX(.RECORD,TIUI,HEADER(TIUI))
"RTN","TIUPUTC",75,0)
 I $D(FDA) D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTC",76,0)
 I $D(TIUMSG) D
"RTN","TIUPUTC",77,0)
 . ; ---- If FILE^DIC fails, log 8925.4 error w/ hdr info.  Create new
"RTN","TIUPUTC",78,0)
 . ;      8925.2 buffer entry with hdr, text, & 8925.4 log #.
"RTN","TIUPUTC",79,0)
 . ;      Kill most of old buffer. Send missing field alerts:
"RTN","TIUPUTC",80,0)
 . D MAIN^TIUPEVNT(DA,2,"",$P($G(^TIU(8925.1,+RECORD("TYPE"),0)),U),.FDA,.TIUMSG)
"RTN","TIUPUTC",81,0)
 . S ^TMP("TIUPUTC",$J,"MISS")=+$G(^TMP("TIUPUTC",$J,"MISS"))+1
"RTN","TIUPUTC",82,0)
 I '$D(TIUMSG) D
"RTN","TIUPUTC",83,0)
 . S ^TMP("TIUPUTC",$J,"SUCC")=+$G(^TMP("TIUPUTC",$J,"SUCC"))+1
"RTN","TIUPUTC",84,0)
 Q
"RTN","TIUPUTC",85,0)
BOILRPLT(TIUREC) ; ---- Execute/Interleave Boilerplates w/uploaded text
"RTN","TIUPUTC",86,0)
 N TIU
"RTN","TIUPUTC",87,0)
 D GETTIU^TIULD(.TIU,TIUREC("#"))
"RTN","TIUPUTC",88,0)
 D LOADDFLT^TIUEDI4(TIUREC("#"),TIUREC("TYPE")) ;100
"RTN","TIUPUTC",89,0)
 Q
"RTN","TIUPUTC",90,0)
SETROOT(LINECNT,RECORD) ; ---- Sets root of WP field
"RTN","TIUPUTC",91,0)
 S @(RECORD("TROOT")_"0)")="^^"_LINECNT_"^"_LINECNT_"^"_DT_"^^"
"RTN","TIUPUTC",92,0)
 Q
"RTN","TIUPUTC",93,0)
BUFPURGE(DA) ; ---- Call ^DIK to purge buffer record when all's well
"RTN","TIUPUTC",94,0)
 N DIK S DIK="^TIU(8925.2," D ^DIK
"RTN","TIUPUTC",95,0)
 Q
"RTN","TIUPUTC",96,0)
PREPROC(DA) ; ---- Strip controls & white space from headers
"RTN","TIUPUTC",97,0)
 N TIUI,TIUHLIN,X S (TIUI,TIUHLIN)=0
"RTN","TIUPUTC",98,0)
 F  S TIUI=$O(^TIU(8925.2,+DA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUPUTC",99,0)
 . S X=$G(^TIU(8925.2,+DA,"TEXT",TIUI,0))
"RTN","TIUPUTC",100,0)
 . S:X[TIUHSIG TIUHLIN=1 S:X[TIUBGN TIUHLIN=0
"RTN","TIUPUTC",101,0)
 . S:TIUHLIN ^TIU(8925.2,+DA,"TEXT",TIUI,0)=$$STRIP^TIUUPLD(X)
"RTN","TIUPUTC",102,0)
 Q
"RTN","TIUPUTC",103,0)
DADTYPE(DA) ; ---- Get type of original document for addenda
"RTN","TIUPUTC",104,0)
 N TIUDAD,Y
"RTN","TIUPUTC",105,0)
 S TIUDAD=$P($G(^TIU(8925,DA,0)),U,6)
"RTN","TIUPUTC",106,0)
 S Y=+$G(^TIU(8925,+TIUDAD,0))
"RTN","TIUPUTC",107,0)
 Q Y
"RTN","TIUPUTC",108,0)
 ;
"RTN","TIUPUTC",109,0)
FINISH ; ---- Finish document: feedback, postfile code, merge boil,
"RTN","TIUPUTC",110,0)
 ;      log file event
"RTN","TIUPUTC",111,0)
 N ISADDNDM S ISADDNDM=0
"RTN","TIUPUTC",112,0)
 D SETROOT(TIULCNT,.TIUREC)
"RTN","TIUPUTC",113,0)
 S ISADDNDM=+$$ISADDNDM^TIULC1(TIUREC("#"))
"RTN","TIUPUTC",114,0)
 S TIUTYPE=$S(ISADDNDM:+$$DADTYPE(TIUREC("#")),1:TIUREC("TYPE"))
"RTN","TIUPUTC",115,0)
 I '$D(ZTQUEUED) W !,">>> ",$S(ISADDNDM:"Addendum",1:"Document")," Filed Successfully.",! ;TIU*1*81
"RTN","TIUPUTC",116,0)
 ; ---- TIU*1*81 Tell error handler that retrying filer was successful:
"RTN","TIUPUTC",117,0)
 S TIUDONE=1
"RTN","TIUPUTC",118,0)
 S TIUTYPE=$S(+$$ISADDNDM^TIULC1(TIUREC("#")):+$$DADTYPE(TIUREC("#")),1:TIUREC("TYPE"))
"RTN","TIUPUTC",119,0)
 S TIUPOST=$$POSTFILE^TIULC1(TIUTYPE)
"RTN","TIUPUTC",120,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPUTC",121,0)
 I TIUREC("FILE")=8925,+$G(TIUREC("BOILON")) D
"RTN","TIUPUTC",122,0)
 . N TIU D GETTIU^TIULD(.TIU,TIUREC("#"))
"RTN","TIUPUTC",123,0)
 . D MERGTEXT^TIUEDI1(TIUREC("#"),.TIU)
"RTN","TIUPUTC",124,0)
 . K ^TIU(8925,+TIUREC("#"),"TEMP")
"RTN","TIUPUTC",125,0)
 D MAIN^TIUPEVNT(DA,0,"",$P($G(^TIU(8925.1,+TIUREC("TYPE"),0)),U))
"RTN","TIUPUTC",126,0)
 Q
"RTN","TIUPUTC",127,0)
 ;
"RTN","TIUPUTS")
0^15^B32496755
"RTN","TIUPUTS",1,0)
TIUPUTS ; SLC/JER - Surgery Look-up, etc. ;09/12/2003
"RTN","TIUPUTS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**112**;Jun 20, 1997
"RTN","TIUPUTS",3,0)
LOOKUP ; Look-up code used by router/filer
"RTN","TIUPUTS",4,0)
 ; Required: TIUSRCN, TIUSDA, TIUSSN, TIUODT
"RTN","TIUPUTS",5,0)
 N SRODT,DFN,TIUSR0,TIUD0,TIUDAD
"RTN","TIUPUTS",6,0)
 I $S('$D(TIUSSN):1,$G(TIUSSN)?4N:1,$G(TIUSSN)']"":1,+$G(TIUODT)'>0:1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTS",7,0)
 I TIUSSN?3N1P2N1P4N.E S TIUSSN=$TR(TIUSSN,"-/","")
"RTN","TIUPUTS",8,0)
 I TIUSSN["?" S Y=-1 G LOOKUPX
"RTN","TIUPUTS",9,0)
 S DFN=+$$PATIENT^TIULA(TIUSSN)
"RTN","TIUPUTS",10,0)
 I DFN'>0 S Y=-1 G LOOKUPX
"RTN","TIUPUTS",11,0)
 I +$G(TIUSRCN)=0 S TIUSRCN=$$FINDCASE(DFN,+$$IDATE^TIULC(TIUODT))
"RTN","TIUPUTS",12,0)
 I +$G(TIUSRCN)'>0 S Y=-1 G LOOKUPX
"RTN","TIUPUTS",13,0)
 I +$G(TIUSDA)'>0,$D(^SRF(TIUSRCN,"TIU")) S TIUSDA=$$GETSDA(TIUSRCN)
"RTN","TIUPUTS",14,0)
 I +$G(TIUSDA)'>0 D  G LOOKUPX
"RTN","TIUPUTS",15,0)
 . S Y=-1
"RTN","TIUPUTS",16,0)
 . I '$D(^SRF(TIUSRCN,"TIU")),'$D(ZTQUEUED) D
"RTN","TIUPUTS",17,0)
 . . W !!,"Time Out of O.R. has not yet been entered for Surgical Case #",TIUSRCN
"RTN","TIUPUTS",18,0)
 . . W !,"the Surgical Service must complete this step before the Operation"
"RTN","TIUPUTS",19,0)
 . . W !,"Report can be uploaded..."
"RTN","TIUPUTS",20,0)
 K TIUHDR(.001),TIUHDR(.02),TIUHDR(.07),TIUHDR(1405)
"RTN","TIUPUTS",21,0)
 S TIUD0=$G(^TIU(8925,TIUSDA,0)),TIUSR0=$G(^SRF(TIUSRCN,0))
"RTN","TIUPUTS",22,0)
 ;Confirm that SURGICAL CASE is for correct patient
"RTN","TIUPUTS",23,0)
 I +TIUSR0'=DFN S Y=-1 G LOOKUPX
"RTN","TIUPUTS",24,0)
 ;Confirm that TIU DOCUMENT is for correct patient
"RTN","TIUPUTS",25,0)
 I +$P(TIUD0,U,2)'=DFN S Y=-1 G LOOKUPX
"RTN","TIUPUTS",26,0)
 ;Confirm that OPERATION DATE is correct
"RTN","TIUPUTS",27,0)
 I +$$IDATE^TIULC(TIUODT)'=$P($P(TIUSR0,U,9),".") S Y=-1 G LOOKUPX
"RTN","TIUPUTS",28,0)
 S Y=$$CALLDIC(TIUSDA)
"RTN","TIUPUTS",29,0)
 I '+$$CANEDIT(+Y) D
"RTN","TIUPUTS",30,0)
 . W !,"Existing document may not be edited...Creating Addendum."
"RTN","TIUPUTS",31,0)
 . S TIUDAD=Y,Y=$$MAKEADD^TIUPUTU()
"RTN","TIUPUTS",32,0)
 . D COPYDAD(Y,TIUDAD)
"RTN","TIUPUTS",33,0)
LOOKUPX K TIUSRCN,TIUSDA
"RTN","TIUPUTS",34,0)
 Q
"RTN","TIUPUTS",35,0)
CANEDIT(DA) ; Check whether or not document is released
"RTN","TIUPUTS",36,0)
 Q $S(+$P($G(^TIU(8925,+DA,0)),U,5)<4:1,1:0)
"RTN","TIUPUTS",37,0)
COPYDAD(DA,PARENT) ; copy fixed field data for addenda
"RTN","TIUPUTS",38,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIUOPDT,TIUD0,TIUD12,TIUD14
"RTN","TIUPUTS",39,0)
 S TIUD0=$G(^TIU(8925,+PARENT,0)),TIUD12=$G(^(12)),TIUD14=$G(^(14))
"RTN","TIUPUTS",40,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTS",41,0)
 S @FDARR@(.02)=$P(TIUD0,U,2)
"RTN","TIUPUTS",42,0)
 S @FDARR@(.03)=$P(TIUD0,U,3),@FDARR@(.05)=3
"RTN","TIUPUTS",43,0)
 S @FDARR@(.06)=PARENT,@FDARR@(.08)=$P(TIUD0,U,8)
"RTN","TIUPUTS",44,0)
 S @FDARR@(1401)=$P(TIUD14,U)
"RTN","TIUPUTS",45,0)
 S @FDARR@(1402)=$P(TIUD14,U,2)
"RTN","TIUPUTS",46,0)
 S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTS",47,0)
 S @FDARR@(1205)=$P(TIUD12,U,5)
"RTN","TIUPUTS",48,0)
 S TIUOPDT=+$$IDATE^TIULC($G(TIUODT))
"RTN","TIUPUTS",49,0)
 S TIURDT=$S(+$G(TIUOPDT)>0:+$G(TIUOPDT),1:+$$NOW^XLFDT)
"RTN","TIUPUTS",50,0)
 S @FDARR@(1301)=TIURDT,@FDARR@(1303)="U"
"RTN","TIUPUTS",51,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPUTS",52,0)
 Q
"RTN","TIUPUTS",53,0)
FINDCASE(DFN,TIUODT) ; Find Surgical Case for Pt & Dt, if unique
"RTN","TIUPUTS",54,0)
 N TIUY,TIUCN,TIUHIT,TIUPOP S TIUCN="",(TIUY,TIUHIT,TIUPOP)=0
"RTN","TIUPUTS",55,0)
 F  S TIUCN=$O(^SRF("B",DFN,TIUCN),-1) Q:TIUCN'>0!+TIUPOP  D
"RTN","TIUPUTS",56,0)
 . N TIUSR0 S TIUSR0=$G(^SRF(TIUCN,0))
"RTN","TIUPUTS",57,0)
 . I +$G(TIUODT)=$P($P(TIUSR0,U,9),".") D
"RTN","TIUPUTS",58,0)
 . . I +TIUHIT S TIUPOP=1 Q
"RTN","TIUPUTS",59,0)
 . . S TIUHIT=TIUCN
"RTN","TIUPUTS",60,0)
 I 'TIUPOP,TIUHIT S TIUY=TIUHIT
"RTN","TIUPUTS",61,0)
 Q TIUY
"RTN","TIUPUTS",62,0)
GETSDA(TIUSRCN) ; Get Op Report for Case
"RTN","TIUPUTS",63,0)
 N TIUY S TIUY=+$P(^SRF(TIUSRCN,"TIU"),U)
"RTN","TIUPUTS",64,0)
 I 'TIUY S TIUY=+$P(^SRF(TIUSRCN,"TIU"),U,3)
"RTN","TIUPUTS",65,0)
 Q TIUY
"RTN","TIUPUTS",66,0)
CALLDIC(TIUX) ; Call ^DIC to get the IEN for the TIU DOCUMENT
"RTN","TIUPUTS",67,0)
 N DA,DIC,X,Y
"RTN","TIUPUTS",68,0)
 S DIC=8925,DIC(0)="NX",X="`"_TIUX D ^DIC
"RTN","TIUPUTS",69,0)
 Q Y
"RTN","TIUPUTS",70,0)
FOLLOWUP(TIUDA) ; Post-filing code for Operation Reports
"RTN","TIUPUTS",71,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIU
"RTN","TIUPUTS",72,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTS",73,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPUTS",74,0)
 I $L($G(TIU("EDT"))) S @FDARR@(.07)=$P($G(TIU("EDT")),U)
"RTN","TIUPUTS",75,0)
 S @FDARR@(1204)=$$WHOSIGNS^TIULC1(TIUDA)
"RTN","TIUPUTS",76,0)
 S @FDARR@(1208)=$$WHOCOSIG^TIULC1(TIUDA)
"RTN","TIUPUTS",77,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTS",78,0)
 I +$P($G(^TIU(8925,+TIUDA,12)),U,4)'=+$P($G(^(12)),U,9) D
"RTN","TIUPUTS",79,0)
 . S @FDARR@(1506)=1 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTS",80,0)
 D RELEASE^TIUT(TIUDA,1)
"RTN","TIUPUTS",81,0)
 D AUDIT^TIUEDI1(TIUDA,0,$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")"))
"RTN","TIUPUTS",82,0)
 Q
"RTN","TIUPUTS",83,0)
FIX ; Filing error resolution code for Operation Reports
"RTN","TIUPUTS",84,0)
 N TIUOUT,TIUDA,TIUD0,TIUX,TIUPRM0,TIUPRM1,SUCCESS,TIUBUF,TIUHIT
"RTN","TIUPUTS",85,0)
 N TIUADD,TIUTYP,TIU,DUOUT,DTOUT
"RTN","TIUPUTS",86,0)
 S TIUHIT=0
"RTN","TIUPUTS",87,0)
 ; -- first, determine the correct TIU DOCUMENT record --
"RTN","TIUPUTS",88,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!+$G(TIUOUT)
"RTN","TIUPUTS",89,0)
 . N D,D0,DK,DL,DIC,X,Y,DA,DX,A,S,TIUFPRIV
"RTN","TIUPUTS",90,0)
 . S X=+$$PATIENT^TIULA
"RTN","TIUPUTS",91,0)
 . I X'>0 D  Q
"RTN","TIUPUTS",92,0)
 . . W !!,"Okay, no harm done...",!
"RTN","TIUPUTS",93,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUPUTS",94,0)
 . . S TIUOUT=1
"RTN","TIUPUTS",95,0)
 . S DIC=8925,DIC(0)="UXEV",D="C"
"RTN","TIUPUTS",96,0)
 . W !
"RTN","TIUPUTS",97,0)
 . S DIC("W")="D DICW^TIUPUTS(+Y)"
"RTN","TIUPUTS",98,0)
 . S DIC("S")="I +$$DICS^TIUPUTS(+Y)"
"RTN","TIUPUTS",99,0)
 . D IX^DIC
"RTN","TIUPUTS",100,0)
 . I +Y'>0 D  Q
"RTN","TIUPUTS",101,0)
 . . W !!,$S(+$O(^TIU(8925,"C",+X,0))'>0:"No OPERATION REPORTS Available to Update.",1:"No OPERATION REPORT Selected..."),!
"RTN","TIUPUTS",102,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUPUTS",103,0)
 . . S TIUOUT=1
"RTN","TIUPUTS",104,0)
 . W ! S (DA,TIUHIT)=+Y D EN^DIQ
"RTN","TIUPUTS",105,0)
 . S TIUOUT=$$READ^TIUU("Y","... OK","YES") W !
"RTN","TIUPUTS",106,0)
 . I +TIUOUT S TIUDA=DA
"RTN","TIUPUTS",107,0)
 Q:$D(DUOUT)!$D(DIROUT)!+$G(DTOUT)!'+$G(TIUDA)
"RTN","TIUPUTS",108,0)
 ; -- next, load fields from upload buffer entry --
"RTN","TIUPUTS",109,0)
 S TIUBUF=$S(+$G(XQADATA):+$G(XQADATA),+$G(BUFDA):+$G(BUFDA),1:"")
"RTN","TIUPUTS",110,0)
 ; -- if TIUDA may be edited, file data, else make addendum --
"RTN","TIUPUTS",111,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUTYP=+TIUD0
"RTN","TIUPUTS",112,0)
 I +$$CANEDIT(TIUDA)'>0 D  G FIXX
"RTN","TIUPUTS",113,0)
 . W !!,"Existing document may not be edited...Creating Addendum.",!
"RTN","TIUPUTS",114,0)
 . D MAKEADD^TIUPEFIX(.TIUADD,TIUDA,TIUBUF)
"RTN","TIUPUTS",115,0)
 . S SUCCESS=TIUADD
"RTN","TIUPUTS",116,0)
 ; -- Load the array TIUX from the buffer
"RTN","TIUPUTS",117,0)
 D LOADTIUX^TIUPEFIX(.TIUX,TIUBUF)
"RTN","TIUPUTS",118,0)
 ; -- finally, file data in TIU DOCUMENT file --
"RTN","TIUPUTS",119,0)
 K ^TIU(8925,+TIUDA,"TEMP"),TIUX(.001),TIUX(.01),TIUX(.02),TIUX(.03),TIUX(.05)
"RTN","TIUPUTS",120,0)
 K TIUX(.13),TIUX(1205),TIUX(1211),TIUX(1405)
"RTN","TIUPUTS",121,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUPUTS",122,0)
 D FILE^TIUPEFIX(.SUCCESS,+TIUDA,.TIUX,TIUTYP)
"RTN","TIUPUTS",123,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPUTS",124,0)
 D MERGTEXT^TIUEDI1(+TIUDA,.TIU) K ^TIU(8925,TIUDA,"TEMP")
"RTN","TIUPUTS",125,0)
 S TIUPOST=$$POSTFILE^TIULC1(TIUTYP)
"RTN","TIUPUTS",126,0)
 S TIUREC("#")=TIUDA
"RTN","TIUPUTS",127,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPUTS",128,0)
FIXX D ALERTDEL^TIUPEVNT(+TIUBUF)
"RTN","TIUPUTS",129,0)
 D RESOLVE^TIUPEVNT($S($D(XQADATA):+$P(XQADATA,";",3),1:$G(ERRDA)),1)
"RTN","TIUPUTS",130,0)
 D BUFPURGE^TIUPUTC(+TIUBUF)
"RTN","TIUPUTS",131,0)
 W "Done."
"RTN","TIUPUTS",132,0)
 S TIUDONE=1
"RTN","TIUPUTS",133,0)
 Q
"RTN","TIUPUTS",134,0)
DICW(TIUDA) ; Write identifiers
"RTN","TIUPUTS",135,0)
 N X,Y,VADM,VA,VAERR,TIUD0,TIUD12,TIUD13
"RTN","TIUPUTS",136,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD13=$G(^(13))
"RTN","TIUPUTS",137,0)
 W ?35,"Dated: ",$$DATE^TIULS(+TIUD13,"MM/DD/CCYY@HR:MIN"),?62,"By: ",$E($$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIUD12,U,2)),"LAST,FI MI"),1,13)
"RTN","TIUPUTS",138,0)
 Q
"RTN","TIUPUTS",139,0)
DICS(TIUDA) ; Filter IX^DIC list
"RTN","TIUPUTS",140,0)
 N TIUD0,TIUY S TIUY=0
"RTN","TIUPUTS",141,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIUPUTS",142,0)
 I +$$ISA^TIULX(+TIUD0,+$$CLASS^TIUSROI("OPERATION REPORTS")) S TIUY=1 I 1
"RTN","TIUPUTS",143,0)
 E  I +$$ISA^TIULX(+TIUD0,+$$CLASS^TIUSROI("PROCEDURE REPORT (NON-O.R.)")) S TIUY=1
"RTN","TIUPUTS",144,0)
 Q TIUY
"RTN","TIUR")
0^12^B36847949
"RTN","TIUR",1,0)
TIUR ; SLC/JER - Integrated Document Review ;11/01/03
"RTN","TIUR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**74,79,58,100,113,112**;Jun 20, 1997
"RTN","TIUR",3,0)
 ; 11/30/00 Moved PUTLIST & ADDELMNT to TIUR1
"RTN","TIUR",4,0)
MAKELIST(TIUCLASS,TIUCHVW) ; Get Search Criteria
"RTN","TIUR",5,0)
 N DIRUT,DTOUT,DUOUT,TIUI,SCREEN,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIUR",6,0)
 N TIUDPRMT,TIUPICT,TIUOUT,STATWORD,STATIFN,NOWFLAG
"RTN","TIUR",7,0)
 K DIROUT
"RTN","TIUR",8,0)
 D INITRR^TIULRR(0)
"RTN","TIUR",9,0)
 ;  TIURPN used in Order Entry 2.5, OR OE/RR MENU CLIN:
"RTN","TIUR",10,0)
 I +$G(ORVP),(+$G(TIUCHVW)'>0) D EN^TIURPN(TIUCLASS,+ORVP) Q
"RTN","TIUR",11,0)
STATUS S STATUS=$$STAT
"RTN","TIUR",12,0)
 I +STATUS<0 S VALMQUIT=1 Q
"RTN","TIUR",13,0)
 S TIUI=0
"RTN","TIUR",14,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI!(+$G(TIUOUT))  D
"RTN","TIUR",15,0)
 . I $P($G(TIUSTAT(TIUI)),U,3)="" S TIUOUT=1 Q
"RTN","TIUR",16,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIUR",17,0)
 . Q:'STATIFN
"RTN","TIUR",18,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIUR",19,0)
 I +$G(TIUOUT) S VALMQUIT=1 Q
"RTN","TIUR",20,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIUR",21,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIUR",22,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIUR",23,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIUR",24,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIUR",25,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIUR",26,0)
 N TIUDCL K TIUPICT
"RTN","TIUR",27,0)
 I $S(('$D(TIUQUIK)&'$D(ORVP)):1,($D(ORVP)&+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"A","LAST","DOC",0,.TIUDCL,.TIUPICT)
"RTN","TIUR",28,0)
 ; SELTYP sets array ^TMP("TIUTYP",$J);
"RTN","TIUR",29,0)
 ; SELTYP used to set data into TIUTYP array
"RTN","TIUR",30,0)
 ; Now TIUTYP just ="^TMP("TIUTYP",$J)"
"RTN","TIUR",31,0)
 I $S($D(TIUQUIK):1,($D(ORVP)&'+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"F","ALL","DOC",0)
"RTN","TIUR",32,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",33,0)
 I +$G(@TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIUR",34,0)
SCREEN ;
"RTN","TIUR",35,0)
 N TIUNAME
"RTN","TIUR",36,0)
 S TIUNAME=$P($G(^VA(200,+DUZ,0)),U)
"RTN","TIUR",37,0)
 I $D(TIUQUIK) D  I 1 ; all my unsigned TIUQUIK=1
"RTN","TIUR",38,0)
 . I $G(TIUQUIK)=3 S SCREEN(1)="ALL^ANY" Q
"RTN","TIUR",39,0)
 . S SCREEN(1)="AAU^"_DUZ_U_TIUNAME
"RTN","TIUR",40,0)
 . S:$G(TIUQUIK)=1 SCREEN(2)="ASUP^"_DUZ
"RTN","TIUR",41,0)
 . S SCREEN="ALL"
"RTN","TIUR",42,0)
 E  I $D(ORVP),'+$G(TIUCHVW) S SCREEN(1)="APT^"_+ORVP_U_$P($G(^DPT(+ORVP,0)),U) I 1
"RTN","TIUR",43,0)
 E  D SELCAT^TIULA1(.SCREEN,"A","AUTHOR")
"RTN","TIUR",44,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",45,0)
 I $D(SCREEN)'>9 K @TIUTYP G DOCTYPE
"RTN","TIUR",46,0)
 I $D(@TIUTYP)'>9 W !,$C(7),"You must select one or more TITLES..." G SCREEN
"RTN","TIUR",47,0)
 I $G(SCREEN(1))="ALL^ANY",+$G(ORVP) S SCREEN(1)="APT^"_+$G(ORVP)_U_$P($G(^DPT(+$G(ORVP),0)),U)
"RTN","TIUR",48,0)
 D CHECKADD
"RTN","TIUR",49,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIUR",50,0)
 S TIUDPRMT=$S(TIUCLASS=244:"Discharge",1:"Reference")
"RTN","TIUR",51,0)
 S TIUEDT=$S($D(TIUQUIK):1,$D(ORVP)&(+$G(TIUCHVW)'>0):$$FMADD^XLFDT(DT,$S($D(^DPT(+$G(ORVP),.1))'>0:-180,1:-30)),1:$P($$EDATE^TIULA(TIUDPRMT,"",TIUEDFLT),U))
"RTN","TIUR",52,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",53,0)
 I TIUEDT'>0 G SCREEN
"RTN","TIUR",54,0)
 S TIULDT=$S($D(TIUQUIK):9999999,$D(ORVP)&(+$G(TIUCHVW)'>0):+$$NOW^XLFDT,1:$P($$LDATE^TIULA(TIUDPRMT),U))
"RTN","TIUR",55,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",56,0)
 I TIULDT'>0 G ERLY
"RTN","TIUR",57,0)
 I TIUEDT>TIULDT D SWAP(.TIUEDT,.TIULDT)
"RTN","TIUR",58,0)
 I $L(TIULDT,".")=1 D EXPRANGE(.TIUEDT,.TIULDT)
"RTN","TIUR",59,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIUR",60,0)
 S NOWFLAG=$S(TIULDT-$$NOW^XLFDT<.0001:1,1:0)
"RTN","TIUR",61,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIUR",62,0)
 D BUILD(TIUCLASS,.STATUS,.SCREEN,TIUEDT,TIULDT,NOWFLAG) ;11/30/00 removed param TIUTYP since BUILD uses global now.
"RTN","TIUR",63,0)
 ; -- If attaching ID note & changed view,
"RTN","TIUR",64,0)
 ;    update video for line to be attached: --
"RTN","TIUR",65,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIUR",66,0)
 ;K @TIUTYP ;11/30/00 keep ^TMP("TIUTYP",$J) for rebuild
"RTN","TIUR",67,0)
 Q
"RTN","TIUR",68,0)
STAT() ; Determine status
"RTN","TIUR",69,0)
 N TIUY
"RTN","TIUR",70,0)
 I +$G(TIUQUIK) D  G STATX
"RTN","TIUR",71,0)
 . S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"F",$S(TIUQUIK=1:"UNSIGNED,UNCOSIGNED",TIUQUIK>1:"UNDICTATED,UNTRANSCRIBED"))
"RTN","TIUR",72,0)
 I $D(ORVP),'+$G(TIUCHVW) D  G STATX
"RTN","TIUR",73,0)
 . S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"F","COMPLETED")
"RTN","TIUR",74,0)
 S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"A",$$DFLTSTAT^TIURM(DUZ))
"RTN","TIUR",75,0)
STATX Q TIUY
"RTN","TIUR",76,0)
CHECKADD ; Checks whether Addendum is included in the list of types
"RTN","TIUR",77,0)
 N TIUI,HIT,NUMTYPS
"RTN","TIUR",78,0)
 S (TIUI,HIT)=0
"RTN","TIUR",79,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(^TMP("TIUTYP",$J,TIUI))["ADDENDUM" S HIT=1
"RTN","TIUR",80,0)
 S NUMTYPS=^TMP("TIUTYP",$J)
"RTN","TIUR",81,0)
 I +HIT'>0 S ^TMP("TIUTYP",$J,NUMTYPS+1)=+^TMP("TIUTYP",$J,NUMTYPS)+1_U_"81^Addendum^NOT PICKED",^TMP("TIUTYP",$J)=^TMP("TIUTYP",$J)+1
"RTN","TIUR",82,0)
 Q
"RTN","TIUR",83,0)
 ;
"RTN","TIUR",84,0)
SWAP(TIUX,TIUY) ; Swap variables
"RTN","TIUR",85,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIUR",86,0)
 Q
"RTN","TIUR",87,0)
EXPRANGE(TIUX,TIUY) ; Expand late date to include time
"RTN","TIUR",88,0)
 ;P74 If user entered date/time = T, then numerical date time is FIRST ^ PIECE ONLY of TIUX & TIUY.
"RTN","TIUR",89,0)
 I $P(TIUY,U)=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIUR",90,0)
 E  S TIUY=$P(TIUY,U)_"."_235959 ;P74 Add seconds
"RTN","TIUR",91,0)
 Q
"RTN","TIUR",92,0)
BUILD(TIUCLASS,STATUS,SCREEN,EARLY,LATE,NOWFLAG) ; Build List.
"RTN","TIUR",93,0)
 ;11/30/00 - removed param TYPES. 12/3 added param TIUCLASS
"RTN","TIUR",94,0)
 ; BUILD (GATHER) uses docmt type info from ^TMP("TIUTYP",$J)
"RTN","TIUR",95,0)
 N TIUDT,TIUI,TIUK
"RTN","TIUR",96,0)
 N TIUT,TIUTP,XREF,TIUS,TIUPREF
"RTN","TIUR",97,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ),(TIUK,VALMCNT)=0
"RTN","TIUR",98,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J)
"RTN","TIUR",99,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIUR",100,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIUR",101,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIUR",102,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIUR",103,0)
 S ^TMP("TIUR",$J,"RTN")="TIUR"
"RTN","TIUR",104,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUR",105,0)
 S EARLY=9999999-+$G(EARLY),LATE=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIUR",106,0)
 F  S TIUK=$O(SCREEN(TIUK)) Q:TIUK'>0  D
"RTN","TIUR",107,0)
 . I $G(SCREEN)'="ALL" S SCREEN=$G(TIUK)
"RTN","TIUR",108,0)
 . S XREF=$P(SCREEN(TIUK),U)
"RTN","TIUR",109,0)
 . I XREF'="ASUB" D
"RTN","TIUR",110,0)
 . . S TIUI=$S(XREF'="APRB":$P(SCREEN(TIUK),U,2),1:$$UPPER^TIULS($P(SCREEN(TIUK),U,3)))
"RTN","TIUR",111,0)
 . . D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF,SCREEN)
"RTN","TIUR",112,0)
 . I XREF="ASUB" D
"RTN","TIUR",113,0)
 . . S TIUI=$O(^TIU(8925,XREF,$P(SCREEN(TIUK),U,2)),-1)
"RTN","TIUR",114,0)
 . . F  S TIUI=$O(^TIU(8925,XREF,TIUI)) Q:TIUI=""!(TIUI'[$P(SCREEN(TIUK),U,2))  D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF,SCREEN)
"RTN","TIUR",115,0)
 D PUTLIST^TIUR2(TIUPREF,TIUCLASS,.STATUS,.SCREEN)
"RTN","TIUR",116,0)
 K ^TMP("TIUI",$J)
"RTN","TIUR",117,0)
 Q
"RTN","TIUR",118,0)
 ;
"RTN","TIUR",119,0)
CLEAN ; Clean up your mess!
"RTN","TIUR",120,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIUR",121,0)
 K VALMY
"RTN","TIUR",122,0)
 K ^TMP("TIUTYP",$J)
"RTN","TIUR",123,0)
 Q
"RTN","TIUR",124,0)
 ;
"RTN","TIUR",125,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIUR",126,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUSCRN,TMP,TIUEDT,TIULDT,TIUSTAT
"RTN","TIUR",127,0)
 N TIURBLD,TIUI,TIUCLASS,NOWFLAG
"RTN","TIUR",128,0)
 S TIURBLD=1
"RTN","TIUR",129,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIUR",130,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIUR",131,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIUR",132,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIUR",133,0)
 S TIUSCRN=$P(TIUR0,U,3,99),TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIUR",134,0)
 S TIUI=1
"RTN","TIUR",135,0)
 F  S TMP=$P(TIUSCRN,";",TIUI) Q:TMP=""  D
"RTN","TIUR",136,0)
 . S TIUSCRN(TIUI)=TMP,TIUI=TIUI+1
"RTN","TIUR",137,0)
 S TIUSCRN=$L(TIUSCRN,";")
"RTN","TIUR",138,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIUR",139,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIUR",140,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIUR",141,0)
 D BUILD(TIUCLASS,.STATUS,.TIUSCRN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIUR",142,0)
 ; Reexpand previously expanded items:
"RTN","TIUR",143,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIUR",144,0)
 D BREATHE^TIUROR1(1)
"RTN","TIUR",145,0)
 Q
"RTN","TIUR1")
0^10^B14794635
"RTN","TIUR1",1,0)
TIUR1 ; SLC/JER - Integrated Document Review ;11/01/03
"RTN","TIUR1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**79,100,113,112**;Jun 20, 1997
"RTN","TIUR1",3,0)
 ; 11/30/00 moved PUTLIST & ADDELMNT here from TIUR. 
"RTN","TIUR1",4,0)
 ; 12/12/00 moved PUTLIST, ADDELMNT, PARENT, EXPANDKD to TIUR2
"RTN","TIUR1",5,0)
GATHER(TIUI,TIUPREF,CLASS,STATIFNS,EARLY,LATE,XREF,SCREEN) ; Find/sort
"RTN","TIUR1",6,0)
 ; Uses title info from ^TMP("TIUTYP",$J) array, set in SELTYP^TIULA
"RTN","TIUR1",7,0)
 N TIUT,TIUTP,TIUS,TIUSTAT,TIUSFLD,TIUD0,TIUD12,TIUD13,TIUD15
"RTN","TIUR1",8,0)
 N TIUIFN,TIULD
"RTN","TIUR1",9,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIUR1",10,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIUR1",11,0)
 S TIUT=0 F  S TIUT=$O(^TMP("TIUTYP",$J,TIUT)) Q:+TIUT'>0  D
"RTN","TIUR1",12,0)
 . S TIUTP=+$P($G(^TMP("TIUTYP",$J,TIUT)),U,2) Q:TIUTP'>0
"RTN","TIUR1",13,0)
 . S TIUS=1 F  S TIUSTAT=$P(STATIFNS,";",TIUS) Q:'TIUSTAT  D
"RTN","TIUR1",14,0)
 . . S TIUS=TIUS+1
"RTN","TIUR1",15,0)
 . . S (TIUJ,TIULD)=LATE
"RTN","TIUR1",16,0)
 . . F  S TIUJ=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ)) Q:+TIUJ'>0!(+TIUJ>EARLY)  D
"RTN","TIUR1",17,0)
 . . . S TIUIFN=0
"RTN","TIUR1",18,0)
 . . . F  S TIUIFN=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ,TIUIFN)) Q:+TIUIFN'>0  D
"RTN","TIUR1",19,0)
 . . . . I ($P(TIUPRM0,U,6)="S"),(+$$CANDO^TIULP(TIUIFN,"VIEW")'>0) Q
"RTN","TIUR1",20,0)
 . . . . I +$G(ORVP),(+$P($G(^TIU(8925,+TIUIFN,0)),U,2)'=+$G(ORVP)) Q
"RTN","TIUR1",21,0)
 . . . . I TIUTP=81,(^TMP("TIUTYP",$J)>1),($P(^TMP("TIUTYP",$J,TIUT),U,4)="NOT PICKED"),(+$P($G(^TIU(8925,+TIUIFN,0)),U,5)>6) Q
"RTN","TIUR1",22,0)
 . . . . I TIUTP=81,(^TMP("TIUTYP",$J)>1),($P(^TMP("TIUTYP",$J,TIUT),U,4)="NOT PICKED"),'+$$DADINTYP(TIUIFN) Q
"RTN","TIUR1",23,0)
 . . . . S TIUQ=$$RESOLVE(TIUIFN,TIUSFLD)
"RTN","TIUR1",24,0)
 . . . . ; S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN)="",TIULD=TIUJ ; P113
"RTN","TIUR1",25,0)
 . . . . ; TIUK=1: 1 search category chosen (SCREEN="")
"RTN","TIUR1",26,0)
 . . . . ; TIUK>1: 2+ search categories chosen (SCREEN=1)
"RTN","TIUR1",27,0)
 . . . . ; ALL my unsigned (SCREEN="ALL")
"RTN","TIUR1",28,0)
 . . . . I SCREEN=1!(SCREEN="ALL") S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN)=1
"RTN","TIUR1",29,0)
 . . . . E  D
"RTN","TIUR1",30,0)
 . . . . . I $D(^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN)),$G(^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN))=(SCREEN-1) S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN)=SCREEN
"RTN","TIUR1",31,0)
 . . . . S TIULD=TIUJ
"RTN","TIUR1",32,0)
 I +$G(TIUQUIK)=1,+$G(TIULD) D ADDSIGN(DUZ,CLASS,TIULD,TIUSFLD)
"RTN","TIUR1",33,0)
 Q
"RTN","TIUR1",34,0)
DADINTYP(TIUDA) ; addendum's parent belong? 12/1/00 Removed param TYPES
"RTN","TIUR1",35,0)
 N TIUI,TIUDTYP,TIUY S (TIUI,TIUY)=0
"RTN","TIUR1",36,0)
 S TIUDTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIUR1",37,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIUR1",38,0)
 . I +$P(^TMP("TIUTYP",$J,TIUI),U,2)=TIUDTYP S TIUY=1
"RTN","TIUR1",39,0)
 Q TIUY
"RTN","TIUR1",40,0)
RESOLVE(DA,DR) ; resolve sort field values
"RTN","TIUR1",41,0)
 N TIUD0,TIUD12,TIUD13,TIUD15,TIUY
"RTN","TIUR1",42,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIUR1",43,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIUR1",44,0)
 I DR=.01 S TIUY=$$PNAME^TIULC1(+TIUD0) G RESX
"RTN","TIUR1",45,0)
 I DR=.02 S TIUY=$$PTNAME^TIULC1(+$P(TIUD0,U,2)) G RESX
"RTN","TIUR1",46,0)
 I DR=.05 S TIUY=$P(TIUD0,U,5) G RESX
"RTN","TIUR1",47,0)
 I DR=1202 S TIUY=$$PERSNAME^TIULC1(+$P(TIUD12,U,2)) S:TIUY="UNKNOWN" TIUY="" G RESX
"RTN","TIUR1",48,0)
 I DR=1208 S TIUY=$$PERSNAME^TIULC1(+$P(TIUD12,U,8)) S:TIUY="UNKNOWN" TIUY="" G RESX
"RTN","TIUR1",49,0)
 I DR=1301 S TIUY=$P(TIUD13,U) G RESX
"RTN","TIUR1",50,0)
 ;I DR=1507,($P(TIUD0,U,5)=7),(+$P(TIUD15,U,7)'>0) S DR=1501
"RTN","TIUR1",51,0)
 I DR=1507,(($P(TIUD0,U,5)=7)!($P(TIUD0,U,5)=8)),(+$P(TIUD15,U,7)'>0) S DR=1501 ;TIU*1*100 amended notes were sorting at top w sortval=ZZZZEMPTY for sortfld=complete, even tho they had sign date and displayed it.
"RTN","TIUR1",52,0)
 I DR=1501 S TIUY=$P(TIUD15,U) G RESX
"RTN","TIUR1",53,0)
 I DR=1507 S TIUY=$P(TIUD15,U,7)
"RTN","TIUR1",54,0)
RESX I $G(TIUY)']"" S TIUY="ZZZZEMPTY"
"RTN","TIUR1",55,0)
 Q TIUY
"RTN","TIUR1",56,0)
 ;
"RTN","TIUR1",57,0)
ADDSIGN(USER,CLASS,DATE,SORTBY) ; Get documents for which the user is the additional signer
"RTN","TIUR1",58,0)
 N TIUI,TIUY S TIUI=0
"RTN","TIUR1",59,0)
 D NEEDSIG^TIULX(.TIUY,USER,CLASS)
"RTN","TIUR1",60,0)
 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUR1",61,0)
 . N TIUDA,TIUD13,TIUQ,TIUJ
"RTN","TIUR1",62,0)
 . S TIUDA=+$G(@TIUY@(TIUI)),TIUD13=$G(^TIU(8925,TIUDA,13))
"RTN","TIUR1",63,0)
 . S TIUQ=$$RESOLVE(TIUDA,SORTBY),TIUJ=9999999-+TIUD13
"RTN","TIUR1",64,0)
 . ; S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)="" ; P113
"RTN","TIUR1",65,0)
 . S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)=1
"RTN","TIUR1",66,0)
 K @TIUY
"RTN","TIUR1",67,0)
 Q
"RTN","TIURA2")
0^13^B33239814
"RTN","TIURA2",1,0)
TIURA2 ; SLC/JER - More review screen actions ;12/11/2001 10:15
"RTN","TIURA2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**88,58,100,123,112**;Jun 20, 1997
"RTN","TIURA2",3,0)
 ; 6/20/00: Moved DISPLAY, BROWSE, & BROWS1 from TIURA to TIURA2
"RTN","TIURA2",4,0)
DISPLAY ; Detailed Display
"RTN","TIURA2",5,0)
 N TIUDA,TIUD,TIUDATA,TIUI,Y,DIROUT,TIUQUIT,RSTRCTD
"RTN","TIURA2",6,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURA2",7,0)
 S TIUI=0
"RTN","TIURA2",8,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(TIUQUIT)
"RTN","TIURA2",9,0)
 . N TIUVIEW
"RTN","TIURA2",10,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA2",11,0)
 . D CLEAR^VALM1
"RTN","TIURA2",12,0)
 . W !!,"Reviewing #",+TIUDATA
"RTN","TIURA2",13,0)
 . S TIUDA=+$P(TIUDATA,U,2)
"RTN","TIURA2",14,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURA2",15,0)
 . I +TIUVIEW'>0 D  Q
"RTN","TIURA2",16,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIURA2",17,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",18,0)
 . . D RESTORE^VALM10(+TIUI)
"RTN","TIURA2",19,0)
 . S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURA2",20,0)
 . I RSTRCTD D  Q
"RTN","TIURA2",21,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURA2",22,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",23,0)
 . . D RESTORE^VALM10(+TIUI)
"RTN","TIURA2",24,0)
 . D EN^TIUAUDIT
"RTN","TIURA2",25,0)
 . I +$G(TIUQUIT) D FIXLSTNW^TIULM Q
"RTN","TIURA2",26,0)
 . I TIUI'=$P($G(TIUGLINK),U,2) D RESTORE^VALM10(+TIUI) ; See rtn TIURL
"RTN","TIURA2",27,0)
 K VALMY S VALMBCK="R"
"RTN","TIURA2",28,0)
 Q
"RTN","TIURA2",29,0)
BROWSE(TIULTMP) ; Browse selected documents
"RTN","TIURA2",30,0)
 ; TIULTMP is list template name
"RTN","TIURA2",31,0)
 N TIUDA,DFN,TIU,TIUCHNG,TIUDATA,TIUI,Y,DIROUT,TIUQUIT
"RTN","TIURA2",32,0)
 N TIUGDATA
"RTN","TIURA2",33,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURA2",34,0)
 S TIUI=0
"RTN","TIURA2",35,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(TIUQUIT)
"RTN","TIURA2",36,0)
 . N TIUVIEW,TIUGACT,RSTRCTD
"RTN","TIURA2",37,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA2",38,0)
 . S TIUDA=+$P(TIUDATA,U,2)
"RTN","TIURA2",39,0)
 . S TIUGDATA=$G(^TMP("TIUR",$J,"IDDATA",TIUDA)) ; ID note/entry
"RTN","TIURA2",40,0)
 . D CLEAR^VALM1
"RTN","TIURA2",41,0)
 . W !!,"Reviewing Item #",TIUI
"RTN","TIURA2",42,0)
 . S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURA2",43,0)
 . I RSTRCTD D  Q
"RTN","TIURA2",44,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURA2",45,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",46,0)
 . D BROWS1(TIULTMP,TIUDA,TIUGDATA)
"RTN","TIURA2",47,0)
 ; -- Update or Rebuild list: --
"RTN","TIURA2",48,0)
 I $G(TIUCHNG("DELETE"))!$G(TIUCHNG("ADDM")) S TIUCHNG("RBLD")=1
"RTN","TIURA2",49,0)
 S TIUCHNG("UPDATE")=1 ; default
"RTN","TIURA2",50,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURA2",51,0)
 S VALMBCK="R"
"RTN","TIURA2",52,0)
 Q
"RTN","TIURA2",53,0)
GETSORT(PRMSORT,EXPSORT) ; Get order for ID entries
"RTN","TIURA2",54,0)
 Q $S($G(EXPSORT)'="":EXPSORT,1:PRMSORT)
"RTN","TIURA2",55,0)
 ;
"RTN","TIURA2",56,0)
BROWS1(TIULTMP,TIUDA,TIUGDATA) ; Browse single document
"RTN","TIURA2",57,0)
 ;  Calls EN^VALM
"RTN","TIURA2",58,0)
 N %DT,C,D0,DIQ2,FINISH,TIU,TIUVIEW
"RTN","TIURA2",59,0)
 I '$D(TIUGDATA) S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIURA2",60,0)
 I TIULTMP="TIU COMPLETE NOTES",$P(TIUGDATA,U,2) W !!,"You are completing the PARENT ENTRY of this interdisciplinary note."
"RTN","TIURA2",61,0)
 I '$P(TIUGDATA,U,2) D  Q:+TIUVIEW'>0  ;TIU*1*123
"RTN","TIURA2",62,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURA2",63,0)
 . I +TIUVIEW'>0 D
"RTN","TIURA2",64,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIURA2",65,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",66,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIURA2",67,0)
 D EN^VALM(TIULTMP)
"RTN","TIURA2",68,0)
 K ^TMP("TIUVIEW",$J)
"RTN","TIURA2",69,0)
 Q
"RTN","TIURA2",70,0)
 ;
"RTN","TIURA2",71,0)
EXPAND ; Expand/Collapse ID notes, Addenda in lists
"RTN","TIURA2",72,0)
 N TIUDNM,TIULNM,TIUSTAT
"RTN","TIURA2",73,0)
 D:'$D(VALMY) EN^VALM2(XQORNOD(0))
"RTN","TIURA2",74,0)
 I $D(VALMY) D EC^TIURECL(.VALMY)
"RTN","TIURA2",75,0)
 W !,"Refreshing the list."
"RTN","TIURA2",76,0)
 K VALMY
"RTN","TIURA2",77,0)
 S VALMCNT=+$G(@VALMAR@(0))
"RTN","TIURA2",78,0)
 S VALMBCK="R"
"RTN","TIURA2",79,0)
 Q
"RTN","TIURA2",80,0)
 ;
"RTN","TIURA2",81,0)
PRNTSCRN(VALMY) ; Evaluate whether a record may be printed
"RTN","TIURA2",82,0)
 N TIUI S TIUI=""
"RTN","TIURA2",83,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURA2",84,0)
 . N TIUPMTHD,TIUDTYP,TIUPFHDR,TIUPFNBR,TIUPGRP,TIUPRINT,TIUFLAG,RSTRCTD
"RTN","TIURA2",85,0)
 . S RSTRCTD=0,TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA2",86,0)
 . S TIUDA=+$P(TIUDATA,U,2),TIUTYP=$P(^TIU(8925,TIUDA,0),U)
"RTN","TIURA2",87,0)
 . ; Evaluate whether user can print record
"RTN","TIURA2",88,0)
 . S TIUPRINT=$$CANDO^TIULP(TIUDA,"PRINT RECORD")
"RTN","TIURA2",89,0)
 . I +TIUPRINT'>0 D  Q
"RTN","TIURA2",90,0)
 . . W !!,"Item #",TIUI,": ",!,$P(TIUPRINT,U,2),!
"RTN","TIURA2",91,0)
 . . K VALMY(TIUI)
"RTN","TIURA2",92,0)
 . . I $$READ^TIUU("EA","RETURN to continue...")
"RTN","TIURA2",93,0)
 . ;-- Add Check for restricted record when available --
"RTN","TIURA2",94,0)
 . S DFN=+$P(^TIU(8925,TIUDA,0),U,2)
"RTN","TIURA2",95,0)
 . S RSTRCTD=$$PTRES^TIULRR(DFN)
"RTN","TIURA2",96,0)
 . I +RSTRCTD D  Q
"RTN","TIURA2",97,0)
 . . W !!,"Item #",TIUI," Removed from print list.",!
"RTN","TIURA2",98,0)
 . . K VALMY(TIUI)
"RTN","TIURA2",99,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIURA2",100,0)
 . I +$G(TIUPFLG) S TIUFLAG=+$$CHARTONE^TIURA1(TIUDA)
"RTN","TIURA2",101,0)
 Q
"RTN","TIURA2",102,0)
DICTATED        ; Mark Document(s) "dictated"
"RTN","TIURA2",103,0)
 N TIUCHNG,TIUI,TIUY,Y,DIROUT
"RTN","TIURA2",104,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURA2",105,0)
 S TIUI=0
"RTN","TIURA2",106,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURA2",107,0)
 . N TIU,DFN,TIUDA,TIUDATA,RSTRCTD
"RTN","TIURA2",108,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA2",109,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURA2",110,0)
 . I RSTRCTD D  Q
"RTN","TIURA2",111,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURA2",112,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",113,0)
 . D EN^VALM("TIU DOCUMENT DICTATED")
"RTN","TIURA2",114,0)
 ; -- Update or Rebuild list: --
"RTN","TIURA2",115,0)
 S TIUCHNG("UPDATE")=1
"RTN","TIURA2",116,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURA2",117,0)
 S VALMBCK="R"
"RTN","TIURA2",118,0)
 Q
"RTN","TIURA2",119,0)
DICTATE1(TIUDA) ; Single record sign on chart
"RTN","TIURA2",120,0)
 N DICMSG D FULL^VALM1
"RTN","TIURA2",121,0)
 D DICT(TIUDA,.DICMSG)
"RTN","TIURA2",122,0)
 W !!,$G(DICMSG(1)),!,$G(DICMSG(2)),! H $S($D(DICMSG(0)):+DICMSG(0),1:3)
"RTN","TIURA2",123,0)
 Q
"RTN","TIURA2",124,0)
DICT(DA,MSG) ; Mark signed on chart. Edit on-chart signatures.
"RTN","TIURA2",125,0)
 N AUTHOR,DIE,DR,Y,TIUSTAT,EXPCSNR,ATTNDNG,TIUDA,TIUPRMT,TIU0,TIU12,TIU13
"RTN","TIURA2",126,0)
 S TIU0=$G(^TIU(8925,+DA,0)),TIU12=$G(^(12)),TIU13=$G(^(13))
"RTN","TIURA2",127,0)
 S TIUSTAT=$P(TIU0,U,5)
"RTN","TIURA2",128,0)
 S TIUPRMT=$S(TIUSTAT>1:"Edit Dictation Data? ",1:"Has this document been dictated? ")
"RTN","TIURA2",129,0)
 W ! S MSG=$$READ^TIUU("YAO",TIUPRMT,"NO") W !
"RTN","TIURA2",130,0)
 I 'MSG S TIUCHNG=0 G DICTX
"RTN","TIURA2",131,0)
 S TIUCHNG=1
"RTN","TIURA2",132,0)
 S AUTHOR=$$PERSNAME^TIULC1(+$P(TIU12,U,2))
"RTN","TIURA2",133,0)
 S EXPCSNR=$$PERSNAME^TIULC1(+$P(TIU12,U,8))
"RTN","TIURA2",134,0)
 S:+$P(TIU12,U,9) ATTNDNG=$$PERSNAME^TIULC1(+$P(TIU12,U,9))
"RTN","TIURA2",135,0)
 S DR="1202//^S X=AUTHOR;1307//^S X=$S(+$P(TIU13,U,7)'>0:""NOW"",1:$$DATE^TIULS(+$P(TIU13,U,7),""MM/DD/CCYY@HR:MIN:SEC""))"
"RTN","TIURA2",136,0)
 I $D(ATTNDNG) S DR=DR_";1209//^S X=ATTNDNG"
"RTN","TIURA2",137,0)
 E  I $D(EXPCSNR) S DR=DR_";1208//^S X=EXPCSNR"
"RTN","TIURA2",138,0)
 S DR=DR_";1204////^S X=$$WHOSIGNS^TIULC1(DA);1208////^S X=$$WHOCOSIG^TIULC1(DA)"
"RTN","TIURA2",139,0)
 S DIE=8925 D ^DIE
"RTN","TIURA2",140,0)
 S TIU0=$G(^TIU(8925,+DA,0)),TIU12=$G(^(12)),TIU13=$G(^(13))
"RTN","TIURA2",141,0)
 ;Toggle status between undictated and untranscribed, depending on Dict Date
"RTN","TIURA2",142,0)
 S DR=".05///^S X=$S(+$P(TIU13,U,7):""UNTRANSCRIBED"",1:""UNDICTATED"")",DIE=8925 D ^DIE
"RTN","TIURA2",143,0)
 D UPDTIRT^TIUDIRT(.TIU,+DA)
"RTN","TIURA2",144,0)
DICTX S MSG(1)="  Dictation data "_$S(TIUCHNG:"",1:"NOT ")_"changed."
"RTN","TIURA2",145,0)
 Q
"RTN","TIURB2")
0^28^B35815970
"RTN","TIURB2",1,0)
TIURB2 ; SLC/JER,AJB - More Review Screen Actions ; 02/03/2004
"RTN","TIURB2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,109,154,112**;Jun 20, 1997
"RTN","TIURB2",3,0)
 ; 2/3: Update TEXTEDIT from TIUEDIT to TIUEDI4
"RTN","TIURB2",4,0)
 ; 9/28 Moved DELETE, DEL, DELTEXT, DIK to new rtn TIURB2
"RTN","TIURB2",5,0)
 ; 8/2/02 DELTEXT logic to bypass user-response if called by GUI TIU*1*154
"RTN","TIURB2",6,0)
 ;        GODEL+12, changed direct access of DPT global to FM
"RTN","TIURB2",7,0)
 Q
"RTN","TIURB2",8,0)
DELETE ; Delete action
"RTN","TIURB2",9,0)
 N TIUI,TIUY,TIUCHNG,Y,DIROUT,DTOUT,DUOUT
"RTN","TIURB2",10,0)
 N TIULNO,TIUJ,PRNTDA,LSTDA
"RTN","TIURB2",11,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURB2",12,0)
 S TIUI=0
"RTN","TIURB2",13,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURB2",14,0)
 . N TIUDATA,DA,RSTRCTD
"RTN","TIURB2",15,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURB2",16,0)
 . S DA=+$P(TIUDATA,U,2)
"RTN","TIURB2",17,0)
 . W !!,"Processing Item #",TIUI
"RTN","TIURB2",18,0)
 . L +^TIU(8925,+DA):1
"RTN","TIURB2",19,0)
 . E  D  Q
"RTN","TIURB2",20,0)
 . . W !?5,$C(7),"Another user is editing this entry."
"RTN","TIURB2",21,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURB2",22,0)
 . . D PICK^TIULM(TIUI)
"RTN","TIURB2",23,0)
 . S RSTRCTD=$$DOCRES^TIULRR(DA)
"RTN","TIURB2",24,0)
 . I RSTRCTD D  Q
"RTN","TIURB2",25,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURB2",26,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURB2",27,0)
 . D DEL(DA)
"RTN","TIURB2",28,0)
 . L -^TIU(8925,+DA)
"RTN","TIURB2",29,0)
 ; -- Update or Rebuild list, restore video:
"RTN","TIURB2",30,0)
 S TIUCHNG("RBLD")=1
"RTN","TIURB2",31,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURB2",32,0)
 S VALMBCK="R"
"RTN","TIURB2",33,0)
 Q
"RTN","TIURB2",34,0)
DEL(DA) ; We don't hand out pencils, without erasers
"RTN","TIURB2",35,0)
GODEL ; -- Called from DEL^TIURB
"RTN","TIURB2",36,0)
 N CANDEL,TIUDA,TIUD0,TIUI,TIUDFLT,TIUPT,TIUVDT,TIUTYP,PROMPT,TIUAUDIT
"RTN","TIURB2",37,0)
 N TIUMSG,TIURSN,TIUVTYP,TIUABORT,ADDMPRNT,IDPRNT,TIUAUTH,TIUD12,STATUS
"RTN","TIURB2",38,0)
 L +^TIU(8925,+DA):1
"RTN","TIURB2",39,0)
 E  D  Q
"RTN","TIURB2",40,0)
 . W !?5,$C(7),"Another user is editing this entry."
"RTN","TIURB2",41,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURB2",42,0)
 I +$$HASIMG(DA) D IMGNOTE Q
"RTN","TIURB2",43,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^(12))
"RTN","TIURB2",44,0)
 S TIUTYP=$$UP^XLFSTR($$PNAME^TIULC1(+TIUD0)),TIUAUTH=$P(TIUD12,U,2)
"RTN","TIURB2",45,0)
 S STATUS=$P(TIUD0,U,5),ADDMPRNT=+$P(TIUD0,U,6)
"RTN","TIURB2",46,0)
 S IDPRNT=+$P($G(^TMP("TIUR",$J,"IDDATA",DA)),U,3)
"RTN","TIURB2",47,0)
 S TIUPT=$$NAME^TIULS($P($G(^DPT(+$P(TIUD0,U,2),0)),U),"FIRST LAST")
"RTN","TIURB2",48,0)
 S TIUVDT=+$P(TIUD0,U,7)
"RTN","TIURB2",49,0)
 S TIUVDT=$$DATE^TIULS(TIUVDT,"MM/DD/YY"_$S($L(TIUVDT,".")=2:" HR:MIN",1:""))
"RTN","TIURB2",50,0)
 S TIUVTYP=$S(+$$ISDS^TIULX(+TIUD0):" Admission",1:" Visit")
"RTN","TIURB2",51,0)
 S TIUMSG="DELETING "_TIUTYP_" For "_TIUPT_"'s "_TIUVDT_TIUVTYP_"."
"RTN","TIURB2",52,0)
 S CANDEL=$$CANDO^TIULP(DA,"DELETE RECORD")
"RTN","TIURB2",53,0)
 I 'CANDEL W !!,$C(7),$C(7),$C(7),$P(CANDEL,U,2),! H 2 G DELX
"RTN","TIURB2",54,0)
 I $$HASIDKID^TIUGBR(DA) W !!,"This interdisciplinary parent cannot be deleted; it's entries must first",!,"be detached.",! H 3 G DELX
"RTN","TIURB2",55,0)
 I $O(^TIU(8925,"DAD",+DA,0))>0,$$HASADDEN^TIULC1(DA) D
"RTN","TIURB2",56,0)
 . W !!,"This "_TIUTYP_" has ADDENDA."
"RTN","TIURB2",57,0)
 W !,$C(7) F TIUI=1:1:$L(TIUMSG,"|") W !,$P(TIUMSG,"|",TIUI)
"RTN","TIURB2",58,0)
 W ! S PROMPT="Are you SURE you want to DELETE"
"RTN","TIURB2",59,0)
 I '$$READ^TIUU("YO",PROMPT,"NO") W !,"Nothing DELETED.",! H 2 S TIUCHNG=0 G DELX
"RTN","TIURB2",60,0)
 S PROMPT="DELETE the TEXT ONLY, leaving audit trail information"
"RTN","TIURB2",61,0)
 S TIUDA=DA
"RTN","TIURB2",62,0)
 I STATUS'>5,$S(DUZ=TIUAUTH:1,+$$ISA^USRLM(DUZ,"MEDICAL INFORMATION SECTION")'>0:1,1:0) S TIUAUDIT=0 I 1
"RTN","TIURB2",63,0)
 E  D  G:$D(TIUABORT) DELX
"RTN","TIURB2",64,0)
 . I +$P($G(^TIU(8925,+TIUDA,0)),U,5)'<6 S TIUAUDIT=1
"RTN","TIURB2",65,0)
 . E  D
"RTN","TIURB2",66,0)
 . . S TIUAUDIT=+$$READ^TIUU("YO",PROMPT,"NO")
"RTN","TIURB2",67,0)
 . . I $D(DTOUT)!($D(DUOUT)) D
"RTN","TIURB2",68,0)
 . . . W !,"Nothing DELETED.",!
"RTN","TIURB2",69,0)
 . . . S TIUCHNG=0,TIUABORT=1
"RTN","TIURB2",70,0)
 . . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURB2",71,0)
 K ^TIU(8925,"ASAVE",DUZ,TIUDA) ; Remove SAVE-flag
"RTN","TIURB2",72,0)
 I +TIUAUDIT'>0 D  G DELX
"RTN","TIURB2",73,0)
 . W !,"DELETING Entire "_TIUTYP_" record.",!
"RTN","TIURB2",74,0)
 . D DELIRT^TIUDIRT(TIUDA),DIK(TIUDA) H 2
"RTN","TIURB2",75,0)
 . S TIUCHNG=2,TIUCHNG("DELETE")=1
"RTN","TIURB2",76,0)
 . D ALERTDEL^TIUALRT(TIUDA),DELSGNR^TIURB1(TIUDA)
"RTN","TIURB2",77,0)
 S PROMPT="Reason for DELETION (Privacy Act or Administrative): "
"RTN","TIURB2",78,0)
 S TIURSN=$P($$READ^TIUU("SA^P:privacy act;A:administrative",PROMPT,"PRIVACY ACT"),U)
"RTN","TIURB2",79,0)
 I '$L(TIURSN) D  G DELX
"RTN","TIURB2",80,0)
 . W !,"Nothing DELETED.",!
"RTN","TIURB2",81,0)
 . S TIUCHNG=0,TIUABORT=1
"RTN","TIURB2",82,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURB2",83,0)
 D ALERTDEL^TIUALRT(TIUDA),DELSGNR^TIURB1(TIUDA)
"RTN","TIURB2",84,0)
 D DELTEXT(TIUDA,TIURSN),AUDEL^TIURB1(TIUDA,TIURSN) S TIUCHNG=1
"RTN","TIURB2",85,0)
DELX L -^TIU(8925,+DA)
"RTN","TIURB2",86,0)
 Q
"RTN","TIURB2",87,0)
DELTEXT(DA,TIURSN) ; After signature, only retraction possible
"RTN","TIURB2",88,0)
 N DR,DIE,TIUDA,TIUY I '$D(ZTQUEUED) D FULL^VALM1
"RTN","TIURB2",89,0)
 S TIUDA=DA
"RTN","TIURB2",90,0)
 W !!?5,$C(7),"***********************************************************************"
"RTN","TIURB2",91,0)
 W !?5,"*  This document will now be RETRACTED. As such, it has been removed  *"
"RTN","TIURB2",92,0)
 W !?5,"*    from public view, and from typical Releases of Information,      *"
"RTN","TIURB2",93,0)
 W !?5,"*          but will remain indefinitely discoverable to HIMS.         *"
"RTN","TIURB2",94,0)
 W !?5,"***********************************************************************",!
"RTN","TIURB2",95,0)
 S DIE=8925
"RTN","TIURB2",96,0)
 S DR="1610////^S X=+DUZ;1611////^S X=+$$NOW^XLFDT;1612////^S X=TIURSN"
"RTN","TIURB2",97,0)
 D ^DIE
"RTN","TIURB2",98,0)
 S DA=$$RETRACT^TIURD2(DA,"",14)
"RTN","TIURB2",99,0)
 ; Roll back SURGICAL REPORT TITLES when TIU changes require it ; TIU*1*112
"RTN","TIURB2",100,0)
 D ISSURG^TIUSROI(.TIUY,+$G(^TIU(8925,TIUDA,0))) I +TIUY D RETRACT^TIUSROI1(TIUDA)
"RTN","TIURB2",101,0)
 I '$$BROKER^XWBLIB D
"RTN","TIURB2",102,0)
 . I '$D(ZTQUEUED),$$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIURB2",103,0)
 Q
"RTN","TIURB2",104,0)
DIK(DA,SUPPACT) ; Call ^DIK to delete the record
"RTN","TIURB2",105,0)
 ; [SUPPACT] = Boolean to suppress delete action
"RTN","TIURB2",106,0)
 N DIK,TIUTYP,TIUTYPE,TIUDA,TIUVSIT,TIUVKILL,TIUDELX S TIUDA=0
"RTN","TIURB2",107,0)
 F  S TIUDA=+$O(^TIU(8925,"DAD",+DA,TIUDA)) Q:+TIUDA'>0  D DIK(TIUDA)
"RTN","TIURB2",108,0)
 S TIUTYPE=+$G(^TIU(8925,+DA,0)),SUPPACT=+$G(SUPPACT)
"RTN","TIURB2",109,0)
 S TIUTYP=$P($G(^TIU(8925.1,TIUTYPE,0)),U)
"RTN","TIURB2",110,0)
 S TIUVSIT=+$P($G(^TIU(8925,DA,0)),U,3),TIUDA=DA
"RTN","TIURB2",111,0)
 S TIUDELX=$$DELETE^TIULC1(TIUTYPE)
"RTN","TIURB2",112,0)
 I TIUDELX]"",'SUPPACT X TIUDELX
"RTN","TIURB2",113,0)
 S DIK="^TIU(8925,"
"RTN","TIURB2",114,0)
 D ^DIK ; W:'$D(ZTQUEUED) "."
"RTN","TIURB2",115,0)
 D DELAUDIT^TIUEDI1(DA)
"RTN","TIURB2",116,0)
 D DELPROB^TIURB1(DA)
"RTN","TIURB2",117,0)
 D DELSGNR^TIURB1(DA)
"RTN","TIURB2",118,0)
 D DELIMG(DA)
"RTN","TIURB2",119,0)
 D ALERTDEL^TIUALRT(DA)
"RTN","TIURB2",120,0)
 ; **52** Disable call to $$DELVFILE^PXAPI 'til further notice
"RTN","TIURB2",121,0)
 ; I +TIUVSIT,$D(^AUPNVSIT(+TIUVSIT)) S TIUVKILL=$$DELVFILE^PXAPI("ALL",TIUVSIT,"","TEXT INTEGRATION UTILITIES")
"RTN","TIURB2",122,0)
 Q
"RTN","TIURB2",123,0)
HASIMG(TIUDA) ; Evaluate whether images are linked
"RTN","TIURB2",124,0)
 Q +$O(^TIU(8925.91,"B",TIUDA,0))
"RTN","TIURB2",125,0)
IMGNOTE ; Present Notice of Linked Images
"RTN","TIURB2",126,0)
 D FULL^VALM1
"RTN","TIURB2",127,0)
 W !!?5,$C(7),"***********************************************************************"
"RTN","TIURB2",128,0)
 W !?5,"* This document has linked images. You must ""delete"" the Images using *"
"RTN","TIURB2",129,0)
 W !?5,"*        the Imaging Package before proceeding with this action.      *"
"RTN","TIURB2",130,0)
 W !?5,"*      The images will be hidden from public view, but will remain    *"
"RTN","TIURB2",131,0)
 W !?5,"*                   indefinitely discoverable to HIMS.                *"
"RTN","TIURB2",132,0)
 W !?5,"***********************************************************************",!
"RTN","TIURB2",133,0)
 I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURB2",134,0)
 Q
"RTN","TIURB2",135,0)
DELIMG(TIUDA) ; Remove linked images, when document deleted
"RTN","TIURB2",136,0)
 N DA,DIK S DIK="^TIU(8925.91,",DA=0
"RTN","TIURB2",137,0)
 F  S DA=$O(^TIU(8925.91,"B",TIUDA,DA)) Q:+DA'>0  D ^DIK
"RTN","TIURB2",138,0)
 Q
"RTN","TIURD2")
0^7^B70952985
"RTN","TIURD2",1,0)
TIURD2 ; SLC/JER - Reassignment following signature ;11/01/03
"RTN","TIURD2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**61,100,109,113,112**;Jun 20, 1997
"RTN","TIURD2",3,0)
RETRACT(TIUDA,TIUDAD,COPYSTAT,NEWDAD,SKIPADD) ; Retract document
"RTN","TIURD2",4,0)
 N TIUOD0,TIUOD12,TIUOD13,TIUOD14,TIUOD15,TIUOD16,TIUOD17,TIUI,TIUPAT
"RTN","TIURD2",5,0)
 N TIUDPRM,TIUCOPY,TIUVSUPP,DUOUT,DIROUT,DTOUT,DA,DR,DFN,TIU,TIULMETH
"RTN","TIURD2",6,0)
 N TIUTYP,TIUVMETH,TIUPATNM,TIUNREC,DFN,TIUNDAD,TIUTNM,ONRTRCT
"RTN","TIURD2",7,0)
 S TIUOD0=$G(^TIU(8925,+TIUDA,0)),TIUOD12=$G(^(12)),TIUOD13=$G(^(13))
"RTN","TIURD2",8,0)
 S TIUOD14=$G(^TIU(8925,+TIUDA,14)),TIUOD15=$G(^(15)),TIUOD16=$G(^(16))
"RTN","TIURD2",9,0)
 S TIUOD17=$G(^TIU(8925,+TIUDA,17))
"RTN","TIURD2",10,0)
 S TIUTYP=+TIUOD0,^TMP("TIURTRCT",$J,TIUDA,0)=TIUOD0,COPYSTAT=$G(COPYSTAT,5)
"RTN","TIURD2",11,0)
 I $S(+COPYSTAT=14:1,+COPYSTAT=15:1,1:0) D STATUS(TIUDA) G RTADD
"RTN","TIURD2",12,0)
 I +$P(TIUOD0,U,5)'>5 D:+$G(NEWDAD) LINKADD(TIUDA,NEWDAD) G RETRAX
"RTN","TIURD2",13,0)
 I +COPYSTAT'<7,+$G(NEWDAD) D LINKADD(TIUDA,NEWDAD) G RETRAX
"RTN","TIURD2",14,0)
 D FULL^VALM1
"RTN","TIURD2",15,0)
 ; --- Initialize document parameters ---
"RTN","TIURD2",16,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM,TIUDA)
"RTN","TIURD2",17,0)
 S TIUTNM=$$PNAME^TIULC1(+TIUTYP)
"RTN","TIURD2",18,0)
 ; --- Identify the patient ---
"RTN","TIURD2",19,0)
 S DFN=+$P(TIUOD0,U,2)
"RTN","TIURD2",20,0)
 I +DFN'>0 D  G RETRAX
"RTN","TIURD2",21,0)
 . W !,$C(7),"No patient selected..."
"RTN","TIURD2",22,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W !
"RTN","TIURD2",23,0)
 S TIUPATNM=$$PTNAME^TIULC1(DFN)
"RTN","TIURD2",24,0)
 ; --- Get visit info ---
"RTN","TIURD2",25,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIURD2",26,0)
 I '$D(TIU("VSTR")) W !,$C(7),"Patient & Visit required." H 2 G RETRAX
"RTN","TIURD2",27,0)
 I $D(TIU) D
"RTN","TIURD2",28,0)
 . N TIUNEW,TIUITEM,DA,DR,DIE
"RTN","TIURD2",29,0)
 . S DA=$$GETREC^TIUSRVP(DFN,.TIU,TIUTYP,.TIUNEW) Q:+DA'>0
"RTN","TIURD2",30,0)
 . I '+$G(TIUNEW) D  Q
"RTN","TIURD2",31,0)
 . . W !!,$C(7),"A ",TIUTNM," already exists for this visit."
"RTN","TIURD2",32,0)
 . . W !,"You may not use the reassign function to overwrite an existing ",!,$$UPPER^TIULS($$STATUS^TIULC(DA))," ",TIUTNM,".",!
"RTN","TIURD2",33,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD2",34,0)
 . D REMVSIT(TIUDA,TIUOD0)
"RTN","TIURD2",35,0)
 . D COPY0(DA,TIUOD0,.TIU,$G(TIUDAD),COPYSTAT),COPY12(DA,TIUOD12,.TIU)
"RTN","TIURD2",36,0)
 . D COPY13(DA,TIUOD13,.TIU,COPYSTAT),COPY14(DA,TIUOD14,.TIU)
"RTN","TIURD2",37,0)
 . D COPYSGNR(TIUDA,DA,COPYSTAT)
"RTN","TIURD2",38,0)
 . I COPYSTAT>5 D COPY15(DA,TIUOD15)
"RTN","TIURD2",39,0)
 . I COPYSTAT>6,$L(TIUOD16) S ^TIU(8925,+DA,16)=TIUOD16
"RTN","TIURD2",40,0)
 . I +$$REQCOSIG^TIULP(+TIUTYP,TIUDA,+$P(TIUOD12,U,4)),(COPYSTAT<6) D
"RTN","TIURD2",41,0)
 . . N DIE,DR S DIE=8925
"RTN","TIURD2",42,0)
 . . S DR="1506////1" D ^DIE
"RTN","TIURD2",43,0)
 . D COPY17^TIURC1(DA,TIUOD17),COPYTEXT^TIURC1(TIUDA,DA)
"RTN","TIURD2",44,0)
 . I $D(^TIU(8925,DA,"TEMP")) D MERGTEXT^TIUEDI1(DA,.TIU) K ^TIU(8925,+DA,"TEMP")
"RTN","TIURD2",45,0)
 . S DR=".05///"_$$UPPER^TIULS($$STATUS^TIULC(DA))_";.1////^S X=$$LINECNT^TIULC(DA);1406////"_TIUDA
"RTN","TIURD2",46,0)
 . S DIE=8925 D ^DIE
"RTN","TIURD2",47,0)
 . D AUDIT^TIUEDI1(DA,0,$$CHKSUM^TIULC("^TIU(8925,"_+DA_",""TEXT"")"))
"RTN","TIURD2",48,0)
 . S ^TMP("TIURTRCT",$J,"NEW",DA)=""
"RTN","TIURD2",49,0)
 . S:'+$G(TIUDAD) TIUNDAD=DA
"RTN","TIURD2",50,0)
 . S TIUNREC=$G(TIUNREC)_$S(+$G(TIUNREC):",",1:"")_DA
"RTN","TIURD2",51,0)
 . D STATUS(TIUDA)
"RTN","TIURD2",52,0)
 S ONRTRCT=$$ONRTRCT^TIULC1(+$G(^TIU(8925,TIUDA,0)))
"RTN","TIURD2",53,0)
 I ONRTRCT]"" X ONRTRCT
"RTN","TIURD2",54,0)
 ; If SKIPADD is TRUE, bypass retraction of addenda...
"RTN","TIURD2",55,0)
 I +$G(SKIPADD) G RETRAX
"RTN","TIURD2",56,0)
RTADD ; Retract all addenda
"RTN","TIURD2",57,0)
 N TIUDADD S TIUDADD=0
"RTN","TIURD2",58,0)
 F  S TIUDADD=$O(^TIU(8925,"DAD",TIUDA,TIUDADD)) Q:+TIUDADD'>0  D
"RTN","TIURD2",59,0)
 . I '$$ISADDNDM^TIULC1(TIUDADD) Q
"RTN","TIURD2",60,0)
 . D ADDENDEL^TIUALRT(TIUDADD)
"RTN","TIURD2",61,0)
 . S TIUNREC=$G(TIUNREC)_$S(+$G(TIUNREC):",",1:"")_$$RETRACT(TIUDADD,TIUDA,$G(COPYSTAT),$G(TIUNDAD))
"RTN","TIURD2",62,0)
RETRAX Q +$G(TIUNREC)
"RTN","TIURD2",63,0)
REMVSIT(DA,TIUOD0) ; Remove VISIT from Retracted Doc
"RTN","TIURD2",64,0)
 N DIE,DR,SVCAT,TIUPOP S TIUPOP=0
"RTN","TIURD2",65,0)
 S SVCAT=$P(TIUOD0,U,13)
"RTN","TIURD2",66,0)
 I +$$ISADDNDM^TIULC1(DA) D  Q:+TIUPOP
"RTN","TIURD2",67,0)
 . I +$P($G(^TIU(8925,+$P(TIUOD0,U,6),0)),U,3)>0 S TIUPOP=1 Q
"RTN","TIURD2",68,0)
 . S:SVCAT="" SVCAT=$P($G(^TIU(8925,+$P(TIUOD0,U,6),0)),U,13)
"RTN","TIURD2",69,0)
 I SVCAT="H" Q
"RTN","TIURD2",70,0)
 W !,"Removing RETRACTED ",TIUTNM," from original Visit..."
"RTN","TIURD2",71,0)
 S DIE=8925,DR=".03///@" D ^DIE
"RTN","TIURD2",72,0)
 Q
"RTN","TIURD2",73,0)
LINKADD(DA,TIUDAD) ; Link addendum (DA) to TIUDAD
"RTN","TIURD2",74,0)
 N DR,DIE
"RTN","TIURD2",75,0)
 S DIE=8925,DR=".06////^S X=TIUDAD" D ^DIE
"RTN","TIURD2",76,0)
 Q
"RTN","TIURD2",77,0)
COPY0(DA,TIUD0,TIU,TIUDAD,STATUS) ; Copy root node
"RTN","TIURD2",78,0)
 N DR,DIE S DIE=8925,STATUS=$G(STATUS,5)
"RTN","TIURD2",79,0)
 S DR=".02////"_DFN_";.03////"_$P(TIUD0,U,3)_";.04////"_$P(TIUD0,U,4)_";.05////"_STATUS_";.06////"_$P(TIUD0,U,6)_";.07////"_$P(TIUD0,U,7)_";.08////"_$P(TIUD0,U,8)_";.09////"_$P(TIUD0,U,9)_";.12////"_$P(TIUD0,U,12)_";.13////"_$P(TIUD0,U,13)
"RTN","TIURD2",80,0)
 I $P($G(TIUDPRM(0)),U,16),'$P($G(^TIU(8925,+DA,0)),U,11),$$WORKOK^TIUPXAP1(+DA) S DR=DR_";.11////1" ;set flag to collect workload
"RTN","TIURD2",81,0)
 D ^DIE
"RTN","TIURD2",82,0)
 Q
"RTN","TIURD2",83,0)
COPY12(DA,TIUD12,TIU) ; Copy 12-node
"RTN","TIURD2",84,0)
 N DR,DIE S DIE=8925
"RTN","TIURD2",85,0)
 S DR="1201////"_+$$NOW^XLFDT_";1202////"_+$P(TIUD12,U,2)_";1203////"_$P(TIUD12,U,3)_";1204////"_$P(TIUD12,U,4)_";1205////"_$P(TIUD12,U,5)
"RTN","TIURD2",86,0)
 S DR=DR_";1206////"_$P(TIUD12,U,6)_";1207////"_$P(TIUD12,U,7)_";1208////"_$P(TIUD12,U,8)_";1209////"_$P(TIUD12,U,9)
"RTN","TIURD2",87,0)
 S DR=DR_";1210////"_$P(TIUD12,U,10)_";1211////"_$P(TIUD12,U,11)_";1212////"_$P(TIUD12,U,12)
"RTN","TIURD2",88,0)
 D ^DIE
"RTN","TIURD2",89,0)
 Q
"RTN","TIURD2",90,0)
COPY13(DA,TIUD13,TIU,STATUS) ; Copy 13-node
"RTN","TIURD2",91,0)
 N DR,DIE,TIUDT,TIURDT S DIE=8925,TIUDT=$P(TIUD13,U)
"RTN","TIURD2",92,0)
 S TIURDT=$S(+$$ISDS^TIULX(+$G(^TIU(8925,DA,0))):+$$REFDATE^TIULC1(.TIU,TIUDT),1:TIUDT)
"RTN","TIURD2",93,0)
 S:'TIURDT TIURDT=TIUDT
"RTN","TIURD2",94,0)
 S DR="1301////"_TIURDT_";1302////"_$P(TIUD13,U,2)_";1303////O"
"RTN","TIURD2",95,0)
 S DR=DR_";1304////"_$S(STATUS<4:"@",1:TIUDT)
"RTN","TIURD2",96,0)
 S DR=DR_";1305////"_$S(STATUS<5:"@",1:TIUDT)
"RTN","TIURD2",97,0)
 S DR=DR_";1306////"_$S(STATUS<5:"@",+$P(TIUD13,U,6):$P(TIUD13,U,6),1:DUZ)
"RTN","TIURD2",98,0)
 S DR=DR_";1307////"_$P(TIUD13,U,7)
"RTN","TIURD2",99,0)
 D ^DIE
"RTN","TIURD2",100,0)
 Q
"RTN","TIURD2",101,0)
COPY14(DA,TIUD14,TIU) ; Copy 14-node
"RTN","TIURD2",102,0)
 N DR,DIE S DIE=8925
"RTN","TIURD2",103,0)
 S DR="1401////"_$P(TIUD14,U)_";1402////"_$P(TIUD14,U,2)
"RTN","TIURD2",104,0)
 S DR=DR_";1403////"_$P(TIUD14,U,3)_";1404////"_$P(TIUD14,U,4)
"RTN","TIURD2",105,0)
 S DR=DR_";1405////^S X=$P(TIUD14,U,5)"
"RTN","TIURD2",106,0)
 D ^DIE
"RTN","TIURD2",107,0)
 Q
"RTN","TIURD2",108,0)
COPYSGNR(TIUDA,TIUCDA,COPYSTAT) ; Copy Add'nal Signers
"RTN","TIURD2",109,0)
 N TIUSDA S TIUSDA=0
"RTN","TIURD2",110,0)
 F  S TIUSDA=$O(^TIU(8925.7,"B",TIUDA,TIUSDA)) Q:+TIUSDA'>0  D
"RTN","TIURD2",111,0)
 . N TIUSD0,DA,DR,DIC,DIE,DLAYGO
"RTN","TIURD2",112,0)
 . S TIUSD0=$G(^TIU(8925.7,TIUSDA,0))
"RTN","TIURD2",113,0)
 . S (DIC,DLAYGO)=8925.7,DIC(0)="LX",X=""""_"`"_TIUCDA_"""" D ^DIC Q:+Y'>0
"RTN","TIURD2",114,0)
 . S DA=+Y,DIE=DIC,DR=".02////^S X=0;.03////^S X=$P(TIUSD0,U,3)"
"RTN","TIURD2",115,0)
 . I COPYSTAT>5 D
"RTN","TIURD2",116,0)
 . . S DR=DR_";.04////^S X=$P(TIUSD0,U,4);.05////^S X=$P(TIUSD0,U,5)"
"RTN","TIURD2",117,0)
 . . S DR=DR_";.06////^S X=$P(TIUSD0,U,6);.07////^S X=$P(TIUSD0,U,7)"
"RTN","TIURD2",118,0)
 . . S DR=DR_";.08////^S X=$P(TIUSD0,U,8)"
"RTN","TIURD2",119,0)
 . D ^DIE
"RTN","TIURD2",120,0)
 Q
"RTN","TIURD2",121,0)
COPY15(DA,TIUD15) ; Copy 15-node
"RTN","TIURD2",122,0)
 N DR,DIE S DIE=8925
"RTN","TIURD2",123,0)
 S DR="1501////"_$P(TIUD15,U)_";1502////"_$P(TIUD15,U,2)_";1503////^S X=$P(TIUD15,U,3);1504////^S X=$P(TIUD15,U,4)"
"RTN","TIURD2",124,0)
 S DR=DR_";1505////"_$P(TIUD15,U,5)_";1506////"_$P(TIUD15,U,6)_";1507////"_$P(TIUD15,U,7)_";1508////"_$P(TIUD15,U,8)
"RTN","TIURD2",125,0)
 S DR=DR_";1509////^S X=$P(TIUD15,U,9);1510////^S X=$P(TIUD15,U,10);1511////"_$P(TIUD15,U,11)_";1512////"_$P(TIUD15,U,12)
"RTN","TIURD2",126,0)
 S DR=DR_";1513////"_$P(TIUD15,U,13)
"RTN","TIURD2",127,0)
 D ^DIE
"RTN","TIURD2",128,0)
 Q
"RTN","TIURD2",129,0)
STATUS(DA) ; Set original's status to "RETRACTED"
"RTN","TIURD2",130,0)
 N DIE,DR,DIC
"RTN","TIURD2",131,0)
 S DIE=8925,DR=".05///RETRACTED" D ^DIE
"RTN","TIURD2",132,0)
 D ALERTDEL^TIUALRT(DA),DELIRT^TIUDIRT(DA)
"RTN","TIURD2",133,0)
 Q
"RTN","TIURD2",134,0)
ATTACH(TIUDA,TIUDADD) ; Attach TIUDADD as addendum to TIUDA
"RTN","TIURD2",135,0)
 N DR,DIE,DA,TIUD0,TIUD12,TIUD14,TIUDADA
"RTN","TIURD2",136,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD14=$G(^(14))
"RTN","TIURD2",137,0)
 S DIE="^TIU(8925,",DA=TIUDADD
"RTN","TIURD2",138,0)
 S DR=".01////81;.02////^S X=$P(TIUD0,U,2);.03////^S X=$P(TIUD0,U,3);.04////^S X=$$DOCCLASS^TIULC1(81)"
"RTN","TIURD2",139,0)
 S DR=DR_";.06////^S X=TIUDA;.07////^S X=$P(TIUD0,U,7);.08////^S X=$P(TIUD0,U,8)"
"RTN","TIURD2",140,0)
 D ^DIE
"RTN","TIURD2",141,0)
 S DR="1205////^S X=$P(TIUD12,U,5);1211////^S X=$P(TIUD12,U,11);1212////^S X=$P(TIUD12,U,12)"
"RTN","TIURD2",142,0)
 D ^DIE
"RTN","TIURD2",143,0)
 S DR="1301////^S X="_$$REFDTA(TIUDA,TIUDADD,TIUD0)
"RTN","TIURD2",144,0)
 S DR=DR_";1401////^S X=$P(TIUD14,U);1402////^S X=$P(TIUD14,U,2)"
"RTN","TIURD2",145,0)
 D ^DIE
"RTN","TIURD2",146,0)
 ; If TIUDADD has addenda, re-attach them as addenda to TIUDA
"RTN","TIURD2",147,0)
 S TIUDADA=0
"RTN","TIURD2",148,0)
 F  S TIUDADA=$O(^TIU(8925,"DAD",TIUDADD,TIUDADA)) Q:+TIUDADA'>0  D
"RTN","TIURD2",149,0)
 . Q:'+$$ISADDNDM^TIULC1(TIUDADA)
"RTN","TIURD2",150,0)
 . D ATTACH(TIUDA,TIUDADA),SEND^TIUALRT(TIUDADA) W "."
"RTN","TIURD2",151,0)
 W !!,"Done." S TIUCHNG=1
"RTN","TIURD2",152,0)
 Q
"RTN","TIURD2",153,0)
REFDTO(TIUDA,TIU) ; Compute reference date
"RTN","TIURD2",154,0)
 N TIUY,TIUD12,TIUD13
"RTN","TIURD2",155,0)
 S TIUD12=$G(^TIU(8925,+TIUDA,12)),TIUD13=$G(^(13))
"RTN","TIURD2",156,0)
 S TIUY=+TIU("LDT")
"RTN","TIURD2",157,0)
 I TIUY>0 G REFDTOX
"RTN","TIURD2",158,0)
 I +$P(TIUD13,U,7) S TIUY=+$P(TIUD13,U,7) G REFDTOX
"RTN","TIURD2",159,0)
 S TIUY=+$P(TIUD12,U)
"RTN","TIURD2",160,0)
REFDTOX Q TIUY
"RTN","TIURD2",161,0)
REFDTA(TIUDA,TIUDADD,TIUD0) ; Compute reference date for addenda
"RTN","TIURD2",162,0)
 N TIUY,TIUDAD12,TIUDAD13
"RTN","TIURD2",163,0)
 S TIUDAD12=$G(^TIU(8925,+TIUDADD,12)),TIUDAD13=$G(^(13))
"RTN","TIURD2",164,0)
 S TIUY=+TIUDAD13
"RTN","TIURD2",165,0)
 I +$$ISDS^TIULX(+TIUD0)'>0 G REFDTAX
"RTN","TIURD2",166,0)
 I +$P(TIUDAD13,U) S TIUY=+$P(TIUDAD13,U) G REFDTAX
"RTN","TIURD2",167,0)
 I +$P(TIUDAD13,U,7) S TIUY=+$P(TIUDAD13,U,7) G REFDTAX
"RTN","TIURD2",168,0)
 S TIUY=+$P(TIUDAD12,U)
"RTN","TIURD2",169,0)
REFDTAX Q TIUY
"RTN","TIURD2",170,0)
UPDTADD(TIUDA) ; Addenda for reassigned original are updated
"RTN","TIURD2",171,0)
 I $$HASADDEN^TIULC1(+TIUDA) D
"RTN","TIURD2",172,0)
 . N DA
"RTN","TIURD2",173,0)
 . W !!,$C(7),"Addenda for this Document will now be updated..."
"RTN","TIURD2",174,0)
 . S DA=0 F  S DA=$O(^TIU(8925,"DAD",+TIUDA,DA)) Q:+DA'>0  D
"RTN","TIURD2",175,0)
 . . N DR,DIE,TIUD0,TIUD12,TIUD14
"RTN","TIURD2",176,0)
 . . I '+$$ISADDNDM^TIULC1(+DA) Q
"RTN","TIURD2",177,0)
 . . S TIUD0(0)=$G(^TIU(8925,+DA,0)),TIUD12(0)=$G(^(12))
"RTN","TIURD2",178,0)
 . . S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD14=$G(^(14))
"RTN","TIURD2",179,0)
 . . S DR=".02////"_$P(TIUD0,U,2)_";.03////"_$S($P(TIUD0,U,3)="":"@",1:$P(TIUD0,U,3))_";.04////"_$P(TIUD0,U,4)_";.07////"_$P(TIUD0,U,7)_";.08////"_$S(+$P(TIUD0,U,8):$P(TIUD0,U,8),1:"@")_";.13////"_$P(TIUD0,U,13)
"RTN","TIURD2",180,0)
 . . S DR=DR_";1401////"_$P(TIUD14,U)_";1402////"_$P(TIUD14,U,2)
"RTN","TIURD2",181,0)
 . . S DIE=8925 D ^DIE
"RTN","TIURD2",182,0)
 . . S DR="1205////"_$P(TIUD12,U,5)_";1211////"_$P(TIUD12,U,11)_";1212////"_$P(TIUD12,U,12)
"RTN","TIURD2",183,0)
 . . D ^DIE
"RTN","TIURD2",184,0)
 . . S DR="1301////^S X="_$$REFDTA^TIURD2(TIUDA,DA,TIUD0)
"RTN","TIURD2",185,0)
 . . D ^DIE W "."
"RTN","TIURD2",186,0)
 . . ; Remove and resend alerts
"RTN","TIURD2",187,0)
 . . D SEND^TIUALRT(DA)
"RTN","TIURD2",188,0)
 . . S TIUD0(1)=$G(^TIU(8925,+DA,0)),TIUD12(1)=$G(^(12))
"RTN","TIURD2",189,0)
 . . D AUDREASS^TIURB1(DA,.TIUD0,.TIUD12)
"RTN","TIURD2",190,0)
 . . ; If the addendum was retracted, post its audit trail info as well
"RTN","TIURD2",191,0)
 . . I +$P($G(^TIU(8925,DA,14)),U,6) D
"RTN","TIURD2",192,0)
 . . . D AUDREASS^TIURB1(+$P(^TIU(8925,DA,14),U,6),.TIUD0,.TIUD12)
"RTN","TIURD2",193,0)
 Q
"RTN","TIURD2",194,0)
VLOC(LOCDA)     ; Resolve location pointer
"RTN","TIURD2",195,0)
 Q $P($G(^SC(LOCDA,0)),U)
"RTN","TIURD2",196,0)
GETSIG() ; Challenge user for Electronic Signature, when appropriate
"RTN","TIURD2",197,0)
 N X,X1,X2,TIUY S TIUY=0
"RTN","TIURD2",198,0)
 D SIG^XUSESIG
"RTN","TIURD2",199,0)
 I X1']"" D  G GETSIGX
"RTN","TIURD2",200,0)
 . W !!,$C(7),$C(7),"You MUST Enter your CORRECT Electronic Signature to Complete this Task...",!
"RTN","TIURD2",201,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIURD2",202,0)
 S TIUY=1
"RTN","TIURD2",203,0)
GETSIGX Q +$G(TIUY)
"RTN","TIURD3")
0^26^B66718658
"RTN","TIURD3",1,0)
TIURD3  ; SLC/JER - Reassign actions ;11/01/03
"RTN","TIURD3",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**61,124,113,112**;Jun 20, 1997
"RTN","TIURD3",3,0)
REASSIGO ; Reassign an original Document
"RTN","TIURD3",4,0)
 N TIU,TIUASK,TIUDPRM
"RTN","TIURD3",5,0)
 W !!,"Please choose the correct PATIENT and CARE EPISODE:",!
"RTN","TIURD3",6,0)
 ; --- Get a patient ---
"RTN","TIURD3",7,0)
 S DFN=+$$PATIENT^TIULA
"RTN","TIURD3",8,0)
 ; --- If no pt. selected, QUIT ---
"RTN","TIURD3",9,0)
 I +$G(DFN)'>0 D  Q
"RTN","TIURD3",10,0)
 . S TIUOUT=1
"RTN","TIURD3",11,0)
 . W !!,"No PATIENT Selected: Aborting Transaction, No Harm Done...",!
"RTN","TIURD3",12,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",13,0)
 ; --- If document is a Surgical Report, redirect processing ---
"RTN","TIURD3",14,0)
 I +$$ISA^TIULX(TIUTYPE,+$$CLASS^TIUSROI("SURGICAL REPORTS")) D REASSOP^TIUSROI(DFN,TIUDA) Q
"RTN","TIURD3",15,0)
 ; --- If moving to another pt keep retracted original ---
"RTN","TIURD3",16,0)
 I +$G(DFN)'=$P(TIUD0(0),U,2),(+$P(TIUD0(0),U,5)>5) D
"RTN","TIURD3",17,0)
 . W !!,"Moving signed document to another Patient...A RETRACTED copy will be retained.",!
"RTN","TIURD3",18,0)
 . S TIUODA=TIUDA,TIUDA=+$$RETRACT^TIURD2(TIUDA)
"RTN","TIURD3",19,0)
 I TIUDA'>0 D  Q
"RTN","TIURD3",20,0)
 . S TIUOUT=1
"RTN","TIURD3",21,0)
 . W !!,"Creation of a new Copy of the RETRACTED record failed...Contact IRM.",!
"RTN","TIURD3",22,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",23,0)
 ; --- Get Document Parameters for TIUTYPE
"RTN","TIURD3",24,0)
 D DOCPRM^TIULC1(TIUTYPE,.TIUDPRM)
"RTN","TIURD3",25,0)
 ; --- Get associated visit ---
"RTN","TIURD3",26,0)
 S TIULMETH=$$GETLMETH^TIUEDI1(TIUTYPE)
"RTN","TIURD3",27,0)
 I '$L(TIULMETH) D  Q
"RTN","TIURD3",28,0)
 . S TIUOUT=1
"RTN","TIURD3",29,0)
 . W !!,$C(7),"No Visit Linkage Method defined for "
"RTN","TIURD3",30,0)
 . W $$PNAME^TIULC1(TIUTYPE),".",!,"Please contact IRM...",!
"RTN","TIURD3",31,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",32,0)
 X TIULMETH
"RTN","TIURD3",33,0)
 I '$D(TIU) D  Q
"RTN","TIURD3",34,0)
 . S TIUOUT=1
"RTN","TIURD3",35,0)
 . W !!,$C(7),"Patient & Visit required: Aborting Transaction...No Harm Done.",!
"RTN","TIURD3",36,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",37,0)
 ; --- Validate Selection ---
"RTN","TIURD3",38,0)
 S TIUVMETH=$$GETVMETH^TIUEDI1(TIUTYPE)
"RTN","TIURD3",39,0)
 I '$L(TIUVMETH) D  Q
"RTN","TIURD3",40,0)
 . S TIUOUT=1
"RTN","TIURD3",41,0)
 . W !!,$C(7),"No Validation Method defined for "
"RTN","TIURD3",42,0)
 . W $$PNAME^TIULC1(TIUTYPE),".",!,"Please contact IRM...",!
"RTN","TIURD3",43,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",44,0)
 X TIUVMETH
"RTN","TIURD3",45,0)
 I +$G(TIUASK)'>0 D  Q
"RTN","TIURD3",46,0)
 . S TIUOUT=1
"RTN","TIURD3",47,0)
 . W !!,$C(7),"Okay, No Harm Done.",!
"RTN","TIURD3",48,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD3",49,0)
 ; --- If same Pt & Visit, abort transaction ---
"RTN","TIURD3",50,0)
 I +$G(TIU("VISIT"))=$P(TIUD0(0),U,3) D  Q:+$G(TIUOUT)
"RTN","TIURD3",51,0)
 . I +$G(TIUADD0),+$P($G(TIUDPRM(0)),U,10) Q
"RTN","TIURD3",52,0)
 . S TIUOUT=1
"RTN","TIURD3",53,0)
 . W !!,$C(7),$C(7),$C(7),"This ",$$PNAME^TIULC1(TIUTYPE)," is already associated with the selected visit...",!
"RTN","TIURD3",54,0)
 . W !,"No action taken.",!
"RTN","TIURD3",55,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",56,0)
 ; --- If valid Pt and Visit, Reassign the document ---
"RTN","TIURD3",57,0)
 I $L($G(TIU("VSTR"))) D
"RTN","TIURD3",58,0)
 . N DA,DR,DIE,TIUORIG,TIUOLD0
"RTN","TIURD3",59,0)
 . S TIUORIG=+$O(^TIU(8925,"APTLD",DFN,TIUTYPE,$G(TIU("VSTR")),0))
"RTN","TIURD3",60,0)
 . S TIUOLD0=$G(^TIU(8925,+TIUORIG,0))
"RTN","TIURD3",61,0)
 . ; If record exists and >1 documents/visit NOT allowed, offer
"RTN","TIURD3",62,0)
 . ; chance to attach record as addendum
"RTN","TIURD3",63,0)
 . I +TIUORIG,(+$P(TIUDPRM(0),U,10)'>0),(+$P(TIUOLD0,U,5)'>13) D  Q
"RTN","TIURD3",64,0)
 . . N TIUATT
"RTN","TIURD3",65,0)
 . . I TIUORIG=TIUDA D  Q
"RTN","TIURD3",66,0)
 . . . W !,$C(7),$C(7),$C(7),"This ",$$PNAME^TIULC1(TIUTYPE)," is already associated with the selected visit...",!
"RTN","TIURD3",67,0)
 . . . W !,"No action taken.",!
"RTN","TIURD3",68,0)
 . . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",69,0)
 . . W !!,$C(7),$C(7),$C(7),"This patient already has a "
"RTN","TIURD3",70,0)
 . . W $$UP^XLFSTR($$PNAME^TIULC1(TIUTYPE))," for the selected care"
"RTN","TIURD3",71,0)
 . . W !,"episode. Do you wish to make the current record an ADDENDUM of that ",!,$$UP^XLFSTR($$PNAME^TIULC1(TIUTYPE)),"?",!
"RTN","TIURD3",72,0)
 . . S TIUATT=$$READ^TIUU("YOA","   ...OK? ","YES")
"RTN","TIURD3",73,0)
 . . I +TIUATT'>0 D  Q
"RTN","TIURD3",74,0)
 . . . W !!,"All right. No harm done.",!
"RTN","TIURD3",75,0)
 . . . S TIUOUT=1
"RTN","TIURD3",76,0)
 . . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",77,0)
 . . D DELIRT^TIUDIRT($S(+$G(TIUODA):+TIUODA,1:+TIUDA))
"RTN","TIURD3",78,0)
 . . D ATTACH^TIURD2(+TIUORIG,TIUDA),SEND^TIUALRT(TIUDA) S TIUCHNG=1
"RTN","TIURD3",79,0)
 . ; --- Roll back old IRT data ---
"RTN","TIURD3",80,0)
 . D DELIRT^TIUDIRT($S(+$G(TIUODA):+TIUODA,1:+TIUDA))
"RTN","TIURD3",81,0)
 . ; --- Set up the ^DIE Call ---
"RTN","TIURD3",82,0)
 . S DR=$G(DR)_".02////"_DFN_";.03////"_$S(+$P($G(TIU("VISIT")),U):$P($G(TIU("VISIT")),U),1:"@")_";.07////"_$P($G(TIU("EDT")),U)_";.08////"_$S(+$G(TIU("LDT")):$P($G(TIU("LDT")),U),1:"@")_";.13////"_$P($G(TIU("VSTR")),";",3)
"RTN","TIURD3",83,0)
 . S DR=DR_";1205////"_$P($G(TIU("LOC")),U)_";1401////"_$S($L($G(TIU("AD#"))):+$G(TIU("AD#")),1:"@")_";1402////"_$P($G(TIU("TS")),U)_";1211////"_$P($G(TIU("VLOC")),U)_";1212////"_$P($G(TIU("INST")),U)
"RTN","TIURD3",84,0)
 . S:+$$ISDS^TIULX(TIUTYPE) DR=DR_";1301////^S X="_$$REFDTO^TIURD2(TIUDA,.TIU)
"RTN","TIURD3",85,0)
 . ; --- Don't ask author or cosigner for documents that have been signed ---
"RTN","TIURD3",86,0)
 . S:+$P($G(^TIU(8925,+TIUDA,0)),U,5)'>5 DR=DR_";1202;1204////^S X=$P(^TIU(8925,DA,12),U,2);I '+$P($G(^TIU(8925,+TIUDA,12)),U,8) S Y=0;1208"
"RTN","TIURD3",87,0)
 . ; --- Call ^DIE to affect the Reassignment ---
"RTN","TIURD3",88,0)
 . S DA=TIUDA,DIE=8925 D ^DIE
"RTN","TIURD3",89,0)
 . ; --- Post-reassignment Steps ---
"RTN","TIURD3",90,0)
 . ; 1. Package Reassign Action:
"RTN","TIURD3",91,0)
 . D PKGACT(TIUDA,.TIUD0,.TIUD12,.TIUD13,.TIUD14,.TIUOUT)
"RTN","TIURD3",92,0)
 . Q:+$G(TIUOUT)
"RTN","TIURD3",93,0)
 . W !!,$G(TIUNAME)," Reassigned.",!
"RTN","TIURD3",94,0)
 . ; 2. Attach document to new Visit
"RTN","TIURD3",95,0)
 . D QUE^TIUPXAP1
"RTN","TIURD3",96,0)
 . ; 3. Update Addenda to Document
"RTN","TIURD3",97,0)
 . D UPDTADD^TIURD2(TIUDA)
"RTN","TIURD3",98,0)
 . ; 4. Update IRT Record
"RTN","TIURD3",99,0)
 . D UPDTIRT^TIUDIRT(.TIU,+TIUDA)
"RTN","TIURD3",100,0)
 . ; 5. Send Signature Alerts
"RTN","TIURD3",101,0)
 . D SEND^TIUALRT(TIUDA)
"RTN","TIURD3",102,0)
 . ; 6. Audit Reassignment
"RTN","TIURD3",103,0)
 . S TIUD0(1)=$G(^TIU(8925,+TIUDA,0)),TIUD12(1)=$G(^(12))
"RTN","TIURD3",104,0)
 . D AUDREASS^TIURB1(TIUDA,.TIUD0,.TIUD12)
"RTN","TIURD3",105,0)
 . ; 7. If document was retracted, register audit trail for it
"RTN","TIURD3",106,0)
 . I +$G(TIUODA) D AUDREASS^TIURB1(TIUODA,.TIUD0,.TIUD12)
"RTN","TIURD3",107,0)
 . I +$P($G(TIUD0(0)),U,3) D WKLD(.TIUD0,.TIUD12)
"RTN","TIURD3",108,0)
 . ;Finally, collect workload for target visit as appropriate
"RTN","TIURD3",109,0)
 . I (+$P(^TIU(8925,+TIUDA,0),U,5)>6),+$P(^TIU(8925,+TIUDA,0),U,11) D
"RTN","TIURD3",110,0)
 . . I $P(+$G(TIU("EDT")),".")'>DT D  Q:'+TIUASK
"RTN","TIURD3",111,0)
 . . . W !!,"You may now edit the encounter data for the DESTINATION Visit...",!
"RTN","TIURD3",112,0)
 . . . W !,"Patient: ",$G(TIU("PNM")),!,"  Visit: ",$P($G(TIU("EDT")),U,2)," to ",$P($G(TIU("VLOC")),U,2)
"RTN","TIURD3",113,0)
 . . . W ! S TIUASK=+$$READ^TIUU("Y","Do you wish to do this now","NO")
"RTN","TIURD3",114,0)
 . . ;If no workload process using TIU's interview
"RTN","TIURD3",115,0)
 . . ;else, process using PCE's interview
"RTN","TIURD3",116,0)
 . . I '$$CHKVST^TIUPXAP2(+TIUDA) D  I 1
"RTN","TIURD3",117,0)
 . . . N TIUCONT,TIUPRMT
"RTN","TIURD3",118,0)
 . . . Q:$D(XWBOS)
"RTN","TIURD3",119,0)
 . . . I $P(+$P(^TIU(8925,+TIUDA,0),U,7),".")>DT D  Q
"RTN","TIURD3",120,0)
 . . . . W !!
"RTN","TIURD3",121,0)
 . . . . D QUE^TIUPXAP1
"RTN","TIURD3",122,0)
 . . . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",123,0)
 . . . ;W !!
"RTN","TIURD3",124,0)
 . . . ;need workload? if yes enter
"RTN","TIURD3",125,0)
 . . . I $$CHKWKL^TIUPXAP2(+TIUDA,.TIUDPRM) D CREDIT^TIUVSIT(TIUDA)
"RTN","TIURD3",126,0)
 . . E  D
"RTN","TIURD3",127,0)
 . . . ;need workload? if yes enter
"RTN","TIURD3",128,0)
 . . . I $$CHKWKL^TIUPXAP2(+TIUDA,.TIUDPRM) D EDTENC^TIUPXAP2(TIUDA)
"RTN","TIURD3",129,0)
 . S TIUCHNG=1 S:+$G(TIUODA) TIUCHNG=TIUCHNG_U_TIUDA
"RTN","TIURD3",130,0)
 . W ! I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",131,0)
 Q
"RTN","TIURD3",132,0)
 ;
"RTN","TIURD3",133,0)
WKLD(TIUD0,TIUD12) ; Allow user to clean up workload for visit from which document was removed
"RTN","TIURD3",134,0)
 N TIUVSIT,TIUWHAT,TIUERR,TIUDFN,TIUEDT,TIUHL
"RTN","TIURD3",135,0)
 I $S($P(TIUD0(0),U,13)="H":1,$P(TIUD0(0),U,13)="E":1,1:0) Q
"RTN","TIURD3",136,0)
 S TIUHL=$P(TIUD12(0),U,11)
"RTN","TIURD3",137,0)
 I $P($G(^SC(+TIUHL,0)),U,3)'="C" Q
"RTN","TIURD3",138,0)
 S TIUDFN=$P(TIUD0(0),U,2),TIUEDT=$P(TIUD0(0),U,7),TIUVSIT=$P(TIUD0(0),U,3)
"RTN","TIURD3",139,0)
 W !,"You may now clean up the encounter data for the ORIGINAL Visit...",!
"RTN","TIURD3",140,0)
 W !,"Patient: ",$$PTNAME^TIULC1(TIUDFN),!,"  Visit: ",$$DATE^TIULS(TIUEDT,"AMTH DD, CCYY@HR:MIN")," to ",$$VLOC^TIURD2(TIUHL)
"RTN","TIURD3",141,0)
 W ! I '+$$READ^TIUU("Y","Do you wish to do this now","NO") Q
"RTN","TIURD3",142,0)
 I $G(VALMAR)'="^TMP(""TIUR"",$J)" W !!,"Editing Encounter Data...",!
"RTN","TIURD3",143,0)
 S TIUWHAT=$S($$CHKAPPT^TIUPXAP2(TIUVSIT,TIUDFN,TIUEDT,TIUHL):"INTV",1:"ADDEDIT")
"RTN","TIURD3",144,0)
 S TIUERR=$$INTV^PXAPI(TIUWHAT,"TIU","TEXT INTEGRATION UTILITIES",.TIUVSIT,$S(+$G(TIUVSIT):"",1:TIUHL),TIUDFN,$S(+$G(TIUVSIT):"",1:TIUEDT))
"RTN","TIURD3",145,0)
 ;
"RTN","TIURD3",146,0)
 ;If an error is returned prompt to continue otherwise if a Visit
"RTN","TIURD3",147,0)
 ;IEN is returned and one is not already defined update the document
"RTN","TIURD3",148,0)
 ;I +TIUERR<0 D  I 1
"RTN","TIURD3",149,0)
 ;. W ! I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",150,0)
 ;E  I +$G(TIUVSIT),(+$G(TIUVSIT)'=$P($G(^TIU(8925,+TIUDA,0)),U,3)) D
"RTN","TIURD3",151,0)
 ;.  
"RTN","TIURD3",152,0)
 Q
"RTN","TIURD3",153,0)
PKGACT(TIUDA,TIUD0,TIUD12,TIUD13,TIUD14,TIUOUT) ; Get/Execute Package Reassign Action
"RTN","TIURD3",154,0)
 N TIUREASX,TIUPOP
"RTN","TIURD3",155,0)
 S TIUREASX=$$REASSIGN^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIURD3",156,0)
 I TIUREASX]"" D  Q:+$G(TIUPOP)
"RTN","TIURD3",157,0)
 . X TIUREASX
"RTN","TIURD3",158,0)
 . I +$G(TIUPOP) D  Q
"RTN","TIURD3",159,0)
 . . S TIUOUT=1
"RTN","TIURD3",160,0)
 . . D WHOABACK(TIUDA,TIUD0(0),TIUD12(0),TIUD13(0),TIUD14(0))
"RTN","TIURD3",161,0)
 . . W !!,$C(7),"Can't Reassign this document...",!
"RTN","TIURD3",162,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURD3",163,0)
 . ; --- If original was retracted, call package Delete Action to roll-back ---
"RTN","TIURD3",164,0)
 . I +$G(TIUODA) D
"RTN","TIURD3",165,0)
 . . N TIUDA,TIUDELX
"RTN","TIURD3",166,0)
 . . S TIUDA=TIUODA
"RTN","TIURD3",167,0)
 . . S TIUDELX=$$DELETE^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIURD3",168,0)
 . . I TIUDELX]"" X TIUDELX
"RTN","TIURD3",169,0)
 Q
"RTN","TIURD3",170,0)
 ;
"RTN","TIURD3",171,0)
WHOABACK(DA,TIUD0,TIUD12,TIUD13,TIUD14) ; Undo Reassign when fails
"RTN","TIURD3",172,0)
 N DIE,DR S DIE=8925
"RTN","TIURD3",173,0)
 S DR=".02////"_$P(TIUD0,U,2)_";.03////"_$P(TIUD0,U,3)_";.07////"_$P(TIUD0,U,7)_";.08////"_$P(TIUD0,U,8)_";.13////"_$P(TIUD0,U,13)
"RTN","TIURD3",174,0)
 S DR=DR_";1205////"_$P(TIUD12,U,5)_";1401////"_$P(TIUD14,U)_";1402////"_$P(TIUD14,U,2)_";1211////"_$P(TIUD12,U,11)_";1212////"_$P(TIUD12,U,12)
"RTN","TIURD3",175,0)
 D ^DIE
"RTN","TIURD3",176,0)
 I +$P($G(^TIU(8925,+DA,0)),U,5)'>5 D
"RTN","TIURD3",177,0)
 . S DR="1202////"_$P(TIUD12,U,2)_";1305////"_$P(TIUD13,U,5)_";1306////"_$P(TIUD13,U,6)_";1208////"_$P(TIUD12,U,8)_";1209////"_$P(TIUD12,U,9)
"RTN","TIURD3",178,0)
 . S DIE=8925 D ^DIE
"RTN","TIURD3",179,0)
 Q
"RTN","TIUSROI")
0^9^B63760309
"RTN","TIUSROI",1,0)
TIUSROI ; SLC/JER - TIU/Surgery Interface Routine ; 02/03/2004
"RTN","TIUSROI",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**112**;Jun 20, 1997
"RTN","TIUSROI",3,0)
 Q
"RTN","TIUSROI",4,0)
GETOP(TIUY,TIUDA,SROTYP) ; Get Op-Top
"RTN","TIUSROI",5,0)
 N SROVP
"RTN","TIUSROI",6,0)
 S SROVP=$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIUSROI",7,0)
 S SROTYP=$G(SROTYP,"OP")
"RTN","TIUSROI",8,0)
 S TIUY=$S(SROTYP="OP":$NA(^TMP("SROP",$J,+SROVP)),1:$NA(^TMP("SRNOR",$J,+SROVP)))
"RTN","TIUSROI",9,0)
 I $P(SROVP,";",2)'="SRF(" Q
"RTN","TIUSROI",10,0)
 ; Call Surgery API
"RTN","TIUSROI",11,0)
 D @$S(SROTYP="OP":"OPTOP^SROSRPT(+SROVP)",1:"OPTOP^SRONP(+SROVP)")
"RTN","TIUSROI",12,0)
 I +$G(@TIUY@(0))=0 K @TIUY Q
"RTN","TIUSROI",13,0)
 I '$D(XWBOS),'$D(ZTQUEUED),($E($G(IOST))="C"),(@TIUY@(0)=2) D
"RTN","TIUSROI",14,0)
 . N SEEOP S SEEOP=0
"RTN","TIUSROI",15,0)
 . I $S(+$D(XQADATA):1,$G(TIUEVNT)["SIGN":1,1:0) D  Q:+SEEOP
"RTN","TIUSROI",16,0)
 . . W !
"RTN","TIUSROI",17,0)
 . . S SEEOP=+$$READ^TIUU("YA","Do you want to see the Op Top? ","YES")
"RTN","TIUSROI",18,0)
 . K @TIUY
"RTN","TIUSROI",19,0)
 I $D(XWBOS),($G(@TIUY@(0))'=1) K @TIUY
"RTN","TIUSROI",20,0)
 Q
"RTN","TIUSROI",21,0)
GETCASE(DFN,DA) ; Match Operation Report to an open Surgical Case
"RTN","TIUSROI",22,0)
 ; Call with:     [DFN] - patient file entry number
"RTN","TIUSROI",23,0)
 ;   Returns:     TIUY  - Variable pointer to Surgical Case
"RTN","TIUSROI",24,0)
AGN ; Loop for handling repeated attempts
"RTN","TIUSROI",25,0)
 N TIUI,TIUII,TIUER,TIUOK,TIUOUT,TIUX,TIUY,TIUMTSTR,TIUMLST,TIUCNT,X
"RTN","TIUSROI",26,0)
 N TIULIST
"RTN","TIUSROI",27,0)
 I +DFN'>0 S TIUOUT=1 Q 0
"RTN","TIUSROI",28,0)
 I +$G(DA) D  G:+TIUX>0 GETX
"RTN","TIUSROI",29,0)
 . I +$P($G(^TIU(8925,+DA,14)),U,5) S TIUX=+$P($G(^(14)),U,5) Q
"RTN","TIUSROI",30,0)
 . I +$$ISADDNDM^TIULC1(+DA) S TIUX=+$$DADSC(DA)
"RTN","TIUSROI",31,0)
 ; Call Surgery to get list of cases
"RTN","TIUSROI",32,0)
 D LIST^SROESTV(.TIULIST,DFN,"","","",0)
"RTN","TIUSROI",33,0)
 ; If no Surgeries for patient, then quit
"RTN","TIUSROI",34,0)
 I '$D(@TIULIST) D  Q -1
"RTN","TIUSROI",35,0)
 . W !!,$C(7),"No SURGICAL CASES to Result for ",$$PTNAME^TIULC1(DFN),".",!
"RTN","TIUSROI",36,0)
 S (TIUCNT,TIUI)=0 F  S TIUI=+$O(@TIULIST@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSROI",37,0)
 . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUSROI",38,0)
 W !,"You must link your Result to a SURGICAL CASE...",!
"RTN","TIUSROI",39,0)
 D INDEX(TIULIST)
"RTN","TIUSROI",40,0)
 D  I +TIUER Q:+$G(TIUOUT) 0  G AGN
"RTN","TIUSROI",41,0)
 . W !,"The following SURGICAL CASE"
"RTN","TIUSROI",42,0)
 . W $S(+TIUCNT>1:"(S) are",1:" is")," available:"
"RTN","TIUSROI",43,0)
 . S (TIUER,TIUOK,TIUI)=0
"RTN","TIUSROI",44,0)
 . F  S TIUI=$O(@TIULIST@(TIUI)) Q:+TIUI'>0!+TIUER!+TIUOK  D
"RTN","TIUSROI",45,0)
 . . S TIUII=TIUI,TIUX=$G(@TIULIST@(TIUI))
"RTN","TIUSROI",46,0)
 . . D WRITE I '(TIUI#5) D BREAK
"RTN","TIUSROI",47,0)
 . Q:$D(TIUOUT)
"RTN","TIUSROI",48,0)
 . I +TIUER S TIUOUT=1 Q
"RTN","TIUSROI",49,0)
 . I TIUII#5 D BREAK Q:$D(TIUOUT)
"RTN","TIUSROI",50,0)
 . I +TIUER S TIUOUT=1 Q
"RTN","TIUSROI",51,0)
 . S TIUX=+@TIULIST@(TIUOK),^DISV(DUZ,"^SRF(",DFN)=+TIUX
"RTN","TIUSROI",52,0)
 . W "  ",+TIUX
"RTN","TIUSROI",53,0)
GETX S TIUY=+TIUX_";SRF(" K @TIULIST
"RTN","TIUSROI",54,0)
 Q $G(TIUY)
"RTN","TIUSROI",55,0)
BREAK ; Handle prompting
"RTN","TIUSROI",56,0)
 W !,"CHOOSE 1-",TIUII W:$D(@TIULIST@(TIUII+1)) !,"<RETURN> TO CONTINUE",!,"OR '^' TO QUIT" W ": " R X:DTIME
"RTN","TIUSROI",57,0)
 I $S('$T!(X["^"):1,X=""&'$D(@TIULIST@(TIUII+1)):1,1:0) S TIUER=1 Q
"RTN","TIUSROI",58,0)
 I X="" Q
"RTN","TIUSROI",59,0)
 I X=" ",$D(^DISV(DUZ,"^SRF(",DFN)) S TIUX=^(DFN) S TIUOK=+$O(@TIULIST@("C",+TIUX,0)) Q
"RTN","TIUSROI",60,0)
 I X'=+X!'$D(@TIULIST@(+X)) W !!,$C(7),"INVALID RESPONSE",! G BREAK
"RTN","TIUSROI",61,0)
 S TIUOK=X
"RTN","TIUSROI",62,0)
 Q
"RTN","TIUSROI",63,0)
DADSC(DA) ; Get the Surgical Case associated with the parent record
"RTN","TIUSROI",64,0)
 N TIUDADA,TIUY S TIUDADA=$P($G(^TIU(8925,+DA,0)),U,6)
"RTN","TIUSROI",65,0)
 S TIUY=$P($G(^TIU(8925,TIUDADA,14)),U,5)
"RTN","TIUSROI",66,0)
 Q TIUY
"RTN","TIUSROI",67,0)
WRITE ; Writes each case
"RTN","TIUSROI",68,0)
 W !,$J(TIUI,4),">  ",$$DATE^TIULS($P(TIUX,U,3),"AMTH DD, CCYY")
"RTN","TIUSROI",69,0)
 W " Case #",$P(TIUX,U),?34,$E($P(TIUX,U,2),1,25)
"RTN","TIUSROI",70,0)
 W ?60,$E($P($P(TIUX,U,4),";",2),1,20)
"RTN","TIUSROI",71,0)
 Q
"RTN","TIUSROI",72,0)
INDEX(TIULIST) ; Build index of list
"RTN","TIUSROI",73,0)
 N TIUI S TIUI=0
"RTN","TIUSROI",74,0)
 F  S TIUI=$O(@TIULIST@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSROI",75,0)
 . S @TIULIST@("C",+@TIULIST@(TIUI),TIUI)=""
"RTN","TIUSROI",76,0)
 Q
"RTN","TIUSROI",77,0)
ISSURG(TIUY,TITLE) ; Boolean RPC to evaluate whether TITLE is a SURGERY REPORT
"RTN","TIUSROI",78,0)
 N TIUCLASS,TIUI S TIUY=0
"RTN","TIUSROI",79,0)
 F TIUI="SURGICAL REPORTS","PROCEDURE REPORTS (NON-O.R.)" D  Q:TIUY>0
"RTN","TIUSROI",80,0)
 . S TIUCLASS=+$$CLASS(TIUI)
"RTN","TIUSROI",81,0)
 . I +TIUCLASS'>0 Q
"RTN","TIUSROI",82,0)
 . S TIUY=+$$ISA^TIULX(TITLE,TIUCLASS)
"RTN","TIUSROI",83,0)
 Q
"RTN","TIUSROI",84,0)
RBOR(TIUDA) ; Roll back OPERATION REPORT when TIU changes require it
"RTN","TIUSROI",85,0)
 N SRODA S SRODA=+$P($G(^TIU(8925,TIUDA,14)),U,5) Q:+SRODA'>0
"RTN","TIUSROI",86,0)
 D OS^SROTIUD(SRODA)
"RTN","TIUSROI",87,0)
 Q
"RTN","TIUSROI",88,0)
RBPR(TIUDA) ; Roll back NON-O.R. PROC REPORT when TIU changes require it
"RTN","TIUSROI",89,0)
 N SRODA S SRODA=+$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIUSROI",90,0)
 Q:+SRODA'>0
"RTN","TIUSROI",91,0)
 D NON^SROTIUD(SRODA)
"RTN","TIUSROI",92,0)
 Q
"RTN","TIUSROI",93,0)
CLASS(CLNAME) ; What is the TIU Class (or Document Class) for SURGERY REPORTS
"RTN","TIUSROI",94,0)
 N TIUY
"RTN","TIUSROI",95,0)
 S TIUY=+$O(^TIU(8925.1,"B",CLNAME,0))
"RTN","TIUSROI",96,0)
 I +TIUY>0,$S($P($G(^TIU(8925.1,+TIUY,0)),U,4)="CL":0,$P($G(^(0)),U,4)="DC":0,1:1) S TIUY=0
"RTN","TIUSROI",97,0)
 Q TIUY
"RTN","TIUSROI",98,0)
ES(TIUDA,TIUDUZ) ; Apply user's e-Sig to Document
"RTN","TIUSROI",99,0)
 N TIUES
"RTN","TIUSROI",100,0)
 S TIUDUZ=$G(TIUDUZ,DUZ)
"RTN","TIUSROI",101,0)
 I '+$G(^TIU(8925,TIUDA,0)) Q
"RTN","TIUSROI",102,0)
 S TIUES="1^"_$$SIGNAME^TIULS(TIUDUZ)_U_$$SIGTITL^TIULS(TIUDUZ)
"RTN","TIUSROI",103,0)
 D ES^TIURS(TIUDA,TIUES)
"RTN","TIUSROI",104,0)
 Q
"RTN","TIUSROI",105,0)
ENTEROP(DFN,TIUTYP) ; Re-direct entry of Op and Proc Reports
"RTN","TIUSROI",106,0)
 N TIUDA,TIUD0,TIUX,TIUPRM0,TIUPRM1,SUCCESS,TIUBUF,TIUTNM
"RTN","TIUSROI",107,0)
 S TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUSROI",108,0)
 ; -- Exclude NIR and AR from Entry
"RTN","TIUSROI",109,0)
 I $S(TIUTNM["ANESTH":1,TIUTNM["NURS":1,1:0) D  Q
"RTN","TIUSROI",110,0)
 . W !!,TIUTNM,"s may only be entered through the Surgery Options.",!
"RTN","TIUSROI",111,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",112,0)
 . W !
"RTN","TIUSROI",113,0)
 ; -- first, determine the correct TIU DOCUMENT record --
"RTN","TIUSROI",114,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!+$G(TIUOUT)
"RTN","TIUSROI",115,0)
 . N D,D0,DK,DL,DIC,X,Y,DA,DX,A,S,TIUFPRIV
"RTN","TIUSROI",116,0)
 . S X=+$G(DFN)
"RTN","TIUSROI",117,0)
 . I X'>0 D  Q
"RTN","TIUSROI",118,0)
 . . W !!,"No Patient Specified...",!
"RTN","TIUSROI",119,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",120,0)
 . . S TIUOUT=1 W !
"RTN","TIUSROI",121,0)
 . S DIC=8925,DIC(0)="UXEV",D="C"
"RTN","TIUSROI",122,0)
 . W !
"RTN","TIUSROI",123,0)
 . S DIC("W")="D DICW^TIUPUTS(+Y)"
"RTN","TIUSROI",124,0)
 . S DIC("S")="I +$G(^TIU(8925,+Y,0))=TIUTYP"
"RTN","TIUSROI",125,0)
 . D IX^DIC
"RTN","TIUSROI",126,0)
 . I +Y'>0 D  Q
"RTN","TIUSROI",127,0)
 . . W !!,$S(+$O(^TIU(8925,"C",+X,0))'>0:"No "_TIUTNM_"s Available.",1:"No "_TIUTNM_" Selected..."),!
"RTN","TIUSROI",128,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",129,0)
 . . S TIUOUT=1 W !
"RTN","TIUSROI",130,0)
 . D BROWS1^TIURA2("TIU BROWSE FOR TRANSCRIPTION",+Y)
"RTN","TIUSROI",131,0)
 . S TIUOUT=1 W !
"RTN","TIUSROI",132,0)
 Q
"RTN","TIUSROI",133,0)
REASSOP(DFN,TIUODA) ; Re-direct REASSIGNMENT of Op and Proc Reports
"RTN","TIUSROI",134,0)
 N TIUDA,TIUD0,TIUD12,TIUTYP,TIUTNM,TIUSCRN
"RTN","TIUSROI",135,0)
 S TIUD0(0)=$G(^TIU(8925,+TIUODA,0)),TIUD12(0)=$G(^(12))
"RTN","TIUSROI",136,0)
 S TIUTYP=+TIUD0(0)
"RTN","TIUSROI",137,0)
 S TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUSROI",138,0)
 ; -- Exclude NIR and AR from Entry
"RTN","TIUSROI",139,0)
 I +$$ISADDNDM^TIULC1(TIUODA),$S($$GET1^DIQ(8925,TIUODA,.06)["ANESTH":1,$$GET1^DIQ(8925,TIUODA,.06)["NURS":1,1:0) D  G REASSOPX
"RTN","TIUSROI",140,0)
 . W !!,"ADDENDUMs to ",$$GET1^DIQ(8925,TIUODA,.06),"s may not be reassigned.",!
"RTN","TIUSROI",141,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUSROI",142,0)
 . S TIUOUT=1
"RTN","TIUSROI",143,0)
 . W !
"RTN","TIUSROI",144,0)
 S TIUDA=0
"RTN","TIUSROI",145,0)
 I $S(TIUTNM["ANESTH":1,TIUTNM["NURS":1,1:0) D  G REASSOPX
"RTN","TIUSROI",146,0)
 . W !!,TIUTNM,"s may only be created through the Surgery Options..."
"RTN","TIUSROI",147,0)
 . W !,"Reassignment is not allowed.",!
"RTN","TIUSROI",148,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",149,0)
 . S TIUOUT=1
"RTN","TIUSROI",150,0)
 . W !
"RTN","TIUSROI",151,0)
 ; -- Identify the target TIU DOCUMENT record --
"RTN","TIUSROI",152,0)
 S TIUSCRN="I +$G(^TIU(8925,+Y,0))=TIUTYP,'$D(^TIU(8925,+Y,""TEXT""))"
"RTN","TIUSROI",153,0)
 S TIUDA=$$SELOP(DFN,TIUTYP,TIUSCRN)
"RTN","TIUSROI",154,0)
 I +TIUDA'>0 D  G REASSOPX
"RTN","TIUSROI",155,0)
 . W !!,"No Destination Document Selected: Aborting Transaction,"
"RTN","TIUSROI",156,0)
 . W !,"   No Harm Done...",!
"RTN","TIUSROI",157,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",158,0)
 ; -- Confirm selection --
"RTN","TIUSROI",159,0)
 I '$$FROMTO^TIUSROI1(TIUODA,TIUDA,TIUTNM) D  G REASSOPX
"RTN","TIUSROI",160,0)
 . W !!,"Aborting Transaction, No Harm Done...",!
"RTN","TIUSROI",161,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",162,0)
 ; -- Conditionally Retract Original --
"RTN","TIUSROI",163,0)
 I (+$P(TIUD0(0),U,5)>5) D
"RTN","TIUSROI",164,0)
 . N TIUMSG,TIURTCT S TIUMSG=$S(DFN=+$P(TIUD0(0),U,2):"Reassigning document...",DFN'=+$P(TIUD0(0),U,2):"Moving signed document to another Patient...")
"RTN","TIUSROI",165,0)
 . W !!,TIUMSG,!
"RTN","TIUSROI",166,0)
 . W "A RETRACTED copy will be retained.",!
"RTN","TIUSROI",167,0)
 . S TIURTCT=$$RETRACT^TIURD2(TIUODA,"",15)
"RTN","TIUSROI",168,0)
 ; -- Copy AUTHOR from original to target/Update target status --
"RTN","TIUSROI",169,0)
 D AUTHSTAT(TIUDA,TIUODA,.TIUD12)
"RTN","TIUSROI",170,0)
 ; -- Copy contents of original into target --
"RTN","TIUSROI",171,0)
 D COPYTEXT^TIURC1(TIUODA,TIUDA)
"RTN","TIUSROI",172,0)
 I $D(^TIU(8925,TIUDA,"TEMP")) D
"RTN","TIUSROI",173,0)
 . N TIU
"RTN","TIUSROI",174,0)
 . D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSROI",175,0)
 . D MERGTEXT^TIUEDI1(TIUDA,.TIU)
"RTN","TIUSROI",176,0)
 . K ^TIU(8925,TIUDA,"TEMP")
"RTN","TIUSROI",177,0)
 ; -- Conditionally roll back original --
"RTN","TIUSROI",178,0)
 I +$P(TIUD0(0),U,5)>5 D
"RTN","TIUSROI",179,0)
 . N TIUDA,TIUDELX
"RTN","TIUSROI",180,0)
 . S TIUDA=TIUODA
"RTN","TIUSROI",181,0)
 . S TIUDELX=$$DELETE^TIULC1(+$G(TIUD0(0)))
"RTN","TIUSROI",182,0)
 . I TIUDELX]"" X TIUDELX
"RTN","TIUSROI",183,0)
 I +$P(TIUD0(0),U,5)'>5 D
"RTN","TIUSROI",184,0)
 . N TIUX,SUCCESS
"RTN","TIUSROI",185,0)
 . K ^TIU(8925,TIUODA,"TEXT")
"RTN","TIUSROI",186,0)
 . S TIUX(.05)=1
"RTN","TIUSROI",187,0)
 . D FILE^TIUSRVP(.SUCCESS,TIUODA,.TIUX,1)
"RTN","TIUSROI",188,0)
 ; -- Send Signature Alerts for target --
"RTN","TIUSROI",189,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIUSROI",190,0)
 ; -- Delete Signature Alerts for Original --
"RTN","TIUSROI",191,0)
 D ALERTDEL^TIUALRT(TIUODA)
"RTN","TIUSROI",192,0)
 ; -- Audit Reassignment of target --
"RTN","TIUSROI",193,0)
 S TIUD0(1)=$G(^TIU(8925,+TIUDA,0)),TIUD12(1)=$G(^(12))
"RTN","TIUSROI",194,0)
 D AUDREASS^TIURB1(TIUDA,.TIUD0,.TIUD12)
"RTN","TIUSROI",195,0)
 ; -- Register audit trail for original
"RTN","TIUSROI",196,0)
 I +$G(TIUODA) D AUDREASS^TIURB1(TIUODA,.TIUD0,.TIUD12)
"RTN","TIUSROI",197,0)
 S TIUCHNG=1
"RTN","TIUSROI",198,0)
REASSOPX Q
"RTN","TIUSROI",199,0)
AUTHSTAT(TIUDA,TIUODA,TIUD12) ; Copy Author, update status
"RTN","TIUSROI",200,0)
 N TIUX,SUCCESS
"RTN","TIUSROI",201,0)
 S TIUX(.05)=5
"RTN","TIUSROI",202,0)
 S TIUX(1406)=TIUODA
"RTN","TIUSROI",203,0)
 I +$P(TIUD12(0),U,2) S TIUX(1202)=$P(TIUD12(0),U,2)
"RTN","TIUSROI",204,0)
 D FILE^TIUSRVP(.SUCCESS,TIUDA,.TIUX,1)
"RTN","TIUSROI",205,0)
 Q
"RTN","TIUSROI",206,0)
SELOP(DFN,TIUTYP,TIUSCRN) ; Select an Op or Proc Report
"RTN","TIUSROI",207,0)
 N DUOUT,DTOUT,D,D0,DK,DL,DIC,X,Y,DA,DX,A,S,TIUFPRIV,TIUY,TIUTNM
"RTN","TIUSROI",208,0)
 S TIUY=0
"RTN","TIUSROI",209,0)
 S TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUSROI",210,0)
 S TIUSCRN=$G(TIUSCRN,"I +$G(^TIU(8925,+Y,0))=TIUTYP")
"RTN","TIUSROI",211,0)
 S X=+$G(DFN)
"RTN","TIUSROI",212,0)
 I X'>0 D  G SELOPX
"RTN","TIUSROI",213,0)
 . W !!,"No Patient Specified...",!
"RTN","TIUSROI",214,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",215,0)
 . W !
"RTN","TIUSROI",216,0)
 S DIC=8925,DIC(0)="UXEV",D="C"
"RTN","TIUSROI",217,0)
 W !
"RTN","TIUSROI",218,0)
 S DIC("W")="D DICW^TIUPUTS(+Y)"
"RTN","TIUSROI",219,0)
 S DIC("S")=TIUSCRN
"RTN","TIUSROI",220,0)
 D IX^DIC
"RTN","TIUSROI",221,0)
 I +Y'>0 D
"RTN","TIUSROI",222,0)
 . W !!,"No "_TIUTNM
"RTN","TIUSROI",223,0)
 . W $S(+$O(^TIU(8925,"APT",DFN,TIUTYP,0))'>0:"s On File.",+$O(^(0))>2:"s Available.",1:" Selected..."),!
"RTN","TIUSROI",224,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",225,0)
 . W !
"RTN","TIUSROI",226,0)
 S TIUY=+Y
"RTN","TIUSROI",227,0)
SELOPX Q TIUY
"RTN","TIUSROI1")
0^27^B40110118
"RTN","TIUSROI1",1,0)
TIUSROI1 ; SLC/JER - Reassign actions ; 03/02/2004
"RTN","TIUSROI1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**112**;Jun 20, 1997
"RTN","TIUSROI1",3,0)
 Q
"RTN","TIUSROI1",4,0)
FROMTO(TIUODA,TIUDA,TIUTNM) ; Display the from/to information
"RTN","TIUSROI1",5,0)
 N TIUF,TIUF12,TIUT,TIUT12,TIUFEDT,TIUFLDT,TIUTEDT,TIUTLDT
"RTN","TIUSROI1",6,0)
 D GETTIU^TIULD(.TIUF,+TIUODA)
"RTN","TIUSROI1",7,0)
 D GETTIU^TIULD(.TIUT,+TIUDA)
"RTN","TIUSROI1",8,0)
 S TIUFEDT=$$DATE^TIULS($P(TIUF("EDT"),U),"MM/DD/YY HR:MIN")
"RTN","TIUSROI1",9,0)
 S TIUFLDT=$$DATE^TIULS($P(TIUF("LDT"),U),"MM/DD/YY HR:MIN")
"RTN","TIUSROI1",10,0)
 S TIUTEDT=$$DATE^TIULS($P(TIUT("EDT"),U),"MM/DD/YY HR:MIN")
"RTN","TIUSROI1",11,0)
 S TIUTLDT=$$DATE^TIULS($P(TIUT("LDT"),U),"MM/DD/YY HR:MIN")
"RTN","TIUSROI1",12,0)
 S TIUF12=$G(^TIU(8925,TIUODA,12)),TIUT12=$G(^TIU(8925,TIUDA,12))
"RTN","TIUSROI1",13,0)
 W !!,"You are about to move the ",TIUTNM," as follows:",!
"RTN","TIUSROI1",14,0)
 W !,?5,"From",?45,"To",!
"RTN","TIUSROI1",15,0)
 W !,$P(TIUF("DOCTYP"),U,2),?35," --> ",?40,$P(TIUT("DOCTYP"),U,2)
"RTN","TIUSROI1",16,0)
 W !,TIUF("PNM")," ",TIUF("PID"),?35," --> ",?40,TIUT("PNM")," ",TIUT("PID")
"RTN","TIUSROI1",17,0)
 W !,TIUFEDT,$S(+TIUFLDT:" - "_TIUFLDT,1:""),?35," --> "
"RTN","TIUSROI1",18,0)
 W ?40,TIUTEDT,$S(+TIUTLDT:" - "_TIUTLDT,1:""),!
"RTN","TIUSROI1",19,0)
 W !," Dictated By: ",$$PERSNAME^TIULC1(+$P(TIUF12,U,2)),?35," --> "
"RTN","TIUSROI1",20,0)
 W ?40,$$PERSNAME^TIULC1(+$P(TIUF12,U,2))
"RTN","TIUSROI1",21,0)
 W !,"   Attending: ",$$PERSNAME^TIULC1(+$P(TIUF12,U,9)),?35," --> "
"RTN","TIUSROI1",22,0)
 W ?40,$$PERSNAME^TIULC1(+$P(TIUT12,U,9))
"RTN","TIUSROI1",23,0)
 W !,"Surg. Case #: ",+$P($G(^TIU(8925,TIUODA,14)),U,5),?35," --> "
"RTN","TIUSROI1",24,0)
 W ?40,+$P($G(^TIU(8925,TIUDA,14)),U,5),!
"RTN","TIUSROI1",25,0)
 Q +$$READ^TIUU("YA"," ... Ok? ","NO")
"RTN","TIUSROI1",26,0)
ANES(TIUDA) ; Roll back ANESTHESIA REPORT when TIU changes require it
"RTN","TIUSROI1",27,0)
 N SRODA S SRODA=+$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIUSROI1",28,0)
 Q:+SRODA'>0
"RTN","TIUSROI1",29,0)
 D ANES^SROTIUD(SRODA)
"RTN","TIUSROI1",30,0)
 Q
"RTN","TIUSROI1",31,0)
NURS(TIUDA) ; Roll back NURSE INTRAOPERATIVE REPORT when TIU changes require it
"RTN","TIUSROI1",32,0)
 N SRODA S SRODA=+$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIUSROI1",33,0)
 Q:+SRODA'>0
"RTN","TIUSROI1",34,0)
 D NURS^SROTIUD(SRODA)
"RTN","TIUSROI1",35,0)
 Q
"RTN","TIUSROI1",36,0)
RETRACT(TIUDA) ;
"RTN","TIUSROI1",37,0)
 N CNT,TITLE,TIUACT,TIUDATA
"RTN","TIUSROI1",38,0)
 S TIUDATA="ANESTHESIA REPORTS^NURSE INTRAOPERATIVE REPORTS^OPERATION REPORTS^PROCEDURE REPORT (NON-O.R.)"
"RTN","TIUSROI1",39,0)
 F CNT=1:1:$L(TIUDATA,U) S TITLE=$P(TIUDATA,U,CNT) I $$BELONGS^TIULX(TIUDA,$$FIND1^DIC(8925.1,"","BX",TITLE)) D
"RTN","TIUSROI1",40,0)
 . S TIUACT=$S(CNT=1:"ANES^TIUSROI1(TIUDA)",CNT=2:"NURS^TIUSROI1(TIUDA)",CNT=3:"RBOR^TIUSROI(TIUDA)",CNT=4:"RBPR^TIUSROI(TIUDA)")
"RTN","TIUSROI1",41,0)
 . D @TIUACT
"RTN","TIUSROI1",42,0)
 Q
"RTN","TIUSROI1",43,0)
CHANGE(TIUDA) ; Redirect the TIU Document to a different Surgical Case
"RTN","TIUSROI1",44,0)
 N DFN,SROVP,TIUD0,TIUD14,TIUNDA,TIUACT
"RTN","TIUSROI1",45,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD14=$G(^(14)),SROVP=$P(TIUD14,U,5)
"RTN","TIUSROI1",46,0)
 S DFN=$P(TIUD0,U,2) Q:+DFN'>0
"RTN","TIUSROI1",47,0)
 ; choose destination case
"RTN","TIUSROI1",48,0)
 W ! S SROVP=$$GETCASE^TIUSROI(DFN)
"RTN","TIUSROI1",49,0)
 ; if no case is selected, quit
"RTN","TIUSROI1",50,0)
 I +SROVP'>0 D  Q
"RTN","TIUSROI1",51,0)
 . W !!,$C(7),"Okay, no harm done...",!
"RTN","TIUSROI1",52,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",53,0)
 ; if target case is same as current, quit
"RTN","TIUSROI1",54,0)
 I +SROVP=+$P(TIUD14,U,5) D  Q
"RTN","TIUSROI1",55,0)
 . W !!,$C(7),"You've selected the original case. No changes made.",!
"RTN","TIUSROI1",56,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",57,0)
 ; Get the document for the target surgical case
"RTN","TIUSROI1",58,0)
 S TIUNDA=$$TARGET(SROVP)
"RTN","TIUSROI1",59,0)
 ; if target document is of a different type than source, quit
"RTN","TIUSROI1",60,0)
 I $$TYPE(TIUNDA)'=$$TYPE(TIUDA) D  Q
"RTN","TIUSROI1",61,0)
 . W !!,$C(7),"Incompatible document type. No changes made.",!
"RTN","TIUSROI1",62,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",63,0)
 ; if target case has empty report, replace
"RTN","TIUSROI1",64,0)
 I +$$EMPTYDOC^TIULF(TIUNDA) D  Q
"RTN","TIUSROI1",65,0)
 . W !!,"Moving document ",TIUDA," to Surgical Case #",+SROVP,"...",!
"RTN","TIUSROI1",66,0)
 . I '+$$READ^TIUU("YA","Are you sure? ","NO") Q
"RTN","TIUSROI1",67,0)
 . D REPLACE(TIUDA,TIUNDA)
"RTN","TIUSROI1",68,0)
 ; else, ask whether to swap or replace
"RTN","TIUSROI1",69,0)
 S TIUACT=$$ASKACT($$TITLE(TIUNDA))
"RTN","TIUSROI1",70,0)
 I $P(TIUACT,U)="E"!($P(TIUACT,U)="") D  Q
"RTN","TIUSROI1",71,0)
 . W !!,"Great. No harm done.",!
"RTN","TIUSROI1",72,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",73,0)
 I $P(TIUACT,U)="R" D  Q
"RTN","TIUSROI1",74,0)
 . W !!,"Replacing ",$$TITLE(TIUNDA)," on Surgical Case #",+SROVP,"...",!
"RTN","TIUSROI1",75,0)
 . I '+$$READ^TIUU("YA","Are you sure? ","NO") Q
"RTN","TIUSROI1",76,0)
 . D REPLACE(TIUDA,TIUNDA)
"RTN","TIUSROI1",77,0)
 I $P(TIUACT,U)="S" D
"RTN","TIUSROI1",78,0)
 . W !!,"Swapping with ",$$TITLE(TIUNDA)," on Surgical Case #",+SROVP,"...",!
"RTN","TIUSROI1",79,0)
 . I '+$$READ^TIUU("YA","Are you sure? ","NO") Q
"RTN","TIUSROI1",80,0)
 . D SWAP(TIUDA,TIUNDA)
"RTN","TIUSROI1",81,0)
 Q
"RTN","TIUSROI1",82,0)
ASKACT(TITLE) ; ask user to choose replace or swap
"RTN","TIUSROI1",83,0)
 N TIUY,TIUSET S TIUY=""
"RTN","TIUSROI1",84,0)
 W !!,"Please choose the appropriate action for this "_TITLE_":"
"RTN","TIUSROI1",85,0)
 S TIUSET="R:replace target document with this document"
"RTN","TIUSROI1",86,0)
 S TIUSET=TIUSET_";S:swap target document with this document"
"RTN","TIUSROI1",87,0)
 S TIUSET=TIUSET_";E:exit and do nothing"
"RTN","TIUSROI1",88,0)
 S TIUY=$$READ^TIUU("S^"_TIUSET,"Select Action","exit")
"RTN","TIUSROI1",89,0)
 Q TIUY
"RTN","TIUSROI1",90,0)
TITLE(TIUDA) ; resolve title of document
"RTN","TIUSROI1",91,0)
 Q $P($G(^TIU(8925.1,+$G(^TIU(8925,TIUDA,0)),0)),U)
"RTN","TIUSROI1",92,0)
TYPE(TIUDA) ; identifies type of document (i.e., Op Report or Proc Report)
"RTN","TIUSROI1",93,0)
 N TIUY,TIUCOR,TIUCPR S TIUY=""
"RTN","TIUSROI1",94,0)
 S TIUCOR=+$$CLASS^TIUSROI("OPERATION REPORTS")
"RTN","TIUSROI1",95,0)
 S TIUCPR=+$$CLASS^TIUSROI("PROCEDURE REPORT (NON-O.R.)")
"RTN","TIUSROI1",96,0)
 I +$$ISA^TIULX(+$G(^TIU(8925,TIUDA,0)),TIUCOR) S TIUY="OS" I 1
"RTN","TIUSROI1",97,0)
 E  I +$$ISA^TIULX(+$G(^TIU(8925,TIUDA,0)),TIUCPR) S TIUY="PR"
"RTN","TIUSROI1",98,0)
 Q TIUY
"RTN","TIUSROI1",99,0)
TARGET(TIUCASE) ; Get report ien for case
"RTN","TIUSROI1",100,0)
 N TIUI,TIUNDA,TIUCOR,TIUCPR S (TIUI,TIUNDA)=0
"RTN","TIUSROI1",101,0)
 S TIUCOR=+$$CLASS^TIUSROI("OPERATION REPORTS")
"RTN","TIUSROI1",102,0)
 S TIUCPR=+$$CLASS^TIUSROI("PROCEDURE REPORT (NON-O.R.)")
"RTN","TIUSROI1",103,0)
 F  S TIUI=$O(^TIU(8925,"G",TIUCASE,TIUI)) Q:+TIUI'>0  D  Q:+TIUNDA
"RTN","TIUSROI1",104,0)
 . I +$$ISA^TIULX(+$G(^TIU(8925,TIUI,0)),TIUCOR) S TIUNDA=TIUI Q
"RTN","TIUSROI1",105,0)
 . I +$$ISA^TIULX(+$G(^TIU(8925,TIUI,0)),TIUCPR) S TIUNDA=TIUI
"RTN","TIUSROI1",106,0)
 Q TIUNDA
"RTN","TIUSROI1",107,0)
REPLACE(TIUDA1,TIUDA2) ; Replace TIUDA2 with TIUDA1
"RTN","TIUSROI1",108,0)
 N SRODA1,SRODA2,TIUD01,TIUD02,TIUD141,TIUD142,TIUTYPE
"RTN","TIUSROI1",109,0)
 S TIUD01=$G(^TIU(8925,TIUDA1,0)),TIUD02=$G(^TIU(8925,TIUDA2,0))
"RTN","TIUSROI1",110,0)
 I +TIUD01'=+TIUD02 D  Q
"RTN","TIUSROI1",111,0)
 . W !!,$C(7),"The two documents are of different types. No changes made.",!
"RTN","TIUSROI1",112,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",113,0)
 S TIUD141=$G(^TIU(8925,TIUDA1,14)),SRODA1=+$P(TIUD141,U,5)
"RTN","TIUSROI1",114,0)
 S TIUD142=$G(^TIU(8925,TIUDA2,14)),SRODA2=+$P(TIUD142,U,5)
"RTN","TIUSROI1",115,0)
 ; 1. Swap comments for TIUDA1 and TIUDA2
"RTN","TIUSROI1",116,0)
 D SWAPCOMM(TIUDA1,TIUDA2)
"RTN","TIUSROI1",117,0)
 ; 2. Redirect TIUDA1 to TIUDA2's surgical case
"RTN","TIUSROI1",118,0)
 D RDTIU(TIUDA1,SRODA2)
"RTN","TIUSROI1",119,0)
 ; 3. Redirect TIUDA2's surgical case to TIUDA1
"RTN","TIUSROI1",120,0)
 D RDSURG(SRODA2,TIUDA1)
"RTN","TIUSROI1",121,0)
 ; 4. Delete or Retract TIUDA2
"RTN","TIUSROI1",122,0)
 I +$P(TIUD02,U,5)<6 D DIK^TIURB2(TIUDA2,1) I 1
"RTN","TIUSROI1",123,0)
 E  S TIUDA2=$$RETRACT^TIURD2(DA,"",14)
"RTN","TIUSROI1",124,0)
 ; 5. Rollback SRODA1 (create new stub)
"RTN","TIUSROI1",125,0)
 S TIUTYPE=$$TYPE(TIUDA1)
"RTN","TIUSROI1",126,0)
 I TIUTYPE="OS" D OS^SROTIUD(SRODA1) I 1
"RTN","TIUSROI1",127,0)
 E  I TIUTYPE="PR" D NON^SROTIUD(SRODA1)
"RTN","TIUSROI1",128,0)
 Q
"RTN","TIUSROI1",129,0)
SWAP(TIUDA1,TIUDA2) ; Swap TIUDA1 with TIUDA2
"RTN","TIUSROI1",130,0)
 N SRODA1,SRODA2,TIUD01,TIUD02,TIUD141,TIUD142
"RTN","TIUSROI1",131,0)
 S TIUD01=$G(^TIU(8925,TIUDA1,0)),TIUD02=$G(^TIU(8925,TIUDA2,0))
"RTN","TIUSROI1",132,0)
 I +TIUD01'=+TIUD02 D  Q
"RTN","TIUSROI1",133,0)
 . W !!,$C(7),"The two documents are of different types. No changes made.",!
"RTN","TIUSROI1",134,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",135,0)
 S TIUD141=$G(^TIU(8925,TIUDA1,14)),SRODA1=+$P(TIUD141,U,5)
"RTN","TIUSROI1",136,0)
 S TIUD142=$G(^TIU(8925,TIUDA2,14)),SRODA2=+$P(TIUD142,U,5)
"RTN","TIUSROI1",137,0)
 ; 1. Redirect TIUDA1 to TIUDA2's surgical case
"RTN","TIUSROI1",138,0)
 D RDTIU(TIUDA1,SRODA2)
"RTN","TIUSROI1",139,0)
 ; 2. Redirect TIUDA2 to TIUDA1's surgical case
"RTN","TIUSROI1",140,0)
 D RDTIU(TIUDA2,SRODA1)
"RTN","TIUSROI1",141,0)
 ; 3. Redirect TIUDA1's surgical case to TIUDA2
"RTN","TIUSROI1",142,0)
 D RDSURG(SRODA1,TIUDA2)
"RTN","TIUSROI1",143,0)
 ; 4. Redirect TIUDA2's surgical case to TIUDA1
"RTN","TIUSROI1",144,0)
 D RDSURG(SRODA2,TIUDA1)
"RTN","TIUSROI1",145,0)
 ; 5. Swap comments for TIUDA1 and TIUDA2
"RTN","TIUSROI1",146,0)
 D SWAPCOMM(TIUDA1,TIUDA2)
"RTN","TIUSROI1",147,0)
 Q
"RTN","TIUSROI1",148,0)
RDSURG(SRODA,TIUDA) ; Redirect surgical case to new document
"RTN","TIUSROI1",149,0)
 N DA,DIE,DR,TIUTYP S TIUTYP=$$TYPE(TIUDA) Q:TIUTYP']""
"RTN","TIUSROI1",150,0)
 S DIE=130,DA=SRODA,DR=$S(TIUTYP="OS":1000,TIUTYP="PR":1002,1:"")
"RTN","TIUSROI1",151,0)
 S DR=DR_"////^S X=TIUDA" D ^DIE
"RTN","TIUSROI1",152,0)
 Q
"RTN","TIUSROI1",153,0)
RDTIU(TIUDA,SRODA) ; Redirect document to new surgical case
"RTN","TIUSROI1",154,0)
 N DA,DIE,DR,SROVP S SROVP=SRODA_";SRF("
"RTN","TIUSROI1",155,0)
 S DIE=8925,DA=TIUDA,DR="1405////^S X=SROVP" D ^DIE
"RTN","TIUSROI1",156,0)
 Q
"RTN","TIUSROI1",157,0)
SWAPCOMM(TIUDA1,TIUDA2) ; Swap the comments field for two TIU Documents
"RTN","TIUSROI1",158,0)
 N DA,DIE,DR,COMM1,COMM2
"RTN","TIUSROI1",159,0)
 S COMM1=$G(^TIU(8925,TIUDA1,17)),COMM2=$G(^TIU(8925,TIUDA2,17))
"RTN","TIUSROI1",160,0)
 S DA=TIUDA1,DIE=8925,DR="1701////^S X=COMM2" D ^DIE
"RTN","TIUSROI1",161,0)
 S DA=TIUDA2,DIE=8925,DR="1701////^S X=COMM1" D ^DIE
"RTN","TIUSROI1",162,0)
 Q
"RTN","TIUSRV")
0^3^B70831969
"RTN","TIUSRV",1,0)
TIUSRV ; SLC/JER - Silent server functions ;11/01/03
"RTN","TIUSRV",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,19,28,87,61,100,109,113,112**;Jun 20, 1997
"RTN","TIUSRV",3,0)
RPC(TIUY,TIUDA,REASSIGN) ; RPC for DT
"RTN","TIUSRV",4,0)
 N VALMAR,TIUGDATA,TIUGWHOL K ^TMP("TIUAUDIT",$J)
"RTN","TIUSRV",5,0)
 S TIUY=$NA(^TMP("TIUAUDIT",$J))
"RTN","TIUSRV",6,0)
 D GET(TIUDA,1,+$G(REASSIGN))
"RTN","TIUSRV",7,0)
 K ^TMP("VALM VIDEO",$J)
"RTN","TIUSRV",8,0)
 Q
"RTN","TIUSRV",9,0)
GET(TIUDA,HUSH,REASSIGN) ; Build List
"RTN","TIUSRV",10,0)
 N TIUI,TIUL,TIUREC,TIUDADD,X,TIUCPF,ONBROWSE
"RTN","TIUSRV",11,0)
 S (TIUDADD,TIUI,VALMCNT)=0,HUSH=+$G(HUSH)
"RTN","TIUSRV",12,0)
 N DA,DIC,DIQ,DR,TIUNAME K ^TMP("TIUAUDIT",$J)
"RTN","TIUSRV",13,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUSRV",14,0)
 I '$D(IOINORM) S X="IOINORM;IOIHI;IORVON;IORVOFF;IOUON;IOUOFF;IOBON;IOBOFF" D ENDR^%ZISS
"RTN","TIUSRV",15,0)
 S:'$D(VALMAR) VALMAR="^TMP(""TIUAUDIT"",$J)"
"RTN","TIUSRV",16,0)
 S VALMEVL=+$G(VALMEVL)
"RTN","TIUSRV",17,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUSRV",18,0)
 ; if the document has an OnBrowse Event, execute it
"RTN","TIUSRV",19,0)
 S ONBROWSE=$$ONBROWSE^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUSRV",20,0)
 I $L(ONBROWSE) D LOADSUPP(ONBROWSE,TIUDA,.VALMCNT)
"RTN","TIUSRV",21,0)
 ;Set a flag to indicate whether or not a Title is a member of the
"RTN","TIUSRV",22,0)
 ;Clinical Procedures Class (1=Yes and 0=No)
"RTN","TIUSRV",23,0)
 S TIUCPF=+$$ISA^TIULX(+$G(^TIU(8925,TIUDA,0)),+$$CLASS^TIUCP)
"RTN","TIUSRV",24,0)
 S DIC=8925,DIQ="TIUREC(",DA=TIUDA
"RTN","TIUSRV",25,0)
 S DR=".01;.02;.05;.07:.1;1201;1202;1204;1208;1212;1301;1302;1305;1306;1501;1502;1505;1507;1508;1511;1601:1602;1610:1612;1701"
"RTN","TIUSRV",26,0)
 ;If the document is a member of the Clinical Procedures Class, include the
"RTN","TIUSRV",27,0)
 ;Procedure Summary Code field and the Date/Time Performed field
"RTN","TIUSRV",28,0)
 I TIUCPF S DR=DR_";70201;70202"
"RTN","TIUSRV",29,0)
 D EN^DIQ1
"RTN","TIUSRV",30,0)
 S TIUI="" F  S TIUI=$O(TIUREC(8925,+TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",31,0)
 . I $G(TIUREC(8925,+TIUDA,TIUI))']"" S TIUREC(8925,+TIUDA,TIUI)="None"
"RTN","TIUSRV",32,0)
 . E  S TIUREC(8925,+TIUDA,TIUI)=$$UP^XLFSTR(TIUREC(8925,+TIUDA,TIUI))
"RTN","TIUSRV",33,0)
 I $D(TIUREC)>9 D
"RTN","TIUSRV",34,0)
 . D SOURCE(.TIUREC,HUSH,.VALMCNT,TIUCPF)
"RTN","TIUSRV",35,0)
 . D:'+$G(REASSIGN) PROBLEM(TIUDA,.VALMCNT),EDIT(TIUDA,.VALMCNT)
"RTN","TIUSRV",36,0)
 . D REASSIGN^TIUSRV1(TIUDA,+$G(REASSIGN),.VALMCNT) Q:+$G(REASSIGN)
"RTN","TIUSRV",37,0)
 . D IDLINK^TIUSRV1(TIUDA,.VALMCNT)
"RTN","TIUSRV",38,0)
 . D SIGN(.TIUREC,.VALMCNT)
"RTN","TIUSRV",39,0)
 . I +$O(^TIU(8925.7,"B",TIUDA,0)) D XTRASIGN(TIUDA,.VALMCNT)
"RTN","TIUSRV",40,0)
 . I $D(^TIU(8925,+TIUDA,16)) D PRIVACY(.TIUREC,.VALMCNT)
"RTN","TIUSRV",41,0)
 . D BODY(TIUDA,.VALMCNT)
"RTN","TIUSRV",42,0)
 S:+$G(VALMCNT)<$G(VALM("LINES")) VALMCNT=$G(VALM("LINES"))
"RTN","TIUSRV",43,0)
 Q
"RTN","TIUSRV",44,0)
LOADSUPP(METHOD,TIUDA,TIUL)     ; Execute OnBrowse/Load Supplementary data
"RTN","TIUSRV",45,0)
 N TIUY,TIUI S TIUI=0
"RTN","TIUSRV",46,0)
 X METHOD I '$D(@TIUY) Q
"RTN","TIUSRV",47,0)
 S TIUL=TIUL+1
"RTN","TIUSRV",48,0)
 D SET(TIUL,1,"Requesting Package Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",49,0)
 S TIUL=TIUL+1 D BLANK(TIUL)
"RTN","TIUSRV",50,0)
 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",51,0)
 . S TIUL=+$G(TIUL)+1 D SET(TIUL,1,@TIUY@(TIUI))
"RTN","TIUSRV",52,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",53,0)
 K @TIUY
"RTN","TIUSRV",54,0)
 Q
"RTN","TIUSRV",55,0)
SOURCE(TIUREC,HUSH,TIUL,TIUCPF) ; Source Info
"RTN","TIUSRV",56,0)
 ;S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",57,0)
 W:'+$G(HUSH) !!,"Opening "_TIUREC(8925,+TIUDA,.01)_" record for review..."
"RTN","TIUSRV",58,0)
 D SET(TIUL,1,"Source Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",59,0)
 D SET(TIUL+1,2," Reference Date: "_$G(TIUREC(8925,TIUDA,1301)))
"RTN","TIUSRV",60,0)
 D SET(TIUL+2,2,"     Entry Date: "_$G(TIUREC(8925,TIUDA,1201)))
"RTN","TIUSRV",61,0)
 D SET(TIUL+3,2,"Expected Signer: "_$G(TIUREC(8925,TIUDA,1204)))
"RTN","TIUSRV",62,0)
 D SET(TIUL+4,2,"        Urgency: "_$G(TIUREC(8925,TIUDA,.09)))
"RTN","TIUSRV",63,0)
 D SET(TIUL+5,2,"     Line Count: "_$G(TIUREC(8925,TIUDA,.1)))
"RTN","TIUSRV",64,0)
 D SET(TIUL+6,2,"       Division: "_$G(TIUREC(8925,TIUDA,1212)))
"RTN","TIUSRV",65,0)
 D SET(TIUL+7,2,"        Subject: "_$G(TIUREC(8925,TIUDA,1701)))
"RTN","TIUSRV",66,0)
 ;If the document is a member of the Clinical Procedures Class, include the
"RTN","TIUSRV",67,0)
 ;Procedure Summary Code field and the Date/Time Performed field
"RTN","TIUSRV",68,0)
 I $G(TIUCPF) D
"RTN","TIUSRV",69,0)
 . D BLANK(TIUL+8)
"RTN","TIUSRV",70,0)
 . D SET(TIUL+9,2,"Procedure Summary Code: "_$G(TIUREC(8925,TIUDA,70201)))
"RTN","TIUSRV",71,0)
 . D SET(TIUL+10,2,"   Date/Time Performed: "_$G(TIUREC(8925,TIUDA,70202)))
"RTN","TIUSRV",72,0)
 D SET(TIUL+1,40,"            Author: "_$G(TIUREC(8925,TIUDA,1202)))
"RTN","TIUSRV",73,0)
 D SET(TIUL+2,40,"        Entered By: "_$G(TIUREC(8925,TIUDA,1302)))
"RTN","TIUSRV",74,0)
 D SET(TIUL+3,40," Expected Cosigner: "_$G(TIUREC(8925,TIUDA,1208)))
"RTN","TIUSRV",75,0)
 D SET(TIUL+4,40,"   Document Status: "_$G(TIUREC(8925,TIUDA,.05)))
"RTN","TIUSRV",76,0)
 D SET(TIUL+5,40,"    TIU Document #: "_+$G(TIUDA))
"RTN","TIUSRV",77,0)
 S TIUL=$S(+$G(TIUCPF):TIUL+10,1:TIUL+6)
"RTN","TIUSRV",78,0)
 Q
"RTN","TIUSRV",79,0)
PROBLEM(TIUDA,TIUL) ; Problems
"RTN","TIUSRV",80,0)
 N TIUI,DR,DIC,DIQ,TIUPROB S TIUI=0
"RTN","TIUSRV",81,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",82,0)
 D SET(TIUL,1,"Associated Problems ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",83,0)
 I '+$O(^TIU(8925.9,"B",+TIUDA,0)) D SET(TIUL,25,"No linked problems.")
"RTN","TIUSRV",84,0)
 F  S TIUI=$O(^TIU(8925.9,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",85,0)
 . S DA=TIUI,DR=".02;.05",DIC="^TIU(8925.9,",DIQ="TIUPROB"
"RTN","TIUSRV",86,0)
 . D EN^DIQ1 Q:$D(TIUPROB)'>9
"RTN","TIUSRV",87,0)
 . S TIUL=TIUL+1
"RTN","TIUSRV",88,0)
 . D SET(TIUL,19,$$MIXED^TIULS($G(TIUPROB(8925.9,TIUI,.05))))
"RTN","TIUSRV",89,0)
 . D SET(TIUL,60,$G(TIUPROB(8925.9,TIUI,.02)))
"RTN","TIUSRV",90,0)
 Q
"RTN","TIUSRV",91,0)
EDIT(TIUDA,TIUL) ; Edits
"RTN","TIUSRV",92,0)
 N TIUI,DR,DIC,DIQ,TIUED S TIUI=0
"RTN","TIUSRV",93,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",94,0)
 D SET(TIUL,1,"Edit Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",95,0)
 I '+$O(^TIU(8925.5,"B",+TIUDA,0)) D SET(TIUL,22,"No edits since entry.")
"RTN","TIUSRV",96,0)
 F  S TIUI=$O(^TIU(8925.5,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",97,0)
 . S DA=TIUI,DR=".02:03",DIC="^TIU(8925.5,",DIQ="TIUED"
"RTN","TIUSRV",98,0)
 . D EN^DIQ1 Q:$D(TIUED)'>9!($G(TIUED(8925.5,TIUI,.02))']"")
"RTN","TIUSRV",99,0)
 . S TIUL=TIUL+1
"RTN","TIUSRV",100,0)
 . D SET(TIUL,2,"      Edit Date: "_$G(TIUED(8925.5,TIUI,.02)))
"RTN","TIUSRV",101,0)
 . D SET(TIUL,44,"     Edited By: "_$G(TIUED(8925.5,TIUI,.03)))
"RTN","TIUSRV",102,0)
 Q
"RTN","TIUSRV",103,0)
SIGN(TIUREC,TIUL) ; Signature
"RTN","TIUSRV",104,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",105,0)
 D SET(TIUL,1,"Signature Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",106,0)
 D SET(TIUL+1,2,"    Signed Date: "_$G(TIUREC(8925,TIUDA,1501)))
"RTN","TIUSRV",107,0)
 D SET(TIUL+3,2,"  Cosigned Date: "_$G(TIUREC(8925,TIUDA,1507)))
"RTN","TIUSRV",108,0)
 D SET(TIUL+1,40,"         Signed By: "_$G(TIUREC(8925,TIUDA,1502)))
"RTN","TIUSRV",109,0)
 D SET(TIUL+2,40,"    Signature Mode: "_$G(TIUREC(8925,TIUDA,1505)))
"RTN","TIUSRV",110,0)
 D SET(TIUL+3,40,"       Cosigned By: "_$G(TIUREC(8925,TIUDA,1508)))
"RTN","TIUSRV",111,0)
 D SET(TIUL+4,40,"  Cosignature Mode: "_$G(TIUREC(8925,TIUDA,1511)))
"RTN","TIUSRV",112,0)
 S TIUL=TIUL+4
"RTN","TIUSRV",113,0)
 Q
"RTN","TIUSRV",114,0)
XTRASIGN(TIUDA,TIUL) ; Additional signers
"RTN","TIUSRV",115,0)
 N TIUI,DA,DR,DIC,DIQ,TIUXTRA
"RTN","TIUSRV",116,0)
 S TIUI=0
"RTN","TIUSRV",117,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",118,0)
 D SET(TIUL,1,"Receipt Acknowledged By ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",119,0)
 F  S TIUI=$O(^TIU(8925.7,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",120,0)
 . S DA=TIUI,DR=".03:.08",DIC="^TIU(8925.7,",DIQ="TIUXTRA"
"RTN","TIUSRV",121,0)
 . D EN^DIQ1 Q:$D(TIUXTRA)'>9
"RTN","TIUSRV",122,0)
 . S TIUL=TIUL+1
"RTN","TIUSRV",123,0)
 . D SET(TIUL,2,"    Signed Date: "_$G(TIUXTRA(8925.7,DA,.04)))
"RTN","TIUSRV",124,0)
 . D SET(TIUL,40,"         Signed By: "_$G(TIUXTRA(8925.7,DA,.06)))
"RTN","TIUSRV",125,0)
 . S TIUL=TIUL+1
"RTN","TIUSRV",126,0)
 . D SET(TIUL,2,"Expected Signer: "_$G(TIUXTRA(8925.7,DA,.03)))
"RTN","TIUSRV",127,0)
 . D SET(TIUL,40,"    Signature Mode: "_$G(TIUXTRA(8925.7,DA,.08)))
"RTN","TIUSRV",128,0)
 Q
"RTN","TIUSRV",129,0)
PRIVACY(TIUREC,TIUL) ; Privacy Act
"RTN","TIUSRV",130,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",131,0)
 D SET(TIUL,1,"Privacy Act Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",132,0)
 S TIUL=TIUL+1
"RTN","TIUSRV",133,0)
 D SET(TIUL,2,"   Amended Date: "_$G(TIUREC(8925,TIUDA,1601)))
"RTN","TIUSRV",134,0)
 D SET(TIUL,40,"        Amended By: "_$G(TIUREC(8925,TIUDA,1602)))
"RTN","TIUSRV",135,0)
 S TIUL=TIUL+1
"RTN","TIUSRV",136,0)
 D SET(TIUL,2,"   Deleted Date: "_$G(TIUREC(8925,TIUDA,1611)))
"RTN","TIUSRV",137,0)
 D SET(TIUL,40,"        Deleted By: "_$G(TIUREC(8925,TIUDA,1610)))
"RTN","TIUSRV",138,0)
 S TIUL=TIUL+1
"RTN","TIUSRV",139,0)
 D SET(TIUL,2,"         Reason: "_$G(TIUREC(8925,TIUDA,1612)))
"RTN","TIUSRV",140,0)
 Q
"RTN","TIUSRV",141,0)
BODY(TIUDA,TIUL) ; body of document
"RTN","TIUSRV",142,0)
 N CANSEE
"RTN","TIUSRV",143,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",144,0)
 D SET(TIUL,1,"Document Body ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",145,0)
 S TIUL=TIUL+1 D BLANK(TIUL)
"RTN","TIUSRV",146,0)
 S CANSEE=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUSRV",147,0)
 I '+CANSEE D NOSEE(CANSEE,.TIUL) Q
"RTN","TIUSRV",148,0)
 ; D TEXT(TIUDA,.TIUL)
"RTN","TIUSRV",149,0)
 I '$D(TIUGDATA) S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIUSRV",150,0)
 D LOADREC^TIUBR1(TIUDA,.TIUL,TIUGDATA,$G(TIUGWHOL))
"RTN","TIUSRV",151,0)
 K ^TMP("TIU ADDENDUM",$J)
"RTN","TIUSRV",152,0)
 Q
"RTN","TIUSRV",153,0)
TEXT(TIUDA,TIUL) ; Get each component
"RTN","TIUSRV",154,0)
 ; 4/18/03 No longer called in TIU - now calls browse code
"RTN","TIUSRV",155,0)
 N TIUKID,TIUDADT,TIUI S TIUI=0
"RTN","TIUSRV",156,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",157,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRV",158,0)
 . S ^TMP("TIUAUDIT",$J,TIUL,0)=$G(^TIU(8925,+TIUDA,"TEXT",+TIUI,0))
"RTN","TIUSRV",159,0)
 I +$$ISADDNDM^TIULC1(+TIUDA) D  Q
"RTN","TIUSRV",160,0)
 . N TIULINE,TIUPARNT K ^TMP("TIU ADDENDUM",$J) S $P(TIULINE,"=",79)=""
"RTN","TIUSRV",161,0)
 . S ^TMP("TIU ADDENDUM",$J)=TIUDA
"RTN","TIUSRV",162,0)
 . D LOADSIG^TIUBR1(TIUDA,.TIUL)
"RTN","TIUSRV",163,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=""
"RTN","TIUSRV",164,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=TIULINE
"RTN","TIUSRV",165,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=""
"RTN","TIUSRV",166,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=" --- Original Document ---"
"RTN","TIUSRV",167,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=""
"RTN","TIUSRV",168,0)
 . S TIUPARNT=+$P(^TIU(8925,+TIUDA,0),U,6) D TEXT(TIUPARNT,.TIUL)
"RTN","TIUSRV",169,0)
 S TIUKID=0
"RTN","TIUSRV",170,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRV",171,0)
 . I +$$ISADDNDM^TIULC1(TIUKID)'>0 D TEXT(TIUKID,.TIUL)
"RTN","TIUSRV",172,0)
 I '$$ISCOMP(TIUDA) D LOADSIG^TIUBR1(TIUDA,.TIUL)
"RTN","TIUSRV",173,0)
 S TIUKID=0
"RTN","TIUSRV",174,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRV",175,0)
 . ; If acting on an addendum, don't show it again
"RTN","TIUSRV",176,0)
 . I +TIUKID=+$G(^TMP("TIU ADDENDUM",$J)) Q
"RTN","TIUSRV",177,0)
 . I +$$ISADDNDM^TIULC1(TIUKID) D LOADADD(TIUKID,.TIUL)
"RTN","TIUSRV",178,0)
 Q
"RTN","TIUSRV",179,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUSRV",180,0)
 N TIUY,TIUTYP
"RTN","TIUSRV",181,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUSRV",182,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUSRV",183,0)
 Q TIUY
"RTN","TIUSRV",184,0)
LOADADD(TIUDADD,TIUL) ; Load addenda
"RTN","TIUSRV",185,0)
 ; 4/18/03 No longer called in TIU - now calls browse code
"RTN","TIUSRV",186,0)
 N TIUDAUTH,TIUDATT,TIUJ,TIUSIG,TIUCSIG,CANSEE
"RTN","TIUSRV",187,0)
 S CANSEE=$$CANDO^TIULP(+TIUDADD,"VIEW")
"RTN","TIUSRV",188,0)
 S TIUJ=0,TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=" "
"RTN","TIUSRV",189,0)
 S TIUDADT=$$DATE^TIULS($P($G(^TIU(8925,+TIUDADD,13)),U),"MM/DD/YY")
"RTN","TIUSRV",190,0)
 S TIUL=TIUL+1,^TMP("TIUAUDIT",$J,TIUL,0)=TIUDADT_" ADDENDUM:"
"RTN","TIUSRV",191,0)
 I +CANSEE'>0 D  Q
"RTN","TIUSRV",192,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRV",193,0)
 . S ^TMP("TIUAUDIT",$J,TIUL,0)=$P(CANSEE,U,2)
"RTN","TIUSRV",194,0)
 F  S TIUJ=$O(^TIU(8925,+TIUDADD,"TEXT",TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUSRV",195,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRV",196,0)
 . S ^TMP("TIUAUDIT",$J,TIUL,0)=$G(^TIU(8925,+TIUDADD,"TEXT",TIUJ,0))
"RTN","TIUSRV",197,0)
 D LOADSIG^TIUBR1(TIUDADD,.TIUL)
"RTN","TIUSRV",198,0)
 Q
"RTN","TIUSRV",199,0)
NOSEE(CANSEE,TIUJ) ; When the user shouldn't see the data...
"RTN","TIUSRV",200,0)
 S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRV",201,0)
 D SET(TIUJ,2,$P(CANSEE,U,2))
"RTN","TIUSRV",202,0)
 Q
"RTN","TIUSRV",203,0)
SET(TIULINE,TIUCOL,TIUTEXT,ON,OFF) ; set display info in array
"RTN","TIUSRV",204,0)
 D:'$D(@VALMAR@(TIULINE,0)) BLANK(.TIULINE)
"RTN","TIUSRV",205,0)
 D SET^VALM10(.TIULINE,$$SETSTR^VALM1(.TIUTEXT,@VALMAR@(TIULINE,0),.TIUCOL,$L(TIUTEXT)))
"RTN","TIUSRV",206,0)
 D:$G(ON)]""!($G(OFF)]"") CNTRL^VALM10(.TIULINE,.TIUCOL,$L(TIUTEXT),$G(ON),$G(OFF))
"RTN","TIUSRV",207,0)
 W:'(TIULINE#5)&'+$G(HUSH) "."
"RTN","TIUSRV",208,0)
 Q
"RTN","TIUSRV",209,0)
 ;
"RTN","TIUSRV",210,0)
BLANK(TIULINE) ; blank line
"RTN","TIUSRV",211,0)
 D SET^VALM10(.TIULINE,$J("",80))
"RTN","TIUSRV",212,0)
 Q
"RTN","TIUSRV1")
0^4^B17032930
"RTN","TIUSRV1",1,0)
TIUSRV1 ; SLC/JER - More silent server functions ; 07/31/2002 12:22
"RTN","TIUSRV1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**61,100,112**;Jun 20, 1997
"RTN","TIUSRV1",3,0)
REASSIGN(TIUDA,REASSIGN,TIUL) ; Reassign Hx
"RTN","TIUSRV1",4,0)
 N TIUI,DR,DIC,DIQ,TIUREASS S TIUI=0
"RTN","TIUSRV1",5,0)
 I +$P(^TIU(8925,TIUDA,0),U,5)'=15,(+$G(REASSIGN)=0) Q
"RTN","TIUSRV1",6,0)
 S TIUL=TIUL+1 D BLANK^TIUSRV(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV1",7,0)
 D SET^TIUSRV(TIUL,2," Reassignment History ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV1",8,0)
 I '+$O(^TIU(8925.5,"AR",+TIUDA,0)) D
"RTN","TIUSRV1",9,0)
 . N TIUI
"RTN","TIUSRV1",10,0)
 . D SET^TIUSRV(TIUL,26,"Document Never Reassigned.")
"RTN","TIUSRV1",11,0)
 . F TIUI=(TIUL+1):1:16 S @VALMAR@(TIUI,0)=" "
"RTN","TIUSRV1",12,0)
 F  S TIUI=$O(^TIU(8925.5,"AR",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV1",13,0)
 . N DA S DA=0
"RTN","TIUSRV1",14,0)
 . F  S DA=$O(^TIU(8925.5,"AR",TIUDA,TIUI,DA)) Q:+DA'>0  D
"RTN","TIUSRV1",15,0)
 . . S DR="1.01:1.12",DIC="^TIU(8925.5,",DIQ="TIUREASS"
"RTN","TIUSRV1",16,0)
 . . D EN^DIQ1 Q:$D(TIUREASS)'>9!($G(TIUREASS(8925.5,DA,1.01))']"")
"RTN","TIUSRV1",17,0)
 . . S TIUCNT=+$G(TIUCNT)+1 I TIUCNT>1 S TIUL=TIUL+1 D BLANK^TIUSRV(TIUL)
"RTN","TIUSRV1",18,0)
 . . S TIUL=TIUL+1
"RTN","TIUSRV1",19,0)
 . . D SET^TIUSRV(TIUL,2,"  Reassign Date: "_$G(TIUREASS(8925.5,DA,1.01)))
"RTN","TIUSRV1",20,0)
 . . D SET^TIUSRV(TIUL,44," Reassigned By: "_$G(TIUREASS(8925.5,DA,1.02)))
"RTN","TIUSRV1",21,0)
 . . S TIUL=TIUL+1
"RTN","TIUSRV1",22,0)
 . . D SET^TIUSRV(TIUL,2,"        Patient: "_$G(TIUREASS(8925.5,DA,1.03)))
"RTN","TIUSRV1",23,0)
 . . D SET^TIUSRV(TIUL,44," --->           "_$G(TIUREASS(8925.5,DA,1.04)))
"RTN","TIUSRV1",24,0)
 . . S TIUL=TIUL+1
"RTN","TIUSRV1",25,0)
 . . D SET^TIUSRV(TIUL,2,"Visit Date/time: "_$G(TIUREASS(8925.5,DA,1.05)))
"RTN","TIUSRV1",26,0)
 . . D SET^TIUSRV(TIUL,44," --->           "_$G(TIUREASS(8925.5,DA,1.06)))
"RTN","TIUSRV1",27,0)
 . . S TIUL=TIUL+1
"RTN","TIUSRV1",28,0)
 . . D SET^TIUSRV(TIUL,2,"  Hosp Location: "_$G(TIUREASS(8925.5,DA,1.07)))
"RTN","TIUSRV1",29,0)
 . . D SET^TIUSRV(TIUL,44," --->           "_$G(TIUREASS(8925.5,DA,1.08)))
"RTN","TIUSRV1",30,0)
 . . S TIUL=TIUL+1
"RTN","TIUSRV1",31,0)
 . . D SET^TIUSRV(TIUL,2,"     Visit Type: "_$$UP^XLFSTR($G(TIUREASS(8925.5,DA,1.09))))
"RTN","TIUSRV1",32,0)
 . . D SET^TIUSRV(TIUL,44," --->           "_$$UP^XLFSTR($G(TIUREASS(8925.5,DA,1.1))))
"RTN","TIUSRV1",33,0)
 Q
"RTN","TIUSRV1",34,0)
IDLINK(TIUDA,TIUL) ; Show Attach/Detach Hx
"RTN","TIUSRV1",35,0)
 N TIUI S TIUI=0
"RTN","TIUSRV1",36,0)
 Q:'$$IDHX(TIUDA)
"RTN","TIUSRV1",37,0)
 S TIUL=TIUL+1 D BLANK^TIUSRV(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV1",38,0)
 D SET^TIUSRV(TIUL,1," Interdisciplinary Linkage History ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV1",39,0)
 S TIUL=TIUL+1 D BLANK^TIUSRV(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV1",40,0)
 D SET^TIUSRV(TIUL,0,"Date/Time         "_$S(+$G(^TIU(8925,+TIUDA,21)):"ID Parent",1:"Entry #  ")_"   Title                     Action    By") S TIUL=TIUL+1
"RTN","TIUSRV1",41,0)
 D SET^TIUSRV(TIUL,0,"----------------  ----------  ------------------------  --------  -------------")
"RTN","TIUSRV1",42,0)
 ; First, get events for ID Parents
"RTN","TIUSRV1",43,0)
 F  S TIUI=$O(^TIU(8925.5,"AID",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV1",44,0)
 . N TIUD0,TIUD3,TIUY,EVDT,ENTDA,ENTTL,ACTION,DOER
"RTN","TIUSRV1",45,0)
 . Q:'$L($G(^TIU(8925.5,TIUI,3)))
"RTN","TIUSRV1",46,0)
 . S TIUD0=$G(^TIU(8925.5,TIUI,0)),TIUD3=$G(^(3))
"RTN","TIUSRV1",47,0)
 . S ENTDA=+TIUD0
"RTN","TIUSRV1",48,0)
 . S ACTION=$P(TIUD3,U),ACTION=$S(ACTION="d":"detached",1:"attached")
"RTN","TIUSRV1",49,0)
 . S EVDT=$$DATE^TIULS($P(TIUD3,U,2),"MM/DD/CCYY HR:MIN")
"RTN","TIUSRV1",50,0)
 . S ENTTL=$$PNAME^TIULC1(+$G(^TIU(8925,ENTDA,0)))
"RTN","TIUSRV1",51,0)
 . S DOER=$$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIUD3,U,3)),"LAST,FI")
"RTN","TIUSRV1",52,0)
 . S TIUY="" S TIUY=$$SETSTR^VALM1(EVDT,TIUY,1,16)
"RTN","TIUSRV1",53,0)
 . S TIUY=$$SETSTR^VALM1(ENTDA,TIUY,19,10)
"RTN","TIUSRV1",54,0)
 . S TIUY=$$SETSTR^VALM1(ENTTL,TIUY,31,24)
"RTN","TIUSRV1",55,0)
 . S TIUY=$$SETSTR^VALM1(ACTION,TIUY,57,8)
"RTN","TIUSRV1",56,0)
 . S TIUY=$$SETSTR^VALM1(DOER,TIUY,67,14)
"RTN","TIUSRV1",57,0)
 . S TIUL=TIUL+1 D SET^TIUSRV(TIUL,0,TIUY)
"RTN","TIUSRV1",58,0)
 ; Next, get hx for ID Entries
"RTN","TIUSRV1",59,0)
 F  S TIUI=$O(^TIU(8925.5,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV1",60,0)
 . N TIUD0,TIUD3,TIUY,EVDT,ENTDA,IDDAD,IDTTL,ACTION,DOER
"RTN","TIUSRV1",61,0)
 . Q:'$L($G(^TIU(8925.5,TIUI,3)))
"RTN","TIUSRV1",62,0)
 . S TIUD0=$G(^TIU(8925.5,TIUI,0)),TIUD3=$G(^(3))
"RTN","TIUSRV1",63,0)
 . S ENTDA=+TIUD0,IDDAD=$P(TIUD3,U,5)
"RTN","TIUSRV1",64,0)
 . S ACTION=$P(TIUD3,U),ACTION=$S(ACTION="d":"detached",1:"attached")
"RTN","TIUSRV1",65,0)
 . S EVDT=$$DATE^TIULS($P(TIUD3,U,2),"MM/DD/CCYY HR:MIN")
"RTN","TIUSRV1",66,0)
 . S IDTTL=$$PNAME^TIULC1(+$G(^TIU(8925,IDDAD,0)))
"RTN","TIUSRV1",67,0)
 . S DOER=$$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIUD3,U,3)),"LAST,FI")
"RTN","TIUSRV1",68,0)
 . S TIUY="" S TIUY=$$SETSTR^VALM1(EVDT,TIUY,1,16)
"RTN","TIUSRV1",69,0)
 . S TIUY=$$SETSTR^VALM1(IDDAD,TIUY,19,10)
"RTN","TIUSRV1",70,0)
 . S TIUY=$$SETSTR^VALM1(IDTTL,TIUY,31,24)
"RTN","TIUSRV1",71,0)
 . S TIUY=$$SETSTR^VALM1(ACTION,TIUY,57,8)
"RTN","TIUSRV1",72,0)
 . S TIUY=$$SETSTR^VALM1(DOER,TIUY,67,14)
"RTN","TIUSRV1",73,0)
 . S TIUL=TIUL+1 D SET^TIUSRV(TIUL,0,TIUY)
"RTN","TIUSRV1",74,0)
 Q
"RTN","TIUSRV1",75,0)
IDHX(TIUDA) ; Boolean fn to evaluate whether ID history exists
"RTN","TIUSRV1",76,0)
 N TIUI,TIUY S TIUY=0
"RTN","TIUSRV1",77,0)
 S TIUI=0
"RTN","TIUSRV1",78,0)
 F  S TIUI=$O(^TIU(8925.5,"B",TIUDA,TIUI)) Q:+TIUI'>0  D  Q:+TIUY
"RTN","TIUSRV1",79,0)
 . S:$L($G(^TIU(8925.5,TIUI,3))) TIUY=1
"RTN","TIUSRV1",80,0)
 S TIUI=0
"RTN","TIUSRV1",81,0)
 F  S TIUI=$O(^TIU(8925.5,"AID",TIUDA,TIUI)) Q:+TIUI'>0  D  Q:+TIUY
"RTN","TIUSRV1",82,0)
 . S:$L($G(^TIU(8925.5,TIUI,3))) TIUY=1
"RTN","TIUSRV1",83,0)
IDHXX Q TIUY
"RTN","TIUSRVD")
0^16^B41088251
"RTN","TIUSRVD",1,0)
TIUSRVD ; SLC/JER - RPC's for document definition ; 09/12/2003
"RTN","TIUSRVD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,7,22,47,103,100,115,164,112**;Jun 20, 1997
"RTN","TIUSRVD",3,0)
NOTES(TIUY) ; Get list of PN Titles
"RTN","TIUSRVD",4,0)
 D LIST(.TIUY,3)
"RTN","TIUSRVD",5,0)
 Q
"RTN","TIUSRVD",6,0)
SUMMARY(TIUY) ; Get list of DS Titles
"RTN","TIUSRVD",7,0)
 D LIST(.TIUY,244)
"RTN","TIUSRVD",8,0)
 Q
"RTN","TIUSRVD",9,0)
LIST(TIUY,CLASS,TYPE,TIUK) ; Get list of document titles
"RTN","TIUSRVD",10,0)
 N TIUDFLT
"RTN","TIUSRVD",11,0)
 ; TIUK is STATIC
"RTN","TIUSRVD",12,0)
 S TIUK=+$G(TIUK)
"RTN","TIUSRVD",13,0)
 I $G(TYPE)']"" S TYPE="DOC"
"RTN","TIUSRVD",14,0)
 ; If the user has a preferred list of titles for the CLASS, get it
"RTN","TIUSRVD",15,0)
 I +$O(^TIU(8925.98,"AC",DUZ,CLASS,0)) D PERSLIST(.TIUY,DUZ,CLASS,.TIUK,1)
"RTN","TIUSRVD",16,0)
 S TIUK=+$G(TIUK)+1 S TIUY(TIUK)="~LONG LIST"
"RTN","TIUSRVD",17,0)
 D TRAVERSE(.TIUY,CLASS,$G(TYPE),.TIUK)
"RTN","TIUSRVD",18,0)
 S TIUDFLT=$$PERSDOC^TIULE(DUZ,+CLASS)
"RTN","TIUSRVD",19,0)
 I +TIUDFLT S TIUK=+$G(TIUK)+1,TIUY(TIUK)="d"_$P(TIUDFLT,U,2)
"RTN","TIUSRVD",20,0)
 Q
"RTN","TIUSRVD",21,0)
TRAVERSE(TIUY,CLASS,TYPE,TIUK) ; Get all selectable titles for the CLASS
"RTN","TIUSRVD",22,0)
 N I,J,X,CURTYP,Y,TIUI,TIUC,TYPMATCH S (TIUC,TIUI)=0
"RTN","TIUSRVD",23,0)
 S TIUK=+$G(TIUK)
"RTN","TIUSRVD",24,0)
 I $S(+$$CANENTR^TIULP(CLASS)'>0:1,+$$CANPICK^TIULP(CLASS)'>0:1,1:0) Q
"RTN","TIUSRVD",25,0)
 S CURTYP=$P(^TIU(8925.1,+CLASS,0),U,4)
"RTN","TIUSRVD",26,0)
 S TYPMATCH=$$TYPMATCH^TIULA1(TYPE,CURTYP)
"RTN","TIUSRVD",27,0)
 I +TYPMATCH S TIUK=+$G(TIUK)+1
"RTN","TIUSRVD",28,0)
 I  S TIUY(TIUK)="i"_+CLASS_U_$$PNAME^TIULC1(+CLASS)
"RTN","TIUSRVD",29,0)
 S I=0 F  S I=$O(^TIU(8925.1,+CLASS,10,I)) Q:+I'>0  D
"RTN","TIUSRVD",30,0)
 . N J
"RTN","TIUSRVD",31,0)
 . S J=+$G(^TIU(8925.1,+CLASS,10,+I,0)) Q:+J'>0
"RTN","TIUSRVD",32,0)
 . D TRAVERSE(.TIUY,+J,TYPE,.TIUK)
"RTN","TIUSRVD",33,0)
 Q
"RTN","TIUSRVD",34,0)
PERSLIST(TIUY,DUZ,CLASS,TIUC,TIUFLG) ; Get personal list for a user
"RTN","TIUSRVD",35,0)
 N TIUI,TIUDA,TIUDFLT,NOTINLST S NOTINLST=0
"RTN","TIUSRVD",36,0)
 S TIUDA=+$O(^TIU(8925.98,"AC",DUZ,CLASS,0))
"RTN","TIUSRVD",37,0)
 Q:+TIUDA'>0
"RTN","TIUSRVD",38,0)
 I +$G(TIUFLG) S TIUC=1,TIUY(TIUC)="~SHORT LIST"
"RTN","TIUSRVD",39,0)
 S TIUI=0,TIUC=+$G(TIUC)
"RTN","TIUSRVD",40,0)
 F  S TIUI=$O(^TIU(8925.98,TIUDA,10,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",41,0)
 . N TIUPL,TIUTNM,TIUDTYP,TIUSEQ
"RTN","TIUSRVD",42,0)
 . S TIUPL=$G(^TIU(8925.98,TIUDA,10,TIUI,0))
"RTN","TIUSRVD",43,0)
 . S TIUDTYP=$P(TIUPL,U)
"RTN","TIUSRVD",44,0)
 . I $S(+$$CANENTR^TIULP(TIUDTYP)'>0:1,+$$CANPICK^TIULP(TIUDTYP)'>0:1,1:0) Q
"RTN","TIUSRVD",45,0)
 . S TIUTNM=$S($P(TIUPL,U,3)]"":$P(TIUPL,U,3),1:$$PNAME^TIULC1(+TIUDTYP))
"RTN","TIUSRVD",46,0)
 . S TIUSEQ=+$P(TIUPL,U,2),TIUC=+$G(TIUC)+1
"RTN","TIUSRVD",47,0)
 . S TIUSEQ=$S(+TIUSEQ:$S('$D(TIUY(TIUSEQ)):TIUSEQ,1:(TIUSEQ+1)),1:TIUC)
"RTN","TIUSRVD",48,0)
 . S TIUY(TIUSEQ)="i"_TIUDTYP_U_TIUTNM,TIUC=+TIUSEQ
"RTN","TIUSRVD",49,0)
 I +$G(TIUFLG) Q
"RTN","TIUSRVD",50,0)
 S TIUDFLT=$$PERSDOC^TIULE(DUZ,+CLASS)
"RTN","TIUSRVD",51,0)
 S (TIUI,TIUC)=0
"RTN","TIUSRVD",52,0)
 F  S TIUI=$O(TIUY(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",53,0)
 . S TIUC=TIUI
"RTN","TIUSRVD",54,0)
 . I +TIUDFLT,($P($G(TIUY(TIUI)),U)=("i"_+TIUDFLT)) S $P(TIUDFLT,U,2)=$P(TIUY(TIUI),U,2),NOTINLST=0
"RTN","TIUSRVD",55,0)
 . E  S NOTINLST=1
"RTN","TIUSRVD",56,0)
 I +TIUDFLT D
"RTN","TIUSRVD",57,0)
 . ;if default isn't in list, append it as an item
"RTN","TIUSRVD",58,0)
 . I NOTINLST S TIUC=+$G(TIUC)+1,TIUY(TIUC)="i"_TIUDFLT
"RTN","TIUSRVD",59,0)
 . ;otherwise, just append as default
"RTN","TIUSRVD",60,0)
 . S TIUC=+$G(TIUC)+1,TIUY(TIUC)="d"_TIUDFLT
"RTN","TIUSRVD",61,0)
 Q
"RTN","TIUSRVD",62,0)
BLRSHELL(TIUY,TITLE,DFN,VSTR) ; Shell for boilerplate RPC
"RTN","TIUSRVD",63,0)
 K ^TMP("TIUBOIL",$J)
"RTN","TIUSRVD",64,0)
 D BLRPLT(.TIUY,TITLE,DFN,$G(VSTR))
"RTN","TIUSRVD",65,0)
 K ^TMP("TIUBOIL",$J,0)
"RTN","TIUSRVD",66,0)
 Q
"RTN","TIUSRVD",67,0)
BLRPLT(TIUY,TITLE,DFN,VSTR,ROOT) ; Load/Execute the Boilerplate for TITLE
"RTN","TIUSRVD",68,0)
 ;                                 or ROOT
"RTN","TIUSRVD",69,0)
 N TIU,TIUI,TIUJ,TIUK,TIUL,VADM,VAIN,VA,VAERR S TIUI=0
"RTN","TIUSRVD",70,0)
 S:'$D(TIUY) TIUY=$NA(^TMP("TIUBOIL",$J))
"RTN","TIUSRVD",71,0)
 S:'$D(ROOT) ROOT=$NA(^TIU(8925.1,+TITLE,"DFLT")) ; **47**
"RTN","TIUSRVD",72,0)
 I $L($G(VSTR)) D PATVADPT^TIULV(.TIU,DFN,"",$G(VSTR)) ; **47**
"RTN","TIUSRVD",73,0)
 S TIUJ=+$P($G(^TMP("TIUBOIL",$J,0)),U,3)+1
"RTN","TIUSRVD",74,0)
 ; --- Set component header ---
"RTN","TIUSRVD",75,0)
 I ROOT["^TIU(8925.1," D
"RTN","TIUSRVD",76,0)
 . S ^TMP("TIUBOIL",$J,TIUJ,0)=$S($P($G(^TIU(8925.1,+TITLE,0)),U,4)="CO":$P(^TIU(8925.1,+TITLE,0),U)_":   ",1:"")
"RTN","TIUSRVD",77,0)
 I +TIUJ=1,($G(^TMP("TIUBOIL",$J,TIUJ,0))']"") K ^TMP("TIUBOIL",$J,TIUJ,0) S TIUJ=0
"RTN","TIUSRVD",78,0)
 S ^TMP("TIUBOIL",$J,0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIUSRVD",79,0)
 F  S TIUI=$O(@ROOT@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",80,0)
 . S TIUJ=TIUJ+1,X=$G(@ROOT@(TIUI,0))
"RTN","TIUSRVD",81,0)
 . I $L($T(DOLMLINE^TIUSRVF1)),'$D(XWBOS),(X["{FLD:") S X=$$DOLMLINE^TIUSRVF1(X)
"RTN","TIUSRVD",82,0)
 . I X["|" S X=$$BOIL(X,TIUJ)
"RTN","TIUSRVD",83,0)
 . I X["~@" D INSMULT(X,"^TMP(""TIUBOIL"",$J)",.TIUJ) I 1
"RTN","TIUSRVD",84,0)
 . E  S ^TMP("TIUBOIL",$J,TIUJ,0)=X
"RTN","TIUSRVD",85,0)
 . S ^TMP("TIUBOIL",$J,0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIUSRVD",86,0)
 I ROOT["^TIU(8925.1,",+$O(^TIU(8925.1,+TITLE,10,0)) D
"RTN","TIUSRVD",87,0)
 . N TIUFITEM,TIUI D ITEMS^TIUFLT(+TITLE)
"RTN","TIUSRVD",88,0)
 . S TIUI=0 F  S TIUI=$O(TIUFITEM(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",89,0)
 . . S TIUL=+$G(TIUFITEM(+TIUI)) D BLRPLT(.TIUY,TIUL,DFN,$G(VSTR))
"RTN","TIUSRVD",90,0)
 Q
"RTN","TIUSRVD",91,0)
BOIL(LINE,COUNT) ; Execute Boilerplates
"RTN","TIUSRVD",92,0)
 N TIUI,DIC,X,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUSRVD",93,0)
 S DIC=8925.1,DIC(0)="FMXZ"
"RTN","TIUSRVD",94,0)
 S DIC("S")="I $P($G(^TIU(8925.1,+Y,0)),U,4)=""O"""
"RTN","TIUSRVD",95,0)
 F TIUI=2:2:$L(LINE,"|") S X=$P(LINE,"|",TIUI) D
"RTN","TIUSRVD",96,0)
 . D ^DIC
"RTN","TIUSRVD",97,0)
 . I +Y'>0 S X="The OBJECT "_X_" was NOT found...Contact IRM."
"RTN","TIUSRVD",98,0)
 . I +Y>0 D
"RTN","TIUSRVD",99,0)
 . . I $D(^TIU(8925.1,+Y,9)),+$$CANXEC(+Y) X ^(9) S:$E(X,1,2)="~@" X=X_"~@" I 1
"RTN","TIUSRVD",100,0)
 . . E  S X="The OBJECT "_X_" is INACTIVE...Contact IRM."
"RTN","TIUSRVD",101,0)
 . S LINE=$$REPLACE(LINE,X,TIUI)
"RTN","TIUSRVD",102,0)
 Q $TR(LINE,"|","")
"RTN","TIUSRVD",103,0)
CANXEC(TIUODA) ; Evaluate Object Status
"RTN","TIUSRVD",104,0)
 N TIUOST,TIUY S TIUOST=+$P($G(^TIU(8925.1,+TIUODA,0)),U,7)
"RTN","TIUSRVD",105,0)
 S TIUY=$S(TIUOST=11:1,+$G(NOSAVE):1,1:0)
"RTN","TIUSRVD",106,0)
 Q +$G(TIUY)
"RTN","TIUSRVD",107,0)
REPLACE(LINE,X,TIUI) ; Replace the TIUIth object in LINE w/X
"RTN","TIUSRVD",108,0)
 S $P(LINE,"|",TIUI)=X
"RTN","TIUSRVD",109,0)
 Q LINE
"RTN","TIUSRVD",110,0)
INSMULT(LINE,TARGET,TIULCNT) ; Mult-valued results
"RTN","TIUSRVD",111,0)
 N TIUPC,TIULGTH
"RTN","TIUSRVD",112,0)
 ; TIU*1*164 ;
"RTN","TIUSRVD",113,0)
 S TIULGTH=73 ; 2 replacements of 73 below for TIULGTH
"RTN","TIUSRVD",114,0)
 S:$$BROKER^XWBLIB TIULGTH=80
"RTN","TIUSRVD",115,0)
 F TIUPC=2:2:$L(LINE,"~@") D
"RTN","TIUSRVD",116,0)
 . N TIUI,TIULINE,TIUX,TIUSRC,TIUSCNT,TIUTAIL
"RTN","TIUSRVD",117,0)
 . S TIUSRC=$P(LINE,"~@",TIUPC)
"RTN","TIUSRVD",118,0)
 . S TIUTAIL=$P(LINE,"~@",TIUPC+1)
"RTN","TIUSRVD",119,0)
 . S TIULINE=$P(LINE,"~@",(TIUPC-1)),(TIUI,TIUSCNT)=0
"RTN","TIUSRVD",120,0)
 . I $E(TIULINE)=" ",(TIUPC>2) S $E(TIULINE)=""
"RTN","TIUSRVD",121,0)
 . F  S TIUI=$O(@TIUSRC@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",122,0)
 . . N TIUSLINE
"RTN","TIUSRVD",123,0)
 . . S TIUSCNT=TIUSCNT+1
"RTN","TIUSRVD",124,0)
 . . S TIUSLINE=$G(@TIUSRC@(TIUI,0))
"RTN","TIUSRVD",125,0)
 . . S:'+$O(@TIUSRC@(TIUI))&(TIUPC+2>$L(LINE,"~@")) TIUSLINE=TIUSLINE_TIUTAIL
"RTN","TIUSRVD",126,0)
 . . I TIUSCNT=1,($L(TIULINE_TIUSLINE)>TIULGTH) D  Q
"RTN","TIUSRVD",127,0)
 . . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUSRVD",128,0)
 . . . S @TARGET@(TIULCNT,0)=TIULINE
"RTN","TIUSRVD",129,0)
 . . . S TIULCNT=TIULCNT+1
"RTN","TIUSRVD",130,0)
 . . . S @TARGET@(TIULCNT,0)=TIUSLINE
"RTN","TIUSRVD",131,0)
 . . I TIUSCNT=1,($L(TIULINE_TIUSLINE)'>TIULGTH) D  Q
"RTN","TIUSRVD",132,0)
 . . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUSRVD",133,0)
 . . . S @TARGET@(TIULCNT,0)=TIULINE_TIUSLINE
"RTN","TIUSRVD",134,0)
 . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUSRVD",135,0)
 . . S @TARGET@(TIULCNT,0)=$G(TIUSLINE)
"RTN","TIUSRVD",136,0)
 . K @TIUSRC
"RTN","TIUSRVD",137,0)
 Q
"RTN","TIUSRVD",138,0)
LNGCNSLT(Y,FROM,DIR) ; Handle long list of titles for CONSULTS
"RTN","TIUSRVD",139,0)
 N CLASS S CLASS=+$$CLASS^TIUCNSLT Q:+CLASS'>0
"RTN","TIUSRVD",140,0)
 D LONGLIST(.Y,CLASS,$G(FROM),$G(DIR,1))
"RTN","TIUSRVD",141,0)
 Q
"RTN","TIUSRVD",142,0)
LNGSURG(Y,FROM,DIR,CLNAME)      ; long list SURGICAL REPORT titles
"RTN","TIUSRVD",143,0)
 ; CLNAME = "SURGICAL REPORTS" or "PROCEDURE REPORTS (NON-O.R.)"
"RTN","TIUSRVD",144,0)
 ;           depending on context
"RTN","TIUSRVD",145,0)
 N CLASS S CLNAME=$S($G(CLNAME)]"":CLNAME,1:"OPERATION REPORTS")
"RTN","TIUSRVD",146,0)
 S CLASS=$$CLASS^TIUSROI(CLNAME) Q:+CLASS'>0
"RTN","TIUSRVD",147,0)
 D LONGLIST(.Y,CLASS,$G(FROM),$G(DIR,1))
"RTN","TIUSRVD",148,0)
 Q
"RTN","TIUSRVD",149,0)
LONGLIST(Y,CLASS,FROM,DIR,IDNOTE) ; long list of titles for a class
"RTN","TIUSRVD",150,0)
 ; .Y=returned list, CLASS=ptr to class in 8925.1, FROM=text to $O from,
"RTN","TIUSRVD",151,0)
 ; DIR=$O direction, IDNOTE=flag to indicate selection for ID Entry
"RTN","TIUSRVD",152,0)
 N I,DA,CNT S I=0,CNT=44,DIR=$G(DIR,1)
"RTN","TIUSRVD",153,0)
 F  Q:I'<CNT  S FROM=$O(^TIU(8925.1,"ACL",CLASS,FROM),DIR) Q:FROM=""  D
"RTN","TIUSRVD",154,0)
 . S DA=0
"RTN","TIUSRVD",155,0)
 . F  Q:I'<CNT  S DA=$O(^TIU(8925.1,"ACL",CLASS,FROM,DA)) Q:+DA'>0  D
"RTN","TIUSRVD",156,0)
 . . I $S(+$$CANENTR^TIULP(DA)'>0:1,+$$CANPICK^TIULP(DA)'>0:1,1:0) Q
"RTN","TIUSRVD",157,0)
 . . I +$L($T(CANLINK^TIULP)),+$G(IDNOTE),(+$$CANLINK^TIULP(DA)'>0) Q
"RTN","TIUSRVD",158,0)
 . . S I=I+1,Y(I)=DA_"^"_FROM
"RTN","TIUSRVD",159,0)
 Q
"RTN","TIUSRVD",160,0)
CNSLCLAS(Y) ; RPC to identify class CONSULTS
"RTN","TIUSRVD",161,0)
 S Y=$$CLASS^TIUCNSLT
"RTN","TIUSRVD",162,0)
 Q
"RTN","TIUSRVD",163,0)
SURGCLAS(Y,CLNAME) ; RPC to identify class 
"RTN","TIUSRVD",164,0)
 ; CLNAME = "SURGICAL REPORTS" or "PROCEDURE REPORTS (NON-O.R.)"
"RTN","TIUSRVD",165,0)
 S CLNAME=$G(CLNAME,"SURGICAL REPORTS")
"RTN","TIUSRVD",166,0)
 S Y=$$CLASS^TIUSROI(CLNAME)
"RTN","TIUSRVD",167,0)
 Q
"RTN","TIUSRVD",168,0)
CANLINK(Y,TIUTTL)       ; Wrap call to $$CANLINK^TIULP
"RTN","TIUSRVD",169,0)
 S Y=$$CANLINK^TIULP(TIUTTL)
"RTN","TIUSRVD",170,0)
 Q
"RTN","TIUSRVLR")
0^2^B2293640
"RTN","TIUSRVLR",1,0)
TIUSRVLR ; SLC/JER - TIU RPCs ; 02/25/04
"RTN","TIUSRVLR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**112**;Jun 20, 1997
"RTN","TIUSRVLR",3,0)
GETDOCS(TIUY,OVP,SEQUENCE) ; Get TIU Documents for a given Consult or
"RTN","TIUSRVLR",4,0)
 ; Surgical Case
"RTN","TIUSRVLR",5,0)
 N TIUDA,TIUI
"RTN","TIUSRVLR",6,0)
 ;Initialize vars
"RTN","TIUSRVLR",7,0)
 S (TIUDA,TIUI)=0,TIUY=$NA(^TMP("TIULIST",$J)) K @TIUY
"RTN","TIUSRVLR",8,0)
 S SEQUENCE=$S($G(SEQUENCE)]"":$G(SEQUENCE),1:"D")
"RTN","TIUSRVLR",9,0)
 ;Loop through "G" X-ref in 8925 to find associated documents
"RTN","TIUSRVLR",10,0)
 F  S TIUDA=$O(^TIU(8925,"G",OVP,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUSRVLR",11,0)
 . S TIUI=TIUI+1
"RTN","TIUSRVLR",12,0)
 . ; Cross-check value of field 1405 with x-ref value
"RTN","TIUSRVLR",13,0)
 . I OVP'=$P($G(^TIU(8925,TIUDA,14)),U,5) Q
"RTN","TIUSRVLR",14,0)
 . ; If a document is an ID Entry, get its parent
"RTN","TIUSRVLR",15,0)
 . ; I +$G(^TIU(8925,TIUDA,21)) S TIUDA=+$G(^TIU(8925,TIUDA,21))
"RTN","TIUSRVLR",16,0)
 . ; Don't include entry in list more than once
"RTN","TIUSRVLR",17,0)
 . I +$O(@TIUY@("INDX",TIUDA,0)) Q
"RTN","TIUSRVLR",18,0)
 . ; Don't include entry in list if RETRACTED
"RTN","TIUSRVLR",19,0)
 . I $P($G(^TIU(8925,TIUDA,0)),U,5)=15 Q
"RTN","TIUSRVLR",20,0)
 . S @TIUY@(TIUI)=TIUDA_U_$$RESOLVE^TIUSRVLO(TIUDA)
"RTN","TIUSRVLR",21,0)
 . S @TIUY@("INDX",TIUDA,TIUI)=""
"RTN","TIUSRVLR",22,0)
 . I +$$HASDAD^TIUSRVLI(TIUDA) D SETDAD^TIUSRVLI(.TIUY,TIUDA,.TIUI)
"RTN","TIUSRVLR",23,0)
 . I +$$HASKIDS^TIUSRVLI(TIUDA) D SETKIDS^TIUSRVLI(.TIUY,TIUDA,.TIUI)
"RTN","TIUSRVLR",24,0)
 Q
"RTN","TIUSRVP")
0^21^B72721912
"RTN","TIUSRVP",1,0)
TIUSRVP ; SLC/JER - RPCs for CREATE & UPDATE ;11/01/03
"RTN","TIUSRVP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,7,19,28,47,89,104,100,115,109,167,113,112**;Jun 20, 1997
"RTN","TIUSRVP",3,0)
MAKE(SUCCESS,DFN,TITLE,VDT,VLOC,VSIT,TIUX,VSTR,SUPPRESS,NOASF) ; New Document
"RTN","TIUSRVP",4,0)
 ; SUCCESS = (by ref) TIU DOCUMENT # (PTR to 8925)
"RTN","TIUSRVP",5,0)
 ;         = 0^Explanatory message if no SUCCESS
"RTN","TIUSRVP",6,0)
 ; DFN     = Patient (#2)
"RTN","TIUSRVP",7,0)
 ; TITLE   = TIU Document Definition (#8925.1)
"RTN","TIUSRVP",8,0)
 ; [VDT]   = Date(/Time) of Visit
"RTN","TIUSRVP",9,0)
 ; [VLOC]  = Visit Location (HOSPITAL LOCATION)
"RTN","TIUSRVP",10,0)
 ; [VSIT]  = Visit file ien (#9000010)
"RTN","TIUSRVP",11,0)
 ; [VSTR]  = Visit string (i.e., VLOC;VDT;VTYPE)
"RTN","TIUSRVP",12,0)
 ; [NOASF] = if 1=Do Not Set ASAVE cross-reference
"RTN","TIUSRVP",13,0)
 ; TIUX    = (by ref) array containing field data and document body
"RTN","TIUSRVP",14,0)
 ;
"RTN","TIUSRVP",15,0)
 N TIU,TIUDA,LDT,NEWREC
"RTN","TIUSRVP",16,0)
 S SUCCESS=0
"RTN","TIUSRVP",17,0)
 I +$G(VSIT) S VSTR=$$VSTRBLD(+VSIT)
"RTN","TIUSRVP",18,0)
 I $L($G(VSTR)) D
"RTN","TIUSRVP",19,0)
 . S VDT=$S(+$G(VDT):+$G(VDT),1:$P(VSTR,";",2))
"RTN","TIUSRVP",20,0)
 . S LDT=$S(+$G(VDT):$$FMADD^XLFDT(VDT,"","",1),1:"")
"RTN","TIUSRVP",21,0)
 . S VLOC=$S(+$G(VLOC):+$G(VLOC),1:$P(VSTR,";"))
"RTN","TIUSRVP",22,0)
 . ; If note is for Ward Location, call MAIN^TIUMOVE
"RTN","TIUSRVP",23,0)
 . I $P($G(^SC(+VLOC,0)),U,3)="W" D MAIN^TIUMOVE(.TIU,DFN,"",VDT,LDT,1,"LAST",0,+VLOC) Q
"RTN","TIUSRVP",24,0)
 . ; Otherwise, call PATVADPT^TIULV
"RTN","TIUSRVP",25,0)
 . D PATVADPT^TIULV(.TIU,DFN,"",VSTR)
"RTN","TIUSRVP",26,0)
 I '+$G(VSIT),'$L($G(VSTR)),+$G(VDT),+$G(VLOC) D
"RTN","TIUSRVP",27,0)
 . S VDT=$G(VDT),LDT=$S(+$G(VDT):$$FMADD^XLFDT(VDT,"","",1),1:"")
"RTN","TIUSRVP",28,0)
 . ; If note is for Ward Location, call MAIN^TIUMOVE
"RTN","TIUSRVP",29,0)
 . I $P($G(^SC(+VLOC,0)),U,3)="W" D MAIN^TIUMOVE(.TIU,DFN,"",VDT,LDT,1,"LAST",0,+VLOC) Q
"RTN","TIUSRVP",30,0)
 . ; Otherwise, call MAIN^TIUVSIT
"RTN","TIUSRVP",31,0)
 . D MAIN^TIUVSIT(.TIU,DFN,"",VDT,LDT,"LAST",0,VLOC)
"RTN","TIUSRVP",32,0)
 I '+$G(TIU("VSTR")) D
"RTN","TIUSRVP",33,0)
 . D EVENT^TIUSRVP1(.TIU,DFN)
"RTN","TIUSRVP",34,0)
 S TIU("INST")=$$DIVISION^TIULC1(+TIU("LOC"))
"RTN","TIUSRVP",35,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,1:0) S SUCCESS="0^"_$$EZBLD^DIALOG(89250001) Q
"RTN","TIUSRVP",36,0)
 ;
"RTN","TIUSRVP",37,0)
 S TIUDA=$$GETREC(DFN,.TIU,TITLE,.NEWREC)
"RTN","TIUSRVP",38,0)
 I +TIUDA'>0 S SUCCESS="0^"_$$EZBLD^DIALOG(89250002) Q
"RTN","TIUSRVP",39,0)
 S SUCCESS=+TIUDA
"RTN","TIUSRVP",40,0)
 ;
"RTN","TIUSRVP",41,0)
 D STUFREC^TIUSRVP1(+TIUDA,.TIUX,DFN,,TITLE,.TIU)
"RTN","TIUSRVP",42,0)
 S:'+$G(NOASF) ^TIU(8925,"ASAVE",DUZ,TIUDA)=""
"RTN","TIUSRVP",43,0)
 K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",44,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUSRVP",45,0)
 D SETXT0(TIUDA)
"RTN","TIUSRVP",46,0)
 D FILE(.SUCCESS,+TIUDA,.TIUX,+$G(SUPPRESS))
"RTN","TIUSRVP",47,0)
 I +SUCCESS'>0 D DIK^TIURB2(TIUDA) Q
"RTN","TIUSRVP",48,0)
 I +$O(^TIU(8925,+TIUDA,"TEMP",0)) D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUSRVP",49,0)
 I +$G(TIU("STOP")) D DEFER^TIUVSIT(TIUDA,TIU("STOP")) I 1
"RTN","TIUSRVP",50,0)
 E  D QUE^TIUPXAP1
"RTN","TIUSRVP",51,0)
 I '+$G(SUPPRESS) D
"RTN","TIUSRVP",52,0)
 . D RELEASE^TIUT(TIUDA,1)
"RTN","TIUSRVP",53,0)
 . D UPDTIRT^TIUDIRT(.TIU,TIUDA)
"RTN","TIUSRVP",54,0)
 K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",55,0)
 Q
"RTN","TIUSRVP",56,0)
VSTRBLD(VSIT) ; Given Visit ien, build Visit-Descriptor String
"RTN","TIUSRVP",57,0)
 N TIUY,VSIT0,VLOC,VDT,VSVCAT
"RTN","TIUSRVP",58,0)
 S VSIT0=$G(^AUPNVSIT(+VSIT,0)),VDT=+$P(VSIT0,U),VLOC=+$P(VSIT0,U,22)
"RTN","TIUSRVP",59,0)
 S VSVCAT=$P(VSIT0,U,7)
"RTN","TIUSRVP",60,0)
 S TIUY=VLOC_";"_VDT_";"_VSVCAT
"RTN","TIUSRVP",61,0)
 Q TIUY
"RTN","TIUSRVP",62,0)
SETXT0(TIUDA) ; Set root node of "TEMP" WP-field
"RTN","TIUSRVP",63,0)
 N TIUC,TIUI S (TIUC,TIUI)=0
"RTN","TIUSRVP",64,0)
 F  S TIUI=$O(^TIU(8925,TIUDA,"TEMP",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVP",65,0)
 . S:$D(^TIU(8925,TIUDA,"TEMP",TIUI,0)) TIUC=TIUC+1
"RTN","TIUSRVP",66,0)
 S ^TIU(8925,TIUDA,"TEMP",0)="^^"_TIUC_U_TIUC_U_DT_"^^"
"RTN","TIUSRVP",67,0)
 Q
"RTN","TIUSRVP",68,0)
MAKEADD(TIUDADD,TIUDA,TIUX,SUPPRESS) ; Create addendum
"RTN","TIUSRVP",69,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUCAN,TIUFPRIV,TIU S TIUFPRIV=1
"RTN","TIUSRVP",70,0)
 S TIUCAN=$$CANDO^TIULP(TIUDA,"MAKE ADDENDUM")
"RTN","TIUSRVP",71,0)
 I TIUCAN'>0 S TIUDADD="0^You may not MAKE AN ADDENDUM for this "_$$STATUS^TIULC(TIUDA)_" "_$$PNAME^TIULC1(+$G(^TIU(8925,+TIUDA,0))) Q
"RTN","TIUSRVP",72,0)
 S TIUATYP=+$$WHATITLE^TIUPUTU("ADDENDUM")
"RTN","TIUSRVP",73,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUSRVP",74,0)
 D ^DIC
"RTN","TIUSRVP",75,0)
 S TIUDADD=+Y
"RTN","TIUSRVP",76,0)
 I +Y'>0 S TIUDADD=TIUDADD_"^Could not create addendum." Q
"RTN","TIUSRVP",77,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSRVP",78,0)
 S TIU("DOCTYP")=TIUATYP_U_$$PNAME^TIULC1(TIUATYP)
"RTN","TIUSRVP",79,0)
 D STUFREC^TIUSRVP1(+TIUDADD,.TIUX,DFN,+$G(TIUDA),TIUATYP,.TIU)
"RTN","TIUSRVP",80,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUSRVP",81,0)
 M ^TIU(8925,+TIUDADD,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUSRVP",82,0)
 D SETXT0(+TIUDADD)
"RTN","TIUSRVP",83,0)
 D FILE(.SUCCESS,+TIUDADD,.TIUX,+$G(SUPPRESS))
"RTN","TIUSRVP",84,0)
 I +SUCCESS'>0 D DIK^TIURB2(TIUDADD) Q
"RTN","TIUSRVP",85,0)
 I +$O(^TIU(8925,+TIUDADD,"TEMP",0)) D MERGTEXT^TIUEDI1(+TIUDADD,.TIU)
"RTN","TIUSRVP",86,0)
 I '+$G(SUPPRESS) D RELEASE^TIUT(+TIUDADD,1)
"RTN","TIUSRVP",87,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUSRVP",88,0)
 Q
"RTN","TIUSRVP",89,0)
UPDATE(SUCCESS,TIUDA,TIUX,SUPPRESS) ; Update existing Document
"RTN","TIUSRVP",90,0)
 N TIU,TIUI,TIUC,TIUD0,TIUD12,TIUD15,TIUCPF,TITLE
"RTN","TIUSRVP",91,0)
 I $S(+$G(TIUDA)'>0:1,'$D(^TIU(8925,+TIUDA,0)):1,1:0) D  Q
"RTN","TIUSRVP",92,0)
 . S SUCCESS="0^ Cannot update a non-existent document..."
"RTN","TIUSRVP",93,0)
 I +$P($G(^TIU(8925,+TIUDA,0)),U,5)>6 D  Q
"RTN","TIUSRVP",94,0)
 . S SUCCESS="0^ TIU Document #"_TIUDA_" is already signed..."
"RTN","TIUSRVP",95,0)
 I $D(TIUX("TEXT")) D
"RTN","TIUSRVP",96,0)
 . K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",97,0)
 . M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT")
"RTN","TIUSRVP",98,0)
 . S (TIUC,TIUI)=0
"RTN","TIUSRVP",99,0)
 . F  S TIUI=$O(^TIU(8925,+TIUDA,"TEMP",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVP",100,0)
 . . S TIUC=TIUC+1
"RTN","TIUSRVP",101,0)
 . I +TIUC>0 S ^TIU(8925,+TIUDA,"TEMP",0)="^^"_TIUC_U_TIUC_U_DT_"^^"
"RTN","TIUSRVP",102,0)
 . K TIUX("TEXT")
"RTN","TIUSRVP",103,0)
 I +$O(TIUX(""))'>0 S:+$G(SUPPRESS) SUCCESS=+TIUDA Q
"RTN","TIUSRVP",104,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD12=$G(^(12)),TITLE=+TIUD0
"RTN","TIUSRVP",105,0)
 ;Set a flag to indicate whether or not a Title is a member of the
"RTN","TIUSRVP",106,0)
 ;Clinical Procedures Class (1=Yes and 0=No)
"RTN","TIUSRVP",107,0)
 S TIUCPF=+$$ISA^TIULX(TITLE,+$$CLASS^TIUCP)
"RTN","TIUSRVP",108,0)
 D SETCOS(TIUDA,.TIUX,TIUD0,TIUD12)
"RTN","TIUSRVP",109,0)
 ; Title changed? Refile DC
"RTN","TIUSRVP",110,0)
 I +$G(TIUX(.01))>0,(+$G(TIUX(.01))'=+TIUD0) D
"RTN","TIUSRVP",111,0)
 . S TIUX(.04)=$$DOCCLASS^TIULC1(+$G(TIUX(.01)))
"RTN","TIUSRVP",112,0)
 D FILE(.SUCCESS,+TIUDA,.TIUX,+$G(SUPPRESS),TIUCPF)
"RTN","TIUSRVP",113,0)
 I +SUCCESS'>0 K ^TIU(8925,+TIUDA,"TEMP") Q
"RTN","TIUSRVP",114,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSRVP",115,0)
 I $D(^TIU(8925,+TIUDA,"TEMP")) D
"RTN","TIUSRVP",116,0)
 . K ^TIU(8925,+TIUDA,"TEXT")
"RTN","TIUSRVP",117,0)
 . D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUSRVP",118,0)
 . K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",119,0)
 . S:'+$G(SUCCESS) SUCCESS=+TIUDA
"RTN","TIUSRVP",120,0)
 ; If signed, re-file /ES/
"RTN","TIUSRVP",121,0)
 S TIUD15=$G(^TIU(8925,+TIUDA,15))
"RTN","TIUSRVP",122,0)
 I +TIUD15 D
"RTN","TIUSRVP",123,0)
 . N TIUBY,DR,DIE,DA,X,Y S TIUBY=$P(TIUD15,U,2) Q:+TIUBY'>0
"RTN","TIUSRVP",124,0)
 . S DR="1503///^S X=$$SIGNAME^TIULS("_TIUBY_");1504///^S X=$$SIGTITL^TIULS("_TIUBY_")"
"RTN","TIUSRVP",125,0)
 . S DA=TIUDA,DIE=8925 D ^DIE
"RTN","TIUSRVP",126,0)
 ; send alerts
"RTN","TIUSRVP",127,0)
 I '+$G(SUPPRESS) D
"RTN","TIUSRVP",128,0)
 . I +$P(TIUD0,U,5)<5,'$D(TIUX(.05)) D UPDSTAT(TIUDA,+$G(TIUD0))
"RTN","TIUSRVP",129,0)
 . D SEND^TIUALRT(TIUDA),SENDID^TIUALRT1(TIUDA):+$G(^TIU(8925,+TIUDA,21))
"RTN","TIUSRVP",130,0)
 . D UPDTIRT^TIUDIRT(.TIU,TIUDA)
"RTN","TIUSRVP",131,0)
 Q
"RTN","TIUSRVP",132,0)
SETCOS(TIUDA,TIUX,TIUD0,TIUD12) ; set cosig req
"RTN","TIUSRVP",133,0)
 N TIUDAD,TIUEXS,TIUNCS,TIUEXCS,TIURCS,TIUATT,TIUTTL,TIUDAD0
"RTN","TIUSRVP",134,0)
 S TIUEXS=$S(+$G(TIUX(1202)):+$G(TIUX(1202)),1:$P(TIUD12,U,4))
"RTN","TIUSRVP",135,0)
 S TIUNCS=$S(+$G(TIUX(1208)):+$G(TIUX(1208)),+$G(TIUX(1209)):+$G(TIUX(1209)),1:0)
"RTN","TIUSRVP",136,0)
 I TIUNCS S TIUX(1506)=$S(TIUNCS=TIUEXS:0,1:1) G SETCOSX
"RTN","TIUSRVP",137,0)
 S TIUEXCS=$P(TIUD12,U,8),TIUATT=$P(TIUD12,U,9)
"RTN","TIUSRVP",138,0)
 S TIUDAD=+$P(TIUD0,U,6),TIUDAD0=$G(^TIU(8925,+TIUDAD,0))
"RTN","TIUSRVP",139,0)
 I +$$ISDS^TIULX($S(+TIUDAD:+TIUDAD0,1:+TIUD0)) D  G SETCOSX
"RTN","TIUSRVP",140,0)
 . S TIUX(1506)=$S(TIUEXS=TIUEXCS:0,1:1)
"RTN","TIUSRVP",141,0)
 S TIUTTL=$S(+$G(TIUX(.01)):+$G(TIUX(.01)),1:+TIUD0)
"RTN","TIUSRVP",142,0)
 S TIUX(1506)=+$$REQCOSIG^TIULP(TIUTTL,TIUDA,TIUEXS)
"RTN","TIUSRVP",143,0)
SETCOSX S:'TIUX(1506) TIUX(1208)="@"
"RTN","TIUSRVP",144,0)
 Q
"RTN","TIUSRVP",145,0)
UPDSTAT(DA,TITLE) ; Update status on commit
"RTN","TIUSRVP",146,0)
 N DR,DIE S DR=".05////"_$$STATUS^TIUSRVP1(DA,0,TITLE)
"RTN","TIUSRVP",147,0)
 I '+$P($G(^TIU(8925,DA,13)),U,4) S DR=DR_";1304////^S X=$$NOW^XLFDT"
"RTN","TIUSRVP",148,0)
 S DIE=8925
"RTN","TIUSRVP",149,0)
 D ^DIE
"RTN","TIUSRVP",150,0)
 Q
"RTN","TIUSRVP",151,0)
GETREC(DFN,TIU,TITLE,TIUNEW) ; Get/create document record
"RTN","TIUSRVP",152,0)
 N DA,DIC,DIE,DLAYGO,DR,X,Y,TIUDPRM,TIUFPRIV,TIUHIT,TIUSCAT
"RTN","TIUSRVP",153,0)
 S (TIUHIT,DA)=0,TIUFPRIV=1
"RTN","TIUSRVP",154,0)
 S (DIC,DLAYGO)=8925,DIC(0)="FL"
"RTN","TIUSRVP",155,0)
 S X=""""_"`"_+TITLE_"""" D ^DIC K DIC("S")
"RTN","TIUSRVP",156,0)
 I +Y'>0 Q Y_U_" Insufficient data to create a new record."
"RTN","TIUSRVP",157,0)
 S DA=+Y,TIUNEW=+$P(Y,U,3)
"RTN","TIUSRVP",158,0)
 N DIE,DR,TIUVISIT S DIE=8925
"RTN","TIUSRVP",159,0)
 S TIUVISIT=$S(+$G(TIU("VISIT")):+$G(TIU("VISIT")),1:"")
"RTN","TIUSRVP",160,0)
 S TIUSCAT=$S(+$L($P($G(TIU("CAT")),U)):$P($G(TIU("CAT")),U),+$L($P($G(TIU("VSTR")),";",3)):$P($G(TIU("VSTR")),";",3),1:"")
"RTN","TIUSRVP",161,0)
 S DR=".04////"_$$DOCCLASS^TIULC1(+$P(Y,U,2))_";.13////"_TIUSCAT_";1205////"_$P($G(TIU("LOC")),U)_";1211////"_$P($G(TIU("VLOC")),U)_";1212////"_$P($G(TIU("INST")),U)
"RTN","TIUSRVP",162,0)
 D ^DIE
"RTN","TIUSRVP",163,0)
 Q +$G(DA)
"RTN","TIUSRVP",164,0)
FILE(SUCCESS,TIUDA,TIUX,SUPPRESS,TIUCPF) ; Call FM Filer & commit
"RTN","TIUSRVP",165,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIUCMMTX
"RTN","TIUSRVP",166,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS=""
"RTN","TIUSRVP",167,0)
 I +$G(TIUX(1202)) S TIUX(1204)=+$G(TIUX(1202))
"RTN","TIUSRVP",168,0)
 I +$G(TIUX(1209)) S TIUX(1208)=+$G(TIUX(1209))
"RTN","TIUSRVP",169,0)
 ;If the document is a member of the Clinical Procedures Class, set the
"RTN","TIUSRVP",170,0)
 ;Entered By field to the Author/Dictator field
"RTN","TIUSRVP",171,0)
 I $G(TIUCPF),+$G(TIUX(1202)) S TIUX(1302)=+$G(TIUX(1202))
"RTN","TIUSRVP",172,0)
 M @FDARR=TIUX
"RTN","TIUSRVP",173,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUSRVP",174,0)
 I $D(TIUMSG)>9 S SUCCESS=0_U_$G(TIUMSG("DIERR",1,"TEXT",1)) Q
"RTN","TIUSRVP",175,0)
 S SUCCESS=TIUDA
"RTN","TIUSRVP",176,0)
 I '+$G(SUPPRESS) D
"RTN","TIUSRVP",177,0)
 . N DA
"RTN","TIUSRVP",178,0)
 . S DA=TIUDA
"RTN","TIUSRVP",179,0)
 . S TIUCMMTX=$$COMMIT^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUSRVP",180,0)
 . I TIUCMMTX]"" X TIUCMMTX
"RTN","TIUSRVP",181,0)
 . K ^TIU(8925,"ASAVE",DUZ,TIUDA)
"RTN","TIUSRVP",182,0)
 Q
"RTN","TIUSRVP",183,0)
SIGN(ERR,TIUDA,TIUX) ; API for /es/
"RTN","TIUSRVP",184,0)
 N X,TIUACT,TIUSIGN,TIUD0,TIUD12,TIUSTAT,SIGNER,COSIGNER,VALID,XTRASGNR
"RTN","TIUSRVP",185,0)
 N TIUES S ERR=0
"RTN","TIUSRVP",186,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIUSRVP",187,0)
 S SIGNER=$P(TIUD12,U,4),COSIGNER=$P(TIUD12,U,8)
"RTN","TIUSRVP",188,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIUSRVP",189,0)
 S TIUSTAT=+$P(TIUD0,U,5)
"RTN","TIUSRVP",190,0)
 S TIUACT=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIUSRVP",191,0)
 S TIUSIGN=$$CANDO^TIULP(TIUDA,TIUACT)
"RTN","TIUSRVP",192,0)
 I +TIUSIGN'>0 S ERR="89250004^"_$P(TIUSIGN,U,2) Q
"RTN","TIUSRVP",193,0)
 S VALID=$$VALIDATE($$DECRYP^XUSRB1(TIUX))
"RTN","TIUSRVP",194,0)
 I +VALID'>0 S ERR="89250005^"_$$EZBLD^DIALOG(89250005) Q
"RTN","TIUSRVP",195,0)
 S TIUES=1_U_$P($G(^VA(200,+DUZ,20)),U,2,3)
"RTN","TIUSRVP",196,0)
 I '+$G(XTRASGNR) D ES^TIURS(TIUDA,TIUES)
"RTN","TIUSRVP",197,0)
 I +$G(XTRASGNR) D ADDSIG^TIURS1(TIUDA,XTRASGNR)
"RTN","TIUSRVP",198,0)
 I +$G(^TIU(8925,TIUDA,21)),(TIUACT="SIGNATURE") D AUDLINK^TIUGR1(TIUDA,"a",+$G(^(21)))
"RTN","TIUSRVP",199,0)
 Q
"RTN","TIUSRVP",200,0)
VALIDATE(X) ; Validate /es/-code
"RTN","TIUSRVP",201,0)
 N TIUY S TIUY=0
"RTN","TIUSRVP",202,0)
 D HASH^XUSHSHP I X]"",(X=$P($G(^VA(200,+DUZ,20)),U,4)) S TIUY=1
"RTN","TIUSRVP",203,0)
 Q TIUY
"RTN","TIUSRVP",204,0)
DELETE(ERR,TIUDA,TIURSN,OVRRIDE) ; delete document
"RTN","TIUSRVP",205,0)
 N TIUDEL,TIUD0 S ERR=0
"RTN","TIUSRVP",206,0)
 I '+$G(OVRRIDE) D  Q:+$G(TIUDEL)'>0
"RTN","TIUSRVP",207,0)
 . S TIUDEL=$$CANDO^TIULP(TIUDA,"DELETE RECORD")
"RTN","TIUSRVP",208,0)
 . I TIUDEL'>0 S ERR="89250003^"_$$EZBLD^DIALOG(89250003)
"RTN","TIUSRVP",209,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0))
"RTN","TIUSRVP",210,0)
 I +$P(TIUD0,U,5)'<6 D  Q
"RTN","TIUSRVP",211,0)
 . S TIURSN=$G(TIURSN,"A")
"RTN","TIUSRVP",212,0)
 . D DELTEXT^TIURB2(TIUDA,TIURSN)
"RTN","TIUSRVP",213,0)
 D DIK^TIURB2(TIUDA)
"RTN","TIUSRVP",214,0)
 D DELAUDIT^TIUEDI1(TIUDA)
"RTN","TIUSRVP",215,0)
 Q
"RTN","TIUSRVP",216,0)
LOCK(ERR,TIUDA) ; Bid for lock on a TIU Document record
"RTN","TIUSRVP",217,0)
 L +^TIU(8925,+TIUDA):1 I  S ERR=0
"RTN","TIUSRVP",218,0)
 E  S ERR="1^ Another session has this record locked."
"RTN","TIUSRVP",219,0)
 Q
"RTN","TIUSRVP",220,0)
UNLOCK(ERR,TIUDA) ; Decrement Lock on a TIU Document record
"RTN","TIUSRVP",221,0)
 L -^TIU(8925,+TIUDA) S ERR=0
"RTN","TIUSRVP",222,0)
 Q
"RTN","TIUSRVP1")
0^19^B37579653
"RTN","TIUSRVP1",1,0)
TIUSRVP1 ; SLC/JER - More API's in support of PUT ;11/01/03
"RTN","TIUSRVP1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,59,89,100,109,167,113,112**;Jun 20, 1997
"RTN","TIUSRVP1",3,0)
SITEPARM(TIUY) ; Get site parameters for GUI
"RTN","TIUSRVP1",4,0)
 N TIUPRM0,TIUPRM1
"RTN","TIUSRVP1",5,0)
 D SETPARM^TIULE
"RTN","TIUSRVP1",6,0)
 S TIUY=TIUPRM0
"RTN","TIUSRVP1",7,0)
 Q
"RTN","TIUSRVP1",8,0)
DEFDOC(TIUY,HLOC,USER,TIUDT,TIUIEN) ; Get default primary provider
"RTN","TIUSRVP1",9,0)
 N TIUSPRM,TIUDDOC,TIUAUTH
"RTN","TIUSRVP1",10,0)
 D SITEPARM(.TIUSPRM)
"RTN","TIUSRVP1",11,0)
 S TIUDDOC=+$P(TIUSPRM,U,8)
"RTN","TIUSRVP1",12,0)
 S TIUAUTH=$S((+$G(USER)!('+$G(TIUIEN))):0,1:+$P($G(^TIU(8925,+$G(TIUIEN),12)),U,2))
"RTN","TIUSRVP1",13,0)
 S USER=$S(+$G(USER):+$G(USER),+$G(TIUAUTH):+$G(TIUAUTH),1:DUZ)
"RTN","TIUSRVP1",14,0)
 S TIUDT=$S(+$G(TIUDT):+$G(TIUDT),1:DT)
"RTN","TIUSRVP1",15,0)
 S TIUY=$S(TIUDDOC=1:$$DFLTDOC^TIUPXAPI(HLOC),TIUDDOC=2:$$CURDOC(USER),1:"0^")
"RTN","TIUSRVP1",16,0)
 Q
"RTN","TIUSRVP1",17,0)
CURDOC(USER,TIUDT) ; Is the current user a known Provider?
"RTN","TIUSRVP1",18,0)
 N TIUY,TIUPROV S TIUY="0^"
"RTN","TIUSRVP1",19,0)
 S USER=$S(+$G(USER):+$G(USER),1:DUZ)
"RTN","TIUSRVP1",20,0)
 S TIUDT=$S(+$G(TIUDT):+$G(TIUDT),1:DT)
"RTN","TIUSRVP1",21,0)
 S TIUPROV=$$PROVIDER^TIUPXAP1(USER,TIUDT)
"RTN","TIUSRVP1",22,0)
 I +TIUPROV S TIUY=USER_U_$$PERSNAME^TIULC1(USER)
"RTN","TIUSRVP1",23,0)
 Q TIUY
"RTN","TIUSRVP1",24,0)
ISAPROV(TIUY,USER,DATE) ; Is user a provider?
"RTN","TIUSRVP1",25,0)
 S USER=$G(USER,DUZ)
"RTN","TIUSRVP1",26,0)
 S DATE=$G(DATE,DT)
"RTN","TIUSRVP1",27,0)
 S TIUY=$$PROVIDER^TIUPXAP1(USER,DATE)
"RTN","TIUSRVP1",28,0)
 Q
"RTN","TIUSRVP1",29,0)
DOCPARM(TIUY,TIUDA,TIUTYP) ; Get document parameters for GUI
"RTN","TIUSRVP1",30,0)
 I '+$G(TIUTYP),+$G(TIUDA) S TIUTYP=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIUSRVP1",31,0)
 I '+$G(TIUTYP) S TIUY(0)="" Q
"RTN","TIUSRVP1",32,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUY,$G(TIUDA))
"RTN","TIUSRVP1",33,0)
 I '$D(TIUY) S TIUY(0)=""
"RTN","TIUSRVP1",34,0)
 Q
"RTN","TIUSRVP1",35,0)
CONSTUB(TIUDA,GMRCVP,DFN) ; Create a stub for a Consult Report
"RTN","TIUSRVP1",36,0)
 N DIE,DR,DA
"RTN","TIUSRVP1",37,0)
 D STUB(.TIUDA,"CONSULT REPORT",DFN)
"RTN","TIUSRVP1",38,0)
 I +TIUDA'>0 Q
"RTN","TIUSRVP1",39,0)
 S DIE=8925,DA=+TIUDA,DR="1405////^S X=GMRCVP"
"RTN","TIUSRVP1",40,0)
 D ^DIE
"RTN","TIUSRVP1",41,0)
 Q
"RTN","TIUSRVP1",42,0)
STUB(TIUDA,TIUTITL,DFN) ; Create a stub
"RTN","TIUSRVP1",43,0)
 N TIUVSIT,TIUFPRIV,DIC,DIE,DR,DA,DLAYGO,X,Y S TIUFPRIV=1
"RTN","TIUSRVP1",44,0)
 I +$G(TIUTITL)'>0 S TIUTITL=$$WHATITLE^TIUPUTU(TIUTITL)
"RTN","TIUSRVP1",45,0)
 I +TIUTITL'>0 S TIUDA=-1 Q
"RTN","TIUSRVP1",46,0)
 S (DIC,DLAYGO)=8925,DIC(0)="LF"
"RTN","TIUSRVP1",47,0)
 S X=""""_"`"_+TIUTITL_""""
"RTN","TIUSRVP1",48,0)
 D ^DIC S TIUDA=+Y Q:+Y'>0
"RTN","TIUSRVP1",49,0)
 D EVENT(.TIU,DFN) I $L($G(TIU("VSTR")))'>0 S TIUDA=-1 Q
"RTN","TIUSRVP1",50,0)
 S DIE=DIC,DA=TIUDA
"RTN","TIUSRVP1",51,0)
 S DR=".02////"_+DFN_";.03////"_$P($G(TIU("VISIT")),U)_";.04////"_+$$DOCCLASS^TIULC1(TIUTITL)_";.05///UNDICTATED;.13////E;1301////"_+$$NOW^XLFDT
"RTN","TIUSRVP1",52,0)
 D ^DIE
"RTN","TIUSRVP1",53,0)
 Q
"RTN","TIUSRVP1",54,0)
EVENT(TIUY,DFN) ; Create an Event-type Visit Entry
"RTN","TIUSRVP1",55,0)
 N VDT,VSTR,DGPM
"RTN","TIUSRVP1",56,0)
 S DGPM=$G(^DPT(DFN,.105))
"RTN","TIUSRVP1",57,0)
 I +DGPM'>0 D
"RTN","TIUSRVP1",58,0)
 . S VDT=$$NOW^XLFDT
"RTN","TIUSRVP1",59,0)
 . S VSTR=";"_VDT_";"_"E"
"RTN","TIUSRVP1",60,0)
 D PATVADPT^TIULV(.TIUY,+DFN,DGPM,$G(VSTR))
"RTN","TIUSRVP1",61,0)
 I $G(TIUY("LOC"))="",+DUZ D
"RTN","TIUSRVP1",62,0)
 .N TIUPREF,IDX
"RTN","TIUSRVP1",63,0)
 .S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUSRVP1",64,0)
 .S IDX=+$P(TIUPREF,U,2)
"RTN","TIUSRVP1",65,0)
 .I IDX S TIUY("LOC")=IDX_U_$P($G(^SC(IDX,0)),U,1)
"RTN","TIUSRVP1",66,0)
 Q
"RTN","TIUSRVP1",67,0)
GETPNAME(TIUY,TIUTYPE)  ; Get Print Name of a Document
"RTN","TIUSRVP1",68,0)
 S TIUY=$$PNAME^TIULC1(TIUTYPE)
"RTN","TIUSRVP1",69,0)
 Q
"RTN","TIUSRVP1",70,0)
SAVED(TIUY,TIUDA) ; Was the document committed to the database?
"RTN","TIUSRVP1",71,0)
 N TIUD12,TIUD13,TIUEBY,TIUAUT,TIUECS S TIUY=1
"RTN","TIUSRVP1",72,0)
 S TIUD12=$G(^TIU(8925,TIUDA,12)),TIUD13=$G(^(13))
"RTN","TIUSRVP1",73,0)
 S TIUEBY=$P(TIUD13,U,2),TIUAUT=$P(TIUD12,U,2),TIUECS=$P(TIUD12,U,8)
"RTN","TIUSRVP1",74,0)
 I $D(^TIU(8925,"ASAVE",+DUZ,TIUDA)) D  Q
"RTN","TIUSRVP1",75,0)
 . S TIUY="0^You appear to have been disconnected..."
"RTN","TIUSRVP1",76,0)
 I DUZ'=TIUEBY,(TIUEBY'=TIUAUT),$D(^TIU(8925,"ASAVE",+TIUEBY,TIUDA)) D  Q
"RTN","TIUSRVP1",77,0)
 . S TIUY="0^The transcriber appears to have been disconnected..."
"RTN","TIUSRVP1",78,0)
 I DUZ'=TIUAUT,$D(^TIU(8925,"ASAVE",+TIUAUT,TIUDA)) D  Q
"RTN","TIUSRVP1",79,0)
 . S TIUY="0^The author appears to have been disconnected..."
"RTN","TIUSRVP1",80,0)
 I DUZ'=TIUECS,$D(^TIU(8925,"ASAVE",+TIUECS,TIUDA)) D  Q
"RTN","TIUSRVP1",81,0)
 . S TIUY="0^The expected cosigner appears to have been disconnected..."
"RTN","TIUSRVP1",82,0)
 Q
"RTN","TIUSRVP1",83,0)
STUFREC(TIUDA,TIUREC,DFN,PARENT,TITLE,TIU) ; load TIUREC for create
"RTN","TIUSRVP1",84,0)
 N TIUREQCS,TIUSCAT,TIUSTAT,TIUCPF
"RTN","TIUSRVP1",85,0)
 ;Set a flag to indicate whether or not a Title is a member of the
"RTN","TIUSRVP1",86,0)
 ;Clinical Procedures Class (1=Yes and 0=No)
"RTN","TIUSRVP1",87,0)
 S TIUCPF=+$$ISA^TIULX(TITLE,+$$CLASS^TIUCP)
"RTN","TIUSRVP1",88,0)
 S TIUSTAT=$$STATUS(TIUDA,+$G(SUPPRESS),$G(TITLE))
"RTN","TIUSRVP1",89,0)
 D REQCOS^TIUSRVA(.TIUREQCS,+TITLE,"",$S(+$G(TIUREC(1202)):+$G(TIUREC(1202)),1:DUZ))
"RTN","TIUSRVP1",90,0)
 I +$G(PARENT)'>0 D
"RTN","TIUSRVP1",91,0)
 . S TIUREC(.02)=$G(DFN),TIUREC(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUSRVP1",92,0)
 . S TIUREC(.05)=$S(+$G(TIUREC(.05)):+$G(TIUREC(.05)),+TIUSTAT:TIUSTAT,1:5)
"RTN","TIUSRVP1",93,0)
 . S TIUREC(.07)=$P($G(TIU("EDT")),U),TIUREC(.08)=$P($G(TIU("LDT")),U)
"RTN","TIUSRVP1",94,0)
 . S TIUREC(1401)=$P($G(TIU("AD#")),U)
"RTN","TIUSRVP1",95,0)
 . S TIUREC(1402)=$P($G(TIU("TS")),U)
"RTN","TIUSRVP1",96,0)
 . S TIUREC(1404)=$P($G(TIU("SVC")),U)
"RTN","TIUSRVP1",97,0)
 I +$G(PARENT)>0 D
"RTN","TIUSRVP1",98,0)
 . S TIUREC(.02)=+$P($G(^TIU(8925,+PARENT,0)),U,2)
"RTN","TIUSRVP1",99,0)
 . S TIUREC(.03)=+$P($G(^TIU(8925,+PARENT,0)),U,3)
"RTN","TIUSRVP1",100,0)
 . S TIUREC(.05)=$S(+$G(TIUREC(.05)):+$G(TIUREC(.05)),+TIUSTAT:TIUSTAT,1:5)
"RTN","TIUSRVP1",101,0)
 . S TIUREC(.06)=PARENT,TIUREC(.07)=$P(TIU("EDT"),U)
"RTN","TIUSRVP1",102,0)
 . S TIUREC(.08)=$P(TIU("LDT"),U)
"RTN","TIUSRVP1",103,0)
 . S TIUREC(1401)=$P($G(^TIU(8925,+PARENT,14)),U)
"RTN","TIUSRVP1",104,0)
 . S TIUREC(1402)=$P($G(^TIU(8925,+PARENT,14)),U,2)
"RTN","TIUSRVP1",105,0)
 . S TIUREC(1404)=$P($G(^TIU(8925,+PARENT,14)),U,4)
"RTN","TIUSRVP1",106,0)
 . S TIUREC(1405)=$P($G(^TIU(8925,+PARENT,14)),U,5)
"RTN","TIUSRVP1",107,0)
 S TIUREC(.04)=$$DOCCLASS^TIULC1(TITLE)
"RTN","TIUSRVP1",108,0)
 S TIUSCAT=$S(+$L($P($G(TIU("CAT")),U)):$P($G(TIU("CAT")),U),+$L($P($G(TIU("VSTR")),";",3)):$P($G(TIU("VSTR")),";",3),1:"")
"RTN","TIUSRVP1",109,0)
 S TIUREC(.13)=TIUSCAT
"RTN","TIUSRVP1",110,0)
 ;If the document is a member of the Clinical Procedures Class, set the
"RTN","TIUSRVP1",111,0)
 ;Author/Dictator and the Expected Signer fields to Null
"RTN","TIUSRVP1",112,0)
 S (TIUREC(1202),TIUREC(1204))=$S(+$G(TIUREC(1202)):+$G(TIUREC(1202)),TIUCPF:"",1:+$G(DUZ))
"RTN","TIUSRVP1",113,0)
 S TIUREC(1212)=$P($G(TIU("INST")),U)
"RTN","TIUSRVP1",114,0)
 S TIUREC(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUSRVP1",115,0)
 S TIUREC(1211)=$P($G(TIU("VLOC")),U)
"RTN","TIUSRVP1",116,0)
 S TIUREC(1201)=$$NOW^XLFDT
"RTN","TIUSRVP1",117,0)
 S TIUREC(1301)=$S($G(TIUREC(1301))]"":$P(TIUREC(1301),U),1:$$NOW^XLFDT)
"RTN","TIUSRVP1",118,0)
 I +$$ISDS^TIULX(TITLE) D
"RTN","TIUSRVP1",119,0)
 . I +$G(TIU("LDT"))'>0 S TIUREC(.12)=1
"RTN","TIUSRVP1",120,0)
 . S TIUREC(.13)="H"
"RTN","TIUSRVP1",121,0)
 . D REFDT(.TIUREC)
"RTN","TIUSRVP1",122,0)
 ;If the document is a member of the Clinical Procedures Class, set the
"RTN","TIUSRVP1",123,0)
 ;Entered By field to Null
"RTN","TIUSRVP1",124,0)
 S TIUREC(1303)="R",TIUREC(1302)=$S(TIUCPF:"",1:$G(DUZ))
"RTN","TIUSRVP1",125,0)
 I $S(+$G(TIUREC(1208))&(+$G(TIUREC(1204))'=+$G(TIUREC(1208))):1,+$G(TIUREQCS):1,1:0) S TIUREC(1506)=1
"RTN","TIUSRVP1",126,0)
 Q
"RTN","TIUSRVP1",127,0)
REFDT(TIUX) ; Hack Ref Date/time for DS's
"RTN","TIUSRVP1",128,0)
 S TIUX(1301)=$S(+$G(TIU("LDT")):+$G(TIU("LDT")),1:$G(TIUX(1301)))
"RTN","TIUSRVP1",129,0)
 Q
"RTN","TIUSRVP1",130,0)
STATUS(TIUDA,SUPPRESS,TITLE)  ; Compute the status of the current record
"RTN","TIUSRVP1",131,0)
 N TIUDPRM,TIUY
"RTN","TIUSRVP1",132,0)
 ; If the document is an addendum, compute status based on processing
"RTN","TIUSRVP1",133,0)
 ; requirements of the Parent document or its ancestors
"RTN","TIUSRVP1",134,0)
 I +$$ISADDNDM^TIULC1(TIUDA) D
"RTN","TIUSRVP1",135,0)
 . S TIUDA=$S(+$P(^TIU(8925,TIUDA,0),U,6):$P(^(0),U,6),1:TIUDA)
"RTN","TIUSRVP1",136,0)
 . S TITLE=+$G(^TIU(8925,TIUDA,0))
"RTN","TIUSRVP1",137,0)
 D DOCPRM^TIULC1(TITLE,.TIUDPRM,$G(TIUDA))
"RTN","TIUSRVP1",138,0)
 I +$P(TIUDPRM(0),U,2),+$G(SUPPRESS) S TIUY=3 G STATUX
"RTN","TIUSRVP1",139,0)
 S TIUY=$S(+$$REQVER^TIULC(+TIUDA,+$P($G(TIUDPRM(0)),U,3)):4,1:5)
"RTN","TIUSRVP1",140,0)
STATUX Q TIUY
"RTN","TIUSRVP1",141,0)
IDATTCH(TIUY,TIUDA,TIUDAD) ; Attach TIUDA as ID Child entry to TIUDAD
"RTN","TIUSRVP1",142,0)
 N TIUX
"RTN","TIUSRVP1",143,0)
 S TIUX(2101)=TIUDAD
"RTN","TIUSRVP1",144,0)
 D FILE^TIUSRVP(.TIUY,TIUDA,.TIUX,1)
"RTN","TIUSRVP1",145,0)
 D AUDLINK^TIUGR1(TIUDA,"a",TIUDAD)
"RTN","TIUSRVP1",146,0)
 D SENDID^TIUALRT1(TIUDA)
"RTN","TIUSRVP1",147,0)
 Q
"RTN","TIUSRVP1",148,0)
IDDTCH(TIUY,TIUDA) ; Detach TIUDA from its ID Parent
"RTN","TIUSRVP1",149,0)
 N TIUX,IDDAD
"RTN","TIUSRVP1",150,0)
 I '+$G(^TIU(8925,TIUDA,21)) D  Q
"RTN","TIUSRVP1",151,0)
 . S TIUY="0^Record #"_TIUDA_" is NOT an ID Entry."
"RTN","TIUSRVP1",152,0)
 S IDDAD=+$G(^TIU(8925,TIUDA,21))
"RTN","TIUSRVP1",153,0)
 S TIUX(2101)="@"
"RTN","TIUSRVP1",154,0)
 D FILE^TIUSRVP(.TIUY,TIUDA,.TIUX,1)
"RTN","TIUSRVP1",155,0)
 D AUDLINK^TIUGR1(TIUDA,"d",IDDAD)
"RTN","TIUSRVP1",156,0)
 D IDDEL^TIUALRT1(TIUDA)
"RTN","TIUSRVP1",157,0)
 Q
"RTN","TIUSRVP1",158,0)
CANDEL(TIUDA) ; Boolean function to evaluate delete request
"RTN","TIUSRVP1",159,0)
 Q $S($P(^TIU(8925,TIUDA,0),U,5)>3:0,'+$$EMPTYDOC^TIULF(TIUDA):0,1:1)
"RTN","TIUSRVR")
0^17^B16915874
"RTN","TIUSRVR",1,0)
TIUSRVR ; SLC/JER - Server fns for record manipulation ; 01/22/2002 16:18
"RTN","TIUSRVR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,28,69,89,122,109,112**;Jun 20, 1997
"RTN","TIUSRVR",3,0)
SGET(TIUY,DA) ; Get fixed fields for record TIUDA
"RTN","TIUSRVR",4,0)
 N DOC,LOC,PT,AUT,EDT,DTFMT,TIUPT,TIULST4,TIUREC,TIUR0,TIUR12,TIUR13
"RTN","TIUSRVR",5,0)
 N SUBJ,TIUCNT
"RTN","TIUSRVR",6,0)
 S TIUR0=$G(^TIU(8925,+DA,0)),TIUR12=$G(^TIU(8925,+DA,12))
"RTN","TIUSRVR",7,0)
 S TIUR13=$G(^TIU(8925,+DA,13)),TIUPT=$G(^DPT(+$P(TIUR0,U,2),0))
"RTN","TIUSRVR",8,0)
 S SUBJ=$G(^TIU(8925,+DA,17))
"RTN","TIUSRVR",9,0)
 S DOC=$$PNAME^TIULC1(+TIUR0)
"RTN","TIUSRVR",10,0)
 S LOC=$P($G(^SC(+$P(TIUR12,U,5),0)),U)
"RTN","TIUSRVR",11,0)
 S PT=$$NAME^TIULS($P(TIUPT,U),"LAST, FIRST MI")
"RTN","TIUSRVR",12,0)
 S TIULST4=$E($P(TIUPT,U,9),6,9)
"RTN","TIUSRVR",13,0)
 S TIULST4="("_$E(PT)_TIULST4_")"
"RTN","TIUSRVR",14,0)
 S AUT=$$SIGNAME^TIULS(+$P(TIUR12,U,2))
"RTN","TIUSRVR",15,0)
 S DTFMT=$S($L(+TIUR13,".")=2:"MM/DD/YY HR:MIN",1:"MM/DD/YY")
"RTN","TIUSRVR",16,0)
 S EDT=$$DATE^TIULS(+TIUR13,DTFMT)
"RTN","TIUSRVR",17,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUSRVR",18,0)
 S TIUY=DOC_U_EDT_U_PT_" "_TIULST4_U_AUT_U_LOC_U_SUBJ
"RTN","TIUSRVR",19,0)
 Q
"RTN","TIUSRVR",20,0)
TGET(TIUY,TIUDA,TIUJ,TIUDAD) ; Get each component
"RTN","TIUSRVR",21,0)
 N TIUKID,TIUDADT,TIUI,TIUSEE S TIUI=0
"RTN","TIUSRVR",22,0)
 S TIUSEE=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUSRVR",23,0)
 I '+TIUSEE D  Q
"RTN","TIUSRVR",24,0)
 . S TIUY(1)="  "
"RTN","TIUSRVR",25,0)
 . S TIUY(2)=$P(TIUSEE,"^ ",2),(TIUI,TIUJ)=2
"RTN","TIUSRVR",26,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR",27,0)
 . S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRVR",28,0)
 . S TIUY(TIUJ)=$G(^TIU(8925,+TIUDA,"TEXT",TIUI,0))
"RTN","TIUSRVR",29,0)
 . ;S ^TMP("TIUTEXT",$J,TIUJ,0)=$G(^TIU(8925,+TIUDA,"TEXT",TIUI,0))
"RTN","TIUSRVR",30,0)
 ; Iterate through children, and get their text fields
"RTN","TIUSRVR",31,0)
 S TIUKID=0
"RTN","TIUSRVR",32,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRVR",33,0)
 . D TGET(.TIUY,TIUKID,.TIUJ,$G(TIUDAD,TIUDA))
"RTN","TIUSRVR",34,0)
 ;I $D(^TMP("TIUTEXT",$J)) S TIUY="^TMP(""TIUTEXT"",$J)"
"RTN","TIUSRVR",35,0)
 Q
"RTN","TIUSRVR",36,0)
GET4EDIT(TIUY,TIUDA,DR) ; Get data in preparation for editing a record
"RTN","TIUSRVR",37,0)
 N CANEDIT,ERR,D0,DIQ2,TIUARR,TIUF,TIUI
"RTN","TIUSRVR",38,0)
 I +$D(^TIU(8925,TIUDA,"TEMP")) D MERGTEXT(TIUDA)
"RTN","TIUSRVR",39,0)
 K ^TMP("TIUEDIT",$J),^TMP("TIULQ",$J)
"RTN","TIUSRVR",40,0)
 S TIUY=$NA(^TMP("TIUEDIT",$J)),TIUARR=$NA(^TMP("TIULQ",$J))
"RTN","TIUSRVR",41,0)
 S CANEDIT=$$CANDO^TIULP(TIUDA,"EDIT RECORD")
"RTN","TIUSRVR",42,0)
 I +CANEDIT'>0 S ^TMP("TIUEDIT",$J,0)="~"_$P(CANEDIT,U,2) Q
"RTN","TIUSRVR",43,0)
 D EXTRACT^TIULQ(TIUDA,TIUARR,.ERR,$G(DR),"",1,"IE",1)
"RTN","TIUSRVR",44,0)
 I $D(ERR) M TIUY=ERR Q
"RTN","TIUSRVR",45,0)
 S TIUF=0
"RTN","TIUSRVR",46,0)
 F  S TIUF=$O(@TIUARR@(TIUDA,TIUF)) Q:+TIUF'>0  D
"RTN","TIUSRVR",47,0)
 . S ^TMP("TIUEDIT",$J,TIUF)=TIUF_U_@TIUARR@(TIUDA,TIUF,"I")_U_@TIUARR@(TIUDA,TIUF,"E")
"RTN","TIUSRVR",48,0)
 S TIUI=0
"RTN","TIUSRVR",49,0)
 F  S TIUI=$O(@TIUARR@(TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR",50,0)
 . S ^TMP("TIUEDIT",$J,"TEXT",TIUI)=$G(@TIUARR@(TIUDA,"TEXT",TIUI,0))
"RTN","TIUSRVR",51,0)
 S ^TMP("TIUEDIT",$J,"TEXT",0)="$TXT",^TIU(8925,"ASAVE",DUZ,TIUDA)=""
"RTN","TIUSRVR",52,0)
 K @TIUARR
"RTN","TIUSRVR",53,0)
 Q
"RTN","TIUSRVR",54,0)
GETPREF(TIUY,USER) ; Get user's personal preferences
"RTN","TIUSRVR",55,0)
 ; Call with TIUY (by ref)
"RTN","TIUSRVR",56,0)
 ;           USER is pointer to file 200
"RTN","TIUSRVR",57,0)
 ; Returns   TIUY = USER ^ DEFAULT LOCATION ^ REVIEW SCREEN SORT FIELD ^
"RTN","TIUSRVR",58,0)
 ;               ==>REVIEW SCREEN SORT ORDER ^ DISPLAY MENUS ^ PATIENT
"RTN","TIUSRVR",59,0)
 ;               ==>SELECTION PREFERENCE ^ ASK 'Save changes?' AFTER
"RTN","TIUSRVR",60,0)
 ;               ==>EDIT ^ ASK SUBJECT FOR PROGRESS NOTES ^
"RTN","TIUSRVR",61,0)
 S TIUY=$$PERSPRF^TIULE(USER)
"RTN","TIUSRVR",62,0)
 Q
"RTN","TIUSRVR",63,0)
GETALRT(TIUY,XQAID) ;  Retrieve DFN and document type for a TIU alert
"RTN","TIUSRVR",64,0)
 N X,TIUDA,TIUDFN,ORTAB,TIUDAD,GMRCO
"RTN","TIUSRVR",65,0)
 S TIUDA=$TR($P(XQAID,";",1),"ABCDEFGHIJKLMNOPQRSTUVWXYZ") ; Strip Text
"RTN","TIUSRVR",66,0)
 I '+TIUDA!('$D(^TIU(8925,+TIUDA,0))) S TIUY="-1" Q
"RTN","TIUSRVR",67,0)
 S X=$P($G(^TIU(8925,TIUDA,0)),U)
"RTN","TIUSRVR",68,0)
 S TIUDFN=$P(^TIU(8925,TIUDA,0),U,2)
"RTN","TIUSRVR",69,0)
 I $P(^TIU(8925,TIUDA,0),U,6)'="" D
"RTN","TIUSRVR",70,0)
 . S TIUDAD=$P(^TIU(8925,TIUDA,0),U,6)
"RTN","TIUSRVR",71,0)
 . S X=$P($G(^TIU(8925,TIUDAD,0)),U)
"RTN","TIUSRVR",72,0)
 I ('+X)!('+TIUDFN) S TIUY="-1" Q
"RTN","TIUSRVR",73,0)
 S ORTAB=903    ;DEFAULT TO PN
"RTN","TIUSRVR",74,0)
 I +$$ISDS^TIULX(X) S ORTAB=901
"RTN","TIUSRVR",75,0)
 I +$$ISA^TIULX(X,$$CLASS^TIUSROI("SURGICAL REPORTS")) S ORTAB=904
"RTN","TIUSRVR",76,0)
 I +$$ISA^TIULX(X,$$CLASS^TIUCNSLT)!(+$$ISA^TIULX(X,+$$CLASS^TIUCP)) D
"RTN","TIUSRVR",77,0)
 . S GMRCO=$P(^TIU(8925,$S(+$G(TIUDAD):TIUDAD,1:TIUDA),14),U,5)
"RTN","TIUSRVR",78,0)
 . S ORTAB=902_";"_GMRCO
"RTN","TIUSRVR",79,0)
 S TIUY=TIUDA_U_TIUDFN_U_ORTAB
"RTN","TIUSRVR",80,0)
 Q
"RTN","TIUSRVR",81,0)
GET1405(TIUY,TIUDA) ; Get the Request (field #1405) for a document
"RTN","TIUSRVR",82,0)
 N TIUDAD,TIUTYP,TIU1405
"RTN","TIUSRVR",83,0)
 I '+TIUDA!('$D(^TIU(8925,+TIUDA,0))) S TIUY="-1^TIU Document does not exist" Q
"RTN","TIUSRVR",84,0)
 S TIUTYP=$P($G(^TIU(8925,TIUDA,0)),U)
"RTN","TIUSRVR",85,0)
 I $P(^TIU(8925,TIUDA,0),U,6)'="" D
"RTN","TIUSRVR",86,0)
 . S TIUDAD=$P(^TIU(8925,TIUDA,0),U,6)
"RTN","TIUSRVR",87,0)
 . S TIUTYP=$P($G(^TIU(8925,TIUDAD,0)),U)
"RTN","TIUSRVR",88,0)
 I '+TIUTYP S TIUY="-1^TIU parent document does not exist" Q
"RTN","TIUSRVR",89,0)
 S TIU1405=$P($G(^TIU(8925,$S(+$G(TIUDAD):TIUDAD,1:TIUDA),14)),U,5)
"RTN","TIUSRVR",90,0)
 I '+TIU1405 S TIUY="-1^No Request found for this document" Q
"RTN","TIUSRVR",91,0)
 S TIUY=TIU1405
"RTN","TIUSRVR",92,0)
 Q
"RTN","TIUSRVR",93,0)
MERGTEXT(TIUDA) ; Merge text from "TEMP"-node to "TEXT"-node
"RTN","TIUSRVR",94,0)
 N TIU
"RTN","TIUSRVR",95,0)
 D CLEANTXT(TIUDA)
"RTN","TIUSRVR",96,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSRVR",97,0)
 D MERGTEXT^TIUEDI1(TIUDA,.TIU)
"RTN","TIUSRVR",98,0)
 K ^TIU(8925,TIUDA,"TEMP")
"RTN","TIUSRVR",99,0)
 Q
"RTN","TIUSRVR",100,0)
CLEANTXT(TIUDA) ; Remove "TEXT"-nodes of document and components
"RTN","TIUSRVR",101,0)
 N TIUI S TIUI=0
"RTN","TIUSRVR",102,0)
 K ^TIU(8925,TIUDA,"TEXT")
"RTN","TIUSRVR",103,0)
 F  S TIUI=$O(^TIU(8925,"DAD",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR",104,0)
 . I +$$ISADDNDM^TIULC1(TIUI) Q
"RTN","TIUSRVR",105,0)
 . K ^TIU(8925,TIUI,"TEXT")
"RTN","TIUSRVR",106,0)
 Q
"RTN","TIUSRVR1")
0^5^B31783728
"RTN","TIUSRVR1",1,0)
TIUSRVR1 ; SLC/JER - RPC for record-wise GET ; 01/22/2002 16:48
"RTN","TIUSRVR1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,32,87,89,100,109,112**;Jun 20, 1997
"RTN","TIUSRVR1",3,0)
TGET(TIUY,TIUDA,ACTION) ; Build ^TMP("TIUVIEW",$J,
"RTN","TIUSRVR1",4,0)
 N TIUL,TIUREC,TIUARR,TIUGDATA,TIUNAME,TIUPRM0,TIUPRM1,X,Y,TIUCPF,ONBROWSE
"RTN","TIUSRVR1",5,0)
 K ^TMP("TIUVIEW",$J),^TMP("TIU FOCUS",$J)
"RTN","TIUSRVR1",6,0)
 S ACTION=$G(ACTION,"VIEW"),TIUL=0
"RTN","TIUSRVR1",7,0)
 D SETPARM^TIULE
"RTN","TIUSRVR1",8,0)
 S TIUGDATA=$$SETGDATA(TIUDA)
"RTN","TIUSRVR1",9,0)
 I +$D(^TIU(8925,TIUDA,"TEMP")) D MERGTEXT^TIUSRVR(TIUDA)
"RTN","TIUSRVR1",10,0)
 S TIUY=$NA(^TMP("TIUVIEW",$J))
"RTN","TIUSRVR1",11,0)
 S TIUARR="^TMP(""TIUVIEW"",$J)"
"RTN","TIUSRVR1",12,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUSRVR1",13,0)
 ; Initialize ^TMP("TIU FOCUS",$J) to the entry that has focus
"RTN","TIUSRVR1",14,0)
 S ^TMP("TIU FOCUS",$J)=TIUDA
"RTN","TIUSRVR1",15,0)
 ; if the document has a browse action, execute it
"RTN","TIUSRVR1",16,0)
 S ONBROWSE=$$ONBROWSE^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUSRVR1",17,0)
 I $L(ONBROWSE) D LOADSUPP(ONBROWSE,TIUDA,.TIUL)
"RTN","TIUSRVR1",18,0)
 ; Call INQUIRE to get record
"RTN","TIUSRVR1",19,0)
 ;Set a flag to indicate whether or not a Title is a memer of the
"RTN","TIUSRVR1",20,0)
 ;Clinical Procedures Class (1=Yes and 0=No)
"RTN","TIUSRVR1",21,0)
 S TIUCPF=+$$ISA^TIULX(+$G(^TIU(8925,TIUDA,0)),+$$CLASS^TIUCP)
"RTN","TIUSRVR1",22,0)
 ; Call INQUIRE to get record
"RTN","TIUSRVR1",23,0)
 D INQUIRE^TIUSRVR2(TIUDA,.TIUREC,TIUCPF)
"RTN","TIUSRVR1",24,0)
 ; First, load dictation, transcription data, etc.
"RTN","TIUSRVR1",25,0)
 D LOADTOP(.TIUREC,TIUDA,.TIUL,TIUGDATA,TIUCPF)
"RTN","TIUSRVR1",26,0)
 ; Next, load the remainder of the record
"RTN","TIUSRVR1",27,0)
 D LOADREC^TIUSRVR2(TIUDA,.TIUL,TIUGDATA,0,ACTION)
"RTN","TIUSRVR1",28,0)
 K ^TMP("TIU FOCUS",$J)
"RTN","TIUSRVR1",29,0)
 S VALMCNT=+$G(TIUL)
"RTN","TIUSRVR1",30,0)
 Q
"RTN","TIUSRVR1",31,0)
SETGDATA(TIUDA) ; Set TIUGDATA
"RTN","TIUSRVR1",32,0)
 N TIUY,SORT S TIUY=""
"RTN","TIUSRVR1",33,0)
 D DOCPRM^TIULC1(+$G(^TIU(8925,TIUDA,0)),.TIUDPRM,TIUDA)
"RTN","TIUSRVR1",34,0)
 S SORT=$S(+$P(TIUDPRM(0),U,18):"TITLE",1:"REFDT")
"RTN","TIUSRVR1",35,0)
 I +$G(^TIU(8925,TIUDA,21)) S TIUY=TIUDA_U_0_U_+$G(^(21))_U_SORT G SETGX
"RTN","TIUSRVR1",36,0)
 I +$O(^TIU(8925,"GDAD",TIUDA,0)) S TIUY=TIUDA_U_1_U_0_U_SORT
"RTN","TIUSRVR1",37,0)
SETGX Q TIUY
"RTN","TIUSRVR1",38,0)
LOADSUPP(METHOD,TIUDA,TIUL)     ; Execute OnBrowse/Load Supplementary data
"RTN","TIUSRVR1",39,0)
 N TIUY,TIUI S TIUI=0
"RTN","TIUSRVR1",40,0)
 X METHOD I '$D(@TIUY) Q
"RTN","TIUSRVR1",41,0)
 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR1",42,0)
 . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL,0)=$G(@TIUY@(TIUI))
"RTN","TIUSRVR1",43,0)
 S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL,0)=" "
"RTN","TIUSRVR1",44,0)
 K @TIUY
"RTN","TIUSRVR1",45,0)
 Q
"RTN","TIUSRVR1",46,0)
LOADTOP(TIUREC,TIUDA,TIUL,TIUGDATA,TIUCPF) ; Load top information
"RTN","TIUSRVR1",47,0)
 N TIUY,SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT
"RTN","TIUSRVR1",48,0)
 ; ---- For ID note, include Title, [Location, & Visit] with each
"RTN","TIUSRVR1",49,0)
 ;      entry, since they vary by entry.
"RTN","TIUSRVR1",50,0)
 ; ---- Follow with Date, Author, etc.
"RTN","TIUSRVR1",51,0)
 ; ---- For ID children in whole note display, shorten top info:
"RTN","TIUSRVR1",52,0)
 ;      Instead of Title, Location, Visit, Date, Author, etc.,
"RTN","TIUSRVR1",53,0)
 ;      use just Title, followed by just Date and Status:
"RTN","TIUSRVR1",54,0)
 S (SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT)=0
"RTN","TIUSRVR1",55,0)
 I $P(TIUGDATA,U,3) S SELCHLD=1 ; Selected record was IDchild
"RTN","TIUSRVR1",56,0)
 I $P(TIUGDATA,U,2) S SELPRNT=1
"RTN","TIUSRVR1",57,0)
 I SELCHLD,TIUDA'=$P(TIUGDATA,U,3) S CURCHLD=1 ; Current rec is IDchild
"RTN","TIUSRVR1",58,0)
 I SELCHLD,TIUDA=$P(TIUGDATA,U,3) S CURPRNT=1
"RTN","TIUSRVR1",59,0)
 I SELPRNT,TIUDA=+TIUGDATA S CURPRNT=1
"RTN","TIUSRVR1",60,0)
 I SELPRNT,TIUDA'=+TIUGDATA S CURCHLD=1
"RTN","TIUSRVR1",61,0)
 I SELPRNT,CURCHLD S SHORT=1 ;Child in whole note: shorten top info
"RTN","TIUSRVR1",62,0)
 I SELCHLD,CURCHLD,$G(TIUGWHOL) S SHORT=1
"RTN","TIUSRVR1",63,0)
 I SELCHLD!SELPRNT D IDTOP(TIUDA,.TIUL,SHORT,CURPRNT) I 1
"RTN","TIUSRVR1",64,0)
 S TIUY=""
"RTN","TIUSRVR1",65,0)
 E  I $L(TIUREC(8925,+TIUDA,.01)) D
"RTN","TIUSRVR1",66,0)
 . S TIUY=$$SETSTR^VALM1("TITLE: "_TIUREC(8925,+TIUDA,.01),TIUY,8,64)
"RTN","TIUSRVR1",67,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",68,0)
 S TIUY=""
"RTN","TIUSRVR1",69,0)
 I SHORT D
"RTN","TIUSRVR1",70,0)
 . S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),TIUY,1,39)
"RTN","TIUSRVR1",71,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),TIUY,42,38)
"RTN","TIUSRVR1",72,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",73,0)
 S TIUY=""
"RTN","TIUSRVR1",74,0)
 I 'SHORT D
"RTN","TIUSRVR1",75,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUSRVR1",76,0)
 . . S TIUY=$$SETSTR^VALM1("DICT DATE: "_TIUREC(8925,+TIUDA,1307),TIUY,4,39)
"RTN","TIUSRVR1",77,0)
 . E  S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),TIUY,1,39)
"RTN","TIUSRVR1",78,0)
 . S TIUY=$$SETSTR^VALM1("ENTRY DATE: "_TIUREC(8925,+TIUDA,1201),$G(TIUY),38,39)
"RTN","TIUSRVR1",79,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",80,0)
 . S TIUY=""
"RTN","TIUSRVR1",81,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUSRVR1",82,0)
 . . S TIUY=$$SETSTR^VALM1("DICTATED BY: "_TIUREC(8925,+TIUDA,1202),TIUY,2,32)
"RTN","TIUSRVR1",83,0)
 . E  S TIUY=$$SETSTR^VALM1("AUTHOR: "_TIUREC(8925,+TIUDA,1202),TIUY,7,32)
"RTN","TIUSRVR1",84,0)
 . I $L(TIUREC(8925,+TIUDA,1209)) D  I 1
"RTN","TIUSRVR1",85,0)
 . . S TIUY=$$SETSTR^VALM1("ATTENDING: "_TIUREC(8925,+TIUDA,1209),TIUY,39,40)
"RTN","TIUSRVR1",86,0)
 . E  S TIUY=$$SETSTR^VALM1("EXP COSIGNER: "_TIUREC(8925,+TIUDA,1208),TIUY,36,40)
"RTN","TIUSRVR1",87,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",88,0)
 . S TIUY=""
"RTN","TIUSRVR1",89,0)
 . S TIUY=$$SETSTR^VALM1("URGENCY: "_TIUREC(8925,+TIUDA,.09),TIUY,6,36)
"RTN","TIUSRVR1",90,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),TIUY,42,38)
"RTN","TIUSRVR1",91,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",92,0)
 S TIUY=""
"RTN","TIUSRVR1",93,0)
 I '$L($G(^TIU(8925,+TIUDA,17))) D  I 1
"RTN","TIUSRVR1",94,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",95,0)
 E  D
"RTN","TIUSRVR1",96,0)
 . S TIUY=$$SETSTR^VALM1("SUBJECT: "_$G(^TIU(8925,+TIUDA,17)),TIUY,6,74)
"RTN","TIUSRVR1",97,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",98,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR1",99,0)
 ;If the document is a member of the Clinical Procedures Class, include the
"RTN","TIUSRVR1",100,0)
 ; Procedure Summary Code field and the Date/Time Performed field
"RTN","TIUSRVR1",101,0)
 I $G(TIUCPF) D
"RTN","TIUSRVR1",102,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUSRVR1",103,0)
 . S TIUY=$$SETSTR^VALM1("PROCEDURE SUMMARY CODE: "_TIUREC(8925,+TIUDA,70201),$G(TIUY),1,54)
"RTN","TIUSRVR1",104,0)
 . S @TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",105,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUSRVR1",106,0)
 . S TIUY=$$SETSTR^VALM1("DATE/TIME PERFORMED: "_TIUREC(8925,+TIUDA,70202),$G(TIUY),1,41)
"RTN","TIUSRVR1",107,0)
 . S @TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",108,0)
 . S TIUL=TIUL+1,TIUY="",@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",109,0)
 I +$$HASADDEN^TIULC1(TIUDA) D
"RTN","TIUSRVR1",110,0)
 . S TIUY="   *** "_$$PNAME^TIULC1(+$G(^TIU(8925,TIUDA,0)))
"RTN","TIUSRVR1",111,0)
 . S TIUY=TIUY_" Has ADDENDA ***"
"RTN","TIUSRVR1",112,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",113,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR1",114,0)
 Q
"RTN","TIUSRVR1",115,0)
 ;
"RTN","TIUSRVR1",116,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUSRVR1",117,0)
 N TIUY,TIUTYP
"RTN","TIUSRVR1",118,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUSRVR1",119,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUSRVR1",120,0)
 Q TIUY
"RTN","TIUSRVR1",121,0)
IDTOP(TIUDA,TIUL,SHORT,CURPRNT) ; Load entry-specific info:
"RTN","TIUSRVR1",122,0)
 ;Title, [Location, Visit] for ID entry.
"RTN","TIUSRVR1",123,0)
 ; Called by LOADTOP
"RTN","TIUSRVR1",124,0)
 N TIUY,TIUX,TIU
"RTN","TIUSRVR1",125,0)
 I CURPRNT S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="                         << Interdisciplinary Note >>"
"RTN","TIUSRVR1",126,0)
 I SHORT S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="                      << Interdisciplinary Note - Cont. >>"
"RTN","TIUSRVR1",127,0)
 D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUSRVR1",128,0)
 S TIUY="",TIUX="TITLE: "_$P($G(TIU("DOCTYP")),U,2)
"RTN","TIUSRVR1",129,0)
 S TIUY=$$SETSTR^VALM1(TIUX,TIUY,1,67)
"RTN","TIUSRVR1",130,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",131,0)
 Q:SHORT
"RTN","TIUSRVR1",132,0)
 S TIUY="",TIUX="LOCATION: "_$P($G(TIU("LOC")),U,2)
"RTN","TIUSRVR1",133,0)
 S TIUY=$$SETSTR^VALM1(TIUX,TIUY,5,31)
"RTN","TIUSRVR1",134,0)
 I $L($G(TIU("WARD"))) D  I 1
"RTN","TIUSRVR1",135,0)
 . S TIUX="ADMISSION DATE: "_$P($G(TIU("EDT")),U,2)
"RTN","TIUSRVR1",136,0)
 . S TIUY=$$SETSTR^VALM1(TIUX,TIUY,34,37)
"RTN","TIUSRVR1",137,0)
 E  D
"RTN","TIUSRVR1",138,0)
 . S TIUX="VISIT DATE: "_$P($G(TIU("EDT")),U,2)
"RTN","TIUSRVR1",139,0)
 . S TIUY=$$SETSTR^VALM1(TIUX,TIUY,38,33)
"RTN","TIUSRVR1",140,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",141,0)
 Q
"SEC","^DD",8925.1,8925.1,.01,8.5)

"SEC","^DIC",811.8,811.8,0,"AUDIT")
@
"SEC","^DIC",811.8,811.8,0,"DD")
@
"SEC","^DIC",811.8,811.8,0,"DEL")
@
"SEC","^DIC",811.8,811.8,0,"LAYGO")
@
"SEC","^DIC",811.8,811.8,0,"RD")

"SEC","^DIC",811.8,811.8,0,"WR")
@
"VER")
8.0^22.0
"^DD",811.8,811.8,0)
FIELD^^130^8
"^DD",811.8,811.8,0,"DDA")
N
"^DD",811.8,811.8,0,"DT")
3010313
"^DD",811.8,811.8,0,"NM","REMINDER EXCHANGE FILE")

"^DD",811.8,811.8,0,"SCR")
I 0>1
"^DD",811.8,811.8,0,"VRPK")
PXRM
"^DD",811.8,811.8,.01,0)
NAME^RFX^^0;1^K:$L(X)>64!($L(X)<3)!'(X'?1P.E) X
"^DD",811.8,811.8,.01,.1)

"^DD",811.8,811.8,.01,1,0)
^.1^^0
"^DD",811.8,811.8,.01,3)
Answer must be 3-64 characters in length.
"^DD",811.8,811.8,.01,21,0)
^.001^2^2^3010316^^^^
"^DD",811.8,811.8,.01,21,1,0)
This is the name of the entry in the Exchange File. It will be the same
"^DD",811.8,811.8,.01,21,2,0)
as the name of the reminder definition that was packed.
"^DD",811.8,811.8,.01,"DT")
3010601
"^DD",811.8,811.8,.02,0)
SOURCE^F^^0;2^K:$L(X)>64!($L(X)<3) X
"^DD",811.8,811.8,.02,3)
Answer must be 3-64 characters in length.
"^DD",811.8,811.8,.02,21,0)
^^2^2^3010316^
"^DD",811.8,811.8,.02,21,1,0)
This is the source of the packed reminder. It will contain the name of
"^DD",811.8,811.8,.02,21,2,0)
person who packed it and their site.
"^DD",811.8,811.8,.02,"DT")
3000706
"^DD",811.8,811.8,.03,0)
DATE PACKED^D^^0;3^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",811.8,811.8,.03,21,0)
^^3^3^3010316^
"^DD",811.8,811.8,.03,21,1,0)
This is the date and time the reminder was originally packed. When a
"^DD",811.8,811.8,.03,21,2,0)
packed reminder is put into the Exchange File from a MailMan message or
"^DD",811.8,811.8,.03,21,3,0)
a host file this will reflect the original packing date and time.
"^DD",811.8,811.8,.03,"DT")
3000712
"^DD",811.8,811.8,100,0)
DATA^811.801A^^100;0
"^DD",811.8,811.8,100,21,0)
^^1^1^3010316^
"^DD",811.8,811.8,100,21,1,0)
This node contains the actual packed reminder as XML data.
"^DD",811.8,811.8,110,0)
DESCRIPTION^811.804^^110;0
"^DD",811.8,811.8,110,21,0)
^.001^4^4^3010530^^^
"^DD",811.8,811.8,110,21,1,0)
This contains formatted information about the Exchange File entry. It
"^DD",811.8,811.8,110,21,2,0)
includes source information, a brief description, and keywords. This
"^DD",811.8,811.8,110,21,3,0)
information will be displayed when an entry is selected for possible
"^DD",811.8,811.8,110,21,4,0)
installation.
"^DD",811.8,811.8,119,0)
NUMBER OF UNIQUE COMPONENTS^NJ6,0^^110;1^K:+X'=X!(X>100000)!(X<0)!(X?.E1"."1N.N) X
"^DD",811.8,811.8,119,3)
Type a Number between 0 and 100000, 0 Decimal Digits
"^DD",811.8,811.8,119,21,0)
^^1^1^3010316^
"^DD",811.8,811.8,119,21,1,0)
This is the number of unique components in the packed reminder.
"^DD",811.8,811.8,119,"DT")
3001103
"^DD",811.8,811.8,120,0)
COMPONENT LIST^811.802A^^120;0
"^DD",811.8,811.8,120,21,0)
^.001^1^1^3010316^^
"^DD",811.8,811.8,120,21,1,0)
This is a list of components that are included in the packed reminder.
"^DD",811.8,811.8,130,0)
INSTALLATION HISTORY^811.803DA^^130;0
"^DD",811.8,811.8,130,21,0)
^.001^2^2^3010316^^
"^DD",811.8,811.8,130,21,1,0)
This multiple is used to record a history of every time a packed
"^DD",811.8,811.8,130,21,2,0)
reminder is installed.
"^DD",811.8,811.801,0)
DATA SUB-FIELD^I^.01^1
"^DD",811.8,811.801,0,"DT")
3000706
"^DD",811.8,811.801,0,"IX","B",811.801,.01)

"^DD",811.8,811.801,0,"NM","DATA")

"^DD",811.8,811.801,0,"UP")
811.8
"^DD",811.8,811.801,.01,0)
DATA^F^^0;1^K:$L(X)>245!($L(X)<1) X
"^DD",811.8,811.801,.01,1,0)
^.1
"^DD",811.8,811.801,.01,1,1,0)
811.801^B
"^DD",811.8,811.801,.01,1,1,1)
S ^PXD(811.8,DA(1),100,"B",$E(X,1,30),DA)=""
"^DD",811.8,811.801,.01,1,1,2)
K ^PXD(811.8,DA(1),100,"B",$E(X,1,30),DA)
"^DD",811.8,811.801,.01,3)
Answer must be 1-245 characters in length.
"^DD",811.8,811.801,.01,21,0)
^^1^1^3010316^
"^DD",811.8,811.801,.01,21,1,0)
This is a line of XML data.
"^DD",811.8,811.801,.01,"DT")
3000706
"^DD",811.8,811.802,0)
COMPONENT LIST SUB-FIELD^^1^4
"^DD",811.8,811.802,0,"DT")
3010130
"^DD",811.8,811.802,0,"NM","COMPONENT LIST")

"^DD",811.8,811.802,0,"UP")
811.8
"^DD",811.8,811.802,.01,0)
COMPONENT^F^^0;1^K:$L(X)>64!($L(X)<1) X
"^DD",811.8,811.802,.01,1,0)
^.1^^0
"^DD",811.8,811.802,.01,3)
Answer must be 1-64 characters in length.
"^DD",811.8,811.802,.01,21,0)
^^1^1^3010316^
"^DD",811.8,811.802,.01,21,1,0)
This is the name of the component, for example ROUTINE or EDUCATION TOPIC.
"^DD",811.8,811.802,.01,"DT")
3000728
"^DD",811.8,811.802,.02,0)
FILE NUMBER^NJ14,4^^0;2^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."5N.N) X
"^DD",811.8,811.802,.02,3)
Type a Number between 1 and 999999999, 4 Decimal Digits
"^DD",811.8,811.802,.02,21,0)
^^2^2^3010316^
"^DD",811.8,811.802,.02,21,1,0)
This is the file number of the component. If the component is a routine
"^DD",811.8,811.802,.02,21,2,0)
then the file number will be 0.
"^DD",811.8,811.802,.02,"DT")
3001101
"^DD",811.8,811.802,.03,0)
NUMBER OF ITEMS^NJ4,0^^0;3^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",811.8,811.802,.03,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",811.8,811.802,.03,21,0)
^^4^4^3010316^
"^DD",811.8,811.802,.03,21,1,0)
This is the number of this type of component that are included in the
"^DD",811.8,811.802,.03,21,2,0)
packed reminder. For example, if this particular component is Health
"^DD",811.8,811.802,.03,21,3,0)
Factors and there are three of them in the packed reminder the NUMBER
"^DD",811.8,811.802,.03,21,4,0)
OF ITEMS would be 3.
"^DD",811.8,811.802,.03,"DT")
3001101
"^DD",811.8,811.802,1,0)
ITEM LIST^811.8021A^^1;0
"^DD",811.8,811.802,1,21,0)
^^3^3^3010316^
"^DD",811.8,811.802,1,21,1,0)
This is the list of items of the component type. For example, if the
"^DD",811.8,811.802,1,21,2,0)
component type is health factors and there are three of them the three
"^DD",811.8,811.802,1,21,3,0)
entries are specified in this list.
"^DD",811.8,811.8021,0)
ITEM LIST SUB-FIELD^^2^5
"^DD",811.8,811.8021,0,"DT")
3010130
"^DD",811.8,811.8021,0,"IX","B",811.8021,.01)

"^DD",811.8,811.8021,0,"NM","ITEM LIST")

"^DD",811.8,811.8021,0,"UP")
811.802
"^DD",811.8,811.8021,.01,0)
ITEM^F^^0;1^K:$L(X)>64!($L(X)<1) X
"^DD",811.8,811.8021,.01,1,0)
^.1
"^DD",811.8,811.8021,.01,1,1,0)
811.8021^B
"^DD",811.8,811.8021,.01,1,1,1)
S ^PXD(811.8,DA(2),120,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",811.8,811.8021,.01,1,1,2)
K ^PXD(811.8,DA(2),120,DA(1),1,"B",$E(X,1,30),DA)
"^DD",811.8,811.8021,.01,3)
Answer must be 1-64 characters in length.
"^DD",811.8,811.8021,.01,21,0)
^^1^1^3010316^
"^DD",811.8,811.8021,.01,21,1,0)
This is the name of the item.
"^DD",811.8,811.8021,.01,"DT")
3000728
"^DD",811.8,811.8021,.02,0)
START LINE^NJ4,0^^0;2^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",811.8,811.8021,.02,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",811.8,811.8021,.02,21,0)
^^1^1^3010316^
"^DD",811.8,811.8021,.02,21,1,0)
This is the line in node 100 where the data for this item starts.
"^DD",811.8,811.8021,.02,"DT")
3000728
"^DD",811.8,811.8021,.03,0)
END LINE^NJ4,0^^0;3^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",811.8,811.8021,.03,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",811.8,811.8021,.03,21,0)
^^1^1^3010316^
"^DD",811.8,811.8021,.03,21,1,0)
This is the line in node 100 where the data for this item ends.
"^DD",811.8,811.8021,.03,"DT")
3000728
"^DD",811.8,811.8021,1,0)
IEN ROOT START LINE^NJ4,0^^0;4^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",811.8,811.8021,1,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",811.8,811.8021,1,21,0)
^^1^1^3010316^
"^DD",811.8,811.8021,1,21,1,0)
This is the line in node 100 where the ien root for this item starts.
"^DD",811.8,811.8021,1,"DT")
3010130
"^DD",811.8,811.8021,2,0)
IEN ROOT END LINE^NJ4,0^^0;5^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",811.8,811.8021,2,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",811.8,811.8021,2,21,0)
^^1^1^3010316^
"^DD",811.8,811.8021,2,21,1,0)
This is the line in node 100 where the ien root ends.
"^DD",811.8,811.8021,2,"DT")
3010130
"^DD",811.8,811.803,0)
INSTALLATION HISTORY SUB-FIELD^^1^3
"^DD",811.8,811.803,0,"DT")
3010313
"^DD",811.8,811.803,0,"NM","INSTALLATION HISTORY")

"^DD",811.8,811.803,0,"UP")
811.8
"^DD",811.8,811.803,.01,0)
INSTALLATION DATE AND TIME^D^^0;1^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",811.8,811.803,.01,1,0)
^.1^^0
"^DD",811.8,811.803,.01,21,0)
^^1^1^3010316^
"^DD",811.8,811.803,.01,21,1,0)
This is the date and time of the installation.
"^DD",811.8,811.803,.01,"DT")
3001121
"^DD",811.8,811.803,.02,0)
INSTALLED BY^F^^0;2^K:$L(X)>45!($L(X)<1) X
"^DD",811.8,811.803,.02,3)
Answer must be 1-45 characters in length.
"^DD",811.8,811.803,.02,21,0)
^^1^1^3010316^
"^DD",811.8,811.803,.02,21,1,0)
This is the person who did the installation.
"^DD",811.8,811.803,.02,"DT")
3001116
"^DD",811.8,811.803,1,0)
COMPONENT LIST^811.8031A^^1;0
"^DD",811.8,811.803,1,21,0)
^.001^2^2^3010316^^
"^DD",811.8,811.803,1,21,1,0)
This list contains a multiple of the packed reminder components that
"^DD",811.8,811.803,1,21,2,0)
were selected as part of this installation.
"^DD",811.8,811.8031,0)
COMPONENT LIST SUB-FIELD^^5^6
"^DD",811.8,811.8031,0,"DT")
3010313
"^DD",811.8,811.8031,0,"IX","B",811.8031,.01)

"^DD",811.8,811.8031,0,"NM","COMPONENT LIST")

"^DD",811.8,811.8031,0,"UP")
811.803
"^DD",811.8,811.8031,.01,0)
INDEX^NJ6,0^^0;1^K:+X'=X!(X>100000)!(X<0)!(X?.E1"."1N.N) X
"^DD",811.8,811.8031,.01,1,0)
^.1
"^DD",811.8,811.8031,.01,1,1,0)
811.8031^B
"^DD",811.8,811.8031,.01,1,1,1)
S ^PXD(811.8,DA(2),130,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",811.8,811.8031,.01,1,1,2)
K ^PXD(811.8,DA(2),130,DA(1),1,"B",$E(X,1,30),DA)
"^DD",811.8,811.8031,.01,3)
Type a Number between 0 and 100000, 0 Decimal Digits
"^DD",811.8,811.8031,.01,21,0)
^.001^2^2^3010316^^
"^DD",811.8,811.8031,.01,21,1,0)
This number corresponds to the item number in the ListManager display
"^DD",811.8,811.8031,.01,21,2,0)
of the components in the Exchange File entry.
"^DD",811.8,811.8031,.01,"DT")
3001115
"^DD",811.8,811.8031,1,0)
COMPONENT^F^^0;2^K:$L(X)>64!($L(X)<1) X
"^DD",811.8,811.8031,1,3)
Answer must be 1-64 characters in length.
"^DD",811.8,811.8031,1,21,0)
^^1^1^3010316^
"^DD",811.8,811.8031,1,21,1,0)
This is the type of component, Education Topic, Health Factor, etc.
"^DD",811.8,811.8031,1,"DT")
3001115
"^DD",811.8,811.8031,2,0)
ITEM^F^^0;3^K:$L(X)>64!($L(X)<1) X
"^DD",811.8,811.8031,2,3)
Answer must be 1-64 characters in length.
"^DD",811.8,811.8031,2,21,0)
^^2^2^3010316^
"^DD",811.8,811.8031,2,21,1,0)
This is the name of the component. For example, if the component is a
"^DD",811.8,811.8031,2,21,2,0)
health factor then this is the name of the health factor.
"^DD",811.8,811.8031,2,"DT")
3001115
"^DD",811.8,811.8031,3,0)
ACTION^F^^0;4^K:$L(X)>4!($L(X)<1) X
"^DD",811.8,811.8031,3,3)
Answer must be 1-4 characters in length.
"^DD",811.8,811.8031,3,21,0)
^^1^1^3010316^
"^DD",811.8,811.8031,3,21,1,0)
This is the action that was taken with the item.
"^DD",811.8,811.8031,3,"DT")
3001115
"^DD",811.8,811.8031,4,0)
NEWNAME^F^^0;5^K:$L(X)>64!($L(X)<1) X
"^DD",811.8,811.8031,4,3)
Answer must be 1-64 characters in length.
"^DD",811.8,811.8031,4,21,0)
^^1^1^3010316^
"^DD",811.8,811.8031,4,21,1,0)
If the item was copied to a new name then the new name is stored here.
"^DD",811.8,811.8031,4,"DT")
3001115
"^DD",811.8,811.8031,5,0)
ADDITIONAL DETAILS^811.80315A^^1;0
"^DD",811.8,811.8031,5,21,0)
^.001^3^3^3010316^^
"^DD",811.8,811.8031,5,21,1,0)
This multiple is used to store additional details about the
"^DD",811.8,811.8031,5,21,2,0)
installation. As an example, if a finding in a reminder definition is
"^DD",811.8,811.8031,5,21,3,0)
replaced with another finding that information is stored here.
"^DD",811.8,811.80315,0)
ADDITIONAL DETAILS SUB-FIELD^^.01^1
"^DD",811.8,811.80315,0,"DT")
3010313
"^DD",811.8,811.80315,0,"IX","B",811.80315,.01)

"^DD",811.8,811.80315,0,"NM","ADDITIONAL DETAILS")

"^DD",811.8,811.80315,0,"UP")
811.8031
"^DD",811.8,811.80315,.01,0)
ADDITIONAL DETAILS^F^^0;1^K:$L(X)>80!($L(X)<1) X
"^DD",811.8,811.80315,.01,1,0)
^.1
"^DD",811.8,811.80315,.01,1,1,0)
811.80315^B
"^DD",811.8,811.80315,.01,1,1,1)
S ^PXD(811.8,DA(3),130,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",811.8,811.80315,.01,1,1,2)
K ^PXD(811.8,DA(3),130,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",811.8,811.80315,.01,3)
Answer must be 1-80 characters in length.
"^DD",811.8,811.80315,.01,21,0)
^^1^1^3010316^
"^DD",811.8,811.80315,.01,21,1,0)
This is a line of additional information.
"^DD",811.8,811.80315,.01,"DT")
3010313
"^DD",811.8,811.804,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",811.8,811.804,0,"DT")
3001221
"^DD",811.8,811.804,0,"NM","DESCRIPTION")

"^DD",811.8,811.804,0,"UP")
811.8
"^DD",811.8,811.804,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",811.8,811.804,.01,"DT")
3001221
"^DD",8925,8925,1405,0)
REQUESTING PACKAGE REFERENCE^V^^14;5^Q
"^DD",8925,8925,1405,.1)
CONSULT NUMBER
"^DD",8925,8925,1405,1,0)
^.1
"^DD",8925,8925,1405,1,1,0)
8925^G
"^DD",8925,8925,1405,1,1,1)
S ^TIU(8925,"G",$E(X,1,30),DA)=""
"^DD",8925,8925,1405,1,1,2)
K ^TIU(8925,"G",$E(X,1,30),DA)
"^DD",8925,8925,1405,1,1,"%D",0)
^^2^2^2980505^^
"^DD",8925,8925,1405,1,1,"%D",1,0)
This REGULAR FM cross-reference by REQUESTING PACKAGE REFERENCE is used to
"^DD",8925,8925,1405,1,1,"%D",2,0)
avoid multiple documents per request, and for look-ups.
"^DD",8925,8925,1405,1,1,"DT")
2960711
"^DD",8925,8925,1405,3)
Indicate the corresponding record in the requesting package.
"^DD",8925,8925,1405,21,0)
^.001^2^2^3010427^^
"^DD",8925,8925,1405,21,1,0)
This field allows a linkage to be maintained between the TIU Document and
"^DD",8925,8925,1405,21,2,0)
the DHCP Package for which it was generated.
"^DD",8925,8925,1405,"DT")
3010216
"^DD",8925,8925,1405,"V",0)
^.12P^2^2
"^DD",8925,8925,1405,"V",1,0)
123^Select CONSULTATION REQUEST^1^C^n^n
"^DD",8925,8925,1405,"V",1,1)

"^DD",8925,8925,1405,"V",1,2)

"^DD",8925,8925,1405,"V",2,0)
130^Select SURGICAL CASE^2^S^n^n
"^DD",8925.1,8925.1,.01,0)
NAME^RFX^^0;1^S:$L($T(^TIULS)) X=$$UPPER^TIULS(X) K:$L(X)>60!($L(X)<3)!'(X'?1P.E) X I $D(X),+$G(DA) K:$$BADNAP^TIUFLF1(X,+$G(DA)) X
"^DD",8925.1,8925.1,.01,.1)

"^DD",8925.1,8925.1,.01,1,0)
^.1
"^DD",8925.1,8925.1,.01,1,1,0)
8925.1^B
"^DD",8925.1,8925.1,.01,1,1,1)
S ^TIU(8925.1,"B",$E(X,1,60),DA)=""
"^DD",8925.1,8925.1,.01,1,1,2)
K ^TIU(8925.1,"B",$E(X,1,60),DA)
"^DD",8925.1,8925.1,.01,1,2,0)
8925.1^E^KWIC
"^DD",8925.1,8925.1,.01,1,2,1)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2,^DD("KWIC")'[I S ^TIU(8925.1,"E",I,DA)=""
"^DD",8925.1,8925.1,.01,1,2,2)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2 K ^TIU(8925.1,"E",I,DA)
"^DD",8925.1,8925.1,.01,1,2,"%D",0)
^^2^2^2960302^
"^DD",8925.1,8925.1,.01,1,2,"%D",1,0)
This KWIK cross-reference on document name will allow look-up based on
"^DD",8925.1,8925.1,.01,1,2,"%D",2,0)
sub-names, etc.
"^DD",8925.1,8925.1,.01,1,2,"DT")
2960302
"^DD",8925.1,8925.1,.01,1,3,0)
8925.1^ACL^MUMPS
"^DD",8925.1,8925.1,.01,1,3,1)
D SACL^TIUDD1(X,.01)
"^DD",8925.1,8925.1,.01,1,3,2)
D KACL^TIUDD1(X,.01)
"^DD",8925.1,8925.1,.01,1,3,"%D",0)
^^2^2^2971016^
"^DD",8925.1,8925.1,.01,1,3,"%D",1,0)
This complex cross-reference by class and name will help optimize the
"^DD",8925.1,8925.1,.01,1,3,"%D",2,0)
title look-up for the GUI.
"^DD",8925.1,8925.1,.01,1,3,"DT")
2971016
"^DD",8925.1,8925.1,.01,3)
This is the technical name, 3-60 characters, not starting with punctuation.  If OBJECT, Name must be unique among all object Names, Abbreviations, and Print Names.
"^DD",8925.1,8925.1,.01,4)
D NAME^TIUFXHLX:$G(TIUFXNOD)["Add/Create"&($G(TIUFSTMP)="T")
"^DD",8925.1,8925.1,.01,21,0)
^^51^51^2980127^^^^
"^DD",8925.1,8925.1,.01,21,1,0)
The name of a Document Definition entry (.01 field) must be between 3
"^DD",8925.1,8925.1,.01,21,2,0)
and 60 characters long and may not begin with a punctuation character.
"^DD",8925.1,8925.1,.01,21,3,0)
Although names can be entered in any case, they are transformed to
"^DD",8925.1,8925.1,.01,21,4,0)
upper case before being stored.
"^DD",8925.1,8925.1,.01,21,5,0)
 
"^DD",8925.1,8925.1,.01,21,6,0)
It functions as the Technical Name of the entry.  Some sites have put KWIC
"^DD",8925.1,8925.1,.01,21,7,0)
cross references on it to get, say, all Titles from a given Service.
"^DD",8925.1,8925.1,.01,21,8,0)
 
"^DD",8925.1,8925.1,.01,21,9,0)
Name can be used when entering documents as the name of the Title being
"^DD",8925.1,8925.1,.01,21,10,0)
entered.  Print Name and Abbreviation will also be accepted.
"^DD",8925.1,8925.1,.01,21,11,0)
 
"^DD",8925.1,8925.1,.01,21,12,0)
Since it is the Technical, .01 Name, the Document Definition Utility
"^DD",8925.1,8925.1,.01,21,13,0)
(TIUF) uses this name throughout.
"^DD",8925.1,8925.1,.01,21,14,0)
 
"^DD",8925.1,8925.1,.01,21,15,0)
The .01 name differs from the Print Name, which appears in lists of
"^DD",8925.1,8925.1,.01,21,16,0)
documents and functions as the Title of the document.
"^DD",8925.1,8925.1,.01,21,17,0)
 
"^DD",8925.1,8925.1,.01,21,18,0)
It also differs from Item Menu Text (1-20 characters), which is used when
"^DD",8925.1,8925.1,.01,21,19,0)
selecting documents from 3-COLUMN MENUS.
"^DD",8925.1,8925.1,.01,21,20,0)
 
"^DD",8925.1,8925.1,.01,21,21,0)
The ORDER of names in TIUF options Edit Document Definitions and Create
"^DD",8925.1,8925.1,.01,21,22,0)
Document Definitions is by Item Sequence under the parent.  Order is
"^DD",8925.1,8925.1,.01,21,23,0)
alphabetic by Menu Text if an Item has no Item Sequence.
"^DD",8925.1,8925.1,.01,21,24,0)
 
"^DD",8925.1,8925.1,.01,21,25,0)
When a new entry is added to file 8925.1, the Document Definition Utility
"^DD",8925.1,8925.1,.01,21,26,0)
(TIUF) enters the Name as the default Print Name.  The Print Name can be
"^DD",8925.1,8925.1,.01,21,27,0)
edited if a different Print Name is desired.
"^DD",8925.1,8925.1,.01,21,28,0)
 
"^DD",8925.1,8925.1,.01,21,29,0)
File 8925.1 permits more than 1 entry with the same name as long as they
"^DD",8925.1,8925.1,.01,21,30,0)
don't have the same Type.  In that sense, NAMES are reusable.  However,
"^DD",8925.1,8925.1,.01,21,31,0)
ENTRIES are NOT reusable (except specially marked Components): an entry is
"^DD",8925.1,8925.1,.01,21,32,0)
NOT allowed to be an item under more than one parent unless it is a Shared
"^DD",8925.1,8925.1,.01,21,33,0)
Component.  (See Type Component.)
"^DD",8925.1,8925.1,.01,21,34,0)
 
"^DD",8925.1,8925.1,.01,21,35,0)
Name is a BASIC Field.
"^DD",8925.1,8925.1,.01,21,36,0)
 
"^DD",8925.1,8925.1,.01,21,37,0)
                               OBJECT Name 
"^DD",8925.1,8925.1,.01,21,38,0)
Object Names, like any other names are 3-60 characters, not starting with
"^DD",8925.1,8925.1,.01,21,39,0)
punctuation.  Sites may want to namespace object names, use the object
"^DD",8925.1,8925.1,.01,21,40,0)
Print Name as a more familiar name, and use object Abbreviation as a short
"^DD",8925.1,8925.1,.01,21,41,0)
name to embed in boilerplate text.  Unlike other Types, Object
"^DD",8925.1,8925.1,.01,21,42,0)
Abbreviation and Print Name as well as Name must be uppercase.
"^DD",8925.1,8925.1,.01,21,43,0)
 
"^DD",8925.1,8925.1,.01,21,44,0)
Object Name, Abbreviation, or Print Name can be embedded in boilerplate
"^DD",8925.1,8925.1,.01,21,45,0)
text.  Since TIU must be able to determine from this which object is
"^DD",8925.1,8925.1,.01,21,46,0)
intended, object Names, Abbreviations, and Print Names must be unique.  In
"^DD",8925.1,8925.1,.01,21,47,0)
fact, an object Name must differ not only from every other object name,
"^DD",8925.1,8925.1,.01,21,48,0)
but also from every other object Abbreviation and from every other object
"^DD",8925.1,8925.1,.01,21,49,0)
Print Name.  Same for Abbreviations and Print Names.  For example, if some
"^DD",8925.1,8925.1,.01,21,50,0)
object has abbreviation 'CND', then 'CND' cannot be used for any other
"^DD",8925.1,8925.1,.01,21,51,0)
object Name, Abbreviation, or Print Name.
"^DD",8925.1,8925.1,.01,"AUDIT")

"^DD",8925.1,8925.1,.01,"DEL",.01,0)
I 1
"^DD",8925.1,8925.1,.01,"DT")
3020107
"^DD",8925.1,8925.1,.02,0)
ABBREVIATION^FX^^0;2^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>4!($L(X)<2)!'(X?2.4A) X I $D(X),+$G(DA) K:($P(^TIU(8925.1,DA,0),U,4)="O")&('(X?2.4U)!'$D(TIUFPRIV)) X I $D(X),+$G(DA) K:$$BADNAP^TIUFLF1(X,DA) X
"^DD",8925.1,8925.1,.02,1,0)
^.1
"^DD",8925.1,8925.1,.02,1,1,0)
8925.1^C
"^DD",8925.1,8925.1,.02,1,1,1)
S ^TIU(8925.1,"C",$E(X,1,30),DA)=""
"^DD",8925.1,8925.1,.02,1,1,2)
K ^TIU(8925.1,"C",$E(X,1,30),DA)
"^DD",8925.1,8925.1,.02,1,1,"%D",0)
^^2^2^2940711^
"^DD",8925.1,8925.1,.02,1,1,"%D",1,0)
This cross reference will be used by the router/filer to identify a given
"^DD",8925.1,8925.1,.02,1,1,"%D",2,0)
report type.
"^DD",8925.1,8925.1,.02,1,1,"DT")
2921020
"^DD",8925.1,8925.1,.02,1,2,0)
8925.1^ACL02^MUMPS
"^DD",8925.1,8925.1,.02,1,2,1)
D SACL^TIUDD1(X,.02)
"^DD",8925.1,8925.1,.02,1,2,2)
D KACL^TIUDD1(X,.02)
"^DD",8925.1,8925.1,.02,1,2,"%D",0)
^^2^2^3010417^
"^DD",8925.1,8925.1,.02,1,2,"%D",1,0)
This complex cross-reference by class and name will help optimize the
"^DD",8925.1,8925.1,.02,1,2,"%D",2,0)
title look-up for the GUI.
"^DD",8925.1,8925.1,.02,1,2,"DT")
3010417
"^DD",8925.1,8925.1,.02,3)
Enter from 2 to 4 letters.  If OBJECT, Abbreviation must be unique among all object Names, Abbreviations, and Print Names, and must be uppercase.
"^DD",8925.1,8925.1,.02,21,0)
^^3^3^2990504^^^^
"^DD",8925.1,8925.1,.02,21,1,0)
Abbreviation can be entered at the Title: prompt when entering a document.
"^DD",8925.1,8925.1,.02,21,2,0)
Since all Titles with that abbreviation will then be listed, Abbreviation
"^DD",8925.1,8925.1,.02,21,3,0)
can serve to group Titles.  BASIC Field.  For Objects, see NAME.
"^DD",8925.1,8925.1,.02,"DT")
3020107
"^DD",8925.1,8925.1,.03,0)
PRINT NAME^FX^^0;3^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>60!($L(X)<3) X I $D(X),+$G(DA) K:($P(^TIU(8925.1,DA,0),U,4)="O")&('(X?3.60UPN)!'$D(TIUFPRIV)) X I $D(X),+$G(DA) K:$$BADNAP^TIUFLF1(X,DA) X
"^DD",8925.1,8925.1,.03,1,0)
^.1
"^DD",8925.1,8925.1,.03,1,1,0)
8925.1^AM1^MUMPS
"^DD",8925.1,8925.1,.03,1,1,1)
D REDO^TIUDD
"^DD",8925.1,8925.1,.03,1,1,2)
D REDO^TIUDD
"^DD",8925.1,8925.1,.03,1,1,"%D",0)
^^2^2^2950911^^^
"^DD",8925.1,8925.1,.03,1,1,"%D",1,0)
This MUMPS-type cross-reference is used to update the TIMESTAMP on both
"^DD",8925.1,8925.1,.03,1,1,"%D",2,0)
the current document, and its parents, when its PRINT NAME changes.
"^DD",8925.1,8925.1,.03,1,1,"DT")
2940720
"^DD",8925.1,8925.1,.03,1,2,0)
8925.1^D
"^DD",8925.1,8925.1,.03,1,2,1)
S ^TIU(8925.1,"D",$E(X,1,30),DA)=""
"^DD",8925.1,8925.1,.03,1,2,2)
K ^TIU(8925.1,"D",$E(X,1,30),DA)
"^DD",8925.1,8925.1,.03,1,2,"%D",0)
^^1^1^2950126^
"^DD",8925.1,8925.1,.03,1,2,"%D",1,0)
This REGULAR FileMan cross-reference by PRINT NAME will facilitate look-up.
"^DD",8925.1,8925.1,.03,1,2,"DT")
2950126
"^DD",8925.1,8925.1,.03,1,3,0)
8925.1^ACL03^MUMPS
"^DD",8925.1,8925.1,.03,1,3,1)
D SACL^TIUDD1(X,.03)
"^DD",8925.1,8925.1,.03,1,3,2)
D KACL^TIUDD1(X,.03)
"^DD",8925.1,8925.1,.03,1,3,"%D",0)
^^2^2^3010417^
"^DD",8925.1,8925.1,.03,1,3,"%D",1,0)
This complex cross-reference by class and name will help optimize the
"^DD",8925.1,8925.1,.03,1,3,"%D",2,0)
title look-up for the GUI.
"^DD",8925.1,8925.1,.03,1,3,"DT")
3010417
"^DD",8925.1,8925.1,.03,3)
Print Name is used in lists of documents and as document Title in the Patient Chart.  3-60 Characters.  If OBJECT, Print Name must be unique among object Names/Abbreviations/PrintNames, and uppercase.
"^DD",8925.1,8925.1,.03,21,0)
^^3^3^2990504^^^^
"^DD",8925.1,8925.1,.03,21,1,0)
Print Name is the name used in lists of documents.  For entries of Type
"^DD",8925.1,8925.1,.03,21,2,0)
Title, Print Name is used as the document Title in the Patient Chart.
"^DD",8925.1,8925.1,.03,21,3,0)
BASIC field.  For Objects, see NAME.
"^DD",8925.1,8925.1,.03,"DT")
3020107
"^DD",8925.1,8925.1,6.5,0)
ON BROWSE EVENT^K^^6.5;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8925.1,8925.1,6.5,3)
This is Standard MUMPS code.
"^DD",8925.1,8925.1,6.5,9)
@
"^DD",8925.1,8925.1,6.5,21,0)
^^2^2^3010215^
"^DD",8925.1,8925.1,6.5,21,1,0)
This is MUMPS code which is invoked on browsing a document to fetch data
"^DD",8925.1,8925.1,6.5,21,2,0)
from the Requesting Package that will be included in the display.
"^DD",8925.1,8925.1,6.5,"DT")
3010215
"^DD",8925.1,8925.1,6.51,0)
ON RETRACT EVENT^K^^6.51;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8925.1,8925.1,6.51,3)
This is Standard MUMPS code.
"^DD",8925.1,8925.1,6.51,9)
@
"^DD",8925.1,8925.1,6.51,21,0)
^^2^2^3010301^
"^DD",8925.1,8925.1,6.51,21,1,0)
This is MUMPS code which is invoked on retraction of a document to perform
"^DD",8925.1,8925.1,6.51,21,2,0)
any processing task that the Requesting Package may require.
"^DD",8925.1,8925.1,6.51,"DT")
3010301
"^DIC",811.8,811.8,0)
REMINDER EXCHANGE FILE^811.8
"^DIC",811.8,811.8,0,"GL")
^PXD(811.8,
"^DIC",811.8,811.8,"%",0)
^1.005^^0
"^DIC",811.8,811.8,"%D",0)
^^2^2^3010601^^^^
"^DIC",811.8,811.8,"%D",1,0)
The Reminder Exchange File is used to store packed reminder
"^DIC",811.8,811.8,"%D",2,0)
definitions. Entries in this file should never be edited.
"^DIC",811.8,"B","REMINDER EXCHANGE FILE",811.8)

**END**
**END**
