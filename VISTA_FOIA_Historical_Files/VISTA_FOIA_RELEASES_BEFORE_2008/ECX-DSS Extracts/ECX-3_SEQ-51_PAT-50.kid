Released ECX*3*50 SEQ #51
Extracted from mail message
**KIDS**:ECX*3.0*50^

**INSTALL NAME**
ECX*3.0*50
"BLD",4832,0)
ECX*3.0*50^DSS EXTRACTS^0^3030723^y
"BLD",4832,1,0)
^^2^2^3030723^^
"BLD",4832,1,1,0)
This patch addresses the problem of the admission date field (36) storing 
"BLD",4832,1,2,0)
the wrong admission date in Surgery Extract (727.811;36).
"BLD",4832,4,0)
^9.64PA^^
"BLD",4832,"INID")
n^n^n
"BLD",4832,"KRN",0)
^9.67PA^8989.52^19
"BLD",4832,"KRN",.4,0)
.4
"BLD",4832,"KRN",.401,0)
.401
"BLD",4832,"KRN",.402,0)
.402
"BLD",4832,"KRN",.403,0)
.403
"BLD",4832,"KRN",.5,0)
.5
"BLD",4832,"KRN",.84,0)
.84
"BLD",4832,"KRN",3.6,0)
3.6
"BLD",4832,"KRN",3.8,0)
3.8
"BLD",4832,"KRN",9.2,0)
9.2
"BLD",4832,"KRN",9.8,0)
9.8
"BLD",4832,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4832,"KRN",9.8,"NM",1,0)
ECXSURG^^0^B36987437
"BLD",4832,"KRN",9.8,"NM","B","ECXSURG",1)

"BLD",4832,"KRN",19,0)
19
"BLD",4832,"KRN",19,"NM",0)
^9.68A^^
"BLD",4832,"KRN",19.1,0)
19.1
"BLD",4832,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4832,"KRN",101,0)
101
"BLD",4832,"KRN",101,"NM",0)
^9.68A^^
"BLD",4832,"KRN",409.61,0)
409.61
"BLD",4832,"KRN",771,0)
771
"BLD",4832,"KRN",870,0)
870
"BLD",4832,"KRN",8989.51,0)
8989.51
"BLD",4832,"KRN",8989.52,0)
8989.52
"BLD",4832,"KRN",8994,0)
8994
"BLD",4832,"KRN","B",.4,.4)

"BLD",4832,"KRN","B",.401,.401)

"BLD",4832,"KRN","B",.402,.402)

"BLD",4832,"KRN","B",.403,.403)

"BLD",4832,"KRN","B",.5,.5)

"BLD",4832,"KRN","B",.84,.84)

"BLD",4832,"KRN","B",3.6,3.6)

"BLD",4832,"KRN","B",3.8,3.8)

"BLD",4832,"KRN","B",9.2,9.2)

"BLD",4832,"KRN","B",9.8,9.8)

"BLD",4832,"KRN","B",19,19)

"BLD",4832,"KRN","B",19.1,19.1)

"BLD",4832,"KRN","B",101,101)

"BLD",4832,"KRN","B",409.61,409.61)

"BLD",4832,"KRN","B",771,771)

"BLD",4832,"KRN","B",870,870)

"BLD",4832,"KRN","B",8989.51,8989.51)

"BLD",4832,"KRN","B",8989.52,8989.52)

"BLD",4832,"KRN","B",8994,8994)

"BLD",4832,"QUES",0)
^9.62^^
"BLD",4832,"REQB",0)
^9.611^1^1
"BLD",4832,"REQB",1,0)
ECX*3.0*46^2
"BLD",4832,"REQB","B","ECX*3.0*46",1)

"MBREQ")
0
"PKG",535,-1)
1^1
"PKG",535,0)
DSS EXTRACTS^ECX
"PKG",535,20,0)
^9.402P^^
"PKG",535,22,0)
^9.49I^1^1
"PKG",535,22,1,0)
3.0^2971222^3000224^66481
"PKG",535,22,1,"PAH",1,0)
50^3030723^123456804
"PKG",535,22,1,"PAH",1,1,0)
^^2^2^3030723
"PKG",535,22,1,"PAH",1,1,1,0)
This patch addresses the problem of the admission date field (36) storing 
"PKG",535,22,1,"PAH",1,1,2,0)
the wrong admission date in Surgery Extract (727.811;36).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ECXSURG")
0^1^B36987437
"RTN","ECXSURG",1,0)
ECXSURG ;ALB/JAP,BIR/DMA,PTD-Surgery Extract for DSS ; 8/28/02 1:33pm
"RTN","ECXSURG",2,0)
 ;;3.0;DSS EXTRACTS;**1,11,8,13,25,24,33,39,41,42,46,50**;Dec 22, 1997
"RTN","ECXSURG",3,0)
BEG ;entry point from option
"RTN","ECXSURG",4,0)
 D SETUP I ECFILE="" Q
"RTN","ECXSURG",5,0)
 D ^ECXTRAC,^ECXKILL
"RTN","ECXSURG",6,0)
 Q
"RTN","ECXSURG",7,0)
 ;
"RTN","ECXSURG",8,0)
START ;
"RTN","ECXSURG",9,0)
 S QFLG=0,ECED=ECED+.3,ECD=ECSD1
"RTN","ECXSURG",10,0)
 F  S ECD=$O(^SRF("AC",ECD)),ECD0=0 Q:('ECD)!(ECD>ECED)!(QFLG)  D
"RTN","ECXSURG",11,0)
 .F  S ECD0=$O(^SRF("AC",ECD,ECD0)) Q:'ECD0  D
"RTN","ECXSURG",12,0)
 ..I $D(^SRF(ECD0,0)) S ECXDFN=+$P(^(0),U,1) D STUFF Q:QFLG
"RTN","ECXSURG",13,0)
 Q
"RTN","ECXSURG",14,0)
 ;
"RTN","ECXSURG",15,0)
STUFF ;gather data
"RTN","ECXSURG",16,0)
 N J,X,Y,PP,DATA1,DATA2,DATAOP,ARR,ERR,SUB,MOD,ECXNONL,ECXSTOP,TIMEDIF
"RTN","ECXSURG",17,0)
 S ECXDATE=ECD,ECXERR=0,ECXQ=""
"RTN","ECXSURG",18,0)
 Q:'$$PATDEM^ECXUTL2(ECXDFN,ECXDATE,"1;2;3;5;")
"RTN","ECXSURG",19,0)
 I ECXADMDT="" S ECXADD=ECXADMDT
"RTN","ECXSURG",20,0)
 I ECXADMDT'="" S ECXADD=$$ECXDATE^ECXUTL(ECXADMDT,ECXYM)
"RTN","ECXSURG",21,0)
 S EC0=^SRF(ECD0,0)
"RTN","ECXSURG",22,0)
 S DATA1=$S($D(^SRF(ECD0,.1)):^(.1),1:"")
"RTN","ECXSURG",23,0)
 S DATA2=$S($D(^SRF(ECD0,.2)):^(.2),1:"")
"RTN","ECXSURG",24,0)
 S DATAOP=$S($D(^SRF(ECD0,"OP")):^("OP"),1:"")
"RTN","ECXSURG",25,0)
 S ECNO=$G(^SRF(ECD0,"NON"))
"RTN","ECXSURG",26,0)
 ;get data
"RTN","ECXSURG",27,0)
 S ECSR=$P(DATA1,U,4),(ECATNPI,ECSANPI,ECSRNPI)="",ECAT=$P(DATA1,U,13)
"RTN","ECXSURG",28,0)
 S ECXTM=$$ECXTIME^ECXUTL($P(DATA2,U,10))
"RTN","ECXSURG",29,0)
 S ECXDIV=$S($D(^SRF(ECD0,8)):^(8),1:ECINST)
"RTN","ECXSURG",30,0)
 N ECXPDIV S ECXPDIV=$$RADDIV^ECXDEPT(ECXDIV)  ;Production Division
"RTN","ECXSURG",31,0)
 S ECSA=$P($G(^SRF(ECD0,.3)),U,4),ECO=$P(EC0,U,2)
"RTN","ECXSURG",32,0)
 S ECORTY=$P($G(^SRS(+ECO,2)),U),ECO=$P($G(^SRS(+ECO,0)),U)
"RTN","ECXSURG",33,0)
 S ECSS=$P($G(^SRO(137.45,+$P(EC0,U,4),0)),U,2)
"RTN","ECXSURG",34,0)
 S ECSS=$$RJ^XLFSTR($P($G(^DIC(45.3,+ECSS,0)),U),3,0)
"RTN","ECXSURG",35,0)
 S:ECSS="000" ECSS="999"
"RTN","ECXSURG",36,0)
 ; - Head and Neck Cancer Indicator
"RTN","ECXSURG",37,0)
 S ECXHNCI=$$HNCI^ECXUTL4(ECXDFN)
"RTN","ECXSURG",38,0)
 ;look for non-OR
"RTN","ECXSURG",39,0)
 S (ECNT,ECNL,ECXDSSD,ECXNONL,ECXSTOP)=""
"RTN","ECXSURG",40,0)
 I $P(ECNO,U)="Y" D
"RTN","ECXSURG",41,0)
 .S ECSR=$P(ECNO,U,6),ECAT=$P(ECNO,U,7)
"RTN","ECXSURG",42,0)
 .S ECXTM=$$ECXTIME^ECXUTL($P(ECNO,U,4))
"RTN","ECXSURG",43,0)
 .S A1=$P(ECNO,U,5),A2=$P(ECNO,U,4),TIME="##" D:(A1&A2) TIME S ECNT=TIME
"RTN","ECXSURG",44,0)
 .S (ECXNONL,ECNL)=+$P(ECNO,U,2),ECNL=$P($G(^ECX(728.44,ECNL,0)),U,9)
"RTN","ECXSURG",45,0)
 .S:ECNL="" ECNL="UNKNOWN"
"RTN","ECXSURG",46,0)
 .;
"RTN","ECXSURG",47,0)
 .;- Get DSS Stop Code to use in encounter number
"RTN","ECXSURG",48,0)
 .S ECXSTOP=$P($G(^ECX(728.44,ECXNONL,0)),U,4)
"RTN","ECXSURG",49,0)
 ;
"RTN","ECXSURG",50,0)
 ;- Cancelled/aborted surgery indicator (C/A)
"RTN","ECXSURG",51,0)
 S ECCAN=$P($G(^SRF(ECD0,30)),U)
"RTN","ECXSURG",52,0)
 I +ECCAN S ECCAN=$$CANC^ECXUTL4(ECNL,$P(DATA2,U,10))
"RTN","ECXSURG",53,0)
 ;get service of attending surgeon
"RTN","ECXSURG",54,0)
 S ECATSV=$P($G(^DIC(49,+$G(^VA(200,+ECAT,5)),730)),U)
"RTN","ECXSURG",55,0)
 ;add leading 2s for pointer to 200
"RTN","ECXSURG",56,0)
 S:ECAT ECAT="2"_ECAT S:ECSR ECSR="2"_ECSR S:ECSA ECSA="2"_ECSA
"RTN","ECXSURG",57,0)
 ;anesthesia technique
"RTN","ECXSURG",58,0)
 S ECANE="",PP=""
"RTN","ECXSURG",59,0)
 I $D(^SRF(ECD0,6,0)) S ECXJ=0 D
"RTN","ECXSURG",60,0)
 .F  S ECXJ=$O(^SRF(ECD0,6,ECXJ)) Q:('ECXJ)!(ECANE]"")  D
"RTN","ECXSURG",61,0)
 ..S PP=$P($G(^(ECXJ,0)),U,3) S:PP="Y" ECANE=$P(^(0),U,1)
"RTN","ECXSURG",62,0)
 .I ECANE="" S ECXJ=$O(^SRF(ECD0,6,0)) I ECXJ S ECANE=$P(^SRF(ECD0,6,ECXJ,0),U,1)
"RTN","ECXSURG",63,0)
 ;get primary procedure
"RTN","ECXSURG",64,0)
 ;ecode0=p^cpt code^^patient time^operation time^anesthesia time
"RTN","ECXSURG",65,0)
 S ECPT=+$P(DATAOP,U,2),ECXCMOD=""
"RTN","ECXSURG",66,0)
 K ARR,ERR D FIELD^DID(130,28,,"LABEL","ARR","ERR") I $D(ARR("LABEL")) D
"RTN","ECXSURG",67,0)
 .K ARR,ERR D FIELD^DID(130,28,,"GLOBAL SUBSCRIPT LOCATION","ARR","ERR")
"RTN","ECXSURG",68,0)
 .Q:$D(ERR("DIERR"))
"RTN","ECXSURG",69,0)
 .S SUB=$P(ARR("GLOBAL SUBSCRIPT LOCATION"),";"),MOD=0
"RTN","ECXSURG",70,0)
 .F  S MOD=$O(^SRF(ECD0,SUB,MOD)) Q:MOD'>0  D
"RTN","ECXSURG",71,0)
 ..S ECXCMOD=ECXCMOD_$P(^(MOD,0),U)_";"
"RTN","ECXSURG",72,0)
 S ECXCPT=$$CPT^ECXUTL3(ECPT,ECXCMOD)
"RTN","ECXSURG",73,0)
 S ECODE0="P"_U_U  ;ECPT_U
"RTN","ECXSURG",74,0)
 F J="10,12","2,3","1,4" D
"RTN","ECXSURG",75,0)
 .S A2=$P(DATA2,U,$P(J,",")),A1=$P(DATA2,U,$P(J,",",2)),TIME="##"
"RTN","ECXSURG",76,0)
 .I (A1&A2)&(+J'=2) D TIME
"RTN","ECXSURG",77,0)
 .I (A1&A2)&(+J=2) D
"RTN","ECXSURG",78,0)
 ..;
"RTN","ECXSURG",79,0)
 ..;-Operation Time
"RTN","ECXSURG",80,0)
 ..;-Get time diff (in secs) & set to .5 if < 7.5 minutes (rounds to 1)
"RTN","ECXSURG",81,0)
 ..S TIMEDIF=$$FMDIFF^XLFDT(A1,A2,2)/900
"RTN","ECXSURG",82,0)
 ..S TIMEDIF=$S(TIMEDIF>0&(TIMEDIF<.5):.5,1:TIMEDIF)
"RTN","ECXSURG",83,0)
 ..S TIME=$TR($J(TIMEDIF,4,0)," ")
"RTN","ECXSURG",84,0)
 ..S:TIME<0 TIME="###"
"RTN","ECXSURG",85,0)
 .S ECODE0=ECODE0_U_TIME K TIME
"RTN","ECXSURG",86,0)
 S ECRR=""
"RTN","ECXSURG",87,0)
 I $D(^SRF(ECD0,1.1)) D
"RTN","ECXSURG",88,0)
 .S A1=$P(^(1.1),U,8),A2=$P(^(1.1),U,7),TIME="##" D:(A1&A2) TIME
"RTN","ECXSURG",89,0)
 .S ECRR=TIME K TIME
"RTN","ECXSURG",90,0)
 I ECNL]"" S $P(ECODE0,U,5)=ECNT
"RTN","ECXSURG",91,0)
 ;
"RTN","ECXSURG",92,0)
 ;- Observation Patient Indicator (yes/no)
"RTN","ECXSURG",93,0)
 S ECXOBS=$$OBSPAT^ECXUTL4(ECXA,ECXTS,ECNL)
"RTN","ECXSURG",94,0)
 ;
"RTN","ECXSURG",95,0)
 ;- If no encounter number don't file record
"RTN","ECXSURG",96,0)
 S ECXENC=$$ENCNUM^ECXUTL4(ECXA,ECXSSN,ECXADMDT,ECXDATE,ECXTS,ECXOBS,ECHEAD,ECXSTOP,ECSS) Q:ECXENC=""
"RTN","ECXSURG",97,0)
 D FILE
"RTN","ECXSURG",98,0)
 ;get secondary procedures
"RTN","ECXSURG",99,0)
 ;ecode0=s^cpt code
"RTN","ECXSURG",100,0)
 S ECXJ=0
"RTN","ECXSURG",101,0)
 F  S ECXJ=$O(^SRF(ECD0,13,ECXJ)) Q:'ECXJ  I $D(^(ECXJ,0)),$D(^(2)),$P(^(2),U)]"" D
"RTN","ECXSURG",102,0)
 .S ECPT=$P(^SRF(ECD0,13,ECXJ,2),U),ECXCMOD=""
"RTN","ECXSURG",103,0)
 .K ARR,ERR
"RTN","ECXSURG",104,0)
 .D FIELD^DID(130.16,4,,"LABEL","ARR","ERR") I $D(ARR("LABEL")) D
"RTN","ECXSURG",105,0)
 ..K ARR,ERR
"RTN","ECXSURG",106,0)
 ..D FIELD^DID(130.16,4,,"GLOBAL SUBSCRIPT LOCATION","ARR","ERR")
"RTN","ECXSURG",107,0)
 ..Q:$D(ERR("DIERR"))
"RTN","ECXSURG",108,0)
 ..S SUB=$P(ARR("GLOBAL SUBSCRIPT LOCATION"),";"),MOD=0
"RTN","ECXSURG",109,0)
 ..F  S MOD=$O(^SRF(ECD0,13,ECXJ,SUB,MOD)) Q:MOD'>0  S ECXCMOD=ECXCMOD_$P(^(MOD,0),U)_";"
"RTN","ECXSURG",110,0)
 .S ECXCPT=$$CPT^ECXUTL3(ECPT,ECXCMOD)
"RTN","ECXSURG",111,0)
 .S ECODE0="S"_U   ;_ECPT
"RTN","ECXSURG",112,0)
 .D FILE
"RTN","ECXSURG",113,0)
 ;get prostheses
"RTN","ECXSURG",114,0)
 ;ecode0=i^^^^^^prosthesis^old qty field (null)
"RTN","ECXSURG",115,0)
 S ECXJ=0
"RTN","ECXSURG",116,0)
 F  S ECXJ=$O(^SRF(ECD0,1,ECXJ)) Q:'ECXJ  I $D(^(ECXJ,0)) D
"RTN","ECXSURG",117,0)
 .S ECXP=+^SRF(ECD0,1,ECXJ,0),ECXQ=$P($G(^(1)),U,2) S:'ECXQ ECXQ=1
"RTN","ECXSURG",118,0)
 .S ECODE0="I"_U_U_U_U_U_U_ECXP_U_U
"RTN","ECXSURG",119,0)
 .D FILE
"RTN","ECXSURG",120,0)
 Q
"RTN","ECXSURG",121,0)
 ;
"RTN","ECXSURG",122,0)
FILE ;file record
"RTN","ECXSURG",123,0)
 ;node0
"RTN","ECXSURG",124,0)
 ;division^dfn^ssn^name^in/out (ECXA)^day^case #^
"RTN","ECXSURG",125,0)
 ;surg specialty^or room #^
"RTN","ECXSURG",126,0)
 ;surgeon^attending^anesthesia supervisor^anesthesia technique^
"RTN","ECXSURG",127,0)
 ;primary/secondary/prostheses^cpt^^pt time^op time^anes time^
"RTN","ECXSURG",128,0)
 ;prostheses^qty^^
"RTN","ECXSURG",129,0)
 ;movement number^treating specialty^cancel/abort (ECCAN)^time^or type^
"RTN","ECXSURG",130,0)
 ;attending's service^non-or dss id^recovery room time^^
"RTN","ECXSURG",131,0)
 ;primary care team^primary care provider^admission date
"RTN","ECXSURG",132,0)
 ;node1
"RTN","ECXSURG",133,0)
 ;mpi^dss dept^surgeon npi^attending npi^anes supervisor npi^
"RTN","ECXSURG",134,0)
 ;pc provider npi^pc prov person class^
"RTN","ECXSURG",135,0)
 ;assoc pc provider^assoc pc prov person class^assoc pc prov npi^
"RTN","ECXSURG",136,0)
 ;cpt&modifiers ECXCPT^dom ECXDOM^enrollment category ECXCAT^
"RTN","ECXSURG",137,0)
 ;enrollment status ECXSTAT^enrollment priority ECXPRIOR^
"RTN","ECXSURG",138,0)
 ;period of service ECXPOS^purple heart indicator ECXPHI^
"RTN","ECXSURG",139,0)
 ;observ pat ind ECXOBS^encounter num ECXENC^ao loc ECXAOL^
"RTN","ECXSURG",140,0)
 ;production division ECXPDIV^head & neck canc ind ECXHNCI^
"RTN","ECXSURG",141,0)
 ;ethnicity ECXETH^race1 ECXRC1^new quantity ECXQ
"RTN","ECXSURG",142,0)
 N DA,DIK,STR
"RTN","ECXSURG",143,0)
 S EC7=$O(^ECX(ECFILE,999999999),-1),EC7=EC7+1
"RTN","ECXSURG",144,0)
 S ECODE=EC7_U_EC23_U_ECXDIV_U_ECXDFN_U_ECXSSN_U_ECXPNM_U_ECXA_U
"RTN","ECXSURG",145,0)
 S ECODE=ECODE_$$ECXDATE^ECXUTL(ECXDATE,ECXYM)_U_ECD0_U_ECSS_U_ECO_U
"RTN","ECXSURG",146,0)
 S ECODE=ECODE_ECSR_U_ECAT_U_ECSA_U_ECANE_U_ECODE0_U
"RTN","ECXSURG",147,0)
 S STR=ECXMN_U_ECXTS_U_$S(ECCAN'="":ECCAN,1:"")_U_ECXTM_U_ECORTY_U
"RTN","ECXSURG",148,0)
 S STR=STR_ECATSV_U_ECNL_U_ECRR_U_U_ECPTTM_U_ECPTPR_U_ECXADD_U
"RTN","ECXSURG",149,0)
 S $P(ECODE,U,26,38)=STR
"RTN","ECXSURG",150,0)
 S ECODE1=ECXMPI_U_ECXDSSD_U_ECSRNPI_U_ECATNPI_U_ECSANPI_U_ECPTNPI_U
"RTN","ECXSURG",151,0)
 S ECODE1=ECODE1_ECCLAS_U_ECASPR_U_ECCLAS2_U_ECASNPI_U_ECXCPT_U_ECXDOM_U
"RTN","ECXSURG",152,0)
 S ECODE1=ECODE1_ECXCAT_U_ECXSTAT_U_ECXPRIOR_U_ECXPOS_U_ECXPHI_U
"RTN","ECXSURG",153,0)
 S ECODE1=ECODE1_ECXOBS_U_ECXENC_U_ECXAOL_U_ECXPDIV_U_ECXHNCI_U
"RTN","ECXSURG",154,0)
 S ECODE1=ECODE1_ECXETH_U_ECXRC1_U_ECXQ
"RTN","ECXSURG",155,0)
 S ^ECX(ECFILE,EC7,0)=ECODE,^ECX(ECFILE,EC7,1)=ECODE1,ECRN=ECRN+1
"RTN","ECXSURG",156,0)
 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX1^DIK K DIK,DA
"RTN","ECXSURG",157,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S QFLG=1
"RTN","ECXSURG",158,0)
 ;
"RTN","ECXSURG",159,0)
TIME ; given date/time get increment
"RTN","ECXSURG",160,0)
 ;A1=later, A2=earlier, TIME=difference
"RTN","ECXSURG",161,0)
 N CON,TIMEDIF
"RTN","ECXSURG",162,0)
 S CON=$P($G(^SRF(ECD0,"CON")),U)
"RTN","ECXSURG",163,0)
 ;
"RTN","ECXSURG",164,0)
 ;-Get time diff (in secs) & set to .5 if < 7.5 minutes (rounds to 1)
"RTN","ECXSURG",165,0)
 S TIMEDIF=$$FMDIFF^XLFDT(A1,A2,2)/900
"RTN","ECXSURG",166,0)
 S TIMEDIF=$S(TIMEDIF>0&(TIMEDIF<.5):.5,1:TIMEDIF)
"RTN","ECXSURG",167,0)
 I 'CON D
"RTN","ECXSURG",168,0)
 .S TIME=$J($TR($J(TIMEDIF,4,0)," "),2,1)
"RTN","ECXSURG",169,0)
 .S:TIME>"99.0" TIME="99.0"
"RTN","ECXSURG",170,0)
 I CON D
"RTN","ECXSURG",171,0)
 .S TIME=$J(($TR($J(TIMEDIF,4,0)," ")/2),2,1)
"RTN","ECXSURG",172,0)
 .S:TIME>"99.5" TIME="99.5"
"RTN","ECXSURG",173,0)
 S:TIME<0 TIME="###"
"RTN","ECXSURG",174,0)
 Q
"RTN","ECXSURG",175,0)
 ;
"RTN","ECXSURG",176,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXSURG",177,0)
 S ECHEAD="SUR"
"RTN","ECXSURG",178,0)
 D ECXDEF^ECXUTL2(ECHEAD,.ECPACK,.ECGRP,.ECFILE,.ECRTN,.ECPIECE,.ECVER)
"RTN","ECXSURG",179,0)
 Q
"RTN","ECXSURG",180,0)
 ;
"RTN","ECXSURG",181,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXSURG",182,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"VER")
8.0^22
**END**
**END**
