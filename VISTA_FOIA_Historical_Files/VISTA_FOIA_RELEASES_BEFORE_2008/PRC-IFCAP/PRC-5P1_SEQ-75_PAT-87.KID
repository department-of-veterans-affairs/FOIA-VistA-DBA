Released PRC*5.1*87 SEQ #75
Extracted from mail message
**KIDS**:PRC*5.1*87^

**INSTALL NAME**
PRC*5.1*87
"BLD",4399,0)
PRC*5.1*87^IFCAP^0^3050921^y
"BLD",4399,1,0)
^^4^4^3050920^
"BLD",4399,1,1,0)
This patch updates the PRCPPOLM routine to correct a problem with 
"BLD",4399,1,2,0)
Purchase Card orders.  The patch also changes the data type of the HL7 
"BLD",4399,1,3,0)
TRANSACTION NUMBERS field in file #447.1 and modifies the input transform 
"BLD",4399,1,4,0)
for that field.
"BLD",4399,4,0)
^9.64PA^447.1^1
"BLD",4399,4,447.1,0)
447.1
"BLD",4399,4,447.1,2,0)
^9.641^447.1^1
"BLD",4399,4,447.1,2,447.1,0)
AUTOMATED SUPPLY STATION PROCESSING QUEUE  (File-top level)
"BLD",4399,4,447.1,2,447.1,1,0)
^9.6411^5^1
"BLD",4399,4,447.1,2,447.1,1,5,0)
HL7 TRANSACTION NUMBERS
"BLD",4399,4,447.1,222)
y^n^p^^^^n^^n
"BLD",4399,4,447.1,224)

"BLD",4399,4,"APDD",447.1,447.1)

"BLD",4399,4,"APDD",447.1,447.1,5)

"BLD",4399,4,"B",447.1,447.1)

"BLD",4399,"ABPKG")
n
"BLD",4399,"KRN",0)
^9.67PA^8989.52^19
"BLD",4399,"KRN",.4,0)
.4
"BLD",4399,"KRN",.401,0)
.401
"BLD",4399,"KRN",.402,0)
.402
"BLD",4399,"KRN",.403,0)
.403
"BLD",4399,"KRN",.5,0)
.5
"BLD",4399,"KRN",.84,0)
.84
"BLD",4399,"KRN",3.6,0)
3.6
"BLD",4399,"KRN",3.8,0)
3.8
"BLD",4399,"KRN",9.2,0)
9.2
"BLD",4399,"KRN",9.8,0)
9.8
"BLD",4399,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4399,"KRN",9.8,"NM",1,0)
PRCPPOLM^^0^B16996959
"BLD",4399,"KRN",9.8,"NM","B","PRCPPOLM",1)

"BLD",4399,"KRN",19,0)
19
"BLD",4399,"KRN",19.1,0)
19.1
"BLD",4399,"KRN",101,0)
101
"BLD",4399,"KRN",409.61,0)
409.61
"BLD",4399,"KRN",771,0)
771
"BLD",4399,"KRN",870,0)
870
"BLD",4399,"KRN",8989.51,0)
8989.51
"BLD",4399,"KRN",8989.52,0)
8989.52
"BLD",4399,"KRN",8994,0)
8994
"BLD",4399,"KRN","B",.4,.4)

"BLD",4399,"KRN","B",.401,.401)

"BLD",4399,"KRN","B",.402,.402)

"BLD",4399,"KRN","B",.403,.403)

"BLD",4399,"KRN","B",.5,.5)

"BLD",4399,"KRN","B",.84,.84)

"BLD",4399,"KRN","B",3.6,3.6)

"BLD",4399,"KRN","B",3.8,3.8)

"BLD",4399,"KRN","B",9.2,9.2)

"BLD",4399,"KRN","B",9.8,9.8)

"BLD",4399,"KRN","B",19,19)

"BLD",4399,"KRN","B",19.1,19.1)

"BLD",4399,"KRN","B",101,101)

"BLD",4399,"KRN","B",409.61,409.61)

"BLD",4399,"KRN","B",771,771)

"BLD",4399,"KRN","B",870,870)

"BLD",4399,"KRN","B",8989.51,8989.51)

"BLD",4399,"KRN","B",8989.52,8989.52)

"BLD",4399,"KRN","B",8994,8994)

"BLD",4399,"QUES",0)
^9.62^^
"BLD",4399,"REQB",0)
^9.611^1^1
"BLD",4399,"REQB",1,0)
PRC*5.1*34^2
"BLD",4399,"REQB","B","PRC*5.1*34",1)

"FIA",447.1)
AUTOMATED SUPPLY STATION PROCESSING QUEUE
"FIA",447.1,0)
^PRCP(447.1,
"FIA",447.1,0,0)
447.1
"FIA",447.1,0,1)
y^n^p^^^^n^^n
"FIA",447.1,0,10)

"FIA",447.1,0,11)

"FIA",447.1,0,"RLRO")

"FIA",447.1,0,"VR")
5.1^PRC
"FIA",447.1,447.1)
1
"FIA",447.1,447.1,5)

"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
87^3050921
"PKG",455,22,1,"PAH",1,1,0)
^^4^4^3050921
"PKG",455,22,1,"PAH",1,1,1,0)
This patch updates the PRCPPOLM routine to correct a problem with 
"PKG",455,22,1,"PAH",1,1,2,0)
Purchase Card orders.  The patch also changes the data type of the HL7 
"PKG",455,22,1,"PAH",1,1,3,0)
TRANSACTION NUMBERS field in file #447.1 and modifies the input transform 
"PKG",455,22,1,"PAH",1,1,4,0)
for that field.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PRCPPOLM")
0^1^B16996959
"RTN","PRCPPOLM",1,0)
PRCPPOLM ;WISC/RFJ-receive purchase order (list manager)            ; 6/13/01 5:52pm
"RTN","PRCPPOLM",2,0)
 ;;5.1;IFCAP;**34,87**;Oct 20, 2000
"RTN","PRCPPOLM",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPPOLM",4,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPPOLM",5,0)
 I "PW"'[PRCP("DPTYPE") W !,"YOU MUST BE A WAREHOUSE OR PRIMARY INVENTORY POINT TO USE THIS OPTION." Q
"RTN","PRCPPOLM",6,0)
 I $$CHECK^PRCPCUT1(PRCP("I")) Q
"RTN","PRCPPOLM",7,0)
 N %,PRCPFCOS,PRCPFLAG,PRCPINPT,PRCPORDN,PRCPORDR,PRCPPARD,PRCPPART,PRCPTYPE,PRCPVEND,PRCPVENN,PRCPM,X,Y
"RTN","PRCPPOLM",8,0)
 S X="" W ! D ESIG^PRCUESIG(DUZ,.X) I X'>0 Q
"RTN","PRCPPOLM",9,0)
AUTH S PRCPINPT=PRCP("I"),PRCPTYPE=PRCP("DPTYPE")
"RTN","PRCPPOLM",10,0)
 S:$G(PRCHAUTH) PRCPORDR=PRCHPO
"RTN","PRCPPOLM",11,0)
 D:$G(PRCHAUTH)  I '$G(PRCHAUTH) F  S PRCPORDR=$$SELECTPO^PRCPPOU1(PRCPINPT) Q:PRCPORDR<1  D
"RTN","PRCPPOLM",12,0)
 .   S PRCPORDN=$P($G(^PRC(442,PRCPORDR,0)),"^") I PRCPORDN="" W !,"ERROR - INVALID OR MISSING PURCHASE ORDER NUMBER !" Q
"RTN","PRCPPOLM",13,0)
 .   S PRCPVEND=+$G(^PRC(442,PRCPORDR,1)),PRCPVENN=$P($G(^PRC(440,PRCPVEND,0)),"^")
"RTN","PRCPPOLM",14,0)
 .   I PRCPVEND="" W !,"ERROR - INVALID OR MISSING VENDOR ON THIS PURCHASE ORDER !" Q
"RTN","PRCPPOLM",15,0)
 .   L +^PRC(442,PRCPORDR):5 I '$T D SHOWWHO^PRCPULOC(442,PRCPORDR,0) Q
"RTN","PRCPPOLM",16,0)
 .   I $G(PRCHAUTH) S PRCPPART=PRCHRPT G JMP
"RTN","PRCPPOLM",17,0)
 .   ;I '$D(^PRC(442,PRCPORDR,11,0)) G JMP ; functionality modified 9/15/05 T.Holloway.
"RTN","PRCPPOLM",18,0)
 .   ; if level 11 does not exist the old code would jump over the part that creates PRCPPART.
"RTN","PRCPPOLM",19,0)
 .   ; PRCPPART is a required variable later in the application and items without it should not continue.
"RTN","PRCPPOLM",20,0)
 .   ; 7 lines of code are added to detect and handle the situation.  T.Holloway
"RTN","PRCPPOLM",21,0)
 .   I '$D(^PRC(442,PRCPORDR,11,0)) D  D UNLOCK Q
"RTN","PRCPPOLM",22,0)
 . .   S PRCPM=$P($G(^PRC(442,PRCPORDR,0)),U,2),PRCPM=$P(^PRCD(442.5,PRCPM,0),U,2)
"RTN","PRCPPOLM",23,0)
 . .   I (PRCPM="PC")&($P($G(^PRC(442,PRCPORDR,23)),U,15)="N") D
"RTN","PRCPPOLM",24,0)
 . . .   W !!,"Sorry, this Purchase Card order has been marked 'No Receiving Required'"
"RTN","PRCPPOLM",25,0)
 . . .   W !,"and has been Reconciled as COMPLETE ORDER RECEIVED: YES."
"RTN","PRCPPOLM",26,0)
 . . .   W !,"It may not be received into inventory in this status."
"RTN","PRCPPOLM",27,0)
 . .   E  W !!,"No Partial on file, further processing not allowed."
"RTN","PRCPPOLM",28,0)
 .   S FINALREC=""
"RTN","PRCPPOLM",29,0)
 .   S FINALREC=$P($G(^PRC(442,PRCPORDR,11,0)),"^",4)
"RTN","PRCPPOLM",30,0)
 .   I FINALREC'=""  D
"RTN","PRCPPOLM",31,0)
 .   . I $P($G(^PRC(442,PRCPORDR,11,FINALREC,0)),"^",16)=""  D
"RTN","PRCPPOLM",32,0)
 .   . .;;  show partials not received yet
"RTN","PRCPPOLM",33,0)
 .   . . W !!,"PARTIALS NOT YET RECEIVED:"
"RTN","PRCPPOLM",34,0)
 .   K FINALREC
"RTN","PRCPPOLM",35,0)
 .   S %=0 F  S %=$O(^PRC(442,PRCPORDR,11,%)) Q:'%  I $P($G(^(%,0)),"^",16)="" S Y=$P(^(0),"^") D DD^%DT W !?5,"PARTIAL #: ",%,?28,"DATE: ",Y I $P($G(^PRC(442,PRCPORDR,11,%,0)),"^",9)="F" W ?55,"FINAL RECEIPT"
"RTN","PRCPPOLM",36,0)
 .   S PRCPPART=$$PARTIAL^PRCPPOU1(PRCPORDR) I PRCPPART<0 D UNLOCK Q
"RTN","PRCPPOLM",37,0)
 .   S PRCPPARD=$P($G(^PRC(442,PRCPORDR,11,PRCPPART,0)),"^") I 'PRCPPARD W !,"ERROR - CANNOT FIND PARTIAL DATE FOR THIS PARTIAL !" D UNLOCK Q
"RTN","PRCPPOLM",38,0)
JMP .   D EN^VALM("PRCP PURCHASE ORDER RECEIPT")
"RTN","PRCPPOLM",39,0)
 .   D UNLOCK
"RTN","PRCPPOLM",40,0)
 Q
"RTN","PRCPPOLM",41,0)
 ;
"RTN","PRCPPOLM",42,0)
 ;
"RTN","PRCPPOLM",43,0)
UNLOCK ;  unlock po
"RTN","PRCPPOLM",44,0)
 D CLEAR^PRCPULOC(442,PRCPORDR,0)
"RTN","PRCPPOLM",45,0)
 L -^PRC(442,PRCPORDR)
"RTN","PRCPPOLM",46,0)
 Q
"RTN","PRCPPOLM",47,0)
 ;
"RTN","PRCPPOLM",48,0)
 ;
"RTN","PRCPPOLM",49,0)
HDR ;  build header
"RTN","PRCPPOLM",50,0)
 N DATA,FLAG,SPACE,Y
"RTN","PRCPPOLM",51,0)
 S DATA=$G(^PRC(442,PRCPORDR,11,PRCPPART,0)),FLAG=$S($P(DATA,"^",9)="F":"FINAL  ",1:""),FLAG=FLAG_$S($P(DATA,"^",10)="Y":"OVERAGE",1:"")
"RTN","PRCPPOLM",52,0)
 S Y=$P(DATA,"^") D DD^%DT
"RTN","PRCPPOLM",53,0)
 S SPACE="                                                             "
"RTN","PRCPPOLM",54,0)
 S VALMHDR(1)=$E("INVENTORY: "_$$INVNAME^PRCPUX1(PRCPINPT)_SPACE,1,30)_$E("  PO: "_PRCPORDN_SPACE,1,20)_$E("VENDOR: "_PRCPVENN_SPACE,1,22)_"#"_PRCPVEND
"RTN","PRCPPOLM",55,0)
 S VALMHDR(2)=$E("PARTIAL: "_PRCPPART_SPACE,1,14)_$E("DATE: "_Y_SPACE,1,19)_$E("LINECNT: "_$P(DATA,"^",14)_SPACE,1,14)_$E("TOTAL AMT: "_$P(DATA,"^",12)_SPACE,1,25)_FLAG
"RTN","PRCPPOLM",56,0)
 S VALMHDR(3)="LINE DESCRIPTION          IM#   POQTY CONV  RECQTY   AVGCOST  UNITCOST   TOTCOST"
"RTN","PRCPPOLM",57,0)
 Q
"RTN","PRCPPOLM",58,0)
 ;
"RTN","PRCPPOLM",59,0)
 ;
"RTN","PRCPPOLM",60,0)
INIT ;  build array
"RTN","PRCPPOLM",61,0)
 ;  clean up before entry
"RTN","PRCPPOLM",62,0)
 K ^TMP($J,"PRCPPOLMCOS")
"RTN","PRCPPOLM",63,0)
 D REBUILD^PRCPPOLB
"RTN","PRCPPOLM",64,0)
 Q
"RTN","PRCPPOLM",65,0)
 ;
"RTN","PRCPPOLM",66,0)
 ;
"RTN","PRCPPOLM",67,0)
EXIT ;  exit
"RTN","PRCPPOLM",68,0)
 K ^TMP($J,"PRCPPOLM"),^TMP($J,"PRCPPOLMCOS"),^TMP($J,"PRCPPOLMREC")
"RTN","PRCPPOLM",69,0)
 Q
"VER")
8.0^22.0
"^DD",447.1,447.1,5,0)
HL7 TRANSACTION NUMBERS^FX^^0;6^K:X'?1.10N1"."1.10N X
"^DD",447.1,447.1,5,3)
The IEN from #773 concatenated with a period concatenated with the IEN from #772.
"^DD",447.1,447.1,5,21,0)
^^2^2^3000818^
"^DD",447.1,447.1,5,21,1,0)
This field will contain the iens of the transaction records in file 773
"^DD",447.1,447.1,5,21,2,0)
(^HLMA) and 772 (^HL(772)), separated by a decimal point.
"^DD",447.1,447.1,5,"DT")
3050919
"BLD",4399,6)
^SEQ #75
**END**
**END**
