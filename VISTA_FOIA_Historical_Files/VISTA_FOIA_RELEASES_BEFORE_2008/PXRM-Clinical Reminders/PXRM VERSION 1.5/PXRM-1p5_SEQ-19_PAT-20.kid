Released PXRM*1.5*20 SEQ #19
Extracted from mail message
**KIDS**:PXRM*1.5*20^

**INSTALL NAME**
PXRM*1.5*20
"BLD",4410,0)
PXRM*1.5*20^CLINICAL REMINDERS^0^3030912^y
"BLD",4410,1,0)
^^3^3^3030910^
"BLD",4410,1,1,0)
This patch creates a utility that provides an estimate of size of the
"BLD",4410,1,2,0)
Clinical Reminders index. See the National Patch Module entry for full
"BLD",4410,1,3,0)
details.
"BLD",4410,4,0)
^9.64PA^^
"BLD",4410,"KRN",0)
^9.67PA^8989.52^19
"BLD",4410,"KRN",.4,0)
.4
"BLD",4410,"KRN",.401,0)
.401
"BLD",4410,"KRN",.402,0)
.402
"BLD",4410,"KRN",.403,0)
.403
"BLD",4410,"KRN",.5,0)
.5
"BLD",4410,"KRN",.84,0)
.84
"BLD",4410,"KRN",3.6,0)
3.6
"BLD",4410,"KRN",3.8,0)
3.8
"BLD",4410,"KRN",9.2,0)
9.2
"BLD",4410,"KRN",9.8,0)
9.8
"BLD",4410,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4410,"KRN",9.8,"NM",1,0)
PXRMISE^^0^B59750086
"BLD",4410,"KRN",9.8,"NM",2,0)
PXRMISF^^0^B4453210
"BLD",4410,"KRN",9.8,"NM",3,0)
PXRMLABS^^0^B39253882
"BLD",4410,"KRN",9.8,"NM","B","PXRMISE",1)

"BLD",4410,"KRN",9.8,"NM","B","PXRMISF",2)

"BLD",4410,"KRN",9.8,"NM","B","PXRMLABS",3)

"BLD",4410,"KRN",19,0)
19
"BLD",4410,"KRN",19.1,0)
19.1
"BLD",4410,"KRN",101,0)
101
"BLD",4410,"KRN",101,"NM",0)
^9.68A^^0
"BLD",4410,"KRN",409.61,0)
409.61
"BLD",4410,"KRN",771,0)
771
"BLD",4410,"KRN",870,0)
870
"BLD",4410,"KRN",8989.51,0)
8989.51
"BLD",4410,"KRN",8989.52,0)
8989.52
"BLD",4410,"KRN",8994,0)
8994
"BLD",4410,"KRN","B",.4,.4)

"BLD",4410,"KRN","B",.401,.401)

"BLD",4410,"KRN","B",.402,.402)

"BLD",4410,"KRN","B",.403,.403)

"BLD",4410,"KRN","B",.5,.5)

"BLD",4410,"KRN","B",.84,.84)

"BLD",4410,"KRN","B",3.6,3.6)

"BLD",4410,"KRN","B",3.8,3.8)

"BLD",4410,"KRN","B",9.2,9.2)

"BLD",4410,"KRN","B",9.8,9.8)

"BLD",4410,"KRN","B",19,19)

"BLD",4410,"KRN","B",19.1,19.1)

"BLD",4410,"KRN","B",101,101)

"BLD",4410,"KRN","B",409.61,409.61)

"BLD",4410,"KRN","B",771,771)

"BLD",4410,"KRN","B",870,870)

"BLD",4410,"KRN","B",8989.51,8989.51)

"BLD",4410,"KRN","B",8989.52,8989.52)

"BLD",4410,"KRN","B",8994,8994)

"BLD",4410,"QUES",0)
^9.62^^
"BLD",4410,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",364,-1)
1^1
"PKG",364,0)
CLINICAL REMINDERS^PXRM^Clinical Reminders^^^3011030
"PKG",364,20,0)
^9.402P^^
"PKG",364,22,0)
^9.49I^1^1
"PKG",364,22,1,0)
1.5^3000619^3000622^1342
"PKG",364,22,1,"PAH",1,0)
20^3030912
"PKG",364,22,1,"PAH",1,1,0)
^^3^3^3030912
"PKG",364,22,1,"PAH",1,1,1,0)
This patch creates a utility that provides an estimate of size of the
"PKG",364,22,1,"PAH",1,1,2,0)
Clinical Reminders index. See the National Patch Module entry for full
"PKG",364,22,1,"PAH",1,1,3,0)
details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PXRMISE")
0^1^B59750086
"RTN","PXRMISE",1,0)
PXRMISE ; SLC/PKR - Index size estimating routines. ;09/10/2003
"RTN","PXRMISE",2,0)
       ;;1.5;CLINICAL REMINDERS;**20**;Jun 19, 2000
"RTN","PXRMISE",3,0)
 ;
"RTN","PXRMISE",4,0)
 ;========================================================
"RTN","PXRMISE",5,0)
EST ;Driver for making index counts.
"RTN","PXRMISE",6,0)
 N BLOCKS,FUNCTION,GBL,GLIST,IND,LIST,NE,NL,NUMGBL,RTN
"RTN","PXRMISE",7,0)
 N SF,TASKIT,TBLOCKS,XMSUB
"RTN","PXRMISE",8,0)
 D SETDATA(.GBL,.GLIST,.NUMGBL,.RTN,.SF)
"RTN","PXRMISE",9,0)
 I +SF=-1 D ERRORMSG^PXRMISF(SF)  Q
"RTN","PXRMISE",10,0)
 S (NL,TBLOCKS)=0
"RTN","PXRMISE",11,0)
 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="Start time "_$$FMTE^XLFDT($$NOW^XLFDT,"5Z")
"RTN","PXRMISE",12,0)
 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=""
"RTN","PXRMISE",13,0)
 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="Size Estimate for ^PXRMINDX"
"RTN","PXRMISE",14,0)
 F IND=1:1:NUMGBL D
"RTN","PXRMISE",15,0)
 . S FUNCTION="S NE=$$"_RTN(GBL(IND))
"RTN","PXRMISE",16,0)
 . X FUNCTION
"RTN","PXRMISE",17,0)
 . S BLOCKS=NE*SF(GBL(IND))
"RTN","PXRMISE",18,0)
 . S BLOCKS=$FN(BLOCKS,"","")+1
"RTN","PXRMISE",19,0)
 . S TBLOCKS=TBLOCKS+BLOCKS
"RTN","PXRMISE",20,0)
 . S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=""
"RTN","PXRMISE",21,0)
 . S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="Estimates for "_GLIST(IND)
"RTN","PXRMISE",22,0)
 . S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=" Number of entries: "_NE
"RTN","PXRMISE",23,0)
 . S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=" Number of blocks: "_BLOCKS
"RTN","PXRMISE",24,0)
 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=""
"RTN","PXRMISE",25,0)
 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="Total estimated blocks: "_TBLOCKS
"RTN","PXRMISE",26,0)
 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)=""
"RTN","PXRMISE",27,0)
 S NL=NL+1,^TMP("PXRMXMZ",$J,NL,0)="End time "_$$FMTE^XLFDT($$NOW^XLFDT,"5Z")
"RTN","PXRMISE",28,0)
 S XMSUB="Size estimate for index global"
"RTN","PXRMISE",29,0)
 D SEND^PXRMMSG(XMSUB)
"RTN","PXRMISE",30,0)
 S ZTREQ="@"
"RTN","PXRMISE",31,0)
 Q
"RTN","PXRMISE",32,0)
 ;
"RTN","PXRMISE",33,0)
 ;===============================================================
"RTN","PXRMISE",34,0)
ESTTASK ;Task the index size estimation.
"RTN","PXRMISE",35,0)
 N DIR,DTOUT,DUOUT,MINDT,SDTIME,X,Y
"RTN","PXRMISE",36,0)
 S MINDT=$$NOW^XLFDT
"RTN","PXRMISE",37,0)
 W !,"Queue the Clinical Reminders index size estimation."
"RTN","PXRMISE",38,0)
 S DIR("A",1)="Enter the date and time you want the job to start."
"RTN","PXRMISE",39,0)
 S DIR("A")="It must be after "_$$FMTE^XLFDT(MINDT,"5Z")_" "
"RTN","PXRMISE",40,0)
 S DIR(0)="DAU"_U_MINDT_"::RSX"
"RTN","PXRMISE",41,0)
 D ^DIR
"RTN","PXRMISE",42,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","PXRMISE",43,0)
 S SDTIME=Y
"RTN","PXRMISE",44,0)
 K DIR
"RTN","PXRMISE",45,0)
 ;Put the task into the queue.
"RTN","PXRMISE",46,0)
 S ZTRTN="EST^PXRMISE"
"RTN","PXRMISE",47,0)
 S ZTDESC="Clinical Reminders index size estimation"
"RTN","PXRMISE",48,0)
 S ZTDTH=SDTIME
"RTN","PXRMISE",49,0)
 S ZTIO=""
"RTN","PXRMISE",50,0)
 D ^%ZTLOAD
"RTN","PXRMISE",51,0)
 W !,"Task number ",ZTSK," queued."
"RTN","PXRMISE",52,0)
 Q
"RTN","PXRMISE",53,0)
 ;
"RTN","PXRMISE",54,0)
 ;===============================================================
"RTN","PXRMISE",55,0)
NEOR() ;Return number of entries in OR.
"RTN","PXRMISE",56,0)
 ;DBIA 4180
"RTN","PXRMISE",57,0)
 Q $P(^OR(100,0),U,4)
"RTN","PXRMISE",58,0)
 ;
"RTN","PXRMISE",59,0)
 ;===============================================================
"RTN","PXRMISE",60,0)
NEPROB() ;Return number of entries in PROBLEM LIST.
"RTN","PXRMISE",61,0)
 Q $P(^AUPNPROB(0),U,4)
"RTN","PXRMISE",62,0)
 ;
"RTN","PXRMISE",63,0)
 ;===============================================================
"RTN","PXRMISE",64,0)
NEPS() ;Return number of entries in PS(55).
"RTN","PXRMISE",65,0)
 N ADD,DA,DA1,DFN,DRUG,IND,NE,SDATE,SOL,STARTD,TEMP
"RTN","PXRMISE",66,0)
 ;DBIA 4181
"RTN","PXRMISE",67,0)
 S (DFN,IND,NE)=0
"RTN","PXRMISE",68,0)
 F  S DFN=+$O(^PS(55,DFN)) Q:DFN=0  D
"RTN","PXRMISE",69,0)
 .;Process Unit Dose.
"RTN","PXRMISE",70,0)
 . S DA=0
"RTN","PXRMISE",71,0)
 . F  S DA=+$O(^PS(55,DFN,5,DA)) Q:DA=0  D
"RTN","PXRMISE",72,0)
 .. S TEMP=$G(^PS(55,DFN,5,DA,2))
"RTN","PXRMISE",73,0)
 .. S STARTD=$P(TEMP,U,2)
"RTN","PXRMISE",74,0)
 .. I STARTD="" Q
"RTN","PXRMISE",75,0)
 ..;If the order is purged then SDATE is 1.
"RTN","PXRMISE",76,0)
 .. S SDATE=$P(TEMP,U,4)
"RTN","PXRMISE",77,0)
 .. I SDATE=1 Q
"RTN","PXRMISE",78,0)
 .. S DA1=0
"RTN","PXRMISE",79,0)
 .. F  S DA1=+$O(^PS(55,DFN,5,DA,1,DA1)) Q:DA1=0  D
"RTN","PXRMISE",80,0)
 ... S DRUG=$P(^PS(55,DFN,5,DA,1,DA1,0),U,1)
"RTN","PXRMISE",81,0)
 ... I DRUG="" Q
"RTN","PXRMISE",82,0)
 ... S NE=NE+1
"RTN","PXRMISE",83,0)
 .;Process the IV mutiple.
"RTN","PXRMISE",84,0)
 . S DA=0
"RTN","PXRMISE",85,0)
 . F  S DA=+$O(^PS(55,DFN,"IV",DA)) Q:DA=0  D
"RTN","PXRMISE",86,0)
 .. S TEMP=$G(^PS(55,DFN,"IV",DA,0))
"RTN","PXRMISE",87,0)
 .. S STARTD=$P(TEMP,U,2)
"RTN","PXRMISE",88,0)
 .. I STARTD="" Q
"RTN","PXRMISE",89,0)
 .. S SDATE=$P(TEMP,U,3)
"RTN","PXRMISE",90,0)
 .. I SDATE=1 Q
"RTN","PXRMISE",91,0)
 ..;Process Additives
"RTN","PXRMISE",92,0)
 .. S DA1=0
"RTN","PXRMISE",93,0)
 .. F  S DA1=+$O(^PS(55,DFN,"IV",DA,"AD",DA1)) Q:DA1=0  D
"RTN","PXRMISE",94,0)
 ... S ADD=$P(^PS(55,DFN,"IV",DA,"AD",DA1,0),U,1)
"RTN","PXRMISE",95,0)
 ... I ADD="" Q
"RTN","PXRMISE",96,0)
 ... S DRUG=$P($G(^PS(52.6,ADD,0)),U,2)
"RTN","PXRMISE",97,0)
 ... I DRUG="" Q
"RTN","PXRMISE",98,0)
 ... S NE=NE+1
"RTN","PXRMISE",99,0)
 ..;Process Solutions
"RTN","PXRMISE",100,0)
 .. S DA1=0
"RTN","PXRMISE",101,0)
 .. F  S DA1=+$O(^PS(55,DFN,"IV",DA,"SOL",DA1)) Q:DA1=0  D
"RTN","PXRMISE",102,0)
 ... S SOL=$P(^PS(55,DFN,"IV",DA,"SOL",DA1,0),U,1)
"RTN","PXRMISE",103,0)
 ... I SOL="" Q
"RTN","PXRMISE",104,0)
 ... S DRUG=$P($G(^PS(52.7,SOL,0)),U,2)
"RTN","PXRMISE",105,0)
 ... I DRUG="" Q
"RTN","PXRMISE",106,0)
 ... S NE=NE+1
"RTN","PXRMISE",107,0)
 Q NE
"RTN","PXRMISE",108,0)
 ;
"RTN","PXRMISE",109,0)
 ;===============================================================
"RTN","PXRMISE",110,0)
NEPSRX() ;Return number of entries in PSRX
"RTN","PXRMISE",111,0)
 N DA,DA1,DATE,DSUP,DFN,DRUG,NE,RDATE,TEMP
"RTN","PXRMISE",112,0)
 ;DBIA 4182
"RTN","PXRMISE",113,0)
 S (DA,NE)=0
"RTN","PXRMISE",114,0)
 F  S DA=+$O(^PSRX(DA)) Q:DA=0  D
"RTN","PXRMISE",115,0)
 . S TEMP=$G(^PSRX(DA,0))
"RTN","PXRMISE",116,0)
 . S DFN=$P(TEMP,U,2)
"RTN","PXRMISE",117,0)
 . I DFN="" Q
"RTN","PXRMISE",118,0)
 . S DRUG=$P(TEMP,U,6)
"RTN","PXRMISE",119,0)
 . I DRUG="" Q
"RTN","PXRMISE",120,0)
 . S DSUP=$P(TEMP,U,8)
"RTN","PXRMISE",121,0)
 . I DSUP="" Q
"RTN","PXRMISE",122,0)
 . S RDATE=+$P($G(^PSRX(DA,2)),U,13)
"RTN","PXRMISE",123,0)
 . I RDATE>0 S NE=NE+1
"RTN","PXRMISE",124,0)
 .;Process the refill mutiple.
"RTN","PXRMISE",125,0)
 . S DA1=0
"RTN","PXRMISE",126,0)
 . F  S DA1=+$O(^PSRX(DA,1,DA1)) Q:DA1=0  D
"RTN","PXRMISE",127,0)
 .. S TEMP=$G(^PSRX(DA,1,DA1,0))
"RTN","PXRMISE",128,0)
 .. S DSUP=+$P(TEMP,U,10)
"RTN","PXRMISE",129,0)
 .. S RDATE=+$P(TEMP,U,18)
"RTN","PXRMISE",130,0)
 .. I RDATE>0 S NE=NE+1
"RTN","PXRMISE",131,0)
 .;Process the partial fill multiple.
"RTN","PXRMISE",132,0)
 . S DA1=0
"RTN","PXRMISE",133,0)
 . F  S DA1=+$O(^PSRX(DA,"P",DA1)) Q:DA1=0  D
"RTN","PXRMISE",134,0)
 .. S TEMP=$G(^PSRX(DA,"P",DA1,0))
"RTN","PXRMISE",135,0)
 .. S DSUP=+$P(TEMP,U,10)
"RTN","PXRMISE",136,0)
 .. S RDATE=+$P(TEMP,U,19)
"RTN","PXRMISE",137,0)
 .. I RDATE>0 S NE=NE+1
"RTN","PXRMISE",138,0)
 Q NE
"RTN","PXRMISE",139,0)
 ;
"RTN","PXRMISE",140,0)
 ;===============================================================
"RTN","PXRMISE",141,0)
NEPTF() ;Return number of entries in PTF.
"RTN","PXRMISE",142,0)
 N D1,DA,DATE,DFN,ICD0,ICD9,JND,NE0,NE9,TEMP70,TEMP0,TEMPP,TEMPS
"RTN","PXRMISE",143,0)
 ;DBIA 4177
"RTN","PXRMISE",144,0)
 S (DA,NE0,NE9)=0
"RTN","PXRMISE",145,0)
 F  S DA=+$O(^DGPT(DA)) Q:DA=0  D
"RTN","PXRMISE",146,0)
 . S TEMP0=$G(^DGPT(DA,0))
"RTN","PXRMISE",147,0)
 . S DFN=$P(TEMP0,U,1)
"RTN","PXRMISE",148,0)
 . I DFN="" Q
"RTN","PXRMISE",149,0)
 . S D1=0
"RTN","PXRMISE",150,0)
 . F  S D1=+$O(^DGPT(DA,"S",D1)) Q:D1=0  D
"RTN","PXRMISE",151,0)
 .. S TEMPS=$G(^DGPT(DA,"S",D1,0))
"RTN","PXRMISE",152,0)
 .. S DATE=$P(TEMPS,U,1)
"RTN","PXRMISE",153,0)
 .. I DATE="" Q
"RTN","PXRMISE",154,0)
 .. F JND=8,9,10,11,12 D
"RTN","PXRMISE",155,0)
 ... S ICD0=$P(TEMPS,U,JND)
"RTN","PXRMISE",156,0)
 ... I (ICD0'=""),$D(^ICD0(ICD0)) S NE0=NE0+1
"RTN","PXRMISE",157,0)
 .;
"RTN","PXRMISE",158,0)
 . S D1=0
"RTN","PXRMISE",159,0)
 . F  S D1=+$O(^DGPT(DA,"P",D1)) Q:D1=0  D
"RTN","PXRMISE",160,0)
 .. S TEMPP=$G(^DGPT(DA,"P",D1,0))
"RTN","PXRMISE",161,0)
 .. S DATE=$P(TEMPP,U,1)
"RTN","PXRMISE",162,0)
 .. I DATE="" Q
"RTN","PXRMISE",163,0)
 .. F JND=5,6,7,8,9 D
"RTN","PXRMISE",164,0)
 ... S ICD0=$P(TEMPP,U,JND)
"RTN","PXRMISE",165,0)
 ... I (ICD0'=""),$D(^ICD0(ICD0)) S NE0=NE0+1
"RTN","PXRMISE",166,0)
 .;
"RTN","PXRMISE",167,0)
 .;Discharge ICD9 codes
"RTN","PXRMISE",168,0)
 . I $D(^DGPT(DA,70)) D
"RTN","PXRMISE",169,0)
 .. S TEMP70=$G(^DGPT(DA,70))
"RTN","PXRMISE",170,0)
 .. F JND=10,11,16,17,18,19,20,21,22,23,24 D
"RTN","PXRMISE",171,0)
 ... S ICD9=$P(TEMP70,U,JND)
"RTN","PXRMISE",172,0)
 ... I (ICD9'=""),$D(^ICD9(ICD9)) S NE9=NE9+1
"RTN","PXRMISE",173,0)
 .;
"RTN","PXRMISE",174,0)
 .;Movement ICD9 codes
"RTN","PXRMISE",175,0)
 . I '$D(^DGPT(DA,"M")) Q
"RTN","PXRMISE",176,0)
 . S D1=0
"RTN","PXRMISE",177,0)
 . F  S D1=$O(^DGPT(DA,"M",D1)) Q:+D1=0  D
"RTN","PXRMISE",178,0)
 .. S TEMPS=$G(^DGPT(DA,"M",D1,0))
"RTN","PXRMISE",179,0)
 .. S DATE=$P(TEMPS,U,10)
"RTN","PXRMISE",180,0)
 .. I DATE="" Q
"RTN","PXRMISE",181,0)
 .. F JND=5,6,7,8,9,11,12,13,14,15 D
"RTN","PXRMISE",182,0)
 ... S ICD9=$P(TEMPS,U,JND)
"RTN","PXRMISE",183,0)
 ... I (ICD9'=""),$D(^ICD9(ICD9)) S NE9=NE9+1
"RTN","PXRMISE",184,0)
 Q NE0+NE9
"RTN","PXRMISE",185,0)
 ;
"RTN","PXRMISE",186,0)
 ;===============================================================
"RTN","PXRMISE",187,0)
NERAD() ;Return number of entries in RAD/NUC MED PATIENT.
"RTN","PXRMISE",188,0)
 N IEN,NE
"RTN","PXRMISE",189,0)
 ;DBIA 4183
"RTN","PXRMISE",190,0)
 S (IEN,NE)=0
"RTN","PXRMISE",191,0)
 F  S IEN=$O(^RADPT(IEN)) Q:+IEN=0  S NE=NE+$P($G(^RADPT(IEN,"DT",0)),U,4)
"RTN","PXRMISE",192,0)
 Q NE
"RTN","PXRMISE",193,0)
 ;
"RTN","PXRMISE",194,0)
 ;===============================================================
"RTN","PXRMISE",195,0)
NEVCPT() ;Return number of entries in V CPT.
"RTN","PXRMISE",196,0)
 ;DBIA 4176
"RTN","PXRMISE",197,0)
 Q $P(^AUPNVCPT(0),U,4)
"RTN","PXRMISE",198,0)
 ;
"RTN","PXRMISE",199,0)
 ;===============================================================
"RTN","PXRMISE",200,0)
NEVHF() ;Return number of entries in V HEALTH FACTORS.
"RTN","PXRMISE",201,0)
 ;DBIA 4176
"RTN","PXRMISE",202,0)
 Q $P(^AUPNVHF(0),U,4)
"RTN","PXRMISE",203,0)
 ;
"RTN","PXRMISE",204,0)
 ;===============================================================
"RTN","PXRMISE",205,0)
NEVIMM() ;Return number of entries in V IMMUNIZATION
"RTN","PXRMISE",206,0)
 ;DBIA 4176
"RTN","PXRMISE",207,0)
 Q $P(^AUPNVIMM(0),U,4)
"RTN","PXRMISE",208,0)
 ;
"RTN","PXRMISE",209,0)
 ;===============================================================
"RTN","PXRMISE",210,0)
NEVIT() ;Return number of entries in GMRV VITAL MEASUREMENT
"RTN","PXRMISE",211,0)
 ;DBIA 4178
"RTN","PXRMISE",212,0)
 Q $P(^GMR(120.5,0),U,4)
"RTN","PXRMISE",213,0)
 ;
"RTN","PXRMISE",214,0)
 ;===============================================================
"RTN","PXRMISE",215,0)
NEVPED() ;Return number of entries in V PATIENT ED.
"RTN","PXRMISE",216,0)
 ;DBIA 4176
"RTN","PXRMISE",217,0)
 Q $P(^AUPNVPED(0),U,4)
"RTN","PXRMISE",218,0)
 ;
"RTN","PXRMISE",219,0)
 ;===============================================================
"RTN","PXRMISE",220,0)
NEVPOV() ;Return number of entries in V POV.
"RTN","PXRMISE",221,0)
 ;DBIA 4176
"RTN","PXRMISE",222,0)
 Q $P(^AUPNVPOV(0),U,4)
"RTN","PXRMISE",223,0)
 ;
"RTN","PXRMISE",224,0)
 ;===============================================================
"RTN","PXRMISE",225,0)
NEVSK() ;Return number of entries in V SKIN TEST.
"RTN","PXRMISE",226,0)
 ;DBIA 4176
"RTN","PXRMISE",227,0)
 Q $P(^AUPNVSK(0),U,4)
"RTN","PXRMISE",228,0)
 ;
"RTN","PXRMISE",229,0)
 ;===============================================================
"RTN","PXRMISE",230,0)
NEVXAM() ;Return number of entries in V EXAM.
"RTN","PXRMISE",231,0)
 ;DBIA 4176
"RTN","PXRMISE",232,0)
 Q $P(^AUPNVXAM(0),U,4)
"RTN","PXRMISE",233,0)
 ;
"RTN","PXRMISE",234,0)
 ;===============================================================
"RTN","PXRMISE",235,0)
NEYTD() ;Return number of entries in PSYCH INSTRUMENT PATIENT
"RTN","PXRMISE",236,0)
 N DATE,DFN,NE,TEST
"RTN","PXRMISE",237,0)
 ;DBIA 4184
"RTN","PXRMISE",238,0)
 S (DFN,NE)=0
"RTN","PXRMISE",239,0)
 F  S DFN=$O(^YTD(601.2,DFN)) Q:+DFN=0  D
"RTN","PXRMISE",240,0)
 . S TEST=0
"RTN","PXRMISE",241,0)
 . F  S TEST=$O(^YTD(601.2,DFN,1,TEST)) Q:+TEST=0  D
"RTN","PXRMISE",242,0)
 .. S DATE=0
"RTN","PXRMISE",243,0)
 .. F  S DATE=$O(^YTD(601.2,DFN,1,TEST,1,DATE)) Q:+DATE=0  S NE=NE+1
"RTN","PXRMISE",244,0)
 Q NE
"RTN","PXRMISE",245,0)
 ;
"RTN","PXRMISE",246,0)
 ;===============================================================
"RTN","PXRMISE",247,0)
SETDATA(GBL,GLIST,NUMGBL,RTN,SF) ;
"RTN","PXRMISE",248,0)
 S NUMGBL=16
"RTN","PXRMISE",249,0)
 S GLIST(1)="LABORATORY TEST (CH, Anatomic Path, Micro)",GBL(1)=63
"RTN","PXRMISE",250,0)
 S GLIST(2)="MENTAL HEALTH",GBL(2)=601.2
"RTN","PXRMISE",251,0)
 S GLIST(3)="ORDER",GBL(3)=100
"RTN","PXRMISE",252,0)
 S GLIST(4)="PTF",GBL(4)=45
"RTN","PXRMISE",253,0)
 S GLIST(5)="PHARMACY PATIENT",GBL(5)=55
"RTN","PXRMISE",254,0)
 S GLIST(6)="PRESCRIPTION",GBL(6)=52
"RTN","PXRMISE",255,0)
 S GLIST(7)="PROBLEM LIST",GBL(7)=9000011
"RTN","PXRMISE",256,0)
 S GLIST(8)="RADIOLOGY",GBL(8)=70
"RTN","PXRMISE",257,0)
 S GLIST(9)="V CPT",GBL(9)=9000010.18
"RTN","PXRMISE",258,0)
 S GLIST(10)="V EXAM",GBL(10)=9000010.13
"RTN","PXRMISE",259,0)
 S GLIST(11)="V HEALTH FACTORS",GBL(11)=9000010.23
"RTN","PXRMISE",260,0)
 S GLIST(12)="V IMMUNIZATION",GBL(12)=9000010.11
"RTN","PXRMISE",261,0)
 S GLIST(13)="V PATIENT ED",GBL(13)=9000010.16
"RTN","PXRMISE",262,0)
 S GLIST(14)="V POV",GBL(14)=9000010.07
"RTN","PXRMISE",263,0)
 S GLIST(15)="V SKIN TEST",GBL(15)=9000010.12
"RTN","PXRMISE",264,0)
 S GLIST(16)="VITAL MEASUREMENT",GBL(16)=120.5
"RTN","PXRMISE",265,0)
 S RTN(45)="NEPTF^PXRMISE"
"RTN","PXRMISE",266,0)
 S RTN(52)="NEPSRX^PXRMISE"
"RTN","PXRMISE",267,0)
 S RTN(55)="NEPS^PXRMISE"
"RTN","PXRMISE",268,0)
 S RTN(63)="NELR^PXRMLABS"
"RTN","PXRMISE",269,0)
 S RTN(70)="NERAD^PXRMISE"
"RTN","PXRMISE",270,0)
 S RTN(100)="NEOR^PXRMISE"
"RTN","PXRMISE",271,0)
 S RTN(120.5)="NEVIT^PXRMISE"
"RTN","PXRMISE",272,0)
 S RTN(601.2)="NEYTD^PXRMISE"
"RTN","PXRMISE",273,0)
 S RTN(9000011)="NEPROB^PXRMISE"
"RTN","PXRMISE",274,0)
 S RTN(9000010.07)="NEVPOV^PXRMISE"
"RTN","PXRMISE",275,0)
 S RTN(9000010.11)="NEVIMM^PXRMISE"
"RTN","PXRMISE",276,0)
 S RTN(9000010.12)="NEVSK^PXRMISE"
"RTN","PXRMISE",277,0)
 S RTN(9000010.13)="NEVXAM^PXRMISE"
"RTN","PXRMISE",278,0)
 S RTN(9000010.16)="NEVPED^PXRMISE"
"RTN","PXRMISE",279,0)
 S RTN(9000010.18)="NEVCPT^PXRMISE"
"RTN","PXRMISE",280,0)
 S RTN(9000010.23)="NEVHF^PXRMISE"
"RTN","PXRMISE",281,0)
 D LSF^PXRMISF(.SF)
"RTN","PXRMISE",282,0)
 Q
"RTN","PXRMISE",283,0)
 ;
"RTN","PXRMISF")
0^2^B4453210
"RTN","PXRMISF",1,0)
PXRMISF ; SLC/PKR - Index size estimating scale factor routines. ;09/11/2003
"RTN","PXRMISF",2,0)
       ;;1.5;CLINICAL REMINDERS;**20**;Jun 19, 2000
"RTN","PXRMISF",3,0)
 ;
"RTN","PXRMISF",4,0)
 ;===============================================================
"RTN","PXRMISF",5,0)
ERRORMSG(SF) ;Send an error message indicating the estimate could not
"RTN","PXRMISF",6,0)
 ;be made.
"RTN","PXRMISF",7,0)
 N VERSION
"RTN","PXRMISF",8,0)
 S VERSION=$P(SF,U,2)
"RTN","PXRMISF",9,0)
 S ^TMP("PXRMXMZ",$J,1,0)="Size Estimate for ^PXRMINDX cannot be made!"
"RTN","PXRMISF",10,0)
 S ^TMP("PXRMXMZ",$J,2,0)=VERSION_" is an unknown system."
"RTN","PXRMISF",11,0)
 S XMSUB="Size estimate for index global cannot be made"
"RTN","PXRMISF",12,0)
 D SEND^PXRMMSG(XMSUB)
"RTN","PXRMISF",13,0)
 S ZTREQ="@"
"RTN","PXRMISF",14,0)
 Q
"RTN","PXRMISF",15,0)
 ;
"RTN","PXRMISF",16,0)
 ;===============================================================
"RTN","PXRMISF",17,0)
LSF(SF) ;Load the blocks/index entry scale factors.
"RTN","PXRMISF",18,0)
 N VERSION
"RTN","PXRMISF",19,0)
 N SFC,SFD
"RTN","PXRMISF",20,0)
 ;Cache scale factors
"RTN","PXRMISF",21,0)
 S SFC(45)=0.034578654
"RTN","PXRMISF",22,0)
 S SFC(52)=0.044820784
"RTN","PXRMISF",23,0)
 S SFC(55)=0.047974217
"RTN","PXRMISF",24,0)
 S SFC(63)=0.075656684
"RTN","PXRMISF",25,0)
 S SFC(70)=0.053003195
"RTN","PXRMISF",26,0)
 S SFC(100)=0.046423473
"RTN","PXRMISF",27,0)
 S SFC(120.5)=0.01879364
"RTN","PXRMISF",28,0)
 S SFC(601.2)=0.04392942
"RTN","PXRMISF",29,0)
 S SFC(9000011)=0.023941427
"RTN","PXRMISF",30,0)
 S SFC(9000010.07)=0.022569777
"RTN","PXRMISF",31,0)
 S SFC(9000010.11)=0.023919113
"RTN","PXRMISF",32,0)
 S SFC(9000010.12)=0.022938475
"RTN","PXRMISF",33,0)
 S SFC(9000010.13)=0.02297879
"RTN","PXRMISF",34,0)
 S SFC(9000010.16)=0.023290489
"RTN","PXRMISF",35,0)
 S SFC(9000010.18)=0.022636608
"RTN","PXRMISF",36,0)
 S SFC(9000010.23)=0.024028924
"RTN","PXRMISF",37,0)
 ;DSM scale factors
"RTN","PXRMISF",38,0)
 S SFD(45)=0.099921811
"RTN","PXRMISF",39,0)
 S SFD(52)=0.138842661
"RTN","PXRMISF",40,0)
 S SFD(55)=0.138609592
"RTN","PXRMISF",41,0)
 S SFD(63)=0.163250688
"RTN","PXRMISF",42,0)
 S SFD(70)=0.136531655
"RTN","PXRMISF",43,0)
 S SFD(100)=0.136755671
"RTN","PXRMISF",44,0)
 S SFD(120.5)=0.063012241
"RTN","PXRMISF",45,0)
 S SFD(601.2)=0.111356128
"RTN","PXRMISF",46,0)
 S SFD(9000011)=0.07777772
"RTN","PXRMISF",47,0)
 S SFD(9000010.07)=0.022441328
"RTN","PXRMISF",48,0)
 S SFD(9000010.11)=0.077488311
"RTN","PXRMISF",49,0)
 S SFD(9000010.12)=0.069942116
"RTN","PXRMISF",50,0)
 S SFD(9000010.13)=0.079978059
"RTN","PXRMISF",51,0)
 S SFD(9000010.16)=0.080224754
"RTN","PXRMISF",52,0)
 S SFD(9000010.18)=0.07300721
"RTN","PXRMISF",53,0)
 S SFD(9000010.23)=0.082573858
"RTN","PXRMISF",54,0)
 S VERSION=$$VERSION^%ZOSV(1)
"RTN","PXRMISF",55,0)
 S VERSION=$$UP^XLFSTR(VERSION)
"RTN","PXRMISF",56,0)
 I VERSION["CACHE" M SF=SFC S VERSION="",SF=1
"RTN","PXRMISF",57,0)
 I VERSION["DSM" M SF=SFD S VERSION="",SF=1
"RTN","PXRMISF",58,0)
 I VERSION'="" D
"RTN","PXRMISF",59,0)
 . W !,VERSION," is an unknown system cannot make size estimate!"
"RTN","PXRMISF",60,0)
 . S SF=-1_U_VERSION
"RTN","PXRMISF",61,0)
 Q
"RTN","PXRMISF",62,0)
 ;
"RTN","PXRMLABS")
0^3^B39253882
"RTN","PXRMLABS",1,0)
PXRMLABS ; SLC/PKR - Estimate of lab entries to set up. ;8/5/03  16:20
"RTN","PXRMLABS",2,0)
       ;;1.5;CLINICAL REMINDERS;**20**;Jun 19, 2000
"RTN","PXRMLABS",3,0)
 ;===============================================================
"RTN","PXRMLABS",4,0)
NELR() ;.
"RTN","PXRMLABS",5,0)
 N LRDFN,LRDN,LRIDT,NE,TEMP
"RTN","PXRMLABS",6,0)
 ;DBIA 4179
"RTN","PXRMLABS",7,0)
 S NE=0
"RTN","PXRMLABS",8,0)
 S LRDFN=.9
"RTN","PXRMLABS",9,0)
 F  S LRDFN=$O(^LR(LRDFN)) Q:LRDFN<1  D
"RTN","PXRMLABS",10,0)
 . S TEMP=$G(^LR(LRDFN,0))
"RTN","PXRMLABS",11,0)
 . I $P(TEMP,U,2)'=2 Q
"RTN","PXRMLABS",12,0)
 . S LRIDT=0
"RTN","PXRMLABS",13,0)
 . F  S LRIDT=$O(^LR(LRDFN,"CH",LRIDT)) Q:LRIDT<1  D
"RTN","PXRMLABS",14,0)
 .. I '$P($G(^LR(LRDFN,"CH",LRIDT,0)),U,3) Q  ; check for completed
"RTN","PXRMLABS",15,0)
 .. S LRDN=1
"RTN","PXRMLABS",16,0)
 .. F  S LRDN=$O(^LR(LRDFN,"CH",LRIDT,LRDN)) Q:LRDN<1  D
"RTN","PXRMLABS",17,0)
 ... S NE=NE+1
"RTN","PXRMLABS",18,0)
 D AP(.NE)
"RTN","PXRMLABS",19,0)
 D MICRO(.NE)
"RTN","PXRMLABS",20,0)
 Q NE
"RTN","PXRMLABS",21,0)
 ;
"RTN","PXRMLABS",22,0)
 ;===============================================================
"RTN","PXRMLABS",23,0)
AP(NE) ;
"RTN","PXRMLABS",24,0)
 N ETIOL,I,II,III,ICD,ICDX
"RTN","PXRMLABS",25,0)
 N LRDFN,ORGAN,SNOMED,SPEC,SUB,SUBS,TEMP
"RTN","PXRMLABS",26,0)
 ;DBIA 4179
"RTN","PXRMLABS",27,0)
 K ANUMS
"RTN","PXRMLABS",28,0)
 D AANUMS(.ANUMS)
"RTN","PXRMLABS",29,0)
 S LRDFN=.9
"RTN","PXRMLABS",30,0)
 F  S LRDFN=$O(^LR(LRDFN)) Q:LRDFN<1  D
"RTN","PXRMLABS",31,0)
 . S TEMP=$G(^LR(LRDFN,0))
"RTN","PXRMLABS",32,0)
 . I $P(TEMP,U,2)'=2 Q
"RTN","PXRMLABS",33,0)
 . D CYEMSP(LRDFN,.ANUMS,.NE) ; cytology, electron microscopy, sugrical path
"RTN","PXRMLABS",34,0)
 . I '+$G(^LR(LRDFN,"AU")) Q  ; date of autopsy
"RTN","PXRMLABS",35,0)
 . S NE=NE+1
"RTN","PXRMLABS",36,0)
 . S SPEC=0
"RTN","PXRMLABS",37,0)
 . F  S SPEC=$O(^LR(LRDFN,33,SPEC)) Q:SPEC<1  D
"RTN","PXRMLABS",38,0)
 .. I '$L($P($G(^LR(LRDFN,33,SPEC,0)),U)) Q
"RTN","PXRMLABS",39,0)
 .. S NE=NE+1
"RTN","PXRMLABS",40,0)
 . S ICD=0
"RTN","PXRMLABS",41,0)
 . F  S ICD=$O(^LR(LRDFN,80,ICD)) Q:ICD<1  D
"RTN","PXRMLABS",42,0)
 .. S ICDX=+$G(^LR(LRDFN,80,ICD,0))
"RTN","PXRMLABS",43,0)
 .. I 'ICDX Q
"RTN","PXRMLABS",44,0)
 .. S NE=NE+1
"RTN","PXRMLABS",45,0)
 . S I=0
"RTN","PXRMLABS",46,0)
 . F  S I=$O(^LR(LRDFN,"AY",I)) Q:I<1  D
"RTN","PXRMLABS",47,0)
 .. S ORGAN=+$G(^LR(LRDFN,"AY",I,0))
"RTN","PXRMLABS",48,0)
 .. I 'ORGAN Q
"RTN","PXRMLABS",49,0)
 .. S NE=NE+1
"RTN","PXRMLABS",50,0)
 .. F SUBS="1D","2M","3F","4P" D
"RTN","PXRMLABS",51,0)
 ... S SUB=+SUBS
"RTN","PXRMLABS",52,0)
 ... S II=0
"RTN","PXRMLABS",53,0)
 ... F  S II=$O(^LR(LRDFN,"AY",I,SUB,II)) Q:II<1  D
"RTN","PXRMLABS",54,0)
 .... S SNOMED=+$G(^LR(LRDFN,"AY",I,SUB,II,0))
"RTN","PXRMLABS",55,0)
 .... I 'SNOMED Q
"RTN","PXRMLABS",56,0)
 .... S NE=NE+1
"RTN","PXRMLABS",57,0)
 .... I SUB'=2 Q
"RTN","PXRMLABS",58,0)
 .... S III=0
"RTN","PXRMLABS",59,0)
 .... F  S III=$O(^LR(LRDFN,"AY",I,SUB,II,1,III)) Q:III<1  D
"RTN","PXRMLABS",60,0)
 ..... S ETIOL=+$G(^LR(LRDFN,"AY",I,SUB,II,1,III,0))
"RTN","PXRMLABS",61,0)
 ..... I 'ETIOL Q
"RTN","PXRMLABS",62,0)
 ..... S NE=NE+1
"RTN","PXRMLABS",63,0)
 Q
"RTN","PXRMLABS",64,0)
 ;
"RTN","PXRMLABS",65,0)
CYEMSP(LRDFN,ANUMS,NE) ;
"RTN","PXRMLABS",66,0)
 N ACC,APSUB,DATE,ERR,I,ICD,ICDX,LRIDT,NODE,ORGAN,PREP,SPEC
"RTN","PXRMLABS",67,0)
 N TEST,TESTS K TESTS
"RTN","PXRMLABS",68,0)
 ;DBIA 4179
"RTN","PXRMLABS",69,0)
 F APSUB="CY","EM","SP" D
"RTN","PXRMLABS",70,0)
 . I '$D(^LR(LRDFN,APSUB,0)) Q
"RTN","PXRMLABS",71,0)
 . S LRIDT=0
"RTN","PXRMLABS",72,0)
 . F  S LRIDT=$O(^LR(LRDFN,APSUB,LRIDT)) Q:LRIDT<1  D
"RTN","PXRMLABS",73,0)
 .. S DATE=+$G(^LR(LRDFN,APSUB,LRIDT,0))
"RTN","PXRMLABS",74,0)
 .. I 'DATE Q
"RTN","PXRMLABS",75,0)
 .. I '($P(^LR(LRDFN,APSUB,LRIDT,0),U,3)&($P(^(0),U,11))) Q
"RTN","PXRMLABS",76,0)
 .. S SPEC=0
"RTN","PXRMLABS",77,0)
 .. F  S SPEC=$O(^LR(LRDFN,APSUB,LRIDT,.1,SPEC)) Q:SPEC<1  D
"RTN","PXRMLABS",78,0)
 ... I '$L($P($G(^LR(LRDFN,APSUB,LRIDT,.1,SPEC,0)),U)) Q
"RTN","PXRMLABS",79,0)
 ... S NE=NE+1
"RTN","PXRMLABS",80,0)
 ... S PREP=0
"RTN","PXRMLABS",81,0)
 ... F  S PREP=$O(^LR(LRDFN,APSUB,LRIDT,.1,SPEC,1,PREP)) Q:PREP<1  D
"RTN","PXRMLABS",82,0)
 .... S TEST=0
"RTN","PXRMLABS",83,0)
 .... F  S TEST=$O(^LR(LRDFN,APSUB,LRIDT,.1,SPEC,1,PREP,1,TEST)) Q:TEST<1  D
"RTN","PXRMLABS",84,0)
 ..... I '$L($P($G(^LR(LRDFN,APSUB,LRIDT,.1,SPEC,1,PREP,1,TEST,0)),U)) Q
"RTN","PXRMLABS",85,0)
 ..... S NE=NE+1
"RTN","PXRMLABS",86,0)
 .. S ACC=$P(^LR(LRDFN,APSUB,LRIDT,0),U,6)
"RTN","PXRMLABS",87,0)
 .. I $L(ACC) D
"RTN","PXRMLABS",88,0)
 ... S NODE=LRDFN_";"_APSUB_";"_LRIDT_";0"
"RTN","PXRMLABS",89,0)
 ... D ACC(.TESTS,ACC,DATE,.ANUMS,.ERR)
"RTN","PXRMLABS",90,0)
 ... I 'ERR D
"RTN","PXRMLABS",91,0)
 .... S TEST=0
"RTN","PXRMLABS",92,0)
 .... F  S TEST=$O(TESTS(TEST)) Q:TEST<1  D
"RTN","PXRMLABS",93,0)
 ..... S NE=NE+1
"RTN","PXRMLABS",94,0)
 .. S ICD=0
"RTN","PXRMLABS",95,0)
 .. F  S ICD=$O(^LR(LRDFN,APSUB,LRIDT,3,ICD)) Q:ICD<1  D
"RTN","PXRMLABS",96,0)
 ... S ICDX=+$G(^LR(LRDFN,APSUB,LRIDT,3,ICD,0))
"RTN","PXRMLABS",97,0)
 ... I 'ICDX Q
"RTN","PXRMLABS",98,0)
 ... S NE=NE+1
"RTN","PXRMLABS",99,0)
 .. S I=0
"RTN","PXRMLABS",100,0)
 .. F  S I=$O(^LR(LRDFN,APSUB,LRIDT,2,I)) Q:I<1  D
"RTN","PXRMLABS",101,0)
 ... S ORGAN=+$G(^LR(LRDFN,APSUB,LRIDT,2,I,0))
"RTN","PXRMLABS",102,0)
 ... I 'ORGAN Q
"RTN","PXRMLABS",103,0)
 ... S NE=NE+1
"RTN","PXRMLABS",104,0)
 ... D SNOMED(LRDFN,LRIDT,DATE,APSUB,I,.NE)
"RTN","PXRMLABS",105,0)
 Q
"RTN","PXRMLABS",106,0)
 ;
"RTN","PXRMLABS",107,0)
SNOMED(LRDFN,LRIDT,DATE,APSUB,I,NE) ;
"RTN","PXRMLABS",108,0)
 N ETIOL,II,III,SNOMED,SUB,SUBS
"RTN","PXRMLABS",109,0)
 ;DBIA 4179
"RTN","PXRMLABS",110,0)
 F SUBS="1D","2M","3F","4P" D
"RTN","PXRMLABS",111,0)
 . S SUB=+SUBS
"RTN","PXRMLABS",112,0)
 . S II=0
"RTN","PXRMLABS",113,0)
 . F  S II=$O(^LR(LRDFN,APSUB,LRIDT,2,I,SUB,II)) Q:II<1  D
"RTN","PXRMLABS",114,0)
 .. S SNOMED=+$G(^LR(LRDFN,APSUB,LRIDT,2,I,SUB,II,0))
"RTN","PXRMLABS",115,0)
 .. I 'SNOMED Q
"RTN","PXRMLABS",116,0)
 .. S NE=NE+1
"RTN","PXRMLABS",117,0)
 .. I SUB'=2 Q
"RTN","PXRMLABS",118,0)
 .. S III=0
"RTN","PXRMLABS",119,0)
 .. F  S III=$O(^LR(LRDFN,APSUB,LRIDT,2,I,SUB,II,1,III)) Q:III<1  D
"RTN","PXRMLABS",120,0)
 ... S ETIOL=+$G(^LR(LRDFN,APSUB,LRIDT,2,I,SUB,II,1,III,0))
"RTN","PXRMLABS",121,0)
 ... I 'ETIOL Q
"RTN","PXRMLABS",122,0)
 ... S NE=NE+1
"RTN","PXRMLABS",123,0)
 Q
"RTN","PXRMLABS",124,0)
 ;
"RTN","PXRMLABS",125,0)
 ;===============================================================
"RTN","PXRMLABS",126,0)
MICRO(NE) ;
"RTN","PXRMLABS",127,0)
 N AB,ABDN,ACC,ANUMS,DATE,ERR
"RTN","PXRMLABS",128,0)
 N LRDFN,LRIDT,ORG,ORGNUM,SPEC,SUB
"RTN","PXRMLABS",129,0)
 N TB,TBDN,TEMP,TEST,TESTS
"RTN","PXRMLABS",130,0)
 ;DBIA 4179
"RTN","PXRMLABS",131,0)
 K ANUMS,TESTS
"RTN","PXRMLABS",132,0)
 D AANUMS(.ANUMS)
"RTN","PXRMLABS",133,0)
 S LRDFN=.9
"RTN","PXRMLABS",134,0)
 F  S LRDFN=$O(^LR(LRDFN)) Q:LRDFN<1  D
"RTN","PXRMLABS",135,0)
 . S TEMP=$G(^LR(LRDFN,0))
"RTN","PXRMLABS",136,0)
 . I $P(TEMP,U,2)'=2 Q
"RTN","PXRMLABS",137,0)
 . S LRIDT=0
"RTN","PXRMLABS",138,0)
 . F  S LRIDT=$O(^LR(LRDFN,"MI",LRIDT)) Q:LRIDT<1  D
"RTN","PXRMLABS",139,0)
 .. S DATE=+$G(^LR(LRDFN,"MI",LRIDT,0))
"RTN","PXRMLABS",140,0)
 .. I 'DATE Q
"RTN","PXRMLABS",141,0)
 .. S SPEC=+$P(^LR(LRDFN,"MI",LRIDT,0),U,5)
"RTN","PXRMLABS",142,0)
 .. I 'SPEC Q
"RTN","PXRMLABS",143,0)
 .. S NE=NE+1
"RTN","PXRMLABS",144,0)
 .. S ACC=$P(^LR(LRDFN,"MI",LRIDT,0),U,6)
"RTN","PXRMLABS",145,0)
 .. I $L(ACC) D
"RTN","PXRMLABS",146,0)
 ... D ACC(.TESTS,ACC,DATE,.ANUMS,.ERR)
"RTN","PXRMLABS",147,0)
 ... I 'ERR D
"RTN","PXRMLABS",148,0)
 .... S TEST=0
"RTN","PXRMLABS",149,0)
 .... F  S TEST=$O(TESTS(TEST)) Q:TEST<1  D
"RTN","PXRMLABS",150,0)
 ..... S NE=NE+1
"RTN","PXRMLABS",151,0)
 .. I $G(^LR(LRDFN,"MI",LRIDT,1)) D
"RTN","PXRMLABS",152,0)
 ... S ORGNUM=0
"RTN","PXRMLABS",153,0)
 ... F  S ORGNUM=$O(^LR(LRDFN,"MI",LRIDT,3,ORGNUM)) Q:ORGNUM<1  D
"RTN","PXRMLABS",154,0)
 .... S ORG=+$G(^LR(LRDFN,"MI",LRIDT,3,ORGNUM,0))
"RTN","PXRMLABS",155,0)
 .... I 'ORG Q
"RTN","PXRMLABS",156,0)
 .... S NE=NE+1
"RTN","PXRMLABS",157,0)
 .... S ABDN=1
"RTN","PXRMLABS",158,0)
 .... F  S ABDN=$O(^LR(LRDFN,"MI",LRIDT,3,ORGNUM,ABDN)) Q:ABDN<1  D
"RTN","PXRMLABS",159,0)
 ..... S AB=+$G(^TMP("LRPXSXRB",$J,"AB",ABDN))
"RTN","PXRMLABS",160,0)
 ..... I 'AB Q
"RTN","PXRMLABS",161,0)
 ..... S NE=NE+1
"RTN","PXRMLABS",162,0)
 .. F SUB=6,9,12,17 D
"RTN","PXRMLABS",163,0)
 ... I '$G(^LR(LRDFN,"MI",LRIDT,(SUB-1))) Q
"RTN","PXRMLABS",164,0)
 ... S ORGNUM=0
"RTN","PXRMLABS",165,0)
 ... F  S ORGNUM=$O(^LR(LRDFN,"MI",LRIDT,SUB,ORGNUM)) Q:ORGNUM<1  D
"RTN","PXRMLABS",166,0)
 .... S ORG=+$G(^LR(LRDFN,"MI",LRIDT,SUB,ORGNUM,0))
"RTN","PXRMLABS",167,0)
 .... I 'ORG Q
"RTN","PXRMLABS",168,0)
 .... S NE=NE+1
"RTN","PXRMLABS",169,0)
 .... I SUB'=12 Q
"RTN","PXRMLABS",170,0)
 .... S TBDN=2
"RTN","PXRMLABS",171,0)
 .... F  S TBDN=$O(^LR(LRDFN,"MI",LRIDT,12,ORGNUM,TBDN)) Q:TBDN<2  D
"RTN","PXRMLABS",172,0)
 ..... S TB=+$G(^TMP("LRPXSXRB",$J,"TB",TBDN))
"RTN","PXRMLABS",173,0)
 ..... I '$L(TB) Q
"RTN","PXRMLABS",174,0)
 ..... S NE=NE+1
"RTN","PXRMLABS",175,0)
 Q
"RTN","PXRMLABS",176,0)
 ;
"RTN","PXRMLABS",177,0)
AANUMS(ANUMS) ;
"RTN","PXRMLABS",178,0)
 N AA,ABREV K ANUMS
"RTN","PXRMLABS",179,0)
 ;DBIA 4185
"RTN","PXRMLABS",180,0)
 S AA=0
"RTN","PXRMLABS",181,0)
 F  S AA=$O(^LRO(68,AA)) Q:AA<1  D
"RTN","PXRMLABS",182,0)
 . S ABREV=$P($G(^LRO(68,AA,0)),U,11)
"RTN","PXRMLABS",183,0)
 . I $L(ABREV) S ANUMS(ABREV)=AA
"RTN","PXRMLABS",184,0)
 Q
"RTN","PXRMLABS",185,0)
 ;
"RTN","PXRMLABS",186,0)
ACC(TESTS,ACC,BDN,ANUMS,ERR) ;
"RTN","PXRMLABS",187,0)
 ; returns TESTS from micro accession, ACC, BDN required
"RTN","PXRMLABS",188,0)
 ; BDN is beginning date number
"RTN","PXRMLABS",189,0)
 ; ANUMS is array of accession name numbers (avoids lookup on repeated calls)
"RTN","PXRMLABS",190,0)
 N DIC,LRAA,LRAAB,LRAD,LRAN,TEST,X,Y K DIC,TESTS
"RTN","PXRMLABS",191,0)
 S ERR=0
"RTN","PXRMLABS",192,0)
 I '$L($G(ACC)) S ERR=1 Q
"RTN","PXRMLABS",193,0)
 S LRAAB=$P(ACC," ")
"RTN","PXRMLABS",194,0)
 I LRAAB="" Q
"RTN","PXRMLABS",195,0)
 S BDN=$E($G(BDN))
"RTN","PXRMLABS",196,0)
 I BDN'>1 S ERR=1 Q
"RTN","PXRMLABS",197,0)
 S LRAN=+$P(ACC," ",3)
"RTN","PXRMLABS",198,0)
 I 'LRAN S ERR=1 Q
"RTN","PXRMLABS",199,0)
 S LRAA=+$G(ANUMS(LRAAB))
"RTN","PXRMLABS",200,0)
 I 'LRAA D
"RTN","PXRMLABS",201,0)
 . S DIC=68,DIC(0)="M"
"RTN","PXRMLABS",202,0)
 . S X=LRAAB
"RTN","PXRMLABS",203,0)
 . D ^DIC K DIC
"RTN","PXRMLABS",204,0)
 . S LRAA=+Y
"RTN","PXRMLABS",205,0)
 . S ANUMS(LRAAB)=LRAA
"RTN","PXRMLABS",206,0)
 I LRAA'>0 S ERR=1 Q
"RTN","PXRMLABS",207,0)
 S LRAD=BDN_$P(ACC," ",2)_"0000" ; yearly acc areas are assumed
"RTN","PXRMLABS",208,0)
 S TEST=0
"RTN","PXRMLABS",209,0)
 F  S TEST=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,TEST)) Q:TEST<1  D
"RTN","PXRMLABS",210,0)
 . S TESTS(TEST)=TEST
"RTN","PXRMLABS",211,0)
 Q
"RTN","PXRMLABS",212,0)
 ;
"VER")
8.0^22.0
**END**
**END**
