Released IB*2*329 SEQ #292
Extracted from mail message
**KIDS**:IB*2.0*329^

**INSTALL NAME**
IB*2.0*329
"BLD",5765,0)
IB*2.0*329^INTEGRATED BILLING^0^3051011^y
"BLD",5765,1,0)
^^1^1^3051011^
"BLD",5765,1,1,0)
CMAC 2005 update for 'Non-Facility' charges.
"BLD",5765,4,0)
^9.64PA^^
"BLD",5765,"KRN",0)
^9.67PA^8989.52^19
"BLD",5765,"KRN",.4,0)
.4
"BLD",5765,"KRN",.401,0)
.401
"BLD",5765,"KRN",.402,0)
.402
"BLD",5765,"KRN",.403,0)
.403
"BLD",5765,"KRN",.5,0)
.5
"BLD",5765,"KRN",.84,0)
.84
"BLD",5765,"KRN",3.6,0)
3.6
"BLD",5765,"KRN",3.8,0)
3.8
"BLD",5765,"KRN",9.2,0)
9.2
"BLD",5765,"KRN",9.8,0)
9.8
"BLD",5765,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5765,"KRN",9.8,"NM",1,0)
IBCRHBC3^^0^B31650402
"BLD",5765,"KRN",9.8,"NM","B","IBCRHBC3",1)

"BLD",5765,"KRN",19,0)
19
"BLD",5765,"KRN",19.1,0)
19.1
"BLD",5765,"KRN",101,0)
101
"BLD",5765,"KRN",409.61,0)
409.61
"BLD",5765,"KRN",771,0)
771
"BLD",5765,"KRN",870,0)
870
"BLD",5765,"KRN",8989.51,0)
8989.51
"BLD",5765,"KRN",8989.52,0)
8989.52
"BLD",5765,"KRN",8994,0)
8994
"BLD",5765,"KRN","B",.4,.4)

"BLD",5765,"KRN","B",.401,.401)

"BLD",5765,"KRN","B",.402,.402)

"BLD",5765,"KRN","B",.403,.403)

"BLD",5765,"KRN","B",.5,.5)

"BLD",5765,"KRN","B",.84,.84)

"BLD",5765,"KRN","B",3.6,3.6)

"BLD",5765,"KRN","B",3.8,3.8)

"BLD",5765,"KRN","B",9.2,9.2)

"BLD",5765,"KRN","B",9.8,9.8)

"BLD",5765,"KRN","B",19,19)

"BLD",5765,"KRN","B",19.1,19.1)

"BLD",5765,"KRN","B",101,101)

"BLD",5765,"KRN","B",409.61,409.61)

"BLD",5765,"KRN","B",771,771)

"BLD",5765,"KRN","B",870,870)

"BLD",5765,"KRN","B",8989.51,8989.51)

"BLD",5765,"KRN","B",8989.52,8989.52)

"BLD",5765,"KRN","B",8994,8994)

"BLD",5765,"QUES",0)
^9.62^^
"BLD",5765,"REQB",0)
^9.611^1^1
"BLD",5765,"REQB",1,0)
IB*2.0*307^1
"BLD",5765,"REQB","B","IB*2.0*307",1)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^2^1
"PKG",200,20,2,0)
2^^IBAXDR
"PKG",200,20,2,1)

"PKG",200,20,"B",2,2)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321
"PKG",200,22,1,"PAH",1,0)
329^3051011
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3051011
"PKG",200,22,1,"PAH",1,1,1,0)
CMAC 2005 update for 'Non-Facility' charges.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IBCRHBC3")
0^1^B31650402
"RTN","IBCRHBC3",1,0)
IBCRHBC3 ;ALB/ARH - RATES: UPLOAD HOST FILES (CMAC 2005+) ; 10-MAY-2005
"RTN","IBCRHBC3",2,0)
 ;;2.0;INTEGRATED BILLING;**307,329**;21-MAR-94
"RTN","IBCRHBC3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCRHBC3",4,0)
 ;
"RTN","IBCRHBC3",5,0)
 ; ROUTINE SPECIFIC FOR FORMAT OF YEAR 2005+ CMAC FILES
"RTN","IBCRHBC3",6,0)
 ;
"RTN","IBCRHBC3",7,0)
CMAC(IBPATH,IBFILE,IBNAME,IBMODP,IBMODT) ; upload CMAC file from a VMS file into ^XTMP
"RTN","IBCRHBC3",8,0)
 N X,Y,IBI,IBXRF,IBDONE,IBXRF1,IBXRF2,IBFLINE,IBINACT,IBMOD,IBCHG
"RTN","IBCRHBC3",9,0)
 N IBLOC,IBCPT,IBNFP,IBFP,IBNFNP,IBFNP,IBEFDT,IBTRDT,IBPPC,IBPTC,IBNPPC,IBNPTC
"RTN","IBCRHBC3",10,0)
 ;
"RTN","IBCRHBC3",11,0)
 D SETUP(IBFILE,IBNAME)
"RTN","IBCRHBC3",12,0)
 ;
"RTN","IBCRHBC3",13,0)
 S IBXRF=IBNAME_IBFILE,IBLOC="",IBDONE=""
"RTN","IBCRHBC3",14,0)
 ;
"RTN","IBCRHBC3",15,0)
 D OPEN^%ZISH("CMAC UPLOAD",IBPATH,IBFILE,"R") I POP W !!,"**** Unable to open ",IBPATH,IBFILE,! G CMACQ
"RTN","IBCRHBC3",16,0)
 ;
"RTN","IBCRHBC3",17,0)
 U IO(0) W !!,"Loading ",IBFILE," into ^XTMP "
"RTN","IBCRHBC3",18,0)
 ;
"RTN","IBCRHBC3",19,0)
 S IBI=0 F  S IBI=IBI+1 U IO R IBFLINE:5 Q:$$ENDF  D PARSE,STORE I '(IBI#100) U IO(0) W "."
"RTN","IBCRHBC3",20,0)
 ;
"RTN","IBCRHBC3",21,0)
 D CLOSE^%ZISH("CMAC UPLOAD")
"RTN","IBCRHBC3",22,0)
 ;
"RTN","IBCRHBC3",23,0)
 S IBDONE=(IBI-1)_U_IBXRF
"RTN","IBCRHBC3",24,0)
 ;
"RTN","IBCRHBC3",25,0)
CMACQ Q IBDONE
"RTN","IBCRHBC3",26,0)
 ;
"RTN","IBCRHBC3",27,0)
ENDF() N IBX S IBX=1 I $T,IBFLINE'="" S IBX=0
"RTN","IBCRHBC3",28,0)
 I $$STATUS^%ZISH S IBX=1
"RTN","IBCRHBC3",29,0)
 I 'IBX,'$$LNFORM(IBFLINE) D
"RTN","IBCRHBC3",30,0)
 . U IO(0)
"RTN","IBCRHBC3",31,0)
 . W !!,"**** Error while reading file: line not expected format (98 numeric characters):"
"RTN","IBCRHBC3",32,0)
 . W !!,"Line Length=",$L(IBFLINE)," characters" W:IBFLINE="" ?40,"Line read is null"
"RTN","IBCRHBC3",33,0)
 . W !,"LINE='",IBFLINE,"'",!!,"Upload Aborted!"
"RTN","IBCRHBC3",34,0)
 . S IBX=1 H 7 U IO
"RTN","IBCRHBC3",35,0)
 I IBI=1,IBFLINE="" U IO(0) W !!,"First line of file has no data, can not continue!" S IBX=1 H 7 U IO
"RTN","IBCRHBC3",36,0)
 Q IBX
"RTN","IBCRHBC3",37,0)
 ;
"RTN","IBCRHBC3",38,0)
LNFORM(LINE) ; check an individual line of the file for proper format (length=98 characters)
"RTN","IBCRHBC3",39,0)
 N IBX S IBX=0,LINE=$G(LINE) I (LINE?98N)!(LINE?3N5AN90N) S IBX=1
"RTN","IBCRHBC3",40,0)
 Q IBX
"RTN","IBCRHBC3",41,0)
 ;
"RTN","IBCRHBC3",42,0)
PARSE ; process a single line from a CMAC file: parse out into individual fields and store the line in XTMP
"RTN","IBCRHBC3",43,0)
 ;
"RTN","IBCRHBC3",44,0)
 S IBLOC=$E(IBFLINE,1,3) ; locality
"RTN","IBCRHBC3",45,0)
 S IBCPT=$E(IBFLINE,4,8) ; CPT procedure
"RTN","IBCRHBC3",46,0)
 S IBNFP=$E(IBFLINE,9,16) ;   category 2 Non-Facility Physician charge
"RTN","IBCRHBC3",47,0)
 S IBFP=$E(IBFLINE,17,24) ;   category 1 Facility Physician charge
"RTN","IBCRHBC3",48,0)
 S IBNFNP=$E(IBFLINE,25,32) ; category 4 Non-Facility Non-Physician charge
"RTN","IBCRHBC3",49,0)
 S IBFNP=$E(IBFLINE,33,40) ;  category 3 Facility Non-Physician charge
"RTN","IBCRHBC3",50,0)
 S IBEFDT=$E(IBFLINE,41,48) ; effective date
"RTN","IBCRHBC3",51,0)
 S IBTRDT=$E(IBFLINE,57,64) ; termination date
"RTN","IBCRHBC3",52,0)
 S IBPPC=$E(IBFLINE,65,72) ;  Physician professional component
"RTN","IBCRHBC3",53,0)
 S IBPTC=$E(IBFLINE,73,80) ;  Physician technical component
"RTN","IBCRHBC3",54,0)
 S IBNPPC=$E(IBFLINE,81,88) ; Non-Physician professional component
"RTN","IBCRHBC3",55,0)
 S IBNPTC=$E(IBFLINE,89,96) ; Non-Physician technical component
"RTN","IBCRHBC3",56,0)
 Q
"RTN","IBCRHBC3",57,0)
 ;
"RTN","IBCRHBC3",58,0)
STORE ;
"RTN","IBCRHBC3",59,0)
 S IBXRF1=IBXRF_"  "_IBLOC
"RTN","IBCRHBC3",60,0)
 ;
"RTN","IBCRHBC3",61,0)
 S IBMOD="",IBEFDT=$$DATE(IBEFDT),IBINACT="" I IBTRDT'=99999999,+IBTRDT S IBINACT=$$DATE(IBTRDT)
"RTN","IBCRHBC3",62,0)
 ;
"RTN","IBCRHBC3",63,0)
 I +IBFP S IBCHG=$$CGF(IBFP),IBMOD="" S IBXRF2="FAC/PHYS CAT 1" D SET
"RTN","IBCRHBC3",64,0)
 I +IBFNP S IBCHG=$$CGF(IBFNP),IBMOD="" S IBXRF2="FAC/NONPHYS CAT 3" D SET
"RTN","IBCRHBC3",65,0)
 ;
"RTN","IBCRHBC3",66,0)
 I +IBNFP S IBCHG=$$CGF(IBNFP),IBMOD="" S IBXRF2="NONFAC/PHYS CAT 2" D SET
"RTN","IBCRHBC3",67,0)
 I +IBNFNP S IBCHG=$$CGF(IBNFNP),IBMOD="" S IBXRF2="NONFAC/NONPHYS CAT 4" D SET
"RTN","IBCRHBC3",68,0)
 ;
"RTN","IBCRHBC3",69,0)
 I +IBMODP,+IBPPC S IBCHG=$$CGF(IBPPC),IBMOD=IBMODP S IBXRF2="FAC/PHYS PC" D SET S IBXRF2="NON"_IBXRF2 D SET
"RTN","IBCRHBC3",70,0)
 I +IBMODT,+IBPTC S IBCHG=$$CGF(IBPTC),IBMOD=IBMODT S IBXRF2="FAC/PHYS TC" D SET S IBXRF2="NON"_IBXRF2 D SET
"RTN","IBCRHBC3",71,0)
 ;
"RTN","IBCRHBC3",72,0)
 I +IBMODP,+IBNPPC S IBCHG=$$CGF(IBNPPC),IBMOD=IBMODP S IBXRF2="FAC/NONPHYS PC" D SET S IBXRF2="NON"_IBXRF2 D SET
"RTN","IBCRHBC3",73,0)
 I +IBMODT,+IBNPTC S IBCHG=$$CGF(IBNPTC),IBMOD=IBMODT S IBXRF2="FAC/NONPHYS TC" D SET S IBXRF2="NON"_IBXRF2 D SET
"RTN","IBCRHBC3",74,0)
 ;
"RTN","IBCRHBC3",75,0)
 Q
"RTN","IBCRHBC3",76,0)
 ;
"RTN","IBCRHBC3",77,0)
CGF(AMT) ; return charge string from file line in dollar format
"RTN","IBCRHBC3",78,0)
 Q +($E(AMT,1,6)_"."_$E(AMT,7,8))
"RTN","IBCRHBC3",79,0)
 ;
"RTN","IBCRHBC3",80,0)
SET ;
"RTN","IBCRHBC3",81,0)
 N IBX S IBX=$G(^XTMP(IBXRF1,0)) I IBX="" D SETHDR
"RTN","IBCRHBC3",82,0)
 S $P(^XTMP(IBXRF1,0),U,4)=+$P(IBX,U,4)+1
"RTN","IBCRHBC3",83,0)
 S $P(^XTMP(IBXRF1,IBXRF2),U,1)=+$G(^XTMP(IBXRF1,IBXRF2))+1
"RTN","IBCRHBC3",84,0)
 S ^XTMP(IBXRF1,IBXRF2,IBI)=IBCPT_U_IBEFDT_U_IBINACT_U_+IBCHG_U_IBMOD
"RTN","IBCRHBC3",85,0)
 Q
"RTN","IBCRHBC3",86,0)
 ;
"RTN","IBCRHBC3",87,0)
SETHDR ;
"RTN","IBCRHBC3",88,0)
 N IBX S IBX="IB upload of Host file "_IBFILE_", on "_$$HTE^XLFDT($H,2)_" by "_$P($G(^VA(200,+$G(DUZ),0)),U,1)
"RTN","IBCRHBC3",89,0)
 S ^XTMP(IBXRF1,0)=$$FMADD^XLFDT(DT,2)_U_DT_U_IBX
"RTN","IBCRHBC3",90,0)
 ;
"RTN","IBCRHBC3",91,0)
 S ^XTMP(IBXRF1,IBXRF2)=0_U_2_U_$G(IBCS)
"RTN","IBCRHBC3",92,0)
 Q
"RTN","IBCRHBC3",93,0)
 ;
"RTN","IBCRHBC3",94,0)
 ;
"RTN","IBCRHBC3",95,0)
DATE(DATE) ; return yymmdd in FM format
"RTN","IBCRHBC3",96,0)
 N IBX S IBX="" I $G(DATE)?8N S IBX=$S($E(DATE,1,2)<20:"2",1:"3")_$E(DATE,3,8)
"RTN","IBCRHBC3",97,0)
 Q IBX
"RTN","IBCRHBC3",98,0)
 ;
"RTN","IBCRHBC3",99,0)
 ;
"RTN","IBCRHBC3",100,0)
LNDT(LINE) ; return the date of an individual line, in FM format
"RTN","IBCRHBC3",101,0)
 N IBX S IBX=$E($G(LINE),41,48) S IBX=$$DATE(IBX)
"RTN","IBCRHBC3",102,0)
 Q IBX
"RTN","IBCRHBC3",103,0)
 ;
"RTN","IBCRHBC3",104,0)
 ;
"RTN","IBCRHBC3",105,0)
 ;
"RTN","IBCRHBC3",106,0)
SETUP(IBFILE,IBNAME) ; set up Charge Sets, Billing Regions, Rate Schedule links for new charges
"RTN","IBCRHBC3",107,0)
 ; if new region entered, asks user for divisions
"RTN","IBCRHBC3",108,0)
 N IBLOC,IBXRF1,IBXRF2,IBEVENT,IBCT,IBBS,IBRV,IBRG,IBCS
"RTN","IBCRHBC3",109,0)
 ;
"RTN","IBCRHBC3",110,0)
 S IBLOC=$P($P($G(IBFILE),"CMAC",2),".",1),IBXRF1=$G(IBNAME)_IBFILE_"  "_IBLOC
"RTN","IBCRHBC3",111,0)
 S IBEVENT="PROCEDURE",IBCT="PROF",IBBS="OUTPATIENT VISIT",IBRV=510
"RTN","IBCRHBC3",112,0)
 ;
"RTN","IBCRHBC3",113,0)
 ;
"RTN","IBCRHBC3",114,0)
 ; Find/Create Billing Region
"RTN","IBCRHBC3",115,0)
 S IBRG=$$RG^IBCRHU2("CMAC "_IBLOC,,IBLOC)
"RTN","IBCRHBC3",116,0)
 ;
"RTN","IBCRHBC3",117,0)
 ;
"RTN","IBCRHBC3",118,0)
 ; Category 1 Facility Physician Charges
"RTN","IBCRHBC3",119,0)
 S IBCS=$$CS^IBCRHU2("CMAC "_IBLOC_" FAC/PHYS","CMAC",IBEVENT,$P(IBRG,U,2),IBCT,IBRV,IBBS)
"RTN","IBCRHBC3",120,0)
 D RSBR^IBCRHU2(IBCS,1,$G(IBGLBEFF))
"RTN","IBCRHBC3",121,0)
 F IBXRF2="FAC/PHYS CAT 1","FAC/PHYS PC","FAC/PHYS TC" D SETHDR
"RTN","IBCRHBC3",122,0)
 ;
"RTN","IBCRHBC3",123,0)
 ;
"RTN","IBCRHBC3",124,0)
 ; Category 3 Facility Non-Physician Charges
"RTN","IBCRHBC3",125,0)
 S IBCS=$$CS^IBCRHU2("CMAC "_IBLOC_" FAC/NONPHYS","CMAC",IBEVENT,$P(IBRG,U,2),IBCT,IBRV,IBBS)
"RTN","IBCRHBC3",126,0)
 D RSBR^IBCRHU2(IBCS,0,$G(IBGLBEFF))
"RTN","IBCRHBC3",127,0)
 F IBXRF2="FAC/NONPHYS CAT 3","FAC/NONPHYS PC","FAC/NONPHYS TC" D SETHDR
"RTN","IBCRHBC3",128,0)
 ;
"RTN","IBCRHBC3",129,0)
 ;
"RTN","IBCRHBC3",130,0)
 ; Category 2 Non-Facility Physician Charges
"RTN","IBCRHBC3",131,0)
 S IBCS=$$CS^IBCRHU2("CMAC "_IBLOC_" NONFAC/PHYS","CMAC",IBEVENT,$P(IBRG,U,2),IBCT,IBRV,IBBS)
"RTN","IBCRHBC3",132,0)
 D RSBR^IBCRHU2(IBCS,0,$G(IBGLBEFF))
"RTN","IBCRHBC3",133,0)
 F IBXRF2="NONFAC/PHYS CAT 2","NONFAC/PHYS PC","NONFAC/PHYS TC" D SETHDR
"RTN","IBCRHBC3",134,0)
 ;
"RTN","IBCRHBC3",135,0)
 ;
"RTN","IBCRHBC3",136,0)
 ; Category 4 Non-Facility Non-Physician Charges
"RTN","IBCRHBC3",137,0)
 S IBCS=$$CS^IBCRHU2("CMAC "_IBLOC_" NONFAC/NONPHYS","CMAC",IBEVENT,$P(IBRG,U,2),IBCT,IBRV,IBBS)
"RTN","IBCRHBC3",138,0)
 D RSBR^IBCRHU2(IBCS,0,$G(IBGLBEFF))
"RTN","IBCRHBC3",139,0)
 F IBXRF2="NONFAC/NONPHYS CAT 4","NONFAC/NONPHYS PC","NONFAC/NONPHYS TC" D SETHDR
"RTN","IBCRHBC3",140,0)
 ;
"RTN","IBCRHBC3",141,0)
 ;
"RTN","IBCRHBC3",142,0)
 ; get divisions added to new Billing Region
"RTN","IBCRHBC3",143,0)
 I +$P(IBRG,U,3) D GETDIV^IBCRHU2(+IBRG)
"RTN","IBCRHBC3",144,0)
 Q
"VER")
8.0^22.0
"BLD",5765,6)
^292
**END**
**END**
