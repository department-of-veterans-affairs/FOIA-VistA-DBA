Released PSJ*5*117 SEQ #110
Extracted from mail message
**KIDS**:PSJ*5.0*117^

**INSTALL NAME**
PSJ*5.0*117
"BLD",4272,0)
PSJ*5.0*117^INPATIENT MEDICATIONS^0^3031002^y
"BLD",4272,1,0)
^^4^4^3031002^^
"BLD",4272,1,1,0)
A site reported a problem with the DOSAGE field (#120) in the UNIT DOSE
"BLD",4272,1,2,0)
multiple (#62) of the PHARMACY PATIENT file (#55) not being deleted when
"BLD",4272,1,3,0)
an orderable item is changed. This patch corrects this problem by 
"BLD",4272,1,4,0)
removing the data when the orderable item is changed.  NOIS UNY-0603-10652
"BLD",4272,4,0)
^9.64PA^^
"BLD",4272,"ABPKG")
n
"BLD",4272,"KRN",0)
^9.67PA^8989.52^19
"BLD",4272,"KRN",.4,0)
.4
"BLD",4272,"KRN",.401,0)
.401
"BLD",4272,"KRN",.402,0)
.402
"BLD",4272,"KRN",.403,0)
.403
"BLD",4272,"KRN",.5,0)
.5
"BLD",4272,"KRN",.84,0)
.84
"BLD",4272,"KRN",3.6,0)
3.6
"BLD",4272,"KRN",3.8,0)
3.8
"BLD",4272,"KRN",9.2,0)
9.2
"BLD",4272,"KRN",9.8,0)
9.8
"BLD",4272,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4272,"KRN",9.8,"NM",1,0)
PSGOETO^^0^B30014809
"BLD",4272,"KRN",9.8,"NM","B","PSGOETO",1)

"BLD",4272,"KRN",19,0)
19
"BLD",4272,"KRN",19.1,0)
19.1
"BLD",4272,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4272,"KRN",101,0)
101
"BLD",4272,"KRN",409.61,0)
409.61
"BLD",4272,"KRN",771,0)
771
"BLD",4272,"KRN",870,0)
870
"BLD",4272,"KRN",8989.51,0)
8989.51
"BLD",4272,"KRN",8989.52,0)
8989.52
"BLD",4272,"KRN",8994,0)
8994
"BLD",4272,"KRN","B",.4,.4)

"BLD",4272,"KRN","B",.401,.401)

"BLD",4272,"KRN","B",.402,.402)

"BLD",4272,"KRN","B",.403,.403)

"BLD",4272,"KRN","B",.5,.5)

"BLD",4272,"KRN","B",.84,.84)

"BLD",4272,"KRN","B",3.6,3.6)

"BLD",4272,"KRN","B",3.8,3.8)

"BLD",4272,"KRN","B",9.2,9.2)

"BLD",4272,"KRN","B",9.8,9.8)

"BLD",4272,"KRN","B",19,19)

"BLD",4272,"KRN","B",19.1,19.1)

"BLD",4272,"KRN","B",101,101)

"BLD",4272,"KRN","B",409.61,409.61)

"BLD",4272,"KRN","B",771,771)

"BLD",4272,"KRN","B",870,870)

"BLD",4272,"KRN","B",8989.51,8989.51)

"BLD",4272,"KRN","B",8989.52,8989.52)

"BLD",4272,"KRN","B",8994,8994)

"BLD",4272,"QUES",0)
^9.62^^
"BLD",4272,"REQB",0)
^9.611^1^1
"BLD",4272,"REQB",1,0)
PSJ*5.0*90^2
"BLD",4272,"REQB","B","PSJ*5.0*90",1)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
117^3031002^10000000006
"PKG",197,22,1,"PAH",1,1,0)
^^4^4^3031002
"PKG",197,22,1,"PAH",1,1,1,0)
A site reported a problem with the DOSAGE field (#120) in the UNIT DOSE
"PKG",197,22,1,"PAH",1,1,2,0)
multiple (#62) of the PHARMACY PATIENT file (#55) not being deleted when
"PKG",197,22,1,"PAH",1,1,3,0)
an orderable item is changed. This patch corrects this problem by 
"PKG",197,22,1,"PAH",1,1,4,0)
removing the data when the orderable item is changed.  NOIS UNY-0603-10652
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSGOETO")
0^1^B30014809
"RTN","PSGOETO",1,0)
PSGOETO ;BIR/CML3-TRANSCRIBE ORDERS ;25 Feb 99 / 1:17 PM
"RTN","PSGOETO",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,13,25,31,33,50,68,58,85,105,90,117**;16 DEC 97
"RTN","PSGOETO",3,0)
 ;
"RTN","PSGOETO",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSGOETO",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOETO",6,0)
 ; Reference to ^PS(59.7 is supported by DBIA #2181.
"RTN","PSGOETO",7,0)
 ; Reference to EN^VALM is supported by DBIA #10118.
"RTN","PSGOETO",8,0)
 ; Reference to SPSPA^PSJXRFS is supported by DBIA #4114.
"RTN","PSGOETO",9,0)
 ;
"RTN","PSGOETO",10,0)
 W:'$D(PSGOEE)&'$D(PSGOES) !!,"...transcribing this ",$S($D(PSGOES):"",'PSGOEAV:"non-verified ",1:"active "),"order..." S PSGOETOF=1 S:PSGSM="" PSGSM=0
"RTN","PSGOETO",11,0)
 ;I '$D(PSJOERR),PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSGOETO",12,0)
 I PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSGOETO",13,0)
 K ND4,DA D ENGNN:'PSGOEAV,ENGNA:PSGOEAV S PSGDT=$$DATE^PSJUTL2() I $S($D(ORACTION):0,$G(PSGOEE)="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:$G(PSGOEE)'="E") D ENWALL^PSGNE3(PSGNESD,PSGNEFD,PSGP)
"RTN","PSGOETO",14,0)
 I $D(^PS(51.2,+PSGMR,0)),$P(^(0),U,3)]"" S PSGMRN=$P(^(0),U,3)
"RTN","PSGOETO",15,0)
 I PSGS0XT="D",'PSGS0Y S PSGS0Y=$E(PSGNESD_"00011",9,12)
"RTN","PSGOETO",16,0)
 ;S ND=DA_U_PSGPR_U_PSGMR_U_$E("UI",$D(PSGOEOS)+1)_U_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",$D(PSGOEOS):PSGOEOS,1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSGOETO",17,0)
 S ND=DA_U_PSGPR_U_PSGMR_"^U^"_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSGOETO",18,0)
 S:$D(PSGOEE) $P(ND,U,24,25)=PSGOEE_U_PSGOORD S:'PSGOEAV $P(ND,U,18)=DA S ND2=PSGSCH_U_$S(+PSGNESD=PSGNESD:+PSGNESD,1:"")_"^^"_+PSGNEFD_U_PSGS0Y_U_PSGS0XT_"^^^^"_+PSJPWD
"RTN","PSGOETO",19,0)
 I PSGOEAV S F=^PS(55,PSGP,0) I $P(F,"^",7)="" S $P(F,"^",7)=$P($P(ND,"^",16),"."),$P(F,"^",8)="A",^(0)=F
"RTN","PSGOETO",20,0)
 S $P(ND4,U,7)=DUZ I PSGOEAV,PSJSYSU D
"RTN","PSGOETO",21,0)
 .S $P(ND4,U,PSJSYSU,PSJSYSU+1)=DUZ_U_PSGDT,$P(ND4,U,+PSJSYSU=1+9)=1,$P(ND4,U,+PSJSYSU=3+9)=0
"RTN","PSGOETO",22,0)
 .S $P(ND4,U,9,10)=+$P(ND4,U,9)_U_+$P(ND4,U,10)
"RTN","PSGOETO",23,0)
 .I '$P(ND4,U,9) S ^PS(55,"APV",PSGP,DA)=""
"RTN","PSGOETO",24,0)
 .I '$P(ND4,U,10) S ^PS(55,"NPV",PSGP,DA)=""
"RTN","PSGOETO",25,0)
 .I $P(ND4,U,9) K ^PS(55,"APV",PSGP,DA)
"RTN","PSGOETO",26,0)
 .I $P(ND4,U,10) K ^PS(55,"NPV",PSGP,DA)
"RTN","PSGOETO",27,0)
 ;S F="^PS("_$S(PSGOEAV:"55,"_PSGP_",5",1:53.1)_","_DA_",",@(F_"0)")=ND,^(.2)=PSGPDRG_U_PSGDO,$P(^(.2),U,5,6)=$P($G(PSJDOSE("DO")),U,1,2),^(2)=$S(PSGOEAV:ND2,1:$P(ND2,"^",1,6)),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSGOETO",28,0)
 S F="^PS("_$S(PSGOEAV:"55,"_PSGP_",5",1:53.1)_","_DA_",",@(F_"0)")=ND
"RTN","PSGOETO",29,0)
 ;naked reference below refers to full reference inside indirection @(F_".2)") for either file 53.1 or 55
"RTN","PSGOETO",30,0)
 S @(F_".2)")=PSGPDRG_U_PSGDO_U_PSJNOO S:$G(PSJDOSE("DO"))]"" $P(^(.2),U,5,6)=$P(PSJDOSE("DO"),U,1,2)
"RTN","PSGOETO",31,0)
 I '$D(PSJDOSE("DO")),$D(PSGORD),PSGPDRG=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U) S $P(@(F_".2)"),U,5,6)=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U,5,6)
"RTN","PSGOETO",32,0)
 ;naked reference below refers to full reference inside indirection @(F_"2)") for either file 53.1 or 55
"RTN","PSGOETO",33,0)
 S @(F_"2)")=$S(PSGOEAV:ND2,1:$P(ND2,"^",1,6)),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSGOETO",34,0)
 S (C,X)=0 F  S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  S D=$G(^(X,0)) I D,$S('$P(D,U,3):1,1:$P(D,U,3)>DT) S C=C+1,@(F_"1,"_C_",0)")=$P(D,U,1,2),@(F_"1,""B"","_+D_","_C_")")=""
"RTN","PSGOETO",35,0)
 S:C @(F_"1,0)")=U_$S(PSGOEAV:55.07,1:53.11)_"P^"_C_U_C
"RTN","PSGOETO",36,0)
 S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"3,"_C_",0)")=X
"RTN","PSGOETO",37,0)
 S:C @(F_"3,0)")=U_$S(PSGOEAV:55.08,1:53.12)_U_C_U_C
"RTN","PSGOETO",38,0)
 ;S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,4,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"12,"_C_",0)")=X
"RTN","PSGOETO",39,0)
 ;S:C @(F_"12,0)")=U_$S(PSGOEAV:55.0612,1:53.1012)_U_C_U_C
"RTN","PSGOETO",40,0)
 I $P(ND,U,24)="R" S %X="^PS(55,"_PSGP_",5,"_+PSGORD_",12,",%Y=F_"12," D %XY^%RCR
"RTN","PSGOETO",41,0)
 W "." D CRN:'PSGOEAV,CRA:PSGOEAV
"RTN","PSGOETO",42,0)
 ; don't send message to CPRS if from Order Set and autoverify turned off
"RTN","PSGOETO",43,0)
 S PSGORD=DA_$S(PSGOEAV:"U",1:"P") D:('$D(PSGOES))!(($D(PSGOES)&(PSGOEAV))) ORSET^PSGOETO1
"RTN","PSGOETO",44,0)
 I $D(PSGOES),'$D(PSGOESON) N PSGOESON S PSGOESON=PSGORD D DISACTIO^PSJOE(DFN,PSGORD,0) D:PSGORD["U"&(PSGOESON=PSGORD)&($P(@(PSGOEEWF_"0)"),"^",9)'="D") EN^PSGPEN(PSGORD) G OUT
"RTN","PSGOETO",45,0)
 ;D DONE S PSGCANFL="" I '$D(PSGOEE),$P(PSJSYSP0,U,12)<2 S PSJLM=1,PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),EN^VALM("PSJ LM ACCEPT") I PSGCANFL=1 G OUT
"RTN","PSGOETO",46,0)
 D DONE S PSGCANFL="" I '$D(PSGOEE) S PSJLM=1,PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),EN^VALM("PSJ LM ACCEPT") I PSGCANFL=1 G OUT
"RTN","PSGOETO",47,0)
 I $D(PSJSYSO) S PSGPOSA="W",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOETO",48,0)
 S DA=+PSGORD,X=$P(PSGORD,DA,2) I PSJSYSL,$S(PSGOEAV:1,1:PSJSYSL<3),$S("AOU"[X:'$D(^PS(55,PSGP,5,+PSGORD,7)),1:'$D(^PS(53.1,+PSGORD,7))) D
"RTN","PSGOETO",49,0)
 .; naked ref below is from line above, ^PS(53.1,+PSGORD,7)
"RTN","PSGOETO",50,0)
 .S $P(^(7),U,1,2)=PSGDT_"^N"_$G(PSGOEE),PSGUOW=DUZ,PSGTOL=2,PSGTOO=$S("AOU"[X:1,1:2) D ENL^PSGVDS
"RTN","PSGOETO",51,0)
OUT ;
"RTN","PSGOETO",52,0)
 K PSGOETOF
"RTN","PSGOETO",53,0)
DONE ;
"RTN","PSGOETO",54,0)
 I PSGOEAV L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSGOETO",55,0)
 I 'PSGOEAV L -^PS(53.1,+PSGORD)
"RTN","PSGOETO",56,0)
 K C,D,ND,ND2,ND4,PSGDO,PSGDRG,PSGDRGN,PSGFOK,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGPDRG,PSGPDRGN,PSGSI,PSGSTN,PSJDOSE
"RTN","PSGOETO",57,0)
 Q
"RTN","PSGOETO",58,0)
CRA ;
"RTN","PSGOETO",59,0)
 S:PSGPDRG ^PS(55,PSGP,5,"C",PSGPDRG,DA)="" S (^PS(55,"AUE",PSGP,DA),^PS(55,PSGP,5,"AU",PSGST,+PSGNEFD,DA),^PS(55,PSGP,5,"AUS",+PSGNEFD,DA))="",^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)="",^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOETO",60,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+PSGNESD,X(2)=+PSGNEFD,DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOETO",61,0)
 K PSGALO,PSGALR S DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+$S('$D(PSGOEE):22500,PSGOEE="E":22600,1:22700) D ^PSGAL5 Q
"RTN","PSGOETO",62,0)
CRN ;
"RTN","PSGOETO",63,0)
 S (^PS(53.1,"AC",PSGP,DA),^PS(53.1,"AS","N",PSGP,DA),^PS(53.1,"B",DA,DA),^PS(53.1,"C",PSGP,DA))="" S:PSGPDRG (^PS(53.1,"AOD",PSGP,PSGPDRG,DA),^PS(53.1,"D",PSGPDRG,DA))="" Q
"RTN","PSGOETO",64,0)
ENGNA ;
"RTN","PSGOETO",65,0)
 F  L +^PS(55,PSGP,5,0):1 S:'$D(^PS(55,PSGP,0)) ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="" S ND=$S($D(^PS(55,PSGP,5,0)):^(0),1:"^55.06IA") Q
"RTN","PSGOETO",66,0)
 F DA=$P(ND,U,3)+1:1 W "." I '$D(^PS(55,PSGP,5,DA)),'$D(^PS(55,PSGP,5,"B",DA)) L +^PS(55,PSGP,5,DA):1 I  S ^PS(55,PSGP,5,DA,0)=DA,^PS(55,PSGP,5,"B",DA,DA)="",$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^PS(55,PSGP,5,0)=ND Q
"RTN","PSGOETO",67,0)
 L -^PS(55,PSGP,5,0) Q
"RTN","PSGOETO",68,0)
ENGNN ;
"RTN","PSGOETO",69,0)
 N ND F  L +^PS(59.7,1,25):1 I  S DA=+$G(^PS(59.7,1,25)) Q
"RTN","PSGOETO",70,0)
 F DA=DA+1:1 I '$D(^PS(53.1,DA)),'$D(^PS(53.1,"B",DA)) L +^PS(53.1,DA):1 I  S ^PS(59.7,1,25)=DA,^PS(53.1,DA,0)=DA,^PS(53.1,"B",DA,DA)="" Q
"RTN","PSGOETO",71,0)
 F  L +^PS(53.1,0):1 I  S ND=$G(^PS(53.1,0)),$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^(0)=ND Q
"RTN","PSGOETO",72,0)
 L -^PS(59.7,1,25),-^PS(53.1,0)
"RTN","PSGOETO",73,0)
 Q
"VER")
8.0^22.0
**END**
**END**
