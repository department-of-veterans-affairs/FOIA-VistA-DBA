Released IB*2*233 SEQ #250
Extracted from mail message
**KIDS**:IB*2.0*233^

**INSTALL NAME**
IB*2.0*233
"BLD",4777,0)
IB*2.0*233^INTEGRATED BILLING^0^3040728^y
"BLD",4777,1,0)
^^2^2^3030926^^^^
"BLD",4777,1,1,0)
This patch will implement CBOC data extraction logic for
"BLD",4777,1,2,0)
the Boston Allocation Resource Center.
"BLD",4777,4,0)
^9.64PA^399^1
"BLD",4777,4,399,0)
399
"BLD",4777,4,399,2,0)
^9.641^399^1
"BLD",4777,4,399,2,399,0)
BILL/CLAIMS  (File-top level)
"BLD",4777,4,399,2,399,1,0)
^9.6411^.14^1
"BLD",4777,4,399,2,399,1,.14,0)
STATUS DATE
"BLD",4777,4,399,222)
y^n^p^^^^n^^n
"BLD",4777,4,399,224)

"BLD",4777,4,"APDD",399,399)

"BLD",4777,4,"APDD",399,399,.14)

"BLD",4777,4,"B",399,399)

"BLD",4777,"ABPKG")
n
"BLD",4777,"INIT")

"BLD",4777,"KRN",0)
^9.67PA^8989.52^19
"BLD",4777,"KRN",.4,0)
.4
"BLD",4777,"KRN",.401,0)
.401
"BLD",4777,"KRN",.402,0)
.402
"BLD",4777,"KRN",.403,0)
.403
"BLD",4777,"KRN",.5,0)
.5
"BLD",4777,"KRN",.84,0)
.84
"BLD",4777,"KRN",3.6,0)
3.6
"BLD",4777,"KRN",3.8,0)
3.8
"BLD",4777,"KRN",9.2,0)
9.2
"BLD",4777,"KRN",9.8,0)
9.8
"BLD",4777,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4777,"KRN",9.8,"NM",1,0)
IBJVDEQ^^0^B10466084
"BLD",4777,"KRN",9.8,"NM","B","IBJVDEQ",1)

"BLD",4777,"KRN",19,0)
19
"BLD",4777,"KRN",19,"NM",0)
^9.68A^^0
"BLD",4777,"KRN",19.1,0)
19.1
"BLD",4777,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4777,"KRN",101,0)
101
"BLD",4777,"KRN",101,"NM",0)
^9.68A^^0
"BLD",4777,"KRN",409.61,0)
409.61
"BLD",4777,"KRN",771,0)
771
"BLD",4777,"KRN",771,"NM",0)
^9.68A^^0
"BLD",4777,"KRN",870,0)
870
"BLD",4777,"KRN",870,"NM",0)
^9.68A^^0
"BLD",4777,"KRN",8989.51,0)
8989.51
"BLD",4777,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",4777,"KRN",8989.52,0)
8989.52
"BLD",4777,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",4777,"KRN",8994,0)
8994
"BLD",4777,"KRN","B",.4,.4)

"BLD",4777,"KRN","B",.401,.401)

"BLD",4777,"KRN","B",.402,.402)

"BLD",4777,"KRN","B",.403,.403)

"BLD",4777,"KRN","B",.5,.5)

"BLD",4777,"KRN","B",.84,.84)

"BLD",4777,"KRN","B",3.6,3.6)

"BLD",4777,"KRN","B",3.8,3.8)

"BLD",4777,"KRN","B",9.2,9.2)

"BLD",4777,"KRN","B",9.8,9.8)

"BLD",4777,"KRN","B",19,19)

"BLD",4777,"KRN","B",19.1,19.1)

"BLD",4777,"KRN","B",101,101)

"BLD",4777,"KRN","B",409.61,409.61)

"BLD",4777,"KRN","B",771,771)

"BLD",4777,"KRN","B",870,870)

"BLD",4777,"KRN","B",8989.51,8989.51)

"BLD",4777,"KRN","B",8989.52,8989.52)

"BLD",4777,"KRN","B",8994,8994)

"BLD",4777,"QUES",0)
^9.62^^0
"BLD",4777,"REQB",0)
^9.611^1^1
"BLD",4777,"REQB",1,0)
PRCA*4.5*201^0
"BLD",4777,"REQB","B","PRCA*4.5*201",1)

"FIA",399)
BILL/CLAIMS
"FIA",399,0)
^DGCR(399,
"FIA",399,0,0)
399I
"FIA",399,0,1)
y^n^p^^^^n^^n
"FIA",399,0,10)

"FIA",399,0,11)

"FIA",399,0,"RLRO")

"FIA",399,0,"VR")
2.0^IB
"FIA",399,399)
1
"FIA",399,399,.14)

"MBREQ")
0
"PKG",248,-1)
1^1
"PKG",248,0)
INTEGRATED BILLING^IB^APP
"PKG",248,20,0)
^9.402P^1^1
"PKG",248,20,1,0)
2^^IBAXDR
"PKG",248,20,1,1)

"PKG",248,20,"B",2,1)

"PKG",248,22,0)
^9.49I^1^1
"PKG",248,22,1,0)
2.0^2940321^2940616
"PKG",248,22,1,"PAH",1,0)
233^3040728
"PKG",248,22,1,"PAH",1,1,0)
^^2^2^3040728
"PKG",248,22,1,"PAH",1,1,1,0)
This patch will implement CBOC data extraction logic for
"PKG",248,22,1,"PAH",1,1,2,0)
the Boston Allocation Resource Center.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IBJVDEQ")
0^1^B10466084
"RTN","IBJVDEQ",1,0)
IBJVDEQ ;DAOU/ALA-CBOC Data Extract Queue Trigger ;02-JUL-03
"RTN","IBJVDEQ",2,0)
 ;;2.0;INTEGRATED BILLING;**233**;21-MAR-94
"RTN","IBJVDEQ",3,0)
 ;
"RTN","IBJVDEQ",4,0)
 ;**Program Description**
"RTN","IBJVDEQ",5,0)
 ;  This program will log a record who meets the
"RTN","IBJVDEQ",6,0)
 ;  selection criteria for the VISTA Data Extract
"RTN","IBJVDEQ",7,0)
 ;
"RTN","IBJVDEQ",8,0)
BC ;  Triggers from the Bill/Claims File (#399)
"RTN","IBJVDEQ",9,0)
 NEW DFN
"RTN","IBJVDEQ",10,0)
 ;
"RTN","IBJVDEQ",11,0)
 ; Filter (Auth DT, Stat DT, or DT are blank Q)  
"RTN","IBJVDEQ",12,0)
 S RDATES=$G(^DGCR(399,D0,"S"))
"RTN","IBJVDEQ",13,0)
 I $P(RDATES,U,10)=""&($P(RDATES,U,12)="")&($P(RDATES,U,17)="") Q
"RTN","IBJVDEQ",14,0)
 ;
"RTN","IBJVDEQ",15,0)
 ;  Get the bill number
"RTN","IBJVDEQ",16,0)
 S RCBILL=$P($G(^DGCR(399,D0,0)),U,1)
"RTN","IBJVDEQ",17,0)
 ;  Use PRCA(430,"D",bill number to get 430 IEN
"RTN","IBJVDEQ",18,0)
 S RCXVBLN=$O(^PRCA(430,"D",RCBILL,""))
"RTN","IBJVDEQ",19,0)
 I RCXVBLN="" Q
"RTN","IBJVDEQ",20,0)
 ;
"RTN","IBJVDEQ",21,0)
 S DFN=$P(^DGCR(399,D0,0),U,2)
"RTN","IBJVDEQ",22,0)
 ;  Retrieve all for every new bill authorized in IB
"RTN","IBJVDEQ",23,0)
 D FIL("D")
"RTN","IBJVDEQ",24,0)
 ;
"RTN","IBJVDEQ",25,0)
 K RCBILL,RCXVBLN,RDATES
"RTN","IBJVDEQ",26,0)
 Q
"RTN","IBJVDEQ",27,0)
 ;
"RTN","IBJVDEQ",28,0)
FIL(RCXVBTY) ;  File the record into the AR Data Queue File (#348.4)
"RTN","IBJVDEQ",29,0)
 ;
"RTN","IBJVDEQ",30,0)
 ;  If a test system has 'turned off' extract, quit
"RTN","IBJVDEQ",31,0)
 I '$$GET1^DIQ(342,"1,",20.04,"I") Q
"RTN","IBJVDEQ",32,0)
 ;
"RTN","IBJVDEQ",33,0)
 ;  Input Parameter
"RTN","IBJVDEQ",34,0)
 ;    RCXVBTY = Batch Type (H=Historical, D=Daily, C=Current Fiscal Year, A=Active)
"RTN","IBJVDEQ",35,0)
 ;    RCXVBLN = Bill IEN
"RTN","IBJVDEQ",36,0)
 ;
"RTN","IBJVDEQ",37,0)
 NEW FDA,RCXVCURB,RCVXBNM,RCVXBMX
"RTN","IBJVDEQ",38,0)
 ; 
"RTN","IBJVDEQ",39,0)
 ; Where there has been any update/change to the system 
"RTN","IBJVDEQ",40,0)
 ; for a particular bill for the previous days business (T-1). 
"RTN","IBJVDEQ",41,0)
 ;
"RTN","IBJVDEQ",42,0)
 ; Get current batch
"RTN","IBJVDEQ",43,0)
BTC K ^TMP("RCXVA",$J)
"RTN","IBJVDEQ",44,0)
 D FIND^DIC(348.4,"","","P",DT,"","C","I $P(^(0),U,4)=RCXVBTY","","^TMP(""RCXVA"",$J)")
"RTN","IBJVDEQ",45,0)
 S RCXVCURB=$P(^TMP("RCXVA",$J,"DILIST",0),U,1)
"RTN","IBJVDEQ",46,0)
 S RCVXCTY="",RCXVBDT="",RCXQFL=0
"RTN","IBJVDEQ",47,0)
 ;
"RTN","IBJVDEQ",48,0)
 ;  If there is no batch for today, create a new batch
"RTN","IBJVDEQ",49,0)
 I RCXVCURB=0 D NBT G CON:'RCXQFL,BTC
"RTN","IBJVDEQ",50,0)
 ;
"RTN","IBJVDEQ",51,0)
 ; Check to see if batch is full.
"RTN","IBJVDEQ",52,0)
 S RCXVCURB=$P(^TMP("RCXVA",$J,"DILIST",RCXVCURB,0),U,1)
"RTN","IBJVDEQ",53,0)
 I RCXVCURB'=0 D
"RTN","IBJVDEQ",54,0)
 . S RCVXBNM=$P($G(^RCXV(RCXVCURB,0)),U,7) ; Number of record in batch
"RTN","IBJVDEQ",55,0)
 . S RCVXCTY=$P($G(^RCXV(RCXVCURB,0)),U,4) ; Current batch type
"RTN","IBJVDEQ",56,0)
 . S RCXVBDT=$P($G(^RCXV(RCXVCURB,0)),U,2) ; Batch Date
"RTN","IBJVDEQ",57,0)
 . S RCXVBST=$P($G(^RCXV(RCXVCURB,0)),U,3) ; Batch Status
"RTN","IBJVDEQ",58,0)
 S RCVXBMX=$P($G(^RC(342,1,20)),U,5) ; Max. # of record per batch
"RTN","IBJVDEQ",59,0)
 ;  OR if the number of records in batch exceeds the
"RTN","IBJVDEQ",60,0)
 ;  maximum number of records per batch --> create new batch
"RTN","IBJVDEQ",61,0)
 I (RCVXBNM>RCVXBMX)!(RCVXBNM=RCVXBMX)!(RCXVBST="T") D NBT G BTC:RCXQFL
"RTN","IBJVDEQ",62,0)
 ;
"RTN","IBJVDEQ",63,0)
CON ;  Continue with updating the AR Data Queue file
"RTN","IBJVDEQ",64,0)
 S RCXVDA=$S($G(RCXVCURB)'=0:RCXVCURB,1:RCXVDA)
"RTN","IBJVDEQ",65,0)
 ;
"RTN","IBJVDEQ",66,0)
 I $D(^RCXV(RCXVDA,1,RCXVBLN)) Q
"RTN","IBJVDEQ",67,0)
 ;
"RTN","IBJVDEQ",68,0)
 ; File record
"RTN","IBJVDEQ",69,0)
 NEW DIC,DIE,X,DA,DLAYGO,Y,DINUM
"RTN","IBJVDEQ",70,0)
 S DA(1)=RCXVDA,DIC="^RCXV("_DA(1)_",1,",DIE=DIC,(X,DINUM)=RCXVBLN
"RTN","IBJVDEQ",71,0)
 S DLAYGO=348.41,DIC(0)="L",DIC("P")=DLAYGO
"RTN","IBJVDEQ",72,0)
 I '$D(^RCXV(DA(1),1,0)) S ^RCXV(DA(1),1,0)="^348.41^^"
"RTN","IBJVDEQ",73,0)
 D FILE^DICN
"RTN","IBJVDEQ",74,0)
 ;
"RTN","IBJVDEQ",75,0)
 S RCUPD(348.4,RCXVDA_",",.07)=(RCVXBNM+1)
"RTN","IBJVDEQ",76,0)
 S RCUPD(348.41,RCXVBLN_","_RCXVDA_",",.02)=DFN
"RTN","IBJVDEQ",77,0)
 D FILE^DIE("","RCUPD","RCERROR")
"RTN","IBJVDEQ",78,0)
 ;
"RTN","IBJVDEQ",79,0)
 K RCXVDA,RCVXBNM,RCXVBLN,RCXVCURB,RCXVBTY,RCVXBMX,RCVXCTY,RCXVBDT
"RTN","IBJVDEQ",80,0)
 K ^TMP("RCXVA",$J),IENARRAY,RCXVBST,DINUM,ERROR,RCUPD,RCXQFL
"RTN","IBJVDEQ",81,0)
 Q
"RTN","IBJVDEQ",82,0)
 ;
"RTN","IBJVDEQ",83,0)
NBT ;  Create a new batch
"RTN","IBJVDEQ",84,0)
 N $ES,$ET
"RTN","IBJVDEQ",85,0)
 S $ET="D ER^IBJVDEQ"
"RTN","IBJVDEQ",86,0)
 L +^RCXVLK:1 E  S RCXQFL=1 Q
"RTN","IBJVDEQ",87,0)
 S RCXVCURB=$P(^RCXV(0),U,3)+1
"RTN","IBJVDEQ",88,0)
 S RCVXBNM=0
"RTN","IBJVDEQ",89,0)
 S FDA(348.4,"+1,",.01)=RCXVCURB
"RTN","IBJVDEQ",90,0)
 S FDA(348.4,"+1,",.02)=DT
"RTN","IBJVDEQ",91,0)
 S FDA(348.4,"+1,",.03)="P"
"RTN","IBJVDEQ",92,0)
 S FDA(348.4,"+1,",.04)=RCXVBTY
"RTN","IBJVDEQ",93,0)
 S FDA(348.4,"+1,",.07)=RCVXBNM
"RTN","IBJVDEQ",94,0)
 D UPDATE^DIE("","FDA","IENARRAY","ERROR")
"RTN","IBJVDEQ",95,0)
 I '$D(ERROR) S RCXVDA=$G(IENARRAY(1))
"RTN","IBJVDEQ",96,0)
 L -^RCXVLK
"RTN","IBJVDEQ",97,0)
 Q
"RTN","IBJVDEQ",98,0)
 ;
"RTN","IBJVDEQ",99,0)
ER ; Unlock and log error
"RTN","IBJVDEQ",100,0)
 L -^RCXVLK
"RTN","IBJVDEQ",101,0)
 D ^%ZTER
"RTN","IBJVDEQ",102,0)
 D UNWIND^%ZTER
"RTN","IBJVDEQ",103,0)
 Q
"VER")
8.0^22.0
"^DD",399,399,.14,0)
STATUS DATE^RD^^0;14^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",399,399,.14,1,0)
^.1
"^DD",399,399,.14,1,1,0)
399^AF^MUMPS
"^DD",399,399,.14,1,1,1)
D BC^IBJVDEQ
"^DD",399,399,.14,1,1,2)
Q
"^DD",399,399,.14,1,1,"%D",0)
^.101^2^2^3030826^^^
"^DD",399,399,.14,1,1,"%D",1,0)
This cross-reference sets the record into the nightly Data
"^DD",399,399,.14,1,1,"%D",2,0)
Extract queue if it meets the criteria.
"^DD",399,399,.14,1,1,"DT")
3030826
"^DD",399,399,.14,3)
Enter the date of last status change.
"^DD",399,399,.14,5,1,0)
399^.13^1
"^DD",399,399,.14,21,0)
^^1^1^2880831^
"^DD",399,399,.14,21,1,0)
This is the date of the last status change.
"^DD",399,399,.14,"DT")
3030826
**END**
**END**
