Released PSJ*5*125 SEQ #120
Extracted from mail message
**KIDS**:PSJ*5.0*125^

**INSTALL NAME**
PSJ*5.0*125
"BLD",5444,0)
PSJ*5.0*125^INPATIENT MEDICATIONS^0^3050104^y
"BLD",5444,1,0)
^^10^10^3050104^
"BLD",5444,1,1,0)
 1. CON-0404-10937  Site reported dispensing a ONE TIME unit dose
"BLD",5444,1,2,0)
    medication as a Pre-Exchange dose, the medication also showed up on
"BLD",5444,1,3,0)
    the following PICK LIST requesting a dose-to-dispense of one (1)
"BLD",5444,1,4,0)
    instead of zero (0).  This patch will determine if the SCHEDULE TYPE
"BLD",5444,1,5,0)
    is ONE-TIME and if a dosage was dispensed as PRE-EXCHANGE and not
"BLD",5444,1,6,0)
    request a dosage on the PICK LIST.
"BLD",5444,1,7,0)
 2. PHO-1204-60861  Renewal of QOD (every other day) schedules causes the
"BLD",5444,1,8,0)
    Pick List to restart the QOD schedule from the renewal date instead 
"BLD",5444,1,9,0)
    of the start date.  This routine change will cause the Pick List to
"BLD",5444,1,10,0)
    maintain the schedule from the start date.
"BLD",5444,4,0)
^9.64PA^^
"BLD",5444,"KRN",0)
^9.67PA^8989.52^19
"BLD",5444,"KRN",.4,0)
.4
"BLD",5444,"KRN",.401,0)
.401
"BLD",5444,"KRN",.402,0)
.402
"BLD",5444,"KRN",.403,0)
.403
"BLD",5444,"KRN",.5,0)
.5
"BLD",5444,"KRN",.84,0)
.84
"BLD",5444,"KRN",3.6,0)
3.6
"BLD",5444,"KRN",3.8,0)
3.8
"BLD",5444,"KRN",9.2,0)
9.2
"BLD",5444,"KRN",9.8,0)
9.8
"BLD",5444,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5444,"KRN",9.8,"NM",1,0)
PSGPL0^^0^B33739320
"BLD",5444,"KRN",9.8,"NM","B","PSGPL0",1)
 
"BLD",5444,"KRN",19,0)
19
"BLD",5444,"KRN",19.1,0)
19.1
"BLD",5444,"KRN",101,0)
101
"BLD",5444,"KRN",409.61,0)
409.61
"BLD",5444,"KRN",771,0)
771
"BLD",5444,"KRN",870,0)
870
"BLD",5444,"KRN",8989.51,0)
8989.51
"BLD",5444,"KRN",8989.52,0)
8989.52
"BLD",5444,"KRN",8994,0)
8994
"BLD",5444,"KRN","B",.4,.4)
 
"BLD",5444,"KRN","B",.401,.401)
 
"BLD",5444,"KRN","B",.402,.402)
 
"BLD",5444,"KRN","B",.403,.403)
 
"BLD",5444,"KRN","B",.5,.5)
 
"BLD",5444,"KRN","B",.84,.84)
 
"BLD",5444,"KRN","B",3.6,3.6)
 
"BLD",5444,"KRN","B",3.8,3.8)
 
"BLD",5444,"KRN","B",9.2,9.2)
 
"BLD",5444,"KRN","B",9.8,9.8)
 
"BLD",5444,"KRN","B",19,19)
 
"BLD",5444,"KRN","B",19.1,19.1)
 
"BLD",5444,"KRN","B",101,101)
 
"BLD",5444,"KRN","B",409.61,409.61)
 
"BLD",5444,"KRN","B",771,771)
 
"BLD",5444,"KRN","B",870,870)
 
"BLD",5444,"KRN","B",8989.51,8989.51)
 
"BLD",5444,"KRN","B",8989.52,8989.52)
 
"BLD",5444,"KRN","B",8994,8994)
 
"BLD",5444,"QUES",0)
^9.62^^
"BLD",5444,"REQB",0)
^9.611^1^1
"BLD",5444,"REQB",1,0)
PSJ*5.0*110^2
"BLD",5444,"REQB","B","PSJ*5.0*110",1)
 
"MBREQ")
0
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,20,0)
^9.402P^^
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
125^3050104^520637415
"PKG",221,22,1,"PAH",1,1,0)
^^10^10^3050104
"PKG",221,22,1,"PAH",1,1,1,0)
 1. CON-0404-10937  Site reported dispensing a ONE TIME unit dose
"PKG",221,22,1,"PAH",1,1,2,0)
    medication as a Pre-Exchange dose, the medication also showed up on
"PKG",221,22,1,"PAH",1,1,3,0)
    the following PICK LIST requesting a dose-to-dispense of one (1)
"PKG",221,22,1,"PAH",1,1,4,0)
    instead of zero (0).  This patch will determine if the SCHEDULE TYPE
"PKG",221,22,1,"PAH",1,1,5,0)
    is ONE-TIME and if a dosage was dispensed as PRE-EXCHANGE and not
"PKG",221,22,1,"PAH",1,1,6,0)
    request a dosage on the PICK LIST.
"PKG",221,22,1,"PAH",1,1,7,0)
 2. PHO-1204-60861  Renewal of QOD (every other day) schedules causes the
"PKG",221,22,1,"PAH",1,1,8,0)
    Pick List to restart the QOD schedule from the renewal date instead 
"PKG",221,22,1,"PAH",1,1,9,0)
    of the start date.  This routine change will cause the Pick List to
"PKG",221,22,1,"PAH",1,1,10,0)
    maintain the schedule from the start date.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSGPL0")
0^1^B33739320
"RTN","PSGPL0",1,0)
PSGPL0 ;BIR/CML3-GETS UNITS COUNT FOR PSGPL & PSGPEN ;29 OCT 96 / 8:31 PM
"RTN","PSGPL0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,83,110,125**;16 DEC 97
"RTN","PSGPL0",3,0)
 ;
"RTN","PSGPL0",4,0)
 ; Reference to ^PS(51.1 supported by DBIA #2177.
"RTN","PSGPL0",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGPL0",6,0)
 ;
"RTN","PSGPL0",7,0)
EN ;
"RTN","PSGPL0",8,0)
 K PSGMAR S PSGPLC=0 D RUN
"RTN","PSGPL0",9,0)
 ;
"RTN","PSGPL0",10,0)
DONE K HCD,HM,I,J,PSGD,PLSD,CD,M,MID,MN,ND,ND1,PREX,OD,ST,QD1,QD2,QQ,TS,UD,WDT,WS,WS1,X,X1,X2 Q
"RTN","PSGPL0",11,0)
 ;
"RTN","PSGPL0",12,0)
RUN ; quit if fill on request prn or stop date not found
"RTN","PSGPL0",13,0)
 S ND1=$P($G(^PS(55,PSGP,5,PSGPLO,0)),"^",7) Q:('$D(PSGMFOR)&(ND1="R"))  I $F("OCP",ND1)-1'>0,('$D(PSGMFOR)) S PSGPLC="OI" Q
"RTN","PSGPL0",14,0)
 S ND=$G(^PS(55,PSGP,5,PSGPLO,2)) Q:($P(ND,"^")["PRN")&('$D(PSJPRN))  Q:$P(ND,"^")="PRN"
"RTN","PSGPL0",15,0)
 S ST=$P(ND,"^",2) I $G(PSGPENO) N RNDT S RNDT=+$$LASTREN^PSJLMPRI(PSGP,+PSGPLO_"U") I RNDT S ST=RNDT
"RTN","PSGPL0",16,0)
 S PLSD=$P(ND,"^",4),TS=$P(ND,"^",5),MN=$P(ND,"^",6),ND=$P(ND,"^") D:ND["PRN" SETMN I $S(ST'?7N1"."1N.E:1,1:PLSD'?7N1"."1N.E) S PSGPLC="OI" Q
"RTN","PSGPL0",17,0)
 ;Quit if One Time order and dosage was given through "PRE-EXCHANGE".
"RTN","PSGPL0",18,0)
 S PREX=$G(^PS(55,PSGP,5,PSGPLO,1,1,0)) I $$ONE^PSJBCMA(PSGP,PSGPLO_"U",$P(ND,"^",1))="O",$P(PREX,"^",12)'="",$P(PREX,"^",2)'="",$P(PREX,"^",2)'>$P(PREX,"^",12) Q
"RTN","PSGPL0",19,0)
ENIV ;*** Entry to be called from ^PSGMIV (24 HOUR MAR IV).
"RTN","PSGPL0",20,0)
 Q:ST'<PSGPLF  I ND1="O"!(ND1="OC")!(MN="O") S PSGPLC=PLSD'<PSGPLS S:ND1'["C"&PSGPLC PSGMAR($E(+$P(ST,".",2)_"0",1,2))="" Q
"RTN","PSGPL0",21,0)
 I (TS'>0!("24"'[$L($P(TS,"-")))),MN="",ND'["@" S PSGPLC="OI" Q
"RTN","PSGPL0",22,0)
 S CD=$S(PSGPLF>PLSD:PLSD,1:PSGPLF),OD=$S(ST>PSGPLS:ST,1:PSGPLS),MID=1 I ND["@"!(MN="D") G MWF
"RTN","PSGPL0",23,0)
 I MN>1440,TS,'(MN#1440) G TSFMN
"RTN","PSGPL0",24,0)
 I TS>0,"24"[$L($P(TS,"-")) S:PSGPLS>ST ST=PSGPLS G TS
"RTN","PSGPL0",25,0)
 ;
"RTN","PSGPL0",26,0)
MN ; if only minutes (MN) are found
"RTN","PSGPL0",27,0)
 I MN'>0 S PSGPLC="OI" Q
"RTN","PSGPL0",28,0)
 S (OD,X1)=PSGPLS,HM=MN,X2=ST D ^%DTC I X>1 S AM=X-1*1440\HM*HM D ADD S ST=X
"RTN","PSGPL0",29,0)
 S (CML,X)=ST F I=0:1 S AM=HM*I,ST=CML D:AM ADD Q:X>CD!(CD=PLSD&(X'<CD))  I X'<OD S PSGPLC=PSGPLC+1,PSGMAR($E($P(X,".",2)_"0",1,2))=""
"RTN","PSGPL0",30,0)
 S ST=CML Q
"RTN","PSGPL0",31,0)
 ;
"RTN","PSGPL0",32,0)
TSFMN ;if admin times exist and minutes#1440=0
"RTN","PSGPL0",33,0)
 S X=$P(ST,"."),MID=MN\1440 F I=0:1 S X1=$P(ST,"."),X2=MID*I D:X2 C^%DTC Q:X'<CD  I X'<(PSGPLS\1) S ST=$S(PSGPLS\1=X:$S(PSGPLS#1<(ST#1):ST,1:PSGPLS),PSGPLS\1<X:ST,1:PSGPLS) G TS
"RTN","PSGPL0",34,0)
 Q
"RTN","PSGPL0",35,0)
 ;
"RTN","PSGPL0",36,0)
TS ; admin times
"RTN","PSGPL0",37,0)
 F Q=1:1 S XX=$P(TS,"-",Q) Q:XX=""!(("."_XX)'<(ST#1))
"RTN","PSGPL0",38,0)
TS1 X:XX="" "S X1=ST\1,X2=MID D C^%DTC S ST=X,Q=1" F QQ=Q:1 S XX=$P(TS,"-",QQ) G:XX="" TS1 S ST=$P(ST,".")_"."_XX Q:ST>CD!(CD=PLSD&(ST'<CD))  S:PSGPLS'>ST PSGPLC=PSGPLC+1,PSGMAR($E(XX_"0",1,2))=""
"RTN","PSGPL0",39,0)
 Q
"RTN","PSGPL0",40,0)
 ;
"RTN","PSGPL0",41,0)
MWF ; schedule in form of WD-WD-WD@TS
"RTN","PSGPL0",42,0)
 S:ND["@" ND=$P(ND,"@") S:'TS TS=$E($P(ST,".",2)_"0000",1,4) S HCD=CD,X=$P(OD,".")
"RTN","PSGPL0",43,0)
 S MN="-" I ND'["-",ND?.E1P.E F FQ=1:1:$L(ND) I $E(ND,FQ)?1P S MN=$E(ND,FQ) Q
"RTN","PSGPL0",44,0)
 F FQ=0:1 S X1=$P(OD,"."),X2=FQ D:X2 C^%DTC Q:X>$P(HCD,".")  S CD=$S($P(HCD,".")>X:X_.24,1:HCD),ST=$S($P(OD,".")<X:X_.0001,1:OD) D DW^%DTC S X=X_"S" F FQ1=1:1:$L(ND,MN) I $P(X,$P(ND,MN,FQ1))="" D TS Q
"RTN","PSGPL0",45,0)
 Q
"RTN","PSGPL0",46,0)
 ;
"RTN","PSGPL0",47,0)
ADD ; ST=start date/time   AM=minutes (+ or -)  X=new date/time
"RTN","PSGPL0",48,0)
 S:'AM X=ST Q:'AM  S T=1 S:AM<0 T=-1,AM=-AM S X2=AM\1440,AM=AM-(X2*1440),H=AM\60,M=AM#60,HRS=+$E(ST_"00",9,10),MN=+$E(ST_"0000",11,12),X=ST\1
"RTN","PSGPL0",49,0)
 I M S MN=MN+(M*T) S:MN>59 MN=MN-60,H=H+1 S:MN<0 MN=MN+60,H=H+1
"RTN","PSGPL0",50,0)
 I H S HRS=HRS+(H*T) S:HRS>24!(HRS=24&MN) HRS=HRS-24,X2=X2+1 S:HRS<0 HRS=HRS+24,X2=X2+1
"RTN","PSGPL0",51,0)
 I X2 S X1=$P(X,"."),X2=X2*T D C^%DTC
"RTN","PSGPL0",52,0)
 S X=+(X_"."_$E(0,HRS<10)_HRS_$E(0,MN<10)_MN) K AM,H,HRS,M,MN,T Q
"RTN","PSGPL0",53,0)
 ;
"RTN","PSGPL0",54,0)
SETMN ; Set MN for PRN orders
"RTN","PSGPL0",55,0)
 Q:($G(MN)]"")!($G(TS)]"")!(ND["Q0")  S MNFL=0,MN="",TS="" F XX=0:0 S XX=$O(^PS(51.1,"AC","PSJ",ND,XX)) Q:'XX!(MNFL)  D
"RTN","PSGPL0",56,0)
 .S:$P($G(^PS(51.1,XX,0)),"^",3)'="" MN=$P($G(^(0)),"^",3),MNFL=1 S:$P($G(^(0)),"^",2)'="" TS=$P($G(^(0)),"^",2),MNFL=1 Q
"RTN","PSGPL0",57,0)
 I 'MNFL,$E(ND,1,3)'="PRN" D
"RTN","PSGPL0",58,0)
 .S PRND=$P(ND,"PRN") D:$E(PRND,$L(PRND))=" "  F XX=0:0 S XX=$O(^PS(51.1,"AC","PSJ",PRND,XX)) Q:'XX!(MNFL)  S:$P($G(^PS(51.1,XX,0)),"^",3)'="" MN=$P($G(^(0)),"^",3),MNFL=1 S:$P($G(^(0)),"^",2)'="" TS=$P($G(^(0)),"^",2),MNFL=1
"RTN","PSGPL0",59,0)
 ..F  S PRND=$E(PRND,1,$L(PRND)-1) Q:$E(PRND,$L(PRND))'=" "
"RTN","PSGPL0",60,0)
 I 'MNFL,$E(ND,1,3)="PRN" S PRND=$P(ND,"PRN",2) D:$E(PRND)=" "  F XX=0:0 S XX=$O(^PS(51.1,"AC","PSJ",PRND,XX)) Q:'XX!(MNFL)  S:$P($G(^PS(51.1,XX,0)),"^",3)'="" MN=$P($G(^(0)),"^",3),MNFL=1 S:$P($G(^(0)),"^",2)'="" TS=$P($G(^(0)),"^",2),MNFL=1
"RTN","PSGPL0",61,0)
 .F  S PRND=$E(PRND,2,$L(PRND)) Q:$E(PRND)'=" "
"RTN","PSGPL0",62,0)
 I 'MNFL D
"RTN","PSGPL0",63,0)
 .I PRND["@" D DW S:$D(PRND) TS=$P(PRND,"@",2) Q
"RTN","PSGPL0",64,0)
 .I $E(PRND,1,2)="AD" Q
"RTN","PSGPL0",65,0)
 .I $E(PRND,1,3)="BID"!($E(PRND,1,3)="TID")!($E(PRND,1,3)="QID") S MN=1440/$F("BTQ",$E(PRND)) Q
"RTN","PSGPL0",66,0)
 .S:$E(PRND)="Q" PRND=$E(PRND,2,99) S:'PRND PRND="1"_PRND S PRND1=+PRND,PRND=$P(PRND,+PRND,2),PRND2=0 S:PRND1<0 PRND1=-PRND1 S:$E(PRND)="X" PRND2=1,PRND=$E(PRND,2,99)
"RTN","PSGPL0",67,0)
 .S MN=$S((PRND["D"&(PRND'["AD"))!(PRND["AM")!(PRND["PM")!((PRND["HS")&(PRND'["THS")):1440,((PRND["H")&(PRND'["TH")):60,PRND["AC"!(PRND["PC"):480,PRND["W":10080,PRND["M":40320,1:-1) I MN>0 S:PRND["QO" MN=MN*2 S MN=MN*PRND1 Q:MN>0
"RTN","PSGPL0",68,0)
QUIT K XX,MNFL,PRND,PRND1,PRND2,QX,SDW,SWD,Z Q
"RTN","PSGPL0",69,0)
 ;
"RTN","PSGPL0",70,0)
DW ;
"RTN","PSGPL0",71,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=PRND,PRND=$P(PRND,"@",2) D ENCHK Q:'$D(PRND)  S PRND=$P(SDW,"@"),PRND(1)="-" I PRND?.E1P.E,PRND'["-" F QX=1:1:$L(PRND) I $E(PRND,QX)?1P S PRND(1)=$E(PRND,QX) Q
"RTN","PSGPL0",72,0)
 F Q=1:1:$L(PRND,PRND(1)) K:SWD="" PRND Q:SWD=""  S Z=$P(PRND,PRND(1),Q) D DWC Q:'$D(PRND)
"RTN","PSGPL0",73,0)
 K PRND(1) S:$D(PRND) PRND=SDW Q
"RTN","PSGPL0",74,0)
DWC I $L(Z)<2 K PRND Q
"RTN","PSGPL0",75,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSGPL0",76,0)
 E  K PRND
"RTN","PSGPL0",77,0)
 Q
"RTN","PSGPL0",78,0)
 ;
"RTN","PSGPL0",79,0)
ENCHK ;
"RTN","PSGPL0",80,0)
 I $S($L($P(PRND,"-"))>4:1,$L(PRND)>119:1,$L(PRND)<2:1,PRND'>0:1,1:PRND'?.ANP) K PRND Q
"RTN","PSGPL0",81,0)
 S PRND(1)=$P(PRND,"-") I PRND(1)'?2N,PRND(1)'?4N K PRND Q
"RTN","PSGPL0",82,0)
 S PRND(1)=$L(PRND(1)) I PRND'["-",PRND>$E(2400,1,PRND(1)) K PRND Q
"RTN","PSGPL0",83,0)
 F PRND(2)=2:1:$L(PRND,"-") S PRND(3)=$P(PRND,"-",PRND(2)) I $S($L(PRND(3))'=PRND(1):1,PRND(3)>$E(2400,1,PRND(1)):1,1:PRND(3)'>$P(PRND,"-",PRND(2)-1)) K PRND Q
"RTN","PSGPL0",84,0)
 K:$D(PRND) PRND(1),PRND(2),PRND(3) Q
"RTN","PSGPL0",85,0)
  
"RTN","PSGPL0",86,0)
  
"VER")
8.0^22.0
**END**
**END**
