Released LR*5.2*299 SEQ #233
Extracted from mail message
**KIDS**:LR*5.2*299^

**INSTALL NAME**
LR*5.2*299
"BLD",3891,0)
LR*5.2*299^LAB SERVICE^0^3030801^y
"BLD",3891,1,0)
^^1^1^3021212^^^^
"BLD",3891,1,1,0)
See patch description for details.
"BLD",3891,4,0)
^9.64PA^^
"BLD",3891,"ABNS",0)
^9.66A^^
"BLD",3891,"ABPKG")
n^y^G.LABTEST@ISC-SLC.VA.GOV
"BLD",3891,"KRN",0)
^9.67PA^8989.52^20
"BLD",3891,"KRN",.4,0)
.4
"BLD",3891,"KRN",.401,0)
.401
"BLD",3891,"KRN",.402,0)
.402
"BLD",3891,"KRN",.403,0)
.403
"BLD",3891,"KRN",.5,0)
.5
"BLD",3891,"KRN",.84,0)
.84
"BLD",3891,"KRN",3.6,0)
3.6
"BLD",3891,"KRN",3.8,0)
3.8
"BLD",3891,"KRN",9.2,0)
9.2
"BLD",3891,"KRN",9.8,0)
9.8
"BLD",3891,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",3891,"KRN",9.8,"NM",1,0)
LR7OFB0^^1^
"BLD",3891,"KRN",9.8,"NM",2,0)
LR7OU0^^0^B12216747
"BLD",3891,"KRN",9.8,"NM",3,0)
LR7OF1^^0^B24069320
"BLD",3891,"KRN",9.8,"NM","B","LR7OF1",3)

"BLD",3891,"KRN",9.8,"NM","B","LR7OFB0",1)

"BLD",3891,"KRN",9.8,"NM","B","LR7OU0",2)

"BLD",3891,"KRN",19,0)
19
"BLD",3891,"KRN",19,"NM",0)
^9.68A^^
"BLD",3891,"KRN",19.1,0)
19.1
"BLD",3891,"KRN",101,0)
101
"BLD",3891,"KRN",409.61,0)
409.61
"BLD",3891,"KRN",771,0)
771
"BLD",3891,"KRN",869.2,0)
869.2
"BLD",3891,"KRN",870,0)
870
"BLD",3891,"KRN",8989.51,0)
8989.51
"BLD",3891,"KRN",8989.52,0)
8989.52
"BLD",3891,"KRN",8994,0)
8994
"BLD",3891,"KRN","B",.4,.4)

"BLD",3891,"KRN","B",.401,.401)

"BLD",3891,"KRN","B",.402,.402)

"BLD",3891,"KRN","B",.403,.403)

"BLD",3891,"KRN","B",.5,.5)

"BLD",3891,"KRN","B",.84,.84)

"BLD",3891,"KRN","B",3.6,3.6)

"BLD",3891,"KRN","B",3.8,3.8)

"BLD",3891,"KRN","B",9.2,9.2)

"BLD",3891,"KRN","B",9.8,9.8)

"BLD",3891,"KRN","B",19,19)

"BLD",3891,"KRN","B",19.1,19.1)

"BLD",3891,"KRN","B",101,101)

"BLD",3891,"KRN","B",409.61,409.61)

"BLD",3891,"KRN","B",771,771)

"BLD",3891,"KRN","B",869.2,869.2)

"BLD",3891,"KRN","B",870,870)

"BLD",3891,"KRN","B",8989.51,8989.51)

"BLD",3891,"KRN","B",8989.52,8989.52)

"BLD",3891,"KRN","B",8994,8994)

"BLD",3891,"PRE")

"BLD",3891,"QUES",0)
^9.62^^
"BLD",3891,"REQB",0)
^9.611^3^3
"BLD",3891,"REQB",1,0)
LR*5.2*256^2
"BLD",3891,"REQB",2,0)
LR*5.2*265^2
"BLD",3891,"REQB",3,0)
LR*5.2*121^2
"BLD",3891,"REQB","B","LR*5.2*121",3)

"BLD",3891,"REQB","B","LR*5.2*256",1)

"BLD",3891,"REQB","B","LR*5.2*265",2)

"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950118
"PKG",26,22,1,"PAH",1,0)
299^3030801
"PKG",26,22,1,"PAH",1,1,0)
^^1^1^3030801
"PKG",26,22,1,"PAH",1,1,1,0)
See patch description for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","LR7OF1")
0^3^B24069320
"RTN","LR7OF1",1,0)
LR7OF1 ;slc/dcm - Setup new order from OE/RR ;8/11/97
"RTN","LR7OF1",2,0)
 ;;5.2;LAB SERVICE;**121,187,223,256,299**;Sep 27, 1994
"RTN","LR7OF1",3,0)
 ;
"RTN","LR7OF1",4,0)
EN ;Setup NEW orders from OE/RR messages
"RTN","LR7OF1",5,0)
 ;[^TMP("OR",$J,"LRES") DOCUMENTATION]
"RTN","LR7OF1",6,0)
 ; 'Combining of Orders' functionality depends on this TMP global
"RTN","LR7OF1",7,0)
 ; Set and Killed when BHS and BTS batch message headers are received
"RTN","LR7OF1",8,0)
 ; Global contains a list of lab orders for a session
"RTN","LR7OF1",9,0)
 ; Lab adds elements to the global array as orders are processed:
"RTN","LR7OF1",10,0)
 ;  ^TMP("OR",$J,"LRES",LRDFN,LRSDT,LRXZ,^TMP("OR",$J,"LRES","CTR"))=LRORD_"^"_LRODT_"^"_LRSN
"RTN","LR7OF1",11,0)
 ;  ^TMP("OR",$J,"LRES","CTR")=Count
"RTN","LR7OF1",12,0)
 N ZTSK,LRORDR,X,UNEEK,LRNT ;UNEEK forces a unique entry (Micro tests), set when ^..."LROT" built
"RTN","LR7OF1",13,0)
 D DT
"RTN","LR7OF1",14,0)
 S LRORDR=LRXZ
"RTN","LR7OF1",15,0)
 S:'$D(^TMP("OR",$J,"LRES","CTR")) ^("CTR")=0
"RTN","LR7OF1",16,0)
 F LRSAMP=-1:0 S LRSAMP=$O(^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP)) Q:LRSAMP=""  D
"RTN","LR7OF1",17,0)
 . F LRSPEC=-1:0 S LRSPEC=$O(^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP,LRSPEC)) Q:LRSPEC=""  S X=^(LRSPEC,0) D
"RTN","LR7OF1",18,0)
 .. S ORIFN=+X,UNEEK=$P(X,"^",2)
"RTN","LR7OF1",19,0)
 .. D ZX
"RTN","LR7OF1",20,0)
 Q
"RTN","LR7OF1",21,0)
ZX ;
"RTN","LR7OF1",22,0)
 N COMBINE,X,NEWORD
"RTN","LR7OF1",23,0)
 I '$D(^LRO(69,LRODT,0)) D
"RTN","LR7OF1",24,0)
 . S ^(0)=$P(^LRO(69,0),U,1,2)_"^"_LRODT_"^"_(1+$P(^(0),U,4)),^LRO(69,LRODT,0)=LRODT,^LRO(69,"B",LRODT,LRODT)=""
"RTN","LR7OF1",25,0)
 S COMBINE=""
"RTN","LR7OF1",26,0)
 I 'UNEEK D
"RTN","LR7OF1",27,0)
 . S COMBINE=$$ORES^LR7OF5(LRDFN,LRSDT,LRXZ,+LRSAMP,LRPRAC,LROLLOC,LRSPEC,LRDUZ)
"RTN","LR7OF1",28,0)
 . I '$L(COMBINE) S COMBINE=$$FIND^LR7OF5(LRDFN,LRODT,LRSDT,LRXZ,+LRSAMP,LRPRAC,LROLLOC,LRSPEC,LRDUZ)
"RTN","LR7OF1",29,0)
 I '$L(COMBINE) S (NEWORD,ZTQUEUED)=1 L +^LRO(69,$E(DT,1,3)_"0000",2) D ORDER^LROW2 K ZTSK,ZTQUEUED,ZTREQ G LOCK
"RTN","LR7OF1",30,0)
 I $E(COMBINE,1,2)="S." S LRSN=$P(COMBINE,".",2),LRORD=$P(COMBINE,".",3) G ADD ;Combine on specimen
"RTN","LR7OF1",31,0)
 I $E(COMBINE,1,2)="O."!($E(COMBINE,1,2)="C.") S LRORD=$S($E(COMBINE,1,2)="O.":$P(COMBINE,".",2),1:$P(COMBINE,".",3)) ;Combine on order #
"RTN","LR7OF1",32,0)
LOCK ;
"RTN","LR7OF1",33,0)
 L +^LRO(69,LRODT,1):360
"RTN","LR7OF1",34,0)
 I '$T G LOCK
"RTN","LR7OF1",35,0)
 S LRSN=1+$O(^LRO(69,LRODT,1,999999999),-1),LRSUM=1+$S($D(^LRO(69,LRODT,1,0)):$P(^(0),U,4),1:0)
"RTN","LR7OF1",36,0)
ZSN ;
"RTN","LR7OF1",37,0)
 I $D(^LRO(69,LRODT,1,LRSN,0)) S LRSN=LRSN+1 G ZSN
"RTN","LR7OF1",38,0)
 S ^LRO(69,LRODT,1,LRSN,0)=LRDFN_"^"_LRDUZ_"^"_+LRSAMP_"^"_LRORDR_"^"_LRNT_"^"_LRPRAC_"^"_LRLLOC_"^"_LRSDT_"^"_LROLLOC_"^^"_ORIFN,^LRO(69,LRODT,1,0)="^69.01PA^"_LRSN_"^"_LRSUM
"RTN","LR7OF1",39,0)
 L -^LRO(69,LRODT,1)
"RTN","LR7OF1",40,0)
 S ^LRO(69,LRODT,1,"AA",LRDFN,LRSN)="",^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP,LRSPEC,"SN")=LRSN,^LRO(69,"D",LRDFN,LRODT,LRSN)=""
"RTN","LR7OF1",41,0)
 I $L(LRLLOC) S ^LRO(69,LRODT,1,"AC",LRLLOC,LRSN)=""
"RTN","LR7OF1",42,0)
 I $L(LRSPEC) S ^LRO(69,LRODT,1,LRSN,4,0)="^69.02PA^1^1",^(1,0)=LRSPEC
"RTN","LR7OF1",43,0)
 S ^LRO(69,LRODT,1,LRSN,.1)=LRORD,^LRO(69,"C",+LRORD,LRODT,LRSN)=""
"RTN","LR7OF1",44,0)
 I $G(NEWORD) L -^LRO(69,$E(DT,1,3)_"0000",2)
"RTN","LR7OF1",45,0)
ADD ;
"RTN","LR7OF1",46,0)
 N I,J,LRJ,LRSXN,LRORIFN,NODE,STATUS
"RTN","LR7OF1",47,0)
 S ^TMP("OR",$J,"LRES","CTR")=^TMP("OR",$J,"LRES","CTR")+1,^TMP("OR",$J,"LRES",LRDFN,LRSDT,LRXZ,^TMP("OR",$J,"LRES","CTR"))=LRORD_"^"_LRODT_"^"_LRSN
"RTN","LR7OF1",48,0)
 S LRORIFN=+$G(^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP,LRSPEC,0))
"RTN","LR7OF1",49,0)
 S J=0
"RTN","LR7OF1",50,0)
 F LRJ=1:1 S J=$O(^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP,LRSPEC,J)) Q:J<1  S NODE=^(J),STATUS=$G(^(J,1)) D ZSN1(NODE,STATUS)
"RTN","LR7OF1",51,0)
 S (LRSXN,I)=0
"RTN","LR7OF1",52,0)
 F  S I=$O(^LRO(69,LRODT,1,LRSN,2,I)) Q:I<1  S LRSXN=LRSXN+1
"RTN","LR7OF1",53,0)
 S:LRSXN ^LRO(69,LRODT,1,LRSN,2,0)="^69.03PA^"_LRSXN_"^"_LRSXN
"RTN","LR7OF1",54,0)
 I $E(COMBINE,1,2)="C." D
"RTN","LR7OF1",55,0)
 . S (LRSXN,I)=0 F  S I=$O(^LRO(69,LRODT,1,+$P(COMBINE,".",2),2,I)) Q:I<1  S LRSXN=LRSXN+1
"RTN","LR7OF1",56,0)
 . S:LRSXN ^LRO(69,LRODT,1,+$P(COMBINE,".",2),2,0)="^69.03PA^"_LRSXN_"^"_LRSXN
"RTN","LR7OF1",57,0)
 Q
"RTN","LR7OF1",58,0)
ZSN1(NODE,STATUS)    ;Add tests
"RTN","LR7OF1",59,0)
 N CNT,XI,X,I,C,TCNT
"RTN","LR7OF1",60,0)
 S CNT=+$O(^LRO(69,LRODT,1,LRSN,2,99999),-1)
"RTN","LR7OF1",61,0)
 S LRTSTS=+NODE,LRQUANT=$P(NODE,"^",2)
"RTN","LR7OF1",62,0)
 I $D(^LRO(69,LRODT,1,LRSN,2,"B",LRTSTS)) S REJECT(LRTSTS)="" Q
"RTN","LR7OF1",63,0)
 S ^LRO(69,LRODT,1,LRSN,2,CNT+LRJ,0)=LRTSTS_"^"_$S($L(STATUS):STATUS,1:LROUTINE)_"^^^^^"_LRORIFN
"RTN","LR7OF1",64,0)
 I $O(^TMP("OR",$J,"COM",LRSDT,LRXZ,LRSAMP,LRSPEC,J,0)) D
"RTN","LR7OF1",65,0)
 . S X=^TMP("OR",$J,"COM",LRSDT,LRXZ,LRSAMP,LRSPEC,J)+$S($P($G(^LRO(69,LRODT,1,LRSN,2,CNT+LRJ,1,0)),"^",4):$P(^(0),"^",4),1:0),^LRO(69,LRODT,1,LRSN,2,CNT+LRJ,1,0)="^^"_X_"^"_X_"^"_DT
"RTN","LR7OF1",66,0)
 . S TCNT=+$O(^LRO(69,LRODT,1,LRSN,2,CNT+LRJ,1,99999),-1),(C,I)=0
"RTN","LR7OF1",67,0)
 . F  S I=$O(^TMP("OR",$J,"COM",LRSDT,LRXZ,LRSAMP,LRSPEC,J,I)) Q:I<1  S C=C+1,^LRO(69,LRODT,1,LRSN,2,CNT+LRJ,1,C+TCNT,0)=^TMP("OR",$J,"COM",LRSDT,LRXZ,LRSAMP,LRSPEC,J,I)
"RTN","LR7OF1",68,0)
 S ^LRO(69,LRODT,1,LRSN,2,"B",LRTSTS,CNT+LRJ)=""
"RTN","LR7OF1",69,0)
 S ^LRO(69,"AT",LRDFN,LRTSTS,LRSPEC,LRODT)="",^(-LRODT)=""
"RTN","LR7OF1",70,0)
 I $E(COMBINE,1,2)="C." S X=^LRO(69,LRODT,1,LRSN,2,CNT+LRJ,0),$P(^(0),"^",6)=LRORD,XI=$P($G(^LRO(69,LRODT,1,LRSN,1)),"^",7),XI=XI_LRORD_"/",$P(^(1),"^",7)=XI D
"RTN","LR7OF1",71,0)
 . N CNT1
"RTN","LR7OF1",72,0)
 . S CNT1=$O(^LRO(69,LRODT,1,+$P(COMBINE,".",2),2,99999),-1)+1,^(CNT1,0)=X,$P(^(0),"^",14)=LRODT_";"_LRSN_";"_(CNT+LRJ),^LRO(69,LRODT,1,$P(COMBINE,".",2),2,"B",LRTSTS,CNT1)=""
"RTN","LR7OF1",73,0)
 Q
"RTN","LR7OF1",74,0)
DT ;
"RTN","LR7OF1",75,0)
 S DT=$$DT^XLFDT()
"RTN","LR7OF1",76,0)
 S LRNT=$P($H,",",2),LRNT=LRNT\3600*100+(LRNT\60#60)/10000+DT
"RTN","LR7OF1",77,0)
 Q
"RTN","LR7OFB0")
1^1
"RTN","LR7OU0")
0^2^B12216747
"RTN","LR7OU0",1,0)
LR7OU0 ;slc/dcm - HL7 Utilities/Conversions ;8/11/97
"RTN","LR7OU0",2,0)
 ;;5.2;LAB SERVICE;**121,187,265,299**;Sep 27, 1994
"RTN","LR7OU0",3,0)
 ; Reference to ^DIC(9.4 supported by IA #2058
"RTN","LR7OU0",4,0)
 ; Reference to ^SC( supported by IA #908
"RTN","LR7OU0",5,0)
 ; Reference to ^VA(200 supported by SUPPORTED REFERENCE #10060
"RTN","LR7OU0",6,0)
 ; Reference to ^XLFDT supported by IA #10103
"RTN","LR7OU0",7,0)
 ;
"RTN","LR7OU0",8,0)
EN ;
"RTN","LR7OU0",9,0)
 Q
"RTN","LR7OU0",10,0)
MSH(TYPE) ;Build MSH segment
"RTN","LR7OU0",11,0)
 ;TYPE=Message type (ORM)
"RTN","LR7OU0",12,0)
 N MSH
"RTN","LR7OU0",13,0)
 S MSH="MSH|^~\&|LABORATORY|"_$G(DUZ(2))_"|||||"_TYPE
"RTN","LR7OU0",14,0)
 Q MSH
"RTN","LR7OU0",15,0)
PID(LRDPF) ; PID segment
"RTN","LR7OU0",16,0)
 N PID
"RTN","LR7OU0",17,0)
 S PID="PID|||"_$S($P(LRDPF,"^",2)="DPT(":+DFN,1:"")_"|"_+DFN_";"_$P(LRDPF,"^",2)_"|"_$P($G(@("^"_$P(LRDPF,"^",2)_+DFN_",0)")),"^")
"RTN","LR7OU0",18,0)
 Q PID
"RTN","LR7OU0",19,0)
PV1(LOC,ROOMBED,VISIT) ; PV1 segment
"RTN","LR7OU0",20,0)
 ;TYPE = Patient Class (table 4)
"RTN","LR7OU0",21,0)
 ;ROOMBED = Patient Room/Bed
"RTN","LR7OU0",22,0)
 ;LOC = Patient Location
"RTN","LR7OU0",23,0)
 ;VISIT = Visit Number
"RTN","LR7OU0",24,0)
 N PV1,TYPE
"RTN","LR7OU0",25,0)
 S TYPE=$S($P($G(^SC(+LOC,0)),"^",3)="W":"I",1:"O")
"RTN","LR7OU0",26,0)
 S PV1="PV1||"_TYPE_"|"_LOC_"^"_ROOMBED_"||||||||||||||||"_$G(VISIT)
"RTN","LR7OU0",27,0)
 Q PV1
"RTN","LR7OU0",28,0)
HL7DT(DATE) ; FM -> HL7 format
"RTN","LR7OU0",29,0)
 Q $$FMTHL7^XLFDT(DATE)
"RTN","LR7OU0",30,0)
 ;N X
"RTN","LR7OU0",31,0)
 ;S X="" I DATE S X=(1700+$E(DATE,1,3))_$E(DATE,4,7)_$E(DATE,9,14)
"RTN","LR7OU0",32,0)
 ;Q X
"RTN","LR7OU0",33,0)
FMDATE(DATE) ; HL7 -> FM format
"RTN","LR7OU0",34,0)
 Q $$HL7TFM^XLFDT(DATE)
"RTN","LR7OU0",35,0)
 ;N X
"RTN","LR7OU0",36,0)
 ;S X="" I DATE S X=$E(DATE,1,4)-1700_$E(DATE,5,8)_$S($L($E(DATE,9)):"."_$E(DATE,9,14),1:"")
"RTN","LR7OU0",37,0)
 ;Q X
"RTN","LR7OU0",38,0)
NMSPACE(PKG) ; Returns pkg namespace
"RTN","LR7OU0",39,0)
 N X S X=$P($G(^DIC(9.4,PKG,0)),"^",2)
"RTN","LR7OU0",40,0)
 Q X
"RTN","LR7OU0",41,0)
UVID(X,SPEC,NID,NSEC,NNAME,MSG,SS) ; Set Universal ID
"RTN","LR7OU0",42,0)
 ;X=Test ptr to 60
"RTN","LR7OU0",43,0)
 ;NID=National ID
"RTN","LR7OU0",44,0)
 ;NNAME=National Name
"RTN","LR7OU0",45,0)
 ;NSEC=National coding system
"RTN","LR7OU0",46,0)
 ;SPEC=specimen ptr to file 61
"RTN","LR7OU0",47,0)
 ;MSG=Message array to store data in
"RTN","LR7OU0",48,0)
 ;SS=test subscript override, set when ORC is setup otherwise ""
"RTN","LR7OU0",49,0)
 N X1,X3,X4,X6,XX
"RTN","LR7OU0",50,0)
 S X3="LRT",X4=$P($G(^LAB(60,+$G(X),0)),"^"),X1=$P($G(^(0)),"^",4)
"RTN","LR7OU0",51,0)
 S MSG=$S($L(MSG):MSG,X1="":"^TMP(""LRCH"",$J)","CYEMSPAU"[X1:"^TMP(""LRAP"",$J)",X1="BB":"^TMP(""LRBB"",$J)",X1="MI":"^TMP(""LRCH"",$J)",1:"^TMP(""LRCH"",$J)"),X3="LRT" ;$S(X1="BB":"LRB",1:"LRT")
"RTN","LR7OU0",52,0)
 I '$D(@MSG@(1))#2 F I=1:1:4 I $D(MSG(I)) S @MSG@(I)=MSG(I)
"RTN","LR7OU0",53,0)
 S XX=$S($L($G(SS)):$S(SS="BB":"LRBB",SS="CH":"LRCH",SS="MI":"LRMI",1:"LRAP"),1:"LRCH") I $D(ORCMSG),$L($G(MSG(ORCMSG))),$E(MSG(ORCMSG),1,3)="ORC" S X6=$P($P(MSG(ORCMSG),"|",4),"^"),$P(@MSG@(ORCMSG),"|",4)=X6_"^"_XX
"RTN","LR7OU0",54,0)
 S X=NID_"^"_NNAME_"^"_NSEC_"^"_X_"^"_X4_"^99"_X3
"RTN","LR7OU0",55,0)
 Q X
"RTN","LR7OU0",56,0)
SAMP(SAMPLE,SPECIMEN) ; File 62,61 -> HL7 Source of Specimen code
"RTN","LR7OU0",57,0)
 ;Sample=ptr to file 62
"RTN","LR7OU0",58,0)
 ;Specimen=ptr to file 61
"RTN","LR7OU0",59,0)
 N X
"RTN","LR7OU0",60,0)
 S X=$G(^LAB(61,+SPECIMEN,0))
"RTN","LR7OU0",61,0)
 S X=$P(X,"^",2)_";"_$P(X,"^")_";SNM;"_SAMPLE_";"_$P($G(^LAB(62,+SAMPLE,0)),"^")_";99LRS^^^"_+SPECIMEN_";"_$P(X,"^")_";99LRX"
"RTN","LR7OU0",62,0)
 Q X
"RTN","LR7OU0",63,0)
LRSAMP(SAMPLE) ;HL7 -> File 62 sample format
"RTN","LR7OU0",64,0)
 ;Sample=Source of Specimen code
"RTN","LR7OU0",65,0)
 N X
"RTN","LR7OU0",66,0)
 S X=$P(SAMPLE,";",4)
"RTN","LR7OU0",67,0)
 Q X
"RTN","LR7OU0",68,0)
LRSPEC(SAMPLE) ;HL7 -> File 61 Specimen format
"RTN","LR7OU0",69,0)
 ;Sample=Source of Specimen code
"RTN","LR7OU0",70,0)
 N X
"RTN","LR7OU0",71,0)
 S X="" I $P($P(SAMPLE,"^",4),";") S X=$P($P(SAMPLE,"^",4),";")
"RTN","LR7OU0",72,0)
 I X="" S X=$S($L($P(SAMPLE,";")):$O(^LAB(61,"C",$P(SAMPLE,";"),0)),1:"")
"RTN","LR7OU0",73,0)
 I X="",$P(SAMPLE,";",4) S X=$P($G(^LAB(62,$P(SAMPLE,";",4),0)),"^",2)
"RTN","LR7OU0",74,0)
 Q X
"RTN","LR7OU0",75,0)
ACTCODE(TYPE) ;Lab Collection type -> HL7 Specimen Action Code
"RTN","LR7OU0",76,0)
 ;TYPE=WC, LC, SP, I, 3, A
"RTN","LR7OU0",77,0)
 N X
"RTN","LR7OU0",78,0)
 S X=$S(TYPE="SP":1,TYPE="WC":"O",TYPE="I":2,TYPE=3:3,TYPE="A":"A",1:"L")
"RTN","LR7OU0",79,0)
 Q X
"RTN","LR7OU0",80,0)
LRACTCOD(TYPE) ;HL7 Specimen Action Code -> Lab Collection type
"RTN","LR7OU0",81,0)
 ;Type=1, 2, 3, A, O, L
"RTN","LR7OU0",82,0)
 N X
"RTN","LR7OU0",83,0)
 S X=$S(TYPE=1:"SP",TYPE=2:"I",TYPE=3:3,TYPE="A":"A",TYPE="O":"WC",1:"LC")
"RTN","LR7OU0",84,0)
 Q X
"RTN","LR7OU0",85,0)
URG(URGENCY) ;Lab Urgency -> HL7 Priority code
"RTN","LR7OU0",86,0)
 ;URGENCY=Urgency ptr to Lab Urgency file
"RTN","LR7OU0",87,0)
 ;X returned: HL7 code;ptr to lab urgency file (62.05) e.g.: "S;1" for STAT
"RTN","LR7OU0",88,0)
 N X
"RTN","LR7OU0",89,0)
 S X=$S($D(^LAB(62.05,+$G(URGENCY),0)):$P(^(0),"^",4),1:""),X=X_";"_URGENCY
"RTN","LR7OU0",90,0)
 Q X
"RTN","LR7OU0",91,0)
LRURG(URGENCY) ;HL7 Priority -> Lab Urgency
"RTN","LR7OU0",92,0)
 ;URGENCY=HL7 Priority code
"RTN","LR7OU0",93,0)
 N X
"RTN","LR7OU0",94,0)
 S X=$P(URGENCY,";",2)
"RTN","LR7OU0",95,0)
 Q X
"RTN","LR7OU0",96,0)
FLAG(FLAG) ; Return HL7 Flag code
"RTN","LR7OU0",97,0)
 ;FLAG=Test result flag
"RTN","LR7OU0",98,0)
 N X
"RTN","LR7OU0",99,0)
 S X=$S(FLAG="L":FLAG,FLAG="H":FLAG,FLAG="H*":"HH",FLAG="L*":"LL",1:"")
"RTN","LR7OU0",100,0)
 Q X
"VER")
8.0^22.0
**END**
**END**
