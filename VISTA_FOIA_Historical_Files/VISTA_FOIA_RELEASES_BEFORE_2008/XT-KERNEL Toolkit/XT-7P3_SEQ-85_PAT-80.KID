Released XT*7.3*80 SEQ #85
Extracted from mail message
**KIDS**:XT*7.3*80^

**INSTALL NAME**
XT*7.3*80
"BLD",784,0)
XT*7.3*80^TOOLKIT^0^3070606^y
"BLD",784,1,0)
^9.61A^2^2^3070606^^^^
"BLD",784,1,1,0)
See patch XT*7.3*80 in the National Patch Module for complete
"BLD",784,1,2,0)
information on this patch.
"BLD",784,4,0)
^9.64PA^^
"BLD",784,6.3)
6
"BLD",784,"KRN",0)
^9.67PA^8989.52^19
"BLD",784,"KRN",.4,0)
.4
"BLD",784,"KRN",.401,0)
.401
"BLD",784,"KRN",.402,0)
.402
"BLD",784,"KRN",.403,0)
.403
"BLD",784,"KRN",.5,0)
.5
"BLD",784,"KRN",.84,0)
.84
"BLD",784,"KRN",3.6,0)
3.6
"BLD",784,"KRN",3.8,0)
3.8
"BLD",784,"KRN",9.2,0)
9.2
"BLD",784,"KRN",9.8,0)
9.8
"BLD",784,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",784,"KRN",9.8,"NM",1,0)
ZTBKC^^0^B28309117
"BLD",784,"KRN",9.8,"NM",2,0)
ZTBKCONT^^0^B70500658
"BLD",784,"KRN",9.8,"NM","B","ZTBKC",1)

"BLD",784,"KRN",9.8,"NM","B","ZTBKCONT",2)

"BLD",784,"KRN",19,0)
19
"BLD",784,"KRN",19.1,0)
19.1
"BLD",784,"KRN",101,0)
101
"BLD",784,"KRN",409.61,0)
409.61
"BLD",784,"KRN",771,0)
771
"BLD",784,"KRN",870,0)
870
"BLD",784,"KRN",8989.51,0)
8989.51
"BLD",784,"KRN",8989.52,0)
8989.52
"BLD",784,"KRN",8994,0)
8994
"BLD",784,"KRN","B",.4,.4)

"BLD",784,"KRN","B",.401,.401)

"BLD",784,"KRN","B",.402,.402)

"BLD",784,"KRN","B",.403,.403)

"BLD",784,"KRN","B",.5,.5)

"BLD",784,"KRN","B",.84,.84)

"BLD",784,"KRN","B",3.6,3.6)

"BLD",784,"KRN","B",3.8,3.8)

"BLD",784,"KRN","B",9.2,9.2)

"BLD",784,"KRN","B",9.8,9.8)

"BLD",784,"KRN","B",19,19)

"BLD",784,"KRN","B",19.1,19.1)

"BLD",784,"KRN","B",101,101)

"BLD",784,"KRN","B",409.61,409.61)

"BLD",784,"KRN","B",771,771)

"BLD",784,"KRN","B",870,870)

"BLD",784,"KRN","B",8989.51,8989.51)

"BLD",784,"KRN","B",8989.52,8989.52)

"BLD",784,"KRN","B",8994,8994)

"BLD",784,"QUES",0)
^9.62^^
"BLD",784,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",6,-1)
1^1
"PKG",6,0)
TOOLKIT^XT^PROGRAMMERS OPTIONS, MULTI. TERM LOOKUP^
"PKG",6,20,0)
^9.402P^^0
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.3^3040428^2970513^2
"PKG",6,22,1,"PAH",1,0)
80^3070606
"PKG",6,22,1,"PAH",1,1,0)
^^2^2^3070606
"PKG",6,22,1,"PAH",1,1,1,0)
See patch XT*7.3*80 in the National Patch Module for complete
"PKG",6,22,1,"PAH",1,1,2,0)
information on this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ZTBKC")
0^1^B28309117^n/a
"RTN","ZTBKC",1,0)
%ZTBKC ;SF/GJL - GLOBAL BLOCK COUNT ;05/24/2007  686246.738699
"RTN","ZTBKC",2,0)
 ;;7.3;TOOLKIT;**80**;Apr 25, 1995;Build 6
"RTN","ZTBKC",3,0)
 ;
"RTN","ZTBKC",4,0)
 ;X = FULL Global Reference: NAME(SUB1,...,SUBn)
"RTN","ZTBKC",5,0)
 ;
"RTN","ZTBKC",6,0)
 N %ZIS,DIRUT,DTOUT,DUOUT,POP
"RTN","ZTBKC",7,0)
 S U="^",%BS="",XX1=0 K ^XUTL($J)
"RTN","ZTBKC",8,0)
 I $P($G(^%ZOSF("OS")),"^")["OpenM-NT" N %ZTBKVER D  G QUIT:$G(%ZTBKVER)']""!$D(DUOUT)!$D(DIRUT)
"RTN","ZTBKC",9,0)
 . S %ZTBKVER=$P($$VERSION^%ZOSV,".",1,2)
"RTN","ZTBKC",10,0)
 . I %ZTBKVER="5.0"!(%ZTBKVER'<5.2) D ASKDIR^%ZTBKC1 Q
"RTN","ZTBKC",11,0)
 . W !,"This version of the Block Count Utility does not support this version of Cache'"
"RTN","ZTBKC",12,0)
 . S %ZTBKVER=""
"RTN","ZTBKC",13,0)
READ W !!,"Block Count for Global ^" I %BS]"" W %BS,"//"
"RTN","ZTBKC",14,0)
 R X:$S($D(DTIME):DTIME,1:300),! G:'$T!(X="^") QUIT I X="" S X=%BS
"RTN","ZTBKC",15,0)
STRIP I (X?1"^".E)!(X?1" ".E) S X=$E(X,2,256) G STRIP
"RTN","ZTBKC",16,0)
 I X="" G READY
"RTN","ZTBKC",17,0)
 I X="*" S ZTBKCALL=1 G READY
"RTN","ZTBKC",18,0)
 I X["*" W !,$C(7),"Wild cards not allowed as part of the global name." G SYNTAX
"RTN","ZTBKC",19,0)
 I X?1"??".E D QQ G READ
"RTN","ZTBKC",20,0)
 I X?1"?".E G SYNTAX
"RTN","ZTBKC",21,0)
 I X?1"(".E S %BS="" G SYNTAX
"RTN","ZTBKC",22,0)
 I $P(X,"(")'?.1"^".1"%"1A.AN W !,$C(7),"Only alphanumerics are allowed in global names." G SYNTAX
"RTN","ZTBKC",23,0)
 I $L(X,"(")>1,$E(X,$L(X))'=")" G SYNTAX
"RTN","ZTBKC",24,0)
 I $L(X,"(")>1,$P($E(X,1,$L(X)-1),"(",2,255)']"" G SYNTAX
"RTN","ZTBKC",25,0)
 S %T=X,%Z=1 F %A=1:1 Q:$E(%T,%A)=""  I $E(%T,%A)="""" D QUOTES
"RTN","ZTBKC",26,0)
 I %Z-1 G SYNTAX2
"RTN","ZTBKC",27,0)
 S %BS=X,X=U_%T,Y=$D(@(U_%BS)) W $S(Y=0:" doesn't exist.",1:"OK") I Y S XX1=XX1+1,^XUTL($J,XX1)=%BS_X
"RTN","ZTBKC",28,0)
 S %BS="" G READ
"RTN","ZTBKC",29,0)
QUOTES I ((%Z=0)&($E(%T,%A+1)="""")) S %T=$E(%T,0,%A)_$E(%T,%A+2,999)
"RTN","ZTBKC",30,0)
 E  S %T=$E(%T,0,%A-1)_$E(%T,%A+1,999),%A=%A-1,%Z=1-%Z
"RTN","ZTBKC",31,0)
 Q
"RTN","ZTBKC",32,0)
SYNTAX W !,"Enter: * for all globals in current directory, or"
"RTN","ZTBKC",33,0)
 W !,"Enter: a FULL Global Reference, e.g. ^DD(3,""GL""), or"
"RTN","ZTBKC",34,0)
 W !,"       ^ " W:%BS="" "or NULL " W "to quit."
"RTN","ZTBKC",35,0)
 W !!,"Enter: ? for this help, or"
"RTN","ZTBKC",36,0)
 W !,"       ?? for more help."
"RTN","ZTBKC",37,0)
 G READ
"RTN","ZTBKC",38,0)
SYNTAX2 W !,?5,"I'm sorry, but I don't understand your use of quotes."
"RTN","ZTBKC",39,0)
 W !,"Please surround string subscripts with quotes and any quote"
"RTN","ZTBKC",40,0)
 W !,"which is a part of the subscript should be doubled."
"RTN","ZTBKC",41,0)
 G READ
"RTN","ZTBKC",42,0)
QQ ;Double question mark response
"RTN","ZTBKC",43,0)
 K DIR S DIR(0)="SO^S:Show current selection"
"RTN","ZTBKC",44,0)
 S DIR(0)=DIR(0)_";D:De-select from current selection"
"RTN","ZTBKC",45,0)
 S DIR(0)=DIR(0)_";M:More help"
"RTN","ZTBKC",46,0)
 D ^DIR
"RTN","ZTBKC",47,0)
 I Y="S" D SHOW G QQ
"RTN","ZTBKC",48,0)
 I Y="D" D DSEL G QQ
"RTN","ZTBKC",49,0)
 I Y="M" D XTNDHELP G QQ
"RTN","ZTBKC",50,0)
 Q
"RTN","ZTBKC",51,0)
SHOW ;Show current selection
"RTN","ZTBKC",52,0)
 I '$D(IOF) D HOME^%ZIS
"RTN","ZTBKC",53,0)
 I $O(^XUTL($J,0))'>0 D  Q
"RTN","ZTBKC",54,0)
 . W !!,?20,"You have not selected any globals.",!
"RTN","ZTBKC",55,0)
 . K DIR S DIR(0)="E" D ^DIR
"RTN","ZTBKC",56,0)
 W @IOF,!,"You have selected the following globals:",!
"RTN","ZTBKC",57,0)
 S %U="" F %I=1:1 S %A=$G(^XUTL($J,%I)) Q:%A=""  D
"RTN","ZTBKC",58,0)
 .  W !,?8,"^"_$P(%A,U)
"RTN","ZTBKC",59,0)
 K DIR S DIR(0)="E" D ^DIR
"RTN","ZTBKC",60,0)
 Q
"RTN","ZTBKC",61,0)
DSEL ;Ask directory
"RTN","ZTBKC",62,0)
 N ZTBKCLST
"RTN","ZTBKC",63,0)
 I $O(^XUTL($J,0))'>0 D  Q
"RTN","ZTBKC",64,0)
 . W !!,?20,"You have not selected any globals.",!
"RTN","ZTBKC",65,0)
 . K DIR S DIR(0)="E" D ^DIR
"RTN","ZTBKC",66,0)
 K DIR S DIR("A",1)="To de-select from the selected globals:"
"RTN","ZTBKC",67,0)
 S %U="" F %I=1:1 S %A=$G(^XUTL($J,%I)) Q:%A=""  D
"RTN","ZTBKC",68,0)
 .  S DIR("A",%I+1)=$J("",3)_$J(%I,3)_$J("^",7)_$P(%A,U)
"RTN","ZTBKC",69,0)
 .  S ZTBKCLST(%I)=%A
"RTN","ZTBKC",70,0)
 S DIR("A")="Enter a list or a range of numbers: "
"RTN","ZTBKC",71,0)
 S DIR(0)="L^"_"1:"_(%I-1)
"RTN","ZTBKC",72,0)
 W ! D ^DIR
"RTN","ZTBKC",73,0)
 Q:$D(DTOUT)!$D(DIRUT)
"RTN","ZTBKC",74,0)
 W !
"RTN","ZTBKC",75,0)
 F %I=1:1 S %A=$P(Y,",",%I) Q:%A']""  Q:(%A'=+%A)  K ZTBKCLST(%A) W "."
"RTN","ZTBKC",76,0)
 S %A=$O(ZTBKCLST("")) I %A="" D  Q
"RTN","ZTBKC",77,0)
 . F %I=0:0 S %I=$O(^XUTL($J,%I)) Q:%I'>0  Q:%I'=+%I  K ^XUTL($J,%I)
"RTN","ZTBKC",78,0)
 . S XX1=0
"RTN","ZTBKC",79,0)
 F %I=1:1 Q:%A']""&($G(^XUTL($J,%I))']"")  D
"RTN","ZTBKC",80,0)
 . I %A]"" S ^XUTL($J,%I)=ZTBKCLST(%A),%A=$O(ZTBKCLST(%A))
"RTN","ZTBKC",81,0)
 . E  K ^XUTL($J,%I)
"RTN","ZTBKC",82,0)
 S XX1=$O(XUTL($J,"@"),-1) I XX1'=+XX1 S XX1=0
"RTN","ZTBKC",83,0)
 Q
"RTN","ZTBKC",84,0)
XTNDHELP ;Extended help
"RTN","ZTBKC",85,0)
 I '$D(IOF) D HOME^%ZIS
"RTN","ZTBKC",86,0)
 W @IOF,!,?35,"More Help",!
"RTN","ZTBKC",87,0)
 W !,?10,"Globals that contain commas in subscripts may not produce accurate"
"RTN","ZTBKC",88,0)
 W !,?10,"block counts.  Also, avoid specifying full global references"
"RTN","ZTBKC",89,0)
 W !,?10,"that contain commas in the subscripts when entering globals"
"RTN","ZTBKC",90,0)
 W !,?10,"at the 'Block Count for Global ^' prompt."
"RTN","ZTBKC",91,0)
 W !,?10,""
"RTN","ZTBKC",92,0)
 W !,?10,"After entering a double question mark ('??') response to the"
"RTN","ZTBKC",93,0)
 W !,?10,"'Block Count for Global ^' prompt, enter 'S' for a listing"
"RTN","ZTBKC",94,0)
 W !,?10,"of globals selected or 'D' to de-select globals from this list."
"RTN","ZTBKC",95,0)
 W ! K DIR S DIR(0)="E" D ^DIR
"RTN","ZTBKC",96,0)
 Q
"RTN","ZTBKC",97,0)
READY I '$D(ZTBKCALL),$O(^XUTL($J,0))'>0 D  G QUIT
"RTN","ZTBKC",98,0)
 . W !!,?20,"No globals have been selected!!!",!
"RTN","ZTBKC",99,0)
 W !,"Output results on" S %ZIS="Q" D ^%ZIS G QUIT:POP
"RTN","ZTBKC",100,0)
 I $D(IO("Q")) S ZTRTN=$S($D(ZTBKCALL):"ALL^%ZTBKC1",1:"DQ^%ZTBKC"),ZTDESC="Global block count",ZTSAVE("^XUTL($J,")="" D ^%ZTLOAD K ZTSK U IO(0) D ^%ZISC K ZTRTN,ZTDESC,ZTSAVE G QUIT
"RTN","ZTBKC",101,0)
 I $D(ZTBKCALL) U IO D ALL^%ZTBKC1 U IO(0) D ^%ZISC G QUIT
"RTN","ZTBKC",102,0)
DQ ;
"RTN","ZTBKC",103,0)
 U IO F XX1=0:0 S XX1=$O(^XUTL($J,XX1)) Q:XX1'>0  S %T=^(XX1),%BS=$P(%T,U,1),X=$P(%T,U,2) W !,"Global ^",%BS D ENCOUNT W $S(X'>0:" doesn't exist",1:" has "_X_" data block") W:X>1 "s"
"RTN","ZTBKC",104,0)
QUIT U:$D(IO(0))#2 IO(0) D ^%ZISC K DIR,X,XX1,Y,ZTBKCALL,%A,%I,%T,%U,%Z,%BS I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ZTBKC",105,0)
 Q
"RTN","ZTBKC",106,0)
ALL ;All Globals in Directory
"RTN","ZTBKC",107,0)
 S %A=$P(^%ZOSF("OS"),"^",1)
"RTN","ZTBKC",108,0)
 D ALL^%ZTBKC1 G ALLEXIT
"RTN","ZTBKC",109,0)
 ;I %A="DSM-3" D ALL^%ZTBKC1 G ALLEXIT
"RTN","ZTBKC",110,0)
 ;I %A="M/11" D ALLM11 G ALLEXIT
"RTN","ZTBKC",111,0)
 ;I %A="M/11+" D ALL^%ZTBKC1 G ALLEXIT
"RTN","ZTBKC",112,0)
 ;I %A="M/VX" D ALL^%ZTBKC1 G ALLEXIT
"RTN","ZTBKC",113,0)
 ;I %A["MSM" D ALL^%ZTBKC1 G ALLEXIT
"RTN","ZTBKC",114,0)
 ;I %A["VAX DSM" G ALL^%ZTBKC1
"RTN","ZTBKC",115,0)
ALLEXIT K %A
"RTN","ZTBKC",116,0)
 Q
"RTN","ZTBKC",117,0)
ALLM11 ;Directory at
"RTN","ZTBKC",118,0)
 W $C(7),"  NOT AVAILABLE!!!!"
"RTN","ZTBKC",119,0)
 Q
"RTN","ZTBKC",120,0)
ENCOUNT ;  X = Full Global Reference: NAME(SUB1,...,SUBn)
"RTN","ZTBKC",121,0)
 ;  Surrounding/doubled quotes should have been removed from subscripts
"RTN","ZTBKC",122,0)
 ;  The count is not accurate for subscripts containing commas
"RTN","ZTBKC",123,0)
 S %T=-1,%A=$P(^%ZOSF("OS"),"^") I X?1"^".E S X=$E(X,2,255)
"RTN","ZTBKC",124,0)
 D ^%ZTBKC1
"RTN","ZTBKC",125,0)
 ;I "^MSM-UNIX^MSM-PC^VAX DSM(V5)^DSM-3^M/11^M/11+^M/VX^"[("^"_%A_"^") D ^%ZTBKC1
"RTN","ZTBKC",126,0)
EXIT S X=%T K %A,%T
"RTN","ZTBKC",127,0)
 Q
"RTN","ZTBKCONT")
0^2^B70500658^n/a
"RTN","ZTBKCONT",1,0)
%ZTBKC1 ;SF/GJL,SFCIOFO/AC - OPEN M BLOCK COUNT ;06/05/2007  1720232.438851
"RTN","ZTBKCONT",2,0)
 ;;7.3;TOOLKIT;**80**;Apr 25, 1995;Build 6
"RTN","ZTBKCONT",3,0)
 ;
"RTN","ZTBKCONT",4,0)
 I $$ONAPPSVR G EXIT
"RTN","ZTBKCONT",5,0)
 O 63::0 E  S %T="The VIEW device is busy." G EXIT
"RTN","ZTBKCONT",6,0)
 S %G=$G(^XUTL($J,"ZTBKCDIR"))
"RTN","ZTBKCONT",7,0)
 I %G="" D
"RTN","ZTBKCONT",8,0)
 .S %G=$ZU(12,"")
"RTN","ZTBKCONT",9,0)
 .S ^XUTL($J,"ZTBKCDIR")=%G
"RTN","ZTBKCONT",10,0)
 S %B=$ZU(49,%G),%ZTBKBDB=$P(%B,",",21),%B=$P(%B,",",7) G EXIT:'%B
"RTN","ZTBKCONT",11,0)
 ;%B=directory block--Not used here.
"RTN","ZTBKCONT",12,0)
 O 63:"^^"_%G
"RTN","ZTBKCONT",13,0)
ONTGD ;FIND AND PARSE GLOBAL DIRECTORY BLOCK
"RTN","ZTBKCONT",14,0)
 ;The global directory block is not parsed here.
"RTN","ZTBKCONT",15,0)
 ;We use Cache's APIs/Extrinsic functions to obtain the
"RTN","ZTBKCONT",16,0)
 ;first data block of the selected global root.
"RTN","ZTBKCONT",17,0)
 ;===============================
"RTN","ZTBKCONT",18,0)
 N %ZTBKNSP S %ZTBKNSP="^^"_%G
"RTN","ZTBKCONT",19,0)
 I $G(%ZTBKVER)']"" S %ZTBKVER=$P($$VERSION^%ZOSV,".",1,2)
"RTN","ZTBKCONT",20,0)
 I $G(%BS)]"" S X=%BS
"RTN","ZTBKCONT",21,0)
 S %ZTBKGLO="^"_X,%A="^["""_%ZTBKNSP_"""]"_X
"RTN","ZTBKCONT",22,0)
 I '$D(@%A) G EXIT
"RTN","ZTBKCONT",23,0)
 I %ZTBKVER="5.0" D  I 1
"RTN","ZTBKCONT",24,0)
 . S %=$$GetGlobalPointers^%DM(%G,%ZTBKGLO,.%ZTBKTOP,.%B)
"RTN","ZTBKCONT",25,0)
 E  S %=$$GetGlobalPointers^%SYS.DATABASE(%G,%ZTBKGLO,.%ZTBKTOP,.%B)
"RTN","ZTBKCONT",26,0)
 V %B
"RTN","ZTBKCONT",27,0)
 I % S %O=1,%E=$V(%O*2-1,-6),%H=0,%J=0,%T=0 G ONTDATA
"RTN","ZTBKCONT",28,0)
 G EXIT
"RTN","ZTBKCONT",29,0)
ONTPTBK ;POINTER BLOCK
"RTN","ZTBKCONT",30,0)
 ;Not used here
"RTN","ZTBKCONT",31,0)
ONTPTLP ;POINTER BLOCK LOOP
"RTN","ZTBKCONT",32,0)
 ;Not used here
"RTN","ZTBKCONT",33,0)
 G EXIT
"RTN","ZTBKCONT",34,0)
ONTPTNT ;PROCESS NODES IN POINTER BLOCK
"RTN","ZTBKCONT",35,0)
 ;Not used here
"RTN","ZTBKCONT",36,0)
ONTPTDW ;SAVE OFF LAST DOWN LINK BLOCK FOR LATER USE
"RTN","ZTBKCONT",37,0)
 ;Not used here
"RTN","ZTBKCONT",38,0)
 ;
"RTN","ZTBKCONT",39,0)
ONTDTBK ;DATA BLOCK
"RTN","ZTBKCONT",40,0)
 V %B
"RTN","ZTBKCONT",41,0)
 S %O=1,%E=$V(%O*2-1,-6),%T=%T+1,%J=0
"RTN","ZTBKCONT",42,0)
ONTDATA ;DATA BLOCK LOOP TO PROCESS NODES
"RTN","ZTBKCONT",43,0)
 I %E'="" G ONTDTNT
"RTN","ZTBKCONT",44,0)
 S %B=$CASE(%ZTBKBDB,0:$V(2040,0,"3O"),:$V($ZUTIL(40,32,4),0,4)) I %B G ONTDTBK
"RTN","ZTBKCONT",45,0)
 G EXIT
"RTN","ZTBKCONT",46,0)
ONTDTNT ;PROCESS DATA NODES
"RTN","ZTBKCONT",47,0)
 S %J=%J+1 D ONTNODE I %I=1 S:%H=0 %T=%T+1 D ONTSTBIG S %H=1,%E="" G ONTDATA ;Next BLK
"RTN","ZTBKCONT",48,0)
 I %I=2 S %O=%O+1 G ONTDATA
"RTN","ZTBKCONT",49,0)
 S:%J=1 %T=%T-1 G EXIT
"RTN","ZTBKCONT",50,0)
 G EXIT
"RTN","ZTBKCONT",51,0)
ONTNODE ;BUILD STRINGS TO COMPARE SUBSCRIPTS
"RTN","ZTBKCONT",52,0)
 S %F=$V(%O*2-1,-5),%M=$P(%F,"(",2),%M=$P(%M,")",1),%M=","_%M
"RTN","ZTBKCONT",53,0)
 G ONTTSTN
"RTN","ZTBKCONT",54,0)
ONTPROC ;PROCESS ENCODED DATA
"RTN","ZTBKCONT",55,0)
 ;Not used here
"RTN","ZTBKCONT",56,0)
ONTASCI ;PROCESS ASCII CHAR
"RTN","ZTBKCONT",57,0)
 ;Not used here
"RTN","ZTBKCONT",58,0)
ONTPOS ;PROCESS POSITIVE DATA
"RTN","ZTBKCONT",59,0)
 ;Not used here
"RTN","ZTBKCONT",60,0)
ONTNEG ;PROCESS NEGATIVE DATA
"RTN","ZTBKCONT",61,0)
 ;Not used here
"RTN","ZTBKCONT",62,0)
ONTTSTN S %M=$E(%M,2,256),%S=$P(X,"(",2),%S=$P(%S,")",1) I (%S="")!(%S=%M) S %I=1 Q
"RTN","ZTBKCONT",63,0)
ONTTSTL S %X=$P(%S,",",1),%Y=$P(%M,",",1) I +%X'=%X G ONTSTR
"RTN","ZTBKCONT",64,0)
 I %Y="" S %I=2 Q
"RTN","ZTBKCONT",65,0)
 I +%Y'=%Y S %I=3 Q
"RTN","ZTBKCONT",66,0)
 I %X>%Y S %I=2 Q
"RTN","ZTBKCONT",67,0)
 I %X<%Y S %I=3 Q
"RTN","ZTBKCONT",68,0)
ONTTSTC S %S=$P(%S,",",2,256) I %S="" S %I=1 Q
"RTN","ZTBKCONT",69,0)
 S %M=$P(%M,",",2,256) I %M="" S %I=2 Q
"RTN","ZTBKCONT",70,0)
 G ONTTSTL
"RTN","ZTBKCONT",71,0)
ONTSTR I +%Y=%Y S %I=2 Q
"RTN","ZTBKCONT",72,0)
 I %X]%Y S %I=2 Q
"RTN","ZTBKCONT",73,0)
 I %X'=%Y S %I=3 Q
"RTN","ZTBKCONT",74,0)
 G ONTTSTC
"RTN","ZTBKCONT",75,0)
ONTSTBIG ;Check for big strings
"RTN","ZTBKCONT",76,0)
 S %ZTBKEND=0
"RTN","ZTBKCONT",77,0)
 F %A=%O:1 S %E=$V(%A*2-1,-6) Q:%E=""  D  Q:%ZTBKEND
"RTN","ZTBKCONT",78,0)
 . S %ZTBKCY=$V(%A*2-1,-5)
"RTN","ZTBKCONT",79,0)
 . S %ZTBKCY1=$QL($NA(@%ZTBKCY))
"RTN","ZTBKCONT",80,0)
 . S %ZTBKCX=$NA(@("^"_X))
"RTN","ZTBKCONT",81,0)
 . S %ZTBKCX1=$QL($NA(@%ZTBKCX))
"RTN","ZTBKCONT",82,0)
 . I %ZTBKCX1>%ZTBKCY1 S %ZTBKEND=1 Q
"RTN","ZTBKCONT",83,0)
 . I $NA(@%ZTBKCX)'=$NA(@%ZTBKCY,%ZTBKCX1) S %ZTBKEND=1 Q
"RTN","ZTBKCONT",84,0)
 . S %ZTBKCY=$V(%A*2,-6)
"RTN","ZTBKCONT",85,0)
 . I $A(%ZTBKCY)'=5,($A(%ZTBKCY)'=$CASE(%ZTBKBDB,0:9,:7)),($A(%ZTBKCY)'=3) Q
"RTN","ZTBKCONT",86,0)
 . S %ZTBKCX=$P(%ZTBKCY,",",2),%ZTBKCX1=$P(%ZTBKCY,",",3)
"RTN","ZTBKCONT",87,0)
 . S %T=%T+(%ZTBKCX-1)+''%ZTBKCX1
"RTN","ZTBKCONT",88,0)
 . Q
"RTN","ZTBKCONT",89,0)
 Q
"RTN","ZTBKCONT",90,0)
ASKDIR ;Ask directory/data set name
"RTN","ZTBKCONT",91,0)
 N %A,%I,DEND,DIRNAM,GD
"RTN","ZTBKCONT",92,0)
 I $G(%ZTBKVER)']"" S %ZTBKVER=$P($$VERSION^%ZOSV,".",1,2)
"RTN","ZTBKCONT",93,0)
 I %ZTBKVER="5.0"!(%ZTBKVER'<5.2) D ASK I 1
"RTN","ZTBKCONT",94,0)
 E  W !,"An error has just occurred!" Q
"RTN","ZTBKCONT",95,0)
 I $G(DUOUT)=1 Q
"RTN","ZTBKCONT",96,0)
 I $G(DIRNAM)']"" S DUOUT=1 Q
"RTN","ZTBKCONT",97,0)
 S ^XUTL($J,"ZTBKCDIR")=DIRNAM
"RTN","ZTBKCONT",98,0)
 Q
"RTN","ZTBKCONT",99,0)
ASK ; Enter here to select default directory
"RTN","ZTBKCONT",100,0)
 N %ZTBKERR,%ZTBKEC S %ZTBKERR=0
"RTN","ZTBKCONT",101,0)
 I $$ONAPPSVR D  Q
"RTN","ZTBKCONT",102,0)
 . S DUOUT=1
"RTN","ZTBKCONT",103,0)
 . W !,"Note:  You are attempting to run this utility"
"RTN","ZTBKCONT",104,0)
 . W !,?7,"on a Cache' ECP Application Server."
"RTN","ZTBKCONT",105,0)
 . W !,?7,"This utility will not run on an ECP Application Server."
"RTN","ZTBKCONT",106,0)
 . W !,?7,"Please try running this utility again on an ECP Data Server."
"RTN","ZTBKCONT",107,0)
 D
"RTN","ZTBKCONT",108,0)
 . N $ETRAP,$ESTACK S $ETRAP="D ERROR^%ZTBKC1"
"RTN","ZTBKCONT",109,0)
 . D RDCHK
"RTN","ZTBKCONT",110,0)
 I %ZTBKERR=1 D ASKBYAPI Q
"RTN","ZTBKCONT",111,0)
 I %ZTBKERR=2 D  Q
"RTN","ZTBKCONT",112,0)
 . S DUOUT=1
"RTN","ZTBKCONT",113,0)
 . W !,"The following error just occurred:"
"RTN","ZTBKCONT",114,0)
 . W !,%ZTBKEC
"RTN","ZTBKCONT",115,0)
 S DIRNAM=$ZU(12,"")
"RTN","ZTBKCONT",116,0)
 K DIR S DIR(0)="Y",DIR("B")="YES"
"RTN","ZTBKCONT",117,0)
 S DIR("A")="Use default directory"
"RTN","ZTBKCONT",118,0)
 S DIR("A",1)="Default directory is "_DIRNAM
"RTN","ZTBKCONT",119,0)
 S DIR("?")="^D HELP^%ZTBKC1"
"RTN","ZTBKCONT",120,0)
 D ^DIR
"RTN","ZTBKCONT",121,0)
 Q:$D(DTOUT)!$D(DIRUT)
"RTN","ZTBKCONT",122,0)
 I 'Y D ASK2
"RTN","ZTBKCONT",123,0)
 Q
"RTN","ZTBKCONT",124,0)
ASK2 ; Enter here to select directory from a list
"RTN","ZTBKCONT",125,0)
 N MGDIR,ZTBKCDIR
"RTN","ZTBKCONT",126,0)
 K DIR S DIR("A",1)="Select a number from the following:"
"RTN","ZTBKCONT",127,0)
 S %U="",MGDIR="%SYS" F %I=1:1 S %U=$O(^|MGDIR|SYS("UCI",%U)) Q:%U=""  D
"RTN","ZTBKCONT",128,0)
 .  S DIR("A",%I+1)="   "_$J(%I,3)_"      "_%U
"RTN","ZTBKCONT",129,0)
 .  S ZTBKCDIR(%I)=%U
"RTN","ZTBKCONT",130,0)
 .  I %U=DIRNAM S DIR("B")=%I
"RTN","ZTBKCONT",131,0)
 S DIR("A")="Enter a number "
"RTN","ZTBKCONT",132,0)
 S DIR(0)="N^"_"1:"_(%I-1)
"RTN","ZTBKCONT",133,0)
 W ! D ^DIR
"RTN","ZTBKCONT",134,0)
 Q:$D(DTOUT)!$D(DIRUT)
"RTN","ZTBKCONT",135,0)
 S DIRNAM=ZTBKCDIR(Y)
"RTN","ZTBKCONT",136,0)
 Q
"RTN","ZTBKCONT",137,0)
RDCHK ; Check to see if ^SYS global is readable with current privs.
"RTN","ZTBKCONT",138,0)
 N %U,MGDIR
"RTN","ZTBKCONT",139,0)
 S %U="",MGDIR="%SYS"
"RTN","ZTBKCONT",140,0)
 S %U=$O(^|MGDIR|SYS("UCI",%U))
"RTN","ZTBKCONT",141,0)
 Q
"RTN","ZTBKCONT",142,0)
ONAPPSVR() ;Check to see if this utility is run from an ECP Application Server
"RTN","ZTBKCONT",143,0)
 Q ($ZU(12,"")="")
"RTN","ZTBKCONT",144,0)
 ;
"RTN","ZTBKCONT",145,0)
ASKBYAPI ;
"RTN","ZTBKCONT",146,0)
 W !,"Note:  You do not have adequate privileges to view the ^SYS global."
"RTN","ZTBKCONT",147,0)
 W !,?7,"Therefore, a directory listing will not be available"
"RTN","ZTBKCONT",148,0)
 W !,?7,"at the directory prompt."
"RTN","ZTBKCONT",149,0)
 W !!,?7,"Also, Cache's API will be used to prompt for directory.",!!
"RTN","ZTBKCONT",150,0)
 I $G(%ZTBKVER)']"" S %ZTBKVER=$P($$VERSION^%ZOSV,".",1,2)
"RTN","ZTBKCONT",151,0)
 I %ZTBKVER="5.0" D ASK^%FILE I 1
"RTN","ZTBKCONT",152,0)
 E  I %ZTBKVER'<5.2 D ASK^%SYS.FILE I 1
"RTN","ZTBKCONT",153,0)
 E  W !,"An error has just occurred!" Q
"RTN","ZTBKCONT",154,0)
 Q
"RTN","ZTBKCONT",155,0)
HELP ;Single question mark help for 'Use default directory' prompt
"RTN","ZTBKCONT",156,0)
 W !,"Enter either 'Y' or 'N'."
"RTN","ZTBKCONT",157,0)
 W !!,"If you enter 'N' for 'NO', you may then select a directory from a list."
"RTN","ZTBKCONT",158,0)
 W !,"Block count on globals will only be returned for globals that reside"
"RTN","ZTBKCONT",159,0)
 W !,"in the selected directory."
"RTN","ZTBKCONT",160,0)
 Q
"RTN","ZTBKCONT",161,0)
ERROR ; Error trap for disconnect error and return back to the read loop.
"RTN","ZTBKCONT",162,0)
 S $ETRAP="D UNWIND^%ZTER"
"RTN","ZTBKCONT",163,0)
 S %ZTBKEC=$$EC^%ZOSV
"RTN","ZTBKCONT",164,0)
 I %ZTBKEC["PROTECT" S %ZTBKERR=1 D UNWIND^%ZTER Q
"RTN","ZTBKCONT",165,0)
 S %ZTBKERR=2 D ^%ZTER
"RTN","ZTBKCONT",166,0)
 D UNWIND^%ZTER
"RTN","ZTBKCONT",167,0)
 Q
"RTN","ZTBKCONT",168,0)
%Z3 N X S PG=PG+1,ST=0 D:(PG>1)&%ZTBIOC2&%ZTBIOC %Z5 Q:ST
"RTN","ZTBKCONT",169,0)
 U IO W:((9+$Y'<IOSL)&($Y>3))!(PG>1) @IOF
"RTN","ZTBKCONT",170,0)
 S %SK=$X W ?(%SK+25),"Global Block Count  ",$S(PG>1:"(cont.)",1:""),?(%SK+60),"Page ",PG
"RTN","ZTBKCONT",171,0)
 W !,$G(^XUTL($J,"ZTBKCDIR")),"  " S %SK=$X+1 W "Globals",?(%SK+12),"Data Blocks"
"RTN","ZTBKCONT",172,0)
 W ?(%SK+34),%ZTBKCDT W !
"RTN","ZTBKCONT",173,0)
 Q
"RTN","ZTBKCONT",174,0)
%Z5 U IO(0) R !,"Press RETURN to continue or '^' to exit: ",ST:600 S ST=$S(ST["^":1,1:0) S:ST %GLO="zzzz" ;SET SOME VARIABLE TO STOP LOOP
"RTN","ZTBKCONT",175,0)
 Q
"RTN","ZTBKCONT",176,0)
DD S:Y Y=$S($E(Y,4,5):$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",+$E(Y,4,5))_" ",1:"")_$S($E(Y,6,7):+$E(Y,6,7)_",",1:"")_($E(Y,1,3)+1700)_$P("@"_$E(Y_0,9,10)_":"_$E(Y_"000",11,12),"^",Y[".")
"RTN","ZTBKCONT",177,0)
 Q
"RTN","ZTBKCONT",178,0)
ALL ;Entry point for block count of all globals.
"RTN","ZTBKCONT",179,0)
ALLONT ;Directory at ^UTILITY("GLO")
"RTN","ZTBKCONT",180,0)
 K ^UTILITY("%ZTBKC",$J)
"RTN","ZTBKCONT",181,0)
 O 63::0 E  S %T="The VIEW device is busy." G EXIT
"RTN","ZTBKCONT",182,0)
 S %G=$G(^XUTL($J,"ZTBKCDIR"))
"RTN","ZTBKCONT",183,0)
 I %G="" D
"RTN","ZTBKCONT",184,0)
 .S %G=$ZU(12,"")
"RTN","ZTBKCONT",185,0)
 .S ^XUTL($J,"ZTBKCDIR")=%G
"RTN","ZTBKCONT",186,0)
 S %B=$ZU(49,%G),%B=$P(%B,",",7) G EXIT:'%B
"RTN","ZTBKCONT",187,0)
 O 63:"^^"_%G
"RTN","ZTBKCONT",188,0)
 N ST,PG
"RTN","ZTBKCONT",189,0)
 S %ZTBIOC=(IO=IO(0)),%ZTBIOC2=$E(IOST,1,2)["C-"
"RTN","ZTBKCONT",190,0)
 U IO W:%ZTBIOC2 @IOF I '%ZTBIOC,'$D(ZTQUEUED) U IO(0) W !!,"Printing report..."
"RTN","ZTBKCONT",191,0)
 S %ZTBKCZY=IOSL-(255\IOM+1) K %D,%T,%TIM
"RTN","ZTBKCONT",192,0)
AONTVUE V %B S %ZTBKCG=""
"RTN","ZTBKCONT",193,0)
 S %ZTBKSIZ=$P($ZU(49,%G),",",2)
"RTN","ZTBKCONT",194,0)
 S %ZTBKBIG=$CASE(%ZTBKSIZ,2048:0,:1)
"RTN","ZTBKCONT",195,0)
 S %ZTBKCL=$CASE(%ZTBKBIG,0:$V(2040,0,"3O"),:$V($ZUTIL(40,32,4),0,4))
"RTN","ZTBKCONT",196,0)
 S %E=$CASE(%ZTBKBIG,0:$V(2046,0,2),:$V($ZU(40,32,0),0,4)+$ZU(40,32,10))
"RTN","ZTBKCONT",197,0)
 I %E>%ZTBKSIZ G EXIT
"RTN","ZTBKCONT",198,0)
 S %O=$CASE(%ZTBKBIG,0:0,:$ZU(40,32,10))
"RTN","ZTBKCONT",199,0)
AONTNXT G AONTPTR:%E'>%O
"RTN","ZTBKCONT",200,0)
 S %ZTBKA=%O,%ZTBKRAW=$V(%ZTBKA,0,4),%ZTBKINF=$ZU(167,0,0,%ZTBKRAW)
"RTN","ZTBKCONT",201,0)
 S %ZTBKA=%ZTBKA+4
"RTN","ZTBKCONT",202,0)
 S %ZTBKCCC=$P(%ZTBKINF,"^",3),%ZTBKLEN=$P(%ZTBKINF,"^",4)
"RTN","ZTBKCONT",203,0)
 S %ZTBKPAD=$P(%ZTBKINF,"^",5),%ZTBKSUB=$P(%ZTBKINF,"^",2)
"RTN","ZTBKCONT",204,0)
 S %ZTBKCG="" I %ZTBKCCC S %ZTBKCG=$E(%ZTBKPRV,1,%ZTBKCCC)
"RTN","ZTBKCONT",205,0)
 S %ZTBKCE=%ZTBKA+%ZTBKSUB-1,%O=%ZTBKA
"RTN","ZTBKCONT",206,0)
AONTLOP S %Z=$V(%O,0),%O=%O+1 S:%Z %ZTBKCG=%ZTBKCG_$C(%Z) G AONTLOP:(%O'>%ZTBKCE)
"RTN","ZTBKCONT",207,0)
 S ^UTILITY("%ZTBKC",$J,%ZTBKCG)=""
"RTN","ZTBKCONT",208,0)
 S %ZTBKPRV=%ZTBKCG,%O=%ZTBKCE+%ZTBKLEN-%ZTBKSUB-3,%ZTBKCG="" G AONTNXT
"RTN","ZTBKCONT",209,0)
AONTPTR S %B=%ZTBKCL I %B G AONTVUE
"RTN","ZTBKCONT",210,0)
 D NOW^%DTC S Y=% D DD S %ZTBKCDT=Y
"RTN","ZTBKCONT",211,0)
 S PG=0 D %Z3
"RTN","ZTBKCONT",212,0)
 S (%TOT,%GLO)=0 F %II=1:1 S X=$O(^UTILITY("%ZTBKC",$J,%GLO)),%GLO=X Q:X=""  D:%ZTBKCZY'>$Y %Z3 Q:$G(ST)  S:X?1"^".E X=$E(X,2,255) W !,?%SK,X,?(%SK+15) S %T=-1 D %ZTBKC1 S X=%T S:X>0 %TOT=%TOT+X W:X<0 "-- no such global --" W:X'<0 X
"RTN","ZTBKCONT",213,0)
 W !!?%SK,"Total",?(%SK+15),%TOT K %GLO,%II,%SK,%T,%TOT,%ZTBIOC,%ZTBIOC2,%ZTBKCDT,%ZTBKCZY,X,Y U IO(0) D ^%ZISC
"RTN","ZTBKCONT",214,0)
EXIT C 63 K %,%A,%B,%C,%D,%E,%F,%G,%H,%I,%J,%K,%L,%M,%N,%O,%S,%V,%W,%X,%Y,%Z,%ST
"RTN","ZTBKCONT",215,0)
 K %ZTBKA,%ZTBKBDB,%ZTBKBIG,%ZTBKCCC,%ZTBKCE,%ZTBKCG,%ZTBKCL,%ZTBKCX,%ZTBKCX1,%ZTBKCY,%ZTBKCY1,%ZTBKEND,%ZTBKGLO,%ZTBKINF,%ZTBKLEN,%ZTBKPAD,%ZTBKPRV,%ZTBKRAW,%ZTBKSIZ,%ZTBKSUB,%ZTBKTOP,%ZTBKVER
"VER")
8.0^22.0
"BLD",784,6)
^85
**END**
**END**
