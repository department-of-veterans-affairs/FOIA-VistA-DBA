Released WV*1*3 SEQ #3
Extracted from mail message
**KIDS**:WV*1.0*3^

**INSTALL NAME**
WV*1.0*3
"BLD",1407,0)
WV*1.0*3^WOMEN'S HEALTH^0^2981216^y
"BLD",1407,1,0)
^^2^2^2981215^^
"BLD",1407,1,1,0)
This patch fixes several reported bugs. Please see the patch description
"BLD",1407,1,2,0)
for WV*1*3 on FORUM for a full description of this patch.
"BLD",1407,4,0)
^9.64PA^790.07^1
"BLD",1407,4,790.07,0)
790.07
"BLD",1407,4,790.07,2,0)
^9.641^790.07^1
"BLD",1407,4,790.07,2,790.07,0)
WV REFERRAL SOURCE  (File-top level)
"BLD",1407,4,790.07,2,790.07,1,0)
^9.6411^2^1
"BLD",1407,4,790.07,2,790.07,1,2,0)
UPPERCASE REFERRAL SOURCE
"BLD",1407,4,790.07,222)
y^n^p^^^^n
"BLD",1407,4,"APDD",790.07,790.07)

"BLD",1407,4,"APDD",790.07,790.07,2)

"BLD",1407,4,"B",790.07,790.07)

"BLD",1407,"ABPKG")
n
"BLD",1407,"INI")
WV3PRE
"BLD",1407,"KRN",0)
^9.67PA^19^18
"BLD",1407,"KRN",.4,0)
.4
"BLD",1407,"KRN",.401,0)
.401
"BLD",1407,"KRN",.402,0)
.402
"BLD",1407,"KRN",.403,0)
.403
"BLD",1407,"KRN",.5,0)
.5
"BLD",1407,"KRN",.84,0)
.84
"BLD",1407,"KRN",3.6,0)
3.6
"BLD",1407,"KRN",3.8,0)
3.8
"BLD",1407,"KRN",9.2,0)
9.2
"BLD",1407,"KRN",9.8,0)
9.8
"BLD",1407,"KRN",9.8,"NM",0)
^9.68A^14^14
"BLD",1407,"KRN",9.8,"NM",1,0)
WVGETALL^^0^B53798573
"BLD",1407,"KRN",9.8,"NM",2,0)
WVLOGO^^0^B4256995
"BLD",1407,"KRN",9.8,"NM",3,0)
WVRPSCR^^0^B16907036
"BLD",1407,"KRN",9.8,"NM",4,0)
WVRPSCR1^^0^B37305741
"BLD",1407,"KRN",9.8,"NM",5,0)
WVUTL8^^0^B22617280
"BLD",1407,"KRN",9.8,"NM",6,0)
WVUTL6^^0^B10613351
"BLD",1407,"KRN",9.8,"NM",7,0)
WVEXPTRA^^0^B39121220
"BLD",1407,"KRN",9.8,"NM",8,0)
WVRALINK^^0^B42490814
"BLD",1407,"KRN",9.8,"NM",9,0)
WVREFUSE^^0^B10341963
"BLD",1407,"KRN",9.8,"NM",10,0)
WVPATE^^0^B8086420
"BLD",1407,"KRN",9.8,"NM",11,0)
WVPROC^^0^B39556908
"BLD",1407,"KRN",9.8,"NM",12,0)
WVLAB^^0^B2255617
"BLD",1407,"KRN",9.8,"NM",13,0)
WV3PRE^^0^B1194890
"BLD",1407,"KRN",9.8,"NM",14,0)
WVUTL9^^0^B1550098
"BLD",1407,"KRN",9.8,"NM","B","WV3PRE",13)

"BLD",1407,"KRN",9.8,"NM","B","WVEXPTRA",7)

"BLD",1407,"KRN",9.8,"NM","B","WVGETALL",1)

"BLD",1407,"KRN",9.8,"NM","B","WVLAB",12)

"BLD",1407,"KRN",9.8,"NM","B","WVLOGO",2)

"BLD",1407,"KRN",9.8,"NM","B","WVPATE",10)

"BLD",1407,"KRN",9.8,"NM","B","WVPROC",11)

"BLD",1407,"KRN",9.8,"NM","B","WVRALINK",8)

"BLD",1407,"KRN",9.8,"NM","B","WVREFUSE",9)

"BLD",1407,"KRN",9.8,"NM","B","WVRPSCR",3)

"BLD",1407,"KRN",9.8,"NM","B","WVRPSCR1",4)

"BLD",1407,"KRN",9.8,"NM","B","WVUTL6",6)

"BLD",1407,"KRN",9.8,"NM","B","WVUTL8",5)

"BLD",1407,"KRN",9.8,"NM","B","WVUTL9",14)

"BLD",1407,"KRN",19,0)
19
"BLD",1407,"KRN",19.1,0)
19.1
"BLD",1407,"KRN",101,0)
101
"BLD",1407,"KRN",409.61,0)
409.61
"BLD",1407,"KRN",771,0)
771
"BLD",1407,"KRN",869.2,0)
869.2
"BLD",1407,"KRN",870,0)
870
"BLD",1407,"KRN",8994,0)
8994
"BLD",1407,"KRN","B",.4,.4)

"BLD",1407,"KRN","B",.401,.401)

"BLD",1407,"KRN","B",.402,.402)

"BLD",1407,"KRN","B",.403,.403)

"BLD",1407,"KRN","B",.5,.5)

"BLD",1407,"KRN","B",.84,.84)

"BLD",1407,"KRN","B",3.6,3.6)

"BLD",1407,"KRN","B",3.8,3.8)

"BLD",1407,"KRN","B",9.2,9.2)

"BLD",1407,"KRN","B",9.8,9.8)

"BLD",1407,"KRN","B",19,19)

"BLD",1407,"KRN","B",19.1,19.1)

"BLD",1407,"KRN","B",101,101)

"BLD",1407,"KRN","B",409.61,409.61)

"BLD",1407,"KRN","B",771,771)

"BLD",1407,"KRN","B",869.2,869.2)

"BLD",1407,"KRN","B",870,870)

"BLD",1407,"KRN","B",8994,8994)

"BLD",1407,"QUES",0)
^9.62^^
"BLD",1407,"REQB",0)
^9.611^^
"FIA",790.07)
WV REFERRAL SOURCE
"FIA",790.07,0)
^WV(790.07,
"FIA",790.07,0,0)
790.07s
"FIA",790.07,0,1)
y^n^p^^^^n
"FIA",790.07,0,10)

"FIA",790.07,0,11)

"FIA",790.07,0,"RLRO")

"FIA",790.07,0,"VR")
1.0^WV
"FIA",790.07,790.07)
1
"FIA",790.07,790.07,2)

"INI")
WV3PRE
"PKG",364,-1)
1^1
"PKG",364,0)
WOMEN'S HEALTH^WV^Tracks health issues specific to female patients.
"PKG",364,20,0)
^9.402P^^
"PKG",364,22,0)
^9.49I^1^1
"PKG",364,22,1,0)
1.0^2980925^2980508^547
"PKG",364,22,1,"PAH",1,0)
3^2981216
"PKG",364,22,1,"PAH",1,1,0)
^^2^2^2981215
"PKG",364,22,1,"PAH",1,1,1,0)
This patch fixes several reported bugs. Please see the patch description
"PKG",364,22,1,"PAH",1,1,2,0)
for WV*1*3 on FORUM for a full description of this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","WV3PRE")
0^13^B1194890
"RTN","WV3PRE",1,0)
WV3PRE ;HCIOFO/FT-Patch Pre-Installation Routine ;12/14/98  16:03
"RTN","WV3PRE",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WV3PRE",3,0)
 ;
"RTN","WV3PRE",4,0)
PAT3 ; Entry point for WV*1*3
"RTN","WV3PRE",5,0)
 D PATCH
"RTN","WV3PRE",6,0)
 Q
"RTN","WV3PRE",7,0)
PATCH ; Delete erroneous patch references in Package file (#9.4)
"RTN","WV3PRE",8,0)
 D FIND^DIC(9.4,"","","X","WV","","C","","","WVIEN","WVERR")
"RTN","WV3PRE",9,0)
 S WVDA=+$G(WVIEN("DILIST",2,1))
"RTN","WV3PRE",10,0)
 Q:'WVDA
"RTN","WV3PRE",11,0)
 K WVIEN,WVERR
"RTN","WV3PRE",12,0)
 D FIND^DIC(9.49,","_WVDA_",","","X","1.0","","","","","WVIEN","WVERR")
"RTN","WV3PRE",13,0)
 S WVDA1=+$G(WVIEN("DILIST",2,1))
"RTN","WV3PRE",14,0)
 Q:'WVDA1
"RTN","WV3PRE",15,0)
 F WVDA2=99,100,101,102 D
"RTN","WV3PRE",16,0)
 .K WVIEN,WVERR
"RTN","WV3PRE",17,0)
 .D FIND^DIC(9.4901,","_WVDA1_","_WVDA_",","","X",WVDA2,"","B","","","WVIEN","WVERR")
"RTN","WV3PRE",18,0)
 .S WVDA2=+$G(WVIEN("DILIST",2,1))
"RTN","WV3PRE",19,0)
 .Q:'WVDA2
"RTN","WV3PRE",20,0)
 .S DA=WVDA2,DA(1)=WVDA1,DA(2)=WVDA
"RTN","WV3PRE",21,0)
 .S DIK="^DIC(9.4,"_WVDA_",22,"_WVDA1_",""PAH"","
"RTN","WV3PRE",22,0)
 .D ^DIK
"RTN","WV3PRE",23,0)
 .Q
"RTN","WV3PRE",24,0)
 K WVDA,WVDA1,WVIEN,WVERR
"RTN","WV3PRE",25,0)
 Q
"RTN","WVEXPTRA")
0^7^B39121220
"RTN","WVEXPTRA",1,0)
WVEXPTRA ;HCIOFO/FT IHS/ANMC/MWR - EXPORT MAMS & BREAST ULTRASOUNDS TO WOMEN'S HEALTH  ;12/14/98  21:38
"RTN","WVEXPTRA",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WVEXPTRA",3,0)
 ;---> WVNEWP = TOTAL NEW WOMEN'S HEALTH PATIENTS ADDED.
"RTN","WVEXPTRA",4,0)
 ;---> WVMAM  = TOTAL NEW MAMMOGRAMS PROCEDURES ADDED.
"RTN","WVEXPTRA",5,0)
 ;
"RTN","WVEXPTRA",6,0)
EN1 ;
"RTN","WVEXPTRA",7,0)
 S WVPOP=0
"RTN","WVEXPTRA",8,0)
 D CHECK I WVPOP D KILL Q  ;check if site parameter entry exists
"RTN","WVEXPTRA",9,0)
 D DESC ;describe option
"RTN","WVEXPTRA",10,0)
 D DTRNG I WVPOP D KILL Q  ;get date range
"RTN","WVEXPTRA",11,0)
 D STATUS I WVPOP D KILL Q  ;select status of procedure
"RTN","WVEXPTRA",12,0)
 D VET I WVPOP D KILL Q  ;veterans/non-veterans
"RTN","WVEXPTRA",13,0)
 D QUEUE ;queue a background job
"RTN","WVEXPTRA",14,0)
 D KILL
"RTN","WVEXPTRA",15,0)
 Q
"RTN","WVEXPTRA",16,0)
EN2 ;
"RTN","WVEXPTRA",17,0)
 D CPTS ;get procedure pointers
"RTN","WVEXPTRA",18,0)
 D GET ;get RAD/NM data & store in WH
"RTN","WVEXPTRA",19,0)
 D MAIL ;send mail message to user
"RTN","WVEXPTRA",20,0)
 D KILL ;kill variables
"RTN","WVEXPTRA",21,0)
 Q
"RTN","WVEXPTRA",22,0)
DESC ; Describe option
"RTN","WVEXPTRA",23,0)
 W @IOF
"RTN","WVEXPTRA",24,0)
 W !,"This option searches the Radiology/Nuclear Medicine database for"
"RTN","WVEXPTRA",25,0)
 W !,"all female patients who had a mammogram or breast ultrasound exam"
"RTN","WVEXPTRA",26,0)
 W !,"(CPT codes are 76090, 76091, 76092 and 76645) during the date"
"RTN","WVEXPTRA",27,0)
 W !,"range you select. These procedures and patients will be added to"
"RTN","WVEXPTRA",28,0)
 W !,"the WH database if not already there.",!
"RTN","WVEXPTRA",29,0)
 W !,"This job will be queued as a background task so as to free up your"
"RTN","WVEXPTRA",30,0)
 W !,"terminal to do other work. You will receive a mail message when"
"RTN","WVEXPTRA",31,0)
 W !,"the job is done. The mail message will contain a count of the"
"RTN","WVEXPTRA",32,0)
 W !,"number of procedures and patients added.",!!
"RTN","WVEXPTRA",33,0)
 Q 
"RTN","WVEXPTRA",34,0)
CHECK ; Check if DUZ(2) exists for user, if entry exists in site parameter
"RTN","WVEXPTRA",35,0)
 ; file, if case manager, and if File 70 exists.
"RTN","WVEXPTRA",36,0)
 D CHECK^WVLOGO
"RTN","WVEXPTRA",37,0)
 I '$G(DUZ(2))!('$D(^WV(790.02,+DUZ(2),0))) S WVPOP=1
"RTN","WVEXPTRA",38,0)
 I '$P($G(^WV(790.02,+$G(DUZ(2)),0)),U,2) D
"RTN","WVEXPTRA",39,0)
 .D NODCM^WVUTL9
"RTN","WVEXPTRA",40,0)
 .S WVPOP=1
"RTN","WVEXPTRA",41,0)
 .Q
"RTN","WVEXPTRA",42,0)
 I '$D(^RADPT) W !,"There is no Radiology/Nuclear Medicine Patient file (#70)",! S WVPOP=1
"RTN","WVEXPTRA",43,0)
 Q
"RTN","WVEXPTRA",44,0)
DTRNG ; prompt for date range, go back three years maximum
"RTN","WVEXPTRA",45,0)
 S WVSTDT=DT-30000
"RTN","WVEXPTRA",46,0)
 K DIR S DIR(0)="DA^"_WVSTDT_":"_DT
"RTN","WVEXPTRA",47,0)
 S DIR("A")="Enter START DATE: "
"RTN","WVEXPTRA",48,0)
 S DIR("?")="Enter the earliest date of the mammograms/breast ultrasounds you wish to retrieve. You can begin your search at "_$$FMTE^XLFDT(WVSTDT,"D")_"."
"RTN","WVEXPTRA",49,0)
 D ^DIR K DIR
"RTN","WVEXPTRA",50,0)
 I $D(DIRUT) S WVPOP=1 Q
"RTN","WVEXPTRA",51,0)
 S WVSTDT=Y
"RTN","WVEXPTRA",52,0)
 S DIR(0)="DA^"_WVSTDT_":"_DT
"RTN","WVEXPTRA",53,0)
 S DIR("A")="Enter END DATE: ",DIR("B")=$$FMTE^XLFDT(DT,"D")
"RTN","WVEXPTRA",54,0)
 S DIR("?")="Enter the most recent date of the mammograms/breast ultrasounds you wish to retrieve."
"RTN","WVEXPTRA",55,0)
 D ^DIR K DIR
"RTN","WVEXPTRA",56,0)
 I $D(DIRUT) S WVPOP=1 Q
"RTN","WVEXPTRA",57,0)
 S WVENDT=Y
"RTN","WVEXPTRA",58,0)
 Q
"RTN","WVEXPTRA",59,0)
STATUS ; Select default status for procedures
"RTN","WVEXPTRA",60,0)
 K DIR
"RTN","WVEXPTRA",61,0)
 S DIR(0)="S^o:OPEN;c:CLOSED",DIR("A")="Select STATUS OF IMPORTED MAMMOGRAMS"
"RTN","WVEXPTRA",62,0)
 S DIR("?")="Enter 'O' to give a Status of OPEN to Mammograms imported from the Radiology Software into the Women's Health database. Enter 'C' to give a Status of CLOSED to imported Mammograms."
"RTN","WVEXPTRA",63,0)
 D ^DIR K DIR
"RTN","WVEXPTRA",64,0)
 I $D(DIRUT) S WVPOP=1
"RTN","WVEXPTRA",65,0)
 S WVSTATUS=Y
"RTN","WVEXPTRA",66,0)
 Q
"RTN","WVEXPTRA",67,0)
VET ; Add veterans only
"RTN","WVEXPTRA",68,0)
 W ! S WVVET=""
"RTN","WVEXPTRA",69,0)
 N DIR S DIR(0)="Y",DIR("A")="Add veterans only"
"RTN","WVEXPTRA",70,0)
 S DIR("?",1)="Answer YES to add veterans only."
"RTN","WVEXPTRA",71,0)
 S DIR("?")="Answer NO to include non-veterans (e.g., employees)."
"RTN","WVEXPTRA",72,0)
 D ^DIR
"RTN","WVEXPTRA",73,0)
 I $D(DIRUT) S WVPOP=1 Q
"RTN","WVEXPTRA",74,0)
 S WVVET=+Y
"RTN","WVEXPTRA",75,0)
 Q
"RTN","WVEXPTRA",76,0)
QUEUE ; Task as background job
"RTN","WVEXPTRA",77,0)
 S ZTIO="",ZTDESC="WH GRAB RAD/NM DATA",ZTRTN="EN2^WVEXPTRA"
"RTN","WVEXPTRA",78,0)
 S ZTDTH=$H,WVPOP=1
"RTN","WVEXPTRA",79,0)
 S ZTSAVE("WVENDT")="",ZTSAVE("WVSTDT")="",ZTSAVE("WVSTATUS")=""
"RTN","WVEXPTRA",80,0)
 S ZTSAVE("WVVET")=""
"RTN","WVEXPTRA",81,0)
 D ^%ZTLOAD
"RTN","WVEXPTRA",82,0)
 Q
"RTN","WVEXPTRA",83,0)
CPTS ; Loop through File 71 to get procedure pointers for the CPTs we
"RTN","WVEXPTRA",84,0)
 ; are interested in.
"RTN","WVEXPTRA",85,0)
 S WVIEN=0 K WVARRAY
"RTN","WVEXPTRA",86,0)
 F  S WVIEN=$O(^RAMIS(71,WVIEN)) Q:'WVIEN  D
"RTN","WVEXPTRA",87,0)
 .S WVCPT=$$GET1^DIQ(71,WVIEN,9,"I") ;CPT code
"RTN","WVEXPTRA",88,0)
 .I WVCPT=76090 S WVARRAY(WVIEN)="" Q  ;unilateral mammogram
"RTN","WVEXPTRA",89,0)
 .I WVCPT=76091 S WVARRAY(WVIEN)="" Q  ;bilateral mammogram
"RTN","WVEXPTRA",90,0)
 .I WVCPT=76092 S WVARRAY(WVIEN)="" Q  ;screening mammogram
"RTN","WVEXPTRA",91,0)
 .S:WVCPT=76645 WVARRAY(WVIEN)="" ;echo exam of breast
"RTN","WVEXPTRA",92,0)
 .Q
"RTN","WVEXPTRA",93,0)
 Q
"RTN","WVEXPTRA",94,0)
GET ; get mammograms and breast ultrasounds from RAD/NM database
"RTN","WVEXPTRA",95,0)
 ;---> WVMCNT = total new procedures added.
"RTN","WVEXPTRA",96,0)
 ;---> WVNEWP = total new patients added.
"RTN","WVEXPTRA",97,0)
 S (WVMCNT,WVNEWP)=0
"RTN","WVEXPTRA",98,0)
 Q:'$D(WVARRAY)  ;no mammogram or breast ultrasound procedures in File 71
"RTN","WVEXPTRA",99,0)
 S WVENDT=WVENDT\1,WVENDT=9999999-WVENDT ;inverse end date
"RTN","WVEXPTRA",100,0)
 S WVSTDT=WVSTDT\1,WVSTDT=9999999-WVSTDT ;inverse start date
"RTN","WVEXPTRA",101,0)
 S WVSTDT=WVSTDT_".9999"
"RTN","WVEXPTRA",102,0)
 S WVDFN=0 ;patient dfn
"RTN","WVEXPTRA",103,0)
 F  S WVDFN=$O(^RADPT(WVDFN)) Q:'WVDFN  D  ;RAD/NM patient file
"RTN","WVEXPTRA",104,0)
 .Q:$P(^DPT(WVDFN,0),U,2)'="F"  ;not female
"RTN","WVEXPTRA",105,0)
 .I WVVET,$$GET1^DIQ(2,WVDFN,1901,"I")'="Y" Q  ;don't add non-veterans
"RTN","WVEXPTRA",106,0)
 .S WVDTI=WVENDT  ;Because the exam date is inverse the end date will
"RTN","WVEXPTRA",107,0)
 .;                will be the lower value.
"RTN","WVEXPTRA",108,0)
 .F  S WVDTI=$O(^RADPT(WVDFN,"DT",WVDTI)) Q:'WVDTI!(WVDTI>WVSTDT)  D
"RTN","WVEXPTRA",109,0)
 ..S WVCNI=0 ;case number
"RTN","WVEXPTRA",110,0)
 ..F  S WVCNI=$O(^RADPT(WVDFN,"DT",WVDTI,"P",WVCNI)) Q:'WVCNI  D
"RTN","WVEXPTRA",111,0)
 ...S WVNODE=$G(^RADPT(WVDFN,"DT",WVDTI,"P",WVCNI,0))
"RTN","WVEXPTRA",112,0)
 ...Q:WVNODE=""
"RTN","WVEXPTRA",113,0)
 ...S WVPROC=$P(WVNODE,U,2) ;procedure pointer
"RTN","WVEXPTRA",114,0)
 ...Q:'WVPROC  ;no pointer to File 71 (no procedure) 
"RTN","WVEXPTRA",115,0)
 ...Q:'$D(WVARRAY(WVPROC))  ;not a mammogram or breast ultrasound
"RTN","WVEXPTRA",116,0)
 ...S WVRPT=$P(WVNODE,U,17) ;report pointer
"RTN","WVEXPTRA",117,0)
 ...Q:'WVRPT  ;no pointer to File 74 (no report)
"RTN","WVEXPTRA",118,0)
 ...Q:$$GET1^DIQ(74,WVRPT,5,"I")'="V"  ;report status, must be VERIFIED
"RTN","WVEXPTRA",119,0)
 ...D CREATEH^WVRALINK(WVDFN,WVDTI,WVCNI,WVSTATUS)
"RTN","WVEXPTRA",120,0)
 ...Q
"RTN","WVEXPTRA",121,0)
 ..Q
"RTN","WVEXPTRA",122,0)
 .Q
"RTN","WVEXPTRA",123,0)
 Q
"RTN","WVEXPTRA",124,0)
MAIL ; send mail message to user with counts of procedures & patients added
"RTN","WVEXPTRA",125,0)
 S XMDUZ=.5 ;message sender
"RTN","WVEXPTRA",126,0)
 S XMY(DUZ)="" ;person who ran option
"RTN","WVEXPTRA",127,0)
 S XMSUB="Export of RAD/NM procedures to WH is done"
"RTN","WVEXPTRA",128,0)
 S WVMSG(1)="  # of New patients added to Women's Health package: "_WVNEWP
"RTN","WVEXPTRA",129,0)
 S WVMSG(2)="# of New procedures added to Women's Health package: "_WVMCNT
"RTN","WVEXPTRA",130,0)
 I '$D(WVARRAY) D
"RTN","WVEXPTRA",131,0)
 .S WVMSG(3)=" "
"RTN","WVEXPTRA",132,0)
 .S WVMSG(4)="There are no mammogram or breast ultrasound procedures listed in your"
"RTN","WVEXPTRA",133,0)
 .S WVMSG(5)="Radiology/Nuclear Medicine package."
"RTN","WVEXPTRA",134,0)
 .Q
"RTN","WVEXPTRA",135,0)
 S XMTEXT="WVMSG("
"RTN","WVEXPTRA",136,0)
 D ^XMD
"RTN","WVEXPTRA",137,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVEXPTRA",138,0)
 Q
"RTN","WVEXPTRA",139,0)
KILL ;
"RTN","WVEXPTRA",140,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","WVEXPTRA",141,0)
 K WVARRAY,WVCNI,WVCPT,WVDFN,WVDTI,WVENDT,WVIEN,WVMCNT,WVNEWP,WVNODE,WVPOP,WVPROC,WVRPT,WVSTATUS,WVSTDT,WVVET
"RTN","WVEXPTRA",142,0)
 K X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","WVEXPTRA",143,0)
 Q
"RTN","WVEXPTRA",144,0)
 ;
"RTN","WVGETALL")
0^1^B53798573
"RTN","WVGETALL",1,0)
WVGETALL ;HCIOFO/FT,JR IHS/ANMC/MWR - AUTOLOAD FEMALE PATIENTS ;12/14/98  14:59
"RTN","WVGETALL",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WVGETALL",3,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVGETALL",4,0)
 ;;  AUTOMATICALLY LOADS WOMENS PATIENTS FROM THE MAIN PATIENT FILE,
"RTN","WVGETALL",5,0)
 ;;  LIMITED BY AGE AND CURRENT COMMUNITY.
"RTN","WVGETALL",6,0)
 ;
"RTN","WVGETALL",7,0)
EN ;
"RTN","WVGETALL",8,0)
 N WVPARM
"RTN","WVGETALL",9,0)
 S WVPARM=$G(^WV(790.02,+$G(DUZ(2)),0))
"RTN","WVGETALL",10,0)
 I WVPARM="" D CHECK^WVLOGO Q  ;no site parameter entry
"RTN","WVGETALL",11,0)
 ; Stop if no default case manager
"RTN","WVGETALL",12,0)
 I '$P(WVPARM,U,2) D NODCM^WVUTL9 Q
"RTN","WVGETALL",13,0)
 D SETVARS^WVUTL5
"RTN","WVGETALL",14,0)
 D INTRO  G:WVPOP EXIT
"RTN","WVGETALL",15,0)
 D SELECT G:WVPOP EXIT
"RTN","WVGETALL",16,0)
 D DEVICE G:WVPOP EXIT
"RTN","WVGETALL",17,0)
 D LOAD
"RTN","WVGETALL",18,0)
 ;
"RTN","WVGETALL",19,0)
EXIT ;EP
"RTN","WVGETALL",20,0)
 D KILLALL^WVUTL8 K WVJSDT,WVJEDT,WVN,WVST
"RTN","WVGETALL",21,0)
 Q
"RTN","WVGETALL",22,0)
 ;
"RTN","WVGETALL",23,0)
 ;
"RTN","WVGETALL",24,0)
INTRO ;EP
"RTN","WVGETALL",25,0)
 ;---> INTRODUCTORY SCREENS.
"RTN","WVGETALL",26,0)
 S WVTITLE="AUTOLOAD PATIENTS"
"RTN","WVGETALL",27,0)
 D TITLE^WVUTL5(WVTITLE)
"RTN","WVGETALL",28,0)
 D TEXT1,DIRZ^WVUTL3
"RTN","WVGETALL",29,0)
 Q:WVPOP
"RTN","WVGETALL",30,0)
 D TITLE^WVUTL5(WVTITLE)
"RTN","WVGETALL",31,0)
 D TEXT2,DIRZ^WVUTL3
"RTN","WVGETALL",32,0)
 Q
"RTN","WVGETALL",33,0)
 ;
"RTN","WVGETALL",34,0)
SELECT ;EP
"RTN","WVGETALL",35,0)
 ;---> SELECT AGE.
"RTN","WVGETALL",36,0)
 D TITLE^WVUTL5(WVTITLE)
"RTN","WVGETALL",37,0)
 ;---> SELECT AGE.
"RTN","WVGETALL",38,0)
 K DIR
"RTN","WVGETALL",39,0)
 W !?5,"Select the age below which patients should NOT be added:"
"RTN","WVGETALL",40,0)
 S DIR("A")="     Enter AGE: ",DIR("B")=19
"RTN","WVGETALL",41,0)
 S DIR(0)="NOA^10:99" D HELP1
"RTN","WVGETALL",42,0)
 D ^DIR K DIR
"RTN","WVGETALL",43,0)
 I Y=-1!($D(DIRUT)) S WVPOP=1 Q
"RTN","WVGETALL",44,0)
 S WVAGE=+Y
"RTN","WVGETALL",45,0)
 W !!?5,"Define Active Patient for Patient file download."
"RTN","WVGETALL",46,0)
 W !?5,"If the patient has had no activity (visits or admissions) between"
"RTN","WVGETALL",47,0)
 W !?5,"the start and end dates you enter here, she will not be included"
"RTN","WVGETALL",48,0)
 W !?5,"in this Patient file download.",!
"RTN","WVGETALL",49,0)
STD S DIR(0)="DAO",DIR("A")="     Start Date of Patient Activity to Include: "
"RTN","WVGETALL",50,0)
 S Y=DT-30000 D DD^%DT S DIR("B")=Y
"RTN","WVGETALL",51,0)
 S DIR("?",1)="     If the patient has not had a Visit or Admission after this start date,"
"RTN","WVGETALL",52,0)
 S DIR("?",2)="     they will not be included in the auto-load."
"RTN","WVGETALL",53,0)
 S DIR("?")="     This date can be up to 3 years prior to todays date."
"RTN","WVGETALL",54,0)
 D ^DIR K DIR I Y'>0  W !!!! K WVJRDT S WVPOP=1 Q
"RTN","WVGETALL",55,0)
 S WVJSDT=Y
"RTN","WVGETALL",56,0)
K S DIR(0)="DAO",DIR("A")="     End Date of Patient Activity to Include: "
"RTN","WVGETALL",57,0)
 S DIR("?")="   "
"RTN","WVGETALL",58,0)
 S DIR("?",1)="     If the patient has not had a Visit or Admission before this date,"
"RTN","WVGETALL",59,0)
 S DIR("?",2)="     they will not be included in the auto-load."
"RTN","WVGETALL",60,0)
 S DIR("?",3)="     This date may be up to 3 years prior to todays date, but must be"
"RTN","WVGETALL",61,0)
 S DIR("?",4)="     after the start date."
"RTN","WVGETALL",62,0)
 S Y=DT D DD^%DT S DIR("B")=Y
"RTN","WVGETALL",63,0)
 D ^DIR K DIR I Y'>0  W !!!! K WVJSDT S WVPOP=1 Q
"RTN","WVGETALL",64,0)
 I Y<WVJSDT W !!!,"     END DATE MUST BE AFTER START DATE",!!! K WVJSDT G STD
"RTN","WVGETALL",65,0)
 S WVJEDT=Y
"RTN","WVGETALL",66,0)
 Q
"RTN","WVGETALL",67,0)
 ;
"RTN","WVGETALL",68,0)
DEVICE ;EP
"RTN","WVGETALL",69,0)
 ;---> GET DEVICE AND POSSIBLY QUEUE TO TASKMAN.
"RTN","WVGETALL",70,0)
 S ZTRTN="LOAD^WVGETALL"
"RTN","WVGETALL",71,0)
 S ZTSAVE("WVAGE")="",ZTSAVE("WVJSDT")="",ZTSAVE("WVJEDT")=""
"RTN","WVGETALL",72,0)
 D ZIS^WVUTL2(.WVPOP,1)
"RTN","WVGETALL",73,0)
 Q
"RTN","WVGETALL",74,0)
 ;
"RTN","WVGETALL",75,0)
LOAD ;EP
"RTN","WVGETALL",76,0)
 ;---> AUTOLOAD OF PATIENTS
"RTN","WVGETALL",77,0)
 N WVCOUNT,WVERROR,N,X,Y D SETVARS^WVUTL5
"RTN","WVGETALL",78,0)
 D TOPHEAD^WVUTL7 S WVCONF=1
"RTN","WVGETALL",79,0)
 S WVTITLE="* AUTOLOAD OF WOMEN PATIENTS *"
"RTN","WVGETALL",80,0)
 D CENTERT^WVUTL5(.WVTITLE)
"RTN","WVGETALL",81,0)
 U IO
"RTN","WVGETALL",82,0)
 W:$Y>0 @IOF D HEADER7^WVUTL7
"RTN","WVGETALL",83,0)
 S (WVCOUNT,N)=0
"RTN","WVGETALL",84,0)
 S WVN=0 F  S WVN=$O(^DPT("ASX","F",WVN)) Q:'WVN  Q:WVPOP  D
"RTN","WVGETALL",85,0)
 .S Y=^DPT(WVN,0)
"RTN","WVGETALL",86,0)
 .;---> QUIT IF NOT FEMALE.
"RTN","WVGETALL",87,0)
 .Q:$P(Y,U,2)'="F"
"RTN","WVGETALL",88,0)
 .;---> QUIT IF DECEASED OR LESS THAN WVAGE.
"RTN","WVGETALL",89,0)
 .Q:+$$AGE^WVUTL1(WVN)<WVAGE
"RTN","WVGETALL",90,0)
 .Q:$D(^WV(790,WVN,0))
"RTN","WVGETALL",91,0)
 .; Quit if patient not a veteran
"RTN","WVGETALL",92,0)
 .Q:$$GET1^DIQ(2,WVN,1901,"I")'="Y"
"RTN","WVGETALL",93,0)
 .;Quit if not active patient
"RTN","WVGETALL",94,0)
 .Q:$$HOS(WVN)<1
"RTN","WVGETALL",95,0)
 .I $Y+5>IOSL D:WVCRT DIRZ^WVUTL3 Q:WVPOP  D HEADER7^WVUTL7
"RTN","WVGETALL",96,0)
 .W !?3,$$NAME^WVUTL1(WVN),?30,$$SSN^WVUTL1(WVN)
"RTN","WVGETALL",97,0)
 .W ?45,$$SLDT2^WVUTL5($$DOB^WVUTL1(WVN))
"RTN","WVGETALL",98,0)
 .D AUTOADD^WVPATE(WVN,DUZ(2),.WVERROR)
"RTN","WVGETALL",99,0)
 .I WVERROR<0 W ?60,"FAILED" Q
"RTN","WVGETALL",100,0)
 .S WVCOUNT=WVCOUNT+1 W ?60,"ADDED" ;,?70,WVN
"RTN","WVGETALL",101,0)
 W !!?5,"TOTAL: ",WVCOUNT," PATIENT",$S(WVCOUNT=1:"",1:"S")
"RTN","WVGETALL",102,0)
 W " ADDED TO THE WOMEN'S HEALTH DATABASE.",!
"RTN","WVGETALL",103,0)
 I WVCRT&('$D(IO("S"))) D DIRZ^WVUTL3 W @IOF
"RTN","WVGETALL",104,0)
 K TEST1,TEST2 D ^%ZISC
"RTN","WVGETALL",105,0)
 Q
"RTN","WVGETALL",106,0)
 ;
"RTN","WVGETALL",107,0)
 ;
"RTN","WVGETALL",108,0)
TEXT1 ;EP
"RTN","WVGETALL",109,0)
 ;;This utility will examine the VISTA Patient file(#2) for ALL
"RTN","WVGETALL",110,0)
 ;;WOMEN VETERANS over a given age who were seen as either an Inpatient
"RTN","WVGETALL",111,0)
 ;;or an Outpatient in the date range selected, and add them to the 
"RTN","WVGETALL",112,0)
 ;;Women's Health Database.
"RTN","WVGETALL",113,0)
 ;;
"RTN","WVGETALL",114,0)
 ;;You will be asked to select a cutoff age (e.g., 40 and over). 
"RTN","WVGETALL",115,0)
 ;;You will be asked to select a Start and End Activity date.  
"RTN","WVGETALL",116,0)
 ;;Patients not having a visit or admission between these dates
"RTN","WVGETALL",117,0)
 ;;will not be added to the file.  These dates can be no more
"RTN","WVGETALL",118,0)
 ;;than 3 years prior to today's date.
"RTN","WVGETALL",119,0)
 ;;
"RTN","WVGETALL",120,0)
 ;;Women already in the Women's Health Database will not be added twice.
"RTN","WVGETALL",121,0)
 ;;Women who are deceased will not be added.  Women added to the Women's
"RTN","WVGETALL",122,0)
 ;;Health Database will be given Breast and Cervical Treatment Needs of
"RTN","WVGETALL",123,0)
 ;;"Undetermined", with no due dates.
"RTN","WVGETALL",124,0)
 ;;
"RTN","WVGETALL",125,0)
 ;;This utility may be run at any time, as often as desired.  It may be
"RTN","WVGETALL",126,0)
 ;;useful to run it on a monthly basis in order to pick up new women who
"RTN","WVGETALL",127,0)
 ;;are added to the Patient Database.
"RTN","WVGETALL",128,0)
 S WVTAB=5,WVLINL="TEXT1" D PRINTX
"RTN","WVGETALL",129,0)
 Q
"RTN","WVGETALL",130,0)
 ;
"RTN","WVGETALL",131,0)
 ;
"RTN","WVGETALL",132,0)
TEXT2 ;EP
"RTN","WVGETALL",133,0)
 ;;Before the program begins, you will be prompted for a "DEVICE:".
"RTN","WVGETALL",134,0)
 ;;The name, social security number, and date of birth of each
"RTN","WVGETALL",135,0)
 ;;patient added to the Women's Health Database will be displayed
"RTN","WVGETALL",136,0)
 ;;on the DEVICE.
"RTN","WVGETALL",137,0)
 ;;This DEVICE may be a printer, or you may enter "HOME" to have the
"RTN","WVGETALL",138,0)
 ;;information simply display on your screen.
"RTN","WVGETALL",139,0)
 ;;
"RTN","WVGETALL",140,0)
 ;;If the DEVICE you select is a printer, it may be preferable
"RTN","WVGETALL",141,0)
 ;;to "queue" the job, in order to free up your terminal.
"RTN","WVGETALL",142,0)
 ;;See your computer sitemanager for assistance with queuing jobs.
"RTN","WVGETALL",143,0)
 ;;
"RTN","WVGETALL",144,0)
 ;;WARNING: The first time this utility is run, it may add several
"RTN","WVGETALL",145,0)
 ;;thousand patients to the Women's Health Database.  It may take
"RTN","WVGETALL",146,0)
 ;;several minutes or even hours to run, depending on the size of the
"RTN","WVGETALL",147,0)
 ;;database and speed of the computer.  Subsequent runs should be much
"RTN","WVGETALL",148,0)
 ;;quicker.
"RTN","WVGETALL",149,0)
 ;;
"RTN","WVGETALL",150,0)
 ;;You may type "^" at anytime to quit before the program begins.
"RTN","WVGETALL",151,0)
 S WVTAB=5,WVLINL="TEXT2" D PRINTX
"RTN","WVGETALL",152,0)
 Q
"RTN","WVGETALL",153,0)
 ;
"RTN","WVGETALL",154,0)
HELP1 ;EP
"RTN","WVGETALL",155,0)
 ;;Enter a two-digit number that will be the lowest age of patients
"RTN","WVGETALL",156,0)
 ;;added to the Women's Health Database.  For example, if you enter 15,
"RTN","WVGETALL",157,0)
 ;;all women age 15 and older will be included, 14 and under will not.
"RTN","WVGETALL",158,0)
 S WVTAB=5,WVLINL="HELP1" D HELPTX
"RTN","WVGETALL",159,0)
 Q
"RTN","WVGETALL",160,0)
 ;
"RTN","WVGETALL",161,0)
 ;
"RTN","WVGETALL",162,0)
PRINTX ;EP
"RTN","WVGETALL",163,0)
 N I,T,X S T=$$REPEAT^XLFSTR(" ",WVTAB)
"RTN","WVGETALL",164,0)
 F I=1:1 S X=$T(@WVLINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","WVGETALL",165,0)
 Q
"RTN","WVGETALL",166,0)
 ;
"RTN","WVGETALL",167,0)
HELPTX ;EP
"RTN","WVGETALL",168,0)
 N I,T,X S T=$$REPEAT^XLFSTR(" ",WVTAB)
"RTN","WVGETALL",169,0)
 F I=1:1 S X=$T(@WVLINL+I) Q:X'[";;"  S DIR("?",I)=T_$P(X,";;",2)
"RTN","WVGETALL",170,0)
 S DIR("?")=DIR("?",I-1) K DIR("?",I-1)
"RTN","WVGETALL",171,0)
 Q
"RTN","WVGETALL",172,0)
HOS(WVN) ;Comes here to determine if visit/adm. is current
"RTN","WVGETALL",173,0)
 ;WVN=DFN, WVJSDT=Selected earliest date for consideration.
"RTN","WVGETALL",174,0)
 S WVST="ADFN"_WVN
"RTN","WVGETALL",175,0)
 S TEST1=$O(^DGPM(WVST,WVJSDT)) I TEST1>WVJSDT I TEST1<WVJEDT Q 1
"RTN","WVGETALL",176,0)
 S TEST2=$O(^SCE("ADFN",WVN,WVJSDT)) I TEST2>WVJSDT I TEST2<WVJEDT Q 1
"RTN","WVGETALL",177,0)
 Q 0
"RTN","WVLAB")
0^12^B2255617
"RTN","WVLAB",1,0)
WVLAB ;HCIOFO/FT IHS/ANMC/MWR - ADD/EDIT PROCEDURE BY LAB STAFF; ;12/15/98  11:23
"RTN","WVLAB",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WVLAB",3,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVLAB",4,0)
 ;;  CALLED BY OPTION: "WV LAB ADD A NEW PROCEDURE" TO ACCESSION
"RTN","WVLAB",5,0)
 ;;  PROCEDURES.
"RTN","WVLAB",6,0)
 ;
"RTN","WVLAB",7,0)
 D SETVARS^WVUTL5
"RTN","WVLAB",8,0)
 F  D  Q:WVPOP
"RTN","WVLAB",9,0)
 .D TITLE^WVUTL5("LAB: ENTER NEW PROCEDURES")
"RTN","WVLAB",10,0)
 .D NEW
"RTN","WVLAB",11,0)
 D EXIT
"RTN","WVLAB",12,0)
 Q
"RTN","WVLAB",13,0)
 ;
"RTN","WVLAB",14,0)
NEW ;EP
"RTN","WVLAB",15,0)
 ;---> SELECT PATIENT.
"RTN","WVLAB",16,0)
 S WVPOP=0 N WVDFN,DIR,DR
"RTN","WVLAB",17,0)
 ; Quit if no default case manager
"RTN","WVLAB",18,0)
 I '$$DCM^WVUTL9(DUZ(2)) D NODCM^WVUTL9 S WVPOP=1 Q
"RTN","WVLAB",19,0)
 D PATLKUP^WVUTL8(.Y,"ADD")
"RTN","WVLAB",20,0)
 I Y<0 S WVPOP=1 Q
"RTN","WVLAB",21,0)
 S WVDFN=+Y
"RTN","WVLAB",22,0)
 ;---> SELECT PROCEDURE.
"RTN","WVLAB",23,0)
 D NEW1^WVPROC I WVPOP S WVPOP=0 Q
"RTN","WVLAB",24,0)
 I '$G(DA) D  Q
"RTN","WVLAB",25,0)
 .W !?5,"* FAILURE TO ADD NEW PROCEDURE.  "
"RTN","WVLAB",26,0)
 .W "PLEASE CONTACT YOUR SITE MANAGER" D DIRZ^WVUTL3
"RTN","WVLAB",27,0)
 D EDIT2(DA)
"RTN","WVLAB",28,0)
 Q
"RTN","WVLAB",29,0)
 ;
"RTN","WVLAB",30,0)
EDIT ;EP
"RTN","WVLAB",31,0)
 ;---> CALLED BY OPTION: "WV LAB EDIT ACCESSION".
"RTN","WVLAB",32,0)
 ;---> EDIT JUST THE ACCESSION FIELDS OF AN EXISTING PROCEDURE.
"RTN","WVLAB",33,0)
 D SETVARS^WVUTL5
"RTN","WVLAB",34,0)
 D TITLE^WVUTL5("EDIT AN ACCESSIONED PROCEDURE")
"RTN","WVLAB",35,0)
 D LKUPPCD^WVPROC(.Y)
"RTN","WVLAB",36,0)
 Q:Y<0!($D(DIROUT))
"RTN","WVLAB",37,0)
 ;---> DA=IEN OF PROCEDURE IN PROCEDURE FILE 790.1.
"RTN","WVLAB",38,0)
 S DA=+Y
"RTN","WVLAB",39,0)
 D EDIT2(DA)
"RTN","WVLAB",40,0)
 D EXIT
"RTN","WVLAB",41,0)
 Q
"RTN","WVLAB",42,0)
 ;
"RTN","WVLAB",43,0)
 ;
"RTN","WVLAB",44,0)
EDIT2(DA) ;EP
"RTN","WVLAB",45,0)
 ;---> REQUIRED VARIABLES: DA=IEN IN ^WV(790.1,.
"RTN","WVLAB",46,0)
 Q:'$G(DA)
"RTN","WVLAB",47,0)
 S WVDFN=$P(^WV(790.1,DA,0),U,2)
"RTN","WVLAB",48,0)
 D DDS^WVFMAN(790.1,"[WV PROC-FORM-LAB]",DA,"C",.WVCHG,.WVPOP)
"RTN","WVLAB",49,0)
 Q
"RTN","WVLAB",50,0)
 ;
"RTN","WVLAB",51,0)
EXIT ;EP
"RTN","WVLAB",52,0)
 D KILLALL^WVUTL8
"RTN","WVLAB",53,0)
 Q
"RTN","WVLOGO")
0^2^B4256995
"RTN","WVLOGO",1,0)
WVLOGO ;HCIOFO/FT,JR IHS/ANMC/MWR - DISPLAY LOGO WHEN ENTERING PKG; ;12/7/98  15:55
"RTN","WVLOGO",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WVLOGO",3,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVLOGO",4,0)
 ;;  DISPLAYS LOGO.  GETS VERSION FROM LINE 2 OF THIS ROUTINE.
"RTN","WVLOGO",5,0)
 ;
"RTN","WVLOGO",6,0)
 D SETVARS^WVUTL5
"RTN","WVLOGO",7,0)
 N WVVER,Y
"RTN","WVLOGO",8,0)
 ;
"RTN","WVLOGO",9,0)
 S Y=$P($P($T(WVLOGO+1),";;",2),";")
"RTN","WVLOGO",10,0)
 ;
"RTN","WVLOGO",11,0)
 W @IOF
"RTN","WVLOGO",12,0)
 I '$D(DUZ(2)) D  Q
"RTN","WVLOGO",13,0)
 .W !!!,"DUZ(2) is undefined.  Contact your Site Manager.",!!
"RTN","WVLOGO",14,0)
 .D DIRZ^WVUTL3
"RTN","WVLOGO",15,0)
 W !?3,"Women's Health Main Menu v",Y,?55,$E($P(^DIC(4,DUZ(2),0),U),1,24)
"RTN","WVLOGO",16,0)
 Q
"RTN","WVLOGO",17,0)
 ;
"RTN","WVLOGO",18,0)
CHECK ;EP
"RTN","WVLOGO",19,0)
 ;---> UPON ENTRY VIA MAIN MENU (OR LAB DATA ENTRY MENU), CHECKS TO
"RTN","WVLOGO",20,0)
 ;---> SEE THAT USER'S DUZ(2) IS SET UP AS A PACKAGE SITE.
"RTN","WVLOGO",21,0)
 I '$G(DUZ(2)) D WARN D  D CHKOUT Q
"RTN","WVLOGO",22,0)
 .W !?5,"Your DUZ(2) variable is not defined."
"RTN","WVLOGO",23,0)
 I '$D(^WV(790.02,DUZ(2),0)) D WARN D  D CHKOUT,CHKOUT1 Q
"RTN","WVLOGO",24,0)
 .W !?5,"Women's Health Site Parameters have NOT been set for the site"
"RTN","WVLOGO",25,0)
 .W !?5,"you are logged on as: ",$P(^DIC(4,DUZ(2),0),U)
"RTN","WVLOGO",26,0)
 Q
"RTN","WVLOGO",27,0)
 ;
"RTN","WVLOGO",28,0)
WARN ;EP
"RTN","WVLOGO",29,0)
 W @IOF,!!?35,"WARNING",!?34,"---------",!!
"RTN","WVLOGO",30,0)
 Q
"RTN","WVLOGO",31,0)
CHKOUT ;EP
"RTN","WVLOGO",32,0)
 W !!?5,"At this point you should back out of the Women's Health"
"RTN","WVLOGO",33,0)
 W !?5,"package and contact your site manager or the person in charge"
"RTN","WVLOGO",34,0)
 W !?5,"of the Women's Health Software.",!
"RTN","WVLOGO",35,0)
 Q
"RTN","WVLOGO",36,0)
CHKOUT1 ; Message when no site parameter entry
"RTN","WVLOGO",37,0)
 W !?5,"Or, if you wish to set up site parameters for this site,"
"RTN","WVLOGO",38,0)
 W !?5,"you may proceed to the Edit Site Parameters option and enter"
"RTN","WVLOGO",39,0)
 W !?5,"parameters for this site.  (Synonyms: MF-->FM-->ESP)",!
"RTN","WVLOGO",40,0)
 D DIRZ^WVUTL3
"RTN","WVLOGO",41,0)
 Q
"RTN","WVPATE")
0^10^B8086420
"RTN","WVPATE",1,0)
WVPATE ;HCIOFO/FT,JR IHS/ANMC/MWR -  PATIENT CASE DATA EDIT; ;12/15/98  11:20
"RTN","WVPATE",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WVPATE",3,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVPATE",4,0)
 ;;  CALLED BY OPTION: "WV EDIT PATIENT CASE DATA".
"RTN","WVPATE",5,0)
 ;
"RTN","WVPATE",6,0)
 D SETVARS^WVUTL5
"RTN","WVPATE",7,0)
 F  D PATIENT Q:WVPOP
"RTN","WVPATE",8,0)
 ;
"RTN","WVPATE",9,0)
EXIT ;EP
"RTN","WVPATE",10,0)
 D KILLALL^WVUTL8
"RTN","WVPATE",11,0)
 Q
"RTN","WVPATE",12,0)
 ;
"RTN","WVPATE",13,0)
 ;
"RTN","WVPATE",14,0)
PATIENT ;EP
"RTN","WVPATE",15,0)
 D TITLE^WVUTL5("EDIT PATIENT CASE DATA")
"RTN","WVPATE",16,0)
PATIENT1 ;EP
"RTN","WVPATE",17,0)
 ;---> TO AVOID @IOF AND TITLE.
"RTN","WVPATE",18,0)
 ;---> SELECT PATIENT.
"RTN","WVPATE",19,0)
 ; Quit if no default case manager
"RTN","WVPATE",20,0)
 I '$$DCM^WVUTL9(DUZ(2)) D NODCM^WVUTL9 S WVPOP=1 Q
"RTN","WVPATE",21,0)
 N Y
"RTN","WVPATE",22,0)
 W !!,"   Select the patient you wish to add or edit."
"RTN","WVPATE",23,0)
 D PATLKUP^WVUTL8(.Y,"ADD")
"RTN","WVPATE",24,0)
 I Y<0 S WVPOP=1 Q
"RTN","WVPATE",25,0)
 S WVDFN=+Y
"RTN","WVPATE",26,0)
 D SCREEN(WVDFN) S WVPOP=0
"RTN","WVPATE",27,0)
 Q
"RTN","WVPATE",28,0)
 ;
"RTN","WVPATE",29,0)
 ;
"RTN","WVPATE",30,0)
SCREEN(WVDFN) ;EP
"RTN","WVPATE",31,0)
 ;---> EDIT PATIENT CASE DATA WITH SCREENMAN.
"RTN","WVPATE",32,0)
 ;---> REQUIRED VARIABLES: WVDFN=DFN OF PATIENT.
"RTN","WVPATE",33,0)
 S WVMST=$$MSTDEF^WVUTL1A(WVDFN)
"RTN","WVPATE",34,0)
 I '$P($G(^WV(790,WVDFN,0)),U,10) D STUFF
"RTN","WVPATE",35,0)
 N DR
"RTN","WVPATE",36,0)
 S DR="[WV PATIENT-FORM-1]"
"RTN","WVPATE",37,0)
 D DDS^WVFMAN(790,DR,WVDFN,"","",.WVPOP)
"RTN","WVPATE",38,0)
 Q:WVPOP
"RTN","WVPATE",39,0)
 ;Q
"RTN","WVPATE",40,0)
 N DIR W !,"Do you wish to PRINT this patient's Case Data?"
"RTN","WVPATE",41,0)
 S DIR(0)="Y",DIR("B")="NO" D ^DIR K DIR W !
"RTN","WVPATE",42,0)
 D:Y PRTCASE^WVPATP(WVDFN)
"RTN","WVPATE",43,0)
 Q
"RTN","WVPATE",44,0)
 ;
"RTN","WVPATE",45,0)
CASEDATA(WVDFN) ;EP
"RTN","WVPATE",46,0)
 ;---> CALLED AFTER ADD/EDIT OF NOTIFICATIONS.
"RTN","WVPATE",47,0)
 N DIR W !,"Do you wish to EDIT this patient's Case Data?"
"RTN","WVPATE",48,0)
 S DIR("?",1)="   Enter YES to edit this patient's Case Manager, "
"RTN","WVPATE",49,0)
 S DIR("?")="   PAP Regimen, Current Need, etc."
"RTN","WVPATE",50,0)
 S DIR(0)="Y",DIR("B")="NO" D ^DIR K DIR W !
"RTN","WVPATE",51,0)
 D:Y SCREEN(WVDFN)
"RTN","WVPATE",52,0)
 Q
"RTN","WVPATE",53,0)
 ;
"RTN","WVPATE",54,0)
AUTOADD(DFN,SITE,Y,WVPRMT) ;EP
"RTN","WVPATE",55,0)
 ;---> AUTOMATIC ADD OF A NEW PATIENT TO "WV PATIENT FILE".
"RTN","WVPATE",56,0)
 ;---> SET CASEMANAGER TO SITE PARAMETER DEFAULT.
"RTN","WVPATE",57,0)
 ;---> SET PAP TX NEED (#.11), PAP REGIMEN (#.16)="Undetermined",
"RTN","WVPATE",58,0)
 ;---> MAM TX NEED (#.18)="Undetermined".
"RTN","WVPATE",59,0)
 ;---> PARAMETERS:
"RTN","WVPATE",60,0)
 ;     1 - DFN     (REQUIRED) IEN OF PATIENT IN ^DPT(
"RTN","WVPATE",61,0)
 ;     2 - SITE    (REQUIRED) DUZ(2) FOR DEFAULT CASE MANAGER
"RTN","WVPATE",62,0)
 ;     3 - Y       (RETURNED) FROM ^DICN: IEN OR -1 FAILURE TO ADD PT
"RTN","WVPATE",63,0)
 ;     4 - WVPRMT  (OPTIONAL) EQUALS 1 IF PROMPT WHEN FAILURE
"RTN","WVPATE",64,0)
 ;
"RTN","WVPATE",65,0)
 S (DINUM,X)=DFN
"RTN","WVPATE",66,0)
 ;---> SET CASE MANAGER DEFAULT.
"RTN","WVPATE",67,0)
 N WVCMGR,DIC S WVCMGR=$S($D(SITE):$P(^WV(790.02,SITE,0),U,2),1:"")
"RTN","WVPATE",68,0)
 S:'$G(WVPRMT) WVPRMT=0
"RTN","WVPATE",69,0)
 S DIC("DR")=".1////"_WVCMGR_";.11///Undetermined;.16///Undetermined"
"RTN","WVPATE",70,0)
 S DIC("DR")=DIC("DR")_";.18///Undetermined"
"RTN","WVPATE",71,0)
 S DIC("DR")=DIC("DR")_";.21////"_DT
"RTN","WVPATE",72,0)
 S DIC("DR")=DIC("DR")_";.27////"_$$MSTAL^WVUTL1A(DFN)
"RTN","WVPATE",73,0)
 K DD,DO S DIC="^WV(790,",DIC(0)="ML",DLAYGO=790
"RTN","WVPATE",74,0)
 D FILE^DICN K DIC
"RTN","WVPATE",75,0)
 ;---> IF Y<0, CHECK PERMISSIONS.
"RTN","WVPATE",76,0)
 I Y<0,WVPRMT D  Q
"RTN","WVPATE",77,0)
 .W !!?5,"* UNABLE to add this patient to the Women's Health database."
"RTN","WVPATE",78,0)
 .W !?5,"  Please contact your site manager to check permissions."
"RTN","WVPATE",79,0)
 .D DIRZ^WVUTL3
"RTN","WVPATE",80,0)
 S Y=+Y
"RTN","WVPATE",81,0)
 Q
"RTN","WVPATE",82,0)
 ;
"RTN","WVPATE",83,0)
STUFF ; Stuff case manager if none
"RTN","WVPATE",84,0)
 Q:'+$G(WVDFN)
"RTN","WVPATE",85,0)
 Q:'+$G(DUZ(2))
"RTN","WVPATE",86,0)
 S $P(^WV(790,WVDFN,0),U,10)=$P($G(^WV(790.02,DUZ(2),0)),U,2)
"RTN","WVPATE",87,0)
 Q
"RTN","WVPROC")
0^11^B39556908
"RTN","WVPROC",1,0)
WVPROC ;HCIOFO/FT,JR IHS/ANMC/MWR - WV ADD/EDIT WV PROCEDURE; ;12/15/98  11:20
"RTN","WVPROC",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WVPROC",3,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVPROC",4,0)
 ;;  CALLED BY VARIOUS OPTIONS TO ADD/EDIT PROCEDURES.
"RTN","WVPROC",5,0)
 ;
"RTN","WVPROC",6,0)
 ;
"RTN","WVPROC",7,0)
ADDNEW ;EP
"RTN","WVPROC",8,0)
 ;---> CALLED BY OPTION: "WV ADD A NEW PROCEDURE".
"RTN","WVPROC",9,0)
 D SETVARS^WVUTL5 S WVPOP1=0
"RTN","WVPROC",10,0)
 N DA,DIC,DIE,Y
"RTN","WVPROC",11,0)
 F  D  Q:WVPOP1
"RTN","WVPROC",12,0)
 .D NEW
"RTN","WVPROC",13,0)
 .Q:WVPOP
"RTN","WVPROC",14,0)
 .D EDIT2^WVPROC1(DA,.WVPOP)
"RTN","WVPROC",15,0)
 .Q:WVPOP
"RTN","WVPROC",16,0)
 .D PCDVARS^WVUTL3(DA,1)
"RTN","WVPROC",17,0)
 .D NORMAL^WVPROC1
"RTN","WVPROC",18,0)
 D EXIT
"RTN","WVPROC",19,0)
 Q
"RTN","WVPROC",20,0)
 ;
"RTN","WVPROC",21,0)
EXIT ;EP
"RTN","WVPROC",22,0)
 D KILLALL^WVUTL8
"RTN","WVPROC",23,0)
 Q
"RTN","WVPROC",24,0)
 ;
"RTN","WVPROC",25,0)
 ;
"RTN","WVPROC",26,0)
NEW ;EP
"RTN","WVPROC",27,0)
 ;---> SELECT A PATIENT.
"RTN","WVPROC",28,0)
 D SETVARS^WVUTL5 K DIC
"RTN","WVPROC",29,0)
 D TITLE^WVUTL5("ADD A NEW PROCEDURE")
"RTN","WVPROC",30,0)
NEWNT ;EP
"RTN","WVPROC",31,0)
 ;---> ENTER NEW WITHOUT A TITLE (ALLOWS OTHER TITLES, E.G., HISTORICAL)
"RTN","WVPROC",32,0)
 ;---> LOOKUP AND SELECT PATIENT FROM WV PATIENT FILE.
"RTN","WVPROC",33,0)
 ; Quit if no default case manager
"RTN","WVPROC",34,0)
 I '$$DCM^WVUTL9(DUZ(2)) D NODCM^WVUTL9 S (WVPOP,WVPOP1)=1 Q
"RTN","WVPROC",35,0)
 D PATLKUP^WVUTL8(.Y,"ADD")
"RTN","WVPROC",36,0)
 I Y<0 S (WVPOP,WVPOP1)=1 Q
"RTN","WVPROC",37,0)
 S WVDFN=+Y
"RTN","WVPROC",38,0)
 ;
"RTN","WVPROC",39,0)
NEW1 ;EP
"RTN","WVPROC",40,0)
 ;---> ADD A NEW PROCEDURE.
"RTN","WVPROC",41,0)
 ;---> PATIENT SELECTED ALREADY BUT NOT PROCEDURE.
"RTN","WVPROC",42,0)
 ;---> REQUIRED VARIABLE: WVDFN
"RTN","WVPROC",43,0)
 ;
"RTN","WVPROC",44,0)
 ;---> NOW SELECT PROCEDURE TYPE FROM WV PROCEDURE TYPE FILE.
"RTN","WVPROC",45,0)
 N A,WVPCDN,S
"RTN","WVPROC",46,0)
 S A="   Select PROCEDURE: "
"RTN","WVPROC",47,0)
 ;---> SCREEN: ACTIVE FIELD CAN BE "YES" OR NULL, BUT NOT "NO".
"RTN","WVPROC",48,0)
 S S="I $P($G(^WV(790.02,DUZ(2),Y)),U)'=0"
"RTN","WVPROC",49,0)
 D DIC^WVFMAN(790.2,"QEMA",.Y,A,"PAP SMEAR",S,"",.WVPOP)
"RTN","WVPROC",50,0)
 Q:Y<0
"RTN","WVPROC",51,0)
 ;---> WVPCDN=IEN OF PROCEDURE TYPE, FILE 790.2.
"RTN","WVPROC",52,0)
 S WVPCDN=+Y
"RTN","WVPROC",53,0)
 ;
"RTN","WVPROC",54,0)
 ;---> IF IT'S A UNILATERAL MAMMOGRAM, PROMPT FOR LEFT OR RIGHT.
"RTN","WVPROC",55,0)
 S WVLFRT=""
"RTN","WVPROC",56,0)
 I WVPCDN=26 D  I $D(DIRUT) S WVPOP=1 Q
"RTN","WVPROC",57,0)
 .N DIR
"RTN","WVPROC",58,0)
 .S DIR("?")="   Select LEFT or RIGHT for this Unilateral Mammogram."
"RTN","WVPROC",59,0)
 .S DIR(0)="SAM^l:LEFT;r:RIGHT",DIR("A")="   LEFT OR RIGHT: "
"RTN","WVPROC",60,0)
 .D ^DIR K DIR
"RTN","WVPROC",61,0)
 .Q:$D(DIRUT)
"RTN","WVPROC",62,0)
 .S WVLFRT=Y
"RTN","WVPROC",63,0)
 ;
"RTN","WVPROC",64,0)
 ;---> IF IT'S A COLPOSCOPY, PROMPT FOR PAP THAT INITIATED IT.
"RTN","WVPROC",65,0)
 S WVPPAP=""
"RTN","WVPROC",66,0)
 I WVPCDN=2 D  Q:WVPOP
"RTN","WVPROC",67,0)
 .W !!?3,"Select the PAP Smear that initiated this Colposcopy."
"RTN","WVPROC",68,0)
 .N A,S
"RTN","WVPROC",69,0)
 .S DIC("?",1)="If a previous abnormal PAP Smear was the reason for"
"RTN","WVPROC",70,0)
 .S DIC("?")="this Colposcopy, enter the Accession# of that PAP here."
"RTN","WVPROC",71,0)
 .S A="   PAP Smear: ",S="D PAPSCRN^WVUTL2"
"RTN","WVPROC",72,0)
 .D DIC^WVFMAN(790.1,"QEMA",.Y,A,"",S,"",.WVPOP)
"RTN","WVPROC",73,0)
 .Q:Y<0
"RTN","WVPROC",74,0)
 .;---> WVPPAP=IEN OF PREVIOUS PAP IN WV PROCEDURE FILE 790.1.
"RTN","WVPROC",75,0)
 .S WVPPAP=+Y
"RTN","WVPROC",76,0)
 ;
"RTN","WVPROC",77,0)
 ;---> ASK DATE, CHECK FOR DUPLICATE PROCEDURE ON SAME DATE.
"RTN","WVPROC",78,0)
 D DATECHK Q:WVPOP
"RTN","WVPROC",79,0)
 D NEW2(WVDFN,WVPCDN,WVPCDT,"",WVPPAP,.DA,.WVERROR)
"RTN","WVPROC",80,0)
 Q
"RTN","WVPROC",81,0)
 ;
"RTN","WVPROC",82,0)
NEW2(DFN,PCDIEN,DATE,DRSTRG,PREVPAP,DA,ERROR) ;EP
"RTN","WVPROC",83,0)
 ;---> ADD A NEW PROCEDURE.
"RTN","WVPROC",84,0)
 ;---> PATIENT AND PROCEDURE ALREADY SELECTED.
"RTN","WVPROC",85,0)
 ;---> NOW GENERATE ACCESSION# FOR WV PROCEDURE FILE ENTRY.
"RTN","WVPROC",86,0)
 ;---> REQUIRED VARIABLES: DFN=IEN IN WV PATIENT FILE
"RTN","WVPROC",87,0)
 ;--->                     PCDIEN=IEN OF PROCEDURE TYPE (#790.2).
"RTN","WVPROC",88,0)
 ;
"RTN","WVPROC",89,0)
 S X=$$ACCSSN^WVUTL5(PCDIEN) N DIC
"RTN","WVPROC",90,0)
 I X']"" D  Q
"RTN","WVPROC",91,0)
 .S ERROR=-1
"RTN","WVPROC",92,0)
 .Q:$D(ZTQUEUED)  ;quit if a background (tasked) job
"RTN","WVPROC",93,0)
 .W !!?5,*7,"UNABLE TO GENERATE ACCESSION#. CONTACT YOUR SITE MANAGER."
"RTN","WVPROC",94,0)
 .D DIRZ^WVUTL3
"RTN","WVPROC",95,0)
 .Q
"RTN","WVPROC",96,0)
 ;
"RTN","WVPROC",97,0)
 I $G(DRSTRG)']"" D
"RTN","WVPROC",98,0)
 .;---> DEFAULTS: DATE OF PROCEDURE IS TODAY, STATUS IS OPEN.
"RTN","WVPROC",99,0)
 .S DRSTRG=".02////"_DFN_";.04////"_PCDIEN
"RTN","WVPROC",100,0)
 .S DRSTRG=DRSTRG_";.09///"_$S($D(WVLFRT):WVLFRT,1:"")_";.12///"_DATE
"RTN","WVPROC",101,0)
 .S DRSTRG=DRSTRG_";.14///o"
"RTN","WVPROC",102,0)
 .S DRSTRG=DRSTRG_";.18////"_DUZ_";.19///T;.3////"_$G(PREVPAP)
"RTN","WVPROC",103,0)
 .S DRSTRG=DRSTRG_";.34////"_$G(DUZ(2))
"RTN","WVPROC",104,0)
 ;
"RTN","WVPROC",105,0)
 D FILE^WVFMAN(790.1,DRSTRG,"ML",X,790,.Y)
"RTN","WVPROC",106,0)
 ;---> IF Y<0, CHECK PERMISSIONS.
"RTN","WVPROC",107,0)
 I Y<0 D  Q
"RTN","WVPROC",108,0)
 .S ERROR=Y
"RTN","WVPROC",109,0)
 .Q:$D(ZTQUEUED)  ;quit if a background (tasked) job
"RTN","WVPROC",110,0)
 .W !?5,*7,"UNABLE TO CREATE NEW PROCEDURE."
"RTN","WVPROC",111,0)
 .D DIRZ^WVUTL3 S WVPOP=1
"RTN","WVPROC",112,0)
 .Q
"RTN","WVPROC",113,0)
 S DA=+Y
"RTN","WVPROC",114,0)
 Q
"RTN","WVPROC",115,0)
 ;
"RTN","WVPROC",116,0)
 ;
"RTN","WVPROC",117,0)
EDIT ;EP
"RTN","WVPROC",118,0)
 ;---> CALLED BY OPTION: "WV EDIT PROCEDURE".
"RTN","WVPROC",119,0)
 ;---> EDIT AN EXISTING PROCEDURE.
"RTN","WVPROC",120,0)
 D TITLE^WVUTL5("EDIT A PROCEDURE")
"RTN","WVPROC",121,0)
 D LKUPPCD(.Y)
"RTN","WVPROC",122,0)
 Q:Y<0
"RTN","WVPROC",123,0)
 ;---> DA=IEN OF PROCEDURE IN PROCEDURE FILE 790.1.
"RTN","WVPROC",124,0)
 S DA=+Y D ^WVRADWP
"RTN","WVPROC",125,0)
 D EDIT2^WVPROC1(DA,.WVPOP) Q:WVPOP!($D(WVNOFOL))
"RTN","WVPROC",126,0)
 D EX^WVRADWP
"RTN","WVPROC",127,0)
 D PCDVARS^WVUTL3(DA,1)
"RTN","WVPROC",128,0)
 D NORMAL^WVPROC1
"RTN","WVPROC",129,0)
 D EXIT
"RTN","WVPROC",130,0)
 Q
"RTN","WVPROC",131,0)
 ;
"RTN","WVPROC",132,0)
 ;
"RTN","WVPROC",133,0)
HISTORIC ;EP
"RTN","WVPROC",134,0)
 ;---> CALLED BY OPTION: "WV ADD AN HISTORICAL PROCEDURE".
"RTN","WVPROC",135,0)
 ;---> ADD HISTORICAL PROCEDURES (NO PROVIDER, WARD/CLINIC, FACILITY).
"RTN","WVPROC",136,0)
 D SETVARS^WVUTL5 S WVPOP1=0 N DA,DIE,Y
"RTN","WVPROC",137,0)
 F  D  Q:WVPOP1
"RTN","WVPROC",138,0)
 .D TITLE^WVUTL5("ENTER HISTORICAL DATA")
"RTN","WVPROC",139,0)
 .D NEWNT W !
"RTN","WVPROC",140,0)
 .Q:(WVPOP!('$G(DA)))
"RTN","WVPROC",141,0)
 .S WVPN=$P(^WV(790.1,DA,0),U,4)
"RTN","WVPROC",142,0)
 .S DR=".05;.08;.1;.14////c"
"RTN","WVPROC",143,0)
 .D DIE^WVFMAN(790.1,DR,DA,.WVPOP)
"RTN","WVPROC",144,0)
 D EXIT
"RTN","WVPROC",145,0)
 Q
"RTN","WVPROC",146,0)
 ;
"RTN","WVPROC",147,0)
 ;
"RTN","WVPROC",148,0)
LABEDIT ;EP
"RTN","WVPROC",149,0)
 ;---> CALLED BY OPTION: "WV LAB EDIT PROCEDURE".
"RTN","WVPROC",150,0)
 S WVNOFOL=1 D EDIT,EXIT
"RTN","WVPROC",151,0)
 Q
"RTN","WVPROC",152,0)
 ;
"RTN","WVPROC",153,0)
 ;
"RTN","WVPROC",154,0)
RADMOD(DA) ;EP
"RTN","WVPROC",155,0)
 ;---> MODIFY A PROCEDURE THAT WAS IMPORTED FROM RADIOLOGY AND
"RTN","WVPROC",156,0)
 ;---> HAS BEEN CHANGED.
"RTN","WVPROC",157,0)
 ;---> DA=IEN OF PROCEDURE IN WV PROCEDURE FILE #790.1.
"RTN","WVPROC",158,0)
 Q:'$G(DA)
"RTN","WVPROC",159,0)
 S DR=".13////"_DT_";.14////o"
"RTN","WVPROC",160,0)
 D DIE^WVFMAN(790.1,DR,DA,.WVPOP)
"RTN","WVPROC",161,0)
 Q
"RTN","WVPROC",162,0)
 ;
"RTN","WVPROC",163,0)
 ;
"RTN","WVPROC",164,0)
LKUPPCD(Y) ;EP
"RTN","WVPROC",165,0)
 ;---> LOOKUP A PROCEDURE.
"RTN","WVPROC",166,0)
 N A
"RTN","WVPROC",167,0)
 D SETVARS^WVUTL5
"RTN","WVPROC",168,0)
 S A="Select ACCESSION# or PATIENT NAME: "
"RTN","WVPROC",169,0)
 D DIC^WVFMAN(790.1,"QEMA",.Y,A,"","","",.WVPOP)
"RTN","WVPROC",170,0)
 Q
"RTN","WVPROC",171,0)
 ;
"RTN","WVPROC",172,0)
DATECHK ;EP
"RTN","WVPROC",173,0)
 ;---> PROMPT FOR DATE, CHECK FOR DUPLICATE PROCEDURE ON SAME DATE.
"RTN","WVPROC",174,0)
 N WVNEW,DIR,DIRUT,N,Y S WVPOP=0
"RTN","WVPROC",175,0)
 S DIR("?",1)="   Enter the date on which this procedure was performed:"
"RTN","WVPROC",176,0)
 S DIR("?")="   (NOTE: Dates in the future may NOT be entered.)"
"RTN","WVPROC",177,0)
 S DIR(0)="DA^0:DT:EX",DIR("A")="   Select DATE:      ",DIR("B")="TODAY"
"RTN","WVPROC",178,0)
 D ^DIR K DIR
"RTN","WVPROC",179,0)
 I Y<1 S WVPOP=1 Q
"RTN","WVPROC",180,0)
 S WVPCDT=Y D DD^%DT W "  ",Y
"RTN","WVPROC",181,0)
 S N=0,WVNEW=0
"RTN","WVPROC",182,0)
 F  S N=$O(^WV(790.1,"C",WVDFN,N)) Q:('N)!(WVPOP)!(WVNEW)  D
"RTN","WVPROC",183,0)
 .S Y=^WV(790.1,N,0)
"RTN","WVPROC",184,0)
 .;---> QUIT IF NOT THE SAME PROCEDURE TYPE.
"RTN","WVPROC",185,0)
 .Q:$P(Y,U,4)'=WVPCDN
"RTN","WVPROC",186,0)
 .;---> QUIT IF NOT THE SAME PROCEDURE DATE.
"RTN","WVPROC",187,0)
 .Q:$P(Y,U,12)'=WVPCDT
"RTN","WVPROC",188,0)
 .;---> QUIT IF THIS PROCEDURE HAS A RESULT/DIAG OF "ERROR/DISREGARD".
"RTN","WVPROC",189,0)
 .Q:$P(Y,U,5)=8
"RTN","WVPROC",190,0)
 .N WVPN S WVPN=$P(^WV(790.2,$P(Y,U,4),0),U)
"RTN","WVPROC",191,0)
 .W !!?5,"A ",WVPN," already exists for this patient on this date,"
"RTN","WVPROC",192,0)
 .W !?5,"with an Accession# of ",$P(Y,U)
"RTN","WVPROC",193,0)
 .W ".  You may edit that procedure by"
"RTN","WVPROC",194,0)
 .W !?5,"calling up ",$P(Y,U)," under the ""Edit a Procedure"" option."
"RTN","WVPROC",195,0)
 .W !?5,"Or you may enter another ",WVPN," for this patient"
"RTN","WVPROC",196,0)
 .W !?5,"on this date."
"RTN","WVPROC",197,0)
 .W !!?5,"Do you REALLY want to add another ",WVPN," for this patient"
"RTN","WVPROC",198,0)
 .W !?5,"on this date?"
"RTN","WVPROC",199,0)
 .S DIR("?")="       Enter NO to avoid adding another "_WVPN
"RTN","WVPROC",200,0)
 .S DIR("?")=DIR("?")_" on this date."
"RTN","WVPROC",201,0)
 .S DIR(0)="Y",DIR("A")="     Enter Yes or No",DIR("B")="NO"
"RTN","WVPROC",202,0)
 .D ^DIR K DIR
"RTN","WVPROC",203,0)
 .I $D(DIRUT)!('Y) S WVPOP=1 Q
"RTN","WVPROC",204,0)
 .S WVNEW=1
"RTN","WVPROC",205,0)
 Q
"RTN","WVPROC",206,0)
 ;
"RTN","WVPROC",207,0)
ERROR1 ;EP
"RTN","WVPROC",208,0)
 W !!?10,*7,"NEW PROCEDURE ENTRY FOR THIS PATIENT FAILED."
"RTN","WVPROC",209,0)
 Q
"RTN","WVRALINK")
0^8^B42490814
"RTN","WVRALINK",1,0)
WVRALINK ;HCIOFO/FT IHS/ANMC/MWR - RAD/NM-WOMEN'S HEALTH LINK  ;12/7/98  15:53
"RTN","WVRALINK",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WVRALINK",3,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVRALINK",4,0)
 ;;  CREATE MAMMOGRAM PROCEDURE IN WOMEN'S HEALTH FOR THIS PATIENT.
"RTN","WVRALINK",5,0)
 ;;  CALLED BY ^RART WHEN A RADIOLOGY REPORT IS VERIFIED.
"RTN","WVRALINK",6,0)
 ;;  CALLED BY ^RARTE1 WHEN A RADIOLOGY REPORT IS UNVERIFIED.
"RTN","WVRALINK",7,0)
 ;;  CALLED BY ^WVEXPTRA WHEN EXPORTING HISTORICAL MAMS TO WOMEN'S HEALTH
"RTN","WVRALINK",8,0)
 ;
"RTN","WVRALINK",9,0)
 ;---> REQUIRED VARIABLES: DFN  = DFN OF RADIOLOGY PATIENT.
"RTN","WVRALINK",10,0)
 ;--->                     DATE = INVERSE DATE/TIME OF VISIT.
"RTN","WVRALINK",11,0)
 ;--->                     CASE = IEN OF RADIOLOGY EXAM (CASE).
"RTN","WVRALINK",12,0)
 ;
"RTN","WVRALINK",13,0)
 ;---> OPTIONAL VARIABLE:  WVNEWP = TOTAL NEW WH PATIENTS ADDED.
"RTN","WVRALINK",14,0)
 ;--->                     WVMCNT = TOTAL NEW MAMS PROCEDURES ADDED.
"RTN","WVRALINK",15,0)
 ;--->                     THESE IF CALLED FROM ^WVEXPTRA ROUTINE.
"RTN","WVRALINK",16,0)
 ;
"RTN","WVRALINK",17,0)
 ;---> GENERATED VARIBLES:
"RTN","WVRALINK",18,0)
 ;---> WVPROC = IEN OF RADIOLOGY PROCEDURE (FILE #71), THEN IT
"RTN","WVRALINK",19,0)
 ;--->          GETS CHANGED TO WOMEN'S HEALTH PROCEDURE TYPE
"RTN","WVRALINK",20,0)
 ;--->                                   (FILE #790.2).
"RTN","WVRALINK",21,0)
 ;---> WVLOC  = WARD/CLINIC/LOCATION (FILE #44).
"RTN","WVRALINK",22,0)
 ;---> WVDATE = DATE OF THE PROCEDURE.
"RTN","WVRALINK",23,0)
 ;---> WVPROV = ORDERING PROVIDER.
"RTN","WVRALINK",24,0)
 ;---> WVMOD  = LEFT OR RIGHT, IF IT'S A UNILATERAL MAMMOGRAM.
"RTN","WVRALINK",25,0)
 ;---> WVDX   = RADIOLOGY DIAGNOSTIC CODE.
"RTN","WVRALINK",26,0)
 ;---> WVBWDX = WOMEN'S HEALTH RESULT/DIAGNOSIS.
"RTN","WVRALINK",27,0)
 ;
"RTN","WVRALINK",28,0)
CREATE(DFN,DATE,CASE) ;
"RTN","WVRALINK",29,0)
 Q:'+$$VERSION^XPDUTL("WV")
"RTN","WVRALINK",30,0)
 Q:($G(DFN)']"")!($G(DATE)']"")!($G(CASE)']"")
"RTN","WVRALINK",31,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","WVRALINK",32,0)
 S ZTRTN="CREATEQ^WVRALINK",ZTDESC="WV CREATE MAMMOGRAM ENTRY"
"RTN","WVRALINK",33,0)
 S ZTSAVE("DFN")="",ZTSAVE("DATE")="",ZTSAVE("CASE")=""
"RTN","WVRALINK",34,0)
 S ZTIO="",ZTDTH=$H
"RTN","WVRALINK",35,0)
 D ^%ZTLOAD
"RTN","WVRALINK",36,0)
 Q
"RTN","WVRALINK",37,0)
CREATEH(DFN,DATE,CASE,STATUS) ; Entry from ^WVEXPTRA which looks for exams
"RTN","WVRALINK",38,0)
 ; created before the WH package was installed.
"RTN","WVRALINK",39,0)
 Q:($G(DFN)']"")!($G(DATE)']"")!($G(CASE)']"")!($G(STATUS)']"")
"RTN","WVRALINK",40,0)
 ; 
"RTN","WVRALINK",41,0)
CREATEQ ; Queue data entry creation. Called from CREATE above
"RTN","WVRALINK",42,0)
 N WVPROC,WVLOC,WVDATE,WVPROV,WVMOD,WVDX,WVBWDX,WVLEFT,WVRIGHT
"RTN","WVRALINK",43,0)
 N WVCASE,WVCPT,WVERR,WVCREDIT ;,WVEXAM0
"RTN","WVRALINK",44,0)
 ;---> QUIT IF RADIOLOGY DATA IS NOT DEFINED OR ="".
"RTN","WVRALINK",45,0)
 Q:'$D(^RADPT(DFN,"DT",DATE,"P",CASE,0))
"RTN","WVRALINK",46,0)
 ;
"RTN","WVRALINK",47,0)
 ;---> QUIT IF THIS PROCEDURE DOES NOT HAVE A MAM CPT CODE.
"RTN","WVRALINK",48,0)
 ;---> QUIT IF THIS PROCEDURE DOES NOT HAVE A BREAST ULTRASOUND CPT CODE.
"RTN","WVRALINK",49,0)
 ;---> WVEXAM0=ZERO NODE OF RADIOLOGY EXAM.
"RTN","WVRALINK",50,0)
 S WVEXAM0=^RADPT(DFN,"DT",DATE,"P",CASE,0)
"RTN","WVRALINK",51,0)
 S WVCPT=$P(^RAMIS(71,$P(WVEXAM0,U,2),0),U,9)
"RTN","WVRALINK",52,0)
 Q:(WVCPT'=76090)&(WVCPT'=76091)&(WVCPT'=76092)&(WVCPT'=76645)
"RTN","WVRALINK",53,0)
 Q:$P($G(^DPT(DFN,0)),U,2)'="F"  ;not female
"RTN","WVRALINK",54,0)
 ;
"RTN","WVRALINK",55,0)
 ;---> QUIT IF NO WOMEN'S HEALTH SITE PARAMETER FILE ON THIS MACHINE.
"RTN","WVRALINK",56,0)
 ;     OR NO DEFAULT CASE MANAGER
"RTN","WVRALINK",57,0)
 Q:'$D(^WV(790.02,DUZ(2)))
"RTN","WVRALINK",58,0)
 Q:'$P($G(^WV(790.02,+$G(DUZ(2)),0)),U,2)
"RTN","WVRALINK",59,0)
 ;
"RTN","WVRALINK",60,0)
 ;---> IF NOT CALLED FROM ^WVEXPTRA (i.e., STATUS is undefined) CHECK
"RTN","WVRALINK",61,0)
 ;---> SITE PARAMETER AND QUIT IF "IMPORT MAMMOGRAMS FROM RADIOLOGY"
"RTN","WVRALINK",62,0)
 ;---> IS NOT SET TO "YES".
"RTN","WVRALINK",63,0)
 N Y S Y=^WV(790.02,DUZ(2),0)
"RTN","WVRALINK",64,0)
 I '$D(STATUS) Q:'$P(Y,U,10)
"RTN","WVRALINK",65,0)
 ;
"RTN","WVRALINK",66,0)
 ;---> SET WVZSTAT =THE STATUS (OPEN OR CLOSED) IN WOMEN'S HEALTH.
"RTN","WVRALINK",67,0)
 ;---> THAT MAMMOGRAMS SHOULD RECEIVE WHEN COPIED OVER FROM RADIOLOGY.
"RTN","WVRALINK",68,0)
 S WVZSTAT=$P(Y,U,23) S:WVZSTAT="" WVZSTAT="o"
"RTN","WVRALINK",69,0)
 I $G(STATUS)]"" S WVZSTAT=$G(STATUS) ;status selected in ^WVEXPTRA
"RTN","WVRALINK",70,0)
 ;
"RTN","WVRALINK",71,0)
 ;---> BELOW ARE IENS FOR WV PROCEDURE TYPE FILE #790.2.
"RTN","WVRALINK",72,0)
 ;---> IEN 26 IN ^WV(790.2, IS UNILATERAL MAMMOGRAM.
"RTN","WVRALINK",73,0)
 ;---> IEN 25 IN ^WV(790.2, IS BILATERAL MAMMOGRAM.
"RTN","WVRALINK",74,0)
 ;---> IEN 28 IN ^WV(790.2, IS SCREENING MAMMOGRAM.
"RTN","WVRALINK",75,0)
 ;---> IEN 38 IN ^WV(790.2, IS ECHO EXAM OF BREAST.
"RTN","WVRALINK",76,0)
 I WVCPT=76090 S WVPROC=26 D COPY(WVEXAM0) G EXIT
"RTN","WVRALINK",77,0)
 I WVCPT=76091 S WVPROC=25 D COPY(WVEXAM0) G EXIT
"RTN","WVRALINK",78,0)
 I WVCPT=76092 S WVPROC=28 D COPY(WVEXAM0) G EXIT
"RTN","WVRALINK",79,0)
 I WVCPT=76645 S WVPROC=38 D COPY(WVEXAM0) G EXIT
"RTN","WVRALINK",80,0)
 ;
"RTN","WVRALINK",81,0)
EXIT ;EP
"RTN","WVRALINK",82,0)
 K I,N,X
"RTN","WVRALINK",83,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVRALINK",84,0)
 Q
"RTN","WVRALINK",85,0)
 ;
"RTN","WVRALINK",86,0)
 ;
"RTN","WVRALINK",87,0)
COPY(Y) ;EP
"RTN","WVRALINK",88,0)
 ;---> COPY MAM PROCEDURE DATA FROM RADIOLOGY TO WOMEN'S HEALTH.
"RTN","WVRALINK",89,0)
 ;---> VARIABLE DFN=PATIENT
"RTN","WVRALINK",90,0)
 ;---> LOCATION=DUZ(2)
"RTN","WVRALINK",91,0)
 ;---> WARD/CLINIC/LOCATION
"RTN","WVRALINK",92,0)
 N X
"RTN","WVRALINK",93,0)
 S WVLOC=$P(Y,U,8)
"RTN","WVRALINK",94,0)
 ;
"RTN","WVRALINK",95,0)
 ;---> WVDATE=DATE OF THE PROCEDURE.
"RTN","WVRALINK",96,0)
 S WVDATE=$P($P(^RADPT(DFN,"DT",DATE,0),U),".")
"RTN","WVRALINK",97,0)
 ;
"RTN","WVRALINK",98,0)
 ;---> RECONSTRUCT THE FULL CASE# FOR THIS RAD PROCEDURE.
"RTN","WVRALINK",99,0)
 ;---> THIS IS USED AS A LINK (XREF) BETWEEN THE RADIOLOGY PROCEDURE
"RTN","WVRALINK",100,0)
 ;---> AND THE WOMEN'S HEALTH PROCEDURE.
"RTN","WVRALINK",101,0)
 S WVCASE=$E(WVDATE,4,7)_$E(WVDATE,2,3)_"-"_$P(Y,U)
"RTN","WVRALINK",102,0)
 ;---> CHECK TO BE SURE THE CASE# XREF IS REALLY DOWN THERE.
"RTN","WVRALINK",103,0)
 S:'$D(^RADPT("ADC",WVCASE,DFN,DATE,CASE)) WVCASE="UNKNOWN"
"RTN","WVRALINK",104,0)
 ;
"RTN","WVRALINK",105,0)
 ;---> QUIT IF THIS PROCEDURE HAS ALREADY BEEN SENT TO WOMEN'S HEALTH.
"RTN","WVRALINK",106,0)
 Q:$D(^WV(790.1,"E",WVCASE))
"RTN","WVRALINK",107,0)
 ;
"RTN","WVRALINK",108,0)
 ;---> REQUESTING PROVIDER/ORDERING PROVIDER
"RTN","WVRALINK",109,0)
 S WVPROV=$P(Y,U,14)
"RTN","WVRALINK",110,0)
 ;
"RTN","WVRALINK",111,0)
 ;---> IF UNILATERAL, ATTEMPT TO PICK UP LEFT OR RIGHT MODIFIER.
"RTN","WVRALINK",112,0)
 I WVPROC=26 D
"RTN","WVRALINK",113,0)
 .I $D(^RADPT(DFN,"DT",DATE,"P",CASE,"M",0)) D
"RTN","WVRALINK",114,0)
 ..N N S N=0
"RTN","WVRALINK",115,0)
 ..F  S N=$O(^RADPT(DFN,"DT",DATE,"P",CASE,"M",N)) Q:'N  D
"RTN","WVRALINK",116,0)
 ...S WVMOD=$P(^RADPT(DFN,"DT",DATE,"P",CASE,"M",N,0),U)
"RTN","WVRALINK",117,0)
 ...S WVMOD=$P(^RAMIS(71.2,WVMOD,0),U)
"RTN","WVRALINK",118,0)
 ...I "LEFTleft"[WVMOD S WVLEFT=1
"RTN","WVRALINK",119,0)
 ...I "RIGHTright"[WVMOD S WVRIGHT=1
"RTN","WVRALINK",120,0)
 ..Q:$D(WVLEFT)&($D(WVRIGHT))
"RTN","WVRALINK",121,0)
 ..I $D(WVLEFT) S WVMOD="l" Q
"RTN","WVRALINK",122,0)
 ..I $D(WVRIGHT) S WVMOD="r" Q
"RTN","WVRALINK",123,0)
 ;
"RTN","WVRALINK",124,0)
 ;---> IF THERE'S A DIAGNOSTIC CODE, ATTEMPT TO PICK UP DIAGNOSIS.
"RTN","WVRALINK",125,0)
 ;---> USE "WV DIAGNOSTIC CODE TRANSLATION" FILE #790.32.
"RTN","WVRALINK",126,0)
 S WVDX=$P(Y,U,13)
"RTN","WVRALINK",127,0)
 I +WVDX I $D(^WV(790.32,"C",WVDX)) S WVBWDX=$O(^WV(790.32,"C",WVDX,0))
"RTN","WVRALINK",128,0)
 ;
"RTN","WVRALINK",129,0)
 ;---> GET CREDIT METHOD.
"RTN","WVRALINK",130,0)
 S WVCREDIT=$P(Y,U,26)
"RTN","WVRALINK",131,0)
 ;
"RTN","WVRALINK",132,0)
PATIENT ;---> IF PATIENT ISN'T IN WOMEN'S HEALTH DATABASE, ADD HER.
"RTN","WVRALINK",133,0)
 S WVERR=1
"RTN","WVRALINK",134,0)
 I '$D(^WV(790,DFN,0)) D
"RTN","WVRALINK",135,0)
 .D AUTOADD^WVPATE(DFN,DUZ(2),.WVERR)
"RTN","WVRALINK",136,0)
 .I $D(WVNEWP) S:WVERR WVNEWP=WVNEWP+1
"RTN","WVRALINK",137,0)
 Q:WVERR<0
"RTN","WVRALINK",138,0)
 ;
"RTN","WVRALINK",139,0)
PROC ;---> CREATE MAMMOGRAM PROCEDURE IN WV PROCEDURE FILE #790.1.
"RTN","WVRALINK",140,0)
 ;
"RTN","WVRALINK",141,0)
 S WVDR=".02////"_DFN_";.04////"_WVPROC
"RTN","WVRALINK",142,0)
 S WVDR=WVDR_";.05////"_$G(WVBWDX)_";.07////"_WVPROV
"RTN","WVRALINK",143,0)
 S WVDR=WVDR_";.09////"_$G(WVMOD)_";.1////"_DUZ(2)_";.11////"_WVLOC
"RTN","WVRALINK",144,0)
 S WVDR=WVDR_";.12////"_WVDATE_";.14////"_WVZSTAT_";.15////"_WVCASE
"RTN","WVRALINK",145,0)
 S WVDR=WVDR_";.18////.5;.19////"_DT_";.34////"_$G(DUZ(2))_";.35////"_WVCREDIT
"RTN","WVRALINK",146,0)
 ;
"RTN","WVRALINK",147,0)
 D NEW2^WVPROC(DFN,WVPROC,WVDATE,WVDR,"","",.WVERR)
"RTN","WVRALINK",148,0)
 I $D(WVMCNT) S:WVERR>-1 WVMCNT=WVMCNT+1
"RTN","WVRALINK",149,0)
 Q:WVERR<0  ;procedure not added
"RTN","WVRALINK",150,0)
 Q:$D(WVMCNT)  ;mass import of Rad/NM exams
"RTN","WVRALINK",151,0)
 D MAIL^WVRADWP(DFN,+Y,WVPROC,WVPROV) ;iens for patient, accession, procedure, provider/requestor
"RTN","WVRALINK",152,0)
 Q
"RTN","WVRALINK",153,0)
 ;
"RTN","WVRALINK",154,0)
 ;
"RTN","WVRALINK",155,0)
DELETE(DFN,DATE,CASE) ;EP
"RTN","WVRALINK",156,0)
 ;---> MODIFY WOMEN'S HEALTH PROCEDURE TO REFLECT CHANGE.
"RTN","WVRALINK",157,0)
 ;---> CALLED FROM RARTE1 (DELETE A REPORT AND UNVERIFY A REPORT).
"RTN","WVRALINK",158,0)
 ;
"RTN","WVRALINK",159,0)
 Q:'+$$VERSION^XPDUTL("WV")
"RTN","WVRALINK",160,0)
 Q:'$D(DFN)!('$D(DATE))!('$D(CASE))
"RTN","WVRALINK",161,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","WVRALINK",162,0)
 S ZTRTN="DELETEQ^WVRALINK",ZTDESC="WV MAMMOGRAM RPT CHANGE"
"RTN","WVRALINK",163,0)
 S ZTSAVE("DFN")="",ZTSAVE("DATE")="",ZTSAVE("CASE")=""
"RTN","WVRALINK",164,0)
 S ZTIO="",ZTDTH=$H
"RTN","WVRALINK",165,0)
 D ^%ZTLOAD
"RTN","WVRALINK",166,0)
 Q
"RTN","WVRALINK",167,0)
DELETEQ ; Modify WV entry when mammogram report is unverified or deleted
"RTN","WVRALINK",168,0)
 Q:'$D(^RADPT(DFN,"DT",DATE,"P",CASE,0))
"RTN","WVRALINK",169,0)
 N WVIEN,WVDATE,WVCASE,WVCMGR,WVLOOP,WVMSG,WVPROV
"RTN","WVRALINK",170,0)
 N XMDUZ,XMSUB,XMTEXT,XMY ;send mail message to case manager
"RTN","WVRALINK",171,0)
 ;
"RTN","WVRALINK",172,0)
 ;---> WVDATE=DATE OF PROCEDURE.
"RTN","WVRALINK",173,0)
 S WVDATE=$P($P(^RADPT(DFN,"DT",DATE,0),U),".")
"RTN","WVRALINK",174,0)
 S WVCASE=$P(^RADPT(DFN,"DT",DATE,"P",CASE,0),U)
"RTN","WVRALINK",175,0)
 ;
"RTN","WVRALINK",176,0)
 ;---> WVCASE=RECONSTRUCTED CASE# OF PROCEDURE.
"RTN","WVRALINK",177,0)
 S WVCASE=$E(WVDATE,4,7)_$E(WVDATE,2,3)_"-"_WVCASE
"RTN","WVRALINK",178,0)
 ;---> QUIT IF NO CASE# XREF IN WOMEN'S HEALTH PROCEDURE FILE.
"RTN","WVRALINK",179,0)
 Q:'$D(^WV(790.1,"E",WVCASE))
"RTN","WVRALINK",180,0)
 ;
"RTN","WVRALINK",181,0)
 S WVIEN=$O(^WV(790.1,"E",WVCASE,0))
"RTN","WVRALINK",182,0)
 Q:'$D(^WV(790.1,WVIEN,0))
"RTN","WVRALINK",183,0)
 D RADMOD^WVPROC(WVIEN) ;update wh status to "open"
"RTN","WVRALINK",184,0)
 S WVPROV=+$$GET1^DIQ(790.1,WVIEN,.07,"I") ;get provider/requestor
"RTN","WVRALINK",185,0)
 S WVCMGR=+$$GET1^DIQ(790,DFN,.1,"I") ;get case manager
"RTN","WVRALINK",186,0)
 S:WVCMGR XMY(WVCMGR)=""
"RTN","WVRALINK",187,0)
 ; if no case manager, then get default case manager(s)
"RTN","WVRALINK",188,0)
 I 'WVCMGR S WVLOOP=0 F  S WVLOOP=$O(^WV(790.02,WVLOOP)) Q:'WVLOOP  D
"RTN","WVRALINK",189,0)
 .S WVCMGR=$$GET1^DIQ(790.02,WVLOOP,.02,"I")
"RTN","WVRALINK",190,0)
 .S:WVCMGR XMY(WVCMGR)=""
"RTN","WVRALINK",191,0)
 .Q
"RTN","WVRALINK",192,0)
 Q:$O(XMY(0))'>0  ;no case manager(s)
"RTN","WVRALINK",193,0)
 S:WVPROV XMY(WVPROV)=""
"RTN","WVRALINK",194,0)
 S XMDUZ=.5 ;message sender
"RTN","WVRALINK",195,0)
 S XMSUB="RAD/NM Rpt for WH patient is UNVERIFIED/DELETED"
"RTN","WVRALINK",196,0)
 S WVMSG(1)="        Patient: "_$P($G(^DPT(DFN,0)),U,1)_" (SSN: "_$$SSN^WVUTL1(DFN)_")"
"RTN","WVRALINK",197,0)
 S WVMSG(2)=" WH Accession #: "_$P($G(^WV(790.1,+WVIEN,0)),U,1)
"RTN","WVRALINK",198,0)
 S WVMSG(3)="  RAD/NM Case #: "_WVCASE
"RTN","WVRALINK",199,0)
 S WVMSG(4)=" "
"RTN","WVRALINK",200,0)
 S WVMSG(5)="NOTE: THIS PROCEDURE HAS BEEN ALTERED IN RADIOLOGY/NM."
"RTN","WVRALINK",201,0)
 S WVMSG(6)="Follow-up is required in the WOMEN'S HEALTH package!"
"RTN","WVRALINK",202,0)
 S XMTEXT="WVMSG("
"RTN","WVRALINK",203,0)
 D ^XMD
"RTN","WVRALINK",204,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVRALINK",205,0)
 Q
"RTN","WVREFUSE")
0^9^B10341963
"RTN","WVREFUSE",1,0)
WVREFUSE ;HCIOFO/JWR - Add/Enter/Manipulate procedure refusals ;12/9/98  15:56
"RTN","WVREFUSE",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WVREFUSE",3,0)
EDREF ;EDIT AN EXISTING REFUSAL
"RTN","WVREFUSE",4,0)
 D EXIT,SETVARS^WVUTL5
"RTN","WVREFUSE",5,0)
 D TITLE^WVUTL5("EDIT A REFUSED TREATMENT") W !!
"RTN","WVREFUSE",6,0)
 K DIC S DIC("A")="   Select DATE REFUSED: ",WVPOP=0
"RTN","WVREFUSE",7,0)
 S DIC="^WV(790.3,",DIC(0)="QEMALZ" D ^DIC
"RTN","WVREFUSE",8,0)
 I Y'>0!($D(DUOUT))!($D(DTOUT)) D EXIT Q
"RTN","WVREFUSE",9,0)
 S WVDFN=$P($G(^WV(790.3,+Y,0)),U,2),DIDEL=790.3
"RTN","WVREFUSE",10,0)
 D DDS^WVFMAN(790.3,"[WV REFUSED PROCEDURE-ENTRY]",+Y)
"RTN","WVREFUSE",11,0)
 G EDREF
"RTN","WVREFUSE",12,0)
 Q
"RTN","WVREFUSE",13,0)
ADDREF ;ADD A NEW REFUSAL (not used now, use UNIV for adding a refusal)
"RTN","WVREFUSE",14,0)
 D SETVARS^WVUTL5
"RTN","WVREFUSE",15,0)
 D TITLE^WVUTL5("ADD A REFUSED PROCEDURE")
"RTN","WVREFUSE",16,0)
 K DIR S DIR("A")="   Select DATE REFUSED: ",WVDFN=""
"RTN","WVREFUSE",17,0)
 S DIR(0)="DAO",DIR("B")="TODAY"
"RTN","WVREFUSE",18,0)
 D ^DIR K DIR I Y'>0 D EXIT Q
"RTN","WVREFUSE",19,0)
 S DIC("DR")="1;2"
"RTN","WVREFUSE",20,0)
 S DIC="^WV(790.3,",DIC(0)="QEMAL",X=Y
"RTN","WVREFUSE",21,0)
 K DD,DO D FILE^DICN
"RTN","WVREFUSE",22,0)
 Q:Y'>0
"RTN","WVREFUSE",23,0)
 S WVDFN=$P($G(^WV(790.3,+Y,0)),U,2)
"RTN","WVREFUSE",24,0)
 D DDS^WVFMAN(790.3,"[WV REFUSED PROCEDURE-ENTRY]",+Y)
"RTN","WVREFUSE",25,0)
 D EXIT Q
"RTN","WVREFUSE",26,0)
CHECK ;Checks for existing refusals for this patient within 30 day period
"RTN","WVREFUSE",27,0)
 ; for this procedure.
"RTN","WVREFUSE",28,0)
 Q:'$D(^WV(790.3,"C",WVDFN))
"RTN","WVREFUSE",29,0)
 N A,B,C,D,E,F K WVJR,WVJR1,DR,DIC,DA
"RTN","WVREFUSE",30,0)
 S X1=DT,X2=-30 D C^%DTC S A=X
"RTN","WVREFUSE",31,0)
 S X1=DT,X2=+30 D C^%DTC S B=X
"RTN","WVREFUSE",32,0)
 S G=0 F  S G=$O(^WV(790.3,"C",WVDFN,G)) Q:G'>0  S H=$G(^WV(790.3,G,0)) D
"RTN","WVREFUSE",33,0)
 .Q:$P(H,U)'>A!($P(H,U))'<B
"RTN","WVREFUSE",34,0)
 .Q:$P(H,U,3)'=WVJPR
"RTN","WVREFUSE",35,0)
 .S E=$P(H,U,3),D=$P(H,U)
"RTN","WVREFUSE",36,0)
 .S E=$S(E>0:$P($G(^WV(790.2,E,0)),U),1:"")
"RTN","WVREFUSE",37,0)
 .S Y=D D DD^%DT S F=Y
"RTN","WVREFUSE",38,0)
 .S WVJR(D,G)=F_"    "_E
"RTN","WVREFUSE",39,0)
 S C=1,A=0 F  S A=$O(WVJR(A)) Q:A'>0  S B=0 F  S B=$O(WVJR(A,B)) Q:B'>0  D
"RTN","WVREFUSE",40,0)
 .S WVJR1(C)=B_"^"_WVJR(A,B),C=C+1
"RTN","WVREFUSE",41,0)
 S WVC=C-1 I $D(WVJR1) D
"RTN","WVREFUSE",42,0)
 .W !!,"The following Entries for this patient and procedure already exist in the"
"RTN","WVREFUSE",43,0)
 .W !,"Procedure Refusal file.",!
"RTN","WVREFUSE",44,0)
 .D LOOP W !!
"RTN","WVREFUSE",45,0)
 .K DIR S DIR("A")="Is this a NEW Refusal?  ",DIR(0)="YAO"
"RTN","WVREFUSE",46,0)
 .S DIR("B")="Yes" D ^DIR K DIR Q:Y=1!($D(DIRUT))
"RTN","WVREFUSE",47,0)
 .S DIR("A")="Select a Number to edit a refusal from the list.  "
"RTN","WVREFUSE",48,0)
 .S DIR(0)="NAO^1:"_WVC
"RTN","WVREFUSE",49,0)
 .D ^DIR K DIR S WVEDREF=$S(+Y>0:+Y,1:"NS") Q:Y'>0
"RTN","WVREFUSE",50,0)
 Q
"RTN","WVREFUSE",51,0)
UNIV ;Add new Refusal & check other recent (within 30 days) Refusals
"RTN","WVREFUSE",52,0)
 D SETVARS^WVUTL5
"RTN","WVREFUSE",53,0)
 D TITLE^WVUTL5("ADD/EDIT A REFUSED TREATMENT")
"RTN","WVREFUSE",54,0)
 W !! K DIC S DIC("A")="   Select PATIENT: "
"RTN","WVREFUSE",55,0)
 S DIC(0)="AEMQZ",DIC="^WV(790,",DIC("W")="D LOOKL^WVUTL1A(+Y)"
"RTN","WVREFUSE",56,0)
 D ^DIC K DIC I Y'>0 D EXIT Q
"RTN","WVREFUSE",57,0)
 S WVDFN=+Y
"RTN","WVREFUSE",58,0)
 S DIR("A")="   DATE REFUSED: "
"RTN","WVREFUSE",59,0)
 S DIR(0)="DAO"
"RTN","WVREFUSE",60,0)
 D ^DIR K DIR I Y'>0 D EXIT Q
"RTN","WVREFUSE",61,0)
 S WVJDAY=+Y
"RTN","WVREFUSE",62,0)
 S DIR(0)="PAO^790.2:AEMNQZ",DIR("A")="   PROCEDURE: "
"RTN","WVREFUSE",63,0)
 D ^DIR K DIR I Y'>0 D EXIT Q
"RTN","WVREFUSE",64,0)
 S WVJPR=+Y
"RTN","WVREFUSE",65,0)
 K WVEDREF D CHECK I $D(DIRUT) K DIRUT D EXIT G UNIV
"RTN","WVREFUSE",66,0)
 I $G(WVEDREF)>0 D  G UNIV
"RTN","WVREFUSE",67,0)
 .S DIDEL=790.3
"RTN","WVREFUSE",68,0)
 .D DDS^WVFMAN(790.3,"[WV REFUSED PROCEDURE-ENTRY]",+WVJR1(WVEDREF))
"RTN","WVREFUSE",69,0)
 I $G(WVEDREF)="NS" D EXIT G UNIV
"RTN","WVREFUSE",70,0)
 L +^WV(790.3)
"RTN","WVREFUSE",71,0)
 S DIC="^WV(790.3,",DIC(0)="QEMAL",X=WVJDAY
"RTN","WVREFUSE",72,0)
 S DIC("DR")="1////^S X=WVDFN;2////^S X=WVJPR"
"RTN","WVREFUSE",73,0)
 K DD,DO D FILE^DICN
"RTN","WVREFUSE",74,0)
 L -^WV(790.3)
"RTN","WVREFUSE",75,0)
 Q:Y'>0
"RTN","WVREFUSE",76,0)
 S WVDFN=$P($G(^WV(790.3,+Y,0)),U,2)
"RTN","WVREFUSE",77,0)
 D DDS^WVFMAN(790.3,"[WV REFUSED PROCEDURE-ENTRY]",+Y)
"RTN","WVREFUSE",78,0)
 G UNIV
"RTN","WVREFUSE",79,0)
 Q
"RTN","WVREFUSE",80,0)
EXIT ;kill variables
"RTN","WVREFUSE",81,0)
 D KILLALL^WVUTL8 K WVEDREF,WVJPR,WVJDAY
"RTN","WVREFUSE",82,0)
 Q
"RTN","WVREFUSE",83,0)
LOOP ;Loop though the array of refuals for this patient & write them out
"RTN","WVREFUSE",84,0)
 S D=0 F  S D=$O(WVJR1(D)) Q:D'>0  D
"RTN","WVREFUSE",85,0)
 .W !,$J(D,6),".  ",$P($G(WVJR1(D)),U,2)
"RTN","WVREFUSE",86,0)
 Q
"RTN","WVRPSCR")
0^3^B16907036
"RTN","WVRPSCR",1,0)
WVRPSCR ;HCIOFO/FT,JR IHS/ANMC/MWR - Display Compliance Rates ;12/9/98  13:39
"RTN","WVRPSCR",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WVRPSCR",3,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVRPSCR",4,0)
 ;;  THIS REPORT WILL DISPLAY COMPLIANCE RATES FOR PAPS & MAMS.
"RTN","WVRPSCR",5,0)
 ;
"RTN","WVRPSCR",6,0)
PRINT ;EP
"RTN","WVRPSCR",7,0)
 ;
"RTN","WVRPSCR",8,0)
 N I,J,M,N,P,Q
"RTN","WVRPSCR",9,0)
 D SETUP
"RTN","WVRPSCR",10,0)
 D TITLE^WVUTL5("COMPLIANCE RATES FOR PAPS AND MAMS")
"RTN","WVRPSCR",11,0)
 D TEXT1,DIRZ^WVUTL3 G:WVPOP EXIT
"RTN","WVRPSCR",12,0)
 D DATES   G:WVPOP EXIT
"RTN","WVRPSCR",13,0)
 D AGERNG  G:WVPOP EXIT
"RTN","WVRPSCR",14,0)
 D DEVICE  G:WVPOP EXIT
"RTN","WVRPSCR",15,0)
 D DATA^WVRPSCR1,EN^WVRPSCR2
"RTN","WVRPSCR",16,0)
 D DISPLAY
"RTN","WVRPSCR",17,0)
 I WVCRT&('$D(IO("S")))&('$G(WVPOP)) D DIRZ^WVUTL3 W @IOF
"RTN","WVRPSCR",18,0)
 ;
"RTN","WVRPSCR",19,0)
EXIT ;EP
"RTN","WVRPSCR",20,0)
 D KILLALL^WVUTL8
"RTN","WVRPSCR",21,0)
 Q
"RTN","WVRPSCR",22,0)
 ;
"RTN","WVRPSCR",23,0)
SETUP ;EP
"RTN","WVRPSCR",24,0)
 D SETVARS^WVUTL5
"RTN","WVRPSCR",25,0)
 Q
"RTN","WVRPSCR",26,0)
 ;
"RTN","WVRPSCR",27,0)
DATES ;EP
"RTN","WVRPSCR",28,0)
 ;---> ASK DATE RANGE.  RETURN DATES IN WVBEGDT AND WVENDDT.
"RTN","WVRPSCR",29,0)
 D ASKDATES^WVUTL3(.WVBEGDT,.WVENDDT,.WVPOP)
"RTN","WVRPSCR",30,0)
 Q
"RTN","WVRPSCR",31,0)
 ;
"RTN","WVRPSCR",32,0)
AGERNG ;EP
"RTN","WVRPSCR",33,0)
 ;---> ASK AGE RANGE.
"RTN","WVRPSCR",34,0)
 ;---> RETURN AGE RANGE IN WVAGRG.
"RTN","WVRPSCR",35,0)
 D AGERNG^WVRPSCR1(.WVAGRG,.WVPOP)
"RTN","WVRPSCR",36,0)
 Q
"RTN","WVRPSCR",37,0)
 ;
"RTN","WVRPSCR",38,0)
DEVICE ;EP
"RTN","WVRPSCR",39,0)
 ;---> GET DEVICE AND POSSIBLY QUEUE TO TASKMAN.
"RTN","WVRPSCR",40,0)
 S ZTRTN="DEQUEUE^WVRPSCR"
"RTN","WVRPSCR",41,0)
 F WVSV="AGRG","BEGDT","ENDDT" D
"RTN","WVRPSCR",42,0)
 .I $D(@("WV"_WVSV)) S ZTSAVE("WV"_WVSV)=""
"RTN","WVRPSCR",43,0)
 ;---> SAVE ATTRIBUTES ARRAY. NOTE: SUBSTITUTE LOCAL ARRAY FOR WVATT.
"RTN","WVRPSCR",44,0)
 I $D(WVCC) N N S N=0 F  S N=$O(WVCC(N)) Q:N=""  D
"RTN","WVRPSCR",45,0)
 .S ZTSAVE("WVCC("""_N_""")")=""
"RTN","WVRPSCR",46,0)
 D ZIS^WVUTL2(.WVPOP,1,"HOME")
"RTN","WVRPSCR",47,0)
 Q
"RTN","WVRPSCR",48,0)
 ;
"RTN","WVRPSCR",49,0)
 ;
"RTN","WVRPSCR",50,0)
DISPLAY ;EP
"RTN","WVRPSCR",51,0)
 U IO
"RTN","WVRPSCR",52,0)
 S WVTITLE="*  WOMEN'S HEALTH: COMPLIANCE RATES FOR PAPS AND MAMS  *"
"RTN","WVRPSCR",53,0)
 D CENTERT^WVUTL5(.WVTITLE)
"RTN","WVRPSCR",54,0)
 D TOPHEAD^WVUTL7
"RTN","WVRPSCR",55,0)
 S WVPAGE=1,WVPOP=0
"RTN","WVRPSCR",56,0)
 S WVSUB="W !?3,""For Age Range: "",$S(WVAGRG=1:""ALL"",1:WVAGRG)"
"RTN","WVRPSCR",57,0)
 ;
"RTN","WVRPSCR",58,0)
 S (WVPOP,N,Z)=0
"RTN","WVRPSCR",59,0)
 W:WVCRT @IOF D HEADER8^WVUTL7
"RTN","WVRPSCR",60,0)
 F  S N=$O(^TMP("WV",$J,N)) Q:'N!(WVPOP)  D
"RTN","WVRPSCR",61,0)
 .I N=16.001!(N=7.001) W ! D HDR^WVRPSCR2
"RTN","WVRPSCR",62,0)
 .I $Y+3>IOSL D:WVCRT DIRZ^WVUTL3 Q:WVPOP  I $O(^TMP("WV",$J,N))'="" W @IOF D HEADER8^WVUTL7 D:'WVCRT HDR^WVRPSCR2
"RTN","WVRPSCR",63,0)
 .W !,^TMP("WV",$J,N,0)
"RTN","WVRPSCR",64,0)
 D ^%ZISC
"RTN","WVRPSCR",65,0)
 Q
"RTN","WVRPSCR",66,0)
 ;
"RTN","WVRPSCR",67,0)
DEQUEUE ;EP
"RTN","WVRPSCR",68,0)
 ;---> CALLED BY TASKMAN
"RTN","WVRPSCR",69,0)
 D SETUP,DATA^WVRPSCR1,EN^WVRPSCR2,DISPLAY,EXIT
"RTN","WVRPSCR",70,0)
 Q
"RTN","WVRPSCR",71,0)
 ;
"RTN","WVRPSCR",72,0)
TEXT1 ;
"RTN","WVRPSCR",73,0)
 ;;This report is designed to serve as an indicator of compliance
"RTN","WVRPSCR",74,0)
 ;;rates for PAPs and MAMs.  The report will display the percentages
"RTN","WVRPSCR",75,0)
 ;;of women who received PAPs and MAMs for compliance purposes only,
"RTN","WVRPSCR",76,0)
 ;;within the selected date range.
"RTN","WVRPSCR",77,0)
 ;;
"RTN","WVRPSCR",78,0)
 ;;Only patients who have had normal results for procedures in the
"RTN","WVRPSCR",79,0)
 ;;specified date range are counted; the intent is to exclude
"RTN","WVRPSCR",80,0)
 ;;any procedures that would involve abnormal results, diagnostic
"RTN","WVRPSCR",81,0)
 ;;and follow-up procedures, etc.  Due to the complexities
"RTN","WVRPSCR",82,0)
 ;;involved in the treatment of individual cases that involve
"RTN","WVRPSCR",83,0)
 ;;abnormal results, those patients will not be included, even
"RTN","WVRPSCR",84,0)
 ;;though some of them may have received screening PAPs or MAMs.
"RTN","WVRPSCR",85,0)
 ;;
"RTN","WVRPSCR",86,0)
 ;;This report, therefore, serves ONLY AS AN INDICATOR (NOT as an exact
"RTN","WVRPSCR",87,0)
 ;;count of compliance rates) for gauging the success rates of annual
"RTN","WVRPSCR",88,0)
 ;;screening programs.  It can be run for several different time frames
"RTN","WVRPSCR",89,0)
 ;;in order to examine trends.  Assuming a screening cycle of one year,
"RTN","WVRPSCR",90,0)
 ;;a minimum date range spanning 15 months is recommended.
"RTN","WVRPSCR",91,0)
 S WVTAB=5,WVLINL="TEXT1" D PRINTX
"RTN","WVRPSCR",92,0)
 Q
"RTN","WVRPSCR",93,0)
 ;
"RTN","WVRPSCR",94,0)
PRINTX ;EP
"RTN","WVRPSCR",95,0)
 N I,T,X S T=$$REPEAT^XLFSTR(" ",WVTAB)
"RTN","WVRPSCR",96,0)
 F I=1:1 S X=$T(@WVLINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","WVRPSCR",97,0)
 Q
"RTN","WVRPSCR1")
0^4^B37305741
"RTN","WVRPSCR1",1,0)
WVRPSCR1 ;HCIOFO/FT,JR IHS/ANMC/MWR - Display Compliance Rates (cont.) ;12/15/98  15:56
"RTN","WVRPSCR1",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WVRPSCR1",3,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVRPSCR1",4,0)
 ;;  THIS REPORT WILL DISPLAY COMPLIANCE RATES FOR PAPS & MAMS.
"RTN","WVRPSCR1",5,0)
 ;;  ENTRY POINTS CALLED BY WVRPSCR.
"RTN","WVRPSCR1",6,0)
DATA ;EP
"RTN","WVRPSCR1",7,0)
 ;---> SORT AND STORE ARRAY IN ^TMP("WV",$J
"RTN","WVRPSCR1",8,0)
 K WVTMP,^TMP("WV",$J),^TMP("WVP",$J),WVPR
"RTN","WVRPSCR1",9,0)
 ;---> WVBEGDT1=ONE SECOND BEFORE BEGIN DATE.
"RTN","WVRPSCR1",10,0)
 ;---> WVENDDT1=THE LAST SECOND OF END DATE.
"RTN","WVRPSCR1",11,0)
 F WVCNT=20,30,40,50,60,70,200 S WVAGRG(WVCNT)=""
"RTN","WVRPSCR1",12,0)
 S WVBEGDT1=WVBEGDT-.0001,WVENDDT1=WVENDDT+.9999
"RTN","WVRPSCR1",13,0)
 ;
"RTN","WVRPSCR1",14,0)
 S WVDATE=WVBEGDT1
"RTN","WVRPSCR1",15,0)
 F  S WVDATE=$O(^WV(790.1,"D",WVDATE)) Q:'WVDATE!(WVDATE>WVENDDT1)  D
"RTN","WVRPSCR1",16,0)
 .S WVIEN=0
"RTN","WVRPSCR1",17,0)
 .F  S WVIEN=$O(^WV(790.1,"D",WVDATE,WVIEN)) Q:'WVIEN  D
"RTN","WVRPSCR1",18,0)
 ..S Y=^WV(790.1,WVIEN,0)
"RTN","WVRPSCR1",19,0)
 ..S WVDFN=$P(Y,U,2),WVPCDN=$P(Y,U,4),WVRES=$P(Y,U,5)
"RTN","WVRPSCR1",20,0)
 ..;
"RTN","WVRPSCR1",21,0)
 ..;---> QUIT IF THIS PROCEDURE HAS A RESULT OF "ERROR/DISREGARD".
"RTN","WVRPSCR1",22,0)
 ..Q:WVRES=8
"RTN","WVRPSCR1",23,0)
 ..;
"RTN","WVRPSCR1",24,0)
 ..;---> QUIT IF NEITHER A PAP (IEN=1) NOR A SCREENING MAM (IEN=28).
"RTN","WVRPSCR1",25,0)
 ..Q:((WVPCDN'=1)&(WVPCDN'=28))
"RTN","WVRPSCR1",26,0)
 ..;
"RTN","WVRPSCR1",27,0)
 ..;---> QUIT IS PATIENT IS NOT WITHIN AGE RANGE.
"RTN","WVRPSCR1",28,0)
 ..S WVAGE=+$$AGE^WVUTL9(WVDFN)
"RTN","WVRPSCR1",29,0)
 ..I WVAGRG'=1 Q:((WVAGE<$P(WVAGRG,"-"))!(WVAGE>$P(WVAGRG,"-",2)))
"RTN","WVRPSCR1",30,0)
 ..;
"RTN","WVRPSCR1",31,0)
 ..;---> GET VALUE OF RESULT: 0=NORMAL, 1=ABNORMAL, 2=NO RESULT
"RTN","WVRPSCR1",32,0)
 ..S WVNORM=$$NORMAL^WVUTL4(WVRES) S:WVNORM=2 WVNORM=0
"RTN","WVRPSCR1",33,0)
 ..;
"RTN","WVRPSCR1",34,0)
 ..S ^TMP("WV",$J,WVDFN,WVNORM,WVPCDN,WVIEN)=""
"RTN","WVRPSCR1",35,0)
 ..I WVPCDN=1 D
"RTN","WVRPSCR1",36,0)
 ...S WVJPAPR=$P($G(^WV(790,WVDFN,0)),U,16)
"RTN","WVRPSCR1",37,0)
 ...I WVJPAPR'>0 S WVJPAPR="NOT SPECIFIED"
"RTN","WVRPSCR1",38,0)
 ...E  S WVJPAPR=$P($G(^WV(790.03,WVJPAPR,0)),U)
"RTN","WVRPSCR1",39,0)
 ...S ^TMP("WVP",$J,WVJPAPR,WVDFN,WVNORM,WVPCDN,WVIEN)=""
"RTN","WVRPSCR1",40,0)
 ..I WVPCDN=28 D
"RTN","WVRPSCR1",41,0)
 ...S WVJ=$O(WVAGRG(WVAGE))
"RTN","WVRPSCR1",42,0)
 ...S WVJAGER=$S(WVJ=20:"<20",WVJ=30:"20-29",WVJ=40:"30-39",WVJ=50:"40-49",WVJ=60:"50-59",WVJ=70:"60-69",WVJ=200:">70",1:"AGE UNKNOWN")
"RTN","WVRPSCR1",43,0)
 ...S ^TMP("WVP",$J,WVJAGER,WVDFN,WVNORM,WVPCDN,WVIEN)=""
"RTN","WVRPSCR1",44,0)
 ;
"RTN","WVRPSCR1",45,0)
 ;---> NOW COLLATE DATA FROM ^TMP ARRAY INTO LOCAL WVTMP REPORT ARRAY.
"RTN","WVRPSCR1",46,0)
 ;---> FIRST, SEED LOCAL ARRAY WITH ZEROS.
"RTN","WVRPSCR1",47,0)
 F M=1,28 S WVJTYP=$S(M=1:"PAPR",1:"MAM") D
"RTN","WVRPSCR1",48,0)
 .N I F I=1:1:5 S WVTMP("RES",M,I)=0
"RTN","WVRPSCR1",49,0)
 ;
"RTN","WVRPSCR1",50,0)
 ;---> COLLATE DATA.
"RTN","WVRPSCR1",51,0)
 S N=0
"RTN","WVRPSCR1",52,0)
 F  S N=$O(^TMP("WV",$J,N)) Q:'N  D
"RTN","WVRPSCR1",53,0)
 .F M=1,28 S WVJTYP=$S(M=1:"PAPR",1:"MAM") D
"RTN","WVRPSCR1",54,0)
 ..Q:$D(^TMP("WV",$J,N,1,M))
"RTN","WVRPSCR1",55,0)
 ..S P=0,Q=0
"RTN","WVRPSCR1",56,0)
 ..F  S P=$O(^TMP("WV",$J,N,0,M,P)) Q:'P  S Q=Q+1
"RTN","WVRPSCR1",57,0)
 ..Q:'Q
"RTN","WVRPSCR1",58,0)
 ..I '$D(WVTMP("RES",M,Q)) S WVTMP("RES",M,Q)=1 Q
"RTN","WVRPSCR1",59,0)
 ..S WVTMP("RES",M,Q)=WVTMP("RES",M,Q)+1
"RTN","WVRPSCR1",60,0)
 ;
"RTN","WVRPSCR1",61,0)
 ;---> STORE ALL NODES >5 IN THE 5+ NODE.
"RTN","WVRPSCR1",62,0)
 F M=1,28 S WVJTYP=$S(M=1:"PAPR",1:"MAM") D
"RTN","WVRPSCR1",63,0)
 .S Q=5
"RTN","WVRPSCR1",64,0)
 .F  S Q=$O(WVTMP("RES",M,Q)) Q:'Q  D
"RTN","WVRPSCR1",65,0)
 ..S WVTMP("RES",M,5)=WVTMP("RES",M,5)+WVTMP("RES",M,Q)
"RTN","WVRPSCR1",66,0)
 ..K WVTMP("RES",M,Q)
"RTN","WVRPSCR1",67,0)
 ;
"RTN","WVRPSCR1",68,0)
 ;---> FIGURE PERCENTAGES OF WOMEN AND STORE IN ARRAY.
"RTN","WVRPSCR1",69,0)
 F M=1,28 S WVJTYP=$S(M=1:"PAPR",1:"MAM") D
"RTN","WVRPSCR1",70,0)
 .S WVTOT=0
"RTN","WVRPSCR1",71,0)
 .F Q=1:1:5 S WVTOT=WVTOT+WVTMP("RES",M,Q)
"RTN","WVRPSCR1",72,0)
 .S:'WVTOT WVTOT=1
"RTN","WVRPSCR1",73,0)
 .F Q=1:1:5 S $P(WVTMP("RES",M,Q),U,2)=$J((+WVTMP("RES",M,Q)/WVTOT),0,2)
"RTN","WVRPSCR1",74,0)
 ;
"RTN","WVRPSCR1",75,0)
 ;---> BUILD DISPLAY ARRAY.
"RTN","WVRPSCR1",76,0)
 N WVNODE K ^TMP("WV",$J)
"RTN","WVRPSCR1",77,0)
 ;
"RTN","WVRPSCR1",78,0)
 ;---> PAPS SUBHEADER LINE.
"RTN","WVRPSCR1",79,0)
 S WVNODE=$$S(40)_"SCREENING PAPS"
"RTN","WVRPSCR1",80,0)
 D WRITE(1,WVNODE)
"RTN","WVRPSCR1",81,0)
 S WVNODE=$$S(39)_"----------------"
"RTN","WVRPSCR1",82,0)
 D WRITE(2,WVNODE)
"RTN","WVRPSCR1",83,0)
 S WVNODE=" # of PAPs:                                        1     2     3     4     5+"
"RTN","WVRPSCR1",84,0)
 D WRITE(4,WVNODE)
"RTN","WVRPSCR1",85,0)
 S WVNODE=" -----------                                     ----- ----- ----- ----- -----"
"RTN","WVRPSCR1",86,0)
 D WRITE(5,WVNODE)
"RTN","WVRPSCR1",87,0)
 ;
"RTN","WVRPSCR1",88,0)
 ;---> PAPS NUMBER OF WOMEN DATA LINE.
"RTN","WVRPSCR1",89,0)
 S WVNODE=" # of Women:                                    "
"RTN","WVRPSCR1",90,0)
 F Q=1:1:5 S WVNODE=WVNODE_$J($P(WVTMP("RES",1,Q),U),6)
"RTN","WVRPSCR1",91,0)
 D WRITE(6,WVNODE)
"RTN","WVRPSCR1",92,0)
 S WVNODE=" % of Women:                                    "
"RTN","WVRPSCR1",93,0)
 F Q=1:1:5 S WVNODE=WVNODE_$J(($P(WVTMP("RES",1,Q),U,2)*100),5)_"%"
"RTN","WVRPSCR1",94,0)
 D WRITE(7,WVNODE)
"RTN","WVRPSCR1",95,0)
 ;
"RTN","WVRPSCR1",96,0)
 ;---> LINE FEEDS BETWEEN PAPS AND MAMS.
"RTN","WVRPSCR1",97,0)
 S WVNODE="" D WRITE(8,WVNODE) S WVNODE="" D WRITE(9,WVNODE)
"RTN","WVRPSCR1",98,0)
 ;
"RTN","WVRPSCR1",99,0)
 ;---> MAMS SUBHEADER LINE.
"RTN","WVRPSCR1",100,0)
 S WVNODE=$$S(40)_"SCREENING MAMS"
"RTN","WVRPSCR1",101,0)
 D WRITE(10,WVNODE)
"RTN","WVRPSCR1",102,0)
 S WVNODE=$$S(39)_"----------------"
"RTN","WVRPSCR1",103,0)
 D WRITE(11,WVNODE)
"RTN","WVRPSCR1",104,0)
 S WVNODE=" # of MAMs:                                        1     2     3     4     5+"
"RTN","WVRPSCR1",105,0)
 D WRITE(13,WVNODE)
"RTN","WVRPSCR1",106,0)
 S WVNODE=" -----------                                     ----- ----- ----- ----- -----"
"RTN","WVRPSCR1",107,0)
 D WRITE(14,WVNODE)
"RTN","WVRPSCR1",108,0)
 ;
"RTN","WVRPSCR1",109,0)
 ;---> PAPS NUMBER OF WOMEN DATA LINE.
"RTN","WVRPSCR1",110,0)
 S WVNODE=" # of Women:                                    "
"RTN","WVRPSCR1",111,0)
 F Q=1:1:5 S WVNODE=WVNODE_$J($P(WVTMP("RES",28,Q),U),6)
"RTN","WVRPSCR1",112,0)
 D WRITE(15,WVNODE)
"RTN","WVRPSCR1",113,0)
 S WVNODE=" % of Women:                                    "
"RTN","WVRPSCR1",114,0)
 F Q=1:1:5 S WVNODE=WVNODE_$J(($P(WVTMP("RES",28,Q),U,2)*100),5)_"%"
"RTN","WVRPSCR1",115,0)
 D WRITE(16,WVNODE)
"RTN","WVRPSCR1",116,0)
 Q
"RTN","WVRPSCR1",117,0)
 ;
"RTN","WVRPSCR1",118,0)
WRITE(I,Y) ;EP
"RTN","WVRPSCR1",119,0)
 S ^TMP("WV",$J,I,0)=Y
"RTN","WVRPSCR1",120,0)
 Q
"RTN","WVRPSCR1",121,0)
 ;
"RTN","WVRPSCR1",122,0)
S(S) ;EP
"RTN","WVRPSCR1",123,0)
 ;---> SPACES.
"RTN","WVRPSCR1",124,0)
 Q $$S^WVUTL7($G(S))
"RTN","WVRPSCR1",125,0)
 ;
"RTN","WVRPSCR1",126,0)
 ;
"RTN","WVRPSCR1",127,0)
AGERNG(WVAGRG,WVPOP) ;EP
"RTN","WVRPSCR1",128,0)
 ;---> ASK AGE RANGE.
"RTN","WVRPSCR1",129,0)
 ;---> RETURN AGE RANGE IN WVAGRG.
"RTN","WVRPSCR1",130,0)
 N DIR,DIRUT,Y S WVPOP=0
"RTN","WVRPSCR1",131,0)
 W !!?3,"Do you wish to limit this report to an age range?"
"RTN","WVRPSCR1",132,0)
 S DIR(0)="Y",DIR("B")="NO" D HELP1
"RTN","WVRPSCR1",133,0)
 S DIR("A")="   Enter Yes or No"
"RTN","WVRPSCR1",134,0)
 D ^DIR K DIR W !
"RTN","WVRPSCR1",135,0)
 S:$D(DIRUT) WVPOP=1
"RTN","WVRPSCR1",136,0)
 ;---> IF NOT DISPLAYING BY AGE RANGE, SET WVAGRG (AGE RANGE)=1, QUIT.
"RTN","WVRPSCR1",137,0)
 I 'Y S WVAGRG=1 Q
"RTN","WVRPSCR1",138,0)
BYAGE1 ;
"RTN","WVRPSCR1",139,0)
 W !?5,"Enter the age range you wish to select in the form of: 40-75"
"RTN","WVRPSCR1",140,0)
 W !?5,"Use a dash ""-"" to separate the limits of the range."
"RTN","WVRPSCR1",141,0)
 W !?5,"To select only one age, simply enter that age, with no dash."
"RTN","WVRPSCR1",142,0)
 W !?5,"(NOTE: Patient ages will reflect the age they are today.)",!
"RTN","WVRPSCR1",143,0)
 K DIR
"RTN","WVRPSCR1",144,0)
 S DIR(0)="FOA",DIR("A")="     Enter age range: "
"RTN","WVRPSCR1",145,0)
 S:$D(^WV(790.72,DUZ,0)) DIR("B")=$P(^(0),U,3)
"RTN","WVRPSCR1",146,0)
 D ^DIR K DIR
"RTN","WVRPSCR1",147,0)
 I $D(DIRUT) S WVPOP=1 Q
"RTN","WVRPSCR1",148,0)
 D CHECK(.Y)
"RTN","WVRPSCR1",149,0)
 I Y="" D  G BYAGE1
"RTN","WVRPSCR1",150,0)
 .W !!?5,"* INVALID AGE RANGE.  Please begin again."
"RTN","WVRPSCR1",151,0)
 ;---> WVAGRG=SELECTED AGE RANGE(S).
"RTN","WVRPSCR1",152,0)
 S WVAGRG=Y
"RTN","WVRPSCR1",153,0)
 D DIC^WVFMAN(790.72,"L",.Y,"","","","`"_DUZ)
"RTN","WVRPSCR1",154,0)
 Q:Y<0
"RTN","WVRPSCR1",155,0)
 D DIE^WVFMAN(790.72,".03////"_WVAGRG,+Y,.WVPOP,1)
"RTN","WVRPSCR1",156,0)
 Q
"RTN","WVRPSCR1",157,0)
 ;
"RTN","WVRPSCR1",158,0)
HELP1 ;EP
"RTN","WVRPSCR1",159,0)
 ;;Answer "YES" to display screening rates for a specific age range.
"RTN","WVRPSCR1",160,0)
 ;;If you choose to display for an age range, you will be given the
"RTN","WVRPSCR1",161,0)
 ;;opportunity to select the age range.  For example, you might choose
"RTN","WVRPSCR1",162,0)
 ;;to display from ages 50-75.
"RTN","WVRPSCR1",163,0)
 ;;Answer "NO" to display screening rates for all ages.
"RTN","WVRPSCR1",164,0)
 S WVTAB=5,WVLINL="HELP1" D HELPTX
"RTN","WVRPSCR1",165,0)
 Q
"RTN","WVRPSCR1",166,0)
 ;
"RTN","WVRPSCR1",167,0)
PRINTX ;EP
"RTN","WVRPSCR1",168,0)
 N I,T,X S T=$$REPEAT^XLFSTR(" ",WVTAB)
"RTN","WVRPSCR1",169,0)
 F I=1:1 S X=$T(@WVLINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","WVRPSCR1",170,0)
 Q
"RTN","WVRPSCR1",171,0)
 ;
"RTN","WVRPSCR1",172,0)
HELPTX ;EP
"RTN","WVRPSCR1",173,0)
 ;---> CREATES DIR ARRAY FOR DIR.  REQUIRED VARIABLES: WVTAB,WVLINL.
"RTN","WVRPSCR1",174,0)
 N I,T,X S T=$$REPEAT^XLFSTR(" ",WVTAB)
"RTN","WVRPSCR1",175,0)
 F I=1:1 S X=$T(@WVLINL+I) Q:X'[";;"  S DIR("?",I)=T_$P(X,";;",2)
"RTN","WVRPSCR1",176,0)
 S DIR("?")=DIR("?",I-1) K DIR("?",I-1)
"RTN","WVRPSCR1",177,0)
 Q
"RTN","WVRPSCR1",178,0)
 ;
"RTN","WVRPSCR1",179,0)
CHECK(X) ;EP
"RTN","WVRPSCR1",180,0)
 ;---> CHECK SYNTAX OF AGE RANGE STRING.
"RTN","WVRPSCR1",181,0)
 ;---> IF X=ONE AGE ONLY, SET IT IN THE FORM X-X AND QUIT.
"RTN","WVRPSCR1",182,0)
 I X?1N.N S X=X_"-"_X Q
"RTN","WVRPSCR1",183,0)
 ;
"RTN","WVRPSCR1",184,0)
 N FAIL,I,Y1,Y2
"RTN","WVRPSCR1",185,0)
 S FAIL=0
"RTN","WVRPSCR1",186,0)
 ;---> CHECK EACH RANGE.
"RTN","WVRPSCR1",187,0)
 S Y1=$P(X,"-"),Y2=$P(X,"-",2)
"RTN","WVRPSCR1",188,0)
 ;---> EACH END OF EACH RANGE SHOULD BE A NUMBER.
"RTN","WVRPSCR1",189,0)
 I (Y1'?1N.N)!(Y2'?1N.N) S X="" Q
"RTN","WVRPSCR1",190,0)
 ;---> THE LOWER NUMBER SHOULD BE FIRST.
"RTN","WVRPSCR1",191,0)
 I Y2<Y1 S FAIL=1
"RTN","WVRPSCR1",192,0)
 I FAIL S X="" Q
"RTN","WVRPSCR1",193,0)
 Q
"RTN","WVUTL6")
0^6^B10613351
"RTN","WVUTL6",1,0)
WVUTL6 ;HCIOFO/FT,JR IHS/ANMC/MWR - UTIL: TEXT VALS, DEF PRINT DATE; ;12/7/98  12:53
"RTN","WVUTL6",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WVUTL6",3,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVUTL6",4,0)
 ;;  UTILITY: TEXT FOR PROVIDER, PROCEDURE, HOSP LOC, INSTIT, & ECC.
"RTN","WVUTL6",5,0)
 ;;  PROC SPECIAL VALUE (PAP, MAM, COLP).  COMPUTE DEFAULT PRINT DATE.
"RTN","WVUTL6",6,0)
 ;
"RTN","WVUTL6",7,0)
 ;
"RTN","WVUTL6",8,0)
PROV() ;EP
"RTN","WVUTL6",9,0)
 ;---> RETURN TEXT OF PROVIDER'S NAME.
"RTN","WVUTL6",10,0)
 ;---> REQUIRED VARIABLE: X=IEN IN NEW PERSON FILE #200.
"RTN","WVUTL6",11,0)
 Q:'$D(X) ""
"RTN","WVUTL6",12,0)
 Q:'X "UNKNOWN"
"RTN","WVUTL6",13,0)
 Q:'$D(^VA(200,X,0)) "UNKNOWN POINTER"
"RTN","WVUTL6",14,0)
 Q $P(^VA(200,X,0),U)
"RTN","WVUTL6",15,0)
 ;
"RTN","WVUTL6",16,0)
 ;
"RTN","WVUTL6",17,0)
PCDNAM() ;EP
"RTN","WVUTL6",18,0)
 ;---> RETURN TEXT OF PROCEDURE TYPE.
"RTN","WVUTL6",19,0)
 ;---> REQUIRED VARIABLE: X=IEN IN WV PROCEDURE TYPE FILE #790.2.
"RTN","WVUTL6",20,0)
 Q:'$D(X) ""
"RTN","WVUTL6",21,0)
 Q:'X "UNKNOWN"
"RTN","WVUTL6",22,0)
 Q:'$D(^WV(790.2,X,0)) "UNKNOWN POINTER"
"RTN","WVUTL6",23,0)
 Q $P(^WV(790.2,X,0),U)
"RTN","WVUTL6",24,0)
 ;
"RTN","WVUTL6",25,0)
HOSPLC() ;EP
"RTN","WVUTL6",26,0)
 ;---> RETURN TEXT OF HOSPITAL LOCATION NAME.
"RTN","WVUTL6",27,0)
 ;---> REQUIRED VARIABLE: X=IEN IN HOSPITAL LOCATION FILE #44.
"RTN","WVUTL6",28,0)
 Q:'$D(X) ""
"RTN","WVUTL6",29,0)
 Q:'X "UNKNOWN"
"RTN","WVUTL6",30,0)
 Q:'$D(^SC(X,0)) "UNKNOWN POINTER"
"RTN","WVUTL6",31,0)
 Q $P(^SC(X,0),U)
"RTN","WVUTL6",32,0)
 ;
"RTN","WVUTL6",33,0)
INSTIT() ;EP
"RTN","WVUTL6",34,0)
 ;---> RETURN IEN OF INSTITUTION (FACILITY) FILE 4, FOR THIS HOSPITAL
"RTN","WVUTL6",35,0)
 ;---> LOCATION ENTRY IN HOSPITAL LOCATION FILE 44.
"RTN","WVUTL6",36,0)
 ;---> ALSO CONCATENATE "`" TO THE FRONT OF IEN FOR USE IN DR STRINGS.
"RTN","WVUTL6",37,0)
 Q:'$D(X) ""
"RTN","WVUTL6",38,0)
 Q:X="" ""
"RTN","WVUTL6",39,0)
 Q:'$D(^SC(X,0)) ""
"RTN","WVUTL6",40,0)
 Q:$P(^SC(X,0),U,4)']"" ""
"RTN","WVUTL6",41,0)
 Q "`"_$P(^SC(X,0),U,4)
"RTN","WVUTL6",42,0)
 ;
"RTN","WVUTL6",43,0)
INSTTX(FACILITY) ;EP
"RTN","WVUTL6",44,0)
 ;---> RETURN TEXT OF INSTITUTION (FACILITY) NAME.
"RTN","WVUTL6",45,0)
 ;---> REQUIRED VARIABLE: X=IEN IN INSTITUTION FILE #4.
"RTN","WVUTL6",46,0)
 Q:'$G(FACILITY) ""
"RTN","WVUTL6",47,0)
 Q:'$D(^DIC(4,FACILITY,0)) "UNKNOWN POINTER"
"RTN","WVUTL6",48,0)
 Q $P(^DIC(4,FACILITY,0),U)
"RTN","WVUTL6",49,0)
 ;
"RTN","WVUTL6",50,0)
ECCDYS() ;EP
"RTN","WVUTL6",51,0)
 ;---> RETURN TEXT FROM SET OF CODES FOR ECC DYSPLASIA, FIELD .25,
"RTN","WVUTL6",52,0)
 ;---> OF PROCEDURE FILE 790.1.
"RTN","WVUTL6",53,0)
 ;---> REQUIRED VARIABLE: X=CODE FOR TEXT OF ECC DYSPLASIA.
"RTN","WVUTL6",54,0)
 Q:'$D(X) ""
"RTN","WVUTL6",55,0)
 Q:X="" ""
"RTN","WVUTL6",56,0)
 Q:'$D(^DD(790.1,.25,0)) "^DD MISSING"
"RTN","WVUTL6",57,0)
 Q $P($P(^DD(790.1,.25,0),X_":",2),";")
"RTN","WVUTL6",58,0)
 ;
"RTN","WVUTL6",59,0)
PNOCX(IEN) ;EP
"RTN","WVUTL6",60,0)
 ;---> RETURN 1 IF THIS PROCEDURE IS NOT ANY TYPE OF CERVICAL TX.
"RTN","WVUTL6",61,0)
 Q:'$G(IEN) 1
"RTN","WVUTL6",62,0)
 Q:'$D(^WV(790.2,IEN,0)) 1
"RTN","WVUTL6",63,0)
 Q:$$PMAM(IEN) 1
"RTN","WVUTL6",64,0)
 Q:IEN=27 1  Q:IEN=29 1  Q:IEN=30 1  Q:IEN=31 1  Q:IEN=32 1
"RTN","WVUTL6",65,0)
 Q:IEN=33 1  Q:IEN=34 1  Q:IEN=35 1
"RTN","WVUTL6",66,0)
 Q 0
"RTN","WVUTL6",67,0)
 ;
"RTN","WVUTL6",68,0)
 ;
"RTN","WVUTL6",69,0)
PMAM(IEN) ;EP
"RTN","WVUTL6",70,0)
 ;---> RETURN 1 IF THIS PROCEDURE IS ANY TYPE OF MAMMOGRAM, RETURN 0
"RTN","WVUTL6",71,0)
 ;---> IF NOT.
"RTN","WVUTL6",72,0)
 ;---> REQUIRED VARIABLE: IEN=IEN IN PROCEDURE TYPE FILE #790.2.
"RTN","WVUTL6",73,0)
 ;---> 25, 26, AND 27 ARE IENS OF MAMS IN ^WV(790.2,.
"RTN","WVUTL6",74,0)
 Q:'$G(IEN) 0
"RTN","WVUTL6",75,0)
 Q:IEN=25 1  Q:IEN=26 1  Q:IEN=28 1
"RTN","WVUTL6",76,0)
 Q 0
"RTN","WVUTL6",77,0)
 ;
"RTN","WVUTL6",78,0)
 ;
"RTN","WVUTL6",79,0)
PRTDATE ;EP
"RTN","WVUTL6",80,0)
 ;---> CALL BY WV NOTIF-EDITBLK-1 TO COMPUTE AND STUFF DATE NOTIFICATION
"RTN","WVUTL6",81,0)
 ;---> LETTER WILL BE PRINTED, "Print Date" FIELD.  CALLED FROM
"RTN","WVUTL6",82,0)
 ;---> "TYPE OF NOTIFICATION" FIELD ORDER, "POST ACTION ON CHANGE".
"RTN","WVUTL6",83,0)
 ;--->
"RTN","WVUTL6",84,0)
 ;---> IF THE "TYPE OF NOTIFICATION" IS PRINTABLE (LETTER), AS STORED
"RTN","WVUTL6",85,0)
 ;---> IN #.02 FIELD OF FILE #790.403, THIS COMPUTES PRINT DATE AND
"RTN","WVUTL6",86,0)
 ;---> STUFFS A DEFAULT "COMPLETE BY DATE" (FIELD #.13) AS WELL.
"RTN","WVUTL6",87,0)
 ;---> "PRINT DATE" WILL BE CX/BR NEED DUE DATE - SITE PARAMETER, AS
"RTN","WVUTL6",88,0)
 ;---> STORED IN #.06 FIELD OF FILE #790.02, OR -30 DAYS IF
"RTN","WVUTL6",89,0)
 ;---> PARAMETER NOT SET.  (SEE PRTDAT^WVUTL2-ABOVE.)
"RTN","WVUTL6",90,0)
 ;---> "COMPLETE BY DATE" WILL BE "PRINT DATE"+30. SEE NDELQ1^WVUTL4.
"RTN","WVUTL6",91,0)
 ;--->
"RTN","WVUTL6",92,0)
 ;---> IF THE "TYPE OF NOTIFICATION" IS NOT PRINTABLE (PHONE), THIS
"RTN","WVUTL6",93,0)
 ;---> SETS "PRINT DATE"="" AND RECOMPUTES "COMPLETE BY DATE" BASED ON
"RTN","WVUTL6",94,0)
 ;---> DATE NOTIFICATION WAS OPENED (FIELD #.02) +30 DAYS.
"RTN","WVUTL6",95,0)
 ;
"RTN","WVUTL6",96,0)
 ;---> (NOTE: FOR UNIFORMITY, EXECUTABLE DEFAULT FOR "PRINT DATE"
"RTN","WVUTL6",97,0)
 ;---> CALLS THIS CODE TO SET ITS STORED VALUE, THEN SETS ITS DEFAULT
"RTN","WVUTL6",98,0)
 ;---> EQUAL TO ITS STORED VALUE.)
"RTN","WVUTL6",99,0)
 ;--->
"RTN","WVUTL6",100,0)
 ;---> REQUIRED VARIABLES: WVDFN=IEN OF PATIENT
"RTN","WVUTL6",101,0)
 ;--->                     DUZ(2)=SITE
"RTN","WVUTL6",102,0)
 ;--->                     WVTYPE=IEN TYPE OF NOTIFICATION (LETTER, ETC)
"RTN","WVUTL6",103,0)
 ;--->                     WVPURP=IEN PURPOSE OF NOTIFICATION
"RTN","WVUTL6",104,0)
 ;
"RTN","WVUTL6",105,0)
 N WVTYPE,WVPURP,X,Y
"RTN","WVUTL6",106,0)
 S WVTYPE=$$GET^DDSVAL(DIE,DA,.03)
"RTN","WVUTL6",107,0)
 I 'WVTYPE D PUT^DDSVAL(DIE,DA,.11,"") Q
"RTN","WVUTL6",108,0)
 ;---> IF NOT PRINTABLE, SET PRINT DATE="".
"RTN","WVUTL6",109,0)
 I '$P(^WV(790.403,WVTYPE,0),U,2) D  Q
"RTN","WVUTL6",110,0)
 .D PUT^DDSVAL(DIE,DA,.11,"")
"RTN","WVUTL6",111,0)
 .S X=$$NDELQ^WVUTL4 D PUT^DDSVAL(DIE,DA,.13,X)
"RTN","WVUTL6",112,0)
 S WVPURP=$$GET^DDSVAL(DIE,DA,.04)
"RTN","WVUTL6",113,0)
 ;---> COMPUTE AND STUFF PRINT DATE.
"RTN","WVUTL6",114,0)
 D PRTDAT(WVDFN,DUZ(2),WVTYPE,WVPURP,.X)
"RTN","WVUTL6",115,0)
 D PUT^DDSVAL(DIE,DA,.11,X)
"RTN","WVUTL6",116,0)
 ;---> COMPUTE AND STUFF COMPLETE BY DATE.
"RTN","WVUTL6",117,0)
 S X=$$NDELQ1^WVUTL4 D PUT^DDSVAL(DIE,DA,.13,X)
"RTN","WVUTL6",118,0)
 Q
"RTN","WVUTL6",119,0)
 ;
"RTN","WVUTL6",120,0)
 ;
"RTN","WVUTL6",121,0)
PRTDAT(DFN,DUZ2,TYPE,PURP,DATE) ;EP
"RTN","WVUTL6",122,0)
 ;---> YIELD PATIENT'S LETTER PRINT DATE, BASED ON CX/BR NEED.
"RTN","WVUTL6",123,0)
 ;---> DUE DATE MINUS SITE PARAMETER (OR 30 DAYS, IF NOT SET).
"RTN","WVUTL6",124,0)
 ;---> TYPE OF NOTIFICATION MUST BE "PRINTABLE" (#.02 OF #790.403).
"RTN","WVUTL6",125,0)
 ;---> REQUIRED VARIABLES: DFN=IEN OF PATIENT
"RTN","WVUTL6",126,0)
 ;--->                     DUZ2=DUZ(2)
"RTN","WVUTL6",127,0)
 ;--->                     TYPE=IEN TYPE OF NOTIFICATION
"RTN","WVUTL6",128,0)
 ;--->                     PURP=IEN PURPOSE OF NOTIFICATION
"RTN","WVUTL6",129,0)
 ;---> RETURNS VARIABLES:  DATE=DEFAULT DATE LETTER SHOULD BE PRINTED
"RTN","WVUTL6",130,0)
 ;
"RTN","WVUTL6",131,0)
 N P,Q,X,X1,X2
"RTN","WVUTL6",132,0)
 S DATE=""
"RTN","WVUTL6",133,0)
 Q:'TYPE!('PURP)
"RTN","WVUTL6",134,0)
 ;---> QUIT IF THIS "TYPE OF NOTIFICATION" IS NOT "PRINTABLE" (PIECE 2).
"RTN","WVUTL6",135,0)
 Q:'$P(^WV(790.403,TYPE,0),U,2)
"RTN","WVUTL6",136,0)
 S X2=$P($G(^WV(790.02,DUZ2,0)),U,6)
"RTN","WVUTL6",137,0)
 S X2=$S(X2:-X2,1:-30)
"RTN","WVUTL6",138,0)
 Q:'$D(^WV(790,DFN,0))
"RTN","WVUTL6",139,0)
 ;---> IF THIS PURPOSE IS A RESULT LETTER, SET PRINT DATE=TODAY, QUIT.
"RTN","WVUTL6",140,0)
 Q:'$D(^WV(790.404,PURP,0))
"RTN","WVUTL6",141,0)
 I $P(^WV(790.404,PURP,0),U,6) S DATE=DT Q
"RTN","WVUTL6",142,0)
 ;---> IF THIS IS NOT ASSOCIATED WITH BR/CX NEEDS, QUIT WITH DATE="".
"RTN","WVUTL6",143,0)
 Q:$P(^WV(790.404,PURP,0),U,5)=""
"RTN","WVUTL6",144,0)
 S:$P(^WV(790.404,PURP,0),U,5)="CX" P=11,Q=12
"RTN","WVUTL6",145,0)
 S:$P(^WV(790.404,PURP,0),U,5)="BR" P=18,Q=19
"RTN","WVUTL6",146,0)
 ;---> QUIT IF THIS PATIENT HAS NO BR/CX NEED ENTERED.
"RTN","WVUTL6",147,0)
 Q:'$P(^WV(790,DFN,0),U,P)
"RTN","WVUTL6",148,0)
 ;---> QUIT IF THIS PATIENT HAS NO BR/CX NEED DUE DATE.
"RTN","WVUTL6",149,0)
 S X=$P(^WV(790,DFN,0),U,Q) Q:'X
"RTN","WVUTL6",150,0)
 S:'$E(X,7) $E(X,7)=1
"RTN","WVUTL6",151,0)
 S X1=X D C^%DTC
"RTN","WVUTL6",152,0)
 S DATE=X
"RTN","WVUTL6",153,0)
 Q
"RTN","WVUTL8")
0^5^B22617280
"RTN","WVUTL8",1,0)
WVUTL8 ;HCIOFO/FT,JR IHS/ANMC/MWR - UTIL: PATLKUP, SELECT, KILLALL; ;12/15/98  16:43
"RTN","WVUTL8",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WVUTL8",3,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVUTL8",4,0)
 ;;  UTILITY: PATIENT LOOKUP, SELECT FOR REPORT, KILLALL.
"RTN","WVUTL8",5,0)
 ;
"RTN","WVUTL8",6,0)
PATLKUP(Y,WVADD,DUZ2,WVPOP) ;EP
"RTN","WVUTL8",7,0)
 ;---> WV PATIENT LOOKUP.
"RTN","WVUTL8",8,0)
 ;---> PARAMETERS:
"RTN","WVUTL8",9,0)
 ;     1 - Y             (RETURNED) PATIENT DFN OR -1 IF FAILED.
"RTN","WVUTL8",10,0)
 ;     2 - WVADD         (OPTIONAL) EQUALS "ADD" IF ADD CAPABILITY
"RTN","WVUTL8",11,0)
 ;     3 - DUZ2=DUZ(2)   (OPTIONAL) IF NOT SET, WILL=ENVIROMENTAL DUZ(2)
"RTN","WVUTL8",12,0)
 ;     4 - WVPOP         (RETURNED) WVPOP=1 IF DTOUT OR DUOUT
"RTN","WVUTL8",13,0)
 ;
"RTN","WVUTL8",14,0)
 ;---> EXAMPLE: D PATLKUP^WVUTL8(.Y)
"RTN","WVUTL8",15,0)
 ;              D PATLKUP^WVUTL8(.Y,"ADD") - MAY ADD PATIENT TO WH.
"RTN","WVUTL8",16,0)
 ;
"RTN","WVUTL8",17,0)
 N DFN,DIC,X
"RTN","WVUTL8",18,0)
PATLKUP1 ;---> RETURN HERE IF LOOKUP FAILED FOR SEX OR AGE.
"RTN","WVUTL8",19,0)
 ;---> SET VARIABLES: Y=DFN,WVPOP=1 FOR QUIT.
"RTN","WVUTL8",20,0)
 S WVPOP=0 D SETVARS^WVUTL5
"RTN","WVUTL8",21,0)
 S:$G(DUZ2)]"" DUZ(2)=DUZ2
"RTN","WVUTL8",22,0)
 S DIC="^DPT(",DIC(0)="AEMQ",DIC("S")="I $P(^(0),U,2)=""F"""
"RTN","WVUTL8",23,0)
 D ^DIC
"RTN","WVUTL8",24,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","WVUTL8",25,0)
 Q:Y<0
"RTN","WVUTL8",26,0)
 S (DFN,Y)=+Y
"RTN","WVUTL8",27,0)
 ;---> IF PATIENT ALREADY EXISTS IN WV PATIENT FILE, QUIT.
"RTN","WVUTL8",28,0)
 Q:$D(^WV(790,DFN,0))
"RTN","WVUTL8",29,0)
 ;
"RTN","WVUTL8",30,0)
 ;---> IF PATIENT IS NOT FEMALE, PROMPT USER.
"RTN","WVUTL8",31,0)
 I '$$SEX^WVUTL1(DFN) D  G PATLKUP1
"RTN","WVUTL8",32,0)
 .W !!?3,$$NAME^WVUTL1(DFN)," is not female." D DIRZ^WVUTL3
"RTN","WVUTL8",33,0)
 ;
"RTN","WVUTL8",34,0)
 ;---> QUIT IF NO ADD ("LAYGO") CAPABILITY.
"RTN","WVUTL8",35,0)
 I $G(WVADD)'="ADD" D  G PATLKUP1
"RTN","WVUTL8",36,0)
 .W !!?3,$$NAME^WVUTL1(DFN)
"RTN","WVUTL8",37,0)
 .W " is not currently in the Women's Health database." D DIRZ^WVUTL3
"RTN","WVUTL8",38,0)
 ;
"RTN","WVUTL8",39,0)
 ;---> ASK TO ADD AS A NEW PATIENT.
"RTN","WVUTL8",40,0)
 W !!?3,$$NAME^WVUTL1(DFN)
"RTN","WVUTL8",41,0)
 W " ("_$$AGE^WVUTL1(DFN)_")" ;show patient's age
"RTN","WVUTL8",42,0)
 W !?3,"is not currently in the Women's Health database."
"RTN","WVUTL8",43,0)
 W !?3,"Do you wish to add her to the Women's Health Database?"
"RTN","WVUTL8",44,0)
 S DIR("?",1)="     Enter YES to ADD this patient to the Women's Health"
"RTN","WVUTL8",45,0)
 S DIR("?",1)=DIR("?",1)_" database."
"RTN","WVUTL8",46,0)
 S DIR("?")="     Enter NO to quit without adding her to the database."
"RTN","WVUTL8",47,0)
 S DIR(0)="Y",DIR("A")="   Enter Yes or No"
"RTN","WVUTL8",48,0)
 D ^DIR W !
"RTN","WVUTL8",49,0)
 I $D(DIRUT) S Y=-1 Q
"RTN","WVUTL8",50,0)
 G:Y=0 PATLKUP1
"RTN","WVUTL8",51,0)
 D AUTOADD^WVPATE(DFN,DUZ(2),.Y,1)
"RTN","WVUTL8",52,0)
 Q
"RTN","WVUTL8",53,0)
 ;
"RTN","WVUTL8",54,0)
KGBL(GBL) ;EP
"RTN","WVUTL8",55,0)
 ;---> KILL A GLOBAL.  GBL SHOULD INCLUDE THE LEADING "^".
"RTN","WVUTL8",56,0)
 S:GBL["(" GBL=$P(GBL,"(")
"RTN","WVUTL8",57,0)
 F  S GBL=$Q(@GBL) Q:GBL=""  K @GBL
"RTN","WVUTL8",58,0)
 Q
"RTN","WVUTL8",59,0)
 ;
"RTN","WVUTL8",60,0)
ZGBL(GBL) ;EP
"RTN","WVUTL8",61,0)
 ;---> ZERO OUT (DELETE ALL DATA) IN A FILEMAN FILE.
"RTN","WVUTL8",62,0)
 ;---> GBL SHOULD INCLUDE THE LEADING "^".
"RTN","WVUTL8",63,0)
 N N,X
"RTN","WVUTL8",64,0)
 S:GBL["(" GBL=$P(GBL,"(")
"RTN","WVUTL8",65,0)
 Q:'$D(@(GBL_"(0)"))
"RTN","WVUTL8",66,0)
 S N=0,X=$P(@(GBL_"(0)"),U,1,2)
"RTN","WVUTL8",67,0)
 F  S N=$O(@(GBL_"("""_N_""")")) Q:N=""  K @(GBL_"("""_N_""")")
"RTN","WVUTL8",68,0)
 S @(GBL_"(0)")=X
"RTN","WVUTL8",69,0)
 Q
"RTN","WVUTL8",70,0)
 ;
"RTN","WVUTL8",71,0)
KILLALL ;EP
"RTN","WVUTL8",72,0)
 ;---> CLEAN UP VARIABLES.
"RTN","WVUTL8",73,0)
 ;---> MSM
"RTN","WVUTL8",74,0)
 ;S X="WV" F  S X=$O(@X) Q:$E(X,1,2)'="WV"  K @X
"RTN","WVUTL8",75,0)
 ;S X="DI" F  S X=$O(@X) Q:$E(X,1,2)'="WV"  K @X
"RTN","WVUTL8",76,0)
 ;---> DSM
"RTN","WVUTL8",77,0)
 ;S X="WV" F  S X=$ZSORT(@X) Q:$E(X,1,2)'="WV"  K @X
"RTN","WVUTL8",78,0)
 ;S X="DI" F  S X=$ZSORT(@X) Q:$E(X,1,2)'="WV"  K @X
"RTN","WVUTL8",79,0)
 ;
"RTN","WVUTL8",80,0)
 ;---> REPLACE KILLS BELOW WITH $O COMMANDS ABOVE WHEN AVAILABLE.
"RTN","WVUTL8",81,0)
 K WV,WV0,WV1,WV1DX,WV2,WV2DX,WVA,WVABBV,WVABBVS,WVACC
"RTN","WVUTL8",82,0)
 K WVACCN,WVACCP,WVADD,WVAGE,WVAGENCY,WVAGRG,WVAGRP,WVAR,WVAREA
"RTN","WVUTL8",83,0)
 K WVARR,WVARR1,WVASKTIM,WVATT,WVB,WVBDF,WVBEGDF,WVBEGDT
"RTN","WVUTL8",84,0)
 K WVBEGDT1,WVBNEED,WVC,WVC0,WVCAPT,WVCBEDA,WVCC,WVCDC,WVCDCV,WVCHAGE
"RTN","WVUTL8",85,0)
 K WVCHG,WVCHRT,WVCHSSN,WVCMGR,WVCMGR1,WVCNEED,WVCODE,WVCOLPS,WVCONF
"RTN","WVUTL8",86,0)
 K WVCONFF,WVCOUNT,WVCRT,WVCUR,WVD,WVDA,WVDATE,WVDATE1,WVDD,WVDDATE
"RTN","WVUTL8",87,0)
 K WVDEF,WVDFLT,WVDFN,WVDIAG,WVDR,WVDT,WVDUZ0,WVDUZ2,WVDX
"RTN","WVUTL8",88,0)
 K WVE,WVEDC,WVEDCL,WVEDF,WVENDDF,WVENDDT,WVENDDT1,WVENDSAM,WVENDT
"RTN","WVUTL8",89,0)
 K WVERR,WVERROR,WVERRORS,WVFAC,WVFACIL,WVFILE,WVFLNM,WVGBL
"RTN","WVUTL8",90,0)
 K WVGBLN,WVHEADER,WVHCF,WVHFS,WVHLOC,WVHRCN,WVI,WVICD,WVIEN,WVION
"RTN","WVUTL8",91,0)
 K WVITEM,WVITEMS,WVKDT,WVLDAT,WVLFRT,WVLINE,WVLINL,WVLOC,WVLOGO
"RTN","WVUTL8",92,0)
 K WVLOOP,WVLPRG,WVM,WVMABN,WVMAM,WVMAMDT,WVMATCH,WVMENUT,WVMES,WVN
"RTN","WVUTL8",93,0)
 K WVNAMAGE,WVNAME,WVNEW,WVNN,WVNODE,WVNOFAC,WVNOFOL,WVNOMAT,WVNORM
"RTN","WVUTL8",94,0)
 K WVNOW,WVOFAC,WVOLD,WVOLD2,WVOUT,WVPABN,WVPAGE,WVPAP,WVPAPDA,WVPAPDT
"RTN","WVUTL8",95,0)
 K WVPAPRG,WVPAPRG1,WVPAPS,WVPATH,WVPATS,WVPC,WVPCCN,WVPCCP,WVPCD,WVPCDL
"RTN","WVUTL8",96,0)
 K WVPCDN,WVPCDS,WVPCDT,WVPDATE,WVPN,WVPNAME,WVPOP,WVPOP1,WVPOST,WVPPAP
"RTN","WVUTL8",97,0)
 K WVPRE,WVPREG,WVPRIO,WVPRMPT,WVPRMT,WVPRMT1,WVPRMT2,WVPRMTQ,WVPROF
"RTN","WVUTL8",98,0)
 K WVPROV,WVPRPCD,WVPRV,WVPSTAT,WVPTITL,WVPURP,WVPUSER,WVQUE,WVQUIT
"RTN","WVUTL8",99,0)
 K WVRCVDT,WVRES,WVRESN,WVRTN,WVS,WVSAME,WVSCRN,WVSITE,WVSL,WVSPEC
"RTN","WVUTL8",100,0)
 K WVSPTX,WVSS,WVSSN,WVSTART,WVSTAT,WVSTTDT,WVSUB,WVSUBH,WVUSER,WVSV
"RTN","WVUTL8",101,0)
 K WVTAB,WVTEST,WVTIME,WVTIMLN,WVTITLE,WVTITLE1,WVTITLE2,WVTMP
"RTN","WVUTL8",102,0)
 K WVTTAB,WVTYPE,WVUNL,WVVER,WVVFIL,WVVGBL,WVX,WVX0,WVX1,WVX2,WVX3
"RTN","WVUTL8",103,0)
 K WVX4,WVX5,WVX6,WVX7,WVX8,WVX9,WVXPORT,WVXREF,WVY,WVYY
"RTN","WVUTL8",104,0)
 K COL,COLLEN,LEN,NN,NODE,V,POP,WVJPCP,WVJDT,WVJDTO,WVJNDA,WVJTOY
"RTN","WVUTL8",105,0)
 K WVTOY,WVJPAPR,WVJST,WVPR,CN,WVCNT,WVJ,WVJAGER,WVJHDR,WVJTYP
"RTN","WVUTL8",106,0)
 K WVDTIEN,WVJX,WVJDR,WVCN,WVJRNOW,WVBALL,WVALL,WVBV,WVCALL,WVCIVCN
"RTN","WVUTL8",107,0)
 K WVCNALL,WVCV,WVET,WVETCN,WVMALL,WVMV,WVNALL,WVST,WVVALL,WVARJ
"RTN","WVUTL8",108,0)
 K WVJBFAC,WVJCFAC
"RTN","WVUTL8",109,0)
 ;
"RTN","WVUTL8",110,0)
 ;---> ADDED MANUALLY.
"RTN","WVUTL8",111,0)
 K WVMDAT,WVMGR,WVPDAT,WVTOT
"RTN","WVUTL8",112,0)
 K ^TMP("WV",$J)
"RTN","WVUTL8",113,0)
 ;
"RTN","WVUTL8",114,0)
 ;---> FILEMAN KILLS.
"RTN","WVUTL8",115,0)
 D DKILLS^WVFMAN
"RTN","WVUTL8",116,0)
 K X,Y,Z,ZTRTN,ZTSAVE
"RTN","WVUTL8",117,0)
 Q
"RTN","WVUTL9")
0^14^B1550098
"RTN","WVUTL9",1,0)
WVUTL9 ;HCIOFO/FT - Women's Health Utility Routine; ;12/15/98  15:54
"RTN","WVUTL9",2,0)
 ;;1.0;WOMEN'S HEALTH;**3**;Sep 30, 1998
"RTN","WVUTL9",3,0)
 ;
"RTN","WVUTL9",4,0)
DCM(SITE) ; Default case manager check
"RTN","WVUTL9",5,0)
 ; If there is a default case manager return 1 else 0.
"RTN","WVUTL9",6,0)
 I 'SITE Q 0
"RTN","WVUTL9",7,0)
 I $P($G(^WV(790.02,SITE,0)),U,2) Q 1
"RTN","WVUTL9",8,0)
 Q 0
"RTN","WVUTL9",9,0)
 ;
"RTN","WVUTL9",10,0)
NODCM ; No Default Case Manager message
"RTN","WVUTL9",11,0)
 W !,"Sorry, but a DEFAULT CASE MANAGER must be assigned for your facility"
"RTN","WVUTL9",12,0)
 W !,"before a patient can be entered into the Women's Health database.",!
"RTN","WVUTL9",13,0)
 W !,"Please use the EDIT SITE PARAMETERS option on the FILE MAINTENANCE"
"RTN","WVUTL9",14,0)
 W !,"menu to designate a DEFAULT CASE MANAGER.",!
"RTN","WVUTL9",15,0)
 D DIRZ^WVUTL3
"RTN","WVUTL9",16,0)
 Q
"RTN","WVUTL9",17,0)
 ;
"RTN","WVUTL9",18,0)
AGE(DFN) ;EP
"RTN","WVUTL9",19,0)
 ;---> YIELD PATIENT'S AGE IN YEARS.
"RTN","WVUTL9",20,0)
 ;---> REQUIRED VARIABLE: DFN=IEN PATIENT FILE
"RTN","WVUTL9",21,0)
 ; Different from AGE^WVUTL1. This EP returns age at date of death.
"RTN","WVUTL9",22,0)
 N X,X1,X2
"RTN","WVUTL9",23,0)
 Q:'$G(DFN) "NO PATIENT"
"RTN","WVUTL9",24,0)
 S X2=$$DOB^WVUTL1(DFN)
"RTN","WVUTL9",25,0)
 Q:'+X2 "UNKNOWN"
"RTN","WVUTL9",26,0)
 S X1=DT
"RTN","WVUTL9",27,0)
 I $$DECEASED^WVUTL1(DFN) S X1=+^DPT(DFN,.35)
"RTN","WVUTL9",28,0)
 D ^%DTC
"RTN","WVUTL9",29,0)
 Q $P(X/365.25,".")_"y/o"
"RTN","WVUTL9",30,0)
 ;
"VER")
8.0^21.0
"^DD",790.07,790.07,2,0)
UPPERCASE REFERRAL SOURCE^CJ30^^ ; ^S X=$P(^WV(790.07,D0,0),"^"),X=$$UP^XLFSTR(X)
"^DD",790.07,790.07,2,9)
^
"^DD",790.07,790.07,2,9.01)

"^DD",790.07,790.07,2,9.1)
S X=$P(^WV(790.07,D0,0),"^"),X=$$UP^XLFSTR(X)
"^DD",790.07,790.07,2,21,0)
^^2^2^2980709^
"^DD",790.07,790.07,2,21,1,0)
This field converts the referral source to all capital letters for 
"^DD",790.07,790.07,2,21,2,0)
x-referencing.
"^DD",790.07,790.07,2,"DT")
2981209
**END**
**END**
