Released IB*2*197 SEQ #181
Extracted from mail message
**KIDS**:IB*2.0*197^

**INSTALL NAME**
IB*2.0*197
"BLD",3603,0)
IB*2.0*197^INTEGRATED BILLING^0^3030220^y
"BLD",3603,1,0)
^^3^3^3030203^
"BLD",3603,1,1,0)
This patch corrects minor issues related to the EDI claims transmission
"BLD",3603,1,2,0)
and opens up the use of the Output Formatter for the CURRENT INS CO
"BLD",3603,1,3,0)
PROVIDER NUMBER.
"BLD",3603,4,0)
^9.64PA^350.8^3
"BLD",3603,4,350.8,0)
350.8
"BLD",3603,4,350.8,222)
n^n^f^^n^^y^o^n
"BLD",3603,4,350.8,224)
I Y=249
"BLD",3603,4,364.1,0)
364.1
"BLD",3603,4,364.1,2,0)
^9.641^364.1^1
"BLD",3603,4,364.1,2,364.1,0)
EDI TRANSMISSION BATCH  (File-top level)
"BLD",3603,4,364.1,2,364.1,1,0)
^9.6411^.04^1
"BLD",3603,4,364.1,2,364.1,1,.04,0)
MAIL MESSAGE
"BLD",3603,4,364.1,222)
y^n^p^^^^n
"BLD",3603,4,364.7,0)
364.7
"BLD",3603,4,364.7,222)
n^n^f^^n^^y^o^n
"BLD",3603,4,364.7,224)
I Y=311!(Y=53)!(Y=183)
"BLD",3603,4,"APDD",364.1,364.1)

"BLD",3603,4,"APDD",364.1,364.1,.04)

"BLD",3603,4,"B",350.8,350.8)

"BLD",3603,4,"B",364.1,364.1)

"BLD",3603,4,"B",364.7,364.7)

"BLD",3603,"ABPKG")
n
"BLD",3603,"INIT")
IBY197PO
"BLD",3603,"KRN",0)
^9.67PA^8989.52^19
"BLD",3603,"KRN",.4,0)
.4
"BLD",3603,"KRN",.4,"NM",0)
^9.68A^^
"BLD",3603,"KRN",.401,0)
.401
"BLD",3603,"KRN",.402,0)
.402
"BLD",3603,"KRN",.403,0)
.403
"BLD",3603,"KRN",.5,0)
.5
"BLD",3603,"KRN",.84,0)
.84
"BLD",3603,"KRN",3.6,0)
3.6
"BLD",3603,"KRN",3.8,0)
3.8
"BLD",3603,"KRN",9.2,0)
9.2
"BLD",3603,"KRN",9.8,0)
9.8
"BLD",3603,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",3603,"KRN",9.8,"NM",1,0)
IBCE837^^0^B83089151
"BLD",3603,"KRN",9.8,"NM",2,0)
IBCE837B^^0^B2951786
"BLD",3603,"KRN",9.8,"NM",3,0)
IBCEXTRP^^0^B20314163
"BLD",3603,"KRN",9.8,"NM",4,0)
IBCEU0^^0^B38840207
"BLD",3603,"KRN",9.8,"NM",5,0)
IBCEFG1^^0^B23547409
"BLD",3603,"KRN",9.8,"NM",6,0)
IBCECSA2^^0^B78300535
"BLD",3603,"KRN",9.8,"NM",7,0)
IBCEST^^0^B45445309
"BLD",3603,"KRN",9.8,"NM","B","IBCE837",1)

"BLD",3603,"KRN",9.8,"NM","B","IBCE837B",2)

"BLD",3603,"KRN",9.8,"NM","B","IBCECSA2",6)

"BLD",3603,"KRN",9.8,"NM","B","IBCEFG1",5)

"BLD",3603,"KRN",9.8,"NM","B","IBCEST",7)

"BLD",3603,"KRN",9.8,"NM","B","IBCEU0",4)

"BLD",3603,"KRN",9.8,"NM","B","IBCEXTRP",3)

"BLD",3603,"KRN",19,0)
19
"BLD",3603,"KRN",19.1,0)
19.1
"BLD",3603,"KRN",101,0)
101
"BLD",3603,"KRN",409.61,0)
409.61
"BLD",3603,"KRN",771,0)
771
"BLD",3603,"KRN",870,0)
870
"BLD",3603,"KRN",8989.51,0)
8989.51
"BLD",3603,"KRN",8989.52,0)
8989.52
"BLD",3603,"KRN",8994,0)
8994
"BLD",3603,"KRN","B",.4,.4)

"BLD",3603,"KRN","B",.401,.401)

"BLD",3603,"KRN","B",.402,.402)

"BLD",3603,"KRN","B",.403,.403)

"BLD",3603,"KRN","B",.5,.5)

"BLD",3603,"KRN","B",.84,.84)

"BLD",3603,"KRN","B",3.6,3.6)

"BLD",3603,"KRN","B",3.8,3.8)

"BLD",3603,"KRN","B",9.2,9.2)

"BLD",3603,"KRN","B",9.8,9.8)

"BLD",3603,"KRN","B",19,19)

"BLD",3603,"KRN","B",19.1,19.1)

"BLD",3603,"KRN","B",101,101)

"BLD",3603,"KRN","B",409.61,409.61)

"BLD",3603,"KRN","B",771,771)

"BLD",3603,"KRN","B",870,870)

"BLD",3603,"KRN","B",8989.51,8989.51)

"BLD",3603,"KRN","B",8989.52,8989.52)

"BLD",3603,"KRN","B",8994,8994)

"BLD",3603,"QUES",0)
^9.62^^
"BLD",3603,"REQB",0)
^9.611^2^2
"BLD",3603,"REQB",1,0)
IB*2.0*191^2
"BLD",3603,"REQB",2,0)
IB*2.0*189^2
"BLD",3603,"REQB","B","IB*2.0*189",2)

"BLD",3603,"REQB","B","IB*2.0*191",1)

"DATA",350.8,249,0)
IB208^HCPCS code required for bill type and revenue code on this bill^IB208^1^3
"DATA",364.7,53,0)
945^N^5^^^^N
"DATA",364.7,53,1)
N IBZ S IBZ=$$PROFID^IBCEP3(IBXIEN,$$COBN^IBCEF(IBXIEN)) S:+IBZ>1 ^TMP("IBXSAVE",$J,"PRF-22")=$P(IBZ,U,2)
"DATA",364.7,53,3,0)
^^3^3^3021107^
"DATA",364.7,53,3,1,0)
If the form is a HCFA 1500 and the ID for the rendering provider for the 
"DATA",364.7,53,3,2,0)
insurance company is not the facility tax ID, it stores the rendering 
"DATA",364.7,53,3,3,0)
provider ID # in the global for use by later fields.  No Output.
"DATA",364.7,183,0)
131^N^5^^^^N
"DATA",364.7,183,1)
N Z S IBXNOREQ='$$REQ^IBCEF1(3,"O",IBXIEN) K IBXDATA Q:IBXNOREQ!$$INPAT^IBCEF(IBXIEN,1)  S Z=$$SERVDT^IBCEF(IBXIEN,8,1),Q=0 S:Z'="" IBXSAVE("DATE")=Z D RCDT^IBCEFG1(.IBXSAVE,.IBXDATA,Z)
"DATA",364.7,183,3,0)
^364.73^4^4^3021217^^^^
"DATA",364.7,183,3,1,0)
If data element's value is null, do not output.
"DATA",364.7,183,3,2,0)
If this is an inpatient bill do not send this data element.  If outpatient,
"DATA",364.7,183,3,3,0)
output IBXSAVE("DATE") - STATEMENT FROM DATE or the date from the
"DATA",364.7,183,3,4,0)
associated procedure, if it can be determined.
"DATA",364.7,311,0)
552^N^262^^^^N
"DATA",364.7,311,1)
I $$OLAB^IBCEU(IBXIEN) N IBZ S IBZ=IBXDATA D F^IBCEF("N-LAB CLIA #",,,IBXIEN) I IBXDATA="",IBZ'="" S IBXDATA=IBZ
"DATA",364.7,311,3,0)
^364.73^2^2^3021108^^^^
"DATA",364.7,311,3,1,0)
If the bill is for services rendered at an outside lab, get the CLIA number.
"DATA",364.7,311,3,2,0)
If this # is not available, use the prior authorization #.
"FIA",350.8)
IB ERROR
"FIA",350.8,0)
^IBE(350.8,
"FIA",350.8,0,0)
350.8I
"FIA",350.8,0,1)
n^n^f^^n^^y^o^n
"FIA",350.8,0,10)

"FIA",350.8,0,11)
I Y=249
"FIA",350.8,0,"RLRO")

"FIA",350.8,0,"VR")
2.0^IB
"FIA",350.8,350.8)
0
"FIA",364.1)
EDI TRANSMISSION BATCH
"FIA",364.1,0)
^IBA(364.1,
"FIA",364.1,0,0)
364.1I
"FIA",364.1,0,1)
y^n^p^^^^n
"FIA",364.1,0,10)

"FIA",364.1,0,11)

"FIA",364.1,0,"RLRO")

"FIA",364.1,0,"VR")
2.0^IB
"FIA",364.1,364.1)
1
"FIA",364.1,364.1,.04)

"FIA",364.7)
IB FORM FIELD CONTENT
"FIA",364.7,0)
^IBA(364.7,
"FIA",364.7,0,0)
364.7IP
"FIA",364.7,0,1)
n^n^f^^n^^y^o^n
"FIA",364.7,0,10)

"FIA",364.7,0,11)
I Y=311!(Y=53)!(Y=183)
"FIA",364.7,0,"RLRO")

"FIA",364.7,0,"VR")
2.0^IB
"FIA",364.7,364.7)
0
"FIA",364.7,364.73)
0
"INIT")
IBY197PO
"IX",364.7,364.7,"ALL",0)
364.7^ALL^Xref contains all local overrides defined for all insurance and type^MU^^F^IR^I^364.7^^^^^S
"IX",364.7,364.7,"ALL",1)
S ^IBA(364.7,"ALL",X2(2),DA)=""
"IX",364.7,364.7,"ALL",1.4)
I 'X2(2)!(X2(4)'="")!(X2(5)'="")!(X2(3)'="L") S X=0
"IX",364.7,364.7,"ALL",2)
K ^IBA(364.7,"ALL",X1(2),DA)
"IX",364.7,364.7,"ALL",2.4)
I 'X1(2)!(X1(4)'="")!(X1(5)'="")!(X1(3)'="L") S X=0
"IX",364.7,364.7,"ALL",2.5)
K ^IBA(364.7,"ALL")
"IX",364.7,364.7,"ALL",11.1,0)
^.114IA^5^5
"IX",364.7,364.7,"ALL",11.1,1,0)
1^F^364.7^.01^15^^F
"IX",364.7,364.7,"ALL",11.1,1,3)

"IX",364.7,364.7,"ALL",11.1,2,0)
2^C^^^10^1
"IX",364.7,364.7,"ALL",11.1,2,1.5)
S X=$P($G(^IBA(364.6,+X(1),0)),U,3)
"IX",364.7,364.7,"ALL",11.1,3,0)
3^F^364.7^.02^10^^F
"IX",364.7,364.7,"ALL",11.1,3,3)

"IX",364.7,364.7,"ALL",11.1,4,0)
4^F^364.7^.05^20^^F
"IX",364.7,364.7,"ALL",11.1,4,3)

"IX",364.7,364.7,"ALL",11.1,5,0)
5^F^364.7^.06^20^^F
"IX",364.7,364.7,"ALL",11.1,5,3)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321
"PKG",200,22,1,"PAH",1,0)
197^3030220
"PKG",200,22,1,"PAH",1,1,0)
^^3^3^3030220
"PKG",200,22,1,"PAH",1,1,1,0)
This patch corrects minor issues related to the EDI claims transmission
"PKG",200,22,1,"PAH",1,1,2,0)
and opens up the use of the Output Formatter for the CURRENT INS CO
"PKG",200,22,1,"PAH",1,1,3,0)
PROVIDER NUMBER.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","IBCE837")
0^1^B83089151
"RTN","IBCE837",1,0)
IBCE837 ;ALB/TMP - OUTPUT FOR 837 TRANSMISSION ;05-FEB-96
"RTN","IBCE837",2,0)
 ;;2.0;INTEGRATED BILLING;**137,191,197**;21-MAR-94
"RTN","IBCE837",3,0)
 ;
"RTN","IBCE837",4,0)
EN ; Run auto-transmit
"RTN","IBCE837",5,0)
 N IBSITE8,IBRUN,X,X1,X2
"RTN","IBCE837",6,0)
 K ^TMP("IBRESUBMIT",$J),^TMP("IBONE",$J)
"RTN","IBCE837",7,0)
 S IBSITE8=$G(^IBE(350.9,1,8)),IBRUN=1
"RTN","IBCE837",8,0)
 Q:'$P(IBSITE8,U,3)!'$P(IBSITE8,U,10)
"RTN","IBCE837",9,0)
 I '$$MGCHK^IBCE(0) Q
"RTN","IBCE837",10,0)
 I $P(IBSITE8,U,5) D  Q:'IBRUN
"RTN","IBCE837",11,0)
 . S X2=+$P(IBSITE8,U,3),X1=$P(IBSITE8,U,5) D C^%DTC
"RTN","IBCE837",12,0)
 . I X>DT S IBRUN=0 Q
"RTN","IBCE837",13,0)
 D QTXMT^IBCE837B(IBSITE8)
"RTN","IBCE837",14,0)
 I $P(IBSITE8,U,5)'=DT S DIE="^IBE(350.9,",DR="8.05////"_DT,DA=1 D ^DIE
"RTN","IBCE837",15,0)
 Q
"RTN","IBCE837",16,0)
 ;
"RTN","IBCE837",17,0)
SETUP(IBEXTRP) ; Txmn set up
"RTN","IBCE837",18,0)
 ; IBEXTRP = 1 print 837 data
"RTN","IBCE837",19,0)
 N IB
"RTN","IBCE837",20,0)
 K ^TMP("IBXMSG",$J),^TMP("IBTXMT",$J),^TMP("IBHDR",$J),^TMP("IBHDR1",$J),^TMP("IBXERR",$J),IBXERR,^TMP("IBXINS",$J),^TMP("IBTX",$J)
"RTN","IBCE837",21,0)
 ; Check if extract job running
"RTN","IBCE837",22,0)
 Q:$G(IBEXTRP)
"RTN","IBCE837",23,0)
 I '$D(^TMP("IBRESUBMIT",$J)),'$D(^TMP("IBONE",$J)) D  Q:$D(IBXERR)
"RTN","IBCE837",24,0)
 . L +^IBA(364,0):5
"RTN","IBCE837",25,0)
 . I '$T D  Q
"RTN","IBCE837",26,0)
 .. S IBXERR=1,^TMP("IBXERR",$J,1)="A PREVIOUS EDI EXTRACT IS RUNNING - ANOTHER CANNOT BE STARTED "_$$FMTE^XLFDT($$NOW^XLFDT(),2)
"RTN","IBCE837",27,0)
 ;
"RTN","IBCE837",28,0)
 I $D(^TMP("IBRESUBMIT",$J)) D  Q:$D(IBXERR)
"RTN","IBCE837",29,0)
 .N Z,Z0
"RTN","IBCE837",30,0)
 .S Z0=$P($G(^TMP("IBRESUBMIT",$J)),U,2),Z=$$LOCK^IBCEM02(364.1,Z0)
"RTN","IBCE837",31,0)
 .I 'Z D
"RTN","IBCE837",32,0)
 ..S IBXERR=1
"RTN","IBCE837",33,0)
 ..S ^TMP("IBRESUBMIT",$J,"IBXERR",1)="Another user is currently processing batch "_Z0_".  Batch NOT resubmitted."
"RTN","IBCE837",34,0)
 .I 'Z D
"RTN","IBCE837",35,0)
 ..S IBXERR=1
"RTN","IBCE837",36,0)
 ..S ^TMP("IBRESUBMIT",$J,"IBXERR",1)="Another user is currently processing batch "_Z0_".  Batch NOT resubmitted."
"RTN","IBCE837",37,0)
 ..S ^TMP("IBRESUBMIT",$J,"IBXERR",2)="Resubmit was attempted by: "_$P($G(^VA(200,DUZ,0)),U)_" ("_DUZ_")"
"RTN","IBCE837",38,0)
 I $D(^TMP("IBONE",$J)) S IB=$G(^($J))+1 D  Q:$D(IBXERR)
"RTN","IBCE837",39,0)
 .N Z,Z0
"RTN","IBCE837",40,0)
 .S Z0=$O(^TMP("IBONE",$J,"")),Z=$$LOCK^IBCEM02(364,Z0)
"RTN","IBCE837",41,0)
 .I 'Z D
"RTN","IBCE837",42,0)
 ..S IBXERR=1
"RTN","IBCE837",43,0)
 ..S ^TMP("IBONE",$J,"IBXERR",1)="Another user is currently processing bill "_$P($G(^DGCR(399,+$G(^IBA(364,Z0,0)),0)),U)_".  Bill NOT "_$P("^re",U,IB)_"submitted."
"RTN","IBCE837",44,0)
 ..S ^TMP("IBONE",$J,"IBXERR",2)=$P("S^Res",U,IB)_"ubmit was attempted by: "_$P($G(^VA(200,DUZ,0)),U)_" ("_DUZ_")"
"RTN","IBCE837",45,0)
 Q
"RTN","IBCE837",46,0)
 ;
"RTN","IBCE837",47,0)
FIND ; Find bills/sort by HCFA 1500/UB92, test/live, ins co ID # plus div
"RTN","IBCE837",48,0)
 ;
"RTN","IBCE837",49,0)
 N IBX,IB0,IBCBH,IBINS,IBXIEN,IBNID,IBGBL,IBTXTEST,IBBTYP,IB837R,IBDIV,IBNOTX,IBTXST
"RTN","IBCE837",50,0)
 K ^TMP($J,"BILL"),^TMP("IBICT",$J)
"RTN","IBCE837",51,0)
 ;
"RTN","IBCE837",52,0)
 S IBGBL=$S($D(^TMP("IBONE",$J)):"^TMP(""IBONE"","_$J_")",$D(^TMP("IBSELX",$J)):"^TMP(""IBSELX"","_$J_")",'$D(^TMP("IBRESUBMIT",$J)):"^IBA(364,""ASTAT"",""X"")",1:"^TMP(""IBRESUBMIT"","_$J_")")
"RTN","IBCE837",53,0)
 ;
"RTN","IBCE837",54,0)
 S IBX="" F  S IBX=$O(@IBGBL@(IBX)) Q:'IBX  D
"RTN","IBCE837",55,0)
 .S IBXIEN=+$G(^IBA(364,IBX,0)),IB0=$G(^DGCR(399,IBXIEN,0))
"RTN","IBCE837",56,0)
 .S IBTXST=$$TXMT^IBCEF4(IBXIEN,.IBNOTX)
"RTN","IBCE837",57,0)
 .Q:IBTXST=""  ; no txmt
"RTN","IBCE837",58,0)
 .Q:$S(IB0="":1,$P(IB0,U,13)>4:1,1:$D(^TMP($J,"BILL",$P(IB0,U))))
"RTN","IBCE837",59,0)
 .S IBCBH=$P(IB0,U,21) S:"PST"'[IBCBH!(IBCBH="") IBCBH="P"
"RTN","IBCE837",60,0)
 .S IBINS=$P($G(^DGCR(399,IBXIEN,"I"_($F("PST",IBCBH)-1))),U)
"RTN","IBCE837",61,0)
 .S IBTXTEST=+$$TEST^IBCEF4(IBXIEN)
"RTN","IBCE837",62,0)
 .S IBBTYP=$P("P^I",U,($$FT^IBCEF(IBXIEN)=3)+1)_"-"_IBTXTEST
"RTN","IBCE837",63,0)
 .Q:$$TESTPT^IBCEU($P(IB0,U,2))&'IBTXTEST  ;Test pt
"RTN","IBCE837",64,0)
 .;
"RTN","IBCE837",65,0)
 .I IBTXTEST D
"RTN","IBCE837",66,0)
 ..N IB3
"RTN","IBCE837",67,0)
 ..S IB3=$G(^DIC(36,IBINS,3))
"RTN","IBCE837",68,0)
 ..I $P(IB3,U,5)'=DT S $P(IB3,U,7)=0
"RTN","IBCE837",69,0)
 ..I ($P(IB3,U,7)+$G(^TMP("IBICT",$J,IBINS))+1)>$P(IB3,U,6) D  Q
"RTN","IBCE837",70,0)
 ...S IBINS="" ;max # hit
"RTN","IBCE837",71,0)
 ...S DA=IBX,DIK="^IBA(364," D ^DIK
"RTN","IBCE837",72,0)
 ..S ^TMP("IBICT",$J,IBINS)=$G(^TMP("IBICT",$J,IBINS))+1
"RTN","IBCE837",73,0)
 .;
"RTN","IBCE837",74,0)
 .I IBINS,$P(IB0,U,2) D
"RTN","IBCE837",75,0)
 ..S IBNID=$$PAYERID^IBCEF2(IBXIEN)
"RTN","IBCE837",76,0)
 ..S IB837R=$$RECVR^IBCEF2(IBXIEN)
"RTN","IBCE837",77,0)
 ..S IBDIV=$P($S($P(IB0,U,22):$$SITE^VASITE(DT,$P(IB0,U,22)),1:$$SITE^VASITE()),U,3)
"RTN","IBCE837",78,0)
 ..I IBNID'="","RPIHS"[$E(IBNID),$E(IBNID,2,$L(IBNID))="PRNT" S IBNID=IBNID_"*"_IBINS
"RTN","IBCE837",79,0)
 ..I IBNID="" S IBNID="*"_IBINS
"RTN","IBCE837",80,0)
 ..S $P(IBNID,"*",3)=$S($P(IB0,U,22):$P(IB0,U,22),1:"")
"RTN","IBCE837",81,0)
 ..S:'$D(^TMP("IBXINS",$J,IBDIV_U_IBBTYP,IBNID)) ^(IBNID)=IBINS S ^TMP("IBTXMT",$J,IBDIV_U_IBBTYP,IB837R,IBNID,$P(IB0,U,2),IBXIEN_U_IBX)=IBX
"RTN","IBCE837",82,0)
 .;
"RTN","IBCE837",83,0)
 .S ^TMP($J,"BILL",$P(IB0,U))=""
"RTN","IBCE837",84,0)
 ;
"RTN","IBCE837",85,0)
 I $D(^TMP("IBTXMT",$J)) S ^TMP("IBXDATA",$J)=IBNID
"RTN","IBCE837",86,0)
 K ^TMP($J,"BILL")
"RTN","IBCE837",87,0)
 Q
"RTN","IBCE837",88,0)
 ;
"RTN","IBCE837",89,0)
OUTPUT ;Output 837
"RTN","IBCE837",90,0)
 ;
"RTN","IBCE837",91,0)
 N IB837,IBSITE,IBMAX,IBQUEUE,IBTQUEUE,IBNID,IBCT,IBCTM,IBSIZE,IBBILL,IBLCNT,IBDFN,IBREF,IBSIZEM,IBPARMS,IBD,IBDESC,IBINS,IBQ,IB3,IBBTYP,IBTXTEST,IBDEFPRT,IB837R,IBBTYPX
"RTN","IBCE837",92,0)
 ;
"RTN","IBCE837",93,0)
 K ^TMP("IBCE-BATCH",$J)
"RTN","IBCE837",94,0)
 S IBSITE=$G(^IBE(350.9,1,8)),IBMAX=$P(IBSITE,U,4),IB837=+$O(^IBE(353,"B","IB 837 TRANSMISSION",0)),IB837=$S($P($G(^IBE(353,+IB837,2)),U,8):$P(^(2),U,8),1:IB837) S:'IBMAX IBMAX=999
"RTN","IBCE837",95,0)
 ;
"RTN","IBCE837",96,0)
 I 'IB837 D  Q
"RTN","IBCE837",97,0)
 . N IBZ,XMBODY
"RTN","IBCE837",98,0)
 . S XMBODY="IBZ"
"RTN","IBCE837",99,0)
 . S IBZ(1)="The transmission form for sending electronic claims is not in your form file",IBZ(2)="NO CLAIMS WERE OUTPUT - FORM = IB 837 TRANSMISSION"
"RTN","IBCE837",100,0)
 . D ERRMSG^IBCE837A(XMBODY)
"RTN","IBCE837",101,0)
 ;
"RTN","IBCE837",102,0)
 S (IBCT,IBCTM,IBSIZE)=0,IBQUEUE=$P(IBSITE,U),IBTQUEUE=$P(IBSITE,U,9),IBDESC=""
"RTN","IBCE837",103,0)
 ;
"RTN","IBCE837",104,0)
 Q:IBQUEUE=""&(IBTQUEUE="")
"RTN","IBCE837",105,0)
 ;
"RTN","IBCE837",106,0)
 S IBQ="",IBBTYPX=""
"RTN","IBCE837",107,0)
 ; Sort: div_^_bill type_-_test stat,ins co transmission destination,dfn,claim #
"RTN","IBCE837",108,0)
 F  S IBBTYPX=$O(^TMP("IBTXMT",$J,IBBTYPX)),IBBTYP=$P(IBBTYPX,U,2) D:IBCTM CHKNEW^IBCE837A(IBQ,.IBBILL,.IBCTM,IBDESC,IBBTYP,"",IBSITE,.IBSIZE) Q:IBBTYPX=""  D
"RTN","IBCE837",109,0)
 . S IBDEFPRT=$S($E(IBBTYP)="P":"SPRINT",1:"SPRINT")
"RTN","IBCE837",110,0)
 . S IBTXTEST=+$P(IBBTYP,"-",2),IBQ=$S('IBTXTEST:IBQUEUE,1:IBTQUEUE)
"RTN","IBCE837",111,0)
 . Q:IBQ=""  ; Queue
"RTN","IBCE837",112,0)
 . ;
"RTN","IBCE837",113,0)
 . S IBD=$S($E(IBBTYP)="P":"PROF",1:"INST")_" CLAIMS-"_$$HTE^XLFDT($H,2)_"  "
"RTN","IBCE837",114,0)
 . S IBDESC=$S('$P(IBSITE,U,7):$S('IBTXTEST:"",1:"TEST ")_IBD,1:"")
"RTN","IBCE837",115,0)
 . ;
"RTN","IBCE837",116,0)
 . S IB837R=""
"RTN","IBCE837",117,0)
 . F  S IB837R=$O(^TMP("IBTXMT",$J,IBBTYPX,IB837R)) D:IBCTM CHKNEW^IBCE837A(IBQ,.IBBILL,.IBCTM,IBDESC,IBBTYP,"",IBSITE,.IBSIZE) Q:IB837R=""  D
"RTN","IBCE837",118,0)
 .. S (IBINS,IBNID)="",IBLCNT=0
"RTN","IBCE837",119,0)
 .. F  S IBNID=$O(^TMP("IBTXMT",$J,IBBTYPX,IB837R,IBNID)) K ^TMP("IBHDR1",$J) D:IBCTM CHKNEW^IBCE837A(IBQ,.IBBILL,.IBCTM,IBDESC,IBBTYP,IBINS,IBSITE,.IBSIZE) Q:IBNID=""  D
"RTN","IBCE837",120,0)
 ...;
"RTN","IBCE837",121,0)
 ...S IBDFN=0,IBINS=+$G(^TMP("IBXINS",$J,IBBTYPX,IBNID))
"RTN","IBCE837",122,0)
 ... ;
"RTN","IBCE837",123,0)
 ...I $P(IBSITE,U,7) D  ; 1 ins per batch
"RTN","IBCE837",124,0)
 .... S IBLCNT=0
"RTN","IBCE837",125,0)
 .... S IBDESC=$E($S('IBTXTEST:"",1:"TEST ")_IBD_$P($G(^DIC(36,IBINS,0)),U),1,80)
"RTN","IBCE837",126,0)
 ... ;
"RTN","IBCE837",127,0)
 ...F  S IBDFN=$O(^TMP("IBTXMT",$J,IBBTYPX,IB837R,IBNID,IBDFN)) Q:'IBDFN  S IBREF="" F  S IBREF=$O(^TMP("IBTXMT",$J,IBBTYPX,IB837R,IBNID,IBDFN,IBREF)) Q:'IBREF  D
"RTN","IBCE837",128,0)
 ....I '(IBCTM#IBMAX),IBCTM D MAILIT^IBCE837A(IBQ,.IBBILL,.IBCTM,"",IBDESC,IBBTYP,IBINS) S IBSIZE=0 ;exceeds max #
"RTN","IBCE837",129,0)
 ....D BILLPARM^IBCEFG0(+IBREF,.IBPARMS)
"RTN","IBCE837",130,0)
 ....S IBSIZEM=$$EXTRACT^IBCEFG(IB837,+IBREF,1,.IBPARMS)
"RTN","IBCE837",131,0)
 ....I (IBSIZEM+IBSIZE)>30000,IBSIZE D  ; exceeds max size
"RTN","IBCE837",132,0)
 .....D MAILIT^IBCE837A(IBQ,.IBBILL,.IBCTM,"",IBDESC,IBBTYP,IBINS) S IBSIZE=0 K ^TMP("IBXDATA",$J) S IBSIZEM=$$EXTRACT^IBCEFG(IB837,+IBREF,1,.IBPARMS)
"RTN","IBCE837",133,0)
 ....I 'IBSIZEM D:'IBCTM  Q
"RTN","IBCE837",134,0)
 ..... D CHKBTCH^IBCE837A(+$G(^TMP("IBHDR",$J))) K ^TMP("IBHDR",$J)
"RTN","IBCE837",135,0)
 ....S IBCT=IBCT+1,IBCTM=IBCTM+1
"RTN","IBCE837",136,0)
 ....D:$D(^TMP("IBXDATA",$J)) MESSAGE(.IBLCNT,$P(IBREF,U,2),.IBBILL,.IBCTM,.IBSIZE,IBSIZEM,"",IBBTYP,IBINS)
"RTN","IBCE837",137,0)
 ..;
"RTN","IBCE837",138,0)
 ..I $G(IBTXTEST)=1 S IBINS=0 F  S IBINS=$O(^TMP("IBICT",$J,IBINS)) Q:'IBINS  S IB3=$G(^DIC(36,IBINS,3)) D
"RTN","IBCE837",139,0)
 ...S DIE="^DIC(36,",DA=IBINS,DR="3.05////"_DT_";3.07////"_($S($P(IB3,U,5)'=DT:0,1:$P(IB3,U,7))+^TMP("IBICT",$J,IBINS)) D ^DIE
"RTN","IBCE837",140,0)
 ;
"RTN","IBCE837",141,0)
 I $O(^TMP("IBXERR",$J,"")) D  ;Error msg to mail group
"RTN","IBCE837",142,0)
 .N XMTO,XMBODY,XMDUZ,XMSUBJ,IBCT,IBERR
"RTN","IBCE837",143,0)
 .K ^TMP("IBXMSG",$J)
"RTN","IBCE837",144,0)
 .S ^TMP("IBXMSG",$J,1)="The following authorized bill(s) were not transmitted due to errors indicated.",^(2)="Once the errors are corrected, the bill(s) will be included in the next run.",^(3)=" "
"RTN","IBCE837",145,0)
 .;
"RTN","IBCE837",146,0)
 .S IBERR=0,IBCT=3
"RTN","IBCE837",147,0)
 .F  S IBERR=$O(^TMP("IBXERR",$J,IBERR)) Q:'IBERR  S IBCT=IBCT+1,^TMP("IBXMSG",$J,IBCT)="Bill #: "_$P($G(^DGCR(399,IBERR,0)),U),IBCT=IBCT+1,^TMP("IBXMSG",$J,IBCT)=$J("",5)_^TMP("IBXERR",$J,IBERR)
"RTN","IBCE837",148,0)
 .S XMBODY="^TMP(""IBXMSG"","_$J_")" D ERRMSG^IBCE837A(XMBODY)
"RTN","IBCE837",149,0)
 .;
"RTN","IBCE837",150,0)
 .K ^TMP("IBXMSG",$J),^TMP("IBICT",$J)
"RTN","IBCE837",151,0)
 ;
"RTN","IBCE837",152,0)
 I $O(^TMP("IBCE-BATCH",$J,"")) D
"RTN","IBCE837",153,0)
 .N IB,IB0,IBL,IBT,XMTO,XMDUZ,XMSUBJ,IBRESUB
"RTN","IBCE837",154,0)
 .S IBRESUB=$D(^TMP("IBRESUBMIT",$J))
"RTN","IBCE837",155,0)
 .;
"RTN","IBCE837",156,0)
 .S IBT(1)="The following batches were "_$S('IBRESUB:"",1:"re-")_"submitted to Austin "_$$HTE^XLFDT($H,"2D")_":"
"RTN","IBCE837",157,0)
 .S IBT(2)=$S('IBRESUB:" ",1:"   [Resubmitted by: "_$P($G(^VA(200,+DUZ,0)),U)_" (#"_DUZ_")]") S:IBRESUB IBT(3)=" "
"RTN","IBCE837",158,0)
 .;
"RTN","IBCE837",159,0)
 .S IBL=$S('IBRESUB:2,1:3),IB=""
"RTN","IBCE837",160,0)
 .F  S IB=$O(^TMP("IBCE-BATCH",$J,IB)) Q:IB=""  S IBL=IBL+1,IB0=$G(^(IB)) D
"RTN","IBCE837",161,0)
 ..S IBT(IBL)=" "_IB_" "_$P($G(^IBA(364.1,+IB0,0)),U,8),IBL=IBL+1,IBT(IBL)="    ("_+$P(IB0,U,2)_" bills)"
"RTN","IBCE837",162,0)
 .;
"RTN","IBCE837",163,0)
 .S XMTO("I:G.IB EDI")="",XMDUZ="",XMBODY="IBT",XMSUBJ="EDI 837 "_$S('IBRESUB:"",1:"RE-")_"SUBMISSION BATCH LIST"
"RTN","IBCE837",164,0)
 .D SENDMSG^XMXAPI(XMDUZ,XMSUBJ,XMBODY,.XMTO,,.XMZ)
"RTN","IBCE837",165,0)
 .;
"RTN","IBCE837",166,0)
 .S:IBRESUB ^TMP("IBRESUBMIT",$J,0)=1
"RTN","IBCE837",167,0)
 Q
"RTN","IBCE837",168,0)
 ;
"RTN","IBCE837",169,0)
CLEANUP ; moved
"RTN","IBCE837",170,0)
 D CLEANUP^IBCE837A
"RTN","IBCE837",171,0)
 Q
"RTN","IBCE837",172,0)
 ;
"RTN","IBCE837",173,0)
MESSAGE(IBLCNT,IBIEN,IBBILL,IBCTM,IBSIZE,IBSIZEM,IBDUZ,IBBTYP,IBINS) ; Create msg lines in ^TMP("IBXMSG",$J)
"RTN","IBCE837",174,0)
 ;IBLCNT = last msg line extracted
"RTN","IBCE837",175,0)
 ;IBIEN = ien file 364 bill entry
"RTN","IBCE837",176,0)
 ;IBBILL = array of file 364 ien's of bills in batch being sent
"RTN","IBCE837",177,0)
 ; IBBILL(IEN)=""
"RTN","IBCE837",178,0)
 ;IBSIZE = # bytes in mail msg
"RTN","IBCE837",179,0)
 ;IBSIZEM = # bytes in record to be added to mail msg
"RTN","IBCE837",180,0)
 ;IBCTM = # bills in batch
"RTN","IBCE837",181,0)
 ;IBDUZ = user ien running extract (Postmaster if auto)
"RTN","IBCE837",182,0)
 ;IBBTYP = x-y where x = P for prof, I for inst
"RTN","IBCE837",183,0)
 ;                   y = 1 for test, 0 for live txmt
"RTN","IBCE837",184,0)
 ;IBINS = ien of 1 ins co for batch
"RTN","IBCE837",185,0)
 ;
"RTN","IBCE837",186,0)
 N IB,IBL,IB1,IB2,IB3,IBQ,IBREC,IBDEL
"RTN","IBCE837",187,0)
 S IBDEL=$O(^IBA(364.5,"B","N-SEGMENT DELIMITER","")),IBDEL=$P($G(^IBA(364.5,+IBDEL,0)),U,8) S:IBDEL="" IBDEL="~"
"RTN","IBCE837",188,0)
 S IBSIZE=IBSIZE+IBSIZEM,IB1="",IBREC=""
"RTN","IBCE837",189,0)
 F  S IB1=$O(^TMP("IBXDATA",$J,1,IB1)) Q:IB1=""  D
"RTN","IBCE837",190,0)
 .S (IBREC,IB2)=""
"RTN","IBCE837",191,0)
 .F  S IB2=$O(^TMP("IBXDATA",$J,1,IB1,IB2)) Q:$S(IB2="":1,IB1=1:"",1:'$O(^(IB2,1)))  D
"RTN","IBCE837",192,0)
 ..S IB3="",IBREC=""
"RTN","IBCE837",193,0)
 ..F  S IB3=$O(^TMP("IBXDATA",$J,1,IB1,IB2,IB3)) D:IB3=""&($L(IBREC)) SETG Q:IB3=""  S:$S(IB3=1:1,1:$P(IBREC,U)'="") $P(IBREC,U,IB3)=^TMP("IBXDATA",$J,1,IB1,IB2,IB3)
"RTN","IBCE837",194,0)
 S IBBILL(IBIEN)=""
"RTN","IBCE837",195,0)
 K ^TMP("IBXDATA",$J)
"RTN","IBCE837",196,0)
 Q
"RTN","IBCE837",197,0)
 ;
"RTN","IBCE837",198,0)
SETHDR ; hdr for current batch
"RTN","IBCE837",199,0)
 S ^TMP("IBHDR",$J)=$G(^TMP("IBXDATA",$J,1,5,1,2))
"RTN","IBCE837",200,0)
 Q
"RTN","IBCE837",201,0)
 ;
"RTN","IBCE837",202,0)
SETHDR1 ; hdr node for current ins
"RTN","IBCE837",203,0)
 S ^TMP("IBHDR1",$J)=$G(^TMP("IBXDATA",$J,1,20,1,8))
"RTN","IBCE837",204,0)
 Q
"RTN","IBCE837",205,0)
 ;
"RTN","IBCE837",206,0)
SETG ; msg global for each segment
"RTN","IBCE837",207,0)
 S IBREC=$TR(IBREC,IBDEL)
"RTN","IBCE837",208,0)
 S IBREC=IBREC_IBDEL,IBSIZE=IBSIZE+$L(IBDEL)
"RTN","IBCE837",209,0)
 S IBLCNT=IBLCNT+1,^TMP("IBXMSG",$J,IBLCNT)=IBREC
"RTN","IBCE837",210,0)
 Q
"RTN","IBCE837",211,0)
 ;
"RTN","IBCE837",212,0)
ONE ; Txmt 1 or more bills in 'X' status
"RTN","IBCE837",213,0)
 Q:'$$MGCHK^IBCE(0)
"RTN","IBCE837",214,0)
 D SETUP(0)
"RTN","IBCE837",215,0)
 I '$D(IBXERR) D FIND,OUTPUT
"RTN","IBCE837",216,0)
 D CLEANUP^IBCE837A
"RTN","IBCE837",217,0)
 Q
"RTN","IBCE837",218,0)
 ;
"RTN","IBCE837B")
0^2^B2951786
"RTN","IBCE837B",1,0)
IBCE837B ;ALB/TMP - OUTPUT FOR 837 TRANSMISSION (cont) ;24-APR-01
"RTN","IBCE837B",2,0)
 ;;2.0;INTEGRATED BILLING;**137,191,197**;21-MAR-94
"RTN","IBCE837B",3,0)
 ;
"RTN","IBCE837B",4,0)
QTXMT(IBSITE8) ; Run now or queue EDI bill transmit (part of nightly job)
"RTN","IBCE837B",5,0)
 ; IBSITE8 = the '8' node of the site parameters file (350.9)
"RTN","IBCE837B",6,0)
 I $P(IBSITE8,U,6)="" D
"RTN","IBCE837B",7,0)
 . D EN1("",1)
"RTN","IBCE837B",8,0)
 E  D
"RTN","IBCE837B",9,0)
 . N Z,Z0
"RTN","IBCE837B",10,0)
 . F Z=1:1:4 S Z0=$P($P(IBSITE8,U,6),";",Z) Q:Z0=""  D
"RTN","IBCE837B",11,0)
 .. S IBQDT=$S($E(($$NOW^XLFDT()#1*10000\1)_"0000",1,4)>Z0:$$FMADD^XLFDT(DT,1),1:DT)_"."_Z0  ; If time to queue is after the current time, queue for the next day
"RTN","IBCE837B",12,0)
 .. D EN1("",1,+IBQDT)
"RTN","IBCE837B",13,0)
 Q
"RTN","IBCE837B",14,0)
 ;
"RTN","IBCE837B",15,0)
EN1(IBZTSK,IBNOASK,IBQDT) ;Txmit 837's for bills waiting transmission
"RTN","IBCE837B",16,0)
 ; Pass IBZTSK by ref to get task # if job is tasked
"RTN","IBCE837B",17,0)
 ; IBNOASK = flag: 0 = ask to queue,  1 = no ask to queue
"RTN","IBCE837B",18,0)
 ; IBQDT = if IBNOASK=1, this can be the date/time to queue the job
"RTN","IBCE837B",19,0)
 N Z S Z=$O(^IBE(353,"B","IB 837 TRANSMISSION",0)),Z=$S($P($G(^IBE(353,+Z,2)),U,8):$P(^(2),U,8),1:Z)
"RTN","IBCE837B",20,0)
 I Z D
"RTN","IBCE837B",21,0)
 . I $D(^TMP("IBRESUBMIT",$J))!($G(IBNOASK)) D FORM^IBCEFG7(Z,$P($G(^IBE(350.9,1,8)),U),+$G(IBNOASK),$S($G(IBNOASK):$G(IBQDT),1:""),.IBZTSK) Q
"RTN","IBCE837B",22,0)
 . D FORM^IBCEFG7(Z,$P($G(^IBE(350.9,1,8)),U),+$G(IBNOASK),$S($G(IBNOASK):$G(IBQDT),1:""))
"RTN","IBCE837B",23,0)
 Q
"RTN","IBCE837B",24,0)
 ;
"RTN","IBCECSA2")
0^6^B78300535
"RTN","IBCECSA2",1,0)
IBCECSA2 ;ALB/CXW - IB CLAIMS STATUS AWAITING RESOLUTION SCREEN ;28-JUL-1999
"RTN","IBCECSA2",2,0)
 ;;2.0;INTEGRATED BILLING;**137,181,197**;21-MAR-1994
"RTN","IBCECSA2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCECSA2",4,0)
 ;
"RTN","IBCECSA2",5,0)
EN ; -- claims status awaiting resolution detail
"RTN","IBCECSA2",6,0)
 D EN^VALM("IBCEM CSA MSG")
"RTN","IBCECSA2",7,0)
 Q
"RTN","IBCECSA2",8,0)
 ;
"RTN","IBCECSA2",9,0)
HDR ; -- header code
"RTN","IBCECSA2",10,0)
 ; IBA - EOB ien from summary selection
"RTN","IBCECSA2",11,0)
 N IBST,IBST0
"RTN","IBCECSA2",12,0)
 Q:'$G(IBA)
"RTN","IBCECSA2",13,0)
 S IBST=$G(^IBM(361,+$P(IBA,U,2),0)),IBST0=$P(IBST,U,9)
"RTN","IBCECSA2",14,0)
 S VALMHDR(2)="Message Status= "_$S(IBST=1:$$EXPAND^IBTRE(361,.09,1),IBST=2:$S('$P(IBST0,U,14):$$EXPAND^IBTRE(361,.09,2),1:"REVIEW NOT NEEDED"),1:"NOT REVIEWED")
"RTN","IBCECSA2",15,0)
 S VALMHDR(1)=$J("",23)_"CLAIMS STATUS AWAITING RESOLUTION-DETAIL"
"RTN","IBCECSA2",16,0)
 Q
"RTN","IBCECSA2",17,0)
 ;
"RTN","IBCECSA2",18,0)
INIT ; -- init variables and list array
"RTN","IBCECSA2",19,0)
 N I,X,Y,Z,ZZ,IBZ,IBZ0,IBFST,IBX,IBCNT
"RTN","IBCECSA2",20,0)
 K ^TMP("IBCECSC",$J)
"RTN","IBCECSA2",21,0)
SCR S VALMCNT=0,IBCNT=1
"RTN","IBCECSA2",22,0)
 S IBA=+$O(IBDAX(0)),IBA=$G(IBDAX(IBA))
"RTN","IBCECSA2",23,0)
 Q:IBA=""
"RTN","IBCECSA2",24,0)
 S X=""
"RTN","IBCECSA2",25,0)
 S IBX=$S($D(^TMP("IBCECSB",$J)):$G(^TMP("IBCECSB",$J,$P(IBA,U,3),$P(IBA,U,4),$P(IBA,U,2))),1:"")
"RTN","IBCECSA2",26,0)
 D SETL1^IBCECSA1(IBX,.X)
"RTN","IBCECSA2",27,0)
 D SET(X,IBCNT)
"RTN","IBCECSA2",28,0)
 S X=$E("     Svc Loc: "_$P(IBX,U,7)_$J("",30),1,30)_"  "_$E("    Division: "_$P(IBX,U,8),1,40)
"RTN","IBCECSA2",29,0)
 D SET(X,IBCNT)
"RTN","IBCECSA2",30,0)
 S X=$E(" Biller Name: "_$P($P(IBX,U,9),"~")_$J("",30),1,30)_"  "_"Days Pending: "_$P(IBX,U,11)
"RTN","IBCECSA2",31,0)
 D SET(X,IBCNT)
"RTN","IBCECSA2",32,0)
 S IBZ=$P(IBA,U,2),IBZ0=$G(^IBM(361,IBZ,0))
"RTN","IBCECSA2",33,0)
 S X=$E("  Date Rec'd: "_$$FMTE^XLFDT($P(IBZ0,U,2),2)_$J("",30),1,30)_"  Dt Generated: "_$S($P(IBZ0,U,12):$$FMTE^XLFDT($P(IBZ0,U,12),2),1:"")
"RTN","IBCECSA2",34,0)
 D SET(X,IBCNT),SET("",IBCNT)
"RTN","IBCECSA2",35,0)
 S (IBFST,X)=0 F  S X=$O(^IBM(361,IBZ,1,X)) Q:'X  D
"RTN","IBCECSA2",36,0)
 . S Y=$$SETSTR^VALM1($S('IBFST:"Message Text: ",1:"")_$G(^IBM(361,IBZ,1,X,0)),"",2,$S('IBFST:185,1:200))
"RTN","IBCECSA2",37,0)
 . D SET(Y,IBCNT)
"RTN","IBCECSA2",38,0)
 . S IBFST=1
"RTN","IBCECSA2",39,0)
 D SET("",IBCNT)
"RTN","IBCECSA2",40,0)
 S ZZ="" F  S ZZ=$O(^IBM(361,IBZ,2,"B",ZZ),-1) Q:ZZ=""  S Z=0 F  S Z=$O(^IBM(361,IBZ,2,"B",ZZ,Z)) Q:'Z  S I=$G(^IBM(361,IBZ,2,Z,0)) D
"RTN","IBCECSA2",41,0)
 . S Y=$$SETSTR^VALM1("Review Date: "_$$EXTERNAL^DILFD(361.02,.01,,ZZ),"",2,40)
"RTN","IBCECSA2",42,0)
 . D SET(Y,IBCNT)
"RTN","IBCECSA2",43,0)
 . I $P($G(^VA(200,+$P(I,U,2),0)),U)'="" S Y=$$SETSTR^VALM1("Reviewed By: "_$P($G(^VA(200,+$P(I,U,2),0)),U),"",2,50) D SET(Y,IBCNT)
"RTN","IBCECSA2",44,0)
 . S (IBFST,X)=0 F  S X=$O(^IBM(361,IBZ,2,Z,1,X)) Q:'X  D
"RTN","IBCECSA2",45,0)
 .. S Y=$$SETSTR^VALM1($S('IBFST:"Comments: ",1:"")_$G(^IBM(361,IBZ,2,Z,1,X,0)),"",2,$S('IBFST:190,1:200))
"RTN","IBCECSA2",46,0)
 .. D SET(Y,IBCNT)
"RTN","IBCECSA2",47,0)
 .. S IBFST=1
"RTN","IBCECSA2",48,0)
 . D SET("",IBCNT)
"RTN","IBCECSA2",49,0)
INITQ Q
"RTN","IBCECSA2",50,0)
 ;
"RTN","IBCECSA2",51,0)
HELP ; help code
"RTN","IBCECSA2",52,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBCECSA2",53,0)
 Q
"RTN","IBCECSA2",54,0)
 ;
"RTN","IBCECSA2",55,0)
EXIT ; exit code
"RTN","IBCECSA2",56,0)
 K ^TMP("IBCECSC",$J)
"RTN","IBCECSA2",57,0)
 D CLEAN^VALM10
"RTN","IBCECSA2",58,0)
 Q
"RTN","IBCECSA2",59,0)
 ;
"RTN","IBCECSA2",60,0)
SET(X,CNT) ;
"RTN","IBCECSA2",61,0)
 S VALMCNT=VALMCNT+1
"RTN","IBCECSA2",62,0)
 S ^TMP("IBCECSC",$J,VALMCNT,0)=X
"RTN","IBCECSA2",63,0)
 S ^TMP("IBCECSC",$J,"IDX",VALMCNT,CNT)=""
"RTN","IBCECSA2",64,0)
 S ^TMP("IBCECSC",$J,CNT)=VALMCNT
"RTN","IBCECSA2",65,0)
 Q
"RTN","IBCECSA2",66,0)
 ;
"RTN","IBCECSA2",67,0)
UPDTX(IBDA,IBST) ; Update transmit bill record
"RTN","IBCECSA2",68,0)
 ; IBDA = ien of entry in 364
"RTN","IBCECSA2",69,0)
 ; IBST = status to stuff
"RTN","IBCECSA2",70,0)
 N X,Y,DR,DIE,DA
"RTN","IBCECSA2",71,0)
 S DR=".03////"_IBST_";.04///NOW",DA=IBDA,DIE="^IBA(364," D:DA ^DIE
"RTN","IBCECSA2",72,0)
 Q
"RTN","IBCECSA2",73,0)
 ;
"RTN","IBCECSA2",74,0)
STATUS ; Edit rev stat
"RTN","IBCECSA2",75,0)
 ;IBA - EOB ien
"RTN","IBCECSA2",76,0)
 N DA,DIE,DR,IBOLD,DIC,DO,DD,DLAYGO,IBDA,IBFINAL,IBO,IBNEW,IBFACT
"RTN","IBCECSA2",77,0)
 D FULL^VALM1
"RTN","IBCECSA2",78,0)
 S DIE="^IBM(361,"
"RTN","IBCECSA2",79,0)
 S (IBDA,DA)=$P(IBA,U,2)
"RTN","IBCECSA2",80,0)
 G:'DA STATUSQ
"RTN","IBCECSA2",81,0)
 S IBOLD=$P($G(^IBM(361,DA,0)),U,9),IBFINAL=0,IBO=$S(IBOLD'="":"/"_IBOLD,1:"@")
"RTN","IBCECSA2",82,0)
 S DR="@1;.09;I +X<2 S IBFINAL=0,Y=""@99"";S IBFINAL=1;.1;I X="""" W !,""For a final status, this field is required"" S Y=""@98"";S Y=""@99"";@98;.09///"_IBO_";S Y=""@1"";@99"
"RTN","IBCECSA2",83,0)
 L +^IBM(361,IBDA):3 I '$T D  G STATUSQ
"RTN","IBCECSA2",84,0)
 . W !,"Sorry, another user currently editing this entry (#"_IBDA_")."
"RTN","IBCECSA2",85,0)
 D ^DIE
"RTN","IBCECSA2",86,0)
 ;
"RTN","IBCECSA2",87,0)
 I $G(IBFINAL) D  ;Final status selected - enter remarks
"RTN","IBCECSA2",88,0)
 . N Z
"RTN","IBCECSA2",89,0)
 . S Z=IBDA
"RTN","IBCECSA2",90,0)
 . N IBDA,Q,DIE,DR,DA,X,Y
"RTN","IBCECSA2",91,0)
 . S IBDA(1)=Z,IBDA=""
"RTN","IBCECSA2",92,0)
 . D ADDCOM(.IBDA,.DUZ,.IBCOM)
"RTN","IBCECSA2",93,0)
 . I $P($G(^IBM(361,IBDA(1),0)),U,10)="O",'$O(^IBM(361,IBDA(1),2,+IBDA,0)) D   ; Require remarks for 'OTHER ACTION' final status
"RTN","IBCECSA2",94,0)
 .. W !,"Since OTHER ACTION final status was selected, you must enter a",!,"   comment explaining the OTHER ACTION" D ADDCOM(.IBDA,.DUZ,.IBCOM,1)
"RTN","IBCECSA2",95,0)
 .. I IBDA D
"RTN","IBCECSA2",96,0)
 ... ; Delete entry without a comment
"RTN","IBCECSA2",97,0)
 ... D KILLREV(.IBDA)
"RTN","IBCECSA2",98,0)
 .. I '$O(^IBM(361,IBDA(1),2,+IBDA,0)) S DIE="^IBM(361,",DA=IBDA(1),DR=".20///@;.09///"_IBO D ^DIE W !,"The review status was not changed because no comment was entered",! Q
"RTN","IBCECSA2",99,0)
 S IBNEW=$P($G(^IBM(361,DA,0)),U,9)
"RTN","IBCECSA2",100,0)
 ;if time out-no change in review status
"RTN","IBCECSA2",101,0)
 S IBFACT=$P($G(^IBM(361,DA,0)),U,10)
"RTN","IBCECSA2",102,0)
 I $G(IBFINAL),IBFACT="",IBNEW>1 D  G STATUSQ
"RTN","IBCECSA2",103,0)
 . W !,"The review status was not changed because no final status was selected"
"RTN","IBCECSA2",104,0)
 . S DR=".09////"_IBOLD,DIE="^IBM(361," D ^DIE
"RTN","IBCECSA2",105,0)
 I IBNEW>1,$P(^IBM(361,DA,0),U,11) D
"RTN","IBCECSA2",106,0)
 . I "CR"'[IBFACT D
"RTN","IBCECSA2",107,0)
 .. W !,"NO FURTHER ACTION WILL BE ALLOWED REGARDING THIS ELECTRONIC MESSAGE"
"RTN","IBCECSA2",108,0)
 .. I $$PRINTUPD^IBCEU0("",$P(^IBM(361,DA,0),U,11)) D  Q
"RTN","IBCECSA2",109,0)
 ... W !," SINCE THIS CLAIM WAS PRINTED AT THE CLEARINGHOUSE"
"RTN","IBCECSA2",110,0)
 ... S IBFACT="N"
"RTN","IBCECSA2",111,0)
 .. S DIR(0)="YA",DIR("A")="IS THIS THE FINAL ELECTRONIC MESSAGE YOU EXPECT TO RECEIVE FOR THIS BILL?: ",DIR("B")="NO"
"RTN","IBCECSA2",112,0)
 .. S DIR("?",1)="If you respond YES to this prompt, the transmit status of this bill will",DIR("?",2)="  be set to CLOSED.  No further electronic processing of this bill will be"
"RTN","IBCECSA2",113,0)
 ..S DIR("?",3)="  allowed.  If you respond NO to this prompt, this electronic message will",DIR("?",4)="  be filed as reviewed, but the bill's transmit status will not be changed."
"RTN","IBCECSA2",114,0)
 .. S DIR("?",5)="  You may wish to periodically print a list of bills with a non-final",DIR("?",6)="  (closed/cancelled/etc) status to ensure the electronic processing of all"
"RTN","IBCECSA2",115,0)
 .. S DIR("?",7)="  bills has been completed.  Closing the transmit bill record here will",DIR("?")="  eliminate the bill from this list."
"RTN","IBCECSA2",116,0)
 .. W ! D ^DIR K DIR W !
"RTN","IBCECSA2",117,0)
 .. Q:Y'=1
"RTN","IBCECSA2",118,0)
 .. S DIR("A",1)="SINCE YOU HAVE INDICATED THIS BILL HAS RECEIVED ITS FINAL ELECTRONIC MESSAGE",DIR("A",2)="  AND NO FURTHER ACTION WILL BE TAKEN ON IT, THE STATUS OF THE TRANSMIT",DIR("A",3)="  RECORD FOR THIS BILL WILL BE CHANGED TO CLOSED"
"RTN","IBCECSA2",119,0)
 .. S DIR("A")="IS THIS WHAT YOU MEANT TO DO?: ",DIR("B")="YES",DIR(0)="YA" W ! D ^DIR W ! K DIR
"RTN","IBCECSA2",120,0)
 .. Q:Y'=1
"RTN","IBCECSA2",121,0)
 .. S IBFACT="N"
"RTN","IBCECSA2",122,0)
 . I "NCR"[IBFACT D UPDEDI^IBCEM(+$P(^IBM(361,DA,0),U,11),IBFACT) Q
"RTN","IBCECSA2",123,0)
 S $P(IBX,U,12)=$S(IBNEW=1:"*",1:"")
"RTN","IBCECSA2",124,0)
 I IBOLD'=IBNEW D  ;Note the change and who made it
"RTN","IBCECSA2",125,0)
 . D NOTECHG(IBDA,0),HDR,INIT
"RTN","IBCECSA2",126,0)
 L -^IBM(361,DA)
"RTN","IBCECSA2",127,0)
 S VALMBCK="R"
"RTN","IBCECSA2",128,0)
 Q
"RTN","IBCECSA2",129,0)
 ;
"RTN","IBCECSA2",130,0)
NOTECHG(IBDA,IBAUTO,IBNTEXT) ; Enter who/when review stat change was entered
"RTN","IBCECSA2",131,0)
 ; IBDA = ien of entry in file 361
"RTN","IBCECSA2",132,0)
 ; IBAUTO = flag to say auto-review was used (1=used, 0=not used)
"RTN","IBCECSA2",133,0)
 ; IBNTEXT = array containing the lines of text to store if not using the
"RTN","IBCECSA2",134,0)
 ;           default text  IBNTEXT = # of lines
"RTN","IBCECSA2",135,0)
 N IBIEN,IBTEXT,DA,X,Y,DIC,DO,DLAYGO,DD
"RTN","IBCECSA2",136,0)
 S DA(1)=IBDA,DIC="^IBM(361,"_DA(1)_",2,",DIC(0)="L",DLAYGO=361.02
"RTN","IBCECSA2",137,0)
 S X=$$NOW^XLFDT
"RTN","IBCECSA2",138,0)
 D FILE^DICN K DIC,DD,DO,DLAYGO
"RTN","IBCECSA2",139,0)
 Q:Y'>0
"RTN","IBCECSA2",140,0)
 S DA(2)=DA(1),DA(1)=+Y,IBIEN=DA(1)_","_DA(2)_","
"RTN","IBCECSA2",141,0)
 I $G(IBNTEXT) D
"RTN","IBCECSA2",142,0)
 . M IBTEXT=IBNTEXT
"RTN","IBCECSA2",143,0)
 E  D
"RTN","IBCECSA2",144,0)
 . S IBTEXT(1)="REVIEW STATUS "_$S($G(IBAUTO):"AUTOMATICALLY ",1:"")_"CHANGED TO '"_$$EXTERNAL^DILFD(361,.09,,$P(^IBM(361,DA(2),0),U,9))_"'  BY: "_$$EXTERNAL^DILFD(361.02,.02,,+$G(DUZ))
"RTN","IBCECSA2",145,0)
 D WP^DIE(361.02,IBIEN,.03,,"IBTEXT") K ^TMP("DIERR",$J)
"RTN","IBCECSA2",146,0)
 Q
"RTN","IBCECSA2",147,0)
 ;
"RTN","IBCECSA2",148,0)
STATUSQ ;
"RTN","IBCECSA2",149,0)
 D PAUSE^VALM1
"RTN","IBCECSA2",150,0)
 S VALMBCK="R"
"RTN","IBCECSA2",151,0)
 Q
"RTN","IBCECSA2",152,0)
 ;
"RTN","IBCECSA2",153,0)
COM ; Enter/Edit Review Comments
"RTN","IBCECSA2",154,0)
 ; IBA - EOB ien
"RTN","IBCECSA2",155,0)
 N DA,DIC,X,Y,DO,DD,DLAYGO,IBDA,IB0,IBNEW,IBCOM
"RTN","IBCECSA2",156,0)
 D FULL^VALM1
"RTN","IBCECSA2",157,0)
 W !
"RTN","IBCECSA2",158,0)
 S (IBDA(1),DA(1))=+$P(IBA,U,2)
"RTN","IBCECSA2",159,0)
 L +^IBM(361,IBDA(1)):3 I '$T D  G COMQ
"RTN","IBCECSA2",160,0)
 . W !,*7,"Sorry, another user currently editing this entry."
"RTN","IBCECSA2",161,0)
 . D PAUSE^VALM1
"RTN","IBCECSA2",162,0)
 ;
"RTN","IBCECSA2",163,0)
 S Z=0 F  S Z=$O(^IBM(361,IBDA(1),2,Z)) Q:'Z  I $P($G(^(Z,0)),U,2)=DUZ S IBCOM(DUZ,Z)=""
"RTN","IBCECSA2",164,0)
 S IBNEW=0
"RTN","IBCECSA2",165,0)
 I '$D(IBCOM(DUZ)) D
"RTN","IBCECSA2",166,0)
 . N DO,DD,DIC,DLAYGO,DIR,X,Y
"RTN","IBCECSA2",167,0)
 . S DIR(0)="YA",DIR("B")="YES",DIR("A",1)="There are no comments previously entered by you",DIR("A")="Do you want to add a new comment?: "
"RTN","IBCECSA2",168,0)
 . S DIR("?",1)="You are only allowed to edit your own comments."
"RTN","IBCECSA2",169,0)
 . S DIR("?")="You may enter a new comment here."
"RTN","IBCECSA2",170,0)
 . D ^DIR K DIR
"RTN","IBCECSA2",171,0)
 . W !
"RTN","IBCECSA2",172,0)
 . I Y'=1 S IBDA=-1 Q
"RTN","IBCECSA2",173,0)
 . D ADDCOM(.IBDA,.DUZ,.IBCOM)
"RTN","IBCECSA2",174,0)
 ;
"RTN","IBCECSA2",175,0)
 E  D
"RTN","IBCECSA2",176,0)
 . S DIC="^IBM(361,"_IBDA(1)_",2,",DIC("S")="I $P(^(0),U,2)=DUZ",DIC(0)="AEMQ",DIC("A")="Select REVIEW DATE to edit or press ENTER to add a new comment: " D ^DIC K DIC S IBDA=+Y
"RTN","IBCECSA2",177,0)
 . I IBDA>0 D  Q  ;User selected an existing entry
"RTN","IBCECSA2",178,0)
 .. D ADDCOM(.IBDA,.DUZ,.IBCOM,1)
"RTN","IBCECSA2",179,0)
 .. I $D(^IBM(361,IBDA(1),2,IBDA)),'$O(^IBM(361,IBDA(1),2,IBDA,1,0)) D KILLREV(.IBDA)
"RTN","IBCECSA2",180,0)
 . S DIR(0)="YAO",DIR("A")="DO YOU WANT TO ADD A NEW REVIEW COMMENT?: ",DIR("B")="NO" D ^DIR K DIR Q:Y'=1
"RTN","IBCECSA2",181,0)
 . D ADDCOM(.IBDA,.DUZ,.IBCOM)
"RTN","IBCECSA2",182,0)
 L -^IBM(361,IBDA(1))
"RTN","IBCECSA2",183,0)
 G:IBDA'>0 COMQ
"RTN","IBCECSA2",184,0)
 D PAUSE^VALM1
"RTN","IBCECSA2",185,0)
 D HDR,INIT
"RTN","IBCECSA2",186,0)
COMQ S VALMBCK="R"
"RTN","IBCECSA2",187,0)
 Q
"RTN","IBCECSA2",188,0)
 ;
"RTN","IBCECSA2",189,0)
ADDCOM(IBDA,DUZ,IBCOM,ADD) ; Add review comment to file 361
"RTN","IBCECSA2",190,0)
 ; IBDA = array containing the DA references for the file add -
"RTN","IBCECSA2",191,0)
 ;        pass by reference
"RTN","IBCECSA2",192,0)
 ; DUZ = ien of the user
"RTN","IBCECSA2",193,0)
 ; ADD = flag when set to 1 says the review date exists,
"RTN","IBCECSA2",194,0)
 ;       just allow comment entry
"RTN","IBCECSA2",195,0)
 ; Returns IBDA = the entry # of the comment
"RTN","IBCECSA2",196,0)
 ;          and IBCOM array referencing any comments added by the user
"RTN","IBCECSA2",197,0)
 ;
"RTN","IBCECSA2",198,0)
 N DA,DIC,DD,DO,DLAYGO,X,Y
"RTN","IBCECSA2",199,0)
 S DR=$S($G(DUZ):".02////"_DUZ_";",1:"")_".03"
"RTN","IBCECSA2",200,0)
 I '$G(ADD) D
"RTN","IBCECSA2",201,0)
 . K DO,DD
"RTN","IBCECSA2",202,0)
 . S DIC="^IBM(361,"_IBDA(1)_",2,",DA(1)=IBDA(1),X=$$NOW^XLFDT
"RTN","IBCECSA2",203,0)
 . W !,"New Review Date: "_$$FMTE^XLFDT(X,2)
"RTN","IBCECSA2",204,0)
 . S DIC("DR")=DR,DLAYGO=361.02
"RTN","IBCECSA2",205,0)
 . S DIC(0)="L",DIC("P")=$$GETSPEC^IBEFUNC(361,2)
"RTN","IBCECSA2",206,0)
 . D FILE^DICN K DIC,DD,DO,DLAYGO
"RTN","IBCECSA2",207,0)
 . S IBDA=+Y
"RTN","IBCECSA2",208,0)
 I IBDA>0 D
"RTN","IBCECSA2",209,0)
 . I $G(ADD) S DIE="^IBM(361,"_IBDA(1)_",2,",DA(1)=IBDA(1),DA=IBDA D ^DIE
"RTN","IBCECSA2",210,0)
 . I '$O(^IBM(361,IBDA(1),2,IBDA,0)) D KILLREV(.IBDA) Q
"RTN","IBCECSA2",211,0)
 . S IBCOM(DUZ,IBDA)=""
"RTN","IBCECSA2",212,0)
 Q
"RTN","IBCECSA2",213,0)
 ;
"RTN","IBCECSA2",214,0)
KILLREV(IBDA) ; Deletes a review date if no comments entered
"RTN","IBCECSA2",215,0)
 N DA,DIK
"RTN","IBCECSA2",216,0)
 S DA=IBDA,DA(1)=IBDA(1),DIK="^IBM(361,"_IBDA(1)_",2,"
"RTN","IBCECSA2",217,0)
 K IBCOM(DUZ,IBDA)
"RTN","IBCECSA2",218,0)
 D ^DIK
"RTN","IBCECSA2",219,0)
 Q
"RTN","IBCECSA2",220,0)
 ;
"RTN","IBCEFG1")
0^5^B23547409
"RTN","IBCEFG1",1,0)
IBCEFG1 ;ALB/TMP - OUTPUT FORMATTER DATA DEFINITION UTILITIES ;18-JAN-96
"RTN","IBCEFG1",2,0)
 ;;2.0;INTEGRATED BILLING;**52,51,137,181,197**;21-MAR-94
"RTN","IBCEFG1",3,0)
 ;
"RTN","IBCEFG1",4,0)
EDIBILL(IBXFORM,IBXDA,IBINS,IBTYP) ; Find element associated with form fld
"RTN","IBCEFG1",5,0)
 ; IBXFORM = (REQUIRED) actual form being extracted (in file 353)
"RTN","IBCEFG1",6,0)
 ; IBXDA = (REQUIRED) form definition file (364.6) entry to use to find
"RTN","IBCEFG1",7,0)
 ;         extract data element definition entry (in file 364.7)
"RTN","IBCEFG1",8,0)
 ; IBINS = (REQUIRED) insurance co. ien for the current insurance on bill
"RTN","IBCEFG1",9,0)
 ; IBTYP = (REQUIRED) bill type (I/O)
"RTN","IBCEFG1",10,0)
 ;
"RTN","IBCEFG1",11,0)
 ; Returns ien of the entry in file 364.7 if a match on override criteria
"RTN","IBCEFG1",12,0)
 ;  was found.  Returns -1 if a screen form and the criteria fails for a
"RTN","IBCEFG1",13,0)
 ;  field without an override
"RTN","IBCEFG1",14,0)
 ;
"RTN","IBCEFG1",15,0)
 N IBX,IBPARFM,IBSCREEN,IBNMATCH,EDIQ
"RTN","IBCEFG1",16,0)
 I $G(IBXDA)=""!($G(IBXFORM)="") G EDIQ
"RTN","IBCEFG1",17,0)
 S EDIQ=0
"RTN","IBCEFG1",18,0)
 S IBPARFM=$P($G(^IBE(353,IBXFORM,2)),U,5) S:'IBPARFM IBPARFM=IBXFORM
"RTN","IBCEFG1",19,0)
 S IBSCREEN=($P($G(^IBE(353,+IBXFORM,2)),U,2)="S")
"RTN","IBCEFG1",20,0)
 S IB1=(IBPARFM=IBXFORM) ; Not a local field that is not a parent
"RTN","IBCEFG1",21,0)
 ;
"RTN","IBCEFG1",22,0)
 I $G(IBINS)'="",$G(IBTYP)'="" D:$O(^IBA(364.7,"AINTYP",IBXDA,""))'=""  G:EDIQ EDIQ
"RTN","IBCEFG1",23,0)
 . I '$D(^IBA(364.7,"AINTYP",IBXDA,IBINS,IBTYP)) S IBNMATCH=1 Q
"RTN","IBCEFG1",24,0)
 . S IBX=+$O(^IBA(364.7,"AINTYP",IBXDA,IBINS,IBTYP,"")),EDIQ=1 S:IBX IBNMATCH=0 ;by ins co and type of bill
"RTN","IBCEFG1",25,0)
 ;
"RTN","IBCEFG1",26,0)
 I $G(IBINS)'="" D:$O(^IBA(364.7,"AINS",IBXDA,""))'=""  G:EDIQ EDIQ
"RTN","IBCEFG1",27,0)
 . I '$D(^IBA(364.7,"AINS",IBXDA,IBINS)) S IBNMATCH=1 Q
"RTN","IBCEFG1",28,0)
 . S IBX=+$O(^IBA(364.7,"AINS",IBXDA,IBINS,"")),EDIQ=1 S:IBX IBNMATCH=0 ;ins co only
"RTN","IBCEFG1",29,0)
 ;
"RTN","IBCEFG1",30,0)
 I $G(IBTYP)'="" D:$O(^IBA(364.7,"ATYPE",IBXDA,""))'=""  G:EDIQ EDIQ
"RTN","IBCEFG1",31,0)
 . I '$D(^IBA(364.7,"ATYPE",IBXDA,IBTYP)) S IBNMATCH=1 Q
"RTN","IBCEFG1",32,0)
 . S IBX=+$O(^IBA(364.7,"ATYPE",IBXDA,IBTYP,"")),EDIQ=1 S:IBX IBNMATCH=0 ;type of bill only
"RTN","IBCEFG1",33,0)
 ;
"RTN","IBCEFG1",34,0)
 I IBXFORM,$S(IBXFORM'=IBPARFM:1,1:IBSCREEN) D  G EDIQ
"RTN","IBCEFG1",35,0)
 . S IBX=+$O(^IBA(364.7,"ALL",IBXDA,"")) ; Check for all ins co and types
"RTN","IBCEFG1",36,0)
 . I IBX,+$O(^IBA(364.7,"ALL",IBXDA,IBX)) D  ; Find override for 'ALL'
"RTN","IBCEFG1",37,0)
 .. N Z
"RTN","IBCEFG1",38,0)
 .. S Z=0 F  S Z=$O(^IBA(364.7,"ALL",IBXDA,Z)) Q:'Z  I $P($G(^IBA(364.7,Z,0)),U)'=IBXDA S IBX=Z Q
"RTN","IBCEFG1",39,0)
 . I 'IBX,+$O(^IBA(364.7,"B",IBXDA,"")) S IBX=$O(^(""))
"RTN","IBCEFG1",40,0)
 . S:IBX IBNMATCH=0
"RTN","IBCEFG1",41,0)
 ;
"RTN","IBCEFG1",42,0)
 I IBXFORM,$O(^IBA(364.6,"APAR",IBXFORM,IBXDA,"")) S IBX=+$O(^("")),IBX=+$O(^IBA(364.7,"B",IBX,0)) I IBX G EDIQ
"RTN","IBCEFG1",43,0)
 S IBX=+$O(^IBA(364.7,"B",IBXDA,""))
"RTN","IBCEFG1",44,0)
EDIQ I IBSCREEN,$G(IBNMATCH) S IBX=-1
"RTN","IBCEFG1",45,0)
 Q $G(IBX)
"RTN","IBCEFG1",46,0)
 ;
"RTN","IBCEFG1",47,0)
DT(DATE1,DATE2,FORMAT) ; Return date in DATE1 (and optionally DATE2)
"RTN","IBCEFG1",48,0)
 ;   (input in Fileman format) converted to X12 format
"RTN","IBCEFG1",49,0)
 ; FORMAT (required)
"RTN","IBCEFG1",50,0)
 ; DATE1,DATE2 in FILEMAN date format
"RTN","IBCEFG1",51,0)
 N DATE S DATE=""
"RTN","IBCEFG1",52,0)
 I $E(FORMAT)="D" D  G DTQ
"RTN","IBCEFG1",53,0)
 .S DATE=$E(DATE1,2,7) Q:$P(FORMAT,"D",2)=6  ;YYMMDD
"RTN","IBCEFG1",54,0)
 .S:DATE1 DATE=($E(DATE1)+17)_DATE ;CCYYMMDD
"RTN","IBCEFG1",55,0)
 I $E(FORMAT)="R" D
"RTN","IBCEFG1",56,0)
 .S:DATE1 DATE=$E(DATE1,2,7)_"-"_$E($S($G(DATE2):DATE2,1:DATE1),2,7) ;YYMMDD-YYMMDD
"RTN","IBCEFG1",57,0)
 .Q:FORMAT["6"
"RTN","IBCEFG1",58,0)
 .S DATE=($E(DATE1)+17)_DATE,$P(DATE,"-",2)=($E($S($G(DATE2):DATE2,1:DATE1))+17)_$P(DATE,"-",2) ;CCYYMMDD-CCYYMMDD
"RTN","IBCEFG1",59,0)
DTQ Q DATE
"RTN","IBCEFG1",60,0)
 ;
"RTN","IBCEFG1",61,0)
NAME(IBNM1,COMB) ; Parse person's nm into 4 pieces LAST^FIRST^MIDDLE^CRED
"RTN","IBCEFG1",62,0)
 ; IBNM1 = NAME in LAST,FIRST MIDDLE^vp file ien (200 or 355.93)^bill ien^prv type
"RTN","IBCEFG1",63,0)
 ;                FIRST MIDDLE LAST^vp file ien (200 or 355.93)^bill ien^prv type
"RTN","IBCEFG1",64,0)
 ; COMB = if set to 1, then combine the first and middle name
"RTN","IBCEFG1",65,0)
 ;        if set to 2, combine the last and middle names
"RTN","IBCEFG1",66,0)
 N PC,IBIEN,IBCRED,IBNM,IBNMC,IBPIEN
"RTN","IBCEFG1",67,0)
 S IBIEN=$P(IBNM1,U,2),IBNMC=$P(IBNM1,U)
"RTN","IBCEFG1",68,0)
 S IBPIEN=+$O(^DGCR(399,+$P(IBNM1,U,3),"PRV","B",+$P(IBNM1,U,4),0))
"RTN","IBCEFG1",69,0)
 S IBCRED=$$CRED^IBCEU(IBIEN,+$P(IBNM1,U,3),IBPIEN) ;Degree
"RTN","IBCEFG1",70,0)
 I IBNMC="DEPT VETERANS AFFAIRS" S IBNMC="VETERANS AFFAIRS,DEPT"
"RTN","IBCEFG1",71,0)
 I IBNMC["," D  G NAMEQ
"RTN","IBCEFG1",72,0)
 . D NAMECOMP^XLFNAME(.IBNMC)
"RTN","IBCEFG1",73,0)
 . S IBNM=$G(IBNMC("FAMILY"))_U_$G(IBNMC("GIVEN"))_U_$G(IBNMC("MIDDLE"))_U_IBCRED
"RTN","IBCEFG1",74,0)
 D STDNAME^XLFNAME(.IBNMC,"C")
"RTN","IBCEFG1",75,0)
 S IBNM=$G(IBNMC("FAMILY"))_U_$G(IBNMC("GIVEN"))_U_$G(IBNMC("MIDDLE"))_U_IBCRED
"RTN","IBCEFG1",76,0)
 I $G(COMB)=1,$G(IBNMC("MIDDLE"))'="" S IBNM=$P(IBNM,U)_U_$P(IBNM,U,2)_" "_$P(IBNM,U,3)_U_IBCRED
"RTN","IBCEFG1",77,0)
 I $G(COMB)=2,$G(IBNMC("MIDDLE"))'="" S IBNM=$P(IBNM,U)_" "_$P(IBNM,U,3)_U_$P(IBNM,U,2)_U_IBCRED
"RTN","IBCEFG1",78,0)
 ;
"RTN","IBCEFG1",79,0)
NAMEQ Q IBNM
"RTN","IBCEFG1",80,0)
 ;
"RTN","IBCEFG1",81,0)
DOLLAR(AMT) ; Format amount in AMT so it is numeric including cents, without
"RTN","IBCEFG1",82,0)
 ; the decimal.
"RTN","IBCEFG1",83,0)
 N DOLR,CENT
"RTN","IBCEFG1",84,0)
 I AMT'="" S DOLR=$P(AMT,"."),CENT=$E($P(AMT,".",2)_"00",1,2),AMT=DOLR_CENT
"RTN","IBCEFG1",85,0)
 Q AMT
"RTN","IBCEFG1",86,0)
 ;
"RTN","IBCEFG1",87,0)
STATE(CODE) ;Return state code from state pointer
"RTN","IBCEFG1",88,0)
 Q $P($G(^DIC(5,+CODE,0)),U,2)
"RTN","IBCEFG1",89,0)
 ;
"RTN","IBCEFG1",90,0)
SEX(CODE) ;Return the X12 code for sex
"RTN","IBCEFG1",91,0)
 ; CODE = DHCP code for sex
"RTN","IBCEFG1",92,0)
 Q $S(CODE="":"U","MF"[$E(CODE):$E(CODE),1:"U")
"RTN","IBCEFG1",93,0)
 ;
"RTN","IBCEFG1",94,0)
RELATION(CODE) ;Return the X12 code for relationship
"RTN","IBCEFG1",95,0)
 ; CODE = DHCP code for relationship
"RTN","IBCEFG1",96,0)
 N X12
"RTN","IBCEFG1",97,0)
 S X12=""
"RTN","IBCEFG1",98,0)
 S:CODE'="" X12=$P($S(CODE="01":"18^SELF",CODE="02":"01^SPOUSE",CODE="03":"19^NATURAL CHILD",CODE="08":"20^EMPLOYEE",CODE="09":"21^UNKNOWN",CODE="18":"33^PARENT",CODE="11":"39^ORGAN DONOR",CODE="15":"41^INJURED PLAINTIFF",1:""),U)
"RTN","IBCEFG1",99,0)
 Q X12
"RTN","IBCEFG1",100,0)
 ;
"RTN","IBCEFG1",101,0)
EMPLST(CODE) ;Return the X12 code for employment status
"RTN","IBCEFG1",102,0)
 ; CODE = DHCP code for employment status
"RTN","IBCEFG1",103,0)
 N X12
"RTN","IBCEFG1",104,0)
 S X12=""
"RTN","IBCEFG1",105,0)
 S:CODE'="" X12=$P($P("1;FT^2;PT^3;NE^4;SE^5;RT^6;AU^9;UK",CODE_";",2),U)
"RTN","IBCEFG1",106,0)
 S:X12="" X12="UK"
"RTN","IBCEFG1",107,0)
 Q X12
"RTN","IBCEFG1",108,0)
 ;
"RTN","IBCEFG1",109,0)
MARITAL(CODE) ;Return the X12 code for marital status
"RTN","IBCEFG1",110,0)
 ; CODE = ien of code for marital status
"RTN","IBCEFG1",111,0)
 N X12
"RTN","IBCEFG1",112,0)
 S X12=$P($G(^DIC(11,+CODE,0)),U,3)
"RTN","IBCEFG1",113,0)
 I X12'="" S X12=$P($P("D;D^M;M^N;I^S;X^W;W^U;K",X12_";",2),U)
"RTN","IBCEFG1",114,0)
 Q X12
"RTN","IBCEFG1",115,0)
 ;
"RTN","IBCEFG1",116,0)
TOS(CODE) ;Return the X12 code for type of service
"RTN","IBCEFG1",117,0)
 ; CODE = DHCP code for type of service
"RTN","IBCEFG1",118,0)
 N X12
"RTN","IBCEFG1",119,0)
 S X12=$S(CODE>0&(CODE<10):CODE,1:$P($P("0;10^A;11^B;13^H;45^L;18^M;15^N;63^V;19^Y;20^Z;21^43;96^53;96",CODE_";",2),U)) S:X12="" X12=CODE
"RTN","IBCEFG1",120,0)
 Q X12
"RTN","IBCEFG1",121,0)
 ;
"RTN","IBCEFG1",122,0)
FIXLEN(DATA,LEN) ; Create a fixed length field from data DATA length LEN
"RTN","IBCEFG1",123,0)
 Q $E(DATA_$J("",LEN),1,LEN)
"RTN","IBCEFG1",124,0)
 ;
"RTN","IBCEFG1",125,0)
RCDT(IBXSAVE,IBXDATA,IBDT) ; Format date for multiple revenue code transmission)
"RTN","IBCEFG1",126,0)
 ;IBXSAVE = array containing the extracted service line data for the UB92 format bill
"RTN","IBCEFG1",127,0)
 ;IBXDATA = array returned with service line dates formatted in YYYYMMDD format
"RTN","IBCEFG1",128,0)
 ;IBDT = the default date for the revenue codes on the bill
"RTN","IBCEFG1",129,0)
 N Q,W
"RTN","IBCEFG1",130,0)
 S Q=0 F  S Q=$O(IBXSAVE("INPT",Q)) Q:'Q  S W=$$DT($P(IBXSAVE("INPT",1),U,10),,"D8"),IBXDATA(Q)=$S(W:W,1:IBDT)
"RTN","IBCEFG1",131,0)
 Q
"RTN","IBCEST")
0^7^B45445309
"RTN","IBCEST",1,0)
IBCEST ;ALB/TMP - 837 EDI STATUS MESSAGE PROCESSING ;17-APR-96
"RTN","IBCEST",2,0)
 ;;2.0;INTEGRATED BILLING;**137,189,197**;21-MAR-94
"RTN","IBCEST",3,0)
 Q
"RTN","IBCEST",4,0)
 ;
"RTN","IBCEST",5,0)
UPD361(IBTDA) ; Update IB BILL STATUS MESSAGES file
"RTN","IBCEST",6,0)
 ; IBTDA = ien of return message in file 364.2
"RTN","IBCEST",7,0)
 ;
"RTN","IBCEST",8,0)
 N IB,IB0,IBSEQ,IB00,IBBILL,IBBTCH,IBMNUM
"RTN","IBCEST",9,0)
 ;
"RTN","IBCEST",10,0)
 I '$$LOCK^IBCEM(IBTDA) G UPDQ ;Lock message in file 364.2
"RTN","IBCEST",11,0)
 ;
"RTN","IBCEST",12,0)
 S IB0=$G(^IBA(364.2,IBTDA,0))
"RTN","IBCEST",13,0)
 S IBMNUM=$P(IB0,U) ; Message number
"RTN","IBCEST",14,0)
 S IB00=$G(^IBA(364,+$P(IB0,U,5),0)) ; Transmit bill entry
"RTN","IBCEST",15,0)
 S IBBILL=+IB00 ; Actual bill ien in file 399
"RTN","IBCEST",16,0)
 S IBBTCH=$P(IB0,U,4) ; Batch #
"RTN","IBCEST",17,0)
 ;
"RTN","IBCEST",18,0)
 I $S(IBMNUM="":1,1:'IBBILL&(IBBTCH="")) D DELMSG^IBCESRV2(IBTDA) G UPDQ
"RTN","IBCEST",19,0)
 ;
"RTN","IBCEST",20,0)
 ; Individual bill
"RTN","IBCEST",21,0)
 I IBBILL D  G UPDQ
"RTN","IBCEST",22,0)
 . N IBA1,IBMSG0,IBPID
"RTN","IBCEST",23,0)
 . S IBPID="",IBA1=0
"RTN","IBCEST",24,0)
 . F  S IBA1=$O(^IBA(364.2,IBTDA,2,IBA1)) Q:'IBA1  S IBMSG0=$P($G(^(IBA1,0)),"##RAW DATA: ",2) I +IBMSG0=277,$P(IBMSG0,U,5)="N" S IBPID=$P(IBMSG0,U,11) Q
"RTN","IBCEST",25,0)
 . S IBSEQ=$P(IB00,U,8) S:IBSEQ="" IBSEQ="P"
"RTN","IBCEST",26,0)
 . D STORE(IB0,IBBTCH,IBMNUM,IBTDA,IBBILL,IBSEQ,IBPID,1)
"RTN","IBCEST",27,0)
 ;
"RTN","IBCEST",28,0)
 ; Batch - update each bill separately
"RTN","IBCEST",29,0)
 S IBBILL=""
"RTN","IBCEST",30,0)
 F  S IBBILL=$O(^IBA(364,"ABABI",+IBBTCH,IBBILL)) Q:'IBBILL  D
"RTN","IBCEST",31,0)
 . Q:$D(^TMP("IBCONF",$J,IBBILL))  ;Bill was rejected
"RTN","IBCEST",32,0)
 . S IB=$O(^IBA(364,"ABABI",+IBBTCH,IBBILL,0)) Q:'IB
"RTN","IBCEST",33,0)
 . S IBSEQ=$P($G(^IBA(364,IB,0)),U,8) S:IBSEQ="" IBSEQ="P"
"RTN","IBCEST",34,0)
 . D STORE(IB0,IBBTCH,IBMNUM,IBTDA,IBBILL,IBSEQ,"",0)
"RTN","IBCEST",35,0)
 ;
"RTN","IBCEST",36,0)
 Q
"RTN","IBCEST",37,0)
 ;
"RTN","IBCEST",38,0)
STORE(IB0,IBBTCH,IBMNUM,IBTDA,IBBILL,IBSEQ,IBPID,IB1) ;
"RTN","IBCEST",39,0)
 ;
"RTN","IBCEST",40,0)
 ; IB0 = 0-node of message in file 364.2
"RTN","IBCEST",41,0)
 ; IBBTCH = ien of batch in file 364.1
"RTN","IBCEST",42,0)
 ; IBMNUM = actual message number
"RTN","IBCEST",43,0)
 ; IBTDA = ien of message in file 364.2
"RTN","IBCEST",44,0)
 ; IBBILL = ien of bill in 399
"RTN","IBCEST",45,0)
 ; IBSEQ = P/S/T/ for COB sequence related to message
"RTN","IBCEST",46,0)
 ; IBPID = the payer id returned from clearinghouse for the claim
"RTN","IBCEST",47,0)
 ; IB1 = flag that says if the message was for a single bill or a batch.
"RTN","IBCEST",48,0)
 ;       Batch statuses have an additional standard text entry.
"RTN","IBCEST",49,0)
 ;       1 = single bill 0 = batch
"RTN","IBCEST",50,0)
 ; 
"RTN","IBCEST",51,0)
 N DA,DIK,DIE,DIC,X,Y,DR,DO,DD,DLAYGO,Z,Z0,Z1,IBE,IBT,IBDUP,IBFLDS,IBY,IBAUTO
"RTN","IBCEST",52,0)
 ;
"RTN","IBCEST",53,0)
 S X=IBBILL,IBDUP=0
"RTN","IBCEST",54,0)
 ;
"RTN","IBCEST",55,0)
 I $D(^IBM(361,"AC",IBMNUM\1)) D  ; Message already there for bill
"RTN","IBCEST",56,0)
 . S Z=0 F  S Z=$O(^IBM(361,"AC",IBMNUM\1,Z)) Q:'Z  I +$G(^IBM(361,Z,0))=IBBILL S IBDUP=Z Q
"RTN","IBCEST",57,0)
 ;
"RTN","IBCEST",58,0)
 S IBFLDS=".02////"_$P(IB0,U,3)
"RTN","IBCEST",59,0)
 S IBFLDS=IBFLDS_";.03////"_$S($E(IBPID,2,5)="PRNT":"I",$$EXTERNAL^DILFD(364.2,.02,"U",$P(IB0,U,2))["REJ":"R",1:"I")_";.05////"_IBBTCH_";.06////"_IBMNUM_";.04////"_+$P(IB0,U,8)_";.07////"_IBSEQ_$S($P(IB0,U,5):";.11////"_$P(IB0,U,5),1:"")
"RTN","IBCEST",60,0)
 S IBFLDS=IBFLDS_";.12////"_$P(IB0,U,10)_";.09////0"
"RTN","IBCEST",61,0)
 I IBPID'="" D
"RTN","IBCEST",62,0)
 . S IBPID("TYPE")=$S($$FT^IBCEF(IBBILL)=2:"P",1:"I")
"RTN","IBCEST",63,0)
 . D UPDINS(.IBPID,$$POLICY^IBCEF(IBBILL,1,$TR(IBSEQ,"PST","123")),IBBILL)
"RTN","IBCEST",64,0)
 ;
"RTN","IBCEST",65,0)
 I IBDUP D  I $D(Y) G UPDQ
"RTN","IBCEST",66,0)
 . ; Stuff fields into existing entry
"RTN","IBCEST",67,0)
 . ; (may be needed for reprocessing of aborted updates)
"RTN","IBCEST",68,0)
 . S DIE="^IBM(361,",DA=IBDUP,DR=IBFLDS_";1///@"
"RTN","IBCEST",69,0)
 . D ^DIE
"RTN","IBCEST",70,0)
 . I $D(Y) S IBY=-1 Q  ;Update not successful
"RTN","IBCEST",71,0)
 . S IBY=IBDUP
"RTN","IBCEST",72,0)
 ;
"RTN","IBCEST",73,0)
 K IBT
"RTN","IBCEST",74,0)
 I 'IBDUP D  ; Create new entry and stuff fields
"RTN","IBCEST",75,0)
 . S DIC(0)="L",DIC="^IBM(361,",DLAYGO=361
"RTN","IBCEST",76,0)
 . S DIC("DR")=IBFLDS
"RTN","IBCEST",77,0)
 . D FILE^DICN
"RTN","IBCEST",78,0)
 . K DO,DD,DLAYGO,DIC
"RTN","IBCEST",79,0)
 . S IBY=+Y
"RTN","IBCEST",80,0)
 . Q:IBY'>0
"RTN","IBCEST",81,0)
 . F Z=1:1:10 L +^IBM(361,"AD",IBBILL):10 Q:$T
"RTN","IBCEST",82,0)
 . I '$T S DA=IBY,DIK="^IBM(361," D ^DIK S IBY=-1 Q
"RTN","IBCEST",83,0)
 . S Z=0
"RTN","IBCEST",84,0)
 . F  S Z=$O(^IBM(361,"AD",IBBILL,+$P(IB0,U,10),Z)) Q:'Z  I Z'=IBY D  Q:IBY'>0
"RTN","IBCEST",85,0)
 .. ; Check for same exact message
"RTN","IBCEST",86,0)
 .. S IB0=$G(^IBM(361,Z,0)),IB00=$G(^IBM(361,IBY,0))
"RTN","IBCEST",87,0)
 .. S $P(IB0,U,6)="",$P(IB00,U,6)=""
"RTN","IBCEST",88,0)
 .. I $P(IB0,U,3,8)=$P(IB00,U,3,8) D
"RTN","IBCEST",89,0)
 ... N IBSAME
"RTN","IBCEST",90,0)
 ... D BLDMSG(IB1,IBTDA,.IBT)
"RTN","IBCEST",91,0)
 ... S IBSAME=1,(Z1,Z0)=0 F  S Z0=$O(^IBM(361,Z,1,Z0)) S:'Z0&($O(IBT(Z1))) IBSAME=0 Q:'Z0  S Z1=Z0 I $G(IBT(Z0))'=$G(^IBM(361,Z,1,Z0,0)) S IBSAME=0 Q
"RTN","IBCEST",92,0)
 ... I IBSAME S DIK="^IBM(361,",DA=IBY,IBY=-1 D ^DIK D DELMSG^IBCESRV2(IBTDA)
"RTN","IBCEST",93,0)
 ;
"RTN","IBCEST",94,0)
 I IBY>0 D  ;Move text over
"RTN","IBCEST",95,0)
 . K IBE("DIERR")
"RTN","IBCEST",96,0)
 . ;
"RTN","IBCEST",97,0)
 . I '$D(IBT) D
"RTN","IBCEST",98,0)
 .. D BLDMSG(IB1,IBTDA,.IBT,.IBAUTO)
"RTN","IBCEST",99,0)
 .. ; if info msg, ck for no review needed based on first line of text
"RTN","IBCEST",100,0)
 .. I $G(IBAUTO),$P($G(^IBM(361,+IBY,0)),U,3)="I" D
"RTN","IBCEST",101,0)
 ... S DIE="^IBM(361,",DR=".09////2;.14////1",DA=+IBY D ^DIE
"RTN","IBCEST",102,0)
 ... I IB1,$P($G(^IBM(361,+IBY,0)),U,11),$$PRINTUPD^IBCEU0($G(IBT(1)),$P($G(^IBM(361,+IBY,0)),U,11))
"RTN","IBCEST",103,0)
 . ;
"RTN","IBCEST",104,0)
 . F Z=1:1:20 D WP^DIE(361,+IBY_",",1,"AK","IBT","IBE") Q:$S('$D(IBE("DIERR")):1,+IBE("DIERR")=1:$G(IBE("DIERR",1))'=110,1:1)  K IBE("DIERR") ; On lock error (110), retry up to 20 times
"RTN","IBCEST",105,0)
 . ;
"RTN","IBCEST",106,0)
 . ; Delete message after it successfully updates the database.
"RTN","IBCEST",107,0)
 . I '$D(IBE("DIERR")) D DELMSG^IBCESRV2(IBTDA)
"RTN","IBCEST",108,0)
 ;
"RTN","IBCEST",109,0)
UPDQ L -^IBA(364.2,IBTDA,0),-^IBM(361,"AD",IBBILL)
"RTN","IBCEST",110,0)
 Q
"RTN","IBCEST",111,0)
 ;
"RTN","IBCEST",112,0)
BLDMSG(IB1,IBTDA,IBT,IBAUTO) ; Builds message text
"RTN","IBCEST",113,0)
 ; IB1 = flag for batch message
"RTN","IBCEST",114,0)
 ; IBTDA = ien of entry in file 364.2
"RTN","IBCEST",115,0)
 ; IBT = array returned with message text
"RTN","IBCEST",116,0)
 ; IBAUTO = if passed by reference, returns 1 if text indicates review
"RTN","IBCEST",117,0)
 ;          not needed
"RTN","IBCEST",118,0)
 N IBDATA,IBCK,IBZ,IBZ0,IBZ1,Z
"RTN","IBCEST",119,0)
 S (IBZ,IBZ0,IBDATA,IBAUTO,IBCK)=0
"RTN","IBCEST",120,0)
 I 'IB1 S IBT(1)="Status message received for batch "_$P($G(^IBA(364.1,IBBTCH,0)),U)_" dated "_$$FMTE^XLFDT($P($G(^IBA(364.2,IBTDA,0)),U,10),2),IBZ0=1
"RTN","IBCEST",121,0)
 ; Don't move the raw data over, just move the text of the message
"RTN","IBCEST",122,0)
 F  S IBZ=$O(^IBA(364.2,IBTDA,2,IBZ)) Q:'IBZ  S IBZ1=$G(^(IBZ,0)) S IBDATA=($E(IBZ1,1,2)="##") Q:IBDATA  S IBZ0=IBZ0+1,IBT(IBZ0)=IBZ1 I 'IBCK S Z=$$CKREVU^IBCEM4(IBZ1,,,.IBCK),IBAUTO=$S(IBCK:0,Z:1,1:IBAUTO)
"RTN","IBCEST",123,0)
 Q
"RTN","IBCEST",124,0)
 ;
"RTN","IBCEST",125,0)
UPDINS(IBPID,IBINS,IBIFN) ; Update the insurance id or the bill printed at
"RTN","IBCEST",126,0)
 ;    the EDI contractor's print shop and mailed to the ins co.
"RTN","IBCEST",127,0)
 ; IBPID = the id returned from the EDI contractor for the ins co
"RTN","IBCEST",128,0)
 ;      ("TYPE") = P if professional id or I if institutional id
"RTN","IBCEST",129,0)
 ; IBINS = the ien of the insurance co it was sent to (file 36)
"RTN","IBCEST",130,0)
 ; IBIFN = the ien of the claim (file 399)
"RTN","IBCEST",131,0)
 ;
"RTN","IBCEST",132,0)
 N IBID,IBIDFLD,IBPRT,IBLOOK,DA,DR,DIE,X,Y,Z
"RTN","IBCEST",133,0)
 ;
"RTN","IBCEST",134,0)
 Q:'$G(IBINS)!($G(IBPID)="")
"RTN","IBCEST",135,0)
 ;
"RTN","IBCEST",136,0)
 ; Strip spaces off the end of data
"RTN","IBCEST",137,0)
 S IBLOOK=""
"RTN","IBCEST",138,0)
 I $L(IBPID) F Z=$L(IBPID):-1:1 I $E(IBPID,Z)'=" " S IBLOOK=$E(IBPID,1,Z) Q
"RTN","IBCEST",139,0)
 ;
"RTN","IBCEST",140,0)
 S IBPRT=($E(IBLOOK,2,5)="PRNT")
"RTN","IBCEST",141,0)
 I IBPRT D  ; Set printed via EDI field on bill
"RTN","IBCEST",142,0)
 . S DA=IBIFN,DIE="^DGCR(399,",DR="26////1" D ^DIE
"RTN","IBCEST",143,0)
 ;
"RTN","IBCEST",144,0)
 S IBLOOK=$E($S('IBPRT:$P(IBLOOK,"PAYID=",2),1:""),1,5)
"RTN","IBCEST",145,0)
 Q:IBLOOK=""!($E(IBLOOK,2,5)="PRNT")
"RTN","IBCEST",146,0)
 S IBIDFLD="3.0"_$S($G(IBPID("TYPE"))="I":4,1:2)
"RTN","IBCEST",147,0)
 S IBID=$P($G(^DIC(36,+IBINS,3)),U,IBIDFLD*100#100)
"RTN","IBCEST",148,0)
 Q:IBID=IBLOOK
"RTN","IBCEST",149,0)
 I IBID="" D  G UPDINSQ ; Update insurance co electronic id # if blank
"RTN","IBCEST",150,0)
 . S DIE="^DIC(36,",DR=IBIDFLD_"////"_IBLOOK,DA=IBINS D ^DIE
"RTN","IBCEST",151,0)
 I IBID'="",IBLOOK'="" D  ; Bulletin that the id on file and id returned
"RTN","IBCEST",152,0)
 . ; are different
"RTN","IBCEST",153,0)
 . N XMTO,XMDUZ,XMBODY,IBXM,XMSUBJ,XMZ
"RTN","IBCEST",154,0)
 . S XMTO("I:G.IB EDI")=""
"RTN","IBCEST",155,0)
 . S XMDUZ="",XMBODY="IBXM",XMSUBJ="PAYER ID RETURNED IS DIFFERENT THAN PAYER ID ON FILE"
"RTN","IBCEST",156,0)
 . S IBXM(1)="BILL #     : "_$P($G(^DGCR(399,IBIFN,0)),U)
"RTN","IBCEST",157,0)
 . S IBXM(2)="PAYER      : "_$P($G(^DIC(36,+IBINS,0)),U)
"RTN","IBCEST",158,0)
 . S IBXM(3)="BILL TYPE  : "_$S($G(IBPID("TYPE"))="I":"INSTITUT",1:"PROFESS")_"IONAL"
"RTN","IBCEST",159,0)
 . S IBXM(4)="ID ON FILE : "_IBID
"RTN","IBCEST",160,0)
 . S IBXM(5)="ID RETURNED: "_IBLOOK
"RTN","IBCEST",161,0)
 . S IBXM(6)=" ",IBXM(7)="   Please determine which id number is correct and correct the id in the",IBXM(8)="insurance file for this payer, if needed"
"RTN","IBCEST",162,0)
 . D SENDMSG^XMXAPI(XMDUZ,XMSUBJ,XMBODY,.XMTO,,.XMZ)
"RTN","IBCEST",163,0)
 ;
"RTN","IBCEST",164,0)
UPDINSQ Q
"RTN","IBCEST",165,0)
 ;
"RTN","IBCEU0")
0^4^B38840207
"RTN","IBCEU0",1,0)
IBCEU0 ;ALB/TMP - EDI UTILITIES ;02-OCT-96
"RTN","IBCEU0",2,0)
 ;;2.0;INTEGRATED BILLING;**137,197**;21-MAR-94
"RTN","IBCEU0",3,0)
 ;
"RTN","IBCEU0",4,0)
NOTECHG(IBDA,IBNTEXT) ; Enter who/when review stat change was entered
"RTN","IBCEU0",5,0)
 ; IBDA = ien of entry in file 361.1
"RTN","IBCEU0",6,0)
 ; IBNTEXT = array containing the lines of text to store if not using the
"RTN","IBCEU0",7,0)
 ;           default text  IBNTEXT = # of lines  IBNTEXT(#)=line text
"RTN","IBCEU0",8,0)
 N IBIEN,IBTEXT,DA,X,Y,DIC,DO,DLAYGO,DD
"RTN","IBCEU0",9,0)
 S DA(1)=IBDA,DIC="^IBM(361.1,"_DA(1)_",2,",DIC(0)="L",DLAYGO=361.121
"RTN","IBCEU0",10,0)
 S X=$$NOW^XLFDT
"RTN","IBCEU0",11,0)
 D FILE^DICN K DIC,DD,DO,DLAYGO
"RTN","IBCEU0",12,0)
 Q:Y'>0
"RTN","IBCEU0",13,0)
 S DA(2)=DA(1),DA(1)=+Y,IBIEN=DA(1)_","_DA(2)_","
"RTN","IBCEU0",14,0)
 I $G(IBNTEXT) D
"RTN","IBCEU0",15,0)
 . M IBTEXT=IBNTEXT
"RTN","IBCEU0",16,0)
 E  D
"RTN","IBCEU0",17,0)
 . S IBTEXT(1)="REVIEW STATUS CHANGED TO '"_$$EXTERNAL^DILFD(361.1,.2,,$P(^IBM(361.1,DA(2),0),U,20))_"'  BY: "_$$EXTERNAL^DILFD(361.121,.02,,+$G(DUZ))
"RTN","IBCEU0",18,0)
 D WP^DIE(361.121,IBIEN,.03,,"IBTEXT") K ^TMP("DIERR",$J)
"RTN","IBCEU0",19,0)
 Q
"RTN","IBCEU0",20,0)
 ;
"RTN","IBCEU0",21,0)
LOCK(IBFILE,IBREC) ; Lock record # IBREC in file #IBFILE (361 or 361.1)
"RTN","IBCEU0",22,0)
 N OK,Z
"RTN","IBCEU0",23,0)
 S OK=0
"RTN","IBCEU0",24,0)
 F Z=1:1:3 L +^IBM(IBFILE,IBREC):5 I $T S OK=1 Q
"RTN","IBCEU0",25,0)
 I 'OK D
"RTN","IBCEU0",26,0)
 . W !,"Another user has locked this record - try again later"
"RTN","IBCEU0",27,0)
 . D PAUSE^VALM1
"RTN","IBCEU0",28,0)
 Q OK
"RTN","IBCEU0",29,0)
 ;
"RTN","IBCEU0",30,0)
UNLOCK(IBFILE,IBREC) ; Unlock record # IBREC in file #IBFILE
"RTN","IBCEU0",31,0)
 I $G(IBREC) L -^IBM(IBFILE,IBREC)
"RTN","IBCEU0",32,0)
 Q
"RTN","IBCEU0",33,0)
 ;
"RTN","IBCEU0",34,0)
MSTAT ; Enter reviewed by selected range
"RTN","IBCEU0",35,0)
 N IBDAX,IBA,IBCLOSE,IBLOOK,IBOK,IBSTOP,IBREBLD,IBCLOK,DA,DIR,X,Y,DIE,DR
"RTN","IBCEU0",36,0)
 D FULL^VALM1
"RTN","IBCEU0",37,0)
 D SEL^IBCECSA4(.IBDAX)
"RTN","IBCEU0",38,0)
 S IBREBLD=0
"RTN","IBCEU0",39,0)
 I $O(IBDAX(""))="" G MSTATQ
"RTN","IBCEU0",40,0)
 S DIR("?,1")="ONLY SELECT TO CLOSE THE TRANSMIT RECORDS IF YOU KNOW THESE ARE THE FINAL",DIR("?",2)="  ELECTRONIC MESSAGES YOU WILL RECEIVE FOR ALL THE BILLS REFERENCED BY",DIR("?")="  THESE MESSAGES"
"RTN","IBCEU0",41,0)
 S DIR(0)="YA",DIR("A",1)="DO YOU WANT TO AUTOMATICALLY CLOSE THE TRANSMIT RECORDS FOR ANY MESSAGES",DIR("A")=" THAT AREN'T REJECTS?: ",DIR("B")="NO" W ! D ^DIR K DIR W !
"RTN","IBCEU0",42,0)
 G:$D(DIRUT) MSTATQ
"RTN","IBCEU0",43,0)
 S IBCLOSE=(Y=1)
"RTN","IBCEU0",44,0)
 S DIR(0)="YA",DIR("A")="DO YOU WANT TO SEE EACH MESSAGE BEFORE MARKING IT REVIEWED?: ",DIR("B")="NO"
"RTN","IBCEU0",45,0)
 S DIR("?",1)="IF YOU OPT TO SEE EACH MESSAGE, YOU CAN CONTROL WHETHER OR NOT THE MESSAGE",DIR("?",2)="  IS MARKED AS REVIEWED"
"RTN","IBCEU0",46,0)
 I 'IBCLOSE S DIR("?")=DIR("?",2) K DIR("?",2)
"RTN","IBCEU0",47,0)
 I IBCLOSE S DIR("?",2)=DIR("?",2)_" AND, FOR NON-REJECTS, WHETHER OR NOT TO CLOSE THE",DIR("?")="  TRANSMIT RECORD FOR THE BILL"
"RTN","IBCEU0",48,0)
 W ! D ^DIR K DIR W !
"RTN","IBCEU0",49,0)
 G:$D(DIRUT) MSTATQ
"RTN","IBCEU0",50,0)
 S IBLOOK=(Y=1)
"RTN","IBCEU0",51,0)
 S IBDAX=0,IBSTOP=0
"RTN","IBCEU0",52,0)
 F  S IBDAX=+$O(IBDAX(IBDAX)) Q:'IBDAX  D  Q:IBSTOP
"RTN","IBCEU0",53,0)
 . S IBA=$G(IBDAX(IBDAX))
"RTN","IBCEU0",54,0)
 . S DIE="^IBM(361,",DA=$P(IBA,U,2),DR=""
"RTN","IBCEU0",55,0)
 . I DA D
"RTN","IBCEU0",56,0)
 .. S IBOK=1
"RTN","IBCEU0",57,0)
 .. S IBCLOK=$S(IBCLOSE:1,1:0)
"RTN","IBCEU0",58,0)
 .. I IBLOOK D  Q:'IBOK
"RTN","IBCEU0",59,0)
 ... S DIC="^IBM(361," D EN^DIQ
"RTN","IBCEU0",60,0)
 ... I '$$LOCK(361,DA) W ! S IBOK=0 Q
"RTN","IBCEU0",61,0)
 ... S DIR(0)="YA",DIR("A")="OK TO MARK REVIEWED?: ",DIR("B")="YES",DIR("?",1)="IF YOU ENTER YES, THIS MESSAGE WILL BE MARKED REVIEWED"
"RTN","IBCEU0",62,0)
 ... S DIR("?",2)="IF YOU ENTER NO, THIS MESSAGE WILL NOT BE ALTERED",DIR("?",3)="IF YOU ENTER AN ^, THIS MESSAGE WILL NOT BE ALTERED & NONE OF THE",DIR("?")="   REMAINING MESSAGES WILL BE PROCESSED" D ^DIR K DIR
"RTN","IBCEU0",63,0)
 ... I Y'>0 S IBOK=0 S:$D(DIRUT) IBSTOP=1 Q
"RTN","IBCEU0",64,0)
 ... I 'IBCLOSE D
"RTN","IBCEU0",65,0)
 .... S DIR(0)="YA",DIR("A")="OK TO CLOSE THIS BILL'S TRANSMIT RECORD?: ",DIR("B")="NO"
"RTN","IBCEU0",66,0)
 .... S DIR("?",1)="If you respond YES to this prompt, the transmit status of this bill will",DIR("?",2)="  be set to CLOSED.  No further electronic processing of this bill will be"
"RTN","IBCEU0",67,0)
 .... S DIR("?",3)="  allowed.  If you respond NO to this prompt, this electronic message will",DIR("?",4)="  be filed as reviewed, but the bill's transmit status will not be changed."
"RTN","IBCEU0",68,0)
 .... S DIR("?",5)="  You may wish to periodically print a list of bills with a non-final",DIR("?",6)="  (closed/cancelled/etc) status to ensure the electronic processing of all"
"RTN","IBCEU0",69,0)
 .... S DIR("?",7)="  bills has been completed.  Closing the transmit bill record here will",DIR("?")="  eliminate the bill from this list."
"RTN","IBCEU0",70,0)
 .... W ! D ^DIR K DIR W !
"RTN","IBCEU0",71,0)
 .... I Y'=1 S IBCLOK=0
"RTN","IBCEU0",72,0)
 .. I 'IBLOOK,$P($G(^IBM(361,DA,0)),U,3)="R" D  Q:'IBOK
"RTN","IBCEU0",73,0)
 ... S DR="1",DIC="^IBM(361," D EN^DIQ W !,"Bill Number: ",$$EXPAND^IBTRE(361,.01,+^IBM(361,DA,0))
"RTN","IBCEU0",74,0)
 ... S DIR(0)="YA",DIR("A")="THIS IS A REJECTION ... ARE YOU SURE YOU WANT TO MARK IT REVIEWED?: ",DIR("B")="NO"
"RTN","IBCEU0",75,0)
 ... S DIR("?",1)="IF YOU ENTER YES, THIS MESSAGE WILL BE MARKED REVIEWED"
"RTN","IBCEU0",76,0)
 ... S DIR("?",2)="IF YOU ENTER NO, THIS MESSAGE WILL NOT BE ALTERED",DIR("?",3)="IF YOU ENTER AN ^, THIS MESSAGE WILL NOT BE ALTERED & NONE OF THE",DIR("?")="   MESSAGES FOLLOWING THIS ONE WILL BE PROCESSED" D ^DIR K DIR
"RTN","IBCEU0",77,0)
 ... I Y'=1 S IBOK=0 S:$D(DIRUT) IBSTOP=1
"RTN","IBCEU0",78,0)
 .. S:'IBREBLD IBREBLD=1
"RTN","IBCEU0",79,0)
 .. S DR=".09////2;.1////F" D ^DIE
"RTN","IBCEU0",80,0)
 .. N IBUPD
"RTN","IBCEU0",81,0)
 .. S IBUPD=0
"RTN","IBCEU0",82,0)
 .. I $$PRINTUPD($G(^IBM(361,DA,1,1,0)),+$P(^IBM(361,DA,0),U,11)) S IBUPD=1
"RTN","IBCEU0",83,0)
 .. I $G(^IBM(361,DA,1,1,0))["CLAIM SENT TO PAYER" D UPDTX^IBCECSA2(+$P(^IBM(361,DA,0),U,11),$S(IBCLOK:"Z",1:"A2")) S IBUPD=1
"RTN","IBCEU0",84,0)
 .. I $G(^IBM(361,DA,1,1,0))["CLAIM REJECTED" D UPDTX^IBCECSA2(+$P(^IBM(361,DA,0),U,11),"E") S IBUPD=1
"RTN","IBCEU0",85,0)
 .. I IBCLOK,'IBUPD D UPDTX^IBCECSA2(+$P(^IBM(361,DA,0),U,11),"Z")
"RTN","IBCEU0",86,0)
 .. I 'IBLOOK D
"RTN","IBCEU0",87,0)
 ... W !,"Seq #: ",IBDAX,"  Bill number: ",$$EXPAND^IBTRE(361,.01,+^IBM(361,DA,0)),?45,"REVIEWED"
"RTN","IBCEU0",88,0)
 .. D NOTECHG^IBCECSA2(DA,1)
"RTN","IBCEU0",89,0)
 .. D UNLOCK(361,DA)
"RTN","IBCEU0",90,0)
 W !!,"LAST SELECTION PROCESSED",!
"RTN","IBCEU0",91,0)
 D PAUSE^VALM1
"RTN","IBCEU0",92,0)
MSTATQ S VALMBCK="R"
"RTN","IBCEU0",93,0)
 I IBREBLD D BLD^IBCECSA1
"RTN","IBCEU0",94,0)
 Q
"RTN","IBCEU0",95,0)
 ;
"RTN","IBCEU0",96,0)
PRPAY(IBIFN,IBMCR) ; Returns total amount of prior payments applied to
"RTN","IBCEU0",97,0)
 ; bill ien IBIFN
"RTN","IBCEU0",98,0)
 ; IBMCR = flag passed in as 1 if MRA total should be included
"RTN","IBCEU0",99,0)
 ;
"RTN","IBCEU0",100,0)
 N IBTOT,IBZ,IBSEQ
"RTN","IBCEU0",101,0)
 S IBSEQ=$$COBN^IBCEF(IBIFN)
"RTN","IBCEU0",102,0)
 I IBSEQ'>1 S IBTOT=0 G PRPAYQ
"RTN","IBCEU0",103,0)
 D F^IBCEF("N-PRIOR PAYMENTS","IBZ",,IBIFN)
"RTN","IBCEU0",104,0)
 S IBTOT=IBZ
"RTN","IBCEU0",105,0)
 I $G(IBMCR),$$MCRONBIL^IBEFUNC(IBIFN)=1 D  ; MCR on bill before curr ins
"RTN","IBCEU0",106,0)
 . N Z,Z0,Z2,Q
"RTN","IBCEU0",107,0)
 ;. F Z=1:1:IBSEQ-1 I $$WNRBILL^IBEFUNC(IBIFN,Z) D
"RTN","IBCEU0",108,0)
 ;.. S Q=0 F  S Q=$O(^IBM(361.1,"B",IBIFN,Q)) Q:'Q  S Z0=$G(^IBM(361.1,Q,0)),Z2=$G(^(2)) I $P(Z0,U,4)=1,$P(Z0,U,15)=Z S IBTOT=IBTOT+$P(Z2,U,4)-$P(Z2,U,3)
"RTN","IBCEU0",109,0)
PRPAYQ Q IBTOT
"RTN","IBCEU0",110,0)
 ;
"RTN","IBCEU0",111,0)
PRINTUPD(IBTEXT,IBDA) ; If the status message indicates claim was printed
"RTN","IBCEU0",112,0)
 ;    or the claim record in file 399 says it was, update the transmit
"RTN","IBCEU0",113,0)
 ;    message status to closed
"RTN","IBCEU0",114,0)
 ; IBTEXT = the first line text of the status message (optional)
"RTN","IBCEU0",115,0)
 ; IBDA = the ien of the transmission record in file 364
"RTN","IBCEU0",116,0)
 ;
"RTN","IBCEU0",117,0)
 ; FUNCTION returns 1 if message status changed
"RTN","IBCEU0",118,0)
 ;
"RTN","IBCEU0",119,0)
 N IBP,IBP1
"RTN","IBCEU0",120,0)
 S IBP=0,IBP1=$P($G(^DGCR(399,+$G(^IBA(364,+$G(IBDA),0)),"TX")),U,7)
"RTN","IBCEU0",121,0)
 I $G(IBTEXT)[" PRINT CENTER"!IBP1 D
"RTN","IBCEU0",122,0)
 . N Z
"RTN","IBCEU0",123,0)
 . S Z=$E($P($G(^IBA(364,IBDA,0)),U,3),1)
"RTN","IBCEU0",124,0)
 . I "AP"'[Z Q  ; Only change if status is pending or received/accepted
"RTN","IBCEU0",125,0)
 . D UPDTX^IBCECSA2(IBDA,"Z") S IBP=1
"RTN","IBCEU0",126,0)
 Q IBP
"RTN","IBCEU0",127,0)
 ;
"RTN","IBCEXTRP")
0^3^B20314163
"RTN","IBCEXTRP",1,0)
IBCEXTRP ;ALB/JEH - VIEW/PRINT EDI EXTRACT DATA ;06-JUN-01
"RTN","IBCEXTRP",2,0)
 ;;2.0;INTEGRATED BILLING;**137,197**;21-MAR-94
"RTN","IBCEXTRP",3,0)
 ;
"RTN","IBCEXTRP",4,0)
EN ;
"RTN","IBCEXTRP",5,0)
INIT ;
"RTN","IBCEXTRP",6,0)
 W !!,"This option will display the EDI extract data for a bill.",!
"RTN","IBCEXTRP",7,0)
 N IBREC1,IBIEN,IBINC,DIC,X,Y,DIR,IB364IEN,IBVNUM
"RTN","IBCEXTRP",8,0)
 ;
"RTN","IBCEXTRP",9,0)
 N DPTNOFZY S DPTNOFZY=1 ; Suppress PATIENT file fuzzy lookups
"RTN","IBCEXTRP",10,0)
 S DIC="^DGCR(399,",DIC(0)="AEMQ",DIC("S")="I 234[$P(^(0),U,13)" D ^DIC
"RTN","IBCEXTRP",11,0)
 I Y<1 G EXITQ
"RTN","IBCEXTRP",12,0)
 S IBIEN=+Y,IBREC1=$G(^DGCR(399,IBIEN,0))
"RTN","IBCEXTRP",13,0)
 S IB364IEN=$$LAST364^IBCEF4(IBIEN) I +$G(IB364IEN)=0 D  G EXITQ
"RTN","IBCEXTRP",14,0)
 . W !,"There is no entry in the EDI Transmit Bill file for this bill number."
"RTN","IBCEXTRP",15,0)
 S IBVNUM=$P($G(^IBA(364,IB364IEN,0)),U,2) I +$G(IBVNUM)=0 D  G EXITQ
"RTN","IBCEXTRP",16,0)
 . W !!,"There is no batch # for this bill.  It has not been transmitted."
"RTN","IBCEXTRP",17,0)
 S IBVNUM=$P($G(^IBA(364.1,IBVNUM,0)),U)
"RTN","IBCEXTRP",18,0)
 S DIR("A")="INCLUDE FIELDS WITH NO DATA?: ",DIR("B")="NO",DIR(0)="YA" D ^DIR K DIR
"RTN","IBCEXTRP",19,0)
 I $D(DTOUT)!$D(DUOUT) G EXITQ
"RTN","IBCEXTRP",20,0)
 S IBINC=+Y
"RTN","IBCEXTRP",21,0)
DEV ; - Select device
"RTN","IBCEXTRP",22,0)
 N %ZIS,ZTRTN,ZTSAVE,ZTDESC
"RTN","IBCEXTRP",23,0)
 S %ZIS="QM" D ^%ZIS G:POP EXITQ
"RTN","IBCEXTRP",24,0)
 I $D(IO("Q")) D  G EXITQ
"RTN","IBCEXTRP",25,0)
 . S ZTRTN="LIST^IBCEXTRP",ZTDESC="Transmitted Bill Extract Data"
"RTN","IBCEXTRP",26,0)
 . S ZTSAVE("IB*")=""
"RTN","IBCEXTRP",27,0)
 . D ^%ZTLOAD
"RTN","IBCEXTRP",28,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","IBCEXTRP",29,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","IBCEXTRP",30,0)
 U IO
"RTN","IBCEXTRP",31,0)
 ;
"RTN","IBCEXTRP",32,0)
LIST ; - set up array and print data
"RTN","IBCEXTRP",33,0)
 N IBPG,IBSEQ,IBPC,IBDA,IBREC,IBQUIT,IBILL,IBLINE,IBXDATA,IBERR,IBXERR,Z,Z0,Z1
"RTN","IBCEXTRP",34,0)
 D EXTRACT(IBIEN,IBVNUM,8,1)
"RTN","IBCEXTRP",35,0)
 S (IBPG,IBQUIT,IBSEQ,IBPC,IBDA,IBLINE)=0
"RTN","IBCEXTRP",36,0)
 K ^TMP($J,"IBLINES")
"RTN","IBCEXTRP",37,0)
 S IBILL=$S($$INPAT^IBCEF(IBIEN,1):"Inpt",1:"Oupt")_"/"_$S($$INSPRF^IBCEF(IBIEN)=1:"UB92",1:"HCFA")
"RTN","IBCEXTRP",38,0)
 I $D(^TMP("IBXERR",$J)) D  G EXITQ
"RTN","IBCEXTRP",39,0)
 . S IBERR=0 F  S IBERR=$O(^TMP("IBXERR",$J,IBERR)) Q:'IBERR  W !,$G(^TMP("IBXERR",$J,IBERR))
"RTN","IBCEXTRP",40,0)
 F  S IBSEQ=$O(^IBA(364.6,"ASEQ",8,IBSEQ)) Q:'IBSEQ!(IBQUIT)  F  S IBPC=$O(^IBA(364.6,"ASEQ",8,IBSEQ,1,IBPC)) Q:'IBPC!(IBQUIT)  F  S IBDA=$O(^IBA(364.6,"ASEQ",8,IBSEQ,1,IBPC,IBDA)) Q:'IBDA!(IBQUIT)  S IBREC=$G(^IBA(364.6,IBDA,0)) D  Q:IBQUIT
"RTN","IBCEXTRP",41,0)
 . N IBOK,Z,IBMULT
"RTN","IBCEXTRP",42,0)
 . I $P(IBREC,U,11)=1 Q
"RTN","IBCEXTRP",43,0)
 . I IBPC=1 S IBOK=0 D
"RTN","IBCEXTRP",44,0)
 .. S Z=1 F  S Z=$O(^TMP("IBXDATA",$J,1,IBSEQ,1,Z)) Q:'Z  I $G(^(Z))'="" S IBOK=1 Q
"RTN","IBCEXTRP",45,0)
 .. I 'IBOK S $P(^TMP("IBXDATA",$J,1,IBSEQ,1,1),U)=$P($G(^TMP("IBXDATA",$J,1,IBSEQ,1,1)),U)_"  (NO DATA - RECORD NOT SENT)"
"RTN","IBCEXTRP",46,0)
 . S IBMULT=0 F  S IBMULT=$O(^TMP("IBXDATA",$J,1,IBSEQ,IBMULT)) Q:'IBMULT   D
"RTN","IBCEXTRP",47,0)
 .. I '$G(IBINC),$P($G(^TMP("IBXDATA",$J,1,IBSEQ,IBMULT,IBPC)),U)="" Q
"RTN","IBCEXTRP",48,0)
 .. S ^TMP($J,"IBLINES",IBSEQ,IBMULT,IBPC)=$E($P(IBREC,U,10)_$J("",30),1,30)_": "_$P($G(^TMP("IBXDATA",$J,1,IBSEQ,IBMULT,IBPC)),U)
"RTN","IBCEXTRP",49,0)
 .
"RTN","IBCEXTRP",50,0)
 W:$E(IOST,1,2)["C-" @IOF ; initial form feed for screen print
"RTN","IBCEXTRP",51,0)
 S IBILL=$S($$INPAT^IBCEF(IBIEN,1):"Inpt",1:"Oupt")_"/"_$S($$INSPRF^IBCEF(IBIEN)=1:"UB92",1:"HCFA")
"RTN","IBCEXTRP",52,0)
 D HDR
"RTN","IBCEXTRP",53,0)
 S Z=0 F  S Z=$O(^TMP($J,"IBLINES",Z)) Q:'Z  S Z0=0 F  S Z0=$O(^TMP($J,"IBLINES",Z,Z0)) Q:'Z0  S Z1=0 F  S Z1=$O(^TMP($J,"IBLINES",Z,Z0,Z1)) Q:'Z1  D  G:IBQUIT Q1
"RTN","IBCEXTRP",54,0)
 . D:IBLINE>(IOSL-5) HDR Q:IBQUIT
"RTN","IBCEXTRP",55,0)
 . W !,^TMP($J,"IBLINES",Z,Z0,Z1)
"RTN","IBCEXTRP",56,0)
 . S IBLINE=IBLINE+1
"RTN","IBCEXTRP",57,0)
Q1 K ^TMP($J,"IBLINES")
"RTN","IBCEXTRP",58,0)
 Q
"RTN","IBCEXTRP",59,0)
 ;
"RTN","IBCEXTRP",60,0)
HDR ; - Report header
"RTN","IBCEXTRP",61,0)
 N DIR,Y
"RTN","IBCEXTRP",62,0)
 I IBPG D  Q:IBQUIT
"RTN","IBCEXTRP",63,0)
 . I $E(IOST,1,2)["C-" K DIR S DIR(0)="E" D ^DIR K DIR S IBQUIT=('Y) Q:IBQUIT
"RTN","IBCEXTRP",64,0)
 . W @IOF
"RTN","IBCEXTRP",65,0)
 ;
"RTN","IBCEXTRP",66,0)
 S IBPG=IBPG+1
"RTN","IBCEXTRP",67,0)
 W !!,?25,"EDI Transmitted Bill Extract Data",!,"Bill #",?11,"Type",?22,"Patient Name",?49,"SSN",?57,$$FMTE^XLFDT(DT),?71,"Page: "_IBPG
"RTN","IBCEXTRP",68,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","IBCEXTRP",69,0)
 W !,$P(IBREC1,U)_" "_"("_IBILL_")",?22,$P($G(^DPT(+$P(IBREC1,U,2),0)),U),?47,$P($G(^DPT($P(IBREC1,U,2),0)),U,9),!
"RTN","IBCEXTRP",70,0)
 S IBLINE=5
"RTN","IBCEXTRP",71,0)
 Q
"RTN","IBCEXTRP",72,0)
 ;
"RTN","IBCEXTRP",73,0)
ASK ;
"RTN","IBCEXTRP",74,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","IBCEXTRP",75,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","IBCEXTRP",76,0)
 S DIR(0)="E" D ^DIR
"RTN","IBCEXTRP",77,0)
 I ($D(DIRUT))!($D(DUOUT)) S IBQUIT=1
"RTN","IBCEXTRP",78,0)
 Q
"RTN","IBCEXTRP",79,0)
 ;
"RTN","IBCEXTRP",80,0)
EXITQ ; - clean up and exit
"RTN","IBCEXTRP",81,0)
 I $E(IOST,1,2)["C-" K DIR S DIR(0)="E" W ! D ^DIR K DIR
"RTN","IBCEXTRP",82,0)
 K ^TMP("IBXERR",$J),^TMP("IBXDATA",$J),IBXERR
"RTN","IBCEXTRP",83,0)
 D CLEAN^DILF
"RTN","IBCEXTRP",84,0)
 Q
"RTN","IBCEXTRP",85,0)
 ;
"RTN","IBCEXTRP",86,0)
EXTRACT(IBIFN,IBBATCH,IBFORM,IBLOCAL) ; Extracts transmitted form data into global
"RTN","IBCEXTRP",87,0)
 ; ^TMP("IBXDATA",$J).  Errors are in ^TMP("IBXERR",$J,err_num)=text.
"RTN","IBCEXTRP",88,0)
 ; IBBATCH = Batch # of bill (if known), otherwise, set to 1.  This
"RTN","IBCEXTRP",89,0)
 ;          variable must be > 0 to prevent a new batch from being added
"RTN","IBCEXTRP",90,0)
 ; IBFORM = the ien of the form in file 353
"RTN","IBCEXTRP",91,0)
 ; IBLOCAL = 1 if OK to use local form, 0 if not
"RTN","IBCEXTRP",92,0)
 N IBVNUM,IBL
"RTN","IBCEXTRP",93,0)
 D FORMPRE^IBCFP1
"RTN","IBCEXTRP",94,0)
 S IBVNUM=$G(IBBATCH)
"RTN","IBCEXTRP",95,0)
 S IBL=$S('$G(IBLOCAL):IBFORM,1:"") ; No local form ... set = main form
"RTN","IBCEXTRP",96,0)
 ; Get local form associated with parent, if any
"RTN","IBCEXTRP",97,0)
 I IBL="" S IBL=$S($P($G(^IBE(353,+IBFORM,2)),U,8):$P(^(2),U,8),1:IBFORM)
"RTN","IBCEXTRP",98,0)
 D SETUP^IBCE837(1)
"RTN","IBCEXTRP",99,0)
 D ROUT^IBCFP1(IBFORM,1,IBIFN,0,IBL)
"RTN","IBCEXTRP",100,0)
 Q
"RTN","IBCEXTRP",101,0)
 ;
"RTN","IBY197PO")
0^^B4101478
"RTN","IBY197PO",1,0)
IBY197PO ;ALB/JEH - IB*2*197 POST-INSTALL ;07-NOV-02
"RTN","IBY197PO",2,0)
 ;;2.0;INTEGRATED BILLING;**197**;21-MAR-94
"RTN","IBY197PO",3,0)
 ;
"RTN","IBY197PO",4,0)
POST ; Set up check point for post-init
"RTN","IBY197PO",5,0)
 N %
"RTN","IBY197PO",6,0)
 S %=$$NEWCP^XPDUTL("UP364","UP364^IBY197PO")
"RTN","IBY197PO",7,0)
 S %=$$NEWCP^XPDUTL("UP3646","UP3646^IBY197PO")
"RTN","IBY197PO",8,0)
 S %=$$NEWCP^XPDUTL("END","END^IBY197PO")
"RTN","IBY197PO",9,0)
 Q
"RTN","IBY197PO",10,0)
 ;
"RTN","IBY197PO",11,0)
UP364 ; Update transmission status in file 364
"RTN","IBY197PO",12,0)
 N IBZ,Z0
"RTN","IBY197PO",13,0)
 D BMES^XPDUTL("Updating existing TRANSMISSION STATUS (#.03) field entries in file 364 to closed for messages flagged as Auto filed - No review")
"RTN","IBY197PO",14,0)
 S IBZ=0 F  S IBZ=$O(^IBM(361,"ANR",1,IBZ)) Q:IBZ=""  S Z0=$P($G(^IBM(361,IBZ,0)),U,11) I Z0,$$PRINTUPD^IBCEU0($G(^IBM(361,IBZ,1,1,0)),+Z0)
"RTN","IBY197PO",15,0)
 D COMPLETE
"RTN","IBY197PO",16,0)
 Q
"RTN","IBY197PO",17,0)
UP3646 ; Update file 364.6
"RTN","IBY197PO",18,0)
 ; Update Local Override Allowed field to YES for IEN #184
"RTN","IBY197PO",19,0)
 ; Update Short Description field for IEN #945
"RTN","IBY197PO",20,0)
 N DA,DIE,DR,IBDESC
"RTN","IBY197PO",21,0)
 D BMES^XPDUTL("Updating the Local Override Allowed field for IEN #184 in the IB FORM SKELETON DEFINITION FILE")
"RTN","IBY197PO",22,0)
 S DA=184,DIE="^IBA(364.6,",DR=".07////1" D ^DIE
"RTN","IBY197PO",23,0)
 D COMPLETE
"RTN","IBY197PO",24,0)
 D BMES^XPDUTL("Updating Short Description field for IEN #945 in the IB FORM SKELETON DEFINITION FILE")
"RTN","IBY197PO",25,0)
 S IBDESC="REND PROV INS SPECIFIC ID"
"RTN","IBY197PO",26,0)
 S DA=945,DIE="^IBA(364.6,",DR=".1///^S X=IBDESC" D ^DIE
"RTN","IBY197PO",27,0)
 D COMPLETE
"RTN","IBY197PO",28,0)
 Q
"RTN","IBY197PO",29,0)
COMPLETE ;
"RTN","IBY197PO",30,0)
 D BMES^XPDUTL("Step Complete.")
"RTN","IBY197PO",31,0)
 Q
"RTN","IBY197PO",32,0)
 ;
"RTN","IBY197PO",33,0)
END ;
"RTN","IBY197PO",34,0)
 D BMES^XPDUTL("Post-install Complete.")
"RTN","IBY197PO",35,0)
 Q
"VER")
8.0^22.0
"^DD",350.8,350.8,0)
FIELD^^10^7
"^DD",350.8,350.8,0,"DDA")
N
"^DD",350.8,350.8,0,"DT")
2930322
"^DD",350.8,350.8,0,"ID",.03)
W "   ",$P(^(0),U,3)
"^DD",350.8,350.8,0,"IX","AC",350.8,.03)

"^DD",350.8,350.8,0,"IX","B",350.8,.01)

"^DD",350.8,350.8,0,"IX","C",350.8,.03)

"^DD",350.8,350.8,0,"NM","IB ERROR")

"^DD",350.8,350.8,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",350.8,350.8,.01,1,0)
^.1
"^DD",350.8,350.8,.01,1,1,0)
350.8^B
"^DD",350.8,350.8,.01,1,1,1)
S ^IBE(350.8,"B",$E(X,1,30),DA)=""
"^DD",350.8,350.8,.01,1,1,2)
K ^IBE(350.8,"B",$E(X,1,30),DA)
"^DD",350.8,350.8,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",350.8,350.8,.01,21,0)
^^2^2^2910305^^
"^DD",350.8,350.8,.01,21,1,0)
This is a free text name of the entry.  It should be namespaced with
"^DD",350.8,350.8,.01,21,2,0)
the namespace of the package reporting the error.
"^DD",350.8,350.8,.02,0)
ERROR MESSAGE^F^^0;2^K:$L(X)>80!($L(X)<3) X
"^DD",350.8,350.8,.02,3)
Answer must be 3-80 characters in length.
"^DD",350.8,350.8,.02,21,0)
^^3^3^2940209^^^^
"^DD",350.8,350.8,.02,21,1,0)
This is the text of the message as it will be displayed to a user or
"^DD",350.8,350.8,.02,21,2,0)
posted in a bulletin.  It should be as meaningful as possible to the
"^DD",350.8,350.8,.02,21,3,0)
person seeing the message.
"^DD",350.8,350.8,.03,0)
ERROR CODE^F^^0;3^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>9!($L(X)<1) X
"^DD",350.8,350.8,.03,1,0)
^.1
"^DD",350.8,350.8,.03,1,1,0)
350.8^AC
"^DD",350.8,350.8,.03,1,1,1)
S ^IBE(350.8,"AC",$E(X,1,30),DA)=""
"^DD",350.8,350.8,.03,1,1,2)
K ^IBE(350.8,"AC",$E(X,1,30),DA)
"^DD",350.8,350.8,.03,1,2,0)
350.8^C
"^DD",350.8,350.8,.03,1,2,1)
S ^IBE(350.8,"C",$E(X,1,30),DA)=""
"^DD",350.8,350.8,.03,1,2,2)
K ^IBE(350.8,"C",$E(X,1,30),DA)
"^DD",350.8,350.8,.03,3)
Answer must be 1-9 characters in length.
"^DD",350.8,350.8,.03,21,0)
^^9^9^2920219^^^^
"^DD",350.8,350.8,.03,21,1,0)
This is the error code that will be passed to or determined by
"^DD",350.8,350.8,.03,21,2,0)
Integrated Billing.  The format for the Error Code should be
"^DD",350.8,350.8,.03,21,3,0)
nnxxx, where nn is the reporting package namespace and xxx are numeric
"^DD",350.8,350.8,.03,21,4,0)
values.
"^DD",350.8,350.8,.03,21,5,0)
 
"^DD",350.8,350.8,.03,21,6,0)
This is the error code that will be passed as the second piece of
"^DD",350.8,350.8,.03,21,7,0)
the variable Y to IB when +Y=-1.  More than one error code can be
"^DD",350.8,350.8,.03,21,8,0)
placed in the second ^ piece of Y delimited by semi-colons.  Applications
"^DD",350.8,350.8,.03,21,9,0)
may call ^IBAERR to display the error message(s).
"^DD",350.8,350.8,.03,"DT")
2920219
"^DD",350.8,350.8,.04,0)
PACKAGE REPORTING ERROR^S^1:INTEGRATED BILLING;2:ACCOUNTS RECEIVABLE;3:PHARMACY;^0;4^Q
"^DD",350.8,350.8,.04,21,0)
^^2^2^2920415^^^
"^DD",350.8,350.8,.04,21,1,0)
This is the package that requested this entry in this file and will
"^DD",350.8,350.8,.04,21,2,0)
report it to IB as an error if the conditions are detected.
"^DD",350.8,350.8,.05,0)
ERROR ACTION^S^1:DISPLAY MESSAGE;2:SEND BULLETIN;3:EDIT FILE;^0;5^Q
"^DD",350.8,350.8,.05,21,0)
^^6^6^2910227^
"^DD",350.8,350.8,.05,21,1,0)
This is the type of action that should be taken when this error is
"^DD",350.8,350.8,.05,21,2,0)
reported to IB.  If action other than displaying a message is indicated
"^DD",350.8,350.8,.05,21,3,0)
then the MUMPS code in the ERROR ACTION field will be executed.
"^DD",350.8,350.8,.05,21,4,0)
 
"^DD",350.8,350.8,.05,21,5,0)
Currently only display actions are implemented.  Please contact the 
"^DD",350.8,350.8,.05,21,6,0)
developing ISC if other action types are desired.
"^DD",350.8,350.8,.06,0)
CORRESPONDING ALERT^P354.5'^IBE(354.5,^0;6^Q
"^DD",350.8,350.8,.06,21,0)
^^1^1^2940209^
"^DD",350.8,350.8,.06,21,1,0)
This is the type of alert that should be sent when this error occurs.
"^DD",350.8,350.8,.06,"DT")
2930322
"^DD",350.8,350.8,10,0)
EXECUTABLE LOGIC^K^^10;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",350.8,350.8,10,3)
This is Standard MUMPS code.
"^DD",350.8,350.8,10,21,0)
^^2^2^2910227^
"^DD",350.8,350.8,10,21,1,0)
This is the MUMPS code that will be executed if an error is reported
"^DD",350.8,350.8,10,21,2,0)
with an ERROR ACTION of other than to display a message.
"^DD",364.1,364.1,.04,0)
MAIL MESSAGE^NJ15,0^^0;4^K:+X'=X!(X>999999999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",364.1,364.1,.04,1,0)
^.1
"^DD",364.1,364.1,.04,1,1,0)
364.1^MSG
"^DD",364.1,364.1,.04,1,1,1)
S ^IBA(364.1,"MSG",$E(X,1,30),DA)=""
"^DD",364.1,364.1,.04,1,1,2)
K ^IBA(364.1,"MSG",$E(X,1,30),DA)
"^DD",364.1,364.1,.04,1,1,3)
DO NOT DELETE
"^DD",364.1,364.1,.04,1,1,"DT")
2960417
"^DD",364.1,364.1,.04,3)
Type a Number between 0 and 999999999999999, 0 Decimal Digits
"^DD",364.1,364.1,.04,21,0)
^.001^1^1^3020923^^^^
"^DD",364.1,364.1,.04,21,1,0)
This is the number of the mail message that was generated for this batch.
"^DD",364.1,364.1,.04,"DT")
3020923
"^DD",364.7,364.7,0)
FIELD^^3^12
"^DD",364.7,364.7,0,"DDA")
N
"^DD",364.7,364.7,0,"DT")
2960710
"^DD",364.7,364.7,0,"ID",.03)
S %I=Y,Y=$S('$D(^(0)):"",$D(^IBA(364.5,+$P(^(0),U,3),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(364.5,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",364.7,364.7,0,"IX","AINS",364.7,.01)

"^DD",364.7,364.7,0,"IX","AINS1",364.7,.05)

"^DD",364.7,364.7,0,"IX","AINTYP",364.7,.01)

"^DD",364.7,364.7,0,"IX","AINTYP1",364.7,.05)

"^DD",364.7,364.7,0,"IX","AINTYP2",364.7,.06)

"^DD",364.7,364.7,0,"IX","ATYPE",364.7,.01)

"^DD",364.7,364.7,0,"IX","ATYPE1",364.7,.06)

"^DD",364.7,364.7,0,"IX","B",364.7,.01)

"^DD",364.7,364.7,0,"IX","C",364.7,.03)

"^DD",364.7,364.7,0,"NM","IB FORM FIELD CONTENT")

"^DD",364.7,364.7,0,"VRPK")
IB
"^DD",364.7,364.7,.01,0)
FORM FIELD REFERENCE^RP364.6'^IBA(364.6,^0;1^Q
"^DD",364.7,364.7,.01,1,0)
^.1
"^DD",364.7,364.7,.01,1,1,0)
364.7^B
"^DD",364.7,364.7,.01,1,1,1)
S ^IBA(364.7,"B",$E(X,1,30),DA)=""
"^DD",364.7,364.7,.01,1,1,2)
K ^IBA(364.7,"B",$E(X,1,30),DA)
"^DD",364.7,364.7,.01,1,2,0)
364.7^ATYPE^MUMPS
"^DD",364.7,364.7,.01,1,2,1)
N Z1,Z0 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P(Z0,U,6) I Z1'="",$P($G(^IBA(364.6,+X,0)),U,3),'$P(Z0,U,5) S ^IBA(364.7,"ATYPE",$P(^IBA(364.6,+X,0),U,3),Z1,DA)=""
"^DD",364.7,364.7,.01,1,2,2)
N Z0,Z1 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P(Z0,U,6) I Z1'="",$P($G(^IBA(364.6,+X,0)),U,3) K ^IBA(364.7,"ATYPE",$P(^IBA(364.6,+X,0),U,3),Z1,DA)
"^DD",364.7,364.7,.01,1,2,3)
DO NOT DELETE
"^DD",364.7,364.7,.01,1,2,"%D",0)
^^1^1^2980104^^^^
"^DD",364.7,364.7,.01,1,2,"%D",1,0)
Xref by form and bill type
"^DD",364.7,364.7,.01,1,2,"DT")
2960117
"^DD",364.7,364.7,.01,1,3,0)
364.7^AINTYP^MUMPS
"^DD",364.7,364.7,.01,1,3,1)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P(Z0,U,5),Z2=$P(Z0,U,6) I Z1,Z2'="",$P($G(^IBA(364.6,+X,0)),U,3) S ^IBA(364.7,"AINTYP",$P(^IBA(364.6,+X,0),U,3),Z1,Z2,DA)=""
"^DD",364.7,364.7,.01,1,3,2)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P(Z0,U,5),Z2=$P(Z0,U,6) I Z1,Z2'="",$P($G(^IBA(364.6,+X,0)),U,3) K ^IBA(364.7,"AINTYP",$P(^IBA(364.6,+X,0),U,3),Z1,Z2,DA)
"^DD",364.7,364.7,.01,1,3,3)
DO NOT DELETE
"^DD",364.7,364.7,.01,1,3,"%D",0)
^^1^1^2971231^^^
"^DD",364.7,364.7,.01,1,3,"%D",1,0)
Xref by form, insurance company and bill type
"^DD",364.7,364.7,.01,1,3,"DT")
2960117
"^DD",364.7,364.7,.01,1,4,0)
364.7^AINS^MUMPS
"^DD",364.7,364.7,.01,1,4,1)
N Z0,Z1 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P(Z0,U,5) I Z1,$P($G(^IBA(364.6,+X,0)),U,3),$P(Z0,U,6)="" S ^IBA(364.7,"AINS",$P(^IBA(364.6,+X,0),U,3),Z1,DA)=""
"^DD",364.7,364.7,.01,1,4,2)
N Z0,Z1 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P(Z0,U,5) I Z1,$P($G(^IBA(364.6,+X,0)),U,3) K ^IBA(364.7,"AINS",$P(^IBA(364.6,+X,0),U,3),Z1,DA)
"^DD",364.7,364.7,.01,1,4,3)
DO NOT DELETE
"^DD",364.7,364.7,.01,1,4,"%D",0)
^^1^1^2971231^^
"^DD",364.7,364.7,.01,1,4,"%D",1,0)
Xref by form field and insurance company
"^DD",364.7,364.7,.01,1,4,"DT")
2960118
"^DD",364.7,364.7,.01,3)
Enter the billing form that this field is associated with
"^DD",364.7,364.7,.01,21,0)
^^2^2^2951207^^^^
"^DD",364.7,364.7,.01,21,1,0)
This is a pointer to the billing form field that this field is associated
"^DD",364.7,364.7,.01,21,2,0)
with.
"^DD",364.7,364.7,.01,"DT")
3000428
"^DD",364.7,364.7,.02,0)
SECURITY LEVEL^S^N:NATIONAL,NO EDIT;L:LOCAL;^0;2^Q
"^DD",364.7,364.7,.02,3)
Enter N for nationally released fields (no edit) or L for locally added fields.
"^DD",364.7,364.7,.02,21,0)
^^3^3^2951219^^^
"^DD",364.7,364.7,.02,21,1,0)
This field determines whether or not editing of the entry is allowed.  For
"^DD",364.7,364.7,.02,21,2,0)
NATIONAL (N) field, no local editing is allowed.  If LOCAL (L) field is
"^DD",364.7,364.7,.02,21,3,0)
created, editing is allowed.
"^DD",364.7,364.7,.02,"DT")
3000428
"^DD",364.7,364.7,.03,0)
DATA ELEMENT^P364.5'^IBA(364.5,^0;3^Q
"^DD",364.7,364.7,.03,1,0)
^.1
"^DD",364.7,364.7,.03,1,1,0)
364.7^C
"^DD",364.7,364.7,.03,1,1,1)
S ^IBA(364.7,"C",$E(X,1,30),DA)=""
"^DD",364.7,364.7,.03,1,1,2)
K ^IBA(364.7,"C",$E(X,1,30),DA)
"^DD",364.7,364.7,.03,1,1,3)
DO NOT DELETE
"^DD",364.7,364.7,.03,1,1,"%D",0)
^^1^1^2960702^
"^DD",364.7,364.7,.03,1,1,"%D",1,0)
Xref by DATA ELEMENT NAME
"^DD",364.7,364.7,.03,1,1,"DT")
2960702
"^DD",364.7,364.7,.03,3)
Enter the data element that will define this form field.  If used on a screen, it must be a fileman type.
"^DD",364.7,364.7,.03,21,0)
^^1^1^2960627^^^^
"^DD",364.7,364.7,.03,21,1,0)
This identifies the data element that be extracted for this entry.
"^DD",364.7,364.7,.03,23,0)
^^4^4^2960627^^^^
"^DD",364.7,364.7,.03,23,1,0)
This is the data element that will be allowed to be displayed/edited on a
"^DD",364.7,364.7,.03,23,2,0)
screen, extracted for a transmit, or printed on a printed form.  If used on
"^DD",364.7,364.7,.03,23,3,0)
a screen, the data element must be a fileman type and a local field (>10000
"^DD",364.7,364.7,.03,23,4,0)
for ifn and on a node >10000) to be editable.
"^DD",364.7,364.7,.03,"DT")
2960702
"^DD",364.7,364.7,.04,0)
SCREEN PROMPT^FX^^0;4^K:$L(X)>70!($L(X)<1) X I $D(X),$P($G(^IBE(353,+$G(^IBA(364.6,+$G(^IBA(364.7,DA,0)),0)),2)),U,2)'="S" K X
"^DD",364.7,364.7,.04,.1)
 
"^DD",364.7,364.7,.04,1,0)
^.1^^0
"^DD",364.7,364.7,.04,3)
Answer must be 1-70 characters in length.
"^DD",364.7,364.7,.04,21,0)
3^^2^2^2960321^^^^
"^DD",364.7,364.7,.04,21,1,0)
This is used only by screen-type forms to place a prompt on the screen
"^DD",364.7,364.7,.04,21,2,0)
for a particular field.
"^DD",364.7,364.7,.04,23,0)
^^3^3^2960321^^^^
"^DD",364.7,364.7,.04,23,1,0)
This is the prompt that will preceed the data element defined for this
"^DD",364.7,364.7,.04,23,2,0)
entry.  If no data element, this prompt will display.  This field is only
"^DD",364.7,364.7,.04,23,3,0)
used for screen-type forms.
"^DD",364.7,364.7,.04,"DT")
2960321
"^DD",364.7,364.7,.05,0)
INSURANCE COMPANY^P36'^DIC(36,^0;5^Q
"^DD",364.7,364.7,.05,1,0)
^.1
"^DD",364.7,364.7,.05,1,1,0)
364.7^AINS1^MUMPS
"^DD",364.7,364.7,.05,1,1,1)
N Z0,Z1 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P($G(^IBA(364.6,+Z0,0)),U,3) I Z1,$P(Z0,U,6)="" S ^IBA(364.7,"AINS",Z1,$E(X,1,30),DA)=""
"^DD",364.7,364.7,.05,1,1,2)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P($G(^IBA(364.6,+Z0,0)),U,3),Z2=$P(Z0,U,6) K ^IBA(364.7,"AINS",Z1,$E(X,1,30),DA) I Z2'="",$D(^IBA(364.7,"AINTYP",Z1,X,Z2,DA)) S ^IBA(364.7,"ATYPE",Z1,Z2,DA)=""
"^DD",364.7,364.7,.05,1,1,3)
DO NOT DELETE
"^DD",364.7,364.7,.05,1,1,"%D",0)
^^1^1^2960118^
"^DD",364.7,364.7,.05,1,1,"%D",1,0)
Xref by form field and insurance company.
"^DD",364.7,364.7,.05,1,1,"DT")
2960118
"^DD",364.7,364.7,.05,1,2,0)
364.7^AINTYP1^MUMPS
"^DD",364.7,364.7,.05,1,2,1)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=+$P($G(^IBA(364.6,+Z0,0)),U,3),Z2=$P(Z0,U,6) I Z1,Z2'="" S ^IBA(364.7,"AINTYP",Z1,$E(X,1,30),Z2,DA)="" K ^IBA(364.7,"ATYPE",Z1,Z2,DA),^IBA(364.7,"AINS",Z1,X,DA)
"^DD",364.7,364.7,.05,1,2,2)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=+$P($G(^IBA(364.6,+Z0,0)),U,3),Z2=$P(Z0,U,6) K:Z1&(Z2'="") ^IBA(364.7,"AINTYP",Z1,$E(X,1,30),Z2,DA)
"^DD",364.7,364.7,.05,1,2,3)
DO NOT DELETE
"^DD",364.7,364.7,.05,1,2,"%D",0)
^^1^1^2960117^^^^
"^DD",364.7,364.7,.05,1,2,"%D",1,0)
Xref by insurance company and bill type
"^DD",364.7,364.7,.05,1,2,"DT")
2960117
"^DD",364.7,364.7,.05,3)
Enter the name of the insurance company that this field is associated with.
"^DD",364.7,364.7,.05,21,0)
^^2^2^2951207^
"^DD",364.7,364.7,.05,21,1,0)
This is the insurance company who has a need for other than the standard
"^DD",364.7,364.7,.05,21,2,0)
data in this field.
"^DD",364.7,364.7,.05,"DT")
3000428
"^DD",364.7,364.7,.06,0)
BILL TYPE^S^I:INPATIENT;O:OUTPATIENT;^0;6^Q
"^DD",364.7,364.7,.06,1,0)
^.1
"^DD",364.7,364.7,.06,1,1,0)
364.7^ATYPE1^MUMPS
"^DD",364.7,364.7,.06,1,1,1)
N Z0,Z1 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P($G(^IBA(364.6,+Z0,0)),U,3) I Z1,'$P(Z0,U,5) S ^IBA(364.7,"ATYPE",Z1,$E(X,1,30),DA)=""
"^DD",364.7,364.7,.06,1,1,2)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P($G(^IBA(364.6,+Z0,0)),U,3),Z2=$P(Z0,U,5) I Z1 K ^IBA(364.7,"ATYPE",Z1,$E(X,1,30),DA) I Z2,$D(^IBA(364.7,"AINTYP",Z1,Z2,X,DA)) S ^IBA(364.7,"AINS",Z1,Z2,DA)=""
"^DD",364.7,364.7,.06,1,1,3)
DO NOT DELETE
"^DD",364.7,364.7,.06,1,1,"%D",0)
^^1^1^2960117^^
"^DD",364.7,364.7,.06,1,1,"%D",1,0)
Xref by form and bill type.
"^DD",364.7,364.7,.06,1,1,"DT")
2960117
"^DD",364.7,364.7,.06,1,2,0)
364.7^AINTYP2^MUMPS
"^DD",364.7,364.7,.06,1,2,1)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=+$P($G(^IBA(364.6,+Z0,0)),U,3),Z2=$P(Z0,U,5) I Z1,Z2 K:'$D(^IBA(364.7,"AINTYP",Z1,Z2,X,DA)) ^IBA(364.7,"AINS",Z1,Z2,DA) S ^IBA(364.7,"AINTYP",Z1,Z2,$E(X,1,30),DA)=""
"^DD",364.7,364.7,.06,1,2,2)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=+$P($G(^IBA(364.6,+Z0,0)),U,3),Z2=$P(Z0,U,5) K:Z1&Z2 ^IBA(364.7,"AINTYP",Z1,Z2,$E(X,1,30),DA)
"^DD",364.7,364.7,.06,1,2,3)
DO NOT DELETE
"^DD",364.7,364.7,.06,1,2,"%D",0)
^^1^1^2960117^^^^
"^DD",364.7,364.7,.06,1,2,"%D",1,0)
Xref by form, insurance company and bill type
"^DD",364.7,364.7,.06,1,2,"DT")
2960117
"^DD",364.7,364.7,.06,3)
Enter the type of the bill.
"^DD",364.7,364.7,.06,21,0)
^^1^1^2960117^^
"^DD",364.7,364.7,.06,21,1,0)
This is the type of bill that requires this field.
"^DD",364.7,364.7,.06,"DT")
3000428
"^DD",364.7,364.7,.07,0)
PAD CHARACTER^S^ZL:ZERO PAD ON LEFT;ZR:ZERO PAD ON RIGHT;SL:SPACE PAD ON LEFT;SR:SPACE PAD ON RIGHT;N:NO PAD REQUIRED;^0;7^Q
"^DD",364.7,364.7,.07,3)
Enter the code that corresponds to the format and pad character to use for the data output in this field.
"^DD",364.7,364.7,.07,21,0)
^^3^3^2960126^^
"^DD",364.7,364.7,.07,21,1,0)
If present, this defines the character to be used to pad the DATA
"^DD",364.7,364.7,.07,21,2,0)
ELEMENT to its desired length and the orientation of the padding characters
"^DD",364.7,364.7,.07,21,3,0)
to the left or right of the data.  The default is space pad to the right.
"^DD",364.7,364.7,.07,"DT")
2960126
"^DD",364.7,364.7,.08,0)
REQUIRED^S^0:NO;1:YES;^0;8^Q
"^DD",364.7,364.7,.08,3)
Enter 1 (YES) if this data element is on a local screen 9 form and the data is required for the bill to be authorized.
"^DD",364.7,364.7,.08,21,0)
^.001^4^4^3001030^^
"^DD",364.7,364.7,.08,21,1,0)
This field controls the required/not required status of a data element
"^DD",364.7,364.7,.08,21,2,0)
on a local screen 9 form.  If this field is 1 (YES), this data element
"^DD",364.7,364.7,.08,21,3,0)
is always required to have data (not null) in order for a bill to be
"^DD",364.7,364.7,.08,21,4,0)
authorized.
"^DD",364.7,364.7,.08,"DT")
2951207
"^DD",364.7,364.7,.09,0)
EDIT STATUS^S^E:EDITABLE;D:DISPLAY ONLY;^0;9^Q
"^DD",364.7,364.7,.09,3)
Enter 'E' to enable editing for this field, 'D' for a display only field.
"^DD",364.7,364.7,.09,21,0)
^^2^2^2960320^
"^DD",364.7,364.7,.09,21,1,0)
This field is used to control whether or not a data element on a screen is
"^DD",364.7,364.7,.09,21,2,0)
editable or for display-only purposes.
"^DD",364.7,364.7,.09,"DT")
2960320
"^DD",364.7,364.7,.1,0)
EDIT GROUP NUMBER^NJ2,0^^0;10^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",364.7,364.7,.1,3)
 Enter the edit group # that this field will be included in.  Valid #'s are 1-99.
"^DD",364.7,364.7,.1,21,0)
^^6^6^2960321^^
"^DD",364.7,364.7,.1,21,1,0)
This field contains the # of the edit group that the screen data element
"^DD",364.7,364.7,.1,21,2,0)
will be included with.  When this group # is selected on an edit screen,
"^DD",364.7,364.7,.1,21,3,0)
all data elements assigned to this group # on this screen will be presented
"^DD",364.7,364.7,.1,21,4,0)
for editing.  If no # is entered here, this field will not be available for
"^DD",364.7,364.7,.1,21,5,0)
editing.  This field will only apply to screen-type forms' editable data
"^DD",364.7,364.7,.1,21,6,0)
element descriptions.
"^DD",364.7,364.7,.1,"DT")
2960321
"^DD",364.7,364.7,1,0)
FORMAT CODE^K^^1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",364.7,364.7,1,3)
This is Standard MUMPS code.
"^DD",364.7,364.7,1,9)
@
"^DD",364.7,364.7,1,21,0)
^^8^8^2951207^
"^DD",364.7,364.7,1,21,1,0)
This is the code that will be xecuted to format the 'raw' data element
"^DD",364.7,364.7,1,21,2,0)
value that is returned from the execution of the DATA ELEMENT's definition.
"^DD",364.7,364.7,1,21,3,0)
This code can assume the variable/array IBXDATA is available as input and
"^DD",364.7,364.7,1,21,4,0)
should set this variable/array as its output.  Standard calls for data
"^DD",364.7,364.7,1,21,5,0)
formatting have been provided.  The variables IBXPG, IBXLN, IBXCOL are the
"^DD",364.7,364.7,1,21,6,0)
only IBX* variables that should be changed in this routine.  These represent
"^DD",364.7,364.7,1,21,7,0)
the page, line, column as the first 3 levels of subscript for the output
"^DD",364.7,364.7,1,21,8,0)
array.
"^DD",364.7,364.7,1,"DT")
2951207
"^DD",364.7,364.7,3,0)
FORMAT CODE DESCRIPTION^364.73^^3;0
"^DD",364.7,364.7,3,21,0)
^.001^1^1^3010102^^
"^DD",364.7,364.7,3,21,1,0)
This field describes the function of the format code entered.
"^DD",364.7,364.7,3,"DT")
2960710
"^DD",364.7,364.73,0)
FORMAT CODE DESCRIPTION SUB-FIELD^^.01^1
"^DD",364.7,364.73,0,"DT")
2960710
"^DD",364.7,364.73,0,"NM","FORMAT CODE DESCRIPTION")

"^DD",364.7,364.73,0,"UP")
364.7
"^DD",364.7,364.73,.01,0)
FORMAT CODE DESCRIPTION^W^^0;1^Q
"^DD",364.7,364.73,.01,3)
Enter a description of the processing logic of the format code.
"^DD",364.7,364.73,.01,21,0)
^.001^1^1^3010102^^^^
"^DD",364.7,364.73,.01,21,1,0)
This is a description of the processing logic of the format code.
"^DD",364.7,364.73,.01,"DT")
2960710
"^DIC",350.8,350.8,0)
IB ERROR
"^DIC",350.8,350.8,0,"GL")
^IBE(350.8,
"^DIC",350.8,350.8,"%D",0)
^^11^11^2940214^^^^
"^DIC",350.8,350.8,"%D",1,0)
This file contains errors for billing functions.  It may be used by
"^DIC",350.8,350.8,"%D",2,0)
applications, IB or AR.  The normal format for a routine to return
"^DIC",350.8,350.8,"%D",3,0)
an error is to return the variable:
"^DIC",350.8,350.8,"%D",4,0)
  Y=1^... a successful event occured
"^DIC",350.8,350.8,"%D",5,0)
  Y=-1^error code[;error code;error code...]^additional text
"^DIC",350.8,350.8,"%D",6,0)
The error messages can be displayed by calling routine ^IBAERR.  If
"^DIC",350.8,350.8,"%D",7,0)
the error occurs in a tasked job ($D(ZTQUEUED)'=0) the routine will
"^DIC",350.8,350.8,"%D",8,0)
put the error message in a bulletin and post it to the group defined
"^DIC",350.8,350.8,"%D",9,0)
in the IB SITE PARAMETER FILE.
"^DIC",350.8,350.8,"%D",10,0)
 
"^DIC",350.8,350.8,"%D",11,0)
Per VHA Directive 10-93-142, this file definition should not be modified.
"^DIC",350.8,"B","IB ERROR",350.8)

"^DIC",364.7,364.7,0)
IB FORM FIELD CONTENT^364.7P
"^DIC",364.7,364.7,0,"GL")
^IBA(364.7,
"^DIC",364.7,364.7,"%D",0)
^^9^9^2970606^^^^
"^DIC",364.7,364.7,"%D",1,0)
DO NOT delete entries or edit data in this file with VA File Manager.
"^DIC",364.7,364.7,"%D",2,0)
 
"^DIC",364.7,364.7,"%D",3,0)
This is the file that contains the specific fields to be used to produce
"^DIC",364.7,364.7,"%D",4,0)
the associated form or screen.  If there is no insurance company or bill
"^DIC",364.7,364.7,"%D",5,0)
type specified for an entry, this is assumed to be the default definition
"^DIC",364.7,364.7,"%D",6,0)
of the field.
"^DIC",364.7,364.7,"%D",7,0)
 
"^DIC",364.7,364.7,"%D",8,0)
Entries in this file that are designated as having a SECURITY LEVEL of
"^DIC",364.7,364.7,"%D",9,0)
NATIONAL should not be deleted or edited.
"^DIC",364.7,"B","IB FORM FIELD CONTENT",364.7)

**END**
**END**
