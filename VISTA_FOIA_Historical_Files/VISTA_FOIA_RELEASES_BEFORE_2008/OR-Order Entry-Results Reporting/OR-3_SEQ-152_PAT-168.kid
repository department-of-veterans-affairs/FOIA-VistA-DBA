EMERGENCY Released OR*3*168 SEQ #152
Extracted from mail message
**KIDS**:OR*3.0*168^

**INSTALL NAME**
OR*3.0*168
"BLD",4102,0)
OR*3.0*168^ORDER ENTRY/RESULTS REPORTING^0^3021213^y
"BLD",4102,4,0)
^9.64PA^^
"BLD",4102,"KRN",0)
^9.67PA^8989.52^19
"BLD",4102,"KRN",.4,0)
.4
"BLD",4102,"KRN",.401,0)
.401
"BLD",4102,"KRN",.402,0)
.402
"BLD",4102,"KRN",.403,0)
.403
"BLD",4102,"KRN",.5,0)
.5
"BLD",4102,"KRN",.84,0)
.84
"BLD",4102,"KRN",3.6,0)
3.6
"BLD",4102,"KRN",3.8,0)
3.8
"BLD",4102,"KRN",9.2,0)
9.2
"BLD",4102,"KRN",9.8,0)
9.8
"BLD",4102,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4102,"KRN",9.8,"NM",1,0)
ORMBLD^^0^B33327417
"BLD",4102,"KRN",9.8,"NM",2,0)
ORX2^^0^B9155683
"BLD",4102,"KRN",9.8,"NM","B","ORMBLD",1)

"BLD",4102,"KRN",9.8,"NM","B","ORX2",2)

"BLD",4102,"KRN",19,0)
19
"BLD",4102,"KRN",19.1,0)
19.1
"BLD",4102,"KRN",101,0)
101
"BLD",4102,"KRN",409.61,0)
409.61
"BLD",4102,"KRN",771,0)
771
"BLD",4102,"KRN",870,0)
870
"BLD",4102,"KRN",8989.51,0)
8989.51
"BLD",4102,"KRN",8989.52,0)
8989.52
"BLD",4102,"KRN",8994,0)
8994
"BLD",4102,"KRN","B",.4,.4)

"BLD",4102,"KRN","B",.401,.401)

"BLD",4102,"KRN","B",.402,.402)

"BLD",4102,"KRN","B",.403,.403)

"BLD",4102,"KRN","B",.5,.5)

"BLD",4102,"KRN","B",.84,.84)

"BLD",4102,"KRN","B",3.6,3.6)

"BLD",4102,"KRN","B",3.8,3.8)

"BLD",4102,"KRN","B",9.2,9.2)

"BLD",4102,"KRN","B",9.8,9.8)

"BLD",4102,"KRN","B",19,19)

"BLD",4102,"KRN","B",19.1,19.1)

"BLD",4102,"KRN","B",101,101)

"BLD",4102,"KRN","B",409.61,409.61)

"BLD",4102,"KRN","B",771,771)

"BLD",4102,"KRN","B",870,870)

"BLD",4102,"KRN","B",8989.51,8989.51)

"BLD",4102,"KRN","B",8989.52,8989.52)

"BLD",4102,"KRN","B",8994,8994)

"BLD",4102,"QUES",0)
^9.62^^
"BLD",4102,"REQB",0)
^9.611^2^2
"BLD",4102,"REQB",1,0)
OR*3.0*133^2
"BLD",4102,"REQB",2,0)
OR*3.0*158^2
"BLD",4102,"REQB","B","OR*3.0*133",1)

"BLD",4102,"REQB","B","OR*3.0*158",2)

"MBREQ")
0
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
168^3021213
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ORMBLD")
0^1^B33327417
"RTN","ORMBLD",1,0)
ORMBLD ; SLC/MKB - Build outgoing ORM msgs ;11/24/00  13:09
"RTN","ORMBLD",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,33,26,45,79,97,133,168**;Dec 17, 1997
"RTN","ORMBLD",3,0)
NEW(IFN,CODE) ; -- Send NW order message to pkg
"RTN","ORMBLD",4,0)
 ;I $P($G(^ORD(101.42,+$$VALUE^ORCSAVE2(IFN,"URGENCY"),0)),U)="DONE" D STATUS^ORCSAVE2(IFN,2) Q  ; complete -> don't send to pkg
"RTN","ORMBLD",5,0)
 N ORPKG,ORMSG,DGQUIET K ^TMP("ORWORD",$J)
"RTN","ORMBLD",6,0)
 S DGQUIET=1 D  Q:'$O(ORMSG(0))  ;build msg, ORDIALOG gone when posted
"RTN","ORMBLD",7,0)
 . N OR0,OR3,OR8,ORVP,ORDG,ORDIALOG,ORPARENT S:'$D(CODE) CODE="NW"
"RTN","ORMBLD",8,0)
 . S OR0=$G(^OR(100,IFN,0)) Q:'$L(OR0)  S OR3=$G(^(3)),OR8=$G(^(8,1,0))
"RTN","ORMBLD",9,0)
 . S ORVP=$P(OR0,U,2),ORDG=$P(OR0,U,11),ORPKG=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORMBLD",10,0)
 . Q:"^GMRA^GMRC^FH^LR^PS^RA^OR^"'[(U_ORPKG_U)
"RTN","ORMBLD",11,0)
 . S ORDIALOG=+$P(OR0,U,5) Q:'ORDIALOG
"RTN","ORMBLD",12,0)
 . D GETDLG1^ORCD(ORDIALOG),GETORDER^ORCD(IFN)
"RTN","ORMBLD",13,0)
 . S ORMSG(1)=$$MSH("ORM",ORPKG),ORMSG(2)=$$PID(ORVP)
"RTN","ORMBLD",14,0)
 . S ORMSG(3)=$$PV1(ORVP,$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORMBLD",15,0)
 . S ORPARENT=$P(OR3,U,9) I ORPARENT,$G(ORDIALOG($$PTR^ORCD("OR GTX SCHEDULE"),1))="NOW"!'$O(^OR(100,+ORPARENT,4.5,"ID","CONJ",0)) S ORPARENT="" ;no parent if NOW or only child
"RTN","ORMBLD",16,0)
 . S ORMSG(4)="ORC|"_CODE_"|"_+OR0_";1^OR||||||"_ORPARENT_"|"_$$HL7DATE($P(OR0,U,7))_"|"_+$P(OR0,U,6)_"||"_+$P(OR0,U,4)_"|||"_$$HL7DATE($$NOW^XLFDT)_"|"_$$NATURE($P(OR8,U,12))_"^^^"
"RTN","ORMBLD",17,0)
 . D @ORPKG K ^TMP("ORWORD",$J)
"RTN","ORMBLD",18,0)
 I $G(ORZTEST) M ORZTEST=ORMSG Q  ;testing only
"RTN","ORMBLD",19,0)
 D MSG^XQOR("OR EVSEND "_ORPKG,.ORMSG)
"RTN","ORMBLD",20,0)
 Q
"RTN","ORMBLD",21,0)
 ;
"RTN","ORMBLD",22,0)
MSG(IFN,CODE,REASON) ; -- Send all other order msgs
"RTN","ORMBLD",23,0)
 N ORPKG,ORMSG,DGQUIET K ^TMP("ORWORD",$J)
"RTN","ORMBLD",24,0)
 S DGQUIET=1 D  Q:'$O(ORMSG(0))  ; build message
"RTN","ORMBLD",25,0)
 . N OR0,OR8,DG,PKGID,I,TYPE,DA,PROV,NATR,STS,OI
"RTN","ORMBLD",26,0)
 . S OR0=$G(^OR(100,+IFN,0)),PKGID=$G(^(4)),STS=$P($G(^(3)),U,3)
"RTN","ORMBLD",27,0)
 . S ORPKG=$$NMSP^ORCD($P(OR0,U,14)) Q:"^GMRA^GMRC^FH^LR^PS^RA^OR^"'[(U_ORPKG_U)  S:ORPKG="LR" ORPKG="LRCH"
"RTN","ORMBLD",28,0)
 . S DA=+$P(IFN,";",2),OR8=$G(^OR(100,+IFN,8,DA,0))
"RTN","ORMBLD",29,0)
 . S PROV=$P(OR8,U,3),NATR=$P(OR8,U,12) S:'PROV PROV=$G(ORNP)
"RTN","ORMBLD",30,0)
 . S TYPE=$S(CODE="NA"!(CODE="DE"):"ORR",1:"ORM")
"RTN","ORMBLD",31,0)
 . S ORMSG(1)=$$MSH(TYPE,ORPKG),ORMSG(2)=$$PID($P(OR0,U,2)),I=2
"RTN","ORMBLD",32,0)
 . I ORPKG="PS" S I=I+1,ORMSG(I)=$$PV1($P(OR0,U,2),$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORMBLD",33,0)
 . S I=I+1,ORMSG(I)="ORC|"_CODE_"|"_IFN_"^OR|"_PKGID_U_ORPKG_"||||||"_$S($G(DGPMA):$$HL7DATE($P(DGPMA,U)),1:"")_"|"_DUZ_"||"_PROV_"|||"_$$HL7DATE($$NOW^XLFDT)_"|"_$$REASON(+$G(REASON),NATR)
"RTN","ORMBLD",34,0)
 . I ORPKG="FH",CODE="SS" S $P(ORMSG(I),"|",6)=$S(STS=8:"SC",STS=6:"IP",1:"")
"RTN","ORMBLD",35,0)
 . I $E(ORPKG,1,2)="LR" S OI=+$O(^OR(100,+IFN,.1,0)),OI=+$G(^(OI,0)) S:OI I=I+1,ORMSG(I)="OBR||||"_$$USID(OI)
"RTN","ORMBLD",36,0)
 . K ^TMP("ORWORD",$J)
"RTN","ORMBLD",37,0)
 D MSG^XQOR("OR EVSEND "_ORPKG,.ORMSG)
"RTN","ORMBLD",38,0)
 Q
"RTN","ORMBLD",39,0)
 ;
"RTN","ORMBLD",40,0)
BHS(PAT) ; -- Send batch header segment/message to Lab
"RTN","ORMBLD",41,0)
 N ORMSG S ORMSG(1)="BHS|^~\&|ORDER ENTRY|"_$G(DUZ(2))_"|LABORATORY|"_$G(DUZ(2))_"|"_$$HL7DATE($$NOW^XLFDT)
"RTN","ORMBLD",42,0)
 S ORMSG(2)=$$PID($G(PAT))
"RTN","ORMBLD",43,0)
 D MSG^XQOR("OR EVSEND LRCH",.ORMSG)
"RTN","ORMBLD",44,0)
 Q
"RTN","ORMBLD",45,0)
 ;
"RTN","ORMBLD",46,0)
BTS(PAT) ; -- Send batch trailer segment/message to Lab
"RTN","ORMBLD",47,0)
 N ORMSG S ORMSG(1)="BTS",ORMSG(2)=$$PID($G(PAT))
"RTN","ORMBLD",48,0)
 D MSG^XQOR("OR EVSEND LRCH",.ORMSG)
"RTN","ORMBLD",49,0)
 Q
"RTN","ORMBLD",50,0)
 ;
"RTN","ORMBLD",51,0)
MSH(TYPE,TO) ; -- MSH segment
"RTN","ORMBLD",52,0)
 N MSH
"RTN","ORMBLD",53,0)
 S MSH="MSH|^~\&|ORDER ENTRY|"_$G(DUZ(2))_"|"_$$NAME(TO)_"|"_$G(DUZ(2))_"|"_$$HL7DATE($$NOW^XLFDT)_"||"_TYPE
"RTN","ORMBLD",54,0)
 Q MSH
"RTN","ORMBLD",55,0)
 ;
"RTN","ORMBLD",56,0)
NAME(NMSP) ; -- Returns name of pkg NMSP
"RTN","ORMBLD",57,0)
 I NMSP="GMRA" Q "ALLERGIES"
"RTN","ORMBLD",58,0)
 I NMSP="GMRC" Q "CONSULTS"
"RTN","ORMBLD",59,0)
 I NMSP="FH" Q "DIETETICS"
"RTN","ORMBLD",60,0)
 I NMSP?1"LR".E Q "LABORATORY"
"RTN","ORMBLD",61,0)
 I NMSP="PS" Q "PHARMACY"
"RTN","ORMBLD",62,0)
 I NMSP="RA" Q "RADIOLOGY"
"RTN","ORMBLD",63,0)
 I NMSP="OR" Q "ORDER ENTRY"
"RTN","ORMBLD",64,0)
 Q ""
"RTN","ORMBLD",65,0)
 ;
"RTN","ORMBLD",66,0)
PID(DFN) ; -- PID segment
"RTN","ORMBLD",67,0)
 N PID,PTR,ROOT
"RTN","ORMBLD",68,0)
 S PTR=+$P(DFN,";"),ROOT=$P(DFN,";",2),PID="PID|||"
"RTN","ORMBLD",69,0)
 I ROOT="DPT(" S PID=PID_PTR_"||"_$P($G(^DPT(PTR,0)),U)
"RTN","ORMBLD",70,0)
 E  S PID=PID_"|"_DFN_"|"_$S($L(ROOT):$P($G(@(U_ROOT_PTR_",0)")),U),1:"")
"RTN","ORMBLD",71,0)
 Q PID
"RTN","ORMBLD",72,0)
 ;
"RTN","ORMBLD",73,0)
PV1(OBJ,TYPE,LOC,VISIT) ; -- PV1 segment
"RTN","ORMBLD",74,0)
 N PV1,RB S RB=""
"RTN","ORMBLD",75,0)
 I TYPE="I",+OBJ,$P(OBJ,";",2)="DPT(" S RB=$P($G(^DPT(+OBJ,.101)),U)
"RTN","ORMBLD",76,0)
 S PV1="PV1||"_TYPE_"|"_LOC_$S($L(RB):U_RB,1:"")_"||||||||||||||||"_$G(VISIT)
"RTN","ORMBLD",77,0)
 Q PV1
"RTN","ORMBLD",78,0)
 ;
"RTN","ORMBLD",79,0)
HL7DATE(DATE) ; -- FM -> HL7 format
"RTN","ORMBLD",80,0)
 Q $$FMTHL7^XLFDT(DATE)  ;**97
"RTN","ORMBLD",81,0)
 ;
"RTN","ORMBLD",82,0)
USID(OI) ; -- Returns Univ Serv ID for Orderable Item
"RTN","ORMBLD",83,0)
 N OITEM,NATL,LOCAL S OITEM=$G(^ORD(101.43,+OI,0))
"RTN","ORMBLD",84,0)
 S NATL=$P(OITEM,U,3)_U_U_$P(OITEM,U,4)
"RTN","ORMBLD",85,0)
 S LOCAL=$P($P(OITEM,U,2),";")_U_$P(OITEM,U)_U_$P($P(OITEM,U,2),";",2)
"RTN","ORMBLD",86,0)
 Q NATL_U_LOCAL
"RTN","ORMBLD",87,0)
 ;
"RTN","ORMBLD",88,0)
NATURE(X) ; -- Returns 3 ^-piece identifier for nature X
"RTN","ORMBLD",89,0)
 N ORN,Y S ORN=$G(^ORD(100.02,+$G(X),0))
"RTN","ORMBLD",90,0)
 S Y=$P(ORN,U,2)_U_$P(ORN,U)_"^99ORN"
"RTN","ORMBLD",91,0)
 Q Y
"RTN","ORMBLD",92,0)
 ;
"RTN","ORMBLD",93,0)
REASON(X,N) ; -- Returns 6 ^-piece format of reason X
"RTN","ORMBLD",94,0)
 ;    N ^ NATURE ^ 99ORN ^ # ^ Reason ^ 99ORR
"RTN","ORMBLD",95,0)
 N Y,ORR S ORR=$G(^ORD(100.03,+$G(X),0))
"RTN","ORMBLD",96,0)
 S:'$G(N) N=+$P(ORR,U,7) S Y=$$NATURE(N)
"RTN","ORMBLD",97,0)
 S:$G(X) Y=Y_U_$S(ORPKG'="RA":+X,1:"")_U_$P(ORR,U)_"^99ORR"
"RTN","ORMBLD",98,0)
 Q Y
"RTN","ORMBLD",99,0)
 ;
"RTN","ORMBLD",100,0)
IP() ; -- Returns ORIFN^Type if pt has active isolation order (or 0 if not)
"RTN","ORMBLD",101,0)
 N TYPE,START,ORIFN,Y
"RTN","ORMBLD",102,0)
 S TYPE=$O(^ORD(100.98,"B","PREC",0)),START=$$NOW^XLFDT,Y=0
"RTN","ORMBLD",103,0)
 F  S START=$O(^OR(100,"AW",ORVP,TYPE,START),-1) Q:START'>0  S ORIFN=$O(^(START,0)) I $P($G(^OR(100,ORIFN,3)),U,3)=6 S Y=ORIFN Q
"RTN","ORMBLD",104,0)
 I Y S TYPE=$$VALUE^ORCSAVE2(ORIFN,"ISOLATION"),Y=Y_U_$$GET1^DIQ(119.4,+TYPE_",",.01)
"RTN","ORMBLD",105,0)
 Q Y
"RTN","ORMBLD",106,0)
 ;
"RTN","ORMBLD",107,0)
OR ; -- new Generic order
"RTN","ORMBLD",108,0)
 I ORDG=$O(^ORD(100.98,"B","M.A.S.",0)) D ADT^ORMBLDOR Q
"RTN","ORMBLD",109,0)
 D EN^ORMBLDOR
"RTN","ORMBLD",110,0)
 Q
"RTN","ORMBLD",111,0)
 ;
"RTN","ORMBLD",112,0)
GMRA ; -- new Allergy order
"RTN","ORMBLD",113,0)
 D ALG^ORMBLDAL
"RTN","ORMBLD",114,0)
 Q
"RTN","ORMBLD",115,0)
 ;
"RTN","ORMBLD",116,0)
GMRC ; -- new Consult order
"RTN","ORMBLD",117,0)
 D CSLT^ORMBLDGM
"RTN","ORMBLD",118,0)
 Q
"RTN","ORMBLD",119,0)
 ;
"RTN","ORMBLD",120,0)
FH ; -- new Diet order
"RTN","ORMBLD",121,0)
 N ORPARAM D EN^FHWOR8(+ORVP,.ORPARAM) ; set parameters
"RTN","ORMBLD",122,0)
 S:'$L($G(ORPARAM(3))) ORPARAM(3)="T"
"RTN","ORMBLD",123,0)
 I ORDG=$O(^ORD(100.98,"B","PRECAUTIONS",0)) D IP^ORMBLDFH Q
"RTN","ORMBLD",124,0)
 I ORDG=$O(^ORD(100.98,"B","EARLY/LATE TRAYS",0)) D TRAY^ORMBLDFH Q
"RTN","ORMBLD",125,0)
 I ORDG=$O(^ORD(100.98,"B","TUBEFEEDINGS",0)) D TF^ORMBLDFH Q
"RTN","ORMBLD",126,0)
 I ORDG=$O(^ORD(100.98,"B","DIET ADDITIONAL ORDERS",0)) D ADDN^ORMBLDFH Q
"RTN","ORMBLD",127,0)
 D DIET^ORMBLDFH
"RTN","ORMBLD",128,0)
 Q
"RTN","ORMBLD",129,0)
 ;
"RTN","ORMBLD",130,0)
LR ; -- new Lab order
"RTN","ORMBLD",131,0)
 I CODE="XO" D XO^ORMBLDLR Q  ; change
"RTN","ORMBLD",132,0)
 D CH^ORMBLDLR S ORPKG="LRCH" Q  ;no difference by subscript at this time
"RTN","ORMBLD",133,0)
 N SUB S SUB=$P($G(^ORD(100.98,ORDG,0)),U,3)
"RTN","ORMBLD",134,0)
 S:(SUB="SP")!(SUB="EM")!(SUB="AU")!(SUB="CY") SUB="AP"
"RTN","ORMBLD",135,0)
 S:(SUB="LAB")!(SUB="MI")!(SUB="HEMA") SUB="CH"
"RTN","ORMBLD",136,0)
 D @(SUB_"^ORMBLDLR") S ORPKG=ORPKG_SUB
"RTN","ORMBLD",137,0)
 Q
"RTN","ORMBLD",138,0)
 ;
"RTN","ORMBLD",139,0)
PS ; -- new Pharmacy order
"RTN","ORMBLD",140,0)
 ;I ORDG=$O(^ORD(100.98,"B","OUTPATIENT MEDICATIONS",0)) D OUT^ORMBLDPS Q
"RTN","ORMBLD",141,0)
 ;I ORDG=$O(^ORD(100.98,"B","IV MEDICATIONS",0)) D IV^ORMBLDPS Q
"RTN","ORMBLD",142,0)
 ;D UD^ORMBLDPS
"RTN","ORMBLD",143,0)
 N PKG S PKG=$P(OR0,U,14),PKG=$$GET1^DIQ(9.4,+PKG_",",1)
"RTN","ORMBLD",144,0)
 I PKG="PSO",+$$VALUE^ORCSAVE2(IFN,"URGENCY")=99 D STATUS^ORCSAVE2(IFN,2) K ORMSG Q  ;complete, don't send
"RTN","ORMBLD",145,0)
 D @($S(PKG="PSIV":"IV",PKG="PSO":"OUT",1:"UD")_"^ORMBLDPS")
"RTN","ORMBLD",146,0)
 Q
"RTN","ORMBLD",147,0)
 ;
"RTN","ORMBLD",148,0)
RA ; -- new Radiology order
"RTN","ORMBLD",149,0)
 D EN^ORMBLDRA
"RTN","ORMBLD",150,0)
 Q
"RTN","ORMBLD",151,0)
 ;
"RTN","ORMBLD",152,0)
TEST(ORIFN) ; -- Build/display HL7 msgs w/o sending
"RTN","ORMBLD",153,0)
 K ORZTEST S ORZTEST=1 D NEW(ORIFN) ; leaves msg in ORZTEST() on exit
"RTN","ORMBLD",154,0)
 Q
"RTN","ORX2")
0^2^B9155683
"RTN","ORX2",1,0)
ORX2 ; slc/dcm - OE/RR Patient lock entry points ;11/25/02  09:51
"RTN","ORX2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**16,48,158,168**;Dec 17, 1997
"RTN","ORX2",3,0)
PT1 ;;Entry point to unlock patient when done adding orders - NO LONGER USED
"RTN","ORX2",4,0)
 ;;Required variable ORVP.
"RTN","ORX2",5,0)
 Q:'$D(ORVP)  Q:'$L(ORVP)  Q:ORVP'["DPT("
"RTN","ORX2",6,0)
 D UNLOCK(+ORVP) K ORPTLK,ORELK
"RTN","ORX2",7,0)
 Q
"RTN","ORX2",8,0)
LK ;;Entry point for locking patient when updating orders
"RTN","ORX2",9,0)
 ;;Entry: X=VP to Patient "DFN;DPT("  Exit: Y=1 if lock succeeds
"RTN","ORX2",10,0)
 Q:'$D(X)  Q:'$L(X)  Q:X'["DPT("  Q:'$D(@("^"_$P(X,";",2)_+X_",0)"))
"RTN","ORX2",11,0)
 S Y=$$LOCK(+X) Q:Y
"RTN","ORX2",12,0)
 W !!,$C(7),$P(Y,U,2) D READ
"RTN","ORX2",13,0)
 S Y=0 K X
"RTN","ORX2",14,0)
 Q
"RTN","ORX2",15,0)
ULK ;;Entry point to unlock patient
"RTN","ORX2",16,0)
 ;;Required variable X=VP to patient.
"RTN","ORX2",17,0)
 Q:'$D(X)  Q:'$L(X)  Q:X'["DPT("  Q:'$D(@("^"_$P(X,";",2)_+X_",0)"))
"RTN","ORX2",18,0)
 D UNLOCK(+X)
"RTN","ORX2",19,0)
 Q
"RTN","ORX2",20,0)
 ;
"RTN","ORX2",21,0)
LOCK(DFN) ; -- Lock patient chart (silent)
"RTN","ORX2",22,0)
 ; Returns 1 if successful, or 0^Message if could not get lock
"RTN","ORX2",23,0)
 ;
"RTN","ORX2",24,0)
 Q:'$G(DFN) "0^Invalid patient" N Y,ORLK,NOW,NOW1
"RTN","ORX2",25,0)
 S ORLK=$G(^XTMP("ORPTLK-"_DFN,1)) Q:ORLK=(DUZ_U_$J) 1 ;locked
"RTN","ORX2",26,0)
 L +^XTMP("ORPTLK-"_DFN):1 I '$T S Y="0^"_$S(+ORLK:$P($G(^VA(200,+ORLK,0)),U),1:"Another person")_" is editing orders for this patient." Q Y
"RTN","ORX2",27,0)
 S NOW=$$NOW^XLFDT,NOW1=$$FMADD^XLFDT(NOW,1)
"RTN","ORX2",28,0)
 S ^XTMP("ORPTLK-"_DFN,0)=NOW1_U_NOW_"^CPRS Chart Lock",^(1)=DUZ_U_$J
"RTN","ORX2",29,0)
 Q 1
"RTN","ORX2",30,0)
 ;
"RTN","ORX2",31,0)
UNLOCK(DFN) ; -- Unlock patient chart (silent)
"RTN","ORX2",32,0)
 L -^XTMP("ORPTLK-"_DFN)
"RTN","ORX2",33,0)
 I $G(^XTMP("ORPTLK-"_DFN,1))=(DUZ_U_$J) K ^XTMP("ORPTLK-"_DFN)
"RTN","ORX2",34,0)
 Q
"RTN","ORX2",35,0)
 ;
"RTN","ORX2",36,0)
INC(IFN) ;Increment zero node on file 100.2
"RTN","ORX2",37,0)
 N X,X3,X4
"RTN","ORX2",38,0)
 Q:'$G(IFN) 1 Q:$D(^OR(100.2,IFN)) 1
"RTN","ORX2",39,0)
 L +^OR(100.2,0):5 I '$T Q 0
"RTN","ORX2",40,0)
 S:'$D(^OR(100.2,0)) ^(0)="OE/RR PATIENT^100.2P" S X=^(0)
"RTN","ORX2",41,0)
 S X4=+$P(X,U,4)+1,X3=$S(IFN>$P(X,U,3):IFN,1:$P(X,U,3))
"RTN","ORX2",42,0)
 S $P(^OR(100.2,0),U,3,4)=X3_U_X4
"RTN","ORX2",43,0)
 L -^OR(100.2,0)
"RTN","ORX2",44,0)
 Q 1
"RTN","ORX2",45,0)
 ;
"RTN","ORX2",46,0)
LOCK1(ORDER) ; -- Lock ORDER in file #100
"RTN","ORX2",47,0)
 ; Returns 1 if successful or 0^Message if could not get lock
"RTN","ORX2",48,0)
 ;
"RTN","ORX2",49,0)
 N X,Y,NOW,NOW1 I '$G(ORDER) Q "0^Invalid order number"
"RTN","ORX2",50,0)
 L +^OR(100,+ORDER):1 I '$T S X=+$G(^XTMP("ORLK-"_+ORDER,1)),Y="0^"_$S(X:$P($G(^VA(200,X,0)),U),1:"Another person")_" is working on this order." Q Y
"RTN","ORX2",51,0)
 I $P($G(^OR(100,+ORDER,0)),U,12)="I" S Y=+$P($G(^(3)),U,6) I Y,$P($G(^OR(100,Y,3)),U,3)=11 D  Q Y
"RTN","ORX2",52,0)
 . S X=$S($P(^OR(100,Y,3),U,11)=2:"renewal",1:"edit")
"RTN","ORX2",53,0)
 . S Y="0^An unreleased "_X_" exists for this order." L -^OR(100,+ORDER)
"RTN","ORX2",54,0)
 S NOW=$$NOW^XLFDT,NOW1=$$FMADD^XLFDT(NOW,1)
"RTN","ORX2",55,0)
 S ^XTMP("ORLK-"_+ORDER,0)=NOW1_U_NOW_"^CPRS Order Lock",^(1)=DUZ_U_$J
"RTN","ORX2",56,0)
 Q 1
"RTN","ORX2",57,0)
 ;
"RTN","ORX2",58,0)
UNLK1(ORDER) ; -- Unlock ORDER in file #100
"RTN","ORX2",59,0)
 L -^OR(100,+$G(ORDER)) K ^XTMP("ORLK-"_+ORDER)
"RTN","ORX2",60,0)
 Q
"RTN","ORX2",61,0)
 ;
"RTN","ORX2",62,0)
READ ; -- instead of READ^ORUTL
"RTN","ORX2",63,0)
 N X,Y,DIR
"RTN","ORX2",64,0)
 S DIR(0)="EA",DIR("A")="     Press return to continue  "
"RTN","ORX2",65,0)
 D ^DIR
"RTN","ORX2",66,0)
 Q
"VER")
8.0^22.0
**END**
**END**
