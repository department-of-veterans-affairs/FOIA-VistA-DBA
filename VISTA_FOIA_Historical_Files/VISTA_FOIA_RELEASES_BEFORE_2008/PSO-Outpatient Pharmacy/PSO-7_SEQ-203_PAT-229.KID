Released PSO*7*229 SEQ #203
Extracted from mail message
**KIDS**:PSO*7.0*229^

**INSTALL NAME**
PSO*7.0*229
"BLD",5954,0)
PSO*7.0*229^OUTPATIENT PHARMACY^0^3060117^y
"BLD",5954,1,0)
^^14^14^3060111^^^^
"BLD",5954,1,1,0)
This is a follow-up patch to PHARMACY REENGINEERING ENCAPSULATION
"BLD",5954,1,2,0)
CYCLE 2 APIS FOR OUTPATIENT PHARMACY patch (PSO*7*213).
"BLD",5954,1,3,0)
 
"BLD",5954,1,4,0)
The following changes are made in this path to the following application 
"BLD",5954,1,5,0)
program interfaces (APIs): 
"BLD",5954,1,6,0)
 
"BLD",5954,1,7,0)
DBIA 4820 (PSO52API) is updated with newing of variable to prevent possible 
"BLD",5954,1,8,0)
undefinded errors.  
"BLD",5954,1,9,0)
 
"BLD",5954,1,10,0)
DBIA 4822 (PSO525AP) is updated to include omitted fields, Printed (#2) and 
"BLD",5954,1,11,0)
CMOP INDICATOR (#3) from the RX SUSPENSE file (#52.5).  
"BLD",5954,1,12,0)
 
"BLD",5954,1,13,0)
DBIA 4827 (PSO59) is updated to include omitted fields, SITE DEA NUMBER (#1)
"BLD",5954,1,14,0)
and SITE (NATIONAL NAME) (#2) from the OUTPATIENT SITE file (#59).
"BLD",5954,4,0)
^9.64PA^^
"BLD",5954,"ABPKG")
n
"BLD",5954,"KRN",0)
^9.67PA^8989.52^19
"BLD",5954,"KRN",.4,0)
.4
"BLD",5954,"KRN",.401,0)
.401
"BLD",5954,"KRN",.402,0)
.402
"BLD",5954,"KRN",.403,0)
.403
"BLD",5954,"KRN",.5,0)
.5
"BLD",5954,"KRN",.84,0)
.84
"BLD",5954,"KRN",3.6,0)
3.6
"BLD",5954,"KRN",3.8,0)
3.8
"BLD",5954,"KRN",9.2,0)
9.2
"BLD",5954,"KRN",9.8,0)
9.8
"BLD",5954,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5954,"KRN",9.8,"NM",1,0)
PSO525AP^^0^B8670836
"BLD",5954,"KRN",9.8,"NM",2,0)
PSO59^^0^B3433876
"BLD",5954,"KRN",9.8,"NM",3,0)
PSO52API^^0^B83137859
"BLD",5954,"KRN",9.8,"NM","B","PSO525AP",1)

"BLD",5954,"KRN",9.8,"NM","B","PSO52API",3)

"BLD",5954,"KRN",9.8,"NM","B","PSO59",2)

"BLD",5954,"KRN",19,0)
19
"BLD",5954,"KRN",19.1,0)
19.1
"BLD",5954,"KRN",101,0)
101
"BLD",5954,"KRN",409.61,0)
409.61
"BLD",5954,"KRN",771,0)
771
"BLD",5954,"KRN",870,0)
870
"BLD",5954,"KRN",8989.51,0)
8989.51
"BLD",5954,"KRN",8989.52,0)
8989.52
"BLD",5954,"KRN",8994,0)
8994
"BLD",5954,"KRN","B",.4,.4)

"BLD",5954,"KRN","B",.401,.401)

"BLD",5954,"KRN","B",.402,.402)

"BLD",5954,"KRN","B",.403,.403)

"BLD",5954,"KRN","B",.5,.5)

"BLD",5954,"KRN","B",.84,.84)

"BLD",5954,"KRN","B",3.6,3.6)

"BLD",5954,"KRN","B",3.8,3.8)

"BLD",5954,"KRN","B",9.2,9.2)

"BLD",5954,"KRN","B",9.8,9.8)

"BLD",5954,"KRN","B",19,19)

"BLD",5954,"KRN","B",19.1,19.1)

"BLD",5954,"KRN","B",101,101)

"BLD",5954,"KRN","B",409.61,409.61)

"BLD",5954,"KRN","B",771,771)

"BLD",5954,"KRN","B",870,870)

"BLD",5954,"KRN","B",8989.51,8989.51)

"BLD",5954,"KRN","B",8989.52,8989.52)

"BLD",5954,"KRN","B",8994,8994)

"BLD",5954,"QUES",0)
^9.62^^
"BLD",5954,"REQB",0)
^9.611^1^1
"BLD",5954,"REQB",1,0)
PSO*7.0*213^2
"BLD",5954,"REQB","B","PSO*7.0*213",1)

"MBREQ")
0
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
229^3060117
"PKG",141,22,1,"PAH",1,1,0)
^^14^14^3060117
"PKG",141,22,1,"PAH",1,1,1,0)
This is a follow-up patch to PHARMACY REENGINEERING ENCAPSULATION
"PKG",141,22,1,"PAH",1,1,2,0)
CYCLE 2 APIS FOR OUTPATIENT PHARMACY patch (PSO*7*213).
"PKG",141,22,1,"PAH",1,1,3,0)
 
"PKG",141,22,1,"PAH",1,1,4,0)
The following changes are made in this path to the following application 
"PKG",141,22,1,"PAH",1,1,5,0)
program interfaces (APIs): 
"PKG",141,22,1,"PAH",1,1,6,0)
 
"PKG",141,22,1,"PAH",1,1,7,0)
DBIA 4820 (PSO52API) is updated with newing of variable to prevent possible 
"PKG",141,22,1,"PAH",1,1,8,0)
undefinded errors.  
"PKG",141,22,1,"PAH",1,1,9,0)
 
"PKG",141,22,1,"PAH",1,1,10,0)
DBIA 4822 (PSO525AP) is updated to include omitted fields, Printed (#2) and 
"PKG",141,22,1,"PAH",1,1,11,0)
CMOP INDICATOR (#3) from the RX SUSPENSE file (#52.5).  
"PKG",141,22,1,"PAH",1,1,12,0)
 
"PKG",141,22,1,"PAH",1,1,13,0)
DBIA 4827 (PSO59) is updated to include omitted fields, SITE DEA NUMBER (#1)
"PKG",141,22,1,"PAH",1,1,14,0)
and SITE (NATIONAL NAME) (#2) from the OUTPATIENT SITE file (#59).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSO525AP")
0^1^B8670836
"RTN","PSO525AP",1,0)
PSO525AP ;BHAM ISC/SAB- encap II API to return suspended Rx data ; 04/07/05 10:30 am
"RTN","PSO525AP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**213,229**;DEC 1997
"RTN","PSO525AP",3,0)
 ;
"RTN","PSO525AP",4,0)
SUS(LIST,DFN,IEN,RX,SDATE,EDATE) ;
"RTN","PSO525AP",5,0)
 ;
"RTN","PSO525AP",6,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSO525AP",7,0)
 ;DFN: Patient's IEN 
"RTN","PSO525AP",8,0)
 ;IEN: Internal record number [optional]
"RTN","PSO525AP",9,0)
 ;RX #: Pointer to Prescription file (#52) [optional]
"RTN","PSO525AP",10,0)
 ;SDATE: Starting Suspense Date [optional]
"RTN","PSO525AP",11,0)
 ;EDATE: Ending Suspense Date [optional]
"RTN","PSO525AP",12,0)
 ;
"RTN","PSO525AP",13,0)
 Q:$G(LIST)=""
"RTN","PSO525AP",14,0)
 N DA,DR,PSOPOST,DIC,DIQ,ND,LK K ^TMP($J,LIST)
"RTN","PSO525AP",15,0)
 I $G(IEN) D  G CLEAN
"RTN","PSO525AP",16,0)
 .I $G(^PS(52.5,IEN,0))']"" S ^TMP($J,LIST,IEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO525AP",17,0)
 .D PROCESS
"RTN","PSO525AP",18,0)
 I $G(RX)]"",'$G(IEN) S IEN=$O(^PS(52.5,"B",RX,0)) D  G CLEAN
"RTN","PSO525AP",19,0)
 .I 'IEN Q
"RTN","PSO525AP",20,0)
 .D PROCESS
"RTN","PSO525AP",21,0)
 I $G(SDATE)!($G(EDATE)) D DATE G CLEAN
"RTN","PSO525AP",22,0)
 I $G(DFN) F IEN=0:0 S IEN=$O(^PS(52.5,"AF",DFN,IEN)) Q:'IEN  D
"RTN","PSO525AP",23,0)
 .I DFN'=$P($G(^PS(52.5,IEN,0)),"^",3) S ^TMP($J,LIST,IEN,0)="-1^NO DATA FOUND (MISMATCHED PATIENT)" Q
"RTN","PSO525AP",24,0)
 .D PROCESS
"RTN","PSO525AP",25,0)
 I '$G(DFN) F DFN=0:0 S DFN=$O(^PS(52.5,"AF",DFN)) Q:'DFN  F IEN=0:0 S IEN=$O(^PS(52.5,"AF",DFN,IEN)) Q:'IEN  D PROCESS
"RTN","PSO525AP",26,0)
CLEAN I $G(DFN),'$O(^TMP($J,LIST,DFN,0)) S ^TMP($J,LIST,DFN,0)="-1^NO DATA FOUND"
"RTN","PSO525AP",27,0)
 I '$G(DFN),'$O(^TMP($J,LIST,0)) S ^TMP($J,LIST,0)="-1^NO DATA FOUND"
"RTN","PSO525AP",28,0)
 K DA,DR,DIC,PSOPOST,DIQ,LDATE
"RTN","PSO525AP",29,0)
 Q
"RTN","PSO525AP",30,0)
PROCESS ;
"RTN","PSO525AP",31,0)
 I $G(^PS(52.5,IEN,0))']"" S ^TMP($J,LIST,IEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO525AP",32,0)
 I $G(DFN),DFN'=$P($G(^PS(52.5,IEN,0)),"^",3) Q
"RTN","PSO525AP",33,0)
 K PSOPOST S DIC=52.5,DA=IEN,DR=".01;.02;.03;.05;2;3;9",DIQ="PSOPOST",DIQ(0)="IE" D EN^DIQ1
"RTN","PSO525AP",34,0)
 F DR=.01,.02,.03,.05,2,3,9 D
"RTN","PSO525AP",35,0)
 .I DR=.01 S ^TMP($J,LIST,"B",PSOPOST(52.5,DA,DR,"I"),IEN)=""
"RTN","PSO525AP",36,0)
 .I DR=.03 S ^TMP($J,LIST,PSOPOST(52.5,DA,.03,"I"),0)=$G(^TMP($J,LIST,PSOPOST(52.5,DA,.03,"I"),0))+1
"RTN","PSO525AP",37,0)
 .I PSOPOST(52.5,DA,DR,"E")'=PSOPOST(52.5,DA,DR,"I") S ^TMP($J,LIST,PSOPOST(52.5,DA,.03,"I"),IEN,DR)=PSOPOST(52.5,DA,DR,"I")_"^"_PSOPOST(52.5,DA,DR,"E") Q
"RTN","PSO525AP",38,0)
 .S ^TMP($J,LIST,PSOPOST(52.5,DA,.03,"I"),IEN,DR)=PSOPOST(52.5,DA,DR,"I")
"RTN","PSO525AP",39,0)
 K DA,DR,PSOPOST,DIC,DIQ
"RTN","PSO525AP",40,0)
 Q
"RTN","PSO525AP",41,0)
DATE ;date range
"RTN","PSO525AP",42,0)
 I $G(SDATE) S LDATE=SDATE-1 D  Q
"RTN","PSO525AP",43,0)
 .I $G(EDATE) F  S LDATE=$O(^PS(52.5,"C",LDATE)) Q:'LDATE!(LDATE>EDATE)  F IEN=0:0 S IEN=$O(^PS(52.5,"C",LDATE,IEN)) Q:'IEN  D PROCESS
"RTN","PSO525AP",44,0)
 .I '$G(EDATE) F  S LDATE=$O(^PS(52.5,"C",LDATE)) Q:'LDATE  F IEN=0:0 S IEN=$O(^PS(52.5,"C",LDATE,IEN)) Q:'IEN  D PROCESS
"RTN","PSO525AP",45,0)
 I $G(EDATE) S LDATE=0 F  S LDATE=$O(^PS(52.5,"C",LDATE)) Q:'LDATE!(LDATE>EDATE)  F IEN=0:0 S IEN=$O(^PS(52.5,"C",LDATE,IEN)) Q:'IEN  D PROCESS
"RTN","PSO525AP",46,0)
 Q
"RTN","PSO52API")
0^3^B83137859
"RTN","PSO52API",1,0)
PSO52API ;BHAM ISC/SAB- encap II API to return Rx data ; 04/07/05 10:30 am
"RTN","PSO52API",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**213,229**;DEC 1997
"RTN","PSO52API",3,0)
 ;^PS(55 supported by DBIA 2228
"RTN","PSO52API",4,0)
 ;^PSDRUG supported by DBIA 221
"RTN","PSO52API",5,0)
 ;^PS(50.7 supported by DBIA 2223
"RTN","PSO52API",6,0)
 ;
"RTN","PSO52API",7,0)
RX(DFN,LIST,IEN,RX,NODE,SDATE,EDATE) ;
"RTN","PSO52API",8,0)
 ;DFN: Patient's IEN 
"RTN","PSO52API",9,0)
 ;LIST: Subscript used in ^TMP
"RTN","PSO52API",10,0)
 ;IEN: Rx IEN
"RTN","PSO52API",11,0)
 ;RX#: External Rx number
"RTN","PSO52API",12,0)
 ;NODE: Determines data elements returned [optional]
"RTN","PSO52API",13,0)
 ;SDATE: Start Date [optional]
"RTN","PSO52API",14,0)
 ;EDATE: End Date [optional]
"RTN","PSO52API",15,0)
 ;
"RTN","PSO52API",16,0)
 Q:'$G(DFN)  Q:$G(LIST)=""
"RTN","PSO52API",17,0)
 N DA,DR,PST,DIC,DIQ,ND,LK,DTE,DAT,I,X K ^TMP($J,LIST) S ^TMP($J,LIST,DFN,0)=0
"RTN","PSO52API",18,0)
 I $G(IEN) D PROCESS G CLEAN
"RTN","PSO52API",19,0)
 I $G(RX)]"",'$G(IEN) S IEN=$O(^PSRX("B",RX,0)) D  G CLEAN
"RTN","PSO52API",20,0)
 .I 'IEN S ^TMP($J,LIST,DFN,0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",21,0)
 .D PROCESS
"RTN","PSO52API",22,0)
 D DATE
"RTN","PSO52API",23,0)
CLEAN F I=0:0 S I=$O(^TMP($J,LIST,DFN,I)) Q:'I  S ^TMP($J,LIST,DFN,0)=^TMP($J,LIST,DFN,0)+1
"RTN","PSO52API",24,0)
 I ^TMP($J,LIST,DFN,0)=0 S ^TMP($J,LIST,DFN,0)="-1^NO DATA FOUND"
"RTN","PSO52API",25,0)
 K DA,DR,DIC,ND,DAT,PST,LK,DIQ,DTE,I,X
"RTN","PSO52API",26,0)
 Q
"RTN","PSO52API",27,0)
PROCESS ;
"RTN","PSO52API",28,0)
 I DFN'=$P($G(^PSRX(IEN,0)),"^",2) S ^TMP($J,LIST,IEN,0)="-1^NO DATA FOUND (MISMATCHED PATIENT)" Q
"RTN","PSO52API",29,0)
 I $G(^PSRX(IEN,0))']"" S ^TMP($J,LIST,IEN,0)="-1^NO RX DATA FOUND" Q
"RTN","PSO52API",30,0)
 I $G(NODE)']"" D ZE,TW,TH,MI,ST,RF,CM,AT,LB,PT,SD,TB,OI S DAT="I" D IB Q
"RTN","PSO52API",31,0)
 D ST F LK=1:1:$L(NODE,",") S DAT=$P(NODE,",",LK),ND=$P(DAT,"^") D
"RTN","PSO52API",32,0)
 .I ND=0 D ZE Q
"RTN","PSO52API",33,0)
 .I ND=2 D ZE,TW Q
"RTN","PSO52API",34,0)
 .I ND=3 D TW,TH Q
"RTN","PSO52API",35,0)
 .I ND="R" D RF Q
"RTN","PSO52API",36,0)
 .I ND="I" D IB Q
"RTN","PSO52API",37,0)
 .I ND="P" D PT Q
"RTN","PSO52API",38,0)
 .I ND="O" D OI Q
"RTN","PSO52API",39,0)
 .I ND="T" D TB Q
"RTN","PSO52API",40,0)
 .I ND="L" D LB Q
"RTN","PSO52API",41,0)
 .I ND="S" D SD Q
"RTN","PSO52API",42,0)
 .I ND="M" D MI Q
"RTN","PSO52API",43,0)
 .I ND="C" D CM Q
"RTN","PSO52API",44,0)
 .I ND="A" D AT Q
"RTN","PSO52API",45,0)
 .I ND="ST" D ST Q
"RTN","PSO52API",46,0)
 .S ^TMP($J,LIST,DFN,IEN,"INVALID REQUEST",ND)="Invalid Data Requested"
"RTN","PSO52API",47,0)
 Q
"RTN","PSO52API",48,0)
ZE ;zero
"RTN","PSO52API",49,0)
 K PST S DIC=52,DA=IEN,DR=".01:9;10.3;10.6;11;16;17" D DIQ
"RTN","PSO52API",50,0)
 F DR=.01,1,2,3,4,5,6,6.5,7,8,9,10.3,10.6,11,16,17 D
"RTN","PSO52API",51,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",52,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")
"RTN","PSO52API",53,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",54,0)
 Q
"RTN","PSO52API",55,0)
TW ;two
"RTN","PSO52API",56,0)
 Q:'$D(^PSRX(IEN,2))
"RTN","PSO52API",57,0)
 K PST S DIC=52,DA=IEN,DR="20:31;32.1;32.2;32.3;104" D DIQ
"RTN","PSO52API",58,0)
 F DR=20,21,22,23,24,25,26,27,28,29,30,31,32.1,32.2,32.3,104 D
"RTN","PSO52API",59,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",60,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")
"RTN","PSO52API",61,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",62,0)
 Q
"RTN","PSO52API",63,0)
TH ;three
"RTN","PSO52API",64,0)
 Q:'$D(^PSRX(IEN,3))
"RTN","PSO52API",65,0)
 K PST S DIC=52,DA=IEN,DR="12;26.1;34.1;101;102;102.1;102.2;109;112" D DIQ
"RTN","PSO52API",66,0)
 F DR=12,26.1,34.1,101,102,102.1,102.2,109,112 D
"RTN","PSO52API",67,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",68,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")
"RTN","PSO52API",69,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",70,0)
 Q
"RTN","PSO52API",71,0)
MI ;sig
"RTN","PSO52API",72,0)
 I $P($G(^PSRX(IEN,"SIG")),"^",2) D  Q
"RTN","PSO52API",73,0)
 .I '$O(^PSRX(IEN,"SIG1",0)) S ^TMP($J,LIST,DFN,IEN,"M",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",74,0)
 .F I=0:0 S I=$O(^PSRX(IEN,"SIG1",I)) Q:'I  S ^TMP($J,LIST,DFN,IEN,"M",I,0)=^PSRX(IEN,"SIG1",I,0),^TMP($J,LIST,DFN,IEN,"M",0)=$G(^TMP($J,LIST,DFN,IEN,"M",0))+1
"RTN","PSO52API",75,0)
 I $P($G(^PSRX(IEN,"SIG")),"^")']"" S ^TMP($J,LIST,DFN,IEN,"M",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",76,0)
 S X=$P($G(^PSRX(IEN,"SIG")),"^") D SIG^PSOHELP S ^TMP($J,LIST,DFN,IEN,"M",1,0)=$E(INS1,2,9999999),^TMP($J,LIST,DFN,IEN,"M",0)=1
"RTN","PSO52API",77,0)
 K X,INS1
"RTN","PSO52API",78,0)
 Q
"RTN","PSO52API",79,0)
ST ;status
"RTN","PSO52API",80,0)
 I DT>$P(^PSRX(IEN,2),"^",6),$P(^PSRX(IEN,"STA"),"^")<11 D
"RTN","PSO52API",81,0)
 .N PSOEXRX,PSOEXSTA,ORN,PIFN,PSUSD,PRFDT,PDA,PSST
"RTN","PSO52API",82,0)
 .S PSOEXRX=IEN D EN2^PSOMAUEX K PSOEXRX,PSONM,PSONMX
"RTN","PSO52API",83,0)
 K PST S DIC=52,DA=IEN,DR=".01;100" D DIQ
"RTN","PSO52API",84,0)
 S ^TMP($J,LIST,DFN,IEN,100)=PST(52,DA,100,"I")_"^"_PST(52,DA,100,"E")
"RTN","PSO52API",85,0)
 S ^TMP($J,LIST,"B",PST(52,DA,.01,"E"),IEN)=""
"RTN","PSO52API",86,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",87,0)
 Q
"RTN","PSO52API",88,0)
RF ;refill
"RTN","PSO52API",89,0)
 I '$O(^PSRX(IEN,1,0)) S ^TMP($J,LIST,DFN,IEN,"RF",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",90,0)
 I $P($G(DAT),"^",3) S DA(52.1)=$P(DAT,"^",3) D RFD K DA,DR,PST,DIC,DIQ Q
"RTN","PSO52API",91,0)
 F RF=0:0 S RF=$O(^PSRX(IEN,1,RF)) Q:'RF  S DA(52.1)=RF D RFD
"RTN","PSO52API",92,0)
 K DA,DR,PST,DIC,DIQ,RF
"RTN","PSO52API",93,0)
 Q
"RTN","PSO52API",94,0)
RFD K PST S DR(52.1)=".01:8;10.1;12;13;14;15;17",DIC=52,DA=IEN,DR=52 D DIQ
"RTN","PSO52API",95,0)
 I $P($G(DAT),"^",3),'$G(PST(52.1,DA(52.1),.01,"I")) S ^TMP($J,LIST,DFN,IEN,"RF",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",96,0)
 S ^TMP($J,LIST,DFN,IEN,"RF",0)=$G(^TMP($J,LIST,DFN,IEN,"RF",0))+1
"RTN","PSO52API",97,0)
 F DR=.01,1,1.1,1.2,2,3,4,5,6,7,8,10.1,12,13,14,15,17 D
"RTN","PSO52API",98,0)
 .I PST(52.1,DA(52.1),DR,"E")'=PST(52.1,DA(52.1),DR,"I") S ^TMP($J,LIST,DFN,IEN,"RF",DA(52.1),DR)=PST(52.1,DA(52.1),DR,"I")_"^"_PST(52.1,DA(52.1),DR,"E") Q
"RTN","PSO52API",99,0)
 .S ^TMP($J,LIST,DFN,IEN,"RF",DA(52.1),DR)=PST(52.1,DA(52.1),DR,"I")
"RTN","PSO52API",100,0)
 Q
"RTN","PSO52API",101,0)
PT ;par
"RTN","PSO52API",102,0)
 I '$O(^PSRX(IEN,"P",0)) S ^TMP($J,LIST,DFN,IEN,"P",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",103,0)
 F PT=0:0 S PT=$O(^PSRX(IEN,"P",PT)) Q:'PT  S DA(52.2)=PT D PTP
"RTN","PSO52API",104,0)
 K DA,DR,PST,DIC,DIQ,PT
"RTN","PSO52API",105,0)
 Q
"RTN","PSO52API",106,0)
PTP S ^TMP($J,LIST,DFN,IEN,"P",0)=$G(^TMP($J,LIST,DFN,IEN,"P",0))+1
"RTN","PSO52API",107,0)
 K PST S DR(52.2)=".01:8",DIC=52,DA=IEN,DR=60 D DIQ
"RTN","PSO52API",108,0)
 F DR=.01,.02,.03,.04,.05,.06,.08,.09,.041,.042,1,5,6,8 D
"RTN","PSO52API",109,0)
 .I PST(52.2,DA(52.2),DR,"E")'=PST(52.2,DA(52.2),DR,"I") S ^TMP($J,LIST,DFN,IEN,"P",DA(52.2),DR)=PST(52.2,DA(52.2),DR,"I")_"^"_PST(52.2,DA(52.2),DR,"E") Q
"RTN","PSO52API",110,0)
 .S ^TMP($J,LIST,DFN,IEN,"P",DA(52.2),DR)=PST(52.2,DA(52.2),DR,"I")
"RTN","PSO52API",111,0)
 Q
"RTN","PSO52API",112,0)
IB ;ib ori
"RTN","PSO52API",113,0)
 I $P($G(DAT),"^",2)="R" D IBR Q
"RTN","PSO52API",114,0)
 I $G(^PSRX(IEN,"IB"))']"" S ^TMP($J,LIST,DFN,IEN,"IB",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",115,0)
 K PST S DIC=52,DA=IEN,DR="105;106;106.5;106.6" D DIQ
"RTN","PSO52API",116,0)
 F DR=105,106,106.5,106.6 D
"RTN","PSO52API",117,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",118,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"E")
"RTN","PSO52API",119,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",120,0)
 I $P($G(DAT),"^",2)="" D IBR Q
"RTN","PSO52API",121,0)
 Q
"RTN","PSO52API",122,0)
IBR ;ib ref
"RTN","PSO52API",123,0)
 I '$O(^PSRX(IEN,1,0)) S ^TMP($J,LIST,DFN,IEN,"IB",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",124,0)
 I $P($G(DAT),"^",2)="R",$P($G(DAT),"^",3) S DA(52.1)=$P(DAT,"^",3) D IBS K DA,DR,PST,DIC,DIQ Q
"RTN","PSO52API",125,0)
 F IB=0:0 S IB=$O(^PSRX(IEN,1,IB)) Q:'IB  S DA(52.1)=IB D IBS
"RTN","PSO52API",126,0)
 I '$G(^TMP($J,LIST,DFN,IEN,"IB",0)) K ^TMP($J,LIST,DFN,IEN,"IB") S ^TMP($J,LIST,DFN,IEN,"IB",0)="-1^NO DATA FOUND"
"RTN","PSO52API",127,0)
 K DA,DR,PST,DIC,DIQ,IB
"RTN","PSO52API",128,0)
 Q
"RTN","PSO52API",129,0)
IBS I $P($G(DAT),"^",3),'$G(^PSRX(IEN,1,DA(52.1),"IB")) S ^TMP($J,LIST,DFN,IEN,"IB",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",130,0)
 I '$D(^PSRX(IEN,1,DA(52.1),"IB")) S ^TMP($J,LIST,DFN,IEN,"IB",DA(52.1),0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",131,0)
 K PST S DR(52.1)="9;9.1",DIC=52,DA=IEN,DR=52 D DIQ
"RTN","PSO52API",132,0)
 S ^TMP($J,LIST,DFN,IEN,"IB",0)=$G(^TMP($J,LIST,DFN,IEN,"IB",0))+1
"RTN","PSO52API",133,0)
 F DR=9,9.1 D
"RTN","PSO52API",134,0)
 .I PST(52.1,DA(52.1),DR,"E")'=PST(52.1,DA(52.1),DR,"I") S ^TMP($J,LIST,DFN,IEN,"IB",DA(52.1),DR)=PST(52.1,DA(52.1),DR,"I")_"^"_PST(52.1,DA(52.1),DR,"E") Q
"RTN","PSO52API",135,0)
 .S ^TMP($J,LIST,DFN,IEN,"IB",DA(52.1),DR)=PST(52.1,DA(52.1),DR,"I")
"RTN","PSO52API",136,0)
 Q
"RTN","PSO52API",137,0)
CM ;cmop
"RTN","PSO52API",138,0)
 I '$O(^PSRX(IEN,4,0)) S ^TMP($J,LIST,DFN,IEN,"C",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",139,0)
 F CM=0:0 S CM=$O(^PSRX(IEN,4,CM)) Q:'CM  S DA(52.01)=CM D CMP
"RTN","PSO52API",140,0)
 K DA,DR,PST,DIC,DIQ,CM
"RTN","PSO52API",141,0)
 Q
"RTN","PSO52API",142,0)
CMP S ^TMP($J,LIST,DFN,IEN,"C",0)=$G(^TMP($J,LIST,DFN,IEN,"C",0))+1
"RTN","PSO52API",143,0)
 K PST S DR(52.01)="2;3;4",DIC=52,DA=IEN,DR=400 D DIQ
"RTN","PSO52API",144,0)
 F DR=2,3,4 D
"RTN","PSO52API",145,0)
 .I PST(52.01,DA(52.01),DR,"E")'=PST(52.01,DA(52.01),DR,"I") S ^TMP($J,LIST,DFN,IEN,"C",DA(52.01),DR)=PST(52.01,DA(52.01),DR,"I")_"^"_PST(52.01,DA(52.01),DR,"E") Q
"RTN","PSO52API",146,0)
 .S ^TMP($J,LIST,DFN,IEN,"C",DA(52.01),DR)=PST(52.01,DA(52.01),DR,"I")
"RTN","PSO52API",147,0)
 Q
"RTN","PSO52API",148,0)
AT ;activity log
"RTN","PSO52API",149,0)
 I '$O(^PSRX(IEN,"A",0)) S ^TMP($J,LIST,DFN,IEN,"A",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",150,0)
 F AT=0:0 S AT=$O(^PSRX(IEN,"A",AT)) Q:'AT  S DA(52.3)=AT D ATP
"RTN","PSO52API",151,0)
 K DA,DR,PST,DIC,DIQ,AT
"RTN","PSO52API",152,0)
 Q
"RTN","PSO52API",153,0)
ATP K PST S DR(52.3)=".01;.02;.03;.04;.05" S DIC=52,DA=IEN,DR=40 D DIQ
"RTN","PSO52API",154,0)
 S ^TMP($J,LIST,DFN,IEN,"A",0)=$G(^TMP($J,LIST,DFN,IEN,"A",0))+1
"RTN","PSO52API",155,0)
 F DR=.01,.02,.03,.04,.05 D
"RTN","PSO52API",156,0)
 .I DR=.04 S ^TMP($J,LIST,DFN,IEN,"A",DA(52.3),DR)=PST(52.3,DA(52.3),DR,"E") Q
"RTN","PSO52API",157,0)
 .I PST(52.3,DA(52.3),DR,"E")'=PST(52.3,DA(52.3),DR,"I") S ^TMP($J,LIST,DFN,IEN,"A",DA(52.3),DR)=PST(52.3,DA(52.3),DR,"I")_"^"_PST(52.3,DA(52.3),DR,"E") Q
"RTN","PSO52API",158,0)
 .S ^TMP($J,LIST,DFN,IEN,"A",DA(52.3),DR)=PST(52.3,DA(52.3),DR,"I")
"RTN","PSO52API",159,0)
 Q
"RTN","PSO52API",160,0)
LB ;label log
"RTN","PSO52API",161,0)
 I '$O(^PSRX(IEN,"L",0)) S ^TMP($J,LIST,DFN,IEN,"L",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",162,0)
 F LB=0:0 S LB=$O(^PSRX(IEN,"L",LB)) Q:'LB  S DA(52.032)=LB D LBP
"RTN","PSO52API",163,0)
 K DA,DR,PST,DIC,DIQ,LB
"RTN","PSO52API",164,0)
 Q
"RTN","PSO52API",165,0)
LBP S ^TMP($J,LIST,DFN,IEN,"L",0)=$G(^TMP($J,LIST,DFN,IEN,"L",0))+1
"RTN","PSO52API",166,0)
 K PST S DR(52.032)=".01;1;2;3;4" S DIC=52,DA=IEN,DR=32 D DIQ
"RTN","PSO52API",167,0)
 F DR=.01,1,2,3,4 D
"RTN","PSO52API",168,0)
 .I DR=1 S ^TMP($J,LIST,DFN,IEN,"L",DA(52.032),DR)=PST(52.032,DA(52.032),DR,"E") Q
"RTN","PSO52API",169,0)
 .I PST(52.032,DA(52.032),DR,"E")'=PST(52.032,DA(52.032),DR,"I") S ^TMP($J,LIST,DFN,IEN,"L",DA(52.032),DR)=PST(52.032,DA(52.032),DR,"I")_"^"_PST(52.032,DA(52.032),DR,"E") Q
"RTN","PSO52API",170,0)
 .S ^TMP($J,LIST,DFN,IEN,"L",DA(52.032),DR)=PST(52.032,DA(52.032),DR,"I")
"RTN","PSO52API",171,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",172,0)
 Q
"RTN","PSO52API",173,0)
SD ;sand
"RTN","PSO52API",174,0)
 K PST S DIC=52,DA=IEN,DR="301;302;303" D DIQ F DR=301,302,303 D
"RTN","PSO52API",175,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",176,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")
"RTN","PSO52API",177,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",178,0)
 Q
"RTN","PSO52API",179,0)
TB ;tpb
"RTN","PSO52API",180,0)
 K PST S DIC=52,DA=IEN,DR=201 D DIQ
"RTN","PSO52API",181,0)
 I $G(PST(52,DA,DR,"E"))']"" S ^TMP($J,LIST,DFN,DA,DR)="" Q
"RTN","PSO52API",182,0)
 S ^TMP($J,LIST,DFN,DA,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E")
"RTN","PSO52API",183,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",184,0)
 Q
"RTN","PSO52API",185,0)
OI ;orderable item
"RTN","PSO52API",186,0)
 K PST S DIC=52,DA=IEN,DR=39.2 D DIQ
"RTN","PSO52API",187,0)
 I $G(PST(52,DA,DR,"I"))']"" S ^TMP($J,LIST,DFN,DA,"OI")="-1^NO DATA FOUND" Q
"RTN","PSO52API",188,0)
 S ^TMP($J,LIST,DFN,DA,"OI",DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E")
"RTN","PSO52API",189,0)
 S DIC=50.7,DA=PST(52,DA,DR,"I"),DR=.02,DIQ(0)="IE"  D DIQ
"RTN","PSO52API",190,0)
 S ^TMP($J,LIST,DFN,IEN,"OI",39.2)=^TMP($J,LIST,DFN,IEN,"OI",39.2)_"^"_PST(50.7,DA,DR,"I")_"^"_PST(50.7,DA,DR,"E")
"RTN","PSO52API",191,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",192,0)
 Q
"RTN","PSO52API",193,0)
DATE ;date range
"RTN","PSO52API",194,0)
 I $G(SDATE) S DTE=SDATE-1 D  Q
"RTN","PSO52API",195,0)
 .I $G(EDATE) D  Q
"RTN","PSO52API",196,0)
 ..F  S DTE=$O(^PS(55,DFN,"P","A",DTE)) Q:'DTE!(DTE>EDATE)  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DTE,IEN)) Q:'IEN  D:$P($G(^PSRX(IEN,"STA")),"^")'=13 PROCESS
"RTN","PSO52API",197,0)
 .F  S STE=$O(^PS(55,DFN,"P","A",DTE)) Q:'DTE  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DTE,IEN)) Q:'IEN  D:$P($G(^PSRX(IEN,"STA")),"^")'=13 PROCESS
"RTN","PSO52API",198,0)
 I $G(EDATE),'$G(SDATE) S DTE=DT-1 D  Q
"RTN","PSO52API",199,0)
 .F  S DTE=$O(^PS(55,DFN,"P","A",DTE)) Q:'DTE!(DTE>EDATE)  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DTE,IEN)) Q:'IEN  D:$P($G(^PSRX(IEN,"STA")),"^")'=13 PROCESS
"RTN","PSO52API",200,0)
 S DTE=DT-1  F  S DTE=$O(^PS(55,DFN,"P","A",DTE)) Q:'DTE  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DTE,IEN)) Q:'IEN  D:$P($G(^PSRX(IEN,"STA")),"^")'=13 PROCESS
"RTN","PSO52API",201,0)
 Q
"RTN","PSO52API",202,0)
PROF(DFN,LIST,SDATE,EDATE) ;
"RTN","PSO52API",203,0)
 D ^PSO52AP1
"RTN","PSO52API",204,0)
 Q
"RTN","PSO52API",205,0)
DIQ ;process fields
"RTN","PSO52API",206,0)
 S DIQ="PST",DIQ(0)="IE" D EN^DIQ1
"RTN","PSO52API",207,0)
 Q
"RTN","PSO59")
0^2^B3433876
"RTN","PSO59",1,0)
PSO59 ;BHM/DB - Outpatient Site File API ;1 JUL 05
"RTN","PSO59",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**213,229**;DEC 1997
"RTN","PSO59",3,0)
PSS(PSOIEN,PSOTXT,LIST) ;
"RTN","PSO59",4,0)
 N DA,DIC,DIQ,DR,X,I
"RTN","PSO59",5,0)
 I $G(PSOIEN)="",$G(PSOTXT)="" Q
"RTN","PSO59",6,0)
 I $G(LIST)="" Q
"RTN","PSO59",7,0)
 K ^TMP($J,LIST) S:$G(PSOIEN)>0 ^TMP($J,LIST,PSOIEN,0)=0
"RTN","PSO59",8,0)
 I $G(PSOIEN)>0,'$D(^PS(59,PSOIEN,0)) S ^TMP($J,LIST,PSOIEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO59",9,0)
 I $G(PSOTXT)'="",'$D(^PS(59,"B",PSOTXT)),$G(PSOIEN)>0 S ^TMP($J,LIST,PSOIEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO59",10,0)
 S DA=$S($G(PSOIEN)]"":PSOIEN,1:$O(^PS(59,"B",PSOTXT,0)))
"RTN","PSO59",11,0)
 I $G(DA)'>0 S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSO59",12,0)
 K ^UTILITY("DIQ1",$J),DIC S DIC=59,DR=".01;.02;.05;.06;.07;.08;1;100;1003",DIQ(0)="IE" D EN^DIQ1
"RTN","PSO59",13,0)
 I '$D(^UTILITY("DIQ1",$J)) S ^TMP($J,LIST,PSOIEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO59",14,0)
 F X=.01,.02,.05,.06,.07,.08,1,100,1003 D
"RTN","PSO59",15,0)
 .I $G(^UTILITY("DIQ1",$J,59,DA,X,"I"))'=$G(^UTILITY("DIQ1",$J,59,DA,X,"E")) S ^TMP($J,LIST,DA,X)=$G(^UTILITY("DIQ1",$J,59,DA,X,"I"))_"^"_$G(^UTILITY("DIQ1",$J,59,DA,X,"E")) Q
"RTN","PSO59",16,0)
 .S ^TMP($J,LIST,DA,X)=$G(^UTILITY("DIQ1",$J,59,DA,X,"I"))
"RTN","PSO59",17,0)
 S PSOTXT=$G(^UTILITY("DIQ1",$J,59,DA,.01,"E")) S ^TMP($J,LIST,"B",PSOTXT,DA)=""
"RTN","PSO59",18,0)
 S ^TMP($J,LIST,DA,0)=$G(^TMP($J,LIST,DA,0))+1
"RTN","PSO59",19,0)
 K DA,DIC,DIQ,DR,PSOIEN,PSOTXT
"RTN","PSO59",20,0)
 Q
"VER")
8.0^22.0
"BLD",5954,6)
^203
**END**
**END**
