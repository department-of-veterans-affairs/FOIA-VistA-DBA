Released PSO*7*263 SEQ #232
Extracted from mail message
**KIDS**:PSO*7.0*263^

**INSTALL NAME**
PSO*7.0*263
"BLD",7192,0)
PSO*7.0*263^OUTPATIENT PHARMACY^0^3070222^y
"BLD",7192,1,0)
^^15^15^3070222^^^^
"BLD",7192,1,1,0)
This patch will correct the following issues.
"BLD",7192,1,2,0)
 
"BLD",7192,1,3,0)
Problem:  HD15266
"BLD",7192,1,4,0)
------------------
"BLD",7192,1,5,0)
An undefined error occurs when a single character is entered in the 
"BLD",7192,1,6,0)
PSO RESET COPAY option.
"BLD",7192,1,7,0)
 
"BLD",7192,1,8,0)
Problem:  HD151887
"BLD",7192,1,9,0)
------------------
"BLD",7192,1,10,0)
the EDIT PROVIDER option does not allow editing of SERVICE/SECTION or 
"BLD",7192,1,11,0)
PERSON CLASS for Fee Basis providers.
"BLD",7192,1,12,0)
 
"BLD",7192,1,13,0)
Problem:  HD158732
"BLD",7192,1,14,0)
------------------
"BLD",7192,1,15,0)
There is a discrepancy between fields in EDIT PROVIDER and VIEW PROVIDER.
"BLD",7192,4,0)
^9.64PA^^
"BLD",7192,6)
2^
"BLD",7192,6.3)
11
"BLD",7192,"KRN",0)
^9.67PA^8989.52^19
"BLD",7192,"KRN",.4,0)
.4
"BLD",7192,"KRN",.401,0)
.401
"BLD",7192,"KRN",.402,0)
.402
"BLD",7192,"KRN",.403,0)
.403
"BLD",7192,"KRN",.5,0)
.5
"BLD",7192,"KRN",.84,0)
.84
"BLD",7192,"KRN",3.6,0)
3.6
"BLD",7192,"KRN",3.8,0)
3.8
"BLD",7192,"KRN",9.2,0)
9.2
"BLD",7192,"KRN",9.8,0)
9.8
"BLD",7192,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7192,"KRN",9.8,"NM",1,0)
PSOPRVW^^0^B34650289
"BLD",7192,"KRN",9.8,"NM",2,0)
PSOCPB^^0^B83583392
"BLD",7192,"KRN",9.8,"NM","B","PSOCPB",2)

"BLD",7192,"KRN",9.8,"NM","B","PSOPRVW",1)

"BLD",7192,"KRN",19,0)
19
"BLD",7192,"KRN",19,"NM",0)
^9.68A^^
"BLD",7192,"KRN",19.1,0)
19.1
"BLD",7192,"KRN",101,0)
101
"BLD",7192,"KRN",409.61,0)
409.61
"BLD",7192,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",7192,"KRN",771,0)
771
"BLD",7192,"KRN",870,0)
870
"BLD",7192,"KRN",8989.51,0)
8989.51
"BLD",7192,"KRN",8989.52,0)
8989.52
"BLD",7192,"KRN",8994,0)
8994
"BLD",7192,"KRN","B",.4,.4)

"BLD",7192,"KRN","B",.401,.401)

"BLD",7192,"KRN","B",.402,.402)

"BLD",7192,"KRN","B",.403,.403)

"BLD",7192,"KRN","B",.5,.5)

"BLD",7192,"KRN","B",.84,.84)

"BLD",7192,"KRN","B",3.6,3.6)

"BLD",7192,"KRN","B",3.8,3.8)

"BLD",7192,"KRN","B",9.2,9.2)

"BLD",7192,"KRN","B",9.8,9.8)

"BLD",7192,"KRN","B",19,19)

"BLD",7192,"KRN","B",19.1,19.1)

"BLD",7192,"KRN","B",101,101)

"BLD",7192,"KRN","B",409.61,409.61)

"BLD",7192,"KRN","B",771,771)

"BLD",7192,"KRN","B",870,870)

"BLD",7192,"KRN","B",8989.51,8989.51)

"BLD",7192,"KRN","B",8989.52,8989.52)

"BLD",7192,"KRN","B",8994,8994)

"BLD",7192,"QUES",0)
^9.62^^
"BLD",7192,"REQB",0)
^9.611^2^2
"BLD",7192,"REQB",1,0)
PSO*7.0*153^2
"BLD",7192,"REQB",2,0)
PSO*7.0*201^2
"BLD",7192,"REQB","B","PSO*7.0*153",1)

"BLD",7192,"REQB","B","PSO*7.0*201",2)

"MBREQ")
0
"PKG",134,-1)
1^1
"PKG",134,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",134,20,0)
^9.402P^^
"PKG",134,22,0)
^9.49I^1^1
"PKG",134,22,1,0)
7.0^2971216^2980417^1271
"PKG",134,22,1,"PAH",1,0)
263^3070222^33288
"PKG",134,22,1,"PAH",1,1,0)
^^15^15^3070222
"PKG",134,22,1,"PAH",1,1,1,0)
This patch will correct the following issues.
"PKG",134,22,1,"PAH",1,1,2,0)
 
"PKG",134,22,1,"PAH",1,1,3,0)
Problem:  HD15266
"PKG",134,22,1,"PAH",1,1,4,0)
------------------
"PKG",134,22,1,"PAH",1,1,5,0)
An undefined error occurs when a single character is entered in the 
"PKG",134,22,1,"PAH",1,1,6,0)
PSO RESET COPAY option.
"PKG",134,22,1,"PAH",1,1,7,0)
 
"PKG",134,22,1,"PAH",1,1,8,0)
Problem:  HD151887
"PKG",134,22,1,"PAH",1,1,9,0)
------------------
"PKG",134,22,1,"PAH",1,1,10,0)
the EDIT PROVIDER option does not allow editing of SERVICE/SECTION or 
"PKG",134,22,1,"PAH",1,1,11,0)
PERSON CLASS for Fee Basis providers.
"PKG",134,22,1,"PAH",1,1,12,0)
 
"PKG",134,22,1,"PAH",1,1,13,0)
Problem:  HD158732
"PKG",134,22,1,"PAH",1,1,14,0)
------------------
"PKG",134,22,1,"PAH",1,1,15,0)
There is a discrepancy between fields in EDIT PROVIDER and VIEW PROVIDER.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSOCPB")
0^2^B83583392^B83592265
"RTN","PSOCPB",1,0)
PSOCPB ;BIR/BaB - pharmacy co-pay application cont'd ; 1/30/07 9:08am
"RTN","PSOCPB",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**72,71,85,185,143,219,239,201,263**;DEC 1997;Build 11
"RTN","PSOCPB",3,0)
 ;
"RTN","PSOCPB",4,0)
 ;REF/IA
"RTN","PSOCPB",5,0)
 ;DIS^SDROUT2/112
"RTN","PSOCPB",6,0)
 ;^IBARX/125
"RTN","PSOCPB",7,0)
 ;VADPT/10061
"RTN","PSOCPB",8,0)
 ;SWSTAT^IBBAPI/4663
"RTN","PSOCPB",9,0)
COPAY ;
"RTN","PSOCPB",10,0)
 ;Called by PSON52,PSORN52...Requires PSOCPAY,PSOBILL,DEA=PSDEA,PSOFLAG
"RTN","PSOCPB",11,0)
 ;PSOFLAG=1 NEW, PSOFLAG=0 RENEW
"RTN","PSOCPB",12,0)
 S PSOSAVE=PSOCPAY ; Save original status of PSOCPAY
"RTN","PSOCPB",13,0)
 I '$G(PSOSCP)!('$G(PSOSCA)) D SCP^PSORN52D  ;CIDC-must ask sc if flagged for it in enrollment
"RTN","PSOCPB",14,0)
 I $G(PSODRUG("DEA"))["S"!($G(PSODRUG("DEA"))["I") S PSOCPAY=0
"RTN","PSOCPB",15,0)
 G:+PSOBILL'=2&('$G(PSOSCA)) COPAY2
"RTN","PSOCPB",16,0)
 D FULL^VALM1
"RTN","PSOCPB",17,0)
 I $G(PSOMESOI)=1,$G(PSORXED) W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESOI=2
"RTN","PSOCPB",18,0)
 I $G(PSOMESFI)=1 W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESFI=2
"RTN","PSOCPB",19,0)
 S DFN=+$G(PSODFN) D DIS^SDROUT2
"RTN","PSOCPB",20,0)
ASK ;
"RTN","PSOCPB",21,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOCPB",22,0)
 K PSOCPZ("DFLG"),PSONEW("NEWCOPAY")
"RTN","PSOCPB",23,0)
 W ! K DIR,DTOUT,DIRUT,DUOUT
"RTN","PSOCPB",24,0)
 I $G(PSORX("SC"))="SC"!($G(PSORX("SC"))="NSC")!($G(PSOSCOTH)) D
"RTN","PSOCPB",25,0)
 . W:PSOSCP<50&($G(PSODRUG("DEA"))'["S")&($G(PSODRUG("DEA"))'["I") !,"This Rx has been flagged by the provider as: "_$S($G(PSOSCOTH):"NO COPAY",$G(PSORX("SC"))="SC":"NO COPAY",1:"COPAY"),! I $G(PSOSCOTX) S PSOSCOTX=2
"RTN","PSOCPB",26,0)
 S DIR("A")="Was treatment for Service Connected condition",DIR(0)="Y"
"RTN","PSOCPB",27,0)
 S DIR("?")="Enter 'Yes' if this prescription is for a Service Connected condition"
"RTN","PSOCPB",28,0)
 I $G(PSORX("SC"))]""!($G(PSORX(+$G(PSORENW("OIRXN")),"SC"))'="") S DIR("B")=$S($G(PSORX("SC"))="SC":"YES",$G(PSORX("SC"))="NSC":"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=1:"YES",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=0:"NO",1:"")
"RTN","PSOCPB",29,0)
 I $G(PSONEWFF),$G(PSOFLAG) I $G(PSOANSQD("SC"))=0!($G(PSOANSQD("SC"))=1) S DIR("B")=$S($G(PSOANSQD("SC"))=1:"YES",1:"NO")
"RTN","PSOCPB",30,0)
 I $G(DIR("B"))="YES"!($G(DIR("B"))="NO") S PSOUFLAG=$G(DIR("B"))
"RTN","PSOCPB",31,0)
 I $G(DIR("B"))="" K DIR("B")
"RTN","PSOCPB",32,0)
 D ^DIR
"RTN","PSOCPB",33,0)
 I $G(Y)=1!($G(Y)=0) S PSOANSQ("SC")=$G(Y) I $G(PSONEWFF),$G(PSOFLAG) S PSOANSQD("SC")=$G(Y)
"RTN","PSOCPB",34,0)
 I PSOFLAG I Y["^"!($D(DTOUT))!($D(DUOUT)) S PSOCPZ("DFLG")=1
"RTN","PSOCPB",35,0)
 S:Y=0 Y=2
"RTN","PSOCPB",36,0)
 S PSOANSR=+Y I 'PSOANSR,'PSOFLAG D  S $P(PSOCPAY,"^")=$S($G(PSOUFLAG)="NO":1,1:0) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR G COPAY2
"RTN","PSOCPB",37,0)
 .W !!,"This Renewal has been designated as "_$S($G(PSOUFLAG)="YES":"SERVICE CONNECTED",1:"NON-SERVICE CONNECTED.")
"RTN","PSOCPB",38,0)
 .W:PSOSCP<50&($G(PSODRUG("DEA"))'["S")&($G(PSODRUG("DEA"))'["I") !,"Please use the 'Reset Copay Status/Cancel Charges' option to make corrections."
"RTN","PSOCPB",39,0)
 .S PSOANSQ("SC")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOCPB",40,0)
 I $G(PSOFLAG),$G(PSOCPZ("DFLG")) G EXIT
"RTN","PSOCPB",41,0)
 S:PSOANSR=1 PSOCPAY=0 S:PSOANSR=2 $P(PSOCPAY,"^")=1
"RTN","PSOCPB",42,0)
COPAY2 ;
"RTN","PSOCPB",43,0)
 N PSOPFS S PSOPFS=$$SWSTAT^IBBAPI()
"RTN","PSOCPB",44,0)
 I +PSOCPAY=1,($P(PSOCPAY,"^",2)=1)!($P(PSOCPAY,"^",2)=2) D
"RTN","PSOCPB",45,0)
 .;set IB node in ^PSRX for copay if xactn type is 1 or 2
"RTN","PSOCPB",46,0)
 .S PSONEW("NEWCOPAY")=$P($G(PSOCPAY),"^",2)_"^^"_$S(+$G(PSOPFS):"",1:$P($G(PSOCPAY),"^",2))
"RTN","PSOCPB",47,0)
EXIT ;
"RTN","PSOCPB",48,0)
 S PSOCPAY=PSOSAVE ;Restore val of PSOCPAY
"RTN","PSOCPB",49,0)
 K PSOSAVE,PSOANSR,DIR,DUOUT,DIRUT,DTOUT,Y,X
"RTN","PSOCPB",50,0)
 Q
"RTN","PSOCPB",51,0)
RESET ;RESET COPAY STATUS
"RTN","PSOCPB",52,0)
 K PSOSUMM,PSOPFS,PSOPFSA,PSOLFIL,PSOPFSG
"RTN","PSOCPB",53,0)
 I '$D(PSOPAR) D ^PSOLSET G RESET
"RTN","PSOCPB",54,0)
 W ! S DIC="^PSRX(",DIC(0)="AEQZ" D ^DIC K DIC G:Y<0 EXT S PSODA=+Y
"RTN","PSOCPB",55,0)
 W !,?17,"PATIENT: ",$P($G(^DPT($P(^PSRX(PSODA,0),"^",2),0)),"^")
"RTN","PSOCPB",56,0)
 D ICN^PSODPT($P(^PSRX(PSODA,0),"^",2))
"RTN","PSOCPB",57,0)
 S PSORXN=$P(^PSRX(PSODA,0),"^"),PREA="R"
"RTN","PSOCPB",58,0)
 S PCOPAY=$G(^PSRX(PSODA,"IB"))
"RTN","PSOCPB",59,0)
 W !!,"Rx # ",PSORXN," is a ",$S(+PCOPAY:"Copay",1:"No Copay")," prescription"
"RTN","PSOCPB",60,0)
 S PSOLFIL=$$LF^PSOPFSU1(PSODA) D PFSA^PSOPFSU1(PSODA,PSOLFIL,3)  ;PSOCPC def PSOPFSA=1 if OP SC/EI's change.
"RTN","PSOCPB",61,0)
 D EXEMCHK^PSOCPC ; CHECK/CHANGE EXEMPTION FLAGS
"RTN","PSOCPB",62,0)
 S PSOIBQ=$G(^PSRX(PSODA,"IBQ"))
"RTN","PSOCPB",63,0)
 I '$G(^PSRX(PSODA,"IB")),PSOIBQ'["1" D  G ASKCAN
"RTN","PSOCPB",64,0)
 . K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Do you want to reset the status to COPAY" D ^DIR K DIR
"RTN","PSOCPB",65,0)
 . I Y'=1 Q
"RTN","PSOCPB",66,0)
 . S DIC="^IBE(350.3,",DIC("S")="I $P(^(0),U,3)'=2",DIC(0)="AEQMZ",DIC("A")="Select Reason for Reset : " D ^DIC K DIC I Y'<0 S PSORSN=+Y
"RTN","PSOCPB",67,0)
 . S PREA="R",PSOOLD="No Copay",PSONW="Copay",PSOCOMM="" D ACTLOG^PSOCPA
"RTN","PSOCPB",68,0)
 . S PSI=0,PSOCOMM="Copay status of this Rx has been reset to COPAY." D SETSUMM^PSOCPC
"RTN","PSOCPB",69,0)
 . S $P(^PSRX(PSODA,"IB"),"^")=1 ;Reset flag to COPAY
"RTN","PSOCPB",70,0)
 ;
"RTN","PSOCPB",71,0)
 I $G(^PSRX(PSODA,"IB")) D  G ASKCAN
"RTN","PSOCPB",72,0)
 . K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Do you want to reset the status to NO COPAYMENT" D ^DIR K DIR
"RTN","PSOCPB",73,0)
 . I Y'=1 Q
"RTN","PSOCPB",74,0)
 . S DIC="^IBE(350.3,",DIC("S")="I $P(^(0),U,3)'=2",DIC(0)="AEQMZ",DIC("A")="Select Reason for Reset : " D ^DIC K DIC I Y'<0 S PSORSN=+Y
"RTN","PSOCPB",75,0)
 . S PREA="R",PSOOLD="Copay",PSONW="No Copay",PSOCOMM="" D ACTLOG^PSOCPA
"RTN","PSOCPB",76,0)
 . S PSI=0,PSOCOMM="Copay status of this Rx has been reset to NO COPAY." D SETSUMM^PSOCPC
"RTN","PSOCPB",77,0)
 . S $P(^PSRX(PSODA,"IB"),"^")="" ;Reset flag to NO COPAY
"RTN","PSOCPB",78,0)
ASKCAN D ASKCAN^PSOCPD
"RTN","PSOCPB",79,0)
 I '$D(PSOSUMM) S PSI=0,PSOCOMM="No action taken" D SETSUMM^PSOCPC
"RTN","PSOCPB",80,0)
 D PRTSUMM
"RTN","PSOCPB",81,0)
 I $P($G(PSOPFS),"^",3)>0&(+$G(PSOPFSA)) D CHRG^PSOPFSU1(PSODA,PSOLFIL,"CG",PSOPFS)
"RTN","PSOCPB",82,0)
RESETE K PSODA,PSORXN,PSORSN,PSOREF,X,Y,PCOPAY,PREA,PSOCOMM,PSI
"RTN","PSOCPB",83,0)
 G RESET
"RTN","PSOCPB",84,0)
EXT K PSODA,PSORXN,PSORSN,PSOREF,X,Y,PCOPAY,PREA,PSOCOPAY
"RTN","PSOCPB",85,0)
 Q
"RTN","PSOCPB",86,0)
BILLED ;Collect IB nums,cancel chrgs,reset flag.
"RTN","PSOCPB",87,0)
 W !!,"**********Charges are on file for this Rx.**********"
"RTN","PSOCPB",88,0)
 Q
"RTN","PSOCPB",89,0)
BILL2 ;
"RTN","PSOCPB",90,0)
 N PSOPREV ; VAR FOR PREV CANCELLED
"RTN","PSOCPB",91,0)
 S PSOPREV=0
"RTN","PSOCPB",92,0)
 S DIC="^IBE(350.3,",DIC("S")="I $P(^(0),U,3)'=2",DIC(0)="AEQMZ",DIC("A")="Select Reason for Reset or Charge Cancellation : " D ^DIC K DIC G ENDMSG:Y<0 S PSORSN=+Y
"RTN","PSOCPB",93,0)
 S X=PSOPAR7_"^"_+$P(^PSRX(PSODA,0),"^",2)_"^^"_DUZ
"RTN","PSOCPB",94,0)
 S SAVX=X
"RTN","PSOCPB",95,0)
 I $D(PSOCAN) D:'$G(PSOPFS)  I +$G(PSOPFS)!($G(PSOPFSG)) D PFS^PSOPFSU1 G BILL2END:'$D(PSOCAN)
"RTN","PSOCPB",96,0)
 . N III S III="" F  S III=$O(PSOCAN(III)) Q:III=""  I PSOCAN(III)["PFS" S PSOPFSG=1 Q  ;PFSS switch off, check for prev cots billing
"RTN","PSOCPB",97,0)
 D POTBILL2
"RTN","PSOCPB",98,0)
 I '$D(PSOCAN) G BILL2END
"RTN","PSOCPB",99,0)
 I $G(CANTYPE) D PREVCAN I $O(X(""))="" Q
"RTN","PSOCPB",100,0)
 I '$G(CANTYPE) S I="" F  S I=$O(PSOCAN(I)) Q:I=""  S X($P(PSOCAN(I),"^",1))=$P(PSOCAN(I),"^",2)_"^"_PSORSN
"RTN","PSOCPB",101,0)
 D CANCEL^IBARX
"RTN","PSOCPB",102,0)
 I $G(CANTYPE) D MSG
"RTN","PSOCPB",103,0)
 I '$D(Y) Q
"RTN","PSOCPB",104,0)
 I +Y=-1 Q
"RTN","PSOCPB",105,0)
 I $D(Y(PSORXN)),+Y(PSORXN)'=-1 S $P(^PSRX(PSODA,"IB"),"^",2)=+Y(PSORXN) K Y(PSORXN) S PREA="C",PSOREF=0,PSOOLD="",PSONW="" D ACTLOG^PSOCPA I '$G(CANTYPE) D MSG
"RTN","PSOCPB",106,0)
 F PSOREF=0:0 S PSOREF=$O(Y(PSOREF)) Q:PSOREF=""  I +Y(PSOREF)'=-1 S ^PSRX(PSODA,1,PSOREF,"IB")=+Y(PSOREF) S PREA="C",PSOOLD="",PSONW="" D ACTLOG^PSOCPA I '$G(CANTYPE) D MSG
"RTN","PSOCPB",107,0)
BILL2END K X,Y,SAVX,PSOREF,PSOCAN
"RTN","PSOCPB",108,0)
 Q
"RTN","PSOCPB",109,0)
 ;
"RTN","PSOCPB",110,0)
POTBILL2 ;see if any potential charges (entries from file 354.71 -- bills that exceeded cap prev) to be cancelled before cancelling regular charges
"RTN","PSOCPB",111,0)
 N X,I
"RTN","PSOCPB",112,0)
 S X=SAVX
"RTN","PSOCPB",113,0)
 I $T(CANIBAM^IBARX)="" Q
"RTN","PSOCPB",114,0)
 S I="" F  S I=$O(PSOCAN(I)) Q:I=""  I PSOCAN(I)["^CAP" S X($P(PSOCAN(I),"^",1))=$P(PSOCAN(I),"^",2)_"^"_PSORSN K PSOCAN(I)
"RTN","PSOCPB",115,0)
 I $O(X(""))="" Q
"RTN","PSOCPB",116,0)
 S PSOPREV=1
"RTN","PSOCPB",117,0)
 D CANIBAM^IBARX
"RTN","PSOCPB",118,0)
 I $D(X(PSORXN)) S $P(^PSRX(PSODA,"IB"),"^",4)="" S PREA="C",PSOREF=0,PSOCOMM="Potential charge cancelled",PSOOLD="",PSONW="" D ACTLOG^PSOCPA D POTMSG K X(PSORXN)
"RTN","PSOCPB",119,0)
 F PSOREF=0:0 S PSOREF=$O(X(PSOREF)) Q:PSOREF=""  Q:PSOREF>11  S $P(^PSRX(PSODA,1,PSOREF,"IB"),"^",2)="" S PREA="C",PSOCOMM="Potential charge cancelled",PSOOLD="",PSONW="" D ACTLOG^PSOCPA D POTMSG
"RTN","PSOCPB",120,0)
 K PSOREF,PREA,PSOCOMM
"RTN","PSOCPB",121,0)
 Q
"RTN","PSOCPB",122,0)
REFILL S PSOREF=0
"RTN","PSOCPB",123,0)
 F  S PSOREF=$O(^PSRX(PSODA,1,PSOREF)) Q:PSOREF'?1N.N  D
"RTN","PSOCPB",124,0)
 . I $D(^PSRX(PSODA,1,PSOREF,"PFS")) S:$P($G(^PSRX(PSODA,1,PSOREF,"PFS")),"^",2) X(PSOREF)="^"_$G(PSORSN) Q
"RTN","PSOCPB",125,0)
 . I $D(^PSRX(PSODA,1,PSOREF,"IB")),+^("IB")>0 S X(PSOREF)=+^PSRX(PSODA,1,PSOREF,"IB")_"^"_$G(PSORSN)
"RTN","PSOCPB",126,0)
 S PSOREF=0 F  S PSOREF=$O(^PSRX(PSODA,1,PSOREF)) Q:PSOREF'?1N.N  I '$D(X(PSOREF)),+$P($G(^PSRX(PSODA,1,PSOREF,"IB")),"^",2) S XX(PSOREF)=+$P(^PSRX(PSODA,1,PSOREF,"IB"),"^",2)_"^"_$G(PSORSN) ; IF ONLY ENTRY FROM 354.71 SAVE IT
"RTN","PSOCPB",127,0)
 Q
"RTN","PSOCPB",128,0)
SETCP ;IF NOT COPAY MAKE ELIG CALL/SET FLAG FOR FUTURE
"RTN","PSOCPB",129,0)
 W ! S X=PSOPAR7_"^"_+$P(^PSRX(PSODA,0),"^",2)
"RTN","PSOCPB",130,0)
 D XTYPE^IBARX
"RTN","PSOCPB",131,0)
 I +Y=-1 W !!,"Error in processing Copay eligibility, no action taken." Q
"RTN","PSOCPB",132,0)
 S (ACTYP,BL)="",(PSOBILL,PSOCPAY)=0
"RTN","PSOCPB",133,0)
CP ;
"RTN","PSOCPB",134,0)
 S ACTYP=$O(Y(ACTYP)) G:'ACTYP CP1
"RTN","PSOCPB",135,0)
 F I=0:0 S BL=$O(Y(ACTYP,BL)) Q:BL=""  I BL>0 S PSOBILL=BL,PSOCPAY=ACTYP
"RTN","PSOCPB",136,0)
 G CP
"RTN","PSOCPB",137,0)
CP1 K ACTYP,BL,I
"RTN","PSOCPB",138,0)
 I (PSOBILL'>0)!(PSOCPAY=0) G INELIG
"RTN","PSOCPB",139,0)
 S $P(^PSRX(PSODA,"IB"),"^")=PSOCPAY
"RTN","PSOCPB",140,0)
 W !,"COPAY status on this Rx has been reset.",!,"*** Future refills will be classified as COPAY."
"RTN","PSOCPB",141,0)
 S PREA="R",PSOOLD="No Copay",PSONW="Copay"
"RTN","PSOCPB",142,0)
 D ACTLOG^PSOCPA
"RTN","PSOCPB",143,0)
 Q
"RTN","PSOCPB",144,0)
INELIG W !,"This Rx does not meet patient eligibility requirement for Copay.",!,"****** Status unchanged *******"
"RTN","PSOCPB",145,0)
 S Y=-1
"RTN","PSOCPB",146,0)
 Q
"RTN","PSOCPB",147,0)
ENDMSG K X W !,"Unable to process CHARGE REMOVAL without REASON for Reset."
"RTN","PSOCPB",148,0)
 R !,"ENTER a REASON now?  (Y/N) ",X:DTIME Q:'$T
"RTN","PSOCPB",149,0)
 I ($E(X)["?")!("YyNn^"'[$E(X)) W !,"Enter YES to select REASON and RESET STATUS." G ENDMSG
"RTN","PSOCPB",150,0)
 I "Yy"[$E(X) G BILL2
"RTN","PSOCPB",151,0)
 Q
"RTN","PSOCPB",152,0)
MSG ;
"RTN","PSOCPB",153,0)
 S PSI=0
"RTN","PSOCPB",154,0)
 I $G(CANTYPE) S PSOCOMM="Rx # "_PSORXN_" - All copay charges cancelled" D SETSUMM^PSOCPC K PSOCOMM Q
"RTN","PSOCPB",155,0)
 S PSOCOMM="Rx # "_PSORXN_" - "_$S(PSOREF=0:"Original fill",1:"Refill "_PSOREF)_" copay charge cancelled"
"RTN","PSOCPB",156,0)
 D SETSUMM^PSOCPC
"RTN","PSOCPB",157,0)
 K PSOCOMM
"RTN","PSOCPB",158,0)
 Q
"RTN","PSOCPB",159,0)
POTMSG ;
"RTN","PSOCPB",160,0)
 S PSI=0
"RTN","PSOCPB",161,0)
 I $G(CANTYPE) Q  ; (MESSAGE WILL GET SET LATER)
"RTN","PSOCPB",162,0)
 S PSOCOMM="Rx # "_PSORXN_" - "_$S(PSOREF=0:"Original fill",1:"Refill "_PSOREF)_" potential copay charge cancelled"
"RTN","PSOCPB",163,0)
 D SETSUMM^PSOCPC
"RTN","PSOCPB",164,0)
 K PSOCOMM
"RTN","PSOCPB",165,0)
 Q
"RTN","PSOCPB",166,0)
MSGNOCAN ;
"RTN","PSOCPB",167,0)
 S PSI=0
"RTN","PSOCPB",168,0)
 S PSOCOMM="Rx # "_PSORXN_" - All copay charges have already been cancelled." D SETSUMM^PSOCPC K PSOCOMM
"RTN","PSOCPB",169,0)
 Q
"RTN","PSOCPB",170,0)
 ;
"RTN","PSOCPB",171,0)
PRTSUMM ; prt sum of actions in reset/cancel
"RTN","PSOCPB",172,0)
 I '$D(PSOSUMM) Q
"RTN","PSOCPB",173,0)
 W !
"RTN","PSOCPB",174,0)
 S PSI=""
"RTN","PSOCPB",175,0)
 F  S PSI=$O(PSOSUMM(PSI)) Q:PSI=""  W !,PSOSUMM(PSI)
"RTN","PSOCPB",176,0)
 K PSOSUMM
"RTN","PSOCPB",177,0)
 Q
"RTN","PSOCPB",178,0)
PREVCAN ; PREVIEW CANCELS IF "ALL" IS SELECTED
"RTN","PSOCPB",179,0)
 N I,PSOBILL
"RTN","PSOCPB",180,0)
 S I="" F  S I=$O(PSOCAN(I)) Q:I=""  D  I PSOBILL S X($P(PSOCAN(I),"^",1))=$P(PSOCAN(I),"^",2)_"^"_PSORSN
"RTN","PSOCPB",181,0)
 . S PSOBILL=1 I $T(STATUS^IBARX)'="" I PSOCAN(I)'["CAP" S PSOBILL=$$STATUS^IBARX($P(PSOCAN(I),"^",2)) S:PSOBILL=2 PSOBILL=0 ; PREVIOUSLY CANCELLED
"RTN","PSOCPB",182,0)
 I $O(X(""))="" D
"RTN","PSOCPB",183,0)
 . I PSOPREV D MSG Q
"RTN","PSOCPB",184,0)
 . D MSGNOCAN
"RTN","PSOCPB",185,0)
 Q
"RTN","PSOCPB",186,0)
 ;
"RTN","PSOPRVW")
0^1^B34650289^B32968618
"RTN","PSOPRVW",1,0)
PSOPRVW ;BIR/SAB,MHA-enter/edit/view provider ; 2/9/07 10:39am
"RTN","PSOPRVW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,146,153,263**;DEC 1997;Build 11
"RTN","PSOPRVW",3,0)
 ;Ref. to ^VA(200 supp. by IA 224
"RTN","PSOPRVW",4,0)
 ;Ref. to ^DIC(7 supp. by IA 491
"RTN","PSOPRVW",5,0)
START W ! S DIC("A")="Select Provider: ",DIC("S")="I $D(^VA(200,+Y,""PS""))",DIC="^VA(200,",DIC(0)="AEQMZ" D ^DIC G:"^"[X EX G:Y<0 START K DIC S PRNO=+Y
"RTN","PSOPRVW",6,0)
 W @IOF,"Name: "_$P(^VA(200,PRNO,0),"^")
"RTN","PSOPRVW",7,0)
 I +$P(^VA(200,PRNO,"PS"),"^",4),$P(^("PS"),"^",4)'>DT W ?40,$C(7),"* * * INACTIVE AS OF ",$E($P(^("PS"),"^",4),4,5),"/",$E($P(^("PS"),"^",4),6,7),"/",$E($P(^("PS"),"^",4),2,3)," * * *"
"RTN","PSOPRVW",8,0)
 ;W !,"SSN#: " S T=$S($P(^VA(200,PRNO,1),"^",9)]"":$P(^(1),"^",9),1:"") W:T $E(T,1,3),"-",$E(T,4,5),"-",$E(T,6,9)
"RTN","PSOPRVW",9,0)
 W !,"Initials: "_$P(^VA(200,PRNO,0),"^",2)
"RTN","PSOPRVW",10,0)
 W !,"NON-VA Prescriber: "
"RTN","PSOPRVW",11,0)
 I $P($G(^VA(200,PRNO,"TPB")),"^")]"" W $S($P(^("TPB"),"^"):"Yes",1:"No")
"RTN","PSOPRVW",12,0)
 W ?40,"Tax ID: "_$P($G(^VA(200,PRNO,"TPB")),"^",2)
"RTN","PSOPRVW",13,0)
 W !,"Exclusionary Check Performed: " I $P($G(^VA(200,PRNO,"TPB")),"^",3)]"" W $S($P(^("TPB"),"^",3):"Yes",1:"No")
"RTN","PSOPRVW",14,0)
 W ?40,"Date Exclusionary List Checked: "
"RTN","PSOPRVW",15,0)
 S Y=$P($G(^VA(200,PRNO,"TPB")),"^",4) I Y W $E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3)
"RTN","PSOPRVW",16,0)
 W !,"On Exclusionary List: " I $P($G(^VA(200,PRNO,"TPB")),"^",5)]"" W $S($P(^("TPB"),"^",5):"Yes",1:"No")
"RTN","PSOPRVW",17,0)
 W !,"Exclusionary Checked By: "
"RTN","PSOPRVW",18,0)
 I $P($G(^VA(200,PRNO,"TPB")),"^",6) W $P($G(^VA(200,$P(^("TPB"),"^",6),0)),"^")
"RTN","PSOPRVW",19,0)
 W !,"Authorized to Write Orders: "_$S($P(^VA(200,PRNO,"PS"),"^"):"Yes",1:"No"),!,"Requires Cosigner: "_$S($P(^("PS"),"^",7):"Yes",1:"No") I $P(^("PS"),"^",7),$D(^VA(200,+$P(^("PS"),"^",8),0)) W !,"Usual Cosigner: "_$P(^(0),"^")
"RTN","PSOPRVW",20,0)
 W !,"Class: " S PRCLS=+$P(^VA(200,PRNO,"PS"),"^",5),PRCLS=$S(PRCLS>0&$D(^DIC(7,PRCLS,0)):$P(^(0),"^"),1:"") W PRCLS
"RTN","PSOPRVW",21,0)
 W ?40,"DEA# "_$P(^VA(200,PRNO,"PS"),"^",2),!," Type: " S T=+$P(^("PS"),"^",6),L=$P(^DD(200,53.6,0),"^",3)_";"_T_":Unknown" F I=1:1 I $P($P(L,";",I),":",1)=T W $P($P(L,";",I),":",2) Q
"RTN","PSOPRVW",22,0)
 W ?40,"VA#  "_$P(^VA(200,PRNO,"PS"),"^",3),!,"Remarks: "_$P(^("PS"),"^",9),!,"Synonym(s):  "_$S($P($G(^VA(200,PRNO,.1)),"^",4)]"":$P(^(.1),"^",4)_",",1:"")_$S($P(^(0),"^",2)]"":" "_$P(^(0),"^",2),1:"")
"RTN","PSOPRVW",23,0)
 W !,"Service/Section: " S PSOSSDA=$G(DA) I $P($G(^VA(200,PRNO,5)),"^") K DIQ S DIC="^DIC(49,",DA=$P(^VA(200,PRNO,5),"^"),DR=.01,DIQ="PSOSECT",DIQ(0)="E" D EN^DIQ1 W $G(PSOSECT(49,DA,.01,"E")) S DA=$G(PSOSSDA) K DR,DIC,DIQ,PSOSSDA,PSOSECT
"RTN","PSOPRVW",24,0)
 I $TR($G(^VA(200,PRNO,.11)),"^","")="" G NUM
"RTN","PSOPRVW",25,0)
 W !!,"Address: ",?10,$P(^VA(200,PRNO,.11),"^") W:$P(^(.11),"^",2)'="" !?10,$P(^(.11),"^",2) W:$P(^(.11),"^",3)'="" !?10,$P(^(.11),"^",3)
"RTN","PSOPRVW",26,0)
 W !?10,$P(^VA(200,PRNO,.11),"^",4) W:$P(^(.11),"^",4)]"" ", " S STAT=+$P($G(^(.11)),"^",5) W $S($D(^DIC(5,STAT,0)):$P(^(0),"^"),1:"")_"  "_$P(^VA(200,PRNO,.11),"^",6)
"RTN","PSOPRVW",27,0)
NUM G:'$D(^VA(200,PRNO,.13)) START
"RTN","PSOPRVW",28,0)
 W !,"Phone:    "_$P(^VA(200,PRNO,.13),"^"),! W:$P(^(.13),"^",2)]"" "Office:   ",$P(^(.13),"^",2),!
"RTN","PSOPRVW",29,0)
 W:$P(^VA(200,PRNO,.13),"^",3)]"" "Phone #3: "_$P(^(.13),"^",3),?40 W:$P(^(.13),"^",7)]"" "Voice Pager  #: "_$P(^(.13),"^",7) W !
"RTN","PSOPRVW",30,0)
 W:$P(^VA(200,PRNO,.13),"^",4)]"" "Phone #4: "_$P(^(.13),"^",4),?40 W:$P(^(.13),"^",8)]"" "Digital Pager#: "_$P(^(.13),"^",8)
"RTN","PSOPRVW",31,0)
 W:$P(^VA(200,PRNO,.13),"^",6)]"" !,"Fax #:    "_$P(^(.13),"^",6)
"RTN","PSOPRVW",32,0)
 W:$P($G(^VA(200,PRNO,.14)),"^")]"" !,"Room Loc: "_$P(^(.14),"^")
"RTN","PSOPRVW",33,0)
 G START
"RTN","PSOPRVW",34,0)
EX K DIC,DIE,DA,DR,D0,PRNO,PRCLS,STAT,T,Y,X,L,LF,I,DIR,DIROUT,DUOUT,DTOUT,DIRUT,%,%Y,%W,%Z,C,DDH,DI,DIH,DLAYGO,DQ,X1,XMDT,XMN
"RTN","PSOPRVW",35,0)
 Q
"RTN","PSOPRVW",36,0)
ASK ;edit providers
"RTN","PSOPRVW",37,0)
 K DIR,DTOUT,DUOUT,DIROUT,DIRUT
"RTN","PSOPRVW",38,0)
 W !! S DIC("A")="Select Provider: ",(DIC,DIE)=200,DIC(0)="AEQMZ" D ^DIC G:"^"[X EX G:Y<0 ASK S (FADA,DA)=+Y
"RTN","PSOPRVW",39,0)
 I '$D(^VA(200,DA,"PS")) G NPRV
"RTN","PSOPRVW",40,0)
ASK1 W @IOF,?25,"Provider: "_$P(^VA(200,DA,0),"^"),! F DR="TPB","PS",".11",".13",".14" D EN^DIQ
"RTN","PSOPRVW",41,0)
 K DIC,Y
"RTN","PSOPRVW",42,0)
EDT W ! L +^VA(200,DA):0
"RTN","PSOPRVW",43,0)
 I '$T W $C(7),!!,"Provider Data is Being Edited by Another User!",! G QX
"RTN","PSOPRVW",44,0)
 N RTPB S RTPB=$G(^VA(200,DA,"TPB"))
"RTN","PSOPRVW",45,0)
 S DR="53.91" D ^DIE I $D(Y)!$D(DTOUT) G QX
"RTN","PSOPRVW",46,0)
 I 'X,$G(PSOTPBFG) G QX
"RTN","PSOPRVW",47,0)
 I X S DR="53.92R;53.93R;53.94R;53.95R"
"RTN","PSOPRVW",48,0)
 E  S DR="53.92;53.93;53.94;53.95"
"RTN","PSOPRVW",49,0)
 S DR=DR_";D:X MS^PSOPRVW",DIE("NO^")="OUTOK" D ^DIE K DIE("NO^")
"RTN","PSOPRVW",50,0)
 I '$D(^VA(200,DA,"TPB")),$G(PSOTPBFG) G QX
"RTN","PSOPRVW",51,0)
 I $D(Y)!$D(DTOUT) D:$P($G(^VA(200,DA,"TPB")),"^",3)  G QX
"RTN","PSOPRVW",52,0)
 .I RTPB=""!('$P(RTPB,"^",3)) S DR="53.96////"_DUZ D ^DIE
"RTN","PSOPRVW",53,0)
 I $P($G(^VA(200,DA,"TPB")),"^",3) D
"RTN","PSOPRVW",54,0)
 .I RTPB=""!('$P(RTPB,"^",3)) S DR="53.96////"_DUZ D ^DIE
"RTN","PSOPRVW",55,0)
 G:$G(PSOTPBFG) QX
"RTN","PSOPRVW",56,0)
ED1 S DR="53.1:53.6;I X'=4 S Y=""@1"";29;8932.1;@1;53.7;I 'X S Y=""@2"";53.8;@2;53.9;.111:.116;.131:.134;.136;.137;.138;.141",DR(2,200.05)=".01;2;3"
"RTN","PSOPRVW",57,0)
 D ^DIE S FADA=DA D:'$D(Y) KEY
"RTN","PSOPRVW",58,0)
QX K FADA,RTPB L -^VA(200,DA) Q:$G(PSOTPBFG)  G:+$G(VADA) ADD G ASK
"RTN","PSOPRVW",59,0)
 Q
"RTN","PSOPRVW",60,0)
 G:'$D(^VA(200,DA,"TPB")) ED1
"RTN","PSOPRVW",61,0)
ADD ;add new providers (kernel 7)
"RTN","PSOPRVW",62,0)
 W !
"RTN","PSOPRVW",63,0)
 S VADA=$$ADD^XUSERNEW("53.91;S:'X Y=""@2"";53.92R;53.93R;53.94R;53.95R;D:X MS^PSOPRVW;@2;53.1;53.2;53.3;53.4;53.5;53.6;53.7;S:'X Y=""@1"";53.8;@1;53.9;.111:.116;.131:.134;.136;.141")
"RTN","PSOPRVW",64,0)
 S (FADA,DA)=+VADA,(DIC,DIE)="^VA(200,"
"RTN","PSOPRVW",65,0)
 I VADA>0,$P(VADA,"^",3),$P($G(^VA(200,DA,"TPB")),"^") D
"RTN","PSOPRVW",66,0)
 .S DR="53.96////"_DUZ D ^DIE
"RTN","PSOPRVW",67,0)
 I VADA>0,'$P(VADA,"^",3) S DIC(0)="AEQMZ" G:'$D(^VA(200,+VADA,"PS")) NPRV G:$D(^VA(200,+VADA,"PS")) ASK1
"RTN","PSOPRVW",68,0)
 D:VADA>0 KEY K DIK,DIC,Y,X,VADA,VA,DEA Q:$G(PSOTPBFG)  K DA G EX
"RTN","PSOPRVW",69,0)
 Q
"RTN","PSOPRVW",70,0)
NPRV W ! S DIR("A",1)=$P(^VA(200,DA,0),"^")_" is NOT currently indicated as being a provider.",DIR("A")="Do you want to make "_$P(^VA(200,DA,0),"^")_" a provider? (Y/N): ",DIR(0)="SA^1:YES;0:NO",DIR("B")="NO"
"RTN","PSOPRVW",71,0)
 S DIR("?",1)="Answer with '1' or 'Yes' if "_$P(^VA(200,DA,0),"^")_" is to become a provider",DIR("?")="otherwise press return for 'No' and re-enter name." D ^DIR G:$D(DTOUT) EX
"RTN","PSOPRVW",72,0)
 G:'Y!($D(DIRUT))&('+$G(VADA)) ASK G:'$P(+$G(VADA),"^",3)&('Y) ADD
"RTN","PSOPRVW",73,0)
 G EDT
"RTN","PSOPRVW",74,0)
 Q
"RTN","PSOPRVW",75,0)
KEY I $D(^VA(200,DA,"PS")) D
"RTN","PSOPRVW",76,0)
 .I '$P(^VA(200,DA,"PS"),"^",4)!($P(^("PS"),"^",4)>DT) S PSOPDA=DA K DIC S DIC="^DIC(19.1,",DIC(0)="MZ",X="PROVIDER" D ^DIC K DIC S DA=PSOPDA K PSOPDA I +Y>0 S X=+Y D
"RTN","PSOPRVW",77,0)
 ..S:'$D(^VA(200,FADA,51,0)) ^VA(200,FADA,51,0)="^"_$P(^DD(200,51,0),"^",2)_"^^"
"RTN","PSOPRVW",78,0)
 ..S DIC="^VA(200,"_FADA_",51,",DIC(0)="LM",DIC("DR")="1////"_$S($G(DUZ):DUZ,1:"")_";2///"_DT,DLAYGO=200.051,DINUM=X,DA(1)=FADA
"RTN","PSOPRVW",79,0)
 ..L +^VA(200,FADA):0 K DD,DO D FILE^DICN L -^VA(200,FADA) K DIC,DR,X,Y
"RTN","PSOPRVW",80,0)
 Q
"RTN","PSOPRVW",81,0)
MS ;
"RTN","PSOPRVW",82,0)
 W !!,$C(7),"This provider will not be selectable during TPB medication order entry!!",!
"RTN","PSOPRVW",83,0)
 Q
"VER")
8.0^22.0
"BLD",7192,6)
^232
**END**
**END**
