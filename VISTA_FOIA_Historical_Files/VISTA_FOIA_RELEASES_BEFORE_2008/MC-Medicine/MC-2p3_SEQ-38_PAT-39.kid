Released MC*2.3*39 SEQ #38
Extracted from mail message
**KIDS**:MC*2.3*39^

**INSTALL NAME**
MC*2.3*39
"BLD",4849,0)
MC*2.3*39^MEDICINE^0^3040722^y
"BLD",4849,1,0)
^^2^2^3040114^
"BLD",4849,1,1,0)
Please refer to the National Patch Module for the detail of this patch 
"BLD",4849,1,2,0)
build.
"BLD",4849,4,0)
^9.64PA^^
"BLD",4849,"KRN",0)
^9.67PA^8989.52^19
"BLD",4849,"KRN",.4,0)
.4
"BLD",4849,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4849,"KRN",.401,0)
.401
"BLD",4849,"KRN",.402,0)
.402
"BLD",4849,"KRN",.403,0)
.403
"BLD",4849,"KRN",.5,0)
.5
"BLD",4849,"KRN",.84,0)
.84
"BLD",4849,"KRN",3.6,0)
3.6
"BLD",4849,"KRN",3.8,0)
3.8
"BLD",4849,"KRN",9.2,0)
9.2
"BLD",4849,"KRN",9.8,0)
9.8
"BLD",4849,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",4849,"KRN",9.8,"NM",1,0)
MCARP^^0^B33272345
"BLD",4849,"KRN",9.8,"NM",2,0)
MCARPS2^^0^B17411795
"BLD",4849,"KRN",9.8,"NM",3,0)
MCARPS3^^0^B16808255
"BLD",4849,"KRN",9.8,"NM",4,0)
MCORMN^^0^B26988124
"BLD",4849,"KRN",9.8,"NM","B","MCARP",1)

"BLD",4849,"KRN",9.8,"NM","B","MCARPS2",2)

"BLD",4849,"KRN",9.8,"NM","B","MCARPS3",3)

"BLD",4849,"KRN",9.8,"NM","B","MCORMN",4)

"BLD",4849,"KRN",19,0)
19
"BLD",4849,"KRN",19.1,0)
19.1
"BLD",4849,"KRN",101,0)
101
"BLD",4849,"KRN",409.61,0)
409.61
"BLD",4849,"KRN",771,0)
771
"BLD",4849,"KRN",870,0)
870
"BLD",4849,"KRN",8989.51,0)
8989.51
"BLD",4849,"KRN",8989.52,0)
8989.52
"BLD",4849,"KRN",8994,0)
8994
"BLD",4849,"KRN","B",.4,.4)

"BLD",4849,"KRN","B",.401,.401)

"BLD",4849,"KRN","B",.402,.402)

"BLD",4849,"KRN","B",.403,.403)

"BLD",4849,"KRN","B",.5,.5)

"BLD",4849,"KRN","B",.84,.84)

"BLD",4849,"KRN","B",3.6,3.6)

"BLD",4849,"KRN","B",3.8,3.8)

"BLD",4849,"KRN","B",9.2,9.2)

"BLD",4849,"KRN","B",9.8,9.8)

"BLD",4849,"KRN","B",19,19)

"BLD",4849,"KRN","B",19.1,19.1)

"BLD",4849,"KRN","B",101,101)

"BLD",4849,"KRN","B",409.61,409.61)

"BLD",4849,"KRN","B",771,771)

"BLD",4849,"KRN","B",870,870)

"BLD",4849,"KRN","B",8989.51,8989.51)

"BLD",4849,"KRN","B",8989.52,8989.52)

"BLD",4849,"KRN","B",8994,8994)

"BLD",4849,"QUES",0)
^9.62^^
"BLD",4849,"REQB",0)
^9.611^1^1
"BLD",4849,"REQB",1,0)
MC*2.3*38^2
"BLD",4849,"REQB","B","MC*2.3*38",1)

"MBREQ")
0
"PKG",31,-1)
1^1
"PKG",31,0)
MEDICINE^MC^MEDICINE PACKAGE INCLUDES ALL AREAS OF MEDICINE
"PKG",31,20,0)
^9.402P^^
"PKG",31,22,0)
^9.49I^1^1
"PKG",31,22,1,0)
2.3^2960913^2980615^4558
"PKG",31,22,1,"PAH",1,0)
39^3040722
"PKG",31,22,1,"PAH",1,1,0)
^^2^2^3040722
"PKG",31,22,1,"PAH",1,1,1,0)
Please refer to the National Patch Module for the detail of this patch 
"PKG",31,22,1,"PAH",1,1,2,0)
build.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","MCARP")
0^1^B33272345
"RTN","MCARP",1,0)
MCARP ;WISC/TJK,WAA-PRINT ROUTINES ;12/15/97  14:54
"RTN","MCARP",2,0)
 ;;2.3;Medicine;**6,14,15,18,27,33,35,39**;09/13/1996
"RTN","MCARP",3,0)
 ; Reference IA #2432 for Hospital Location File #44 FM Lookup
"RTN","MCARP",4,0)
 ;              #1576 for DIVISION file 40.8 lookup
"RTN","MCARP",5,0)
 ;              #10035 for Patient File (#2) Direct Global Reads
"RTN","MCARP",6,0)
 ;              #10061 for ^VADPT call.
"RTN","MCARP",7,0)
 ;
"RTN","MCARP",8,0)
CATH ;
"RTN","MCARP",9,0)
 S DIC="^MCAR(691.1,",MCARZ="CATHETERIZATION REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"CATHB",1:"CATH1") G LOOK
"RTN","MCARP",10,0)
ECHO S DIC="^MCAR(691,",MCARZ="ECHO REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"ECHOB",1:"ECHO1") G LOOK
"RTN","MCARP",11,0)
ECG S DIC="^MCAR(691.5,",MCARZ="ECG REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"ECGB",1:"ECG1") G LOOK
"RTN","MCARP",12,0)
EP S DIC="^MCAR(691.8,",MCARZ="EP REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"EPB",1:"EP1") G LOOK
"RTN","MCARP",13,0)
HOLTER S DIC="^MCAR(691.6,",MCARZ="HOLTER REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"HOLTERB",1:"HOLTER1") G LOOK
"RTN","MCARP",14,0)
RHFULL S DIC="^MCAR(701,",MCARZ="RHEUMATOLOGY REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"RHB",1:"RHFULL1") G LOOK
"RTN","MCARP",15,0)
ETT S DIC="^MCAR(691.7,",MCARZ="ETT REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"ETTB",1:"ETT1")
"RTN","MCARP",16,0)
LOOK ;
"RTN","MCARP",17,0)
 D MCPPROC
"RTN","MCARP",18,0)
 I '$D(MCARPPS) D LOOK2,^DIC G:Y<0 EXIT S (MCARGDA,DA)=+Y
"RTN","MCARP",19,0)
 I $G(MCESON),$D(^MCAR(MCFILE,MCARGDA,"ES")) D STATUS^MCESPRT(MCFILE,MCARGDA)
"RTN","MCARP",20,0)
 I $D(ORHFS) U IO G PRINT ;dcm/slc added for CPRS
"RTN","MCARP",21,0)
DEVQUE ; Device Control and Queuing Control
"RTN","MCARP",22,0)
 K IO("Q") S %ZIS="MQ" D ^%ZIS I POP S MCOUT="" G EXIT
"RTN","MCARP",23,0)
 I $D(IO("Q")) S (ZTSAVE("DIC"),ZTSAVE("MC*"))="",ZTRTN="PRINT^MCARP",ZTDESC=MCARZ D ^%ZTLOAD K ZTSK G EXIT
"RTN","MCARP",24,0)
 U IO
"RTN","MCARP",25,0)
PRINT ; Print Report
"RTN","MCARP",26,0)
 ;I DIC="^MCAR(699," D  ;MC*2.3*33
"RTN","MCARP",27,0)
 ;.N MCHLD,MCHLD2 ;MC*2.3*33
"RTN","MCARP",28,0)
 ;.S MCHLD=$$GET1^DIQ(699,MCARGDA,1,"I") ;MC*2.3*33
"RTN","MCARP",29,0)
 ;.S MCHLD2=$$GET1^DIQ(697.2,MCARGNUM,1,"I") ;MC*2.3*33
"RTN","MCARP",30,0)
 ;.I MCHLD'=MCHLD2 S MCARGRTN="PARAC" ;MC*2.3*33
"RTN","MCARP",31,0)
 ;.Q  ;MC*2.3*33
"RTN","MCARP",32,0)
 K DXS,DIOT(2),^UTILITY($J),MCOUT S (D0,DA)=MCARGDA,PG=0
"RTN","MCARP",33,0)
 S DFN=$P(^MCAR(+$P(DIC,"(",2),MCARGDA,0),U,2),MCARGDT=$P(^(0),U,1) S:DIC[699 MCARGNUM=$P(^(0),U,$S(DIC[699.5:6,1:12))
"RTN","MCARP",34,0)
RHPRT ;
"RTN","MCARP",35,0)
 D INIT^MCARP1(MCARZ,MCARGDT,MCFILE)
"RTN","MCARP",36,0)
 S ^UTILITY($J,1)="S MCY="""" I $Y>IOSL-3 R:$E(IOST,1,2)=""C-"" !!,""Press return to continue, '^' to escape: "",MCY:DTIME S:'$T MCY=U S:MCY=U DN=0,MCOUT=1 D:DN HEAD^MCARP K MCY"
"RTN","MCARP",37,0)
 D HEAD,CALLTEM
"RTN","MCARP",38,0)
 I '$D(MCOUT) D:$G(MCESON) FOOTER^MCESPRT(MCFILE,MCARGDA)
"RTN","MCARP",39,0)
 S:$D(ZTQUEUED) ZTREQ="@" K ZTSK
"RTN","MCARP",40,0)
 G EXIT
"RTN","MCARP",41,0)
CALLTEM ;
"RTN","MCARP",42,0)
 N MCFILE D @MCARGRTN Q
"RTN","MCARP",43,0)
EXIT ;
"RTN","MCARP",44,0)
 D EXIT^MCARP1 Q
"RTN","MCARP",45,0)
LOOK2 ;
"RTN","MCARP",46,0)
 S DIC(0)="AEMQ",DIC("A")="Enter patient name or the date & time: "
"RTN","MCARP",47,0)
 I MCESON S DIC("S")=$$PREVIEW^MCESSCR(MCFILE)
"RTN","MCARP",48,0)
 Q
"RTN","MCARP",49,0)
CATH1 D ^MCAROC1 K DXS Q:$D(MCOUT)  D ^MCAROC2 K DXS Q:$D(MCOUT)  D ^MCAROC3 K DXS Q:$D(MCOUT)  D ^MCAROC4 Q
"RTN","MCARP",50,0)
CATHB D ^MCOBC1 Q
"RTN","MCARP",51,0)
ECHO1 D ^MCRPEC K DXS Q:$D(MCOUT)  Q
"RTN","MCARP",52,0)
ECHOB D ^MCOBK Q
"RTN","MCARP",53,0)
ECG1 D ^MCAROK Q
"RTN","MCARP",54,0)
ECGB D ^MCOBE1 Q
"RTN","MCARP",55,0)
EPB D ^MCOBEP Q
"RTN","MCARP",56,0)
EP1 D ^MCAROEP G EPEND:$D(MCOUT)
"RTN","MCARP",57,0)
 G VT:'$D(^MCAR(691.9,"C",MCARGDA))
"RTN","MCARP",58,0)
 S MCY=""
"RTN","MCARP",59,0)
 I $Y>IOSL-3 R:$E(IOST,1,2)="C-" !!,"Press return to continue, '^' to escape: ",MCY:DTIME S:'$T MCY=U S:$E(MCY)=U MCOUT=1 G:$G(MCOUT)=1 EPEND
"RTN","MCARP",60,0)
 F D0=0:0 S D0=$O(^MCAR(691.9,"C",MCARGDA,D0)) Q:D0=""  K DXS D HEAD,^MCAROAT G EPEND:$D(MCOUT)
"RTN","MCARP",61,0)
VT Q:'$D(^MCAR(692,"C",MCARGDA))
"RTN","MCARP",62,0)
 I $Y>IOSL-3 R:$E(IOST,1,2)="C-" !!,"Press return to continue, '^' to escape: ",MCY:DTIME S:'$T MCY=U S:$E(MCY)=U MCOUT=1 G:$G(MCOUT)=1 EPEND
"RTN","MCARP",63,0)
 F D0=0:0 S D0=$O(^MCAR(692,"C",MCARGDA,D0)) Q:D0=""  K DXS D HEAD,^MCAROV Q:$D(MCOUT)
"RTN","MCARP",64,0)
EPEND Q
"RTN","MCARP",65,0)
ETT1 D ^MCAROT Q
"RTN","MCARP",66,0)
ETTB D ^MCOBT Q
"RTN","MCARP",67,0)
HOLTER1 D ^MCAROH1 K DXS Q:$D(MCOUT)  D ^MCAROH2 Q
"RTN","MCARP",68,0)
HOLTERB D ^MCOBH1 Q
"RTN","MCARP",69,0)
GENERIC D ^MCAROGE Q
"RTN","MCARP",70,0)
GENERICB D ^MCOBGEN Q
"RTN","MCARP",71,0)
GI ;I $D(^DIC(120.8)) D ^MCAROGM I 1 ;    new allergy info
"RTN","MCARP",72,0)
 D ^MCAROG
"RTN","MCARP",73,0)
 K DXS
"RTN","MCARP",74,0)
 D:'$D(MCOUT) ^MCAROGA
"RTN","MCARP",75,0)
 Q
"RTN","MCARP",76,0)
PARAC D ^MCPARC Q  ; MC*2.3*33
"RTN","MCARP",77,0)
GIB D ^MCOBGA Q
"RTN","MCARP",78,0)
PULM D ^MCAROP K DXS Q:$D(MCOUT)  D ^MCAROPE Q
"RTN","MCARP",79,0)
PULMB D ^MCOBPE Q
"RTN","MCARP",80,0)
NONENDO D ^MCAROGN Q
"RTN","MCARP",81,0)
NONENDOB D ^MCOBGN Q
"RTN","MCARP",82,0)
CONSULT D ^MCAROGC Q
"RTN","MCARP",83,0)
CONSULTB D ^MCOBGC Q
"RTN","MCARP",84,0)
GENIMP D ^MCAROPG Q
"RTN","MCARP",85,0)
GENIMPB D ^MCOBPG Q
"RTN","MCARP",86,0)
ALEAD D ^MCAROPA Q
"RTN","MCARP",87,0)
ALEADB D ^MCOBPA Q
"RTN","MCARP",88,0)
VLEAD D ^MCAROPV Q
"RTN","MCARP",89,0)
VLEADB D ^MCOBPV Q
"RTN","MCARP",90,0)
SURV D ^MCAROPS Q
"RTN","MCARP",91,0)
SURVB D ^MCOBPS Q
"RTN","MCARP",92,0)
RHFULL1 ;
"RTN","MCARP",93,0)
 N MCARRC,MCHOLD D DEM^VADPT S (MCARRC,MCHOLD)=$P(VADM(8),U,2),MCARRC=$$ETHN^MCPFTP1(MCHOLD,.VADM) D KVAR^VADPT
"RTN","MCARP",94,0)
 I +$G(MCRH)=0 D RHFULL2 Q
"RTN","MCARP",95,0)
 S MCFILE=701,V=MCRH,MCRHR="^MCAROR"_$S(V=1:"A",V=2:"B",V=3:"N",V=4:"L",V=6:"Q",V=7:"H",V=8:"P",V=9:"D",1:"RHFULL2^MCARP") D @MCRHR K DXS Q:$D(MCOUT)  D:V=8 ^MCARORE K DXS Q:$D(MCOUT)  D:MCRH=1 DISP^MCMAG Q
"RTN","MCARP",96,0)
RHFULL2 ;
"RTN","MCARP",97,0)
 F RH="A","B","N","L","Q","H","P","E","D" Q:$D(MCOUT)  D
"RTN","MCARP",98,0)
 .S MCFILE=701,MCRHR="^MCAROR"_RH D @MCRHR K DXS Q:$D(MCOUT)
"RTN","MCARP",99,0)
 .I RH="A" D DISP^MCMAG K DXS
"RTN","MCARP",100,0)
 Q
"RTN","MCARP",101,0)
RHB D ^MCOBRH K DXS Q:$D(MCOUT)  D ^MCOBRHA Q
"RTN","MCARP",102,0)
DTIME ; Setup Date/Time
"RTN","MCARP",103,0)
 S MCT=$P(X,".",2),X=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")_" "_$S(MCT:$E(MCT,1,2)_$E("00",0,2-$L($E(MCT,1,2)))_":"_$E(MCT,3,4)_$E("00",0,2-$L($E(MCT,3,4))),1:"")
"RTN","MCARP",104,0)
 K MCT Q
"RTN","MCARP",105,0)
HEAD ;
"RTN","MCARP",106,0)
 S HOSP=$P($G(^DPT(DFN,.1)),U)
"RTN","MCARP",107,0)
 S:HOSP'="" HOSP=$$FIND1^DIC(44,,"X",HOSP)
"RTN","MCARP",108,0)
 S:HOSP'<1 HOSP=$$GET1^DIQ(44,HOSP,3.5,"I")
"RTN","MCARP",109,0)
 S:HOSP'="" HOSP=$P($G(^DG(40.8,HOSP,0)),U)
"RTN","MCARP",110,0)
 S PG=PG+1 W:PG>1 @IOF I '+$G(MCFLG) D
"RTN","MCARP",111,0)
 .  W !!,"Pg. "_PG,?30,HOSP,?79-$L(MCARDTM),MCARDTM
"RTN","MCARP",112,0)
 .  I (PG>1),($E(IOST,1,2)="C-") W ! Q
"RTN","MCARP",113,0)
 .  I MCARZ'["NON-" D
"RTN","MCARP",114,0)
 .  .  I $G(MCARGRTN)="PARAC" S MCARZ="NON-"_MCARZ
"RTN","MCARP",115,0)
 .  .  Q
"RTN","MCARP",116,0)
 .  W !,$$HEDSTAR("CONFIDENTIAL "_MCARZ,77) ; MC*2.3*33
"RTN","MCARP",117,0)
 .  W !,MCARGNM_"    "_SSN_"   " W ?39-($L(MCARWARD_" "_MCARRB)\2),MCARWARD_" "_MCARRB,?79-$L(" DOB: "_MCARDOB)," DOB: "_MCARDOB
"RTN","MCARP",118,0)
 .  Q
"RTN","MCARP",119,0)
 I +$G(MCFLG) W !,$$HEDSTAR(MCARZ,77)
"RTN","MCARP",120,0)
 W !,?39-($L("PROCEDURE DATE/TIME: "_MCARGDT2)\2),"PROCEDURE DATE/TIME: ",MCARGDT2
"RTN","MCARP",121,0)
 N FFF S $P(FFF,"- ",40)="- " W !,FFF,!
"RTN","MCARP",122,0)
 Q
"RTN","MCARP",123,0)
HEDSTAR(X,X1) ;    surround text string X with asterisks to length X1
"RTN","MCARP",124,0)
 N Y1
"RTN","MCARP",125,0)
 S (TY,Y1)="",$P(Y1," ",X1-$L(X)\2-1)=" ",TY=Y1_" "_X_" "
"RTN","MCARP",126,0)
 F I=$L(TY):1:X1 S TY=TY_" "
"RTN","MCARP",127,0)
 Q TY
"RTN","MCARP",128,0)
MCPPROC ; Get require variables
"RTN","MCARP",129,0)
 D MCPPROC^MCARP1 Q
"RTN","MCARP",130,0)
XTRCT(FULL) ;Extrinsic Function use to determine Full reporting or brief
"RTN","MCARP",131,0)
 Q $S($E($P(FULL,U),3)="B":0,1:1)
"RTN","MCARP",132,0)
MCPROP(MCPROP) ; Medicine Procedure file entry validator
"RTN","MCARP",133,0)
 N TEMP,PREFIX,CNT
"RTN","MCARP",134,0)
 S PREFIX=$S($E(MCPROP,3,4)="ES":7,1:4),TEMP=""
"RTN","MCARP",135,0)
 F CNT=PREFIX+2:1:$L(MCPROP) I $D(^MCAR(697.2,"B",$E(MCPROP,PREFIX+1,CNT))) S TEMP=$E(MCPROP,PREFIX+1,CNT) Q
"RTN","MCARP",136,0)
 Q TEMP
"RTN","MCARPS2")
0^2^B17411795
"RTN","MCARPS2",1,0)
MCARPS2 ;SLC/dcm,WAA Summary of patient procedures for CPRS ;12/15/97  14:49
"RTN","MCARPS2",2,0)
 ;;2.3;Medicine;**15,33,39**;09/13/1996
"RTN","MCARPS2",3,0)
 ;Modified from MCARPS1 for CPRS
"RTN","MCARPS2",4,0)
 ; Please Reference DBIA # 3397
"RTN","MCARPS2",5,0)
EN(DFN) ;Get procedures for a patient
"RTN","MCARPS2",6,0)
 I '$$PATCH^XPDUTL("MD*1.0*2") G MED
"RTN","MCARPS2",7,0)
 N MCGLB,MCBLK,MCRT K ^TMP("OR",$J,"MCAR") S MCGLB=$NA(^TMP("OR",$J,"MCAR","OT"))
"RTN","MCARPS2",8,0)
 S MCBLK="",MCRT="D EN1^MDPS1(.MCGLB,DFN,MCBLK,MCBLK,99999,MCBLK,MCBLK)"
"RTN","MCARPS2",9,0)
 X MCRT
"RTN","MCARPS2",10,0)
 Q
"RTN","MCARPS2",11,0)
MED S WH=""
"RTN","MCARPS2",12,0)
 K ^TMP("OR",$J,"MCAR") S S4="" F M=1:1 S S4=$O(^MCAR(690,"AC",DFN,S4)) Q:S4=""  D LOCFIL
"RTN","MCARPS2",13,0)
 D PR0
"RTN","MCARPS2",14,0)
 Q
"RTN","MCARPS2",15,0)
LOCFIL G LOCFIL1:$D(S5) S S5="" F K=1:1 S S5=$O(^MCAR(690,"AC",DFN,S4,S5)) Q:S5=""  D LOCFIL1
"RTN","MCARPS2",16,0)
 K S5 Q
"RTN","MCARPS2",17,0)
LOCFIL1 S S6="" F L=1:1 S S6=$O(^MCAR(690,"AC",DFN,S4,S5,S6)) Q:S6=""  D CONT
"RTN","MCARPS2",18,0)
 Q
"RTN","MCARPS2",19,0)
CONT ;CONT+1 modified on 2-7-94,S MCFILE..2) added to conform w/alpha site
"RTN","MCARPS2",20,0)
 I $D(^MCAR(+$P(S5,"(",2),S6,2005)) S MCFILE=+$P(S5,"(",2) D SUM^MCMAG
"RTN","MCARPS2",21,0)
 I S5="MCAR(702.7" Q
"RTN","MCARPS2",22,0)
 I S5="MCAR(699" S (LL,LL1)=$P($G(^MCAR(699,S6,0)),U,12) Q:LL'>0  S LL=$P($G(^MCAR(697.2,LL,0)),U) G:'$D(PE) CONT1 Q:PE'=LL  G CONT1
"RTN","MCARPS2",23,0)
 ;I S5="MCAR(699.5" S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U) G CONT1:'$D(PE) Q:PE'=LL  G CONT1  ;MC*2.3*8
"RTN","MCARPS2",24,0)
 I S5="MCAR(699.5",'$D(PE) D  Q  ;MC*2.3*8
"RTN","MCARPS2",25,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MCARPS2",26,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U) D CONT1
"RTN","MCARPS2",27,0)
 I S5="MCAR(699.5",$D(PE) D  Q  ;MC*2.3*8
"RTN","MCARPS2",28,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MCARPS2",29,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U)
"RTN","MCARPS2",30,0)
 .N LLX,LLY
"RTN","MCARPS2",31,0)
 .S LLX=$O(^MCAR(697.2,"B",PE,0)) Q:'LLX  S LLY=$P($G(^MCAR(697.2,LLX,1)),U)
"RTN","MCARPS2",32,0)
 .I LLY="S",LLX=LL6 D CONT1
"RTN","MCARPS2",33,0)
 .I LLY="P",LLX=LL8 D CONT1
"RTN","MCARPS2",34,0)
 I S5[694 S (LL,LL1)=$P($G(^MCAR(694,S6,0)),U,3) Q:'LL  S LL=$P(^MCAR(697.2,LL,0),U) G CONT1:'$D(PE) Q:PE'=LL  G CONT1
"RTN","MCARPS2",35,0)
 ;MFD 2/5/93 I S5[700,$P($G(^MCAR(700,S6,2)),U)'="Y" Q  ;    exclude unreleased PFT
"RTN","MCARPS2",36,0)
 S (LL,LL1)=$O(^MCAR(697.2,"C",S5,0)),LL=$P(^MCAR(697.2,LL,0),U,1)
"RTN","MCARPS2",37,0)
CONT1 ;
"RTN","MCARPS2",38,0)
 S REC=$O(^MCAR(697.2,"B",LL,0)) S:REC="" REC=0
"RTN","MCARPS2",39,0)
 S MCARCODE=""
"RTN","MCARPS2",40,0)
 S MCESON=$P($G(^MCAR(697.2,REC,0)),U,14),MCESKEY=$P($G(^MCAR(697.2,REC,0)),U,15),MCSUP=+$P($G(^MCAR(697.2,REC,0)),U,16)
"RTN","MCARPS2",41,0)
 S (MCARSUM,MCARPSUM)="",MCARFILE=U_S5_","_S6_",.2)" S:$D(@MCARFILE) MCARSUM=$P(@MCARFILE,U,1),MCARPSUM=$P(@MCARFILE,U,2)
"RTN","MCARPS2",42,0)
 K MCARFILE S S1=$S(WH="P":LL,1:S4),S2=$S(WH="P":S4,1:LL)
"RTN","MCARPS2",43,0)
 S MCFILE=+$P(S5,"(",2)
"RTN","MCARPS2",44,0)
 I MCESON,($G(MCESKEY)'=""),('$$SCRSUMPT^MCESSCR(MCESKEY,S6,MCSUP)) K MCARSUM,MCARPSUM,MCFILE,REC,MCSUP Q
"RTN","MCARPS2",45,0)
 I '$$VALID^MCARUTL5(S5,S6,DFN) Q  ; MC*2.3*33
"RTN","MCARPS2",46,0)
 I $P($G(@(U_S5_","_S6_",""ES"")")),U,7)="S" G EXIT  ;MC*2.3*8
"RTN","MCARPS2",47,0)
 S S2=S2_U_S6  ;MC*2.3*8
"RTN","MCARPS2",48,0)
 S ^TMP("OR",$J,"MCAR",S1,S2)=MCARSUM_U_S6_U_$P(^MCAR(697.2,LL1,0),U,5,7)
"RTN","MCARPS2",49,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^CONSULTS" ; MC*2.3*33
"RTN","MCARPS2",50,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^NONENDO" ; MC*2.3*33
"RTN","MCARPS2",51,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^GI" ; MC*2.3*33
"RTN","MCARPS2",52,0)
 I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^PARAC" ; MC*2.3*33
"RTN","MCARPS2",53,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,10)=MCARPSUM
"RTN","MCARPS2",54,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,11)=LL
"RTN","MCARPS2",55,0)
 I S5="MCAR(699.5" D  ;MC*2.3*8
"RTN","MCARPS2",56,0)
 .I LL8="" S LL8=" "
"RTN","MCARPS2",57,0)
 .S $P(^TMP("OR",$J,"MCAR",S1,S2),U,12)=$E(($E($P($G(^MCAR(697.2,LL6,0)),U,8),1,13)_"/"_$P($G(^MCAR(697.2,LL8,0)),U)),1,31) K LL6,LL8
"RTN","MCARPS2",58,0)
EXIT K MCARSUM,MCARPSUM,REC,MCSUP,MCESON Q
"RTN","MCARPS2",59,0)
PR0 S I="",L=0
"RTN","MCARPS2",60,0)
 F  S I=$O(^TMP("OR",$J,"MCAR",I)) Q:I=""  I I'="OT" D
"RTN","MCARPS2",61,0)
 . S J="" F  S J=$O(^TMP("OR",$J,"MCAR",I,J)) Q:J=""  S PR=^(J) D
"RTN","MCARPS2",62,0)
 .. Q:$P(PR,U,3,5)="^^"  ; MC*2.3*33
"RTN","MCARPS2",63,0)
 .. S MCARDT=$S(WH="P":$P(J,U),1:I),MCARPROC=$S(WH="P":I,1:$P(J,U))
"RTN","MCARPS2",64,0)
 .. S MCARPROC=$O(^MCAR(697.2,"B",MCARPROC,0)),MCARPROC=$P(^MCAR(697.2,MCARPROC,0),U,8)
"RTN","MCARPS2",65,0)
 .. I $P(PR,U,12)'="" S MCARPROC=$P(PR,U,12)
"RTN","MCARPS2",66,0)
 .. S DA=$P(PR,U,2),K=$P(PR,U),M=$P(PR,U,10)
"RTN","MCARPS2",67,0)
 .. S K=$S(K="N"!(K="L"):"NORMAL",K="A":"ABNORMAL",K="B":"BORDERLINE",K="T":"TECHNICALLY UNSATISFACTORY",K="ND":"NON-DIAGNOSTIC",K="MI":"MILDLY ABNORMAL",K="MO":"MODERATELY ABNORMAL",K="S":"SEVERELY ABNORMAL",1:"")
"RTN","MCARPS2",68,0)
 .. S Y=9999999.9999-MCARDT X ^DD("DD")
"RTN","MCARPS2",69,0)
 .. S L=L+1 S ^TMP("OR",$J,"MCAR","OT",L)=MCARPROC_U_DA_U_$P(PR,U,3,5)_U_J S $P(^(L),U,6)=Y,$P(^(L),U,7)=K,$P(^(L),U,10)=M,$P(^(L),U,11)=$S(WH="P":I_U_$P(J,U,2),1:J)
"RTN","MCARPS2",70,0)
 Q
"RTN","MCARPS3")
0^3^B16808255
"RTN","MCARPS3",1,0)
MCARPS3 ; HOIFO/NCA - Get Procedures for Medicine and CP ;1/13/04  14:35
"RTN","MCARPS3",2,0)
 ;;2.3;Medicine;**39**;09/13/1996
"RTN","MCARPS3",3,0)
 ;Modified from MCARPS2 for CPRS
"RTN","MCARPS3",4,0)
 ; Please Reference DBIA # 3397
"RTN","MCARPS3",5,0)
EN(MCDFN,CODE,MDSDT,MDEDT) ;Get procedures for a patient
"RTN","MCARPS3",6,0)
 S WH="" K ^TMP("OR",$J,"MCAR")
"RTN","MCARPS3",7,0)
 N MDGBL,MDPTR
"RTN","MCARPS3",8,0)
 S MDGBL="^MCAR(690,""AC"",MCDFN)"
"RTN","MCARPS3",9,0)
 F  S MDGBL=$Q(@MDGBL) Q:MDGBL=""  Q:$QS(MDGBL,3)'=MCDFN  D
"RTN","MCARPS3",10,0)
 .S MDPTR=$QS(MDGBL,6)_";"_$QS(MDGBL,5)_",",S4=$QS(MDGBL,4),S5=$QS(MDGBL,5),S6=$QS(MDGBL,6)
"RTN","MCARPS3",11,0)
 .D CONT
"RTN","MCARPS3",12,0)
 D PR0
"RTN","MCARPS3",13,0)
 K S5 Q
"RTN","MCARPS3",14,0)
CONT ;CONT+1 modified on 2-7-94,S MCFILE..2) added to conform w/alpha site
"RTN","MCARPS3",15,0)
 I $D(^MCAR(+$P(S5,"(",2),S6,2005)) S MCFILE=+$P(S5,"(",2) D SUM^MCMAG
"RTN","MCARPS3",16,0)
 I S5="MCAR(702.7" Q
"RTN","MCARPS3",17,0)
 I S5="MCAR(699" S (LL,LL1)=$P($G(^MCAR(699,S6,0)),U,12) Q:LL'>0  S LL=$P($G(^MCAR(697.2,LL,0)),U) G:'$D(PE) CONT1 Q:PE'=LL  G CONT1
"RTN","MCARPS3",18,0)
 I S5="MCAR(699.5",'$D(PE) D  Q  ;MC*2.3*8
"RTN","MCARPS3",19,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MCARPS3",20,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U) D CONT1
"RTN","MCARPS3",21,0)
 I S5="MCAR(699.5",$D(PE) D  Q  ;MC*2.3*8
"RTN","MCARPS3",22,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MCARPS3",23,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U)
"RTN","MCARPS3",24,0)
 .N LLX,LLY
"RTN","MCARPS3",25,0)
 .S LLX=$O(^MCAR(697.2,"B",PE,0)) Q:'LLX  S LLY=$P($G(^MCAR(697.2,LLX,1)),U)
"RTN","MCARPS3",26,0)
 .I LLY="S",LLX=LL6 D CONT1
"RTN","MCARPS3",27,0)
 .I LLY="P",LLX=LL8 D CONT1
"RTN","MCARPS3",28,0)
 I S5[694 S (LL,LL1)=$P($G(^MCAR(694,S6,0)),U,3) Q:'LL  S LL=$P(^MCAR(697.2,LL,0),U) G CONT1:'$D(PE) Q:PE'=LL  G CONT1
"RTN","MCARPS3",29,0)
 ;MFD 2/5/93 I S5[700,$P($G(^MCAR(700,S6,2)),U)'="Y" Q  ;    exclude unreleased PFT
"RTN","MCARPS3",30,0)
 S (LL,LL1)=$O(^MCAR(697.2,"C",S5,0)),LL=$P(^MCAR(697.2,LL,0),U,1)
"RTN","MCARPS3",31,0)
CONT1 ;
"RTN","MCARPS3",32,0)
 S REC=$O(^MCAR(697.2,"B",LL,0)) S:REC="" REC=0
"RTN","MCARPS3",33,0)
 S MCARCODE=""
"RTN","MCARPS3",34,0)
 S MCESON=$P($G(^MCAR(697.2,REC,0)),U,14),MCESKEY=$P($G(^MCAR(697.2,REC,0)),U,15),MCSUP=+$P($G(^MCAR(697.2,REC,0)),U,16)
"RTN","MCARPS3",35,0)
 S (MCARSUM,MCARPSUM)="",MCARFILE=U_S5_","_S6_",.2)" S:$D(@MCARFILE) MCARSUM=$P(@MCARFILE,U,1),MCARPSUM=$P(@MCARFILE,U,2)
"RTN","MCARPS3",36,0)
 K MCARFILE S S1=$S(WH="P":LL,1:S4),S2=$S(WH="P":S4,1:LL)
"RTN","MCARPS3",37,0)
 S MCFILE=+$P(S5,"(",2)
"RTN","MCARPS3",38,0)
 I MCESON,($G(MCESKEY)'=""),('$$SCRSUMPT^MCESSCR(MCESKEY,S6,MCSUP)) K MCARSUM,MCARPSUM,MCFILE,REC,MCSUP Q
"RTN","MCARPS3",39,0)
 I '$$VALID^MCARUTL5(S5,S6,MCDFN) Q  ; MC*2.3*33
"RTN","MCARPS3",40,0)
 I $P($G(@(U_S5_","_S6_",""ES"")")),U,7)="S" G EXIT  ;MC*2.3*8
"RTN","MCARPS3",41,0)
 S S2=S2_U_S6  ;MC*2.3*8
"RTN","MCARPS3",42,0)
 S ^TMP("OR",$J,"MCAR",S1,S2)=MCARSUM_U_S6_";"_S5_","_U_$P(^MCAR(697.2,LL1,0),U,5,7)
"RTN","MCARPS3",43,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^CONSULTS" ; MC*2.3*33
"RTN","MCARPS3",44,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^NONENDO" ; MC*2.3*33
"RTN","MCARPS3",45,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^GI" ; MC*2.3*33
"RTN","MCARPS3",46,0)
 I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^PARAC" ; MC*2.3*33
"RTN","MCARPS3",47,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,10)=MCARPSUM
"RTN","MCARPS3",48,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,11)=LL
"RTN","MCARPS3",49,0)
 I S5="MCAR(699.5" D  ;MC*2.3*8
"RTN","MCARPS3",50,0)
 .I LL8="" S LL8=" "
"RTN","MCARPS3",51,0)
 .S $P(^TMP("OR",$J,"MCAR",S1,S2),U,12)=$E(($E($P($G(^MCAR(697.2,LL6,0)),U,8),1,13)_"/"_$P($G(^MCAR(697.2,LL8,0)),U)),1,31) K LL6,LL8
"RTN","MCARPS3",52,0)
EXIT K MCARSUM,MCARPSUM,REC,MCSUP,MCESON Q
"RTN","MCARPS3",53,0)
PR0 S I="",L=0
"RTN","MCARPS3",54,0)
 F  S I=$O(^TMP("OR",$J,"MCAR",I)) Q:I=""  I I'="OT" D
"RTN","MCARPS3",55,0)
 . S J="" F  S J=$O(^TMP("OR",$J,"MCAR",I,J)) Q:J=""  S PR=^(J) D
"RTN","MCARPS3",56,0)
 .. Q:$P(PR,U,3,5)="^^"  ; MC*2.3*33
"RTN","MCARPS3",57,0)
 .. S MCARDT=$S(WH="P":$P(J,U),1:I),MCARPROC=$S(WH="P":I,1:$P(J,U))
"RTN","MCARPS3",58,0)
 .. S MCARPROC=$O(^MCAR(697.2,"B",MCARPROC,0)),MCARPROC=$P(^MCAR(697.2,MCARPROC,0),U,8)
"RTN","MCARPS3",59,0)
 .. I $P(PR,U,12)'="" S MCARPROC=$P(PR,U,12)
"RTN","MCARPS3",60,0)
 .. S DA=$P(PR,U,2),K=$P(PR,U),M=$P(PR,U,10)
"RTN","MCARPS3",61,0)
 .. S K=$S(K="N"!(K="L"):"NORMAL",K="A":"ABNORMAL",K="B":"BORDERLINE",K="T":"TECHNICALLY UNSATISFACTORY",K="ND":"NON-DIAGNOSTIC",K="MI":"MILDLY ABNORMAL",K="MO":"MODERATELY ABNORMAL",K="S":"SEVERELY ABNORMAL",1:"")
"RTN","MCARPS3",62,0)
 ..I CODE'="" Q:CODE'=K
"RTN","MCARPS3",63,0)
 ..I +$G(MDSDT) Q:(9999999.9999-MCARDT)<+$G(MDSDT)
"RTN","MCARPS3",64,0)
 ..I +$G(MDEDT) Q:(9999999.9999-MCARDT)>+$G(MDEDT)
"RTN","MCARPS3",65,0)
 ..N MCDT S MCDT=MCARDT,Y=9999999.9999-MCARDT X ^DD("DD")
"RTN","MCARPS3",66,0)
 ..S L=MCARPROC_"~"_DA
"RTN","MCARPS3",67,0)
 ..S ^TMP("MDPLST",$J,MCDT,L)=MCARPROC_U_+DA_U_"PR690^MDPS1"_U_$P(PR,U,5)_U_J S $P(^(L),U,6)=Y,$P(^(L),U,7)=K,$P(^(L),U,10)=M,$P(^(L),U,11)=$S(WH="P":I_U_$P(J,U,2),1:J)
"RTN","MCARPS3",68,0)
 K ^TMP("OR",$J,"MCAR")
"RTN","MCARPS3",69,0)
 Q
"RTN","MCORMN")
0^4^B26988124
"RTN","MCORMN",1,0)
MCORMN ;WISC/DCB-Front-end for Health Summary ;4/26/04  11:54
"RTN","MCORMN",2,0)
 ;;2.3;Medicine;**36,39**;09/13/1996
"RTN","MCORMN",3,0)
 ; Reference IA #1236 for Medicine and Health Summary interface.
"RTN","MCORMN",4,0)
 ;              #3778 for Medicine and Health Summary interface for RDV
"RTN","MCORMN",5,0)
 ;              #10070 for XMD API call.
"RTN","MCORMN",6,0)
 ;              #10064 for XM call.
"RTN","MCORMN",7,0)
 ;              #10090 DIC(4) Read Access.
"RTN","MCORMN",8,0)
 ;              #10106 for HLFNC calls.
"RTN","MCORMN",9,0)
 ;              #10113 for Access to ^XMB(3.9,#,2)
"RTN","MCORMN",10,0)
HL7(MESSNUMB) ;This is the HL7 entry point for queries
"RTN","MCORMN",11,0)
 N MSH,TEMP,ORD,ST,MSTR,BDATE,EDATE,OCC,PROC,PATID,MCTDEC,XMZ,MCLINE
"RTN","MCORMN",12,0)
 N QDT,QFC,QP,QID,RAP,GNODE,ATYPE
"RTN","MCORMN",13,0)
 Q:+MESSNUMB=0 0
"RTN","MCORMN",14,0)
 S GNODE="^XMB(3.9,"_MESSNUMB_",2)"
"RTN","MCORMN",15,0)
 S MSH=$G(@GNODE@(1,0)) I MSH="" D ERROR Q 0
"RTN","MCORMN",16,0)
 S MSTR=$E(MSH,4,9) D SLIP^MCORMN0(MSTR)
"RTN","MCORMN",17,0)
 S QRD=$G(@GNODE@(2,0)) I QRD="" D ERROR Q 0
"RTN","MCORMN",18,0)
 S QFC=$P(QRD,ST(1),3) I QFC'="R" D ERROR Q 0
"RTN","MCORMN",19,0)
 S QLR=$P(QRD,ST(1),8),OCC=$P(QLR,ST(2),2),ATYPE=$P(QLR,ST(2),1)
"RTN","MCORMN",20,0)
 S PATID=+$P(QRD,ST(1),9)
"RTN","MCORMN",21,0)
 I '$D(^MCAR(690,"AC",PATID)) D ERROR Q ""
"RTN","MCORMN",22,0)
 S PROC=$P(QRD,ST(1),11)
"RTN","MCORMN",23,0)
 S TEMP=$P(QRD,ST(1),12) S BDATE=$P(TEMP,ST(2),1),EDATE=$P(TEMP,ST(2),2)
"RTN","MCORMN",24,0)
 S BDATE=$$FMDATE^HLFNC(BDATE),EDATE=$$FMDATE^HLFNC(EDATE)
"RTN","MCORMN",25,0)
 S RAP=$P(MSH,ST(1),3)
"RTN","MCORMN",26,0)
 S MCTDEC="^TMP(""MCAR1"",$J)",GLOBAL=1
"RTN","MCORMN",27,0)
 D HSUM(RAP,PATID,BDATE,EDATE,OCC,PROC,MSTR,MCTDEC,.GLOBAL,ATYPE)
"RTN","MCORMN",28,0)
 I GLOBAL=0 S ^TMP("MCAR1",$J,1)="" Q 0
"RTN","MCORMN",29,0)
 I GLOBAL'=0 D
"RTN","MCORMN",30,0)
 .S XMSUB="Medicine Response",XMDUN="Medicine",XMDUZ=.5
"RTN","MCORMN",31,0)
 .S XMTEXT="^TMP(""MCAR1"",$J,",XMY("G.MC MESSAGING SERVER")=""
"RTN","MCORMN",32,0)
 .;S XMY(DUZ)=""
"RTN","MCORMN",33,0)
 .D ^XMD
"RTN","MCORMN",34,0)
 .S GLOBAL=+$G(XMZ)
"RTN","MCORMN",35,0)
 D KILL^XM
"RTN","MCORMN",36,0)
 K ^TMP("MCAR1",$J)
"RTN","MCORMN",37,0)
 Q GLOBAL
"RTN","MCORMN",38,0)
ERROR ;HL7 Messaging Error
"RTN","MCORMN",39,0)
 D KILL^XM Q
"RTN","MCORMN",40,0)
SERVER ;A do nothing routine
"RTN","MCORMN",41,0)
 Q
"RTN","MCORMN",42,0)
HSUM(RAP,PATID,BDATE,EDATE,OCC,PE,MSTR,MCTDEC,GLOBAL,ATYPE) ;Sending Message Builder
"RTN","MCORMN",43,0)
 N LOC,REC,RNF,SNF,SAP,MST,PCI,VID,MCDFN,TMP,ENDDATE,BEGDATE,MCIMAGE
"RTN","MCORMN",44,0)
 N LOOP,DFN,COUNT,MCPROC,MCFILE,PREC,SENDATE,FILE,MCREC,MCDEST
"RTN","MCORMN",45,0)
 N MCER,MCERR,MCVAL,TEMP,WH,S5
"RTN","MCORMN",46,0)
 I +PATID'=PATID S GLOBAL=0 Q
"RTN","MCORMN",47,0)
 I '$D(^MCAR(690,"AC",PATID))&('$D(^MDD(702,"B",PATID))) S GLOBAL=0 Q
"RTN","MCORMN",48,0)
 I PE'="" D
"RTN","MCORMN",49,0)
 .S S5=+$O(^MCAR(697.2,"B",PE,0))
"RTN","MCORMN",50,0)
 .S S5=$P($G(^MCAR(697.2,S5,0)),U,2)
"RTN","MCORMN",51,0)
 .I S5="" S PE="" K S5
"RTN","MCORMN",52,0)
 S MCVAL=DUZ(2),REC=$$FIND1^DIC(4,"","X",MCVAL,"D","","MCER")
"RTN","MCORMN",53,0)
 S LOC=$S(+REC:$$GET1^DIQ(4,+REC_",",.01),1:"")
"RTN","MCORMN",54,0)
 S (RNF,SNF)=LOC
"RTN","MCORMN",55,0)
 S SAP="Medicine",MST="HS",PCI="P"
"RTN","MCORMN",56,0)
 S VID=$P($T(+2),";",3),MCDFN=PATID,MCLINE=0
"RTN","MCORMN",57,0)
 S:EDATE="" EDATE=9999999.9999
"RTN","MCORMN",58,0)
 S:BDATE="" BDATE=0
"RTN","MCORMN",59,0)
 S:+OCC=0 OCC=999999
"RTN","MCORMN",60,0)
 I EDATE<BDATE S TEMP=EDATE,EDATE=BDATE,BDATE=TEMP
"RTN","MCORMN",61,0)
 S ENDDATE=(9999999.9999-EDATE)-.00001
"RTN","MCORMN",62,0)
 S BEGDATE=(9999999.9999-BDATE)+.00001
"RTN","MCORMN",63,0)
 S LOOP=ENDDATE,COUNT=0
"RTN","MCORMN",64,0)
 N L,LL,LL1,K,M,PE,REC,S1,S2,S4,S6
"RTN","MCORMN",65,0)
 N MCARCODE,MCARFILE,MCARPSUM,MCARSUM,MCESKEY,MCESON,MCSUP,MCESSEC
"RTN","MCORMN",66,0)
 S MCIMAGE=""
"RTN","MCORMN",67,0)
 K ^TMP("MCAR",$J)
"RTN","MCORMN",68,0)
 S DFN=PATID,WH="P" D ^MCARPS1
"RTN","MCORMN",69,0)
PROCN ;
"RTN","MCORMN",70,0)
 N MCRESULT,MDHOLDR,MCROU
"RTN","MCORMN",71,0)
 I $$PATCH^XPDUTL("MD*1.0*2") D
"RTN","MCORMN",72,0)
 .S MDRDV=1 K ^TMP("MDPLST",$J)
"RTN","MCORMN",73,0)
 .S MCRESULT=$NA(^TMP("MDPLST",$J)) N MCLP,MCLP1,MCXG
"RTN","MCORMN",74,0)
 .S MCROU="D GET702^MDPS3(.MCRESULT,PATID,"""",BDATE,EDATE,OCC)"
"RTN","MCORMN",75,0)
 .X MCROU
"RTN","MCORMN",76,0)
 .S MCLP="" F  S MCLP=$O(^TMP("MDPLST",$J,MCLP)) Q:MCLP=""  S MCLP1="" F  S MCLP1=$O(^TMP("MDPLST",$J,MCLP,MCLP1)) Q:MCLP1=""  S MCXG=$G(^(MCLP1)) D
"RTN","MCORMN",77,0)
 ..S:$G(^TMP("MCAR",$J,MCLP,MCLP1))="" ^TMP("MCAR",$J,MCLP,MCLP1)=MCXG
"RTN","MCORMN",78,0)
 .K ^TMP("MDPLST",$J)
"RTN","MCORMN",79,0)
 S MCPROC="",COUNT=0 N MCG
"RTN","MCORMN",80,0)
 F  S MCPROC=$O(^TMP("MCAR",$J,MCPROC)) Q:MCPROC=""  D
"RTN","MCORMN",81,0)
 .S MCDTIME=ENDDATE
"RTN","MCORMN",82,0)
 .F  S MCDTIME=$O(^TMP("MCAR",$J,MCPROC,MCDTIME)) Q:MCDTIME=""  Q:COUNT'<OCC  Q:MCDTIME>BEGDATE  S MCG=$G(^(MCDTIME)) D
"RTN","MCORMN",83,0)
 ..S MCREC=$P(MCG,U,2) Q:+MCREC=0
"RTN","MCORMN",84,0)
 ..S MCDEST=MCTDEC,SENDATE=9999999.9999-MCDTIME,MDHOLDR=MCPROC
"RTN","MCORMN",85,0)
 ..I +$G(BDATE) Q:SENDATE<+$G(BDATE)
"RTN","MCORMN",86,0)
 ..I +$G(EDATE) Q:SENDATE>+$G(EDATE)
"RTN","MCORMN",87,0)
 ..I $P(MCG,U,4)["MDPS1" S MCARGDA=+$P(MCG,U,2) Q:'MCARGDA  D PR690 S COUNT=COUNT+1,MCPROC=MDHOLDR Q
"RTN","MCORMN",88,0)
 ..S PREC=$O(^MCAR(697.2,"B",MCPROC,"")) Q:PREC=""
"RTN","MCORMN",89,0)
 ..S FILE=$P($G(^MCAR(697.2,PREC,0)),U,2) Q:FILE=""
"RTN","MCORMN",90,0)
 ..S MCFILE=+$P(FILE,"MCAR(",2)
"RTN","MCORMN",91,0)
 ..S MCERR=$$BUILD^MCORMN0(RAP,DFN,SAP,SNF,RNF,MST,PCI,VID,.MCLINE,MSTR,MCDEST,MCPROC,MCFILE,MCREC,SENDATE,ATYPE)
"RTN","MCORMN",92,0)
 ..S:MCERR=0 COUNT=COUNT+1
"RTN","MCORMN",93,0)
 K ^TMP("MCAR",$J),^TMP("MDPTXT",$J),MCPRO,MCARPPS,MCARGRTN,MDT,MDHDR,MDRDV
"RTN","MCORMN",94,0)
 Q
"RTN","MCORMN",95,0)
PR690 ; Set node for CP Reports
"RTN","MCORMN",96,0)
 N HLECH,MCRREC,ST
"RTN","MCORMN",97,0)
 S MCPRO=$P(MCG,U,11),MCARPPS=$P(MCG,U,3,4),MCARGRTN=$P(MCG,U,5),MDT="RD",MDHDR=1
"RTN","MCORMN",98,0)
 S HLECH=$E(MSTR,2,4) D SLIP^MCORMN0(MSTR)
"RTN","MCORMN",99,0)
 D SETNODE(MCDEST,$$MSH^MCORMN01(MCPROC,SAP,SNF,RAP,RNF,MST,PCI,VID))
"RTN","MCORMN",100,0)
 D SETNODE(MCDEST,$$PID^MCORMN01(MCDFN))
"RTN","MCORMN",101,0)
 D SETNODE(MCDEST,$$OBR1(SENDATE,MCPROC,HLECH))
"RTN","MCORMN",102,0)
 D SETNODE(MCDEST,$$OBX1^MCORMN01("W","ST","702~.1~702.1^^DD",1,""))
"RTN","MCORMN",103,0)
 D @MCARPPS S MCRREC=$NA(^TMP("MDPTXT",$J))
"RTN","MCORMN",104,0)
 F  S MCRREC=$Q(@MCRREC) Q:MCRREC=""  Q:$QS(MCRREC,1)'="MDPTXT"  D
"RTN","MCORMN",105,0)
 .D SETNODE(MCTDEC,$G(@MCRREC))
"RTN","MCORMN",106,0)
 D SETNODE(MCDEST,"||")
"RTN","MCORMN",107,0)
 Q
"RTN","MCORMN",108,0)
OBR1(SDATE,MCPROC,HLECH) ; OBX Messaging Line
"RTN","MCORMN",109,0)
 N LOOP,TEMP,TMP,STAT,STR
"RTN","MCORMN",110,0)
 S TMP="OTH"
"RTN","MCORMN",111,0)
 S STAT="COMPLETE"
"RTN","MCORMN",112,0)
 S TEMP=$$CONVERT^MCORMN01("D",SDATE),STR="OBR",$P(STR,ST(1),8)=TEMP
"RTN","MCORMN",113,0)
 S $P(STR,ST(1),16)=TMP,$P(STR,ST(1),26)=STAT
"RTN","MCORMN",114,0)
 Q STR
"RTN","MCORMN",115,0)
SETNODE(NODE,VALUE) ; Set the node with the HL7 message string
"RTN","MCORMN",116,0)
 S MCLINE=MCLINE+1,@NODE@(MCLINE,0)=VALUE
"RTN","MCORMN",117,0)
 Q
"RTN","MCORMN",118,0)
HL1(MCSAP,MCDFN,MCB,MCE,MCOCC,MCTYP) ; Alternate Entry Point for Data View
"RTN","MCORMN",119,0)
 N MSH,TEMP,ORD,ST,MSTR,BDATE,EDATE,OCC,PROC,PATID,MCTDEC,XMZ,MCLINE
"RTN","MCORMN",120,0)
 N QDT,QFC,QP,QID,RAP,GNODE,ATYPE
"RTN","MCORMN",121,0)
 S GLOBAL=1 K ^TMP("MCAR1",$J)
"RTN","MCORMN",122,0)
 D HSUM(MCSAP,MCDFN,MCB,MCE,MCOCC,"","|^~\&|","^TMP(""MCAR1"",$J)",.GLOBAL,MCTYP)
"RTN","MCORMN",123,0)
 I GLOBAL=0 S ^TMP("MCAR1",$J,1,0)=""
"RTN","MCORMN",124,0)
 Q
"VER")
8.0^22
**END**
**END**
