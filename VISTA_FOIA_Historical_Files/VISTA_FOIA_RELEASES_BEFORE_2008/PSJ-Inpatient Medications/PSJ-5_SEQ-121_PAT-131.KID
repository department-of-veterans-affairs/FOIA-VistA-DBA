Released PSJ*5*131 SEQ #121
Extracted from mail message
**KIDS**:PSJ*5.0*131^

**INSTALL NAME**
PSJ*5.0*131
"BLD",4890,0)
PSJ*5.0*131^INPATIENT MEDICATIONS^0^3050112^y
"BLD",4890,1,0)
^^7^7^3041222^
"BLD",4890,1,1,0)
 Currently the printed MAR does not show that an Inpatient Medication is
"BLD",4890,1,2,0)
 on hold.  This patch will update the 14 day, 7 day, and 24 hour MAR
"BLD",4890,1,3,0)
 reports to display "hold" on the report in place of the admin time.
"BLD",4890,1,4,0)
 This change will affect the following options:
"BLD",4890,1,5,0)
 PSJU 14D MAR - 14 Day MAR
"BLD",4890,1,6,0)
 PSJU 7D MAR - 7 Day MAR
"BLD",4890,1,7,0)
 PSJU 24H MAR - 24 Hour MAR
"BLD",4890,4,0)
^9.64PA^^
"BLD",4890,"ABPKG")
n
"BLD",4890,"KRN",0)
^9.67PA^8989.52^19
"BLD",4890,"KRN",.4,0)
.4
"BLD",4890,"KRN",.401,0)
.401
"BLD",4890,"KRN",.402,0)
.402
"BLD",4890,"KRN",.403,0)
.403
"BLD",4890,"KRN",.5,0)
.5
"BLD",4890,"KRN",.84,0)
.84
"BLD",4890,"KRN",3.6,0)
3.6
"BLD",4890,"KRN",3.8,0)
3.8
"BLD",4890,"KRN",9.2,0)
9.2
"BLD",4890,"KRN",9.8,0)
9.8
"BLD",4890,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",4890,"KRN",9.8,"NM",1,0)
PSGMAR^^0^B40463616
"BLD",4890,"KRN",9.8,"NM",2,0)
PSGMMAR^^0^B25479504
"BLD",4890,"KRN",9.8,"NM",3,0)
PSGMMAR2^^0^B33296503
"BLD",4890,"KRN",9.8,"NM",4,0)
PSGMMAR3^^0^B7209208
"BLD",4890,"KRN",9.8,"NM",5,0)
PSGMIV^^0^B28210747
"BLD",4890,"KRN",9.8,"NM",6,0)
PSGMUTL^^0^B22961901
"BLD",4890,"KRN",9.8,"NM",7,0)
PSGMAR2^^0^B12031682
"BLD",4890,"KRN",9.8,"NM",8,0)
PSGMAR3^^0^B18529283
"BLD",4890,"KRN",9.8,"NM",9,0)
PSGMMIV^^0^B24646294
"BLD",4890,"KRN",9.8,"NM","B","PSGMAR",1)

"BLD",4890,"KRN",9.8,"NM","B","PSGMAR2",7)

"BLD",4890,"KRN",9.8,"NM","B","PSGMAR3",8)

"BLD",4890,"KRN",9.8,"NM","B","PSGMIV",5)

"BLD",4890,"KRN",9.8,"NM","B","PSGMMAR",2)

"BLD",4890,"KRN",9.8,"NM","B","PSGMMAR2",3)

"BLD",4890,"KRN",9.8,"NM","B","PSGMMAR3",4)

"BLD",4890,"KRN",9.8,"NM","B","PSGMMIV",9)

"BLD",4890,"KRN",9.8,"NM","B","PSGMUTL",6)

"BLD",4890,"KRN",19,0)
19
"BLD",4890,"KRN",19,"NM",0)
^9.68A^^
"BLD",4890,"KRN",19.1,0)
19.1
"BLD",4890,"KRN",101,0)
101
"BLD",4890,"KRN",409.61,0)
409.61
"BLD",4890,"KRN",771,0)
771
"BLD",4890,"KRN",870,0)
870
"BLD",4890,"KRN",8989.51,0)
8989.51
"BLD",4890,"KRN",8989.52,0)
8989.52
"BLD",4890,"KRN",8994,0)
8994
"BLD",4890,"KRN","B",.4,.4)

"BLD",4890,"KRN","B",.401,.401)

"BLD",4890,"KRN","B",.402,.402)

"BLD",4890,"KRN","B",.403,.403)

"BLD",4890,"KRN","B",.5,.5)

"BLD",4890,"KRN","B",.84,.84)

"BLD",4890,"KRN","B",3.6,3.6)

"BLD",4890,"KRN","B",3.8,3.8)

"BLD",4890,"KRN","B",9.2,9.2)

"BLD",4890,"KRN","B",9.8,9.8)

"BLD",4890,"KRN","B",19,19)

"BLD",4890,"KRN","B",19.1,19.1)

"BLD",4890,"KRN","B",101,101)

"BLD",4890,"KRN","B",409.61,409.61)

"BLD",4890,"KRN","B",771,771)

"BLD",4890,"KRN","B",870,870)

"BLD",4890,"KRN","B",8989.51,8989.51)

"BLD",4890,"KRN","B",8989.52,8989.52)

"BLD",4890,"KRN","B",8994,8994)

"BLD",4890,"QUES",0)
^9.62^^
"BLD",4890,"REQB",0)
^9.611^1^1
"BLD",4890,"REQB",1,0)
PSJ*5.0*111^2
"BLD",4890,"REQB","B","PSJ*5.0*111",1)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
131^3050112^10000000043
"PKG",197,22,1,"PAH",1,1,0)
^^7^7^3050112
"PKG",197,22,1,"PAH",1,1,1,0)
 Currently the printed MAR does not show that an Inpatient Medication is
"PKG",197,22,1,"PAH",1,1,2,0)
 on hold.  This patch will update the 14 day, 7 day, and 24 hour MAR
"PKG",197,22,1,"PAH",1,1,3,0)
 reports to display "hold" on the report in place of the admin time.
"PKG",197,22,1,"PAH",1,1,4,0)
 This change will affect the following options:
"PKG",197,22,1,"PAH",1,1,5,0)
 PSJU 14D MAR - 14 Day MAR
"PKG",197,22,1,"PAH",1,1,6,0)
 PSJU 7D MAR - 7 Day MAR
"PKG",197,22,1,"PAH",1,1,7,0)
 PSJU 24H MAR - 24 Hour MAR
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","PSGMAR")
0^1^B40463616
"RTN","PSGMAR",1,0)
PSGMAR ;BIR/CML3-24 HOUR MAR - MAIN DRIVER ;14 Oct 98 / 4:27 PM
"RTN","PSGMAR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,15,20,111,131**;16 DEC 97
"RTN","PSGMAR",3,0)
 ;
"RTN","PSGMAR",4,0)
EN ;
"RTN","PSGMAR",5,0)
 NEW PSGOP
"RTN","PSGMAR",6,0)
 D ENCV^PSGSETU G:$D(XQUIT) DONE
"RTN","PSGMAR",7,0)
 D MARFORM^PSGMUTL G:PSGMARB=0 DONE S:PSGMARB'=1 PSGMARS=3
"RTN","PSGMAR",8,0)
 G:PSGMARB'=1 ENDATE F  R !!,"Print (C)ontinuous sheets, (P)RN sheets, or (B)oth? B// ",X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^CPB"[X&($L(X)<2)  W:X'?1."?" $C(7),"  ??" D:X?1."?" SHTH
"RTN","PSGMAR",9,0)
 G:X="^" DONE I X="" W "  (Both)" S PSGMARS=3
"RTN","PSGMAR",10,0)
 E  W $S(X="C":"ontinuous",X="P":"RN",1:"oth") S PSGMARS=$F("CPB",X)-1
"RTN","PSGMAR",11,0)
 ;
"RTN","PSGMAR",12,0)
ENDATE ; get start date
"RTN","PSGMAR",13,0)
 S %DT="ETX",Y=-1 F  W !!,"Enter START DATE/TIME for 24 hour MAR: " R X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" DH D ^%DT Q:Y>0
"RTN","PSGMAR",14,0)
 I Y'>0 W $C(7),!!?5,"(No date selected for MAR run.)" G DONE
"RTN","PSGMAR",15,0)
 S PSGMARDT=+$E(Y,1,10) D:$P(PSGMARDT,".",2)
"RTN","PSGMAR",16,0)
 .S PSGPLS=PSGMARDT,PSGPLF=$$EN^PSGCT(PSGPLS,-1),ST=$P(PSGPLS_0,".",2),FT=$P(PSGPLF_0,".",2)
"RTN","PSGMAR",17,0)
 .S PSGMARSD=$E(ST,1,2),PSGMARFD=$E(FT,1,2) S:'PSGMARSD PSGMARSD="01" S PSGMARFD=$S(+PSGMARSD=1:24,PSGMARSD=PSGMARFD:PSGMARSD-1,1:PSGMARFD) S:$L(PSGMARFD)<2 PSGMARFD=0_PSGMARFD
"RTN","PSGMAR",18,0)
 .I ST>1 S X1=$P(PSGPLF,"."),X2=1 D C^%DTC S PSGPLF=X
"RTN","PSGMAR",19,0)
 .S PSGPLS=+(PSGPLS_"."_ST),PSGPLF=+(PSGPLF_"."_FT)
"RTN","PSGMAR",20,0)
 .S PSGMARSP=$$ENDTC2^PSGMI(PSGPLS),PSGMARFP=$$ENDTC2^PSGMI(PSGPLF)
"RTN","PSGMAR",21,0)
 D NOW^%DTC S PSGDT=%,(PSGMARWG,PSJPWDO)=0,PSGMARWD=+$G(PSJPWD),PSGRBPPN=""
"RTN","PSGMAR",22,0)
 I '$D(PSGOENOF) S (PSGP,PSGPAT)=0,PSGSSH="MAR" D ^PSGSEL G:"^"[PSGSS OUT D @PSGSS G:$G(PSJSTOP) OUT
"RTN","PSGMAR",23,0)
 G:$$MEDTYPE^PSJMDIR(PSGMARWD) OUT S PSGMTYPE=Y
"RTN","PSGMAR",24,0)
 D DEV I POP!$D(IO("Q")) G DONE
"RTN","PSGMAR",25,0)
 ;
"RTN","PSGMAR",26,0)
ENQ ; when queued
"RTN","PSGMAR",27,0)
 N F,P,DRGI,DRGN,DRGT,PSIVUP,PSJORIFN,PSGMSORT
"RTN","PSGMAR",28,0)
 S PSJACNWP=1 U IO D ^PSGMAR0 I $D(^TMP($J))>9 D ^PSGMAR1
"RTN","PSGMAR",29,0)
 D ^%ZISC G DONE
"RTN","PSGMAR",30,0)
 ;
"RTN","PSGMAR",31,0)
OUT W $C(7),!!?5,"(No patient(s) selected for MAR run.)" K PSGPLF,PSGPLS
"RTN","PSGMAR",32,0)
DONE ;
"RTN","PSGMAR",33,0)
 I '$D(PSGOENOF) D ENKV^PSGSETU
"RTN","PSGMAR",34,0)
 K AD,ASTERS,BD,BLN,C,CNTR,DA1,DA2,DAO,DFN,DRG,DX,EXPIRE,FD,FT,HX,L,LN1,LN14,LN2,LN3,LN4,LN5,LN6,LN7,MOS,MSG1,MSG2,ND2,NG,OPST,PSJJORD,PAGE,PN,PND,PNN,PPN,PRB,PSEX,PSSN,PSGPLF,PSGPLS,PSGPLC,PSGPLO,QX,TMSTR,XX
"RTN","PSGMAR",35,0)
 K PSGADR,PSGALG,PSGD,PSGDW,PSGFORM,PSGMAR,PSGMARB,PSGMARDF,PSGMARDT,PSGMARED,PSGMARGD,PSGMARFD,PSGMARFP,PSGMAROC,PSGMARS,PSGMARSD,PSGL
"RTN","PSGMAR",36,0)
 K PSGMARSM,PSGMARSP,PSGMARTS,PSGMARWD,PSGMARWG,PSGMARWN,PSGMARWS,PSGMPG,PSGMPGN,PSGORD,PSGPAT,PSJDIET
"RTN","PSGMAR",37,0)
 K PSJSTOP,PSJPWDO,PSGMARO,ST,PSGSS,PSGSSH,PSTXDT,PST,PTM,PWDN,PSJACNWP,QST,R,RB,RCT,S,SD,SM,SPACES,TM,T,TD,TS,WD,WDN,WG,WGN,WS,WT,X1,X2,Y1,^TMP($J)
"RTN","PSGMAR",38,0)
 K PSGST,PSGTM,PSGTMALL,XTYPE,PSGLRPH,PSGMTYPE,PSGPG,PSGMFOR,PSGMTYPE,PSGPG,PSGRBPPN,PSGS0XT,PSGS0Y
"RTN","PSGMAR",39,0)
 K HT,ON,PSGOENOF,PSGOES,PSGRBPPN,PSGS0XT,PSGST,PSGTIR,PSGWD,XQUIT,ZTDES,ONHOLD
"RTN","PSGMAR",40,0)
 D ENKV^PSGLOI
"RTN","PSGMAR",41,0)
 Q
"RTN","PSGMAR",42,0)
 ;
"RTN","PSGMAR",43,0)
G ; get ward group
"RTN","PSGMAR",44,0)
 S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select WARD GROUP: " W ! D ^DIC K DIC D  I $G(PSJSTOP)=1 Q
"RTN","PSGMAR",45,0)
 . I X="^OTHER" S PSGMARWG="^OTHER" Q
"RTN","PSGMAR",46,0)
 . S PSGMARWG=+Y
"RTN","PSGMAR",47,0)
 . I +Y'>0 S PSJSTOP=1
"RTN","PSGMAR",48,0)
 D RBPPN^PSJMDIR
"RTN","PSGMAR",49,0)
 Q
"RTN","PSGMAR",50,0)
 ;
"RTN","PSGMAR",51,0)
W ; get ward
"RTN","PSGMAR",52,0)
 S DIC="^DIC(42,",DIC(0)="QEAMI",DIC("A")="Select WARD: " W ! D ^DIC K DIC S PSGMARWD=+Y I +Y'>0 S PSJSTOP=1 Q
"RTN","PSGMAR",53,0)
 S PSGWD=PSGMARWD D ADMTM^PSJMDIR
"RTN","PSGMAR",54,0)
 D:'PSJSTOP RBPPN^PSJMDIR
"RTN","PSGMAR",55,0)
 Q
"RTN","PSGMAR",56,0)
 ;
"RTN","PSGMAR",57,0)
P ; get patient
"RTN","PSGMAR",58,0)
 K PSGPAT S PSGPAT=0 F CNTR=0:1 S:CNTR PSGDICA="another" D ENP^PSGGAO:'PSGMARB,ENDPT^PSGP:PSGMARB Q:PSGP'>0  D
"RTN","PSGMAR",59,0)
 . S PSGPAT(PSGP)="",PSGPAT=PSGP
"RTN","PSGMAR",60,0)
 . ;*** PSGMARWD=1 when all patients are select from the same ward.
"RTN","PSGMAR",61,0)
 . S:'$G(PSJPWDO) (PSGMARWD,PSJPWDO)=PSJPWD S PSGMARWD=$S('$G(PSGMARWD):0,PSJPWDO=PSJPWD:PSJPWD,1:0)
"RTN","PSGMAR",62,0)
 S Y=PSGPAT S:Y'>0 PSJSTOP=1 K PSGDICA
"RTN","PSGMAR",63,0)
 Q
"RTN","PSGMAR",64,0)
 ;
"RTN","PSGMAR",65,0)
C ;
"RTN","PSGMAR",66,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGMAR",67,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGMAR",68,0)
CDIC ;
"RTN","PSGMAR",69,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMAR",70,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGMAR",71,0)
 Q
"RTN","PSGMAR",72,0)
L ;
"RTN","PSGMAR",73,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGMAR",74,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGMAR",75,0)
LDIC ;
"RTN","PSGMAR",76,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMAR",77,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGMAR",78,0)
 Q
"RTN","PSGMAR",79,0)
DEV ; ask print device and queue if asked to
"RTN","PSGMAR",80,0)
 K ZTSAVE S PSGTIR="ENQ^PSGMAR",ZTDESC="24 HOUR MAR" S:PSGMARB ZTSAVE("PSGMARS")="" F X="PSGMARWG","PSGMARWD","PSGP","PSGPAT(","PSGDT","PSGMARDT","PSGSS","PSGMARB","PSGMARDF","PSGMTYPE","PSGRBPPN","^TMP($J," S ZTSAVE(X)=""
"RTN","PSGMAR",81,0)
 I $P(PSGMARDT,".",2) F X="PSGPLS","PSGPLF","PSGMARSD","PSGMARFD","PSGMARSP","PSGMARFP" S ZTSAVE(X)=""
"RTN","PSGMAR",82,0)
 I PSGSS="W" F X="PSGTMALL","PSGTM","PSGTM(" S ZTSAVE(X)=""
"RTN","PSGMAR",83,0)
 D ENDEV^PSGTI W:POP !!?3,"No device selected for 24 hour MAR run." W:$D(ZTSK) !?3,"24 hour MAR Queued!" K ZTSK Q
"RTN","PSGMAR",84,0)
 I 'IO("Q") U IO
"RTN","PSGMAR",85,0)
 ;
"RTN","PSGMAR",86,0)
BH ;
"RTN","PSGMAR",87,0)
 W !!,"  Enter a 'Y' to print BLANK (no data) MARs for the patient(s) you select.",!,"Enter an 'N' (or press the RETURN key) to print MARs complete with orders.",!,"Enter an  '^' to exit this option now." Q
"RTN","PSGMAR",88,0)
 ;
"RTN","PSGMAR",89,0)
DH ;
"RTN","PSGMAR",90,0)
 W !!?2,"Enter the START DATE of the 24 hour period for which this MAR is to print.",!,"Unless the BLANK MARs are selected, all orders for the patient(s) selected that",!,"are (or were) active during the date range selected will print."
"RTN","PSGMAR",91,0)
 W !?2,"Time is not required.  If time is not entered, the default time is used (if",!,"found in the site parameters).  If the default time is not found, the start of",!,"the day is used." Q
"RTN","PSGMAR",92,0)
 ;
"RTN","PSGMAR",93,0)
SHTH ;
"RTN","PSGMAR",94,0)
 W !!?2,"Enter 'C' to print ONLY CONTINUOUS blank sheets for the patients selected.",!,"Enter 'P' to print ONLY PRN sheets.  Enter 'B' (or press RETURN) to print BOTH",!,"sheets for each patient." Q
"RTN","PSGMAR",95,0)
 ;
"RTN","PSGMAR",96,0)
ENLM ;
"RTN","PSGMAR",97,0)
 S PSGOENOF=1,PSGPAT(PSGP)="",PSGSS="P" G EN
"RTN","PSGMAR2")
0^7^B12031682
"RTN","PSGMAR2",1,0)
PSGMAR2 ;BIR/CML3-PRINT 24 HOUR MAR(UD) ;14 Oct 98 / 4:28 PM
"RTN","PSGMAR2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,111,131**;16 DEC 97
"RTN","PSGMAR2",3,0)
 ;
"RTN","PSGMAR2",4,0)
S1 I PSGMARB'=2 S:PSGMARS'=2 (PST,OPST)="C" D:PSGMARS'=2 HEADER^PSGMAR3,BOT^PSGMAR3 S:PSGMARS'=1 (PST,OPST)="P" D:PSGMARS'=1 HEADER^PSGMAR3,BOT^PSGMAR3 Q:PSGMARB=1
"RTN","PSGMAR2",5,0)
 D NOW^%DTC S PSGDT=%,(PST,OPST)=""
"RTN","PSGMAR2",6,0)
 S PSGMPG=0,PSGMPGN="PAGE: "
"RTN","PSGMAR2",7,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") D P Q
"RTN","PSGMAR2",8,0)
 D W
"RTN","PSGMAR2",9,0)
 Q
"RTN","PSGMAR2",10,0)
 ;
"RTN","PSGMAR2",11,0)
P ;***Print on Patient order
"RTN","PSGMAR2",12,0)
 I $O(^TMP($J,PN,0))'["C" S (PST,OPST)="C" D HEADER^PSGMAR3,BOT^PSGMAR3 S (PST,OPST)=""
"RTN","PSGMAR2",13,0)
 F  S PST=$O(^TMP($J,PN,PST)) Q:PST=""  D  D:$E(OPST)'=$E(PST) BOT^PSGMAR3:OPST]"" S OPST=PST
"RTN","PSGMAR2",14,0)
 . S PWDN="" F  S PWDN=$O(^TMP($J,PN,PST,PWDN)) Q:PWDN=""  D HEADER^PSGMAR3 S DAO="" F  S DAO=$O(^TMP($J,PN,PST,PWDN,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D PRT
"RTN","PSGMAR2",15,0)
 I $O(^TMP($J,PN,"CV6"))="" D BOT^PSGMAR3 S (PST,OPST)="O" D HEADER^PSGMAR3
"RTN","PSGMAR2",16,0)
 S PSGMPGN="LAST PAGE: " D BOT^PSGMAR3
"RTN","PSGMAR2",17,0)
 Q
"RTN","PSGMAR2",18,0)
 ;
"RTN","PSGMAR2",19,0)
W ;***Print Ward/Ward group
"RTN","PSGMAR2",20,0)
 I $S(PSGRBPPN="P":$O(^TMP($J,TM,WDN,PN,RB,0)),1:$O(^TMP($J,TM,WDN,RB,PN,0)))'["C" S (PST,OPST)="C" D HEADER^PSGMAR3,BOT^PSGMAR3 S (PST,OPST)=""
"RTN","PSGMAR2",21,0)
 D:PSGRBPPN="P" PPN D:PSGRBPPN="R" RB
"RTN","PSGMAR2",22,0)
 Q
"RTN","PSGMAR2",23,0)
 ;
"RTN","PSGMAR2",24,0)
PPN ;***Sort by Patient
"RTN","PSGMAR2",25,0)
 F  S PST=$O(^TMP($J,TM,WDN,PN,RB,PST)) Q:PST=""  D:$E(OPST)'=$E(PST) BOT^PSGMAR3:OPST]"",HEADER^PSGMAR3 S OPST=PST,DAO="" D
"RTN","PSGMAR2",26,0)
 . F  S DAO=$O(^TMP($J,TM,WDN,PN,RB,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D PRT
"RTN","PSGMAR2",27,0)
 I $O(^TMP($J,TM,WDN,PN,RB,"CV6"))="" D BOT^PSGMAR3 S (PST,OPST)="O" D HEADER^PSGMAR3
"RTN","PSGMAR2",28,0)
 S PSGMPGN="LAST PAGE: " D BOT^PSGMAR3
"RTN","PSGMAR2",29,0)
 Q
"RTN","PSGMAR2",30,0)
 ;
"RTN","PSGMAR2",31,0)
RB ;***Sort by Room bed
"RTN","PSGMAR2",32,0)
 F  S PST=$O(^TMP($J,TM,WDN,RB,PN,PST)) Q:PST=""  D:$E(OPST)'=$E(PST) BOT^PSGMAR3:OPST]"",HEADER^PSGMAR3 S OPST=PST,DAO="" D
"RTN","PSGMAR2",33,0)
 . F  S DAO=$O(^TMP($J,TM,WDN,RB,PN,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D PRT
"RTN","PSGMAR2",34,0)
 I $O(^TMP($J,TM,WDN,RB,PN,"CV6"))="" D BOT^PSGMAR3 S (PST,OPST)="O" D HEADER^PSGMAR3
"RTN","PSGMAR2",35,0)
 S PSGMPGN="LAST PAGE: " D BOT^PSGMAR3
"RTN","PSGMAR2",36,0)
 Q
"RTN","PSGMAR2",37,0)
 ;
"RTN","PSGMAR2",38,0)
PRT ; order info
"RTN","PSGMAR2",39,0)
 NEW MARLB,DRUGNAME,NAME
"RTN","PSGMAR2",40,0)
 S ON=$P(DAO,U,2) D ONHOLD^PSGMMAR2
"RTN","PSGMAR2",41,0)
 I +PSGMSORT,$S(ON["V":1,ON["P":$P($G(^PS(53.1,+ON,0)),U,4)="F",1:0) D PRT^PSGMIV Q
"RTN","PSGMAR2",42,0)
 D:PSGMAROC>5 ENB^PSGMAR3,HEADER^PSGMAR3 I PST["V" D PRT^PSGMIV Q
"RTN","PSGMAR2",43,0)
 S TMSTR=$P(PSGMARTS,"^",2),PSGMARTS=$P(PSGMARTS,"^"),PSGORD=$P(DAO,U,2) S:PSGORD["P" PSJPSTO=PST,PST=$S(+PSGMSORT:"CZ",1:PST) D ^PSGLOI,TS^PSGMAR3(PSGMARTS),MARLB^PSGMUTL(47)
"RTN","PSGMAR2",44,0)
 I (PSGMAROC>4&(MARLB>6))!(TS/6>6)!((TS/6+PSGMAROC)>6) D BOT^PSGMAR3,HEADER^PSGMAR3
"RTN","PSGMAR2",45,0)
 S PSGMAROC=PSGMAROC+1
"RTN","PSGMAR2",46,0)
 NEW PSGX F PSGX=1:1:MARLB W !,MARLB(PSGX) W:PST["C" ?48,"|",$G(TS(PSGX)) D PRT2
"RTN","PSGMAR2",47,0)
 I $D(PSJPSTO) S PST=PSJPSTO K PSJPSTO
"RTN","PSGMAR2",48,0)
 Q
"RTN","PSGMAR2",49,0)
PRT2 ;
"RTN","PSGMAR2",50,0)
 W ?55,"|"
"RTN","PSGMAR2",51,0)
 I PSGX=3,(PST'["Z"),(PST["C") D TMSTR^PSGMAR3
"RTN","PSGMAR2",52,0)
 I PSGMAROC>5,(TS/6>7) D
"RTN","PSGMAR2",53,0)
 . S MSG1="*** CONTINUE ON NEXT PAGE ***"
"RTN","PSGMAR2",54,0)
 . D BOT^PSGMAR3,HEADER^PSGMAR3
"RTN","PSGMAR2",55,0)
 I PSGX#6=0 W:PSGMAROC<6 !?7,LN2 S:PSGX'=MARLB PSGMAROC=PSGMAROC+1
"RTN","PSGMAR2",56,0)
 Q
"RTN","PSGMAR3")
0^8^B18529283
"RTN","PSGMAR3",1,0)
PSGMAR3 ;BIR/CML3-24 HOUR MAR(HEADER,BOT) ;14 Oct 98 / 4:28 PM
"RTN","PSGMAR3",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,20,85,111,131**;16 DEC 97
"RTN","PSGMAR3",3,0)
 ;
"RTN","PSGMAR3",4,0)
 ;
"RTN","PSGMAR3",5,0)
HEADER ; pat info
"RTN","PSGMAR3",6,0)
 S:'$G(PSGXDT) PSGXDT=PSGDT
"RTN","PSGMAR3",7,0)
 S PSGFORM="VA FORM 10-"_$S(PST["C":"2970",1:"5568d")
"RTN","PSGMAR3",8,0)
 S PSGMAROC=0,(MSG1,MSG2)="",PSGL=$E("|",PST["C")_" " W:$G(PSGPG)&($Y) @IOF S PSGPG=1 W !,$S(PST["C":"CONTINUOUS",1:"ONE-TIME/PRN")_" SHEET",?60,"24 HOUR MAR",?86,PSGMARSP_"  through  "_PSGMARFP
"RTN","PSGMAR3",9,0)
 W !?5,$P($$SITE^PSGMMAR2(80),U,2),?101,"Printed on   "_$$ENDTC2^PSGMI(PSGXDT)
"RTN","PSGMAR3",10,0)
 W !?5,"Name:  "_PPN,?62,"Weight (kg): "_WT,?103,"Loc: "_$S(PWDN'["C!":PWDN,1:$P($G(^SC($P(PWDN,"!",2),0)),"^"))
"RTN","PSGMAR3",11,0)
 W !?6,"PID:  "_PSSN,?25,"DOB: "_BD_"  ("_PAGE_")",?62,"Height (cm): "_HT,?99,"Room-Bed: "_$S(PWDN'["C!":PRB,1:"")
"RTN","PSGMAR3",12,0)
 W !?6,"Sex:  "_PSEX,?25," Dx: "_DX,?$S(TD:94,1:99),$S(TD:"Last Transfer: "_TD,1:"Admitted: "_$S(PWDN'["C!":AD,1:""))
"RTN","PSGMAR3",13,0)
 I '$D(PSGALG) W !,"Allergies:  See attached list of Allergies/Adverse Reactions"
"RTN","PSGMAR3",14,0)
 NEW PSGX S PSGX=0 D ATS(.PSGX) D:PSGX HEADER Q:PSGX
"RTN","PSGMAR3",15,0)
 W !,?49,"Admin"
"RTN","PSGMAR3",16,0)
 W:$G(PSJDIET)]"" ?57,"Diet: ",PSJDIET
"RTN","PSGMAR3",17,0)
 W !?1,"Order",?8,"Start",?20,"Stop",?49,"Times" W ?59 F X=PSGMARSD:1 S:X>24 X=1 W $S(X<10:0_X,1:X)," " Q:X=+PSGMARFD
"RTN","PSGMAR3",18,0)
 W !,LN1
"RTN","PSGMAR3",19,0)
 Q
"RTN","PSGMAR3",20,0)
 ;
"RTN","PSGMAR3",21,0)
ATS(PSGX) ;*** Print allergies and reactions.
"RTN","PSGMAR3",22,0)
 I '$D(PSGALG),'$D(PSGVALG),'$D(PSGADR),'$D(PSGVADR) Q
"RTN","PSGMAR3",23,0)
 I (PSGALG+PSGADR+PSGVALG+PSGVADR)<116 D  Q
"RTN","PSGMAR3",24,0)
 . I PSGALG(1)["NKA",(PSGVALG(1)["NKA") S PSGALG(1)=""
"RTN","PSGMAR3",25,0)
 . I PSGALG=20,(PSGALG(1)["_______") S PSGALG(1)=""
"RTN","PSGMAR3",26,0)
 . I PSGALG(1)]"",(PSGVALG(1)["NKA") S PSGALG(1)=""
"RTN","PSGMAR3",27,0)
 . I PSGADR=20,(PSGADR(1)["_______") S PSGADR(1)=""
"RTN","PSGMAR3",28,0)
 . S:PSGVALG(1)="" PSGVALG(1)="No Allergy Assessment"
"RTN","PSGMAR3",29,0)
 . W !,"Allergies:  ",PSGVALG(1)," ",PSGALG(1),"   ADR: ",PSGVADR(1)," ",PSGADR(1)
"RTN","PSGMAR3",30,0)
 S PSGX=1
"RTN","PSGMAR3",31,0)
 W !!,"Verified Allergies:",!
"RTN","PSGMAR3",32,0)
 F X=0:0 S X=$O(PSGVALG(X)) Q:'X  W ?12,PSGVALG(X),!
"RTN","PSGMAR3",33,0)
 W !!,"Non-Verified Allergies:",!
"RTN","PSGMAR3",34,0)
 F X=0:0 S X=$O(PSGALG(X)) Q:'X  W ?12,PSGALG(X),!
"RTN","PSGMAR3",35,0)
 W !!,"Verified Adverse Reactions:",!
"RTN","PSGMAR3",36,0)
 F X=0:0 S X=$O(PSGVADR(X)) Q:'X  W ?12,PSGVADR(X),!
"RTN","PSGMAR3",37,0)
 W !!,"Non-Verified Adverse Reactions:",!
"RTN","PSGMAR3",38,0)
 F X=0:0 S X=$O(PSGADR(X)) Q:'X  W ?12,PSGADR(X),!
"RTN","PSGMAR3",39,0)
 K PSGALG,PSGADR,PSGVALG,PSGVADR
"RTN","PSGMAR3",40,0)
 Q
"RTN","PSGMAR3",41,0)
TMSTR ;*** Set up the Admin times to print across on the 24 hour MAR.
"RTN","PSGMAR3",42,0)
 ;BHW;Added/modified next 2 lines to account for admin times between 0000 and 0059
"RTN","PSGMAR3",43,0)
 N ADMINHR
"RTN","PSGMAR3",44,0)
 W ?59 S MPH=PSGPLS\1,(HRS,TIM)="" F MPH=1:1:$L(TMSTR,"-") S ADMINHR=$E($P(TMSTR,"-",MPH),1,2) S:ADMINHR="00" ADMINHR=24 S HRS=HRS_ADMINHR_"-"
"RTN","PSGMAR3",45,0)
 F Q=PSGMARSD:1 D:Q>24 ADD S:Q>24 Q=1 S QQ=$S(Q<10:"0"_Q,Q>24:"01",1:Q) S:HRS[QQ TIM=$P(HRS,"-",($F(HRS,QQ)/3)) S TIM=$S(HRS[QQ&(TIM=(QQ_"00")):QQ,HRS[QQ:TIM,1:"  ") W $S(MPH_"."_QQ'<PSGLFFD:"***",($G(ONHOLD)&TIM):"HLD",1:TIM_" ") Q:Q=+PSGMARFD
"RTN","PSGMAR3",46,0)
 K HRS,TIM,MPH Q
"RTN","PSGMAR3",47,0)
ADD ;
"RTN","PSGMAR3",48,0)
 S X1=$P(MPH,"."),X2=1 D C^%DTC S MPH=X
"RTN","PSGMAR3",49,0)
 Q
"RTN","PSGMAR3",50,0)
 ;
"RTN","PSGMAR3",51,0)
TS(X) ;
"RTN","PSGMAR3",52,0)
 K TS S TS=$S(PST["C":$L(X,"-"),1:0) F Q=1:1:$S(TS<6:6,1:TS) S TS(Q)=""
"RTN","PSGMAR3",53,0)
 S:TS=1 TS(3)=$P(X,"-")
"RTN","PSGMAR3",54,0)
 S:TS=2 TS(1)=$P(X,"-"),TS(5)=$P(X,"-",2)
"RTN","PSGMAR3",55,0)
 S:TS=3 TS(1)=$P(X,"-"),TS(3)=$P(X,"-",2),TS(5)=$P(X,"-",3)
"RTN","PSGMAR3",56,0)
 I TS>3 F Q=1:1:TS S TS(Q)=$P(X,"-",Q)
"RTN","PSGMAR3",57,0)
 Q
"RTN","PSGMAR3",58,0)
 ;
"RTN","PSGMAR3",59,0)
BOT ; bottom of MAR
"RTN","PSGMAR3",60,0)
 I MSG1]"" F QQ=1:1:6 W ! W:QQ=1 ?7,"|",?19,"|" W:34[QQ ?12,$S(QQ=3:MSG1,1:MSG2) W ?55,$S(1:"|",OPST'["C":LN5,QQ<6:LN4,1:LN7)
"RTN","PSGMAR3",61,0)
 I PSGMAROC<6 S PSGMAROC=6-PSGMAROC F Q=1:1:PSGMAROC F QQ=1:1:6 W ! W:QQ=1 ?7,"|",?19,"|" W:34[QQ ?12,$S(QQ=3:MSG1,1:MSG2) W ?55,$S(1:"",OPST'["C":LN5,QQ<6:LN4,1:LN7) I QQ=6,Q<PSGMAROC W !?7,LN2
"RTN","PSGMAR3",62,0)
ENB ;
"RTN","PSGMAR3",63,0)
 I $D(PSGMPG) S PSGMPG=PSGMPG+1 S PSGMPGN=$S(PSGMPGN'["LAST":"PAGE: ",1:PSGMPGN)_PSGMPG
"RTN","PSGMAR3",64,0)
 W !,LN1
"RTN","PSGMAR3",65,0)
 W !,"|",?12,"SIGNATURE/TITLE",?39,"| INIT |  ALLERGIES   |  INJECTION SITES   |",?87,"MED/DOSE OMITTED",?107,"|     REASON     | INIT |"
"RTN","PSGMAR3",66,0)
 F Q=1:1:10 W !,"|"_$E(LN1,1,38)_"|------|--------------|"_BLN(Q),?82,"|"_$E(LN1,1,24)_"|"_$E(LN1,1,16)_"|------|"
"RTN","PSGMAR3",67,0)
 W !,LN1,!?3,PPN,?45,PSSN,?58,"Room-Bed: "_$S(PWDN'["C!":PRB,1:""),?100,$S($D(PSGMPG):PSGMPGN,1:""),?116,PSGFORM
"RTN","PSGMAR3",68,0)
 Q
"RTN","PSGMIV")
0^5^B28210747
"RTN","PSGMIV",1,0)
PSGMIV ;BIR/MV-IV ORDER FOR THE 24 HOUR MAR. ;25 Nov 98 / 9:07 AM
"RTN","PSGMIV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,20,21,28,58,111,131**;16 DEC 97
"RTN","PSGMIV",3,0)
 ;
"RTN","PSGMIV",4,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMIV",5,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSGMIV",6,0)
 ;
"RTN","PSGMIV",7,0)
START ;*** Read IV orders
"RTN","PSGMIV",8,0)
 S ON=""
"RTN","PSGMIV",9,0)
 F PSGMARED=PSGPLS-.0001:0 S PSGMARED=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED)) Q:'PSGMARED  F  S ON=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED,ON)) Q:ON=""  D IV
"RTN","PSGMIV",10,0)
 Q
"RTN","PSGMIV",11,0)
IV ;*** Sort IV orders for 24 Hrs MAR.
"RTN","PSGMIV",12,0)
 K DRG,P N X,ON55,PSJLABEL S DFN=PSGP,PSJLABEL=1 D GT55^PSIVORFB
"RTN","PSGMIV",13,0)
 Q:P(2)>PSGPLF
"RTN","PSGMIV",14,0)
 S X=$P(P("MR"),U,2) Q:XTYPE=2&(X["IV")  Q:XTYPE=3&(PST="S")&'($S(X="IV":1,X="IVPB":1,1:0))
"RTN","PSGMIV",15,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGMIV",16,0)
 S QST=$S(P(9)["PRN":"OVP",QST="O":"OVO",1:"CV")_XTYPE
"RTN","PSGMIV",17,0)
 I DRG S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),X=$E($P(X,U,2),1,20)_U_ON_"V" D
"RTN","PSGMIV",18,0)
 . I PSGSS="P"!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),$S(PSGMARWN'["C!":"A",1:PSGMARWN),X)="" Q
"RTN","PSGMIV",19,0)
 . S:PSGRBPPN="P" ^TMP($J,TM,PSGMARWN,PPN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMIV",20,0)
 . S:PSGRBPPN="R" ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMIV",21,0)
 Q
"RTN","PSGMIV",22,0)
PRT ;*** Print IV orders.
"RTN","PSGMIV",23,0)
 K TS,P,DRG NEW ON55,LN,PSJLABEL S PSJLABEL=1
"RTN","PSGMIV",24,0)
 S ON=$P(DAO,U,2),DFN=$P(PN,U,2) D:ON["V" GT55^PSIVORFB
"RTN","PSGMIV",25,0)
 D:ON["P" GT531^PSIVORFA(DFN,ON)
"RTN","PSGMIV",26,0)
 S TS=1,TMSTR="" I P(9)]"" D ORSET,TS^PSGMAR3(P(11))
"RTN","PSGMIV",27,0)
 F X="LOG",2,3 S:P(X) P(X)=$$ENDTC1^PSGMI(P(X))
"RTN","PSGMIV",28,0)
 S PSGST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I PSGST'="O" S PSGST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSGMIV",29,0)
 S PSGLFFD=PSGPLF
"RTN","PSGMIV",30,0)
 D INITOPI^PSGMMIVC
"RTN","PSGMIV",31,0)
 NEW NAMENEED,NEED,X S NAMENEED=0
"RTN","PSGMIV",32,0)
 D LNNEED,PRTIV
"RTN","PSGMIV",33,0)
 Q
"RTN","PSGMIV",34,0)
LNNEED ;*** Find lines needed per label.
"RTN","PSGMIV",35,0)
 ;*** If OPI<29 char, it is ok to put INITs in the same line.
"RTN","PSGMIV",36,0)
 ;*** Add number of lines needed for additives and solutions and 1 line
"RTN","PSGMIV",37,0)
 ;*** for infusion rate and x line for OPI. Divide by 5 to determine
"RTN","PSGMIV",38,0)
 ;*** of label(s) needed for this order.
"RTN","PSGMIV",39,0)
 F X="AD","SOL" D NAMENEED^PSJMUTL(X,47,.NEED) S NAMENEED=NAMENEED+NEED
"RTN","PSGMIV",40,0)
 S X=($L($P(P("OPI"),"^"))\47)+(($L($P(P("OPI"),"^"))#47)>28)+1+($P(P("OPI"),"^")]""&(P(4)="C"))
"RTN","PSGMIV",41,0)
 S X=(NAMENEED+X+2) S X=$S(X<6:1,1:((X-6)\5)+2)
"RTN","PSGMIV",42,0)
 S LN=$S(TS/6>X:TS/6,1:X)
"RTN","PSGMIV",43,0)
 Q
"RTN","PSGMIV",44,0)
 ;
"RTN","PSGMIV",45,0)
OS ; order record set
"RTN","PSGMIV",46,0)
 Q
"RTN","PSGMIV",47,0)
 ;
"RTN","PSGMIV",48,0)
PRTIV ;*** Print IV order on MAR
"RTN","PSGMIV",49,0)
 D ONHOLD^PSGMMAR2
"RTN","PSGMIV",50,0)
 I PSGMAROC,(PSGMAROC+LN)>6 D BOT^PSGMAR3,HEADER^PSGMAR3
"RTN","PSGMIV",51,0)
 NEW PSGL S PSGL="|"
"RTN","PSGMIV",52,0)
 S PSGMAROC=PSGMAROC+1 W !?6,"|",?19,"|",?48,PSGL,$G(TS(1)),?55,"|"
"RTN","PSGMIV",53,0)
 W !,$E(P("LOG"),1,5)," |"
"RTN","PSGMIV",54,0)
 I ON["V" D
"RTN","PSGMIV",55,0)
 . I $G(ONHOLD) W "O N  H O L D" Q
"RTN","PSGMIV",56,0)
 . W $E(P(2),1,5)_$E(P(2),9,14)," |",P(3)
"RTN","PSGMIV",57,0)
 . Q
"RTN","PSGMIV",58,0)
 W:ON["P" "P E N D I N G"
"RTN","PSGMIV",59,0)
 W ?39,"(",$E(PSGP(0))_$E(PSSN,8,12)_")"
"RTN","PSGMIV",60,0)
 W ?48,PSGL,$G(TS(2)),?55,"|" S L=3
"RTN","PSGMIV",61,0)
 NEW NAME,PSIVX
"RTN","PSGMIV",62,0)
 F PSIVX=0:0 S PSIVX=$O(DRG("AD",PSIVX)) Q:'PSIVX  D NAME^PSIVUTL(DRG("AD",PSIVX),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  W !,NAME(Y) W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:(PSIVX=1&((PSGST="O")!(PSGST="C"))) TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",63,0)
 W:$G(DRG("SOL",0)) !,"in "
"RTN","PSGMIV",64,0)
 NEW PSJPRT2
"RTN","PSGMIV",65,0)
 F PSIVX=0:0 S PSIVX=$O(DRG("SOL",PSIVX)) Q:'PSIVX  D NAME^PSIVUTL(DRG("SOL",PSIVX),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  D
"RTN","PSGMIV",66,0)
 . W:(Y>1!(PSIVX>1)) ! W ?4,NAME(Y) W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:L=3 TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",67,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",PSIVX),0),U,4) I PSJPRT2]"" W !?7,PSJPRT2 W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:L=3 TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",68,0)
 W !,$P(P("MR"),U,2)," ",P(9)," ",P(8) W ?48,PSGL,$G(TS(L)),?55,"|" I L>5,(L#5) W !
"RTN","PSGMIV",69,0)
 I '$O(DRG("AD",0))!('$O(DRG("SOL",0))) W !?48,PSGL,$G(TS(L)),?55,"|" S L=5
"RTN","PSGMIV",70,0)
 I P(4)="C",'(L#5),P("OPI")="" W !,"*CAUTION-CHEMOTHERAPY*" S L=L+1 Q
"RTN","PSGMIV",71,0)
 I P(4)="C" D L(1) W !,"*CAUTION-CHEMOTHERAPY*",?48,PSGL,$G(TS(L)),?55,"|"
"RTN","PSGMIV",72,0)
 I (L#5)=0,($L($P(P("OPI"),"^"))<29),(TS<7) S L=L+1
"RTN","PSGMIV",73,0)
 E  D L(1)
"RTN","PSGMIV",74,0)
 W:P("OPI")=""&(TS>6) !
"RTN","PSGMIV",75,0)
 I P("OPI")'="" D
"RTN","PSGMIV",76,0)
 . W:(L#6)=1 !
"RTN","PSGMIV",77,0)
 . F Y=1:1:$L($P(P("OPI"),"^")," ") S Y1=$P($P(P("OPI"),"^")," ",Y) D  W Y1," "
"RTN","PSGMIV",78,0)
 . I ($X+$L(Y1))>47 W ?48,PSGL,$G(TS(L)),?55,"|" D L(1) W !
"RTN","PSGMIV",79,0)
 I L>TS,(L#6) W ?48,PSGL,$G(TS(L)),?55,"|" S L=L+1 W:L#6=0 !
"RTN","PSGMIV",80,0)
 I (TS-1)>L W ?48,PSGL,$G(TS(L)),?55,"|" D
"RTN","PSGMIV",81,0)
 . F L=L+1:1:TS-1 D L(0) W !?48,PSGL,$G(TS(L)),?55,"|"
"RTN","PSGMIV",82,0)
 . S L=L+1
"RTN","PSGMIV",83,0)
 F  Q:'(L#6)  W !?48,PSGL,$G(TS(L)),?55,"|" S L=L+1
"RTN","PSGMIV",84,0)
 I '(L#6),(P("OPI")="") W !
"RTN","PSGMIV",85,0)
 I P("OPI")]"",(L>6) W !
"RTN","PSGMIV",86,0)
 W ?29,"RPH: ",PSGLRPH,?38,"RN: ",PSGLRN,?48,PSGL,$G(TS(L)),?55,"|" W:PSGMAROC<6 !?7,LN2
"RTN","PSGMIV",87,0)
 Q
"RTN","PSGMIV",88,0)
 ;
"RTN","PSGMIV",89,0)
L(X) ;***Check to see if a new block is needed.
"RTN","PSGMIV",90,0)
 S L=L+X
"RTN","PSGMIV",91,0)
 I L#6=0,PSGMAROC<6 W !,"See next label for continuation",?48,PSGL,$G(TS(L)),?55,"|" W:PSGMAROC<6 !?7,LN2 S PSGMAROC=PSGMAROC+1,L=L+1 D
"RTN","PSGMIV",92,0)
 .I LN>6,(PSGMAROC>5) S MSG1="*** CONTINUE ON NEXT PAGE ***" D BOT^PSGMAR3,HEADER^PSGMAR3 S PSGMAROC=1
"RTN","PSGMIV",93,0)
 Q
"RTN","PSGMIV",94,0)
ORSET ; order record set
"RTN","PSGMIV",95,0)
 Q:PST["P"!P(9)=""
"RTN","PSGMIV",96,0)
 S PSGMFOR="",(SD,X)=$P(P(2),".") Q:X>PSGPLF  S FD=$P(P(3),"."),PSGOES="",X=P(9) D EN^PSGS0 S T=PSGS0XT
"RTN","PSGMIV",97,0)
 S X="" I "OB"]PST,$P(P(9),"^")'["@",P(2)'>PSGPLS,P(3)'<PSGPLF,P(11),T<1441,T'="D" S X=P(11),PSGPLC=1
"RTN","PSGMIV",98,0)
 E  I "OB"]PST!(PST["OV") K PSGMAR D SETL0 S (Q,X)="" F QX=0:0 S Q=$O(PSGMAR(Q)) Q:Q=""  S X=X_$E("0",2-$L(Q))_Q_"-"
"RTN","PSGMIV",99,0)
 S TMSTR=X
"RTN","PSGMIV",100,0)
 K HCD,HM,I,J,PSGD,PLSD,CD,M,MID,MN,ND,ND1,OD,ST,QD1,QD2,QQ,TS,UD,WDT,WS,WS1,X,X1,X2 Q
"RTN","PSGMIV",101,0)
 Q
"RTN","PSGMIV",102,0)
SETL0 ;*** Set variable to use in ^PSGPL0 to calculate admin time.
"RTN","PSGMIV",103,0)
 K PSGMAR S PSGPLC=0
"RTN","PSGMIV",104,0)
 S ND1=P(4),ST=P(2),PLSD=P(3),TS=P(11),MN=T,ND=P(9) I $S(ST'?7N1"."1N.E:1,1:PLSD'?7N1"."1N.E) S PSGPLC="OI" Q
"RTN","PSGMIV",105,0)
 D ENIV^PSGPL0
"RTN","PSGMIV",106,0)
 Q
"RTN","PSGMIV",107,0)
 ;
"RTN","PSGMIV",108,0)
RPHINIT(RPH) ; Find initial for the person who completed the IV order.
"RTN","PSGMIV",109,0)
 S RPH=$P($G(^PS(55,PSGP,"IV",+ON,4)),U,4)
"RTN","PSGMIV",110,0)
 S:+RPH RPH=$$DEFINIT(+RPH)
"RTN","PSGMIV",111,0)
 I RPH="" S RPH="_____"
"RTN","PSGMIV",112,0)
 Q
"RTN","PSGMIV",113,0)
DEFINIT(X)         ;
"RTN","PSGMIV",114,0)
 S X=$G(^VA(200,X,0)),RPH=$P(X,U,2) Q:RPH]"" RPH
"RTN","PSGMIV",115,0)
 S X=$P(X,U),RPH=$E(X,$F(X,","))_$E(X) Q RPH
"RTN","PSGMMAR")
0^2^B25479504
"RTN","PSGMMAR",1,0)
PSGMMAR ;BIR/CML3-MULTIPLE DAY MARS - MAIN DRIVER ;14 Oct 98 / 4:28 PM
"RTN","PSGMMAR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**15,20,110,111,131**;16 DEC 97
"RTN","PSGMMAR",3,0)
 F  R !!,"HOW MANY DAYS? (7/14) ",PSGMARDF:DTIME S:'$T PSGMARDF="^" Q:"^"[PSGMARDF  Q:PSGMARDF=7!(PSGMARDF=14)  W $C(7),"  7 OR 14 DAY MAR!!"
"RTN","PSGMMAR",4,0)
 G:"^"[PSGMARDF DONE G EN
"RTN","PSGMMAR",5,0)
 ;
"RTN","PSGMMAR",6,0)
EN7 ;
"RTN","PSGMMAR",7,0)
 S PSGMARDF=7 G EN
"RTN","PSGMMAR",8,0)
 ;
"RTN","PSGMMAR",9,0)
EN14 ;
"RTN","PSGMMAR",10,0)
 S PSGMARDF=14
"RTN","PSGMMAR",11,0)
 ;
"RTN","PSGMMAR",12,0)
EN ;
"RTN","PSGMMAR",13,0)
 NEW DRUGNAME,F,MARLB,NAME,UP,PSGOP
"RTN","PSGMMAR",14,0)
 D ENCV^PSGSETU G:$D(XQUIT) DONE K PSGMAROF
"RTN","PSGMMAR",15,0)
 ;
"RTN","PSGMMAR",16,0)
EN1 ;
"RTN","PSGMMAR",17,0)
 D MARFORM^PSGMUTL G:'PSGMARB DONE
"RTN","PSGMMAR",18,0)
 ;
"RTN","PSGMMAR",19,0)
ENOE ;
"RTN","PSGMMAR",20,0)
 D SD^PSGMMARH W ! D ^DIR K DIR,DTOUT,DUOUT,DIRUT,DIROUT G:"^"[$E(Y) DONE S PSGMARS=$F("CPBO",Y)-1
"RTN","PSGMMAR",21,0)
 ;
"RTN","PSGMMAR",22,0)
DATE ;
"RTN","PSGMMAR",23,0)
 S %DT="ETSX",Y=-1 F  W !!,"Enter START DATE/TIME for "_PSGMARDF_" day MAR: " R X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" DH^PSGMMARH D ^%DT Q:Y>0
"RTN","PSGMMAR",24,0)
 I Y'>0 W $C(7),!!?5,"(No date selected, or MAR run.)" G DONE
"RTN","PSGMMAR",25,0)
 S PSGMARSD=+Y,X1=$P(+Y,"."),X2=PSGMARDF-1 D C^%DTC S PSGMARFD=X
"RTN","PSGMMAR",26,0)
 D NOW^%DTC S PSGDT=%,(PSGMARWG,PSJPWDO)=0,PSGRBPPN="",PSGMARWD=+$G(PSJPWD)
"RTN","PSGMMAR",27,0)
 I '$G(PSGMAROF),'$G(PSGOENOF)!($G(PSGSS)="") S (PSGP,PSGPAT,PSGMARWD)=0,PSGSSH="MAR" D ^PSGSEL G:"^"[PSGSS OUT D @PSGSS G:$G(PSJSTOP) OUT
"RTN","PSGMMAR",28,0)
 I PSGMARB'=1 G:$$MEDTYPE^PSJMDIR(PSGMARWD) OUT S PSGMTYPE=Y
"RTN","PSGMMAR",29,0)
 D DEV I POP!$D(IO("Q")) G DONE
"RTN","PSGMMAR",30,0)
 ;
"RTN","PSGMMAR",31,0)
ENQ ; when queued
"RTN","PSGMMAR",32,0)
 N DRGI,DRGN,DRGT,LN,P,PSIVUP,PSJORIFN,PSGMSORT
"RTN","PSGMMAR",33,0)
 D ^PSGMMAR0 I $D(^TMP($J))>9 D ^PSGMMAR1 K ^TMP($J)
"RTN","PSGMMAR",34,0)
 D ^%ZISC G DONE
"RTN","PSGMMAR",35,0)
 ;
"RTN","PSGMMAR",36,0)
OUT W $C(7),!!?5,"(No patient(s) selected for MAR run.)" K PSGPLF,PSGPLS
"RTN","PSGMMAR",37,0)
DONE ;
"RTN","PSGMMAR",38,0)
 I '$D(PSGOENOF),'$D(PSGVBY) D ENKV^PSGSETU
"RTN","PSGMMAR",39,0)
 K:'$D(PSGVBY) PSGSS,PSGSSH
"RTN","PSGMMAR",40,0)
 D ENKV^PSGLOI
"RTN","PSGMMAR",41,0)
 K AD,ASTERS,BD,BLN,CNTR,DA1,DA2,DAO,DIC,DRG,DX,EXPIRE,FD,HX,L,LN1,LN14,LN2,LN3,LN31,LN32,LN4,LN5,LN6,LN7
"RTN","PSGMMAR",42,0)
 K MOS,MSG1,MSG2,N,ND2,NAMENEED,NEED,OPST,PSJJORD,PAGE,PN,PND,PNN,PPN,PRB,PSEX,PSSN,PSGMAPA,PSGMAPB,PSGMAPC,PSGMAPD,PSGADR,PSGALG,PSGS0Y,PSGXDT
"RTN","PSGMMAR",43,0)
 K PSGD,PSGDW,PSGMAR,PSGMARB,PSGMARDF,PSGMARED,PSGMARGD,PSGMARFD,PSGMARFP,PSGMAROC,PSGMAROF,PSGMARPT,PSGMARS,PSGMARSD,PSGMARSM,PSGMARSP
"RTN","PSGMMAR",44,0)
 K PSGMARTS,PSGMARWD,PSGMARWG,PSGMARWN,PSGMARWS,PSGMPG,PSGMPGN,PSGORD,PSGPAT,PSJDIET
"RTN","PSGMMAR",45,0)
 K DFN,NG,NO,ON,PST,PTM,PWDN,QST,PSJACNWP,R,RB,RCT,S,SD,SM,SPACES,TM,T,TD,TS,WD,WDN,WG,WGN,WS,WT,X1,X2,Y1
"RTN","PSGMMAR",46,0)
 K PSJSTOP,PSJPWDO,PSGMARO,PSGMTYPE,PSGTM,PSGTMALL,XTYPE,PSGLRPH,PSGPG
"RTN","PSGMMAR",47,0)
 K HT,PSGOENOF,PSGOES,PSGRBPPN,PSGS0XT,PSGST,PSGTIR,PSGWD,XQUIT,ZTDESC,ONHOLD
"RTN","PSGMMAR",48,0)
 Q
"RTN","PSGMMAR",49,0)
 ;
"RTN","PSGMMAR",50,0)
G ;
"RTN","PSGMMAR",51,0)
 S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select WARD GROUP: " W ! D ^DIC K DIC D  I $G(PSJSTOP)=1 Q
"RTN","PSGMMAR",52,0)
 . I X="^OTHER" S PSGMARWG="^OTHER" Q
"RTN","PSGMMAR",53,0)
 . S PSGMARWG=+Y
"RTN","PSGMMAR",54,0)
 . I +Y'>0 S PSJSTOP=1
"RTN","PSGMMAR",55,0)
 D RBPPN^PSJMDIR
"RTN","PSGMMAR",56,0)
 Q
"RTN","PSGMMAR",57,0)
 ;
"RTN","PSGMMAR",58,0)
W ;
"RTN","PSGMMAR",59,0)
 S DIC="^DIC(42,",DIC(0)="QEAMI",DIC("A")="Select WARD: " W ! D ^DIC K DIC S PSGMARWD=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMMAR",60,0)
 S PSGWD=PSGMARWD D ADMTM^PSJMDIR S Y=PSGMARWD
"RTN","PSGMMAR",61,0)
 D:'PSJSTOP RBPPN^PSJMDIR
"RTN","PSGMMAR",62,0)
 Q
"RTN","PSGMMAR",63,0)
 ;
"RTN","PSGMMAR",64,0)
P ;
"RTN","PSGMMAR",65,0)
 K PSGPAT S PSGPAT=0 F CNTR=0:1 S:CNTR PSGDICA="another" D ENP^PSGGAO:'PSGMARB,ENDPT^PSGP:PSGMARB Q:PSGP'>0  D
"RTN","PSGMMAR",66,0)
 . S PSGPAT(PSGP)="",PSGPAT=PSGP
"RTN","PSGMMAR",67,0)
 . ;*** PSGMARWD=1 when all patients are select from the same ward.
"RTN","PSGMMAR",68,0)
 . S:'$G(PSJPWDO) (PSGMARWD,PSJPWDO)=PSJPWD S PSGMARWD=$S('$G(PSGMARWD):0,PSJPWDO=PSJPWD:PSJPWD,1:0)
"RTN","PSGMMAR",69,0)
 S Y=PSGPAT S:Y'>0 PSJSTOP=1 K PSGDICA
"RTN","PSGMMAR",70,0)
 Q
"RTN","PSGMMAR",71,0)
 ;
"RTN","PSGMMAR",72,0)
C ;
"RTN","PSGMMAR",73,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGMMAR",74,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGMMAR",75,0)
CDIC ;
"RTN","PSGMMAR",76,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMMAR",77,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGMMAR",78,0)
 Q
"RTN","PSGMMAR",79,0)
L ;
"RTN","PSGMMAR",80,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGMMAR",81,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGMMAR",82,0)
LDIC ;
"RTN","PSGMMAR",83,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMMAR",84,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGMMAR",85,0)
 Q
"RTN","PSGMMAR",86,0)
DEV ;
"RTN","PSGMMAR",87,0)
 K ZTSAVE S PSGTIR="ENQ^PSGMMAR",ZTDESC=PSGMARDF_" DAY MAR" F X="PSGMARWG","PSGMARWD","PSGP","PSGPAT(","PSGDT","PSGMARSD","PSGMARFD","PSGSS","PSGMARB","PSGMARDF","PSGMARS" S ZTSAVE(X)=""
"RTN","PSGMMAR",88,0)
 F X="PSGMTYPE","PSGRBPPN","^TMP($J," S ZTSAVE(X)=""
"RTN","PSGMMAR",89,0)
 I PSGSS="W" F X="PSGTMALL","PSGTM","PSGTM(" S ZTSAVE(X)=""
"RTN","PSGMMAR",90,0)
 D ENDEV^PSGTI W:POP !!?3,"No device selected for "_PSGMARDF_" day MAR run." W:$D(ZTSK) !?3,PSGMARDF_" Day MAR Queued!" K ZTSK Q
"RTN","PSGMMAR",91,0)
 I 'IO("Q") U IO
"RTN","PSGMMAR",92,0)
 ;
"RTN","PSGMMAR",93,0)
ENOR S PSGP=+ORVP
"RTN","PSGMMAR",94,0)
ENLM ;
"RTN","PSGMMAR",95,0)
 NEW VADM
"RTN","PSGMMAR",96,0)
 D ENCV^PSGSETU I $D(QUIT) K PSGMARDF Q
"RTN","PSGMMAR",97,0)
 D ^PSJAC S PSGPAT=1,PSGPAT(PSGP)="",PSGMAROF=1,PSGSS="P" G EN1
"RTN","PSGMMAR2")
0^3^B33296503
"RTN","PSGMMAR2",1,0)
PSGMMAR2 ;BIR/CML3-MD MARS - PRINT C ORDERS(UD) ;09 Feb 99 / 12:50 PM
"RTN","PSGMMAR2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,20,111,131**;16 DEC 97
"RTN","PSGMMAR2",3,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSGMMAR2",4,0)
S1 ;
"RTN","PSGMMAR2",5,0)
 I PSGMARB'=1 S:PSGRBPPN="P" X=PN,Y=RB S:PSGRBPPN="R" X=RB,Y=PN S NO=$S(PSGSS="P"!(PSGSS="C")!(PSGSS="L"):$O(^TMP($J,PN,0)),1:$O(^TMP($J,TM,WDN,X,Y,0)))'["C"
"RTN","PSGMMAR2",6,0)
 I $S(PSGMARB'=2:1,"34"[PSGMARS:NO,1:0) D:PSGMARS'=4 HEADER,BOT D:PSGMARS'=1 BLANK^PSGMMAR3 Q:PSGMARB=1
"RTN","PSGMMAR2",7,0)
 Q:NO  D NOW^%DTC S PSGDT=%,(DAO,PST)="" I PSGSS'="P",PSGSS'="C",PSGSS'="L" D HEADER
"RTN","PSGMMAR2",8,0)
 S PSGMPG=0,PSGMPGN="PAGE: "
"RTN","PSGMMAR2",9,0)
 D @($S(PSGSS="P"!(PSGSS="C")!(PSGSS="L"):"P",1:"W"))
"RTN","PSGMMAR2",10,0)
 D BOT
"RTN","PSGMMAR2",11,0)
 Q
"RTN","PSGMMAR2",12,0)
P ; Print on Patient order
"RTN","PSGMMAR2",13,0)
 F  S PST=$O(^TMP($J,PN,PST)) Q:PST'["C"  S A="" F  S A=$O(^TMP($J,PN,PST,A)) Q:A=""  D
"RTN","PSGMMAR2",14,0)
 . D HEADER
"RTN","PSGMMAR2",15,0)
 . S DAO="" F  S DAO=$O(^TMP($J,PN,PST,A,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) S:A["C!" PWDN=A D PRT
"RTN","PSGMMAR2",16,0)
 S:$O(^TMP($J,PN,"N"))="" PSGMPGN="LAST PAGE: "
"RTN","PSGMMAR2",17,0)
 Q
"RTN","PSGMMAR2",18,0)
W ; Print Ward/Ward group
"RTN","PSGMMAR2",19,0)
 I PSGRBPPN="P" D
"RTN","PSGMMAR2",20,0)
 . F  S PST=$O(^TMP($J,TM,WDN,PN,RB,PST)) Q:PST'["C"  F Q=0:0 S DAO=$O(^TMP($J,TM,WDN,PN,RB,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D PRT
"RTN","PSGMMAR2",21,0)
 . S:$O(^TMP($J,TM,WDN,PN,RB,"N"))="" PSGMPGN="LAST PAGE: "
"RTN","PSGMMAR2",22,0)
 I PSGRBPPN="R" D
"RTN","PSGMMAR2",23,0)
 . F  S PST=$O(^TMP($J,TM,WDN,RB,PN,PST)) Q:PST'["C"  F Q=0:0 S DAO=$O(^TMP($J,TM,WDN,RB,PN,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D PRT
"RTN","PSGMMAR2",24,0)
 . S:$O(^TMP($J,TM,WDN,RB,PN,"N"))="" PSGMPGN="LAST PAGE: "
"RTN","PSGMMAR2",25,0)
 Q
"RTN","PSGMMAR2",26,0)
HEADER ; pat info
"RTN","PSGMMAR2",27,0)
 S:'$G(PSGXDT) PSGXDT=PSGDT ;Reason was that PSGDT kept reset somewhere
"RTN","PSGMMAR2",28,0)
 S PSGMAROC=0,(MSG1,MSG2)="" W:$G(PSGPG)&($Y) @IOF S PSGPG=1 W !?1,"CONTINUOUS SHEET",?61,PSGMARDF," DAY MAR",?100,PSGMARSP,"  through  ",PSGMARFP
"RTN","PSGMMAR2",29,0)
 W !?5,$P($$SITE(80),U,2),?102,"Printed on  "_$$ENDTC2^PSGMI(PSGXDT)
"RTN","PSGMMAR2",30,0)
 W !?5,"Name:  "_PPN,?62,"Weight (kg): "_WT,?103,"Loc: "_$S(PWDN'["C!":PWDN,1:$P($G(^SC($P(PWDN,"!",2),0)),"^"))
"RTN","PSGMMAR2",31,0)
 W !?6,"PID:  "_PSSN,?25,"DOB: "_BD_"  ("_PAGE_")",?62,"Height (cm): "_HT,?99,"Room-Bed: "_$S(PWDN'["C!":PRB,1:"")
"RTN","PSGMMAR2",32,0)
 W !?6,"Sex:  "_PSEX,?25," Dx: "_DX,?$S(TD:94,1:99),$S(TD:"Last Transfer: "_TD,1:"Admitted: "_$S(PWDN'["C!":AD,1:""))
"RTN","PSGMMAR2",33,0)
 I '$D(PSGALG) W !,"Allergies:  See attached list of Allergies/Adverse Reactions"
"RTN","PSGMMAR2",34,0)
 NEW PSGX S PSGX=0 D ATS^PSGMAR3(.PSGX) D:PSGX HEADER Q:PSGX
"RTN","PSGMMAR2",35,0)
 W !,?49,"Admin"
"RTN","PSGMMAR2",36,0)
 W:$G(PSJDIET)]"" ?57,"Diet: ",PSJDIET
"RTN","PSGMMAR2",37,0)
 W:PSGMARDF=14 ?55,LN14 W !?1,"Order",?9,"Start",?21,"Stop",?49,"Times" W ?55,LN3," notes",!,LN1
"RTN","PSGMMAR2",38,0)
 Q
"RTN","PSGMMAR2",39,0)
PRT ; order info
"RTN","PSGMMAR2",40,0)
 S ON=$P(DAO,U,2) D ONHOLD
"RTN","PSGMMAR2",41,0)
 I +PSGMSORT,$S(ON["V":1,ON["P":$P($G(^PS(53.1,+ON,0)),U,4)="F",1:0) D PRT^PSGMMIVC Q
"RTN","PSGMMAR2",42,0)
 D:PSGMAROC>5 ENB,HEADER I PST["CV"!(PST["CZV") D PRT^PSGMMIVC Q
"RTN","PSGMMAR2",43,0)
 S PSGMARGD=$P(PSGMARTS,"^",2),PSGMARTS=$P(PSGMARTS,"^"),PSGORD=$P(DAO,U,2) S:PSGORD["P" PSJPSTO=PST,PST=$S(+PSGMSORT:"CZ",1:PST) D ^PSGLOI
"RTN","PSGMMAR2",44,0)
 D TS^PSGMAR3(PSGMARTS)
"RTN","PSGMMAR2",45,0)
 D MARLB^PSGMUTL(47)
"RTN","PSGMMAR2",46,0)
 I (PSGMAROC>4&(MARLB>6))!(TS/6>6)!((TS/6+PSGMAROC)>6) D BOT,HEADER
"RTN","PSGMMAR2",47,0)
 S PSGMAROC=PSGMAROC+1
"RTN","PSGMMAR2",48,0)
 NEW PRTLN F PRTLN=1:1:MARLB W !,MARLB(PRTLN),?48,"|",$G(TS(PRTLN)) D CELL(PRTLN,'(PRTLN#6)) D PRT2
"RTN","PSGMMAR2",49,0)
 I $D(PSJPSTO) S PST=PSJPSTO K PSJPSTO
"RTN","PSGMMAR2",50,0)
 Q
"RTN","PSGMMAR2",51,0)
PRT2 ;
"RTN","PSGMMAR2",52,0)
 I PSGMAROC>5,(TS/6>7) D
"RTN","PSGMMAR2",53,0)
 . S MSG1="*** CONTINUE ON NEXT PAGE ***"
"RTN","PSGMMAR2",54,0)
 . D BOT,HEADER
"RTN","PSGMMAR2",55,0)
 I PRTLN#6=0 W:PSGMAROC<6 !?7,LN2 S:PRTLN'=MARLB PSGMAROC=PSGMAROC+1
"RTN","PSGMMAR2",56,0)
 Q
"RTN","PSGMMAR2",57,0)
CHKLAB ; Check to see if next label is needed.
"RTN","PSGMMAR2",58,0)
 I '((L+1)#6) W ?48,"| ",$G(TS(L)) D CELL(L,0) W !?1,"See next label for continuation",?48,"| ",$G(TS(L+1)) D CELL(L+1,1) W:PSGMAROC<6 !?7,LN2,!?1 S L=L+2,PSGMAROC=PSGMAROC+1 D  Q
"RTN","PSGMMAR2",59,0)
 . I PSGMAROC>5,(TS/6>7) S MSG1="*** CONTINUE ON NEXT PAGE ***" D BOT,HEADER
"RTN","PSGMMAR2",60,0)
 E  W ?48,"| ",$G(TS(L)) D CELL(L,0) W !?1 S L=L+1
"RTN","PSGMMAR2",61,0)
 Q
"RTN","PSGMMAR2",62,0)
INIT ; Print the initials on the label.
"RTN","PSGMMAR2",63,0)
 W !?1,$E("WS",1,PSGLWS*2),?4,$S(PSGLSM:$E("HSM",PSGLSM,3),1:""),?8,$E("NF",1,PSGLNF*2),?30,"RPH: ",PSGLRPH,?39," RN: ",PSGLRN,?48,"| ",?50,$G(TS(L)) D CELL(L,1)
"RTN","PSGMMAR2",64,0)
 Q
"RTN","PSGMMAR2",65,0)
CELL(X,X1) ; Print the **** on the not to be given cells.
"RTN","PSGMMAR2",66,0)
 N QTS,CELL S CELL=$E($S(X1:"         ",1:"_________"),1,PSGMARDF=7*5+4)
"RTN","PSGMMAR2",67,0)
 I PST["CZ",(X=6) NEW PSGLFFD,PSGMARGD S P(9)="",PSGLFFD="9999999",PSGMARGD="" W ?55 D ASTERS Q
"RTN","PSGMMAR2",68,0)
 I TS=1,'PSGMARTS,(X=6) W ?55 S P(9)=1 D ASTERS K P(9) Q
"RTN","PSGMMAR2",69,0)
 I $G(TS(X))="" W ?55,$S(X1:LN7,1:LN4) Q
"RTN","PSGMMAR2",70,0)
 F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q  S QTS=Q_"."_TS(X) W ?55,"|"_$S(QTS<PSGLSSD:EXPIRE,QTS'<PSGLFFD:EXPIRE,PSGMARGD="":ASTERS,$G(ONHOLD):$E("Hold     ",1,$L(CELL)),PSGMARGD[$P(PSGD(Q),"^"):CELL,1:ASTERS)
"RTN","PSGMMAR2",71,0)
 W "|"
"RTN","PSGMMAR2",72,0)
 Q
"RTN","PSGMMAR2",73,0)
ASTERS ; Print the **** on the first label.
"RTN","PSGMMAR2",74,0)
 I ONHOLD N HSPACE S HSPACE=SPACES,SPACES=$E("Hold           ",1,$L(HSPACE))
"RTN","PSGMMAR2",75,0)
 S PSGLFFD=$P(PSGLFFD,".") F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q  W "|"_$S(Q<$P(PSGLSSD,"."):ASTERS,Q=PSGLFFD:EXPIRE,Q>PSGLFFD:ASTERS,(PSGMARGD=""&($G(P(9))="")):SPACES,PSGMARGD[$P(PSGD(Q),"^"):SPACES,1:ASTERS)
"RTN","PSGMMAR2",76,0)
 W "|"
"RTN","PSGMMAR2",77,0)
 I ONHOLD S SPACES=HSPACE
"RTN","PSGMMAR2",78,0)
 Q
"RTN","PSGMMAR2",79,0)
BOT ; bottom of MAR
"RTN","PSGMMAR2",80,0)
 I MSG1]"" F QQ=1:1:6 W ! W:QQ=1 ?6,"|",?19,"|" W:34[QQ ?12,$S(QQ=3:MSG1,1:MSG2) W ?55,$S(QQ<6:LN4,1:LN7)
"RTN","PSGMMAR2",81,0)
 I PSGMAROC<6 S PSGMAROC=6-PSGMAROC F Q=1:1:PSGMAROC F QQ=1:1:6 W ! W:QQ=1 ?6,"|",?19,"|" W:34[QQ ?12,$S(QQ=3:MSG1,1:MSG2) W ?55,$S(QQ<6:LN4,1:LN7) I QQ=6,Q<PSGMAROC W !?7,LN2
"RTN","PSGMMAR2",82,0)
ENB ;
"RTN","PSGMMAR2",83,0)
 I $D(PSGMPG) S PSGMPG=PSGMPG+1 S PSGMPGN=$S(PSGMPGN'["LAST":"PAGE: ",1:PSGMPGN)_PSGMPG
"RTN","PSGMMAR2",84,0)
 W !,LN1
"RTN","PSGMMAR2",85,0)
 W !,"|",?11,"SIGNATURE/TITLE",?38,"| INIT |          INJECTION SITES           |",?87,"MED/DOSE OMITTED",?107,"|     REASON     | INIT |"
"RTN","PSGMMAR2",86,0)
 F Q=1:1:10 W !,"|"_$E(LN1,1,37)_"|------|"_BLN(Q),?82,"|"_$E(LN1,1,24)_"|"_$E(LN1,1,16)_"|------|"
"RTN","PSGMMAR2",87,0)
 W !,LN1,!?3,PPN,?45,PSSN,?58,"Room-Bed: "_$S(PWDN'["C!":PRB,1:""),?100,$S($D(PSGMPG):PSGMPGN,1:""),?116,"VA FORM 10-2970",*13
"RTN","PSGMMAR2",88,0)
 Q
"RTN","PSGMMAR2",89,0)
SITE(LEN) ;* Get the Institution name
"RTN","PSGMMAR2",90,0)
 ;* Input : LEN = Report width (80 or 132 column)
"RTN","PSGMMAR2",91,0)
 ;* Output: space needed to center text ^ VAMC name
"RTN","PSGMMAR2",92,0)
 NEW X
"RTN","PSGMMAR2",93,0)
 S X=$$NAME^VASITE
"RTN","PSGMMAR2",94,0)
 I X="" S X=$$SITE^VASITE S:X]"" X="VAMC:  "_$P(X,U,2)_" ("_$P(X,U,3)_")"
"RTN","PSGMMAR2",95,0)
 I X="" Q ""
"RTN","PSGMMAR2",96,0)
 Q (LEN-$L(X))/2_U_X
"RTN","PSGMMAR2",97,0)
ONHOLD ;Check order to see if it's ON hold, set Flag True if it is
"RTN","PSGMMAR2",98,0)
 S ONHOLD=0
"RTN","PSGMMAR2",99,0)
 N PSGON
"RTN","PSGMMAR2",100,0)
 S PSGON=+ON
"RTN","PSGMMAR2",101,0)
 ;If unit dose order, check Hold Status field = Active Hold
"RTN","PSGMMAR2",102,0)
 I (ON["A")!(ON["O")!(ON["U") I $P($G(^PS(55,$P(PN,"^",2),5,PSGON,0)),"^",9)="H" S ONHOLD=1 Q
"RTN","PSGMMAR2",103,0)
 ;If IV Order, check Status field = Hold
"RTN","PSGMMAR2",104,0)
 I ON["V" I $P($G(^PS(55,$P(PN,"^",2),"IV",PSGON,0)),"^",17)="H" S ONHOLD=1 Q
"RTN","PSGMMAR2",105,0)
 Q
"RTN","PSGMMAR3")
0^4^B7209208
"RTN","PSGMMAR3",1,0)
PSGMMAR3 ;BIR/CML3-MD MARS - SORT O/P ORDERS ;21 Oct 98 / 12:22 PM
"RTN","PSGMMAR3",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,111,131**;16 DEC 97
"RTN","PSGMMAR3",3,0)
 ;
"RTN","PSGMMAR3",4,0)
 ; Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSGMMAR3",5,0)
 ;
"RTN","PSGMMAR3",6,0)
S1 ; Print non-blank prn.
"RTN","PSGMMAR3",7,0)
 Q:PSGMARB=1
"RTN","PSGMMAR3",8,0)
 NEW INIT,NEED,LT,RT,BL,PG,LAB
"RTN","PSGMMAR3",9,0)
 S BL=$S($P($G(^PS(59.7,1,26)),U):6,1:4),(PG,LT,RT)=1
"RTN","PSGMMAR3",10,0)
 S NO=$S(PSGSS="P"!(PSGSS="C")!(PSGSS="L"):$O(^TMP($J,PN,"N"))="",PSGRBPPN="P":$O(^TMP($J,TM,WDN,PN,RB,"N"))="",1:$O(^TMP($J,TM,WDN,RB,PN,"N"))="")
"RTN","PSGMMAR3",11,0)
 Q:NO
"RTN","PSGMMAR3",12,0)
 D NOW^%DTC S PSGDT=%,(DAO,DAOO)="",PST="N",PSGMAROC=0
"RTN","PSGMMAR3",13,0)
 K ^TMP($J,"1PRN")
"RTN","PSGMMAR3",14,0)
 I PSGSS'="P",PSGSS'="C",PSGSS'="L" D
"RTN","PSGMMAR3",15,0)
 . I PSGRBPPN="P" F  S PST=$O(^TMP($J,TM,WDN,PN,RB,PST)) Q:PST=""  F  S DAOO=$O(^TMP($J,TM,WDN,PN,RB,PST,DAOO)) Q:DAOO=""  S PSGMARTS=^(DAOO) D SET
"RTN","PSGMMAR3",16,0)
 . I PSGRBPPN="R" F  S PST=$O(^TMP($J,TM,WDN,RB,PN,PST)) Q:PST=""  F  S DAOO=$O(^TMP($J,TM,WDN,RB,PN,PST,DAOO)) Q:DAOO=""  S PSGMARTS=^(DAOO) D SET
"RTN","PSGMMAR3",17,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") F  S PST=$O(^TMP($J,PN,PST)) Q:PST=""  F  S DAO=$O(^TMP($J,PN,PST,DAO)) Q:DAO=""  D
"RTN","PSGMMAR3",18,0)
 .N DAOO S DAOO="" F  S DAOO=$O(^TMP($J,PN,PST,DAO,DAOO)) Q:DAOO=""  I $D(^TMP($J,PN,PST,DAO,DAOO))#10 S PSGMARTS=^(DAOO) D SET
"RTN","PSGMMAR3",19,0)
 D EN^PSGMMAR4
"RTN","PSGMMAR3",20,0)
 Q
"RTN","PSGMMAR3",21,0)
 ;
"RTN","PSGMMAR3",22,0)
SET ; set ^tmp array
"RTN","PSGMMAR3",23,0)
 S PSGORD=$P(DAOO,U,2)
"RTN","PSGMMAR3",24,0)
 I PSGORD["V" D IVPRN^PSGMMIV Q
"RTN","PSGMMAR3",25,0)
 I +PSGMSORT,PSGORD["P" S PSJPSTO=PST,PST="OZ"
"RTN","PSGMMAR3",26,0)
 S PSGORD=+PSGORD_$S(PSGORD["P":"P",1:"A") D ^PSGLOI
"RTN","PSGMMAR3",27,0)
 S TS=0 D MARLB^PSGMUTL(47)
"RTN","PSGMMAR3",28,0)
 I ((MARLB/6)+PSGMAROC)>BL S:PSGMAROC PG=PG+1,(LT,RT)=1,PSGMAROC=0
"RTN","PSGMMAR3",29,0)
 I ((MARLB/6)+PSGMAROC)>(BL/2) S PSGMAROC=$S(PSGMAROC>(BL/2):PSGMAROC,1:(BL/2)) D LTRT(.RT,"^")
"RTN","PSGMMAR3",30,0)
 E  D LTRT(.LT,"")
"RTN","PSGMMAR3",31,0)
 D LAB
"RTN","PSGMMAR3",32,0)
 I $D(PSJPSTO) S PST=PSJPSTO K PSJPSTO
"RTN","PSGMMAR3",33,0)
 Q
"RTN","PSGMMAR3",34,0)
 ;
"RTN","PSGMMAR3",35,0)
LAB ;***Print the 1st label for the order.
"RTN","PSGMMAR3",36,0)
 NEW X,J S J=0
"RTN","PSGMMAR3",37,0)
 ;naked reference below goes with full reference on right of =
"RTN","PSGMMAR3",38,0)
 F X=1:1:MARLB S J=J+1,^(J)=$G(^TMP($J,"1PRN",PG,LAB,J))_UP_MARLB(X) D
"RTN","PSGMMAR3",39,0)
 . I X=6,(MARLB>6) D
"RTN","PSGMMAR3",40,0)
 . . S J=0
"RTN","PSGMMAR3",41,0)
 . . I PSGMAROC>(BL/2) D LTRT(.RT,"^")
"RTN","PSGMMAR3",42,0)
 . . E  D LTRT(.LT,"")
"RTN","PSGMMAR3",43,0)
 Q
"RTN","PSGMMAR3",44,0)
 ;
"RTN","PSGMMAR3",45,0)
LTRT(X,Y)         ;***Increment Left or Right label value.
"RTN","PSGMMAR3",46,0)
 S LAB=X,X=X+1,UP=Y,PSGMAROC=PSGMAROC+1
"RTN","PSGMMAR3",47,0)
 Q
"RTN","PSGMMAR3",48,0)
BLANK ; Print blank prn form
"RTN","PSGMMAR3",49,0)
 NEW INIT,NEED,LT,RT,BL,PG,LAB,UP
"RTN","PSGMMAR3",50,0)
 S BL=$S($P($G(^PS(59.7,1,26)),U):6,1:4),(PG,LT,RT)=1
"RTN","PSGMMAR3",51,0)
 I PSGMARB'=2 D PSGMARB^PSGMMAR4
"RTN","PSGMMAR3",52,0)
 Q
"RTN","PSGMMIV")
0^9^B24646294
"RTN","PSGMMIV",1,0)
PSGMMIV ;BIR/MV-IV ORDER FOR THE 7/14 DAY MAR. ;25 Nov 98 / 9:24 AM
"RTN","PSGMMIV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,21,58,111,131**;16 DEC 97
"RTN","PSGMMIV",3,0)
 ;
"RTN","PSGMMIV",4,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSGMMIV",5,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMMIV",6,0)
 ;
"RTN","PSGMMIV",7,0)
START ;*** Read IV orders
"RTN","PSGMMIV",8,0)
 NEW MULTIPG
"RTN","PSGMMIV",9,0)
 S ON=""
"RTN","PSGMMIV",10,0)
 F PSGMARED=PSGMARSD-.0001:0 S PSGMARED=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED)) Q:'PSGMARED  F  S ON=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED,ON)) Q:ON=""  D IV
"RTN","PSGMMIV",11,0)
 Q
"RTN","PSGMMIV",12,0)
IV ;*** Sort IV orders for 24 Hrs, 7/14 Day MAR.
"RTN","PSGMMIV",13,0)
 K DRG,P N X,ON55,PSJLABEL S DFN=PSGP,PSJLABEL=1 D GT55^PSIVORFB
"RTN","PSGMMIV",14,0)
 Q:P(2)>PSGMARFD
"RTN","PSGMMIV",15,0)
 S X=$P(P("MR"),U,2) Q:XTYPE=2&(X["IV")  Q:XTYPE=3&(PST="S")&'($S(X="IV":1,X="IVPB":1,1:0))
"RTN","PSGMMIV",16,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGMMIV",17,0)
 S QST=$S(P(9)["PRN":"OVP",QST="O":"OVO",1:"CV")_XTYPE
"RTN","PSGMMIV",18,0)
 Q:(PSGMARS=2&(QST["C"))
"RTN","PSGMMIV",19,0)
 Q:(PSGMARS=1&(QST["O"))
"RTN","PSGMMIV",20,0)
 I DRG S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),X=$E($P(X,U,2),1,20)_U_+ON_"V" D
"RTN","PSGMMIV",21,0)
 . I PSGSS="P" S ^TMP($J,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),$S(PSGMARWN'["C!":"A",1:PSGMARWN),X)="" Q
"RTN","PSGMMIV",22,0)
 . S:PSGRBPPN="P" ^TMP($J,TM,PSGMARWN,PPN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMMIV",23,0)
 . S:PSGRBPPN="R" ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMMIV",24,0)
 Q
"RTN","PSGMMIV",25,0)
IVPRN ;*** Set ^tmp to store IV orders that have schedule of PRN.
"RTN","PSGMMIV",26,0)
 K P,DRG NEW ON55,CHEMO,TXT,PSJLABEL
"RTN","PSGMMIV",27,0)
 S ON=$P(DAOO,U,2),DFN=$P(PN,U,2),PSJLABEL=1
"RTN","PSGMMIV",28,0)
 ;* D:PST'["Z" GT55^PSIVORFB
"RTN","PSGMMIV",29,0)
 ;* I PST["Z" D GT531^PSIVORFA(DFN,ON)
"RTN","PSGMMIV",30,0)
 D:ON["V" GT55^PSIVORFB
"RTN","PSGMMIV",31,0)
 D:ON["P" GT531^PSIVORFA(DFN,ON)
"RTN","PSGMMIV",32,0)
 D SETVAR,SETLTRT
"RTN","PSGMMIV",33,0)
 ;the two naked references below refer to the full reference to the right of the = sign
"RTN","PSGMMIV",34,0)
 S ^(1)=$G(^TMP($J,"1PRN",PG,LAB,1))_UP_"      |            |"
"RTN","PSGMMIV",35,0)
 S ^(2)=$G(^TMP($J,"1PRN",PG,LAB,2))_UP_$E(P("LOG"),1,5)_" |",LN=3
"RTN","PSGMMIV",36,0)
 ;* S:PST["Z" ^(2)=^(2)_"P E N D I N G"
"RTN","PSGMMIV",37,0)
 ;* S:PST'["Z" ^(2)=^(2)_$E(P(2),1,5)_$E(P(2),9,14)_" |"_P(3)
"RTN","PSGMMIV",38,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",39,0)
 S:ON["P" ^(2)=^(2)_"P E N D I N G"
"RTN","PSGMMIV",40,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",41,0)
 S:ON["V" ^(2)=^(2)_$E(P(2),1,5)_$E(P(2),9,14)_" |"_P(3)
"RTN","PSGMMIV",42,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",43,0)
 S ^(2)=$$SETSTR^VALM1("("_$E(PSGP(0))_$E(PSSN,8,12)_")",^(2),40,7)
"RTN","PSGMMIV",44,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  S TXT=$$WRTDRG^PSIVUTL(DRG("AD",X),47) S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT)
"RTN","PSGMMIV",45,0)
 S TXT="in "
"RTN","PSGMMIV",46,0)
 ;; F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  S TXT=TXT_$$WRTDRG^PSIVUTL(DRG("SOL",X),47) S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT) S TXT="   "
"RTN","PSGMMIV",47,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D
"RTN","PSGMMIV",48,0)
 . S TXT=TXT_$$WRTDRG^PSIVUTL(DRG("SOL",X),47) S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT) S TXT="   "
"RTN","PSGMMIV",49,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",X),0),U,4) I PSJPRT2]"" S TXT=TXT_"   "_PSJPRT2 S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT) S TXT="   "
"RTN","PSGMMIV",50,0)
 S TXT=$P(P("MR"),U,2)_" "_P(9)_" "_P(8) D CHK(.TXT)
"RTN","PSGMMIV",51,0)
 I P(4)="C" S CHEMO="*CAUTION-CHEMOTHERAPY*" D:P("OPI")]"" CHK(CHEMO)
"RTN","PSGMMIV",52,0)
 S Y1="" F Y=1:1:$L($P(P("OPI"),"^")," ") S Y1=Y1_$P($P(P("OPI"),"^")," ",Y)_" " I $L(Y1)>47 D CHK(Y1) S Y1=""
"RTN","PSGMMIV",53,0)
 I $L(Y1)>28 D CHK(Y1) S Y1=""
"RTN","PSGMMIV",54,0)
 I Y1<29,'(LN#6) S TXT=$S((P("OPI")=""&$D(CHEMO)):CHEMO,1:Y1),X=29-$L(TXT),TXT=TXT_$$SP(X)_INIT
"RTN","PSGMMIV",55,0)
 E  D  S TXT=$$SP(29)_INIT,LN=LN+1
"RTN","PSGMMIV",56,0)
 . ;the following three naked references below refer to the full references to the right of the = sign
"RTN","PSGMMIV",57,0)
 .  I LN=5 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_Y1
"RTN","PSGMMIV",58,0)
 .  E  D:$L(Y1) CHK(Y1) F LN=LN:1:5 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_""
"RTN","PSGMMIV",59,0)
 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_TXT
"RTN","PSGMMIV",60,0)
 Q
"RTN","PSGMMIV",61,0)
SETVAR ;***Initialize variables.
"RTN","PSGMMIV",62,0)
 NEW TMSTR
"RTN","PSGMMIV",63,0)
 F X="LOG",2,3 S:P(X) P(X)=$$ENDTC^PSGMI(P(X))
"RTN","PSGMMIV",64,0)
 S PSGST=$S(P(9)["PRN":"P",P(2)=P(3):"O",1:"C"),TMSTR=P(11),PSGLFFD=PSGMARFD
"RTN","PSGMMIV",65,0)
 D INITOPI^PSGMMIVC
"RTN","PSGMMIV",66,0)
 ;;S INIT="RPH: "_PSGLRPH,INIT=INIT_$$SP(37-($L(INIT)+29))_"RN: "_PSGLRN
"RTN","PSGMMIV",67,0)
 S INIT="RPH: "_PSGLRPH,INIT=INIT_$$SP(38-($L(INIT)+29))_"RN: "_PSGLRN
"RTN","PSGMMIV",68,0)
 ;* S INIT="RPH: "_PSGLRPH_" RN: "_PSGLRN
"RTN","PSGMMIV",69,0)
 ;* S INIT="RPH: "_$S(PSGLRPH]"":PSGLRPH_" ",1:"_____")_" RN: "_$S($G(PSGLRN)]"":PSGLRN,1:"_____")
"RTN","PSGMMIV",70,0)
 ;*** If OPI<29 char, it is ok to put INITs in the same line.
"RTN","PSGMMIV",71,0)
 ;*** If OPI=""&it's a Chemo order, warning & Inits prt on same line.
"RTN","PSGMMIV",72,0)
 ;*** Add number lines needed for additives and solutions and 1 line
"RTN","PSGMMIV",73,0)
 ;*** for infusion rate and 1 line for start/stop date.
"RTN","PSGMMIV",74,0)
 ;*** Multiple labels can have up to 5 lines per label and the last
"RTN","PSGMMIV",75,0)
 ;*** label can have up to 6 lines..
"RTN","PSGMMIV",76,0)
 ;
"RTN","PSGMMIV",77,0)
 NEW X S NAMENEED=0
"RTN","PSGMMIV",78,0)
 F X="AD","SOL" D NAMENEED^PSJMUTL(X,47,.NEED) S NAMENEED=NAMENEED+NEED
"RTN","PSGMMIV",79,0)
 S MULTIPG=0,NEED=1
"RTN","PSGMMIV",80,0)
 ;* S X=($L(P("OPI"))>28)+1+(P("OPI")]""&(P(4)="C"))
"RTN","PSGMMIV",81,0)
 ;* Find # of lines needed for OPI -- (($L(P("OPI"))\47)
"RTN","PSGMMIV",82,0)
 ;* If the last line in OPI < 29 --(($L(P("OPI")#47)>28) include init.
"RTN","PSGMMIV",83,0)
 S X=($L($P(P("OPI"),"^"))\47)+(($L($P(P("OPI"),"^"))#47)>28)+1+($P(P("OPI"),"^")]""&(P(4)="C"))
"RTN","PSGMMIV",84,0)
 S X=(NAMENEED+X+2) S:X>5 NEED=((X-6)\5)+2
"RTN","PSGMMIV",85,0)
 S:NEED>BL MULTIPG=1
"RTN","PSGMMIV",86,0)
 Q
"RTN","PSGMMIV",87,0)
CHK(TXT) ;
"RTN","PSGMMIV",88,0)
 ;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",89,0)
 I '(LN#6) S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_"See next label for continuation",LN=1 D
"RTN","PSGMMIV",90,0)
 . I PSGMAROC+1>(BL/2) D
"RTN","PSGMMIV",91,0)
 . . I PSGMAROC=BL-1,MULTIPG D
"RTN","PSGMMIV",92,0)
 . . .;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",93,0)
 . . .F LN=LN:1:6 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_"" S:LN=3 ^(LN)=UP_"*** CONTINUE ON NEXT PAGE ***"
"RTN","PSGMMIV",94,0)
 . . .S PG=PG+1,(LN,LT,RT)=1,(PSGMAROC,MULTIPG)=0 D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",95,0)
 . . E  D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",96,0)
 . E  D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",97,0)
 ;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",98,0)
 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_TXT,LN=LN+1,TXT=""
"RTN","PSGMMIV",99,0)
 Q
"RTN","PSGMMIV",100,0)
SETLTRT ;*** Increment line number for left or right label on PRN sheet.
"RTN","PSGMMIV",101,0)
 I (NEED+PSGMAROC)>BL S:PSGMAROC PG=PG+1,(LT,RT)=1,PSGMAROC=0
"RTN","PSGMMIV",102,0)
 I NEED+PSGMAROC=BL D  Q
"RTN","PSGMMIV",103,0)
 . I PSGMAROC<(BL/2) D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",104,0)
 . E  D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",105,0)
 I PSGMAROC,((NEED+PSGMAROC)>(BL/2)) S PSGMAROC=$S(PSGMAROC>(BL/2):PSGMAROC,1:(BL/2)) D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",106,0)
 E  D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",107,0)
 Q
"RTN","PSGMMIV",108,0)
SP(X) ;***Set up spaces need between info on TXT for the label.
"RTN","PSGMMIV",109,0)
 N Y S $P(Y," ",X)=" "
"RTN","PSGMMIV",110,0)
 Q $G(Y)
"RTN","PSGMUTL")
0^6^B22961901
"RTN","PSGMUTL",1,0)
PSGMUTL ;BIR/MV-UTLILITY USE FOR THE MAR AND MEDWS. ;15 SEP 97 / 2:10 PM 
"RTN","PSGMUTL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,104,110,111,131**;16 DEC 97
"RTN","PSGMUTL",3,0)
 ;
"RTN","PSGMUTL",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGMUTL",5,0)
 ; 
"RTN","PSGMUTL",6,0)
MARFORM ;Prompt for the MAR form (Blank and Non-blank)
"RTN","PSGMUTL",7,0)
 S DIR(0)="SA^1:Print Blank MARs only;2:Print Non-Blank MARs only;3:Print both Blank and Non-Blank MARs"
"RTN","PSGMUTL",8,0)
 S DIR("A")="Select the MAR forms: ",DIR("B")="3"
"RTN","PSGMUTL",9,0)
 S DIR("?")=""
"RTN","PSGMUTL",10,0)
 S DIR("?",1)="Enter 1 to print BLANK (no data) MARs for the patient(s) you select."
"RTN","PSGMUTL",11,0)
 S DIR("?",2)="Enter 2 to print MARs complete with orders."
"RTN","PSGMUTL",12,0)
 S DIR("?",3)="Enter 3 to print both the blank MARs and the MARs complete with orders."
"RTN","PSGMUTL",13,0)
 S DIR("?",4)="Enter an  '^' to exit this option now."
"RTN","PSGMUTL",14,0)
 D ^DIR S PSGMARB=$S($D(DIRUT):0,1:Y)
"RTN","PSGMUTL",15,0)
 Q
"RTN","PSGMUTL",16,0)
BLANK(LEN) ;
"RTN","PSGMUTL",17,0)
 NEW X
"RTN","PSGMUTL",18,0)
 S $P(X," ",LEN)=" "
"RTN","PSGMUTL",19,0)
 Q $G(X)
"RTN","PSGMUTL",20,0)
 ;
"RTN","PSGMUTL",21,0)
TXT(TXT,LEN)   ;
"RTN","PSGMUTL",22,0)
 ;* Input: TXT = TXT string
"RTN","PSGMUTL",23,0)
 ;*        LEN = format length
"RTN","PSGMUTL",24,0)
 ;* Output: MARX array.
"RTN","PSGMUTL",25,0)
 ;*
"RTN","PSGMUTL",26,0)
 NEW OLD,X1,Y D SPLIT K MARX
"RTN","PSGMUTL",27,0)
 S X=0,X1=1,Y="" F  S X=$O(OLD(X)) Q:'X  D
"RTN","PSGMUTL",28,0)
 . I $L(Y_OLD(X))>LEN S MARX(X1)=Y,X1=X1+1,Y="" D
"RTN","PSGMUTL",29,0)
 .. I $E(MARX(X1-1),$L(MARX(X1-1)))'=" " Q
"RTN","PSGMUTL",30,0)
 .. S MARX(X1-1)=$E(MARX(X1-1),1,$L(MARX(X1-1))-1)
"RTN","PSGMUTL",31,0)
 . S Y=Y_OLD(X)
"RTN","PSGMUTL",32,0)
 S:Y]"" MARX(X1)=Y
"RTN","PSGMUTL",33,0)
 S MARX=X1
"RTN","PSGMUTL",34,0)
 Q
"RTN","PSGMUTL",35,0)
 ;
"RTN","PSGMUTL",36,0)
SPLIT ;* Split a word string into individual words.
"RTN","PSGMUTL",37,0)
 ;* Output: OLD(X)
"RTN","PSGMUTL",38,0)
 ;*
"RTN","PSGMUTL",39,0)
 NEW BSD,NEW,X,X1,Y
"RTN","PSGMUTL",40,0)
 S OLD(1)=TXT Q:$L(TXT)<LEN
"RTN","PSGMUTL",41,0)
 F BSD=" ","/","-" S:'$O(OLD(0)) OLD(1)=TXT D:TXT[BSD DELIM(BSD)
"RTN","PSGMUTL",42,0)
 I '$O(OLD(1)),($L(TXT)>LEN) D LEN(1,TXT) K OLD D
"RTN","PSGMUTL",43,0)
 . F X=0:0 S X=$O(NEW(X)) Q:'X  S OLD(X)=NEW(X)
"RTN","PSGMUTL",44,0)
 Q
"RTN","PSGMUTL",45,0)
LEN(X1,OLD) ;* Wrap word around if it doesn't fit the display length
"RTN","PSGMUTL",46,0)
 NEW X
"RTN","PSGMUTL",47,0)
 Q:$L(OLD)'>LEN
"RTN","PSGMUTL",48,0)
 S X=$E(OLD,1,($L(OLD)-1)) I X["/"!((X["-")&(X'["ON-CALL")) Q
"RTN","PSGMUTL",49,0)
 I $L(OLD)>LEN F X=1:1 S NEW(X1)=$E(OLD,((LEN*X)-LEN+1),(LEN*X)),X1=X1+1 Q:($L(OLD)'>(LEN*X))
"RTN","PSGMUTL",50,0)
 Q
"RTN","PSGMUTL",51,0)
DELIM(BSD) ;* BSD=" ","/","-"
"RTN","PSGMUTL",52,0)
 K NEW
"RTN","PSGMUTL",53,0)
 S X=0,X1=0 F  S X=$O(OLD(X)) Q:'X  K ONCALL F Y=1:1:$L(OLD(X),BSD) D
"RTN","PSGMUTL",54,0)
 . Q:($G(ONCALL)=Y)   ; If ON-CALL is delimited string, ignore
"RTN","PSGMUTL",55,0)
 . S X1=X1+1
"RTN","PSGMUTL",56,0)
 . S NEW(X1)=$P(OLD(X),BSD,Y)
"RTN","PSGMUTL",57,0)
 . I $L(OLD(X),BSD)>1,(Y<$L(OLD(X),BSD)) S NEW(X1)=NEW(X1)_BSD
"RTN","PSGMUTL",58,0)
 . I BSD="-",OLD(X)["ON-CALL" D   ;If dashes, check for ON-CALL
"RTN","PSGMUTL",59,0)
 .. S NEW(X1)=OLD(X),ONCALL=Y+1   ;Keep ON-CALL intact
"RTN","PSGMUTL",60,0)
 . D LEN(.X1,NEW(X1))
"RTN","PSGMUTL",61,0)
 K OLD F X=0:0 S X=$O(NEW(X)) Q:'X  S OLD(X)=NEW(X)
"RTN","PSGMUTL",62,0)
 Q
"RTN","PSGMUTL",63,0)
 ;
"RTN","PSGMUTL",64,0)
MARLB(LEN)         ;
"RTN","PSGMUTL",65,0)
 ;;;LEN=LENGTH
"RTN","PSGMUTL",66,0)
 NEW L,X,TXT K MARLB,DRUGNAME,ON S ON=PSGORD D ONHOLD^PSGMMAR2
"RTN","PSGMUTL",67,0)
 S L=1
"RTN","PSGMUTL",68,0)
 S MARLB(L)=$$BLANK(6)_"|"_$$BLANK(12)_"|",L=L+1
"RTN","PSGMUTL",69,0)
 I $G(PST)["CZ"!($G(PST)["OZ") S MARLB(L)=PSGLOD_" | P E N D I N G"
"RTN","PSGMUTL",70,0)
 E  S MARLB(L)=PSGLOD_" |"_PSGLSD_" |"_PSGLFD
"RTN","PSGMUTL",71,0)
 I $G(ONHOLD) S MARLB(L)=PSGLOD_" | O N  H O L D "
"RTN","PSGMUTL",72,0)
 S MARLB(L)=$$SETSTR^VALM1("("_$E(PPN)_$E(PSSN,8,12)_")",MARLB(L),40,7)
"RTN","PSGMUTL",73,0)
 S L=L+1
"RTN","PSGMUTL",74,0)
 D DRGDISP^PSJLMUT1(PSGP,+PSGORD_$S(PSGORD["P":"P",1:"U"),45,39,.DRUGNAME,0)
"RTN","PSGMUTL",75,0)
 F X=0:0 S X=$O(DRUGNAME(X)) Q:'X  S MARLB(L)=DRUGNAME(X)_$S(X=1:$$BLANK(47-$L(DRUGNAME(X)))_PSGLST,1:""),L=L+1
"RTN","PSGMUTL",76,0)
 D TXT^PSGMUTL(PSGLSI,LEN)
"RTN","PSGMUTL",77,0)
 S X=0 F  S X=$O(MARX(X)) Q:'X  S MARLB(L)=MARX(X),L=L+1
"RTN","PSGMUTL",78,0)
 K MARX
"RTN","PSGMUTL",79,0)
 I $G(PSGP),$G(PSGORD),(PSGLRN]""),(PSGLRN'="O") D
"RTN","PSGMUTL",80,0)
 .N ND4 S ND4=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,4)),PSGORD["P":$G(^PS(53.1,+PSGORD,4)),1:"")
"RTN","PSGMUTL",81,0)
 .N PSGLREN,PSGLRNDT S PSGLREN=+$$LASTREN^PSJLMPRI(PSGP,PSGORD),PSGLRNDT=$P(ND4,"^",2) I PSGLREN,PSGLRNDT I PSGLREN>PSGLRNDT S PSGLRN=""
"RTN","PSGMUTL",82,0)
 S X=$E("WS",1,PSGLWS*2)_$S(PSGLSM:$E("HSM",PSGLSM,3),1:"")_$E("NF",1,PSGLNF*2)
"RTN","PSGMUTL",83,0)
 I X="",($L(MARLB(L-1))<30),(L=7) S L=L-1 D
"RTN","PSGMUTL",84,0)
 . S X=MARLB(L)_$$BLANK(29-$L(MARLB(L)))_"RPH: "_$S(PSGLRPH]""&(PSGLRPH'="0"):PSGLRPH,1:"_____")
"RTN","PSGMUTL",85,0)
 . S X=X_$$BLANK(39-$L(X))_"RN: "_$S(PSGLRN]""&(PSGLRN'="0"):PSGLRN,1:"_____")
"RTN","PSGMUTL",86,0)
 . S MARLB(L)=X
"RTN","PSGMUTL",87,0)
 E  D
"RTN","PSGMUTL",88,0)
 . S:L=5 MARLB(5)="",L=6
"RTN","PSGMUTL",89,0)
 . S X=$E("WS",1,PSGLWS*2)
"RTN","PSGMUTL",90,0)
 . S X=X_$$BLANK(4-$L(X))_$S(PSGLSM:$E("HSM",PSGLSM,3),1:"")
"RTN","PSGMUTL",91,0)
 . S X=X_$$BLANK(8-$L(X))_$E("NF",1,PSGLNF*2)
"RTN","PSGMUTL",92,0)
 . S X=X_$$BLANK(29-$L(X))_"RPH: "_$S(PSGLRPH]""&(PSGLRPH'="0"):PSGLRPH,1:"____")
"RTN","PSGMUTL",93,0)
 . S X=X_$$BLANK(39-$L(X))_"RN: "_$S(PSGLRN]""&(PSGLRN'="0"):PSGLRN,1:"_____")
"RTN","PSGMUTL",94,0)
 . S MARLB(L)=X
"RTN","PSGMUTL",95,0)
 S MARLB=L
"RTN","PSGMUTL",96,0)
 I MARLB>6!($G(TS)>6) D MARLB2
"RTN","PSGMUTL",97,0)
 Q
"RTN","PSGMUTL",98,0)
 ;
"RTN","PSGMUTL",99,0)
MARLB2 ;Split array into 2 labels.
"RTN","PSGMUTL",100,0)
 ;TS array must be defined. (TS^PSGMAR3(ADMIN TIMES))
"RTN","PSGMUTL",101,0)
 NEW INIT,X,Y
"RTN","PSGMUTL",102,0)
 S INIT=MARLB(MARLB),Y=6
"RTN","PSGMUTL",103,0)
 F X=6:1:MARLB S X(X)=MARLB(X)
"RTN","PSGMUTL",104,0)
 F X=6:1:($S(MARLB>TS:MARLB,1:TS)-1) D
"RTN","PSGMUTL",105,0)
 . I (X#6)=0 S MARLB(X)="See next label for continuation" Q
"RTN","PSGMUTL",106,0)
 . I Y<(MARLB) S MARLB(X)=X(Y),Y=Y+1 Q
"RTN","PSGMUTL",107,0)
 . S MARLB(X)=""
"RTN","PSGMUTL",108,0)
 S X=X+1 F Y=Y:1:MARLB-1 S MARLB(X)=$G(X(Y)),X=X+1
"RTN","PSGMUTL",109,0)
 F X=X:0 Q:(X#6)=0  S MARLB(X)="",X=X+1
"RTN","PSGMUTL",110,0)
 S MARLB(X)=INIT,MARLB=X
"RTN","PSGMUTL",111,0)
 Q
"RTN","PSGMUTL",112,0)
 N X F X=6:1:MARLB S X(X+1)=MARLB(X)
"RTN","PSGMUTL",113,0)
 S MARLB(6)="See next label for continuation"
"RTN","PSGMUTL",114,0)
 F X=7:1:MARLB S MARLB(X)=X(X)
"RTN","PSGMUTL",115,0)
 F X=X+1:1:11 S MARLB(X)=""
"RTN","PSGMUTL",116,0)
 S MARLB(12)=X(MARLB+1)
"RTN","PSGMUTL",117,0)
 S MARLB=12
"RTN","PSGMUTL",118,0)
 Q
"RTN","PSGMUTL",119,0)
 ;
"VER")
8.0^22.0
**END**
**END**
