Released DG*5.3*244 SEQ #445
Extracted from mail message
**KIDS**:DG*5.3*244^

**INSTALL NAME**
DG*5.3*244
"BLD",3165,0)
DG*5.3*244^REGISTRATION^0^3030514^y
"BLD",3165,1,0)
^^1^1^3020125^
"BLD",3165,1,1,0)
Patient name standardization patch. 
"BLD",3165,4,0)
^9.64PA^2^1
"BLD",3165,4,2,0)
2
"BLD",3165,4,2,2,0)
^9.641^2.101^3
"BLD",3165,4,2,2,2,0)
PATIENT  (File-top level)
"BLD",3165,4,2,2,2,1,0)
^9.6411^1.09^9
"BLD",3165,4,2,2,2,1,1.01,0)
NAME COMPONENTS
"BLD",3165,4,2,2,2,1,1.02,0)
K-NAME COMPONENTS
"BLD",3165,4,2,2,2,1,1.03,0)
K2-NAME COMPONENTS
"BLD",3165,4,2,2,2,1,1.04,0)
FATHER'S NAME COMPONENTS
"BLD",3165,4,2,2,2,1,1.05,0)
MOTHERS NAME COMPONENTS
"BLD",3165,4,2,2,2,1,1.06,0)
MOTHERS MAIDEN NAME COMPONENTS
"BLD",3165,4,2,2,2,1,1.07,0)
E-NAME COMPONETS
"BLD",3165,4,2,2,2,1,1.08,0)
E2 NAME COMPONENTS
"BLD",3165,4,2,2,2,1,1.09,0)
D NAME COMPONENTS
"BLD",3165,4,2,2,2.01,0)
ALIAS  (sub-file)
"BLD",3165,4,2,2,2.01,1,0)
^9.6411^100.03^1
"BLD",3165,4,2,2,2.01,1,100.03,0)
ALIAS COMPONENTS
"BLD",3165,4,2,2,2.101,0)
DISPOSITION LOG-IN DATE/TIME  (sub-file)
"BLD",3165,4,2,2,2.101,1,0)
^9.6411^100.21^1
"BLD",3165,4,2,2,2.101,1,100.21,0)
ATTORNEY'S NAME COMPONENTS
"BLD",3165,4,2,222)
y^y^p^^^^n
"BLD",3165,4,"APDD",2,2)

"BLD",3165,4,"APDD",2,2,1.01)

"BLD",3165,4,"APDD",2,2,1.02)

"BLD",3165,4,"APDD",2,2,1.03)

"BLD",3165,4,"APDD",2,2,1.04)

"BLD",3165,4,"APDD",2,2,1.05)

"BLD",3165,4,"APDD",2,2,1.06)

"BLD",3165,4,"APDD",2,2,1.07)

"BLD",3165,4,"APDD",2,2,1.08)

"BLD",3165,4,"APDD",2,2,1.09)

"BLD",3165,4,"APDD",2,2.01)

"BLD",3165,4,"APDD",2,2.01,100.03)

"BLD",3165,4,"APDD",2,2.101)

"BLD",3165,4,"APDD",2,2.101,100.21)

"BLD",3165,4,"B",2,2)

"BLD",3165,"ABPKG")
n
"BLD",3165,"INIT")
POST^DG53244P
"BLD",3165,"KRN",0)
^9.67PA^19^18
"BLD",3165,"KRN",.4,0)
.4
"BLD",3165,"KRN",.401,0)
.401
"BLD",3165,"KRN",.402,0)
.402
"BLD",3165,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",3165,"KRN",.403,0)
.403
"BLD",3165,"KRN",.5,0)
.5
"BLD",3165,"KRN",.84,0)
.84
"BLD",3165,"KRN",3.6,0)
3.6
"BLD",3165,"KRN",3.8,0)
3.8
"BLD",3165,"KRN",9.2,0)
9.2
"BLD",3165,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",3165,"KRN",9.8,0)
9.8
"BLD",3165,"KRN",9.8,"NM",0)
^9.68A^44^19
"BLD",3165,"KRN",9.8,"NM",1,0)
DPTNAME^^0^B41760279
"BLD",3165,"KRN",9.8,"NM",4,0)
DPTLK^^0^B56336496
"BLD",3165,"KRN",9.8,"NM",6,0)
DPTLK2^^0^B21030810
"BLD",3165,"KRN",9.8,"NM",9,0)
DGNFUNC^^0^B434432
"BLD",3165,"KRN",9.8,"NM",23,0)
DPTLK1^^0^B33226052
"BLD",3165,"KRN",9.8,"NM",30,0)
DG53244P^^0^B28892688
"BLD",3165,"KRN",9.8,"NM",31,0)
DGRP1^^0^B21084826
"BLD",3165,"KRN",9.8,"NM",32,0)
DGRPE^^0^B42615132
"BLD",3165,"KRN",9.8,"NM",33,0)
DG53244Q^^0^B73982896
"BLD",3165,"KRN",9.8,"NM",34,0)
DG53244R^^0^B63320205
"BLD",3165,"KRN",9.8,"NM",35,0)
DG53244S^^0^B32152909
"BLD",3165,"KRN",9.8,"NM",36,0)
DGLOCK2^^0^B22007472
"BLD",3165,"KRN",9.8,"NM",37,0)
DG53244T^^0^B85559551
"BLD",3165,"KRN",9.8,"NM",38,0)
DG53244U^^0^B59850186
"BLD",3165,"KRN",9.8,"NM",39,0)
DG53244V^^0^B81905206
"BLD",3165,"KRN",9.8,"NM",40,0)
DGBUL^^0^B6129320
"BLD",3165,"KRN",9.8,"NM",42,0)
DGDDC^^0^B6759474
"BLD",3165,"KRN",9.8,"NM",43,0)
DPTNAME1^^0^B40589479
"BLD",3165,"KRN",9.8,"NM",44,0)
DGRPDD1^^0^B29245960
"BLD",3165,"KRN",9.8,"NM","B","DG53244P",30)

"BLD",3165,"KRN",9.8,"NM","B","DG53244Q",33)

"BLD",3165,"KRN",9.8,"NM","B","DG53244R",34)

"BLD",3165,"KRN",9.8,"NM","B","DG53244S",35)

"BLD",3165,"KRN",9.8,"NM","B","DG53244T",37)

"BLD",3165,"KRN",9.8,"NM","B","DG53244U",38)

"BLD",3165,"KRN",9.8,"NM","B","DG53244V",39)

"BLD",3165,"KRN",9.8,"NM","B","DGBUL",40)

"BLD",3165,"KRN",9.8,"NM","B","DGDDC",42)

"BLD",3165,"KRN",9.8,"NM","B","DGLOCK2",36)

"BLD",3165,"KRN",9.8,"NM","B","DGNFUNC",9)
 
"BLD",3165,"KRN",9.8,"NM","B","DGRP1",31)

"BLD",3165,"KRN",9.8,"NM","B","DGRPDD1",44)

"BLD",3165,"KRN",9.8,"NM","B","DGRPE",32)

"BLD",3165,"KRN",9.8,"NM","B","DPTLK",4)
 
"BLD",3165,"KRN",9.8,"NM","B","DPTLK1",23)

"BLD",3165,"KRN",9.8,"NM","B","DPTLK2",6)
 
"BLD",3165,"KRN",9.8,"NM","B","DPTNAME",1)
 
"BLD",3165,"KRN",9.8,"NM","B","DPTNAME1",43)

"BLD",3165,"KRN",19,0)
19
"BLD",3165,"KRN",19,"NM",0)
^9.68A^^
"BLD",3165,"KRN",19.1,0)
19.1
"BLD",3165,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",3165,"KRN",101,0)
101
"BLD",3165,"KRN",101,"NM",0)
^9.68A^1^1
"BLD",3165,"KRN",101,"NM",1,0)
DG PATCH 244^^0
"BLD",3165,"KRN",101,"NM","B","DG PATCH 244",1)

"BLD",3165,"KRN",409.61,0)
409.61
"BLD",3165,"KRN",771,0)
771
"BLD",3165,"KRN",869.2,0)
869.2
"BLD",3165,"KRN",870,0)
870
"BLD",3165,"KRN",8994,0)
8994
"BLD",3165,"KRN","B",.4,.4)
 
"BLD",3165,"KRN","B",.401,.401)
 
"BLD",3165,"KRN","B",.402,.402)
 
"BLD",3165,"KRN","B",.403,.403)
 
"BLD",3165,"KRN","B",.5,.5)
 
"BLD",3165,"KRN","B",.84,.84)
 
"BLD",3165,"KRN","B",3.6,3.6)
 
"BLD",3165,"KRN","B",3.8,3.8)
 
"BLD",3165,"KRN","B",9.2,9.2)
 
"BLD",3165,"KRN","B",9.8,9.8)
 
"BLD",3165,"KRN","B",19,19)
 
"BLD",3165,"KRN","B",19.1,19.1)
 
"BLD",3165,"KRN","B",101,101)
 
"BLD",3165,"KRN","B",409.61,409.61)
 
"BLD",3165,"KRN","B",771,771)
 
"BLD",3165,"KRN","B",869.2,869.2)
 
"BLD",3165,"KRN","B",870,870)
 
"BLD",3165,"KRN","B",8994,8994)
 
"BLD",3165,"QUES",0)
^9.62^^
"BLD",3165,"REQB",0)
^9.611^7^7
"BLD",3165,"REQB",1,0)
XU*8.0*211^2
"BLD",3165,"REQB",2,0)
XU*8.0*240^2
"BLD",3165,"REQB",3,0)
DI*22.0*116^2
"BLD",3165,"REQB",4,0)
DG*5.3*494^2
"BLD",3165,"REQB",5,0)
DG*5.3*489^2
"BLD",3165,"REQB",6,0)
XU*8.0*301^2
"BLD",3165,"REQB",7,0)
DG*5.3*506^2
"BLD",3165,"REQB","B","DG*5.3*489",5)

"BLD",3165,"REQB","B","DG*5.3*494",4)

"BLD",3165,"REQB","B","DG*5.3*506",7)

"BLD",3165,"REQB","B","DI*22.0*116",3)

"BLD",3165,"REQB","B","XU*8.0*211",1)

"BLD",3165,"REQB","B","XU*8.0*240",2)

"BLD",3165,"REQB","B","XU*8.0*301",6)

"FIA",2)
PATIENT
"FIA",2,0)
^DPT(
"FIA",2,0,0)
2I
"FIA",2,0,1)
y^y^p^^^^n
"FIA",2,0,10)

"FIA",2,0,11)

"FIA",2,0,"RLRO")

"FIA",2,0,"VR")
5.3^DG
"FIA",2,2)
1
"FIA",2,2,1.01)

"FIA",2,2,1.02)

"FIA",2,2,1.03)

"FIA",2,2,1.04)

"FIA",2,2,1.05)

"FIA",2,2,1.06)

"FIA",2,2,1.07)

"FIA",2,2,1.08)

"FIA",2,2,1.09)

"FIA",2,2.01)
1
"FIA",2,2.01,100.03)

"FIA",2,2.101)
1
"FIA",2,2.101,100.21)

"INIT")
POST^DG53244P
"KRN",101,4663,-1)
0^1
"KRN",101,4663,0)
DG PATCH 244^DG PATCH 244^^E^^^^^^^^REGISTRATION
"KRN",101,4663,1,0)
^^4^4^3011219^
"KRN",101,4663,1,1,0)
This server protocol will be used by patch DG*5.3*244 to generate an HL7
"KRN",101,4663,1,2,0)
Update Patient (event code A08) message.  All local subscribers to VAFC
"KRN",101,4663,1,3,0)
ADT-A08 SERVER will be added as subscribers to this protocol by the post
"KRN",101,4663,1,4,0)
init included with DG*5.3*244.
"KRN",101,4663,99)
59280,70955
"KRN",101,4663,770)
VAFC PIMS^^ADT^A08^^P^^NE^NE^2.3^
"KRN",101,4663,772)
Q
"KRN",101,4663,775,0)
^101.0775PA^3^3
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",114,-1)
1^1
"PKG",114,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",114,20,0)
^9.402P^^
"PKG",114,22,0)
^9.49I^1^1
"PKG",114,22,1,0)
5.3^2930813^2930821
"PKG",114,22,1,"PAH",1,0)
244^3030514^100583
"PKG",114,22,1,"PAH",1,1,0)
^^1^1^3030514
"PKG",114,22,1,"PAH",1,1,1,0)
Patient name standardization patch. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
19
"RTN","DG53244P")
0^30^B28892688
"RTN","DG53244P",1,0)
DG53244P ;BPFO/JRP - Post init for DG*5.3*244 ; 26 Jan 2002 10:51 PM
"RTN","DG53244P",2,0)
 ;;5.3;Registration;**244**;Aug 13, 1993
"RTN","DG53244P",3,0)
 ;
"RTN","DG53244P",4,0)
POST ;Entry point for post init
"RTN","DG53244P",5,0)
 D POST^DG53244S
"RTN","DG53244P",6,0)
 D HL7
"RTN","DG53244P",7,0)
 Q
"RTN","DG53244P",8,0)
 ;
"RTN","DG53244P",9,0)
HL7 ;BPFO/JRP - Set up scratch HL7 protocol used for delivery of name
"RTN","DG53244P",10,0)
 ; change messages to local COTS systems (mimic ADT-A08 messaging in
"RTN","DG53244P",11,0)
 ; VAFC namespace)
"RTN","DG53244P",12,0)
 ;
"RTN","DG53244P",13,0)
 D BMES^XPDUTL("Building HL7 protocol...")
"RTN","DG53244P",14,0)
 ;Declare/initialize variables
"RTN","DG53244P",15,0)
 N IGNORE,LOCAL,WHOOPS,PTR101,ORIGNAME,NEWNAME,TEXT
"RTN","DG53244P",16,0)
 S ORIGNAME="VAFC ADT-A08 SERVER"
"RTN","DG53244P",17,0)
 S NEWNAME="DG PATCH 244"
"RTN","DG53244P",18,0)
 S TEXT(1)=" "
"RTN","DG53244P",19,0)
 S TEXT(2)="Adding local subscribers of the '"_ORIGNAME_"' protocol"
"RTN","DG53244P",20,0)
 S TEXT(3)="as subscribers to the '"_NEWNAME_"' protocol.  Doing"
"RTN","DG53244P",21,0)
 S TEXT(4)="this will allow COTS systems to be notified of name changes"
"RTN","DG53244P",22,0)
 S TEXT(5)="made during the name standardization conversion."
"RTN","DG53244P",23,0)
 S TEXT(6)=" "
"RTN","DG53244P",24,0)
 D MES^XPDUTL(.TEXT)
"RTN","DG53244P",25,0)
 ;Get list of subscribers to ignore
"RTN","DG53244P",26,0)
 K TEXT
"RTN","DG53244P",27,0)
 S TEXT(1)=" "
"RTN","DG53244P",28,0)
 S TEXT(2)="Building list of national subscribers to exclude ..."
"RTN","DG53244P",29,0)
 D MES^XPDUTL(.TEXT)
"RTN","DG53244P",30,0)
 D BLDIGN(.IGNORE)
"RTN","DG53244P",31,0)
 ;Get subscription list of original event protocol
"RTN","DG53244P",32,0)
 K TEXT
"RTN","DG53244P",33,0)
 S TEXT(1)=" "
"RTN","DG53244P",34,0)
 S TEXT(2)="Building list of local subscribers to '"_ORIGNAME_"' ..."
"RTN","DG53244P",35,0)
 D MES^XPDUTL(.TEXT)
"RTN","DG53244P",36,0)
 S PTR101=$$FIND1^DIC(101,,"QX",ORIGNAME,"B")
"RTN","DG53244P",37,0)
 I 'PTR101 D  Q
"RTN","DG53244P",38,0)
 .D CLEAN^DILF
"RTN","DG53244P",39,0)
 .K TEXT
"RTN","DG53244P",40,0)
 .S TEXT(1)=" "
"RTN","DG53244P",41,0)
 .S TEXT(2)=" "
"RTN","DG53244P",42,0)
 .S TEXT(3)="  ** ERROR **"
"RTN","DG53244P",43,0)
 .S TEXT(4)="  Protocol '"_ORIGNAME_"' could not be found"
"RTN","DG53244P",44,0)
 .S TEXT(5)="  ***********"
"RTN","DG53244P",45,0)
 .S TEXT(6)=" "
"RTN","DG53244P",46,0)
 .S TEXT(7)="** Resolve error and run HL7^DG53244P before running name conversion **"
"RTN","DG53244P",47,0)
 .S TEXT(8)=" "
"RTN","DG53244P",48,0)
 .S TEXT(9)="--------------------"
"RTN","DG53244P",49,0)
 .D MES^XPDUTL(.TEXT)
"RTN","DG53244P",50,0)
 D BLDCUR(PTR101,.LOCAL,.IGNORE)
"RTN","DG53244P",51,0)
 ;No local protocols
"RTN","DG53244P",52,0)
 I '$O(LOCAL(0)) D  Q
"RTN","DG53244P",53,0)
 .K TEXT
"RTN","DG53244P",54,0)
 .S TEXT(1)=" "
"RTN","DG53244P",55,0)
 .S TEXT(2)="No local subscribers where found.  No further actions required."
"RTN","DG53244P",56,0)
 .S TEXT(3)=" "
"RTN","DG53244P",57,0)
 .S TEXT(4)="--------------------"
"RTN","DG53244P",58,0)
 .D MES^XPDUTL(.TEXT)
"RTN","DG53244P",59,0)
 ;Add local protocols as subscribers to conversion protocol
"RTN","DG53244P",60,0)
 K TEXT
"RTN","DG53244P",61,0)
 S TEXT(1)=" "
"RTN","DG53244P",62,0)
 S TEXT(2)="Adding local subscribers to '"_NEWNAME_"' ..."
"RTN","DG53244P",63,0)
 D MES^XPDUTL(.TEXT)
"RTN","DG53244P",64,0)
 S PTR101=$$FIND1^DIC(101,,"QX",NEWNAME,"B")
"RTN","DG53244P",65,0)
 I 'PTR101 D  Q
"RTN","DG53244P",66,0)
 .D CLEAN^DILF
"RTN","DG53244P",67,0)
 .K TEXT
"RTN","DG53244P",68,0)
 .S TEXT(1)=" "
"RTN","DG53244P",69,0)
 .S TEXT(2)=" "
"RTN","DG53244P",70,0)
 .S TEXT(3)="  ** ERROR **"
"RTN","DG53244P",71,0)
 .S TEXT(4)="  Protocol '"_NEWNAME_"' could not be found"
"RTN","DG53244P",72,0)
 .S TEXT(5)="  ***********"
"RTN","DG53244P",73,0)
 .S TEXT(6)=" "
"RTN","DG53244P",74,0)
 .S TEXT(7)="** Resolve error and run HL7^DG53244P before running name conversion **"
"RTN","DG53244P",75,0)
 .S TEXT(8)=" "
"RTN","DG53244P",76,0)
 .S TEXT(9)="--------------------"
"RTN","DG53244P",77,0)
 .D MES^XPDUTL(.TEXT)
"RTN","DG53244P",78,0)
 D ADDLIST(PTR101,.LOCAL,.WHOOPS)
"RTN","DG53244P",79,0)
 ;Not all protocol were added
"RTN","DG53244P",80,0)
 I +$O(WHOOPS(0)) D  Q
"RTN","DG53244P",81,0)
 .;Print error(s)
"RTN","DG53244P",82,0)
 .K TEXT
"RTN","DG53244P",83,0)
 .S TEXT(1)=" "
"RTN","DG53244P",84,0)
 .S TEXT(2)="  ** ERROR **"
"RTN","DG53244P",85,0)
 .S TEXT(3)="  The following protocols were not added as subscribers"
"RTN","DG53244P",86,0)
 .D MES^XPDUTL(.TEXT)
"RTN","DG53244P",87,0)
 .S PTR101=0
"RTN","DG53244P",88,0)
 .F  S PTR101=+$O(WHOOPS(PTR101)) Q:'PTR101  D
"RTN","DG53244P",89,0)
 ..K TEXT
"RTN","DG53244P",90,0)
 ..S TEXT="    "_WHOOPS(PTR101)
"RTN","DG53244P",91,0)
 ..D MES^XPDUTL(TEXT)
"RTN","DG53244P",92,0)
 .K TEXT
"RTN","DG53244P",93,0)
 .S TEXT(1)="  ***********"
"RTN","DG53244P",94,0)
 .S TEXT(2)=" "
"RTN","DG53244P",95,0)
 .S TEXT(3)="** Resolve error and run HL7^DG53244P before running name conversion **"
"RTN","DG53244P",96,0)
 .S TEXT(4)=" "
"RTN","DG53244P",97,0)
 .S TEXT(5)="--------------------"
"RTN","DG53244P",98,0)
 .D MES^XPDUTL(.TEXT)
"RTN","DG53244P",99,0)
 ;Done
"RTN","DG53244P",100,0)
 D BMES^XPDUTL("--------------------")
"RTN","DG53244P",101,0)
 Q
"RTN","DG53244P",102,0)
 ;
"RTN","DG53244P",103,0)
BLDIGN(ARRAY) ;Build list of HL7 subscriber protocols to ignore
"RTN","DG53244P",104,0)
 ;Input  : ARRAY - Array to place list into (dot syntax)
"RTN","DG53244P",105,0)
 ;Output : ARRAY() - List of HL7 subscriber protocols to ignore
"RTN","DG53244P",106,0)
 ;                   ARRAY(x) = Protocol Name
"RTN","DG53244P",107,0)
 ;                              x is pointer to Protocol file
"RTN","DG53244P",108,0)
 ;Note   : Assumes ARRAY was input
"RTN","DG53244P",109,0)
 ;       : ARRAY is initialized (KILLed) on input
"RTN","DG53244P",110,0)
 ;
"RTN","DG53244P",111,0)
 ;Declare variables
"RTN","DG53244P",112,0)
 N LINE,TEXT,PTR101
"RTN","DG53244P",113,0)
 K ARRAY
"RTN","DG53244P",114,0)
 ;Loop though list of names
"RTN","DG53244P",115,0)
 F LINE=1:1 S TEXT=$T(IGNORE+LINE) Q:$P(TEXT,";",2)  D
"RTN","DG53244P",116,0)
 .S TEXT=$P(TEXT,";",3,99999)
"RTN","DG53244P",117,0)
 .Q:TEXT=""
"RTN","DG53244P",118,0)
 .;Convert name to pointer
"RTN","DG53244P",119,0)
 .S PTR101=$$FIND1^DIC(101,,"QX",TEXT,"B")
"RTN","DG53244P",120,0)
 .Q:'PTR101
"RTN","DG53244P",121,0)
 .;Add to list
"RTN","DG53244P",122,0)
 .S ARRAY(PTR101)=TEXT
"RTN","DG53244P",123,0)
 ;Done
"RTN","DG53244P",124,0)
 D CLEAN^DILF
"RTN","DG53244P",125,0)
 Q
"RTN","DG53244P",126,0)
 ;
"RTN","DG53244P",127,0)
BLDCUR(EVENT,ARRAY,EXCEPT) ;Build list of subscribers to HL7 event protocol
"RTN","DG53244P",128,0)
 ;Input  : EVENT - Pointer to event protocol
"RTN","DG53244P",129,0)
 ;         ARRAY - Array to place list into (dot syntax)
"RTN","DG53244P",130,0)
 ;         EXCEPT - List of subscribers to exclude (optional)(dot syntax)
"RTN","DG53244P",131,0)
 ;                  EXCEPT(x) where x is pointer to Protocol file
"RTN","DG53244P",132,0)
 ;Output : ARRAY() - List of subscribing protocols
"RTN","DG53244P",133,0)
 ;                   ARRAY(x) = Protocol Name
"RTN","DG53244P",134,0)
 ;                              x is pointer to Protocol file
"RTN","DG53244P",135,0)
 ;Note   : Assumes EVENT & ARRAY are input
"RTN","DG53244P",136,0)
 ;       : Assumes EVENT is a valid pointer to an HL7 event protocol
"RTN","DG53244P",137,0)
 ;       : ARRAY is initialized (KILLed on input)
"RTN","DG53244P",138,0)
 ;
"RTN","DG53244P",139,0)
 ;Declare variables
"RTN","DG53244P",140,0)
 N PTR101,NODE,IENS,PTRMULT,ITEM,SUBSCRIB
"RTN","DG53244P",141,0)
 K ARRAY
"RTN","DG53244P",142,0)
 ;Get entries in ITEM and SUBSCRIBER multiples
"RTN","DG53244P",143,0)
 S IENS=","_EVENT_","
"RTN","DG53244P",144,0)
 D LIST^DIC(101.01,IENS,.01,"I",,,,,,,"ITEM")
"RTN","DG53244P",145,0)
 D LIST^DIC(101.0775,IENS,.01,"I",,,,,,,"SUBSCRIB")
"RTN","DG53244P",146,0)
 D CLEAN^DILF
"RTN","DG53244P",147,0)
 ;Empty multiples
"RTN","DG53244P",148,0)
 Q:'$G(ITEM("DILIST",0))
"RTN","DG53244P",149,0)
 Q:'$G(SUBSCRIB("DILIST",0))
"RTN","DG53244P",150,0)
 ;Loop extracted lists
"RTN","DG53244P",151,0)
 F NODE=$NA(ITEM("DILIST",1)),$NA(SUBSCRIB("DILIST",1)) D
"RTN","DG53244P",152,0)
 .S PTRMULT=0
"RTN","DG53244P",153,0)
 .F  S PTRMULT=+$O(@NODE@(PTRMULT)) Q:'PTRMULT  D
"RTN","DG53244P",154,0)
 ..S PTR101=+$G(@NODE@(PTRMULT))
"RTN","DG53244P",155,0)
 ..Q:'PTR101
"RTN","DG53244P",156,0)
 ..;Screen out excluded protocols
"RTN","DG53244P",157,0)
 ..Q:$D(EXCEPT(PTR101))
"RTN","DG53244P",158,0)
 ..;Already in list
"RTN","DG53244P",159,0)
 ..Q:$D(ARRAY(PTR101))
"RTN","DG53244P",160,0)
 ..;Add to output list
"RTN","DG53244P",161,0)
 ..S IENS=PTR101_","
"RTN","DG53244P",162,0)
 ..S ARRAY(PTR101)=$$GET1^DIQ(101,PTR101,.01)
"RTN","DG53244P",163,0)
 ;Done
"RTN","DG53244P",164,0)
 D CLEAN^DILF
"RTN","DG53244P",165,0)
 Q
"RTN","DG53244P",166,0)
 ;
"RTN","DG53244P",167,0)
ADDLIST(EVENT,ARRAY,ERROR) ;Add subscribers to HL7 event protocol
"RTN","DG53244P",168,0)
 ;Input  : EVENT - Pointer to event protocol
"RTN","DG53244P",169,0)
 ;         ARRAY - List of subscribing protocols (dot syntax)
"RTN","DG53244P",170,0)
 ;                   ARRAY(x) = Protocol Name
"RTN","DG53244P",171,0)
 ;                              x is pointer to Protocol file
"RTN","DG53244P",172,0)
 ;         ERROR - Array to contain list of protocols that could not
"RTN","DG53244P",173,0)
 ;                 be added as subscribers (dot syntax)
"RTN","DG53244P",174,0)
 ;Output : None
"RTN","DG53244P",175,0)
 ;         ERROR() - List of non-added protocols
"RTN","DG53244P",176,0)
 ;                   ERROR(x) = Protocol name
"RTN","DG53244P",177,0)
 ;                              x is pointer to Protocol file
"RTN","DG53244P",178,0)
 ;Note   : Assumes EVENT, ARRAY, and ERROR are input
"RTN","DG53244P",179,0)
 ;       : Assumes EVENT is a valid pointer to an HL7 event protocol
"RTN","DG53244P",180,0)
 ;       : Assumes ARRAY contains valid pointers to HL7 subscriber
"RTN","DG53244P",181,0)
 ;         protocols
"RTN","DG53244P",182,0)
 ;
"RTN","DG53244P",183,0)
 ;Declare variables
"RTN","DG53244P",184,0)
 N IENS,FDAROOT,IENROOT,MSGROOT,PTR101
"RTN","DG53244P",185,0)
 ;Loop through list of subscribers
"RTN","DG53244P",186,0)
 S PTR101=0
"RTN","DG53244P",187,0)
 F  S PTR101=+$O(ARRAY(PTR101)) Q:'PTR101  D
"RTN","DG53244P",188,0)
 .;Add protocol to subscription list of event protocol
"RTN","DG53244P",189,0)
 .K FDAROOT,IENROOT,MSGROOT
"RTN","DG53244P",190,0)
 .S IENS="?+1,"_EVENT_","
"RTN","DG53244P",191,0)
 .S FDAROOT(101.0775,IENS,.01)=PTR101
"RTN","DG53244P",192,0)
 .D UPDATE^DIE("","FDAROOT","IENROOT","MSGROOT")
"RTN","DG53244P",193,0)
 .I $D(MSGROOT("DIERR")) S ERROR(PTR101)=ARRAY(PTR101)
"RTN","DG53244P",194,0)
 ;Done
"RTN","DG53244P",195,0)
 D CLEAN^DILF
"RTN","DG53244P",196,0)
 Q
"RTN","DG53244P",197,0)
 ;
"RTN","DG53244P",198,0)
 ;
"RTN","DG53244P",199,0)
IGNORE ;List of National HL7 subscriber protocols to ignore
"RTN","DG53244P",200,0)
 ;;DG PTF ADT-A08 CLIENT
"RTN","DG53244P",201,0)
 ;;VAFC TFL-UPDATE CLIENT
"RTN","DG53244P",202,0)
 ;;RG ADT-A08 CLIENT
"RTN","DG53244P",203,0)
 ;;RG PT SUBSCRIPTION RECEIVER
"RTN","DG53244P",204,0)
 ;1;End of list
"RTN","DG53244P",205,0)
 ;
"RTN","DG53244Q")
0^33^B73982896
"RTN","DG53244Q",1,0)
DG53244Q ;BPOIFO/KEITH - Post-init continuation for DG*5.3*244 ; 26 Jan 2002  8:33 PM
"RTN","DG53244Q",2,0)
 ;;5.3;Registration;**244**;Aug 13, 1993
"RTN","DG53244Q",3,0)
 ;
"RTN","DG53244Q",4,0)
72 ;Set values for NOP index
"RTN","DG53244Q",5,0)
 D MES^XPDUTL("Filing the 'NOP' index")
"RTN","DG53244Q",6,0)
 S DGFDA(.11,"+1,",.01)="2"
"RTN","DG53244Q",7,0)
 S DGFDA(.11,"+1,",.02)="NOP"
"RTN","DG53244Q",8,0)
 S DGFDA(.11,"+1,",.11)="Index of standardized values that don't match .01 value."
"RTN","DG53244Q",9,0)
 S DGFDA(.11,"+1,",.2)="R"
"RTN","DG53244Q",10,0)
 S DGFDA(.11,"+1,",.4)="F"
"RTN","DG53244Q",11,0)
 S DGFDA(.11,"+1,",.41)="IR"
"RTN","DG53244Q",12,0)
 S DGFDA(.11,"+1,",.5)="I"
"RTN","DG53244Q",13,0)
 S DGFDA(.11,"+1,",.51)="2"
"RTN","DG53244Q",14,0)
 S DGFDA(.11,"+1,",.42)="LS"
"RTN","DG53244Q",15,0)
 S DGFDA(.11,"+1,",1.1)="S ^DPT(""NOP"",$E(X,1,30),DA)="""""
"RTN","DG53244Q",16,0)
 S DGFDA(.11,"+1,",2.1)="K ^DPT(""NOP"",$E(X,1,30),DA)"
"RTN","DG53244Q",17,0)
 S DGFDA(.114,"+2,+1,",.01)="1"
"RTN","DG53244Q",18,0)
 S DGFDA(.114,"+2,+1,",1)="F"
"RTN","DG53244Q",19,0)
 S DGFDA(.114,"+2,+1,",2)="2"
"RTN","DG53244Q",20,0)
 S DGFDA(.114,"+2,+1,",3)=".01"
"RTN","DG53244Q",21,0)
 S DGFDA(.114,"+2,+1,",6)="30"
"RTN","DG53244Q",22,0)
 S DGFDA(.114,"+2,+1,",7)="F"
"RTN","DG53244Q",23,0)
 S DGFDA(.114,"+2,+1,",.5)="1"
"RTN","DG53244Q",24,0)
 S DGFDA(.114,"+2,+1,",5)="S X=$$NOP^DPTNAME(X)"
"RTN","DG53244Q",25,0)
 S DGFDA(.114,"+2,+1,",5.3)="S X=$$NOP^DPTNAME(X)"
"RTN","DG53244Q",26,0)
 Q
"RTN","DG53244Q",27,0)
 ;
"RTN","DG53244Q",28,0)
100 ;Set values for ANAM01 index
"RTN","DG53244Q",29,0)
 D MES^XPDUTL("Filing the 'ANAM01' index")
"RTN","DG53244Q",30,0)
 S DGFDA(.11,"+1,",.01)="2"
"RTN","DG53244Q",31,0)
 S DGFDA(.11,"+1,",.02)="ANAM01"
"RTN","DG53244Q",32,0)
 S DGFDA(.11,"+1,",.11)="This index keeps the NAME COMPONENTS file in synch with the .01 field."
"RTN","DG53244Q",33,0)
 S DGFDA(.11,"+1,",.2)="MU"
"RTN","DG53244Q",34,0)
 S DGFDA(.11,"+1,",.4)="F"
"RTN","DG53244Q",35,0)
 S DGFDA(.11,"+1,",.41)="IR"
"RTN","DG53244Q",36,0)
 S DGFDA(.11,"+1,",.5)="I"
"RTN","DG53244Q",37,0)
 S DGFDA(.11,"+1,",.51)="2"
"RTN","DG53244Q",38,0)
 S DGFDA(.11,"+1,",.42)="A"
"RTN","DG53244Q",39,0)
 S DGFDA(.11,"+1,",1.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^DPTNAME(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.01,.DG20NAME,1.01,+$P($G(^DPT(DA,""NAME"")),U),""CL30"") K DG20NAME Q"
"RTN","DG53244Q",40,0)
 S DGFDA(.11,"+1,",2.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.01,1.01) Q"
"RTN","DG53244Q",41,0)
 S DGFDA(.114,"+2,+1,",.01)="1"
"RTN","DG53244Q",42,0)
 S DGFDA(.114,"+2,+1,",1)="F"
"RTN","DG53244Q",43,0)
 S DGFDA(.114,"+2,+1,",2)="2"
"RTN","DG53244Q",44,0)
 S DGFDA(.114,"+2,+1,",3)=".01"
"RTN","DG53244Q",45,0)
 S DGFDA(.114,"+2,+1,",7)="F"
"RTN","DG53244Q",46,0)
 S DGFDA(.114,"+2,+1,",.5)="1"
"RTN","DG53244Q",47,0)
 Q
"RTN","DG53244Q",48,0)
 ;
"RTN","DG53244Q",49,0)
101 ;Set values for ANAM201 index
"RTN","DG53244Q",50,0)
 D MES^XPDUTL("Filing the 'ANAM201' index")
"RTN","DG53244Q",51,0)
 S DGFDA(.11,"+1,",.01)="2"
"RTN","DG53244Q",52,0)
 S DGFDA(.11,"+1,",.02)="ANAM201"
"RTN","DG53244Q",53,0)
 S DGFDA(.11,"+1,",.11)="This index keeps the NAME COMPONENTS file in synch with the .01 field."
"RTN","DG53244Q",54,0)
 S DGFDA(.11,"+1,",.2)="MU"
"RTN","DG53244Q",55,0)
 S DGFDA(.11,"+1,",.4)="F"
"RTN","DG53244Q",56,0)
 S DGFDA(.11,"+1,",.41)="IR"
"RTN","DG53244Q",57,0)
 S DGFDA(.11,"+1,",.5)="W"
"RTN","DG53244Q",58,0)
 S DGFDA(.11,"+1,",.51)="2.01"
"RTN","DG53244Q",59,0)
 S DGFDA(.11,"+1,",.42)="A"
"RTN","DG53244Q",60,0)
 S DGFDA(.11,"+1,",1.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^DPTNAME(.DG20NAME),UPDCOMP^XLFNAME2(2.01,.DA,.01,.DG20NAME,100.03,,""CL30"") K DG20NAME Q"
"RTN","DG53244Q",61,0)
 S DGFDA(.11,"+1,",2.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2.01,.DA,.01,100.03) Q"
"RTN","DG53244Q",62,0)
 S DGFDA(.114,"+2,+1,",.01)="1"
"RTN","DG53244Q",63,0)
 S DGFDA(.114,"+2,+1,",1)="F"
"RTN","DG53244Q",64,0)
 S DGFDA(.114,"+2,+1,",2)="2.01"
"RTN","DG53244Q",65,0)
 S DGFDA(.114,"+2,+1,",3)=".01"
"RTN","DG53244Q",66,0)
 S DGFDA(.114,"+2,+1,",7)="F"
"RTN","DG53244Q",67,0)
 S DGFDA(.114,"+2,+1,",.5)="1"
"RTN","DG53244Q",68,0)
 Q
"RTN","DG53244Q",69,0)
 ;
"RTN","DG53244Q",70,0)
102 ;Set values for ANAM1001 index
"RTN","DG53244Q",71,0)
 D MES^XPDUTL("Filing the 'ANAM1001' index")
"RTN","DG53244Q",72,0)
 S DGFDA(.11,"+1,",.01)="2"
"RTN","DG53244Q",73,0)
 S DGFDA(.11,"+1,",.02)="ANAM1001"
"RTN","DG53244Q",74,0)
 S DGFDA(.11,"+1,",.11)="This index keeps the NAME COMPONENTS file in synch with field #30."
"RTN","DG53244Q",75,0)
 S DGFDA(.11,"+1,",.2)="MU"
"RTN","DG53244Q",76,0)
 S DGFDA(.11,"+1,",.4)="F"
"RTN","DG53244Q",77,0)
 S DGFDA(.11,"+1,",.41)="IR"
"RTN","DG53244Q",78,0)
 S DGFDA(.11,"+1,",.5)="W"
"RTN","DG53244Q",79,0)
 S DGFDA(.11,"+1,",.51)="2.101"
"RTN","DG53244Q",80,0)
 S DGFDA(.11,"+1,",.42)="A"
"RTN","DG53244Q",81,0)
 S DGFDA(.11,"+1,",1.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^DPTNAME(.DG20NAME),UPDCOMP^XLFNAME2(2.101,.DA,30,.DG20NAME,100.21,,""CL30"") K DG20NAME Q"
"RTN","DG53244Q",82,0)
 S DGFDA(.11,"+1,",2.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2.101,.DA,30,100.21) Q"
"RTN","DG53244Q",83,0)
 S DGFDA(.114,"+2,+1,",.01)="1"
"RTN","DG53244Q",84,0)
 S DGFDA(.114,"+2,+1,",1)="F"
"RTN","DG53244Q",85,0)
 S DGFDA(.114,"+2,+1,",2)="2.101"
"RTN","DG53244Q",86,0)
 S DGFDA(.114,"+2,+1,",3)="30"
"RTN","DG53244Q",87,0)
 S DGFDA(.114,"+2,+1,",7)="F"
"RTN","DG53244Q",88,0)
 S DGFDA(.114,"+2,+1,",.5)="1"
"RTN","DG53244Q",89,0)
 Q
"RTN","DG53244Q",90,0)
 ;
"RTN","DG53244Q",91,0)
103 ;Set values for ANAM211 index
"RTN","DG53244Q",92,0)
 D MES^XPDUTL("Filing the 'ANAM211' index")
"RTN","DG53244Q",93,0)
 S DGFDA(.11,"+1,",.01)="2"
"RTN","DG53244Q",94,0)
 S DGFDA(.11,"+1,",.02)="ANAM211"
"RTN","DG53244Q",95,0)
 S DGFDA(.11,"+1,",.11)="This index keeps the NAME COMPONENTS file in synch with field #.211."
"RTN","DG53244Q",96,0)
 S DGFDA(.11,"+1,",.2)="MU"
"RTN","DG53244Q",97,0)
 S DGFDA(.11,"+1,",.4)="F"
"RTN","DG53244Q",98,0)
 S DGFDA(.11,"+1,",.41)="IR"
"RTN","DG53244Q",99,0)
 S DGFDA(.11,"+1,",.5)="I"
"RTN","DG53244Q",100,0)
 S DGFDA(.11,"+1,",.51)="2"
"RTN","DG53244Q",101,0)
 S DGFDA(.11,"+1,",.42)="A"
"RTN","DG53244Q",102,0)
 S DGFDA(.11,"+1,",1.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^DPTNAME(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.211,.DG20NAME,1.02,+$P($G(^DPT(DA,""NAME"")),U,2),""CL35"") K DG20NAME Q"
"RTN","DG53244Q",103,0)
 S DGFDA(.11,"+1,",2.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.211,1.02) Q"
"RTN","DG53244Q",104,0)
 S DGFDA(.114,"+2,+1,",.01)="1"
"RTN","DG53244Q",105,0)
 S DGFDA(.114,"+2,+1,",1)="F"
"RTN","DG53244Q",106,0)
 S DGFDA(.114,"+2,+1,",2)="2"
"RTN","DG53244Q",107,0)
 S DGFDA(.114,"+2,+1,",3)=".211"
"RTN","DG53244Q",108,0)
 S DGFDA(.114,"+2,+1,",7)="F"
"RTN","DG53244Q",109,0)
 S DGFDA(.114,"+2,+1,",.5)="1"
"RTN","DG53244Q",110,0)
 Q
"RTN","DG53244Q",111,0)
 ;
"RTN","DG53244Q",112,0)
104 ;Set values for ANAM2191 index
"RTN","DG53244Q",113,0)
 D MES^XPDUTL("Filing the 'ANAM2191' index")
"RTN","DG53244Q",114,0)
 S DGFDA(.11,"+1,",.01)="2"
"RTN","DG53244Q",115,0)
 S DGFDA(.11,"+1,",.02)="ANAM2191"
"RTN","DG53244Q",116,0)
 S DGFDA(.11,"+1,",.11)="This index keeps the NAME COMPONENTS file in synch with field #.2191."
"RTN","DG53244Q",117,0)
 S DGFDA(.11,"+1,",.2)="MU"
"RTN","DG53244Q",118,0)
 S DGFDA(.11,"+1,",.4)="F"
"RTN","DG53244Q",119,0)
 S DGFDA(.11,"+1,",.41)="IR"
"RTN","DG53244Q",120,0)
 S DGFDA(.11,"+1,",.5)="I"
"RTN","DG53244Q",121,0)
 S DGFDA(.11,"+1,",.51)="2"
"RTN","DG53244Q",122,0)
 S DGFDA(.11,"+1,",.42)="A"
"RTN","DG53244Q",123,0)
 S DGFDA(.11,"+1,",1.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^DPTNAME(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.2191,.DG20NAME,1.03,+$P($G(^DPT(DA,""NAME"")),U,3),""CL35"") K DG20NAME Q"
"RTN","DG53244Q",124,0)
 S DGFDA(.11,"+1,",2.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.2191,1.03) Q"
"RTN","DG53244Q",125,0)
 S DGFDA(.114,"+2,+1,",.01)="1"
"RTN","DG53244Q",126,0)
 S DGFDA(.114,"+2,+1,",1)="F"
"RTN","DG53244Q",127,0)
 S DGFDA(.114,"+2,+1,",2)="2"
"RTN","DG53244Q",128,0)
 S DGFDA(.114,"+2,+1,",3)=".2191"
"RTN","DG53244Q",129,0)
 S DGFDA(.114,"+2,+1,",7)="F"
"RTN","DG53244Q",130,0)
 S DGFDA(.114,"+2,+1,",.5)="1"
"RTN","DG53244Q",131,0)
 Q
"RTN","DG53244Q",132,0)
 ;
"RTN","DG53244Q",133,0)
105 ;Set values for ANAM2401 index
"RTN","DG53244Q",134,0)
 D MES^XPDUTL("Filing the 'ANAM2401' index")
"RTN","DG53244Q",135,0)
 S DGFDA(.11,"+1,",.01)="2"
"RTN","DG53244Q",136,0)
 S DGFDA(.11,"+1,",.02)="ANAM2401"
"RTN","DG53244Q",137,0)
 S DGFDA(.11,"+1,",.11)="This index keeps the NAME COMPONENTS file in synch with field #.2401."
"RTN","DG53244Q",138,0)
 S DGFDA(.11,"+1,",.2)="MU"
"RTN","DG53244Q",139,0)
 S DGFDA(.11,"+1,",.4)="F"
"RTN","DG53244Q",140,0)
 S DGFDA(.11,"+1,",.41)="IR"
"RTN","DG53244Q",141,0)
 S DGFDA(.11,"+1,",.5)="I"
"RTN","DG53244Q",142,0)
 S DGFDA(.11,"+1,",.51)="2"
"RTN","DG53244Q",143,0)
 S DGFDA(.11,"+1,",.42)="A"
"RTN","DG53244Q",144,0)
 S DGFDA(.11,"+1,",1.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^DPTNAME(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.2401,.DG20NAME,1.04,+$P($G(^DPT(DA,""NAME"")),U,4),""CL35"") K DG20NAME Q"
"RTN","DG53244Q",145,0)
 S DGFDA(.11,"+1,",2.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.2401,1.04) Q"
"RTN","DG53244Q",146,0)
 S DGFDA(.114,"+2,+1,",.01)="1"
"RTN","DG53244Q",147,0)
 S DGFDA(.114,"+2,+1,",1)="F"
"RTN","DG53244Q",148,0)
 S DGFDA(.114,"+2,+1,",2)="2"
"RTN","DG53244Q",149,0)
 S DGFDA(.114,"+2,+1,",3)=".2401"
"RTN","DG53244Q",150,0)
 S DGFDA(.114,"+2,+1,",7)="F"
"RTN","DG53244Q",151,0)
 S DGFDA(.114,"+2,+1,",.5)="1"
"RTN","DG53244Q",152,0)
 Q
"RTN","DG53244Q",153,0)
 ;
"RTN","DG53244Q",154,0)
106 ;Set values for ANAM2402 index
"RTN","DG53244Q",155,0)
 D MES^XPDUTL("Filing the 'ANAM2402' index")
"RTN","DG53244Q",156,0)
 S DGFDA(.11,"+1,",.01)="2"
"RTN","DG53244Q",157,0)
 S DGFDA(.11,"+1,",.02)="ANAM2402"
"RTN","DG53244Q",158,0)
 S DGFDA(.11,"+1,",.11)="This index keeps the NAME COMPONENTS file in synch with field #.2402."
"RTN","DG53244Q",159,0)
 S DGFDA(.11,"+1,",.2)="MU"
"RTN","DG53244Q",160,0)
 S DGFDA(.11,"+1,",.4)="F"
"RTN","DG53244Q",161,0)
 S DGFDA(.11,"+1,",.41)="IR"
"RTN","DG53244Q",162,0)
 S DGFDA(.11,"+1,",.5)="I"
"RTN","DG53244Q",163,0)
 S DGFDA(.11,"+1,",.51)="2"
"RTN","DG53244Q",164,0)
 S DGFDA(.11,"+1,",.42)="A"
"RTN","DG53244Q",165,0)
 S DGFDA(.11,"+1,",1.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^DPTNAME(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.2402,.DG20NAME,1.05,+$P($G(^DPT(DA,""NAME"")),U,5),""CL35"") K DG20NAME Q"
"RTN","DG53244Q",166,0)
 S DGFDA(.11,"+1,",2.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.2402,1.05) Q"
"RTN","DG53244Q",167,0)
 S DGFDA(.114,"+2,+1,",.01)="1"
"RTN","DG53244Q",168,0)
 S DGFDA(.114,"+2,+1,",1)="F"
"RTN","DG53244Q",169,0)
 S DGFDA(.114,"+2,+1,",2)="2"
"RTN","DG53244Q",170,0)
 S DGFDA(.114,"+2,+1,",3)=".2402"
"RTN","DG53244Q",171,0)
 S DGFDA(.114,"+2,+1,",7)="F"
"RTN","DG53244Q",172,0)
 S DGFDA(.114,"+2,+1,",.5)="1"
"RTN","DG53244Q",173,0)
 Q
"RTN","DG53244Q",174,0)
 ;
"RTN","DG53244Q",175,0)
107 ;Set values for ANAM2403 index
"RTN","DG53244Q",176,0)
 D MES^XPDUTL("Filing the 'ANAM2403' index")
"RTN","DG53244Q",177,0)
 S DGFDA(.11,"+1,",.01)="2"
"RTN","DG53244Q",178,0)
 S DGFDA(.11,"+1,",.02)="ANAM2403"
"RTN","DG53244Q",179,0)
 S DGFDA(.11,"+1,",.11)="This index keeps the NAME COMPONENTS file in synch with field #.2403."
"RTN","DG53244Q",180,0)
 S DGFDA(.11,"+1,",.2)="MU"
"RTN","DG53244Q",181,0)
 S DGFDA(.11,"+1,",.4)="F"
"RTN","DG53244Q",182,0)
 S DGFDA(.11,"+1,",.41)="IR"
"RTN","DG53244Q",183,0)
 S DGFDA(.11,"+1,",.5)="I"
"RTN","DG53244Q",184,0)
 S DGFDA(.11,"+1,",.51)="2"
"RTN","DG53244Q",185,0)
 S DGFDA(.11,"+1,",.42)="A"
"RTN","DG53244Q",186,0)
 S DGFDA(.11,"+1,",1.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^DPTNAME(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.2403,.DG20NAME,1.06,+$P($G(^DPT(DA,""NAME"")),U,6),""CL35"") K DG20NAME Q"
"RTN","DG53244Q",187,0)
 S DGFDA(.11,"+1,",2.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.2403,1.06) Q"
"RTN","DG53244Q",188,0)
 S DGFDA(.114,"+2,+1,",.01)="1"
"RTN","DG53244Q",189,0)
 S DGFDA(.114,"+2,+1,",1)="F"
"RTN","DG53244Q",190,0)
 S DGFDA(.114,"+2,+1,",2)="2"
"RTN","DG53244Q",191,0)
 S DGFDA(.114,"+2,+1,",3)=".2403"
"RTN","DG53244Q",192,0)
 S DGFDA(.114,"+2,+1,",7)="F"
"RTN","DG53244Q",193,0)
 S DGFDA(.114,"+2,+1,",.5)="1"
"RTN","DG53244Q",194,0)
 Q
"RTN","DG53244Q",195,0)
 ;
"RTN","DG53244Q",196,0)
109 ;Set values for ANAM331 index
"RTN","DG53244Q",197,0)
 D MES^XPDUTL("Filing the 'ANAM331' index")
"RTN","DG53244Q",198,0)
 S DGFDA(.11,"+1,",.01)="2"
"RTN","DG53244Q",199,0)
 S DGFDA(.11,"+1,",.02)="ANAM331"
"RTN","DG53244Q",200,0)
 S DGFDA(.11,"+1,",.11)="This index keeps the NAME COMPONENTS file in synch with field #.331."
"RTN","DG53244Q",201,0)
 S DGFDA(.11,"+1,",.2)="MU"
"RTN","DG53244Q",202,0)
 S DGFDA(.11,"+1,",.4)="F"
"RTN","DG53244Q",203,0)
 S DGFDA(.11,"+1,",.41)="IR"
"RTN","DG53244Q",204,0)
 S DGFDA(.11,"+1,",.5)="I"
"RTN","DG53244Q",205,0)
 S DGFDA(.11,"+1,",.51)="2"
"RTN","DG53244Q",206,0)
 S DGFDA(.11,"+1,",.42)="A"
"RTN","DG53244Q",207,0)
 S DGFDA(.11,"+1,",1.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^DPTNAME(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.331,.DG20NAME,1.07,+$P($G(^DPT(DA,""NAME"")),U,7),""CL35"") K DG20NAME Q"
"RTN","DG53244Q",208,0)
 S DGFDA(.11,"+1,",2.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.331,1.07) Q"
"RTN","DG53244Q",209,0)
 S DGFDA(.114,"+2,+1,",.01)="1"
"RTN","DG53244Q",210,0)
 S DGFDA(.114,"+2,+1,",1)="F"
"RTN","DG53244Q",211,0)
 S DGFDA(.114,"+2,+1,",2)="2"
"RTN","DG53244Q",212,0)
 S DGFDA(.114,"+2,+1,",3)=".331"
"RTN","DG53244Q",213,0)
 S DGFDA(.114,"+2,+1,",7)="F"
"RTN","DG53244Q",214,0)
 S DGFDA(.114,"+2,+1,",.5)="1"
"RTN","DG53244Q",215,0)
 Q
"RTN","DG53244R")
0^34^B63320205
"RTN","DG53244R",1,0)
DG53244R ;BPOIFO/KEITH - Post-init continuation for DG*5.3*244 ; 27 Jan 2002  6:45 PM
"RTN","DG53244R",2,0)
 ;;5.3;Registration;**244**;Aug 13, 1993
"RTN","DG53244R",3,0)
 ;
"RTN","DG53244R",4,0)
ITXDES ;Set input transforms and field descriptions
"RTN","DG53244R",5,0)
 D BMES^XPDUTL("Setting field descriptions and input transforms")
"RTN","DG53244R",6,0)
 S $P(^DD(2,.01,0),U,5,99)="K:$L(X)>30!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^DPTNAME(.DG20NAME,3,30) K:'$L(X) X,DG20NAME S:$D(X) DGNEWVAL=X"
"RTN","DG53244R",7,0)
 S ^DD(2,.01,3)="Enter name in 'LAST,FIRST MIDDLE SUFFIX' format, must be 3-30 characters in length."
"RTN","DG53244R",8,0)
 K ^DD(2,.01,21)
"RTN","DG53244R",9,0)
 S ^DD(2,.01,21,0)="^^4^4^2990208^^^^"
"RTN","DG53244R",10,0)
 S ^DD(2,.01,21,1,0)="Enter the patient's name in 'LAST,FIRST MIDDLE SUFFIX' format."
"RTN","DG53244R",11,0)
 S ^DD(2,.01,21,2,0)="This value must be 3-30 characters in length and may contain only uppercase"
"RTN","DG53244R",12,0)
 S ^DD(2,.01,21,3,0)="alpha characters, spaces, apostrophes, hyphens and one comma.  All other"
"RTN","DG53244R",13,0)
 S ^DD(2,.01,21,4,0)="characters and parenthetical text will be removed."
"RTN","DG53244R",14,0)
 S $P(^DD(2,.211,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^DPTNAME(.DG20NAME,3,35) K:'$L(X) X,DG20NAME"
"RTN","DG53244R",15,0)
 S ^DD(2,.211,3)="Enter name in 'LAST,FIRST MIDDLE SUFFIX' format, must be 3-35 characters in length."
"RTN","DG53244R",16,0)
 K ^DD(2,.211,21)
"RTN","DG53244R",17,0)
 S ^DD(2,.211,21,0)="^^4^4^2861007^"
"RTN","DG53244R",18,0)
 S ^DD(2,.211,21,1,0)="Enter the primary next of kin's name in 'LAST,FIRST MIDDLE SUFFIX' format."
"RTN","DG53244R",19,0)
 S ^DD(2,.211,21,2,0)="This value must be 3-35 characters in length and may contain only uppercase"
"RTN","DG53244R",20,0)
 S ^DD(2,.211,21,3,0)="alpha characters, spaces, apostrophes, hyphens and one comma.  All other"
"RTN","DG53244R",21,0)
 S ^DD(2,.211,21,4,0)="characters and parenthetical text will be removed."
"RTN","DG53244R",22,0)
 S $P(^DD(2,.2191,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^DPTNAME(.DG20NAME,3,35) K:'$L(X) X,DG20NAME I $D(X) D K1^DGLOCK2"
"RTN","DG53244R",23,0)
 S ^DD(2,.2191,3)="Enter name in 'LAST,FIRST MIDDLE SUFFIX' format, must be 3-35 characters in length."
"RTN","DG53244R",24,0)
 K ^DD(2,.2191,21)
"RTN","DG53244R",25,0)
 S ^DD(2,.2191,21,0)="^^4^4^2861007^^"
"RTN","DG53244R",26,0)
 S ^DD(2,.2191,21,1,0)="Enter the secondary next of kin's name in 'LAST,FIRST MIDDLE SUFFIX' format."
"RTN","DG53244R",27,0)
 S ^DD(2,.2191,21,2,0)="This value must be 3-35 characters in length and may contain only uppercase"
"RTN","DG53244R",28,0)
 S ^DD(2,.2191,21,3,0)="alpha characters, spaces, apostrophes, hyphens and one comma.  All other"
"RTN","DG53244R",29,0)
 S ^DD(2,.2191,21,4,0)="characters and parenthetical text will be removed."
"RTN","DG53244R",30,0)
 S $P(^DD(2,.2401,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^DPTNAME(.DG20NAME,3,35) K:'$L(X) X,DG20NAME"
"RTN","DG53244R",31,0)
 S ^DD(2,.2401,3)="Enter name in 'LAST,FIRST MIDDLE SUFFIX' format, must be 3-35 characters in length."
"RTN","DG53244R",32,0)
 K ^DD(2,.2401,21)
"RTN","DG53244R",33,0)
 S ^DD(2,.2401,21,0)="^^4^4^2861007^"
"RTN","DG53244R",34,0)
 S ^DD(2,.2401,21,1,0)="Enter the father's name in 'LAST,FIRST MIDDLE SUFFIX' format."
"RTN","DG53244R",35,0)
 S ^DD(2,.2401,21,2,0)="This value must be 3-35 characters in length and may contain only uppercase"
"RTN","DG53244R",36,0)
 S ^DD(2,.2401,21,3,0)="alpha characters, spaces, apostrophes, hyphens and one comma.  All other"
"RTN","DG53244R",37,0)
 S ^DD(2,.2401,21,4,0)="characters and parenthetical text will be removed."
"RTN","DG53244R",38,0)
 S $P(^DD(2,.2402,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^DPTNAME(.DG20NAME,3,35) K:'$L(X) X,DG20NAME"
"RTN","DG53244R",39,0)
 S ^DD(2,.2402,3)="Enter name in 'LAST,FIRST MIDDLE SUFFIX' format, must be 3-35 characters in length."
"RTN","DG53244R",40,0)
 K ^DD(2,.2402,21)
"RTN","DG53244R",41,0)
 S ^DD(2,.2402,21,0)="^^4^4^2861007^"
"RTN","DG53244R",42,0)
 S ^DD(2,.2402,21,1,0)="Enter the mother's name in 'LAST,FIRST MIDDLE SUFFIX' format."
"RTN","DG53244R",43,0)
 S ^DD(2,.2402,21,2,0)="This value must be 3-35 characters in length and may contain only uppercase"
"RTN","DG53244R",44,0)
 S ^DD(2,.2402,21,3,0)="alpha characters, spaces, apostrophes, hyphens and one comma.  All other"
"RTN","DG53244R",45,0)
 S ^DD(2,.2402,21,4,0)="characters and parenthetical text will be removed."
"RTN","DG53244R",46,0)
 S $P(^DD(2,.2403,0),U,5,99)="K:$L(X)>35!($L(X)<2) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^DPTNAME(.DG20NAME,3,35,,2,,1) K:'$L(X) X,DG20NAME"
"RTN","DG53244R",47,0)
 S ^DD(2,.2403,3)="Enter name in 'LAST,FIRST MIDDLE SUFFIX' format, must be 3-35 characters in length."
"RTN","DG53244R",48,0)
 K ^DD(2,.2403,21)
"RTN","DG53244R",49,0)
 S ^DD(2,.2403,21,0)="^^4^4^2861007^"
"RTN","DG53244R",50,0)
 S ^DD(2,.2403,21,1,0)="Enter the mother's maiden name in 'LAST,FIRST MIDDLE SUFFIX' format."
"RTN","DG53244R",51,0)
 S ^DD(2,.2403,21,2,0)="Entry of the LAST name only is permitted and the comma may be omitted."
"RTN","DG53244R",52,0)
 S ^DD(2,.2403,21,3,0)="If the response contains no comma, one will be appended to the value."
"RTN","DG53244R",53,0)
 S ^DD(2,.2403,21,4,0)="Including the comma, the value must be at least 3 characters in length."
"RTN","DG53244R",54,0)
 S $P(^DD(2,.331,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^DPTNAME(.DG20NAME,3,35) K:'$L(X) X,DG20NAME"
"RTN","DG53244R",55,0)
 S ^DD(2,.331,3)="Enter name in 'LAST,FIRST MIDDLE SUFFIX' format, must be 3-35 characters in length."
"RTN","DG53244R",56,0)
 K ^DD(2,.331,21)
"RTN","DG53244R",57,0)
 S ^DD(2,.331,21,0)="^^4^4^2861117^^^"
"RTN","DG53244R",58,0)
 S ^DD(2,.331,21,1,0)="Enter the primary emergency contact's name in 'LAST,FIRST MIDDLE SUFFIX' format."
"RTN","DG53244R",59,0)
 S ^DD(2,.331,21,2,0)="This value must be 3-35 characters in length and may contain only uppercase"
"RTN","DG53244R",60,0)
 S ^DD(2,.331,21,3,0)="alpha characters, spaces, apostrophes, hyphens and one comma.  All other"
"RTN","DG53244R",61,0)
 S ^DD(2,.331,21,4,0)="characters and parenthetical text will be removed."
"RTN","DG53244R",62,0)
 S $P(^DD(2,.3311,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^DPTNAME(.DG20NAME,3,35) K:'$L(X) X,DG20NAME I $D(X) D E1^DGLOCK2"
"RTN","DG53244R",63,0)
 S ^DD(2,.3311,3)="Enter name in 'LAST,FIRST MIDDLE SUFFIX' format, must be 3-35 characters in length."
"RTN","DG53244R",64,0)
 K ^DD(2,.3311,21)
"RTN","DG53244R",65,0)
 S ^DD(2,.3311,21,0)="^^4^4^2861007^"
"RTN","DG53244R",66,0)
 S ^DD(2,.3311,21,1,0)="Enter the secondary emergency contact's name in 'LAST,FIRST MIDDLE SUFFIX' format."
"RTN","DG53244R",67,0)
 S ^DD(2,.3311,21,2,0)="This value must be 3-35 characters in length and may contain only uppercase"
"RTN","DG53244R",68,0)
 S ^DD(2,.3311,21,3,0)="alpha characters, spaces, apostrophes, hyphens and one comma.  All other"
"RTN","DG53244R",69,0)
 S ^DD(2,.3311,21,4,0)="characters and parenthetical text will be removed."
"RTN","DG53244R",70,0)
 S $P(^DD(2,.341,0),U,5,99)="K:$L(X)>35!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^DPTNAME(.DG20NAME,3,35) K:'$L(X) X,DG20NAME"
"RTN","DG53244R",71,0)
 S ^DD(2,.341,3)="Enter name in 'LAST,FIRST MIDDLE SUFFIX' format, must be 3-35 characters in length."
"RTN","DG53244R",72,0)
 K ^DD(2,.341,21)
"RTN","DG53244R",73,0)
 S ^DD(2,.341,21,0)="^^4^4^2861007^"
"RTN","DG53244R",74,0)
 S ^DD(2,.341,21,1,0)="Enter the designee's name in 'LAST,FIRST MIDDLE SUFFIX' format."
"RTN","DG53244R",75,0)
 S ^DD(2,.341,21,2,0)="This value must be 3-35 characters in length and may contain only uppercase"
"RTN","DG53244R",76,0)
 S ^DD(2,.341,21,3,0)="alpha characters, spaces, apostrophes, hyphens and one comma.  All other"
"RTN","DG53244R",77,0)
 S ^DD(2,.341,21,4,0)="characters and parenthetical text will be removed."
"RTN","DG53244R",78,0)
 S $P(^DD(2.01,.01,0),U,5,99)="K:$L(X)>30!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^DPTNAME(.DG20NAME,3,30) K:'$L(X) X,DG20NAME"
"RTN","DG53244R",79,0)
 S ^DD(2.01,.01,3)="Enter name in 'LAST,FIRST MIDDLE SUFFIX' format, must be 3-30 characters in length."
"RTN","DG53244R",80,0)
 K ^DD(2.01,.01,21)
"RTN","DG53244R",81,0)
 S ^DD(2.01,.01,21,0)="^^4^4^2861007^"
"RTN","DG53244R",82,0)
 S ^DD(2.01,.01,21,1,0)="Enter the alias name in 'LAST,FIRST MIDDLE SUFFIX' format."
"RTN","DG53244R",83,0)
 S ^DD(2.01,.01,21,2,0)="This value must be 3-30 characters in length and may contain only uppercase"
"RTN","DG53244R",84,0)
 S ^DD(2.01,.01,21,3,0)="alpha characters, spaces, apostrophes, hyphens and one comma.  All other"
"RTN","DG53244R",85,0)
 S ^DD(2.01,.01,21,4,0)="characters and parenthetical text will be removed."
"RTN","DG53244R",86,0)
 S $P(^DD(2.101,30,0),U,5,99)="K:$L(X)>30!($L(X)<3) X I $D(X) S DG20NAME=X,(X,DG20NAME)=$$FORMAT^DPTNAME(.DG20NAME,3,30) K:'$L(X) X,DG20NAME"
"RTN","DG53244R",87,0)
 S ^DD(2.101,30,3)="Enter name in 'LAST,FIRST MIDDLE SUFFIX' format, must be 3-30 characters in length."
"RTN","DG53244R",88,0)
 K ^DD(2.101,30,21)
"RTN","DG53244R",89,0)
 S ^DD(2.101,30,21,0)="^^4^4^2911214^^"
"RTN","DG53244R",90,0)
 S ^DD(2.101,30,21,1,0)="Enter the attorney's name in 'LAST,FIRST MIDDLE SUFFIX' format."
"RTN","DG53244R",91,0)
 S ^DD(2.101,30,21,2,0)="This value must be 3-30 characters in length and may contain only uppercase"
"RTN","DG53244R",92,0)
 S ^DD(2.101,30,21,3,0)="alpha characters, spaces, apostrophes, hyphens and one comma.  All other"
"RTN","DG53244R",93,0)
 S ^DD(2.101,30,21,4,0)="characters and parenthetical text will be removed."
"RTN","DG53244R",94,0)
 Q
"RTN","DG53244R",95,0)
 ;
"RTN","DG53244R",96,0)
DES(DGI,DGA,DGF) ;Set up long description array
"RTN","DG53244R",97,0)
 ;Input: DGI=index number
"RTN","DG53244R",98,0)
 ;       DGA=array (pass by reference)
"RTN","DG53244R",99,0)
 ;       DGF=field number
"RTN","DG53244R",100,0)
 K DGA
"RTN","DG53244R",101,0)
 I DGI=72 D  Q
"RTN","DG53244R",102,0)
 .S DGA(1)="This cross reference facilitates PATIENT file lookups by a standardized name"
"RTN","DG53244R",103,0)
 .S DGA(2)="value.  In addition to the standardization applied by Kernel name utilities,"
"RTN","DG53244R",104,0)
 .S DGA(3)="hyphens and apostrophies are also removed from the name value.  This cross"
"RTN","DG53244R",105,0)
 .S DGA(4)="reference is only set if the standardized name is different than the patient"
"RTN","DG53244R",106,0)
 .S DGA(5)="name value stored in the NAME (#.01) field."
"RTN","DG53244R",107,0)
 S DGA(1)="This cross reference uses Kernel name standardization APIs to keep the NAME"
"RTN","DG53244R",108,0)
 S DGA(2)="COMPONENTS (#20) file record associated with the #"_DGF_" field synchronized"
"RTN","DG53244R",109,0)
 S DGA(3)="with the data value stored in that field."
"RTN","DG53244R",110,0)
 Q
"RTN","DG53244S")
0^35^B32152909
"RTN","DG53244S",1,0)
DG53244S ;BPOIFO/KEITH - Post-init continuation for DG*5.3*244 ; 26 Jan 2002 10:44 PM
"RTN","DG53244S",2,0)
 ;;5.3;Registration;**244**;Aug 13, 1993
"RTN","DG53244S",3,0)
 ;
"RTN","DG53244S",4,0)
POST ;Post-init functions
"RTN","DG53244S",5,0)
 ;
"RTN","DG53244S",6,0)
 ;Install INDEX records
"RTN","DG53244S",7,0)
 D IXBLD
"RTN","DG53244S",8,0)
 ;Update AMPIMIS cross reference
"RTN","DG53244S",9,0)
 D AMPX
"RTN","DG53244S",10,0)
 ;Update input transforms and field descriptions
"RTN","DG53244S",11,0)
 D ITXDES^DG53244R
"RTN","DG53244S",12,0)
 ;Build 'NOP' x-ref
"RTN","DG53244S",13,0)
 D NOP
"RTN","DG53244S",14,0)
 ;Recompile input templates
"RTN","DG53244S",15,0)
 D RECOMP
"RTN","DG53244S",16,0)
 ;Update triggered fields
"RTN","DG53244S",17,0)
 D TRIG
"RTN","DG53244S",18,0)
 Q
"RTN","DG53244S",19,0)
 ;
"RTN","DG53244S",20,0)
AMPX ;Update AMPIMIS cross reference
"RTN","DG53244S",21,0)
 N DGI
"RTN","DG53244S",22,0)
 D BMES^XPDUTL("Updating the AMPIMIS cross reference...")
"RTN","DG53244S",23,0)
 S DGI=0 F  S DGI=$O(^DD(2,.01,1,DGI)) Q:'DGI  D
"RTN","DG53244S",24,0)
 .Q:$P($G(^DD(2,.01,1,DGI,0)),U,2)'="AMPIMIS"
"RTN","DG53244S",25,0)
 .S ^DD(2,.01,1,DGI,1)="I $T(SET^VAFCMIS)'=""""&('$D(VAFCNO)) D SET^VAFCMIS(DA)"
"RTN","DG53244S",26,0)
 .S ^DD(2,.01,1,DGI,2)="I $T(KILL^VAFCMIS)'=""""&('$D(VAFCNO)) D KILL^VAFCMIS(DA)"
"RTN","DG53244S",27,0)
 .S ^DD(2,.01,1,DGI,"DT")=DT
"RTN","DG53244S",28,0)
 .Q
"RTN","DG53244S",29,0)
 Q
"RTN","DG53244S",30,0)
 ;
"RTN","DG53244S",31,0)
NOP ;Build the 'NOP' cross reference
"RTN","DG53244S",32,0)
 N DGX,DGY,DFN,DG,DGCT,XPDIDTOT
"RTN","DG53244S",33,0)
 D BMES^XPDUTL("Building patient name 'NOP' cross reference...")
"RTN","DG53244S",34,0)
 D FILE^DID(2,,"ENTRIES","DG") S XPDIDTOT=DG("ENTRIES"),DGCT=0
"RTN","DG53244S",35,0)
 D UPDATE^XPDID(0)
"RTN","DG53244S",36,0)
 K ^DPT("NOP") S DGX=""
"RTN","DG53244S",37,0)
 F  S DGX=$O(^DPT("B",DGX)) Q:DGX=""  S DFN=0 D
"RTN","DG53244S",38,0)
 .F  S DFN=$O(^DPT("B",DGX,DFN)) Q:'DFN  D
"RTN","DG53244S",39,0)
 ..Q:'($D(^DPT("B",DGX,DFN))#2)
"RTN","DG53244S",40,0)
 ..S DGCT=DGCT+1
"RTN","DG53244S",41,0)
 ..I DGCT#100=0 D UPDATE^XPDID(DGCT)
"RTN","DG53244S",42,0)
 ..S DGY=$$NOP^DPTNAME(DGX) Q:'$L(DGY)
"RTN","DG53244S",43,0)
 ..S ^DPT("NOP",DGY,DFN)=""
"RTN","DG53244S",44,0)
 ..Q
"RTN","DG53244S",45,0)
 .Q
"RTN","DG53244S",46,0)
 D UPDATE^XPDID(0)
"RTN","DG53244S",47,0)
 Q
"RTN","DG53244S",48,0)
 ;
"RTN","DG53244S",49,0)
RECOMP ;Recompile input templates
"RTN","DG53244S",50,0)
 N DGFLD
"RTN","DG53244S",51,0)
 D BMES^XPDUTL("Recompiling templates...")
"RTN","DG53244S",52,0)
 F DGFLD=.01,.211,.2191,.2401,.2402,.2403,.331,.3311,.341 S DGFLD(2,DGFLD)=""
"RTN","DG53244S",53,0)
 D DIEZ^DIKCUTL3(2,.DGFLD)
"RTN","DG53244S",54,0)
 K DGFLD S DGFLD(2.01,.01)="" D DIEZ^DIKCUTL3(2.01,.DGFLD)
"RTN","DG53244S",55,0)
 K DGFLD S DGFLD(2.101,30)="" D DIEZ^DIKCUTL3(2.101,.DGFLD)
"RTN","DG53244S",56,0)
 Q
"RTN","DG53244S",57,0)
 ;
"RTN","DG53244S",58,0)
TRIG ;Update trigger definitions
"RTN","DG53244S",59,0)
 N DGFLD
"RTN","DG53244S",60,0)
 D BMES^XPDUTL("Updating trigger field definitions...")
"RTN","DG53244S",61,0)
 F DGFLD=.01,.211,.2191,.2401,.2402,.2403,.331,.3311,.341 S DGFLD(2,DGFLD)=""
"RTN","DG53244S",62,0)
 D T1(.DGFLD)
"RTN","DG53244S",63,0)
 K DGFLD S DGFLD(2.01,.01)="" D T1(.DGFLD)
"RTN","DG53244S",64,0)
 K DGFLD S DGFLD(2.101,30)="" D T1(.DGFLD)
"RTN","DG53244S",65,0)
 Q
"RTN","DG53244S",66,0)
 ;
"RTN","DG53244S",67,0)
T1(DGFLD) ;Check/update triggering field definitions
"RTN","DG53244S",68,0)
 ;Input: DGFLD=array of fields to update
"RTN","DG53244S",69,0)
 N DGOUT,DGFILE
"RTN","DG53244S",70,0)
 D TRIG^DICR(.DGFLD,.DGOUT)
"RTN","DG53244S",71,0)
 S DGFILE=0 F  S DGFILE=$O(DGOUT(DGFILE)) Q:'DGFILE  D
"RTN","DG53244S",72,0)
 .S DGFLD=0 F  S DGFLD=$O(DGOUT(DGFILE,DGFLD)) Q:'DGFLD  D
"RTN","DG53244S",73,0)
 ..D MES^XPDUTL("         Field #"_DGFLD_" of file #"_DGFILE_" updated.")
"RTN","DG53244S",74,0)
 ..Q
"RTN","DG53244S",75,0)
 .Q
"RTN","DG53244S",76,0)
 Q
"RTN","DG53244S",77,0)
 ;
"RTN","DG53244S",78,0)
IXBLD ;Build INDEX records
"RTN","DG53244S",79,0)
 N DGI,DGII,DGFDA,DGIEN,DGERR,DIERR,DGVAL,DGOUT,DGWP,DGXR
"RTN","DG53244S",80,0)
 D BMES^XPDUTL("Filing INDEX records...")
"RTN","DG53244S",81,0)
 F DGI=72,100:1:111 D:DGI'=108
"RTN","DG53244S",82,0)
 .K DGFDA,DIERR,DGIEN,DGERR
"RTN","DG53244S",83,0)
 .;Create filer array
"RTN","DG53244S",84,0)
 .D:(DGI<110) @(DGI_"^DG53244Q") D:(DGI>109) @DGI
"RTN","DG53244S",85,0)
 .D DES^DG53244R(DGI,.DGWP,DGFDA(.114,"+2,+1,",3))
"RTN","DG53244S",86,0)
 .;Check for existing record
"RTN","DG53244S",87,0)
 .S DGVAL(1)=DGFDA(.11,"+1,",.01)
"RTN","DG53244S",88,0)
 .S (DGXR,DGVAL(2))=DGFDA(.11,"+1,",.02)
"RTN","DG53244S",89,0)
 .D FIND^DIC(.11,"","@;IXIE","KP",.DGVAL,"","","","","DGOUT")
"RTN","DG53244S",90,0)
 .I $D(DGOUT("DILIST",1)) D  Q
"RTN","DG53244S",91,0)
 ..D MES^XPDUTL("     >>> Cross reference "_DGXR_" already exists, nothing filed.")
"RTN","DG53244S",92,0)
 ..Q
"RTN","DG53244S",93,0)
 .D UPDATE^DIE("","DGFDA","DGIEN","DGERR")
"RTN","DG53244S",94,0)
 .I $D(DGERR) D  Q
"RTN","DG53244S",95,0)
 ..N DGI S DGI=""
"RTN","DG53244S",96,0)
 ..D MES^XPDUTL("     >>> A problem has occurred during the filing of x-ref. ADGFM"_$P(DGFLD,".",2)_"!")
"RTN","DG53244S",97,0)
 ..D MES^XPDUTL("         Please contact Customer Support.")
"RTN","DG53244S",98,0)
 ..F  S DGI=$O(DGERR("DIERR",1,"TEXT",DGI)) Q:DGI=""  D
"RTN","DG53244S",99,0)
 ...D MES^XPDUTL(DGERR("DIERR",1,"TEXT",DGI))
"RTN","DG53244S",100,0)
 ...Q
"RTN","DG53244S",101,0)
 ..Q
"RTN","DG53244S",102,0)
 .D MES^XPDUTL("     >>> "_DGXR_" cross reference filed.")
"RTN","DG53244S",103,0)
 .;File DESCRIPTION field
"RTN","DG53244S",104,0)
 .D WP^DIE(.11,DGIEN(1)_",",.1,"","DGWP")
"RTN","DG53244S",105,0)
 Q
"RTN","DG53244S",106,0)
 ;
"RTN","DG53244S",107,0)
110 ;Set values for ANAM3311 index
"RTN","DG53244S",108,0)
 D MES^XPDUTL("Filing the 'ANAM3311' index")
"RTN","DG53244S",109,0)
 S DGFDA(.11,"+1,",.01)="2"
"RTN","DG53244S",110,0)
 S DGFDA(.11,"+1,",.02)="ANAM3311"
"RTN","DG53244S",111,0)
 S DGFDA(.11,"+1,",.11)="This index keeps the NAME COMPONENTS file in synch with field #.3311."
"RTN","DG53244S",112,0)
 S DGFDA(.11,"+1,",.2)="MU"
"RTN","DG53244S",113,0)
 S DGFDA(.11,"+1,",.4)="F"
"RTN","DG53244S",114,0)
 S DGFDA(.11,"+1,",.41)="IR"
"RTN","DG53244S",115,0)
 S DGFDA(.11,"+1,",.5)="I"
"RTN","DG53244S",116,0)
 S DGFDA(.11,"+1,",.51)="2"
"RTN","DG53244S",117,0)
 S DGFDA(.11,"+1,",.42)="A"
"RTN","DG53244S",118,0)
 S DGFDA(.11,"+1,",1.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^DPTNAME(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.3311,.DG20NAME,1.08,+$P($G(^DPT(DA,""NAME"")),U,8),""CL35"") K DG20NAME Q"
"RTN","DG53244S",119,0)
 S DGFDA(.11,"+1,",2.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.3311,1.08) Q"
"RTN","DG53244S",120,0)
 S DGFDA(.114,"+2,+1,",.01)="1"
"RTN","DG53244S",121,0)
 S DGFDA(.114,"+2,+1,",1)="F"
"RTN","DG53244S",122,0)
 S DGFDA(.114,"+2,+1,",2)="2"
"RTN","DG53244S",123,0)
 S DGFDA(.114,"+2,+1,",3)=".3311"
"RTN","DG53244S",124,0)
 S DGFDA(.114,"+2,+1,",7)="F"
"RTN","DG53244S",125,0)
 S DGFDA(.114,"+2,+1,",.5)="1"
"RTN","DG53244S",126,0)
 Q
"RTN","DG53244S",127,0)
 ;
"RTN","DG53244S",128,0)
111 ;Set values for ANAM341 index
"RTN","DG53244S",129,0)
 D MES^XPDUTL("Filing the 'ANAM341' index")
"RTN","DG53244S",130,0)
 S DGFDA(.11,"+1,",.01)="2"
"RTN","DG53244S",131,0)
 S DGFDA(.11,"+1,",.02)="ANAM341"
"RTN","DG53244S",132,0)
 S DGFDA(.11,"+1,",.11)="This index keeps the NAME COMPONENTS file in synch with field #.341."
"RTN","DG53244S",133,0)
 S DGFDA(.11,"+1,",.2)="MU"
"RTN","DG53244S",134,0)
 S DGFDA(.11,"+1,",.4)="F"
"RTN","DG53244S",135,0)
 S DGFDA(.11,"+1,",.41)="IR"
"RTN","DG53244S",136,0)
 S DGFDA(.11,"+1,",.5)="I"
"RTN","DG53244S",137,0)
 S DGFDA(.11,"+1,",.51)="2"
"RTN","DG53244S",138,0)
 S DGFDA(.11,"+1,",.42)="A"
"RTN","DG53244S",139,0)
 S DGFDA(.11,"+1,",1.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1,DG20NAME=X D NARY^DPTNAME(.DG20NAME),UPDCOMP^XLFNAME2(2,.DA,.341,.DG20NAME,1.09,+$P($G(^DPT(DA,""NAME"")),U,9),""CL35"") K DG20NAME Q"
"RTN","DG53244S",140,0)
 S DGFDA(.11,"+1,",2.1)="I '$G(XUNOTRIG) N XUNOTRIG S XUNOTRIG=1 D DELCOMP^XLFNAME2(2,.DA,.341,1.09) Q"
"RTN","DG53244S",141,0)
 S DGFDA(.114,"+2,+1,",.01)="1"
"RTN","DG53244S",142,0)
 S DGFDA(.114,"+2,+1,",1)="F"
"RTN","DG53244S",143,0)
 S DGFDA(.114,"+2,+1,",2)="2"
"RTN","DG53244S",144,0)
 S DGFDA(.114,"+2,+1,",3)=".341"
"RTN","DG53244S",145,0)
 S DGFDA(.114,"+2,+1,",7)="F"
"RTN","DG53244S",146,0)
 S DGFDA(.114,"+2,+1,",.5)="1"
"RTN","DG53244S",147,0)
 Q
"RTN","DG53244T")
0^37^B85559551
"RTN","DG53244T",1,0)
DG53244T ;BPOIFO/KEITH - NAME STANDARDIZATION ; 27 Jan 2002 11:05 PM
"RTN","DG53244T",2,0)
 ;;5.3;Registration;**244**;Aug 13, 1993
"RTN","DG53244T",3,0)
 ;
"RTN","DG53244T",4,0)
PRINT ;Print name conversion report
"RTN","DG53244T",5,0)
 ;
"RTN","DG53244T",6,0)
 N DGFLAG,DGPDT,DGOUT,DTOUT,DUOUT
"RTN","DG53244T",7,0)
 N DIR,DGEND,DGFMT,DGFLD,DGEXC,DGI,DGT0
"RTN","DG53244T",8,0)
 D TITL^DG53244V("Patient Name Standardization Report") S (DGEND,DGOUT)=0
"RTN","DG53244T",9,0)
 S DGT0=$D(^XTMP("DPTNAME",0)),DGPDT=$G(^XTMP("DPTNAME",0,0))
"RTN","DG53244T",10,0)
 I 'DGT0 D
"RTN","DG53244T",11,0)
 .W !!,"The patient name conversion report global has not been created.  A report"
"RTN","DG53244T",12,0)
 .W !,"global will be generated which can be reprinted later."
"RTN","DG53244T",13,0)
 .S DGFLAG="K",DGFLAG("K")="Kill the global and regenerate"
"RTN","DG53244T",14,0)
 .Q
"RTN","DG53244T",15,0)
 I DGT0 D
"RTN","DG53244T",16,0)
 .I DGPDT D
"RTN","DG53244T",17,0)
 ..W !!,"Name conversion processing started on ",$$FMTE^XLFDT(+DGPDT) W:'$P(DGPDT,U,2) " but has not completed."
"RTN","DG53244T",18,0)
 ..W:$P(DGPDT,U,2) " and completed ",!,$$FMTE^XLFDT($P(DGPDT,U,2)),"."
"RTN","DG53244T",19,0)
 ..S DGFLAG="U",DGFLAG("U")="Use the existing report global"
"RTN","DG53244T",20,0)
 ..Q
"RTN","DG53244T",21,0)
 .I 'DGPDT D
"RTN","DG53244T",22,0)
 ..W !!,"Name conversion processing doesn't appear to have been performed."
"RTN","DG53244T",23,0)
 ..D SUBT^DG53244V("*** Report Generation Action ***")
"RTN","DG53244T",24,0)
 ..W !!,"A name conversion report global already exists, you may use it or regenerate",!,"the information.",!
"RTN","DG53244T",25,0)
 ..K DIR
"RTN","DG53244T",26,0)
 ..S DIR(0)="S^U:Use the existing report global;K:Kill the global and regenerate"
"RTN","DG53244T",27,0)
 ..S DIR("A")="Report generation action"
"RTN","DG53244T",28,0)
 ..D ^DIR I $D(DTOUT)!$D(DUOUT) S DGOUT=1 Q
"RTN","DG53244T",29,0)
 ..S DGFLAG=Y,DGFLAG(Y)=Y(0)
"RTN","DG53244T",30,0)
 ..Q
"RTN","DG53244T",31,0)
 .Q
"RTN","DG53244T",32,0)
 G:DGOUT Q
"RTN","DG53244T",33,0)
 D SUBT^DG53244V("*** Report Output Format ***")
"RTN","DG53244T",34,0)
 K DIR
"RTN","DG53244T",35,0)
 S DIR(0)="S^S:Statistics only;D:Detailed report",DIR("A")="Report format",DIR("?")="Specify if the report should return a list of name exceptions or statistics only."
"RTN","DG53244T",36,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) G Q
"RTN","DG53244T",37,0)
 S DGFMT=Y,DGFMT(DGFMT)=Y(0) G:DGFMT="S" QUEUE
"RTN","DG53244T",38,0)
 D SUBT^DG53244V("*** Conversion Fields to Include ***")
"RTN","DG53244T",39,0)
 W !!,"The name conversion ",$S(DGPDT:"has changed",1:"will change")," data in eleven different PATIENT file fields.",!,"Please specify which of these fields to return on the report."
"RTN","DG53244T",40,0)
FLDS ;Get fields to report
"RTN","DG53244T",41,0)
 K DIR
"RTN","DG53244T",42,0)
 S DIR(0)="SO^A:All fields;.01:Patient name;.211:K Name;.2191:K2 Name;.2401:Father's name;.2402:Mother's name;.2403:Mother's maiden name;.331:E Name;.3311:E2 Name;.341:D Name;2.01:Alias;2.101:Attorney's Name"
"RTN","DG53244T",43,0)
 S DIR("A")="Select field to include",DGFLD="",DIR("B")="All fields"
"RTN","DG53244T",44,0)
 F  D  Q:DGOUT!DGEND
"RTN","DG53244T",45,0)
 .D ^DIR I $D(DTOUT)!$D(DUOUT) S DGOUT=1 Q
"RTN","DG53244T",46,0)
 .I X="" S DGEND=1 Q
"RTN","DG53244T",47,0)
 .S DIR("A")="Select another field to include" K DIR("B")
"RTN","DG53244T",48,0)
 .I Y="A" K DGFLD S DGFLD="A",DGFLD(Y)=Y(0),DGEND=1 Q
"RTN","DG53244T",49,0)
 .S DGFLD(Y)=Y(0) N DGX
"RTN","DG53244T",50,0)
 .S DGX=";"_Y_":"_Y(0),DIR(0)=$P(DIR(0),DGX)_$P(DIR(0),DGX,2)
"RTN","DG53244T",51,0)
 .Q
"RTN","DG53244T",52,0)
 G:DGOUT Q
"RTN","DG53244T",53,0)
 I $D(DGFLD)<10 W !!,$C(7),"At least one selection is required!",! G FLDS
"RTN","DG53244T",54,0)
 D SUBT^DG53244V("*** Name Exceptions to Include ***")
"RTN","DG53244T",55,0)
 W !!,"This report groups name exceptions by the categories listed below.  Of these"
"RTN","DG53244T",56,0)
 W !,"types, the first three are considered important to review.  Names with no comma"
"RTN","DG53244T",57,0)
 W !,"may not be parsed correctly by Kernel name standardization utilities.  Names"
"RTN","DG53244T",58,0)
 W !,"with parenthetical text, e.g. ""(INELIGIBLE)"" may require clean up prior to"
"RTN","DG53244T",59,0)
 W !,"conversion.  Names that cannot be converted should be corrected or deleted."
"RTN","DG53244T",60,0)
 W !!,"The fourth category will apply to the majority of name changes.  These are"
"RTN","DG53244T",61,0)
 W !,"instances where characters such as periods, have been removed or changed"
"RTN","DG53244T",62,0)
 W !," and probably do not require review.  You may review all four categories but"
"RTN","DG53244T",63,0)
 W !,"limiting the report to the first three will produce a more relevant and"
"RTN","DG53244T",64,0)
 W !,"manageable list."
"RTN","DG53244T",65,0)
 K DIR
"RTN","DG53244T",66,0)
 S DIR(0)="SO^1:Name value contains no comma;2:Parenthetical text is removed from name;3:Name value cannot be converted;4:Characters are removed or changed"
"RTN","DG53244T",67,0)
 S DIR("A")="Select an exception to include",DGEND=0
"RTN","DG53244T",68,0)
EXC F  D  Q:DGOUT!DGEND
"RTN","DG53244T",69,0)
 .D ^DIR I $D(DTOUT)!$D(DUOUT) S DGOUT=1 Q
"RTN","DG53244T",70,0)
 .I X="" S DGEND=1 Q
"RTN","DG53244T",71,0)
 .S DGEXC(Y)=Y(0)
"RTN","DG53244T",72,0)
 .I $D(DGEXC(1)),$D(DGEXC(2)),$D(DGEXC(3)),$D(DGEXC(4)) D  Q
"RTN","DG53244T",73,0)
 ..S DGEND=1,DGEXC="ALL" Q
"RTN","DG53244T",74,0)
 .S DIR("A")="Select another exception to include" N DGX
"RTN","DG53244T",75,0)
 .S DGX=Y_":"_Y(0),DIR(0)=$P(DIR(0),DGX)_$P(DIR(0),DGX,2)
"RTN","DG53244T",76,0)
 .I DIR(0)[";;" S DIR(0)=$P(DIR(0),";;")_";"_$P(DIR(0),";;",2)
"RTN","DG53244T",77,0)
 .Q
"RTN","DG53244T",78,0)
 G:DGOUT Q
"RTN","DG53244T",79,0)
 I $D(DGEXC)<10 W !!,$C(7),"At least one selection is required!",! G EXC
"RTN","DG53244T",80,0)
 ;
"RTN","DG53244T",81,0)
 D SUBT^DG53244V("*** Selected Report Parameters ***")
"RTN","DG53244T",82,0)
 D PARAM^DG53244V
"RTN","DG53244T",83,0)
 K DIR S DIR(0)="Y",DIR("A")="Ok",DIR("B")="YES",DIR("?")="Indicate if the selected parameters are correct."
"RTN","DG53244T",84,0)
 D ^DIR G:'Y!$D(DTOUT)!$D(DUOUT) Q
"RTN","DG53244T",85,0)
QUEUE W !!,$C(7),"This report requires 132 column output!"
"RTN","DG53244T",86,0)
 F DGI="DGFLAG","DGFLAG(","DGFMT","DGFMT(","DGFLD","DGFLD(","DGEXC","DGEXC(" S ZTSAVE(DGI)=""
"RTN","DG53244T",87,0)
 D EN^XUTMDEVQ("PRT^DG53244V","Print Patient Name Standardization Report",.ZTSAVE)
"RTN","DG53244T",88,0)
Q D END^DG53244V Q
"RTN","DG53244T",89,0)
 ;
"RTN","DG53244T",90,0)
CONVERT ;Convert patient name fields
"RTN","DG53244T",91,0)
 N DGOUT,DGEND,DGPDT,DGRUN,DGT0,DGI,DIR,DTOUT,DUOUT,DGLIM,DGFLAG
"RTN","DG53244T",92,0)
 S DGOUT=0,DGFLAG="P",DGFLAG(DGFLAG)="Process patient name conversion"
"RTN","DG53244T",93,0)
 D TITL^DG53244V("*** Patient Name Field Conversion ***")
"RTN","DG53244T",94,0)
 S DGPDT=$G(^XTMP("DPTNAME",0,0)),DGT0=$G(^XTMP("DPTNAME",0))
"RTN","DG53244T",95,0)
 S DGRUN=($P(DGT0,U,5)="RUN")
"RTN","DG53244T",96,0)
 I DGPDT D
"RTN","DG53244T",97,0)
 .W !!,"Name conversion processing started on ",$$FMTE^XLFDT(+DGPDT) W:'$P(DGPDT,U,2) " but has not completed."
"RTN","DG53244T",98,0)
 .W:$P(DGPDT,U,2) " and completed ",!,$$FMTE^XLFDT($P(DGPDT,U,2)),"."
"RTN","DG53244T",99,0)
 .Q
"RTN","DG53244T",100,0)
 I $P(DGPDT,U,2) D  G Q
"RTN","DG53244T",101,0)
 .W !!,$C(7),"It appears that the conversion of patient name fields has completed.  No"
"RTN","DG53244T",102,0)
 .W !,"further action should be necessary.  To review the results of the conversion,"
"RTN","DG53244T",103,0)
 .W !,"a report may be printed with the PRINT^DG53244T entry point."
"RTN","DG53244T",104,0)
 .S DIR(0)="E",DIR("A")="Enter RETURN to exit"
"RTN","DG53244T",105,0)
 .W !! D ^DIR
"RTN","DG53244T",106,0)
 .Q
"RTN","DG53244T",107,0)
 I DGRUN D  G Q:DGOUT
"RTN","DG53244T",108,0)
 .W !!,"It appears that the conversion of patient name fields is running currently."
"RTN","DG53244T",109,0)
 .F DGI=1:1:10 Q:DGOUT  D
"RTN","DG53244T",110,0)
 ..I $P(^XTMP("DPTNAME",0),U,4)'=$P(DGT0,U,4) S DGOUT=1 Q
"RTN","DG53244T",111,0)
 ..H 1 W "." Q
"RTN","DG53244T",112,0)
 .I DGOUT D  Q
"RTN","DG53244T",113,0)
 ..W !!,"An additional processing task should not be started at this time.",!
"RTN","DG53244T",114,0)
 ..S DIR(0)="E",DIR("A")="Enter RETURN to exit"
"RTN","DG53244T",115,0)
 ..W !! D ^DIR
"RTN","DG53244T",116,0)
 ..Q
"RTN","DG53244T",117,0)
 .S $P(^XTMP("DPTNAME",0),U,5)="STOP"
"RTN","DG53244T",118,0)
 .W "that process has been flagged to stop."
"RTN","DG53244T",119,0)
 I 'DGPDT D
"RTN","DG53244T",120,0)
 .W !!,"Name conversion processing doesn't appear to have been performed."
"RTN","DG53244T",121,0)
 .Q
"RTN","DG53244T",122,0)
LIM D SUBT^DG53244V("*** Processing Limitation ***")
"RTN","DG53244T",123,0)
 S DGI="Processing will "_$S(DGPDT:"continue",1:"begin")_" with PATIENT file entry "_$S(DGPDT:$P(DGT0,U,4)+1,1:$O(^DPT(0)))_"."
"RTN","DG53244T",124,0)
 W !!?(80-$L(DGI)\2),DGI
"RTN","DG53244T",125,0)
 W !!,"The conversion can be tasked to run to completion or stop after a specified"
"RTN","DG53244T",126,0)
 W !,"record entry or date/time.  If stopped prior to completion it will need to be"
"RTN","DG53244T",127,0)
 W !,"re-tasked to run to completion at another time."
"RTN","DG53244T",128,0)
 S DIR(0)="S^R:Run to completion;SR:Stop after specified record;SD:Stop after date/time"
"RTN","DG53244T",129,0)
 S DIR("A")="Specify processing limitation"
"RTN","DG53244T",130,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) G Q
"RTN","DG53244T",131,0)
 S DGLIM=Y
"RTN","DG53244T",132,0)
SR I DGLIM="SR" D  G:DGOUT Q
"RTN","DG53244T",133,0)
 .D SUBT^DG53244V("*** Specify Ending Record ***")
"RTN","DG53244T",134,0)
 .W !!,"Name conversion processing will discontinue after the record number specified."
"RTN","DG53244T",135,0)
 .S DIR(0)="N^"_$S(DGPDT:(+$P(DGT0,U,4)+1),1:$O(^DPT(0)))_":"_$O(^DPT(999999999),-1)
"RTN","DG53244T",136,0)
 .S DIR("A")="Record number to end processing"
"RTN","DG53244T",137,0)
 .W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S DGOUT=1 Q
"RTN","DG53244T",138,0)
 .S DGLIM(DGLIM)=Y
"RTN","DG53244T",139,0)
 .Q
"RTN","DG53244T",140,0)
SD I DGLIM="SD" D  G:DGOUT Q
"RTN","DG53244T",141,0)
 .D SUBT^DG53244V("*** Specify Ending Date/Time ***")
"RTN","DG53244T",142,0)
 .W !!,"The value specified must include both date and time.  It must be at least one"
"RTN","DG53244T",143,0)
 .W !,"hour in the future but not more than seven days in the future."
"RTN","DG53244T",144,0)
 .S DIR(0)=$$FMADD^XLFDT($P($$NOW^XLFDT(),":",1,2),,1)_":"_$$FMADD^XLFDT($P($$NOW^XLFDT(),":",1,2),7,1)_":ET"
"RTN","DG53244T",145,0)
 .S DGI="("_$$FMTE^XLFDT($P(DIR(0),":"))_" / "_$$FMTE^XLFDT($P(DIR(0),":",2))_")"
"RTN","DG53244T",146,0)
 .W !!?(80-$L(DGI)\2),DGI
"RTN","DG53244T",147,0)
 .S DIR("A")="Date/time to end processing: "
"RTN","DG53244T",148,0)
 .S DIR(0)="DA^"_DIR(0)
"RTN","DG53244T",149,0)
 .W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S DGOUT=1 Q
"RTN","DG53244T",150,0)
 .S DGLIM(DGLIM)=Y
"RTN","DG53244T",151,0)
 .Q
"RTN","DG53244T",152,0)
 ;
"RTN","DG53244T",153,0)
PQUE ;Queue patient name conversion
"RTN","DG53244T",154,0)
 D SUBT^DG53244V("*** Queue Name Conversion Processing ***")
"RTN","DG53244T",155,0)
 N %DT,DGI,Y,ZTSK,ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSAVE
"RTN","DG53244T",156,0)
 S Y=DT_.22 X ^DD("DD") S %DT("B")=Y,%DT("A")="Queue to run: "
"RTN","DG53244T",157,0)
PQ S %DT="AEFXR" W ! D ^%DT
"RTN","DG53244T",158,0)
 I DGLIM="SD",Y>DGLIM(DGLIM) D  G PQ
"RTN","DG53244T",159,0)
 .W !,$C(7),"Task start time must be earlier than processing end time!"
"RTN","DG53244T",160,0)
 .Q
"RTN","DG53244T",161,0)
 I Y<1 G QQ
"RTN","DG53244T",162,0)
 S ZTDTH=Y,ZTRTN="RUN^DG53244U(.DGFLAG)",ZTIO=""
"RTN","DG53244T",163,0)
 F DGI="DGFLAG","DGFLAG(","DGLIM","DGLIM(" S ZTSAVE(DGI)=""
"RTN","DG53244T",164,0)
 S ZTDESC="Process patient name conversion"
"RTN","DG53244T",165,0)
 F DGI=1:1:20 D ^%ZTLOAD Q:$G(ZTSK)
"RTN","DG53244T",166,0)
QQ W:'$G(ZTSK) !!,"Extract not queued!!!",!
"RTN","DG53244T",167,0)
 W:$G(ZTSK) !!,"Task number: ",ZTSK,!
"RTN","DG53244T",168,0)
 S DIR(0)="E",DIR("A")="Enter RETURN to exit" K DIR("B")
"RTN","DG53244T",169,0)
 W !! D ^DIR
"RTN","DG53244T",170,0)
 G Q
"RTN","DG53244T",171,0)
 ;
"RTN","DG53244T",172,0)
STOP ;Request patient name conversion to stop
"RTN","DG53244T",173,0)
 N DIR,DTOUT,DUOUT,X,Y,DGRUN,DGOUT S DGOUT=0
"RTN","DG53244T",174,0)
 D TITL^DG53244V("*** Stop Patient Name Conversion Process ***")
"RTN","DG53244T",175,0)
 S DGRUN=($P($G(^XTMP("DPTNAME",0)),U,5)="RUN")
"RTN","DG53244T",176,0)
 I 'DGRUN D
"RTN","DG53244T",177,0)
 .W !!,"The patient name conversion process doesn't appear to be running currently."
"RTN","DG53244T",178,0)
 .Q
"RTN","DG53244T",179,0)
 I DGRUN D
"RTN","DG53244T",180,0)
 .S DIR(0)="Y",DIR("B")="NO"
"RTN","DG53244T",181,0)
 .S DIR("A")="Are you sure you wish to stop the patient name conversion process"
"RTN","DG53244T",182,0)
 .D ^DIR I $D(DTOUT)!$D(DUOUT) S DGOUT=1 Q
"RTN","DG53244T",183,0)
 .Q:'Y
"RTN","DG53244T",184,0)
 .S $P(^XTMP("DPTNAME",0),U,5)="STOP"
"RTN","DG53244T",185,0)
 .W !!,"The process has been flagged to stop."
"RTN","DG53244T",186,0)
 .Q
"RTN","DG53244T",187,0)
 G:DGOUT Q
"RTN","DG53244T",188,0)
 S DIR(0)="E",DIR("A")="Enter RETURN to exit" K DIR("B")
"RTN","DG53244T",189,0)
 W !! D ^DIR
"RTN","DG53244T",190,0)
 G Q
"RTN","DG53244T",191,0)
 ;
"RTN","DG53244T",192,0)
MGOUT(DGNCMG) ;Remove name change mail group
"RTN","DG53244T",193,0)
 ;Input: DGNCMG=variable to store existing group (pass by reference)
"RTN","DG53244T",194,0)
 ;
"RTN","DG53244T",195,0)
 N DGFDA,DGMSG
"RTN","DG53244T",196,0)
 S DGNCMG=$P($G(^DG(43,1,"NOT")),U,3)
"RTN","DG53244T",197,0)
 S:DGNCMG $P(^XTMP(DGNMSP,0),U,6)=DGNCMG
"RTN","DG53244T",198,0)
 S DGFDA(43,"1,",502)="@"
"RTN","DG53244T",199,0)
 D FILE^DIE("E","DGFDA","DGMSG")
"RTN","DG53244T",200,0)
 Q
"RTN","DG53244T",201,0)
 ;
"RTN","DG53244T",202,0)
MGIN(DGNCMG) ;Replace name change mail group
"RTN","DG53244T",203,0)
 ;Input: DGNCMG=mail group pointer
"RTN","DG53244T",204,0)
 ;
"RTN","DG53244T",205,0)
 I '$G(DGNCMG) S DGNCMG=$P(^XTMP(DGNMSP,0),U,6) Q:'DGNCMG
"RTN","DG53244T",206,0)
 N DGFDA,DGMSG
"RTN","DG53244T",207,0)
 S DGFDA(43,"1,",502)=DGNCMG
"RTN","DG53244T",208,0)
 D FILE^DIE("","DGFDA","DGMSG")
"RTN","DG53244T",209,0)
 Q
"RTN","DG53244U")
0^38^B59850186
"RTN","DG53244U",1,0)
DG53244U ;ALB/JDS,BPOIFO/KEITH - Patient Name Standardization ; 27 Jan 2002 11:55 PM
"RTN","DG53244U",2,0)
 ;;5.3;Registration;**244**;Aug 13, 1993
"RTN","DG53244U",3,0)
 ;Adapted from XLFNAME3 MKO
"RTN","DG53244U",4,0)
RUN(DGFLAG) ;Convert PATIENT file names;
"RTN","DG53244U",5,0)
 ;In: DGFLAG [ "U"  : Quit, use existing global
"RTN","DG53244U",6,0)
 ;           [ "K"  : Kill ^XTMP. generate global 
"RTN","DG53244U",7,0)
 ;           [ "P"  : Kill ^XTMP, update names, generate global
"RTN","DG53244U",8,0)
 ;
"RTN","DG53244U",9,0)
 ;Use existing global to print
"RTN","DG53244U",10,0)
 Q:DGFLAG="U"
"RTN","DG53244U",11,0)
 ;
"RTN","DG53244U",12,0)
 N DGIENS,DGNAM,DGNMSP,DGPVAL,DPTINV,DGQ,DGTOTAL,DGOUT,DGNCMG,DGNOFDEL
"RTN","DG53244U",13,0)
 N DGA,DGI,DPTFIL,DPTFLD,DPTIENS,DGFIELD,DGTYPE,DPTA,DPTI,VAFHCA08,DGZ
"RTN","DG53244U",14,0)
 N DPTVALUE,DGTEXT,VAFCA08,VAFCNO,DGENUPLD,DPTFN,DGPRUN,DGXRARY,DGMPI
"RTN","DG53244U",15,0)
 N DGICN
"RTN","DG53244U",16,0)
 ;Initialize variables
"RTN","DG53244U",17,0)
 S DGNMSP="DPTNAME",DGQ="""",DGOUT=0
"RTN","DG53244U",18,0)
 F DGI=1:1 S DGA=$T(FIELD+DGI) Q:(DGA'[";;")  D
"RTN","DG53244U",19,0)
 .S DGFIELD(DGI,$P($P(DGA,";;",2),U,3))=$P(DGA,";;",2) Q
"RTN","DG53244U",20,0)
 D XRARY^DG53244V
"RTN","DG53244U",21,0)
 ;Set up ^XTMP
"RTN","DG53244U",22,0)
 I '$G(^XTMP(DGNMSP,0,0)) D
"RTN","DG53244U",23,0)
 .K ^XTMP(DGNMSP)
"RTN","DG53244U",24,0)
 .S ^XTMP(DGNMSP,0)=$$FMADD^XLFDT(DT,90)_"^"_DT
"RTN","DG53244U",25,0)
 .I DGFLAG="P" D
"RTN","DG53244U",26,0)
 ..S ^XTMP(DGNMSP,0,0)=$$NOW^XLFDT(),$P(^XTMP(DGNMSP,0),U,4)=0
"RTN","DG53244U",27,0)
 ..S $P(^XTMP(DGNMSP,0),U,3)="Perform Name Conversion"
"RTN","DG53244U",28,0)
 ..Q
"RTN","DG53244U",29,0)
 .I DGFLAG="K" S $P(^XTMP(DGNMSP,0),U,3)="Generate Report Data"
"RTN","DG53244U",30,0)
 .I '$D(^XTMP(DGNMSP,"STATS")) D
"RTN","DG53244U",31,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.01),U,7)="Patient name"
"RTN","DG53244U",32,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.211),U,7)="Primary NOK name"
"RTN","DG53244U",33,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.2191),U,7)="Secondary NOK name"
"RTN","DG53244U",34,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.2401),U,7)="Father's name"
"RTN","DG53244U",35,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.2402),U,7)="Mother's name"
"RTN","DG53244U",36,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.2403),U,7)="Mother's maiden name"
"RTN","DG53244U",37,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.331),U,7)="Prim. E-contact name"
"RTN","DG53244U",38,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.3311),U,7)="2nd E-contact name"
"RTN","DG53244U",39,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2,.341),U,7)="Designee name"
"RTN","DG53244U",40,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2.01,.01),U,7)="Alias name"
"RTN","DG53244U",41,0)
 ..S $P(^XTMP(DGNMSP,"STATS",2.101,30),U,7)="Attorney's name"
"RTN","DG53244U",42,0)
 I DGFLAG="P" D
"RTN","DG53244U",43,0)
 .S $P(^XTMP(DGNMSP,0),U)=$$FMADD^XLFDT(DT,90)
"RTN","DG53244U",44,0)
 .S $P(^XTMP(DGNMSP,0),U,5)="RUN"
"RTN","DG53244U",45,0)
 .S DGPRUN=$O(^XTMP(DGNMSP,0,""),-1)+1
"RTN","DG53244U",46,0)
 .S ^XTMP(DGNMSP,0,DGPRUN)=$$NOW^XLFDT()_"^^"_+$P($G(^XTMP(DGNMSP,"STATS")),U)
"RTN","DG53244U",47,0)
 .D MGOUT^DG53244T(.DGNCMG)  ;Remove name change mail group
"RTN","DG53244U",48,0)
 .Q
"RTN","DG53244U",49,0)
 ;
"RTN","DG53244U",50,0)
 ;Prevent messages to HEC
"RTN","DG53244U",51,0)
 S DGENUPLD="ENROLLMENT/ELIGIBILITY UPLOAD IN PROGRESS"
"RTN","DG53244U",52,0)
 S VAFCNO=1  ;Prevent MPI messages
"RTN","DG53244U",53,0)
 S (VAFCA08,VAFHCA08)=1  ;Prevent PIMS Generic Messaging
"RTN","DG53244U",54,0)
 S DGNOFDEL=1  ;Prevent deletion of contact address fields
"RTN","DG53244U",55,0)
 ;
"RTN","DG53244U",56,0)
LOOP ;Loop through Patient file
"RTN","DG53244U",57,0)
 S DGIEN=+$P(^XTMP(DGNMSP,0),U,4)
"RTN","DG53244U",58,0)
 F  S DGIEN=$O(^DPT(DGIEN)) Q:'DGIEN!$$LAST()  D
"RTN","DG53244U",59,0)
 .;Skip merging patients
"RTN","DG53244U",60,0)
 .Q:$P($G(^DPT(DGIEN,0)),U)["MERGING INTO"
"RTN","DG53244U",61,0)
 .;Skip patients that have been merged to another record
"RTN","DG53244U",62,0)
 .Q:$D(^DPT(DGIEN,-9))
"RTN","DG53244U",63,0)
 .;Evaluate field values
"RTN","DG53244U",64,0)
 .S DGIENS=DGIEN_",",DGMPI=0
"RTN","DG53244U",65,0)
 .S DGZ=0 F  S DGZ=$O(DGFIELD(DGZ)) Q:'DGZ  D
"RTN","DG53244U",66,0)
 ..S DPTA=""  F  S DPTA=$O(DGFIELD(DGZ,DPTA)) Q:DPTA=""  D
"RTN","DG53244U",67,0)
 ...Q:'$D(^DPT(DGIEN,$P(DPTA,";")))
"RTN","DG53244U",68,0)
 ...S DGTYPE=DGFIELD(DGZ,DPTA),DPTFLD=$P(DGTYPE,U,2)
"RTN","DG53244U",69,0)
 ...S DPTMAX=$P(DGTYPE,U,5) S:'DPTMAX DPTMAX=35
"RTN","DG53244U",70,0)
 ...I $L(DPTA,";")=3 D  Q
"RTN","DG53244U",71,0)
 ....F DPTI=0:0 S DPTI=$O(^DPT(DGIEN,$P(DPTA,";"),DPTI)) Q:'DPTI  D
"RTN","DG53244U",72,0)
 .....S DPTIENS=DGIEN_","_DPTI_",",DPTFIL=$P(DGTYPE,U,6)
"RTN","DG53244U",73,0)
 .....S DPTVALUE=$P($G(^DPT(DGIEN,$P(DPTA,";"),DPTI,$P(DPTA,";",2))),U,$P(DPTA,";",3))
"RTN","DG53244U",74,0)
 .....Q:'$L(DPTVALUE)
"RTN","DG53244U",75,0)
 .....D UPDATE(DGFLAG,DPTFIL,DPTIENS,DPTFLD,DPTVALUE,DGNMSP,DPTMAX,DPTA)
"RTN","DG53244U",76,0)
 ...S DPTIENS=DGIEN_",",DPTFIL=2
"RTN","DG53244U",77,0)
 ...S DPTVALUE=$P($G(^DPT(DGIEN,$P(DPTA,";"))),U,$P(DPTA,";",2))
"RTN","DG53244U",78,0)
 ...Q:'$L(DPTVALUE)
"RTN","DG53244U",79,0)
 ...D UPDATE(DGFLAG,DPTFIL,DPTIENS,DPTFLD,DPTVALUE,DGNMSP,DPTMAX,DPTA,.DGMPI)
"RTN","DG53244U",80,0)
 ..S $P(^XTMP(DGNMSP,0),U,4)=DGIEN
"RTN","DG53244U",81,0)
 .I DGMPI D  ;Send MPI message
"RTN","DG53244U",82,0)
 ..D RMPI(1) S DGICN=$$GETICN^MPIF001(DGIEN)
"RTN","DG53244U",83,0)
 ..;No ICN, don't send message
"RTN","DG53244U",84,0)
 ..I +DGICN=-1 S DGICN=0 D RMPI(2)
"RTN","DG53244U",85,0)
 ..;Local ICN, don't send message
"RTN","DG53244U",86,0)
 ..I $P($$SITE^VASITE(),"^",3)=$E(DGICN,1,3) S DGICN=0 D RMPI(3)
"RTN","DG53244U",87,0)
 ..I DGICN'=0 N X S X="MPIFA31B" X ^%ZOSF("TEST") D RMPI(4) I $T S DGMPI=$$A31^MPIFA31B(DGIEN) D RMPI(5,DGMPI)
"RTN","DG53244U",88,0)
 ..;Log exception to MPI if problem generating ICN
"RTN","DG53244U",89,0)
 ..I +DGMPI=-1 D RMPI(6),START^RGHLLOG(),EXC^RGHLLOG(220,"Problem generating A31 "_$P(DGMPI,"^",2),DGIEN),STOP^RGHLLOG()
"RTN","DG53244U",90,0)
 ;Send notification message
"RTN","DG53244U",91,0)
 Q:DGFLAG'="P"
"RTN","DG53244U",92,0)
 D MGIN^DG53244T(DGNCMG)  ;Replace name change mail group
"RTN","DG53244U",93,0)
 I 'DGIEN,'DGOUT S $P(^XTMP(DGNMSP,0,0),U,2)=$$NOW^XLFDT()
"RTN","DG53244U",94,0)
 S $P(^XTMP(DGNMSP,0,DGPRUN),U,2)=$$NOW^XLFDT()
"RTN","DG53244U",95,0)
 S $P(^XTMP(DGNMSP,0,DGPRUN),U,4)=+$P(^XTMP(DGNMSP,"STATS"),U)
"RTN","DG53244U",96,0)
 S $P(^XTMP(DGNMSP,0),U,5)="STOP"
"RTN","DG53244U",97,0)
MSG K DGTEXT
"RTN","DG53244U",98,0)
 N XMY,XMTEXT,XMDUN,XMDUZ,XMSUB,XMZ,DGLINE
"RTN","DG53244U",99,0)
 S DGLINE="",$P(DGLINE,"-",80)=""
"RTN","DG53244U",100,0)
 S XMSUB="Patient Name Conversion Process"
"RTN","DG53244U",101,0)
 S XMY("G.PMSTRACK@FORUM.VA.GOV")=""
"RTN","DG53244U",102,0)
 S XMY(+$G(DUZ))="",(XMDUN,XMDUZ)="Patch DG*5.3*244"
"RTN","DG53244U",103,0)
 S DGTEXT(1,0)="The Patient Name Standardization conversion has completed" S DGTEXT=1
"RTN","DG53244U",104,0)
 I DGOUT D
"RTN","DG53244U",105,0)
 .S DGTEXT(1,0)="The Patient Name Standardization was Stopped"
"RTN","DG53244U",106,0)
 .S DGTEXT(2,0)="Please remember to complete the patient name conversion in the future."
"RTN","DG53244U",107,0)
 .S DGTEXT=2
"RTN","DG53244U",108,0)
 S DGOUT=0 D STATS^DG53244V(.DGTEXT)
"RTN","DG53244U",109,0)
 S XMTEXT="DGTEXT("
"RTN","DG53244U",110,0)
 D ^XMD
"RTN","DG53244U",111,0)
 Q
"RTN","DG53244U",112,0)
 ;
"RTN","DG53244U",113,0)
UPDATE(DGFLAG,DGFIL,DGIENS,DGFLD,DGNAM,DGNMSP,DPTMAX,DPTA,DGMPI) ;Process name field
"RTN","DG53244U",114,0)
 ;
"RTN","DG53244U",115,0)
 N DGAUD,DGFDA,DGMSG,DIERR,DGOLD
"RTN","DG53244U",116,0)
 ;Total names evaluated
"RTN","DG53244U",117,0)
 S $P(^XTMP(DGNMSP,"STATS"),U)=$P($G(^XTMP(DGNMSP,"STATS")),U)+1
"RTN","DG53244U",118,0)
 ;Total evaluated by field
"RTN","DG53244U",119,0)
 S $P(^XTMP(DGNMSP,"STATS",DGFIL,DGFLD),U)=$P($G(^XTMP(DGNMSP,"STATS",DGFIL,DGFLD)),U)+1
"RTN","DG53244U",120,0)
 ;Format name
"RTN","DG53244U",121,0)
 S DGOLD=$G(DGNAM)
"RTN","DG53244U",122,0)
 S DGNAM=$$FORMAT^DPTNAME(.DGNAM,3,DPTMAX,,2,.DGAUD,$S(DGFLD=.2403:1,1:0))
"RTN","DG53244U",123,0)
 D:(DGAUD'=0) RECORD(DGFIL,DGFLD,DGIENS,DGNAM,.DGAUD,DGNMSP,DGIEN,DGOLD)
"RTN","DG53244U",124,0)
 Q:DGFLAG'="P"  ;Processing only
"RTN","DG53244U",125,0)
 Q:DGAUD=2  ;Unconvertible
"RTN","DG53244U",126,0)
 ;Update components if name is not changed
"RTN","DG53244U",127,0)
 I DGAUD=0 D  Q
"RTN","DG53244U",128,0)
 .N DGI,DA,X,DG20NAME,XUNOTRIG
"RTN","DG53244U",129,0)
 .F DGI=2.1,1.1 D
"RTN","DG53244U",130,0)
 ..S:(DGFIL=2) DA=DGIEN S:(DGFIL'=2) DA(1)=DGIEN,DA=$P(DGIENS,",",2)
"RTN","DG53244U",131,0)
 ..S X=DGNAM X DGXRARY($P(DGFIELD(DGZ,DPTA),U,7),DGI)
"RTN","DG53244U",132,0)
 ..Q
"RTN","DG53244U",133,0)
 .Q
"RTN","DG53244U",134,0)
 ;Update source name if different
"RTN","DG53244U",135,0)
 S DPTINV=$TR($$INV(DGIENS),":",",")_","
"RTN","DG53244U",136,0)
 S DGFDA(DGFIL,DPTINV,DGFLD)=DGNAM
"RTN","DG53244U",137,0)
 D FILE^DIE("","DGFDA","DGMSG") K DIERR,DGMSG
"RTN","DG53244U",138,0)
 ;Changes of interest to MPI
"RTN","DG53244U",139,0)
 I DGAUD=1,DGFIL=2 D
"RTN","DG53244U",140,0)
 .I DGFLD=.01 S DGMPI=1
"RTN","DG53244U",141,0)
 .I DGFLD=.2403,DGOLD_","'=DGNAM S DGMPI=1
"RTN","DG53244U",142,0)
 Q
"RTN","DG53244U",143,0)
 ;
"RTN","DG53244U",144,0)
LAST() ;Check stop point
"RTN","DG53244U",145,0)
 I $P(^XTMP(DGNMSP,0),U,5)="STOP" S DGOUT=1 Q DGOUT
"RTN","DG53244U",146,0)
 I $G(DGLIM)="SR",DGIEN>DGLIM(DGLIM) S DGOUT=1 Q DGOUT
"RTN","DG53244U",147,0)
 I DGIEN#100=0 D
"RTN","DG53244U",148,0)
 .I $G(DGLIM)="SD",$$NOW^XLFDT()>DGLIM(DGLIM) S DGOUT=1 Q
"RTN","DG53244U",149,0)
 .D STOP^DG53244V
"RTN","DG53244U",150,0)
 Q DGOUT
"RTN","DG53244U",151,0)
 ;
"RTN","DG53244U",152,0)
RECORD(DGFIL,DGFLD,DGREC,DGNAM,DGAUD,DGNMSP,DGIEN,DGOLD) ;file changes in ^XTMP
"RTN","DG53244U",153,0)
 ;^XTMP global format:
"RTN","DG53244U",154,0)
 ;^XTMP("DPTNAME",0)=purge_date^date_created^process^last_ien^
"RTN","DG53244U",155,0)
 ;                   stop_flag^name_change_mail_group
"RTN","DG53244U",156,0)
 ;^XTMP("DPTNAME",0,0)=conversion_start^conversion_end
"RTN","DG53244U",157,0)
 ;^XTMP("DPTNAME",0,n)=conversion_start^conversion_end^
"RTN","DG53244U",158,0)
 ;                     pts_evaluated_start^pts_evaluated_end
"RTN","DG53244U",159,0)
 ;^XTMP("DPTNAME",DFN,FILE,IFN,FIELD)=old_value^new_value^change_types
"RTN","DG53244U",160,0)
 ;^XTMP("DPTNAME",DFN,"MPI")=1^1^1^1^1^1 (status of MPI messaging)
"RTN","DG53244U",161,0)
 ;^XTMP("DPTNAME",DFN,"MPI","A31")=the result of call to $$A31^MPIFA31B
"RTN","DG53244U",162,0)
 ;^XTMP("DPTNAME","STATS")=names_evaluated^pts_w/changes^total_changes^
"RTN","DG53244U",163,0)
 ;                         type1_changes^type2_changes^type3_changes^
"RTN","DG53244U",164,0)
 ;                         type4_changes
"RTN","DG53244U",165,0)
 ;^XTMP("DPTNAME","STATS",FILE,FIELD)=total_evaluated^total_changed^
"RTN","DG53244U",166,0)
 ;                               type1_changes^type2_changes^
"RTN","DG53244U",167,0)
 ;                               type3_changes^type4_changes
"RTN","DG53244U",168,0)
 ;^XTMP("DPTNAME","B",NAME)=dfn
"RTN","DG53244U",169,0)
 ;
"RTN","DG53244U",170,0)
 ;Data change types: 1=name contains no comma
"RTN","DG53244U",171,0)
 ;                   2=parenthetical text is removed
"RTN","DG53244U",172,0)
 ;                   3=value could not be converted
"RTN","DG53244U",173,0)
 ;                   4=characters are removed or changed
"RTN","DG53244U",174,0)
 ;
"RTN","DG53244U",175,0)
 N DGIENS,DGIEN2,DGTSTR,DGI,DGN S DGTSTR=""
"RTN","DG53244U",176,0)
 S DGIEN2=$S($P(DGREC,",",2):$P(DGREC,",",2),1:DGIEN)
"RTN","DG53244U",177,0)
 ;Record values
"RTN","DG53244U",178,0)
 F DGI=1:1:4 I $D(DGAUD(DGI)) D
"RTN","DG53244U",179,0)
 .S DGTSTR=DGTSTR_DGI
"RTN","DG53244U",180,0)
 .;Field changes by type
"RTN","DG53244U",181,0)
 .S $P(^XTMP(DGNMSP,"STATS",DGFIL,DGFLD),U,(DGI+2))=$P($G(^XTMP(DGNMSP,"STATS",DGFIL,DGFLD)),U,(DGI+2))+1
"RTN","DG53244U",182,0)
 .;Total changes by type
"RTN","DG53244U",183,0)
 .S $P(^XTMP(DGNMSP,"STATS"),U,(DGI+3))=$P($G(^XTMP(DGNMSP,"STATS")),U,(DGI+3))+1
"RTN","DG53244U",184,0)
 .Q
"RTN","DG53244U",185,0)
 ;Total patients with changes
"RTN","DG53244U",186,0)
 I '$D(^XTMP(DGNMSP,DGIEN)) S $P(^XTMP(DGNMSP,"STATS"),U,2)=$P($G(^XTMP(DGNMSP,"STATS")),U,2)+1
"RTN","DG53244U",187,0)
 ;Total fields with changes
"RTN","DG53244U",188,0)
 S $P(^XTMP(DGNMSP,"STATS"),U,3)=$P($G(^XTMP(DGNMSP,"STATS")),U,3)+1
"RTN","DG53244U",189,0)
 ;Total changes by field
"RTN","DG53244U",190,0)
 S $P(^XTMP(DGNMSP,"STATS",DGFIL,DGFLD),U,2)=$P($G(^XTMP(DGNMSP,"STATS",DGFIL,DGFLD)),U,2)+1
"RTN","DG53244U",191,0)
 ;PATIENT field name change and types
"RTN","DG53244U",192,0)
 S ^XTMP(DGNMSP,DGIEN,DGFIL,DGIEN2,DGFLD)=DGOLD_U_DGNAM_U_DGTSTR
"RTN","DG53244U",193,0)
 ;Name x-ref
"RTN","DG53244U",194,0)
 S DGN=$P($G(^DPT(DGIEN,0)),U) S:DGN="" DGN=" "
"RTN","DG53244U",195,0)
 S ^XTMP(DGNMSP,"B",DGN,DGIEN)=""
"RTN","DG53244U",196,0)
 Q
"RTN","DG53244U",197,0)
 ;
"RTN","DG53244U",198,0)
RMPI(DGP,DGMPI) ;Record MPI notification status
"RTN","DG53244U",199,0)
 S $P(^XTMP("DPTNAME",DGIEN,"MPI"),U,DGP)=1
"RTN","DG53244U",200,0)
 Q:'$D(DGMPI)  S ^XTMP("DPTNAME",DGIEN,"MPI","A31")=DGMPI
"RTN","DG53244U",201,0)
 Q
"RTN","DG53244U",202,0)
 ;
"RTN","DG53244U",203,0)
INV(DGIENS) ;Invert the IENS
"RTN","DG53244U",204,0)
 N DGI,DGX
"RTN","DG53244U",205,0)
 Q:DGIENS?."," ""
"RTN","DG53244U",206,0)
 S:DGIENS'?.E1"," DGIENS=DGIENS_","
"RTN","DG53244U",207,0)
 S DGX="" F DGI=$L(DGIENS,",")-1:-1:1 S DGX=DGX_$P(DGIENS,",",DGI)_":"
"RTN","DG53244U",208,0)
 S:DGX?.E1":" DGX=$E(DGX,1,$L(DGX)-1)
"RTN","DG53244U",209,0)
 Q DGX
"RTN","DG53244U",210,0)
 ;
"RTN","DG53244U",211,0)
FIELD ;;
"RTN","DG53244U",212,0)
 ;;NAME^.01^0;1^1.01^30^^ANAM01
"RTN","DG53244U",213,0)
 ;;K-NAME^.211^.21;1^1.02^^^ANAM211
"RTN","DG53244U",214,0)
 ;;K2-NAME^.2191^.211;1^1.03^^^ANAM2191
"RTN","DG53244U",215,0)
 ;;FATHER'S NAME^.2401^.24;1^1.04^^^ANAM2401
"RTN","DG53244U",216,0)
 ;;MOTHER'S NAME^.2402^.24;2^1.05^^^ANAM2402
"RTN","DG53244U",217,0)
 ;;MOTHER'S MAIDEN^.2403^.24;3^1.06^^^ANAM2403
"RTN","DG53244U",218,0)
 ;;E-NAME^.331^.33;1^1.07^^^ANAM331
"RTN","DG53244U",219,0)
 ;;E2-NAME^.3311^.331;1^1.08^^^ANAM3311
"RTN","DG53244U",220,0)
 ;;D NAME^.341^.34;1^1.09^^^ANAM341
"RTN","DG53244U",221,0)
 ;;ALIAS^.01^.01;0;1^100.03^30^2.01^ANAM201
"RTN","DG53244U",222,0)
 ;;ATTORNEY^30^DIS;3;1^100.21^30^2.101^ANAM1001
"RTN","DG53244V")
0^39^B81905206
"RTN","DG53244V",1,0)
DG53244V ;BPOIFO/KEITH - NAME STANDARDIZATION ; 27 Jan 2002 11:05 PM
"RTN","DG53244V",2,0)
 ;;5.3;Registration;**244**;Aug 13, 1993
"RTN","DG53244V",3,0)
 ;
"RTN","DG53244V",4,0)
PRT ;Do report output
"RTN","DG53244V",5,0)
 I '$D(ZTQUEUED),$E(IOST)="C" D WAIT^DICD
"RTN","DG53244V",6,0)
 N DGOUT,DGLINE,DGTITL,DGPAGE,DGPG,DGNMSP,DGPNOW
"RTN","DG53244V",7,0)
 S DGOUT=0,DGNMSP="DPTNAME"
"RTN","DG53244V",8,0)
 D RUN^DG53244U(DGFLAG) Q:DGOUT
"RTN","DG53244V",9,0)
 D HINI D:DGFMT="D" GDETAIL D STOP Q:DGOUT
"RTN","DG53244V",10,0)
 I $E(IOST)="C" D END
"RTN","DG53244V",11,0)
 I DGFMT="D" D
"RTN","DG53244V",12,0)
 .D HDR(0) Q:DGOUT  D PARAM Q:DGOUT
"RTN","DG53244V",13,0)
 .D HDR(1) Q:DGOUT  D PDETAIL
"RTN","DG53244V",14,0)
 .Q
"RTN","DG53244V",15,0)
 Q:DGOUT
"RTN","DG53244V",16,0)
 D HDR(2),STATS(0)
"RTN","DG53244V",17,0)
 Q:DGOUT
"RTN","DG53244V",18,0)
 I $E(IOST)="C" N DIR S DIR(0)="E" W ! D ^DIR
"RTN","DG53244V",19,0)
 K DGLIM,DGFLAG,DGFMT,DGFLD,DGEXC,^TMP(DGNMSP,$J)
"RTN","DG53244V",20,0)
 Q
"RTN","DG53244V",21,0)
 ;
"RTN","DG53244V",22,0)
STATS(DGXM) ;Print statistics page
"RTN","DG53244V",23,0)
 ;Input: DGXM=number > 0 to set array for mailman--
"RTN","DG53244V",24,0)
 ;            pass by reference (optional)
"RTN","DG53244V",25,0)
 ;
"RTN","DG53244V",26,0)
 N DGI,DGY,DGX,DGFILE,DGFLD,DGET,DGPDT,DGTOT,DGSEC
"RTN","DG53244V",27,0)
 S DGXM=+$G(DGXM),(DGET,DGFILE,DGTOT,DGSEC)=0
"RTN","DG53244V",28,0)
 I DGXM D  Q:DGOUT
"RTN","DG53244V",29,0)
 .S DGX=" " D SOUT Q:DGOUT
"RTN","DG53244V",30,0)
 .S DGY="Patient Name Conversion Statistics",DGX=""
"RTN","DG53244V",31,0)
 .S $E(DGX,(80-$L(DGY)\2))=DGY D SOUT Q:DGOUT
"RTN","DG53244V",32,0)
 .S DGX=$E(DGLINE,1,80) D SOUT Q:DGOUT
"RTN","DG53244V",33,0)
 .S DGX="Field",$E(DGX,30)="Evaluated",$E(DGX,41)="Changed"
"RTN","DG53244V",34,0)
 .S $E(DGX,50)="Type 1",$E(DGX,58)="Type 2",$E(DGX,66)="Type 3"
"RTN","DG53244V",35,0)
 .S $E(DGX,74)="Type 4" D SOUT Q:DGOUT
"RTN","DG53244V",36,0)
 .S DGX=$E(DGLINE,1,80) D SOUT
"RTN","DG53244V",37,0)
 .Q
"RTN","DG53244V",38,0)
 F  S DGFILE=$O(^XTMP(DGNMSP,"STATS",DGFILE)) Q:'DGFILE!DGOUT  D
"RTN","DG53244V",39,0)
 .S DGFLD=0
"RTN","DG53244V",40,0)
 .F  S DGFLD=$O(^XTMP(DGNMSP,"STATS",DGFILE,DGFLD)) Q:'DGFLD!DGOUT  D
"RTN","DG53244V",41,0)
 ..S DGY=^XTMP(DGNMSP,"STATS",DGFILE,DGFLD),DGX=DGFILE_","_DGFLD
"RTN","DG53244V",42,0)
 ..S $E(DGX,10)=$P(DGY,U,7),$E(DGX,30)=$J(+$P(DGY,U),9,0)
"RTN","DG53244V",43,0)
 ..S $E(DGX,41)=$J(+$P(DGY,U,2),7,0),$E(DGX,50)=$J(+$P(DGY,U,3),6,0)
"RTN","DG53244V",44,0)
 ..S $E(DGX,58)=$J(+$P(DGY,U,4),6,0),$E(DGX,66)=$J(+$P(DGY,U,5),6,0)
"RTN","DG53244V",45,0)
 ..S $E(DGX,74)=$J(+$P(DGY,U,6),6,0),DGET=DGET+$P(DGY,U)
"RTN","DG53244V",46,0)
 ..D SOUT
"RTN","DG53244V",47,0)
 ..Q
"RTN","DG53244V",48,0)
 .Q
"RTN","DG53244V",49,0)
 Q:DGOUT  S DGX=$E(DGLINE,1,80)
"RTN","DG53244V",50,0)
 D SOUT Q:DGOUT
"RTN","DG53244V",51,0)
 S DGY=^XTMP(DGNMSP,"STATS")
"RTN","DG53244V",52,0)
 S DGX="REPORT TOTAL:",$E(DGX,30)=$J(DGET,9,0)
"RTN","DG53244V",53,0)
 S $E(DGX,41)=$J(+$P(DGY,U,3),7,0),$E(DGX,50)=$J(+$P(DGY,U,4),6,0)
"RTN","DG53244V",54,0)
 S $E(DGX,58)=$J(+$P(DGY,U,5),6,0),$E(DGX,66)=$J(+$P(DGY,U,6),6,0)
"RTN","DG53244V",55,0)
 S $E(DGX,74)=$J(+$P(DGY,U,7),6,0)
"RTN","DG53244V",56,0)
 D SOUT Q:DGOUT  S DGX=" " D SOUT Q:DGOUT  S DGX=""
"RTN","DG53244V",57,0)
 S $E(DGX,10)="Exception types: 1 Name value contains no comma"
"RTN","DG53244V",58,0)
 D SOUT Q:DGOUT  S DGX=""
"RTN","DG53244V",59,0)
 S $E(DGX,27)="2 Parenthetical text is removed from name"
"RTN","DG53244V",60,0)
 D SOUT Q:DGOUT  S DGX=""
"RTN","DG53244V",61,0)
 S $E(DGX,27)="3 Name value cannot be converted"
"RTN","DG53244V",62,0)
 D SOUT Q:DGOUT  S DGX=""
"RTN","DG53244V",63,0)
 S $E(DGX,27)="4 Characters are removed or changed"
"RTN","DG53244V",64,0)
 D SOUT Q:DGOUT  S DGX=" " D SOUT Q:DGOUT  S DGX=""
"RTN","DG53244V",65,0)
 S $E(DGX,24)="Total name values evaluated:  "_$J(+DGY,7,0)
"RTN","DG53244V",66,0)
 D SOUT Q:DGOUT  S DGX=""
"RTN","DG53244V",67,0)
 S $E(DGX,20)="Total patient records to change:  "_$J(+$P(DGY,U,2),7,0)
"RTN","DG53244V",68,0)
 D SOUT Q:DGOUT
"RTN","DG53244V",69,0)
 S DGPDT=$G(^XTMP(DGNMSP,0,0)) Q:'DGPDT
"RTN","DG53244V",70,0)
 S DGX=" " D SOUT S DGX="" Q:DGOUT
"RTN","DG53244V",71,0)
 S $E(DGX,12)="Name conversion processing started "_$$FMTE^XLFDT(+DGPDT)
"RTN","DG53244V",72,0)
 D SOUT S DGX="" Q:DGOUT
"RTN","DG53244V",73,0)
 I $P(DGPDT,U,2) D  Q:DGOUT
"RTN","DG53244V",74,0)
 .S $E(DGX,12)="Name conversion processing completed "_$$FMTE^XLFDT($P(DGPDT,U,2))
"RTN","DG53244V",75,0)
 .D SOUT Q
"RTN","DG53244V",76,0)
 S DGX=" " D SOUT Q:DGOUT
"RTN","DG53244V",77,0)
 S DGI=0 F  S DGI=$O(^XTMP(DGNMSP,0,DGI)) Q:'DGI!DGOUT  D
"RTN","DG53244V",78,0)
 .S DGY=^XTMP(DGNMSP,0,DGI),DGX=""
"RTN","DG53244V",79,0)
 .S $E(DGX,1)=DGI_". "_$$FMTE^XLFDT($P(DGY,U))
"RTN","DG53244V",80,0)
 .I $P(DGY,U,2) D
"RTN","DG53244V",81,0)
 ..S DGX=DGX_" to "_$$FMTE^XLFDT($P(DGY,U,2))
"RTN","DG53244V",82,0)
 ..S DGSEC=DGSEC+$$FMDIFF^XLFDT($P(DGY,U,2),$P(DGY,U),2)
"RTN","DG53244V",83,0)
 .I $P(DGY,U,4) D
"RTN","DG53244V",84,0)
 ..S DGX=DGX_", names processed: "_($P(DGY,U,4)-$P(DGY,U,3))
"RTN","DG53244V",85,0)
 ..S DGTOT=DGTOT+($P(DGY,U,4)-$P(DGY,U,3))
"RTN","DG53244V",86,0)
 ..Q
"RTN","DG53244V",87,0)
 .D SOUT
"RTN","DG53244V",88,0)
 .Q
"RTN","DG53244V",89,0)
 Q:'DGSEC!DGOUT
"RTN","DG53244V",90,0)
 S DGX=" " D SOUT Q:DGOUT
"RTN","DG53244V",91,0)
 S DGY="Processing time:  "_$$TIME(DGSEC)
"RTN","DG53244V",92,0)
 S DGX="",$E(DGX,(80-$L(DGY)\2))=DGY
"RTN","DG53244V",93,0)
 D SOUT Q:'DGTOT!DGOUT
"RTN","DG53244V",94,0)
 S DGY="Processing rate:  "_(DGTOT\(DGSEC/3600))_" name values per hour"
"RTN","DG53244V",95,0)
 S DGX="",$E(DGX,(80-$L(DGY)\2))=DGY D SOUT
"RTN","DG53244V",96,0)
 Q
"RTN","DG53244V",97,0)
 ;
"RTN","DG53244V",98,0)
SOUT ;Output statistics line
"RTN","DG53244V",99,0)
 I DGXM S DGXM=DGXM+1,DGXM(DGXM,0)=DGX Q
"RTN","DG53244V",100,0)
 D:$Y>(IOSL-3) HDR(2) Q:DGOUT  W !?26,DGX
"RTN","DG53244V",101,0)
 Q
"RTN","DG53244V",102,0)
 ;
"RTN","DG53244V",103,0)
GDETAIL ;Generate report detail global
"RTN","DG53244V",104,0)
 K ^TMP(DGNMSP,$J)
"RTN","DG53244V",105,0)
 N DGNAME,DFN,DGFILE,DGIFN,DGFIELD,DGX,DGTYPE,DGSSN
"RTN","DG53244V",106,0)
 S DGNAME=""
"RTN","DG53244V",107,0)
 F  S DGNAME=$O(^XTMP(DGNMSP,"B",DGNAME)) Q:DGNAME=""  S DFN=0 D
"RTN","DG53244V",108,0)
 .F  S DFN=$O(^XTMP(DGNMSP,"B",DGNAME,DFN)) Q:'DFN  S DGFILE=0 D
"RTN","DG53244V",109,0)
 ..S DGSSN=$P($G(^DPT(DFN,0)),U,9)
"RTN","DG53244V",110,0)
 ..F  S DGFILE=$O(^XTMP(DGNMSP,DFN,DGFILE)) Q:'DGFILE  S DGIFN=0 D
"RTN","DG53244V",111,0)
 ...F  S DGIFN=$O(^XTMP(DGNMSP,DFN,DGFILE,DGIFN)) Q:'DGIFN  D
"RTN","DG53244V",112,0)
 ....S DGFIELD=0
"RTN","DG53244V",113,0)
 ....F  S DGFIELD=$O(^XTMP(DGNMSP,DFN,DGFILE,DGIFN,DGFIELD)) Q:'DGFIELD  D
"RTN","DG53244V",114,0)
 .....Q:'$$OKFLD(DGFILE,DGFIELD)
"RTN","DG53244V",115,0)
 .....S DGX=^XTMP(DGNMSP,DFN,DGFILE,DGIFN,DGFIELD),DGTYPE=$P(DGX,U,3)
"RTN","DG53244V",116,0)
 .....Q:'$$OKTYP(DGTYPE)
"RTN","DG53244V",117,0)
 .....S ^TMP(DGNMSP,$J,DGNAME,DFN,DGFILE,DGIFN,DGFIELD)=DGSSN_U_DGX
"RTN","DG53244V",118,0)
 .....Q
"RTN","DG53244V",119,0)
 ....Q
"RTN","DG53244V",120,0)
 ...Q
"RTN","DG53244V",121,0)
 ..Q
"RTN","DG53244V",122,0)
 .Q
"RTN","DG53244V",123,0)
 Q
"RTN","DG53244V",124,0)
 ;
"RTN","DG53244V",125,0)
PDETAIL ;Print report detail
"RTN","DG53244V",126,0)
 N DGNAME,DFN,DGFILE,DGIFN,DGFIELD,DGX,DGR
"RTN","DG53244V",127,0)
 S (DGR,DGNAME)=""
"RTN","DG53244V",128,0)
 F  S DGNAME=$O(^TMP(DGNMSP,$J,DGNAME)) Q:DGNAME=""!DGOUT  S DFN=0 D
"RTN","DG53244V",129,0)
 .F  S DFN=$O(^TMP(DGNMSP,$J,DGNAME,DFN)) Q:'DFN!DGOUT  S DGFILE=0 D
"RTN","DG53244V",130,0)
 ..F  S DGFILE=$O(^TMP(DGNMSP,$J,DGNAME,DFN,DGFILE)) Q:'DGFILE!DGOUT  D
"RTN","DG53244V",131,0)
 ...S DGIFN=0
"RTN","DG53244V",132,0)
 ...F  S DGIFN=$O(^TMP(DGNMSP,$J,DGNAME,DFN,DGFILE,DGIFN)) Q:'DGIFN!DGOUT  D
"RTN","DG53244V",133,0)
 ....S DGFIELD=0
"RTN","DG53244V",134,0)
 ....F  S DGFIELD=$O(^TMP(DGNMSP,$J,DGNAME,DFN,DGFILE,DGIFN,DGFIELD)) Q:'DGFIELD!DGOUT  D
"RTN","DG53244V",135,0)
 .....S DGX=^TMP(DGNMSP,$J,DGNAME,DFN,DGFILE,DGIFN,DGFIELD)
"RTN","DG53244V",136,0)
 .....D:$Y>(IOSL-3) HDR(1) Q:DGOUT
"RTN","DG53244V",137,0)
 .....W ! I DGR'=DFN W $E(DGNAME,1,20),?22,$P(DGX,U) S DGR=DFN
"RTN","DG53244V",138,0)
 .....W ?33,$P(^XTMP(DGNMSP,"STATS",DGFILE,DGFIELD),U,7)
"RTN","DG53244V",139,0)
 .....W ?54,$P(DGX,U,2),?90,$P(DGX,U,3),?125,$$EXC($P(DGX,U,4))
"RTN","DG53244V",140,0)
 .....Q
"RTN","DG53244V",141,0)
 ....Q
"RTN","DG53244V",142,0)
 ...Q
"RTN","DG53244V",143,0)
 ..Q
"RTN","DG53244V",144,0)
 .Q
"RTN","DG53244V",145,0)
 Q
"RTN","DG53244V",146,0)
 ;
"RTN","DG53244V",147,0)
EXC(DGE) ;Format exception types with commas
"RTN","DG53244V",148,0)
 N DGI,DGX S DGX=""
"RTN","DG53244V",149,0)
 F DGI=1:1:$L(DGE) S DGX=DGX_$E(DGE,DGI)_","
"RTN","DG53244V",150,0)
 Q $E(DGX,1,($L(DGX)-1))
"RTN","DG53244V",151,0)
 ;
"RTN","DG53244V",152,0)
OKFLD(DGFILE,DGFIELD) ;Check field screen
"RTN","DG53244V",153,0)
 Q:DGFLD="A" 1
"RTN","DG53244V",154,0)
 I DGFIELD=.01 Q ($D(DGFLD(DGFIELD))&(DGFILE=2))
"RTN","DG53244V",155,0)
 I DGFILE=2.01 Q $D(DGFLD(DGFILE))
"RTN","DG53244V",156,0)
 Q:$D(DGFLD(DGFIELD)) 1
"RTN","DG53244V",157,0)
 Q:$D(DGFLD(DGFILE)) 1
"RTN","DG53244V",158,0)
 Q 0
"RTN","DG53244V",159,0)
 ;
"RTN","DG53244V",160,0)
OKTYP(DGTYPE) ;Check exception types
"RTN","DG53244V",161,0)
 N DGI,DGOK S (DGI,DGOK)=0
"RTN","DG53244V",162,0)
 F  Q:DGOK  S DGI=$O(DGEXC(DGI)) Q:'DGI  S:DGTYPE[DGI DGOK=1
"RTN","DG53244V",163,0)
 Q DGOK
"RTN","DG53244V",164,0)
 ;
"RTN","DG53244V",165,0)
PARAM N DGEND S DGEND=0
"RTN","DG53244V",166,0)
 W !!?(IOM\2-25),"The following report parameters have been selected:"
"RTN","DG53244V",167,0)
 W !!?(IOM\2-28),"Report generation action:  ",DGFLAG(DGFLAG)
"RTN","DG53244V",168,0)
 W !?(IOM\2-28),"           Report format:  ",DGFMT(DGFMT)
"RTN","DG53244V",169,0)
 W !?(IOM\2-28),"        Fields to return:" S DGEND=0
"RTN","DG53244V",170,0)
 S DGI="" F  S DGI=$O(DGFLD(DGI)) Q:DGI=""  D
"RTN","DG53244V",171,0)
 .W:DGEND ! W ?(IOM\2-1),DGFLD(DGI) S DGEND=1
"RTN","DG53244V",172,0)
 .Q
"RTN","DG53244V",173,0)
 W !?(IOM\2-28),"    Exceptions to report:" S DGEND=0
"RTN","DG53244V",174,0)
 S DGI="" F  S DGI=$O(DGEXC(DGI)) Q:DGI=""  D
"RTN","DG53244V",175,0)
 .W:DGEND ! W ?(IOM\2-1),DGEXC(DGI) S DGEND=1
"RTN","DG53244V",176,0)
 .Q
"RTN","DG53244V",177,0)
 Q
"RTN","DG53244V",178,0)
 ;
"RTN","DG53244V",179,0)
HINI ;Initialize header variables
"RTN","DG53244V",180,0)
 S DGLINE="",$P(DGLINE,"-",133)="",DGPAGE=1,DGPG=0
"RTN","DG53244V",181,0)
 S DGPNOW=$P($$FMTE^XLFDT($$NOW^XLFDT()),":",1,2)
"RTN","DG53244V",182,0)
 S DGTITL="<*>  Patient Name Standardization Report  <*>"
"RTN","DG53244V",183,0)
 Q
"RTN","DG53244V",184,0)
 ;
"RTN","DG53244V",185,0)
HDR(DGTY,DGNEG) ;Print header
"RTN","DG53244V",186,0)
 ;Input: DGTY=type of header where:
"RTN","DG53244V",187,0)
 ;            '0'=report parameters
"RTN","DG53244V",188,0)
 ;            '1'=detailed report
"RTN","DG53244V",189,0)
 ;            '2'=summary report
"RTN","DG53244V",190,0)
 ;      DGNEG='1' to indicate a negative report (optional)
"RTN","DG53244V",191,0)
 N Y
"RTN","DG53244V",192,0)
 Q:DGOUT
"RTN","DG53244V",193,0)
 I $E(IOST)="C",DGPG N DIR S DIR(0)="E" W ! D ^DIR S DGOUT=Y'=1 Q:DGOUT
"RTN","DG53244V",194,0)
 N DGX,DGP S DGP=$S($G(^XTMP("DPTNAME",0,0)):"",1:"Potential ")
"RTN","DG53244V",195,0)
 D STOP Q:DGOUT
"RTN","DG53244V",196,0)
 W:DGPG!($E(IOST)="C") $$XY(IOF,1,0)
"RTN","DG53244V",197,0)
 W:$X $$XY("",0,0)
"RTN","DG53244V",198,0)
 W DGLINE,!?(132-$L(DGTITL)\2),DGTITL
"RTN","DG53244V",199,0)
 I DGTY=0 S DGX="Report Parameters for "_DGP_"Name Conversion"
"RTN","DG53244V",200,0)
 I DGTY=1 S DGX="Detail of "_DGP_"Name Field Changes"
"RTN","DG53244V",201,0)
 I DGTY=2 S DGX="Name Field "_DGP_"Change Statistics"
"RTN","DG53244V",202,0)
 W !?(132-$L(DGX)\2),DGX
"RTN","DG53244V",203,0)
 W !,DGLINE
"RTN","DG53244V",204,0)
 W !,"Date printed: ",DGPNOW,?(126-$L(DGPAGE)),"Page: ",DGPAGE
"RTN","DG53244V",205,0)
 W !,DGLINE
"RTN","DG53244V",206,0)
 S DGPAGE=DGPAGE+1,DGPG=1
"RTN","DG53244V",207,0)
 Q:'DGTY
"RTN","DG53244V",208,0)
 D:DGTY=1
"RTN","DG53244V",209,0)
 .W !,"Patient Name",?22,"SSN",?33,"Field"
"RTN","DG53244V",210,0)
 .W ?54,"Old Name Value",?90,"New Name Value",?125,"Codes"
"RTN","DG53244V",211,0)
 .Q
"RTN","DG53244V",212,0)
 D:DGTY=2
"RTN","DG53244V",213,0)
 .W !?26,"Field",?56,"Evaluated",?67,"Changed",?76,"Type 1"
"RTN","DG53244V",214,0)
 .W ?84,"Type 2",?92,"Type 3",?100,"Type 4"
"RTN","DG53244V",215,0)
 .Q
"RTN","DG53244V",216,0)
 W !,DGLINE
"RTN","DG53244V",217,0)
 Q
"RTN","DG53244V",218,0)
 ;
"RTN","DG53244V",219,0)
STOP ;Check for stop task request
"RTN","DG53244V",220,0)
 S:$D(ZTQUEUED) (DGOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","DG53244V",221,0)
 ;
"RTN","DG53244V",222,0)
XY(X,DGI,DGZ) ;Maintain $X, $Y
"RTN","DG53244V",223,0)
 ;Required input: X=screen handling variable
"RTN","DG53244V",224,0)
 ;Optional input: DGI=1 if indirection is needed
"RTN","DG53244V",225,0)
 ;Optional input: DGZ=0 if $X & $Y are to be zeroed
"RTN","DG53244V",226,0)
 N DX,DY S DX=$X,DY=$Y S:$G(DGZ)=0 (DX,DY)=0
"RTN","DG53244V",227,0)
 I $G(DGI),$L(X) W @X X ^%ZOSF("XY") Q ""
"RTN","DG53244V",228,0)
 W X X ^%ZOSF("XY")
"RTN","DG53244V",229,0)
 Q ""
"RTN","DG53244V",230,0)
 ;
"RTN","DG53244V",231,0)
TITL(DGES) ;Display report title
"RTN","DG53244V",232,0)
 ;Required input: DGES=report descriptive title
"RTN","DG53244V",233,0)
 N X,DGX
"RTN","DG53244V",234,0)
 D ENS^%ZISS S X=0 X ^%ZOSF("RM")
"RTN","DG53244V",235,0)
 I $E(IOST)'="C" W $$XY(IOF,1,0),?(IOM-$L(DGES)\2),DGES,! Q
"RTN","DG53244V",236,0)
 S:$L(DGES)#1 DGES=DGES_" " S IOTM=3,IOBM=IOSL,DGX=""
"RTN","DG53244V",237,0)
 S $P(DGX," ",(80-$L(DGES)\2+1))="",DGX=DGX_DGES_DGX
"RTN","DG53244V",238,0)
 W $$XY(IOF,1,0),$$XY(IORVON),DGX,$$XY(IORVOFF),$$XY(IOSTBM,1),!
"RTN","DG53244V",239,0)
 Q
"RTN","DG53244V",240,0)
 ;
"RTN","DG53244V",241,0)
SUBT(DGX) ;Display subtitle
"RTN","DG53244V",242,0)
 ;Required input: DGX=subtitle text
"RTN","DG53244V",243,0)
 W !!?(80-$L(DGX)\2),$$XY(IORVON),DGX,$$XY(IORVOFF)
"RTN","DG53244V",244,0)
 Q
"RTN","DG53244V",245,0)
 ;
"RTN","DG53244V",246,0)
END ;Clean up
"RTN","DG53244V",247,0)
 N X S X=IOM X ^%ZOSF("RM") D DISP0,KILL^%ZISS
"RTN","DG53244V",248,0)
 Q
"RTN","DG53244V",249,0)
 ;
"RTN","DG53244V",250,0)
DISP0 ;Return to full screen scrolling
"RTN","DG53244V",251,0)
 N DGRM,DGXY
"RTN","DG53244V",252,0)
 Q:$E(IOST)'="C"
"RTN","DG53244V",253,0)
 D ENS^%ZISS S DGRM=^%ZOSF("RM"),DGXY=^%ZOSF("XY"),(IOTM,IOBM)=0
"RTN","DG53244V",254,0)
 W $$XY(IOSTBM,1),@IOF N DX,DY,X S (DX,DY)=0 X DGXY S X=IOM X DGRM
"RTN","DG53244V",255,0)
 Q
"RTN","DG53244V",256,0)
 ;
"RTN","DG53244V",257,0)
TIME(DGX) ;Externalize run time
"RTN","DG53244V",258,0)
 ;Input: DGX=number of seconds
"RTN","DG53244V",259,0)
 ;Output: text formatted string with # days, hours, minutes and seconds
"RTN","DG53244V",260,0)
 N DGY
"RTN","DG53244V",261,0)
 S DGY("D")=DGX\86400
"RTN","DG53244V",262,0)
 S DGX=DGX#86400,DGY("H")=DGX\3600,DGX=DGX#3600
"RTN","DG53244V",263,0)
 S DGY("M")=DGX\60,DGY("S")=DGX#60
"RTN","DG53244V",264,0)
 S DGY("D")=$S('DGY("D"):"",1:DGY("D")_" day"_$S(DGY("D")=1:"",1:"s")_", ")
"RTN","DG53244V",265,0)
 S DGY("H")=DGY("H")_" hour"_$S(DGY("H")=1:"",1:"s")_", "
"RTN","DG53244V",266,0)
 S DGY("M")=DGY("M")_" minute"_$S(DGY("M")=1:"",1:"s")_", "
"RTN","DG53244V",267,0)
 S DGY("S")=DGY("S")_" second"_$S(DGY("S")=1:"",1:"s")
"RTN","DG53244V",268,0)
 Q DGY("D")_DGY("H")_DGY("M")_DGY("S")
"RTN","DG53244V",269,0)
 ;
"RTN","DG53244V",270,0)
XRARY ;Gather xref kills and sets
"RTN","DG53244V",271,0)
 N DGI,DGII,DGIEN,DGVAL,DGDATA,DGZ
"RTN","DG53244V",272,0)
 S DGI="",DGVAL(1)=2,DGZ=0
"RTN","DG53244V",273,0)
 F  S DGZ=$O(DGFIELD(DGZ)) Q:'DGZ  D
"RTN","DG53244V",274,0)
 .F  S DGI=$O(DGFIELD(DGZ,DGI)) Q:DGI=""  D
"RTN","DG53244V",275,0)
 ..S DGVAL(2)=$P(DGFIELD(DGZ,DGI),U,7)
"RTN","DG53244V",276,0)
 ..D FIND^DIC(.11,"","@;IXIE","KP",.DGVAL,"","","","","DGDATA")
"RTN","DG53244V",277,0)
 ..S DGIEN=+DGDATA("DILIST",1,0)_"," K DGDATA
"RTN","DG53244V",278,0)
 ..D GETS^DIQ(.11,DGIEN,"1.1;2.1","","DGDATA")
"RTN","DG53244V",279,0)
 ..F DGII=1.1,2.1 S DGXRARY(DGVAL(2),DGII)=DGDATA(.11,DGIEN,DGII)
"RTN","DG53244V",280,0)
 ..Q
"RTN","DG53244V",281,0)
 .Q
"RTN","DG53244V",282,0)
 Q
"RTN","DGBUL")
0^40^B6129320
"RTN","DGBUL",1,0)
DGBUL ;ALB/MRL - SEND DG BULLETIN ; 22 MAY 1987
"RTN","DGBUL",2,0)
 ;;5.3;Registration;**31,244**;Aug 13, 1993
"RTN","DGBUL",3,0)
 ;
"RTN","DGBUL",4,0)
 N DIC,DIX,DIY,DO,DD
"RTN","DGBUL",5,0)
 I '$D(DGB),'$D(XMSUB) G Q
"RTN","DGBUL",6,0)
 K:$D(DGTEXT) XMTEXT I '$D(DGTEXT)&('$D(XMTEXT)) G Q
"RTN","DGBUL",7,0)
 S DGB=+$P($G(^DG(43,1,"NOT")),"^",DGB)
"RTN","DGBUL",8,0)
 I '$D(^XMB(3.8,DGB,0)) G Q
"RTN","DGBUL",9,0)
 ;
"RTN","DGBUL",10,0)
 ;Protect Fileman from Mailman call
"RTN","DGBUL",11,0)
 N DICRREC,DIDATA,DIEFAR,DIEFCNOD,DIEFDAS,DIEFECNT,DIEFF,DIEFFLAG
"RTN","DGBUL",12,0)
 N DIEFFLD,DIEFFLST,DIEFFREF,DIEFFVAL,DIEFFXR,DIEFI,DIEFIEN,DIEFLEV
"RTN","DGBUL",13,0)
 N DIEFNODE,DIEFNVAL,DIEFOUT,DIEFOVAL,DIEFRFLD,DIEFRLST,DIEFSORK
"RTN","DGBUL",14,0)
 N DIEFSPOT,DIEFTMP,DIEFTREF,DIFM,DIQUIET,DISYS,D,D0,DA
"RTN","DGBUL",15,0)
 ;
"RTN","DGBUL",16,0)
 S XMY("G."_$P($G(^XMB(3.8,DGB,0)),"^",1))="" ; pass mailgroup
"RTN","DGBUL",17,0)
 G Q:'$D(DUZ) S:'$D(DGSM) DGSM=1 S XMTEXT=$S('$D(XMTEXT):"DGTEXT(",1:XMTEXT),XMDUZ=$S(($D(DUZ)#2):DUZ,1:.5) S:$D(DUZ)#2&(DGSM) XMY(DUZ)="" K:'$D(XMY) DGSM D ^XMD:$D(XMY)
"RTN","DGBUL",18,0)
Q K DGSM,DGB,DGTEXT,XMR,DGII,XMY,XMTEXT,XMDUZ,XMSUB Q
"RTN","DGBUL",19,0)
 ;
"RTN","DGBUL",20,0)
EDIT ;
"RTN","DGBUL",21,0)
 F I=1:1 S J=$P($T(T+I),";;",2) Q:J']""  W !,J
"RTN","DGBUL",22,0)
 W ! S DIE="^DG(43,",(DA,Y)=1,DR="500:513" D ^DIE K D,D0,DI,DIC,DQ,X,DR,DIE,DA,Y,I,J Q
"RTN","DGBUL",23,0)
T ;
"RTN","DGBUL",24,0)
 ;;This option is used to specify the mailgroup you desire specific types of
"RTN","DGBUL",25,0)
 ;;notification to be made to.  The mailgroup can be one created locally or a
"RTN","DGBUL",26,0)
 ;;distributed 'DG' mailgroup.  If a mailgroup is selected notification concerning
"RTN","DGBUL",27,0)
 ;;that specific action will be made in the form of a mailman bulletin.  If no
"RTN","DGBUL",28,0)
 ;;notification is desired for a specific action no mailgroup should be specified.
"RTN","DGBUL",29,0)
 ;;If you have any questions concerning the purpose of a specific type of
"RTN","DGBUL",30,0)
 ;;notification enter a question mark at the applicable prompt.
"RTN","DGDDC")
0^42^B6759474
"RTN","DGDDC",1,0)
DGDDC ;ALB/MRL - X-ECUTE KILL X-REFERENCES [PATIENT] ;20 March 2003 7:20
"RTN","DGDDC",2,0)
 ;;5.3;Registration;**489,244**;Aug 13, 1993
"RTN","DGDDC",3,0)
 ;
"RTN","DGDDC",4,0)
 Q:$D(DGNOFDEL)  ;Flag variable to prevent deletion cascade
"RTN","DGDDC",5,0)
 ;
"RTN","DGDDC",6,0)
 Q:'$D(DGXRF)  S DGXRFX=X,DGXRF1=+$P(DGXRF,".",2),DGXRF2=$P($T(@DGXRF1),";;",2) G Q:DGXRF2=""
"RTN","DGDDC",7,0)
 I $D(^DD(2,DGXRF,0)) S DGXRFP=$P(^(0),"^",4),DGXRF6=$P(DGXRFP,";",2),DGXRF5=$P(DGXRFP,";",1) I $D(^DPT(DA,DGXRF5)),($P(^(DGXRF5),"^",DGXRF6)=DGXRFX) G Q
"RTN","DGDDC",8,0)
 F DGXRF3=1:1 S DGXRF4=$P(DGXRF2,"^",DGXRF3) Q:DGXRF4=""  I $D(^DD(2,DGXRF4,0)) S DGXRF5=$P(^(0),"^",4),DGXRF6=$P(DGXRF5,";",2),DGXRF5=$P(DGXRF5,";",1) I $D(^DPT(DA,DGXRF5)),$P(^(DGXRF5),"^",DGXRF6)'="" D KILL
"RTN","DGDDC",9,0)
Q S X=DGXRFX K DGXRF,DGXRF1,DGXRF2,DGXRF3,DGXRF3,DGXRF4,DGXRF5,DGXRF6,DGXRF7,DGXRF8,DGXRFP,DGXRFX Q
"RTN","DGDDC",10,0)
KILL S DGXRF7=$P(^DPT(DA,DGXRF5),"^",DGXRF6),$P(^DPT(DA,DGXRF5),"^",DGXRF6)=""
"RTN","DGDDC",11,0)
 F DGXRF8=0:0 S DGXRF8=$O(^DD(2,DGXRF4,1,DGXRF8)) Q:'DGXRF8  I $D(^DD(2,DGXRF4,1,DGXRF8,2)) S X=DGXRF7 X:^(2)'["DGXRF" ^(2) D SET I $D(^DD(2,DGXRF4,1,DGXRF8,1)) D SET
"RTN","DGDDC",12,0)
 Q
"RTN","DGDDC",13,0)
SET Q:^DD(2,DGXRF4,1,DGXRF8,1)'["DGXRF"  S X="" X ^(1) Q
"RTN","DGDDC",14,0)
 ;
"RTN","DGDDC",15,0)
152 ;;.1651^.1653^.1654^.1656^.307^
"RTN","DGDDC",16,0)
153 ;;.1657^.1658^.1659^
"RTN","DGDDC",17,0)
211 ;;.212^.2125^.213^.214^.215^.216^.217^.218^.219^.21011^.2207^
"RTN","DGDDC",18,0)
2191 ;;.2192^.21925^.2193^.2194^.2195^.2196^.2197^.2198^.2199^.211011^.2203^
"RTN","DGDDC",19,0)
251 ;;.252^.253^.254^.255^.256^.257^.258^.2206^
"RTN","DGDDC",20,0)
3111 ;;.3113^.3114^.3115^.3116^.3117^.3118^.3119^.2205^
"RTN","DGDDC",21,0)
331 ;;.332^.3305^.333^.334^.335^.336^.337^.338^.339^.33011^.2201^
"RTN","DGDDC",22,0)
3311 ;;.3312^.3313^.3314^.3315^.3316^.3317^.3318^.3319^.331011^.2204^
"RTN","DGDDC",23,0)
341 ;;.342^.3405^.343^.344^.345^.346^.347^.348^.349^.34011^.2202^
"RTN","DGDDC",24,0)
3285 ;;.329^.3291^.3292^.3293^.3294^
"RTN","DGDDC",25,0)
32945 ;;.3295^.3296^.3297^.3298^.3299^
"RTN","DGDDC",26,0)
111 ;;.112^.113
"RTN","DGDDC",27,0)
112 ;;.113
"RTN","DGDDC",28,0)
12105 ;;.1217^.1218
"RTN","DGDDC",29,0)
1211 ;;.1212^.1213
"RTN","DGDDC",30,0)
1212 ;;.1213
"RTN","DGDDC",31,0)
14105 ;;.1417^.1418
"RTN","DGDDC",32,0)
1411 ;;.1412^.1413
"RTN","DGDDC",33,0)
1412 ;;.1413
"RTN","DGDDC",34,0)
213 ;;.214^.215
"RTN","DGDDC",35,0)
214 ;;.215
"RTN","DGDDC",36,0)
2193 ;;.2194^.2195
"RTN","DGDDC",37,0)
2194 ;;.2195
"RTN","DGDDC",38,0)
252 ;;.253^.254
"RTN","DGDDC",39,0)
253 ;;.254
"RTN","DGDDC",40,0)
3113 ;;.3114^.3115
"RTN","DGDDC",41,0)
3114 ;;.3115
"RTN","DGDDC",42,0)
3313 ;;.3314^.3315
"RTN","DGDDC",43,0)
3314 ;;.3315
"RTN","DGDDC",44,0)
333 ;;.334^.335
"RTN","DGDDC",45,0)
334 ;;.335
"RTN","DGDDC",46,0)
343 ;;.344^.345
"RTN","DGDDC",47,0)
344 ;;.345
"RTN","DGDDC",48,0)
361 ;;.3611
"RTN","DGLOCK2")
0^36^B22007472
"RTN","DGLOCK2",1,0)
DGLOCK2 ;ALB/MRL - PATIENT FILE DATA EDIT CHECKS ; 28 Jan 2002  2:37 PM
"RTN","DGLOCK2",2,0)
 ;;5.3;Registration;**18,244**;Aug 13, 1993
"RTN","DGLOCK2",3,0)
K1 ;NOK Add
"RTN","DGLOCK2",4,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",5,0)
 I $S('$D(^DPT(DFN,.21)):1,$P(^(.21),U,1)']"":1,1:0) W !?4,*7,"'NEXT OF KIN' name must be specified to enter/edit this field" K X
"RTN","DGLOCK2",6,0)
 Q
"RTN","DGLOCK2",7,0)
K1D ;NOK Delete
"RTN","DGLOCK2",8,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",9,0)
 I $D(^DPT(DFN,.21)),$P(^(.21),U,1)]"" W !?4,*7,"Can't be deleted as long as 'NEXT OF KIN' is specified" K X
"RTN","DGLOCK2",10,0)
 Q
"RTN","DGLOCK2",11,0)
K2 ;NOK2 Add
"RTN","DGLOCK2",12,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",13,0)
 D K1 I $D(X),$S('$D(^DPT(DFN,.211)):1,$P(^(.211),U,1)']"":1,1:0) W !?4,*7,"'NEXT OF KIN-2' name must be specified to enter/edit this field" K X
"RTN","DGLOCK2",14,0)
 Q
"RTN","DGLOCK2",15,0)
K2D ;NOK2 Delete
"RTN","DGLOCK2",16,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",17,0)
 I $D(^DPT(DFN,.211)),$P(^(.211),U,1)]"" W !?4,*7,"Can't be deleted as long as 'NEXT OF KIN-2' is specified" K X
"RTN","DGLOCK2",18,0)
 Q
"RTN","DGLOCK2",19,0)
E1 ;Emer Add
"RTN","DGLOCK2",20,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",21,0)
 I $S('$D(^DPT(DFN,.33)):1,$P(^(.33),U,1)']"":1,1:0) W !?4,*7,"'EMERGENCY CONTACT' name must be specified to enter/edit this field" K X
"RTN","DGLOCK2",22,0)
 Q
"RTN","DGLOCK2",23,0)
E1D ;Emer Delete
"RTN","DGLOCK2",24,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",25,0)
 I $D(^DPT(DFN,.33)),$P(^(.33),U,1)]"" W !?4,*7,"Can't be deleted as long as 'EMERGENCY CONTACT' is specified" K X
"RTN","DGLOCK2",26,0)
 Q
"RTN","DGLOCK2",27,0)
E2 ;Emer2 Add
"RTN","DGLOCK2",28,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",29,0)
 D E1 I $D(X),$S('$D(^DPT(DFN,.331)):1,$P(^(.331),U,1)']"":1,1:0) W !?4,*7,"'EMERGENCY CONTACT-2' name must be specified to enter/edit this field" K X
"RTN","DGLOCK2",30,0)
 Q
"RTN","DGLOCK2",31,0)
E2D ;Emer2 Delete
"RTN","DGLOCK2",32,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",33,0)
 I $D(^DPT(DFN,.331)),$P(^(.331),U,1)]"" W !?4,*7,"Can't be deleted as long as 'EMERGENCY CONTACT-2' is specified" K X
"RTN","DGLOCK2",34,0)
 Q
"RTN","DGLOCK2",35,0)
D ;Desig Add
"RTN","DGLOCK2",36,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",37,0)
 I $S('$D(^DPT(DFN,.34)):1,$P(^(.34),U,1)']"":1,1:0) W !?4,*7,"'DESIGNEE' name must be specified to enter/edit this field" K X
"RTN","DGLOCK2",38,0)
 Q
"RTN","DGLOCK2",39,0)
DD ;Desig Delete
"RTN","DGLOCK2",40,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",41,0)
 I $D(^DPT(DFN,.34)),$P(^(.34),U,1)]"" W !?4,*7,"Can't be deleted as long as 'DESIGNEE' is specified" K X
"RTN","DGLOCK2",42,0)
 Q
"RTN","DGLOCK2",43,0)
EM ;Emp Add
"RTN","DGLOCK2",44,0)
 I $S('$D(^DPT(DA,.311)):1,"^3^9^"[$P(^(.311),U,15):1,1:0) G EMW
"RTN","DGLOCK2",45,0)
 Q
"RTN","DGLOCK2",46,0)
EMW W !?4,*7,"'EMPLOYMENT STATUS' must be specified to enter/edit this field" K X Q
"RTN","DGLOCK2",47,0)
EM1 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",48,0)
 I $S('$D(^DPT(DFN,.311)):1,"^3^9^"[$P(^(.311),U,15):1,1:0) G EMW
"RTN","DGLOCK2",49,0)
 I $P(^DPT(DFN,.311),U)']"" W !?4,*7,"'EMPLOYER NAME' must be specified to enter/edit this field" K X
"RTN","DGLOCK2",50,0)
 Q
"RTN","DGLOCK2",51,0)
EMD ;Emp Delete
"RTN","DGLOCK2",52,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",53,0)
 I $D(^DPT(DFN,.311)),$P(^(.311),U,1)]"" W !?4,*7,"Can't be deleted as long as 'EMPLOYER NAME' is specified" K X
"RTN","DGLOCK2",54,0)
 Q
"RTN","DGLOCK2",55,0)
SE ;Sp Emp Add
"RTN","DGLOCK2",56,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",57,0)
 D MAR I $D(X),$S('$D(^DPT(DFN,.25)):1,$P(^(.25),U,1)']"":1,1:0) W !?4,*7,"'SPOUSES EMPLOYER' name must be specified to enter/edit this field" K X
"RTN","DGLOCK2",58,0)
 Q
"RTN","DGLOCK2",59,0)
SED ;Sp Emp Delete
"RTN","DGLOCK2",60,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",61,0)
 I $D(^DPT(DFN,.25)),$P(^(.25),U,1)]"" W !?4,*7,"Can't be deleted as long as 'SPOUSES EMPLOYER' is specified" K X
"RTN","DGLOCK2",62,0)
 Q
"RTN","DGLOCK2",63,0)
MAR ;Married or Separated
"RTN","DGLOCK2",64,0)
 I '$G(DFN) N DFN S DFN=$G(DA) Q:'DFN
"RTN","DGLOCK2",65,0)
 I $S('$D(^DIC(11,+$P(^DPT(DFN,0),U,5),0)):1,$P(^(0),U,1)="MARRIED":0,$P(^(0),U,1)="SEPARATED":0,1:1) W !?4,*7,"NOT POSSIBLE...Applicant is not Married." K X Q
"RTN","DGLOCK2",66,0)
 Q
"RTN","DGLOCK2",67,0)
AAC1 ;Agency/Country Screen
"RTN","DGLOCK2",68,0)
 S DGAAC=$S($D(^DPT(DFN,.36)):$S($D(^DIC(8,+$P(^DPT(DFN,.36),U,1),0)):+$P(^(0),U,4),1:""),1:""),DGAAC(1)=$S('$D(^DPT(DFN,"VET")):"",^("VET")'="N":"",DGAAC=4:"A",DGAAC=5:"C",1:"")
"RTN","DGLOCK2",69,0)
 Q
"RTN","DGLOCK2",70,0)
AAC D AAC1 S DIC("S")="I $P(^(0),U,4)=DGAAC(1)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X Q
"RTN","DGLOCK2",71,0)
 ;
"RTN","DGLOCK2",72,0)
DOL I $S(X']"":1,X'["*":1,1:0) S:X["$" X=+$P(X,"$",2) G DOL2
"RTN","DGLOCK2",73,0)
DOL1 I $L(X),"$*"[$E(X) S X=$E(X,2,999) G DOL1
"RTN","DGLOCK2",74,0)
 Q:'+X  S X=+X,X=X*12
"RTN","DGLOCK2",75,0)
DOL2 S:X["." X=+$P(X,".",1)_"."_$E($P(X,".",2)_"00",1,2) W "  ($",X,")" Q
"RTN","DGLOCK2",76,0)
TOTCHK(DFN) ;Returns 1 if Any of 4 'Received' YES/NO amounts =YES
"RTN","DGLOCK2",77,0)
 ;For A&A, HB, Pension, Disability
"RTN","DGLOCK2",78,0)
 S:'$D(DFN) DFN=DA
"RTN","DGLOCK2",79,0)
 Q ($P($G(^DPT(DFN,.362)),U,12,14)_$P($G(^DPT(DFN,.3)),U,11))["Y"
"RTN","DGLOCK2",80,0)
TOTCKMSG ;ERROR MESSAGE FOR ABOVE
"RTN","DGLOCK2",81,0)
 W !,?4,*7,"Must Receive A&A, HB, Pension, or Disability Benefits."
"RTN","DGLOCK2",82,0)
 Q
"RTN","DGLOCK2",83,0)
TOTCKDEL ;ERROR MESSAGE IF DELETE .36295
"RTN","DGLOCK2",84,0)
 S DFN=DA I $$TOTCHK(DFN) W !,?4,*7,"Delete by indicating receipt of A&A, HB, Pension, & Disability as 'NO'." K X
"RTN","DGLOCK2",85,0)
 Q
"RTN","DGNFUNC")
0^9^B434432
"RTN","DGNFUNC",1,0)
DGNFUNC ;BPCIOFO/CMC-NAME FORMAT FUNCTIONS ; 22 Jan 2002 10:39 AM
"RTN","DGNFUNC",2,0)
 ;;5.3;Registration;**149,244**;Aug 13, 1993
"RTN","DGNFUNC",3,0)
 ;
"RTN","DGNFUNC",4,0)
 ;This routine will contains functions for returning the name field
"RTN","DGNFUNC",5,0)
 ;in a variety of formats.  It will NOT update the Patient file,
"RTN","DGNFUNC",6,0)
 ;the name field.
"RTN","DGNFUNC",7,0)
 ;
"RTN","DGNFUNC",8,0)
FML(DFN) ;
"RTN","DGNFUNC",9,0)
 ;This function will return the name from the Patient file for the given
"RTN","DGNFUNC",10,0)
 ;DFN in the format of First Middle Last Suffix.
"RTN","DGNFUNC",11,0)
 ; Input:  DFN - ien of patient in Patient file
"RTN","DGNFUNC",12,0)
 ; Output: -1^error message OR 
"RTN","DGNFUNC",13,0)
 ;      Patient name formatted First Middle Last Suffix.
"RTN","DGNFUNC",14,0)
 ;
"RTN","DGNFUNC",15,0)
 I '$D(DFN) Q "-1^MISSING DFN"
"RTN","DGNFUNC",16,0)
 I $G(DFN)<0 Q "-1^Missing DFN"
"RTN","DGNFUNC",17,0)
 N DPTNAME
"RTN","DGNFUNC",18,0)
 S DPTNAME("IENS")=DFN_",",DPTNAME("FILE")=2,DPTNAME("FIELD")=.01
"RTN","DGNFUNC",19,0)
 Q $$NAMEFMT^XLFNAME(.DPTNAME,"G","")
"RTN","DGRP1")
0^31^B21084826
"RTN","DGRP1",1,0)
DGRP1 ;ALB/MRL - DEMOGRAPHIC DATA ; 5/5/03 2:51pm
"RTN","DGRP1",2,0)
 ;;5.3;Registration;**109,161,506,244**;Aug 13, 1993
"RTN","DGRP1",3,0)
 ;
"RTN","DGRP1",4,0)
EN S (DGRPS,DGRPW)=1 D H^DGRPU F I=0,.11,.121,.13,.15,.24,57 S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"")
"RTN","DGRP1",5,0)
 I $P(DGRP(.15),"^",2)]"" S Z="APPLICANT IS LISTED AS 'INELIGIBLE' FOR TREATMENT!",DGRPCM=1 D WW^DGRPV S DGRPCM=0
"RTN","DGRP1",6,0)
 I $P(DGRP(.15),"^",3)]"" S Z="APPLICANT IS LISTED AS 'MISSING'.  NOTIFY APPROPRIATE PERSONNEL!",DGRPCM=1 D WW^DGRPV S DGRPCM=0
"RTN","DGRP1",7,0)
 W ! S Z=1 D WW^DGRPV W "    Name: " S Z=$P(DGRP(0),"^",1),Z1=31 D WW1^DGRPV W "SS: " S X=$P(DGRP(0),"^",9),Z=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10),Z1=13 D WW1^DGRPV S Y=$P(DGRP(0),"^",3) X ^DD("DD") W "DOB: ",Y
"RTN","DGRP1",8,0)
 D GETNCAL  ;Display name component and alias information
"RTN","DGRP1",9,0)
 S Z=3,DGRPX=DGRP(0) D WW^DGRPV W " Remarks: ",$S($P(DGRPX,"^",10)]"":$E($P(DGRPX,"^",10),1,65),1:"NO REMARKS ENTERED FOR THIS PATIENT") S DGAD=.11,(DGA1,DGA2)=1 D A^DGRPU I $P(DGRP(.121),"^",9)="Y" S DGAD=.121,DGA1=1,DGA2=2 D A^DGRPU
"RTN","DGRP1",10,0)
 S Z=4 D WW^DGRPV W " Permanent Address: " S Z=" ",Z1=17
"RTN","DGRP1",11,0)
 D WW1^DGRPV S Z=5,DGRPW=0 D WW^DGRPV W " Temporary Address: "
"RTN","DGRP1",12,0)
 W !?11
"RTN","DGRP1",13,0)
 S Z1=40,Z=$S($D(DGA(1)):DGA(1),1:"NONE ON FILE") D WW1^DGRPV W $S($D(DGA(2)):DGA(2),1:"NO TEMPORARY ADDRESS")
"RTN","DGRP1",14,0)
 S I=2 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>50) !?11 W:'(I#2) ?51 W DGA(I)
"RTN","DGRP1",15,0)
 S DGCC=$S($D(^DIC(5,+$P(DGRP(.11),U,5),1,+$P(DGRP(.11),U,7),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU) W !?3,"County: ",DGCC K DGCC
"RTN","DGRP1",16,0)
 S DGCC=$S($P(DGRP(.121),U,9)'="Y":"NOT APPLICABLE",$D(^DIC(5,+$P(DGRP(.121),U,5),1,+$P(DGRP(.121),U,11),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU) W ?43,"County: ",DGCC K DGCC
"RTN","DGRP1",17,0)
 W !?4,"Phone: ",$S($P(DGRP(.13),U,1)]"":$P(DGRP(.13),U,1),1:DGRPU),?44,"Phone: ",$S($P(DGRP(.121),U,9)'="Y":"NOT APPLICABLE",$P(DGRP(.121),U,10)]"":$P(DGRP(.121),U,10),1:DGRPU)
"RTN","DGRP1",18,0)
 S X="NOT APPLICABLE" I $P(DGRP(.121),U,9)="Y" S Y=$P(DGRP(.121),U,7) X:Y]"" ^DD("DD") S X=$S(Y]"":Y,1:DGRPU)_"-",Y=$P(DGRP(.121),U,8) X:Y]"" ^DD("DD") S X=X_$S(Y]"":Y,1:DGRPU)
"RTN","DGRP1",19,0)
 W !?3,"Office: ",$S($P(DGRP(.13),U,2)]"":$P(DGRP(.13),U,2),1:DGRPU),?42,"From/To: ",X
"RTN","DGRP1",20,0)
 W !?1,"Bad Addr: ",$$EXTERNAL^DILFD(2,.121,"",$P(DGRP(.11),U,16))
"RTN","DGRP1",21,0)
 ;
"RTN","DGRP1",22,0)
 ; ***  Additional displays added for Pre-Registration
"RTN","DGRP1",23,0)
 I $G(DGPRFLG)=1 D
"RTN","DGRP1",24,0)
 . W !
"RTN","DGRP1",25,0)
 . N I,MIS1,X,X1,SA1,TP1,X2,X3,ES1
"RTN","DGRP1",26,0)
 . I $D(^DIA(2,"B",DFN)) S X="" F I=1:1 S X=$O(^DIA(2,"B",DFN,X)) Q:X<1  I $P(^DIA(2,X,0),U,3)=.05 S MIS1=$P(^DIA(2,X,0),U,2)
"RTN","DGRP1",27,0)
 . W:$D(MIS1)>0 !," [MARITAL STATUS CHANGED:] "_$$FMTE^XLFDT(MIS1,"5D")
"RTN","DGRP1",28,0)
 . I $D(^DIA(2,"B",DFN)) S X1="" F I=1:1 S X1=$O(^DIA(2,"B",DFN,X1)) Q:X1<1  S:$P(^DIA(2,X1,0),U,3)=.111 SA1=$P(^DIA(2,X1,0),U,2)
"RTN","DGRP1",29,0)
 . W:$D(SA1)>0 !," [STREET ADDRESS LAST CHANGED:] "_$$FMTE^XLFDT(SA1,"5D")
"RTN","DGRP1",30,0)
 . I $D(^DIA(2,"B",DFN)) S X2="" F I=1:1 S X2=$O(^DIA(2,"B",DFN,X2)) Q:X2<1  S:$P(^DIA(2,X2,0),U,3)=.131 TP1=$P(^DIA(2,X2,0),U,2)
"RTN","DGRP1",31,0)
 . W:$D(TP1)>0 !," [HOME PHONE NUMBER CHANGED:] "_$$FMTE^XLFDT(TP1,"5D")
"RTN","DGRP1",32,0)
 . I $D(^DIA(2,"B",DFN)) S X3="" F I=1:1 S X3=$O(^DIA(2,"B",DFN,X3)) Q:X3<1  S:$P(^DIA(2,X3,0),U,3)=.31115 ES1=$P(^DIA(2,X3,0),U,2)
"RTN","DGRP1",33,0)
 . W:$D(ES1)>0 !," [EMPLOYMENT STATUS CHANGED:] "_$$FMTE^XLFDT(ES1,"5D")
"RTN","DGRP1",34,0)
 . I $D(^DPT(DFN,.312,0)) S IN1=0 F  S IN1=$O(^DPT(DFN,.312,IN1)) Q:'IN1  S IN2=$P(^DPT(DFN,.312,IN1,0),U) S INN=$P(^DIC(36,IN2,0),U) D
"RTN","DGRP1",35,0)
 .. S IND=$P($G(^DPT(DFN,.312,IN1,1)),U) W !," [INSURANCE:] "_INN_"  DATE ENTERED: "_$S(IND]"":$$FMTE^XLFDT(IND,"5D"),1:"")
"RTN","DGRP1",36,0)
 .. I $P($G(^DPT(DFN,.312,IN1,1)),U,5) S INE=$P($G(^DPT(DFN,.312,IN1,1)),U,5) W " DATE EDITED: "_$S(INE]"":$$FMTE^XLFDT(INE,"5D"),1:"")
"RTN","DGRP1",37,0)
 ;
"RTN","DGRP1",38,0)
 G ^DGRPP
"RTN","DGRP1",39,0)
 ;
"RTN","DGRP1",40,0)
GETNCAL ;Get name component values
"RTN","DGRP1",41,0)
 N DGCOMP,DGNC,DGI,DGA,DGALIAS,DGX,DGRPW
"RTN","DGRP1",42,0)
 S DGNC="Family^Given^Middle^Prefix^Suffix^Degree"
"RTN","DGRP1",43,0)
 S DGCOMP=+$G(^DPT(DFN,"NAME"))_","
"RTN","DGRP1",44,0)
 I DGCOMP D GETS^DIQ(20,DGCOMP,"1:6",,"DGCOMP")
"RTN","DGRP1",45,0)
 ;Get alias values
"RTN","DGRP1",46,0)
 S DGA=0 F DGI=1:1:6 D  Q:'$D(DGALIAS(DGI))
"RTN","DGRP1",47,0)
A2 .S DGA=$O(^DPT(DFN,.01,DGA))
"RTN","DGRP1",48,0)
 .I 'DGA D:DGI=1  Q
"RTN","DGRP1",49,0)
 ..S DGALIAS(DGI)="< No alias entries on file >" Q
"RTN","DGRP1",50,0)
 .I DGI=6 S DGALIAS(DGI)="< More alias entries on file >" Q
"RTN","DGRP1",51,0)
 .S DGX=$G(^DPT(DFN,.01,DGA,0)) G:'$L(DGX) A2
"RTN","DGRP1",52,0)
 .S DGALIAS(DGI)=$P(DGX,U),DGX=$P(DGX,U,2)
"RTN","DGRP1",53,0)
 .I $L(DGX) D
"RTN","DGRP1",54,0)
 ..S DGX=" "_$E(DGX,1,3)_"-"_$E(DGX,4,5)_"-"_$E(DGX,6,9)
"RTN","DGRP1",55,0)
 ..S $E(DGALIAS(DGI),20)=DGX Q
"RTN","DGRP1",56,0)
 .S DGALIAS(DGI)=$E(DGALIAS(DGI),1,31)
"RTN","DGRP1",57,0)
 .Q
"RTN","DGRP1",58,0)
 ;Display name component and alias data
"RTN","DGRP1",59,0)
 F DGI=1:1:6 D
"RTN","DGRP1",60,0)
 .W !?5,$J($P(DGNC,U,DGI),6),": ",$E($G(DGCOMP(20,DGCOMP,DGI)),1,$S(DGI=1:23,1:27))
"RTN","DGRP1",61,0)
 .I DGI=1 S DGRPW=0,Z=2 W ?37 D WW^DGRPV W " Alias: "
"RTN","DGRP1",62,0)
 .W ?48,$G(DGALIAS(DGI))
"RTN","DGRP1",63,0)
 .Q
"RTN","DGRP1",64,0)
 Q
"RTN","DGRPDD1")
0^44^B29245960
"RTN","DGRPDD1",1,0)
DGRPDD1 ;ALB/JDS - INPUT SYNTAX CHECKS - FORMERLY DGINP ; 25 SEP 84  14:20
"RTN","DGRPDD1",2,0)
 ;;5.3;Registration;**72,136,244**;AUG 13, 1993
"RTN","DGRPDD1",3,0)
 ;
"RTN","DGRPDD1",4,0)
 ;  NOTE: THIS USED TO BE NAMED 'DGINP'
"RTN","DGRPDD1",5,0)
 ;                               -----
"RTN","DGRPDD1",6,0)
 ;
"RTN","DGRPDD1",7,0)
INPUT ; from 7.5 node to massage input before input transform
"RTN","DGRPDD1",8,0)
 I X?.N1"/"1N.ANP D BCDFN^RTDPA Q  ; check for RT label scan
"RTN","DGRPDD1",9,0)
 Q
"RTN","DGRPDD1",10,0)
 ;
"RTN","DGRPDD1",11,0)
SSN I X'?.AN F %=1:1:$L(X) I $E(X,%)?1P S X=$E(X,0,%-1)_$E(X,%+1,999),%=%-1
"RTN","DGRPDD1",12,0)
 I X="P"!(X="p") D PSEU S X=L K L W:'$D(ZTQUEUED) "  ",X G SSNQ
"RTN","DGRPDD1",13,0)
 I X["P",'$D(DPTZNV) D PSEU I X'=L K X,L W:'$D(ZTQUEUED) *7,"  Invalid pseudo SSN.",!,"Type 'P' for the valid one" Q
"RTN","DGRPDD1",14,0)
 I X["P",$D(DPTZNV) D PSEU I X'=L S X=L W:'$D(ZTQUEUED) !!,$C(7),"Pseudo SSN adjusted to match edited name value ==> ",X,!
"RTN","DGRPDD1",15,0)
 G SSNQ:X["P" I X'?9N K X Q
"RTN","DGRPDD1",16,0)
 I $G(DIUTIL)'="VERIFY FIELDS" S DGY=$O(^DPT("SSN",X,0)) I DGY>0,$D(^DPT(DGY,0)) W:'$D(ZTQUEUED) *7,"  Already used by patient '",$P(^(0),"^",1),"'." K X Q
"RTN","DGRPDD1",17,0)
 I $D(X) S L=$E(X,1) I L=9 W:'$D(ZTQUEUED) *7,!,"  The SSN must not begin with 9." K X Q
"RTN","DGRPDD1",18,0)
 I $D(X),$E(X,1,3)="000",$E(X,1,5)'="00000" W:'$D(ZTQUEUED) *7,!,"   First three digits cannot be zeros." K X Q
"RTN","DGRPDD1",19,0)
 I $D(X) S L=$E(X,1,3) I (L>699)&(L<729) W:'$D(ZTQUEUED) !,*7,!,"      Note: This is a RR Retirement SSN."
"RTN","DGRPDD1",20,0)
 I $D(X),$E(X,1,5)="00000" W:'$D(ZTQUEUED) !,*7,!,"      Note: This is a Test Patient SSN."
"RTN","DGRPDD1",21,0)
SSNQ D:$D(X) S^DGPATN Q
"RTN","DGRPDD1",22,0)
C I $D(X) S L=$P(^DPT(DA,0),U,9) I $L(L)=9,X'=L S Y=L_"00" D COL
"RTN","DGRPDD1",23,0)
 K L Q:'$D(X)  Q:X'?11N!(X["P")  S L=0 F Y=0:0 S Y=$O(^DPT("BS",$E(X,6,9),Y)) Q:Y'>0  I Y-DA,$D(^DPT(Y,0)),$P(^(0),U,9)=$E(X,1,9) S L=1 Q
"RTN","DGRPDD1",24,0)
 I L W:'$D(ZTQUEUED) " Collateral of ",$P(^DPT(Y,0),U,1) K L Q
"RTN","DGRPDD1",25,0)
 W:'$D(ZTQUEUED) !,"Must have same SSN to be collateral" K X,L Q
"RTN","DGRPDD1",26,0)
PSEU I $D(DPTIDS(.03)),$D(DPTX) S NAM=DPTX,DOB=DPTIDS(.03)
"RTN","DGRPDD1",27,0)
 E  S L=^DPT(DA,0),DOB=$P(L,"^",3),NAM=$P(L,"^",1)
"RTN","DGRPDD1",28,0)
 S L1=$E($P(NAM," ",2),1),L3=$E(NAM,1),NAM=$P(NAM,",",2),L2=$E(NAM,1)
"RTN","DGRPDD1",29,0)
 S Z=L1 D CON S L1=Z,Z=L2 D CON S L2=Z,Z=L3 D CON S L3=Z S L=L2_L1_L3_$E(DOB,4,7)_$E(DOB,2,3)_"P"
"RTN","DGRPDD1",30,0)
 K L1,L2,L3,Z,DOB,NAM Q
"RTN","DGRPDD1",31,0)
COL S Y=$O(^DPT("SSN",Y)) Q:$E(Y,1,9)'=L  I $L(Y)=11,$E(Y,1,9)=L S Z=$O(^(Y,0)) I $D(^DPT(Z,0)) W:'$D(ZTQUEUED) !,"Has collateral ",$P(^(0),U,1)," be sure to change SSN" K Z G COL
"RTN","DGRPDD1",32,0)
 Q
"RTN","DGRPDD1",33,0)
CON S Z=$A(Z)-65\3+1 S:Z<0 Z=0 Q
"RTN","DGRPDD1",34,0)
 ;
"RTN","DGRPDD1",35,0)
CAT S L=^DPT(DA,0),DOB=+$P(L,"^",3),AGE=DT-DOB\10000,X1=^DIC(45.82,+Y,0),EDB=+$P(X1,U,4),LDB=+$P(X1,U,5),EAG=+$P(X1,U,6)
"RTN","DGRPDD1",36,0)
 I EDB>0,DOB<EDB W:'$D(ZTQUEUED) !!,"The date of birth is too early for the selected category of beneficiary",!,"Make another selection or correct the date of birth.",!!,*7 K X G CATQ
"RTN","DGRPDD1",37,0)
 I LDB>0,DOB>LDB W:'$D(ZTQUEUED) !!,"The date of birth is too late for the selected category of beneficiary.",!,"Make another selection or correct the date of birth.",!!,*7 K X G CATQ
"RTN","DGRPDD1",38,0)
 I EAG>0,AGE<EAG W:'$D(ZTQUEUED) !!,"The patient's age is too young for the selected category of beneficiary.",!,"Make another selection or correct the date of birth.",!!,*7 K X G CATQ
"RTN","DGRPDD1",39,0)
CATQ K EAG,AGE,DOB,LDB,EDB,X1 Q
"RTN","DGRPDD1",40,0)
 ;
"RTN","DGRPDD1",41,0)
VIET Q
"RTN","DGRPDD1",42,0)
POS S L=^DPT(DA,0),Y=+$P(L,"^",3) I X-Y\10000<15 X ^DD("DD") W:'$D(ZTQUEUED) !!,"This service entry date would make the patient too young for service.",!,"DOB ",Y,!,*7 K X G POSQ
"RTN","DGRPDD1",43,0)
 G POSQ:SD1=1!'$D(^DPT(DA,.32)) S L1=^(.32) I $P(L1,"^",SD1-1*5+1)="" W:'$D(ZTQUEUED) !?5,"Previous service entry date is not on file",*7 G POSQ
"RTN","DGRPDD1",44,0)
 S Y=$P(L1,U,6) I SD1=2,X'<Y X ^DD("DD") W:'$D(ZTQUEUED) !!,"This service entry date must be before than the first service entry date ",Y,!!,*7 K X G POSQ
"RTN","DGRPDD1",45,0)
 S Y=$P(L1,U,11) I SD1=3,X'<Y X ^DD("DD") W:'$D(ZTQUEUED) !!,"This service entry date must be less than the second service entry date ",Y,!!,*7 K X G POSQ
"RTN","DGRPDD1",46,0)
POSQ K L1,L,DOB,AGE,SD1 Q
"RTN","DGRPDD1",47,0)
 ;
"RTN","DGRPDD1",48,0)
PS S L1=$S($D(^DPT(DA,.32)):^(.32),1:"") G PS2:SD1=2,PS3:SD1=3 S Y=$P(L1,U,6) I X'>Y X ^DD("DD") W:'$D(ZTQUEUED) !!,"The service separation date must be after the entry date ",Y,!!,*7 K X G PSQ
"RTN","DGRPDD1",49,0)
 ;
"RTN","DGRPDD1",50,0)
 G PSQ
"RTN","DGRPDD1",51,0)
PS2 S Y=$P(L1,U,11) I X'>Y X ^DD("DD") W:'$D(ZTQUEUED) !!,"The service separation date must be after the service entry date ",Y,!!,*7 K X G PSQ
"RTN","DGRPDD1",52,0)
 S Y=$P(L1,U,6) I Y,X'<Y X ^DD("DD") W:'$D(ZTQUEUED) !!,"This service separation date must be before the next service entry date ",Y,!!,*7 K X G PSQ
"RTN","DGRPDD1",53,0)
 G PSQ
"RTN","DGRPDD1",54,0)
PS3 S Y=$P(L1,U,16) I X'>Y X ^DD("DD") W:'$D(ZTQUEUED) !!,"The service separation date must be after the service entry date ",Y,!!,*7 K X G PSQ
"RTN","DGRPDD1",55,0)
 S Y=$P(L1,U,11) I X'<Y X ^DD("DD") W:'$D(ZTQUEUED) !!,"The service separation date must be before the next service entry date ",Y,!!,*7 K X G POSQ
"RTN","DGRPDD1",56,0)
PSQ K L1,SD1 Q
"RTN","DGRPDD1",57,0)
CAT1 S DDA=DA,DA=+^DGPT(DA,0) D CAT S DA=DDA K DDA Q
"RTN","DGRPE")
0^32^B42615132
"RTN","DGRPE",1,0)
DGRPE ;ALB/MRL - REGISTRATIONS EDITS ; 5/5/03 2:51pm
"RTN","DGRPE",2,0)
 ;;5.3;Registration;**32,114,139,169,175,247,190,343,397,342,454,415,489,506,244**;Aug 13, 1993
"RTN","DGRPE",3,0)
 ;
"RTN","DGRPE",4,0)
 ;DGDR contains a string of edits; edit=screen*10+item #
"RTN","DGRPE",5,0)
 ;
"RTN","DGRPE",6,0)
 ;line tag screen*10+item*1000 = continuation line
"RTN","DGRPE",7,0)
 ;
"RTN","DGRPE",8,0)
 I DGRPS=8 D ^DGRPEIS,Q Q  ; family demographic edit...not conventional!!  :)
"RTN","DGRPE",9,0)
 I DGRPS=9 D EDIT9^DGRPEIS2,Q Q  ; income screening data ($$$)
"RTN","DGRPE",10,0)
 I DGRPS=5,DGDR["501," D
"RTN","DGRPE",11,0)
 .I $G(DGPRFLG) D PREG^IBCNBME(DFN) Q
"RTN","DGRPE",12,0)
 .D REG^IBCNBME(DFN)
"RTN","DGRPE",13,0)
 .Q
"RTN","DGRPE",14,0)
 ;-- Tricare screen #15
"RTN","DGRPE",15,0)
 I DGRPS=15 D EDIT^DGRP15,Q Q
"RTN","DGRPE",16,0)
 ;
"RTN","DGRPE",17,0)
 N DGPH,DGPHFLG
"RTN","DGRPE",18,0)
 K DR S (DA,Y)=DFN,DIE="^DPT(",DR="",DGDRS="DR",DGCT=0 G ^DGRPE1:DGRPS>6
"RTN","DGRPE",19,0)
 F I=1:1 S J=$P(DGDR,",",I) Q:J=""  F J1=J,J*1000,J*1000+1,J*1000+2 Q:'$T(@J1)  S DGDRD=$P($T(@J1),";;",2) D S
"RTN","DGRPE",20,0)
 D ^DIE
"RTN","DGRPE",21,0)
 I $G(DGPHFLG)>0 D EDITPH1^DGRPLE()
"RTN","DGRPE",22,0)
Q K DA,DIE,DR,DGCT,DGDR,DGDRD,DGDRS,DGRPADI,I,J,J1
"RTN","DGRPE",23,0)
 Q
"RTN","DGRPE",24,0)
S I $L(@DGDRS)+$L(DGDRD)<241 S @DGDRS=@DGDRS_DGDRD Q
"RTN","DGRPE",25,0)
 S DGCT=DGCT+1,DGDRS="DR(1,2,"_DGCT_")",@DGDRS=DGDRD Q
"RTN","DGRPE",26,0)
 Q
"RTN","DGRPE",27,0)
101 ;;K DG20NAME;.01;.01///^S X=$$NCEDIT^DPTNAME(DFN,,.DG20NAME);.09;.03;
"RTN","DGRPE",28,0)
102 ;;1;
"RTN","DGRPE",29,0)
103 ;;.091;
"RTN","DGRPE",30,0)
104 ;;S DIE("NO^")="OUTOK";.111;S:X="" Y="@1112";.112;S:X="" Y="@1112";.113;@1112;S EASZIPLK=1;.1112;K EASDO2;.114;S:'$$KEY^DGREGDD1(DUZ,DA) Y=.131;.115;.117;.131;.132;.121;K DIE("NO^");
"RTN","DGRPE",31,0)
105 ;;.12105//NO;S:X="N" Y="@15" S:X="Y" DIE("NO^")="";.1217;I X']"" W !?4,$C(7),"But I need a Start Date for this Temporary Address." S Y=.12105;.1218;.1211;I X']"" W !?4,$C(7),"But I need at least one line of a Temporary address." S Y=.12105;
"RTN","DGRPE",32,0)
111 ;;.14105//NO;S:X="N" Y="@15" S:X="Y" DIE("NO^")="";.1417;I X']"" W !?4,$C(7),"But I need a Start Date." S Y=.14105;.1418;D DR111^DGRPE;.141;I '$P($$CAACT^DGRPCADD(DFN),U,2) W !?4,"But I need at least one active category." S Y=.14105;
"RTN","DGRPE",33,0)
111000 ;;K DR(2,2.141);.1411;I X']"" W !?4,$C(7),"I need at least one line of Address." S Y=.14105;.1412;S:X']"" Y=.1414;.1413;.1414;.1415;.1416;Q;.14111;@15;K DIE("NO^");
"RTN","DGRPE",34,0)
109 ;;S DIE("NO^")="OUTOK";.111;S:X="" Y="@1112";.112;S:X="" Y="@1112";.113;@1112;S EASZIPLK=1;.1112;K EASDO2;.114;S:'$$KEY^DGREGDD1(DUZ,DA) Y=.131;.115;.117;.131;.132;.121;.02;D DR109^DGRPE;6;2;K DR(2,2.02),DR(2,2.06);.05;.08;K DIE("NO^");
"RTN","DGRPE",35,0)
105000 ;;.1212;S:X']"" Y=.1214;.1213:.1215;.12112;Q;.12111;.1219;@15;K DIE("NO^");
"RTN","DGRPE",36,0)
201 ;;.02;.05;.08;.092;.093;.2401:.2403;57.4//NOT APPLICABLE;
"RTN","DGRPE",37,0)
202 ;;1010.15//NO;S:X'="Y" Y="@22";S DIE("NO^")="";1010.152;I X']"" W !?4,*7,"But I need to know where you were treated most recently." S Y=1010.15;1010.151;1010.154;S:X']"" Y="@22";1010.153;@22;K DIE("NO^");
"RTN","DGRPE",38,0)
203 ;;D DR203^DGRPE;6ETHNICITY;2RACE;K DR(2,2.02),DR(2,2.06);
"RTN","DGRPE",39,0)
301 ;;.211;S:X']"" Y="@31";.212;.2125//NO;I X="Y" S DGADD=".21" D AD^DGRPE S Y=.21011;.213;S:X']"" Y=.216;.214;S:X']"" Y=.216;.215:.217;.2207;.219;.21011;@31;
"RTN","DGRPE",40,0)
302 ;;.2191;S:X']"" Y="@32";.2192;.21925//NO;I X="Y" S DGADD=".211" D AD^DGRPE S Y=.211011;
"RTN","DGRPE",41,0)
302000 ;;.2193;S:X']"" Y=.2196;.2194;S:X']"" Y=.2196;.2195:.2197;.2203;.2199;.211011;@32;
"RTN","DGRPE",42,0)
303 ;;N DGX1,DGX2;I '$L($P($G(^DPT(DFN,.21)),U)) S Y="@33";.3305//NO;I X="Y" S Y="@34",DGX1=1;@33;S:$D(^DPT(DFN,.22)) $P(^(.22),U,1)=$P(^(.22),U,7);.331;S:X']"" DGX1=2,Y="@34";.332;@34;
"RTN","DGRPE",43,0)
303000 ;;S:$G(DGX1) Y="@341";.333;S:X']"" Y=.336;.334;S:X']"" Y=.336;.335:.337;.2201;.339;.33011;S DGX1=2;@341;
"RTN","DGRPE",44,0)
303001 ;;S:$G(DGX1)=2 Y="@35";S DGX2=$G(^DPT(DA,.21));.331///^S X=$P(DGX2,U);.332///^S X=$P(DGX2,U,2);.333///^S X=$P(DGX2,U,3);.334///^S X=$P(DGX2,U,4);@35;
"RTN","DGRPE",45,0)
303002 ;;S:$G(DGX1)=2 Y="@351";.335///^S X=$P(DGX2,U,5);.336///^S X=$P(DGX2,U,6);.337///^S X=$P(DGX2,U,7);.338///^S X=$P(DGX2,U,8);.339///^S X=$P(DGX2,U,9);.33011///^S X=$P(DGX2,U,11);@351;K DGX1,DGX2;
"RTN","DGRPE",46,0)
304 ;;.3311;S:X']"" Y="@36";.3312;.3313;S:X']"" Y=.3316;.3314;S:X']"" Y=.3316;.3315:.3317;.2204;.3319;.331011;@36;        
"RTN","DGRPE",47,0)
305 ;;N DGX1,DGX2;I '$L($P($G(^DPT(DFN,.21)),U)) S Y="@37";.3405//NO;I X="Y" S DGX1=1,Y="@371";@37;S:$D(^DPT(DFN,.22)) $P(^(.22),U,2)=$P(^(.22),U,7);.341;S:X']"" DGX1=2,Y="@371";.342;@371;
"RTN","DGRPE",48,0)
305000 ;;S:$G(DGX1) Y="@38";.343;S:X']"" Y=.346;.344;S:X']"" Y=.346;.345:.347;.2202;.349;.34011;S DGX1=2;@38;
"RTN","DGRPE",49,0)
305001 ;;S:$G(DGX1)=2 Y="@381";S DGX2=$G(^DPT(DA,.21));.341///^S X=$P(DGX2,U);.342///^S X=$P(DGX2,U,2);.343///^S X=$P(DGX2,U,3);.344///^S X=$P(DGX2,U,4);@381
"RTN","DGRPE",50,0)
305002 ;;S:$G(DGX1)=2 Y="@39";.345///^S X=$P(DGX2,U,5);.346///^S X=$P(DGX2,U,6);.347///^S X=$P(DGX2,U,7);.348///^S X=$P(DGX2,U,8);.349///^S X=$P(DGX2,U,9);.34011///^S X=$P(DGX2,U,11);@39;K DGX1,DGX2;
"RTN","DGRPE",51,0)
401 ;;.07;.31115;I $S(X']"":1,X=3:1,X=9:1,1:0) S Y="@41";.3111;S:X']"" Y="@41";.3113;S:X']"" Y=.3116;.3114;S:X']"" Y=.3116;.3115:.3117;.2205;.3119;@41;
"RTN","DGRPE",52,0)
402 ;;.2514;.2515;I $S(X']"":1,X=3:1,X=9:1,1:0) S Y="@42";.251;S:X']"" Y="@42";.252;S:X']"" Y=.255;.253;S:X']"" Y=.255;.254:.256;.2206;.258;@42;
"RTN","DGRPE",53,0)
501 ;;
"RTN","DGRPE",54,0)
502 ;;.381;.382///NOW;
"RTN","DGRPE",55,0)
503 ;;.383;
"RTN","DGRPE",56,0)
601 ;;.325;S:X']"" Y="@61";.328;.326;.327;.324;.3285//NO;S:X'="Y" Y="@61";.3291;S:X']"" Y="@61";.3294;.3292;.3293;.329;.32945//NO;S:X'="Y" Y="@61";.3296;S:X']"" Y="@61";.3299;.3297;.3298;.3295;@61;
"RTN","DGRPE",57,0)
602 ;;.525//NO;S:X'="Y" Y="@62";.526:.528;@62;
"RTN","DGRPE",58,0)
603 ;;.5291//NO;S:X'="Y" Y="@63";.5292:.5294;@63;
"RTN","DGRPE",59,0)
604 ;;.32101//NO;S:X'="Y" Y="@64";.32104;.32105;@64;
"RTN","DGRPE",60,0)
605 ;;.32102//NO;S:X'="Y" Y="@65";.32107;.32109;.3211;.3213;@65;
"RTN","DGRPE",61,0)
606 ;;.32103//NO;S:X'="Y" Y="@66";.3212;.32111;@66;
"RTN","DGRPE",62,0)
607 ;;.3221//NO;S:X'="Y" Y="@67";.3222;Q;.3223;@67;
"RTN","DGRPE",63,0)
608 ;;.3224//NO;S:X'="Y" Y="@68";.3225;Q;.3226;@68;
"RTN","DGRPE",64,0)
609 ;;.3227//NO;S:X'="Y" Y="@69";.3228;Q;.3229;@69;
"RTN","DGRPE",65,0)
610 ;;.32201//NO;S:X'="Y" Y="@610";.322011;Q;.322012;@610;
"RTN","DGRPE",66,0)
611 ;;.322016//NO;S:X'="Y" Y="@611";.322017;Q;.322018;@611;
"RTN","DGRPE",67,0)
612 ;;.322013//NO;S:X'="Y" Y="@612";.322014;Q;.322015;@612;
"RTN","DGRPE",68,0)
613 ;;.362;
"RTN","DGRPE",69,0)
614 ;;.368//NO;.369//NO;I $S('$D(^DPT(DA,.36)):1,$P(^(.36),U,8)="Y"!($P(^(.36),U,9)="Y"):0,1:1) S Y="@614";.37;@614;
"RTN","DGRPE",70,0)
615 ;;.322019//NO;S:X'="Y" Y="@615";.32202;Q;.322021;@615;
"RTN","DGRPE",71,0)
616 ;;S DGPHFLG=0;.531;S:X'="Y" DGX=X,Y="@616";.532///^S X="PENDING";S Y="@6161";@616;S:DGX'="N" Y="@6162";.533///^S X="VAMC";@6161;S DGPHFLG=1;.535///^S X=$$DIV^DGRPLE();@6162;
"RTN","DGRPE",72,0)
617 ;;D REG^DGNTQ(DFN);
"RTN","DGRPE",73,0)
AD N DGZ4,DGPC
"RTN","DGRPE",74,0)
 S X=$S($D(^DPT(DA,.11)):^(.11),1:""),DGZ4=$P(X,U,12),DGPHONE=$S($D(^(.13)):$P(^(.13),U,1),1:""),Y=$S($D(^(DGADD)):^(DGADD),1:""),^(DGADD)=$P(Y,U,1)_U_$P(Y,U,2)_U_$P(X,U,1,6)_U_DGPHONE_U_$P(Y,U,10)
"RTN","DGRPE",75,0)
 I DGZ4 S DGPC=$S((DGADD=.33):1,(DGADD=.34):2,(DGADD=.211):3,(DGADD=.331):4,(DGADD=.311):5,(DGADD=.25):6,(DGADD=.21):7,1:0) S:DGPC $P(^DPT(DFN,.22),U,DGPC)=DGZ4
"RTN","DGRPE",76,0)
 K DGADD,DGPHONE Q
"RTN","DGRPE",77,0)
DR109 ;Drop through (use same logic as DR203)
"RTN","DGRPE",78,0)
DR203 S DR(2,2.02)=".01RACE;I $P($G(^DIC(10.3,+$P($G(^DPT(DA(1),.02,DA,0)),""^"",2),0)),""^"",2)=""S"" S Y=""@2031"";.02;@2031;"
"RTN","DGRPE",79,0)
 S DR(2,2.06)=".01ETHNICITY;I $P($G(^DIC(10.3,+$P($G(^DPT(DA(1),.06,DA,0)),""^"",2),0)),""^"",2)=""S"" S Y=""@2032"";.02;@2032;"
"RTN","DGRPE",80,0)
 Q
"RTN","DGRPE",81,0)
DR111 ;Set DR string for Confidential Address categories
"RTN","DGRPE",82,0)
 S DR(2,2.141)=".01;1//YES;"
"RTN","DGRPE",83,0)
 Q
"RTN","DPTLK")
0^4^B56336496
"RTN","DPTLK",1,0)
DPTLK ;ALB/RMO,RTK - MAS Patient Look-up Main Routine ; 25 Jan 2002  2:20 PM
"RTN","DPTLK",2,0)
 ;;5.3;Registration;**32,72,93,73,136,157,197,232,265,277,223,327,244**;Aug 13, 1993
"RTN","DPTLK",3,0)
 ;
"RTN","DPTLK",4,0)
 ; mods made for magstripe read 12/96 - JFP
"RTN","DPTLK",5,0)
 ;
"RTN","DPTLK",6,0)
 ;Optional input: DPTNOFZY='1' to suppress fuzzy lookups implemented
"RTN","DPTLK",7,0)
 ;                by patch DG*5.3*244
"RTN","DPTLK",8,0)
 ;
"RTN","DPTLK",9,0)
EN ; -- Entry point
"RTN","DPTLK",10,0)
 K DPTX,DPTDFN,DPTSAVX I $D(DIC(0)) G QK:DIC(0)["I"!(DIC(0)'["A"&('$D(X)))
"RTN","DPTLK",11,0)
 I '$D(^DD("VERSION")) W !!?3,"Unable to proceed. Fileman version node ^DD(""VERSION"") is undefined." G QK
"RTN","DPTLK",12,0)
 I '$D(^DPT(0))!(^DD("VERSION")<17.2) W !!?3,"Unable to proceed. ",$S('$D(^DPT(0)):"0th node of ^DPT missing",^DD("VERSION")<17.2:"Fileman version must be at least 17.2",1:""),"." G QK
"RTN","DPTLK",13,0)
EN2 K DO,DUOUT,DTOUT S U="^",DIC="^DPT(",DIC(0)=$S($D(DIC(0)):DIC(0),1:"AELMQ") S:DIC(0)'["A" (DPTX,DPTSAVX)=X
"RTN","DPTLK",14,0)
 S DPTSZ=1000 I $D(^DD("OS"))#2 S DPTSZ=$S(+$P(^DD("OS",^("OS"),0),U,2):$P(^(0),U,2),1:DPTSZ)
"RTN","DPTLK",15,0)
 ;
"RTN","DPTLK",16,0)
ASKPAT ; -- Prompt for patient
"RTN","DPTLK",17,0)
 I DIC(0)["A" D   G QK:'$T!($E(DPTX)["^")!(DPTX="")
"RTN","DPTLK",18,0)
 .K DTOUT,DUOUT
"RTN","DPTLK",19,0)
 .W !,$S($D(DIC("A")):DIC("A"),1:"Select PATIENT NAME: ") W:$D(DIC("B")) DIC("B"),"// "
"RTN","DPTLK",20,0)
 .R X:DTIME
"RTN","DPTLK",21,0)
 .S DPTX=X S:'$T DTOUT=1 S:$T&(DPTX="")&($D(DIC("B"))) DPTX=DIC("B") S:DPTX["^" DUOUT=1
"RTN","DPTLK",22,0)
 ; -- Check for the IATA magnetic stripe input
"RTN","DPTLK",23,0)
 N MAG,GCHK
"RTN","DPTLK",24,0)
 S MAG=0
"RTN","DPTLK",25,0)
 I $E(DPTX)="%"!($E(DPTX)=";"),DPTX["?" S MAG=1,(X,DPTX)=$$IATA(DPTX)
"RTN","DPTLK",26,0)
 ;
"RTN","DPTLK",27,0)
CHKPAT ; -- Custom Patient Lookup
"RTN","DPTLK",28,0)
 D DO^DIC1
"RTN","DPTLK",29,0)
 S DIC("W")=$S($D(DIC("W")):DIC("W"),1:"")
"RTN","DPTLK",30,0)
 K DPTIFNS,DPTS,DPTSEL
"RTN","DPTLK",31,0)
 S DPTCNT=0
"RTN","DPTLK",32,0)
 ; -- Check input for format an length
"RTN","DPTLK",33,0)
 G CHKDFN:DPTX?1A!(DPTX'?.ANP)!($L(DPTX)>30)
"RTN","DPTLK",34,0)
 ; -- Check for null response or abort
"RTN","DPTLK",35,0)
 I DPTX=""!(DPTX["^") G ASKPAT:DIC(0)["A",QK
"RTN","DPTLK",36,0)
 ; -- Check for question mark
"RTN","DPTLK",37,0)
 I DPTX["?" D  G ASKPAT:DIC(0)["A",QK
"RTN","DPTLK",38,0)
 .S D="B"
"RTN","DPTLK",39,0)
 .S DZ=$S(DPTX?1"?":"",1:"??")
"RTN","DPTLK",40,0)
 .G CHKPAT1:DZ="??"
"RTN","DPTLK",41,0)
 .N %
"RTN","DPTLK",42,0)
 .W !,?1,"Answer with PATIENT NAME, or SOCIAL SECURITY NUMBER, or last 4 digits",!,?4,"of SOCIAL SECURITY NUMBER, or first initial of"
"RTN","DPTLK",43,0)
 .W " last name with last",!,?4,"4 digits of SOCIAL SECURITY NUMBER"
"RTN","DPTLK",44,0)
 .W !,?1,"Do you want the entire ",+$P($G(^DPT(0)),"^",4),"-Entry PATIENT List" S %=0 D YN^DICN
"RTN","DPTLK",45,0)
 .Q:%'=1
"RTN","DPTLK",46,0)
 .S DZ="??"
"RTN","DPTLK",47,0)
CHKPAT1 .S X=DPTX
"RTN","DPTLK",48,0)
 .D DQ^DICQ
"RTN","DPTLK",49,0)
 ; -- Check for space bar, return
"RTN","DPTLK",50,0)
 I DPTX=" " D  G CHKDFN
"RTN","DPTLK",51,0)
 .S Y=$S('($D(DUZ)#2):-1,$D(^DISV(DUZ,"^DPT(")):^("^DPT("),1:-1)
"RTN","DPTLK",52,0)
 .D SETDPT^DPTLK1:Y>0
"RTN","DPTLK",53,0)
 .S DPTDFN=$S($D(DPTS(Y)):Y,1:-1)
"RTN","DPTLK",54,0)
 ; -- Check for DFN look up
"RTN","DPTLK",55,0)
 I $E(DPTX)="`" D  G CHKDFN
"RTN","DPTLK",56,0)
 .S Y=$S($D(^DPT(+$P(DPTX,"`",2),0)):+$P(DPTX,"`",2),1:-1)
"RTN","DPTLK",57,0)
 .D SETDPT^DPTLK1:Y>0
"RTN","DPTLK",58,0)
 .S DPTDFN=$S($D(DPTS(Y)):Y,1:-1)
"RTN","DPTLK",59,0)
 ; -- Puts input in correct format
"RTN","DPTLK",60,0)
 G CHKDFN:DPTX=""
"RTN","DPTLK",61,0)
 ; -- Force new entry
"RTN","DPTLK",62,0)
 I $E(DPTX)="""",$E(DPTX,$L(DPTX))="""" G NOPAT
"RTN","DPTLK",63,0)
 ; -- Check for index lookups
"RTN","DPTLK",64,0)
 D ^DPTLK1 G QK:$D(DTOUT)!($D(DUOUT)&(DIC(0)'["A")),ASKPAT:$D(DUOUT),CHKPAT:DPTDFN<0,CHKDFN:DPTDFN>0 I DIC(0)["N",$D(^DPT(DPTX,0)) S Y=X D SETDPT^DPTLK1 S DPTDFN=$S($D(DPTS(Y)):Y,1:-1) G CHKDFN
"RTN","DPTLK",65,0)
MAG ; -- No patient found, check for mag stripe input, create stub
"RTN","DPTLK",66,0)
 I 'MAG G NOPAT
"RTN","DPTLK",67,0)
 ; -- Check for ADT option(s) only
"RTN","DPTLK",68,0)
 N DGOPT
"RTN","DPTLK",69,0)
 S DGOPT=$P($G(XQY0),"^",2)
"RTN","DPTLK",70,0)
 I DGOPT'="Load/Edit Patient Data",DGOPT'="Register a Patient" D  G EN2
"RTN","DPTLK",71,0)
 .W !,"    ...Patient not in database, use ADT options to load patient" D Q1
"RTN","DPTLK",72,0)
 ; -- Prompt for creation of stub
"RTN","DPTLK",73,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Patient not found...Create stub entry: "
"RTN","DPTLK",74,0)
 S GCHK=$D(^TMP("DGVIC"))
"RTN","DPTLK",75,0)
 D ^DIR
"RTN","DPTLK",76,0)
 K DIR
"RTN","DPTLK",77,0)
 I 'Y D Q1 G EN2
"RTN","DPTLK",78,0)
 ; -- Parse IATA fields
"RTN","DPTLK",79,0)
 D FIELDS(IATA)
"RTN","DPTLK",80,0)
 ; -- Check for Duplicates
"RTN","DPTLK",81,0)
 D EP2^DPTLK3
"RTN","DPTLK",82,0)
 I DPTDFN<0 D Q1 G EN2
"RTN","DPTLK",83,0)
 ; -- Creates Stub entry in patient file
"RTN","DPTLK",84,0)
 S Y=$$FILE^DPTLK4(DGFLDS)
"RTN","DPTLK",85,0)
 I $P(Y,"^",3)'=1 W !,"Could not add patient to patient file" D QK1 Q
"RTN","DPTLK",86,0)
 D QK1
"RTN","DPTLK",87,0)
 Q
"RTN","DPTLK",88,0)
 ;
"RTN","DPTLK",89,0)
NOPAT ; -- No patient found, ask to add new
"RTN","DPTLK",90,0)
 I DIC(0)["L" D ^DPTLK2 S Y=DPTDFN G ASKPAT:DIC(0)["A"&(Y<0)&('$G(DTOUT)),QK1
"RTN","DPTLK",91,0)
 ;
"RTN","DPTLK",92,0)
CHKDFN ; -- 
"RTN","DPTLK",93,0)
 S:'$D(DPTDFN) DPTDFN=-1 I DPTDFN'>0!('$D(DPTS(+DPTDFN))) W:DIC(0)["Q" *7," ??" G ASKPAT:DIC(0)["A",QK
"RTN","DPTLK",94,0)
 I DIC(0)["E" D  W $S('$D(DPTSEL)&('$D(DIVP)):$P(DPTS(DPTDFN),U,2)_"  "_$P(DPTS(DPTDFN),U)_"  ",$D(^DPT(DPTDFN,0)):"  "_$P(^(0),U)_"  ",1:"") S Y=DPTDFN X:$D(^DPT(DPTDFN,0)) "N DDS X DIC(""W"")"
"RTN","DPTLK",95,0)
 .I $D(DDS) D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY
"RTN","DPTLK",96,0)
 ;
"RTN","DPTLK",97,0)
 ; check for other patients in "BS5" xref on Patient file
"RTN","DPTLK",98,0)
 I '$G(DICR),DPTDFN>0,DIC(0)["E",$$BS5^DPTLK5(+DPTDFN) D  G ASKPAT:DIC(0)["A"&(%'=1),QK:DPTDFN<0
"RTN","DPTLK",99,0)
 .N DPTZERO,DPTLSNME,DPTSSN S DPTZERO=$G(^DPT(+DPTDFN,0)),DPTLSNME=$P($P(DPTZERO,U),","),DPTSSN=$E($P(DPTZERO,U,9),6,9)
"RTN","DPTLK",100,0)
 .W $C(7),!!,"There is more than one patient whose last name is '",DPTLSNME,"' and"
"RTN","DPTLK",101,0)
 .W !,"whose social security number ends with '",DPTSSN,"'."
"RTN","DPTLK",102,0)
 .W !,"Are you sure you wish to continue (Y/N)" S %=0 D YN^DICN
"RTN","DPTLK",103,0)
 .I %'=1 S DPTDFN=-1
"RTN","DPTLK",104,0)
 ;
"RTN","DPTLK",105,0)
 I '$G(DICR),DPTDFN>0 S Y=DPTDFN D ^DGSEC S DPTDFN=Y G ASKPAT:DIC(0)["A"&(DPTDFN<0),QK:DPTDFN<0
"RTN","DPTLK",106,0)
 S DPTX=DPTX_$P(DPTS(DPTDFN),U,2),DPTDFN=DPTDFN_U_$P(^DPT(DPTDFN,0),U)
"RTN","DPTLK",107,0)
 ;
"RTN","DPTLK",108,0)
Q ; -- 
"RTN","DPTLK",109,0)
 S Y=$S('$D(DPTDFN):-1,'$D(DPTS(+DPTDFN)):-1,1:DPTDFN),X=$S($D(DPTX)&(+Y>0):DPTX,$D(DPTSAVX):DPTSAVX,$D(DPTX):DPTX,1:"")
"RTN","DPTLK",110,0)
 I Y>0 S:DIC(0)'["F" ^DISV($S($D(DUZ)#2:DUZ,1:0),"^DPT(")=+Y S:DIC(0)["Z" Y(0)=^DPT(+Y,0),Y(0,0)=$P(^(0),U,1)
"RTN","DPTLK",111,0)
 I DIC(0)["E",$P($G(^DPT(+Y,0)),U,21) W *7,!,"Warning : You have selected a test patient."
"RTN","DPTLK",112,0)
 ;Display enrollment information
"RTN","DPTLK",113,0)
 I Y>0,DIC(0)["E" D ENR
"RTN","DPTLK",114,0)
 ;
"RTN","DPTLK",115,0)
 ; check whether to display Means Test Required message
"RTN","DPTLK",116,0)
 D
"RTN","DPTLK",117,0)
 .N DPTDIV
"RTN","DPTLK",118,0)
 .I '$G(DUZ(2)) Q
"RTN","DPTLK",119,0)
 .I Y>0,DIC(0)["E" S DPTDIV=$$DMT^DPTLK5(+Y,DUZ(2)) I DPTDIV D
"RTN","DPTLK",120,0)
 ..W $C(7),!!,"MEANS TEST REQUIRED"
"RTN","DPTLK",121,0)
 ..W !,?3,$P($G(^DG(40.8,DPTDIV,"MT")),U,2)
"RTN","DPTLK",122,0)
 ..H 2
"RTN","DPTLK",123,0)
 ;
"RTN","DPTLK",124,0)
Q1 ; -- Clean up variables
"RTN","DPTLK",125,0)
 K D,DIC("W"),DO,DPTCNT,DPTDFN,DPTIFNS,DPTIX,DPTS
"RTN","DPTLK",126,0)
 K DPTSAVX,DPTSEL,DPTSZ,DPTX
"RTN","DPTLK",127,0)
 ;
"RTN","DPTLK",128,0)
 K:$D(IATA) IATA
"RTN","DPTLK",129,0)
 K:$D(DGFLDS) @DGFLDS,DGFLDS
"RTN","DPTLK",130,0)
 Q
"RTN","DPTLK",131,0)
 ;
"RTN","DPTLK",132,0)
QK K DPTNOFZY G Q
"RTN","DPTLK",133,0)
 ;
"RTN","DPTLK",134,0)
QK1 K DPTNOFZY G Q1
"RTN","DPTLK",135,0)
 ;
"RTN","DPTLK",136,0)
IX ; --
"RTN","DPTLK",137,0)
 I $D(D),$D(^DD(2,0,"IX",D)),($E(D)'="A") S DPTIX=D
"RTN","DPTLK",138,0)
 G DPTLK
"RTN","DPTLK",139,0)
 ;
"RTN","DPTLK",140,0)
IATA(X) ; --
"RTN","DPTLK",141,0)
 ;This function pulls off ssn from the IATA track
"RTN","DPTLK",142,0)
 ;
"RTN","DPTLK",143,0)
 ;Input:  X   -  what was read in
"RTN","DPTLK",144,0)
 ;Output: SSN -  social security number
"RTN","DPTLK",145,0)
 ;          Q -  quit
"RTN","DPTLK",146,0)
 ;
"RTN","DPTLK",147,0)
 ; Track            Start Sent     End Sent      Field Separator
"RTN","DPTLK",148,0)
 ; -----            ----------     --------      ---------------
"RTN","DPTLK",149,0)
 ;  IATA (alphanum)      %             ?          {   (Note: VA used ^)
"RTN","DPTLK",150,0)
 ;  ABA (numeric)        ;             ?          =    
"RTN","DPTLK",151,0)
 ;
"RTN","DPTLK",152,0)
 ;N IATA
"RTN","DPTLK",153,0)
 S (IATA)=""
"RTN","DPTLK",154,0)
 I $E(X)'="%" Q X ; no start sentinel
"RTN","DPTLK",155,0)
 I X'["?" Q "Q"
"RTN","DPTLK",156,0)
 ; -- Extract data from track
"RTN","DPTLK",157,0)
 S IATA=$$TRACK(X,"%","?")
"RTN","DPTLK",158,0)
 ; -- checks for no data
"RTN","DPTLK",159,0)
 I IATA="" Q "Q"
"RTN","DPTLK",160,0)
 ; -- Returns SSN
"RTN","DPTLK",161,0)
 I IATA'="" Q $P(IATA,"^")
"RTN","DPTLK",162,0)
 Q "Q"
"RTN","DPTLK",163,0)
 ;
"RTN","DPTLK",164,0)
TRACK(X,START,END) ; find track where start/end are sentinels
"RTN","DPTLK",165,0)
 ;
"RTN","DPTLK",166,0)
 Q $P($P($G(X),START,2),END,1)
"RTN","DPTLK",167,0)
 ;
"RTN","DPTLK",168,0)
FIELDS(IATA) ; -- Sets fields
"RTN","DPTLK",169,0)
 Q:'$D(IATA)
"RTN","DPTLK",170,0)
 N CNT,FIELD
"RTN","DPTLK",171,0)
 S DGFLDS="^TMP(""DGVIC"","_$J_")",CNT=1
"RTN","DPTLK",172,0)
 K @DGFLDS
"RTN","DPTLK",173,0)
 F  S FIELD=$P($G(IATA),"^",CNT)  Q:FIELD=""  D
"RTN","DPTLK",174,0)
 .S @DGFLDS@(CNT)=FIELD
"RTN","DPTLK",175,0)
 .S CNT=CNT+1
"RTN","DPTLK",176,0)
 ; -- Define fields for duplicate checker
"RTN","DPTLK",177,0)
 S DPTX=$G(@DGFLDS@(2)) ;NAME
"RTN","DPTLK",178,0)
 S DPTIDS(.03)=$G(@DGFLDS@(3)) ;DOB
"RTN","DPTLK",179,0)
 S DPTIDS(.09)=$G(@DGFLDS@(1)) ;SSN
"RTN","DPTLK",180,0)
 Q
"RTN","DPTLK",181,0)
ENR ;Display Enrollment information after patient selection
"RTN","DPTLK",182,0)
 N DGENCAT,DGENDFN,DGENR,DGEGTIEN,DGEGT
"RTN","DPTLK",183,0)
 I '$$GET^DGENA($$FINDCUR^DGENA(+DPTDFN),.DGENR) Q
"RTN","DPTLK",184,0)
 S DGENCAT=$$CATEGORY^DGENA4(+DPTDFN)
"RTN","DPTLK",185,0)
 S DGENCAT=$$EXTERNAL^DILFD(27.15,.02,"",DGENCAT)
"RTN","DPTLK",186,0)
 W !?1,"Enrollment Priority: ",$S($G(DGENR("PRIORITY")):$$EXT^DGENU("PRIORITY",DGENR("PRIORITY")),1:""),$S($G(DGENR("SUBGRP"))="":"",1:$$EXT^DGENU("SUBGRP",$G(DGENR("SUBGRP"))))
"RTN","DPTLK",187,0)
 W ?33,"Category: ",DGENCAT
"RTN","DPTLK",188,0)
 W ?57,"End Date: ",$S($G(DGENR("END")):$$FMTE^XLFDT(DGENR("END"),"5DZ"),1:""),!
"RTN","DPTLK",189,0)
 ;If patient is NOT ELIGIBLE, display Enrollment Status (Ineligible Project Phase I)
"RTN","DPTLK",190,0)
 I $G(DGENR("STATUS"))=10!($G(DGENR("STATUS"))=19)!($G(DGENR("STATUS"))=20) D
"RTN","DPTLK",191,0)
 . W ?1,"Enrollment Status: ",$S($G(DGENR("STATUS")):$$EXT^DGENU("STATUS",DGENR("STATUS")),1:"") ;H 5
"RTN","DPTLK",192,0)
 ;Get Enrollment Group Threshold Priority and Subgroup
"RTN","DPTLK",193,0)
 S DGEGTIEN=$$FINDCUR^DGENEGT
"RTN","DPTLK",194,0)
 S DGEGT=$$GET^DGENEGT(DGEGTIEN,.DGEGT)
"RTN","DPTLK",195,0)
 Q:$G(DGENR("PRIORITY"))=""!($G(DGEGT("PRIORITY"))="")
"RTN","DPTLK",196,0)
 ;Compare Patient's Enrollment Priority to Enrollment Group Threshold
"RTN","DPTLK",197,0)
 I '$$ABOVE^DGENEGT1(DGENR("PRIORITY"),$G(DGENR("SUBGRP")),DGEGT("PRIORITY"),DGEGT("SUBGRP")) D
"RTN","DPTLK",198,0)
 .N X,IORVOFF,IORVON
"RTN","DPTLK",199,0)
 .S X="IORVOFF;IORVON"
"RTN","DPTLK",200,0)
 .D ENDR^%ZISS
"RTN","DPTLK",201,0)
 .W !?32 W:$D(IORVON) IORVON  W "*** WARNING ***" W:$D(IORVOFF) IORVOFF
"RTN","DPTLK",202,0)
 .I DGENR("END")'="" W !?14 W:$D(IORVON) IORVON W "*** PATIENT ENROLLMENT END",$S(DT>+DGENR("END"):"ED",1:"S")," EFFECTIVE ",$$FMTE^XLFDT(DGENR("END"),"5DZ")," ***" W:$D(IORVOFF) IORVOFF Q
"RTN","DPTLK",203,0)
 .W !?5 W:$D(IORVON) IORVON W "*** PATIENT ENROLLMENT ENDING.  ENROLLMENT END DATE IS NOT KNOWN. ***" W:$D(IORVOFF) IORVOFF
"RTN","DPTLK",204,0)
 Q
"RTN","DPTLK",205,0)
 ;
"RTN","DPTLK1")
0^23^B33226052
"RTN","DPTLK1",1,0)
DPTLK1 ;ALB/RMO - MAS Patient Look-up Check Cross-References ; 29 Jan 2002 12:15 AM
"RTN","DPTLK1",2,0)
 ;;5.3;Registration;**32,50,197,249,317,391,244**;Aug 13, 1993
"RTN","DPTLK1",3,0)
FIND ;Cross reference patient lookup
"RTN","DPTLK1",4,0)
 ;Optional input: DPTNOFZY='1' to suppress fuzzy lookups implemented
"RTN","DPTLK1",5,0)
 ;                by patch DG*5.3*244
"RTN","DPTLK1",6,0)
 ;
"RTN","DPTLK1",7,0)
 N DDCOMA,DPTXOLD,DPTOUT,DPTOVAL
"RTN","DPTLK1",8,0)
 S (DPTXOLD,DPTX)=$$UCASE(DPTX)
"RTN","DPTLK1",9,0)
 I DPTX?1A.E1","1.A.E S DPTXOLD=DPTX,DDCOMA="I $E($P($G(DPTVAL),"","",2),1,"_$L($P(DPTX,",",2))_")="""_$TR($P(DPTX,",",2),"""")_"""",DPTX=$P(DPTX,",")
"RTN","DPTLK1",10,0)
 K DPTREFS S DPTREFS=$S(DIC(0)'["M":"B,NOP",DPTX?1A1N.N:$S($L(DPTX)<6:"BS5,CN,RM",1:"CN,RM"),DPTX?4N!(DPTX?4N1A):"BS,SSN,CN,RM",DPTX?9N.E:"SSN,CN,RM",1:"")
"RTN","DPTLK1",11,0)
 S:DPTREFS="" DPTREFS=$S(DPTX?1N.N:$S($L(DPTX)<5:"CN,RM,BS,SSN",1:"CN,RM,SSN"),DPTX?1N.E:"CN,RM",1:"B,NOP,CN,RM") S:$D(DPTIX) DPTREFS=DPTIX_","_DPTREFS
"RTN","DPTLK1",12,0)
 S DPTBEG=1,(DPTDFN,DPTNUM,DPTOUT)=0
"RTN","DPTLK1",13,0)
 F DPTLP=1:1 S DPTREF=$P(DPTREFS,",",DPTLP) Q:DPTREF=""!(DPTDFN)  D  Q:DPTDFN!DPTOUT
"RTN","DPTLK1",14,0)
 .S DPTVAL=DPTX
"RTN","DPTLK1",15,0)
 .I DPTREF="NOP",'$G(DPTNOFZY) S DPTVAL=$$FORMAT^DPTNAME(DPTVAL,2,30,1,0,,1) Q:'$L(DPTVAL)
"RTN","DPTLK1",16,0)
 .D LOOK(DPTVAL)
"RTN","DPTLK1",17,0)
 .I DPTREF="B",'$G(DPTNOFZY) S DPTVAL=$$FORMAT^DPTNAME(DPTX,2,30,1,0,,1) D:DPTVAL'=DPTX LOOK(DPTVAL)
"RTN","DPTLK1",18,0)
 .Q
"RTN","DPTLK1",19,0)
 I 'DPTDFN S:DPTCNT=1&($D(DPTIFNS(DPTCNT))) DPTDFN=+DPTIFNS(DPTCNT) S DPT("NOPRT^")="" D PRTDPT:'DPTDFN&(DPTCNT>DPTNUM)&(DIC(0)["E") K DPT("NOPRT^") I 'DPTDFN,$D(DPTSEL),DPTSEL="" S DPTX="",DPTDFN=-1
"RTN","DPTLK1",20,0)
 I DPTDFN'>0,$L($G(DPTXOLD)) I DPTX=$P(DPTXOLD,",") S DPTX=DPTXOLD
"RTN","DPTLK1",21,0)
 I DPTDFN>0,$D(DPTXOLD) S DPTX=DPTXOLD
"RTN","DPTLK1",22,0)
 ;
"RTN","DPTLK1",23,0)
Q K DPTBEG,DPTIFN,DPTIFNS,DPTLP,DPTLP1,DPTNUM,DPTREF,DPTREFS,DPTVAL
"RTN","DPTLK1",24,0)
 K DPTOVAL,DPTOUT,DPTXOLD,^TMP("DPTLK",$J)
"RTN","DPTLK1",25,0)
 Q
"RTN","DPTLK1",26,0)
 ;
"RTN","DPTLK1",27,0)
LOOK(DPTVAL) ;Look for x-ref matches
"RTN","DPTLK1",28,0)
 ;Input: DPTVAL=lookup seed value
"RTN","DPTLK1",29,0)
 I $L(DPTVAL),$D(^DPT(DPTREF,DPTVAL)) D CHKIFN Q:DPTDFN!DPTOUT
"RTN","DPTLK1",30,0)
 I $L(DPTVAL),'($D(^DPT(DPTREF,DPTVAL))&(DIC(0)["O"))&(DIC(0)'["X") D CHKVAL
"RTN","DPTLK1",31,0)
 Q
"RTN","DPTLK1",32,0)
 ;
"RTN","DPTLK1",33,0)
CHKVAL S DPTOVAL=DPTVAL
"RTN","DPTLK1",34,0)
 N DPTSEED S DPTSEED=DPTVAL
"RTN","DPTLK1",35,0)
 I DPTREF="SSN",(DPTVAL?9N1"p") D  Q
"RTN","DPTLK1",36,0)
 .S DPTVAL=$E(DPTVAL,1,9)_"P" D CHKIFN
"RTN","DPTLK1",37,0)
 .Q
"RTN","DPTLK1",38,0)
 I DPTREF="SSN",(DPTVAL?2.9N) D  Q
"RTN","DPTLK1",39,0)
 .S DPTVAL=$E(DPTVAL_"0000000",1,9)
"RTN","DPTLK1",40,0)
 .D CV1(DPTVAL),CHKIFN
"RTN","DPTLK1",41,0)
 .S DPTVAL=DPTVAL_"P" D CV1(DPTVAL),CHKIFN
"RTN","DPTLK1",42,0)
 .Q
"RTN","DPTLK1",43,0)
 D CV1(DPTVAL)
"RTN","DPTLK1",44,0)
 I DPTREF="CN"!(DPTREF="RM"),DPTVAL=+DPTVAL,'$D(^DPT(DPTREF,DPTVAL)) D  Q
"RTN","DPTLK1",45,0)
 .S DPTVAL=$O(^DPT(DPTREF,DPTVAL_" "),-1)
"RTN","DPTLK1",46,0)
 .D CV1(DPTVAL)
"RTN","DPTLK1",47,0)
 .Q
"RTN","DPTLK1",48,0)
 Q
"RTN","DPTLK1",49,0)
 ;
"RTN","DPTLK1",50,0)
CV1(DPTVAL) ;Look for input value matches
"RTN","DPTLK1",51,0)
 I $L(DPTVAL) F DPTLP1=0:0 S DPTVAL=$O(^DPT(DPTREF,DPTVAL)) Q:DPTVAL=""!(DPTDFN)!($P(DPTVAL,DPTSEED)'="")  D CHKIFN
"RTN","DPTLK1",52,0)
 Q
"RTN","DPTLK1",53,0)
 ;
"RTN","DPTLK1",54,0)
CHKIFN F DPTIFN=0:0 S DPTIFN=$O(^DPT(DPTREF,DPTVAL,DPTIFN)) Q:'DPTIFN!(DPTDFN)!DPTOUT  S Y=DPTIFN D SETDPT I $S<DPTSZ F I=1:1:DPTNUM-7 S J=$S($D(DPTIFNS(I)):+DPTIFNS(I),1:0) K DPTIFNS(I),DPTS(J) S DPTBEG=I
"RTN","DPTLK1",55,0)
 Q
"RTN","DPTLK1",56,0)
 ;
"RTN","DPTLK1",57,0)
SETDPT Q:($D(DPTS(Y))&($G(DPTREF)'="B"))!'$D(^DPT(Y,0))
"RTN","DPTLK1",58,0)
 N DPTNVAL I '$D(DPTOVAL) N DPTOVAL S DPTOVAL=DPTX
"RTN","DPTLK1",59,0)
 I 1 S X=DPTOVAL X:$D(DIC("S")) DIC("S") Q:'$T  X:($D(DO("SCR"))) DO("SCR") Q:'$T  X:$D(DDCOMA) DDCOMA Q:'$T
"RTN","DPTLK1",60,0)
 K:$G(DPTCNT)<1 ^TMP("DPTLK",$J)
"RTN","DPTLK1",61,0)
 S DPTS(Y)=$S('$D(DPTREF):$P(^DPT(Y,0),U),1:$P(^DPT(Y,0),U))_U_$S($D(DPTVAL):$E(DPTVAL,($L(DPTOVAL)+1),$L(DPTVAL)),1:"")
"RTN","DPTLK1",62,0)
 S DPTNVAL=$P(^DPT(Y,0),U)_U_$S($G(DPTREF)="NOP":$P(^DPT(Y,0),U),$D(DPTVAL):DPTVAL,1:"")
"RTN","DPTLK1",63,0)
 Q:$D(^TMP("DPTLK",$J,Y,DPTNVAL))
"RTN","DPTLK1",64,0)
 S DPTCNT=DPTCNT+1,^TMP("DPTLK",$J,Y,DPTNVAL)="",DPTIFNS(DPTCNT)=Y_U_DPTNVAL
"RTN","DPTLK1",65,0)
 I $D(DPTLARR) D  Q
"RTN","DPTLK1",66,0)
 .I DPTLMAX,DPTCNT>DPTLMAX D  Q
"RTN","DPTLK1",67,0)
 ..S @DPTLARR@(DPTCNT)="ADDITIONAL MATCHES FOUND BUT NOT RETURNED"
"RTN","DPTLK1",68,0)
 ..S DPTOUT=1
"RTN","DPTLK1",69,0)
 ..Q
"RTN","DPTLK1",70,0)
 .S @DPTLARR@(DPTCNT)=DPTIFNS(DPTCNT)_U_$$SSN(Y)_U_$$DOB(Y)
"RTN","DPTLK1",71,0)
 .Q
"RTN","DPTLK1",72,0)
 I '(DPTCNT#5),DIC(0)["E" D PRTDPT
"RTN","DPTLK1",73,0)
 Q
"RTN","DPTLK1",74,0)
 ;
"RTN","DPTLK1",75,0)
PRTDPT I $D(DDS) D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY S X=0 X ^%ZOSF("RM")
"RTN","DPTLK1",76,0)
 N DPTP1,DPTP2
"RTN","DPTLK1",77,0)
 F DPTNUM=DPTNUM+1:1:DPTCNT Q:DPTOUT  S DPTIFN=+DPTIFNS(DPTNUM) D
"RTN","DPTLK1",78,0)
 .W:'$D(DDS) !
"RTN","DPTLK1",79,0)
 .S DPTP2=$P(DPTIFNS(DPTNUM),U,3)
"RTN","DPTLK1",80,0)
 .S DPTP1=$P(DPTIFNS(DPTNUM),U,2)
"RTN","DPTLK1",81,0)
 .W ?3,DPTNUM,?$X+(4-$L(DPTNUM))
"RTN","DPTLK1",82,0)
 .; write the xref value
"RTN","DPTLK1",83,0)
 .W DPTP2_"  "
"RTN","DPTLK1",84,0)
 .; write patient name if diff than xref value
"RTN","DPTLK1",85,0)
 .I DPTP1'=DPTP2 W DPTP1
"RTN","DPTLK1",86,0)
 .S Y=DPTIFN X:$D(^DPT(DPTIFN,0)) "N DDS X DIC(""W"")" I $D(DDS) S DY=DY+1,DX=0 X DDXY S $X=0
"RTN","DPTLK1",87,0)
 I '$D(DPT("NOPRT^")) W:'$D(DDS) ! W "ENTER '^' TO STOP, OR "
"RTN","DPTLK1",88,0)
 W:'$D(DDS) ! W "CHOOSE ",DPTBEG,"-",DPTNUM,": " R X:DTIME S DPTSEL=X D  Q:DPTSEL=""!$D(DTOUT)!$D(DUOUT)
"RTN","DPTLK1",89,0)
 .S:'$T DPTSEL=$S($D(DPTOVAL):DPTOVAL,$D(DPTVAL):DPTVAL,$D(DPTX):DPTX,$D(DPTXOLD):DPTXOLD,1:""),(DPTOUT,DTOUT)=1
"RTN","DPTLK1",90,0)
 .S:X="^" (DPTOUT,DUOUT)=1
"RTN","DPTLK1",91,0)
 S DPTDFN=$S(DPTSEL'?.ANP!($L(DPTSEL)>30):-1,'$D(DPTIFNS(DPTSEL)):-1,$D(DPTS(+DPTIFNS(DPTSEL))):+DPTIFNS(DPTSEL),1:-1),DPTX=$S(DPTDFN<0:DPTSEL,1:DPTX)
"RTN","DPTLK1",92,0)
 S:DPTDFN=-1 DPTXOLD=DPTSEL
"RTN","DPTLK1",93,0)
 Q
"RTN","DPTLK1",94,0)
 ;
"RTN","DPTLK1",95,0)
LIST(DPTX,DPTLMAX,DPTLARR) ;Silent lookup list
"RTN","DPTLK1",96,0)
 ;Input: DPTX=lookup value (name, SSN, room, ward, DFN or 
"RTN","DPTLK1",97,0)
 ;             "space_return").
"RTN","DPTLK1",98,0)
 ;       DPTLMAX=maximum number of matches to return (optional), this
"RTN","DPTLK1",99,0)
 ;               parameter has no effect if DFN or "space_return"
"RTN","DPTLK1",100,0)
 ;               lookup methods are used.
"RTN","DPTLK1",101,0)
 ;       DPTLARR=name of array to return list of matches, this should
"RTN","DPTLK1",102,0)
 ;               be a global if DPTLMAX is a large value or unspecified
"RTN","DPTLK1",103,0)
 ;               This array is returned in the format:
"RTN","DPTLK1",104,0)
 ;               @DPTLARR@(n)=DFN^patient_name^xref_lookup_match_value^
"RTN","DPTLK1",105,0)
 ;                            SSN^Date_of_Birth
"RTN","DPTLK1",106,0)
 ;               If more matches exist than the maximum to be returned
"RTN","DPTLK1",107,0)
 ;               as specified by DPTLMAX, the @DPTLARR@(DPTLMAX+1) node
"RTN","DPTLK1",108,0)
 ;               will be defined = "ADDITIONAL MATCHES FOUND BUT NOT 
"RTN","DPTLK1",109,0)
 ;               RETURNED".
"RTN","DPTLK1",110,0)
 ;               The calling program has the responsibility to kill
"RTN","DPTLK1",111,0)
 ;               @DPTLARR prior to calling this entry point.
"RTN","DPTLK1",112,0)
 ;Output: number of matches and array named by DPTLARR.
"RTN","DPTLK1",113,0)
 ;
"RTN","DPTLK1",114,0)
 N X,Y,DPTCNT,DIC,DPTSZ,DPTDFN,DPTIFNS,DPTS
"RTN","DPTLK1",115,0)
 S DPTCNT=0,DIC(0)="M",DPTSZ=1000 S:$G(DPTLMAX)<1 DPTLMAX=0
"RTN","DPTLK1",116,0)
 ;Check for "space_return" or DFN lookup
"RTN","DPTLK1",117,0)
 I DPTX=" "!($E(DPTX)="`") D  Q DPTCNT
"RTN","DPTLK1",118,0)
 .I DPTX=" " S Y=$S('($D(DUZ)#2):-1,$D(^DISV(DUZ,"^DPT(")):^("^DPT("),1:-1)
"RTN","DPTLK1",119,0)
 .I $E(DPTX)="`" S Y=$S($D(^DPT(+$P(DPTX,"`",2),0)):+$P(DPTX,"`",2),1:-1)
"RTN","DPTLK1",120,0)
 .Q:Y<1  Q:'$D(^DPT(Y,0))  D SETDPT S DPTCNT=1
"RTN","DPTLK1",121,0)
 .Q
"RTN","DPTLK1",122,0)
 D FIND
"RTN","DPTLK1",123,0)
 Q $S(DPTLMAX&(DPTCNT>DPTLMAX):DPTLMAX,1:DPTCNT)
"RTN","DPTLK1",124,0)
 ;
"RTN","DPTLK1",125,0)
UCASE(DGX) ;Uppercase lookup value
"RTN","DPTLK1",126,0)
 ;Input: DGX=lookup value
"RTN","DPTLK1",127,0)
 ;Output: transformed DGX
"RTN","DPTLK1",128,0)
 N DGI,DGY,DGZ S DGZ=DGX,DGX=""
"RTN","DPTLK1",129,0)
 F DGI=1:1:$L(DGZ) S DGY=$E(DGZ,DGI) D
"RTN","DPTLK1",130,0)
 .S:DGY?1L DGY=$C($A(DGY)-32)
"RTN","DPTLK1",131,0)
 .S DGX=DGX_DGY
"RTN","DPTLK1",132,0)
 Q DGX
"RTN","DPTLK1",133,0)
 ;        
"RTN","DPTLK1",134,0)
SSN(DFN) ;do not show ssn identifier for patient
"RTN","DPTLK1",135,0)
 ; input DFN = ien in file #2 [required]
"RTN","DPTLK1",136,0)
 ; output SSN = nnnnnnnnn
"RTN","DPTLK1",137,0)
 ;
"RTN","DPTLK1",138,0)
 N SSN
"RTN","DPTLK1",139,0)
 S SSN="",DFN=+DFN
"RTN","DPTLK1",140,0)
 I DFN>0 D
"RTN","DPTLK1",141,0)
 .I $$SCREEN(DFN) S SSN="*SENSITIVE*" Q
"RTN","DPTLK1",142,0)
 .S SSN=$P($G(^DPT(DFN,0)),U,9)
"RTN","DPTLK1",143,0)
 Q SSN
"RTN","DPTLK1",144,0)
 ;
"RTN","DPTLK1",145,0)
DOB(DFN,DGYR) ;do not show dob identifier for patient
"RTN","DPTLK1",146,0)
 ; input DFN = ien in file #2  [required]
"RTN","DPTLK1",147,0)
 ;       DGYR = 0/1  [optional]
"RTN","DPTLK1",148,0)
 ;              where 0 returns 4-digit year (default)
"RTN","DPTLK1",149,0)
 ;                    1 returns 2-digit year
"RTN","DPTLK1",150,0)
 ;                    2 returns File manager date
"RTN","DPTLK1",151,0)
 ; output DOB = mm/dd/yyyy (default)
"RTN","DPTLK1",152,0)
 ;            = mm/dd/yy, if DGYR=1
"RTN","DPTLK1",153,0)
 ;            = yyymmdd, if DGYR=2
"RTN","DPTLK1",154,0)
 N B,DOB,YEAR
"RTN","DPTLK1",155,0)
 S DOB="",DFN=+DFN,DGYR=+$G(DGYR)
"RTN","DPTLK1",156,0)
 I DFN>0 D
"RTN","DPTLK1",157,0)
 .I $$SCREEN(DFN) S DOB="*SENSITIVE*" Q
"RTN","DPTLK1",158,0)
 .S B=$P($G(^DPT(DFN,0)),U,3)
"RTN","DPTLK1",159,0)
 .I DGYR'=2 D  Q
"RTN","DPTLK1",160,0)
 ..S YEAR=$S(DGYR=1:"2D",1:"5D")
"RTN","DPTLK1",161,0)
 ..S DOB=$$FMTE^XLFDT(B,YEAR)
"RTN","DPTLK1",162,0)
 .S DOB=B
"RTN","DPTLK1",163,0)
 Q DOB
"RTN","DPTLK1",164,0)
 ;
"RTN","DPTLK1",165,0)
SCREEN(DFN) ;Screening logic for SSN & DOB
"RTN","DPTLK1",166,0)
 ;Input  : DFN - Pointer to PATIENT file (#2)
"RTN","DPTLK1",167,0)
 ;Output : 1 - Apply screen
"RTN","DPTLK1",168,0)
 ;         0 - Don't apply screen
"RTN","DPTLK1",169,0)
 ;Notes  : Screen applied if patient is sensitive or an employee
"RTN","DPTLK1",170,0)
 ;
"RTN","DPTLK1",171,0)
 N DGTIME,DGT,DGA1,DG1,DGXFR0
"RTN","DPTLK1",172,0)
 ;Inpatient check - no longer used (kept for future reference)
"RTN","DPTLK1",173,0)
 ;D H^DGUTL S DGT=DGTIME D ^DGPMSTAT I DG1 Q 0
"RTN","DPTLK1",174,0)
 ;Sensitive - screen
"RTN","DPTLK1",175,0)
 I $P($G(^DGSL(38.1,DFN,0)),"^",2) Q 1
"RTN","DPTLK1",176,0)
 ;Employee - screen
"RTN","DPTLK1",177,0)
 I $$EMPL^DGSEC4(DFN) Q 1
"RTN","DPTLK1",178,0)
 ;Don't screen
"RTN","DPTLK1",179,0)
 Q 0
"RTN","DPTLK2")
0^6^B21030810
"RTN","DPTLK2",1,0)
DPTLK2 ;ALB/RMO - MAS Patient Look-up Add New Patient ; 25 Jan 2002  6:27 PM
"RTN","DPTLK2",2,0)
 ;;5.3;Registration;**32,197,214,244**;Aug 13, 1993
"RTN","DPTLK2",3,0)
 I $D(DDS) D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY
"RTN","DPTLK2",4,0)
 I '$D(DUZ(0)) W:DIC(0)["Q" !?3,*7,"Unable to Add Patient. Your Fileman Access Code is undefined." S DPTDFN=-1 G Q
"RTN","DPTLK2",5,0)
 I $S($D(DLAYGO):2\1-(DLAYGO\1),1:1),DUZ(0)'="@",$D(^DIC(2,0,"LAYGO")) F I=1:1 I DUZ(0)[$E(^("LAYGO"),I) Q:I'>$L(^("LAYGO"))  S DPTDFN=-1 W:DIC(0)["Q" *7," ??" G Q
"RTN","DPTLK2",6,0)
 N DG20NAME S DG20NAME=DPTX,DPTX=$$FORMAT^DPTNAME(.DG20NAME,3,30,,1)
"RTN","DPTLK2",7,0)
 S DPTX=$S($E(DPTX)[""""&($E(DPTX,$L(DPTX))[""""):$P(DPTX,"""",2),$E(DPTX)["""":$P(DPTX,"""",2),$E(DPTX,$L(DPTX))["""":$P(DPTX,"""",1),1:DPTX)
"RTN","DPTLK2",8,0)
 I $L(DPTX)<3!($L(DPTX)>30)!(DPTX?1P.E)!(DPTX'[",")!(DPTX'?1U.ANP) W:DIC(0)["Q" *7," ??" S DPTDFN=-1 G Q
"RTN","DPTLK2",9,0)
 K DPTLID I DIC(0)["E" D ASKADD D  G Q:DPTDFN<0 I '$D(DIC("DR")) D CHKID G Q:DPTDFN<0 D ^DPTLK3 G Q:DPTDFN<0 W !!?3,"...adding new patient"
"RTN","DPTLK2",10,0)
 .S:DPTDFN<1&('$D(DTOUT)) DUOUT=1
"RTN","DPTLK2",11,0)
 I $D(DPTLID),DIC(0)["E" W !!?3,"Please enter the following additional information:",!?3
"RTN","DPTLK2",12,0)
 S X=DPTX,DPT("NO^")=$G(DIE("NO^")) K DD,DO,DPTX N DPTZNV
"RTN","DPTLK2",13,0)
 S:$D(DPT("DR")) DIC("DR")="S DIE(""NO^"")=""BACK"";.01///^S (X,DPTZNV)=$$NCEDIT^DPTNAME(DA,1,.DG20NAME);"_DPT("DR")
"RTN","DPTLK2",14,0)
 D FILE^DICN K:$D(DPT("DR")) DIC("DR")
"RTN","DPTLK2",15,0)
 S DPTDFN=Y S:$L(DPT("NO^")) DIE("NO^")=DPT("NO^")
"RTN","DPTLK2",16,0)
 ;
"RTN","DPTLK2",17,0)
Q K DFN,DPT("DR"),DPTLID,DPTGID,DPTID,DPTID0,DPTIDS
"RTN","DPTLK2",18,0)
 Q
"RTN","DPTLK2",19,0)
 ;
"RTN","DPTLK2",20,0)
ASKADD I $D(DDS) I $Y>21 D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY
"RTN","DPTLK2",21,0)
 S Y=+$P(^DPT(0),U,4)+1 W !?3,*7,"ARE YOU ADDING ",$S(DPTX'?.N:"'"_DPTX_"' AS ",1:""),"A NEW PATIENT (THE ",Y,$S(Y#10=1&(Y#100-11):"ST",Y#10=2&(Y#100-12):"ND",Y#10=3&(Y#100-13):"RD",1:"TH"),")"
"RTN","DPTLK2",22,0)
 S %=2 D YN^DICN S DPTDFN=$S(%<0!(%=2):-1,%=1:1,1:0) I 'DPTDFN W !?6,"Enter 'YES' to add a new applicant, or 'NO' not to." G ASKADD
"RTN","DPTLK2",23,0)
 I %=1 S:$$CONF1^DPTNAME(DPTX)'=1 DPTDFN=-1
"RTN","DPTLK2",24,0)
 Q
"RTN","DPTLK2",25,0)
 ;
"RTN","DPTLK2",26,0)
CHKID K DFN S DPTDFN=1,DPTGID="^.02^.03^.09^391^1901^" F DPTID=0:0 S DPTID=$O(^DD(2,0,"ID",DPTID)) Q:'DPTID!(DPTDFN<0)  D CHKID1
"RTN","DPTLK2",27,0)
 Q
"RTN","DPTLK2",28,0)
 ;
"RTN","DPTLK2",29,0)
CHKID1 S DPT("DR")=$S('$D(DPT("DR")):DPTID,1:DPT("DR")_";"_DPTID) S:'$F(DPTGID,U_DPTID_U) DPTLID="" I $F(DPTGID,U_DPTID_U),$D(^DD(2,DPTID,0)) S DPTID0=^(0) D ASKID S:'$D(X) DPTDFN=-1
"RTN","DPTLK2",30,0)
 Q
"RTN","DPTLK2",31,0)
 ;
"RTN","DPTLK2",32,0)
ASKID N DGREC W !?3,"PATIENT ",$P(DPTID0,U),": " R X:DTIME D  I $D(DTOUT)!$G(DUOUT)!($G(DGREC)=1) W !?6,*7,"<'",DPTX,"'> DELETED" K X Q
"RTN","DPTLK2",33,0)
 .S:'$T DTOUT=U
"RTN","DPTLK2",34,0)
 .S:X="^" DUOUT=1
"RTN","DPTLK2",35,0)
 .I DPTID=.09 D
"RTN","DPTLK2",36,0)
 ..N DGNEWPT
"RTN","DPTLK2",37,0)
 ..S DGNEWPT=1
"RTN","DPTLK2",38,0)
 ..D REC^DGSEC
"RTN","DPTLK2",39,0)
 I X["^" W:$E(X)["^" !?6,*7,"Sorry, '^' not allowed!" W " ??" G ASKID
"RTN","DPTLK2",40,0)
 I X["?"!(X="") W:X="" *7," ??" D HLPID G ASKID
"RTN","DPTLK2",41,0)
 I $P(DPTID0,U,2)["S" F I=1:1 S Y=$P($P(DPTID0,U,3),";",I) K:Y="" X Q:Y=""  I $P(Y,":",1)=X!($E($P(Y,":",2),1,$L(X))=X) S X=$P(Y,":",1),DPTSET=$P(Y,":",2) Q
"RTN","DPTLK2",42,0)
 I $P(DPTID0,U,2)["P" D P1 G ASKID:Y'>0 S DPTIDS(DPTID)=X,DPT("DR")=DPT("DR")_"///"_X K DPTSET Q
"RTN","DPTLK2",43,0)
 X $P(DPTID0,U,5,99) I $D(X) W:$D(DPTSET) " ",DPTSET S DPTIDS(DPTID)=X,DPT("DR")=DPT("DR")_"///"_X K DPTSET Q
"RTN","DPTLK2",44,0)
 W:'$D(X)&($P(DPTID0,U,2)'["D") *7," ??" D HLPID G ASKID
"RTN","DPTLK2",45,0)
 ;
"RTN","DPTLK2",46,0)
HLPID W:$D(^DD(2,DPTID,.1)) !?5,^(.1) W:$D(^DD(2,DPTID,3)) !?5,^(3) I $D(X),X["?" F I=0:0 S I=$O(^DD(2,DPTID,21,I)) Q:'I!(I>3&(X?1"?"))  I $D(^(I,0)) W !?5,^(0) I I>2,X?1"?" W !?5,"..."
"RTN","DPTLK2",47,0)
 X:$D(^DD(2,DPTID,4)) ^(4) I $P(DPTID0,U,2)["D" S X="?",%DT="E" D ^%DT
"RTN","DPTLK2",48,0)
 I $P(DPTID0,U,2)["S" W !?7,"CHOOSE FROM: " F I=1:1 S Y=$P($P(DPTID0,U,3),";",I) Q:Y=""  W !?7,$P(Y,":",1),?15," ",$P(Y,":",2)
"RTN","DPTLK2",49,0)
 I $P(DPTID0,U,2)["P" D P1
"RTN","DPTLK2",50,0)
 Q
"RTN","DPTLK2",51,0)
P1 S DPTDIC=$G(DIC),DPTDIC(0)=$G(DIC(0)) S:$D(DIC("S")) DPTDIC("S")=DIC("S") S:$D(DIC("W")) DPTDIC("W")=DIC("W") S DIC="^"_$P(DPTID0,"^",3),DIC(0)="QEMZ",D="B" D IX^DIC
"RTN","DPTLK2",52,0)
 S DIC=DPTDIC,DIC(0)=DPTDIC(0) S:$D(DPTDIC("S")) DIC("S")=DPTDIC("S") S:$D(DPTDIC("W")) DIC("W")=DPTDIC("W") K DPTDIC D DO^DIC1 S:X["^" DPTDFN=-1 I X'["^",X'["?",Y'>0 S X="?" G P1
"RTN","DPTLK2",53,0)
 Q
"RTN","DPTLK2",54,0)
DEL ;Delete logic
"RTN","DPTLK2",55,0)
 N I,J,A,G,Q,ERR S Q="""",ERR=0 F I=0:0 S I=$O(^DD(2,0,"PT",I)) Q:'I  F J=0:0 S J=$O(^DD(2,0,"PT",I,J)) Q:'J  D
"RTN","DPTLK2",56,0)
  .F K=0:0 S K=$O(^DD(I,+J,1,K)) Q:'K  S A=$G(^(K,0)) I $L($P(A,U,2)),'$L($P(A,U,3)) D
"RTN","DPTLK2",57,0)
 ..S G=$G(^DIC(+I,0,"GL")) Q:'$L(G)  I $D(@(G_Q_$P(A,U,2)_Q_","_DA_")")) W !,"Entry in "_$P($G(^DIC(I,0)),U)_" ("_I_") refers to this patient" S ERR=1 Q
"RTN","DPTLK2",58,0)
 I ERR
"RTN","DPTNAME")
0^1^B41760279
"RTN","DPTNAME",1,0)
DPTNAME ;BPOIFO/KEITH - NAME STANDARDIZATION ; 27 Jan 2002 11:05 PM
"RTN","DPTNAME",2,0)
 ;;5.3;Registration;**244**;Aug 13, 1993
"RTN","DPTNAME",3,0)
 ;
"RTN","DPTNAME",4,0)
FORMAT(DGNAME,DGMINL,DGMAXL,DGNOP,DGCOMA,DGAUDIT,DGFAM,DGDNC) ;Format name value
"RTN","DPTNAME",5,0)
 ;Input: DGNAME=text value representing person name to transform
"RTN","DPTNAME",6,0)
 ;       DGMINL=minimum length (optional), default 3
"RTN","DPTNAME",7,0)
 ;       DGMAXL=maximum length (optional), default 30
"RTN","DPTNAME",8,0)
 ;        DGNOP=1 to standardize last name for 'NOP' x-ref. (optional)
"RTN","DPTNAME",9,0)
 ;       DGCOMA=0 to not require a comma
"RTN","DPTNAME",10,0)
 ;              1 to require a comma in the input value
"RTN","DPTNAME",11,0)
 ;              2 to add a comma if none
"RTN","DPTNAME",12,0)
 ;              3 to prohibit (remove) commas
"RTN","DPTNAME",13,0)
 ;              (optional) default if not specified is 1
"RTN","DPTNAME",14,0)
 ;
"RTN","DPTNAME",15,0)
 ;      DGAUDIT=variable to return audit, pass by reference (optional),
"RTN","DPTNAME",16,0)
 ;              returned values:  
"RTN","DPTNAME",17,0)
 ;              DGAUDIT=0 if no change was made
"RTN","DPTNAME",18,0)
 ;                      1 if name is changed
"RTN","DPTNAME",19,0)
 ;                      2 if name could not be converted
"RTN","DPTNAME",20,0)
 ;             DGAUDIT(1) defined if name contains no comma
"RTN","DPTNAME",21,0)
 ;             DGAUDIT(2) defined if parenthetical text is removed
"RTN","DPTNAME",22,0)
 ;             DGAUDIT(3) defined if value is unconvertible
"RTN","DPTNAME",23,0)
 ;             DGAUDIT(4) defined if characters are removed or changed
"RTN","DPTNAME",24,0)
 ;        DGFAM='1' if just the family name, '0' otherwise (optional)
"RTN","DPTNAME",25,0)
 ;        DGDNC='1' to prevent componentization (optional)
"RTN","DPTNAME",26,0)
 ;
"RTN","DPTNAME",27,0)
 ;Output: DGNAME in specified format or null if length of transformed value is less than DGMINL
"RTN","DPTNAME",28,0)
 ;
"RTN","DPTNAME",29,0)
 N DGX,DGOX,DGOLDN,DGAX,DGI,DGNEWN
"RTN","DPTNAME",30,0)
 ;Initialize variables
"RTN","DPTNAME",31,0)
 K DGAUDIT
"RTN","DPTNAME",32,0)
 S DGOLDN=DGNAME M DGX=DGNAME
"RTN","DPTNAME",33,0)
 S DGDNC=$G(DGDNC) D COMP^DPTNAME1(.DGX,.DGDNC)
"RTN","DPTNAME",34,0)
 S DGMINL=+$G(DGMINL) S:DGMINL<1 DGMINL=3
"RTN","DPTNAME",35,0)
 S DGMAXL=+$G(DGMAXL) S:DGMAXL<DGMINL DGMAXL=30
"RTN","DPTNAME",36,0)
 S DGNOP=$S($G(DGNOP)=1:"S",1:"")
"RTN","DPTNAME",37,0)
 S:'$L($G(DGCOMA)) DGCOMA=1 S DGCOMA=+DGCOMA
"RTN","DPTNAME",38,0)
 S DGFAM=$S($G(DGFAM)=1:"F",1:"")
"RTN","DPTNAME",39,0)
 ;
"RTN","DPTNAME",40,0)
 ;Check for comma
"RTN","DPTNAME",41,0)
 I DGX'["," S DGAUDIT(1)=""
"RTN","DPTNAME",42,0)
 I DGCOMA=1,DGX'["," S DGAUDIT=2,DGAUDIT(3)=""  Q ""
"RTN","DPTNAME",43,0)
 ;Clean input value
"RTN","DPTNAME",44,0)
 F  Q:'$$F1^DPTNAME1(.DGX,DGCOMA)
"RTN","DPTNAME",45,0)
 I DGX'=DGOLDN S DGAUDIT(4)=""
"RTN","DPTNAME",46,0)
 ;Add comma if necessary
"RTN","DPTNAME",47,0)
 I DGCOMA=2,DGX'[" ",DGX'["," S DGX=DGX_","
"RTN","DPTNAME",48,0)
 I DGX=DGOLDN K DGAUDIT(4)
"RTN","DPTNAME",49,0)
 ;Quit if result is too short
"RTN","DPTNAME",50,0)
 I $L(DGX)<DGMINL S DGAUDIT=2,DGAUDIT(3)="" K DGNAME Q ""
"RTN","DPTNAME",51,0)
 S DGNAME=DGX I 'DGDNC D
"RTN","DPTNAME",52,0)
 .;Parse the name
"RTN","DPTNAME",53,0)
 .D STDNAME^XLFNAME(.DGX,DGFAM_"CP",.DGAX)
"RTN","DPTNAME",54,0)
 .I $D(DGAX("STRIP")) S DGAUDIT(2)=""
"RTN","DPTNAME",55,0)
 .I $D(DGAX("NM"))!$D(DGAX("PERIOD")) S DGAUDIT(4)=""
"RTN","DPTNAME",56,0)
 .I $D(DGAX("PUNC"))!($D(DGAX("SPACE"))&'$L(DGFAM)) S DGAUDIT(4)=""
"RTN","DPTNAME",57,0)
 .I $D(DGAX("SPACE")),$L(DGFAM),DGNAME'=$G(DGX("FAMILY")) S DGAUDIT(4)=""
"RTN","DPTNAME",58,0)
 .;Standardize the suffix
"RTN","DPTNAME",59,0)
 .S DGX("SUFFIX")=$$CLEANC^XLFNAME(DGX("SUFFIX"))
"RTN","DPTNAME",60,0)
 .;Post-clean components
"RTN","DPTNAME",61,0)
 .S DGI="" F  S DGI=$O(DGX(DGI)) Q:DGI=""  S DGX(DGI)=$$POSTC(DGX(DGI))
"RTN","DPTNAME",62,0)
 .;Reconstruct name from components
"RTN","DPTNAME",63,0)
 .S DGNAME=$$NAMEFMT^XLFNAME(.DGX,"F","CL"_DGMAXL_DGNOP)
"RTN","DPTNAME",64,0)
 .;Adjust name for 'do not componentize'
"RTN","DPTNAME",65,0)
 .;I DGDNC S DGNAME=DGX("FAMILY")
"RTN","DPTNAME",66,0)
 ;Return comma for single value names
"RTN","DPTNAME",67,0)
 I DGCOMA,DGCOMA'=3,DGNAME'["," S DGNAME=DGNAME_","
"RTN","DPTNAME",68,0)
 ;Check length again
"RTN","DPTNAME",69,0)
 I $L(DGNAME)<DGMINL S DGAUDIT=2,DGAUDIT(3)="" K DGNAME Q ""
"RTN","DPTNAME",70,0)
 ;Enforce minimum 2 character last name rule
"RTN","DPTNAME",71,0)
 ;I '$L(DGFAM),$L($P(DGNAME,","))<3,$P(DGNAME,",")'?2U D  Q ""
"RTN","DPTNAME",72,0)
 ;.S DGAUDIT=2,DGAUDIT(3)="" K DGNAME
"RTN","DPTNAME",73,0)
 ;.Q
"RTN","DPTNAME",74,0)
 ;Remove hyphens and apostrophes for 'NOP' x-ref
"RTN","DPTNAME",75,0)
 S DGX=DGNAME I DGNOP="S" S DGNAME=$TR(DGNAME,"'-")
"RTN","DPTNAME",76,0)
 I DGNAME'=DGX S DGAUDIT(4)=""
"RTN","DPTNAME",77,0)
 I DGNAME=DGOLDN K DGAUDIT
"RTN","DPTNAME",78,0)
 S DGAUDIT=DGNAME'=DGOLDN I DGAUDIT,$D(DGAUDIT)<10 S DGAUDIT(4)=""
"RTN","DPTNAME",79,0)
 S DGNEWN=DGNAME M DGNAME=DGX S DGNAME=DGNEWN
"RTN","DPTNAME",80,0)
 Q DGNAME
"RTN","DPTNAME",81,0)
 ;
"RTN","DPTNAME",82,0)
POSTC(DGX) ;Post-clean components
"RTN","DPTNAME",83,0)
 ;Remove parenthesis if not removed by Kernel
"RTN","DPTNAME",84,0)
 N DGI,DGXOLD
"RTN","DPTNAME",85,0)
 S DGXOLD=DGX,DGX=$TR(DGX,"()[]{}")
"RTN","DPTNAME",86,0)
 ;Check for numbers left behind by Kernel
"RTN","DPTNAME",87,0)
 F DGI=0:1:9 S DGX=$TR(DGX,DGI)
"RTN","DPTNAME",88,0)
 I DGX'=DGXOLD S DGAUDIT(4)=""
"RTN","DPTNAME",89,0)
 Q DGX
"RTN","DPTNAME",90,0)
 ;
"RTN","DPTNAME",91,0)
NOP(DGX) ;Produce 'NOP' x-ref value
"RTN","DPTNAME",92,0)
 ;Input: DGX=name value to evaluate
"RTN","DPTNAME",93,0)
 ;Output : Standardized name or null if the same as input value
"RTN","DPTNAME",94,0)
 N DGNEWX
"RTN","DPTNAME",95,0)
 S DGNEWX=$$FORMAT(DGX,3,30,1)
"RTN","DPTNAME",96,0)
 Q $S(DGX=DGNEWX:"",1:DGNEWX)
"RTN","DPTNAME",97,0)
 ;
"RTN","DPTNAME",98,0)
NARY(DG20NAME) ;Set up name array
"RTN","DPTNAME",99,0)
 ;Input: DG20NAME=full name value
"RTN","DPTNAME",100,0)
 ;       DG20NAME(component_names)=corresponding value--if undefined,
"RTN","DPTNAME",101,0)
 ;                these will get set up
"RTN","DPTNAME",102,0)
 ;
"RTN","DPTNAME",103,0)
 N DGX M DGX=DG20NAME
"RTN","DPTNAME",104,0)
 D STDNAME^XLFNAME(.DG20NAME,"FC")
"RTN","DPTNAME",105,0)
 M DG20NAME=DGX
"RTN","DPTNAME",106,0)
 S DG20NAME("NOTES")=$$NOTES^DPTNAME1()
"RTN","DPTNAME",107,0)
 Q
"RTN","DPTNAME",108,0)
 ;
"RTN","DPTNAME",109,0)
NCEDIT(DFN,DGHDR,DG20NAME) ;Edit name components
"RTN","DPTNAME",110,0)
 ;Input: DFN=patient ifn
"RTN","DPTNAME",111,0)
 ;     DGHDR=1 to write components header (optional)
"RTN","DPTNAME",112,0)
 ;  DG20NAME=array of name components (optional)
"RTN","DPTNAME",113,0)
 ;Output: formatted name and DG20NAME components array if the user
"RTN","DPTNAME",114,0)
 ;        specifies filing, DG20NAME=null otherwise
"RTN","DPTNAME",115,0)
 ;
"RTN","DPTNAME",116,0)
 N DIR,X,Y,DGCOMP,DGC,DGI,DGX,DGY,DGCOM
"RTN","DPTNAME",117,0)
 N DGCL,DGCX,DGOUT,DGEDIT,%,DIE,DR,DA
"RTN","DPTNAME",118,0)
 ;Initialize variables
"RTN","DPTNAME",119,0)
START S DFN=+DFN,(DGOUT,DGEDIT)=0,DGCOMP=$D(DG20NAME)>9
"RTN","DPTNAME",120,0)
 S DGCOM="FAMILY^GIVEN^MIDDLE^PREFIX^SUFFIX^DEGREE"
"RTN","DPTNAME",121,0)
 S DGCX=" (LAST) NAME^ (FIRST) NAME^ NAME"
"RTN","DPTNAME",122,0)
 S DGCL="1:35^1:25^1:25^1:10^1:10^1:10"
"RTN","DPTNAME",123,0)
 ;Get patient name
"RTN","DPTNAME",124,0)
 S DGX=$P($G(^DPT(DFN,0)),U) Q:DGX=""
"RTN","DPTNAME",125,0)
 ;Get name component values from file #20
"RTN","DPTNAME",126,0)
 I 'DGCOMP S DGCOMP=+$G(^DPT(DFN,"NAME"))_"," I DGCOMP D
"RTN","DPTNAME",127,0)
 .D GETS^DIQ(20,DGCOMP,"1:6",,"DGCOMP")
"RTN","DPTNAME",128,0)
 .I '$D(DGCOMP(20,DGCOMP)) S DGCOMP=0 Q
"RTN","DPTNAME",129,0)
 .F DGI=1:1:6 S DGX($P(DGCOM,U,DGI))=DGCOMP(20,DGCOMP,DGI)
"RTN","DPTNAME",130,0)
 .Q
"RTN","DPTNAME",131,0)
 ;Parse name components from name value
"RTN","DPTNAME",132,0)
 I 'DGCOMP D
"RTN","DPTNAME",133,0)
 .D STDNAME^XLFNAME(.DGX,"C") S DGEDIT=1
"RTN","DPTNAME",134,0)
 .S DGX("SUFFIX")=$$CLEANC^XLFNAME(DGX("SUFFIX"))
"RTN","DPTNAME",135,0)
 .Q
"RTN","DPTNAME",136,0)
 ;Prompt for name component edits
"RTN","DPTNAME",137,0)
 N DTOUT,DUOUT,DIRUT,DGCOUT
"RTN","DPTNAME",138,0)
 S DGCOUT=0 M DG20NAME=DGX
"RTN","DPTNAME",139,0)
 S DIR("PRE")="D:X'=""@"" NCEVAL^DPTNAME1(DGCOMP,.X)"
"RTN","DPTNAME",140,0)
 I $G(DGHDR) W !,"Patient name components--"
"RTN","DPTNAME",141,0)
 F DGI=1:1:6 S DGC($P(DGCOM,U,DGI),DGI)=""
"RTN","DPTNAME",142,0)
 F DGI=1:1:6 Q:DGOUT  D
"RTN","DPTNAME",143,0)
AGAIN .S DGCOMP=$P(DGCOM,U,DGI)
"RTN","DPTNAME",144,0)
 .S DIR("A")=DGCOMP_$P(DGCX,U,DGI)
"RTN","DPTNAME",145,0)
 .S DIR(0)="FO^"_$P(DGCL,U,DGI)
"RTN","DPTNAME",146,0)
 .S DIR("PRE")="D NCEVAL^DPTNAME1(DGCOMP,.X)"
"RTN","DPTNAME",147,0)
 .S DIR("B")=$S($D(DG20NAME(DGCOMP)):DG20NAME(DGCOMP),1:$G(DGX(DGCOMP)))
"RTN","DPTNAME",148,0)
 .K:'$L(DIR("B")) DIR("B")
"RTN","DPTNAME",149,0)
ASK .D ^DIR I $D(DTOUT)!(X=U) S:(X=U) DGCOUT=1 S DGOUT=1 Q
"RTN","DPTNAME",150,0)
 .I $A(X)=94 D JUMP^DPTNAME1(.DGI) G AGAIN
"RTN","DPTNAME",151,0)
 .I X="@",DGI=1 W !,$C(7),"Family name cannot be deleted!" G ASK
"RTN","DPTNAME",152,0)
 .I X="@" D  Q
"RTN","DPTNAME",153,0)
 ..W "  (deletion indicated)" S DG20NAME(DGCOMP)=""
"RTN","DPTNAME",154,0)
 ..S:DG20NAME(DGCOMP)'=$G(DGX(DGCOMP)) DGEDIT=1
"RTN","DPTNAME",155,0)
 ..Q
"RTN","DPTNAME",156,0)
 .Q:'$L(X)
"RTN","DPTNAME",157,0)
 .S DG20NAME=X
"RTN","DPTNAME",158,0)
 .I DGCOMP="SUFFIX" S DG20NAME=$$CLEANC^XLFNAME(DG20NAME)
"RTN","DPTNAME",159,0)
 .S DG20NAME=$$FORMAT(DG20NAME,1,35,,3,,1,1)
"RTN","DPTNAME",160,0)
 .I '$L(DG20NAME) W "  ??",$C(7) G ASK
"RTN","DPTNAME",161,0)
 .W:DG20NAME'=X "   (",DG20NAME,")" S DG20NAME(DGCOMP)=DG20NAME
"RTN","DPTNAME",162,0)
 .S:DG20NAME(DGCOMP)'=$G(DGX(DGCOMP)) DGEDIT=1
"RTN","DPTNAME",163,0)
 .Q
"RTN","DPTNAME",164,0)
 Q:'DGEDIT ""
"RTN","DPTNAME",165,0)
 Q:DGOUT&'DGCOUT ""
"RTN","DPTNAME",166,0)
 ;Reconstruct name
"RTN","DPTNAME",167,0)
 S DG20NAME=$$NAMEFMT^XLFNAME(.DG20NAME,"F","CFL30")
"RTN","DPTNAME",168,0)
 ;Format the .01 value
"RTN","DPTNAME",169,0)
 M DGY=DG20NAME
"RTN","DPTNAME",170,0)
 S DG20NAME=$$FORMAT(.DGY,3,30,,2)
"RTN","DPTNAME",171,0)
 ;Check the length
"RTN","DPTNAME",172,0)
 I $L(DG20NAME)<3 D  G START
"RTN","DPTNAME",173,0)
 .W !,"Invalid values to file, full name must be at least 3 characters!",$C(7)
"RTN","DPTNAME",174,0)
 .K DG20NAME,DGX,DGCOMP Q
"RTN","DPTNAME",175,0)
 ;File new name value
"RTN","DPTNAME",176,0)
CONF W !,"Ok to file '",DG20NAME,"' and its name components"
"RTN","DPTNAME",177,0)
 S %=1 D YN^DICN
"RTN","DPTNAME",178,0)
 I '% W !,"Indicate if the edits to the name and its components should be filed." G CONF
"RTN","DPTNAME",179,0)
 I %'=1 K DG20NAME S DG20NAME="" Q DG20NAME
"RTN","DPTNAME",180,0)
 I '$$CONF1(DG20NAME) K DG20NAME S DG20NAME=""
"RTN","DPTNAME",181,0)
 Q DG20NAME
"RTN","DPTNAME",182,0)
 ;
"RTN","DPTNAME",183,0)
CONF1(DPTX) ;Confirm if single name value is ok.
"RTN","DPTNAME",184,0)
 ;Input: DPTX=name value
"RTN","DPTNAME",185,0)
 N %
"RTN","DPTNAME",186,0)
 Q:$E($P(DPTX,",",2))?1U 1
"RTN","DPTNAME",187,0)
 W !!?5,$C(7),"WARNING: Do not enter single name values for patients (no given or"
"RTN","DPTNAME",188,0)
 W !?5,"         first name) unless this is actually their legal name!!!",$C(7)
"RTN","DPTNAME",189,0)
RC W !!,"Are you sure you want to enter the patient name in this manner"
"RTN","DPTNAME",190,0)
 S %=2 D YN^DICN S %=$S(%<0!(%=2):-1,%=1:1,1:0) I '% W !?6,"Specify 'YES' to enter a single name value, or 'NO' to discontinue." G RC
"RTN","DPTNAME",191,0)
 W !
"RTN","DPTNAME",192,0)
 Q %=1
"RTN","DPTNAME1")
0^43^B40589479
"RTN","DPTNAME1",1,0)
DPTNAME1 ;BPOIFO/KEITH - NAME STANDARDIZATION ; 12 Aug 2002@20:20
"RTN","DPTNAME1",2,0)
 ;;5.3;Registration;**244**;Aug 13, 1993
"RTN","DPTNAME1",3,0)
 ;
"RTN","DPTNAME1",4,0)
NCEVAL(DGC,DGX) ;Evaluate name component entry values
"RTN","DPTNAME1",5,0)
 ;Input: DGC=name component (e.g. FAMILY, GIVEN, etc.)
"RTN","DPTNAME1",6,0)
 ;       DGX=input value for name
"RTN","DPTNAME1",7,0)
 ;
"RTN","DPTNAME1",8,0)
 Q:DGX="@"
"RTN","DPTNAME1",9,0)
 N DGM,DGL,DGI
"RTN","DPTNAME1",10,0)
 I DGX=""!($E(DGX)=U) Q
"RTN","DPTNAME1",11,0)
 D CVALID(DGC,DGX,.DGM)
"RTN","DPTNAME1",12,0)
 M DIR("?")=DGM("HELP") S DGI=$O(DIR("?",""),-1) I DGI D
"RTN","DPTNAME1",13,0)
 .S DIR("?")=DIR("?",DGI) K DIR("?",DGI)
"RTN","DPTNAME1",14,0)
 .Q
"RTN","DPTNAME1",15,0)
 I "???"[DGX Q
"RTN","DPTNAME1",16,0)
 I DGM("RESULT")="" D  Q
"RTN","DPTNAME1",17,0)
 .S DGI="" F  S DGI=$O(DGM("ERROR",DGI)) Q:DGI=""  D
"RTN","DPTNAME1",18,0)
 ..I DGM("ERROR",DGI)["''" S $P(DGM("ERROR",DGI),"'",2)=DGX
"RTN","DPTNAME1",19,0)
 ..W:DGI=1 ! W !,DGM("ERROR",DGI)
"RTN","DPTNAME1",20,0)
 ..Q
"RTN","DPTNAME1",21,0)
 .K DGX
"RTN","DPTNAME1",22,0)
 .Q
"RTN","DPTNAME1",23,0)
 I DGM("RESULT")'=DGX W "   (",DGM("RESULT"),")"
"RTN","DPTNAME1",24,0)
 S DGX=DGM("RESULT")
"RTN","DPTNAME1",25,0)
 Q
"RTN","DPTNAME1",26,0)
 ;
"RTN","DPTNAME1",27,0)
FAMILY ;Family name help text
"RTN","DPTNAME1",28,0)
 S DGM("LENGTH")="1-35"
"RTN","DPTNAME1",29,0)
 D HTEXT("family (last) name.",DGM("LENGTH"))
"RTN","DPTNAME1",30,0)
 S DGM("HELP",4)="Input values less than 3 characters in length must be all alpha characters."
"RTN","DPTNAME1",31,0)
 Q
"RTN","DPTNAME1",32,0)
 ;
"RTN","DPTNAME1",33,0)
GIVEN ;Given name help text
"RTN","DPTNAME1",34,0)
 S DGM("LENGTH")="1-25"
"RTN","DPTNAME1",35,0)
 D HTEXT("given (first) name.",DGM("LENGTH"))
"RTN","DPTNAME1",36,0)
 Q
"RTN","DPTNAME1",37,0)
 ;
"RTN","DPTNAME1",38,0)
MIDDLE ;Middle name help text
"RTN","DPTNAME1",39,0)
 S DGM("LENGTH")="1-25"
"RTN","DPTNAME1",40,0)
 D HTEXT("middle name.",DGM("LENGTH"))
"RTN","DPTNAME1",41,0)
 S DGM("HELP",4)="Middle names of 'NMI' and 'NMN' are prohibited."
"RTN","DPTNAME1",42,0)
 Q
"RTN","DPTNAME1",43,0)
 ;
"RTN","DPTNAME1",44,0)
PREFIX ;Name prefix help text
"RTN","DPTNAME1",45,0)
 S DGM("LENGTH")="1-10"
"RTN","DPTNAME1",46,0)
 D HTEXT("name prefix, such as MR or MS.",DGM("LENGTH"))
"RTN","DPTNAME1",47,0)
 Q
"RTN","DPTNAME1",48,0)
 ;
"RTN","DPTNAME1",49,0)
SUFFIX ;Name suffix help text
"RTN","DPTNAME1",50,0)
 S DGM("LENGTH")="1-10"
"RTN","DPTNAME1",51,0)
 D HTEXT("suffix(es), such as JR, SR, II, or II.",DGM("LENGTH"))
"RTN","DPTNAME1",52,0)
 Q
"RTN","DPTNAME1",53,0)
 ;
"RTN","DPTNAME1",54,0)
DEGREE ;Name degree help text
"RTN","DPTNAME1",55,0)
 S DGM("LENGTH")="1-10"
"RTN","DPTNAME1",56,0)
 D HTEXT("academic degree, such as BS, BA, MD, or PHD.",DGM("LENGTH"))
"RTN","DPTNAME1",57,0)
 Q
"RTN","DPTNAME1",58,0)
 ;
"RTN","DPTNAME1",59,0)
HTEXT(DGF,DGL) ;Generic help text
"RTN","DPTNAME1",60,0)
 ;Input: DGF=field name
"RTN","DPTNAME1",61,0)
 ;       DGL=field length
"RTN","DPTNAME1",62,0)
 S DGM("HELP",1)="Answer with this persons "_DGF
"RTN","DPTNAME1",63,0)
 S DGM("HELP",2)="The response must be "_DGL_" characters in length and may only contain"
"RTN","DPTNAME1",64,0)
 S DGM("HELP",3)="uppercase alpha characters, spaces, hyphens and apostrophes."
"RTN","DPTNAME1",65,0)
 Q
"RTN","DPTNAME1",66,0)
 ;
"RTN","DPTNAME1",67,0)
CVALID(DGC,DGX,DGM) ;Name component validation
"RTN","DPTNAME1",68,0)
 ; Input: DGC=name component (e.g. FAMILY, GIVEN, etc.)
"RTN","DPTNAME1",69,0)
 ;        DGX=input value to validate
"RTN","DPTNAME1",70,0)
 ;        DGM=array to return results and errors (pass by reference)
"RTN","DPTNAME1",71,0)
 ;
"RTN","DPTNAME1",72,0)
 ;Output: DGM array in the format:
"RTN","DPTNAME1",73,0)
 ;       DGM("ERROR",n)=error text (if any) 
"RTN","DPTNAME1",74,0)
 ;       DGM("HELP",n)=help text          
"RTN","DPTNAME1",75,0)
 ;       DGM("LENGTH")=field length in length (e.g. 3-30) 
"RTN","DPTNAME1",76,0)
 ;       DGM("RESULT")=transformed name value (null if invalid entry)
"RTN","DPTNAME1",77,0)
 ; 
"RTN","DPTNAME1",78,0)
 N DGL,DGF,DGI,DGR,DGMSG
"RTN","DPTNAME1",79,0)
 S DGF="FAMILY^GIVEN^MIDDLE^PREFIX^SUFFIX^DEGREE"
"RTN","DPTNAME1",80,0)
 S DGF=$P(DGF,DGC),DGF=$L(DGF,U)
"RTN","DPTNAME1",81,0)
 D @DGC  ;Set up length and help text 
"RTN","DPTNAME1",82,0)
 S DGL=+$P(DGM("LENGTH"),"-")_U_+$P(DGM("LENGTH"),"-",2)
"RTN","DPTNAME1",83,0)
 ;Transform suffixes
"RTN","DPTNAME1",84,0)
 I DGC="SUFFIX" S DGX=$$CLEANC^XLFNAME(DGX)
"RTN","DPTNAME1",85,0)
 ;Clean/format input value 
"RTN","DPTNAME1",86,0)
 S DGX=$$FORMAT^DPTNAME(DGX,$P(DGL,U),$P(DGL,U,2),,3,,1,1)
"RTN","DPTNAME1",87,0)
 ;Validate against file 20 
"RTN","DPTNAME1",88,0)
 D CHK^DIE(20,DGF,"E",DGX,.DGR,"DGMSG")
"RTN","DPTNAME1",89,0)
 I $D(DGMSG("DIERR","E",701)) D
"RTN","DPTNAME1",90,0)
 .S DGI=$O(DGMSG("DIERR","E",701,""))
"RTN","DPTNAME1",91,0)
 .M DGM("ERROR")=DGMSG("DIERR",DGI,"TEXT")
"RTN","DPTNAME1",92,0)
 .Q
"RTN","DPTNAME1",93,0)
 S DGM("RESULT")=$S(DGR=U:"",1:DGR)
"RTN","DPTNAME1",94,0)
 Q
"RTN","DPTNAME1",95,0)
 ;
"RTN","DPTNAME1",96,0)
JUMP(DGI) ;Evaluate request to jump fields
"RTN","DPTNAME1",97,0)
 N DGX,DGY S DGX=$P($E(X,2,99)," ")
"RTN","DPTNAME1",98,0)
 I (U_DGCOM)'[(U_DGX) D  Q
"RTN","DPTNAME1",99,0)
 .W !,"While editing name components, only jumping to other components is allowed!",$C(7)
"RTN","DPTNAME1",100,0)
 .Q
"RTN","DPTNAME1",101,0)
 I (U_DGCOM_U)[(U_DGX_U) S DGI=$O(DGC(DGX,0)) Q
"RTN","DPTNAME1",102,0)
 S DGI=$O(DGC($O(DGC(DGX)),0))
"RTN","DPTNAME1",103,0)
 S DGY=$P(DGCOM,U,DGI)_$P(DGCX,U,DGI) W $P(DGY,DGX,2)
"RTN","DPTNAME1",104,0)
 Q
"RTN","DPTNAME1",105,0)
 ;
"RTN","DPTNAME1",106,0)
NOTES() ;Produce value for the file #20 NOTES ABOUT NAME field
"RTN","DPTNAME1",107,0)
 ;Output: string representing when, who and how editing occurred
"RTN","DPTNAME1",108,0)
 ;
"RTN","DPTNAME1",109,0)
 N DGWHEN,DGWHO,DGHOW
"RTN","DPTNAME1",110,0)
 S DGWHEN=$$FMTE^XLFDT($$NOW^XLFDT())
"RTN","DPTNAME1",111,0)
 S DGWHO=$S($G(DUZ)>0:$$GET1^DIQ(200,DUZ_",",.01),1:"Unknown")
"RTN","DPTNAME1",112,0)
 S DGWHO=DGWHO_" ("_$G(DUZ)_")"
"RTN","DPTNAME1",113,0)
 S DGHOW=$P($G(XQY0),U)
"RTN","DPTNAME1",114,0)
 Q "Edited: "_DGWHEN_" By: "_DGWHO_" With: "_DGHOW
"RTN","DPTNAME1",115,0)
 ;
"RTN","DPTNAME1",116,0)
COMP(DGX,DGDNC) ;Use existing name array
"RTN","DPTNAME1",117,0)
 ;Input: DGX=name array (pass by reference)
"RTN","DPTNAME1",118,0)
 ;     DGDNC='do not componentize' flag (pass by reference)
"RTN","DPTNAME1",119,0)
 ;
"RTN","DPTNAME1",120,0)
 N DGY,DGI,DGZ
"RTN","DPTNAME1",121,0)
 Q:$D(DGX)<10  Q:DGDNC=0
"RTN","DPTNAME1",122,0)
 S DGDNC=1,DGY="FAMILY^GIVEN^MIDDLE^PREFIX^SUFFIX^DEGREE"
"RTN","DPTNAME1",123,0)
 F DGI=1:1:6 S DGZ=$P(DGY,U,DGI) S:'$D(DGX(DGZ)) DGX(DGZ)=""
"RTN","DPTNAME1",124,0)
 Q
"RTN","DPTNAME1",125,0)
 ;
"RTN","DPTNAME1",126,0)
F1(DGX,DGCOMA)  ;Transform text value
"RTN","DPTNAME1",127,0)
 ;Input: DGX=text value to transform (pass by reference)
"RTN","DPTNAME1",128,0)
 ;    DGCOMA=comma indicator
"RTN","DPTNAME1",129,0)
 ;Output: 1 if changed, 0 otherwise
"RTN","DPTNAME1",130,0)
 ;
"RTN","DPTNAME1",131,0)
 N DGI,DGII,DGC,DGY,DGZ,DGOLDX S DGOLDX=DGX
"RTN","DPTNAME1",132,0)
 ;Transform accent grave to apostrophe
"RTN","DPTNAME1",133,0)
 S DGX=$TR(DGX,"`","'")
"RTN","DPTNAME1",134,0)
 ;Transform single characters
"RTN","DPTNAME1",135,0)
 F DGI=1:1:$L(DGX) S DGC=$E(DGX,DGI) D:$$FC1(.DGC,DGCOMA)
"RTN","DPTNAME1",136,0)
 .S DGX=$E(DGX,0,DGI-1)_DGC_$E(DGX,DGI+1,999)
"RTN","DPTNAME1",137,0)
 .Q
"RTN","DPTNAME1",138,0)
 ;Transform double character combinations
"RTN","DPTNAME1",139,0)
 S DGY="  ^--^,,^''^,-^,'^ ,^-,^',^ -^ '^- ^' ^-'^'-"
"RTN","DPTNAME1",140,0)
 S DGZ=" ^-^,^'^,^,^,^,^,^ ^ ^ ^ ^-^-"
"RTN","DPTNAME1",141,0)
 F DGI=1:1 S DGC=$P(DGY,U,DGI) Q:DGC=""  D
"RTN","DPTNAME1",142,0)
 .Q:DGX'[DGC
"RTN","DPTNAME1",143,0)
 .F DGII=1:1:$L(DGX,DGC)-1 D
"RTN","DPTNAME1",144,0)
 ..S DGX=$P(DGX,DGC,0,DGII)_$P(DGZ,U,DGI)_$P(DGX,DGC,DGII+1,999)
"RTN","DPTNAME1",145,0)
 ..Q
"RTN","DPTNAME1",146,0)
 .Q
"RTN","DPTNAME1",147,0)
 ;Remove NMI and NMN
"RTN","DPTNAME1",148,0)
 F DGY="NMI","NMN" I DGX[DGY,DGCOMA=3 D
"RTN","DPTNAME1",149,0)
 .S DGC=$F(DGX,DGY)
"RTN","DPTNAME1",150,0)
 .I " ,"[$E(DGX,(DGC-4))," ,"[$E(DGX,DGC) D
"RTN","DPTNAME1",151,0)
 ..S DGX=$E(DGX,0,(DGC-4))_$E(DGX,(DGC),999)
"RTN","DPTNAME1",152,0)
 ..F DGY="  ",",," I DGX[DGY D
"RTN","DPTNAME1",153,0)
 ...S DGC=$F(DGX,DGY) S DGX=$E(DGX,0,(DGC-3))_$E(DGX,(DGC-1),999) Q
"RTN","DPTNAME1",154,0)
 ..F DGZ=" ","," F DGC=1,$L(DGX) D
"RTN","DPTNAME1",155,0)
 ...I $E(DGX,DGC)=DGZ S DGX=$E(DGX,0,(DGC-1))_$E(DGX,(DGC+1),999) Q
"RTN","DPTNAME1",156,0)
 ..Q
"RTN","DPTNAME1",157,0)
 .Q
"RTN","DPTNAME1",158,0)
 ;Clean up numerics
"RTN","DPTNAME1",159,0)
 I DGX?.E1N.E D
"RTN","DPTNAME1",160,0)
 .S DGY="1ST^2ND^3RD^4TH^5TH^6TH^7TH^8TH^9TH"
"RTN","DPTNAME1",161,0)
 .F DGI=1:1:$L(DGX) S DGC=$E(DGX,DGI) D:DGC?1N
"RTN","DPTNAME1",162,0)
 ..I DGC," ,"[$E(DGX,DGI-1),$E(DGX,DGI,DGI+2)=$P(DGY,U,DGC)," ,"[$E(DGX,DGI+3) Q
"RTN","DPTNAME1",163,0)
 ..I DGC=1," ,"[$E(DGX,DGI-1),$E(DGX,DGI,DGI+3)="10TH"," ,"[$E(DGX,DGI+4) S DGI=DGI+1 Q
"RTN","DPTNAME1",164,0)
 ..S DGX=$E(DGX,0,DGI-1)_$E(DGX,DGI+1,999)
"RTN","DPTNAME1",165,0)
 ..Q
"RTN","DPTNAME1",166,0)
 .Q
"RTN","DPTNAME1",167,0)
 ;Check for dangling apostrophes
"RTN","DPTNAME1",168,0)
 I DGX["'" F DGI=1:1:$L(DGX) S DGC=$E(DGX,DGI) D:DGC?1"'"
"RTN","DPTNAME1",169,0)
 .I $E(DGX,(DGI-1))?1U,$E(DGX,(DGI+1))?1U Q
"RTN","DPTNAME1",170,0)
 .S DGX=$E(DGX,0,(DGI-1))_$E(DGX,(DGI+1),99),DGI=1
"RTN","DPTNAME1",171,0)
 .Q
"RTN","DPTNAME1",172,0)
 ;Remove parenthetical text from name value
"RTN","DPTNAME1",173,0)
 N DGCH S DGOLDX(2)=DGX,DGCH=1 F  Q:'DGCH  D
"RTN","DPTNAME1",174,0)
 .S DGCH=0,DGOLDX(1)=DGX,DGY="()[]{}" D
"RTN","DPTNAME1",175,0)
 ..F DGI=1,3,5 S DGC(1)=$E(DGY,DGI),DGC(2)=$E(DGY,DGI+1) D
"RTN","DPTNAME1",176,0)
 ...S DGZ(1)=$$CLAST(DGX,DGC(1)) Q:'DGZ(1)  S DGZ(2)=$F(DGX,DGC(2),DGZ(1))
"RTN","DPTNAME1",177,0)
 ...I DGZ(2)>DGZ(1) S DGX=$E(DGX,0,(DGZ(1)-2))_$E(DGX,DGZ(2),999)
"RTN","DPTNAME1",178,0)
 ...S DGCH=(DGX'=DGOLDX(1)) Q
"RTN","DPTNAME1",179,0)
 ..Q
"RTN","DPTNAME1",180,0)
 .Q
"RTN","DPTNAME1",181,0)
 S:DGX'=DGOLDX(2) DGAUDIT(2)=""
"RTN","DPTNAME1",182,0)
 F DGI=1:1:6 S DGC=$E(DGY,DGI) D
"RTN","DPTNAME1",183,0)
 .F  Q:DGX'[DGC  S DGX=$P(DGX,DGC)_$P(DGX,DGC,2,999)
"RTN","DPTNAME1",184,0)
 .Q
"RTN","DPTNAME1",185,0)
 ;Insure value begins and ends with an alpha character
"RTN","DPTNAME1",186,0)
 F  Q:'$L(DGX)!($E(DGX,1)?1A)  S DGX=$E(DGX,2,999)
"RTN","DPTNAME1",187,0)
 F  Q:'$L(DGX)!($E(DGX,$L(DGX))?1A)  Q:($L(DGX,",")=2)&($E(DGX,$L(DGX))=",")  S DGX=$E(DGX,1,($L(DGX)-1))
"RTN","DPTNAME1",188,0)
 Q DGX'=DGOLDX
"RTN","DPTNAME1",189,0)
 ;
"RTN","DPTNAME1",190,0)
CLAST(DGX,DGC) ;Find last instance of character
"RTN","DPTNAME1",191,0)
 N DGY,DGZ
"RTN","DPTNAME1",192,0)
 S DGZ=$F(DGX,DGC) Q:'DGZ DGZ
"RTN","DPTNAME1",193,0)
 F  S DGY=$F(DGX,DGC,DGZ) Q:'DGY  S DGZ=DGY
"RTN","DPTNAME1",194,0)
 Q DGZ
"RTN","DPTNAME1",195,0)
 ;
"RTN","DPTNAME1",196,0)
FC1(DGC,DGCOMA) ;Transform single character
"RTN","DPTNAME1",197,0)
 ;Input: DGC=character to transform (pass by reference)
"RTN","DPTNAME1",198,0)
 ;    DGCOMA=comma indicator
"RTN","DPTNAME1",199,0)
 ;Output: 1 if value is changed, 0 otherwise
"RTN","DPTNAME1",200,0)
 ;
"RTN","DPTNAME1",201,0)
 S DGC=$E(DGC) Q:'$L(DGC) 0
"RTN","DPTNAME1",202,0)
 ;See if comma stays
"RTN","DPTNAME1",203,0)
 I DGCOMA'=3,DGC?1"," Q 0
"RTN","DPTNAME1",204,0)
 ;Retain uppercase, numeric, hyphen, apostrophe and space
"RTN","DPTNAME1",205,0)
 Q:DGC?1U!(DGC?1N)!(DGC?1"-")!(DGC?1"'")!(DGC?1" ") 0
"RTN","DPTNAME1",206,0)
 ;Retain parenthesis, bracket and brace characters
"RTN","DPTNAME1",207,0)
 Q:DGC?1"("!(DGC?1")")!(DGC?1"[")!(DGC?1"]")!(DGC?1"{")!(DGC?1"}") 0
"RTN","DPTNAME1",208,0)
 ;Transform lowercase to uppercase
"RTN","DPTNAME1",209,0)
 I DGC?1L S DGC=$C($A(DGC)-32) Q 1
"RTN","DPTNAME1",210,0)
 ;Set all other characters to space
"RTN","DPTNAME1",211,0)
 S DGC=" " Q 1
"UP",2,2.01,-1)
2^.01
"UP",2,2.01,0)
2.01
"UP",2,2.101,-1)
2^DIS
"UP",2,2.101,0)
2.101
"VER")
8.0^22.0
"^DD",2,2,1.01,0)
NAME COMPONENTS^P20'I^VA(20,^NAME;1^Q
"^DD",2,2,1.01,1,0)
^.1^^0
"^DD",2,2,1.01,3)
This field contains a pointer to the NAME COMPONENTS record associated with field #.01.
"^DD",2,2,1.01,9)
^
"^DD",2,2,1.01,"DT")
3020419
"^DD",2,2,1.02,0)
K-NAME COMPONENTS^P20'I^VA(20,^NAME;2^Q
"^DD",2,2,1.02,3)
This field contains a pointer to the NAME COMPONENTS record associated with field #.211.
"^DD",2,2,1.02,9)
^
"^DD",2,2,1.02,"DT")
3020419
"^DD",2,2,1.03,0)
K2-NAME COMPONENTS^P20'I^VA(20,^NAME;3^Q
"^DD",2,2,1.03,3)
This field contains a pointer to the NAME COMPONENTS record associated with field #.2191.
"^DD",2,2,1.03,9)
^
"^DD",2,2,1.03,"DT")
3020419
"^DD",2,2,1.04,0)
FATHER'S NAME COMPONENTS^P20'I^VA(20,^NAME;4^Q
"^DD",2,2,1.04,3)
This field contains a pointer to the NAME COMPONENTS record associated with field #.2401.
"^DD",2,2,1.04,9)
^
"^DD",2,2,1.04,"DT")
3020419
"^DD",2,2,1.05,0)
MOTHER'S NAME COMPONENTS^P20'I^VA(20,^NAME;5^Q
"^DD",2,2,1.05,1,0)
^.1^^0
"^DD",2,2,1.05,3)
This field contains a pointer to the NAME COMPONENTS record associated with field #.2402.
"^DD",2,2,1.05,9)
^
"^DD",2,2,1.05,"DT")
3020725
"^DD",2,2,1.06,0)
MOTHERS MAIDEN NAME COMPONENTS^P20'I^VA(20,^NAME;6^Q
"^DD",2,2,1.06,3)
This field contains a pointer to the NAME COMPONENTS record associated with field #.2403.
"^DD",2,2,1.06,9)
^
"^DD",2,2,1.06,"DT")
3020419
"^DD",2,2,1.07,0)
E-NAME COMPONENTS^P20'I^VA(20,^NAME;7^Q
"^DD",2,2,1.07,3)
This field contains a pointer to the NAME COMPONENTS record associated with field #.331.
"^DD",2,2,1.07,9)
^
"^DD",2,2,1.07,"DT")
3020419
"^DD",2,2,1.08,0)
E2-NAME COMPONENTS^P20'I^VA(20,^NAME;8^Q
"^DD",2,2,1.08,3)
This field contains a pointer to the NAME COMPONENTS record associated with field #.3311.
"^DD",2,2,1.08,9)
^
"^DD",2,2,1.08,"DT")
3020725
"^DD",2,2,1.09,0)
D-NAME COMPONENTS^P20'I^VA(20,^NAME;9^Q
"^DD",2,2,1.09,3)
This field contains a pointer to the NAME COMPONENTS record associated with field #.341.
"^DD",2,2,1.09,9)
^
"^DD",2,2,1.09,"DT")
3020725
"^DD",2,2.01,100.03,0)
ALIAS COMPONENTS^P20'I^VA(20,^0;3^Q
"^DD",2,2.01,100.03,1,0)
^.1^^0
"^DD",2,2.01,100.03,3)
This field contains a pointer to the NAME COMPONENTS record associated with ALIAS field #.01.
"^DD",2,2.01,100.03,9)
^
"^DD",2,2.01,100.03,"DT")
3020419
"^DD",2,2.101,100.21,0)
ATTORNEY'S NAME COMPONENTS^P20'I^VA(20,^0;21^Q
"^DD",2,2.101,100.21,3)
This field contains a pointer to the NAME COMPONENTS record associated with DISPOSITION field #30.
"^DD",2,2.101,100.21,9)
^
"^DD",2,2.101,100.21,"DT")
3020419
**END**
**END**
