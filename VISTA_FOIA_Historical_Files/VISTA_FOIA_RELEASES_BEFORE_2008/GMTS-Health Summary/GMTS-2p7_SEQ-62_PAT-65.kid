Released GMTS*2.7*65 SEQ #62
Extracted from mail message
**KIDS**:GMTS*2.7*65^

**INSTALL NAME**
GMTS*2.7*65
"BLD",16445,0)
GMTS*2.7*65^HEALTH SUMMARY^0^3040412^y
"BLD",16445,1,0)
^^2^2^3040407^
"BLD",16445,1,1,0)
Please see the National Patch Module for details of the enhancements 
"BLD",16445,1,2,0)
included in patch GMTS*2.7*65.
"BLD",16445,4,0)
^9.64PA^^
"BLD",16445,"INIT")
POST^GMTSP65
"BLD",16445,"KRN",0)
^9.67PA^8989.52^19
"BLD",16445,"KRN",.4,0)
.4
"BLD",16445,"KRN",.4,"NM",0)
^9.68A^^
"BLD",16445,"KRN",.401,0)
.401
"BLD",16445,"KRN",.402,0)
.402
"BLD",16445,"KRN",.403,0)
.403
"BLD",16445,"KRN",.5,0)
.5
"BLD",16445,"KRN",.84,0)
.84
"BLD",16445,"KRN",3.6,0)
3.6
"BLD",16445,"KRN",3.8,0)
3.8
"BLD",16445,"KRN",9.2,0)
9.2
"BLD",16445,"KRN",9.8,0)
9.8
"BLD",16445,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",16445,"KRN",9.8,"NM",1,0)
GMTSPSHO^^0^B26596527
"BLD",16445,"KRN",9.8,"NM","B","GMTSPSHO",1)

"BLD",16445,"KRN",19,0)
19
"BLD",16445,"KRN",19.1,0)
19.1
"BLD",16445,"KRN",101,0)
101
"BLD",16445,"KRN",409.61,0)
409.61
"BLD",16445,"KRN",771,0)
771
"BLD",16445,"KRN",870,0)
870
"BLD",16445,"KRN",8989.51,0)
8989.51
"BLD",16445,"KRN",8989.52,0)
8989.52
"BLD",16445,"KRN",8994,0)
8994
"BLD",16445,"KRN","B",.4,.4)

"BLD",16445,"KRN","B",.401,.401)

"BLD",16445,"KRN","B",.402,.402)

"BLD",16445,"KRN","B",.403,.403)

"BLD",16445,"KRN","B",.5,.5)

"BLD",16445,"KRN","B",.84,.84)

"BLD",16445,"KRN","B",3.6,3.6)

"BLD",16445,"KRN","B",3.8,3.8)

"BLD",16445,"KRN","B",9.2,9.2)

"BLD",16445,"KRN","B",9.8,9.8)

"BLD",16445,"KRN","B",19,19)

"BLD",16445,"KRN","B",19.1,19.1)

"BLD",16445,"KRN","B",101,101)

"BLD",16445,"KRN","B",409.61,409.61)

"BLD",16445,"KRN","B",771,771)

"BLD",16445,"KRN","B",870,870)

"BLD",16445,"KRN","B",8989.51,8989.51)

"BLD",16445,"KRN","B",8989.52,8989.52)

"BLD",16445,"KRN","B",8994,8994)

"BLD",16445,"QUES",0)
^9.62^^
"BLD",16445,"REQB",0)
^9.611^1^1
"BLD",16445,"REQB",1,0)
PSO*7.0*132^2
"BLD",16445,"REQB","B","PSO*7.0*132",1)

"INIT")
POST^GMTSP65
"MBREQ")
0
"PKG",56,-1)
1^1
"PKG",56,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",56,22,0)
^9.49I^1^1
"PKG",56,22,1,0)
2.7^2951020^2960605
"PKG",56,22,1,"PAH",1,0)
65^3040412^1362
"PKG",56,22,1,"PAH",1,1,0)
^^2^2^3040412
"PKG",56,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details of the enhancements 
"PKG",56,22,1,"PAH",1,1,2,0)
included in patch GMTS*2.7*65.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMTSP65")
0^^B18212423
"RTN","GMTSP65",1,0)
GMTSP65 ; SLC OIFO/GS - Post Install GMTS*2.7*65    ; 04/09/2004
"RTN","GMTSP65",2,0)
 ;;2.7;Health Summary;**65**;Oct 20, 1995
"RTN","GMTSP65",3,0)
 Q
"RTN","GMTSP65",4,0)
POST ; Post-Install
"RTN","GMTSP65",5,0)
 D HOME^%ZIS N ENV S ENV=$$ENV Q:'ENV  D REM,CI,RDV
"RTN","GMTSP65",6,0)
 Q
"RTN","GMTSP65",7,0)
CI ; Component Install
"RTN","GMTSP65",8,0)
 N GMTSIN,GMTSLIM,GMTSINST,GMTSTL,GMTSINST,GMTSTOT,GMTSBLD
"RTN","GMTSP65",9,0)
 N GMTSCPS,GMTSCP,GMTSCI
"RTN","GMTSP65",10,0)
 S GMTSCPS="RXNV"
"RTN","GMTSP65",11,0)
 F GMTSCI=1:1 Q:'$L($P(GMTSCPS,";",GMTSCI))  D
"RTN","GMTSP65",12,0)
 . S GMTSCP=$P(GMTSCPS,";",GMTSCI) K GMTSIN
"RTN","GMTSP65",13,0)
 . D ARRAY Q:'$D(GMTSIN)
"RTN","GMTSP65",14,0)
 . I $L($G(GMTSIN("TIM"))),+($G(GMTSIN(0)))>0 S GMTSLIM(+($G(GMTSIN(0))),"TIM")=$G(GMTSIN("TIM"))
"RTN","GMTSP65",15,0)
 . I $L($G(GMTSIN("OCC"))),+($G(GMTSIN(0)))>0 S GMTSLIM(+($G(GMTSIN(0))),"OCC")=$G(GMTSIN("OCC"))
"RTN","GMTSP65",16,0)
 . S GMTSINST=$$ADD^GMTSXPD1(.GMTSIN),GMTSTOT=+($G(GMTSTOT))+($G(GMTSINST))
"RTN","GMTSP65",17,0)
 ; Rebuild Ad Hoc Health Summary Type
"RTN","GMTSP65",18,0)
 D:+($G(GMTSTOT))>0 BUILD^GMTSXPD3
"RTN","GMTSP65",19,0)
 D LIM
"RTN","GMTSP65",20,0)
 I +$$ROK("GMTSXPS1")>0 D
"RTN","GMTSP65",21,0)
 . N GMTSHORT
"RTN","GMTSP65",22,0)
 . S GMTSHORT=1,GMTSINST="",GMTSBLD="GMTS*2.7*65"
"RTN","GMTSP65",23,0)
 . D SEND^GMTSXPS1
"RTN","GMTSP65",24,0)
 Q
"RTN","GMTSP65",25,0)
REM ; Remove Component
"RTN","GMTSP65",26,0)
 N DA,DIK,GMTST,GMTSC,GMTSD
"RTN","GMTSP65",27,0)
 S (GMTST,GMTSD)=0
"RTN","GMTSP65",28,0)
 ;   From Health Summary Type File 142
"RTN","GMTSP65",29,0)
 F  S GMTST=$O(^GMT(142,"AE",243,GMTST)) Q:+GMTST=0  D
"RTN","GMTSP65",30,0)
 . S GMTSC=0 F  S GMTSC=$O(^GMT(142,"AE",243,GMTST,GMTSC)) Q:+GMTSC=0  D
"RTN","GMTSP65",31,0)
 . . Q:$P($G(^GMT(142,GMTST,1,GMTSC,0)),"^",2)'=243  S GMTSD=GMTSD+1
"RTN","GMTSP65",32,0)
 . . K ^GMT(142,GMTST,1,GMTSC),^GMT(142,GMTST,1,"B",GMTSC),^GMT(142,GMTST,1,"C",243)
"RTN","GMTSP65",33,0)
 I GMTSD>1 K ^GMT(142,"AE",243)
"RTN","GMTSP65",34,0)
 ;   From Health Summary Component File 142.1
"RTN","GMTSP65",35,0)
 S DA=243,DIK="^GMT(142.1," D ^DIK
"RTN","GMTSP65",36,0)
 ;   From PDX Segment File 394.1
"RTN","GMTSP65",37,0)
 ;      Previous RXNV Component
"RTN","GMTSP65",38,0)
 S DA=+($O(^VAT(394.71,"C","RXNV",0))) I +DA>0 S DIK="^VAT(394.71," D ^DIK
"RTN","GMTSP65",39,0)
 ;      Previous NVM Component
"RTN","GMTSP65",40,0)
 S DA=+($O(^VAT(394.71,"C","NVM",0))) I +DA>0 S DIK="^VAT(394.71," D ^DIK
"RTN","GMTSP65",41,0)
 ;      Previous HOTC Component
"RTN","GMTSP65",42,0)
 S DA=+($O(^VAT(394.71,"C","HOTC",0))) I +DA>0 S DIK="^VAT(394.71," D ^DIK
"RTN","GMTSP65",43,0)
 ;      Previous "Non-va Medications" Component
"RTN","GMTSP65",44,0)
 S DA=+($O(^VAT(394.71,"B","Non-va Medications",0))) I +DA>0 S DIK="^VAT(394.71," D ^DIK
"RTN","GMTSP65",45,0)
 Q
"RTN","GMTSP65",46,0)
RDV ; Remote Data View - Outpatient Meds
"RTN","GMTSP65",47,0)
 N COM,TYP,HDR,TTL,TIM,DA,DIK,DIE,DIC,DA
"RTN","GMTSP65",48,0)
 S COM=$O(^GMT(142.1,"C","RXNV",0)) Q:+COM'>0
"RTN","GMTSP65",49,0)
 S TYP=$O(^GMT(142,"B","REMOTE OUTPATIENT MEDS (6M)",0)) Q:+TYP=0
"RTN","GMTSP65",50,0)
 S HDR=$P($G(^GMT(142.1,+COM,0)),"^",9) Q:'$L(HDR)
"RTN","GMTSP65",51,0)
 S TTL=$P($G(^GMT(142.1,+COM,0)),"^",1) Q:'$L(TTL)  S TIM="6M"
"RTN","GMTSP65",52,0)
 S DA(1)=+TYP,(DIE,DIK,DIC)="^GMT(142,"_DA(1)_",1,",DA=15 D ^DIK
"RTN","GMTSP65",53,0)
 D BMES^XPDUTL(" Adding the '"_TTL_"' Health Summary Component")
"RTN","GMTSP65",54,0)
 D MES^XPDUTL(" to the 'REMOTE OUTPATIENT MEDS (6M)' Remote Data View Health")
"RTN","GMTSP65",55,0)
 D MES^XPDUTL(" Summary Type"),MES^XPDUTL("")
"RTN","GMTSP65",56,0)
 K ^GMT(142,"AE",243,5000014,15),^GMT(142,5000014,1,"B",15,15),^GMT(142,5000014,1,"C",243,15)
"RTN","GMTSP65",57,0)
 S ^GMT(142,DA(1),1,DA,0)="15^"_COM_"^^"_TIM_"^"_HDR
"RTN","GMTSP65",58,0)
 S ^GMT(142,DA(1),1,"B",DA,DA)="",^GMT(142,DA(1),1,"C",COM,DA)=""
"RTN","GMTSP65",59,0)
 K DA S DA=+TYP,DIK="^GMT(142," D IX1^DIK
"RTN","GMTSP65",60,0)
 Q
"RTN","GMTSP65",61,0)
ARRAY ; Build Array
"RTN","GMTSP65",62,0)
 K GMTSIN N GMTSI,GMTSTXT,GMTSEX,GMTSFLD,GMTSUB,GMTSVAL,GMTSPDX S GMTSPDX=1,GMTSCP=$G(GMTSCP) Q:'$L(GMTSCP)
"RTN","GMTSP65",63,0)
 F GMTSI=1:1 D  Q:'$L(GMTSTXT)
"RTN","GMTSP65",64,0)
 . S GMTSTXT="",GMTSEX="S GMTSTXT=$T("_GMTSCP_"+"_GMTSI_")" X GMTSEX S:$L(GMTSTXT,";")'>3 GMTSTXT="" Q:'$L(GMTSTXT)
"RTN","GMTSP65",65,0)
 . S GMTSFLD=$P(GMTSTXT,";",2),GMTSUB=$P(GMTSTXT,";",3),GMTSVAL=$P(GMTSTXT,";",4)
"RTN","GMTSP65",66,0)
 . S:$E(GMTSFLD,1)=1&(+GMTSFLD<2) GMTSVAL=$P(GMTSTXT,";",4,5)
"RTN","GMTSP65",67,0)
 . S:$E(GMTSFLD,1)=" "!('$L(GMTSFLD)) GMTSTXT="" Q:GMTSTXT=""
"RTN","GMTSP65",68,0)
 . S:$L(GMTSFLD)&('$L(GMTSUB)) GMTSIN(GMTSFLD)=GMTSVAL Q:$L(GMTSFLD)&('$L(GMTSUB))  S:$L(GMTSFLD)&($L(GMTSUB)) GMTSIN(GMTSFLD,GMTSUB)=GMTSVAL
"RTN","GMTSP65",69,0)
 . S:$G(GMTSFLD)=7&(+($G(GMTSUB))>0) GMTSPDX=0
"RTN","GMTSP65",70,0)
 K:+($G(GMTSPDX))=0 GMTSIN("PDX")
"RTN","GMTSP65",71,0)
 Q
"RTN","GMTSP65",72,0)
LIM ; Limits
"RTN","GMTSP65",73,0)
 N GMTSI,GMTST,GMTSO,GMTSA S GMTSI=0 F  S GMTSI=$O(GMTSLIM(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSP65",74,0)
 . S GMTSA=$P($G(^GMT(142.1,+($G(GMTSI)),0)),"^",3),GMTST=$G(GMTSLIM(+GMTSI,"TIM")) S:'$L(GMTST) GMTST=$S(GMTSA="Y ":"1Y ",1:"")
"RTN","GMTSP65",75,0)
 . S GMTSA=$P($G(^GMT(142.1,+($G(GMTSI)),0)),"^",5),GMTSO=$G(GMTSLIM(+GMTSI,"OCC")) S:'$L(GMTSO) GMTSO=$S(GMTSA="Y ":"10 ",1:"")
"RTN","GMTSP65",76,0)
 . D TO^GMTSXPD3(GMTSI,GMTST,GMTSO)
"RTN","GMTSP65",77,0)
 Q
"RTN","GMTSP65",78,0)
ENV(X) ; Environment check
"RTN","GMTSP65",79,0)
 D HOME^%ZIS S U="^"
"RTN","GMTSP65",80,0)
 I $$GET1^DIQ(200,+($G(DUZ)),.01)="" W !!,"    User (DUZ) not defined",! Q 0
"RTN","GMTSP65",81,0)
 Q 1
"RTN","GMTSP65",82,0)
ROK(X) ; Routine OK
"RTN","GMTSP65",83,0)
 S X=$G(X) Q:'$L(X) 0
"RTN","GMTSP65",84,0)
 N GMTSEX,GMTSTXT S GMTSEX="S GMTSTXT=$T(+1^"_X_")" X GMTSEX
"RTN","GMTSP65",85,0)
 Q:'$L(GMTSTXT) 0
"RTN","GMTSP65",86,0)
 Q 1
"RTN","GMTSP65",87,0)
 ;                
"RTN","GMTSP65",88,0)
RXNV ; Non VA Meds Component Data
"RTN","GMTSP65",89,0)
 ;0;;243
"RTN","GMTSP65",90,0)
 ;.01;;NON VA MEDICATIONS
"RTN","GMTSP65",91,0)
 ;1;;MAIN;GMTSPSHO
"RTN","GMTSP65",92,0)
 ;1.1;;1
"RTN","GMTSP65",93,0)
 ;1.1;1;PSOHCSUM
"RTN","GMTSP65",94,0)
 ;2;;Y
"RTN","GMTSP65",95,0)
 ;3;;RXNV
"RTN","GMTSP65",96,0)
 ;3.5;;2
"RTN","GMTSP65",97,0)
 ;3.5;1;This component displays the non-VA medications taken or
"RTN","GMTSP65",98,0)
 ;3.5;2;reported as used by a patient.
"RTN","GMTSP65",99,0)
 ;4;;Y
"RTN","GMTSP65",100,0)
 ;5;;
"RTN","GMTSP65",101,0)
 ;6;;
"RTN","GMTSP65",102,0)
 ;7;;0
"RTN","GMTSP65",103,0)
 ;8;;
"RTN","GMTSP65",104,0)
 ;9;;Non VA Meds
"RTN","GMTSP65",105,0)
 ;10;;
"RTN","GMTSP65",106,0)
 ;11;;
"RTN","GMTSP65",107,0)
 ;12;;
"RTN","GMTSP65",108,0)
 ;13;;PS
"RTN","GMTSP65",109,0)
 ;14;;
"RTN","GMTSP65",110,0)
 ;PDX;;1
"RTN","GMTSP65",111,0)
 ;TIM;;1Y
"RTN","GMTSP65",112,0)
 ;OCC;;10
"RTN","GMTSP65",113,0)
 ;
"RTN","GMTSP65",114,0)
 Q
"RTN","GMTSP65",115,0)
 ;
"RTN","GMTSPSHO")
0^1^B26596527
"RTN","GMTSPSHO",1,0)
GMTSPSHO ; SLC OIFO/GS - Herbal/OTC Medications Health Summary; 01/26/2004
"RTN","GMTSPSHO",2,0)
 ;;2.7;Health Summary;**65**;Oct 20, 1995
"RTN","GMTSPSHO",3,0)
 ;v6;04/07/2004
"RTN","GMTSPSHO",4,0)
 ;
"RTN","GMTSPSHO",5,0)
 ; External References
"RTN","GMTSPSHO",6,0)
 ;   DBIA    330  ^PSOHCSUM which includes ^TMP("PSOO",$J)
"RTN","GMTSPSHO",7,0)
 ;   DBIA  10003  DD^%DT
"RTN","GMTSPSHO",8,0)
 ;   DBIA  10035  ^DPT(  file #2
"RTN","GMTSPSHO",9,0)
 ;   DBAI  10060  ^VA(200
"RTN","GMTSPSHO",10,0)
 ;                 
"RTN","GMTSPSHO",11,0)
 ; Format of ^TMP("PS00",$J,"NVA",ILFD,0) as G1 aka GMRC
"RTN","GMTSPSHO",12,0)
 ;  (see also ^PSOHCSUM):
"RTN","GMTSPSHO",13,0)
 ;                 
"RTN","GMTSPSHO",14,0)
 ; Field Descriptions    Defined                 AKA/Notes
"RTN","GMTSPSHO",15,0)
 ; Orderable Item        $P(G1,U)                Includes dosage form
"RTN","GMTSPSHO",16,0)
 ;                                                 (File # 50.7)
"RTN","GMTSPSHO",17,0)
 ; Status                $P(G1,U,2)
"RTN","GMTSPSHO",18,0)
 ; Discontinued Date     $P(G1,U,7)              FM format
"RTN","GMTSPSHO",19,0)
 ; Order #               $P(G1,U,4)              CPRS Order #  ptr to
"RTN","GMTSPSHO",20,0)
 ;                                                 File #100
"RTN","GMTSPSHO",21,0)
 ; Documented By         $P($P(G1,U,6),";",2)    Doc. by Name  ptr to
"RTN","GMTSPSHO",22,0)
 ;                                                 File #200 is $P(x;1)
"RTN","GMTSPSHO",23,0)
 ; Documented Date       $P(G1,U,5)              FM format (Entered On)
"RTN","GMTSPSHO",24,0)
 ; Clinic                $P($P(G2,U,5),";",2)    Clinic Name  ptr to
"RTN","GMTSPSHO",25,0)
 ;                                                 File #44 is $P(x;1)
"RTN","GMTSPSHO",26,0)
 ; Date Started          $P(G1,U,3)              FM format (Start Date)
"RTN","GMTSPSHO",27,0)
 ; Drug                  $P($P(G2,U,4),";",2)    Drug name (Dispensed)
"RTN","GMTSPSHO",28,0)
 ;                                                 ptr to f#50 is $P(x;1)
"RTN","GMTSPSHO",29,0)
 ; Dosage                $P(G2,U)
"RTN","GMTSPSHO",30,0)
 ; Medication Route      $P(G2,U,2)
"RTN","GMTSPSHO",31,0)
 ; Schedule              $P(G2,U,3)
"RTN","GMTSPSHO",32,0)
 ; Statement/Explanation ^TMP("PSOO",$J,"NVA",ILFD,"DSC",nn,0)
"RTN","GMTSPSHO",33,0)
 ;                 
"RTN","GMTSPSHO",34,0)
 ;      where G1=^TMP("PSOO",$J,"NVA",ILFD,0)
"RTN","GMTSPSHO",35,0)
 ;            G2=^TMP("PSOO",$J,"NVA",ILFD,1,0)
"RTN","GMTSPSHO",36,0)
 ;            nn & nnn = sequentual integers
"RTN","GMTSPSHO",37,0)
 ;                 
"RTN","GMTSPSHO",38,0)
 ; Variables  Descriptions
"RTN","GMTSPSHO",39,0)
 ; CT         Counter of number of Herbal/OTC/Non-VA drugs for patient
"RTN","GMTSPSHO",40,0)
 ; DFN        Patient internal number passed in
"RTN","GMTSPSHO",41,0)
 ; DGR        Documented by's degree
"RTN","GMTSPSHO",42,0)
 ; ILFD       Inverse Last Fill Date (FM format)
"RTN","GMTSPSHO",43,0)
 ; JOB        $J
"RTN","GMTSPSHO",44,0)
 ; G1,G2      Abstracted data strings from ^TMP("PSOO", - see MAIN & WRT
"RTN","GMTSPSHO",45,0)
 ; GMT*       Variables used by HS pagination routine (GMTSUP), e.g.,
"RTN","GMTSPSHO",46,0)
 ;               GMTSLPG=last page, GMTSTITL=title
"RTN","GMTSPSHO",47,0)
 ; LL*        Line lengths ('^' delimited) for override reason & S/E
"RTN","GMTSPSHO",48,0)
 ; NEWFORM    ;
"RTN","GMTSPSHO",49,0)
 ; NL         Sequential line counter for override reasons &
"RTN","GMTSPSHO",50,0)
 ;               statement/explanation
"RTN","GMTSPSHO",51,0)
 ; T1,T2,T3   Integer tab stops for data display - see MAIN
"RTN","GMTSPSHO",52,0)
 ; T4         Tab stops (#,#) for override reason display
"RTN","GMTSPSHO",53,0)
 ; T5         Tab stops for Stmt/Expln display
"RTN","GMTSPSHO",54,0)
 ; V          Line header verbiage describing data displayed
"RTN","GMTSPSHO",55,0)
 ; VARY       Array of verbiage to be displayed (override reason & S/E)
"RTN","GMTSPSHO",56,0)
 ; Y          Scratch system variable
"RTN","GMTSPSHO",57,0)
 ;
"RTN","GMTSPSHO",58,0)
 ; Global Variables (variables defined outside this routine)
"RTN","GMTSPSHO",59,0)
 ; DFN, GMTSNPG, GMTSQIT
"RTN","GMTSPSHO",60,0)
 ;                 
"RTN","GMTSPSHO",61,0)
MAIN ; Herbal/Over-the-Counter/Non-VA Medications
"RTN","GMTSPSHO",62,0)
 N CHAW,CLL,CT,DGR,G1,G2,GMTOP,GMX,I,ILFD,ILN,JOB,LINE,LL
"RTN","GMTSPSHO",63,0)
 N LL5,LP,MAX,NL,OLN,PLN,T1,T2,T3,T4,T5,V,VARY,VO,X,Y
"RTN","GMTSPSHO",64,0)
 S ILFD=0,JOB=$J,LL5="40^65"
"RTN","GMTSPSHO",65,0)
 S T1=16,T2=58,T3=33,T4="25,10",T5="33,10"
"RTN","GMTSPSHO",66,0)
 ; Set variables for use by report pagination routine (GMTSUP)
"RTN","GMTSPSHO",67,0)
 S CT=0,MAX=999,GMX=0
"RTN","GMTSPSHO",68,0)
 ; Check to see if a patient IEN is defined
"RTN","GMTSPSHO",69,0)
 I DFN="" D CKFORM W !?8,"No patient selected" Q
"RTN","GMTSPSHO",70,0)
 ; Check page line count and print new page and header if necessary
"RTN","GMTSPSHO",71,0)
 D CKFORM Q:$D(GMTSQIT)
"RTN","GMTSPSHO",72,0)
 ; Output header for report
"RTN","GMTSPSHO",73,0)
 D:GMTSNPG!(GMX'>0) HDR Q:$D(GMTSQIT)  D CKFORM Q:$D(GMTSQIT)
"RTN","GMTSPSHO",74,0)
 W:'GMTOP ! S GMTOP=0,GMX=1
"RTN","GMTSPSHO",75,0)
 ; Run Pharmacy extraction
"RTN","GMTSPSHO",76,0)
 D ^PSOHCSUM  ; DBIA 330
"RTN","GMTSPSHO",77,0)
 ; Quit if no herbals/non-VA drugs extracted - ^TMP("PSOO") via DBIA 330
"RTN","GMTSPSHO",78,0)
 I '$D(^TMP("PSOO",JOB,"NVA")) D CKFORM W !,?8,"No Non-VA Meds Extracted" Q
"RTN","GMTSPSHO",79,0)
 ; Loop through ^TMP global array created by ^PSOHCSUM  ; DBIA 330
"RTN","GMTSPSHO",80,0)
 ;   Quit if   1  Inverse Last Fill Date =0
"RTN","GMTSPSHO",81,0)
 ;             2  Counter is not less than Max Occurrence
"RTN","GMTSPSHO",82,0)
 ;             3  User has "up-arrowed" out of the display
"RTN","GMTSPSHO",83,0)
 F  S ILFD=$O(^TMP("PSOO",JOB,"NVA",ILFD)) Q:+ILFD=0!(CT'<MAX)!($D(GMTSQIT))  D
"RTN","GMTSPSHO",84,0)
 . S G1=^TMP("PSOO",JOB,"NVA",ILFD,0)
"RTN","GMTSPSHO",85,0)
 . S G2=^TMP("PSOO",JOB,"NVA",ILFD,1,0),CT=CT+1
"RTN","GMTSPSHO",86,0)
 . D WRT
"RTN","GMTSPSHO",87,0)
 K ^TMP("PSOO",$J)  ;delete temporary file created via PSOHCSUM
"RTN","GMTSPSHO",88,0)
 Q
"RTN","GMTSPSHO",89,0)
 ;                 
"RTN","GMTSPSHO",90,0)
WRT ; Write Data
"RTN","GMTSPSHO",91,0)
 D CKFORM Q:$D(GMTSQIT)  ;line/pagination check - repeated ad nauseum
"RTN","GMTSPSHO",92,0)
 D:GMTSNPG!(GMX'>0) HDR Q:$D(GMTSQIT)
"RTN","GMTSPSHO",93,0)
 D CKFORM Q:$D(GMTSQIT)
"RTN","GMTSPSHO",94,0)
 S V="Non-VA Med: " W !?T1-$L(V),V,$P(G1,U)
"RTN","GMTSPSHO",95,0)
 D CKFORM Q:$D(GMTSQIT)
"RTN","GMTSPSHO",96,0)
 S V="Status: " W !?T1-$L(V),V,$P(G1,U,2)
"RTN","GMTSPSHO",97,0)
 ; Display discontinued date if it exists (assume discontinued status)
"RTN","GMTSPSHO",98,0)
 S Y=$P(G1,U,7) I Y D DD^%DT W " (",$P(Y,"@"),")"  ; DBIA 10003
"RTN","GMTSPSHO",99,0)
 S V="CPRS Order #: " W ?T2-$L(V),V,$P(G1,U,4)
"RTN","GMTSPSHO",100,0)
 D CKFORM Q:$D(GMTSQIT)
"RTN","GMTSPSHO",101,0)
 S V="Documented By: " W !?T1-$L(V),V,$P($P(G1,U,6),";",2)
"RTN","GMTSPSHO",102,0)
 I $P($P(G1,U,6),";") D DEGREE W:DGR'="" ",",DGR
"RTN","GMTSPSHO",103,0)
 S V="Documented Date: ",Y=$P(G1,U,5) D DD^%DT W ?T2-$L(V),V,Y  ; DBIA 10003
"RTN","GMTSPSHO",104,0)
 D CKFORM Q:$D(GMTSQIT)
"RTN","GMTSPSHO",105,0)
 S V="Clinic: "
"RTN","GMTSPSHO",106,0)
 W !?T1-$L(V),V,$P($P(G2,U,5),";"),"-",$P($P(G2,U,5),";",2)
"RTN","GMTSPSHO",107,0)
 S V="Start Date: ",Y=$P(G1,U,3) D DD^%DT W ?T2-$L(V),V,Y  ; DBIA 10003
"RTN","GMTSPSHO",108,0)
 D CKFORM Q:$D(GMTSQIT)
"RTN","GMTSPSHO",109,0)
 S V="Dispense Drug: " W !?T1-$L(V),V,$P($P(G2,U,4),";",2)
"RTN","GMTSPSHO",110,0)
 S V="Dosage: " W ?T2-$L(V),V,$P(G2,U)
"RTN","GMTSPSHO",111,0)
 D CKFORM Q:$D(GMTSQIT)
"RTN","GMTSPSHO",112,0)
 S V="Med Route: " W !?T1-$L(V),V,$P(G2,U,2)
"RTN","GMTSPSHO",113,0)
 S V="Schedule: " W ?T2-$L(V),V,$P(G2,U,3)
"RTN","GMTSPSHO",114,0)
 S V="Statement/Explanation/Comment: ",NL=""
"RTN","GMTSPSHO",115,0)
 D CKFORM Q:$D(GMTSQIT)
"RTN","GMTSPSHO",116,0)
 W !
"RTN","GMTSPSHO",117,0)
 D CKFORM Q:$D(GMTSQIT)
"RTN","GMTSPSHO",118,0)
 W !?T3-$L(V),V
"RTN","GMTSPSHO",119,0)
 K V M V=^TMP("PSOO",JOB,"NVA",ILFD,"DSC")
"RTN","GMTSPSHO",120,0)
 ; Statement/Explanation verbiage
"RTN","GMTSPSHO",121,0)
 D LINES(LL5,.V) K V D LINESOUT(T5)
"RTN","GMTSPSHO",122,0)
 D CKFORM W !
"RTN","GMTSPSHO",123,0)
 K VO,X,Y
"RTN","GMTSPSHO",124,0)
 Q
"RTN","GMTSPSHO",125,0)
 ;
"RTN","GMTSPSHO",126,0)
LINESOUT(TN) ;WRITE LINES
"RTN","GMTSPSHO",127,0)
 F  S NL=$O(VO(NL)) Q:NL=""!$D(GMTSQIT)  D
"RTN","GMTSPSHO",128,0)
 . I NL=1 W ?$P(TN,","),VO(NL)
"RTN","GMTSPSHO",129,0)
 . E  D CKFORM Q:$D(GMTSQIT)  W !?$P(T4,",",2),VO(NL)
"RTN","GMTSPSHO",130,0)
 Q
"RTN","GMTSPSHO",131,0)
 ;                 
"RTN","GMTSPSHO",132,0)
LINES(LL,V) ;BREAK LINES OF AN ARRAY INTO APPROPRIATE MAX LENGTHS
"RTN","GMTSPSHO",133,0)
 ;                 
"RTN","GMTSPSHO",134,0)
 ; Input:
"RTN","GMTSPSHO",135,0)
 ; LL   = line lengths, e.g., 20^30^40 where last remains default
"RTN","GMTSPSHO",136,0)
 ; V    = input array w/ no null lines, use " " for blank line
"RTN","GMTSPSHO",137,0)
 ;                 
"RTN","GMTSPSHO",138,0)
 ;Output:
"RTN","GMTSPSHO",139,0)
 ; OV   = output array of lines broken into specified maximum lengths
"RTN","GMTSPSHO",140,0)
 ;                 
"RTN","GMTSPSHO",141,0)
 ; This subroutine takes an array of text (V) and breaks the text into
"RTN","GMTSPSHO",142,0)
 ;   line lengths as dictated via LL. Where the first line length (max)
"RTN","GMTSPSHO",143,0)
 ;   of the resulting array (VO) will be (approximately, based on line
"RTN","GMTSPSHO",144,0)
 ;   contents) $P(LL,"^",1), the second line length (max) will be
"RTN","GMTSPSHO",145,0)
 ;   $P(LL,"^",2), etc. The last line length in LL becomes the default
"RTN","GMTSPSHO",146,0)
 ;   maximum line length for all the remaining lines.
"RTN","GMTSPSHO",147,0)
 ;                 
"RTN","GMTSPSHO",148,0)
 ; This subroutine is useful if you want lines output in different
"RTN","GMTSPSHO",149,0)
 ;   lengths.
"RTN","GMTSPSHO",150,0)
 ;                 
"RTN","GMTSPSHO",151,0)
 ; Variables used:
"RTN","GMTSPSHO",152,0)
 ; CHAW   = the next piece of a line of a maximum byte length
"RTN","GMTSPSHO",153,0)
 ; CLL    = current line length (max)
"RTN","GMTSPSHO",154,0)
 ; I      = scratch variable
"RTN","GMTSPSHO",155,0)
 ; ILN    = input array line number
"RTN","GMTSPSHO",156,0)
 ; LP     = pointer indicating where in a line the last chaw taken
"RTN","GMTSPSHO",157,0)
 ; OLN    = output (resulting) line number
"RTN","GMTSPSHO",158,0)
 ; PLN    = previous line length (max)
"RTN","GMTSPSHO",159,0)
 ; X      = line being parsed for a breaking point
"RTN","GMTSPSHO",160,0)
 ;                 
"RTN","GMTSPSHO",161,0)
 N CHAW,CLL,ILN,LP,OLN,PLN
"RTN","GMTSPSHO",162,0)
 K VO
"RTN","GMTSPSHO",163,0)
 S (I,ILN,X)="",OLN=1,CLL=$P(LL,U,OLN),PLN=CLL
"RTN","GMTSPSHO",164,0)
 F  S ILN=$O(V(ILN)) Q:ILN=""  S LP=1 D
"RTN","GMTSPSHO",165,0)
 . S I=$E($RE(V(ILN,0)))
"RTN","GMTSPSHO",166,0)
 . S V(ILN,0)=V(ILN,0)_$S("!?."[I:"  ",",;:"[I!(I?1A):" ",1:"")
"RTN","GMTSPSHO",167,0)
 . I V(ILN,0)=" " S:X'="" VO(OLN)=X,X="",OLN=OLN+1 S VO(OLN)=" ",OLN=OLN+1 Q
"RTN","GMTSPSHO",168,0)
 . F  S CHAW=$E(V(ILN,0),LP,LP+CLL-$L(X)),LP=LP+$L(CHAW),X=X_CHAW Q:CHAW=""!($L(X)<CLL)  D
"RTN","GMTSPSHO",169,0)
 .. I $L(X)<CLL S VO(OLN)=X,X="" D LINESET Q
"RTN","GMTSPSHO",170,0)
 .. I X'[" "&($L(X)=CLL) S VO(OLN)=X_"-",X="" D LINESET Q
"RTN","GMTSPSHO",171,0)
 .. F I=$L(X):-1:1 Q:$E(X,I)=" "!($E(X,I)="-")
"RTN","GMTSPSHO",172,0)
 .. S VO(OLN)=$E(X,1,I),X=$E(X,I+1,999) D LINESET
"RTN","GMTSPSHO",173,0)
 S:X'="" VO(OLN)=X
"RTN","GMTSPSHO",174,0)
 Q
"RTN","GMTSPSHO",175,0)
 ;                 
"RTN","GMTSPSHO",176,0)
LINESET ; Used by LINES for setting variables
"RTN","GMTSPSHO",177,0)
 S OLN=OLN+1,PLN=CLL,CLL=$P(LL,U,OLN) S:+CLL=0 CLL=PLN
"RTN","GMTSPSHO",178,0)
 Q
"RTN","GMTSPSHO",179,0)
 ;
"RTN","GMTSPSHO",180,0)
CKFORM ; Checks to determine whether to do a form feed or not
"RTN","GMTSPSHO",181,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSHO",182,0)
 Q
"RTN","GMTSPSHO",183,0)
 ;
"RTN","GMTSPSHO",184,0)
HDR ; Prints Header
"RTN","GMTSPSHO",185,0)
 S GMTOP=1
"RTN","GMTSPSHO",186,0)
 I GMX'>0 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSHO",187,0)
 I 'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSHO",188,0)
 Q
"RTN","GMTSPSHO",189,0)
 ;
"RTN","GMTSPSHO",190,0)
DEGREE ; Gets degree of 'Documented by' individual & converts to upper case
"RTN","GMTSPSHO",191,0)
 S DGR=$$GET1^DIQ(200,$P($P(G1,U,6),";"),10.6)  ; DBIA 10060
"RTN","GMTSPSHO",192,0)
 S DGR=$TR(DGR,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSPSHO",193,0)
 Q
"VER")
8.0^22.0
**END**
**END**
