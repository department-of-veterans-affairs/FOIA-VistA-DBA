Released XM*7.1*31 SEQ #30
Extracted from mail message
**KIDS**:XM*7.1*31^

**INSTALL NAME**
XM*7.1*31
"BLD",11,0)
XM*7.1*31^MAILMAN^0^2961210^n
"BLD",11,1,0)
^^122^122^2961210^^^^
"BLD",11,1,1,0)
MailMan Patch XM*7.1*31
"BLD",11,1,2,0)

"BLD",11,1,3,0)
NOIS: BRX-0496-11847     Routines: ^XMA5,^XMA5A
"BLD",11,1,4,0)
 Fixes subscript error when  QD'ing numeric recipients, such as those
"BLD",11,1,5,0)
 @AOL.COM
"BLD",11,1,6,0)

"BLD",11,1,7,0)
NOIS: DAY-0995-40521     Routines: ^XMA21
"BLD",11,1,8,0)
 Removes phantom recipients when using XMY array during programmer calls
"BLD",11,1,9,0)
 to ^XMB(bulletin) or ^XMD(message).
"BLD",11,1,10,0)

"BLD",11,1,11,0)
NOIS: NAS-1295-30255     Routines: ^XMB1
"BLD",11,1,12,0)
      CLE-0396-41473
"BLD",11,1,13,0)
 Later'd messages report will now appear even if ^'d out of prior option.
"BLD",11,1,14,0)

"BLD",11,1,15,0)
NOIS: BRX-0396-10222     Routines: ^XMAD2
"BLD",11,1,16,0)
      MAD-0196-40136
"BLD",11,1,17,0)
      MCM-0896-50571
"BLD",11,1,18,0)
 Fixes error caused by Later'd messages becoming new after the user has
"BLD",11,1,19,0)
 been deactivated and deleted from ^XMB(3.7.
"BLD",11,1,20,0)

"BLD",11,1,21,0)
NOIS: TOM-1195-41441     Routines: ^XMA21
"BLD",11,1,22,0)
 Sender doesn't have to broadcast twice when forwarding.
"BLD",11,1,23,0)

"BLD",11,1,24,0)
NOIS: CMO-1195-40423     Routines: ^XMA24
"BLD",11,1,25,0)
 Lets sender deselect ('-*') broadcast.
"BLD",11,1,26,0)

"BLD",11,1,27,0)
NOIS: FTM-1195-41507     Routines: ^XMA24
"BLD",11,1,28,0)
 Ask sender for basket when sending to SHARED,MAIL, whether or not "ask
"BLD",11,1,29,0)
 basket" is set to "yes".
"BLD",11,1,30,0)

"BLD",11,1,31,0)
NOIS: GRJ-1094-50087      Routines: ^XMA21G
"BLD",11,1,32,0)
 Make error message clearer by changing from "not found" to "mail group
"BLD",11,1,33,0)
 not found".
"BLD",11,1,34,0)

"BLD",11,1,35,0)
NOIS: none                Routines: ^XMA21,^XMA210
"BLD",11,1,36,0)
 No Nois, refer to FORUM mail msg 19872177.
"BLD",11,1,37,0)
 If user enters a number in response to 'send to:' prompt, and the DUZ is
"BLD",11,1,38,0)
 not found in ^VA(200, MailMan will no longer try to use the number as an
"BLD",11,1,39,0)
 IEN to pick out a mail name or remote user.
"BLD",11,1,40,0)

"BLD",11,1,41,0)
NOIS: MWV-0396-21324      Routines: ^XMA21,^XMA21G
"BLD",11,1,42,0)
 This concerns what happens when a user deselects an addressee (-name or
"BLD",11,1,43,0)
 -g.group) at a 'send to:' prompt, after already broadcasting ('*').
"BLD",11,1,44,0)
 If "-g.group", MailMan lets the user know that the message will still go
"BLD",11,1,45,0)
 to all local users.
"BLD",11,1,46,0)
 If "-name", MailMan checks to see if the "name" is already specified as a
"BLD",11,1,47,0)
 recipient.  If he is, then MailMan tells the user that the message will still
"BLD",11,1,48,0)
 go to all local users.  If he isn't, then MailMan just tells the user that
"BLD",11,1,49,0)
 "name" is not found.
"BLD",11,1,50,0)

"BLD",11,1,51,0)
E3R: 8885                 Routines: ^XMA21
"BLD",11,1,52,0)
 Removes all SSN cross-references from the lookup at the 'Send to:' prompt. 
"BLD",11,1,53,0)
 This ensures that if the user enters a number, it cannot partial match  (and
"BLD",11,1,54,0)
 display) an SSN.  Lookup on the ^VA(200 is now confined to the following
"BLD",11,1,55,0)
 cross references:  NAME(B), ALIAS(BB), INITIAL(C), NICK NAME(D) 
"BLD",11,1,56,0)

"BLD",11,1,57,0)
NOIS: ALB-0596-50002      Routines: ^XMRENT
"BLD",11,1,58,0)
 Prevents an error from occuring when the SENDER field (piece 4) of a message
"BLD",11,1,59,0)
 is zero.
"BLD",11,1,60,0)

"BLD",11,1,61,0)
NOIS: DAY-1096-41059      Routines: ^XMGAPI0
"BLD",11,1,62,0)
 If a message subject is longer than 65 characters, it is truncated to the
"BLD",11,1,63,0)
 first 250 characters.
"BLD",11,1,64,0)

"BLD",11,1,65,0)
NOIS: ANN-1096-41381      Routines: ^XMRPCTS0
"BLD",11,1,66,0)
 Check to make sure a task is running, rather than just assuming it is.
"BLD",11,1,67,0)

"BLD",11,1,68,0)
NOIS: WPB-0894-30125      Routine: ^XMA1
"BLD",11,1,69,0)
 The default message action for a message which is NEWed is IGNORE, even if
"BLD",11,1,70,0)
 the site or the user has specified that the default message action is
"BLD",11,1,71,0)
 DELETE.  If a user deletes a message after NEWing it, the message will be
"BLD",11,1,72,0)
 deleted.  The default is changed only for the duration of your actions on
"BLD",11,1,73,0)
 that particular message.  When you get to the next message, your default is
"BLD",11,1,74,0)
 whatever it is supposed to be. 
"BLD",11,1,75,0)
===========================================================================
"BLD",11,1,76,0)

"BLD",11,1,77,0)
 This patch should be installed after hours, when user activity is at a
"BLD",11,1,78,0)
 minimum.  You should put the XMUSER Option out of order.
"BLD",11,1,79,0)
===========================================================================
"BLD",11,1,80,0)
 
"BLD",11,1,81,0)
INSTALLATION:
"BLD",11,1,82,0)
  1.  This routine is usually mapped on systems that allow mapping,
"BLD",11,1,83,0)
      so you will need to disable mapping for the affected routine.
"BLD",11,1,84,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"BLD",11,1,85,0)
      option will load the KIDS package onto your system.
"BLD",11,1,86,0)
  3.  The patch has now been loaded into a Transport global on your
"BLD",11,1,87,0)
      system. You now need to use KIDS to install the Transport global.
"BLD",11,1,88,0)
  4.  On the KIDS menu, under the 'Installation' menu, use the following
"BLD",11,1,89,0)
      options:
"BLD",11,1,90,0)
         Verify Checksums in Transport Global
"BLD",11,1,91,0)
         Print Transport Global
"BLD",11,1,92,0)
         Compare Transport Global to Current System
"BLD",11,1,93,0)
         Backup a Transport Global
"BLD",11,1,94,0)
         Install Package(s)
"BLD",11,1,95,0)
  5.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"BLD",11,1,96,0)
      other CPUs?'. Enter the names of your Compute and Print server(s).
"BLD",11,1,97,0)
  6.  AXP Sites, after patch has installed, rebuild your map set.
"BLD",11,1,98,0)
============================================================================ 
"BLD",11,1,99,0)
  
"BLD",11,1,100,0)
 ROUTINES:
"BLD",11,1,101,0)
   The second line of the routine now looks like:
"BLD",11,1,102,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"BLD",11,1,103,0)
 
"BLD",11,1,104,0)
               Before          After
"BLD",11,1,105,0)
 Name          Checksum        Checksum        Patch List
"BLD",11,1,106,0)
 ---------------------------------------------------------- 
"BLD",11,1,107,0)
 XMA1          10558704         9575986         31
"BLD",11,1,108,0)
 XMA21          9603768        11321545         4,31
"BLD",11,1,109,0)
 XMA210         1925522         1920955         31
"BLD",11,1,110,0)
 XMA21G        10231186         9710102         31
"BLD",11,1,111,0)
 XMA24         10412829        10721719         31
"BLD",11,1,112,0)
 XMA5          11164486        11197080         31
"BLD",11,1,113,0)
 XMA5A         14101090        14213526         31
"BLD",11,1,114,0)
 XMAD2          2440129         2503657         31
"BLD",11,1,115,0)
 XMB1           8922945         8930890         31
"BLD",11,1,116,0)
 XMGAPI0        2337589         2451955         31
"BLD",11,1,117,0)
 XMRENT         2314897         2303842         31
"BLD",11,1,118,0)
 XMRPCTS        5007367         4760679         6,11,31
"BLD",11,1,119,0)
 XMRPCTS0       5966846         6044236         6,12,31
"BLD",11,1,120,0)
 XMRPCTSA       4903763         3483840         6,31
"BLD",11,1,121,0)

"BLD",11,1,122,0)
============================================================================
"BLD",11,4,0)
^9.64PA^^
"BLD",11,"KRN",0)
^9.67PA^19^12
"BLD",11,"KRN",.4,0)
.4
"BLD",11,"KRN",.401,0)
.401
"BLD",11,"KRN",.402,0)
.402
"BLD",11,"KRN",.403,0)
.403
"BLD",11,"KRN",.5,0)
.5
"BLD",11,"KRN",.84,0)
.84
"BLD",11,"KRN",3.6,0)
3.6
"BLD",11,"KRN",3.8,0)
3.8
"BLD",11,"KRN",9.2,0)
9.2
"BLD",11,"KRN",9.8,0)
9.8
"BLD",11,"KRN",9.8,"NM",0)
^9.68A^14^14
"BLD",11,"KRN",9.8,"NM",1,0)
XMA5^^0^B20327713
"BLD",11,"KRN",9.8,"NM",2,0)
XMA5A^^0^B20361654
"BLD",11,"KRN",9.8,"NM",3,0)
XMA21^^0^B29596033
"BLD",11,"KRN",9.8,"NM",4,0)
XMB1^^0^B14448591
"BLD",11,"KRN",9.8,"NM",5,0)
XMAD2^^0^B4070811
"BLD",11,"KRN",9.8,"NM",6,0)
XMA24^^0^B14768306
"BLD",11,"KRN",9.8,"NM",7,0)
XMA21G^^0^B19123999
"BLD",11,"KRN",9.8,"NM",8,0)
XMA210^^0^B2974564
"BLD",11,"KRN",9.8,"NM",9,0)
XMGAPI0^^0^B3592452
"BLD",11,"KRN",9.8,"NM",10,0)
XMRENT^^0^B3571865
"BLD",11,"KRN",9.8,"NM",11,0)
XMRPCTS0^^0^B14039893
"BLD",11,"KRN",9.8,"NM",12,0)
XMA1^^0^B19622495
"BLD",11,"KRN",9.8,"NM",13,0)
XMRPCTS^^0^B7962541
"BLD",11,"KRN",9.8,"NM",14,0)
XMRPCTSA^^0^B7379810
"BLD",11,"KRN",9.8,"NM","B","XMA1",12)

"BLD",11,"KRN",9.8,"NM","B","XMA21",3)

"BLD",11,"KRN",9.8,"NM","B","XMA210",8)

"BLD",11,"KRN",9.8,"NM","B","XMA21G",7)

"BLD",11,"KRN",9.8,"NM","B","XMA24",6)

"BLD",11,"KRN",9.8,"NM","B","XMA5",1)

"BLD",11,"KRN",9.8,"NM","B","XMA5A",2)

"BLD",11,"KRN",9.8,"NM","B","XMAD2",5)

"BLD",11,"KRN",9.8,"NM","B","XMB1",4)

"BLD",11,"KRN",9.8,"NM","B","XMGAPI0",9)

"BLD",11,"KRN",9.8,"NM","B","XMRENT",10)

"BLD",11,"KRN",9.8,"NM","B","XMRPCTS",13)

"BLD",11,"KRN",9.8,"NM","B","XMRPCTS0",11)

"BLD",11,"KRN",9.8,"NM","B","XMRPCTSA",14)

"BLD",11,"KRN",19,0)
19
"BLD",11,"KRN",19,"NM",0)
^9.68A^^
"BLD",11,"KRN",19.1,0)
19.1
"BLD",11,"KRN","B",.4,.4)

"BLD",11,"KRN","B",.401,.401)

"BLD",11,"KRN","B",.402,.402)

"BLD",11,"KRN","B",.403,.403)

"BLD",11,"KRN","B",.5,.5)

"BLD",11,"KRN","B",.84,.84)

"BLD",11,"KRN","B",3.6,3.6)

"BLD",11,"KRN","B",3.8,3.8)

"BLD",11,"KRN","B",9.2,9.2)

"BLD",11,"KRN","B",9.8,9.8)

"BLD",11,"KRN","B",19,19)

"BLD",11,"KRN","B",19.1,19.1)

"BLD",11,"QUES",0)
^9.62^^
"PKG",6,-1)
1^1
"PKG",6,0)
MAILMAN^XM^Electronic Mail, both local and networked
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.1^2940602^2950925
"PKG",6,22,1,"PAH",1,0)
31^2961210
"PKG",6,22,1,"PAH",1,1,0)
^^122^122^2961210
"PKG",6,22,1,"PAH",1,1,1,0)
MailMan Patch XM*7.1*31
"PKG",6,22,1,"PAH",1,1,2,0)

"PKG",6,22,1,"PAH",1,1,3,0)
NOIS: BRX-0496-11847     Routines: ^XMA5,^XMA5A
"PKG",6,22,1,"PAH",1,1,4,0)
 Fixes subscript error when  QD'ing numeric recipients, such as those
"PKG",6,22,1,"PAH",1,1,5,0)
 @AOL.COM
"PKG",6,22,1,"PAH",1,1,6,0)

"PKG",6,22,1,"PAH",1,1,7,0)
NOIS: DAY-0995-40521     Routines: ^XMA21
"PKG",6,22,1,"PAH",1,1,8,0)
 Removes phantom recipients when using XMY array during programmer calls
"PKG",6,22,1,"PAH",1,1,9,0)
 to ^XMB(bulletin) or ^XMD(message).
"PKG",6,22,1,"PAH",1,1,10,0)

"PKG",6,22,1,"PAH",1,1,11,0)
NOIS: NAS-1295-30255     Routines: ^XMB1
"PKG",6,22,1,"PAH",1,1,12,0)
      CLE-0396-41473
"PKG",6,22,1,"PAH",1,1,13,0)
 Later'd messages report will now appear even if ^'d out of prior option.
"PKG",6,22,1,"PAH",1,1,14,0)

"PKG",6,22,1,"PAH",1,1,15,0)
NOIS: BRX-0396-10222     Routines: ^XMAD2
"PKG",6,22,1,"PAH",1,1,16,0)
      MAD-0196-40136
"PKG",6,22,1,"PAH",1,1,17,0)
      MCM-0896-50571
"PKG",6,22,1,"PAH",1,1,18,0)
 Fixes error caused by Later'd messages becoming new after the user has
"PKG",6,22,1,"PAH",1,1,19,0)
 been deactivated and deleted from ^XMB(3.7.
"PKG",6,22,1,"PAH",1,1,20,0)

"PKG",6,22,1,"PAH",1,1,21,0)
NOIS: TOM-1195-41441     Routines: ^XMA21
"PKG",6,22,1,"PAH",1,1,22,0)
 Sender doesn't have to broadcast twice when forwarding.
"PKG",6,22,1,"PAH",1,1,23,0)

"PKG",6,22,1,"PAH",1,1,24,0)
NOIS: CMO-1195-40423     Routines: ^XMA24
"PKG",6,22,1,"PAH",1,1,25,0)
 Lets sender deselect ('-*') broadcast.
"PKG",6,22,1,"PAH",1,1,26,0)

"PKG",6,22,1,"PAH",1,1,27,0)
NOIS: FTM-1195-41507     Routines: ^XMA24
"PKG",6,22,1,"PAH",1,1,28,0)
 Ask sender for basket when sending to SHARED,MAIL, whether or not "ask
"PKG",6,22,1,"PAH",1,1,29,0)
 basket" is set to "yes".
"PKG",6,22,1,"PAH",1,1,30,0)

"PKG",6,22,1,"PAH",1,1,31,0)
NOIS: GRJ-1094-50087      Routines: ^XMA21G
"PKG",6,22,1,"PAH",1,1,32,0)
 Make error message clearer by changing from "not found" to "mail group
"PKG",6,22,1,"PAH",1,1,33,0)
 not found".
"PKG",6,22,1,"PAH",1,1,34,0)

"PKG",6,22,1,"PAH",1,1,35,0)
NOIS: none                Routines: ^XMA21,^XMA210
"PKG",6,22,1,"PAH",1,1,36,0)
 No Nois, refer to FORUM mail msg 19872177.
"PKG",6,22,1,"PAH",1,1,37,0)
 If user enters a number in response to 'send to:' prompt, and the DUZ is
"PKG",6,22,1,"PAH",1,1,38,0)
 not found in ^VA(200, MailMan will no longer try to use the number as an
"PKG",6,22,1,"PAH",1,1,39,0)
 IEN to pick out a mail name or remote user.
"PKG",6,22,1,"PAH",1,1,40,0)

"PKG",6,22,1,"PAH",1,1,41,0)
NOIS: MWV-0396-21324      Routines: ^XMA21,^XMA21G
"PKG",6,22,1,"PAH",1,1,42,0)
 This concerns what happens when a user deselects an addressee (-name or
"PKG",6,22,1,"PAH",1,1,43,0)
 -g.group) at a 'send to:' prompt, after already broadcasting ('*').
"PKG",6,22,1,"PAH",1,1,44,0)
 If "-g.group", MailMan lets the user know that the message will still go
"PKG",6,22,1,"PAH",1,1,45,0)
 to all local users.
"PKG",6,22,1,"PAH",1,1,46,0)
 If "-name", MailMan checks to see if the "name" is already specified as a
"PKG",6,22,1,"PAH",1,1,47,0)
 recipient.  If he is, then MailMan tells the user that the message will still
"PKG",6,22,1,"PAH",1,1,48,0)
 go to all local users.  If he isn't, then MailMan just tells the user that
"PKG",6,22,1,"PAH",1,1,49,0)
 "name" is not found.
"PKG",6,22,1,"PAH",1,1,50,0)

"PKG",6,22,1,"PAH",1,1,51,0)
E3R: 8885                 Routines: ^XMA21
"PKG",6,22,1,"PAH",1,1,52,0)
 Removes all SSN cross-references from the lookup at the 'Send to:' prompt. 
"PKG",6,22,1,"PAH",1,1,53,0)
 This ensures that if the user enters a number, it cannot partial match  (and
"PKG",6,22,1,"PAH",1,1,54,0)
 display) an SSN.  Lookup on the ^VA(200 is now confined to the following
"PKG",6,22,1,"PAH",1,1,55,0)
 cross references:  NAME(B), ALIAS(BB), INITIAL(C), NICK NAME(D) 
"PKG",6,22,1,"PAH",1,1,56,0)

"PKG",6,22,1,"PAH",1,1,57,0)
NOIS: ALB-0596-50002      Routines: ^XMRENT
"PKG",6,22,1,"PAH",1,1,58,0)
 Prevents an error from occuring when the SENDER field (piece 4) of a message
"PKG",6,22,1,"PAH",1,1,59,0)
 is zero.
"PKG",6,22,1,"PAH",1,1,60,0)

"PKG",6,22,1,"PAH",1,1,61,0)
NOIS: DAY-1096-41059      Routines: ^XMGAPI0
"PKG",6,22,1,"PAH",1,1,62,0)
 If a message subject is longer than 65 characters, it is truncated to the
"PKG",6,22,1,"PAH",1,1,63,0)
 first 250 characters.
"PKG",6,22,1,"PAH",1,1,64,0)

"PKG",6,22,1,"PAH",1,1,65,0)
NOIS: ANN-1096-41381      Routines: ^XMRPCTS0
"PKG",6,22,1,"PAH",1,1,66,0)
 Check to make sure a task is running, rather than just assuming it is.
"PKG",6,22,1,"PAH",1,1,67,0)

"PKG",6,22,1,"PAH",1,1,68,0)
NOIS: WPB-0894-30125      Routine: ^XMA1
"PKG",6,22,1,"PAH",1,1,69,0)
 The default message action for a message which is NEWed is IGNORE, even if
"PKG",6,22,1,"PAH",1,1,70,0)
 the site or the user has specified that the default message action is
"PKG",6,22,1,"PAH",1,1,71,0)
 DELETE.  If a user deletes a message after NEWing it, the message will be
"PKG",6,22,1,"PAH",1,1,72,0)
 deleted.  The default is changed only for the duration of your actions on
"PKG",6,22,1,"PAH",1,1,73,0)
 that particular message.  When you get to the next message, your default is
"PKG",6,22,1,"PAH",1,1,74,0)
 whatever it is supposed to be. 
"PKG",6,22,1,"PAH",1,1,75,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,76,0)

"PKG",6,22,1,"PAH",1,1,77,0)
 This patch should be installed after hours, when user activity is at a
"PKG",6,22,1,"PAH",1,1,78,0)
 minimum.  You should put the XMUSER Option out of order.
"PKG",6,22,1,"PAH",1,1,79,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,80,0)
 
"PKG",6,22,1,"PAH",1,1,81,0)
INSTALLATION:
"PKG",6,22,1,"PAH",1,1,82,0)
  1.  This routine is usually mapped on systems that allow mapping,
"PKG",6,22,1,"PAH",1,1,83,0)
      so you will need to disable mapping for the affected routine.
"PKG",6,22,1,"PAH",1,1,84,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"PKG",6,22,1,"PAH",1,1,85,0)
      option will load the KIDS package onto your system.
"PKG",6,22,1,"PAH",1,1,86,0)
  3.  The patch has now been loaded into a Transport global on your
"PKG",6,22,1,"PAH",1,1,87,0)
      system. You now need to use KIDS to install the Transport global.
"PKG",6,22,1,"PAH",1,1,88,0)
  4.  On the KIDS menu, under the 'Installation' menu, use the following
"PKG",6,22,1,"PAH",1,1,89,0)
      options:
"PKG",6,22,1,"PAH",1,1,90,0)
         Verify Checksums in Transport Global
"PKG",6,22,1,"PAH",1,1,91,0)
         Print Transport Global
"PKG",6,22,1,"PAH",1,1,92,0)
         Compare Transport Global to Current System
"PKG",6,22,1,"PAH",1,1,93,0)
         Backup a Transport Global
"PKG",6,22,1,"PAH",1,1,94,0)
         Install Package(s)
"PKG",6,22,1,"PAH",1,1,95,0)
  5.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"PKG",6,22,1,"PAH",1,1,96,0)
      other CPUs?'. Enter the names of your Compute and Print server(s).
"PKG",6,22,1,"PAH",1,1,97,0)
  6.  AXP Sites, after patch has installed, rebuild your map set.
"PKG",6,22,1,"PAH",1,1,98,0)
============================================================================ 
"PKG",6,22,1,"PAH",1,1,99,0)
  
"PKG",6,22,1,"PAH",1,1,100,0)
 ROUTINES:
"PKG",6,22,1,"PAH",1,1,101,0)
   The second line of the routine now looks like:
"PKG",6,22,1,"PAH",1,1,102,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"PKG",6,22,1,"PAH",1,1,103,0)
 
"PKG",6,22,1,"PAH",1,1,104,0)
               Before          After
"PKG",6,22,1,"PAH",1,1,105,0)
 Name          Checksum        Checksum        Patch List
"PKG",6,22,1,"PAH",1,1,106,0)
 ---------------------------------------------------------- 
"PKG",6,22,1,"PAH",1,1,107,0)
 XMA1          10558704         9575986         31
"PKG",6,22,1,"PAH",1,1,108,0)
 XMA21          9603768        11321545         4,31
"PKG",6,22,1,"PAH",1,1,109,0)
 XMA210         1925522         1920955         31
"PKG",6,22,1,"PAH",1,1,110,0)
 XMA21G        10231186         9710102         31
"PKG",6,22,1,"PAH",1,1,111,0)
 XMA24         10412829        10721719         31
"PKG",6,22,1,"PAH",1,1,112,0)
 XMA5          11164486        11197080         31
"PKG",6,22,1,"PAH",1,1,113,0)
 XMA5A         14101090        14213526         31
"PKG",6,22,1,"PAH",1,1,114,0)
 XMAD2          2440129         2503657         31
"PKG",6,22,1,"PAH",1,1,115,0)
 XMB1           8922945         8930890         31
"PKG",6,22,1,"PAH",1,1,116,0)
 XMGAPI0        2337589         2451955         31
"PKG",6,22,1,"PAH",1,1,117,0)
 XMRENT         2314897         2303842         31
"PKG",6,22,1,"PAH",1,1,118,0)
 XMRPCTS        5007367         4760679         6,11,31
"PKG",6,22,1,"PAH",1,1,119,0)
 XMRPCTS0       5966846         6044236         6,12,31
"PKG",6,22,1,"PAH",1,1,120,0)
 XMRPCTSA       4903763         3483840         6,31
"PKG",6,22,1,"PAH",1,1,121,0)

"PKG",6,22,1,"PAH",1,1,122,0)
============================================================================
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","XMA1")
0^12^B19622495
"RTN","XMA1",1,0)
XMA1 ;(WASH ISC)/CAP/THM-ACTIONS ;10/17/96  14:01
"RTN","XMA1",2,0)
 ;;7.1;MailMan;**31**;Jun 02, 1994
"RTN","XMA1",3,0)
CBASK D C2 I $D(XMAN),$L(XMAN)>1 S X=$E(XMAN,2) K XMAN G C3
"RTN","XMA1",4,0)
C1 G Q:$E($G(XMA1))="^"
"RTN","XMA1",5,0)
 ;
"RTN","XMA1",6,0)
 ;Display Other Body parts (BLOBs)
"RTN","XMA1",7,0)
 ;
"RTN","XMA1",8,0)
 I '$G(XMAPBLOB),$O(^MAG(2005,0)) D @($S($G(IOT)="IMPC":"BLOB",1:"NODISP")_"^XMAPBLOB")
"RTN","XMA1",9,0)
 ;
"RTN","XMA1",10,0)
 S Y="IGNORE (in" I XMDUZ'=.6,XMK=1,'$G(XMNEW) S X=$S($D(XMDISPI):$P(XMDISPI,U,2),1:"") I $L(X) S Y=$S(X="D":"DELETE (from",X="T":"TERMINATE (from",1:"IGNORE (in")
"RTN","XMA1",11,0)
 W !!,"Select MESSAGE Action: "_Y_" " W:$L(XMKN) XMKN_" " W "basket)" W "// " R X:DTIME S:'$T X=U
"RTN","XMA1",12,0)
 W ! S:X="" X=$P(Y," ") S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","XMA1",13,0)
 F %="QUERY","QN","QD" I $E(%,1,$L($P(X," ")))=$P(X," ") G UP
"RTN","XMA1",14,0)
 I X["?" S XQH="XMR-ACTION" D EN^XQH G C1:$S(XMDUZ'=.5:1,XMK<1001:1,1:0) D PRIOH^XMC4 G C1
"RTN","XMA1",15,0)
C3 K XMA21G S XMA1=X S:$E(X)="^" X=$E(X,2,99)
"RTN","XMA1",16,0)
 G Q:XMA1="^" I $E("IGNORE",1,$L(X))=X D ENI^XMA10 G Q
"RTN","XMA1",17,0)
 I $P(XMR,U,7)="S" D SPOOL^XMAH G C1:X[U
"RTN","XMA1",18,0)
D I $E("DELETE",1,$L(X))=X,XMK G C1:$$SHARE^XMA1B(0) D  G END
"RTN","XMA1",19,0)
 . D BEG
"RTN","XMA1",20,0)
 . S XMKD=XMK
"RTN","XMA1",21,0)
 . S:$D(XMDN) XMDI=XMDN
"RTN","XMA1",22,0)
 . D KLQ^XMA1B
"RTN","XMA1",23,0)
 . S:'$D(XMKS) XMKS=""
"RTN","XMA1",24,0)
 . D NUMB^XMA03:XMKS=""
"RTN","XMA1",25,0)
 . W:$P($G(XMTYPE),";")'="Terminate" !,"Deleted !!"
"RTN","XMA1",26,0)
 . K XMNEW
"RTN","XMA1",27,0)
 . D KNEW
"RTN","XMA1",28,0)
 I "FXLNSQ"'[X S I=$O(^XMB(3.9,XMZ,2,.999)) I I S I=^(I,0) I $L($P(I,U,2)) G ENT0^XMAH:$E(I,1,4)="$TXT"
"RTN","XMA1",29,0)
 I "LNS"'[X,XMDUZ'=DUZ G ENT1^XMAH:"Yy"[$E($P(XMR,U,11)_" ")
"RTN","XMA1",30,0)
 I $E("TERMINATE",1,$L(X))=X G C1:$$SHARE^XMA1B(0),T
"RTN","XMA1",31,0)
 I $E("SAVE",1,$L(X))=X D S^XMA1B G QQ
"RTN","XMA1",32,0)
 I $E("LATER",1,$L(X))=X G POST^XMB1:XMDUZ'=.6 D SH^XMA1B G C1
"RTN","XMA1",33,0)
 I $E("BACKUP",1,$L(X))=X D E G C1
"RTN","XMA1",34,0)
 I $E("WRITE",1,$L(X))=X!($E("ANSWER",1,$L(X))=X) G GC1:XMDUZ=.6,NO:$D(XMNOSEND) D WRITE^XMA11A G C1
"RTN","XMA1",35,0)
 I $E("EDIT",1,$L(X))=X G GC1:XMDUZ=.6 I XME D EDIT^XMA11 G C1:$D(^XMB(3.9,XMZ)),Q
"RTN","XMA1",36,0)
 I $E("VAPORIZE",1,$L(X))=X G C1:$$SHARE^XMA1B(0),DATE^XMA11A
"RTN","XMA1",37,0)
 I $E("FORWARD",1,$L(X))=X G:$P(XMR,U,2)'=XMDUZ NF^XMA11:"Yy"[$E($P(XMR,U,9)_" ") G:XMDUZ=.6 GC1:$P(XMR,U,2)'=DUZ D FWD^XMA1A G C1
"RTN","XMA1",38,0)
 I $E("REPLY",1,$L(X))=X G NO:$D(XMNOSEND),^XMAH1
"RTN","XMA1",39,0)
 I $E("HEADERLESS",1,$L(X))=X!($E("PRINT",1,$L(X))=X) G:XMDUZ=.5&(XMK>999) SN^XMA1E S XMP=$E(X)="H"+1,XMA1P=1 D ENTPRT^XMA0 K XMP,XMA1P G C1
"RTN","XMA1",40,0)
 I "X"[X G GC1:XMDUZ=.6 G ENT0^XMAH:'$D(^XUSEC("XUPROGMODE",DUZ)) S X=XMZ,DIC(0)="N" D MM^XMP G C1
"RTN","XMA1",41,0)
 I $E("NEW",1,$L(X))=X G GC1:XMDUZ=.6 S XMNEW=$S('$D(^XMB(3.7,XMDUZ,2,XMK,1,XMZ,0)):1,$P(^(0),U,3)+0=0:1,1:0) W "  Will be new next time." G C1
"RTN","XMA1",42,0)
 I $E("COPY",1,$L(X))=X G SN^XMA1E:XMDUZ=.5&(XMK>999),CN^XMA1E:$L($P(XMR,U,10)),GC1:XMDUZ=.6&($P(XMR,U,2)'=DUZ),NO:$D(XMNOSEND),^XMA2C
"RTN","XMA1",43,0)
 I $E(X)="K" G ENTK^XMA10
"RTN","XMA1",44,0)
ER W *7,"'",X,"' is not a valid command.  Enter '???' or 'help' for help." G C1
"RTN","XMA1",45,0)
C2 S XMZO=XMZ,XMKO=XMK_U_XMR D CONF
"RTN","XMA1",46,0)
 S XMZ=XMZO,XMK=+XMKO,XMR=$P(XMKO,U,2,99),XME=$S($P(XMR,U,2)=XMDUZ:1,XMDUZ=.5:$S(XMK>1000:1,1:0),1:0) Q
"RTN","XMA1",47,0)
 ;
"RTN","XMA1",48,0)
GC1 D SH^XMA1B G C1
"RTN","XMA1",49,0)
ZTSK ;
"RTN","XMA1",50,0)
 S XMDUZ=XMB("XMDUZ"),XMZ=XMB("XMZ"),XMKM=1 D S2^XMA1B G NNEW^XMA
"RTN","XMA1",51,0)
CONF I XMDUZ'=DUZ Q:"Yy"[$E($P(XMR,U,11)_" ")
"RTN","XMA1",52,0)
 G CONF^XMA1A
"RTN","XMA1",53,0)
T I $S($G(XMRC)="":1,'$D(^XMB(3.9,XMZ,1,XMRC)):1,1:0) S X="D" G D
"RTN","XMA1",54,0)
 D BEG S X="N",%DT="T" D ^%DT S ^XMB(3.9,XMZ,1,XMRC,"D")=Y
"RTN","XMA1",55,0)
 I $P($G(XMTYPE),";")'="Terminate" D T2
"RTN","XMA1",56,0)
 K XMNEW
"RTN","XMA1",57,0)
 S XMKD=XMK D KLQ^XMA1B,KNEW
"RTN","XMA1",58,0)
 G END
"RTN","XMA1",59,0)
T2 W !,"You won't see future responses. (IN WASTE basket)" H 1
"RTN","XMA1",60,0)
 Q
"RTN","XMA1",61,0)
UP S %=$P(X," ",2),XMQUE=1 G UQ:X="Q" I $L(X)>2,$L(%) G UE:%=+% S XMQUE=% G UQ
"RTN","XMA1",62,0)
 I $E("QD",1,$L(X))=X S XMQUE=3 G UQ
"RTN","XMA1",63,0)
 I $E("QN",1,$L(X))=X S XMQUE=2 G UQ
"RTN","XMA1",64,0)
 G ER
"RTN","XMA1",65,0)
UE W !,*7,"INTEGERS are not valid names." G UZ
"RTN","XMA1",66,0)
UQ K % D QUER^XMA5
"RTN","XMA1",67,0)
UZ K XMQUE G C1
"RTN","XMA1",68,0)
E ;BACK UP
"RTN","XMA1",69,0)
 G EQ:$G(^XMB(3.9,XMZ,3,0))="" S %1=$P(^(0),U,3) G EQ:%1<1
"RTN","XMA1",70,0)
E0 W !,"There are "_%1_" responses.",!,"Back up to: Original message// "
"RTN","XMA1",71,0)
 R X:DTIME Q:X=U!'$T
"RTN","XMA1",72,0)
 I X=""!("Oo"[$E(X)) S X=0
"RTN","XMA1",73,0)
E1 G EQ:X=0 I X<0 S X=%1+X+1 S:X<0 X=0 G:X=0 E1
"RTN","XMA1",74,0)
 G EQ:+X=X D ENT8^XMAH
"RTN","XMA1",75,0)
 G E
"RTN","XMA1",76,0)
EQ S XMB0=XMZ,XMA0=X,XMBCK=1 K XMAPBLOB D ENTBCK^XMAP,KNEW:'$D(XMNEW) K XMBCK Q
"RTN","XMA1",77,0)
KNEW K XMKD I '$D(XMNEW) G NEW^XMA
"RTN","XMA1",78,0)
 I XMNEW D NNEW^XMA
"RTN","XMA1",79,0)
 K XMNEW,XMS,XMSEC Q
"RTN","XMA1",80,0)
Q S XMHOLD=X D KNEW S X=XMHOLD S:$E($G(XMA1))="^" X="^" K XMHOLD
"RTN","XMA1",81,0)
QQ K XMA1,XMAPBLOB,XMS,XMSEC Q
"RTN","XMA1",82,0)
K S K=$O(^XMB(3.7,XMDUZ,2,"B",K)) Q:K=""  G K:$O(^(K,0))'=XMKM Q
"RTN","XMA1",83,0)
 ;
"RTN","XMA1",84,0)
 ;Response Time Monitor
"RTN","XMA1",85,0)
BEG Q:'$D(XRTL)  S XRTN="XMA1-DEL/TERM" D T0^%ZOSV Q
"RTN","XMA1",86,0)
END Q:'$D(XRT0)  D T1^%ZOSV G QQ
"RTN","XMA1",87,0)
NO G ERR^XMA1A
"RTN","XMA21")
0^3^B29596033
"RTN","XMA21",1,0)
XMA21 ;(WASH ISC)/CAP-MailMan name server ;10/30/96  14:24
"RTN","XMA21",2,0)
 ;;7.1;MailMan;**4,31**;Jun 02, 1994
"RTN","XMA21",3,0)
DESTXM S:$D(^XMB(3.7,XMDUZ)) XMMG=XMDUN S:'$D(XMLOC) XMLOC=0
"RTN","XMA21",4,0)
 G:'$D(^XMB(3.9,XMZ,2,0)) KILL^XMA3
"RTN","XMA21",5,0)
DE2A K XMQ K:'$D(XMCOPY) XMY,XMY0,^TMP("XMY",$J),^TMP("XMY0",$J) I $D(XMYD) S X=XMYD,X=$S(+X'=X&(X'=0):X,'$D(^VA(200,X,0)):X,1:$P(^(0),U)) I X'="" W !!,"In addition to ",X,":" S ^TMP("XMY",$J,X)=XMYD(1),^TMP("XMY0",$J,X)=""
"RTN","XMA21",6,0)
 W !!
"RTN","XMA21",7,0)
 S:'$D(XMLOC) XMLOC=0
"RTN","XMA21",8,0)
DESXM D WHOM^XMA24 Q:X=""&$S($O(^TMP("XMY",$J,""))'="":1,$O(^TMP("XMY0",$J,""))'="":1,1:0)!$D(XMOUT)
"RTN","XMA21",9,0)
 S XMLOC="" D:$E(X)'="*"&$L(X) WHOXM K XMMG G DESXM
"RTN","XMA21",10,0)
 Q
"RTN","XMA21",11,0)
WHOXM S:'$D(XMN) XMN=0 K XMMG S XMMG=""
"RTN","XMA21",12,0)
 D WT^XMA210,W1:'$L(XMMG)
"RTN","XMA21",13,0)
 I $D(XMLOC),(XMMG'=""),'$D(ZTQUEUED) W:$L(XMMG)+$X>IOM ! W "  ",XMMG
"RTN","XMA21",14,0)
 Q
"RTN","XMA21",15,0)
W0 S X1=X N X,XMLOC S X=X1,XMMG=""
"RTN","XMA21",16,0)
ENT ;From XMAD1X
"RTN","XMA21",17,0)
W1 I X["!" S X=$P(X,"!",2)_"@"_$P(X,"!")_".UUCP"
"RTN","XMA21",18,0)
 I X["@" G ^XMA21B
"RTN","XMA21",19,0)
W3 I $E(X)=" " S X=$E(X,2,999) G:X'="" W3 S XMMG="blank name" Q
"RTN","XMA21",20,0)
 I X?1"D.".E!(X?1"d.".E) G DEV
"RTN","XMA21",21,0)
 I X?1"S.".E!(X?1"s.".E) G SER
"RTN","XMA21",22,0)
W2 I X?1"G.".E!(X?1"g.".E) S X=$P(X,".",2,99) G MG
"RTN","XMA21",23,0)
 I $D(XMCHAN) G W5:X="" S Y=$O(^VA(200,"B",X,0)) I Y G W:'$O(^(Y))
"RTN","XMA21",24,0)
 S DIC("W")="I $D(^XMB(3.7,Y,""L"")) W:$X>45 !,?5 W "" Last used MailMan: "",$P(^(""L""),U) W:$D(^XMB(3.7,Y,""B"")) !,?10,^(""B"")"
"RTN","XMA21",25,0)
 S DIC="^VA(200,",DIC(0)="FZMN"_$E("E",$D(XMLOC))
"RTN","XMA21",26,0)
 S DIC("S")="I $L($P(^(0),U,3)),$D(^XMB(3.7,+Y,2))"
"RTN","XMA21",27,0)
 I XMN,$G(XMZ) S DIC("S")=DIC("S")_",$D(^TMP(""XMY"",$J,+Y))"
"RTN","XMA21",28,0)
 I X?.E1L.E S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","XMA21",29,0)
 S D="B^BB^C^D" ; name^alias^initial^nickname
"RTN","XMA21",30,0)
 D MIX^DIC1 K DIC("W"),DIC("S")
"RTN","XMA21",31,0)
 S DIC="^XMB(3.7,",DIC(0)=$TR(DIC(0),"MN")
"RTN","XMA21",32,0)
 G W:Y>0 S D="C" D MIX^DIC1 G W:Y>0
"RTN","XMA21",33,0)
 ;
"RTN","XMA21",34,0)
 ;Incoming netmail
"RTN","XMA21",35,0)
 G W:$D(XMCHAN),W:$G(XMA21AL),W:'$O(^XMD(4.2997,0))
"RTN","XMA21",36,0)
 ;
"RTN","XMA21",37,0)
 I '$D(ZTQUEUED),'$D(XMCHAN) W !,"<< Not a local user, checking Remote User Directory ! >>",!,*7
"RTN","XMA21",38,0)
 I Y<0 S D="B" D DIC^XMA210 I Y'["^",+Y<0 S D="F" D DIC^XMA210
"RTN","XMA21",39,0)
 K XMA21A
"RTN","XMA21",40,0)
 I +Y>0,$P(Y(0),U,7)["@" Q:$G(XMLOCQ)="QUIT"  D REC^XMA210 G ^XMA21B
"RTN","XMA21",41,0)
W I Y>0,XMN D  Q
"RTN","XMA21",42,0)
 . W $S($D(^TMP("XMY",$J,+Y)):"  Deleted.",1:"  Not a current recipient") K ^(+Y),^TMP("XMY0",$J,+Y)
"RTN","XMA21",43,0)
 . Q:'$D(^TMP("XMY",$J,"* (Broadcast to all local users)"))
"RTN","XMA21",44,0)
 . W !!,*7,"Because you have broadcast this message, it will still go to all local users.",!
"RTN","XMA21",45,0)
 G W4:Y'>0,W4:XMN
"RTN","XMA21",46,0)
 S XMA21Y=+Y,XMR=$S('$G(XMZ):"",1:$G(^XMB(3.9,XMZ,0)))
"RTN","XMA21",47,0)
 I +Y=.6,$L(XMR) F %=9,11 I ":Y:y:"[(":"_$P(XMR,U,%)_":") G NOS^XMA210
"RTN","XMA21",48,0)
 S ^TMP("XMY",$J,+Y)="",I=$S($D(^XMB(3.7,+Y,0)):^(0),1:"")
"RTN","XMA21",49,0)
 S:'$D(XMA21G) ^TMP("XMY0",$J,+Y)=""
"RTN","XMA21",50,0)
 S:$P(I,U,2)'="" ^TMP("XMY",$J,+Y,"F")=$P(I,U,2)_U_$P(I,U,8)
"RTN","XMA21",51,0)
 D J,WO K XMA21Y
"RTN","XMA21",52,0)
 Q
"RTN","XMA21",53,0)
WO S %=Y N Y S Y=%
"RTN","XMA21",54,0)
 D:'$D(XMCHAN) ENTB^XMA24:Y-.6=0,BAS^XMA24:$S(XMA21Y=.6:0,XMDUZ=+Y:1,1:0)
"RTN","XMA21",55,0)
 Q
"RTN","XMA21",56,0)
W4 S DIC="^XMB(3.8,",DIC(0)="M" D ^DIC
"RTN","XMA21",57,0)
 G W5:Y'>0 S XMMG="Enter 'G.groupname' to identify a mail group."
"RTN","XMA21",58,0)
Q S Y=-1 Q
"RTN","XMA21",59,0)
W5 S XMMG="Not Found." S:$G(XMA21B1) XMMG("XMA21-LOCAL")=1
"RTN","XMA21",60,0)
 G Q
"RTN","XMA21",61,0)
MG G ENT^XMA21G
"RTN","XMA21",62,0)
INSR S X=$P(Y,U),XMN=0 K XMLOC D INST^XMA21A
"RTN","XMA21",63,0)
 Q
"RTN","XMA21",64,0)
INSTXM G INST^XMA21A
"RTN","XMA21",65,0)
CHK I $D(^XMB(3.8,Y,1,"B",XMDUZ)) Q
"RTN","XMA21",66,0)
 Q
"RTN","XMA21",67,0)
DEV ;
"RTN","XMA21",68,0)
 S X1=X,X=$P(X,".",2),DIC(0)="Z",DIC="^%ZIS(1,"
"RTN","XMA21",69,0)
 D ^DIC I Y<0 S XMMG="Invalid device name "_X Q
"RTN","XMA21",70,0)
 I Y["P-MESSAGE" S XMMG="You may not use P-Message in an address" G Q
"RTN","XMA21",71,0)
DE4 G D:XMN S ^TMP("XMY",$J,X1)=+Y
"RTN","XMA21",72,0)
 I '$D(XMA21(X1,"F")),X1=+X1 S %=$G(^XMB(3.7,X1,0)) I $L($P(%,U,2)) S XMA21(X1,"F")=$P(%,U,2)_U_$P(%,U,8)
"RTN","XMA21",73,0)
 I $D(XMA21(X1,0)) S ^TMP("XMY",$J,X1,0)=XMA21(X1,0)
"RTN","XMA21",74,0)
 I $D(XMA21(X1,1)) S ^TMP("XMY",$J,X1,1)=XMA21(X1,1)
"RTN","XMA21",75,0)
 I $D(XMA21(X1,"F")) S ^TMP("XMY",$J,X1,"F")=XMA21(X1,"F")
"RTN","XMA21",76,0)
 I '$D(XMA21G) S ^TMP("XMY0",$J,X1)=""
"RTN","XMA21",77,0)
 I $D(XMA21(X1,"D")) S ^TMP("XMY",$J,X1,"D")=XMA21(X1,"D")
"RTN","XMA21",78,0)
 Q
"RTN","XMA21",79,0)
D Q:'$D(^TMP("XMY",$J,X1))  K ^(X1),^TMP("XMY0",$J,X1) W "  deleted." Q
"RTN","XMA21",80,0)
 ;
"RTN","XMA21",81,0)
SER S X1=X,Y=0,X=$P(X,".",2),DIC(0)="FZ",DIC="^DIC(19," D ^DIC
"RTN","XMA21",82,0)
 I Y<0 S XMMG="Invalid server name "_X Q
"RTN","XMA21",83,0)
 S (X,X1)="S."_$P(Y,U,2)
"RTN","XMA21",84,0)
 G DE4
"RTN","XMA21",85,0)
DX D DESXM,INST^XMA21A Q:Y<0
"RTN","XMA21",86,0)
 S Y=+Y D PSP^XMA210 W " PATH: ",$P(^DIC(4.2,Y,0),U) G DX
"RTN","XMA21",87,0)
 Q
"RTN","XMA21",88,0)
MMM S X9="" F Y=0:0 D ^DIC Q:Y>0  S X9=X9_$S($L(X9):".",1:"")_$P(X,"."),X=$P(X,".",2,999) I X="" S XMMG="Domain not found." Q
"RTN","XMA21",89,0)
 Q
"RTN","XMA21",90,0)
 ;INFO:, CC:...
"RTN","XMA21",91,0)
J ;Mark rcpt w/prefix (XMA0) on input (INFO:, CC:...)
"RTN","XMA21",92,0)
 I +Y,$D(XMA0),$L(XMA0),$S('$G(XMZ):1,'$D(^XMB(3.9,XMZ,1,"C",+Y)):1,1:0),Y-$P(XMR,U,2)'=0 S ^TMP("XMY",$J,+Y,1)=XMA0
"RTN","XMA21",93,0)
 Q
"RTN","XMA21",94,0)
REDO ;Parse recipient list from callable interfaces (XMB,XMD)
"RTN","XMA21",95,0)
 N %X,%Y,X,X1,XMFINAL,XMN,Y,XMA21
"RTN","XMA21",96,0)
 S XMFINAL=1,XMN=0,%X="XMY(",%Y="XMA21(" D %XY^%RCR
"RTN","XMA21",97,0)
 S %X="XMY(",%Y="^TMP(""XMY0"",$J," D %XY^%RCR K XMY
"RTN","XMA21",98,0)
R S X=$O(XMA21(""))
"RTN","XMA21",99,0)
 I $S(+X=X:1,X="* (Broadcast to all local users)":1,1:0) S X1=X,Y=0 D DE4 K XMA21(X) G R
"RTN","XMA21",100,0)
 I $L(X) D  G R
"RTN","XMA21",101,0)
 . S XMA21=X
"RTN","XMA21",102,0)
 . D WHOXM
"RTN","XMA21",103,0)
 . K XMA21(XMA21)
"RTN","XMA21",104,0)
 . ; The following tests eliminate "phantom" XMY
"RTN","XMA21",105,0)
 . I XMA21["@" D  Q
"RTN","XMA21",106,0)
 . . Q:$P(XMA21,"@",2)[X
"RTN","XMA21",107,0)
 . . I $P(XMA21,"@",1)'=X K ^TMP("XMY0",$J,XMA21),^TMP("XMY",$J,XMA21) Q  ; remote phantom
"RTN","XMA21",108,0)
 . . ; Recipient is really local
"RTN","XMA21",109,0)
 . . Q:".G.g.D.d.S.s."[("."_$E(XMA21,1,2))  ; do nothing - not affected
"RTN","XMA21",110,0)
 . . K:$P(XMA21,"@",1)'=$P(Y,U,2) ^TMP("XMY0",$J,XMA21),^TMP("XMY",$J,XMA21)  ; local phantom
"RTN","XMA21",111,0)
 . Q:".G.g.D.d.S.s."[("."_$E(XMA21,1,2))  ; do nothing - not affected
"RTN","XMA21",112,0)
 . K:XMA21'=$P(Y,U,2) ^TMP("XMY0",$J,XMA21),^TMP("XMY",$J,XMA21)  ; local phantom
"RTN","XMA21",113,0)
 Q
"RTN","XMA21",114,0)
WHO ;Human input
"RTN","XMA21",115,0)
 N DA,DIC,DIE,DR D WHOXM,SW Q
"RTN","XMA21",116,0)
INST ;Correct domain ?
"RTN","XMA21",117,0)
 N DA,DIC,DIE,DR,XMDF,XMQF S XMDF=1,XMQF=1 D INSTXM,SW Q
"RTN","XMA21",118,0)
DES ;Network addresses
"RTN","XMA21",119,0)
 N DA,DIC,DIE,DR D DESXM,SW Q
"RTN","XMA21",120,0)
DEST N DA,DIC,DIE,DR D DESTXM,SW Q
"RTN","XMA21",121,0)
SW S %X="^TMP(""XMY"","_$J_",",%Y="XMY(" D %XY^%RCR
"RTN","XMA21",122,0)
 K ^TMP("XMY",$J),^TMP("XMY0",$J)
"RTN","XMA21",123,0)
 Q
"RTN","XMA210")
0^8^B2974564
"RTN","XMA210",1,0)
XMA210 ;(WASH ISC)/CAP-MailMan name server ;09/26/96  10:41
"RTN","XMA210",2,0)
 ;;7.1;MailMan;**31**;Jun 02, 1994
"RTN","XMA210",3,0)
NOS S XMMG="NO confidential or closed messages may be sent to SHARED,MAIL."
"RTN","XMA210",4,0)
 S Y=-1 Q
"RTN","XMA210",5,0)
 ;
"RTN","XMA210",6,0)
 ;Take care of Info Only, CC...
"RTN","XMA210",7,0)
WT S XMA0="" I X["@",$P(X,"@",2)'=^XMB("NETNAME") Q
"RTN","XMA210",8,0)
 I $P(X,":",2)'="" S XMA0=$P(X,":"),X=$P(X,":",2,99),XMA0=$E(XMA0) S:$A(XMA0)>96 XMA0=$C($A(XMA0)-32)
"RTN","XMA210",9,0)
 I "TIC"'[XMA0 S XMMG="Invalid recipient type"
"RTN","XMA210",10,0)
 I XMA0="T" S XMMG="Not allowed yet"
"RTN","XMA210",11,0)
 Q
"RTN","XMA210",12,0)
PSP ;Resolve queue
"RTN","XMA210",13,0)
 ;
"RTN","XMA210",14,0)
 ;Get RELAY DOMAIN.  If no RELAY DOMAIN put in own queue if subdomain
"RTN","XMA210",15,0)
 N % S (Y3,Y2)="" I $D(^DIC(4.2,+Y,0)) S Y3=^(0),Y2=$P(Y3,U,3) I 'Y2 Q:$L($P(Y3,U))+1=$F($P(Y3,U),^XMB("NETNAME"))
"RTN","XMA210",16,0)
 ;
"RTN","XMA210",17,0)
 ;Send to parent if parent is not same as this domain
"RTN","XMA210",18,0)
 I Y2'="" S Y=+Y2
"RTN","XMA210",19,0)
 Q:$O(^DIC(4.2,+Y,1,0))
"RTN","XMA210",20,0)
 S %=$G(^XMB("PARENT")),Y=$S(%-$G(^XMB("NUM"))>0:%,1:Y)
"RTN","XMA210",21,0)
 Q
"RTN","XMA210",22,0)
DIC ;Remote User Lkup
"RTN","XMA210",23,0)
 N %,%1,DUOUT,DTOUT,XMA21 S %=X N X I D="B"
"RTN","XMA210",24,0)
 S DIC("S")="I $P($P(^(0),U,2),XMA21)=""""" K D
"RTN","XMA210",25,0)
 S X=$F(%_".","."),Y=$F(%_",",","),%1=$S(X>Y:",",1:"."),X=$P(%,%1),XMA21=$P(%,%1,2)
"RTN","XMA210",26,0)
 S DIC="^XMD(4.2997,",DIC(0)="FZ"_$E("E",$D(XMLOC))_$E("M",$G(D)="F")
"RTN","XMA210",27,0)
 D ^DIC K DIC
"RTN","XMA210",28,0)
 I $D(DUOUT)!$D(DTOUT) S Y="^"
"RTN","XMA210",29,0)
 Q
"RTN","XMA210",30,0)
REC ;Mark Remote Recipients entry / extract Address
"RTN","XMA210",31,0)
 S $P(^XMD(4.2997,+Y,0),U,9)=$E(DT,1,5),X=$P(Y(0),U,7)
"RTN","XMA210",32,0)
 Q:$S($D(ZTQUEUED):1,$D(XMCHAN):1,1:0)
"RTN","XMA210",33,0)
 W !!,"<<<  Routing to Remote Address: "_X_". >>>",*7
"RTN","XMA210",34,0)
 Q
"RTN","XMA21G")
0^7^B19123999
"RTN","XMA21G",1,0)
XMA21G ;(WASH ISC)/CAP-Name parser / Group handler ;09/26/96  10:35
"RTN","XMA21G",2,0)
 ;;7.1;MailMan;**31**;Jun 02, 1994
"RTN","XMA21G",3,0)
 ;
"RTN","XMA21G",4,0)
 ;XMUOUT is set if the user really aborts
"RTN","XMA21G",5,0)
 ;XMOUT is set if the user doesn't answer 'Yes' to seeing more recipients
"RTN","XMA21G",6,0)
 ;
"RTN","XMA21G",7,0)
ENT ;FROM NAME SERVER
"RTN","XMA21G",8,0)
 I '$D(XMCHAN) K XMLOC S:'$D(ZTQUEUED) XMLOC=1
"RTN","XMA21G",9,0)
MG D XMR I '$D(XMCHAN),$P(XMR,U,7)["P",XMDUZ'=$P(XMR,U,2),'$D(XMCOPY) G ER
"RTN","XMA21G",10,0)
 S DIC("S")="S J=^(0),XMA=$S($D(^XMB(3.8,+Y,3)):$P(^(3),U),1:.5) I $P(J,U,2)=""PU""!(XMA=XMDUZ)!(+$P(J,U,6)=0&$D(^XMB(3.8,+Y,1,""B"",XMDUZ)))"
"RTN","XMA21G",11,0)
 S DIC="^XMB(3.8,",DIC(0)="M"_$S('$D(XMLOC):"",$D(XMCHAN):"",$D(ZTQUEUED):"",1:"E")_$S($D(XMCHAN):"O",'$D(XMDF):"",1:"O") D ^DIC K DIC S I=+Y I I<0 S XMMG="Mail Group not found " Q
"RTN","XMA21G",12,0)
 I $D(^XMB(3.8,I,4,"B")),'$D(^XMB(3.8,I,4,"B",XMDUZ)) S XMMG="You may not send mail directly to this group" G:$D(XMLOC) ASL^XMA7G Q
"RTN","XMA21G",13,0)
 D NOW^%DTC S %=^XMB(3.8,+Y,0),$P(%,U,4,5)=$P(%,U,4)+1_U_X,^(0)=%,X=$S($D(^XMB(3.8,+Y,1,0)):$P(^(0),U,4),1:0),XME0=$P(%,U,6),XMLOCAL=X
"RTN","XMA21G",14,0)
 I $D(XMLOC),'$D(XMFINAL) D
"RTN","XMA21G",15,0)
 . W !,X_" Local"
"RTN","XMA21G",16,0)
 . W:$D(^XMB(3.8,+Y,5,0)) "    "_$P(^(0),U,4)_" Member Group(s)"
"RTN","XMA21G",17,0)
 . W:$D(^XMB(3.8,+Y,6,0)) "    "_$P(^(0),U,4)_" Other Members"
"RTN","XMA21G",18,0)
 . W:$D(^XMB(3.8,+Y,7,0)) "    "_$P(^(0),U,4)_" Distribution Lists"
"RTN","XMA21G",19,0)
 . W ":",!
"RTN","XMA21G",20,0)
 ;
"RTN","XMA21G",21,0)
 ;EXPAND known group (Y=mail_group#^mail_group_name,I=+Y,XME0=Restrictions)
"RTN","XMA21G",22,0)
GO K XMOUT,XMUOUT
"RTN","XMA21G",23,0)
 D DO
"RTN","XMA21G",24,0)
 I XMN,XMLOCAL,$D(^TMP("XMY",$J,"* (Broadcast to all local users)")) D
"RTN","XMA21G",25,0)
 . Q:$D(XMQUEUED)!$D(XMCHAN)
"RTN","XMA21G",26,0)
 . W !!,*7,"Because you have broadcast this message, it will still go to all local users.",!
"RTN","XMA21G",27,0)
 K XMOUT,XMUOUT,XMA21G,XMLOCAL
"RTN","XMA21G",28,0)
 S XMMG=""
"RTN","XMA21G",29,0)
 Q
"RTN","XMA21G",30,0)
DO G:$G(XMDF) Y:$D(XMFINAL) I 'XMN S ^TMP("XMY0",$J,"G."_$P(Y,U,2)_$S(XME0:" [Private Mail Group]",1:""))=+Y
"RTN","XMA21G",31,0)
 I XMN K ^TMP("XMY0",$J,"G."_$P(Y,U,2))
"RTN","XMA21G",32,0)
 I '$D(XMR) N XMR D XMR
"RTN","XMA21G",33,0)
Y N Y S (XMB0,XMC0,Y)=0,XMANS=1
"RTN","XMA21G",34,0)
 ;Local members
"RTN","XMA21G",35,0)
 S XMD0=1 D YL G YQ:$D(XMUOUT)
"RTN","XMA21G",36,0)
 ;Member Groups
"RTN","XMA21G",37,0)
 I XME0<4 S XMD0=5,Y=0 D YL G YQ:$D(XMUOUT)
"RTN","XMA21G",38,0)
 ;Remote Members
"RTN","XMA21G",39,0)
 I $S('XME0:1,XME0=2:0,XME0=3:0,XME0=6:0,1:1) S XMD0=6,Y=0 D YL I $G(XMOUT)<99 S XMD0=7,Y=0 D YL
"RTN","XMA21G",40,0)
YQ K:'$D(XMD0(0)) XMANS,XME0 K XMD0 Q
"RTN","XMA21G",41,0)
 ;Hit name server for Member-remote
"RTN","XMA21G",42,0)
XMA21 S J=X N %,XMA21G,XMLOC,I,XMD0,XME0,X,Y S X=J,XMA21G=1 G WHOXM^XMA21
"RTN","XMA21G",43,0)
 ;Recurse/(EXPAND) member-group
"RTN","XMA21G",44,0)
YG N I,XMD0,Y,Z S I=+X,XMD0(0)=1 G Y
"RTN","XMA21G",45,0)
 ;Expand Distribution List
"RTN","XMA21G",46,0)
YD N %,%0,D,Y S %0=XMD0(1) K XMD0(1)
"RTN","XMA21G",47,0)
 Q:'$D(^XMB(3.816,%0,0))  S Y=$P(^(0),U)
"RTN","XMA21G",48,0)
 I ".S.s.D.d.G.g."'[("."_$E(Y,1,2)) S Y="G."_Y
"RTN","XMA21G",49,0)
 F %=0:0 S %=$O(^XMB(3.816,%0,1,%)) Q:+%'=%  I $D(^(%,0)) S D=^(0) I $D(^DIC(4.2,D,0)) S X=Y_"@"_$P(^(0),U),Z=X D YLQ S:'XMN ^TMP("XMY",$J,X)=D K:XMN ^TMP("XMY",$J,X)
"RTN","XMA21G",50,0)
 Q
"RTN","XMA21G",51,0)
YL ;Parse different Types of Mail Group Members
"RTN","XMA21G",52,0)
 S Y=$O(^XMB(3.8,I,XMD0,Y)) Q:'Y  D O Q:$D(XMUOUT)  S X=^XMB(3.8,I,XMD0,Y,0)
"RTN","XMA21G",53,0)
 ;I XMD0=1 S Z=$S($D(^VA(200,X,0)):^(0),1:"") G YL:$P(Z,U,3)="",YL:'$D(^XMB(3.7,X,0)) S %=^(0)
"RTN","XMA21G",54,0)
 I XMD0=1 S Z=$S($D(^VA(200,X,0)):^(0),1:""),%=$S($D(^XMB(3.7,X,0)):^(0),1:"No Mailbox "_X)
"RTN","XMA21G",55,0)
 I XMD0=5 G YL:'$D(^XMB(3.8,+X,0)) S Z=^(0) D YLQ,YG S X=$P(Z,U) G YL
"RTN","XMA21G",56,0)
 I XMD0=6 S X=$P(X,U),XMD0=7 D YLQ S XMD0=6 D XMA21 G YL
"RTN","XMA21G",57,0)
 I XMD0=7 S XMD0(1)=+X,X="Distribution List "_$P(^XMB(3.816,+X,0),U) D YLQ,YD G YL
"RTN","XMA21G",58,0)
 ;
"RTN","XMA21G",59,0)
 ;Individuals added/minus'd
"RTN","XMA21G",60,0)
 D YLQ
"RTN","XMA21G",61,0)
 G YL:XMD0'=1 I XMN K ^TMP("XMY",$J,X) G YL
"RTN","XMA21G",62,0)
 I X=.6 W:'$D(ZTQUEUED)&'$D(XMCHAN) !!,*7,"'Shared,Mail' was not included as a recipient of this message !",!! G YL
"RTN","XMA21G",63,0)
 S ^TMP("XMY",$J,X)="" S:$P(%,U,2)'="" ^TMP("XMY",$J,X,"F")=$P(%,U,2)_U_$P(%,U,8)
"RTN","XMA21G",64,0)
 ;INFO:, CC:
"RTN","XMA21G",65,0)
 I X,$D(XMA0),$L(XMA0),'$D(^XMB(3.9,XMZ,1,"C",X)),X-$P(XMR,U,2)'=0 S ^TMP("XMY",$J,X,1)=XMA0
"RTN","XMA21G",66,0)
 G YL
"RTN","XMA21G",67,0)
YLQ N % S %=X N X S X=$S('%:%,1:$P(Z,U))
"RTN","XMA21G",68,0)
 Q:$S('XMANS:1,'$D(XMLOC):1,$D(XMFINAL):1,1:0)
"RTN","XMA21G",69,0)
 S XMB0=XMB0+1,XMC0=XMC0+$S(XMD0=7:4,1:1)
"RTN","XMA21G",70,0)
 Q:$D(XMOUT)  I $S('(XMC0-1#4):1,XMD0=7:1,1:0) W !
"RTN","XMA21G",71,0)
 W ?$S(XMD0=7:0,1:(XMC0-1#4*20)),$E($S(XMN:" Deleted "_X,1:X),1,$S(XMD0=7:79,1:19))
"RTN","XMA21G",72,0)
 Q
"RTN","XMA21G",73,0)
O Q:$S($D(XMOUT):1,$D(XMFINAL):1,XMB0#16:1,'XMB0:1,$O(^XMB(3.8,I,XMD0,Y)):0,1:1)
"RTN","XMA21G",74,0)
 S X=0 R !,"Do you want to see more group members?  NO//",X:DTIME
"RTN","XMA21G",75,0)
 S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","XMA21G",76,0)
 I X["^" S XMOUT=99 Q
"RTN","XMA21G",77,0)
 I $E("NO",1,$L(X))=X S XMOUT=1 W ! Q
"RTN","XMA21G",78,0)
 I $E("YES",1,$L(X))'=X W !,*7,"Answer 'Yes' or 'No' !" G O
"RTN","XMA21G",79,0)
 W ! Q
"RTN","XMA21G",80,0)
ER S XMMG="Only the sender may forward priority messages to Mail Groups !" Q
"RTN","XMA21G",81,0)
XMR S XMR=$S($D(XMR):XMR,'$D(XMZ):"",$D(^XMB(3.9,XMZ,0)):^(0),1:"")
"RTN","XMA21G",82,0)
 Q
"RTN","XMA24")
0^6^B14768306
"RTN","XMA24",1,0)
XMA24 ;(WASH ISC)/AML/LL-Recipient naming ;09/10/96  14:53
"RTN","XMA24",2,0)
 ;;7.1;MailMan;**31**;Jun 02, 1994
"RTN","XMA24",3,0)
WHOM W !,$S($O(^TMP("XMY",$J,0))'="":"And send to: ",1:"Send mail to: ")
"RTN","XMA24",4,0)
 K XMOUT W:$D(XMMG) XMMG,"// " R X:DTIME E  S XMOUT=1 Q
"RTN","XMA24",5,0)
 S XMN=0 S:"^'^-^"[(U_$E(X)_U) X=$E(X,2,999),XMN=1
"RTN","XMA24",6,0)
 I $L(X),+X'=X,$L(X)<3,X'="*",X'["?",X'["^" W !!,"Enter 3 or more characters, more for shorter search times.",*7 G WHOM
"RTN","XMA24",7,0)
 I X?.E1C.E W !!,"Control characters are not allowed!",*7 G WHOM
"RTN","XMA24",8,0)
 I X="",$D(XMMG),'XMN S ^TMP("XMY",$J,$S($D(XMDUZ):XMDUZ,1:DUZ))="",^TMP("XMY0",$J,$S($D(XMDUZ):XMDUZ,1:DUZ))="",Y=.6 D ENTB:$G(XMDUZ)=.6 Q:$D(XMOUT)  D BAS Q:Y<0!$D(XMOUT)  K XMMG G WHOM
"RTN","XMA24",9,0)
 I X["?" D Q^XMA5 G WHOM
"RTN","XMA24",10,0)
 I X="*" G ERB3:XMN I '$D(^XUSEC("XMSTAR",DUZ)) G ERB1:'$D(^XMB(3.7,"AB",DUZ,.5))
"RTN","XMA24",11,0)
 I X="",'$L($O(^TMP("XMY",$J,""))) S X=U
"RTN","XMA24",12,0)
 I X["^" S XMOUT=1 W *7
"RTN","XMA24",13,0)
 S X2="N" Q:$S(X'="*":1,'$D(XMZ):1,'XMZ:1,1:0)
"RTN","XMA24",14,0)
 I $D(XMLOC),'$D(ZTQUEUED) R !,"Do you really want to broadcast to all users? NO// ",X2:DTIME
"RTN","XMA24",15,0)
 Q:"Yy"'[$S($L(X2):$E(X2),1:1)  S ^TMP("XMY",$J,"* (Broadcast to all local users)")=""
"RTN","XMA24",16,0)
 S X2=$S($D(^XMB(3.9,XMZ,0)):^(0),1:"") I X2'="" S $P(X2,U,12)="y",^(0)=X2 W:'$D(ZTQUEUED)&$D(XMLOC) !,"Message has been made 'INFORMATION ONLY:' for all recipients."
"RTN","XMA24",17,0)
 Q:$S($D(ZTQUEUED):1,'$D(XMLOC):1,1:0)
"RTN","XMA24",18,0)
 W !!,"You may abort broadcasting and send to chosen recipients by",!,"entering '-*' at the 'Send to: ' prompt." Q
"RTN","XMA24",19,0)
ENTB S XMA24=XMDUZ N XMDUZ S XMDUZ=+Y W !!,"Messages sent to SHARED,MAIL must have a DELETE DATE so they may be",!,"automatically removed from SHARED,MAIL's mail-box.",!!
"RTN","XMA24",20,0)
 S DIR("A")="Termination Date",DIR("B")="T+30",DIR(0)="D^"_DT_"::ENX" D ^DIR K DIRUT
"RTN","XMA24",21,0)
 I $D(DTOUT)!$D(DUOUT) S (X,XMOUT)=U W " <<< SHARED,MAIL deleted from recipient list" K DTOUT,DUOUT,^TMP("XMY",$J,XMDUZ),XMA24 Q
"RTN","XMA24",22,0)
 G ENTB:DT-1>Y S ^TMP("XMY",$J,XMDUZ,"D")=Y I $S(DUZ=XMDUZ:1,DUZ=.6:1,XMA24=.6:1,1:0) K XMA24 Q
"RTN","XMA24",23,0)
 K XMA24
"RTN","XMA24",24,0)
BAS ;
"RTN","XMA24",25,0)
 D DSP^XM:'$D(XMDISPI) S Y=0
"RTN","XMA24",26,0)
 Q:'$D(XMLOC)
"RTN","XMA24",27,0)
 I $P(XMDISPI,U)'["A",XMDUZ'=.6 Q
"RTN","XMA24",28,0)
 K XMOUT,DIC
"RTN","XMA24",29,0)
 S DLAYGO=3.7,DIC("A")="  Select basket to send to: ",DIC("B")="IN"
"RTN","XMA24",30,0)
 S DA(1)=XMDUZ,DIC="^XMB(3.7,XMDUZ,2,",DIC(0)="AEQNZLO"
"RTN","XMA24",31,0)
 D ^DIC K DIC,DA
"RTN","XMA24",32,0)
 S:X=""&$D(DTOUT)!(X=U) (X,XMOUT)=U Q:$E(X)=U
"RTN","XMA24",33,0)
 G:+Y'=.5 BAS:+Y<1 S ^TMP("XMY",$J,XMDUZ,0)=+Y
"RTN","XMA24",34,0)
 Q:$D(^XMB(3.7,XMDUZ,2,+Y))  S ^(+Y,1,0)="^3.702P"
"RTN","XMA24",35,0)
 Q
"RTN","XMA24",36,0)
ERB1 W !!,"Only postmaster surrogates may broadcast messages.",*7,!!
"RTN","XMA24",37,0)
 G WHOM
"RTN","XMA24",38,0)
ERB3 I $D(^TMP("XMY",$J,"* (Broadcast to all local users)")) D
"RTN","XMA24",39,0)
 . W !,*7,">>> BROADCAST ABORTED <<<",! K ^TMP("XMY",$J,"* (Broadcast to all local users)")
"RTN","XMA24",40,0)
 . S X2=$S($D(^XMB(3.9,XMZ,0)):^(0),1:"") I X2'="" S $P(X2,U,12)="",^(0)=X2 W:'$D(ZTQUEUED)&$D(XMLOC) !,"Message is no longer 'INFORMATION ONLY:'"
"RTN","XMA24",41,0)
 E  D
"RTN","XMA24",42,0)
 . W !!,*7,"Please indicate the PERSON or MAIL GROUP after a '-' sign to 'minus' them out.",!,"The '*' (asterisk) is reserved for BROADCASTING to ALL users, but only when",!,"the message is initially sent.",!
"RTN","XMA24",43,0)
 G WHOM
"RTN","XMA5")
0^1^B20327713
"RTN","XMA5",1,0)
XMA5 ;(WASH ISC)/THM/CAP- EDIT/ADD/SUBTRACT RECIPIENTS ;07/12/96  07:53
"RTN","XMA5",2,0)
 ;;7.1;MailMan;**31**;Jun 02, 1994
"RTN","XMA5",3,0)
 ;'$D(XMQUE)    : SHORT HEADER
"RTN","XMA5",4,0)
 ;XMQUE=text : SEARCH FOR RECIPIENT
"RTN","XMA5",5,0)
 ;XMQUE=1  : Addressed as list
"RTN","XMA5",6,0)
 ;XMQUE=2  : Network Header
"RTN","XMA5",7,0)
 ;XMQUE=3  : EXPANDED RECIPIENT LIST
"RTN","XMA5",8,0)
 ;
"RTN","XMA5",9,0)
QUER ;
"RTN","XMA5",10,0)
 S:'$D(XMQUE) XMQUE="" W @IOF I XMDUZ'=DUZ D S W !,*7,"User ",$P(^VA(200,DUZ,0),U)," acting as a surrogate for ",XMDUN
"RTN","XMA5",11,0)
 W ! S XMA5("HDR")=XMK D ENTCRT^XMAP K XMA5("HDR")
"RTN","XMA5",12,0)
QE2 S:'$D(XMQUE) XMQUE="" W ! S XMR=$S($D(^XMB(3.9,XMZ,0)):^(0),1:0) Q:XMR=0
"RTN","XMA5",13,0)
 S XMSG="Local Message-ID: "_XMZ_"@"_^XMB("NAME")_"  "_$S($P(XMR,U,7)["P":"*PRIORITY*",$P(XMR,U,7)["S":"[SPOOL]",$P(XMR,U,8):"<RESPONSE>",1:"")
"RTN","XMA5",14,0)
 S %=$G(^XMB(3.9,XMZ,1,0)) I $P(%,U,4) S XMSG=XMSG_" ("_$P(%,U,4)_" Recipients)"
"RTN","XMA5",15,0)
 I "yY"[$E($P(XMR,U,5)_" ") S XMSG=XMSG_" Confirmation requested.   "
"RTN","XMA5",16,0)
 I $P(XMR,U,10)'="" S XMSG=XMSG_" Scramble Hint: "_$P(XMR,U,10)
"RTN","XMA5",17,0)
 D OUT G Z:$D(XMOUT)
"RTN","XMA5",18,0)
 I $O(^XMB(3.9,XMZ,2005,0)) D LIST^XMA2B
"RTN","XMA5",19,0)
 S XMSG="" I "Yy"[$E($P(XMR,U,9)_" ") S XMSG="Closed. "
"RTN","XMA5",20,0)
 I "Yy"[$E($P(XMR,U,11)_" ") S XMSG=XMSG_"Confidential."
"RTN","XMA5",21,0)
 I "Yy"[$E($P(XMR,U,12)_" ") S XMSG=XMSG_" 'Information only' for all recipients."
"RTN","XMA5",22,0)
 D:$L(XMSG) OUT
"RTN","XMA5",23,0)
 I $D(^XMB(3.9,XMZ,4)) S XMSG="Lock: "_^(4) D OUT G Z:$D(XMOUT)
"RTN","XMA5",24,0)
 I $D(XMK),$D(^XMB(3.7,XMDUZ,2,XMK,1,XMZ,0)) S %=$P(^(0),U,5) I % S XMSG="Automatic Deletion Date: "_$E(%,4,5)_"/"_$E(%,6,7)_"/"_$E(%,2,3) D OUT
"RTN","XMA5",25,0)
 G QE3:XMQUE'=2
"RTN","XMA5",26,0)
 I $D(^XMB(3.9,XMZ,2,.001)) W !!,"Network header:",! F I=0:0 S I=$O(^XMB(3.9,XMZ,2,I)) Q:I=""!(I>.999)  S XMSG=^(I,0) D OUT Q:X[U
"RTN","XMA5",27,0)
 Q:X="^"  S XMSG="" D OUT G Z:$D(XMOUT)
"RTN","XMA5",28,0)
QE3 S I=.999 I XMQUE'?1.N,$L(XMQUE) S XMSG="Searching for recipients that match '"_XMQUE_"'." D OUT S XMSG="" D OUT
"RTN","XMA5",29,0)
 I XMQUE=2,$O(^XMB(3.9,XMZ,2,0))>.999 S XMSG="This message originated locally.  There is NO NETWORK HEADER !" D OUT
"RTN","XMA5",30,0)
 S XMF0=0 G ^XMA5A
"RTN","XMA5",31,0)
OUT S X="" D O Q:$D(XMOUT)  I $L(XMSG)<IOM W !,XMSG K XMSG G S
"RTN","XMA5",32,0)
 S %0=0
"RTN","XMA5",33,0)
P I $L(XMSG)+10>IOM F %1=IOM-20:1:IOM-10 Q:" ,-"[$E(XMSG,%1)
"RTN","XMA5",34,0)
 S %=$E(XMSG,1,%1),XMSG=$E(XMSG,%1+1,999) W !?%0,% D S S %0=9 G P:$L(XMSG)
"RTN","XMA5",35,0)
 K %,%1,%0 Q
"RTN","XMA5",36,0)
S S XMAPLCNT=$G(XMAPLCNT)+1 Q
"RTN","XMA5",37,0)
Q D ENT7^XMAH G QQ:$O(^TMP("XMY",$J,0))="" D RCPTS^XMA50 G Z:X[U
"RTN","XMA5",38,0)
QQ R !,"Want user information? NO// ",X:DTIME G Z:X["^"!'$T,QQ1:'$L(X) D Y G QQ:Y=1 D UHELP^XMA7:'Y
"RTN","XMA5",39,0)
QQ1 R !,"Want Mail Group information? NO// ",X:DTIME G Z:X["^"!'$T,QQ2:X="" D Y G QQ1:Y=1 D GHELP^XMA7G:'Y
"RTN","XMA5",40,0)
QQ2 R !,"Want Domain information? NO// ",X:DTIME G QQ3:X="",Z:X["^"!'$T D Y G QQ2:Y=1 D QQ2^XMA50:'Y
"RTN","XMA5",41,0)
QQ3 ;MailLink Help
"RTN","XMA5",42,0)
 G Z:'$O(^XMD(4.2997,0))
"RTN","XMA5",43,0)
 ;
"RTN","XMA5",44,0)
 L +^XMD("XMDIR1"):1 E  W !!,"Update in progress.  Please continue..."
"RTN","XMA5",45,0)
 L -^XMD("XMDIR1")
"RTN","XMA5",46,0)
QQ3A R !,"Want MailLink Help ? NO// ",X:DTIME G Z:X=""!(X["^")!'$T D Y G QQ3A:Y=1,Z:Y=2
"RTN","XMA5",47,0)
QQ3B S DIC="^XMD(4.2997,",DIC(0)="AEFMQ",DIC("A")="Enter LASTNAME, Mail Code or part of LOCATION (one word only): " D ^DIC G Z:Y<0 S DA=+Y,DR=0 D EN^DIQ
"RTN","XMA5",48,0)
 G QQ3A
"RTN","XMA5",49,0)
ENTQ D H S XMB=+Y F XMA5=1,5:1:7 S XMA=0 D Q3 Q:$D(XMOUT)  W !
"RTN","XMA5",50,0)
 W ! K XMA5,XMOUT G Z
"RTN","XMA5",51,0)
Q3 S XMA=$O(^XMB(3.8,XMB,XMA5,XMA)) Q:+XMA'=XMA  S XMA5(0)=$P(^(XMA,0),U) D O Q:$D(XMOUT)  D H:$Y<2 W !,?5 S (J,X)=XMA5(0)
"RTN","XMA5",52,0)
 I '$D(XMDISPI) D DSP^XM
"RTN","XMA5",53,0)
 G V:'X,N:XMA5'=1,N:'$D(^VA(200,X,0)) S %=X,I=^(0),X=$P(I,U)
"RTN","XMA5",54,0)
 I $P(XMDISPI,U)["T",$P(I,U,9) S I=$G(^DIC(3.1,$P(I,U,9),0)) I $L($P(I,U)) S X=X_" - "_$P(I,U)
"RTN","XMA5",55,0)
 I $P(XMDISPI,U)["I",$D(^XMB(3.7,%,6000)) S X=X_" ("_$P(^(6000),U)_")"
"RTN","XMA5",56,0)
N I XMA5=5 S X="<Member Group>: "_$P(^XMB(3.8,+X,0),U)
"RTN","XMA5",57,0)
 I XMA5=7 S %=^XMB(3.816,+X,0),X="** Distribution List: "_$P(%,U) I $D(^(1,0)) S X=X_" (To "_$P(^(0),U,4)_" Domains)"
"RTN","XMA5",58,0)
V W X,?55 I XMA5=1 W $S($D(^XMB(3.7,+J,"L")):$P(^("L"),U),1:"<< Never Used MailMan >>")
"RTN","XMA5",59,0)
 G Q3
"RTN","XMA5",60,0)
H W !,?5,"Member",?55,"Last Used MailMan",! Q
"RTN","XMA5",61,0)
O Q:IOSL-6'<$Y  K DIR,XMOUT S DIR(0)="E" D:$E(IOST)="C" ^DIR S X="" S:$D(DTOUT)!$D(DUOUT) XMOUT=1 K DUOUT,DTOUT,DIRUT W @IOF Q
"RTN","XMA5",62,0)
Z K %,DIC,DIR,I,X,X1,X2,X3,Y,XMA,XMB,XMOUT,XMQUE,XMSG
"RTN","XMA5",63,0)
 I $D(XMAPLCNT) S %1="LINES_READ" L +^XMBPOST(%1) S %=$G(^XMBPOST(%1,0)),%=%+XMAPLCNT,^(0)=% L -^XMBPOST(%1) K %,%1,XMAPLCNT
"RTN","XMA5",64,0)
 Q
"RTN","XMA5",65,0)
Y S Y=0,X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","XMA5",66,0)
 Q:$E("YES",1,$L(X))=X  I $E("NO",1,$L(X))=X S Y=2 Q
"RTN","XMA5",67,0)
 W "   Please answer 'Yes', 'No' or enter '^' to abort." S Y=1 Q
"RTN","XMA5A")
0^2^B20361654
"RTN","XMA5A",1,0)
XMA5A ;(WASH ISC)/THM/CAP- EDIT/ADD/SUBTRACT RECIPIENTS ;07/12/96  07:54
"RTN","XMA5A",2,0)
 ;;7.1;MailMan;**31**;Jun 02, 1994
"RTN","XMA5A",3,0)
 S:'$D(XMQUE) XMQUE="" I $D(XMTYPE),XMP S XMQUE=$S($P(XMTYPE,";",7):3,1:1)
"RTN","XMA5A",4,0)
 N XMA0 S XMA0=$P($G(^XMB(3.9,XMZ,3,0)),U,4)
"RTN","XMA5A",5,0)
 S X=$S(XMQUE=1:6,XMQUE=3:1,1:0) I X S Y=$S($D(^XMB(3.9,XMZ,1,0)):$P(^(0),U,3),1:"NO") I $S(Y:1,X:1,1:0) W !,">> "_Y_" RECIPIENT"_$S(Y=1:"",1:"S")_" ! <<",! G 1
"RTN","XMA5A",6,0)
 I X=6 W !,">> This message has no summary recipient list.  Please enter 'QD'. <<",!
"RTN","XMA5A",7,0)
1 I 'XMP,XMQUE="" D LATER G Z
"RTN","XMA5A",8,0)
 I XMQUE'?1.N,$L(XMQUE) S XMA5A=1,X=XMQUE,DIC="^VA(200,",DIC(0)="FNO",DIC("S")="I $D(^XMB(3.9,XMZ,1,$C(67),+Y))" D ^DIC K DIC I Y>0 S I=$O(^XMB(3.9,XMZ,1,$C(67),+Y,0)),X=^XMB(3.9,XMZ,1,I,0),XMF0="Q" G N
"RTN","XMA5A",9,0)
 K XMA5A I XMQUE=1 W !," <<< This message was ADDRESSED as follows ! >>>",! I '$O(^XMB(3.9,XMZ,6,0)) W !,"This is an old message.  Only the Detail Query is available.",! S XMQUE=3
"RTN","XMA5A",10,0)
Q0 K XMA5 S XMF0("Q")="~"
"RTN","XMA5A",11,0)
 ;
"RTN","XMA5A",12,0)
 ;List Groups first if Summary
"RTN","XMA5A",13,0)
 S XMQUE(0)=$S(XMQUE'?1.N&$L(XMQUE):3,1:XMQUE),%=$S(XMQUE=3:1,XMQUE=1:6,XMQUE(0):1,1:0) G Z:'%,Q1:XMQUE'=1
"RTN","XMA5A",14,0)
 S XMF0="G.",XMF0("Q")="G.~"
"RTN","XMA5A",15,0)
Q1 S XMF0=$O(^XMB(3.9,XMZ,$E(611,XMQUE(0)),$E("BCC",XMQUE(0)),XMF0)) G CONT:XMF0]XMF0("Q")!(XMF0="") S X=$O(^(XMF0,0)),I=+X,X=$G(^XMB(3.9,XMZ,$E(611,XMQUE(0)),X,0)) G Q1:X=""
"RTN","XMA5A",16,0)
N S XMA5=X,X1=$P(X,U),(X2,X3)=""
"RTN","XMA5A",17,0)
 I XMQUE=3,$D(^XMB(3.9,XMZ,1,I,"T")) S X2=^("T"),X3=$P(X2,U,2),X2=$P(X2,U),X2=$P("THRU: ^CC: ^INFO: ",U,$F("TCI",X2)-1)
"RTN","XMA5A",18,0)
 S XMSG=X2_$S(+X1'=X1:X1,'$D(^VA(200,X1,0)):$S($D(^DIC(3,X1,0)):$P(^(0),U),1:X1),1:$P(^VA(200,X1,0),U))
"RTN","XMA5A",19,0)
 I XMQUE=1 D OUT^XMA5 G Q1:'$D(XMOUT) D LATER G Z
"RTN","XMA5A",20,0)
 I XMQUE'?1.N,$L(XMQUE),$E($S(XMSG'[": ":XMSG,1:$P(XMSG,": ",2)),1,$L(XMQUE))'=XMQUE G Q1:'$D(XMA5A) Q
"RTN","XMA5A",21,0)
 S X1=XMA5,X=$P(X,U,3) D D S:'$D(XMSG) XMSG=""
"RTN","XMA5A",22,0)
 S XMSG=$E(XMSG_"             ",1,$S($L(XMSG)<20:20,1:$L(XMSG)))_" "_$S(X'="":"Last read: "_Y,($P(X1,U)'["@")&($P(X1,U)'?1"*".E):"Not read.",1:"")
"RTN","XMA5A",23,0)
 S X=X1 S:$P(X,U,2) XMSG=XMSG_" ("_+$P(X,U,2)_" of "_XMA0_" response"_$S(XMA0>1:"s",1:"")_")"
"RTN","XMA5A",24,0)
 I $L($P(X,U,4,6))>2 S X=$P(X,U,5) D D S:X'="" XMSG=XMSG_" Sent: "_Y S:$P(X1,U,4)'="" XMSG=XMSG_" Message-ID: "_$P(X1,U,4) S:$P(X1,U,6)'="" XMSG=XMSG_" Status: "_$P(X1,U,6)
"RTN","XMA5A",25,0)
 I $P(X1,U,7)'="",$D(^DIC(4.2,$P(X1,U,7),0)) S XMSG=XMSG_" Path: "_$P(^(0),U)
"RTN","XMA5A",26,0)
 I $P(X1,U,8)'="" S XMSG=XMSG_" Time: "_$P(X1,U,8)_" seconds."
"RTN","XMA5A",27,0)
 I $D(^XMB(3.9,XMZ,1,I,"D")) S X=^("D") D D S XMSG=XMSG_"  Terminated: "_Y
"RTN","XMA5A",28,0)
 S %=$G(^XMB(3.9,XMZ,1,I,"F")) I $L(%) S:+% $P(%," ")=$P(^VA(200,+%,0),U) S XMSG=$S($E(%)=" ":XMSG_" Forwarded on: "_$P(%,U),1:XMSG_" Forwarded by: "_$P(%,U))
"RTN","XMA5A",29,0)
 I $D(^XMB(3.9,XMZ,1,I,"C")) S XMSG=XMSG_" Copied: "_^("C")
"RTN","XMA5A",30,0)
 I $D(^XMB(3.9,XMZ,1,I,"S")) S XMSG=XMSG_" Surrogate: "_^("S")
"RTN","XMA5A",31,0)
 S X=XMA5,X=$P(X,U,10) I $G(X) D D S XMSG=XMSG_" [First read: "_Y_"]"
"RTN","XMA5A",32,0)
 I XMQUE'?1.N,$L(XMQUE) D OUT^XMA5 G Z:$D(XMOUT),Q1:'$D(XMA5A),Z^XMA5
"RTN","XMA5A",33,0)
 D OUT^XMA5 G:'$D(XMA5A)!(XMQUE'="") Q1:'$D(XMOUT),Z
"RTN","XMA5A",34,0)
 ;
"RTN","XMA5A",35,0)
 ;Get rest of Summary or quit
"RTN","XMA5A",36,0)
CONT I XMQUE=1,XMF0("Q")="G.~" W ! S XMF0="",XMF0("Q")="G." G Q1
"RTN","XMA5A",37,0)
 I XMQUE=1,XMF0("Q")="G." S XMF0="G.~",XMF0("Q")="~" G Q1
"RTN","XMA5A",38,0)
 D LATER G Z
"RTN","XMA5A",39,0)
LATER ;LIST DATES MESSAGE WILL BE NEW ON 'LATER'
"RTN","XMA5A",40,0)
 W:$D(XMQUE) ! S:'$D(XMQUE) XMQUE="" K XMF0 I XMQUE=2 Q
"RTN","XMA5A",41,0)
 N I S XMSG="" Q:'$O(^XMB(3.73,"AC",XMZ,XMDUZ,0))  S %="" F I=0:0 S I=$O(^(I)) Q:'I  S %=I_U_% I $L(%,U)>9 S %=" (There are more dates & times-- SEE REPORT FOR FULL LIST)^"_% Q
"RTN","XMA5A",42,0)
L S I=$P(%,U,1),%=$P(%,U,2,99) I I S X=$P(^XMB(3.73,I,0),U) D D S I=X
"RTN","XMA5A",43,0)
 S XMSG=I_$S($L(XMSG):", ",1:"")_XMSG G L:$L(%)
"RTN","XMA5A",44,0)
 S XMSG="**NEW** dates and times: "_$E(XMSG,$S($E(XMSG)=" ":2,1:1),999)
"RTN","XMA5A",45,0)
 D OUT^XMA5 W ! Q
"RTN","XMA5A",46,0)
Z G Z^XMA5:$S(XMQUE="":1,$D(XMOUT):1,$D(ZTQUEUED):1,IO'=$G(IO(0)):1,$G(XMA1P):1,1:0)
"RTN","XMA5A",47,0)
 I XMQUE=1 S XMSG="Enter 'QD' for individual recipients" S:XMQUE'=2 XMSG=XMSG_", 'QN' for Network information" S XMSG=XMSG_"." D OUT^XMA5 G Z:$D(XMOUT)
"RTN","XMA5A",48,0)
 S XMSG="Enter 'Q name' or 'Q name@domain' to search for a particular recipient." D OUT^XMA5 G Z:$D(XMOUT)
"RTN","XMA5A",49,0)
 G Z^XMA5
"RTN","XMA5A",50,0)
D Q:X<20000  S Y=$E(X,6,7)_" "_$P("Jan^Feb^Mar^Apr^May^Jun^Jul^Aug^Sep^Oct^Nov^Dec",U,$E(X,4,5))_" "_$E(X,2,3) S:X\1'=X %2=$P(X,".",2)_"0000",Y=Y_" "_$E(%2,1,2)_":"_$E(%2,3,4) S X=Y
"RTN","XMA5A",51,0)
 K %2 Q
"RTN","XMAD2")
0^5^B4070811
"RTN","XMAD2",1,0)
XMAD2 ;(WASH ISC)/CAP-BACKGROUND FILER CONTINUED ;07/12/96  09:59
"RTN","XMAD2",2,0)
 ;;7.1;MailMan;**31**;Jun 02, 1994
"RTN","XMAD2",3,0)
 ;
"RTN","XMAD2",4,0)
BSKT(X,Y) ;
"RTN","XMAD2",5,0)
 ;Find or Create a basket / return its internal number
"RTN","XMAD2",6,0)
 ;
"RTN","XMAD2",7,0)
 ;X=Basket-name
"RTN","XMAD2",8,0)
 ;Y=DUZ
"RTN","XMAD2",9,0)
 ;
"RTN","XMAD2",10,0)
 N %,I,J S J=$O(^XMB(3.7,Y,2,"B",X,0)) I J'="" G BQ
"RTN","XMAD2",11,0)
 S %=^XMB(3.7,Y,2,0),J=$P(%,U,4),J=$S(J>0:J,1:0)
"RTN","XMAD2",12,0)
 F I=1:1 Q:'$D(^XMB(3.7,Y,2,I))
"RTN","XMAD2",13,0)
 I I>900,Y=.5 S J=1 G BQ
"RTN","XMAD2",14,0)
 S $P(^XMB(3.7,Y,2,0),U,3,4)=$S(I>$P(%,U,3):I,1:$P(%,U,3))_U_(J+1),^(I,0)=X,^XMB(3.7,Y,2,"B",X,I)="",J=I
"RTN","XMAD2",15,0)
BQ Q J
"RTN","XMAD2",16,0)
 ;TEST IN FOREGROUND
"RTN","XMAD2",17,0)
GO S Z=$O(^XMBPOST("POST",0)) Q:Z=""  D ^XMAD:$E(Z)'="Z" Q
"RTN","XMAD2",18,0)
 ;
"RTN","XMAD2",19,0)
 ;RESTART BACKGROUND
"RTN","XMAD2",20,0)
 ;IF THE GLOBAL LOCKS...CHANGE
"RTN","XMAD2",21,0)
 ;
"RTN","XMAD2",22,0)
RES D C^XMAD1 G H^XUS
"RTN","XMAD2",23,0)
 ;
"RTN","XMAD2",24,0)
TERM ;REACTIVATED USER
"RTN","XMAD2",25,0)
 S X=$O(^XMB(3.9,XMZ,1,"C",Y,0))
"RTN","XMAD2",26,0)
 I X,'$D(^XMB(3.9,XMZ,1,X,"D")) S ^("D")=%DT,$P(^(0),U,5)="Terminated - SECURITY !"
"RTN","XMAD2",27,0)
 G E^XMADJF1B
"RTN","XMAD2",28,0)
LATER ;PROCESS LATER'D MESSAGES TO BE NEW
"RTN","XMAD2",29,0)
 S DIK="^XMB(3.73,",XMDUZ=0
"RTN","XMAD2",30,0)
Y S XMDUZ=$O(^XMB(3.73,"AB",Z,XMDUZ)) G Q:'XMDUZ S XMZ=0
"RTN","XMAD2",31,0)
N S XMZ=$O(^XMB(3.73,"AB",Z,XMDUZ,XMZ)) G Y:'XMZ S DA=$O(^(XMZ,0)),XMHOLD=Z G Y:'DA I '$D(^XMB(3.73,DA,0)) K ^XMB(3.73,"AB",Z,XMDUZ,XMZ,DA) G N
"RTN","XMAD2",32,0)
 H 1 D ^DIK,NNEW^XMA:$D(^XMB(3.7,XMDUZ,0)) S Z=XMHOLD G N
"RTN","XMAD2",33,0)
 ;
"RTN","XMAD2",34,0)
Q G L^XMADJ999
"RTN","XMAD2",35,0)
 ;
"RTN","XMAD2",36,0)
OFF ;Write message to interactive users if Background Filer flag is set
"RTN","XMAD2",37,0)
 Q:$S($D(ZTQUEUED):1,$D(XMCHAN):1,1:0)
"RTN","XMAD2",38,0)
 W !!,*7,"Contact the Site Manager.  Message Delivery is OFF !",!!,"Use XMMGR-START-BACKGROUND-FILER option to allow it to restart.",!!
"RTN","XMAD2",39,0)
 Q
"RTN","XMB1")
0^4^B14448591
"RTN","XMB1",1,0)
XMB1 ;(WASH ISC)/THM/CAP-TICKLER MESSAGES ;07/12/96  07:54
"RTN","XMB1",2,0)
 ;;7.1;MailMan;**31**;Jun 02, 1994
"RTN","XMB1",3,0)
RPT ;REPORT ON LATER'D MESSAGES
"RTN","XMB1",4,0)
 S U="^",XMLROU="ENTR^XMB1",ZTSAVE("XMDUZ")="",ZTSAVE("DUZ*")=""
"RTN","XMB1",5,0)
 D ENT^XMA30 I POP K POP,ZTSAVE Q
"RTN","XMB1",6,0)
 D ENTR Q
"RTN","XMB1",7,0)
ENTR ;
"RTN","XMB1",8,0)
 K DUOUT,DTOUT
"RTN","XMB1",9,0)
 S X="IOEDEOP" D ENDR^%ZISS S I=$S($D(XMDUN):XMDUN,1:"") N XMDUN S (X,XMC)=0,XMB1("XMDUZ")=$S($D(XMDUZ):XMDUZ,1:DUZ),XMDUN=$S($L(I):I,1:$P(^VA(200,XMB1("XMDUZ"),0),U)),XMB1=0
"RTN","XMB1",10,0)
A S XMB1=$O(^XMB(3.73,"C",XMB1("XMDUZ"),XMB1)) G RQ:'XMB1
"RTN","XMB1",11,0)
 S XMB1("X")=^XMB(3.73,XMB1,0),XMB1("J")=$S($D(^XMB(3.9,$P(XMB1("X"),U,3),0)):^(0),1:"") G A:XMB1("J")="" D HD I $D(DUOUT)!$D(DTOUT) K DTOUT,DUOUT G RQ
"RTN","XMB1",12,0)
 S XMC=XMC+1,(%0,X)=$P(XMB1("X"),U) D TIME W !,$E(%0,4,5)_"/"_$E(%0,6,7)_"/"_$E(%0,2,3) W:X'?1"0:00".E " @ "_X_"  " W ?22,"["_$P(XMB1("X"),U,3)_"]  "_$P(XMB1("J"),U)
"RTN","XMB1",13,0)
 G A
"RTN","XMB1",14,0)
RQ W !!,"<<< " I XMC=0 W "NOTHING TO REPORT"
"RTN","XMB1",15,0)
 E  W XMC_" Entries"
"RTN","XMB1",16,0)
 W " >>>",! K I,X,Y,J,XMC,XMB1 D KILL^%ZISS Q
"RTN","XMB1",17,0)
ENTO ;OUTPUT TRANSFORM
"RTN","XMB1",18,0)
 N X,% S X=Y,Y=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3)
"RTN","XMB1",19,0)
 D TIME S:X'?1"0:00".E Y=Y_"@"_X Q
"RTN","XMB1",20,0)
TIME S X=$E($P(X,".",2)_"0000",1,4),%=X>1159 S:X>1259 X=X-1200 S X=X\100_":"_$E(X#100+100,2,3)_" "_$E("AP",%+1)_"M"
"RTN","XMB1",21,0)
 Q
"RTN","XMB1",22,0)
HD Q:XMC#(IOSL-9)
"RTN","XMB1",23,0)
 I $E(IOST)="C",XMC>1 S DIR(0)="E" D ^DIR K DIRUT Q:$D(DTOUT)!$D(DUOUT)  S DX=0,DY=5 X IOXY W IOEDEOP
"RTN","XMB1",24,0)
 W @IOF
"RTN","XMB1",25,0)
 W !,?IOM-21/2-$L(XMDUN),"LATER'D MESSAGES REPORT FOR "_XMDUN,?70,$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3),!!,"  DATE @ TIME",?22,"[NUMBER]  SUBJECT",?70,"PAGE: ",XMC\(IOSL-9)+1,!!
"RTN","XMB1",26,0)
 Q
"RTN","XMB1",27,0)
ENTE ;EDIT LATER'D MESSAGES FILE
"RTN","XMB1",28,0)
 S D="C",X=$S($D(XMDUZ):XMDUZ,1:DUZ),XMB1=$S($D(XMDUZ):U_XMDUZ_U,1:"")_"^"_DUZ_"^",DIC=3.73
"RTN","XMB1",29,0)
 S DIC("S")="N %,%0 S %0=^(0),%=$P(%0,U,2) I XMB1[(U_%_U),$D(^XMB(3.9,$P(%0,U,3),0))",DIC("A")="Edit Later'd message: ",DIC(0)="EZNO" D IX^DIC
"RTN","XMB1",30,0)
 I Y<0 W !!,"Nothing chosen !!!",*7,!! G EQ
"RTN","XMB1",31,0)
 K DIR,DIC S XMB1=+Y,XMB1(0)=Y(0),DIR(0)="Y",DIR("A")="Delete this Entry",DIR("B")="YES" D ^DIR K DIRUT
"RTN","XMB1",32,0)
 G EQ:$S($D(DUOUT):1,$D(DTOUT):1,1:0)
"RTN","XMB1",33,0)
 I "Yy"[$E(X) S DIK="^XMB(3.73,",DA=+XMB1 D ^DIK W "  >>> Deleted <<<",*7 G EQ
"RTN","XMB1",34,0)
 ;
"RTN","XMB1",35,0)
 ;Kill off old x-refs
"RTN","XMB1",36,0)
 W !!,"The old time is now being deleted, This message will not appear"
"RTN","XMB1",37,0)
 W !,"new at the old scheduled date and time.  It will be rescheduled"
"RTN","XMB1",38,0)
 W !,"after you have answered the question for the new date and time.",!!
"RTN","XMB1",39,0)
 S %2=$P(XMB1(0),U,2),%3=$P(XMB1(0),U,3),%1=$P(XMB1(0),U)
"RTN","XMB1",40,0)
 K ^XMB(3.73,"AC",%3,%2,XMB1)
"RTN","XMB1",41,0)
 K ^XMB(3.73,"C",%2,XMB1)
"RTN","XMB1",42,0)
 K ^XMB(3.73,"AB",%1,%2,%3,XMB1)
"RTN","XMB1",43,0)
 ;
"RTN","XMB1",44,0)
 ;Edit Later DATE/TIME - reindex entry (recreate x-refs)
"RTN","XMB1",45,0)
 S DA=+XMB1,DIE="^XMB(3.73,",DR=".01" D ^DIE S DIK=DIE D IX1^DIK
"RTN","XMB1",46,0)
 ;
"RTN","XMB1",47,0)
EQ K DIC,DIE,DIK,DIR,DTOUT,DUOUT,DA,X,XMB1,Y Q
"RTN","XMB1",48,0)
 ;
"RTN","XMB1",49,0)
 ;
"RTN","XMB1",50,0)
 ;
"RTN","XMB1",51,0)
POST ;TICKLER MESSAGE
"RTN","XMB1",52,0)
 I $D(^XMB(3.73,"AC",XMZ,XMDUZ)) W @IOF,"This message is already scheduled to be new !",*7,! D LATER^XMA5A W !
"RTN","XMB1",53,0)
 K DIR S DIR(0)="D^::XETFN",DIR("A")="Make NEW on What DATE and TIME",DIR("B")="T+1" D ^DIR K DIR,DIRUT I $D(DUOUT)!$D(DTOUT) S X="" K DUOUT,DTOUT G Q
"RTN","XMB1",54,0)
 S XMA=Y K DIR I XMA'?7N.E D ^%DT S XMA=Y
"RTN","XMB1",55,0)
 D NOW^%DTC I XMA-%<0 W !,*7," FUTURE DATES & TIMES ONLY !!!" G POST
"RTN","XMB1",56,0)
 K DIC S X=XMA,DIC="^XMB(3.73,",DIC("DR")="1////"_$S(XMDUZ=.6:DUZ,1:XMDUZ)_";2////"_XMZ,DIC(0)="FI"
"RTN","XMB1",57,0)
 K XMA,%H,%,DO,DD D FILE^DICN K DIC
"RTN","XMB1",58,0)
 L +^XMBPOST("POST"):0 E  G POSTQ
"RTN","XMB1",59,0)
 D C^XMAD1
"RTN","XMB1",60,0)
POSTQ L -^XMBPOST("POST")
"RTN","XMB1",61,0)
Q K DIC,DIE,DR S X="" G C1^XMA1
"RTN","XMGAPI0")
0^9^B3592452
"RTN","XMGAPI0",1,0)
XMGAPI0 ;(WASH ISC)/CAP- SUBJECT GET / CHECK ;10/16/96  06:56
"RTN","XMGAPI0",2,0)
 ;;7.1;MailMan;**31**;Jun 02, 1994
"RTN","XMGAPI0",3,0)
ENT(Y,Z) ;Check Input Subject
"RTN","XMGAPI0",4,0)
 ;Param1=String
"RTN","XMGAPI0",5,0)
 ;Param2=Silent Flag
"RTN","XMGAPI0",6,0)
 N A S A=""
"RTN","XMGAPI0",7,0)
 I $L(Y)>65 S A=1,%="Entered SUBJECT too long, "_$L($E(Y,66,999))_" characters longer than 65." S Y=$E(Y,1,250) G S:Z Q "3-"_%_U_$E(Y,1,65)
"RTN","XMGAPI0",8,0)
 ;
"RTN","XMGAPI0",9,0)
 I Y[U S Y=$$ENCODEUP^XMCU1(Y)
"RTN","XMGAPI0",10,0)
 ;
"RTN","XMGAPI0",11,0)
 ;REMOVE LEADING BLANKS
"RTN","XMGAPI0",12,0)
B I Y?1" ".E S Y=$E(Y,2,99) G B
"RTN","XMGAPI0",13,0)
 ;
"RTN","XMGAPI0",14,0)
 ;REMOVE TRAILING BLANKS
"RTN","XMGAPI0",15,0)
E I $E(Y,$L(Y))=" " S Y=$E(Y,1,$L(Y)-1) G E
"RTN","XMGAPI0",16,0)
 ;
"RTN","XMGAPI0",17,0)
 G U:Y'?.E1C.E I 'Z Q "5-Subject cannot contain control characters.^"_Y
"RTN","XMGAPI0",18,0)
 F X=1:1 I $E(Y,X)?1C S Y=$E(Y,1,X-1)_$E(Y,X+1,99) Q:Y'?.E1C.E  S X=X-1
"RTN","XMGAPI0",19,0)
 W *7,!,"Control characters removed ("""_Y_""" is Subject accepted).",!
"RTN","XMGAPI0",20,0)
 ;
"RTN","XMGAPI0",21,0)
U I Y="" Q ""
"RTN","XMGAPI0",22,0)
 I Y="?" S A=1,%="Enter a Message Subject, between 3 & 65 characters long or '^' to exit." G S:Z Q "4-"_%_U_Y
"RTN","XMGAPI0",23,0)
 I $L(Y)<3 S A=1,%="SUBJECT must be at least 3 characters long." G S:Z Q "1-"_%_U_Y
"RTN","XMGAPI0",24,0)
 I Y?1"R"2N.N S A=1,%="Subject names of this format (1""R""1.N) are RESERVED" G S:Z Q "2-"_%_U_Y
"RTN","XMGAPI0",25,0)
Q Q A_U_Y
"RTN","XMGAPI0",26,0)
S W !,*7,%,!
"RTN","XMGAPI0",27,0)
 G Q
"RTN","XMGAPI0",28,0)
SUBGET(X) ;Return Subject of a Message (""=Error, Else returns Subject)
"RTN","XMGAPI0",29,0)
 S X=$P($G(^XMB(3.9,X,0)),U) I X="" Q ""
"RTN","XMGAPI0",30,0)
 Q $$DECODEUP^XMCU1(X)
"RTN","XMGAPI0",31,0)
SUBCHK(X,Z) ;Check Subject (""=Error, Else returns Subject)
"RTN","XMGAPI0",32,0)
 ;Param1=String
"RTN","XMGAPI0",33,0)
 ;Param2=Silent Flag (0=Silent, 1=Verbose)
"RTN","XMGAPI0",34,0)
 N Y S Y=X
"RTN","XMGAPI0",35,0)
 Q $$ENT(X,Z)
"RTN","XMRENT")
0^10^B3571865
"RTN","XMRENT",1,0)
XMRENT ;(WASH ISC)/CMW - NETWORK MAIL API ENTRY POINTS ;10/16/96  09:33
"RTN","XMRENT",2,0)
 ;;7.1;MailMan;**31**;Jun 02, 1994
"RTN","XMRENT",3,0)
 ;
"RTN","XMRENT",4,0)
 ;Extrinsic Function for API call to parse network header
"RTN","XMRENT",5,0)
 ;Parameter #1=Message #
"RTN","XMRENT",6,0)
 ;
"RTN","XMRENT",7,0)
 ;Output=STRING
"RTN","XMRENT",8,0)
 ;  Message-date ^ Encryption-code ^ Returned addr of sender ^ Message ID
"RTN","XMRENT",9,0)
 ;   ^ Sender ^ Message subject ^ Message ID of In-reply-to ^ Message Type
"RTN","XMRENT",10,0)
 ;
"RTN","XMRENT",11,0)
NET(XMZ) ;New all variables that are used in PARSE^XMR1
"RTN","XMRENT",12,0)
 I '$D(^XMB(3.9,XMZ,0)) Q ""
"RTN","XMRENT",13,0)
 N I,J,K,XMDATE,XMENCR,XMFROM,XMREMID,XMSEND,XMSUB,XMZ2,X,X1
"RTN","XMRENT",14,0)
 ;
"RTN","XMRENT",15,0)
 ;Put all outputs into string
"RTN","XMRENT",16,0)
 G @$S($O(^XMB(3.9,XMZ,2,0))<1:"NETMAIL",1:"LOCMAIL")
"RTN","XMRENT",17,0)
 ;
"RTN","XMRENT",18,0)
 ;Get data for Locally originated message
"RTN","XMRENT",19,0)
LOCMAIL N XMP S XMP=^XMB(3.9,XMZ,0)
"RTN","XMRENT",20,0)
 S Y=$P(XMP,U,3),%DT="S" D DD^%DT S XMDATE=Y
"RTN","XMRENT",21,0)
 S XMZ2=$S($P(XMP,U,8):^XMB("NETNAME")_"@"_$P(XMP,U,8),1:"")
"RTN","XMRENT",22,0)
 S XMSEND=$S($P(XMP,U,4):$P(^VA(200,$P(XMP,U,4),0),U),1:"")
"RTN","XMRENT",23,0)
 S XMENCR=$P(XMP,U,10),XMFROM=$S($P(XMP,U,2):$P(^VA(200,$P(XMP,U,2),0),U),1:$P(XMP,U,2)),XMSUB=$$SUBGET^XMGAPI0(XMZ),XMREMID=^XMB("NETNAME")_"@"_XMZ
"RTN","XMRENT",24,0)
 G SET
"RTN","XMRENT",25,0)
 ;Get data for Message that originated from another domain
"RTN","XMRENT",26,0)
NETMAIL D PARSE^XMR1
"RTN","XMRENT",27,0)
 S XMFROM=$TR(XMFROM,"<,>"," , ")
"RTN","XMRENT",28,0)
 S I=1,J=$L(XMFROM," ") F K=I:1:J I $P(XMFROM," ",K,K+1)["@" S XMFROM="<"_$P(XMFROM," ",K,K+1)_">",XMFROM=$TR(XMFROM," ")
"RTN","XMRENT",29,0)
 I XMREMID[".VA.GOV" S XMFROM=$TR($P(XMFROM,"@"),"._+",", .")_"@"_$P(XMFROM,"@",2)
"RTN","XMRENT",30,0)
 ;
"RTN","XMRENT",31,0)
SET S %=XMDATE_U_XMENCR_U_XMFROM_U_XMREMID_U_XMSEND_U_XMSUB_U_$G(XMZ2)_U_$P($G(^XMB(3.9,XMZ,0)),U,7)
"RTN","XMRENT",32,0)
 Q %
"RTN","XMRPCTS")
0^13^B7962541
"RTN","XMRPCTS",1,0)
XMRPCTS ;(KC-VAMC)/XXX-Steal TWIX's from PCTS Host [RCVR] ;10/29/96  09:02
"RTN","XMRPCTS",2,0)
 ;;7.1;MailMan;**6,11,31**;Jun 02, 1994
"RTN","XMRPCTS",3,0)
 S %=$$DSP("==>STARTING PCTS DIALOGUE<=="),XMRPCTS("R")=0
"RTN","XMRPCTS",4,0)
 S XMCOUNT=0
"RTN","XMRPCTS",5,0)
ST I $$NEWERR^%ZTER N $ETRAP,$ESTACK S $ETRAP="D ERR^XMRPCTSA"
"RTN","XMRPCTS",6,0)
 E  S X="D ERR^XMRPCTSA",@^%ZOSF("TRAP")
"RTN","XMRPCTS",7,0)
 D INIT^XMRPCTSA
"RTN","XMRPCTS",8,0)
 S %=$$DSP("==>Handshaking with PCTS - This make take a while<==")
"RTN","XMRPCTS",9,0)
 F I=1:1:3 R X:5 Q:$T
"RTN","XMRPCTS",10,0)
 I X["MREQ" R X:3 S XMMN=$P(X,XMLF,2) G:X[XMET!(XMMN'?1N.N) EXIT S %=$$DSP("==>MREQ") G MAK1
"RTN","XMRPCTS",11,0)
 I X["MAOK" S %=$$DSP("==>MAOK") D ^XMRPCTS0 G EXIT ; We can send stuff here
"RTN","XMRPCTS",12,0)
 I X["MEND"!(X[XMET) S %=$$DSP("==>MENDing<==") G EXIT
"RTN","XMRPCTS",13,0)
 ;S %=$$DSP("===>'"_X_"' Received / Not Understood !!!")
"RTN","XMRPCTS",14,0)
 S XMCOUNT=XMCOUNT+1 G ST:XMCOUNT<3,EXIT
"RTN","XMRPCTS",15,0)
 ;
"RTN","XMRPCTS",16,0)
MAK1 W "MAK1",XMCR,XMLF,XMMN,XMCR,XMLF,XMET,XMCR S %=$$DSP("<==MAK1/"_XMMN),%=0
"RTN","XMRPCTS",17,0)
 ;
"RTN","XMRPCTS",18,0)
 S XMCOUNT=0
"RTN","XMRPCTS",19,0)
MDTA F I=1:1:3 R X:5 Q:$T
"RTN","XMRPCTS",20,0)
 I X["MDTA" R X:3 S XMMN=$P(X,XMLF,2) G:X[XMET EXIT S %=$$DSP("==>MDTA,  AMS Message #"_XMMN),XMSUB="PCTS==> AMS Message Number: "_XMMN G SH
"RTN","XMRPCTS",21,0)
 I X["MEND"!(X[XMET) S %=$$DSP("==>MENDing<==") G EXIT
"RTN","XMRPCTS",22,0)
 ;S %=$$DSP("===>'"_X_"' Received & Not Understood !!!")
"RTN","XMRPCTS",23,0)
 S XMCOUNT=XMCOUNT+1 G MDTA:XMCOUNT<3,EXIT
"RTN","XMRPCTS",24,0)
 ;
"RTN","XMRPCTS",25,0)
SH R X:5 G:'$T EXIT S XMHDR=$P(X,XMSH,2) S %=$$DSP("==>"_XMHDR),^TMP($J,1,0)=XMHDR,XMLPC=$$CSUM($C(XMLPC)_XMHDR_XMCR)
"RTN","XMRPCTS",26,0)
TT S X1="" F I=2:1 R X:5 Q:'$T  D
"RTN","XMRPCTS",27,0)
 .I X1["NNNN"&(($A($E(X,1)=10))&($A($E(X,2)=25))) R X2:5 Q
"RTN","XMRPCTS",28,0)
 .S XMLPC=$$CSUM($C(XMLPC)_X_XMCR),X=$$STRLF(X),X1=X
"RTN","XMRPCTS",29,0)
 .S ^TMP($J,I,0)=X,%=$$DSP("==>"_X)
"RTN","XMRPCTS",30,0)
 I X1["NNNN" S ^TMP($J,I,0)="------  End of PCTS Message  ------",%=$$DSP("==>NNNN Received") D CHKSUM(X) D XM^XMRPCTSA,REPLY^XMRPCTSA K X1 G ST
"RTN","XMRPCTS",31,0)
 I X1'["NNNN" S %=$$DSP("==>No 'NNNN', End of Message Found") K X1 G EXIT
"RTN","XMRPCTS",32,0)
CHKSUM(X) ;Verify the Checksum, We MUST agree.
"RTN","XMRPCTS",33,0)
 S XMLPC=$$CSUM($C(XMLPC)_XMLF) ;Add in that last LineFeed
"RTN","XMRPCTS",34,0)
 S XMLPC=$E(XMDH,XMLPC\16+1)_$E(XMDH,XMLPC#16+1) ;The Magic Code
"RTN","XMRPCTS",35,0)
 ;U IO R X:5 S X=$P(X,$C(25),2) ;Em is 25
"RTN","XMRPCTS",36,0)
 ;S XMLPC=$S(X=XMLPC:1,1:0) ;Do the checksums match ?
"RTN","XMRPCTS",37,0)
 ;Hardwire checksum evaluation to be true
"RTN","XMRPCTS",38,0)
 S XMLPC=1
"RTN","XMRPCTS",39,0)
 S %=$$DSP("==>CHECKSUM "_$S(XMLPC:"OK",1:"FAILED")_"<==")
"RTN","XMRPCTS",40,0)
 Q
"RTN","XMRPCTS",41,0)
DSP(XMTRAN) D TRAN^XMC1
"RTN","XMRPCTS",42,0)
 Q "" ;Show us what is going on
"RTN","XMRPCTS",43,0)
 ;
"RTN","XMRPCTS",44,0)
EXIT X ^%ZOSF("TRMOFF")
"RTN","XMRPCTS",45,0)
 K XMCR,XMLF,XMET,XMSH,XMLPC,XMLMN,XMMN,XMDH
"RTN","XMRPCTS",46,0)
 S %=$$DSP("==>ENDING PCTS DIALOGUE & RETURNING TO MAILMAN SCRIPT<==")
"RTN","XMRPCTS",47,0)
 F %="R","S" S XMCNT(%)=$S($G(XMRPCTS(%)):XMRPCTS(%),1:0)
"RTN","XMRPCTS",48,0)
 Q
"RTN","XMRPCTS",49,0)
 ;
"RTN","XMRPCTS",50,0)
STRLF(X) ;Remove leading LineFeed(s) from String
"RTN","XMRPCTS",51,0)
 N I F I=1:1:$L(X) Q:X'[$C(10)  I $A(X)=10 S X=$E(X,2,$L(X))
"RTN","XMRPCTS",52,0)
 Q (X)
"RTN","XMRPCTS",53,0)
CSUM(X) ;Calculate Checksum
"RTN","XMRPCTS",54,0)
 N Y X ^%ZOSF("LPC") Q Y
"RTN","XMRPCTS0")
0^11^B14039893
"RTN","XMRPCTS0",1,0)
XMRPCTS0 ;(KC-VAMC)/XXX-Send TWIX's to PCTS Host [XMTR] ;10/29/96  09:01
"RTN","XMRPCTS0",2,0)
 ;;7.1;MailMan;**6,12,31**;Jun 02, 1994
"RTN","XMRPCTS0",3,0)
 ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
"RTN","XMRPCTS0",4,0)
 ; Walk through this Domains Transmit Basket and send them.
"RTN","XMRPCTS0",5,0)
 ; If there is an error, record the error message, copy of
"RTN","XMRPCTS0",6,0)
 ; the message, and drop to PCTS Mailgroup.
"RTN","XMRPCTS0",7,0)
 ;-------------------------------------------------------------
"RTN","XMRPCTS0",8,0)
 S %=$$DSP^XMRPCTS("==>Checking for PCTS Messages to Transmit<==")
"RTN","XMRPCTS0",9,0)
 ;Get domain # for the PCTS domain
"RTN","XMRPCTS0",10,0)
 S XMINST=$O(^DIC(4.2,"B","VHA.DMIA",0))
"RTN","XMRPCTS0",11,0)
 S XMK=XMINST+1000,XMDUZ=.5,XMZ=0,U="^" D INIT^XMRPCTSA S XMRPCTS("S")=0
"RTN","XMRPCTS0",12,0)
WALK S %=$$DSP("==>Checking for messages in basket # "_XMK_"<==")
"RTN","XMRPCTS0",13,0)
 S XMZ=$O(^XMB(3.7,.5,2,XMK,1,XMZ)) G EXIT:XMZ<1
"RTN","XMRPCTS0",14,0)
 I '$D(^XMB(3.9,XMZ,0)) D KL^XMA1B G WALK ;Message is Gone?
"RTN","XMRPCTS0",15,0)
 S %=$$DSP("<==MREQ for local "_XMZ) W "MREQ",!,XMZ,!,"PCTS",!,"AMS",!,"TAB",!,XMET,XMCR S %=0
"RTN","XMRPCTS0",16,0)
 ;
"RTN","XMRPCTS0",17,0)
MREQ F I=1:1:3 R X:5 Q:$T
"RTN","XMRPCTS0",18,0)
 I X["MAK1" R X:3 S XMMN=$P(X,XMLF,2) G:X[XMET!(XMMN'=XMZ) EXIT G REM
"RTN","XMRPCTS0",19,0)
 I X["MEND"!(X[XMET) S %=$$DSP("==>MENDing<==") G EXIT
"RTN","XMRPCTS0",20,0)
 S %=%+1 G MREQ:%<3,EXIT
"RTN","XMRPCTS0",21,0)
REM R X:3 S XMMN=$P(X,XMLF,2) G:X[XMET!(XMMN'?1N.N) EXIT
"RTN","XMRPCTS0",22,0)
 S %=$$DSP("==>MAK1 for REMOTE "_XMMN)
"RTN","XMRPCTS0",23,0)
MDTA ;
"RTN","XMRPCTS0",24,0)
 S %=$$DSP("<==MDTA, Now Sending Message #"_XMZ)
"RTN","XMRPCTS0",25,0)
 S ^XMBS(4.2999,XMINST,3)=$H_"^"_XMZ_"^^^^DMI/MM-SSP" ; mailman status
"RTN","XMRPCTS0",26,0)
 W "MDTA",!,XMZ,!,XMMN,!,XMSH S XMLPC=0 ;Here we go!
"RTN","XMRPCTS0",27,0)
 F X=0:0 S X=$O(^XMB(3.9,XMZ,2,X)) Q:X<1  I $D(^(X,0)) S Z=^(0) D  Q:$E(Z,1,6)["NNNN"
"RTN","XMRPCTS0",28,0)
 . N X,Y S X=$C(XMLPC)_Z_XMCR_XMLF X ^%ZOSF("LPC") S XMLPC=Y W Z,!
"RTN","XMRPCTS0",29,0)
 ;S X=$C(XMLPC)_XMLF) X ^%ZOSF("LPC") S XMLPC=Y ;We like that extra lf calculated
"RTN","XMRPCTS0",30,0)
 S XMLPC=$E(XMDH,XMLPC\16+1)_$E(XMDH,XMLPC#16+1) ;The Magic Code
"RTN","XMRPCTS0",31,0)
 W $C(25),XMLPC,XMET,XMCR S %=1 ;Write the checksum
"RTN","XMRPCTS0",32,0)
MAK2 F I=1:1:3 R X:5 Q:$T  ;Look for the status of the one we just sent
"RTN","XMRPCTS0",33,0)
 I X["MAK2" S XMSTAT="Sent-> AMS Msg# "_XMMN R X:3 R X:3 D STAT S XMRPCTS("S")=XMRPCTS("S")+1 G WALK
"RTN","XMRPCTS0",34,0)
 I $E(X["MN") R X:3 R X:3 S XMSTAT="Error: "_$P(X,XMLF,2) D STAT,ERR G WALK
"RTN","XMRPCTS0",35,0)
 S %=%+1 G MAK2:%<3
"RTN","XMRPCTS0",36,0)
 ;
"RTN","XMRPCTS0",37,0)
 S %=$$DSP("==>INVALID RESPONSE from RCVR, Expecting MAK2, Closing up")
"RTN","XMRPCTS0",38,0)
 G EXIT
"RTN","XMRPCTS0",39,0)
 ;
"RTN","XMRPCTS0",40,0)
 Q
"RTN","XMRPCTS0",41,0)
JD() ;Believe it or not these people use Julian Dates
"RTN","XMRPCTS0",42,0)
 N JD,JT,JDT,X,Y
"RTN","XMRPCTS0",43,0)
 S %DT="T",X="N" D ^%DT S JT=$E(Y,9,12)_"0000"
"RTN","XMRPCTS0",44,0)
 S JD=$P($T(JDM),",",$E(Y,4,5))+$E(Y,6,7) S:JD>59 JD=JD+'($E(Y,2,3)#4)
"RTN","XMRPCTS0",45,0)
 S JDT=JD*10000+$E(JT,1,4) S:$L(JDT)<7 JDT=$E("0000000",$L(JDT)+1,7)_JDT Q (JDT)
"RTN","XMRPCTS0",46,0)
JDM ;0,31,59,90,120,151,181,212,243,273,304,334
"RTN","XMRPCTS0",47,0)
 ;
"RTN","XMRPCTS0",48,0)
DSP(XMTRAN) D TRAN^XMC1
"RTN","XMRPCTS0",49,0)
 Q "" ;Show us what is going on
"RTN","XMRPCTS0",50,0)
 ;
"RTN","XMRPCTS0",51,0)
STAT ;Update the Mailman Status
"RTN","XMRPCTS0",52,0)
 S X=$O(^XMB(3.9,XMZ,1,"C","XXX@"_$P(^DIC(4.2,+XMINST,0),U),0))
"RTN","XMRPCTS0",53,0)
 I X>0 S $P(^XMB(3.9,XMZ,1,X,0),U,5,6)=$$DT_U_XMSTAT
"RTN","XMRPCTS0",54,0)
 S ^XMBS(4.2999,XMINST,3)="" ;Mailman Status
"RTN","XMRPCTS0",55,0)
 D KL^XMA1B ;Remove it from the Domains Basket
"RTN","XMRPCTS0",56,0)
 Q
"RTN","XMRPCTS0",57,0)
ERR N %,X,XMSUB,XMTEXT,XMY,Y
"RTN","XMRPCTS0",58,0)
 S %=$$DSP("==>Recording Rejected Message #"_XMZ_"  "_XMSTAT),XMTEXT="^XMB(3.9,"_XMZ_",2,"
"RTN","XMRPCTS0",59,0)
 N XMZ,DIC,XMDF
"RTN","XMRPCTS0",60,0)
 S XMSUB="PCTS Message Returned "_XMSTAT,XMDF=1
"RTN","XMRPCTS0",61,0)
 S XMY("G.PCTS")="" ; Mail group PCTS must be created on the system
"RTN","XMRPCTS0",62,0)
 S XMY(.5)="" D ^XMD Q  ;Send it to the PostMaster anyway
"RTN","XMRPCTS0",63,0)
 ;
"RTN","XMRPCTS0",64,0)
DT() N X,Y,%DT S %DT="T",X="N" D ^%DT Q (Y)
"RTN","XMRPCTS0",65,0)
EXIT S %=$$DSP("==>Quitting<==")
"RTN","XMRPCTS0",66,0)
 W "MEND",! Q
"RTN","XMRPCTS0",67,0)
RQ ;Force this domain to play it's script, it plays regardless...
"RTN","XMRPCTS0",68,0)
 ;Queue this puppy to run at regular intervals.
"RTN","XMRPCTS0",69,0)
 S:'$D(ZTQUEUED) XM="D" ;For Debugging
"RTN","XMRPCTS0",70,0)
 S ZTREQ="@"
"RTN","XMRPCTS0",71,0)
 S (Y,XMSCR)=$O(^DIC(4.2,"B","VHA.DMIA",0)),XMSCRN="VHA.DMIA",XMDUZ=.5
"RTN","XMRPCTS0",72,0)
 S %=$O(^DIC(4.2,XMSCR,1,0))
"RTN","XMRPCTS0",73,0)
 I %<1 K % S %="No script found!"_% G QQ ;FORCE ERROR FOR DEBUGGING
"RTN","XMRPCTS0",74,0)
 S XMDIC="^DIC(4.2,XMSCR,1,"_%_",1,"
"RTN","XMRPCTS0",75,0)
 I '$D(DT) D NOW^%DTC S DT=X,U="^"
"RTN","XMRPCTS0",76,0)
 S %=$S($D(^XMBS(4.2999,+Y,3))#10:$P(^(3),U,7),1:0)
"RTN","XMRPCTS0",77,0)
 I '%!'$$CHK^XMS5(%,XMSCR) S XMSITE=XMSCRN,XMINST=XMSCR D ^XMC1
"RTN","XMRPCTS0",78,0)
QQ S %=$$DSP("Quitting from sending TWIX's") ;D KL1^XMC
"RTN","XMRPCTS0",79,0)
 L  K DIC,X,Y,XMDT,ZTPAR Q:'$G(XMRPCTS0)  S XMCI=XMRPCTS0 Q
"RTN","XMRPCTSA")
0^14^B7379810
"RTN","XMRPCTSA",1,0)
XMRPCTSA ;(KC-VAMC)/XXX-Steal TWIX's from PCTS Host [RCVR] ;10/29/96  09:01
"RTN","XMRPCTSA",2,0)
 ;;7.1;MailMan;**6,31**;Jun 02, 1994
"RTN","XMRPCTSA",3,0)
 ; Create a Mailgroup called PCTS, all messages will be sent to its
"RTN","XMRPCTSA",4,0)
 ; membership.  This can be called from a mailman script, it should
"RTN","XMRPCTSA",5,0)
 ; look something like this:
"RTN","XMRPCTSA",6,0)
 ; 
"RTN","XMRPCTSA",7,0)
 ; O H=VHA.DMIA,P=SCP     <---- Domain name and protocol are meaningless
"RTN","XMRPCTSA",8,0)
 ; C MINI
"RTN","XMRPCTSA",9,0)
 ; L ogin:
"RTN","XMRPCTSA",10,0)
 ; S pcts
"RTN","XMRPCTSA",11,0)
 ; L CODE:
"RTN","XMRPCTSA",12,0)
 ; X W "PCTS RUCHxxx",!    <---- This is your local routing indicator
"RTN","XMRPCTSA",13,0)
 ; X S XMRPCTS0=XMCI+1
"RTN","XMRPCTSA",14,0)
 ; X D ^XMRPCTS              <---- Call this routine
"RTN","XMRPCTSA",15,0)
 ; X K XMRPCTS0
"RTN","XMRPCTSA",16,0)
 ;-----------------
"RTN","XMRPCTSA",17,0)
 ; Mailman Host: VHA.DMIA, Physical Link: MINIOUT
"RTN","XMRPCTSA",18,0)
 ;-------------------------------------------------------------
"RTN","XMRPCTSA",19,0)
XM N %,DIC,X,XMDF,XMTEXT,XXX,XMY,XMZ,Y
"RTN","XMRPCTSA",20,0)
 S %=$$DSP("<==Locally Mailing AMS Message"),XMRPCTS("R")=XMRPCTS("R")+1
"RTN","XMRPCTSA",21,0)
 N XM,XMCHAN,ZTSK,ZTQUEUED S ZTSK=1,ZTQUEUED=1,XMCHAN=1
"RTN","XMRPCTSA",22,0)
 S XMDF=1,U="^",XMTEXT="^TMP($J,",XMDUZ=.5
"RTN","XMRPCTSA",23,0)
 S XMY("G.PCTS")="",XMY(XMDUZ)="",XXX=XMSUB D ^XMD S XMLMN=XMZ
"RTN","XMRPCTSA",24,0)
 ;--Make it look like a network message so we can track some info
"RTN","XMRPCTSA",25,0)
 S Y=$$D^XMGAPI1($$NOW^XLFDT)
"RTN","XMRPCTSA",26,0)
 S ^XMB(3.9,XMZ,2,.001,0)="Received: from PCTS/AMS by "_^XMB("NETNAME")_" via DMI/MM translation with SSP."
"RTN","XMRPCTSA",27,0)
 S ^XMB(3.9,XMZ,2,.002,0)="Subject: "_XXX
"RTN","XMRPCTSA",28,0)
 S ^XMB(3.9,XMZ,2,.003,0)="Date: "_Y_" "_^XMB("TIMEZONE")
"RTN","XMRPCTSA",29,0)
 S ^XMB(3.9,XMZ,2,.004,0)="Message-ID:<"_$P(XMMN," ")_"@AMS>"
"RTN","XMRPCTSA",30,0)
 S ^XMB(3.9,XMZ,2,.005,0)="From: The Austin AMS System"
"RTN","XMRPCTSA",31,0)
 S ^XMB(3.9,XMZ,2,.006,0)="To: G.PCTS"
"RTN","XMRPCTSA",32,0)
 S ^XMB(3.9,XMZ,2,.007,0)="X-Another service provided by DHCP"
"RTN","XMRPCTSA",33,0)
 S ^XMB(3.9,XMZ,2,.008,0)=""
"RTN","XMRPCTSA",34,0)
 Q
"RTN","XMRPCTSA",35,0)
REPLY ;Let AMS know we have the message OK and what our local msg number is
"RTN","XMRPCTSA",36,0)
 S %=$$DSP("<==MAK2, Message #"_XMLMN_" Removed from AMS Queue")
"RTN","XMRPCTSA",37,0)
 U IO W "MAK2",!,XMMN,!,"#"_XMLMN,!,XMET,XMCR Q
"RTN","XMRPCTSA",38,0)
 ;
"RTN","XMRPCTSA",39,0)
INIT ;called from XMRPCTS & XMRPCTS0
"RTN","XMRPCTSA",40,0)
 S %=$$DSP("==>Initializing<==")
"RTN","XMRPCTSA",41,0)
 I '$G(XMCI) S XMCI=$S($G(XMRPCTS0):XMRPCTS0,1:999999) I XMCI>999 S ER=1,Y="Lost the counter to the script processor (XMCI)."
"RTN","XMRPCTSA",42,0)
 S %=0,XMCR=$C(13),XMLF=$C(10),XMET=$C(4),XMSH=$C(1)
"RTN","XMRPCTSA",43,0)
 D TERMON
"RTN","XMRPCTSA",44,0)
 K ^TMP($J) ;Scratch Space
"RTN","XMRPCTSA",45,0)
 S XMLPC=0 ;Longitudinal Parity Check for SSP
"RTN","XMRPCTSA",46,0)
 S XMDH="0123456789ABCDEF" ; for LPC calculations
"RTN","XMRPCTSA",47,0)
 Q
"RTN","XMRPCTSA",48,0)
 ;
"RTN","XMRPCTSA",49,0)
TERMON ;Need to change read terminators
"RTN","XMRPCTSA",50,0)
 I ^%ZOSF("OS")["DSM" U IO:TERM=$C(3,4,13,27) Q
"RTN","XMRPCTSA",51,0)
 I ^%ZOSF("OS")["MSM" U IO:(::::::::$C(3,4,13,27)) Q
"RTN","XMRPCTSA",52,0)
 I ^%ZOSF("OS")["OpenM-NT" U $I:("":"+I":$C(3,4,13,27)) Q
"RTN","XMRPCTSA",53,0)
 W XMRPCTS("ERROR"),"Terminators not defined for this operating system",!
"RTN","XMRPCTSA",54,0)
 Q
"RTN","XMRPCTSA",55,0)
 ;
"RTN","XMRPCTSA",56,0)
DSP(XMTRAN) D TRAN^XMC1
"RTN","XMRPCTSA",57,0)
 Q ""
"RTN","XMRPCTSA",58,0)
 ;
"RTN","XMRPCTSA",59,0)
ERR D ^%ZTER S %=$$DSP("ERROR captured in error trap !!!")
"RTN","XMRPCTSA",60,0)
 G UNWIND^%ZTER
"VER")
8.0^21.0
**END**
**END**
