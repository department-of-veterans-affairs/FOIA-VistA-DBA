Released PSB*3*13 SEQ #21
Extracted from mail message
**KIDS**:PSB*3.0*13^

**INSTALL NAME**
PSB*3.0*13
"BLD",5479,0)
PSB*3.0*13^BAR CODE MED ADMIN^0^3060322^y
"BLD",5479,1,0)
^^117^117^3060228^
"BLD",5479,1,1,0)
 
"BLD",5479,1,2,0)
***
"BLD",5479,1,3,0)
 
"BLD",5479,1,4,0)
This patch is a component of the Bar Code Medication Administration 
"BLD",5479,1,5,0)
(BCMA) Version 3.0.  The main function of PSB*3.0*13 and the 
"BLD",5479,1,6,0)
corresponding BCMA Graphical User Interface (GUI) software (BCMA Version 3
"BLD",5479,1,7,0)
Patch 13 [3.0.13]) is to support BCMA v3.0 Clinical Context Object 
"BLD",5479,1,8,0)
Workgroup (CCOW) compliance. The PSB*3.0*13 GUI and this Character User 
"BLD",5479,1,9,0)
Interface (CHUI) software (PSB*3.0*13) also support Patient Safety 
"BLD",5479,1,10,0)
Issues (PSI) and Remedy Ticket resolution and BCMA Coversheet refinement.
"BLD",5479,1,11,0)
***
"BLD",5479,1,12,0)
 
"BLD",5479,1,13,0)
1.   Problem: PSI-05-064
"BLD",5479,1,14,0)
     BCMA functionality enables a BCMA user to edit the free text 
"BLD",5479,1,15,0)
     BCMA MEDICATION LOG FILE-DISPENSE DRUG SUBFILE (# 53.795) "Units
"BLD",5479,1,16,0)
     of Administration" (field #.04) for an administered medication, when 
"BLD",5479,1,17,0)
     using the Edit Medication Log.  Consequently, the GUI Edit 
"BLD",5479,1,18,0)
     Medication Log (Edit Med Log) allows a BCMA user to modify text in 
"BLD",5479,1,19,0)
     the field labeled "Units" of the "BCMA - Edit Med Log" dialog box.  
"BLD",5479,1,20,0)
     The user is able to change the "Units" from "PATCH" to any other text
"BLD",5479,1,21,0)
     value.  Changing a "PATCH" medication to some other "Units", causes 
"BLD",5479,1,22,0)
     BCMA to not process the administration properly; and causes the BCMA 
"BLD",5479,1,23,0)
     Virtual Due List (VDL) to not present the administration properly.
"BLD",5479,1,24,0)
 
"BLD",5479,1,25,0)
     Corrective Action:
"BLD",5479,1,26,0)
     The BCMA GUI Edit Med Log will not allow any BCMA user to edit the 
"BLD",5479,1,27,0)
     BCMA MEDICATION LOG FILE/DISPENSE DRUG SUBFILE (# 53.795) "Units 
"BLD",5479,1,28,0)
     of Administration" (field # .04) of an administered "PATCH" 
"BLD",5479,1,29,0)
     medication.
"BLD",5479,1,30,0)
 
"BLD",5479,1,31,0)
2.   Problem: PSI-05-032
"BLD",5479,1,32,0)
     The VDL displays a GIVEN medication patch until it has been marked as
"BLD",5479,1,33,0)
     "REMOVED".  This is causing some confusion to users.
"BLD",5479,1,34,0)
 
"BLD",5479,1,35,0)
     Corrective Action:
"BLD",5479,1,36,0)
     BCMA will provide a site parameter that will specify the number of 
"BLD",5479,1,37,0)
     days (7-14) a GIVEN patch will display on the VDL.  The count of 
"BLD",5479,1,38,0)
     days the GIVEN patch displays on the VDL begins when the 
"BLD",5479,1,39,0)
     medication order expires.  This parameter may be set to ""
"BLD",5479,1,40,0)
     (null) to allow GIVEN patches to display on the VDL until it is 
"BLD",5479,1,41,0)
     marked as REMOVED.
"BLD",5479,1,42,0)
 
"BLD",5479,1,43,0)
 
"BLD",5479,1,44,0)
3.   Problem: PSI-05-115
"BLD",5479,1,45,0)
     The Special Instructions on the VDL will display the entire Special 
"BLD",5479,1,46,0)
     Instructions by wrapping the text as needed using the spaces in the 
"BLD",5479,1,47,0)
     Special Instructions. However, ff a word or phrase (without spaces) 
"BLD",5479,1,48,0)
     in the Special Instructions can not be wrapped due to the word or 
"BLD",5479,1,49,0)
     phrase being longer then the width of the column, the text would be 
"BLD",5479,1,50,0)
     truncated when the text ran into the right side of the column. In 
"BLD",5479,1,51,0)
     addition, when the above happens, some of the ending words in the 
"BLD",5479,1,52,0)
     special instructions may be omitted as well.
"BLD",5479,1,53,0)
 
"BLD",5479,1,54,0)
     Correction Action:
"BLD",5479,1,55,0)
     When a word or phrase (without spaces) can not be wrapped and does 
"BLD",5479,1,56,0)
     not fit in the column width, the text will be truncated with an 
"BLD",5479,1,57,0)
     ellipsis to indicate that a portion of the word or phrase was 
"BLD",5479,1,58,0)
     truncated. The occasional omission of ending words in the special 
"BLD",5479,1,59,0)
     instructions will be corrected. 
"BLD",5479,1,60,0)
 
"BLD",5479,1,61,0)
 
"BLD",5479,1,62,0)
4.   Problem:  HD0000000121694
"BLD",5479,1,63,0)
     While a medication patch is being "administered" using Manual 
"BLD",5479,1,64,0)
     Medication Entry[PSB MED LOG NEW ENTRY], that particular scheduled 
"BLD",5479,1,65,0)
     administration does not display on the BCMA Virtual Due List (VDL).
"BLD",5479,1,66,0)
 
"BLD",5479,1,67,0)
     Corrective Action:
"BLD",5479,1,68,0)
     Display the saved "action status" of an administration, while it is 
"BLD",5479,1,69,0)
     being administered using Manual Medication Entry [PSB MED LOG NEW 
"BLD",5479,1,70,0)
     ENTRY]
"BLD",5479,1,71,0)
 
"BLD",5479,1,72,0)
 
"BLD",5479,1,73,0)
5.   Problem:  HD0000000127625
"BLD",5479,1,74,0)
     An error occurs when the BCMA coversheet is to display data for one 
"BLD",5479,1,75,0)
     order only; and that order is an expired, large volume IV.
"BLD",5479,1,76,0)
 
"BLD",5479,1,77,0)
     Corrective Action:
"BLD",5479,1,78,0)
     The BCMA Coversheet will display without error when the only order 
"BLD",5479,1,79,0)
     information to display on the BCMA coversheet pertains to an expired,
"BLD",5479,1,80,0)
     large volume IV.
"BLD",5479,1,81,0)
 
"BLD",5479,1,82,0)
 
"BLD",5479,1,83,0)
6.   Problem:  HD0000000132184
"BLD",5479,1,84,0)
     An error occurs when the BCMA GUI Computerized Patient Record System 
"BLD",5479,1,85,0)
     (CPRS)/BCMA Medication Order Button (MOB) is used and ORDER 
"BLD",5479,1,86,0)
     File (#100) PATIENT LOCATION (field #6) data does not link to a 
"BLD",5479,1,87,0)
     WARD LOCATION File (#42) entry.
"BLD",5479,1,88,0)
 
"BLD",5479,1,89,0)
     Corrective Action:
"BLD",5479,1,90,0)
     BCMA will provide HOSPITAL LOCATION File (#44) data per ORDER File 
"BLD",5479,1,91,0)
     (#100) PATIENT LOCATION (field #6) data when the CPRS/BCMA MOB is 
"BLD",5479,1,92,0)
     used.  CPRS will ORDER File (#100) PATIENT LOCATION (field #6) data 
"BLD",5479,1,93,0)
     to a HOSPITAL LOCATION File (#44) entry 
"BLD",5479,1,94,0)
 
"BLD",5479,1,95,0)
 
"BLD",5479,1,96,0)
7.   Enhancement:  CCOW compliancy
"BLD",5479,1,97,0)
     This patch (PSB*3.0*13) will enable BCMA CCOW compliancy.
"BLD",5479,1,98,0)
 
"BLD",5479,1,99,0)
 
"BLD",5479,1,100,0)
8.   Enhancement:  Enhanced "*UNKNOWN* Action Status" support.
"BLD",5479,1,101,0)
     BCMA Medication Log File (File #53.79) entries having unknown 
"BLD",5479,1,102,0)
     Action Status (field #.09) data can be maintained via the GUI BCMA 
"BLD",5479,1,103,0)
     Edit Med Log only. These entries may be maintained by persons holding
"BLD",5479,1,104,0)
     the BCMA manager's key [PSB MANAGER] or that user unable to complete 
"BLD",5479,1,105,0)
     the original administration.  PSB*3.0*13 supports the VISTA "Unknown 
"BLD",5479,1,106,0)
     Action Status Report" option [PSBO XA].  The [PSBO XA] option 
"BLD",5479,1,107,0)
     provides persons holding the BCMA manager's key [PSB MANAGER] 
"BLD",5479,1,108,0)
     resource to generate a report to display BCMA Medication Log File 
"BLD",5479,1,109,0)
     (#53.79) entries having "unknown" Action Status (field #.09) data.  
"BLD",5479,1,110,0)
     Users holding the BCMA manager's key [PSB MANAGER] can access the 
"BLD",5479,1,111,0)
     PSBO XA report via the BCMA GUI as well.  BCMA has been enhanced to 
"BLD",5479,1,112,0)
     display a "pop-up box" when a user begins an action on an order 
"BLD",5479,1,113,0)
 
"BLD",5479,1,114,0)
 
"BLD",5479,1,115,0)
9.   Enhancement:  Saved Coversheet Personal Parameters
"BLD",5479,1,116,0)
     PSB*3.0*13 will maintain personal parameters per BCMA Coversheet 
"BLD",5479,1,117,0)
     views to be saved and retrieved when using BCMA. 
"BLD",5479,4,0)
^9.64PA^53.69^1
"BLD",5479,4,53.69,0)
53.69
"BLD",5479,4,53.69,2,0)
^9.641^53.69^1
"BLD",5479,4,53.69,2,53.69,0)
BCMA REPORT REQUEST  (File-top level)
"BLD",5479,4,53.69,2,53.69,1,0)
^9.6411^.05^1
"BLD",5479,4,53.69,2,53.69,1,.05,0)
TYPE OF REQUEST
"BLD",5479,4,53.69,222)
y^y^p^^^^n^^n
"BLD",5479,4,53.69,224)
 
"BLD",5479,4,"APDD",53.69,53.69)
 
"BLD",5479,4,"APDD",53.69,53.69,.05)
 
"BLD",5479,4,"B",53.69,53.69)
 
"BLD",5479,6)
1^
"BLD",5479,"ABPKG")
n
"BLD",5479,"INID")
 
"BLD",5479,"KRN",0)
^9.67PA^8989.52^19
"BLD",5479,"KRN",.4,0)
.4
"BLD",5479,"KRN",.401,0)
.401
"BLD",5479,"KRN",.402,0)
.402
"BLD",5479,"KRN",.403,0)
.403
"BLD",5479,"KRN",.403,"NM",0)
^9.68A^2^2
"BLD",5479,"KRN",.403,"NM",1,0)
PSBO XA    FILE #53.69^53.69^0
"BLD",5479,"KRN",.403,"NM",2,0)
PSB NEW IV ENTRY    FILE #53.79^53.79^0
"BLD",5479,"KRN",.403,"NM","B","PSB NEW IV ENTRY    FILE #53.79",2)
 
"BLD",5479,"KRN",.403,"NM","B","PSBO XA    FILE #53.69",1)
 
"BLD",5479,"KRN",.5,0)
.5
"BLD",5479,"KRN",.84,0)
.84
"BLD",5479,"KRN",3.6,0)
3.6
"BLD",5479,"KRN",3.8,0)
3.8
"BLD",5479,"KRN",9.2,0)
9.2
"BLD",5479,"KRN",9.8,0)
9.8
"BLD",5479,"KRN",9.8,"NM",0)
^9.68A^28^24
"BLD",5479,"KRN",9.8,"NM",1,0)
PSBRPC^^0^B92329356
"BLD",5479,"KRN",9.8,"NM",2,0)
PSBRPC3^^0^B296999
"BLD",5479,"KRN",9.8,"NM",3,0)
PSBVDLPA^^0^B13252041
"BLD",5479,"KRN",9.8,"NM",6,0)
PSBVDLPB^^0^B84312284
"BLD",5479,"KRN",9.8,"NM",9,0)
PSBPAR^^0^B21353739
"BLD",5479,"KRN",9.8,"NM",10,0)
PSBUTL^^0^B82345052
"BLD",5479,"KRN",9.8,"NM",11,0)
PSBVDLU1^^0^B56415430
"BLD",5479,"KRN",9.8,"NM",12,0)
PSBVDLUD^^0^B75826811
"BLD",5479,"KRN",9.8,"NM",13,0)
PSBVDLVL^^0^B60130860
"BLD",5479,"KRN",9.8,"NM",14,0)
PSBML^^0^B78116244
"BLD",5479,"KRN",9.8,"NM",15,0)
PSBMLU^^0^B6301609
"BLD",5479,"KRN",9.8,"NM",16,0)
PSBMLLKU^^0^B65545220
"BLD",5479,"KRN",9.8,"NM",17,0)
PSBO^^0^B62943627
"BLD",5479,"KRN",9.8,"NM",18,0)
PSBO1^^0^B5347535
"BLD",5479,"KRN",9.8,"NM",19,0)
PSBOXA^^0^B24284983
"BLD",5479,"KRN",9.8,"NM",20,0)
PSBML2^^0^B67471852
"BLD",5479,"KRN",9.8,"NM",21,0)
PSBVDLU3^^0^B39075787
"BLD",5479,"KRN",9.8,"NM",22,0)
PSBCSUTL^^0^B82253654
"BLD",5479,"KRN",9.8,"NM",23,0)
PSBCSUTX^^0^B78201826
"BLD",5479,"KRN",9.8,"NM",24,0)
PSBMLEN1^^0^B45353757
"BLD",5479,"KRN",9.8,"NM",25,0)
PSBML3^^0^B40505286
"BLD",5479,"KRN",9.8,"NM",26,0)
PSBPRN^^0^B23314092
"BLD",5479,"KRN",9.8,"NM",27,0)
PSBOPM^^0^B77561765
"BLD",5479,"KRN",9.8,"NM",28,0)
PSBOHDR^^0^B21187983
"BLD",5479,"KRN",9.8,"NM","B","PSBCSUTL",22)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBCSUTX",23)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBML",14)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBML2",20)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBML3",25)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBMLEN1",24)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBMLLKU",16)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBMLU",15)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBO",17)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBO1",18)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBOHDR",28)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBOPM",27)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBOXA",19)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBPAR",9)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBPRN",26)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBRPC",1)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBRPC3",2)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBUTL",10)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBVDLPA",3)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBVDLPB",6)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBVDLU1",11)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBVDLU3",21)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBVDLUD",12)
 
"BLD",5479,"KRN",9.8,"NM","B","PSBVDLVL",13)
 
"BLD",5479,"KRN",19,0)
19
"BLD",5479,"KRN",19,"NM",0)
^9.68A^5^4
"BLD",5479,"KRN",19,"NM",2,0)
PSB GUI CONTEXT - USER^^0
"BLD",5479,"KRN",19,"NM",3,0)
PSBO^^3
"BLD",5479,"KRN",19,"NM",4,0)
PSB MGR^^3
"BLD",5479,"KRN",19,"NM",5,0)
PSBO XA^^0^
"BLD",5479,"KRN",19,"NM","B","PSB GUI CONTEXT - USER",2)
 
"BLD",5479,"KRN",19,"NM","B","PSB MGR",4)
 
"BLD",5479,"KRN",19,"NM","B","PSBO",3)
 
"BLD",5479,"KRN",19,"NM","B","PSBO XA",5)
 
"BLD",5479,"KRN",19.1,0)
19.1
"BLD",5479,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5479,"KRN",101,0)
101
"BLD",5479,"KRN",101,"NM",0)
^9.68A^^
"BLD",5479,"KRN",409.61,0)
409.61
"BLD",5479,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",5479,"KRN",771,0)
771
"BLD",5479,"KRN",870,0)
870
"BLD",5479,"KRN",8989.51,0)
8989.51
"BLD",5479,"KRN",8989.51,"NM",0)
^9.68A^7^7
"BLD",5479,"KRN",8989.51,"NM",1,0)
PSB VDL PATCH DAYS^^0
"BLD",5479,"KRN",8989.51,"NM",2,0)
PSB COVERSHEET VIEWS COL SORT^^0
"BLD",5479,"KRN",8989.51,"NM",3,0)
PSB COVERSHEET V1 COL WIDTHS^^0
"BLD",5479,"KRN",8989.51,"NM",4,0)
PSB COVERSHEET V2 COL WIDTHS^^0
"BLD",5479,"KRN",8989.51,"NM",5,0)
PSB COVERSHEET V3 COL WIDTHS^^0
"BLD",5479,"KRN",8989.51,"NM",6,0)
PSB COVERSHEET V4 COL WIDTHS^^0
"BLD",5479,"KRN",8989.51,"NM",7,0)
PSB MG ADMIN ERROR^^0
"BLD",5479,"KRN",8989.51,"NM","B","PSB COVERSHEET V1 COL WIDTHS",3)
 
"BLD",5479,"KRN",8989.51,"NM","B","PSB COVERSHEET V2 COL WIDTHS",4)
 
"BLD",5479,"KRN",8989.51,"NM","B","PSB COVERSHEET V3 COL WIDTHS",5)
 
"BLD",5479,"KRN",8989.51,"NM","B","PSB COVERSHEET V4 COL WIDTHS",6)
 
"BLD",5479,"KRN",8989.51,"NM","B","PSB COVERSHEET VIEWS COL SORT",2)
 
"BLD",5479,"KRN",8989.51,"NM","B","PSB MG ADMIN ERROR",7)
 
"BLD",5479,"KRN",8989.51,"NM","B","PSB VDL PATCH DAYS",1)
 
"BLD",5479,"KRN",8989.52,0)
8989.52
"BLD",5479,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",5479,"KRN",8994,0)
8994
"BLD",5479,"KRN",8994,"NM",0)
^9.68A^4^4
"BLD",5479,"KRN",8994,"NM",1,0)
PSB USERLOAD^^0
"BLD",5479,"KRN",8994,"NM",2,0)
PSB USERSAVE^^0
"BLD",5479,"KRN",8994,"NM",3,0)
PSB UTL XSTATUS SRCH^^0
"BLD",5479,"KRN",8994,"NM",4,0)
PSB SCANPT^^0
"BLD",5479,"KRN",8994,"NM","B","PSB SCANPT",4)
 
"BLD",5479,"KRN",8994,"NM","B","PSB USERLOAD",1)
 
"BLD",5479,"KRN",8994,"NM","B","PSB USERSAVE",2)
 
"BLD",5479,"KRN",8994,"NM","B","PSB UTL XSTATUS SRCH",3)
 
"BLD",5479,"KRN","B",.4,.4)
 
"BLD",5479,"KRN","B",.401,.401)
 
"BLD",5479,"KRN","B",.402,.402)
 
"BLD",5479,"KRN","B",.403,.403)
 
"BLD",5479,"KRN","B",.5,.5)
 
"BLD",5479,"KRN","B",.84,.84)
 
"BLD",5479,"KRN","B",3.6,3.6)
 
"BLD",5479,"KRN","B",3.8,3.8)
 
"BLD",5479,"KRN","B",9.2,9.2)
 
"BLD",5479,"KRN","B",9.8,9.8)
 
"BLD",5479,"KRN","B",19,19)
 
"BLD",5479,"KRN","B",19.1,19.1)
 
"BLD",5479,"KRN","B",101,101)
 
"BLD",5479,"KRN","B",409.61,409.61)
 
"BLD",5479,"KRN","B",771,771)
 
"BLD",5479,"KRN","B",870,870)
 
"BLD",5479,"KRN","B",8989.51,8989.51)
 
"BLD",5479,"KRN","B",8989.52,8989.52)
 
"BLD",5479,"KRN","B",8994,8994)
 
"BLD",5479,"PRE")
 
"BLD",5479,"QUES",0)
^9.62^^
"BLD",5479,"REQB",0)
^9.611^8^8
"BLD",5479,"REQB",1,0)
PSB*3.0*16^2
"BLD",5479,"REQB",2,0)
PSB*3.0*20^2
"BLD",5479,"REQB",3,0)
PSB*3.0*4^2
"BLD",5479,"REQB",4,0)
PSB*3.0*9^2
"BLD",5479,"REQB",5,0)
PSB*3.0*11^2
"BLD",5479,"REQB",6,0)
PSB*3.0*3^2
"BLD",5479,"REQB",7,0)
OR*3.0*215^2
"BLD",5479,"REQB",8,0)
PSB*3.0*5^2
"BLD",5479,"REQB","B","OR*3.0*215",7)
 
"BLD",5479,"REQB","B","PSB*3.0*11",5)
 
"BLD",5479,"REQB","B","PSB*3.0*16",1)
 
"BLD",5479,"REQB","B","PSB*3.0*20",2)
 
"BLD",5479,"REQB","B","PSB*3.0*3",6)
 
"BLD",5479,"REQB","B","PSB*3.0*4",3)
 
"BLD",5479,"REQB","B","PSB*3.0*5",8)
 
"BLD",5479,"REQB","B","PSB*3.0*9",4)
 
"FIA",53.69)
BCMA REPORT REQUEST
"FIA",53.69,0)
^PSB(53.69,
"FIA",53.69,0,0)
53.69
"FIA",53.69,0,1)
y^y^p^^^^n^^n
"FIA",53.69,0,10)
 
"FIA",53.69,0,11)
 
"FIA",53.69,0,"RLRO")
 
"FIA",53.69,0,"VR")
3.0^PSB
"FIA",53.69,53.69)
1
"FIA",53.69,53.69,.05)
 
"KRN",.403,93,-1)
0^2
"KRN",.403,93,0)
PSB NEW IV ENTRY^^^^2990323.1252^^^53.79^0^0^1
"KRN",.403,93,11)
S PSBSAVE=0
"KRN",.403,93,14)
S PSBSAVE=1
"KRN",.403,93,20)
S PSBSAVE=0
"KRN",.403,93,40,0)
^.4031I^2^2
"KRN",.403,93,40,1,0)
1^^1,1
"KRN",.403,93,40,1,1)
Page 1
"KRN",.403,93,40,1,40,0)
^.4032IP^323^1
"KRN",.403,93,40,1,40,323,0)
PSB NEW IV ENTRY^1^1,1^e
"KRN",.403,93,40,2,0)
2^^5,5^^^1^15,75
"KRN",.403,93,40,2,1)
Page 2
"KRN",.403,93,40,2,40,0)
^.4032IP^325^2
"KRN",.403,93,40,2,40,324,0)
PSB NEW IV ENTRY ADD HDR^1^1,1^d
"KRN",.403,93,40,2,40,325,0)
PSB NEW IV ENTRY ADD^2^4,3^e
"KRN",.403,93,40,2,40,325,2)
3^B^f^1
"KRN",.403,113,-1)
0^1
"KRN",.403,113,0)
PSBO XA^^^^2990313.1144^^Unknown Action Status Report^53.69^0^0^1
"KRN",.403,113,11)
S PSBSAVE=0
"KRN",.403,113,14)
S PSBSAVE=1
"KRN",.403,113,20)
D VAL^PSBO(".16;.18;.06;.07")
"KRN",.403,113,40,0)
^.4031I^1^1
"KRN",.403,113,40,1,0)
1^^1,1
"KRN",.403,113,40,1,1)
Page 1
"KRN",.403,113,40,1,40,0)
^.4032IP^426^3
"KRN",.403,113,40,1,40,422,0)
PSBO XHDR^1^1,1^d
"KRN",.403,113,40,1,40,424,0)
PSBO XFTR^3^10,1^e
"KRN",.403,113,40,1,40,426,0)
PSBO XDATE XA^2^3,1^e
"KRN",.404,323,0)
PSB NEW IV ENTRY^53.79
"KRN",.404,323,40,0)
^.4044I^13^13
"KRN",.404,323,40,1,0)
4^^3
"KRN",.404,323,40,1,1)
.01
"KRN",.404,323,40,1,2)
4,16^30
"KRN",.404,323,40,1,4)
0^^^1
"KRN",.404,323,40,2,0)
1^Medication Log Manual Entry - IV Order^1
"KRN",.404,323,40,2,2)
^^1,1
"KRN",.404,323,40,3,0)
2^!M^1
"KRN",.404,323,40,3,.1)
S Y=$TR($J("",IOM)," ","-")
"KRN",.404,323,40,3,2)
^^2,1
"KRN",.404,323,40,4,0)
5^!M^1
"KRN",.404,323,40,4,.1)
S Y="SSN: "_$$GET1^DIQ(2,$P(^PSB(53.79,DA,0),U)_",",.09)
"KRN",.404,323,40,4,2)
^^4,47
"KRN",.404,323,40,5,0)
7^Admin Status^3
"KRN",.404,323,40,5,1)
.09
"KRN",.404,323,40,5,2)
7,18^7^7,2
"KRN",.404,323,40,5,3)
 
"KRN",.404,323,40,5,3.1)
 
"KRN",.404,323,40,5,4)
^^^0
"KRN",.404,323,40,5,14)
D:$G(PSBMMEN) VALID^PSBMLEN
"KRN",.404,323,40,6,0)
8^Admin Date/Time^3
"KRN",.404,323,40,6,1)
.06
"KRN",.404,323,40,6,2)
7,44^20^7,27
"KRN",.404,323,40,6,4)
1
"KRN",.404,323,40,6,14)
D FDATE^PSBMLEN1
"KRN",.404,323,40,7,0)
10^PRN Reason^3
"KRN",.404,323,40,7,1)
.21
"KRN",.404,323,40,7,2)
10,22^58^10,2
"KRN",.404,323,40,8,0)
11^PRN Effectiveness^3
"KRN",.404,323,40,8,1)
.22
"KRN",.404,323,40,8,2)
11,22^58^11,2
"KRN",.404,323,40,9,0)
13^Comment (Required)^2
"KRN",.404,323,40,9,2)
16,2^78^15,2
"KRN",.404,323,40,9,4)
1
"KRN",.404,323,40,9,20)
F^^1:150
"KRN",.404,323,40,9,23)
D COMMENT^PSBML(DA,X)
"KRN",.404,323,40,10,0)
6^Medication^3
"KRN",.404,323,40,10,1)
.08
"KRN",.404,323,40,10,2)
5,16^40^5,2
"KRN",.404,323,40,10,4)
^^^1
"KRN",.404,323,40,11,0)
3^Patient:^1
"KRN",.404,323,40,11,2)
^^4,2
"KRN",.404,323,40,12,0)
9^Injection Site^3
"KRN",.404,323,40,12,1)
.16
"KRN",.404,323,40,12,2)
8,18^30^8,2
"KRN",.404,323,40,13,0)
12^Additives...^2
"KRN",.404,323,40,13,2)
13,17^1^13,2^1
"KRN",.404,323,40,13,7)
^2
"KRN",.404,323,40,13,20)
F^^1:1
"KRN",.404,324,0)
PSB NEW IV ENTRY ADD HDR^53.79^
"KRN",.404,324,40,0)
^.4044I^3^3
"KRN",.404,324,40,1,0)
1^ Additives ^1
"KRN",.404,324,40,1,2)
^^1,2
"KRN",.404,324,40,2,0)
2^Additives                        Order   Given  Units^1
"KRN",.404,324,40,2,2)
^^3,3
"KRN",.404,324,40,3,0)
3^Units   Units^1
"KRN",.404,324,40,3,2)
^^2,36
"KRN",.404,325,0)
PSB NEW IV ENTRY ADD^53.796
"KRN",.404,325,40,0)
^.4044I^4^4
"KRN",.404,325,40,1,0)
1^^3
"KRN",.404,325,40,1,1)
.01
"KRN",.404,325,40,1,2)
1,1^30
"KRN",.404,325,40,1,4)
^^^1
"KRN",.404,325,40,2,0)
2^^3
"KRN",.404,325,40,2,1)
.02
"KRN",.404,325,40,2,2)
1,33^6
"KRN",.404,325,40,2,4)
^^1^1
"KRN",.404,325,40,3,0)
3^^3
"KRN",.404,325,40,3,1)
.03
"KRN",.404,325,40,3,2)
1,41^6
"KRN",.404,325,40,3,4)
1^^1
"KRN",.404,325,40,4,0)
4^^3
"KRN",.404,325,40,4,1)
.04
"KRN",.404,325,40,4,2)
1,49^10
"KRN",.404,325,40,4,4)
1
"KRN",.404,422,0)
PSBO XHDR^53.69^
"KRN",.404,422,40,0)
^.4044I^4^3
"KRN",.404,422,40,1,0)
1^!M^1
"KRN",.404,422,40,1,.1)
S Y="Request #: "_$P(^PSB(53.69,DA,0),U)
"KRN",.404,422,40,1,2)
^^1,1
"KRN",.404,422,40,3,0)
3^!M^1
"KRN",.404,422,40,3,.1)
S Y=$TR($J("",80)," ","-")
"KRN",.404,422,40,3,2)
^^2,1
"KRN",.404,422,40,4,0)
2^!M^1
"KRN",.404,422,40,4,.1)
S Y=$J($$GET1^DIQ(53.69,DA_",",.05),40)
"KRN",.404,422,40,4,2)
^^1,41
"KRN",.404,424,0)
PSBO XFTR^53.69
"KRN",.404,424,40,0)
^.4044I^3^3
"KRN",.404,424,40,1,0)
1^Print to DEVICE^3
"KRN",.404,424,40,1,1)
.06
"KRN",.404,424,40,1,2)
2,58^22^2,41
"KRN",.404,424,40,1,3)
!M
"KRN",.404,424,40,1,3.1)
S Y=$$GET^XPAR("USR","PSB PRINTER USER DEFAULT",1,"E")
"KRN",.404,424,40,1,13)
D EN^XPAR("USR","PSB PRINTER USER DEFAULT",1,"`"_X)
"KRN",.404,424,40,2,0)
2^Queue To Run At^3
"KRN",.404,424,40,2,1)
.07
"KRN",.404,424,40,2,2)
3,58^17^3,41
"KRN",.404,424,40,2,3)
NOW
"KRN",.404,424,40,3,0)
3^Instructions: PF1-E Submit   PF1-Q Cancel   PF1-R Refresh   <Ret> Re-Edit^2
"KRN",.404,424,40,3,2)
8,76^1^8,1
"KRN",.404,424,40,3,10)
S DDSBR="1^2^1" ; Return to field 1 block 2
"KRN",.404,424,40,3,20)
F^^1:1
"KRN",.404,426,0)
PSBO XDATE XA^53.69
"KRN",.404,426,40,0)
^.4044I^3^3
"KRN",.404,426,40,1,0)
1^Start Date^3
"KRN",.404,426,40,1,1)
.16
"KRN",.404,426,40,1,2)
4,14^11^4,2
"KRN",.404,426,40,1,3)
Today-7
"KRN",.404,426,40,2,0)
2^Stop Date^3
"KRN",.404,426,40,2,1)
.18
"KRN",.404,426,40,2,2)
4,40^11^4,29
"KRN",.404,426,40,2,3)
Today
"KRN",.404,426,40,3,0)
3^Select Division^3
"KRN",.404,426,40,3,1)
.04
"KRN",.404,426,40,3,2)
6,19^30^6,2
"KRN",.404,426,40,3,3)
DUZ(2)
"KRN",.404,426,40,3,3.1)
 
"KRN",.404,426,40,3,4)
1
"KRN",19,11586,-1)
0^2
"KRN",19,11586,0)
PSB GUI CONTEXT - USER^BCMA Client Context^^B^^^^^^^^
"KRN",19,11586,99)
59973,28281
"KRN",19,11586,99.1)
59676,26361
"KRN",19,11586,"RPC",0)
^19.05P^51^51
"KRN",19,11586,"RPC",2,0)
PSB FMDATE
"KRN",19,11586,"RPC",4,0)
PSB GETPRNS
"KRN",19,11586,"RPC",5,0)
PSB INSTRUCTOR
"KRN",19,11586,"RPC",7,0)
PSB MEDICATION HISTORY
"KRN",19,11586,"RPC",8,0)
PSB PARAMETER
"KRN",19,11586,"RPC",12,0)
PSB SCANMED
"KRN",19,11586,"RPC",13,0)
PSB SCANPT
"KRN",19,11586,"RPC",14,0)
PSB SERVER CLOCK VARIANCE
"KRN",19,11586,"RPC",15,0)
PSB SUBMIT MISSING DOSE
"KRN",19,11586,"RPC",16,0)
PSB TRANSACTION
"KRN",19,11586,"RPC",17,0)
PSB USERLOAD
"KRN",19,11586,"RPC",18,0)
PSB USERSAVE
"KRN",19,11586,"RPC",19,0)
PSB VALIDATE ESIG
"KRN",19,11586,"RPC",20,0)
PSB VALIDATE ORDER
"KRN",19,11586,"RPC",21,0)
PSB CHECK SERVER
"KRN",19,11586,"RPC",23,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,11586,"RPC",24,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,11586,"RPC",26,0)
PSB GETORDERTAB
"KRN",19,11586,"RPC",27,0)
PSB GETIVPAR
"KRN",19,11586,"RPC",28,0)
PSB PUTIVPAR
"KRN",19,11586,"RPC",29,0)
PSB DEVICE
"KRN",19,11586,"RPC",30,0)
PSB IV ORDER HISTORY
"KRN",19,11586,"RPC",31,0)
PSB BAG DETAIL
"KRN",19,11586,"RPC",32,0)
PSB WARDLIST
"KRN",19,11586,"RPC",33,0)
PSB MAIL
"KRN",19,11586,"RPC",34,0)
PSB ALLERGY
"KRN",19,11586,"RPC",35,0)
PSB GETPROVIDER
"KRN",19,11586,"RPC",36,0)
PSB REPORT
"KRN",19,11586,"RPC",37,0)
PSB MOB DRUG LIST
"KRN",19,11586,"RPC",38,0)
PSB MAXDAYS
"KRN",19,11586,"RPC",39,0)
PSB NURS WARDLIST
"KRN",19,11586,"RPC",40,0)
PSB CPRS ORDER
"KRN",19,11586,"RPC",41,0)
ORWUBCMA USERINFO
"KRN",19,11586,"RPC",43,0)
ORBCMA5 GETUDID
"KRN",19,11586,"RPC",44,0)
ORBCMA5 GETIVID
"KRN",19,11586,"RPC",45,0)
PSB VERSION CHECK
"KRN",19,11586,"RPC",46,0)
PSB CHECK IV
"KRN",19,11586,"RPC",47,0)
PSB VITALS
"KRN",19,11586,"RPC",48,0)
PSB VITAL MEAS FILE
"KRN",19,11586,"RPC",49,0)
PSB MED LOG LOOKUP
"KRN",19,11586,"RPC",50,0)
PSB COVERSHEET1
"KRN",19,11586,"RPC",51,0)
PSB UTL XSTATUS SRCH
"KRN",19,11586,"U")
BCMA CLIENT CONTEXT
"KRN",19,11587,-1)
3^3
"KRN",19,11587,0)
PSBO^Reports^^M^^^^^^^^BAR CODE MED ADMIN
"KRN",19,11587,10,0)
^19.01IP^15^8
"KRN",19,11587,10,8,0)
12951^XA^
"KRN",19,11587,10,8,"^")
PSBO XA
"KRN",19,11587,99)
60305,41992
"KRN",19,11587,"U")
REPORTS
"KRN",19,11598,-1)
3^4
"KRN",19,11598,0)
PSB MGR^Bar Code Medication Administration Manager^^M^^PSB MANAGER^^^^^^BAR CODE MED ADMIN
"KRN",19,11598,10,0)
^19.01IP^16^8
"KRN",19,11598,10,9,0)
12951
"KRN",19,11598,10,9,"^")
PSBO XA
"KRN",19,11598,99)
60305,42679
"KRN",19,11598,99.1)
59570,52713
"KRN",19,11598,"U")
BAR CODE MEDICATION ADMINISTRA
"KRN",19,12951,-1)
0^5
"KRN",19,12951,0)
PSBO XA^Unknown Action Status Report^^R^^PSB MANAGER^^^^^^BAR CODE MED ADMIN
"KRN",19,12951,25)
XQ^PSBO("XA")
"KRN",19,12951,"U")
UNKNOWN ACTION STATUS REPORT
"KRN",8989.51,407,-1)
0^1
"KRN",8989.51,407,0)
PSB VDL PATCH DAYS^Days GIVEN patch on VDL^0^^Value 7-14 (days)^0
"KRN",8989.51,407,1)
F^^Enter a number (days) a GIVEN medication patch displays on the VDL.
"KRN",8989.51,407,2)
I X]"" K:(+X<7)!(+X>14) X
"KRN",8989.51,407,3)
 
"KRN",8989.51,407,4,0)
^8989.514^6^6
"KRN",8989.51,407,4,1,0)
patch
"KRN",8989.51,407,4,2,0)
Patch
"KRN",8989.51,407,4,3,0)
PATCH
"KRN",8989.51,407,4,4,0)
PSB
"KRN",8989.51,407,4,5,0)
BCMA
"KRN",8989.51,407,4,6,0)
GIVEN PATCH
"KRN",8989.51,407,4,"B","BCMA",5)
 
"KRN",8989.51,407,4,"B","GIVEN PATCH",6)
 
"KRN",8989.51,407,4,"B","PATCH",3)
 
"KRN",8989.51,407,4,"B","PSB",4)
 
"KRN",8989.51,407,4,"B","Patch",2)
 
"KRN",8989.51,407,4,"B","patch",1)
 
"KRN",8989.51,407,6)
^^Enter a value between 7 and 14.
"KRN",8989.51,407,20,0)
^8989.512^10^10^3060123^^^^
"KRN",8989.51,407,20,1,0)
PSB VDL PATCH DAYS -
"KRN",8989.51,407,20,2,0)
 
"KRN",8989.51,407,20,3,0)
The value of this parameter should be between 7 and 14.
"KRN",8989.51,407,20,4,0)
 
"KRN",8989.51,407,20,5,0)
PSB VDL PATCH DAYS is the parameter which determines the number of days a 
"KRN",8989.51,407,20,6,0)
patient's GIVEN medication patch will display on the respective Bar
"KRN",8989.51,407,20,7,0)
Code Medication Administration (BCMA) Virtual Due List (VDL) and BCMA 
"KRN",8989.51,407,20,8,0)
Coversheet.  If this parameter is equal to the  "null" value, a GIVEN 
"KRN",8989.51,407,20,9,0)
medication patch will always display on the respective BCMA VDL and BCMA 
"KRN",8989.51,407,20,10,0)
Coversheet.
"KRN",8989.51,407,30,0)
^8989.513I^2^1
"KRN",8989.51,407,30,2,0)
1^4
"KRN",8989.51,412,-1)
0^2
"KRN",8989.51,412,0)
PSB COVERSHEET VIEWS COL SORT^Coversheet views sort (#/#/#/#).^0^Coversheet sort colmuns #/#/#/#  ^#/#/#/#^0
"KRN",8989.51,412,1)
F^^Enter column number per coversheet view sorting, delimited by "/"
"KRN",8989.51,412,4,0)
^8989.514^6^6
"KRN",8989.51,412,4,1,0)
Coversheet
"KRN",8989.51,412,4,2,0)
View
"KRN",8989.51,412,4,3,0)
Sort
"KRN",8989.51,412,4,4,0)
Column
"KRN",8989.51,412,4,5,0)
User
"KRN",8989.51,412,4,6,0)
Setting
"KRN",8989.51,412,4,"B","Column",4)
 
"KRN",8989.51,412,4,"B","Coversheet",1)
 
"KRN",8989.51,412,4,"B","Setting",6)
 
"KRN",8989.51,412,4,"B","Sort",3)
 
"KRN",8989.51,412,4,"B","User",5)
 
"KRN",8989.51,412,4,"B","View",2)
 
"KRN",8989.51,412,6)
F^^Enter column number per coversheet view sorting, delimited by "/"
"KRN",8989.51,412,20,0)
^^11^11^3051221^
"KRN",8989.51,412,20,1,0)
This is a USER SPECIFIC PARAMETER.
"KRN",8989.51,412,20,2,0)
 
"KRN",8989.51,412,20,3,0)
This parameter contains 4 column number used to sort each of the 4 
"KRN",8989.51,412,20,4,0)
different Coversheet Views respectively, delimited by the slash 
"KRN",8989.51,412,20,5,0)
(/)                                                                
"KRN",8989.51,412,20,6,0)
character.  First (Medication Overview),  Second (PRN Overview), Third (IV
"KRN",8989.51,412,20,7,0)
Overview), and Forth (Expired/Expiring Orders), are the coversheet views 
"KRN",8989.51,412,20,8,0)
in sequence.  Each view's columns are numbered from left to right.  An 
"KRN",8989.51,412,20,9,0)
example parameter setting is:
"KRN",8989.51,412,20,10,0)
 
"KRN",8989.51,412,20,11,0)
            7/3/1/3
"KRN",8989.51,412,30,0)
^8989.513I^1^1
"KRN",8989.51,412,30,1,0)
1^200
"KRN",8989.51,413,-1)
0^3
"KRN",8989.51,413,0)
PSB COVERSHEET V1 COL WIDTHS^Widths of each View 1 col^0^^#/#/#/#/#/#/#/#/# ^0
"KRN",8989.51,413,1)
F^^Enter the widths for each Coversheet View 1 col delimited with "/" 
"KRN",8989.51,413,4,0)
^8989.514^7^7
"KRN",8989.51,413,4,1,0)
coversheet
"KRN",8989.51,413,4,2,0)
overview
"KRN",8989.51,413,4,3,0)
column
"KRN",8989.51,413,4,4,0)
width
"KRN",8989.51,413,4,5,0)
settings
"KRN",8989.51,413,4,6,0)
user setting
"KRN",8989.51,413,4,7,0)
BCMA
"KRN",8989.51,413,4,"B","BCMA",7)
 
"KRN",8989.51,413,4,"B","column",3)
 
"KRN",8989.51,413,4,"B","coversheet",1)
 
"KRN",8989.51,413,4,"B","overview",2)
 
"KRN",8989.51,413,4,"B","settings",5)
 
"KRN",8989.51,413,4,"B","user setting",6)
 
"KRN",8989.51,413,4,"B","width",4)
 
"KRN",8989.51,413,6)
F^^Enter the widths for each Coversheet View 1 col delimited with "/" 
"KRN",8989.51,413,20,0)
^^14^14^3051222^
"KRN",8989.51,413,20,1,0)
USER specific setting for the BCMA Coversheet's "first view" .
"KRN",8989.51,413,20,2,0)
 
"KRN",8989.51,413,20,3,0)
This parameter contains the width of each column viewed via the Bar Code 
"KRN",8989.51,413,20,4,0)
Medication Administration Coversheet's "first view" delimited by the 
"KRN",8989.51,413,20,5,0)
slash (/).  Each "/"-piece of data is per respective column on the 
"KRN",8989.51,413,20,6,0)
Coversheet's "first view", numbered from left to right.  An 
"KRN",8989.51,413,20,7,0)
example parameter setting is:
"KRN",8989.51,413,20,8,0)
 
"KRN",8989.51,413,20,9,0)
      170/20/100/30/11/22/31/44/50
"KRN",8989.51,413,20,10,0)
 
"KRN",8989.51,413,20,11,0)
Setting numbers are in units of centimeters. 
"KRN",8989.51,413,20,12,0)
 
"KRN",8989.51,413,20,13,0)
 
"KRN",8989.51,413,20,14,0)
 THESE NUMBERS MUST BE WHOLE NUMBERS.
"KRN",8989.51,413,30,0)
^8989.513I^1^1
"KRN",8989.51,413,30,1,0)
1^200
"KRN",8989.51,414,-1)
0^4
"KRN",8989.51,414,0)
PSB COVERSHEET V2 COL WIDTHS^Widths of each View 2 col^0^^#/#/#/#/#/#/#/#/# ^0
"KRN",8989.51,414,1)
F^^Enter the widths for each Coversheet View 2 col delimited with "/" 
"KRN",8989.51,414,4,0)
^8989.514^8^7
"KRN",8989.51,414,4,1,0)
coversheet
"KRN",8989.51,414,4,2,0)
overview
"KRN",8989.51,414,4,3,0)
column
"KRN",8989.51,414,4,4,0)
width
"KRN",8989.51,414,4,5,0)
settings
"KRN",8989.51,414,4,6,0)
user setting
"KRN",8989.51,414,4,8,0)
BCMA
"KRN",8989.51,414,4,"B","BCMA",8)
 
"KRN",8989.51,414,4,"B","column",3)
 
"KRN",8989.51,414,4,"B","coversheet",1)
 
"KRN",8989.51,414,4,"B","overview",2)
 
"KRN",8989.51,414,4,"B","settings",5)
 
"KRN",8989.51,414,4,"B","user setting",6)
 
"KRN",8989.51,414,4,"B","width",4)
 
"KRN",8989.51,414,6)
F^^Enter the widths for each Coversheet View 2 col delimited with "/" 
"KRN",8989.51,414,20,0)
^^14^14^3051222^
"KRN",8989.51,414,20,1,0)
USER specific setting for the BCMA Coversheet's "second view".
"KRN",8989.51,414,20,2,0)
 
"KRN",8989.51,414,20,3,0)
This parameter contains the width of each column viewed via the Bar Code 
"KRN",8989.51,414,20,4,0)
Medication Administration Coversheet's "second view" delimited by the
"KRN",8989.51,414,20,5,0)
slash (/).  Each "/"-piece of data is per respective column on the 
"KRN",8989.51,414,20,6,0)
Coversheet's "second view", numbered from left to right.  An example 
"KRN",8989.51,414,20,7,0)
parameter setting is:
"KRN",8989.51,414,20,8,0)
 
"KRN",8989.51,414,20,9,0)
      170/20/100/30/11/22/31/44/50
"KRN",8989.51,414,20,10,0)
 
"KRN",8989.51,414,20,11,0)
Setting numbers are in units of centimeters. 
"KRN",8989.51,414,20,12,0)
 
"KRN",8989.51,414,20,13,0)
 
"KRN",8989.51,414,20,14,0)
 THESE NUMBERS MUST BE WHOLE NUMBERS.
"KRN",8989.51,414,30,0)
^8989.513I^1^1
"KRN",8989.51,414,30,1,0)
1^200
"KRN",8989.51,415,-1)
0^5
"KRN",8989.51,415,0)
PSB COVERSHEET V3 COL WIDTHS^Widths of each View 3 col.^0^^#/#/#/#/#/#/#/#/# ^0
"KRN",8989.51,415,1)
F^^Enter the widths for each Coversheet View 3 col delimited with "/" 
"KRN",8989.51,415,4,0)
^8989.514^7^7
"KRN",8989.51,415,4,1,0)
coversheet
"KRN",8989.51,415,4,2,0)
overview
"KRN",8989.51,415,4,3,0)
column
"KRN",8989.51,415,4,4,0)
width
"KRN",8989.51,415,4,5,0)
settings
"KRN",8989.51,415,4,6,0)
user settings
"KRN",8989.51,415,4,7,0)
BCMA
"KRN",8989.51,415,4,"B","BCMA",7)
 
"KRN",8989.51,415,4,"B","column",3)
 
"KRN",8989.51,415,4,"B","coversheet",1)
 
"KRN",8989.51,415,4,"B","overview",2)
 
"KRN",8989.51,415,4,"B","settings",5)
 
"KRN",8989.51,415,4,"B","user settings",6)
 
"KRN",8989.51,415,4,"B","width",4)
 
"KRN",8989.51,415,6)
F^^Enter the widths for each Coversheet View 3 col delimited with "/" 
"KRN",8989.51,415,20,0)
^^15^15^3051222^
"KRN",8989.51,415,20,1,0)
USER specific setting for the BCMA Coversheet's "third view".
"KRN",8989.51,415,20,2,0)
       
"KRN",8989.51,415,20,3,0)
 
"KRN",8989.51,415,20,4,0)
This parameter contains the width of each column viewed via the Bar Code 
"KRN",8989.51,415,20,5,0)
Medication Administration Coversheet's "third view" delimited by the
"KRN",8989.51,415,20,6,0)
slash (/).  Each "/"-piece of data is per respective column on the 
"KRN",8989.51,415,20,7,0)
Coversheet's "third view", numbered from left to right.  An example 
"KRN",8989.51,415,20,8,0)
parameter setting is:
"KRN",8989.51,415,20,9,0)
 
"KRN",8989.51,415,20,10,0)
      170/20/100/30/11/22/31/44/50
"KRN",8989.51,415,20,11,0)
 
"KRN",8989.51,415,20,12,0)
Setting numbers are in units of centimeters. 
"KRN",8989.51,415,20,13,0)
 
"KRN",8989.51,415,20,14,0)
 
"KRN",8989.51,415,20,15,0)
 THESE NUMBERS MUST BE WHOLE NUMBERS.
"KRN",8989.51,415,30,0)
^8989.513I^1^1
"KRN",8989.51,415,30,1,0)
1^200
"KRN",8989.51,416,-1)
0^6
"KRN",8989.51,416,0)
PSB COVERSHEET V4 COL WIDTHS^Widths of each View 4 col. ^0^^#/#/#/#/#/#/#/#/# ^0
"KRN",8989.51,416,1)
F^^Enter the widths for each Coversheet View 4 col delimited with "/" 
"KRN",8989.51,416,4,0)
^8989.514^7^7
"KRN",8989.51,416,4,1,0)
Coversheet
"KRN",8989.51,416,4,2,0)
overview
"KRN",8989.51,416,4,3,0)
column
"KRN",8989.51,416,4,4,0)
width
"KRN",8989.51,416,4,5,0)
settings
"KRN",8989.51,416,4,6,0)
user setting
"KRN",8989.51,416,4,7,0)
BCMA
"KRN",8989.51,416,4,"B","BCMA",7)
 
"KRN",8989.51,416,4,"B","Coversheet",1)
 
"KRN",8989.51,416,4,"B","column",3)
 
"KRN",8989.51,416,4,"B","overview",2)
 
"KRN",8989.51,416,4,"B","settings",5)
 
"KRN",8989.51,416,4,"B","user setting",6)
 
"KRN",8989.51,416,4,"B","width",4)
 
"KRN",8989.51,416,6)
F^^: Enter the widths for each Coversheet View 4 delimited with "/" 
"KRN",8989.51,416,20,0)
^^16^16^3051222^
"KRN",8989.51,416,20,1,0)
USER specific setting for the BCMA Coversheet's "forth view".
"KRN",8989.51,416,20,2,0)
                                                                 
"KRN",8989.51,416,20,3,0)
       
"KRN",8989.51,416,20,4,0)
 
"KRN",8989.51,416,20,5,0)
This parameter contains the width of each column viewed via the Bar Code 
"KRN",8989.51,416,20,6,0)
Medication Administration Coversheet's "forth view" delimited by 
"KRN",8989.51,416,20,7,0)
the slash (/).  Each "/"-piece of data is per respective column on the 
"KRN",8989.51,416,20,8,0)
Coversheet's "forth view", numbered from left to right.  An example 
"KRN",8989.51,416,20,9,0)
parameter setting is:
"KRN",8989.51,416,20,10,0)
 
"KRN",8989.51,416,20,11,0)
      170/20/100/30/11/22/31/44/50
"KRN",8989.51,416,20,12,0)
 
"KRN",8989.51,416,20,13,0)
Setting numbers are in units of centimeters. 
"KRN",8989.51,416,20,14,0)
 
"KRN",8989.51,416,20,15,0)
 
"KRN",8989.51,416,20,16,0)
 THESE NUMBERS MUST BE WHOLE NUMBERS.
"KRN",8989.51,416,30,0)
^8989.513I^1^1
"KRN",8989.51,416,30,1,0)
1^200
"KRN",8989.51,417,-1)
0^7
"KRN",8989.51,417,0)
PSB MG ADMIN ERROR^Status Error Notification Mail Group^0^^ADMIN ERRORS MAIL GROUP^0
"KRN",8989.51,417,1)
P^3.8^Enter Mail Group to get error messages. 
"KRN",8989.51,417,4,0)
^8989.514^5^5
"KRN",8989.51,417,4,1,0)
BCMA
"KRN",8989.51,417,4,2,0)
PSB
"KRN",8989.51,417,4,3,0)
Mail Group
"KRN",8989.51,417,4,4,0)
BCMA administration
"KRN",8989.51,417,4,5,0)
errors
"KRN",8989.51,417,4,"B","BCMA",1)
 
"KRN",8989.51,417,4,"B","BCMA administration",4)
 
"KRN",8989.51,417,4,"B","Mail Group",3)
 
"KRN",8989.51,417,4,"B","PSB",2)
 
"KRN",8989.51,417,4,"B","errors",5)
 
"KRN",8989.51,417,20,0)
^8989.512^3^3^3060123^^^^
"KRN",8989.51,417,20,1,0)
This parameter is the name of the mail group containing persons to get 
"KRN",8989.51,417,20,2,0)
electronic mail messages, when a BCMA administration is filed with a 
"KRN",8989.51,417,20,3,0)
"null" value in the Action Status field (#.09).
"KRN",8989.51,417,30,0)
^8989.513I^3^1
"KRN",8989.51,417,30,3,0)
1^4
"KRN",8994,677,-1)
0^4
"KRN",8994,677,0)
PSB SCANPT^SCANPT^PSBRPC^2^P^^^^3
"KRN",8994,677,1,0)
^8994.01^8^8^3041013^^^^
"KRN",8994,677,1,1,0)
This RPC is used to validate the data scanned in at the scan patient 
"KRN",8994,677,1,2,0)
wristband prompt of the mnOpenPatient component.  The value passed in 
"KRN",8994,677,1,3,0)
is either the full SSN scanned in from the patient wristband -or- the 
"KRN",8994,677,1,4,0)
1U4N syntax of the patient lookup.  In either case the call must 
"KRN",8994,677,1,5,0)
return only one patient from the lookup.  If the 1U4N syntax is used 
"KRN",8994,677,1,6,0)
and multiple patients are found the call returns an error.  If only 
"KRN",8994,677,1,7,0)
one patient is found the RESULTS( ) array is loaded with the patient 
"KRN",8994,677,1,8,0)
data and passed back to the client for verification.
"KRN",8994,677,2,0)
^8994.02A^1^1
"KRN",8994,677,2,1,0)
PSBDATA^1^^1^1
"KRN",8994,677,2,1,1,0)
^8994.021^1^1^3041013^^^^
"KRN",8994,677,2,1,1,1,0)
This is the scanned valued passed by the client.
"KRN",8994,677,2,1,1,2,0)
wristband prompt of the mnOpenPatient component.  The value passed in
"KRN",8994,677,2,1,1,3,0)
is either the full SSN scanned in from the patient wristband -or- the
"KRN",8994,677,2,1,1,4,0)
1U4N syntax of the patient lookup.  In either case the call must
"KRN",8994,677,2,1,1,5,0)
return only one patient from the lookup.  If the 1U4N syntax is used
"KRN",8994,677,2,1,1,6,0)
and multiple patients are found the call returns an error.  If only
"KRN",8994,677,2,1,1,7,0)
one patient is found the RESULTS( ) array is loaded with the patient
"KRN",8994,677,2,1,1,8,0)
data and passed back to the client for verification.
"KRN",8994,677,2,"B","PSBDATA",1)
 
"KRN",8994,677,2,"B","PSBSSN",1)
 
"KRN",8994,677,2,"PARAMSEQ",1,1)
 
"KRN",8994,677,3,0)
^8994.03^48^48^3060303^^
"KRN",8994,677,3,1,0)
If no patient or multiple patients are found with the scan value an 
"KRN",8994,677,3,2,0)
error is returned in the following format:
"KRN",8994,677,3,3,0)
 
"KRN",8994,677,3,4,0)
   Results[0] = 1
"KRN",8994,677,3,5,0)
   Results[1] = '-1^Unable to Determine Patient ID'
"KRN",8994,677,3,6,0)
 
"KRN",8994,677,3,7,0)
If a unique patient is found the following data is returned to the 
"KRN",8994,677,3,8,0)
user:
"KRN",8994,677,3,9,0)
 
"KRN",8994,677,3,10,0)
   Results[0]  = Count of returned records
"KRN",8994,677,3,11,0)
 
"KRN",8994,677,3,12,0)
In the case of an error:
"KRN",8994,677,3,13,0)
    Results[1]  = '-1^  "the appropriate error message"  '
"KRN",8994,677,3,14,0)
 
"KRN",8994,677,3,15,0)
    Results[1]  = DFN
"KRN",8994,677,3,16,0)
    Results[2]  = Name
"KRN",8994,677,3,17,0)
    Results[3]  = SSN^Dashed SSN
"KRN",8994,677,3,18,0)
    Results[4]  = Internal DOB^External DOB
"KRN",8994,677,3,19,0)
    Results[5]  = Age
"KRN",8994,677,3,20,0)
    Results[6]  = Internal Sex^External Sex
"KRN",8994,677,3,21,0)
    Results[7]  = Internal Last Mvmt^External Last Mvmt
"KRN",8994,677,3,22,0)
    Results[8]  = Internal Type Mvmt^External Type Mvmt
"KRN",8994,677,3,23,0)
    Results[9]  = Internal Ward Location^External Ward Location^
"KRN",8994,677,3,24,0)
                    Internal Hospital Location^External Hospital Location
"KRN",8994,677,3,25,0)
    Results[10] = Internal Bed Location^External Bed Location
"KRN",8994,677,3,26,0)
    Results[11] = Internal P-Care Physician^External P-Care Physician
"KRN",8994,677,3,27,0)
    Results[12] = Internal Treating Speciality^External Treating Speciality
"KRN",8994,677,3,28,0)
    Results[13] = Movement Diagnosis
"KRN",8994,677,3,29,0)
    Results[14] = 1 if in Bed Status 0 if not in Bed Status (i.e. Pass)
"KRN",8994,677,3,30,0)
    Results[15] = Expected return date from Pass
"KRN",8994,677,3,31,0)
    Results[16] = Reactions
"KRN",8994,677,3,32,0)
    Results[17] = Height
"KRN",8994,677,3,33,0)
    Results[18] = Weight
"KRN",8994,677,3,34,0)
    Results[19] = Means Tests
"KRN",8994,677,3,35,0)
    Results[20] = ICN umber
"KRN",8994,677,3,36,0)
    Results[21] = " Admission Status message "
"KRN",8994,677,3,37,0)
    Results[22] = This NODE begins 'other' patient information.
"KRN",8994,677,3,38,0)
                  This NODE may be null.  Records on this NODE will
"KRN",8994,677,3,39,0)
                  have a header.  A header will consist of one of the 
"KRN",8994,677,3,40,0)
                  following:
"KRN",8994,677,3,41,0)
                 
"KRN",8994,677,3,42,0)
 
"KRN",8994,677,3,43,0)
                       "PATFLG"
"KRN",8994,677,3,44,0)
 
"KRN",8994,677,3,45,0)
                              The PATFLG header will initiate a patient 
"KRN",8994,677,3,46,0)
                              flag record.  The patient flag record will 
"KRN",8994,677,3,47,0)
                              be constructed as follows: 
"KRN",8994,677,3,48,0)
                                        "PATFLG" ^ FLAG NAME ^ index#
"KRN",8994,680,-1)
0^1
"KRN",8994,680,0)
PSB USERLOAD^USRLOAD^PSBRPC^2^P^^^^3
"KRN",8994,680,1,0)
^8994.01^3^3^3060202^^
"KRN",8994,680,1,1,0)
This RPC is called at application startup to populate the BCMA_User 
"KRN",8994,680,1,2,0)
object with the users defaults.  No paramters are passed, the current 
"KRN",8994,680,1,3,0)
DUZ is assumed.
"KRN",8994,680,3,0)
^^36^36^3060202^
"KRN",8994,680,3,1,0)
(0) = -1^Error Description
"KRN",8994,680,3,2,0)
 
"KRN",8994,680,3,3,0)
or
"KRN",8994,680,3,4,0)
 
"KRN",8994,680,3,5,0)
(0) = DUZ
"KRN",8994,680,3,6,0)
(1) = User name
"KRN",8994,680,3,7,0)
(2) = Student Key Flag
"KRN",8994,680,3,8,0)
(3) = Manager Key flag
"KRN",8994,680,3,9,0)
(4) = CPRS Med Order Button Key Flag     
"KRN",8994,680,3,10,0)
(5) = Window settings
"KRN",8994,680,3,11,0)
      Window Left
"KRN",8994,680,3,12,0)
      Window Height
"KRN",8994,680,3,13,0)
      Window Top
"KRN",8994,680,3,14,0)
      Window Width
"KRN",8994,680,3,15,0)
(6) = Virtual Due List Setup
"KRN",8994,680,3,16,0)
(7) = Division number ^ Site ID ^ (if production system "1", if test system "0")
"KRN",8994,680,3,17,0)
(8) = Division name
"KRN",8994,680,3,18,0)
(9) = ESIG flag 
"KRN",8994,680,3,19,0)
(10) = BCMA Online flag
"KRN",8994,680,3,20,0)
(11) = Time      
"KRN",8994,680,3,21,0)
(12) = Unit Dose column widths
"KRN",8994,680,3,22,0)
(13) = Check digit
"KRN",8994,680,3,23,0)
(14) = IVPB column widths
"KRN",8994,680,3,24,0)
(15) = IV column widths
"KRN",8994,680,3,25,0)
(16) = Printer user default IEN
"KRN",8994,680,3,26,0)
(17) = Printer user default IEN^Name
"KRN",8994,680,3,27,0)
(18) = Read Only Security Key flag
"KRN",8994,680,3,28,0)
(19) = User's preference per Coversheet Views' column sort
"KRN",8994,680,3,29,0)
      Medication Overview sort col #
"KRN",8994,680,3,30,0)
      PRN Overview sort col #
"KRN",8994,680,3,31,0)
      IV Overview sort col #
"KRN",8994,680,3,32,0)
      Expired/Expiring sort col #
"KRN",8994,680,3,33,0)
(20) = User's preference per Coversheet View1 columns' widths
"KRN",8994,680,3,34,0)
(21) = User's preference per Coversheet View2 columns' widths
"KRN",8994,680,3,35,0)
(22) = User's preference per Coversheet View3 columns' widths
"KRN",8994,680,3,36,0)
(23) = User's preference per Coversheet View4 columns' widths
"KRN",8994,681,-1)
0^2
"KRN",8994,681,0)
PSB USERSAVE^USRSAVE^PSBRPC^2^^^^^2
"KRN",8994,681,1,0)
^8994.01^1^1^3010910^^^
"KRN",8994,681,1,1,0)
Save the users current window settings for the next session.
"KRN",8994,681,2,0)
^8994.02A^6^6
"KRN",8994,681,2,1,0)
PSBWIN^1^30^1^1
"KRN",8994,681,2,1,1,0)
^8994.021^6^6^3010910^^^^
"KRN",8994,681,2,1,1,1,0)
Contains the current window settings so that the next time the user 
"KRN",8994,681,2,1,1,2,0)
activates the application the window will reappear in the same format.
"KRN",8994,681,2,1,1,3,0)
 
"KRN",8994,681,2,1,1,4,0)
Data is in the following format:
"KRN",8994,681,2,1,1,5,0)
 
"KRN",8994,681,2,1,1,6,0)
   Window Top;Window Left;Window Height;Window Width;Window State
"KRN",8994,681,2,2,0)
PSBVDL^1^^1^2
"KRN",8994,681,2,2,1,0)
^^1^1^3010910^
"KRN",8994,681,2,2,1,1,0)
VDL settings
"KRN",8994,681,2,3,0)
PSBUDCW ^1^^1^3
"KRN",8994,681,2,3,1,0)
^^1^1^3010910^
"KRN",8994,681,2,3,1,1,0)
UD tab column settings
"KRN",8994,681,2,4,0)
PSBPBCW^1^^1^4
"KRN",8994,681,2,4,1,0)
^^1^1^3010910^
"KRN",8994,681,2,4,1,1,0)
PB tab column settings 
"KRN",8994,681,2,5,0)
PSBIVCW^1^^1^5
"KRN",8994,681,2,5,1,0)
^^1^1^3010910^
"KRN",8994,681,2,5,1,1,0)
IV tab column settings   
"KRN",8994,681,2,6,0)
PSBDEV^1^^1^6
"KRN",8994,681,2,6,1,0)
^^1^1^3010910^
"KRN",8994,681,2,6,1,1,0)
Last print device used.
"KRN",8994,681,2,"B","PSBDEV",6)
 
"KRN",8994,681,2,"B","PSBIVCW",5)
 
"KRN",8994,681,2,"B","PSBPBCW",4)
 
"KRN",8994,681,2,"B","PSBUDCW ",3)
 
"KRN",8994,681,2,"B","PSBVDL",2)
 
"KRN",8994,681,2,"B","PSBWIN",1)
 
"KRN",8994,681,2,"PARAMSEQ",1,1)
 
"KRN",8994,681,2,"PARAMSEQ",2,2)
 
"KRN",8994,681,2,"PARAMSEQ",3,3)
 
"KRN",8994,681,2,"PARAMSEQ",4,4)
 
"KRN",8994,681,2,"PARAMSEQ",5,5)
 
"KRN",8994,681,2,"PARAMSEQ",6,6)
 
"KRN",8994,681,3,0)
^8994.03^4^4^3010910^^^
"KRN",8994,681,3,1,0)
Returns
"KRN",8994,681,3,2,0)
 
"KRN",8994,681,3,3,0)
  Results[0]='1^Saved'
"KRN",8994,681,3,4,0)
  Results[0]='-1^Unable to save settings' if an error occurs in filing.
"KRN",8994,1966,-1)
0^3
"KRN",8994,1966,0)
PSB UTL XSTATUS SRCH^FNDACTV^PSBVDLU3^2^R^0^^^3
"KRN",8994,1966,1,0)
^^5^5^3060113^
"KRN",8994,1966,1,1,0)
RESULTS(0)=returned line count
"KRN",8994,1966,1,2,0)
RESULTS(1)=patients location during activity
"KRN",8994,1966,1,3,0)
RESULTS(2)=medication^ordernumber
"KRN",8994,1966,1,4,0)
RESULTS(3)= action fileman date&time
"KRN",8994,1966,1,5,0)
RESULTS(4)= scheduled administration fileman date&time
"KRN",8994,1966,2,0)
^8994.02A^2^2
"KRN",8994,1966,2,1,0)
RESULTS^4^^1^1
"KRN",8994,1966,2,1,1,0)
^^1^1^3060113^
"KRN",8994,1966,2,1,1,1,0)
RESULTS array (ref)
"KRN",8994,1966,2,2,0)
PARAMS^1^^1^2
"KRN",8994,1966,2,2,1,0)
^^19^19^3060113^
"KRN",8994,1966,2,2,1,1,0)
^ piece
"KRN",8994,1966,2,2,1,2,0)
#1 - DFN (required)
"KRN",8994,1966,2,2,1,3,0)
#2 - OrderNumber
"KRN",8994,1966,2,2,1,4,0)
#3 - Action (status) to search for
"KRN",8994,1966,2,2,1,5,0)
#4 - TimeFrame
"KRN",8994,1966,2,2,1,6,0)
                          NOTE:  ="FREQ"  This  Function will use order's 
"KRN",8994,1966,2,2,1,7,0)
                                   frequency.
"KRN",8994,1966,2,2,1,8,0)
        ;                    1. If the order is a PRN, On Call or One-Time
"KRN",8994,1966,2,2,1,9,0)
        ;                       the look back a default of 72 hours.
"KRN",8994,1966,2,2,1,10,0)
        ;                    2. if the order is a Continuous order key 
"KRN",8994,1966,2,2,1,11,0)
                                off of the frequency as follows.
"KRN",8994,1966,2,2,1,12,0)
        ;                          a.) if the frequency is <24 hours 
"KRN",8994,1966,2,2,1,13,0)
                                      use the default of 72 hours.
"KRN",8994,1966,2,2,1,14,0)
        ;                          b.) if the frequency is >= 24 hour, 
"KRN",8994,1966,2,2,1,15,0)
                                      look back 3.5 times the frequency
"KRN",8994,1966,2,2,1,16,0)
        ;                 NOTE:  ["X#"   This Function will search back # 
"KRN",8994,1966,2,2,1,17,0)
                                    of admins.
"KRN",8994,1966,2,2,1,18,0)
 
"KRN",8994,1966,2,2,1,19,0)
        ;  Example call: D FNDACTV^PSBVDLU3(.results,"1234^1U^H^12")
"KRN",8994,1966,2,"B","PARAMS",2)
 
"KRN",8994,1966,2,"B","RESULTS",1)
 
"KRN",8994,1966,2,"PARAMSEQ",1,1)
 
"KRN",8994,1966,2,"PARAMSEQ",2,2)
 
"MBREQ")
0
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",536,-1)
1^1
"PKG",536,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",536,20,0)
^9.402P^^0
"PKG",536,22,0)
^9.49I^1^1
"PKG",536,22,1,0)
3.0^3040224^3040318^11874
"PKG",536,22,1,"PAH",1,0)
13^3060322^10000000035
"PKG",536,22,1,"PAH",1,1,0)
^^117^117^3060322
"PKG",536,22,1,"PAH",1,1,1,0)
 
"PKG",536,22,1,"PAH",1,1,2,0)
***
"PKG",536,22,1,"PAH",1,1,3,0)
 
"PKG",536,22,1,"PAH",1,1,4,0)
This patch is a component of the Bar Code Medication Administration 
"PKG",536,22,1,"PAH",1,1,5,0)
(BCMA) Version 3.0.  The main function of PSB*3.0*13 and the 
"PKG",536,22,1,"PAH",1,1,6,0)
corresponding BCMA Graphical User Interface (GUI) software (BCMA Version 3
"PKG",536,22,1,"PAH",1,1,7,0)
Patch 13 [3.0.13]) is to support BCMA v3.0 Clinical Context Object 
"PKG",536,22,1,"PAH",1,1,8,0)
Workgroup (CCOW) compliance. The PSB*3.0*13 GUI and this Character User 
"PKG",536,22,1,"PAH",1,1,9,0)
Interface (CHUI) software (PSB*3.0*13) also support Patient Safety 
"PKG",536,22,1,"PAH",1,1,10,0)
Issues (PSI) and Remedy Ticket resolution and BCMA Coversheet refinement.
"PKG",536,22,1,"PAH",1,1,11,0)
***
"PKG",536,22,1,"PAH",1,1,12,0)
 
"PKG",536,22,1,"PAH",1,1,13,0)
1.   Problem: PSI-05-064
"PKG",536,22,1,"PAH",1,1,14,0)
     BCMA functionality enables a BCMA user to edit the free text 
"PKG",536,22,1,"PAH",1,1,15,0)
     BCMA MEDICATION LOG FILE-DISPENSE DRUG SUBFILE (# 53.795) "Units
"PKG",536,22,1,"PAH",1,1,16,0)
     of Administration" (field #.04) for an administered medication, when 
"PKG",536,22,1,"PAH",1,1,17,0)
     using the Edit Medication Log.  Consequently, the GUI Edit 
"PKG",536,22,1,"PAH",1,1,18,0)
     Medication Log (Edit Med Log) allows a BCMA user to modify text in 
"PKG",536,22,1,"PAH",1,1,19,0)
     the field labeled "Units" of the "BCMA - Edit Med Log" dialog box.  
"PKG",536,22,1,"PAH",1,1,20,0)
     The user is able to change the "Units" from "PATCH" to any other text
"PKG",536,22,1,"PAH",1,1,21,0)
     value.  Changing a "PATCH" medication to some other "Units", causes 
"PKG",536,22,1,"PAH",1,1,22,0)
     BCMA to not process the administration properly; and causes the BCMA 
"PKG",536,22,1,"PAH",1,1,23,0)
     Virtual Due List (VDL) to not present the administration properly.
"PKG",536,22,1,"PAH",1,1,24,0)
 
"PKG",536,22,1,"PAH",1,1,25,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,26,0)
     The BCMA GUI Edit Med Log will not allow any BCMA user to edit the 
"PKG",536,22,1,"PAH",1,1,27,0)
     BCMA MEDICATION LOG FILE/DISPENSE DRUG SUBFILE (# 53.795) "Units 
"PKG",536,22,1,"PAH",1,1,28,0)
     of Administration" (field # .04) of an administered "PATCH" 
"PKG",536,22,1,"PAH",1,1,29,0)
     medication.
"PKG",536,22,1,"PAH",1,1,30,0)
 
"PKG",536,22,1,"PAH",1,1,31,0)
2.   Problem: PSI-05-032
"PKG",536,22,1,"PAH",1,1,32,0)
     The VDL displays a GIVEN medication patch until it has been marked as
"PKG",536,22,1,"PAH",1,1,33,0)
     "REMOVED".  This is causing some confusion to users.
"PKG",536,22,1,"PAH",1,1,34,0)
 
"PKG",536,22,1,"PAH",1,1,35,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,36,0)
     BCMA will provide a site parameter that will specify the number of 
"PKG",536,22,1,"PAH",1,1,37,0)
     days (7-14) a GIVEN patch will display on the VDL.  The count of 
"PKG",536,22,1,"PAH",1,1,38,0)
     days the GIVEN patch displays on the VDL begins when the 
"PKG",536,22,1,"PAH",1,1,39,0)
     medication order expires.  This parameter may be set to ""
"PKG",536,22,1,"PAH",1,1,40,0)
     (null) to allow GIVEN patches to display on the VDL until it is 
"PKG",536,22,1,"PAH",1,1,41,0)
     marked as REMOVED.
"PKG",536,22,1,"PAH",1,1,42,0)
 
"PKG",536,22,1,"PAH",1,1,43,0)
 
"PKG",536,22,1,"PAH",1,1,44,0)
3.   Problem: PSI-05-115
"PKG",536,22,1,"PAH",1,1,45,0)
     The Special Instructions on the VDL will display the entire Special 
"PKG",536,22,1,"PAH",1,1,46,0)
     Instructions by wrapping the text as needed using the spaces in the 
"PKG",536,22,1,"PAH",1,1,47,0)
     Special Instructions. However, ff a word or phrase (without spaces) 
"PKG",536,22,1,"PAH",1,1,48,0)
     in the Special Instructions can not be wrapped due to the word or 
"PKG",536,22,1,"PAH",1,1,49,0)
     phrase being longer then the width of the column, the text would be 
"PKG",536,22,1,"PAH",1,1,50,0)
     truncated when the text ran into the right side of the column. In 
"PKG",536,22,1,"PAH",1,1,51,0)
     addition, when the above happens, some of the ending words in the 
"PKG",536,22,1,"PAH",1,1,52,0)
     special instructions may be omitted as well.
"PKG",536,22,1,"PAH",1,1,53,0)
 
"PKG",536,22,1,"PAH",1,1,54,0)
     Correction Action:
"PKG",536,22,1,"PAH",1,1,55,0)
     When a word or phrase (without spaces) can not be wrapped and does 
"PKG",536,22,1,"PAH",1,1,56,0)
     not fit in the column width, the text will be truncated with an 
"PKG",536,22,1,"PAH",1,1,57,0)
     ellipsis to indicate that a portion of the word or phrase was 
"PKG",536,22,1,"PAH",1,1,58,0)
     truncated. The occasional omission of ending words in the special 
"PKG",536,22,1,"PAH",1,1,59,0)
     instructions will be corrected. 
"PKG",536,22,1,"PAH",1,1,60,0)
 
"PKG",536,22,1,"PAH",1,1,61,0)
 
"PKG",536,22,1,"PAH",1,1,62,0)
4.   Problem:  HD0000000121694
"PKG",536,22,1,"PAH",1,1,63,0)
     While a medication patch is being "administered" using Manual 
"PKG",536,22,1,"PAH",1,1,64,0)
     Medication Entry[PSB MED LOG NEW ENTRY], that particular scheduled 
"PKG",536,22,1,"PAH",1,1,65,0)
     administration does not display on the BCMA Virtual Due List (VDL).
"PKG",536,22,1,"PAH",1,1,66,0)
 
"PKG",536,22,1,"PAH",1,1,67,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,68,0)
     Display the saved "action status" of an administration, while it is 
"PKG",536,22,1,"PAH",1,1,69,0)
     being administered using Manual Medication Entry [PSB MED LOG NEW 
"PKG",536,22,1,"PAH",1,1,70,0)
     ENTRY]
"PKG",536,22,1,"PAH",1,1,71,0)
 
"PKG",536,22,1,"PAH",1,1,72,0)
 
"PKG",536,22,1,"PAH",1,1,73,0)
5.   Problem:  HD0000000127625
"PKG",536,22,1,"PAH",1,1,74,0)
     An error occurs when the BCMA coversheet is to display data for one 
"PKG",536,22,1,"PAH",1,1,75,0)
     order only; and that order is an expired, large volume IV.
"PKG",536,22,1,"PAH",1,1,76,0)
 
"PKG",536,22,1,"PAH",1,1,77,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,78,0)
     The BCMA Coversheet will display without error when the only order 
"PKG",536,22,1,"PAH",1,1,79,0)
     information to display on the BCMA coversheet pertains to an expired,
"PKG",536,22,1,"PAH",1,1,80,0)
     large volume IV.
"PKG",536,22,1,"PAH",1,1,81,0)
 
"PKG",536,22,1,"PAH",1,1,82,0)
 
"PKG",536,22,1,"PAH",1,1,83,0)
6.   Problem:  HD0000000132184
"PKG",536,22,1,"PAH",1,1,84,0)
     An error occurs when the BCMA GUI Computerized Patient Record System 
"PKG",536,22,1,"PAH",1,1,85,0)
     (CPRS)/BCMA Medication Order Button (MOB) is used and ORDER 
"PKG",536,22,1,"PAH",1,1,86,0)
     File (#100) PATIENT LOCATION (field #6) data does not link to a 
"PKG",536,22,1,"PAH",1,1,87,0)
     WARD LOCATION File (#42) entry.
"PKG",536,22,1,"PAH",1,1,88,0)
 
"PKG",536,22,1,"PAH",1,1,89,0)
     Corrective Action:
"PKG",536,22,1,"PAH",1,1,90,0)
     BCMA will provide HOSPITAL LOCATION File (#44) data per ORDER File 
"PKG",536,22,1,"PAH",1,1,91,0)
     (#100) PATIENT LOCATION (field #6) data when the CPRS/BCMA MOB is 
"PKG",536,22,1,"PAH",1,1,92,0)
     used.  CPRS will ORDER File (#100) PATIENT LOCATION (field #6) data 
"PKG",536,22,1,"PAH",1,1,93,0)
     to a HOSPITAL LOCATION File (#44) entry 
"PKG",536,22,1,"PAH",1,1,94,0)
 
"PKG",536,22,1,"PAH",1,1,95,0)
 
"PKG",536,22,1,"PAH",1,1,96,0)
7.   Enhancement:  CCOW compliancy
"PKG",536,22,1,"PAH",1,1,97,0)
     This patch (PSB*3.0*13) will enable BCMA CCOW compliancy.
"PKG",536,22,1,"PAH",1,1,98,0)
 
"PKG",536,22,1,"PAH",1,1,99,0)
 
"PKG",536,22,1,"PAH",1,1,100,0)
8.   Enhancement:  Enhanced "*UNKNOWN* Action Status" support.
"PKG",536,22,1,"PAH",1,1,101,0)
     BCMA Medication Log File (File #53.79) entries having unknown 
"PKG",536,22,1,"PAH",1,1,102,0)
     Action Status (field #.09) data can be maintained via the GUI BCMA 
"PKG",536,22,1,"PAH",1,1,103,0)
     Edit Med Log only. These entries may be maintained by persons holding
"PKG",536,22,1,"PAH",1,1,104,0)
     the BCMA manager's key [PSB MANAGER] or that user unable to complete 
"PKG",536,22,1,"PAH",1,1,105,0)
     the original administration.  PSB*3.0*13 supports the VISTA "Unknown 
"PKG",536,22,1,"PAH",1,1,106,0)
     Action Status Report" option [PSBO XA].  The [PSBO XA] option 
"PKG",536,22,1,"PAH",1,1,107,0)
     provides persons holding the BCMA manager's key [PSB MANAGER] 
"PKG",536,22,1,"PAH",1,1,108,0)
     resource to generate a report to display BCMA Medication Log File 
"PKG",536,22,1,"PAH",1,1,109,0)
     (#53.79) entries having "unknown" Action Status (field #.09) data.  
"PKG",536,22,1,"PAH",1,1,110,0)
     Users holding the BCMA manager's key [PSB MANAGER] can access the 
"PKG",536,22,1,"PAH",1,1,111,0)
     PSBO XA report via the BCMA GUI as well.  BCMA has been enhanced to 
"PKG",536,22,1,"PAH",1,1,112,0)
     display a "pop-up box" when a user begins an action on an order 
"PKG",536,22,1,"PAH",1,1,113,0)
 
"PKG",536,22,1,"PAH",1,1,114,0)
 
"PKG",536,22,1,"PAH",1,1,115,0)
9.   Enhancement:  Saved Coversheet Personal Parameters
"PKG",536,22,1,"PAH",1,1,116,0)
     PSB*3.0*13 will maintain personal parameters per BCMA Coversheet 
"PKG",536,22,1,"PAH",1,1,117,0)
     views to be saved and retrieved when using BCMA. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
24
"RTN","PSBCSUTL")
0^22^B82253654^B74276312
"RTN","PSBCSUTL",1,0)
PSBCSUTL ;BIRMINGHAM/TEJ- BCMA-HSC COVER SHEET UTILITIES ;Mar 2004
"RTN","PSBCSUTL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**16,13**;Mar 2004
"RTN","PSBCSUTL",3,0)
 ;
"RTN","PSBCSUTL",4,0)
 ; Reference/IA
"RTN","PSBCSUTL",5,0)
 ;
"RTN","PSBCSUTL",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBCSUTL",7,0)
 ; IN5^VADPT/10061
"RTN","PSBCSUTL",8,0)
 ; $$GET^XPAR/2263
"RTN","PSBCSUTL",9,0)
 ; ^%DTC/10000
"RTN","PSBCSUTL",10,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBCSUTL",11,0)
 ; $$GET1^DIQ/2056
"RTN","PSBCSUTL",12,0)
 ;
"RTN","PSBCSUTL",13,0)
RPC(RESULTS,DFN) ;
"RTN","PSBCSUTL",14,0)
 K RESULTS,^TMP("PSB",$J),^TMP("PSJ",$J)
"RTN","PSBCSUTL",15,0)
 S PSBTAB="CVRSHT"
"RTN","PSBCSUTL",16,0)
 N PSBCNT S PSBTRFL=0,PSBDFNX=DFN
"RTN","PSBCSUTL",17,0)
 S RESULTS=$NAME(^TMP("PSB",$J,PSBTAB))
"RTN","PSBCSUTL",18,0)
 K ^TMP("PSB",$J,PSBTAB) S ^TMP("PSB",$J,PSBTAB,0)=1 D LIGHTS(PSBDFNX)
"RTN","PSBCSUTL",19,0)
 S ^TMP("PSB",$J,PSBTAB,0)=1,^TMP("PSB",$J,PSBTAB,1)=^TMP("PSB",$J,PSBTAB,1)
"RTN","PSBCSUTL",20,0)
 Q:$P(^TMP("PSB",$J,PSBTAB,1),U,4)=-1
"RTN","PSBCSUTL",21,0)
 D NOW^%DTC S PSBNOW=+$E(%,1,10),PSBDT=$P(%,".",1)
"RTN","PSBCSUTL",22,0)
 ;set range
"RTN","PSBCSUTL",23,0)
 S PSBWBEG=$$FMADD^XLFDT(PSBNOW,"",-24),PSBWEND=$$FMADD^XLFDT(PSBNOW,"",24)
"RTN","PSBCSUTL",24,0)
 S PSBTBEG=$$FMADD^XLFDT(PSBNOW,"",-12),PSBTEND=$$FMADD^XLFDT(PSBNOW,"",12)
"RTN","PSBCSUTL",25,0)
 S PSBWADM=$$GET^XPAR("DIV","PSB ADMIN BEFORE"),PSBMHBCK=$$GET^XPAR("ALL","PSB MED HIST DAYS BACK",,"B") I +PSBMHBCK=0 S PSBMHBCK=30
"RTN","PSBCSUTL",26,0)
 D NOW^%DTC S PSBWADM=$$FMADD^XLFDT(%,"","",+PSBWADM),PSBMHBCK=$$FMADD^XLFDT(%,-1*(PSBMHBCK))
"RTN","PSBCSUTL",27,0)
 ;use lst movemnt for API
"RTN","PSBCSUTL",28,0)
 S VAIP("D")="LAST" D IN5^VADPT S PSBTRDT=+VAIP(3),PSBTRTYP=$P(VAIP(2),U,2),PSBMVTYP=$P(VAIP(4),U,2) K VAIP
"RTN","PSBCSUTL",29,0)
 S PSBPTTR=$$GET^XPAR("DIV","PSB PATIENT TRANSFER") I PSBPTTR="" S PSBPTTR=72
"RTN","PSBCSUTL",30,0)
 D NOW^%DTC S PSBNTDT=$$FMADD^XLFDT(%,"",-PSBPTTR) I PSBNTDT'>PSBTRDT S PSBTRFL=1
"RTN","PSBCSUTL",31,0)
 S X1=$P(PSBNOW,"."),X2=-3 D C^%DTC
"RTN","PSBCSUTL",32,0)
 D EN^PSJBCMA(PSBDFNX,X,PSBMHBCK)
"RTN","PSBCSUTL",33,0)
 ;Devlop Outp
"RTN","PSBCSUTL",34,0)
 S PSBTBOUT=0
"RTN","PSBCSUTL",35,0)
 I ^TMP("PSJ",$J,1,0)>0 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBCSUTL",36,0)
 .S:(PSBTAB'="CVRSHT")&($G(^TMP("PSB",$J,"CVRSHT",2))>0) PSBTBOUT=1
"RTN","PSBCSUTL",37,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX),NOW^%DTC
"RTN","PSBCSUTL",38,0)
 .Q:PSBONX["P"  Q:(PSBOSP<PSBWBEG)&'(PSBONX["V")  ;in rnge?
"RTN","PSBCSUTL",39,0)
 .S (PSBREC,PSBONTAB)=""
"RTN","PSBCSUTL",40,0)
 .S $P(PSBREC,U,1)=PSBDFN ;Dfn
"RTN","PSBCSUTL",41,0)
 .S $P(PSBREC,U,2)=PSBONX ;Ordr 
"RTN","PSBCSUTL",42,0)
 .S $P(PSBREC,U,3)=PSBON ;OrdrIen
"RTN","PSBCSUTL",43,0)
 .S $P(PSBREC,U,4)=PSBOTYP ;iv/ud/pend
"RTN","PSBCSUTL",44,0)
 .S $P(PSBREC,U,5)=PSBSCHT ;Schdtype
"RTN","PSBCSUTL",45,0)
 .S $P(PSBREC,U,6)=PSBSCH ;Schd
"RTN","PSBCSUTL",46,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"") ; selfmed
"RTN","PSBCSUTL",47,0)
 .S $P(PSBREC,U,8)=PSBOITX ;Drgname
"RTN","PSBCSUTL",48,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ;Dose
"RTN","PSBCSUTL",49,0)
 .S $P(PSBREC,U,10)=PSBMR ;Rout
"RTN","PSBCSUTL",50,0)
 .;Lst Gvn - AOIP xRef
"RTN","PSBCSUTL",51,0)
 .S (PSBCNT,PSBFLAG)=0,(Y,PSBSTUS)="" K PSBHSTA,PSBHSTAX
"RTN","PSBCSUTL",52,0)
 .F XZ=1:1:20 S Y=$O(^PSB(53.79,"AOIP",PSBDFN,PSBOIT,Y),-1),(PSBCNT,PSBFLAG)=0 Q:Y=""  D
"RTN","PSBCSUTL",53,0)
 ..S:Y>0 $P(PSBREC,U,11)=Y
"RTN","PSBCSUTL",54,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",PSBDFN,PSBOIT,Y,X),-1) Q:X=""  D
"RTN","PSBCSUTL",55,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9) S:$G(PSBSTUS)="" PSBSTUS="X" I (PSBSTUS'="N") S PSBFLAG=1,PSBHSTA(Y,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBCSUTL",56,0)
 ...D:PSBSTUS="N"
"RTN","PSBCSUTL",57,0)
 ....S ($P(PSBREC,U,11),Z)=""
"RTN","PSBCSUTL",58,0)
 ....F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBCSUTL",59,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",60,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",61,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBCSUTL",62,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBCSUTL",63,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBCSUTL",64,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBCSUTL",65,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBCSUTL",66,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBCSUTL",67,0)
 .S $P(PSBREC,U,12)="" ;ien - below
"RTN","PSBCSUTL",68,0)
 .S $P(PSBREC,U,13)="" ;sttus - below
"RTN","PSBCSUTL",69,0)
 .S $P(PSBREC,U,14)="" ;admn dte - below
"RTN","PSBCSUTL",70,0)
 .S $P(PSBREC,U,15)=PSBOIT ;OI Pointer
"RTN","PSBCSUTL",71,0)
 .S $P(PSBREC,U,16)=0  ;Deflt no-inject
"RTN","PSBCSUTL",72,0)
 .F X="ID","IV","IM","SC","SQ" D  Q:$P(PSBREC,U,16)
"RTN","PSBCSUTL",73,0)
 ..I PSBMR?@(".E1"""_X_""".E"),PSBMR'["MISC" S $P(PSBREC,U,16)=1
"RTN","PSBCSUTL",74,0)
 .;Vari dosg
"RTN","PSBCSUTL",75,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBCSUTL",76,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBCSUTL",77,0)
 .S:PSBDOSEF?1"CAP".E!(PSBDOSEF?1"TAB".E)!(PSBDOSEF="PATCH") $P(PSBREC,U,18)=PSBDOSEF ;DosgFrm
"RTN","PSBCSUTL",78,0)
 .D PSJ1^PSBVT(PSBDFN,PSBONX)
"RTN","PSBCSUTL",79,0)
 .S PSBPB=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,$G(PSBMR)),PSBLVIV=0
"RTN","PSBCSUTL",80,0)
 .Q:PSBPB&(PSBOSP<PSBWBEG)
"RTN","PSBCSUTL",81,0)
 .S:(PSBONX["V"&'PSBPB) PSBLVIV=1
"RTN","PSBCSUTL",82,0)
 .S $P(PSBREC,U,19)=$S(PSBVNI]"":PSBVNI,PSBVNI']"":"***") ;VerfNrsIntls
"RTN","PSBCSUTL",83,0)
 .S $P(PSBREC,U,20)=PSBSTUS S:$P(PSBREC,U,11)="" $P(PSBREC,U,20)=""  ;LstActnSts
"RTN","PSBCSUTL",84,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBCSUTL",85,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBCSUTL",86,0)
 .S $P(PSBREC,U,25)=0 I $G(PSBTRFL),$P(PSBREC,U,11)]"",$P(PSBREC,U,11)'<$G(PSBNTDT),$P(PSBREC,U,11)'>$G(PSBTRDT) S $P(PSBREC,U,25)=1
"RTN","PSBCSUTL",87,0)
 .S $P(PSBREC,U,26)=PSBOSP  ;OrdrStpDt/Tm
"RTN","PSBCSUTL",88,0)
 .S $P(PSBREC,U,27)=$$LASTG($P(PSBREC,U,1),$P(PSBREC,U,15))
"RTN","PSBCSUTL",89,0)
 .S $P(PSBREC,U,28)=$S((PSBONX["U")&('PSBPB):1,PSBPB:2,(PSBONX["V")&'PSBPB:3,1:"")
"RTN","PSBCSUTL",90,0)
 .;get all Admn(s) pr ordr
"RTN","PSBCSUTL",91,0)
 .;DD info.
"RTN","PSBCSUTL",92,0)
 .S (PSBDDS,PSBSOLS,PSBADDS,PSBFLAG)="0"
"RTN","PSBCSUTL",93,0)
 .I PSBLVIV D XFERBAGS^PSBCSUTY,LVIV^PSBCSUTY I $G(PSBEXPRD) S X1=$O(^TMP("PSB",$J,PSBTAB,""),-1) S:^TMP("PSB",$J,PSBTAB,X1)'="END" ^TMP("PSB",$J,PSBTAB,X1+1)="END" Q
"RTN","PSBCSUTL",94,0)
 .D GETADMX^PSBCSUTY
"RTN","PSBCSUTL",95,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBCSUTL",96,0)
 ..I $P(PSBDDA(Y),U,5)=$P(%,".") S PSBFLAG=1  ;drug nactvted
"RTN","PSBCSUTL",97,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<%)  ;nactv
"RTN","PSBCSUTL",98,0)
 ..S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1
"RTN","PSBCSUTL",99,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4),$P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBCSUTL",100,0)
 .;OnCallOneTmPRN
"RTN","PSBCSUTL",101,0)
 .I ("^O^OC^P^"[(U_PSBSCHT_U))!(PSBLVIV) D  S ($P(PSBREC,U,12),$P(PSBREC,U,14))=""  Q
"RTN","PSBCSUTL",102,0)
 ..S (PSBIENX,PSBGOT1)="",PSBADMTM="" F  S PSBADMTM=$O(^PSB(53.79,"AORDX",PSBDFNX,PSBONX,PSBADMTM)) Q:(PSBADMTM="")  D
"RTN","PSBCSUTL",103,0)
 ...Q:(PSBADMTM<PSBMHBCK)&'PSBLVIV
"RTN","PSBCSUTL",104,0)
 ...F  S PSBIENX=$O(^PSB(53.79,"AORDX",PSBDFNX,PSBONX,PSBADMTM,PSBIENX)) Q:PSBIENX=""  D
"RTN","PSBCSUTL",105,0)
 ....S $P(PSBREC,U,12)=PSBIENX,$P(PSBREC,U,14)=PSBADMTM,$P(PSBREC,U,23)=$$GET1^DIQ(53.79,PSBIENX_",","IV UNIQUE ID")
"RTN","PSBCSUTL",106,0)
 ....S PSBQRR=1 D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBADMTM,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",107,0)
 ..I ('+PSBGOT1)&(PSBOSP'<PSBWBEG) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",108,0)
 ..I ('+PSBGOT1)&($D(PSBADMX(PSBONX))) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"CVRSHT")
"RTN","PSBCSUTL",109,0)
 ..S PSBGLBX=$O(^TMP("PSB",$J,PSBTAB,""),-1) S:^TMP("PSB",$J,PSBTAB,PSBGLBX)'="END" ^TMP("PSB",$J,PSBTAB,PSBGLBX+1)="END"
"RTN","PSBCSUTL",110,0)
 .;continu - proces AdmnTm
"RTN","PSBCSUTL",111,0)
 .S (PSBYES,PSBODD,PSBYTF)=0 S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBCSUTL",112,0)
 .I PSBYES,PSBADST="" Q
"RTN","PSBCSUTL",113,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBCSUTL",114,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" Q
"RTN","PSBCSUTL",115,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBCSUTL",116,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBCSUTL",117,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBCSUTL",118,0)
 .S:PSBLVIV PSBYES=1
"RTN","PSBCSUTL",119,0)
 .I 'PSBYES,PSBFREQ<1 Q
"RTN","PSBCSUTL",120,0)
 .I (PSBADST="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1(PSBTAB) Q
"RTN","PSBCSUTL",121,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBCSUTL",122,0)
 .I PSBODD,PSBADST'="" Q
"RTN","PSBCSUTL",123,0)
 .S PSBDTX=PSBWBEG\1,PSBGOT1=0
"RTN","PSBCSUTL",124,0)
 .F PSBXX=1:1:2 D  S PSBDTX=$$FMADD^XLFDT(PSBDTX,"",24)  ;incrmnt 1 day!
"RTN","PSBCSUTL",125,0)
 ..F PSBY=1:1:$L(PSBADST,"-") Q:$P(PSBADST,"-",PSBY)=""  D
"RTN","PSBCSUTL",126,0)
 ...S PSB=+(PSBDTX_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBCSUTL",127,0)
 ...I (PSB'<PSBWBEG)&(PSB'>PSBWEND) D  ;wndow?
"RTN","PSBCSUTL",128,0)
 ....D:(PSB'<PSBOST)&(PSB<PSBOSP)      ;actv?
"RTN","PSBCSUTL",129,0)
 .....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ;dt?
"RTN","PSBCSUTL",130,0)
 ......D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",131,0)
 ...S PSB=+(PSBWEND\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBCSUTL",132,0)
 ...I (PSB'<PSBWBEG)&(PSB'>PSBWEND) D  ;wndow?
"RTN","PSBCSUTL",133,0)
 ....D:(PSB'<PSBOST)&(PSB<PSBOSP)      ;actv?
"RTN","PSBCSUTL",134,0)
 .....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ;dt?
"RTN","PSBCSUTL",135,0)
 ......D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",136,0)
 .I ('PSBGOT1)&(PSBOSP'<PSBWBEG) D ADD^PSBVDLU1(PSBREC,PSBOTXT,+(PSBWEND\1_"."_$P(PSBADST,"-")),PSBDDS,PSBSOLS,PSBADDS,"CVRSHT")
"RTN","PSBCSUTL",137,0)
 .K PSBSTUS
"RTN","PSBCSUTL",138,0)
 D EN^PSBVDLPA
"RTN","PSBCSUTL",139,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))]"" S PSBI1=$O(^TMP("PSB",$J,PSBTAB,""),-1) I ^TMP("PSB",$J,PSBTAB,PSBI1)'="END" S ^TMP("PSB",$J,PSBTAB,PSBI1+1)="END"
"RTN","PSBCSUTL",140,0)
 S ^TMP("PSB",$J,PSBTAB,0)=$O(^TMP("PSB",$J,PSBTAB,""),-1)
"RTN","PSBCSUTL",141,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))']"" S $P(^TMP("PSB",$J,PSBTAB,1),U,4)="-1^No orders To display on Coversheet"
"RTN","PSBCSUTL",142,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))]"" S $P(^TMP("PSB",$J,PSBTAB,1),U,4)="1^COVERSHEET DATA FOLLOWS" D ADD^PSBCSUTX
"RTN","PSBCSUTL",143,0)
 D CLEAN
"RTN","PSBCSUTL",144,0)
 Q
"RTN","PSBCSUTL",145,0)
LASTG(PSBPATPT,PSBOIPT) ;LstGvn-(inpt: DFN,OrdrblItm IEN)
"RTN","PSBCSUTL",146,0)
 K PSBHSTG S Y="",LASTG="" F XZ=1:1:20 S Y=$O(^PSB(53.79,"AOIP",PSBPATPT,PSBOIPT,Y),-1),(PSBCNT,PSBFLAG)=0 Q:Y=""  D
"RTN","PSBCSUTL",147,0)
 .S:Y>0 LASTG="",X="" F  S X=$O(^PSB(53.79,"AOIP",PSBPATPT,PSBOIPT,Y,X),-1) Q:X=""  D
"RTN","PSBCSUTL",148,0)
 ..S PSBSTX=$P(^PSB(53.79,X,0),U,9) S:PSBSTX']"" PSBHSTG(Y)=-1 I PSBSTX="G"  S PSBHSTG(Y)=""
"RTN","PSBCSUTL",149,0)
 ..Q:PSBSTX="N"
"RTN","PSBCSUTL",150,0)
 ..D:(PSBSTX'="G")
"RTN","PSBCSUTL",151,0)
 ...S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBCSUTL",152,0)
 ....I (PSBDATA["Set to 'GIVEN'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",153,0)
 ....I (PSBDATA["STATUS 'GIVEN'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",154,0)
 ....I PSBCNT#2=0,PSBDATA'["'GIVEN'" Q
"RTN","PSBCSUTL",155,0)
 ....I '$D(PSBHSTG($P(PSBDATA,U))) S PSBFLAG=1,PSBHSTG($P(PSBDATA,U))=""
"RTN","PSBCSUTL",156,0)
 S:$D(PSBHSTG) LASTG="",LASTG=$O(PSBHSTG(LASTG),-1) I LASTG]"" I PSBHSTG(LASTG)=-1 S LASTG=""
"RTN","PSBCSUTL",157,0)
 Q LASTG
"RTN","PSBCSUTL",158,0)
LIGHTS(PSBDFN) ;
"RTN","PSBCSUTL",159,0)
 D RPC^PSBVDLTB(,PSBDFN,"NO TAB",) S PSBTAB="CVRSHT"
"RTN","PSBCSUTL",160,0)
 M ^TMP("PSB",$J,PSBTAB,1)=^TMP("PSB",$J,"NO TAB",1) K ^TMP("PSB",$J,"NO TAB")
"RTN","PSBCSUTL",161,0)
 Q
"RTN","PSBCSUTL",162,0)
CLEAN ;
"RTN","PSBCSUTL",163,0)
 D CLEAN^PSBVT
"RTN","PSBCSUTL",164,0)
 K PSBACT,PSBACTBY,PSBACTDT,PSBACTPT,PSBADDS,PSBBAGID,PSBCHDT,PSBCHKV,PSBCNT1,PSBCNT2,PSBDDS,PSBDFNX,PSBWEND
"RTN","PSBCSUTL",165,0)
 K PSBDT,PSBFLAG,PSBHSTAX,PSBI1,PSBIEN,PSBIENX,PSBLSTS,PSBMAUD,PSBMVTYP,PSBMWC,PSBNOW,PSBNTDT,PSBONMBR,PSBY,PSBXX
"RTN","PSBCSUTL",166,0)
 K PSBONXS,PSBORREC,PSBPDT,PSBPRNRE,PSBPTTR,PSBQR,PSBRDOW,PSBREC,PSBRECHD,PSBSCHBR,PSBSCHTM,PSBSOLS,PSBTAB,PSBADMTM,PSBDTX
"RTN","PSBCSUTL",167,0)
 K PSBTBOUT,PSBTRDT,PSBTRFL,PSBTRTYP,PSBUID,PSBUIDS,PSBX,PSBXIEN,PSBX2,PSBYEA,PSBYEA1,PSBYTF,PSBYES,VAIP,PSBWADM,PSBWBEG
"RTN","PSBCSUTL",168,0)
 K PSBXREC,PSBGOT1,PSBCDT,PSBQUIT,PSBUSED,PSBLST4X,PSBADMX,PSBI2,PSBXXX,PSBI,PSBPB,PSBSHWTB,PSBONTAB,PSBDONE,^TMP("PSJ",$J)
"RTN","PSBCSUTL",169,0)
 K PSBNXTDU,LASTG,LSTTIME,PSBMHBCK,PSBHSTG,PSBNXTDT,NEXTADM,PSBLVIV
"RTN","PSBCSUTL",170,0)
 Q
"RTN","PSBCSUTX")
0^23^B78201826^B78601969
"RTN","PSBCSUTX",1,0)
PSBCSUTX ;BIRMINGHAM/TEJ- BCMA-HSC COVER SHEET UTILITIES 2 ;Mar 2004
"RTN","PSBCSUTX",2,0)
 ;;3.0;BAR CODE MED ADMIN;**16,13**;Mar 2004
"RTN","PSBCSUTX",3,0)
 ;
"RTN","PSBCSUTX",4,0)
 ; Reference/IA
"RTN","PSBCSUTX",5,0)
 ; File 200/10060
"RTN","PSBCSUTX",6,0)
 ; $$GET1^DIQ/2056
"RTN","PSBCSUTX",7,0)
 ; $$SCH^XLFDT/10103
"RTN","PSBCSUTX",8,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBCSUTX",9,0)
 ;
"RTN","PSBCSUTX",10,0)
ADD ; output:  ORD-ORC-DD-ADD-SOL-ID-ADM-CMT-END segmnts
"RTN","PSBCSUTX",11,0)
 K PSBDONE S PSBRECHD="ORD",PSBDONE=0,PSBCNT1=^TMP("PSB",$J,PSBTAB,0),PSBCNT2=1,$P(^TMP("PSB",$J,"CVRSHT2",0),U)=0
"RTN","PSBCSUTX",12,0)
 F PSBI1=1:1:PSBCNT1 D  Q:PSBDONE
"RTN","PSBCSUTX",13,0)
 .I PSBCNT1'>1 S PSBDONE=1 Q
"RTN","PSBCSUTX",14,0)
 .I PSBI1=1 S ^TMP("PSB",$J,"CVRSHT2",PSBCNT2)=^TMP("PSB",$J,"CVRSHT",1) Q
"RTN","PSBCSUTX",15,0)
 .I ^TMP("PSB",$J,PSBTAB,PSBI1)="END" S PSBRECHD="ORD",PSBCNT2=PSBCNT2+1,^TMP("PSB",$J,"CVRSHT2",PSBCNT2)="END"  Q
"RTN","PSBCSUTX",16,0)
 .I PSBRECHD="ORD" D ORD Q
"RTN","PSBCSUTX",17,0)
 .I PSBRECHD="ORC" D ORC Q
"RTN","PSBCSUTX",18,0)
 .I PSBRECHD="MED" D MED Q
"RTN","PSBCSUTX",19,0)
 S $P(^TMP("PSB",$J,"CVRSHT2",0),U)=PSBCNT2
"RTN","PSBCSUTX",20,0)
 M ^TMP("PSB",$J,PSBTAB)=^TMP("PSB",$J,"CVRSHT2") K PSBNXTDU D ADM
"RTN","PSBCSUTX",21,0)
 K ^TMP("PSB",$J,PSBTAB) M ^TMP("PSB",$J,PSBTAB)=^TMP("PSB",$J,"CVRSHT2") K ^TMP("PSB",$J,"CVRSHT2") D FINALPAS
"RTN","PSBCSUTX",22,0)
 K ^TMP("PSB",$J,PSBTAB) M ^TMP("PSB",$J,PSBTAB)=^TMP("PSB",$J,"CVRSHT2") K ^TMP("PSB",$J,"CVRSHT2")
"RTN","PSBCSUTX",23,0)
 Q
"RTN","PSBCSUTX",24,0)
ORD ; Ordr
"RTN","PSBCSUTX",25,0)
 S PSBCNT2=PSBCNT2+1,(PSBORREC,PSBXREC)=^TMP("PSB",$J,PSBTAB,PSBI1)
"RTN","PSBCSUTX",26,0)
 S ($P(PSBXREC,U,12),$P(PSBXREC,U,23),$P(PSBXREC,U,24),PSBSCHTM,PSBONMBR,PSBIENX,PSBBAGID,PSBACT,PSBACTBY,PSBACTDT,PSBACTPT,PSBPRNRE,PSBXX,PSBXXX)=""
"RTN","PSBCSUTX",27,0)
 S ^TMP("PSB",$J,"CVRSHT2",PSBCNT2)="ORD",$P(^TMP("PSB",$J,"CVRSHT2",PSBCNT2),U,2)=PSBXREC
"RTN","PSBCSUTX",28,0)
 S PSBSCHTM=$P(PSBORREC,U,14),PSBONMBR=$P(PSBORREC,U,2),PSBIENX=$P(PSBORREC,U,12),PSBLRGIV=0
"RTN","PSBCSUTX",29,0)
 D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBONMBR) S:(PSBONMBR["V")&'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,$G(PSBMR)) PSBLRGIV=1
"RTN","PSBCSUTX",30,0)
 I '$D(PSBLST4X(PSBONMBR)) S PSBXX="" F PSBI=1:1 S PSBXX=$O(PSBADMX(PSBONMBR,PSBXX),-1) Q:PSBXX=""  S PSBXXX="" D  Q:$G(PSBLST4X(PSBONMBR))=4
"RTN","PSBCSUTX",31,0)
 .F  S PSBXXX=$O(PSBADMX(PSBONMBR,PSBXX,PSBXXX)) Q:PSBXXX=""  D  Q:$G(PSBLST4X(PSBONMBR))=4
"RTN","PSBCSUTX",32,0)
 ..I $$GET1^DIQ(53.79,PSBXXX_",","ACTION STATUS","I")'="N"  S PSBLST4X(PSBONMBR,PSBXXX)="",PSBLST4X(PSBONMBR)=$G(PSBLST4X(PSBONMBR))+1
"RTN","PSBCSUTX",33,0)
 I PSBIENX]"",$D(PSBLST4X(PSBONMBR,PSBIENX)) D
"RTN","PSBCSUTX",34,0)
 .S PSBBAGID=$$GET1^DIQ(53.79,PSBIENX_",","IV UNIQUE ID")
"RTN","PSBCSUTX",35,0)
 .S PSBACTDT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION DATE/TIME","I")
"RTN","PSBCSUTX",36,0)
 .S PSBACT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION STATUS","I")
"RTN","PSBCSUTX",37,0)
 .S PSBPRNRE=$$GET1^DIQ(53.79,PSBIENX_",","PRN REASON")
"RTN","PSBCSUTX",38,0)
 .S PSBACTBY=$$GET1^DIQ(53.79,PSBIENX_",","ACTION BY:INITIAL") S:PSBACTBY']"" PSBACTBY="***"
"RTN","PSBCSUTX",39,0)
 .S PSBACTPT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION BY","I")
"RTN","PSBCSUTX",40,0)
 .I '$D(PSBDONE(PSBIENX)) D
"RTN","PSBCSUTX",41,0)
 ..I PSBLRGIV,(PSBFON]"") Q
"RTN","PSBCSUTX",42,0)
 ..S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX)=PSBSCHTM_"^"_PSBBAGID_"^"_PSBIENX_"^"_PSBACT_"^"_PSBACTDT_"^"_PSBACTBY_"^"_PSBACTPT_"^"_PSBPRNRE
"RTN","PSBCSUTX",43,0)
 ..I PSBLRGIV D
"RTN","PSBCSUTX",44,0)
 ...I PSBOSP<PSBNOW S PSBADMS(PSBONMBR,"EXP")=""
"RTN","PSBCSUTX",45,0)
 ...S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX,1)=1
"RTN","PSBCSUTX",46,0)
 ..S PSBDONE(PSBIENX)="" K PSBADMX(PSBONMBR,PSBSCHTM,PSBIENX) D
"RTN","PSBCSUTX",47,0)
 ...S PSBXX="" F  S PSBXX=$O(PSBADMX(PSBONMBR,PSBXX)) Q:PSBXX=""  I $D(PSBADMX(PSBONMBR,PSBXX,PSBIENX)) K PSBADMX(PSBONMBR,PSBXX,PSBIENX)
"RTN","PSBCSUTX",48,0)
 I PSBIENX']"" D
"RTN","PSBCSUTX",49,0)
 .S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX)=PSBSCHTM_"^^^^^^^"
"RTN","PSBCSUTX",50,0)
 .I PSBLRGIV S PSBADMS(PSBONMBR,PSBSCHTM,1)=1
"RTN","PSBCSUTX",51,0)
 I "^O^OC^P^"[(U_PSBSCHT_U)&('$D(PSBADMS(PSBONMBR))) S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX)=PSBSCHTM_"^^^^^^^"
"RTN","PSBCSUTX",52,0)
 S PSBRECHD="ORC" K PSBSCHTM S PSBXREC=""
"RTN","PSBCSUTX",53,0)
 Q
"RTN","PSBCSUTX",54,0)
ORC ; Ordr commnts
"RTN","PSBCSUTX",55,0)
 S PSBCNT2=PSBCNT2+1,^TMP("PSB",$J,"CVRSHT2",PSBCNT2)="ORC",$P(^TMP("PSB",$J,"CVRSHT2",PSBCNT2),U,2)=^TMP("PSB",$J,PSBTAB,PSBI1),PSBRECHD="MED"
"RTN","PSBCSUTX",56,0)
 Q
"RTN","PSBCSUTX",57,0)
MED ; Cnstr DD,ADD,SOL,ID segms
"RTN","PSBCSUTX",58,0)
 S PSBXREC=^TMP("PSB",$J,PSBTAB,PSBI1)
"RTN","PSBCSUTX",59,0)
 Q:$$QUT^PSBCSUTY()
"RTN","PSBCSUTX",60,0)
 I $P(PSBXREC,U)="ID" S PSBUSED=$$USED^PSBCSUTY()  Q:PSBUSED
"RTN","PSBCSUTX",61,0)
 S PSBCNT2=PSBCNT2+1,^TMP("PSB",$J,"CVRSHT2",PSBCNT2)=^TMP("PSB",$J,PSBTAB,PSBI1)
"RTN","PSBCSUTX",62,0)
 Q
"RTN","PSBCSUTX",63,0)
ADM ; AdmnInfo
"RTN","PSBCSUTX",64,0)
 K PSBDONE S (PSBONMBR,PSBSCHTM)="" F PSBI1=2:1:$P(^TMP("PSB",$J,PSBTAB,0),U) D
"RTN","PSBCSUTX",65,0)
 .I $P(^TMP("PSB",$J,PSBTAB,PSBI1),U)="ORD" S PSBONMBR=$P(^TMP("PSB",$J,PSBTAB,PSBI1),U,3),$P(^TMP("PSB",$J,"CVRSHT2",PSBI1),U,15)=""
"RTN","PSBCSUTX",66,0)
 .S (PSBXX,PSBXXX)="" F  S PSBXX=$O(PSBADMX(PSBONMBR,PSBXX)) Q:PSBXX=""  F  S PSBXXX=$O(PSBADMX(PSBONMBR,PSBXX,PSBXXX)) Q:PSBXXX=""  D
"RTN","PSBCSUTX",67,0)
 ..S PSBSCHTM=PSBXX,PSBIENX=PSBXXX
"RTN","PSBCSUTX",68,0)
 ..Q:'$D(PSBLST4X(PSBONMBR,PSBIENX))
"RTN","PSBCSUTX",69,0)
 ..S PSBACT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION STATUS","I")
"RTN","PSBCSUTX",70,0)
 ..I PSBACT']"" S PSBACT="U"
"RTN","PSBCSUTX",71,0)
 ..S PSBACTDT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION DATE/TIME","I")
"RTN","PSBCSUTX",72,0)
 ..S PSBBAGID=$$GET1^DIQ(53.79,PSBIENX_",","IV UNIQUE ID")
"RTN","PSBCSUTX",73,0)
 ..S PSBPRNRE=$$GET1^DIQ(53.79,PSBIENX_",","PRN REASON")
"RTN","PSBCSUTX",74,0)
 ..S PSBACTBY=$$GET1^DIQ(53.79,PSBIENX_",","ACTION BY:INITIAL") S:PSBACTBY']"" PSBACTBY="***"
"RTN","PSBCSUTX",75,0)
 ..S PSBACTPT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION BY","I")
"RTN","PSBCSUTX",76,0)
 ..S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX)=PSBSCHTM_"^"_PSBBAGID_"^"_PSBIENX_"^"_PSBACT_"^"_PSBACTDT_"^"_PSBACTBY_"^"_PSBACTPT_"^"_PSBPRNRE
"RTN","PSBCSUTX",77,0)
 ..I PSBIENX]"" K PSBADMX(PSBONMBR,PSBSCHTM,PSBIENX)
"RTN","PSBCSUTX",78,0)
 .I '$D(PSBADMS(PSBONMBR)) K ^TMP("PSB",$J,"CVRSHT2",PSBI1) Q
"RTN","PSBCSUTX",79,0)
 .I $P(^TMP("PSB",$J,PSBTAB,PSBI1),U)="END" K PSBADMS(PSBONMBR) Q
"RTN","PSBCSUTX",80,0)
 .I $P(^TMP("PSB",$J,PSBTAB,PSBI1+1),U)="END" D  Q
"RTN","PSBCSUTX",81,0)
 ..S PSBCNT2=1,PSBSCHTM=""
"RTN","PSBCSUTX",82,0)
 ..F  S PSBSCHTM=$O(PSBADMS(PSBONMBR,PSBSCHTM)) Q:+$G(PSBSCHTM)=0  D
"RTN","PSBCSUTX",83,0)
 ...S PSBIENX=$P(PSBADMS(PSBONMBR,PSBSCHTM),U,3)
"RTN","PSBCSUTX",84,0)
 ...I PSBIENX]"",'$D(PSBDONE(PSBIENX))  D
"RTN","PSBCSUTX",85,0)
 ....S PSBACT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION STATUS","I")
"RTN","PSBCSUTX",86,0)
 ....I PSBACT']"" S PSBACT="U"
"RTN","PSBCSUTX",87,0)
 ....S PSBACTDT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION DATE/TIME","I")
"RTN","PSBCSUTX",88,0)
 ....Q:PSBACT="N"
"RTN","PSBCSUTX",89,0)
 ....Q:$D(PSBADMS(PSBONMBR,"EXP"))&("SI"'[PSBACT)
"RTN","PSBCSUTX",90,0)
 ....S $P(PSBADMS(PSBONMBR,PSBSCHTM),U,4)=PSBACT
"RTN","PSBCSUTX",91,0)
 ....S ^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2)="ADM^"_PSBADMS(PSBONMBR,PSBSCHTM)_"^"_$$NEXTADM(PSBDFNX,PSBONMBR),PSBCNT2=PSBCNT2+1
"RTN","PSBCSUTX",92,0)
 ....S PSBDONE(PSBIENX)=""
"RTN","PSBCSUTX",93,0)
 ....D CMT^PSBCSUTY
"RTN","PSBCSUTX",94,0)
 ...I (PSBIENX']"")&($G(PSBADMS(PSBONMBR,PSBSCHTM,1))'=1) S ^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2)="ADM^"_PSBADMS(PSBONMBR,PSBSCHTM)_"^"_$$NEXTADM(PSBDFNX,PSBONMBR),PSBCNT2=PSBCNT2+1
"RTN","PSBCSUTX",95,0)
 K PSBSCHTM
"RTN","PSBCSUTX",96,0)
 Q
"RTN","PSBCSUTX",97,0)
FINALPAS ;
"RTN","PSBCSUTX",98,0)
 S PSBI1="^TMP(""PSB"",$J,""CVRSHT"")",PSBCNT1=0
"RTN","PSBCSUTX",99,0)
 F  S PSBI1=$Q(@PSBI1) Q:PSBI1["CVRSHT2"  D
"RTN","PSBCSUTX",100,0)
 .I $QS(PSBI1,4)'>1 S ^TMP("PSB",$J,"CVRSHT2",PSBCNT1)=@PSBI1,PSBCNT1=PSBCNT1+1 Q
"RTN","PSBCSUTX",101,0)
 .K PSBX2 M PSBX2=^TMP("PSB",$J,"CVRSHT",$QS(PSBI1,4))
"RTN","PSBCSUTX",102,0)
 .I $QS(PSBI1,5)="" S ^TMP("PSB",$J,"CVRSHT2",PSBCNT1)=@PSBI1,PSBCNT1=PSBCNT1+1 Q
"RTN","PSBCSUTX",103,0)
 .K PSBDONE
"RTN","PSBCSUTX",104,0)
 .I '$D(PSBX2(1)) S ^TMP("PSB",$J,"CVRSHT2",PSBCNT1)=@PSBI1,PSBCNT1=PSBCNT1+1 Q
"RTN","PSBCSUTX",105,0)
 .F PSBI2=1:1 Q:'$D(PSBX2(PSBI2))  D  ; Sort actn/commnt revrs chrono
"RTN","PSBCSUTX",106,0)
 ..Q:$D(PSBDONE(PSBI2))
"RTN","PSBCSUTX",107,0)
 ..S PSBXDTTM=(-1*($P(PSBX2(PSBI2),U,6)))_+($E($P(PSBX2(PSBI2),U,4),$L($P(PSBX2(PSBI2),U,4))-6,999)),PSBMCODE=$P(PSBX2(PSBI2),U)
"RTN","PSBCSUTX",108,0)
 ..D:(+PSBXDTTM<0)&(PSBMCODE["ADM")
"RTN","PSBCSUTX",109,0)
 ...S PSBX3(+PSBXDTTM,-999)=PSBX2(PSBI2),PSBDONE(PSBI2)="" K ^TMP("PSB",$J,"CVRSHT",$QS(PSBI1,4),PSBI2)
"RTN","PSBCSUTX",110,0)
 ...F PSBI3=1:1 Q:'$D(PSBX2(PSBI2+PSBI3))  Q:$P(PSBX2(PSBI2+PSBI3),U)'["CMT"  D
"RTN","PSBCSUTX",111,0)
 ....S PSBX3(+PSBXDTTM,-1*PSBI3)=PSBX2(PSBI2+PSBI3),PSBDONE(PSBI2+PSBI3)="" K ^TMP("PSB",$J,"CVRSHT",$QS(PSBI1,4),PSBI2+PSBI3)
"RTN","PSBCSUTX",112,0)
 ..D:(+PSBXDTTM=0)&(PSBMCODE["ADM")
"RTN","PSBCSUTX",113,0)
 ...S PSBX3(PSBI2,0)=PSBX2(PSBI2),PSBDONE(PSBI2)="" K ^TMP("PSB",$J,"CVRSHT",$QS(PSBI1,4),PSBI2)
"RTN","PSBCSUTX",114,0)
 .I $D(PSBX3) D  K PSBX3
"RTN","PSBCSUTX",115,0)
 ..S PSBI2="" F  S PSBI2=$O(PSBX3(PSBI2)) Q:PSBI2=""  S PSBI3="" F  S PSBI3=$O(PSBX3(PSBI2,PSBI3)) Q:PSBI3=""  D
"RTN","PSBCSUTX",116,0)
 ...S ^TMP("PSB",$J,"CVRSHT2",PSBCNT1)=PSBX3(PSBI2,PSBI3),PSBCNT1=PSBCNT1+1
"RTN","PSBCSUTX",117,0)
 S $P(^TMP("PSB",$J,"CVRSHT2",0),U)=PSBCNT1-1
"RTN","PSBCSUTX",118,0)
 Q
"RTN","PSBCSUTX",119,0)
NEXTADM(XX,YY) ;
"RTN","PSBCSUTX",120,0)
 S NEXTADM=""
"RTN","PSBCSUTX",121,0)
 I $D(PSBNXTDU(YY)) S NEXTADM=PSBNXTDU(YY) Q NEXTADM
"RTN","PSBCSUTX",122,0)
 D:YY'["P"
"RTN","PSBCSUTX",123,0)
 .S PSBPATX=XX,PSBORXX=YY D CLEAN^PSBVT,PSJ1^PSBVT(XX,YY)
"RTN","PSBCSUTX",124,0)
 .Q:(PSBORXX["V")&'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,$G(PSBMR))
"RTN","PSBCSUTX",125,0)
 .S PSBGSCH=PSBADST,XX=PSBPATX,YY=PSBORXX,(NEXTADM,X,Y)="",X=$O(^PSB(53.79,"AORD",XX,YY,X),-1)
"RTN","PSBCSUTX",126,0)
 .I X]"" S Y=$O(^PSB(53.79,"AORD",XX,YY,X,Y),-1) I ($F("NM",$P(^PSB(53.79,Y,0),U,9))>1)!($P(^PSB(53.79,Y,0),U,9)="") S NEXTADM=X
"RTN","PSBCSUTX",127,0)
 .D:X']""
"RTN","PSBCSUTX",128,0)
 ..S Y="",X=$O(^PSB(53.79,"AORDX",XX,YY,X),-1)
"RTN","PSBCSUTX",129,0)
 ..I X]"" S Y=$O(^PSB(53.79,"AORDX",XX,YY,X,Y),-1) I $F("NM",$P(^PSB(53.79,Y,0),U,9))>1!($P(^PSB(53.79,Y,0),U,9)="") S NEXTADM=$P(^PSB(53.79,Y,0),U,6)
"RTN","PSBCSUTX",130,0)
 .D:NEXTADM=""
"RTN","PSBCSUTX",131,0)
 ..S PSBGOTY=Y,PSBFREQ=$$GETFREQ^PSBVDLU1(XX,YY)
"RTN","PSBCSUTX",132,0)
 ..S PSBFREQ=$S(PSBFREQ="O":1440,PSBFREQ="D":"",1:PSBFREQ)
"RTN","PSBCSUTX",133,0)
 ..S (PSBXSCH,LSTTIME,LSTIEN)=""
"RTN","PSBCSUTX",134,0)
 ..S:PSBGOTY]"" LSTTIME=$O(^PSB(53.79,"AORD",PSBPATX,PSBORXX,LSTTIME),-1) I LSTTIME]"" S LSTIEN=$O(^PSB(53.79,"AORD",PSBPATX,PSBORXX,LSTTIME,""),-1)
"RTN","PSBCSUTX",135,0)
 ..I LSTIEN]"" S:$P(^PSB(53.79,LSTIEN,0),U,9)']"" LSTTIME=""
"RTN","PSBCSUTX",136,0)
 ..S:LSTTIME="" LSTTIME=$$FMADD^XLFDT(PSBOST,,,,-0.1)
"RTN","PSBCSUTX",137,0)
 ..I +PSBFREQ>0 S PSBXSCH=(+PSBFREQ/60)_"H"
"RTN","PSBCSUTX",138,0)
 ..S X=LSTTIME
"RTN","PSBCSUTX",139,0)
 ..F PSBIX1=1:1:($L(PSBGSCH,"-")+1) D  Q:NEXTADM>LSTTIME
"RTN","PSBCSUTX",140,0)
 ...I ($P(PSBGSCH,"-",PSBIX1))']"" D  Q
"RTN","PSBCSUTX",141,0)
 ....I PSBIX1=1 D  Q
"RTN","PSBCSUTX",142,0)
 .....I X<PSBOST S NEXTADM=PSBOST Q
"RTN","PSBCSUTX",143,0)
 .....S X=PSBOST F  S X=$$SCH^XLFDT(PSBXSCH,X) S Y="" S Y=$O(^PSB(53.79,"AORD",PSBPATX,PSBORXX,Y),-1)  I X>Y S NEXTADM=X Q
"RTN","PSBCSUTX",144,0)
 ....I PSBGSCH]"" D  Q
"RTN","PSBCSUTX",145,0)
 .....I (+PSBFREQ'>1440) F I=0:1 S PSBDTXX=$$FMADD^XLFDT(PSBOST,I) S $P(PSBDTXX,".",2)=($P(PSBGSCH,"-")) I PSBDTXX>LSTTIME S NEXTADM=PSBDTXX Q
"RTN","PSBCSUTX",146,0)
 .....I (+PSBFREQ'<1440),(1440#PSBFREQ=1440) F I=0:1 S PSBDTXX=$$FMADD^XLFDT(PSBOST,(I*(PSBFREQ\1440))) S $P(PSBDTXX,".",2)=($P(PSBGSCH,"-")) I PSBDTXX>LSTTIME S NEXTADM=PSBDTXX Q
"RTN","PSBCSUTX",147,0)
 ....S $P(X,".",2)=$P(PSBGSCH,"-"),NEXTADM=$$SCH^XLFDT(PSBXSCH,X) Q
"RTN","PSBCSUTX",148,0)
 ...S $P(X,".",2)=$P(PSBGSCH,"-",PSBIX1),NEXTADM=X
"RTN","PSBCSUTX",149,0)
 .I $$PSBDCHK1^PSBVT1(PSBSCH) D
"RTN","PSBCSUTX",150,0)
 ..S YY=PSBORXX,XX=PSBPATX
"RTN","PSBCSUTX",151,0)
 ..I $G(LSTTIME)]"" S NEXTADM=$S(LSTTIME'<PSBOST:LSTTIME,NEXTADM>LSTTIME:NEXTADM,1:PSBOST)
"RTN","PSBCSUTX",152,0)
 ..I PSBFREQ="" S PSBDTX=$P(NEXTADM,".") F PSBIX3=0:1 S X=$$FMADD^XLFDT(PSBDTX,PSBIX3) Q:X>PSBOSP  D  Q:$G(PSBYS)
"RTN","PSBCSUTX",153,0)
 ...S PSBNXTDT=X D DW^%DTC S PSBYS=0 F PSBIX2=1:1 S PSBDY=$P($P(PSBSCH,"@"),"-",PSBIX2) Q:PSBDY=""  I $F(X,PSBDY)>1 S PSBYS=1
"RTN","PSBCSUTX",154,0)
 ...I PSBYS S PSBSCTM=$$GETADMIN^PSBVDLU1(XX,YY,PSBNXTDT,"","") K ^TMP("PSB",$J,"GETADMIN") D
"RTN","PSBCSUTX",155,0)
 ....F PSBIX4=1:1 S PSBTX=$P(PSBSCTM,"-",PSBIX4) Q:PSBTX=""  D  Q:PSBYS
"RTN","PSBCSUTX",156,0)
 .....I NEXTADM>(PSBNXTDT_"."_PSBTX) S PSBYS=0 Q
"RTN","PSBCSUTX",157,0)
 .....S NEXTADM=PSBNXTDT,$P(NEXTADM,".",2)=PSBTX
"RTN","PSBCSUTX",158,0)
 .....I NEXTADM]"" I (NEXTADM<PSBOST)!$D(^PSB(53.79,"AORD",PSBPATX,PSBORXX,+NEXTADM))!(NEXTADM>PSBOSP) S PSBYS=0,NEXTADM="" Q
"RTN","PSBCSUTX",159,0)
 .....S PSBYS=1
"RTN","PSBCSUTX",160,0)
 .S PSBNXTDU(PSBORXX)=NEXTADM
"RTN","PSBCSUTX",161,0)
 .D CLEAN^PSBVT
"RTN","PSBCSUTX",162,0)
 Q NEXTADM
"RTN","PSBML")
0^14^B78116244^B81900339
"RTN","PSBML",1,0)
PSBML ;BIRMINGHAM/EFC-BCMA MED LOG FUNCTIONS ;Mar 2004
"RTN","PSBML",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,9,11,13**;Mar 2004
"RTN","PSBML",3,0)
 ;
"RTN","PSBML",4,0)
 ; Reference/IA
"RTN","PSBML",5,0)
 ; ^DPT/10035
"RTN","PSBML",6,0)
 ; DIC(42/10039
"RTN","PSBML",7,0)
 ; DIC(42/2440
"RTN","PSBML",8,0)
 ; File 200/10060
"RTN","PSBML",9,0)
 ; EN^PSJBCMA3/3320
"RTN","PSBML",10,0)
 ; $$SITE^VASITE/10112
"RTN","PSBML",11,0)
 ; ^XUSEC(/10076
"RTN","PSBML",12,0)
 ;
"RTN","PSBML",13,0)
RPC(RESULTS,PSBHDR,PSBREC) ;BCMA MedLog Filing
"RTN","PSBML",14,0)
 S PSBEDTFL=0
"RTN","PSBML",15,0)
 N PSBORD,PSBTRAN,PSBFDA
"RTN","PSBML",16,0)
 K PSBIEN,PSBHL7
"RTN","PSBML",17,0)
 S PSBIEN=$P(PSBHDR,U,1)
"RTN","PSBML",18,0)
 S PSBTRAN=$P(PSBHDR,U,2),PSBHL7=PSBTRAN
"RTN","PSBML",19,0)
 S PSBINST=$P($G(PSBHDR),U,3)
"RTN","PSBML",20,0)
 S PSBAUDIT=$S(PSBIEN="+1":0,1:1)
"RTN","PSBML",21,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBML",22,0)
 I $D(^XUSEC("PSB STUDENT",DUZ)),PSBINST="" S RESULTS(0)=1,RESULTS(1)="-1^Instructor not present" Q
"RTN","PSBML",23,0)
 I $D(^XUSEC("PSB STUDENT",DUZ)),'$D(^XUSEC("PSB INSTRUCTOR",PSBINST)) S RESULTS(0)=1,RESULTS(1)="-1^Instructor doesn't have authority" Q
"RTN","PSBML",24,0)
 S PSBINST(0)=$$GET1^DIQ(200,PSBINST_",",.01)
"RTN","PSBML",25,0)
 I PSBTRAN="ADD COMMENT" D COMMENT^PSBML1 Q
"RTN","PSBML",26,0)
 I PSBTRAN="PRN EFFECTIVENESS" D PRN^PSBML1 Q
"RTN","PSBML",27,0)
 I PSBTRAN="UPDATE STATUS" D  Q
"RTN","PSBML",28,0)
 .I '$D(^PSB(53.79,PSBIEN)) S RESULTS(0)=1,RESULTS(1)="-1^Administration is at an UNKNOWN STATUS" Q
"RTN","PSBML",29,0)
 .D UPDATED^PSBML2
"RTN","PSBML",30,0)
 I PSBTRAN="EDIT" D EDIT^PSBML2 Q
"RTN","PSBML",31,0)
 ;SAGG
"RTN","PSBML",32,0)
 N PSBWARD S PSBWARD=$G(^DPT(+$G(PSBREC(0)),.1),"UNKNOWN"),^PSB("SAGG",PSBWARD,DT)=$G(^PSB("SAGG",PSBWARD,DT))+1
"RTN","PSBML",33,0)
 I PSBREC(1)?1U1";"1.6N S PSBREC(1)=$P(PSBREC(1),";",1)_$E(PSBREC(1))
"RTN","PSBML",34,0)
 D PSJ1^PSBVT(PSBREC(0),$P(PSBREC(1),";",2)_$P(PSBREC(1),";",1))
"RTN","PSBML",35,0)
 S PSBTAB=$P(PSBREC(9),U,1),PSBUID=$P(PSBREC(9),U,2)
"RTN","PSBML",36,0)
 D:PSBTRAN="MEDPASS"
"RTN","PSBML",37,0)
 .I (PSBDOSEF["PATCH"),(PSBREC(3)="G") D  Q:+$G(RESULTS(1))<0
"RTN","PSBML",38,0)
 ..S PSBXDT="" F  S PSBXDT=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXDT)) Q:PSBXDT=""  D  Q:+$G(RESULTS(1))<0
"RTN","PSBML",39,0)
 ...S PSBYZ="" F  S PSBYZ=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXDT,PSBYZ)) Q:'PSBYZ  I ("G"[$$GET1^DIQ(53.79,PSBYZ,.09,"I")) D  Q
"RTN","PSBML",40,0)
 ....S:($$GET1^DIQ(53.79,PSBYZ,.09,"I")="G") RESULTS(0)=1,RESULTS(1)="-1^Previous Patch has not been removed. Administration canceled."
"RTN","PSBML",41,0)
 ....S:($$GET1^DIQ(53.79,PSBYZ,.09,"I")="")&(($$GET1^DIQ(53.79,PSBYZ,.07,"I")'=DUZ)&('$D(^XUSEC("PSB MANAGER",DUZ)))) RESULTS(0)=1,RESULTS(1)="-1^Patch status ""*UNKNOWN*"". Administration canceled."
"RTN","PSBML",42,0)
 .I PSBREC(7)="BCMA/CPRS Interface Entry." S PSBNOW=PSBREC(5)  ;MOB
"RTN","PSBML",43,0)
 .F X=0:1:9 S PSBREC(X)=$G(PSBREC(X))
"RTN","PSBML",44,0)
 .I PSBREC(1)?1U1";".N S PSBREC(1)=$P(PSBREC(1),";",2)_$P(PSBREC(1),";",1)
"RTN","PSBML",45,0)
 .I PSBREC(1)["V",+PSBREC(5)>0,+$P(PSBREC(5),".",2)=0,PSBIVT'["P" D NOW^%DTC S PSBREC(5)=$P(PSBREC(5),".",1)_"."_$P(%,".",2)
"RTN","PSBML",46,0)
 .I $P(PSBREC(9),U,1)="IVTAB",$P(PSBREC(9),U,2)="" S PSBUID=$$GETWSID^PSBVDLU2(PSBREC(0),PSBREC(1))
"RTN","PSBML",47,0)
 .I $P(PSBREC(9),U,1)="PBTAB",$P(PSBREC(9),U,2)="",PSBREC(1)'["U",PSBREC(3)'="M",PSBREC(3)'="R",PSBREC(3)'="H" S PSBUID=$$GETWSID^PSBVDLU2(PSBREC(0),PSBREC(1))
"RTN","PSBML",48,0)
 .;OnCal
"RTN","PSBML",49,0)
 .D:PSBREC(2)="OC"
"RTN","PSBML",50,0)
 ..S X=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),"")) Q:X=""
"RTN","PSBML",51,0)
 ..S Y=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),X,0))
"RTN","PSBML",52,0)
 ..I $P(^PSB(53.79,Y,0),U,9)="G"&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL")) D ERR(1,"On-Call already given")
"RTN","PSBML",53,0)
 .;1x
"RTN","PSBML",54,0)
 .D:PSBREC(2)="O"
"RTN","PSBML",55,0)
 ..S X=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),"")) Q:X=""
"RTN","PSBML",56,0)
 ..S Y=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),X,0))
"RTN","PSBML",57,0)
 ..I $P(^PSB(53.79,Y,0),U,9)="G" D ERR(1,"One Time already Given")
"RTN","PSBML",58,0)
 .;PRN
"RTN","PSBML",59,0)
 .I PSBREC(2)="P",PSBREC(3)'="M",$P(PSBREC(9),U,1)'="IVTAB" D
"RTN","PSBML",60,0)
 ..I PSBREC(6)="" D ERR(1,"PRN Medications MUST Have a PRN Reason")
"RTN","PSBML",61,0)
 ..I PSBREC(5)]"" D ERR(1,"PRN Orders don't have scheduled times")
"RTN","PSBML",62,0)
 ..I PSBREC(3)'="G" D ERR(1,"PRN Orders cannot be marked NOT Given")
"RTN","PSBML",63,0)
 .;Cnt
"RTN","PSBML",64,0)
 .I PSBREC(2)="C",PSBTAB'="IVTAB" D
"RTN","PSBML",65,0)
 ..D:PSBREC(5)="" ERR(1,"Continuous Order needs admin time")
"RTN","PSBML",66,0)
 ..D:PSBREC(6)]"" ERR(1,"No PRN Reason allowed on Continuous Orders")
"RTN","PSBML",67,0)
 .I PSBREC(2)="C",$D(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),+PSBREC(5))),PSBIEN="+1" D  K PSBADMBY,PSBADMAT Q:PSBSIEN=""  Q:$P(^PSB(53.79,PSBSIEN,0),U,9)'="N"
"RTN","PSBML",68,0)
 ..S PSBSIEN=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),PSBREC(5),""))
"RTN","PSBML",69,0)
 ..I PSBSIEN]"" I '(($P(^PSB(53.79,PSBSIEN,0),U,7)=DUZ)!($D(^XUSEC("PSB MANAGER",DUZ)))) S PSBSIEN=""
"RTN","PSBML",70,0)
 ..I PSBSIEN']"" S RESULTS(0)=2,RESULTS(1)="-2^Error Filing Transaction MEDPASS",RESULTS(2)="This scheduled admin is being modified by another." Q
"RTN","PSBML",71,0)
 ..D:$P(^PSB(53.79,PSBSIEN,0),U,9)'="N"
"RTN","PSBML",72,0)
 ...K PSBINCX I $P(^PSB(53.79,PSBSIEN,0),U,9)="" S PSBINCX=PSBSIEN L +^PSB(53.79,PSBINCX):1 Q:'$T  L -^PSB(53.79,PSBINCX)
"RTN","PSBML",73,0)
 ...S Y=$P(^PSB(53.79,PSBSIEN,0),U,6) D DD^%DT S PSBADMAT=Y
"RTN","PSBML",74,0)
 ...S PSBADMBY=$$GET1^DIQ(200,$P(^PSB(53.79,PSBSIEN,0),U,7),.01,)
"RTN","PSBML",75,0)
 ...S RESULTS(0)=3,RESULTS(1)="-2^Error Filing Transaction MEDPASS"
"RTN","PSBML",76,0)
 ...S RESULTS(2)="Continuous Administration Date/Time already on file."
"RTN","PSBML",77,0)
 ...S RESULTS(3)="Administered by "_PSBADMBY_" at "_PSBADMAT_"."
"RTN","PSBML",78,0)
 ...I $D(XWB) S RESULTS(0)=RESULTS(0)+2,RESULTS(4)="                                         ",RESULTS(5)="            VDL will now be updated."
"RTN","PSBML",79,0)
 .;NonGvn
"RTN","PSBML",80,0)
 .I PSBREC(3)'="G",PSBREC(3)'="M",PSBUID'["V",PSBUID'["W" D
"RTN","PSBML",81,0)
 ..I PSBREC(7)="",PSBTAB'="IVTAB" D ERR(1,"Comment needed if Not Marked Given")
"RTN","PSBML",82,0)
 ..I PSBREC(7)="",PSBTAB="IVTAB" D ERR(1,"Comment needed if Not Marked Completed")
"RTN","PSBML",83,0)
 .S:PSBREC(3)="H" PSBREC(7)="Held: "_PSBREC(7)    ;.3
"RTN","PSBML",84,0)
 .S:PSBREC(3)="R" PSBREC(7)="Refused: "_PSBREC(7) ;.3
"RTN","PSBML",85,0)
 .S:PSBREC(3)="S" PSBREC(7)="Stopped: "_PSBREC(7) ;.3
"RTN","PSBML",86,0)
 .;Vald?
"RTN","PSBML",87,0)
 .I $G(PSBSIEN)'="" I $D(^PSB(53.79,PSBSIEN,0)) I $P(^PSB(53.79,PSBSIEN,0),U,9)="N" S PSBIEN=+PSBSIEN_",",$P(PSBHDR,U)=PSBIEN,PSBTRAN="UPDATE STATUS",PSBAUDIT=1   ;do UPDATE
"RTN","PSBML",88,0)
 .D:PSBIEN="+1"  ;New?
"RTN","PSBML",89,0)
 ..D VAL(53.79,PSBIEN,.01,"`"_PSBREC(0)) ;Pt
"RTN","PSBML",90,0)
 ..S X=$G(^DPT(PSBREC(0),.1))_" "_$G(^(.101)) ;WrdRmBd
"RTN","PSBML",91,0)
 ..D VAL(53.79,PSBIEN,.02,X) ;PtLoc
"RTN","PSBML",92,0)
 ..D:$G(^DPT(PSBREC(0),.1))'=""
"RTN","PSBML",93,0)
 ...S Y=$O(^DIC(42,"B",$G(^DPT(PSBREC(0),.1)),"")),Y=$$GET1^DIQ(42,Y,.015,"I"),PSBDIV=$$SITE^VASITE(DT,Y)
"RTN","PSBML",94,0)
 ...D VAL(53.79,PSBIEN,.03,"`"_$P(PSBDIV,U,1)) ;Div
"RTN","PSBML",95,0)
 ..D VAL(53.79,PSBIEN,.04,PSBNOW)  ;EntDT
"RTN","PSBML",96,0)
 ..D VAL(53.79,PSBIEN,.05,"`"_DUZ) ;Who
"RTN","PSBML",97,0)
 ..D VAL(53.79,PSBIEN,.06,PSBNOW)  ;AdmDT
"RTN","PSBML",98,0)
 ..D VAL(53.79,PSBIEN,.07,"`"_DUZ) ;AdmBy
"RTN","PSBML",99,0)
 ..D VAL(53.79,PSBIEN,.08,"`"_PSBREC(4)) ;OrdblItm
"RTN","PSBML",100,0)
 ..D VAL(53.79,PSBIEN,.11,PSBREC(1)) ;OrdTpeIEN
"RTN","PSBML",101,0)
 ..D VAL(53.79,PSBIEN,.12,PSBREC(2)) ;OrdSchdTpe
"RTN","PSBML",102,0)
 ..D VAL(53.79,PSBIEN,.13,PSBREC(5)) ;SchdAdmDT
"RTN","PSBML",103,0)
 ..D:PSBTAB'="UDTAB" VAL(53.79,PSBIEN,.26,PSBUID) ;Bag
"RTN","PSBML",104,0)
 ..D:PSBTAB="IVTAB" VAL(53.79,PSBIEN,.13,"") ;no SchdAdm - lvIV
"RTN","PSBML",105,0)
 ..D:PSBREC(1)?.N1"U" VAL(53.79,PSBIEN,.15,PSBDOSE) ;UDDsage
"RTN","PSBML",106,0)
 ..D:PSBREC(1)?.N1"V" VAL(53.79,PSBIEN,.35,PSBIFR)  ;IVInfRt
"RTN","PSBML",107,0)
 .;Ovrwrt if exsts
"RTN","PSBML",108,0)
 .I PSBREC(3)="G"!(PSBREC(3))="C" D  ;Gvn/Cmpltd?
"RTN","PSBML",109,0)
 ..D VAL(53.79,PSBIEN,.06,PSBNOW)   ;AdmDT
"RTN","PSBML",110,0)
 ..D VAL(53.79,PSBIEN,.07,"`"_DUZ)  ;AdmBy
"RTN","PSBML",111,0)
 .D:PSBREC(8)]"" VAL(53.79,PSBIEN,.16,PSBREC(8)) ;InjctSte
"RTN","PSBML",112,0)
 .D:'$G(PSBMMEN) VAL(53.79,PSBIEN,.09,PSBREC(3)) ;AStats
"RTN","PSBML",113,0)
 .D:PSBREC(6)]"" VAL(53.79,PSBIEN,.21,$P(PSBREC(6),U)),VAL(53.79,PSBIEN,.27,$P(PSBREC(6),U,2)) ;PRNRsn
"RTN","PSBML",114,0)
 .D:PSBREC(7)]""
"RTN","PSBML",115,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.01,PSBREC(7)) ;Cmnt
"RTN","PSBML",116,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.02,"`"_DUZ)   ;Who
"RTN","PSBML",117,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.03,PSBNOW)
"RTN","PSBML",118,0)
 .;DD/SOL/ADD
"RTN","PSBML",119,0)
 .I PSBREC(3)="G"!(PSBREC(3)="I")!(PSBREC(3)="H")!(PSBREC(3)="R")!(PSBREC(3)="M") D  ;gvn/infs?
"RTN","PSBML",120,0)
 ..I PSBTRAN="UPDATE STATUS" K ^PSB(53.79,+PSBIEN,.5),^PSB(53.79,+PSBIEN,.6),^PSB(53.79,+PSBIEN,.7)
"RTN","PSBML",121,0)
 ..F PSBCNT=10:1 Q:'$D(PSBREC(PSBCNT))  D
"RTN","PSBML",122,0)
 ...S Y=$P(PSBREC(PSBCNT),U)
"RTN","PSBML",123,0)
 ...S PSBDD=$S(Y="DD":53.795,Y="ADD":53.796,Y="SOL":53.797,1:0)
"RTN","PSBML",124,0)
 ...Q:'PSBDD
"RTN","PSBML",125,0)
 ...S PSBIENS="+"_PSBCNT_","_PSBIEN
"RTN","PSBML",126,0)
 ...D VAL(PSBDD,PSBIENS,.01,"`"_$P(PSBREC(PSBCNT),U,2))
"RTN","PSBML",127,0)
 ...D VAL(PSBDD,PSBIENS,.02,$P(PSBREC(PSBCNT),U,3))
"RTN","PSBML",128,0)
 ...D VAL(PSBDD,PSBIENS,.03,$P(PSBREC(PSBCNT),U,4))
"RTN","PSBML",129,0)
 ...D:(PSBTAB="UDTAB")!(PSBTAB="PBTAB") VAL(PSBDD,PSBIENS,.04,$E($P(PSBREC(PSBCNT),U,5),1,20))
"RTN","PSBML",130,0)
 .I $O(RESULTS("")) S RESULTS(0)=1,RESULTS(1)="-1^Error(s) Filing Transaction MEDPASS"  Q
"RTN","PSBML",131,0)
 .D FILEIT
"RTN","PSBML",132,0)
 .D:(PSBREC(2)="O")&(PSBREC(3)="G") EXPIRE^PSBML1  ;1x exp?
"RTN","PSBML",133,0)
 .I $P(RESULTS(0),U,1)=1,PSBTAB'="UDTAB",PSBUID]"",PSBUID'["WS" S PSBON=+PSBREC(1) D EN^PSJBCMA3(PSBREC(0),PSBON,PSBUID,PSBREC(3),PSBNOW)
"RTN","PSBML",134,0)
 Q
"RTN","PSBML",135,0)
BCBU ;HL7,NatContng
"RTN","PSBML",136,0)
 Q:+$G(RESULTS(0))'>0
"RTN","PSBML",137,0)
 N PSBIEN1 S PSBIEN1=$S($P(PSBIEN,",",2)'="":+$P(PSBIEN,",",2),$G(PSBIEN)="+1":PSBIEN(1),1:+$G(PSBIEN))
"RTN","PSBML",138,0)
 I $G(PSBIEN1)="" S RESULTS(0)=1,RESULTS(1)="-1^Contingency NOT processed" Q
"RTN","PSBML",139,0)
 I $G(PSBIEN)="+1" S PSBHL7="MEDPASS"
"RTN","PSBML",140,0)
 E  S:$G(PSBHL7)="" PSBHL7="UPDATE STATUS"
"RTN","PSBML",141,0)
 D:('$D(Y(0))!($G(Y(0))="SAVE")!($G(Y(0))="YES")) EN^PSBSVHL7(+PSBIEN1,PSBHL7),MEDL^ALPBCBU(+PSBIEN1) K PSBHL7
"RTN","PSBML",142,0)
 ;<<HDR-VDEF(frm *3)
"RTN","PSBML",143,0)
 Q
"RTN","PSBML",144,0)
VAL(PSBDD,PSBIEN,PSBFLD,PSBVAL) ;
"RTN","PSBML",145,0)
 K ^TMP("DIERR",$J),PSBRET
"RTN","PSBML",146,0)
 D VAL^DIE(PSBDD,PSBIEN,PSBFLD,"F",PSBVAL,.PSBRET,"PSBFDA")
"RTN","PSBML",147,0)
 I PSBRET="^" F X=0:0 S X=$O(^TMP("DIERR",$J,X)) Q:'X  D ERR(2,^TMP("DIERR",$J,X)_": "_$G(^(X,"TEXT",1),"**"))
"RTN","PSBML",148,0)
 K ^TMP("DIERR",$J),PSBRET
"RTN","PSBML",149,0)
 Q
"RTN","PSBML",150,0)
FILEIT ;Updt
"RTN","PSBML",151,0)
 N PSBMSG,PSBAUD
"RTN","PSBML",152,0)
 S (PSB1,PSB2)=""
"RTN","PSBML",153,0)
 D APATCH^PSBML3
"RTN","PSBML",154,0)
 D CLEAN^DILF
"RTN","PSBML",155,0)
 D RESETADM^PSBUTL
"RTN","PSBML",156,0)
 D UPDATE^DIE("","PSBFDA","PSBIEN","PSBMSG")
"RTN","PSBML",157,0)
 I '$G(PSBMMEN) S X=+PSBIEN I $F("HR",$P(^PSB(53.79,X,0),U,9))>1 F Y=.5,.6,.7 S Z=0 F  S Z=$O(^PSB(53.79,+X,Y,Z)) Q:+Z=0  S $P(^PSB(53.79,+X,Y,Z,0),U,3)=0
"RTN","PSBML",158,0)
 I $D(PSBMSG("DIERR")) S RESULTS(0)=1,RESULTS(1)="-1^"_PSBMSG("DIERR",1)_": "_PSBMSG("DIERR",1,"TEXT",1)  Q
"RTN","PSBML",159,0)
 I $G(PSB1)]"" X PSB1 I $G(PSB2)]"" X PSB2
"RTN","PSBML",160,0)
 I $D(PSBHDR) D:"NHMR"[$P(^PSB(53.79,$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:+PSBIEN),0),U,9)
"RTN","PSBML",161,0)
 .N PSBINDX S PSBINDX=$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:+PSBIEN)
"RTN","PSBML",162,0)
 .K ^PSB(53.79,"APATCH",$P(^PSB(53.79,PSBINDX,0),U),$P(^PSB(53.79,PSBINDX,0),U,6),PSBINDX)
"RTN","PSBML",163,0)
 S RESULTS(0)=1,RESULTS(1)="1^Data Successfully Filed^"_$S($G(PSBIEN(1))'="":$G(PSBIEN(1)),1:+$G(PSBIEN))
"RTN","PSBML",164,0)
 D BCBU  ;NatContng
"RTN","PSBML",165,0)
 I $G(PSBINST,0) S PSBAUD=$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:$P(PSBHDR,"^",1)) D AUDIT^PSBMLU(PSBAUD,"Instructor "_PSBINST(0)_" present.",PSBTRAN)
"RTN","PSBML",166,0)
 Q
"RTN","PSBML",167,0)
ERR(X,Y) ;
"RTN","PSBML",168,0)
 S X=$P("Business Logic Error^Data Validation Error",U,X)
"RTN","PSBML",169,0)
 S RESULTS($O(RESULTS(""),-1)+1)=X_": "_Y
"RTN","PSBML",170,0)
 Q
"RTN","PSBML",171,0)
COMMENT(DA,PSBCMT) ;
"RTN","PSBML",172,0)
 N PSBFDA,PSBIEN,PSBNOW
"RTN","PSBML",173,0)
 S PSBIEN="+1,"_DA_","
"RTN","PSBML",174,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBML",175,0)
 D VAL(53.793,PSBIEN,.01,PSBCMT)
"RTN","PSBML",176,0)
 S PSBFDA(53.793,PSBIEN,.02)=DUZ
"RTN","PSBML",177,0)
 S PSBFDA(53.793,PSBIEN,.03)=PSBNOW
"RTN","PSBML",178,0)
 D FILEIT
"RTN","PSBML",179,0)
 Q
"RTN","PSBML2")
0^20^B67471852^B77106883
"RTN","PSBML2",1,0)
PSBML2 ;BIRMINGHAM/TEJ-BCMA UTILITY TO EDIT THE PSB MED LOG  ;18 Apr 2005  10:13 AM
"RTN","PSBML2",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,18,22,23,13**;Mar 2004
"RTN","PSBML2",3,0)
 ;
"RTN","PSBML2",4,0)
 ; Reference/IA
"RTN","PSBML2",5,0)
 ; EN^PSJBCMA3/3320
"RTN","PSBML2",6,0)
 ; ENE^PSJBCMA4/3416
"RTN","PSBML2",7,0)
 ; ENR^PSJBCMA4/3416
"RTN","PSBML2",8,0)
 ;
"RTN","PSBML2",9,0)
 ;
"RTN","PSBML2",10,0)
EDIT ;
"RTN","PSBML2",11,0)
 K RESULTS S PSBEDIEN=PSBIEN_",",RESULTS(0)=0
"RTN","PSBML2",12,0)
 I $G(PSBREC(7))']"" S RESULTS(0)=1,RESULTS(1)="-1^Data NOT filed - Comment is required" Q
"RTN","PSBML2",13,0)
 D
"RTN","PSBML2",14,0)
 .S PSBEDTFL=1,PSBMODS=0,PSBREC(1)=""
"RTN","PSBML2",15,0)
 .D:PSBREC(4)]"" VAL^PSBML(53.79,PSBEDIEN,.06,PSBREC(4))
"RTN","PSBML2",16,0)
 .I (PSBREC(0)="N") D
"RTN","PSBML2",17,0)
 ..I ($$GET1^DIQ(53.79,PSBEDIEN,.11)["V") F PSBX=1:1:6 S PSBREC(PSBX)=""
"RTN","PSBML2",18,0)
 .I ("NHR"[PSBREC(0)),$D(^PSB(53.79,+PSBEDIEN,.2)) D
"RTN","PSBML2",19,0)
 ..; Audit PRN
"RTN","PSBML2",20,0)
 ..D:$P(^PSB(53.79,+PSBEDIEN,.2),U,2)]"" AUDIT^PSBUTL(+PSBEDIEN,53.79,.22,$P(^PSB(53.79,+PSBEDIEN,.2),U,2),"K")
"RTN","PSBML2",21,0)
 ..I ($P(^PSB(53.79,+PSBEDIEN,0),U,9)="G")!($P(^PSB(53.79,+PSBEDIEN,0),U,9)="I") D
"RTN","PSBML2",22,0)
 ...I $D(^PSB(53.79,"APRN",$P(^PSB(53.79,+PSBEDIEN,0),U,1),$P(^PSB(53.79,+PSBEDIEN,0),U,6),+PSBEDIEN)) D
"RTN","PSBML2",23,0)
 ....K ^PSB(53.79,"APRN",$P(^PSB(53.79,+PSBEDIEN,0),U,1),$P(^PSB(53.79,+PSBEDIEN,0),U,6),+PSBEDIEN) K ^PSB(53.79,+PSBEDIEN,.2)
"RTN","PSBML2",24,0)
 .I ("NHR"'[PSBREC(0)) D:$G(PSBREC(5))]"" VAL^PSBML(53.79,PSBEDIEN,.21,$G(PSBREC(5))) D:$G(PSBREC(6))]"" VAL^PSBML(53.79,PSBEDIEN,.22,$G(PSBREC(6)))
"RTN","PSBML2",25,0)
 .I +$G(RESULTS(0))<0 S RESULTS(1)="-1^Data NOT filed - "_$P(RESULTS(0),U,2),RESULTS(0)=1 Q
"RTN","PSBML2",26,0)
 .D:$D(^PSB(53.79,+PSBEDIEN,.2)) VAL^PSBML(53.79,PSBEDIEN,.21,$G(PSBREC(5))),VAL^PSBML(53.79,PSBEDIEN,.22,$G(PSBREC(6)))
"RTN","PSBML2",27,0)
 .D VAL^PSBML(53.793,"+2,"_PSBIEN,.01,PSBREC(7))
"RTN","PSBML2",28,0)
 .D VAL^PSBML(53.793,"+2,"_PSBIEN,.02,"`"_DUZ)
"RTN","PSBML2",29,0)
 .D VAL^PSBML(53.793,"+2,"_PSBIEN,.03,PSBNOW)
"RTN","PSBML2",30,0)
 Q:+$G(RESULTS(1))<0
"RTN","PSBML2",31,0)
 S PSBMODS=$$CHANGE^PSBML3(.PSBREC,PSBEDIEN)
"RTN","PSBML2",32,0)
 D:PSBMODS UPDATED
"RTN","PSBML2",33,0)
 D:('$G(PSBERR))&('$G(PSBMODS)) FILEIT^PSBML
"RTN","PSBML2",34,0)
 ; Audit DD
"RTN","PSBML2",35,0)
 I $D(PSBORDMD) S (PSBXY,PSBXZ)="" D
"RTN","PSBML2",36,0)
 .F  S PSBXY=$O(PSBORDMD(PSBXY)) Q:PSBXY=""  S PSBFDAX=$S(PSBXY=.6:53.796,PSBXY=.7:53.797,1:53.795) F  S PSBXZ=$O(PSBORDMD(PSBXY,PSBXZ)) Q:PSBXZ=""  D
"RTN","PSBML2",37,0)
 ..S PSBXACT="",PSBXACT=$G(PSBORDMD(PSBXY,PSBXZ,0))
"RTN","PSBML2",38,0)
 ..D:PSBXACT["ADD" AUDIT^PSBUTL(+PSBEDIEN,PSBFDAX,.01,PSBXZ,"S") D:PSBXACT["DELETE" AUDIT^PSBUTL(+PSBEDIEN,PSBFDAX,.01,PSBXZ,"K")
"RTN","PSBML2",39,0)
 ;
"RTN","PSBML2",40,0)
 K PSBORDMD,PSBCHNG,PSBDDX,PSBEDTFL,PSBEDIEN,PSBFILED
"RTN","PSBML2",41,0)
 Q
"RTN","PSBML2",42,0)
 ;
"RTN","PSBML2",43,0)
UPDATED ;
"RTN","PSBML2",44,0)
 N PSBADD
"RTN","PSBML2",45,0)
 S PSBIEN=PSBIEN_",",PSBXPTCH=0
"RTN","PSBML2",46,0)
 S PSBRECNO=$S(PSBEDTFL:8,1:4)
"RTN","PSBML2",47,0)
 I "^G^N^H^R^RM^S^C^I^M^"[(U_PSBREC(0)_U) D
"RTN","PSBML2",48,0)
 .D:('PSBEDTFL) VAL^PSBML(53.79,PSBIEN,.06,PSBNOW)
"RTN","PSBML2",49,0)
 .D:$D(PSBREC(4,0)) VAL^PSBML(53.79,PSBIEN,.06,PSBREC(4))
"RTN","PSBML2",50,0)
 .D VAL^PSBML(53.79,PSBIEN,.07,"`"_DUZ)
"RTN","PSBML2",51,0)
 .D:('PSBEDTFL)!($G(PSBREC(0,0))) VAL^PSBML(53.79,PSBIEN,.09,PSBREC(0))
"RTN","PSBML2",52,0)
 .I $G(PSBREC(3))]"" D VAL^PSBML(53.79,PSBIEN,.26,PSBREC(3))
"RTN","PSBML2",53,0)
 I $D(PSBREC(PSBRECNO)) D:($G(PSBREC(0))="G")&($P(PSBREC(PSBRECNO),U,5)["PATCH")  Q:+$G(RESULTS(1))<0
"RTN","PSBML2",54,0)
 .Q:$$GET1^DIQ(53.79,PSBIEN,.09,"I")=""
"RTN","PSBML2",55,0)
 .S PSBXDFN=$$GET1^DIQ(53.79,PSBIEN,.01,"I")
"RTN","PSBML2",56,0)
 .S PSBXORN=$$GET1^DIQ(53.79,+PSBIEN,.11,"I")
"RTN","PSBML2",57,0)
 .S PSBXDT="" F  S PSBXDT=$O(^PSB(53.79,"AORDX",PSBXDFN,PSBXORN,PSBXDT)) Q:PSBXDT=""  D  Q:+$G(RESULTS(1))<0
"RTN","PSBML2",58,0)
 ..S PSBYZ="" F  S PSBYZ=$O(^PSB(53.79,"AORDX",PSBXDFN,PSBXORN,PSBXDT,PSBYZ)) Q:'PSBYZ  I ($$GET1^DIQ(53.79,PSBYZ,.09,"I")="G"),(PSBYZ'=+PSBIEN) S RESULTS(0)=1,RESULTS(1)="-1^Previous Patch has not been removed. Administration canceled." Q
"RTN","PSBML2",59,0)
 D:$G(PSBREC(0))="N"
"RTN","PSBML2",60,0)
 .I (PSBREC(0)="N"),($$GET1^DIQ(53.79,+PSBIEN,.09,"I")="G") S PSBREC(1)="Undo Given: "_$G(PSBREC(1))
"RTN","PSBML2",61,0)
 .I ((PSBREC(0)="N")!(PSBREC(0)="G")),($$GET1^DIQ(53.79,+PSBIEN,.09,"I")="RM") S PSBREC(1)="Undo Remove: "_$G(PSBREC(1))
"RTN","PSBML2",62,0)
 .; Undo PRN
"RTN","PSBML2",63,0)
 .I $D(^PSB(53.79,+PSBIEN,.2)) D
"RTN","PSBML2",64,0)
 ..D:$P(^PSB(53.79,+PSBIEN,.2),U,2)]"" AUDIT^PSBUTL(+PSBIEN,53.79,.22,$P(^PSB(53.79,+PSBIEN,.2),U,2),"K")
"RTN","PSBML2",65,0)
 ..I ($P(^PSB(53.79,+PSBIEN,0),U,9)="G")!($P(^PSB(53.79,+PSBIEN,0),U,9)="I") K ^PSB(53.79,"APRN",$P(^PSB(53.79,+PSBIEN,0),U,1),$P(^PSB(53.79,+PSBIEN,0),U,6),+PSBIEN),^PSB(53.79,+PSBIEN,.2)
"RTN","PSBML2",66,0)
 D:$G(PSBREC(1))]""
"RTN","PSBML2",67,0)
 .S:PSBREC(0)="H" PSBREC(1)="Held: "_PSBREC(1)
"RTN","PSBML2",68,0)
 .S:PSBREC(0)="R" PSBREC(1)="Refused: "_PSBREC(1)
"RTN","PSBML2",69,0)
 .S:PSBREC(0)="RM" PSBREC(1)="Removed: "_PSBREC(1)
"RTN","PSBML2",70,0)
 .I $D(PSBFDA(53.793,"+2,"_PSBIEN,.01)) S PSBREC(1)=PSBREC(1)_(PSBFDA(53.793,"+2,"_PSBIEN,.01))
"RTN","PSBML2",71,0)
 .D VAL^PSBML(53.793,"+2,"_PSBIEN,.01,PSBREC(1)),VAL^PSBML(53.793,"+2,"_PSBIEN,.02,"`"_DUZ),VAL^PSBML(53.793,"+2,"_PSBIEN,.03,PSBNOW)
"RTN","PSBML2",72,0)
 S PSBXDFN=$$GET1^DIQ(53.79,PSBIEN,.01,"I")
"RTN","PSBML2",73,0)
 I ($$GET1^DIQ(53.79,+PSBIEN,.09,"I")="RM"),((PSBREC(0)="N")!(PSBREC(0)="G")) D
"RTN","PSBML2",74,0)
 .I '(($D(^XUSEC("PSB MANAGER",DUZ)))!($$GET1^DIQ(53.79,+PSBIEN,.07,"I")=DUZ)) S RESULTS(0)=1,RESULTS(1)="-1^Verify PSB MANAGER allocation" Q
"RTN","PSBML2",75,0)
 .S PSBXPTCH=1,PSBYY="",PSBGIVEN=0 F  S PSBYY=$O(^PSB(53.79,+PSBIEN,.9,PSBYY),-1) Q:'PSBYY  Q:(+$G(RESULTS(0))<0)  Q:PSBGIVEN  S PSBXDAT=$G(^(PSBYY,0))  D
"RTN","PSBML2",76,0)
 ..I PSBXDAT["ACTION STATUS 'GIVEN'" D
"RTN","PSBML2",77,0)
 ...S PSBXDATE=$P(^PSB(53.79,+PSBIEN,.9,PSBYY,0),U)
"RTN","PSBML2",78,0)
 ...S PSBXORN=$$GET1^DIQ(53.79,+PSBIEN,.11,"I")
"RTN","PSBML2",79,0)
 ...S PSBYX=(PSBYY-2) I (PSBYX)>0 I ^PSB(53.79,+PSBIEN,.9,PSBYX,0)["ACTION DATE/TIME '" S PSBXDATE=$P(^PSB(53.79,+PSBIEN,.9,PSBYX,0),"'",2),X=$P(PSBXDATE,"@"),%DT="" D ^%DT S PSBXDATE=Y_"."_$TR($P(PSBXDATE,"@",2),":")
"RTN","PSBML2",80,0)
 ...S PSBXDT="" F  S PSBXDT=$O(^PSB(53.79,"AORDX",PSBXDFN,PSBXORN,PSBXDT)) Q:PSBXDT=""  D  Q:+$G(RESULTS(1))<0
"RTN","PSBML2",81,0)
 ....S PSBYZ="" F  S PSBYZ=$O(^PSB(53.79,"AORDX",PSBXDFN,PSBXORN,PSBXDT,PSBYZ)) Q:'PSBYZ  I ($$GET1^DIQ(53.79,PSBYZ,.09,"I")="G"),(PSBYZ'=+PSBIEN) S RESULTS(0)=1,RESULTS(1)="-1^Cannot UNDO! Order has GIVEN patch" Q
"RTN","PSBML2",82,0)
 ...I '(+$G(RESULTS(1))<0) D  S PSBGIVEN=1
"RTN","PSBML2",83,0)
 ....D VAL^PSBML(53.79,PSBIEN,.06,PSBXDATE),VAL^PSBML(53.79,PSBIEN,.07,"`"_$P(PSBXDAT,U,2)),VAL^PSBML(53.79,PSBIEN,.09,"G")
"RTN","PSBML2",84,0)
 ..D:('(+$G(RESULTS(1))<0))&('PSBGIVEN)&($G(PSBXPTCH))&(PSBYY'>1)
"RTN","PSBML2",85,0)
 ...S PSBXDATE=$P(^PSB(53.79,+PSBIEN,.9,PSBYY,0),"'",2),X=$P(PSBXDATE,"@"),%DT="" D ^%DT S PSBXDATE=Y_"."_$TR($P(PSBXDATE,"@",2),":")
"RTN","PSBML2",86,0)
 ...D VAL^PSBML(53.79,PSBIEN,.06,PSBXDATE),VAL^PSBML(53.79,PSBIEN,.07,"`"_$$GET1^DIQ(53.79,+PSBIEN,.07,"I")),VAL^PSBML(53.79,PSBIEN,.09,"G") S PSBGIVEN=1
"RTN","PSBML2",87,0)
 Q:(+$G(RESULTS(1))<0)
"RTN","PSBML2",88,0)
 I PSBEDTFL,$G(PSBGIVEN),PSBXPTCH S PSBREC(0)="G",PSBUNTSG=$P(PSBREC(8),U,4) D VAL^PSBML(53.795,(1_","_PSBIEN),.03,$S(PSBUNTSG'=0:PSBUNTSG,1:1)) K PSBXPTCH
"RTN","PSBML2",89,0)
 I $G(PSBREC(2))]"" D VAL^PSBML(53.79,PSBIEN,.16,PSBREC(2))
"RTN","PSBML2",90,0)
 S PSBOLDUZ=$P(^PSB(53.79,+PSBIEN,0),U,7),PSBOLSTS=$P(^PSB(53.79,+PSBIEN,0),U,9)
"RTN","PSBML2",91,0)
 I $G(PSBREC(PSBRECNO))]"" D  ; DD/SOL/ADD
"RTN","PSBML2",92,0)
 .I PSBREC(0)="G"!(PSBREC(0)="I")!(PSBREC(0)="H")!(PSBREC(0)="R")!(PSBREC(0)="M") D  ; Only if gvn or infus
"RTN","PSBML2",93,0)
 ..Q:(PSBEDTFL)&('$G(PSBCHNG))
"RTN","PSBML2",94,0)
 ..F PSBCNT=PSBRECNO:1 Q:'$D(PSBREC(PSBCNT))  D
"RTN","PSBML2",95,0)
 ...S Y=$P(PSBREC(PSBCNT),U)
"RTN","PSBML2",96,0)
 ...S PSBDD=$S(Y="DD":53.795,Y="ADD":53.796,Y="SOL":53.797,1:0)
"RTN","PSBML2",97,0)
 ...Q:'PSBDD
"RTN","PSBML2",98,0)
 ...I $G(PSBCHNG) D
"RTN","PSBML2",99,0)
 ....I $D(PSBFIND(PSBCNT)) S PSBIENS=$QS($Q(PSBFIND(PSBCNT)),2)_","_PSBIEN
"RTN","PSBML2",100,0)
 ....I '$D(PSBFIND(PSBCNT)) S PSBIENS="+1,"_PSBIEN
"RTN","PSBML2",101,0)
 ....D VAL^PSBML(PSBDD,PSBIENS,.01,"`"_$P(PSBREC(PSBCNT),U,2))
"RTN","PSBML2",102,0)
 ....D VAL^PSBML(PSBDD,PSBIENS,.02,$P(PSBREC(PSBCNT),U,3))
"RTN","PSBML2",103,0)
 ....D VAL^PSBML(PSBDD,PSBIENS,.03,$P(PSBREC(PSBCNT),U,4))
"RTN","PSBML2",104,0)
 ....D:Y="DD" VAL^PSBML(PSBDD,PSBIENS,.04,$P(PSBREC(PSBCNT),U,5))
"RTN","PSBML2",105,0)
 .I ('PSBEDTFL)!((PSBREC(0)'="G")&($$GET1^DIQ(53.79,PSBIEN,.09,"I")="G")) D
"RTN","PSBML2",106,0)
 ..S (PSBDCNT,PSBACNT,PSBSCNT)=0,PSBADD=3 F PSBCNT=PSBRECNO:1 Q:'$D(PSBREC(PSBCNT))  D
"RTN","PSBML2",107,0)
 ...S Y=$P(PSBREC(PSBCNT),U)
"RTN","PSBML2",108,0)
 ...S PSBDD=$S(Y="DD":53.795,Y="ADD":53.796,Y="SOL":53.797,1:0)
"RTN","PSBML2",109,0)
 ...Q:'PSBDD
"RTN","PSBML2",110,0)
 ...S @("PSB"_$E(Y)_"CNT")=@("PSB"_$E(Y)_"CNT")+1
"RTN","PSBML2",111,0)
 ...S PSBIENS=(@("PSB"_$E(Y)_"CNT"))_","_PSBIEN
"RTN","PSBML2",112,0)
 ...I '$$GET1^DIQ(PSBDD,PSBIENS,.01,"I") S PSBIENS="+"_PSBADD_","_PSBIEN,PSBADD=PSBADD+1
"RTN","PSBML2",113,0)
 ...D VAL^PSBML(PSBDD,PSBIENS,.01,"`"_$P(PSBREC(PSBCNT),U,2))
"RTN","PSBML2",114,0)
 ...D VAL^PSBML(PSBDD,PSBIENS,.02,$P(PSBREC(PSBCNT),U,3))
"RTN","PSBML2",115,0)
 ...D:Y="DD" VAL^PSBML(PSBDD,PSBIENS,.03,$S(PSBREC(0)="G"!(PSBREC(0)="RM"):$P(PSBREC(PSBCNT),U,4),1:0)),VAL^PSBML(PSBDD,PSBIENS,.04,$P(PSBREC(PSBCNT),U,5))
"RTN","PSBML2",116,0)
 I ($G(PSBREC(PSBRECNO))']""),(PSBREC(0)="N"),($$GET1^DIQ(53.79,PSBIEN,.09,"I")="G") D
"RTN","PSBML2",117,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,+PSBIEN,.5,PSBX)) Q:'+PSBX  D VAL^PSBML(53.795,(PSBX_","_PSBIEN),.03,0)
"RTN","PSBML2",118,0)
 D FILEIT^PSBML
"RTN","PSBML2",119,0)
 I $P($G(RESULTS(1)),U,1)=1 D
"RTN","PSBML2",120,0)
 .S PSBUID=$P(^PSB(53.79,+PSBIEN,0),U,10) I PSBUID]"",PSBUID'["WS" D
"RTN","PSBML2",121,0)
 ..S PSBTS=PSBREC(0)
"RTN","PSBML2",122,0)
 ..S PSBON=$P(^PSB(53.79,+PSBIEN,.1),U,1)
"RTN","PSBML2",123,0)
 ..S PSBDFN=$P(^PSB(53.79,+PSBIEN,0),U,1)
"RTN","PSBML2",124,0)
 ..I PSBREC(0)="N" S PSBTS="" D
"RTN","PSBML2",125,0)
 ...M PSBAR=^PSB(53.79,+PSBIEN,.9)
"RTN","PSBML2",126,0)
 ...S (PSBDN,X)="" F  S X=$O(PSBAR(X),-1) Q:X=0!(PSBDN=1)  D
"RTN","PSBML2",127,0)
 ....I PSBAR(X,0)["ACTION STATUS",PSBAR(X,0)["deleted",PSBAR(X,0)'["GIVEN" D
"RTN","PSBML2",128,0)
 .....S PSBTS=$P($P(PSBAR(X,0),"'",2),"'",1)
"RTN","PSBML2",129,0)
 .....S PSBTS=$S(PSBTS="HELD":"H",PSBTS="REFUSED":"R",PSBTS="REMOVED":"RM",PSBTS="MISSING":"M",1:""),PSBDN=1
"RTN","PSBML2",130,0)
 ...D VAL^PSBML(53.79,PSBIEN,.26,"") D CLEAN^DILF,UPDATE^DIE("","PSBFDA","PSBIEN","PSBMSG")
"RTN","PSBML2",131,0)
 ..D EN^PSJBCMA3(PSBDFN,+PSBON,PSBUID,PSBTS,PSBNOW)
"RTN","PSBML2",132,0)
 I ($$GET1^DIQ(53.79,+PSBIEN,.12,"I")="O")&($$GET1^DIQ(53.79,+PSBIEN,.09,"I")="N") S PSBDFN=$$GET1^DIQ(53.79,+PSBIEN,.01,"I") D ENR^PSJBCMA4(PSBDFN,$$GET1^DIQ(53.79,+PSBIEN,.11))
"RTN","PSBML2",133,0)
 I ($$GET1^DIQ(53.79,+PSBIEN,.12,"I")="O")&($$GET1^DIQ(53.79,+PSBIEN,.09,"I")="G") S PSBDFN=$$GET1^DIQ(53.79,+PSBIEN,.01,"I") D ENE^PSJBCMA4(PSBDFN,$$GET1^DIQ(53.79,+PSBIEN,.11))
"RTN","PSBML2",134,0)
 I (PSBREC(0)="N")&($$GET1^DIQ(53.79,+PSBIEN,.09,"I")="N") D NGRESET^PSBML3(.PSBREC,PSBIEN)
"RTN","PSBML2",135,0)
 Q
"RTN","PSBML2",136,0)
 ;
"RTN","PSBML3")
0^25^B40505286^B28789738
"RTN","PSBML3",1,0)
PSBML3 ;BIRMINGHAM/TEJ-BCMA UTILITY TO EDIT THE PSB MED LOG  ;Mar 2004
"RTN","PSBML3",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,13**;Mar 2004
"RTN","PSBML3",3,0)
 ;
"RTN","PSBML3",4,0)
 ; Reference/IA
"RTN","PSBML3",5,0)
 ; $$GET1^DIQ/2056
"RTN","PSBML3",6,0)
 ;
"RTN","PSBML3",7,0)
APATCH ; Maintain "APATCH" index...
"RTN","PSBML3",8,0)
 I $G(PSBTRAN)["MEDPASS" D:$P(PSBREC(9),U)="UDTAB"  Q
"RTN","PSBML3",9,0)
 .S PSBX1=9,PSBQUT=0 F  S PSBX1=$O(PSBREC(PSBX1))  Q:PSBQUT  Q:'(+PSBX1)  D:$P(PSBREC(PSBX1),U)="DD"&($P(PSBREC(PSBX1),U,5)="PATCH")  Q:PSBQUT
"RTN","PSBML3",10,0)
 ..I $G(PSBOLSTS)="",PSBREC(3)="G" S PSB1="I $D(PSBIEN(1)) S ^PSB(53.79,""APATCH"","_$G(PSBREC(0))_","_$G(PSBNOW)_",+PSBIEN(1))="""""
"RTN","PSBML3",11,0)
 ..S PSBQUT=1
"RTN","PSBML3",12,0)
 S PSBX1=0 F  S PSBX1=$O(^PSB(53.79,+PSBIEN,.5,PSBX1)) Q:'(+PSBX1)  Q
"RTN","PSBML3",13,0)
 I $G(PSBTRAN)["UPDATE",(+PSBX1)'=0 D
"RTN","PSBML3",14,0)
 .S PSBX3=0 F  S PSBX3=$O(^PSB(53.79,+PSBIEN,.5,PSBX3)) Q:+PSBX3=0  I $P(^PSB(53.79,+PSBIEN,.5,PSBX3,0),U,4)="PATCH" D
"RTN","PSBML3",15,0)
 ..I PSBOLSTS="G",PSBREC(0)="N" S PSB1="K ^PSB(53.79,""APATCH"","_$P(^PSB(53.79,+PSBIEN,0),U)_","_$P(^PSB(53.79,+PSBIEN,0),U,6)_","_+PSBIEN_")"
"RTN","PSBML3",16,0)
 ..I PSBFDA(53.79,+PSBIEN_",",.09)="G" S PSB1="S ^PSB(53.79,""APATCH"","_$P(^PSB(53.79,+PSBIEN,0),U)_","_$G(PSBFDA(53.79,+PSBIEN_",",.06))_","_+PSBIEN_")"_"="""""
"RTN","PSBML3",17,0)
 I $G(PSBTRAN)["EDIT",(+PSBX1)'=0 D
"RTN","PSBML3",18,0)
 .S PSBX3=0 F  S PSBX3=$O(^PSB(53.79,+PSBIEN,.5,PSBX3)) Q:+PSBX3=0  I $P(^PSB(53.79,+PSBIEN,.5,PSBX3,0),U,4)="PATCH",((PSBREC(0)="G")!(PSBREC(0)="RM")) D
"RTN","PSBML3",19,0)
 ..S PSB1="S ^PSB(53.79,""APATCH"","_$P(^PSB(53.79,+PSBIEN,0),U)_","_$G(PSBFDA(53.79,+PSBIEN_",",.06))_","_+PSBIEN_")"_"="""""
"RTN","PSBML3",20,0)
 ..I $D(PSBREC(4,0)) S PSB2="K ^PSB(53.79,""APATCH"","_$P(^PSB(53.79,+PSBIEN,0),U)_","_$G(PSBREC(4,0))_","_+PSBIEN_")"
"RTN","PSBML3",21,0)
 Q
"RTN","PSBML3",22,0)
 ;
"RTN","PSBML3",23,0)
CHANGE(PSBREC,PSBEDIEN) ;Determine an order edit
"RTN","PSBML3",24,0)
 S PSBCHNG=0
"RTN","PSBML3",25,0)
 K PSBORDMD,PSBDDX
"RTN","PSBML3",26,0)
 I PSBREC(0)'=$$GET1^DIQ(53.79,PSBEDIEN,.09,"I") S PSBREC(0,0)=1,PSBCHNG=1
"RTN","PSBML3",27,0)
 I PSBREC(2)'=$$GET1^DIQ(53.79,PSBEDIEN,.16,"I") S PSBREC(2,0)=1,PSBCHNG=1
"RTN","PSBML3",28,0)
 I PSBREC(4)'=$$GET1^DIQ(53.79,PSBEDIEN,.06,"I") S PSBREC(4,0)=$$GET1^DIQ(53.79,PSBEDIEN,.06,"I"),PSBCHNG=1
"RTN","PSBML3",29,0)
 I PSBREC(5)'=$$GET1^DIQ(53.79,PSBEDIEN,.21) S PSBREC(5,0)=1,PSBCHNG=1
"RTN","PSBML3",30,0)
 I PSBREC(6)'=$$GET1^DIQ(53.79,PSBEDIEN,.22) S PSBREC(6,0)=1,PSBCHNG=1
"RTN","PSBML3",31,0)
 K PSBFIND,PSBFOUN,PSBREC2
"RTN","PSBML3",32,0)
 F PSBRECNX=8:1 Q:'$D(PSBREC(PSBRECNX))  S PSBDPTR=$P(PSBREC(PSBRECNX),U,2),PSBORDMD(PSBRECNX,PSBDPTR,0)="ADDED"
"RTN","PSBML3",33,0)
 F PSBDDX=.5,.6,.7 D:$D(^PSB(53.79,+PSBEDIEN,PSBDDX,"B"))
"RTN","PSBML3",34,0)
 .S PSBDPTR="" F  S PSBDPTR=$O(^PSB(53.79,+PSBEDIEN,PSBDDX,"B",PSBDPTR)) Q:+PSBDPTR'>0  D
"RTN","PSBML3",35,0)
 ..S PSBXX=0 F  S PSBXX=$O(^PSB(53.79,+PSBEDIEN,PSBDDX,"B",PSBDPTR,PSBXX)) Q:+PSBXX'>0  D  Q:'$$FINDDD^PSBML3(PSBDDX,PSBDPTR)
"RTN","PSBML3",36,0)
 ...I '$D(PSBFOUN(PSBDDX,PSBXX)) F PSBRECNX=8:1 Q:'$D(PSBREC(PSBRECNX))  D:$D(PSBORDMD(PSBRECNX))  Q:$D(PSBFOUN(PSBDDX,PSBXX))
"RTN","PSBML3",37,0)
 ....S PSBDFDA=$P(PSBREC(PSBRECNX),U) Q:$S(PSBDFDA="DD":.5,PSBDFDA="ADD":.6,PSBDFDA="SOL":.7)'=PSBDDX
"RTN","PSBML3",38,0)
 ....S PSBDATAX=PSBDFDA_"^"_$G(^PSB(53.79,+PSBEDIEN,PSBDDX,PSBXX,0))_$S(PSBDDX'=.5:"^",1:"")
"RTN","PSBML3",39,0)
 ....I PSBDATAX[PSBREC(PSBRECNX) K PSBORDMD(PSBRECNX),PSBREC2(PSBRECNX) S (PSBFIND(PSBRECNX,PSBXX),PSBFOUN(PSBDDX,PSBXX))=1 Q
"RTN","PSBML3",40,0)
 ....S PSBUNTOR=$P(PSBDATAX,U,3),PSBUNTGN=$P(PSBDATAX,U,4),PSBUNTAD=$P(PSBDATAX,U,5)
"RTN","PSBML3",41,0)
 ....I PSBREC(PSBRECNX)[(PSBDFDA_"^"_PSBDPTR_"^"_PSBUNTOR_"^") S PSBREC2(PSBRECNX)=PSBREC(PSBRECNX)
"RTN","PSBML3",42,0)
 D:$D(PSBREC2)
"RTN","PSBML3",43,0)
 .F PSBDDX=.5,.6,.7 D:$D(^PSB(53.79,+PSBEDIEN,PSBDDX,"B"))
"RTN","PSBML3",44,0)
 ..S PSBDPTR="" F  S PSBDPTR=$O(^PSB(53.79,+PSBEDIEN,PSBDDX,"B",PSBDPTR)) Q:+PSBDPTR'>0  D
"RTN","PSBML3",45,0)
 ...S PSBXX=0 F  S PSBXX=$O(^PSB(53.79,+PSBEDIEN,PSBDDX,"B",PSBDPTR,PSBXX)) Q:+PSBXX'>0  D
"RTN","PSBML3",46,0)
 ....S PSBREC2X=0 F  S PSBREC2X=$O(PSBREC2(PSBREC2X)) Q:PSBREC2X=""  D  Q:$G(PSBFOUN(PSBDDX,PSBXX))
"RTN","PSBML3",47,0)
 .....S PSBDFDA=$P(PSBREC(PSBREC2X),U) Q:$S(PSBDFDA="DD":.5,PSBDFDA="ADD":.6,PSBDFDA="SOL":.7)'=PSBDDX
"RTN","PSBML3",48,0)
 .....S PSBDATAX=PSBDFDA_"^"_$G(^PSB(53.79,+PSBEDIEN,PSBDDX,PSBXX,0))
"RTN","PSBML3",49,0)
 .....I PSBDATAX[PSBREC(PSBREC2X) K PSBREC2(PSBREC2X),PSBORDMD(PSBREC2X) S (PSBFIND(PSBREC2X,PSBXX),PSBFOUN(PSBDDX,PSBXX))=1 Q
"RTN","PSBML3",50,0)
 .....S PSBUNTOR=$P(PSBDATAX,U,3),PSBUNTGN=$P(PSBDATAX,U,4),PSBUNTAD=$P(PSBDATAX,U,5)
"RTN","PSBML3",51,0)
 .....I PSBREC2(PSBREC2X)[(PSBDFDA_"^"_PSBDPTR_"^"_PSBUNTOR_"^") I '$D(PSBFOUN(PSBDDX,PSBXX)) S (PSBCHNG,PSBFIND(PSBREC2X,PSBXX),PSBFOUN(PSBDDX,PSBXX))=1 D  Q
"RTN","PSBML3",52,0)
 ......N PSBY,Y F Y=4,5 S PSBY=$P(PSBREC2(PSBREC2X),U,Y) S:PSBY'=$S(Y=4:PSBUNTGN,Y=5:PSBUNTAD) PSBORDMD(PSBREC2X,PSBDPTR,0)=""
"RTN","PSBML3",53,0)
 ; Modify FDA per Deleted DDs
"RTN","PSBML3",54,0)
 ;
"RTN","PSBML3",55,0)
 F PSBX=.5,.6,.7 S PSBXX="" F  Q:'$D(PSBORDMD(PSBX))  S PSBXX=$O(PSBORDMD(PSBX,PSBXX)) Q:$G(PSBXX)=""  D:PSBORDMD(PSBX,PSBXX,0)["DELETE"
"RTN","PSBML3",56,0)
 .S PSBDDX=$S(PSBX=.5:53.795,PSBX=.6:53.796,1:53.797)
"RTN","PSBML3",57,0)
 .S PSBIENX="^PSB(53.79,"_($G(PSBEDIEN))_($G(PSBX))_",""B"","_PSBXX_")"
"RTN","PSBML3",58,0)
 .S PSBIENX=$Q(@PSBIENX),PSBIENX=$QS(PSBIENX,6)_","_(+PSBEDIEN)
"RTN","PSBML3",59,0)
 .D:'$D(PSBFOUN(PSBDDX,+PSBIENX)) VAL^PSBML(PSBDDX,PSBIENX,.01,""),VAL^PSBML(PSBDDX,PSBIENX,.02,""),VAL^PSBML(PSBDDX,PSBIENX,.03,""),VAL^PSBML(PSBDDX,PSBIENX,.04,"")
"RTN","PSBML3",60,0)
 ;
"RTN","PSBML3",61,0)
 S:$D(PSBORDMD) PSBCHNG=1 K PSBREC2
"RTN","PSBML3",62,0)
 Q PSBCHNG
"RTN","PSBML3",63,0)
 ;
"RTN","PSBML3",64,0)
NGRESET(PSBREC,PSBREIEN) ;
"RTN","PSBML3",65,0)
 ;
"RTN","PSBML3",66,0)
 ; Acknowledged "UNDO" - reinstate previous status and state...
"RTN","PSBML3",67,0)
 ;
"RTN","PSBML3",68,0)
 I (PSBREC(0)="N")&($$GET1^DIQ(53.79,PSBREIEN,.09,"I")="N") D  I '$D(PSBQUITX)  S PSBREINT=$$GET1^DIQ(53.79,PSBREIEN,.05,"I")
"RTN","PSBML3",69,0)
 .S PSBRESET="NOT GIVEN",PSBX="B" K PSBQUITX,PSBREXDT,PSBREINT F  S PSBX=$O(^PSB(53.79,+PSBREIEN,.9,PSBX),-1) Q:PSBX'>0  D  Q:($G(PSBQUITX))!(PSBX'>0)
"RTN","PSBML3",70,0)
 ..I (^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["ACTION STATUS Set to") Q
"RTN","PSBML3",71,0)
 ..I $P(^PSB(53.79,+PSBREIEN,.9,PSBX,0),U,4)=PSBRESET D  Q:$G(PSBQUITX)  Q:PSBX'>0
"RTN","PSBML3",72,0)
 ...S PSBREXDT=$P(^PSB(53.79,+PSBREIEN,.9,PSBX,0),U)
"RTN","PSBML3",73,0)
 ...F  S PSBX=$O(^PSB(53.79,+PSBREIEN,.9,PSBX),-1) Q:PSBX'>0  D  Q:$G(PSBQUITX)
"RTN","PSBML3",74,0)
 ....I (^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["ACTION STATUS")!(^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["deleted") Q
"RTN","PSBML3",75,0)
 ....I $P(^PSB(53.79,+PSBREIEN,.9,PSBX,0),"'",2)'="GIVEN" Q 
"RTN","PSBML3",76,0)
 ....F  S PSBX=$O(^PSB(53.79,+PSBREIEN,.9,PSBX),-1) Q:(PSBX'>0)!($G(PSBQUITX))  D  Q:$G(PSBQUIT)
"RTN","PSBML3",77,0)
 .....I (^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["ACTION STATUS ")!(^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["deleted") Q
"RTN","PSBML3",78,0)
 .....S PSBRESET=$P(^PSB(53.79,+PSBREIEN,.9,PSBX,0),"'",2) I (PSBRESET="GIVEN")!(PSBRESET="REMOVED") Q
"RTN","PSBML3",79,0)
 .....S PSBREXDT=$$GET1^DIQ(53.79,PSBREIEN,.04,"I"),PSBX=PSBX-2 I '$D(^PSB(53.79,+PSBREIEN,.9,PSBX,0)) S PSBQUIT=1 Q
"RTN","PSBML3",80,0)
 .....I (^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["ACTION DATE/TIME")!(^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["deleted") S PSBQUIT=1 Q
"RTN","PSBML3",81,0)
 .....S PSBREXDT=$P(^PSB(53.79,+PSBREIEN,.9,PSBX,0),"'",2),X=$P(PSBREXDT,"@"),%DT="" D ^%DT S PSBREXDT=Y_"."_$TR($P(PSBREXDT,"@",2),":"),PSBQUIT=1
"RTN","PSBML3",82,0)
 I $D(PSBREINT),$D(PSBREXDT),($D(PSBRESET)&($G(PSBRESET)'="GIVEN")) D
"RTN","PSBML3",83,0)
 .D VAL^PSBML(53.79,PSBREIEN,.06,PSBREXDT)
"RTN","PSBML3",84,0)
 .D VAL^PSBML(53.79,PSBREIEN,.09,PSBRESET)
"RTN","PSBML3",85,0)
 .D:$D(PSBREINT) VAL^PSBML(53.79,PSBREIEN,.07,"`"_PSBREINT)
"RTN","PSBML3",86,0)
 .D:'$G(PSBERR) FILEIT^PSBML
"RTN","PSBML3",87,0)
 K PSBXXX,PSBRESET,PSBREXDT,PSBREINT,PSBQUITX
"RTN","PSBML3",88,0)
 Q
"RTN","PSBML3",89,0)
 ;
"RTN","PSBML3",90,0)
FINDDD(PSBDDXX,PSBDDPTR) ;
"RTN","PSBML3",91,0)
 ;
"RTN","PSBML3",92,0)
 ;  Determine if edit - 'change' is deleted DDrug 
"RTN","PSBML3",93,0)
 ;
"RTN","PSBML3",94,0)
 S FINDDD=0
"RTN","PSBML3",95,0)
 I $D(PSBREC(8)) D
"RTN","PSBML3",96,0)
 .F PSBINDX=8:1 Q:'$D(PSBREC(PSBINDX))  S PSBCOMPX=$G(PSBREC(PSBINDX)) D  Q:FINDDD
"RTN","PSBML3",97,0)
 ..I ($S(PSBDDXX=.5:"DD",PSBDDXX=.6:"ADD",PSBDDXX=.7:"SOL",1:"")=$P(PSBCOMPX,U)),(PSBDDPTR=$P(PSBCOMPX,U,2)) S FINDDD=1
"RTN","PSBML3",98,0)
 I 'FINDDD S PSBORDMD(PSBDDXX,PSBDDPTR,0)="DELETED"
"RTN","PSBML3",99,0)
 Q FINDDD
"RTN","PSBML3",100,0)
 ;
"RTN","PSBMLEN1")
0^24^B45353757^B44879194
"RTN","PSBMLEN1",1,0)
PSBMLEN1 ;BIRMINGHAM/EFC-BCMA MEDICATION LOG FUNCTIONS ;Mar 2004
"RTN","PSBMLEN1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,4,9,11,13**;Mar 2004
"RTN","PSBMLEN1",3,0)
 ;
"RTN","PSBMLEN1",4,0)
 ; Reference/IA
"RTN","PSBMLEN1",5,0)
 ; ENE^PSJBCMA4/3416
"RTN","PSBMLEN1",6,0)
 ; ^XUSEC/10076
"RTN","PSBMLEN1",7,0)
 ; HLP^DDSUTL/10150
"RTN","PSBMLEN1",8,0)
 ;
"RTN","PSBMLEN1",9,0)
NEW(Y) ; Create the new entry
"RTN","PSBMLEN1",10,0)
 N PSBREC,PSB,PSBADST,PSBFREQ
"RTN","PSBMLEN1",11,0)
 S PSBMMEN=1
"RTN","PSBMLEN1",12,0)
 W @IOF D CLEAN^PSBVT,PSJ1^PSBVT(DFN,Y)
"RTN","PSBMLEN1",13,0)
 D NOW^%DTC
"RTN","PSBMLEN1",14,0)
 I PSBOSP<% D  Q:%'=1
"RTN","PSBMLEN1",15,0)
 .W @IOF,$C(7)
"RTN","PSBMLEN1",16,0)
 .W !,"NOTICE: This order is NOT currently active."
"RTN","PSBMLEN1",17,0)
 .W !,"        Are You Sure You Want To Continue"
"RTN","PSBMLEN1",18,0)
 .S %=2 D YN^DICN
"RTN","PSBMLEN1",19,0)
 I PSBADST="" S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX),PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBDT)
"RTN","PSBMLEN1",20,0)
 E  K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBMLEN1",21,0)
 S PSBODSCH=0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODSCH=1
"RTN","PSBMLEN1",22,0)
 W !,"Order:       ",PSBONX
"RTN","PSBMLEN1",23,0)
 W !,"Medication:  ",PSBOITX
"RTN","PSBMLEN1",24,0)
 W !,"Dosage:      ",PSBDOSE
"RTN","PSBMLEN1",25,0)
 W !,"Schedule:    ",PSBSCH
"RTN","PSBMLEN1",26,0)
 W !,"Admin Times: ",$S(PSBODSCH:"(Odd Sched.)",1:PSBADST)
"RTN","PSBMLEN1",27,0)
 I $D(^XUSEC("PSB READ ONLY",DUZ)) D  Q
"RTN","PSBMLEN1",28,0)
 .W !!,"Medications CANNOT be administered while in PSB READ ONLY mode.",!! R "Press ENTER KEY to continue. ",PSBCNTNU:5
"RTN","PSBMLEN1",29,0)
 W !!,"Is this the correct Order" S %=1 D YN^DICN Q:%'=1
"RTN","PSBMLEN1",30,0)
 ;
"RTN","PSBMLEN1",31,0)
 ; PRN, One-Time, On Call orders
"RTN","PSBMLEN1",32,0)
 ;
"RTN","PSBMLEN1",33,0)
 I PSBSCHT'="C" D
"RTN","PSBMLEN1",34,0)
 .D VAL^PSBMLVAL(.PSB,DFN,+PSBONX,$E(PSBONX,$L(PSBONX)))
"RTN","PSBMLEN1",35,0)
 .I PSBSCHT="P",($D(PSB(1))) W !!,"Brief Administration History:  ",! S X=$O(PSB(" "),-1),X=$S(X>4:4,1:X) F I=1:1:X W !,?5,PSB(I)
"RTN","PSBMLEN1",36,0)
 .I $D(^XUSEC("PSB READ ONLY",DUZ)) W !,"This operation is NOT AVAILABLE in PSB READ ONLY mode.",! Q
"RTN","PSBMLEN1",37,0)
 .I ($D(^XUSEC("PSB STUDENT",DUZ))),('$D(^XUSEC("PSB INSTRUCTOR"))) W !,"This operation is NOT AVAILABLE in PSB READ ONLY mode.",! Q
"RTN","PSBMLEN1",38,0)
 .W !!,"Create an administration for this order" S %=1 D YN^DICN Q:%'=1
"RTN","PSBMLEN1",39,0)
 .I PSBSCHT="P" D  Q:Y=""!(Y["^")
"RTN","PSBMLEN1",40,0)
 ..K DIR S DIR(0)="FB^1:30",DIR("A")="PRN Reason (1-30 characters)"
"RTN","PSBMLEN1",41,0)
 ..W !!,"NOTICE: PRN Reason is Required for ALL PRN Entries",!
"RTN","PSBMLEN1",42,0)
 ..D ^DIR
"RTN","PSBMLEN1",43,0)
 ..I Y=""!(Y["^") W !!,"Sorry, Reason is required, No Entry Made!" Q
"RTN","PSBMLEN1",44,0)
 ..S PSBREC(6)=$P(Y,"|")
"RTN","PSBMLEN1",45,0)
 .; Build the form of dosage to CAP or TAB or null
"RTN","PSBMLEN1",46,0)
 .S:(PSBDOSEF'?1"CAP".E)&(PSBDOSEF'?1"TAB".E)&(PSBDOSEF'?1"PATCH".E) PSBDOSEF=""
"RTN","PSBMLEN1",47,0)
 .; Build the variable dose check #####-#####MG
"RTN","PSBMLEN1",48,0)
 .S PSBVARD=$S(PSBDOSE?1.5N1"-"1.5N.E:1,1:0)
"RTN","PSBMLEN1",49,0)
 .S PSBREC(0)=DFN
"RTN","PSBMLEN1",50,0)
 .S PSBREC(1)=PSBONX
"RTN","PSBMLEN1",51,0)
 .S PSBREC(2)=PSBSCHT
"RTN","PSBMLEN1",52,0)
 .S PSBREC(3)="G"
"RTN","PSBMLEN1",53,0)
 .S PSBREC(4)=PSBOIT
"RTN","PSBMLEN1",54,0)
 .S PSBREC(5)=""
"RTN","PSBMLEN1",55,0)
 .S PSBREC(7)="Entry created with 'Manual Medication Entry' option."
"RTN","PSBMLEN1",56,0)
 .S PSBREC(8)=""
"RTN","PSBMLEN1",57,0)
 .S PSBREC(9)=$S(PSBONX["U":"UDTAB",1:"PBTAB")
"RTN","PSBMLEN1",58,0)
 .S PSBINDX=10
"RTN","PSBMLEN1",59,0)
 .S X="" F  S X=$O(PSBDDA(X)) Q:X=""  S PSBREC(PSBINDX)=$P(PSBDDA(X),U,1,2)_U_$P(PSBDDA(X),U,4)_U_$P(PSBDDA(X),U,4)_U_PSBDOSEF,PSBINDX=PSBINDX+1
"RTN","PSBMLEN1",60,0)
 .S X="" F  S X=$O(PSBADA(X)) Q:X=""  S PSBREC(PSBINDX)=PSBADA(X),PSBINDX=PSBINDX+1
"RTN","PSBMLEN1",61,0)
 .S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  S PSBREC(PSBINDX)=PSBSOLA(X),PSBINDX=PSBINDX+1
"RTN","PSBMLEN1",62,0)
 .D FILE
"RTN","PSBMLEN1",63,0)
 .I $G(DA),PSBREC(2)="O",$D(^PSB(53.79,DA)) I $P(^PSB(53.79,DA,0),U,9)="G" D ENE^PSJBCMA4(PSBREC(0),PSBREC(1))
"RTN","PSBMLEN1",64,0)
 ;
"RTN","PSBMLEN1",65,0)
 ; Continuous Meds
"RTN","PSBMLEN1",66,0)
 ;
"RTN","PSBMLEN1",67,0)
 I PSBSCHT="C" D
"RTN","PSBMLEN1",68,0)
 .W ! S %DT="AEQ",%DT("A")="Enter the DATE the medication was administered: "
"RTN","PSBMLEN1",69,0)
 .D NOW^%DTC S %DT(0)=(-1)*X,%DT("B")="" D ^%DT K %DT(0) Q:Y<1  S PSBDTX=Y D D^DIQ
"RTN","PSBMLEN1",70,0)
 .S:PSBODSCH PSBSCTMX=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBDTX)
"RTN","PSBMLEN1",71,0)
 .F PSBXX=0:1 Q:$G(^TMP("PSB",$J,"GETADMIN",PSBXX))=""  D
"RTN","PSBMLEN1",72,0)
 ..S X="",Y=$G(^TMP("PSB",$J,"GETADMIN",PSBXX))
"RTN","PSBMLEN1",73,0)
 ..F Z=1:1:$L(Y,"-") S X=X_$S(X]"":";",1:"")_Z_":"_$P(Y,"-",Z)
"RTN","PSBMLEN1",74,0)
 .I PSBODSCH,PSBSCTMX="" D  Q
"RTN","PSBMLEN1",75,0)
 ..W !!,"Order "_PSBONX_" is NOT SCHEDULED for administration on that entered date."
"RTN","PSBMLEN1",76,0)
 ..K DIR S DIR(0)="E^" D ^DIR
"RTN","PSBMLEN1",77,0)
 .K DIR S DIR(0)="S^"_X,DIR("A")="Select Administration Time"
"RTN","PSBMLEN1",78,0)
 .D ^DIR Q:Y<1
"RTN","PSBMLEN1",79,0)
 .S PSBDTX=+(PSBDTX_"."_Y(0))
"RTN","PSBMLEN1",80,0)
 .S Y=PSBDTX D D^DIQ
"RTN","PSBMLEN1",81,0)
 .W !!,"Create an administration for ",Y S %=1 D YN^DICN  Q:%'=1
"RTN","PSBMLEN1",82,0)
FORUM .; Build the form of dosage to CAP or TAB or null
"RTN","PSBMLEN1",83,0)
 .S PSBDOSEF=PSBDOSEF
"RTN","PSBMLEN1",84,0)
 .S:(PSBDOSEF'?1"CAP".E)&(PSBDOSEF'?1"TAB".E)&(PSBDOSEF'?1"PATCH".E) PSBDOSEF=""
"RTN","PSBMLEN1",85,0)
 .; Build the variable dose check #####-#####MG
"RTN","PSBMLEN1",86,0)
 .S PSBVARD=$S(PSBDOSE?1.5N1"-"1.5N.E:1,1:0)
"RTN","PSBMLEN1",87,0)
 .S PSBREC(0)=DFN
"RTN","PSBMLEN1",88,0)
 .S PSBREC(1)=PSBONX
"RTN","PSBMLEN1",89,0)
 .S PSBREC(2)=PSBSCHT
"RTN","PSBMLEN1",90,0)
 .S PSBREC(3)="G"
"RTN","PSBMLEN1",91,0)
 .S PSBREC(4)=PSBOIT
"RTN","PSBMLEN1",92,0)
 .S PSBREC(5)=PSBDTX
"RTN","PSBMLEN1",93,0)
 .S PSBREC(6)=""
"RTN","PSBMLEN1",94,0)
 .S PSBREC(7)="Entry created with 'Manual Medication Entry' option."
"RTN","PSBMLEN1",95,0)
 .S PSBREC(8)=""
"RTN","PSBMLEN1",96,0)
 .S PSBREC(9)=$S(PSBONX["U":"UDTAB",1:"PBTAB")
"RTN","PSBMLEN1",97,0)
 .S PSBINDX=10
"RTN","PSBMLEN1",98,0)
 .S X="" F  S X=$O(PSBDDA(X)) Q:X=""  S PSBREC(PSBINDX)=$P(PSBDDA(X),U,1,2)_U_$P(PSBDDA(X),U,4)_U_$P(PSBDDA(X),U,4)_U_PSBDOSEF,PSBINDX=PSBINDX+1
"RTN","PSBMLEN1",99,0)
 .S X="" F  S X=$O(PSBADA(X)) Q:X=""  S PSBREC(PSBINDX)=PSBADA(X),PSBINDX=PSBINDX+1
"RTN","PSBMLEN1",100,0)
 .S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  S PSBREC(PSBINDX)=PSBSOLA(X),PSBINDX=PSBINDX+1
"RTN","PSBMLEN1",101,0)
 .D FILE
"RTN","PSBMLEN1",102,0)
 Q
"RTN","PSBMLEN1",103,0)
 ;
"RTN","PSBMLEN1",104,0)
FILE ; Call the med log RPC to file it and DDS to edit it
"RTN","PSBMLEN1",105,0)
 N PSB,PSBSAVE,PSBAUDIT
"RTN","PSBMLEN1",106,0)
 D RPC^PSBML(.PSB,"+1^MEDPASS",.PSBREC)
"RTN","PSBMLEN1",107,0)
 I '$D(PSB) S PSB(0)=1,PSB(1)="-1^INCOMPLETE ENTRY^"_PSBINCX
"RTN","PSBMLEN1",108,0)
 I +PSB(1)<1 D  Q
"RTN","PSBMLEN1",109,0)
 .W @IOF,!,"Error(s) Creating Med Log Entry",!
"RTN","PSBMLEN1",110,0)
 .S X=$S(PSB(0)=1:0,1:1) F  S X=$O(PSB(X)) Q:X=""  W !,$J($S(X=1:X,1:X-1),2),". ",$S(X=1:$P(PSB(X),"^",2),1:PSB(X))
"RTN","PSBMLEN1",111,0)
 .W !!,"No Med Log Entry Created.",!!
"RTN","PSBMLEN1",112,0)
 .K DIR S DIR(0)="E" D ^DIR
"RTN","PSBMLEN1",113,0)
 S PSBSAVE=0 S:'$G(PSBMMEN) PSBAUDIT=1
"RTN","PSBMLEN1",114,0)
 S DA=$P(PSB(1),U,3),DDSFILE=53.79,DDSPARM="C"
"RTN","PSBMLEN1",115,0)
 I $P(^PSB(53.79,DA,.1),U,1)?.N1"U" S DR="[PSB NEW UD ENTRY]"
"RTN","PSBMLEN1",116,0)
 I $P(^PSB(53.79,DA,.1),U,1)?.N1"V" S DR="[PSB NEW IV ENTRY]"
"RTN","PSBMLEN1",117,0)
 D ^DDS
"RTN","PSBMLEN1",118,0)
 L +^PSB(53.79,DA):1 I  L -^PSB(53.79,DA) I PSBSAVE'=1 D
"RTN","PSBMLEN1",119,0)
 .W !,"Incomplete Med Log Entry, Deleting...#",DA S A=^PSB(53.79,DA,0),DFN=$P(A,U,1),AADT=$P(A,U,6)
"RTN","PSBMLEN1",120,0)
 .K ^PSB(53.79,"AADT",DFN,AADT,DA) S DIK="^PSB(53.79," D ^DIK
"RTN","PSBMLEN1",121,0)
 I PSBSAVE=1 D
"RTN","PSBMLEN1",122,0)
 .I $D(DA) D:($P(^PSB(53.79,DA,0),U,9)="G")
"RTN","PSBMLEN1",123,0)
 ..I $D(^PSB(53.79,DA,.5)) S PSBY=0 F  S PSBY=$O(^PSB(53.79,DA,.5,PSBY)) Q:+PSBY<1  D
"RTN","PSBMLEN1",124,0)
 ...I $P(^PSB(53.79,DA,.5,PSBY,0),U,4)="PATCH" D
"RTN","PSBMLEN1",125,0)
 ....S (PSBYX,PSBXUIT)="" F  S PSBYX=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBYX),-1)   Q:PSBYX=""  D  Q:PSBXUIT
"RTN","PSBMLEN1",126,0)
 .....S PSBYZ="" S PSBYZ=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBYX,PSBYZ)) I (PSBYZ'=DA),$P(^PSB(53.79,PSBYZ,0),U,9)="G" D
"RTN","PSBMLEN1",127,0)
 ......W !!,"PATCH has been GIVEN before this admin completed; Deleting Med Log Entry...#",DA,!! S A=^PSB(53.79,DA,0),DFN=$P(A,U,1),AADT=$P(A,U,6)
"RTN","PSBMLEN1",128,0)
 ......K ^PSB(53.79,"AADT",DFN,AADT,DA) S DIK="^PSB(53.79," D ^DIK
"RTN","PSBMLEN1",129,0)
 ......S PSBXUIT=1
"RTN","PSBMLEN1",130,0)
 ....Q:PSBXUIT
"RTN","PSBMLEN1",131,0)
 ....S ^PSB(53.79,"APATCH",$P(^PSB(53.79,DA,0),U),$P(^PSB(53.79,DA,0),U,6),DA)=""
"RTN","PSBMLEN1",132,0)
 .Q:(PSBIEN="+1")&('$D(PSBIEN(1)))
"RTN","PSBMLEN1",133,0)
 .Q:$G(PSBXUIT)
"RTN","PSBMLEN1",134,0)
 .S X=$S($P(PSBIEN,",",2)]"":$P(PSBIEN,",",2),PSBIEN="+1":PSBIEN(1),1:"")
"RTN","PSBMLEN1",135,0)
 .I X]"" I ($F("HR",$P(^PSB(53.79,X,0),U,9))>1) F Y=.5,.6,.7 S Z=0 F  S Z=$O(^PSB(53.79,X,Y,Z)) Q:+Z=0  S $P(^PSB(53.79,X,Y,Z,0),U,3)=0
"RTN","PSBMLEN1",136,0)
 Q
"RTN","PSBMLEN1",137,0)
 ;
"RTN","PSBMLEN1",138,0)
FDATE ;Check Admin Time for future date/time.
"RTN","PSBMLEN1",139,0)
 N PSBTIMX
"RTN","PSBMLEN1",140,0)
 S PSBTIMX=X D NOW^%DTC
"RTN","PSBMLEN1",141,0)
 I PSBTIMX>% W $C(7) S (DDSERROR,DDSBR)=1 D HLP^DDSUTL("Future date/time is not allowed")
"RTN","PSBMLEN1",142,0)
 Q
"RTN","PSBMLEN1",143,0)
 ;
"RTN","PSBMLLKU")
0^16^B65545220^B62544624
"RTN","PSBMLLKU",1,0)
PSBMLLKU ;BIRMINGHAM/TEJ-BCMA RPC LOOKUP UTLILITIES ;Mar 2004
"RTN","PSBMLLKU",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,9,11,20,13**;Mar 2004
"RTN","PSBMLLKU",3,0)
 ;
"RTN","PSBMLLKU",4,0)
 ; Reference/IA
"RTN","PSBMLLKU",5,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBMLLKU",6,0)
 ; $$DOB^DPTLK1/3266
"RTN","PSBMLLKU",7,0)
 ; $$SSN^DPTLK1/3267
"RTN","PSBMLLKU",8,0)
 ; ^DPT/10035
"RTN","PSBMLLKU",9,0)
 ; ^XUSEC/10076
"RTN","PSBMLLKU",10,0)
 ; File 52.6/436
"RTN","PSBMLLKU",11,0)
 ; File 52.7/437
"RTN","PSBMLLKU",12,0)
 ; File 50/221
"RTN","PSBMLLKU",13,0)
 ;
"RTN","PSBMLLKU",14,0)
 ;
"RTN","PSBMLLKU",15,0)
RPC(RESULTS,PSBREC) ; Remote Procedure Call Entry Point.
"RTN","PSBMLLKU",16,0)
 ;
"RTN","PSBMLLKU",17,0)
 S RESULTS="" D @(PSBREC(0)_"(.RESULTS,.PSBREC)") Q
"RTN","PSBMLLKU",18,0)
 Q
"RTN","PSBMLLKU",19,0)
 ;
"RTN","PSBMLLKU",20,0)
ADMLKUP(RESULTS,PSBREC) ;
"RTN","PSBMLLKU",21,0)
 ;  Lookup ADMinistrations per DFN and search DATE
"RTN","PSBMLLKU",22,0)
 ;   input - PSBREC(1)  DFN
"RTN","PSBMLLKU",23,0)
 ;           PSBREC(2)  Search DATE
"RTN","PSBMLLKU",24,0)
 ;
"RTN","PSBMLLKU",25,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",26,0)
 ;          (Administrations returned will be dated  = to Search Date
"RTN","PSBMLLKU",27,0)
 ;
"RTN","PSBMLLKU",28,0)
 ;
"RTN","PSBMLLKU",29,0)
 K RESULTS
"RTN","PSBMLLKU",30,0)
 S DFN=PSBREC(1),PSBSRCH=$G(PSBREC(2)) I $G(PSBSRCH)']"" D NOW^%DTC S PSBSRCH=$P(%,".")
"RTN","PSBMLLKU",31,0)
 S PSBDT=PSBSRCH,PSBCNT=0 S:PSBSRCH'["." PSBSRCH=PSBSRCH+.9
"RTN","PSBMLLKU",32,0)
 S RESULTS(0)=1,RESULTS(1)="-1^No Meds Found!"
"RTN","PSBMLLKU",33,0)
 F  S PSBSRCH=$O(^PSB(53.79,"AADT",DFN,PSBSRCH),-1) Q:'PSBSRCH!(PSBSRCH<PSBDT)  D
"RTN","PSBMLLKU",34,0)
 .S PSBIEN=""
"RTN","PSBMLLKU",35,0)
 .F  S PSBIEN=$O(^PSB(53.79,"AADT",DFN,PSBSRCH,PSBIEN),-1) Q:'PSBIEN  D:'$D(^PSB(53.79,PSBIEN)) KILLAADT  Q:'$D(^PSB(53.79,PSBIEN))  D:$$CHKKEY(PSBIEN)
"RTN","PSBMLLKU",36,0)
 ..L +^PSB(53.79,PSBIEN):1
"RTN","PSBMLLKU",37,0)
 ..I  L -^PSB(53.79,PSBIEN)
"RTN","PSBMLLKU",38,0)
 ..E  Q
"RTN","PSBMLLKU",39,0)
 ..S PSBXORDN=$$GET1^DIQ(53.79,PSBIEN_",",.11) Q:'$D(^PSB(53.79,"AORDX",DFN,PSBXORDN,PSBSRCH))
"RTN","PSBMLLKU",40,0)
 ..Q:($$GET1^DIQ(53.79,PSBIEN_",",.06,"I")>PSBSRCH)
"RTN","PSBMLLKU",41,0)
 ..Q:($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")="N")
"RTN","PSBMLLKU",42,0)
 ..S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBIEN
"RTN","PSBMLLKU",43,0)
 ..S $P(RESULTS(PSBCNT),U,2)=PSBSRCH
"RTN","PSBMLLKU",44,0)
 ..S $P(RESULTS(PSBCNT),U,3)=$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLLKU",45,0)
 ..S:$$GET1^DIQ(53.79,PSBIEN_",",.26) $P(RESULTS(PSBCNT),U,4)=$$GET1^DIQ(53.79,PSBIEN_",",.26)
"RTN","PSBMLLKU",46,0)
 ..S $P(RESULTS(PSBCNT),U,5)=$S($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")']"":"U",1:$$GET1^DIQ(53.79,PSBIEN_",",.09,"I"))
"RTN","PSBMLLKU",47,0)
 ..D  ; Get order information
"RTN","PSBMLLKU",48,0)
 ...K ^TMP("PSJ1",$J) D EN^PSJBCMA1(DFN,PSBXORDN,1)
"RTN","PSBMLLKU",49,0)
 ...S $P(RESULTS(PSBCNT),U,3)=$P(^TMP("PSJ1",$J,2),U,2)  ;OItem_" "_Dosage Form
"RTN","PSBMLLKU",50,0)
 ...S $P(RESULTS(PSBCNT),U,6)=$P(^TMP("PSJ1",$J,4),U)    ;Sched Type
"RTN","PSBMLLKU",51,0)
 ...K ^TMP("PSJ1",$J)
"RTN","PSBMLLKU",52,0)
 ..S $P(RESULTS(PSBCNT),U,7)=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I")
"RTN","PSBMLLKU",53,0)
 ..S $P(RESULTS(PSBCNT),U,8)=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBMLLKU",54,0)
 ..S:$D(^PSB(53.79,PSBIEN,.2)) $P(RESULTS(PSBCNT),U,9)=$P(^PSB(53.79,PSBIEN,.2),U),$P(RESULTS(PSBCNT),U,10)=$P(^PSB(53.79,PSBIEN,.2),U,2)
"RTN","PSBMLLKU",55,0)
 S:+$G(RESULTS(1))>0 $P(RESULTS(0),U)=PSBCNT
"RTN","PSBMLLKU",56,0)
 Q
"RTN","PSBMLLKU",57,0)
 ;
"RTN","PSBMLLKU",58,0)
CHKKEY(PSBIENX) ;
"RTN","PSBMLLKU",59,0)
 I '(($D(^XUSEC("PSB MANAGER",DUZ)))!($$GET1^DIQ(53.79,+PSBIENX,.07,"I")=DUZ)) Q 0
"RTN","PSBMLLKU",60,0)
 Q 1
"RTN","PSBMLLKU",61,0)
 ;
"RTN","PSBMLLKU",62,0)
PTLKUP(RESULTS,PSBREC) ; Patient lookup handled separately for security
"RTN","PSBMLLKU",63,0)
 ;   input - PSBREC (array)  User entered patient lookup data
"RTN","PSBMLLKU",64,0)
 ;
"RTN","PSBMLLKU",65,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",66,0)
 ;          (Person(s) in PATIENT File (#2) meeting search criteria)
"RTN","PSBMLLKU",67,0)
 ;
"RTN","PSBMLLKU",68,0)
 ;
"RTN","PSBMLLKU",69,0)
 K RESULTS
"RTN","PSBMLLKU",70,0)
 S PSBDATA=$E(PSBREC(1),1,30)
"RTN","PSBMLLKU",71,0)
 N PSBINDX
"RTN","PSBMLLKU",72,0)
 S PSBINDX=$S(PSBDATA?9N.1P:"SSN",PSBDATA?4N.1P:"BS5^BS",1:"")
"RTN","PSBMLLKU",73,0)
 D FIND^DIC(2,"","@;.01;.02;.03;.09","MP",PSBDATA,200,PSBINDX)
"RTN","PSBMLLKU",74,0)
 I $P($G(^TMP("DILIST",$J,0)),U,3) D  Q
"RTN","PSBMLLKU",75,0)
 .S RESULTS(0)=1,RESULTS(1)="-1^Too many patients found matching '"_PSBDATA_"'. Please be more specific."
"RTN","PSBMLLKU",76,0)
 I $D(^TMP("DILIST",$J,0)) D
"RTN","PSBMLLKU",77,0)
 .F PSBXX=0:0 S PSBXX=$O(^TMP("DILIST",$J,PSBXX)) Q:'PSBXX  D
"RTN","PSBMLLKU",78,0)
 ..S RESULTS(PSBXX)=$$PTREC(+^TMP("DILIST",$J,PSBXX,0))
"RTN","PSBMLLKU",79,0)
 I '$D(RESULTS) S RESULTS(0)=1,RESULTS(1)="-1^No patients matching '"_PSBDATA_"'"
"RTN","PSBMLLKU",80,0)
 E  S RESULTS(0)=+$O(RESULTS(""),-1)
"RTN","PSBMLLKU",81,0)
 Q
"RTN","PSBMLLKU",82,0)
 ;
"RTN","PSBMLLKU",83,0)
PTREC(DFN) ;
"RTN","PSBMLLKU",84,0)
 ; Extrinsic to return a Pt Rec  in standard list format
"RTN","PSBMLLKU",85,0)
 N PSBXX
"RTN","PSBMLLKU",86,0)
 S PSBXX=$G(^DPT(DFN,0))
"RTN","PSBMLLKU",87,0)
 S PSBXX=DFN_U_$P(PSBXX,U,1)_U_$P(PSBXX,U,2)_U_$P(PSBXX,U,3)_U_$P(PSBXX,U,9)
"RTN","PSBMLLKU",88,0)
 S $P(PSBXX,U,6)=$$GET1^DIQ(2,DFN_",",.1)
"RTN","PSBMLLKU",89,0)
 S $P(PSBXX,U,7)=$$GET1^DIQ(2,DFN_",",.101)
"RTN","PSBMLLKU",90,0)
 S $P(PSBXX,U,10)=$$DOB^DPTLK1(DFN)
"RTN","PSBMLLKU",91,0)
 S $P(PSBXX,U,11)=$$SSN^DPTLK1(DFN)
"RTN","PSBMLLKU",92,0)
 Q PSBXX
"RTN","PSBMLLKU",93,0)
 ;
"RTN","PSBMLLKU",94,0)
SELECTAD(RESULTS,PSBREC) ; Select Administration
"RTN","PSBMLLKU",95,0)
 ;
"RTN","PSBMLLKU",96,0)
 ;  Process the SELECTed ADministration
"RTN","PSBMLLKU",97,0)
 ;   input - PSBREC(1) = PSB Med Log File (#53.79) IEN
"RTN","PSBMLLKU",98,0)
 ;
"RTN","PSBMLLKU",99,0)
 ;
"RTN","PSBMLLKU",100,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",101,0)
 ;          (Administration data that can be subsequently updated via GUI MED LOG EDIT)
"RTN","PSBMLLKU",102,0)
 ;
"RTN","PSBMLLKU",103,0)
 ;
"RTN","PSBMLLKU",104,0)
 K RESULTS,PSBXIV,PSBPTCHX
"RTN","PSBMLLKU",105,0)
 N PSBIEN,PSBCNT,PSBX S PSBIEN=PSBREC(1),PSBCNT=2
"RTN","PSBMLLKU",106,0)
 ; Construct form data    Patient^SSN^Med^BagID^AdminStat^AdminD/T^InjctSt^PRNReas^PRNEff^DisDrg^UntsGiven^Unt^
"RTN","PSBMLLKU",107,0)
 S RESULTS(0)=0
"RTN","PSBMLLKU",108,0)
 D:$$CHKKEY(PSBIEN)
"RTN","PSBMLLKU",109,0)
 .L +^PSB(53.79,PSBIEN):1
"RTN","PSBMLLKU",110,0)
 .E  I $P(^PSB(53.79,PSBIEN,0),U,9)]"" S PSBCNT=1,RESULTS(1)="-1^ This administration is being modified by another process at this moment." L -^PSB(53.79,PSBIEN) Q
"RTN","PSBMLLKU",111,0)
 .S $P(RESULTS(1),U)=PSBIEN
"RTN","PSBMLLKU",112,0)
 .S $P(RESULTS(1),U,2)=$$GET1^DIQ(53.79,PSBIEN_",",.01,"I")
"RTN","PSBMLLKU",113,0)
 .S $P(RESULTS(1),U,3)=$$GET1^DIQ(53.79,PSBIEN_",",.01)
"RTN","PSBMLLKU",114,0)
 .S $P(RESULTS(1),U,4)=$$GET1^DIQ(2,$P(RESULTS(1),U,2)_",",.09)
"RTN","PSBMLLKU",115,0)
 .S $P(RESULTS(1),U,5)=$$GET1^DIQ(53.79,PSBIEN_",",.08,"I")_"~"_$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLLKU",116,0)
 .S $P(RESULTS(1),U,6)=$$GET1^DIQ(53.79,PSBIEN_",",.26)
"RTN","PSBMLLKU",117,0)
 .S $P(RESULTS(1),U,7)=$S($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")']"":"U",1:$$GET1^DIQ(53.79,PSBIEN_",",.09,"I"))
"RTN","PSBMLLKU",118,0)
 .;
"RTN","PSBMLLKU",119,0)
 .D:($P(RESULTS(1),U,7)'="N")&($P(RESULTS(1),U,7)]"") SELSTTUS(.RESULTS)  ; Amend RESULTS(1) data...
"RTN","PSBMLLKU",120,0)
 .S Y=$E($$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),1,12) D DD^%DT
"RTN","PSBMLLKU",121,0)
 .S $P(RESULTS(1),U,8)=Y
"RTN","PSBMLLKU",122,0)
 .S $P(RESULTS(1),U,9)=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I")
"RTN","PSBMLLKU",123,0)
 .S $P(RESULTS(1),U,10)=$$GET1^DIQ(53.79,PSBIEN_",",.16)
"RTN","PSBMLLKU",124,0)
 .S $P(RESULTS(1),U,16)=0
"RTN","PSBMLLKU",125,0)
 .S $P(RESULTS(2),U)=$$GET1^DIQ(53.79,PSBIEN_",",.21),$P(RESULTS(2),U,2)=$$GET1^DIQ(53.79,PSBIEN_",",.22)
"RTN","PSBMLLKU",126,0)
 .; Determine if there are any active IVs/Patchs per order
"RTN","PSBMLLKU",127,0)
 .D:$G(PSBPTCHX)
"RTN","PSBMLLKU",128,0)
 ..S PSBX="",PSBX="^PSB(53.79,""APATCH"","_$P(RESULTS(1),U,2)_")"
"RTN","PSBMLLKU",129,0)
 ..F  S PSBX=$Q(@PSBX) Q:PSBX=""  Q:$QS(PSBX,3)'=$P(RESULTS(1),U,2)  D  Q:$P(RESULTS(1),U,16)
"RTN","PSBMLLKU",130,0)
 ...S PSBXX=$QS(PSBX,5),PSBXXX=$S(($P(^PSB(53.79,PSBXX,0),U,9)="G")&(PSBXX'=PSBIEN):1,1:0)
"RTN","PSBMLLKU",131,0)
 ...I PSBXXX&($P(^PSB(53.79,PSBXX,.1),U)=$P(RESULTS(1),U,15)) S $P(RESULTS(1),U,16)=1
"RTN","PSBMLLKU",132,0)
 .D:$G(PSBXIV)
"RTN","PSBMLLKU",133,0)
 ..S PSBX="",PSBX="^PSB(53.79,""AUID"","_$P(RESULTS(1),U,2)_")"
"RTN","PSBMLLKU",134,0)
 ..F  S PSBX=$Q(@PSBX) Q:PSBX=""  Q:$QS(PSBX,3)'=$P(RESULTS(1),U,2)  Q:$QS(PSBX,4)>$P(RESULTS(1),U,15)  D  Q:$P(RESULTS(1),U,16)
"RTN","PSBMLLKU",135,0)
 ...Q:$QS(PSBX,4)'=$P(RESULTS(1),U,15)
"RTN","PSBMLLKU",136,0)
 ...S PSBXX=$QS(PSBX,6) S:(PSBXX'=PSBIEN) $P(RESULTS(1),U,16)=$S($P(^PSB(53.79,PSBXX,0),U,9)="I":1,$P(^PSB(53.79,PSBXX,0),U,9)="S":1,1:0)
"RTN","PSBMLLKU",137,0)
 .;
"RTN","PSBMLLKU",138,0)
 .; LOOP - Place DD in RESULTS
"RTN","PSBMLLKU",139,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.5,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",140,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",141,0)
 ..S RESULTS(PSBCNT)="DD^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U)_"^"_$$GET1^DIQ(50,$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",142,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,4)
"RTN","PSBMLLKU",143,0)
 ..S:$P(RESULTS(PSBCNT),U,4)?1"."1.N $P(RESULTS(PSBCNT),U,4)=0_+$P(RESULTS(PSBCNT),U,4)
"RTN","PSBMLLKU",144,0)
 ..S:$P(RESULTS(PSBCNT),U,5)?1"."1.N $P(RESULTS(PSBCNT),U,5)=0_+$P(RESULTS(PSBCNT),U,5)
"RTN","PSBMLLKU",145,0)
 .; LOOP - Place ADD in RESULTS
"RTN","PSBMLLKU",146,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.6,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",147,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",148,0)
 ..S RESULTS(PSBCNT)="ADD^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U)_"^"_$$GET1^DIQ(52.6,$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",149,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,4)
"RTN","PSBMLLKU",150,0)
 .; LOOP - Place SOL in RESULTS
"RTN","PSBMLLKU",151,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.7,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",152,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",153,0)
 ..S RESULTS(PSBCNT)="SOL^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U)_"^"_$$GET1^DIQ(52.7,$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",154,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,4)
"RTN","PSBMLLKU",155,0)
 .L -^PSB(53.79,PSBIEN)
"RTN","PSBMLLKU",156,0)
 S:PSBCNT>0 RESULTS(0)=PSBCNT
"RTN","PSBMLLKU",157,0)
 Q
"RTN","PSBMLLKU",158,0)
 ;
"RTN","PSBMLLKU",159,0)
SELSTTUS(RESULTS) ;
"RTN","PSBMLLKU",160,0)
 ; Provide the SELectable STaTUS
"RTN","PSBMLLKU",161,0)
 ;
"RTN","PSBMLLKU",162,0)
 ; Get TAB, ScheduleType, Current Status, provide Selectable Staus(s) in ^8
"RTN","PSBMLLKU",163,0)
 N PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBMROUT,PSBXTAB
"RTN","PSBMLLKU",164,0)
 K ^TMP("PSJ1",$J) D EN^PSJBCMA1($$GET1^DIQ(53.79,PSBIEN_",",.01,"I"),$$GET1^DIQ(53.79,PSBIEN_",",.11),1)
"RTN","PSBMLLKU",165,0)
 I ^TMP("PSJ1",$J,0)>0 D
"RTN","PSBMLLKU",166,0)
 .S PSBORTYP=$TR($P(^TMP("PSJ1",$J,0),U,3),"1234567890"),PSBIVTYP=$P(^TMP("PSJ1",$J,0),U,6)
"RTN","PSBMLLKU",167,0)
 .S PSBINTSY=$P(^TMP("PSJ1",$J,0),U,7),PSBCHMTY=$P(^TMP("PSJ1",$J,0),U,8),PSBMROUT=$P(^TMP("PSJ1",$J,1),U,4)
"RTN","PSBMLLKU",168,0)
 .S:$$IVPTAB^PSBVDLU3(PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBMROUT) PSBXTAB="PB"
"RTN","PSBMLLKU",169,0)
 .D:'$D(PSBXTAB)
"RTN","PSBMLLKU",170,0)
 ..I PSBORTYP="U" S PSBXTAB="UD"
"RTN","PSBMLLKU",171,0)
 ..I PSBORTYP="V" S PSBXTAB="IV"
"RTN","PSBMLLKU",172,0)
 ; Set Results(1) and other flags...
"RTN","PSBMLLKU",173,0)
 I ^TMP("PSJ1",$J,0)>0 D
"RTN","PSBMLLKU",174,0)
 .S $P(RESULTS(1),U,13)=$P(^TMP("PSJ1",$J,4),U)
"RTN","PSBMLLKU",175,0)
 .S $P(RESULTS(1),U,14)=$P(^TMP("PSJ1",$J,1),U,10)
"RTN","PSBMLLKU",176,0)
 .S $P(RESULTS(1),U,15)=$P(^TMP("PSJ1",$J,0),U,3)
"RTN","PSBMLLKU",177,0)
 .I (PSBXTAB="UD"),($P(^TMP("PSJ1",$J,2),U,6)="PATCH") S PSBPTCHX=1
"RTN","PSBMLLKU",178,0)
 .I PSBXTAB="IV" S PSBXIV=1
"RTN","PSBMLLKU",179,0)
 .S:$G(PSBXTAB)]"" $P(RESULTS(1),U,11)=$G(PSBXTAB)
"RTN","PSBMLLKU",180,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBMLLKU",181,0)
 Q
"RTN","PSBMLLKU",182,0)
 ;
"RTN","PSBMLLKU",183,0)
KILLAADT ;
"RTN","PSBMLLKU",184,0)
 ;   Here because there is an errorant index entry via version 1.0/2.0
"RTN","PSBMLLKU",185,0)
 ;   Cleansing!
"RTN","PSBMLLKU",186,0)
 ;
"RTN","PSBMLLKU",187,0)
 K ^PSB(53.79,"AADT",DFN,PSBSRCH,PSBIEN)
"RTN","PSBMLLKU",188,0)
 Q
"RTN","PSBMLLKU",189,0)
 ;
"RTN","PSBMLU")
0^15^B6301609^B5930177
"RTN","PSBMLU",1,0)
PSBMLU ;BIRMINGHAM/EFC-BCMA MEDICATION LOG FUNCTIONS ;Mar 2004
"RTN","PSBMLU",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,11,13**;Mar 2004
"RTN","PSBMLU",3,0)
 ;;
"RTN","PSBMLU",4,0)
 ; Reference/IA
"RTN","PSBMLU",5,0)
 ; ^XMD/10070
"RTN","PSBMLU",6,0)
 ;
"RTN","PSBMLU",7,0)
EN ;
"RTN","PSBMLU",8,0)
 Q
"RTN","PSBMLU",9,0)
 ;
"RTN","PSBMLU",10,0)
AUDIT(IEN,TXT,PSBTRN) ; Append and Audit
"RTN","PSBMLU",11,0)
 D NOW^%DTC
"RTN","PSBMLU",12,0)
 S RDAT=%
"RTN","PSBMLU",13,0)
 D:PSBTRN="ADD COMMENT"
"RTN","PSBMLU",14,0)
 . N XA
"RTN","PSBMLU",15,0)
 . S XA=$O(^PSB(53.79,IEN,.3,"A"),-1)
"RTN","PSBMLU",16,0)
 . S RDAT=$P(^PSB(53.79,IEN,.3,XA,0),U,3)
"RTN","PSBMLU",17,0)
 D:PSBTRN="PRN EFFECTIVENESS" 
"RTN","PSBMLU",18,0)
 . S RDAT=$P(^PSB(53.79,IEN,.2),U,4)
"RTN","PSBMLU",19,0)
 D:PSBTRN="UPDATE STATUS"
"RTN","PSBMLU",20,0)
 . S RDAT=$P(^PSB(53.79,IEN,0),U,6)
"RTN","PSBMLU",21,0)
 D:PSBTRN="MEDPASS"
"RTN","PSBMLU",22,0)
 . S RDAT=$P(^PSB(53.79,IEN,0),U,6)
"RTN","PSBMLU",23,0)
 S:'$D(^PSB(53.79,IEN,.9,0)) ^(0)="^53.799D^^"
"RTN","PSBMLU",24,0)
 S PSBAD1=""
"RTN","PSBMLU",25,0)
 S PSBAD1=$O(^PSB(53.79,IEN,.9,"A"),-1)+1
"RTN","PSBMLU",26,0)
 S ^PSB(53.79,IEN,.9,PSBAD1,0)=RDAT_U_DUZ_U_TXT
"RTN","PSBMLU",27,0)
 Q
"RTN","PSBMLU",28,0)
 ;
"RTN","PSBMLU",29,0)
ERROR(PSB1,PSB2,DFN,PSB3,PSB4,PSB5,PSB6,PSB7) ;
"RTN","PSBMLU",30,0)
 ; PSB1 = order #
"RTN","PSBMLU",31,0)
 ; PSB2 = orderable item
"RTN","PSBMLU",32,0)
 ; PSB3 = message to be sent
"RTN","PSBMLU",33,0)
 ; PSB4 = schedule
"RTN","PSBMLU",34,0)
 ; PSB5 = action date/time
"RTN","PSBMLU",35,0)
 ; PSB6 = med log ien #
"RTN","PSBMLU",36,0)
 ; PSB7 = user identification
"RTN","PSBMLU",37,0)
 ; Send Error Msg about problems
"RTN","PSBMLU",38,0)
 S PSBMG=$$GET^XPAR("DIV",$S($G(PSBADMER):"PSB MG ADMIN ERROR",1:"PSB MG DUE LIST ERROR"),,"E")
"RTN","PSBMLU",39,0)
 Q:PSBMG=""
"RTN","PSBMLU",40,0)
 S PSBMSG(1)="  The following "_$S($G(PSBADMER):"administration",1:"order")_" was NOT displayed"
"RTN","PSBMLU",41,0)
 S PSBMSG(2)="  on the Virtual Due List"
"RTN","PSBMLU",42,0)
 S PSBMSG(3)=" "
"RTN","PSBMLU",43,0)
 S PSBMSG(4)="  Order Number....: "_PSB1
"RTN","PSBMLU",44,0)
 S PSBMSG(5)="  Orderable Item..: "_PSB2
"RTN","PSBMLU",45,0)
 S PSBMSG(6)="  Patient.........: "_$$GET1^DIQ(2,DFN_",",.01)_" ("_$$GET1^DIQ(2,DFN_",",.09)_")"
"RTN","PSBMLU",46,0)
 S PSBMSG(7)="  Ward/Bed........: "_$$GET1^DIQ(2,DFN_",",.1)_"/"_$$GET1^DIQ(2,DFN_",",.101)
"RTN","PSBMLU",47,0)
 S PSBMSG(8)="  Reason..........: "_PSB3
"RTN","PSBMLU",48,0)
 S PSBMSG(9)="  Schedule........: "_PSB4
"RTN","PSBMLU",49,0)
 I $D(PSB5) S PSBMSG(10)="  Action Dt/Tm....: "_PSB5
"RTN","PSBMLU",50,0)
 I $D(PSB6) S PSBMSG(11)="  BCMA Med Log IEN: "_PSB6
"RTN","PSBMLU",51,0)
 I $D(PSB7) S PSBMSG(12)="  User............: "_PSB7
"RTN","PSBMLU",52,0)
 S XMY("G."_PSBMG)="",XMTEXT="PSBMSG(",XMSUB="BCMA - "_$S($G(PSBADMER):"Admin "_$G(PSB6),1:"Order")_" Problem"
"RTN","PSBMLU",53,0)
 K PSBADMER
"RTN","PSBMLU",54,0)
 D ^XMD
"RTN","PSBMLU",55,0)
 K PSB1,PSB2,PSB3,PSB4,PSBMSG,PSBMG,XMY,XMSUB,XMTEXT
"RTN","PSBMLU",56,0)
 Q
"RTN","PSBMLU",57,0)
 ;
"RTN","PSBO")
0^17^B62943627^B63302774
"RTN","PSBO",1,0)
PSBO ;BIRMINGHAM/EFC-BCMA OUTPUTS ;Mar 2004
"RTN","PSBO",2,0)
 ;;3.0;BAR CODE MED ADMIN;**13**;Mar 2004
"RTN","PSBO",3,0)
 ;
"RTN","PSBO",4,0)
 ; Reference/IA
"RTN","PSBO",5,0)
 ; ^DPT(/10035
"RTN","PSBO",6,0)
 ; WARD^NURSUT5/3052
"RTN","PSBO",7,0)
 ; EN^PSJBCMA/2828
"RTN","PSBO",8,0)
 ; ^ORD(101.24/3429
"RTN","PSBO",9,0)
 ; ^PSDRUG(/221
"RTN","PSBO",10,0)
 ;
"RTN","PSBO",11,0)
 ;
"RTN","PSBO",12,0)
RPC(RESULTS,PSBTYPE,PSBDFN,PSBSTRT,PSBSTOP,PSBINCL,PSBDEV,PSBSORT,PSBOI,PSBWLOC,PSBWSORT,PSBFUTR,PSBORDNM) ;
"RTN","PSBO",13,0)
 ;
"RTN","PSBO",14,0)
 ; RPC: PSB REPORT
"RTN","PSBO",15,0)
 ;
"RTN","PSBO",16,0)
 ; Description:
"RTN","PSBO",17,0)
 ; Used by the client to create individual patient extracts of
"RTN","PSBO",18,0)
 ; CHUI report options to display on the client.
"RTN","PSBO",19,0)
 ;
"RTN","PSBO",20,0)
 S RESULTS=$NAME(^TMP("PSBO",$J))
"RTN","PSBO",21,0)
 N PSBIENS,PSBRPT,PSBFDA,DIC,PSBANS
"RTN","PSBO",22,0)
 K ^TMP("PSBO",$J) S ^TMP("PSBO",$J,1)="-1^"
"RTN","PSBO",23,0)
 S DFN=PSBDFN
"RTN","PSBO",24,0)
 D NEW^PSBO1(.PSBRPT,PSBTYPE)
"RTN","PSBO",25,0)
 I +PSBRPT(0)<1 S ^TMP("PSBO",$J,1)="-1^Error: "_$P(PSBRPT(0),U,2) Q
"RTN","PSBO",26,0)
 S PSBIENS=+PSBRPT(0)_","
"RTN","PSBO",27,0)
 S PSBSTRT(0)=$E($P(PSBSTRT,".",2)_"0000",1,4),PSBSTRT=PSBSTRT\1
"RTN","PSBO",28,0)
 S PSBSTOP(0)=$E($P(PSBSTOP,".",2)_"0000",1,4),PSBSTOP=PSBSTOP\1
"RTN","PSBO",29,0)
 D:$G(PSBDEV)]""
"RTN","PSBO",30,0)
 .D NOW^%DTC
"RTN","PSBO",31,0)
 .I $P(PSBDEV,U,2)="" D VAL^DIE(53.69,PSBIENS,.06,"F",PSBDEV,"PSBRET","PSBFDA")
"RTN","PSBO",32,0)
 .I $P(PSBDEV,U,2)'="" D VAL^DIE(53.69,PSBIENS,.06,"F","`"_$P(PSBDEV,U,2),"PSBRET","PSBFDA")
"RTN","PSBO",33,0)
 .D VAL^DIE(53.69,PSBIENS,.07,"F",%,"PSBRET","PSBFDA")
"RTN","PSBO",34,0)
 D:$G(PSBOI)]"" VAL^DIE(53.69,PSBIENS,.09,"F",PSBOI,"PSBRET","PSBFDA")
"RTN","PSBO",35,0)
 S:($G(PSBSORT)']"")&(PSBTYPE'="XA") PSBSORT="P" D VAL^DIE(53.69,PSBIENS,.11,"F",PSBSORT,"PSBRET","PSBFDA")
"RTN","PSBO",36,0)
 D VAL^DIE(53.69,PSBIENS,.12,"F","`"_PSBDFN,"PSBRET","PSBFDA")
"RTN","PSBO",37,0)
 I $G(PSBWLOC)]"" S PSBFDA(53.69,PSBIENS,.13)=PSBWLOC
"RTN","PSBO",38,0)
 D:$G(PSBWSORT)]"" VAL^DIE(53.69,PSBIENS,.15,"F",PSBWSORT,"PSBRET","PSBFDA")
"RTN","PSBO",39,0)
 D VAL^DIE(53.69,PSBIENS,.16,"F",PSBSTRT,"PSBRET","PSBFDA")
"RTN","PSBO",40,0)
 D VAL^DIE(53.69,PSBIENS,.17,"F",PSBSTRT(0),"PSBRET","PSBFDA")
"RTN","PSBO",41,0)
 D VAL^DIE(53.69,PSBIENS,.18,"F",PSBSTOP,"PSBRET","PSBFDA")
"RTN","PSBO",42,0)
 D VAL^DIE(53.69,PSBIENS,.19,"F",PSBSTOP(0),"PSBRET","PSBFDA")
"RTN","PSBO",43,0)
 D:$G(PSBINCL)]""
"RTN","PSBO",44,0)
 .D VAL^DIE(53.69,PSBIENS,.21,"F",+$P(PSBINCL,"^",1),"PSBRET","PSBFDA")
"RTN","PSBO",45,0)
 .D VAL^DIE(53.69,PSBIENS,.22,"F",+$P(PSBINCL,"^",2),"PSBRET","PSBFDA")
"RTN","PSBO",46,0)
 .D VAL^DIE(53.69,PSBIENS,.23,"F",+$P(PSBINCL,"^",3),"PSBRET","PSBFDA")
"RTN","PSBO",47,0)
 .D VAL^DIE(53.69,PSBIENS,.24,"F",+$P(PSBINCL,"^",4),"PSBRET","PSBFDA")
"RTN","PSBO",48,0)
 .D VAL^DIE(53.69,PSBIENS,.28,"F",+$P(PSBINCL,"^",5),"PSBRET","PSBFDA")
"RTN","PSBO",49,0)
 .D VAL^DIE(53.69,PSBIENS,.29,"F",+$P(PSBINCL,"^",6),"PSBRET","PSBFDA")
"RTN","PSBO",50,0)
 D:$G(PSBFUTR)]""
"RTN","PSBO",51,0)
 .D VAL^DIE(53.69,PSBIENS,.25,"F",+$P(PSBFUTR,"^",1),"PSBRET","PSBFDA")
"RTN","PSBO",52,0)
 .D VAL^DIE(53.69,PSBIENS,.26,"F",+$P(PSBFUTR,"^",2),"PSBRET","PSBFDA")
"RTN","PSBO",53,0)
 .D VAL^DIE(53.69,PSBIENS,.27,"F",+$P(PSBFUTR,"^",3),"PSBRET","PSBFDA")
"RTN","PSBO",54,0)
 .D VAL^DIE(53.69,PSBIENS,.41,"F",+$P(PSBFUTR,"^",4),"PSBRET","PSBFDA")
"RTN","PSBO",55,0)
 D FILE^DIE("","PSBFDA")
"RTN","PSBO",56,0)
 I $G(PSBDEV)]"" D PRINT^PSBO1 S RESULTS=$NAME(^TMP("PSBO",$J)) Q
"RTN","PSBO",57,0)
 D HFSOPEN^PSBUTL("RPC") I POP S ^TMP("PSBO",$J,1)="ERROR: UNABLE TO ACCESS HFS DIRECTORY "_$$GET^XPAR("DIV","PSB HFS SCRATCH"),^TMP("PSBO",$J,2)="PLEASE CHECK DIRECTORY WRITE PRIVILEDGES." Q
"RTN","PSBO",58,0)
 U IO D DQ(+PSBIENS)
"RTN","PSBO",59,0)
 D HFSCLOSE^PSBUTL("RPC")
"RTN","PSBO",60,0)
 S RESULTS=$NAME(^TMP("PSBO",$J))
"RTN","PSBO",61,0)
 D:$G(PSBDEV)]"" PRINT^PSBO1
"RTN","PSBO",62,0)
 Q
"RTN","PSBO",63,0)
 ;
"RTN","PSBO",64,0)
XQ(PSBTYPE) ; Called via Kernel Menus
"RTN","PSBO",65,0)
 N PSBANS,PSBANS1,PSBRPT,PSBSAVE,DA,DIK,DR,DDSFILE
"RTN","PSBO",66,0)
 D NEW^PSBO1(.PSBRPT,PSBTYPE)
"RTN","PSBO",67,0)
 I +PSBRPT(0)<1 W !,"Error: ",$P(PSBRPT(0),U,2) S DIR(0)="E" D ^DIR Q
"RTN","PSBO",68,0)
 S DA=+PSBRPT(0),DR="[PSBO "_PSBTYPE_"]",DDSFILE=53.69 D ^DDS
"RTN","PSBO",69,0)
 W @IOF
"RTN","PSBO",70,0)
 I 'PSBSAVE W !,"Cancelling Request..." S DIK="^PSB(53.69," D ^DIK W "Cancelled!"
"RTN","PSBO",71,0)
 D:PSBSAVE
"RTN","PSBO",72,0)
 .;Check Drug to Patient Relationship.
"RTN","PSBO",73,0)
 .I PSBTYPE="BL" S PSBANS="" D CHECK  I PSBANS=0!($D(DIRUT)) W !,"Cancelling Request..." S DIK="^PSB(53.69," D ^DIK W "Cancelled!" Q
"RTN","PSBO",74,0)
 .;
"RTN","PSBO",75,0)
 .;Allow "'BROWSER" Device
"RTN","PSBO",76,0)
 .S IOP=$$GET1^DIQ(53.69,DA_",",.06,"I"),PSBSIO=0 I IOP]"" D
"RTN","PSBO",77,0)
 ..S IOP="`"_IOP,%ZIS="N"
"RTN","PSBO",78,0)
 ..D ^%ZIS
"RTN","PSBO",79,0)
 ..I IO=IO(0) S PSBSIO=1
"RTN","PSBO",80,0)
 ..D HOME^%ZIS K IOP
"RTN","PSBO",81,0)
 .I $$GET1^DIQ(53.69,DA_",",.06)["BROWSER"!(PSBSIO=1) S IOP=$$GET1^DIQ(53.69,DA_",",.06)_";132" D ^%ZIS U IO D DQ(DA) D ^%ZISC K IOP Q
"RTN","PSBO",82,0)
 .W @IOF,"Submitting Your Report Request to Taskman..."
"RTN","PSBO",83,0)
 .S ZTIO=$$GET1^DIQ(53.69,DA_",",.06)
"RTN","PSBO",84,0)
 .S ZTDTH=$P(^PSB(53.69,DA,0),U,7)
"RTN","PSBO",85,0)
 .S ZTDESC="BCMA - "_$$GET1^DIQ(53.69,DA_",",.05)
"RTN","PSBO",86,0)
 .S ZTRTN="DQ^PSBO("_DA_")"
"RTN","PSBO",87,0)
 .D ^%ZTLOAD
"RTN","PSBO",88,0)
 .W "Submitted!",!,"Your Task Number Is: ",$G(ZTSK),!
"RTN","PSBO",89,0)
 K ^TMP("PSBO",$J)
"RTN","PSBO",90,0)
 Q
"RTN","PSBO",91,0)
 ;
"RTN","PSBO",92,0)
DQ(PSBRPT) ; Dequeue report from Taskman
"RTN","PSBO",93,0)
 N PSBWRD,PSBDFN
"RTN","PSBO",94,0)
 Q:'$D(^PSB(53.69,PSBRPT,0))  ; No Such Report
"RTN","PSBO",95,0)
 S $P(^PSB(53.69,PSBRPT,0),U,8)=$G(ZTSK,"RPC")
"RTN","PSBO",96,0)
 D:$$SETUP @("EN^PSBO"_$P(PSBRPT(0),U,5))
"RTN","PSBO",97,0)
 K ^TMP("PSBO",$J)
"RTN","PSBO",98,0)
 S ZTREQ="@"
"RTN","PSBO",99,0)
 Q
"RTN","PSBO",100,0)
 ;
"RTN","PSBO",101,0)
IOM() ; Returns good margin or not
"RTN","PSBO",102,0)
 Q:IOM'<132 1
"RTN","PSBO",103,0)
 W !,"**************************************************************"
"RTN","PSBO",104,0)
 W !,"* SORRY, Your selected DEVICE does not print 132 columns.    *"
"RTN","PSBO",105,0)
 W !,"**************************************************************"
"RTN","PSBO",106,0)
 W !
"RTN","PSBO",107,0)
 Q 0
"RTN","PSBO",108,0)
 ;
"RTN","PSBO",109,0)
VAL(PSBFLDS) ; Validate that fields in PSBFLDS are filled in
"RTN","PSBO",110,0)
 N PSB,PSBFLD,PSBMSG,PSBSTOP,PSBST,PSBDAYS S PSBSTRT=""
"RTN","PSBO",111,0)
 F PSB=1:1 Q:$P(PSBFLDS,";",PSB)=""  S PSBFLD=$P(PSBFLDS,";",PSB),PSBFLD(PSBFLD)=$$GET^DDSVAL(53.69,DA,PSBFLD)
"RTN","PSBO",112,0)
 I $D(PSBFLD(.11)) K:$E(PSBFLD(.11))="P" PSBFLD(.13),PSBFLD(.15) K:$E(PSBFLD(.11))="W" PSBFLD(.12)
"RTN","PSBO",113,0)
 S PSB=""  F  S PSB=$O(PSBFLD(PSB)) Q:PSB=""  D:PSBFLD(PSB)=""
"RTN","PSBO",114,0)
 .I '$D(PSBMSG) S PSBMSG(0)="UNABLE TO FILE REQUEST",PSBMSG(1)=" ",PSBMSG(2)="ERROR: MISSING DATA - ALL FIELDS ARE REQUIRED",PSBMSG(3)=" "
"RTN","PSBO",115,0)
 .D FIELD^DID(53.69,PSB,"","TITLE;LABEL","PSB")
"RTN","PSBO",116,0)
 .S Z="  Missing Field: "_$S(PSB("TITLE")]"":PSB("TITLE"),1:PSB("LABEL"))
"RTN","PSBO",117,0)
 .S PSBMSG($O(PSBMSG(""),-1)+1)=Z
"RTN","PSBO",118,0)
 ; Check Times
"RTN","PSBO",119,0)
 D:$G(PSBFLD(.16))
"RTN","PSBO",120,0)
 .S PSBSTRT=PSBFLD(.16)+$G(PSBFLD(.17))
"RTN","PSBO",121,0)
 .D:$P($$GET1^DIQ(53.69,DA_",",.01),U)["MH"
"RTN","PSBO",122,0)
 ..S PSBDAYS=$$GET1^DIQ(101.24,$$FIND1^DIC(101.24,"","X","ORRP BCMA MAH","B")_",",.42)  ;check maxdays
"RTN","PSBO",123,0)
 ..S:PSBDAYS="" PSBDAYS=7
"RTN","PSBO",124,0)
 ..S X=PSBSTRT\1 D H^%DTC S PSBST=%H+PSBDAYS    ;Determine stop date
"RTN","PSBO",125,0)
 .S PSBSTOP=$S($G(PSBFLD(.18)):PSBFLD(.18),1:PSBFLD(.16))+$G(PSBFLD(.19))
"RTN","PSBO",126,0)
 .I PSBSTOP<PSBSTRT S Y=$O(PSBMSG(""),-1)+1,PSBMSG(Y)="  Date: Stop Date/Time is before Start Date/Time"
"RTN","PSBO",127,0)
 .I $P($$GET1^DIQ(53.69,DA_",",.01),U)["MH" S X=PSBSTOP\1 D H^%DTC I %H>PSBST S Y=$O(PSBMSG(""),-1)+1,PSBMSG(Y)="  The date range cannot exceed "_PSBDAYS_" day(s) as defined in the CPRS 'MAXIMUM DAYS BACK' parameter"
"RTN","PSBO",128,0)
 Q:'$D(PSBMSG)  ; All is well
"RTN","PSBO",129,0)
 D MSG^DDSUTL(.PSBMSG)
"RTN","PSBO",130,0)
 S DDSERROR=1
"RTN","PSBO",131,0)
 Q
"RTN","PSBO",132,0)
 ;
"RTN","PSBO",133,0)
SETUP() ; Setup parameters for the report in PSBRPT
"RTN","PSBO",134,0)
 N PSBWRDL,PSBINDX,PSBWRDA
"RTN","PSBO",135,0)
 K ^TMP("PSBO",$J)
"RTN","PSBO",136,0)
 F X=0,.1,.2,.3,.4 S PSBRPT(X)=$G(^PSB(53.69,PSBRPT,X))
"RTN","PSBO",137,0)
 I $P(PSBRPT(.1),U,1)="P" S PSBDFN=+$P(PSBRPT(.1),U,2) Q:'PSBDFN  S ^TMP("PSBO",$J,PSBDFN,0)=$P(^DPT(PSBDFN,0),U)_U_$P(^DPT(PSBDFN,0),U,9),^TMP("PSBO",$J,"B",$P(^DPT(PSBDFN,0),U),PSBDFN)=""
"RTN","PSBO",138,0)
 D:$P(PSBRPT(.1),U,1)="W"
"RTN","PSBO",139,0)
 .S PSBWRD=$P(PSBRPT(.1),U,3) Q:'PSBWRD  D WARD^NURSUT5("L^"_PSBWRD,.PSBWRDA)
"RTN","PSBO",140,0)
 .S X="" F  S X=$O(PSBWRDA(PSBWRD,2,X)) Q:X=""   S PSBWRDL=$P(PSBWRDA(PSBWRD,2,X,.01),U,2) D
"RTN","PSBO",141,0)
 ..F PSBDFN=0:0 S PSBDFN=$O(^DPT("CN",PSBWRDL,PSBDFN)) Q:'PSBDFN  D
"RTN","PSBO",142,0)
 ...S ^TMP("PSBO",$J,PSBDFN,0)=$P(^DPT(PSBDFN,0),U)_U_$P(^DPT(PSBDFN,0),U,9)
"RTN","PSBO",143,0)
 ...; Determine Sort or default to Pt Name...
"RTN","PSBO",144,0)
 ...S:$P(PSBRPT(.1),U,5)="P" PSBINDX=$P(^DPT(PSBDFN,0),U)
"RTN","PSBO",145,0)
 ...I $P(PSBRPT(.1),U,5)="B" S PSBINDX=$P($G(^DPT(PSBDFN,.101)),U) S:PSBINDX="" PSBINDX="** NO ROOM BED **"
"RTN","PSBO",146,0)
 ...S:$P(PSBRPT(.1),U,5)="" PSBINDX=$P(^DPT(PSBDFN,0),U)
"RTN","PSBO",147,0)
 ...S:$G(PSBINDX)="" PSBINDX=$P(^DPT(PSBDFN,0),U)
"RTN","PSBO",148,0)
 ...S ^TMP("PSBO",$J,"B",PSBINDX,PSBDFN)=""
"RTN","PSBO",149,0)
 Q 1
"RTN","PSBO",150,0)
 ;
"RTN","PSBO",151,0)
WRAP(X,Y,Z)    ; Quick text wrap
"RTN","PSBO",152,0)
 ;
"RTN","PSBO",153,0)
 ; Input Parameters Description:
"RTN","PSBO",154,0)
 ;  X: Left Column of display [Optional]
"RTN","PSBO",155,0)
 ;  Y: Cols to wrap in [Optional]
"RTN","PSBO",156,0)
 ;  Z: Text to wrap [Optional]
"RTN","PSBO",157,0)
 ;
"RTN","PSBO",158,0)
 N PSB
"RTN","PSBO",159,0)
 F  Q:'$L(Z)  D
"RTN","PSBO",160,0)
 .W:$X>X !
"RTN","PSBO",161,0)
 .W:$X<X ?X
"RTN","PSBO",162,0)
 .I $L(Z)<Y W Z S Z="" Q
"RTN","PSBO",163,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBO",164,0)
 .S:PSB<1 PSB=Y
"RTN","PSBO",165,0)
 .W $E(Z,1,PSB)
"RTN","PSBO",166,0)
 .S Z=$E(Z,PSB+1,250)
"RTN","PSBO",167,0)
 Q ""
"RTN","PSBO",168,0)
 ;
"RTN","PSBO",169,0)
CHECK ;Beginning of PSB*1*10
"RTN","PSBO",170,0)
 K ^TMP("PSJ",$J)
"RTN","PSBO",171,0)
 N PSBDFN,PSBBAR,PSBDRUG,PSBFLAG,PSBPNM,PSBNDX,PSBX
"RTN","PSBO",172,0)
 S PSBFLAG="",PSBBAR=$P($P($G(^PSB(53.69,DA,.3)),U,1),"~",2)
"RTN","PSBO",173,0)
 S PSBDRUG=$$GET1^DIQ(53.69,DA_",",.31)
"RTN","PSBO",174,0)
 S PSBDFN=$$GET1^DIQ(53.69,DA_",",.12,"I") S:$G(PSBDFN) PSBFLAG=1
"RTN","PSBO",175,0)
 D EN^PSJBCMA(PSBDFN)
"RTN","PSBO",176,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBO",177,0)
 .K Y,PSBORD,PSBPNM,PSBNDX
"RTN","PSBO",178,0)
 .M PSBORD=^TMP("PSJ",$J,PSBX)
"RTN","PSBO",179,0)
 .F PSBNDX=700,850,950  D
"RTN","PSBO",180,0)
 ..F Y=0:0 S Y=$O(PSBORD(PSBNDX,Y)) Q:'Y  D
"RTN","PSBO",181,0)
 ...I $P($G(PSBORD(1)),U,7)'="A" Q
"RTN","PSBO",182,0)
 ...S PSBPNM=$P(PSBORD(PSBNDX,Y,0),U,1)
"RTN","PSBO",183,0)
 ...I PSBNDX=700,PSBPNM=PSBBAR S PSBFLAG=0 Q
"RTN","PSBO",184,0)
 ...I PSBNDX=850,$D(^PSDRUG("A526",PSBBAR,PSBPNM)) S PSBFLAG=0 Q
"RTN","PSBO",185,0)
 ...I PSBNDX=950,$D(^PSDRUG("A527",PSBBAR,PSBPNM)) S PSBFLAG=0
"RTN","PSBO",186,0)
 I PSBFLAG=1 D
"RTN","PSBO",187,0)
 .W !,"Patient is not currently on medication: ",PSBDRUG
"RTN","PSBO",188,0)
 .K DIRUT,DIR
"RTN","PSBO",189,0)
 .S DIR("A")="Do you want to continue"
"RTN","PSBO",190,0)
 .S DIR(0)="Y"
"RTN","PSBO",191,0)
 .D ^DIR
"RTN","PSBO",192,0)
 .S PSBANS=+Y W !
"RTN","PSBO1")
0^18^B5347535^B5320169
"RTN","PSBO1",1,0)
PSBO1 ;BIRMINGHAM/EFC-BCMA OUTPUTS ;Mar 2004
"RTN","PSBO1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**4,13**;Mar 2004
"RTN","PSBO1",3,0)
 ;
"RTN","PSBO1",4,0)
 ; Reference/IA
"RTN","PSBO1",5,0)
 ; FILE^DICN/10009
"RTN","PSBO1",6,0)
 ;
"RTN","PSBO1",7,0)
NEW(RESULTS,PSBRTYP) ; Create a new report request
"RTN","PSBO1",8,0)
 ; Called interactively and via RPCBroker
"RTN","PSBO1",9,0)
 K RESULTS
"RTN","PSBO1",10,0)
 ; Check Type
"RTN","PSBO1",11,0)
 I '$F("DL^MD^MH^ML^MM^MV^PE^PM^WA^BL^PI^AL^DO^VT^PF^XA",PSBRTYP) S RESULTS(0)="-1^Invalid Report Type" Q
"RTN","PSBO1",12,0)
 I '+$G(DUZ) S RESULTS(0)="-1^Undefined User" Q
"RTN","PSBO1",13,0)
 I '$G(DUZ(2)) S RESULTS(0)="-1^Undefined Division" Q
"RTN","PSBO1",14,0)
 ; Lock Log
"RTN","PSBO1",15,0)
 L +(^PSB(53.69,0)):30
"RTN","PSBO1",16,0)
 E  S RESULTS(0)="-1^Request Log Locked" Q
"RTN","PSBO1",17,0)
 ; Generate Unique Entry and Create
"RTN","PSBO1",18,0)
 F  D NOW^%DTC S X=$E(%_"000000",1,14) S X=(1700+$E(X,1,3))_$E(X,4,14),X=PSBRTYP_"-"_$TR(X,".","-") Q:'$D(^PSB(53.69,"B",X))
"RTN","PSBO1",19,0)
 S DIC="^PSB(53.69,",DIC(0)="L"
"RTN","PSBO1",20,0)
 S DIC("DR")=".02///N;.03////^S X=DUZ;.04////^S X=DUZ(2);.05///^S X=PSBRTYP"
"RTN","PSBO1",21,0)
 K DD,DO D FILE^DICN
"RTN","PSBO1",22,0)
 L -(^PSB(53.69,0))
"RTN","PSBO1",23,0)
 ; Okay, setup return and Boogie
"RTN","PSBO1",24,0)
 I +Y<1 S RESULTS(0)="-1^Error Creating Request"
"RTN","PSBO1",25,0)
 E  S RESULTS(0)=Y
"RTN","PSBO1",26,0)
 Q
"RTN","PSBO1",27,0)
 ;
"RTN","PSBO1",28,0)
PRINT ;
"RTN","PSBO1",29,0)
 N ZTDTH,ZTRTN,ZTSK,ZTDESC,ZTSAVE,DA
"RTN","PSBO1",30,0)
 S DA=+PSBRPT(0)
"RTN","PSBO1",31,0)
 S IOP=$$GET1^DIQ(53.69,DA_",",.06,"I"),PSBSIO=0 I IOP]"" D
"RTN","PSBO1",32,0)
 .S IOP="`"_IOP,%ZIS="N"
"RTN","PSBO1",33,0)
 .D ^%ZIS
"RTN","PSBO1",34,0)
 .I IO=IO(0) S PSBSIO=1
"RTN","PSBO1",35,0)
 .D HOME^%ZIS K IOP
"RTN","PSBO1",36,0)
 I $$GET1^DIQ(53.69,DA_",",.06)["BROWSER"!(PSBSIO=1) S IOP=$$GET1^DIQ(53.69,DA_",",.06)_";132" D ^%ZIS U IO D DQ^PSBO(DA) D ^%ZISC K IOP Q
"RTN","PSBO1",37,0)
 W @IOF,"Submitting Your Report Request to Taskman..."
"RTN","PSBO1",38,0)
 S ZTIO=$$GET1^DIQ(53.69,DA_",",.06)_";132"
"RTN","PSBO1",39,0)
 S ZTDTH=$H
"RTN","PSBO1",40,0)
 S ZTDESC="BCMA - "_$$GET1^DIQ(53.69,DA_",",.05)
"RTN","PSBO1",41,0)
 S ZTRTN="DQ^PSBO("_DA_")"
"RTN","PSBO1",42,0)
 F I="PSBDFN","PSBTYPE" S ZTSAVE(I)=""
"RTN","PSBO1",43,0)
 I $G(PSBORDNM)]"" S ZTSAVE("PSBORDNM")=""
"RTN","PSBO1",44,0)
 D ^%ZTLOAD
"RTN","PSBO1",45,0)
 I $D(ZTSK) S ^TMP("PSBO",$J,1)="0^Report queued. (Task #"_ZTSK_")"
"RTN","PSBO1",46,0)
 E  S ^TMP("PSBO",$J,1)="-1^Task Rejected."
"RTN","PSBO1",47,0)
 Q
"RTN","PSBO1",48,0)
 ;
"RTN","PSBOHDR")
0^28^B21187983^B19933032
"RTN","PSBOHDR",1,0)
PSBOHDR ;BIRMINGHAM/EFC-REPORT HEADERS ;Mar 2004
"RTN","PSBOHDR",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,13**;Mar 2004
"RTN","PSBOHDR",3,0)
 ;
"RTN","PSBOHDR",4,0)
 ; Reference/IA
"RTN","PSBOHDR",5,0)
 ; EN6^GMRVUTL/1120
"RTN","PSBOHDR",6,0)
 ; WARD^NURSUT5/3052
"RTN","PSBOHDR",7,0)
 ; IN5^VADPT/10061
"RTN","PSBOHDR",8,0)
 ; DEM^VADPT/10061
"RTN","PSBOHDR",9,0)
 ;
"RTN","PSBOHDR",10,0)
PT(DFN,PSBHDR,PSBCONT,PSBDT) ; 
"RTN","PSBOHDR",11,0)
 ; DFN:     Patient File IEN
"RTN","PSBOHDR",12,0)
 ; PSBCONT: True if this is a continuation page
"RTN","PSBOHDR",13,0)
 ; PSBDT:   Date of Pt Information (Default to DT)
"RTN","PSBOHDR",14,0)
 W:$Y>1 @IOF
"RTN","PSBOHDR",15,0)
 W:$X>1 !
"RTN","PSBOHDR",16,0)
 S:'$G(PSBDT) PSBDT=DT
"RTN","PSBOHDR",17,0)
 ; BUILD PSBHDR WITH ALL HEADER STUFF
"RTN","PSBOHDR",18,0)
 D:'$D(PSBHDR("NAME"))
"RTN","PSBOHDR",19,0)
 .S VAIP("D")="LAST"
"RTN","PSBOHDR",20,0)
 .D DEM^VADPT,IN5^VADPT
"RTN","PSBOHDR",21,0)
 .S PSBHDR("NAME")=VADM(1)
"RTN","PSBOHDR",22,0)
 .S PSBHDR("SSN")=$P(VADM(2),U,2)
"RTN","PSBOHDR",23,0)
 .S PSBHDR("DOB")=$P(VADM(3),U,2)
"RTN","PSBOHDR",24,0)
 .S PSBHDR("AGE")=VADM(4)
"RTN","PSBOHDR",25,0)
 .S PSBHDR("SEX")=$P(VADM(5),U,2)
"RTN","PSBOHDR",26,0)
 .S PSBHDR("MVMTTYPE")=$P(VAIP(2),U,2)
"RTN","PSBOHDR",27,0)
 .S PSBHDR("MVMTLAST")=$P(VAIP(3),U,2)
"RTN","PSBOHDR",28,0)
 .S PSBHDR("WARD")=$P(VAIP(5),U,2)
"RTN","PSBOHDR",29,0)
 .S PSBHDR("ROOM")=$P(VAIP(6),U,2)
"RTN","PSBOHDR",30,0)
 .S PSBHDR("DX")=VAIP(9)
"RTN","PSBOHDR",31,0)
 .K VAIP,VADM
"RTN","PSBOHDR",32,0)
 .S GMRVSTR="HT" D EN6^GMRVUTL
"RTN","PSBOHDR",33,0)
 .S X=+$P(X,U,8) S:X X=X*2.54\1 S PSBHDR("HEIGHT")=$S(X:X_"cm",1:"*")
"RTN","PSBOHDR",34,0)
 .S GMRVSTR="WT" D EN6^GMRVUTL
"RTN","PSBOHDR",35,0)
 .S X=+$P(X,U,8) S:X X=X*.45\1 S PSBHDR("WEIGHT")=$S(X:X_"kg",1:"*")
"RTN","PSBOHDR",36,0)
 .N PSBADRX D ALLR^PSBALL(.PSBADRX,DFN) S X=0,Y=""
"RTN","PSBOHDR",37,0)
 .F  S X=$O(PSBADRX(X)) Q:'X  D
"RTN","PSBOHDR",38,0)
 ..Q:$P(PSBADRX(X),U,1)'="ADR"  S Z=$P(PSBADRX(X),U,2) Q:Z=""
"RTN","PSBOHDR",39,0)
 ..I $L(Y_Z)>(IOM-22) S PSBHDR("REAC",$O(PSBHDR("REAC",""),-1)+1)=Y,Y=""
"RTN","PSBOHDR",40,0)
 ..S Y=Y_$S(Y]"":", ",1:"")_$P(PSBADRX(X),U,2)
"RTN","PSBOHDR",41,0)
 .S:Y]"" PSBHDR("REAC",$O(PSBHDR("REAC",""),-1)+1)=Y
"RTN","PSBOHDR",42,0)
 .I '$D(PSBHDR("REAC")) S PSBHDR("REAC",1)="No ADRs on file."
"RTN","PSBOHDR",43,0)
 .D PSBALG
"RTN","PSBOHDR",44,0)
 .K GMRAL,GMRVSTR,GMRA,PSBARX
"RTN","PSBOHDR",45,0)
 .D NOW^%DTC S Y=+$E(%,1,12) D D^DIQ S PSBHDR("DATE")="Run Date: "_Y
"RTN","PSBOHDR",46,0)
 .S PSBHDR("PAGE")=0
"RTN","PSBOHDR",47,0)
 W $C(13),$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",48,0)
 W !,$G(PSBHDR(0))
"RTN","PSBOHDR",49,0)
 W !,$G(PSBHDR(1)),?(IOM-$L(PSBHDR("DATE"))),PSBHDR("DATE")
"RTN","PSBOHDR",50,0)
 S PSBHDR("PAGE")=PSBHDR("PAGE")+1
"RTN","PSBOHDR",51,0)
 W !,$G(PSBHDR(2)),?(IOM-10),$J("Page: "_PSBHDR("PAGE"),10)
"RTN","PSBOHDR",52,0)
 F X=3:1 Q:'$D(PSBHDR(X))  W !,PSBHDR(X)  ; More Lines If Needed
"RTN","PSBOHDR",53,0)
 I $G(PSBCONT) W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***"
"RTN","PSBOHDR",54,0)
 W !!,"Patient:",?10,PSBHDR("NAME")
"RTN","PSBOHDR",55,0)
 W ?40,"SSN:       ",PSBHDR("SSN")
"RTN","PSBOHDR",56,0)
 W ?75,"DOB:",?82,PSBHDR("DOB")," (",PSBHDR("AGE"),")"
"RTN","PSBOHDR",57,0)
 D:'$G(PSBCONT)
"RTN","PSBOHDR",58,0)
 .W !,"Sex: ",?10,PSBHDR("SEX"),?40,"Ht/Wt:     ",PSBHDR("HEIGHT"),"/",PSBHDR("WEIGHT"),?75,"Ward: ",?82,PSBHDR("WARD")," Rm ",PSBHDR("ROOM")
"RTN","PSBOHDR",59,0)
 .W !,"Dx:",?10,PSBHDR("DX"),?40,"Last Mvmt: ",PSBHDR("MVMTLAST"),?75,"Type:  ",PSBHDR("MVMTTYPE")
"RTN","PSBOHDR",60,0)
 .; Reactions/Allergies
"RTN","PSBOHDR",61,0)
 .W !!,"ADRs:"
"RTN","PSBOHDR",62,0)
 .F X=0:0 S X=$O(PSBHDR("REAC",X)) Q:'X  W:$X>12 ! W ?12,PSBHDR("REAC",X)
"RTN","PSBOHDR",63,0)
 .W !!,"Allergies:"
"RTN","PSBOHDR",64,0)
 .F X=0:0 S X=$O(PSBHDR("ALERGY",X)) Q:'X  W:$X>12 ! W ?12,PSBHDR("ALERGY",X)
"RTN","PSBOHDR",65,0)
 .; Local Mods Allowed Here and showup only on First Page
"RTN","PSBOHDR",66,0)
 .; Immunizations
"RTN","PSBOHDR",67,0)
 .;D SHOT80^ASFSHOTF
"RTN","PSBOHDR",68,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",69,0)
 Q
"RTN","PSBOHDR",70,0)
 ;
"RTN","PSBOHDR",71,0)
WARD(PSBWP,PSBHDR,PSBCONT,PSBDT) ; 
"RTN","PSBOHDR",72,0)
 ; WARD:    Nurse Location File IEN
"RTN","PSBOHDR",73,0)
 ; PSBCONT: True if this is a continuation page
"RTN","PSBOHDR",74,0)
 ; PSBDT:   Date of Pt Information (Default to DT)
"RTN","PSBOHDR",75,0)
 N PSBWRDA
"RTN","PSBOHDR",76,0)
 S:'$G(PSBDT) PSBDT=DT
"RTN","PSBOHDR",77,0)
 I '$D(PSBHDR("DATE")) D NOW^%DTC S Y=+$E(%,1,12) D D^DIQ S PSBHDR("DATE")="Run Date: "_Y
"RTN","PSBOHDR",78,0)
 S:'$D(PSBHDR("PAGE")) PSBHDR("PAGE")=0
"RTN","PSBOHDR",79,0)
 W:$Y>1 @IOF
"RTN","PSBOHDR",80,0)
 W:$X>0 !
"RTN","PSBOHDR",81,0)
 W $TR($J("",IOM)," ","="),!,$G(PSBHDR(0)),!,$G(PSBHDR(1)),?(IOM-$L(PSBHDR("DATE"))),PSBHDR("DATE")
"RTN","PSBOHDR",82,0)
 S PSBHDR("PAGE")=PSBHDR("PAGE")+1
"RTN","PSBOHDR",83,0)
 W !,$G(PSBHDR(2)),?(IOM-10),$J("Page: "_PSBHDR("PAGE"),10)
"RTN","PSBOHDR",84,0)
 F X=3:1 Q:'$D(PSBHDR(X))  W !,PSBHDR(X)  ; More Lines If Needed
"RTN","PSBOHDR",85,0)
 I $G(PSBCONT) W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***"
"RTN","PSBOHDR",86,0)
 D WARD^NURSUT5("L^"_PSBWP,.PSBWRDA)
"RTN","PSBOHDR",87,0)
 W !!,"Ward Location: "_$P(PSBWRDA(PSBWP,.01),U,2)
"RTN","PSBOHDR",88,0)
 S X="Division: "_$P(PSBWRDA(PSBWP,.02),U,2)
"RTN","PSBOHDR",89,0)
 W ?(IOM-$L(X)),X,!,$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",90,0)
 Q
"RTN","PSBOHDR",91,0)
 ;
"RTN","PSBOHDR",92,0)
PSBALG   ;
"RTN","PSBOHDR",93,0)
 S YA=""
"RTN","PSBOHDR",94,0)
 K PSBAL,GMRALA
"RTN","PSBOHDR",95,0)
 S PSBLIST=""
"RTN","PSBOHDR",96,0)
 D ALLR^PSBALL(.GMRALA,DFN)
"RTN","PSBOHDR",97,0)
 S X="" F  S X=$O(GMRALA(X)) Q:X=""  D
"RTN","PSBOHDR",98,0)
 .I $P(GMRALA(X),U,1)["ALL" D
"RTN","PSBOHDR",99,0)
 ..S PSBAL($P(GMRALA(X),U,2))=""
"RTN","PSBOHDR",100,0)
 S XAB="" F  S XAB=$O(PSBAL(XAB)) Q:XAB=""  D
"RTN","PSBOHDR",101,0)
 .S Z=XAB
"RTN","PSBOHDR",102,0)
 .I $L(YA_Z)>(IOM-22) S PSBHDR("ALERGY",$O(PSBHDR("ALERGY",""),-1)+1)=YA,YA=""
"RTN","PSBOHDR",103,0)
 .S YA=YA_$S(YA]"":", ",1:"")_XAB
"RTN","PSBOHDR",104,0)
 S:YA]"" PSBHDR("ALERGY",$O(PSBHDR("ALERGY",""),-1)+1)=YA
"RTN","PSBOHDR",105,0)
 I '$D(PSBHDR("ALERGY")) S PSBHDR("ALERGY",1)="No Allergies on file."
"RTN","PSBOHDR",106,0)
 Q
"RTN","PSBOHDR",107,0)
 ;
"RTN","PSBOHDR",108,0)
PTFTR() ; [Extrinsic] Patient Page footer
"RTN","PSBOHDR",109,0)
 ;
"RTN","PSBOHDR",110,0)
 I (IOSL<100) F  Q:$Y>(IOSL-6)  W !
"RTN","PSBOHDR",111,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",112,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBOHDR",113,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBOHDR",114,0)
 I $G(PSBUNK) S X="Note:  ??  Indicates an administration with an *UNKNOWN* Action Status" W !!,X
"RTN","PSBOHDR",115,0)
 Q ""
"RTN","PSBOHDR",116,0)
 ;
"RTN","PSBOPM")
0^27^B77561765^B76255661
"RTN","PSBOPM",1,0)
PSBOPM ;BIRMINGHAM/BSR-BCMA OIT HISTORY ;Mar 2004
"RTN","PSBOPM",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,9,13**;Mar 2004
"RTN","PSBOPM",3,0)
 ;
"RTN","PSBOPM",4,0)
 ; Reference/IA
"RTN","PSBOPM",5,0)
 ; File 50.7/2880
"RTN","PSBOPM",6,0)
 ; File 52.6/436
"RTN","PSBOPM",7,0)
 ; File 52.7/437
"RTN","PSBOPM",8,0)
 ; File 200/10060
"RTN","PSBOPM",9,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBOPM",10,0)
 ;
"RTN","PSBOPM",11,0)
 ;
"RTN","PSBOPM",12,0)
 ;
"RTN","PSBOPM",13,0)
EN ;
"RTN","PSBOPM",14,0)
 N PSBHDR,DFN
"RTN","PSBOPM",15,0)
 S PSBGBL="^TMP(""PSBO"",$J,""B"")"
"RTN","PSBOPM",16,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,2)'=$J  Q:$QS(PSBGBL,1)'["PSBO"  D
"RTN","PSBOPM",17,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBOPM",18,0)
 I '$G(DFN) W !,("Error: No Patient IEN")  Q
"RTN","PSBOPM",19,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBOPM",20,0)
 S PSBSTOP=$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOPM",21,0)
 S PSBCOM=$P(PSBRPT(.2),"^",8)   ;COMMENT FLAG 1 MEANS YES
"RTN","PSBOPM",22,0)
 I PSBSTRT="0" D
"RTN","PSBOPM",23,0)
 .D NOW^%DTC S PSBSTOP=%
"RTN","PSBOPM",24,0)
 .S X1=((PSBSTOP)\1) S X2=-$$GET^XPAR("ALL","PSB MED HIST DAYS BACK")
"RTN","PSBOPM",25,0)
 .S:X2'<0 X2=-30 D C^%DTC  S PSBSTRT=X
"RTN","PSBOPM",26,0)
 .S PSBCOM=$$GET^XPAR("ALL","PSB RPT INCL COMMENTS")
"RTN","PSBOPM",27,0)
 D OUT(DFN,PSBSTRT,PSBSTOP,PSBORDNM)
"RTN","PSBOPM",28,0)
 Q
"RTN","PSBOPM",29,0)
 ;
"RTN","PSBOPM",30,0)
OUT(DFN,PSBSTRT,PSBSTOP,PSBORDNM)        ;
"RTN","PSBOPM",31,0)
 D CLEANALL ;CLEAN UP VARIABLES AND TMP ARRAY
"RTN","PSBOPM",32,0)
 ;
"RTN","PSBOPM",33,0)
 ;IF PSBORDNM DOES NOT CONTAIN A "U" OR A "V" ASSUME THAT THE CALL
"RTN","PSBOPM",34,0)
 ;IS PASSING AND ORDERABLE ITEM AND SKIP THE ORDER LOOKUP PORTION
"RTN","PSBOPM",35,0)
 ;THIS MAINTAINS BACKWARD COMPATABILITY WITH HISTORY^PSBMLHS
"RTN","PSBOPM",36,0)
 I PSBORDNM'["U",PSBORDNM'["V" D
"RTN","PSBOPM",37,0)
 .I PSBORDNM]"" S TMP("PSBOIS",$J,PSBORDNM)=""
"RTN","PSBOPM",38,0)
 E  D 
"RTN","PSBOPM",39,0)
 .D GETORDN
"RTN","PSBOPM",40,0)
 .D GETOIS
"RTN","PSBOPM",41,0)
 D GETADSO ;  GET ALL ADDITIVES AND SOLUTIONS
"RTN","PSBOPM",42,0)
 D FINDIENS ; FIND ALL THE MED LOG ENTRIES THAT SHOULD BE ON THE REPORT
"RTN","PSBOPM",43,0)
 D PREOUT ;   WRITE DATA TO GLOBAL
"RTN","PSBOPM",44,0)
 D WRITEOT ;
"RTN","PSBOPM",45,0)
 D CLEANSUM ; CLEAN UP AND LEAVE LIST OF IENS FOR THE REPORT.
"RTN","PSBOPM",46,0)
 Q
"RTN","PSBOPM",47,0)
 ;
"RTN","PSBOPM",48,0)
GETORDN ;
"RTN","PSBOPM",49,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBOPM",50,0)
 D EN^PSJBCMA1(DFN,PSBORDNM,1)
"RTN","PSBOPM",51,0)
 Q
"RTN","PSBOPM",52,0)
 ;
"RTN","PSBOPM",53,0)
GETOIS  ; BUILD LIST OF ALL ORDERABLE ITEMS 
"RTN","PSBOPM",54,0)
 ;  ASSOCIATED WITH THIS ORDER INTO PSBOIS(#) 
"RTN","PSBOPM",55,0)
 ;
"RTN","PSBOPM",56,0)
 ;UNIT DOSE ORDER ONLY HAVE ONE OI
"RTN","PSBOPM",57,0)
 I PSBORDNM["U" D
"RTN","PSBOPM",58,0)
 .S PSBOI=$P(^TMP("PSJ1",$J,2),"^")
"RTN","PSBOPM",59,0)
 .S PSBOI=$S(PSBOI["U":$TR(PSBOI,"U",""),PSBOI["V":$TR(PSBOI,"V",""),1:PSBOI)
"RTN","PSBOPM",60,0)
 .S TMP("PSBOIS",$J,PSBOI)=""
"RTN","PSBOPM",61,0)
 ;
"RTN","PSBOPM",62,0)
 ;IV ORDERS NEED TO USE THE ADDITIVE AND SOLUTION NUMBER TO BACK
"RTN","PSBOPM",63,0)
 ;TRACK TO THE OI ASSOCIATED WITH IT
"RTN","PSBOPM",64,0)
 I PSBORDNM["V" D
"RTN","PSBOPM",65,0)
 .;GET ADDITIVES OFF THE ORDER
"RTN","PSBOPM",66,0)
 .I $G(^TMP("PSJ1",$J,850,0))  D
"RTN","PSBOPM",67,0)
 ..S XXX="" F  S XXX=$O(^TMP("PSJ1",$J,850,XXX)) Q:XXX=""  D
"RTN","PSBOPM",68,0)
 ...S XXY="" F  S XXY=$O(^TMP("PSJ1",$J,850,XXX,XXY)) Q:XXY=""  D
"RTN","PSBOPM",69,0)
 ....S PSBADD=$P(^TMP("PSJ1",$J,850,XXX,XXY),"^")
"RTN","PSBOPM",70,0)
 ....;
"RTN","PSBOPM",71,0)
 ....;CONVERT ADDITIVE TO ORDERABLE ITEM AND ADD TO LIST
"RTN","PSBOPM",72,0)
 ....S TMP("PSBOIS",$J,$$OFROMA(PSBADD))=""
"RTN","PSBOPM",73,0)
 .;   GET SOLUTIONS OFF THE ORDER
"RTN","PSBOPM",74,0)
 .I $G(^TMP("PSJ1",$J,950,0))  D
"RTN","PSBOPM",75,0)
 ..S XXX="" F  S XXX=$O(^TMP("PSJ1",$J,950,XXX)) Q:XXX=""  D
"RTN","PSBOPM",76,0)
 ...S XXY="" F  S XXY=$O(^TMP("PSJ1",$J,950,XXX,XXY)) Q:XXY=""  D
"RTN","PSBOPM",77,0)
 ....S PSBSOL=$P(^TMP("PSJ1",$J,950,XXX,XXY),"^")
"RTN","PSBOPM",78,0)
 ....;
"RTN","PSBOPM",79,0)
 ....;CONVERT SOLUTIOIN TO ORDERABLE ITEM AND ADD TO LIST
"RTN","PSBOPM",80,0)
 ....S TMP("PSBOIS",$J,$$OFROMS(PSBSOL))=""
"RTN","PSBOPM",81,0)
 Q
"RTN","PSBOPM",82,0)
 ;
"RTN","PSBOPM",83,0)
OFROMA(PSBADD) ;GET ORDERABLE ITEM FROM AN ADDITIVE
"RTN","PSBOPM",84,0)
 Q $$GET1^DIQ(52.6,PSBADD_",",15,"I")
"RTN","PSBOPM",85,0)
 ; 
"RTN","PSBOPM",86,0)
OFROMS(PSBSOL) ; GET ORDERABLE ITEM FROM A SOLUTION
"RTN","PSBOPM",87,0)
 Q $$GET1^DIQ(52.7,PSBSOL_",",9,"I")
"RTN","PSBOPM",88,0)
 ;
"RTN","PSBOPM",89,0)
GETADSO ; GET ALL ADDITIVES FOR ALL ORDERABLE ITEMS
"RTN","PSBOPM",90,0)
 K PSBAOUT,PSBSOUT
"RTN","PSBOPM",91,0)
 S XA="" F  S XA=$O(TMP("PSBOIS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",92,0)
 .D LIST^DIC(52.6,"","@;15I","QPI","","","","AOI","","","PSBAOUT")
"RTN","PSBOPM",93,0)
 .S XB=0 F  S XB=$O(PSBAOUT("DILIST",XB)) Q:XB=""  D
"RTN","PSBOPM",94,0)
 ..I $P(PSBAOUT("DILIST",XB,0),"^",2)=XA D
"RTN","PSBOPM",95,0)
 ...S TMP("PSBADDS",$J,$P(PSBAOUT("DILIST",XB,0),"^",1))=""
"RTN","PSBOPM",96,0)
 K PSBAOUT
"RTN","PSBOPM",97,0)
 ;
"RTN","PSBOPM",98,0)
 ; GET ALL SOLUTIONS FOR ALL ORDERABLE ITEMS
"RTN","PSBOPM",99,0)
 S XA="" F  S XA=$O(TMP("PSBOIS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",100,0)
 .D LIST^DIC(52.7,"","@;9I","QPI","","","","AOI","","","PSBSOUT")
"RTN","PSBOPM",101,0)
 .S XB=0 F  S XB=$O(PSBSOUT("DILIST",XB)) Q:XB=""  D
"RTN","PSBOPM",102,0)
 ..I $P(PSBSOUT("DILIST",XB,0),"^",1)=XA D
"RTN","PSBOPM",103,0)
 ...S TMP("PSBSOLS",$J,$P(PSBSOUT("DILIST",XB,0),"^",1))=""
"RTN","PSBOPM",104,0)
 K PSBSOUT
"RTN","PSBOPM",105,0)
 Q
"RTN","PSBOPM",106,0)
 ;
"RTN","PSBOPM",107,0)
FINDIENS ; USE PSBOIS,PSBADDS AND PSBSOLS TO FIND ALL IENS FOR THE RPT
"RTN","PSBOPM",108,0)
 ;SEARCH FOR UNIT DOSE IENS
"RTN","PSBOPM",109,0)
 I $D(TMP("PSBOIS",$J)) S XA="" F  S XA=$O(TMP("PSBOIS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",110,0)
 .S PSBDT=PSBSTRT F  S PSBDT=$O(^PSB(53.79,"AOIP",DFN,XA,PSBDT)) Q:PSBDT=""!(PSBDT>PSBSTOP)  D
"RTN","PSBOPM",111,0)
 ..S PSBIEN="" F  S PSBIEN=$O(^PSB(53.79,"AOIP",DFN,XA,PSBDT,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBOPM",112,0)
 ...Q:$P(^PSB(53.79,PSBIEN,0),U,9)="N"
"RTN","PSBOPM",113,0)
 ...S TMP("PSBIENS",$J,$$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),PSBIEN)=""
"RTN","PSBOPM",114,0)
 ;
"RTN","PSBOPM",115,0)
 ;SEARCH FOR ADDITIVES
"RTN","PSBOPM",116,0)
 I $D(TMP("PSBADDS",$J)) S XA="" F  S XA=$O(TMP("PSBADDS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",117,0)
 .S PSBIEN="" F  S PSBIEN=$O(^PSB(53.79,"AOIP3",DFN,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBOPM",118,0)
 ..S XB="" F  S XB=$O(^PSB(53.79,"AOIP3",DFN,PSBIEN,XB)) Q:XB=""  D
"RTN","PSBOPM",119,0)
 ...Q:XB'=XA
"RTN","PSBOPM",120,0)
 ...Q:$P(^PSB(53.79,PSBIEN,0),U,9)="N"
"RTN","PSBOPM",121,0)
 ...I $P(^PSB(53.79,PSBIEN,0),"^",6)>PSBSTRT,($P(^PSB(53.79,PSBIEN,0),"^",6)<PSBSTOP)  D
"RTN","PSBOPM",122,0)
 ....S TMP("PSBIENS",$J,$$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),PSBIEN)=""
"RTN","PSBOPM",123,0)
 ;
"RTN","PSBOPM",124,0)
 ;SEARCH FOR SOLUTIONS
"RTN","PSBOPM",125,0)
 I $D(TMP("PSBSOLS",$J)) S XA="" F  S XA=$O(TMP("PSBSOLS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",126,0)
 .S PSBIEN="" F  S PSBIEN=$O(^PSB(53.79,"AOIP4",DFN,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBOPM",127,0)
 ..S XB="" F  S XB=$O(^PSB(53.79,"AOIP4",DFN,PSBIEN,XB)) Q:XB=""  D
"RTN","PSBOPM",128,0)
 ...Q:XB'=XA
"RTN","PSBOPM",129,0)
 ...Q:$P(^PSB(53.79,PSBIEN,0),U,9)="N"
"RTN","PSBOPM",130,0)
 ...I $P(^PSB(53.79,PSBIEN,0),"^",6)>PSBSTRT,($P(^PSB(53.79,PSBIEN,0),"^",6)<PSBSTOP)  D
"RTN","PSBOPM",131,0)
 ....S TMP("PSBIENS",$J,$$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),PSBIEN)=""
"RTN","PSBOPM",132,0)
 Q
"RTN","PSBOPM",133,0)
 ;
"RTN","PSBOPM",134,0)
PREOUT ;
"RTN","PSBOPM",135,0)
 K PSBUNK S XDT="" F  S XDT=$O(TMP("PSBIENS",$J,XDT),-1) Q:XDT=""  S I="",I=$O(TMP("PSBIENS",$J,XDT,I)) D
"RTN","PSBOPM",136,0)
 .S PSBIEN=I
"RTN","PSBOPM",137,0)
 .S PSBIENS=PSBIEN_","
"RTN","PSBOPM",138,0)
 .D OUTPUT
"RTN","PSBOPM",139,0)
 Q
"RTN","PSBOPM",140,0)
 ;
"RTN","PSBOPM",141,0)
OUTPUT  ;
"RTN","PSBOPM",142,0)
 S PSBSPC=$J("",80)
"RTN","PSBOPM",143,0)
 S W=$E($$GET1^DIQ(53.79,PSBIENS,.02)_PSBSPC,1,20)_" "
"RTN","PSBOPM",144,0)
 S W=W_$S($P(^PSB(53.79,PSBIEN,0),U,9)="":"?? ",1:$E($P(^PSB(53.79,PSBIEN,0),U,9)_"  ",1,2)_" ")
"RTN","PSBOPM",145,0)
 S:$P(^PSB(53.79,PSBIEN,0),U,9)="" PSBUNK=1
"RTN","PSBOPM",146,0)
 S W=W_$E($P($G(^PSB(53.79,PSBIEN,.1)),U,2)_PSBSPC,1,2)_"  "
"RTN","PSBOPM",147,0)
 S W=W_$E($E($$GET1^DIQ(53.79,PSBIENS,.06),1,18)_PSBSPC,1,21)_" "
"RTN","PSBOPM",148,0)
 S W=W_$E($$GET1^DIQ(53.79,PSBIENS,"ACTION BY:INITIAL")_PSBSPC,1,10)_" "
"RTN","PSBOPM",149,0)
 S W=W_$$GET1^DIQ(53.79,PSBIENS,.16)
"RTN","PSBOPM",150,0)
 D ADD(W)
"RTN","PSBOPM",151,0)
 F PSBNODE=.5,.6,.7 D
"RTN","PSBOPM",152,0)
 .S PSBDD=$S(PSBNODE=.5:53.795,PSBNODE=.6:53.796,1:53.797)
"RTN","PSBOPM",153,0)
 .F PSBY=0:0 S PSBY=$O(^PSB(53.79,PSBIEN,PSBNODE,PSBY)) Q:'PSBY  D
"RTN","PSBOPM",154,0)
 ..D WRAPMEDS($$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.01),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.03),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.04))
"RTN","PSBOPM",155,0)
 I PSBCOM=1  D COMNTS   ;GETS COMMENTS
"RTN","PSBOPM",156,0)
 D ADD("")
"RTN","PSBOPM",157,0)
 Q
"RTN","PSBOPM",158,0)
 ;
"RTN","PSBOPM",159,0)
COMNTS  ;
"RTN","PSBOPM",160,0)
 N Z,CNT
"RTN","PSBOPM",161,0)
 S Z="",CNT=0
"RTN","PSBOPM",162,0)
 I $D(^PSB(53.79,PSBIEN,.3,0)) D
"RTN","PSBOPM",163,0)
 .D ADD("")
"RTN","PSBOPM",164,0)
 .D ADD($J("",44)_"Comments: "_$$MAKELINE("-",78))
"RTN","PSBOPM",165,0)
 .S XT="" F  S XT=$O(^PSB(53.79,PSBIEN,.3,XT)) Q:XT=""  I XT'=0  D
"RTN","PSBOPM",166,0)
 ..D:CNT=1 ADD("")
"RTN","PSBOPM",167,0)
 ..S Y=$P(^PSB(53.79,PSBIEN,.3,XT,0),"^",3) D DD^%DT S XBR=Y
"RTN","PSBOPM",168,0)
 ..S Z=XBR_"   "_$P(^VA(200,$P(^PSB(53.79,PSBIEN,.3,XT,0),"^",2),0),"^",2)
"RTN","PSBOPM",169,0)
 ..D WRAP($P(^PSB(53.79,PSBIEN,.3,XT,0),"^",1),Z,PSBIEN)
"RTN","PSBOPM",170,0)
 ..S CNT=1
"RTN","PSBOPM",171,0)
 .D ADD($J("",54)_$$MAKELINE("-",78))
"RTN","PSBOPM",172,0)
 Q
"RTN","PSBOPM",173,0)
        ;
"RTN","PSBOPM",174,0)
WRAP(SIZE,ZP,BRIEN)         ;
"RTN","PSBOPM",175,0)
 D ADD($J("",55)_ZP)
"RTN","PSBOPM",176,0)
 D ADD($J("",55)_$E(SIZE,1,75))
"RTN","PSBOPM",177,0)
 I $L(SIZE)>75 D ADD($J("",55)_$E(SIZE,76,150))
"RTN","PSBOPM",178,0)
 Q
"RTN","PSBOPM",179,0)
 ;
"RTN","PSBOPM",180,0)
HEADA ;
"RTN","PSBOPM",181,0)
 W !
"RTN","PSBOPM",182,0)
 W "Location",?21,"St Sch Administration Date",?50,"By",?61,"Injection Site",?96,"Units",?112,"Units of"
"RTN","PSBOPM",183,0)
 W !,?55,"Medication & Dosage",?96,"GIVEN",?112,"Administration"
"RTN","PSBOPM",184,0)
 W !
"RTN","PSBOPM",185,0)
 W $$MAKELINE("-",132)
"RTN","PSBOPM",186,0)
 Q
"RTN","PSBOPM",187,0)
 ;
"RTN","PSBOPM",188,0)
ADD(XE)  ;
"RTN","PSBOPM",189,0)
 S ^TMP("PSB",$J,$O(^TMP("PSB",$J,""),-1)+1)=XE
"RTN","PSBOPM",190,0)
 Q
"RTN","PSBOPM",191,0)
 ;
"RTN","PSBOPM",192,0)
WRAPMEDS(MED,UG,UOA)  ;
"RTN","PSBOPM",193,0)
 ;MED IS NOT WRAPPED: MAX LENGTH IN PSDRUG/52.6/52.7 IS 40
"RTN","PSBOPM",194,0)
 ;UG/UOA MAX AT 30/40 AND WILL BE WRAPPED AT 15 EACH
"RTN","PSBOPM",195,0)
 ;THIS WILL CREATE UPTO 3 LINES
"RTN","PSBOPM",196,0)
 S MED=$E(MED_$J("",40),1,40)
"RTN","PSBOPM",197,0)
 N UGWRAP
"RTN","PSBOPM",198,0)
 S (CNTX,UOA1,UOA16,UOA31)=""
"RTN","PSBOPM",199,0)
 I +$G(UG)?1"."1.N S UG=0_+UG
"RTN","PSBOPM",200,0)
 F CNT=1:15:45  D
"RTN","PSBOPM",201,0)
 .D PARSE(UOA,CNT)
"RTN","PSBOPM",202,0)
 .S UGWRAP=$E(UG,CNT,(CNT+14))
"RTN","PSBOPM",203,0)
 .I CNT=1 D ADD($J("",55)_MED_" "_$$PAD(UGWRAP,15)_" "_$$PAD(UOA1,15))
"RTN","PSBOPM",204,0)
 .I (CNT>1),($L(UGWRAP)>0!$L(@("UOA"_CNT))>0) D ADD($J("",96)_$$PAD(UGWRAP,15)_" "_$$PAD(@("UOA"_CNT),15))
"RTN","PSBOPM",205,0)
 Q
"RTN","PSBOPM",206,0)
 ;
"RTN","PSBOPM",207,0)
PAD(X,CNT) ;
"RTN","PSBOPM",208,0)
 Q $E(X_$J("",CNT),1,CNT)
"RTN","PSBOPM",209,0)
WRITEOT ;
"RTN","PSBOPM",210,0)
 S Y=$P(PSBSTRT,".",1)  D D^DIQ  S PSTRTA=Y
"RTN","PSBOPM",211,0)
 S Y=$P(PSBSTOP,".",1)  D D^DIQ  S PSTP=Y
"RTN","PSBOPM",212,0)
 S PSBHDR(1)="MEDICATION HISTORY for "_PSTRTA_"  to  "_PSTP
"RTN","PSBOPM",213,0)
 D MEDS
"RTN","PSBOPM",214,0)
 D PT^PSBOHDR(DFN,.PSBHDR),HEADA
"RTN","PSBOPM",215,0)
 I '$D(TMP("PSBIENS",$J)) D ADD("<<<< NO HISTORY FOUND FOR THIS TIME FRAME >>>>")
"RTN","PSBOPM",216,0)
 S EX="" F  S EX=$O(^TMP("PSB",$J,EX)) Q:EX=""  D
"RTN","PSBOPM",217,0)
 .I $Y>(IOSL-5) D
"RTN","PSBOPM",218,0)
 ..W $$PTFTR^PSBOHDR()
"RTN","PSBOPM",219,0)
 ..D PT^PSBOHDR(DFN,.PSBHDR),HEADA
"RTN","PSBOPM",220,0)
 .W !,$G(^TMP("PSB",$J,EX))
"RTN","PSBOPM",221,0)
 W $$PTFTR^PSBOHDR()
"RTN","PSBOPM",222,0)
 Q
"RTN","PSBOPM",223,0)
 ;
"RTN","PSBOPM",224,0)
FTR() ;
"RTN","PSBOPM",225,0)
 I (IOSL<100) F  Q:$Y>(IOSL-10)  W !
"RTN","PSBOPM",226,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOPM",227,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBOPM",228,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBOPM",229,0)
 Q ""
"RTN","PSBOPM",230,0)
 ;
"RTN","PSBOPM",231,0)
MEDS ;
"RTN","PSBOPM",232,0)
 N MED,XA,XB
"RTN","PSBOPM",233,0)
 S MED="",XB=3
"RTN","PSBOPM",234,0)
 S PSBHDR(3)="MEDICATIONS SEARCH LIST:"
"RTN","PSBOPM",235,0)
 S XA="" F  S XA=$O(TMP("PSBOIS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",236,0)
 .S MED=$$GET1^DIQ(50.7,XA,.01)
"RTN","PSBOPM",237,0)
 .I $L(PSBHDR(XB)_" "_MED)>IOM D
"RTN","PSBOPM",238,0)
 ..S XB=XB+1,PSBHDR(XB)="                         "_MED
"RTN","PSBOPM",239,0)
 .E  S PSBHDR(XB)=PSBHDR(XB)_" "_MED
"RTN","PSBOPM",240,0)
 Q
"RTN","PSBOPM",241,0)
 ;
"RTN","PSBOPM",242,0)
CLEANALL        ; KILL ALL TMP LEVELS USED VARIABLES
"RTN","PSBOPM",243,0)
 K ^TMP("PSB",$J),^TMP("PSJ1",$J),TMP("PSBOIS",$J),TMP("PSBADDS",$J),TMP("PSBSOLS",$J)
"RTN","PSBOPM",244,0)
 K TMP("PSBIENS",$J)
"RTN","PSBOPM",245,0)
 Q
"RTN","PSBOPM",246,0)
 ;
"RTN","PSBOPM",247,0)
CLEANSUM        ; KILLL ALL BUN THE "PSBIENS" LEVEL
"RTN","PSBOPM",248,0)
 K ^TMP("PSB",$J),^TMP("PSJ1",$J),TMP("PSBIENS",$J),TMP("PSBOIS",$J),TMP("PSBADDS",$J),TMP("PSBSOLS",$J)
"RTN","PSBOPM",249,0)
 Q
"RTN","PSBOPM",250,0)
MAKELINE(X,CNT) ;LINE OF WHAT'S PASSED IN CNT TIMES
"RTN","PSBOPM",251,0)
 N Y,Z
"RTN","PSBOPM",252,0)
 S Y=""
"RTN","PSBOPM",253,0)
 F Z=1:1:CNT S Y=Y_X
"RTN","PSBOPM",254,0)
 Q Y
"RTN","PSBOPM",255,0)
 ;
"RTN","PSBOPM",256,0)
PARSE(X,CNT) ;Split text for wrapping.
"RTN","PSBOPM",257,0)
 S CNTX="UOA"_CNT,@CNTX=@CNTX_$E(X,CNT,(CNT+14)),UOAX=""
"RTN","PSBOPM",258,0)
 F  S:$F(@CNTX,", ",+UOAX)>0 UOAX=$F(@CNTX,", ",+UOAX)  Q:'$F(@CNTX,", ",+UOAX)
"RTN","PSBOPM",259,0)
 I UOAX<1 F  S:$F(@CNTX," ",+UOAX)>0 UOAX=$F(@CNTX," ",+UOAX)  Q:'$F(@CNTX," ",+UOAX)
"RTN","PSBOPM",260,0)
 I UOAX>1,(($L(UOA)-(CNT+14))>0) S CNTXX=$E(@CNTX,1,UOAX-1),@("UOA"_(CNT+15))=$E(@CNTX,UOAX,UOAX+14),@CNTX=CNTXX
"RTN","PSBOPM",261,0)
 Q
"RTN","PSBOPM",262,0)
 ;
"RTN","PSBOXA")
0^19^B24284983^n/a
"RTN","PSBOXA",1,0)
PSBOXA ;BIRMINGHAM/EFC-MEDICATION LOG ;Mar 2004
"RTN","PSBOXA",2,0)
 ;;3.0;BAR CODE MED ADMIN;**13**;Mar 2004
"RTN","PSBOXA",3,0)
 ;
"RTN","PSBOXA",4,0)
 ; Reference/IA
"RTN","PSBOXA",5,0)
 ;
"RTN","PSBOXA",6,0)
 ; File 4/10090
"RTN","PSBOXA",7,0)
 ;
"RTN","PSBOXA",8,0)
 ;
"RTN","PSBOXA",9,0)
 ; Entry Point -   Report OPTION used by PSB MANAGER key holders to locate
"RTN","PSBOXA",10,0)
 ;                "UNKNOWN" Action Status entries in the BCMA Medication Log File.
"RTN","PSBOXA",11,0)
 ;
"RTN","PSBOXA",12,0)
EN ;  UNKNOWN Action Status Report - creation!
"RTN","PSBOXA",13,0)
 ;
"RTN","PSBOXA",14,0)
 S PSBDTST=+$P(PSBRPT(.1),U,6)
"RTN","PSBOXA",15,0)
 S PSBDTSP=+$P(PSBRPT(.1),U,8)
"RTN","PSBOXA",16,0)
 D NOW^%DTC S Y=% D DD^%DT S PSBDTTM=Y
"RTN","PSBOXA",17,0)
 S PSBLIST=""
"RTN","PSBOXA",18,0)
 S (PSBPGNUM,PSBLNTOT,PSBTOT,PSBX1)=""
"RTN","PSBOXA",19,0)
 F  S PSBX1=$O(^PSB(53.79,"AADT",PSBX1)) Q:PSBX1=""  D
"RTN","PSBOXA",20,0)
 .S PSBX2=$$FMADD^XLFDT(PSBDTST,,,,-.1) F  S PSBX2=$O(^PSB(53.79,"AADT",PSBX1,PSBX2)) Q:(PSBX2>$$FMADD^XLFDT(PSBDTSP,,23.9999))!(+PSBX2=0)  D
"RTN","PSBOXA",21,0)
 ..S PSBX3="" F  S PSBX3=$O(^PSB(53.79,"AADT",PSBX1,PSBX2,PSBX3)) Q:+PSBX3=0  D
"RTN","PSBOXA",22,0)
 ...Q:('$D(^PSB(53.79,PSBX3,0)))!$D(PSBLIST(PSBX3))
"RTN","PSBOXA",23,0)
 ...I $P(^PSB(53.79,PSBX3,0),U,9)="" I $$GET1^DIQ(4,$P(PSBRPT(0),U,4)_",",.01)=$$GET1^DIQ(4,$P(^PSB(53.79,PSBX3,0),U,3)_",",.01) D
"RTN","PSBOXA",24,0)
 ....L +^PSB(53.79,PSBX3):1 I  L -^PSB(53.79,PSBX3) S PSBTOT=PSBTOT+1,PSBLIST(PSBX3)=""
"RTN","PSBOXA",25,0)
 I +PSBTOT=0 K PSBLIST
"RTN","PSBOXA",26,0)
 S Y=PSBDTST D DD^%DT S Y1=Y S Y=PSBDTSP D DD^%DT S Y2=Y
"RTN","PSBOXA",27,0)
 D BLDRPT
"RTN","PSBOXA",28,0)
 D WRTRPT
"RTN","PSBOXA",29,0)
 Q
"RTN","PSBOXA",30,0)
 ;
"RTN","PSBOXA",31,0)
BLDRPT ;
"RTN","PSBOXA",32,0)
 ;
"RTN","PSBOXA",33,0)
 K PSBOUTP
"RTN","PSBOXA",34,0)
 S (PSBPGNUM,PSBX1)=""
"RTN","PSBOXA",35,0)
 I '$D(PSBLIST) D  Q
"RTN","PSBOXA",36,0)
 .S PSBPGNUM=1
"RTN","PSBOXA",37,0)
 .S PSBOUTP(0,14)="W !!,""<<<< NO """"UNKNOWN ACTION STATUS"""" ENTRIES FOUND FOR THIS DATE RANGE >>>>"",!!"
"RTN","PSBOXA",38,0)
 S PSBPGNUM=1,PSBTOT1=0
"RTN","PSBOXA",39,0)
 F  S PSBX1=$O(PSBLIST(PSBX1))  Q:+PSBX1=0  D
"RTN","PSBOXA",40,0)
 .S PSBTOT1=PSBTOT1+1
"RTN","PSBOXA",41,0)
 .D CLEAN^PSBVT,PSJ1^PSBVT($$GET1^DIQ(53.79,PSBX1_",",.01,"I"),$$GET1^DIQ(53.79,PSBX1_",",.11))
"RTN","PSBOXA",42,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W """_PSBTOT1_".)"",!,?5,""Action Status...: "_$S($$GET1^DIQ(53.79,PSBX1_",",.09)']"":"*UNKNOWN*",1:$$GET1^DIQ(53.79,PSBX1_",",.09))_""""
"RTN","PSBOXA",43,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !,?5,""Patient.........: ("_$$GET1^DIQ(2,PSBDFN_",",.09)_") "_$$GET1^DIQ(2,PSBDFN_",",.01)_""""
"RTN","PSBOXA",44,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !,?5,""Ward/Bed........: "_$$GET1^DIQ(2,PSBDFN_",",.1)_$S($$GET1^DIQ(2,PSBDFN_",",.101)']"":"",1:"/"_$$GET1^DIQ(2,PSBDFN_",",.101))_""""
"RTN","PSBOXA",45,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !,?5,""Order Number....: "_PSBONX_""""
"RTN","PSBOXA",46,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !,?5,""Orderable Item..: "_PSBOITX_""""
"RTN","PSBOXA",47,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !,?5,""Schedule........: "_PSBSCH_""""
"RTN","PSBOXA",48,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !,?5,""Scheduled Adm Tm: "_$S($$GET1^DIQ(53.79,PSBX1_",",.13)']"":"AS NEEDED",1:$$GET1^DIQ(53.79,PSBX1_",",.13))_""""
"RTN","PSBOXA",49,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !,?5,""Created Dt/Tm...: "_$$GET1^DIQ(53.79,PSBX1_",",.06)_""""
"RTN","PSBOXA",50,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !,?5,""Created By......: ("_$$GET1^DIQ(53.79,PSBX1_",",.07,"I")_") "_$$GET1^DIQ(53.79,PSBX1_",",.07)_""""
"RTN","PSBOXA",51,0)
 .S PSBOUTP($$PGTOT(3),PSBLNTOT)="W !,$TR($J("""",IOM),"" "",""-""),!!"
"RTN","PSBOXA",52,0)
 Q
"RTN","PSBOXA",53,0)
 ;
"RTN","PSBOXA",54,0)
WRTRPT ;  Actually "WRITE" the report to output device
"RTN","PSBOXA",55,0)
 ;
"RTN","PSBOXA",56,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOXA",57,0)
 .D HDR
"RTN","PSBOXA",58,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),14)
"RTN","PSBOXA",59,0)
 .D FTR
"RTN","PSBOXA",60,0)
 S PSBPGNUM=1
"RTN","PSBOXA",61,0)
 D HDR
"RTN","PSBOXA",62,0)
 S PSBX1="" F  S PSBX1=$O(PSBOUTP(PSBX1)) Q:PSBX1=""  D
"RTN","PSBOXA",63,0)
 .I PSBPGNUM'=PSBX1 D FTR S PSBPGNUM=PSBX1 D HDR
"RTN","PSBOXA",64,0)
 .S PSBX2="" F  S PSBX2=$O(PSBOUTP(PSBX1,PSBX2)) Q:PSBX2=""  D
"RTN","PSBOXA",65,0)
 ..X PSBOUTP(PSBX1,PSBX2)
"RTN","PSBOXA",66,0)
 D FTR
"RTN","PSBOXA",67,0)
 Q
"RTN","PSBOXA",68,0)
 ;
"RTN","PSBOXA",69,0)
HDR ;  Create Report Header
"RTN","PSBOXA",70,0)
 ;
"RTN","PSBOXA",71,0)
 ;
"RTN","PSBOXA",72,0)
 ;   BAR CODE MEDICATION ADMINISTRATION (BCMA) UNKNOWN ACTION STATUS REPORT
"RTN","PSBOXA",73,0)
 ;   Date/Time: NOW
"RTN","PSBOXA",74,0)
 ;   Date Range:   Y1  to  Y2   (inculsive)
"RTN","PSBOXA",75,0)
 ;   
"RTN","PSBOXA",76,0)
 ;   
"RTN","PSBOXA",77,0)
 ;   This is a report of entries, created within the given date range, in the
"RTN","PSBOXA",78,0)
 ;   BCMA Medication Log File with UNKNOWN Action Status data.
"RTN","PSBOXA",79,0)
 ;   These entries may be corrected via the BCMA GUI "Edit Med Log".   
"RTN","PSBOXA",80,0)
 ;   
"RTN","PSBOXA",81,0)
 ;----------------------------------------------------------------
"RTN","PSBOXA",82,0)
 ;
"RTN","PSBOXA",83,0)
 W:$Y>1 @IOF
"RTN","PSBOXA",84,0)
 W:$X>1 !
"RTN","PSBOXA",85,0)
 S PSBPG="Page: "_PSBPGNUM_" of "_$S($O(PSBOUTP(""),-1)=0:1,1:$O(PSBOUTP(""),-1))
"RTN","PSBOXA",86,0)
 S PSBPGRM=IOM-($L(PSBPG)+5)
"RTN","PSBOXA",87,0)
 I $P(PSBRPT(0),U,4)="" S $P(PSBRPT(0),U,4)=DUZ(2)
"RTN","PSBOXA",88,0)
 S PSBDIVN="Division: "_$$GET1^DIQ(4,$P(PSBRPT(0),U,4)_",",.01)
"RTN","PSBOXA",89,0)
 W !!,"BCMA UNKNOWN ACTION STATUS REPORT" W ?PSBPGRM,PSBPG
"RTN","PSBOXA",90,0)
 W !,"Date/Time: "_PSBDTTM,!,"Report Date Range:  Start Date: "_Y1_"   Stop Date: "_Y2
"RTN","PSBOXA",91,0)
 W !,PSBDIVN,?(IOM-($L("Total *UNKNOWN* entries found: "_+PSBTOT)+5)),"Total *UNKNOWN* entries found: "_+PSBTOT
"RTN","PSBOXA",92,0)
 W !!,?5,"This is a report of entries, created within the given date range,"
"RTN","PSBOXA",93,0)
 W !,?5,"in the BCMA Medication Log File with UNKNOWN Action Status data."
"RTN","PSBOXA",94,0)
 W !,?5,"These entries can be corrected using the BCMA GUI ""Edit Med Log""."
"RTN","PSBOXA",95,0)
 W !!,$TR($J("",IOM)," ","="),!!
"RTN","PSBOXA",96,0)
 ;
"RTN","PSBOXA",97,0)
 Q
"RTN","PSBOXA",98,0)
 ;
"RTN","PSBOXA",99,0)
FTR ;  Create Report Footer
"RTN","PSBOXA",100,0)
 ;
"RTN","PSBOXA",101,0)
 I (IOSL<100) F  Q:$Y>(IOSL-7)  W !
"RTN","PSBOXA",102,0)
 W !,$TR($J("",IOM)," ","="),!
"RTN","PSBOXA",103,0)
 W !,PSBDTTM,!,"BCMA UNKNOWN ACTION STATUS REPORT - footer -"
"RTN","PSBOXA",104,0)
 W ?PSBPGRM,PSBPG,!
"RTN","PSBOXA",105,0)
 Q
"RTN","PSBOXA",106,0)
 ;
"RTN","PSBOXA",107,0)
PGTOT(X) ;Keep track of lines and PAGE Number...
"RTN","PSBOXA",108,0)
 ;
"RTN","PSBOXA",109,0)
 S:'$D(X) PSBLNTOT=PSBLNTOT+1
"RTN","PSBOXA",110,0)
 S:$D(X) PSBLNTOT=PSBLNTOT+X
"RTN","PSBOXA",111,0)
 I PSBPGNUM=1,(PSBLNTOT=1) S PSBLNTOT=14 S PSBMORE=PSBLNTOT+12 Q PSBPGNUM
"RTN","PSBOXA",112,0)
 I PSBLNTOT=PSBMORE D
"RTN","PSBOXA",113,0)
 .S PSBMORE=PSBLNTOT+12
"RTN","PSBOXA",114,0)
 .I PSBMORE>(IOSL-7) S PSBPGNUM=PSBPGNUM+1,PSBLNTOT=14 S PSBMORE=PSBLNTOT+12
"RTN","PSBOXA",115,0)
 Q PSBPGNUM
"RTN","PSBPAR")
0^9^B21353739^B19006745
"RTN","PSBPAR",1,0)
PSBPAR ;BIRMINGHAM/EFC-BCMA PARAMETER MANAGEMENT ;Mar 2004
"RTN","PSBPAR",2,0)
 ;;3.0;BAR CODE MED ADMIN;**13**;Mar 2004
"RTN","PSBPAR",3,0)
 ;
"RTN","PSBPAR",4,0)
EN ; Standard editting of parameters
"RTN","PSBPAR",5,0)
 K PSBDIV,PSBLIST,DIC
"RTN","PSBPAR",6,0)
 W !!,"BCMA Parameters Management",!!
"RTN","PSBPAR",7,0)
 W "You are currently logged onto Division: "_DUZ(2)
"RTN","PSBPAR",8,0)
 S DIC="^DIC(4,",DIC(0)="AEQM",DIC("A")="Select Division: " D ^DIC Q:+Y<1
"RTN","PSBPAR",9,0)
 S PSBDIV=+Y_";DIC(4,"
"RTN","PSBPAR",10,0)
 K DIR S DIR(0)="Y",DIR("A")="Edit Divisional Parameters",DIR("B")="Yes"
"RTN","PSBPAR",11,0)
 D ^DIR K DIR I Y D TED^XPAREDIT("PSB DIVISION","AB",PSBDIV)
"RTN","PSBPAR",12,0)
 K DIR S DIR(0)="Y",DIR("A")="Edit Default Lists",DIR("B")="Yes"
"RTN","PSBPAR",13,0)
 D ^DIR K DIR D:Y
"RTN","PSBPAR",14,0)
 .S DIR(0)="SO^1:Reasons Given PRN;2:Reasons Held;3:Reasons Refused;4:Injection Sites"
"RTN","PSBPAR",15,0)
 .S DIR("A")="Select Default List"
"RTN","PSBPAR",16,0)
 .F  W @IOF,!,"BCMA Default Lists",! D ^DIR Q:'Y  D
"RTN","PSBPAR",17,0)
 ..N DIR
"RTN","PSBPAR",18,0)
 ..I Y=1 D TED^XPAREDIT("PSB LIST REASONS GIVEN PRN","AB",PSBDIV) Q
"RTN","PSBPAR",19,0)
 ..I Y=2 D TED^XPAREDIT("PSB LIST REASONS HELD","AB",PSBDIV) Q
"RTN","PSBPAR",20,0)
 ..I Y=3 D TED^XPAREDIT("PSB LIST REASONS REFUSED","AB",PSBDIV) Q
"RTN","PSBPAR",21,0)
 ..I Y=4 D TED^XPAREDIT("PSB LIST INJECTION SITES","AB",PSBDIV) Q
"RTN","PSBPAR",22,0)
 Q
"RTN","PSBPAR",23,0)
 ;
"RTN","PSBPAR",24,0)
RPC(RESULTS,PSBCMD,PSBENT,PSBPAR,PSBINS,PSBVAL) ; Main RPC Hit Point
"RTN","PSBPAR",25,0)
 ;
"RTN","PSBPAR",26,0)
 ; RPC: PSB PARAMETER
"RTN","PSBPAR",27,0)
 ;
"RTN","PSBPAR",28,0)
 ; Description:
"RTN","PSBPAR",29,0)
 ; Called by client to return or set parameters
"RTN","PSBPAR",30,0)
 ;
"RTN","PSBPAR",31,0)
 N PSBERR,PSBTMP
"RTN","PSBPAR",32,0)
 D:PSBCMD="GETPAR" GETPAR(PSBENT,PSBPAR)
"RTN","PSBPAR",33,0)
 D:PSBCMD="GETLST" GETLST(PSBENT,PSBPAR)
"RTN","PSBPAR",34,0)
 D:PSBCMD="SETPAR" SETPAR(PSBENT,PSBPAR,PSBINS,PSBVAL)
"RTN","PSBPAR",35,0)
 D:PSBCMD="DELLST" DELLST(PSBENT,PSBPAR)
"RTN","PSBPAR",36,0)
 D:PSBCMD="GETDIV" GETDIV(PSBENT)
"RTN","PSBPAR",37,0)
 S:'$D(RESULTS) RESULTS(0)="-1^Unknown Internal Error "_PSBCMD
"RTN","PSBPAR",38,0)
 Q
"RTN","PSBPAR",39,0)
 ;
"RTN","PSBPAR",40,0)
GETDIV(PSBENT) ; Return a valid Entity pointer from user input
"RTN","PSBPAR",41,0)
 S X=$$FIND1^DIC(4,"","MX",PSBENT)
"RTN","PSBPAR",42,0)
 I +X<1 S RESULTS(0)="-1^Error, Station # "_PSBENT_" not found." Q
"RTN","PSBPAR",43,0)
 S RESULTS(0)="1^"_(+X)_";DIC(4,"
"RTN","PSBPAR",44,0)
 S RESULTS(1)=$$GET1^DIQ(4,+X_",",.01)_" ("_$$GET1^DIQ(4,+X_",",99)_")"
"RTN","PSBPAR",45,0)
 S RESULTS(2)=$$GET1^DIQ(4,+X_",",1.01)
"RTN","PSBPAR",46,0)
 S RESULTS(3)=$$GET1^DIQ(4,+X_",",1.02)
"RTN","PSBPAR",47,0)
 S RESULTS(4)=$$GET1^DIQ(4,+X_",",1.03)
"RTN","PSBPAR",48,0)
 S RESULTS(5)=$$GET1^DIQ(4,+X_",",.02)
"RTN","PSBPAR",49,0)
 S RESULTS(6)=$$GET1^DIQ(4,+X_",",1.04)
"RTN","PSBPAR",50,0)
 S PSBEDIV=+X  ;do NOT kill this variable - needed until gui context ends
"RTN","PSBPAR",51,0)
 Q
"RTN","PSBPAR",52,0)
 ;
"RTN","PSBPAR",53,0)
GETPAR(PSBENT,PSBPAR) ; Return a parameter
"RTN","PSBPAR",54,0)
 S RESULTS(0)=$$GET^XPAR(PSBENT,PSBPAR,,"B")
"RTN","PSBPAR",55,0)
 Q
"RTN","PSBPAR",56,0)
 ;
"RTN","PSBPAR",57,0)
GETLST(PSBENT,PSBPAR) ; Return a parameter list
"RTN","PSBPAR",58,0)
 D GETLST^XPAR(.PSBTMP,PSBENT,PSBPAR,,.PSBERR)
"RTN","PSBPAR",59,0)
 I PSBERR S RESULTS(0)="-1^Error: "_(+PSBERR)_" "_$P(PSBERR,"^",2) Q
"RTN","PSBPAR",60,0)
 S RESULTS(0)=PSBTMP
"RTN","PSBPAR",61,0)
 F Y=0:0 S Y=$O(PSBTMP(Y)) Q:'Y  S RESULTS(Y)=$P(PSBTMP(Y),"^",2)
"RTN","PSBPAR",62,0)
 Q
"RTN","PSBPAR",63,0)
 ;
"RTN","PSBPAR",64,0)
SETPAR(PSBENT,PSBPAR,PSBINS,PSBVAL) ; Set a new parameter
"RTN","PSBPAR",65,0)
 D EN^XPAR(PSBENT,PSBPAR,PSBINS,PSBVAL,.PSBERR)
"RTN","PSBPAR",66,0)
 I 'PSBERR S RESULTS(0)="1^Success"
"RTN","PSBPAR",67,0)
 E  S RESULTS(0)="-1^Error: "_(+PSBERR)_" "_$P(PSBERR,"^",2)
"RTN","PSBPAR",68,0)
 Q
"RTN","PSBPAR",69,0)
 ;
"RTN","PSBPAR",70,0)
DELLST(PSBENT,PSBPAR) ; Clear a list
"RTN","PSBPAR",71,0)
 D NDEL^XPAR(PSBENT,PSBPAR,.PSBERR)
"RTN","PSBPAR",72,0)
 I 'PSBERR S RESULTS(0)="1^Success"
"RTN","PSBPAR",73,0)
 E  S RESULTS(0)="-1^Error: "_(+PSBERR)_" "_$P(PSBERR,"^",2)
"RTN","PSBPAR",74,0)
 Q
"RTN","PSBPAR",75,0)
 ;
"RTN","PSBPAR",76,0)
USRDEF(PSBPAR) ; Return a parameter for the user
"RTN","PSBPAR",77,0)
 Q $$GET^XPAR("ALL",PSBPAR)
"RTN","PSBPAR",78,0)
 ;
"RTN","PSBPAR",79,0)
RSTUSR ; Reset all a users parameters
"RTN","PSBPAR",80,0)
 N PSBUSR,PSBENT,RESULTS
"RTN","PSBPAR",81,0)
 S DIC="^VA(200,",DIC(0)="AEQM",DIC("A")="Select User to Reset: "
"RTN","PSBPAR",82,0)
 D ^DIC K DIC Q:+Y<1  S PSBUSR=+Y
"RTN","PSBPAR",83,0)
 W !!,"Are you sure you want to reset all parameters for this user"
"RTN","PSBPAR",84,0)
 S %=2 D YN^DICN Q:%'=1
"RTN","PSBPAR",85,0)
 W !,"Resetting..."
"RTN","PSBPAR",86,0)
 S PSBENT=PSBUSR_";VA(200,"
"RTN","PSBPAR",87,0)
 D DEL^XPAR(PSBENT,"PSB PRINTER USER DEFAULT",1)
"RTN","PSBPAR",88,0)
 D DEL^XPAR(PSBENT,"PSB VDL INCL BLANKS",1)
"RTN","PSBPAR",89,0)
 D DEL^XPAR(PSBENT,"PSB VDL INCL CONT",1)
"RTN","PSBPAR",90,0)
 D DEL^XPAR(PSBENT,"PSB VDL INCL IV MEDS",1)
"RTN","PSBPAR",91,0)
 D DEL^XPAR(PSBENT,"PSB VDL INCL ON-CALL",1)
"RTN","PSBPAR",92,0)
 D DEL^XPAR(PSBENT,"PSB VDL INCL ONE-TIME",1)
"RTN","PSBPAR",93,0)
 D DEL^XPAR(PSBENT,"PSB VDL INCL PRN",1)
"RTN","PSBPAR",94,0)
 D DEL^XPAR(PSBENT,"PSB VDL INCL UD MEDS",1)
"RTN","PSBPAR",95,0)
 D DEL^XPAR(PSBENT,"PSB VDL START TIME",1)
"RTN","PSBPAR",96,0)
 D DEL^XPAR(PSBENT,"PSB VDL STOP TIME",1)
"RTN","PSBPAR",97,0)
 D DEL^XPAR(PSBENT,"PSB WINDOW",1)
"RTN","PSBPAR",98,0)
 D DEL^XPAR(PSBENT,"PSB UNIT DOSE COLUMN WIDTHS",1)
"RTN","PSBPAR",99,0)
 D DEL^XPAR(PSBENT,"PSB VDL SORT COLUMN",1)
"RTN","PSBPAR",100,0)
 D DEL^XPAR(PSBENT,"PSB VDL PB SORT COLUMN",1)
"RTN","PSBPAR",101,0)
 D DEL^XPAR(PSBENT,"PSB VDL IV SORT COLUMN",1)
"RTN","PSBPAR",102,0)
 D DEL^XPAR(PSBENT,"PSB IV COLUMN WIDTHS",1)
"RTN","PSBPAR",103,0)
 D DEL^XPAR(PSBENT,"PSB IVPB COLUMN WIDTHS",1)
"RTN","PSBPAR",104,0)
 D DEL^XPAR(PSBENT,"PSB HKEY",1)
"RTN","PSBPAR",105,0)
 D DEL^XPAR(PSBENT,"PSB IDLE TIMEOUT",1)
"RTN","PSBPAR",106,0)
 D DEL^XPAR(PSBENT,"PSB GUI DEFAULT PRINTER",1)
"RTN","PSBPAR",107,0)
 D DEL^XPAR(PSBENT,"PSB COVERSHEET VIEWS COL SORT",1)
"RTN","PSBPAR",108,0)
 D DEL^XPAR(PSBENT,"PSB COVERSHEET V1 COL WIDTHS",1)
"RTN","PSBPAR",109,0)
 D DEL^XPAR(PSBENT,"PSB COVERSHEET V2 COL WIDTHS",1)
"RTN","PSBPAR",110,0)
 D DEL^XPAR(PSBENT,"PSB COVERSHEET V3 COL WIDTHS",1)
"RTN","PSBPAR",111,0)
 D DEL^XPAR(PSBENT,"PSB COVERSHEET V4 COL WIDTHS",1)
"RTN","PSBPAR",112,0)
 W "Done.",!
"RTN","PSBPAR",113,0)
 Q
"RTN","PSBPAR",114,0)
 ;
"RTN","PSBPRN")
0^26^B23314092^B25412944
"RTN","PSBPRN",1,0)
PSBPRN ;BIRMINGHAM/EFC-BCMA PRN FUNCTIONS ;Mar 2004
"RTN","PSBPRN",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,3,13**;Mar 2004
"RTN","PSBPRN",3,0)
 ;
"RTN","PSBPRN",4,0)
 ;Reference/IA
"RTN","PSBPRN",5,0)
 ;DEM^VADPT/10061
"RTN","PSBPRN",6,0)
 ;INP^VADPT/10061
"RTN","PSBPRN",7,0)
 ;$$GET1^DIQ/2056
"RTN","PSBPRN",8,0)
EN ;
"RTN","PSBPRN",9,0)
 Q
"RTN","PSBPRN",10,0)
 ;
"RTN","PSBPRN",11,0)
EDIT ; Edit Medication Log PRN Effectiveness
"RTN","PSBPRN",12,0)
 NEW DFN ;* Undef DFN at EDIT+7^PSBPRN (NOIS: HUN-0699-21494)
"RTN","PSBPRN",13,0)
 W !! S DA=""
"RTN","PSBPRN",14,0)
 S DIC="^DPT(",DIC(0)="AEQM",DIC("A")="Select Patient Name: "
"RTN","PSBPRN",15,0)
 D ^DIC K DIC Q:+Y<1
"RTN","PSBPRN",16,0)
 S DFN=+Y
"RTN","PSBPRN",17,0)
 D EDIT1
"RTN","PSBPRN",18,0)
 K DFN,DA
"RTN","PSBPRN",19,0)
 G EDIT
"RTN","PSBPRN",20,0)
 ;
"RTN","PSBPRN",21,0)
EDIT1 ;
"RTN","PSBPRN",22,0)
 S %DT="AEQ",%DT("A")="Select Date to Begin Searching Back From: "
"RTN","PSBPRN",23,0)
 S %DT("B")="Today"
"RTN","PSBPRN",24,0)
 W !! D ^%DT Q:+Y<1  S PSBDT=Y
"RTN","PSBPRN",25,0)
 F  D  Q:'PSBDT
"RTN","PSBPRN",26,0)
 .W @IOF,!,"Searching Date " S Y=PSBDT D D^DIQ W Y
"RTN","PSBPRN",27,0)
 .W !," #  Medication",?45,"St",?50,"D/T Given",?75,"Int"
"RTN","PSBPRN",28,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBPRN",29,0)
 .S PSBSRCH=PSBDT+.9,PSBCNT=0
"RTN","PSBPRN",30,0)
 .K PSBTMP
"RTN","PSBPRN",31,0)
 .F  S PSBSRCH=$O(^PSB(53.79,"APRN",DFN,PSBSRCH),-1) Q:'PSBSRCH!(PSBSRCH<PSBDT)  D
"RTN","PSBPRN",32,0)
 ..S PSBIEN=""
"RTN","PSBPRN",33,0)
 ..F  S PSBIEN=$O(^PSB(53.79,"APRN",DFN,PSBSRCH,PSBIEN),-1) Q:'PSBIEN  D
"RTN","PSBPRN",34,0)
 ...Q:$P($G(^PSB(53.79,PSBIEN,.2)),U,2)]""
"RTN","PSBPRN",35,0)
 ...Q:$P($G(^PSB(53.79,PSBIEN,0)),U,9)'="G"
"RTN","PSBPRN",36,0)
 ...S PSBCNT=PSBCNT+1,PSBTMP(PSBCNT)=PSBIEN
"RTN","PSBPRN",37,0)
 ...I $Y>19 W ! S DIR(0)="E" D ^DIR W @IOF,!,"Searching Date " S Y=PSBDT D D^DIQ W Y,!," #  Medication",?45,"St",?50,"D/T Given",?75,"Int",!,$TR($J("",IOM)," ","-")
"RTN","PSBPRN",38,0)
 ...W !,$J(PSBCNT,2),". "
"RTN","PSBPRN",39,0)
 ...W ?5,$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBPRN",40,0)
 ...W ?45,$P(^PSB(53.79,PSBIEN,0),U,9)
"RTN","PSBPRN",41,0)
 ...W ?50,$$GET1^DIQ(53.79,PSBIEN_",",.06)
"RTN","PSBPRN",42,0)
 ...W ?75,$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBPRN",43,0)
 .I PSBCNT W ! S DIR(0)="NO^1:"_PSBCNT_":0" D ^DIR S:Y DA=PSBTMP(Y),PSBDT="" Q:Y
"RTN","PSBPRN",44,0)
 .I 'PSBCNT W !!?5,"No Meds Found!"
"RTN","PSBPRN",45,0)
 .S X1=PSBDT,X2=-1 D C^%DTC S (PSBDT,Y)=X D D^DIQ
"RTN","PSBPRN",46,0)
 .W !!,"Continue With ",Y
"RTN","PSBPRN",47,0)
 .S %=1 D YN^DICN I %'=1 S PSBDT=0
"RTN","PSBPRN",48,0)
 I DA S DDSFILE=53.79,DR="[PSB PRN EFFECTIVENESS]" D ^DDS S %=2 W !,"Edit another entry" D YN^DICN G:%=1 EDIT1
"RTN","PSBPRN",49,0)
 K PSBCNT,PSBDT,PSBIEN,PSBSRCH,PSBTMP,DA,DR,DDSFILE
"RTN","PSBPRN",50,0)
 Q
"RTN","PSBPRN",51,0)
 ;
"RTN","PSBPRN",52,0)
GETPRNS(RESULTS,DFN,PSBORD) ; Get the PRN's for a pt needing effectness
"RTN","PSBPRN",53,0)
 ;
"RTN","PSBPRN",54,0)
 ; RPC PSB GETPRNS
"RTN","PSBPRN",55,0)
 ;
"RTN","PSBPRN",56,0)
 ; Description:
"RTN","PSBPRN",57,0)
 ; Returns all administrations of a PRN order that have NOT had
"RTN","PSBPRN",58,0)
 ; the PRN Effectiveness documented BASED ON THE TRANSFER DATE AND SITE PARAM
"RTN","PSBPRN",59,0)
 ;
"RTN","PSBPRN",60,0)
 N PSBIEN,PSBSTOP
"RTN","PSBPRN",61,0)
 K ^TMP("PSB",$J),RESULTS
"RTN","PSBPRN",62,0)
 ;
"RTN","PSBPRN",63,0)
 Q:$$DISCHRGD(DFN)
"RTN","PSBPRN",64,0)
 ;
"RTN","PSBPRN",65,0)
 D INP^VADPT S PSBTRDT=+VAIN(7)
"RTN","PSBPRN",66,0)
 S PSBHOUR=$$GET^XPAR("DIV","PSB PRN DOCUMENTATION") I PSBHOUR="" S PSBHOUR=72
"RTN","PSBPRN",67,0)
 D NOW^%DTC S PSBSTRT=%,PSBPRNDT=$$FMADD^XLFDT(PSBSTRT,"",-PSBHOUR)
"RTN","PSBPRN",68,0)
 ;
"RTN","PSBPRN",69,0)
 ;Use the (OLDER) value of PSBPRNDT(site param) or PSBTRDT(admission)
"RTN","PSBPRN",70,0)
 I PSBPRNDT>PSBTRDT S PSBPRNDT=PSBTRDT
"RTN","PSBPRN",71,0)
 S PSBSTRT="" F  S PSBSTRT=$O(^PSB(53.79,"APRN",DFN,PSBSTRT),-1) Q:(PSBSTRT<PSBPRNDT)  D
"RTN","PSBPRN",72,0)
 .S PSBIEN=""
"RTN","PSBPRN",73,0)
 .F  S PSBIEN=$O(^PSB(53.79,"APRN",DFN,PSBSTRT,PSBIEN),-1) Q:'PSBIEN  D
"RTN","PSBPRN",74,0)
 ..Q:(PSBORD'="")&($P(^PSB(53.79,PSBIEN,.1),U)'=PSBORD)  ;  Not the right order
"RTN","PSBPRN",75,0)
 ..I ($P(^PSB(53.79,PSBIEN,0),U,9)'="G")&($P(^PSB(53.79,PSBIEN,0),U,9)'="RM") Q    ; Med was never given
"RTN","PSBPRN",76,0)
 ..Q:$P($G(^PSB(53.79,PSBIEN,.2)),U,2)]""  ; Already entered
"RTN","PSBPRN",77,0)
 ..S PSBX=PSBIEN_U_DFN,PSBIENS=PSBIEN_","
"RTN","PSBPRN",78,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.02)
"RTN","PSBPRN",79,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.06,"I")
"RTN","PSBPRN",80,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.07)
"RTN","PSBPRN",81,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.08)
"RTN","PSBPRN",82,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.21)
"RTN","PSBPRN",83,0)
 ..D PSJ1^PSBVT(DFN,$$GET1^DIQ(53.79,PSBIENS,.11))
"RTN","PSBPRN",84,0)
 ..S PSBX=PSBX_U_PSBOIT_U_PSBONX
"RTN","PSBPRN",85,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.27)
"RTN","PSBPRN",86,0)
 ..S Y=$O(^TMP("PSB",$J,""),-1)+1
"RTN","PSBPRN",87,0)
 ..S ^TMP("PSB",$J,Y)=PSBX
"RTN","PSBPRN",88,0)
 ..;Special instructions
"RTN","PSBPRN",89,0)
 ..S Y=Y+1,^TMP("PSB",$J,Y)=PSBOTXT
"RTN","PSBPRN",90,0)
 ..F PSBZ=.5,.6,.7 F PSBY=0:0 S PSBY=$O(^PSB(53.79,PSBIEN,PSBZ,PSBY)) Q:'PSBY  D
"RTN","PSBPRN",91,0)
 ...S PSBDD=$S(PSBZ=.5:53.795,PSBZ=.6:53.796,1:53.797)
"RTN","PSBPRN",92,0)
 ...S PSBSOL=$S(PSBZ=.5:"DD",PSBZ=.6:"ADD",1:"SOL")
"RTN","PSBPRN",93,0)
 ...Q:'$D(^PSB(53.79,PSBIEN,PSBZ,PSBY))
"RTN","PSBPRN",94,0)
 ...S PSBUNIT=$$GET1^DIQ(PSBDD,PSBY_","_PSBIEN_",",.03)
"RTN","PSBPRN",95,0)
 ...S PSBUNFR=$$GET1^DIQ(PSBDD,PSBY_","_PSBIEN_",",.04)
"RTN","PSBPRN",96,0)
 ...S Y=Y+1
"RTN","PSBPRN",97,0)
 ...S ^TMP("PSB",$J,Y)=PSBSOL_U_$$GET1^DIQ(PSBDD,PSBY_","_PSBIEN_",",.01)_U_PSBUNIT_U_PSBUNFR
"RTN","PSBPRN",98,0)
 ..S Y=Y+1,^TMP("PSB",$J,Y)="END"
"RTN","PSBPRN",99,0)
 S ^TMP("PSB",$J,0)=+$O(^TMP("PSB",$J,""),-1)
"RTN","PSBPRN",100,0)
 S RESULTS=$NAME(^TMP("PSB",$J))
"RTN","PSBPRN",101,0)
 K PSBTRDT,PSBHOUR,PSBPRNDT
"RTN","PSBPRN",102,0)
 D CLEAN^PSBVT
"RTN","PSBPRN",103,0)
 Q
"RTN","PSBPRN",104,0)
 ;
"RTN","PSBPRN",105,0)
DISCHRGD(DFN) ; Patient Discharged OR Deceased?
"RTN","PSBPRN",106,0)
 ;
"RTN","PSBPRN",107,0)
 S DISCHRGD=0
"RTN","PSBPRN",108,0)
 ;
"RTN","PSBPRN",109,0)
 D DEM^VADPT ;check for date of death entry
"RTN","PSBPRN",110,0)
 I VADM(6)]"" S DISCHRGD=1,^TMP("PSB",$J,0)=0 K VADM
"RTN","PSBPRN",111,0)
 ;
"RTN","PSBPRN",112,0)
 I DISCHRGD=0 D  ;check for discharge if they're not dead
"RTN","PSBPRN",113,0)
 .D INP^VADPT
"RTN","PSBPRN",114,0)
 .I VAIN(1)']"" S DISCHRGD=1,^TMP("PSB",$J,0)=0 K VAIN
"RTN","PSBPRN",115,0)
 ;
"RTN","PSBPRN",116,0)
 I DISCHRGD D  ;setup results and clean up
"RTN","PSBPRN",117,0)
 .S RESULTS=$NAME(^TMP("PSB",$J))
"RTN","PSBPRN",118,0)
 .K PSBTRDT,PSBHOUR,PSBPRNDT
"RTN","PSBPRN",119,0)
 .D CLEAN^PSBVT
"RTN","PSBPRN",120,0)
 ;
"RTN","PSBPRN",121,0)
 Q DISCHRGD
"RTN","PSBPRN",122,0)
 ;
"RTN","PSBRPC")
0^1^B92329356^B85069025
"RTN","PSBRPC",1,0)
PSBRPC ;BIRMINGHAM/EFC-BCMA RPC BROKER CALLS ;Mar 2004
"RTN","PSBRPC",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,13**;Mar 2004
"RTN","PSBRPC",3,0)
 ;
"RTN","PSBRPC",4,0)
 ; Reference/IA
"RTN","PSBRPC",5,0)
 ; EN1^GMRADPT/10099
"RTN","PSBRPC",6,0)
 ; EN6^GMRVUTL/1120
"RTN","PSBRPC",7,0)
 ; DEM^VADPT/10061
"RTN","PSBRPC",8,0)
 ; IN5^VADPT/10061
"RTN","PSBRPC",9,0)
 ; File 200/10060
"RTN","PSBRPC",10,0)
 ; File 211.4/1409
"RTN","PSBRPC",11,0)
 ; CHECKAV^XUSRB/2882
"RTN","PSBRPC",12,0)
 ; GUIMTD^DPTLK6/3023
"RTN","PSBRPC",13,0)
 ; ^ORD(101.24/3429
"RTN","PSBRPC",14,0)
 ; File 2/10035
"RTN","PSBRPC",15,0)
 ; File 4/10090
"RTN","PSBRPC",16,0)
 ; EN1^GMRVUT0/1446
"RTN","PSBRPC",17,0)
 ; HASH^XUSHSHP/10045
"RTN","PSBRPC",18,0)
 ; $$DECRYP^XUSRB1/2241
"RTN","PSBRPC",19,0)
 ; ^DIC(42/1377
"RTN","PSBRPC",20,0)
 ; ^DIC(42/2440
"RTN","PSBRPC",21,0)
 ; $$GETACT^DGPFAPI/3860
"RTN","PSBRPC",22,0)
 ; $$GETICN^MPIF001/2701
"RTN","PSBRPC",23,0)
 ; $$GETDFN^MPIF001/2701
"RTN","PSBRPC",24,0)
 ; $$PROD^XUPROD/4440
"RTN","PSBRPC",25,0)
 ; $$GET^XPAR/2263
"RTN","PSBRPC",26,0)
 ; EN^XPAR/2263
"RTN","PSBRPC",27,0)
 ; $$BASE^XLFUTL/2622
"RTN","PSBRPC",28,0)
 ;
"RTN","PSBRPC",29,0)
FMDATE(RESULTS,X) ;
"RTN","PSBRPC",30,0)
 ;
"RTN","PSBRPC",31,0)
 ; RPC: PSB FMDATE
"RTN","PSBRPC",32,0)
 ;
"RTN","PSBRPC",33,0)
 ; Descr: Returns FM Date/Time from Clnt DateToStr()
"RTN","PSBRPC",34,0)
 ;
"RTN","PSBRPC",35,0)
 I $P(X,"@",2)="0000" S $P(X,"@",2)="0001"
"RTN","PSBRPC",36,0)
 ;if no time for dates like T-1, append the current time
"RTN","PSBRPC",37,0)
 I $P(X,"@",2)="",X'?1"N" D  S $P(X,"@",2)=$P(Y,"@",2)
"RTN","PSBRPC",38,0)
 . N X
"RTN","PSBRPC",39,0)
 . S X="N",%DT="T" D ^%DT,DD^%DT
"RTN","PSBRPC",40,0)
 S %DT="T" D ^%DT
"RTN","PSBRPC",41,0)
 I +Y<1 S RESULTS(0)="-1^Invalid Date/Time" Q
"RTN","PSBRPC",42,0)
 S RESULTS(0)=Y D D^DIQ
"RTN","PSBRPC",43,0)
 S RESULTS(0)=RESULTS(0)_U_Y
"RTN","PSBRPC",44,0)
 Q
"RTN","PSBRPC",45,0)
 ;
"RTN","PSBRPC",46,0)
USRLOAD(RESULTS,DUMMY) ;
"RTN","PSBRPC",47,0)
 ;
"RTN","PSBRPC",48,0)
 ; RPC: PSB USERLOAD
"RTN","PSBRPC",49,0)
 ; Descr: Load wkst user
"RTN","PSBRPC",50,0)
 S RESULTS(0)=DUZ ;UsrIEN
"RTN","PSBRPC",51,0)
 S RESULTS(1)=$$GET1^DIQ(200,DUZ_",",.01) ; Usr Nm
"RTN","PSBRPC",52,0)
 S RESULTS(2)=$S($D(^XUSEC("PSB STUDENT",DUZ)):1,1:0) ; Studnt?
"RTN","PSBRPC",53,0)
 S RESULTS(3)=$S($D(^XUSEC("PSB MANAGER",DUZ)):1,1:0) ; Mgr?
"RTN","PSBRPC",54,0)
 S RESULTS(4)=$S($D(^XUSEC("PSB CPRS MED BUTTON",DUZ)):1,1:0)
"RTN","PSBRPC",55,0)
 S RESULTS(5)=$$GET^XPAR("USR","PSB WINDOW")
"RTN","PSBRPC",56,0)
 ;VDL Strng
"RTN","PSBRPC",57,0)
 S X=$S(+$$GET^XPAR("ALL","PSB VDL INCL CONT"):"T",1:"F")
"RTN","PSBRPC",58,0)
 S X=X_"/"_$S(+$$GET^XPAR("ALL","PSB VDL INCL PRN"):"T",1:"F")
"RTN","PSBRPC",59,0)
 S X=X_"/"_$S(+$$GET^XPAR("ALL","PSB VDL INCL ONE-TIME"):"T",1:"F")
"RTN","PSBRPC",60,0)
 S X=X_"/"_$S(+$$GET^XPAR("ALL","PSB VDL INCL ON-CALL"):"T",1:"F")
"RTN","PSBRPC",61,0)
 S X=X_"/"_+$$GET^XPAR("ALL","PSB VDL SORT COLUMN")
"RTN","PSBRPC",62,0)
 S X=X_"/"_+$$GET^XPAR("ALL","PSB VDL PB SORT COLUMN")
"RTN","PSBRPC",63,0)
 S X=X_"/"_+$$GET^XPAR("ALL","PSB VDL IV SORT COLUMN")
"RTN","PSBRPC",64,0)
 ;
"RTN","PSBRPC",65,0)
 S RESULTS(6)=X ;VDL Setp
"RTN","PSBRPC",66,0)
 S RESULTS(7)=+$G(DUZ(2))
"RTN","PSBRPC",67,0)
 I RESULTS(7) S RESULTS(8)=$$GET1^DIQ(4,RESULTS(7)_",",.01)
"RTN","PSBRPC",68,0)
 E  S RESULTS(8)="Undefined Division"
"RTN","PSBRPC",69,0)
 S RESULTS(7)=RESULTS(7)_U_$P($$SITE^VASITE,U,3)
"RTN","PSBRPC",70,0)
 I $T(PROD^XUPROD)]"" S RESULTS(7)=RESULTS(7)_U_$$PROD^XUPROD(1)
"RTN","PSBRPC",71,0)
 S RESULTS(9)=+$$GET^XPAR("DIV","PSB ADMIN ESIG")
"RTN","PSBRPC",72,0)
 S RESULTS(10)=+$$GET^XPAR("DIV","PSB ONLINE")
"RTN","PSBRPC",73,0)
 S RESULTS(11)=$G(DTIME,300)
"RTN","PSBRPC",74,0)
 S RESULTS(12)=$$GET^XPAR("USR","PSB UNIT DOSE COLUMN WIDTHS")
"RTN","PSBRPC",75,0)
 S RESULTS(13)=$J_"^"_$$BASE^XLFUTL($J,10,16)
"RTN","PSBRPC",76,0)
 S RESULTS(14)=$$GET^XPAR("USR","PSB IVPB COLUMN WIDTHS")
"RTN","PSBRPC",77,0)
 S RESULTS(15)=$$GET^XPAR("USR","PSB IV COLUMN WIDTHS")
"RTN","PSBRPC",78,0)
 S RESULTS(16)=$$GET^XPAR("USR","PSB PRINTER USER DEFAULT")
"RTN","PSBRPC",79,0)
 S RESULTS(17)=$$GET^XPAR("USR","PSB GUI DEFAULT PRINTER")
"RTN","PSBRPC",80,0)
 S RESULTS(18)=$S($D(^XUSEC("PSB READ ONLY",DUZ)):1,1:0)
"RTN","PSBRPC",81,0)
 S RESULTS(19)=$$GET^XPAR("USR","PSB COVERSHEET VIEWS COL SORT")
"RTN","PSBRPC",82,0)
 S RESULTS(20)=$$GET^XPAR("USR","PSB COVERSHEET V1 COL WIDTHS")
"RTN","PSBRPC",83,0)
 S RESULTS(21)=$$GET^XPAR("USR","PSB COVERSHEET V2 COL WIDTHS")
"RTN","PSBRPC",84,0)
 S RESULTS(22)=$$GET^XPAR("USR","PSB COVERSHEET V3 COL WIDTHS")
"RTN","PSBRPC",85,0)
 S RESULTS(23)=$$GET^XPAR("USR","PSB COVERSHEET V4 COL WIDTHS")
"RTN","PSBRPC",86,0)
 Q
"RTN","PSBRPC",87,0)
 ;
"RTN","PSBRPC",88,0)
USRSAVE(RESULTS,PSBWIN,PSBVDL,PSBUDCW,PSBPBCW,PSBIVCW,PSBDEV,PSBCSRT,PSBCV1,PSBCV2,PSBCV3,PSBCV4) ;
"RTN","PSBRPC",89,0)
 ;
"RTN","PSBRPC",90,0)
 ; RPC: PSB USERSAVE
"RTN","PSBRPC",91,0)
 ;
"RTN","PSBRPC",92,0)
 ; Descr: Saves user settings.
"RTN","PSBRPC",93,0)
 ;
"RTN","PSBRPC",94,0)
 S RESULTS(0)="-1^FAILED - Parameters Save"
"RTN","PSBRPC",95,0)
 S PSBWIN=$G(PSBWIN),PSBVDL=$G(PSBVDL),PSBUDCW=$G(PSBUDCW)
"RTN","PSBRPC",96,0)
 S PSBPBCW=$G(PSBPBCW),PSBIVCW=$G(PSBIVCW),PSBDEV=$G(PSBDEV)
"RTN","PSBRPC",97,0)
 S PSBCSRT=$G(PSBCSRT),PSBCV1=$G(PSBCV1),PSBCV2=$G(PSBCV2),PSBCV3=$G(PSBCV3),PSBCV4=$G(PSBCV4)
"RTN","PSBRPC",98,0)
 ;
"RTN","PSBRPC",99,0)
 D EN^XPAR("USR","PSB WINDOW",1,PSBWIN)
"RTN","PSBRPC",100,0)
 D EN^XPAR("USR","PSB VDL INCL CONT",1,$P(PSBVDL,"/",1)["T")
"RTN","PSBRPC",101,0)
 D EN^XPAR("USR","PSB VDL INCL PRN",1,$P(PSBVDL,"/",2)["T")
"RTN","PSBRPC",102,0)
 D EN^XPAR("USR","PSB VDL INCL ONE-TIME",1,$P(PSBVDL,"/",3)["T")
"RTN","PSBRPC",103,0)
 D EN^XPAR("USR","PSB VDL INCL ON-CALL",1,$P(PSBVDL,"/",4)["T")
"RTN","PSBRPC",104,0)
 D EN^XPAR("USR","PSB VDL SORT COLUMN",1,+$P(PSBVDL,"/",5))
"RTN","PSBRPC",105,0)
 D EN^XPAR("USR","PSB VDL PB SORT COLUMN",1,+$P(PSBVDL,"/",6))
"RTN","PSBRPC",106,0)
 D EN^XPAR("USR","PSB VDL IV SORT COLUMN",1,+$P(PSBVDL,"/",7))
"RTN","PSBRPC",107,0)
 D EN^XPAR("USR","PSB UNIT DOSE COLUMN WIDTHS",1,PSBUDCW)
"RTN","PSBRPC",108,0)
 D EN^XPAR("USR","PSB IVPB COLUMN WIDTHS",1,PSBPBCW)
"RTN","PSBRPC",109,0)
 D EN^XPAR("USR","PSB IV COLUMN WIDTHS",1,PSBIVCW)
"RTN","PSBRPC",110,0)
 D EN^XPAR("USR","PSB GUI DEFAULT PRINTER",1,PSBDEV)
"RTN","PSBRPC",111,0)
 D EN^XPAR("USR","PSB COVERSHEET VIEWS COL SORT",1,PSBCSRT)
"RTN","PSBRPC",112,0)
 D EN^XPAR("USR","PSB COVERSHEET V1 COL WIDTHS",1,PSBCV1)
"RTN","PSBRPC",113,0)
 D EN^XPAR("USR","PSB COVERSHEET V2 COL WIDTHS",1,PSBCV2)
"RTN","PSBRPC",114,0)
 D EN^XPAR("USR","PSB COVERSHEET V3 COL WIDTHS",1,PSBCV3)
"RTN","PSBRPC",115,0)
 D EN^XPAR("USR","PSB COVERSHEET V4 COL WIDTHS",1,PSBCV4)
"RTN","PSBRPC",116,0)
 S RESULTS(0)="1^Parameters Saved"
"RTN","PSBRPC",117,0)
 Q
"RTN","PSBRPC",118,0)
 ;
"RTN","PSBRPC",119,0)
INST(RESULTS,PSBACC,PSBVER) ;
"RTN","PSBRPC",120,0)
 ;
"RTN","PSBRPC",121,0)
 ; RPC: PSB INSTRUCTOR
"RTN","PSBRPC",122,0)
 ; Descr:
"RTN","PSBRPC",123,0)
 ; Used by frmInstructor to validate an instructor(s) at
"RTN","PSBRPC",124,0)
 ; the client via encrypted A/V Code.
"RTN","PSBRPC",125,0)
 ;
"RTN","PSBRPC",126,0)
 S PSBACC=$$DECRYP^XUSRB1(PSBACC)
"RTN","PSBRPC",127,0)
 S PSBVER=$$DECRYP^XUSRB1(PSBVER)
"RTN","PSBRPC",128,0)
 S PSBINST=$$CHECKAV^XUSRB(PSBACC_";"_PSBVER)
"RTN","PSBRPC",129,0)
 I PSBINST<1 S RESULTS(0)="-1^Invalid Instructor Sign-On" K PSBINST Q
"RTN","PSBRPC",130,0)
 I '$D(^XUSEC("PSB INSTRUCTOR",PSBINST)) S RESULTS(0)="-1^Instructor doesn't have authority" K PSBINST Q
"RTN","PSBRPC",131,0)
 S PSBINST(0)=$$GET1^DIQ(200,PSBINST_",",.01)
"RTN","PSBRPC",132,0)
 S RESULTS(0)=PSBINST_U_PSBINST(0)
"RTN","PSBRPC",133,0)
 Q
"RTN","PSBRPC",134,0)
 ;
"RTN","PSBRPC",135,0)
ESIG(RESULTS,PSBESIG) ;
"RTN","PSBRPC",136,0)
 ;
"RTN","PSBRPC",137,0)
 ; RPC: PSB VALIDATE ESIG
"RTN","PSBRPC",138,0)
 ; Descr:
"RTN","PSBRPC",139,0)
 ; Validate the data in PSBESIG against user (DUZ)
"RTN","PSBRPC",140,0)
 ;
"RTN","PSBRPC",141,0)
 S PSBDSIG=$P($G(PSBESIG),U,2) I PSBDSIG'="" S PSBDSIG=$$DECRYP^XUSRB1(PSBDSIG),PSBESIG=PSBDSIG
"RTN","PSBRPC",142,0)
 I $G(PSBESIG)="" S RESULTS(0)="-1^Must Supply ESig" Q
"RTN","PSBRPC",143,0)
 S X=PSBESIG D HASH^XUSHSHP
"RTN","PSBRPC",144,0)
 I X'=$$GET1^DIQ(200,DUZ_",",20.4,"I") S RESULTS(0)="-1^Invalid ESig"
"RTN","PSBRPC",145,0)
 E  S RESULTS(0)="1^ESig Verified"
"RTN","PSBRPC",146,0)
 Q
"RTN","PSBRPC",147,0)
 ;
"RTN","PSBRPC",148,0)
 ;
"RTN","PSBRPC",149,0)
SCANPT(RESULTS,PSBDATA) ; Lookup Pt by Full SSN
"RTN","PSBRPC",150,0)
 ;
"RTN","PSBRPC",151,0)
 ; RPC: PSB SCANPT
"RTN","PSBRPC",152,0)
 ; Descr:
"RTN","PSBRPC",153,0)
 ; file 2 lookup either by full SSN
"RTN","PSBRPC",154,0)
 ; returns -1 on error or patient data
"RTN","PSBRPC",155,0)
 ;
"RTN","PSBRPC",156,0)
 ; Check for Interleave 2 of 5 Check Digit on SSN and remove
"RTN","PSBRPC",157,0)
 N DFN
"RTN","PSBRPC",158,0)
 I "SS"[$P($G(PSBDATA),"^",3)  D  Q:RESULTS(1)<0
"RTN","PSBRPC",159,0)
 .S:$P(PSBDATA,"^")?1"0"9N.U PSBDATA=$E(PSBDATA,2,99) N PSBCNT
"RTN","PSBRPC",160,0)
 .I $P(PSBDATA,U)'?9N.1U S RESULTS(0)=1,RESULTS(1)="-1^Invalid Patient Lookup" Q
"RTN","PSBRPC",161,0)
 .S X=$$FIND1^DIC(2,"","",$P(PSBDATA,U),"SSN")
"RTN","PSBRPC",162,0)
 .I X<1 S RESULTS(0)=1,RESULTS(1)="-1^Invalid Patient Lookup" Q
"RTN","PSBRPC",163,0)
 .S (DFN,RESULTS(1),PSBDFN)=X
"RTN","PSBRPC",164,0)
 .S PSBICN=$$GETICN^MPIF001(PSBDFN) I +PSBICN=-1 S PSBICN=""
"RTN","PSBRPC",165,0)
 I $G(DFN)']"" D  Q:+PSBDFN'>0
"RTN","PSBRPC",166,0)
 .; CCOW !
"RTN","PSBRPC",167,0)
 .I "DF"[$P($G(PSBDATA),"^",3) S PSBDFN=$P($G(PSBDATA),"^"),PSBICN=$$GETICN^MPIF001(PSBDFN) I +PSBICN=-1 S PSBICN="",RESULTS(0)=1,RESULTS(1)="-1^Cannot find ICN via DFN"
"RTN","PSBRPC",168,0)
 .I "IC"[$P($G(PSBDATA),"^",3) S PSBICN=$P($G(PSBDATA),"^"),PSBDFN=$$GETDFN^MPIF001(PSBICN) I +PSBDFN=-1 S PSBDFN="",RESULTS(0)=1,RESULTS(1)="-1^Cannot find DFN via ICN" Q
"RTN","PSBRPC",169,0)
 .S (DFN,RESULTS(1))=PSBDFN
"RTN","PSBRPC",170,0)
 .;
"RTN","PSBRPC",171,0)
 K VADM,VAIN
"RTN","PSBRPC",172,0)
 D DEM^VADPT,IN5^VADPT
"RTN","PSBRPC",173,0)
 I ('$P(PSBDATA,U,2))&('VAIP(13)&'VADM(6)) S RESULTS(0)=1,RESULTS(1)="-1^Patient has been DISCHARGED" I ($P($G(PSBDATA),U,3)'["IC")&($P($G(PSBDATA),U,3)'["DF") K VAIP,VADM Q
"RTN","PSBRPC",174,0)
 I ('$P(PSBDATA,U,2))&(VADM(6)'="") S RESULTS(0)=1,RESULTS(1)="-1^"_"This patient died "_$TR($P(VADM(6),U,2),"@"," ") I ($P($G(PSBDATA),U,3)'["IC")&($P($G(PSBDATA),U,3)'["DF") K VAIP,VADM Q
"RTN","PSBRPC",175,0)
 S RESULTS(1)=PSBDFN
"RTN","PSBRPC",176,0)
 F X=1,2,3,4,5 S RESULTS(X+1)=$G(VADM(X))
"RTN","PSBRPC",177,0)
 F X=3,4,5,6,7,8,9,10,11 S RESULTS(X+4)=$G(VAIP(X))
"RTN","PSBRPC",178,0)
 S $P(RESULTS(9),U,3)=$$GET1^DIQ(42,$P(RESULTS(9),U)_",",44,"I")_"^"_$$GET1^DIQ(42,$P(RESULTS(9),U)_",",44)
"RTN","PSBRPC",179,0)
 S GMRVSTR="HT" D EN6^GMRVUTL
"RTN","PSBRPC",180,0)
 S X=+$P(X,U,8) S:X X=X*2.54\1 S PSBHDR("HEIGHT")=$S(X:X_"cm",1:"*")
"RTN","PSBRPC",181,0)
 S RESULTS(16)=PSBHDR("HEIGHT")
"RTN","PSBRPC",182,0)
 S GMRVSTR="WT" D EN6^GMRVUTL
"RTN","PSBRPC",183,0)
 S X=+$P(X,U,8) S X=$J(X/2.2,0,2) S PSBHDR("WEIGHT")=$S(X:X_"kg",1:"*")
"RTN","PSBRPC",184,0)
 S RESULTS(17)=PSBHDR("WEIGHT")
"RTN","PSBRPC",185,0)
 S GMRA="0^0^111" D EN1^GMRADPT
"RTN","PSBRPC",186,0)
 I $O(GMRAL(0)) S RESULTS(18)=1
"RTN","PSBRPC",187,0)
 E  S RESULTS(18)=0
"RTN","PSBRPC",188,0)
 ; Means Tst
"RTN","PSBRPC",189,0)
 D GUIMTD^DPTLK6(.PSBDATA,PSBDFN)
"RTN","PSBRPC",190,0)
 S RESULTS(19)=+$G(PSBDATA(1))_U_$G(PSBDATA(2))_U_$G(PSBDATA(3))
"RTN","PSBRPC",191,0)
 S PSBICN=$$GETICN^MPIF001(PSBDFN) I +PSBICN=-1 S PSBICN=""
"RTN","PSBRPC",192,0)
 S RESULTS(20)=PSBICN
"RTN","PSBRPC",193,0)
 S RESULTS(21)="",RESULTS(0)=21
"RTN","PSBRPC",194,0)
 S:VADM(6)'="" RESULTS(21)="This patient died "_$TR($P(VADM(6),U,2),"@"," ")
"RTN","PSBRPC",195,0)
 S:('VAIP(13))&('VADM(6)) RESULTS(21)="Patient has been DISCHARGED"
"RTN","PSBRPC",196,0)
 S (RESULTS(0),PSBCNT)=22
"RTN","PSBRPC",197,0)
 S RESULTS(PSBCNT)=""
"RTN","PSBRPC",198,0)
 F PSBINDX=1:1:($$GETACT^DGPFAPI(PSBDFN,.PSBPTFLG)) D
"RTN","PSBRPC",199,0)
 .Q:'$D(PSBPTFLG)  Q:'$D(@(PSBPTFLG_"(PSBINDX,""FLAG"")"))  S PSBPFLAG="PATFLG",$P(PSBPFLAG,U,2)=$P(@(PSBPTFLG_"(PSBINDX,""FLAG"")"),"^",2)
"RTN","PSBRPC",200,0)
 .S $P(PSBPFLAG,U,3)=PSBINDX,PSBCNT=21+PSBINDX,RESULTS(PSBCNT)=PSBPFLAG
"RTN","PSBRPC",201,0)
 S RESULTS(0)=PSBCNT
"RTN","PSBRPC",202,0)
 I $D(PSBPTFLG) K @PSBPTFLG
"RTN","PSBRPC",203,0)
 K VAIP,VADM
"RTN","PSBRPC",204,0)
 Q
"RTN","PSBRPC",205,0)
 ;
"RTN","PSBRPC",206,0)
MAX(RESULTS,PSBDAYS) ;
"RTN","PSBRPC",207,0)
 ;
"RTN","PSBRPC",208,0)
 ; RPC: PSB MAXDAYS  ; Max days user view/print MAH
"RTN","PSBRPC",209,0)
 ;
"RTN","PSBRPC",210,0)
 S X=$O(^ORD(101.24,"B","ORRP BCMA MAH",""))
"RTN","PSBRPC",211,0)
 S RESULTS(0)=$$GET1^DIQ(101.24,X_",",.42)
"RTN","PSBRPC",212,0)
 Q
"RTN","PSBRPC",213,0)
 ;
"RTN","PSBRPC",214,0)
NWLIST(RESULTS,DUMMY) ; ward list - NURS LOCATION, file 211.4
"RTN","PSBRPC",215,0)
 ;
"RTN","PSBRPC",216,0)
 K ^TMP("PSB",$J)
"RTN","PSBRPC",217,0)
 S PSBIEN=0 F  S PSBIEN=$O(^NURSF(211.4,PSBIEN)) Q:PSBIEN'?.N  D
"RTN","PSBRPC",218,0)
 .S ^TMP("PSB",$J,$$GET1^DIQ(211.4,PSBIEN_",",.01))=PSBIEN
"RTN","PSBRPC",219,0)
 .S PSBX=0 F  S PSBX=$O(^NURSF(211.4,PSBIEN,3,PSBX)) Q:PSBX=""  D
"RTN","PSBRPC",220,0)
 ..S PSBWIEN=$P(^NURSF(211.4,PSBIEN,3,PSBX,0),"^")
"RTN","PSBRPC",221,0)
 ..I $$GET1^DIQ(42,PSBWIEN_",",.01)]"" S ^TMP("PSB",$J,$$GET1^DIQ(42,PSBWIEN_",",.01))=PSBIEN
"RTN","PSBRPC",222,0)
 S RESULTS(0)=0
"RTN","PSBRPC",223,0)
 S X="" F  S X=$O(^TMP("PSB",$J,X)) Q:X=""  S RESULTS(0)=RESULTS(0)+1,RESULTS(RESULTS(0))=^TMP("PSB",$J,X)_U_X
"RTN","PSBRPC",224,0)
 K ^TMP("PSB",$J)
"RTN","PSBRPC",225,0)
 Q
"RTN","PSBRPC",226,0)
 ;
"RTN","PSBRPC",227,0)
VITALS(RESULTS,DFN) ;Vital signs from Vitals API
"RTN","PSBRPC",228,0)
 ;
"RTN","PSBRPC",229,0)
 ; RPC PSB VITALS
"RTN","PSBRPC",230,0)
 ;
"RTN","PSBRPC",231,0)
 K RESULTS
"RTN","PSBRPC",232,0)
 N PSBSTRT,PSBSTOP,PSBNOW
"RTN","PSBRPC",233,0)
 S PSBDFN=DFN,GMRVSTR="T;P;R;BP;PN"
"RTN","PSBRPC",234,0)
 D NOW^%DTC S PSBNOW=%,PSBSTRT=$$FMADD^XLFDT(PSBNOW,"",-168),PSBSTOP=PSBNOW,GMRVSTR(0)=PSBSTRT_U_PSBSTOP_U_4_U
"RTN","PSBRPC",235,0)
 K ^UTILITY($J,"GMRVD")
"RTN","PSBRPC",236,0)
 D EN1^GMRVUT0
"RTN","PSBRPC",237,0)
 S PSBCNT=1
"RTN","PSBRPC",238,0)
 I '$D(^UTILITY($J,"GMRVD")) S RESULTS(0)=PSBCNT,RESULTS(PSBCNT)="No Vitals to report" Q
"RTN","PSBRPC",239,0)
 S PSBTYP=""
"RTN","PSBRPC",240,0)
 F  S PSBTYP=$O(^UTILITY($J,"GMRVD",PSBTYP)) Q:PSBTYP=""  D
"RTN","PSBRPC",241,0)
 .S PSBRDT=""
"RTN","PSBRPC",242,0)
 .F  S PSBRDT=$O(^UTILITY($J,"GMRVD",PSBTYP,PSBRDT)) Q:PSBRDT=""  D
"RTN","PSBRPC",243,0)
 ..S PSBIEN=""
"RTN","PSBRPC",244,0)
 ..F  S PSBIEN=$O(^UTILITY($J,"GMRVD",PSBTYP,PSBRDT,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBRPC",245,0)
 ...S PSBDATA=($G(^UTILITY($J,"GMRVD",PSBTYP,PSBRDT,PSBIEN)))
"RTN","PSBRPC",246,0)
 ...S RESULTS(PSBCNT)=PSBTYP_U_$P(PSBDATA,U,1,2)_U_$P(PSBDATA,U,8)
"RTN","PSBRPC",247,0)
 ...S PSBCNT=PSBCNT+1
"RTN","PSBRPC",248,0)
 S RESULTS(0)=PSBCNT-1
"RTN","PSBRPC",249,0)
 K ^UTILITY($J,"GMRVD"),GMRBSTR,PSBDFN,PSBTYPE,PSBDATA,PSBCNT
"RTN","PSBRPC",250,0)
 Q
"RTN","PSBRPC",251,0)
 ;
"RTN","PSBRPC3")
0^2^B296999^B297083
"RTN","PSBRPC3",1,0)
PSBRPC3 ;BIRMINGHAM/VRN-BCMA RPC BROKER CALLS ;Mar 2004
"RTN","PSBRPC3",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,16,13**;Mar 2004
"RTN","PSBRPC3",3,0)
 ;
"RTN","PSBRPC3",4,0)
GUICHK(RESULTS,DUMMY) ;
"RTN","PSBRPC3",5,0)
 ;
"RTN","PSBRPC3",6,0)
 ; RPC : PSB VERSION CHECK
"RTN","PSBRPC3",7,0)
 ;
"RTN","PSBRPC3",8,0)
 K RESULTS
"RTN","PSBRPC3",9,0)
 N PSBCURR,PSBPREV,PSBCNT
"RTN","PSBRPC3",10,0)
 S PSBCURR="3.0.13.*",PSBPREV="",PSBCNT=0
"RTN","PSBRPC3",11,0)
 S PSBCNT=PSBCNT+1
"RTN","PSBRPC3",12,0)
 S RESULTS(PSBCNT)=PSBCURR_U_PSBPREV
"RTN","PSBRPC3",13,0)
 S RESULTS(0)=PSBCNT
"RTN","PSBRPC3",14,0)
 Q
"RTN","PSBRPC3",15,0)
 ;
"RTN","PSBUTL")
0^10^B82345052^B72517837
"RTN","PSBUTL",1,0)
PSBUTL ;BIRMINGHAM/EFC-BCMA UTILITIES ;Mar 2004
"RTN","PSBUTL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,9,13**;Mar 2004
"RTN","PSBUTL",3,0)
 ; 
"RTN","PSBUTL",4,0)
 ; Reference/IA
"RTN","PSBUTL",5,0)
 ; $$PATCH & $$VERSION^XPDUTL/10141
"RTN","PSBUTL",6,0)
 ; File 50/221
"RTN","PSBUTL",7,0)
 ; File 200/10060
"RTN","PSBUTL",8,0)
 ;
"RTN","PSBUTL",9,0)
 ;
"RTN","PSBUTL",10,0)
DIWP(X,Y,PSB,PSBARGN) ; 
"RTN","PSBUTL",11,0)
 K ^UTILITY($J,"W")
"RTN","PSBUTL",12,0)
 S DIWL=0,DIWR=Y,DIWF="C"_Y D ^DIWP
"RTN","PSBUTL",13,0)
 F X=0:0 S X=$O(^UTILITY($J,"W",0,X)) Q:'X  D
"RTN","PSBUTL",14,0)
 .S Y=$O(@PSB@(""),-1)+1
"RTN","PSBUTL",15,0)
 .; Naked Reference below is from two lines above ^UTILITY($J,"W",0,X)
"RTN","PSBUTL",16,0)
 .S @PSB@(Y)=$J("",+$G(PSBARGN))_^(X,0)
"RTN","PSBUTL",17,0)
 S @PSB@(0)=+$O(@PSB@(""),-1)
"RTN","PSBUTL",18,0)
 K ^UTILITY($J,"W"),DIWL,DIWR,DIWF
"RTN","PSBUTL",19,0)
 Q
"RTN","PSBUTL",20,0)
 ;
"RTN","PSBUTL",21,0)
SATURDAY(X,PSBDISP) ; 
"RTN","PSBUTL",22,0)
 S X=X\1 D H^%DTC ; Convert to $H style
"RTN","PSBUTL",23,0)
 S %H=%H+(6-%Y) ;   Set it forward to Saturday
"RTN","PSBUTL",24,0)
 D YMD^%DTC ;       Back to FM Format
"RTN","PSBUTL",25,0)
 I $G(PSBDISP) S PSBDISP=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) D EN^DDIOL("Actual date is Saturday "_PSBDISP)
"RTN","PSBUTL",26,0)
 Q X
"RTN","PSBUTL",27,0)
 ;
"RTN","PSBUTL",28,0)
SUNDAY(X,PSBDISP) ; 
"RTN","PSBUTL",29,0)
 S X=X\1 D H^%DTC ; Convert to $H style
"RTN","PSBUTL",30,0)
 S %H=%H-%Y ;       Set it back to Sunday
"RTN","PSBUTL",31,0)
 D YMD^%DTC ;       Back to FM Format
"RTN","PSBUTL",32,0)
 I $G(PSBDISP) S PSBDISP=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3)) D EN^DDIOL("Actual date is Sunday "_PSBDISP)
"RTN","PSBUTL",33,0)
 Q X
"RTN","PSBUTL",34,0)
 ;
"RTN","PSBUTL",35,0)
CLOCK(RESULTS,X) ; Verify Client/Server Date/Times are close enough
"RTN","PSBUTL",36,0)
 ;
"RTN","PSBUTL",37,0)
 ; RPC: PSB SERVER CLOCK VARIANCE
"RTN","PSBUTL",38,0)
 ;
"RTN","PSBUTL",39,0)
 ; Description:
"RTN","PSBUTL",40,0)
 ; Returns the variance from the server to the client in minutes
"RTN","PSBUTL",41,0)
 ;
"RTN","PSBUTL",42,0)
 N PSBCLNT,PSBSRVR,PSBDIFF
"RTN","PSBUTL",43,0)
 S %DT="RS" D ^%DT S PSBCLNT=Y
"RTN","PSBUTL",44,0)
 D NOW^%DTC S PSBSRVR=%
"RTN","PSBUTL",45,0)
 S PSBDIFF=$$DIFF(PSBSRVR,PSBCLNT)
"RTN","PSBUTL",46,0)
 S X=$$GET^XPAR("DIV","PSB SERVER CLOCK VARIANCE")
"RTN","PSBUTL",47,0)
 I PSBDIFF>X!(PSBDIFF<(X*-1)) S RESULTS(0)="-1^"_PSBDIFF
"RTN","PSBUTL",48,0)
 E  S RESULTS(0)="1^"_PSBDIFF
"RTN","PSBUTL",49,0)
 Q
"RTN","PSBUTL",50,0)
 ;
"RTN","PSBUTL",51,0)
DIFF(X,X1) ; Difference in minutes between 2 FM dates
"RTN","PSBUTL",52,0)
 ; Code copied from Fileman Function MINUTES
"RTN","PSBUTL",53,0)
 S Y=$E(X1_"000",9,10)-$E(X_"000",9,10)*60+$E(X1_"00000",11,12)-$E(X_"00000",11,12),X2=X,X=$P(X,".",1)'=$P(X1,".",1) D ^%DTC:X S X=X*1440+Y
"RTN","PSBUTL",54,0)
 Q X
"RTN","PSBUTL",55,0)
 ;
"RTN","PSBUTL",56,0)
DRUGINQ ; Drug File Inquiry
"RTN","PSBUTL",57,0)
 N PSBRET,PSBIEN,DIC,DIR,IOINORM,IOINHI
"RTN","PSBUTL",58,0)
 S X="IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PSBUTL",59,0)
 S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PSBUTL",60,0)
 S DIC="^PSDRUG(",DIC(0)="AEQMVTN",DIC("T")="",D="B^C^VAPN^VAC^NDC^XATC",DIC("A")="Select DRUG: "
"RTN","PSBUTL",61,0)
 ; Display active drugs and those for appl packages IV and Unit Dose
"RTN","PSBUTL",62,0)
 S DIC("S")="I '$G(^PSDRUG(+Y,""I""))!($G(^(""I""))>DT),$P($G(^PSDRUG(+Y,2)),U,3)[""I""!($P($G(^PSDRUG(+Y,2)),U,3)[""U"")"
"RTN","PSBUTL",63,0)
 F  W @IOF,!,"DRUG FILE INQUIRY",! D ^DIC  Q:+Y<1  D
"RTN","PSBUTL",64,0)
 .K PSBRET
"RTN","PSBUTL",65,0)
 .S PSBIEN=+Y_","
"RTN","PSBUTL",66,0)
 .D GETS^DIQ(50,PSBIEN,".01;16;25;51;215;213;101;9*","","PSBRET")
"RTN","PSBUTL",67,0)
 .W @IOF,!,"DRUG NAME: ",IOINHI,PSBRET(50,PSBIEN,.01)
"RTN","PSBUTL",68,0)
 .W "  (IEN: ",+PSBIEN,")",IOINORM,!,$TR($J("",IOM)," ","-"),!
"RTN","PSBUTL",69,0)
 .F X=16,25,51,215,213,101 D
"RTN","PSBUTL",70,0)
 ..D FIELD^DID(50,X,"","LABEL","PSBRET")
"RTN","PSBUTL",71,0)
 ..W !,PSBRET("LABEL"),":",?30,IOINHI
"RTN","PSBUTL",72,0)
 ..D:$L(PSBRET(50,PSBIEN,X))>49
"RTN","PSBUTL",73,0)
 ...F Y=1:1 Q:$L($P(PSBRET(50,PSBIEN,X)," ",1,Y))>49
"RTN","PSBUTL",74,0)
 ...W $P(PSBRET(50,PSBIEN,X)," ",1,Y-1),!?30
"RTN","PSBUTL",75,0)
 ...S PSBRET(50,PSBIEN,X)=$P(PSBRET(50,PSBIEN,X)," ",Y,250)
"RTN","PSBUTL",76,0)
 ..W ?30,PSBRET(50,PSBIEN,X),IOINORM
"RTN","PSBUTL",77,0)
 .W !!,"SYNONYMS:",IOINHI,!?15
"RTN","PSBUTL",78,0)
 .S X="" F  S X=$O(PSBRET(50.1,X)) Q:X=""  W:$X>40 !?15 W:$X>15 ?40 W PSBRET(50.1,X,.01)
"RTN","PSBUTL",79,0)
 .W IOINORM
"RTN","PSBUTL",80,0)
 .F  Q:$Y>(IOSL-3)  W !
"RTN","PSBUTL",81,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSBUTL",82,0)
 Q
"RTN","PSBUTL",83,0)
 ;
"RTN","PSBUTL",84,0)
DPTSET ; Set Logic for pt-merge x-ref on patient field in file 53.79
"RTN","PSBUTL",85,0)
 ;
"RTN","PSBUTL",86,0)
 ; Entered Date/Time
"RTN","PSBUTL",87,0)
 I $P(^PSB(53.79,DA,0),U,4) S ^PSB(53.79,"AEDT",X,$P(^PSB(53.79,DA,0),U,4),DA)=""
"RTN","PSBUTL",88,0)
 ;
"RTN","PSBUTL",89,0)
 ; Administration Date/Time
"RTN","PSBUTL",90,0)
 D:$P(^PSB(53.79,DA,0),U,6)
"RTN","PSBUTL",91,0)
 .S ^PSB(53.79,"AADT",X,$P(^PSB(53.79,DA,0),U,6),DA)=""
"RTN","PSBUTL",92,0)
 .;
"RTN","PSBUTL",93,0)
 .; Orderable Item + Administration Date/Time
"RTN","PSBUTL",94,0)
 .I $P(^PSB(53.79,DA,0),U,8) S ^PSB(53.79,"AOIP",X,$P(^PSB(53.79,DA,0),U,8),$P(^PSB(53.79,DA,0),U,6),DA)=""
"RTN","PSBUTL",95,0)
 ;
"RTN","PSBUTL",96,0)
 ; PRN's by entered date/time
"RTN","PSBUTL",97,0)
 I $P($G(^PSB(53.79,DA,.1)),U,2)="P"&($P(^(0),U,4)) S ^PSB(53.79,"APRN",X,$P(^PSB(53.79,DA,0),U,4),DA)=""
"RTN","PSBUTL",98,0)
 ;
"RTN","PSBUTL",99,0)
 ; Order+Administration Date and Time
"RTN","PSBUTL",100,0)
 I $P($G(^PSB(53.79,DA,.1)),U)]""&($P($G(^PSB(53.79,DA,.1)),U,3)) S ^PSB(53.79,"AORD",X,$P(^PSB(53.79,DA,.1),U),$P(^PSB(53.79,DA,.1),U,3),DA)=""
"RTN","PSBUTL",101,0)
 Q
"RTN","PSBUTL",102,0)
 ;
"RTN","PSBUTL",103,0)
DPTKILL ; Kill Logic for pt-merge x-ref on patient field in file 53.79
"RTN","PSBUTL",104,0)
 ;
"RTN","PSBUTL",105,0)
 ; Entered Date/Time
"RTN","PSBUTL",106,0)
 I $P(^PSB(53.79,DA,0),U,4) K ^PSB(53.79,"AEDT",X,$P(^PSB(53.79,DA,0),U,4),DA)
"RTN","PSBUTL",107,0)
 ;
"RTN","PSBUTL",108,0)
 ; Administration Date/Time
"RTN","PSBUTL",109,0)
 D:$P(^PSB(53.79,DA,0),U,6)
"RTN","PSBUTL",110,0)
 .K ^PSB(53.79,"AADT",X,$P(^PSB(53.79,DA,0),U,6),DA)
"RTN","PSBUTL",111,0)
 .;
"RTN","PSBUTL",112,0)
 .; Orderable Item + Administration Date/Time
"RTN","PSBUTL",113,0)
 .I $P(^PSB(53.79,DA,0),U,8) K ^PSB(53.79,"AOIP",X,$P(^PSB(53.79,DA,0),U,8),$P(^PSB(53.79,DA,0),U,6),DA)
"RTN","PSBUTL",114,0)
 ;
"RTN","PSBUTL",115,0)
 ; PRN's by entered date/time
"RTN","PSBUTL",116,0)
 I $P($G(^PSB(53.79,DA,.1)),U,2)="P"&($P(^(0),U,4)) K ^PSB(53.79,"APRN",X,$P(^PSB(53.79,DA,0),U,4),DA)
"RTN","PSBUTL",117,0)
 ;
"RTN","PSBUTL",118,0)
 ; Order+Administration Date and Time
"RTN","PSBUTL",119,0)
 I $P($G(^PSB(53.79,DA,.1)),U)]""&($P($G(^PSB(53.79,DA,.1)),U,3)) K ^PSB(53.79,"AORD",X,$P(^PSB(53.79,DA,.1),U),$P(^PSB(53.79,DA,.1),U,3),DA)
"RTN","PSBUTL",120,0)
 Q
"RTN","PSBUTL",121,0)
 ;
"RTN","PSBUTL",122,0)
TIMEIN ;
"RTN","PSBUTL",123,0)
 X ^%ZOSF("UPPERCASE") S X=Y
"RTN","PSBUTL",124,0)
 I X="NOON" S X=.12 Q
"RTN","PSBUTL",125,0)
 I X="MID" S X=.24 Q
"RTN","PSBUTL",126,0)
 I (X="NOW")!(X="N") D NOW^%DTC S X=$E($P(%,".",2)_"0000",1,4)
"RTN","PSBUTL",127,0)
 S X="T@"_X,%DT="R" D ^%DT
"RTN","PSBUTL",128,0)
 I Y<1 K X Q
"RTN","PSBUTL",129,0)
 S X=Y-DT
"RTN","PSBUTL",130,0)
 Q
"RTN","PSBUTL",131,0)
 ;
"RTN","PSBUTL",132,0)
TIMEOUT(X) ; 
"RTN","PSBUTL",133,0)
 N HOUR,MIN,AMPM
"RTN","PSBUTL",134,0)
 S X=$E($P(X,".",2)_"0000",1,4)
"RTN","PSBUTL",135,0)
 I X="2400" Q "12:00m"
"RTN","PSBUTL",136,0)
 I X="1200" Q "12:00n"
"RTN","PSBUTL",137,0)
 S HOUR=+$E(X,1,2),MIN=$E(X,3,4)
"RTN","PSBUTL",138,0)
 S AMPM="a"
"RTN","PSBUTL",139,0)
 S AMPM=$S(HOUR<12:"a",HOUR>11:"p",1:"**")
"RTN","PSBUTL",140,0)
 S:HOUR>12 HOUR=HOUR-12
"RTN","PSBUTL",141,0)
 Q HOUR_":"_MIN_AMPM
"RTN","PSBUTL",142,0)
 ;
"RTN","PSBUTL",143,0)
HFSOPEN(HANDLE) ; 
"RTN","PSBUTL",144,0)
 N PSBDIR,PSBFILE
"RTN","PSBUTL",145,0)
 S PSBDIR=$$GET^XPAR("DIV","PSB HFS SCRATCH")
"RTN","PSBUTL",146,0)
 S PSBFILE="PSB"_DUZ_".DAT"
"RTN","PSBUTL",147,0)
 D OPEN^%ZISH(HANDLE,PSBDIR,PSBFILE,"W") Q:POP
"RTN","PSBUTL",148,0)
 S IOM=132,IOSL=99999,IOST="P-DUMMY",IOF=""""""
"RTN","PSBUTL",149,0)
 Q
"RTN","PSBUTL",150,0)
 ;
"RTN","PSBUTL",151,0)
HFSCLOSE(HANDLE) ; 
"RTN","PSBUTL",152,0)
 N PSBDIR,PSBFILE,PSBDEL
"RTN","PSBUTL",153,0)
 D CLOSE^%ZISH(HANDLE)
"RTN","PSBUTL",154,0)
 K ^TMP("PSBO",$J)
"RTN","PSBUTL",155,0)
 S PSBDIR=$$GET^XPAR("DIV","PSB HFS SCRATCH")
"RTN","PSBUTL",156,0)
 S PSBFILE="PSB"_DUZ_".DAT",PSBDEL(PSBFILE)=""
"RTN","PSBUTL",157,0)
 S X=$$FTG^%ZISH(PSBDIR,PSBFILE,$NAME(^TMP("PSBO",$J,2)),3)
"RTN","PSBUTL",158,0)
 S X=$$DEL^%ZISH(PSBDIR,$NA(PSBDEL))
"RTN","PSBUTL",159,0)
 Q
"RTN","PSBUTL",160,0)
 ;
"RTN","PSBUTL",161,0)
AUDIT(PSBREC,PSBDD,PSBFLD,PSBDATA,PSBSK) ; Med Log Audit
"RTN","PSBUTL",162,0)
 ; used by cross references to 53.79 to track changes to fields in Med Log file
"RTN","PSBUTL",163,0)
 ; xref AU05, AU06, AU09, AU16, AU21, AU22 pass the value 53.79 as PSBDD
"RTN","PSBUTL",164,0)
 ; xref AU303, AU304 pass the value 53.795 as PSBDD
"RTN","PSBUTL",165,0)
 ; xref AU603, AU604 pass the value 53.796 as PSBDD
"RTN","PSBUTL",166,0)
 ; xref AU703, AU704 pass the value 53.797 as PSBDD
"RTN","PSBUTL",167,0)
 ;
"RTN","PSBUTL",168,0)
 N PSBDT,PSBTMP
"RTN","PSBUTL",169,0)
 I '$D(PSBOLSTS) S PSBOLSTS=$P(^PSB(53.79,PSBREC,0),U,9)
"RTN","PSBUTL",170,0)
 I '$D(PSBOLDUZ) S PSBOLDUZ=$P(^PSB(53.79,PSBREC,0),U,5)
"RTN","PSBUTL",171,0)
 Q:$G(PSBDATA)=""!('$G(PSBAUDIT))
"RTN","PSBUTL",172,0)
 D NOW^%DTC S PSBDT=%
"RTN","PSBUTL",173,0)
 S PSBDATA=$$EXTERNAL^DILFD(PSBDD,PSBFLD,"",PSBDATA)  ; PSBDD=53.79, 53.795, 53.796, or 53.797 see comment at tag AUDIT
"RTN","PSBUTL",174,0)
 D FIELD^DID(PSBDD,PSBFLD,"","LABEL","PSBTMP")  ; PSBDD=53.79, 53.795, 53.796, or 53.797 see comment at tag AUDIT
"RTN","PSBUTL",175,0)
 S:'$D(^PSB(53.79,PSBREC,.9,0)) ^(0)="^53.799^^"
"RTN","PSBUTL",176,0)
 S Y=$O(^PSB(53.79,PSBREC,.9,""),-1)+1,X=""
"RTN","PSBUTL",177,0)
 I PSBTMP("LABEL")["ACTION STATUS" D  Q
"RTN","PSBUTL",178,0)
 .I PSBSK["K" S XY=Y F  S XY=$O(^PSB(53.79,PSBREC,.9,XY),-1) Q:($D(PSBGOON))!(+XY'>0)  D
"RTN","PSBUTL",179,0)
 ..I ^PSB(53.79,PSBREC,.9,XY,0)["ACTION STATUS Set to '" D  Q
"RTN","PSBUTL",180,0)
 ...S PSBGOON=1,PSBOLDUZ=$P(^PSB(53.79,PSBREC,.9,XY,0),U,2),X=$P(^PSB(53.79,PSBREC,.9,XY,0),"'",2)
"RTN","PSBUTL",181,0)
 .S:$L(X)'>2 X=PSBOLSTS,X=$S(X="G":"GIVEN",X="H":"HELD",X="R":"REFUSED",X="I":"INFUSING",X="C":"COMPLETED",X="S":"STOPPED",X="N":"NOT GIVEN",X="RM":"REMOVED",X="M":"MISSING DOSE",X="":PSBOLSTS)
"RTN","PSBUTL",182,0)
 .I PSBSK["K" S ^PSB(53.79,PSBREC,.9,Y,0)=PSBDT_U_DUZ_U_"Field: "_PSBTMP("LABEL")_" '"_PSBDATA_"' by '"_$$GET1^DIQ(200,PSBOLDUZ,"INITIAL")_"' deleted."
"RTN","PSBUTL",183,0)
 .E  S ^PSB(53.79,PSBREC,.9,Y,0)=PSBDT_U_DUZ_U_"Field: "_PSBTMP("LABEL")_" Set to '"_PSBDATA_"' by '"_$$GET1^DIQ(200,DUZ,"INITIAL")_"'."_U_PSBDATA
"RTN","PSBUTL",184,0)
 I PSBSK["K" S ^PSB(53.79,PSBREC,.9,Y,0)=PSBDT_U_DUZ_U_"Field: "_PSBTMP("LABEL")_" '"_PSBDATA_"' deleted."
"RTN","PSBUTL",185,0)
 E  S ^PSB(53.79,PSBREC,.9,Y,0)=PSBDT_U_DUZ_U_"Field: "_PSBTMP("LABEL")_$S(PSBTMP("LABEL")["DISPENSE DRUG":" Added '",1:" Set to '")_PSBDATA_"'."
"RTN","PSBUTL",186,0)
 K XY,PSBGOON
"RTN","PSBUTL",187,0)
 Q
"RTN","PSBUTL",188,0)
 ;
"RTN","PSBUTL",189,0)
CHECK(RESULTS,PSBWHAT,PSBDATA) ; Checks for KIDS Patch or Build
"RTN","PSBUTL",190,0)
 ; Module added in Patch PSB*1.0*3 DP/TOPEKA 22-DEC-1999 11:51:22 
"RTN","PSBUTL",191,0)
 ; PSBWHAT: B = Returns Build Version for packages by Namespace
"RTN","PSBUTL",192,0)
 ;          P = Returns if Patch is installed
"RTN","PSBUTL",193,0)
 ; PSBDATA: Build/Package namespace (i.e. PSB) or Patch Number
"RTN","PSBUTL",194,0)
 ;         (i.e. PSB*1.0*1)
"RTN","PSBUTL",195,0)
 ;
"RTN","PSBUTL",196,0)
 S RESULTS(0)="-1^Unknown Parameter "_$G(PSBWHAT,"<PSBWHAT Undefined>")
"RTN","PSBUTL",197,0)
 S PSBWHAT=$G(PSBWHAT),PSBDATA=$G(PSBDATA)
"RTN","PSBUTL",198,0)
 D:PSBWHAT="B"
"RTN","PSBUTL",199,0)
 .S X=$$VERSION^XPDUTL(PSBDATA)
"RTN","PSBUTL",200,0)
 .S RESULTS(0)=$S(X="":"-1^Unknown Package/Build",1:"1^"_X)
"RTN","PSBUTL",201,0)
 D:PSBWHAT="P"
"RTN","PSBUTL",202,0)
 .S X=$$PATCH^XPDUTL(PSBDATA)
"RTN","PSBUTL",203,0)
 .S RESULTS(0)=$S(X:"1^Patch Is Installed",1:"-1^Patch Is Not Installed")
"RTN","PSBUTL",204,0)
 Q
"RTN","PSBUTL",205,0)
 ;
"RTN","PSBUTL",206,0)
VERSION() ; [Extrinsic] 
"RTN","PSBUTL",207,0)
 ; Returns V#.# for display purposes
"RTN","PSBUTL",208,0)
 Q "V"_$J(2,0,1)
"RTN","PSBUTL",209,0)
 ;
"RTN","PSBUTL",210,0)
RESETADM ;
"RTN","PSBUTL",211,0)
 ;
"RTN","PSBUTL",212,0)
 ;  This Subroutine will reset a medication order's resources
"RTN","PSBUTL",213,0)
 ;  based on Med Log New Entry  or  Edit Med Log activity.
"RTN","PSBUTL",214,0)
 ;
"RTN","PSBUTL",215,0)
 ;  No input is necessary.  Environment should be setup at call.
"RTN","PSBUTL",216,0)
 ;
"RTN","PSBUTL",217,0)
 I '$G(PSBMMEN) S X=$S($P(PSBIEN,",",2)]"":$P(PSBIEN,",",2),1:+PSBIEN) D CLEAN^PSBVT,PSJ1^PSBVT($P(^PSB(53.79,X,0),U),$P(^PSB(53.79,X,.1),U)) D:($$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,$G(PSBMR)))  D CLEAN^PSBVT
"RTN","PSBUTL",218,0)
 .S X=PSBIEN,X2=X_$S(X="+1":",",1:"") Q:'$D(PSBFDA(53.79,X2,.09))  I $F("HR",PSBFDA(53.79,X2,.09))>1 S PSBFDA(53.79,X2,.26)=""
"RTN","PSBUTL",219,0)
 I $G(PSBMMEN),PSBIEN="+1",$G(PSBONX)["V" S PSBWSID=PSBFDA(53.79,"+1,",.26) K PSBFDA(53.79,"+1,",.26),PSBFDA(53.79,"+1,",.09)
"RTN","PSBUTL",220,0)
 I $G(PSBMMEN) I ($D(PSBWSID))&($G(Y(0))="SAVE") D
"RTN","PSBUTL",221,0)
 .S:(PSBREC(3)="G") PSBFDAX(53.79,X,.26)=PSBWSID
"RTN","PSBUTL",222,0)
 .S:$F("HR",PSBREC(3))>1 PSBFDAX(53.79,X,.26)=""
"RTN","PSBUTL",223,0)
 .S X=$P(PSBIEN,"+1,",2)
"RTN","PSBUTL",224,0)
 .D UPDATE^DIE("","PSBFDAX","X","PSBMSG")
"RTN","PSBUTL",225,0)
 Q
"RTN","PSBUTL",226,0)
 ;
"RTN","PSBUTL",227,0)
SCRNPTCH ;
"RTN","PSBUTL",228,0)
 ;
"RTN","PSBUTL",229,0)
 ; Maiintain the "APATCH" index from SCREENMAN and Manual Med Entry.
"RTN","PSBUTL",230,0)
 ;
"RTN","PSBUTL",231,0)
 I Y(0)'="GIVEN" S PSBGPTCH=0 Q
"RTN","PSBUTL",232,0)
 S PSBX=0 F  S PSBX=$O(^PSB(53.79,DA,.5,PSBX))  Q:+PSBX=0  Q:$P(^PSB(53.79,DA,.5,+PSBX,0),U,4)="PATCH"
"RTN","PSBUTL",233,0)
 Q:+PSBX=0
"RTN","PSBUTL",234,0)
 S PSBGPTCH=1
"RTN","PSBUTL",235,0)
 Q
"RTN","PSBUTL",236,0)
 ;
"RTN","PSBUTL",237,0)
GIVEPTCH ;
"RTN","PSBUTL",238,0)
 I $D(^PSB(53.79,"AORD",DFN,PSBONX)) N PSBX S PSBX="" F  S PSBX=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBX)) Q:+PSBX=0  D:$D(^PSB(53.79,"AORD",DFN,PSBONX,PSBX,DA))  Q:'$D(PSBX)
"RTN","PSBUTL",239,0)
 .I $D(^PSB(53.79,"AORD",DFN,PSBONX,PSBX,DA)) D
"RTN","PSBUTL",240,0)
 ..S PSBX=$P(^PSB(53.79,DA,0),U,6)
"RTN","PSBUTL",241,0)
 ..I PSBGPTCH S ^PSB(53.79,"APATCH",DFN,PSBX,DA)="" K PSBX,PSBGPTCH Q
"RTN","PSBUTL",242,0)
 ..I 'PSBGPTCH K ^PSB(53.79,"APATCH",DFN,PSBX,DA),PSBX,PSBGPTCH
"RTN","PSBUTL",243,0)
 Q
"RTN","PSBVDLPA")
0^3^B13252041^B11710856
"RTN","PSBVDLPA",1,0)
PSBVDLPA ;BIRMINGHAM/EFC-BCMA UNIT DOSE VIRTUAL DUE LIST FUNCTIONS ;Mar 2004
"RTN","PSBVDLPA",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,16,13**;Mar 2004
"RTN","PSBVDLPA",3,0)
 ;
"RTN","PSBVDLPA",4,0)
 ; called by PSBVDLUD to find patches not removed
"RTN","PSBVDLPA",5,0)
 ;
"RTN","PSBVDLPA",6,0)
 ; Reference/IA
"RTN","PSBVDLPA",7,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLPA",8,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBVDLPA",9,0)
 ;
"RTN","PSBVDLPA",10,0)
EN ;
"RTN","PSBVDLPA",11,0)
 S PSBGNODE="^PSB(53.79,"_"""APATCH"""_","_DFN_")"
"RTN","PSBVDLPA",12,0)
 F  S PSBGNODE=$Q(@PSBGNODE) Q:($QS(PSBGNODE,2)'="APATCH")!($QS(PSBGNODE,3)'=DFN)  D
"RTN","PSBVDLPA",13,0)
 .S PSBIEN=$QS(PSBGNODE,5)
"RTN","PSBVDLPA",14,0)
 .I '$D(^PSB(53.79,PSBIEN,.5,1)) Q
"RTN","PSBVDLPA",15,0)
 .I $P(^PSB(53.79,PSBIEN,.5,1,0),U,4)'="PATCH" Q
"RTN","PSBVDLPA",16,0)
 .I "G"'[$P(^PSB(53.79,PSBIEN,0),U,9)!($D(PSBONVDL(PSBIEN))) Q
"RTN","PSBVDLPA",17,0)
 .S PSBPBK=+($$GET^XPAR("DIV","PSB VDL PATCH DAYS"))
"RTN","PSBVDLPA",18,0)
 .S PSBZON=$P(^PSB(53.79,PSBIEN,.1),"^")
"RTN","PSBVDLPA",19,0)
 .D CLEAN^PSBVT
"RTN","PSBVDLPA",20,0)
 .D PSJ1^PSBVT(DFN,PSBZON)
"RTN","PSBVDLPA",21,0)
 .I PSBPBK'=0 D NOW^%DTC I ($$FMADD^XLFDT($P(PSBOSP,"."),(PSBPBK))<X) Q
"RTN","PSBVDLPA",22,0)
 .S $P(PSBREC,U,1)=DFN  ; dfn
"RTN","PSBVDLPA",23,0)
 .S $P(PSBREC,U,2)=PSBONX  ; order numer
"RTN","PSBVDLPA",24,0)
 .S $P(PSBREC,U,3)=PSBON  ; order ien
"RTN","PSBVDLPA",25,0)
 .S $P(PSBREC,U,4)="U"  ; order type U unit dose
"RTN","PSBVDLPA",26,0)
 .S $P(PSBREC,U,5)=PSBSCHT
"RTN","PSBVDLPA",27,0)
 .S $P(PSBREC,U,6)=PSBSCH
"RTN","PSBVDLPA",28,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"")
"RTN","PSBVDLPA",29,0)
 .S $P(PSBREC,U,8)=PSBOITX
"RTN","PSBVDLPA",30,0)
 .S $P(PSBREC,U,9)=PSBDOSE
"RTN","PSBVDLPA",31,0)
 .S $P(PSBREC,U,10)=PSBMR
"RTN","PSBVDLPA",32,0)
 .S:$D(PSBHSTAX(PSBOIT)) $P(PSBREC,U,11)=$O(PSBHSTAX(PSBOIT,""),-1),$P(PSBREC,U,20)=$O(PSBHSTAX(PSBOIT,$P(PSBREC,U,11),""),-1)
"RTN","PSBVDLPA",33,0)
 .D:'$D(PSBHSTAX(PSBOIT))
"RTN","PSBVDLPA",34,0)
 ..N PSBX,PSBY,PSBDONE S PSBDONE=0,PSBX="" F  S PSBX=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,PSBX),-1) Q:PSBX=""  D:'PSBDONE
"RTN","PSBVDLPA",35,0)
 ...S PSBY="" F  S PSBY=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,PSBX,PSBY),-1) Q:PSBY=""  D:'PSBDONE
"RTN","PSBVDLPA",36,0)
 ....S:$P(^PSB(53.79,PSBY,0),U,9)'="N" $P(PSBREC,U,20)=$P(^PSB(53.79,PSBY,0),U,9) S:($P(PSBREC,U,20)'="N")&($P(PSBREC,U,20)]"") $P(PSBREC,U,11)=PSBX,PSBDONE=1
"RTN","PSBVDLPA",37,0)
 .S $P(PSBREC,U,12)=PSBIEN
"RTN","PSBVDLPA",38,0)
 .S $P(PSBREC,U,13)="G"
"RTN","PSBVDLPA",39,0)
 .S $P(PSBREC,U,14)=$P(^PSB(53.79,PSBIEN,.1),U,3)
"RTN","PSBVDLPA",40,0)
 .I $P(PSBREC,U,14)="" S $P(PSBREC,U,14)=PSBNOW\1
"RTN","PSBVDLPA",41,0)
 .S $P(PSBREC,U,15)=PSBOIT
"RTN","PSBVDLPA",42,0)
 .D:$G(PSBTAB)="CVRSHT"
"RTN","PSBVDLPA",43,0)
 ..S $P(PSBREC,U,16)=0
"RTN","PSBVDLPA",44,0)
 ..F X="ID","IV","IM","SC","SQ" D  Q:$P(PSBREC,U,16)
"RTN","PSBVDLPA",45,0)
 ...I PSBMR?@(".E1"""_X_""".E"),PSBMR'["MISC" S $P(PSBREC,U,16)=1
"RTN","PSBVDLPA",46,0)
 ..I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLPA",47,0)
 ..E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLPA",48,0)
 ..S $P(PSBREC,U,19)=$S(PSBVNI]"":PSBVNI,PSBVNI']"":"***")
"RTN","PSBVDLPA",49,0)
 ..S $P(PSBREC,U,23)=""
"RTN","PSBVDLPA",50,0)
 ..S $P(PSBREC,U,26)=PSBOSP
"RTN","PSBVDLPA",51,0)
 ..S $P(PSBREC,U,27)=$$LASTG^PSBCSUTL($P(PSBREC,U),$P(PSBREC,U,15))
"RTN","PSBVDLPA",52,0)
 ..S $P(PSBREC,U,28)=1
"RTN","PSBVDLPA",53,0)
 ..; Place into Coversheet activity ARRAY
"RTN","PSBVDLPA",54,0)
 ..S PSBDIDX="" I $D(^PSB(53.79,"AORD",DFN,PSBONX)) D
"RTN","PSBVDLPA",55,0)
 ...S PSBXDTI="",PSBXDTI=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBXDTI),-1)
"RTN","PSBVDLPA",56,0)
 ...Q:'$D(^PSB(53.79,"AORD",DFN,PSBONX,PSBXDTI,PSBIEN))
"RTN","PSBVDLPA",57,0)
 ...S PSBADMX(PSBONX,PSBXDTI,PSBIEN)="",PSBDIDX=1
"RTN","PSBVDLPA",58,0)
 ..I ('PSBDIDX)&$D(^PSB(53.79,"AORDX",DFN,PSBONX)) D
"RTN","PSBVDLPA",59,0)
 ...S PSBXXDTI="",PSBXXDTI=$O(^PSB(53.79,"AORDX",DFN,PSBONX,PSBXXDTI),-1)
"RTN","PSBVDLPA",60,0)
 ...Q:'$D(^PSB(53.79,"AORDX",DFN,PSBONX,PSBXXDTI,PSBIEN))
"RTN","PSBVDLPA",61,0)
 ...S PSBADMX(PSBONX,PSBXXDTI,PSBIEN)=""
"RTN","PSBVDLPA",62,0)
 .S $P(PSBREC,U,18)="PATCH"
"RTN","PSBVDLPA",63,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLPA",64,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLPA",65,0)
 .S PSBDDS="" F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1 S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4),$P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLPA",66,0)
 .S PSBQRR=1
"RTN","PSBVDLPA",67,0)
 .D ADD^PSBVDLU1(PSBREC,PSBOTXT,$P(PSBREC,U,14),PSBDDS,"","",$S($G(PSBTAB)="CVRSHT":"CVRSHT",1:"UDTAB"))
"RTN","PSBVDLPA",68,0)
 K PSBPBK,PSBONVDL
"RTN","PSBVDLPA",69,0)
 Q
"RTN","PSBVDLPB")
0^6^B84312284^B82592790
"RTN","PSBVDLPB",1,0)
PSBVDLPB ;BIRMINGHAM/EFC-BCMA IV VIRTUAL DUE LIST ;Mar 2004
"RTN","PSBVDLPB",2,0)
 ;;3.0;BAR CODE MED ADMIN;**11,13**;Mar 2004
"RTN","PSBVDLPB",3,0)
 ;
"RTN","PSBVDLPB",4,0)
 ; Reference/IA
"RTN","PSBVDLPB",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLPB",6,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLPB",7,0)
 ; File 200/10060
"RTN","PSBVDLPB",8,0)
 ;
"RTN","PSBVDLPB",9,0)
EN(DFN,PSBDT) ; Default Order List Return for Today
"RTN","PSBVDLPB",10,0)
 ;
"RTN","PSBVDLPB",11,0)
 ; RPC: PSB GETORDERLIST
"RTN","PSBVDLPB",12,0)
 ;
"RTN","PSBVDLPB",13,0)
 ; Description:
"RTN","PSBVDLPB",14,0)
 ; Returns the current IV order set for today to display on the
"RTN","PSBVDLPB",15,0)
 ; client VDL
"RTN","PSBVDLPB",16,0)
 ;
"RTN","PSBVDLPB",17,0)
 ;
"RTN","PSBVDLPB",18,0)
 N PSBDATA,PSBTBOUT
"RTN","PSBVDLPB",19,0)
 S PSBTBOUT=0,PSBDOADD=0
"RTN","PSBVDLPB",20,0)
 S:PSBTAB="PBTAB" PSBDOADD=1
"RTN","PSBVDLPB",21,0)
 ;
"RTN","PSBVDLPB",22,0)
 ;This routine now re-uses the ^TMP("PSJ",$J global built in PSBVDLTB
"RTN","PSBVDLPB",23,0)
 ;
"RTN","PSBVDLPB",24,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 Q  ; No orders
"RTN","PSBVDLPB",25,0)
 ;
"RTN","PSBVDLPB",26,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBVDLPB",27,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX)
"RTN","PSBVDLPB",28,0)
 .;
"RTN","PSBVDLPB",29,0)
 .; << Standard checks for ALL orders >>
"RTN","PSBVDLPB",30,0)
 .;
"RTN","PSBVDLPB",31,0)
 .Q:PSBONX["P"  ;     No Pending Orders
"RTN","PSBVDLPB",32,0)
 .Q:'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBMR)
"RTN","PSBVDLPB",33,0)
 .Q:PSBOST>PSBWADM  ; Order Start Date/Time > admin window
"RTN","PSBVDLPB",34,0)
 .Q:PSBOSP<PSBWBEG  ; For all Order Stop Date/Time < vdl window
"RTN","PSBVDLPB",35,0)
 .Q:PSBOSTS["D"  ;     Is it DC'd
"RTN","PSBVDLPB",36,0)
 .Q:PSBNGF  ;  Is it marked DO NOT GIVE!
"RTN","PSBVDLPB",37,0)
 .; Non One-Times with stop date/time < now
"RTN","PSBVDLPB",38,0)
 .;
"RTN","PSBVDLPB",39,0)
 .D NOW^%DTC
"RTN","PSBVDLPB",40,0)
 .Q:PSBOSP<%
"RTN","PSBVDLPB",41,0)
 .;
"RTN","PSBVDLPB",42,0)
 .; include Active, Renewed, ReInstated and On Call
"RTN","PSBVDLPB",43,0)
 .; (Is it not one time)&(Is it not active or renewed or On Call)
"RTN","PSBVDLPB",44,0)
 .Q:PSBSCHT'="O"&((PSBOSTS'="A")&(PSBOSTS'="R")&(PSBOSTS'="RE")&(PSBOSTS'="O")&(PSBOSTS'="H"))
"RTN","PSBVDLPB",45,0)
 .;
"RTN","PSBVDLPB",46,0)
 .; Is One Time Given
"RTN","PSBVDLPB",47,0)
 .;
"RTN","PSBVDLPB",48,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBVDLPB",49,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLPB",50,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLPB",51,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBONX)&($P(^PSB(53.79,Y,0),U,9)="G") PSBGVN=1,(X,Y)=0
"RTN","PSBVDLPB",52,0)
 .;
"RTN","PSBVDLPB",53,0)
 .; How long does One Time remain on VDL ?
"RTN","PSBVDLPB",54,0)
 .S PSBRMN=1
"RTN","PSBVDLPB",55,0)
 .I PSBSCHT="O",PSBOSP'=PSBOST,%>PSBOSP S PSBRMN=0
"RTN","PSBVDLPB",56,0)
 .Q:'PSBRMN
"RTN","PSBVDLPB",57,0)
 .;
"RTN","PSBVDLPB",58,0)
 .; Is On-Call Given, Can it be given more than once
"RTN","PSBVDLPB",59,0)
 .;
"RTN","PSBVDLPB",60,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBVDLPB",61,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLPB",62,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLPB",63,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBON)&($P(^PSB(53.79,Y,0),U,9)="G") PSBGVN=1,(X,Y)=0
"RTN","PSBVDLPB",64,0)
 .;
"RTN","PSBVDLPB",65,0)
 .S PSBSTRT=PSBOST ; Order Start Date/Time
"RTN","PSBVDLPB",66,0)
 .S PSBSTOP=PSBOSP ; Order Stop Date/Time
"RTN","PSBVDLPB",67,0)
 .;
"RTN","PSBVDLPB",68,0)
 .S PSBREC=""
"RTN","PSBVDLPB",69,0)
 .S $P(PSBREC,U,1)=DFN ; dfn
"RTN","PSBVDLPB",70,0)
 .S $P(PSBREC,U,2)=PSBONX ; Order
"RTN","PSBVDLPB",71,0)
 .S $P(PSBREC,U,3)=+PSBON ; order ien
"RTN","PSBVDLPB",72,0)
 .S $P(PSBREC,U,4)=PSBOTYP ; iv/ud/pending
"RTN","PSBVDLPB",73,0)
 .S $P(PSBREC,U,5)=PSBSCHT ; schedule type
"RTN","PSBVDLPB",74,0)
 .S $P(PSBREC,U,6)=PSBSCH ; schedule
"RTN","PSBVDLPB",75,0)
 .S Y=""
"RTN","PSBVDLPB",76,0)
 .S:PSBSM Y="SM"
"RTN","PSBVDLPB",77,0)
 .S:PSBHSM Y="HSM"
"RTN","PSBVDLPB",78,0)
 .S $P(PSBREC,U,7)=Y ; self med
"RTN","PSBVDLPB",79,0)
 .S $P(PSBREC,U,8)=PSBOITX ; drugname
"RTN","PSBVDLPB",80,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ; dosage
"RTN","PSBVDLPB",81,0)
 .S $P(PSBREC,U,10)=PSBMR ; route
"RTN","PSBVDLPB",82,0)
 .; Last Given from the AOIP X-Ref - not given status not excepted
"RTN","PSBVDLPB",83,0)
 .S (YZ,PSBSTUS,PSBADMER)="" K PSBHSTA,PSBHSTAX
"RTN","PSBVDLPB",84,0)
 .F XZ=1:1:20 S YZ=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ),-1),(PSBCNT,PSBFLAG)=0 Q:YZ=""  D
"RTN","PSBVDLPB",85,0)
 ..S:YZ>0 $P(PSBREC,U,11)=YZ
"RTN","PSBVDLPB",86,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ,X),-1) Q:X=""  D
"RTN","PSBVDLPB",87,0)
 ...K PSBLCK L +^PSB(53.79,X):1  I  L -^PSB(53.79,X) S PSBLCK=1
"RTN","PSBVDLPB",88,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLPB",89,0)
 ...I $G(PSBSTUS)="" S:'$G(PSBLCK) PSBSTUS="X" I $G(PSBLCK) S PSBADMER=1 D
"RTN","PSBVDLPB",90,0)
 ....K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLPB",91,0)
 ....S PSBPARM6=X,Y=$P(^PSB(53.79,X,.1),U,3) D DD^%DT S PSBPARM3=Y,Y=$P(^PSB(53.79,X,0),U,6) D DD^%DT S PSBPARM5=Y
"RTN","PSBVDLPB",92,0)
 ....S PSBPARM7=$P(^PSB(53.79,X,0),U,7) S PSBPARM7="( # "_PSBPARM7_" ) "_$$GET1^DIQ(200,PSBPARM7_",",.01)
"RTN","PSBVDLPB",93,0)
 ....K PSBXTMP S PSBXTMP=PSBONX
"RTN","PSBVDLPB",94,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$$GET1^DIQ(53.79,PSBPARM6_",",.11))
"RTN","PSBVDLPB",95,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,PSBPARM3_" admin's ACTION STATUS is ""UNKNOWN"".",PSBSCH,PSBPARM5,PSBPARM6,PSBPARM7) ;  SEND AN E-MAIL
"RTN","PSBVDLPB",96,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBXTMP)  ;Reset Variables
"RTN","PSBVDLPB",97,0)
 ....S X=PSBPARM6 K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLPB",98,0)
 ...K PSBLCK S:(PSBSTUS']"") PSBSTUS="U"  I PSBSTUS'="N",($G(PSBSTUS)'="X") S PSBFLAG=1,PSBHSTA(YZ,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBVDLPB",99,0)
 ...D:PSBSTUS="N"
"RTN","PSBVDLPB",100,0)
 ....S $P(PSBREC,U,11)=""
"RTN","PSBVDLPB",101,0)
 ....S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBVDLPB",102,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLPB",103,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLPB",104,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBVDLPB",105,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBVDLPB",106,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBVDLPB",107,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBVDLPB",108,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBVDLPB",109,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBVDLPB",110,0)
 .S $P(PSBREC,U,12)=""  ;med log ien inserted below for actual date
"RTN","PSBVDLPB",111,0)
 .S $P(PSBREC,U,13)=""  ;med log status inserted below for actual date
"RTN","PSBVDLPB",112,0)
 .S $P(PSBREC,U,14)="" ;admin date inserted below
"RTN","PSBVDLPB",113,0)
 .S $P(PSBREC,U,15)=PSBOIT ; OI Pointer
"RTN","PSBVDLPB",114,0)
 .S $P(PSBREC,U,16)=0  ; Default to not injectable
"RTN","PSBVDLPB",115,0)
 .;Scan for injectable routes
"RTN","PSBVDLPB",116,0)
 .F X="ID","IV","IM","SC","SQ" D  Q:$P(PSBREC,U,16)
"RTN","PSBVDLPB",117,0)
 ..I PSBMR?@(".E1"""_X_""".E") S $P(PSBREC,U,16)=1
"RTN","PSBVDLPB",118,0)
 .; Variable dosage entered as ####-####?
"RTN","PSBVDLPB",119,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLPB",120,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLPB",121,0)
 .S $P(PSBREC,U,18)=PSBIVT  ;IV TYPE - dosage form
"RTN","PSBVDLPB",122,0)
 .S $P(PSBREC,U,20)=$S((PSBSTUS="X")!(PSBSTUS="N"):"",1:PSBSTUS) ;last action status
"RTN","PSBVDLPB",123,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLPB",124,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLPB",125,0)
 .;
"RTN","PSBVDLPB",126,0)
 .; Gather Dispense Drugs
"RTN","PSBVDLPB",127,0)
 .D NOW^%DTC
"RTN","PSBVDLPB",128,0)
 .S (PSBDDS,PSBSOLS,PSBADDS)="0"
"RTN","PSBVDLPB",129,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBVDLPB",130,0)
 ..Q:$P(PSBDDA(Y),U,4)&($P(PSBDDA(Y),U,4)<%)  ; Inactive
"RTN","PSBVDLPB",131,0)
 ..S:$P(PSBDDA(Y),U,3)="" $P(PSBDDA(Y),U,3)=1
"RTN","PSBVDLPB",132,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,3)
"RTN","PSBVDLPB",133,0)
 ..S $P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLPB",134,0)
 .; On-Call One Time PRN orders
"RTN","PSBVDLPB",135,0)
 .S PSBQRR=0
"RTN","PSBVDLPB",136,0)
 .I "^O^OC^P^"[(U_PSBSCHT_U) D  Q
"RTN","PSBVDLPB",137,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",138,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",139,0)
 .;
"RTN","PSBVDLPB",140,0)
 .; IV's - don't worry about admin times if blank
"RTN","PSBVDLPB",141,0)
 .I PSBONX["V","PSC"'[PSBIVT,PSBADST="" D  Q
"RTN","PSBVDLPB",142,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",143,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",144,0)
 .;
"RTN","PSBVDLPB",145,0)
 .; Now we deal with only continuous
"RTN","PSBVDLPB",146,0)
 .; process admintimes
"RTN","PSBVDLPB",147,0)
 .S (PSBYES,PSBODD,PSBYTF)=0
"RTN","PSBVDLPB",148,0)
 .S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBVDLPB",149,0)
 .I PSBYES,PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLPB",150,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBVDLPB",151,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLPB",152,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBVDLPB",153,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBVDLPB",154,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBVDLPB",155,0)
 .I 'PSBYES,PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBVDLPB",156,0)
 .S PSBADMIN=PSBADST
"RTN","PSBVDLPB",157,0)
 .I (PSBADMIN="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1("PBTAB") Q  ;calculate admin times based on frequency
"RTN","PSBVDLPB",158,0)
 .; No admin times, MAYDAY MAYDAY!!
"RTN","PSBVDLPB",159,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBVDLPB",160,0)
 .I PSBODD,PSBADST'="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH) Q
"RTN","PSBVDLPB",161,0)
 .; process admin times against beginning and ending date
"RTN","PSBVDLPB",162,0)
 .; build all orders for both days.
"RTN","PSBVDLPB",163,0)
 .F PSBY=1:1 Q:$P(PSBADMIN,"-",PSBY)=""  D
"RTN","PSBVDLPB",164,0)
 ..;For invalid admin times
"RTN","PSBVDLPB",165,0)
 ..I ($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N) D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBVDLPB",166,0)
 ..; apply this time to the beginning window date
"RTN","PSBVDLPB",167,0)
 ..S PSB=+(PSBWBEG\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLPB",168,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLPB",169,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLPB",170,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,PSB,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLPB",171,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",172,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",173,0)
 ..;
"RTN","PSBVDLPB",174,0)
 ..Q:(PSBWBEG\1)=(PSBWEND\1)  ; Window only has one day rare but possible
"RTN","PSBVDLPB",175,0)
 ..;
"RTN","PSBVDLPB",176,0)
 ..; apply this time to the ending window date
"RTN","PSBVDLPB",177,0)
 ..S PSB=+(PSBWEND\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLPB",178,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLPB",179,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLPB",180,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,PSB,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLPB",181,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",182,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",183,0)
 ;
"RTN","PSBVDLPB",184,0)
 ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLPB",185,0)
 D:PSBDOADD VNURSE^PSBVDLU1("PBTAB")
"RTN","PSBVDLPB",186,0)
 Q
"RTN","PSBVDLPB",187,0)
 ;
"RTN","PSBVDLU1")
0^11^B56415430^B53853310
"RTN","PSBVDLU1",1,0)
PSBVDLU1 ;BIRMINGHAM/EFC-VIRTUAL DUE LIST (VDL) UTILITIES ;Mar 2004
"RTN","PSBVDLU1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**13**;Mar 2004
"RTN","PSBVDLU1",3,0)
 ;
"RTN","PSBVDLU1",4,0)
 ; Reference/IA
"RTN","PSBVDLU1",5,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBVDLU1",6,0)
 ;
"RTN","PSBVDLU1",7,0)
ODDSCH(PSBTABX) ;
"RTN","PSBVDLU1",8,0)
 I (PSBOST'<PSBWBEG)&(PSBOST'>PSBWEND) D ADD(PSBREC,PSBOTXT,PSBOST,PSBDDS,PSBSOLS,PSBADDS,PSBTABX)  ;Include start date/time as admin
"RTN","PSBVDLU1",9,0)
 S PSBQUIT=0,PSBCDT=PSBOST F  S PSBCDT=$$FMADD^XLFDT(PSBCDT,"","",PSBFREQ) Q:PSBQUIT=1  D
"RTN","PSBVDLU1",10,0)
 .I $P(PSBCDT,".",2)="" S PSBCDT=PSBCDT-1_".24"
"RTN","PSBVDLU1",11,0)
 .I PSBCDT>PSBWEND S PSBQUIT=1 Q
"RTN","PSBVDLU1",12,0)
 .I PSBCDT'<PSBWBEG,PSBCDT<PSBOSP D ADD(PSBREC,PSBOTXT,PSBCDT,PSBDDS,PSBSOLS,PSBADDS,PSBTABX) Q
"RTN","PSBVDLU1",13,0)
 Q
"RTN","PSBVDLU1",14,0)
GETFREQ(PSBDFN,PSBORDN) ;
"RTN","PSBVDLU1",15,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBVDLU1",16,0)
 D EN^PSJBCMA1(PSBDFN,PSBORDN,1)
"RTN","PSBVDLU1",17,0)
 S PSBFREQ=$P(^TMP("PSJ1",$J,4),U,11)
"RTN","PSBVDLU1",18,0)
 S PSBSCHBR=$P(^TMP("PSJ1",$J,2),"^",5)
"RTN","PSBVDLU1",19,0)
 I $$PSBDCHK1^PSBVT1(PSBSCHBR) S PSBFREQ=""
"RTN","PSBVDLU1",20,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBVDLU1",21,0)
 Q PSBFREQ
"RTN","PSBVDLU1",22,0)
 ;
"RTN","PSBVDLU1",23,0)
GETADMIN(PSBDFN,PSBORDN,PSBSTRT,PSBFREQ,PSBEVDT) ;
"RTN","PSBVDLU1",24,0)
 ;Determine administration times of an odd schedule for today
"RTN","PSBVDLU1",25,0)
 N PSBADMIN
"RTN","PSBVDLU1",26,0)
 K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBVDLU1",27,0)
 D EN^PSJBCMA1(PSBDFN,PSBORDN,1)
"RTN","PSBVDLU1",28,0)
 S PSBADMIN=$P(^TMP("PSJ1",$J,4),U,9),PSBFREQ=$P(^TMP("PSJ1",$J,4),U,11),^TMP("PSB",$J,"GETADMIN",0)=PSBADMIN
"RTN","PSBVDLU1",29,0)
 I $E(PSBFREQ)'?1N K ^TMP("PSJ1",$J) Q $G(^TMP("PSB",$J,"GETADMIN",0))
"RTN","PSBVDLU1",30,0)
 I PSBFREQ=0 K ^TMP("PSJ1",$J) Q $G(^TMP("PSB",$J,"GETADMIN",0))
"RTN","PSBVDLU1",31,0)
 I PSBSTRT'<PSBEVDT S PSBADMIN=$E($P(PSBSTRT,".",2)_"0000",1,4),^TMP("PSB",$J,"GETADMIN",0)=PSBADMIN
"RTN","PSBVDLU1",32,0)
 S PSBCDT=PSBSTRT,(PSBADTMX,PSBQUIT)=0 F  S PSBCDT=$$FMADD^XLFDT(PSBCDT,"","",PSBFREQ) D  Q:PSBQUIT=1
"RTN","PSBVDLU1",33,0)
 .I $P(PSBCDT,".",2)="" S PSBCDT=PSBCDT-1_".24"
"RTN","PSBVDLU1",34,0)
 .I (PSBCDT\1)>(PSBEVDT\1) S PSBQUIT=1 Q
"RTN","PSBVDLU1",35,0)
 .I (PSBCDT\1)=(PSBEVDT\1) S PSBADMIN=PSBADMIN_$S(PSBADMIN="":"",1:"-")_$E($P(PSBCDT,".",2)_"0000",1,4)
"RTN","PSBVDLU1",36,0)
 .S ^TMP("PSB",$J,"GETADMIN",PSBADTMX)=PSBADMIN
"RTN","PSBVDLU1",37,0)
 .S:($L(PSBADMIN)+5)>255 PSBADTMX=PSBADTMX+1,PSBADMIN=""
"RTN","PSBVDLU1",38,0)
 K ^TMP("PSJ1",$J),PSBADTMX
"RTN","PSBVDLU1",39,0)
 Q $G(^TMP("PSB",$J,"GETADMIN",0))
"RTN","PSBVDLU1",40,0)
 ;
"RTN","PSBVDLU1",41,0)
ADD(PSBREC,PSBSI,PSBDT,PSBDD,PSBSOL,PSBADD,PSBTAB) ;
"RTN","PSBVDLU1",42,0)
 ;
"RTN","PSBVDLU1",43,0)
 ; Description: Add order to ^TMP("PSB",$J,PSBTAB,...) for RPC Return RESULTS
"RTN","PSBVDLU1",44,0)
 ;
"RTN","PSBVDLU1",45,0)
 ; PSBREC=order hdr from above
"RTN","PSBVDLU1",46,0)
 ; PSBSI=special instructions
"RTN","PSBVDLU1",47,0)
 ; PSBDT=admin date/time
"RTN","PSBVDLU1",48,0)
 ; PSBDD=Dispense Drugs
"RTN","PSBVDLU1",49,0)
 ; PSBSOL=Solutions
"RTN","PSBVDLU1",50,0)
 ; PSBADD=Additives
"RTN","PSBVDLU1",51,0)
 ;
"RTN","PSBVDLU1",52,0)
 N PSB
"RTN","PSBVDLU1",53,0)
 S PSBDT=$E(PSBDT,1,12),PSBQR=0
"RTN","PSBVDLU1",54,0)
 S PSB=$O(^TMP("PSB",$J,PSBTAB,""),-1) ; Get next node
"RTN","PSBVDLU1",55,0)
 S $P(PSBREC,U,14)=PSBDT ; Admin Time sits in ^14
"RTN","PSBVDLU1",56,0)
 I $P(PSBREC,U,5)'="O" S X=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT,0)) D:X
"RTN","PSBVDLU1",57,0)
 .S $P(PSBREC,U,12)=X
"RTN","PSBVDLU1",58,0)
 .K PSBLCK L +^PSB(53.79,X):1  I  L -^PSB(53.79,X) S PSBLCK=1
"RTN","PSBVDLU1",59,0)
 .S PSBSTUS=$P(^PSB(53.79,X,0),U,9),$P(PSBREC,U,13)=$S(PSBSTUS="N":"",(PSBSTUS="")&$G(PSBLCK):"U",1:PSBSTUS),$P(PSBREC,U,23)=$P(^PSB(53.79,X,0),U,10),$P(PSBREC,U,24)=$P(^PSB(53.79,X,0),U,7)
"RTN","PSBVDLU1",60,0)
 .I $D(^PSB(53.79,X)) I PSBDOSEF="PATCH",PSBSTUS="G",PSBDT=$P(^PSB(53.79,X,.1),U,3),PSBQRR=0 S PSBQR=1
"RTN","PSBVDLU1",61,0)
 .I PSBSTUS="G",$G(PSBFLAG) D CHECK ;Get the correct dispense drug
"RTN","PSBVDLU1",62,0)
 I ($P(PSBREC,U,5)="O") D
"RTN","PSBVDLU1",63,0)
 .S X=$O(^PSB(53.79,"AORDX",DFN,PSBONX,"")) Q:X=""
"RTN","PSBVDLU1",64,0)
 .S Y=$O(^PSB(53.79,"AORDX",DFN,PSBONX,X,"")) Q:Y=""  S $P(PSBREC,U,12)=Y
"RTN","PSBVDLU1",65,0)
 .K PSBLCK L +^PSB(53.79,Y):1  I  L -^PSB(53.79,Y) S PSBLCK=1
"RTN","PSBVDLU1",66,0)
 .S PSBSTUS=$P(^PSB(53.79,Y,0),U,9),$P(PSBREC,U,13)=$S(PSBSTUS="N":"",(PSBSTUS="")&$G(PSBLCK):"U",1:PSBSTUS),$P(PSBREC,U,24)=$P(^PSB(53.79,Y,0),U,7)
"RTN","PSBVDLU1",67,0)
 .I $D(^PSB(53.79,Y)) I PSBDOSEF="PATCH",PSBSTUS="G",PSBDT=$P(^PSB(53.79,Y,.1),U,3),PSBQRR=0 S PSBQR=1
"RTN","PSBVDLU1",68,0)
 .I PSBSTUS="G",$G(PSBFLAG) D CHECK
"RTN","PSBVDLU1",69,0)
 Q:PSBQR=1
"RTN","PSBVDLU1",70,0)
 S $P(PSBREC,U,25)=0 I $G(PSBTRFL),$P(PSBREC,U,11)]"",$P(PSBREC,U,11)'<$G(PSBNTDT),$P(PSBREC,U,11)'>$G(PSBTRDT) S $P(PSBREC,U,25)=1
"RTN","PSBVDLU1",71,0)
 S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBREC ; Order Hdr
"RTN","PSBVDLU1",72,0)
 I $P(PSBREC,U,12)]"" S PSBONVDL($P(PSBREC,U,12))=""
"RTN","PSBVDLU1",73,0)
 S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBSI ; Special Instructions
"RTN","PSBVDLU1",74,0)
 ; add dispense drugs
"RTN","PSBVDLU1",75,0)
 I $D(PSBDDA) S X="" F  S X=$O(PSBDDA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBDDA(X)
"RTN","PSBVDLU1",76,0)
 S PSBCHDT=0
"RTN","PSBVDLU1",77,0)
 I PSBONX["V",PSBOSTS="D",$G(PSBFOR)="" D  Q  ;get infusing bag from DCed but not DEed orders
"RTN","PSBVDLU1",78,0)
 .D PSJ^PSBVT(PSBX)
"RTN","PSBVDLU1",79,0)
 .D INFUSING^PSBVDLU2 I PSBCOMP=0 Q
"RTN","PSBVDLU1",80,0)
 .I $D(PSBSOLA) S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBSOLA(X)
"RTN","PSBVDLU1",81,0)
 .I $D(PSBADA) S X="" F  S X=$O(PSBADA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBADA(X)
"RTN","PSBVDLU1",82,0)
 .S X="" F  S X=$O(PSBPORA(PSBONX,X)) S PSBUID=$P(PSBPORA(PSBONX,X),U,1) Q:PSBUID]""  Q:X=""
"RTN","PSBVDLU1",83,0)
 .I PSBUID["P" Q
"RTN","PSBVDLU1",84,0)
 .I PSBUID["WS" D
"RTN","PSBVDLU1",85,0)
 ..S PSBNODE=$O(^PSB(53.79,"AUID",DFN,X,PSBUID,""))
"RTN","PSBVDLU1",86,0)
 ..S PSBUIDA(PSBUID)="ID"_U_PSBUID
"RTN","PSBVDLU1",87,0)
 ..S X=0 F  S X=$O(^PSB(53.79,PSBNODE,.6,X)) Q:'X  S PSBUIDA(PSBUID)=PSBUIDA(PSBUID)_U_"ADD;"_$P(^PSB(53.79,PSBNODE,.6,X,0),U,1)
"RTN","PSBVDLU1",88,0)
 ..S X=0 F  S X=$O(^PSB(53.79,PSBNODE,.7,X)) Q:'X  S PSBUIDA(PSBUID)=PSBUIDA(PSBUID)_U_"SOL;"_$P(^PSB(53.79,PSBNODE,.7,X,0),U,1)
"RTN","PSBVDLU1",89,0)
 .S PSBSONX=PSBONX
"RTN","PSBVDLU1",90,0)
 .I '$D(PSBUIDA(PSBUID)) S PSBCKOR="" F  S PSBCKOR=$O(PSBPORA(PSBSONX,PSBCKOR)) Q:PSBCKOR=""  D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBCKOR) Q:$D(PSBUIDA(PSBUID))
"RTN","PSBVDLU1",91,0)
 .S PSBONX=PSBSONX
"RTN","PSBVDLU1",92,0)
 .S:$D(PSBUIDA(PSBUID)) PSB=PSB+2,^TMP("PSB",$J,PSBTAB,PSB-1)=PSBUIDA(PSBUID),^TMP("PSB",$J,PSBTAB,PSB)="END"
"RTN","PSBVDLU1",93,0)
 .D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$O(PSBPORA("")))
"RTN","PSBVDLU1",94,0)
 ; add additives
"RTN","PSBVDLU1",95,0)
 I $D(PSBADA) S X="" F  S X=$O(PSBADA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBADA(X)
"RTN","PSBVDLU1",96,0)
 ; add solutions
"RTN","PSBVDLU1",97,0)
 I $D(PSBSOLA) S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  S $P(PSBSOLA(X),U,5)="",PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBSOLA(X)
"RTN","PSBVDLU1",98,0)
 I PSBONX["V" D EN^PSBPOIV(DFN,PSBONX)  ; get bags
"RTN","PSBVDLU1",99,0)
 I $D(^TMP("PSBAR",$J)) S PSBUID=DFN_"V"_99999 F  S PSBUID=$O(^TMP("PSBAR",$J,PSBUID),-1) Q:PSBUID=""  D
"RTN","PSBVDLU1",100,0)
 .S PSBUIDS=^TMP("PSBAR",$J,PSBUID)
"RTN","PSBVDLU1",101,0)
 .I $P(PSBUIDS,U,1)="I",$P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S" Q  ; bag has invalid IV parameter, is not infusing or stopped
"RTN","PSBVDLU1",102,0)
 .I $P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S",$P(PSBUIDS,U,8)'="" Q  ; label is no longer valid, bag is not infusing or stopped
"RTN","PSBVDLU1",103,0)
 .I $P(PSBUIDS,U,2)="C" Q  ; bag is completed
"RTN","PSBVDLU1",104,0)
 .I $P(PSBUIDS,U,2)="G" Q  ; bag is given (PBTAB)
"RTN","PSBVDLU1",105,0)
 .S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=$P(PSBUIDS,U,10,999)
"RTN","PSBVDLU1",106,0)
 K ^TMP("PSBAR",$J)
"RTN","PSBVDLU1",107,0)
 S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)="END"
"RTN","PSBVDLU1",108,0)
 S ^TMP("PSB",$J,PSBTAB,0)=PSB
"RTN","PSBVDLU1",109,0)
 Q
"RTN","PSBVDLU1",110,0)
 ;
"RTN","PSBVDLU1",111,0)
CHECK S FILE=53.795,PSBNODE=.5,PSBIENS=X_","
"RTN","PSBVDLU1",112,0)
 F I=0:0 S I=$O(^PSB(53.79,X,PSBNODE,I)) Q:'I  S $P(PSBDDS,U,3,4)=$$GET1^DIQ(FILE,I_","_PSBIENS,.01,"I")_U_$$GET1^DIQ(FILE,I_","_PSBIENS,.01)
"RTN","PSBVDLU1",113,0)
 Q
"RTN","PSBVDLU1",114,0)
 ;
"RTN","PSBVDLU1",115,0)
VNURSE(PSBTAB) ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLU1",116,0)
 F PSBLP=1:1:$P(^TMP("PSB",$J,PSBTAB,0),U,1) S X=^TMP("PSB",$J,PSBTAB,PSBLP) I $P(X,U)=DFN D
"RTN","PSBVDLU1",117,0)
 .K ^TMP("PSJ1",$J)
"RTN","PSBVDLU1",118,0)
 .D PSJ1^PSBVT(DFN,$P(X,U,2))
"RTN","PSBVDLU1",119,0)
 .S $P(^TMP("PSB",$J,PSBTAB,PSBLP),U,19)=$S(PSBVNI]"":PSBVNI,1:"***")
"RTN","PSBVDLU1",120,0)
 K PSBLP,PSBTAB
"RTN","PSBVDLU1",121,0)
 Q
"RTN","PSBVDLU1",122,0)
 ;
"RTN","PSBVDLU1",123,0)
OKAY(PSBSTRT,PSBADMIN,PSBSCH,PSBORDER,PSBDRUG,PSBFREQ,PSBOSTS) ;
"RTN","PSBVDLU1",124,0)
 ;
"RTN","PSBVDLU1",125,0)
 ; Description: Determines if an order schedule is valid for
"RTN","PSBVDLU1",126,0)
 ;  the date in PSBADMIN (i.e. Q4D, is it valid today)
"RTN","PSBVDLU1",127,0)
 ;
"RTN","PSBVDLU1",128,0)
 ; PSBSTRT:  Start Date of order (Time ignored)
"RTN","PSBVDLU1",129,0)
 ; PSBADMIN: Date of administration to check (Time ignored)
"RTN","PSBVDLU1",130,0)
 ; PSBSCH:  Schedule (i.e. MO-WE-FR@0900 or Q48H...)
"RTN","PSBVDLU1",131,0)
 ; PSBORDER: Order reference
"RTN","PSBVDLU1",132,0)
 ; PSBDRUG:  Drug ordered (Orderable Item)
"RTN","PSBVDLU1",133,0)
 ; PSBOSTS: The status of the order
"RTN","PSBVDLU1",134,0)
 ;
"RTN","PSBVDLU1",135,0)
 N PSBOKAY,PSBDAYS,PSBDOW
"RTN","PSBVDLU1",136,0)
 S PSBOSTS=$G(PSBOSTS)
"RTN","PSBVDLU1",137,0)
 ;
"RTN","PSBVDLU1",138,0)
 S PSBOKAY=0  ; Default Flag
"RTN","PSBVDLU1",139,0)
 I PSBFREQ'="",PSBFREQ'="D",PSBFREQ'>1440 Q 1
"RTN","PSBVDLU1",140,0)
 ;PRN and ONE TIMES show everyday
"RTN","PSBVDLU1",141,0)
 I (PSBSCHT="P")!(PSBSCHT="O") Q 1
"RTN","PSBVDLU1",142,0)
 S PSBDAYS=$$DAYS(PSBSCH)
"RTN","PSBVDLU1",143,0)
 ;
"RTN","PSBVDLU1",144,0)
 I PSBDAYS=1 S PSBOKAY=1 Q PSBOKAY  ; Order is everyday
"RTN","PSBVDLU1",145,0)
 ;
"RTN","PSBVDLU1",146,0)
 ; find out if today is a good day for multi days
"RTN","PSBVDLU1",147,0)
 S PSBOKAY=0,PSBRDTE=PSBSTRT
"RTN","PSBVDLU1",148,0)
 S PSBADBR=PSBADMIN\1
"RTN","PSBVDLU1",149,0)
 S PSBENR=(PSBADMIN\1)+1
"RTN","PSBVDLU1",150,0)
 I PSBDAYS>1 D  Q PSBOKAY
"RTN","PSBVDLU1",151,0)
 .I PSBADBR=(PSBSTRT\1) S PSBOKAY=1
"RTN","PSBVDLU1",152,0)
 .F  S PSBRDTE=$$FMADD^XLFDT(PSBRDTE,"","",PSBFREQ) Q:PSBRDTE>PSBENR  D
"RTN","PSBVDLU1",153,0)
 ..I $P(PSBRDTE,".",2)="" S PSBRDTE=PSBRDTE-1_".24"
"RTN","PSBVDLU1",154,0)
 ..I PSBRDTE\1=PSBADBR S PSBOKAY=1
"RTN","PSBVDLU1",155,0)
 ..I PSBOKAY="1" Q
"RTN","PSBVDLU1",156,0)
 ;
"RTN","PSBVDLU1",157,0)
 ; Try the MO-WE-FR@0800 thing as last resort
"RTN","PSBVDLU1",158,0)
 S X=PSBADMIN D H^%DTC I %Y=-1 D  Q PSBOKAY  ; Error
"RTN","PSBVDLU1",159,0)
 .S PSBOKAY=0
"RTN","PSBVDLU1",160,0)
 .Q:PSBOSTS="E"
"RTN","PSBVDLU1",161,0)
 .Q:$G(PSBMHND)="PSBOMH"
"RTN","PSBVDLU1",162,0)
 .D ERROR^PSBMLU($G(PSBORDER,"UNKNOWN"),$G(PSBDRUG,""),DFN,"Unable to determine schedule "_PSBSCH,PSBSCH)
"RTN","PSBVDLU1",163,0)
 S PSBDOW=$P("SU^MO^TU^WE^TH^FR^SA",U,%Y+1)
"RTN","PSBVDLU1",164,0)
 I $F(PSBSCH,PSBDOW)>0 S PSBOKAY=1 Q PSBOKAY
"RTN","PSBVDLU1",165,0)
 S PSBOKAY=0
"RTN","PSBVDLU1",166,0)
 Q PSBOKAY
"RTN","PSBVDLU1",167,0)
 ;
"RTN","PSBVDLU1",168,0)
DAYS(PSB) ; Return days between doses (-1: error, 1:everyday 2: QOD...)
"RTN","PSBVDLU1",169,0)
 ;
"RTN","PSBVDLU1",170,0)
 ; Is it a PRN
"RTN","PSBVDLU1",171,0)
 I PSB?.E1"PRN".E Q 1  ; Straight PRN - As Needed
"RTN","PSBVDLU1",172,0)
 ;
"RTN","PSBVDLU1",173,0)
 S PSB=$TR(PSB," ","")
"RTN","PSBVDLU1",174,0)
 I PSB?2.4N.E Q 1
"RTN","PSBVDLU1",175,0)
 S X=PSBFREQ/1440 Q X
"RTN","PSBVDLU1",176,0)
 ;
"RTN","PSBVDLU1",177,0)
 Q
"RTN","PSBVDLU1",178,0)
 ;
"RTN","PSBVDLU1",179,0)
LAST ;
"RTN","PSBVDLU1",180,0)
 S PSBCC=0
"RTN","PSBVDLU1",181,0)
 S ZZ="" F  S ZZ=$O(^PSB(53.79,X,.3,ZZ),-1) Q:'ZZ  Q:PSBFLAG=1  S PSBDATA2=$G(^(ZZ,0)) D
"RTN","PSBVDLU1",182,0)
 .S PSBCC=PSBCC+1
"RTN","PSBVDLU1",183,0)
 .I (PSBCC=2)!($P($P(PSBDATA2,U)," ")="Refused:")!($P($P(PSBDATA2,U)," ")="Held:") S $P(PSBREC,U,11)=$P(PSBDATA2,U,3),PSBFLAG=1
"RTN","PSBVDLU1",184,0)
 Q
"RTN","PSBVDLU1",185,0)
 ;
"RTN","PSBVDLU3")
0^21^B39075787^B7773577
"RTN","PSBVDLU3",1,0)
PSBVDLU3 ;BIRMINGHAM/TEJ-BCMA VDL UTILITIES 3 ;Mar 2004
"RTN","PSBVDLU3",2,0)
 ;;3.0;BAR CODE MED ADMIN;**13**;Mar 2004
"RTN","PSBVDLU3",3,0)
 ;
"RTN","PSBVDLU3",4,0)
 ;This routine file has been created to serve as a container
"RTN","PSBVDLU3",5,0)
 ;for Extrinsic Variables/Functions
"RTN","PSBVDLU3",6,0)
 ;
"RTN","PSBVDLU3",7,0)
 ; Reference/IA
"RTN","PSBVDLU3",8,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLU3",9,0)
 ;
"RTN","PSBVDLU3",10,0)
IVPTAB(PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBMROUT)  ;
"RTN","PSBVDLU3",11,0)
 ;
"RTN","PSBVDLU3",12,0)
 ; This function will return
"RTN","PSBVDLU3",13,0)
 ; the value 1 (one) if the
"RTN","PSBVDLU3",14,0)
 ; specified order input will cause
"RTN","PSBVDLU3",15,0)
 ; the order to display on the "IVP/IVPB"
"RTN","PSBVDLU3",16,0)
 ; tab of the VDL BCMA Virtual Due List (VDL)
"RTN","PSBVDLU3",17,0)
 ; else return the value 0 (zero).
"RTN","PSBVDLU3",18,0)
 ;
"RTN","PSBVDLU3",19,0)
 ; Input Parameters:
"RTN","PSBVDLU3",20,0)
 ;
"RTN","PSBVDLU3",21,0)
 ;     PSBORTYP - Order type (e.g. "U","V")
"RTN","PSBVDLU3",22,0)
 ;     PSBIVTYP - IV Type (e.g. "P","S","C")
"RTN","PSBVDLU3",23,0)
 ;     PSBINTSY - Intermittent Syringe value
"RTN","PSBVDLU3",24,0)
 ;     PSBCHMTY - Chemo type (e.g. "P","S")
"RTN","PSBVDLU3",25,0)
 ;     PSBMROUT - Med Route value (e.g. "IVP","IV PUSH","IVPB")
"RTN","PSBVDLU3",26,0)
 ;
"RTN","PSBVDLU3",27,0)
 ; Output:
"RTN","PSBVDLU3",28,0)
 ;     1 - order will display on the "IVP/IVPB" Tab of BCMA VDL
"RTN","PSBVDLU3",29,0)
 ;     0 - order will NOT display on the "IVP/IVPB" Tab of BCMA VDL
"RTN","PSBVDLU3",30,0)
 ;    -1 - error processed
"RTN","PSBVDLU3",31,0)
 ;
"RTN","PSBVDLU3",32,0)
 Q:'$D(PSBORTYP) "-1^Missing Parameter"
"RTN","PSBVDLU3",33,0)
 I PSBORTYP="U"&(($G(PSBMROUT)="IV PUSH")!($G(PSBMROUT)="IVP")) Q 1
"RTN","PSBVDLU3",34,0)
 I '(PSBORTYP="V") Q 0
"RTN","PSBVDLU3",35,0)
 I $G(PSBIVTYP)="P" Q 1
"RTN","PSBVDLU3",36,0)
 I $G(PSBIVTYP)="S",$G(PSBINTSY)=1 Q 1
"RTN","PSBVDLU3",37,0)
 I $G(PSBIVTYP)="C",$G(PSBCHMTY)="P" Q 1
"RTN","PSBVDLU3",38,0)
 I $G(PSBIVTYP)="C",$G(PSBCHMTY)="S",$G(PSBINTSY)=1 Q 1
"RTN","PSBVDLU3",39,0)
 Q 0
"RTN","PSBVDLU3",40,0)
 ;
"RTN","PSBVDLU3",41,0)
SHOVDL(DFN,BDATE,OTDATE,PSBTAB) ;
"RTN","PSBVDLU3",42,0)
 ;
"RTN","PSBVDLU3",43,0)
 ; This function will find orders such as discontinued or expired infusing IV bags 
"RTN","PSBVDLU3",44,0)
 ; or discontinued or expired "given" patches.  Recognizing these types of orders
"RTN","PSBVDLU3",45,0)
 ; will allow these orders to be displayed on the VDL and permits the user to take 
"RTN","PSBVDLU3",46,0)
 ; action on them.  This routine determines if such orders exist for patient,
"RTN","PSBVDLU3",47,0)
 ; time, and "BCMA VDL tab."  This routine is an "extention" to the API EN^PSJBCMA.
"RTN","PSBVDLU3",48,0)
 ;
"RTN","PSBVDLU3",49,0)
 ; INPUT Parameters:
"RTN","PSBVDLU3",50,0)
 ;    DFN           (req)   Patient Internal File Number.
"RTN","PSBVDLU3",51,0)
 ;    BDATE         (opt)   Start searching for "order stop" after this date. 
"RTN","PSBVDLU3",52,0)
 ;    OTDATE        (opt)   Include One-Time orders from this date.
"RTN","PSBVDLU3",53,0)
 ;    PSBTAB        (opt)   "UDTAB" or "IVTAB" - expedites process if specific tab
"RTN","PSBVDLU3",54,0)
 ;                            is given.
"RTN","PSBVDLU3",55,0)
 ;
"RTN","PSBVDLU3",56,0)
 ; OUTPUT Values
"RTN","PSBVDLU3",57,0)
 ;    0               absolutely no orders to display on VDL
"RTN","PSBVDLU3",58,0)
 ;    1               displayable orders have been located.
"RTN","PSBVDLU3",59,0)
 ;
"RTN","PSBVDLU3",60,0)
 ;
"RTN","PSBVDLU3",61,0)
 D EN^PSJBCMA(DFN,$G(BDATE),$G(OTDATE))
"RTN","PSBVDLU3",62,0)
 ; any active Patch orders to show on VDL?
"RTN","PSBVDLU3",63,0)
 S PSBFLG=0
"RTN","PSBVDLU3",64,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 D
"RTN","PSBVDLU3",65,0)
 .;  
"RTN","PSBVDLU3",66,0)
 .; Check the indexice for given patches or infusing IVs
"RTN","PSBVDLU3",67,0)
 .;
"RTN","PSBVDLU3",68,0)
 .; Check APATCH
"RTN","PSBVDLU3",69,0)
 .D:($G(PSBTAB)="UDTAB")!($G(PSBTAB)="")  Q:PSBFLG
"RTN","PSBVDLU3",70,0)
 ..S PSBGNODE="^PSB(53.79,"_"""APATCH"""_","_DFN_")" Q:'$D(PSBGNODE)
"RTN","PSBVDLU3",71,0)
 ..F  S PSBGNODE=$Q(@PSBGNODE) Q:PSBGNODE=""  Q:$QS(PSBGNODE,3)'=DFN  Q:PSBFLG  S PSBIEN=$QS(PSBGNODE,5),PSBFLG=$S($P(^PSB(53.79,PSBIEN,0),U,9)="G":1,1:0)
"RTN","PSBVDLU3",72,0)
 .;
"RTN","PSBVDLU3",73,0)
 .; Check AUID
"RTN","PSBVDLU3",74,0)
 .;
"RTN","PSBVDLU3",75,0)
 .D:(($G(PSBTAB)="IVTAB")!($G(PSBTAB)=""))&('PSBFLG)  Q:PSBFLG
"RTN","PSBVDLU3",76,0)
 ..S PSBGNODE="^PSB(53.79,"_"""AUID"""_","_DFN_")" Q:'$D(PSBGNODE)
"RTN","PSBVDLU3",77,0)
 ..F  S PSBGNODE=$Q(@PSBGNODE) Q:PSBGNODE=""  Q:$QS(PSBGNODE,3)'=DFN  Q:PSBFLG  S PSBIEN=$QS(PSBGNODE,6),PSBFLG=$S($P(^PSB(53.79,PSBIEN,0),U,9)="I":1,1:0)
"RTN","PSBVDLU3",78,0)
 .;
"RTN","PSBVDLU3",79,0)
 .;  NOTE: Infusing bags will not display if DCed more than 3 days ago!
"RTN","PSBVDLU3",80,0)
 .;
"RTN","PSBVDLU3",81,0)
 S:$G(^TMP("PSJ",$J,1,0))'=-1 PSBFLG=1
"RTN","PSBVDLU3",82,0)
 ;
"RTN","PSBVDLU3",83,0)
 Q PSBFLG
"RTN","PSBVDLU3",84,0)
 ;
"RTN","PSBVDLU3",85,0)
FNDACTV(RESULTS,PARAMS) ;   Utility to check and order for the latest " ? (parameter #3) " order activities per patient (parameter #1)
"RTN","PSBVDLU3",86,0)
 ; #parameter= # "^"piece
"RTN","PSBVDLU3",87,0)
 ;       #1 DFN - Patient's IEN          e.g. 1234               (required)
"RTN","PSBVDLU3",88,0)
 ;       #2 Order Number_Order Type      e.g. "1V"               "" = all orders
"RTN","PSBVDLU3",89,0)
 ;       #3 Search for Activity          e.g. "H"                "" = *unknown* activity
"RTN","PSBVDLU3",90,0)
 ;       #4 Search "back"time(hours)     e.g. 12                 "" = search back 3 admins   
"RTN","PSBVDLU3",91,0)
 ;                                                 NOTE:  ="FREQ"  This Function will use order's frequency.
"RTN","PSBVDLU3",92,0)
 ;                                                 1. If the order is a PRN, On Call or One-Time 
"RTN","PSBVDLU3",93,0)
 ;                                                 the look back a default of 72 hours.
"RTN","PSBVDLU3",94,0)
 ;                                                 2. if the order is a Continuous order key off
"RTN","PSBVDLU3",95,0)
 ;                                                 of the frequency as follows.
"RTN","PSBVDLU3",96,0)
 ;                                                      a.) if the frequency is <24 hours use the
"RTN","PSBVDLU3",97,0)
 ;                                                        default of 72 hours.
"RTN","PSBVDLU3",98,0)
 ;                                                      b.) if the frequency is >= 24 hour, look back
"RTN","PSBVDLU3",99,0)
 ;                                                        3.5 times the frequency
"RTN","PSBVDLU3",100,0)
 ;                                                 NOTE:  ["X#"    This Function will search back # of admins.
"RTN","PSBVDLU3",101,0)
 ;  
"RTN","PSBVDLU3",102,0)
 ;  Example call: D FNDACTV^PSBVDLU3(.results,"1234^1U^H^12")
"RTN","PSBVDLU3",103,0)
 ;
"RTN","PSBVDLU3",104,0)
 ;
"RTN","PSBVDLU3",105,0)
 N PSBNOW,PSBDFN,PSBON,PSBCNT,PSBACT,PSBTMFRM,PSBX,PSBSET,PSBFRQ
"RTN","PSBVDLU3",106,0)
 K RESULTS
"RTN","PSBVDLU3",107,0)
 S PSBDFN=$P(PARAMS,U),PSBON=$P(PARAMS,U,2),PSBACT=$P(PARAMS,U,3),PSBTMFRM=$P(PARAMS,U,4)
"RTN","PSBVDLU3",108,0)
 S RESULTS(0)=1
"RTN","PSBVDLU3",109,0)
 I $G(PSBDFN)']"" S RESULTS(0)=1,RESULTS(1)="-1^ERROR - MISSING PARAMETER (DFN REQ.)" Q
"RTN","PSBVDLU3",110,0)
 I $G(PSBTMFRM)="" S PSBX=3
"RTN","PSBVDLU3",111,0)
 I $G(PSBTMFRM)["X" S PSBX=+($P(PSBTMFRM,"X",2)),PSBTMFRM=""
"RTN","PSBVDLU3",112,0)
 I $G(PSBTMFRM)]"",$G(PSBTMFRM)'["FREQ" D NOW^%DTC S PSBNOW=% S PSBTMFRM=$$FMADD^XLFDT(PSBNOW,"",-1*PSBTMFRM),PSBSET=1 S RESULTS(1)="0^ None found after "_PSBTMFRM
"RTN","PSBVDLU3",113,0)
 I $G(PSBX)="" S PSBX=9999999
"RTN","PSBVDLU3",114,0)
 D:$G(PSBON)'=""
"RTN","PSBVDLU3",115,0)
 .K ^TMP("PSJ",$J) D EN^PSJBCMA1(PSBDFN,PSBON)
"RTN","PSBVDLU3",116,0)
 .;Maintain Time Frame and other order information
"RTN","PSBVDLU3",117,0)
 .I $G(PSBTMFRM)["FREQ" D
"RTN","PSBVDLU3",118,0)
 ..S PSBFRQ=+$P(^TMP("PSJ",$J,4),"^",11) I PSBFRQ=0 S PSBFRQ=1440
"RTN","PSBVDLU3",119,0)
 ..I "P^OC^O^"[($P(^TMP("PSJ",$J,4),"^")_"^") S PSBTMFRM=72 Q
"RTN","PSBVDLU3",120,0)
 ..I (PSBFRQ/60)<24 S PSBTMFRM=72 Q
"RTN","PSBVDLU3",121,0)
 ..I (PSBFRQ/60)'<24 S PSBTMFRM=(PSBFRQ/60)*3.5
"RTN","PSBVDLU3",122,0)
 .I '$G(PSBSET) D NOW^%DTC S PSBNOW=% S PSBTMFRM=$$FMADD^XLFDT(PSBNOW,"",-1*PSBTMFRM) S RESULTS(1)="0^ None found after "_PSBTMFRM
"RTN","PSBVDLU3",123,0)
 .S I="",X=0 F  S I=$O(^PSB(53.79,"AORDX",PSBDFN,PSBON,I),-1)  Q:(I="")!(I<$S(PSBTMFRM]"":PSBTMFRM,1:-1))  D  Q:X
"RTN","PSBVDLU3",124,0)
 ..S Z=0,J="",PSBCNT=0 F  S J=$O(^PSB(53.79,"AORDX",PSBDFN,PSBON,I,J),-1)  Q:(J="")  S Z=Z+1 Q:Z>PSBX  D  Q:X
"RTN","PSBVDLU3",125,0)
 ...L +^PSB(53.79,J):1
"RTN","PSBVDLU3",126,0)
 ...I  L -^PSB(53.79,J)
"RTN","PSBVDLU3",127,0)
 ...E  Q
"RTN","PSBVDLU3",128,0)
 ...I ($P(^PSB(53.79,J,0),U,9)=PSBACT) S X=1 D
"RTN","PSBVDLU3",129,0)
 ....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$$GET1^DIQ(53.79,J_",",.02)
"RTN","PSBVDLU3",130,0)
 ....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$P(^TMP("PSJ",$J,2),U,2)_"^"_($$GET1^DIQ(53.79,J_",",.11))
"RTN","PSBVDLU3",131,0)
 ....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$$GET1^DIQ(53.79,J_",",.06,"I")
"RTN","PSBVDLU3",132,0)
 ....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$$GET1^DIQ(53.79,J_",",.13,"I")
"RTN","PSBVDLU3",133,0)
 D:$G(PSBON)=""
"RTN","PSBVDLU3",134,0)
 .S Z="",X=0 F  S Z=$O(^PSB(53.79,"AORDX",PSBDFN,Z),-1)  Q:(Z="")  S PSBON=Z D  Q:X
"RTN","PSBVDLU3",135,0)
 ..;Maintain Time Frame and other order information
"RTN","PSBVDLU3",136,0)
 ..K ^TMP("PSJ",$J) D EN^PSJBCMA1(PSBDFN,PSBON)
"RTN","PSBVDLU3",137,0)
 ..I $G(PSBTMFRM)["FREQ" D
"RTN","PSBVDLU3",138,0)
 ...S PSBFRQ=+$P(^TMP("PSJ",$J,4),"^",11) I PSBFRQ=0 S PSBFRQ=1440
"RTN","PSBVDLU3",139,0)
 ...I "P^OC^O^"[($P(^TMP("PSJ",$J,4),"^")_"^") S PSBTMFRM=72 Q
"RTN","PSBVDLU3",140,0)
 ...I (PSBFRQ/60)<24 S PSBTMFRM=72 Q
"RTN","PSBVDLU3",141,0)
 ...I (PSBFRQ/60)'<24 S PSBTMFRM=(PSBFRQ/60)*3.5
"RTN","PSBVDLU3",142,0)
 ..I '$G(PSBSET) D NOW^%DTC S PSBNOW=% S PSBTMFRM=$$FMADD^XLFDT(PSBNOW,"",-1*PSBTMFRM) S RESULTS(1)="0^ None found after "_PSBTMFRM
"RTN","PSBVDLU3",143,0)
 ..S I="" F  S I=$O(^PSB(53.79,"AORDX",PSBDFN,PSBON,I),-1)  Q:(I="")!(I<$S(PSBTMFRM]"":PSBTMFRM,1:-1))  D  Q:X
"RTN","PSBVDLU3",144,0)
 ...S ZZ=0,J="",PSBCNT=0 F  S J=$O(^PSB(53.79,"AORDX",PSBDFN,PSBON,I,J),-1)  Q:(J="")  S ZZ=ZZ+1 Q:ZZ>PSBX  D  Q:X
"RTN","PSBVDLU3",145,0)
 ....L +^PSB(53.79,J):1
"RTN","PSBVDLU3",146,0)
 ....I  L -^PSB(53.79,J)
"RTN","PSBVDLU3",147,0)
 ....E  Q
"RTN","PSBVDLU3",148,0)
 ....I ($P(^PSB(53.79,J,0),U,9)=PSBACT) S X=1 D
"RTN","PSBVDLU3",149,0)
 .....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$$GET1^DIQ(53.79,J_",",.02)
"RTN","PSBVDLU3",150,0)
 .....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$P(^TMP("PSJ",$J,2),U,2)_"^"_($$GET1^DIQ(53.79,J_",",.11))
"RTN","PSBVDLU3",151,0)
 .....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$$GET1^DIQ(53.79,J_",",.06,"I")
"RTN","PSBVDLU3",152,0)
 .....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$$GET1^DIQ(53.79,J_",",.13,"I")
"RTN","PSBVDLU3",153,0)
 I $G(PSBCNT)>0 S RESULTS(0)=PSBCNT
"RTN","PSBVDLU3",154,0)
 K ^TMP("PSJ",$J)
"RTN","PSBVDLU3",155,0)
 Q
"RTN","PSBVDLU3",156,0)
 ;
"RTN","PSBVDLUD")
0^12^B75826811^B74549540
"RTN","PSBVDLUD",1,0)
PSBVDLUD ;BIRMINGHAM/EFC-BCMA UNIT DOSE VIRTUAL DUE LIST FUNCTIONS ;Mar 2004
"RTN","PSBVDLUD",2,0)
 ;;3.0;BAR CODE MED ADMIN;**11,13**;Mar 2004
"RTN","PSBVDLUD",3,0)
 ;
"RTN","PSBVDLUD",4,0)
 ; Reference/IA
"RTN","PSBVDLUD",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLUD",6,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLUD",7,0)
 ;
"RTN","PSBVDLUD",8,0)
EN(DFN,PSBDT) ;
"RTN","PSBVDLUD",9,0)
 ;
"RTN","PSBVDLUD",10,0)
 ;
"RTN","PSBVDLUD",11,0)
 ; Description:
"RTN","PSBVDLUD",12,0)
 ; Returns the current unit dose order set for today to display
"RTN","PSBVDLUD",13,0)
 ; on the client VDL
"RTN","PSBVDLUD",14,0)
 ;
"RTN","PSBVDLUD",15,0)
 N PSBDATA,PSBTBOUT
"RTN","PSBVDLUD",16,0)
 S PSBTBOUT=0
"RTN","PSBVDLUD",17,0)
 ;
"RTN","PSBVDLUD",18,0)
 ;This routine now re-uses the ^TMP("PSJ",$J global built in PSBVDLTB
"RTN","PSBVDLUD",19,0)
 ;
"RTN","PSBVDLUD",20,0)
 G:$G(^TMP("PSJ",$J,1,0))=-1 1
"RTN","PSBVDLUD",21,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBVDLUD",22,0)
 .S:(PSBTAB'="UDTAB")&($G(^TMP("PSB",$J,"UDTAB",2))>0) PSBTBOUT=1
"RTN","PSBVDLUD",23,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX)
"RTN","PSBVDLUD",24,0)
 .;
"RTN","PSBVDLUD",25,0)
 .; << Standard checks for ALL orders >>
"RTN","PSBVDLUD",26,0)
 .;
"RTN","PSBVDLUD",27,0)
 .Q:PSBONX["V"  ;No IVs on UD tab
"RTN","PSBVDLUD",28,0)
 .Q:PSBONX["P"  ;     No Pending Orders
"RTN","PSBVDLUD",29,0)
 .Q:PSBOST>PSBWADM  ; Order Start Date/Time > admin window
"RTN","PSBVDLUD",30,0)
 .Q:PSBOSP<PSBWBEG  ; For Non one-times Order Stop Date/Time < vdl window
"RTN","PSBVDLUD",31,0)
 .Q:PSBOSTS["D"  ;     Is it DC'd
"RTN","PSBVDLUD",32,0)
 .Q:PSBNGF  ;         Is it marked DO NOT GIVE!
"RTN","PSBVDLUD",33,0)
 .Q:PSBMR="IVP"!(PSBMR="IV PUSH")
"RTN","PSBVDLUD",34,0)
 .;
"RTN","PSBVDLUD",35,0)
 .; Non One-Times with stop date/time < now
"RTN","PSBVDLUD",36,0)
 .;
"RTN","PSBVDLUD",37,0)
 .D NOW^%DTC
"RTN","PSBVDLUD",38,0)
 .Q:PSBOSP<%
"RTN","PSBVDLUD",39,0)
 .;
"RTN","PSBVDLUD",40,0)
 .; include Active, Renewed, ReInstated and On Call
"RTN","PSBVDLUD",41,0)
 .; (Is it not one time)&(Is it not active or renewed or On Call)
"RTN","PSBVDLUD",42,0)
 .I PSBSCHT'="O",PSBOSTS'="A",PSBOSTS'="H",PSBOSTS'="R",PSBOSTS'="RE",PSBOSTS'="O" Q
"RTN","PSBVDLUD",43,0)
 .;
"RTN","PSBVDLUD",44,0)
 .; Is One Time Given
"RTN","PSBVDLUD",45,0)
 .;
"RTN","PSBVDLUD",46,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBVDLUD",47,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLUD",48,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLUD",49,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLUD",50,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLUD",51,0)
 .;
"RTN","PSBVDLUD",52,0)
 .; How long does One Time remain on VDL ??
"RTN","PSBVDLUD",53,0)
 .S PSBRMN=1
"RTN","PSBVDLUD",54,0)
 .I PSBSCHT="O",PSBOSP'=PSBOST&(%>PSBOSP) S PSBRMN=0
"RTN","PSBVDLUD",55,0)
 .Q:'PSBRMN
"RTN","PSBVDLUD",56,0)
 .; Is On-Call Given, Can it be given more than once
"RTN","PSBVDLUD",57,0)
 .;
"RTN","PSBVDLUD",58,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBVDLUD",59,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLUD",60,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLUD",61,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLUD",62,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLUD",63,0)
 .;
"RTN","PSBVDLUD",64,0)
 .S PSBREC=""
"RTN","PSBVDLUD",65,0)
 .S $P(PSBREC,U,1)=DFN ; dfn
"RTN","PSBVDLUD",66,0)
 .S $P(PSBREC,U,2)=PSBONX ; order
"RTN","PSBVDLUD",67,0)
 .S $P(PSBREC,U,3)=PSBON ; order ien
"RTN","PSBVDLUD",68,0)
 .S $P(PSBREC,U,4)=PSBOTYP ; iv/ud/pending
"RTN","PSBVDLUD",69,0)
 .S $P(PSBREC,U,5)=PSBSCHT ; schedule type
"RTN","PSBVDLUD",70,0)
 .S $P(PSBREC,U,6)=PSBSCH ; schedule
"RTN","PSBVDLUD",71,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"") ; self med
"RTN","PSBVDLUD",72,0)
 .S $P(PSBREC,U,8)=PSBOITX ; drugname
"RTN","PSBVDLUD",73,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ; dosage
"RTN","PSBVDLUD",74,0)
 .S $P(PSBREC,U,10)=PSBMR ; route
"RTN","PSBVDLUD",75,0)
 .; Last Given from the AOIP X-Ref - not given status not excepted
"RTN","PSBVDLUD",76,0)
 .S (PSBCNT,PSBFLAG)=0,(YZ,PSBSTUS,PSBADMER)="" K PSBHSTA,PSBHSTAX
"RTN","PSBVDLUD",77,0)
 .F XZ=1:1:20 S YZ=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ),-1),(PSBCNT,PSBFLAG)=0 Q:YZ=""  D
"RTN","PSBVDLUD",78,0)
 ..S:YZ>0 $P(PSBREC,U,11)=YZ
"RTN","PSBVDLUD",79,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ,X),-1) Q:X=""  D
"RTN","PSBVDLUD",80,0)
 ...K PSBLCK L +^PSB(53.79,X):1  I  L -^PSB(53.79,X) S PSBLCK=1
"RTN","PSBVDLUD",81,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLUD",82,0)
 ...I $G(PSBSTUS)="" S:'$G(PSBLCK) PSBSTUS="X" I $G(PSBLCK) S PSBADMER=1 D
"RTN","PSBVDLUD",83,0)
 ....K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLUD",84,0)
 ....S PSBPARM6=X,Y=$P(^PSB(53.79,X,.1),U,3) D DD^%DT S PSBPARM3=Y,Y=$P(^PSB(53.79,X,0),U,6) D DD^%DT S PSBPARM5=Y
"RTN","PSBVDLUD",85,0)
 ....S PSBPARM7=$P(^PSB(53.79,X,0),U,7) S PSBPARM7="( # "_PSBPARM7_" ) "_$$GET1^DIQ(200,PSBPARM7_",",.01)
"RTN","PSBVDLUD",86,0)
 ....K PSBXTMP S PSBXTMP=PSBONX
"RTN","PSBVDLUD",87,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$$GET1^DIQ(53.79,PSBPARM6_",",.11))
"RTN","PSBVDLUD",88,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,PSBPARM3_" admin's ACTION STATUS is ""UNKNOWN"".",PSBSCH,PSBPARM5,PSBPARM6,PSBPARM7) ;  SEND AN E-MAIL
"RTN","PSBVDLUD",89,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBXTMP)  ;Reset Variables
"RTN","PSBVDLUD",90,0)
 ....S X=PSBPARM6 K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLUD",91,0)
 ...K PSBLCK S:(PSBSTUS']"") PSBSTUS="U"  I PSBSTUS'="N",($G(PSBSTUS)'="X") S PSBFLAG=1,PSBHSTA(YZ,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBVDLUD",92,0)
 ...D:PSBSTUS="N"
"RTN","PSBVDLUD",93,0)
 ....S $P(PSBREC,U,11)=""
"RTN","PSBVDLUD",94,0)
 ....S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBVDLUD",95,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLUD",96,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLUD",97,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBVDLUD",98,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBVDLUD",99,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBVDLUD",100,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBVDLUD",101,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBVDLUD",102,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBVDLUD",103,0)
 .S $P(PSBREC,U,12)=""  ;med log ien inserted below for actual date
"RTN","PSBVDLUD",104,0)
 .S $P(PSBREC,U,13)=""  ;med log status inserted below for actual date
"RTN","PSBVDLUD",105,0)
 .S $P(PSBREC,U,14)="" ; admin date inserted below
"RTN","PSBVDLUD",106,0)
 .S $P(PSBREC,U,15)=PSBOIT ; OI Pointer
"RTN","PSBVDLUD",107,0)
 .S $P(PSBREC,U,16)=0  ; Default to not injectable
"RTN","PSBVDLUD",108,0)
 .F X="ID","IV","IM","SC","SQ" D  Q:$P(PSBREC,U,16)
"RTN","PSBVDLUD",109,0)
 ..I PSBMR?@(".E1"""_X_""".E"),PSBMR'["MISC" S $P(PSBREC,U,16)=1
"RTN","PSBVDLUD",110,0)
 .; Variable dosage entered as ####-####?
"RTN","PSBVDLUD",111,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLUD",112,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLUD",113,0)
 .S:PSBDOSEF?1"CAP".E!(PSBDOSEF?1"TAB".E)!(PSBDOSEF="PATCH") $P(PSBREC,U,18)=PSBDOSEF ; dosage form
"RTN","PSBVDLUD",114,0)
 .S $P(PSBREC,U,20)=$S((PSBSTUS="X")!(PSBSTUS="N"):"",1:PSBSTUS) ; last action status
"RTN","PSBVDLUD",115,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLUD",116,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLUD",117,0)
 .;
"RTN","PSBVDLUD",118,0)
 .; Gather Dispense Drugs
"RTN","PSBVDLUD",119,0)
 .D NOW^%DTC
"RTN","PSBVDLUD",120,0)
 .S (PSBDDS,PSBSOLS,PSBADDS,PSBFLAG)="0"
"RTN","PSBVDLUD",121,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBVDLUD",122,0)
 ..I $P(PSBDDA(Y),U,5)=$P(%,".") S PSBFLAG=1 ;If drug was inactivated
"RTN","PSBVDLUD",123,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<%)  ; Inactive
"RTN","PSBVDLUD",124,0)
 ..S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1
"RTN","PSBVDLUD",125,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4)
"RTN","PSBVDLUD",126,0)
 ..S $P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLUD",127,0)
 .;
"RTN","PSBVDLUD",128,0)
 .; On-Call One Time PRN orders
"RTN","PSBVDLUD",129,0)
 .S PSBQRR=0
"RTN","PSBVDLUD",130,0)
 .I "^O^OC^P^"[(U_PSBSCHT_U) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1,PSBDDS,PSBSOLS,PSBADDS,"UDTAB") Q
"RTN","PSBVDLUD",131,0)
 .;
"RTN","PSBVDLUD",132,0)
 .; Now we deal with only continuous
"RTN","PSBVDLUD",133,0)
 .; process admintimes
"RTN","PSBVDLUD",134,0)
 .; Display an order on the VDL based on the frequency received from IPM **PSB*2.0*3
"RTN","PSBVDLUD",135,0)
 .S (PSBYES,PSBODD,PSBYTF)=0
"RTN","PSBVDLUD",136,0)
 .I PSBSCH="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"No Schedule on this order")
"RTN","PSBVDLUD",137,0)
 .S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBVDLUD",138,0)
 .I PSBYES,PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLUD",139,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBVDLUD",140,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLUD",141,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBVDLUD",142,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBVDLUD",143,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBVDLUD",144,0)
 .I 'PSBYES,PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBVDLUD",145,0)
 .I (PSBADST="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1("UDTAB") Q  ;calculate admin times based on frequency
"RTN","PSBVDLUD",146,0)
 .; No admin times, MAYDAY MAYDAY!!
"RTN","PSBVDLUD",147,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBVDLUD",148,0)
 .I PSBODD,PSBADST'="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH) Q
"RTN","PSBVDLUD",149,0)
 .; process admin times against beginning and ending date
"RTN","PSBVDLUD",150,0)
 .; build all orders for both days.
"RTN","PSBVDLUD",151,0)
 .F PSBY=1:1 Q:$P(PSBADST,"-",PSBY)=""  D
"RTN","PSBVDLUD",152,0)
 ..;For invalid admin times
"RTN","PSBVDLUD",153,0)
 ..I ($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N) D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBVDLUD",154,0)
 ..; apply this time to the beginning window date
"RTN","PSBVDLUD",155,0)
 ..S PSB=+(PSBWBEG\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBVDLUD",156,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLUD",157,0)
 ...D:(PSB'<PSBOST)&(PSB<PSBOSP)  ; Make sure this time is active
"RTN","PSBVDLUD",158,0)
 ....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLUD",159,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"UDTAB")
"RTN","PSBVDLUD",160,0)
 ..;
"RTN","PSBVDLUD",161,0)
 ..Q:(PSBWBEG\1)=(PSBWEND\1)  ; Window only has one day rare but possible
"RTN","PSBVDLUD",162,0)
 ..;
"RTN","PSBVDLUD",163,0)
 ..; apply this time to the ending window date
"RTN","PSBVDLUD",164,0)
 ..S PSB=+(PSBWEND\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBVDLUD",165,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLUD",166,0)
 ...D:(PSB'<PSBOST)&(PSB<PSBOSP)  ; Make sure this time is active
"RTN","PSBVDLUD",167,0)
 ....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLUD",168,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"UDTAB")
"RTN","PSBVDLUD",169,0)
 .K PSBSTUS
"RTN","PSBVDLUD",170,0)
1 K PSBREC D EN^PSBVDLPA
"RTN","PSBVDLUD",171,0)
 ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLUD",172,0)
 D:PSBTAB="UDTAB" VNURSE^PSBVDLU1("UDTAB")
"RTN","PSBVDLUD",173,0)
 D CLEAN^PSBVT
"RTN","PSBVDLUD",174,0)
 Q
"RTN","PSBVDLUD",175,0)
 ;
"RTN","PSBVDLVL")
0^13^B60130860^B58456162
"RTN","PSBVDLVL",1,0)
PSBVDLVL ;BIRMINGHAM/EFC-BCMA VIRTUAL DUE LIST FUNCTIONS ;Mar 2004
"RTN","PSBVDLVL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,12,11,13**;Mar 2004
"RTN","PSBVDLVL",3,0)
 ;
"RTN","PSBVDLVL",4,0)
EN(RESULTS,DFN,PSBXOR,PSBTYPE,PSBADMIN,PSBTAB,PSBUID,PSBASTS,PSBORSTS,PSBRMV) ;
"RTN","PSBVDLVL",5,0)
 ;
"RTN","PSBVDLVL",6,0)
 ; RPC: PSB VALIDATE ORDER
"RTN","PSBVDLVL",7,0)
 ;
"RTN","PSBVDLVL",8,0)
 ; Description: Final check of order against an actual administration
"RTN","PSBVDLVL",9,0)
 ;              date/time used immediately after scanned med has been
"RTN","PSBVDLVL",10,0)
 ;              validated to be a good un-administered order.
"RTN","PSBVDLVL",11,0)
 ;
"RTN","PSBVDLVL",12,0)
 K PSBTST
"RTN","PSBVDLVL",13,0)
 N PSBFLAG
"RTN","PSBVDLVL",14,0)
 I PSBRMV="I" D GETOHIST^PSBRPC2(.PSBTST,DFN,PSBXOR_PSBTYPE) S I=0 F  S I=$O(PSBTST(I)) Q:I=""  I $P(PSBTST(I),U,5)="I" S RESULTS(0)=1,RESULTS(1)="-2^" K PSBTST Q
"RTN","PSBVDLVL",15,0)
 K PSBOKAY D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBXOR_PSBTYPE) S PSB=0
"RTN","PSBVDLVL",16,0)
 S RESULTS(0)=1,RESULTS(1)="-1^***Unable to determine administration" ; Default Flag will be overwritten by anything
"RTN","PSBVDLVL",17,0)
 D NOW^%DTC
"RTN","PSBVDLVL",18,0)
 I ((PSBOSTS="A")!(PSBOSTS="R"))&(PSBOSP<%) S PSBOSTS="E"
"RTN","PSBVDLVL",19,0)
 I PSBORSTS'=PSBOSTS,((PSBSCHT'="O")&(PSBOSTS'="E")) S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="-2^ORDER STATUS MISMATCH" Q
"RTN","PSBVDLVL",20,0)
 I ((PSBTAB="UDTAB")!(PSBTAB="PBTAB")),((PSBRMV="RM")!(PSBRMV="N")) D  Q
"RTN","PSBVDLVL",21,0)
 .S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="0^OKAY TO REMOVE"  ; patch removal does not follow rest of validte rules
"RTN","PSBVDLVL",22,0)
 .I PSBASTS="" Q  ;status is not given - don't check for missmatch
"RTN","PSBVDLVL",23,0)
 .I $D(^PSB(53.79,"AORD",DFN,PSBXOR_PSBTYPE,+PSBADMIN)) S X=$O(^PSB(53.79,"AORD",DFN,PSBXOR_PSBTYPE,+PSBADMIN,"")) I $P($G(^PSB(53.79,+X,0)),U,9)'=PSBASTS  S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="-2^Admin status mismatch"
"RTN","PSBVDLVL",24,0)
 I PSBTYPE="V",PSBSCHT'="P",((PSBUID="")!(PSBUID["WS")) S RESULTS(0)=1,RESULTS(1)="0^Okay to administer" Q:PSBTAB="IVTAB"
"RTN","PSBVDLVL",25,0)
 I PSBTYPE="V",PSBUID'="" D  Q:PSBTAB="IVTAB"  ; validate IV bags Piggybacks have additional tests
"RTN","PSBVDLVL",26,0)
 .S PSB=0,PSBSUID=PSBUID D EN^PSBPOIV(DFN,PSBXOR_PSBTYPE)
"RTN","PSBVDLVL",27,0)
 .S X="" F  S X=$O(^TMP("PSBAR",$J,X)) Q:X=""  D
"RTN","PSBVDLVL",28,0)
 ..I PSBSUID'=X Q
"RTN","PSBVDLVL",29,0)
 ..S PSBUIDS=^TMP("PSBAR",$J,X)
"RTN","PSBVDLVL",30,0)
 ..I $P(PSBUIDS,U,2)="I"!($P(PSBUIDS,U,2)="S") S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="0^Okay to administer" Q  ; is infusing or stopped
"RTN","PSBVDLVL",31,0)
 ..I $P(PSBUIDS,U,1)="I" S Y=$P(^TMP("PSBAR",$J,"I"),U,2) D DD^%DT S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)=$P(^TMP("PSBAR",$J,"I"),U,3,99)_"  "_Y Q
"RTN","PSBVDLVL",32,0)
 ..I $P(PSBUIDS,U,1)["W" S PSBWS=$P(PSBUIDS,U,1) F PSBWM=2:1 Q:$P(PSBWS,";",PSBWM)=""  D
"RTN","PSBVDLVL",33,0)
 ...S Y=$P(^TMP("PSBAR",$J,"W",$P(PSBWS,";",PSBWM)),U,2) D DD^%DT S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)=$P(^TMP("PSBAR",$J,"W",$P(PSBWS,";",PSBWM)),U,3,99)_" "_Y
"RTN","PSBVDLVL",34,0)
 ..S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="0^Okay to administer"
"RTN","PSBVDLVL",35,0)
 .K ^TMP("PSBAR",$J)
"RTN","PSBVDLVL",36,0)
 ;
"RTN","PSBVDLVL",37,0)
 ; no IV orders
"RTN","PSBVDLVL",38,0)
 ;
"RTN","PSBVDLVL",39,0)
 D NOW^%DTC
"RTN","PSBVDLVL",40,0)
 I PSBOSTS="H" S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="0^Order is on Provider Hold" Q
"RTN","PSBVDLVL",41,0)
 I PSBSCHT'="O"&(%<($$FMADD^XLFDT(PSBOST,"","",$$GET^XPAR("ALL","PSB ADMIN BEFORE")*-1))) S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="-1^Order Not Active" Q
"RTN","PSBVDLVL",42,0)
 I PSBSCHT'="O"&(%>PSBOSP) S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="-1^Order Not Active" Q
"RTN","PSBVDLVL",43,0)
 I (PSBSCHT="C")!((PSBSCHT="P")&(PSBDOSEF="PATCH")) D
"RTN","PSBVDLVL",44,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",45,0)
 .I PSBASTS["*UNKNOWN*" S PSBOKAY="-1^This administration has *UNKNOWN* status" Q
"RTN","PSBVDLVL",46,0)
 .I PSBOSTS'="A",PSBOSTS'="R",PSBOSTS'="O" S PSBOKAY="-1^Order Not Active" Q
"RTN","PSBVDLVL",47,0)
 .I PSBNGF S PSBOKAY="-1^marked DO NOT GIVE" Q
"RTN","PSBVDLVL",48,0)
 .S PSBFLAG=0 I PSBRMV="M"!(PSBRMV="H")!(PSBRMV="R") S PSBFLAG=1
"RTN","PSBVDLVL",49,0)
 .I $D(^PSB(53.79,"AORDX",DFN,PSBXOR_PSBTYPE)) D  Q:X
"RTN","PSBVDLVL",50,0)
 ..S X=0,PSBLADT=$O(^PSB(53.79,"AORDX",DFN,PSBXOR_PSBTYPE,""),-1),PSBLAIEN=$O(^PSB(53.79,"AORDX",DFN,PSBXOR_PSBTYPE,PSBLADT,""),-1)
"RTN","PSBVDLVL",51,0)
 ..I $P($G(^PSB(53.79,PSBLAIEN,0)),U,9)="G",$P($G(^PSB(53.79,PSBLAIEN,.5,1,0)),U,4)="PATCH",PSBFLAG=0 S X=1,PSBOKAY="-1^Previous patch has not been removed" Q
"RTN","PSBVDLVL",52,0)
 .I $D(^PSB(53.79,"AORD",DFN,PSBXOR_PSBTYPE,+PSBADMIN)) D  Q:+PSBOKAY<0
"RTN","PSBVDLVL",53,0)
 ..S X=$O(^PSB(53.79,"AORD",DFN,PSBXOR_PSBTYPE,+PSBADMIN,""))
"RTN","PSBVDLVL",54,0)
 ..L +^PSB(53.79,+X):1
"RTN","PSBVDLVL",55,0)
 ..I  L -^PSB(53.79,+X)
"RTN","PSBVDLVL",56,0)
 ..E  S PSBOKAY="-1^The "_$$GET1^DIQ(53.79,+X_",",.13)_" administration is being edited by another" Q
"RTN","PSBVDLVL",57,0)
 ..I $G(PSBASTS)]"" D  Q:+PSBOKAY<0
"RTN","PSBVDLVL",58,0)
 ...I $P($G(^PSB(53.79,+X,0)),U,9)="" Q
"RTN","PSBVDLVL",59,0)
 ...I $P($G(^PSB(53.79,+X,0)),U,9)'=PSBASTS S PSBOKAY="-2^Admin status mismatch" Q
"RTN","PSBVDLVL",60,0)
 .; Minutes before
"RTN","PSBVDLVL",61,0)
 .S PSBWIN1=$$GET^XPAR("DIV","PSB ADMIN BEFORE")*-1
"RTN","PSBVDLVL",62,0)
 .; Minutes After
"RTN","PSBVDLVL",63,0)
 .S PSBWIN2=$$GET^XPAR("DIV","PSB ADMIN AFTER")
"RTN","PSBVDLVL",64,0)
 .D NOW^%DTC S PSBMIN=$$DIFF^PSBUTL(PSBADMIN,%)
"RTN","PSBVDLVL",65,0)
 .; PENDING A PC SOLUTION!
"RTN","PSBVDLVL",66,0)
 .I PSBMIN<PSBWIN1 S PSBOKAY="1^Admin is "_(PSBMIN*-1)_" minutes before the scheduled administration time" Q
"RTN","PSBVDLVL",67,0)
 .I PSBMIN>PSBWIN2 S PSBOKAY="1^Admin is "_(PSBMIN)_" minutes after the scheduled administration time" Q
"RTN","PSBVDLVL",68,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",69,0)
 ; Validate a PRN Order
"RTN","PSBVDLVL",70,0)
 D:(PSBSCHT="P")
"RTN","PSBVDLVL",71,0)
 .I PSBOSTS'="A",PSBOSTS'="R",PSBOSTS'="O" S PSBOKAY="-1^Order Not Active" Q
"RTN","PSBVDLVL",72,0)
 .I PSBNGF S PSBOKAY="-1^marked DO NOT GIVE" Q
"RTN","PSBVDLVL",73,0)
 .I (+($G(PSBOKAY))<0)&(PSBDOSEF="PATCH") Q  ;A Patch may have to be removed.
"RTN","PSBVDLVL",74,0)
 .S PSBOKAY="1^"
"RTN","PSBVDLVL",75,0)
 .; Get Last Four Givens
"RTN","PSBVDLVL",76,0)
 .S PSBDT=""
"RTN","PSBVDLVL",77,0)
 .F  S PSBDT=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,PSBDT),-1) Q:PSBDT=""  D
"RTN","PSBVDLVL",78,0)
 ..S PSBDA=""
"RTN","PSBVDLVL",79,0)
 ..F  S PSBDA=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,PSBDT,PSBDA),-1) Q:'PSBDA  D
"RTN","PSBVDLVL",80,0)
 ...S (PSBCNT1,PSBCNT2,PSBCNT3)=0
"RTN","PSBVDLVL",81,0)
 ...S PSBLADT=$$GET1^DIQ(53.79,PSBDA_",",.06,"I")
"RTN","PSBVDLVL",82,0)
 ...S PSBSTUS=$$GET1^DIQ(53.79,PSBDA_",",.09)
"RTN","PSBVDLVL",83,0)
 ...S:PSBSTUS="" PSBSTUS="U"
"RTN","PSBVDLVL",84,0)
 ...S PSBSCH=$$GET1^DIQ(53.79,PSBDA_",",.12)
"RTN","PSBVDLVL",85,0)
 ...S PSBRSN=$$GET1^DIQ(53.79,PSBDA_",",.21)
"RTN","PSBVDLVL",86,0)
 ...S PSBINJ=$$GET1^DIQ(53.79,PSBDA_",",.16)
"RTN","PSBVDLVL",87,0)
 ...Q:$P(^PSB(53.79,PSBDA,0),U,9)="N"
"RTN","PSBVDLVL",88,0)
 ...F PSBZ=.5,.6,.7 F PSBY=0:0 S PSBY=$O(^PSB(53.79,PSBDA,PSBZ,PSBY)) Q:'PSBY  D
"RTN","PSBVDLVL",89,0)
 ....Q:'$D(^PSB(53.79,PSBDA,PSBZ,PSBY))
"RTN","PSBVDLVL",90,0)
 ....S PSBDD=$S(PSBZ=.5:53.795,PSBZ=.6:53.796,1:53.797)
"RTN","PSBVDLVL",91,0)
 ....S PSBUNIT=$$GET1^DIQ(PSBDD,PSBY_","_PSBDA_",",.03)
"RTN","PSBVDLVL",92,0)
 ....S PSBUNFR=$$GET1^DIQ(PSBDD,PSBY_","_PSBDA_",",.04)
"RTN","PSBVDLVL",93,0)
 ....I PSBZ=.5 S PSBCNT1=PSBCNT1+1
"RTN","PSBVDLVL",94,0)
 ....I PSBZ=.6 S PSBCNT2=PSBCNT2+1
"RTN","PSBVDLVL",95,0)
 ....I PSBZ=.7 S PSBCNT3=PSBCNT3+1
"RTN","PSBVDLVL",96,0)
 ...;Units given or free text not to display for multiple dispense drugs or additives and solution
"RTN","PSBVDLVL",97,0)
 ...I (PSBCNT1>1)!(PSBCNT2>0)!(PSBCNT3>0) S (PSBUNIT,PSBUNFR)=""
"RTN","PSBVDLVL",98,0)
 ...S X=PSBLADT_U
"RTN","PSBVDLVL",99,0)
 ...S X=X_PSBSTUS_U_PSBSCH_U_$G(PSBRSN)_U_$G(PSBINJ)_U_$G(PSBUNIT)_U_$G(PSBUNFR)
"RTN","PSBVDLVL",100,0)
 ...S PSBOKAY($O(PSBOKAY(""),-1)+1)=3_U_X
"RTN","PSBVDLVL",101,0)
 ...S:$D(PSBOKAY(4)) PSBDT=0
"RTN","PSBVDLVL",102,0)
 ; Validate a One-Time Order
"RTN","PSBVDLVL",103,0)
 D:PSBSCHT="O"
"RTN","PSBVDLVL",104,0)
 .S (PSBGVN,X,Y)=""
"RTN","PSBVDLVL",105,0)
 .F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1)  Q:'X  F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  I $P(^PSB(53.79,Y,.1),U)=PSBONX,"G"[$P(^PSB(53.79,Y,0),U,9) S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLVL",106,0)
 .I PSBGVN S PSBOKAY="-1^Dose Already on medication Log" Q
"RTN","PSBVDLVL",107,0)
 .; One Time are automatically expired so we don't check STATUS here
"RTN","PSBVDLVL",108,0)
 .I PSBNGF S PSBOKAY="-1^marked DO NOT GIVE" Q
"RTN","PSBVDLVL",109,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",110,0)
 ; Validate an On Call Order
"RTN","PSBVDLVL",111,0)
 D:PSBSCHT="OC"
"RTN","PSBVDLVL",112,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",113,0)
 .S (PSBGVN,X,Y)=""
"RTN","PSBVDLVL",114,0)
 .F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1)  Q:'X  F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  I $P(^PSB(53.79,Y,.1),U)=PSBONX,"G"[$P(^PSB(53.79,Y,0),U,9) S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLVL",115,0)
 .I PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL")) S PSBOKAY="-1^Dose Already on medication Log" Q
"RTN","PSBVDLVL",116,0)
 .I PSBOSTS'="A",PSBOSTS'="R",PSBOSTS'="O" S PSBOKAY="-1^Order Not Active" Q
"RTN","PSBVDLVL",117,0)
 .I PSBNGF S PSBOKAY="-1^marked DO NOT GIVE" Q
"RTN","PSBVDLVL",118,0)
 .I PSBGVN&($$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))&(PSBDOSEF="PATCH") S PSBOKAY="-1^Previous patch has not been removed" Q
"RTN","PSBVDLVL",119,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",120,0)
 ;
"RTN","PSBVDLVL",121,0)
 D:+PSBOKAY'<0
"RTN","PSBVDLVL",122,0)
 .N PSBDIFF,Y
"RTN","PSBVDLVL",123,0)
 .D:(PSBSCHT="C")!(PSBSCHT="OC"&('$G(PSBGVN)))
"RTN","PSBVDLVL",124,0)
 ..; On-call or cont and not on the log.
"RTN","PSBVDLVL",125,0)
 ..S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,""),-1)
"RTN","PSBVDLVL",126,0)
 ..;Check for the status of the medication and insert status in the text
"RTN","PSBVDLVL",127,0)
 ..I Y]"" S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,Y,""),-1),PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLVL",128,0)
 ..S:Y']"" PSBSTUS=""
"RTN","PSBVDLVL",129,0)
 ..I PSBSTUS="N" D  Q:$G(PSBQUIT)
"RTN","PSBVDLVL",130,0)
 ...S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,Y,X),-1)
"RTN","PSBVDLVL",131,0)
 ...D:X']""
"RTN","PSBVDLVL",132,0)
 ....S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,Y),-1) I Y']"" S PSBQUIT=1 Q
"RTN","PSBVDLVL",133,0)
 ....S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,Y,""),-1),PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLVL",134,0)
 ..S PSBDIFF=$$FMDIFF^XLFDT($$NOW^XLFDT(),Y,2)
"RTN","PSBVDLVL",135,0)
 ..Q:PSBDIFF>7200  ; Greater than 2 hours
"RTN","PSBVDLVL",136,0)
 ..I (PSBSTUS="G")!(PSBSTUS="H")!(PSBSTUS="R")!(PSBSTUS="RM") D
"RTN","PSBVDLVL",137,0)
 ...S PSBSTUS=$$GET1^DIQ(53.79,X_",",.09)
"RTN","PSBVDLVL",138,0)
 ...I PSBSTUS'="" D
"RTN","PSBVDLVL",139,0)
 ....S Y="1^*** NOTICE, "_PSBOITX_" was "_PSBSTUS_" "_(PSBDIFF\60)_" minutes ago."
"RTN","PSBVDLVL",140,0)
 ....I +PSBOKAY=1 S PSBOKAY(1)=Y
"RTN","PSBVDLVL",141,0)
 ....E  S PSBOKAY=Y
"RTN","PSBVDLVL",142,0)
 ;
"RTN","PSBVDLVL",143,0)
 S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)=PSBOKAY
"RTN","PSBVDLVL",144,0)
 F X=1:1 Q:'$D(PSBOKAY(X))  S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)=PSBOKAY(X)
"RTN","PSBVDLVL",145,0)
 Q
"RTN","PSBVDLVL",146,0)
 ;
"VER")
8.0^22.0
"^DD",53.69,53.69,.05,0)
TYPE OF REQUEST^F^^0;5^K:$L(X)>2!($L(X)<2)!'(X'?1P.E) X
"^DD",53.69,53.69,.05,.1)
Type of Request
"^DD",53.69,53.69,.05,3)
Answer must be 2 characters in length
"^DD",53.69,53.69,.05,21,0)
^^20^20^3051223^
"^DD",53.69,53.69,.05,21,1,0)
Automatically stuffed at record creation with the type of report that is
"^DD",53.69,53.69,.05,21,2,0)
being requested.  Used to drive the report later on by appending the
"^DD",53.69,53.69,.05,21,3,0)
internal code to "DQ^PSBO"_type for the routine reference to run.  (i.e.
"^DD",53.69,53.69,.05,21,4,0)
ML for med log would call DQ^PSBOML to generate the report.) 
"^DD",53.69,53.69,.05,21,5,0)
Report types DL = Due List
"^DD",53.69,53.69,.05,21,6,0)
             MH = Medication Admin History (MAH)
"^DD",53.69,53.69,.05,21,7,0)
             ML = Med Log
"^DD",53.69,53.69,.05,21,8,0)
             MM = Missed Medications
"^DD",53.69,53.69,.05,21,9,0)
             PE = PRN Effectiveness List
"^DD",53.69,53.69,.05,21,10,0)
             PM = Patient Medication History
"^DD",53.69,53.69,.05,21,11,0)
             WA = Ward Administration Times
"^DD",53.69,53.69,.05,21,12,0)
             MV = Medication Variance Log
"^DD",53.69,53.69,.05,21,13,0)
             BL = Bar Code Label
"^DD",53.69,53.69,.05,21,14,0)
             MD = Missing Dose Follow-up
"^DD",53.69,53.69,.05,21,15,0)
             AL = Allergy Report
"^DD",53.69,53.69,.05,21,16,0)
             PI = Patient Inquiry
"^DD",53.69,53.69,.05,21,17,0)
             DO = Display Order
"^DD",53.69,53.69,.05,21,18,0)
             VT = Vitals Cumulative
"^DD",53.69,53.69,.05,21,19,0)
             PF = Patient Record Flag
"^DD",53.69,53.69,.05,21,20,0)
             XA = Unknown Action Status Report
"^DD",53.69,53.69,.05,"DT")
3051223
"BLD",5479,6)
^21
**END**
**END**
