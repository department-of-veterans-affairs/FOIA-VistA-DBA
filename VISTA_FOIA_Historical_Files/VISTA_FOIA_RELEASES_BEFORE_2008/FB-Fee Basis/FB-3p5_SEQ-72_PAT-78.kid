Released FB*3.5*78 SEQ #72
Extracted from mail message
**KIDS**:FB*3.5*78^

**INSTALL NAME**
FB*3.5*78
"BLD",5501,0)
FB*3.5*78^FEE BASIS^0^3040422^y
"BLD",5501,1,0)
^^4^4^3040414^
"BLD",5501,1,1,0)
Fee Basis Encapsulation API enhancement.
"BLD",5501,1,2,0)
 Add API $$RXSUM^FBRXUTL()
"BLD",5501,1,3,0)
 Add API $$AUTHL^FBUTL()
"BLD",5501,1,4,0)
 Modify API EN^FBHLZFE()
"BLD",5501,4,0)
^9.64PA^^
"BLD",5501,"KRN",0)
^9.67PA^8989.52^19
"BLD",5501,"KRN",.4,0)
.4
"BLD",5501,"KRN",.401,0)
.401
"BLD",5501,"KRN",.402,0)
.402
"BLD",5501,"KRN",.403,0)
.403
"BLD",5501,"KRN",.5,0)
.5
"BLD",5501,"KRN",.84,0)
.84
"BLD",5501,"KRN",3.6,0)
3.6
"BLD",5501,"KRN",3.8,0)
3.8
"BLD",5501,"KRN",9.2,0)
9.2
"BLD",5501,"KRN",9.8,0)
9.8
"BLD",5501,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5501,"KRN",9.8,"NM",1,0)
FBHLZFE^^0^B16274342
"BLD",5501,"KRN",9.8,"NM",2,0)
FBRXUTL^^0^B6847438
"BLD",5501,"KRN",9.8,"NM",3,0)
FBUTL^^0^B16565072
"BLD",5501,"KRN",9.8,"NM","B","FBHLZFE",1)

"BLD",5501,"KRN",9.8,"NM","B","FBRXUTL",2)

"BLD",5501,"KRN",9.8,"NM","B","FBUTL",3)

"BLD",5501,"KRN",19,0)
19
"BLD",5501,"KRN",19.1,0)
19.1
"BLD",5501,"KRN",101,0)
101
"BLD",5501,"KRN",409.61,0)
409.61
"BLD",5501,"KRN",771,0)
771
"BLD",5501,"KRN",870,0)
870
"BLD",5501,"KRN",8989.51,0)
8989.51
"BLD",5501,"KRN",8989.52,0)
8989.52
"BLD",5501,"KRN",8994,0)
8994
"BLD",5501,"KRN","B",.4,.4)

"BLD",5501,"KRN","B",.401,.401)

"BLD",5501,"KRN","B",.402,.402)

"BLD",5501,"KRN","B",.403,.403)

"BLD",5501,"KRN","B",.5,.5)

"BLD",5501,"KRN","B",.84,.84)

"BLD",5501,"KRN","B",3.6,3.6)

"BLD",5501,"KRN","B",3.8,3.8)

"BLD",5501,"KRN","B",9.2,9.2)

"BLD",5501,"KRN","B",9.8,9.8)

"BLD",5501,"KRN","B",19,19)

"BLD",5501,"KRN","B",19.1,19.1)

"BLD",5501,"KRN","B",101,101)

"BLD",5501,"KRN","B",409.61,409.61)

"BLD",5501,"KRN","B",771,771)

"BLD",5501,"KRN","B",870,870)

"BLD",5501,"KRN","B",8989.51,8989.51)

"BLD",5501,"KRN","B",8989.52,8989.52)

"BLD",5501,"KRN","B",8994,8994)

"BLD",5501,"QUES",0)
^9.62^^
"BLD",5501,"REQB",0)
^9.611^2^2
"BLD",5501,"REQB",1,0)
FB*3.5*14^2
"BLD",5501,"REQB",2,0)
FB*3.5*16^2
"BLD",5501,"REQB","B","FB*3.5*14",1)

"BLD",5501,"REQB","B","FB*3.5*16",2)

"MBREQ")
0
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950313
"PKG",60,22,1,"PAH",1,0)
78^3040422
"PKG",60,22,1,"PAH",1,1,0)
^^4^4^3040422
"PKG",60,22,1,"PAH",1,1,1,0)
Fee Basis Encapsulation API enhancement.
"PKG",60,22,1,"PAH",1,1,2,0)
 Add API $$RXSUM^FBRXUTL()
"PKG",60,22,1,"PAH",1,1,3,0)
 Add API $$AUTHL^FBUTL()
"PKG",60,22,1,"PAH",1,1,4,0)
 Modify API EN^FBHLZFE()
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","FBHLZFE")
0^1^B16274342
"RTN","FBHLZFE",1,0)
FBHLZFE ;WCIOFO/SAB-CREATE HL7 ZFE SEGMENTS ;7/21/1998
"RTN","FBHLZFE",2,0)
 ;;3.5;FEE BASIS;**14,78**;JAN 30, 1995
"RTN","FBHLZFE",3,0)
 ;
"RTN","FBHLZFE",4,0)
 ; This routine generates ZFE HL7 segments that contain FEE BASIS
"RTN","FBHLZFE",5,0)
 ; authorization data for a veteran. 
"RTN","FBHLZFE",6,0)
 ;
"RTN","FBHLZFE",7,0)
EN(DFN,FBSTR,FBCUT) ; Returns array of ZFE segments containing FEE BASIS
"RTN","FBHLZFE",8,0)
 ;                 authorizatiion data for a veteran.
"RTN","FBHLZFE",9,0)
 ;  Input:
"RTN","FBHLZFE",10,0)
 ;    DFN   - internal entry number of the PATIENT (#2) file and
"RTN","FBHLZFE",11,0)
 ;            FEE BASIS PATIENT (#161) file
"RTN","FBHLZFE",12,0)
 ;    FBSTR - (optional) comma delimited sting of requested fields
"RTN","FBHLZFE",13,0)
 ;            DEFAULT: "1,2,3,4,5" (returns all fields)
"RTN","FBHLZFE",14,0)
 ;    FBCUT - (optional) cutoff date (fileman format)
"RTN","FBHLZFE",15,0)
 ;            Default: "2961001" (Oct 1, 1996)
"RTN","FBHLZFE",16,0)
 ;            authorizations with a TO DATE prior to the cutoff will
"RTN","FBHLZFE",17,0)
 ;            not be considered.
"RTN","FBHLZFE",18,0)
 ;    Also needs HL7 variables defined (HLFS, HLECH and HLQ)
"RTN","FBHLZFE",19,0)
 ;  Output:
"RTN","FBHLZFE",20,0)
 ;    If an exception did not occur
"RTN","FBHLZFE",21,0)
 ;    FBZFE(I) - an array of string(s) forming the ZFE segments for the
"RTN","FBHLZFE",22,0)
 ;               patient's FEE authorizations that meet the criteria.
"RTN","FBHLZFE",23,0)
 ;               I will be numeric values greater than 0.
"RTN","FBHLZFE",24,0)
 ;            OR undefined if no authorizations meet criteria.
"RTN","FBHLZFE",25,0)
 ;
"RTN","FBHLZFE",26,0)
 ;               Note: Only the latest authorization for each group is
"RTN","FBHLZFE",27,0)
 ;               returned (where group is FEE PROGRAM + TREATMENT TYPE).
"RTN","FBHLZFE",28,0)
 ;
"RTN","FBHLZFE",29,0)
 ;    If an exception did occur
"RTN","FBHLZFE",30,0)
 ;    FBZFE(0) = -1 ^ exception number ^ exception text
"RTN","FBHLZFE",31,0)
 ;
"RTN","FBHLZFE",32,0)
 N FBA,FBDA1,FBGRP,FBI,FBICN,FBY0
"RTN","FBHLZFE",33,0)
 K FBZFE ; initialize array
"RTN","FBHLZFE",34,0)
 I $G(FBSTR)="" S FBSTR="1,2,3,4,5"
"RTN","FBHLZFE",35,0)
 S FBSTR=","_FBSTR_","
"RTN","FBHLZFE",36,0)
 I $G(FBCUT)="" S FBCUT=2961001
"RTN","FBHLZFE",37,0)
 ;
"RTN","FBHLZFE",38,0)
 ; check for required input
"RTN","FBHLZFE",39,0)
 I $G(FBZFE(0))'<0 D
"RTN","FBHLZFE",40,0)
 . I $G(DFN)="" S FBZFE(0)="-1^103^Patient DFN not specified." Q
"RTN","FBHLZFE",41,0)
 . I '$D(HLFS)!'$D(HLECH)!'$D(HLQ) S FBZFE(0)="-1^201^HL7 variables not defined." Q
"RTN","FBHLZFE",42,0)
 ;
"RTN","FBHLZFE",43,0)
 ; get patient ICN
"RTN","FBHLZFE",44,0)
 I $G(FBZFE(0))'<0 D
"RTN","FBHLZFE",45,0)
 . I $$IFLOCAL^MPIF001(DFN) S FBZFE(0)="-1^104^ICN could not be determined for the specified patient." Q  ; must not be local ICN
"RTN","FBHLZFE",46,0)
 . S FBICN=$$GETICN^MPIF001(DFN) I FBICN<0 S FBZFE(0)="-1^104^ICN could not be determined for the specified patient." Q
"RTN","FBHLZFE",47,0)
 ;
"RTN","FBHLZFE",48,0)
 ; check if cutoff date is a valid value
"RTN","FBHLZFE",49,0)
 I $G(FBZFE(0))'<0 D
"RTN","FBHLZFE",50,0)
 . I FBCUT'?7N S FBZFE(0)="-1^101^Valid date not specified." Q
"RTN","FBHLZFE",51,0)
 . I $$FMTHL7^XLFDT(FBCUT)<0 S FBZFE(0)="-1^101^Valid date not specified." Q
"RTN","FBHLZFE",52,0)
 ;
"RTN","FBHLZFE",53,0)
 I $G(FBZFE(0))'<0 D
"RTN","FBHLZFE",54,0)
 . ; find authorizations that meet criteria (if any)
"RTN","FBHLZFE",55,0)
 . ; loop thru authorizations
"RTN","FBHLZFE",56,0)
 . S FBDA1=0 F  S FBDA1=$O(^FBAAA(DFN,1,FBDA1)) Q:'FBDA1  D
"RTN","FBHLZFE",57,0)
 . . Q:$P($G(^FBAAA(DFN,1,FBDA1,"ADEL")),U)="Y"  ; ignore Austin Deleted
"RTN","FBHLZFE",58,0)
 . . S FBY0=$G(^FBAAA(DFN,1,FBDA1,0))
"RTN","FBHLZFE",59,0)
 . . Q:$P(FBY0,U,3)=""  ; FEE Program required
"RTN","FBHLZFE",60,0)
 . . Q:$P(FBY0,U,2)<FBCUT  ; before cutoff date
"RTN","FBHLZFE",61,0)
 . . S FBGRP=$P(FBY0,U,3)_U_$P(FBY0,U,13) ; group (Program + Treat. Type)
"RTN","FBHLZFE",62,0)
 . . Q:$P(FBY0,U,2)'>$P($G(FBA(FBGRP)),U,2)  ; already have later for grp
"RTN","FBHLZFE",63,0)
 . . ; save as latest found (so far) for a group
"RTN","FBHLZFE",64,0)
 . . S FBA(FBGRP)=FBDA1_U_$P(FBY0,U,2)
"RTN","FBHLZFE",65,0)
 . ;
"RTN","FBHLZFE",66,0)
 . ; build FBZFE array for selected authorizations
"RTN","FBHLZFE",67,0)
 . S FBI=0 ; init number of array elements
"RTN","FBHLZFE",68,0)
 . S FBGRP="" F  S FBGRP=$O(FBA(FBGRP)) Q:FBGRP=""  D
"RTN","FBHLZFE",69,0)
 . . S FBDA1=$P(FBA(FBGRP),U)
"RTN","FBHLZFE",70,0)
 . . D AUTH
"RTN","FBHLZFE",71,0)
 ;
"RTN","FBHLZFE",72,0)
QUIT ;
"RTN","FBHLZFE",73,0)
 Q
"RTN","FBHLZFE",74,0)
 ;
"RTN","FBHLZFE",75,0)
AUTH ; Add node (HL7 ZFE seg.) to FBZFE array for a specified authorization
"RTN","FBHLZFE",76,0)
 ;   Input:
"RTN","FBHLZFE",77,0)
 ;     DFN    - veteran ien (file #2 and #161)
"RTN","FBHLZFE",78,0)
 ;     FBDA1  - authorization ien (authorization multiple of #161)
"RTN","FBHLZFE",79,0)
 ;     FBI    - previous set ID number used for array or 0 when none
"RTN","FBHLZFE",80,0)
 ;     FBSTR  - comma delimited string of requested fields
"RTN","FBHLZFE",81,0)
 ;   Output:
"RTN","FBHLZFE",82,0)
 ;     FBI        - set ID (modified)
"RTN","FBHLZFE",83,0)
 ;     FBZFE(FBI) - output array element for one set ID
"RTN","FBHLZFE",84,0)
 ;                  ZFE ^ set ID ^ treat. type ^ FEE program ^ From ^ To
"RTN","FBHLZFE",85,0)
 ;
"RTN","FBHLZFE",86,0)
 N FBY0,X
"RTN","FBHLZFE",87,0)
 ;
"RTN","FBHLZFE",88,0)
 S FBY0=$G(^FBAAA(DFN,1,FBDA1,0))
"RTN","FBHLZFE",89,0)
 Q:FBY0=""  ; nothing to process
"RTN","FBHLZFE",90,0)
 ;
"RTN","FBHLZFE",91,0)
 S FBI=FBI+1
"RTN","FBHLZFE",92,0)
 ;
"RTN","FBHLZFE",93,0)
 S FBZFE(FBI)="ZFE"
"RTN","FBHLZFE",94,0)
 S $P(FBZFE(FBI),HLFS,6)=""
"RTN","FBHLZFE",95,0)
 I FBSTR[",1," S $P(FBZFE(FBI),HLFS,2)=FBI ; sequential number
"RTN","FBHLZFE",96,0)
 I FBSTR[",2," S X=$$EXTERNAL^DILFD(161.01,.095,"",$P(FBY0,U,13)),$P(FBZFE(FBI),HLFS,3)=$S(X]"":X,1:HLQ)_$E(HLECH)_$E(HLECH)_"VA0033" ; Treatment Type
"RTN","FBHLZFE",97,0)
 I FBSTR[",3," S X=$S($P(FBY0,U,3):$P($G(^FBAA(161.8,$P(FBY0,U,3),0)),U),1:""),$P(FBZFE(FBI),HLFS,4)=$S(X]"":X,1:HLQ)_$E(HLECH)_$E(HLECH)_"VA0034" ; FEE Program
"RTN","FBHLZFE",98,0)
 I FBSTR[",4," S $P(FBZFE(FBI),HLFS,5)=$S($P(FBY0,U)]"":$$HLDATE^HLFNC($P(FBY0,U)),1:HLQ) ; From Date
"RTN","FBHLZFE",99,0)
 I FBSTR[",5," S $P(FBZFE(FBI),HLFS,6)=$S($P(FBY0,U,2)]"":$$HLDATE^HLFNC($P(FBY0,U,2)),1:HLQ) ; To Date
"RTN","FBHLZFE",100,0)
 Q
"RTN","FBRXUTL")
0^2^B6847438
"RTN","FBRXUTL",1,0)
FBRXUTL ;WIOFO/SAB-FEE BASIS PHARMACY UTILITY ;4/8/2004
"RTN","FBRXUTL",2,0)
 ;;3.5;FEE BASIS;**78**;JAN 30, 1995
"RTN","FBRXUTL",3,0)
 Q
"RTN","FBRXUTL",4,0)
 ;
"RTN","FBRXUTL",5,0)
RXSUM(FBDT,FBSN) ; fee prescription costs extrinsic function
"RTN","FBRXUTL",6,0)
 ; Integration Agreement #4395
"RTN","FBRXUTL",7,0)
 ; This API returns the count and cost of prescriptions paid
"RTN","FBRXUTL",8,0)
 ; through the fee software for a specified date.
"RTN","FBRXUTL",9,0)
 ;
"RTN","FBRXUTL",10,0)
 ; Usage: S X=$$FEERX(FBDT,FBSN)
"RTN","FBRXUTL",11,0)
 ; input
"RTN","FBRXUTL",12,0)
 ;   FBDT - date, required, VA FileMan internal format
"RTN","FBRXUTL",13,0)
 ;          Used to select prescriptions based on Date Certified for
"RTN","FBRXUTL",14,0)
 ;          Payment.
"RTN","FBRXUTL",15,0)
 ;   FBSN - station number, required, 3 digit value
"RTN","FBRXUTL",16,0)
 ;          Used to select prescriptions based on the VAMC that approved
"RTN","FBRXUTL",17,0)
 ;          payment when querying the national Fee Replacement system.
"RTN","FBRXUTL",18,0)
 ;          Prescriptions will be included when the approving station
"RTN","FBRXUTL",19,0)
 ;          number Starts With this 3 digit value so satellite
"RTN","FBRXUTL",20,0)
 ;          station 688A1 would be included when FBSN = 688.
"RTN","FBRXUTL",21,0)
 ;          This parameter will not be evaluated until the API is
"RTN","FBRXUTL",22,0)
 ;          modified to obtain data from the Fee Replacement system.
"RTN","FBRXUTL",23,0)
 ; Return value is a string
"RTN","FBRXUTL",24,0)
 ;   string value = count ^ total amount paid
"RTN","FBRXUTL",25,0)
 ;   where
"RTN","FBRXUTL",26,0)
 ;     count = the number of prescriptions for the date and station
"RTN","FBRXUTL",27,0)
 ;     total amount paid = sum of the Amount Paid for the prescriptions
"RTN","FBRXUTL",28,0)
 ;       in dollars and cents
"RTN","FBRXUTL",29,0)
 ;   OR
"RTN","FBRXUTL",30,0)
 ;   X = -1 ^ exception number ^ exception text
"RTN","FBRXUTL",31,0)
 ;
"RTN","FBRXUTL",32,0)
 ;   Examples S var=$$FEERX^FBZSAB9(DT,688) could return values like
"RTN","FBRXUTL",33,0)
 ;     8^10.54
"RTN","FBRXUTL",34,0)
 ;     0^0.00
"RTN","FBRXUTL",35,0)
 ;     -1^110^Database Unavailable
"RTN","FBRXUTL",36,0)
 ;
"RTN","FBRXUTL",37,0)
 ;   List of Exceptions
"RTN","FBRXUTL",38,0)
 ;     101^Valid date not specified.
"RTN","FBRXUTL",39,0)
 ;     102^Valid station number not specified.
"RTN","FBRXUTL",40,0)
 ;     110^Database Unavailable.
"RTN","FBRXUTL",41,0)
 ;   The database unavailable exception will not occur until this API
"RTN","FBRXUTL",42,0)
 ;   is modified to obtain data from the fee replacement system.
"RTN","FBRXUTL",43,0)
 ;   However, calling applications should code to handle this exception
"RTN","FBRXUTL",44,0)
 ;   now so appropriate action will be taken once the data is moved from
"RTN","FBRXUTL",45,0)
 ;   the local VistA system to the remote fee replacement system.
"RTN","FBRXUTL",46,0)
 ;
"RTN","FBRXUTL",47,0)
 N FBDFN,FBC,FBDA,FBDA1,FBRET,FBTAMT
"RTN","FBRXUTL",48,0)
 S FBDT=$G(FBDT)
"RTN","FBRXUTL",49,0)
 S FBSN=$G(FBSN)
"RTN","FBRXUTL",50,0)
 S FBRET=""
"RTN","FBRXUTL",51,0)
 ;
"RTN","FBRXUTL",52,0)
 ; check for required input
"RTN","FBRXUTL",53,0)
 I FBRET'<0 D
"RTN","FBRXUTL",54,0)
 . I FBDT'?7N S FBRET="-1^101^Valid date not specified." Q
"RTN","FBRXUTL",55,0)
 . I $$FMTHL7^XLFDT(FBDT)<0 S FBRET="-1^101^Valid date not specified." Q
"RTN","FBRXUTL",56,0)
 . I FBSN'?3N S FBRET="-1^102^Valid station number not specified." Q
"RTN","FBRXUTL",57,0)
 . I $$IEN^XUAF4(FBSN)'>0 S FBRET="-1^102^Valid station number not specified." Q
"RTN","FBRXUTL",58,0)
 ;
"RTN","FBRXUTL",59,0)
 ; get count and total amount
"RTN","FBRXUTL",60,0)
 I FBRET'<0 D
"RTN","FBRXUTL",61,0)
 . S FBC=0 ; initialize count
"RTN","FBRXUTL",62,0)
 . S FBTAMT=0 ; initialize total amount paid
"RTN","FBRXUTL",63,0)
 . ;
"RTN","FBRXUTL",64,0)
 . ; find prescriptions using File #162.1 "AA" cross-reference
"RTN","FBRXUTL",65,0)
 . ; loop thru patient within date certified
"RTN","FBRXUTL",66,0)
 . S FBDFN=""
"RTN","FBRXUTL",67,0)
 . F  S FBDFN=$O(^FBAA(162.1,"AA",FBDT,FBDFN)) Q:FBDFN=""  D
"RTN","FBRXUTL",68,0)
 . . ; loop thru invoice ien
"RTN","FBRXUTL",69,0)
 . . S FBDA1=0
"RTN","FBRXUTL",70,0)
 . . F  S FBDA1=$O(^FBAA(162.1,"AA",FBDT,FBDFN,FBDA1)) Q:'FBDA1  D
"RTN","FBRXUTL",71,0)
 . . . ; loop thru prescription ien
"RTN","FBRXUTL",72,0)
 . . . S FBDA=0
"RTN","FBRXUTL",73,0)
 . . . F  S FBDA=$O(^FBAA(162.1,"AA",FBDT,FBDFN,FBDA1,FBDA)) Q:'FBDA  D
"RTN","FBRXUTL",74,0)
 . . . . ; add prescription to count and total amount paid
"RTN","FBRXUTL",75,0)
 . . . . S FBC=FBC+1
"RTN","FBRXUTL",76,0)
 . . . . S FBTAMT=FBTAMT+$P($G(^FBAA(162.1,FBDA1,"RX",FBDA,0)),U,16)
"RTN","FBRXUTL",77,0)
 . ; 
"RTN","FBRXUTL",78,0)
 . S FBRET=FBC_U_$FN(FBTAMT,"",2)
"RTN","FBRXUTL",79,0)
 ;
"RTN","FBRXUTL",80,0)
 Q FBRET
"RTN","FBRXUTL",81,0)
 ;
"RTN","FBRXUTL",82,0)
 ;FBRXUTL
"RTN","FBUTL")
0^3^B16565072
"RTN","FBUTL",1,0)
FBUTL ;WCIOFO/SAB-FEE BASIS UTILITY ;4/8/2004
"RTN","FBUTL",2,0)
 ;;3.5;FEE BASIS;**16,78**;JAN 30, 1995
"RTN","FBUTL",3,0)
 Q
"RTN","FBUTL",4,0)
 ;
"RTN","FBUTL",5,0)
AUTH(FBDA,FBCUT) ; FEE Authorization extrinsic function
"RTN","FBUTL",6,0)
 ; Determines if the patient has any FEE authorizations on file.
"RTN","FBUTL",7,0)
 ; An optional date can be specified to determine if the patient has
"RTN","FBUTL",8,0)
 ;   any FEE authorizations in effect on or after the specified date.
"RTN","FBUTL",9,0)
 ; input
"RTN","FBUTL",10,0)
 ;    FBDA  - patient internal entry number (DFN)
"RTN","FBUTL",11,0)
 ;            of the PATIENT (#2) and FEE BASIS PATIENT (#161) file
"RTN","FBUTL",12,0)
 ;    FBCUT - (optional) cutoff date (fileman format)
"RTN","FBUTL",13,0)
 ;            Default: none
"RTN","FBUTL",14,0)
 ;            authorizations with a TO DATE prior to the
"RTN","FBUTL",15,0)
 ;            cutoff date (if specified) will not be considered.
"RTN","FBUTL",16,0)
 ; returns a value of 1 or 0
"RTN","FBUTL",17,0)
 ;   will be true (1) if patient has one or more FEE authorizations
"RTN","FBUTL",18,0)
 ;
"RTN","FBUTL",19,0)
 N FBDA1,FBRET,FBY0
"RTN","FBUTL",20,0)
 S FBCUT=$S($G(FBCUT)?7N:FBCUT,1:"")
"RTN","FBUTL",21,0)
 S FBRET=0 ; assume no authorizations will meet criteria
"RTN","FBUTL",22,0)
 ; reverse loop thru authorizations - stop when any one meets criteria
"RTN","FBUTL",23,0)
 S FBDA1=" " F  S FBDA1=$O(^FBAAA(FBDA,1,FBDA1),-1) Q:'FBDA1  D  Q:FBRET
"RTN","FBUTL",24,0)
 . Q:$P($G(^FBAAA(FBDA,1,FBDA1,"ADEL")),U)="Y"  ; ignore Austin Deleted
"RTN","FBUTL",25,0)
 . S FBY0=$G(^FBAAA(FBDA,1,FBDA1,0))
"RTN","FBUTL",26,0)
 . I FBCUT]"",$P(FBY0,U,2)<FBCUT Q  ; To Date before cutoff date
"RTN","FBUTL",27,0)
 . Q:$P(FBY0,U,3)=""  ; FEE Program required
"RTN","FBUTL",28,0)
 . ; passed all checks
"RTN","FBUTL",29,0)
 . S FBRET=1
"RTN","FBUTL",30,0)
 ;
"RTN","FBUTL",31,0)
 Q FBRET
"RTN","FBUTL",32,0)
 ;
"RTN","FBUTL",33,0)
AUTHL(FBDFN,FBSN,FBDT,FBAR) ; authorization list for patient
"RTN","FBUTL",34,0)
 ; Integration Agreement #4396
"RTN","FBUTL",35,0)
 ; This API returns authorization data for a specified patient.
"RTN","FBUTL",36,0)
 ; Authorizations that have been Austin Deleted will not be returned.
"RTN","FBUTL",37,0)
 ;
"RTN","FBUTL",38,0)
 ; input
"RTN","FBUTL",39,0)
 ;   FBDFN - patient DFN (File #2 internal entry number), required
"RTN","FBUTL",40,0)
 ;   FBSN  - station number, optional
"RTN","FBUTL",41,0)
 ;           If specified, the station number will be used to select
"RTN","FBUTL",42,0)
 ;           authorizations from the national Fee Replacement system.
"RTN","FBUTL",43,0)
 ;           Only authorizations whose issuing station Starts With this
"RTN","FBUTL",44,0)
 ;           parameter value will be returned. 
"RTN","FBUTL",45,0)
 ;           This parameter will not be evaluated until the API is
"RTN","FBUTL",46,0)
 ;           modified to obtain data from the fee replacement system.
"RTN","FBUTL",47,0)
 ;   FBDT  - cutoff date, optional, VA FileMan internal format
"RTN","FBUTL",48,0)
 ;           If specified, only authorizations whose To Date is
"RTN","FBUTL",49,0)
 ;           equal to or after the cutoff date will be returned.
"RTN","FBUTL",50,0)
 ;   FBAR  - name of output array, optional, default value "FBAUTH"
"RTN","FBUTL",51,0)
 ;           closed root, must not equal variables newed by this API
"RTN","FBUTL",52,0)
 ;           such as FBAR.
"RTN","FBUTL",53,0)
 ;           examples: "FBAUTH", "DGAUTH(12)", "^TMP($J)"
"RTN","FBUTL",54,0)
 ;           The array will be initialized by this API.
"RTN","FBUTL",55,0)
 ; output
"RTN","FBUTL",56,0)
 ;   returns string value
"RTN","FBUTL",57,0)
 ;     = count of authorizations in array
"RTN","FBUTL",58,0)
 ;   OR
"RTN","FBUTL",59,0)
 ;     = -1^exception number^exception text
"RTN","FBUTL",60,0)
 ;
"RTN","FBUTL",61,0)
 ;   If an exception did not occur, then the output array will contain 
"RTN","FBUTL",62,0)
 ;   authorization data subscripted by sequential canonic
"RTN","FBUTL",63,0)
 ;   numbers and a header node subscripted by 0.
"RTN","FBUTL",64,0)
 ;     array(0) = count of authorizations in array
"RTN","FBUTL",65,0)
 ;     array(#,"FDT") = authorization # From Date (internal format)
"RTN","FBUTL",66,0)
 ;     array(#,"TDT") = authorization # To Date (internal format)
"RTN","FBUTL",67,0)
 ;       OR
"RTN","FBUTL",68,0)
 ;   Example if "FBAUTH" used as array name
"RTN","FBUTL",69,0)
 ;     FBAUTH(0)=2
"RTN","FBUTL",70,0)
 ;     FBAUTH(1,"FDT")=3011021
"RTN","FBUTL",71,0)
 ;     FBAUTH(1,"TDT")=3011030
"RTN","FBUTL",72,0)
 ;     FBAUTH(2,"FDT")=3000101
"RTN","FBUTL",73,0)
 ;     FBAUTH(2,"TDT")=3031231
"RTN","FBUTL",74,0)
 ;   Note that additional subscripts may be added in the future to
"RTN","FBUTL",75,0)
 ;   provide more authorization data. The calling application should
"RTN","FBUTL",76,0)
 ;   kill the entire output array so any added subscripts will be
"RTN","FBUTL",77,0)
 ;   cleaned-up (e.g. K FBAUTH).
"RTN","FBUTL",78,0)
 ;   List of exceptions
"RTN","FBUTL",79,0)
 ;     101^Patient DFN not specified.
"RTN","FBUTL",80,0)
 ;     104^ICN could not be determined for the specified patient.
"RTN","FBUTL",81,0)
 ;     105^Array name conflicts with a variable in the API.
"RTN","FBUTL",82,0)
 ;     110^Database Unavailable.
"RTN","FBUTL",83,0)
 ;   The database unavailable exception will not occur until this API
"RTN","FBUTL",84,0)
 ;   is modified to obtain data from the fee replacement system.
"RTN","FBUTL",85,0)
 ;   However, calling applications should code to handle this exception
"RTN","FBUTL",86,0)
 ;   now so appropriate action will be taken once the data is moved from
"RTN","FBUTL",87,0)
 ;   the local VistA system to the remote fee replacement system.
"RTN","FBUTL",88,0)
 ;
"RTN","FBUTL",89,0)
 N FBC,FBDA,FBICN,FBRET,FBY
"RTN","FBUTL",90,0)
 ;
"RTN","FBUTL",91,0)
 S FBAR=$G(FBAR,"FBAUTH")
"RTN","FBUTL",92,0)
 S FBSN=$G(FBSN)
"RTN","FBUTL",93,0)
 S FBDT=$G(FBDT)
"RTN","FBUTL",94,0)
 S FBRET=""
"RTN","FBUTL",95,0)
 ;
"RTN","FBUTL",96,0)
 ; ensure input array name is not one of the newed variables.
"RTN","FBUTL",97,0)
 ; If conflict, then array will not be changed by this API.
"RTN","FBUTL",98,0)
 I "^FBDFN^FBAR^FBC^FBDA^FBDT^FBICN^FBRET^FBSN^FBY^"[(U_FBAR_U) S FBRET="-1^105^Array name conflicts with a variable in the API."
"RTN","FBUTL",99,0)
 ;
"RTN","FBUTL",100,0)
 ; initialize output array
"RTN","FBUTL",101,0)
 I FBRET'<0 K @FBAR
"RTN","FBUTL",102,0)
 ;
"RTN","FBUTL",103,0)
 ; check for required input
"RTN","FBUTL",104,0)
 I FBRET'<0,$G(FBDFN)="" S FBRET="-1^101^Patient DFN not specified."
"RTN","FBUTL",105,0)
 ;
"RTN","FBUTL",106,0)
 ; get patient ICN
"RTN","FBUTL",107,0)
 I FBRET'<0 D
"RTN","FBUTL",108,0)
 . I $$IFLOCAL^MPIF001(FBDFN) S FBRET="-1^104^ICN could not be determined for the specified patient." Q  ; must not be local ICN
"RTN","FBUTL",109,0)
 . S FBICN=$$GETICN^MPIF001(FBDFN) I FBICN<0 S FBRET="-1^104^ICN could not be determined for the specified patient." Q
"RTN","FBUTL",110,0)
 ;
"RTN","FBUTL",111,0)
 ; if optional date passed then check if valid value
"RTN","FBUTL",112,0)
 I FBRET'<0,FBDT'="" D
"RTN","FBUTL",113,0)
 . I FBDT'?7N S FBRET="-1^101^Valid date not specified." Q
"RTN","FBUTL",114,0)
 . I $$FMTHL7^XLFDT(FBDT)<0 S FBRET="-1^101^Valid date not specified." Q
"RTN","FBUTL",115,0)
 ;
"RTN","FBUTL",116,0)
 ; get authorization data
"RTN","FBUTL",117,0)
 I FBRET'<0 D
"RTN","FBUTL",118,0)
 . S FBC=0 ; initialize count/subscript of authorizations in output array
"RTN","FBUTL",119,0)
 . ; loop thru AUTHORIZATION multiple of file #161
"RTN","FBUTL",120,0)
 . S FBDA=0 F  S FBDA=$O(^FBAAA(FBDFN,1,FBDA)) Q:'FBDA  D
"RTN","FBUTL",121,0)
 . . Q:$P($G(^FBAAA(FBDFN,1,FBDA,"ADEL")),U)="Y"  ; skip Austin Deleted
"RTN","FBUTL",122,0)
 . . S FBY=$G(^FBAAA(FBDFN,1,FBDA,0))
"RTN","FBUTL",123,0)
 . . I FBDT,$P(FBY,U,2)<FBDT Q  ; skip if To Date before optional Cutoff
"RTN","FBUTL",124,0)
 . . ; increment count and store authorization data in array
"RTN","FBUTL",125,0)
 . . S FBC=FBC+1
"RTN","FBUTL",126,0)
 . . S @FBAR@(FBC,"FDT")=$P(FBY,U)
"RTN","FBUTL",127,0)
 . . S @FBAR@(FBC,"TDT")=$P(FBY,U,2)
"RTN","FBUTL",128,0)
 . ;
"RTN","FBUTL",129,0)
 . ; set return value and header node of output array
"RTN","FBUTL",130,0)
 . S FBRET=FBC
"RTN","FBUTL",131,0)
 . S @FBAR@(0)=FBC
"RTN","FBUTL",132,0)
 ;
"RTN","FBUTL",133,0)
 Q FBRET
"RTN","FBUTL",134,0)
 ;
"RTN","FBUTL",135,0)
 ;FBUTL
"VER")
8.0^22
**END**
**END**
