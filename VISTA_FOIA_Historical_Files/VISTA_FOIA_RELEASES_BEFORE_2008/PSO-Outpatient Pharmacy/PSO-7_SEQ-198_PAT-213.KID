Released PSO*7*213 SEQ #198
Extracted from mail message
**KIDS**:PSO*7.0*213^

**INSTALL NAME**
PSO*7.0*213
"BLD",5743,0)
PSO*7.0*213^OUTPATIENT PHARMACY^0^3051108^y
"BLD",5743,1,0)
^^25^25^3051006^^^
"BLD",5743,1,1,0)
This patch contains Application Program Interfaces (APIs) that will be 
"BLD",5743,1,2,0)
used by calling applications that currently do direct global reads or 
"BLD",5743,1,3,0)
writes to the Outpatient Pharmacy files.  Since the PRESCRIPTION file 
"BLD",5743,1,4,0)
(#52), PENDING OUTPATIENT ORDERS file (#52.41), RX SUSPENSE file (#52.5), 
"BLD",5743,1,5,0)
CLOZAPINE PRESCRIPTION OVERRIDES file (#52.52), TPB ELIGIBILITY file 
"BLD",5743,1,6,0)
(#52.91), RX PATIENT STATUS file (#53), and OUTPATIENT SITE file (#59) 
"BLD",5743,1,7,0)
are being replaced as part of the Pharmacy Re-engineering project, any 
"BLD",5743,1,8,0)
direct M-based global reads or writes to these files must be replaced by 
"BLD",5743,1,9,0)
calling the APIs provided in this patch. When the new data source is in 
"BLD",5743,1,10,0)
place, the calling applications will not be required to make any changes, 
"BLD",5743,1,11,0)
because these APIs will be flexible enough to retrieve the requested data 
"BLD",5743,1,12,0)
from the new data source, when the time comes.
"BLD",5743,1,13,0)
 
"BLD",5743,1,14,0)
These are the files that are affected. If any application is making 
"BLD",5743,1,15,0)
direct global reads or writes to any of these files, they must be 
"BLD",5743,1,16,0)
replaced by using the APIs exported with this patch.
"BLD",5743,1,17,0)
 
"BLD",5743,1,18,0)
File Name:                               File Number:
"BLD",5743,1,19,0)
PRESCRIPTION                                 52
"BLD",5743,1,20,0)
PENDING OUTPATIENT ORDERS                    52.41
"BLD",5743,1,21,0)
RX SUSPENSE                                  52.5
"BLD",5743,1,22,0)
CLOZAPINE PRESCRIPTION OVERRIDES             52.52
"BLD",5743,1,23,0)
TPB ELIGIBILITY                              52.91
"BLD",5743,1,24,0)
RX PATIENT STATUS                            53
"BLD",5743,1,25,0)
OUTPATIENT SITE                              59
"BLD",5743,4,0)
^9.64PA^^
"BLD",5743,"KRN",0)
^9.67PA^8989.52^19
"BLD",5743,"KRN",.4,0)
.4
"BLD",5743,"KRN",.401,0)
.401
"BLD",5743,"KRN",.402,0)
.402
"BLD",5743,"KRN",.403,0)
.403
"BLD",5743,"KRN",.5,0)
.5
"BLD",5743,"KRN",.84,0)
.84
"BLD",5743,"KRN",3.6,0)
3.6
"BLD",5743,"KRN",3.8,0)
3.8
"BLD",5743,"KRN",9.2,0)
9.2
"BLD",5743,"KRN",9.8,0)
9.8
"BLD",5743,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",5743,"KRN",9.8,"NM",1,0)
PSO5241^^0^B6238122
"BLD",5743,"KRN",9.8,"NM",2,0)
PSO5252^^0^B6511633
"BLD",5743,"KRN",9.8,"NM",3,0)
PSO525AP^^0^B8650736
"BLD",5743,"KRN",9.8,"NM",4,0)
PSO52API^^0^B83556883
"BLD",5743,"KRN",9.8,"NM",5,0)
PSO52AP1^^0^B6235999
"BLD",5743,"KRN",9.8,"NM",6,0)
PSO5291^^0^B2740068
"BLD",5743,"KRN",9.8,"NM",7,0)
PSO53^^0^B2836960
"BLD",5743,"KRN",9.8,"NM",8,0)
PSO59^^0^B3416907
"BLD",5743,"KRN",9.8,"NM","B","PSO5241",1)

"BLD",5743,"KRN",9.8,"NM","B","PSO5252",2)

"BLD",5743,"KRN",9.8,"NM","B","PSO525AP",3)

"BLD",5743,"KRN",9.8,"NM","B","PSO5291",6)

"BLD",5743,"KRN",9.8,"NM","B","PSO52AP1",5)

"BLD",5743,"KRN",9.8,"NM","B","PSO52API",4)

"BLD",5743,"KRN",9.8,"NM","B","PSO53",7)

"BLD",5743,"KRN",9.8,"NM","B","PSO59",8)

"BLD",5743,"KRN",19,0)
19
"BLD",5743,"KRN",19.1,0)
19.1
"BLD",5743,"KRN",101,0)
101
"BLD",5743,"KRN",409.61,0)
409.61
"BLD",5743,"KRN",771,0)
771
"BLD",5743,"KRN",870,0)
870
"BLD",5743,"KRN",8989.51,0)
8989.51
"BLD",5743,"KRN",8989.52,0)
8989.52
"BLD",5743,"KRN",8994,0)
8994
"BLD",5743,"KRN","B",.4,.4)

"BLD",5743,"KRN","B",.401,.401)

"BLD",5743,"KRN","B",.402,.402)

"BLD",5743,"KRN","B",.403,.403)

"BLD",5743,"KRN","B",.5,.5)

"BLD",5743,"KRN","B",.84,.84)

"BLD",5743,"KRN","B",3.6,3.6)

"BLD",5743,"KRN","B",3.8,3.8)

"BLD",5743,"KRN","B",9.2,9.2)

"BLD",5743,"KRN","B",9.8,9.8)

"BLD",5743,"KRN","B",19,19)

"BLD",5743,"KRN","B",19.1,19.1)

"BLD",5743,"KRN","B",101,101)

"BLD",5743,"KRN","B",409.61,409.61)

"BLD",5743,"KRN","B",771,771)

"BLD",5743,"KRN","B",870,870)

"BLD",5743,"KRN","B",8989.51,8989.51)

"BLD",5743,"KRN","B",8989.52,8989.52)

"BLD",5743,"KRN","B",8994,8994)

"BLD",5743,"QUES",0)
^9.62^^
"MBREQ")
0
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
213^3051108
"PKG",141,22,1,"PAH",1,1,0)
^^25^25^3051108
"PKG",141,22,1,"PAH",1,1,1,0)
This patch contains Application Program Interfaces (APIs) that will be 
"PKG",141,22,1,"PAH",1,1,2,0)
used by calling applications that currently do direct global reads or 
"PKG",141,22,1,"PAH",1,1,3,0)
writes to the Outpatient Pharmacy files.  Since the PRESCRIPTION file 
"PKG",141,22,1,"PAH",1,1,4,0)
(#52), PENDING OUTPATIENT ORDERS file (#52.41), RX SUSPENSE file (#52.5), 
"PKG",141,22,1,"PAH",1,1,5,0)
CLOZAPINE PRESCRIPTION OVERRIDES file (#52.52), TPB ELIGIBILITY file 
"PKG",141,22,1,"PAH",1,1,6,0)
(#52.91), RX PATIENT STATUS file (#53), and OUTPATIENT SITE file (#59) 
"PKG",141,22,1,"PAH",1,1,7,0)
are being replaced as part of the Pharmacy Re-engineering project, any 
"PKG",141,22,1,"PAH",1,1,8,0)
direct M-based global reads or writes to these files must be replaced by 
"PKG",141,22,1,"PAH",1,1,9,0)
calling the APIs provided in this patch. When the new data source is in 
"PKG",141,22,1,"PAH",1,1,10,0)
place, the calling applications will not be required to make any changes, 
"PKG",141,22,1,"PAH",1,1,11,0)
because these APIs will be flexible enough to retrieve the requested data 
"PKG",141,22,1,"PAH",1,1,12,0)
from the new data source, when the time comes.
"PKG",141,22,1,"PAH",1,1,13,0)
 
"PKG",141,22,1,"PAH",1,1,14,0)
These are the files that are affected. If any application is making 
"PKG",141,22,1,"PAH",1,1,15,0)
direct global reads or writes to any of these files, they must be 
"PKG",141,22,1,"PAH",1,1,16,0)
replaced by using the APIs exported with this patch.
"PKG",141,22,1,"PAH",1,1,17,0)
 
"PKG",141,22,1,"PAH",1,1,18,0)
File Name:                               File Number:
"PKG",141,22,1,"PAH",1,1,19,0)
PRESCRIPTION                                 52
"PKG",141,22,1,"PAH",1,1,20,0)
PENDING OUTPATIENT ORDERS                    52.41
"PKG",141,22,1,"PAH",1,1,21,0)
RX SUSPENSE                                  52.5
"PKG",141,22,1,"PAH",1,1,22,0)
CLOZAPINE PRESCRIPTION OVERRIDES             52.52
"PKG",141,22,1,"PAH",1,1,23,0)
TPB ELIGIBILITY                              52.91
"PKG",141,22,1,"PAH",1,1,24,0)
RX PATIENT STATUS                            53
"PKG",141,22,1,"PAH",1,1,25,0)
OUTPATIENT SITE                              59
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","PSO5241")
0^1^B6238122
"RTN","PSO5241",1,0)
PSO5241 ;BHAM ISC/SAB- encap II API to return pending Rx data ; 04/07/05 10:30 am
"RTN","PSO5241",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**213**;DEC 1997
"RTN","PSO5241",3,0)
 ;^PSDRUG supported by DBIA 221
"RTN","PSO5241",4,0)
 ;^PS(50.7 supported by DBIA 2223
"RTN","PSO5241",5,0)
 ;
"RTN","PSO5241",6,0)
PEN(DFN,LIST,IEN,PLACER) ;
"RTN","PSO5241",7,0)
 ;
"RTN","PSO5241",8,0)
 ;DFN: Patient's IEN 
"RTN","PSO5241",9,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSO5241",10,0)
 ;IEN: Internal record number [optional]
"RTN","PSO5241",11,0)
 ;PLACER: Pointer to Orders file (#100) [optional]
"RTN","PSO5241",12,0)
 ;
"RTN","PSO5241",13,0)
 Q:$G(DFN)']""  Q:$G(LIST)=""
"RTN","PSO5241",14,0)
 N DA,DR,PSOPOST,DIC,DIQ,ND,LK K ^TMP($J,LIST)
"RTN","PSO5241",15,0)
 S ^TMP($J,LIST,DFN,0)=0
"RTN","PSO5241",16,0)
 I $G(IEN) D PROCESS G CLEAN
"RTN","PSO5241",17,0)
 I $G(PLACER)]"",'$G(IEN) S IEN=$O(^PS(52.41,"B",PLACER,0)) D  G CLEAN
"RTN","PSO5241",18,0)
 .I 'IEN S ^TMP($J,LIST,DFN,0)="-1^NO DATA FOUND" Q
"RTN","PSO5241",19,0)
 .D PROCESS
"RTN","PSO5241",20,0)
 F IEN=0:0 S IEN=$O(^PS(52.41,"P",DFN,IEN)) Q:'IEN  D PROCESS
"RTN","PSO5241",21,0)
CLEAN I ^TMP($J,LIST,DFN,0)=0 S ^TMP($J,LIST,DFN,0)="-1^NO DATA FOUND"
"RTN","PSO5241",22,0)
 K DA,DR,DIC,PSOPOST,DIQ
"RTN","PSO5241",23,0)
 Q
"RTN","PSO5241",24,0)
PROCESS ;
"RTN","PSO5241",25,0)
 Q:$P($G(^PS(52.41,IEN,0)),"^",3)="DC"  Q:$P($G(^PS(52.41,IEN,0)),"^",3)="DE"
"RTN","PSO5241",26,0)
 I DFN'=$P($G(^PS(52.41,IEN,0)),"^",2) S ^TMP($J,LIST,IEN,0)="-1^NO DATA FOUND (MISMATCHED PATIENT)" Q
"RTN","PSO5241",27,0)
 I $G(^PS(52.41,IEN,0))']"" S ^TMP($J,LIST,DFN,IEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO5241",28,0)
 K PSOPOST S DIC=52.41,DA=IEN,DR=".01;2;8;9;11",DIQ="PSOPOST",DIQ(0)="IE" D EN^DIQ1
"RTN","PSO5241",29,0)
 F DR=.01,2,8 D  I DR=8 D OI
"RTN","PSO5241",30,0)
 .I DR=.01 S ^TMP($J,LIST,DFN,"B",PSOPOST(52.41,DA,DR,"I"),IEN)=""
"RTN","PSO5241",31,0)
 .I PSOPOST(52.41,DA,DR,"E")'=PSOPOST(52.41,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PSOPOST(52.41,DA,DR,"I")_"^"_PSOPOST(52.41,DA,DR,"E") Q
"RTN","PSO5241",32,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PSOPOST(52.41,DA,DR,"I")
"RTN","PSO5241",33,0)
 S DR=11 D
"RTN","PSO5241",34,0)
 .I PSOPOST(52.41,IEN,DR,"E")'=PSOPOST(52.41,IEN,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PSOPOST(52.41,IEN,DR,"I")_"^"_PSOPOST(52.41,IEN,DR,"E") Q
"RTN","PSO5241",35,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PSOPOST(52.41,IEN,DR,"I")
"RTN","PSO5241",36,0)
 S ^TMP($J,LIST,DFN,0)=^TMP($J,LIST,DFN,0)+1
"RTN","PSO5241",37,0)
 K DA,DR,PSOPOST,DIC,DIQ
"RTN","PSO5241",38,0)
 Q
"RTN","PSO5241",39,0)
OI ;orderable item
"RTN","PSO5241",40,0)
 S DIC=50.7,DA=PSOPOST(52.41,DA,DR,"I"),DR=.02,DIQ(0)="IE" D EN^DIQ1
"RTN","PSO5241",41,0)
 S ^TMP($J,LIST,DFN,IEN,8)=^TMP($J,LIST,DFN,IEN,8)_"^"_PSOPOST(50.7,DA,DR,"I")_"^"_PSOPOST(50.7,DA,DR,"E")
"RTN","PSO5241",42,0)
 Q
"RTN","PSO5252")
0^2^B6511633
"RTN","PSO5252",1,0)
PSO5252 ;BHAM ISC/SAB- encap II API to return clozapine rx overrides ; 04/07/05 10:30 am
"RTN","PSO5252",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**213**;DEC 1997
"RTN","PSO5252",3,0)
 ;
"RTN","PSO5252",4,0)
EN(LIST,IEN,RX,SDATE,EDATE) ;
"RTN","PSO5252",5,0)
 ;
"RTN","PSO5252",6,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSO5252",7,0)
 ;IEN: Internal record number [optional]
"RTN","PSO5252",8,0)
 ;RX #: Pointer to Prescription file (#52) [optional]
"RTN","PSO5252",9,0)
 ;SDATE: Starting Date [optional]
"RTN","PSO5252",10,0)
 ;EDATE: Ending  Date [optional]
"RTN","PSO5252",11,0)
 ;
"RTN","PSO5252",12,0)
 Q:$G(LIST)=""
"RTN","PSO5252",13,0)
 N DA,DR,PSOPOST,DIC,DIQ K ^TMP($J,LIST)
"RTN","PSO5252",14,0)
 I $G(IEN) D  G CLEAN
"RTN","PSO5252",15,0)
 .I $G(^PS(52.52,IEN,0))']"" S ^TMP($J,LIST,IEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO5252",16,0)
 .D PROCESS
"RTN","PSO5252",17,0)
 I $G(RX)]"",'$G(IEN) D  G CLEAN
"RTN","PSO5252",18,0)
 .I '$O(^PS(52.52,"A",RX,0)) S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSO5252",19,0)
 .S IEN=$O(^PS(52.52,"A",RX,0))
"RTN","PSO5252",20,0)
 .I $G(^PS(52.52,IEN,0))']"" S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSO5252",21,0)
 .D PROCESS
"RTN","PSO5252",22,0)
 I $G(SDATE)!($G(EDATE)) D DATE G CLEAN
"RTN","PSO5252",23,0)
 F IEN=0:0 S IEN=$O(^PS(52.52,IEN)) Q:'IEN  D PROCESS
"RTN","PSO5252",24,0)
CLEAN I '$O(^TMP($J,LIST,0)) S ^TMP($J,LIST,0)="-1^NO DATA FOUND"
"RTN","PSO5252",25,0)
 K DA,DR,DIC,PSOPOST,DIQ,LDATE
"RTN","PSO5252",26,0)
 Q
"RTN","PSO5252",27,0)
PROCESS ;
"RTN","PSO5252",28,0)
 K PSOPOST S DIC=52.52,DA=IEN,DR=".01:5",DIQ="PSOPOST",DIQ(0)="IE" D EN^DIQ1
"RTN","PSO5252",29,0)
 F DR=.01,1,2,3,4,5 D
"RTN","PSO5252",30,0)
 .I DR=.01 S ^TMP($J,LIST,"B",PSOPOST(52.52,DA,DR,"I"),IEN)="",^TMP($J,LIST,0)=$G(^TMP($J,LIST,0))+1
"RTN","PSO5252",31,0)
 .I PSOPOST(52.52,DA,DR,"E")'=PSOPOST(52.52,DA,DR,"I") S ^TMP($J,LIST,IEN,DR)=PSOPOST(52.52,DA,DR,"I")_"^"_PSOPOST(52.52,DA,DR,"E") Q
"RTN","PSO5252",32,0)
 .S ^TMP($J,LIST,IEN,DR)=PSOPOST(52.52,DA,DR,"I")
"RTN","PSO5252",33,0)
 K DA,DR,PSOPOST,DIC,DIQ
"RTN","PSO5252",34,0)
 Q
"RTN","PSO5252",35,0)
DATE ;date range
"RTN","PSO5252",36,0)
 I $G(SDATE) S LDATE=$P(SDATE,".") D  Q
"RTN","PSO5252",37,0)
 .I $G(EDATE) S EDATE=EDATE_".9999999" F  S LDATE=$O(^PS(52.52,"B",LDATE)) Q:'LDATE!(LDATE>EDATE)  F IEN=0:0 S IEN=$O(^PS(52.52,"B",LDATE,IEN)) Q:'IEN  D PROCESS
"RTN","PSO5252",38,0)
 .I '$G(EDATE) F  S LDATE=$O(^PS(52.52,"B",LDATE)) Q:'LDATE  F IEN=0:0 S IEN=$O(^PS(52.52,"B",LDATE,IEN)) Q:'IEN  D PROCESS
"RTN","PSO5252",39,0)
 I $G(EDATE),'$G(SDATE) S EDATE=EDATE_".9999999" D  Q
"RTN","PSO5252",40,0)
 .F LDATE=0:0 S LDATE=$O(^PS(52.52,"B",LDATE)) Q:'LDATE!(LDATE>EDATE)  F IEN=0:0 S IEN=$O(^PS(52.52,"B",LDATE,IEN)) Q:'IEN  D PROCESS
"RTN","PSO5252",41,0)
 Q
"RTN","PSO525AP")
0^3^B8650736
"RTN","PSO525AP",1,0)
PSO525AP ;BHAM ISC/SAB- encap II API to return suspended Rx data ; 04/07/05 10:30 am
"RTN","PSO525AP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**213**;DEC 1997
"RTN","PSO525AP",3,0)
 ;
"RTN","PSO525AP",4,0)
SUS(LIST,DFN,IEN,RX,SDATE,EDATE) ;
"RTN","PSO525AP",5,0)
 ;
"RTN","PSO525AP",6,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSO525AP",7,0)
 ;DFN: Patient's IEN 
"RTN","PSO525AP",8,0)
 ;IEN: Internal record number [optional]
"RTN","PSO525AP",9,0)
 ;RX #: Pointer to Prescription file (#52) [optional]
"RTN","PSO525AP",10,0)
 ;SDATE: Starting Suspense Date [optional]
"RTN","PSO525AP",11,0)
 ;EDATE: Ending Suspense Date [optional]
"RTN","PSO525AP",12,0)
 ;
"RTN","PSO525AP",13,0)
 Q:$G(LIST)=""
"RTN","PSO525AP",14,0)
 N DA,DR,PSOPOST,DIC,DIQ,ND,LK K ^TMP($J,LIST)
"RTN","PSO525AP",15,0)
 I $G(IEN) D  G CLEAN
"RTN","PSO525AP",16,0)
 .I $G(^PS(52.5,IEN,0))']"" S ^TMP($J,LIST,IEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO525AP",17,0)
 .D PROCESS
"RTN","PSO525AP",18,0)
 I $G(RX)]"",'$G(IEN) S IEN=$O(^PS(52.5,"B",RX,0)) D  G CLEAN
"RTN","PSO525AP",19,0)
 .I 'IEN Q
"RTN","PSO525AP",20,0)
 .D PROCESS
"RTN","PSO525AP",21,0)
 I $G(SDATE)!($G(EDATE)) D DATE G CLEAN
"RTN","PSO525AP",22,0)
 I $G(DFN) F IEN=0:0 S IEN=$O(^PS(52.5,"AF",DFN,IEN)) Q:'IEN  D
"RTN","PSO525AP",23,0)
 .I DFN'=$P($G(^PS(52.5,IEN,0)),"^",3) S ^TMP($J,LIST,IEN,0)="-1^NO DATA FOUND (MISMATCHED PATIENT)" Q
"RTN","PSO525AP",24,0)
 .D PROCESS
"RTN","PSO525AP",25,0)
 I '$G(DFN) F DFN=0:0 S DFN=$O(^PS(52.5,"AF",DFN)) Q:'DFN  F IEN=0:0 S IEN=$O(^PS(52.5,"AF",DFN,IEN)) Q:'IEN  D PROCESS
"RTN","PSO525AP",26,0)
CLEAN I $G(DFN),'$O(^TMP($J,LIST,DFN,0)) S ^TMP($J,LIST,DFN,0)="-1^NO DATA FOUND"
"RTN","PSO525AP",27,0)
 I '$G(DFN),'$O(^TMP($J,LIST,0)) S ^TMP($J,LIST,0)="-1^NO DATA FOUND"
"RTN","PSO525AP",28,0)
 K DA,DR,DIC,PSOPOST,DIQ,LDATE
"RTN","PSO525AP",29,0)
 Q
"RTN","PSO525AP",30,0)
PROCESS ;
"RTN","PSO525AP",31,0)
 I $G(^PS(52.5,IEN,0))']"" S ^TMP($J,LIST,IEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO525AP",32,0)
 I $G(DFN),DFN'=$P($G(^PS(52.5,IEN,0)),"^",3) Q
"RTN","PSO525AP",33,0)
 K PSOPOST S DIC=52.5,DA=IEN,DR=".01;.02;.03;.05;2;9",DIQ="PSOPOST",DIQ(0)="IE" D EN^DIQ1
"RTN","PSO525AP",34,0)
 F DR=.01,.02,.03,.05,2,9 D
"RTN","PSO525AP",35,0)
 .I DR=.01 S ^TMP($J,LIST,"B",PSOPOST(52.5,DA,DR,"I"),IEN)=""
"RTN","PSO525AP",36,0)
 .I DR=.03 S ^TMP($J,LIST,PSOPOST(52.5,DA,.03,"I"),0)=$G(^TMP($J,LIST,PSOPOST(52.5,DA,.03,"I"),0))+1
"RTN","PSO525AP",37,0)
 .I PSOPOST(52.5,DA,DR,"E")'=PSOPOST(52.5,DA,DR,"I") S ^TMP($J,LIST,PSOPOST(52.5,DA,.03,"I"),IEN,DR)=PSOPOST(52.5,DA,DR,"I")_"^"_PSOPOST(52.5,DA,DR,"E") Q
"RTN","PSO525AP",38,0)
 .S ^TMP($J,LIST,PSOPOST(52.5,DA,.03,"I"),IEN,DR)=PSOPOST(52.5,DA,DR,"I")
"RTN","PSO525AP",39,0)
 K DA,DR,PSOPOST,DIC,DIQ
"RTN","PSO525AP",40,0)
 Q
"RTN","PSO525AP",41,0)
DATE ;date range
"RTN","PSO525AP",42,0)
 I $G(SDATE) S LDATE=SDATE-1 D  Q
"RTN","PSO525AP",43,0)
 .I $G(EDATE) F  S LDATE=$O(^PS(52.5,"C",LDATE)) Q:'LDATE!(LDATE>EDATE)  F IEN=0:0 S IEN=$O(^PS(52.5,"C",LDATE,IEN)) Q:'IEN  D PROCESS
"RTN","PSO525AP",44,0)
 .I '$G(EDATE) F  S LDATE=$O(^PS(52.5,"C",LDATE)) Q:'LDATE  F IEN=0:0 S IEN=$O(^PS(52.5,"C",LDATE,IEN)) Q:'IEN  D PROCESS
"RTN","PSO525AP",45,0)
 I $G(EDATE) S LDATE=0 F  S LDATE=$O(^PS(52.5,"C",LDATE)) Q:'LDATE!(LDATE>EDATE)  F IEN=0:0 S IEN=$O(^PS(52.5,"C",LDATE,IEN)) Q:'IEN  D PROCESS
"RTN","PSO525AP",46,0)
 Q
"RTN","PSO5291")
0^6^B2740068
"RTN","PSO5291",1,0)
PSO5291 ;BHM/DB - TPB Eligibility file API ; 18 JUL 05
"RTN","PSO5291",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**213**;DEC 1997
"RTN","PSO5291",3,0)
PSO(PSOIEN,PSOTXT,LIST) ;SDD 3.2.21
"RTN","PSO5291",4,0)
 ;PSOIEN - IEN
"RTN","PSO5291",5,0)
 ;PSOTXT - FREE TEXT ENTRY
"RTN","PSO5291",6,0)
 Q:$G(LIST)=""
"RTN","PSO5291",7,0)
 N DA,DIC,DR,DIQ,X K ^TMP($J,LIST),^UTILITY("DIQ1",$J)
"RTN","PSO5291",8,0)
 I $G(PSOIEN)="",$G(PSOTXT)="" S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSO5291",9,0)
 I $G(PSOIEN)]"" D  G Q
"RTN","PSO5291",10,0)
 .I '$G(^PS(52.91,PSOIEN,0)) S ^TMP($J,LIST,PSOIEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO5291",11,0)
 .S DA=PSOIEN D TMP
"RTN","PSO5291",12,0)
 I $G(PSOTXT)]"" D  G Q
"RTN","PSO5291",13,0)
 .S DA=$O(^DPT("B",PSOTXT,0)) I DA="" S ^TMP($J,LIST,PSOTXT,0)="-1^NO DATA FOUND" Q
"RTN","PSO5291",14,0)
 .D TMP
"RTN","PSO5291",15,0)
 Q
"RTN","PSO5291",16,0)
TMP S ^TMP($J,LIST,DA,0)=1
"RTN","PSO5291",17,0)
 S DIC=52.91,DR=".01:11",DIQ(0)="IE"
"RTN","PSO5291",18,0)
 D EN^DIQ1 I '$D(^UTILITY("DIQ1",$J)) S ^TMP($J,LIST,DA,0)="-1^NO DATA FOUND" Q
"RTN","PSO5291",19,0)
 F X=.01,1,2,3,4,5,6,7,8,9,10,11 D
"RTN","PSO5291",20,0)
 .S ^TMP($J,LIST,DA,X)=$G(^UTILITY("DIQ1",$J,52.91,DA,X,"I"))
"RTN","PSO5291",21,0)
 .S ^TMP($J,LIST,DA,X)=$S($G(^UTILITY("DIQ1",$J,52.91,DA,X,"E"))'="":^TMP($J,LIST,DA,X)_"^"_$G(^UTILITY("DIQ1",$J,52.91,DA,X,"E")),1:"")
"RTN","PSO5291",22,0)
 S DFN=$G(^UTILITY("DIQ1",$J,52.91,DA,.01,"I")),^TMP($J,LIST,"B",DFN,DA)=""
"RTN","PSO5291",23,0)
 K ^UTILITY("DIQ1",$J)
"RTN","PSO5291",24,0)
 Q
"RTN","PSO5291",25,0)
Q K DA,DFN,DIC,DIQ,DR,LIST,PSOIEN,PSOTXT,X Q
"RTN","PSO52AP1")
0^5^B6235999
"RTN","PSO52AP1",1,0)
PSO52AP1 ;BHAM ISC/SAB- encap II API to return Rx data ; 04/07/05 10:30 am
"RTN","PSO52AP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**213**;DEC 1997
"RTN","PSO52AP1",3,0)
 ;^PS(55 supported by DBIA 2228
"RTN","PSO52AP1",4,0)
 ;^PSDRUG supported by DBIA 221
"RTN","PSO52AP1",5,0)
 ;
"RTN","PSO52AP1",6,0)
 ;Rx profile called from PROF^PSO52API
"RTN","PSO52AP1",7,0)
 ;DFN: Patient's IEN 
"RTN","PSO52AP1",8,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSO52AP1",9,0)
 ;SDATE: Starting Suspense Date [optional]
"RTN","PSO52AP1",10,0)
 ;EDATE: Ending Suspense Date [optional]
"RTN","PSO52AP1",11,0)
 ;
"RTN","PSO52AP1",12,0)
 Q:$G(LIST)=""
"RTN","PSO52AP1",13,0)
 N DA,DR,PST,DIC,DIQ,DATE,IEN K ^TMP($J,LIST)
"RTN","PSO52AP1",14,0)
 Q:'$G(DFN)
"RTN","PSO52AP1",15,0)
 I '$O(^PS(55,DFN,"P",0)),$O(^PS(55,DFN,"ARC",0)) S ^TMP($J,LIST,DFN,"ARC",0)="PATIENT HAS ARCHIVED PRESCRIPTIONS"
"RTN","PSO52AP1",16,0)
 I $G(SDATE) S DATE=SDATE-1 D  G EX
"RTN","PSO52AP1",17,0)
 .I $G(EDATE) F  S DATE=$O(^PS(55,DFN,"P","A",DATE)) Q:'DATE!(DATE>EDATE)  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DATE,IEN)) Q:'IEN  D ND
"RTN","PSO52AP1",18,0)
 .I '$G(EDATE) F  S DATE=$O(^PS(55,DFN,"P","A",DATE)) Q:'DATE  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DATE,IEN)) Q:'IEN  D ND
"RTN","PSO52AP1",19,0)
 I $G(EDATE),'$G(SDATE) S DATE=DT-1 D  G EX
"RTN","PSO52AP1",20,0)
 .F  S DATE=$O(^PS(55,DFN,"P","A",DATE)) Q:'DATE!(DATE>EDATE)  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DATE,IEN)) Q:'IEN  D ND
"RTN","PSO52AP1",21,0)
 S DATE=DT-1 F  S DATE=$O(^PS(55,DFN,"P","A",DATE)) Q:'DATE  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DATE,IEN)) Q:'IEN  D ND
"RTN","PSO52AP1",22,0)
EX I $G(DFN),$G(LIST)]"",'$O(^TMP($J,LIST,DFN,0)) S ^TMP($J,LIST,DFN,0)="-1^NO PRESCRIPTION DATA FOUND"
"RTN","PSO52AP1",23,0)
 Q
"RTN","PSO52AP1",24,0)
ND ;returns data
"RTN","PSO52AP1",25,0)
 I DFN'=$P($G(^PSRX(IEN,0)),"^",2) Q
"RTN","PSO52AP1",26,0)
 I $G(^PSRX(IEN,0))']"" Q
"RTN","PSO52AP1",27,0)
 Q:$P($G(^PSRX(IEN,"STA")),"^")=13
"RTN","PSO52AP1",28,0)
 S ^TMP($J,LIST,DFN,0)=$G(^TMP($J,LIST,DFN,0))+1
"RTN","PSO52AP1",29,0)
 I DT>$P(^PSRX(IEN,2),"^",6),$P(^PSRX(IEN,"STA"),"^")<11 D
"RTN","PSO52AP1",30,0)
 .N PSOEXRX,PSOEXSTA,ORN,PIFN,PSUSD,PRFDT,PDA,PSDTEST
"RTN","PSO52AP1",31,0)
 .S PSOEXRX=IEN D EN2^PSOMAUEX K PSOEXRX,PSONM,PSONMX
"RTN","PSO52AP1",32,0)
 K PST S DIC=52,DA=IEN,DR=".01:9;10.3;10.6;11;16;17;100"
"RTN","PSO52AP1",33,0)
 S DIQ="PST",DIQ(0)="IE" D EN^DIQ1
"RTN","PSO52AP1",34,0)
 S ^TMP($J,LIST,"B",PST(52,DA,.01,"E"),IEN)=""
"RTN","PSO52AP1",35,0)
 F DR=.01,1,2,3,4,5,6,6.5,7,8,9,10.3,10.6,11,16,17,100 D
"RTN","PSO52AP1",36,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52AP1",37,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")
"RTN","PSO52AP1",38,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52AP1",39,0)
 Q
"RTN","PSO52API")
0^4^B83556883
"RTN","PSO52API",1,0)
PSO52API ;BHAM ISC/SAB- encap II API to return Rx data ; 04/07/05 10:30 am
"RTN","PSO52API",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**213**;DEC 1997
"RTN","PSO52API",3,0)
 ;^PS(55 supported by DBIA 2228
"RTN","PSO52API",4,0)
 ;^PSDRUG supported by DBIA 221
"RTN","PSO52API",5,0)
 ;^PS(50.7 supported by DBIA 2223
"RTN","PSO52API",6,0)
 ;
"RTN","PSO52API",7,0)
RX(DFN,LIST,IEN,RX,NODE,SDATE,EDATE) ;
"RTN","PSO52API",8,0)
 ;DFN: Patient's IEN 
"RTN","PSO52API",9,0)
 ;LIST: Subscript used in ^TMP
"RTN","PSO52API",10,0)
 ;IEN: Rx IEN
"RTN","PSO52API",11,0)
 ;RX#: External Rx number
"RTN","PSO52API",12,0)
 ;NODE: Determines data elements returned [optional]
"RTN","PSO52API",13,0)
 ;SDATE: Start Date [optional]
"RTN","PSO52API",14,0)
 ;EDATE: End Date [optional]
"RTN","PSO52API",15,0)
 ;
"RTN","PSO52API",16,0)
 Q:'$G(DFN)  Q:$G(LIST)=""
"RTN","PSO52API",17,0)
 N DA,DR,PST,DIC,DIQ,ND,LK K ^TMP($J,LIST) S ^TMP($J,LIST,DFN,0)=0
"RTN","PSO52API",18,0)
 I $G(IEN) D PROCESS G CLEAN
"RTN","PSO52API",19,0)
 I $G(RX)]"",'$G(IEN) S IEN=$O(^PSRX("B",RX,0)) D  G CLEAN
"RTN","PSO52API",20,0)
 .I 'IEN S ^TMP($J,LIST,DFN,0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",21,0)
 .D PROCESS
"RTN","PSO52API",22,0)
 D DATE
"RTN","PSO52API",23,0)
CLEAN F I=0:0 S I=$O(^TMP($J,LIST,DFN,I)) Q:'I  S ^TMP($J,LIST,DFN,0)=^TMP($J,LIST,DFN,0)+1
"RTN","PSO52API",24,0)
 I ^TMP($J,LIST,DFN,0)=0 S ^TMP($J,LIST,DFN,0)="-1^NO DATA FOUND"
"RTN","PSO52API",25,0)
 K DA,DR,DIC,ND,DAT,PST,LK,DIQ,DATE,I,X
"RTN","PSO52API",26,0)
 Q
"RTN","PSO52API",27,0)
PROCESS ;
"RTN","PSO52API",28,0)
 I DFN'=$P($G(^PSRX(IEN,0)),"^",2) S ^TMP($J,LIST,IEN,0)="-1^NO DATA FOUND (MISMATCHED PATIENT)" Q
"RTN","PSO52API",29,0)
 I $G(^PSRX(IEN,0))']"" S ^TMP($J,LIST,IEN,0)="-1^NO RX DATA FOUND" Q
"RTN","PSO52API",30,0)
 I $G(NODE)']"" D ZE,TW,TH,MI,ST,RF,CM,AT,LB,PT,SD,TB,OI S DAT="I" D IB Q
"RTN","PSO52API",31,0)
 D ST F LK=1:1:$L(NODE,",") S DAT=$P(NODE,",",LK),ND=$P(DAT,"^") D
"RTN","PSO52API",32,0)
 .I ND=0 D ZE Q
"RTN","PSO52API",33,0)
 .I ND=2 D ZE,TW Q
"RTN","PSO52API",34,0)
 .I ND=3 D TW,TH Q
"RTN","PSO52API",35,0)
 .I ND="R" D RF Q
"RTN","PSO52API",36,0)
 .I ND="I" D IB Q
"RTN","PSO52API",37,0)
 .I ND="P" D PT Q
"RTN","PSO52API",38,0)
 .I ND="O" D OI Q
"RTN","PSO52API",39,0)
 .I ND="T" D TB Q
"RTN","PSO52API",40,0)
 .I ND="L" D LB Q
"RTN","PSO52API",41,0)
 .I ND="S" D SD Q
"RTN","PSO52API",42,0)
 .I ND="M" D MI Q
"RTN","PSO52API",43,0)
 .I ND="C" D CM Q
"RTN","PSO52API",44,0)
 .I ND="A" D AT Q
"RTN","PSO52API",45,0)
 .I ND="ST" D ST Q
"RTN","PSO52API",46,0)
 .S ^TMP($J,LIST,DFN,IEN,"INVALID REQUEST",ND)="Invalid Data Requested"
"RTN","PSO52API",47,0)
 Q
"RTN","PSO52API",48,0)
ZE ;zero
"RTN","PSO52API",49,0)
 K PST S DIC=52,DA=IEN,DR=".01:9;10.3;10.6;11;16;17" D DIQ
"RTN","PSO52API",50,0)
 F DR=.01,1,2,3,4,5,6,6.5,7,8,9,10.3,10.6,11,16,17 D
"RTN","PSO52API",51,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",52,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")
"RTN","PSO52API",53,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",54,0)
 Q
"RTN","PSO52API",55,0)
TW ;two
"RTN","PSO52API",56,0)
 Q:'$D(^PSRX(IEN,2))
"RTN","PSO52API",57,0)
 K PST S DIC=52,DA=IEN,DR="20:31;32.1;32.2;32.3;104" D DIQ
"RTN","PSO52API",58,0)
 F DR=20,21,22,23,24,25,26,27,28,29,30,31,32.1,32.2,32.3,104 D
"RTN","PSO52API",59,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",60,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")
"RTN","PSO52API",61,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",62,0)
 Q
"RTN","PSO52API",63,0)
TH ;three
"RTN","PSO52API",64,0)
 Q:'$D(^PSRX(IEN,3))
"RTN","PSO52API",65,0)
 K PST S DIC=52,DA=IEN,DR="12;26.1;34.1;101;102;102.1;102.2;109;112" D DIQ
"RTN","PSO52API",66,0)
 F DR=12,26.1,34.1,101,102,102.1,102.2,109,112 D
"RTN","PSO52API",67,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",68,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")
"RTN","PSO52API",69,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",70,0)
 Q
"RTN","PSO52API",71,0)
MI ;sig
"RTN","PSO52API",72,0)
 I $P($G(^PSRX(IEN,"SIG")),"^",2) D  Q
"RTN","PSO52API",73,0)
 .I '$O(^PSRX(IEN,"SIG1",0)) S ^TMP($J,LIST,DFN,IEN,"M",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",74,0)
 .F I=0:0 S I=$O(^PSRX(IEN,"SIG1",I)) Q:'I  S ^TMP($J,LIST,DFN,IEN,"M",I,0)=^PSRX(IEN,"SIG1",I,0),^TMP($J,LIST,DFN,IEN,"M",0)=$G(^TMP($J,LIST,DFN,IEN,"M",0))+1
"RTN","PSO52API",75,0)
 I $P($G(^PSRX(IEN,"SIG")),"^")']"" S ^TMP($J,LIST,DFN,IEN,"M",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",76,0)
 S X=$P($G(^PSRX(IEN,"SIG")),"^") D SIG^PSOHELP S ^TMP($J,LIST,DFN,IEN,"M",1,0)=$E(INS1,2,9999999),^TMP($J,LIST,DFN,IEN,"M",0)=1
"RTN","PSO52API",77,0)
 K X,INS1
"RTN","PSO52API",78,0)
 Q
"RTN","PSO52API",79,0)
ST ;status
"RTN","PSO52API",80,0)
 I DT>$P(^PSRX(IEN,2),"^",6),$P(^PSRX(IEN,"STA"),"^")<11 D
"RTN","PSO52API",81,0)
 .N PSOEXRX,PSOEXSTA,ORN,PIFN,PSUSD,PRFDT,PDA,PSDTEST
"RTN","PSO52API",82,0)
 .S PSOEXRX=IEN D EN2^PSOMAUEX K PSOEXRX,PSONM,PSONMX
"RTN","PSO52API",83,0)
 K PST S DIC=52,DA=IEN,DR=".01;100" D DIQ
"RTN","PSO52API",84,0)
 S ^TMP($J,LIST,DFN,IEN,100)=PST(52,DA,100,"I")_"^"_PST(52,DA,100,"E")
"RTN","PSO52API",85,0)
 S ^TMP($J,LIST,"B",PST(52,DA,.01,"E"),IEN)=""
"RTN","PSO52API",86,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",87,0)
 Q
"RTN","PSO52API",88,0)
RF ;refill
"RTN","PSO52API",89,0)
 I '$O(^PSRX(IEN,1,0)) S ^TMP($J,LIST,DFN,IEN,"RF",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",90,0)
 I $P($G(DAT),"^",3) S DA(52.1)=$P(DAT,"^",3) D RFD K DA,DR,PST,DIC,DIQ Q
"RTN","PSO52API",91,0)
 F RF=0:0 S RF=$O(^PSRX(IEN,1,RF)) Q:'RF  S DA(52.1)=RF D RFD
"RTN","PSO52API",92,0)
 K DA,DR,PST,DIC,DIQ,RF
"RTN","PSO52API",93,0)
 Q
"RTN","PSO52API",94,0)
RFD K PST S DR(52.1)=".01:8;10.1;12;13;14;15;17",DIC=52,DA=IEN,DR=52 D DIQ
"RTN","PSO52API",95,0)
 I $P($G(DAT),"^",3),'$G(PST(52.1,DA(52.1),.01,"I")) S ^TMP($J,LIST,DFN,IEN,"RF",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",96,0)
 S ^TMP($J,LIST,DFN,IEN,"RF",0)=$G(^TMP($J,LIST,DFN,IEN,"RF",0))+1
"RTN","PSO52API",97,0)
 F DR=.01,1,1.1,1.2,2,3,4,5,6,7,8,10.1,12,13,14,15,17 D
"RTN","PSO52API",98,0)
 .I PST(52.1,DA(52.1),DR,"E")'=PST(52.1,DA(52.1),DR,"I") S ^TMP($J,LIST,DFN,IEN,"RF",DA(52.1),DR)=PST(52.1,DA(52.1),DR,"I")_"^"_PST(52.1,DA(52.1),DR,"E") Q
"RTN","PSO52API",99,0)
 .S ^TMP($J,LIST,DFN,IEN,"RF",DA(52.1),DR)=PST(52.1,DA(52.1),DR,"I")
"RTN","PSO52API",100,0)
 Q
"RTN","PSO52API",101,0)
PT ;par
"RTN","PSO52API",102,0)
 I '$O(^PSRX(IEN,"P",0)) S ^TMP($J,LIST,DFN,IEN,"P",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",103,0)
 F PT=0:0 S PT=$O(^PSRX(IEN,"P",PT)) Q:'PT  S DA(52.2)=PT D PTP
"RTN","PSO52API",104,0)
 K DA,DR,PST,DIC,DIQ,PT
"RTN","PSO52API",105,0)
 Q
"RTN","PSO52API",106,0)
PTP S ^TMP($J,LIST,DFN,IEN,"P",0)=$G(^TMP($J,LIST,DFN,IEN,"P",0))+1
"RTN","PSO52API",107,0)
 K PST S DR(52.2)=".01:8",DIC=52,DA=IEN,DR=60 D DIQ
"RTN","PSO52API",108,0)
 F DR=.01,.02,.03,.04,.05,.06,.08,.09,.041,.042,1,5,6,8 D
"RTN","PSO52API",109,0)
 .I PST(52.2,DA(52.2),DR,"E")'=PST(52.2,DA(52.2),DR,"I") S ^TMP($J,LIST,DFN,IEN,"P",DA(52.2),DR)=PST(52.2,DA(52.2),DR,"I")_"^"_PST(52.2,DA(52.2),DR,"E") Q
"RTN","PSO52API",110,0)
 .S ^TMP($J,LIST,DFN,IEN,"P",DA(52.2),DR)=PST(52.2,DA(52.2),DR,"I")
"RTN","PSO52API",111,0)
 Q
"RTN","PSO52API",112,0)
IB ;ib ori
"RTN","PSO52API",113,0)
 I $P($G(DAT),"^",2)="R" D IBR Q
"RTN","PSO52API",114,0)
 I $G(^PSRX(IEN,"IB"))']"" S ^TMP($J,LIST,DFN,IEN,"IB",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",115,0)
 K PST S DIC=52,DA=IEN,DR="105;106;106.5;106.6" D DIQ
"RTN","PSO52API",116,0)
 F DR=105,106,106.5,106.6 D
"RTN","PSO52API",117,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",118,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"E")
"RTN","PSO52API",119,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",120,0)
 I $P($G(DAT),"^",2)="" D IBR Q
"RTN","PSO52API",121,0)
 Q
"RTN","PSO52API",122,0)
IBR ;ib ref
"RTN","PSO52API",123,0)
 I '$O(^PSRX(IEN,1,0)) S ^TMP($J,LIST,DFN,IEN,"IB",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",124,0)
 I $P($G(DAT),"^",2)="R",$P($G(DAT),"^",3) S DA(52.1)=$P(DAT,"^",3) D IBS K DA,DR,PST,DIC,DIQ Q
"RTN","PSO52API",125,0)
 F IB=0:0 S IB=$O(^PSRX(IEN,1,IB)) Q:'IB  S DA(52.1)=IB D IBS
"RTN","PSO52API",126,0)
 I '$G(^TMP($J,LIST,DFN,IEN,"IB",0)) K ^TMP($J,LIST,DFN,IEN,"IB") S ^TMP($J,LIST,DFN,IEN,"IB",0)="-1^NO DATA FOUND"
"RTN","PSO52API",127,0)
 K DA,DR,PST,DIC,DIQ,IB
"RTN","PSO52API",128,0)
 Q
"RTN","PSO52API",129,0)
IBS I $P($G(DAT),"^",3),'$G(^PSRX(IEN,1,DA(52.1),"IB")) S ^TMP($J,LIST,DFN,IEN,"IB",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",130,0)
 I '$D(^PSRX(IEN,1,DA(52.1),"IB")) S ^TMP($J,LIST,DFN,IEN,"IB",DA(52.1),0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",131,0)
 K PST S DR(52.1)="9;9.1",DIC=52,DA=IEN,DR=52 D DIQ
"RTN","PSO52API",132,0)
 S ^TMP($J,LIST,DFN,IEN,"IB",0)=$G(^TMP($J,LIST,DFN,IEN,"IB",0))+1
"RTN","PSO52API",133,0)
 F DR=9,9.1 D
"RTN","PSO52API",134,0)
 .I PST(52.1,DA(52.1),DR,"E")'=PST(52.1,DA(52.1),DR,"I") S ^TMP($J,LIST,DFN,IEN,"IB",DA(52.1),DR)=PST(52.1,DA(52.1),DR,"I")_"^"_PST(52.1,DA(52.1),DR,"E") Q
"RTN","PSO52API",135,0)
 .S ^TMP($J,LIST,DFN,IEN,"IB",DA(52.1),DR)=PST(52.1,DA(52.1),DR,"I")
"RTN","PSO52API",136,0)
 Q
"RTN","PSO52API",137,0)
CM ;cmop
"RTN","PSO52API",138,0)
 I '$O(^PSRX(IEN,4,0)) S ^TMP($J,LIST,DFN,IEN,"C",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",139,0)
 F CM=0:0 S CM=$O(^PSRX(IEN,4,CM)) Q:'CM  S DA(52.01)=CM D CMP
"RTN","PSO52API",140,0)
 K DA,DR,PST,DIC,DIQ,CM
"RTN","PSO52API",141,0)
 Q
"RTN","PSO52API",142,0)
CMP S ^TMP($J,LIST,DFN,IEN,"C",0)=$G(^TMP($J,LIST,DFN,IEN,"C",0))+1
"RTN","PSO52API",143,0)
 K PST S DR(52.01)="2;3;4",DIC=52,DA=IEN,DR=400 D DIQ
"RTN","PSO52API",144,0)
 F DR=2,3,4 D
"RTN","PSO52API",145,0)
 .I PST(52.01,DA(52.01),DR,"E")'=PST(52.01,DA(52.01),DR,"I") S ^TMP($J,LIST,DFN,IEN,"C",DA(52.01),DR)=PST(52.01,DA(52.01),DR,"I")_"^"_PST(52.01,DA(52.01),DR,"E") Q
"RTN","PSO52API",146,0)
 .S ^TMP($J,LIST,DFN,IEN,"C",DA(52.01),DR)=PST(52.01,DA(52.01),DR,"I")
"RTN","PSO52API",147,0)
 Q
"RTN","PSO52API",148,0)
AT ;activity log
"RTN","PSO52API",149,0)
 I '$O(^PSRX(IEN,"A",0)) S ^TMP($J,LIST,DFN,IEN,"A",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",150,0)
 F AT=0:0 S AT=$O(^PSRX(IEN,"A",AT)) Q:'AT  S DA(52.3)=AT D ATP
"RTN","PSO52API",151,0)
 K DA,DR,PST,DIC,DIQ,AT
"RTN","PSO52API",152,0)
 Q
"RTN","PSO52API",153,0)
ATP K PST S DR(52.3)=".01;.02;.03;.04;.05" S DIC=52,DA=IEN,DR=40 D DIQ
"RTN","PSO52API",154,0)
 S ^TMP($J,LIST,DFN,IEN,"A",0)=$G(^TMP($J,LIST,DFN,IEN,"A",0))+1
"RTN","PSO52API",155,0)
 F DR=.01,.02,.03,.04,.05 D
"RTN","PSO52API",156,0)
 .I DR=.04 S ^TMP($J,LIST,DFN,IEN,"A",DA(52.3),DR)=PST(52.3,DA(52.3),DR,"E") Q
"RTN","PSO52API",157,0)
 .I PST(52.3,DA(52.3),DR,"E")'=PST(52.3,DA(52.3),DR,"I") S ^TMP($J,LIST,DFN,IEN,"A",DA(52.3),DR)=PST(52.3,DA(52.3),DR,"I")_"^"_PST(52.3,DA(52.3),DR,"E") Q
"RTN","PSO52API",158,0)
 .S ^TMP($J,LIST,DFN,IEN,"A",DA(52.3),DR)=PST(52.3,DA(52.3),DR,"I")
"RTN","PSO52API",159,0)
 Q
"RTN","PSO52API",160,0)
LB ;label log
"RTN","PSO52API",161,0)
 I '$O(^PSRX(IEN,"L",0)) S ^TMP($J,LIST,DFN,IEN,"L",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",162,0)
 F LB=0:0 S LB=$O(^PSRX(IEN,"L",LB)) Q:'LB  S DA(52.032)=LB D LBP
"RTN","PSO52API",163,0)
 K DA,DR,PST,DIC,DIQ,LB
"RTN","PSO52API",164,0)
 Q
"RTN","PSO52API",165,0)
LBP S ^TMP($J,LIST,DFN,IEN,"L",0)=$G(^TMP($J,LIST,DFN,IEN,"L",0))+1
"RTN","PSO52API",166,0)
 K PST S DR(52.032)=".01;1;2;3;4" S DIC=52,DA=IEN,DR=32 D DIQ
"RTN","PSO52API",167,0)
 F DR=.01,1,2,3,4 D
"RTN","PSO52API",168,0)
 .I DR=1 S ^TMP($J,LIST,DFN,IEN,"L",DA(52.032),DR)=PST(52.032,DA(52.032),DR,"E") Q
"RTN","PSO52API",169,0)
 .I PST(52.032,DA(52.032),DR,"E")'=PST(52.032,DA(52.032),DR,"I") S ^TMP($J,LIST,DFN,IEN,"L",DA(52.032),DR)=PST(52.032,DA(52.032),DR,"I")_"^"_PST(52.032,DA(52.032),DR,"E") Q
"RTN","PSO52API",170,0)
 .S ^TMP($J,LIST,DFN,IEN,"L",DA(52.032),DR)=PST(52.032,DA(52.032),DR,"I")
"RTN","PSO52API",171,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",172,0)
 Q
"RTN","PSO52API",173,0)
SD ;sand
"RTN","PSO52API",174,0)
 K PST S DIC=52,DA=IEN,DR="301;302;303" D DIQ F DR=301,302,303 D
"RTN","PSO52API",175,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",176,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")
"RTN","PSO52API",177,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",178,0)
 Q
"RTN","PSO52API",179,0)
TB ;tpb
"RTN","PSO52API",180,0)
 K PST S DIC=52,DA=IEN,DR=201 D DIQ
"RTN","PSO52API",181,0)
 I $G(PST(52,DA,DR,"E"))']"" S ^TMP($J,LIST,DFN,DA,DR)="" Q
"RTN","PSO52API",182,0)
 S ^TMP($J,LIST,DFN,DA,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E")
"RTN","PSO52API",183,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",184,0)
 Q
"RTN","PSO52API",185,0)
OI ;orderable item
"RTN","PSO52API",186,0)
 K PST S DIC=52,DA=IEN,DR=39.2 D DIQ
"RTN","PSO52API",187,0)
 I $G(PST(52,DA,DR,"I"))']"" S ^TMP($J,LIST,DFN,DA,"OI")="-1^NO DATA FOUND" Q
"RTN","PSO52API",188,0)
 S ^TMP($J,LIST,DFN,DA,"OI",DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E")
"RTN","PSO52API",189,0)
 S DIC=50.7,DA=PST(52,DA,DR,"I"),DR=.02,DIQ(0)="IE"  D DIQ
"RTN","PSO52API",190,0)
 S ^TMP($J,LIST,DFN,IEN,"OI",39.2)=^TMP($J,LIST,DFN,IEN,"OI",39.2)_"^"_PST(50.7,DA,DR,"I")_"^"_PST(50.7,DA,DR,"E")
"RTN","PSO52API",191,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",192,0)
 Q
"RTN","PSO52API",193,0)
DATE ;date range
"RTN","PSO52API",194,0)
 I $G(SDATE) S DATE=SDATE-1 D  Q
"RTN","PSO52API",195,0)
 .I $G(EDATE) D  Q
"RTN","PSO52API",196,0)
 ..F  S DATE=$O(^PS(55,DFN,"P","A",DATE)) Q:'DATE!(DATE>EDATE)  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DATE,IEN)) Q:'IEN  D:$P($G(^PSRX(IEN,"STA")),"^")'=13 PROCESS
"RTN","PSO52API",197,0)
 .F  S DATE=$O(^PS(55,DFN,"P","A",DATE)) Q:'DATE  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DATE,IEN)) Q:'IEN  D:$P($G(^PSRX(IEN,"STA")),"^")'=13 PROCESS
"RTN","PSO52API",198,0)
 I $G(EDATE),'$G(SDATE) S DATE=DT-1 D  Q
"RTN","PSO52API",199,0)
 .F  S DATE=$O(^PS(55,DFN,"P","A",DATE)) Q:'DATE!(DATE>EDATE)  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DATE,IEN)) Q:'IEN  D:$P($G(^PSRX(IEN,"STA")),"^")'=13 PROCESS
"RTN","PSO52API",200,0)
 S DATE=DT-1  F  S DATE=$O(^PS(55,DFN,"P","A",DATE)) Q:'DATE  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DATE,IEN)) Q:'IEN  D:$P($G(^PSRX(IEN,"STA")),"^")'=13 PROCESS
"RTN","PSO52API",201,0)
 Q
"RTN","PSO52API",202,0)
PROF(DFN,LIST,SDATE,EDATE) ;
"RTN","PSO52API",203,0)
 D ^PSO52AP1
"RTN","PSO52API",204,0)
 Q
"RTN","PSO52API",205,0)
DIQ ;process fields
"RTN","PSO52API",206,0)
 S DIQ="PST",DIQ(0)="IE" D EN^DIQ1
"RTN","PSO52API",207,0)
 Q
"RTN","PSO53")
0^7^B2836960
"RTN","PSO53",1,0)
PSO53 ;BHM/DB - API FOR PATIENT STATUS FILE ;8 JUN 05
"RTN","PSO53",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**213**;DEC 1997
"RTN","PSO53",3,0)
PSO(PSOIEN,PSOTXT,LIST) ;
"RTN","PSO53",4,0)
 N DA,DIQ,DR,X,I,DIC
"RTN","PSO53",5,0)
 I $G(LIST)'="" K ^TMP($J,LIST)
"RTN","PSO53",6,0)
 I $G(PSOIEN)="",$G(PSOTXT)="",$G(LIST)="" Q
"RTN","PSO53",7,0)
 I $G(PSOIEN)="",$G(PSOTXT)="",$G(LIST)'="" S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSO53",8,0)
 I $G(LIST)="" Q
"RTN","PSO53",9,0)
 I $G(PSOIEN)'>0,$G(PSOTXT)'="" S DA=$O(^PS(53,"B",PSOTXT,0)) I DA'>0 S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSO53",10,0)
 I $G(DA)'>0,$G(PSOIEN)>0 S DA=PSOIEN
"RTN","PSO53",11,0)
 K ^UTILITY("DIQ1",$J),DIC S DIC=53,DR=".01;2;3;4;5;6;15;16",DIQ(0)="IE" D EN^DIQ1
"RTN","PSO53",12,0)
 I '$D(^UTILITY("DIQ1",$J)) S ^TMP($J,LIST,PSOIEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO53",13,0)
 F X=.01,2,3,4,5,6,15,16 S ^TMP($J,LIST,DA,X)=^UTILITY("DIQ1",$J,53,DA,X,"I")
"RTN","PSO53",14,0)
 S PSOTXT=$G(^UTILITY("DIQ1",$J,53,DA,.01,"E"))
"RTN","PSO53",15,0)
 F X=5,6,15,16 S ^TMP($J,LIST,DA,X)=$S(^UTILITY("DIQ1",$J,LIST,DA,X,"E")'="":^TMP($J,LIST,DA,X)_"^"_^UTILITY("DIQ1",$J,53,DA,X,"E"),1:"")
"RTN","PSO53",16,0)
 K ^UTILITY("DIQ1",$J) S ^TMP($J,LIST,"B",PSOTXT,DA)="",^TMP($J,LIST,DA,0)=$G(^TMP($J,LIST,DA,0))+1
"RTN","PSO53",17,0)
 K DA,DIC,DIQ,DA,DR,X Q
"RTN","PSO59")
0^8^B3416907
"RTN","PSO59",1,0)
PSO59 ;BHM/DB - Outpatient Site File API ;1 JUL 05
"RTN","PSO59",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**213**;DEC 1997
"RTN","PSO59",3,0)
PSS(PSOIEN,PSOTXT,LIST) ;
"RTN","PSO59",4,0)
 N DA,DIC,DIQ,DR,X,I
"RTN","PSO59",5,0)
 I $G(PSOIEN)="",$G(PSOTXT)="" Q
"RTN","PSO59",6,0)
 I $G(LIST)="" Q
"RTN","PSO59",7,0)
 K ^TMP($J,LIST) S:$G(PSOIEN)>0 ^TMP($J,LIST,PSOIEN,0)=0
"RTN","PSO59",8,0)
 I $G(PSOIEN)>0,'$D(^PS(59,PSOIEN,0)) S ^TMP($J,LIST,PSOIEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO59",9,0)
 I $G(PSOTXT)'="",'$D(^PS(59,"B",PSOTXT)),$G(PSOIEN)>0 S ^TMP($J,LIST,PSOIEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO59",10,0)
 S DA=$S($G(PSOIEN)]"":PSOIEN,1:$O(^PS(59,"B",PSOTXT,0)))
"RTN","PSO59",11,0)
 I $G(DA)'>0 S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSO59",12,0)
 K ^UTILITY("DIQ1",$J),DIC S DIC=59,DR=".01;.02;.05;.06;.07;.08;100;1003",DIQ(0)="IE" D EN^DIQ1
"RTN","PSO59",13,0)
 I '$D(^UTILITY("DIQ1",$J)) S ^TMP($J,LIST,PSOIEN,0)="-1^NO DATA FOUND" Q
"RTN","PSO59",14,0)
 F X=.01,.02,.05,.06,.07,.08,100,1003 D
"RTN","PSO59",15,0)
 .I $G(^UTILITY("DIQ1",$J,59,DA,X,"I"))'=$G(^UTILITY("DIQ1",$J,59,DA,X,"E")) S ^TMP($J,LIST,DA,X)=$G(^UTILITY("DIQ1",$J,59,DA,X,"I"))_"^"_$G(^UTILITY("DIQ1",$J,59,DA,X,"E")) Q
"RTN","PSO59",16,0)
 .S ^TMP($J,LIST,DA,X)=$G(^UTILITY("DIQ1",$J,59,DA,X,"I"))
"RTN","PSO59",17,0)
 S PSOTXT=$G(^UTILITY("DIQ1",$J,59,DA,.01,"E")) S ^TMP($J,LIST,"B",PSOTXT,DA)=""
"RTN","PSO59",18,0)
 S ^TMP($J,LIST,DA,0)=$G(^TMP($J,LIST,DA,0))+1
"RTN","PSO59",19,0)
 K DA,DIC,DIQ,DR,PSOIEN,PSOTXT
"RTN","PSO59",20,0)
 Q
"VER")
8.0^22.0
"BLD",5743,6)
^198
**END**
**END**
