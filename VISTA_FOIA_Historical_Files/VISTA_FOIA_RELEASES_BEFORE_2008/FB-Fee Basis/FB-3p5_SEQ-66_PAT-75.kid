Released FB*3.5*75 SEQ #66
Extracted from mail message
**KIDS**:FB*3.5*75^

**INSTALL NAME**
FB*3.5*75
"BLD",4798,0)
FB*3.5*75^FEE BASIS^0^3040202^y
"BLD",4798,4,0)
^9.64PA^^
"BLD",4798,"KRN",0)
^9.67PA^8989.52^19
"BLD",4798,"KRN",.4,0)
.4
"BLD",4798,"KRN",.401,0)
.401
"BLD",4798,"KRN",.402,0)
.402
"BLD",4798,"KRN",.403,0)
.403
"BLD",4798,"KRN",.5,0)
.5
"BLD",4798,"KRN",.84,0)
.84
"BLD",4798,"KRN",3.6,0)
3.6
"BLD",4798,"KRN",3.8,0)
3.8
"BLD",4798,"KRN",9.2,0)
9.2
"BLD",4798,"KRN",9.8,0)
9.8
"BLD",4798,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4798,"KRN",9.8,"NM",1,0)
FBAACO0^^0^B33494272
"BLD",4798,"KRN",9.8,"NM","B","FBAACO0",1)

"BLD",4798,"KRN",19,0)
19
"BLD",4798,"KRN",19.1,0)
19.1
"BLD",4798,"KRN",101,0)
101
"BLD",4798,"KRN",409.61,0)
409.61
"BLD",4798,"KRN",771,0)
771
"BLD",4798,"KRN",870,0)
870
"BLD",4798,"KRN",8989.51,0)
8989.51
"BLD",4798,"KRN",8989.52,0)
8989.52
"BLD",4798,"KRN",8994,0)
8994
"BLD",4798,"KRN","B",.4,.4)

"BLD",4798,"KRN","B",.401,.401)

"BLD",4798,"KRN","B",.402,.402)

"BLD",4798,"KRN","B",.403,.403)

"BLD",4798,"KRN","B",.5,.5)

"BLD",4798,"KRN","B",.84,.84)

"BLD",4798,"KRN","B",3.6,3.6)

"BLD",4798,"KRN","B",3.8,3.8)

"BLD",4798,"KRN","B",9.2,9.2)

"BLD",4798,"KRN","B",9.8,9.8)

"BLD",4798,"KRN","B",19,19)

"BLD",4798,"KRN","B",19.1,19.1)

"BLD",4798,"KRN","B",101,101)

"BLD",4798,"KRN","B",409.61,409.61)

"BLD",4798,"KRN","B",771,771)

"BLD",4798,"KRN","B",870,870)

"BLD",4798,"KRN","B",8989.51,8989.51)

"BLD",4798,"KRN","B",8989.52,8989.52)

"BLD",4798,"KRN","B",8994,8994)

"MBREQ")
0
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950605
"PKG",60,22,1,"PAH",1,0)
75^3040202
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","FBAACO0")
0^1^B33494272
"RTN","FBAACO0",1,0)
FBAACO0 ;AISC/GRR-DISPLAY PATIENT ADDRESS DATA AND EDIT ;7/13/2003
"RTN","FBAACO0",2,0)
 ;;3.5;FEE BASIS;**4,38,52,57,61,75**;JAN 30, 1995
"RTN","FBAACO0",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACO0",4,0)
 S FBMST=$S(FBTT=1:"Y",1:""),FBTTYPE="A",FBFDC=""
"RTN","FBAACO0",5,0)
 N FBEDPTAD S (FBEDPTAD(1),FBEDPTAD(2))=0
"RTN","FBAACO0",6,0)
 W @IOF,"Patient:  ",$P(^DPT(DFN,0),"^") S (Y(0),HY(0))=$G(^DPT(DFN,.11)) I Y(0)="" W !,*7,"No Address information for this patient!" G EDIT
"RTN","FBAACO0",7,0)
 S VAPA("P")="" D ADD^VADPT
"RTN","FBAACO0",8,0)
 S FBEDPTAD(1)=$$ISCCADR()
"RTN","FBAACO0",9,0)
 S FBEDPTAD(2)="N"
"RTN","FBAACO0",10,0)
 I $$CCADR(2)
"RTN","FBAACO0",11,0)
 W !!,"Patient's Permanent address:"
"RTN","FBAACO0",12,0)
 F Z=1:1:3 I VAPA(Z)]"" W !?2,"Address Line ",Z,":",?18,VAPA(Z)
"RTN","FBAACO0",13,0)
 W !?2,"City:",?18,VAPA(4),!?2,"State:",?18,$P(VAPA(5),U,2)
"RTN","FBAACO0",14,0)
 W !?2,"Zip:",?18,$S(+$G(VAPA(11)):$P(VAPA(11),U,2),1:VAPA(6)),!?2,"County",?18,$P(VAPA(7),U,2)
"RTN","FBAACO0",15,0)
 K VAPA,VAERR
"RTN","FBAACO0",16,0)
RD W ! S DIR("A")="Want to edit Permanent Address data",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR  S:Y&('$D(DIRUT)) FBEDPTAD(2)="Y" G EDIT
"RTN","FBAACO0",17,0)
 Q
"RTN","FBAACO0",18,0)
EDIT I $G(FBEDPTAD(2))'="N" W !! S HY(0)=$G(^DPT(DFN,.11)),DA=DFN,DIC="^DPT(",DIE=DIC,DR="[FBAA ADDRESS EDIT]" D LOCK^FBUCUTL("^DPT(",DFN) G:'FBLOCK RD D ^DIE L -^DPT(DFN)
"RTN","FBAACO0",19,0)
 I $$EDTCCADR()=0 I FBTT'=1 I FBEDPTAD(2)="N" Q
"RTN","FBAACO0",20,0)
MRA I FBTT=1!($G(^DPT(DFN,.11))'=$G(HY(0))) S FBD1=FTP D ENT^FBAAAUT K FBD1
"RTN","FBAACO0",21,0)
 Q
"RTN","FBAACO0",22,0)
FEE ;calculates amount paid based on fee schedule
"RTN","FBAACO0",23,0)
 N FB1725
"RTN","FBAACO0",24,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAACO0",25,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAACO0",26,0)
 S FBFY=FY-1
"RTN","FBAACO0",27,0)
 S (FBFSAMT,FBFSUSD)="",FBAMTPD=$S($G(FBAMTPD)>0:FBAMTPD,1:"")
"RTN","FBAACO0",28,0)
 ; if amount not passed then use fee schedule
"RTN","FBAACO0",29,0)
 I '$G(FBAMTPD) D
"RTN","FBAACO0",30,0)
 . N FBX
"RTN","FBAACO0",31,0)
 . S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBAADT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME))
"RTN","FBAACO0",32,0)
 . ;
"RTN","FBAACO0",33,0)
 . I '$G(FBAAMM1) D
"RTN","FBAACO0",34,0)
 . . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAACO0",35,0)
 . E  W !?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAACO0",36,0)
 . ;
"RTN","FBAACO0",37,0)
 . I $P($G(FBX),U)]"" D
"RTN","FBAACO0",38,0)
 . . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAACO0",39,0)
 . . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAACO0",40,0)
 . . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAACO0",41,0)
 . . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAACO0",42,0)
 . E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAACO0",43,0)
 . ;
"RTN","FBAACO0",44,0)
 . I FB1725 D
"RTN","FBAACO0",45,0)
 . . W !!?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAACO0",46,0)
 . . I FBFSAMT D
"RTN","FBAACO0",47,0)
 . . . S FBFSAMT=$J(FBFSAMT*.7,0,2)
"RTN","FBAACO0",48,0)
 . . . W !?2,"  Therefore, fee schedule amount reduced to $",FBFSAMT," (70%)."
"RTN","FBAACO0",49,0)
 . ;
"RTN","FBAACO0",50,0)
 . I $G(FBUNITS)>1 D
"RTN","FBAACO0",51,0)
 . . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAACO0",52,0)
 . . Q:FBFSAMT'>0
"RTN","FBAACO0",53,0)
 . . N FBFSUNIT
"RTN","FBAACO0",54,0)
 . . ; determine if fee schedule can be multipled by units
"RTN","FBAACO0",55,0)
 . . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBAADT>3040930):1,1:0)
"RTN","FBAACO0",56,0)
 . . I FBFSUNIT D
"RTN","FBAACO0",57,0)
 . . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAACO0",58,0)
 . . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAACO0",59,0)
 . . E  D
"RTN","FBAACO0",60,0)
 . . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted for units."
"RTN","FBAACO0",61,0)
 . ;
"RTN","FBAACO0",62,0)
 . I '$G(FBAAMM1) D
"RTN","FBAACO0",63,0)
 . . ; set default amount paid to lesser of amt claimed (J) or fee sched.
"RTN","FBAACO0",64,0)
 . . S FBAMTPD=$S(FBFSAMT>J:J,FBFSAMT>0:FBFSAMT,1:"")
"RTN","FBAACO0",65,0)
 . ;
"RTN","FBAACO0",66,0)
 . W !
"RTN","FBAACO0",67,0)
 ;
"RTN","FBAACO0",68,0)
AMTPD W !,"AMOUNT PAID: "_$S(FBAMTPD]"":FBAMTPD_"//",1:"") R X:DTIME S:X="" X=FBAMTPD G KILL:$E(X)="^",HELP1:$E(X)="?" S:X["$" X=$P(X,"$",2) I +X'=X&(X'?.N.1".".2N)!(+X>+J)!(+X<0) G HELPPD
"RTN","FBAACO0",69,0)
 I FBAMTPD]"",X>FBAMTPD&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) D  G AMTPD
"RTN","FBAACO0",70,0)
 .W !!,*7,"You must be a holder of the 'FBAASUPERVISOR' key to",!,"exceed the Fee Schedule. Entering an up-arrow ('^') will",!,"delete the payment or you can accept the default.",!
"RTN","FBAACO0",71,0)
 S FBAMTPD=X Q
"RTN","FBAACO0",72,0)
KILL W !!,*7,"Entering an '^' will delete this payment!" R !,?5,"Do you want to delete? No//",X:DTIME S:X="" X="N" D VALCK^FBAAUTL1 G KILL:'VAL,AMTPD:"Nn"[$E(X)
"RTN","FBAACO0",73,0)
 S DIK="^FBAAC("_DA(3)_",1,"_DA(2)_",1,"_DA(1)_",1," D WAIT^DICD,^DIK W !,?3,"<DELETED>" K DA,J,K,DIC,DIK,FBAACP,FBAADT,FBX S Y=0,FBDL=1 Q
"RTN","FBAACO0",74,0)
HELP1 W !!,"Enter a dollar amount that does not exceed the amount claimed.",!,"Entering an '^' will delete the payment.",!
"RTN","FBAACO0",75,0)
 I FBAMTPD>0 W !,"Only the holder of the 'FBAASUPERVISOR' key may exceed the",!,"Fee Schedule.",!
"RTN","FBAACO0",76,0)
 G AMTPD
"RTN","FBAACO0",77,0)
HELPPD W !!,*7,"Enter a dollar amount that does not exceed the amount claimed.",! G AMTPD
"RTN","FBAACO0",78,0)
 Q
"RTN","FBAACO0",79,0)
 ;print Confidential Communication address
"RTN","FBAACO0",80,0)
 ;ADD^VADPT must be invoked before this call
"RTN","FBAACO0",81,0)
 ;FBDFN -patient's DFN
"RTN","FBAACO0",82,0)
 ;FBSTPOS - position to start print
"RTN","FBAACO0",83,0)
 ;returns 0 if there is no active CC address
"RTN","FBAACO0",84,0)
 ;returns 1 if active
"RTN","FBAACO0",85,0)
CCADR(FBSTPOS) ;
"RTN","FBAACO0",86,0)
 N FBACT
"RTN","FBAACO0",87,0)
 S FBACT=0
"RTN","FBAACO0",88,0)
 I '$D(VAPA(12)) Q 0  ;if D ADD^VADPT was not invoked before
"RTN","FBAACO0",89,0)
 I 'VAERR D
"RTN","FBAACO0",90,0)
 . S FBACT=$$ACTIVECC()
"RTN","FBAACO0",91,0)
 . Q:'FBACT
"RTN","FBAACO0",92,0)
 . W !!,"Confidential Communication address until: "_$P($G(VAPA(21)),U,2)
"RTN","FBAACO0",93,0)
 . I $G(VAPA(13))]"" W !?FBSTPOS,"Line 1: ",$G(VAPA(13))
"RTN","FBAACO0",94,0)
 . I $G(VAPA(14))]"" W " Line 2: ",$G(VAPA(14))
"RTN","FBAACO0",95,0)
 . I $G(VAPA(15))]"" W !?FBSTPOS,"Line 3: ",$G(VAPA(15))
"RTN","FBAACO0",96,0)
 . W !?FBSTPOS,"City:",?9,$S($G(VAPA(16))]"":$G(VAPA(16)),1:"     ")
"RTN","FBAACO0",97,0)
 . W ?40,"State:",?47,$S($P($G(VAPA(17)),U,2)]"":$P($G(VAPA(17)),U,2),1:"  ")
"RTN","FBAACO0",98,0)
 . W !?FBSTPOS,"Zip:",?9,$P($G(VAPA(18)),U,2)
"RTN","FBAACO0",99,0)
 . W ?20,"County:",?28,$P($G(VAPA(19)),U,2)
"RTN","FBAACO0",100,0)
 Q $G(FBACT)
"RTN","FBAACO0",101,0)
 ;
"RTN","FBAACO0",102,0)
 ;is called after ADD^VADPT to verify whether confidential address is 
"RTN","FBAACO0",103,0)
 ;active or not to encapsulate the logic related to status of CC address
"RTN","FBAACO0",104,0)
 ;input:  VAPA
"RTN","FBAACO0",105,0)
ACTIVECC() ;
"RTN","FBAACO0",106,0)
 Q (+$G(VAPA(12))=1)&($P($G(VAPA(22,3)),"^",3)="Y")
"RTN","FBAACO0",107,0)
 ;
"RTN","FBAACO0",108,0)
 ;edit confidential address
"RTN","FBAACO0",109,0)
 ;returns 1 if CC address has been edited
"RTN","FBAACO0",110,0)
 ;otherwise - 0
"RTN","FBAACO0",111,0)
EDTCCADR() ;
"RTN","FBAACO0",112,0)
 Q:'$G(DFN) 0
"RTN","FBAACO0",113,0)
 I FBEDPTAD(1)=0 D
"RTN","FBAACO0",114,0)
 . N VAPA S VAPA("P")="" D ADD^VADPT S FBEDPTAD(1)=$$ISCCADR()
"RTN","FBAACO0",115,0)
 I FBEDPTAD(1)'="N" D
"RTN","FBAACO0",116,0)
 . W:FBEDPTAD(1)'="B" !!,"WARNING: The Confidential address is NOT active for the Billing Category."
"RTN","FBAACO0",117,0)
 . S DIR("A")="Want to edit Confidential Address data"
"RTN","FBAACO0",118,0)
 E  S DIR("A")="Want to add Confidential Address data"
"RTN","FBAACO0",119,0)
 W ! S DIR("B")="No",DIR(0)="Y"
"RTN","FBAACO0",120,0)
 D ^DIR K DIR
"RTN","FBAACO0",121,0)
 Q:($D(DIRUT)) 0
"RTN","FBAACO0",122,0)
 ;Registration API
"RTN","FBAACO0",123,0)
 I Y D QUES^DGRPU1(+DFN,"ADD4") Q 1
"RTN","FBAACO0",124,0)
 Q 0
"RTN","FBAACO0",125,0)
 ;
"RTN","FBAACO0",126,0)
 ;returns "B" if patient has any (active or inactive) CC address and billing category
"RTN","FBAACO0",127,0)
 ;returns "Y" if patient has any (active or inactive) CC address with another category
"RTN","FBAACO0",128,0)
 ;otherwise returns "N"
"RTN","FBAACO0",129,0)
ISCCADR() ;
"RTN","FBAACO0",130,0)
 Q:($P($G(VAPA(22,3)),"^",3)="Y") "B"
"RTN","FBAACO0",131,0)
 Q:'$O(VAPA(22,0)) "N"
"RTN","FBAACO0",132,0)
 Q "Y"
"RTN","FBAACO0",133,0)
 ;
"RTN","FBAACO0",134,0)
 ;FBAACO0
"VER")
8.0^22.0
**END**
**END**
