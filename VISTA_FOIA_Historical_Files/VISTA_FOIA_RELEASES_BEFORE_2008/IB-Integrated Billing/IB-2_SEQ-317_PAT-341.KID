Released IB*2*341 SEQ #317
Extracted from mail message
**KIDS**:IB*2.0*341^

**INSTALL NAME**
IB*2.0*341
"BLD",6621,0)
IB*2.0*341^INTEGRATED BILLING^0^3060817^y
"BLD",6621,1,0)
^^5^5^3060816^^^^
"BLD",6621,1,1,0)
This patch will correct a problem where the nightly billing job
"BLD",6621,1,2,0)
was failing when voice activated records from Radiology had
"BLD",6621,1,3,0)
triggered an entry into billing file #350 and had left the 
"BLD",6621,1,4,0)
USER ADDING ENTRY field null.  The changes in this patch will
"BLD",6621,1,5,0)
trap that condition and store the Postmaster DUZ rather than null.
"BLD",6621,4,0)
^9.64PA^^
"BLD",6621,"KRN",0)
^9.67PA^8989.52^19
"BLD",6621,"KRN",.4,0)
.4
"BLD",6621,"KRN",.401,0)
.401
"BLD",6621,"KRN",.402,0)
.402
"BLD",6621,"KRN",.403,0)
.403
"BLD",6621,"KRN",.5,0)
.5
"BLD",6621,"KRN",.84,0)
.84
"BLD",6621,"KRN",3.6,0)
3.6
"BLD",6621,"KRN",3.8,0)
3.8
"BLD",6621,"KRN",9.2,0)
9.2
"BLD",6621,"KRN",9.8,0)
9.8
"BLD",6621,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",6621,"KRN",9.8,"NM",1,0)
IBECEAU3^^0^B6694889
"BLD",6621,"KRN",9.8,"NM",2,0)
IBECEAU4^^0^B16312791
"BLD",6621,"KRN",9.8,"NM",3,0)
IBACUS2^^0^B33456496
"BLD",6621,"KRN",9.8,"NM",4,0)
IBAMTS^^0^B18301561
"BLD",6621,"KRN",9.8,"NM","B","IBACUS2",3)

"BLD",6621,"KRN",9.8,"NM","B","IBAMTS",4)

"BLD",6621,"KRN",9.8,"NM","B","IBECEAU3",1)

"BLD",6621,"KRN",9.8,"NM","B","IBECEAU4",2)

"BLD",6621,"KRN",19,0)
19
"BLD",6621,"KRN",19.1,0)
19.1
"BLD",6621,"KRN",101,0)
101
"BLD",6621,"KRN",409.61,0)
409.61
"BLD",6621,"KRN",771,0)
771
"BLD",6621,"KRN",870,0)
870
"BLD",6621,"KRN",8989.51,0)
8989.51
"BLD",6621,"KRN",8989.52,0)
8989.52
"BLD",6621,"KRN",8994,0)
8994
"BLD",6621,"KRN","B",.4,.4)

"BLD",6621,"KRN","B",.401,.401)

"BLD",6621,"KRN","B",.402,.402)

"BLD",6621,"KRN","B",.403,.403)

"BLD",6621,"KRN","B",.5,.5)

"BLD",6621,"KRN","B",.84,.84)

"BLD",6621,"KRN","B",3.6,3.6)

"BLD",6621,"KRN","B",3.8,3.8)

"BLD",6621,"KRN","B",9.2,9.2)

"BLD",6621,"KRN","B",9.8,9.8)

"BLD",6621,"KRN","B",19,19)

"BLD",6621,"KRN","B",19.1,19.1)

"BLD",6621,"KRN","B",101,101)

"BLD",6621,"KRN","B",409.61,409.61)

"BLD",6621,"KRN","B",771,771)

"BLD",6621,"KRN","B",870,870)

"BLD",6621,"KRN","B",8989.51,8989.51)

"BLD",6621,"KRN","B",8989.52,8989.52)

"BLD",6621,"KRN","B",8994,8994)

"BLD",6621,"QUES",0)
^9.62^^
"BLD",6621,"REQB",0)
^9.611^3^3
"BLD",6621,"REQB",1,0)
IB*2.0*183^2
"BLD",6621,"REQB",2,0)
IB*2.0*240^2
"BLD",6621,"REQB",3,0)
IB*2.0*312^2
"BLD",6621,"REQB","B","IB*2.0*183",1)

"BLD",6621,"REQB","B","IB*2.0*240",2)

"BLD",6621,"REQB","B","IB*2.0*312",3)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
341^3060817
"PKG",200,22,1,"PAH",1,1,0)
^^5^5^3060817
"PKG",200,22,1,"PAH",1,1,1,0)
This patch will correct a problem where the nightly billing job
"PKG",200,22,1,"PAH",1,1,2,0)
was failing when voice activated records from Radiology had
"PKG",200,22,1,"PAH",1,1,3,0)
triggered an entry into billing file #350 and had left the 
"PKG",200,22,1,"PAH",1,1,4,0)
USER ADDING ENTRY field null.  The changes in this patch will
"PKG",200,22,1,"PAH",1,1,5,0)
trap that condition and store the Postmaster DUZ rather than null.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","IBACUS2")
0^3^B33456496^B33239765
"RTN","IBACUS2",1,0)
IBACUS2 ;ALB/CPM - TRICARE FISCAL INTERMEDIARY RX CLAIMS ;02-AUG-96
"RTN","IBACUS2",2,0)
 ;;2.0;INTEGRATED BILLING;**52,91,51,240,341**;21-MAR-94
"RTN","IBACUS2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBACUS2",4,0)
 ;
"RTN","IBACUS2",5,0)
BILL(IBKEY,IBCHTRN) ; Create the TRICARE claim for the Fiscal Intermediary.
"RTN","IBACUS2",6,0)
 ;  Input:    IBKEY  --  1 ; 2, where
"RTN","IBACUS2",7,0)
 ;                         1 = Pointer to the prescription in file #52
"RTN","IBACUS2",8,0)
 ;                         2 = Pointer to the refill in file #52.1, or
"RTN","IBACUS2",9,0)
 ;                             0 for the original fill
"RTN","IBACUS2",10,0)
 ;          IBCHTRN  --  Pointer to the transaction entry in file #351.5
"RTN","IBACUS2",11,0)
 ;
"RTN","IBACUS2",12,0)
 N IBQUERY
"RTN","IBACUS2",13,0)
 S IBY=1 K IBDRX
"RTN","IBACUS2",14,0)
 I '$G(IBKEY) G BILLQ
"RTN","IBACUS2",15,0)
 I $G(^PSRX(+IBKEY,0))="" G BILLQ
"RTN","IBACUS2",16,0)
 S IBAMT=$P($G(^IBA(351.5,+IBCHTRN,2)),"^",5) ;  FI portion of charge
"RTN","IBACUS2",17,0)
 I 'IBAMT G BILLQ
"RTN","IBACUS2",18,0)
 ;
"RTN","IBACUS2",19,0)
 ; - derive minimal variables
"RTN","IBACUS2",20,0)
 I '$$CHECK^IBECEAU(0) S IBY="-1^IB009" G BILLQ
"RTN","IBACUS2",21,0)
 S IBSERV=$P($G(^IBE(350.1,1,0)),"^",4)
"RTN","IBACUS2",22,0)
 I '$$SERV^IBARX1(IBSERV) S IBY="-1^IB003" G BILLQ
"RTN","IBACUS2",23,0)
 ;
"RTN","IBACUS2",24,0)
 ; - establish a stub claim/receivable
"RTN","IBACUS2",25,0)
 D SET^IBR I IBY<0 G BILLQ
"RTN","IBACUS2",26,0)
 ;
"RTN","IBACUS2",27,0)
 ; - set up the following variables for claim establishment:
"RTN","IBACUS2",28,0)
 ;      .01  BILL #
"RTN","IBACUS2",29,0)
 ;      .17  ORIG CLAIM
"RTN","IBACUS2",30,0)
 ;      .2   AUTO?
"RTN","IBACUS2",31,0)
 ;      .02  DFN
"RTN","IBACUS2",32,0)
 ;      .06  TIMEFRAME
"RTN","IBACUS2",33,0)
 ;      .07  RATE TYPE
"RTN","IBACUS2",34,0)
 ;      .18  SC AT TIME?
"RTN","IBACUS2",35,0)
 ;      .04  LOCATION (WILL NEED DIVISION THAT DISPENSED)
"RTN","IBACUS2",36,0)
 ;      .05  BILL CLASSIF  (3)
"RTN","IBACUS2",37,0)
 ;      .03  EVT DATE (FILL DATE)
"RTN","IBACUS2",38,0)
 ;      151  BILL FROM
"RTN","IBACUS2",39,0)
 ;      152  BILL TO
"RTN","IBACUS2",40,0)
 K IB
"RTN","IBACUS2",41,0)
 S (IB(.02),DFN,IBDFN)=+$P($G(^PSRX(+IBKEY,0)),"^",2)
"RTN","IBACUS2",42,0)
 I 'DFN S IBY="-1^IB002" G BILLQ
"RTN","IBACUS2",43,0)
 S IB(.07)=$O(^DGCR(399.3,"B","TRICARE",0))
"RTN","IBACUS2",44,0)
 I 'IB(.07) S IBY="-1^IB059" G BILLQ
"RTN","IBACUS2",45,0)
 I $$TRANS^PSOCPTRI(+IBKEY,+$P(IBKEY,";",2),.IBDRX)<0 S IBY="-1^IB010" G BILLQ
"RTN","IBACUS2",46,0)
 ;
"RTN","IBACUS2",47,0)
 S IBIFN=PRCASV("ARREC")
"RTN","IBACUS2",48,0)
 S IB(.01)=$P(PRCASV("ARBIL"),"-",2)
"RTN","IBACUS2",49,0)
 S IB(.17)=""
"RTN","IBACUS2",50,0)
 S IB(.2)=0
"RTN","IBACUS2",51,0)
 S IB(.06)=1
"RTN","IBACUS2",52,0)
 S IB(.18)=$$SC^IBCU3(DFN)
"RTN","IBACUS2",53,0)
 S IB(.04)=1 ;  how can I get Division?  RON...
"RTN","IBACUS2",54,0)
 S IB(.05)=3
"RTN","IBACUS2",55,0)
 S (IB(.03),IB(151),IB(152))=IBDRX("FDT")
"RTN","IBACUS2",56,0)
 ;
"RTN","IBACUS2",57,0)
 ; - set 362.4 node to rx#^p50^days sup^fill date^qty^ndc
"RTN","IBACUS2",58,0)
 S IB(362.4,+IBKEY,1)=IBDRX("RX#")_"^"_+$P($G(^PSRX(+IBKEY,0)),"^",6)_"^"_IBDRX("SUP")_"^"_IBDRX("FDT")_"^"_IBDRX("QTY")_"^"_IBDRX("NDC")
"RTN","IBACUS2",59,0)
 ;
"RTN","IBACUS2",60,0)
 ; - call the autobiller module to create the claim with a default
"RTN","IBACUS2",61,0)
 ;   diagnosis and procedure for prescriptions
"RTN","IBACUS2",62,0)
 D EN^IBCD3(.IBQUERY)
"RTN","IBACUS2",63,0)
 D CLOSE^IBSDU(.IBQUERY)
"RTN","IBACUS2",64,0)
 ;
"RTN","IBACUS2",65,0)
 ; - add the payor (fiscal intermediary) to the claim
"RTN","IBACUS2",66,0)
 S IBCDFN=$$CUS^IBACUS(DFN)
"RTN","IBACUS2",67,0)
 I 'IBCDFN S IBY="-1^IB054" G BILLQ
"RTN","IBACUS2",68,0)
 S IBINS=+$G(^DPT(DFN,.312,IBCDFN,0))
"RTN","IBACUS2",69,0)
 S DIE="^DGCR(399,",DA=IBIFN,DR="112////"_IBCDFN
"RTN","IBACUS2",70,0)
 D ^DIE K DA,DR,DIE,DGRVRCAL
"RTN","IBACUS2",71,0)
 ;
"RTN","IBACUS2",72,0)
 ; - add charge to the claim
"RTN","IBACUS2",73,0)
 S IBRVCD=$P($G(^DIC(36,IBINS,0)),"^",15) ;                                      rx refill rev code
"RTN","IBACUS2",74,0)
 I IBRVCD="" S IBRVCD=$P($G(^IBE(363.1,+$P($G(^IBE(350.9,1,9)),U,12),0)),U,5) ;  CS def rev code
"RTN","IBACUS2",75,0)
 I IBRVCD="" S X=250 ;                                                           gen'l rx rev code
"RTN","IBACUS2",76,0)
 ;
"RTN","IBACUS2",77,0)
 S IBBS=$P($G(^IBE(363.1,+$P($G(^IBE(350.9,1,9)),U,12),0)),U,6) ;                CS def bedsection
"RTN","IBACUS2",78,0)
 S IBUNITS=1 ;                                    one unit
"RTN","IBACUS2",79,0)
 S IBCPT=$P($G(^IBE(350.9,1,1)),"^",30) ;         def rx refill cpt
"RTN","IBACUS2",80,0)
 S IBDIV="" ;                                     division
"RTN","IBACUS2",81,0)
 S IBAA=0 ;                                       not auto calc charges
"RTN","IBACUS2",82,0)
 S IBTYPE=3 ;                                     rx type
"RTN","IBACUS2",83,0)
 S IBITEM="" ;                                    charge item link
"RTN","IBACUS2",84,0)
 ;
"RTN","IBACUS2",85,0)
 ;
"RTN","IBACUS2",86,0)
 S X=$$ADDRC^IBCRBF(IBIFN,IBRVCD,IBBS,IBAMT,IBUNITS,IBCPT,IBDIV,IBAA,IBTYPE,IBITEM)
"RTN","IBACUS2",87,0)
 I X<0 S IBY="-1^^Unable to add Revenue Code charge to claim." G BILLQ
"RTN","IBACUS2",88,0)
 ;
"RTN","IBACUS2",89,0)
 ; - update the authorize/print fields
"RTN","IBACUS2",90,0)
 S DIE="^DGCR(399,",DA=IBIFN,DR="9////1" D ^DIE K DA,DR,DIE
"RTN","IBACUS2",91,0)
 S DIE="^DGCR(399,",DA=IBIFN,DR="12////"_DT D ^DIE K DA,DR,DIE
"RTN","IBACUS2",92,0)
 ;
"RTN","IBACUS2",93,0)
 ; - pass the claim to AR
"RTN","IBACUS2",94,0)
 D GVAR^IBCBB,ARRAY^IBCBB1,^PRCASVC6,REL^PRCASVC:PRCASV("OKAY")
"RTN","IBACUS2",95,0)
 I 'PRCASV("OKAY") S IBY="-1^^Unable to establish receivable in AR." G BILLQ
"RTN","IBACUS2",96,0)
 ;
"RTN","IBACUS2",97,0)
 ; - update the rx transaction file (#351.5)
"RTN","IBACUS2",98,0)
 S DA=IBCHTRN,DIE="^IBA(351.5,",DR=".09////"_IBIFN D ^DIE K DA,DIE,DR
"RTN","IBACUS2",99,0)
 ;
"RTN","IBACUS2",100,0)
 ; - update the AR status to Active
"RTN","IBACUS2",101,0)
 S PRCASV("STATUS")=16
"RTN","IBACUS2",102,0)
 D STATUS^PRCASVC1
"RTN","IBACUS2",103,0)
 ;
"RTN","IBACUS2",104,0)
BILLQ I IBY<0 D ERRMSG^IBACVA2(1,2)
"RTN","IBACUS2",105,0)
 K IBRVCD,IBBS,IBUNITS,IBCPT,IBDIV,IBAA,IBTYPE,IBITEM,IBAMT
"RTN","IBACUS2",106,0)
 K IBSERV,IBFAC,IBSITE,IBDRX,IB,IBCDFN,IBINS,IBIDS,IBIFN,IBDFN
"RTN","IBACUS2",107,0)
 K PRCASV,PRCAERR
"RTN","IBACUS2",108,0)
 Q
"RTN","IBACUS2",109,0)
 ;
"RTN","IBACUS2",110,0)
 ;
"RTN","IBACUS2",111,0)
CANC(IBCHTRN) ; Cancel the claim to the Fiscal Intermediary.
"RTN","IBACUS2",112,0)
 ;  Input:  IBCHTRN  --  Pointer to the transaction entry in file #351.5
"RTN","IBACUS2",113,0)
 ;
"RTN","IBACUS2",114,0)
 S IBIFN=+$P($G(^IBA(351.5,IBCHTRN,0)),"^",9)
"RTN","IBACUS2",115,0)
 I 'IBIFN G CANCQ
"RTN","IBACUS2",116,0)
 F I=0,"S" S IB(I)=$G(^DGCR(399,IBIFN,I))
"RTN","IBACUS2",117,0)
 I IB(0)="" G CANCQ
"RTN","IBACUS2",118,0)
 I +$P(IB("S"),U,16),$P(IB("S"),U,17)]"" G CANCQ
"RTN","IBACUS2",119,0)
 ;
"RTN","IBACUS2",120,0)
 S DA=IBIFN,DR="16////1;19////PRESCRIPTION REVERSED",DIE="^DGCR(399,"
"RTN","IBACUS2",121,0)
 D ^DIE K DA,DIE,DR
"RTN","IBACUS2",122,0)
 ;
"RTN","IBACUS2",123,0)
 ; - decrease out the receivable in AR
"RTN","IBACUS2",124,0)
 S DFN=+$P(IB(0),"^",2)
"RTN","IBACUS2",125,0)
 S IB("U1")=$G(^DGCR(399,IBIFN,"U1"))
"RTN","IBACUS2",126,0)
 S IBIL=$P($G(^PRCA(430,IBIFN,0)),"^")
"RTN","IBACUS2",127,0)
 S IBCHG=$S(IB("U1")']"":0,$P(IB("U1"),"^",1)]"":$P(IB("U1"),"^",1),1:0)
"RTN","IBACUS2",128,0)
 S IBCRES="TRICARE PRESCRIPTION REVERSED"
"RTN","IBACUS2",129,0)
 ;
"RTN","IBACUS2",130,0)
 S X="21^"_IBCHG_"^"_IBIL_"^"_$S('DUZ:.5,1:DUZ)_"^"_DT_"^"_IBCRES ; *341
"RTN","IBACUS2",131,0)
 D ^PRCASER1
"RTN","IBACUS2",132,0)
 I Y<0 S IBY=Y D BULL
"RTN","IBACUS2",133,0)
 ;
"RTN","IBACUS2",134,0)
CANCQ K DFN,IBIFN,IB,IBIL,IBCHG,IBCRES,IBY,X,Y
"RTN","IBACUS2",135,0)
 Q
"RTN","IBACUS2",136,0)
 ;
"RTN","IBACUS2",137,0)
 ;
"RTN","IBACUS2",138,0)
BULL ; Generate a bulletin if there is an error in canceling the claim.
"RTN","IBACUS2",139,0)
 K IBT S IBPT=$$PT^IBEFUNC(DFN)
"RTN","IBACUS2",140,0)
 S XMSUB=$E($P(IBPT,"^"),1,14)_"  "_$P(IBPT,"^",3)_" - ERROR ENCOUNTERED"
"RTN","IBACUS2",141,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="IBT("
"RTN","IBACUS2",142,0)
 S XMY(DUZ)=""
"RTN","IBACUS2",143,0)
 S IBGRP=$P($G(^XMB(3.8,+$P($G(^IBE(350.9,1,1)),"^",7),0)),"^")
"RTN","IBACUS2",144,0)
 I IBGRP]"" S XMY("G."_IBGRP_"@"_^XMB("NETNAME"))=""
"RTN","IBACUS2",145,0)
 ;
"RTN","IBACUS2",146,0)
 S IBT(1)="An error occurred while cancelling the Pharmacy claim to the TRICARE"
"RTN","IBACUS2",147,0)
 S IBT(2)="fiscal intermediary for the following patient:"
"RTN","IBACUS2",148,0)
 S IBT(3)=" " S IBC=3
"RTN","IBACUS2",149,0)
 S IBDUZ=DUZ D PAT^IBAERR1
"RTN","IBACUS2",150,0)
 S IBC=IBC+1,IBT(IBC)="   Bill #: "_IBIL
"RTN","IBACUS2",151,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACUS2",152,0)
 S IBC=IBC+1,IBT(IBC)="The following error was encountered:"
"RTN","IBACUS2",153,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACUS2",154,0)
 D ERR^IBAERR1
"RTN","IBACUS2",155,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACUS2",156,0)
 S IBC=IBC+1,IBT(IBC)="Please review the circumstances surrounding this error and decrease"
"RTN","IBACUS2",157,0)
 S IBC=IBC+1,IBT(IBC)="out this receivable in Accounts Receivable if necessary."
"RTN","IBACUS2",158,0)
 ;
"RTN","IBACUS2",159,0)
 D ^XMD
"RTN","IBACUS2",160,0)
 K IBC,IBDUZ,IBT,IBPT,IBGRP,XMDUZ,XMTEXT,XMSUB,XMY
"RTN","IBACUS2",161,0)
 Q
"RTN","IBAMTS")
0^4^B18301561^B17712149
"RTN","IBAMTS",1,0)
IBAMTS ;ALB/CPM - APPOINTMENT EVENT DRIVER INTERFACE ;20-JUL-93
"RTN","IBAMTS",2,0)
 ;;2.0;INTEGRATED BILLING;**52,115,132,153,164,156,171,247,312,341**;21-MAR-94
"RTN","IBAMTS",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBAMTS",4,0)
 ;
"RTN","IBAMTS",5,0)
EN ; Main interface entry point.
"RTN","IBAMTS",6,0)
 ;
"RTN","IBAMTS",7,0)
 N IBSWINFO S IBSWINFO=$$SWSTAT^IBBAPI()                   ;IB*2.0*312
"RTN","IBAMTS",8,0)
 I '$G(DUZ) D DUZ^XUP(.5)                                  ;IB*2.0*341 Setting of DUZ covered by IA 4129
"RTN","IBAMTS",9,0)
 ;
"RTN","IBAMTS",10,0)
 S IBJOB=5,IBWHER="",IBDUZ=DUZ,IBY=1
"RTN","IBAMTS",11,0)
 ; Do Transfer Pricing
"RTN","IBAMTS",12,0)
 I '+IBSWINFO D ^IBATEO                                    ;IB*2.0*312
"RTN","IBAMTS",13,0)
 ; Check Encounter Related to LTC
"RTN","IBAMTS",14,0)
 N IBALTC D EN^IBAECO
"RTN","IBAMTS",15,0)
 I '$$BILST^DGMTUB(DFN) G ENQ ; never Means Test billable
"RTN","IBAMTS",16,0)
 I '$$CHECK^IBECEAU(0) D ^IBAERR1 G ENQ ; can't set vital parameters
"RTN","IBAMTS",17,0)
 ;
"RTN","IBAMTS",18,0)
 ; - process all parent outpatient encounters
"RTN","IBAMTS",19,0)
 S IBORG=0 F  S IBORG=$O(^TMP("SDEVT",$J,SDHDL,IBORG)) Q:'IBORG  D
"RTN","IBAMTS",20,0)
 .S IBOE=0 F  S IBOE=$O(^TMP("SDEVT",$J,SDHDL,IBORG,"SDOE",IBOE)) Q:'IBOE  S IBEVT=$G(^(IBOE,0,"AFTER")),IBEV0=$G(^("BEFORE")) D
"RTN","IBAMTS",21,0)
 ..;
"RTN","IBAMTS",22,0)
 ..S IBDT=$S(IBEVT:+IBEVT,1:+IBEV0),IBDAT=$P(IBDT,".")
"RTN","IBAMTS",23,0)
 ..; Do NOT PROCESS on VistA if IBDAT>=Switch Eff Date    ;CCR-930
"RTN","IBAMTS",24,0)
 ..I +IBSWINFO,(IBDAT+1)>$P(IBSWINFO,"^",2) Q             ;IB*2.0*312
"RTN","IBAMTS",25,0)
 ..;
"RTN","IBAMTS",26,0)
 ..S IBAPTY=$S(IBEVT:$P(IBEVT,"^",10),1:$P(IBEV0,"^",10))
"RTN","IBAMTS",27,0)
 ..S IBBILLED=$$BFO^IBECEAU(DFN,IBDAT),IBY=1
"RTN","IBAMTS",28,0)
 ..;
"RTN","IBAMTS",29,0)
 ..; - if C&P encounter, cancel charges for the day and quit
"RTN","IBAMTS",30,0)
 ..I IBAPTY=1!(IBALTC) D:IBBILLED  Q
"RTN","IBAMTS",31,0)
 ...S IBCRES=+$O(^IBE(350.3,"B",$S(IBALTC:"BILLED LTC CHARGE",1:"COMP & PENSION VISIT RECORDED"),0))
"RTN","IBAMTS",32,0)
 ...S:'IBCRES IBCRES=23 S IBWHER=""
"RTN","IBAMTS",33,0)
 ...D CANCH^IBECEAU4(IBBILLED,IBCRES,0)
"RTN","IBAMTS",34,0)
 ..;
"RTN","IBAMTS",35,0)
 ..; - quit if there are any C&P encounters on the visit date
"RTN","IBAMTS",36,0)
 ..Q:$$CNP^IBECEAU(DFN,IBDAT)
"RTN","IBAMTS",37,0)
 ..;
"RTN","IBAMTS",38,0)
 ..; - quit if there are any LTC encounters on the visit date
"RTN","IBAMTS",39,0)
 ..Q:$$LTCENC^IBAECU(DFN,IBDAT)
"RTN","IBAMTS",40,0)
 ..;
"RTN","IBAMTS",41,0)
 ..; - don't process child events
"RTN","IBAMTS",42,0)
 ..I IBEVT]"" Q:$P(IBEVT,"^",6)
"RTN","IBAMTS",43,0)
 ..I IBEVT="",IBEV0]"" Q:$P(IBEV0,"^",6)
"RTN","IBAMTS",44,0)
 ..;
"RTN","IBAMTS",45,0)
 ..; - get statuses
"RTN","IBAMTS",46,0)
 ..S IBAST=+$P(IBEVT,"^",12),IBBST=+$P(IBEV0,"^",12)
"RTN","IBAMTS",47,0)
 ..;
"RTN","IBAMTS",48,0)
 ..; - do either NEW or UPDATED processing
"RTN","IBAMTS",49,0)
 ..I IBAST=2,IBBST'=2 D NEW^IBAMTS1 Q
"RTN","IBAMTS",50,0)
 ..D UPD^IBAMTS2
"RTN","IBAMTS",51,0)
 ;
"RTN","IBAMTS",52,0)
ENQ K IBJOB,IBWHER,IBORG,IBOE,IBEVT,IBEV0,IBAST,IBBST,IBDUZ,IBY
"RTN","IBAMTS",53,0)
 K IBDT,IBDAT,IBAPTY,IBBILLED,IBSERV,IBSITE,IBFAC,IBCRES,IBRTED
"RTN","IBAMTS",54,0)
 Q
"RTN","IBAMTS",55,0)
 ;
"RTN","IBAMTS",56,0)
BULL ; Send bulletin when classified patients are billed stops which
"RTN","IBAMTS",57,0)
 ; are exempt from the classification process.
"RTN","IBAMTS",58,0)
 N IBT,IBC,IBPT,IBDUZ,IBX S IBPT=$$PT^IBEFUNC(DFN),IBX=$$CLTY
"RTN","IBAMTS",59,0)
 S XMSUB="CHARGE FOR STOP CODE EXEMPT FROM CLASSIFICATION"
"RTN","IBAMTS",60,0)
 S IBT(1)="The following patient, who "_$S(IBX="SC":"has a service connected disability,",IBX="CV":"is Combat Veteran",1:"has claimed exposure to "_IBX_",")
"RTN","IBAMTS",61,0)
 S IBT(2)="was billed the Means Test outpatient copay for a stop code which is"
"RTN","IBAMTS",62,0)
 S IBT(3)="exempt from classification:"
"RTN","IBAMTS",63,0)
 S IBT(4)=" " S IBC=4
"RTN","IBAMTS",64,0)
 S IBDUZ=DUZ D PAT^IBAERR1
"RTN","IBAMTS",65,0)
 S Y=IBDAT D DD^%DT
"RTN","IBAMTS",66,0)
 S IBC=IBC+1,IBT(IBC)="Stop Date: "_Y
"RTN","IBAMTS",67,0)
 S IBC=IBC+1,IBT(IBC)="Stop Code: "_$P($G(^DIC(40.7,+$P(IBEVT,"^",3),0)),"^")
"RTN","IBAMTS",68,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBAMTS",69,0)
 S IBC=IBC+1,IBT(IBC)="Please check this patient's medical record to determine if the care provided"
"RTN","IBAMTS",70,0)
 S IBC=IBC+1,IBT(IBC)="was related to the "_$S(IBX="SC":"SC disability",IBX="CV":"Combat Veteran status",1:"claimed exposure")_", and, if related, cancel the charge."
"RTN","IBAMTS",71,0)
 D MAIL^IBAERR1
"RTN","IBAMTS",72,0)
 K X,Y,XMSUB,XMY,XMTEXT,XMDUZ
"RTN","IBAMTS",73,0)
 Q
"RTN","IBAMTS",74,0)
 ;
"RTN","IBAMTS",75,0)
CLTY() ; Return the classification type
"RTN","IBAMTS",76,0)
 N IBARR,Y D CL^SDCO21(DFN,IBDAT,"",.IBARR) S Y=""
"RTN","IBAMTS",77,0)
 I $D(IBARR(3)) S Y="SC" G CLTYQ
"RTN","IBAMTS",78,0)
 I $D(IBARR(7)),+$$CVEDT^IBACV(DFN,IBDAT) S Y="CV" G CLTYQ
"RTN","IBAMTS",79,0)
 I $D(IBARR(1)) S Y="Agent Orange" G CLTYQ
"RTN","IBAMTS",80,0)
 I $D(IBARR(2)) S Y="Ionizing Radiation" G CLTYQ
"RTN","IBAMTS",81,0)
 I $D(IBARR(4)) S Y="Environmental Contaminants" G CLTYQ
"RTN","IBAMTS",82,0)
 I $D(IBARR(5)) S Y="Military Sexual Trauma" G CLTYQ
"RTN","IBAMTS",83,0)
 I $D(IBARR(6)) S Y="Head/Neck Cancer" G CLTYQ
"RTN","IBAMTS",84,0)
CLTYQ Q Y
"RTN","IBECEAU3")
0^1^B6694889^B6414442
"RTN","IBECEAU3",1,0)
IBECEAU3 ;ALB/CPM-Cancel/Edit/Add... Add New IB Action;11-MAR-93
"RTN","IBECEAU3",2,0)
 ;;2.0;INTEGRATED BILLING;**132,150,167,183,341**;21-MAR-94
"RTN","IBECEAU3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBECEAU3",4,0)
 ;
"RTN","IBECEAU3",5,0)
ADD ; Add a new Integrated Billing Action entry.
"RTN","IBECEAU3",6,0)
 ;   Input:     DFN  --  Pointer to patient in file #2
"RTN","IBECEAU3",7,0)
 ;           IBATYP  --  Pointer to Action Type in file #350.1
"RTN","IBECEAU3",8,0)
 ;           IBUNIT  --  Number of units of charge
"RTN","IBECEAU3",9,0)
 ;            IBCHG  --  Total charge
"RTN","IBECEAU3",10,0)
 ;           IBDESC  --  Charge description
"RTN","IBECEAU3",11,0)
 ;           IBSITE  --  Pointer to the facility in file #4
"RTN","IBECEAU3",12,0)
 ;            IBFAC  --  Facility number
"RTN","IBECEAU3",13,0)
 ;             IBFR  --  Bill From date
"RTN","IBECEAU3",14,0)
 ;             IBTO  --  Bill To date
"RTN","IBECEAU3",15,0)
 ;             IBSL  --  Softlink  [OPTIONAL]
"RTN","IBECEAU3",16,0)
 ;          IBPARNT  --  Pointer to parent entry in #350  [OPTIONAL]
"RTN","IBECEAU3",17,0)
 ;           IBEVDA  --  Pointer to parent event in #350  [OPTIONAL], or
"RTN","IBECEAU3",18,0)
 ;                   --  "*" to set ibevda=ibn
"RTN","IBECEAU3",19,0)
 ;           IBEVDT  --  Event Date  [OPTIONAL]
"RTN","IBECEAU3",20,0)
 ;             IBIL  --  Bill Number  [OPTIONAL]
"RTN","IBECEAU3",21,0)
 ;           IBCRES  --  Pointer to canc. reason in #350.3  [OPTIONAL]
"RTN","IBECEAU3",22,0)
 ;             IBXA  --  IB Action billing group  [OPTIONAL]
"RTN","IBECEAU3",23,0)
 ;            IBJOB  --  Option being executed  [OPTIONAL]
"RTN","IBECEAU3",24,0)
 ;            IBCVA  --  CHAMPVA Admission date [OPTIONAL]
"RTN","IBECEAU3",25,0)
 ;         IBSTOPDA  --  Pointer to clinic stop entry in #352.5 [OPTIONAL]
"RTN","IBECEAU3",26,0)
 ;                       (used for new outpatient appts created in IB)
"RTN","IBECEAU3",27,0)
 ;           IBGMTR  --  GMT Related flag [OPTIONAL]
"RTN","IBECEAU3",28,0)
 ;
"RTN","IBECEAU3",29,0)
 ;  Output:     IBN  --  Internal number of new entry in file #350
"RTN","IBECEAU3",30,0)
 ;
"RTN","IBECEAU3",31,0)
 N DA,DIK,IBASTR,IBND,Y
"RTN","IBECEAU3",32,0)
 D ADD^IBAUTL I Y<1 S IBY=Y G ADDQ
"RTN","IBECEAU3",33,0)
 S:$G(IBEVDA)="*" IBEVDA=IBN
"RTN","IBECEAU3",34,0)
 S IBND=DFN_"^"_IBATYP_"^"_$S($G(IBSL):IBSL,1:"350:"_IBN)_"^1^"_IBUNIT_"^"_IBCHG_"^"_IBDESC_"^"_$S($D(IBPARNT):IBPARNT,1:IBN)_"^"_$G(IBCRES)_"^"_$G(IBIL)_"^^"_IBFAC
"RTN","IBECEAU3",35,0)
 I IBDESC["RX COPAY",$D(IBAM) S $P(IBND,"^",18)=IBAM,$P(^IBAM(354.71,IBAM,0),"^",6)="350:"_IBN ; mark 354.71 entry back and forth
"RTN","IBECEAU3",36,0)
 I IBDESC'["RX COPAY" S IBND=IBND_"^"_IBFR_"^"_IBTO_"^"_$G(IBEVDA)_$S($G(IBEVDT):"^"_IBEVDT,$G(IBXA)=1!($G(IBXA)=4)!($G(IBJOB)=5):"^"_IBFR,1:"")
"RTN","IBECEAU3",37,0)
 I $G(IBSTOPDA) S $P(IBND,"^",19)=IBSTOPDA
"RTN","IBECEAU3",38,0)
 S $P(^IB(IBN,0),"^",2,20)=IBND
"RTN","IBECEAU3",39,0)
 I $G(IBGMTR) S $P(^IB(IBN,0),"^",21)=1 ; GMT Related
"RTN","IBECEAU3",40,0)
 ; DUZ may be null if this code is called by a process started by an HL7 multi-threaded listener
"RTN","IBECEAU3",41,0)
 ; if this condition occurs the approved fix is to use the Postmaster IEN.  2/27/06, IB*2.0*341
"RTN","IBECEAU3",42,0)
 D NOW^%DTC S $P(^IB(IBN,1),"^")=$S(DUZ:DUZ,1:.5),$P(^(1),"^",3,5)=$S(DUZ:DUZ,1:.5)_"^"_%_$S($G(IBCVA):"^"_IBCVA,1:"")
"RTN","IBECEAU3",43,0)
 S DIK="^IB(",DA=IBN D IX1^DIK
"RTN","IBECEAU3",44,0)
ADDQ Q
"RTN","IBECEAU3",45,0)
 ;
"RTN","IBECEAU3",46,0)
CTBB ; Charge to be billed
"RTN","IBECEAU3",47,0)
 ; Check Outpat. Fee Service less than 20% Outpat Co Pay
"RTN","IBECEAU3",48,0)
 D:$G(IBAFEE) FEE^IBECEAU5 Q:IBY<1
"RTN","IBECEAU3",49,0)
 W !!,"Charge to be billed --> $",$J(IBCHG,0,2)
"RTN","IBECEAU3",50,0)
 Q
"RTN","IBECEAU3",51,0)
 ;
"RTN","IBECEAU3",52,0)
NODED ; Could not determine the Medicare Deductible amount.
"RTN","IBECEAU3",53,0)
 W !,*7,"The Medicare Deductible Amount for ",$$DAT1^IBOUTL(IBCLDT)," could not be determined."
"RTN","IBECEAU3",54,0)
 W !,"You should determine the cause of this problem before proceeding."
"RTN","IBECEAU3",55,0)
 S IBY=-1
"RTN","IBECEAU3",56,0)
 Q
"RTN","IBECEAU4")
0^2^B16312791^B16030662
"RTN","IBECEAU4",1,0)
IBECEAU4 ;ALB/CPM - Cancel/Edit/Add... Cancel Utilities ; 23-APR-93
"RTN","IBECEAU4",2,0)
 ;;2.0;INTEGRATED BILLING;**52,167,183,341**;21-MAR-94
"RTN","IBECEAU4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBECEAU4",4,0)
 ;
"RTN","IBECEAU4",5,0)
CANCH(IBN,IBCRES,IBIND,IBCV) ; Cancel last transaction for a specific charge.
"RTN","IBECEAU4",6,0)
 ;  Input:    IBN   --  Charge to be cancelled
"RTN","IBECEAU4",7,0)
 ;          IBCRES  --  Cancellation reason
"RTN","IBECEAU4",8,0)
 ;           IBIND  --  1=>set MT bulletin flags; 0=>don't set flags
"RTN","IBECEAU4",9,0)
 ;            IBCV  --  1=>use the CHAMPVA error bulletin
"RTN","IBECEAU4",10,0)
 N IBY,IBHOLDN,IBND,IBPARNT,IBCANC,IBH,IBCANTR,IBXA,IBATYP,IBSEQNO,IBIL,IBUNIT,IBCHG
"RTN","IBECEAU4",11,0)
 S (IBN,IBHOLDN)=$$LAST^IBECEAU($P(^IB(IBN,0),"^",9)),IBY=1
"RTN","IBECEAU4",12,0)
 D CED(IBN) I IBCANTR!(IBY<0) G CANCHQ
"RTN","IBECEAU4",13,0)
 D CANC(IBN,IBCRES,1) I IBY<0 G CANCHQ
"RTN","IBECEAU4",14,0)
 I $G(IBIND) S IBARR(DT,IBHOLDN)="",(IBCANCEL,IBFND)=1
"RTN","IBECEAU4",15,0)
CANCHQ I IBY<1 D @$S($G(IBCV):"ERRMSG^IBACVA2(0,1)",1:"^IBAERR1")
"RTN","IBECEAU4",16,0)
 Q
"RTN","IBECEAU4",17,0)
 ;
"RTN","IBECEAU4",18,0)
CANC(IBCN,IBCRES,IBINC) ; Cancel a charge, after passing all edits
"RTN","IBECEAU4",19,0)
 ; Input:    IBCN  --  Internal entry # of IB Action to cancel
"RTN","IBECEAU4",20,0)
 ;          IBCRES --  Cancellation reason
"RTN","IBECEAU4",21,0)
 ;           IBINC --  Try to cancel an incomplete charge? [optional]
"RTN","IBECEAU4",22,0)
 N DA,DIK,IBCAN,IBSTOPDA,IBGMTR
"RTN","IBECEAU4",23,0)
 S IBCAN=$G(^IB(IBCN,0))
"RTN","IBECEAU4",24,0)
 ;
"RTN","IBECEAU4",25,0)
 ; - handle incomplete transactions
"RTN","IBECEAU4",26,0)
 I $G(IBINC) S:'$D(IBH) IBH='$P($G(^IBE(350.21,+$P(IBND,"^",5),0)),"^",4) I IBH D UPSTAT(IBCN,1) G CANCQ
"RTN","IBECEAU4",27,0)
 ;
"RTN","IBECEAU4",28,0)
 ; - handle regular transactions
"RTN","IBECEAU4",29,0)
 S IBATYP=$P($G(^IBE(350.1,+$P(IBCAN,"^",3),0)),"^",6) I IBATYP="" S IBY="-1^IB022" G CANCQ
"RTN","IBECEAU4",30,0)
 S IBSEQNO=$P($G(^IBE(350.1,IBATYP,0)),"^",5) I 'IBSEQNO S IBY="-1^IB023" G CANCQ
"RTN","IBECEAU4",31,0)
 W:$G(IBJOB)=4 !!,"Building the cancellation transaction... "
"RTN","IBECEAU4",32,0)
 D ADD^IBAUTL I Y<1 S IBY=Y G CANCQ
"RTN","IBECEAU4",33,0)
 S $P(IBCAN,"^",3)=IBATYP,$P(IBCAN,"^",5)=1,$P(IBCAN,"^",10)=IBCRES,$P(IBCAN,"^",12)=""
"RTN","IBECEAU4",34,0)
 ;  if there is a clinic stop, move it over
"RTN","IBECEAU4",35,0)
 S IBSTOPDA=$P(IBCAN,"^",20)
"RTN","IBECEAU4",36,0)
 S IBGMTR=$P(IBCAN,"^",21) ; 'GMT RELATED' flag
"RTN","IBECEAU4",37,0)
 S:IBXA'=5 IBCAN=$P(IBCAN,"^",1,16)
"RTN","IBECEAU4",38,0)
 S IBCAN=$P(IBCAN,"^",1,17)
"RTN","IBECEAU4",39,0)
 I IBSTOPDA S $P(IBCAN,"^",20)=IBSTOPDA
"RTN","IBECEAU4",40,0)
 S $P(^IB(IBN,0),"^",2,20)=$P(IBCAN,"^",2,20)
"RTN","IBECEAU4",41,0)
 I IBGMTR S $P(^IB(IBN,0),"^",21)=IBGMTR ; Set the 'GMT RELATED' flag
"RTN","IBECEAU4",42,0)
 ; DUZ may be null if this code is called by a process started by an HL7 multi-threaded listener
"RTN","IBECEAU4",43,0)
 ; if this condition occurs the approved fix is to use the Postmaster IEN.  2/27/06, IB*2.0*341
"RTN","IBECEAU4",44,0)
 S $P(^IB(IBN,1),"^")=$S(DUZ:DUZ,1:.5) ;
"RTN","IBECEAU4",45,0)
 S DA=IBN,DIK="^IB(" D IX1^DIK
"RTN","IBECEAU4",46,0)
 W:$G(IBJOB)=4 " .. " D PASS
"RTN","IBECEAU4",47,0)
 ;
"RTN","IBECEAU4",48,0)
 ; - cancel original charge (if it was an updated transaction)
"RTN","IBECEAU4",49,0)
 I $D(^IB(IBCN,0)),$P(^(0),"^",5)'=10 D UPSTAT(IBCN)
"RTN","IBECEAU4",50,0)
CANCQ Q
"RTN","IBECEAU4",51,0)
 ;
"RTN","IBECEAU4",52,0)
CED(IBN) ; Edits required to cancel a charge.
"RTN","IBECEAU4",53,0)
 ; Input:   IBN  --   Internal entry # of charge to be cancelled
"RTN","IBECEAU4",54,0)
 S IBND=$G(^IB(IBN,0)) I 'IBND S IBY="-1^IB021" G CEDQ
"RTN","IBECEAU4",55,0)
 S IBPARNT=+$P(IBND,"^",9) I '$D(^IB(IBPARNT,0)) S IBY="-1^IB027" G CEDQ
"RTN","IBECEAU4",56,0)
 I $$LAST^IBECEAU(IBPARNT)'=IBN S IBY="-1^^You can only cancel the last transaction for an original charge." G CEDQ
"RTN","IBECEAU4",57,0)
 S IBCANC=$G(^IBE(350.1,+$P(IBND,"^",3),0))
"RTN","IBECEAU4",58,0)
 S IBH='$P($G(^IBE(350.21,+$P(IBND,"^",5),0)),"^",4),IBCANTR=$P(IBCANC,"^",5)=2
"RTN","IBECEAU4",59,0)
 S IBXA=$P(IBCANC,"^",11),IBATYP=$P(IBCANC,"^",6)
"RTN","IBECEAU4",60,0)
 I '$D(^IBE(350.1,+IBATYP,0)) S IBY="-1^IB022" G CEDQ
"RTN","IBECEAU4",61,0)
 S IBSEQNO=$P(^IBE(350.1,+IBATYP,0),"^",5) I 'IBSEQNO S IBY="-1^IB023" G CEDQ
"RTN","IBECEAU4",62,0)
 S IBIL=$P(IBND,"^",11),IBUNIT=+$P(IBND,"^",6),IBCHG=+$P(IBND,"^",7),IBFR=$P(IBND,"^",14)
"RTN","IBECEAU4",63,0)
 I IBUNIT<1 S IBY="-1^IB025" G CEDQ
"RTN","IBECEAU4",64,0)
 I 'IBH,'IBCHG S IBY="-1^^There is no charge amount associated with this action." G CEDQ
"RTN","IBECEAU4",65,0)
 I $G(IBJOB)'=4,'IBH,IBIL="" S IBY="-1^IB024"
"RTN","IBECEAU4",66,0)
CEDQ Q
"RTN","IBECEAU4",67,0)
 ;
"RTN","IBECEAU4",68,0)
UPSTAT(IBCN,IB) ; Update the status, cancellation reason of incomplete charges.
"RTN","IBECEAU4",69,0)
 N DIE,DA,DR
"RTN","IBECEAU4",70,0)
 W:$G(IBJOB)=4&$G(IB) !,"Updating the status of the charge to 'cancelled'... "
"RTN","IBECEAU4",71,0)
 S DIE="^IB(",DA=IBCN,DR=".05////10;.1////"_IBCRES
"RTN","IBECEAU4",72,0)
 D ^DIE W:$G(IBJOB)=4&$G(IB) "done."
"RTN","IBECEAU4",73,0)
 Q
"RTN","IBECEAU4",74,0)
 ;
"RTN","IBECEAU4",75,0)
PASS ; Pass the action to Accounts Receivable.
"RTN","IBECEAU4",76,0)
 N IBSERV
"RTN","IBECEAU4",77,0)
 S IBNOS=IBN D ^IBR S IBY=Y I Y>0,$G(IBJOB)=4 W "done."
"RTN","IBECEAU4",78,0)
 Q
"RTN","IBECEAU4",79,0)
 ;
"RTN","IBECEAU4",80,0)
ERR ; Error Processing.
"RTN","IBECEAU4",81,0)
 Q:IBY>0
"RTN","IBECEAU4",82,0)
 I $P(IBY,"^",2)]"" W !,$P($G(^IBE(350.8,+$O(^IBE(350.8,"AC",$P($P(IBY,"^",2),";"),0)),0)),"^",2) Q
"RTN","IBECEAU4",83,0)
 I $P(IBY,"^",3)]"" W !,$P(IBY,"^",3)
"RTN","IBECEAU4",84,0)
 Q
"RTN","IBECEAU4",85,0)
 ;
"RTN","IBECEAU4",86,0)
PROC(EVT) ; Okay to proceed with Add, Edit, or Cancel?
"RTN","IBECEAU4",87,0)
 N DIR,DIRUT,DUOUT,DTOUT,X,Y
"RTN","IBECEAU4",88,0)
 W ! S DIR(0)="Y",DIR("A")="Okay to "_EVT_" this charge",DIR("?")="Enter 'Y' or 'YES' to "_EVT_" this charge, or 'N', 'NO', or '^' to quit."
"RTN","IBECEAU4",89,0)
 D ^DIR K DIR I 'Y!($D(DIRUT))!($D(DUOUT)) W !,"This charge will not be ",$S(EVT="cancel":"cancelled",1:EVT_"ed"),"." S IBY=-1 G PROCQ
"RTN","IBECEAU4",90,0)
 S IBCOMMIT=1
"RTN","IBECEAU4",91,0)
PROCQ Q
"VER")
8.0^22.0
"BLD",6621,6)
^317
**END**
**END**
