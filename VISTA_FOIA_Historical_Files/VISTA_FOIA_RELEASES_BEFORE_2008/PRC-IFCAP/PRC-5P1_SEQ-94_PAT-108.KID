Released PRC*5.1*108 SEQ #94
Extracted from mail message
**KIDS**:PRC*5.1*108^

**INSTALL NAME**
PRC*5.1*108
"BLD",5019,0)
PRC*5.1*108^IFCAP^0^3070521^y
"BLD",5019,1,0)
^^19^19^3070521^^^^
"BLD",5019,1,1,0)
The first issue involves the input transform of the 
"BLD",5019,1,2,0)
Appropriation field in the Fund Distribution file (#421).
"BLD",5019,1,3,0)
 
"BLD",5019,1,4,0)
The second issue involves allowing all users of the New Detailed Purchase 
"BLD",5019,1,5,0)
Card Order option to enter an Item Discount.
"BLD",5019,1,6,0)
 
"BLD",5019,1,7,0)
The third item is a fix to the help text display at the prompt:
"BLD",5019,1,8,0)
"Do you want to request a refresh of the supply station QOH?"
"BLD",5019,1,9,0)
 
"BLD",5019,1,10,0)
The fourth item fixes a problem that could occur when editing the
"BLD",5019,1,11,0)
CONTRACT/BOA # field on an amendment.
"BLD",5019,1,12,0)
 
"BLD",5019,1,13,0)
The fifth item fixes a problem with ^-jumping at the CONTRACT/BOA #
"BLD",5019,1,14,0)
field in the Edit an Incomplete Purchase Order option.
"BLD",5019,1,15,0)
 
"BLD",5019,1,16,0)
The sixth item updates the Purchase Card limit to $3,000.
"BLD",5019,1,17,0)
 
"BLD",5019,1,18,0)
The seventh item corrects two spelling errors in an
"BLD",5019,1,19,0)
IFCAP Option File entry.
"BLD",5019,4,0)
^9.64PA^421^2
"BLD",5019,4,421,0)
421
"BLD",5019,4,421,2,0)
^9.641^421^1
"BLD",5019,4,421,2,421,0)
FUND DISTRIBUTION  (File-top level)
"BLD",5019,4,421,2,421,1,0)
^9.6411^13.5^1
"BLD",5019,4,421,2,421,1,13.5,0)
APPROPRIATION
"BLD",5019,4,421,222)
y^n^p^^^^n^^n
"BLD",5019,4,421,224)

"BLD",5019,4,443.6,0)
443.6
"BLD",5019,4,443.6,2,0)
^9.641^443.61^1
"BLD",5019,4,443.6,2,443.61,0)
ITEM  (sub-file)
"BLD",5019,4,443.6,2,443.61,1,0)
^9.6411^4^1
"BLD",5019,4,443.6,2,443.61,1,4,0)
CONTRACT/BOA #
"BLD",5019,4,443.6,222)
y^n^p^^^^n^^n
"BLD",5019,4,443.6,224)

"BLD",5019,4,"APDD",421,421)

"BLD",5019,4,"APDD",421,421,13.5)

"BLD",5019,4,"APDD",443.6,443.61)

"BLD",5019,4,"APDD",443.6,443.61,4)

"BLD",5019,4,"B",421,421)

"BLD",5019,4,"B",443.6,443.6)

"BLD",5019,6)
1^
"BLD",5019,6.3)
10
"BLD",5019,"ABPKG")
n
"BLD",5019,"INI")

"BLD",5019,"INID")
^y^
"BLD",5019,"INIT")
EN^PRC51108
"BLD",5019,"KRN",0)
^9.67PA^8989.52^19
"BLD",5019,"KRN",.4,0)
.4
"BLD",5019,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5019,"KRN",.401,0)
.401
"BLD",5019,"KRN",.402,0)
.402
"BLD",5019,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",5019,"KRN",.402,"NM",1,0)
PRCH2138    FILE #442^442^0
"BLD",5019,"KRN",.402,"NM","B","PRCH2138    FILE #442",1)

"BLD",5019,"KRN",.403,0)
.403
"BLD",5019,"KRN",.5,0)
.5
"BLD",5019,"KRN",.84,0)
.84
"BLD",5019,"KRN",3.6,0)
3.6
"BLD",5019,"KRN",3.8,0)
3.8
"BLD",5019,"KRN",9.2,0)
9.2
"BLD",5019,"KRN",9.8,0)
9.8
"BLD",5019,"KRN",9.8,"NM",0)
^9.68A^11^8
"BLD",5019,"KRN",9.8,"NM",3,0)
PRCPUYN^^0^B1375817
"BLD",5019,"KRN",9.8,"NM",5,0)
PRCPURS3^^0^B16696444
"BLD",5019,"KRN",9.8,"NM",6,0)
PRCPAGP0^^0^B18058628
"BLD",5019,"KRN",9.8,"NM",7,0)
PRCHNPO1^^0^B54494630
"BLD",5019,"KRN",9.8,"NM",8,0)
PRCHNPT^^0^B1872539
"BLD",5019,"KRN",9.8,"NM",9,0)
PRCHCON1^^0^B22950686
"BLD",5019,"KRN",9.8,"NM",10,0)
PRC51108^^0^B3359244
"BLD",5019,"KRN",9.8,"NM",11,0)
PRCHNPO^^0^B57666980
"BLD",5019,"KRN",9.8,"NM","B","PRC51108",10)

"BLD",5019,"KRN",9.8,"NM","B","PRCHCON1",9)

"BLD",5019,"KRN",9.8,"NM","B","PRCHNPO",11)

"BLD",5019,"KRN",9.8,"NM","B","PRCHNPO1",7)

"BLD",5019,"KRN",9.8,"NM","B","PRCHNPT",8)

"BLD",5019,"KRN",9.8,"NM","B","PRCPAGP0",6)

"BLD",5019,"KRN",9.8,"NM","B","PRCPURS3",5)

"BLD",5019,"KRN",9.8,"NM","B","PRCPUYN",3)

"BLD",5019,"KRN",19,0)
19
"BLD",5019,"KRN",19,"NM",0)
^9.68A^^0
"BLD",5019,"KRN",19.1,0)
19.1
"BLD",5019,"KRN",101,0)
101
"BLD",5019,"KRN",409.61,0)
409.61
"BLD",5019,"KRN",771,0)
771
"BLD",5019,"KRN",870,0)
870
"BLD",5019,"KRN",8989.51,0)
8989.51
"BLD",5019,"KRN",8989.52,0)
8989.52
"BLD",5019,"KRN",8994,0)
8994
"BLD",5019,"KRN","B",.4,.4)

"BLD",5019,"KRN","B",.401,.401)

"BLD",5019,"KRN","B",.402,.402)

"BLD",5019,"KRN","B",.403,.403)

"BLD",5019,"KRN","B",.5,.5)

"BLD",5019,"KRN","B",.84,.84)

"BLD",5019,"KRN","B",3.6,3.6)

"BLD",5019,"KRN","B",3.8,3.8)

"BLD",5019,"KRN","B",9.2,9.2)

"BLD",5019,"KRN","B",9.8,9.8)

"BLD",5019,"KRN","B",19,19)

"BLD",5019,"KRN","B",19.1,19.1)

"BLD",5019,"KRN","B",101,101)

"BLD",5019,"KRN","B",409.61,409.61)

"BLD",5019,"KRN","B",771,771)

"BLD",5019,"KRN","B",870,870)

"BLD",5019,"KRN","B",8989.51,8989.51)

"BLD",5019,"KRN","B",8989.52,8989.52)

"BLD",5019,"KRN","B",8994,8994)

"BLD",5019,"QUES",0)
^9.62^^
"BLD",5019,"REQB",0)
^9.611^3^3
"BLD",5019,"REQB",1,0)
PRC*5.1*1^2
"BLD",5019,"REQB",2,0)
PRC*5.1*100^2
"BLD",5019,"REQB",3,0)
PRC*5.1*79^2
"BLD",5019,"REQB","B","PRC*5.1*1",1)

"BLD",5019,"REQB","B","PRC*5.1*100",2)

"BLD",5019,"REQB","B","PRC*5.1*79",3)

"FIA",421)
FUND DISTRIBUTION
"FIA",421,0)
^PRCF(421,
"FIA",421,0,0)
421I
"FIA",421,0,1)
y^n^p^^^^n^^n
"FIA",421,0,10)

"FIA",421,0,11)

"FIA",421,0,"RLRO")

"FIA",421,0,"VR")
5.1^PRC
"FIA",421,421)
1
"FIA",421,421,13.5)

"FIA",443.6)
AMENDMENTS
"FIA",443.6,0)
^PRC(443.6,
"FIA",443.6,0,0)
443.6I
"FIA",443.6,0,1)
y^n^p^^^^n^^n
"FIA",443.6,0,10)

"FIA",443.6,0,11)

"FIA",443.6,0,"RLRO")

"FIA",443.6,0,"VR")
5.1^PRC
"FIA",443.6,443.6)
1
"FIA",443.6,443.61)
1
"FIA",443.6,443.61,4)

"INIT")
EN^PRC51108
"KRN",.402,2456,-1)
0^1
"KRN",.402,2456,0)
PRCH2138^3070417.1204^^442^^^3070514
"KRN",.402,2456,"DIAB",1,0,442,11)
VENDOR:
"KRN",.402,2456,"DIAB",1,1,442.01,23)
PURCHASE ORDER NUMBER:DELIVERY SCHEDULE (ORDER):
"KRN",.402,2456,"DIAB",1,1,442.12,0)
ALL
"KRN",.402,2456,"DIAB",2,0,442,4)
SUBSTATION;REQ
"KRN",.402,2456,"DIAB",7,1,442.01,9)
FEDERAL SUPPLY CLASSIFICATION;T
"KRN",.402,2456,"DR",1,442)
Q:'$D(PRC("SITE"));S (PRCHN("SVC"),PRCHN("CC"),PRCHN("SC"),PRCHN("INV"))="";S PRCHN("SFC")=+$P(^PRC(442,DA,0),U,19);S PRCHN("FOB")=$S($D(^(1)):$P(^(1),U,6),1:"");S PRCHN(12)=$S($D(^PRC(442,DA,12)):^(12),1:"");
"KRN",.402,2456,"DR",1,442,1)
S PRCHNVF="",PRCHPONO=$P(^PRC(442,DA,0),U,1),PRCHSTN=$P(PRCHPONO,"-") S PRCHIEN=DA;S PRCX=$O(^PRC(411,PRC("SITE"),1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,PRC("SITE"),1,PRCX,0)),U) K PRCX;D EN2^PRCHNPO6;
"KRN",.402,2456,"DR",1,442,2)
S PRCHDUZ=$P(^VA(200,DUZ,0),U,1);S PRCHN("MP")=$S($D(^PRCD(442.5,+$P(^PRC(442,DA,0),U,2),0)):$P(^(0),U,3),1:"");S PRCHN("INV")=$S(PRCHN("MP")=2:"FISCAL",PRCHN("MP")=12:"",PRCHN("INV")'="":PRCHN("INV"),1:"FMS");
"KRN",.402,2456,"DR",1,442,3)
S PRCHCTPO=$S(PRCHN("MP")=2:"Y",1:"N");S X=$P($G(^PRC(442,DA,1)),U) I X>0,$P($G(^PRC(440,X,3)),U,2)="Y" S PRCHEDI="";I '$D(^PRC(411,"UP",PRC("SITE"))) S Y=.1;S OSUB=$P($G(^PRC(442,DA,23)),U,7);
"KRN",.402,2456,"DR",1,442,4)
I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) S X=$P($G(^(0)),U,10) I +X=OSUB W !,"SUBSTATION: ",$P(^PRC(411,$P(^PRC(442,DA,23),U,7),0),U) S Y=.1;31R~;
"KRN",.402,2456,"DR",1,442,5)
I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)),X'=OSUB W !,?5,"Sub-station cannot be changed because the attached 2237",!,?5,"would then have a different sub-station.",!;
"KRN",.402,2456,"DR",1,442,6)
S PRCX=$O(^PRC(411,X,1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,X,1,PRCX,0)),U) K PRCX;Q;.1//TODAY;.02//^S X="INVOICE/RECEIVING REPORT";
"KRN",.402,2456,"DR",1,442,7)
S PRCHN("MP")=$S($D(^PRCD(442.5,+X,0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("MP")=2:"FISCAL",PRCHN("MP")=12:"",PRCHN("INV")]"":PRCHN("INV"),1:"FMS");S:PRCHN("MP")'=25 Y=.08;D LOOK^PRCSPC;I (X="")!(X["^") S ERRFLG=38,Y=0;
"KRN",.402,2456,"DR",1,442,8)
I $G(PRCHXXX)="" S ERRFLG=38,Y=0;46////^S X=$G(PRCHXXX);56////^S X=DUZ;I PRCHXXX]"" S PRCPO=^PRC(440.5,PRCHXXX,0),PRCHHLDR=$P(PRCPO,U,8);61////^S X=PRCHHLDR;K PRCPO,PRCHHLDR,PRCHXXX;
"KRN",.402,2456,"DR",1,442,9)
.08//^S X=$S(PRCHN("MP")=2:"Y",PRCHN("MP")=12:"Y",1:"N");.04//^S X=PRCHN("INV");5;I $P(PRCHNVF,"^",3)=1 S Y="@20";S PRCHOV3=$G(^PRC(440,+^PRC(442,D0,1),3)) S:$P(PRCHOV3,"^",12)="P" Y="@20";S:$P(PRCHOV3,"^",6)="N" Y="@20";
"KRN",.402,2456,"DR",1,442,10)
S FLAG=0 I $P(PRCHOV3,"^",4)]""!(($P(PRCHOV3,"^",9)]"")&($P(PRCHOV3,"^",8)]"")) S FLAG=1;D EN9^PRCHNPO7;W:0 "The jump Y=@20 is set in routine EN9^PRCHNPO7";
"KRN",.402,2456,"DR",1,442,11)
^440^PRC(440,^^S I(0,0)=D0 S Y(1)=$S($D(^PRC(442,D0,1)):^(1),1:"") S X=$P(Y(1),U,1),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");@20;I '$D(PRCHEDI) S:$D(^PRC(442,DA,12)) $P(^(12),U,13,14)="^" S Y="@10";18.6//^S X="N";
"KRN",.402,2456,"DR",1,442,12)
I X'="Y" S:$D(^PRC(442,DA,12)) $P(^(12),U,14)="" S Y="@10";18.7;@10;8//^S X=PRCHN("SC");I "29"'[X K:0 DIC("DR") D ^PRCHNPO3 S Y="@1";.25;D ^PRCHNPO3;@1;
"KRN",.402,2456,"DR",1,442,13)
I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) S X=$P($P(^(0),U,1),"-",4) I +X=+$P(^PRC(442,DA,0),U,3) W !,"FCP: ",$P(^(0),U,3) S Y="@2";1;S PRCHN("SFC")=$P(^PRC(442,DA,0),U,19);@2;
"KRN",.402,2456,"DR",1,442,14)
I $G(PRC("BBFY"))="" S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(^PRC(442,DA,0),U,3));26///^S X=PRC("BBFY");D EN2^PRCHNPO3;2//^S X=PRCHN("CC");@88;5.2//^S X=PRCHN("SVC");I $P(^PRC(442,DA,0),U,2)=25 S Y="@89";S Y="@90";@89;
"KRN",.402,2456,"DR",1,442,15)
54;@90;S:PRCHN("MP")=2 Y="@3" I $D(^PRC(442,DA,1)),$P(^(1),U,18)]"" S Y="@3";.3//^S X="E";@3;S:PRCHN("MP")=4 Y=5.3;
"KRN",.402,2456,"DR",1,442,16)
I '$P(^PRC(442,DA,0),U,19)&(PRCHN("MP")'=2) W !,"Enter the word 'PATIENT' in the 'DELIVERY LOCATION' field for a direct delivery",!,"to a patient.";5.6;
"KRN",.402,2456,"DR",1,442,17)
I X="PATIENT",$P(^PRC(442,DA,0),U,19) I $P(^(0),U,19)!(PRCHN("MP")=2) W *7,!,"  PATIENT DELIVERY not valid for this type of order!" S Y=5.6;I X="PATIENT" W "   Direct Delivery to Patient" S Y=5.3;5.4//^S X=$G(PRCY);
"KRN",.402,2456,"DR",1,442,18)
I $P(^PRC(442,DA,1),U,12)'="" W *7,!,"Delete the Direct Delivery patient name if you wish the 'Ship to' address",!,"to print on the P.O.",!;S:(PRCHN("MP")'=4)&($P(^(1),U,12)="") Y=6;5.3;K DIC("DR");6//NO;S:X'="Y" Y=6.4;6.2;
"KRN",.402,2456,"DR",1,442,19)
6.4//DESTINATION;S PRCHN("FOB")=X;Q;7//TODAY+10;8.2//^S X="N/A";8.3;13;S PRCHSHP=+X;S:X']"" Y="@99";I $P(^PRC(442,DA,0),U,19)'=2 S Y="@98";S PRCHSBOC=$P($G(^PRCD(420.2,2299,0)),U);13.05////^S X=PRCHSBOC;S Y="@100";@98;13.05;@100;
"KRN",.402,2456,"DR",1,442,20)
S:'$D(PRCHSHP) PRCHSHP=$P(^PRC(442,DA,0),U,13) I '(PRCHN("FOB")="O"&((PRCHSHP>250)!(PRCHSHP=0))) S Y="@99";13.2;13.4;13.3;@99;97//^S X="A";16//^S X=$S($D(PRCHDUZ):PRCHDUZ,1:"");
"KRN",.402,2456,"DR",1,442,21)
S PRCHDUZ1=X I $P(^PRC(442,DA,0),U,2)=25,'$D(^PRC(440.5,"H",X)) W *7,!,"This user is not a purchase card user." S Y=16;K PRCHDUZ,PRCHDUZ1;40;24;20;501//^S X=$G(PRCHCTPO);K PRCHANS,PRCHTPO,PRCHSEEN,PRCHMORE,PRCHQTY,PRCSAVE;
"KRN",.402,2456,"DR",2,440)
I FLAG S Y=17.3;38;I X]"" S Y=39;W !!,"This VENDOR needs a TAX IDENTIFICATION NUMBER or a SOCIAL SECURITY NUMBER.",!,"Please enter one if you have it or get one from the VENDOR.",!;39;I X]"" S Y=17.3;
"KRN",.402,2456,"DR",2,440,1)
W !!,"Please tell me whether the TAX ID/SSN field is a TAX NUMBER or a SSN NUMBER.",!;17.3;17.4;17.7;17.8;17.9;I $P(PRCHOV3,U,11)]"" S Y="@10";41;@10;I $P(PRCHOV3,U,14)]"" S Y="@11";44;@11;I $P(PRCHOV3,U,13)]"" S Y="";
"KRN",.402,2456,"DR",2,442.01)
S PRCHREC=DA,PRCHQUAN="",Z="",PRCHTOT=0;S PRCHINUM=DA;.01;K PRCSAVE;S PRCHOLD=$P($G(^PRC(442,PRCHIEN,2,PRCHINUM,0)),U,2);1.5;I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=4) S PRCSAVE="G",Y="@101";
"KRN",.402,2456,"DR",2,442.01,1)
I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=5) S PRCSAVE="S",Y="@101";I X=""&($G(PRCSAVE)="") D ^PRCHAAC4 I $D(PRCHANS) S PRCSAVE=PRCHANS;@101;I $G(PRCSAVE)="^" K PRCHANS,PRCSAVE S Y=0;1;
"KRN",.402,2456,"DR",2,442.01,2)
I '$D(^PRC(442,DA(1),2,DA,1)) W $C(7),!,"Description is Required!!" S Y=1;I $D(^PRC(442,DA(1),1)) S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),2,+^PRC(442,DA(1),1),0)):^(0),1:"");
"KRN",.402,2456,"DR",2,442.01,3)
I Z'="" W:$P(Z,U,12)'="" !,"    Minimum Order Qty.: ",$P(Z,U,12) W:$P(Z,U,9) !,"    Maximum Order Qty.: ",$P(Z,U,9) W:$P(Z,U,11) !,"    Required Order Multiple: ",$P(Z,U,11) S PRCHQUAN=Z K Z;
"KRN",.402,2456,"DR",2,442.01,4)
2//^S X=$S($P(PRCHQUAN,U,12)'="":$P(PRCHQUAN,U,12),$P(PRCHQUAN,U,11)'="":$P(PRCHQUAN,U,11),1:"");I X<PRCHOLD N I F I=0:0 S I=$O(^PRC(442.8,"AC",PRCHPONO,PRCHINUM,I)) Q:'I  S PRCHTOT=PRCHTOT+$P($G(^PRC(442.8,I,0)),U,5);
"KRN",.402,2456,"DR",2,442.01,5)
I $G(PRCHTOT)>X W !!!!!,$C(7),"****Delivery schedule total for this item (",PRCHTOT,") EXCEEDS order quantity (",X,").",!,"Edit delivery schedule(s).",!! S PRCHFLG=1,PRCHQTY=X S Y="@16";@44;
"KRN",.402,2456,"DR",2,442.01,6)
I $P(PRCHQUAN,U,12)'="" I X<$P(PRCHQUAN,U,12) W !,"QUANTITY is less than the Minimum Order Quantity of ",$P(PRCHQUAN,U,12),$C(7) S Y=2;
"KRN",.402,2456,"DR",2,442.01,7)
I $P(PRCHQUAN,U,9)'="" I X>$P(PRCHQUAN,U,9) W !,"QUANTITY is more than the Maximum Order Quantity of ",$P(PRCHQUAN,U,9),$C(7) S Y=2;
"KRN",.402,2456,"DR",2,442.01,8)
I $P(PRCHQUAN,U,11)'="" I X#$P(PRCHQUAN,U,11)'=0 W !,"QUANTITY is not a Required Order Multiple value of ",$P(PRCHQUAN,U,11),$C(7) S Y=2;3;5;I $D(^PRC(442,DA(1),1)),$P(^(1),U,20)="Y" S Y="@6";D TSTREQ1^PRCHNPO9;3.1;9.4;S:X']"" Y=9;
"KRN",.402,2456,"DR",2,442.01,9)
S DIE("NO^")="A";9.7;K DIE("NO^");9;9.5;@6;8T~;I $G(PRCSAVE)'="^" D EN10^PRCHNPO7;
"KRN",.402,2456,"DR",2,442.01,10)
S PRCHFCP=+$P(^PRC(442,DA(1),0),U,3),PRCHN("COM")=$S($D(^PRC(441.2,+X,0)):$P(^(0),U,4),1:"") S:$E($P($G(^PRC(420,PRCHSTN,1,PRCHFCP,0)),U,18),1,2)=11 Y=41 S:(PRCHN("COM")'=1)&($E($P($G(^(0)),U,18),1,2)'=11) Y="@4";
"KRN",.402,2456,"DR",2,442.01,11)
S:PRCHN("MP")=2 Y="@4";9.3;D TSTREQ2^PRCHNPO9;40;S Y="@4";41//^S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),3)):^(3),1:""),X=$P(Z,U,7);42;@4;S DIE("NO^")="OUTOK";4;K DIE("NO^");
"KRN",.402,2456,"DR",2,442.01,12)
I PRCHN("SFC")=2 S $P(^PRC(442,DA(1),2,DA,0),U,4)=$$SUPBOC^PRCHNPO7(-1) S Y="@87";3.5//^S X=$$SUPBOC^PRCHNPO7(-1);@87;S:'$D(PRCHEDI) Y="@5";36.3;36.6;@5;
"KRN",.402,2456,"DR",2,442.01,13)
S PRCHTOT=0,PRCHSCN="" F I=0:0 S PRCHSCN=$O(^PRC(442.8,"B",PRCHPONO,PRCHSCN)) Q:PRCHSCN=""  I $P(^PRC(442.8,PRCHSCN,0),U,2)=DA S PRCHTOT=PRCHTOT+$P(^(0),U,5);S PRCHQTY=$P(^PRC(442,DA(1),2,DA,0),U,2);
"KRN",.402,2456,"DR",2,442.01,14)
I PRCHTOT>PRCHQTY S PRCHDA1=DA(1),PRCHDA=DA,PRCHLINO=$P(^PRC(442,DA(1),2,PRCHREC,0),U) W !,"Line Item # = ",PRCHLINO,!,"Quantity Ordered: "_$P(^PRC(442,DA(1),2,PRCHREC,0),U,2),! S Y="@555";
"KRN",.402,2456,"DR",2,442.01,15)
W !!,"Enter/Edit Delivery Schedule for this Item?  NO// " R X:DTIME S:'$T X="^" S:X="" X="N" S:X["?" Y="@5" S:"Yy?"'[$E(X) Y="@56" W "  "_$S("Yy"[$E(X):"(YES)","Nn"[$E(X):"(NO)",1:"");@16;
"KRN",.402,2456,"DR",2,442.01,16)
S PRCHDA1=DA(1),PRCHDA=DA,PRCHLINO=$P(^PRC(442,DA(1),2,PRCHREC,0),U) W !,"Line Item #=",PRCHLINO,!,"Quantity Ordered: "_$P(^PRC(442,DA(1),2,PRCHREC,0),U,2),!;
"KRN",.402,2456,"DR",2,442.01,17)
I PRCHTOT=PRCHQTY W !,"Delivery schedule quantity of ",PRCHTOT," equals order quantity of ",PRCHQTY,".",!,"You may edit delivery schedule(s), but cannot add a new schedule.",!;@555;
"KRN",.402,2456,"DR",2,442.01,18)
I PRCHTOT>PRCHQTY W !,"Delivery schedule quantity of ",PRCHTOT," EXCEEDS order quantity of ",PRCHQTY,".  You must edit",!,"one or more schedules so that the total equals no more than ",PRCHQTY,".",!! S Y="@55";
"KRN",.402,2456,"DR",2,442.01,19)
S:$D(PRCHSEEN) Y="@55";S PRCHSEEN=1 W !!,"To delete a schedule, zero out the quantity to be delivered. To add a new",!,"delivery schedule do the following:",!!;
"KRN",.402,2456,"DR",2,442.01,20)
W "a. If there is no delivery schedule already in file answer 'Yes' when asked if     you are adding a new delivery schedule.";
"KRN",.402,2456,"DR",2,442.01,21)
W !,"b. If there is only one delivery schedule already in the file you will see         'OK? YES//' answer 'No' and then answer 'Yes' when asked if you are adding a    new delivery schedule.";
"KRN",.402,2456,"DR",2,442.01,22)
W !,"c. If there is more than one delivery schedule in the file, hit <return> key at    'CHOOSE' prompt and answer 'Yes' when asked if you are adding a new delivery    schedule.",!!;@55;
"KRN",.402,2456,"DR",2,442.01,23)
^442.8^PRC(442.8,^^X DR(99,1,9.2) S Y(101)=$S($D(^PRC(442.8,D0,0)):^(0),1:"") S X=$P(Y(101),U,1),Y(102)=$G(X) S X=$P(Y(101),U,1) S D0=I(0,0) S D1=I(1,0) S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,2456,"DR",2,442.01,24)
S:$G(PRCHDA) PRCHINUM=PRCHDA S PRCHQTY=$P(^PRC(442,PRCHIEN,2,PRCHINUM,0),U,2);
"KRN",.402,2456,"DR",2,442.01,25)
I $G(PRCHFLG),PRCHTOT>PRCHQTY W !!,"Delivery schedule total of ",PRCHTOT," EXCEEDS ordered quantity.",!,"of ",PRCHQTY,".  Adjust delivery schedule(s).",!! S Y="@16";
"KRN",.402,2456,"DR",2,442.01,26)
I $G(PRCHFLG) S PRCHFLG=0 W !!!!,"****Returning to Item Multiple edit session.",!! S Y="@44";I PRCHTOT>PRCHQTY S Y="@555";
"KRN",.402,2456,"DR",2,442.01,27)
W !!,"Enter/Edit Another Delivery Schedule for this Item? NO// " R X:DTIME S:'$T X="^" S:X="" X="N" S:X["?" Y="@5" S:"Yy?"[$E(X) Y="@16";@56;K DIE("NO^"),PRCHTOT,PRCHSCN,PRCHSEEN;
"KRN",.402,2456,"DR",2,442.12)
.01
"KRN",.402,2456,"DR",2,442.15)
.01;
"KRN",.402,2456,"DR",3,442.8)
1///^S X=PRCHDA;S DIE("NO^")="";2;3;@6;4;K DIE("NO^");S PRCHTOT=0,PRCHSCN="" F I=0:0 S PRCHSCN=$O(^PRC(442.8,"B",PRCHPONO,PRCHSCN)) Q:PRCHSCN=""  I $P(^PRC(442.8,PRCHSCN,0),U,2)=PRCHDA S PRCHTOT=PRCHTOT+$P(^(0),U,5);
"KRN",.402,2456,"DR",3,442.8,1)
S PRCHQTY=$P(^PRC(442,PRCHIEN,2,PRCHDA,0),U,2);S PRCHMORE=$P(^PRC(442.8,DA,0),U,5),PRCHMOR2=(PRCHQTY-PRCHTOT+PRCHMORE);
"KRN",.402,2456,"DR",3,442.8,2)
I PRCHTOT>PRCHQTY I PRCHMORE'=0 W *7,!,"Del. sched. total of ",PRCHTOT," for item ",PRCHDA," EXCEEDS the purchase",!,"order quantity of ",PRCHQTY,".",!,"Max. quantity here is ",$S(PRCHMOR2>0:PRCHMOR2,1:0),".",!! S Y="@6";
"KRN",.402,2456,"DR",3,442.8,3)
I PRCHTOT<PRCHQTY W !,"Delivery schedule total of ",PRCHTOT," for item ",PRCHDA," is less than purchase",!,"order quantity.",!!;I X>0 S Y="@445";W *7,!,"Delivery Schedule DELETED",!;.01////@;@445;
"KRN",.402,2456,"DR",99,1,9.2)
S I(1,0)=$G(D1),I(0,0)=$G(D0),Y(1)=$S($D(^PRC(442,D0,0)):^(0),1:"") S X=$P(Y(1),U,1) K DIC S DIC="^PRC(442.8,",DIC(0)="MFE" D ^DIC S (D,D0,D(0))=+Y
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
108^3070521^123456803
"PKG",455,22,1,"PAH",1,1,0)
^^19^19^3070521
"PKG",455,22,1,"PAH",1,1,1,0)
The first issue involves the input transform of the 
"PKG",455,22,1,"PAH",1,1,2,0)
Appropriation field in the Fund Distribution file (#421).
"PKG",455,22,1,"PAH",1,1,3,0)
 
"PKG",455,22,1,"PAH",1,1,4,0)
The second issue involves allowing all users of the New Detailed Purchase 
"PKG",455,22,1,"PAH",1,1,5,0)
Card Order option to enter an Item Discount.
"PKG",455,22,1,"PAH",1,1,6,0)
 
"PKG",455,22,1,"PAH",1,1,7,0)
The third item is a fix to the help text display at the prompt:
"PKG",455,22,1,"PAH",1,1,8,0)
"Do you want to request a refresh of the supply station QOH?"
"PKG",455,22,1,"PAH",1,1,9,0)
 
"PKG",455,22,1,"PAH",1,1,10,0)
The fourth item fixes a problem that could occur when editing the
"PKG",455,22,1,"PAH",1,1,11,0)
CONTRACT/BOA # field on an amendment.
"PKG",455,22,1,"PAH",1,1,12,0)
 
"PKG",455,22,1,"PAH",1,1,13,0)
The fifth item fixes a problem with ^-jumping at the CONTRACT/BOA #
"PKG",455,22,1,"PAH",1,1,14,0)
field in the Edit an Incomplete Purchase Order option.
"PKG",455,22,1,"PAH",1,1,15,0)
 
"PKG",455,22,1,"PAH",1,1,16,0)
The sixth item updates the Purchase Card limit to $3,000.
"PKG",455,22,1,"PAH",1,1,17,0)
 
"PKG",455,22,1,"PAH",1,1,18,0)
The seventh item corrects two spelling errors in an
"PKG",455,22,1,"PAH",1,1,19,0)
IFCAP Option File entry.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","PRC51108")
0^10^B3359244^n/a
"RTN","PRC51108",1,0)
PRC51108 ;BP-OIFO/TJH ; POST INSTALL ROUTINE FOR PRC*5.1*108 ; APRIL 20, 2007
"RTN","PRC51108",2,0)
 ;;5.1;IFCAP;**108**;Oct 20, 2000;Build 10
"RTN","PRC51108",3,0)
 ;
"RTN","PRC51108",4,0)
 Q  ; access from top not allowed
"RTN","PRC51108",5,0)
 ;
"RTN","PRC51108",6,0)
EN ; Entry point
"RTN","PRC51108",7,0)
 N DA,DIC,DIE,X,Y,PRCWP,PRCERR
"RTN","PRC51108",8,0)
 S DIC="^DIC(19,",X="PRCP NON-SS ORDER BULIDER" ; look up misspelled option
"RTN","PRC51108",9,0)
 D ^DIC
"RTN","PRC51108",10,0)
 Q:Y<0  ; not found, possibly already corrected
"RTN","PRC51108",11,0)
 D BMES^XPDUTL("Correcting option name PRCP NON-SS ORDER BULIDER.")
"RTN","PRC51108",12,0)
 S DA=+Y,DIE="^DIC(19,",DR=".01////PRCP NON-SS ORDER BUILDER" D ^DIE
"RTN","PRC51108",13,0)
 S PRCWP(1)="This option will be activated only through the Task Manager and will"
"RTN","PRC51108",14,0)
 S PRCWP(2)="control the effort to automatically generate a distribution order for"
"RTN","PRC51108",15,0)
 S PRCWP(3)="all secondary inventory points not linked to a supply station."
"RTN","PRC51108",16,0)
 D WP^DIE(19,DA_",",3.5,"","PRCWP","PRCERR")
"RTN","PRC51108",17,0)
 I $D(PRCERR("DIERR")) D  Q
"RTN","PRC51108",18,0)
 . D BMES^XPDUTL("Correction of the DESCRIPTION field unsuccessful for the following reason:")
"RTN","PRC51108",19,0)
 . D MES^XPDUTL(PRCERR("DIERR",1,"TEXT",1))
"RTN","PRC51108",20,0)
 D BMES^XPDUTL("Option name has been corrected to PRCP NON-SS ORDER BUILDER")
"RTN","PRC51108",21,0)
 Q
"RTN","PRCHCON1")
0^9^B22950686^B22951328
"RTN","PRCHCON1",1,0)
PRCHCON1 ;WISC/KMB/DL/DXH - CONV. TEMP 2237 TO PC ORDER ;7.29.99
"RTN","PRCHCON1",2,0)
V ;;5.1;IFCAP;**108**;Oct 20, 2000;Build 10
"RTN","PRCHCON1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHCON1",4,0)
 I '$D(^PRC(440.5,"C",DUZ)) W !!,"You are not authorized to use this option." Q
"RTN","PRCHCON1",5,0)
START ;   get transaction number, convert to regular 2237
"RTN","PRCHCON1",6,0)
 N PRC,Y,PRCSIP,PRCSQ,ODA,PNW,TRY,TX1,T1,T2,T3,T4,PRCSY,PRCSDIC,PRCSAPP
"RTN","PRCHCON1",7,0)
 N PRCHCV,PRCHCPD
"RTN","PRCHCON1",8,0)
 I $G(QUIT)'="" K QUIT Q
"RTN","PRCHCON1",9,0)
 K PRC("SITE") W @IOF D EN3F^PRCSUT(1) G W5:'$D(PRC("SITE")) S:Y<0 QUIT=1 Q:Y<0
"RTN","PRCHCON1",10,0)
 D START1 G START
"RTN","PRCHCON1",11,0)
START1 ;
"RTN","PRCHCON1",12,0)
 W !!,"Select the existing transaction number to be converted",!
"RTN","PRCHCON1",13,0)
 ; don't select an order which is signed, or attached to PC already
"RTN","PRCHCON1",14,0)
 S DIC="^PRCS(410,",DIC(0)="AEFMQ"
"RTN","PRCHCON1",15,0)
 S DIC("S")="I $P(^(0),U,2)=""O"",$P(^(0),U,5)=PRC(""SITE""),$P(^(0),U,12)'=""A"",$D(^(3)),+$P(^(3),U)=+PRC(""CP""),$P($G(^(4)),U,5)="""""
"RTN","PRCHCON1",16,0)
 D ^DIC S:Y<0 QUIT=1 Q:Y<0  S (ODA,DA)=+Y,PRCSDIC=DIC
"RTN","PRCHCON1",17,0)
 I $P($G(^PRCS(410,DA,3)),U,4)="" W !,"This transaction has no entry in the Vendor File.",!,"Please edit this transaction's vendor before converting this order." H 4 Q
"RTN","PRCHCON1",18,0)
 I $P($G(^PRCS(410,DA,4)),U)>3000 W !,"The dollar amount for this transaction exceeds the $3000 purchase card cutoff." H 4 Q
"RTN","PRCHCON1",19,0)
 D W1^PRCSEB0 Q:%<0  S DIC=PRCSDIC
"RTN","PRCHCON1",20,0)
 L +^PRCS(410,DA):15 G:$T=0 START S T1=ODA,T2=^PRCS(410,DA,0),T4=$P(T2,"^",2),T2=$P(T2,"^"),T3=$P(^(3),"^")
"RTN","PRCHCON1",21,0)
 N REM,REM1 S REM=DA,REM1=+$P(PRC("CP")," ")
"RTN","PRCHCON1",22,0)
 L -^PRCS(410,DA) K DA,DIC,Y
"RTN","PRCHCON1",23,0)
 W !!,"Enter the information for the new transaction number",!
"RTN","PRCHCON1",24,0)
 D EN^PRCSUT3 Q:'$D(PRC("QTR"))  Q:'$D(PRC("CP"))
"RTN","PRCHCON1",25,0)
 S TX1=X,PRCSAPP=$P(^PRC(420,PRC("SITE"),1,+PRC("CP"),0),"^",3) I PRC("CP")'=T3,PRCSAPP["_" D PRCFY Q:PRCSAPP["_"
"RTN","PRCHCON1",26,0)
 S X=TX1 D EN1^PRCSUT3 Q:'X  S TX1=X,(DIC,DIE)="^PRCS(410,"
"RTN","PRCHCON1",27,0)
CK G:'+T2 CK1 K DA S DLAYGO=410,DIC="^PRCS(410,",DIC(0)="LXZ" D ^DIC K DLAYGO Q:Y'>0  S DA=+Y
"RTN","PRCHCON1",28,0)
 K ^PRCS(410,"B",TX1,DA),^PRCS(410,"B2",$P(TX1,"-",5),DA),^PRCS(410,"B3",$P(TX1,"-",2)_"-"_$P(TX1,"-",5),DA),^PRCS(410,"AE",$P(TX1,"-",1,4),DA)
"RTN","PRCHCON1",29,0)
 K ^PRCS(410,"B",T2,T1),^PRCS(410,"B2",$P(T2,"-",5),T1),^PRCS(410,"B3",$P(T2,"-",2)_"-"_$P(T2,"-",5),T1),^PRCS(410,"AE",$P(T2,"-",1,4),T1)
"RTN","PRCHCON1",30,0)
 S $P(^PRCS(410,DA,0),U)=T2 S (^PRCS(410,"B",T2,DA),^PRCS(410,"B2",$P(T2,"-",5),DA),^PRCS(410,"B3",$P(T2,"-",2)_"-"_$P(T2,"-",5),DA),^PRCS(410,"AE",$P(T2,"-",1,4),DA))=""
"RTN","PRCHCON1",31,0)
CK1 S $P(^PRCS(410,T1,0),U)=TX1 S (^PRCS(410,"B",TX1,T1),^PRCS(410,"B2",$P(TX1,"-",5),T1),^PRCS(410,"B3",$P(TX1,"-",2)_"-"_$P(TX1,"-",5),T1),^PRCS(410,"AE",$P(TX1,"-",1,4),T1))=""
"RTN","PRCHCON1",32,0)
 S $P(^PRCS(410,T1,6),"^",4)="" K ^PRCS(410,"K",REM1,REM)
"RTN","PRCHCON1",33,0)
 I '+T2 S DA=ODA,DIE="^PRCS(410,",DR=".5///"_PRC("SITE")_";S X=X;15///"_PRC("CP") D ^DIE G EN
"RTN","PRCHCON1",34,0)
 S DIE="^PRCS(410,",DR=".5///"_+T2_";S X=X;15///"_T3_";60///Transaction "_T2_" replaced by trans. "_TX1
"RTN","PRCHCON1",35,0)
 D ^DIE S $P(^PRCS(410,DA,0),U,2)="CA" D ERS410^PRC0G(DA_"^C"),W5^PRCSEB W !,"Old transaction "_T2_" is now cancelled.",!
"RTN","PRCHCON1",36,0)
 I $D(^PRC(443,ODA,0)) S DA=ODA,DIK="^PRC(443," D ^DIK K DA,DIK
"RTN","PRCHCON1",37,0)
EN W !!,"Transaction '"_T2_"' has been replaced by "_TX1,! S PNW=ODA,PNW(1)=TX1
"RTN","PRCHCON1",38,0)
 S TRY=0
"RTN","PRCHCON1",39,0)
RETRY ;
"RTN","PRCHCON1",40,0)
 S TRY=TRY+1 Q:TRY>3
"RTN","PRCHCON1",41,0)
 N A,B S DA=PNW L +^PRCS(410,DA):15 G:$T=0 RETRY
"RTN","PRCHCON1",42,0)
 S DA=PNW
"RTN","PRCHCON1",43,0)
 S A=TX1 D RBQTR
"RTN","PRCHCON1",44,0)
 S DA=PNW,DR=B_$S(+T2:"1///"_T4,1:"")_$S(PRC("SITE")'=+T2:";S X=X;.5///"_PRC("SITE"),1:"")_$S(PRC("CP")'=T3:";S X=X;15///"_PRC("CP"),1:"")_$S($D(PRCSIP):";4////"_PRCSIP,1:"")
"RTN","PRCHCON1",45,0)
 D ^DIE S PRC("ACC")=$$ACC^PRC0C(PRC("SITE"),PRC("CP")_"^"_PRC("FY")_"^"_PRC("BBFY"))
"RTN","PRCHCON1",46,0)
 S PRCSAPP=$P(PRC("ACC"),"^",11),$P(^PRCS(410,DA,3),U)=PRC("CP"),$P(^(3),"^",2)=PRCSAPP,$P(^(3),"^",12)=$P(PRC("ACC"),"^",3)
"RTN","PRCHCON1",47,0)
 S $P(^PRCS(410,DA,3),"^",11)=$P($$DATE^PRC0C(PRC("BBFY"),"E"),"^",7)
"RTN","PRCHCON1",48,0)
 N MYY S MYY="" D EN2B^PRCSUT3
"RTN","PRCHCON1",49,0)
 D K^PRCSUT1 K T1(1)
"RTN","PRCHCON1",50,0)
 L -^PRCS(410,DA)
"RTN","PRCHCON1",51,0)
 D ^PRCHCON2 QUIT
"RTN","PRCHCON1",52,0)
 ;;;;;;;;;;;;;;;;
"RTN","PRCHCON1",53,0)
PRCFY I '$D(PRC("FY")) D NOW^%DTC S PRC("FY")=$E(X,2,3) S:$E(X,4,5)>9 PRC("FY")=$E(100+PRC("FY")+1,2,3)
"RTN","PRCHCON1",54,0)
 S A=PRCSAPP I A["_/_" D FY2 G KILL
"RTN","PRCHCON1",55,0)
 I A["_" S PRCSAPP=$P(A,"_",1)_$E(PRC("FY"),$L(PRC("FY")))_$P(A,"_",2)
"RTN","PRCHCON1",56,0)
KILL K %DT,A,B,RES,X Q
"RTN","PRCHCON1",57,0)
FY2 ; two year appropriation
"RTN","PRCHCON1",58,0)
 W !!,"Enter first year of this two year appropriation: ",PRC("FY")," // " R RES:DTIME G:RES["^" FY21 I RES["?"!(RES'?.4N) W !,"Enter fiscal year in format '1' '81' or '1981'",!! G FY2
"RTN","PRCHCON1",59,0)
FY21 S:'RES RES=PRC("FY") S RES=$E(RES,$L(RES)),PRCSAPP=$P(A,"_",1)_RES_"/"_(RES+1#10)_$P(A,"_",3) Q
"RTN","PRCHCON1",60,0)
W5 W !!,"You are not an authorized control point user.",!,"Contact your control point official." R X:5
"RTN","PRCHCON1",61,0)
 Q
"RTN","PRCHCON1",62,0)
RBQTR N C,D S B="",B=$S(B="":$P(A,"-",2)_"^F",1:+$$DATE^PRC0C(B,"I")),C=$$QTRDT^PRC0G($P(A,"-",1)_"^"_$P(A,"-",4)_"^"_B)
"RTN","PRCHCON1",63,0)
 S D=$$QTRDATE^PRC0D($P(A,"-",2),$P(A,"-",3)),D=$P(D,"^",7)
"RTN","PRCHCON1",64,0)
 S B=$S(D<$P(C,"^",3):$P(C,"^",3),$P(C,"^",2)<D:$P(C,"^",2),1:D)
"RTN","PRCHCON1",65,0)
 S B="449////"_B_";"
"RTN","PRCHCON1",66,0)
 QUIT
"RTN","PRCHNPO")
0^11^B57666980^B57667755
"RTN","PRCHNPO",1,0)
PRCHNPO ;WISC/SC,ID/RSD/RHD/DGL/BGJ-ENTER NEW PURCHASE ORDER/REQUISITION ; 4/2/01 1:50pm
"RTN","PRCHNPO",2,0)
V ;;5.1;IFCAP;**7,11,79,108**;Oct 20, 2000;Build 10
"RTN","PRCHNPO",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHNPO",4,0)
 S NOTCOMPL=0 ;Initialize for Incomplete Template.
"RTN","PRCHNPO",5,0)
 D SWITCH^PRCHUTL K ERRFLG ; SET LOG/ISMS SWITCH
"RTN","PRCHNPO",6,0)
 K PRCSIP ; Initialize Inventory point variable
"RTN","PRCHNPO",7,0)
 I $S('$G(PRCHPO):1,'$D(PRC("SITE")):1,1:0) G Q
"RTN","PRCHNPO",8,0)
 S DIE="^PRC(442,",DR="["_$S($D(PRCHNRQ):"PRCHNREQ",1:"PRCH2138")_"]",DIC("DR")="[PRCHVENDOR]"
"RTN","PRCHNPO",9,0)
 I $G(PRCPROST)=1 S DR="[PRCH PROSTHETIC]" D ^DIE QUIT
"RTN","PRCHNPO",10,0)
 I $G(PRCHPC)=1 S DR="[PRCHSIMP]"
"RTN","PRCHNPO",11,0)
 I $G(PRCHPC)=2 S DR="[PRCH DETAILED PURCHASE CARD]"
"RTN","PRCHNPO",12,0)
 I $G(PRCHPC)=3 S DR="[PRCH PC DIRECT DELIVERY]"
"RTN","PRCHNPO",13,0)
 I $G(PRCHDELV)=1,'$G(PRCHPHAM) S DR="[PRCH DELIVERY ORDER]"
"RTN","PRCHNPO",14,0)
 I $G(PRCHPHAM)=1 S DR="[PRCH DIRECT DELIVERY ORDER]"
"RTN","PRCHNPO",15,0)
 D ^DIE
"RTN","PRCHNPO",16,0)
 ;
"RTN","PRCHNPO",17,0)
 ; Check ERRFLG to see if the user entered an up-arrow to get out or
"RTN","PRCHNPO",18,0)
 ; did not select a credit card name. The flag ERRFLG is set at the
"RTN","PRCHNPO",19,0)
 ; input templates above.
"RTN","PRCHNPO",20,0)
 I $G(ERRFLG)=42 G ERR
"RTN","PRCHNPO",21,0)
 I $G(ERRFLG)=38 G ERR
"RTN","PRCHNPO",22,0)
 I $G(ERRFLG)=1 G ERR
"RTN","PRCHNPO",23,0)
 I $G(ERRFLG)=2 G ERR
"RTN","PRCHNPO",24,0)
 I $G(ERRFLG)=3 G ERR
"RTN","PRCHNPO",25,0)
 ;Look for incomplete Input-Template when PRCHPC is defined.
"RTN","PRCHNPO",26,0)
 I $D(PRCHPC)  D
"RTN","PRCHNPO",27,0)
 . I $D(Y)'=0 S NOTCOMPL=1
"RTN","PRCHNPO",28,0)
 I NOTCOMPL G INCMSG
"RTN","PRCHNPO",29,0)
 I $G(PRCHPC)=1 Q:$D(Y)  D  Q:$D(Y)
"RTN","PRCHNPO",30,0)
 . S:'$D(^PRC(442,PRCHPO,2,0)) $P(^PRC(442,PRCHPO,2,0),U,2)=$P(^DD(442,40,0),U,2)
"RTN","PRCHNPO",31,0)
 . S DA(1)=PRCHPO,DIE="^PRC(442,"_DA(1)_",2,",DA=1
"RTN","PRCHNPO",32,0)
 . S DR=".01///^S X=1;1;I '$D(^PRC(442,DA(1),2,DA,1)) W !,""Description is Required!!"" S Y=1;2///^S X=1;3///^S X=""EA"";5////^S X=PRCHTOT;3.1///^S X=1;9.7///^S X=1;9///^S X="""";8///^S X=9999;K PRCHBOCC;"
"RTN","PRCHNPO",33,0)
 . S DR(1,442.01,1)="I PRCHN(""SFC"")=2 S PRCHBOCC=2696;I '$G(PRCHBOCC) S Y=""@87"";"
"RTN","PRCHNPO",34,0)
 . S DR(1,442.01,2)="S PRCHBOCC=$P($G(^PRCD(420.2,PRCHBOCC,0)),U);3.5////^S X=PRCHBOCC;S Y=""@89"";@87;3.5//^S X=PRCHBOC1;@89;K PRCHBOCC"
"RTN","PRCHNPO",35,0)
 . D ^DIE Q:$D(Y)
"RTN","PRCHNPO",36,0)
 . S DIE="^PRC(442,",DA=PRCHPO,DR=20 D ^DIE
"RTN","PRCHNPO",37,0)
PROS I $P($G(^PRC(442,PRCHPO,23)),U,11)]"" Q:$D(Y)  D  Q:$D(Y)  Q:'$G(CDA)
"RTN","PRCHNPO",38,0)
 . S PODIE=DIE,PODA=DA
"RTN","PRCHNPO",39,0)
 . S CDA=$P($G(^PRC(442,PRCHPO,23)),U,23),PRC("CP")=$P($G(^PRC(442,PRCHPO,0)),U,3)
"RTN","PRCHNPO",40,0)
 . I +$G(PRC("CP"))'=0 S DA=PRCHPO D START^PRCH410
"RTN","PRCHNPO",41,0)
 . I '$G(PRCHPHAM),'$G(PRCPROST),+$G(PRC("CP"))'=0 S DIE="^PRCS(410,",DA=$P($G(^PRC(442,PRCHPO,23)),U,23),DR=16 D ^DIE
"RTN","PRCHNPO",42,0)
 . S DIE=PODIE,DA=PODA
"RTN","PRCHNPO",43,0)
 S VEN=+$G(^PRC(442,PRCHPO,1))
"RTN","PRCHNPO",44,0)
 I '$P($G(^PRC(442,PRCHPO,23)),U,11),$P($G(PRCHNVF),U,3)!($G(^PRC(440.3,+$G(VEN),0))]"") D
"RTN","PRCHNPO",45,0)
 . I $P($G(^PRC(411,PRC("SITE"),9)),U,3)="Y" D  Q
"RTN","PRCHNPO",46,0)
 . . S PRCHXXDA=DA
"RTN","PRCHNPO",47,0)
 . . S PRCHXDIE=DIE
"RTN","PRCHNPO",48,0)
 . . S DA=VEN
"RTN","PRCHNPO",49,0)
 . . Q:$$NEW^PRCOVTST(VEN,PRC("SITE"),1)
"RTN","PRCHNPO",50,0)
 . . I $P($G(PRCHNVF),U,3) D
"RTN","PRCHNPO",51,0)
 . . . S %X="^PRC(440,DA,"
"RTN","PRCHNPO",52,0)
 . . . S %Y="^PRC(440.3,DA,"
"RTN","PRCHNPO",53,0)
 . . . D %XY^%RCR
"RTN","PRCHNPO",54,0)
 . . . Q
"RTN","PRCHNPO",55,0)
 . . S DIE="^PRC(440.3,",DR="47///^S X=1;48///^S X=VEN;49///^S X=PRC(""SITE"")"
"RTN","PRCHNPO",56,0)
 . . D ^DIE
"RTN","PRCHNPO",57,0)
 . . S DA=PRCHXXDA
"RTN","PRCHNPO",58,0)
 . . S DIE=PRCHXDIE
"RTN","PRCHNPO",59,0)
 . . K PRCHXXDA
"RTN","PRCHNPO",60,0)
 . . K PRCHXDIE
"RTN","PRCHNPO",61,0)
 . D NEW^PRCOVRQ(VEN,PRC("SITE"))
"RTN","PRCHNPO",62,0)
 K VEN
"RTN","PRCHNPO",63,0)
 L ^PRC(442,PRCHPO):0 G ERR:'$T S PRCHSTAT=$P($G(^PRC(442,PRCHPO,7)),U,2) S:$D(Y)&('$D(PRCHNRQ))&(PRCHSTAT'=22) PRCHER="" S (PRCH,PRCHEC,PRCHX)=0
"RTN","PRCHNPO",64,0)
 S PRCHSC="" I $D(^PRC(442,PRCHPO,1)),$D(^PRCD(420.8,+$P(^(1),U,7),0)) S PRCHSC=$P(^(0),U,1) S $P(^PRC(442,PRCHPO,1),U,14)=$S(PRCHSC="B":"*",1:"")
"RTN","PRCHNPO",65,0)
 ;K PRCHER F  S PRCH=$O(^PRC(442,PRCHPO,2,PRCH)) Q:PRCH=""!(PRCH'>0)  D  G ERR:$D(PRCHER)
"RTN","PRCHNPO",66,0)
 K PRCHER F  S PRCH=$O(^PRC(442,PRCHPO,2,PRCH)) Q:PRCH=""!(PRCH'>0)  D
"RTN","PRCHNPO",67,0)
 .S $P(^PRC(442,PRCHPO,2,PRCH,2),U,6)=""
"RTN","PRCHNPO",68,0)
 .S PRCHLN=$G(^PRC(442,PRCHPO,2,PRCH,0)) ;I PRCHLN="" D ERR2 Q
"RTN","PRCHNPO",69,0)
 .S SUBACC=$P(PRCHLN,U,4) ;I SUBACC="" D ERR2 Q
"RTN","PRCHNPO",70,0)
 .D ERR2
"RTN","PRCHNPO",71,0)
 .Q
"RTN","PRCHNPO",72,0)
 K ^PRC(442,PRCHPO,2,"B"),^("C"),^("AC"),^("AE"),^("AH")
"RTN","PRCHNPO",73,0)
 N PRCHCNYS,PRCHCNNO S (PRCHCNYS,PRCHCNNO)=0 ;FLGS FOR CONTRACT # ON ITEM
"RTN","PRCHNPO",74,0)
 S PRCH=0 F I=1:1 S PRCH=$O(^PRC(442,PRCHPO,2,PRCH)) Q:PRCH=""!(PRCH'>0)  D CHG I $D(^PRC(442,PRCHPO,2,PRCH,0)) D
"RTN","PRCHNPO",75,0)
 .S PRCHAM=+$P(^PRC(442,PRCHPO,2,PRCH,2),U,1),PRCHCN=$P(^(2),U,2) D CN:PRCHCN]"",OM:PRCHCN=""
"RTN","PRCHNPO",76,0)
 .I PRCHCN]"" S PRCHCNYS=1
"RTN","PRCHNPO",77,0)
 .E  S PRCHCNNO=1
"RTN","PRCHNPO",78,0)
 .S $P(^PRC(442,PRCHPO,2,PRCH,2),U,5)=""
"RTN","PRCHNPO",79,0)
 .Q
"RTN","PRCHNPO",80,0)
 S PRCHLCNT=I-1,$P(^PRC(442,PRCHPO,0),U,14)=PRCHLCNT S:$D(^PRC(442,PRCHPO,2,0)) $P(^(0),U,3,4)="1^"_PRCHLCNT I 'PRCHLCNT S PRCHER="" W !,"There are no line items listed in the Purchase Order."
"RTN","PRCHNPO",81,0)
 G ERRCHKS:'$D(^PRC(442,PRCHPO,1))!('$D(^(2)))
"RTN","PRCHNPO",82,0)
 I $P(^PRC(442,PRCHPO,0),U,3)=""!($P(^(0),U,4))="" W !!?5,"Fund Control Point is undefined  !",$C(7)
"RTN","PRCHNPO",83,0)
 S PRCHV=$P(^PRC(442,PRCHPO,1),U,1) I PRCHV="" W !!?5,"Vendor is undefined !",$C(7) ;G ERR
"RTN","PRCHNPO",84,0)
ERRCHKS S ERRFL=0 D ERRCHKS^PRCHNPO9 ;I ERRFL=0 K ERRFL G CONT
"RTN","PRCHNPO",85,0)
 ;K ERRFL G ERR
"RTN","PRCHNPO",86,0)
CONT ;
"RTN","PRCHNPO",87,0)
 S ERROR1="" D ^PRCHNPO9
"RTN","PRCHNPO",88,0)
 I ERROR1=1!(ERRFL>0)!($D(PRCHER)) G ERR
"RTN","PRCHNPO",89,0)
 D BBFY^PRCHNPO8(PRCHPO) I PRC("BBFY")'>0 W !!?5,"BBFY can not be checked/updated.",$C(7) G ERR
"RTN","PRCHNPO",90,0)
 S PRCH=0 F I=0:1 S PRCH=$O(PRCH("AM",PRCH)) Q:PRCH=""  S PRCH("COUNT",+PRCH("AM",PRCH),PRCH)=""
"RTN","PRCHNPO",91,0)
 I PRCHCNNO,PRCHCNYS D ASTR ; <<< only call on ASTR
"RTN","PRCHNPO",92,0)
 G:I=1 ^PRCHNRQ:$D(PRCHNRQ),^PRCHNPO1 S J=1 F PRCHJ=0:0 S PRCH=$O(PRCH("COUNT",PRCH)) Q:PRCH=""  D MISS
"RTN","PRCHNPO",93,0)
 G ^PRCHNRQ:$D(PRCHNRQ),^PRCHNPO1
"RTN","PRCHNPO",94,0)
 ;
"RTN","PRCHNPO",95,0)
LI S PRCHL0=$P(PRCH("AM",PRCHL3),U,3) Q:PRCHL0=""  F J=1:1 S PRCHL1=$E(PRCHL0,$L(PRCHL0)-J) Q:PRCHL1'=+PRCHL1
"RTN","PRCHNPO",96,0)
 S PRCHL2=$E(PRCHL0,$L(PRCHL0)-J+1,$L(PRCHL0)-1),PRCHL2=PRCHL2+1 I PRCHL2'=PRCHLI S PRCHLI=PRCHL0_PRCHLI Q
"RTN","PRCHNPO",97,0)
 I PRCHL1=":" S PRCHLI=$E(PRCHL0,1,$L(PRCHL0)-J)_PRCHLI Q
"RTN","PRCHNPO",98,0)
 S PRCHLI=$E(PRCHL0,1,$L(PRCHL0)-1)_":1:"_PRCHLI
"RTN","PRCHNPO",99,0)
 Q
"RTN","PRCHNPO",100,0)
 ;
"RTN","PRCHNPO",101,0)
CHG I '$P(^PRC(442,PRCHPO,2,PRCH,0),"^",5),'$O(^(1,0)) S $P(^PRC(442,PRCHPO,2,PRCH,2),U,4,6)="^^" W !,"Line item ",+^PRC(442,PRCHPO,2,PRCH,0)," is missing its description!" S PRCHER=""
"RTN","PRCHNPO",102,0)
 S $P(^PRC(442,PRCHPO,2,PRCH,0),U,1)=I,X=$P(^(0),U,5),X1=$P(^(0),U,4)
"RTN","PRCHNPO",103,0)
 S ^PRC(442,PRCHPO,2,"B",I,PRCH)="",^PRC(442,PRCHPO,2,"C",I,PRCH)="",^PRC(442,PRCHPO,2,"AH",+X1,I,PRCH)="",PRCHLI=I,PRCHX=PRCH S:X]"" ^PRC(442,PRCHPO,2,"AE",X,PRCH)=""
"RTN","PRCHNPO",104,0)
 Q
"RTN","PRCHNPO",105,0)
 ;
"RTN","PRCHNPO",106,0)
ERR2 I $S('$D(^PRC(442,PRCHPO,2,PRCH,2)):1,$P(^(2),U,1)="":1,1:0) S $P(^(2),U,1)="",$P(^(2),U,4,7)="" W !,"Line item ",+^(0)," is incomplete !",$C(7) S PRCHER=""
"RTN","PRCHNPO",107,0)
 I '$G(PRCHPC),$D(PRCHNRQ),PRCHSC'=9,$P(^PRC(442,PRCHPO,2,PRCH,0),U,13)="" W !,"Line item ",+^(0)," is missing NSN !",$C(7) S PRCHER=""
"RTN","PRCHNPO",108,0)
 I $P(^PRC(442,PRCHPO,2,PRCH,0),U,4)="" W !,"Line item ",+^(0)," is missing BOC !",!,$C(7) S PRCHER=""
"RTN","PRCHNPO",109,0)
 Q
"RTN","PRCHNPO",110,0)
 ;
"RTN","PRCHNPO",111,0)
CN S:'$D(PRCH("AM",PRCHCN)) PRCH("AM",PRCHCN)="",PRCHEC=PRCHEC+1 S PRCHL3=PRCHCN
"RTN","PRCHNPO",112,0)
 D LI S PRCH("AM",PRCHCN)=($P(PRCH("AM",PRCHCN),U,1)+1)_U_($P(PRCH("AM",PRCHCN),U,2)+PRCHAM)_U_PRCHLI_",",^PRC(442,PRCHPO,2,"AC",$E(PRCHCN,1,30),PRCH)=""
"RTN","PRCHNPO",113,0)
 Q
"RTN","PRCHNPO",114,0)
 ;
"RTN","PRCHNPO",115,0)
OM S:'$D(PRCH("AM",".OM")) PRCH("AM",".OM")="",PRCHEC=PRCHEC+1 S PRCHL3=".OM" D LI S PRCH("AM",".OM")=($P(PRCH("AM",".OM"),U,1)+1)_U_($P(PRCH("AM",".OM"),U,2)+PRCHAM)_U_PRCHLI_","
"RTN","PRCHNPO",116,0)
 Q
"RTN","PRCHNPO",117,0)
 ;
"RTN","PRCHNPO",118,0)
MISS S PRCHN=0 F K=1:1 S PRCHN=$O(PRCH("COUNT",PRCH,PRCHN)) Q:PRCHN=""!(J>(I-1))  S J=J+1,L=0,Y=$P(PRCH("AM",PRCHN),U,3),Y="F PRCHLI="_$E(Y,1,$L(Y)-1)_" S L=L+1 G ERR2:PRCHX<0" X Y
"RTN","PRCHNPO",119,0)
 Q
"RTN","PRCHNPO",120,0)
 ;
"RTN","PRCHNPO",121,0)
ASTR ;IF SOME ITEMS HAVE CN, SOME DO NOT, PLACE '*' ON DISPLAY OF PO
"RTN","PRCHNPO",122,0)
 N CN,ITM,DESC,ROOT
"RTN","PRCHNPO",123,0)
 S ROOT="^PRC(442,PRCHPO)"
"RTN","PRCHNPO",124,0)
 S CN=0 F M=1:1 S CN=$O(@ROOT@(2,"AC",CN)) Q:CN=""  S:$D(^(CN)) ITM=$O(^(CN,0)) S ^PRC(442,PRCHPO,2,"AC",CN,ITM)="*"
"RTN","PRCHNPO",125,0)
 S:PRCHSC="B" $P(^PRC(442,PRCHPO,1),U,14)="*"
"RTN","PRCHNPO",126,0)
 S DESC=0 F I=1:1 S DESC=$O(@ROOT@(2,DESC)) Q:DESC=""!(DESC'>0)  I $P(@ROOT@(2,DESC,2),U,2)']"" S $P(^PRC(442,PRCHPO,2,DESC,2),U,5)="*"
"RTN","PRCHNPO",127,0)
 ;S PRCHX=$O(^PRC(442,PRCHPO,2,"B",PRCHLI,0)) Q:PRCHX=""!('$D(^PRC(442,PRCHPO,2,PRCHX,2)))  S $P(^(2),U,5)=PRCHN("*") S:PRCHN'=".OM" ^PRC(442,PRCHPO,2,"AC",PRCHN,PRCHLI)=PRCHN("*")
"RTN","PRCHNPO",128,0)
 ;I PRCHSC="B",PRCHN=".OM",$D(^PRC(442,PRCHPO,1)),L=1 S ^(1)=$P(^(1),U,1,13)_U_PRCHN("*")_U_$P(^(1),U,15,99)
"RTN","PRCHNPO",129,0)
 Q
"RTN","PRCHNPO",130,0)
 ;
"RTN","PRCHNPO",131,0)
ERR ;
"RTN","PRCHNPO",132,0)
 W !!?5,$S($D(PRCHNRQ):"Requisition",1:"Purchase Order")_" is incomplete and must be re-edited !",$C(7)
"RTN","PRCHNPO",133,0)
INCMSG ;
"RTN","PRCHNPO",134,0)
 I '$D(NOTCOMPL)  D
"RTN","PRCHNPO",135,0)
 . S NOTCOMPL=0
"RTN","PRCHNPO",136,0)
 I NOTCOMPL  D
"RTN","PRCHNPO",137,0)
 . W !!,?5,"Incomplete transaction. It must be re-edited !",$C(7)
"RTN","PRCHNPO",138,0)
Q K ERRDEL,ERRPC,ERRPO,DR,NOTCOMPL,DRTY,IMF,IMFD,LI,MUL,MULMSG,PRCHDRTY,PRCHFSCD,PRCHLCNT,PRCHMUL,PRCHM10,PRCHMS10,PRCHMS11,PRCHUCF,PRTY,SUPUSR,UCF,UCFMSG,UFL,VND
"RTN","PRCHNPO",139,0)
 G Q^PRCHNPO4
"RTN","PRCHNPO",140,0)
 ;
"RTN","PRCHNPO",141,0)
MSG ;Call by the "ENTRY ACTION" for Simplified PC (PRC*5.1*79)
"RTN","PRCHNPO",142,0)
 NEW MSG
"RTN","PRCHNPO",143,0)
 S MSG(1)="*********************************************"
"RTN","PRCHNPO",144,0)
 S MSG(1,"F")="!!?15"
"RTN","PRCHNPO",145,0)
 S MSG(2)="*  IF THE ORDER IS MORE THAN $3000.00       *"
"RTN","PRCHNPO",146,0)
 S MSG(2,"F")="!?15"
"RTN","PRCHNPO",147,0)
 S MSG(3)="*  OR IS ON A CONTRACT, YOU CANNOT USE      *"
"RTN","PRCHNPO",148,0)
 S MSG(3,"F")="!?15"
"RTN","PRCHNPO",149,0)
 S MSG(4)="*        SIMPLIFIED PURCHASE CARD.          *"
"RTN","PRCHNPO",150,0)
 S MSG(4,"F")="!?15"
"RTN","PRCHNPO",151,0)
 S MSG(5)="*  YOU MUST USE DETAILED PURCHASE CARD!!    *"
"RTN","PRCHNPO",152,0)
 S MSG(5,"F")="!?15"
"RTN","PRCHNPO",153,0)
 S MSG(6)="*********************************************"
"RTN","PRCHNPO",154,0)
 S MSG(6,"F")="!?15"
"RTN","PRCHNPO",155,0)
 S MSG(7,"F")="!"
"RTN","PRCHNPO",156,0)
 ;
"RTN","PRCHNPO",157,0)
 D EN^DDIOL(.MSG)
"RTN","PRCHNPO",158,0)
 QUIT
"RTN","PRCHNPO1")
0^7^B54494630^B54452339
"RTN","PRCHNPO1",1,0)
PRCHNPO1 ;SF-ISC/RSD/RHD-CONT. OF NEW PO ;6/9/96  19:48
"RTN","PRCHNPO1",2,0)
V ;;5.1;IFCAP;**16,79,100,108**;Oct 20, 2000;Build 10
"RTN","PRCHNPO1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHNPO1",4,0)
 I ('$G(PRCHPC)!($G(PRCHPC)=2)),'$G(PRCHPHAM) D
"RTN","PRCHNPO1",5,0)
 .S PRCH=0,DIE="^PRC(442,",DR="[PRCHDISCNT]",(D0,DA,DA(1))=PRCHPO
"RTN","PRCHNPO1",6,0)
 .I $G(PRCHDELV) S DR="[PRCHPROMPT]"
"RTN","PRCHNPO1",7,0)
 .D ^DIE
"RTN","PRCHNPO1",8,0)
 F I=1:1 S PRCH=$O(^PRC(442,PRCHPO,3,PRCH)) Q:PRCH=""!(PRCH'>0)  S PRCHCN=$S($P(^(PRCH,0),U,5)]"":$P(^(0),U,5),1:".OM"),PRCHAC=$P(^(0),U,1),PRCHACT=$P(^(0),U,4),PRCHP=$P(^(0),U,2) D SET Q:'$D(PRCHPO)
"RTN","PRCHNPO1",9,0)
 G ERR^PRCHNPO:'$D(PRCHPO) S $P(^PRC(442,PRCHPO,0),U,14)=$P(^PRC(442,PRCHPO,0),U,14)+I-1,PRCHLCNT=$P(^(0),U,14),Y=$G(^PRC(440,PRCHV,2)),PRCHN("LSA")=$P(Y,U,5),PRCHN("MB")=$S(PRCHDT:$P(Y,U,3),1:$P(Y,U,6))
"RTN","PRCHNPO1",10,0)
 S PRCHBO=$S(PRCHDT:1.1,1:1) K PRCHB
"RTN","PRCHNPO1",11,0)
 S X="",PRCH="" F I=0:0 S PRCH=$O(PRCH("AM",PRCH)) Q:PRCH=""  S X=X+$P(PRCH("AM",PRCH),U,2)
"RTN","PRCHNPO1",12,0)
 ;Comment line below for PRC*5.1*79, new FPDS report for Austin
"RTN","PRCHNPO1",13,0)
 ;G:($G(PRCHPC)!$G(PRCHDELV)) EST
"RTN","PRCHNPO1",14,0)
 I $G(PRCHPC)=1 G EST ;skip for Simplified PC orders, PRC*5.1*79
"RTN","PRCHNPO1",15,0)
 I PRCHDT I (X+PRCHEST>25000&("467B"'[PRCHSC))!("013"[PRCHSC)!(PRCHN("MP")=12)!(PRCHN("MP")=5)!(PRCHN("SFC")=1) G E2
"RTN","PRCHNPO1",16,0)
 I $O(^PRC(440,PRCHV,PRCHBO,0)) S PRCHB(0)="^442.16PA^"_$P(^(0),U,3,4) F I=0:0 S I=$O(^PRC(440,PRCHV,PRCHBO,I)) Q:'I  S:$P(^PRCD(420.6,+I,0),"^",5)'="N" PRCHB(I)=I
"RTN","PRCHNPO1",17,0)
 I PRCHDT,'$D(PRCHB) D ER3^PRCHNPO6 G ERR^PRCHNPO
"RTN","PRCHNPO1",18,0)
 D EN6^PRCHNPO2 G ERR^PRCHNPO:'$D(PRCHPO)
"RTN","PRCHNPO1",19,0)
 ;
"RTN","PRCHNPO1",20,0)
 ;Clean up node 25 to place new FPDS data, PRC*5.1*79.
"RTN","PRCHNPO1",21,0)
E2 S DR=$S($G(PRCHPC)=2:"[PRCHAMT89 NEW]",$D(PRCHDELV):"[PRCHAMT89 NEW]",$D(PRCHPHAM):"[PRCHAMT89 NEW]",PRCHDT:"[PRCHAMT89]",1:"[PRCHAMT]")
"RTN","PRCHNPO1",22,0)
 K ^PRC(442,PRCHPO,9),^PRC(442,PRCHPO,25) S $P(^PRC(442,PRCHPO,0),U,15,16)="0^0"
"RTN","PRCHNPO1",23,0)
 ;
"RTN","PRCHNPO1",24,0)
 I PRCHDT D FPDS^PRCHFPD2 G:'PRCHFPDS EST
"RTN","PRCHNPO1",25,0)
 S PRCHY=0 I PRCHEST>0,PRCHEC>0 S PRCHY=PRCHEST/PRCHEC,Y=$P(PRCHY,".",2) I $L(Y)>2 S PRCHY=$P(PRCHY,".",1)+$J("."_Y,2,2)
"RTN","PRCHNPO1",26,0)
 S PRCH=0 F PRCHI=1:1 S PRCH=$O(PRCH("AM",PRCH)) Q:PRCH=""  D TYPE S PRCHAMT=PRCH("AM",PRCH),PRCHCN=$S(PRCH=".OM":"",1:PRCH),DIE("NO^")="NO" W ?40,"AMOUNT: ",PRCHAMT S PRCHAMT=""""_PRCHAMT_"""" D ^DIE
"RTN","PRCHNPO1",27,0)
 ;New tasks for FPDS data collection, PRC*5.1*79.
"RTN","PRCHNPO1",28,0)
 ;Look at the entry actions for POs created by a Purchasing Agent, a PC
"RTN","PRCHNPO1",29,0)
 ;user and a Delivery Orders user and call the required input template.
"RTN","PRCHNPO1",30,0)
 ;PRC*5.1*100 - If the user times out and does not complete the input
"RTN","PRCHNPO1",31,0)
 ;template for the new FPDS, don't allow electronic sig. Check the last
"RTN","PRCHNPO1",32,0)
 ;field required for the PO, based on the source code and menu.
"RTN","PRCHNPO1",33,0)
 I '$D(PRCHPC)&("25"[PRCHSC) D  G:$G(PRCHER)=1 ERR^PRCHNPO
"RTN","PRCHNPO1",34,0)
 . S DR="[PRCH NEW PO FPDS]" D ^DIE
"RTN","PRCHNPO1",35,0)
 . I '$D(^PRC(442,PRCHPO,25)) S PRCHER=1 Q
"RTN","PRCHNPO1",36,0)
 . I $P(^PRC(442,PRCHPO,25),U,6)="" S PRCHER=1 Q
"RTN","PRCHNPO1",37,0)
 . ;Fund agency code & fund agency office code can be empty in pairs only.
"RTN","PRCHNPO1",38,0)
 . I +$P(^PRC(442,PRCHPO,25),U,7)>0,$P(^PRC(442,PRCHPO,25),U,8)="" S PRCHER=1 Q
"RTN","PRCHNPO1",39,0)
 ;
"RTN","PRCHNPO1",40,0)
 ;For FPDS purposes, consider any PO with any of the following source
"RTN","PRCHNPO1",41,0)
 ;codes as a delivery order (including direct delivery POs)from a PA:
"RTN","PRCHNPO1",42,0)
 ;If the user times out, don't allow electronic sig., PRC*5.1*100.
"RTN","PRCHNPO1",43,0)
 I ("467B"[PRCHSC)&($D(^PRC(442,PRCHPO,14)))!($G(PRCHPC)=3) D  G:$G(PRCHER)=1 ERR^PRCHNPO
"RTN","PRCHNPO1",44,0)
 . S DR="[PRCH NEW PO FPDS]" D ^DIE
"RTN","PRCHNPO1",45,0)
 . I '$D(^PRC(442,PRCHPO,25)) S PRCHER=1 Q
"RTN","PRCHNPO1",46,0)
 . I $P(^PRC(442,PRCHPO,25),U,15)'="" D POP Q
"RTN","PRCHNPO1",47,0)
 . E  S PRCHER=1
"RTN","PRCHNPO1",48,0)
 ;
"RTN","PRCHNPO1",49,0)
 ;Get eligible Detailed purchase card orders. If the user times out,
"RTN","PRCHNPO1",50,0)
 ;don't allow electronic signature, PRC*5.1*100.
"RTN","PRCHNPO1",51,0)
 I $G(PRCHPC)=2 D  G:$G(PRCHER)=1 ERR^PRCHNPO
"RTN","PRCHNPO1",52,0)
 . S DR="[PRCH NEW PC FPDS]" D ^DIE
"RTN","PRCHNPO1",53,0)
 . I '$D(^PRC(442,PRCHPO,25)) S PRCHER=1 Q
"RTN","PRCHNPO1",54,0)
 . S PRCHSC=$P(^PRCD(420.8,+PRCHSC,0),U,1)
"RTN","PRCHNPO1",55,0)
 . I ("2"[PRCHSC)&($P(^PRC(442,PRCHPO,25),U,6)="") S PRCHER=1 Q
"RTN","PRCHNPO1",56,0)
 . ;Fund agency code & fund agency office code can be empty in pairs only.
"RTN","PRCHNPO1",57,0)
 . I ("2"[PRCHSC)&(+$P(^PRC(442,PRCHPO,25),U,7)>0),$P(^PRC(442,PRCHPO,25),U,8)="" S PRCHER=1 Q
"RTN","PRCHNPO1",58,0)
 . I ("6B"[PRCHSC)&($P(^PRC(442,PRCHPO,25),U,13)="") S PRCHER=1 Q
"RTN","PRCHNPO1",59,0)
 ;
"RTN","PRCHNPO1",60,0)
 ;Get delivery orders from the separate Delivery Orders menu. If the
"RTN","PRCHNPO1",61,0)
 ;user times out, don't allow electronic sig.; PRC*5.1*100.
"RTN","PRCHNPO1",62,0)
 I $G(PRCHDELV)=1!($G(PRCHPHAM)=1) D  G:$G(PRCHER)=1 ERR^PRCHNPO
"RTN","PRCHNPO1",63,0)
 . S DR="[PRCH NEW DEL FPDS]" D ^DIE
"RTN","PRCHNPO1",64,0)
 . I '$D(^PRC(442,PRCHPO,25)) S PRCHER=1 Q
"RTN","PRCHNPO1",65,0)
 . I $P(^PRC(442,PRCHPO,25),U,15)'="" D POP Q
"RTN","PRCHNPO1",66,0)
 . E  S PRCHER=1
"RTN","PRCHNPO1",67,0)
 ;
"RTN","PRCHNPO1",68,0)
 ;End of changes for PRC*5.1*79.
"RTN","PRCHNPO1",69,0)
 K DIE F I=0:0 Q:'$D(PRCHPO)  S I=$O(^PRC(442,PRCHPO,9,I)) Q:'I  D ER2^PRCHNPO6:$P(^(I,0),"^",2)="",ER3^PRCHNPO6:'$O(^(1,0))
"RTN","PRCHNPO1",70,0)
 ;PRC*5.1*100 - Quit if user fails to populate any required field in
"RTN","PRCHNPO1",71,0)
 ;node 9 (amount, type code, pref. program, etc.) or just times out.
"RTN","PRCHNPO1",72,0)
 ;
"RTN","PRCHNPO1",73,0)
 N J,K,L S K=+$P(^PRC(442,PRCHPO,9,0),U,3)
"RTN","PRCHNPO1",74,0)
 F L=1:1:K D  G:$G(PRCHER)=1 ERR^PRCHNPO
"RTN","PRCHNPO1",75,0)
 . F J=1,2,4,5 D
"RTN","PRCHNPO1",76,0)
 .. I $P(^PRC(442,PRCHPO,9,L,0),"^",J)="" S PRCHER=1
"RTN","PRCHNPO1",77,0)
 ;End of changes for PRC*5.1*100.
"RTN","PRCHNPO1",78,0)
 ;
"RTN","PRCHNPO1",79,0)
EST G ERR^PRCHNPO:'$D(PRCHPO) I 'PRCHEST,PRCHESTL S $P(^PRC(442,PRCHPO,0),U,18)=""
"RTN","PRCHNPO1",80,0)
 D EN2^PRCHNPO7 I PRCHEST D EST^PRCHNPO6
"RTN","PRCHNPO1",81,0)
 I $P($G(^PRC(442,PRCHPO,23)),U,11)="",PRCHSTAT'=22 S (X,Y)=5,DA=PRCHPO D UPD^PRCHSTAT
"RTN","PRCHNPO1",82,0)
 I $G(PRCHPC)=2!$G(PRCHDELV) S (D0,DA)=PRCHPO D ^PRCHSF
"RTN","PRCHNPO1",83,0)
 I '$G(PRCPROST) S %=1,%B="",%A="     Review "_$S($G(PRCHPC):"Purchase Card",$G(PRCHDELV):"Delivery",1:"Purchase")_" Order " D ^PRCFYN I %=1 S D0=PRCHPO D ^PRCHDP1
"RTN","PRCHNPO1",84,0)
 I PRCHSTAT=22 S (D0,DA)=PRCHPO D ^PRCHSF G Q^PRCHNPO4
"RTN","PRCHNPO1",85,0)
 G ^PRCHNPO4
"RTN","PRCHNPO1",86,0)
 ;
"RTN","PRCHNPO1",87,0)
SET G:PRCHAC="Q" PCTQ
"RTN","PRCHNPO1",88,0)
 I PRCHAC[":" S PRCHAC=$P(PRCHAC,":",1)_":1:"_$P(PRCHAC,":",2)
"RTN","PRCHNPO1",89,0)
 ;
"RTN","PRCHNPO1",90,0)
PCT S PRCHAMT=0,Y="F J="_PRCHAC_" S PRCHN=J D PCT1 G:$D(PRCHER) Q" X Y Q:'$D(PRCHPO)
"RTN","PRCHNPO1",91,0)
 S PRCHAMT=PRCHAMT*100+.5\1/100,$P(PRCH("AM",PRCHCN),U,2)=$P(PRCH("AM",PRCHCN),U,2)-PRCHAMT
"RTN","PRCHNPO1",92,0)
 S $P(^PRC(442,PRCHPO,3,PRCH,0),U,3)=PRCHAMT,$P(^(0),U,6)=I+PRCHLCNT
"RTN","PRCHNPO1",93,0)
 Q
"RTN","PRCHNPO1",94,0)
 ;
"RTN","PRCHNPO1",95,0)
PCT1 I $D(^PRC(442,PRCHPO,2,"B",PRCHN)) S GTFLAG="" D  G:GTFLAG=1 ER^PRCHNPO6 G:GTFLAG=2 ER1^PRCHNPO6
"RTN","PRCHNPO1",96,0)
 .S PRCHN=$O(^PRC(442,PRCHPO,2,"B",PRCHN,0)),PRCHD=+$P($G(^PRC(442,PRCHPO,2,PRCHN,2)),U,1) I PRCHD'>0 S GTFLAG=1 Q
"RTN","PRCHNPO1",97,0)
 .I $S(PRCHCN=".OM"&($P(^(2),U,2)=""):0,PRCHCN=$P(^(2),U,2):0,1:1) S GTFLAG=2 Q
"RTN","PRCHNPO1",98,0)
 .S PRCHDA=0
"RTN","PRCHNPO1",99,0)
 .I $E(PRCHP,1)="$" S PRCHDA=$P(PRCHP,"$",2)/PRCHACT
"RTN","PRCHNPO1",100,0)
 .E  S PRCHDA=$J(PRCHD*(PRCHP/100),0,2)
"RTN","PRCHNPO1",101,0)
 .S PRCHAMT=PRCHAMT+PRCHDA,$P(^PRC(442,PRCHPO,2,PRCHN,2),U,6)=PRCHDA
"RTN","PRCHNPO1",102,0)
 Q
"RTN","PRCHNPO1",103,0)
 ;
"RTN","PRCHNPO1",104,0)
PCTQ S (PRCHAMT,PRCHCN,PRCHX)=0,PRCHACT=PRCHLCNT F K=0:0 S PRCHCN=$O(PRCH("AM",PRCHCN)) Q:PRCHCN=""  S PRCHAC=$E($P(PRCH("AM",PRCHCN),U,3),1,$L($P(PRCH("AM",PRCHCN),U,3))-1) D PCT Q:'$D(PRCHPO)  S PRCHX=PRCHX+PRCHAMT
"RTN","PRCHNPO1",105,0)
 Q:'$D(PRCHPO)  S $P(^PRC(442,PRCHPO,3,PRCH,0),U,3)=PRCHX
"RTN","PRCHNPO1",106,0)
 Q
"RTN","PRCHNPO1",107,0)
 ;
"RTN","PRCHNPO1",108,0)
POP ;Set up place of performance for PRC*5.1*79, new FPDS. If station is the
"RTN","PRCHNPO1",109,0)
 ;place of perf. for PO, send the state abbrev. and zip code, otherwise
"RTN","PRCHNPO1",110,0)
 ;send the vendor's state and zip code. Applies to all Delivery POs.
"RTN","PRCHNPO1",111,0)
 ;For Guaranteed Delivery orders, we have to choose the VAMC since users
"RTN","PRCHNPO1",112,0)
 ;are not asked for a SHIP TO location - PRC*5.1*100.
"RTN","PRCHNPO1",113,0)
 N PRCST,PRCSTL,PRCSZP,PRCPOP,PRCLOC,PRCROOT,PRCVAMC
"RTN","PRCHNPO1",114,0)
 I $P(^PRC(442,PRCHPO,25),"^",15)="Y" D
"RTN","PRCHNPO1",115,0)
 . I $P(^PRC(442,PRCHPO,0),"^",2)=4 D POP1 Q
"RTN","PRCHNPO1",116,0)
 . S PRCLOC=$P(^PRC(442,PRCHPO,1),U,3) ;ship to location
"RTN","PRCHNPO1",117,0)
 . S PRCST=$P(^PRC(411,PRC("SITE"),1,PRCLOC,0),"^",6)  ;station's state
"RTN","PRCHNPO1",118,0)
 . S PRCSTL=$P(^DIC(5,PRCST,0),"^",2)
"RTN","PRCHNPO1",119,0)
 . S PRCSZP=$P(^PRC(411,PRC("SITE"),1,PRCLOC,0),"^",7) ;station's zip
"RTN","PRCHNPO1",120,0)
 . S PRCPOP=PRCSTL_PRCSZP,$P(^PRC(442,PRCHPO,25),"^",16)=PRCPOP
"RTN","PRCHNPO1",121,0)
 . Q
"RTN","PRCHNPO1",122,0)
 I $P(^PRC(442,PRCHPO,25),"^",15)="N" D
"RTN","PRCHNPO1",123,0)
 . S PRCST=$P(^PRC(440,PRCHV,0),"^",7) ;vendor's state
"RTN","PRCHNPO1",124,0)
 . S PRCSTL=$P(^DIC(5,PRCST,0),"^",2)
"RTN","PRCHNPO1",125,0)
 . S PRCSZP=$E($P(^PRC(440,PRCHV,0),"^",8),1,5) ;vendor's zip
"RTN","PRCHNPO1",126,0)
 . S PRCPOP=PRCSTL_PRCSZP,$P(^PRC(442,PRCHPO,25),"^",16)=PRCPOP
"RTN","PRCHNPO1",127,0)
 Q
"RTN","PRCHNPO1",128,0)
 ;
"RTN","PRCHNPO1",129,0)
POP1 ;Set up for Guaranteed Delivery orders - users are not asked for a SHIP
"RTN","PRCHNPO1",130,0)
 ;TO location during PO creation - PRC*5.1*100.
"RTN","PRCHNPO1",131,0)
 S PRCROOT=$G(^PRC(411,PRC("SITE"),0)),PRCVAMC=$G(^(3)) ; local VAMC
"RTN","PRCHNPO1",132,0)
 S PRCST=$P(PRCVAMC,"^",4)
"RTN","PRCHNPO1",133,0)
 S PRCSTL=$P(^DIC(5,PRCST,0),"^",2) ;station's state
"RTN","PRCHNPO1",134,0)
 S PRCSZP=$E($P(PRCVAMC,"^",5),1,5) ;station's zip
"RTN","PRCHNPO1",135,0)
 S PRCPOP=PRCSTL_PRCSZP,$P(^PRC(442,PRCHPO,25),"^",16)=PRCPOP
"RTN","PRCHNPO1",136,0)
 Q
"RTN","PRCHNPO1",137,0)
 ;End of changes for new FPDS
"RTN","PRCHNPO1",138,0)
 ;
"RTN","PRCHNPO1",139,0)
TYPE I PRCHI=PRCHEC,PRCHEST'=(PRCHY*PRCHEC) S PRCHY=PRCHY+(PRCHEST-(PRCHY*PRCHEC))
"RTN","PRCHNPO1",140,0)
 I PRCHY>0 S PRCH("AM",PRCH)=$P(PRCH("AM",PRCH),U,1)_U_($P(PRCH("AM",PRCH),U,2)+PRCHY)_U_$P(PRCH("AM",PRCH),U,3)
"RTN","PRCHNPO1",141,0)
 ;When Source Code is not 5 then display a list of Possible Type Codes
"RTN","PRCHNPO1",142,0)
 I PRCHSC'=5 D
"RTN","PRCHNPO1",143,0)
 . W !,$S(PRCH'=".OM":"CONTRACT/BOA: "_PRCH,1:""),"  Possible ",$S(PRCHDT:"Method/Type Codes: ",1:"Type Codes: ")
"RTN","PRCHNPO1",144,0)
 . I 'PRCHDT S I=0 F Y=0:0 S Y=$O(^PRCD(420.6,Y)) S:Y>100 Y="" Q:'Y  D EN7^PRCHNPO2 I $T W:I "," W $P(^PRCD(420.6,Y,0),"^",1) S I=I+1
"RTN","PRCHNPO1",145,0)
 . I PRCHDT S I=0 F Y=100:0 S Y=$O(^PRCD(420.6,Y)) S:Y>120 Y="" Q:'Y  D PROC^PRCHFPDS I $T W:I "," W $P(^PRCD(420.6,Y,0),U,1) S I=I+1
"RTN","PRCHNPO1",146,0)
 . Q
"RTN","PRCHNPO1",147,0)
 ;
"RTN","PRCHNPO1",148,0)
 S PRCHX=$P(PRCH("AM",PRCH),U,3),K=0
"RTN","PRCHNPO1",149,0)
 I PRCHX]"" W !?1,"ITEM: " W:PRCHX'[":1:" PRCHX I PRCHX[":1:" F J=0:0 S PRCHX=$P(PRCHX,":1:",1)_":"_$P(PRCHX,":1:",2,99) I PRCHX'[":1:" W PRCHX Q
"RTN","PRCHNPO1",150,0)
 S:$P(PRCH("AM",PRCH),U,2)]"" PRCH("AM",PRCH)=$P(PRCH("AM",PRCH),U,2)
"RTN","PRCHNPO1",151,0)
 Q
"RTN","PRCHNPO1",152,0)
 ;
"RTN","PRCHNPO1",153,0)
Q L  K PRCH,PRCHAC,PRCHACT,PRCHAM,PRCHAMT,PRCHB,PRCHBO,PRCHCN,PRCHCNT,PRCHD,PRCHDA,PRCHDT,PRCHEC,PRCHER,PRCHES,PRCHEST,PRCHFPDS,PRCHI,PRCHL0,PRCHL1,PRCHL2,PRCHL3,PRCHLCNT,PRCHLI
"RTN","PRCHNPO1",154,0)
 K PRCHN,PRCHP,PRCHPO,PRCHSC,PRCHV,PRCHX,PRCHY,DIC,DIE,DR,D0,DA,X,Y
"RTN","PRCHNPO1",155,0)
 Q
"RTN","PRCHNPT")
0^8^B1872539^B893681
"RTN","PRCHNPT",1,0)
PRCHNPT ;SF/TKW-INPUT TRANSFORM ;9-1-89/1:58 PM
"RTN","PRCHNPT",2,0)
V ;;5.1;IFCAP;**108**;Oct 20, 2000;Build 10
"RTN","PRCHNPT",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","PRCHNPT",4,0)
EN1 ;INPUT TRANSFORM FOR NSN (FIELD #5) ON ITEM MASTER FILE (441)
"RTN","PRCHNPT",5,0)
 Q:'$D(X)  I '$D(^PRC(441.2,+X,0)) W $C(7),!,"First 4 digits MUST be an FSC code!!" K X Q
"RTN","PRCHNPT",6,0)
 S Z=$O(^PRC(441,"BB",X,0)) S:Z=DA Z=$O(^(DA)) I Z W $C(7),!,"This NSN has already been assigned to Item # "_Z_"!!" K X,Z Q
"RTN","PRCHNPT",7,0)
 K Z Q
"RTN","PRCHNPT",8,0)
 ; --------------------
"RTN","PRCHNPT",9,0)
 ; *108 - additional Input Transform code and Executable Help code added 4/6/2007 by T. Holloway
"RTN","PRCHNPT",10,0)
 ;
"RTN","PRCHNPT",11,0)
CONTRACT(PRCDA1,PRCINPUT) ; 443.6 : 443.61 : 4 - CONTRACT/BOA # Input Transform
"RTN","PRCHNPT",12,0)
 ; PRCDA1 = the IEN for file 443.6 passed in from the DA(1) variable.
"RTN","PRCHNPT",13,0)
 ; PRCINPUT = the user input passed in from the X variable
"RTN","PRCHNPT",14,0)
 N D,DA,DIC,DR,X
"RTN","PRCHNPT",15,0)
 S X=PRCINPUT
"RTN","PRCHNPT",16,0)
 S DA(1)=+$P(^PRC(443.6,PRCDA1,1),U)
"RTN","PRCHNPT",17,0)
 S DIC="^PRC(440,DA(1),4,",DIC(0)="QELM"
"RTN","PRCHNPT",18,0)
 D ^DIC K DIC
"RTN","PRCHNPT",19,0)
 Q Y
"RTN","PRCHNPT",20,0)
 ;
"RTN","PRCHNPT",21,0)
HLPCON(PRCDA1,PRCINPUT) ; 443.6 : 443.61 : 4 - CONTRACT/BOA # Executable Help
"RTN","PRCHNPT",22,0)
 ; PRCDA1 = the IEN for file 443.6 passed in from the DA(1) variable.
"RTN","PRCHNPT",23,0)
 ; PRCINPUT = the user input passed in from the X variable, will be some form of ?.
"RTN","PRCHNPT",24,0)
 N D,DA,DIC,DR,X,Y,Z1
"RTN","PRCHNPT",25,0)
 S X=PRCINPUT
"RTN","PRCHNPT",26,0)
 S DA(1)=+$P(^PRC(443.6,PRCDA1,1),U),Z1=$P(^(1),U,7)
"RTN","PRCHNPT",27,0)
 I '$D(^PRC(440,DA(1),4,0)) Q
"RTN","PRCHNPT",28,0)
 S DIC("S")=$S(Z1=2:"I $P(^PRC(440,DA(1),4,+Y,0),U,6)'=""B""",1:"I 1")
"RTN","PRCHNPT",29,0)
 S DIC="^PRC(440,DA(1),4,",DIC(0)="QEM" D ^DIC
"RTN","PRCHNPT",30,0)
 Q
"RTN","PRCPAGP0")
0^6^B18058628^B18043052
"RTN","PRCPAGP0",1,0)
PRCPAGP0 ;WISC/RFJ-autogenerate primary or warehouse order               ;11 Dec 92
"RTN","PRCPAGP0",2,0)
 ;;5.1;IFCAP;**108**;Oct 20, 2000;Build 10
"RTN","PRCPAGP0",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPAGP0",4,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPAGP0",5,0)
 I "PW"'[PRCP("DPTYPE") W !!,"THIS OPTION CAN ONLY BE USED BY A PRIMARY OR WHSE INVENTORY POINT." Q
"RTN","PRCPAGP0",6,0)
 N %,G,GROUP,GROUPALL,GROUPNM,PRCPEXIT,PRCPFLAG,PRCPREPN,VENDALL,WHSE,X,Y
"RTN","PRCPAGP0",7,0)
 S WHSE=+$O(^PRC(440,"AC","S",0)) I 'WHSE W !!,"WAREHOUSE VENDOR HAS NOT BEEN CREATED IN VENDOR FILE." Q
"RTN","PRCPAGP0",8,0)
 ;
"RTN","PRCPAGP0",9,0)
 ;  get repetitive item list number
"RTN","PRCPAGP0",10,0)
 S %="==========  PART 1:  REPETITIVE ITEM LIST NUMBER  ==========" W !!?(80-$L(%)\2),%
"RTN","PRCPAGP0",11,0)
 S PRCPREPN=$$GETRIL^PRCPAGPR I PRCPREPN="" Q
"RTN","PRCPAGP0",12,0)
 ;
"RTN","PRCPAGP0",13,0)
 ;  select group categories
"RTN","PRCPAGP0",14,0)
 S %="==========  PART 2A:  SELECTION OF GROUP CATEGORIES  ==========" W !!?(80-$L(%)\2),%
"RTN","PRCPAGP0",15,0)
 W !!,"Selected group categories and vendors will be used to auto-generate the order."
"RTN","PRCPAGP0",16,0)
 K ^TMP($J,"PRCPAG") D ALLGRP I $G(PRCPFLAG) Q
"RTN","PRCPAGP0",17,0)
 F  D  I $G(PRCPFLAG) Q
"RTN","PRCPAGP0",18,0)
 .   I $O(^TMP($J,"PRCPAG","GY",0))!($G(GROUPALL)) D
"RTN","PRCPAGP0",19,0)
 .   .   W !!,"  Currently selected group categories:",!,"  "
"RTN","PRCPAGP0",20,0)
 .   .   I $G(GROUPALL) W "<< ALL GROUP CATEGORIES >>"
"RTN","PRCPAGP0",21,0)
 .   .   E  S G=0 F  S G=$O(^TMP($J,"PRCPAG","GY",G)) Q:'G  S %=$E(^(G),1,20),%=%_$E("                    ",$L(%),20) W:$X>70 !,"  " W %,"  "
"RTN","PRCPAGP0",22,0)
 .   .   W !,"  You can DE-select one of the above group categories by reselecting it."
"RTN","PRCPAGP0",23,0)
 .   I $O(^TMP($J,"PRCPAG","GN",0)) D
"RTN","PRCPAGP0",24,0)
 .   .   W !!,"  Currently DE-selected group categories:",!,"  "
"RTN","PRCPAGP0",25,0)
 .   .   S G=0 F  S G=$O(^TMP($J,"PRCPAG","GN",G)) Q:'G  S %=$E(^(G),1,20),%=%_$E("                    ",$L(%),20) W:$X>70 !,"  " W %,"  "
"RTN","PRCPAGP0",26,0)
 .   .   W !,"  You can RE-select one of the above group categories by reselecting it."
"RTN","PRCPAGP0",27,0)
 .   W !!,"Select the name of the group category created for this primary, '^' to exit."
"RTN","PRCPAGP0",28,0)
 .   S GROUP=$$GROUP^PRCPEGRP(PRCP("I"),"") I GROUP<0 S (PRCPFLAG,PRCPEXIT)=1 Q
"RTN","PRCPAGP0",29,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPAGP0",30,0)
 .   I GROUP=0,'$O(^TMP($J,"PRCPAG","GY",0)),'$G(GROUPALL) D ALLGRP S:$G(PRCPFLAG) PRCPEXIT=1 Q
"RTN","PRCPAGP0",31,0)
 .   I GROUP=0 S PRCPFLAG=1 Q
"RTN","PRCPAGP0",32,0)
 .   I $G(GROUPALL),'$D(^TMP($J,"PRCPAG","GN",GROUP)) K ^TMP($J,"PRCPAG","GY",GROUP) S ^TMP($J,"PRCPAG","GN",GROUP)=GROUPNM W !?10,"DE-selected !" Q
"RTN","PRCPAGP0",33,0)
 .   I $D(^TMP($J,"PRCPAG","GY",GROUP)) K ^TMP($J,"PRCPAG","GY",GROUP) S ^TMP($J,"PRCPAG","GN",GROUP)=GROUPNM W !?10,"DE-selected !" Q
"RTN","PRCPAGP0",34,0)
 .   I $D(^TMP($J,"PRCPAG","GN",GROUP)) K ^(GROUP) S ^TMP($J,"PRCPAG","GY",GROUP)=GROUPNM W !?10,"RE-selected !" Q
"RTN","PRCPAGP0",35,0)
 .   S ^TMP($J,"PRCPAG","GY",GROUP)=GROUPNM W !?10,"selected !"
"RTN","PRCPAGP0",36,0)
 I $G(PRCPEXIT) D Q Q
"RTN","PRCPAGP0",37,0)
 I $G(GROUPALL) K ^TMP($J,"PRCPAG","GY")
"RTN","PRCPAGP0",38,0)
 I '$G(GROUPALL),'$O(^TMP($J,"PRCPAG","GY",0)) W !!,"NO GROUP CATEGORIES SELECTED." D Q Q
"RTN","PRCPAGP0",39,0)
 ;
"RTN","PRCPAGP0",40,0)
 ;  select vendors
"RTN","PRCPAGP0",41,0)
 S %="==========  PART 2B:  SELECTION OF VENDORS  ==========" W !!?(80-$L(%)\2),%
"RTN","PRCPAGP0",42,0)
 S VENDALL=1
"RTN","PRCPAGP0",43,0)
 I $G(GROUPALL),'$O(^TMP($J,"PRCPAG","GN",0)) D GETVEND^PRCPAGPV I $G(PRCPEXIT) D Q Q
"RTN","PRCPAGP0",44,0)
 ;
"RTN","PRCPAGP0",45,0)
 ;  start running autogen
"RTN","PRCPAGP0",46,0)
 I '$G(VENDALL),'$O(^TMP($J,"PRCPAG","VY",0)) W !!,"NO VENDORS SELECTED." D Q Q
"RTN","PRCPAGP0",47,0)
 I $G(VENDALL),'$O(^TMP($J,"PRCPAG","VN",0)) W !!,"<<< NOTE: Auto-generating for ALL vendors."
"RTN","PRCPAGP0",48,0)
 S %="==========  PART 3:  START AUTO-GENERATION  ==========" W !!?(80-$L(%)\2),%
"RTN","PRCPAGP0",49,0)
 S XP="ARE YOU SURE YOU WANT TO START AUTO-GENERATION",XH="Enter 'YES' to start auto-generating the order, 'NO' or '^' to exit."
"RTN","PRCPAGP0",50,0)
 W !! I $$YN^PRCPUYN(1)=1 D START^PRCPAGP1
"RTN","PRCPAGP0",51,0)
Q K ^TMP($J,"PRCPAG") Q
"RTN","PRCPAGP0",52,0)
 ;
"RTN","PRCPAGP0",53,0)
 ;
"RTN","PRCPAGP0",54,0)
ALLGRP ;  select all group categories
"RTN","PRCPAGP0",55,0)
 K GROUPALL,PRCPFLAG
"RTN","PRCPAGP0",56,0)
 S XP="Do you want to select ALL group categories",XH="Enter 'YES' to auto-generate for ALL inventory items selectable by vendor,",XH(1)="enter 'NO' to auto-generate selectable group category items not selectable by"
"RTN","PRCPAGP0",57,0)
 S XH(2)="vendor, or enter '^' to exit."
"RTN","PRCPAGP0",58,0)
 W ! S %=$$YN^PRCPUYN(1)
"RTN","PRCPAGP0",59,0)
 I %=2 Q
"RTN","PRCPAGP0",60,0)
 I %=1 S GROUPALL=1 Q
"RTN","PRCPAGP0",61,0)
 S PRCPFLAG=1 Q
"RTN","PRCPURS3")
0^5^B16696444^B16751764
"RTN","PRCPURS3",1,0)
PRCPURS3 ;WISC/RFJ-select distribution points                       ;24 May 93
"RTN","PRCPURS3",2,0)
V ;;5.1;IFCAP;**1,108**;Oct 20, 2000;Build 10
"RTN","PRCPURS3",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPURS3",4,0)
 Q
"RTN","PRCPURS3",5,0)
 ;
"RTN","PRCPURS3",6,0)
 ;
"RTN","PRCPURS3",7,0)
DISTRSEL(V1) ;  select distribution points
"RTN","PRCPURS3",8,0)
 ;  v1=inventory point da
"RTN","PRCPURS3",9,0)
 N %,D,DISTR,DISTRNM,PRCPEXIT,PRCPFLAG,PRCPLINE,PRCPINPT
"RTN","PRCPURS3",10,0)
 K ^TMP($J,"PRCPURS3"),DISTRALL
"RTN","PRCPURS3",11,0)
 S PRCPINPT=+V1,PRCPLINE="",$P(PRCPLINE,"-",76)="",PRCPLINE="+"_PRCPLINE_"+"
"RTN","PRCPURS3",12,0)
 S %=$$ALLDISTR I %=0 Q
"RTN","PRCPURS3",13,0)
 I %=1 S DISTRALL=1
"RTN","PRCPURS3",14,0)
 F  D  I $G(PRCPFLAG) Q
"RTN","PRCPURS3",15,0)
 .   W !
"RTN","PRCPURS3",16,0)
 .   I $O(^TMP($J,"PRCPURS3","YES",0))]""!($G(DISTRALL)) D
"RTN","PRCPURS3",17,0)
 .   .   W !?2,PRCPLINE,!?2,"| Currently selected ",$S(PRCP("DPTYPE")="S":"recipients:",1:"distribution points:"),?78,"|"
"RTN","PRCPURS3",18,0)
 .   .   I $G(DISTRALL) W !?2,"| << ALL ",$S(PRCP("DPTYPE")="S":"RECIPIENTS",1:"DISTRIBUTION POINTS")," >>",?78,"|"
"RTN","PRCPURS3",19,0)
 .   .   E  D
"RTN","PRCPURS3",20,0)
 .   .   .   W !?2,"| "
"RTN","PRCPURS3",21,0)
 .   .   .   S D=0 F  S D=$O(^TMP($J,"PRCPURS3","YES",D)) Q:D']""  S %=$E(^(D),1,20),%=%_$E("                    ",$L(%),20) W:$X>70 ?78,"|",!?2,"| " W %,"  "
"RTN","PRCPURS3",22,0)
 .   .   .   W ?78,"|"
"RTN","PRCPURS3",23,0)
 .   .   W !?2,"| You can DE-select one of the above ",$S(PRCP("DPTYPE")="S":"recipients:",1:"distribution points:")," by reselecting it.",?78,"|"
"RTN","PRCPURS3",24,0)
 .   I $O(^TMP($J,"PRCPURS3","NO",0))]""!('$G(DISTRALL)) D
"RTN","PRCPURS3",25,0)
 .   .   W !?2,PRCPLINE,!?2,"| Currently DE-selected ",$S(PRCP("DPTYPE")="S":"recipients:",1:"distribution points:"),?78,"|"
"RTN","PRCPURS3",26,0)
 .   .   I '$G(DISTRALL) W !?2,"| << ALL ",$S(PRCP("DPTYPE")="S":"RECIPIENTS",1:"DISTRIBUTION POINTS")," >>",?78,"|"
"RTN","PRCPURS3",27,0)
 .   .   E  D
"RTN","PRCPURS3",28,0)
 .   .   .   W !?2,"| "
"RTN","PRCPURS3",29,0)
 .   .   .   S D=0 F  S D=$O(^TMP($J,"PRCPURS3","NO",D)) Q:D']""  S %=$E(^(D),1,20),%=%_$E("                    ",$L(%),20) W:$X>70 ?78,"|",!?2,"| " W %,"  "
"RTN","PRCPURS3",30,0)
 .   .   .   W ?78,"|"
"RTN","PRCPURS3",31,0)
 .   .   I PRCP("DPTYPE")'="S" W !?2,"| You can RE-select one of the above distribution points by reselecting it.",?78,"|"
"RTN","PRCPURS3",32,0)
 .   .   I PRCP("DPTYPE")="S" W !?2,"| These recipients can be moved to the SELECTED List by reselecting them.",?78,"|"
"RTN","PRCPURS3",33,0)
 .   W !?2,PRCPLINE
"RTN","PRCPURS3",34,0)
 .   I PRCP("DPTYPE")'="S" S DISTR=$$TO^PRCPUDPT(PRCPINPT)
"RTN","PRCPURS3",35,0)
 .   I PRCP("DPTYPE")="S" S DISTR=$$TOWHOM^PRCPRISS(PRCPINPT)
"RTN","PRCPURS3",36,0)
 .   I DISTR<0 S (PRCPFLAG,PRCPEXIT)=1 Q
"RTN","PRCPURS3",37,0)
 .   S DISTRNM="" I PRCP("DPTYPE")="S",DISTR'=0 S DISTRNM=DISTR
"RTN","PRCPURS3",38,0)
 .   I PRCP("DPTYPE")'="S" S DISTRNM=$$INVNAME^PRCPUX1(DISTR)
"RTN","PRCPURS3",39,0)
 .   I DISTR=0,$O(^TMP($J,"PRCPURS3","YES",0))']"",'$G(DISTRALL) D  Q
"RTN","PRCPURS3",40,0)
 .   .   S %=$$ALLDISTR I %=0 S (PRCPFLAG,PRCPEXIT)=1 Q
"RTN","PRCPURS3",41,0)
 .   .   I %=1 S DISTRALL=1
"RTN","PRCPURS3",42,0)
 .   I DISTR=0 S PRCPFLAG=1 Q
"RTN","PRCPURS3",43,0)
 .   I $G(DISTRALL),'$D(^TMP($J,"PRCPURS3","NO",DISTR)) K ^TMP($J,"PRCPURS3","YES",DISTR) S ^TMP($J,"PRCPURS3","NO",DISTR)=DISTRNM W !?10,"*** DE-selected !" Q
"RTN","PRCPURS3",44,0)
 .   I $D(^TMP($J,"PRCPURS3","YES",DISTR)) K ^TMP($J,"PRCPURS3","YES",DISTR) S ^TMP($J,"PRCPURS3","NO",DISTR)=DISTRNM W !?10,"*** DE-selected !" Q
"RTN","PRCPURS3",45,0)
 .   I $D(^TMP($J,"PRCPURS3","NO",DISTR)) K ^(DISTR) S ^TMP($J,"PRCPURS3","YES",DISTR)=DISTRNM W !?10,"*** RE-selected !" Q
"RTN","PRCPURS3",46,0)
 .   S ^TMP($J,"PRCPURS3","YES",DISTR)=DISTRNM W !?10,"*** selected !"
"RTN","PRCPURS3",47,0)
 I $G(PRCPEXIT) K ^TMP($J,"PRCPURS3"),DISTRALL Q
"RTN","PRCPURS3",48,0)
 I $G(DISTRALL) K ^TMP($J,"PRCPURS3","YES")
"RTN","PRCPURS3",49,0)
 Q
"RTN","PRCPURS3",50,0)
 ;
"RTN","PRCPURS3",51,0)
 ;
"RTN","PRCPURS3",52,0)
ALLDISTR() ;  select all distribution points/recipients
"RTN","PRCPURS3",53,0)
 ;  returns 1 for yes, 2 for no, 0 for ^
"RTN","PRCPURS3",54,0)
 I PRCP("DPTYPE")'="S" D
"RTN","PRCPURS3",55,0)
 .   S XP="Do you want to select ALL distribution points"
"RTN","PRCPURS3",56,0)
 .   S XH="Enter 'YES' to select ALL distr. points, 'NO' to not select all distr. points."
"RTN","PRCPURS3",57,0)
 I PRCP("DPTYPE")="S" D
"RTN","PRCPURS3",58,0)
 .   S XP="Do you want ALL recipients"
"RTN","PRCPURS3",59,0)
 .   S XH="Enter 'YES' to select ALL recipients, 'NO' to select individual recipients."
"RTN","PRCPURS3",60,0)
 Q $$YN^PRCPUYN(1)
"RTN","PRCPUYN")
0^3^B1375817^B1334291
"RTN","PRCPUYN",1,0)
PRCPUYN ;WISC/RFJ-yes,no reader                                    ;29 Dec 93
"RTN","PRCPUYN",2,0)
 ;;5.1;IFCAP;**108**;Oct 20, 2000;Build 10
"RTN","PRCPUYN",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPUYN",4,0)
 Q
"RTN","PRCPUYN",5,0)
 ;
"RTN","PRCPUYN",6,0)
 ;
"RTN","PRCPUYN",7,0)
YN(%) ;  yes, no reader
"RTN","PRCPUYN",8,0)
 ;  %=default answer [1=yes,2=no];
"RTN","PRCPUYN",9,0)
 ;  XP=prompt array [none,1,2,3...];
"RTN","PRCPUYN",10,0)
 ;  XH=help array [none,1,2,3...]
"RTN","PRCPUYN",11,0)
 N I,X
"RTN","PRCPUYN",12,0)
 I '$G(%) S %=3
"RTN","PRCPUYN",13,0)
 F  D  Q:$D(X)
"RTN","PRCPUYN",14,0)
 .   W:$D(XP) !,XP F I=1:1 Q:'$D(XP(I))  W !,XP(I)
"RTN","PRCPUYN",15,0)
 .   W "? ",$P("YES// ^NO// ^<YES/NO> ","^",%)
"RTN","PRCPUYN",16,0)
 .   R X:$S($D(DTIME):DTIME,1:300) E  W "  <<timeout>>" S X=0 Q
"RTN","PRCPUYN",17,0)
 .   I X["^" S X=0 Q
"RTN","PRCPUYN",18,0)
 .   S:X="" X=% S X=$TR($E(X),"yYnN","1122"),X=+X
"RTN","PRCPUYN",19,0)
 .   I X'=1,X'=2 D HELP K X Q
"RTN","PRCPUYN",20,0)
 .   W:$X>73 ! W $P("  (YES)^  (NO)","^",X)
"RTN","PRCPUYN",21,0)
 K XH,XP
"RTN","PRCPUYN",22,0)
 Q X
"RTN","PRCPUYN",23,0)
 ;
"RTN","PRCPUYN",24,0)
HELP I '$D(XH) W !,"You must enter a 'Yes' or a 'No', or you may enter an '^' to Quit",!! Q
"RTN","PRCPUYN",25,0)
 W:$L($G(XH)) !,XH F I=1:1 Q:'$D(XH(I))  W !,XH(I)
"RTN","PRCPUYN",26,0)
 W !
"RTN","PRCPUYN",27,0)
 Q
"UP",443.6,443.61,-1)
443.6^2
"UP",443.6,443.61,0)
443.61
"VER")
8.0^22.0
"^DD",421,421,13.5,0)
APPROPRIATION^FX^^0;16^K:$L(X)>30!($L(X)<4) X
"^DD",421,421,13.5,3)
ANSWER MUST BE 4-30 CHARACTERS IN LENGTH
"^DD",421,421,13.5,21,0)
^^1^1^2930405^^
"^DD",421,421,13.5,21,1,0)
This is the appropriation providing the funds.
"^DD",421,421,13.5,"DT")
3070208
"^DD",443.6,443.61,4,0)
CONTRACT/BOA #^FX^^2;2^K:X[""""!($A(X)=45) X I $D(X) S Y=$$CONTRACT^PRCHNPT(DA(1),X) S X=$P(Y,U,2) K:Y'>0 X
"^DD",443.6,443.61,4,1,0)
^.1
"^DD",443.6,443.61,4,1,1,0)
443.61^AC^MUMPS
"^DD",443.6,443.61,4,1,1,1)
S ^PRC(443.6,DA(1),2,"AC",$E(X,1,30),DA)=""
"^DD",443.6,443.61,4,1,1,2)
K ^PRC(443.6,DA(1),2,"AC",$E(X,1,30),DA)
"^DD",443.6,443.61,4,1,1,"%D",0)
^^1^1^2970416^^^^
"^DD",443.6,443.61,4,1,1,"%D",1,0)
This X-REF is a list of all CONTRACT #s within one P.O.
"^DD",443.6,443.61,4,1,2,0)
443.61^AY^MUMPS
"^DD",443.6,443.61,4,1,2,1)
I $G(PRCHNORE)=1 D:PRCHAMDA=21 EN5^PRCHAMXG Q:PRCHAMDA=21  D FLAG^PRCHMA Q:$T  I PRCHAMDA=23 S PRCHX=X,X=0 D EN5^PRCHAMXD S X=PRCHX K PRCHX
"^DD",443.6,443.61,4,1,2,2)
I $G(PRCHNORE)=1,PRCHAMDA=23 S FLAG=1 D EN5^PRCHAMXD
"^DD",443.6,443.61,4,1,2,"%D",0)
^^5^5^2970416^^^^
"^DD",443.6,443.61,4,1,2,"%D",1,0)
This x-ref will update the CHANGES multiple whenever a 'Line Item Add' or a
"^DD",443.6,443.61,4,1,2,"%D",2,0)
'Line item Edit' amendment changes this field.
"^DD",443.6,443.61,4,1,2,"%D",3,0)
                 
"^DD",443.6,443.61,4,1,2,"%D",4,0)
****NOTE-See routine PRCHAMXA for information on variable PRCHNORE and
"^DD",443.6,443.61,4,1,2,"%D",5,0)
incidence of undefined DIK variable errors.
"^DD",443.6,443.61,4,1,2,"DT")
2950321
"^DD",443.6,443.61,4,3)
Enter a Contract/BOA # (min. 7 chars.) with valid expiration date.
"^DD",443.6,443.61,4,4)
D HLPCON^PRCHNPT(DA(1),X)
"^DD",443.6,443.61,4,21,0)
^^2^2^2970221^^^^
"^DD",443.6,443.61,4,21,1,0)
This is the contract number with valid expiration
"^DD",443.6,443.61,4,21,2,0)
date.
"^DD",443.6,443.61,4,"DT")
2970221
"BLD",5019,6)
^94
**END**
**END**
