Released RG*1*19 SEQ #20
Extracted from mail message
**KIDS**:RG*1.0*19^

**INSTALL NAME**
RG*1.0*19
"BLD",1298,0)
RG*1.0*19^CLINICAL INFO RESOURCE NETWORK^0^3010928^y
"BLD",1298,1,0)
^^3^3^3010928^
"BLD",1298,1,1,0)
MPI/PD UPDATE MENU STRUCTURE
"BLD",1298,1,2,0)
Refer to patch RG*1*19 in the FORUM Patch Module for a complete
"BLD",1298,1,3,0)
description.
"BLD",1298,4,0)
^9.64PA^991.8^1
"BLD",1298,4,991.8,0)
991.8
"BLD",1298,4,991.8,222)
y^n^f^^^^n
"BLD",1298,4,"B",991.8,991.8)

"BLD",1298,"ABNS",0)
^9.66A^^
"BLD",1298,"ABPKG")
^^
"BLD",1298,"KRN",0)
^9.67PA^19^17
"BLD",1298,"KRN",.4,0)
.4
"BLD",1298,"KRN",.401,0)
.401
"BLD",1298,"KRN",.402,0)
.402
"BLD",1298,"KRN",.403,0)
.403
"BLD",1298,"KRN",.5,0)
.5
"BLD",1298,"KRN",.84,0)
.84
"BLD",1298,"KRN",3.6,0)
3.6
"BLD",1298,"KRN",3.6,"NM",0)
^9.68A^1^1
"BLD",1298,"KRN",3.6,"NM",1,0)
RG CIRN DEMOGRAPHIC ISSUES^^0
"BLD",1298,"KRN",3.6,"NM","B","RG CIRN DEMOGRAPHIC ISSUES",1)

"BLD",1298,"KRN",3.8,0)
3.8
"BLD",1298,"KRN",3.8,"NM",0)
^9.68A^^
"BLD",1298,"KRN",9.2,0)
9.2
"BLD",1298,"KRN",9.8,0)
9.8
"BLD",1298,"KRN",9.8,"NM",0)
^9.68A^27^27
"BLD",1298,"KRN",9.8,"NM",1,0)
RGEQDMN^^0^B1078148
"BLD",1298,"KRN",9.8,"NM",2,0)
RGEQDMN1^^0^B7144307
"BLD",1298,"KRN",9.8,"NM",3,0)
RGEQERR^^1^
"BLD",1298,"KRN",9.8,"NM",4,0)
RGJCSUB^^0^B21123290
"BLD",1298,"KRN",9.8,"NM",5,0)
RGJCTS01^^0^B5518077
"BLD",1298,"KRN",9.8,"NM",6,0)
RGJCREC^^0^B37879913
"BLD",1298,"KRN",9.8,"NM",7,0)
RGMTDPSC^^0^B22047403
"BLD",1298,"KRN",9.8,"NM",8,0)
RGPRSSN^^0^B31616698
"BLD",1298,"KRN",9.8,"NM",9,0)
RGRSBULL^^0^B32477517
"BLD",1298,"KRN",9.8,"NM",10,0)
RGRSUTIL^^0^B7937481
"BLD",1298,"KRN",9.8,"NM",11,0)
RGVCCMR1^^0^B46513866
"BLD",1298,"KRN",9.8,"NM",12,0)
RGEXHND1^^0^B33768752
"BLD",1298,"KRN",9.8,"NM",13,0)
RGRSBUL1^^0^B31114951
"BLD",1298,"KRN",9.8,"NM",14,0)
RGMTAUD^^0^B20221164
"BLD",1298,"KRN",9.8,"NM",15,0)
RGMTAUDP^^0^B51146132
"BLD",1298,"KRN",9.8,"NM",16,0)
RGEQRPT^^1^
"BLD",1298,"KRN",9.8,"NM",17,0)
RGEX01^^0^B29533075
"BLD",1298,"KRN",9.8,"NM",18,0)
RGRSPARM^^0^B460879
"BLD",1298,"KRN",9.8,"NM",19,0)
RGSYSTAT^^0^B35876021
"BLD",1298,"KRN",9.8,"NM",20,0)
RGEX03^^0^B48377306
"BLD",1298,"KRN",9.8,"NM",21,0)
RGPRELIG^^1^
"BLD",1298,"KRN",9.8,"NM",22,0)
RGEVPM^^0^B20096016
"BLD",1298,"KRN",9.8,"NM",23,0)
RGEVPRG^^0^B40689550
"BLD",1298,"KRN",9.8,"NM",24,0)
RGHLLOG^^0^B22278333
"BLD",1298,"KRN",9.8,"NM",25,0)
RGJUSITE^^0^B277809
"BLD",1298,"KRN",9.8,"NM",26,0)
RGMTTFL^^0^B15047718
"BLD",1298,"KRN",9.8,"NM",27,0)
RGVCCMR2^^0^B37667624
"BLD",1298,"KRN",9.8,"NM","B","RGEQDMN",1)

"BLD",1298,"KRN",9.8,"NM","B","RGEQDMN1",2)

"BLD",1298,"KRN",9.8,"NM","B","RGEQERR",3)

"BLD",1298,"KRN",9.8,"NM","B","RGEQRPT",16)

"BLD",1298,"KRN",9.8,"NM","B","RGEVPM",22)

"BLD",1298,"KRN",9.8,"NM","B","RGEVPRG",23)

"BLD",1298,"KRN",9.8,"NM","B","RGEX01",17)

"BLD",1298,"KRN",9.8,"NM","B","RGEX03",20)

"BLD",1298,"KRN",9.8,"NM","B","RGEXHND1",12)

"BLD",1298,"KRN",9.8,"NM","B","RGHLLOG",24)

"BLD",1298,"KRN",9.8,"NM","B","RGJCREC",6)

"BLD",1298,"KRN",9.8,"NM","B","RGJCSUB",4)

"BLD",1298,"KRN",9.8,"NM","B","RGJCTS01",5)

"BLD",1298,"KRN",9.8,"NM","B","RGJUSITE",25)

"BLD",1298,"KRN",9.8,"NM","B","RGMTAUD",14)

"BLD",1298,"KRN",9.8,"NM","B","RGMTAUDP",15)

"BLD",1298,"KRN",9.8,"NM","B","RGMTDPSC",7)

"BLD",1298,"KRN",9.8,"NM","B","RGMTTFL",26)

"BLD",1298,"KRN",9.8,"NM","B","RGPRELIG",21)

"BLD",1298,"KRN",9.8,"NM","B","RGPRSSN",8)

"BLD",1298,"KRN",9.8,"NM","B","RGRSBUL1",13)

"BLD",1298,"KRN",9.8,"NM","B","RGRSBULL",9)

"BLD",1298,"KRN",9.8,"NM","B","RGRSPARM",18)

"BLD",1298,"KRN",9.8,"NM","B","RGRSUTIL",10)

"BLD",1298,"KRN",9.8,"NM","B","RGSYSTAT",19)

"BLD",1298,"KRN",9.8,"NM","B","RGVCCMR1",11)

"BLD",1298,"KRN",9.8,"NM","B","RGVCCMR2",27)

"BLD",1298,"KRN",19,0)
19
"BLD",1298,"KRN",19,"NM",0)
^9.68A^52^52
"BLD",1298,"KRN",19,"NM",1,0)
RGMGR^^0
"BLD",1298,"KRN",19,"NM",2,0)
RGPR PRE-IMP MENU^^1^
"BLD",1298,"KRN",19,"NM",3,0)
RGPR PRE-IMP ELIG REPORT^^1^
"BLD",1298,"KRN",19,"NM",4,0)
RGINIT MENU^^1^
"BLD",1298,"KRN",19,"NM",5,0)
RG IRM MENU^^0
"BLD",1298,"KRN",19,"NM",6,0)
RGEQ MGR^^0
"BLD",1298,"KRN",19,"NM",7,0)
RGEQ START^^0
"BLD",1298,"KRN",19,"NM",8,0)
RGEQ STOP^^0
"BLD",1298,"KRN",19,"NM",9,0)
RGEQ ERROR^^1^
"BLD",1298,"KRN",19,"NM",10,0)
RGEQ STATS^^1^
"BLD",1298,"KRN",19,"NM",11,0)
RGCIRN CMOR MAIN^^1^
"BLD",1298,"KRN",19,"NM",12,0)
RGCIRN CMOR START^^1^
"BLD",1298,"KRN",19,"NM",13,0)
RGCIRN CMOR STOP^^1^
"BLD",1298,"KRN",19,"NM",14,0)
RGCIRN CMOR INDIV^^1^
"BLD",1298,"KRN",19,"NM",15,0)
RGCIRN CMOR STATUS^^1^
"BLD",1298,"KRN",19,"NM",16,0)
RGCIRN CMOR DUP SCORES^^1^
"BLD",1298,"KRN",19,"NM",17,0)
RGCIRN CMOR DUP STATS^^1^
"BLD",1298,"KRN",19,"NM",18,0)
RG STATUS DISPLAY^^0
"BLD",1298,"KRN",19,"NM",19,0)
RG ADMIN COORD MENU^^0
"BLD",1298,"KRN",19,"NM",20,0)
RG SUBSCRIBE^^1^
"BLD",1298,"KRN",19,"NM",21,0)
RGCIRN CMOR USER MENU^^1^
"BLD",1298,"KRN",19,"NM",22,0)
RG ADMIN USER MENU^^0
"BLD",1298,"KRN",19,"NM",23,0)
VAFC EXCEPTION HANDLER^^0
"BLD",1298,"KRN",19,"NM",24,0)
RG TRAN/AUD AUD REP^^0
"BLD",1298,"KRN",19,"NM",25,0)
RGMT AUDIT PRINT^^0
"BLD",1298,"KRN",19,"NM",26,0)
RG SUBSCRIPT STAT INQ^^1^
"BLD",1298,"KRN",19,"NM",27,0)
RG EXCEPTION MENU^^0
"BLD",1298,"KRN",19,"NM",28,0)
RG EXCEPTION POTENTIAL MATCH^^0
"BLD",1298,"KRN",19,"NM",29,0)
RG CIRN EXCEPTION HANDLING^^1^
"BLD",1298,"KRN",19,"NM",30,0)
RG EXCEPTION TF INQUIRY^^0
"BLD",1298,"KRN",19,"NM",31,0)
RGPR PRE-IMP SSN REPORT^^0
"BLD",1298,"KRN",19,"NM",32,0)
RGMT AUDIT TF STATISTICS^^0
"BLD",1298,"KRN",19,"NM",33,0)
RGMT AUDIT SINGLE^^0
"BLD",1298,"KRN",19,"NM",34,0)
RG MGT REPORTS^^0
"BLD",1298,"KRN",19,"NM",35,0)
RG EXCEPTION HANDLING^^0
"BLD",1298,"KRN",19,"NM",36,0)
RG CMOR DUP SCORES^^0
"BLD",1298,"KRN",19,"NM",37,0)
RG CMOR DUP STATS^^0
"BLD",1298,"KRN",19,"NM",38,0)
RG CMOR INDIV^^0
"BLD",1298,"KRN",19,"NM",39,0)
RG CMOR MAIN^^0
"BLD",1298,"KRN",19,"NM",40,0)
RG CMOR START^^0
"BLD",1298,"KRN",19,"NM",41,0)
RG CMOR STATUS^^0
"BLD",1298,"KRN",19,"NM",42,0)
RG CMOR STOP^^0
"BLD",1298,"KRN",19,"NM",43,0)
RG CMOR USER MENU^^0
"BLD",1298,"KRN",19,"NM",44,0)
MPIF SITE PARAMETER^^4^
"BLD",1298,"KRN",19,"NM",45,0)
MPIF CMOR MGR^^4^
"BLD",1298,"KRN",19,"NM",46,0)
MPIF VISTA MENU^^4^
"BLD",1298,"KRN",19,"NM",47,0)
MPIFINIT DPT TO MPI^^4^
"BLD",1298,"KRN",19,"NM",48,0)
RG EXCEPTION PURGE^^0
"BLD",1298,"KRN",19,"NM",49,0)
RGEQ AUTOSTART^^0
"BLD",1298,"KRN",19,"NM",50,0)
RG CIRN PROCESS CONTROL^^1^
"BLD",1298,"KRN",19,"NM",51,0)
RG PROCESS CONTROL^^0
"BLD",1298,"KRN",19,"NM",52,0)
RG EXCEPTION NOTIFIER^^0
"BLD",1298,"KRN",19,"NM","B","MPIF CMOR MGR",45)

"BLD",1298,"KRN",19,"NM","B","MPIF SITE PARAMETER",44)

"BLD",1298,"KRN",19,"NM","B","MPIF VISTA MENU",46)

"BLD",1298,"KRN",19,"NM","B","MPIFINIT DPT TO MPI",47)

"BLD",1298,"KRN",19,"NM","B","RG ADMIN COORD MENU",19)

"BLD",1298,"KRN",19,"NM","B","RG ADMIN USER MENU",22)

"BLD",1298,"KRN",19,"NM","B","RG CIRN EXCEPTION HANDLING",29)

"BLD",1298,"KRN",19,"NM","B","RG CIRN PROCESS CONTROL",50)

"BLD",1298,"KRN",19,"NM","B","RG CMOR DUP SCORES",36)

"BLD",1298,"KRN",19,"NM","B","RG CMOR DUP STATS",37)

"BLD",1298,"KRN",19,"NM","B","RG CMOR INDIV",38)

"BLD",1298,"KRN",19,"NM","B","RG CMOR MAIN",39)

"BLD",1298,"KRN",19,"NM","B","RG CMOR START",40)

"BLD",1298,"KRN",19,"NM","B","RG CMOR STATUS",41)

"BLD",1298,"KRN",19,"NM","B","RG CMOR STOP",42)

"BLD",1298,"KRN",19,"NM","B","RG CMOR USER MENU",43)

"BLD",1298,"KRN",19,"NM","B","RG EXCEPTION HANDLING",35)

"BLD",1298,"KRN",19,"NM","B","RG EXCEPTION MENU",27)

"BLD",1298,"KRN",19,"NM","B","RG EXCEPTION NOTIFIER",52)

"BLD",1298,"KRN",19,"NM","B","RG EXCEPTION POTENTIAL MATCH",28)

"BLD",1298,"KRN",19,"NM","B","RG EXCEPTION PURGE",48)

"BLD",1298,"KRN",19,"NM","B","RG EXCEPTION TF INQUIRY",30)

"BLD",1298,"KRN",19,"NM","B","RG IRM MENU",5)

"BLD",1298,"KRN",19,"NM","B","RG MGT REPORTS",34)

"BLD",1298,"KRN",19,"NM","B","RG PROCESS CONTROL",51)

"BLD",1298,"KRN",19,"NM","B","RG STATUS DISPLAY",18)

"BLD",1298,"KRN",19,"NM","B","RG SUBSCRIBE",20)

"BLD",1298,"KRN",19,"NM","B","RG SUBSCRIPT STAT INQ",26)

"BLD",1298,"KRN",19,"NM","B","RG TRAN/AUD AUD REP",24)

"BLD",1298,"KRN",19,"NM","B","RGCIRN CMOR DUP SCORES",16)

"BLD",1298,"KRN",19,"NM","B","RGCIRN CMOR DUP STATS",17)

"BLD",1298,"KRN",19,"NM","B","RGCIRN CMOR INDIV",14)

"BLD",1298,"KRN",19,"NM","B","RGCIRN CMOR MAIN",11)

"BLD",1298,"KRN",19,"NM","B","RGCIRN CMOR START",12)

"BLD",1298,"KRN",19,"NM","B","RGCIRN CMOR STATUS",15)

"BLD",1298,"KRN",19,"NM","B","RGCIRN CMOR STOP",13)

"BLD",1298,"KRN",19,"NM","B","RGCIRN CMOR USER MENU",21)

"BLD",1298,"KRN",19,"NM","B","RGEQ AUTOSTART",49)

"BLD",1298,"KRN",19,"NM","B","RGEQ ERROR",9)

"BLD",1298,"KRN",19,"NM","B","RGEQ MGR",6)

"BLD",1298,"KRN",19,"NM","B","RGEQ START",7)

"BLD",1298,"KRN",19,"NM","B","RGEQ STATS",10)

"BLD",1298,"KRN",19,"NM","B","RGEQ STOP",8)

"BLD",1298,"KRN",19,"NM","B","RGINIT MENU",4)

"BLD",1298,"KRN",19,"NM","B","RGMGR",1)

"BLD",1298,"KRN",19,"NM","B","RGMT AUDIT PRINT",25)

"BLD",1298,"KRN",19,"NM","B","RGMT AUDIT SINGLE",33)

"BLD",1298,"KRN",19,"NM","B","RGMT AUDIT TF STATISTICS",32)

"BLD",1298,"KRN",19,"NM","B","RGPR PRE-IMP ELIG REPORT",3)

"BLD",1298,"KRN",19,"NM","B","RGPR PRE-IMP MENU",2)

"BLD",1298,"KRN",19,"NM","B","RGPR PRE-IMP SSN REPORT",31)

"BLD",1298,"KRN",19,"NM","B","VAFC EXCEPTION HANDLER",23)

"BLD",1298,"KRN",19.1,0)
19.1
"BLD",1298,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",1298,"KRN",101,0)
101
"BLD",1298,"KRN",101,"NM",0)
^9.68A^15^15
"BLD",1298,"KRN",101,"NM",1,0)
RG EXCPT ACTION MENU^^0
"BLD",1298,"KRN",101,"NM",2,0)
RG EXCPT DATE SORT^^0
"BLD",1298,"KRN",101,"NM",3,0)
RG EXCPT DISPLAY ONLY QUERY^^0
"BLD",1298,"KRN",101,"NM",4,0)
RG EXCPT EDIT PATIENT DATA^^0
"BLD",1298,"KRN",101,"NM",5,0)
RG EXCPT HINQ INQUIRY^^0
"BLD",1298,"KRN",101,"NM",6,0)
RG EXCPT MAIN MENU^^0
"BLD",1298,"KRN",101,"NM",7,0)
RG EXCPT PATIENT AUDIT^^0
"BLD",1298,"KRN",101,"NM",8,0)
RG EXCPT PATIENT INQUIRY^^0
"BLD",1298,"KRN",101,"NM",9,0)
RG EXCPT PATIENT SORT^^0
"BLD",1298,"KRN",101,"NM",10,0)
RG EXCPT SELECT^^0
"BLD",1298,"KRN",101,"NM",11,0)
RG EXCPT SELECT TYPE^^0
"BLD",1298,"KRN",101,"NM",12,0)
RG EXCPT SING PATIENT INIT^^0
"BLD",1298,"KRN",101,"NM",13,0)
RG EXCPT TF INQUIRY^^0
"BLD",1298,"KRN",101,"NM",14,0)
RG EXCPT TYPE SORT^^0
"BLD",1298,"KRN",101,"NM",15,0)
RG EXCPT UPDATE STATUS^^0
"BLD",1298,"KRN",101,"NM","B","RG EXCPT ACTION MENU",1)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT DATE SORT",2)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT DISPLAY ONLY QUERY",3)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT EDIT PATIENT DATA",4)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT HINQ INQUIRY",5)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT MAIN MENU",6)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT PATIENT AUDIT",7)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT PATIENT INQUIRY",8)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT PATIENT SORT",9)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT SELECT",10)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT SELECT TYPE",11)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT SING PATIENT INIT",12)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT TF INQUIRY",13)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT TYPE SORT",14)

"BLD",1298,"KRN",101,"NM","B","RG EXCPT UPDATE STATUS",15)

"BLD",1298,"KRN",409.61,0)
409.61
"BLD",1298,"KRN",409.61,"NM",0)
^9.68A^2^2
"BLD",1298,"KRN",409.61,"NM",1,0)
RG EXCPT ACTION^^0
"BLD",1298,"KRN",409.61,"NM",2,0)
RG EXCPT SUMMARY^^0
"BLD",1298,"KRN",409.61,"NM","B","RG EXCPT ACTION",1)

"BLD",1298,"KRN",409.61,"NM","B","RG EXCPT SUMMARY",2)

"BLD",1298,"KRN",771,0)
771
"BLD",1298,"KRN",870,0)
870
"BLD",1298,"KRN",8994,0)
8994
"BLD",1298,"KRN","B",.4,.4)

"BLD",1298,"KRN","B",.401,.401)

"BLD",1298,"KRN","B",.402,.402)

"BLD",1298,"KRN","B",.403,.403)

"BLD",1298,"KRN","B",.5,.5)

"BLD",1298,"KRN","B",.84,.84)

"BLD",1298,"KRN","B",3.6,3.6)

"BLD",1298,"KRN","B",3.8,3.8)

"BLD",1298,"KRN","B",9.2,9.2)

"BLD",1298,"KRN","B",9.8,9.8)

"BLD",1298,"KRN","B",19,19)

"BLD",1298,"KRN","B",19.1,19.1)

"BLD",1298,"KRN","B",101,101)

"BLD",1298,"KRN","B",409.61,409.61)

"BLD",1298,"KRN","B",771,771)

"BLD",1298,"KRN","B",870,870)

"BLD",1298,"KRN","B",8994,8994)

"BLD",1298,"QUES",0)
^9.62^^
"BLD",1298,"REQB",0)
^9.611^1^1
"BLD",1298,"REQB",1,0)
MPIF*1.0*15^2
"BLD",1298,"REQB","B","MPIF*1.0*15",1)

"FIA",991.8)
CIRN SITE PARAMETER
"FIA",991.8,0)
^RGSITE(991.8,
"FIA",991.8,0,0)
991.8
"FIA",991.8,0,1)
y^n^f^^^^n
"FIA",991.8,0,10)

"FIA",991.8,0,11)

"FIA",991.8,0,"RLRO")

"FIA",991.8,0,"VR")
1.0^RG
"FIA",991.8,991.8)
0
"FIA",991.8,991.817)
0
"KRN",3.6,90,-1)
0^1
"KRN",3.6,90,0)
RG CIRN DEMOGRAPHIC ISSUES^NOTIFICATION FROM MPI/PD PACKAGE
"KRN",3.6,90,1,0)
^3.61A^3^3^3010905^^^^
"KRN",3.6,90,1,1,0)
An event has occurred on your system which may require further action.
"KRN",3.6,90,1,2,0)
 
"KRN",3.6,90,1,3,0)
 
"KRN",19,5452,-1)
0^6
"KRN",19,5452,0)
RGEQ MGR^MPI/PD Event Queue Manager^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK^^1
"KRN",19,5452,1,0)
^19.06^2^2^3010720^^^^
"KRN",19,5452,1,1,0)
The MPI/PD Event Queue Manager [RGEQ MGR] menu is designed to manage 
"KRN",19,5452,1,2,0)
the background event queue processes.
"KRN",19,5452,10,0)
^19.01IP^5^2
"KRN",19,5452,10,2,0)
5454^^20
"KRN",19,5452,10,2,"^")
RGEQ STOP
"KRN",19,5452,10,5,0)
5502^^10
"KRN",19,5452,10,5,"^")
RGEQ START
"KRN",19,5452,20)
D STATUS^RGEQDMN1
"KRN",19,5452,99)
58622,48853
"KRN",19,5452,"U")
MPI/PD EVENT QUEUE MANAGER
"KRN",19,5454,-1)
0^8
"KRN",19,5454,0)
RGEQ STOP^Halt MPI/PD Event Queue^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5454,1,0)
^19.06^4^4^3010720^^^^
"KRN",19,5454,1,1,0)
This option allows the background event queue processing task 
"KRN",19,5454,1,2,0)
started by the Start MPI/PD Event Queue [RGEQ START] option to 
"KRN",19,5454,1,3,0)
be stopped.  The option can stop all MPI/PD data class processing 
"KRN",19,5454,1,4,0)
queues or individual MPI/PD data class processing queues.
"KRN",19,5454,25)
STOP^RGEQDMN1
"KRN",19,5454,"U")
HALT MPI/PD EVENT QUEUE
"KRN",19,5469,-1)
4^45
"KRN",19,5469,0)
MPIF CMOR MGR
"KRN",19,5474,-1)
4^44
"KRN",19,5474,0)
MPIF SITE PARAMETER
"KRN",19,5487,-1)
0^49
"KRN",19,5487,0)
RGEQ AUTOSTART^MPI/PD Event Queue Autostart^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5487,1,0)
^19.06^3^3^3010720^^^^
"KRN",19,5487,1,1,0)
This menu option is not designed for user interaction.  It is defined 
"KRN",19,5487,1,2,0)
to be called when the system is started-up.  This option starts the
"KRN",19,5487,1,3,0)
background event queue processor.
"KRN",19,5487,25)
AUTO^RGEQDMN1
"KRN",19,5487,"U")
MPI/PD EVENT QUEUE AUTOSTART
"KRN",19,5488,-1)
0^23
"KRN",19,5488,0)
VAFC EXCEPTION HANDLER^Patient Data Review^^R^^^^^^^^REGISTRATION
"KRN",19,5488,1,0)
^19.06^5^5^3010706^^^^
"KRN",19,5488,1,1,0)
This option is used to review demographic data that is logged into
"KRN",19,5488,1,2,0)
the PATIENT DATA EXCEPTION (#391.98) file from other sites.  It
"KRN",19,5488,1,3,0)
allows a user to upload or merge the data into the receiving site's
"KRN",19,5488,1,4,0)
database.  Reviewing and resolving these cases is an important step
"KRN",19,5488,1,5,0)
in maintaining the accuracy and integrity of the patient's data.
"KRN",19,5488,25)
EN^VAFCEHLM
"KRN",19,5488,"U")
PATIENT DATA REVIEW
"KRN",19,5502,-1)
0^7
"KRN",19,5502,0)
RGEQ START^Start MPI/PD Event Queue^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5502,1,0)
^19.06^2^2^3010720^^^^
"KRN",19,5502,1,1,0)
This option starts the background processing job that processes 
"KRN",19,5502,1,2,0)
the MPI/PD event queue.
"KRN",19,5502,25)
START^RGEQDMN1
"KRN",19,5502,"U")
START MPI/PD EVENT QUEUE
"KRN",19,5660,-1)
0^1
"KRN",19,5660,0)
RGMGR^MPI/PD Master Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK^^1
"KRN",19,5660,1,0)
^19.06^4^4^3010621^^^^
"KRN",19,5660,1,1,0)
This is the primary menu that contains all Master Patient Index/
"KRN",19,5660,1,2,0)
Patient Demographics (MPI/PD) menus. The sub-menus will be 
"KRN",19,5660,1,3,0)
assigned to other users as appropriate and are described in the 
"KRN",19,5660,1,4,0)
Implementation Guide.
"KRN",19,5660,10,0)
^19.01IP^5^3
"KRN",19,5660,10,3,0)
5662^IRM^30
"KRN",19,5660,10,3,"^")
RG IRM MENU
"KRN",19,5660,10,4,0)
5663^CORD^10
"KRN",19,5660,10,4,"^")
RG ADMIN COORD MENU
"KRN",19,5660,10,5,0)
5664^ADU^20
"KRN",19,5660,10,5,"^")
RG ADMIN USER MENU
"KRN",19,5660,20)
D STATUS^RGEQDMN1
"KRN",19,5660,99)
58603,55757
"KRN",19,5660,"U")
MPI/PD MASTER MENU
"KRN",19,5662,-1)
0^5
"KRN",19,5662,0)
RG IRM MENU^MPI/PD IRM Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5662,1,0)
^19.06^3^3^3010720^^^^
"KRN",19,5662,1,1,0)
This option provides the Information Resource Management (IRM) 
"KRN",19,5662,1,2,0)
personnel with the options needed to maintain Master Patient 
"KRN",19,5662,1,3,0)
Index/Patient Demographics (MPI/PD).
"KRN",19,5662,10,0)
^19.01IP^5^4
"KRN",19,5662,10,1,0)
5452^EQ^10
"KRN",19,5662,10,1,"^")
RGEQ MGR
"KRN",19,5662,10,3,0)
6720^SD^40
"KRN",19,5662,10,3,"^")
RG STATUS DISPLAY
"KRN",19,5662,10,4,0)
5667^^30
"KRN",19,5662,10,4,"^")
MPIFINIT DPT TO MPI
"KRN",19,5662,10,5,0)
6739^^20
"KRN",19,5662,10,5,"^")
RG CMOR MAIN
"KRN",19,5662,99)
58640,48673
"KRN",19,5662,"U")
MPI/PD IRM MENU
"KRN",19,5663,-1)
0^19
"KRN",19,5663,0)
RG ADMIN COORD MENU^MPI/PD Patient Admin Coordinator Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK^^^
"KRN",19,5663,1,0)
^19.06^3^3^3010706^^^^
"KRN",19,5663,1,1,0)
The MPI/PD Patient Admin Coordinator Menu [RG ADMIN COORD 
"KRN",19,5663,1,2,0)
MENU] options allow control and monitoring of CMOR and 
"KRN",19,5663,1,3,0)
patient data activities.
"KRN",19,5663,10,0)
^19.01IP^40^7
"KRN",19,5663,10,6,0)
5664^ADU^30
"KRN",19,5663,10,6,"^")
RG ADMIN USER MENU
"KRN",19,5663,10,23,0)
5474^SP^10
"KRN",19,5663,10,23,"^")
MPIF SITE PARAMETER
"KRN",19,5663,10,30,0)
5685^LOG^40
"KRN",19,5663,10,30,"^")
RG TRAN/AUD AUD REP
"KRN",19,5663,10,36,0)
5774^MPI^50
"KRN",19,5663,10,36,"^")
MPIF VISTA MENU
"KRN",19,5663,10,38,0)
6403^MSG^60
"KRN",19,5663,10,38,"^")
RG EXCEPTION MENU
"KRN",19,5663,10,39,0)
6732^RPT^70
"KRN",19,5663,10,39,"^")
RG MGT REPORTS
"KRN",19,5663,10,40,0)
6743^CMOR^20
"KRN",19,5663,10,40,"^")
RG CMOR USER MENU
"KRN",19,5663,10.1)

"KRN",19,5663,15)

"KRN",19,5663,20)

"KRN",19,5663,99)
58672,50885
"KRN",19,5663,"U")
MPI/PD PATIENT ADMIN COORDINAT
"KRN",19,5664,-1)
0^22
"KRN",19,5664,0)
RG ADMIN USER MENU^MPI/PD Patient Admin User Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5664,1,0)
^19.06^3^3^3010706^^^^
"KRN",19,5664,1,1,0)
This option provides the user with the MPI/PD Patient Admin User
"KRN",19,5664,1,2,0)
Menu [RG ADMIN USER MENU].  This menu includes the Patient Data
"KRN",19,5664,1,3,0)
Review option and the menu for changing and managing CMORs.
"KRN",19,5664,10,0)
^19.01IP^2^2
"KRN",19,5664,10,1,0)
5488^^5
"KRN",19,5664,10,1,"^")
VAFC EXCEPTION HANDLER
"KRN",19,5664,10,2,0)
5469^^10
"KRN",19,5664,10,2,"^")
MPIF CMOR MGR
"KRN",19,5664,99)
58706,61534
"KRN",19,5664,"U")
MPI/PD PATIENT ADMIN USER MENU
"KRN",19,5667,-1)
4^47
"KRN",19,5667,0)
MPIFINIT DPT TO MPI
"KRN",19,5685,-1)
0^24
"KRN",19,5685,0)
RG TRAN/AUD AUD REP^Patient Audit Log Reports^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5685,1,0)
^19.06^4^4^3010706^^^^
"KRN",19,5685,1,1,0)
This menu contains two options for reviewing information stored in
"KRN",19,5685,1,2,0)
the AUDIT (#1.1) file for fields being audited in the PATIENT (#2) file.
"KRN",19,5685,1,3,0)
Options allow the user to (1) view all audited fields or selected fields
"KRN",19,5685,1,4,0)
for a date range or (2) all audited data on a single patient.
"KRN",19,5685,10,0)
^19.01IP^3^2
"KRN",19,5685,10,2,0)
5767^^10
"KRN",19,5685,10,2,"^")
RGMT AUDIT PRINT
"KRN",19,5685,10,3,0)
6733^^20
"KRN",19,5685,10,3,"^")
RGMT AUDIT SINGLE
"KRN",19,5685,99)
58603,50206
"KRN",19,5685,"U")
PATIENT AUDIT LOG REPORTS
"KRN",19,5767,-1)
0^25
"KRN",19,5767,0)
RGMT AUDIT PRINT^Custom Audit File Print^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5767,1,0)
^19.06^14^14^3010706^^
"KRN",19,5767,1,1,0)
This option prints a customized report of information stored in 
"KRN",19,5767,1,2,0)
the AUDIT (#1.1) file for fields being audited in the PATIENT (#2) 
"KRN",19,5767,1,3,0)
file.  For a specified date range, users can view all audited fields 
"KRN",19,5767,1,4,0)
or selected fields.  Users can also elect to print only those edits 
"KRN",19,5767,1,5,0)
made by a specific individual.
"KRN",19,5767,1,6,0)
    
"KRN",19,5767,1,7,0)
If selected fields are viewed, the user can choose to see data for 
"KRN",19,5767,1,8,0)
all or selected patients.  If all audited fields are viewed, the user 
"KRN",19,5767,1,9,0)
must choose the patients to examine.  
"KRN",19,5767,1,10,0)
   
"KRN",19,5767,1,11,0)
The report prints the patient name and DFN, date/time the field was
"KRN",19,5767,1,12,0)
edited, the user who made the change, the field edited, the old value,
"KRN",19,5767,1,13,0)
the new value and the option or protocol used to do the edit.  The 
"KRN",19,5767,1,14,0)
right margin for this report is 80.
"KRN",19,5767,25)
RGMTAUDP
"KRN",19,5767,"U")
CUSTOM AUDIT FILE PRINT
"KRN",19,5768,-1)
0^32
"KRN",19,5768,0)
RGMT AUDIT TF STATISTICS^Treating Facility List Statistics^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5768,1,0)
^19.06^7^7^3010706^^^^
"KRN",19,5768,1,1,0)
This option prints a statistical breakdown of the entries in the 
"KRN",19,5768,1,2,0)
TREATING FACILITY LIST (#391.91) file.  Data is available for the 
"KRN",19,5768,1,3,0)
following categories.
"KRN",19,5768,1,4,0)
   Number of unique patients
"KRN",19,5768,1,5,0)
   Number of patients assigned to each site
"KRN",19,5768,1,6,0)
   Number of single site patients for each site
"KRN",19,5768,1,7,0)
   Number of shared patients
"KRN",19,5768,25)
RGMTTFL
"KRN",19,5768,"U")
TREATING FACILITY LIST STATIST
"KRN",19,5774,-1)
4^46
"KRN",19,5774,0)
MPIF VISTA MENU
"KRN",19,5864,-1)
0^31
"KRN",19,5864,0)
RGPR PRE-IMP SSN REPORT^Pseudo-SSN Report^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5864,1,0)
^19.06^6^6^3010613^^^
"KRN",19,5864,1,1,0)
This is the standard Pseudo-SSN (Social Security Number) report.
"KRN",19,5864,1,2,0)
Users should run this report to a 132-column printer, call the 
"KRN",19,5864,1,3,0)
patients and get the correct SSN, and then update via use of 
"KRN",19,5864,1,4,0)
the Load/Edit Patient Data option [DG LOAD PATIENT DATA] in 
"KRN",19,5864,1,5,0)
the Patient Information Management System (PIMS) software 
"KRN",19,5864,1,6,0)
Registration Menu option [DG REGISTRATION MENU].
"KRN",19,5864,25)
RGPRSSN
"KRN",19,5864,"U")
PSEUDO-SSN REPORT
"KRN",19,6403,-1)
0^27
"KRN",19,6403,0)
RG EXCEPTION MENU^Message Exception Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6403,1,0)
^19.06^2^2^3010706^^^^
"KRN",19,6403,1,1,0)
This menu is used to process MPI/PD Health Level Seven (HL7) message
"KRN",19,6403,1,2,0)
exceptions logged in the CIRN HL7 EXCEPTION LOG (#991.1) file.
"KRN",19,6403,10,0)
^19.01IP^4^3
"KRN",19,6403,10,1,0)
6404^^1
"KRN",19,6403,10,1,"^")
RG EXCEPTION POTENTIAL MATCH
"KRN",19,6403,10,3,0)
6712^^10
"KRN",19,6403,10,3,"^")
RG EXCEPTION TF INQUIRY
"KRN",19,6403,10,4,0)
6738^^5
"KRN",19,6403,10,4,"^")
RG EXCEPTION HANDLING
"KRN",19,6403,99)
58605,56004
"KRN",19,6403,"U")
MESSAGE EXCEPTION MENU
"KRN",19,6404,-1)
0^28
"KRN",19,6404,0)
RG EXCEPTION POTENTIAL MATCH^View Potential Match Patient^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6404,1,0)
^19.06^8^8^3010706^^^^
"KRN",19,6404,1,1,0)
This option produces a list of patients from the CIRN HL7 EXCEPTION 
"KRN",19,6404,1,2,0)
LOG (#991.1) file who have been identified as having more than one 
"KRN",19,6404,1,3,0)
potential match on the Master Patient Index (MPI).  These patients 
"KRN",19,6404,1,4,0)
have not been resolved using the Single Patient Initialization to 
"KRN",19,6404,1,5,0)
MPI option [MPIF IND MPI LOAD].
"KRN",19,6404,1,6,0)
  
"KRN",19,6404,1,7,0)
Before producing the report, this option purges DUPLICATE potential 
"KRN",19,6404,1,8,0)
match entries from the CIRN HL7 EXCEPTION LOG (#991.1) file.
"KRN",19,6404,25)
RGEVPM
"KRN",19,6404,"U")
VIEW POTENTIAL MATCH PATIENT
"KRN",19,6405,-1)
0^52
"KRN",19,6405,0)
RG EXCEPTION NOTIFIER^MPI/PD HL7 Exception Notifier^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK^^1
"KRN",19,6405,1,0)
^19.06^2^2^3010730^^^
"KRN",19,6405,1,1,0)
This option is used to notify members of the RG CIRN DEMOGRAPHIC 
"KRN",19,6405,1,2,0)
ISSUES Mail Group that there are exceptions to review.
"KRN",19,6405,20)
D EXCEPT^RGRSUTIL
"KRN",19,6405,"U")
MPI/PD HL7 EXCEPTION NOTIFIER
"KRN",19,6656,-1)
0^48
"KRN",19,6656,0)
RG EXCEPTION PURGE^MPI/PD Exception Purge ^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6656,1,0)
^19.06^3^3^3010622^^^^
"KRN",19,6656,1,1,0)
This option purges duplicate entries, resolved entries over
"KRN",19,6656,1,2,0)
30 days old and entries for patients with names beginning 
"KRN",19,6656,1,3,0)
with "ZZ" from the CIRN HL7 EXCEPTION LOG (#991.1) file.
"KRN",19,6656,25)
MAIN^RGEVPRG
"KRN",19,6656,"U")
MPI/PD EXCEPTION PURGE 
"KRN",19,6712,-1)
0^30
"KRN",19,6712,0)
RG EXCEPTION TF INQUIRY^Patient MPI/PD Data Inquiry^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6712,1,0)
^19.06^5^5^3010706^^^^
"KRN",19,6712,1,1,0)
This report provides MPI/PD Data for a selected patient.  
"KRN",19,6712,1,2,0)
Information displayed includes the Integration Control Number (ICN),
"KRN",19,6712,1,3,0)
the Coordinating Master of Record (CMOR) site, MPI/PD Activity Score,
"KRN",19,6712,1,4,0)
Subscription Control Number, Treating Facility and Subscriber
"KRN",19,6712,1,5,0)
lists, CMOR History and CMOR Change Request History.
"KRN",19,6712,25)
PDAT^RGEX01
"KRN",19,6712,"U")
PATIENT MPI/PD DATA INQUIRY
"KRN",19,6720,-1)
0^18
"KRN",19,6720,0)
RG STATUS DISPLAY^MPI/PD Status Display^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6720,1,0)
^19.06^48^48^3010828^^^^
"KRN",19,6720,1,1,0)
 The MPI/PD Status Display calculates and presents the
"KRN",19,6720,1,2,0)
 following data.
"KRN",19,6720,1,3,0)
 - the number of unresolved exceptions in the CIRN HL7 EXCEPTION LOG 
"KRN",19,6720,1,4,0)
   (#991.1) file for the MPI/PD related entries (e.g., internal 
"KRN",19,6720,1,5,0)
   entry numbers 209, 213-218, 227) in the CIRN HL7 EXCEPTION TYPE
"KRN",19,6720,1,6,0)
   (#991.11) file,
"KRN",19,6720,1,7,0)
 - the number of unique patients with exceptions,
"KRN",19,6720,1,8,0)
 - the number of unresolved exceptions in the PATIENT DATA EXCEPTION
"KRN",19,6720,1,9,0)
   (#391.98) file with an EXCEPTION STATUS (#391.984) file value of
"KRN",19,6720,1,10,0)
   ACTION REQUIRED, DATA EXAMINED or BEING REVIEWED,
"KRN",19,6720,1,11,0)
 - the number of entries in the MPIF CMOR REQUEST (#984.9) file with
"KRN",19,6720,1,12,0)
   a STATUS (#.06) field value of OPEN, REQUESTED, PENDING APPROVAL,
"KRN",19,6720,1,13,0)
   APPROVED or DISAPPROVED,
"KRN",19,6720,1,14,0)
 - the condition of the VAFC BATCH UPDATE and MPIF LOC/MIS ICN RES
"KRN",19,6720,1,15,0)
   background jobs in the OPTION SCHEDULING (#19.2) file, and the number
"KRN",19,6720,1,16,0)
   of entries waiting to be processed,
"KRN",19,6720,1,17,0)
 - the state of the MPI/PD Event Queue processor, and the number of
"KRN",19,6720,1,18,0)
   entries waiting to be processed,
"KRN",19,6720,1,19,0)
 - the condition of the STOP MPI/PD MESSAGING (#16) field in the CIRN
"KRN",19,6720,1,20,0)
   SITE PARAMETER (#991.8) file, and
"KRN",19,6720,1,21,0)
 - the AUDIT status of the NAME (#.01) field in the PATIENT (#2) file.
"KRN",19,6720,1,22,0)
  
"KRN",19,6720,1,23,0)
 The Exception Handler and Patient Data Review numbers indicate how
"KRN",19,6720,1,24,0)
 up-to-date a site is in exception resolution.  The CMOR request
"KRN",19,6720,1,25,0)
 numbers specify how many requests for change of CMOR have been sent
"KRN",19,6720,1,26,0)
 and their resulting status.  This data can be useful in reducing the
"KRN",19,6720,1,27,0)
 number of exceptions.
"KRN",19,6720,1,28,0)
  
"KRN",19,6720,1,29,0)
 The VAFC BATCH UPDATE background job should always be running unless
"KRN",19,6720,1,30,0)
 it has been unscheduled for patch installation or similar purposes.
"KRN",19,6720,1,31,0)
 If it is not scheduled, use the TaskMan option Schedule/Unschedule
"KRN",19,6720,1,32,0)
 Options [XUTM SCHEDULE], and schedule it to run every ten minutes.
"KRN",19,6720,1,33,0)
  
"KRN",19,6720,1,34,0)
 The MPIF LOC/MIS ICN RES background job should be scheduled to run
"KRN",19,6720,1,35,0)
 nightly.
"KRN",19,6720,1,36,0)
  
"KRN",19,6720,1,37,0)
 The MPI/PD Event Queue processor should always be set to RUNNING.  If
"KRN",19,6720,1,38,0)
 the state is NOT RUNNING, use the Start MPI/PD Event Queue [RGEQ START]
"KRN",19,6720,1,39,0)
 option to re-start it.
"KRN",19,6720,1,40,0)
  
"KRN",19,6720,1,41,0)
 The STOP MPI/PD MESSAGING (#16) field in the CIRN SITE PARAMETER
"KRN",19,6720,1,42,0)
 (#991.8) file should always be set to SEND MESSAGES.
"KRN",19,6720,1,43,0)
  
"KRN",19,6720,1,44,0)
 The AUDIT status on the NAME (#.01) field in the PATIENT (#2) file
"KRN",19,6720,1,45,0)
 should be set to YES, ALWAYS.  If necessary, this can be re-set
"KRN",19,6720,1,46,0)
 using VA FileMan.  Go to the FileMan menu and choose OTHER OPTIONS.
"KRN",19,6720,1,47,0)
 Next, choose the Audit Menu and the option TURN DATA AUDIT ON/OFF.
"KRN",19,6720,1,48,0)
 Ask your IRM section to perform this task.
"KRN",19,6720,25)
RGSYSTAT
"KRN",19,6720,"U")
MPI/PD STATUS DISPLAY
"KRN",19,6732,-1)
0^34
"KRN",19,6732,0)
RG MGT REPORTS^Management Reports^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6732,1,0)
^19.06^4^4^3010706^^
"KRN",19,6732,1,1,0)
This menu contains management reports for the MPI/PD Patient
"KRN",19,6732,1,2,0)
Administration Coordinator.  Options include the Pseudo-SSN report, 
"KRN",19,6732,1,3,0)
The Treating Facility List Statistics report and the MPI/PD Status 
"KRN",19,6732,1,4,0)
Display.
"KRN",19,6732,10,0)
^19.01IP^3^3
"KRN",19,6732,10,1,0)
5864^^10
"KRN",19,6732,10,1,"^")
RGPR PRE-IMP SSN REPORT
"KRN",19,6732,10,2,0)
5768^^20
"KRN",19,6732,10,2,"^")
RGMT AUDIT TF STATISTICS
"KRN",19,6732,10,3,0)
6720^^30
"KRN",19,6732,10,3,"^")
RG STATUS DISPLAY
"KRN",19,6732,99)
58603,48698
"KRN",19,6732,"U")
MANAGEMENT REPORTS
"KRN",19,6733,-1)
0^33
"KRN",19,6733,0)
RGMT AUDIT SINGLE^Single Patient Audit File Print^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6733,1,0)
^19.06^7^7^3010706^^
"KRN",19,6733,1,1,0)
This option prints information from the AUDIT (#1.1) file for a 
"KRN",19,6733,1,2,0)
selected patient and date range.
"KRN",19,6733,1,3,0)
   
"KRN",19,6733,1,4,0)
The report prints the patient name and DFN, date/time the field was
"KRN",19,6733,1,5,0)
edited, the user who made the change, the field edited, the old value,
"KRN",19,6733,1,6,0)
the new value and the option or protocol used to do the edit.  The 
"KRN",19,6733,1,7,0)
right margin for this report is 80.
"KRN",19,6733,25)
RGMTAUD
"KRN",19,6733,"U")
SINGLE PATIENT AUDIT FILE PRIN
"KRN",19,6735,-1)
0^38
"KRN",19,6735,0)
RG CMOR INDIV^Calculate Individual Patient CMOR Score^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6735,1,0)
^19.06^4^4^3010706^^^
"KRN",19,6735,1,1,0)
This option allows for the calculation of a CMOR patient activity score
"KRN",19,6735,1,2,0)
for an individual patient.  After it is calculated, the score is filed 
"KRN",19,6735,1,3,0)
in the PATIENT (#2) file, in fields CMOR ACTIVITY SCORE (#991.06) and 
"KRN",19,6735,1,4,0)
SCORE CALCULATION DATE (#991.07).
"KRN",19,6735,25)
INDIV^RGVCCMR1
"KRN",19,6735,"U")
CALCULATE INDIVIDUAL PATIENT C
"KRN",19,6736,-1)
0^36
"KRN",19,6736,0)
RG CMOR DUP SCORES^Duplicate Record by CMOR Score^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6736,1,0)
^19.06^10^10^3010706^^^
"KRN",19,6736,1,1,0)
This option provides a listing of the CMOR scores from the 
"KRN",19,6736,1,2,0)
DUPLICATE RECORD (#15) file.  It displays the number of duplicates 
"KRN",19,6736,1,3,0)
per every 100 points.
"KRN",19,6736,1,4,0)
     
"KRN",19,6736,1,5,0)
For example:  There may be 10 patients with a score between 100 and
"KRN",19,6736,1,6,0)
199.  A NO SCORE means that the pair of potential duplicates had no
"KRN",19,6736,1,7,0)
score (no activity in the last three years).
"KRN",19,6736,1,8,0)
      
"KRN",19,6736,1,9,0)
Entry totals for the PATIENT (#2) file and the DUPLICATE RECORD 
"KRN",19,6736,1,10,0)
(#15) file are also displayed.
"KRN",19,6736,25)
RGMTDPSC
"KRN",19,6736,"U")
DUPLICATE RECORD BY CMOR SCORE
"KRN",19,6737,-1)
0^37
"KRN",19,6737,0)
RG CMOR DUP STATS^Duplicate Record Statistics^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6737,1,0)
^19.06^4^4^3010706^^^
"KRN",19,6737,1,1,0)
This option provides the user with totals and percentiles of
"KRN",19,6737,1,2,0)
patient records in the various categories for merge and verification
"KRN",19,6737,1,3,0)
status.  The report can be used to track the patient records
"KRN",19,6737,1,4,0)
involved with the Duplicate Record Merge process.
"KRN",19,6737,25)
RGMTDPCT
"KRN",19,6737,"U")
DUPLICATE RECORD STATISTICS
"KRN",19,6738,-1)
0^35
"KRN",19,6738,0)
RG EXCEPTION HANDLING^MPI/PD Exception Handling^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6738,1,0)
^19.06^4^4^3010706^^
"KRN",19,6738,1,1,0)
This option provides utilities for processing MPI/PD Exceptions
"KRN",19,6738,1,2,0)
in the CIRN HL7 EXCEPTION LOG (#991.1) file.  This list manager
"KRN",19,6738,1,3,0)
based option displays exceptions and allows the user to choose an
"KRN",19,6738,1,4,0)
exception case for review and resolution.
"KRN",19,6738,25)
EN^RGEX01
"KRN",19,6738,"U")
MPI/PD EXCEPTION HANDLING
"KRN",19,6739,-1)
0^39
"KRN",19,6739,0)
RG CMOR MAIN^Coordinating Master of Record (CMOR) Score Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK^^1
"KRN",19,6739,1,0)
^19.06^2^2^3010615^^
"KRN",19,6739,1,1,0)
This menu contains all of the options that deal with the calculation 
"KRN",19,6739,1,2,0)
of the Coordinating Master of Record (CMOR) patient activity scores.
"KRN",19,6739,10,0)
^19.01IP^6^6
"KRN",19,6739,10,1,0)
6740^BGN^10
"KRN",19,6739,10,1,"^")
RG CMOR START
"KRN",19,6739,10,2,0)
6741^HLT^20
"KRN",19,6739,10,2,"^")
RG CMOR STOP
"KRN",19,6739,10,3,0)
6735^IND^30
"KRN",19,6739,10,3,"^")
RG CMOR INDIV
"KRN",19,6739,10,4,0)
6742^CSS^40
"KRN",19,6739,10,4,"^")
RG CMOR STATUS
"KRN",19,6739,10,5,0)
6736^DRS^50
"KRN",19,6739,10,5,"^")
RG CMOR DUP SCORES
"KRN",19,6739,10,6,0)
6737^STAT^60
"KRN",19,6739,10,6,"^")
RG CMOR DUP STATS
"KRN",19,6739,20)
W @IOF D DISPLAY^RGVCCMR1
"KRN",19,6739,99)
58605,55377
"KRN",19,6739,"U")
COORDINATING MASTER OF RECORD 
"KRN",19,6740,-1)
0^40
"KRN",19,6740,0)
RG CMOR START^Start/Restart CMOR Score Calculation^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6740,1,0)
^19.06^2^2^3010706^^
"KRN",19,6740,1,1,0)
This option starts the running of the Coordinating Master of Record
"KRN",19,6740,1,2,0)
(CMOR) score calculation process.
"KRN",19,6740,25)
RGVCCMR1
"KRN",19,6740,"U")
START/RESTART CMOR SCORE CALCU
"KRN",19,6741,-1)
0^42
"KRN",19,6741,0)
RG CMOR STOP^Stop CMOR Score Calculation^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6741,1,0)
^19.06^2^2^3010706^^
"KRN",19,6741,1,1,0)
This option allows the user to stop the Coordinating Master of Record
"KRN",19,6741,1,2,0)
(CMOR) score calculation process.
"KRN",19,6741,25)
STOP^RGVCCMR1
"KRN",19,6741,"U")
STOP CMOR SCORE CALCULATION
"KRN",19,6742,-1)
0^41
"KRN",19,6742,0)
RG CMOR STATUS^CMOR Score Calculation Status^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6742,1,0)
^19.06^2^2^3010706^^
"KRN",19,6742,1,1,0)
This option allows the user to review the progress of the 
"KRN",19,6742,1,2,0)
Coordinating Master of Record (CMOR) score calculation process.
"KRN",19,6742,25)
DISPLAY^RGVCCMR1
"KRN",19,6742,"U")
CMOR SCORE CALCULATION STATUS
"KRN",19,6743,-1)
0^43
"KRN",19,6743,0)
RG CMOR USER MENU^CMOR User Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6743,1,0)
^19.06^3^3^3010706^^^
"KRN",19,6743,1,1,0)
This menu contains options for the Coordinating Master of Record (CMOR)
"KRN",19,6743,1,2,0)
functionality.  This includes options for calculating individual scores
"KRN",19,6743,1,3,0)
and reports based on CMOR scores.
"KRN",19,6743,10,0)
^19.01IP^4^3
"KRN",19,6743,10,1,0)
6735^IND^10
"KRN",19,6743,10,1,"^")
RG CMOR INDIV
"KRN",19,6743,10,3,0)
6736^DRS^20
"KRN",19,6743,10,3,"^")
RG CMOR DUP SCORES
"KRN",19,6743,10,4,0)
6737^STAT^30
"KRN",19,6743,10,4,"^")
RG CMOR DUP STATS
"KRN",19,6743,99)
58625,55636
"KRN",19,6743,"U")
CMOR USER MENU
"KRN",19,6744,-1)
0^51
"KRN",19,6744,0)
RG PROCESS CONTROL^Stop/Send/Suspend MPI/PD Messages^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6744,1,0)
^^13^13^3010720^
"KRN",19,6744,1,1,0)
 This option is used to edit the STOP MPI/PD MESSAGING field (#16) 
"KRN",19,6744,1,2,0)
 in the CIRN SITE PARAMETER file (#991.8), to stop/suspend/send messages.
"KRN",19,6744,1,3,0)
  
"KRN",19,6744,1,4,0)
 STOP - should be used only to totally shutdown HL7 V2.3 and MPI/PD
"KRN",19,6744,1,5,0)
        messages. It should only be used under the direction of 
"KRN",19,6744,1,6,0)
        System Design and Development.
"KRN",19,6744,1,7,0)
  
"KRN",19,6744,1,8,0)
 SUSPEND - should be used in an emergency situation to suspend HL7 V2.3 
"KRN",19,6744,1,9,0)
           and MPI/PD messages if the volume of messages is affecting 
"KRN",19,6744,1,10,0)
           system performance. System Design and Development should also
"KRN",19,6744,1,11,0)
           be called in this situation.
"KRN",19,6744,1,12,0)
  
"KRN",19,6744,1,13,0)
 SEND - normal operating mode.  
"KRN",19,6744,25)
EN^RGRSPARM
"KRN",19,6744,"U")
STOP/SEND/SUSPEND MPI/PD MESSA
"KRN",19,6751,-1)
1^2
"KRN",19,6751,0)
RGPR PRE-IMP MENU
"KRN",19,6752,-1)
1^3
"KRN",19,6752,0)
RGPR PRE-IMP ELIG REPORT
"KRN",19,6753,-1)
1^4
"KRN",19,6753,0)
RGINIT MENU
"KRN",19,6754,-1)
1^9
"KRN",19,6754,0)
RGEQ ERROR
"KRN",19,6755,-1)
1^10
"KRN",19,6755,0)
RGEQ STATS
"KRN",19,6756,-1)
1^11
"KRN",19,6756,0)
RGCIRN CMOR MAIN
"KRN",19,6757,-1)
1^12
"KRN",19,6757,0)
RGCIRN CMOR START
"KRN",19,6758,-1)
1^13
"KRN",19,6758,0)
RGCIRN CMOR STOP
"KRN",19,6759,-1)
1^14
"KRN",19,6759,0)
RGCIRN CMOR INDIV
"KRN",19,6760,-1)
1^15
"KRN",19,6760,0)
RGCIRN CMOR STATUS
"KRN",19,6761,-1)
1^16
"KRN",19,6761,0)
RGCIRN CMOR DUP SCORES
"KRN",19,6762,-1)
1^17
"KRN",19,6762,0)
RGCIRN CMOR DUP STATS
"KRN",19,6763,-1)
1^20
"KRN",19,6763,0)
RG SUBSCRIBE
"KRN",19,6764,-1)
1^21
"KRN",19,6764,0)
RGCIRN CMOR USER MENU
"KRN",19,6765,-1)
1^26
"KRN",19,6765,0)
RG SUBSCRIPT STAT INQ
"KRN",19,6766,-1)
1^29
"KRN",19,6766,0)
RG CIRN EXCEPTION HANDLING
"KRN",19,6767,-1)
1^50
"KRN",19,6767,0)
RG CIRN PROCESS CONTROL
"KRN",101,1692,-1)
0^6
"KRN",101,1692,0)
RG EXCPT MAIN MENU^MPI/PD EXCEPTION MENU^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1692,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1692,1,1,0)
This protocol serves as the main menu of exception handling options
"KRN",101,1692,1,2,0)
under the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1692,4)
40^4
"KRN",101,1692,10,0)
^101.01PA^7^7
"KRN",101,1692,10,3,0)
1693^SE^15^^^Select Exception
"KRN",101,1692,10,3,"^")
RG EXCPT SELECT
"KRN",101,1692,10,4,0)
1699^ST^10^^^Sort by Exception Type
"KRN",101,1692,10,4,"^")
RG EXCPT TYPE SORT
"KRN",101,1692,10,5,0)
1700^SD^5^^^Sort Exceptions by Date
"KRN",101,1692,10,5,"^")
RG EXCPT DATE SORT
"KRN",101,1692,10,6,0)
1701^SN^7^^^Sort by Patient Name
"KRN",101,1692,10,6,"^")
RG EXCPT PATIENT SORT
"KRN",101,1692,10,7,0)
1702^VT^12^^^View Selected Exception Type
"KRN",101,1692,10,7,"^")
RG EXCPT SELECT TYPE
"KRN",101,1692,26)
D SHOW^VALM
"KRN",101,1692,28)
Select Action:
"KRN",101,1692,99)
58639,51005
"KRN",101,1693,-1)
0^10
"KRN",101,1693,0)
RG EXCPT SELECT^Select Exception^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1693,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1693,1,1,0)
This protocol allows the user to select an exception for processing
"KRN",101,1693,1,2,0)
from the MPI/PD Exceptions screen in the MPI/PD Exception Handling
"KRN",101,1693,1,3,0)
option [RG EXCEPTION HANDLING].
"KRN",101,1693,20)
D SELECT^RGEXHND1
"KRN",101,1693,99)
58043,62323
"KRN",101,1694,-1)
0^1
"KRN",101,1694,0)
RG EXCPT ACTION MENU^MPI/PD EXCEPTION HANDLING^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1694,1,0)
^101.06^4^4^3010719^^^^
"KRN",101,1694,1,1,0)
This protocol serves as the action menu and allows several
"KRN",101,1694,1,2,0)
actions to be taken for a patient selected from the MPI/PD
"KRN",101,1694,1,3,0)
Exception Menu [RG EXCPT MAIN MENU].  This is activated through
"KRN",101,1694,1,4,0)
the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1694,4)
40
"KRN",101,1694,10,0)
^101.01PA^10^10
"KRN",101,1694,10,3,0)
1695^UPD^50^^^Update Status to Processed
"KRN",101,1694,10,3,"^")
RG EXCPT UPDATE STATUS
"KRN",101,1694,10,4,0)
1696^DO^42^^^MPI Display Only Query
"KRN",101,1694,10,4,"^")
RG EXCPT DISPLAY ONLY QUERY
"KRN",101,1694,10,5,0)
1697^SPI^45^^^Single Patient Init to MPI
"KRN",101,1694,10,5,"^")
RG EXCPT SING PATIENT INIT
"KRN",101,1694,10,6,0)
1698^ED^47^^^Edit Patient Data
"KRN",101,1694,10,6,"^")
RG EXCPT EDIT PATIENT DATA
"KRN",101,1694,10,7,0)
1703^PI^35^^^Patient Inquiry
"KRN",101,1694,10,7,"^")
RG EXCPT PATIENT INQUIRY
"KRN",101,1694,10,8,0)
1704^AUD^30^^^Patient Audit
"KRN",101,1694,10,8,"^")
RG EXCPT PATIENT AUDIT
"KRN",101,1694,10,9,0)
1705^HI^40^^^Hinq Inquiry
"KRN",101,1694,10,9,"^")
RG EXCPT HINQ INQUIRY
"KRN",101,1694,10,10,0)
1806^TF^60^^^Treating Facility Inquiry
"KRN",101,1694,10,10,"^")
RG EXCPT TF INQUIRY
"KRN",101,1694,20)

"KRN",101,1694,26)
D SHOW^VALM
"KRN",101,1694,28)
Select Action:
"KRN",101,1694,99)
58673,58618
"KRN",101,1695,-1)
0^15
"KRN",101,1695,0)
RG EXCPT UPDATE STATUS^Update Status to Processed^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1695,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1695,1,1,0)
This protocol allows the user to update the exception status 
"KRN",101,1695,1,2,0)
to PROCESSED from the MPI/PD Exception Handling option [RG 
"KRN",101,1695,1,3,0)
EXCEPTION HANDLING].
"KRN",101,1695,2,0)
^101.02A^^0
"KRN",101,1695,4)
^^^
"KRN",101,1695,20)
D UPD^RGEX03
"KRN",101,1695,99)
58043,62323
"KRN",101,1696,-1)
0^3
"KRN",101,1696,0)
RG EXCPT DISPLAY ONLY QUERY^Display Only Query to MPI^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1696,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1696,1,1,0)
This protocol allows the user to perform a Display Only Query to the MPI
"KRN",101,1696,1,2,0)
from the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1696,20)
D DISP^RGEX03
"KRN",101,1696,99)
58043,62323
"KRN",101,1697,-1)
0^12
"KRN",101,1697,0)
RG EXCPT SING PATIENT INIT^Single Patient Init to MPI^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1697,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1697,1,1,0)
This protocol allows the user to perform a Single Patient
"KRN",101,1697,1,2,0)
Initialization to the MPI from the MPI/PD Exception Handling 
"KRN",101,1697,1,3,0)
option [RG EXCEPTION HANDLING].
"KRN",101,1697,20)
D INTL^RGEX03
"KRN",101,1697,99)
58043,62323
"KRN",101,1698,-1)
0^4
"KRN",101,1698,0)
RG EXCPT EDIT PATIENT DATA^Edit Patient Data^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1698,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1698,1,1,0)
This protocol allows the user to edit patient data from the 
"KRN",101,1698,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1698,20)
D LOAD^RGEX03
"KRN",101,1698,99)
58043,62323
"KRN",101,1699,-1)
0^14
"KRN",101,1699,0)
RG EXCPT TYPE SORT^Sort by Exception Type^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1699,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1699,1,1,0)
This protocol allows the user to sort exceptions by type in the
"KRN",101,1699,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1699,20)
S RGSORT="ST" D SORT^RGEX01
"KRN",101,1699,99)
58043,62323
"KRN",101,1700,-1)
0^2
"KRN",101,1700,0)
RG EXCPT DATE SORT^Sort by Exception Date^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1700,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1700,1,1,0)
This protocol allows the user to sort exceptions by date in the
"KRN",101,1700,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1700,20)
S RGSORT="SD" D SORT^RGEX01
"KRN",101,1700,99)
58043,62323
"KRN",101,1701,-1)
0^9
"KRN",101,1701,0)
RG EXCPT PATIENT SORT^Sort by Patient ^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1701,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1701,1,1,0)
This protocol allows the user to sort exceptions by patient in
"KRN",101,1701,1,2,0)
the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1701,20)
S RGSORT="SN" D SORT^RGEX01
"KRN",101,1701,99)
58043,62323
"KRN",101,1702,-1)
0^11
"KRN",101,1702,0)
RG EXCPT SELECT TYPE^View Selected Exception Type^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1702,1,0)
^101.06^4^4^3010719^^^^
"KRN",101,1702,1,1,0)
This protocol allows the user to select an exception type to 
"KRN",101,1702,1,2,0)
view, all others will be filtered out, for exception processing
"KRN",101,1702,1,3,0)
from the MPI/PD Exceptions screen in the MPI/PD Exception Handling
"KRN",101,1702,1,4,0)
option [RG EXCEPTION HANDLING].
"KRN",101,1702,20)
S RGSORT="VT" D SORT^RGEX01
"KRN",101,1702,27)

"KRN",101,1702,99)
58043,62323
"KRN",101,1703,-1)
0^8
"KRN",101,1703,0)
RG EXCPT PATIENT INQUIRY^Patient Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1703,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1703,1,1,0)
This protocol allows the user to do a Patient Inquiry from the 
"KRN",101,1703,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1703,20)
D INQ^RGEX03
"KRN",101,1703,99)
58043,62323
"KRN",101,1704,-1)
0^7
"KRN",101,1704,0)
RG EXCPT PATIENT AUDIT^Patient Audit^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1704,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1704,1,1,0)
This protocol allows the user to audit the changes made in the
"KRN",101,1704,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1704,20)
D PA^RGEX03
"KRN",101,1704,99)
58043,62323
"KRN",101,1705,-1)
0^5
"KRN",101,1705,0)
RG EXCPT HINQ INQUIRY^Hinq Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1705,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1705,1,1,0)
This protocol allows the user to do a HINQ Inquiry for a 
"KRN",101,1705,1,2,0)
selected patient in the MPI/PD Exception Handling option 
"KRN",101,1705,1,3,0)
[RG EXCEPTION HANDLING].
"KRN",101,1705,20)
D HI^RGEX03
"KRN",101,1705,99)
58043,62323
"KRN",101,1806,-1)
0^13
"KRN",101,1806,0)
RG EXCPT TF INQUIRY^Treating Facility Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1806,1,0)
^101.06^2^2^3010719^^^
"KRN",101,1806,1,1,0)
This protocol displays Master Patient Index/Patient Demographics 
"KRN",101,1806,1,2,0)
(MPI/PD) information for the selected patient.
"KRN",101,1806,2,0)
^101.02A^1^1
"KRN",101,1806,2,1,0)
TF
"KRN",101,1806,2,"B","TF",1)

"KRN",101,1806,20)
D PDAT^RGEX03
"KRN",101,1806,99)
58381,53707
"KRN",409.61,230,-1)
0^2
"KRN",409.61,230,0)
RG EXCPT SUMMARY^1^^80^5^18^1^1^^RG EXCPT MAIN MENU^MPI/PD EXCEPTION HANDLING^1^^1
"KRN",409.61,230,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,230,"ARRAY")
 ^TMP("RGEXC",$J)
"KRN",409.61,230,"COL",0)
^409.621^4^4
"KRN",409.61,230,"COL",1,0)
Patient^6^21^Patient^H^0
"KRN",409.61,230,"COL",2,0)
SSN^28^9^SSN^H^0
"KRN",409.61,230,"COL",3,0)
Date^39^8^Dt Rec'd^^0
"KRN",409.61,230,"COL",4,0)
Exception Type^49^30^Exception Type^^0
"KRN",409.61,230,"COL","AIDENT",0,1)

"KRN",409.61,230,"COL","AIDENT",0,2)

"KRN",409.61,230,"COL","AIDENT",0,3)

"KRN",409.61,230,"COL","AIDENT",0,4)

"KRN",409.61,230,"COL","B","Date",3)

"KRN",409.61,230,"COL","B","Exception Type",4)

"KRN",409.61,230,"COL","B","Patient",1)

"KRN",409.61,230,"COL","B","SSN",2)

"KRN",409.61,230,"FNL")
D EXIT^RGEX01
"KRN",409.61,230,"HDR")
D HDR^RGEX01
"KRN",409.61,230,"HLP")
D HELP^RGEX01
"KRN",409.61,230,"INIT")
D INIT^RGEX01
"KRN",409.61,231,-1)
0^1
"KRN",409.61,231,0)
RG EXCPT ACTION^1^^80^5^18^1^1^^RG EXCPT ACTION MENU^MPI/PD EXCEPTION ACTIONS^1^^1
"KRN",409.61,231,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,231,"ARRAY")
 ^TMP("RGEXC2",$J)
"KRN",409.61,231,"COL",0)
^409.621^1^1
"KRN",409.61,231,"COL",1,0)
EXCEPTION^5^20^Exception Data^^0
"KRN",409.61,231,"COL","AIDENT",0,1)

"KRN",409.61,231,"COL","B","EXCEPTION",1)

"KRN",409.61,231,"FNL")
D EXIT^RGEX03
"KRN",409.61,231,"HDR")
D HDR^RGEX03
"KRN",409.61,231,"HLP")
D HELP^RGEX03
"KRN",409.61,231,"INIT")
D INIT^RGEX03
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",2,3.6)
3.6;2;1;;BUL^XPDTA1;;BULE1^XPDIA1;;;BULDEL^XPDIA1
"ORD",2,3.6,0)
BULLETIN
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
19^3010928
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3010928
"PKG",272,22,1,"PAH",1,1,1,0)
MPI/PD UPDATE MENU STRUCTURE
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*19 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
27
"RTN","RGEQDMN")
0^1^B1078148
"RTN","RGEQDMN",1,0)
RGEQDMN ;BHM/RGY-DEQUEUE PROCESSOR ;2/17/98
"RTN","RGEQDMN",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**19**;30 Apr 99
"RTN","RGEQDMN",3,0)
MAIN ;
"RTN","RGEQDMN",4,0)
 N TYPE,ZTIO,ZTRTN,ZTDESC,ZTDTH,ZTSK
"RTN","RGEQDMN",5,0)
 L +^RGEQ("MAIN"):1 E  Q
"RTN","RGEQDMN",6,0)
 F  D:$$TM^%ZTLOAD  Q:$$ESTOP^RGEQDMN1("MAIN")  H 15
"RTN","RGEQDMN",7,0)
 .S TYPE="B"
"RTN","RGEQDMN",8,0)
 .F  S TYPE=$O(^RGEQ(TYPE)) Q:TYPE=""  I '$$ESTOP^RGEQDMN1(TYPE) D
"RTN","RGEQDMN",9,0)
 ..L +^RGEQ(TYPE):1 E  Q
"RTN","RGEQDMN",10,0)
 ..L -^RGEQ(TYPE)
"RTN","RGEQDMN",11,0)
 ..S ZTREQ="@",ZTIO="",ZTRTN="SUBPROC^RGEQSUB",ZTSAVE("TYPE")="",ZTDTH=$H,ZTDESC="'"_TYPE_"' MPI/PD Subprocess" D ^%ZTLOAD
"RTN","RGEQDMN",12,0)
 .Q
"RTN","RGEQDMN",13,0)
 L -^RGEQ("MAIN")
"RTN","RGEQDMN",14,0)
 Q
"RTN","RGEQDMN1")
0^2^B7144307
"RTN","RGEQDMN1",1,0)
RGEQDMN1 ;BHM/RGY-DEQUEUE PROCESSOR CONTINUED ;2/17/98
"RTN","RGEQDMN1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**19**;30 Apr 99
"RTN","RGEQDMN1",3,0)
STOP ;Stop dequeue processor
"RTN","RGEQDMN1",4,0)
 NEW ENT,DIR,DTOUT,DUOUT,DIRUT,DIE,DA,DR,Y,STAT
"RTN","RGEQDMN1",5,0)
 S DIR("A")="Do you want to stop ALL MPI/PD processing"
"RTN","RGEQDMN1",6,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RGEQDMN1",7,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","RGEQDMN1",8,0)
 I Y=1 S ^RGEQ("ASTOP")="YES" W " ... Done" Q
"RTN","RGEQDMN1",9,0)
 S DIR("A")="Do you want to ENABLE/DISABLE a particular data class"
"RTN","RGEQDMN1",10,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RGEQDMN1",11,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","RGEQDMN1",12,0)
 I Y=1 D
"RTN","RGEQDMN1",13,0)
   .S DIR(0)="PO^995:QEAM",DIR("A")="Select MPI/PD Data Class"
"RTN","RGEQDMN1",14,0)
   .D ^DIR K DIR Q:$D(DIRUT)
"RTN","RGEQDMN1",15,0)
   .S ENT=+Y,STAT=+$P(^RGEQASN(ENT,0),"^",5)
"RTN","RGEQDMN1",16,0)
   .W !
"RTN","RGEQDMN1",17,0)
   .S DIR("A",1)="NOTE: This class is currently "_$P("enabled^disabled","^",STAT+1)
"RTN","RGEQDMN1",18,0)
   .S DIR("A")="   ...Do you want to "_$P("DISABLE^ENABLE","^",STAT+1)
"RTN","RGEQDMN1",19,0)
   .S DIR(0)="Y",DIR("B")="NO"
"RTN","RGEQDMN1",20,0)
   .D ^DIR K DIR Q:$D(DIRUT)
"RTN","RGEQDMN1",21,0)
   .I Y=0 Q
"RTN","RGEQDMN1",22,0)
   .S DIE="^RGEQASN(",DA=ENT,DR="5////^S X="_$P("1^0","^",STAT+1) D ^DIE
"RTN","RGEQDMN1",23,0)
   .W " ...Done."
"RTN","RGEQDMN1",24,0)
   .Q
"RTN","RGEQDMN1",25,0)
 Q
"RTN","RGEQDMN1",26,0)
START ;Start the queue processor
"RTN","RGEQDMN1",27,0)
 NEW DIR,DTOUT,DUOUT,DIRUT,ZTSK,ZTIO,ZTRTN,ZTSAVE,ZTDESC
"RTN","RGEQDMN1",28,0)
 L +^RGEQ("MAIN"):0 E  D  Q
"RTN","RGEQDMN1",29,0)
   .W !!,"The MPI/PD processor is already running!"
"RTN","RGEQDMN1",30,0)
   .Q
"RTN","RGEQDMN1",31,0)
 L -^RGEQ("MAIN")
"RTN","RGEQDMN1",32,0)
 S DIR("A")="Are you sure you want to start the MPI/PD processor"
"RTN","RGEQDMN1",33,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RGEQDMN1",34,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","RGEQDMN1",35,0)
 I Y=1 D  Q
"RTN","RGEQDMN1",36,0)
   .S ZTRTN="MAIN^RGEQDMN",ZTDESC="'MAIN' MPI/PD process"
"RTN","RGEQDMN1",37,0)
   .S ZTREQ="@",ZTDTH=$H,ZTIO=""
"RTN","RGEQDMN1",38,0)
   .D ^%ZTLOAD
"RTN","RGEQDMN1",39,0)
   .I $G(ZTSK) W " ... done."
"RTN","RGEQDMN1",40,0)
   .S ^RGEQ("ASTOP")="NO"
"RTN","RGEQDMN1",41,0)
   .Q
"RTN","RGEQDMN1",42,0)
 W "...NOT queued"
"RTN","RGEQDMN1",43,0)
 Q
"RTN","RGEQDMN1",44,0)
AUTO ;Automatically start background process
"RTN","RGEQDMN1",45,0)
 NEW ZTSK,ZTIO,ZTRTN,ZTSAVE,ZTDESC
"RTN","RGEQDMN1",46,0)
 L +^RGEQ("MAIN"):0 E  Q
"RTN","RGEQDMN1",47,0)
 L -^RGEQ("MAIN")
"RTN","RGEQDMN1",48,0)
 S ZTRTN="MAIN^RGEQDMN",ZTDESC="'MAIN' MPI/PD process"
"RTN","RGEQDMN1",49,0)
 S ZTREQ="@",ZTDTH=$H,ZTIO=""
"RTN","RGEQDMN1",50,0)
 D ^%ZTLOAD
"RTN","RGEQDMN1",51,0)
 S ^RGEQ("ASTOP")="NO"
"RTN","RGEQDMN1",52,0)
 Q
"RTN","RGEQDMN1",53,0)
TEST(TYPE,PARAM,ERROR,HL7) ;Test queue processor
"RTN","RGEQDMN1",54,0)
 Q
"RTN","RGEQDMN1",55,0)
ESTOP(TYPE) ;Check to see if filer should stop
"RTN","RGEQDMN1",56,0)
 I ($G(^RGEQ("ASTOP"))="YES")!($$SEND^RGJUSITE=0) Q 1
"RTN","RGEQDMN1",57,0)
 I TYPE="MAIN" Q 0
"RTN","RGEQDMN1",58,0)
 Q ($$SEND^RGJUSITE=2)!(+$P($G(^RGEQASN(+$O(^RGEQASN("B",TYPE,0)),0)),"^",5))
"RTN","RGEQDMN1",59,0)
STATUS ;check current status of event queue, used for menu entry actions
"RTN","RGEQDMN1",60,0)
 ;added by CML 4/1/99
"RTN","RGEQDMN1",61,0)
 L +^RGEQ("MAIN"):0 E  D  Q
"RTN","RGEQDMN1",62,0)
 .W !!,"=> MPI/PD Event Queue processor is currently running.",!
"RTN","RGEQDMN1",63,0)
 .Q
"RTN","RGEQDMN1",64,0)
 W $C(7),$C(7),!!,"=> MPI/PD Event Queue processor is <<NOT>> currently running.",!
"RTN","RGEQDMN1",65,0)
 L -^RGEQ("MAIN")
"RTN","RGEQDMN1",66,0)
 Q
"RTN","RGEQERR")
1^3
"RTN","RGEQRPT")
1^16
"RTN","RGEVPM")
0^22^B20096016
"RTN","RGEVPM",1,0)
RGEVPM ;BIR/CML-VIEW POTENTIAL MATCH PATIENT LIST ;07/20/99
"RTN","RGEVPM",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3,19**;30 Apr 99
"RTN","RGEVPM",3,0)
 S QFLG=1
"RTN","RGEVPM",4,0)
BEGIN ;
"RTN","RGEVPM",5,0)
 W !!,"This report prints a list of patients who have been identified as having"
"RTN","RGEVPM",6,0)
 W !,"multiple Potential Matches on the Master Patient Index (MPI) and who haven't"
"RTN","RGEVPM",7,0)
 W !,"yet been resolved using the option ""Single Patient Initialization to MPI""."
"RTN","RGEVPM",8,0)
 W !,"Status is current as of the date/time the report is generated."
"RTN","RGEVPM",9,0)
 W !!,"This data is pulled from the CIRN HL7 EXCEPTION LOG file (#991.1)."
"RTN","RGEVPM",10,0)
 W !,"Prior to producing the report, duplicate POTENTIAL MATCH patients will be"
"RTN","RGEVPM",11,0)
 W !,"purged from the file."
"RTN","RGEVPM",12,0)
 ;
"RTN","RGEVPM",13,0)
 D EXCTMP
"RTN","RGEVPM",14,0)
 I XCNT=0 W !!,"There are no patients identified as Potential Matches." G QUIT
"RTN","RGEVPM",15,0)
DEV ;
"RTN","RGEVPM",16,0)
 W !!,"The right margin for this report is 80.",!!
"RTN","RGEVPM",17,0)
 D EN^XUTMDEVQ("START^RGEVPM","MPI/PD - Potential Match Patient List") I 'POP Q
"RTN","RGEVPM",18,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","RGEVPM",19,0)
 G QUIT
"RTN","RGEVPM",20,0)
START ;
"RTN","RGEVPM",21,0)
 S HOME=$$SITE^VASITE()   ;institution file ptr^station name^station number
"RTN","RGEVPM",22,0)
 ;
"RTN","RGEVPM",23,0)
LOOP ;Search ^RGHL7(991.1,"ADFN" to see how many patients need to be resolved to MPI
"RTN","RGEVPM",24,0)
 K ^TMP("RGEVPM",$J)
"RTN","RGEVPM",25,0)
 ;
"RTN","RGEVPM",26,0)
 S (RCNT,RGDFN)=0
"RTN","RGEVPM",27,0)
 F  S RGDFN=$O(^RGHL7(991.1,"ADFN",218,RGDFN)) Q:'RGDFN  D
"RTN","RGEVPM",28,0)
 .S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGEVPM",29,0)
 .I $E(ICN,1,3)=$P(HOME,"^",3)!(ICN<0) D
"RTN","RGEVPM",30,0)
 ..S RCNT=RCNT+1
"RTN","RGEVPM",31,0)
 ..S DFN=RGDFN D DEM^VADPT
"RTN","RGEVPM",32,0)
 ..S ^TMP("RGEVPM",$J,VADM(1),RGDFN)=$P(VADM(2),"^")_"^"_$P(VADM(3),"^",2)
"RTN","RGEVPM",33,0)
 ;
"RTN","RGEVPM",34,0)
PRT ;Print report
"RTN","RGEVPM",35,0)
 S (PG,QFLG)=0,$P(LN,"-",81)="",LOCSITE=$P(HOME,"^",2)
"RTN","RGEVPM",36,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGEVPM",37,0)
 D HDR
"RTN","RGEVPM",38,0)
 I '$D(^TMP("RGEVPM",$J)) W !!,"No patients found who need to be resolved to the MPI." G QUIT
"RTN","RGEVPM",39,0)
 ;
"RTN","RGEVPM",40,0)
 ;count the number of patients who need to be resolved
"RTN","RGEVPM",41,0)
 S PTNM="",CNT=0
"RTN","RGEVPM",42,0)
 F  S PTNM=$O(^TMP("RGEVPM",$J,PTNM)) Q:PTNM=""  Q:QFLG  D
"RTN","RGEVPM",43,0)
 .S RGDFN=0
"RTN","RGEVPM",44,0)
 .F  S RGDFN=$O(^TMP("RGEVPM",$J,PTNM,RGDFN)) Q:'RGDFN  S CNT=CNT+1
"RTN","RGEVPM",45,0)
 ;
"RTN","RGEVPM",46,0)
 S PTNM=""
"RTN","RGEVPM",47,0)
 F  S PTNM=$O(^TMP("RGEVPM",$J,PTNM)) Q:PTNM=""  Q:QFLG  D
"RTN","RGEVPM",48,0)
 .S RGDFN=0
"RTN","RGEVPM",49,0)
 .F  S RGDFN=$O(^TMP("RGEVPM",$J,PTNM,RGDFN)) Q:'RGDFN  Q:QFLG  D
"RTN","RGEVPM",50,0)
 ..S SSN=$P(^TMP("RGEVPM",$J,PTNM,RGDFN),"^")
"RTN","RGEVPM",51,0)
 ..S DOB=$P(^TMP("RGEVPM",$J,PTNM,RGDFN),"^",2)
"RTN","RGEVPM",52,0)
 ..D:$Y+4>IOSL HDR Q:QFLG  W !,PTNM,?36,SSN,?50,DOB,?68,$J(RGDFN,9)
"RTN","RGEVPM",53,0)
 W !!,"TOTAL: ",CNT
"RTN","RGEVPM",54,0)
 ;
"RTN","RGEVPM",55,0)
QUIT ;
"RTN","RGEVPM",56,0)
 I $E(IOST,1,2)="C-"&('QFLG) S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGEVPM",57,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGEVPM",58,0)
 K ^TMP("RGEVPM",$J)
"RTN","RGEVPM",59,0)
 K %,CNT,DA,DFN,DIK,DIR,DOB,DUPCNT,EXCDT,HDT,HOME,ICN,IEN,IEN2,JJ,LCNT,LN,LOCSITE
"RTN","RGEVPM",60,0)
 K NCNT,NODE,OLDDT,OLDNODE,PG,PTNM,QFLG,RCNT,RDT,RGDFN,SS,SSN,VADM,X,XCNT,Y,ZTSK
"RTN","RGEVPM",61,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","RGEVPM",62,0)
 ;
"RTN","RGEVPM",63,0)
HDR ;HEADER
"RTN","RGEVPM",64,0)
 I $E(IOST,1,2)="C-" S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGEVPM",65,0)
 I $E(IOST,1,2)="C-",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","RGEVPM",66,0)
 S PG=PG+1 W:$Y!($E(IOST,1,2)="C-") @IOF
"RTN","RGEVPM",67,0)
 W !,"PATIENT LIST of Potential Matches to be Resolved",?72,"Page: ",PG
"RTN","RGEVPM",68,0)
 W !,"Printed at ",LOCSITE," on ",HDT
"RTN","RGEVPM",69,0)
 W !!,"Patient Name",?39,"SSN",?52,"DOB",?70,"DFN",!,LN
"RTN","RGEVPM",70,0)
 Q
"RTN","RGEVPM",71,0)
 ;
"RTN","RGEVPM",72,0)
EXCTMP ;Count number of POTENTIAL MATCH type entries (IEN=218) in CIRN HL7 EXCEPTION LOG 
"RTN","RGEVPM",73,0)
 ;file 991.1, build XTMP global of unique patients and purge dup entries in file.
"RTN","RGEVPM",74,0)
 W !!,"...one moment please..",!
"RTN","RGEVPM",75,0)
 K ^TMP("RGEVPM",$J)
"RTN","RGEVPM",76,0)
 S (RGDFN,CNT,XCNT,DUPCNT)=0
"RTN","RGEVPM",77,0)
 F  S RGDFN=$O(^RGHL7(991.1,"ADFN",218,RGDFN)) Q:'RGDFN  D
"RTN","RGEVPM",78,0)
 .S IEN=0
"RTN","RGEVPM",79,0)
 .F  S IEN=$O(^RGHL7(991.1,"ADFN",218,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEVPM",80,0)
 ..S IEN2=0
"RTN","RGEVPM",81,0)
 ..F  S IEN2=$O(^RGHL7(991.1,"ADFN",218,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPM",82,0)
 ...S CNT=CNT+1
"RTN","RGEVPM",83,0)
 ...S EXCDT=$P(^RGHL7(991.1,IEN,0),"^",3)
"RTN","RGEVPM",84,0)
 ...I '$D(^TMP("RGEVPM",$J,RGDFN)) D  Q
"RTN","RGEVPM",85,0)
 ....S XCNT=XCNT+1
"RTN","RGEVPM",86,0)
 ....D SETTMP
"RTN","RGEVPM",87,0)
 ...I $D(^TMP("RGEVPM",$J,RGDFN))  D
"RTN","RGEVPM",88,0)
 ....S OLDNODE=^TMP("RGEVPM",$J,RGDFN)
"RTN","RGEVPM",89,0)
 ....S OLDDT=$P(OLDNODE,"^")
"RTN","RGEVPM",90,0)
 ....I EXCDT>OLDDT D  Q
"RTN","RGEVPM",91,0)
 .....S DA(1)=$P(OLDNODE,"^",2),DA=$P(OLDNODE,"^",3)
"RTN","RGEVPM",92,0)
 .....D DELDUP
"RTN","RGEVPM",93,0)
 .....D SETTMP
"RTN","RGEVPM",94,0)
 ....I OLDDT>EXCDT!(OLDDT=EXCDT) D
"RTN","RGEVPM",95,0)
 .....S DA(1)=IEN,DA=IEN2
"RTN","RGEVPM",96,0)
 .....D DELDUP
"RTN","RGEVPM",97,0)
 W !,DUPCNT," duplicate patient entries for POTENTIAL MATCH exceptions were identified"
"RTN","RGEVPM",98,0)
 W !,"and deleted from the CIRN HL7 EXCEPTION LOG file (#991.1)."
"RTN","RGEVPM",99,0)
 Q
"RTN","RGEVPM",100,0)
 ;
"RTN","RGEVPM",101,0)
SETTMP ;set TMP global for patient check
"RTN","RGEVPM",102,0)
 S ^TMP("RGEVPM",$J,RGDFN)=EXCDT_"^"_IEN_"^"_IEN2
"RTN","RGEVPM",103,0)
 Q
"RTN","RGEVPM",104,0)
 ;
"RTN","RGEVPM",105,0)
DELDUP ;delete patient dups from file
"RTN","RGEVPM",106,0)
 S DUPCNT=DUPCNT+1
"RTN","RGEVPM",107,0)
 S DIK="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEVPM",108,0)
 D ^DIK K DIK,DA
"RTN","RGEVPM",109,0)
 Q
"RTN","RGEVPM",110,0)
 ;
"RTN","RGEVPM",111,0)
CURPM() ;Call to check if there are any patients in the CIRN HL7 EXCEPTION LOG
"RTN","RGEVPM",112,0)
 ;file (#991.1) with an exception TYPE of "POTENTIAL MATCH" who currently need
"RTN","RGEVPM",113,0)
 ;to be resolved to the MPI.
"RTN","RGEVPM",114,0)
 ;returns a value of "1" if any are found, "0" if none are found
"RTN","RGEVPM",115,0)
 N LOC,RGDFN,GOT,ICN
"RTN","RGEVPM",116,0)
 S LOC=$P($$SITE^VASITE(),"^",3)
"RTN","RGEVPM",117,0)
 S (GOT,RGDFN)=0
"RTN","RGEVPM",118,0)
 F  S RGDFN=$O(^RGHL7(991.1,"ADFN",218,RGDFN)) Q:'RGDFN  D  Q:GOT
"RTN","RGEVPM",119,0)
 .S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGEVPM",120,0)
 .I $E(ICN,1,3)=LOC!(ICN<0) S GOT=1 Q
"RTN","RGEVPM",121,0)
 I GOT Q 1
"RTN","RGEVPM",122,0)
 Q 0
"RTN","RGEVPRG")
0^23^B40689550
"RTN","RGEVPRG",1,0)
RGEVPRG ;BAY/ALS-OPTIONS TO PURGE MPI/PD EXCEPTIONS ;08/23/99
"RTN","RGEVPRG",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19**;30 Apr 99
"RTN","RGEVPRG",3,0)
 ;
"RTN","RGEVPRG",4,0)
MAIN ;
"RTN","RGEVPRG",5,0)
 Q:($D(^TMP("RGEXC")))!($D(^TMP("RGEXC2")))
"RTN","RGEVPRG",6,0)
 L +^RGHL7(991.1,"RG PURGE EXCEPTION"):5 E  Q
"RTN","RGEVPRG",7,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RGEVPRG",8,0)
 S $P(^RGSITE(991.8,1,"EXCPRG"),"^",1)=$$NOW^XLFDT
"RTN","RGEVPRG",9,0)
 S $P(^RGSITE(991.8,1,"EXCPRG"),"^",3)="R"
"RTN","RGEVPRG",10,0)
 D PROC
"RTN","RGEVPRG",11,0)
 D PRGDUP
"RTN","RGEVPRG",12,0)
 D PRG30
"RTN","RGEVPRG",13,0)
 D PRGZZ
"RTN","RGEVPRG",14,0)
 S $P(^RGSITE(991.8,1,"EXCPRG"),"^",2)=$$NOW^XLFDT
"RTN","RGEVPRG",15,0)
 S $P(^RGSITE(991.8,1,"EXCPRG"),"^",3)="C"
"RTN","RGEVPRG",16,0)
 L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEVPRG",17,0)
 Q
"RTN","RGEVPRG",18,0)
PRGPAT ;Purge by Patient
"RTN","RGEVPRG",19,0)
 W !
"RTN","RGEVPRG",20,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: "
"RTN","RGEVPRG",21,0)
 D ^DIC K DIC G:Y<0 QUIT  S RGDFN=+Y
"RTN","RGEVPRG",22,0)
 S EXCT="",FLAG=0
"RTN","RGEVPRG",23,0)
 F  S EXCT=$O(^RGHL7(991.1,"ADFN",EXCT)) Q:EXCT=""  D
"RTN","RGEVPRG",24,0)
 . I $D(^RGHL7(991.1,"ADFN",EXCT,RGDFN)) S FLAG=1 Q
"RTN","RGEVPRG",25,0)
 I FLAG=0 W !,"There are no exceptions on file for this patient." G PRGPAT
"RTN","RGEVPRG",26,0)
 I $$IFLOCAL^MPIF001(RGDFN) W !,"This patient does not have a national ICN assigned, do not purge." Q
"RTN","RGEVPRG",27,0)
 S DFN=RGDFN D DEM^VADPT
"RTN","RGEVPRG",28,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEVPRG",29,0)
 S DIR("A")="Are you sure you want to purge all exceptions on file for "_VADM(1)_"?   YES//  "
"RTN","RGEVPRG",30,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEVPRG",31,0)
 . S EXCT="",CNT=0
"RTN","RGEVPRG",32,0)
 . F  S EXCT=$O(^RGHL7(991.1,"ADFN",EXCT)) Q:'EXCT  D
"RTN","RGEVPRG",33,0)
 .. S IEN=0
"RTN","RGEVPRG",34,0)
 .. F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCT,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEVPRG",35,0)
 ... S IEN2=0
"RTN","RGEVPRG",36,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCT,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",37,0)
 .... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",38,0)
 .... I NUM=1 S DIK="^RGHL7(991.1,",DA=IEN D ^DIK K DIK,DA S CNT=CNT+1
"RTN","RGEVPRG",39,0)
 .... E  I NUM>1 D DEL
"RTN","RGEVPRG",40,0)
 . W !,"All exceptions purged for "_VADM(1)_"   DFN: "_RGDFN
"RTN","RGEVPRG",41,0)
 K EXCT,DFN,FLAG,VADM,CNT,IEN,IEN2,NUM,RGDFN,Y
"RTN","RGEVPRG",42,0)
QUIT Q
"RTN","RGEVPRG",43,0)
 ;
"RTN","RGEVPRG",44,0)
PRGDT ; Purge by Date
"RTN","RGEVPRG",45,0)
 W !!,"Enter a date for the purge. All exceptions on file, on or before that date, will be deleted."
"RTN","RGEVPRG",46,0)
 K DIR,DIRUT,DTOUT,DUOUT
"RTN","RGEVPRG",47,0)
 S DIR(0)="DA^:DT:EPX",DIR("A")="Enter Date for Purge: "
"RTN","RGEVPRG",48,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","RGEVPRG",49,0)
 S PURDT=Y
"RTN","RGEVPRG",50,0)
 S PDATE=$$FMTE^XLFDT(PURDT)
"RTN","RGEVPRG",51,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEVPRG",52,0)
 S DIR("A")="Are you sure you want to purge all exceptions on file dated on or before "_PDATE_"?  YES//  "
"RTN","RGEVPRG",53,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEVPRG",54,0)
 . S EXCDT="",CNT=0
"RTN","RGEVPRG",55,0)
 . F  S EXCDT=$O(^RGHL7(991.1,"AD",EXCDT)) Q:'EXCDT  D
"RTN","RGEVPRG",56,0)
 .. I ($P(EXCDT,".",1)=PURDT)!($P(EXCDT,".",1)<PURDT) D
"RTN","RGEVPRG",57,0)
 ... S IEN=0
"RTN","RGEVPRG",58,0)
 ... F  S IEN=$O(^RGHL7(991.1,"AD",EXCDT,IEN)) Q:'IEN  D
"RTN","RGEVPRG",59,0)
 .... S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:NUM<1
"RTN","RGEVPRG",60,0)
 .... S CNT=CNT+NUM
"RTN","RGEVPRG",61,0)
 .... S DIK="^RGHL7(991.1,",DA=IEN
"RTN","RGEVPRG",62,0)
 .... D ^DIK K DIK,DA
"RTN","RGEVPRG",63,0)
 I CNT=0 W !,"There are no exceptions dated on or before "_PDATE_", no data to purge."
"RTN","RGEVPRG",64,0)
 E  I CNT>0 W !,CNT_" exceptions, dated on or before "_PDATE_" have been purged!"
"RTN","RGEVPRG",65,0)
 K PDATE,PURDT,EXCDT,CNT,IEN,NUM,Y
"RTN","RGEVPRG",66,0)
 Q
"RTN","RGEVPRG",67,0)
PRG30   ; Purge Exceptions over 30 days old
"RTN","RGEVPRG",68,0)
 S TODAY=""
"RTN","RGEVPRG",69,0)
 S TODAY=$$NOW^XLFDT D
"RTN","RGEVPRG",70,0)
 . S EXCDT="",CNT=0,DIFF=""
"RTN","RGEVPRG",71,0)
 . F  S EXCDT=$O(^RGHL7(991.1,"AD",EXCDT)) Q:'EXCDT  D
"RTN","RGEVPRG",72,0)
 .. S DIFF=$$FMDIFF^XLFDT(TODAY,EXCDT)
"RTN","RGEVPRG",73,0)
 .. I DIFF>30 D
"RTN","RGEVPRG",74,0)
 ... S IEN=0
"RTN","RGEVPRG",75,0)
 ... F  S IEN=$O(^RGHL7(991.1,"AD",EXCDT,IEN)) Q:'IEN  D
"RTN","RGEVPRG",76,0)
 .... S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:'NUM
"RTN","RGEVPRG",77,0)
 .... S IEN2=0
"RTN","RGEVPRG",78,0)
 .... F  S IEN2=$O(^RGHL7(991.1,IEN,1,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",79,0)
 ..... S STAT=""
"RTN","RGEVPRG",80,0)
 ..... S STAT=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5)
"RTN","RGEVPRG",81,0)
 ..... ; Only delete PROCESSED exceptions
"RTN","RGEVPRG",82,0)
 ..... I STAT>0 D
"RTN","RGEVPRG",83,0)
 ...... I NUM>1 D DEL
"RTN","RGEVPRG",84,0)
 ...... E  I NUM=1 D
"RTN","RGEVPRG",85,0)
 ....... S CNT=CNT+NUM
"RTN","RGEVPRG",86,0)
 ....... S DIK="^RGHL7(991.1,",DA=IEN
"RTN","RGEVPRG",87,0)
 ....... D ^DIK K DIK,DA
"RTN","RGEVPRG",88,0)
 K DIFF,TODAY,EXCDT,CNT,IEN,IEN2,NUM,STAT
"RTN","RGEVPRG",89,0)
 Q
"RTN","RGEVPRG",90,0)
PRGEXC ; Purge by Exception Type
"RTN","RGEVPRG",91,0)
 ;S DIC="^RGHL7(991.11,",DIC(0)="QEAM"
"RTN","RGEVPRG",92,0)
 ;S DIC("A")="Enter an exception type to purge: "
"RTN","RGEVPRG",93,0)
 ;D ^DIC K DIC G:Y<200 QUIT  S EXCTYP=+Y,ETYPE=X
"RTN","RGEVPRG",94,0)
 ;S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEVPRG",95,0)
 ;S DIR("A")="*WARNING* This will permanently delete all "_ETYPE_" exceptions. Are you sure you want to do this?  YES//  "
"RTN","RGEVPRG",96,0)
 ;D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEVPRG",97,0)
 ;. S CNT=0,IEN=""
"RTN","RGEVPRG",98,0)
 ;. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEVPRG",99,0)
 ;.. S IEN2=0
"RTN","RGEVPRG",100,0)
 ;.. F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",101,0)
 ;... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",102,0)
 ;... I NUM=1 S DIK="^RGHL7(991.1,",DA=IEN D ^DIK K DIK,DA S CNT=CNT+1
"RTN","RGEVPRG",103,0)
 ;... E  I NUM>1 D DEL
"RTN","RGEVPRG",104,0)
 ;I CNT=0 W !,"There are no "_ETYPE_" exceptions on file."
"RTN","RGEVPRG",105,0)
 ;E  I CNT>0 W !,CNT_" "_ETYPE_" Exceptions purged!"
"RTN","RGEVPRG",106,0)
 ;K ETYPE,CNT,IEN,IEN2,NUM,X,Y
"RTN","RGEVPRG",107,0)
 ;Q
"RTN","RGEVPRG",108,0)
PRGDUP ; Purge Duplicate Entries
"RTN","RGEVPRG",109,0)
 S EXCTYP="",CNT=0
"RTN","RGEVPRG",110,0)
 K ^TMP("RGEVDUP",$J)
"RTN","RGEVPRG",111,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEVPRG",112,0)
 . S RGDFN=""
"RTN","RGEVPRG",113,0)
 . F  S RGDFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN)) Q:'RGDFN  D
"RTN","RGEVPRG",114,0)
 .. S IEN=0
"RTN","RGEVPRG",115,0)
 .. F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEVPRG",116,0)
 ... S IEN2=0
"RTN","RGEVPRG",117,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",118,0)
 .... S EXCDT=$P(^RGHL7(991.1,IEN,0),"^",3)
"RTN","RGEVPRG",119,0)
 .... I '$D(^TMP("RGEVDUP",$J,RGDFN,EXCTYP)) D  Q
"RTN","RGEVPRG",120,0)
 ..... S ^TMP("RGEVDUP",$J,RGDFN,EXCTYP)=EXCDT_"^"_IEN_"^"_IEN2
"RTN","RGEVPRG",121,0)
 .... I $D(^TMP("RGEVDUP",$J,RGDFN,EXCTYP)) D
"RTN","RGEVPRG",122,0)
 ..... S OLDNODE=^TMP("RGEVDUP",$J,RGDFN,EXCTYP)
"RTN","RGEVPRG",123,0)
 ..... S OLDDT=$P(OLDNODE,"^")
"RTN","RGEVPRG",124,0)
 ..... I EXCDT>OLDDT D  Q
"RTN","RGEVPRG",125,0)
 ...... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",126,0)
 ...... I NUM=1 S DIK="^RGHL7(991.1,",DA=$P(OLDNODE,"^",2) D ^DIK K DIK,DA
"RTN","RGEVPRG",127,0)
 ...... E  I NUM>1 D
"RTN","RGEVPRG",128,0)
 ....... S DA(1)=$P(OLDNODE,"^",2),DA=$P(OLDNODE,"^",3)
"RTN","RGEVPRG",129,0)
 ....... S DIK="^RGHL7(991.1,"_DA(1)_",1," D ^DIK K DIK,DA
"RTN","RGEVPRG",130,0)
 ...... S CNT=CNT+1
"RTN","RGEVPRG",131,0)
 ...... S ^TMP("RGEVDUP",$J,RGDFN,EXCTYP)=EXCDT_"^"_IEN_"^"_IEN2
"RTN","RGEVPRG",132,0)
 ..... I OLDDT>EXCDT!(OLDDT=EXCDT) D
"RTN","RGEVPRG",133,0)
 ...... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",134,0)
 ...... I NUM=1 S DIK="^RGHL7(991.1,",DA=IEN D ^DIK K DIK,DA S CNT=CNT+1
"RTN","RGEVPRG",135,0)
 ...... E  I NUM>1 D DEL
"RTN","RGEVPRG",136,0)
 ; W !,CNT_" Duplicate entries"
"RTN","RGEVPRG",137,0)
 K OLDDT,OLDNODE,EXCDT,CNT,IEN,IEN2,NUM,RGDFN
"RTN","RGEVPRG",138,0)
 Q
"RTN","RGEVPRG",139,0)
PRGZZ ;Purge ZZ (Duplicate indicator) patients from exception file.
"RTN","RGEVPRG",140,0)
 S EXCTYP="",CNT=""
"RTN","RGEVPRG",141,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEVPRG",142,0)
 . S RGDFN=""
"RTN","RGEVPRG",143,0)
 . F  S RGDFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN)) Q:'RGDFN  D
"RTN","RGEVPRG",144,0)
 .. S IEN=0
"RTN","RGEVPRG",145,0)
 .. F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEVPRG",146,0)
 ... S IEN2=0
"RTN","RGEVPRG",147,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",148,0)
 .... S DFN=RGDFN D DEM^VADPT
"RTN","RGEVPRG",149,0)
 .... I ($E($G(VADM(1)),1,2)="ZZ")!(VADM(1)="")!($E($G(VADM(1)),1,7)="MERGING") D
"RTN","RGEVPRG",150,0)
 ..... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",151,0)
 ..... I NUM=1 S DIK="^RGHL7(991.1,",DA=IEN D ^DIK K DIK,DA
"RTN","RGEVPRG",152,0)
 ..... E  I NUM>1 D DEL
"RTN","RGEVPRG",153,0)
 K EXCTYP,RGDFN,DFN,IEN,IEN2,NUM,VADM
"RTN","RGEVPRG",154,0)
 Q
"RTN","RGEVPRG",155,0)
DEL ;
"RTN","RGEVPRG",156,0)
 S CNT=CNT+1
"RTN","RGEVPRG",157,0)
 S DA(1)=IEN,DA=IEN2
"RTN","RGEVPRG",158,0)
 S DIK="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEVPRG",159,0)
 D ^DIK K DIK,DA
"RTN","RGEVPRG",160,0)
 Q
"RTN","RGEVPRG",161,0)
PROC ; 
"RTN","RGEVPRG",162,0)
 S EXCTYP=""
"RTN","RGEVPRG",163,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEVPRG",164,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEVPRG",165,0)
 . I (EXCTYP=209)!(EXCTYP=227)!(EXCTYP=213)!(EXCTYP=214)!(EXCTYP=218) D
"RTN","RGEVPRG",166,0)
 .. S IEN=0
"RTN","RGEVPRG",167,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEVPRG",168,0)
 ... S IEN2=0,ICN="",RGDFN=""
"RTN","RGEVPRG",169,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",170,0)
 .... S RGDFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'RGDFN
"RTN","RGEVPRG",171,0)
 .... S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGEVPRG",172,0)
 .... I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEVPRG",173,0)
 ..... L +^RGHL7(991.1,IEN):10
"RTN","RGEVPRG",174,0)
 ..... S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEVPRG",175,0)
 ..... D ^DIE K DIE,DA,DR
"RTN","RGEVPRG",176,0)
 ..... L -^RGHL7(991.1,IEN)
"RTN","RGEVPRG",177,0)
 K EXCTYP,HOME,ICN,IEN,IEN2,RGDFN
"RTN","RGEVPRG",178,0)
 Q
"RTN","RGEX01")
0^17^B29533075
"RTN","RGEX01",1,0)
RGEX01 ;BAY/ALS-LIST MANAGER FOR MPI/PD EXCEPTIONS ;10/07/99
"RTN","RGEX01",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19**;30 Apr 99
"RTN","RGEX01",3,0)
 ;
"RTN","RGEX01",4,0)
 ;Reference to START^VAFCPDAT supported by IA #3299
"RTN","RGEX01",5,0)
EN ; -- main entry point for RG EXCPT SUMMARY
"RTN","RGEX01",6,0)
 N STDT,ENDDT,PRGSTAT,XFLAG
"RTN","RGEX01",7,0)
 S XFLAG=0
"RTN","RGEX01",8,0)
 S STDT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",1)
"RTN","RGEX01",9,0)
 I $D(STDT) S STDT=$$FMTE^XLFDT(STDT,1)
"RTN","RGEX01",10,0)
 S PRGSTAT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",3)
"RTN","RGEX01",11,0)
 I PRGSTAT="" D
"RTN","RGEX01",12,0)
 . W $C(7)
"RTN","RGEX01",13,0)
 . W !!,"The MPI/PD Exception Purge process has not been run."
"RTN","RGEX01",14,0)
 . S DIR(0)="YA",DIR("B")="NO"
"RTN","RGEX01",15,0)
 . S DIR("??")="^D HLPPRG^RGEX01"
"RTN","RGEX01",16,0)
 . S DIR("A")="Do you want to run it now? "
"RTN","RGEX01",17,0)
 . D ^DIR K DIR
"RTN","RGEX01",18,0)
 . I $D(DIRUT)!$D(DUOUT) S XFLAG=1 Q
"RTN","RGEX01",19,0)
 . I Y>0 D
"RTN","RGEX01",20,0)
 .. W !!,"The MPI/PD Exception Purge process will now run."
"RTN","RGEX01",21,0)
 .. W !,"Please come back to this option in ten minutes."
"RTN","RGEX01",22,0)
 .. S XFLAG=1 D QUEPRG
"RTN","RGEX01",23,0)
 L +^RGHL7(991.1,"RG PURGE EXCEPTION"):0 I '$T W $C(7),!!,"The MPI/PD Exception Purge process is currently running.",!,"Please try this option again in ten minutes." S XFLAG=1 G EXIT
"RTN","RGEX01",24,0)
 L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEX01",25,0)
 I $G(PRGSTAT)="C" D
"RTN","RGEX01",26,0)
 . W !!,"The MPI/PD Exception Purge process last ran "_STDT_"."
"RTN","RGEX01",27,0)
 . S DIR(0)="YA",DIR("B")="NO",DIR("??")="^D HLPPRG^RGEX01"
"RTN","RGEX01",28,0)
 . S DIR("A")="Do you want to run the MPI/PD Exception Purge process now? "
"RTN","RGEX01",29,0)
 . D ^DIR K DIR,RGANS S RGANS=Y
"RTN","RGEX01",30,0)
 . I $D(DIRUT)!$D(DUOUT) S XFLAG=1 Q
"RTN","RGEX01",31,0)
 . L +^RGHL7(991.1,"RG PURGE EXCEPTION"):0 D
"RTN","RGEX01",32,0)
 ..I '$T S RGANS=1 Q
"RTN","RGEX01",33,0)
 ..L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEX01",34,0)
 . I RGANS>0 D
"RTN","RGEX01",35,0)
 .. W !!,"The MPI/PD Exception Purge process will now run."
"RTN","RGEX01",36,0)
 .. W !,"Please come back to this option in ten minutes."
"RTN","RGEX01",37,0)
 .. S XFLAG=1 D QUEPRG
"RTN","RGEX01",38,0)
 I XFLAG=1 G EXIT
"RTN","RGEX01",39,0)
 K RGANS
"RTN","RGEX01",40,0)
 D WAIT^DICD
"RTN","RGEX01",41,0)
 D EN^VALM("RG EXCPT SUMMARY")
"RTN","RGEX01",42,0)
 Q
"RTN","RGEX01",43,0)
 ;
"RTN","RGEX01",44,0)
HDR ; -- header code
"RTN","RGEX01",45,0)
 S VALMHDR(1)="MPI/PD Exception Handling"
"RTN","RGEX01",46,0)
 S VALMHDR(2)=""
"RTN","RGEX01",47,0)
 Q
"RTN","RGEX01",48,0)
 ;
"RTN","RGEX01",49,0)
INIT ; -- init variables and list array
"RTN","RGEX01",50,0)
 I '$D(RGSORT) S RGSORT="SD"
"RTN","RGEX01",51,0)
 K @VALMAR
"RTN","RGEX01",52,0)
 I RGSORT="SD" D DTLIST^RGEXHND1
"RTN","RGEX01",53,0)
 E  I RGSORT="ST" D EXCLST^RGEXHND1
"RTN","RGEX01",54,0)
 E  I RGSORT="SN" D PATLST^RGEXHND1
"RTN","RGEX01",55,0)
 E  I RGSORT="VT" D SELTYP^RGEXHND1
"RTN","RGEX01",56,0)
 Q
"RTN","RGEX01",57,0)
 ;
"RTN","RGEX01",58,0)
SORT ;
"RTN","RGEX01",59,0)
 D INIT
"RTN","RGEX01",60,0)
 S VALMBCK="R"
"RTN","RGEX01",61,0)
 Q
"RTN","RGEX01",62,0)
HELP ; -- help code
"RTN","RGEX01",63,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX01",64,0)
 Q
"RTN","RGEX01",65,0)
HLPPRG ;
"RTN","RGEX01",66,0)
 W !,"Enter Y(YES) to run the MPI/PD Exception Purge process now."
"RTN","RGEX01",67,0)
 W !!,"Enter N(NO) to go directly into the MPI/PD Exception Handling option."
"RTN","RGEX01",68,0)
 Q
"RTN","RGEX01",69,0)
 ;
"RTN","RGEX01",70,0)
EXIT ; -- exit code
"RTN","RGEX01",71,0)
 K VADM,RGDFN,RGNM,RGSORT,RGSSN,STAT,STRING,NDX,NM,IEN,IEN2,X,DATA,CNT,EXCTYPE,ETYPE,^TMP("RGEXC",$J),^TMP("RGEX01",$J)
"RTN","RGEX01",72,0)
 Q
"RTN","RGEX01",73,0)
QUEPRG S ZTRTN="MAIN^RGEVPRG",ZTDESC="PURGE ZZ*, OVER 30 DAY AND DUPLICATE RECORDS FROM THE CIRN HL7 EXCEPTION LOG FILE"
"RTN","RGEX01",74,0)
 D NOW^%DTC
"RTN","RGEX01",75,0)
 S ZTIO="",ZTDTH=%
"RTN","RGEX01",76,0)
 I $D(DUZ) S ZTSAVE("DUZ")=DUZ
"RTN","RGEX01",77,0)
 D ^%ZTLOAD
"RTN","RGEX01",78,0)
 D HOME^%ZIS K IO("Q")
"RTN","RGEX01",79,0)
 K ZTDESC,ZTDTH,ZTIO,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE,ZTSK,%
"RTN","RGEX01",80,0)
 Q
"RTN","RGEX01",81,0)
 ;
"RTN","RGEX01",82,0)
EXPND ; -- expand code
"RTN","RGEX01",83,0)
 Q
"RTN","RGEX01",84,0)
CUREX() ;Call to check if there are any patients in the CIRN HL7 EXCEPTION
"RTN","RGEX01",85,0)
 ;LOG file (#991.1) that currently need to be resolved
"RTN","RGEX01",86,0)
 S STAT="",EXCTYP="",RGEX=0
"RTN","RGEX01",87,0)
 F  S STAT=$O(^RGHL7(991.1,"ASTAT",STAT)) Q:STAT=""!RGEX=1  D
"RTN","RGEX01",88,0)
 . F  S EXCTYP=$O(^RGHL7(991.1,"ASTAT",STAT,EXCTYP)) Q:'EXCTYP!RGEX=1  D
"RTN","RGEX01",89,0)
 .. I (EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)))&(STAT=0) S RGEX=1
"RTN","RGEX01",90,0)
 K STAT,EXCTYP
"RTN","RGEX01",91,0)
 Q RGEX
"RTN","RGEX01",92,0)
PROC ; For a given patient, set exceptions STATUS to PROCESSED.
"RTN","RGEX01",93,0)
 ; DFN must be defined
"RTN","RGEX01",94,0)
 Q:'$D(DFN)
"RTN","RGEX01",95,0)
 S EXCTYP=""
"RTN","RGEX01",96,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEX01",97,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEX01",98,0)
 . S RGDFN="",ICN=""
"RTN","RGEX01",99,0)
 . F  S RGDFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN)) Q:'RGDFN  D
"RTN","RGEX01",100,0)
 .. I DFN=RGDFN D
"RTN","RGEX01",101,0)
 ... S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGEX01",102,0)
 ... ;Only set to PROCESSED if patient has national ICN.
"RTN","RGEX01",103,0)
 ... I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEX01",104,0)
 .... ;Exclude Death exceptions, they must be processed manually.
"RTN","RGEX01",105,0)
 .... I (EXCTYP>217)!(EXCTYP<215) D
"RTN","RGEX01",106,0)
 ..... S IEN=0
"RTN","RGEX01",107,0)
 ..... F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEX01",108,0)
 ...... S IEN2=0
"RTN","RGEX01",109,0)
 ...... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEX01",110,0)
 ....... L +^RGHL7(991.1,IEN):10
"RTN","RGEX01",111,0)
 ....... S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX01",112,0)
 ....... D ^DIE K DIE,DA,DR
"RTN","RGEX01",113,0)
 ....... L -^RGHL7(991.1,IEN)
"RTN","RGEX01",114,0)
 K IEN,IEN2,RGDFN,EXCTYP,ICN
"RTN","RGEX01",115,0)
 Q
"RTN","RGEX01",116,0)
PDAT ;
"RTN","RGEX01",117,0)
 K DIRUT
"RTN","RGEX01",118,0)
 W !,"This report prints MPI/PD Data for a selected patient.  The"
"RTN","RGEX01",119,0)
 W !,"information displayed includes the Integration Control Number"
"RTN","RGEX01",120,0)
 W !,"(ICN), Coordinating Master of Record (CMOR), MPI/PD Activity"
"RTN","RGEX01",121,0)
 W !,"Score, Subscription Control Number, Treating Facility and"
"RTN","RGEX01",122,0)
 W !,"Subscriber lists, CMOR History and CMOR Change Request History."
"RTN","RGEX01",123,0)
 W !!,"The information is pulled from the Patient (#2) file, Treating"
"RTN","RGEX01",124,0)
 W !,"Facility List (#391.91) file, Subscription Control (#774) file"
"RTN","RGEX01",125,0)
 W !,"and MPIF CMOR Request (#984.9) file."
"RTN","RGEX01",126,0)
ASK ;Ask for PATIENT
"RTN","RGEX01",127,0)
 I $D(DIRUT) G QUIT
"RTN","RGEX01",128,0)
 W !!,"Patient lookup can be done by Patient Name/SSN or by ICN.",!
"RTN","RGEX01",129,0)
 N DFN,ICN
"RTN","RGEX01",130,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: ",D="SSN^AICN^B^BS^BS5"
"RTN","RGEX01",131,0)
 D MIX^DIC1 K DIC
"RTN","RGEX01",132,0)
 G:Y<0 QUIT
"RTN","RGEX01",133,0)
 S DFN=+Y
"RTN","RGEX01",134,0)
 D START^VAFCPDAT
"RTN","RGEX01",135,0)
 G ASK
"RTN","RGEX01",136,0)
 Q
"RTN","RGEX01",137,0)
QUIT ;
"RTN","RGEX01",138,0)
 K DFN,ICN,D,Y
"RTN","RGEX03")
0^20^B48377306
"RTN","RGEX03",1,0)
RGEX03 ;BAY/ALS-LIST MANAGER FOR MPI/PD EXCEPTIONS ;10/13/99
"RTN","RGEX03",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19**;30 Apr 99
"RTN","RGEX03",3,0)
 ;
"RTN","RGEX03",4,0)
 ;Reference to START^VAFCPDAT supported by IA #3299
"RTN","RGEX03",5,0)
 ;Reference to ^DIA(2 supported by IA #2097
"RTN","RGEX03",6,0)
 ;Reference to ^DPT( supported by IA #2969
"RTN","RGEX03",7,0)
 ;Reference to HINQ^DG10 supported by IA #2076
"RTN","RGEX03",8,0)
 ;Reference to CIRNEXC^MPIFQ0 supported by IA #2942
"RTN","RGEX03",9,0)
 ;Reference to VTQ^MPIFSAQ supported by IA #2941
"RTN","RGEX03",10,0)
 ;
"RTN","RGEX03",11,0)
EN(DATA) ; -- main entry point for RG EXCPT ACTION
"RTN","RGEX03",12,0)
 D EN^VALM("RG EXCPT ACTION")
"RTN","RGEX03",13,0)
 Q
"RTN","RGEX03",14,0)
 ;
"RTN","RGEX03",15,0)
HDR ; -- header code
"RTN","RGEX03",16,0)
 S VALMHDR(1)="MPI/PD EXCEPTION HANDLING ACTIONS."
"RTN","RGEX03",17,0)
 S VALMHDR(2)=""
"RTN","RGEX03",18,0)
 Q
"RTN","RGEX03",19,0)
 ;
"RTN","RGEX03",20,0)
INIT ; -- init variables and list array
"RTN","RGEX03",21,0)
 K ^TMP("RGEXC2",$J)
"RTN","RGEX03",22,0)
 K @VALMAR
"RTN","RGEX03",23,0)
 I DATA="" Q
"RTN","RGEX03",24,0)
 S STR="",LIN=1,STATUS="",NAME="",DOB="",SSN=""
"RTN","RGEX03",25,0)
 S NAME=$P(DATA,"^",1),DOB=$P(DATA,"^",8),SSN=$P(DATA,"^",2)
"RTN","RGEX03",26,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",27,0)
 S STR=$$SETSTR^VALM1("Name:",STR,6,6)
"RTN","RGEX03",28,0)
 S STR=$$SETSTR^VALM1(NAME,STR,14,30)
"RTN","RGEX03",29,0)
 D ADDTMP
"RTN","RGEX03",30,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",31,0)
 S STR=$$SETSTR^VALM1(" SSN:",STR,6,6)
"RTN","RGEX03",32,0)
 S STR=$$SETSTR^VALM1(SSN,STR,14,12)
"RTN","RGEX03",33,0)
 D ADDTMP
"RTN","RGEX03",34,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",35,0)
 S STR=$$SETSTR^VALM1(" DOB:",STR,6,6)
"RTN","RGEX03",36,0)
 S STR=$$SETSTR^VALM1(DOB,STR,14,20)
"RTN","RGEX03",37,0)
 D ADDTMP
"RTN","RGEX03",38,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",39,0)
 S STR=$$SETSTR^VALM1(" DFN:",STR,6,6)
"RTN","RGEX03",40,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",5),STR,14,12)
"RTN","RGEX03",41,0)
 D ADDTMP
"RTN","RGEX03",42,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",43,0)
 S STR=$$SETSTR^VALM1(" ICN:",STR,6,6)
"RTN","RGEX03",44,0)
 S ICN="" S ICN=$P(DATA,"^",6) I ICN<0 S ICN=""
"RTN","RGEX03",45,0)
 S STR=$$SETSTR^VALM1(ICN,STR,14,15)
"RTN","RGEX03",46,0)
 D ADDTMP
"RTN","RGEX03",47,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",48,0)
 S STR=$$SETSTR^VALM1("Date of Death:",STR,6,20)
"RTN","RGEX03",49,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",13),STR,26,20)
"RTN","RGEX03",50,0)
 D ADDTMP
"RTN","RGEX03",51,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",52,0)
 S STR=$$SETSTR^VALM1("Exception Type:",STR,6,20)
"RTN","RGEX03",53,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",4),STR,26,50)
"RTN","RGEX03",54,0)
 D ADDTMP
"RTN","RGEX03",55,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",56,0)
 S STR=$$SETSTR^VALM1("Exception Date:",STR,6,20)
"RTN","RGEX03",57,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",3),STR,26,30)
"RTN","RGEX03",58,0)
 D ADDTMP
"RTN","RGEX03",59,0)
 S STATUS=$P(DATA,"^",9)
"RTN","RGEX03",60,0)
 I STATUS<1 S STATUS="NOT PROCESSED"
"RTN","RGEX03",61,0)
 E  S STATUS="PROCESSED"
"RTN","RGEX03",62,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",63,0)
 S STR=$$SETSTR^VALM1("Exception Status:",STR,6,20)
"RTN","RGEX03",64,0)
 S STR=$$SETSTR^VALM1(STATUS,STR,26,15)
"RTN","RGEX03",65,0)
 D ADDTMP
"RTN","RGEX03",66,0)
 S VALMCNT=LIN-1
"RTN","RGEX03",67,0)
 S DFN=$P(DATA,"^",5)
"RTN","RGEX03",68,0)
 S VAFCDFN=DFN
"RTN","RGEX03",69,0)
 Q
"RTN","RGEX03",70,0)
ADDTMP ;
"RTN","RGEX03",71,0)
 S ^TMP("RGEXC2",$J,LIN,0)=STR
"RTN","RGEX03",72,0)
 S ^TMP("RGEXC2",$J,"IDX",LIN,LIN)=""
"RTN","RGEX03",73,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX03",74,0)
 Q
"RTN","RGEX03",75,0)
 ;
"RTN","RGEX03",76,0)
UPD ;
"RTN","RGEX03",77,0)
 W !,"This option updates the exception status to PROCESSED."
"RTN","RGEX03",78,0)
 W !,"After it is processed it will not be listed in the summary."
"RTN","RGEX03",79,0)
 S DIR("A")="Are you sure you want to change the status?"
"RTN","RGEX03",80,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEX03",81,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEX03",82,0)
 . S IEN="",IEN2=""
"RTN","RGEX03",83,0)
 . S IEN=$P(DATA,"^",10)
"RTN","RGEX03",84,0)
 . S IEN2=$P(DATA,"^",11)
"RTN","RGEX03",85,0)
 . L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",86,0)
 . S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX03",87,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGEX03",88,0)
 . L -^RGHL7(991.1,IEN)
"RTN","RGEX03",89,0)
 . S $P(DATA,"^",9)=1
"RTN","RGEX03",90,0)
 . D INIT
"RTN","RGEX03",91,0)
 K DIR,DIRUT
"RTN","RGEX03",92,0)
 S VALMBCK="R"
"RTN","RGEX03",93,0)
 Q
"RTN","RGEX03",94,0)
PA ;Patient Audit
"RTN","RGEX03",95,0)
 I '$O(^DIA(2,"B",VAFCDFN,0)) S VALMSG="This patient has no audit data available.",VALMBCK="" G PAQ
"RTN","RGEX03",96,0)
 N IEN S DFN=VAFCDFN,QFLG=1 D FULL^VALM1 D:$T(ASK2^RGMTAUD)]"" ASK2^RGMTAUD S VALMBCK="R"
"RTN","RGEX03",97,0)
 K QFLG
"RTN","RGEX03",98,0)
PAQ Q
"RTN","RGEX03",99,0)
HI ;Hinq Inquiry
"RTN","RGEX03",100,0)
 S VALMBCK=""
"RTN","RGEX03",101,0)
 D HINQ^DG10
"RTN","RGEX03",102,0)
 D PAUSE^VALM1
"RTN","RGEX03",103,0)
 S VALMBCK="R"
"RTN","RGEX03",104,0)
 Q
"RTN","RGEX03",105,0)
DISP ; Display Only Query
"RTN","RGEX03",106,0)
 S VALMBCK=""
"RTN","RGEX03",107,0)
 D FULL^VALM1
"RTN","RGEX03",108,0)
 S MPIVAR("DFN")=DFN
"RTN","RGEX03",109,0)
 S MPIVAR("SSN")=SSN
"RTN","RGEX03",110,0)
 S MPIVAR("NM")=NAME
"RTN","RGEX03",111,0)
 S MPIVAR("DOB")=$P($P(DATA,"^",7),".",1)
"RTN","RGEX03",112,0)
 D VTQ^MPIFSAQ(.MPIVAR)
"RTN","RGEX03",113,0)
 D PAUSE^VALM1
"RTN","RGEX03",114,0)
 S VALMBCK="R"
"RTN","RGEX03",115,0)
 K MPIVAR
"RTN","RGEX03",116,0)
 Q
"RTN","RGEX03",117,0)
INTL ; Single Patient Initialization to MPI
"RTN","RGEX03",118,0)
 S VALMBCK="",MPIFRES="",MPIFINT=""
"RTN","RGEX03",119,0)
 D FULL^VALM1
"RTN","RGEX03",120,0)
 D CIRNEXC^MPIFQ0
"RTN","RGEX03",121,0)
 D PAUSE^VALM1
"RTN","RGEX03",122,0)
 K MPIFRES,MPIFINT
"RTN","RGEX03",123,0)
 S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGEX03",124,0)
 S $P(DATA,"^",6)=$G(ICN)
"RTN","RGEX03",125,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEX03",126,0)
 ; If patient has a nation ICN, change status to processed
"RTN","RGEX03",127,0)
 I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEX03",128,0)
 . S IEN="",IEN2=""
"RTN","RGEX03",129,0)
 . S IEN=$P(DATA,"^",10)
"RTN","RGEX03",130,0)
 . S IEN2=$P(DATA,"^",11)
"RTN","RGEX03",131,0)
 . L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",132,0)
 . S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX03",133,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGEX03",134,0)
 . L -^RGHL7(991.1,IEN)
"RTN","RGEX03",135,0)
 . S $P(DATA,"^",9)=1
"RTN","RGEX03",136,0)
 D INIT
"RTN","RGEX03",137,0)
 S VALMBCK="R"
"RTN","RGEX03",138,0)
 Q
"RTN","RGEX03",139,0)
LOAD ; Edit Patient Data, if patient's eligibility is verified
"RTN","RGEX03",140,0)
 ; check for DG ELIGIBILITY key for user
"RTN","RGEX03",141,0)
 S VALMBCK="",DATAOLD=""
"RTN","RGEX03",142,0)
 D FULL^VALM1
"RTN","RGEX03",143,0)
 D ELIG^VADPT
"RTN","RGEX03",144,0)
 I $P(VAEL(8),"^",1)="V" D
"RTN","RGEX03",145,0)
 . I '$D(^XUSEC("DG ELIGIBILITY",DUZ)) D
"RTN","RGEX03",146,0)
 .. W !!,"Eligibility has been verified for this patient."
"RTN","RGEX03",147,0)
 .. W !!,"You do not have access to edit the Name, Date of "
"RTN","RGEX03",148,0)
 .. W !,"Birth or Social Security Number for this patient."
"RTN","RGEX03",149,0)
 .. D PAUSE^VALM1
"RTN","RGEX03",150,0)
 .. S VALMBCK="R"
"RTN","RGEX03",151,0)
 . E  D SENS
"RTN","RGEX03",152,0)
 E  D SENS
"RTN","RGEX03",153,0)
 Q
"RTN","RGEX03",154,0)
SENS ; check for patient sensitivity and user security
"RTN","RGEX03",155,0)
 N RESULT,RGSENS,SENSTV,DA,DR,DIC,DIQ
"RTN","RGEX03",156,0)
 ;S DIC=38.1,DR="2",DA=DFN,DIQ="RGSENS",DIQ(0)="I"
"RTN","RGEX03",157,0)
 ;D EN^DIQ1
"RTN","RGEX03",158,0)
 ;S SENSTV=$G(RGSENS(38.1,DFN,2,"I"))
"RTN","RGEX03",159,0)
 ;I SENSTV=1 D
"RTN","RGEX03",160,0)
 D PTSEC^DGSEC4(.RESULT,DFN)
"RTN","RGEX03",161,0)
 I RESULT(1)>0 D
"RTN","RGEX03",162,0)
 . I '$D(^XUSEC("DG SENSITIVITY",DUZ)) D
"RTN","RGEX03",163,0)
 .. W !!,"PATIENT MARKED SENSITIVE."
"RTN","RGEX03",164,0)
 .. W !!,"You do not have the proper security to"
"RTN","RGEX03",165,0)
 .. W !,"edit this patient's data."
"RTN","RGEX03",166,0)
 .. D PAUSE^VALM1
"RTN","RGEX03",167,0)
 .. S VALMBCK="R"
"RTN","RGEX03",168,0)
 . E  D EDIT
"RTN","RGEX03",169,0)
 E  D EDIT
"RTN","RGEX03",170,0)
 Q
"RTN","RGEX03",171,0)
EDIT ; edit patient data
"RTN","RGEX03",172,0)
 S ACCESS=0
"RTN","RGEX03",173,0)
 D REC
"RTN","RGEX03",174,0)
 Q:ACCESS=0
"RTN","RGEX03",175,0)
 S DIE="^DPT(",DA=DFN
"RTN","RGEX03",176,0)
 S DR=".01//^S X=NAME;.03//^S X=DOB;.09//^S X=SSN"
"RTN","RGEX03",177,0)
 L +^DPT(DFN):10
"RTN","RGEX03",178,0)
 D ^DIE
"RTN","RGEX03",179,0)
 L -^DPT(DFN)
"RTN","RGEX03",180,0)
 S DATAOLD=DATA
"RTN","RGEX03",181,0)
 D DEATH
"RTN","RGEX03",182,0)
 D DEM^VADPT
"RTN","RGEX03",183,0)
 S DATA=VADM(1)_"^"_$P($G(VADM(2)),"^",1)_"^"_$P(DATAOLD,"^",3)_"^"_$P(DATAOLD,"^",4)_"^"_DFN_"^"_$P(DATAOLD,"^",6)_"^"
"RTN","RGEX03",184,0)
 S DATA=DATA_$G(VADM(3))_"^"_$P(DATAOLD,"^",9)_"^"_$P(DATAOLD,"^",10)_"^"_$P(DATAOLD,"^",11)_"^"_$P(DATAOLD,"^",12)_"^"_$P($G(VADM(6)),"^",2)
"RTN","RGEX03",185,0)
 D INIT
"RTN","RGEX03",186,0)
 S VALMBCK="R"
"RTN","RGEX03",187,0)
 K DIE,DGNEW,DATAOLD,VAEL,ACCESS,DGNPSSN
"RTN","RGEX03",188,0)
QUIT Q
"RTN","RGEX03",189,0)
REC ; Check if user is attempting to access own record
"RTN","RGEX03",190,0)
 ; check for security key
"RTN","RGEX03",191,0)
 I $D(^XUSEC("DG RECORD ACCESS",+DUZ)) S ACCESS=1 Q
"RTN","RGEX03",192,0)
 S DGNPSSN=$$GET1^DIQ(200,+DUZ_",",9,"I","","DGNPERR")
"RTN","RGEX03",193,0)
 I 'DGNPSSN D  Q
"RTN","RGEX03",194,0)
 . W !!,"Your SSN is missing from the NEW PERSON file."
"RTN","RGEX03",195,0)
 . W !,"Contact your ADP Coordinator."
"RTN","RGEX03",196,0)
 . D PAUSE^VALM1
"RTN","RGEX03",197,0)
 . S VALMBCK="R"
"RTN","RGEX03",198,0)
 I DGNPSSN=SSN D  Q
"RTN","RGEX03",199,0)
 . W !!,"Security regulations prohibit computer access to your"
"RTN","RGEX03",200,0)
 . W !,"own medical record."
"RTN","RGEX03",201,0)
 . D PAUSE^VALM1
"RTN","RGEX03",202,0)
 . S VALMBCK="R"
"RTN","RGEX03",203,0)
 E  S ACCESS=1
"RTN","RGEX03",204,0)
 Q
"RTN","RGEX03",205,0)
DEATH ; Check for access to edit date of death
"RTN","RGEX03",206,0)
 I $D(^XUSEC("DG DETAIL",+DUZ)) D
"RTN","RGEX03",207,0)
 . K VADM,DIE,DA,DR
"RTN","RGEX03",208,0)
 . S DOD=""
"RTN","RGEX03",209,0)
 . D DEM^VADPT S DOD=$P($G(VADM(6)),"^",2)
"RTN","RGEX03",210,0)
 . S DIE="^DPT(",DA=DFN,DR=".351//^S X=DOD"
"RTN","RGEX03",211,0)
 . L +^DPT(DFN):10
"RTN","RGEX03",212,0)
 . D ^DIE
"RTN","RGEX03",213,0)
 . L -^DPT(DFN)
"RTN","RGEX03",214,0)
 E  W !!,"You do not have the proper security to edit date of death." D PAUSE^VALM1 D INIT S VALMBCK="R"
"RTN","RGEX03",215,0)
 K VADM,DIE,DA,DR,DOD
"RTN","RGEX03",216,0)
 Q
"RTN","RGEX03",217,0)
INQ ; Patient Inquiry
"RTN","RGEX03",218,0)
 S VALMBCK=""
"RTN","RGEX03",219,0)
 D FULL^VALM1
"RTN","RGEX03",220,0)
 D EN^DGRPD
"RTN","RGEX03",221,0)
 D PAUSE^VALM1
"RTN","RGEX03",222,0)
 D CLEAN^VALM10
"RTN","RGEX03",223,0)
 D INIT
"RTN","RGEX03",224,0)
 S VALMBCK="R"
"RTN","RGEX03",225,0)
 Q
"RTN","RGEX03",226,0)
PDAT ; Call VAFCPDAT, MPI/PD Data report to list CMOR, Treating Facilities,
"RTN","RGEX03",227,0)
 ; Subscribers etc.
"RTN","RGEX03",228,0)
 S VALMBCK=""
"RTN","RGEX03",229,0)
 D FULL^VALM1
"RTN","RGEX03",230,0)
 D START^VAFCPDAT
"RTN","RGEX03",231,0)
 ;D PAUSE^VALM1
"RTN","RGEX03",232,0)
 S VALMBCK="R"
"RTN","RGEX03",233,0)
 Q
"RTN","RGEX03",234,0)
HELP ; -- help code
"RTN","RGEX03",235,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX03",236,0)
 Q
"RTN","RGEX03",237,0)
 ;
"RTN","RGEX03",238,0)
EXIT ; -- exit code
"RTN","RGEX03",239,0)
 S VALMBCK=""
"RTN","RGEX03",240,0)
 K ^TMP("RGEXC2",$J),DFN,DIR,IEN,IEN2,NAME,DOB,SSN,LIN,STATUS,STR,VAFCDFN,X,Y
"RTN","RGEX03",241,0)
 S VALMBCK="R"
"RTN","RGEX03",242,0)
 Q
"RTN","RGEX03",243,0)
 ;
"RTN","RGEX03",244,0)
EXPND ; -- expand code
"RTN","RGEX03",245,0)
 Q
"RTN","RGEX03",246,0)
 ;
"RTN","RGEXHND1")
0^12^B33768752
"RTN","RGEXHND1",1,0)
RGEXHND1 ;BAY/ALS-MPI/PD EXCEPTION HANDLING UTILITY ;10/08/99
"RTN","RGEXHND1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19**;30 Apr 99
"RTN","RGEXHND1",3,0)
DTLIST ;List exceptions by date
"RTN","RGEXHND1",4,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",5,0)
 S EXCDT="",EXCTYP="",CNT=0
"RTN","RGEXHND1",6,0)
 F  S EXCDT=$O(^RGHL7(991.1,"AD",EXCDT)) Q:'EXCDT  D
"RTN","RGEXHND1",7,0)
 . S IEN=0
"RTN","RGEXHND1",8,0)
 . F  S IEN=$O(^RGHL7(991.1,"AD",EXCDT,IEN)) Q:'IEN  D
"RTN","RGEXHND1",9,0)
 .. S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:NUM<1  D
"RTN","RGEXHND1",10,0)
 ... S IEN2=0
"RTN","RGEXHND1",11,0)
 ... F  S IEN2=$O(^RGHL7(991.1,IEN,1,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",12,0)
 .... S EXCTYP=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",3)
"RTN","RGEXHND1",13,0)
 .... I EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)) D ADDREC
"RTN","RGEXHND1",14,0)
 K I,NUM,EXCDT,EXCTYP
"RTN","RGEXHND1",15,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",16,0)
 Q
"RTN","RGEXHND1",17,0)
NDATA ; There is no data matching the criteria
"RTN","RGEXHND1",18,0)
 S CNT=CNT+1,STRING=""
"RTN","RGEXHND1",19,0)
 S STRING=$$SETSTR^VALM1("There were no exceptions found.",STRING,5,35)
"RTN","RGEXHND1",20,0)
 S ^TMP("RGEXC",$J,CNT,0)=STRING
"RTN","RGEXHND1",21,0)
 S ^TMP("RGEXC",$J,"IDX",CNT,CNT)=""
"RTN","RGEXHND1",22,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",23,0)
 Q
"RTN","RGEXHND1",24,0)
EXCLST ;List exceptions by type
"RTN","RGEXHND1",25,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",26,0)
 S CNT=0,EXCDT="",EXCTYP=""
"RTN","RGEXHND1",27,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",28,0)
 . I EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)) D
"RTN","RGEXHND1",29,0)
 .. S IEN=0
"RTN","RGEXHND1",30,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEXHND1",31,0)
 ... S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:NUM<1  D
"RTN","RGEXHND1",32,0)
 .... S IEN2=0
"RTN","RGEXHND1",33,0)
 .... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",34,0)
 ..... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3) Q:'EXCDT
"RTN","RGEXHND1",35,0)
 ..... D ADDREC
"RTN","RGEXHND1",36,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",37,0)
 Q
"RTN","RGEXHND1",38,0)
PATLST ;List exceptions by patient
"RTN","RGEXHND1",39,0)
 K ^TMP("RGEXC",$J),^TMP("RGEX01",$J)
"RTN","RGEXHND1",40,0)
 S CNT=0,EXCDT="",EXCTYP="",NDX=0,NAME=""
"RTN","RGEXHND1",41,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",42,0)
 . I EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)) D
"RTN","RGEXHND1",43,0)
 .. S DFN=""
"RTN","RGEXHND1",44,0)
 .. F  S DFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN)) Q:'DFN  D
"RTN","RGEXHND1",45,0)
 ... S IEN=0
"RTN","RGEXHND1",46,0)
 ... F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN,IEN)) Q:'IEN  D
"RTN","RGEXHND1",47,0)
 .... S IEN2=0
"RTN","RGEXHND1",48,0)
 .... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",49,0)
 ..... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3) Q:'EXCDT
"RTN","RGEXHND1",50,0)
 ..... D DEM^VADPT S NAME=VADM(1) Q:NAME=""
"RTN","RGEXHND1",51,0)
 ..... S NDX=NDX+1
"RTN","RGEXHND1",52,0)
 ..... S ^TMP("RGEX01",$J,NAME,NDX)=$G(VADM(1))_"^"_IEN_"^"_IEN2_"^"_EXCTYP_"^"_EXCDT
"RTN","RGEXHND1",53,0)
 D PATTMP
"RTN","RGEXHND1",54,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",55,0)
 K DFN
"RTN","RGEXHND1",56,0)
 Q
"RTN","RGEXHND1",57,0)
PATTMP ;
"RTN","RGEXHND1",58,0)
 S NM=""
"RTN","RGEXHND1",59,0)
 F  S NM=$O(^TMP("RGEX01",$J,NM)) Q:NM=""  D
"RTN","RGEXHND1",60,0)
 . S NDX=0
"RTN","RGEXHND1",61,0)
 . F  S NDX=$O(^TMP("RGEX01",$J,NM,NDX)) Q:'NDX  D
"RTN","RGEXHND1",62,0)
 .. S IEN=$P(^TMP("RGEX01",$J,NM,NDX),"^",2)
"RTN","RGEXHND1",63,0)
 .. S IEN2=$P(^TMP("RGEX01",$J,NM,NDX),"^",3)
"RTN","RGEXHND1",64,0)
 .. S EXCTYP=$P(^TMP("RGEX01",$J,NM,NDX),"^",4)
"RTN","RGEXHND1",65,0)
 .. S EXCDT=$P(^TMP("RGEX01",$J,NM,NDX),"^",5)
"RTN","RGEXHND1",66,0)
 .. D ADDREC
"RTN","RGEXHND1",67,0)
 K NDX,NM,NAME
"RTN","RGEXHND1",68,0)
 Q
"RTN","RGEXHND1",69,0)
SELTYP ; List all exceptions of type selected by user
"RTN","RGEXHND1",70,0)
 S EXCTYPE="",FLAG=0,ETYPE=""
"RTN","RGEXHND1",71,0)
 K DIR,Y,DIC
"RTN","RGEXHND1",72,0)
 S DIR("A")="Enter an exception type to view: "
"RTN","RGEXHND1",73,0)
 ;S DIR(0)="PM^991.11:QAM"
"RTN","RGEXHND1",74,0)
 S DIR(0)="SAM^209:Required field(s) DOB or Name Missing;213:SSN Match Failed;214:Name Doesn't Match;215:Death Entry on MPI not VISTA;216:Death Entry on Vista not MPI;217:Death Entries on MPI and Vista DON'T MATCH;218:Potential Matches Returned"
"RTN","RGEXHND1",75,0)
 S DIR("?")="^D HLPSEL^RGEXHND1"
"RTN","RGEXHND1",76,0)
 D ^DIR
"RTN","RGEXHND1",77,0)
 I Y<1 S RGSORT="SD" D SORT^RGEX01  Q
"RTN","RGEXHND1",78,0)
 Q:$D(DUOUT)!$D(DTOUT)
"RTN","RGEXHND1",79,0)
 S EXCTYPE=+Y,ETYPE=$P(^RGHL7(991.11,EXCTYPE,10),"^",1)
"RTN","RGEXHND1",80,0)
 I EXCTYPE=(209)!((EXCTYPE>212)&(EXCTYPE<219)) S FLAG=1
"RTN","RGEXHND1",81,0)
 I FLAG=1 D ADDSEL
"RTN","RGEXHND1",82,0)
 E  I FLAG=0 D
"RTN","RGEXHND1",83,0)
 . W !,"Not a valid selection."
"RTN","RGEXHND1",84,0)
 . D SELTYP
"RTN","RGEXHND1",85,0)
 K FLAG,Y,DIR,DIC,DTOUT,DUOUT
"RTN","RGEXHND1",86,0)
 Q
"RTN","RGEXHND1",87,0)
ADDSEL ;
"RTN","RGEXHND1",88,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",89,0)
 S CNT=0,EXCDT="",EXCTYP=""
"RTN","RGEXHND1",90,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",91,0)
 . I EXCTYP=EXCTYPE D
"RTN","RGEXHND1",92,0)
 .. S IEN=0
"RTN","RGEXHND1",93,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEXHND1",94,0)
 ... S IEN2=0
"RTN","RGEXHND1",95,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",96,0)
 .... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3)
"RTN","RGEXHND1",97,0)
 .... D ADDREC
"RTN","RGEXHND1",98,0)
 I CNT<1 D
"RTN","RGEXHND1",99,0)
 . W !,"There are no "_ETYPE
"RTN","RGEXHND1",100,0)
 . W !,"exceptions that need processing."
"RTN","RGEXHND1",101,0)
 . D SELTYP
"RTN","RGEXHND1",102,0)
 Q
"RTN","RGEXHND1",103,0)
HLPSEL ;
"RTN","RGEXHND1",104,0)
 D FULL^VALM1
"RTN","RGEXHND1",105,0)
 ;W !,"The following exception types are handled by this option:"
"RTN","RGEXHND1",106,0)
 ;W !!,"Required field(s) Date of Birth or Name missing",?50,"(209)"
"RTN","RGEXHND1",107,0)
 ;W !,"SSN Match Failed",?50,"(213)"
"RTN","RGEXHND1",108,0)
 ;W !,"Name Doesn't Match",?50,"(214)"
"RTN","RGEXHND1",109,0)
 ;W !,"Death Entry on MPI not in VISTA",?50,"(215)"
"RTN","RGEXHND1",110,0)
 ;W !,"Death Entry on Vista not in MPI",?50,"(216)"
"RTN","RGEXHND1",111,0)
 ;W !,"Death Entries on MPI and Vista DO NOT MATCH",?50,"(217)"
"RTN","RGEXHND1",112,0)
 ;W !,"Potential Matches Returned",?50,"(218)"
"RTN","RGEXHND1",113,0)
 S VALMBCK="R"
"RTN","RGEXHND1",114,0)
 Q
"RTN","RGEXHND1",115,0)
ADDREC ;
"RTN","RGEXHND1",116,0)
 S ETEXT="",RGDFN="",ICN="",RGNM="",STAT="",DOD=""
"RTN","RGEXHND1",117,0)
 S ETEXT=$P($G(^RGHL7(991.11,EXCTYP,10)),"^",1)
"RTN","RGEXHND1",118,0)
 S RGDFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'RGDFN
"RTN","RGEXHND1",119,0)
 S STAT=$P($G(^RGHL7(991.1,IEN,1,IEN2,0)),"^",5)
"RTN","RGEXHND1",120,0)
 S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGEXHND1",121,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEXHND1",122,0)
 I (STAT<1)!(STAT="") DO
"RTN","RGEXHND1",123,0)
 .;Only list exceptions that are Not Processed
"RTN","RGEXHND1",124,0)
 .; only list patients with local ICN
"RTN","RGEXHND1",125,0)
 . I $E(ICN,1,3)=$E($P(HOME,"^",3),1,3)!(ICN<0)!((EXCTYP<218)&(EXCTYP>214)) D
"RTN","RGEXHND1",126,0)
 .. S DFN=RGDFN D DEM^VADPT
"RTN","RGEXHND1",127,0)
 .. S RGNM=VADM(1)
"RTN","RGEXHND1",128,0)
 .. S RGSSN=$P($G(VADM(2)),"^",1)
"RTN","RGEXHND1",129,0)
 .. S DOB=$G(VADM(3)) I DOB="" S DOB="^"
"RTN","RGEXHND1",130,0)
 .. S DOD=$P($P($G(VADM(6)),"^",2),"@",1)
"RTN","RGEXHND1",131,0)
 .. S EXDATE=$P($$FMTE^XLFDT(EXCDT,2),"@",1)
"RTN","RGEXHND1",132,0)
 .. S CNT=CNT+1
"RTN","RGEXHND1",133,0)
 .. S STRING=""
"RTN","RGEXHND1",134,0)
 .. I ICN<0 S ICN=""
"RTN","RGEXHND1",135,0)
 .. S STRING=$$SETSTR^VALM1(CNT,STRING,1,4)
"RTN","RGEXHND1",136,0)
 .. S STRING=$$SETSTR^VALM1($E(RGNM,1,22),STRING,6,21)
"RTN","RGEXHND1",137,0)
 .. S STRING=$$SETSTR^VALM1(RGSSN,STRING,28,10)
"RTN","RGEXHND1",138,0)
 .. S STRING=$$SETSTR^VALM1(EXDATE,STRING,39,8)
"RTN","RGEXHND1",139,0)
 .. S STRING=$$SETSTR^VALM1(ETEXT,STRING,49,32)
"RTN","RGEXHND1",140,0)
 .. S ^TMP("RGEXC",$J,CNT,0)=STRING
"RTN","RGEXHND1",141,0)
 .. S ^TMP("RGEXC",$J,"IDX",CNT,CNT)=""
"RTN","RGEXHND1",142,0)
 .. S ^TMP("RGEXC",$J,CNT,"DATA")=RGNM_"^"_RGSSN_"^"_$P($$FMTE^XLFDT(EXCDT),"@",1)_"^"_ETEXT_"^"_DFN_"^"_ICN_"^"_DOB_"^"_STAT_"^"_IEN_"^"_IEN2_"^"_CNT_"^"_DOD
"RTN","RGEXHND1",143,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",144,0)
 K RGDFN,RGNM,RGSSN,EXDATE,ETEXT,ICN,DOB,STAT,VADM,HOME,STRING,DOD
"RTN","RGEXHND1",145,0)
 Q
"RTN","RGEXHND1",146,0)
SELECT ;
"RTN","RGEXHND1",147,0)
 I $G(STRING)["no exceptions found" D SORT^RGEX01  Q
"RTN","RGEXHND1",148,0)
 N VALMY
"RTN","RGEXHND1",149,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","RGEXHND1",150,0)
 I '$D(VALMY) Q
"RTN","RGEXHND1",151,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",152,0)
 S DATA="",CNT=""
"RTN","RGEXHND1",153,0)
 S CNT=$O(VALMY(0))
"RTN","RGEXHND1",154,0)
 S DATA=$G(^TMP("RGEXC",$J,CNT,"DATA"))
"RTN","RGEXHND1",155,0)
 I '$D(DATA) S CNT=0 Q
"RTN","RGEXHND1",156,0)
 D CLEAN^VALM10
"RTN","RGEXHND1",157,0)
 D EN^RGEX03(DATA)
"RTN","RGEXHND1",158,0)
 I RGSORT="VT" D
"RTN","RGEXHND1",159,0)
 . K @VALMAR
"RTN","RGEXHND1",160,0)
 . D ADDSEL
"RTN","RGEXHND1",161,0)
 E  I RGSORT'="VT" D SORT^RGEX01
"RTN","RGEXHND1",162,0)
 ;
"RTN","RGEXHND1",163,0)
 Q
"RTN","RGEXHND1",164,0)
QUIT ;
"RTN","RGHLLOG")
0^24^B22278333
"RTN","RGHLLOG",1,0)
RGHLLOG ;CAIRO/DKM-LOG MESSAGE PROCESSING INFO ;09/04/98
"RTN","RGHLLOG",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3,11,13,18,19**;30 Apr 99
"RTN","RGHLLOG",3,0)
 ;Reference to ^HLMA("C" supported by IA #3244
"RTN","RGHLLOG",4,0)
 ;=================================================================
"RTN","RGHLLOG",5,0)
 ; Log information about message processing and exceptions
"RTN","RGHLLOG",6,0)
 ; in CIRN HL7 Exception Log file.
"RTN","RGHLLOG",7,0)
 ;=================================================================
"RTN","RGHLLOG",8,0)
 ; Start time for run log
"RTN","RGHLLOG",9,0)
START(RGMSG,RGDC,RGPARAM) ;
"RTN","RGHLLOG",10,0)
 ;This entry point starts the log process in the CIRN HL7 EXCEPTION LOG
"RTN","RGHLLOG",11,0)
 ;file (#991.1), if the (#6) MINIMAL EXCEPTION LOGGING? field in
"RTN","RGHLLOG",12,0)
 ;File #990.8 is set to 0.
"RTN","RGHLLOG",13,0)
 ; Input: Required
"RTN","RGHLLOG",14,0)
 ;   RGMSG - IEN of message entry in File #773, usually HLMTIEN
"RTN","RGHLLOG",15,0)
 ;        Optional
"RTN","RGHLLOG",16,0)
 ;   RGDC - Event Class, associated with an entry in File #
"RTN","RGHLLOG",17,0)
 ;   RGPARAM - reprocessing routine
"RTN","RGHLLOG",18,0)
 S U="^"
"RTN","RGHLLOG",19,0)
 K RGLOG
"RTN","RGHLLOG",20,0)
 S RGLOG(3)=$G(RGMSG),RGLOG(5)=$G(RGDC),RGLOG(4)=$G(RGPARAM),RGLOG(1)=$$NOW^XLFDT
"RTN","RGHLLOG",21,0)
 I '$P(^RGSITE("COR",1,0),U,8) S RGLOG=$$CREATE
"RTN","RGHLLOG",22,0)
 Q
"RTN","RGHLLOG",23,0)
 ; Create a log entry
"RTN","RGHLLOG",24,0)
CREATE() Q:$G(RGLOG) RGLOG
"RTN","RGHLLOG",25,0)
 L +^RGHL7(991.1,0):10
"RTN","RGHLLOG",26,0)
 S RGLOG=$O(^RGHL7(991.1,$C(32)),-1)+1
"RTN","RGHLLOG",27,0)
 S:$G(RGLOG(1))="" RGLOG(1)=$$NOW^XLFDT
"RTN","RGHLLOG",28,0)
 S RGLOG(3)=$S($G(RGLOG(3))=0:0,$G(HL("MID"))="":"",1:$$IEN773($G(HL("MID"))))
"RTN","RGHLLOG",29,0)
 S (DA,X)=RGLOG,DIC="^RGHL7(991.1,",DIC(0)="L",DLAYGO=991.1,DIC("DR")="1///"_$G(RGLOG(1))_";3////"_$G(RGLOG(3))_";5///"_$G(RGLOG(5))_";4////"_$G(RGLOG(4)) K DD,DO D FILE^DICN K DIC,DA,X,DLAYGO
"RTN","RGHLLOG",30,0)
 L -^RGHL7(991.1,0)
"RTN","RGHLLOG",31,0)
 Q RGLOG
"RTN","RGHLLOG",32,0)
 ; Log time run completed
"RTN","RGHLLOG",33,0)
STOP(RGQUIT) ;
"RTN","RGHLLOG",34,0)
 ;This entry point completes the logging process
"RTN","RGHLLOG",35,0)
 ; Input: required
"RTN","RGHLLOG",36,0)
 ;    RGQUIT - 0 for success and 1 for failure
"RTN","RGHLLOG",37,0)
 ;
"RTN","RGHLLOG",38,0)
 Q:'$G(RGLOG)
"RTN","RGHLLOG",39,0)
 L +^RGHL7(991.1,RGLOG):10
"RTN","RGHLLOG",40,0)
 S DIE="^RGHL7(991.1,",DR="1.5///NOW;1.6///^S X=$G(RGQUIT)",DA=RGLOG D ^DIE K DIE,DA,DR
"RTN","RGHLLOG",41,0)
 L -^RGHL7(991.1,RGLOG)
"RTN","RGHLLOG",42,0)
 K RGLOG,RGQUIT,X,Y,DIC,DIE
"RTN","RGHLLOG",43,0)
 Q
"RTN","RGHLLOG",44,0)
 ; Log unclassified exception (old entry point)
"RTN","RGHLLOG",45,0)
ERR(RGERR,RGSEV) ;
"RTN","RGHLLOG",46,0)
 D EXC(18,RGERR)
"RTN","RGHLLOG",47,0)
 S RGQUIT=$G(RGQUIT)!$G(RGSEV)
"RTN","RGHLLOG",48,0)
 Q
"RTN","RGHLLOG",49,0)
 ; Log an exception
"RTN","RGHLLOG",50,0)
EXC(RGEXC,RGERR,RGDFN,MSGID,STATNUM) ;
"RTN","RGHLLOG",51,0)
 ;This entry point logs exceptions in the CIRN HL7 EXCEPTION LOG
"RTN","RGHLLOG",52,0)
 ;file (#991.1)
"RTN","RGHLLOG",53,0)
 ; Input: Required
"RTN","RGHLLOG",54,0)
 ;   RGEXC - Exception type in File #991.11
"RTN","RGHLLOG",55,0)
 ;   RGERR - Supplemental text
"RTN","RGHLLOG",56,0)
 ;        Optional
"RTN","RGHLLOG",57,0)
 ;   RGDFN - IEN in the PATIENT file (#2)
"RTN","RGHLLOG",58,0)
 ;   MSGID - message id of the HL7 message where the exception was encountered (optional)
"RTN","RGHLLOG",59,0)
 ;   STATNUM - station # of site that encountered the error (optional) - if not defined then the local site is assumed, using $$SITE^VASITE
"RTN","RGHLLOG",60,0)
 ;
"RTN","RGHLLOG",61,0)
 I $L($G(HL("MID"))) Q:$$INVEXC(HL("MID"))  ; is the exception valid?
"RTN","RGHLLOG",62,0)
 N RGI,RGZ
"RTN","RGHLLOG",63,0)
 S U="^"
"RTN","RGHLLOG",64,0)
 S:RGEXC[U RGERR=$P(RGEXC,U,2,999),RGEXC=+RGEXC
"RTN","RGHLLOG",65,0)
 S:RGEXC'=+RGEXC RGERR=RGEXC,RGEXC=18
"RTN","RGHLLOG",66,0)
 S:'$D(^RGHL7(991.11,RGEXC)) RGEXC=18
"RTN","RGHLLOG",67,0)
 L +^RGHL7(991.11,RGEXC):10
"RTN","RGHLLOG",68,0)
 S RGZ=$G(^RGHL7(991.11,RGEXC,0))
"RTN","RGHLLOG",69,0)
 S:$L(RGZ) $P(^RGHL7(991.11,RGEXC,0),U,5)=$P(RGZ,U,5)+1
"RTN","RGHLLOG",70,0)
 S:$P(RGZ,U,2)>1 RGQUIT=1
"RTN","RGHLLOG",71,0)
 L -^RGHL7(991.11,RGEXC)
"RTN","RGHLLOG",72,0)
 S RGLOG=$$CREATE
"RTN","RGHLLOG",73,0)
 L +^RGHL7(991.1,RGLOG):10
"RTN","RGHLLOG",74,0)
 S RGI=$O(^RGHL7(991.1,RGLOG,1,$C(32)),-1)+1
"RTN","RGHLLOG",75,0)
 S RGERR=$E($G(RGERR),1,250)
"RTN","RGHLLOG",76,0)
 S DIC="^RGHL7(991.1,"_RGLOG_",1,"
"RTN","RGHLLOG",77,0)
 S X=RGI,DA(1)=RGLOG,DIC(0)="FL",DLAYGO=991.12,DIC("P")=$P(^DD(991.1,2,0),"^",2)
"RTN","RGHLLOG",78,0)
 D ^DIC
"RTN","RGHLLOG",79,0)
 S DIE=DIC
"RTN","RGHLLOG",80,0)
 K DIC,DA,DR,DLAYGO
"RTN","RGHLLOG",81,0)
 S STAT=0
"RTN","RGHLLOG",82,0)
 S DIC="3.8",DIC(0)="Z",X="MPIF EXCEPTIONS" D ^DIC K DIC
"RTN","RGHLLOG",83,0)
 S RGMG=$P($G(Y),"^",1)
"RTN","RGHLLOG",84,0)
 I $P(^RGHL7(991.11,RGEXC,0),U,4)=RGMG S STAT=1
"RTN","RGHLLOG",85,0)
 S DA(1)=RGLOG,DA=RGI,DR="2///"_$G(RGEXC)_";3///"_$G(RGDFN)_";6///"_$G(STAT)_";10///"_$G(RGERR)
"RTN","RGHLLOG",86,0)
 D ^DIE K DIE,DA,DR
"RTN","RGHLLOG",87,0)
 L -^RGHL7(991.1,RGLOG)
"RTN","RGHLLOG",88,0)
 S RGI=$P(RGZ,U,3),RGZ=$P(RGZ,U,4)
"RTN","RGHLLOG",89,0)
 ;
"RTN","RGHLLOG",90,0)
 ;If the action type is for the MPI Exception Handler, send exception to the handler and quit
"RTN","RGHLLOG",91,0)
 I (RGI=3) D SENDMPI^RGHLLOG1($G(RGEXC),$G(RGERR),$G(RGDFN),$G(MSGID),$G(STATNUM)) Q
"RTN","RGHLLOG",92,0)
 ;
"RTN","RGHLLOG",93,0)
 Q:'RGI!'RGZ
"RTN","RGHLLOG",94,0)
 ;quit and don't send messages for exception types that are now being
"RTN","RGHLLOG",95,0)
 ;handled through the MPI/PD Exception Handling option.
"RTN","RGHLLOG",96,0)
 Q:RGEXC=209!((RGEXC>212)&(RGEXC<219))
"RTN","RGHLLOG",97,0)
 S DIC="^XMB(3.8,",DIC(0)="NZ",X="`"_RGZ D ^DIC K DIC Q:+Y<1  S RGZ=$P(Y,U,2) K Y
"RTN","RGHLLOG",98,0)
 Q:RGZ=""!$P($G(^RGSITE("COR",1,0)),U,7)
"RTN","RGHLLOG",99,0)
 S RGERR=$$SHORT(RGEXC,RGERR),RGZ="G."_RGZ
"RTN","RGHLLOG",100,0)
 I RGI=2 D ALERT^RGRSUTL2(RGERR,RGZ) Q
"RTN","RGHLLOG",101,0)
 D MAIL^RGRSUTL2(RGERR,RGZ,"MPI/PD Exception: "_$$SHORT(RGEXC),"MPI/PD exception notification")
"RTN","RGHLLOG",102,0)
 Q
"RTN","RGHLLOG",103,0)
 ;
"RTN","RGHLLOG",104,0)
INVEXC(RGMID) ; determine if this exception needs to be sent to MPI/PD
"RTN","RGHLLOG",105,0)
 ; personnel via FORUM. Return 1 to avoid messaging to FORUM, else 0.
"RTN","RGHLLOG",106,0)
 ; IA#:3244 is applied in this functionality
"RTN","RGHLLOG",107,0)
 N RGFLG,RGIEN S RGFLG=1
"RTN","RGHLLOG",108,0)
 S RGIEN=$$IEN773(RGMID) Q:'RGIEN RGFLG
"RTN","RGHLLOG",109,0)
 S RGIEN("SND")=$$GET1^DIQ(773,RGIEN_",",13)
"RTN","RGHLLOG",110,0)
 S RGIEN("REC")=$$GET1^DIQ(773,RGIEN_",",14)
"RTN","RGHLLOG",111,0)
 ; check the sending application (fld:13, 0;11) & the receiving
"RTN","RGHLLOG",112,0)
 ; application (fld:14, 0;12) to see if they are related to the MPI/PD
"RTN","RGHLLOG",113,0)
 ; project.
"RTN","RGHLLOG",114,0)
 I RGIEN("SND")]""!(RGIEN("REC")]"") D  Q RGFLG
"RTN","RGHLLOG",115,0)
 .S RGFLG=$$APP(RGIEN("SND")) Q:'RGFLG
"RTN","RGHLLOG",116,0)
 .S RGFLG=$$APP(RGIEN("REC"))
"RTN","RGHLLOG",117,0)
 .Q
"RTN","RGHLLOG",118,0)
 ; Only if the sending/receiving applications cannot be determined from
"RTN","RGHLLOG",119,0)
 ; the data in their respective fields, do I check the MSH multiple for
"RTN","RGHLLOG",120,0)
 ; the MSH segment. I identify the sending/receiving application from
"RTN","RGHLLOG",121,0)
 ; this segment. 
"RTN","RGHLLOG",122,0)
 E  D
"RTN","RGHLLOG",123,0)
 .N RG,RG1,RGMSH,RGFS
"RTN","RGHLLOG",124,0)
 .D GETS^DIQ(773,RGIEN_",",200,,"RGMSH") ;check MSH mult for snd/rec app
"RTN","RGHLLOG",125,0)
 .Q:'($D(RGMSH)\10)  ; no data in "MSH" multiple for file 773
"RTN","RGHLLOG",126,0)
 .S RGIEN=RGIEN_",",RG="RGMSH(773,"""_RGIEN_""","_200_")"
"RTN","RGHLLOG",127,0)
 .S RG1=0 F  S RG1=$O(@RG@(RG1)) Q:RG1'>0  D  Q:$E($G(@RG@(RG1)),1,3)="MSH"
"RTN","RGHLLOG",128,0)
 ..I $E($G(@RG@(RG1)),1,3)="MSH" D
"RTN","RGHLLOG",129,0)
 ...S RG(0)=$G(@RG@(RG1)),RGFS=$E(RG(0),4)
"RTN","RGHLLOG",130,0)
 ...S:$P(RG(0),RGFS,3)]"" RGFLG=$$APP($P(RG(0),RGFS,3)) Q:'RGFLG
"RTN","RGHLLOG",131,0)
 ...S:$P(RG(0),RGFS,5)]"" RGFLG=$$APP($P(RG(0),RGFS,5))
"RTN","RGHLLOG",132,0)
 ...Q
"RTN","RGHLLOG",133,0)
 ..Q
"RTN","RGHLLOG",134,0)
 .Q
"RTN","RGHLLOG",135,0)
 Q RGFLG
"RTN","RGHLLOG",136,0)
APP(X) ; check if the sending/receiving application is relevant to the
"RTN","RGHLLOG",137,0)
 ; MPI/PD team.  Returns 1 if a non-relevant namespace, else 0
"RTN","RGHLLOG",138,0)
 I $E(X,1,2)="RG"!($E(X,1,2)="VA")!($E(X,1,3)="MPI") Q 0
"RTN","RGHLLOG",139,0)
 Q 1
"RTN","RGHLLOG",140,0)
 ;
"RTN","RGHLLOG",141,0)
IEN773(RGMID) ; find the ien of the record in the HL7 MESSAGE ADMINISTRATION
"RTN","RGHLLOG",142,0)
 ; (#773) file based on the Message ID.  Input: Message ID
"RTN","RGHLLOG",143,0)
 ; Output: null, no record in 773, else 773 record ien.  IA#: 3244
"RTN","RGHLLOG",144,0)
 Q:$G(RGMID)="" ""
"RTN","RGHLLOG",145,0)
 Q $O(^HLMA("C",RGMID,0))
"RTN","RGHLLOG",146,0)
 ;
"RTN","RGHLLOG",147,0)
SHORT(RGEXC,RGTXT) ;
"RTN","RGHLLOG",148,0)
 ; Retrieve short text description of exception
"RTN","RGHLLOG",149,0)
 Q $G(^RGHL7(991.11,+RGEXC,10))_$S($G(RGTXT)="":"",1:": "_RGTXT)
"RTN","RGHLLOG",150,0)
 ;
"RTN","RGJCREC")
0^6^B37879913
"RTN","RGJCREC",1,0)
RGJCREC ;SF/JC,LTL-MPI/PD SUBSCRIPTION PROCESSOR ;05/12/98
"RTN","RGJCREC",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,8,19**;30 Apr 99
"RTN","RGJCREC",3,0)
 ;
"RTN","RGJCREC",4,0)
 ;Reference to $$UPDATE^MPIFAPI supported by IA #2706
"RTN","RGJCREC",5,0)
 ;Reference to $$SEND2^VAFCUTL1 supported by IA #2779
"RTN","RGJCREC",6,0)
 ;Reference to ^DPT( supported by IA #2969
"RTN","RGJCREC",7,0)
 ;
"RTN","RGJCREC",8,0)
REC ;Receive inbound MPI/PD Subscription request
"RTN","RGJCREC",9,0)
 ;Read in message for file 774 Master File Update
"RTN","RGJCREC",10,0)
 ;
"RTN","RGJCREC",11,0)
 Q:($G(HL("MTN"))'="MFN")!($G(HL("ETN"))'="Z15")  ;only process MPI/PD MFN/Z15 messages
"RTN","RGJCREC",12,0)
 K RGS,RGSEG,RGFS,RGCS,RGEC,RGSS,RGFILE,RGACT,RGCD,RGID,RGICN,RGSSN,RGPN,RGLL,RGTP,RGAD,RGTD,RGRAP,RGCMOR,RGDFN,RGPPFI,RGSCN,RGCURI,RGFROM,RGTO,RGSTUB,RGAD1,RGL,RGRC,HLER
"RTN","RGJCREC",13,0)
 N RGLOG,RGMTXT,X D START^RGHLLOG(HLMTIEN,"SCN_REQ","")
"RTN","RGJCREC",14,0)
 ;
"RTN","RGJCREC",15,0)
 S RGS="",U="^" N J
"RTN","RGJCREC",16,0)
 S RGFS=HL("FS") ;Field
"RTN","RGJCREC",17,0)
 S RGCS=$E(HL("ECH"),1) ;Component
"RTN","RGJCREC",18,0)
 S RGRC=$E(HL("ECH"),2) ;Repetition
"RTN","RGJCREC",19,0)
 S RGEC=$E(HL("ECH"),3) ;Escape
"RTN","RGJCREC",20,0)
 S RGSS=$E(HL("ECH"),4) ;Sub-component separator
"RTN","RGJCREC",21,0)
 F RGI=1:1 X HLNEXT Q:HLQUIT'>0  S (RGSEG,RGS(RGI))=HLNODE D
"RTN","RGJCREC",22,0)
 .S J=0 F  S J=$O(HLNODE(J)) Q:'J  S RGS(RGI,J)=HLNODE(J)
"RTN","RGJCREC",23,0)
 .D PARS
"RTN","RGJCREC",24,0)
 ;K RGLL ;TS 3-27-98
"RTN","RGJCREC",25,0)
 ;D PARS add this to hl7 processing logic above
"RTN","RGJCREC",26,0)
 I $D(RGFILE) Q:RGFILE'=774
"RTN","RGJCREC",27,0)
 ;Pt DFN
"RTN","RGJCREC",28,0)
 S RGDFN=$$GETDFN^MPIF001(+RGICN)
"RTN","RGJCREC",29,0)
 I +$$SEND2^VAFCUTL1(RGDFN,"T") D CLEAN Q  ;don't process test patients
"RTN","RGJCREC",30,0)
 ;Validate DFN/ICN/SSN on receiving system
"RTN","RGJCREC",31,0)
 I RGDFN'>0 D  D CLEAN Q
"RTN","RGJCREC",32,0)
 . S RGMTXT=""
"RTN","RGJCREC",33,0)
 . D EXC^RGHLLOG(210,"Msg#"_$G(HL("MID"))_" Bad DFN, "_$G(RGDFN)_", for "_$G(RGPN)_" (ICN#"_$G(RGICN)_")"_RGMTXT,RGDFN) D STOP^RGHLLOG(1) Q
"RTN","RGJCREC",34,0)
 I $P(^DPT(RGDFN,0),U,9)'=RGSSN D  D CLEAN Q
"RTN","RGJCREC",35,0)
 . S RGMTXT=" See the Exception Handling document on the MPI/PD web site."
"RTN","RGJCREC",36,0)
 . D EXC^RGHLLOG(213,"Msg#"_$G(HL("MID"))_" Mismatched SSN,"_$P(^DPT(RGDFN,0),U,9)_"/"_$G(RGSSN)_" for "_$G(RGPN)_" (ICN#"_$G(RGICN)_")"_RGMTXT,RGDFN) D STOP^RGHLLOG(1) Q
"RTN","RGJCREC",37,0)
 ;Pt CMOR/Subscription Control Number
"RTN","RGJCREC",38,0)
 S RGPPFI=$$GETVCCI^MPIF001(RGDFN)
"RTN","RGJCREC",39,0)
 I +RGPPFI<1 D  D CLEAN Q
"RTN","RGJCREC",40,0)
 . S RGMTXT=""
"RTN","RGJCREC",41,0)
 . D EXC^RGHLLOG(211,"Msg#"_$G(HL("MID"))_" Bad CMOR "_$G(RGPPFI)_" for DFN#"_$G(RGDFN)_RGMTXT,RGDFN) D STOP^RGHLLOG(1) Q
"RTN","RGJCREC",42,0)
 ;Verify that sender and receiver agree on CMOR
"RTN","RGJCREC",43,0)
 I RGCMOR'=RGPPFI D  D CLEAN Q
"RTN","RGJCREC",44,0)
 . S RGMTXT=""
"RTN","RGJCREC",45,0)
 . D EXC^RGHLLOG(211,"Msg#"_$G(HL("MID"))_" Mismatched CMOR, "_$G(RGCMOR)_"/"_$G(RGPPFI)_" for "_$G(RGPN)_" (ICN#"_$G(RGICN)_")"_RGMTXT,RGDFN) D STOP^RGHLLOG(1) Q
"RTN","RGJCREC",46,0)
 S RGSCN=$$GETSCN(RGDFN)
"RTN","RGJCREC",47,0)
 I RGSCN="" D  D CLEAN Q
"RTN","RGJCREC",48,0)
 . S RGMTXT=""
"RTN","RGJCREC",49,0)
 . D EXC^RGHLLOG(228,"Msg#"_$G(HL("MPI"))_" "_$G(RGPN)_" Does not exist in patient database. "_RGMTXT,RGDFN) D STOP^RGHLLOG(1) Q
"RTN","RGJCREC",50,0)
 ;Current Site ien
"RTN","RGJCREC",51,0)
 S RGCURI=+$$SITE^VASITE()
"RTN","RGJCREC",52,0)
 ;If not CMOR, don't update anyone else
"RTN","RGJCREC",53,0)
 I $$IFVCCI^MPIF001(RGDFN)'=1 D FIL K RGLL Q  ;TS 3-27-98
"RTN","RGJCREC",54,0)
 ;If filing data at owner site, que update to CLINICAL SUBSCRIBERS
"RTN","RGJCREC",55,0)
 D REC1
"RTN","RGJCREC",56,0)
 ;Add new clinical subscriber to local registry
"RTN","RGJCREC",57,0)
 D FIL
"RTN","RGJCREC",58,0)
 D REC2
"RTN","RGJCREC",59,0)
CLEAN K RGSTUB,RGLL ;TS 3-27-98
"RTN","RGJCREC",60,0)
 D STOP^RGHLLOG(0)
"RTN","RGJCREC",61,0)
 K RGS,RGSEG,RGFS,RGCS,RGEC,RGSS,RGFILE,RGACT,RGCD,RGID,RGICN,RGSSN,RGPN,RGLL,RGTP,RGAD,RGTD,RGRAP,RGCMOR,RGDFN,RGPPFI,RGSCN,RGCURI,RGFROM,RGTO,RGSTUB,RGAD1,RGL,RGRC,RGI
"RTN","RGJCREC",62,0)
 Q
"RTN","RGJCREC",63,0)
REC1 ;Update clinical subscribers with newest one
"RTN","RGJCREC",64,0)
 D GET^RGRSDYN1(RGDFN,RGSCN,0,"",.RGLL)
"RTN","RGJCREC",65,0)
 N I S I=0 F  S I=$O(RGLL("LINKS",I)) Q:I<1  D
"RTN","RGJCREC",66,0)
 .S RGFROM=RGLL ;New Subscriber
"RTN","RGJCREC",67,0)
 .I $E(RGFROM,1,2)'="VA" D START^RGHLLOG(HLMTIEN,"SCN_REQ","") D EXC^RGHLLOG(224,"MSG#"_$G(HL("MID"))_" Unable to send Subscription Request from "_RGFROM_".  This is not a MPI/PD site.",RGDFN) D CLEAN Q
"RTN","RGJCREC",68,0)
 .S RGTO=$P(RGLL("LINKS",I),U,2) ;Destination (Clinical Subscriber)
"RTN","RGJCREC",69,0)
 .I $E(RGTO,1,2)'="VA" D START^RGHLLOG(HLMTIEN,"SCN_REQ","") D EXC^RGHLLOG(224,"MSG#"_$G(HL("MID"))_" Unable to send Subscription Request to "_RGTO_".  This is not a MPI/PD site.",RGDFN) D CLEAN Q
"RTN","RGJCREC",70,0)
 .S RGSTUB=RGFROM_U_RGTO_U_RGICN_U_RGPN_U_RGTP_U_RGAD_U_$G(RGTD)
"RTN","RGJCREC",71,0)
 .D:RGFROM'=RGTO EN^RGEQ("SCN_REQ",RGSTUB) ;put on Event Queue
"RTN","RGJCREC",72,0)
 Q
"RTN","RGJCREC",73,0)
REC2 ;Update newest subscriber with previous subscribers and CMOR
"RTN","RGJCREC",74,0)
 ;change 4/10/98 CMC to get links
"RTN","RGJCREC",75,0)
 K RGLL("LINKS")
"RTN","RGJCREC",76,0)
 D GET^RGRSDYN1(RGDFN,RGSCN,0,"",.RGLL)
"RTN","RGJCREC",77,0)
 S I=0 F  S I=$O(RGLL("LINKS",I)) Q:I<1  D
"RTN","RGJCREC",78,0)
 .S RGTO=RGLL
"RTN","RGJCREC",79,0)
 .I $E(RGTO,1,2)'="VA" D START^RGHLLOG(HLMTIEN,"SCN_REQ","") D EXC^RGHLLOG(224,"MSG#"_$G(HL("MID"))_" Unable to send Subscription Request to "_RGTO_".  This is not a MPI/PD site.",RGDFN) D CLEAN Q
"RTN","RGJCREC",80,0)
 .S RGFROM=$P(RGLL("LINKS",I),U,2)
"RTN","RGJCREC",81,0)
 .I $E(RGFROM,1,2)'="VA" D START^RGHLLOG(HLMTIEN,"SCN_REQ","") D EXC^RGHLLOG(224,"MSG#"_$G(HL("MID"))_" Unable to send Subscription Request from "_RGFROM_".  This is not a MPI/PD site.",RGDFN) D CLEAN Q
"RTN","RGJCREC",82,0)
 .S RGSTUB=RGFROM_U_RGTO_U_RGICN_U_RGPN_U_RGTP_U_RGAD_U_$G(RGTD)
"RTN","RGJCREC",83,0)
 .I RGTO'=RGFROM D EN^RGEQ("SCN_REQ",RGSTUB)
"RTN","RGJCREC",84,0)
 ;Now send current institution (CMOR)
"RTN","RGJCREC",85,0)
 K RGL
"RTN","RGJCREC",86,0)
 D LINK^HLUTIL3(RGCURI,.RGL) S RGL=$O(RGL(0)) Q:RGL<1
"RTN","RGJCREC",87,0)
 ;changed cmc 5/9/98
"RTN","RGJCREC",88,0)
 S RGSTUB=RGL(RGL)_U_RGLL_U_RGICN_U_RGPN_U_RGTP_U_RGAD_U_$G(RGTD)
"RTN","RGJCREC",89,0)
 D:RGL(RGL)'=RGLL EN^RGEQ("SCN_REQ",RGSTUB)
"RTN","RGJCREC",90,0)
 K RGSTUB
"RTN","RGJCREC",91,0)
 Q
"RTN","RGJCREC",92,0)
PARS ;Parse it
"RTN","RGJCREC",93,0)
 I $E(RGSEG,1,3)="MFI" D
"RTN","RGJCREC",94,0)
 .S RGFILE=+$P(RGSEG,RGFS,2) ;File number
"RTN","RGJCREC",95,0)
 I $E(RGSEG,1,3)="MFE" D
"RTN","RGJCREC",96,0)
 .S RGACT=$P(RGSEG,RGFS,2) ;Action
"RTN","RGJCREC",97,0)
 .S RGCD=$P(RGSEG,RGFS,4) ;creation date
"RTN","RGJCREC",98,0)
 .S RGID=$P(RGSEG,RGFS,5) D  ;Primary Key
"RTN","RGJCREC",99,0)
 ..S RGICN=+RGID,RGSSN=$P(RGID,RGSS,2),RGPN=$P(RGID,RGCS,2) ;ICN,Patient Name
"RTN","RGJCREC",100,0)
 I $E(RGSEG,1,3)="ZSD" D
"RTN","RGJCREC",101,0)
 .S RGLL=$P(RGSEG,RGFS,2) ;Link
"RTN","RGJCREC",102,0)
 .S RGTP=$P(RGSEG,RGFS,3) ;Type
"RTN","RGJCREC",103,0)
 .S RGAD=$P(RGSEG,RGFS,4) ;Activation Date
"RTN","RGJCREC",104,0)
 .S RGTD=$P(RGSEG,RGFS,5) ;Termination Date
"RTN","RGJCREC",105,0)
 .S RGRAP=$P(RGSEG,RGFS,6) ;Receiving Application
"RTN","RGJCREC",106,0)
 .S RGCMOR=$P(RGSEG,RGFS,7) ;Coordinating Master of Record
"RTN","RGJCREC",107,0)
 Q
"RTN","RGJCREC",108,0)
GETSCN(RGDPT) ;Return existing SCN or Activate a new subscription for this patient
"RTN","RGJCREC",109,0)
 ;RGDPT=PATIENT DFN
"RTN","RGJCREC",110,0)
 N RGAR,RGAN
"RTN","RGJCREC",111,0)
 ;get subscription control #
"RTN","RGJCREC",112,0)
 S RGSCN=+$P($$MPINODE^MPIFAPI(RGDPT),"^",5)
"RTN","RGJCREC",113,0)
 ;if no SCN, create new and update 991.05, then return result
"RTN","RGJCREC",114,0)
 I 'RGSCN S RGSCN=$$ACT^HLSUB S RGAR(991.05)=RGSCN S RGAN=$$UPDATE^MPIFAPI(RGDPT,"RGAR") I RGAN=-1 S RGSCN=""
"RTN","RGJCREC",115,0)
 Q RGSCN
"RTN","RGJCREC",116,0)
FIL ;File message
"RTN","RGJCREC",117,0)
 ;Normalize dates
"RTN","RGJCREC",118,0)
 N RGCHK,RGTD1
"RTN","RGJCREC",119,0)
 S RGAD1=$$DTHF^RGHLUT(RGAD)
"RTN","RGJCREC",120,0)
 I $G(RGTD)]"" S RGTD1=$$DTHF^RGHLUT(RGTD)
"RTN","RGJCREC",121,0)
 ;check to see if this subscriber is yourself
"RTN","RGJCREC",122,0)
 D LINK^HLUTIL3(+$$SITE^VASITE,.RGCHK) Q:$O(RGCHK(0))=""  S RGCHK=RGCHK($O(RGCHK(0)))
"RTN","RGJCREC",123,0)
 I $G(RGCHK)'=RGLL D UPD^HLSUB(RGSCN,RGLL,RGTP,RGAD1,$G(RGTD1),$G(RGRAP),.HLER)
"RTN","RGJCREC",124,0)
 Q
"RTN","RGJCREC",125,0)
GETINST(LINK) ;returns institution ien from logical link
"RTN","RGJCREC",126,0)
 N DIC,X,Y
"RTN","RGJCREC",127,0)
 I $G(LINK)="" Q 0
"RTN","RGJCREC",128,0)
 S DIC=870,DIC(0)="EMQZ",X=LINK D ^DIC
"RTN","RGJCREC",129,0)
 I Y=-1 Q Y
"RTN","RGJCREC",130,0)
 Q $P(Y(0),"^",2)
"RTN","RGJCSUB")
0^4^B21123290
"RTN","RGJCSUB",1,0)
RGJCSUB ;SF/JC-MPI/PD SUBSCRIPTION GENERATOR ;04/30/97
"RTN","RGJCSUB",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,19**;30 Apr 99
"RTN","RGJCSUB",3,0)
EQ(RGEV,RGSTUB,RGERR,RGEP) ;Entry point for Event Queue Processor
"RTN","RGJCSUB",4,0)
 S FLL=$P(RGSTUB,U),TLL=$P(RGSTUB,U,2),ICN=$P(RGSTUB,U,3)
"RTN","RGJCSUB",5,0)
 S PN=$P(RGSTUB,U,4),TP=$P(RGSTUB,U,5),AD=$P(RGSTUB,U,6)
"RTN","RGJCSUB",6,0)
 S TD=$P(RGSTUB,U,7)
"RTN","RGJCSUB",7,0)
 I FLL=""!(TLL="")!(ICN="")!(PN="")!(TP="") S RGERR="REQUIRED PARAMETERS MISSING IN STUB"
"RTN","RGJCSUB",8,0)
 I AD="" S AD=$$NOW^XLFDT,AD=$$DTFH^RGHLUT(AD,1) ;activation date
"RTN","RGJCSUB",9,0)
 D BM(FLL,TLL,ICN,PN,TP,AD,TD)
"RTN","RGJCSUB",10,0)
 Q
"RTN","RGJCSUB",11,0)
BM(FLL,TLL,ICN,PN,TP,AD,TD) ;Build Subscription Request Message
"RTN","RGJCSUB",12,0)
 ;FLL-'FROM' LOGICAL LINK NAME
"RTN","RGJCSUB",13,0)
 ;TLL-'TO' LOGICAL LINK NAME
"RTN","RGJCSUB",14,0)
 ;ICN-PATIENT ID
"RTN","RGJCSUB",15,0)
 ;PN-PATIENT NAME
"RTN","RGJCSUB",16,0)
 ;TP-SUBSCRIPTION TYPE
"RTN","RGJCSUB",17,0)
 ;AD-ACTIVATION DATE HL7 FORMAT
"RTN","RGJCSUB",18,0)
 ;TD-TERMINATION DATE HL7 FORMAT-OPTIONAL
"RTN","RGJCSUB",19,0)
 N RGCMOR,RGDFN,RGSSN
"RTN","RGJCSUB",20,0)
 Q:'+ICN
"RTN","RGJCSUB",21,0)
 S RGDFN=$$GETDFN^MPIF001(+ICN) Q:+RGDFN<1
"RTN","RGJCSUB",22,0)
 S RGSSN=$P(^DPT(RGDFN,0),U,9)
"RTN","RGJCSUB",23,0)
 ;Get institution number of CMOR
"RTN","RGJCSUB",24,0)
 S RGCMOR=$$GETVCCI^MPIF001(RGDFN)
"RTN","RGJCSUB",25,0)
 N RGCS,RGRC,RGEC,RGSS,HL
"RTN","RGJCSUB",26,0)
 D INIT^HLFNC2("RG PT SUBSCRIPTION REQUEST",.HL) Q:+$G(HL)
"RTN","RGJCSUB",27,0)
 S HLL("LINKS",1)="RG PT SUBSCRIPTION RECEIVER^"_TLL
"RTN","RGJCSUB",28,0)
 S RGCS=$E(HL("ECH"),1) ;Component
"RTN","RGJCSUB",29,0)
 S RGRC=$E(HL("ECH"),2) ;Repitition
"RTN","RGJCSUB",30,0)
 S RGEC=$E(HL("ECH"),3) ;Escape
"RTN","RGJCSUB",31,0)
 S RGSS=$E(HL("ECH"),4) ;Sub-component separator
"RTN","RGJCSUB",32,0)
MFI ;MFI-master file identifier segment
"RTN","RGJCSUB",33,0)
 N X,HLA S X=""
"RTN","RGJCSUB",34,0)
 S $P(X,HL("FS"))="MFI"
"RTN","RGJCSUB",35,0)
 S $P(X,HL("FS"),2)="774"_RGCS_"SUBSCRIPTION REGISTRY"_RGCS_"L"
"RTN","RGJCSUB",36,0)
 S $P(X,HL("FS"),4)="UPD"
"RTN","RGJCSUB",37,0)
 S $P(X,HL("FS"),7)="NE"
"RTN","RGJCSUB",38,0)
 S HLA("HLS",1)=X
"RTN","RGJCSUB",39,0)
MFE ;MFE-master file entry segment
"RTN","RGJCSUB",40,0)
 S X=""
"RTN","RGJCSUB",41,0)
 S $P(X,HL("FS"))="MFE"
"RTN","RGJCSUB",42,0)
 S $P(X,HL("FS"),2)="MUP",$P(X,HL("FS"),4)=AD
"RTN","RGJCSUB",43,0)
 S $P(X,HL("FS"),5)=+ICN_RGSS_RGSSN_RGSS_2_RGCS_PN_RGCS_"L"
"RTN","RGJCSUB",44,0)
 S HLA("HLS",2)=X
"RTN","RGJCSUB",45,0)
DATA ;Record level data in 'ZSD' SEGMENT
"RTN","RGJCSUB",46,0)
 S HLA("HLS",3)="ZSD"_HL("FS")_FLL_HL("FS")_TP_HL("FS")_AD_HL("FS")_$G(TD)_HL("FS")_HL("FS")_RGCMOR
"RTN","RGJCSUB",47,0)
SEND ;SEND TO HL7 PACKAGE
"RTN","RGJCSUB",48,0)
 N HLRST
"RTN","RGJCSUB",49,0)
 D GENERATE^HLMA("RG PT SUBSCRIPTION REQUEST","LM",1,.HLRST,"",.HL)
"RTN","RGJCSUB",50,0)
 Q
"RTN","RGJCSUB",51,0)
ROUTE ;routing logic-parse A04 and put new message on event queue
"RTN","RGJCSUB",52,0)
 ;to primary facility
"RTN","RGJCSUB",53,0)
 ;If triggered by an A04
"RTN","RGJCSUB",54,0)
 ;I $G(HL("ETN"))'="A04" Q
"RTN","RGJCSUB",55,0)
 K RGLL D R1
"RTN","RGJCSUB",56,0)
 K RGVCCI,RGVCCIN,RGVCCIS
"RTN","RGJCSUB",57,0)
 Q
"RTN","RGJCSUB",58,0)
R1 ;A04
"RTN","RGJCSUB",59,0)
 N RGI,RGFS,RGLOC,RGLOCIEN,RGLOCNM,RGLOCSN,RGPN,RGSN,RGS,RGSCN,RGTP,RGTO
"RTN","RGJCSUB",60,0)
 S RGS="",RGFS=HL("FS")
"RTN","RGJCSUB",61,0)
 F RGI=1:1 X HLNEXT Q:HLQUIT'>0  Q:$P(HLNODE,HL("FS"))="PID"
"RTN","RGJCSUB",62,0)
 Q:HLQUIT'>0
"RTN","RGJCSUB",63,0)
 S RGICN=+$P(HLNODE,HL("FS"),3)
"RTN","RGJCSUB",64,0)
 Q:'RGICN
"RTN","RGJCSUB",65,0)
 S RGDFN=+$$GETDFN^MPIF001(RGICN)
"RTN","RGJCSUB",66,0)
 Q:RGDFN'>0
"RTN","RGJCSUB",67,0)
 S RGVCCI=$$GETVCCI^MPIF001(RGDFN)
"RTN","RGJCSUB",68,0)
 Q:RGVCCI<1
"RTN","RGJCSUB",69,0)
 ;fix TS need IEN for compare not sta. num.
"RTN","RGJCSUB",70,0)
 S RGVCCI=$$LKUP^XUAF4(RGVCCI)
"RTN","RGJCSUB",71,0)
 I RGVCCI="" D START^RGHLLOG(HLMTIEN),EXC^RGHLLOG(229,"MSG#"_$G(HLMID)_" Unable to send Subscription.  Duplicate station number of "_$$GETVCCI^MPIF001(RGDFN)_" in Institution file.",RGDFN) D STOP^RGHLLOG() Q
"RTN","RGJCSUB",72,0)
 S RGPN=$P(^DPT(RGDFN,0),U) Q:RGPN=""
"RTN","RGJCSUB",73,0)
 S RGTP=1 ;clinical update
"RTN","RGJCSUB",74,0)
 S RGAD=$$NOW^XLFDT,RGAD=$$DTFH^RGHLUT(RGAD,1) ;activation date
"RTN","RGJCSUB",75,0)
 ;Local Station information
"RTN","RGJCSUB",76,0)
 S RGLOC=$$SITE^VASITE(),RGLOCIEN=$P(RGLOC,U,1),RGLOCNM=$P(RGLOC,U,2),RGLOCSN=$P(RGLOC,U,3)
"RTN","RGJCSUB",77,0)
 I RGVCCI=RGLOCIEN D  ;current site is owner site, update existing subscribers
"RTN","RGJCSUB",78,0)
 .S RGSCN=$$GETSCN^RGJCREC(RGDFN) ;get SCN
"RTN","RGJCSUB",79,0)
 .D LINK^HLUTIL3(RGLOCIEN,.RGFROM) ;get local link definition
"RTN","RGJCSUB",80,0)
 .S RGLL=$O(RGFROM(0)) Q:RGLL=""  S RGLL=RGFROM(RGLL)
"RTN","RGJCSUB",81,0)
 .D REC1^RGJCREC
"RTN","RGJCSUB",82,0)
 I RGVCCI'=RGLOCIEN D  ;current site is not owner, update only owner
"RTN","RGJCSUB",83,0)
 .D LINK^HLUTIL3(RGLOCIEN,.RGFROM) ;Local Link
"RTN","RGJCSUB",84,0)
 .S RGFROM=$O(RGFROM(0)) Q:RGFROM=""  S RGFROM=RGFROM(RGFROM) ;sending facility
"RTN","RGJCSUB",85,0)
 .I $E(RGFROM,1,2)'="VA" D START^RGHLLOG(HLMTIEN),EXC^RGHLLOG(224,"MSG#"_$G(HLMID)_" Unable to send Subscription from "_RGFROM_".  This is not a MPI/PD Site.",RGDFN) D STOP^RGHLLOG() Q
"RTN","RGJCSUB",86,0)
 .D LINK^HLUTIL3(RGVCCI,.RGTO) ;get VCCI Link
"RTN","RGJCSUB",87,0)
 .S RGTO=$O(RGTO(0)) Q:RGTO=""
"RTN","RGJCSUB",88,0)
 .S RGTO=RGTO(RGTO) ;receiving facility
"RTN","RGJCSUB",89,0)
 .I $E(RGTO,1,2)'="VA" D START^RGHLLOG(HLMTIEN),EXC^RGHLLOG(224,"MSG#"_$G(HLMID)_" Unable to send Subscription to "_RGTO_".  This is not a MPI/PD Site.",RGDFN) D STOP^RGHLLOG() Q
"RTN","RGJCSUB",90,0)
 .Q:RGTO=RGFROM
"RTN","RGJCSUB",91,0)
 .S RGSTUB=RGFROM_U_RGTO_U_RGICN_U_RGPN_U_RGTP_U_RGAD
"RTN","RGJCSUB",92,0)
 .D EN^RGEQ("SCN_REQ",RGSTUB)
"RTN","RGJCTS01")
0^5^B5518077
"RTN","RGJCTS01",1,0)
RGJCTS01 ;SLC/TS-SUBSCRIPTION CONTROL STARTUP UTILITY TO CMOR ;09/18/97
"RTN","RGJCTS01",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3,19**;30 Apr 99
"RTN","RGJCTS01",3,0)
 ;IMPROVED FOR CMOR COMMUNICATION TS
"RTN","RGJCTS01",4,0)
INSERT(ZZHLDPT) ; pass dfn
"RTN","RGJCTS01",5,0)
 S ZZRGEV="SCN_REQ"
"RTN","RGJCTS01",6,0)
 K ZZFMLK,ZZTOLK
"RTN","RGJCTS01",7,0)
 ;setup for event stub
"RTN","RGJCTS01",8,0)
 S ZZHLINST=+$$KSP^XUPARAM("INST") ;who are we
"RTN","RGJCTS01",9,0)
 D LINK^HLUTIL3(ZZHLINST,.ZZFMLK) S ZZFMLK=$O(ZZFMLK(0)) Q:ZZFMLK<1
"RTN","RGJCTS01",10,0)
 S $P(ZZSTUB,U,1)=ZZFMLK(ZZFMLK)
"RTN","RGJCTS01",11,0)
 I $E($P(ZZSTUB,U,1),1,2)'="VA" D
"RTN","RGJCTS01",12,0)
 . D START^RGHLLOG($G(HLMTIEN),"SCN_REQ",""),EXC^RGHLLOG(224,"MSG#"_$G(HL("MID"))_" Unable to send Subscription Request from, "_$P($G(ZZSTUB),U,1)_".  This is not a MPI/PD site.",ZZHLDPT) D STOP^RGHLLOG(1) Q 
"RTN","RGJCTS01",13,0)
 S ZZTOST=$$GETVCCI^MPIF001(ZZHLDPT) ;who owns him
"RTN","RGJCTS01",14,0)
 ;fix TS change to IEN
"RTN","RGJCTS01",15,0)
 S ZZTOST=$$LKUP^XUAF4(ZZTOST)
"RTN","RGJCTS01",16,0)
 D LINK^HLUTIL3(ZZTOST,.ZZTOLK) S ZZTOLK=$O(ZZTOLK(0)) Q:ZZTOLK<1
"RTN","RGJCTS01",17,0)
 S $P(ZZSTUB,U,2)=ZZTOLK(ZZTOLK)
"RTN","RGJCTS01",18,0)
 I $E($P(ZZSTUB,U,2),1,2)'="VA" D
"RTN","RGJCTS01",19,0)
 . D START^RGHLLOG(HLMTIEN,"SCN_REQ",""),EXC^RGHLLOG(224,"MSG#"_$G(HL("MID"))_" Unable to send Subscription Request to, "_$P($G(ZZSTUB),U,2)_".  This is not a MPI/PD site.",ZZHLDPT) D STOP^RGHLLOG(1) Q
"RTN","RGJCTS01",20,0)
 S ZZRGICN=$$GETICN^MPIF001(ZZHLDPT)
"RTN","RGJCTS01",21,0)
 S $P(ZZSTUB,U,3)=ZZRGICN
"RTN","RGJCTS01",22,0)
 S DIC="^DPT(",DIC(0)="NZ",X=ZZHLDPT D ^DIC Q:Y'>0  S ZZPNM=$P(Y,U,2)
"RTN","RGJCTS01",23,0)
 S $P(ZZSTUB,U,4)=ZZPNM
"RTN","RGJCTS01",24,0)
 S $P(ZZSTUB,U,5)=0
"RTN","RGJCTS01",25,0)
 Q:ZZFMLK(ZZFMLK)=ZZTOLK(ZZTOLK)
"RTN","RGJCTS01",26,0)
 D EN^RGEQ(ZZRGEV,ZZSTUB)
"RTN","RGJCTS01",27,0)
 K ZZHLINST,ZZRGEV,ZZFMLK,ZZTOLK,ZZSTUB,ZZTOST,ZZRGICN,ZZPNM,X,Y,DIC
"RTN","RGJCTS01",28,0)
 Q
"RTN","RGJUSITE")
0^25^B277809
"RTN","RGJUSITE",1,0)
RGJUSITE ;ALB/JLU-CIRN SITE PARAMETER (#991.8) FILE API ;10/01/96
"RTN","RGJUSITE",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**7,19**;30 Apr 99
"RTN","RGJUSITE",3,0)
 ;
"RTN","RGJUSITE",4,0)
SEND() ;this function call is used to determine if the MPI/PD messages should
"RTN","RGJUSITE",5,0)
 ;be fired.  It will check the parameter 'stop mpi/pd messaging' in 991.8
"RTN","RGJUSITE",6,0)
 ;INPUTS - There are no inputs.
"RTN","RGJUSITE",7,0)
 ;OUTPUTS - This function will return a zero if the messages are
"RTN","RGJUSITE",8,0)
 ;          to be stopped.
"RTN","RGJUSITE",9,0)
 ;          A positive one will be returned if the messages are 
"RTN","RGJUSITE",10,0)
 ;          not to be stopped.
"RTN","RGJUSITE",11,0)
 ;          A two will be returned for suspend.
"RTN","RGJUSITE",12,0)
 ;
"RTN","RGJUSITE",13,0)
 N VAL,IEN,STOP ;**7
"RTN","RGJUSITE",14,0)
 S STOP=1
"RTN","RGJUSITE",15,0)
 S IEN=$O(^RGSITE(991.8,"B",1,0))
"RTN","RGJUSITE",16,0)
 G STOPQ:'IEN
"RTN","RGJUSITE",17,0)
 S VAL=$P($G(^RGSITE(991.8,IEN,1)),U,6)
"RTN","RGJUSITE",18,0)
 S STOP=$S('VAL:0,1:1,2:2)
"RTN","RGJUSITE",19,0)
 ;
"RTN","RGJUSITE",20,0)
STOPQ Q STOP
"RTN","RGJUSITE",21,0)
 ;
"RTN","RGMTAUD")
0^14^B20221164
"RTN","RGMTAUD",1,0)
RGMTAUD ;BIR/CML-MPI/PD AUDIT FILE PRINT FOR A SPECIFIED PATIENT ;01/06/99
"RTN","RGMTAUD",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,19**;30 Apr 99
"RTN","RGMTAUD",3,0)
 ;Reference to ^DIA(2 and data derived from the AUDIT file (#1.1)
"RTN","RGMTAUD",4,0)
 ;is supported by IA #2097 and #2602.
"RTN","RGMTAUD",5,0)
 ;Reference to ^ORD(101 supported by IA #2596
"RTN","RGMTAUD",6,0)
 S QFLG=1
"RTN","RGMTAUD",7,0)
BEGIN ;
"RTN","RGMTAUD",8,0)
 W !!,"This option prints information from the AUDIT file (#1.1) for a"
"RTN","RGMTAUD",9,0)
 W !,"selected patient and date range."
"RTN","RGMTAUD",10,0)
 W !!,"For the PATIENT file (#2) entry selected, the report prints the"
"RTN","RGMTAUD",11,0)
 W !,"patient name and DFN, date/time the field was edited, the user who"
"RTN","RGMTAUD",12,0)
 W !,"made the change, the field edited, the old value, and the new value."
"RTN","RGMTAUD",13,0)
 W !,"The option or protocol (if available) will also be displayed."
"RTN","RGMTAUD",14,0)
 ;
"RTN","RGMTAUD",15,0)
ASK1 ;Ask for PATIENT
"RTN","RGMTAUD",16,0)
 W !
"RTN","RGMTAUD",17,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: " D ^DIC K DIC G:Y<0 QUIT S RGDFN=+Y
"RTN","RGMTAUD",18,0)
 I '$O(^DIA(2,"B",RGDFN,0)) W !!,"This patient has no audit data available for any date." G ASK1
"RTN","RGMTAUD",19,0)
 ;
"RTN","RGMTAUD",20,0)
ASK2 ;Ask for Date Range
"RTN","RGMTAUD",21,0)
 I '$D(RGDFN)&($D(DFN)) S RGDFN=DFN
"RTN","RGMTAUD",22,0)
 W !!,"Enter date range for data to be included in report."
"RTN","RGMTAUD",23,0)
 K DIR,DIRUT,DTOUT,DUOUT S DIR(0)="DAO^:DT:EPX",DIR("A")="Beginning Date:  " D ^DIR K DIR G:$D(DIRUT) QUIT
"RTN","RGMTAUD",24,0)
 S RGBDT=Y,DIR(0)="DAO^"_RGBDT_":DT:EPX",DIR("A")="Ending Date:  " D ^DIR K DIR G:$D(DIRUT) QUIT S RGEDT=Y
"RTN","RGMTAUD",25,0)
 ;
"RTN","RGMTAUD",26,0)
DEV W !!,"The right margin for this report is 80.",!!
"RTN","RGMTAUD",27,0)
 S ZTSAVE("RGBDT")="",ZTSAVE("RGEDT")="",ZTSAVE("RGDFN")=""
"RTN","RGMTAUD",28,0)
 D EN^XUTMDEVQ("START^RGMTAUD","MPI/PD - Print AUDIT File Data for a Specific Patient",.ZTSAVE) I 'POP Q
"RTN","RGMTAUD",29,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","RGMTAUD",30,0)
 G QUIT
"RTN","RGMTAUD",31,0)
 ;
"RTN","RGMTAUD",32,0)
START ;
"RTN","RGMTAUD",33,0)
 K ^TMP("RGMTAUD",$J) S U="^"
"RTN","RGMTAUD",34,0)
 ;
"RTN","RGMTAUD",35,0)
LOOP ;Loop on "B" xref of the AUDIT file
"RTN","RGMTAUD",36,0)
 S STOP=RGEDT+1
"RTN","RGMTAUD",37,0)
 S IEN=0 F  S IEN=$O(^DIA(2,"B",RGDFN,IEN)) Q:'IEN  D
"RTN","RGMTAUD",38,0)
 .I $D(^DIA(2,IEN,0)) S EDITDT=$P(^(0),U,2) I EDITDT>RGBDT,EDITDT<STOP D
"RTN","RGMTAUD",39,0)
 ..S ^TMP("RGMTAUD",$J,EDITDT,IEN)=""
"RTN","RGMTAUD",40,0)
 ;
"RTN","RGMTAUD",41,0)
PRT ;Print report
"RTN","RGMTAUD",42,0)
 S (PG,QFLG)=0,U="^",$P(LN,"-",81)="",SITE=$P($$SITE^VASITE(),U,2)
"RTN","RGMTAUD",43,0)
 S PRGBDT=$$FMTE^XLFDT(RGBDT),PRGEDT=$$FMTE^XLFDT(RGEDT)
"RTN","RGMTAUD",44,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTAUD",45,0)
 D HDR
"RTN","RGMTAUD",46,0)
 I '$O(^TMP("RGMTAUD",$J,0)) W !!,"No audit data found in this date range for this patient." G QUIT
"RTN","RGMTAUD",47,0)
 S EDITDT=0 F  S EDITDT=$O(^TMP("RGMTAUD",$J,EDITDT)) Q:QFLG  Q:'EDITDT  D
"RTN","RGMTAUD",48,0)
 .S IEN=0 F  S IEN=$O(^TMP("RGMTAUD",$J,EDITDT,IEN)) Q:QFLG  Q:'IEN  D
"RTN","RGMTAUD",49,0)
 ..S PRTDT=$$FMTE^XLFDT($E(EDITDT,1,12))
"RTN","RGMTAUD",50,0)
 ..S IEN0=^DIA(2,IEN,0)
"RTN","RGMTAUD",51,0)
 ..K RGARR D FIELD^DID(2,$P(IEN0,U,3),"","LABEL","RGARR")
"RTN","RGMTAUD",52,0)
 ..S FLD=$G(RGARR("LABEL"))  Q:FLD=""
"RTN","RGMTAUD",53,0)
 ..S USER=$P(IEN0,U,4)
"RTN","RGMTAUD",54,0)
 ..I 'USER S USER="UNKNOWN"
"RTN","RGMTAUD",55,0)
 ..I USER'="UNKNOWN" S DIC="^VA(200,",DIC(0)="MZO",X="`"_USER D ^DIC S USER=$P(Y,"^",2)
"RTN","RGMTAUD",56,0)
 ..S OLD=$G(^DIA(2,IEN,2)) I OLD']"" S OLD="<no previous value>"
"RTN","RGMTAUD",57,0)
 ..S NEW=$G(^DIA(2,IEN,3)) I NEW']"" S NEW="<no current value>"
"RTN","RGMTAUD",58,0)
 ..K OPTDA1,OPTDA2,OPTION,OPTNM I $G(^DIA(2,IEN,4.1)) D
"RTN","RGMTAUD",59,0)
 ...S OPTDA1=+$P(^DIA(2,IEN,4.1),"^")
"RTN","RGMTAUD",60,0)
 ...I OPTDA1 S DIC=19,DR=".01",DA=OPTDA1,DIQ(0)="EI",DIQ="OPTION" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTION=$G(OPTION(19,OPTDA1,.01,"E"))
"RTN","RGMTAUD",61,0)
 ...S OPTDA2=$P(^DIA(2,IEN,4.1),"^",2)
"RTN","RGMTAUD",62,0)
 ...I $P(OPTDA2,";",2)="ORD(101," S DIC=101,DR=".01",DA=+OPTDA2,DIQ(0)="EI",DIQ="OPTION" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTNM=$G(OPTION(101,+OPTDA2,.01,"E")) Q
"RTN","RGMTAUD",63,0)
 ...I +OPTDA2 S DIC=19,DR=".01",DA=+OPTDA2,DIQ(0)="EI",DIQ="OPTION" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTNM=$G(OPTION(19,+OPTDA2,.01,"E")) Q
"RTN","RGMTAUD",64,0)
 ..D:$Y+4>IOSL HDR Q:QFLG  W !!,PRTDT,?20,FLD,?51,USER,!?20,OLD," / ",NEW
"RTN","RGMTAUD",65,0)
 ..I $G(OPTION)'="" W !?3,OPTION I $G(OPTNM)'="" W "/",$G(OPTNM)
"RTN","RGMTAUD",66,0)
 ;
"RTN","RGMTAUD",67,0)
QUIT ;
"RTN","RGMTAUD",68,0)
 I $E(IOST,1,2)="C-"&('QFLG) S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGMTAUD",69,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTAUD",70,0)
 K ^TMP("RGMTAUD",$J)
"RTN","RGMTAUD",71,0)
 K %,%I,DFN,C,RGDFN,EDITDT,FLD,HDT,IEN,IEN0,JJ,LN,NEW,OLD,OPTDA1,OPTDA2,OPTION,OPTNM,PG,PRGBDT,PRGEDT,PRTDT
"RTN","RGMTAUD",72,0)
 K QFLG,RGARR,RGBDT,RGEDT,SITE,SS,STOP,USER,X,Y,ZTSK
"RTN","RGMTAUD",73,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","RGMTAUD",74,0)
 ;
"RTN","RGMTAUD",75,0)
HDR ;HEADER
"RTN","RGMTAUD",76,0)
 I $E(IOST,1,2)="C-" S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTAUD",77,0)
 I $E(IOST,1,2)="C-",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","RGMTAUD",78,0)
 S PG=PG+1 W:$Y!($E(IOST,1,2)="C-") @IOF
"RTN","RGMTAUD",79,0)
 W !,"PATIENT AUDIT LIST at ",SITE," on ",HDT,?72,"Page: ",PG
"RTN","RGMTAUD",80,0)
 W !,"Patient: ",$P(^DPT(RGDFN,0),U)," (DFN #",RGDFN,")"
"RTN","RGMTAUD",81,0)
 W !,"Date Range: ",PRGBDT," to ",PRGEDT
"RTN","RGMTAUD",82,0)
 W !!,"Date/Time Edited",?20,"Field Edited",?51,"Edited By"
"RTN","RGMTAUD",83,0)
 W !?20,"Old Value / New Value",!?3,"Option/Protocol",!,LN
"RTN","RGMTAUD",84,0)
 Q
"RTN","RGMTAUDP")
0^15^B51146132
"RTN","RGMTAUDP",1,0)
RGMTAUDP ;BIR/CML,PTD-MPI/PD AUDIT File Print of Patient Data ;01/06/99
"RTN","RGMTAUDP",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**19**;30 Apr 99
"RTN","RGMTAUDP",3,0)
 ;Reference to ^DD(2 supported by IA #2695.
"RTN","RGMTAUDP",4,0)
 ;Reference to ^DIA(2 and data derived from the AUDIT file (#1.1)
"RTN","RGMTAUDP",5,0)
 ;supported by IA #2097 and #2602.
"RTN","RGMTAUDP",6,0)
 ;Reference to ^ORD(101 supported by IA #2596
"RTN","RGMTAUDP",7,0)
 ;
"RTN","RGMTAUDP",8,0)
BEGIN ;
"RTN","RGMTAUDP",9,0)
 S QFLG=1
"RTN","RGMTAUDP",10,0)
 W @IOF
"RTN","RGMTAUDP",11,0)
 W !,"This option prints a customized report of information stored in the AUDIT"
"RTN","RGMTAUDP",12,0)
 W !,"file (#1.1) for fields being audited in the PATIENT file (#2).  For a"
"RTN","RGMTAUDP",13,0)
 W !,"specified date range, you can view all audited fields or selected fields."
"RTN","RGMTAUDP",14,0)
 W !,"You can also opt to print only edits that were done by a specific user."
"RTN","RGMTAUDP",15,0)
 W !!,"- If selected fields are viewed, you can choose to see data for all or"
"RTN","RGMTAUDP",16,0)
 W !,"  selected patients."
"RTN","RGMTAUDP",17,0)
 W !,"- If ALL audited fields are viewed, you must choose patients to examine."
"RTN","RGMTAUDP",18,0)
 ;
"RTN","RGMTAUDP",19,0)
ASKFLD ;Ask for Data Fields
"RTN","RGMTAUDP",20,0)
 I '$O(^DD(2,"AUDIT",0)) W !!,"No fields are currently being audited in the PATIENT file (#2)." G QUIT
"RTN","RGMTAUDP",21,0)
 W !
"RTN","RGMTAUDP",22,0)
 K DIR S DIR(0)="SAM^A:ALL;S:SELECTED;"
"RTN","RGMTAUDP",23,0)
 S DIR("A")="Do you want to see (A)LL or (S)ELECTED audited fields? "
"RTN","RGMTAUDP",24,0)
 S DIR("B")="A"
"RTN","RGMTAUDP",25,0)
 S DIR("?",1)="Enter:"
"RTN","RGMTAUDP",26,0)
 S DIR("?",2)=" ""A"" to see ALL audited fields in the PATIENT file (#2)."
"RTN","RGMTAUDP",27,0)
 S DIR("?")=" ""S"" to select specific audited fields."
"RTN","RGMTAUDP",28,0)
 D ^DIR G:$D(DIRUT) QUIT S ANS1=Y
"RTN","RGMTAUDP",29,0)
 ;
"RTN","RGMTAUDP",30,0)
FLDLOOP ;
"RTN","RGMTAUDP",31,0)
 W ! K FLD
"RTN","RGMTAUDP",32,0)
 ;stuff all fields
"RTN","RGMTAUDP",33,0)
 I ANS1="A" D  G ASKPAT
"RTN","RGMTAUDP",34,0)
 .S FLD=0 F  S FLD=$O(^DD(2,"AUDIT",FLD)) Q:'FLD  S FLD(FLD)=""
"RTN","RGMTAUDP",35,0)
 ;ask for specific fields
"RTN","RGMTAUDP",36,0)
 K DIR S DIR(0)="NAOC^.0000001:9999999:7^K:'$D(^DD(2,""AUDIT"",X)) X S RGERR=1"
"RTN","RGMTAUDP",37,0)
 S DIR("A")="Select FIELD NUMBER of audited field (enter ""?"" for list): "
"RTN","RGMTAUDP",38,0)
 S DIR("?")="^D FLDLIST^RGMTAUDP"
"RTN","RGMTAUDP",39,0)
 F QQ=0:0 S RGERR=0 D ^DIR Q:$D(DIRUT)  S FLD(+Y)=""
"RTN","RGMTAUDP",40,0)
 ;
"RTN","RGMTAUDP",41,0)
ASKPAT ;Ask for Patient
"RTN","RGMTAUDP",42,0)
 I '$O(FLD(0))!($D(DUOUT)) S QFLG=1 G QUIT
"RTN","RGMTAUDP",43,0)
 I ANS1="A" S ANS2="S" G PATLOOP
"RTN","RGMTAUDP",44,0)
 K DIR S DIR(0)="SAM^A:ALL;S:SELECTED;"
"RTN","RGMTAUDP",45,0)
 S DIR("A")="Do you want to see audited data for (A)LL or (S)ELECTED patients? "
"RTN","RGMTAUDP",46,0)
 S DIR("B")="S"
"RTN","RGMTAUDP",47,0)
 S DIR("?",1)="Enter:"
"RTN","RGMTAUDP",48,0)
 S DIR("?",2)=" ""A"" to see audited fields for ALL patients."
"RTN","RGMTAUDP",49,0)
 S DIR("?")=" ""S"" to select specific patients(s)."
"RTN","RGMTAUDP",50,0)
 W ! D ^DIR G:$D(DIRUT) QUIT S ANS2=Y
"RTN","RGMTAUDP",51,0)
PATLOOP ;
"RTN","RGMTAUDP",52,0)
 W ! K PAT
"RTN","RGMTAUDP",53,0)
 I ANS2="A" S PAT("ALL")="" G ASKDT
"RTN","RGMTAUDP",54,0)
 ;ask for specific patient(s)
"RTN","RGMTAUDP",55,0)
 F QQ=0:0 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: " D ^DIC K DIC Q:Y<0  S RGDFN=+Y D
"RTN","RGMTAUDP",56,0)
 .I '$O(^DIA(2,"B",RGDFN,0)) W $C(7),!?5,"This patient has no audit data available for any date." Q
"RTN","RGMTAUDP",57,0)
 .S PAT(RGDFN)=""
"RTN","RGMTAUDP",58,0)
 ;
"RTN","RGMTAUDP",59,0)
ASKDT ;Ask for Date Range
"RTN","RGMTAUDP",60,0)
 I '$D(PAT)!($D(DUOUT)) S QFLG=1 G QUIT
"RTN","RGMTAUDP",61,0)
 W !!,"Enter date range for data to be included in report."
"RTN","RGMTAUDP",62,0)
 K DIR,DIRUT,DTOUT,DUOUT S DIR(0)="DAO^:DT:EPX",DIR("A")="Beginning Date:  " D ^DIR K DIR G:$D(DIRUT) QUIT
"RTN","RGMTAUDP",63,0)
 S RGBDT=Y,DIR(0)="DAO^"_RGBDT_":DT:EPX",DIR("A")="Ending Date:  " D ^DIR K DIR G:$D(DIRUT) QUIT S RGEDT=Y
"RTN","RGMTAUDP",64,0)
 ;
"RTN","RGMTAUDP",65,0)
ASKUSER ;Ask if data is wanted only a specific user
"RTN","RGMTAUDP",66,0)
 K USERSCRN
"RTN","RGMTAUDP",67,0)
 W ! S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you want to find only the edits made by a specific user"
"RTN","RGMTAUDP",68,0)
 D ^DIR K DIR I +Y'=1 G DEV
"RTN","RGMTAUDP",69,0)
 ;
"RTN","RGMTAUDP",70,0)
 S DIC="^VA(200,",DIC(0)="QEAM",DIC("A")="Select USER: "
"RTN","RGMTAUDP",71,0)
 D ^DIC K DIC G:+Y<0 QUIT S USERSCRN=+Y
"RTN","RGMTAUDP",72,0)
 ;
"RTN","RGMTAUDP",73,0)
DEV W !!,"The right margin for this report is 80.",!!
"RTN","RGMTAUDP",74,0)
 I ANS2="A" S IOP="Q" W "Because you selected ALL patients, you MUST queue this report.",!!
"RTN","RGMTAUDP",75,0)
 S ZTSAVE("RGBDT")="",ZTSAVE("RGEDT")="",ZTSAVE("ANS2")="",ZTSAVE("FLD(")="",ZTSAVE("PAT(")="",%ZIS("B")=""
"RTN","RGMTAUDP",76,0)
 D EN^XUTMDEVQ("START^RGMTAUDP","MPI/PD - Print AUDIT File Data from the PATIENT file",.ZTSAVE,.%ZIS) I 'POP Q
"RTN","RGMTAUDP",77,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","RGMTAUDP",78,0)
 S QFLG=1 G QUIT
"RTN","RGMTAUDP",79,0)
 ;
"RTN","RGMTAUDP",80,0)
START ;
"RTN","RGMTAUDP",81,0)
 K ^TMP("RGMTAUDP",$J) S U="^"
"RTN","RGMTAUDP",82,0)
 S STOP=RGEDT+1
"RTN","RGMTAUDP",83,0)
 I ANS2="A" D
"RTN","RGMTAUDP",84,0)
 .S CNT=0
"RTN","RGMTAUDP",85,0)
 .S RGDFN=0 F  S RGDFN=$O(^DIA(2,"B",RGDFN)) Q:'RGDFN  S CNT=CNT+1 S:'(CNT#10000) ^TMP("RGMTAUDP",$J,"@@@@","CUR DFN")=RGDFN D LOOP
"RTN","RGMTAUDP",86,0)
 I ANS2="S" D
"RTN","RGMTAUDP",87,0)
 .S RGDFN=0 F  S RGDFN=$O(PAT(RGDFN)) Q:'RGDFN  D LOOP
"RTN","RGMTAUDP",88,0)
 G PRT
"RTN","RGMTAUDP",89,0)
 ;
"RTN","RGMTAUDP",90,0)
LOOP ;Loop on "B" xref of the AUDIT file
"RTN","RGMTAUDP",91,0)
 Q:'$D(^DPT(RGDFN,0))
"RTN","RGMTAUDP",92,0)
 S IEN=0 F  S IEN=$O(^DIA(2,"B",RGDFN,IEN)) Q:'IEN  D
"RTN","RGMTAUDP",93,0)
 .I $D(^DIA(2,IEN,0)) S IEN0=(^(0)),EDITDT=$P(IEN0,U,2) I EDITDT>RGBDT,EDITDT<STOP D
"RTN","RGMTAUDP",94,0)
 ..S FLD=$P(IEN0,U,3) I $D(FLD(FLD)) D
"RTN","RGMTAUDP",95,0)
 ...S USER=$P(IEN0,U,4)
"RTN","RGMTAUDP",96,0)
 ...I $D(USERSCRN) I USER'=USERSCRN Q
"RTN","RGMTAUDP",97,0)
 ...S PATNM=$P(^DPT(RGDFN,0),U)_U_RGDFN,^TMP("RGMTAUDP",$J,PATNM,EDITDT,IEN)=""
"RTN","RGMTAUDP",98,0)
 Q
"RTN","RGMTAUDP",99,0)
 ;
"RTN","RGMTAUDP",100,0)
PRT ;Print report
"RTN","RGMTAUDP",101,0)
 S (PG,QFLG)=0,U="^",$P(LN,"-",81)="",SITE=$P($$SITE^VASITE(),U,2)
"RTN","RGMTAUDP",102,0)
 S PRGBDT=$$FMTE^XLFDT(RGBDT),PRGEDT=$$FMTE^XLFDT(RGEDT)
"RTN","RGMTAUDP",103,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTAUDP",104,0)
 D HDR
"RTN","RGMTAUDP",105,0)
 I '$D(^TMP("RGMTAUDP",$J)) W !!,"No audit data found in this date range for specified parameters." G QUIT
"RTN","RGMTAUDP",106,0)
 S PATNM="@@@@" F  S PATNM=$O(^TMP("RGMTAUDP",$J,PATNM)) Q:PATNM=""  Q:QFLG  D
"RTN","RGMTAUDP",107,0)
 .D:$Y+4>IOSL HDR Q:QFLG
"RTN","RGMTAUDP",108,0)
 .W !!,"==> ",$P(PATNM,U),"  (DFN #",$P(PATNM,U,2),")"
"RTN","RGMTAUDP",109,0)
 .S EDITDT=0 F  S EDITDT=$O(^TMP("RGMTAUDP",$J,PATNM,EDITDT)) Q:QFLG  Q:'EDITDT  D
"RTN","RGMTAUDP",110,0)
 ..S IEN=0 F  S IEN=$O(^TMP("RGMTAUDP",$J,PATNM,EDITDT,IEN)) Q:QFLG  Q:'IEN  D
"RTN","RGMTAUDP",111,0)
 ...S PRTDT=$$FMTE^XLFDT($E(EDITDT,1,12))
"RTN","RGMTAUDP",112,0)
 ...S IEN0=^DIA(2,IEN,0)
"RTN","RGMTAUDP",113,0)
 ...K RGARR D FIELD^DID(2,$P(IEN0,U,3),"","LABEL","RGARR")
"RTN","RGMTAUDP",114,0)
 ...S FLD=$G(RGARR("LABEL"))  Q:FLD=""
"RTN","RGMTAUDP",115,0)
 ...S USER=$P(IEN0,U,4)
"RTN","RGMTAUDP",116,0)
 ...I 'USER S USER="UNKNOWN"
"RTN","RGMTAUDP",117,0)
 ...I USER'="UNKNOWN" S DIC="^VA(200,",DIC(0)="MZO",X="`"_USER D ^DIC S USER=$P(Y,"^",2)
"RTN","RGMTAUDP",118,0)
 ...S OLD=$G(^DIA(2,IEN,2)) I OLD']"" S OLD="<no previous value>"
"RTN","RGMTAUDP",119,0)
 ...S NEW=$G(^DIA(2,IEN,3)) I NEW']"" S NEW="<no current value>"
"RTN","RGMTAUDP",120,0)
 ...K OPTDA1,OPTDA2,OPTION,OPTNM I $G(^DIA(2,IEN,4.1)) D
"RTN","RGMTAUDP",121,0)
 ....S OPTDA1=+$P(^DIA(2,IEN,4.1),"^")
"RTN","RGMTAUDP",122,0)
 ....I OPTDA1 S DIC=19,DR=".01",DA=OPTDA1,DIQ(0)="EI",DIQ="OPTION" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTION=$G(OPTION(19,OPTDA1,.01,"E"))
"RTN","RGMTAUDP",123,0)
 ....S OPTDA2=$P(^DIA(2,IEN,4.1),"^",2)
"RTN","RGMTAUDP",124,0)
 ....I $P(OPTDA2,";",2)="ORD(101," S DIC=101,DR=".01",DA=+OPTDA2,DIQ(0)="EI",DIQ="OPTION" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTNM=$G(OPTION(101,+OPTDA2,.01,"E")) Q
"RTN","RGMTAUDP",125,0)
 ....I +OPTDA2 S DIC=19,DR=".01",DA=+OPTDA2,DIQ(0)="EI",DIQ="OPTION" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTNM=$G(OPTION(19,+OPTDA2,.01,"E")) Q
"RTN","RGMTAUDP",126,0)
 ...D:$Y+5>IOSL HDR Q:QFLG  W !!,PRTDT,?20,FLD,?51,USER,!?20,OLD," / ",NEW
"RTN","RGMTAUDP",127,0)
 ...I $G(OPTION)'="" W !?3,OPTION I $G(OPTNM)'="" W "/",OPTNM
"RTN","RGMTAUDP",128,0)
 ;
"RTN","RGMTAUDP",129,0)
QUIT ;
"RTN","RGMTAUDP",130,0)
 I $E(IOST,1,2)="C-"&('QFLG) S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGMTAUDP",131,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTAUDP",132,0)
 K ^TMP("RGMTAUDP",$J)
"RTN","RGMTAUDP",133,0)
 K %,%I,ANS1,ANS2,C,CNT,RGDFN,DIR,DIRUT,DTOUT,DUOUT,EDITDT,FLD,FLDLP,FLDNM,HDR
"RTN","RGMTAUDP",134,0)
 K HDT,IEN,IEN0,JJ,LN,NEW,OLD,OPTDA1,OPTDA2,OPTION,OPTNM,PAT,PATNM,PG,PRGBDT,PRGEDT,PRTDT,QFLG,QQ,RGARR,RGBDT
"RTN","RGMTAUDP",135,0)
 K RGEDT,RGERR,SITE,SS,STOP,USER,X,Y,ZTSK
"RTN","RGMTAUDP",136,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","RGMTAUDP",137,0)
 ;
"RTN","RGMTAUDP",138,0)
HDR ;HEADER
"RTN","RGMTAUDP",139,0)
 I $E(IOST,1,2)="C-" S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTAUDP",140,0)
 I $E(IOST,1,2)="C-",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","RGMTAUDP",141,0)
 S PG=PG+1 W:$Y!($E(IOST,1,2)="C-") @IOF
"RTN","RGMTAUDP",142,0)
 W !,"PATIENT AUDIT LIST at ",SITE," on ",HDT,?72,"Page: ",PG
"RTN","RGMTAUDP",143,0)
 W !,"Date Range: ",PRGBDT," to ",PRGEDT
"RTN","RGMTAUDP",144,0)
 W !!,"Date/Time Edited",?20,"Field Edited",?51,"Edited By",!?20,"Old Value / New Value"
"RTN","RGMTAUDP",145,0)
 W !?3,"Option/Protocol",!,LN
"RTN","RGMTAUDP",146,0)
 Q
"RTN","RGMTAUDP",147,0)
 ;
"RTN","RGMTAUDP",148,0)
FLDLIST ;Help for Field # List
"RTN","RGMTAUDP",149,0)
 K RG N DIR S QFLG=0 I RGERR W $C(7)," ??"
"RTN","RGMTAUDP",150,0)
 S HDR="Select a FIELD NUMBER from the audited field(s) in the PATIENT file:"
"RTN","RGMTAUDP",151,0)
 W @IOF,HDR,!
"RTN","RGMTAUDP",152,0)
 S FLDLP=0 F  S FLDLP=$O(^DD(2,"AUDIT",FLDLP)) Q:'FLDLP  Q:QFLG  D
"RTN","RGMTAUDP",153,0)
 .I $Y+6>IOSL D  Q:QFLG
"RTN","RGMTAUDP",154,0)
 ..S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","RGMTAUDP",155,0)
 ..E  W @IOF,HDR,!
"RTN","RGMTAUDP",156,0)
 .K RGARR D FIELD^DID(2,FLDLP,"","LABEL","RGARR")
"RTN","RGMTAUDP",157,0)
 .S FLDNM=$G(RGARR("LABEL")) Q:FLDNM=""
"RTN","RGMTAUDP",158,0)
 .W !,FLDLP,?13,FLDNM
"RTN","RGMTAUDP",159,0)
 Q
"RTN","RGMTDPSC")
0^7^B22047403
"RTN","RGMTDPSC",1,0)
RGMTDPSC ;GAI/TMG-COUNT DUPLICATE RECORD ENTRIES BY CMOR SCORE RANGE ;5/30/98
"RTN","RGMTDPSC",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**19**;30 Apr 99
"RTN","RGMTDPSC",3,0)
 ;
"RTN","RGMTDPSC",4,0)
 ;Reference to ^VA(15 supported by IA #2532
"RTN","RGMTDPSC",5,0)
 ;Reference to ^DPT("ACMORS" and ^DPT(0 supported by IA #2070
"RTN","RGMTDPSC",6,0)
 ;
"RTN","RGMTDPSC",7,0)
 ;; search the Duplicate Record file (#15) for duplicate pairs and
"RTN","RGMTDPSC",8,0)
 ;; display by CMOR activity score range.  The ranges are in 100's with
"RTN","RGMTDPSC",9,0)
 ;; a separate range for pairs where both members have no score and where
"RTN","RGMTDPSC",10,0)
 ;; both members have zero score or one member has a zero score and the
"RTN","RGMTDPSC",11,0)
 ;; other has no score.
"RTN","RGMTDPSC",12,0)
 ;; 
"RTN","RGMTDPSC",13,0)
EN ; que or select device for output
"RTN","RGMTDPSC",14,0)
 I '$D(^DPT("ACMORS")) D  Q
"RTN","RGMTDPSC",15,0)
 . W !,"The option, Start/Restart CMOR Score Calculation"
"RTN","RGMTDPSC",16,0)
 . W !,"[RG CMOR START], needs to be run before this option."
"RTN","RGMTDPSC",17,0)
 S %ZIS="QM" D ^%ZIS Q:POP  S:IO'=IO(0) IO("Q")="" I '$D(IO("Q")) G SCAN
"RTN","RGMTDPSC",18,0)
 S ZTRTN="SCAN^RGMTDPSC"
"RTN","RGMTDPSC",19,0)
 S ZTIO=ION_";"_IOST_";"_IOM_";"_IOSL,ZTSAVE("IO*")=""
"RTN","RGMTDPSC",20,0)
 S ZTDESC="DUP. RECORD REPORT BY CMOR SCORE" D ^%ZTLOAD,EXIT,^%ZISC
"RTN","RGMTDPSC",21,0)
 Q
"RTN","RGMTDPSC",22,0)
 ;
"RTN","RGMTDPSC",23,0)
SCAN ; search and count duplicate pairs by score ranges
"RTN","RGMTDPSC",24,0)
 S U="^",MSG=0,MSGLINE=1,DPTCNT=0 K SCRARR
"RTN","RGMTDPSC",25,0)
 N NODE1,NODE2
"RTN","RGMTDPSC",26,0)
 S IEN=0 F  S IEN=$O(^VA(15,IEN)) Q:+IEN'>0  I $D(^VA(15,+IEN,0)) S NODE=^(0) D
"RTN","RGMTDPSC",27,0)
 . S (SCRANGE,SCORE,SCORE1,SCORE2)="NO SCORE"
"RTN","RGMTDPSC",28,0)
 . S DPT1=+$P(NODE,U),DPT2=+$P(NODE,U,2)
"RTN","RGMTDPSC",29,0)
 . S NODE1=$$MPINODE^MPIFAPI(+DPT1)
"RTN","RGMTDPSC",30,0)
 . I $P($G(NODE1),U,6)'="" S SCORE1=$P(NODE1,U,6)
"RTN","RGMTDPSC",31,0)
 . S NODE2=$$MPINODE^MPIFAPI(+DPT2)
"RTN","RGMTDPSC",32,0)
 . I $P($G(NODE2),U,6)'="" S SCORE2=$P(NODE2,U,6)
"RTN","RGMTDPSC",33,0)
 . I SCORE1=0&(SCORE2=0) S (SCRANGE,SCORE)="ZERO"
"RTN","RGMTDPSC",34,0)
 . I SCORE1?.N!(SCORE2?.N) D
"RTN","RGMTDPSC",35,0)
 . . Q:SCRANGE="ZERO"
"RTN","RGMTDPSC",36,0)
 . . S:+SCORE1>+SCORE SCORE=SCORE1 S:+SCORE2>+SCORE SCORE=SCORE2 S SCRANGE=SCORE\100 I SCRANGE>0 S SCRANGE=SCRANGE*100
"RTN","RGMTDPSC",37,0)
 . S:'$D(SCRARR("RANGE",SCRANGE)) SCRARR("RANGE",SCRANGE)=0
"RTN","RGMTDPSC",38,0)
 . S SCRARR("RANGE",SCRANGE)=SCRARR("RANGE",SCRANGE)+1
"RTN","RGMTDPSC",39,0)
 D PRINT
"RTN","RGMTDPSC",40,0)
 ;
"RTN","RGMTDPSC",41,0)
EXIT K COUNT,DPT1,DPT2,DPTCNT,IEN,MSG,MSGLINE,NODE,PAGE,POP,PRANGE,PRDT,SCORE
"RTN","RGMTDPSC",42,0)
 K SCORE1,SCORE2,SCRANGE,SCRARR,S,TXT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZZ,%DT,%ZIS,DTOUT,DUOUT,SITE,XMSUB,XMTEXT,XMY,XMDUZ
"RTN","RGMTDPSC",43,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGMTDPSC",44,0)
 Q
"RTN","RGMTDPSC",45,0)
 ;
"RTN","RGMTDPSC",46,0)
PRINT ; print duplicate pair counts by score range
"RTN","RGMTDPSC",47,0)
 S (PAGE,COUNT)=0 S X="N",%DT="T" D ^%DT S X=Y X ^DD("DD") S PRDT=Y
"RTN","RGMTDPSC",48,0)
 D HDR I MSG=0 D MSG
"RTN","RGMTDPSC",49,0)
 I $D(SCRARR("RANGE","ZERO")) D
"RTN","RGMTDPSC",50,0)
 . S PRANGE="0" W !?10,PRANGE,?40,$J(SCRARR("RANGE","ZERO"),6,0)
"RTN","RGMTDPSC",51,0)
 . S COUNT=COUNT+SCRARR("RANGE","ZERO")
"RTN","RGMTDPSC",52,0)
 S SCRANGE="" F  S SCRANGE=$O(SCRARR("RANGE",SCRANGE)) Q:SCRANGE=""  Q:SCRANGE="ZERO"  D
"RTN","RGMTDPSC",53,0)
 . I SCRANGE=0 S PRANGE="1 - 99"
"RTN","RGMTDPSC",54,0)
 . I SCRANGE'="NO SCORE" I SCRANGE>0 S PRANGE=SCRANGE_" - "_(SCRANGE+99)
"RTN","RGMTDPSC",55,0)
 . I SCRANGE="NO SCORE" S PRANGE=SCRANGE
"RTN","RGMTDPSC",56,0)
 . S MSGLINE=MSGLINE+.001
"RTN","RGMTDPSC",57,0)
 . S TXT(MSGLINE)=$J(" ",10)_PRANGE_$J(" ",23)_$J(SCRARR("RANGE",SCRANGE),6,0)
"RTN","RGMTDPSC",58,0)
 . D:$Y>(IOSL-6) HDR W !?10,PRANGE,?39,$J(SCRARR("RANGE",SCRANGE),6,0) S COUNT=COUNT+SCRARR("RANGE",SCRANGE)
"RTN","RGMTDPSC",59,0)
 S DPTCNT=$P(^DPT(0),U,4)
"RTN","RGMTDPSC",60,0)
 D:$Y>(IOSL-6) HDR W !!,"TOTAL Potential Duplicates (15): ",?39,$J(COUNT,6,0)
"RTN","RGMTDPSC",61,0)
 D:$Y>(IOSL-6) HDR W !,"TOTAL Patients (2): ",?39,$J(DPTCNT,6,0)
"RTN","RGMTDPSC",62,0)
 S MSGLINE=MSGLINE+.001 D
"RTN","RGMTDPSC",63,0)
 . S TXT(MSGLINE)="  ",MSGLINE=MSGLINE+.001
"RTN","RGMTDPSC",64,0)
 . S TXT(MSGLINE)="TOTAL Potential Duplicates (15)       "_COUNT
"RTN","RGMTDPSC",65,0)
 . S MSGLINE=MSGLINE+.001
"RTN","RGMTDPSC",66,0)
 . S TXT(MSGLINE)="TOTAL Patients (2)                    "_DPTCNT
"RTN","RGMTDPSC",67,0)
 D MSG1
"RTN","RGMTDPSC",68,0)
 Q
"RTN","RGMTDPSC",69,0)
 ;
"RTN","RGMTDPSC",70,0)
HDR I ($E(IOST,1,2)="C-")&(IO=IO(0)) D
"RTN","RGMTDPSC",71,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","RGMTDPSC",72,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","RGMTDPSC",73,0)
 S PAGE=PAGE+1 W #
"RTN","RGMTDPSC",74,0)
 W "Duplicate Record Count by CMOR Score",?(IOM-23),"Page: ",PAGE
"RTN","RGMTDPSC",75,0)
 W !?(IOM-23),"Date: ",PRDT,!
"RTN","RGMTDPSC",76,0)
 F ZZ=1:1:IOM W "-"
"RTN","RGMTDPSC",77,0)
 I PAGE=1 D
"RTN","RGMTDPSC",78,0)
 .W !,"This report is drawn from the Duplicate Record file (#15) with"
"RTN","RGMTDPSC",79,0)
 .W !,"CMOR scores from the PATIENT file, CMOR ACTIVITY SCORE field.",!
"RTN","RGMTDPSC",80,0)
 .W !,"- If both members of a pair have a score of zero the pair is"
"RTN","RGMTDPSC",81,0)
 .W !,"  counted in the '0' group."
"RTN","RGMTDPSC",82,0)
 .W !,"- If one or both members of the pair have a score greater than"
"RTN","RGMTDPSC",83,0)
 .W !,"  zero, that pair is counted in the group for the higher score."
"RTN","RGMTDPSC",84,0)
 .W !,"- If neither member of the pair have a CMOR score, the pair is"
"RTN","RGMTDPSC",85,0)
 .W !,"  counted in the 'NO SCORE' group."
"RTN","RGMTDPSC",86,0)
 W !!,?10,"Score Range",?40,"Count",!?10,"-----------",?40,"-----",!
"RTN","RGMTDPSC",87,0)
 Q
"RTN","RGMTDPSC",88,0)
MSG ;create the message
"RTN","RGMTDPSC",89,0)
 S TXT(.1)="Duplicate Record Count by CMOR Score"_$J(" ",20)_"Date: "_PRDT
"RTN","RGMTDPSC",90,0)
 S TXT(.2)="  "
"RTN","RGMTDPSC",91,0)
 S SITE=$$SITE^VASITE()
"RTN","RGMTDPSC",92,0)
 S TXT(.3)=$P(SITE,U,2)_" ("_$P(SITE,U)_")"
"RTN","RGMTDPSC",93,0)
 S TXT(.4)="  "
"RTN","RGMTDPSC",94,0)
 S TXT(.5)=$J(" ",10)_"Score Range"_$J(" ",20)_"Count"
"RTN","RGMTDPSC",95,0)
 S TXT(.6)=$J(" ",10)_"-----------"_$J(" ",20)_"-----"
"RTN","RGMTDPSC",96,0)
 S TXT(.7)="  "
"RTN","RGMTDPSC",97,0)
 Q
"RTN","RGMTDPSC",98,0)
MSG1 ;call XMD
"RTN","RGMTDPSC",99,0)
 S XMSUB="Duplicate Records by CMOR Score: "_$P(SITE,U,2)
"RTN","RGMTDPSC",100,0)
 S XMY(DUZ)="",XMDUZ=DUZ
"RTN","RGMTDPSC",101,0)
 S XMTEXT="TXT(" D ^XMD
"RTN","RGMTDPSC",102,0)
 Q
"RTN","RGMTTFL")
0^26^B15047718
"RTN","RGMTTFL",1,0)
RGMTTFL ;BIR/CML-TREATING FACILITY LIST STATISTICS ;01/06/99
"RTN","RGMTTFL",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**19**;30 Apr 99
"RTN","RGMTTFL",3,0)
 ;Reference to ^DGCN(391.91 supported by IA #2911
"RTN","RGMTTFL",4,0)
 S QFLG=1
"RTN","RGMTTFL",5,0)
BEGIN ;
"RTN","RGMTTFL",6,0)
 W !!,"This option prints a statistical breakdown of the entries in the"
"RTN","RGMTTFL",7,0)
 W !,"TREATING FACILITY LIST file (#391.91)."
"RTN","RGMTTFL",8,0)
DEV W !!,"The right margin for this report is 80.",!!
"RTN","RGMTTFL",9,0)
 D EN^XUTMDEVQ("START^RGMTTFL","MPI/PD - Treating Facility Statistics") I 'POP Q
"RTN","RGMTTFL",10,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","RGMTTFL",11,0)
 G QUIT
"RTN","RGMTTFL",12,0)
START ;
"RTN","RGMTTFL",13,0)
 ;Report shows:
"RTN","RGMTTFL",14,0)
 ;# of unique patients - ^TMP("RGMTTFL",$J,"UNIQUEPTS")
"RTN","RGMTTFL",15,0)
 ;# of patients assigned to each site - ^TMP("RGMTTFL",$J,"TOTPTS",SITE)
"RTN","RGMTTFL",16,0)
 ;# of single site patients for each site - ^TMP("RGMTTFL",$J,"SINGLE",SITE)
"RTN","RGMTTFL",17,0)
 ;# of shared patients - ^TMP("RGMTTFL",$J,"SHARED")
"RTN","RGMTTFL",18,0)
 ;to check totals:
"RTN","RGMTTFL",19,0)
 ;shared total + all single totals = total unique patients
"RTN","RGMTTFL",20,0)
 ;sum of all site totals - total shared = total unique patients
"RTN","RGMTTFL",21,0)
 K ^TMP("RGMTTFL",$J) S U="^"
"RTN","RGMTTFL",22,0)
 S ^TMP("RGMTTFL",$J,"UNIQUEPTS")=0
"RTN","RGMTTFL",23,0)
 S ^TMP("RGMTTFL",$J,"SHARED")=0
"RTN","RGMTTFL",24,0)
 S HOME=$$SITE^VASITE() ;institution file ptr^station name^station number
"RTN","RGMTTFL",25,0)
 S SITECNT=0,SITE=0 F  S SITE=$O(^DGCN(391.91,"AINST",SITE)) Q:'SITE  D
"RTN","RGMTTFL",26,0)
 .S ^TMP("RGMTTFL",$J,"TOTPTS",SITE)=0
"RTN","RGMTTFL",27,0)
 .S ^TMP("RGMTTFL",$J,"SINGLE",SITE)=0
"RTN","RGMTTFL",28,0)
 ;
"RTN","RGMTTFL",29,0)
LOOP ;Loop on "APAT" xref of the TREATING FACILITY LIST file (#391.91)
"RTN","RGMTTFL",30,0)
 S RGDFN=0 F  S RGDFN=$O(^DGCN(391.91,"APAT",RGDFN)) Q:'RGDFN  D
"RTN","RGMTTFL",31,0)
 .S GOT=0
"RTN","RGMTTFL",32,0)
 .S ^TMP("RGMTTFL",$J,"UNIQUEPTS")=^TMP("RGMTTFL",$J,"UNIQUEPTS")+1
"RTN","RGMTTFL",33,0)
 .S CNT=0,FAC=0 F  S FAC=$O(^DGCN(391.91,"APAT",RGDFN,FAC)) Q:'FAC  S CNT=CNT+1 D
"RTN","RGMTTFL",34,0)
 ..S ^TMP("RGMTTFL",$J,"TOTPTS",FAC)=^TMP("RGMTTFL",$J,"TOTPTS",FAC)+1
"RTN","RGMTTFL",35,0)
 ..I CNT=1,'$O(^DGCN(391.91,"APAT",RGDFN,FAC)) S ^TMP("RGMTTFL",$J,"SINGLE",FAC)=^TMP("RGMTTFL",$J,"SINGLE",FAC)+1 Q
"RTN","RGMTTFL",36,0)
 ..I 'GOT,CNT>1 S ^TMP("RGMTTFL",$J,"SHARED")=^TMP("RGMTTFL",$J,"SHARED")+1 S GOT=1
"RTN","RGMTTFL",37,0)
SORT ;Sort single-site and site total data alphabetically
"RTN","RGMTTFL",38,0)
 S SITE=0 F  S SITE=$O(^TMP("RGMTTFL",$J,"SINGLE",SITE)) Q:'SITE  D
"RTN","RGMTTFL",39,0)
 .S SITENM=$P($$NS^XUAF4(SITE),"^"),^TMP("RGMTTFL",$J,"SINGLE",SITENM)=^TMP("RGMTTFL",$J,"SINGLE",SITE) K ^TMP("RGMTTFL",$J,"SINGLE",SITE)
"RTN","RGMTTFL",40,0)
 S SITE=0 F  S SITE=$O(^TMP("RGMTTFL",$J,"TOTPTS",SITE)) Q:'SITE  D
"RTN","RGMTTFL",41,0)
 .S SITENM=$P($$NS^XUAF4(SITE),"^"),^TMP("RGMTTFL",$J,"TOTPTS",SITENM)=^TMP("RGMTTFL",$J,"TOTPTS",SITE) K ^TMP("RGMTTFL",$J,"TOTPTS",SITE)
"RTN","RGMTTFL",42,0)
PRT ;Print report
"RTN","RGMTTFL",43,0)
 S (PG,QFLG)=0,U="^",$P(LN,"-",81)="",LOCSITE=$P(HOME,U,2)
"RTN","RGMTTFL",44,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTTFL",45,0)
 D HDR
"RTN","RGMTTFL",46,0)
 I '$D(^TMP("RGMTTFL",$J)) W !!,"No data available for this report." G QUIT
"RTN","RGMTTFL",47,0)
 W !!,"Total single-facility patients:",!,"==============================="
"RTN","RGMTTFL",48,0)
 S SITE="" F  S SITE=$O(^TMP("RGMTTFL",$J,"SINGLE",SITE)) Q:SITE=""  Q:QFLG  D
"RTN","RGMTTFL",49,0)
 .D:$Y+4>IOSL HDR Q:QFLG  W !,SITE,?50,$J(^TMP("RGMTTFL",$J,"SINGLE",SITE),8)
"RTN","RGMTTFL",50,0)
 Q:QFLG
"RTN","RGMTTFL",51,0)
 W !!,"Total patients found for each facility:",!,"======================================="
"RTN","RGMTTFL",52,0)
 S SITE="" F  S SITE=$O(^TMP("RGMTTFL",$J,"TOTPTS",SITE)) Q:SITE=""  Q:QFLG  D
"RTN","RGMTTFL",53,0)
 .D:$Y+4>IOSL HDR Q:QFLG  W !,SITE,?50,$J(^TMP("RGMTTFL",$J,"TOTPTS",SITE),8)
"RTN","RGMTTFL",54,0)
 Q:QFLG  W !!
"RTN","RGMTTFL",55,0)
 D:$Y+4>IOSL HDR Q:QFLG  W !,"Total number of shared patients:",?50,$J(^TMP("RGMTTFL",$J,"SHARED"),8)
"RTN","RGMTTFL",56,0)
 D:$Y+4>IOSL HDR Q:QFLG  W !,"Total number of unique patients:",?50,$J(^TMP("RGMTTFL",$J,"UNIQUEPTS"),8)
"RTN","RGMTTFL",57,0)
QUIT ;
"RTN","RGMTTFL",58,0)
 I $E(IOST,1,2)="C-"&('QFLG) S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGMTTFL",59,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTTFL",60,0)
 K ^TMP("RGMTTFL",$J)
"RTN","RGMTTFL",61,0)
 K %,CNT,RGDFN,FAC,GOT,HDT,HOME,JJ,LN,LOCSITE,PG,QFLG,SITE,SITECNT,SITENM,SS,X,Y,ZTSK
"RTN","RGMTTFL",62,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","RGMTTFL",63,0)
HDR ;HEADER
"RTN","RGMTTFL",64,0)
 I $E(IOST,1,2)="C-" S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTTFL",65,0)
 I $E(IOST,1,2)="C-",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","RGMTTFL",66,0)
 S PG=PG+1 W:$Y!($E(IOST,1,2)="C-") @IOF
"RTN","RGMTTFL",67,0)
 W !,"TREATING FACILITY LIST STATISTICS",?72,"Page: ",PG
"RTN","RGMTTFL",68,0)
 W !,"Printed at ",LOCSITE," on ",HDT,!,LN
"RTN","RGMTTFL",69,0)
 Q
"RTN","RGPRELIG")
1^21
"RTN","RGPRSSN")
0^8^B31616698
"RTN","RGPRSSN",1,0)
RGPRSSN ;WAS/FHM-MPI/PD PSEUDO/MISSING SSN REPORT ;6/25/98
"RTN","RGPRSSN",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**19**;30 Apr 99
"RTN","RGPRSSN",3,0)
 ;
"RTN","RGPRSSN",4,0)
 ;Reference to ^DIC(8 supported by IA #427
"RTN","RGPRSSN",5,0)
 ;Reference to ^DGPM( supported by IA #966
"RTN","RGPRSSN",6,0)
 ;Reference to ^SCE( supported by IA #2443
"RTN","RGPRSSN",7,0)
 ;Reference to ADM^VADPT2 supported by IA #325
"RTN","RGPRSSN",8,0)
 ;
"RTN","RGPRSSN",9,0)
 ;EXTRACT BAD SSN AND SORTS THEM BY CLASSIFICATION
"RTN","RGPRSSN",10,0)
 W !,"This report will provide a list of:"
"RTN","RGPRSSN",11,0)
 W !,"(1) any B Cross-references (there is no 'zero' node but a B x-ref)"
"RTN","RGPRSSN",12,0)
 W !,"    on the patient file,"
"RTN","RGPRSSN",13,0)
 W !,"(2) patients with Pseudo SSNs who have not had activity within the past 3 years,"
"RTN","RGPRSSN",14,0)
 W !,"(3) patients with Pseudo SSNs who have had activity within the past 3 years.",!
"RTN","RGPRSSN",15,0)
 W !,"The Reports are sorted by Primary Eligibility Code. The report can"
"RTN","RGPRSSN",16,0)
 W !,"be queued if desired."
"RTN","RGPRSSN",17,0)
 W !,!,"For MPI/PD purposes, general advice is to concentrate first on"
"RTN","RGPRSSN",18,0)
 W !,"getting correct SSNs for the patients who HAVE had activity within"
"RTN","RGPRSSN",19,0)
 W !,"the past 3 years.",!
"RTN","RGPRSSN",20,0)
 S %ZIS="QM" D ^%ZIS G EXIT:POP
"RTN","RGPRSSN",21,0)
 K ^TMP($J)
"RTN","RGPRSSN",22,0)
 I $D(IO("Q")) D  Q
"RTN","RGPRSSN",23,0)
   .S ZTRTN="DQ^RGPRSSN",ZTDESC="MPI/PD SSN VALIDATION"
"RTN","RGPRSSN",24,0)
   .D ^%ZTLOAD D HOME^%ZIS K IO("Q")
"RTN","RGPRSSN",25,0)
DQ N DTOUT,DUOUT S RGFS=1,PRNTCODE="",RGPRNTCO=""
"RTN","RGPRSSN",26,0)
 U IO W @IOF,!,"MPI/PD Report of Pseudo, missing & potentially false SSNs "
"RTN","RGPRSSN",27,0)
 D NOW^%DTC D YX^%DTC
"RTN","RGPRSSN",28,0)
 W ?55,Y,!
"RTN","RGPRSSN",29,0)
 W !,"Bad B Cross References Report"
"RTN","RGPRSSN",30,0)
 W !,"Please contact IRM for assistance with bad B Cross references."
"RTN","RGPRSSN",31,0)
 W !,"----------------------------------------------------------------------------"
"RTN","RGPRSSN",32,0)
 S BREF=0
"RTN","RGPRSSN",33,0)
 S NAME=""
"RTN","RGPRSSN",34,0)
 F  S NAME=$O(^DPT("B",NAME)) Q:NAME=""  D
"RTN","RGPRSSN",35,0)
   .S REFNO=0
"RTN","RGPRSSN",36,0)
   .S REFNO=$O(^DPT("B",NAME,REFNO)) Q:REFNO=""
"RTN","RGPRSSN",37,0)
   .IF $D(^DPT(REFNO,0)) S NODE=^DPT(REFNO,0),RGSSN=$P(NODE,"^",9)
"RTN","RGPRSSN",38,0)
   .E  S BREF=1 W !,"B Cross Reference with no 0 Node in DPT: DFN= ",REFNO Q
"RTN","RGPRSSN",39,0)
   .IF RGSSN="" S RGSSN="None"
"RTN","RGPRSSN",40,0)
   .IF RGSSN'?9N S SCRATCH=$$SETGBL
"RTN","RGPRSSN",41,0)
   .IF RGSSN="123456789" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",42,0)
   .IF RGSSN="000000000" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",43,0)
   .IF RGSSN="111111111" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",44,0)
   .IF RGSSN="222222222" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",45,0)
   .IF RGSSN="333333333" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",46,0)
   .IF RGSSN="444444444" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",47,0)
   .IF RGSSN="555555555" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",48,0)
   .IF RGSSN="666666666" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",49,0)
   .IF RGSSN="777777777" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",50,0)
   .IF RGSSN="888888888" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",51,0)
   .IF RGSSN?1"9"8N S SCRATCH=$$SETGBL
"RTN","RGPRSSN",52,0)
   .QUIT
"RTN","RGPRSSN",53,0)
 IF BREF=0 W !,"*** No Bad B Cross References Found in your account.***"
"RTN","RGPRSSN",54,0)
LST S (ACTIV1,ECODE1,NAME1,REFNO1)=""
"RTN","RGPRSSN",55,0)
LST1 S ACTIV1=$O(^TMP($J,ACTIV1)) G EXIT:ACTIV1="" D HEADER G EXIT:$D(DUOUT)!($D(DTOUT))
"RTN","RGPRSSN",56,0)
LST2 S ECODE1=$O(^TMP($J,ACTIV1,ECODE1))  G LST1:ECODE1="" D:$Y>(IOSL-4) HEADER,HEAD2 G:$D(DUOUT)!($D(DTOUT)) EXIT W ! S SCRATCH=$$GETECODE
"RTN","RGPRSSN",57,0)
LST3 S NAME1=$O(^TMP($J,ACTIV1,ECODE1,NAME1))  G LST2:NAME1="" D:$Y>(IOSL-4) HEADER,HEAD2 G:$D(DUOUT)!($D(DTOUT)) EXIT
"RTN","RGPRSSN",58,0)
 S REFNO1=^TMP($J,ACTIV1,ECODE1,NAME1)
"RTN","RGPRSSN",59,0)
 S (PHONE,RGSSN,ECODE)="None"
"RTN","RGPRSSN",60,0)
 ;Using VADPT for PHONE# , SSN     ,eligibility code, and Name  
"RTN","RGPRSSN",61,0)
 K VAPTYP,VAHOW,VAROOT,VADM,VAEL,VAPA,VATEST S DFN=REFNO1 D ADD^VADPT,DEM^VADPT,ELIG^VADPT S NAME=VADM(1),RGSSN=$P(VADM(2),U),PHONE=VAPA(8),ECODE=$P(VAEL(1),U)
"RTN","RGPRSSN",62,0)
 K VAPTYP,VAHOW,VAROOT,VADM,VAEL,VAPA,VATEST
"RTN","RGPRSSN",63,0)
 S ACTIVITY=$$ACTIVE(REFNO1)
"RTN","RGPRSSN",64,0)
 W !,?10,ECODE,?20,NAME1,?54,RGSSN,?65,PHONE
"RTN","RGPRSSN",65,0)
 GOTO LST3
"RTN","RGPRSSN",66,0)
EXIT D ^%ZISC
"RTN","RGPRSSN",67,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGPRSSN",68,0)
 K ^TMP($J)
"RTN","RGPRSSN",69,0)
 K ACTIV1,ACTIVITY,BREF,ECODE,ECODE1,NAME,NAME1,NODE,NODE2,NODE3
"RTN","RGPRSSN",70,0)
 K NODE4,PHONE,PRNTCODE,REFNO,REFNO1,RGFS,RGPRNTCO,SCRATCH,RGSSN,ZTREQ,%ZIS,NODE1,POP,ZTDESC,ZTRTN
"RTN","RGPRSSN",71,0)
 QUIT
"RTN","RGPRSSN",72,0)
SETGBL()        ;SETS GLOBAL
"RTN","RGPRSSN",73,0)
 S ECODE=""
"RTN","RGPRSSN",74,0)
 K VAEL S DFN=REFNO D ELIG^VADPT S ECODE=$P(VAEL(1),U)
"RTN","RGPRSSN",75,0)
 IF ECODE="" S ECODE="None"
"RTN","RGPRSSN",76,0)
 S ACTIVITY=$$ACTIVE(REFNO)
"RTN","RGPRSSN",77,0)
 S ^TMP($J,ACTIVITY,ECODE,NAME)=REFNO
"RTN","RGPRSSN",78,0)
 QUIT 1
"RTN","RGPRSSN",79,0)
GETECODE()      ;
"RTN","RGPRSSN",80,0)
 S PRNTCODE="None"
"RTN","RGPRSSN",81,0)
 IF $D(^DIC(8,ECODE1,0)) S NODE4=^DIC(8,ECODE1,0),PRNTCODE=$P(NODE4,"^",1)
"RTN","RGPRSSN",82,0)
 W !,PRNTCODE S RGFS=0
"RTN","RGPRSSN",83,0)
 QUIT 1
"RTN","RGPRSSN",84,0)
LTD(DFN)        ;
"RTN","RGPRSSN",85,0)
 ;FIND LAST TREATMENT DATE
"RTN","RGPRSSN",86,0)
 ;INPUT: DFN
"RTN","RGPRSSN",87,0)
 ;OUTPUT: LTD LAST TREATMENT DATE
"RTN","RGPRSSN",88,0)
 ;
"RTN","RGPRSSN",89,0)
 ;
"RTN","RGPRSSN",90,0)
 N LTD,X
"RTN","RGPRSSN",91,0)
 ;
"RTN","RGPRSSN",92,0)
 ; - NEED A PATIENT
"RTN","RGPRSSN",93,0)
 I '$G(DFN) S LTD=0 G LTDQ
"RTN","RGPRSSN",94,0)
 ;
"RTN","RGPRSSN",95,0)
 ; - IF CURRENT INPATIENT, SET LTD = TODAY AND QUIT
"RTN","RGPRSSN",96,0)
 ;Current admission movement from ADM^VAPDT2
"RTN","RGPRSSN",97,0)
 K VADMVT,VAINDT D ADM^VADPT2 I $L(VADMVT) S LTD=DT K VADMVT,VAERR,VAINDT G LTDQ
"RTN","RGPRSSN",98,0)
 K VADMVT,VAERR,VAINDT
"RTN","RGPRSSN",99,0)
 ;
"RTN","RGPRSSN",100,0)
 ; - GET THE LAST DISCHARGE DATE
"RTN","RGPRSSN",101,0)
 S LTD=+$O(^DGPM("ATID3",DFN,"")) S:LTD LTD=9999999.9999999-LTD\1 S:LTD>DT LTD=DT
"RTN","RGPRSSN",102,0)
 ;
"RTN","RGPRSSN",103,0)
 ; - GET THE LAST REGISTRATION DATE AND COMPARE IT TO LTD
"RTN","RGPRSSN",104,0)
 K VAROOT,VARP,^UTILITY("VARP",$J) S VARP("F")=2000101 D REG^VADPT I $D(^UTILITY("VARP",$J,1,"I")) S X=$P(^("I"),U) I X S X=X\1 S:X>LTD LTD=X
"RTN","RGPRSSN",105,0)
 K ^UTILITY("VARP",$J),VARP,VAERR
"RTN","RGPRSSN",106,0)
 ;
"RTN","RGPRSSN",107,0)
 ; - GET THE LAST APPOINTMENT DATE AND COMPARE TO LTD
"RTN","RGPRSSN",108,0)
 K VASD,^UTILTIY("VASD",$J) S VASD("F")=2000101 D SDA^VADPT S Y="" F  S Y=$O(^UTILITY("VASD",$J,Y)) Q:'Y  I $P(^UTILITY("VASD",$J,Y,"I"),U,3)="" S X=$P(^("I"),U) I X S X=X\1 S:X>LTD LTD=X
"RTN","RGPRSSN",109,0)
 K VASD,VAERR,^UTILITY("VASD",$J)
"RTN","RGPRSSN",110,0)
 ;
"RTN","RGPRSSN",111,0)
 ; - GET THE LAST STOP AND COMPARE TO LTD
"RTN","RGPRSSN",112,0)
 ; Look at Outpatient Encounter, ^SDV is going away
"RTN","RGPRSSN",113,0)
 ; Use an API instead of ordering through global
"RTN","RGPRSSN",114,0)
 N OPIEN S OPIEN=$$GETLAST^SDOE(DFN,2000101,"C")
"RTN","RGPRSSN",115,0)
 I $G(^SCE(+OPIEN,0)) S LTD=$P(^SCE(OPIEN,0),"^",1)\1
"RTN","RGPRSSN",116,0)
 ;
"RTN","RGPRSSN",117,0)
LTDQ ;
"RTN","RGPRSSN",118,0)
 Q $S(LTD:LTD,1:0)
"RTN","RGPRSSN",119,0)
 ;
"RTN","RGPRSSN",120,0)
ACTIVE(DFN) ;
"RTN","RGPRSSN",121,0)
 N LTD,TODAY,DIFF
"RTN","RGPRSSN",122,0)
 S LTD=$$LTD(DFN)
"RTN","RGPRSSN",123,0)
 Q:LTD'>0 "NO"
"RTN","RGPRSSN",124,0)
 Q:$L(LTD)'=7 1_"^"_LTD_"^"_"ZERO"
"RTN","RGPRSSN",125,0)
 S TODAY=$$NOW^XLFDT\1
"RTN","RGPRSSN",126,0)
 S DIFF=$$FMDIFF^XLFDT(TODAY,LTD)
"RTN","RGPRSSN",127,0)
 ; if difference is > 1096 days or 3 years
"RTN","RGPRSSN",128,0)
 I DIFF>1096 Q "NO"
"RTN","RGPRSSN",129,0)
 Q "YES"
"RTN","RGPRSSN",130,0)
HEADER ;PRINT REPORT HEADER
"RTN","RGPRSSN",131,0)
 I ($E(IOST,1,2)="C-")&(IO=IO(0)) D
"RTN","RGPRSSN",132,0)
 . S DIR(0)="E"
"RTN","RGPRSSN",133,0)
 . D ^DIR K DIR
"RTN","RGPRSSN",134,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","RGPRSSN",135,0)
 ;;;W:$D(IOF) @IOF
"RTN","RGPRSSN",136,0)
 W @IOF,!,"MPI/PD Report of Pseudo, missing & potentially false SSNs "
"RTN","RGPRSSN",137,0)
 D NOW^%DTC D YX^%DTC
"RTN","RGPRSSN",138,0)
 W ?55,Y,! K Y
"RTN","RGPRSSN",139,0)
 W !,?20,"Patient activity within past 3 years = ",$G(ACTIV1)
"RTN","RGPRSSN",140,0)
 W !,?1,"Primary"
"RTN","RGPRSSN",141,0)
 W !,?1,"Elig Code"
"RTN","RGPRSSN",142,0)
 W !,?10,"Elig.",?20,"Name",?54,"SSN",?65,"Home Phone"
"RTN","RGPRSSN",143,0)
 W !,"-----------------------------------------------------------------------------"
"RTN","RGPRSSN",144,0)
 Q
"RTN","RGPRSSN",145,0)
HEAD2 ;SUB HEADER
"RTN","RGPRSSN",146,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","RGPRSSN",147,0)
 I RGFS=0,PRNTCODE=RGPRNTCO W !,PRNTCODE
"RTN","RGPRSSN",148,0)
 E  I RGFS=0 W !,PRNTCODE S RGPRNTCO=PRNTCODE
"RTN","RGPRSSN",149,0)
 Q
"RTN","RGRSBUL1")
0^13^B31114951
"RTN","RGRSBUL1",1,0)
RGRSBUL1 ;ALB/RJS,CML-RGRSTEXT BULLETIN ROUTINE (PART 2) ;07/24/98
"RTN","RGRSBUL1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3,19**;30 Apr 99
"RTN","RGRSBUL1",3,0)
SSNBULL(DFN,ARRAY,NAME,SSN,ICN,CMOR) ;
"RTN","RGRSBUL1",4,0)
 ;Entry point generates a bulletin to the RG CIRN DEMOGRAPHIC
"RTN","RGRSBUL1",5,0)
 ;ISSUES mail group about an SSN change for a given patient.
"RTN","RGRSBUL1",6,0)
 ;
"RTN","RGRSBUL1",7,0)
 ;Input:  Required Variables
"RTN","RGRSBUL1",8,0)
 ;
"RTN","RGRSBUL1",9,0)
 ;   DFN   - IEN in the PATIENT file (#2)
"RTN","RGRSBUL1",10,0)
 ;  ARRAY  - Array of data containing sending sites station number
"RTN","RGRSBUL1",11,0)
 ;   NAME  - Patient's Name
"RTN","RGRSBUL1",12,0)
 ;   SSN   - Patient's SSN
"RTN","RGRSBUL1",13,0)
 ;   ICN   - Patient's ICN (Integration Control Number) 
"RTN","RGRSBUL1",14,0)
 ;   CMOR  - Patient's CMOR (Coordinating Master of Record)
"RTN","RGRSBUL1",15,0)
 ;
"RTN","RGRSBUL1",16,0)
 Q:$G(DFN)=""!($G(ARRAY)="")
"RTN","RGRSBUL1",17,0)
 N LOCDATA,RGRSTEXT,INDEX,COUNTER
"RTN","RGRSBUL1",18,0)
 S RGRSTEXT(1)="The MPI/PD Package has received an SSN change from:"
"RTN","RGRSBUL1",19,0)
 S RGRSTEXT(2)=$$INST(@ARRAY@("SENDING SITE"))
"RTN","RGRSBUL1",20,0)
 S RGRSTEXT(3)="           "
"RTN","RGRSBUL1",21,0)
 S RGRSTEXT(4)="This change has been made in your local data base for:"
"RTN","RGRSBUL1",22,0)
 S RGRSTEXT(5)=NAME
"RTN","RGRSBUL1",23,0)
 S RGRSTEXT(6)="           "
"RTN","RGRSBUL1",24,0)
 S RGRSTEXT(7)="=> Local "_$P($$SITE^VASITE(),"^",2)_" data PRIOR to update:"
"RTN","RGRSBUL1",25,0)
 S RGRSTEXT(8)="NAME: "_NAME
"RTN","RGRSBUL1",26,0)
 S RGRSTEXT(9)="SSN: "_SSN
"RTN","RGRSBUL1",27,0)
 S RGRSTEXT(10)="ICN: "_ICN
"RTN","RGRSBUL1",28,0)
 S RGRSTEXT(11)="CMOR: "_CMOR
"RTN","RGRSBUL1",29,0)
 S RGRSTEXT(12)="--------------------------------------------------------"
"RTN","RGRSBUL1",30,0)
 S RGRSTEXT(13)="=> Update received from "_$P($$INST(@ARRAY@("SENDING SITE"))," -->")_":"
"RTN","RGRSBUL1",31,0)
 S RGRSTEXT(14)="SSN: "_@ARRAY@("SSN")
"RTN","RGRSBUL1",32,0)
 D BULL2^RGRSBULL("MPI/PD SSN CHANGE - "_NAME,"RGRSTEXT(")
"RTN","RGRSBUL1",33,0)
 Q
"RTN","RGRSBUL1",34,0)
 ;
"RTN","RGRSBUL1",35,0)
NOT2(ARRAY) ;
"RTN","RGRSBUL1",36,0)
 ;Entry point generates a bulletin to the RG CIRN DEMOGRAPHIC
"RTN","RGRSBUL1",37,0)
 ;ISSUES mail group about invalid subscription information for a given
"RTN","RGRSBUL1",38,0)
 ;patient.
"RTN","RGRSBUL1",39,0)
 ;
"RTN","RGRSBUL1",40,0)
 ;Input:  Required Variables
"RTN","RGRSBUL1",41,0)
 ;
"RTN","RGRSBUL1",42,0)
 ;  ARRAY  - Array of information regarding the invalid subscription
"RTN","RGRSBUL1",43,0)
 ;
"RTN","RGRSBUL1",44,0)
 Q:($G(ARRAY)="")
"RTN","RGRSBUL1",45,0)
 N RGRSTEXT,INDEX,COUNTER
"RTN","RGRSBUL1",46,0)
 S RGRSTEXT(1)="The MPI/PD Package has received a message from:"
"RTN","RGRSBUL1",47,0)
 S RGRSTEXT(2)=$$INST(@ARRAY@("SENDING SITE"))
"RTN","RGRSBUL1",48,0)
 S RGRSTEXT(3)="This patient has your station as a subscriber, however"
"RTN","RGRSBUL1",49,0)
 S RGRSTEXT(4)="the patient was not found in your database."
"RTN","RGRSBUL1",50,0)
 S RGRSTEXT(5)="--------------------------------------------------------"
"RTN","RGRSBUL1",51,0)
 S RGRSTEXT(6)="Remote Data"
"RTN","RGRSBUL1",52,0)
 S RGRSTEXT(7)="           "
"RTN","RGRSBUL1",53,0)
 S INDEX=0,COUNTER=8
"RTN","RGRSBUL1",54,0)
 F  S INDEX=$O(@ARRAY@("MESSAGE",INDEX)) Q:INDEX']""  D
"RTN","RGRSBUL1",55,0)
 . S RGRSTEXT(COUNTER)=@ARRAY@("MESSAGE",INDEX)
"RTN","RGRSBUL1",56,0)
 . S COUNTER=COUNTER+1
"RTN","RGRSBUL1",57,0)
 D BULL2^RGRSBULL("MPI/PD - PATIENT NOT FOUND","RGRSTEXT(")
"RTN","RGRSBUL1",58,0)
 Q
"RTN","RGRSBUL1",59,0)
 ;
"RTN","RGRSBUL1",60,0)
SENSTIVE(DFN,ARRAY,NAME) ;FIRES WHEN PT. IS FLAGGED AS SENSITIVE AT ANOTHER SITE
"RTN","RGRSBUL1",61,0)
 ;Entry point generates a bulletin to the RG CIRN DEMOGRAPHIC
"RTN","RGRSBUL1",62,0)
 ;ISSUES mail group when a given patient is flagged as sensitive at
"RTN","RGRSBUL1",63,0)
 ;another site.
"RTN","RGRSBUL1",64,0)
 ;
"RTN","RGRSBUL1",65,0)
 ;Input:  Required Variables
"RTN","RGRSBUL1",66,0)
 ;
"RTN","RGRSBUL1",67,0)
 ;   DFN  - IEN in the PATIENT file (#2)
"RTN","RGRSBUL1",68,0)
 ;  ARRAY - Array of data containing sending sites station number and SSN
"RTN","RGRSBUL1",69,0)
 ;  NAME  - Patient's name
"RTN","RGRSBUL1",70,0)
 ;  CMOR  - Coordinating Master of Record
"RTN","RGRSBUL1",71,0)
 ;
"RTN","RGRSBUL1",72,0)
 Q:($G(ARRAY)="")!($G(DFN)="")
"RTN","RGRSBUL1",73,0)
 N RGRSTEXT,INDEX,COUNTER,CMOR
"RTN","RGRSBUL1",74,0)
 S CMOR=$$CMOR2^MPIF001(DFN) I $P(CMOR,"^")<0 S CMOR="not assigned"
"RTN","RGRSBUL1",75,0)
 S RGRSTEXT(1)="The MPI/PD Package has received a message from:"
"RTN","RGRSBUL1",76,0)
 S RGRSTEXT(2)=$$INST(@ARRAY@("SENDING SITE"))
"RTN","RGRSBUL1",77,0)
 S RGRSTEXT(3)="   "
"RTN","RGRSBUL1",78,0)
 S RGRSTEXT(4)="This message indicates that patient "_NAME_" is flagged"
"RTN","RGRSBUL1",79,0)
 S RGRSTEXT(5)="as Sensitive at the other facility but is not flagged as"
"RTN","RGRSBUL1",80,0)
 S RGRSTEXT(6)="Sensitive at your facility."
"RTN","RGRSBUL1",81,0)
 S RGRSTEXT(7)="  "
"RTN","RGRSBUL1",82,0)
 S RGRSTEXT(8)="Remote Patient SSN: "_$S(@ARRAY@("SSN")="":"Not Available",1:@ARRAY@("SSN"))
"RTN","RGRSBUL1",83,0)
 S RGRSTEXT(9)="Remote User who Flagged the Patient as Sensitive: "_@ARRAY@("SENSITIVITY USER")
"RTN","RGRSBUL1",84,0)
 S RGRSTEXT(10)="Date/Time Remote User Flagged Patient Sensitive:  "_$$FMTE^XLFDT(@ARRAY@("SENSITIVITY DATE"))
"RTN","RGRSBUL1",85,0)
 S RGRSTEXT(11)="  "
"RTN","RGRSBUL1",86,0)
 S RGRSTEXT(12)="CMOR Site: "_CMOR
"RTN","RGRSBUL1",87,0)
 D BULL2^RGRSBULL("Remote Sensitivity Indicated","RGRSTEXT(")
"RTN","RGRSBUL1",88,0)
 Q
"RTN","RGRSBUL1",89,0)
 ;
"RTN","RGRSBUL1",90,0)
RMTDOD(DFN,ARRAY,NAME,RDOD,LDOD) ;Fires when patient has a Date of Death at another site
"RTN","RGRSBUL1",91,0)
 ;Entry point generates a bulletin to the RG CIRN DEMOGRAPHIC
"RTN","RGRSBUL1",92,0)
 ;ISSUES mail group when a given patient has a Date of Death at
"RTN","RGRSBUL1",93,0)
 ;another site.
"RTN","RGRSBUL1",94,0)
 ;
"RTN","RGRSBUL1",95,0)
 ;Input:  Required Variables
"RTN","RGRSBUL1",96,0)
 ;
"RTN","RGRSBUL1",97,0)
 ;  DFN   - IEN in the PATIENT file (#2)
"RTN","RGRSBUL1",98,0)
 ;  ARRAY - Array of data containing sending sites station number and SSN
"RTN","RGRSBUL1",99,0)
 ;  NAME  - Patient's name
"RTN","RGRSBUL1",100,0)
 ;  RDOD  - Date of Death at remote site
"RTN","RGRSBUL1",101,0)
 ;  LDOD  - Date of Death at local site
"RTN","RGRSBUL1",102,0)
 ;  CMOR  - Coordinating Master of Record
"RTN","RGRSBUL1",103,0)
 ;
"RTN","RGRSBUL1",104,0)
 Q:($G(ARRAY)="")!($G(DFN)="")
"RTN","RGRSBUL1",105,0)
 Q:(RDOD=LDOD)  ;If remote DOD and local DOD same, QUIT
"RTN","RGRSBUL1",106,0)
 N CMOR
"RTN","RGRSBUL1",107,0)
 S CMOR=$$CMOR2^MPIF001(DFN) I $P(CMOR,"^")<0 S CMOR="not assigned"
"RTN","RGRSBUL1",108,0)
 N RGRSTEXT
"RTN","RGRSBUL1",109,0)
 S RGRSTEXT(1)="The MPI/PD Package has received a message from:"
"RTN","RGRSBUL1",110,0)
 S RGRSTEXT(2)=$$INST(@ARRAY@("SENDING SITE"))
"RTN","RGRSBUL1",111,0)
 S RGRSTEXT(3)="   "
"RTN","RGRSBUL1",112,0)
 S RGRSTEXT(4)="This message indicates that patient "_NAME
"RTN","RGRSBUL1",113,0)
 I 'LDOD S RGRSTEXT(5)="has a date of death at the other facility but not at your facility." G RMTMSG
"RTN","RGRSBUL1",114,0)
 I LDOD,(LDOD'=RDOD) S RGRSTEXT(5)="has a different date of death at the other facility than at your facility."
"RTN","RGRSBUL1",115,0)
RMTMSG S RGRSTEXT(6)="  "
"RTN","RGRSBUL1",116,0)
 S RGRSTEXT(7)="Remote Patient SSN: "_$S(@ARRAY@("SSN")="":"Not Available",1:@ARRAY@("SSN"))
"RTN","RGRSBUL1",117,0)
 S RGRSTEXT(8)="Date of Death from other facility:  "_$$FMTE^XLFDT(RDOD)
"RTN","RGRSBUL1",118,0)
 I LDOD,(LDOD'=RDOD) S RGRSTEXT(9)="Date of Death at your facility:  "_$$FMTE^XLFDT(LDOD)
"RTN","RGRSBUL1",119,0)
 S RGRSTEXT(10)="  "
"RTN","RGRSBUL1",120,0)
 S RGRSTEXT(11)="CMOR site: "_CMOR
"RTN","RGRSBUL1",121,0)
 D BULL2^RGRSBULL("Remote Date of Death Indicated","RGRSTEXT(")
"RTN","RGRSBUL1",122,0)
 Q
"RTN","RGRSBUL1",123,0)
 ;
"RTN","RGRSBUL1",124,0)
INST(SITENUM) ;
"RTN","RGRSBUL1",125,0)
 N RETURN,IEN,DATA,NAME,NUMBER
"RTN","RGRSBUL1",126,0)
 S RETURN=""
"RTN","RGRSBUL1",127,0)
 Q:$G(SITENUM)="" RETURN
"RTN","RGRSBUL1",128,0)
 S IEN=$$LKUP^XUAF4(SITENUM)
"RTN","RGRSBUL1",129,0)
 I IEN>0 S DATA=$$NS^XUAF4(IEN)
"RTN","RGRSBUL1",130,0)
 I $G(DATA)]"" D 
"RTN","RGRSBUL1",131,0)
 . S NAME=$P(DATA,"^",1),NUMBER=$P(DATA,"^",2)
"RTN","RGRSBUL1",132,0)
 . S RETURN=NAME_" --> Site Number: "_NUMBER
"RTN","RGRSBUL1",133,0)
 Q RETURN
"RTN","RGRSBUL1",134,0)
 ;
"RTN","RGRSBUL1",135,0)
FORMAT(DATA1,DATA2) ;
"RTN","RGRSBUL1",136,0)
 N SPACES,SPACENUM,LENGTH1,LENGTH2,RETURN
"RTN","RGRSBUL1",137,0)
 S SPACES="                       "
"RTN","RGRSBUL1",138,0)
 S LENGTH1=$L(DATA1),LENGTH2=$L(DATA2)
"RTN","RGRSBUL1",139,0)
 I LENGTH1>23 S DATA1=$E(DATA1,1,23) S LENGTH1=23
"RTN","RGRSBUL1",140,0)
 I LENGTH2>22 S DATA2=$E(DATA2,1,22)
"RTN","RGRSBUL1",141,0)
 S SPACENUM=23-LENGTH1
"RTN","RGRSBUL1",142,0)
 S SPACES=$E(SPACES,1,SPACENUM)
"RTN","RGRSBUL1",143,0)
 S RETURN=DATA1_SPACES_" "_DATA2
"RTN","RGRSBUL1",144,0)
 Q $G(RETURN)
"RTN","RGRSBUL1",145,0)
 ;
"RTN","RGRSBUL1",146,0)
FREE(DATA) ;
"RTN","RGRSBUL1",147,0)
 Q:$G(DATA)="" ""
"RTN","RGRSBUL1",148,0)
 Q:$G(DATA)["@" ""
"RTN","RGRSBUL1",149,0)
 Q:$G(DATA)=HL("Q") ""
"RTN","RGRSBUL1",150,0)
 Q $G(DATA)
"RTN","RGRSBULL")
0^9^B32477517
"RTN","RGRSBULL",1,0)
RGRSBULL ;ALB/RJS,CML-RGRSTEXT BULLETIN ROUTINE ;07/24/98
"RTN","RGRSBULL",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**19**;30 Apr 99
"RTN","RGRSBULL",3,0)
BULL(XMB,XMTEXT) ;
"RTN","RGRSBULL",4,0)
 ;Entry point generates a bulletin when a notification
"RTN","RGRSBULL",5,0)
 ;from the MPI/PD package has been generated
"RTN","RGRSBULL",6,0)
 ;
"RTN","RGRSBULL",7,0)
 ;Input:Required variables
"RTN","RGRSBULL",8,0)
 ;  
"RTN","RGRSBULL",9,0)
 ;      XMB    - Bulletin name e.g. ("RG CIRN DEMOGRAPHIC ISSUES")
"RTN","RGRSBULL",10,0)
 ;      XMTEXT - global or array root (EX. "^TMP("), location of 
"RTN","RGRSBULL",11,0)
 ;               error message(s)
"RTN","RGRSBULL",12,0)
 ;
"RTN","RGRSBULL",13,0)
 ;If XMY is defined, the call to ^XMB will process accordingly.
"RTN","RGRSBULL",14,0)
 ;XMY is used to pass additional recipients.
"RTN","RGRSBULL",15,0)
 ;
"RTN","RGRSBULL",16,0)
 Q:$G(XMB)=""!($G(XMTEXT)="")
"RTN","RGRSBULL",17,0)
 D NOW^%DTC S XMDT=X K X
"RTN","RGRSBULL",18,0)
 S XMDUZ="MPI/PD PACKAGE"
"RTN","RGRSBULL",19,0)
 D ^XMB
"RTN","RGRSBULL",20,0)
 K XMDT,XMDUZ
"RTN","RGRSBULL",21,0)
 Q
"RTN","RGRSBULL",22,0)
BULL2(XMSUB,XMTEXT) ;
"RTN","RGRSBULL",23,0)
 N XMY,XMDUZ
"RTN","RGRSBULL",24,0)
 S XMY("G.RG CIRN DEMOGRAPHIC ISSUES")=""
"RTN","RGRSBULL",25,0)
 S XMDUZ="MPI/PD PACKAGE"
"RTN","RGRSBULL",26,0)
 D ^XMD
"RTN","RGRSBULL",27,0)
 Q
"RTN","RGRSBULL",28,0)
 ;
"RTN","RGRSBULL",29,0)
ADDRESS(DFN,NAME,LINE1,LINE2,LINE3,SENDSITE,CITY,COUNTY,STATE,ZIP) ;
"RTN","RGRSBULL",30,0)
 ;Entry point generates a bulletin to the RG CIRN DEMOGRAPHIC
"RTN","RGRSBULL",31,0)
 ;ISSUES mail group about changes to the address of a given patient.
"RTN","RGRSBULL",32,0)
 ;
"RTN","RGRSBULL",33,0)
 ;Input:  Required Variables
"RTN","RGRSBULL",34,0)
 ;
"RTN","RGRSBULL",35,0)
 ;   DFN   - IEN in the PATIENT file (#2)
"RTN","RGRSBULL",36,0)
 ;   NAME  - Patient's Name
"RTN","RGRSBULL",37,0)
 ;   LINE1,LINE2,LINE3 - Lines of the Address
"RTN","RGRSBULL",38,0)
 ; SENDSITE- The station number of the site that initiated the change
"RTN","RGRSBULL",39,0)
 ;    CITY - city
"RTN","RGRSBULL",40,0)
 ;  COUNTY - county
"RTN","RGRSBULL",41,0)
 ;   STATE - state
"RTN","RGRSBULL",42,0)
 ;     ZIP - zip
"RTN","RGRSBULL",43,0)
 ;
"RTN","RGRSBULL",44,0)
 Q:$G(DFN)=""!($G(NAME)="")
"RTN","RGRSBULL",45,0)
 Q:$G(^DPT(DFN,0))=""
"RTN","RGRSBULL",46,0)
 N RGADRES,DA,DIC,DR,DIQ,ADDR1,ADDR11,ADDR2,ADDR22,ADDR3,ADDR33,LINE11,LINE22,LINE33,ADDR4,ADDR44,ADDR5,ADDR55,ADDR6,ADDR66,ADDR7,ADDR77,DELFLG
"RTN","RGRSBULL",47,0)
 S DIC=2,DR=".111;.112;.113;.114;.115;.117;.1112",DA=DFN,DIQ="RGADRES",DIQ(0)="E" D EN^DIQ1
"RTN","RGRSBULL",48,0)
 S ADDR1=$G(RGADRES(2,DFN,.111,"E")),ADDR2=$G(RGADRES(2,DFN,.112,"E")),ADDR3=$G(RGADRES(2,DFN,.113,"E")),ADDR4=$G(RGADRES(2,DFN,.114,"E")),ADDR5=$G(RGADRES(2,DFN,.115,"E")),ADDR6=$G(RGADRES(2,DFN,.117,"E")),ADDR7=$G(RGADRES(2,DFN,.1112,"E"))
"RTN","RGRSBULL",49,0)
 ;
"RTN","RGRSBULL",50,0)
 S ADDR6=$$COUNTY^RGRSPARS(ADDR5,ADDR6)
"RTN","RGRSBULL",51,0)
 ;
"RTN","RGRSBULL",52,0)
 ;Check for null or deleted address fields from remote site
"RTN","RGRSBULL",53,0)
 ;
"RTN","RGRSBULL",54,0)
 S DELFLG=0
"RTN","RGRSBULL",55,0)
 ;
"RTN","RGRSBULL",56,0)
 I $S(LINE1="@":1,LINE1="""@""":1,LINE1="""""":1,1:LINE1="") D
"RTN","RGRSBULL",57,0)
 .I ADDR1'="" S DELFLG=1,LINE1="<<DELETED>>" Q
"RTN","RGRSBULL",58,0)
 .S LINE1=""
"RTN","RGRSBULL",59,0)
 ;
"RTN","RGRSBULL",60,0)
 I $S(LINE2="@":1,LINE2="""@""":1,LINE2="""""":1,1:LINE2="") D
"RTN","RGRSBULL",61,0)
 .I ADDR2'="" S LINE2="<<DELETED>>" Q
"RTN","RGRSBULL",62,0)
 .S LINE2=""
"RTN","RGRSBULL",63,0)
 ;
"RTN","RGRSBULL",64,0)
 I $S(LINE3="@":1,LINE3="""@""":1,LINE3="""""":1,1:LINE3="") D
"RTN","RGRSBULL",65,0)
 .I ADDR3'="" S LINE3="<<DELETED>>" Q
"RTN","RGRSBULL",66,0)
 .S LINE3=""
"RTN","RGRSBULL",67,0)
 ;
"RTN","RGRSBULL",68,0)
 I $S(CITY="@":1,CITY="""@""":1,CITY="""""":1,1:CITY="") D
"RTN","RGRSBULL",69,0)
 .I ADDR4'="" S DELFLG=1,CITY="<<DELETED>>" Q
"RTN","RGRSBULL",70,0)
 .S CITY=""
"RTN","RGRSBULL",71,0)
 ;
"RTN","RGRSBULL",72,0)
 I $S(STATE="@":1,STATE="""@""":1,STATE="""""":1,1:STATE="") D
"RTN","RGRSBULL",73,0)
 .I ADDR5'="" S DELFLG=1,STATE="<<DELETED>>" Q
"RTN","RGRSBULL",74,0)
 .S STATE=""
"RTN","RGRSBULL",75,0)
 ;
"RTN","RGRSBULL",76,0)
 I $S(COUNTY="@":1,COUNTY="""@""":1,COUNTY="""""":1,1:COUNTY="") D
"RTN","RGRSBULL",77,0)
 .I ADDR6'="" S DELFLG=1,COUNTY="<<DELETED>>" Q
"RTN","RGRSBULL",78,0)
 .S COUNTY=""
"RTN","RGRSBULL",79,0)
 ;
"RTN","RGRSBULL",80,0)
 I $S(ZIP="@":1,ZIP="""@""":1,ZIP="""""":1,1:ZIP="") D
"RTN","RGRSBULL",81,0)
 .I ADDR7'="" S DELFLG=1,ZIP="<<DELETED>>" Q
"RTN","RGRSBULL",82,0)
 .S ZIP=""
"RTN","RGRSBULL",83,0)
 ;
"RTN","RGRSBULL",84,0)
 I DELFLG G SENDADD
"RTN","RGRSBULL",85,0)
 ;
"RTN","RGRSBULL",86,0)
EXITADD ;
"RTN","RGRSBULL",87,0)
 Q
"RTN","RGRSBULL",88,0)
SENDADD ;
"RTN","RGRSBULL",89,0)
 N RGRSTEXT,XMSUB
"RTN","RGRSBULL",90,0)
 S RGRSTEXT(1)="The MPI/PD Package has received a message from:"
"RTN","RGRSBULL",91,0)
 S RGRSTEXT(2)=$$INST^RGRSBUL1(SENDSITE)
"RTN","RGRSBULL",92,0)
 S RGRSTEXT(3)="This message deleted address information for Patient:"
"RTN","RGRSBULL",93,0)
 S RGRSTEXT(4)=NAME
"RTN","RGRSBULL",94,0)
 S RGRSTEXT(5)="               "
"RTN","RGRSBULL",95,0)
 S RGRSTEXT(6)="                         <<OLD ADDRESS>>         <<NEW ADDRESS>>"
"RTN","RGRSBULL",96,0)
 S RGRSTEXT(7)="       "
"RTN","RGRSBULL",97,0)
 S RGRSTEXT(8)="STREET ADDRESS [LINE 1]: "_$$FORMAT^RGRSBUL1(ADDR1,LINE1)
"RTN","RGRSBULL",98,0)
 S RGRSTEXT(9)="STREET ADDRESS [LINE 2]: "_$$FORMAT^RGRSBUL1(ADDR2,LINE2)
"RTN","RGRSBULL",99,0)
 S RGRSTEXT(10)="STREET ADDRESS [LINE 3]: "_$$FORMAT^RGRSBUL1(ADDR3,LINE3)
"RTN","RGRSBULL",100,0)
 S RGRSTEXT(11)="                   CITY: "_$$FORMAT^RGRSBUL1(ADDR4,CITY)
"RTN","RGRSBULL",101,0)
 S RGRSTEXT(12)="                 COUNTY: "_$$FORMAT^RGRSBUL1(ADDR6,COUNTY)
"RTN","RGRSBULL",102,0)
 S RGRSTEXT(13)="                  STATE: "_$$FORMAT^RGRSBUL1(ADDR5,STATE)
"RTN","RGRSBULL",103,0)
 S RGRSTEXT(14)="                  ZIP+4: "_$$FORMAT^RGRSBUL1(ADDR7,ZIP)
"RTN","RGRSBULL",104,0)
 D BULL2($P(NAME,",",1)_" **MPI/PD ADDRESS DELETION**","RGRSTEXT(")
"RTN","RGRSBULL",105,0)
 G EXITADD
"RTN","RGRSBULL",106,0)
 ;
"RTN","RGRSBULL",107,0)
SKIPBULL(ARRAY) ;
"RTN","RGRSBULL",108,0)
 ;Entry point generates a bulletin to the RG CIRN DEMOGRAPHIC
"RTN","RGRSBULL",109,0)
 ;ISSUES mail group about missing required data for a given patient.
"RTN","RGRSBULL",110,0)
 ;
"RTN","RGRSBULL",111,0)
 ;Input:  Required Variables
"RTN","RGRSBULL",112,0)
 ;
"RTN","RGRSBULL",113,0)
 ;  ARRAY  - Array of information regarding missing required data
"RTN","RGRSBULL",114,0)
 ;
"RTN","RGRSBULL",115,0)
 Q:'$D(@ARRAY)
"RTN","RGRSBULL",116,0)
 N RGRSTEXT,INDEX,COUNTER
"RTN","RGRSBULL",117,0)
 S RGRSTEXT(1)="The MPI/PD Package has received a message from:"
"RTN","RGRSBULL",118,0)
 S RGRSTEXT(2)=$$INST^RGRSBUL1(@ARRAY@("SENDING SITE"))
"RTN","RGRSBULL",119,0)
 S RGRSTEXT(3)="This message was missing required data"
"RTN","RGRSBULL",120,0)
 S RGRSTEXT(4)="    "
"RTN","RGRSBULL",121,0)
 S INDEX=0,COUNTER=5
"RTN","RGRSBULL",122,0)
 F  S INDEX=$O(@ARRAY@(INDEX)) Q:INDEX']""  D
"RTN","RGRSBULL",123,0)
 . S RGRSTEXT(COUNTER)="FIELD: "_INDEX_" = "_@ARRAY@(INDEX)
"RTN","RGRSBULL",124,0)
 . S COUNTER=COUNTER+1
"RTN","RGRSBULL",125,0)
 D BULL2("MPI/PD - MISSING DATA","RGRSTEXT(")
"RTN","RGRSBULL",126,0)
 Q
"RTN","RGRSBULL",127,0)
 ;
"RTN","RGRSBULL",128,0)
MTCHBULL(DFN,ARRAY,NAME,SSN,ICN,CMOR,BULSUB) ;
"RTN","RGRSBULL",129,0)
 ;Entry point generates a bulletin to the RG CIRN DEMOGRAPHIC
"RTN","RGRSBULL",130,0)
 ;ISSUES mail group about differences in the data of a given patient.
"RTN","RGRSBULL",131,0)
 ;
"RTN","RGRSBULL",132,0)
 ;Input:  Required Variables
"RTN","RGRSBULL",133,0)
 ;
"RTN","RGRSBULL",134,0)
 ;   DFN   - IEN in the PATIENT file (#2)
"RTN","RGRSBULL",135,0)
 ;  ARRAY  - Array of data containing sending sites station number
"RTN","RGRSBULL",136,0)
 ;   NAME  - Patient's Name
"RTN","RGRSBULL",137,0)
 ;   SSN   - Patient's SSN
"RTN","RGRSBULL",138,0)
 ;   ICN   - Patient's ICN (Integration Control Number) 
"RTN","RGRSBULL",139,0)
 ;   CMOR  - Patient's CMOR (Coordinating Master of Record)
"RTN","RGRSBULL",140,0)
 ;  BULSUB - Bulletin subject (Ex. ICN)
"RTN","RGRSBULL",141,0)
 ;
"RTN","RGRSBULL",142,0)
 Q:$G(DFN)=""!($G(ARRAY)="")
"RTN","RGRSBULL",143,0)
 N LOCDATA,RGRSTEXT,INDEX,COUNTER
"RTN","RGRSBULL",144,0)
 S RGRSTEXT(1)="The MPI/PD Package has received a message from:"
"RTN","RGRSBULL",145,0)
 S RGRSTEXT(2)=$$INST^RGRSBUL1(@ARRAY@("SENDING SITE"))
"RTN","RGRSBULL",146,0)
 S RGRSTEXT(3)="This message contains "_$P(BULSUB,"(")_" data that is"
"RTN","RGRSBULL",147,0)
 S RGRSTEXT(4)="inconsistent with your site's data."
"RTN","RGRSBULL",148,0)
 S RGRSTEXT(5)="           "
"RTN","RGRSBULL",149,0)
 S RGRSTEXT(6)="=> "_$P($$SITE^VASITE(),"^",2)_" local data:"
"RTN","RGRSBULL",150,0)
 S RGRSTEXT(7)="NAME: "_NAME
"RTN","RGRSBULL",151,0)
 S RGRSTEXT(8)="SSN: "_SSN
"RTN","RGRSBULL",152,0)
 S RGRSTEXT(9)="ICN: "_ICN
"RTN","RGRSBULL",153,0)
 S RGRSTEXT(10)="CMOR: "_CMOR
"RTN","RGRSBULL",154,0)
 S RGRSTEXT(11)="--------------------------------------------------------"
"RTN","RGRSBULL",155,0)
 S RGRSTEXT(12)="=> "_$P($$INST^RGRSBUL1(@ARRAY@("SENDING SITE"))," -->")_" data:"
"RTN","RGRSBULL",156,0)
 S COUNTER=12
"RTN","RGRSBULL",157,0)
 F INDEX="NAME","SSN","ICN","CMOR" D
"RTN","RGRSBULL",158,0)
 . I $D(@ARRAY@(INDEX)) S COUNTER=COUNTER+1,RGRSTEXT(COUNTER)=INDEX_": "_@ARRAY@(INDEX)
"RTN","RGRSBULL",159,0)
 D BULL2("MPI/PD - INCONSISTENT "_BULSUB,"RGRSTEXT(")
"RTN","RGRSBULL",160,0)
 Q
"RTN","RGRSPARM")
0^18^B460879
"RTN","RGRSPARM",1,0)
RGRSPARM ;ALB/RJS-EDIT SEND/STOP/SUSPEND PARAMETER ;2/10/97
"RTN","RGRSPARM",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**19**;30 Apr 99
"RTN","RGRSPARM",3,0)
 ;
"RTN","RGRSPARM",4,0)
 ;Reference to $$SEND^VAFHUTL supported by IA #2624
"RTN","RGRSPARM",5,0)
EN ;
"RTN","RGRSPARM",6,0)
 ;This routine is used to edit the STOP MPI/PD MESSAGING field (#16)
"RTN","RGRSPARM",7,0)
 ;in the CIRN SITE PARAMETER file (#991.8), to STOP/SEND/SUSPEND
"RTN","RGRSPARM",8,0)
 ;messages.
"RTN","RGRSPARM",9,0)
 ;
"RTN","RGRSPARM",10,0)
 N DA,DIE,DR,RGMAS,X
"RTN","RGRSPARM",11,0)
 S DA=$O(^RGSITE(991.8,0))
"RTN","RGRSPARM",12,0)
 I +DA'>0 Q
"RTN","RGRSPARM",13,0)
 S DR="16",DIE="991.8"
"RTN","RGRSPARM",14,0)
 D ^DIE
"RTN","RGRSPARM",15,0)
 S RGMAS=$P($$SEND^VAFHUTL,"^",2)
"RTN","RGRSPARM",16,0)
 I X'=RGMAS W !?5,"Does not match MAS parameter."
"RTN","RGRSPARM",17,0)
 E  W !?5,"In sync with MAS parameter."
"RTN","RGRSPARM",18,0)
 Q
"RTN","RGRSUTIL")
0^10^B7937481
"RTN","RGRSUTIL",1,0)
RGRSUTIL ;ALB/RJS-MPI/PD UTILITIES ;03/12/96
"RTN","RGRSUTIL",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3,19**;30 Apr 99
"RTN","RGRSUTIL",3,0)
EXCEPT ;This entry point identifies exception notifications
"RTN","RGRSUTIL",4,0)
 ;Check the mail group RG CIRN DEMOGRAPHIC ISSUES to see if 
"RTN","RGRSUTIL",5,0)
 ;this user should be notified.
"RTN","RGRSUTIL",6,0)
 N DIC,X,Y
"RTN","RGRSUTIL",7,0)
 S DIC="3.8",DIC(0)="Z",X="RG CIRN DEMOGRAPHIC ISSUES"
"RTN","RGRSUTIL",8,0)
 D ^DIC
"RTN","RGRSUTIL",9,0)
 S RGMG=$P($G(Y),"^",1) Q:RGMG<1
"RTN","RGRSUTIL",10,0)
 D GETS^DIQ(3.8,+RGMG_",","2*","I","RGAR") S RGNOTFY=0,RGX="" F  S RGX=$O(RGAR(3.81,RGX)) Q:RGX=""  I RGAR(3.81,RGX,.01,"I")=$G(DUZ) S RGNOTFY=1
"RTN","RGRSUTIL",11,0)
 ;identify existence of unresolved exceptions
"RTN","RGRSUTIL",12,0)
 I RGNOTFY=1 S RGNOTFY=$$CUREX^RGEX01()
"RTN","RGRSUTIL",13,0)
 I RGNOTFY=1 D SET^XUS1A("!Use the MPI/PD Exception Handling option on the Message Exception Menu to resolve exceptions.")
"RTN","RGRSUTIL",14,0)
 K RGTYPE,RGMG,RGNOTFY,RGAR,RGX,RGEX
"RTN","RGRSUTIL",15,0)
 Q
"RTN","RGRSUTIL",16,0)
SEG(SEGMENT,PIECE,CODE) ;Return segment from RGDC array and kill node
"RTN","RGRSUTIL",17,0)
 N RGNODE,RGDATA,RGDONE,RGC K RGDONE
"RTN","RGRSUTIL",18,0)
 I '$D(RGC) S RGC=$E(HL("ECH"))
"RTN","RGRSUTIL",19,0)
 S RGNODE=0
"RTN","RGRSUTIL",20,0)
 F  S RGNODE=$O(RGDC(RGNODE)) Q:RGNODE=""!($D(RGDONE))  D
"RTN","RGRSUTIL",21,0)
 .S RGDATA=RGDC(RGNODE)
"RTN","RGRSUTIL",22,0)
 .I ($P(RGDATA,HL("FS"),1)=SEGMENT)&($P($P(RGDATA,HL("FS"),PIECE),RGC,1)=CODE) S RGDONE=1 K RGDC(RGNODE)
"RTN","RGRSUTIL",23,0)
 Q:$D(RGDONE) $G(RGDATA)
"RTN","RGRSUTIL",24,0)
 Q ""
"RTN","RGRSUTIL",25,0)
SEG1(SEGMENT,PIECE,CODE) ;Return segment from RGDC array 
"RTN","RGRSUTIL",26,0)
 N RGNODE,RGDATA,RGDONE,RGC K RGDONE
"RTN","RGRSUTIL",27,0)
 I '$D(RGC) S RGC=$E(HL("ECH"))
"RTN","RGRSUTIL",28,0)
 S RGNODE=0
"RTN","RGRSUTIL",29,0)
 F  S RGNODE=$O(RGDC(RGNODE)) Q:RGNODE=""!($D(RGDONE))  D
"RTN","RGRSUTIL",30,0)
 .S RGDATA=RGDC(RGNODE)
"RTN","RGRSUTIL",31,0)
 .I ($P(RGDATA,HL("FS"),1)=SEGMENT)&($P($P(RGDATA,HL("FS"),PIECE),RGC,1)=CODE) S RGDONE=1
"RTN","RGRSUTIL",32,0)
 Q:$D(RGDONE) $G(RGDATA)
"RTN","RGRSUTIL",33,0)
 Q ""
"RTN","RGRSUTIL",34,0)
ERROR(CODE) ;**THIS ENTRY POINT IS NO LONGER USED**
"RTN","RGRSUTIL",35,0)
 Q ""
"RTN","RGRSUTIL",36,0)
INITIZE ;Initialize RGDC array with incoming message
"RTN","RGRSUTIL",37,0)
 N I,J,X
"RTN","RGRSUTIL",38,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0  S RGDC(I)=HLNODE,J=0  F  S J=$O(HLNODE(J)) Q:'J  S RGDC(I,J)=HLNODE(J)
"RTN","RGRSUTIL",39,0)
 Q
"RTN","RGRSUTIL",40,0)
SSNDFN(SSN) ;Input ssn output DFN
"RTN","RGRSUTIL",41,0)
 N DFN
"RTN","RGRSUTIL",42,0)
 Q:$G(SSN)="" -1
"RTN","RGRSUTIL",43,0)
 S DFN=$O(^DPT("SSN",+SSN,0))
"RTN","RGRSUTIL",44,0)
 Q:$L(DFN) DFN
"RTN","RGRSUTIL",45,0)
 S DFN=$O(^DPT("SSN",SSN,0))
"RTN","RGRSUTIL",46,0)
 Q:$L(DFN) DFN
"RTN","RGRSUTIL",47,0)
 Q -1
"RTN","RGRSUTIL",48,0)
 ;
"RTN","RGRSUTIL",49,0)
LINE() ; Return a dashed line.       
"RTN","RGRSUTIL",50,0)
 Q $TR($J("",80)," ","-")
"RTN","RGRSUTIL",51,0)
 ;
"RTN","RGRSUTIL",52,0)
PAUSE() ; Pause for CRT output.
"RTN","RGRSUTIL",53,0)
 ;  Input:   IOST, IOSL
"RTN","RGRSUTIL",54,0)
 ;  Output:  0  --  Continue to display output
"RTN","RGRSUTIL",55,0)
 ;           1  --  Quit
"RTN","RGRSUTIL",56,0)
 Q:$E(IOST,1,2)'["C-" 0
"RTN","RGRSUTIL",57,0)
 N DIR,DIRUT,DTOUT,DUOUT,RGJ
"RTN","RGRSUTIL",58,0)
 F RGJ=$Y:1:(IOSL-4) W !
"RTN","RGRSUTIL",59,0)
 S DIR(0)="E" D ^DIR
"RTN","RGRSUTIL",60,0)
 Q $D(DIRUT)!($D(DUOUT))
"RTN","RGRSUTIL",61,0)
 ;
"RTN","RGRSUTIL",62,0)
DIAG(X) ; Return a string for diagnoses.
"RTN","RGRSUTIL",63,0)
 ;  Input:   X  -  Code for type of diagnosis (Primary, etc.)
"RTN","RGRSUTIL",64,0)
 ;  Output:  Descriptive string, i.e., "Primary", etc.
"RTN","RGRSUTIL",65,0)
 Q $S($G(X)="":"Unknown",X="A":"Additional",X="P":"Primary",X="S":"Secondary",X="T":"Tertiary",1:"Unknown")
"RTN","RGRSUTIL",66,0)
 ;
"RTN","RGRSUTIL",67,0)
ORD(X) ; Return a string for orders.
"RTN","RGRSUTIL",68,0)
 ;  Input:   X  -  Code for type of order (Lab, etc.)
"RTN","RGRSUTIL",69,0)
 ;  Output:  Descriptive string, i.e., "Lab", etc.
"RTN","RGRSUTIL",70,0)
 Q $S($G(X)="":"Unknown",X="L":"Lab",X="R":"Radiology",1:"Unknown")
"RTN","RGRSUTIL",71,0)
 ;
"RTN","RGRSUTIL",72,0)
UPDTFLD(FILE,FLD,ANS1,ANS2) ; Returns the correct field answer
"RTN","RGRSUTIL",73,0)
 ;DLR - Added to prevent the overwriting the last four in ZIP with null
"RTN","RGRSUTIL",74,0)
 ; input:  FILE  - file number (ex. 2 PATIENT)
"RTN","RGRSUTIL",75,0)
 ;         FLD  -  field number (ex. .1112 ZIP+4)
"RTN","RGRSUTIL",76,0)
 ;         ANS1 -  existing field value
"RTN","RGRSUTIL",77,0)
 ;         ANS2 -  incoming value
"RTN","RGRSUTIL",78,0)
 I (FILE=2)&(FLD=.1112) I $E(ANS1,1,5)=$E(ANS2,1,5),($L(ANS2)=5) Q ANS1
"RTN","RGRSUTIL",79,0)
 Q ANS2
"RTN","RGRSUTIL",80,0)
 ;
"RTN","RGRSUTIL",81,0)
SSNINT(SSN) ;
"RTN","RGRSUTIL",82,0)
 Q:$G(SSN)="" ""
"RTN","RGRSUTIL",83,0)
 Q $TRANSLATE(SSN,"-","")
"RTN","RGSYSTAT")
0^19^B35876021
"RTN","RGSYSTAT",1,0)
RGSYSTAT ;BAY/ALS-MPI/PD STATUS DISPLAY ;01/05/01
"RTN","RGSYSTAT",2,0)
 ;;1.0;CLINCAL INFO RESOURCE NETWORK;**16,19**;30 Apr 99
"RTN","RGSYSTAT",3,0)
 ;Reference to ^DGCN(391.98,"AST" supported by IA #3303
"RTN","RGSYSTAT",4,0)
 ;Reference to ^DGCN(391.984 supported by IA #3304
"RTN","RGSYSTAT",5,0)
 ;Reference to ^MPIF(984.9 supported by IA #3298
"RTN","RGSYSTAT",6,0)
 ;Reference to OPTSTAT^XUTMOPT supported by IA #1472
"RTN","RGSYSTAT",7,0)
 ;Reference to ^DPT("ACMORS", ^DPT("AICN", and ^DPT("AICNL" supported by IA #2070
"RTN","RGSYSTAT",8,0)
 ;Reference to ^VAT(391.71 supported by IA #3422
"RTN","RGSYSTAT",9,0)
EN ;
"RTN","RGSYSTAT",10,0)
 ; Count exceptions on hand
"RTN","RGSYSTAT",11,0)
EXC ;
"RTN","RGSYSTAT",12,0)
 W @IOF,"Exception Handler Entries:",!,"--------------------------"
"RTN","RGSYSTAT",13,0)
 S CNT=0,EXCTYP="",NTYP="",TOTL=0,PCNT=0
"RTN","RGSYSTAT",14,0)
 N STAT,DFN,ICN
"RTN","RGSYSTAT",15,0)
 S HOME=$$SITE^VASITE()
"RTN","RGSYSTAT",16,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGSYSTAT",17,0)
 . I (EXCTYP=209)!(EXCTYP=227)!((EXCTYP>212)&(EXCTYP<219)) D
"RTN","RGSYSTAT",18,0)
 .. I (EXCTYP'=NTYP)&(CNT>0) D
"RTN","RGSYSTAT",19,0)
 ... S ETEXT=$P($G(^RGHL7(991.11,NTYP,10)),"^",1)
"RTN","RGSYSTAT",20,0)
 ... W !,$E(ETEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",21,0)
 .. S IEN=0,NTYP=EXCTYP
"RTN","RGSYSTAT",22,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",23,0)
 ... S IEN2=0
"RTN","RGSYSTAT",24,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGSYSTAT",25,0)
 .... S STAT=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5) I STAT<1 D
"RTN","RGSYSTAT",26,0)
 ..... S DFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'DFN
"RTN","RGSYSTAT",27,0)
 ..... S ^XTMP("RGEXC",DFN)=DFN
"RTN","RGSYSTAT",28,0)
 ..... S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGSYSTAT",29,0)
 ..... I $E(ICN,1,3)=$E($P(HOME,"^",3),1,3)!(ICN<0)!((EXCTYP<218)&(EXCTYP>214)) D
"RTN","RGSYSTAT",30,0)
 ...... S CNT=CNT+1
"RTN","RGSYSTAT",31,0)
 I CNT>0 D
"RTN","RGSYSTAT",32,0)
 .S ETEXT=$P($G(^RGHL7(991.11,NTYP,10)),"^",1)
"RTN","RGSYSTAT",33,0)
 .W !,$E(ETEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT
"RTN","RGSYSTAT",34,0)
 I TOTL=0 W !,"There are no entries in the Exception Handler."
"RTN","RGSYSTAT",35,0)
 I TOTL>0 D
"RTN","RGSYSTAT",36,0)
 . W !!,"Total number of exceptions: ",?55,$J(TOTL,6)
"RTN","RGSYSTAT",37,0)
 . S PDFN=""
"RTN","RGSYSTAT",38,0)
 . F  S PDFN=$O(^XTMP("RGEXC",PDFN)) Q:'PDFN  D
"RTN","RGSYSTAT",39,0)
 .. S PCNT=PCNT+1
"RTN","RGSYSTAT",40,0)
 . W !,"Total unique patient exceptions: ",?55,$J(PCNT,6)
"RTN","RGSYSTAT",41,0)
 S STDT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",1)
"RTN","RGSYSTAT",42,0)
 I $D(^RGSITE(991.8,1,"EXCPRG")) D
"RTN","RGSYSTAT",43,0)
 . S STDT=$$FMTE^XLFDT(STDT,1)
"RTN","RGSYSTAT",44,0)
 . W !!,"The MPI/PD Exception Purge process last ran "_STDT_"."
"RTN","RGSYSTAT",45,0)
 K CNT,EXCTYP,NTYP,ETEXT,TOTL,IEN,IEN2,HOME,PCNT,^XTMP("RGEXC"),PDFN,STDT
"RTN","RGSYSTAT",46,0)
 I $Y>21 D QUIT
"RTN","RGSYSTAT",47,0)
 ;Q
"RTN","RGSYSTAT",48,0)
PDR ;Count entries in Patient Data Review
"RTN","RGSYSTAT",49,0)
 W !!,"Patient Data Review Entries:",!,"----------------------------"
"RTN","RGSYSTAT",50,0)
 S CNT=0,PDRTYP="",NTYP="",TOTL=0
"RTN","RGSYSTAT",51,0)
 F  S PDRTYP=$O(^DGCN(391.98,"AST",PDRTYP)) Q:'PDRTYP  D
"RTN","RGSYSTAT",52,0)
 . I (PDRTYP'=NTYP)&(CNT>0) D
"RTN","RGSYSTAT",53,0)
 .. S DIC="^DGCN(391.984,",DR=".01",DA=NTYP,DIQ(0)="E",DIQ="PDRSTAT"
"RTN","RGSYSTAT",54,0)
 .. D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","RGSYSTAT",55,0)
 .. S PTEXT=$G(PDRSTAT(391.984,NTYP,.01,"E"))
"RTN","RGSYSTAT",56,0)
 .. W !,$E(PTEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",57,0)
 . I (PDRTYP=1)!(PDRTYP=2)!(PDRTYP=5) D
"RTN","RGSYSTAT",58,0)
 .. S IEN=0,NTYP=PDRTYP
"RTN","RGSYSTAT",59,0)
 .. F  S IEN=$O(^DGCN(391.98,"AST",PDRTYP,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",60,0)
 ... S CNT=CNT+1
"RTN","RGSYSTAT",61,0)
 I CNT>0 D
"RTN","RGSYSTAT",62,0)
 . S DIC="^DGCN(391.984,",DR=".01",DA=NTYP,DIQ(0)="E",DIQ="PDRSTAT"
"RTN","RGSYSTAT",63,0)
 . D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","RGSYSTAT",64,0)
 . S PTEXT=$G(PDRSTAT(391.984,NTYP,.01,"E"))
"RTN","RGSYSTAT",65,0)
 .W !,$E(PTEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT
"RTN","RGSYSTAT",66,0)
 I TOTL=0 W !,"There are no entries in Patient Data Review."
"RTN","RGSYSTAT",67,0)
 K CNT,PDRTYP,NTYP,TOTL,IEN,PTEXT,PDRSTAT
"RTN","RGSYSTAT",68,0)
 ;Q
"RTN","RGSYSTAT",69,0)
 I $Y>20 D QUIT
"RTN","RGSYSTAT",70,0)
 ;
"RTN","RGSYSTAT",71,0)
CMOR ;CMOR Requests Status
"RTN","RGSYSTAT",72,0)
 W !!,"CMOR Requests Status:",!,"---------------------"
"RTN","RGSYSTAT",73,0)
 S CNT=0,STAT="",NSTAT="",TOTL=0
"RTN","RGSYSTAT",74,0)
 F  S STAT=$O(^MPIF(984.9,"AC",STAT)) Q:'STAT  D
"RTN","RGSYSTAT",75,0)
 . I (STAT'=NSTAT)&(CNT>0) D
"RTN","RGSYSTAT",76,0)
 .. S TEXT=$$EXTERNAL^DILFD(984.9,.06,,NSTAT)
"RTN","RGSYSTAT",77,0)
 .. W !,$E(TEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",78,0)
 . S IEN=0,NSTAT=STAT
"RTN","RGSYSTAT",79,0)
 . F  S IEN=$O(^MPIF(984.9,"AC",STAT,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",80,0)
 .. S CNT=CNT+1 S TOTL=TOTL+CNT
"RTN","RGSYSTAT",81,0)
 I CNT>0 S TEXT=$$EXTERNAL^DILFD(984.9,.06,,NSTAT) W !,$E(TEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",82,0)
 I TOTL=0 W !,"There are no outstanding CMOR Requests."
"RTN","RGSYSTAT",83,0)
 K CNT,STAT,NSTAT,TEXT,TOTL,IEN
"RTN","RGSYSTAT",84,0)
 I $Y>20 D QUIT
"RTN","RGSYSTAT",85,0)
 ;
"RTN","RGSYSTAT",86,0)
VAFC ;VAFC BATCH UPDATE background job
"RTN","RGSYSTAT",87,0)
 D OPTSTAT^XUTMOPT("VAFC BATCH UPDATE",.OPTSCH)
"RTN","RGSYSTAT",88,0)
 S TIME=$P($G(OPTSCH(1)),"^",2)
"RTN","RGSYSTAT",89,0)
 I 'TIME W !!,"The VAFC BATCH UPDATE background job is NOT currently scheduled." G AXMIT
"RTN","RGSYSTAT",90,0)
 S TIME=$$FMTE^XLFDT(TIME)
"RTN","RGSYSTAT",91,0)
 W !!,"The VAFC BATCH UPDATE background job is scheduled for "_TIME_"."
"RTN","RGSYSTAT",92,0)
 I $Y>20 D QUIT
"RTN","RGSYSTAT",93,0)
AXMIT K TIME,OPTSCH
"RTN","RGSYSTAT",94,0)
 S CNT=0,IEN=0 F  S IEN=$O(^VAT(391.71,"AXMIT",4,IEN)) Q:'IEN  S CNT=CNT+1
"RTN","RGSYSTAT",95,0)
 W !?3,"(Total DATA UPDATES waiting to be processed = "_CNT_")"
"RTN","RGSYSTAT",96,0)
 I $Y>20 D QUIT
"RTN","RGSYSTAT",97,0)
 S CNT=0,IEN=0 F  S IEN=$O(^VAT(391.71,"AXMIT",5,IEN)) Q:'IEN  S CNT=CNT+1
"RTN","RGSYSTAT",98,0)
 W !?3,"(Total TREATING FACILITY UPDATES waiting to be processed = "_CNT_")"
"RTN","RGSYSTAT",99,0)
 I $Y>20 D QUIT
"RTN","RGSYSTAT",100,0)
 ;
"RTN","RGSYSTAT",101,0)
 ;MPIF LOC/MIS ICN RES background job
"RTN","RGSYSTAT",102,0)
MPIF D OPTSTAT^XUTMOPT("MPIF LOC/MIS ICN RES",.OPTSCH)
"RTN","RGSYSTAT",103,0)
 S TIME=$P($G(OPTSCH(1)),"^",2)
"RTN","RGSYSTAT",104,0)
 I 'TIME W !,"The MPIF LOC/MIS ICN RES background job is NOT currently scheduled." G EQUE
"RTN","RGSYSTAT",105,0)
 S TIME=$$FMTE^XLFDT(TIME)
"RTN","RGSYSTAT",106,0)
 W !,"The MPIF LOC/MIS ICN RES background job is scheduled for "_TIME_"."
"RTN","RGSYSTAT",107,0)
 I $Y>21 D QUIT
"RTN","RGSYSTAT",108,0)
 K TIME,OPTSCH
"RTN","RGSYSTAT",109,0)
 ;
"RTN","RGSYSTAT",110,0)
EQUE ;MPI/PD Event Queue currently running?
"RTN","RGSYSTAT",111,0)
 N SUB1,SUB2
"RTN","RGSYSTAT",112,0)
 L +^RGEQ("MAIN"):0 E  D  G CMSG
"RTN","RGSYSTAT",113,0)
 . W !,"MPI/PD Event Queue processor is currently RUNNING."
"RTN","RGSYSTAT",114,0)
 W !,"MPI/PD Event Queue processor is currently NOT RUNNING."
"RTN","RGSYSTAT",115,0)
 L -^RGEQ("MAIN")
"RTN","RGSYSTAT",116,0)
 ;Count number of entries in event queue
"RTN","RGSYSTAT",117,0)
 S SUB1="",CNT=0 F  S SUB1=$O(^RGEQ(SUB1)) Q:SUB1=""  D
"RTN","RGSYSTAT",118,0)
 .S SUB2="" F  S SUB2=$O(^RGEQ(SUB1,SUB2)) Q:SUB2=""  S CNT=CNT+1
"RTN","RGSYSTAT",119,0)
 W !?3,"(Total entries in Event Queue waiting to be processed = "_CNT_")"
"RTN","RGSYSTAT",120,0)
 I $Y>21 D QUIT
"RTN","RGSYSTAT",121,0)
 ;
"RTN","RGSYSTAT",122,0)
CMSG ;Stop MPI/PD Messaging field
"RTN","RGSYSTAT",123,0)
 S SEND=$P($G(^RGSITE(991.8,1,1)),"^",6)
"RTN","RGSYSTAT",124,0)
 S CUR=$S(SEND=1:"SEND MESSAGES",SEND=0:"STOP MESSAGES",SEND=2:"SUSPEND MESSAGES",1:"NULL")
"RTN","RGSYSTAT",125,0)
 W !,"STOP MPI/PD MESSAGING currently set to "_CUR_"."
"RTN","RGSYSTAT",126,0)
 K CUR,SEND
"RTN","RGSYSTAT",127,0)
 ;Q
"RTN","RGSYSTAT",128,0)
AUDIT ;Check to see if .01 field in patient file has auditing turned on
"RTN","RGSYSTAT",129,0)
 D FIELD^DID(2,.01,"","AUDIT","PATAUD")
"RTN","RGSYSTAT",130,0)
 S PATAUD=$G(PATAUD("AUDIT"))
"RTN","RGSYSTAT",131,0)
 W !,"Audit on NAME (#.01) field of PATIENT (#2) file set to "_PATAUD
"RTN","RGSYSTAT",132,0)
 K PATAUD
"RTN","RGSYSTAT",133,0)
 I $Y>21 D QUIT
"RTN","RGSYSTAT",134,0)
CNT ;Count number of patients with a score, counts Nat'l ICNs, counts local ICNs.
"RTN","RGSYSTAT",135,0)
 S SC=0,CNT=0
"RTN","RGSYSTAT",136,0)
 F  S SC=$O(^DPT("ACMORS",SC)) Q:'SC  D
"RTN","RGSYSTAT",137,0)
 .S DFN=0
"RTN","RGSYSTAT",138,0)
 .F  S DFN=$O(^DPT("ACMORS",SC,DFN)) Q:'DFN  D
"RTN","RGSYSTAT",139,0)
 ..S CNT=CNT+1
"RTN","RGSYSTAT",140,0)
 W !!,"Current total number of Patients with CMOR Scores = ",CNT
"RTN","RGSYSTAT",141,0)
 K %,SC,CNT
"RTN","RGSYSTAT",142,0)
 S HOME=$P($$SITE^VASITE(),"^",3)
"RTN","RGSYSTAT",143,0)
 S ICN=0,CNT=0
"RTN","RGSYSTAT",144,0)
 F  S ICN=$O(^DPT("AICN",ICN)) Q:'ICN  D
"RTN","RGSYSTAT",145,0)
 .Q:$E(ICN,1,3)=HOME
"RTN","RGSYSTAT",146,0)
 .S CNT=CNT+1
"RTN","RGSYSTAT",147,0)
 W !,"Current total number of National ICNs = ",CNT
"RTN","RGSYSTAT",148,0)
 S ICN=0,CNT=0
"RTN","RGSYSTAT",149,0)
 F  S ICN=$O(^DPT("AICNL",1,ICN)) Q:'ICN  S CNT=CNT+1
"RTN","RGSYSTAT",150,0)
 W !,"Current total number of Local ICNs = ",CNT
"RTN","RGSYSTAT",151,0)
 K CNT,DFN,ICN
"RTN","RGSYSTAT",152,0)
QUIT S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGSYSTAT",153,0)
 .S SS=21-$Y F JJ=1:1:SS W !
"RTN","RGSYSTAT",154,0)
 S $Y=0
"RTN","RGSYSTAT",155,0)
 K JJ,SS
"RTN","RGSYSTAT",156,0)
 Q
"RTN","RGVCCMR1")
0^11^B46513866
"RTN","RGVCCMR1",1,0)
RGVCCMR1 ;GAI/TMG-CMOR ACTIVITY SCORE GENERATOR (PART 1) ;01/15/98
"RTN","RGVCCMR1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**2,19**;30 Apr 99
"RTN","RGVCCMR1",3,0)
 ;Reference to ^DPT("ACMORS" and ^DPT(0 supported by IA #2070
"RTN","RGVCCMR1",4,0)
 ;
"RTN","RGVCCMR1",5,0)
EN ;  this routine contains entry points to start/restart the batch cmor
"RTN","RGVCCMR1",6,0)
 ;  score initialization, flag a running
"RTN","RGVCCMR1",7,0)
 ;  initialization to stop, calculate and file an activity score for an
"RTN","RGVCCMR1",8,0)
 ;  individual patient, and display the status of the cmor initialization 
"RTN","RGVCCMR1",9,0)
START ; entry point to start or restart the cmor activity score initialization
"RTN","RGVCCMR1",10,0)
 N RGY
"RTN","RGVCCMR1",11,0)
 S U="^"
"RTN","RGVCCMR1",12,0)
 S NODE=$G(^RGSITE(991.8,1,"CMOR"))
"RTN","RGVCCMR1",13,0)
 I '(+$P(NODE,U)) D  G QUIT
"RTN","RGVCCMR1",14,0)
 .W !!,"This is the initial run of the CMOR patient activity score generator."
"RTN","RGVCCMR1",15,0)
 .S RUNTYPE="I",RGDFN=0 D TASK
"RTN","RGVCCMR1",16,0)
 S STATUS=$P(NODE,U,7)
"RTN","RGVCCMR1",17,0)
 I STATUS="R" D  I RUN G QUIT
"RTN","RGVCCMR1",18,0)
 .S RUN=0
"RTN","RGVCCMR1",19,0)
 .S ZTSK=+$P(NODE,U,9)
"RTN","RGVCCMR1",20,0)
 .I 'ZTSK D INT Q
"RTN","RGVCCMR1",21,0)
 .D STAT^%ZTLOAD
"RTN","RGVCCMR1",22,0)
 .I ZTSK(1)=0!(ZTSK(1)=3)!(ZTSK(1)=4) D INT Q
"RTN","RGVCCMR1",23,0)
 .I ZTSK(1)=1 W !!,"CMOR Patient Activity Score queued task #",ZTSK,!,"is waiting to run.  Do not start another job at this time." S RUN=1 Q
"RTN","RGVCCMR1",24,0)
 .I ZTSK(1)=2 W !!,"CMOR Patient Activity Score queued task #",ZTSK,!,"is currently running.  Do not start another job at this time." S RUN=1 Q
"RTN","RGVCCMR1",25,0)
 .I ZTSK(1)=5 W !!,"CMOR Patient Activity Score queued task #",ZTSK,!,"was interrupted abnormally, possibly from a system error." D INT
"RTN","RGVCCMR1",26,0)
 I STATUS="SN" D
"RTN","RGVCCMR1",27,0)
 .S STOPDT=$P(NODE,U,3) I +STOPDT D
"RTN","RGVCCMR1",28,0)
 ..S STOPDT=$$FMTE^XLFDT(STOPDT,"1P")
"RTN","RGVCCMR1",29,0)
 ..W !!,"The CMOR patient activity score generator",!,"completed successfully on ",STOPDT,"."
"RTN","RGVCCMR1",30,0)
 .W !
"RTN","RGVCCMR1",31,0)
 .S DIR(0)="Y",DIR("A")="Would you like to reset all patient activity scores",DIR("B")="N" D ^DIR S RGY=Y
"RTN","RGVCCMR1",32,0)
 .I RGY=1 S DIR(0)="Y",DIR("A")="This will take quite a while.  Are you sure",DIR("B")="N" D ^DIR S RGY=Y
"RTN","RGVCCMR1",33,0)
 .I RGY=1 S RUNTYPE="R",RGDFN=0 D TASK
"RTN","RGVCCMR1",34,0)
 I STATUS="SM"!(STATUS="INT") D 
"RTN","RGVCCMR1",35,0)
 .S STOPDT=$P(NODE,U,3) D
"RTN","RGVCCMR1",36,0)
 ..I +STOPDT S STOPDT=$$FMTE^XLFDT(STOPDT,"1P")
"RTN","RGVCCMR1",37,0)
 ..W !!,"The CMOR patient activity score generator was "
"RTN","RGVCCMR1",38,0)
 ..W:STATUS="SM" ! W $S(STATUS="SM":"STOPPED MANUALLY",1:"INTERRUPTED ABNORMALLY.") I STATUS="SM" W " on ",STOPDT,"."
"RTN","RGVCCMR1",39,0)
 .I +$P(NODE,U) D
"RTN","RGVCCMR1",40,0)
 ..S LASTDFN=$P(NODE,U),LASTPT=$P($G(^DPT(+LASTDFN,0)),U),LASTSSN=$P(^(0),U,9)
"RTN","RGVCCMR1",41,0)
 ..W !,"The last patient processed was ",LASTPT,"   SSN: ",LASTSSN,!?31,"[RECORD# ",LASTDFN,"]"
"RTN","RGVCCMR1",42,0)
 .W ! S DIR(0)="Y",DIR("A")="Would you like to start with this patient and continue",DIR("B")="N" D ^DIR S RGY=Y
"RTN","RGVCCMR1",43,0)
 .W ! I RGY=1 D
"RTN","RGVCCMR1",44,0)
 ..S DIR(0)="Y",DIR("A")="This will take quite a while.  Are you sure"
"RTN","RGVCCMR1",45,0)
 ..S DIR("B")="N" D ^DIR I Y=1 S RUNTYPE="RS",RGDFN=LASTDFN D TASK
"RTN","RGVCCMR1",46,0)
 .W ! I RGY=0 D
"RTN","RGVCCMR1",47,0)
 ..S DIR(0)="Y",DIR("A")="Would you like to rerun the CMOR calculation for all patients"
"RTN","RGVCCMR1",48,0)
 ..S DIR("B")="N" D ^DIR I Y=1 D
"RTN","RGVCCMR1",49,0)
 ...W ! S DIR(0)="Y",DIR("A")="This will take quite a while.  Are you sure",DIR("B")="N" D ^DIR I Y=1 S RUNTYPE="RS",RGDFN=0 D TASK
"RTN","RGVCCMR1",50,0)
 G QUIT
"RTN","RGVCCMR1",51,0)
STOP ;  entry point to flag a running cmor score initialization to stop
"RTN","RGVCCMR1",52,0)
 S U="^"
"RTN","RGVCCMR1",53,0)
 S NODE=$G(^RGSITE(991.8,1,"CMOR"))
"RTN","RGVCCMR1",54,0)
 I $P(NODE,U,7)'="R" W !,"The CMOR activity score generation is NOT running." G QUIT
"RTN","RGVCCMR1",55,0)
 W !,"This option will stop the CMOR patient activity score generation"
"RTN","RGVCCMR1",56,0)
 W !,"after it has completed calculating and filing the score for the current"
"RTN","RGVCCMR1",57,0)
 W !,"patient."
"RTN","RGVCCMR1",58,0)
 W ! S DIR("A")="Are you sure you want to do this",DIR("B")="N",DIR(0)="Y" D ^DIR K DIR S RGY=Y
"RTN","RGVCCMR1",59,0)
 W ! S DIR("A")="Stop patient activity score generation after the current patient",DIR("B")="N",DIR(0)="Y" D ^DIR S RGY=Y
"RTN","RGVCCMR1",60,0)
 ;I RGY=1 S DA=1,DIE="^RGSITE(991.8,",DR="21////Y;24////SM" D ^DIE
"RTN","RGVCCMR1",61,0)
 I RGY=1 D
"RTN","RGVCCMR1",62,0)
 .S $P(^RGSITE(991.8,1,"CMOR"),U,4)="Y"
"RTN","RGVCCMR1",63,0)
 .W !!,"CMOR patient activity generation is flagged to stop after"
"RTN","RGVCCMR1",64,0)
 .W !,"it has completed the current patient.  This may take a short time."
"RTN","RGVCCMR1",65,0)
 .W !,"Please check the status later."
"RTN","RGVCCMR1",66,0)
 G QUIT
"RTN","RGVCCMR1",67,0)
INDIV ;  entry point to allow a cmor score for an individual patient to be
"RTN","RGVCCMR1",68,0)
 ;  calculated and filed
"RTN","RGVCCMR1",69,0)
 N MNODE
"RTN","RGVCCMR1",70,0)
 S U="^"
"RTN","RGVCCMR1",71,0)
 S DIC="^DPT(",DIC(0)="AEQMNZ" D ^DIC K DIC Q:+Y<0  S RGDFN=+Y
"RTN","RGVCCMR1",72,0)
 S PTNAM=$P(Y(0),"^"),SSN=$P(Y(0),"^",9),FILE=1
"RTN","RGVCCMR1",73,0)
 S MNODE=$$MPINODE^MPIFAPI(RGDFN)
"RTN","RGVCCMR1",74,0)
 I $P($G(MNODE),U,7)'="" D
"RTN","RGVCCMR1",75,0)
 .S FILE=0
"RTN","RGVCCMR1",76,0)
 .S SCOREDT=$$FMTE^XLFDT($P(MNODE,U,7),"1P")
"RTN","RGVCCMR1",77,0)
 .S CURSCORE=$P(MNODE,U,6) W !!,"This patient has an existing CMOR score of ",+CURSCORE," calculated on ",SCOREDT,".",!
"RTN","RGVCCMR1",78,0)
 .S DIR(0)="Y",DIR("A")="Do you want to calculate and file a new score for this patient",DIR("B")="NO" D ^DIR I Y=1 S FILE=1
"RTN","RGVCCMR1",79,0)
 I FILE=1 D
"RTN","RGVCCMR1",80,0)
 .W !!,"Working.  Please standby..." S FILEFLG=0 D CALCI^RGVCCMR2
"RTN","RGVCCMR1",81,0)
 .I 'FILEFLG W !!,"No Patient Activity in the Past Three Years - No Score Filed!" Q
"RTN","RGVCCMR1",82,0)
 .W !!,"CMOR Activity Score: ",SCORE," filed for ",PTNAM,"  SSN: ",SSN,"."
"RTN","RGVCCMR1",83,0)
 G QUIT
"RTN","RGVCCMR1",84,0)
DISPLAY ;  displays the status of the background cmor score initialization
"RTN","RGVCCMR1",85,0)
 W !,"The CMOR Activity Score Generator",!
"RTN","RGVCCMR1",86,0)
 ;count number of CMOR scores"
"RTN","RGVCCMR1",87,0)
 W !,"..one moment please...",!
"RTN","RGVCCMR1",88,0)
 S (SCORE,CNT)=0
"RTN","RGVCCMR1",89,0)
 F  S SCORE=$O(^DPT("ACMORS",SCORE)) Q:'SCORE  D
"RTN","RGVCCMR1",90,0)
 .S RGDFN=0 F  S RGDFN=$O(^DPT("ACMORS",SCORE,RGDFN)) Q:'RGDFN  D
"RTN","RGVCCMR1",91,0)
 ..S CNT=CNT+1
"RTN","RGVCCMR1",92,0)
 W !,"There are ",$P(^DPT(0),U,4)," records in your PATIENT file."
"RTN","RGVCCMR1",93,0)
 W !,"The last record number is ",$P(^DPT(0),U,3),"."
"RTN","RGVCCMR1",94,0)
 I $P($G(^RGSITE(991.8,1,"CMOR")),U)'="" D CHKSTAT
"RTN","RGVCCMR1",95,0)
 I $P($G(^RGSITE(991.8,1,"CMOR")),U)="" D
"RTN","RGVCCMR1",96,0)
 . W !,"The CMOR Calculation has NEVER been run on your system."
"RTN","RGVCCMR1",97,0)
 G QUIT
"RTN","RGVCCMR1",98,0)
CHKSTAT S NODE=$G(^RGSITE(991.8,1,"CMOR"))
"RTN","RGVCCMR1",99,0)
 S PTNAM="-Unknown-",SSN="---"
"RTN","RGVCCMR1",100,0)
 S RGDFN=+NODE I RGDFN,$D(^DPT(RGDFN,0)) D
"RTN","RGVCCMR1",101,0)
 .S PTNAM=$P(^(0),U),SSN=$P(^(0),U,9)
"RTN","RGVCCMR1",102,0)
 S OSTARTED="UNSPECIFIED" I $P(NODE,U,2)'="" D
"RTN","RGVCCMR1",103,0)
 .S OSTARTED=$$FMTE^XLFDT($P(NODE,U,2),"1P")
"RTN","RGVCCMR1",104,0)
 S OSTOPPED="UNSPECIFIED" I $P(NODE,U,3)'="" D
"RTN","RGVCCMR1",105,0)
 .S OSTOPPED=$$FMTE^XLFDT($P(NODE,U,3),"1P")
"RTN","RGVCCMR1",106,0)
 S ORESTART=$G(^XTMP("RGVCCMR","@@@@","RESTARTED"))
"RTN","RGVCCMR1",107,0)
 I +ORESTART S ORESTART=$$FMTE^XLFDT(ORESTART,"1P")
"RTN","RGVCCMR1",108,0)
 S ODFNCT=""
"RTN","RGVCCMR1",109,0)
 I $D(^XTMP("RGVCCMR","@@@@","DFNCOUNT")) S ODFNCT=^XTMP("RGVCCMR","@@@@","DFNCOUNT")
"RTN","RGVCCMR1",110,0)
STATUS S ST=$P(NODE,U,7)
"RTN","RGVCCMR1",111,0)
 ;if status is RUNNING, check to see if task errored out
"RTN","RGVCCMR1",112,0)
 I ST="R" D
"RTN","RGVCCMR1",113,0)
 .S ZTSK=$P(NODE,U,9) I $D(ZTSK) D
"RTN","RGVCCMR1",114,0)
 ..D STAT^%ZTLOAD
"RTN","RGVCCMR1",115,0)
 ..I ZTSK(1)=5 D INT S ST="INT"
"RTN","RGVCCMR1",116,0)
 S STATUS=$S(ST="R":"RUNNING.",ST="SM":"STOPPED MANUALLY",ST="SN":"SUCCESSFULLY COMPLETED",ST="INT":"INTERRUPTED ABNORMALLY.",1:"- NO STATUS LISTED -")
"RTN","RGVCCMR1",117,0)
 ;S PERCOMP=((ODFNCT/$P(^DPT(0),U,4))*100),PERCOMP=$P(PERCOMP,".")_"."_$E($P(PERCOMP,".",2),1,2)
"RTN","RGVCCMR1",118,0)
 W !,"Last Patient Processed: ",PTNAM,"   SSN: ",SSN,"   [RECORD# ",RGDFN,"]"
"RTN","RGVCCMR1",119,0)
 W !!,"The CMOR score initialization last started on ",OSTARTED,"."
"RTN","RGVCCMR1",120,0)
 I ORESTART]"" W !,"Job was restarted on ",ORESTART,"."
"RTN","RGVCCMR1",121,0)
 I +ODFNCT W !,ODFNCT," patient records have been processed."
"RTN","RGVCCMR1",122,0)
 W !,"Status: ",STATUS I ST'="R"&(ST'="INT") W " on ",OSTOPPED,"."
"RTN","RGVCCMR1",123,0)
 W !,"CMOR Score Count: ",CNT
"RTN","RGVCCMR1",124,0)
 ;
"RTN","RGVCCMR1",125,0)
 G QUIT
"RTN","RGVCCMR1",126,0)
 ;
"RTN","RGVCCMR1",127,0)
INT ;Set status to INTERRUPTED for abnormally stopped jobs
"RTN","RGVCCMR1",128,0)
 S $P(^RGSITE(991.8,1,"CMOR"),"^",7)="INT"
"RTN","RGVCCMR1",129,0)
 S STATUS="INT"
"RTN","RGVCCMR1",130,0)
 Q
"RTN","RGVCCMR1",131,0)
TASK S ZTIO="",ZTRTN="^RGVCCMR2",ZTDESC="BACKGROUND CMOR SCORE CALCULATOR"
"RTN","RGVCCMR1",132,0)
 S (ZTSAVE("RUNTYPE"),ZTSAVE("RGDFN"))=""
"RTN","RGVCCMR1",133,0)
 ; change ztsave("*")="" to specific variables when done
"RTN","RGVCCMR1",134,0)
 D ^%ZTLOAD
"RTN","RGVCCMR1",135,0)
 I $D(ZTSK) W "   Task#, ",ZTSK," queued" S $P(^RGSITE(991.8,1,"CMOR"),U,9)=ZTSK
"RTN","RGVCCMR1",136,0)
 D ^%ZISC
"RTN","RGVCCMR1",137,0)
 Q
"RTN","RGVCCMR1",138,0)
QUIT K RGDFN,DIC,DIR,FILE,LASTDFN,LASTPT,LASTSSN,ODFNCT,ORESTART,OSTARTED
"RTN","RGVCCMR1",139,0)
 K OSTOPPED,PTNAM,RUNTYPE,SCORE,SSN,ST,STATUS,X,Y,%DT,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","RGVCCMR1",140,0)
 K CURSCORE,SCOREDT,NODE,STOPDT,FILEFLG,SCORE,CNT,RGDFN,RUN
"RTN","RGVCCMR1",141,0)
 ;kill variables leftover from the CALI^RGVCCMR2 entry point
"RTN","RGVCCMR1",142,0)
 K LRCODE,DA,DR,DIE,APSTDT,LRCODE,LRSCORE,NXPC,NXPTF,NXSCE,NXRX,NXXR,PCCODE,PSOVER,PTF0,RXDT,STDT,XRCODE,XRSTDT,YR
"RTN","RGVCCMR1",143,0)
 Q
"RTN","RGVCCMR2")
0^27^B37667624
"RTN","RGVCCMR2",1,0)
RGVCCMR2 ;GAI/TMG,ALS-CMOR ACTIVITY SCORE GENERATOR (PART 2) ;10-6-1997
"RTN","RGVCCMR2",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**19**;30 Apr 99
"RTN","RGVCCMR2",3,0)
 ;Reference to ^DGPT( and ^DGPT("B" supported by IA #92
"RTN","RGVCCMR2",4,0)
 ;Reference to ^DIC(40.7 supported by IA #2501
"RTN","RGVCCMR2",5,0)
 ;Reference to ^LR( supported by IA #2466
"RTN","RGVCCMR2",6,0)
 ;Reference to ^PS(55 supported by IA #2470
"RTN","RGVCCMR2",7,0)
 ;Reference to ^PSRX( supported by IA #2471
"RTN","RGVCCMR2",8,0)
 ;Reference to ^RARPT( and ^RARPT("C" supported by IA #2442
"RTN","RGVCCMR2",9,0)
 ;Reference to ^SCE( and ^SCE("C" supported by IA #2443
"RTN","RGVCCMR2",10,0)
 ;
"RTN","RGVCCMR2",11,0)
EN S U="^"
"RTN","RGVCCMR2",12,0)
 I '$D(RUNTYPE) I '$D(RGDFN) S RUNTYPE="I",RGDFN=0 K ^XTMP("RGVCCMR")
"RTN","RGVCCMR2",13,0)
 I RUNTYPE'="I",($G(RGDFN)'=0) D NOW^%DTC S ^XTMP("RGVCCMR","@@@@","RESTARTED")=% G BATCH
"RTN","RGVCCMR2",14,0)
 I RUNTYPE="I"!($G(RGDFN)=0) K ^XTMP("RGVCCMR")
"RTN","RGVCCMR2",15,0)
 D NOW^%DTC
"RTN","RGVCCMR2",16,0)
 ;set purge date of XTMP = 30 days
"RTN","RGVCCMR2",17,0)
 S ^XTMP("RGVCCMR",0)=$$FMADD^XLFDT($$NOW^XLFDT,30)_U_$$NOW^XLFDT_U_"CMOR CALCULATION DATA"
"RTN","RGVCCMR2",18,0)
BATCH I '$D(DT) S X="T",%DT="" D ^%DT S DT=Y
"RTN","RGVCCMR2",19,0)
 D NOW^%DTC
"RTN","RGVCCMR2",20,0)
 I $G(RGDFN)=0!(RUNTYPE="I") S ^XTMP("RGVCCMR","@@@@","STARTED")=%,$P(^RGSITE(991.8,1,"CMOR"),U,2)=%
"RTN","RGVCCMR2",21,0)
 S $P(^RGSITE(991.8,1,"CMOR"),U,8)=RUNTYPE
"RTN","RGVCCMR2",22,0)
 S:'$D(^XTMP("RGVCCMR","@@@@","BIG")) ^XTMP("RGVCCMR","@@@@","BIG")=0
"RTN","RGVCCMR2",23,0)
ALLPTS S ^XTMP("RGVCCMR","@@@@","SECTION")="ALL"
"RTN","RGVCCMR2",24,0)
 S $P(^RGSITE(991.8,1,"CMOR"),U,7)="R"
"RTN","RGVCCMR2",25,0)
 S:'$D(^XTMP("RGVCCMR","@@@@","DFNCOUNT")) ^XTMP("RGVCCMR","@@@@","DFNCOUNT")=0
"RTN","RGVCCMR2",26,0)
 F  S RGDFN=$O(^DPT(+RGDFN)) Q:+RGDFN'>0  I $D(^DPT(+RGDFN,0)) S DPT0=^(0) G:$P($G(^RGSITE(991.8,1,"CMOR")),U,4)="Y" STOP D
"RTN","RGVCCMR2",27,0)
 .S QUIT=0 D CKPT I QUIT Q
"RTN","RGVCCMR2",28,0)
 .S FILEFLG=0
"RTN","RGVCCMR2",29,0)
 .D CALCI S ^XTMP("RGVCCMR","@@@@","CURR DFN")=RGDFN S $P(^RGSITE(991.8,1,"CMOR"),U)=RGDFN
"RTN","RGVCCMR2",30,0)
 .I FILEFLG=1 D
"RTN","RGVCCMR2",31,0)
 ..I SCORE>^XTMP("RGVCCMR","@@@@","BIG") S ^XTMP("RGVCCMR","@@@@","BIG")=SCORE
"RTN","RGVCCMR2",32,0)
 ..S RATING=SCORE\100 S:'$D(^XTMP("RGVCCMR","@@@@","RATING",RATING)) ^XTMP("RGVCCMR","@@@@","RATING",RATING)=0
"RTN","RGVCCMR2",33,0)
 ..S ^XTMP("RGVCCMR","@@@@","RATING",RATING)=^XTMP("RGVCCMR","@@@@","RATING",RATING)+1
"RTN","RGVCCMR2",34,0)
STOP I $P($G(^RGSITE(991.8,1,"CMOR")),U,4)="Y" S $P(^RGSITE(991.8,1,"CMOR"),U,7)="SM",$P(^RGSITE(991.8,1,"CMOR"),U,4)=""
"RTN","RGVCCMR2",35,0)
 E  S $P(^RGSITE(991.8,1,"CMOR"),U,7)="SN"
"RTN","RGVCCMR2",36,0)
 D NOW^%DTC
"RTN","RGVCCMR2",37,0)
 S ^XTMP("RGVCCMR","@@@@","STOPPED")=%
"RTN","RGVCCMR2",38,0)
 S $P(^RGSITE(991.8,1,"CMOR"),U,3)=%
"RTN","RGVCCMR2",39,0)
 D COUNT,KILL
"RTN","RGVCCMR2",40,0)
 Q
"RTN","RGVCCMR2",41,0)
CALC ;API ENTRY POINT DBIA #2710
"RTN","RGVCCMR2",42,0)
 ;VARIABLES:  Input
"RTN","RGVCCMR2",43,0)
 ;              RGDFN - IEN of the patient in the Patient
"RTN","RGVCCMR2",44,0)
 ;                      file (#2).  RGDFN is not passed as a
"RTN","RGVCCMR2",45,0)
 ;                      formal parameter, but is defined before
"RTN","RGVCCMR2",46,0)
 ;                      calling CALC.
"RTN","RGVCCMR2",47,0)
 ;
"RTN","RGVCCMR2",48,0)
 ;            Output:  None  (result sets score into PATIENT (#2))
"RTN","RGVCCMR2",49,0)
 ;
"RTN","RGVCCMR2",50,0)
 N SCORE,X,STDT,%DT,APSTDT,YR,NXPC,PCCODE,XRCODE,LRCODE,NXSCE,SCED,VISIT,NXPTF,PTFD,ADM,NXXR,RARPTD,XRAY,NXRX,PSOVER,RXDT,RXIEN,RX,RGRXST,LRSCORE,LRDFN,LRSTDT,TEST,NXLR,FILEFLG,DIE,DR,DA
"RTN","RGVCCMR2",51,0)
CALCI S SCORE=0,X="T-1065",%DT="" D ^%DT S STDT=Y,X="T",%DT="" D ^%DT
"RTN","RGVCCMR2",52,0)
 S APSTDT=Y,YR=$E(DT,1,3)
"RTN","RGVCCMR2",53,0)
 I '+$$ACTIVE^RGRSWPT(RGDFN) D  Q
"RTN","RGVCCMR2",54,0)
 .I '$$AUTH^FBUTL(RGDFN,"2961001") Q
"RTN","RGVCCMR2",55,0)
 .D FILE
"RTN","RGVCCMR2",56,0)
 I '$D(DT) D NOW^%DTC S DT=%\1
"RTN","RGVCCMR2",57,0)
OPT ;  outpatient visit section
"RTN","RGVCCMR2",58,0)
 ;  each visit valued as follows:    current fy = 30 pts.
"RTN","RGVCCMR2",59,0)
 ;                                           fy - 1 = 20 pts
"RTN","RGVCCMR2",60,0)
 ;                                           fy - 2 = 10 pts
"RTN","RGVCCMR2",61,0)
 ;  primary care visits (based on the PCCODE array) = 50 pts each in
"RTN","RGVCCMR2",62,0)
 ;  addition to the visit value
"RTN","RGVCCMR2",63,0)
 ;  XRCODE = ien of xray stop code  LRCODE = ien of lab stop code 
"RTN","RGVCCMR2",64,0)
 ;  encounters with a stop code for lab or xray are not counted to
"RTN","RGVCCMR2",65,0)
 ;  avoid duplication since lab & xray are counted separately 
"RTN","RGVCCMR2",66,0)
 ;  in the XR & LR sections
"RTN","RGVCCMR2",67,0)
 K PCCODE S NXPC=0 F  S NXPC=$O(^RGSITE(991.8,1,"PC",NXPC)) Q:+NXPC'>0  I $D(^DIC(40.7,+$P($G(^RGSITE(991.8,1,"PC",NXPC,0)),U),0)) S PCCODE($P($G(^RGSITE(991.8,1,"PC",NXPC,0)),U))=""
"RTN","RGVCCMR2",68,0)
 I '$D(PCCODE) S PCCODE=""
"RTN","RGVCCMR2",69,0)
 S XRCODE=0 I $D(^DIC(40.7,"C",105)) S XRCODE=$O(^DIC(40.7,"C",105,0))
"RTN","RGVCCMR2",70,0)
 S LRCODE=0 I $D(^DIC(40.7,"C",108)) S LRCODE=$O(^DIC(40.7,"C",108,0))
"RTN","RGVCCMR2",71,0)
 K VISIT S NXSCE=0 F  S NXSCE=$O(^SCE("C",+RGDFN,NXSCE)) Q:+NXSCE'>0  I $D(^SCE(+NXSCE,0)) S SCE0=^(0) D
"RTN","RGVCCMR2",72,0)
 .I $P(SCE0,U,3)=XRCODE!($P(SCE0,U,3))=LRCODE Q
"RTN","RGVCCMR2",73,0)
 .I $P(SCE0,U)>STDT I '$D(VISIT(+$P(SCE0,U)\1)) S VISIT(+$P(SCE0,U)\1)=30+(($E($P(SCE0,U),1,3)-YR)*10) S SCORE=SCORE+30+(($E($P(SCE0,U),1,3)-YR)*10)
"RTN","RGVCCMR2",74,0)
 .I $D(PCCODE(+$P(SCE0,U,3))) I '$D(VISIT($P(SCE0,U)\1)) S VISIT(+$P(SCE0,U)\1)=50 S SCORE=SCORE+50
"RTN","RGVCCMR2",75,0)
 .I $D(PCCODE(+$P(SCE0,U,3))) I $D(VISIT($P(SCE0,U)\1)) S VISIT(+$P(SCE0,U)\1)=VISIT(+$P(SCE0,U)\1)+50 S SCORE=SCORE+50
"RTN","RGVCCMR2",76,0)
ADM ;  past admission section
"RTN","RGVCCMR2",77,0)
 ;  each admission valued as follows:  current fy = 50 pts
"RTN","RGVCCMR2",78,0)
 ;                                             fy - 1 = 40 pts
"RTN","RGVCCMR2",79,0)
 ;                                             fy - 2 = 30 pts
"RTN","RGVCCMR2",80,0)
 K ADM S NXPTF=0 F  S NXPTF=$O(^DGPT("B",+RGDFN,NXPTF)) Q:+NXPTF'>0  I $D(^DGPT(NXPTF,0)) S PTF0=^(0) D
"RTN","RGVCCMR2",81,0)
 .I $P(PTF0,U,2)>STDT I '$D(ADM($P(PTF0,U,2)\1)) S ADM(+$P(PTF0,U,2)\1)=50+(($E($P(PTF0,U,2),1,3)-YR)*10) S SCORE=SCORE+50+(($E($P(PTF0,U,2),1,3)-YR)*10)
"RTN","RGVCCMR2",82,0)
 .I $D(ADM(+$P(PTF0,U,2)\1)) I $O(^DGPT(+NXPTF,"S",0)) S ADM($P(PTF0,U,2)\1)=ADM($P(PTF0,U,2)\1)+10 S SCORE=SCORE+10
"RTN","RGVCCMR2",83,0)
XRAY ; radiololgy section - each radiology exam valued at 20 pts
"RTN","RGVCCMR2",84,0)
 ;
"RTN","RGVCCMR2",85,0)
 S X="T-365",%DT="" D ^%DT S XRSTDT=Y
"RTN","RGVCCMR2",86,0)
 K XRAY S NXXR=0 F  S NXXR=$O(^RARPT("C",+RGDFN,NXXR)) Q:+NXXR'>0  I $D(^RARPT(+NXXR,0)),$P(^(0),U,3)>XRSTDT S RARPT0=^(0) D
"RTN","RGVCCMR2",87,0)
 .I '$D(XRAY($P(RARPT0,U,3)\1)) S XRAY($P(RARPT0,U,3)\1)=20 S SCORE=SCORE+20
"RTN","RGVCCMR2",88,0)
RX ;  prescription section 
"RTN","RGVCCMR2",89,0)
 ;
"RTN","RGVCCMR2",90,0)
 ;  currently active prescriptions valued at 20 pts
"RTN","RGVCCMR2",91,0)
 K RX,^TMP("PSOR",$J) S NXRX=0
"RTN","RGVCCMR2",92,0)
 ;check for version of Outpatient Pharmacy used
"RTN","RGVCCMR2",93,0)
 ;if under 7.0 use direct global access, else use api PSOORDER
"RTN","RGVCCMR2",94,0)
 S PSOVER=$$VERSION^XPDUTL("PSO")
"RTN","RGVCCMR2",95,0)
 S RXDT=$$FMADD^XLFDT(DT,-121) F  S RXDT=$O(^PS(55,RGDFN,"P","A",RXDT)) Q:RXDT'>0  S RXIEN=0 F  S RXIEN=$O(^PS(55,RGDFN,"P","A",RXDT,RXIEN)) Q:RXIEN'>0  D
"RTN","RGVCCMR2",96,0)
 . I PSOVER<7 DO  ;
"RTN","RGVCCMR2",97,0)
 .. I $D(^PSRX(+RXIEN,0)),$P(^(0),U,15)=0 S RX(NXRX)=20 S SCORE=SCORE+20
"RTN","RGVCCMR2",98,0)
 . I PSOVER'<7 D EN^PSOORDER(RGDFN,RXIEN) I $D(^TMP("PSOR",$J,RXIEN)) D
"RTN","RGVCCMR2",99,0)
 .. S RGRXST=$P($P(^TMP("PSOR",$J,RXIEN,0),"^",4),";") I RGRXST="A"!(RGRXST="S")!(RGRXST="H") S RX(NXRX)=20 K RGRXST S SCORE=SCORE+20
"RTN","RGVCCMR2",100,0)
 K ^TMP("PSOR",$J)
"RTN","RGVCCMR2",101,0)
LR ;  laboratory section
"RTN","RGVCCMR2",102,0)
 ;  "CH" = chemistry; "CY" = cytotology; "EM" = electron microscopy;
"RTN","RGVCCMR2",103,0)
 ;  "MI = microbiology; "SP" = surgical pathology
"RTN","RGVCCMR2",104,0)
 ; each lab test done in the past year is valued at 10 points
"RTN","RGVCCMR2",105,0)
 ;
"RTN","RGVCCMR2",106,0)
 S LRSCORE=0 I $D(^DPT(+RGDFN,"LR")) S LRDFN=^DPT(+RGDFN,"LR") I $D(^LR(+LRDFN)) S X="T-365",%DT="" D ^%DT S LRSTDT=Y-.0001 F TEST="CH","CY","EM","MI","SP" D
"RTN","RGVCCMR2",107,0)
 .S NXLR=0 F  S NXLR=$O(^LR(+LRDFN,TEST,NXLR)) Q:+NXLR'>0  I $D(^(NXLR,0)),$P(^(0),U)>LRSTDT S LRSCORE=LRSCORE+10
"RTN","RGVCCMR2",108,0)
 S SCORE=SCORE+LRSCORE
"RTN","RGVCCMR2",109,0)
FILE ;  file score & date calculated in appropriate locations in the
"RTN","RGVCCMR2",110,0)
 ;  PATIENT file 'MPI' node
"RTN","RGVCCMR2",111,0)
 ;  scores are filed even if zero
"RTN","RGVCCMR2",112,0)
 ;  FILEFLG variable used to illiminate unnecessary statistcal processing
"RTN","RGVCCMR2",113,0)
 S FILEFLG=1
"RTN","RGVCCMR2",114,0)
 S DIE="^DPT(",DA=RGDFN,DR="991.06///^S X=SCORE;991.07///TODAY" D ^DIE
"RTN","RGVCCMR2",115,0)
 I $D(^XTMP("RGVCCMR","@@@@","DFNCOUNT")) S ^XTMP("RGVCCMR","@@@@","DFNCOUNT")=^XTMP("RGVCCMR","@@@@","DFNCOUNT")+1
"RTN","RGVCCMR2",116,0)
 Q
"RTN","RGVCCMR2",117,0)
KILL K ADM,APSTDT,DA,DIE,DIC,RGDFN,DGS0,DPT0,DR,LRCODE,LRDFN,LRSCORE,LRSTDT
"RTN","RGVCCMR2",118,0)
 K NUM,NXLR,NXPTF,NXRX,NXSCE,NXXR,PCCODE,PTF0,PTNAM
"RTN","RGVCCMR2",119,0)
 K QUIT,RARPT0,RATE,RATING,RX,RXDT,RXIEN,SCE0,SCORE,SSN,STDT,TEST,VISIT,X
"RTN","RGVCCMR2",120,0)
 K XRAY,XRCODE,XRSTDT,Y,YR,%,%DT,NXPC,PSOVER,RUNTYPE,FILEFLG
"RTN","RGVCCMR2",121,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGVCCMR2",122,0)
 Q
"RTN","RGVCCMR2",123,0)
CKPT S PTNAM=$P(DPT0,U),SSN=$P(DPT0,U,9)
"RTN","RGVCCMR2",124,0)
 I PTNAM?1"ZZ".E S QUIT=1
"RTN","RGVCCMR2",125,0)
 I SSN?1"00000".E S QUIT=1
"RTN","RGVCCMR2",126,0)
 Q
"RTN","RGVCCMR2",127,0)
COUNT S ^XTMP("RGVCCMR","@@@@","RATING","TCOUNT")=0,RATE="" F  S RATE=$O(^XTMP("RGVCCMR","@@@@","RATING",RATE)) Q:RATE'?.N  D
"RTN","RGVCCMR2",128,0)
 .;.W !,RATE
"RTN","RGVCCMR2",129,0)
 .S ^XTMP("RGVCCMR","@@@@","RATING","TCOUNT")=^XTMP("RGVCCMR","@@@@","RATING","TCOUNT")+^XTMP("RGVCCMR","@@@@","RATING",RATE)
"RTN","RGVCCMR2",130,0)
 Q
"VER")
8.0^22.0
"^DD",991.8,991.8,0)
FIELD^^42^47
"^DD",991.8,991.8,0,"DDA")
N
"^DD",991.8,991.8,0,"DT")
3010925
"^DD",991.8,991.8,0,"IX","B",991.8,.01)

"^DD",991.8,991.8,0,"NM","CIRN SITE PARAMETER")

"^DD",991.8,991.8,0,"VRPK")
CLINICAL INFO RESOURCE NETWORK
"^DD",991.8,991.8,.01,0)
PARAMETER NUMBER^RNJ1,0^^0;1^K:+X'=X!(X>1)!(X<1)!(X?.E1"."1.N) X
"^DD",991.8,991.8,.01,1,0)
^.1
"^DD",991.8,991.8,.01,1,1,0)
991.8^B
"^DD",991.8,991.8,.01,1,1,1)
S ^RGSITE(991.8,"B",$E(X,1,30),DA)=""
"^DD",991.8,991.8,.01,1,1,2)
K ^RGSITE(991.8,"B",$E(X,1,30),DA)
"^DD",991.8,991.8,.01,3)
Type a number between 1 and 1, 0 Decimal Digits
"^DD",991.8,991.8,.01,21,0)
^^3^3^3010703^
"^DD",991.8,991.8,.01,21,1,0)
Number assigned to given site parameter entry.  Entry number 1 is the
"^DD",991.8,991.8,.01,21,2,0)
only entry that should exist in this file.  MPI/PD does not support
"^DD",991.8,991.8,.01,21,3,0)
multiple site parameter entries for a single station.
"^DD",991.8,991.8,.01,"DT")
3010703
"^DD",991.8,991.8,.02,0)
CMOR REQUEST CHANGE^RS^0:MANUAL;1:AUTOMATIC;^0;2^Q
"^DD",991.8,991.8,.02,3)
Enter a '0' if the CMOR information will be manually reviewed or a '1' if it will automatically approved.
"^DD",991.8,991.8,.02,21,0)
^^3^3^3010703^
"^DD",991.8,991.8,.02,21,1,0)
Based on this field setting, any Coordinating Master of Record (CMOR)
"^DD",991.8,991.8,.02,21,2,0)
change request received from another station can either be manually
"^DD",991.8,991.8,.02,21,3,0)
reviewed or automatically approved.
"^DD",991.8,991.8,.02,"DT")
3010703
"^DD",991.8,991.8,.03,0)
NEW REQUEST MAILGROUP^P3.8'^XMB(3.8,^0;3^Q
"^DD",991.8,991.8,.03,3)
Enter a Mailgroup that will receive new CMOR change requests from other station.
"^DD",991.8,991.8,.03,21,0)
^^3^3^2980922^^^
"^DD",991.8,991.8,.03,21,1,0)
If the CMOR Request Change parameter is set to manual, new CMOR change
"^DD",991.8,991.8,.03,21,2,0)
requests received will notify the mailgroup entered in this field.  This
"^DD",991.8,991.8,.03,21,3,0)
gives a means of prompting someone to review the new request.
"^DD",991.8,991.8,.03,"DT")
2971208
"^DD",991.8,991.8,11,0)
AUTO ACCEPT DEMOGRAPHICS^S^1:AUTO ACCEPT;0:NOT AUTO ACCEPT;^1;1^Q
"^DD",991.8,991.8,11,3)
Enter a '1' to allow automatic updating from non-CMOR sites or a '0' to not allow automatic updating from non-CMOR sites.
"^DD",991.8,991.8,11,21,0)
^^5^5^2990423^^^^
"^DD",991.8,991.8,11,21,1,0)
This field is the parameter that a site would set to determine if data
"^DD",991.8,991.8,11,21,2,0)
coming from another site, that is not the owner of the data, could be 
"^DD",991.8,991.8,11,21,3,0)
automatically uploaded.
"^DD",991.8,991.8,11,21,4,0)
If this field is not set, then the software will assume that all
"^DD",991.8,991.8,11,21,5,0)
incoming data can not be automatically uploaded.
"^DD",991.8,991.8,11,"DT")
2990423
"^DD",991.8,991.8,12,0)
MPI/PD SEEDING COMP DATE/TIME^D^^1;2^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,12,3)
Enter the date/time the MPI/PD seeding process completed.
"^DD",991.8,991.8,12,21,0)
^.001^4^4^3010117^^^
"^DD",991.8,991.8,12,21,1,0)
This field, 'MPI/PD SEEDING COMP DATE/TIME', is used to track the
"^DD",991.8,991.8,12,21,2,0)
date/time our seeding process completed.  This field is used to ensure
"^DD",991.8,991.8,12,21,3,0)
that the seeding process is run once and only once at a facility.  If a
"^DD",991.8,991.8,12,21,4,0)
date is present, our seeding process terminates.
"^DD",991.8,991.8,12,23,0)
^^7^7^3010703^
"^DD",991.8,991.8,12,23,1,0)
This field, 'MPI/PD SEEDING COMP DATE/TIME', is used to track the
"^DD",991.8,991.8,12,23,2,0)
date/time our seeding process completed.  This field is used to ensure
"^DD",991.8,991.8,12,23,3,0)
that the seeding process is run once and only once at a facility.  If a
"^DD",991.8,991.8,12,23,4,0)
date is present, our seeding process terminates.
"^DD",991.8,991.8,12,23,5,0)
 
"^DD",991.8,991.8,12,23,6,0)
This field was added as part of the DG*5.3*261 / RG*1.0*4 bundle
"^DD",991.8,991.8,12,23,7,0)
(MPI/PD-CPRS REMOTE PATIENT DATA VIEWS)
"^DD",991.8,991.8,12,"DT")
3010703
"^DD",991.8,991.8,13,0)
MPI/PD DATA COMPARE COMP DATE^D^^1;3^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,13,3)
Enter the date/time the MPI/PD data comparison process completed.
"^DD",991.8,991.8,13,21,0)
^^4^4^3010118^
"^DD",991.8,991.8,13,21,1,0)
This field, 'MPI/PD DATA COMPARE COMP DATE', is used to track the
"^DD",991.8,991.8,13,21,2,0)
date/time our data comparison process completed.  This field is used to
"^DD",991.8,991.8,13,21,3,0)
ensure that the data comparison process is run once and only once at a
"^DD",991.8,991.8,13,21,4,0)
facility. If a date is present, our data comparison process terminates.
"^DD",991.8,991.8,13,23,0)
^^7^7^3010703^
"^DD",991.8,991.8,13,23,1,0)
This field, 'MPI/PD DATA COMPARE COMP DATE', is used to track the
"^DD",991.8,991.8,13,23,2,0)
date/time our data compare process completed.  This field is used to
"^DD",991.8,991.8,13,23,3,0)
ensure that the data compare process is run once and only once at a
"^DD",991.8,991.8,13,23,4,0)
facility.  If a date is present, our data comparison process terminates.
"^DD",991.8,991.8,13,23,5,0)
 
"^DD",991.8,991.8,13,23,6,0)
This field was added as part of the RG*1.0*14 / RG*1.0*15
"^DD",991.8,991.8,13,23,7,0)
multi-build bundle.  (MPI/PD-CPRS REMOTE PATIENT DATA VIEWS)
"^DD",991.8,991.8,13,"DT")
3010703
"^DD",991.8,991.8,14,0)
MPI/PD DATE LAST TREATED^D^^1;4^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,14,3)
Enter the evaluated date/time the Date Last Treated process was complete.
"^DD",991.8,991.8,14,21,0)
^.001^3^3^3010418^^
"^DD",991.8,991.8,14,21,1,0)
'MPI/PD DATE LAST TREATED' is used to track the completion date/time
"^DD",991.8,991.8,14,21,2,0)
of the Date Last Treated process. This field is used to ensure that this
"^DD",991.8,991.8,14,21,3,0)
Date Last Treated process is run only once at a facility.
"^DD",991.8,991.8,14,23,0)
^.001^8^8^3010418^^
"^DD",991.8,991.8,14,23,1,0)
'MPI/PD DATE LAST TREATED' is used to track the completion date/time of
"^DD",991.8,991.8,14,23,2,0)
the Date Last Treated process. This field is used to ensure that this Date
"^DD",991.8,991.8,14,23,3,0)
Last Treated process is run only once at a facility.
"^DD",991.8,991.8,14,23,4,0)
 
"^DD",991.8,991.8,14,23,5,0)
The RGRSDYN routine had to be modified to handle routing of VistA HL7
"^DD",991.8,991.8,14,23,6,0)
messages that are detached from the ADT/HL7 PIVOT (#391.71) file.  This
"^DD",991.8,991.8,14,23,7,0)
field was added to the CIRN SITE PARAMETER (#991.8) as a data dictionary
"^DD",991.8,991.8,14,23,8,0)
component of patch RG*1.0*17.
"^DD",991.8,991.8,14,"DT")
3010329
"^DD",991.8,991.8,16,0)
STOP MPI/PD MESSAGING^RS^1:SEND MESSAGES;0:STOP MESSAGES;2:SUSPEND MESSAGES;^1;6^Q
"^DD",991.8,991.8,16,3)
Enter a '0' to stop MPI/PD messaging or '1' to start MPI/PD messaging or '2' to suspend MPI/PD messaging.
"^DD",991.8,991.8,16,21,0)
^.001^2^2^3010720^^
"^DD",991.8,991.8,16,21,1,0)
This field will instruct the software to allow MPI/PD messaging, stop it
"^DD",991.8,991.8,16,21,2,0)
or suspend it.
"^DD",991.8,991.8,16,"DT")
3010720
"^DD",991.8,991.8,17,0)
PRIMARY CARE CLINIC STOPS^991.817P^^PC;0
"^DD",991.8,991.8,17,21,0)
^^2^2^2980922^^^
"^DD",991.8,991.8,17,21,1,0)
All primary care Clinic Stops (Decision Support System (DSS) Identifiers).
"^DD",991.8,991.8,17,21,2,0)
Used in CMOR patient activity score calculations.
"^DD",991.8,991.8,18,0)
CMOR LAST PATIENT PROCESSED^P2'^DPT(^CMOR;1^Q
"^DD",991.8,991.8,18,3)
This field is used to identify the last patient processed through the sequential CMOR patient activity score process.
"^DD",991.8,991.8,18,21,0)
^^2^2^2980922^^
"^DD",991.8,991.8,18,21,1,0)
This field keeps track of the last sequential patient processed through
"^DD",991.8,991.8,18,21,2,0)
the CMOR patient activity score calculations process.
"^DD",991.8,991.8,18,"DT")
2970926
"^DD",991.8,991.8,19,0)
CMOR INIT STARTED DATE/TIME^D^^CMOR;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,19,3)
This field contains the initial start date/time of the CMOR score calculations.
"^DD",991.8,991.8,19,21,0)
^^2^2^3010703^
"^DD",991.8,991.8,19,21,1,0)
This field contain the date/time that the Start/Restart CMOR Score 
"^DD",991.8,991.8,19,21,2,0)
Calculation option [RG CMOR START] was first run.
"^DD",991.8,991.8,19,"DT")
3010703
"^DD",991.8,991.8,20,0)
CMOR INIT STOPPED DATE/TIME^D^^CMOR;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,20,3)
This field contains the last time that the CMOR score calculations were stopped either manually or normally.
"^DD",991.8,991.8,20,21,0)
^^2^2^3010703^
"^DD",991.8,991.8,20,21,1,0)
This field contain the date/time that the Stop CMOR Score Calculation
"^DD",991.8,991.8,20,21,2,0)
option [RG CMOR STOP] was last stopped either manually or normally.
"^DD",991.8,991.8,20,"DT")
3010703
"^DD",991.8,991.8,21,0)
CMOR INIT MANUAL STOP^S^Y:YES;^CMOR;4^Q
"^DD",991.8,991.8,21,3)
This field is used to manually stop the CMOR score calculations.
"^DD",991.8,991.8,21,21,0)
^^4^4^3010703^
"^DD",991.8,991.8,21,21,1,0)
This field is used to stop the background task started by the
"^DD",991.8,991.8,21,21,2,0)
Start/Restart CMOR Score Calculation option [RG CMOR START].
"^DD",991.8,991.8,21,21,3,0)
This field is populated by the Stop CMOR Score Calculation option
"^DD",991.8,991.8,21,21,4,0)
[RG CMOR STOP].
"^DD",991.8,991.8,21,"DT")
3010703
"^DD",991.8,991.8,22,0)
CMOR DAILY START TIME^F^^CMOR;5^K:$L(X)>4!($L(X)<4)!'(X?4N) X
"^DD",991.8,991.8,22,1,0)
^.1^^0
"^DD",991.8,991.8,22,3)
Please enter the START TIME in 24 hour format (i.e. 0001 - 2359).
"^DD",991.8,991.8,22,21,0)
^^2^2^2980903^
"^DD",991.8,991.8,22,21,1,0)
This field identifies the daily start time in 24 hour format for the CMOR
"^DD",991.8,991.8,22,21,2,0)
activity score calculations.
"^DD",991.8,991.8,22,"DT")
2970926
"^DD",991.8,991.8,23,0)
CMOR DAILY STOP TIME^F^^CMOR;6^K:$L(X)>4!($L(X)<4)!'(X?4N) X
"^DD",991.8,991.8,23,3)
Please enter the STOP TIME in 24 hour format (i.e. 0001 - 2359).
"^DD",991.8,991.8,23,21,0)
^^2^2^2980903^
"^DD",991.8,991.8,23,21,1,0)
This field identifies the daily stop time in 24 hour format for the CMOR
"^DD",991.8,991.8,23,21,2,0)
activity score calculations.
"^DD",991.8,991.8,23,"DT")
2970926
"^DD",991.8,991.8,24,0)
CMOR INIT STATUS^S^R:RUNNING;SN:SUCCESSFULLY COMPLETED;SM:STOPPED MANUALLY;INT:INTERRUPTED ABNORMALLY;^CMOR;7^Q
"^DD",991.8,991.8,24,3)
This field contains the current status of the CMOR Score Calculation process.
"^DD",991.8,991.8,24,21,0)
^^2^2^3000315^^^
"^DD",991.8,991.8,24,21,1,0)
This field contains the current status of the CMOR Score Calculations
"^DD",991.8,991.8,24,21,2,0)
process.
"^DD",991.8,991.8,24,"DT")
2981105
"^DD",991.8,991.8,25,0)
CMOR RUN TYPE^S^I:INITIAL RUN;R:RESET ALL;RS:RESTART FROM LAST CALCULATED;^CMOR;8^Q
"^DD",991.8,991.8,25,21,0)
^^3^3^3010703^
"^DD",991.8,991.8,25,21,1,0)
This field contains the current type of CMOR Score Calculation run.  
"^DD",991.8,991.8,25,21,2,0)
This field is used by the Start/Restart CMOR Score Calculation option
"^DD",991.8,991.8,25,21,3,0)
[RG CMOR START] to identify a starting point.
"^DD",991.8,991.8,25,"DT")
3010703
"^DD",991.8,991.8,26,0)
CMOR LAST TASK#^NJ9,0^^CMOR;9^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",991.8,991.8,26,3)
This field contains the task number of the CMOR Score Calculation task.
"^DD",991.8,991.8,26,21,0)
^^1^1^2980827^
"^DD",991.8,991.8,26,21,1,0)
This field contains the task number of the CMOR Score Calculation process.
"^DD",991.8,991.8,26,"DT")
2971003
"^DD",991.8,991.8,30,0)
CMOR COMP LAST PATIENT^P2'^DPT(^COMP;1^Q
"^DD",991.8,991.8,30,3)
Patient last processed with CMOR Comparison.
"^DD",991.8,991.8,30,21,0)
^^2^2^2980827^
"^DD",991.8,991.8,30,21,1,0)
This patient was the last processed patient in the CMOR Comparison
"^DD",991.8,991.8,30,21,2,0)
process.
"^DD",991.8,991.8,30,"DT")
2980220
"^DD",991.8,991.8,31,0)
CMOR COMP STARTED DATE/TIME^D^^COMP;2^S %DT="ET" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,31,3)
Date/time this process started to run.
"^DD",991.8,991.8,31,21,0)
^^1^1^2980827^
"^DD",991.8,991.8,31,21,1,0)
This is the date/time the CMOR Comparison process started.
"^DD",991.8,991.8,31,"DT")
2980220
"^DD",991.8,991.8,32,0)
CMOR COMP STOPPED DATE/TIME^D^^COMP;3^S %DT="ET" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,32,3)
Date/time this process was stopped.
"^DD",991.8,991.8,32,21,0)
^^2^2^2980827^^
"^DD",991.8,991.8,32,21,1,0)
When the CMOR Comparison stopped, (either naturally or manually) a time is
"^DD",991.8,991.8,32,21,2,0)
logged in this field for record.
"^DD",991.8,991.8,32,"DT")
2980220
"^DD",991.8,991.8,33,0)
CMOR COMP STATUS^S^R:RUNNING;MS:MANUALLY STOPPED;C:COMPLETED;^COMP;4^Q
"^DD",991.8,991.8,33,3)
Status of CMOR Comparison process.
"^DD",991.8,991.8,33,21,0)
^^1^1^2980827^^
"^DD",991.8,991.8,33,21,1,0)
This is the status of the CMOR Comparison process in your system.
"^DD",991.8,991.8,33,"DT")
2980220
"^DD",991.8,991.8,34,0)
CMOR COMP LAST TASK #^NJ10,0^^COMP;5^K:+X'=X!(X>9999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",991.8,991.8,34,3)
This field contains the task number of the last CMOR Comparison task.
"^DD",991.8,991.8,34,21,0)
^^1^1^2980827^^
"^DD",991.8,991.8,34,21,1,0)
This is the task number that the CMOR Comparison ran on last.
"^DD",991.8,991.8,34,"DT")
2980220
"^DD",991.8,991.8,35,0)
CMOR COMP FLAG^S^Y:YES;N:NO;^COMP;6^Q
"^DD",991.8,991.8,35,3)
Request to stop the compare process.
"^DD",991.8,991.8,35,21,0)
^^1^1^2980827^^
"^DD",991.8,991.8,35,21,1,0)
This flag is for the user to request the CMOR Comparison process to stop. 
"^DD",991.8,991.8,35,"DT")
2980220
"^DD",991.8,991.8,40,0)
EXC PURGE START DATE/TIME^D^^EXCPRG;1^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,40,3)
Date and time MPI/PD Exception Purge last started.
"^DD",991.8,991.8,40,21,0)
^^2^2^3010703^
"^DD",991.8,991.8,40,21,1,0)
This field contains the date and time the MPI/PD Exception Purge was last
"^DD",991.8,991.8,40,21,2,0)
started.
"^DD",991.8,991.8,40,"DT")
3010703
"^DD",991.8,991.8,41,0)
EXC PURGE STOP DATE/TIME^D^^EXCPRG;2^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,41,3)
Date and time MPI/PD Exception Purge last stopped.
"^DD",991.8,991.8,41,21,0)
^^2^2^3010703^
"^DD",991.8,991.8,41,21,1,0)
This field contains the date and time the MPI/PD Exception Purge last
"^DD",991.8,991.8,41,21,2,0)
completed.
"^DD",991.8,991.8,41,"DT")
3010703
"^DD",991.8,991.8,42,0)
EXC PURGE STATUS^S^R:RUNNING;C:COMPLETE;^EXCPRG;3^Q
"^DD",991.8,991.8,42,3)
This field contains the current status of the MPI/PD Exception Purge process.
"^DD",991.8,991.8,42,21,0)
^^2^2^3010703^
"^DD",991.8,991.8,42,21,1,0)
This field contains the current status of the MPI/PD Exception Purge
"^DD",991.8,991.8,42,21,2,0)
process.
"^DD",991.8,991.8,42,"DT")
3010703
"^DD",991.8,991.8,100,0)
REL INIT STATUS^S^R:RUNNING;SN:STOPPED NORMALLY;SM:STOPPED MANUALLY;^PRE;1^Q
"^DD",991.8,991.8,100,3)
This field contain the current status of the patient religion process.
"^DD",991.8,991.8,100,21,0)
^^1^1^2980903^
"^DD",991.8,991.8,100,21,1,0)
This field contains the current status of the religion status process.
"^DD",991.8,991.8,100,"DT")
2971202
"^DD",991.8,991.8,101,0)
REL INIT START^D^^PRE;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,101,3)
This field contains the initial start date/time of the patient religion status process.
"^DD",991.8,991.8,101,21,0)
^^2^2^2980904^^
"^DD",991.8,991.8,101,21,1,0)
This field contains the initial start date/time of the patient religion
"^DD",991.8,991.8,101,21,2,0)
status process.
"^DD",991.8,991.8,101,"DT")
2971202
"^DD",991.8,991.8,102,0)
REL INIT STOP^D^^PRE;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,102,3)
This field is populated with date/time that the religion status process ended.
"^DD",991.8,991.8,102,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,102,21,1,0)
This field contains the date/time that the patient religion status
"^DD",991.8,991.8,102,21,2,0)
process stopped.
"^DD",991.8,991.8,102,"DT")
2971202
"^DD",991.8,991.8,103,0)
REL INIT LAST^P2'^DPT(^PRE;4^Q
"^DD",991.8,991.8,103,3)
This field contains the last patient processed by the religion status process.
"^DD",991.8,991.8,103,21,0)
^^2^2^2980903^
"^DD",991.8,991.8,103,21,1,0)
This field contains the last patient processed by the religion status
"^DD",991.8,991.8,103,21,2,0)
process.
"^DD",991.8,991.8,103,"DT")
2971202
"^DD",991.8,991.8,104,0)
REL INIT USER^P200'^VA(200,^PRE;5^Q
"^DD",991.8,991.8,104,3)
This field identifies the person who ran the initial religion status process.
"^DD",991.8,991.8,104,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,104,21,1,0)
This field contains the person who ran the initial religion status
"^DD",991.8,991.8,104,21,2,0)
process.
"^DD",991.8,991.8,104,"DT")
2971202
"^DD",991.8,991.8,105,0)
MAR INIT STATUS^S^R:RUNNING;SN:STOPPED NORMALLY;SM:STOPPED MANUALLY;^PRE;6^Q
"^DD",991.8,991.8,105,3)
This field is populated with the status of the initial marital status process.
"^DD",991.8,991.8,105,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,105,21,1,0)
This field contains the status of the marital status initialization
"^DD",991.8,991.8,105,21,2,0)
process.
"^DD",991.8,991.8,105,"DT")
2971202
"^DD",991.8,991.8,106,0)
MAR INIT START^D^^PRE;7^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,106,3)
This field is populated with the exact starting date/time of the marital status initialization process.
"^DD",991.8,991.8,106,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,106,21,1,0)
This field contains the starting date/time of the marital status
"^DD",991.8,991.8,106,21,2,0)
initialization process.
"^DD",991.8,991.8,106,"DT")
2971202
"^DD",991.8,991.8,107,0)
MAR INIT STOP^D^^PRE;8^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,107,3)
This field is populated with the date/time that the marital status initialization process stopped.
"^DD",991.8,991.8,107,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,107,21,1,0)
This field contains the date/time that the marital status initialization
"^DD",991.8,991.8,107,21,2,0)
process stopped.
"^DD",991.8,991.8,107,"DT")
2971202
"^DD",991.8,991.8,108,0)
MAR INIT LAST^P2'^DPT(^PRE;9^Q
"^DD",991.8,991.8,108,3)
This field is populated with the patient processed by the marital status process.
"^DD",991.8,991.8,108,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,108,21,1,0)
This field contains the last PATIENT file (#2) entry that was processed by
"^DD",991.8,991.8,108,21,2,0)
the marital status initialization process.
"^DD",991.8,991.8,108,"DT")
2971202
"^DD",991.8,991.8,109,0)
MAR INIT USER^P200'^VA(200,^PRE;10^Q
"^DD",991.8,991.8,109,3)
This field is populated with the user the ran the marital status initialization process.
"^DD",991.8,991.8,109,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,109,21,1,0)
This field contains the user that ran the marital status initialization
"^DD",991.8,991.8,109,21,2,0)
process.
"^DD",991.8,991.8,109,"DT")
2971202
"^DD",991.8,991.8,110,0)
ELIG INIT STATUS^S^R:RUNNING;SN:STOPPED NORMALLY;SM:STOPPED MANUALLY;^PRE1;1^Q
"^DD",991.8,991.8,110,3)
This field is populated with the current status of the patient eligibility process.
"^DD",991.8,991.8,110,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,110,21,1,0)
This field contains the status of the patient eligibility initialization
"^DD",991.8,991.8,110,21,2,0)
process.
"^DD",991.8,991.8,110,"DT")
2971202
"^DD",991.8,991.8,111,0)
ELIG INIT START^D^^PRE1;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,111,3)
This field is populated with the start date/time of the patient eligibility initialization process.
"^DD",991.8,991.8,111,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,111,21,1,0)
This field contains the date/time that the patient eligibility
"^DD",991.8,991.8,111,21,2,0)
initialization process was started.
"^DD",991.8,991.8,111,"DT")
2971202
"^DD",991.8,991.8,112,0)
ELIG INIT STOP^D^^PRE1;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,112,3)
This field is populated with the date/time that the patient eligibility initialization process was stopped.
"^DD",991.8,991.8,112,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,112,21,1,0)
This field contains the date/time that the patient eligibility
"^DD",991.8,991.8,112,21,2,0)
initialization process was stopped.
"^DD",991.8,991.8,112,"DT")
2971202
"^DD",991.8,991.8,113,0)
ELIG INIT LAST^P2'^DPT(^PRE1;4^Q
"^DD",991.8,991.8,113,3)
This field is populated with the last patient processed by the patient eligibility process.
"^DD",991.8,991.8,113,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,113,21,1,0)
This field contains the last PATIENT file (#2) entry processed by the
"^DD",991.8,991.8,113,21,2,0)
patient eligibility initialization process.
"^DD",991.8,991.8,113,"DT")
2971202
"^DD",991.8,991.8,114,0)
ELIG INIT USER^P200'^VA(200,^PRE1;5^Q
"^DD",991.8,991.8,114,3)
This field is populated with the user that ran the patient eligibility process.
"^DD",991.8,991.8,114,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,114,21,1,0)
This field contains the user that ran the patient eligibility
"^DD",991.8,991.8,114,21,2,0)
initialization process.
"^DD",991.8,991.8,114,"DT")
2971202
"^DD",991.8,991.8,115,0)
PSEUDO INIT STATUS^S^R:RUNNING;SN:STOPPED NORMALLY;SM:STOPPED MANUALLY;^PRE1;6^Q
"^DD",991.8,991.8,115,3)
This field is populated with the current status of the Pseudo-SSN process.
"^DD",991.8,991.8,115,21,0)
^^1^1^2980904^
"^DD",991.8,991.8,115,21,1,0)
This field contains the status of the Pseudo-SSN initialization process.
"^DD",991.8,991.8,115,"DT")
2971202
"^DD",991.8,991.8,116,0)
PSEUDO INIT START^D^^PRE1;7^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,116,3)
This field is populated with the date/time that the Pseudo-SSN process was started.
"^DD",991.8,991.8,116,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,116,21,1,0)
This field contains the start date/time of the Pseudo-SSN initialization
"^DD",991.8,991.8,116,21,2,0)
process.
"^DD",991.8,991.8,116,"DT")
2971202
"^DD",991.8,991.8,117,0)
PSEUDO INIT STOP^D^^PRE1;8^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,117,3)
This field is populated with the date/time that the Pseudo-SSN process was stopped.
"^DD",991.8,991.8,117,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,117,21,1,0)
This field contains the date/time that the Pseudo-SSN initialization
"^DD",991.8,991.8,117,21,2,0)
process was stopped.
"^DD",991.8,991.8,117,"DT")
2971202
"^DD",991.8,991.8,118,0)
PSEUDO INIT LAST^P2'^DPT(^PRE1;9^Q
"^DD",991.8,991.8,118,3)
This field is populated with the last patient processed by the Pseudo-SSN process.
"^DD",991.8,991.8,118,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,118,21,1,0)
This field contains the last PATIENT file (#2) entry that was processed by
"^DD",991.8,991.8,118,21,2,0)
the Pseudo-SSN initialization process.
"^DD",991.8,991.8,118,"DT")
2971202
"^DD",991.8,991.8,119,0)
PSEUDO INIT USER^P200'^VA(200,^PRE1;10^Q
"^DD",991.8,991.8,119,3)
This field is populated with the user who ran the Pseudo-SSN process.
"^DD",991.8,991.8,119,21,0)
^^2^2^2980904^
"^DD",991.8,991.8,119,21,1,0)
This field contains the user that ran the Pseudo-SSN initialization
"^DD",991.8,991.8,119,21,2,0)
process.
"^DD",991.8,991.8,119,"DT")
2971202
"^DD",991.8,991.817,0)
PRIMARY CARE CLINIC STOPS SUB-FIELD^^2^3
"^DD",991.8,991.817,0,"DT")
2970926
"^DD",991.8,991.817,0,"IX","B",991.817,.01)

"^DD",991.8,991.817,0,"NM","PRIMARY CARE CLINIC STOPS")

"^DD",991.8,991.817,0,"UP")
991.8
"^DD",991.8,991.817,.01,0)
PRIMARY CARE CLINIC STOPS^MP40.7'^DIC(40.7,^0;1^Q
"^DD",991.8,991.817,.01,1,0)
^.1
"^DD",991.8,991.817,.01,1,1,0)
991.817^B
"^DD",991.8,991.817,.01,1,1,1)
S ^RGSITE(991.8,DA(1),"PC","B",$E(X,1,30),DA)=""
"^DD",991.8,991.817,.01,1,1,2)
K ^RGSITE(991.8,DA(1),"PC","B",$E(X,1,30),DA)
"^DD",991.8,991.817,.01,3)
Identify the Clinic Stops to use for calculating the CMOR activity scores.
"^DD",991.8,991.817,.01,21,0)
^^3^3^2980826^
"^DD",991.8,991.817,.01,21,1,0)
This field contains the primary care Clinic Stops or Decision Support
"^DD",991.8,991.817,.01,21,2,0)
System (DSS) identifiers used to calculate the CMOR patient activity
"^DD",991.8,991.817,.01,21,3,0)
scores.
"^DD",991.8,991.817,.01,"DT")
2970926
"^DD",991.8,991.817,1,0)
ACTIVATION DATE^D^^0;2^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.817,1,3)
Enter the date/time to activate this clinic stop.
"^DD",991.8,991.817,1,21,0)
^^2^2^2980826^
"^DD",991.8,991.817,1,21,1,0)
This field contains the activation date of the clinic stop used in
"^DD",991.8,991.817,1,21,2,0)
calculating the CMOR patient activity scores.
"^DD",991.8,991.817,1,"DT")
2970926
"^DD",991.8,991.817,2,0)
INACTIVE DATE^D^^0;3^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.817,2,3)
Enter the date/time to inactive the use of this clinic stop for calculating CMOR scores.
"^DD",991.8,991.817,2,21,0)
^^2^2^2980922^^
"^DD",991.8,991.817,2,21,1,0)
This field identifies the date/time that the clinic stop will be
"^DD",991.8,991.817,2,21,2,0)
inactivated for calculating CMOR patient activity scores.
"^DD",991.8,991.817,2,"DT")
2970926
"^DIC",991.8,991.8,0)
CIRN SITE PARAMETER^991.8
"^DIC",991.8,991.8,0,"GL")
^RGSITE(991.8,
"^DIC",991.8,991.8,"%",0)
^1.005^^
"^DIC",991.8,991.8,"%D",0)
^^3^3^3010703^
"^DIC",991.8,991.8,"%D",1,0)
File to store generic site parameters for the Master Patient Index/
"^DIC",991.8,991.8,"%D",2,0)
Patient Demographic (MPI/PD) package.  Only one entry (entry number 1)
"^DIC",991.8,991.8,"%D",3,0)
should exist in this file.
"^DIC",991.8,"B","CIRN SITE PARAMETER",991.8)

**END**
**END**
