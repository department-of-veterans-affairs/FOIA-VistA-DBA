Released GMTS*2.7*28 SEQ #27
Extracted from mail message
**KIDS**:GMTS*2.7*28^

**INSTALL NAME**
GMTS*2.7*28
"BLD",1074,0)
GMTS*2.7*28^HEALTH SUMMARY^0^2981026^y
"BLD",1074,1,0)
^^2^2^2990107^
"BLD",1074,1,1,0)
The description of this patch may be found on the National Patch Module 
"BLD",1074,1,2,0)
under GMTS*2.7*28.
"BLD",1074,4,0)
^9.64PA^^
"BLD",1074,"ABPKG")
n
"BLD",1074,"KRN",0)
^9.67PA^19^18
"BLD",1074,"KRN",.4,0)
.4
"BLD",1074,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",1074,"KRN",.401,0)
.401
"BLD",1074,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",1074,"KRN",.402,0)
.402
"BLD",1074,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",1074,"KRN",.403,0)
.403
"BLD",1074,"KRN",.5,0)
.5
"BLD",1074,"KRN",.5,"NM",0)
^9.68A^^0
"BLD",1074,"KRN",.84,0)
.84
"BLD",1074,"KRN",3.6,0)
3.6
"BLD",1074,"KRN",3.8,0)
3.8
"BLD",1074,"KRN",9.2,0)
9.2
"BLD",1074,"KRN",9.8,0)
9.8
"BLD",1074,"KRN",9.8,"NM",0)
^9.68A^81^80
"BLD",1074,"KRN",9.8,"NM",1,0)
GMTS1^^0^B20226263
"BLD",1074,"KRN",9.8,"NM",2,0)
GMTSALG^^0^B29132746
"BLD",1074,"KRN",9.8,"NM",3,0)
GMTSAMIE^^0^B3828524
"BLD",1074,"KRN",9.8,"NM",4,0)
GMTSDA^^0^B6788073
"BLD",1074,"KRN",9.8,"NM",5,0)
GMTSDCB^^0^B5044425
"BLD",1074,"KRN",9.8,"NM",6,0)
GMTSDEM^^0^B13341685
"BLD",1074,"KRN",9.8,"NM",7,0)
GMTSDGA^^0^B7297531
"BLD",1074,"KRN",9.8,"NM",8,0)
GMTSDGA1^^0^B12454226
"BLD",1074,"KRN",9.8,"NM",9,0)
GMTSDGA2^^0^B8712385
"BLD",1074,"KRN",9.8,"NM",10,0)
GMTSDGC2^^0^B4791277
"BLD",1074,"KRN",9.8,"NM",11,0)
GMTSDGCH^^0^B16704380
"BLD",1074,"KRN",9.8,"NM",12,0)
GMTSDGH^^0^B6620584
"BLD",1074,"KRN",9.8,"NM",13,0)
GMTSDGP^^0^B9031966
"BLD",1074,"KRN",9.8,"NM",14,0)
GMTSDS^^0^B4437733
"BLD",1074,"KRN",9.8,"NM",15,0)
GMTSDSB^^0^B3395963
"BLD",1074,"KRN",9.8,"NM",16,0)
GMTSFH^^0^B20600728
"BLD",1074,"KRN",9.8,"NM",17,0)
GMTSLRA^^0^B15129014
"BLD",1074,"KRN",9.8,"NM",18,0)
GMTSLRAE^^0^B24037533
"BLD",1074,"KRN",9.8,"NM",19,0)
GMTSLRBE^^0^B3824443
"BLD",1074,"KRN",9.8,"NM",20,0)
GMTSLRCE^^0^B9037427
"BLD",1074,"KRN",9.8,"NM",21,0)
GMTSLRCP^^0^B27527714
"BLD",1074,"KRN",9.8,"NM",22,0)
GMTSLREE^^0^B11526488
"BLD",1074,"KRN",9.8,"NM",23,0)
GMTSLREM^^0^B9887844
"BLD",1074,"KRN",9.8,"NM",24,0)
GMTSLRME^^0^B20889574
"BLD",1074,"KRN",9.8,"NM",25,0)
GMTSLROE^^0^B9952757
"BLD",1074,"KRN",9.8,"NM",26,0)
GMTSLRPE^^0^B9349321
"BLD",1074,"KRN",9.8,"NM",27,0)
GMTSLRSE^^0^B6150601
"BLD",1074,"KRN",9.8,"NM",28,0)
GMTSLRT^^0^B4215651
"BLD",1074,"KRN",9.8,"NM",29,0)
GMTSMCPZ^^0^B5686148
"BLD",1074,"KRN",9.8,"NM",30,0)
GMTSORC^^0^B9114085
"BLD",1074,"KRN",9.8,"NM",31,0)
GMTSORC3^^0^B8944413
"BLD",1074,"KRN",9.8,"NM",32,0)
GMTSPCD^^0^B5991368
"BLD",1074,"KRN",9.8,"NM",33,0)
GMTSPD^^0^B14712372
"BLD",1074,"KRN",9.8,"NM",34,0)
GMTSPL^^0^B18720264
"BLD",1074,"KRN",9.8,"NM",35,0)
GMTSPLST^^0^B10901627
"BLD",1074,"KRN",9.8,"NM",36,0)
GMTSPN^^0^B38309116
"BLD",1074,"KRN",9.8,"NM",37,0)
GMTSPNB^^0^B5274247
"BLD",1074,"KRN",9.8,"NM",38,0)
GMTSPSG^^0^B3644828
"BLD",1074,"KRN",9.8,"NM",39,0)
GMTSPSG5^^0^B3439746
"BLD",1074,"KRN",9.8,"NM",40,0)
GMTSPSI^^0^B6886817
"BLD",1074,"KRN",9.8,"NM",41,0)
GMTSPSI5^^0^B6625036
"BLD",1074,"KRN",9.8,"NM",42,0)
GMTSPSO^^0^B9444232
"BLD",1074,"KRN",9.8,"NM",43,0)
GMTSPSO7^^0^B7867729
"BLD",1074,"KRN",9.8,"NM",45,0)
GMTSPXEP^^0^B9596650
"BLD",1074,"KRN",9.8,"NM",46,0)
GMTSPXFP^^0^B6801919
"BLD",1074,"KRN",9.8,"NM",47,0)
GMTSPXHR^^0^B7925121
"BLD",1074,"KRN",9.8,"NM",48,0)
GMTSPXIM^^0^B6113228
"BLD",1074,"KRN",9.8,"NM",49,0)
GMTSPXM^^0^B1926599
"BLD",1074,"KRN",9.8,"NM",50,0)
GMTSPXMP^^0^B8482993
"BLD",1074,"KRN",9.8,"NM",51,0)
GMTSPXOP^^0^B29643037
"BLD",1074,"KRN",9.8,"NM",52,0)
GMTSPXSK^^0^B5441483
"BLD",1074,"KRN",9.8,"NM",53,0)
GMTSPXTP^^0^B9393551
"BLD",1074,"KRN",9.8,"NM",54,0)
GMTSPXXP^^0^B4889825
"BLD",1074,"KRN",9.8,"NM",55,0)
GMTSRAD^^0^B18600992
"BLD",1074,"KRN",9.8,"NM",56,0)
GMTSRAI^^0^B3408435
"BLD",1074,"KRN",9.8,"NM",57,0)
GMTSRAS^^0^B17560475
"BLD",1074,"KRN",9.8,"NM",58,0)
GMTSRASP^^0^B3989885
"BLD",1074,"KRN",9.8,"NM",59,0)
GMTSRO^^0^B22240585
"BLD",1074,"KRN",9.8,"NM",60,0)
GMTSROB^^0^B5580690
"BLD",1074,"KRN",9.8,"NM",61,0)
GMTSRON^^0^B18902485
"BLD",1074,"KRN",9.8,"NM",62,0)
GMTSSCD^^0^B7085256
"BLD",1074,"KRN",9.8,"NM",63,0)
GMTSU^^0^B12206941
"BLD",1074,"KRN",9.8,"NM",64,0)
GMTSUP^^0^B16837679
"BLD",1074,"KRN",9.8,"NM",65,0)
GMTSUP1^^0^B20015279
"BLD",1074,"KRN",9.8,"NM",66,0)
GMTSVS^^0^B27423067
"BLD",1074,"KRN",9.8,"NM",67,0)
GMTSVSS^^0^B40369683
"BLD",1074,"KRN",9.8,"NM",68,0)
GMTSLTR^^0^B3938946
"BLD",1074,"KRN",9.8,"NM",69,0)
GMTSDVR^^0^B31496566
"BLD",1074,"KRN",9.8,"NM",70,0)
GMTSADHC^^0^B17326779
"BLD",1074,"KRN",9.8,"NM",71,0)
GMTS^^0^B25936548
"BLD",1074,"KRN",9.8,"NM",72,0)
GMTSSOWK^^0^B586621
"BLD",1074,"KRN",9.8,"NM",73,0)
GMTSLRC^^0^B6036222
"BLD",1074,"KRN",9.8,"NM",74,0)
GMTSLRM^^0^B26697870
"BLD",1074,"KRN",9.8,"NM",75,0)
GMTSLRMB^^0^B22230830
"BLD",1074,"KRN",9.8,"NM",76,0)
GMTSLRS^^0^B9234572
"BLD",1074,"KRN",9.8,"NM",77,0)
GMTSLRS7^^0^B13776598
"BLD",1074,"KRN",9.8,"NM",78,0)
GMTSLRSC^^0^B14490840
"BLD",1074,"KRN",9.8,"NM",79,0)
GMTSALGB^^0^B5085273
"BLD",1074,"KRN",9.8,"NM",80,0)
GMTSLROS^^0^B3279226
"BLD",1074,"KRN",9.8,"NM",81,0)
GMTSLROB^^0^B2347531
"BLD",1074,"KRN",9.8,"NM","B","GMTS",71)

"BLD",1074,"KRN",9.8,"NM","B","GMTS1",1)

"BLD",1074,"KRN",9.8,"NM","B","GMTSADHC",70)

"BLD",1074,"KRN",9.8,"NM","B","GMTSALG",2)

"BLD",1074,"KRN",9.8,"NM","B","GMTSALGB",79)

"BLD",1074,"KRN",9.8,"NM","B","GMTSAMIE",3)

"BLD",1074,"KRN",9.8,"NM","B","GMTSDA",4)

"BLD",1074,"KRN",9.8,"NM","B","GMTSDCB",5)

"BLD",1074,"KRN",9.8,"NM","B","GMTSDEM",6)

"BLD",1074,"KRN",9.8,"NM","B","GMTSDGA",7)

"BLD",1074,"KRN",9.8,"NM","B","GMTSDGA1",8)

"BLD",1074,"KRN",9.8,"NM","B","GMTSDGA2",9)

"BLD",1074,"KRN",9.8,"NM","B","GMTSDGC2",10)

"BLD",1074,"KRN",9.8,"NM","B","GMTSDGCH",11)

"BLD",1074,"KRN",9.8,"NM","B","GMTSDGH",12)

"BLD",1074,"KRN",9.8,"NM","B","GMTSDGP",13)

"BLD",1074,"KRN",9.8,"NM","B","GMTSDS",14)

"BLD",1074,"KRN",9.8,"NM","B","GMTSDSB",15)

"BLD",1074,"KRN",9.8,"NM","B","GMTSDVR",69)

"BLD",1074,"KRN",9.8,"NM","B","GMTSFH",16)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRA",17)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRAE",18)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRBE",19)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRC",73)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRCE",20)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRCP",21)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLREE",22)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLREM",23)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRM",74)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRMB",75)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRME",24)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLROB",81)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLROE",25)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLROS",80)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRPE",26)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRS",76)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRS7",77)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRSC",78)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRSE",27)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLRT",28)

"BLD",1074,"KRN",9.8,"NM","B","GMTSLTR",68)

"BLD",1074,"KRN",9.8,"NM","B","GMTSMCPZ",29)

"BLD",1074,"KRN",9.8,"NM","B","GMTSORC",30)

"BLD",1074,"KRN",9.8,"NM","B","GMTSORC3",31)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPCD",32)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPD",33)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPL",34)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPLST",35)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPN",36)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPNB",37)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPSG",38)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPSG5",39)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPSI",40)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPSI5",41)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPSO",42)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPSO7",43)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPXEP",45)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPXFP",46)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPXHR",47)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPXIM",48)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPXM",49)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPXMP",50)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPXOP",51)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPXSK",52)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPXTP",53)

"BLD",1074,"KRN",9.8,"NM","B","GMTSPXXP",54)

"BLD",1074,"KRN",9.8,"NM","B","GMTSRAD",55)

"BLD",1074,"KRN",9.8,"NM","B","GMTSRAI",56)

"BLD",1074,"KRN",9.8,"NM","B","GMTSRAS",57)

"BLD",1074,"KRN",9.8,"NM","B","GMTSRASP",58)

"BLD",1074,"KRN",9.8,"NM","B","GMTSRO",59)

"BLD",1074,"KRN",9.8,"NM","B","GMTSROB",60)

"BLD",1074,"KRN",9.8,"NM","B","GMTSRON",61)

"BLD",1074,"KRN",9.8,"NM","B","GMTSSCD",62)

"BLD",1074,"KRN",9.8,"NM","B","GMTSSOWK",72)

"BLD",1074,"KRN",9.8,"NM","B","GMTSU",63)

"BLD",1074,"KRN",9.8,"NM","B","GMTSUP",64)

"BLD",1074,"KRN",9.8,"NM","B","GMTSUP1",65)

"BLD",1074,"KRN",9.8,"NM","B","GMTSVS",66)

"BLD",1074,"KRN",9.8,"NM","B","GMTSVSS",67)

"BLD",1074,"KRN",19,0)
19
"BLD",1074,"KRN",19,"NM",0)
^9.68A^4^4
"BLD",1074,"KRN",19,"NM",1,0)
GMTS HS ADHOC^^0
"BLD",1074,"KRN",19,"NM",2,0)
GMTS HS BY PATIENT^^0
"BLD",1074,"KRN",19,"NM",3,0)
GMTS HS BY PATIENT & DATE RANG^^0
"BLD",1074,"KRN",19,"NM",4,0)
GMTS HS BY PATIENT & VISIT^^0
"BLD",1074,"KRN",19,"NM","B","GMTS HS ADHOC",1)

"BLD",1074,"KRN",19,"NM","B","GMTS HS BY PATIENT",2)

"BLD",1074,"KRN",19,"NM","B","GMTS HS BY PATIENT & DATE RANG",3)

"BLD",1074,"KRN",19,"NM","B","GMTS HS BY PATIENT & VISIT",4)

"BLD",1074,"KRN",19.1,0)
19.1
"BLD",1074,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",1074,"KRN",101,0)
101
"BLD",1074,"KRN",101,"NM",0)
^9.68A^^0
"BLD",1074,"KRN",409.61,0)
409.61
"BLD",1074,"KRN",771,0)
771
"BLD",1074,"KRN",869.2,0)
869.2
"BLD",1074,"KRN",870,0)
870
"BLD",1074,"KRN",8994,0)
8994
"BLD",1074,"KRN","B",.4,.4)

"BLD",1074,"KRN","B",.401,.401)

"BLD",1074,"KRN","B",.402,.402)

"BLD",1074,"KRN","B",.403,.403)

"BLD",1074,"KRN","B",.5,.5)

"BLD",1074,"KRN","B",.84,.84)

"BLD",1074,"KRN","B",3.6,3.6)

"BLD",1074,"KRN","B",3.8,3.8)

"BLD",1074,"KRN","B",9.2,9.2)

"BLD",1074,"KRN","B",9.8,9.8)

"BLD",1074,"KRN","B",19,19)

"BLD",1074,"KRN","B",19.1,19.1)

"BLD",1074,"KRN","B",101,101)

"BLD",1074,"KRN","B",409.61,409.61)

"BLD",1074,"KRN","B",771,771)

"BLD",1074,"KRN","B",869.2,869.2)

"BLD",1074,"KRN","B",870,870)

"BLD",1074,"KRN","B",8994,8994)

"BLD",1074,"QUES",0)
^9.62^^
"BLD",1074,"REQB",0)
^9.611^16^13
"BLD",1074,"REQB",1,0)
GMTS*2.7*3^2
"BLD",1074,"REQB",3,0)
GMTS*2.7*10^2
"BLD",1074,"REQB",4,0)
GMTS*2.7*11^2
"BLD",1074,"REQB",6,0)
GMTS*2.7*13^2
"BLD",1074,"REQB",8,0)
GMTS*2.7*15^2
"BLD",1074,"REQB",9,0)
GMTS*2.7*17^2
"BLD",1074,"REQB",10,0)
GMTS*2.7*18^2
"BLD",1074,"REQB",11,0)
GMTS*2.7*19^2
"BLD",1074,"REQB",12,0)
GMTS*2.7*20^2
"BLD",1074,"REQB",13,0)
GMTS*2.7*23^2
"BLD",1074,"REQB",14,0)
GMTS*2.7*25^2
"BLD",1074,"REQB",15,0)
GMTS*2.7*27^2
"BLD",1074,"REQB",16,0)
GMTS*2.7*24^2
"BLD",1074,"REQB","B","GMTS*2.7*10",3)

"BLD",1074,"REQB","B","GMTS*2.7*11",4)

"BLD",1074,"REQB","B","GMTS*2.7*13",6)

"BLD",1074,"REQB","B","GMTS*2.7*15",8)

"BLD",1074,"REQB","B","GMTS*2.7*17",9)

"BLD",1074,"REQB","B","GMTS*2.7*18",10)

"BLD",1074,"REQB","B","GMTS*2.7*19",11)

"BLD",1074,"REQB","B","GMTS*2.7*20",12)

"BLD",1074,"REQB","B","GMTS*2.7*23",13)

"BLD",1074,"REQB","B","GMTS*2.7*24",16)

"BLD",1074,"REQB","B","GMTS*2.7*25",14)

"BLD",1074,"REQB","B","GMTS*2.7*27",15)

"BLD",1074,"REQB","B","GMTS*2.7*3",1)

"KRN",19,14070,-1)
0^2
"KRN",19,14070,0)
GMTS HS BY PATIENT^Patient Health Summary^^R^^^^^^^^HEALTH SUMMARY^^1
"KRN",19,14070,1,0)
^^2^2^2990223^^^^
"KRN",19,14070,1,1,0)
Generates a Health Summary of a specified pre-defined Health Summary Type
"KRN",19,14070,1,2,0)
for a specified patient.
"KRN",19,14070,2)
y
"KRN",19,14070,20)
K ORVP
"KRN",19,14070,25)
GMTS
"KRN",19,14070,72)
W @IOF
"KRN",19,14070,99)
54858,49206
"KRN",19,14070,"U")
PATIENT HEALTH SUMMARY
"KRN",19,14080,-1)
0^1
"KRN",19,14080,0)
GMTS HS ADHOC^Ad Hoc Health Summary^^R^^^^^^^^HEALTH SUMMARY^^1
"KRN",19,14080,1,0)
^^5^5^2950816^
"KRN",19,14080,1,1,0)
Generates an 'Ad Hoc' Health Summary for specified patients. Instead of
"KRN",19,14080,1,2,0)
selecting a pre-defined Health Summary Type, the user defines his own ad
"KRN",19,14080,1,3,0)
hoc Health Summary structure for temporary use while using this option.
"KRN",19,14080,1,4,0)
The user selects Health Summary components, time and occurrence limits
"KRN",19,14080,1,5,0)
when applicable, and selection items when applicable.
"KRN",19,14080,20)
K ORVP
"KRN",19,14080,25)
GMTSADH
"KRN",19,14080,99)
55626,36491
"KRN",19,14080,"U")
AD HOC HEALTH SUMMARY
"KRN",19,19289,-1)
0^4
"KRN",19,19289,0)
GMTS HS BY PATIENT & VISIT^Visit Patient Health Summary^^R^^^^^^^^HEALTH SUMMARY^^1^1
"KRN",19,19289,1,0)
^^8^8^2951019^^
"KRN",19,19289,1,1,0)
Generates Health Summaries of a specified pre-defined Health Summary Type
"KRN",19,19289,1,2,0)
for multiple patients. After a patient is selected, the user can pick an
"KRN",19,19289,1,3,0)
outpatient visit (based on the VISIT File) or an inpatient hospital
"KRN",19,19289,1,4,0)
admission (based on the Patient Movement file). If the Patient Care
"KRN",19,19289,1,5,0)
Encounter (PCE) package isn't installed then the user can only choose an
"KRN",19,19289,1,6,0)
inpatient visit. Data for summaries is based on a date range from the
"KRN",19,19289,1,7,0)
outpatient visit or inpatient admission. This Date Range overrides Time
"KRN",19,19289,1,8,0)
Limits for components which allows this option.
"KRN",19,19289,15)
K GMTSPXGO
"KRN",19,19289,20)
K ORVP S GMTSPXGO=1
"KRN",19,19289,25)
GMTS
"KRN",19,19289,"U")
VISIT PATIENT HEALTH SUMMARY
"KRN",19,19291,-1)
0^3
"KRN",19,19291,0)
GMTS HS BY PATIENT & DATE RANG^Range of Dates Patient Health Summary^^R^^^^^^^^HEALTH SUMMARY^^1^1
"KRN",19,19291,1,0)
^^5^5^2950816^^^^
"KRN",19,19291,1,1,0)
Generates Health Summaries of a specified pre-defined Health
"KRN",19,19291,1,2,0)
Summary Type for multiple patients. After patients are selected.
"KRN",19,19291,1,3,0)
the user can pick a date range. Data for summaries is based on
"KRN",19,19291,1,4,0)
the date range. This date range overrides Time Limits for
"KRN",19,19291,1,5,0)
components which allow this option.
"KRN",19,19291,15)
K GMRANGE
"KRN",19,19291,20)
K ORVP S GMRANGE=1
"KRN",19,19291,25)
GMTS
"KRN",19,19291,"U")
RANGE OF DATES PATIENT HEALTH 
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",187,-1)
1^1
"PKG",187,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",187,20,0)
^9.402P^^
"PKG",187,22,0)
^9.49I^1^1
"PKG",187,22,1,0)
2.7^2951020^2960308
"PKG",187,22,1,"PAH",1,0)
28^2981026^1118
"PKG",187,22,1,"PAH",1,1,0)
^^2^2^2990305
"PKG",187,22,1,"PAH",1,1,1,0)
The description of this patch may be found on the National Patch Module 
"PKG",187,22,1,"PAH",1,1,2,0)
under GMTS*2.7*28.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
80
"RTN","GMTS")
0^71^B25936548
"RTN","GMTS",1,0)
GMTS ; SLC/KER - Health Summary Main Routine ; 11/02/1998
"RTN","GMTS",2,0)
 ;;2.7;Health Summary;**16,24,28**;Oct 20, 1995
"RTN","GMTS",3,0)
 ; ACC/IHS/TPA 05/13/87
"RTN","GMTS",4,0)
MAIN ; Controls branching
"RTN","GMTS",5,0)
 ; GMTSPXGO & GMRANGE are set in 2 calling options, They aren't meant
"RTN","GMTS",6,0)
 ; to be used together.
"RTN","GMTS",7,0)
 I +$G(GMTSPXGO)'>0,$L($T(PATIENT^ORU1)),($$VERSION^XPDUTL("OR")>2.19) D MAIN^GMTSDVR Q
"RTN","GMTS",8,0)
 N DIROUT,DUOUT,ZTRTN,GMTSPX1,GMTSPX2,GMNAME,GMPSAP
"RTN","GMTS",9,0)
 S GMTSTYP=0 K DIC,DIROUT,DUOUT
"RTN","GMTS",10,0)
 S DIC("B")=$P($G(^GMT(142,+$G(^DISV(+$G(DUZ),"^GMT(142,")),0)),U)
"RTN","GMTS",11,0)
 F  Q:$D(DIROUT)!$D(DUOUT)  D SELTYP Q:GMTSTYP'>0!$D(DIROUT)!$D(DUOUT)  D
"RTN","GMTS",12,0)
 . N GMPAT,DFN,GMTSMULT
"RTN","GMTS",13,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DIROUT)!$D(DUOUT)!(+$D(GMPAT)'>0)!+$G(ORVP)
"RTN","GMTS",14,0)
 . . K GMPAT,DFN
"RTN","GMTS",15,0)
 . . I +$G(ORVP) D
"RTN","GMTS",16,0)
 . . . S (DFN,GMPAT(1))=+ORVP,GMNAME=$P($G(^DPT(+DFN,0)),U) Q:GMNAME=""  S GMPATT(GMNAME,DFN)="",(GMTSPX1,GMTSPX2)=""
"RTN","GMTS",17,0)
 . . . W !!,"For patient ",GMNAME," please answer the following."
"RTN","GMTS",18,0)
 . . . I +$G(GMTSPXGO)>0 D MENU^GMTSPXU2(DFN,.GMTSPX2,.GMTSPX1)
"RTN","GMTS",19,0)
 . . . I $G(GMTSPX1)']""!($G(GMTSPX2)']"") S DIROUT=1 K GMPAT,GMPATT Q
"RTN","GMTS",20,0)
 . . . Q:$D(DIROUT)  S GMPAT(GMNAME_(9999999-GMTSPX1),+DFN)=+DFN_U_$G(GMTSPX1)_U_$G(GMTSPX2)
"RTN","GMTS",21,0)
 . . I '(+($G(ORVP))) F  Q:$D(DIROUT)  K GMPATT D SELPT Q:$D(DIROUT)!('$D(GMPATT))  S GMNAME="" F  S GMNAME=$O(GMPATT(GMNAME)) Q:GMNAME=""!$D(DIROUT)  F DFN=0:0 S DFN=$O(GMPATT(GMNAME,DFN)) Q:DFN=""  D  Q:$D(DIROUT)
"RTN","GMTS",22,0)
 . . . S (GMTSPX1,GMTSPX2)="" W !!,"For patient ",GMNAME," please answer the following."
"RTN","GMTS",23,0)
 . . . I +$G(GMTSPXGO)>0 D MENU^GMTSPXU2(DFN,.GMTSPX2,.GMTSPX1) I $G(GMTSPX1)']""!($G(GMTSPX2)']"") Q
"RTN","GMTS",24,0)
 . . . Q:$D(DIROUT)
"RTN","GMTS",25,0)
 . . . S GMPAT(GMNAME_(9999999-GMTSPX1),+DFN)=+DFN_U_$G(GMTSPX1)_U_$G(GMTSPX2)
"RTN","GMTS",26,0)
 . . Q:$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTS",27,0)
 . . I +$G(GMRANGE)>0 D GETRANGE^GMTSU(.GMTSPX1,.GMTSPX2) Q:$G(GMTSPX1)=""!($G(GMTSPX2)="")
"RTN","GMTS",28,0)
 . . Q:$D(DIROUT)
"RTN","GMTS",29,0)
 . . D RESUB^GMTSDVR(.GMPAT)
"RTN","GMTS",30,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DTOUT)
"RTN","GMTS",31,0)
 . . S ZTRTN="PQ^GMTS"
"RTN","GMTS",32,0)
 . . D HSOUT^GMTSDVR,END W !
"RTN","GMTS",33,0)
 K GMTSTYP,GMTSTITL,GMTSEG,GMTSEGI,GMTSEGC,GMX,DFN,X,Y,I,GMP,GMPATT
"RTN","GMTS",34,0)
 Q
"RTN","GMTS",35,0)
SELTYP ; Select a Health Summary Type for printing
"RTN","GMTS",36,0)
 Q:GMTSTYP=-1  S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEQM",DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTS",37,0)
 D ^DIC K DIC S GMTSTYP=+Y,GMTSTITL=$S($D(^GMT(142,+Y,"T")):^("T"),1:"") S:GMTSTITL="" GMTSTITL=$P(Y,"^",2)
"RTN","GMTS",38,0)
 I GMTSTYP>0,$S($D(^GMT(142,GMTSTYP,1,0))=0:1,$O(^(0))'>0:1,1:0) W !,"This Summary Type includes no components...Please choose another." G SELTYP
"RTN","GMTS",39,0)
SELTYP1 ; Loop through HS Type and call LOADSEG to get each component record
"RTN","GMTS",40,0)
 K GMTSEG,GMTSEGI S (GMI,S1)=0 F  S S1=$O(^GMT(142,GMTSTYP,1,S1)) Q:'S1  S GMX=^(S1,0) D LOADSEG
"RTN","GMTS",41,0)
 S GMTSEGC=GMI K S1,S2,GMI
"RTN","GMTS",42,0)
 Q
"RTN","GMTS",43,0)
LOADSEG ; Load ENABLED COMPONENTS into GMTSEG array
"RTN","GMTS",44,0)
 S GMTS0=^GMT(142.1,$P(GMX,"^",2),0)
"RTN","GMTS",45,0)
 S GMI=GMI+1,GMTSEG(GMI)=GMX,GMTSEGI($P(GMX,U,2))=GMI D SELFILE
"RTN","GMTS",46,0)
 Q
"RTN","GMTS",47,0)
SELPT ; Select a patient for printing of Health Summary
"RTN","GMTS",48,0)
 N DUOUT K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP D PATIENT^ORU1(.GMP),PATCOPY^GMTSDVR(.GMP,.GMPATT)
"RTN","GMTS",49,0)
 Q
"RTN","GMTS",50,0)
SELFILE ; Loop through SELECTION ITEM multiple and load GMTSEG( with ITEMS
"RTN","GMTS",51,0)
 S S2=0 F  S S2=$O(^GMT(142,GMTSTYP,1,S1,1,S2)) Q:'S2  S ENTRY=^(S2,0),GMTSEG(GMI,+$P(@(U_$P(ENTRY,";",2)_"0)"),U,2),S2)=$P(ENTRY,";") I S2=1 S GMTSEG(GMI,+$P(@(U_$P(ENTRY,";",2)_"0)"),U,2),0)=U_$P(ENTRY,";",2)
"RTN","GMTS",52,0)
 Q
"RTN","GMTS",53,0)
PQ ; Queued subroutine for HS by patient
"RTN","GMTS",54,0)
 N DFN,GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPNM
"RTN","GMTS",55,0)
 N GMTSRB,GMTSSN,GMTSTOF,GMTSWARD,GMTJ,I,IX0,J,M4,P17,SEX
"RTN","GMTS",56,0)
 N TRFAC,VAERR,VAIN
"RTN","GMTS",57,0)
 S GMTJ=0 F  S GMTJ=$O(GMPAT(GMTJ)) Q:GMTJ'>0!$D(DIROUT)  D
"RTN","GMTS",58,0)
 . S DFN=+$G(GMPAT(GMTJ))
"RTN","GMTS",59,0)
 . I +$G(GMTSPXGO)>0 S GMTSPX1=$P($G(GMPAT(GMTJ)),U,2) D
"RTN","GMTS",60,0)
 . . S GMTSPX2=$P($G(GMPAT(GMTJ)),U,3)
"RTN","GMTS",61,0)
 . . I +GMTSPX1'>0!+GMTSPX2'>0 K GMTSPX1,GMTSPX2
"RTN","GMTS",62,0)
 . N GMDUOUT
"RTN","GMTS",63,0)
 . D EN^GMTS1
"RTN","GMTS",64,0)
 . Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTS",65,0)
 . D ACTPROF^GMTSDVR(DFN)
"RTN","GMTS",66,0)
 Q
"RTN","GMTS",67,0)
HSOUT ; Output Summary, with DEVICE handling
"RTN","GMTS",68,0)
 K ZTSK
"RTN","GMTS",69,0)
 I $D(^XUSEC("GMTS VIEW ONLY",DUZ)) D EN^GMTS1 Q
"RTN","GMTS",70,0)
 K IOP S %ZIS="PQ" D ^%ZIS Q:POP
"RTN","GMTS",71,0)
 G:$D(IO("Q")) QUE
"RTN","GMTS",72,0)
NOQUE ; Print non-queued output to selected device
"RTN","GMTS",73,0)
 D EN^GMTS1
"RTN","GMTS",74,0)
 D ^%ZISC
"RTN","GMTS",75,0)
 Q
"RTN","GMTS",76,0)
QUE ; Call TaskMan to Queue output
"RTN","GMTS",77,0)
 K IO("Q"),ZTSAVE F %="DFN","GMTS*","ENTRY" S ZTSAVE(%)=""
"RTN","GMTS",78,0)
 S ZTRTN="EN^GMTS1",ZTDESC="HEALTH SUMMARY",ZTIO=ION
"RTN","GMTS",79,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","GMTS",80,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","GMTS",81,0)
 S IOP="HOME" D ^%ZIS
"RTN","GMTS",82,0)
 Q
"RTN","GMTS",83,0)
END ; Clean up environmental variables and EXIT Health Summary
"RTN","GMTS",84,0)
 K %T,DIC,GMTS,GMTSLO,GMTSPNM,GMTSRB,GMTSWARD,GMTSDOB,DIC,X,Y,VA,VAIN,VAINDT,VADM,VAEL,VAPA,VAERR,GMTSSN,GMTS0,GMTS1,GMTS2
"RTN","GMTS",85,0)
 K GMTSAGE,GMTSTIM,GMTSEGN,GMTSEGH,GMTSEGL,GMTSHDR,GMTSNPG,GMTSPG,GMTSQIT,GMTSX,ENTRY,Z1,GMTSDTM,GMTSLOCK,GMTSLPG,SEX,POP,C,GMTSTOF
"RTN","GMTS",86,0)
 Q
"RTN","GMTS",87,0)
ENCWA ;Entry point printing components
"RTN","GMTS",88,0)
 ;GMTSPRM can be set to any component abbreviations except ones that 
"RTN","GMTS",89,0)
 ;require selection items. Needs to be valid component abbreviation 
"RTN","GMTS",90,0)
 ;from the "C" x-ref of File 142.1.
"RTN","GMTS",91,0)
 ;
"RTN","GMTS",92,0)
 ;call with DFN,GMTSPRM="CD,CN,CW,ADR",GMTSTITL="TITLE"
"RTN","GMTS",93,0)
 ;          GMTSPX1=Optional internal FM date for range ending date
"RTN","GMTS",94,0)
 ;          GMTSPX2=Optional internal FM date for range beginning date
"RTN","GMTS",95,0)
 ;  NOTE: Optional date range variables are both required if a date range
"RTN","GMTS",96,0)
 ;        is desired.
"RTN","GMTS",97,0)
 N GMI,GMJ,GMTSEG,GMTSEGI,GMTSEGC
"RTN","GMTS",98,0)
 S GMTS1="9999999",GMTS2="6666666",GMI=0,GMTSPNF=1
"RTN","GMTS",99,0)
 I '$D(GMTSPRM) W !,"The parameter GMTSPRM is undefined.",! Q
"RTN","GMTS",100,0)
 I '$D(GMTSTITL) W !,"The parameter GMTSTITL is undefined.",! Q
"RTN","GMTS",101,0)
 I '+$G(DFN) W !,"The parameter DFN is undefined.",! Q
"RTN","GMTS",102,0)
 F GMJ=1:1:$L(GMTSPRM,",") S ABB=$P(GMTSPRM,",",GMJ) D LOAD Q:GMJ=-1
"RTN","GMTS",103,0)
 S GMTSEGC=GMI K ABB,IFN
"RTN","GMTS",104,0)
 D EN^GMTS1
"RTN","GMTS",105,0)
 D END K GMTSEG,GMTSEGI,GMTSEGC,GMTSTITL,GMTSPRM,GMTSPNF
"RTN","GMTS",106,0)
 Q
"RTN","GMTS",107,0)
LOAD ; Load GMTSEG() using GMTSPRM abbreviations
"RTN","GMTS",108,0)
 S IFN=$O(^GMT(142.1,"C",ABB,"")) Q:IFN=""
"RTN","GMTS",109,0)
 S GMI=GMI+1,GMTSEG(GMI)=GMI_"^"_IFN,GMTSEGI(IFN)=GMI
"RTN","GMTS",110,0)
 Q
"RTN","GMTS1")
0^1^B20226263
"RTN","GMTS1",1,0)
GMTS1 ; SLC/JER,KER - Health Summary Driver ; 11/02/1998
"RTN","GMTS1",2,0)
 ;;2.7;Health Summary;**7,16,24,28**;Oct 20, 1995
"RTN","GMTS1",3,0)
EN ; ***** ENTRY TO GENERATE A SUMMARY
"RTN","GMTS1",4,0)
 ; ***** REQUIRES DFN,GMTSTITL,GMTSEG(),GMTSEGI(),GMTSEGC,DUZ(2)
"RTN","GMTS1",5,0)
 ; ***** $I & IO MUST BE VALID, CALLER MUST CLOSE OUTPUT DEVICE
"RTN","GMTS1",6,0)
 ;
"RTN","GMTS1",7,0)
START ;
"RTN","GMTS1",8,0)
 N GMSUPRES,GMTSICF,GMTSPXD1,GMTSPXD2,GMTSBEG,GMTSEND
"RTN","GMTS1",9,0)
 S GMSUPRES=$P($G(^GMT(142,+$G(GMTSTYP),0)),U,5)
"RTN","GMTS1",10,0)
 U IO S GMTSLO=3,GMTSLPG=0
"RTN","GMTS1",11,0)
 D DEM^GMTSU
"RTN","GMTS1",12,0)
 W:$E(IOST)="C" @IOF D OUTPUT
"RTN","GMTS1",13,0)
 K GMTSCVD,GMTSCKP,GMTSNPG,GMTSPG,GMTSQIT,GMTSHDR,GMTSHD2,GMTSBRK,GMTSLCMP,GMTSDTC
"RTN","GMTS1",14,0)
 K GMTSEGN,GMTSE,GMTSEGR,GMTSEQ,GMTSEGH,GMTSEGL,GMTSDLM,GMTSDLS,GMTSNDM,GMTSN,GMTSQ
"RTN","GMTS1",15,0)
 Q
"RTN","GMTS1",16,0)
 ;
"RTN","GMTS1",17,0)
OUTPUT ; Loop through GMTSEG()
"RTN","GMTS1",18,0)
 D NOW^%DTC S X=% D REGDTM4^GMTSU S GMTSDTM=X
"RTN","GMTS1",19,0)
 I +$G(GMTSPX1)&+$G(GMTSPX2) D  ;Allows date range for data
"RTN","GMTS1",20,0)
 . S GMTS2=9999999-$P(GMTSPX2,"."),GMTS1=9999999-$P(GMTSPX1,".")-.24
"RTN","GMTS1",21,0)
 . ;For GMTS1 want to get everything till Midnight
"RTN","GMTS1",22,0)
 . S X=GMTSPX1 D REGDT4^GMTSU S GMTSPXD1=X
"RTN","GMTS1",23,0)
 . S X=GMTSPX2 D REGDT4^GMTSU S GMTSPXD2=X
"RTN","GMTS1",24,0)
 D HEADER^GMTSUP
"RTN","GMTS1",25,0)
 K GMTSQIT S GMTSEGN=""
"RTN","GMTS1",26,0)
 F  S GMTSEGN=$O(GMTSEG(GMTSEGN)) Q:GMTSEGN=""  K GMTSQIT S GMTSEQ=$P(GMTSEG(GMTSEGN),U,1),GMTSE=$P(GMTSEG(GMTSEGN),U,2) D SEGMNT D:GMTSEGN=GMTSEGC LASTPG I $D(GMTSQIT),(GMTSQIT="") Q
"RTN","GMTS1",27,0)
 S GMTSHDR=$E(GMTSHDR,1,3)_" END "_$E(GMTSHDR,9,79)
"RTN","GMTS1",28,0)
 W:$E(IOST)'="C" !,GMTSHDR,!
"RTN","GMTS1",29,0)
 H:$E(IOST)="C" 1
"RTN","GMTS1",30,0)
 W:'+$G(GMPSAP) @IOF
"RTN","GMTS1",31,0)
 I $D(GMTSQIT) D EXIT
"RTN","GMTS1",32,0)
 Q
"RTN","GMTS1",33,0)
 ;
"RTN","GMTS1",34,0)
LASTPG ;ALLOWS USER TO BRANCH TO AN EARLIER COMPONENT ON THE LAST PAGE
"RTN","GMTS1",35,0)
 Q:$E(IOST)'="C"!(IOT="HFS")!$D(GMTSQIT)
"RTN","GMTS1",36,0)
 I +$G(GMPSAP),IOSL>998,$G(GMPAT(+$O(GMPAT(0),-1)))'=DFN Q
"RTN","GMTS1",37,0)
 ; Don't do footer when IOSL > 998 and action profile is printed.
"RTN","GMTS1",38,0)
 I IOSL>998,+$G(GMPSAP) Q
"RTN","GMTS1",39,0)
 ; Don't do footer when IOSL > 998 and this isn't the last patient.
"RTN","GMTS1",40,0)
 I IOSL>998,$G(GMPAT(+$O(GMPAT(""),-1)))'=$G(DFN) Q
"RTN","GMTS1",41,0)
 F I=$Y:1:$S((IOSL-GMTSLO)'>64:(IOSL-GMTSLO),1:(24-GMTSLO)) W !
"RTN","GMTS1",42,0)
 I $D(GMTSQIT),(GMTSQIT>0) K GMTSQIT
"RTN","GMTS1",43,0)
 S GMTSLPG=1 D CKP^GMTSUP
"RTN","GMTS1",44,0)
 Q
"RTN","GMTS1",45,0)
 ;
"RTN","GMTS1",46,0)
EXIT K ZTSK
"RTN","GMTS1",47,0)
 Q
"RTN","GMTS1",48,0)
 ;
"RTN","GMTS1",49,0)
SEGMNT ; OUTPUT A COMPONENT TYPE
"RTN","GMTS1",50,0)
 N GMTSLOCK,GMTSDBL,GMOOTXT,GMPXICDF,GMPXHLOC,GMPXNARR,GMTSWRIT,GMSEL
"RTN","GMTS1",51,0)
 I $D(GMTSQIT),(GMTSQIT]"") K GMTSQIT
"RTN","GMTS1",52,0)
 S X=^GMT(142.1,GMTSE,0),GMTSEGH=$S($P(X,U,4)]"":$P(X,U,4)_" - ",1:"")_$S($P(GMTSEG(GMTSEGN),U,5)]"":$P(GMTSEG(GMTSEGN),U,5),$P(X,U,9)]"":$P(X,U,9),1:" "_$P(X,U,1)),GMTSEGR=$P(X,"^",2) Q:GMTSEGR=""
"RTN","GMTS1",53,0)
 S GMTSLOCK=$P(X,U,7)
"RTN","GMTS1",54,0)
 S GMTSDBL=$P(X,U,6),GMOOTXT=$P(X,U,8)
"RTN","GMTS1",55,0)
 S GMPXHLOC=$P(GMTSEG(GMTSEGN),U,6),GMPXNARR=$P(GMTSEG(GMTSEGN),U,8)
"RTN","GMTS1",56,0)
 S GMPXICDF=$P(GMTSEG(GMTSEGN),U,7)
"RTN","GMTS1",57,0)
 S GMTSNDM=$P(GMTSEG(GMTSEGN),U,3),GMTSDLM=$P(GMTSEG(GMTSEGN),U,4) S:GMTSNDM="" GMTSNDM=-1
"RTN","GMTS1",58,0)
 S:+$G(GMTSPX1)&+$G(GMTSPX2) GMTSDLM="" ;Allows date range for data
"RTN","GMTS1",59,0)
 S GMTSDLS=""
"RTN","GMTS1",60,0)
 I GMTSDLM?1N.N!(GMTSDLM?1N.N1"D") S GMTSDLS=+GMTSDLM_" day"
"RTN","GMTS1",61,0)
 S:GMTSDLM?1N.N1"W" GMTSDLS=+GMTSDLM_" week",GMTSDLM=+GMTSDLM*7
"RTN","GMTS1",62,0)
 S:GMTSDLM?1N.N1"M" GMTSDLS=+GMTSDLM_" month",GMTSDLM=+GMTSDLM*30.4
"RTN","GMTS1",63,0)
 S:GMTSDLM?1N.N1"Y" GMTSDLS=+GMTSDLM_" year",GMTSDLM=+GMTSDLM*365.25
"RTN","GMTS1",64,0)
 S GMTSDLM=+GMTSDLM
"RTN","GMTS1",65,0)
 S:+GMTSDLS>1 GMTSDLS=GMTSDLS_"s"
"RTN","GMTS1",66,0)
 S GMTSEGL="" I GMTSNDM>0!(GMTSDLM>0) S GMTSEGL=" (max "_$S(GMTSNDM>0:GMTSNDM_$S(GMTSNDM=1:" occurrence",1:" occurrences")_$S(GMTSDLM>0:" or ",1:""),1:"")_$S(GMTSDLM>0:GMTSDLS,1:"")_")"
"RTN","GMTS1",67,0)
 K GMTSDLS,GMTSN
"RTN","GMTS1",68,0)
 D NOW^%DTC S GMTSDTC=%,DT=$P(%,".") K %,%H,%I
"RTN","GMTS1",69,0)
 I +$G(GMTSPX1)'>0!(+$G(GMTSPX2)'>0) D  ;Use date range unless variables empty
"RTN","GMTS1",70,0)
 . I GMTSDLM'>0 S (GMTS2,GMTSDLM)=9999999,GMTS1=6666666 ;GMTS1=MOST RECENT INVERTED DATE,GMTS2=TO DATE IN PAST IN INVERTED FORMAT
"RTN","GMTS1",71,0)
 . E  S X1=GMTSDTC,X2=-GMTSDLM D C^%DTC S GMTSDLM=9999999-X,GMTS2=GMTSDLM,GMTS1=9999999-(GMTSDTC+.0001) K X1,X2
"RTN","GMTS1",72,0)
 ;Set GMTSBEG to be GMTS2 uninverted
"RTN","GMTS1",73,0)
 S GMTSBEG=$S(GMTS2=9999999:1,1:9999999-GMTS2)
"RTN","GMTS1",74,0)
 ;Set GMTSEND to be GMTS1 uninverted
"RTN","GMTS1",75,0)
 S GMTSEND=$S(GMTS1=6666666:9999999,1:$P(9999999-GMTS1,".")_".235959")
"RTN","GMTS1",76,0)
 S GMTSWRIT=1 ;Variable is used to print component heading on 1st write
"RTN","GMTS1",77,0)
 I GMTSDBL]"",("PT"[GMTSDBL) D  Q
"RTN","GMTS1",78,0)
 . D:GMTSDBL="T" TDISBLD^GMTS2
"RTN","GMTS1",79,0)
 . D:GMTSDBL="P"&$D(GMTSPRM) PDISBLD^GMTS2
"RTN","GMTS1",80,0)
 I GMTSLOCK]"",('$D(^XUSEC(GMTSLOCK,DUZ))) D NOMATCH^GMTS2 Q
"RTN","GMTS1",81,0)
 S GMSEL=$P($G(^GMT(142.1,GMTSE,1,1,0)),U)
"RTN","GMTS1",82,0)
 I GMSEL]"",$O(GMTSEG(GMTSEGN,GMSEL,0))'>0 D NOSELECT^GMTS2 Q
"RTN","GMTS1",83,0)
 S GMTSNPG=0
"RTN","GMTS1",84,0)
 D @($P(GMTSEGR,";",1)_U_$P(GMTSEGR,";",2))
"RTN","GMTS1",85,0)
 D NODATA^GMTS2
"RTN","GMTS1",86,0)
 K GMTSDLM
"RTN","GMTS1",87,0)
 Q
"RTN","GMTSADHC")
0^70^B17326779
"RTN","GMTSADHC",1,0)
GMTSADHC ; SLC/JER,KER - Ad Hoc Summary Driver ; 11/02/1998
"RTN","GMTSADHC",2,0)
 ;;2.7;Health Summary;**6,27,28**;Oct 20, 1995
"RTN","GMTSADHC",3,0)
MAIN N I,XQORSPEW
"RTN","GMTSADHC",4,0)
 S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION" D ^DIC K DIC S GMTSTYP=+Y,GMTSTITL="AD HOC"
"RTN","GMTSADHC",5,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!'$D(GMTSEG)
"RTN","GMTSADHC",6,0)
 . K GMTSEG,GMTSEGI,GMTSEGC
"RTN","GMTSADHC",7,0)
 . D BUILD
"RTN","GMTSADHC",8,0)
 . Q:$D(DUOUT)!$D(DIROUT)!'$D(GMTSEG)
"RTN","GMTSADHC",9,0)
 . N GMPAT,GMP
"RTN","GMTSADHC",10,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)!+$G(ORVP)
"RTN","GMTSADHC",11,0)
 . . K GMP,GMPAT
"RTN","GMTSADHC",12,0)
 . . I +$G(ORVP) S GMPAT(1)=+ORVP
"RTN","GMTSADHC",13,0)
 . . E  F  Q:$D(DIROUT)  K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP D PATIENT^ORU1(.GMP),PATCOPY^GMTSDVR(.GMP,.GMPAT) Q:$S($D(DUOUT):1,$D(DIROUT):1,'+$G(GMP):1,$P($G(^VA(200,DUZ,100.1)),U,6)]"":1,1:0)  D
"RTN","GMTSADHC",14,0)
 . . . W !!,"Another patient(s) can be selected."
"RTN","GMTSADHC",15,0)
 . . Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTSADHC",16,0)
 . . D RESUB^GMTSDVR(.GMPAT)
"RTN","GMTSADHC",17,0)
 . . S ZTRTN="PQ^GMTSADHC"
"RTN","GMTSADHC",18,0)
 . . W !
"RTN","GMTSADHC",19,0)
 . . D HSOUT^GMTSDVR
"RTN","GMTSADHC",20,0)
 K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP")
"RTN","GMTSADHC",21,0)
 Q
"RTN","GMTSADHC",22,0)
PQ ; Queued subroutine to print Ad Hoc HS for each patient
"RTN","GMTSADHC",23,0)
 N GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG
"RTN","GMTSADHC",24,0)
 N GMTSPHDR,GMTSPNM,GMTSRB,GMTSSN,GMTSTOF,GMTSWARD,VADM,VAERR,VAIN,VAROOT
"RTN","GMTSADHC",25,0)
 S GMPAT=0 F  S GMPAT=$O(GMPAT(GMPAT)) Q:GMPAT'>0  D  Q:$D(GMTSQIT)!$D(DIROUT)
"RTN","GMTSADHC",26,0)
 . S DFN=+$G(GMPAT(GMPAT)) D EN^GMTS1
"RTN","GMTSADHC",27,0)
 Q
"RTN","GMTSADHC",28,0)
BUILD ; Conducts Dialogue to build ad hoc summary
"RTN","GMTSADHC",29,0)
 N GMI,GMJ,X,XQORM,Y
"RTN","GMTSADHC",30,0)
 Q:$D(GMTSQIT)!($D(DIROUT))
"RTN","GMTSADHC",31,0)
 W @IOF
"RTN","GMTSADHC",32,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""T"")",XQORM("M")=6
"RTN","GMTSADHC",33,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="AD",XQORM("A")="Select NEW set of COMPONENT(S): ",XQORM("??")="D HELP^GMTSADH" D ^XQORM I Y'>0 S GMTSQIT="" Q
"RTN","GMTSADHC",34,0)
 I +Y,(X?1"^^".E) D RJUMP^GMTSUP1 G BUILD
"RTN","GMTSADHC",35,0)
 S GMTSEGC=Y
"RTN","GMTSADHC",36,0)
 S (X,GMI,GMJ)=0 F  S GMI=$O(Y(GMI)) Q:'GMI  D LOAD
"RTN","GMTSADHC",37,0)
 D GETLIM^GMTSADH1
"RTN","GMTSADHC",38,0)
 Q
"RTN","GMTSADHC",39,0)
LOAD ; Load enabled components into GMTSEG
"RTN","GMTSADHC",40,0)
 N SREC,STRN
"RTN","GMTSADHC",41,0)
 S STRN=+Y(GMI),SREC=^GMT(142,GMTSTYP,1,STRN,0)
"RTN","GMTSADHC",42,0)
LOAD1 S GMJ=GMJ+1,GMTSEG(GMJ)=SREC,GMTSEGI($P(SREC,U,2))=GMJ D LOADSEL
"RTN","GMTSADHC",43,0)
 Q
"RTN","GMTSADHC",44,0)
LOADSEL ; Loads GMTSEG(J,FN,IFN), when Selection items are present
"RTN","GMTSADHC",45,0)
 N S2,SJ,SEL
"RTN","GMTSADHC",46,0)
 S S2=0,SJ=GMJ
"RTN","GMTSADHC",47,0)
 F  S S2=$O(^GMT(142,GMTSTYP,1,STRN,1,S2)) Q:'S2  S SEL=^(S2,0),GMTSEG(GMJ,+$P(@(U_$P(SEL,";",2)_"0)"),U,2),S2)=$P(SEL,";") I S2=1 S GMTSEG(SJ,+$P(@(U_$P(SEL,";",2)_"0)"),U,2),0)=U_$P(SEL,";",2)
"RTN","GMTSADHC",48,0)
 Q
"RTN","GMTSADHC",49,0)
HELP ; 
"RTN","GMTSADHC",50,0)
 N GMJ,GMTSTXT,HLP
"RTN","GMTSADHC",51,0)
 S HLP=$S(X="??":"HTX2",X="?":"HTX1",1:"") I $L(HLP) W ! F GMJ=1:1 S GMTSTXT=$T(@HLP+GMJ) Q:GMTSTXT["ZZZZ"  W !,$P(GMTSTXT,";",3,99)
"RTN","GMTSADHC",52,0)
 I X="???" W !! D HELP2^GMTSUP1
"RTN","GMTSADHC",53,0)
 D REDISP
"RTN","GMTSADHC",54,0)
 Q
"RTN","GMTSADHC",55,0)
REDISP ; Ask Whether or not to redisplay menu
"RTN","GMTSADHC",56,0)
 N I,DIR,X,Y
"RTN","GMTSADHC",57,0)
 S DIR(0)="Y",DIR("A")="Redisplay items",DIR("B")="YES" D ^DIR Q:'Y
"RTN","GMTSADHC",58,0)
 W @IOF
"RTN","GMTSADHC",59,0)
 D DISP^XQORM1 W !
"RTN","GMTSADHC",60,0)
 Q
"RTN","GMTSADHC",61,0)
HTX1 ;;Help Text for "?" and "??"
"RTN","GMTSADHC",62,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADHC",63,0)
 ;;
"RTN","GMTSADHC",64,0)
 ;;Enter: ??  to see HELP for MULTIPLE SELECTION
"RTN","GMTSADHC",65,0)
 ;;       ??? to see HELP for "^^"-jump
"RTN","GMTSADHC",66,0)
 ;;
"RTN","GMTSADHC",67,0)
 ;;ZZZZ
"RTN","GMTSADHC",68,0)
HTX2 ; HELP for ??
"RTN","GMTSADHC",69,0)
 ;;
"RTN","GMTSADHC",70,0)
 ;;The Health Summary components you select at this prompt create
"RTN","GMTSADHC",71,0)
 ;;an ADHOC Health Summary.
"RTN","GMTSADHC",72,0)
 ;;
"RTN","GMTSADHC",73,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADHC",74,0)
 ;;
"RTN","GMTSADHC",75,0)
 ;;ALL items may be selected by typing "ALL".
"RTN","GMTSADHC",76,0)
 ;;
"RTN","GMTSADHC",77,0)
 ;;EXCEPTIONS may be entered by preceding them with a minus.
"RTN","GMTSADHC",78,0)
 ;;  For example, "ALL,-THIS,-THAT" selects all but "THIS" and "THAT".
"RTN","GMTSADHC",79,0)
 ;;
"RTN","GMTSADHC",80,0)
 ;;NOTE: Menu items are ordered alphabetically by the Component NAME.
"RTN","GMTSADHC",81,0)
 ;;      However, the displayed text is the Header Name which generally 
"RTN","GMTSADHC",82,0)
 ;;      is different from the Component Name. Component may be picked
"RTN","GMTSADHC",83,0)
 ;;      by their abbreviation, Header Name or Component Name.
"RTN","GMTSADHC",84,0)
 ;;
"RTN","GMTSADHC",85,0)
 ;;ZZZZ
"RTN","GMTSALG")
0^2^B29132746
"RTN","GMTSALG",1,0)
GMTSALG ; SLC/DLT,KER - Allergies ; 11/02/1998
"RTN","GMTSALG",2,0)
 ;;2.7;Health Summary;**9,28**;Oct 20, 1995
"RTN","GMTSALG",3,0)
 ;
"RTN","GMTSALG",4,0)
ALLRG ; * ALLERGIES *
"RTN","GMTSALG",5,0)
 N X,GMTSALAS,GMTSALAD,GMTSALAW,GMTSAV,GMTSAFN,GMRAL,GMTSAL,GMTSALNM,GMTSCNT,GMTSEACT,GMTSLN,GMTSMECH,GMTSPRT,GMTSTY,CC,C,KK,ALLRG,TITLE,JJ
"RTN","GMTSALG",6,0)
 K GMTSA S (SEQ,ALLRG)=0,TITLE="ALLERGY/ADVERSE REACTION (AR)"
"RTN","GMTSALG",7,0)
 S X="GMRADPT" X ^%ZOSF("TEST")
"RTN","GMTSALG",8,0)
 I $T D  Q:$D(GMTSQIT)  G Q
"RTN","GMTSALG",9,0)
 .D NEWALLRG
"RTN","GMTSALG",10,0)
 .I ALLRG D TITLE,ALLRGP
"RTN","GMTSALG",11,0)
 .I 'ALLRG,$L($G(GMTSALAS)) D TITLE,NKA
"RTN","GMTSALG",12,0)
 I $D(^DPT(DFN,"PA",0)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"Allergy/Disorder: " D PA,ALLRGP
"RTN","GMTSALG",13,0)
 K GMTSA S SEQ=0 I $D(^DPT(DFN,"PG",0)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?7,"Generic Drug: " D PG,ALLRGP
"RTN","GMTSALG",14,0)
Q I 'ALLRG,'$L($G(GMTSALAS)) D
"RTN","GMTSALG",15,0)
 .I $D(GMTSPNF)&('ALLRG) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Unknown, please evaluate",!
"RTN","GMTSALG",16,0)
 K ALL,CC,CCC,CD,DIWF,DIWL,DIWR,GMTSALF,GMTSALNM,GMTSNODE,GMTSPRT,I,II,JJ,KK,L,M,MX,N,Z,X,SEQ,GMTSA,ALLRG,TITLE,GMRA,GMRAL,GMTSEACT,GMTSMECH,GMTSTY,GMTSPFN,GMTSAL,GMTSCNT,GMTSLN,ODT
"RTN","GMTSALG",17,0)
 Q
"RTN","GMTSALG",18,0)
PG S I=0 F Z=0:0 S I=$O(^DPT(DFN,"PG",I)) Q:'I  I $D(^(I,0)) S ALLRG=1,SEQ=SEQ+1,GMTSA(SEQ)=+^(0) S:$D(^PSDRUG(+GMTSA(SEQ),0)) GMTSA(SEQ)=$P(^(0),"^")
"RTN","GMTSALG",19,0)
 Q
"RTN","GMTSALG",20,0)
ALLRGP ;The printing is done here
"RTN","GMTSALG",21,0)
 ;F II="D","DF","DFO","DO","O","F","FO"  I $O(GMTSAL(II,""))]"" D
"RTN","GMTSALG",22,0)
 S II=""
"RTN","GMTSALG",23,0)
 F  S II=$O(GMTSAL(II)) Q:II']""  I $O(GMTSAL(II,""))]"" D
"RTN","GMTSALG",24,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?2,$S(II="D":"Drug:",II="DF":"Drug/Food:",II="DFO":"Drug/Food/Other:",II="DO":"Drug/Other:",II="F":"Food:",II="FO":"Food/Other:",II="O":"Other:",1:II_":")
"RTN","GMTSALG",25,0)
 . S JJ="" F  S JJ=$O(GMTSAL(II,JJ)) Q:JJ=""  D
"RTN","GMTSALG",26,0)
 .. N WKK S KK=""  F  S KK=$O(GMTSAL(II,JJ,KK)) Q:KK=""  D
"RTN","GMTSALG",27,0)
 ... S L=0 F  S L=$O(GMTSAL(II,JJ,KK,L)) Q:'L  D CKP^GMTSUP Q:$D(GMTSQIT)  D AUTOV W !?5,JJ_": " S:$L(KK)>30 WKK=KK,WKK=$$WRAP^GMTSORC(WKK,30) W ?24,$S($L(KK)>30:$P(WKK,"|"),1:KK) D
"RTN","GMTSALG",28,0)
 .... I GMTSAV=1 W " (AV"
"RTN","GMTSALG",29,0)
 .... E  W $S($P(GMTSAL(II,JJ,KK,L),U,5)=1:" (V",$P(GMTSAL(II,JJ,KK,L),U,5)=0:" (NV",1:"")
"RTN","GMTSALG",30,0)
 .... W $S($P($G(^GMR(120.8,GMTSALNM,0)),U,6)="h":"/Historical)",$P($G(^(0)),U,6)="o":"/Observed)",1:")")
"RTN","GMTSALG",31,0)
 .... I $L($P($G(WKK),"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?24,$P(WKK,"|",2)
"RTN","GMTSALG",32,0)
 .... S (M,MX,ALL)=0 F  S M=$O(GMTSAL(II,JJ,KK,L,"S",M)) Q:M=""  D  Q:$D(GMTSQIT)
"RTN","GMTSALG",33,0)
 ..... I ALL=0 D CKP^GMTSUP Q:$D(GMTSQIT)  W !?27
"RTN","GMTSALG",34,0)
 ..... S MX=MX+1
"RTN","GMTSALG",35,0)
 ..... W:MX>1 ", "
"RTN","GMTSALG",36,0)
 ..... S N=$P(GMTSAL(II,JJ,KK,L,"S",M),";")
"RTN","GMTSALG",37,0)
 ..... S ALL=1 I (74)'>($X+$L(N)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?27,N Q
"RTN","GMTSALG",38,0)
 ..... S ALL=1 W N
"RTN","GMTSALG",39,0)
 .... D SIGBLK($P(GMTSAFN,U,5))
"RTN","GMTSALG",40,0)
 .... D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?24,"Date/Time:  " S ODT=$P(GMTSAFN,U,4) S X=ODT D REGDTM4^GMTSU W X,!
"RTN","GMTSALG",41,0)
 ....S CC="" F  S CC=$O(^GMR(120.8,GMTSALNM,26,"B",CC)) Q:CC=""  D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?24,"Comments at: " S X=CC D REGDTM4^GMTSU S CD=X S CCC=0 F  S CCC=$O(^GMR(120.8,GMTSALNM,26,"B",CC,CCC)) Q:'CCC  D TEXT
"RTN","GMTSALG",42,0)
 Q
"RTN","GMTSALG",43,0)
NKA ; No known allergies
"RTN","GMTSALG",44,0)
 W:$L($G(GMTSALAS))!($L($G(GMTSALAD))) ! W:$L($G(GMTSALAS)) ?24,$G(GMTSALAS),!
"RTN","GMTSALG",45,0)
 W:$L($G(GMTSALAS))!($L($G(GMTSALAD)))!($L($G(GMTSALAW))) ?24,"Assessment date:   ",$G(GMTSALAD),! W:$L($G(GMTSALAW)) ?24,"Assessed by:       ",GMTSALAW,!
"RTN","GMTSALG",46,0)
 Q
"RTN","GMTSALG",47,0)
PA S I=0 F Z=0:0 S I=$O(^DPT(DFN,"PA",I)) Q:I'>0  I $D(^(I,0)) S ALLRG=1,SEQ=SEQ+1,GMTSA(SEQ)=+^(0) S:$D(^DIC(57,GMTSA(SEQ),0)) GMTSA(SEQ)=$P(^(0),"^")
"RTN","GMTSALG",48,0)
 Q
"RTN","GMTSALG",49,0)
NEWALLRG ; Call to Allergy Package for info
"RTN","GMTSALG",50,0)
 S GMRA="0^0^111" D EN1^GMRADPT I GMRAL="" S ALLRG=0 Q
"RTN","GMTSALG",51,0)
 I +($G(DFN))>0,+($G(GMRAL))=0 D ALLAS S ALLRG=0 Q
"RTN","GMTSALG",52,0)
 I $D(GMRAL)>9 D
"RTN","GMTSALG",53,0)
 . S I=0 F GMTSCNT=1:1 S I=$O(GMRAL(I)) Q:'I  D
"RTN","GMTSALG",54,0)
 .. S GMTSTY=$P(GMRAL(I),U,7) Q:GMTSTY']""
"RTN","GMTSALG",55,0)
 .. S GMTSEACT=$P(GMRAL(I),U,2) Q:GMTSEACT']""
"RTN","GMTSALG",56,0)
 .. S GMTSMECH=$P($P(GMRAL(I),U,8),";")
"RTN","GMTSALG",57,0)
 .. S:GMTSMECH']"" GMTSMECH="UNKNOWN"
"RTN","GMTSALG",58,0)
 ..; S GMTSMECH=$S($P(GMRAL(I),U,8)?1U.U1";".N:$P($P(GMRAL(I),U,8),";"),1:"ALLERGY")
"RTN","GMTSALG",59,0)
 .. S GMTSAL(GMTSTY,GMTSMECH,GMTSEACT,GMTSCNT)=I_"^"_GMRAL(I)
"RTN","GMTSALG",60,0)
 .. S JJ=0 F  S JJ=$O(GMRAL(I,"S",JJ)) Q:'JJ  S GMTSAL(GMTSTY,GMTSMECH,GMTSEACT,GMTSCNT,"S",JJ)=GMRAL(I,"S",JJ)
"RTN","GMTSALG",61,0)
 .. S ALLRG=1
"RTN","GMTSALG",62,0)
 Q
"RTN","GMTSALG",63,0)
ALLAS ; Allergy Assessment
"RTN","GMTSALG",64,0)
 N X,GMTSALG1,GMTSALG2,GMTSALG3 S (GMTSALAS,GMTSALAD,GMTSALAW)="" S GMTSALAS="No known allergies"
"RTN","GMTSALG",65,0)
 S GMTSALAD=$$GET1^DIQ(120.86,+($G(DFN)),3,"I",,"GMTSALG2") S:$D(GMTSALG2) GMTSALAD="" S:+GMTSALAD=0 GMTSALAD=""
"RTN","GMTSALG",66,0)
 I +GMTSALAD>0 S X=GMTSALAD D REGDT4^GMTSU S GMTSALAD=X
"RTN","GMTSALG",67,0)
 S GMTSALAW=$$GET1^DIQ(120.86,+($G(DFN)),2,"E",,"GMTSALG3") S:$D(GMTSALG3) GMTSALAW=""
"RTN","GMTSALG",68,0)
 Q
"RTN","GMTSALG",69,0)
AUTOV ;autoverify
"RTN","GMTSALG",70,0)
 S GMTSAV=0,GMTSALNM=$P(GMTSAL(II,JJ,KK,L),U),GMTSAFN=$G(^GMR(120.8,GMTSALNM,0))
"RTN","GMTSALG",71,0)
 I $P(GMTSAFN,U,18)="",$P(GMTSAFN,U,16)=1 S GMTSAV=1
"RTN","GMTSALG",72,0)
 Q
"RTN","GMTSALG",73,0)
TITLE ;print title
"RTN","GMTSALG",74,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSALG",75,0)
 I $D(GMTSPNF) W ?21,TITLE,!
"RTN","GMTSALG",76,0)
 E  W ?21,"Title: ",TITLE,!
"RTN","GMTSALG",77,0)
 Q
"RTN","GMTSALG",78,0)
TEXT ;Setup for print of allergy comments
"RTN","GMTSALG",79,0)
 W ?31,CD D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSALG",80,0)
 K ^UTILITY($J,"W") S GMTSLN=0 F  S GMTSLN=$O(^GMR(120.8,GMTSALNM,26,CCC,2,GMTSLN)) Q:'GMTSLN  S GMTSPRT=^GMR(120.8,GMTSALNM,26,CCC,2,GMTSLN,0) D FORMAT
"RTN","GMTSALG",81,0)
 I $D(^UTILITY($J,"W")) F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSALG",82,0)
 K ^UTILITY($J,"W")
"RTN","GMTSALG",83,0)
 Q:'GMTSLN
"RTN","GMTSALG",84,0)
 W ! Q
"RTN","GMTSALG",85,0)
FORMAT ;Formats each line
"RTN","GMTSALG",86,0)
 S DIWL=3,DIWR=80,DIWF="C58",X=GMTSPRT D ^DIWP
"RTN","GMTSALG",87,0)
 Q
"RTN","GMTSALG",88,0)
LINE ;Writes formatted lines of text
"RTN","GMTSALG",89,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?24,^UTILITY($J,"W",DIWL,GMTSLN,0)
"RTN","GMTSALG",90,0)
 Q
"RTN","GMTSALG",91,0)
SIGBLK(GMTSALF) ;signature block
"RTN","GMTSALG",92,0)
 I +GMTSALF'>0 Q
"RTN","GMTSALG",93,0)
 N GMTSNODE S GMTSNODE=$G(^VA(200,+GMTSALF,20))
"RTN","GMTSALG",94,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!?24,"Originator: ",$S($P(GMTSNODE,U,2)'="":$P(GMTSNODE,U,2),1:$P($G(^VA(200,+GMTSALF,0)),U))
"RTN","GMTSALG",95,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  I $P(GMTSNODE,U,3)'="" W !?24,"Title:      ",$P(GMTSNODE,U,3)
"RTN","GMTSALG",96,0)
 Q
"RTN","GMTSALGB")
0^79^B5085273
"RTN","GMTSALGB",1,0)
GMTSALGB ;SLC/DLT - Brief Adverse Reaction/Allergy ; 11/02/98
"RTN","GMTSALGB",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSALGB",3,0)
 ;
"RTN","GMTSALGB",4,0)
ALLRG ; **************** ALLERGIES *****************
"RTN","GMTSALGB",5,0)
 N X
"RTN","GMTSALGB",6,0)
 K GMTSA S (SEQ,ALLRG)=0
"RTN","GMTSALGB",7,0)
 S X="GMRADPT" X ^%ZOSF("TEST")
"RTN","GMTSALGB",8,0)
 I $T D  Q:$D(GMTSQIT)  G Q
"RTN","GMTSALGB",9,0)
 .D NEWALLRG
"RTN","GMTSALGB",10,0)
 .I ALLRG D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"Allergy/Reaction: " D ALLRGP
"RTN","GMTSALGB",11,0)
 I $D(^DPT(DFN,"PA",0)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"Allergy/Disorder: " D PA,ALLRGP
"RTN","GMTSALGB",12,0)
 K GMTSA S SEQ=0 I $D(^DPT(DFN,"PG",0)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?7,"Generic Drug: " D PG,ALLRGP
"RTN","GMTSALGB",13,0)
Q ;Exit
"RTN","GMTSALGB",14,0)
 K I,Z,X,SEQ,GMTSA,ALLRG
"RTN","GMTSALGB",15,0)
 Q
"RTN","GMTSALGB",16,0)
PG S I=0 F Z=0:0 S I=$O(^DPT(DFN,"PG",I)) Q:'I  I $D(^(I,0)) S ALLRG=1,SEQ=SEQ+1,GMTSA(SEQ)=+^(0) S:$D(^PSDRUG(+GMTSA(SEQ),0)) GMTSA(SEQ)=$P(^(0),"^")
"RTN","GMTSALGB",17,0)
 Q
"RTN","GMTSALGB",18,0)
ALLRGP D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21 S X=0 F I=0:0 S I=$O(GMTSA(I)) Q:I=""  S X=X+1 W:X>1 ", " W:(77)'>($X+$L(GMTSA(I))) ! D CKP^GMTSUP Q:$D(GMTSQIT)  W GMTSA(I)
"RTN","GMTSALGB",19,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W ! Q
"RTN","GMTSALGB",20,0)
PA S I=0 F Z=0:0 S I=$O(^DPT(DFN,"PA",I)) Q:I'>0  I $D(^(I,0)) S ALLRG=1,SEQ=SEQ+1,GMTSA(SEQ)=+^(0) S:$D(^DIC(57,GMTSA(SEQ),0)) GMTSA(SEQ)=$P(^(0),"^")
"RTN","GMTSALGB",21,0)
 Q
"RTN","GMTSALGB",22,0)
NEWALLRG ; Subroutine to execute when ALLERGIES Package is present
"RTN","GMTSALGB",23,0)
 N GMI,GMJ,GMRAL
"RTN","GMTSALGB",24,0)
 D EN1^GMRADPT I GMRAL="" S ALLRG=0 Q
"RTN","GMTSALGB",25,0)
 I GMRAL="0" S ALLRG=1,GMTSA(1)="No Known Allergies" Q
"RTN","GMTSALGB",26,0)
 S ALLRG=1,GMI=0 F  S GMI=$O(GMRAL(GMI)) Q:GMI'>0  D
"RTN","GMTSALGB",27,0)
 .S GMTSA(GMI)=$P(GMRAL(GMI),U,2)
"RTN","GMTSALGB",28,0)
 .S GMJ=0 F  S GMJ=$O(GMTSA(GMJ)) Q:GMJ'>0  I GMI'=GMJ,(GMTSA(GMI)=$G(GMTSA(GMJ))) K GMTSA(GMI) Q
"RTN","GMTSALGB",29,0)
 Q
"RTN","GMTSAMIE")
0^3^B3828524
"RTN","GMTSAMIE",1,0)
GMTSAMIE ; SLC/KER - Comp and Pension Exams ; 11/02/1998
"RTN","GMTSAMIE",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSAMIE",3,0)
MAIN ; Control branching
"RTN","GMTSAMIE",4,0)
 N GMDATE,GMEXAM,GMCNT,GMTSREC,DIWL,DIWR,DIWF,NODE,LINE
"RTN","GMTSAMIE",5,0)
 S DIWL=1,DIWR=80,DIWF="W"
"RTN","GMTSAMIE",6,0)
 K ^TMP("DVBC",$J)
"RTN","GMTSAMIE",7,0)
 D HSCP^DVBCHS0(DFN,GMTS2,GMTS1,2)
"RTN","GMTSAMIE",8,0)
 I '$D(^TMP("DVBC",$J)) Q
"RTN","GMTSAMIE",9,0)
 S (GMDATE,GMCNT)=0 S:GMTSNDM<1 GMTSNDM=99999
"RTN","GMTSAMIE",10,0)
 F  S GMDATE=$O(^TMP("DVBC",$J,GMDATE)) Q:+GMDATE'>0!(GMCNT'<GMTSNDM)  D
"RTN","GMTSAMIE",11,0)
 . S GMEXAM=""
"RTN","GMTSAMIE",12,0)
 . F  S GMEXAM=$O(^TMP("DVBC",$J,GMDATE,GMEXAM)) Q:GMEXAM']""!(GMCNT'<GMTSNDM)  D WRT
"RTN","GMTSAMIE",13,0)
 K ^TMP("DVBC",$J)
"RTN","GMTSAMIE",14,0)
 Q
"RTN","GMTSAMIE",15,0)
WRT ; Writes exam data
"RTN","GMTSAMIE",16,0)
 S GMCNT=GMCNT+1
"RTN","GMTSAMIE",17,0)
 N EXAM,PRI,PHY,EXAMDATE,X
"RTN","GMTSAMIE",18,0)
 S NODE=$G(^TMP("DVBC",$J,GMDATE,GMEXAM,0))
"RTN","GMTSAMIE",19,0)
 S X=$P(NODE,U,2) D REGDT4^GMTSU S EXAMDATE=X
"RTN","GMTSAMIE",20,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W EXAMDATE,?15,$P(NODE,U,3),!
"RTN","GMTSAMIE",21,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"Priority of Exam: ",$E($P(NODE,U,5),1,20),!
"RTN","GMTSAMIE",22,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?1,"Examining provider: ",$P(NODE,U,4),!
"RTN","GMTSAMIE",23,0)
 S NODE=$G(^TMP("DVBC",$J,GMDATE,GMEXAM,2))
"RTN","GMTSAMIE",24,0)
 S X=$P(NODE,U,3) D REGDT4^GMTSU
"RTN","GMTSAMIE",25,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSAMIE",26,0)
 W ?8,"Approved By: ",$P(NODE,U,2)," on ",X,!
"RTN","GMTSAMIE",27,0)
 K ^UTILITY($J,"W")
"RTN","GMTSAMIE",28,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Examination results: ",!
"RTN","GMTSAMIE",29,0)
 S LINE=0
"RTN","GMTSAMIE",30,0)
 F  S LINE=$O(^TMP("DVBC",$J,GMDATE,GMEXAM,"RES",LINE)) Q:'LINE  S X=^(LINE) D CKP^GMTSUP Q:$D(GMTSQIT)  D ^DIWP
"RTN","GMTSAMIE",31,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D ^DIWW
"RTN","GMTSAMIE",32,0)
 I +$O(^TMP("DVBC",$J,GMDATE,GMEXAM))!+$O(^TMP("DVBC",$J,GMDATE)) D
"RTN","GMTSAMIE",33,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSAMIE",34,0)
 Q
"RTN","GMTSDA")
0^4^B6788073
"RTN","GMTSDA",1,0)
GMTSDA ; SLC/DLT,KER/NDBI - Appointments ; 11/02/1998
"RTN","GMTSDA",2,0)
 ;;2.7;Health Summary;**5,19,28**;Oct 20, 1995
"RTN","GMTSDA",3,0)
PAST ;Gets Patient's Past Appointments for the past date range
"RTN","GMTSDA",4,0)
 N GMDT,GMIDT
"RTN","GMTSDA",5,0)
 S X=1
"RTN","GMTSDA",6,0)
 S VASD("F")=$S(GMTSBEG=1:2560101,1:GMTSBEG),VASD("T")=$S(GMTS1=6666666:DT,1:9999999-GMTS1)
"RTN","GMTSDA",7,0)
 S:GMTSNDM<1 GMTSNDM=99999
"RTN","GMTSDA",8,0)
 S VASD("W")=123456789 D SDA^VADPT
"RTN","GMTSDA",9,0)
 ;SET UP IDATES() ARRAY, INVERTED DATE ARRAY, = EXTERNAL APPOINTMENT DATA
"RTN","GMTSDA",10,0)
 S (YCNT,Y)=0 F  S Y=$O(^UTILITY("VASD",$J,Y)) Q:'Y  S YCNT=YCNT+1,ADATE=$P(^(Y,"I"),U,1),^UTILITY("GMTSVASD",$J,9999999-ADATE)=ADATE_U_$P(^UTILITY("VASD",$J,Y,"E"),U,2,99)
"RTN","GMTSDA",11,0)
 S GMDT=VASD("F")
"RTN","GMTSDA",12,0)
 F  S GMDT=$O(^SCE("ADFN",DFN,GMDT)) Q:GMDT'>0!(GMDT>VASD("T"))  D
"RTN","GMTSDA",13,0)
 . S GMI=0 F  S GMI=$O(^SCE("ADFN",DFN,GMDT,GMI)) Q:GMI'>0  D
"RTN","GMTSDA",14,0)
 .. S GMIDT=9999999-GMDT
"RTN","GMTSDA",15,0)
 .. I '$D(^UTILITY("GMTSVASD",$J,GMIDT)) D
"RTN","GMTSDA",16,0)
 ... Q:$P($G(^SCE(GMI,0)),U,6)'=""  ;check for parent encounter
"RTN","GMTSDA",17,0)
 ... I $P($G(^SCE(GMI,0)),U,4) Q:$P($G(^SC($P(^SCE(GMI,0),U,4),"OOS")),U)  ;If clinic entered in SCE, don't count if it is an occasion of service clinic.
"RTN","GMTSDA",18,0)
 ... S ^UTILITY("GMTSVASD",$J,GMIDT)=GMDT_U_$S(+$P(^SCE(GMI,0),U,4):$P($G(^SC(+$P(^(0),U,4),0)),U),1:$P($G(^DIC(40.7,$P(^SCE(GMI,0),U,3),0)),U))_U_"UNSCHEDULED"
"RTN","GMTSDA",19,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) CVP^A7RHSM
"RTN","GMTSDA",20,0)
 I '$D(^UTILITY("GMTSVASD",$J)) D END Q
"RTN","GMTSDA",21,0)
 S IDATE="",YCNT=0
"RTN","GMTSDA",22,0)
 F  S IDATE=$O(^UTILITY("GMTSVASD",$J,IDATE)) Q:+IDATE'>0!(YCNT=GMTSNDM)  D
"RTN","GMTSDA",23,0)
 . S ADATE=+^(IDATE),ADATE(0)=^(IDATE) D PRINT S YCNT=YCNT+1
"RTN","GMTSDA",24,0)
END K %I,IDATE,IDATES,ADATE,VASD,X,Y,YCNT,Z
"RTN","GMTSDA",25,0)
 K ^UTILITY("VASD",$J),^UTILITY("GMTSVASD",$J) Q
"RTN","GMTSDA",26,0)
FUTURE ;Gets Patient's Future Appointments 
"RTN","GMTSDA",27,0)
 D SDA^VADPT
"RTN","GMTSDA",28,0)
 S (YCNT,Y)=0 F  S Y=$O(^UTILITY("VASD",$J,Y)) Q:'Y  S YCNT=YCNT+1,ADATE=$P(^(Y,"I"),U,1),ADATE(0)=^UTILITY("VASD",$J,Y,"E") D PRINT Q:YCNT=GMTSNDM
"RTN","GMTSDA",29,0)
 D END Q
"RTN","GMTSDA",30,0)
PRINT D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDA",31,0)
 S X=ADATE D REGDTM4^GMTSU,CKP^GMTSUP
"RTN","GMTSDA",32,0)
 W X,?18,$E($P(ADATE(0),"^",2),1,25),?58,$E($P(ADATE(0),"^",3),1,21)
"RTN","GMTSDA",33,0)
 W ! Q
"RTN","GMTSDCB")
0^5^B5044425
"RTN","GMTSDCB",1,0)
GMTSDCB ; SLC/TRS,KER - Brief Discharge ; 11/02/1998
"RTN","GMTSDCB",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSDCB",3,0)
ENDC ;BRIEF DISCHARGE STUFF NO CAPTIONS
"RTN","GMTSDCB",4,0)
 S N="",ADM=GMTS1,GMC=0,LF=0
"RTN","GMTSDCB",5,0)
 I $D(GMTSNDM),(GMTSNDM>0) S CNTR=GMTSNDM
"RTN","GMTSDCB",6,0)
 E  S CNTR=100
"RTN","GMTSDCB",7,0)
 S T1=GMTSEND,T2=GMTSBEG
"RTN","GMTSDCB",8,0)
 F  S ADM=$O(^DPT(DFN,"DA","AA",ADM)) Q:'ADM!(ADM>GMTS2)  F  S N=$O(^DPT(DFN,"DA","AA",ADM,N)) Q:'N  D PROC I CNTR=0 Q
"RTN","GMTSDCB",9,0)
 D KILLADM Q
"RTN","GMTSDCB",10,0)
PROC S AD0=^DPT(DFN,"DA",N,0),PTF=$P(AD0,U,12)
"RTN","GMTSDCB",11,0)
 S CNTR=CNTR-1 I CNTR=0 Q
"RTN","GMTSDCB",12,0)
 I $S('PTF:1,1:'$D(^DGPT(PTF,70))) S GMC=-1 Q
"RTN","GMTSDCB",13,0)
 S:$D(^DGPT(PTF,70)) ICD=^DGPT(PTF,70)
"RTN","GMTSDCB",14,0)
 I $P(ICD,"^",1)="" S GMC=-1 Q
"RTN","GMTSDCB",15,0)
 S DATE=$P((ICD),"^",1) I (DATE'<T1)!(DATE'>T2) Q:GMC  S GMC=-1 Q
"RTN","GMTSDCB",16,0)
 S GMC=2 S X=DATE D REGDT4^GMTSU S XD=X
"RTN","GMTSDCB",17,0)
 I $P(ICD,U,10)'="" D
"RTN","GMTSDCB",18,0)
 . N DIC,DIQ,DR,DA,REC
"RTN","GMTSDCB",19,0)
 . S DIC=80,DA=$P(ICD,U,10),DIQ="REC(",DIQ(0)="IE",DR=".01;3"
"RTN","GMTSDCB",20,0)
 . D EN^DIQ1
"RTN","GMTSDCB",21,0)
 . Q:'$D(REC)
"RTN","GMTSDCB",22,0)
 . S DXL=REC(80,DA,3,"E")
"RTN","GMTSDCB",23,0)
 I $P((ICD),"^",2)'="" S BS=$P((ICD),"^",2),BS=$S($D(^DIC(42.4,BS,0)):^DIC(42.4,BS,0),1:"") S BDS=$S($P((BS),"^",2)'="":$P(BS,U,2),$P(BS,U,1)'="":$P(BS,U,1),1:"UNKNOWN")
"RTN","GMTSDCB",24,0)
 I $P(ICD,"^",3)'="" S DIC="^DGPT(",DR=72,DA=PTF,DIQ="ARRAY",DIQ(0)="E" D EN^DIQ1 S SDS=ARRAY(45,DA,72,"E")
"RTN","GMTSDCB",25,0)
 S DP=$S($P((ICD),"^",6)'="":$P(ICD,U,6),1:""),DP=$S(DP'="":^DIC(45.6,DP,0),1:"")
"RTN","GMTSDCB",26,0)
 S OT=$P(ICD,"^",4),OP=$S(OT=3:"NO",OT="":"UNKNOWN",1:"YES")
"RTN","GMTSDCB",27,0)
 ;I LF'=0 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDCB",28,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,XD,?21,SDS,!
"RTN","GMTSDCB",29,0)
 I $D(DXL) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?15,"DXLS: ",DXL,!
"RTN","GMTSDCB",30,0)
 ;D CKP^GMTSUP Q:$D(GMTSQIT)  W ?10,"Bedsection: ",BDS,!
"RTN","GMTSDCB",31,0)
 ;D CKP^GMTSUP Q:$D(GMTSQIT)  W "   Disposition Place: ",$S(DP'="":$P(DP,U,1),1:"UNKNOWN"),!
"RTN","GMTSDCB",32,0)
 ;D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient Treatment: ",OP,!
"RTN","GMTSDCB",33,0)
 ;S LF=1 Q
"RTN","GMTSDCB",34,0)
 K DXL,BS,BDS,ICD,DATE
"RTN","GMTSDCB",35,0)
 Q
"RTN","GMTSDCB",36,0)
KILLADM ;Kills Admission variables
"RTN","GMTSDCB",37,0)
 K END,TDT,HH,MM,TN,LF,DATE,AT,ITR,TRT,TI,TO,N,CNTR,BDS,SDS,GMC,ARRAY,DXL,TOM,TR,T1,T2,DATE,I,A,AD0,ADM,BS,D,DA,DP,DR,ICD,OP,OT,PTF,X,XD,DIQ,DIC
"RTN","GMTSDCB",38,0)
 Q
"RTN","GMTSDEM")
0^6^B13341685
"RTN","GMTSDEM",1,0)
GMTSDEM ; SLC/DLT,KER - Demographics ; 11/02/1998
"RTN","GMTSDEM",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSDEM",3,0)
 ;
"RTN","GMTSDEM",4,0)
DEMOG ; Prints Demographic data from VADPT calls
"RTN","GMTSDEM",5,0)
 D 6^VADPT,SVC^VADPT,OAD^VADPT,OPD^VADPT
"RTN","GMTSDEM",6,0)
 D PRT,END Q
"RTN","GMTSDEM",7,0)
PRT ;Print Demographic logic
"RTN","GMTSDEM",8,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Address: "_$S($L(VAPA(1)):VAPA(1),1:"Not available"),?53," Phone:",?61,VAPA(8),!
"RTN","GMTSDEM",9,0)
 I VAPA(2)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(2),!
"RTN","GMTSDEM",10,0)
 I VAPA(3)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(3),!
"RTN","GMTSDEM",11,0)
 I VAPA(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(4),", " W:VAPA(5)'="" $P(VAPA(5),"^",2),"  " W:VAPA(6)'="" VAPA(6) W:VAPA(7)'="" ?52," County:",?61,$P(VAPA(7),"^",2) W !
"RTN","GMTSDEM",12,0)
 I VADM(10)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ! D CKP^GMTSUP Q:$D(GMTSQIT)  W ?5,"Marital Status: ",?21,$P(VADM(10),"^",2)
"RTN","GMTSDEM",13,0)
 I VADM(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?56,"Age: ",$P(VADM(4),"^",1),!
"RTN","GMTSDEM",14,0)
 I VADM(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Religion: ",$P(VADM(9),"^",2)
"RTN","GMTSDEM",15,0)
 I VADM(5)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?56,"Sex: ",$P(VADM(5),"^",2),!
"RTN","GMTSDEM",16,0)
 I VAPD(6)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Occupation: ",$P(VAPD(6),"^",1),!
"RTN","GMTSDEM",17,0)
 I $P(VAEL(2),"^",1) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,"Period of Service: ",?21,$P(VAEL(2),"^",2),!
"RTN","GMTSDEM",18,0)
 I VASV(6) S GMI=6 D BOS
"RTN","GMTSDEM",19,0)
 I VASV(7) S GMI=7 D BOS
"RTN","GMTSDEM",20,0)
 I VASV(8) S GMI=8 D BOS
"RTN","GMTSDEM",21,0)
 D MORE
"RTN","GMTSDEM",22,0)
 Q
"RTN","GMTSDEM",23,0)
BOS ;FORMAT BRANCH OF SERVICE
"RTN","GMTSDEM",24,0)
 S X=$P(VASV(GMI,4),U,1) D REGDT4^GMTSU S FROM=X
"RTN","GMTSDEM",25,0)
 S X=$P(VASV(GMI,5),U,1) D REGDT4^GMTSU S TO=X
"RTN","GMTSDEM",26,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI=6 ?2,"Branch of Service: " W ?21,$P(VASV(GMI,1),U,2)," ",FROM," TO ",TO,!
"RTN","GMTSDEM",27,0)
 Q
"RTN","GMTSDEM",28,0)
MORE ;SERVICE CONNECTED DISABILITIES
"RTN","GMTSDEM",29,0)
 I $P(VAEL(2),U) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?13,"Combat: ",$S(VASV(5):"Y",1:"N"),?56,"POW: ",$S(VASV(4):"Y",1:"N"),!
"RTN","GMTSDEM",30,0)
ELIG I $P(VAEL(1),"^",1) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Eligibility: ",?21,$P(VAEL(1),"^",2) W:VAEL(8)'="" ?52," Status: ",$P(VAEL(8),"^",2) W !
"RTN","GMTSDEM",31,0)
 I $O(VAEL(1,0)) S I=0 F Z=0:0 S I=$O(VAEL(1,I)) Q:I=""  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$P(VAEL(1,I),"^",2),!
"RTN","GMTSDEM",32,0)
SC I VAEL(3) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14,"S/C %: ",?21,$P(VAEL(3),"^",2),!
"RTN","GMTSDEM",33,0)
 I VAEL(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Means Test: ",$P(VAEL(9),"^",2),!
"RTN","GMTSDEM",34,0)
 ;I $D(^DPT(DFN,.372)) S IX=0 F I=0:0 S IX=$O(^(DFN,.372)) Q:IX=""  D SCDP
"RTN","GMTSDEM",35,0)
 Q:VAOA(9)=""
"RTN","GMTSDEM",36,0)
 I VAOA(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?16,"NOK: ",VAOA(9) W:VAOA(10)'="" ?51,"Relation: ",VAOA(10) W !
"RTN","GMTSDEM",37,0)
 I VAOA(1)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W:VAOA(1)]"" ?21,VAOA(1) W:VAOA(8)'="" ?54,"Phone: ",VAOA(8) W !
"RTN","GMTSDEM",38,0)
 I VAOA(2)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAOA(2),!
"RTN","GMTSDEM",39,0)
 I VAOA(3)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAOA(3),!
"RTN","GMTSDEM",40,0)
 I VAOA(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAOA(4) W:VAOA(5) ", ",$P(VAOA(5),U,2) W:VAOA(6) "  ",VAOA(6) W !
"RTN","GMTSDEM",41,0)
 Q
"RTN","GMTSDEM",42,0)
END K I,VA,VADM,VAERR,VAOA,VASV,VAPA,VAPD,VAEL,SCD,SCDS,SCDP,FROM,GMI,TO,IX,X,Z Q
"RTN","GMTSDEM",43,0)
IEN ;INELIGBLE FOR CARE DATA
"RTN","GMTSDEM",44,0)
 S X=$P(VAEL(5,1),U,1) D REGDT4^GMTSU
"RTN","GMTSDEM",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?5,"Ineligible date: ",X
"RTN","GMTSDEM",46,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"Ineligible TWX source: ",$P(VAEL(5,2),U,2),"  ",VAEL(5,3),", ",$P(VAEL(5,4),U,2),!
"RTN","GMTSDEM",47,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:VAEL(5,5) VAEL(5,5) W:VAEL(5,6) " Reason: ",VAEL(5,6),!
"RTN","GMTSDEM",48,0)
 Q
"RTN","GMTSDEM",49,0)
SCDP ;Service Connected Diagnosis Print
"RTN","GMTSDEM",50,0)
 S SCD=^DPT(DFN,.372,IX,0)
"RTN","GMTSDEM",51,0)
 S SCDS=$S($P(SCD,"^",1):$P(^DIC(31,$P(SCD,"^",1),0),"^",1),1:"") S SCDP=$P(SCD,"^",2)_"% "_$S($P(SCD,"^",3):"SC",1:"")
"RTN","GMTSDEM",52,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"S/C Disabilities: ",SCDS,?61,SCDP,!
"RTN","GMTSDEM",53,0)
 Q
"RTN","GMTSDGA")
0^7^B7297531
"RTN","GMTSDGA",1,0)
GMTSDGA ; SLC/MKB,KER/NDBI - Admissions for HS ; 11/02/1998
"RTN","GMTSDGA",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSDGA",3,0)
ENAD ;Gets Admission Information 
"RTN","GMTSDGA",4,0)
 S TT=1,FLGDX=0,FLGDC=0
"RTN","GMTSDGA",5,0)
 D PATINFO Q
"RTN","GMTSDGA",6,0)
ENDC ;DISCHARGE INFORMATION
"RTN","GMTSDGA",7,0)
 S TT=3,FLGDC=1,FLGDX=0
"RTN","GMTSDGA",8,0)
 D PATINFO Q
"RTN","GMTSDGA",9,0)
ENDX ;PTF DISCHARGE DIAGNOSIS
"RTN","GMTSDGA",10,0)
 S TT=3,FLGDX=1,FLGDC=0
"RTN","GMTSDGA",11,0)
 D PATINFO Q
"RTN","GMTSDGA",12,0)
ENTS ;TREATING SPECIALITY INFORMATION
"RTN","GMTSDGA",13,0)
 S TT=6,FLGDX=0,FLGDC=0
"RTN","GMTSDGA",14,0)
 D PATINFO Q
"RTN","GMTSDGA",15,0)
ENTR ;TRANSFERS
"RTN","GMTSDGA",16,0)
 S TT=2,FLGDX=0,FLGDC=0
"RTN","GMTSDGA",17,0)
 D PATINFO Q
"RTN","GMTSDGA",18,0)
PATINFO S VA200=1 K DIQ
"RTN","GMTSDGA",19,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGA",20,0)
 E  S CNTR=100
"RTN","GMTSDGA",21,0)
 S GMC=-1,GMN="",ADM=GMTS1,FLAG=0
"RTN","GMTSDGA",22,0)
 I TT=1 D FADM^GMTSDGA2
"RTN","GMTSDGA",23,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) LST^A7RHSM(DFN,.A7RHS)
"RTN","GMTSDGA",24,0)
 F  S ADM=$O(^DGPM("ATID"_TT,DFN,ADM)) D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) DSP^A7RHSM(ADM) Q:('ADM!(ADM>GMTS2)!($D(GMTSQIT)))  D GET Q:$D(GMTSQIT)!($G(CNTR)<0)
"RTN","GMTSDGA",25,0)
 D KILLADM K:$$NDBI^GMTSU A7RHS
"RTN","GMTSDGA",26,0)
 Q
"RTN","GMTSDGA",27,0)
GET ; Call IN5^VADPT to get admission data
"RTN","GMTSDGA",28,0)
 N VAHOW
"RTN","GMTSDGA",29,0)
 S ADA=$O(^DGPM("ATID"_TT,DFN,ADM,0)) Q:'ADA
"RTN","GMTSDGA",30,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSDGA",31,0)
 S VAIP("E")=ADA D IN5^VADPT
"RTN","GMTSDGA",32,0)
 S (X,ADATE)=+VAIP(3) D REGDT4^GMTSU S ADT=X
"RTN","GMTSDGA",33,0)
 K DGPMIFN S:TT=1 DGPMIFN=ADA S:TT'=1 DGPMIFN=VAIP(13)
"RTN","GMTSDGA",34,0)
 S GMC=2
"RTN","GMTSDGA",35,0)
 D CONTGET
"RTN","GMTSDGA",36,0)
 S LIN=$S(TT=2:"TROUT^GMTSDGA1",FLGDX:"DXOUT^GMTSDGA1",FLGDC:"DCOUT^GMTSDGA1",TT=6:"TSOUT^GMTSDGA2",TT=1:"ADOUT^GMTSDGA1") D @LIN
"RTN","GMTSDGA",37,0)
 K ICD(ADM)
"RTN","GMTSDGA",38,0)
 Q
"RTN","GMTSDGA",39,0)
CONTGET ;ICD and LOS info only needed for certain MAS components
"RTN","GMTSDGA",40,0)
 Q:TT=2  Q:TT=6
"RTN","GMTSDGA",41,0)
 N DIC,DR,DA,DIQ
"RTN","GMTSDGA",42,0)
 I DGPMIFN D ^DGPMLOS S LOS=+X
"RTN","GMTSDGA",43,0)
 S PTF=$S($D(VAIP(12)):VAIP(12),1:"")
"RTN","GMTSDGA",44,0)
 I '$D(^ICD9) Q
"RTN","GMTSDGA",45,0)
 I PTF="" Q
"RTN","GMTSDGA",46,0)
 I '$D(^DGPT(PTF,70)) Q
"RTN","GMTSDGA",47,0)
 S ICD=^DGPT(PTF,70),DIC=80,DR=".01;3"
"RTN","GMTSDGA",48,0)
 I $P(ICD,U,11)'="" S DA=$P(ICD,U,11),DIQ="ICD(ADM,1," D EN^DIQ1
"RTN","GMTSDGA",49,0)
 I $P(ICD,U,10)'="" S DA=$P(ICD,U,10),DIQ="ICD(ADM,2," D EN^DIQ1
"RTN","GMTSDGA",50,0)
 F GMTSI=16:1:24 I $P(ICD,U,GMTSI)'="" S DA=$P(ICD,U,GMTSI),DIQ="ICD(ADM,(GMTSI-13)," D EN^DIQ1
"RTN","GMTSDGA",51,0)
 Q
"RTN","GMTSDGA",52,0)
KILLADM ;Kills Admission variables
"RTN","GMTSDGA",53,0)
 D KVAR^VADPT
"RTN","GMTSDGA",54,0)
 K ADA,ADATE,ADT,BD,BDSC,DA,DIC,DDT,DP,DSPL,GMJ,GMJ1,OP,OPTR,FLAG,FLGDX,FLGDC,X,DR,GMI,GMTO,GMTNO,GMTSI,GMX,ADM,CNTR,GMC,GMZ,GMN,ICD,PTF,PTF70,PTFLG,LOS,II,DGPMIFN,IN,LIN,TI,TT,TS,SPEC
"RTN","GMTSDGA",55,0)
 Q
"RTN","GMTSDGA1")
0^8^B12454226
"RTN","GMTSDGA1",1,0)
GMTSDGA1 ; SLC/MKB,KER - Admissions (cont) ; 11/02/1998
"RTN","GMTSDGA1",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSDGA1",3,0)
TROUT ;TRANSFERS OUTPUT
"RTN","GMTSDGA1",4,0)
 S X=ADATE D MTIM^GMTSU S TI=X,ADT=ADT_" "_TI
"RTN","GMTSDGA1",5,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ADT,?21,$P(VAIP(4),U,2),$S($P(VAIP(4),U,2)'["TO":" TO ",1:" "),$P(VAIP(5),U,2),!
"RTN","GMTSDGA1",6,0)
 S TRFAC=$P(^DGPM(ADA,0),U,5) I $L(TRFAC) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?24,TRFAC,! K TRFAC
"RTN","GMTSDGA1",7,0)
 Q
"RTN","GMTSDGA1",8,0)
DCOUT ;DISCHARGES OUTPUT
"RTN","GMTSDGA1",9,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGA1",10,0)
 I VAIP(17)="" S GMC=-1 Q
"RTN","GMTSDGA1",11,0)
 I VAIP(17,1)'="" S X=+VAIP(17,1) D REGDT4^GMTSU W "   Date of Discharge: ",X,!
"RTN","GMTSDGA1",12,0)
 I (+$P($G(ICD),U,10)>0),($G(ICD(ADM,2,80,+$P(ICD,U,10),3))]"") D CKP^GMTSUP Q:$D(GMTSQIT)  W ?16,"DXLS: ",ICD(ADM,2,80,+$P(ICD,U,10),3),!
"RTN","GMTSDGA1",13,0)
 S PTFLG=$S(PTF="":0,'$D(^DGPT(+PTF,70)):0,1:1),PTF70=$S(PTFLG:^DGPT(+PTF,70),1:"")
"RTN","GMTSDGA1",14,0)
 I PTFLG,+($P(PTF70,U,2))>0 S BD=+($P(PTF70,U,2)),BDSC=$S($D(^DIC(42.4,+BD,0)):$P(^(0),U),1:"UNKNOWN")
"RTN","GMTSDGA1",15,0)
 E  S BDSC="UNKNOWN"
"RTN","GMTSDGA1",16,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?10,"Bedsection: ",BDSC,!
"RTN","GMTSDGA1",17,0)
 I $G(VAIP(17,3))'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W "    Disposition Type: ",$P(VAIP(17,3),U,2),!
"RTN","GMTSDGA1",18,0)
 I PTFLG,$P(PTF70,U,6)'="" S DP=$P(PTF70,U,6),DSPL=$S($D(^DIC(45.6,+DP,0)):$P(^(0),U),1:"UNKNOWN")
"RTN","GMTSDGA1",19,0)
 E  S DSPL="UNKNOWN"
"RTN","GMTSDGA1",20,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "   Disposition Place: ",DSPL,!
"RTN","GMTSDGA1",21,0)
 I PTFLG,$P(PTF70,U,4)'="" S OP=$P(PTF70,U,4),OPTR=$S(OP=1:"YES",OP=3:"NO",1:"UNKNOWN")
"RTN","GMTSDGA1",22,0)
 E  S OPTR="UNKNOWN"
"RTN","GMTSDGA1",23,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient Treatment: ",OPTR,!
"RTN","GMTSDGA1",24,0)
 I 'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGA1",25,0)
 Q
"RTN","GMTSDGA1",26,0)
DXOUT ;PTF DISCHARGE DIAGNOSIS OUTPUT
"RTN","GMTSDGA1",27,0)
 I FLAG>1,'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGA1",28,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGA1",29,0)
 S FLAG=2
"RTN","GMTSDGA1",30,0)
 S X=+$G(VAIP(13,1)) D REGDT4^GMTSU S DDT=X
"RTN","GMTSDGA1",31,0)
 W DDT," - ",ADT,?57,"LOS: ",LOS,!
"RTN","GMTSDGA1",32,0)
 S NODIAG=1,GMI=0
"RTN","GMTSDGA1",33,0)
 F  S GMI=$O(ICD(ADM,GMI)) Q:'GMI  D CKP^GMTSUP Q:$D(GMTSQIT)  S GMX="" F  S GMX=$O(ICD(ADM,GMI,80,GMX)) Q:'GMX  D NXT
"RTN","GMTSDGA1",34,0)
 I NODIAG D CKP^GMTSUP Q:$D(GMTSQIT)  W "No discharge diagnosis available for this admission.",! K NODIAG
"RTN","GMTSDGA1",35,0)
 Q
"RTN","GMTSDGA1",36,0)
ADOUT ;ADMISSIONS OUTPUT
"RTN","GMTSDGA1",37,0)
 I FLAG>1,'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGA1",38,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGA1",39,0)
 S FLAG=2
"RTN","GMTSDGA1",40,0)
 I $G(VAIP(17,1))="" S DDT="Present"
"RTN","GMTSDGA1",41,0)
 E  S X=$P(VAIP(17,1),U,1) D REGDT4^GMTSU S DDT=X
"RTN","GMTSDGA1",42,0)
 W ADT," - ",DDT I VAIP(17,1)="" W ?25,GMTSWARD," ",GMTSRB
"RTN","GMTSDGA1",43,0)
 W ?56,"LOS: ",LOS,!
"RTN","GMTSDGA1",44,0)
 S TS=$P($G(^DIC(45.7,+$P($G(VAIP(14,6)),U),0)),U,2) S SPEC=$P($G(^DIC(42.4,+TS,0)),U)
"RTN","GMTSDGA1",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "  Last Tr Specialty: ",$E(SPEC,1,25),?50,"Last Prov: ",$E($P($G(VAIP(14,5)),U,2),1,15),!
"RTN","GMTSDGA1",46,0)
 I $G(VAIP(17,1))="" D CKP^GMTSUP Q:$D(GMTSQIT)  W "Admitting Diagnosis: ",$G(VAIP(13,7)),!
"RTN","GMTSDGA1",47,0)
 I PTF'="",$D(^DGPT(+PTF,70)) D CKP^GMTSUP Q:$D(GMTSQIT)  W "         Bedsection: ",$S(+($P(^DGPT(PTF,70),U,2))>0:$P($G(^DIC(42.4,+$P(^DGPT(PTF,70),U,2),0)),U),1:""),!
"RTN","GMTSDGA1",48,0)
 Q:'$D(ICD)  S GMI=0 F  S GMI=$O(ICD(ADM,GMI)) Q:'GMI  D CKP^GMTSUP Q:$D(GMTSQIT)  S GMX="" F  S GMX=$O(ICD(ADM,GMI,80,GMX)) Q:'GMX  D NXT
"RTN","GMTSDGA1",49,0)
 ;I 'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGA1",50,0)
 Q
"RTN","GMTSDGA1",51,0)
NXT S (GMTO,GMTNO)="" S GMTO=$G(ICD(ADM,GMI,80,GMX,3)),GMTNO=$G(ICD(ADM,GMI,80,GMX,.01))
"RTN","GMTSDGA1",52,0)
 W:GMI=1 "Principal Diagnosis: " W:GMI=2 ?15,"DXLS: "
"RTN","GMTSDGA1",53,0)
 W:GMI=3 ?13,"ICD DX: " W ?21,GMTO,?62,GMTNO,!
"RTN","GMTSDGA1",54,0)
 S NODIAG=0
"RTN","GMTSDGA1",55,0)
 Q
"RTN","GMTSDGA2")
0^9^B8712385
"RTN","GMTSDGA2",1,0)
GMTSDGA2 ; SLC/MKB,KER - Treating Spec for HS ; 11/02/1998
"RTN","GMTSDGA2",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSDGA2",3,0)
TSOUT ;TREATING SPECIALITY OUTPUT
"RTN","GMTSDGA2",4,0)
 S X=+VAIP(13,1) D REGDT4^GMTSU S DDT=X
"RTN","GMTSDGA2",5,0)
 S X=ADATE D MTIM^GMTSU S ADT=ADT_" "_X
"RTN","GMTSDGA2",6,0)
 S TS=$P($G(^DIC(45.7,+VAIP(8),0)),U,2) S SPEC=$S($D(^DIC(42.4,+TS,0)):$P(^(0),U),1:"UNKNOWN")
"RTN","GMTSDGA2",7,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ADT,?21,$E(SPEC,1,25),?48,"(",DDT,")",?63,$E($P(VAIP(7),U,2),1,15),!
"RTN","GMTSDGA2",8,0)
 K ^UTILITY($J,"W") I $D(^DGPM(ADA,"DX")) F GMJ=1:1:$P(^DGPM(ADA,"DX",0),"^",4) S X=^DGPM(ADA,"DX",GMJ,0),DIWL=27,DIWR=71,DIWF="C46R" D ^DIWP
"RTN","GMTSDGA2",9,0)
 I $D(^UTILITY($J,"W")) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,"Diag: " S GMJ=$O(^UTILITY($J,"W",0)) Q:'GMJ  S GMJ1=0 F GMZ=0:0 S GMJ1=$O(^UTILITY($J,"W",GMJ,GMJ1)) Q:'GMJ1  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?27,^UTILITY($J,"W",GMJ,GMJ1,0),!
"RTN","GMTSDGA2",10,0)
 K DIWL,DIWF,DIWR,^UTILITY($J,"W")
"RTN","GMTSDGA2",11,0)
 Q
"RTN","GMTSDGA2",12,0)
FADM ;Future Scheduled admission output
"RTN","GMTSDGA2",13,0)
 N GMDT,NODE,X
"RTN","GMTSDGA2",14,0)
 K ^TMP("GMFADM",$J)
"RTN","GMTSDGA2",15,0)
 D GETFADM
"RTN","GMTSDGA2",16,0)
 Q:'$D(^TMP("GMFADM",$J))
"RTN","GMTSDGA2",17,0)
 S GMC=1
"RTN","GMTSDGA2",18,0)
 S GMDT=0
"RTN","GMTSDGA2",19,0)
 F  S GMDT=$O(^TMP("GMFADM",$J,GMDT)) Q:GMDT'>0  D
"RTN","GMTSDGA2",20,0)
 . I FLAG>1,'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGA2",21,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGA2",22,0)
 . S FLAG=2
"RTN","GMTSDGA2",23,0)
 . S NODE=$G(^TMP("GMFADM",$J,GMDT))
"RTN","GMTSDGA2",24,0)
 . S X=$P(NODE,U) D REGDT4^GMTSU
"RTN","GMTSDGA2",25,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W X," (Future)",?23,$E($P(NODE,U,5),1,24)
"RTN","GMTSDGA2",26,0)
 . I $P(NODE,U,6)>0 W ?49,"Expected LOS: ",$P(NODE,U,6),!
"RTN","GMTSDGA2",27,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSDGA2",28,0)
 . . I $P(NODE,U,2)]"" W "Admitting Diagnosis: ",$P(NODE,U,2)
"RTN","GMTSDGA2",29,0)
 . . W ?51,"Provider: ",$E($P(NODE,U,3),1,15),!
"RTN","GMTSDGA2",30,0)
 K ^TMP("GMFADM",$J)
"RTN","GMTSDGA2",31,0)
 Q
"RTN","GMTSDGA2",32,0)
GETFADM ;Get future scheduled admission data
"RTN","GMTSDGA2",33,0)
 N DA,DIQ,DIC,DR
"RTN","GMTSDGA2",34,0)
 Q:'$D(^DGS(41.1,"B",DFN))
"RTN","GMTSDGA2",35,0)
 K ^TMP("GMFADM",$J)
"RTN","GMTSDGA2",36,0)
 S DA=0,DIC=41.1,DR="2;3;4;5;6;8;9;10;13;17"
"RTN","GMTSDGA2",37,0)
 F  S DA=$O(^DGS(41.1,"B",DFN,DA)) Q:DA'>0  D
"RTN","GMTSDGA2",38,0)
 . N GMFADM,DIQ,RESDT,ADDX,PROV,SUR,LOC,LOS
"RTN","GMTSDGA2",39,0)
 . S DIQ="GMFADM",DIQ(0)="IE"
"RTN","GMTSDGA2",40,0)
 . D EN^DIQ1
"RTN","GMTSDGA2",41,0)
 . ;Quit if reservation day is past, admission cancel or patient admitted
"RTN","GMTSDGA2",42,0)
 . Q:GMFADM(41.1,DA,13,"I")]""!(GMFADM(41.1,DA,17,"I")]"")!(GMFADM(41.1,DA,2,"I")<DT)
"RTN","GMTSDGA2",43,0)
 . S RESDT=GMFADM(41.1,DA,2,"I"),ADDX=GMFADM(41.1,DA,4,"I")
"RTN","GMTSDGA2",44,0)
 . S PROV=GMFADM(41.1,DA,5,"E"),SUR=GMFADM(41.1,DA,6,"E")
"RTN","GMTSDGA2",45,0)
 . ; LOC will contain either ward or treating specialty
"RTN","GMTSDGA2",46,0)
 . S LOC=$S(GMFADM(41.1,DA,10,"I")="W":GMFADM(41.1,DA,8,"E"),GMFADM(41.1,DA,10,"I")="T":GMFADM(41.1,DA,9,"E"),1:"")
"RTN","GMTSDGA2",47,0)
 . S LOS=GMFADM(41.1,DA,3,"I")
"RTN","GMTSDGA2",48,0)
 . S ^TMP("GMFADM",$J,9999999-RESDT)=RESDT_U_ADDX_U_PROV_U_SUR_U_LOC_U_LOS
"RTN","GMTSDGA2",49,0)
 Q
"RTN","GMTSDGC2")
0^10^B4791277
"RTN","GMTSDGC2",1,0)
GMTSDGC2 ; SLC/SBW,KER - Extended ADT Hist (cont) ; 11/02/1998
"RTN","GMTSDGC2",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSDGC2",3,0)
ICDP(DFN,PTF) ;Module For History of PTF Procedures
"RTN","GMTSDGC2",4,0)
 Q:'$D(^DGPT(PTF,"P"))
"RTN","GMTSDGC2",5,0)
 N II,PRX,X,IX,GMP,GTA,O,O1,LN1
"RTN","GMTSDGC2",6,0)
 S II=0
"RTN","GMTSDGC2",7,0)
 F  S II=$O(^DGPT(PTF,"P",II)) Q:'II  S PRX=^DGPT(PTF,"P",II,0),X=$P(PRX,U,1),IX=9999999-X D REGDT4^GMTSU D
"RTN","GMTSDGC2",8,0)
 . S GMP(IX)="Procedure "_X F GTA=5:1:9 D
"RTN","GMTSDGC2",9,0)
 . . N DIQ,DA,DIQ,ICDP
"RTN","GMTSDGC2",10,0)
 . . Q:$P(PRX,U,GTA)=""
"RTN","GMTSDGC2",11,0)
 . . S DIC=80.1,DR="4;.01",DA=$P(PRX,U,GTA),DIQ="ICDP(" D EN^DIQ1
"RTN","GMTSDGC2",12,0)
 . . I $D(ICDP(80.1,DA)) S GMP(IX,GTA)=$E(ICDP(80.1,DA,4),1,45)_U_ICDP(80.1,DA,.01)
"RTN","GMTSDGC2",13,0)
 I $D(GMP) S O=0 F  S O=$O(GMP(O)) Q:O=""  D
"RTN","GMTSDGC2",14,0)
 . S O1=0,LN1=1
"RTN","GMTSDGC2",15,0)
 . F  S O1=$O(GMP(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 ?2,GMP(O) W ?22,$P(GMP(O,O1),U),?69,$P(GMP(O,O1),U,2),! S LN1=0
"RTN","GMTSDGC2",16,0)
 Q
"RTN","GMTSDGC2",17,0)
ICDS(DFN,PTF) ; Module for history of PTF surgery episodes
"RTN","GMTSDGC2",18,0)
 Q:'$D(^DGPT(PTF,"S"))
"RTN","GMTSDGC2",19,0)
 N II,SURG,X,IX,GMS,GMA,O,O1,LN1
"RTN","GMTSDGC2",20,0)
 S II=0
"RTN","GMTSDGC2",21,0)
 F  S II=$O(^DGPT(PTF,"S",II)) Q:'II  S SURG=^DGPT(PTF,"S",II,0),X=$P(SURG,U,1),IX=9999999-X D REGDT4^GMTSU D
"RTN","GMTSDGC2",22,0)
 . ;Load Surgery entries into GMS array in inverted sequence
"RTN","GMTSDGC2",23,0)
 . S GMS(IX)="  Surgery "_X F GMA=8:1:12 D
"RTN","GMTSDGC2",24,0)
 . . ;Surgery Line
"RTN","GMTSDGC2",25,0)
 . . N DIQ,DA,DIQ,ICDS
"RTN","GMTSDGC2",26,0)
 . . Q:$P(SURG,U,GMA)=""
"RTN","GMTSDGC2",27,0)
 . . S DIC=80.1,DR="4;.01",DA=$P(SURG,U,GMA),DIQ="ICDS(" D EN^DIQ1
"RTN","GMTSDGC2",28,0)
 . . I $D(ICDS(80.1,DA)) S GMS(IX,GMA)=$E(ICDS(80.1,DA,4),1,45)_U_ICDS(80.1,DA,.01)
"RTN","GMTSDGC2",29,0)
 I $D(GMS) S O=0 F  S O=$O(GMS(O)) Q:O=""  D
"RTN","GMTSDGC2",30,0)
 . S O1=0,LN1=1
"RTN","GMTSDGC2",31,0)
 . F  S O1=$O(GMS(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 ?2,GMS(O) W ?22,$P(GMS(O,O1),U),?69,$P(GMS(O,O1),U,2),! S LN1=0
"RTN","GMTSDGC2",32,0)
 Q
"RTN","GMTSDGCH")
0^11^B16704380
"RTN","GMTSDGCH",1,0)
GMTSDGCH ; SLC/SBW,KER - Extended ADT Hist ; 11/02/1998
"RTN","GMTSDGCH",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSDGCH",3,0)
MAIN ; Loop through admissions starting from most recent
"RTN","GMTSDGCH",4,0)
 N FLAG,IN,IM,ADA,ADM,MDA,MDM,X,DOC,CNTR,CODE,TYPE,TT,SPEC
"RTN","GMTSDGCH",5,0)
 N ITS,TS,TSDM,TSDA,VAHOW,VA200,GMC,GMMDA
"RTN","GMTSDGCH",6,0)
 K VAIP
"RTN","GMTSDGCH",7,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGCH",8,0)
 E  S CNTR=100
"RTN","GMTSDGCH",9,0)
 S VA200=1,VAHOW=1,FLAG=-1,ADM=GMTS1,GMC=0
"RTN","GMTSDGCH",10,0)
 D DISAB,FADM
"RTN","GMTSDGCH",11,0)
 F  S ADM=$O(^DGPM("ATID1",DFN,ADM)) Q:('ADM)!(ADM>GMTS2)!(CNTR=0)!('DFN)  S GMC=0 D MVTS I GMC>0 D ICDP^GMTSDGC2(DFN,PTF),ICDS^GMTSDGC2(DFN,PTF)
"RTN","GMTSDGCH",12,0)
 D KVAR^VADPT
"RTN","GMTSDGCH",13,0)
 K ^UTILITY($J)
"RTN","GMTSDGCH",14,0)
 Q
"RTN","GMTSDGCH",15,0)
MVTS ; Loop through mvts chronologically, per admission
"RTN","GMTSDGCH",16,0)
 S ADA=0,ADA=$O(^DGPM("ATID1",DFN,ADM,ADA)) Q:'ADA
"RTN","GMTSDGCH",17,0)
 N VAIP,PREVDR,PREVSP
"RTN","GMTSDGCH",18,0)
 K ^UTILITY($J)
"RTN","GMTSDGCH",19,0)
 S (VAIP("E"),GMMDA)=ADA D IN5^VADPT
"RTN","GMTSDGCH",20,0)
 I $D(VAIP) D CKP^GMTSUP Q:$D(GMTSQIT)  W:FLAG>0 ! D PRNT
"RTN","GMTSDGCH",21,0)
 D SETUTL
"RTN","GMTSDGCH",22,0)
 S MDM=""
"RTN","GMTSDGCH",23,0)
 F  S MDM=$O(^UTILITY($J,"GMTSMVTS",MDM)) Q:'MDM  D GET
"RTN","GMTSDGCH",24,0)
 S CNTR=CNTR-1
"RTN","GMTSDGCH",25,0)
 K ^UTILITY($J)
"RTN","GMTSDGCH",26,0)
 Q
"RTN","GMTSDGCH",27,0)
GET ; D IN5^VADPT for each mvt, print info
"RTN","GMTSDGCH",28,0)
 I ^UTILITY($J,"GMTSMVTS",MDM)=ADA Q
"RTN","GMTSDGCH",29,0)
 K VAIP
"RTN","GMTSDGCH",30,0)
 S (VAIP("E"),GMMDA)=^UTILITY($J,"GMTSMVTS",MDM) D IN5^VADPT
"RTN","GMTSDGCH",31,0)
 I $D(VAIP) D PRNT
"RTN","GMTSDGCH",32,0)
 Q
"RTN","GMTSDGCH",33,0)
PRNT ; output line of data
"RTN","GMTSDGCH",34,0)
 S X=+$P(VAIP("MD"),U) D REGDT4^GMTSU
"RTN","GMTSDGCH",35,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGCH",36,0)
 S DOC=$E($P($G(VAIP("DR")),U,2),1,10),TYPE=$P($G(VAIP("MT")),U,2)
"RTN","GMTSDGCH",37,0)
 S CODE=+$P($G(VAIP("TT")),U),SPEC=$P(VAIP(("TS")),U,2)
"RTN","GMTSDGCH",38,0)
 S PTF=+$G(VAIP("PT"))
"RTN","GMTSDGCH",39,0)
 S TT=$S(CODE=0:"NON",CODE=1:"ADM",CODE=2:"TR ",CODE=3:"DC ",CODE=4:"CIL",CODE=5:"COL",CODE=6:"TS ",1:"   ")
"RTN","GMTSDGCH",40,0)
 I 'GMTSNPG,$D(PREVDR),PREVDR=$P(VAIP("DR"),U) S DOC="  "" "
"RTN","GMTSDGCH",41,0)
 I 'GMTSNPG,$D(PREVSP),PREVSP=$P(VAIP("TS"),U) S SPEC="    "" "
"RTN","GMTSDGCH",42,0)
 S GMC=1
"RTN","GMTSDGCH",43,0)
 W X,?12,TT,"  ",$E(TYPE,1,35),?56,$E(SPEC,1,11),?69,DOC,!
"RTN","GMTSDGCH",44,0)
 D OTHER^GMTSDGC1(DFN,PTF,CODE,.VAIP,$G(GMMDA))
"RTN","GMTSDGCH",45,0)
 S FLAG=2,PREVDR=$P(VAIP("DR"),U),PREVSP=$P(VAIP("TS"),U)
"RTN","GMTSDGCH",46,0)
 Q
"RTN","GMTSDGCH",47,0)
SETUTL ;
"RTN","GMTSDGCH",48,0)
 S (TSDM,MDM)=0
"RTN","GMTSDGCH",49,0)
 F  S TSDM=$O(^DGPM("ATS",DFN,ADA,TSDM)) Q:'TSDM  D NEXT1
"RTN","GMTSDGCH",50,0)
 F  S MDM=$O(^DGPM("APCA",DFN,ADA,MDM)) Q:'MDM  D NEXT2
"RTN","GMTSDGCH",51,0)
 Q
"RTN","GMTSDGCH",52,0)
NEXT1 ;
"RTN","GMTSDGCH",53,0)
 S TS="",TS=$O(^DGPM("ATS",DFN,ADA,TSDM,TS)) Q:'TS
"RTN","GMTSDGCH",54,0)
 S TSDA=0,TSDA=$O(^DGPM("ATS",DFN,ADA,TSDM,TS,TSDA)) Q:'TSDA
"RTN","GMTSDGCH",55,0)
 S ^UTILITY($J,"GMTSMVTS",9999999-TSDM)=TSDA
"RTN","GMTSDGCH",56,0)
 Q
"RTN","GMTSDGCH",57,0)
NEXT2 ;
"RTN","GMTSDGCH",58,0)
 S MDA=0,MDA=$O(^DGPM("APCA",DFN,ADA,MDM,MDA)) Q:'MDA
"RTN","GMTSDGCH",59,0)
 I MDA'=ADA S ^UTILITY($J,"GMTSMVTS",MDM)=MDA
"RTN","GMTSDGCH",60,0)
 Q
"RTN","GMTSDGCH",61,0)
DISAB ; Initializes Variables and Controls Looping for disability display
"RTN","GMTSDGCH",62,0)
 N GMW,GMTSI,VA,VADM,VAEL,VAERR,VAPA
"RTN","GMTSDGCH",63,0)
 D ELIG^VADPT I +$G(VAEL("EL")) D
"RTN","GMTSDGCH",64,0)
 . S FLAG=2
"RTN","GMTSDGCH",65,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Eligibility: ",$E($P(VAEL("EL"),U,2),1,40)
"RTN","GMTSDGCH",66,0)
 . W:VAEL("ES")]"" ?55,$P(VAEL("ES"),U,2)
"RTN","GMTSDGCH",67,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W:+VAEL("SC") !,"Total S/C %: ",$P(VAEL("SC"),U,2)
"RTN","GMTSDGCH",68,0)
 . I '$D(^DPT(DFN,.372)) D  Q
"RTN","GMTSDGCH",69,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"   No rated disabilities"
"RTN","GMTSDGCH",70,0)
 . S GMTSI=0
"RTN","GMTSDGCH",71,0)
 . F  S GMTSI=$O(^DPT(DFN,.372,GMTSI)) Q:GMTSI'>0  D
"RTN","GMTSDGCH",72,0)
 . . ; Resolves pointers and prints disability record
"RTN","GMTSDGCH",73,0)
 . . N DA,DIQ,DR,DIC,GMTSDIS
"RTN","GMTSDGCH",74,0)
 . . S DIC="^DPT("_DFN_",.372,",DA=GMTSI,DR=".01;2;3",DIQ="GMTSDIS",DIQ(0)="E"
"RTN","GMTSDGCH",75,0)
 . . D EN^DIQ1
"RTN","GMTSDGCH",76,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?3,GMTSDIS(2.04,DA,.01,"E"),?51,$J(GMTSDIS(2.04,DA,2,"E"),3),"%",?60,$S(GMTSDIS(2.04,DA,3,"E")="YES":"S/C",1:"NSC")
"RTN","GMTSDGCH",77,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGCH",78,0)
 Q
"RTN","GMTSDGCH",79,0)
FADM ; Retrieve future scheduled admissions and display this data
"RTN","GMTSDGCH",80,0)
 N GMDT,NODE,X
"RTN","GMTSDGCH",81,0)
 K ^TMP("GMFADM",$J)
"RTN","GMTSDGCH",82,0)
 D GETFADM^GMTSDGA2
"RTN","GMTSDGCH",83,0)
 Q:'$D(^TMP("GMFADM",$J))
"RTN","GMTSDGCH",84,0)
 S GMDT=0
"RTN","GMTSDGCH",85,0)
 F  S GMDT=$O(^TMP("GMFADM",$J,GMDT)) Q:GMDT'>0  D
"RTN","GMTSDGCH",86,0)
 . S NODE=$G(^TMP("GMFADM",$J,GMDT))
"RTN","GMTSDGCH",87,0)
 . S X=$P(NODE,U) D REGDT4^GMTSU
"RTN","GMTSDGCH",88,0)
 . I FLAG>0 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGCH",89,0)
 . E  S FLAG=2
"RTN","GMTSDGCH",90,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W X,?16,"Scheduled Admission",?55,$E($P(NODE,U,5),1,12),?69,$E($P(NODE,U,3),1,10),!
"RTN","GMTSDGCH",91,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGCH",92,0)
 . I $P(NODE,U,2)]"" W ?10,"Adm. Diag.: ",$P(NODE,U,2)
"RTN","GMTSDGCH",93,0)
 . I $P(NODE,U,6)>0 W ?55,"Expected LOS: ",$P(NODE,U,6),!
"RTN","GMTSDGCH",94,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGCH",95,0)
 . I $P(NODE,U,4)]"" W ?13,"Surgery: ",$P(NODE,U,4),!
"RTN","GMTSDGCH",96,0)
 K ^TMP("GMFADM",$J)
"RTN","GMTSDGCH",97,0)
 Q
"RTN","GMTSDGH")
0^12^B6620584
"RTN","GMTSDGH",1,0)
GMTSDGH ; SLC/MKB,KER/NDBI - Patient Hist by admissions ; 11/02/1998
"RTN","GMTSDGH",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSDGH",3,0)
MAIN ; Loop through admissions starting from most recent
"RTN","GMTSDGH",4,0)
 N VAHOW
"RTN","GMTSDGH",5,0)
 K VAIP
"RTN","GMTSDGH",6,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGH",7,0)
 E  S CNTR=100
"RTN","GMTSDGH",8,0)
 S VA200=1,VAHOW=1,FLAG=-1,ADM=GMTS1
"RTN","GMTSDGH",9,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) LST^A7RHSM(DFN,.A7RHS)
"RTN","GMTSDGH",10,0)
 F  S ADM=$O(^DGPM("ATID1",DFN,ADM)) D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) DSP^A7RHSM(ADM) Q:('ADM)!(ADM>GMTS2)!(CNTR=0)!('DFN)  D MVTS
"RTN","GMTSDGH",11,0)
 D KILVAR K:$$NDBI^GMTSU A7RHS
"RTN","GMTSDGH",12,0)
 Q
"RTN","GMTSDGH",13,0)
MVTS ; Loop through mvts chronologically, per admission
"RTN","GMTSDGH",14,0)
 S ADA=0,ADA=$O(^DGPM("ATID1",DFN,ADM,ADA)) Q:'ADA
"RTN","GMTSDGH",15,0)
 K VAIP,PREVDR,PREVSP,^UTILITY($J)
"RTN","GMTSDGH",16,0)
 S VAIP("E")=ADA D IN5^VADPT
"RTN","GMTSDGH",17,0)
 I $D(VAIP) D CKP^GMTSUP Q:$D(GMTSQIT)  W:FLAG>0 ! D PRNT
"RTN","GMTSDGH",18,0)
 D SETUTL
"RTN","GMTSDGH",19,0)
 S MDM="" F  S MDM=$O(^UTILITY($J,"GMTSMVTS",MDM)) Q:'MDM  D GET
"RTN","GMTSDGH",20,0)
 S CNTR=CNTR-1
"RTN","GMTSDGH",21,0)
 Q
"RTN","GMTSDGH",22,0)
GET ; D IN5^VADPT for each mvt, print info
"RTN","GMTSDGH",23,0)
 I ^UTILITY($J,"GMTSMVTS",MDM)=ADA Q
"RTN","GMTSDGH",24,0)
 K VAIP S VAIP("E")=^UTILITY($J,"GMTSMVTS",MDM) D IN5^VADPT
"RTN","GMTSDGH",25,0)
 I $D(VAIP) D PRNT
"RTN","GMTSDGH",26,0)
 Q
"RTN","GMTSDGH",27,0)
PRNT ; output line of data
"RTN","GMTSDGH",28,0)
 S X=+$P(VAIP("MD"),U) D REGDT4^GMTSU
"RTN","GMTSDGH",29,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGH",30,0)
 S DOC=$E($P(VAIP("DR"),U,2),1,10),TYPE=$P(VAIP("MT"),U,2),CODE=+$P(VAIP("TT"),U),SPEC=$E($P(VAIP("TS"),U,2),1,12)
"RTN","GMTSDGH",31,0)
 S TT=$S(CODE=0:"NON",CODE=1:"ADM",CODE=2:"TR ",CODE=3:"DC ",CODE=4:"CIL",CODE=5:"COL",CODE=6:"TS ",1:"   ")
"RTN","GMTSDGH",32,0)
 I 'GMTSNPG,$D(PREVDR),PREVDR=$P(VAIP("DR"),U) S DOC="  "" "
"RTN","GMTSDGH",33,0)
 I 'GMTSNPG,$D(PREVSP),PREVSP=$P(VAIP("TS"),U) S SPEC="    "" "
"RTN","GMTSDGH",34,0)
 W X,?12,TT,"  ",$E(TYPE,1,34),?55,SPEC,?69,DOC,!
"RTN","GMTSDGH",35,0)
 S FLAG=2,PREVDR=$P(VAIP("DR"),U),PREVSP=$P(VAIP("TS"),U)
"RTN","GMTSDGH",36,0)
 Q
"RTN","GMTSDGH",37,0)
SETUTL ;
"RTN","GMTSDGH",38,0)
 S (TSDM,MDM)=0
"RTN","GMTSDGH",39,0)
 F  S TSDM=$O(^DGPM("ATS",DFN,ADA,TSDM)) Q:'TSDM  D NEXT1
"RTN","GMTSDGH",40,0)
 F  S MDM=$O(^DGPM("APCA",DFN,ADA,MDM)) Q:'MDM  D NEXT2
"RTN","GMTSDGH",41,0)
 Q
"RTN","GMTSDGH",42,0)
NEXT1 ;
"RTN","GMTSDGH",43,0)
 S TS="",TS=$O(^DGPM("ATS",DFN,ADA,TSDM,TS)) Q:'TS
"RTN","GMTSDGH",44,0)
 S TSDA=0,TSDA=$O(^DGPM("ATS",DFN,ADA,TSDM,TS,TSDA)) Q:'TSDA
"RTN","GMTSDGH",45,0)
 S ^UTILITY($J,"GMTSMVTS",9999999-TSDM)=TSDA
"RTN","GMTSDGH",46,0)
 Q
"RTN","GMTSDGH",47,0)
NEXT2 ;
"RTN","GMTSDGH",48,0)
 S MDA=0,MDA=$O(^DGPM("APCA",DFN,ADA,MDM,MDA)) Q:'MDA
"RTN","GMTSDGH",49,0)
 I MDA'=ADA S ^UTILITY($J,"GMTSMVTS",MDM)=MDA
"RTN","GMTSDGH",50,0)
 Q
"RTN","GMTSDGH",51,0)
KILVAR ; Clean-up, exit
"RTN","GMTSDGH",52,0)
 D KVAR^VADPT
"RTN","GMTSDGH",53,0)
 K FLAG,IN,IM,ADA,ADM,MDA,MDM,X,DOC,CNTR,CODE,TYPE,TT,PREVSP,PREVDR,SPEC
"RTN","GMTSDGH",54,0)
 K ITS,TS,TSDM,TSDA,^UTILITY($J)
"RTN","GMTSDGH",55,0)
 Q
"RTN","GMTSDGP")
0^13^B9031966
"RTN","GMTSDGP",1,0)
GMTSDGP ; SLC/TRS,KER/NDBI - PTF Surgeries/Procedures ; 11/02/1998
"RTN","GMTSDGP",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSDGP",3,0)
ENS ;Module For History of PTF Surgery Episodes
"RTN","GMTSDGP",4,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGP",5,0)
 E  S CNTR=100
"RTN","GMTSDGP",6,0)
 S T1=GMTSEND,T2=GMTSBEG,GMCZ=0
"RTN","GMTSDGP",7,0)
 S PTF=0
"RTN","GMTSDGP",8,0)
 F  S PTF=$O(^DGPT("B",DFN,PTF)) Q:PTF=""  D ICDS
"RTN","GMTSDGP",9,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) OPC^A7RHSM
"RTN","GMTSDGP",10,0)
 I $D(GMS) S O=0 F I=1:1 S O=$O(GMS(O)) Q:O=""  Q:'CNTR  S CNTR=CNTR-1 S O1=0,LN1=1 F I=1:1 S O1=$O(GMS(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 GMS(O) W ?21,$P(GMS(O,O1),U),?68,$P(GMS(O,O1),U,2),! S LN1=0
"RTN","GMTSDGP",11,0)
 D KILLADM Q
"RTN","GMTSDGP",12,0)
ICDS Q:'$D(^DGPT(PTF,"S"))
"RTN","GMTSDGP",13,0)
 S II=0 F ZI=1:1 S II=$O(^DGPT(PTF,"S",II)) Q:'II  S SURG=^DGPT(PTF,"S",II,0),X=$P(SURG,U,1),IX=9999999-X I X>T2&(X<T1) D REGDT4^GMTSU D ICDS1
"RTN","GMTSDGP",14,0)
 Q
"RTN","GMTSDGP",15,0)
ICDS1 ;Load Surgery entries into GMS array in inverted sequence
"RTN","GMTSDGP",16,0)
 S GMCZ=2
"RTN","GMTSDGP",17,0)
 S GMS(IX)="  Surgery  "_X F GMA=8:1:12 D SGY
"RTN","GMTSDGP",18,0)
 Q
"RTN","GMTSDGP",19,0)
SGY ;Surgery Line
"RTN","GMTSDGP",20,0)
 K DIQ
"RTN","GMTSDGP",21,0)
 Q:$P(SURG,U,GMA)=""
"RTN","GMTSDGP",22,0)
 S DIC=80.1,DR="4;.01",DA=$P(SURG,U,GMA),DIQ="ICDS(" D EN^DIQ1
"RTN","GMTSDGP",23,0)
 I $D(ICDS(80.1,DA)) S GMS(IX,GMA)=$E(ICDS(80.1,DA,4),1,45)_U_ICDS(80.1,DA,.01)
"RTN","GMTSDGP",24,0)
 Q
"RTN","GMTSDGP",25,0)
ENP ;Module For History of PTF Procedures
"RTN","GMTSDGP",26,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGP",27,0)
 E  S CNTR=100
"RTN","GMTSDGP",28,0)
 S T1=GMTSEND,T2=GMTSBEG,GMCZ=0
"RTN","GMTSDGP",29,0)
 S PTF=0
"RTN","GMTSDGP",30,0)
 F  S PTF=$O(^DGPT("B",DFN,PTF)) Q:PTF=""  D ICDP
"RTN","GMTSDGP",31,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) PRC^A7RHSM
"RTN","GMTSDGP",32,0)
 I $D(GMP) S O=0 F I=1:1 S O=$O(GMP(O)) Q:O=""  Q:'CNTR  S CNTR=CNTR-1 S O1=0,LN1=1 F I=1:1 S O1=$O(GMP(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 GMP(O) W ?21,$P(GMP(O,O1),U),?68,$P(GMP(O,O1),U,2),! S LN1=0
"RTN","GMTSDGP",33,0)
 D KILLADM Q
"RTN","GMTSDGP",34,0)
 Q
"RTN","GMTSDGP",35,0)
ICDP Q:'$D(^DGPT(PTF,"P"))
"RTN","GMTSDGP",36,0)
 S II=0 F ZI=1:1 S II=$O(^DGPT(PTF,"P",II)) Q:'II  S PRX=^DGPT(PTF,"P",II,0),X=$P(PRX,U,1),IX=9999999-X I X>T2&(X<T1) D REGDT4^GMTSU D ICDP1
"RTN","GMTSDGP",37,0)
 Q
"RTN","GMTSDGP",38,0)
ICDP1 ;Load Procedure entries into GMP array in inverted sequence
"RTN","GMTSDGP",39,0)
 S GMCZ=2
"RTN","GMTSDGP",40,0)
 S GMP(IX)="Procedure  "_X F GTA=5:1:9 D PXGY
"RTN","GMTSDGP",41,0)
 Q
"RTN","GMTSDGP",42,0)
PXGY ;Procedure Line
"RTN","GMTSDGP",43,0)
 K DIQ
"RTN","GMTSDGP",44,0)
 Q:$P(PRX,U,GTA)=""
"RTN","GMTSDGP",45,0)
 S DIC=80.1,DR="4;.01",DA=$P(PRX,U,GTA),DIQ="ICDP(" D EN^DIQ1
"RTN","GMTSDGP",46,0)
 I $D(ICDP(80.1,DA)) S GMP(IX,GTA)=$E(ICDP(80.1,DA,4),1,45)_U_ICDP(80.1,DA,.01)
"RTN","GMTSDGP",47,0)
 Q
"RTN","GMTSDGP",48,0)
KILLADM ;Kills Admission variables
"RTN","GMTSDGP",49,0)
 K CNTR,GMCZ,LN1,IX,X,ZA,N,ICD,ICD0,PTF,GMC,O,O1,GMS,T1,T2,SURG,SURGY,PRX,PRXY,DATE,D1,I,IMT,GMA,GTA,II,ZI,GMP
"RTN","GMTSDGP",50,0)
 K ICDP,ICDS
"RTN","GMTSDGP",51,0)
 Q
"RTN","GMTSDS")
0^14^B4437733
"RTN","GMTSDS",1,0)
GMTSDS ; SLC/JER,KER - Discharge Summary ; 11/02/1998
"RTN","GMTSDS",2,0)
 ;;2.7;Health Summary;**12,28**;Feb 28, 1996
"RTN","GMTSDS",3,0)
MAIN ; Control branching
"RTN","GMTSDS",4,0)
 N GMTSI,GMTSJ,GMTSCNT,GMTSREC
"RTN","GMTSDS",5,0)
 K ^TMP("TIU",$J)
"RTN","GMTSDS",6,0)
 D MAIN^TIULAPIC(DFN,244,GMTS1,GMTS2,GMTSNDM,1)
"RTN","GMTSDS",7,0)
 I '$D(^TMP("TIU",$J)) Q
"RTN","GMTSDS",8,0)
 S GMTSI=0
"RTN","GMTSDS",9,0)
 F  S GMTSI=$O(^TMP("TIU",$J,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSDS",10,0)
 . S GMTSJ=0
"RTN","GMTSDS",11,0)
 . F  S GMTSJ=$O(^TMP("TIU",$J,GMTSI,GMTSJ)) Q:+GMTSJ'>0  D
"RTN","GMTSDS",12,0)
 . . D WRTREC(GMTSI,GMTSJ)
"RTN","GMTSDS",13,0)
 . . D WRTTEXT(GMTSI,GMTSJ)
"RTN","GMTSDS",14,0)
 . . I $D(^TMP("TIU",$J,GMTSI,GMTSJ,1601,"I")) D AMENDMNT^GMTSPN1(GMTSI,GMTSJ)
"RTN","GMTSDS",15,0)
 . . I $D(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD")) D ADDEND^GMTSPN1(GMTSI,GMTSJ)
"RTN","GMTSDS",16,0)
 K ^TMP("TIU",$J)
"RTN","GMTSDS",17,0)
 Q
"RTN","GMTSDS",18,0)
WRTREC(GMTSI,GMTSJ) ; Writes record header
"RTN","GMTSDS",19,0)
 N ADMIT,DISCHG,AUTHOR,ATTNDNG,TSPEC,STATUS,X
"RTN","GMTSDS",20,0)
 S GMTSCNT=+$G(GMTSCNT)+1
"RTN","GMTSDS",21,0)
 S X=^TMP("TIU",$J,GMTSI,GMTSJ,.07,"I") D REGDT4^GMTSU S ADMIT=X
"RTN","GMTSDS",22,0)
 S X=^TMP("TIU",$J,GMTSI,GMTSJ,.08,"I") D REGDT4^GMTSU S DISCHG=X
"RTN","GMTSDS",23,0)
 S:+DISCHG'>0 DISCHG="Present"
"RTN","GMTSDS",24,0)
 S AUTHOR=^TMP("TIU",$J,GMTSI,GMTSJ,1202,"E")
"RTN","GMTSDS",25,0)
 S ATTNDNG=^TMP("TIU",$J,GMTSI,GMTSJ,1209,"E")
"RTN","GMTSDS",26,0)
 S TSPEC=^TMP("TIU",$J,GMTSI,GMTSJ,1402,"E")
"RTN","GMTSDS",27,0)
 S STATUS=^TMP("TIU",$J,GMTSI,GMTSJ,.05,"E")
"RTN","GMTSDS",28,0)
 I GMTSCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDS",29,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ADMIT,?12,"-",?14,DISCHG,?56,"Status: ",STATUS,!
"RTN","GMTSDS",30,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"Last Tr Specialty: ",TSPEC,?49,"Dict'd By: ",AUTHOR,!
"RTN","GMTSDS",31,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?47,"Approved By: ",ATTNDNG,!
"RTN","GMTSDS",32,0)
 Q
"RTN","GMTSDS",33,0)
WRTTEXT(GMTSI,GMTSJ) ; Write Discharge Summary text
"RTN","GMTSDS",34,0)
 N GMTSK S GMTSK=0
"RTN","GMTSDS",35,0)
 F  S GMTSK=$O(^TMP("TIU",$J,GMTSI,GMTSJ,"TEXT",GMTSK)) Q:+GMTSK'>0  D
"RTN","GMTSDS",36,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W $G(^TMP("TIU",$J,GMTSI,GMTSJ,"TEXT",GMTSK,0)),!
"RTN","GMTSDS",37,0)
 Q
"RTN","GMTSDSB")
0^15^B3395963
"RTN","GMTSDSB",1,0)
GMTSDSB ; SLC/JER,KER - Brief Discharge Summary ; 11/02/1998
"RTN","GMTSDSB",2,0)
 ;;2.7;Health Summary;**12,28**;Feb 28, 1996
"RTN","GMTSDSB",3,0)
MAIN ; Control branching
"RTN","GMTSDSB",4,0)
 N GMTSI,GMTSJ,GMTSREC
"RTN","GMTSDSB",5,0)
 K ^TMP("TIU",$J)
"RTN","GMTSDSB",6,0)
 D MAIN^TIULAPIC(DFN,244,GMTS1,GMTS2,GMTSNDM,0)
"RTN","GMTSDSB",7,0)
 I '$D(^TMP("TIU",$J)) Q
"RTN","GMTSDSB",8,0)
 D WRTHDR
"RTN","GMTSDSB",9,0)
 S GMTSI=0
"RTN","GMTSDSB",10,0)
 F  S GMTSI=$O(^TMP("TIU",$J,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSDSB",11,0)
 . S GMTSJ=0
"RTN","GMTSDSB",12,0)
 . F  S GMTSJ=$O(^TMP("TIU",$J,GMTSI,GMTSJ)) Q:+GMTSJ'>0  D
"RTN","GMTSDSB",13,0)
 . . D WRTREC(GMTSI,GMTSJ)
"RTN","GMTSDSB",14,0)
 Q
"RTN","GMTSDSB",15,0)
WRTHDR ; Writes Header for new pages
"RTN","GMTSDSB",16,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Admitted",?11,"Disch'd",?21,"Dictated By",?36,"Approved By",?51,"Cosigned",?61,"Status",!!
"RTN","GMTSDSB",17,0)
 Q
"RTN","GMTSDSB",18,0)
WRTREC(GMTSI,GMTSJ) ; Writes record header
"RTN","GMTSDSB",19,0)
 N ADMIT,DISCHG,AUTHOR,ATTNDNG,COSIG,TSPEC,STATUS,X
"RTN","GMTSDSB",20,0)
 S X=^TMP("TIU",$J,GMTSI,GMTSJ,.07,"I") D REGDT4^GMTSU S ADMIT=X
"RTN","GMTSDSB",21,0)
 S X=^TMP("TIU",$J,GMTSI,GMTSJ,.08,"I") D REGDT4^GMTSU S DISCHG=X
"RTN","GMTSDSB",22,0)
 S AUTHOR=$E(^TMP("TIU",$J,GMTSI,GMTSJ,1202,"E"),1,13)
"RTN","GMTSDSB",23,0)
 S:+DISCHG'>0 DISCHG="Present"
"RTN","GMTSDSB",24,0)
 S ATTNDNG=$E(^TMP("TIU",$J,GMTSI,GMTSJ,1209,"E"),1,13)
"RTN","GMTSDSB",25,0)
 S TSPEC=^TMP("TIU",$J,GMTSI,GMTSJ,1402,"E")
"RTN","GMTSDSB",26,0)
 S STATUS=^TMP("TIU",$J,GMTSI,GMTSJ,.05,"E")
"RTN","GMTSDSB",27,0)
 S COSIG=$$DATE^TIULS(^TMP("TIU",$J,GMTSI,GMTSJ,1507,"I"),"MM/DD/YY")
"RTN","GMTSDSB",28,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR W ADMIT,?12,DISCHG,?24,AUTHOR,?39,ATTNDNG,?54,COSIG,?64,STATUS,!
"RTN","GMTSDSB",29,0)
 Q
"RTN","GMTSDVR")
0^69^B31496566
"RTN","GMTSDVR",1,0)
GMTSDVR ; SLC/JER,KER - Health Summary Driver ; 11/02/1998
"RTN","GMTSDVR",2,0)
 ;;2.7;Health Summary;**6,16,27,28**;Oct 20, 1995
"RTN","GMTSDVR",3,0)
MAIN ; Control branching
"RTN","GMTSDVR",4,0)
 N C,I,GMTYP,VADM,VAROOT,ZTRTN,GMPSAP
"RTN","GMTSDVR",5,0)
 K DIROUT,DUOUT
"RTN","GMTSDVR",6,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!($D(GMTYP)'>9)
"RTN","GMTSDVR",7,0)
 . D SELTYP Q:$D(DUOUT)!$D(DIROUT)!($D(GMTYP)'>9)
"RTN","GMTSDVR",8,0)
 . N GMPAT,GMP
"RTN","GMTSDVR",9,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)!(+($G(ORVP))>0)
"RTN","GMTSDVR",10,0)
 . . K GMP,GMPAT
"RTN","GMTSDVR",11,0)
 . . I +($G(ORVP)) S GMPAT(1)=+($G(ORVP))
"RTN","GMTSDVR",12,0)
 . . E  F  Q:$D(DIROUT)  K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP D PATIENT^ORU1(.GMP),PATCOPY(.GMP,.GMPAT) Q:$S($D(DUOUT):1,$D(DIROUT):1,'+$G(GMP):1,$P($G(^VA(200,DUZ,100.1)),U,6)]"":1,1:0)  D
"RTN","GMTSDVR",13,0)
 . . . W !!,"Another patient(s) can be selected."
"RTN","GMTSDVR",14,0)
 . . Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTSDVR",15,0)
 . . N GMTSPX1,GMTSPX2
"RTN","GMTSDVR",16,0)
 . . I +$G(GMRANGE)>0 D GETRANGE^GMTSU(.GMTSPX2,.GMTSPX1) Q:$G(GMTSPX1)=""!($G(GMTSPX2)="")
"RTN","GMTSDVR",17,0)
 . . Q:$D(DUOUT)!$D(DIROUT)
"RTN","GMTSDVR",18,0)
 . . D RESUB(.GMPAT)
"RTN","GMTSDVR",19,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)
"RTN","GMTSDVR",20,0)
 . . S ZTRTN="PQ^GMTSDVR"
"RTN","GMTSDVR",21,0)
 . . D HSOUT
"RTN","GMTSDVR",22,0)
 K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP")
"RTN","GMTSDVR",23,0)
 Q
"RTN","GMTSDVR",24,0)
PATCOPY(GMP,GMPAT) ;Copies patients retrieved from ^ORU1 in GMP array
"RTN","GMTSDVR",25,0)
 ;                to GMPAT array
"RTN","GMTSDVR",26,0)
 N IFN,GMDFN
"RTN","GMTSDVR",27,0)
 S IFN=0
"RTN","GMTSDVR",28,0)
 ; GMPAT(NAME,GMDFN) - want array in alphabetic order by patient
"RTN","GMTSDVR",29,0)
 F  S IFN=$O(GMP(IFN)) Q:IFN'>0  D
"RTN","GMTSDVR",30,0)
 . S GMDFN=+$G(GMP(IFN))
"RTN","GMTSDVR",31,0)
 . ; Getting name from ^DPT because name returned from ^ORUS sometimes
"RTN","GMTSDVR",32,0)
 . ; has trailing spaces which could allow duplicate recs for a patient
"RTN","GMTSDVR",33,0)
 . S GMPAT($P($G(^DPT(GMDFN,0)),U),+GMDFN)=+GMDFN
"RTN","GMTSDVR",34,0)
 Q
"RTN","GMTSDVR",35,0)
RESUB(GMP) ;Subscripts in GMP array are convert to one numeric subscript.
"RTN","GMTSDVR",36,0)
 ;        Done inorder to have GMP array in alphabetic order by patient.
"RTN","GMTSDVR",37,0)
 N NAME,GMDFN,CNT
"RTN","GMTSDVR",38,0)
 S CNT=0,NAME=""
"RTN","GMTSDVR",39,0)
 F  S NAME=$O(GMP(NAME)) Q:NAME']""  D
"RTN","GMTSDVR",40,0)
 . S GMDFN=0
"RTN","GMTSDVR",41,0)
 . F  S GMDFN=$O(GMP(NAME,GMDFN)) Q:GMDFN'>0  D
"RTN","GMTSDVR",42,0)
 . . S CNT=CNT+1
"RTN","GMTSDVR",43,0)
 . . S GMP(CNT)=GMP(NAME,GMDFN)
"RTN","GMTSDVR",44,0)
 . . K GMP(NAME,GMDFN)
"RTN","GMTSDVR",45,0)
 Q
"RTN","GMTSDVR",46,0)
ENXQ ; External call for tasked HS print
"RTN","GMTSDVR",47,0)
 ; Input: GMTSTYP=Record # of HS type in file 142
"RTN","GMTSDVR",48,0)
 ;            DFN=Record # of patient in file 2
"RTN","GMTSDVR",49,0)
 ;        GMTSPX1=Optional internal FM date for range ending date
"RTN","GMTSDVR",50,0)
 ;        GMTSPX2=Optional internal FM date for range beginning date
"RTN","GMTSDVR",51,0)
 ;  NOTE: Optional date range variables are both required if a date range
"RTN","GMTSDVR",52,0)
 ;        is desired.
"RTN","GMTSDVR",53,0)
 ; To call from TaskMan:
"RTN","GMTSDVR",54,0)
 ;        S ZTRTN="ENXQ^GMTSDVR",ZTSAVE("GMTSTYP")="",ZTSAVE("DFN")=""
"RTN","GMTSDVR",55,0)
 ;        D ^%ZTLOAD
"RTN","GMTSDVR",56,0)
 D ENX(DFN,GMTSTYP,$G(GMTSPX2),$G(GMTSPX1))
"RTN","GMTSDVR",57,0)
 Q
"RTN","GMTSDVR",58,0)
ENX(DFN,GMTSTYP,GMTSPX2,GMTSPX1) ; External call to print a Health Summary
"RTN","GMTSDVR",59,0)
 ; call with: GMTSTYP=HEALTH SUMMARY TYPE file record number
"RTN","GMTSDVR",60,0)
 ;                DFN=PATIENT file record number
"RTN","GMTSDVR",61,0)
 ;
"RTN","GMTSDVR",62,0)
 ;            GMTSPX1=Optional internal FM date for range ending date
"RTN","GMTSDVR",63,0)
 ;            GMTSPX2=Optional internal FM date for range beginning date
"RTN","GMTSDVR",64,0)
 ;  NOTE: Optional date range variables are both required if a date range
"RTN","GMTSDVR",65,0)
 ;        is desired.
"RTN","GMTSDVR",66,0)
 N DI,DX,DY,GMQUIT,GMTYP,GMPAT,VADM,VAIN,VAROOT
"RTN","GMTSDVR",67,0)
 F  Q:($D(^GMT(142,+GMTSTYP,1))>9)&$D(^DPT(DFN))!+$G(GMQUIT)  D
"RTN","GMTSDVR",68,0)
 . I $D(^GMT(142,+GMTSTYP,1))'>9 D
"RTN","GMTSDVR",69,0)
 . . I $D(ZTQUEUED) S GMQUIT=1 Q
"RTN","GMTSDVR",70,0)
 . . W !?3,"Invalid HEALTH SUMMARY TYPE." D SELTYP S GMTSTYP=+$G(GMTYP(1))
"RTN","GMTSDVR",71,0)
 . I '$D(^DPT(DFN)) D
"RTN","GMTSDVR",72,0)
 . . I $D(ZTQUEUED) S GMQUIT=1 Q
"RTN","GMTSDVR",73,0)
 . . W !?3,"Invalid PATIENT ID." D PATIENT^ORU1(.GMPAT) S DFN=+$G(GMPAT(1))
"RTN","GMTSDVR",74,0)
 Q:+$G(GMQUIT)
"RTN","GMTSDVR",75,0)
 S:$D(GMTYP)'>9 GMTYP(0)=1,GMTYP(1)=+$G(GMTSTYP)_U_$P($G(^GMT(142,+GMTSTYP,0)),U)
"RTN","GMTSDVR",76,0)
 S:$D(GMPAT)'>9 GMPAT=1,GMPAT(0)=1,GMPAT(1)=DFN_U_$P($G(^DPT(DFN,0)),U)
"RTN","GMTSDVR",77,0)
 D PQ
"RTN","GMTSDVR",78,0)
 Q
"RTN","GMTSDVR",79,0)
SELTYP ; Select Health Summary Type(s)
"RTN","GMTSDVR",80,0)
 N DIC,X,Y
"RTN","GMTSDVR",81,0)
 S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEMQZ"
"RTN","GMTSDVR",82,0)
 S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTSDVR",83,0)
 I $D(GMTYP)<10 S DIC("B")=$S($D(^DISV(DUZ,"^GMT(142,"))=10:$G(^DISV(DUZ,"^GMT(142,",$O(^("^GMT(142,",0)))),1:$P($G(^GMT(142,+$G(^DISV(DUZ,"^GMT(142,")),0)),U))
"RTN","GMTSDVR",84,0)
 K GMTYP D ^DIC Q:+Y'>0
"RTN","GMTSDVR",85,0)
 I $S($D(^GMT(142,+Y,1,0))=0:1,$O(^(0))'>0:1,1:0) W !,"The Summary Type "_$P(Y,U,2)_" includes no components...Please choose another",! Q
"RTN","GMTSDVR",86,0)
 S GMTYP(0)=1,GMTYP(1)=Y_U_$P(Y,U,2)_U_$P(Y,U,2)_U_$P(Y,U,2)
"RTN","GMTSDVR",87,0)
 Q
"RTN","GMTSDVR",88,0)
PQ ; Queued subroutine for HS by patient
"RTN","GMTSDVR",89,0)
 N DFN,GMTI,GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPNM
"RTN","GMTSDVR",90,0)
 N GMTSRB,GMTSSN,GMTSTOF,GMTSTYP,GMTSTITL,GMTSWARD,GMTJ,I,IX0,J,M4,P17,SEX
"RTN","GMTSDVR",91,0)
 N GMTSPHDR,TRFAC,VAERR,VAIN
"RTN","GMTSDVR",92,0)
 S GMTI=0 F  S GMTI=$O(GMTYP(GMTI)) Q:GMTI'>0!$D(DIROUT)  D
"RTN","GMTSDVR",93,0)
 .N GMTSEG,GMTSEGC,GMTSEGI
"RTN","GMTSDVR",94,0)
 .S GMTSTYP=+$G(GMTYP(GMTI)),GMTSTITL=$G(^GMT(142,+GMTSTYP,"T"))
"RTN","GMTSDVR",95,0)
 .S:'$L(GMTSTITL) GMTSTITL=$P(GMTYP(GMTI),U,2)
"RTN","GMTSDVR",96,0)
 .D LOADSEG
"RTN","GMTSDVR",97,0)
 .S GMTJ=0 F  S GMTJ=$O(GMPAT(GMTJ)) Q:GMTJ'>0!$D(DIROUT)  D
"RTN","GMTSDVR",98,0)
 . . S DFN=+$G(GMPAT(GMTJ))
"RTN","GMTSDVR",99,0)
 . . N GMDUOUT
"RTN","GMTSDVR",100,0)
 . . D EN^GMTS1
"RTN","GMTSDVR",101,0)
 . . Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTSDVR",102,0)
 . . D ACTPROF^GMTSDVR(DFN)
"RTN","GMTSDVR",103,0)
 Q
"RTN","GMTSDVR",104,0)
LOADSEG ;LOAD ENABLED COMPONENTS INTO GMTSEG ARRAY
"RTN","GMTSDVR",105,0)
 N GMTI,GMTJ,GMX
"RTN","GMTSDVR",106,0)
 S (GMTI,GMTJ)=0 F  S GMTJ=$O(^GMT(142,GMTSTYP,1,GMTJ)) Q:GMTJ'>0  S GMX=^(GMTJ,0) D
"RTN","GMTSDVR",107,0)
 .S GMTI=GMTI+1,GMTSEG(GMTI)=GMX,GMTSEGI($P(GMX,U,2))=GMTI D SELFILE
"RTN","GMTSDVR",108,0)
 S GMTSEGC=GMTI
"RTN","GMTSDVR",109,0)
 Q
"RTN","GMTSDVR",110,0)
SELFILE ; Get Selection item information for GMTSEG(
"RTN","GMTSDVR",111,0)
 N GMTK,ITEM,FST
"RTN","GMTSDVR",112,0)
 S GMTK=0,FST=1
"RTN","GMTSDVR",113,0)
 F  S GMTK=$O(^GMT(142,GMTSTYP,1,GMTJ,1,GMTK)) Q:GMTK'>0  S ITEM=^(GMTK,0),GMTSEG(GMTI,+$P(@(U_$P(ITEM,";",2)_"0)"),U,2),GMTK)=$P(ITEM,";") I $G(FST) S GMTSEG(GMTI,+$P(@(U_$P(ITEM,";",2)_"0)"),U,2),0)=U_$P(ITEM,";",2) K FST
"RTN","GMTSDVR",114,0)
 Q
"RTN","GMTSDVR",115,0)
HSOUT ; Output summary, with device control
"RTN","GMTSDVR",116,0)
 ; Call with: ZTRTN
"RTN","GMTSDVR",117,0)
 I $D(^XUSEC("GMTS VIEW ONLY",DUZ)) D @ZTRTN Q
"RTN","GMTSDVR",118,0)
 N %ZIS,IOP
"RTN","GMTSDVR",119,0)
 S %ZIS="PQ" D ^%ZIS Q:POP
"RTN","GMTSDVR",120,0)
 G:$D(IO("Q")) QUE
"RTN","GMTSDVR",121,0)
NOQUE D @ZTRTN
"RTN","GMTSDVR",122,0)
 D ^%ZISC
"RTN","GMTSDVR",123,0)
 Q
"RTN","GMTSDVR",124,0)
QUE ; Queue output
"RTN","GMTSDVR",125,0)
 N %,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTSK
"RTN","GMTSDVR",126,0)
 Q:'$D(ZTRTN)  K IO("Q"),ZTSAVE F %="DFN","GM*","ENTRY","O*" S ZTSAVE(%)=""
"RTN","GMTSDVR",127,0)
 S ZTDESC="HEALTH SUMMARY",ZTIO=ION
"RTN","GMTSDVR",128,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","GMTSDVR",129,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","GMTSDVR",130,0)
 S IOP="HOME" D ^%ZIS
"RTN","GMTSDVR",131,0)
 Q
"RTN","GMTSDVR",132,0)
ACTPROF(GMDFN) ; Check & print Action Profile for patient if +$G(GMPSAP)
"RTN","GMTSDVR",133,0)
 N DFN,PSTYPE,PSONOPG,PSOPAR,PSOINST
"RTN","GMTSDVR",134,0)
 I +$G(GMPSAP) D
"RTN","GMTSDVR",135,0)
 . S (PSTYPE,PSONOPG)=1,DFN=GMDFN
"RTN","GMTSDVR",136,0)
 . S $P(PSOPAR,U)=$S($P($G(^GMT(142.99,1,0)),U,5)="Y":1,1:0)
"RTN","GMTSDVR",137,0)
 . S PSOINST=$S(+$G(PSOINST):PSOINST,1:+$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),U,17),99)),U))
"RTN","GMTSDVR",138,0)
 . D DFN^PSOSD1
"RTN","GMTSDVR",139,0)
 . S DFN=GMDFN ;Have to reset DFN because ^PSOSD1 call kills it and it is
"RTN","GMTSDVR",140,0)
 . ; needed for the ^GMTSPL call.
"RTN","GMTSDVR",141,0)
 . D PAGE^GMTSPL
"RTN","GMTSFH")
0^16^B20600728
"RTN","GMTSFH",1,0)
GMTSFH ; SLC/JER,MKB,KER - Dietetics Component ; 11/02/1998
"RTN","GMTSFH",2,0)
 ;;2.7;Health Summary;**25,28**;Oct 20, 1995
"RTN","GMTSFH",3,0)
MAIN ; Controls branching and execution
"RTN","GMTSFH",4,0)
 N GMI
"RTN","GMTSFH",5,0)
 I '$D(GMTSNDM) S GMTSNDM=999
"RTN","GMTSFH",6,0)
 I $D(GMTSNDM),GMTSNDM<0 S GMTSNDM=999
"RTN","GMTSFH",7,0)
 D ^FHWHEA I '$D(^UTILITY($J)) Q
"RTN","GMTSFH",8,0)
 F GMI="DI","NS","SF","TF","EN" D @GMI
"RTN","GMTSFH",9,0)
 K ^UTILITY($J),STR,COL,TX,STRT,STP,CNTR
"RTN","GMTSFH",10,0)
 Q
"RTN","GMTSFH",11,0)
DI ; Diet Orders
"RTN","GMTSFH",12,0)
 S CNTR=GMTSNDM
"RTN","GMTSFH",13,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "DIETS:",!
"RTN","GMTSFH",14,0)
 I '$D(^UTILITY($J,"DI")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "No diet orders available.",! Q
"RTN","GMTSFH",15,0)
 N GMW,GMIDT
"RTN","GMTSFH",16,0)
 S GMIDT=GMTS1 F  S GMIDT=$O(^UTILITY($J,"DI",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D DIWRT
"RTN","GMTSFH",17,0)
 Q
"RTN","GMTSFH",18,0)
DIWRT ; Writes Diet Orders
"RTN","GMTSFH",19,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",20,0)
 N GMZ S GMZ=^UTILITY($J,"DI",GMIDT,0)
"RTN","GMTSFH",21,0)
 S X=+$P(GMZ,U) D REGDT4^GMTSU S STRT=X
"RTN","GMTSFH",22,0)
 I $P(GMZ,U,2)="" S STP="Present"
"RTN","GMTSFH",23,0)
 E  S X=+$P(GMZ,U,2) D REGDT4^GMTSU S STP=X
"RTN","GMTSFH",24,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W STRT_" - "_STP,?25
"RTN","GMTSFH",25,0)
 S STR=$S($P(GMZ,U,3)'="":$P(GMZ,U,3),1:"No diet orders on file.")
"RTN","GMTSFH",26,0)
 I $L(STR)<40 W STR
"RTN","GMTSFH",27,0)
 E  S COL=27 D WRAP
"RTN","GMTSFH",28,0)
 W:$P(GMZ,U,5)'="" ?61,"("_$P(GMZ,U,5)_")" W !
"RTN","GMTSFH",29,0)
 I $P(GMZ,U,4)'="" D DICOM
"RTN","GMTSFH",30,0)
 Q
"RTN","GMTSFH",31,0)
DICOM ; Writes comments for DI
"RTN","GMTSFH",32,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "           Comments: "
"RTN","GMTSFH",33,0)
 I $L($P(GMZ,U,4))<55 W $P(GMZ,U,4),!
"RTN","GMTSFH",34,0)
 E  S STR=$P(GMZ,U,4),COL=45 D WRAP W !
"RTN","GMTSFH",35,0)
 Q
"RTN","GMTSFH",36,0)
NS ; Nutritional status
"RTN","GMTSFH",37,0)
 I '$D(^UTILITY($J,"NS")) Q
"RTN","GMTSFH",38,0)
 S CNTR=GMTSNDM
"RTN","GMTSFH",39,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"NUTRITIONAL STATUS:",!
"RTN","GMTSFH",40,0)
 N GMW,GMIDT
"RTN","GMTSFH",41,0)
 S GMIDT=GMTS1 F  S GMIDT=$O(^UTILITY($J,"NS",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D NSWRT
"RTN","GMTSFH",42,0)
 Q
"RTN","GMTSFH",43,0)
NSWRT ; Writes Nutritional Status
"RTN","GMTSFH",44,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",45,0)
 N GMZ S GMZ=^UTILITY($J,"NS",GMIDT,0)
"RTN","GMTSFH",46,0)
 S X=+$P(GMZ,U) D REGDTM4^GMTSU S STRT=X
"RTN","GMTSFH",47,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSFH",48,0)
 W STRT,?21,$S($P(GMZ,U,2)'="":$P(GMZ,U,2),1:"No status on file."),!
"RTN","GMTSFH",49,0)
 Q
"RTN","GMTSFH",50,0)
SF ; Supplemental feeding
"RTN","GMTSFH",51,0)
 I '$D(^UTILITY($J,"SF")) Q
"RTN","GMTSFH",52,0)
 S CNTR=GMTSNDM
"RTN","GMTSFH",53,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"SUPPLEMENTAL FEEDINGS:",!
"RTN","GMTSFH",54,0)
 N GMW,GMIDT
"RTN","GMTSFH",55,0)
 S GMIDT=GMTS1 F  S GMIDT=$O(^UTILITY($J,"SF",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D SFWRT
"RTN","GMTSFH",56,0)
 Q
"RTN","GMTSFH",57,0)
SFWRT ; Writes Supplemental Feedings
"RTN","GMTSFH",58,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",59,0)
 N GMZ S GMZ=^UTILITY($J,"SF",GMIDT,0)
"RTN","GMTSFH",60,0)
 S X=+$P(GMZ,U) D REGDT4^GMTSU S STRT=X
"RTN","GMTSFH",61,0)
 I $P(GMZ,U,2)="" S STP="Present"
"RTN","GMTSFH",62,0)
 E  S X=+$P(GMZ,U,2) D REGDT4^GMTSU S STP=X
"RTN","GMTSFH",63,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W STRT_" - "_STP,!
"RTN","GMTSFH",64,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14,"10 Am  " S STR=$S($P(GMZ,U,3)'="":$P(GMZ,U,3),1:"No order")
"RTN","GMTSFH",65,0)
 I $L(STR)<55 W STR,!
"RTN","GMTSFH",66,0)
 E  S COL=45 D WRAP W !
"RTN","GMTSFH",67,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14," 2 Pm  " S STR=$S($P(GMZ,U,4)'="":$P(GMZ,U,4),1:"No order")
"RTN","GMTSFH",68,0)
 I $L(STR)<55 W STR,!
"RTN","GMTSFH",69,0)
 E  S COL=45 D WRAP W !
"RTN","GMTSFH",70,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14," 8 Pm  " S STR=$S($P(GMZ,U,5)'="":$P(GMZ,U,5),1:"No order")
"RTN","GMTSFH",71,0)
 I $L(STR)<55 W STR,!
"RTN","GMTSFH",72,0)
 E  S COL=45 D WRAP W !
"RTN","GMTSFH",73,0)
 Q
"RTN","GMTSFH",74,0)
TF ; Tubefeeding
"RTN","GMTSFH",75,0)
 I '$D(^UTILITY($J,"TF")) Q
"RTN","GMTSFH",76,0)
 S CNTR=GMTSNDM
"RTN","GMTSFH",77,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"TUBE FEEDINGS:",!
"RTN","GMTSFH",78,0)
 N GMW,GMIDT
"RTN","GMTSFH",79,0)
 S GMIDT=GMTS1 F  S GMIDT=$O(^UTILITY($J,"TF",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D TFWRT
"RTN","GMTSFH",80,0)
 Q
"RTN","GMTSFH",81,0)
TFWRT ; Writes tubefeeding
"RTN","GMTSFH",82,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",83,0)
 N GMZ S GMZ=^UTILITY($J,"TF",GMIDT,0)
"RTN","GMTSFH",84,0)
 S X=+$P(GMZ,U) D REGDT4^GMTSU S STRT=X
"RTN","GMTSFH",85,0)
 I $P(GMZ,U,2)="" S STP="Present"
"RTN","GMTSFH",86,0)
 E  S X=+$P(GMZ,U,2) D REGDT4^GMTSU S STP=X
"RTN","GMTSFH",87,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W STRT_" - "_STP,!
"RTN","GMTSFH",88,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Product: ",$P(GMZ,U,3),!
"RTN","GMTSFH",89,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Strength: ",$P(GMZ,U,4),?51,"Quantity: ",$P(GMZ,U,5),!
"RTN","GMTSFH",90,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Daily CC's: ",$P(GMZ,U,6),?47,"Daily KCal's: ",$P(GMZ,U,7),!
"RTN","GMTSFH",91,0)
 I $P(GMZ,U,8)'="" D TFCOM
"RTN","GMTSFH",92,0)
 Q
"RTN","GMTSFH",93,0)
TFCOM ; Writes comments for TF
"RTN","GMTSFH",94,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Comments: "
"RTN","GMTSFH",95,0)
 I $L($P(GMZ,U,8))<55 W $P(GMZ,U,8),!
"RTN","GMTSFH",96,0)
 E  S STR=$P(GMZ,U,8),COL=45 D WRAP W !
"RTN","GMTSFH",97,0)
 Q
"RTN","GMTSFH",98,0)
WRAP ; Controls wrap-around feature for comments, etc.
"RTN","GMTSFH",99,0)
 S TX=$F(STR," ",COL) W $E(STR,1,TX-1),!
"RTN","GMTSFH",100,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$E(STR,TX,$L(STR))
"RTN","GMTSFH",101,0)
 Q
"RTN","GMTSFH",102,0)
EN ; Dietetic Encounters
"RTN","GMTSFH",103,0)
 S CNTR=GMTSNDM
"RTN","GMTSFH",104,0)
 Q:'$D(^UTILITY($J,"EN"))
"RTN","GMTSFH",105,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"DIETETIC ENCOUNTERS:",!
"RTN","GMTSFH",106,0)
 N GMW,GMIDT
"RTN","GMTSFH",107,0)
 S GMIDT=GMTS1
"RTN","GMTSFH",108,0)
 F  S GMIDT=$O(^UTILITY($J,"EN",GMIDT)) Q:(GMIDT'>0)!(GMIDT>GMTS2)  D
"RTN","GMTSFH",109,0)
 . S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSFH",110,0)
 . N GMZ
"RTN","GMTSFH",111,0)
 . S GMZ=^UTILITY($J,"EN",GMIDT,0)
"RTN","GMTSFH",112,0)
 . S X=+$P(GMZ,U) D REGDT4^GMTSU S STRT=X
"RTN","GMTSFH",113,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W STRT,?12,$P(GMZ,U,2),!
"RTN","GMTSFH",114,0)
 . I $P(GMZ,U,3)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?6,$P(GMZ,U,3),!
"RTN","GMTSFH",115,0)
 . I $P(GMZ,U,4)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?6,$P(GMZ,U,4),!
"RTN","GMTSFH",116,0)
 Q
"RTN","GMTSLRA")
0^17^B15129014
"RTN","GMTSLRA",1,0)
GMTSLRA ; SLC/JER,KER/NDBI - Surgical Pathology Component ; 11/02/1998
"RTN","GMTSLRA",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSLRA",3,0)
MAIN N GMI,MAX,LRDFN,IX,X,IX0
"RTN","GMTSLRA",4,0)
 I $$ROK^GMTSU("A7RHSE"),$$NDBI^GMTSU,'$D(^DPT(DFN,"LR")),$D(^A7RHS("SP",DFN)) D LRDFN^A7RHSE(DFN)
"RTN","GMTSLRA",5,0)
 Q:'$D(^DPT(DFN,"LR"))
"RTN","GMTSLRA",6,0)
 S LRDFN=+^DPT(DFN,"LR") I $$NDBI^GMTSU,'$D(^LR(LRDFN)),'$D(^A7RHS("SP",DFN)) Q
"RTN","GMTSLRA",7,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLRA",8,0)
 E  S MAX=999
"RTN","GMTSLRA",9,0)
 D ^GMTSLRAE
"RTN","GMTSLRA",10,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) SP^A7RHSM
"RTN","GMTSLRA",11,0)
 I '$D(^TMP("LRA",$J)) Q
"RTN","GMTSLRA",12,0)
 S IX=0
"RTN","GMTSLRA",13,0)
 F GMI=1:1:MAX S IX=$O(^TMP("LRA",$J,IX)) Q:IX'>0  D:GMI>1 CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>1&('GMTSNPG) ! D
"RTN","GMTSLRA",14,0)
 .S IX0=""
"RTN","GMTSLRA",15,0)
 .F  S IX0=$O(^TMP("LRA",$J,IX,IX0)) Q:IX0=""!(IX0?1A)  S X=^TMP("LRA",$J,IX,IX0) D WRT
"RTN","GMTSLRA",16,0)
 . I $D(^TMP("LRA",$J,IX,1.2)) D SUPPR
"RTN","GMTSLRA",17,0)
 K ^TMP("LRA",$J)
"RTN","GMTSLRA",18,0)
 Q
"RTN","GMTSLRA",19,0)
WRT ; Writes Surgical Pathology Record
"RTN","GMTSLRA",20,0)
 N IX1,GMJ
"RTN","GMTSLRA",21,0)
 I IX0=0 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Collected:",?19,$P(X,U),?31,"Acc:",?36,$P(X,U,2),! Q
"RTN","GMTSLRA",22,0)
 I IX0=.1 D WRTSPC Q
"RTN","GMTSLRA",23,0)
 I $S(IX0=.2:1,IX0=1:1,IX0=1.1:1,IX0=1.3:1,IX0=1.4:1,1:0) D TEXT Q
"RTN","GMTSLRA",24,0)
 I IX0=2 S IX1=0 F  S IX1=$O(^TMP("LRA",$J,IX,IX0,IX1)) Q:IX1'>0  S X=^(IX1) D WRTTM,WRTP
"RTN","GMTSLRA",25,0)
 Q
"RTN","GMTSLRA",26,0)
WRTSPC ; Writes Specimen field entries
"RTN","GMTSLRA",27,0)
 N GMS
"RTN","GMTSLRA",28,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Specimen:"
"RTN","GMTSLRA",29,0)
 S GMS=0
"RTN","GMTSLRA",30,0)
 F  S GMS=$O(^TMP("LRA",$J,IX,.1,GMS)) Q:GMS'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?19,^TMP("LRA",$J,IX,.1,GMS),!
"RTN","GMTSLRA",31,0)
 Q
"RTN","GMTSLRA",32,0)
TEXT ; Handles GROSS DESCRIPTION & MICROSCOPIC EXAM/DX Print
"RTN","GMTSLRA",33,0)
 N LN,GMTSLN,GMTSLNI
"RTN","GMTSLRA",34,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?(17-$L(X)),X_":",!
"RTN","GMTSLRA",35,0)
 S LN=0
"RTN","GMTSLRA",36,0)
 F  S LN=$O(^TMP("LRA",$J,IX,IX0,LN)) Q:LN'>0  S GMTSLN=^(LN) D
"RTN","GMTSLRA",37,0)
 .I $L(GMTSLN)>78 S GMTSLN=$$WRAP^GMTSORC(GMTSLN,78)
"RTN","GMTSLRA",38,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSLN,"|"),! D
"RTN","GMTSLRA",39,0)
 ..F GMTSLNI=2:1:$L(GMTSLN,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSLN,"|",GMTSLNI)]"" $P(GMTSLN,"|",GMTSLNI),!
"RTN","GMTSLRA",40,0)
 Q
"RTN","GMTSLRA",41,0)
SUPPR ; Writes Supplementary Report
"RTN","GMTSLRA",42,0)
 N GMTSR,SRDATE,GMTSRL,GMTSRLI,X
"RTN","GMTSLRA",43,0)
 S IX1=0
"RTN","GMTSLRA",44,0)
 F  S IX1=$O(^TMP("LRA",$J,IX,1.2,IX1)) Q:IX1'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  S SRDATE=^TMP("LRA",$J,IX,1.2,IX1,0) S X=SRDATE D REGDTM4^GMTSU W "Supplementary Rpt: ",X,! D
"RTN","GMTSLRA",45,0)
 .S GMTSR=0
"RTN","GMTSLRA",46,0)
 .F  S GMTSR=$O(^TMP("LRA",$J,IX,1.2,IX1,GMTSR)) Q:GMTSR'>0  S GMTSRL=^(GMTSR) D
"RTN","GMTSLRA",47,0)
 ..I $L(GMTSRL)>78 S GMTSRL=$$WRAP^GMTSORC(GMTSRL,78)
"RTN","GMTSLRA",48,0)
 ..W $P(GMTSRL,"|"),! D
"RTN","GMTSLRA",49,0)
 ...F GMTSRLI=2:1:$L(GMTSRL,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSRL,"|",GMTSRLI)]"" $P(GMTSRL,"|",GMTSRLI),!
"RTN","GMTSLRA",50,0)
 Q
"RTN","GMTSLRA",51,0)
WRTTM ; Writes Topography and Morphology
"RTN","GMTSLRA",52,0)
 N GMT,GMD,GME
"RTN","GMTSLRA",53,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?7,"Topography:",?19,$P(X,U),!
"RTN","GMTSLRA",54,0)
 I $O(^TMP("LRA",$J,IX,IX0,IX1,1,0)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRA",55,0)
 S GMD=0
"RTN","GMTSLRA",56,0)
 F  S GMD=$O(^TMP("LRA",$J,IX,IX0,IX1,1,GMD)) Q:GMD'>0  W:GMD=1 ?9,"Disease:" W ?21,^TMP("LRA",$J,IX,IX0,IX1,1,GMD),! Q
"RTN","GMTSLRA",57,0)
 I $O(^TMP("LRA",$J,IX,IX0,IX1,2,0)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRA",58,0)
 S GMT=0
"RTN","GMTSLRA",59,0)
 F  S GMT=$O(^TMP("LRA",$J,IX,IX0,IX1,2,GMT)) Q:GMT'>0  D
"RTN","GMTSLRA",60,0)
 .I GMT'=4 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRA",61,0)
 .I  W ?7,"Morphology:",?21,^TMP("LRA",$J,IX,IX0,IX1,2,GMT),! D  Q
"RTN","GMTSLRA",62,0)
 ..S GME=0
"RTN","GMTSLRA",63,0)
 ..F  S GME=$O(^TMP("LRA",$J,IX,IX0,IX1,2,GMT,1,GME)) Q:GME'>0  D
"RTN","GMTSLRA",64,0)
 ...D CKP^GMTSUP Q:$D(GMTSQIT)  W:GME=1 ?9,"Etiology:" W ?23,^TMP("LRA",$J,IX,IX0,IX1,2,GMT,1,GME),! Q
"RTN","GMTSLRA",65,0)
 Q
"RTN","GMTSLRA",66,0)
WRTP ; Writes Procedure field
"RTN","GMTSLRA",67,0)
 N GMQ,GMK
"RTN","GMTSLRA",68,0)
 I $O(^TMP("LRA",$J,IX,IX0,IX1,4,0)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?7,"Procedures:"
"RTN","GMTSLRA",69,0)
 S GMT=0
"RTN","GMTSLRA",70,0)
 F  S GMT=$O(^TMP("LRA",$J,IX,IX0,IX1,4,GMT)) Q:GMT'>0  D
"RTN","GMTSLRA",71,0)
 .S GMQ=$P(^TMP("LRA",$J,IX,IX0,IX1,4,GMT),U)
"RTN","GMTSLRA",72,0)
 .I $L(GMQ)>56 S GMQ=$$WRAP^GMTSORC(GMQ,56)
"RTN","GMTSLRA",73,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$P(GMQ,"|"),! D
"RTN","GMTSLRA",74,0)
 ..F GMK=2:1:$L(GMQ,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMQ,"|",GMK)]"" ?23,$P(GMQ,"|",GMK),!
"RTN","GMTSLRA",75,0)
 Q
"RTN","GMTSLRAE")
0^18^B24037533
"RTN","GMTSLRAE",1,0)
GMTSLRAE ; SLC/JER,KER - Surgical Pathology Extract ; 11/02/1998
"RTN","GMTSLRAE",2,0)
 ;;2.7;Health Summary;**3,28**;Oct 20, 1995
"RTN","GMTSLRAE",3,0)
XTRCT N IX0,IX
"RTN","GMTSLRAE",4,0)
 K ^TMP("LRA",$J)
"RTN","GMTSLRAE",5,0)
 S IX=GMTS1 F IX0=1:0:MAX S IX=$O(^LR(LRDFN,"SP",IX)) Q:IX'>0!(IX>GMTS2)  D APSET
"RTN","GMTSLRAE",6,0)
 K AP
"RTN","GMTSLRAE",7,0)
 Q
"RTN","GMTSLRAE",8,0)
APSET ;Sets ^TMP("LRA",$J
"RTN","GMTSLRAE",9,0)
 N ACC,CDT,DA,DIC,DIQ,DR,GMW,SN,X,YR
"RTN","GMTSLRAE",10,0)
 S CDT=$P(^LR(LRDFN,"SP",IX,0),U),ACC=$P(^(0),U,6)
"RTN","GMTSLRAE",11,0)
 I $S(+$P(^LR(LRDFN,"SP",IX,0),U)'>0:1,+$P(^(0),U,11)'>0:1,1:0) Q
"RTN","GMTSLRAE",12,0)
 I $D(ACC) S IX0=IX0+1
"RTN","GMTSLRAE",13,0)
 S X=CDT D REGDTM4^GMTSU S CDT=X K X
"RTN","GMTSLRAE",14,0)
 S ^TMP("LRA",$J,IX,0)=CDT_U_ACC
"RTN","GMTSLRAE",15,0)
 I $D(^LR(LRDFN,"SP",IX,.1)) S ^TMP("LRA",$J,IX,.1)="Site/Specimen"
"RTN","GMTSLRAE",16,0)
 S SN=0 F  S SN=$O(^LR(LRDFN,"SP",IX,.1,SN)) Q:SN'>0  S ^TMP("LRA",$J,IX,.1,SN)=$P(^LR(LRDFN,"SP",IX,.1,SN,0),U)
"RTN","GMTSLRAE",17,0)
 I $D(^LR(LRDFN,"SP",IX,.2,0)),($P(^(0),U,3)]"") D CLHX
"RTN","GMTSLRAE",18,0)
 I $D(^LR(LRDFN,"SP",IX,1,0)),($P(^(0),U,3)]"") D GROSS
"RTN","GMTSLRAE",19,0)
 I $D(^LR(LRDFN,"SP",IX,1.1,0)),($P(^(0),U,3)]"") D MIC
"RTN","GMTSLRAE",20,0)
 I $D(^LR(LRDFN,"SP",IX,1.2,0)),($P(^(0),U,3)]"") D SUPPR
"RTN","GMTSLRAE",21,0)
 I $D(^LR(LRDFN,"SP",IX,1.3,0)),($P(^(0),U,3)]"") D FROZ
"RTN","GMTSLRAE",22,0)
 I $D(^LR(LRDFN,"SP",IX,1.4,0)),($P(^(0),U,3)]"") D SPDX
"RTN","GMTSLRAE",23,0)
 ;S DIC=63,DIQ="AP",DIQ(0)="E",DR(63.08)=10,DR(63.12)=".01;1.5;3;4"
"RTN","GMTSLRAE",24,0)
 ;S DR(63.16)=".01;1",DR(63.82)=.01,DR(63.17)=.01
"RTN","GMTSLRAE",25,0)
 ;S DA(63.12)=0,DA(63.08)=IX F  S DA(63.12)=$O(^LR(LRDFN,"SP",IX,2,DA(63.12))) Q:DA(63.12)=""  D M,P,D
"RTN","GMTSLRAE",26,0)
 Q
"RTN","GMTSLRAE",27,0)
M ;Morphology data
"RTN","GMTSLRAE",28,0)
 N AP
"RTN","GMTSLRAE",29,0)
 S DR=8,DA=LRDFN D EN^DIQ1 I $D(AP(63.12)) S ^TMP("LRA",$J,IX,2)="Topography Data",^(2,DA(63.12))=$S($D(AP(63.12,DA(63.12),.01,"E")):AP(63.12,DA(63.12),.01,"E"),1:"")
"RTN","GMTSLRAE",30,0)
 S DA(63.16)=0 F  S DA(63.16)=$O(^LR(LRDFN,"SP",IX,2,DA(63.12),2,DA(63.16))) Q:DA(63.16)=""  D EN^DIQ1 I $D(AP(63.16)) D MSET
"RTN","GMTSLRAE",31,0)
 K DA(63.16)
"RTN","GMTSLRAE",32,0)
 Q
"RTN","GMTSLRAE",33,0)
MSET S ^TMP("LRA",$J,IX,2,DA(63.12),2,DA(63.16))=$S($D(AP(63.16,DA(63.16),.01,"E")):AP(63.16,DA(63.16),.01,"E"),1:"") D
"RTN","GMTSLRAE",34,0)
 .S DA(63.17)=0 F  S DA(63.17)=$O(^LR(LRDFN,"SP",IX,2,DA(63.12),2,DA(63.16),1,DA(63.17))) Q:DA(63.17)=""  D EN^DIQ1 I $D(AP(63.17)) D
"RTN","GMTSLRAE",35,0)
 ..S ^TMP("LRA",$J,IX,2,DA(63.12),2,DA(63.16),1,DA(63.17))=$S($D(AP(63.17,DA(63.17),.01,"E")):AP(63.17,DA(63.17),.01,"E"),1:"")
"RTN","GMTSLRAE",36,0)
 K DA(63.17)
"RTN","GMTSLRAE",37,0)
 Q
"RTN","GMTSLRAE",38,0)
D ;Disease data
"RTN","GMTSLRAE",39,0)
 S DA(63.15)=0 F  S DA(63.15)=$O(^LR(LRDFN,"SP",IX,2,DA(63.12),1,DA(63.15))) Q:DA(63.15)=""  D EN^DIQ1 I $D(AP(63.15)) D
"RTN","GMTSLRAE",40,0)
 .S ^TMP("LRA",$J,IX,2,DA(63.12),1,DA(63.15))=$S($D(AP(63.15,DA(63.15),.01,"E")):AP(63.15,DA(63.15),.01,"E"),1:"")
"RTN","GMTSLRAE",41,0)
 K DA(63.15)
"RTN","GMTSLRAE",42,0)
 Q
"RTN","GMTSLRAE",43,0)
P ;Procedure data
"RTN","GMTSLRAE",44,0)
 N AP
"RTN","GMTSLRAE",45,0)
 S DA(63.82)=0
"RTN","GMTSLRAE",46,0)
 S DA(63.82)=0 F  S DR=8,DA=LRDFN,DA(63.82)=$O(^LR(LRDFN,"SP",IX,2,DA(63.12),4,DA(63.82))) Q:DA(63.82)=""  D EN^DIQ1 I $D(AP(63.82)) D PSET
"RTN","GMTSLRAE",47,0)
 K DA(63.82)
"RTN","GMTSLRAE",48,0)
 Q
"RTN","GMTSLRAE",49,0)
PSET S ^TMP("LRA",$J,IX,4)="Procedure Field"
"RTN","GMTSLRAE",50,0)
 S ^TMP("LRA",$J,IX,2,DA(63.12),4,DA(63.82))=$S($D(AP(63.82,DA(63.82),.01,"E")):AP(63.82,DA(63.82),.01,"E"),1:"")
"RTN","GMTSLRAE",51,0)
 Q
"RTN","GMTSLRAE",52,0)
CLHX ;Brief Clinical History text
"RTN","GMTSLRAE",53,0)
 N LN
"RTN","GMTSLRAE",54,0)
 S ^TMP("LRA",$J,IX,.2)="Brief Clinical Hx"
"RTN","GMTSLRAE",55,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"SP",IX,.2,LN)) Q:LN'>0  S X=^LR(LRDFN,"SP",IX,.2,LN,0) D FORMAT
"RTN","GMTSLRAE",56,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LRA",$J,IX,.2,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLRAE",57,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRAE",58,0)
 Q
"RTN","GMTSLRAE",59,0)
GROSS ;Gross Description text
"RTN","GMTSLRAE",60,0)
 N LN
"RTN","GMTSLRAE",61,0)
 S ^TMP("LRA",$J,IX,1)="Gross Description"
"RTN","GMTSLRAE",62,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"SP",IX,1,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"SP",IX,1,LN,0),U) D FORMAT
"RTN","GMTSLRAE",63,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LRA",$J,IX,1,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLRAE",64,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRAE",65,0)
 Q
"RTN","GMTSLRAE",66,0)
MIC ;Microscopic Exam/Diagnosis text
"RTN","GMTSLRAE",67,0)
 N LN
"RTN","GMTSLRAE",68,0)
 S ^TMP("LRA",$J,IX,1.1)="Microscopic Exam"
"RTN","GMTSLRAE",69,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"SP",IX,1.1,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"SP",IX,1.1,LN,0),U) D FORMAT
"RTN","GMTSLRAE",70,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LRA",$J,IX,1.1,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLRAE",71,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRAE",72,0)
 Q
"RTN","GMTSLRAE",73,0)
SUPPR ;Supplementary Report date/text
"RTN","GMTSLRAE",74,0)
 N SP1 S ^TMP("LRA",$J,IX,1.2)="Supplementary Report"
"RTN","GMTSLRAE",75,0)
 S SP1=0 F  S SP1=$O(^LR(LRDFN,"SP",IX,1.2,SP1)) Q:SP1'>0  D
"RTN","GMTSLRAE",76,0)
 . Q:+$P($G(^LR(LRDFN,"SP",IX,1.2,SP1,0)),U,2)'>0
"RTN","GMTSLRAE",77,0)
 . S ^TMP("LRA",$J,IX,1.2,SP1,0)=$P($G(^LR(LRDFN,"SP",IX,1.2,SP1,0)),U)
"RTN","GMTSLRAE",78,0)
 . K ^UTILITY($J,"W")
"RTN","GMTSLRAE",79,0)
 . S SR=0
"RTN","GMTSLRAE",80,0)
 . F  S SR=$O(^LR(LRDFN,"SP",IX,1.2,SP1,1,SR)) Q:SR'>0  D
"RTN","GMTSLRAE",81,0)
 . . S X=$P($G(^LR(LRDFN,"SP",IX,1.2,SP1,1,SR,0)),U) D FORMAT
"RTN","GMTSLRAE",82,0)
 . I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LRA",$J,IX,1.2,SP1,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLRAE",83,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRAE",84,0)
 Q
"RTN","GMTSLRAE",85,0)
FROZ ;Frozen Section text
"RTN","GMTSLRAE",86,0)
 N LN
"RTN","GMTSLRAE",87,0)
 S ^TMP("LRA",$J,IX,1.3)="Frozen Section"
"RTN","GMTSLRAE",88,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"SP",IX,1.3,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"SP",IX,1.3,LN,0),U) D FORMAT
"RTN","GMTSLRAE",89,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LRA",$J,IX,1.3,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLRAE",90,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRAE",91,0)
 Q
"RTN","GMTSLRAE",92,0)
SPDX ;Surgical Pathology DX text
"RTN","GMTSLRAE",93,0)
 N LN
"RTN","GMTSLRAE",94,0)
 S ^TMP("LRA",$J,IX,1.4)="Surgical Path Dx"
"RTN","GMTSLRAE",95,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"SP",IX,1.4,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"SP",IX,1.4,LN,0),U) D FORMAT
"RTN","GMTSLRAE",96,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LRA",$J,IX,1.4,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLRAE",97,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRAE",98,0)
 Q
"RTN","GMTSLRAE",99,0)
FORMAT ;Calls ^DIWP to format text
"RTN","GMTSLRAE",100,0)
 S DIWF="N",DIWL=3,DIWR=78 D ^DIWP
"RTN","GMTSLRAE",101,0)
 Q
"RTN","GMTSLRBE")
0^19^B3824443
"RTN","GMTSLRBE",1,0)
GMTSLRBE ; SLC/JER,KER - Blood Availability Extract ; 11/02/1998
"RTN","GMTSLRBE",2,0)
 ;;2.7;Health Summary;**17,28**;Oct 20, 1995
"RTN","GMTSLRBE",3,0)
 ;
"RTN","GMTSLRBE",4,0)
XTRCT N I1,UN,CNT
"RTN","GMTSLRBE",5,0)
 S CNT=0
"RTN","GMTSLRBE",6,0)
 K ^TMP("LRB",$J)
"RTN","GMTSLRBE",7,0)
 I $L($P(^LR(LRDFN,0),U,5,6)) S ^TMP("LRB",$J,0)=$P(^(0),U,5)_U_$P(^(0),U,6)
"RTN","GMTSLRBE",8,0)
 S UN="" F  S UN=$O(^LRD(65,"AP",LRDFN,UN)) Q:UN=""!(CNT'<MAX)  D BASET
"RTN","GMTSLRBE",9,0)
 Q
"RTN","GMTSLRBE",10,0)
BASET ; Sets ^TMP("LRB",$J, with data elements
"RTN","GMTSLRBE",11,0)
 N ADT,DA,DIC,DIQ,DON,DR,EFLG,EDT,UID,UDIV,DTYP,COMP,ABO,RH,VOL,XDT,XMR,XMATCH
"RTN","GMTSLRBE",12,0)
 N IDT,GMI,ULOC
"RTN","GMTSLRBE",13,0)
 S (ADT,EFLG,EDT,UID,DTYP,COMP,ABO,RH,VOL,XMR,ULOC)=""
"RTN","GMTSLRBE",14,0)
 S UID=$P(^LRD(65,UN,0),U),EDT=$P(^(0),U,6),ABO=$P(^(0),U,7),RH=$P(^(0),U,8),VOL=$P(^(0),U,11),COMP=$P(^LAB(66,$P(^LRD(65,UN,0),U,4),0),U)
"RTN","GMTSLRBE",15,0)
 S ADT=$P(^LRD(65,UN,2,LRDFN,0),U,2)
"RTN","GMTSLRBE",16,0)
 S UDIV=$P(^LRD(65,UN,0),U,16),UDIV=$S(UDIV'="":$P(^DIC(4,UDIV,0),U),1:UDIV) ;Gets division unit is located at
"RTN","GMTSLRBE",17,0)
 I $D(^LRD(65,UN,8)) S DIC=65,DIQ="DON",DIQ(0)="E",DR=8.3,DA=UN D EN^DIQ1 S:$D(DON) DTYP=DON(65,UN,8.3,"E")
"RTN","GMTSLRBE",18,0)
 S GMI=$O(^LRD(65,UN,3,0)) I +GMI>0 D
"RTN","GMTSLRBE",19,0)
 . S ULOC=$P($G(^LRD(65,UN,3,GMI,0)),U,4)
"RTN","GMTSLRBE",20,0)
 ; If unit will expire w/in 48 hrs, flag with "*"; w/in 24 hrs, flag with "**"
"RTN","GMTSLRBE",21,0)
 I EDT>DT S EFLG=$S(EDT-DT<2:"*",EDT-DT<1:"**",1:"")
"RTN","GMTSLRBE",22,0)
 S IDT=9999999-ADT
"RTN","GMTSLRBE",23,0)
 I $S(IDT<GMTS1:1,IDT>GMTS2:1,EDT<DT:1,1:0) Q
"RTN","GMTSLRBE",24,0)
 S X=EDT D REGDT4^GMTSU S EDT=X K X
"RTN","GMTSLRBE",25,0)
 F  Q:'$D(^TMP("LRB",$J,IDT))  S IDT=IDT+.0001
"RTN","GMTSLRBE",26,0)
 S ^TMP("LRB",$J,IDT)=EFLG_U_EDT_U_UID_U_COMP_U_VOL_U_ABO_U_RH_U_DTYP_U_UDIV_U_ULOC
"RTN","GMTSLRBE",27,0)
 S CNT=CNT+1
"RTN","GMTSLRBE",28,0)
 Q
"RTN","GMTSLRC")
0^73^B6036222
"RTN","GMTSLRC",1,0)
GMTSLRC ; SLC/JER,KER/NDBI - Chemistry & Hematology Comp Dvr ; 11/02/1998
"RTN","GMTSLRC",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSLRC",3,0)
MAIN N GMCFLAG,GMCMNT,IX0,IX,LRDFN,MAX,CNT,PTR,RWIDTH
"RTN","GMTSLRC",4,0)
 I $$ROK^GMTSU("A7RHSE"),$$NDBI^GMTSU,'$D(^DPT(DFN,"LR")),$D(^A7RHS("CH",DFN)) D LRDFN^A7RHSE(DFN)
"RTN","GMTSLRC",5,0)
 Q:'$D(^DPT(DFN,"LR"))
"RTN","GMTSLRC",6,0)
 S LRDFN=+^DPT(DFN,"LR") I $$NDBI^GMTSU,'$D(^LR(LRDFN)),'$D(^A7RHS("CH",DFN)) Q
"RTN","GMTSLRC",7,0)
 Q:'$D(^LR(LRDFN))
"RTN","GMTSLRC",8,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLRC",9,0)
 E  S MAX=999
"RTN","GMTSLRC",10,0)
 S RWIDTH=8 ;Optional variable used in ^GMTSLRCE
"RTN","GMTSLRC",11,0)
 D ^GMTSLRCE
"RTN","GMTSLRC",12,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) CH^A7RHSM
"RTN","GMTSLRC",13,0)
 I '$D(^TMP("LRC",$J)) Q
"RTN","GMTSLRC",14,0)
 D WRTHDR S GMCMNT=$S($P($G(^GMT(142.99,1,0)),U,3)="Y":1,1:0)
"RTN","GMTSLRC",15,0)
 S IX=GMTS1 F IX0=1:1:MAX S IX=$O(^TMP("LRC",$J,IX)) Q:IX=""!(IX>GMTS2)  S (PTR,CNT)=0 F  S PTR=$O(^TMP("LRC",$J,IX,PTR)) Q:PTR=""  S CNT=CNT+1 D WRT
"RTN","GMTSLRC",16,0)
 I +$G(GMCFLAG) D
"RTN","GMTSLRC",17,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSLRC",18,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "!!  Indicates COMMENTS AVAILABLE...Refer to Interim Lab Report.",!
"RTN","GMTSLRC",19,0)
 K ^TMP("LRC",$J)
"RTN","GMTSLRC",20,0)
 Q
"RTN","GMTSLRC",21,0)
WRTHDR ; Prints columnar header
"RTN","GMTSLRC",22,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Collection DT",?18,"Specimen",?29,"Test Name",?48,"Result",?58,"Units",?68,"Ref Range",!!
"RTN","GMTSLRC",23,0)
 S GMTSNPG=1
"RTN","GMTSLRC",24,0)
 Q
"RTN","GMTSLRC",25,0)
WRT ; Writes Chemistry & Hematology Component
"RTN","GMTSLRC",26,0)
 N GMI,GMX
"RTN","GMTSLRC",27,0)
 I PTR="C",'+$G(GMCMNT) Q  ; if comments disabled, don't print
"RTN","GMTSLRC",28,0)
 I PTR="C",($D(^TMP("LRC",$J,IX,"C"))>9),+$G(GMCMNT) D  Q
"RTN","GMTSLRC",29,0)
 . S GMI=0 F  S GMI=$O(^TMP("LRC",$J,IX,"C",GMI)) Q:GMI'>0  D
"RTN","GMTSLRC",30,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Comment: ",^TMP("LRC",$J,IX,"C",GMI),!
"RTN","GMTSLRC",31,0)
 S GMX=^TMP("LRC",$J,IX,PTR)
"RTN","GMTSLRC",32,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR
"RTN","GMTSLRC",33,0)
 W:CNT=1!(GMTSNPG) $P(GMX,U),?18,$E($P(GMX,U,2),1,10)
"RTN","GMTSLRC",34,0)
 W:CNT>1&'(GMTSNPG) ?3,"""",?12,"""",?20,""""
"RTN","GMTSLRC",35,0)
 I $D(^TMP("LRC",$J,IX,"C"))>9,'+$G(GMCMNT) W ?24,"!! " S GMCFLAG=1
"RTN","GMTSLRC",36,0)
 W ?29,$E($P(GMX,U,3),1,17),?46,$P(GMX,U,4)," ",$P(GMX,U,5),?58,$P(GMX,U,6),?68,$J($P(GMX,U,7),4),?73,"-",?74,$J($P(GMX,U,8),4),!
"RTN","GMTSLRC",37,0)
 Q
"RTN","GMTSLRCE")
0^20^B9037427
"RTN","GMTSLRCE",1,0)
GMTSLRCE ; SLC/JER,KER - Chemistry Extract Routine ; 09/21/1998
"RTN","GMTSLRCE",2,0)
 ;;2.7;Health Summary;**18,28**;Oct 20, 1995
"RTN","GMTSLRCE",3,0)
XTRCT ; Call with LRDFN, GMTS1, GMTS2, MAX (#occurrences) & SEX (M or F)
"RTN","GMTSLRCE",4,0)
 N IDT,CNT,AGE
"RTN","GMTSLRCE",5,0)
 I '$D(GMTSAGE) D DEM^GMTSU
"RTN","GMTSLRCE",6,0)
 S AGE=GMTSAGE
"RTN","GMTSLRCE",7,0)
 K ^TMP("LRC",$J)
"RTN","GMTSLRCE",8,0)
 S IDT=GMTS1,CNT=0 F  S IDT=$O(^LR(LRDFN,"CH",IDT)) Q:IDT=""!(IDT>GMTS2)  D:CNT'>MAX CHSET
"RTN","GMTSLRCE",9,0)
 Q
"RTN","GMTSLRCE",10,0)
CHSET ; Sets Chemistry locals for printing
"RTN","GMTSLRCE",11,0)
 N CDT,SITE,SPEC,PTR,ISVALID,GMI,ACC,LOC,COM,RDT,SNOMED
"RTN","GMTSLRCE",12,0)
 S ISVALID=$P(^LR(LRDFN,"CH",IDT,0),U,3) Q:ISVALID=""
"RTN","GMTSLRCE",13,0)
 S SNOMED=""
"RTN","GMTSLRCE",14,0)
 S CDT=+^LR(LRDFN,"CH",IDT,0),SITE=$P(^(0),U,5),SPEC=$P(^LAB(61,SITE,0),U),SNOMED=$P(^(0),U,2),CNT=CNT+1
"RTN","GMTSLRCE",15,0)
 I $D(EXPAND) S SPEC=SNOMED_";"_SPEC,RDT=$P(^LR(LRDFN,"CH",IDT,0),U,3),ACC=$P(^(0),U,6),ACC=$P(ACC," ",2,3)_" "_$P(ACC," "),LOC=$P(^(0),U,11) S X=RDT D FMHL7DTM^GMTSU S RDT=X K X
"RTN","GMTSLRCE",16,0)
 S X=CDT D REGDTM4^GMTSU:'$D(EXPAND),FMHL7DTM^GMTSU:$D(EXPAND) S CDT=X K X
"RTN","GMTSLRCE",17,0)
 S PTR=1 F  S PTR=$O(^LR(LRDFN,"CH",IDT,PTR)) Q:PTR<1  D NXTST
"RTN","GMTSLRCE",18,0)
 I $D(^LR(LRDFN,"CH",IDT,1,0)),($D(^TMP("LRC",$J,IDT))) D
"RTN","GMTSLRCE",19,0)
 . S COM=0 F GMI=1:1 S COM=$O(^LR(LRDFN,"CH",IDT,1,COM)) Q:+COM'>0  S ^TMP("LRC",$J,IDT,"C",GMI)=^LR(LRDFN,"CH",IDT,1,COM,0)
"RTN","GMTSLRCE",20,0)
 Q
"RTN","GMTSLRCE",21,0)
NXTST ; Visit next node in ^(PTR) subtree
"RTN","GMTSLRCE",22,0)
 N RESULT,FLAG,TEST,GMPC,GMSQN,TNM,DESCR,THER,UNIT,HI,LO,CIS
"RTN","GMTSLRCE",23,0)
 S RESULT=$P(^LR(LRDFN,"CH",IDT,PTR),U),FLAG=$P(^(PTR),U,2),CIS=""
"RTN","GMTSLRCE",24,0)
 I $D(EXPAND),(FLAG["*") S FLAG=$S(FLAG="L*":"LL",FLAG="H*":"HH",1:FLAG)
"RTN","GMTSLRCE",25,0)
 S TEST=$O(^LAB(60,"C","CH;"_PTR_";1",0)) Q:TEST'>0
"RTN","GMTSLRCE",26,0)
 S TNM=$S($L($P(^LAB(60,TEST,0),U))<19:$P(^(0),U),1:$P(^(.1),U))
"RTN","GMTSLRCE",27,0)
 ; If Test Type field is neither "Output" or "Both" then quit
"RTN","GMTSLRCE",28,0)
 I $S("BO"'[$P(^LAB(60,TEST,0),U,3):1,1:0) Q
"RTN","GMTSLRCE",29,0)
 S GMSQN=$S($P($G(^LAB(60,TEST,.1)),U,6):$P($G(^(.1)),U,6),1:PTR/1000000)
"RTN","GMTSLRCE",30,0)
 I $D(^LAB(60,TEST,10)) S CIS=^(10)
"RTN","GMTSLRCE",31,0)
 I $D(EXPAND),'$L(CIS) Q
"RTN","GMTSLRCE",32,0)
 I $D(EXPAND) S TNM=CIS_";"_TNM
"RTN","GMTSLRCE",33,0)
 ; Execute Print Code from file 60 to evaluate RESULT
"RTN","GMTSLRCE",34,0)
 S RESULT=$$RESULT(TEST,RESULT,$G(RWIDTH))
"RTN","GMTSLRCE",35,0)
 S DESCR=$S($D(^LAB(60,TEST,1,SITE,0)):^(0),1:""),THER=$S($L($P(DESCR,U,11,12))>1:1,1:0)
"RTN","GMTSLRCE",36,0)
 S UNIT=$P(DESCR,U,7),LO=$S(THER:$P(DESCR,U,11),1:$P(DESCR,U,2)),HI=$S(THER:$P(DESCR,U,12),1:$P(DESCR,U,3))
"RTN","GMTSLRCE",37,0)
 S @("LO="_$S($L(LO):LO,1:"""""")),@("HI="_$S($L(HI):HI,1:""""""))
"RTN","GMTSLRCE",38,0)
 I $D(EXPAND),'$L(FLAG),(+$G(HI)'<+$G(RESULT)),(+$G(LO)'>+$G(RESULT)) S FLAG="N"
"RTN","GMTSLRCE",39,0)
 F  Q:'$D(^TMP("LRC",$J,IDT,GMSQN))  Q:TEST=+^(GMSQN)  S GMSQN=GMSQN+1
"RTN","GMTSLRCE",40,0)
 Q:$D(^TMP("LRC",$J,IDT,GMSQN))
"RTN","GMTSLRCE",41,0)
 S ^TMP("LRC",$J,IDT,GMSQN)=CDT_U_SPEC_U_TNM_U_RESULT_U_FLAG_U_UNIT_U_LO_U_HI
"RTN","GMTSLRCE",42,0)
 I $D(EXPAND) D XPND
"RTN","GMTSLRCE",43,0)
 Q
"RTN","GMTSLRCE",44,0)
XPND ; Appends additional data if required
"RTN","GMTSLRCE",45,0)
 S ^TMP("LRC",$J,IDT,GMSQN)=^TMP("LRC",$J,IDT,GMSQN)_U_ACC_U_RDT_U_LOC
"RTN","GMTSLRCE",46,0)
 Q
"RTN","GMTSLRCE",47,0)
RESULT(TEST,RESULT,LRCW) ;Convert result to external format
"RTN","GMTSLRCE",48,0)
 ;TEST=Test ptr to file 60
"RTN","GMTSLRCE",49,0)
 ;RESULT=Test result
"RTN","GMTSLRCE",50,0)
 ;LRCW=Optional width of variable. Default is 0
"RTN","GMTSLRCE",51,0)
 N X,X1
"RTN","GMTSLRCE",52,0)
 I +$G(LRCW)'>0 S LRCW=0
"RTN","GMTSLRCE",53,0)
 S X1=$P($G(^LAB(60,TEST,.1)),"^",3),X1=$S($L(X1):X1,1:"$J(X,LRCW)"),X=RESULT,@("X="_X1)
"RTN","GMTSLRCE",54,0)
 Q X
"RTN","GMTSLRCP")
0^21^B27527714
"RTN","GMTSLRCP",1,0)
GMTSLRCP ; SLC/JER,KER/NDBI - Cytopathology Comp Dvr ; 09/21/1998
"RTN","GMTSLRCP",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSLRCP",3,0)
MAIN N GMI,IX0,MAX,LRDFN,IX
"RTN","GMTSLRCP",4,0)
 I $$ROK^GMTSU("A7RHSE"),$$NDBI^GMTSU,'$D(^DPT(DFN,"LR")),$D(^A7RHS("CY",DFN)) D LRDFN^A7RHSE(DFN)
"RTN","GMTSLRCP",5,0)
 Q:'$D(^DPT(DFN,"LR"))
"RTN","GMTSLRCP",6,0)
 S LRDFN=+^DPT(DFN,"LR")
"RTN","GMTSLRCP",7,0)
 I $$NDBI^GMTSU,'$D(^LR(LRDFN)),'$D(^A7RHS("CY",DFN)) Q
"RTN","GMTSLRCP",8,0)
 I '$$NDBI^GMTSU,'$D(^LR(LRDFN)) Q
"RTN","GMTSLRCP",9,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLRCP",10,0)
 E  S MAX=999
"RTN","GMTSLRCP",11,0)
 D ^GMTSLRPE
"RTN","GMTSLRCP",12,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) CY^A7RHSM
"RTN","GMTSLRCP",13,0)
 I '$D(^TMP("LRCY",$J)) Q
"RTN","GMTSLRCP",14,0)
 S IX=""
"RTN","GMTSLRCP",15,0)
 F GMI=1:1:MAX S IX=$O(^TMP("LRCY",$J,IX)) Q:IX=""  D:GMI>1 CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>1&'GMTSNPG ! S IX0="" F  S IX0=$O(^TMP("LRCY",$J,IX,IX0)) Q:IX0=""  D TRVRS
"RTN","GMTSLRCP",16,0)
 K ^TMP("LRCY",$J)
"RTN","GMTSLRCP",17,0)
 Q
"RTN","GMTSLRCP",18,0)
TRVRS ; Traverses/Interprets ^TMP("LRCY",$J,
"RTN","GMTSLRCP",19,0)
 N GMS,SPEC
"RTN","GMTSLRCP",20,0)
 I IX0=0 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Collected:",?19,$P(^TMP("LRCY",$J,IX,IX0),U),?31,"Acc:",?36,$P(^TMP("LRCY",$J,IX,IX0),U,2),! Q
"RTN","GMTSLRCP",21,0)
 I IX0=1 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Specimen:" S GMS=0 F  S GMS=$O(^TMP("LRCY",$J,IX,IX0,GMS)) Q:GMS'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?19,^TMP("LRCY",$J,IX,IX0,GMS),!
"RTN","GMTSLRCP",22,0)
 I IX0=1,($P(^TMP("LRCY",$J,IX,IX0),U,2)'>0) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?18,"** REPORT NOT YET RELEASED **",!
"RTN","GMTSLRCP",23,0)
 Q:IX0=1  D @$E(IX0,1,2)
"RTN","GMTSLRCP",24,0)
 Q
"RTN","GMTSLRCP",25,0)
AH ; Writes clinical history
"RTN","GMTSLRCP",26,0)
 N GMTSH,GMTSHL,GMTSHLI
"RTN","GMTSLRCP",27,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Brief Clinical Hx:",!
"RTN","GMTSLRCP",28,0)
 S GMTSH=0
"RTN","GMTSLRCP",29,0)
 F  S GMTSH=$O(^TMP("LRCY",$J,IX,IX0,GMTSH)) Q:+GMTSH'>0  S GMTSHL=^(GMTSH) D
"RTN","GMTSLRCP",30,0)
 .I $L(GMTSHL)>78 S GMTSHL=$$WRAP^GMTSORC(GMTSHL,78)
"RTN","GMTSLRCP",31,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSHL,"|"),! D
"RTN","GMTSLRCP",32,0)
 ..F GMTSHLI=2:1:$L(GMTSHL,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSHL,"|",GMTSHLI)]"" $P(GMTSHL,"|",GMTSHLI),!
"RTN","GMTSLRCP",33,0)
 Q
"RTN","GMTSLRCP",34,0)
G ; Writes Gross Description
"RTN","GMTSLRCP",35,0)
 N GMTSG,GMTSGL,GMTSGLI
"RTN","GMTSLRCP",36,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Gross Description:",!
"RTN","GMTSLRCP",37,0)
 S GMTSG=0
"RTN","GMTSLRCP",38,0)
 F  S GMTSG=$O(^TMP("LRCY",$J,IX,IX0,GMTSG)) Q:GMTSG'>0  S GMTSGL=^(GMTSG) D
"RTN","GMTSLRCP",39,0)
 .I $L(GMTSGL)>78 S GMTSGL=$$WRAP^GMTSORC(GMTSGL,78)
"RTN","GMTSLRCP",40,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSGL,"|"),! D
"RTN","GMTSLRCP",41,0)
 ..F GMTSGLI=2:1:$L(GMTSGL,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSGL,"|",GMTSGLI)]"" $P(GMTSGL,"|",GMTSGLI),!
"RTN","GMTSLRCP",42,0)
 Q
"RTN","GMTSLRCP",43,0)
MI ; Writes Microscopic exam/diagnosis field
"RTN","GMTSLRCP",44,0)
 N GMTSM,GMTSML,GMTSMLI
"RTN","GMTSLRCP",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Microscopic exam:",!
"RTN","GMTSLRCP",46,0)
 S GMTSM=0
"RTN","GMTSLRCP",47,0)
 F  S GMTSM=$O(^TMP("LRCY",$J,IX,IX0,GMTSM)) Q:GMTSM'>0  S GMTSML=^(GMTSM) D
"RTN","GMTSLRCP",48,0)
 .I $L(GMTSML)>78 S GMTSML=$$WRAP^GMTSORC(GMTSML,78)
"RTN","GMTSLRCP",49,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSML,"|"),! D
"RTN","GMTSLRCP",50,0)
 ..F GMTSMLI=2:1:$L(GMTSML,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSML,"|",GMTSMLI)]"" $P(GMTSML,"|",GMTSMLI),!
"RTN","GMTSLRCP",51,0)
 Q
"RTN","GMTSLRCP",52,0)
SR ; Writes Supplementary Reports
"RTN","GMTSLRCP",53,0)
 N GMTSLINE,GMTSL,GMTSR,SRDATE,X
"RTN","GMTSLRCP",54,0)
 S IX1=0
"RTN","GMTSLRCP",55,0)
 F  S IX1=$O(^TMP("LRCY",$J,IX,IX0,IX1)) Q:IX1'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  S SRDATE=^TMP("LRCY",$J,IX,IX0,IX1,0) S X=SRDATE D REGDTM4^GMTSU W !,"Supplementary Rpt: ",X,! D
"RTN","GMTSLRCP",56,0)
 .S GMTSR=0
"RTN","GMTSLRCP",57,0)
 .F  S GMTSR=$O(^TMP("LRCY",$J,IX,IX0,IX1,GMTSR)) Q:GMTSR'>0  D
"RTN","GMTSLRCP",58,0)
  ..S GMTSLINE=^TMP("LRCY",$J,IX,IX0,IX1,GMTSR) I $L(GMTSLINE)>78 S GMTSLINE=$$WRAP^GMTSORC(GMTSLINE,78)
"RTN","GMTSLRCP",59,0)
 ..D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSLINE,"|"),! D
"RTN","GMTSLRCP",60,0)
 ...F GMTSL=2:1:$L(GMTSLINE,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSLINE,"|",GMTSL)]"" $P(GMTSLINE,"|",GMTSL),!
"RTN","GMTSLRCP",61,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSLRCP",62,0)
 Q
"RTN","GMTSLRCP",63,0)
ND ;Writes Diagnosis field
"RTN","GMTSLRCP",64,0)
 N GMTSD,GMTSDL,GMTSDLI
"RTN","GMTSLRCP",65,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !," Cytopathology Dx:",!
"RTN","GMTSLRCP",66,0)
 S GMTSD=0
"RTN","GMTSLRCP",67,0)
 F  S GMTSD=$O(^TMP("LRCY",$J,IX,IX0,GMTSD)) Q:GMTSD'>0  S GMTSDL=^(GMTSD) D
"RTN","GMTSLRCP",68,0)
 .I $L(GMTSDL)>78 S GMTSDL=$$WRAP^GMTSORC(GMTSDL,78)
"RTN","GMTSLRCP",69,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSDL,"|"),! D
"RTN","GMTSLRCP",70,0)
 ..F GMTSDLI=2:1:$L(GMTSDL,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSDL,"|",GMTSDLI)]"" $P(GMTSDL,"|",GMTSDLI),!
"RTN","GMTSLRCP",71,0)
 Q
"RTN","GMTSLRCP",72,0)
OT ; Traverses/Interprets Organ/Tissue Subarray
"RTN","GMTSLRCP",73,0)
 N OT
"RTN","GMTSLRCP",74,0)
 S OT=0 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?7,"Topography:",?19,^TMP("LRCY",$J,IX,IX0,OT),!
"RTN","GMTSLRCP",75,0)
 F  S OT=$O(^TMP("LRCY",$J,IX,IX0,OT)) Q:OT=""  D @$E(OT,1)
"RTN","GMTSLRCP",76,0)
 Q
"RTN","GMTSLRCP",77,0)
D ; Writes Disease Field
"RTN","GMTSLRCP",78,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:OT="D1"!(GMTSNPG) ?9,"Diseases:" W ?21,^TMP("LRCY",$J,IX,IX0,OT),!
"RTN","GMTSLRCP",79,0)
 Q
"RTN","GMTSLRCP",80,0)
M ; Writes Morphology Field
"RTN","GMTSLRCP",81,0)
 N GME
"RTN","GMTSLRCP",82,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?7,"Morphology:",?21,$P(^TMP("LRCY",$J,IX,IX0,OT),U),!
"RTN","GMTSLRCP",83,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  S GME="" F  S GME=$O(^TMP("LRCY",$J,IX,IX0,OT,GME)) Q:GME=""  W:GME[1!(GMTSNPG) ?9,"Etiology:" W ?23,^TMP("LRCY",$J,IX,IX0,OT,GME),!
"RTN","GMTSLRCP",84,0)
 Q
"RTN","GMTSLRCP",85,0)
P ; Writes Procedure Field
"RTN","GMTSLRCP",86,0)
 N GMTSJ,GMK
"RTN","GMTSLRCP",87,0)
 S GMTSJ=$P(^TMP("LRCY",$J,IX,IX0,OT),U) D CKP^GMTSUP Q:$D(GMTSQIT)  I $L(GMTSJ)>56 S GMTSJ=$$WRAP^GMTSORC(GMTSJ,56)
"RTN","GMTSLRCP",88,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:((OT="P1")!(GMTSNPG)) ?7,"Procedures:" W ?21,$P(GMTSJ,"|"),! D
"RTN","GMTSLRCP",89,0)
 .F GMK=2:1:$L(GMTSJ,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSJ,"|",GMK)]"" ?23,$P(GMTSJ,"|",GMK),!
"RTN","GMTSLRCP",90,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRCP",91,0)
 Q
"RTN","GMTSLRCP",92,0)
XI ; Writes ICD diagnoses
"RTN","GMTSLRCP",93,0)
 N GMTSDX
"RTN","GMTSLRCP",94,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "  ICD-9 Diagnoses:"
"RTN","GMTSLRCP",95,0)
 S GMTSDX=0
"RTN","GMTSLRCP",96,0)
 F  S GMTSDX=$O(^TMP("LRCY",$J,IX,IX0,GMTSDX)) Q:GMTSDX=""  D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMTSNPG ?2,"ICD-9 Diagnoses:" W ?19,$P(^TMP("LRCY",$J,IX,IX0,GMTSDX),U),?28,$P(^TMP("LRCY",$J,IX,IX0,GMTSDX),U,2),!
"RTN","GMTSLRCP",97,0)
 Q
"RTN","GMTSLREE")
0^22^B11526488
"RTN","GMTSLREE",1,0)
GMTSLREE ; SLC/JER,KER - Electron Microscopy Extract ; 09/21/1998
"RTN","GMTSLREE",2,0)
 ;;2.7;Health Summary;**3,28**;Oct 20, 1995
"RTN","GMTSLREE",3,0)
XTRCT N IX0,IX
"RTN","GMTSLREE",4,0)
 K ^TMP("LREM",$J)
"RTN","GMTSLREE",5,0)
 S IX=GMTS1 F IX0=1:0:MAX S IX=$O(^LR(LRDFN,"EM",IX)) Q:IX'>0!(IX>GMTS2)  D APSET
"RTN","GMTSLREE",6,0)
 K AP
"RTN","GMTSLREE",7,0)
 Q
"RTN","GMTSLREE",8,0)
APSET ;Sets ^TMP("LREM",$J
"RTN","GMTSLREE",9,0)
 N ACC,CDT,DA,DIC,DIQ,DR,GMW,SN,X,YR
"RTN","GMTSLREE",10,0)
 S CDT=$P(^LR(LRDFN,"EM",IX,0),U),ACC=$P(^(0),U,6)
"RTN","GMTSLREE",11,0)
 I $S(+$P(^LR(LRDFN,"EM",IX,0),U)'>0:1,+$P(^(0),U,11)'>0:1,1:0) Q
"RTN","GMTSLREE",12,0)
 I $D(ACC) S IX0=IX0+1
"RTN","GMTSLREE",13,0)
 S X=CDT D REGDTM4^GMTSU S CDT=X K X
"RTN","GMTSLREE",14,0)
 S ^TMP("LREM",$J,IX,0)=CDT_U_ACC
"RTN","GMTSLREE",15,0)
 I $D(^LR(LRDFN,"EM",IX,.1)) S ^TMP("LREM",$J,IX,.1)="Site/Specimen"
"RTN","GMTSLREE",16,0)
 S SN=0 F  S SN=$O(^LR(LRDFN,"EM",IX,.1,SN)) Q:SN'>0  S ^TMP("LREM",$J,IX,.1,SN)=$P(^LR(LRDFN,"EM",IX,.1,SN,0),U)
"RTN","GMTSLREE",17,0)
 I $D(^LR(LRDFN,"EM",IX,.2,0)),($P(^(0),U,3)]"") D CLHX
"RTN","GMTSLREE",18,0)
 I $D(^LR(LRDFN,"EM",IX,1,0)),($P(^(0),U,3)]"") D GROSS
"RTN","GMTSLREE",19,0)
 I $D(^LR(LRDFN,"EM",IX,1.1,0)),($P(^(0),U,3)]"") D MIC
"RTN","GMTSLREE",20,0)
 I $D(^LR(LRDFN,"EM",IX,1.2,0)),($P(^(0),U,3)]"") D SUPPR
"RTN","GMTSLREE",21,0)
 I $D(^LR(LRDFN,"EM",IX,1.4,0)),($P(^(0),U,3)]"") D SPDX
"RTN","GMTSLREE",22,0)
 Q
"RTN","GMTSLREE",23,0)
CLHX ;Brief Clinical History text
"RTN","GMTSLREE",24,0)
 N LN
"RTN","GMTSLREE",25,0)
 S ^TMP("LREM",$J,IX,.2)="Brief Clinical Hx"
"RTN","GMTSLREE",26,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"EM",IX,.2,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"EM",IX,.2,LN,0),U) D FORMAT
"RTN","GMTSLREE",27,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LREM",$J,IX,.2,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLREE",28,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLREE",29,0)
 Q
"RTN","GMTSLREE",30,0)
GROSS ;Gross Description text
"RTN","GMTSLREE",31,0)
 N LN
"RTN","GMTSLREE",32,0)
 S ^TMP("LREM",$J,IX,1)="Gross Description"
"RTN","GMTSLREE",33,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"EM",IX,1,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"EM",IX,1,LN,0),U) D FORMAT
"RTN","GMTSLREE",34,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LREM",$J,IX,1,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLREE",35,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLREE",36,0)
 Q
"RTN","GMTSLREE",37,0)
MIC ;Microscopic Exam/Diagnosis text
"RTN","GMTSLREE",38,0)
 N LN
"RTN","GMTSLREE",39,0)
 S ^TMP("LREM",$J,IX,1.1)="Microscopic Exam"
"RTN","GMTSLREE",40,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"EM",IX,1.1,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"EM",IX,1.1,LN,0),U) D FORMAT
"RTN","GMTSLREE",41,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LREM",$J,IX,1.1,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLREE",42,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLREE",43,0)
 Q
"RTN","GMTSLREE",44,0)
SUPPR ;Supplementary Report date/text
"RTN","GMTSLREE",45,0)
 N SP1 S ^TMP("LREM",$J,IX,1.2)="Supplementary Report"
"RTN","GMTSLREE",46,0)
 S SP1=0
"RTN","GMTSLREE",47,0)
 F  S SP1=$O(^LR(LRDFN,"EM",IX,1.2,SP1)) Q:SP1'>0  D
"RTN","GMTSLREE",48,0)
 . Q:+$P($G(^LR(LRDFN,"EM",IX,1.2,SP1,0)),U,2)'>0
"RTN","GMTSLREE",49,0)
 . S ^TMP("LREM",$J,IX,1.2,SP1,0)=$P($G(^LR(LRDFN,"EM",IX,1.2,SP1,0)),U)
"RTN","GMTSLREE",50,0)
 . K ^UTILITY($J,"W")
"RTN","GMTSLREE",51,0)
 . S SR=0
"RTN","GMTSLREE",52,0)
 . F  S SR=$O(^LR(LRDFN,"EM",IX,1.2,SP1,1,SR)) Q:SR'>0  D
"RTN","GMTSLREE",53,0)
 . . S X=$P($G(^LR(LRDFN,"EM",IX,1.2,SP1,1,SR,0)),U) D FORMAT
"RTN","GMTSLREE",54,0)
 . I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LREM",$J,IX,1.2,SP1,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLREE",55,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLREE",56,0)
 Q
"RTN","GMTSLREE",57,0)
SPDX ;Electron Microscopy DX text
"RTN","GMTSLREE",58,0)
 N LN
"RTN","GMTSLREE",59,0)
 S ^TMP("LREM",$J,IX,1.4)="Surgical Path Dx"
"RTN","GMTSLREE",60,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"EM",IX,1.4,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"EM",IX,1.4,LN,0),U) D FORMAT
"RTN","GMTSLREE",61,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LREM",$J,IX,1.4,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLREE",62,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLREE",63,0)
 Q
"RTN","GMTSLREE",64,0)
FORMAT ;Calls ^DIWP to format text
"RTN","GMTSLREE",65,0)
 S DIWF="N",DIWL=3,DIWR=78 D ^DIWP
"RTN","GMTSLREE",66,0)
 Q
"RTN","GMTSLREM")
0^23^B9887844
"RTN","GMTSLREM",1,0)
GMTSLREM ; SLC/JER,KER - Electron Microscopy Comp Dvr ; 09/21/1998
"RTN","GMTSLREM",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSLREM",3,0)
MAIN N GMI,MAX,LRDFN,IX,X,IX0
"RTN","GMTSLREM",4,0)
 I '$D(^DPT(DFN,"LR")) Q
"RTN","GMTSLREM",5,0)
 S LRDFN=+^DPT(DFN,"LR")
"RTN","GMTSLREM",6,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLREM",7,0)
 E  S MAX=999
"RTN","GMTSLREM",8,0)
 D ^GMTSLREE
"RTN","GMTSLREM",9,0)
 I '$D(^TMP("LREM",$J)) Q
"RTN","GMTSLREM",10,0)
 S IX=0
"RTN","GMTSLREM",11,0)
 F GMI=1:1:MAX S IX=$O(^TMP("LREM",$J,IX)) Q:IX'>0  D:GMI>1 CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>1&('GMTSNPG) ! D
"RTN","GMTSLREM",12,0)
 .S IX0=""
"RTN","GMTSLREM",13,0)
 .F  S IX0=$O(^TMP("LREM",$J,IX,IX0)) Q:IX0=""!(IX0?1A)  S X=^TMP("LREM",$J,IX,IX0) D WRT
"RTN","GMTSLREM",14,0)
 . I $D(^TMP("LREM",$J,IX,1.2)) D SUPPR
"RTN","GMTSLREM",15,0)
 K ^TMP("LREM",$J)
"RTN","GMTSLREM",16,0)
 Q
"RTN","GMTSLREM",17,0)
WRT ; Writes Electron Microscopy Record
"RTN","GMTSLREM",18,0)
 N IX1,GMJ
"RTN","GMTSLREM",19,0)
 I IX0=0 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Collected:",?19,$P(X,U),?31,"Acc:",?36,$P(X,U,2),! Q
"RTN","GMTSLREM",20,0)
 I IX0=.1 D WRTSPC Q
"RTN","GMTSLREM",21,0)
 I $S(IX0=.2:1,IX0=1:1,IX0=1.1:1,IX0=1.3:1,IX0=1.4:1,1:0) D TEXT Q
"RTN","GMTSLREM",22,0)
 I IX0=2 S IX1=0 F  S IX1=$O(^TMP("LREM",$J,IX,IX0,IX1)) Q:IX1'>0  S X=^(IX1) D WRTP
"RTN","GMTSLREM",23,0)
 Q
"RTN","GMTSLREM",24,0)
WRTSPC ; Writes Specimen field entries
"RTN","GMTSLREM",25,0)
 N GMS
"RTN","GMTSLREM",26,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Specimen:"
"RTN","GMTSLREM",27,0)
 S GMS=0
"RTN","GMTSLREM",28,0)
 F  S GMS=$O(^TMP("LREM",$J,IX,.1,GMS)) Q:GMS'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?19,^TMP("LREM",$J,IX,.1,GMS),!
"RTN","GMTSLREM",29,0)
 Q
"RTN","GMTSLREM",30,0)
TEXT ; Handles GROSS DESCRIPTION & MICROSCOPIC EXAM/DX Print
"RTN","GMTSLREM",31,0)
 N LN,GMTSLN,GMTSLNI
"RTN","GMTSLREM",32,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?(17-$L(X)),X_":",!
"RTN","GMTSLREM",33,0)
 S LN=0
"RTN","GMTSLREM",34,0)
 F  S LN=$O(^TMP("LREM",$J,IX,IX0,LN)) Q:LN'>0  S GMTSLN=^(LN) D
"RTN","GMTSLREM",35,0)
 .I $L(GMTSLN)>78 S GMTSLN=$$WRAP^GMTSORC(GMTSLN,78)
"RTN","GMTSLREM",36,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSLN,"|"),! D
"RTN","GMTSLREM",37,0)
 ..F GMTSLNI=2:1:$L(GMTSLN,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSLN,"|",GMTSLNI)]"" $P(GMTSLN,"|",GMTSLNI),!
"RTN","GMTSLREM",38,0)
 Q
"RTN","GMTSLREM",39,0)
SUPPR ; Writes Supplementary Report
"RTN","GMTSLREM",40,0)
 N GMTSR,SRDATE,GMTSRL,GMTSRLI,X
"RTN","GMTSLREM",41,0)
 S IX1=0
"RTN","GMTSLREM",42,0)
 F  S IX1=$O(^TMP("LREM",$J,IX,1.2,IX1)) Q:IX1'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  S SRDATE=^TMP("LREM",$J,IX,1.2,IX1,0) S X=SRDATE D REGDTM4^GMTSU W "Supplementary Rpt: ",X,! D
"RTN","GMTSLREM",43,0)
 .S GMTSR=0
"RTN","GMTSLREM",44,0)
 .F  S GMTSR=$O(^TMP("LREM",$J,IX,1.2,IX1,GMTSR)) Q:GMTSR'>0  S GMTSRL=^(GMTSR) D
"RTN","GMTSLREM",45,0)
 ..I $L(GMTSRL)>78 S GMTSRL=$$WRAP^GMTSORC(GMTSRL,78)
"RTN","GMTSLREM",46,0)
 ..W $P(GMTSRL,"|"),! D
"RTN","GMTSLREM",47,0)
 ...F GMTSRLI=2:1:$L(GMTSRL,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSRL,"|",GMTSRLI)]"" $P(GMTSRL,"|",GMTSRLI),!
"RTN","GMTSLREM",48,0)
 Q
"RTN","GMTSLREM",49,0)
WRTP ; Writes Procedure field
"RTN","GMTSLREM",50,0)
 N GMQ,GMK
"RTN","GMTSLREM",51,0)
 I $O(^TMP("LREM",$J,IX,IX0,IX1,4,0)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?7,"Procedures:"
"RTN","GMTSLREM",52,0)
 S GMT=0
"RTN","GMTSLREM",53,0)
 F  S GMT=$O(^TMP("LREM",$J,IX,IX0,IX1,4,GMT)) Q:GMT'>0  D
"RTN","GMTSLREM",54,0)
 .S GMQ=$P(^TMP("LREM",$J,IX,IX0,IX1,4,GMT),U)
"RTN","GMTSLREM",55,0)
 .I $L(GMQ)>56 S GMQ=$$WRAP^GMTSORC(GMQ,56)
"RTN","GMTSLREM",56,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$P(GMQ,"|"),! D
"RTN","GMTSLREM",57,0)
 ..F GMK=2:1:$L(GMQ,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMQ,"|",GMK)]"" ?23,$P(GMQ,"|",GMK),!
"RTN","GMTSLREM",58,0)
 Q
"RTN","GMTSLRM")
0^74^B26697870
"RTN","GMTSLRM",1,0)
GMTSLRM ; SLC/JER,KER/NDBI - Microbiology Component Driver ; 11/02/1998
"RTN","GMTSLRM",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSLRM",3,0)
 ;
"RTN","GMTSLRM",4,0)
MAIN N IX0,IX,LRDFN,MAX,D1,D2,D3
"RTN","GMTSLRM",5,0)
 I $$ROK^GMTSU("A7RHSE"),$$NDBI^GMTSU,'$D(^DPT(DFN,"LR")),$D(^A7RHS("MIC",DFN)) D LRDFN^A7RHSE(DFN)
"RTN","GMTSLRM",6,0)
 Q:'$D(^DPT(DFN,"LR"))
"RTN","GMTSLRM",7,0)
 S LRDFN=+^DPT(DFN,"LR") I $$NDBI^GMTSU,'$D(^LR(LRDFN)),'$D(^A7RHS("MIC",DFN)) Q
"RTN","GMTSLRM",8,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) LST^A7RHSM(DFN,.A7RHS)
"RTN","GMTSLRM",9,0)
 I $$NDBI^GMTSU,$S('$D(^LR(LRDFN,"MI",0))&'$D(A7RHS):1,'$O(^LR(LRDFN,"MI",GMTS1))&'$O(A7RHS(GMTS1)):1,$O(^(GMTS1))>GMTS2:1,1:0) Q
"RTN","GMTSLRM",10,0)
 I '$$NDBI^GMTSU,$S('$D(^LR(LRDFN,"MI",0)):1,'$O(^LR(LRDFN,"MI",GMTS1)):1,$O(^(GMTS1))>GMTS2:1,1:0) Q
"RTN","GMTSLRM",11,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLRM",12,0)
 E  S MAX=999
"RTN","GMTSLRM",13,0)
 S IX=GMTS1 F IX0=1:1:MAX S IX=$O(^LR(LRDFN,"MI",IX)) D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) MIC2^A7RHSM($S(IX0=1&(IX=""):GMTS2,1:IX)) Q:IX=""!(IX>GMTS2)!$D(GMTSQIT)  D:IX0>1 CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSLRM",14,0)
 . W:IX0>1 ! D ^GMTSLRME,INTRP:$D(^TMP("LRM",$J)) K ^TMP("LRM",$J)
"RTN","GMTSLRM",15,0)
 K:$$NDBI^GMTSU A7RHS
"RTN","GMTSLRM",16,0)
 Q
"RTN","GMTSLRM",17,0)
INTRP ; Interprets ^TMP("LRM",$J, and calls WRT to print component
"RTN","GMTSLRM",18,0)
 N GMZ,GMK
"RTN","GMTSLRM",19,0)
 S (GMZ,GMK)=""
"RTN","GMTSLRM",20,0)
 F  S GMZ=$O(^TMP("LRM",$J,GMZ)) Q:GMZ=""  D RDNODE  Q:$D(GMTSQIT)
"RTN","GMTSLRM",21,0)
 Q
"RTN","GMTSLRM",22,0)
RDNODE ; Reads current node of ^TMP("LRM",$J
"RTN","GMTSLRM",23,0)
 N GMABX,COM
"RTN","GMTSLRM",24,0)
 S GMABX=0
"RTN","GMTSLRM",25,0)
 I GMZ=0 D  Q
"RTN","GMTSLRM",26,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?10,"Collected:",?21,$P(^TMP("LRM",$J,GMZ),U),?43,"Acc:",?48,$P(^TMP("LRM",$J,GMZ),U,2),!
"RTN","GMTSLRM",27,0)
 . I $P(^TMP("LRM",$J,GMZ),U,6)'=$P(^(GMZ),U,3) D
"RTN","GMTSLRM",28,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,"Collection Sample:",?21,$P(^TMP("LRM",$J,GMZ),U,6),!
"RTN","GMTSLRM",29,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?6,"Site/Specimen:",?21,$TR($P(^TMP("LRM",$J,GMZ),U,3),"|"," "),!
"RTN","GMTSLRM",30,0)
 . S COM=$P(^TMP("LRM",$J,GMZ),U,7)
"RTN","GMTSLRM",31,0)
 . I COM]"" D
"RTN","GMTSLRM",32,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",33,0)
 . . W "Comment on Specimen:"
"RTN","GMTSLRM",34,0)
 . . I $L(COM)>58 S COM=$$WRAP^GMTSORC(COM,58)
"RTN","GMTSLRM",35,0)
 . . W ?21,$P(COM,"|"),!
"RTN","GMTSLRM",36,0)
 . . I $L($P(COM,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?22,$P(COM,"|",2),!
"RTN","GMTSLRM",37,0)
 . D WRTTEST^GMTSLRM1
"RTN","GMTSLRM",38,0)
 S GMK=""
"RTN","GMTSLRM",39,0)
 F  S GMK=$O(^TMP("LRM",$J,GMZ,GMK)) Q:GMK=""  D WRTNODE Q:$D(GMTSQIT)
"RTN","GMTSLRM",40,0)
 Q
"RTN","GMTSLRM",41,0)
WRTNODE ; Writes current node of ^TMP("LRM",$J
"RTN","GMTSLRM",42,0)
 N GML,SMEAR,QTY,ORG,GMN,RSMEAR
"RTN","GMTSLRM",43,0)
 I GMZ="BSTER" D  Q  ; Writes sterility control data
"RTN","GMTSLRM",44,0)
 . I GMK=0 D  Q
"RTN","GMTSLRM",45,0)
 . . Q:$P(^TMP("LRM",$J,"BSTER",GMK),U)']""
"RTN","GMTSLRM",46,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",47,0)
 . .  W ?2,"Sterility Control:",?21,$P(^TMP("LRM",$J,"BSTER",GMK),U),! Q
"RTN","GMTSLRM",48,0)
 . D CKP^GMTSUP I $D(GMTSQIT)
"RTN","GMTSLRM",49,0)
 . W ?13,"Number:",?21,GMK,?34,"Sterility Results: ",$P(^TMP("LRM",$J,GMZ,GMK),U),!
"RTN","GMTSLRM",50,0)
 I GMK=0 S GMN=$G(^TMP("LRM",$J,GMZ,GMK)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,$S(GMZ="BACT":"    Bact ",GMZ="TB":"Mycobact ",GMZ="MYCO":"Mycology ",GMZ="PARA":"Parasite ",GMZ="VIRO":"Virology ",1:"         ")_"Report:",?21,$P(GMN,U),! D  Q
"RTN","GMTSLRM",51,0)
 . I GMZ="BACT" D  Q:$D(GMTSQIT)
"RTN","GMTSLRM",52,0)
 . . I $P(GMN,U,3)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?7,"Urine Screen: ",$P(GMN,U,3),!
"RTN","GMTSLRM",53,0)
 . . I $P(GMN,U,2)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?6,"Sputum Screen: ",$P(GMN,U,2),!
"RTN","GMTSLRM",54,0)
 . I GMZ="TB" D  Q:$D(GMTSQIT)
"RTN","GMTSLRM",55,0)
 . . I $P(GMN,U,2)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"Acid Fast Stain: ",$E($P(GMN,U,2),1,20) D
"RTN","GMTSLRM",56,0)
 . . . S QTY=$P(GMN,U,3)
"RTN","GMTSLRM",57,0)
 . . . I $L(QTY)>35 S QTY=$$WRAP^GMTSORC(QTY,35)
"RTN","GMTSLRM",58,0)
 . . . W ?44,$P(QTY,"|"),!
"RTN","GMTSLRM",59,0)
 . . . I $L($P(QTY,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?44,$P(QTY,"|",2),!
"RTN","GMTSLRM",60,0)
 I GMZ="GRAM" D WRTGRM^GMTSLRM1 Q
"RTN","GMTSLRM",61,0)
 I GMK="SMEAR" D  Q
"RTN","GMTSLRM",62,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",63,0)
 . W ?9,"Smear/Prep:"
"RTN","GMTSLRM",64,0)
 . S SMEAR=0
"RTN","GMTSLRM",65,0)
 . F  S SMEAR=$O(^TMP("LRM",$J,GMZ,GMK,SMEAR)) Q:SMEAR'>0  D  I +$O(^TMP("LRM",$J,GMK,SMEAR)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",66,0)
 . . S RSMEAR=^TMP("LRM",$J,GMZ,GMK,SMEAR)
"RTN","GMTSLRM",67,0)
 . . I $L(RSMEAR)>58 S RSMEAR=$$WRAP^GMTSORC(RSMEAR,58)
"RTN","GMTSLRM",68,0)
 . . W ?21,$P(RSMEAR,"|"),!
"RTN","GMTSLRM",69,0)
 . . I $L($P(RSMEAR,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?22,$P(RSMEAR,"|",2),!
"RTN","GMTSLRM",70,0)
 I GMK="R" D REMARKS^GMTSLRM1 Q
"RTN","GMTSLRM",71,0)
 I GMZ'="CABXL" D  Q:$D(GMTSQIT)
"RTN","GMTSLRM",72,0)
 . S ORG=$P(^TMP("LRM",$J,GMZ,GMK),U),QTY=$P(^(GMK),U,2)
"RTN","GMTSLRM",73,0)
 . I $L(ORG)>58 S ORG=$$WRAP^GMTSORC(ORG,58)
"RTN","GMTSLRM",74,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",75,0)
 . W ?11,"Organism:"
"RTN","GMTSLRM",76,0)
 . W ?21,$P(ORG,"|",1),!
"RTN","GMTSLRM",77,0)
 . I $L($P(ORG,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,$P(ORG,"|",2),!
"RTN","GMTSLRM",78,0)
 . I QTY]"" W ?11,"Quantity:" D
"RTN","GMTSLRM",79,0)
 . . I $L(QTY)>58 S QTY=$$WRAP^GMTSORC(QTY,58)
"RTN","GMTSLRM",80,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$P(QTY,"|"),!
"RTN","GMTSLRM",81,0)
 . . I $L($P(QTY,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,$P(QTY,"|",2),!
"RTN","GMTSLRM",82,0)
 . D COMMENT^GMTSLRM1 Q:$D(GMTSQIT)
"RTN","GMTSLRM",83,0)
 . I GMZ="TB" D TBSUSC^GMTSLRM1
"RTN","GMTSLRM",84,0)
 I GMZ="CABXL" D
"RTN","GMTSLRM",85,0)
 . I GMK=1!(GMABX=1) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Ser Abx Lev:"
"RTN","GMTSLRM",86,0)
 . W ?21,$E($P(^TMP("LRM",$J,GMZ,GMK),U),1,20),?45,$$DRAW($P(^TMP("LRM",$J,GMZ,GMK),U,2)),?55,$P(^TMP("LRM",$J,GMZ,GMK),U,3)," ug/ml",! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",87,0)
 I GMZ="BACT",$D(^TMP("LRM",$J,GMZ,GMK,"SUSC")) D ANTIBX^GMTSLRM1 Q
"RTN","GMTSLRM",88,0)
 I GMZ="PARA",$D(^TMP("LRM",$J,GMZ,GMK))=11 D
"RTN","GMTSLRM",89,0)
 . S GML=0
"RTN","GMTSLRM",90,0)
 . F  S GML=$O(^TMP("LRM",$J,GMZ,GMK,GML)) Q:GML'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRM",91,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",92,0)
 . . W ?23,$P(^TMP("LRM",$J,GMZ,GMK,GML),U)
"RTN","GMTSLRM",93,0)
 . . S QTY=$P(^TMP("LRM",$J,GMZ,GMK,GML),U,2)
"RTN","GMTSLRM",94,0)
 . . I $L(QTY)>34 S QTY=$$WRAP^GMTSORC(QTY,34)
"RTN","GMTSLRM",95,0)
 . . W ?45,$P(QTY,"|"),!
"RTN","GMTSLRM",96,0)
 . . I $L($P(QTY,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?45,$P(QTY,"|",2),!
"RTN","GMTSLRM",97,0)
 . . D PARACOMM^GMTSLRM1
"RTN","GMTSLRM",98,0)
 Q
"RTN","GMTSLRM",99,0)
DRAW(CODE) ; Peak/Trough/Random Abx level
"RTN","GMTSLRM",100,0)
 Q $S(CODE="P":"PEAK",CODE="T":"TROUGH",1:"RANDOM")
"RTN","GMTSLRMB")
0^75^B22230830
"RTN","GMTSLRMB",1,0)
GMTSLRMB ; SLC/JER,KER/NDBI - Microbiology Component Dvr ; 11/02/1998
"RTN","GMTSLRMB",2,0)
 ;;2.7;Health Summary;**25,28**;Oct 20, 1995
"RTN","GMTSLRMB",3,0)
MAIN N IX0,IX,LRDFN,MAX,D1,D2,D3
"RTN","GMTSLRMB",4,0)
 I $$ROK^GMTSU("A7RHSE"),$$NDBI^GMTSU,'$D(^DPT(DFN,"LR")),$D(^A7RHS("BMIC",DFN)) D LRDFN^A7RHSE(DFN)
"RTN","GMTSLRMB",5,0)
 Q:'$D(^DPT(DFN,"LR"))
"RTN","GMTSLRMB",6,0)
 S LRDFN=+^DPT(DFN,"LR") I $$NDBI^GMTSU,'$D(^LR(LRDFN)),'$D(^A7RHS("BMIC",DFN)) Q
"RTN","GMTSLRMB",7,0)
 D:$$ROK^GMTSU("A7RHSE")&($$NDBI^GMTSU) LST^A7RHSE(DFN,.A7RHS)
"RTN","GMTSLRMB",8,0)
 I $$NDBI^GMTSU,$S('$D(^LR(LRDFN,"MI",0))&'$D(A7RHS):1,'$O(^LR(LRDFN,"MI",GMTS1))&'$O(A7RHS(GMTS1)):1,$O(^(GMTS1))>GMTS2:1,1:0) Q
"RTN","GMTSLRMB",9,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLRMB",10,0)
 E  S MAX=999
"RTN","GMTSLRMB",11,0)
 S IX=GMTS1 F IX0=1:1:MAX S IX=$O(^LR(LRDFN,"MI",IX)) D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) MIC3^A7RHSM($S(IX0=1&(IX=""):GMTS2,1:IX)) Q:IX=""!(IX>GMTS2)  D:IX0>1 CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSLRMB",12,0)
 . W:IX0>1&'GMTSNPG ! D ^GMTSLRME,INTRP:$D(^TMP("LRM",$J)) K ^TMP("LRM",$J)
"RTN","GMTSLRMB",13,0)
 K:$$NDBI^GMTSU A7RHS
"RTN","GMTSLRMB",14,0)
 Q
"RTN","GMTSLRMB",15,0)
INTRP ; Interprets ^TMP("LRM",$J, and calls WRT to print component
"RTN","GMTSLRMB",16,0)
 N GMTSJ,GMK,GMW,SMEAR,GMABX
"RTN","GMTSLRMB",17,0)
 S (GMTSJ,GMK)=""
"RTN","GMTSLRMB",18,0)
 F  S GMTSJ=$O(^TMP("LRM",$J,GMTSJ)) Q:GMTSJ=""!$D(GMTSQIT)  D RDNODE
"RTN","GMTSLRMB",19,0)
 Q
"RTN","GMTSLRMB",20,0)
RDNODE ; Reads current node of GMTSLRMI
"RTN","GMTSLRMB",21,0)
 Q:GMTSJ="BSTER"
"RTN","GMTSLRMB",22,0)
 I GMTSJ=0 D  Q
"RTN","GMTSLRMB",23,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W $P($P(^TMP("LRM",$J,GMTSJ),U)," "),?12,$P(^TMP("LRM",$J,GMTSJ),U,3),!
"RTN","GMTSLRMB",24,0)
 . D WRTTEST
"RTN","GMTSLRMB",25,0)
 S GMK=""
"RTN","GMTSLRMB",26,0)
 F  S GMK=$O(^TMP("LRM",$J,GMTSJ,GMK)) Q:GMK=""!$D(GMTSQIT)  D WRTNODE
"RTN","GMTSLRMB",27,0)
 I GMTSJ="TB" D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",28,0)
 . I $P(^TMP("LRM",$J,GMTSJ,0),U,2)]"" D
"RTN","GMTSLRMB",29,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",30,0)
 . . W "AFB Sme:",?12,$E($P(^TMP("LRM",$J,GMTSJ,0),U,2),1,20),!
"RTN","GMTSLRMB",31,0)
 . . I $P(^TMP("LRM",$J,GMTSJ,0),U,3)]"" D
"RTN","GMTSLRMB",32,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",33,0)
 . . . W ?12,$P(^TMP("LRM",$J,GMTSJ,0),U,3),!
"RTN","GMTSLRMB",34,0)
 I $D(^TMP("LRM",$J,GMTSJ,"SMEAR")) D
"RTN","GMTSLRMB",35,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",36,0)
 . W ?2,"Smear:"
"RTN","GMTSLRMB",37,0)
 . S SMEAR=0
"RTN","GMTSLRMB",38,0)
 . F  S SMEAR=$O(^TMP("LRM",$J,GMTSJ,"SMEAR",SMEAR)) Q:SMEAR'>0  W ?12,^(SMEAR),! I +$O(^TMP("LRM",$J,"SMEAR",SMEAR)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",39,0)
 Q
"RTN","GMTSLRMB",40,0)
WRTNODE ; Writes current node of GMTSLRMI
"RTN","GMTSLRMB",41,0)
 N GML
"RTN","GMTSLRMB",42,0)
 I GMK=0 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?1,"Report:",?12,$P(^TMP("LRM",$J,GMTSJ,GMK),U),! Q
"RTN","GMTSLRMB",43,0)
 I GMTSJ="GRAM" D WRTGRM Q
"RTN","GMTSLRMB",44,0)
 Q:GMK="SMEAR"
"RTN","GMTSLRMB",45,0)
 I GMK="R" D REMARKS Q
"RTN","GMTSLRMB",46,0)
 I GMTSJ'="CABXL" D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",47,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Organsm:",?12,$P(^TMP("LRM",$J,GMTSJ,GMK),U),!
"RTN","GMTSLRMB",48,0)
 . I $P(^TMP("LRM",$J,GMTSJ,GMK),U,2)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"QTY:",?12,$P(^TMP("LRM",$J,GMTSJ,GMK),U,2),!
"RTN","GMTSLRMB",49,0)
 I GMTSJ="CABXL" D
"RTN","GMTSLRMB",50,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",51,0)
 . W:GMK=1 "Ser Abx:"
"RTN","GMTSLRMB",52,0)
 . W ?12,$E($P(^TMP("LRM",$J,GMTSJ,GMK),U),1,18),?30,$$DRAW^GMTSLRM($P(^TMP("LRM",$J,GMTSJ,GMK),U,2)),?38,$P(^(GMK),U,3)," ug/ml",!
"RTN","GMTSLRMB",53,0)
 I GMTSJ="BACT",$D(^TMP("LRM",$J,GMTSJ,GMK,"SUSC")) D ANTIBX Q
"RTN","GMTSLRMB",54,0)
 I GMTSJ="PARA",$D(^TMP("LRM",$J,GMTSJ,GMK))=11 D
"RTN","GMTSLRMB",55,0)
 . S GML=""
"RTN","GMTSLRMB",56,0)
 . F  S GML=$O(^TMP("LRM",$J,GMTSJ,GMK,GML)) Q:GML'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",57,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",58,0)
 . . W ?12,$P(^TMP("LRM",$J,GMTSJ,GMK,GML),U)
"RTN","GMTSLRMB",59,0)
 . . S QTY=$P(^TMP("LRM",$J,GMTSJ,GMK,GML),U,2)
"RTN","GMTSLRMB",60,0)
 . . I $L(QTY)>46 S QTY=$$WRAP^GMTSORC(QTY,46)
"RTN","GMTSLRMB",61,0)
 . . W ?35,$P(QTY,"|"),!
"RTN","GMTSLRMB",62,0)
 . . I $L($P(QTY,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?35,$P(QTY,"|",2),!
"RTN","GMTSLRMB",63,0)
 Q
"RTN","GMTSLRMB",64,0)
REMARKS ; Write remarks
"RTN","GMTSLRMB",65,0)
 N NUM,FIRST
"RTN","GMTSLRMB",66,0)
 S NUM="",FIRST=1
"RTN","GMTSLRMB",67,0)
 F  S NUM=$O(^TMP("LRM",$J,GMTSJ,GMK,NUM)) Q:+NUM'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",68,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",69,0)
 . W:$X>0 !
"RTN","GMTSLRMB",70,0)
 . I FIRST W "Remarks:" S FIRST=0
"RTN","GMTSLRMB",71,0)
 . W ?12,^TMP("LRM",$J,GMTSJ,GMK,NUM),!
"RTN","GMTSLRMB",72,0)
 Q
"RTN","GMTSLRMB",73,0)
WRTGRM ; Writes Gram Stain Results
"RTN","GMTSLRMB",74,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:$X>0 ! W:GMK=1 ?3,"Gram:" W ?12,$E(^TMP("LRM",$J,GMTSJ,GMK),1,69),!
"RTN","GMTSLRMB",75,0)
 Q
"RTN","GMTSLRMB",76,0)
ANTIBX ; Writes Antibiotic susceptability data
"RTN","GMTSLRMB",77,0)
 N GML,GMCNT,ANAM,ANLEN,ANEXT,GMSUB
"RTN","GMTSLRMB",78,0)
 S GMABX=1
"RTN","GMTSLRMB",79,0)
 F GMSUB="S","I","R","O" D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",80,0)
 . Q:+$D(^TMP("LRM",$J,GMTSJ,GMK,"SUSC",GMSUB))'>0
"RTN","GMTSLRMB",81,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",82,0)
 . W:GMSUB="S" "Susc to:    "
"RTN","GMTSLRMB",83,0)
 . W:GMSUB="I" "Interme:    "
"RTN","GMTSLRMB",84,0)
 . W:GMSUB="R" "Resista:    "
"RTN","GMTSLRMB",85,0)
 . W:GMSUB="O" "  Other:    "
"RTN","GMTSLRMB",86,0)
 . S ANLEN=10,GML=""
"RTN","GMTSLRMB",87,0)
 . F  S GML=$O(^TMP("LRM",$J,GMTSJ,GMK,"SUSC",GMSUB,GML)) Q:GML=""  S ANAM=$P($P(^(GML),U),";",2)_$S(GMSUB="O":"("_$P(^(GML),U,2)_"/"_$P(^(GML),U,3)_")",1:""),ANEXT=$O(^(GML)) D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",88,0)
 . . I $L(ANAM)+ANLEN>79 D CKP^GMTSUP Q:$D(GMTSQIT)  W:'GMTSNPG ! W ?12 S ANLEN=10
"RTN","GMTSLRMB",89,0)
 . . W ANAM,$S(ANEXT]"":", ",1:"") S ANLEN=ANLEN+$L(ANAM)+2
"RTN","GMTSLRMB",90,0)
 . W !
"RTN","GMTSLRMB",91,0)
 Q
"RTN","GMTSLRMB",92,0)
WRTTEST ; Writes Lab Test for Accession
"RTN","GMTSLRMB",93,0)
 N GML,GMCNT,TNAM,TLEN,TNEXT
"RTN","GMTSLRMB",94,0)
 Q:'$D(^TMP("LRM",$J,GMTSJ,"TEST"))
"RTN","GMTSLRMB",95,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Test(s):    "
"RTN","GMTSLRMB",96,0)
 S TLEN=10,GML=""
"RTN","GMTSLRMB",97,0)
 F  S GML=$O(^TMP("LRM",$J,GMTSJ,"TEST",GML)) Q:GML=""  S TNAM=$P($G(^(GML)),U),TNEXT=$O(^(GML)) D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",98,0)
 . I $L(TNAM)+TLEN>79 D CKP^GMTSUP Q:$D(GMTSQIT)  W:'GMTSNPG ! W ?12 S TLEN=10
"RTN","GMTSLRMB",99,0)
 . W TNAM,$S(TNEXT]"":", ",1:"") S TLEN=TLEN+$L(TNAM)+2
"RTN","GMTSLRMB",100,0)
 W !
"RTN","GMTSLRMB",101,0)
 Q
"RTN","GMTSLRME")
0^24^B20889574
"RTN","GMTSLRME",1,0)
GMTSLRME ; SLC/JER,KER - Microbiology Extract Routine ; 11/02/1998
"RTN","GMTSLRME",2,0)
 ;;2.7;Health Summary;**25,28**;Oct 20, 1995
"RTN","GMTSLRME",3,0)
XTRCT N ACC,CDT,SS,CS,X,DIC,DIQ,DA,DR,MICRO,LOC,RDT,MICCOM
"RTN","GMTSLRME",4,0)
 K ^TMP("LRM",$J)
"RTN","GMTSLRME",5,0)
 S X=$P(^LR(LRDFN,"MI",IX,0),U),RDT=$P(^(0),U,3),ACC=$P(^(0),U,6),LOC=$P(^(0),U,8) D REGDTM4^GMTSU S CDT=X K X
"RTN","GMTSLRME",6,0)
 D LABTEST($P(^LR(LRDFN,"MI",IX,0),U),ACC)
"RTN","GMTSLRME",7,0)
 ; External format of site/specimen, collection sample, and comment
"RTN","GMTSLRME",8,0)
 S DIC=63,DIQ="MICRO",DIQ(0)="E",DA=LRDFN,DA(63.05)=IX,DR=5,DR(63.05)=".05;.055;.99"
"RTN","GMTSLRME",9,0)
 D EN^DIQ1
"RTN","GMTSLRME",10,0)
 S SS=MICRO(63.05,IX,.05,"E")
"RTN","GMTSLRME",11,0)
 S CS=MICRO(63.05,IX,.055,"E"),MICCOM=MICRO(63.05,IX,.99,"E")
"RTN","GMTSLRME",12,0)
 S ^TMP("LRM",$J,0)=CDT_U_ACC_U_SS I $D(EXPAND) S ^TMP("LRM",$J,0)=^TMP("LRM",$J,0)_U_RDT_U_LOC
"RTN","GMTSLRME",13,0)
 S $P(^TMP("LRM",$J,0),U,6)=CS_U_MICCOM
"RTN","GMTSLRME",14,0)
 D ABXLEV,BACT,GRAM,STER,PARA^GMTSLRMX,MYCO^GMTSLRMX,TB^GMTSLRMX,VIRO^GMTSLRMX
"RTN","GMTSLRME",15,0)
 Q
"RTN","GMTSLRME",16,0)
BACT ; Get Bacteriology Work-up
"RTN","GMTSLRME",17,0)
 N DA,DIC,DIQ,DR,STATUS,ISO,ORG,RMK,COM,SMEAR
"RTN","GMTSLRME",18,0)
 I $D(^LR(LRDFN,"MI",IX,1)) D
"RTN","GMTSLRME",19,0)
 . S DIC=63,DA=LRDFN,DA(63.05)=IX,DR=5,DR(63.05)="11.5;11.51;11.57;11.58",DIQ="STATUS"
"RTN","GMTSLRME",20,0)
 . S DIQ(0)="E" D EN^DIQ1
"RTN","GMTSLRME",21,0)
 . ;Include Status, sputum screen, and urine screen
"RTN","GMTSLRME",22,0)
 . S ^TMP("LRM",$J,"BACT",0)=$E($P(STATUS(63.05,IX,11.5,"E")," ",1),1,6)_U_STATUS(63.05,IX,11.58,"E")_U_STATUS(63.05,IX,11.57,"E")
"RTN","GMTSLRME",23,0)
 . ; Include sterility control
"RTN","GMTSLRME",24,0)
 . S ^TMP("LRM",$J,"BSTER",0)=STATUS(63.05,IX,11.51,"E")
"RTN","GMTSLRME",25,0)
 S ISO=0
"RTN","GMTSLRME",26,0)
 F  S ISO=$O(^LR(LRDFN,"MI",IX,3,ISO)) Q:+ISO'>0  D
"RTN","GMTSLRME",27,0)
 . D ORGNSM S ^TMP("LRM",$J,"BACT",ISO)=$S($D(EXPAND):ISO_";"_ORG,1:ORG) I $O(^LR(LRDFN,"MI",IX,3,ISO,1)) D ANTIBX
"RTN","GMTSLRME",28,0)
 . ;comment
"RTN","GMTSLRME",29,0)
 . S COM=0
"RTN","GMTSLRME",30,0)
 . F  S COM=$O(^LR(LRDFN,"MI",IX,3,ISO,1,COM)) Q:COM'>0  S ^TMP("LRM",$J,"BACT",ISO,"COM",COM)=^(COM,0)
"RTN","GMTSLRME",31,0)
 ; Bacteriology smear/prep
"RTN","GMTSLRME",32,0)
 S SMEAR=0
"RTN","GMTSLRME",33,0)
 F  S SMEAR=$O(^LR(LRDFN,"MI",IX,25,SMEAR)) Q:SMEAR'>0  S ^TMP("LRM",$J,"BACT","SMEAR",SMEAR)=^(SMEAR,0)
"RTN","GMTSLRME",34,0)
 ; remark
"RTN","GMTSLRME",35,0)
 S RMK=0
"RTN","GMTSLRME",36,0)
 F  S RMK=$O(^LR(LRDFN,"MI",IX,4,RMK)) Q:RMK=""  S ^TMP("LRM",$J,"BACT","R",RMK)=^(RMK,0)
"RTN","GMTSLRME",37,0)
 Q
"RTN","GMTSLRME",38,0)
ORGNSM N QTY
"RTN","GMTSLRME",39,0)
 S ORG=+^LR(LRDFN,"MI",IX,3,ISO,0),QTY=$P(^(0),U,2),ORG=$P(^LAB(61.2,ORG,0),U)
"RTN","GMTSLRME",40,0)
 S ORG=ORG_U_QTY
"RTN","GMTSLRME",41,0)
 Q
"RTN","GMTSLRME",42,0)
ANTIBX ; Get Antibitiotic susceptibility results on demand
"RTN","GMTSLRME",43,0)
 N ABX
"RTN","GMTSLRME",44,0)
 S ABX=1
"RTN","GMTSLRME",45,0)
 F  S ABX=$O(^LR(LRDFN,"MI",IX,3,ISO,ABX)) Q:ABX=""!(ABX'<3)  D ABXSET
"RTN","GMTSLRME",46,0)
 Q
"RTN","GMTSLRME",47,0)
ABXSET ; Set Antibiotic Susceptability data, when appropriate
"RTN","GMTSLRME",48,0)
 ; Separate out by Susceptable, Intermediate, and Resistant
"RTN","GMTSLRME",49,0)
 N ABXN,FOUND,GMTSR,GMABX
"RTN","GMTSLRME",50,0)
 S ABXN=ABX_";"_$P($G(^LAB(62.06,+$O(^LAB(62.06,"AD",ABX,"")),0)),U)
"RTN","GMTSLRME",51,0)
 I $P(ABXN,";",2)']"" S $P(ABXN,";",2)="UNKNOWN"
"RTN","GMTSLRME",52,0)
 I ("A"[$P(^LR(LRDFN,"MI",IX,3,ISO,ABX),U,3)) D
"RTN","GMTSLRME",53,0)
 . S GMABX=$G(^LR(LRDFN,"MI",IX,3,ISO,ABX))
"RTN","GMTSLRME",54,0)
 .;Check for interpreted result being S, I, or R first
"RTN","GMTSLRME",55,0)
 .S FOUND=0
"RTN","GMTSLRME",56,0)
 .S GMTSR=$P(GMABX,U,2) D SAVE Q:FOUND
"RTN","GMTSLRME",57,0)
 .;If not found then check reported result for S, I, or R
"RTN","GMTSLRME",58,0)
 .S GMTSR=$P(GMABX,U) D SAVE Q:FOUND
"RTN","GMTSLRME",59,0)
 .;Neither interpreted nor reported result equaled S, I, or R so we'll store it in the "other" list provided that reported and interpreted are both not null
"RTN","GMTSLRME",60,0)
 .S:$P(GMABX,U)'=""&($P(GMABX,U,2)'="") ^TMP("LRM",$J,"BACT",ISO,"SUSC","O",$P($P(ABXN,U),";",2))=ABXN_U_GMABX
"RTN","GMTSLRME",61,0)
 Q
"RTN","GMTSLRME",62,0)
ABXLEV ; Get Serum antibiotic level
"RTN","GMTSLRME",63,0)
 N GMI
"RTN","GMTSLRME",64,0)
 Q:'$D(^LR(LRDFN,"MI",IX,14))
"RTN","GMTSLRME",65,0)
 S GMI=0
"RTN","GMTSLRME",66,0)
 F  S GMI=$O(^LR(LRDFN,"MI",IX,14,GMI)) Q:GMI'>0  S ^TMP("LRM",$J,"CABXL",GMI)=$G(^(GMI,0))
"RTN","GMTSLRME",67,0)
 Q
"RTN","GMTSLRME",68,0)
STER ; Get sterility results if they exist
"RTN","GMTSLRME",69,0)
 N RESULT,STER
"RTN","GMTSLRME",70,0)
 S STER=0
"RTN","GMTSLRME",71,0)
 F  S STER=$O(^LR(LRDFN,"MI",IX,31,STER)) Q:STER'>0  D
"RTN","GMTSLRME",72,0)
 . S DIQ(0)="E",DIC=63,DA=LRDFN,DA(63.05)=IX,DR=5,DR(63.05)=11.52
"RTN","GMTSLRME",73,0)
 . S DR(63.292)=.01,DIQ="RESULT"
"RTN","GMTSLRME",74,0)
 . S DA(63.292)=STER
"RTN","GMTSLRME",75,0)
 . D EN^DIQ1
"RTN","GMTSLRME",76,0)
 . S ^TMP("LRM",$J,"BSTER",STER)=RESULT(63.292,STER,.01,"E")
"RTN","GMTSLRME",77,0)
 Q
"RTN","GMTSLRME",78,0)
GRAM ; Get Gram Stain Results
"RTN","GMTSLRME",79,0)
 N ISO
"RTN","GMTSLRME",80,0)
 Q:'$D(^LR(LRDFN,"MI",IX,2))
"RTN","GMTSLRME",81,0)
 S ISO=0
"RTN","GMTSLRME",82,0)
 F  S ISO=$O(^LR(LRDFN,"MI",IX,2,ISO)) Q:ISO=""  S ^TMP("LRM",$J,"GRAM",ISO)=^(ISO,0)
"RTN","GMTSLRME",83,0)
 Q
"RTN","GMTSLRME",84,0)
LABTEST(SDT,LRACC) ;Get lab test names and results
"RTN","GMTSLRME",85,0)
 N X,Y,LRAA,LRAN,LRAD,LRBRR,LRTSTS,LRTS
"RTN","GMTSLRME",86,0)
 S LRAD=+$E(SDT)_$P(LRACC," ",2)_"0000",X=$P(LRACC," "),DIC=68,DIC(0)="M"
"RTN","GMTSLRME",87,0)
 Q:'$L(X)  D ^DIC S LRAA=+Y,LRAN=+$P(LRACC," ",3)
"RTN","GMTSLRME",88,0)
 S LRBRR=0
"RTN","GMTSLRME",89,0)
 F  S LRBRR=+$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRBRR)) Q:LRBRR'>0  D
"RTN","GMTSLRME",90,0)
 . S LRTS=+^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRBRR,0),LRTS(1)=$P(^(0),U,5)
"RTN","GMTSLRME",91,0)
 . Q:"BO"'[$P($G(^LAB(60,LRTS,0)),U,3)
"RTN","GMTSLRME",92,0)
 . S LRTSTS=$S($D(^LAB(60,LRTS,0)):$P(^(0),U),1:"deleted test")
"RTN","GMTSLRME",93,0)
 . ;Lab test name and results in print order
"RTN","GMTSLRME",94,0)
 . S ^TMP("LRM",$J,0,"TEST",$S($D(^LAB(60,LRTS,.1)):$P(^(.1),U,6),1:"")_","_U_LRBRR)=LRTSTS_U_LRTS(1)
"RTN","GMTSLRME",95,0)
 Q
"RTN","GMTSLRME",96,0)
SAVE ;If result = S, I, or R then save
"RTN","GMTSLRME",97,0)
 I $S(GMTSR="I":1,GMTSR="R":1,GMTSR="S":1,1:0) S ^TMP("LRM",$J,"BACT",ISO,"SUSC",GMTSR,$P($P(ABXN,U),";",2))=ABXN_U_GMABX S FOUND=1
"RTN","GMTSLRME",98,0)
 Q
"RTN","GMTSLROB")
0^81^B2347531
"RTN","GMTSLROB",1,0)
GMTSLROB ; SLC/JER - Brief Lab Order ; 11/02/1998
"RTN","GMTSLROB",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSLROB",3,0)
MAIN ; Driver
"RTN","GMTSLROB",4,0)
 N GMW,GMX,ICD,MAX,OC,SN
"RTN","GMTSLROB",5,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLROB",6,0)
 E  S MAX=999
"RTN","GMTSLROB",7,0)
 D ^GMTSLROE
"RTN","GMTSLROB",8,0)
 I '$D(^TMP("LRO",$J)) Q
"RTN","GMTSLROB",9,0)
 D WRTHDR
"RTN","GMTSLROB",10,0)
 S (ICD,OC)=0 F  S ICD=$O(^TMP("LRO",$J,ICD)) Q:'ICD!(OC'<MAX)  S SN=0 F  S SN=$O(^TMP("LRO",$J,ICD,SN)) Q:'SN!(OC'<MAX)  D MORE
"RTN","GMTSLROB",11,0)
 K ^TMP("LRO",$J)
"RTN","GMTSLROB",12,0)
 Q
"RTN","GMTSLROB",13,0)
MORE S GMX=^TMP("LRO",$J,ICD,SN),OC=OC+1 I ICD>GMTS1,(ICD'>GMTS2) D WRT
"RTN","GMTSLROB",14,0)
 Q
"RTN","GMTSLROB",15,0)
WRTHDR ; Prints Header
"RTN","GMTSLROB",16,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Collection DT",?18,"Test Name",?39,"Specimen",?51,"Urgency",?68,"Status",!!
"RTN","GMTSLROB",17,0)
 Q
"RTN","GMTSLROB",18,0)
WRT ; Writes Component
"RTN","GMTSLROB",19,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR W $P(GMX,U),?18,$P($P(GMX,U,2),";",2),?39,$E($P($P(GMX,U,3),";",2),1,10),?51,$P(GMX,U,4),?68,$P(GMX,U,5),!
"RTN","GMTSLROB",20,0)
 Q
"RTN","GMTSLROE")
0^25^B9952757
"RTN","GMTSLROE",1,0)
GMTSLROE ; SLC/JER,KER - Lab Orders Extract Routine ; 11/02/1998
"RTN","GMTSLROE",2,0)
 ;;2.7;Health Summary;**9,28**;Oct 20, 1995
"RTN","GMTSLROE",3,0)
XTRCT ; Gets lab orders and loads them into GMTSLRO local array
"RTN","GMTSLROE",4,0)
 N LRDFN,GMI,CD,ID,SN,TN K ^TMP("LROI",$J)
"RTN","GMTSLROE",5,0)
 K ^TMP("LRO",$J)
"RTN","GMTSLROE",6,0)
 Q:'$D(^DPT(DFN,"LR"))  S LRDFN=+^DPT(DFN,"LR") Q:'$D(^LR(LRDFN))
"RTN","GMTSLROE",7,0)
 S CD=GMTSBEG-.1
"RTN","GMTSLROE",8,0)
 F  S CD=$O(^LRO(69,"D",LRDFN,CD)) Q:CD'>0!(CD>GMTSEND)  S SN=0 F  S SN=$O(^LRO(69,"D",LRDFN,CD,SN)) Q:SN'>0  S TN=0 F  S TN=$O(^LRO(69,CD,1,SN,2,TN)) Q:TN'>0  S ^TMP("LROI",$J,9999999-CD,SN,TN)=""
"RTN","GMTSLROE",9,0)
 S (GMI,ID)=0 F  S ID=$O(^TMP("LROI",$J,ID)) Q:ID'>0!(GMI=MAX)  S CD=9999999-ID,SN=0 F  S SN=$O(^TMP("LROI",$J,ID,SN)) Q:SN'>0!(GMI=MAX)  S TN=0 F  S TN=$O(^TMP("LROI",$J,ID,SN,TN)) Q:TN'>0!(GMI=MAX)  D SET
"RTN","GMTSLROE",10,0)
 K ^TMP("LROI",$J)
"RTN","GMTSLROE",11,0)
 Q
"RTN","GMTSLROE",12,0)
SET ; Sets ^TMP("LRO",$J, w/appropriate data
"RTN","GMTSLROE",13,0)
 N SPST,CST,OS,CDT,SPST,FST,RDT,SITE,SPEC,TST,IDT,COLL,ODT,MD,CS,URG,ACC
"RTN","GMTSLROE",14,0)
 N RL,TEST
"RTN","GMTSLROE",15,0)
 I $D(^LRO(69,CD,1,SN,0)) S SPST=^(0) D ORDER
"RTN","GMTSLROE",16,0)
 I $D(^LRO(69,CD,1,SN,1)) S CST=^(1) D COLLECT I 1
"RTN","GMTSLROE",17,0)
 E  S OS="ORDERED",X=$P(^LRO(69,CD,1,SN,0),U,8),IDT=9999999-X D REGDTM4^GMTSU S CDT=X K X
"RTN","GMTSLROE",18,0)
 I $D(^LRO(69,CD,1,SN,3)) S FST=^(3) D RESULT I 1
"RTN","GMTSLROE",19,0)
 E  S RDT="UNKNOWN"
"RTN","GMTSLROE",20,0)
 S SITE=+$G(^LRO(69,CD,1,SN,4,+$O(^LRO(69,CD,1,SN,4,0)),0)),SPEC=$S(SITE>0:SITE_";"_$P(^LAB(61,SITE,0),U),1:";UNKNOWN")
"RTN","GMTSLROE",21,0)
 I $D(^LRO(69,CD,1,SN,2,TN,0)) S TST=^(0) S:$P(TST,"^",9)="CA" OS="CANCELED" D TEST
"RTN","GMTSLROE",22,0)
 I $D(BADTEST) K BADTEST Q
"RTN","GMTSLROE",23,0)
 I $D(IDT),$D(SN),$D(TN) S ^TMP("LRO",$J,IDT,SN_TN)=CDT_U_TEST_U_SPEC_U_URG_U_OS_U_MD_U_ODT_U_ACC_U_RDT_U_COLL_U_CD,GMI=GMI+1
"RTN","GMTSLROE",24,0)
 Q
"RTN","GMTSLROE",25,0)
ORDER N NML,IFN,FNF,FILE,NM,NSPACE,PKG,X
"RTN","GMTSLROE",26,0)
 S COLL=$S($L($P(SPST,U,4)):$P(SPST,U,4),1:"UNKNOWN")
"RTN","GMTSLROE",27,0)
 S:"LW"[COLL COLL=$S(COLL="L":"LAB",1:"WARD")
"RTN","GMTSLROE",28,0)
 S X=$P(SPST,U,5) D REGDTM4^GMTSU S ODT=X
"RTN","GMTSLROE",29,0)
 S NML=10,(MD,IFN)=$P(SPST,U,6),FNF=0,NSPACE="LR",PKG=$$VERSION^XPDUTL(NSPACE),FILE=$S($G(PKG)<5.2:6,1:200) D NAME^GMTSU S MD=MD_";"_NM
"RTN","GMTSLROE",30,0)
 S RL=$P(SPST,U,7)
"RTN","GMTSLROE",31,0)
 Q
"RTN","GMTSLROE",32,0)
COLLECT N X S X=$P(CST,U),IDT=9999999-X D REGDTM4^GMTSU S CDT=X
"RTN","GMTSLROE",33,0)
 S CS=$P(CST,U,4),OS="COLLECTED"
"RTN","GMTSLROE",34,0)
 Q
"RTN","GMTSLROE",35,0)
RESULT N X S X=$P(FST,U,2) D REGDTM4^GMTSU S RDT=X
"RTN","GMTSLROE",36,0)
 Q
"RTN","GMTSLROE",37,0)
TEST N TPTR,UPTR,ACCD,ACCA,ACCN
"RTN","GMTSLROE",38,0)
 S TPTR=+TST,UPTR=$P(TST,U,2),ACCD=$P(TST,U,3)
"RTN","GMTSLROE",39,0)
 I $D(TPTR),(TPTR'>0) S BADTEST=1 Q
"RTN","GMTSLROE",40,0)
 S ACCA=$P(TST,U,4),ACCN=$P(TST,U,5)
"RTN","GMTSLROE",41,0)
 S TEST=TPTR_";"_$S($L($P(^LAB(60,TPTR,0),U))<21:$P(^(0),U),1:$P(^(.1),U))
"RTN","GMTSLROE",42,0)
 S URG=$E($S($D(^LAB(62.05,+UPTR,0)):$P(^(0),U),1:""),1,7)
"RTN","GMTSLROE",43,0)
 I $S('$D(ACCD):1,'$L(ACCA):1,'$L(ACCD):1,1:0) S ACC="NONE" Q
"RTN","GMTSLROE",44,0)
 S ACC=$S($D(^LRO(68,+ACCA,1,+ACCD,1,+ACCN,.2)):^(.2),1:"NONE")
"RTN","GMTSLROE",45,0)
 I $D(^LRO(68,+ACCA,1,+ACCD,1,+ACCN,4,TPTR,0)) S X=$P(^(0),U,5) S OS=$S('$L(X):"PROCESSING",1:"COMPLETED")
"RTN","GMTSLROE",46,0)
 Q
"RTN","GMTSLROS")
0^80^B3279226
"RTN","GMTSLROS",1,0)
GMTSLROS ; SLC/JER,KER - Lab Order Status Summary ; 11/02/1998
"RTN","GMTSLROS",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSLROS",3,0)
MAIN ; Driver
"RTN","GMTSLROS",4,0)
 N GMW,GMX,ICD,MAX,OC,SN
"RTN","GMTSLROS",5,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLROS",6,0)
 E  S MAX=999
"RTN","GMTSLROS",7,0)
 D ^GMTSLROE
"RTN","GMTSLROS",8,0)
 I '$D(^TMP("LRO",$J)) Q
"RTN","GMTSLROS",9,0)
 S (ICD,OC)=0 F  S ICD=$O(^TMP("LRO",$J,ICD)) Q:'ICD!(OC'<MAX)  S SN=0 F  S SN=$O(^TMP("LRO",$J,ICD,SN)) Q:'SN!(OC'<MAX)  D MORE
"RTN","GMTSLROS",10,0)
 K ^TMP("LRO",$J)
"RTN","GMTSLROS",11,0)
 Q
"RTN","GMTSLROS",12,0)
MORE S GMX=^TMP("LRO",$J,ICD,SN),OC=OC+1 I ICD>GMTS1,(ICD'>GMTS2) D CKP^GMTSUP Q:$D(GMTSQIT)  W:OC>1&'(GMTSNPG) ! D WRT
"RTN","GMTSLROS",13,0)
 Q
"RTN","GMTSLROS",14,0)
WRT ; Writes Component
"RTN","GMTSLROS",15,0)
 N GMI,TSET,TEST
"RTN","GMTSLROS",16,0)
 S TSET="",$P(GMX,U,3)=$E($P(GMX,U,3),1,10)
"RTN","GMTSLROS",17,0)
 F GMI=1:1:3 S $P(TEST,"-",GMI)=$S(GMI=3:$P(GMX,U,GMI+1),1:$P($P(GMX,U,GMI+1),";",2))
"RTN","GMTSLROS",18,0)
 F  Q:$L(TEST)<23  S TSET=$P(TEST,"-",$L(TEST,"-"))_" "_TSET,TEST=$P(TEST,"-",1,$L(TEST,"-")-1)
"RTN","GMTSLROS",19,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMX,U),?18,$E(TEST,1,20),?39,"Prov: ",$E($P($P(GMX,U,6),";",2),1,10),?56,"Ord'd: ",$P(GMX,U,7),!
"RTN","GMTSLROS",20,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG WRT W ?18,$E(TSET,1,20),?39," Acc: ",$E($P(GMX,U,8),1,10),?56,"Avail: ",$P(GMX,U,9),!
"RTN","GMTSLROS",21,0)
 Q
"RTN","GMTSLRPE")
0^26^B9349321
"RTN","GMTSLRPE",1,0)
GMTSLRPE ; SLC/JER,KER - Cytopathology Extract Routine ; 11/02/1998
"RTN","GMTSLRPE",2,0)
 ;;2.7;Health Summary;**3,28**;Oct 20, 1995
"RTN","GMTSLRPE",3,0)
XTRCT N IX0,IX
"RTN","GMTSLRPE",4,0)
 K ^TMP("LRCY",$J)
"RTN","GMTSLRPE",5,0)
 S IX=GMTS1 F IX0=1:0:MAX S IX=$O(^LR(LRDFN,"CY",IX)) Q:IX'>0!(IX>GMTS2)  D CYSET
"RTN","GMTSLRPE",6,0)
 Q
"RTN","GMTSLRPE",7,0)
CYSET ; Sets ^TMP("LRCY",$J, with appropriate data elements
"RTN","GMTSLRPE",8,0)
 N ACC,CDT,D1,D2,D3,DA,DIC,DIQ,DR,DX,ICD,OT,SR,RELEASE,SITE,SN,X,YR
"RTN","GMTSLRPE",9,0)
 S CDT=$P(^LR(LRDFN,"CY",IX,0),U),ACC=$P(^(0),U,6),RELEASE=$P(^(0),U,11)
"RTN","GMTSLRPE",10,0)
 I $D(ACC) S IX0=IX0+1
"RTN","GMTSLRPE",11,0)
 S X=CDT D REGDT4^GMTSU S CDT=X K X
"RTN","GMTSLRPE",12,0)
 S ^TMP("LRCY",$J,IX,0)=CDT_U_ACC
"RTN","GMTSLRPE",13,0)
 I $D(^LR(LRDFN,"CY",IX,.1)) S ^TMP("LRCY",$J,IX,1)="Site/Specimen"_U_RELEASE
"RTN","GMTSLRPE",14,0)
 Q:'RELEASE
"RTN","GMTSLRPE",15,0)
 S SN=0 F  S SN=$O(^LR(LRDFN,"CY",IX,.1,SN)) Q:SN'>0  S ^TMP("LRCY",$J,IX,1,SN)=$P(^LR(LRDFN,"CY",IX,.1,SN,0),U)
"RTN","GMTSLRPE",16,0)
 S OT=0 F  S OT=$O(^LR(LRDFN,"CY",IX,.2,OT)) Q:+OT'>0  S ^TMP("LRCY",$J,IX,"AH",OT)=$G(^LR(LRDFN,"CY",IX,.2,OT,0))
"RTN","GMTSLRPE",17,0)
 S OT=0 F  S OT=$O(^LR(LRDFN,"CY",IX,1,OT)) Q:OT'>0  S ^TMP("LRCY",$J,IX,"G",OT)=^LR(LRDFN,"CY",IX,1,OT,0)
"RTN","GMTSLRPE",18,0)
 S OT=0 F  S OT=$O(^LR(LRDFN,"CY",IX,1.1,OT)) Q:OT'>0  S ^TMP("LRCY",$J,IX,"MI",OT)=^LR(LRDFN,"CY",IX,1.1,OT,0)
"RTN","GMTSLRPE",19,0)
 S OT=0 F  S OT=$O(^LR(LRDFN,"CY",IX,1.2,OT)) Q:OT'>0  D
"RTN","GMTSLRPE",20,0)
 . Q:+$P($G(^LR(LRDFN,"CY",IX,1.2,OT,0)),U,2)'>0
"RTN","GMTSLRPE",21,0)
 . S ^TMP("LRCY",$J,IX,"SR",OT,0)=$P($G(^LR(LRDFN,"CY",IX,1.2,OT,0)),U)
"RTN","GMTSLRPE",22,0)
 . S SR=0 F  S SR=$O(^LR(LRDFN,"CY",IX,1.2,OT,1,SR)) Q:SR'>0  D
"RTN","GMTSLRPE",23,0)
 . . S ^TMP("LRCY",$J,IX,"SR",OT,SR)=$P($G(^LR(LRDFN,"CY",IX,1.2,OT,1,SR,0)),U)
"RTN","GMTSLRPE",24,0)
 S OT=0 F  S OT=$O(^LR(LRDFN,"CY",IX,1.4,OT)) Q:+OT'>0  S ^TMP("LRCY",$J,IX,"NDX",OT)=$P($G(^LR(LRDFN,"CY",IX,1.4,OT,0)),U)
"RTN","GMTSLRPE",25,0)
 ;S OT=0 F  S OT=$O(^LR(LRDFN,"CY",IX,2,OT)) Q:OT=""  S ^TMP("LRCY",$J,IX,"OT"_OT,0)=$P(^LAB(61,+^LR(LRDFN,"CY",IX,2,OT,0),0),U) D D,M,P
"RTN","GMTSLRPE",26,0)
 ;S DX=0 F  S DX=$O(^LR(LRDFN,"CY",IX,3,DX)) Q:DX=""  S ICD=+^LR(LRDFN,"CY",IX,3,DX,0) D
"RTN","GMTSLRPE",27,0)
 ;. N DIC,DIQ,DR,DA,REC
"RTN","GMTSLRPE",28,0)
 ;. S DIC=80,DA=ICD,DIQ="REC(",DIQ(0)="IE",DR=".01;3"
"RTN","GMTSLRPE",29,0)
 ;. D EN^DIQ1
"RTN","GMTSLRPE",30,0)
 ;. Q:'$D(REC)
"RTN","GMTSLRPE",31,0)
 ;. S ^TMP("LRCY",$J,IX,"XI",DX)=REC(80,DA,.01,"E")_U_REC(80,DA,3,"E")
"RTN","GMTSLRPE",32,0)
 Q
"RTN","GMTSLRPE",33,0)
D ; Get Disease Field data
"RTN","GMTSLRPE",34,0)
 N GMD,DIS
"RTN","GMTSLRPE",35,0)
 S GMD=0 F  S GMD=$O(^LR(LRDFN,"CY",IX,2,OT,1,GMD)) Q:GMD=""  S ^TMP("LRCY",$J,IX,"OT"_OT,"D"_GMD)=$P(^LAB(61.4,+^LR(LRDFN,"CY",IX,2,OT,1,GMD,0),0),U)
"RTN","GMTSLRPE",36,0)
 Q
"RTN","GMTSLRPE",37,0)
M ; Get Morphology Field data
"RTN","GMTSLRPE",38,0)
 N GMM,MORPH
"RTN","GMTSLRPE",39,0)
 S GMM=0 F  S GMM=$O(^LR(LRDFN,"CY",IX,2,OT,2,GMM)) Q:GMM=""  S ^TMP("LRCY",$J,IX,"OT"_OT,"M"_GMM)=$P(^LAB(61.1,+^LR(LRDFN,"CY",IX,2,OT,2,GMM,0),0),U) D E
"RTN","GMTSLRPE",40,0)
 Q
"RTN","GMTSLRPE",41,0)
E ; Get Etiology Field data
"RTN","GMTSLRPE",42,0)
 N GME,ETIOL
"RTN","GMTSLRPE",43,0)
 S GME=0 F  S GME=$O(^LR(LRDFN,"CY",IX,2,OT,2,GMM,1,GME)) Q:GME'>0  S ^TMP("LRCY",$J,IX,"OT"_OT,"M"_GMM,"E"_GME)=$P(^LAB(61.2,+^LR(LRDFN,"CY",IX,2,OT,2,GMM,1,GME,0),0),U)
"RTN","GMTSLRPE",44,0)
 Q
"RTN","GMTSLRPE",45,0)
P ; Get Procedure Field data
"RTN","GMTSLRPE",46,0)
 N GMP,PROC
"RTN","GMTSLRPE",47,0)
 S GMP=0 F  S GMP=$O(^LR(LRDFN,"CY",IX,2,OT,4,GMP)) Q:GMP=""  S ^TMP("LRCY",$J,IX,"OT"_OT,"P"_GMP)=$P(^LAB(61.5,+^LR(LRDFN,"CY",IX,2,OT,4,GMP,0),0),U)
"RTN","GMTSLRPE",48,0)
 Q
"RTN","GMTSLRS")
0^76^B9234572
"RTN","GMTSLRS",1,0)
GMTSLRS ; SLC/JER,KER/NDBI - Sel Lab Component w/Selection Items ; 11/02/1998
"RTN","GMTSLRS",2,0)
 ;;2.7;Health Summary;**16,28**;Oct 20, 1995
"RTN","GMTSLRS",3,0)
MAIN N GMTSI,GMW,GMX,LRDFN,MAX,IT,IX,PTEST,TEST,BEGIN,END,CNT,RWIDTH
"RTN","GMTSLRS",4,0)
 N GMLINE,GMCMNT,GMCFLAG
"RTN","GMTSLRS",5,0)
 S RWIDTH=8 ;Optional variable used in ^GMTSLRSE
"RTN","GMTSLRS",6,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLRS",7,0)
 E  S MAX=999
"RTN","GMTSLRS",8,0)
 I $$ROK^GMTSU("A7RHSM"),$$ROK^GMTSU("A7RHSE"),$$NDBI^GMTSU,'$D(^DPT(DFN,"LR")),$D(^A7RHS($$NAM^A7RHSM(GMTSTYP,$P(GMTSEG(GMTSEGN),"^",2)),DFN)) D LRDFN^A7RHSE(DFN)
"RTN","GMTSLRS",9,0)
 Q:'$D(^DPT(DFN,"LR"))
"RTN","GMTSLRS",10,0)
 S LRDFN=+^DPT(DFN,"LR")
"RTN","GMTSLRS",11,0)
 I $$ROK^GMTSU("A7RHSM"),$$NDBI^GMTSU,'$D(^LR(LRDFN)),'$D(^A7RHS($$NAM^A7RHSM(GMTSTYP,$P(GMTSEG(GMTSEGN),"^",2)),DFN)) Q
"RTN","GMTSLRS",12,0)
 S GMCMNT=$S($P($G(^GMT(142.99,1,0)),U,3)="Y":1,1:0)
"RTN","GMTSLRS",13,0)
 I '$D(^LR(LRDFN)) Q
"RTN","GMTSLRS",14,0)
 I '$O(GMTSEG(GMTSEGN,60,0)) Q
"RTN","GMTSLRS",15,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,60,GMTSI)) Q:GMTSI'>0  S (PTEST,TEST)=GMTSEG(GMTSEGN,60,GMTSI) D @$S($L($P(^LAB(60,TEST,0),U,5)):"^GMTSLRSE",1:"PANEL")
"RTN","GMTSLRS",16,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) SLT^A7RHSM
"RTN","GMTSLRS",17,0)
 I '$D(^TMP("LRS",$J)) Q
"RTN","GMTSLRS",18,0)
 D WRTHDR
"RTN","GMTSLRS",19,0)
 S IT=0
"RTN","GMTSLRS",20,0)
 F  S IT=$O(^TMP("LRS",$J,IT)) Q:+IT'>0  S IX="" F  S IX=$O(^TMP("LRS",$J,IT,IX)) Q:'IX!(IX>GMTS2)  S GMX=^TMP("LRS",$J,IT,IX) D WRT
"RTN","GMTSLRS",21,0)
 I +$G(GMCFLAG) D
"RTN","GMTSLRS",22,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSLRS",23,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "!!  Indicates COMMENTS AVAILABLE...Refer to Interim Lab Report.",!
"RTN","GMTSLRS",24,0)
 K ^TMP("LRS",$J)
"RTN","GMTSLRS",25,0)
 Q
"RTN","GMTSLRS",26,0)
PANEL ; Visits "PANEL" multiple to get pointers to atomic tests
"RTN","GMTSLRS",27,0)
 N TEST,GMW,INDX
"RTN","GMTSLRS",28,0)
 S INDX=0 F  S INDX=$O(^LAB(60,PTEST,2,INDX)) Q:'INDX  S TEST=^(INDX,0) S:'$L($P(^LAB(60,TEST,0),U,5)) PTEST=TEST D @$S($L($P(^LAB(60,TEST,0),U,5)):"^GMTSLRSE",1:"PANEL")
"RTN","GMTSLRS",29,0)
 Q
"RTN","GMTSLRS",30,0)
WRTHDR ; Prints columnar header
"RTN","GMTSLRS",31,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Collection DT",?18,"Specimen",?29,"Test Name",?48,"Result",?58,"Units",?68,"Ref Range",!!
"RTN","GMTSLRS",32,0)
 Q
"RTN","GMTSLRS",33,0)
WRT ; Writes the Lab Record
"RTN","GMTSLRS",34,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSLRS",35,0)
 . D:GMTSNPG WRTHDR
"RTN","GMTSLRS",36,0)
 . W $P(GMX,U),?18,$P($P(GMX,U,2),";",2)
"RTN","GMTSLRS",37,0)
 . I $D(^TMP("LRS",$J,"C",IX))>9,'+$G(GMCMNT) W ?24,"!! " S GMCFLAG=1
"RTN","GMTSLRS",38,0)
 . W ?29,$E($P($P(GMX,U,3),";",2),1,17),?46,$P(GMX,U,4)," ",$P(GMX,U,5),?58,$P(GMX,U,6),?68,$J($P(GMX,U,7),4),?73,"-",?74,$J($P(GMX,U,8),4),!
"RTN","GMTSLRS",39,0)
 I +$G(GMCMNT),$D(^TMP("LRS",$J,"C",IX))>9,'$D(^TMP("LRS",$J,+$O(^TMP("LRS",$J,IT)),IX)) D  Q
"RTN","GMTSLRS",40,0)
 . S GMLINE=0
"RTN","GMTSLRS",41,0)
 . F  S GMLINE=$O(^TMP("LRS",$J,"C",IX,GMLINE)) Q:GMLINE'>0  D
"RTN","GMTSLRS",42,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRS",43,0)
 . . W "Comment: ",^TMP("LRS",$J,"C",IX,GMLINE),!
"RTN","GMTSLRS",44,0)
 Q
"RTN","GMTSLRS7")
0^77^B13776598
"RTN","GMTSLRS7",1,0)
GMTSLRS7 ; SLC/JER,KER/NDBI - Sel Cum Lab Comp w/Sel Items ; 11/02/1998
"RTN","GMTSLRS7",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSLRS7",3,0)
MAIN N GMTSI,GMW,HDR,LRDFN,MAX,TEST,RWIDTH,GMCMNT,COMMNBR,GMCOM,TAB
"RTN","GMTSLRS7",4,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLRS7",5,0)
 E  S MAX=999
"RTN","GMTSLRS7",6,0)
 I $$ROK^GMTSU("A7RHSM"),$$ROK^GMTSU("A7RHSE"),$$NDBI^GMTSU,'$D(^DPT(DFN,"LR")),$D(^A7RHS($$NAM^A7RHSM(GMTSTYP,$P(GMTSEG(GMTSEGN),"^",2)),DFN)) D LRDFN^A7RHSE(DFN)
"RTN","GMTSLRS7",7,0)
 Q:'$D(^DPT(DFN,"LR"))
"RTN","GMTSLRS7",8,0)
 S LRDFN=+^DPT(DFN,"LR")
"RTN","GMTSLRS7",9,0)
 I '$D(^LR(LRDFN)) Q
"RTN","GMTSLRS7",10,0)
 I '$O(GMTSEG(GMTSEGN,60,0)) Q
"RTN","GMTSLRS7",11,0)
 S RWIDTH=4 ;Width of result which is used by lab print code
"RTN","GMTSLRS7",12,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,60,GMTSI)) Q:GMTSI'>0  S TEST=GMTSEG(GMTSEGN,60,GMTSI) D ^GMTSLRSE
"RTN","GMTSLRS7",13,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) SCL^A7RHSM
"RTN","GMTSLRS7",14,0)
 I '$D(^TMP("LRS",$J)) Q
"RTN","GMTSLRS7",15,0)
 S GMCMNT=$S($P($G(^GMT(142.99,1,0)),U,3)="Y":1,1:0),COMMNBR=0
"RTN","GMTSLRS7",16,0)
 D DISPLAY
"RTN","GMTSLRS7",17,0)
 I GMCMNT,'$D(GMTSQIT) D WRTCOMM
"RTN","GMTSLRS7",18,0)
 K ^TMP("LRS",$J),^TMP("LRSR",$J)
"RTN","GMTSLRS7",19,0)
 Q
"RTN","GMTSLRS7",20,0)
DISPLAY ; Displays up to 7 tests across page
"RTN","GMTSLRS7",21,0)
 N HDR,TST,GMI,GMX,GMW,IT,IX
"RTN","GMTSLRS7",22,0)
 D INVRT
"RTN","GMTSLRS7",23,0)
 S IT=""
"RTN","GMTSLRS7",24,0)
 F GMI=0:1:6 S IT=$O(^TMP("LRS",$J,IT)) Q:'IT  D
"RTN","GMTSLRS7",25,0)
 . S IX="" F  S IX=$O(^(IT,IX)) Q:IX'>0  D
"RTN","GMTSLRS7",26,0)
 . . S TST=+$P(^(IX),U,3),HDR(GMI)=$S(TST'="":$E($P($G(^LAB(60,TST,.1)),U),1,7),1:"")
"RTN","GMTSLRS7",27,0)
 . . S:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) HDR(GMI)=$$PRTNAM^A7RHSM($P(^TMP("LRS",$J,IT,IX),"^",3),HDR(GMI))
"RTN","GMTSLRS7",28,0)
 . . K ^TMP("LRS",$J,IT)
"RTN","GMTSLRS7",29,0)
 D WRTHDR
"RTN","GMTSLRS7",30,0)
 S IX=""
"RTN","GMTSLRS7",31,0)
 F GMW=1:1:MAX S IX=$O(^TMP("LRSR",$J,IX)) Q:+IX'>0  D 
"RTN","GMTSLRS7",32,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR
"RTN","GMTSLRS7",33,0)
 . S IT="" F GMI=0:1:6 S IT=$O(^TMP("LRSR",$J,IX,IT)) Q:IT=""  D
"RTN","GMTSLRS7",34,0)
 . . D WRT I '$O(^TMP("LRSR",$J,IX,IT)) W !
"RTN","GMTSLRS7",35,0)
 I (+$G(GMW)=+$G(MAX)),(+IX>0),$O(^TMP("LRSR",$J,IX)) D CKP^GMTSUP Q:$D(GMTSQIT)  W $C(7),!?10,"** Additional Results available outside occurrence limit **",!
"RTN","GMTSLRS7",36,0)
 Q
"RTN","GMTSLRS7",37,0)
INVRT ; Inverts ^TMP("LRS",$J,IT,IX)=CDT^SPEC^TNM^RESULT^FLAG^UNIT^LO^HI to
"RTN","GMTSLRS7",38,0)
 ;         ^TMP("LRSR",$J,IX,IT)=GMI,CDT,SPEC,RESULT,FLAG
"RTN","GMTSLRS7",39,0)
 N GMI,GMW,IT,IX
"RTN","GMTSLRS7",40,0)
 S IT=""
"RTN","GMTSLRS7",41,0)
 F GMI=0:1:6 S IT=$O(^TMP("LRS",$J,IT)) Q:IT'>0  S IX="" F  S IX=$O(^TMP("LRS",$J,IT,IX)) Q:IX=""  S ^TMP("LRSR",$J,IX,IT)=GMI_U_$P(^TMP("LRS",$J,IT,IX),U,1,2)_U_$P(^TMP("LRS",$J,IT,IX),U,4,5)
"RTN","GMTSLRS7",42,0)
 Q
"RTN","GMTSLRS7",43,0)
WRTHDR ; Writes Column Header
"RTN","GMTSLRS7",44,0)
 N GMI
"RTN","GMTSLRS7",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Collection DT"
"RTN","GMTSLRS7",46,0)
 W ?19,$S(+$G(GMCMNT):" ",1:""),"Spec"
"RTN","GMTSLRS7",47,0)
 F GMI=0:1:6 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  W ?(((8*GMI+25)+(7-$L(HDR(GMI))\2))),$E(HDR(GMI),1,7)
"RTN","GMTSLRS7",48,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!
"RTN","GMTSLRS7",49,0)
 Q
"RTN","GMTSLRS7",50,0)
WRT ; Writes the Lab Record
"RTN","GMTSLRS7",51,0)
 S GMX=^TMP("LRSR",$J,IX,IT),TAB=$P(GMX,U)
"RTN","GMTSLRS7",52,0)
 I GMI=0!(GMTSNPG) D
"RTN","GMTSLRS7",53,0)
 . ;Index up to 26 date with comments when flag turned on
"RTN","GMTSLRS7",54,0)
 . I +$G(GMCMNT),$D(^TMP("LRS",$J,"C",IX))>0,$D(GMCOM("DT",IX))'>0,COMMNBR<26 D
"RTN","GMTSLRS7",55,0)
 . . S GMLTR=$C(97+COMMNBR) S COMMNBR=COMMNBR+1
"RTN","GMTSLRS7",56,0)
 . . S GMCOM("DT",IX)=GMLTR,GMCOM("LTR",GMLTR)=IX
"RTN","GMTSLRS7",57,0)
 . I +$G(GMCMNT) W $E($G(GMCOM("DT",IX)),1),?2,$P(GMX,U,2),?19,$E($P($P(GMX,U,3),";",2),1,5) Q
"RTN","GMTSLRS7",58,0)
 . W $P(GMX,U,2),?19,$E($P($P(GMX,U,3),";",2),1,5)
"RTN","GMTSLRS7",59,0)
 W ?(8*TAB+25),$P(GMX,U,4)," ",$P(GMX,U,5)
"RTN","GMTSLRS7",60,0)
 Q
"RTN","GMTSLRS7",61,0)
WRTCOMM ; Writes the lab Comments
"RTN","GMTSLRS7",62,0)
 N GMLTR,GMLINE
"RTN","GMTSLRS7",63,0)
 Q:$D(GMCOM)'>0
"RTN","GMTSLRS7",64,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "COMMENTS:",!
"RTN","GMTSLRS7",65,0)
 S GMLTR=""
"RTN","GMTSLRS7",66,0)
 F  S GMLTR=$O(GMCOM("LTR",GMLTR)) Q:GMLTR']""  D  Q:$D(GMTSQIT)
"RTN","GMTSLRS7",67,0)
 . S IX=$G(GMCOM("LTR",GMLTR)),GMLINE=0
"RTN","GMTSLRS7",68,0)
 . F  S GMLINE=$O(^TMP("LRS",$J,"C",+IX,GMLINE)) Q:GMLINE'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRS7",69,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  I GMTSNPG W "COMMENTS:",!
"RTN","GMTSLRS7",70,0)
 . . W:GMLINE=1!GMTSNPG GMLTR_"."
"RTN","GMTSLRS7",71,0)
 . . W ?3,$G(^TMP("LRS",$J,"C",+IX,GMLINE)),!
"RTN","GMTSLRS7",72,0)
 Q
"RTN","GMTSLRSC")
0^78^B14490840
"RTN","GMTSLRSC",1,0)
GMTSLRSC ; SLC/JER,KER/NDBI - Sel Cum Lab Comp w/Sel Items ; 11/02/1998
"RTN","GMTSLRSC",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSLRSC",3,0)
MAIN N GMTSI,LRDFN,MAX,TEST,RWIDTH,GMCMNT,COMMNBR,GMCOM,TAB
"RTN","GMTSLRSC",4,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLRSC",5,0)
 E  S MAX=999
"RTN","GMTSLRSC",6,0)
 I $$ROK^GMTSU("A7RHSM"),$$ROK^GMTSU("A7RHSE"),$$NDBI^GMTSU,'$D(^DPT(DFN,"LR")),$D(^A7RHS($$NAM^A7RHSM(GMTSTYP,$P(GMTSEG(GMTSEGN),"^",2)),DFN)) D LRDFN^A7RHSE(DFN)
"RTN","GMTSLRSC",7,0)
 Q:'$D(^DPT(DFN,"LR"))
"RTN","GMTSLRSC",8,0)
 S LRDFN=+^DPT(DFN,"LR")
"RTN","GMTSLRSC",9,0)
 I '$D(^LR(LRDFN)) Q
"RTN","GMTSLRSC",10,0)
 I '$O(GMTSEG(GMTSEGN,60,0)) Q
"RTN","GMTSLRSC",11,0)
 S RWIDTH=4 ;Width of result which is used by lab print code
"RTN","GMTSLRSC",12,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,60,GMTSI)) Q:GMTSI'>0  S TEST=GMTSEG(GMTSEGN,60,GMTSI) D ^GMTSLRSE
"RTN","GMTSLRSC",13,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) SCLU^A7RHSM
"RTN","GMTSLRSC",14,0)
 I '$D(^TMP("LRS",$J)) Q
"RTN","GMTSLRSC",15,0)
 S GMCMNT=$S($P($G(^GMT(142.99,1,0)),U,3)="Y":1,1:0),COMMNBR=0
"RTN","GMTSLRSC",16,0)
 F  D DISPLAY Q:$O(^TMP("LRS",$J,0))'>0
"RTN","GMTSLRSC",17,0)
 I GMCMNT,'$D(GMTSQIT) D WRTCOMM
"RTN","GMTSLRSC",18,0)
 K ^TMP("LRS",$J),^TMP("LRSR",$J)
"RTN","GMTSLRSC",19,0)
 Q
"RTN","GMTSLRSC",20,0)
DISPLAY ; Displays up to 7 tests across page
"RTN","GMTSLRSC",21,0)
 N GMI,GMW,GMX,HDR,TST,IT,IX
"RTN","GMTSLRSC",22,0)
 D INVRT
"RTN","GMTSLRSC",23,0)
 S IT=""
"RTN","GMTSLRSC",24,0)
 F GMI=0:1:6 S IT=$O(^TMP("LRS",$J,IT)) Q:'IT  D
"RTN","GMTSLRSC",25,0)
 . S IX="" F  S IX=$O(^(IT,IX)) Q:IX'>0  D
"RTN","GMTSLRSC",26,0)
 . . S TST=+$P(^(IX),U,3),HDR(GMI)=$S(TST'="":$E($P($G(^LAB(60,TST,.1)),U),1,7),1:"")
"RTN","GMTSLRSC",27,0)
 . . S:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) HDR(GMI)=$$PRTNAM^A7RHSM($P(^TMP("LRS",$J,IT,IX),"^",3),HDR(GMI))
"RTN","GMTSLRSC",28,0)
 . . K ^TMP("LRS",$J,IT)
"RTN","GMTSLRSC",29,0)
 D WRTHDR
"RTN","GMTSLRSC",30,0)
 S IX=""
"RTN","GMTSLRSC",31,0)
 F GMW=1:1:MAX S IX=$O(^TMP("LRSR",$J,IX)) Q:+IX'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR S IT="" F GMI=0:1 S IT=$O(^TMP("LRSR",$J,IX,IT)) Q:IT=""  D WRT I '$O(^TMP("LRSR",$J,IX,IT)) W !
"RTN","GMTSLRSC",32,0)
 I (+$G(GMW)=+$G(MAX)),(+IX>0),$O(^TMP("LRSR",$J,IX)) D CKP^GMTSUP Q:$D(GMTSQIT)  W $C(7),!?10,"** Additional Results available outside occurrence limit **",!
"RTN","GMTSLRSC",33,0)
 K ^TMP("LRSR",$J) W:$D(^TMP("LRS",$J)) !
"RTN","GMTSLRSC",34,0)
 Q
"RTN","GMTSLRSC",35,0)
INVRT ; Inverts ^TMP("LRS",$J,IT,IX)=CDT^SPEC^TNM^RESULT^FLAG^UNIT^LO^HI to
"RTN","GMTSLRSC",36,0)
 ;         ^TMP("LRSR",$J,IX,IT)=GMI,CDT,SPEC,RESULT,FLAG
"RTN","GMTSLRSC",37,0)
 N GMI,IT,IX
"RTN","GMTSLRSC",38,0)
 S IT=""
"RTN","GMTSLRSC",39,0)
 F GMI=0:1:6 S IT=$O(^TMP("LRS",$J,IT)) Q:IT'>0  S IX="" F  S IX=$O(^TMP("LRS",$J,IT,IX)) Q:IX=""  S ^TMP("LRSR",$J,IX,IT)=GMI_U_$P(^TMP("LRS",$J,IT,IX),U,1,2)_U_$P(^TMP("LRS",$J,IT,IX),U,4,5)
"RTN","GMTSLRSC",40,0)
 Q
"RTN","GMTSLRSC",41,0)
WRTHDR ; Writes Column Header
"RTN","GMTSLRSC",42,0)
 N GMI
"RTN","GMTSLRSC",43,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Collection DT"
"RTN","GMTSLRSC",44,0)
 W ?19,$S(+$G(GMCMNT):" ",1:""),"Spec"
"RTN","GMTSLRSC",45,0)
 F GMI=0:1:6 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  W ?(((8*GMI+25)+(7-$L(HDR(GMI))\2))),$E(HDR(GMI),1,7)
"RTN","GMTSLRSC",46,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!
"RTN","GMTSLRSC",47,0)
 Q
"RTN","GMTSLRSC",48,0)
WRT ; Writes the Lab Record
"RTN","GMTSLRSC",49,0)
 S GMX=^TMP("LRSR",$J,IX,IT),TAB=$P(GMX,U)
"RTN","GMTSLRSC",50,0)
 I GMI=0!(GMTSNPG) D
"RTN","GMTSLRSC",51,0)
 . ;Index up to 26 date with comments when flag turned on
"RTN","GMTSLRSC",52,0)
 . I +$G(GMCMNT),$D(^TMP("LRS",$J,"C",IX))>0,$D(GMCOM("DT",IX))'>0,COMMNBR<26 D
"RTN","GMTSLRSC",53,0)
 . . S GMLTR=$C(97+COMMNBR) S COMMNBR=COMMNBR+1
"RTN","GMTSLRSC",54,0)
 . . S GMCOM("DT",IX)=GMLTR,GMCOM("LTR",GMLTR)=IX
"RTN","GMTSLRSC",55,0)
 . I +$G(GMCMNT) W $E($G(GMCOM("DT",IX)),1),?2,$P(GMX,U,2),?19,$E($P($P(GMX,U,3),";",2),1,5) Q
"RTN","GMTSLRSC",56,0)
 . W $P(GMX,U,2),?19,$E($P($P(GMX,U,3),";",2),1,5)
"RTN","GMTSLRSC",57,0)
 W ?(8*TAB+25),$P(GMX,U,4)," ",$P(GMX,U,5)
"RTN","GMTSLRSC",58,0)
 Q
"RTN","GMTSLRSC",59,0)
WRTCOMM ; Writes the lab Comments
"RTN","GMTSLRSC",60,0)
 N GMLTR,GMLINE
"RTN","GMTSLRSC",61,0)
 Q:$D(GMCOM)'>0
"RTN","GMTSLRSC",62,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "COMMENTS:",!
"RTN","GMTSLRSC",63,0)
 S GMLTR=""
"RTN","GMTSLRSC",64,0)
 F  S GMLTR=$O(GMCOM("LTR",GMLTR)) Q:GMLTR']""  D  Q:$D(GMTSQIT)
"RTN","GMTSLRSC",65,0)
 . S IX=$G(GMCOM("LTR",GMLTR)),GMLINE=0
"RTN","GMTSLRSC",66,0)
 . F  S GMLINE=$O(^TMP("LRS",$J,"C",+IX,GMLINE)) Q:GMLINE'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRSC",67,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  I GMTSNPG W "COMMENTS:",!
"RTN","GMTSLRSC",68,0)
 . . W:GMLINE=1!GMTSNPG GMLTR_"."
"RTN","GMTSLRSC",69,0)
 . . W ?3,$G(^TMP("LRS",$J,"C",+IX,GMLINE)),!
"RTN","GMTSLRSC",70,0)
 Q
"RTN","GMTSLRSE")
0^27^B6150601
"RTN","GMTSLRSE",1,0)
GMTSLRSE ; SLC/JER,KER/NDBI - Selected Lab Test Extract ; 11/02/1998
"RTN","GMTSLRSE",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSLRSE",3,0)
XTRCT ; Call with: LRDFN, GMTS1, GMTS2, MAX (Occ. Limit), SEX ("M" or "F"),
"RTN","GMTSLRSE",4,0)
 ; TEST (IFN to ^LAB(60)) and RWIDTH (optional)
"RTN","GMTSLRSE",5,0)
 ; "Returns":
"RTN","GMTSLRSE",6,0)
 ; ^TMP("LRS",$J,GMTSI,IDRWDT)=DRWDT^SPEC^TEST^RESULT^FLAG^UNIT^LO^HI
"RTN","GMTSLRSE",7,0)
 ; where: GMTSI=Order (1 to MAX) and IDRWDT=9999999-Draw Date/time,
"RTN","GMTSLRSE",8,0)
 ; DRWDT=Draw Date/Time (internal), SPEC=Specimen (int;ext),
"RTN","GMTSLRSE",9,0)
 ; TEST=Test (int;ext), RESULT=Numeric Result,
"RTN","GMTSLRSE",10,0)
 ; FLAG=Reference flag (H,*H,L,*L), UNIT=Unit of measure (ext),
"RTN","GMTSLRSE",11,0)
 ; LO=Reference/Therapeutic Lower bound, HI=Ref/Ther Upper Bound
"RTN","GMTSLRSE",12,0)
 N CNT,AGE,COM,GMI,X
"RTN","GMTSLRSE",13,0)
 K ^TMP("LRS",$J,GMTSI)
"RTN","GMTSLRSE",14,0)
 I $S("BO"'[$P(^LAB(60,TEST,0),U,3):1,1:0) Q
"RTN","GMTSLRSE",15,0)
 I '$D(GMTSAGE) D DEM^GMTSU
"RTN","GMTSLRSE",16,0)
 S AGE=GMTSAGE
"RTN","GMTSLRSE",17,0)
 S CNT=0 D CHEM:$P(^LAB(60,TEST,0),U,4)="CH"
"RTN","GMTSLRSE",18,0)
 Q
"RTN","GMTSLRSE",19,0)
CHEM ; Gets all Chemistry tests w/in time/occurrence constraints
"RTN","GMTSLRSE",20,0)
 N PTR,IDRWDT
"RTN","GMTSLRSE",21,0)
 S PTR=+$P($P(^LAB(60,+TEST,0),U,5),";",2)
"RTN","GMTSLRSE",22,0)
 S IDRWDT=GMTS1
"RTN","GMTSLRSE",23,0)
 F  S IDRWDT=$O(^LR(LRDFN,"CH",IDRWDT)) Q:'IDRWDT!(IDRWDT>GMTS2)!(CNT'<MAX)  I $P(^(IDRWDT,0),U,3),($D(^(PTR))) S CNT=CNT+1 D:CNT'>MAX CHSET
"RTN","GMTSLRSE",24,0)
 Q
"RTN","GMTSLRSE",25,0)
CHSET ; Sets Chemistry locals for printing
"RTN","GMTSLRSE",26,0)
 N RESULT,FLAG,DRWDT,SITE,SPEC,TNM,DESCR,THER,UNIT,HI,LO,GMIDT
"RTN","GMTSLRSE",27,0)
 S RESULT=$P(^LR(LRDFN,"CH",IDRWDT,PTR),U),FLAG=$P(^(PTR),U,2),DRWDT=9999999-IDRWDT
"RTN","GMTSLRSE",28,0)
 S RESULT=$$RESULT^GMTSLRCE(TEST,RESULT,$G(RWIDTH))
"RTN","GMTSLRSE",29,0)
 S X=DRWDT D REGDTM4^GMTSU S DRWDT=X K X
"RTN","GMTSLRSE",30,0)
 S SITE=$P(^LR(LRDFN,"CH",IDRWDT,0),U,5),SPEC=SITE_";"_$P(^LAB(61,SITE,0),U)
"RTN","GMTSLRSE",31,0)
 S TNM=TEST_";"_$S($L($P(^LAB(60,TEST,0),U))<21:$P(^(0),U),1:$P(^(.1),U))
"RTN","GMTSLRSE",32,0)
 I $$NDBI^GMTSU,$P($G(^LAB(60,TEST,.1)),"^")]"" S TNM=TNM_";"_$P(^(.1),"^")
"RTN","GMTSLRSE",33,0)
 S DESCR=$S($D(^LAB(60,TEST,1,SITE,0)):^(0),1:""),THER=$S($L($P(DESCR,U,11,12))>1:1,1:0)
"RTN","GMTSLRSE",34,0)
 S UNIT=$P(DESCR,U,7),LO=$S(THER:$P(DESCR,U,11),1:$P(DESCR,U,2)),HI=$S(THER:$P(DESCR,U,12),1:$P(DESCR,U,3))
"RTN","GMTSLRSE",35,0)
 S @("LO="_$S($L(LO):LO,1:"""""")),@("HI="_$S($L(HI):HI,1:""""""))
"RTN","GMTSLRSE",36,0)
 I $D(^TMP("LRS",$J,GMTSI,IDRWDT)) S GMIDT=IDRWDT+.0001
"RTN","GMTSLRSE",37,0)
 S GMIDT=IDRWDT
"RTN","GMTSLRSE",38,0)
 S ^TMP("LRS",$J,GMTSI,GMIDT)=DRWDT_U_$E(SPEC,1,10)_U_TNM_U_RESULT_U_FLAG_U_UNIT_U_LO_U_HI
"RTN","GMTSLRSE",39,0)
 I $D(^LR(LRDFN,"CH",IDRWDT,1,0)) D
"RTN","GMTSLRSE",40,0)
 . S COM=0
"RTN","GMTSLRSE",41,0)
 . F GMI=1:1 S COM=$O(^LR(LRDFN,"CH",IDRWDT,1,COM)) Q:+COM'>0  S ^TMP("LRS",$J,"C",GMIDT,GMI)=^LR(LRDFN,"CH",IDRWDT,1,COM,0)
"RTN","GMTSLRSE",42,0)
 Q
"RTN","GMTSLRT")
0^28^B4215651
"RTN","GMTSLRT",1,0)
GMTSLRT ; SLC/JER,KER/NDBI - Blood Bank Transfusion Comp Dvr ; 11/02/1998
"RTN","GMTSLRT",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSLRT",3,0)
MAIN N GMA,GMI,GMR,IX,MAX,A,R,TD,BPN
"RTN","GMTSLRT",4,0)
 D ^GMTSLRTE ; Get Transfusion Records
"RTN","GMTSLRT",5,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) BT^A7RHSM
"RTN","GMTSLRT",6,0)
 I '$D(^TMP("LRT",$J)) Q
"RTN","GMTSLRT",7,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLRT",8,0)
 E  S MAX=999
"RTN","GMTSLRT",9,0)
 S IX=GMTS1 F GMI=1:1:MAX S IX=$O(^TMP("LRT",$J,IX)) Q:IX=""!(IX>GMTS2)  S GMR=^TMP("LRT",$J,IX) D PRSREC,WRT
"RTN","GMTSLRT",10,0)
 I $O(^TMP("LRT",$J,"A"))'="" D
"RTN","GMTSLRT",11,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSLRT",12,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W " Blood Product Key: "
"RTN","GMTSLRT",13,0)
 S GMI="A" F  S GMI=$O(^TMP("LRT",$J,GMI)) Q:GMI=""  D
"RTN","GMTSLRT",14,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,GMI," = ",$G(^TMP("LRT",$J,GMI)),!
"RTN","GMTSLRT",15,0)
 K ^TMP("LRT",$J)
"RTN","GMTSLRT",16,0)
 Q
"RTN","GMTSLRT",17,0)
PRSREC ; Parses Record for presentation
"RTN","GMTSLRT",18,0)
 N GMI,X
"RTN","GMTSLRT",19,0)
 S X=$P(GMR,U) D REGDT4^GMTSU S TD=X
"RTN","GMTSLRT",20,0)
 S GMA(1)=$P(GMR,U,2),BPN=$L(GMA(1),";")
"RTN","GMTSLRT",21,0)
 I $P(GMA(1),";",BPN)="" S BPN=BPN-1
"RTN","GMTSLRT",22,0)
 F GMI=2:1:BPN S GMA(GMI)="("_$P($P(GMA(1),";",GMI),"\")_") "_$P($P(GMA(1),";",GMI),"\",2)
"RTN","GMTSLRT",23,0)
 S GMA(1)="("_$P($P(GMA(1),";",1),"\")_") "_$P($P(GMA(1),";",1),"\",2)
"RTN","GMTSLRT",24,0)
 Q
"RTN","GMTSLRT",25,0)
WRT ; Writes the Transfusion Record for each day
"RTN","GMTSLRT",26,0)
 N GML,GMI1,GMI2,GMM,GMJ
"RTN","GMTSLRT",27,0)
 S GMM=$S(BPN#4:1,1:0)
"RTN","GMTSLRT",28,0)
 S GML=BPN\4+GMM ; # of lines record will require
"RTN","GMTSLRT",29,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W TD
"RTN","GMTSLRT",30,0)
 F GMI1=1:1:GML F GMI2=1:1:($S((GMI1=GML)&(BPN#4):BPN#4,1:4)) S GMJ=((GMI1-1)*4)+GMI2 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?(((GMI2-1)*15)+10),GMA(GMJ) I $S(GMI2#4=0:1,GMI2=BPN:1,GMI2+(4*(GMI1-1))=BPN:1,1:0) W !
"RTN","GMTSLRT",31,0)
 Q
"RTN","GMTSLTR")
0^68^B3938946
"RTN","GMTSLTR",1,0)
GMTSLTR ; SLC/JER,KER - Print Big Letters ; 11/02/1998
"RTN","GMTSLTR",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSLTR",3,0)
 Q:'$L($G(GMTSLTR))  I '$D(^UTILITY("GMTSLTR",$J,"A")) D ^GMTSLTR2
"RTN","GMTSLTR",4,0)
B1 ; Setup for banner print
"RTN","GMTSLTR",5,0)
 N GMTSDIV,GMTSLEN,GMTSXXX,GMTSBLNK,X
"RTN","GMTSLTR",6,0)
 S GMTSLEN=$L(GMTSLTR),GMTSDIV=60\GMTSLEN,$P(GMTSXXX,"X",(GMTSDIV\5+1))=""
"RTN","GMTSLTR",7,0)
 S $P(GMTSBLNK," ",(GMTSDIV\5+1))=""
"RTN","GMTSLTR",8,0)
 S GMTSLTY=$E(GMTSLTR,1,$S(GMTSLEN'>2:GMTSLEN,1:(IOM\GMTSDIV-1))),GMTSLTX=""
"RTN","GMTSLTR",9,0)
 F GMTSLT1=1:1:$L(GMTSLTY) D
"RTN","GMTSLTR",10,0)
 . I $A(GMTSLTY,GMTSLT1)>32,$D(^UTILITY("GMTSLTR",$J,$E(GMTSLTY,GMTSLT1))) D
"RTN","GMTSLTR",11,0)
 . . S GMTSLTX=GMTSLTX_$E(GMTSLTY,GMTSLT1)
"RTN","GMTSLTR",12,0)
 W:$L($P($G(GMTSSC),U,2)) "HEALTH SUMMARY REPORT FOR PATIENTS AT: ",$P(GMTSSC,U,2)
"RTN","GMTSLTR",13,0)
 I $L($P($G(GMTSSC),U,4)) S X=$P(GMTSSC,U,4) D REGDTM4^GMTSU W !?34,"FOR: ",X
"RTN","GMTSLTR",14,0)
 I $L($P($G(GMTSSC),U,5)) S X=$P(GMTSSC,U,5) D REGDTM4^GMTSU W " TO ",X
"RTN","GMTSLTR",15,0)
 W ! I $D(GMTSTITL) W ?(IOM-$L(GMTSTITL)\2),GMTSTITL,!!
"RTN","GMTSLTR",16,0)
 I $D(GMTSPNM) W ?10,"Patient: ",GMTSPNM,!
"RTN","GMTSLTR",17,0)
 I $D(GMTSWDN) W "Hospital Location: ",GMTSWDN,!
"RTN","GMTSLTR",18,0)
 I $D(DUZ) W ?33,"User: ",$P($G(^VA(200,DUZ,0)),U),!
"RTN","GMTSLTR",19,0)
 W ! F GMTSLT=1:1:6 D B2
"RTN","GMTSLTR",20,0)
 W @IOF
"RTN","GMTSLTR",21,0)
 K GMTSLT1,GMTSLT2,GMTSLT3,GMTSLTX,GMTSLTY,GMTSLT,^UTILITY("GMTSLTR",$J)
"RTN","GMTSLTR",22,0)
 Q
"RTN","GMTSLTR",23,0)
B2 W !
"RTN","GMTSLTR",24,0)
 F GMTSLT1=9:-1:1 W ! F GMTSLT3=1:1:$L(GMTSLTX) S X=^UTILITY("GMTSLTR",$J,$E(GMTSLTX,GMTSLT3)) W "   " F GMTSLT2=1:1:5 W $S($E(X,(GMTSLT2-1*9+GMTSLT1)):GMTSXXX,1:GMTSBLNK)
"RTN","GMTSLTR",25,0)
 Q
"RTN","GMTSMCPZ")
0^29^B5686148
"RTN","GMTSMCPZ",1,0)
GMTSMCPZ ; SLC/SBW,KER - Medicine 2.0 HS Component ; 11/02/1998
"RTN","GMTSMCPZ",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSMCPZ",3,0)
 K WH,%DT,X,Y Q
"RTN","GMTSMCPZ",4,0)
BEG ;SEARCH FOR SELECTED PATIENT IN CARDIOLOGY FILE
"RTN","GMTSMCPZ",5,0)
 D KVAR^VADPT
"RTN","GMTSMCPZ",6,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSMCPZ",7,0)
 E  S MAX=50
"RTN","GMTSMCPZ",8,0)
LOC ;LOCATE PROCEDURES FROM "AC" X-REF
"RTN","GMTSMCPZ",9,0)
 I '$D(^MCAR(690,"AC",DFN)) G EXIT
"RTN","GMTSMCPZ",10,0)
 K ^TMP("MCAR",$J) S S4=GMTS1-.0001 F M=1:1:MAX S S4=$O(^MCAR(690,"AC",DFN,S4)) Q:S4=""!(S4>GMTS2)  D LOCFIL
"RTN","GMTSMCPZ",11,0)
 G PR0
"RTN","GMTSMCPZ",12,0)
LOCFIL G LOCFIL1:$D(S5) S S5="" F K=1:1 S S5=$O(^MCAR(690,"AC",DFN,S4,S5)) Q:S5=""  D LOCFIL1
"RTN","GMTSMCPZ",13,0)
 K S5 Q
"RTN","GMTSMCPZ",14,0)
LOCFIL1 ; Set S5 to the PROCEDURE LOCATION (^MCAR(697.2,Y,0))
"RTN","GMTSMCPZ",15,0)
 S S6="" F L=1:1 S S6=$O(^MCAR(690,"AC",DFN,S4,S5,S6)) Q:S6=""  D CONT
"RTN","GMTSMCPZ",16,0)
 Q
"RTN","GMTSMCPZ",17,0)
CONT I S5[699 S (LL,LL1)=$P(^MCAR(699,S6,0),U,12),LL=$P(^MCAR(697.2,LL,0),U) G CONT1:'$D(PE) Q:PE'=LL  G CONT1
"RTN","GMTSMCPZ",18,0)
 I S5[694 S (LL,LL1)=$P(^MCAR(694,S6,0),U,3),LL=$P(^MCAR(697.2,LL,0),U) G CONT1:'$D(PE) Q:PE'=LL  G CONT1
"RTN","GMTSMCPZ",19,0)
 S (LL,LL1)=$O(^MCAR(697.2,"C",S5,0)),LL=$P(^MCAR(697.2,LL,0),U,1)
"RTN","GMTSMCPZ",20,0)
CONT1 S MCARSUM="",MCARFILE=U_S5_","_S6_",.2)" S:$D(@MCARFILE) MCARSUM=$P(@MCARFILE,U,1)
"RTN","GMTSMCPZ",21,0)
 K MCARFILE S S1=S4,S2=LL
"RTN","GMTSMCPZ",22,0)
 S ^TMP("MCAR",$J,S1,S2)=MCARSUM_U_S6_U_$P(^MCAR(697.2,LL1,0),U,5,7) K MCARSUM Q
"RTN","GMTSMCPZ",23,0)
PR0 I '$D(^TMP("MCAR",$J)) G EXIT
"RTN","GMTSMCPZ",24,0)
 S I="",L=0
"RTN","GMTSMCPZ",25,0)
PR1 S I=$O(^TMP("MCAR",$J,I)) G PR1:I="OT" I I="" G EXIT
"RTN","GMTSMCPZ",26,0)
 S J=""
"RTN","GMTSMCPZ",27,0)
PR2 S J=$O(^TMP("MCAR",$J,I,J)) G PR1:J="" S MCARDT=I,MCARPROC=J,PR=^(J)
"RTN","GMTSMCPZ",28,0)
 S DA=$P(PR,U,2),K=$P(PR,U)
"RTN","GMTSMCPZ",29,0)
 S K=$S(K="N"!(K="L"):"NORMAL",K="A":"ABNORMAL",K="B":"BORDERLINE",K="T":"TECHNICALLY UNSATISFACTORY",K="ND":"NON-DIAGNOSTIC",1:"")
"RTN","GMTSMCPZ",30,0)
 S Y=9999999.9999-MCARDT X ^DD("DD") D DFIX,CKP^GMTSUP Q:$D(GMTSQIT)  W Y,?23,MCARPROC,?62,K,!
"RTN","GMTSMCPZ",31,0)
 S ^TMP("MCAR",$J,"OT",L)=MCARPROC_U_DA_U_$P(PR,U,3,5)
"RTN","GMTSMCPZ",32,0)
 G PR2
"RTN","GMTSMCPZ",33,0)
DFIX ;
"RTN","GMTSMCPZ",34,0)
 S %DT="T",X=Y D ^%DT S X=Y D REGDTM4^GMTSU S Y=X Q
"RTN","GMTSMCPZ",35,0)
EXIT ;
"RTN","GMTSMCPZ",36,0)
 K PR,OT,DA,MCARPPS,I,J,R,L,S1,S2,S4,S5,S6,LL,LL1,MAX,VA
"RTN","GMTSMCPZ",37,0)
 K ^TMP("MCAR",$J),K,N,MCARDT,MCARNM,MCARPROC,M Q
"RTN","GMTSORC")
0^30^B9114085
"RTN","GMTSORC",1,0)
GMTSORC ; SLC/JER,KER - Current Orders (V2.5) ; 11/02/1998
"RTN","GMTSORC",2,0)
 ;;2.7;Health Summary;**15,28**;Oct 20, 1995
"RTN","GMTSORC",3,0)
MAIN ; controls branching and execution
"RTN","GMTSORC",4,0)
 I $$VERSION^XPDUTL("OR")'<3 G MAIN^GMTSORC3
"RTN","GMTSORC",5,0)
 N GMI,GMIDT,ORAGE,ORDOB,ORLIST,ORPNM,ORSEX,ORSSN,ORDR,ORVP,ORL,ORPV,ORTS,ORDUZ,ORNP,OROLD,ORIDT,ORUEND,ORUPRES,ORUSTART,ORUVP,X K ^TMP("OR",$J,"OUT")
"RTN","GMTSORC",6,0)
 S X="ORF4" X ^%ZOSF("TEST") I '$T Q
"RTN","GMTSORC",7,0)
 S ORUVP=$S($D(ORVP):ORVP,$D(DFN):DFN_";DPT(",1:0),ORUPRES=2,ORDR=1,ORUSTART=GMTSBEG,ORUEND=GMTSEND
"RTN","GMTSORC",8,0)
 I '$D(^OR(100,"AO",ORUVP)) Q
"RTN","GMTSORC",9,0)
 D ^ORF4
"RTN","GMTSORC",10,0)
 I '$D(^TMP("OR",$J)) Q
"RTN","GMTSORC",11,0)
 D HEAD
"RTN","GMTSORC",12,0)
 S GMIDT=GMTS1
"RTN","GMTSORC",13,0)
 F  S GMIDT=$O(^TMP("OR",$J,"OUT",GMIDT)) Q:GMIDT'>0!(GMIDT>GMTS2)  D
"RTN","GMTSORC",14,0)
 . S GMI=0 F  S GMI=$O(^TMP("OR",$J,"OUT",GMIDT,GMI)) Q:GMI'>0  D WRT
"RTN","GMTSORC",15,0)
 K ^TMP("OR",$J,"OUT")
"RTN","GMTSORC",16,0)
 Q
"RTN","GMTSORC",17,0)
HEAD ; Prints header
"RTN","GMTSORC",18,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Item Ordered",?48,"Start DT",?64,"Stop DT",!!
"RTN","GMTSORC",19,0)
 Q
"RTN","GMTSORC",20,0)
WRT ; Writes order record
"RTN","GMTSORC",21,0)
 N FDT,STDT,STAT,TEXT,GMTI,X
"RTN","GMTSORC",22,0)
 S TEXT=^TMP("OR",$J,"OUT",GMIDT,GMI,"ORTX"),STAT=$TR($E($P(^("ORSTS"),U,2),1),"DCHFPAESIN","dchfpaesin") S:STAT="d" STAT="dc"
"RTN","GMTSORC",23,0)
 S TEXT=$$FORMAT(TEXT)
"RTN","GMTSORC",24,0)
 S X=^TMP("OR",$J,"OUT",GMIDT,GMI,"ORSTOP") D:X]"" REGDTM4^GMTSU S FDT=X
"RTN","GMTSORC",25,0)
 S X=^TMP("OR",$J,"OUT",GMIDT,GMI,"ORSTRT") D:X]"" REGDTM4^GMTSU S STDT=X
"RTN","GMTSORC",26,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E($P(TEXT,"|"),1,40),?42,STAT,?45,STDT,?63,FDT,!
"RTN","GMTSORC",27,0)
 F GMTI=2:1:$L(TEXT,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG WRT W:$P(TEXT,"|",GMTI)]"" ?2,$P(TEXT,"|",GMTI),!
"RTN","GMTSORC",28,0)
 Q
"RTN","GMTSORC",29,0)
FORMAT(TEXT) ; Formats text field
"RTN","GMTSORC",30,0)
 N GMTI,GMX
"RTN","GMTSORC",31,0)
 F GMTI=1:1:$L(TEXT,"|") S $P(TEXT,"|",GMTI)=$$STRIP($P(TEXT,"|",GMTI))
"RTN","GMTSORC",32,0)
 S GMX="" F GMTI=1:1:$L(TEXT,"|") S:$P(TEXT,"|",GMTI)]"" GMX=GMX_$S(GMTI=1:"",1:" - ")_$P(TEXT,"|",GMTI)
"RTN","GMTSORC",33,0)
 S TEXT=GMX
"RTN","GMTSORC",34,0)
 I $L(TEXT)>43 S TEXT=$$WRAP(TEXT,43)
"RTN","GMTSORC",35,0)
 Q TEXT
"RTN","GMTSORC",36,0)
STRIP(TEXT) ; Strips white space from text
"RTN","GMTSORC",37,0)
 N GMTI,GMX
"RTN","GMTSORC",38,0)
 S GMX="" F GMTI=1:1:$L(TEXT," ") S:$A($P(TEXT," ",GMTI))>0 GMX=GMX_$S(GMTI=1:"",1:" ")_$P(TEXT," ",GMTI)
"RTN","GMTSORC",39,0)
 S TEXT=GMX
"RTN","GMTSORC",40,0)
 Q TEXT
"RTN","GMTSORC",41,0)
WRAP(TEXT,LENGTH) ; Breaks text string into substrings of length LENGTH
"RTN","GMTSORC",42,0)
 N GMTI,GMTJ,LINE,GMX,GMX1,GMX2,GMY
"RTN","GMTSORC",43,0)
 I $G(TEXT)']"" Q ""
"RTN","GMTSORC",44,0)
 F GMTI=1:1 D  Q:GMTI=$L(TEXT," ")
"RTN","GMTSORC",45,0)
 . S GMX=$P(TEXT," ",GMTI)
"RTN","GMTSORC",46,0)
 . I $L(GMX)>LENGTH D
"RTN","GMTSORC",47,0)
 . . S GMX1=$E(GMX,1,LENGTH),GMX2=$E(GMX,LENGTH+1,$L(GMX))
"RTN","GMTSORC",48,0)
 . . S $P(TEXT," ",GMTI)=GMX1_" "_GMX2
"RTN","GMTSORC",49,0)
 S LINE=1,GMX(1)=$P(TEXT," ")
"RTN","GMTSORC",50,0)
 F GMTI=2:1 D  Q:GMTI'<$L(TEXT," ")
"RTN","GMTSORC",51,0)
 . S:$L($G(GMX(LINE))_" "_$P(TEXT," ",GMTI))>LENGTH LINE=LINE+1,GMY=1
"RTN","GMTSORC",52,0)
 . S GMX(LINE)=$G(GMX(LINE))_$S(+$G(GMY):"",1:" ")_$P(TEXT," ",GMTI),GMY=0
"RTN","GMTSORC",53,0)
 S GMTJ=0,TEXT="" F GMTI=1:1 S GMTJ=$O(GMX(GMTJ)) Q:+GMTJ'>0  S TEXT=TEXT_$S(GMTI=1:"",1:"|")_GMX(GMTJ)
"RTN","GMTSORC",54,0)
 Q TEXT
"RTN","GMTSORC3")
0^31^B8944413
"RTN","GMTSORC3",1,0)
GMTSORC3 ; SLC/JER,KER - Current Orders (V3) ; 11/02/1998
"RTN","GMTSORC3",2,0)
 ;;2.7;Health Summary;**15,28**;Oct 20, 1995
"RTN","GMTSORC3",3,0)
 ;
"RTN","GMTSORC3",4,0)
MAIN ; *** Entry Point
"RTN","GMTSORC3",5,0)
 N DIWF,DIWL,DIWR,GMTSDATA,GMTSDGRP,GMTSI,GMTSJ,GMTSK,GMTSLINE
"RTN","GMTSORC3",6,0)
 N GMTSORNM,GMTSSTAT,GMTSSTOP,GMTSSTRT,GMTSTTAB,GMTSWHEN,ORLIST,X
"RTN","GMTSORC3",7,0)
 ;
"RTN","GMTSORC3",8,0)
 S X="ORQ1" X ^%ZOSF("TEST") I '$T G EXIT
"RTN","GMTSORC3",9,0)
 D EXIT
"RTN","GMTSORC3",10,0)
 D EN^ORQ1(DFN_";DPT(",1,2,"",GMTSBEG,GMTSEND,1,0)
"RTN","GMTSORC3",11,0)
 I '$D(^TMP("ORR",$J)) G EXIT
"RTN","GMTSORC3",12,0)
 ;
"RTN","GMTSORC3",13,0)
 D HEAD
"RTN","GMTSORC3",14,0)
 S GMTSI=0
"RTN","GMTSORC3",15,0)
 F  S GMTSI=$O(^TMP("ORR",$J,ORLIST,GMTSI)) Q:GMTSI'>0!$D(GMTSQIT)  D PRT
"RTN","GMTSORC3",16,0)
 ;
"RTN","GMTSORC3",17,0)
EXIT ; *** Clean-up and quit
"RTN","GMTSORC3",18,0)
 K ^TMP("ORR",$J),^UTILITY($J,"W")
"RTN","GMTSORC3",19,0)
 Q
"RTN","GMTSORC3",20,0)
 ;
"RTN","GMTSORC3",21,0)
PRT ; *** Get the data
"RTN","GMTSORC3",22,0)
 S GMTSDATA=$G(^TMP("ORR",$J,ORLIST,GMTSI))
"RTN","GMTSORC3",23,0)
 S GMTSORNM=$P(GMTSDATA,U,1),GMTSDGRP=$P(GMTSDATA,U,2)
"RTN","GMTSORC3",24,0)
 S GMTSWHEN=$P(GMTSDATA,U,3),GMTSSTRT=$P(GMTSDATA,U,4)
"RTN","GMTSORC3",25,0)
 S GMTSSTOP=$P(GMTSDATA,U,5)
"RTN","GMTSORC3",26,0)
 I $L($P(GMTSDATA,U,7)) S GMTSSTAT=$P(GMTSDATA,U,7)
"RTN","GMTSORC3",27,0)
 E  S GMTSSTAT=$E($P(GMTSDATA,U,6),1,4)
"RTN","GMTSORC3",28,0)
 ; Patch #15, replace status description with status short name
"RTN","GMTSORC3",29,0)
 S GMTSSTRT=$$REGDTM(GMTSSTRT),GMTSSTOP=$$REGDTM(GMTSSTOP)
"RTN","GMTSORC3",30,0)
 ; *** If there is no text, then add '*** Unknown ***'
"RTN","GMTSORC3",31,0)
 I $O(^TMP("ORR",$J,ORLIST,GMTSI,"TX",0))'>0 D
"RTN","GMTSORC3",32,0)
 . S ^TMP("ORR",$J,ORLIST,GMTSI,"TX")=1
"RTN","GMTSORC3",33,0)
 . S ^TMP("ORR",$J,ORLIST,GMTSI,"TX",1)="*** Unknown ***"
"RTN","GMTSORC3",34,0)
 . Q
"RTN","GMTSORC3",35,0)
 ; *** Use FM's DIWP call to do the text wrapping
"RTN","GMTSORC3",36,0)
 S GMTSJ=0,DIWL=1,DIWR=40,DIWF="" K ^UTILITY($J,"W",DIWL)
"RTN","GMTSORC3",37,0)
 F  S GMTSJ=$O(^TMP("ORR",$J,ORLIST,GMTSI,"TX",GMTSJ)) Q:GMTSJ'>0  D
"RTN","GMTSORC3",38,0)
 . S X=$G(^TMP("ORR",$J,ORLIST,GMTSI,"TX",GMTSJ))
"RTN","GMTSORC3",39,0)
 . D ^DIWP
"RTN","GMTSORC3",40,0)
 . Q
"RTN","GMTSORC3",41,0)
 ;
"RTN","GMTSORC3",42,0)
 ; *** Print the data
"RTN","GMTSORC3",43,0)
 S (GMTSK,GMTSLINE,GMTSTTAB)=0
"RTN","GMTSORC3",44,0)
 F  S GMTSK=$O(^UTILITY($J,"W",DIWL,GMTSK)) Q:GMTSK'>0!$D(GMTSQIT)  D
"RTN","GMTSORC3",45,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  I GMTSNPG D HEAD S GMTSLINE=0
"RTN","GMTSORC3",46,0)
 . S GMTSLINE=GMTSLINE+1
"RTN","GMTSORC3",47,0)
 . W ?GMTSTTAB,$G(^UTILITY($J,"W",DIWL,GMTSK,0)) S GMTSTTAB=2
"RTN","GMTSORC3",48,0)
 . I GMTSLINE=1 W ?41,GMTSSTAT,?45,GMTSSTRT,?63,GMTSSTOP
"RTN","GMTSORC3",49,0)
 . W !
"RTN","GMTSORC3",50,0)
 . Q
"RTN","GMTSORC3",51,0)
 Q
"RTN","GMTSORC3",52,0)
 ;
"RTN","GMTSORC3",53,0)
HEAD ; *** Print the header
"RTN","GMTSORC3",54,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSORC3",55,0)
 W "Item Ordered",?42,"Status",?50,"Start Date",?66,"Stop Date",!!
"RTN","GMTSORC3",56,0)
 Q
"RTN","GMTSORC3",57,0)
 ;
"RTN","GMTSORC3",58,0)
REGDTM(X) ; *** Convert an internal to an external date/time
"RTN","GMTSORC3",59,0)
 I X]"" D REGDTM4^GMTSU
"RTN","GMTSORC3",60,0)
 Q X
"RTN","GMTSORC3",61,0)
 ;
"RTN","GMTSORC3",62,0)
WRAP(TEXT,LENGTH) ; Breaks text string into substrings of length LENGTH
"RTN","GMTSORC3",63,0)
 N GMTI,GMTJ,LINE,GMX,GMX1,GMX2,GMY
"RTN","GMTSORC3",64,0)
 I $G(TEXT)']"" Q ""
"RTN","GMTSORC3",65,0)
 F GMTI=1:1 D  Q:GMTI=$L(TEXT," ")
"RTN","GMTSORC3",66,0)
 . S GMX=$P(TEXT," ",GMTI)
"RTN","GMTSORC3",67,0)
 . I $L(GMX)>LENGTH D
"RTN","GMTSORC3",68,0)
 . . S GMX1=$E(GMX,1,LENGTH),GMX2=$E(GMX,LENGTH+1,$L(GMX))
"RTN","GMTSORC3",69,0)
 . . S $P(TEXT," ",GMTI)=GMX1_" "_GMX2
"RTN","GMTSORC3",70,0)
 S LINE=1,GMX(1)=$P(TEXT," ")
"RTN","GMTSORC3",71,0)
 F GMTI=2:1 D  Q:GMTI'<$L(TEXT," ")
"RTN","GMTSORC3",72,0)
 . S:$L($G(GMX(LINE))_" "_$P(TEXT," ",GMTI))>LENGTH LINE=LINE+1,GMY=1
"RTN","GMTSORC3",73,0)
 . S GMX(LINE)=$G(GMX(LINE))_$S(+$G(GMY):"",1:" ")_$P(TEXT," ",GMTI),GMY=0
"RTN","GMTSORC3",74,0)
 S GMTJ=0,TEXT="" F GMTI=1:1 S GMTJ=$O(GMX(GMTJ)) Q:+GMTJ'>0  S TEXT=TEXT_$S(GMTI=1:"",1:"|")_GMX(GMTJ)
"RTN","GMTSORC3",75,0)
 Q TEXT
"RTN","GMTSPCD")
0^32^B5991368
"RTN","GMTSPCD",1,0)
GMTSPCD ; SLC/DLT,KER - Queue HS Batch Print Clinic by Date ; 11/02/1998
"RTN","GMTSPCD",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSPCD",3,0)
MAIN ; Controls branching
"RTN","GMTSPCD",4,0)
 W !!,"This option will queue Health Summaries for a specified Visit Date"
"RTN","GMTSPCD",5,0)
 W !,"for all Outpatient Clinics with Appointments on that Visit Date.",!!
"RTN","GMTSPCD",6,0)
 N GMTSCDT
"RTN","GMTSPCD",7,0)
 S GMTSCDT=$$SELDATE Q:GMTSCDT'>0
"RTN","GMTSPCD",8,0)
 W ! N DIR S DIR(0)="D^::%DT",DIR("A")="Date and Time to Queue this Job to run",DIR("B")="NOW" D ^DIR Q:($D(DTOUT)!($D(DUOUT))!($D(DIROUT)))
"RTN","GMTSPCD",9,0)
 S ZTDTH=Y,ZTIO="",ZTSAVE("GMTSCDT")=""
"RTN","GMTSPCD",10,0)
 S ZTRTN="CLINICQ^GMTSPCD",ZTDESC="Create Task HS Jobs for Clinics by Visit Date"
"RTN","GMTSPCD",11,0)
 D ^%ZTLOAD
"RTN","GMTSPCD",12,0)
 Q
"RTN","GMTSPCD",13,0)
CLINICQ ;Loop thru clinics for appointments on the date stored in GMTSCDT 
"RTN","GMTSPCD",14,0)
 N GMTSDATE,GMTSTYP,GMTSCLN,GMTSCL,LTYPE,GMW,X
"RTN","GMTSPCD",15,0)
 S GMTSCLN=0
"RTN","GMTSPCD",16,0)
 ; Using "B" xref so clinics printed out in numeric/alphabetic order
"RTN","GMTSPCD",17,0)
 F  S GMTSCLN=$O(^SC("B",GMTSCLN))  Q:GMTSCLN=""  D
"RTN","GMTSPCD",18,0)
 . S GMTSCL=$O(^SC("B",GMTSCLN,0))
"RTN","GMTSPCD",19,0)
 . Q:$P($G(^SC(GMTSCL,0)),U,3)'="C"
"RTN","GMTSPCD",20,0)
 . S GMTSDATE=+$O(^SC(GMTSCL,"S",GMTSCDT))  Q:'GMTSDATE  Q:GMTSDATE'[GMTSCDT
"RTN","GMTSPCD",21,0)
 . S GMTSTYP=0 S GMTSTYP=$O(^GMT(142,"D",GMTSCL,GMTSTYP)) Q:+GMTSTYP'>0  D QUEUE
"RTN","GMTSPCD",22,0)
 Q
"RTN","GMTSPCD",23,0)
QUEUE ; Queues HS batch print for particular HS Type and Location.
"RTN","GMTSPCD",24,0)
 N DIC,GMPSAP,GMTSCLI,GMTSLOC,GMTSSC,GMTSIO,GMTSDYS,GMV,QUEQIT,X,Y
"RTN","GMTSPCD",25,0)
 S QUEQIT=0
"RTN","GMTSPCD",26,0)
 S GMTSCLI=$O(^GMT(142,GMTSTYP,20,"B",GMTSCL,0))
"RTN","GMTSPCD",27,0)
 S GMTSLOC=$G(^GMT(142,GMTSTYP,20,GMTSCLI,0))
"RTN","GMTSPCD",28,0)
 S X=+GMTSLOC,DIC=44,DIC(0)="NXZ" D ^DIC
"RTN","GMTSPCD",29,0)
 I $S(+Y'>0:1,"WCOR"'[$P($G(Y(0)),U,3):1,1:0) Q
"RTN","GMTSPCD",30,0)
 S GMTSSC(1)=Y_U_$P(Y(0),U,3),$P(GMTSSC(1),U,4)=GMTSCDT
"RTN","GMTSPCD",31,0)
 S GMPSAP=$S($P(GMTSLOC,U,3)="Y":1,1:0)
"RTN","GMTSPCD",32,0)
 S ZTIO=$$GETIO($P(GMTSLOC,U,2)) Q:'$L(ZTIO)
"RTN","GMTSPCD",33,0)
 S ZTDTH=$H,ZTRTN="MAIN^GMTSPL",ZTDESC="Clinic Health Summaries by Visit Date"
"RTN","GMTSPCD",34,0)
 F GMV="GMTSTYP","GMPSAP" S ZTSAVE(GMV)=""
"RTN","GMTSPCD",35,0)
 S ZTSAVE("GMTSSC(")=""
"RTN","GMTSPCD",36,0)
 D ^%ZTLOAD
"RTN","GMTSPCD",37,0)
 Q
"RTN","GMTSPCD",38,0)
GETIO(X) ; Get device for queueing
"RTN","GMTSPCD",39,0)
 N %,%Y,C,DIC,Y
"RTN","GMTSPCD",40,0)
 S DIC=3.5,DIC(0)="NXZ" D ^DIC S Y=$S(+Y'>0:"",1:$P(Y(0),U))
"RTN","GMTSPCD",41,0)
 Q Y
"RTN","GMTSPCD",42,0)
SELDATE() ; Allows entry of Visit/Surgery date or date range
"RTN","GMTSPCD",43,0)
 ; for Print-by-Clinic
"RTN","GMTSPCD",44,0)
 N %,%H,%I,DIR,DEFDT,X,Y
"RTN","GMTSPCD",45,0)
 D NOW^%DTC S (X,DT)=$P(%,".") D REGDT4^GMTSU S DEFDT=X
"RTN","GMTSPCD",46,0)
 S DIR(0)="D^::EX",DIR("B")=DEFDT
"RTN","GMTSPCD",47,0)
 S DIR("A")="Please enter the Visit date"
"RTN","GMTSPCD",48,0)
 D ^DIR
"RTN","GMTSPCD",49,0)
 I Y="^^" S DIROUT=1
"RTN","GMTSPCD",50,0)
 Q Y
"RTN","GMTSPD")
0^33^B14712372
"RTN","GMTSPD",1,0)
GMTSPD ; SLC/JER,KER - Interactive Print-by-Location ; 11/02/1998
"RTN","GMTSPD",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSPD",3,0)
MAIN ; Controls branching
"RTN","GMTSPD",4,0)
 N GMPSAP,GMTSCDT,GMTSTYP,GMLOC,GMTSSC
"RTN","GMTSPD",5,0)
 S GMTSTYP=0 K DIROUT
"RTN","GMTSPD",6,0)
 F  D  Q:+GMTSTYP'>0!$D(DIROUT)
"RTN","GMTSPD",7,0)
 . S GMTSTYP=+$$SELTYP Q:+GMTSTYP'>0!$D(DIROUT)
"RTN","GMTSPD",8,0)
 . F  D  Q:+$G(GMTSSC)'>0!$D(DIROUT)!$D(DUOUT)
"RTN","GMTSPD",9,0)
 . . K GMTSSC
"RTN","GMTSPD",10,0)
 . . D SELLOC(.GMTSSC) Q:+$G(GMTSSC)'>0!$D(DIROUT)!$D(DUOUT)
"RTN","GMTSPD",11,0)
 . . D CHKLOC(.GMTSSC) Q:$O(GMTSSC(0))'>0!$D(DIROUT)!$D(DTOUT)!$D(DUOUT)
"RTN","GMTSPD",12,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)
"RTN","GMTSPD",13,0)
 . . N DIROUT
"RTN","GMTSPD",14,0)
 . . D HSOUT^GMTSPD2 W !
"RTN","GMTSPD",15,0)
 Q
"RTN","GMTSPD",16,0)
SELTYP() ; Select Health Summary type
"RTN","GMTSPD",17,0)
 N DIC,X,Y
"RTN","GMTSPD",18,0)
 I $D(^DISV(DUZ,"^GMT(142,")),+$G(GMTSTYP)=0 S DIC("B")=$P($G(^GMT(142,+$G(^DISV(DUZ,"^GMT(142,")),0)),U)
"RTN","GMTSPD",19,0)
 S DIC=142,DIC("A")="Select Health Summary Type: "
"RTN","GMTSPD",20,0)
 S DIC(0)="AEQM",DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTSPD",21,0)
 D ^DIC I +Y'>0,X="^^" S DIROUT=1
"RTN","GMTSPD",22,0)
 I +Y>0,$S($D(^GMT(142,+Y,1,0))=0:1,$O(^(0))'>0:1,1:0) D
"RTN","GMTSPD",23,0)
 . W !,"This Summary Type includes no components...Please choose another."
"RTN","GMTSPD",24,0)
 Q Y
"RTN","GMTSPD",25,0)
SELLOC(GMX) ; Select multiple Hospital Location
"RTN","GMTSPD",26,0)
 N DIC,LOC,Y,X
"RTN","GMTSPD",27,0)
 S DIC=44,DIC(0)="AEMQZ",DIC("A")="Select Hospital Location: "
"RTN","GMTSPD",28,0)
 S DIC("S")="I ""WCOR""[$P(^(0),U,3)"
"RTN","GMTSPD",29,0)
 F  D  Q:+$G(GMX(+$G(Y)))'>0!$D(DIROUT)!$D(DTOUT)!$D(DUOUT)
"RTN","GMTSPD",30,0)
 . D ^DIC
"RTN","GMTSPD",31,0)
 . I +Y'>0 S:X="^^" DIROUT=1 Q
"RTN","GMTSPD",32,0)
 . S GMX(+Y)=$P(Y,U,1,2)_U_$P(Y(0),U,3)
"RTN","GMTSPD",33,0)
 . S $P(GMX,U)=+Y
"RTN","GMTSPD",34,0)
 . I "COR"[$P(Y(0),U,3) S $P(GMX,U,3)="COR"
"RTN","GMTSPD",35,0)
 . S DIC("A")="Select Next Hospital Location: "
"RTN","GMTSPD",36,0)
 Q
"RTN","GMTSPD",37,0)
CHKLOC(LOC) ;Get date range for Clinics and Operating Rooms.
"RTN","GMTSPD",38,0)
 ; Checks that there are patients at the locations.
"RTN","GMTSPD",39,0)
 I $P(LOC,U,3)="COR" D  Q:$D(DIROUT)!$D(DTOUT)!$D(DUOUT)
"RTN","GMTSPD",40,0)
 . S $P(LOC,U,4)=$$SELDATE
"RTN","GMTSPD",41,0)
 W !
"RTN","GMTSPD",42,0)
 S GMLOC=0
"RTN","GMTSPD",43,0)
 F  S GMLOC=$O(LOC(GMLOC)) Q:+GMLOC'>0  D
"RTN","GMTSPD",44,0)
 . I "COR"[$P(LOC(+GMLOC),U,3) S $P(LOC(+GMLOC),U,4)=$P(LOC,U,4,5)
"RTN","GMTSPD",45,0)
 . I $$CKPAT(LOC(+GMLOC))'>0 D
"RTN","GMTSPD",46,0)
 . . W !,"No patients found at ",$$LOCTXT^GMTSPD2($P(LOC(+GMLOC),U,3))," ",$P(LOC(+GMLOC),U,2)
"RTN","GMTSPD",47,0)
 . . N GMB,GME
"RTN","GMTSPD",48,0)
 . . I $P(LOC(+GMLOC),U,4)>0 D
"RTN","GMTSPD",49,0)
 . . . S X=$P(LOC(+GMLOC),U,4) D REGDT4^GMTSU S GMB=X
"RTN","GMTSPD",50,0)
 . . I $P(LOC(+GMLOC),U,5)>0 D
"RTN","GMTSPD",51,0)
 . . . S X=$P(LOC(+GMLOC),U,5) D REGDT4^GMTSU S GME=X
"RTN","GMTSPD",52,0)
 . . W $S($G(GME)]"":" on "_GMB_" to "_GME,$G(GMB)]"":" on "_GMB,1:"")
"RTN","GMTSPD",53,0)
 . . W "."
"RTN","GMTSPD",54,0)
 . . K LOC(+GMLOC)
"RTN","GMTSPD",55,0)
 W !
"RTN","GMTSPD",56,0)
 Q
"RTN","GMTSPD",57,0)
SELDATE() ; Allows entry of Visit/Surgery date or date range
"RTN","GMTSPD",58,0)
 ; for Print-by-Clinic
"RTN","GMTSPD",59,0)
 ; LTYPE=Location type (e.g., OR or Clinic)
"RTN","GMTSPD",60,0)
 N %,%H,%I,DIR,DEFDT,X,Y,GMBEG,GMEND
"RTN","GMTSPD",61,0)
 S (GMBEG,GMEND)=0
"RTN","GMTSPD",62,0)
 D NOW^%DTC S (X,DT)=$P(%,".") D REGDT4^GMTSU S DEFDT=X
"RTN","GMTSPD",63,0)
 S DIR(0)="D^::EX",DIR("B")=DEFDT
"RTN","GMTSPD",64,0)
 S DIR("A")="Please enter the beginning Visit or Surgery date"
"RTN","GMTSPD",65,0)
 D ^DIR
"RTN","GMTSPD",66,0)
 I Y="^^" S DIROUT=1
"RTN","GMTSPD",67,0)
 S GMBEG=Y
"RTN","GMTSPD",68,0)
 I +GMBEG>0 D
"RTN","GMTSPD",69,0)
 . S X=$P(GMBEG,".") D REGDT4^GMTSU S DEFDT=X
"RTN","GMTSPD",70,0)
 . S DIR(0)="DO^::EX",DIR("B")=DEFDT
"RTN","GMTSPD",71,0)
 . S DIR("A")="Please enter the ending Visit or Surgery date"
"RTN","GMTSPD",72,0)
 . D ^DIR
"RTN","GMTSPD",73,0)
 . I Y="^^" S DIROUT=1
"RTN","GMTSPD",74,0)
 . S GMEND=Y
"RTN","GMTSPD",75,0)
 Q $S(+GMEND>0&(GMEND>GMBEG):GMBEG_U_GMEND,+GMEND>0&(GMEND<GMBEG):GMEND_U_GMBEG,+GMEND>0&(GMEND=GMBEG):GMBEG,1:0)
"RTN","GMTSPD",76,0)
CKPAT(LOC) ; Checks for patients at selected location
"RTN","GMTSPD",77,0)
 ;   LOC=Ptr. to file 44^LOCATION NAME^LOCATION TYPE^BEG DATE^END DATE
"RTN","GMTSPD",78,0)
 N %,%H,%T,LTYPE,X1,X2,X,Y,GMY,GMBEG
"RTN","GMTSPD",79,0)
 S LTYPE=$P(LOC,U,3)
"RTN","GMTSPD",80,0)
 I LTYPE="W" D
"RTN","GMTSPD",81,0)
 . S LOC=$P($G(^DIC(42,+$G(^SC(+LOC,42)),0)),U)
"RTN","GMTSPD",82,0)
 . S GMY=$S($G(LOC)']"":0,$O(^DPT("CN",LOC,0)):1,1:0)
"RTN","GMTSPD",83,0)
 I $L(LOC,U)=4!($L(LOC,U)=5) D
"RTN","GMTSPD",84,0)
 . S GMY=0
"RTN","GMTSPD",85,0)
 . I +$P(LOC,U,5) S X1=$P(LOC,U,5),X2=1 D C^%DTC
"RTN","GMTSPD",86,0)
 . I +$P(LOC,U,5)'>0 S X1=$P(LOC,U,4),X2=1 D C^%DTC
"RTN","GMTSPD",87,0)
 . I LTYPE="C",+$O(^SC(+LOC,"S",$P(LOC,U,4))),(+$O(^($P(LOC,U,4)))'>X) S GMY=1
"RTN","GMTSPD",88,0)
 . I LTYPE="OR" D
"RTN","GMTSPD",89,0)
 . . N OLOC S GMY=0,OLOC=+$O(^SRS("B",+LOC,0))
"RTN","GMTSPD",90,0)
 . . I +OLOC,+$P(LOC,U,5)'>0,$O(^SRF("AOR",+OLOC,+$P(LOC,U,4),0)) S GMY=1
"RTN","GMTSPD",91,0)
 . . I +OLOC,+$P(LOC,U,5) D
"RTN","GMTSPD",92,0)
 . . . S GMBEG=$P(LOC,U,4)
"RTN","GMTSPD",93,0)
 . . . F  D  Q:GMBEG>$P(LOC,U,5)!(GMY>0)
"RTN","GMTSPD",94,0)
 . . . . I $O(^SRF("AOR",+OLOC,+GMBEG,0)) S GMY=1
"RTN","GMTSPD",95,0)
 . . . . E  S X1=GMBEG,X2=1 D C^%DTC S GMBEG=X
"RTN","GMTSPD",96,0)
 Q $G(GMY)
"RTN","GMTSPL")
0^34^B18720264
"RTN","GMTSPL",1,0)
GMTSPL ; SLC/JER,KER - Print/Queue HS for Patient Lists ; 11/02/1998
"RTN","GMTSPL",2,0)
 ;;2.7;Health Summary;**7,27,28**;Oct 20, 1995
"RTN","GMTSPL",3,0)
 ; Call with:  GMTSTYP=Ptr to file 142, and
"RTN","GMTSPL",4,0)
 ; GMTSSC=Ptr to file 44^Hosp Loc Name^Hosp Loc Type^
"RTN","GMTSPL",5,0)
 ;     Optional begin Visit/Surgery Date^Optional end Visit/Surgery Date
"RTN","GMTSPL",6,0)
 ; GMTSSC()=GMTSSC - An array for multiple locations (GMTSPD)
"RTN","GMTSPL",7,0)
 ; [GMPSAP]=Optional flag set to 1 if OP Rx Action Profile is to print
"RTN","GMTSPL",8,0)
MAIN ; Controls for processing multiple locations
"RTN","GMTSPL",9,0)
 N MULTLOC
"RTN","GMTSPL",10,0)
 I +$O(GMTSSC(0))'>0 D MAINCTRL
"RTN","GMTSPL",11,0)
 I +$O(GMTSSC(0)) D
"RTN","GMTSPL",12,0)
 . S MULTLOC=0
"RTN","GMTSPL",13,0)
 . F  S MULTLOC=$O(GMTSSC(MULTLOC)) Q:+MULTLOC'>0!$D(DIROUT)  D
"RTN","GMTSPL",14,0)
 . . S GMTSSC=GMTSSC(+MULTLOC)
"RTN","GMTSPL",15,0)
 . . D MAINCTRL
"RTN","GMTSPL",16,0)
 Q
"RTN","GMTSPL",17,0)
MAINCTRL ; Controls Branching
"RTN","GMTSPL",18,0)
 N DFN,GMTDFN,GMLTYPE,GMTSLTR,GMPNM,PSOPAR,PSONOPG,PSOINST,PSTYPE
"RTN","GMTSPL",19,0)
 K ^TMP("GMTSPL",$J)
"RTN","GMTSPL",20,0)
 U IO
"RTN","GMTSPL",21,0)
 S GMLTYPE=$P(GMTSSC,U,3)
"RTN","GMTSPL",22,0)
 I GMLTYPE="C" D CLINIC(GMTSSC)
"RTN","GMTSPL",23,0)
 I GMLTYPE="W" D WARD(GMTSSC)
"RTN","GMTSPL",24,0)
 I GMLTYPE="OR" D OR(GMTSSC)
"RTN","GMTSPL",25,0)
 I $L($P(GMTSSC,U,2)),($E(IOST,1)'="C") S GMTSLTR=$E($P(GMTSSC,U,2),1,10) D ^GMTSLTR
"RTN","GMTSPL",26,0)
 I $O(^TMP("GMTSPL",$J,0))="" D NOPAT($P(GMTSSC,U,2)) Q
"RTN","GMTSPL",27,0)
 S GMPNM="" F  S GMPNM=$O(^TMP("GMTSPL",$J,GMPNM)) Q:(GMPNM="")!($D(DIROUT))  D
"RTN","GMTSPL",28,0)
 . S GMTDFN=0 F  S GMTDFN=$O(^TMP("GMTSPL",$J,GMPNM,GMTDFN)) Q:(GMTDFN'>0)!($D(DIROUT))  D
"RTN","GMTSPL",29,0)
 . . N GMDUOUT
"RTN","GMTSPL",30,0)
 . . S DFN=GMTDFN D DRIVER Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTSPL",31,0)
 . . I +$G(GMPSAP) D
"RTN","GMTSPL",32,0)
 . . . S (PSTYPE,PSONOPG)=1
"RTN","GMTSPL",33,0)
 . . . S $P(PSOPAR,U)=$S($P($G(^GMT(142.99,1,0)),U,5)="Y":1,1:0)
"RTN","GMTSPL",34,0)
 . . . S PSOINST=$S(+$G(PSOINST):PSOINST,1:+$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),U,17),99)),U))
"RTN","GMTSPL",35,0)
 . . . D DFN^PSOSD1,PAGE
"RTN","GMTSPL",36,0)
 K ^TMP("GMTSPL",$J)
"RTN","GMTSPL",37,0)
 Q
"RTN","GMTSPL",38,0)
PAGE ; Pause at BOP for interactive users
"RTN","GMTSPL",39,0)
 N DIR,X,Y
"RTN","GMTSPL",40,0)
 Q:$E(IOST)'="C"!(IOT="HFS")!((IOSL>998)&($G(GMPAT(+$O(GMPAT(""),-1)))'=$G(DFN)))
"RTN","GMTSPL",41,0)
 I IOSL>($Y+5) F  W ! Q:IOSL<($Y+6)!($Y'<22)
"RTN","GMTSPL",42,0)
 S DIR(0)="FO^1:1",DIR("A")="Press RETURN to continue or '^' to exit"
"RTN","GMTSPL",43,0)
 S DIR("?")="Enter '^' to quit present report or '^^' to quit to menu"
"RTN","GMTSPL",44,0)
 D ^DIR
"RTN","GMTSPL",45,0)
 Q
"RTN","GMTSPL",46,0)
NOPAT(LOC) ; Handles selection of unpopulated Hospital location
"RTN","GMTSPL",47,0)
 N %,%H,%I,%T,%Y,GMTS,GMTSDTM,GMTSHDR,GMTSPG,GMTSTITL,GMTSDTM,GMTSLFG,X,Y
"RTN","GMTSPL",48,0)
 D NOW^%DTC S X=% D REGDTM4^GMTSU S GMTSDTM=X
"RTN","GMTSPL",49,0)
 S DIC=142,DIC(0)="NXF",X=+GMTSTYP D ^DIC K DIC
"RTN","GMTSPL",50,0)
 S GMTSTITL=$S($D(^GMT(142,+Y,"T")):^("T"),1:$P(Y,U,2)),GMTSLFG=1
"RTN","GMTSPL",51,0)
 W @IOF D HEADER^GMTSUP W !!,"No Patients found at ",LOC," location.",!
"RTN","GMTSPL",52,0)
 Q
"RTN","GMTSPL",53,0)
CLINIC(LOC) ; Gets list of next-day appointments for selected clinic
"RTN","GMTSPL",54,0)
 N %,%H,%I,%T,%Y,DFN,GMI,GMJ,X,X1,X2,VDT,Y,GMPNM,GMDT,GMBDT,GMEDT
"RTN","GMTSPL",55,0)
 S VDT=+$P(LOC,U,4)
"RTN","GMTSPL",56,0)
 I 'VDT D NOW^%DTC S VDT=X
"RTN","GMTSPL",57,0)
 S X=+VDT D REGDT4^GMTSU S GMBDT=X
"RTN","GMTSPL",58,0)
 S X=+$P(LOC,U,5) D REGDT4^GMTSU S GMEDT=X
"RTN","GMTSPL",59,0)
 S X1=$S(+$P(LOC,U,5)>0:$P(LOC,U,5),1:VDT),X2=1 D C^%DTC
"RTN","GMTSPL",60,0)
 S GMI=VDT F  S GMI=$O(^SC(+LOC,"S",GMI)) Q:+GMI'>0!(GMI>X)  D
"RTN","GMTSPL",61,0)
 . S GMJ=0 F  S GMJ=$O(^SC(+LOC,"S",GMI,1,GMJ)) Q:+GMJ'>0  D
"RTN","GMTSPL",62,0)
 . . I '$L($P($G(^SC(+LOC,"S",GMI,1,GMJ,0)),U,9)) D
"RTN","GMTSPL",63,0)
 . . . S DFN=+$G(^SC(+LOC,"S",GMI,1,GMJ,0)) Q:DFN'>0
"RTN","GMTSPL",64,0)
 . . . S GMPNM=$P($G(^DPT(+DFN,0)),U)
"RTN","GMTSPL",65,0)
 . . . N X
"RTN","GMTSPL",66,0)
 . . . S X=+GMI D REGDT4^GMTSU S GMDT=X
"RTN","GMTSPL",67,0)
 . . . S ^TMP("GMTSPL",$J,GMPNM,+DFN)=$S($D(^TMP("GMTSPL",$J,GMPNM,+DFN)):GMBDT_" TO "_GMEDT,1:GMDT)
"RTN","GMTSPL",68,0)
 Q
"RTN","GMTSPL",69,0)
WARD(LOC) ; Gets list of patients for a specified ward
"RTN","GMTSPL",70,0)
 N DFN,GMLOC,X,Y,GMDT
"RTN","GMTSPL",71,0)
 S GMLOC=$P($G(^DIC(42,+$G(^SC(+LOC,42)),0)),U)
"RTN","GMTSPL",72,0)
 I $S('$L(GMLOC):1,'$O(^DPT("CN",GMLOC,0)):1,1:0) Q
"RTN","GMTSPL",73,0)
 S DFN=0 F  S DFN=$O(^DPT("CN",GMLOC,DFN)) Q:+DFN'>0  D
"RTN","GMTSPL",74,0)
 . N X
"RTN","GMTSPL",75,0)
 . S X=+$G(DT) D REGDT4^GMTSU S GMDT=X
"RTN","GMTSPL",76,0)
 . S ^TMP("GMTSPL",$J,$P($G(^DPT(+DFN,0)),U),+DFN)=GMDT
"RTN","GMTSPL",77,0)
 Q
"RTN","GMTSPL",78,0)
OR(LOC) ; Gets list of patients scheduled for surgery on specified date
"RTN","GMTSPL",79,0)
 N DFN,GMI,GMJ,GMPNM,GMDT,%,%H,%I,%T,%Y,X,X1,X2,Y
"RTN","GMTSPL",80,0)
 S GMI=+$O(^SRS("B",+LOC,0)) I +GMI'>0 G ORX
"RTN","GMTSPL",81,0)
 S GMBEG=$P(LOC,U,4)-.0001,GMEND=$S(+$P(LOC,U,5)>0:$P(LOC,U,5),1:$P(LOC,U,4))
"RTN","GMTSPL",82,0)
 F  S GMBEG=$O(^SRF("AOR",+GMI,+GMBEG)) Q:+GMBEG'>0!(+GMBEG>+GMEND)  D
"RTN","GMTSPL",83,0)
 . S GMJ=0 F  S GMJ=$O(^SRF("AOR",+GMI,+GMBEG,GMJ)) Q:+GMJ'>0  D
"RTN","GMTSPL",84,0)
 . . S DFN=+$G(^SRF(+GMJ,0)) Q:DFN'>0
"RTN","GMTSPL",85,0)
 . . S GMPNM=$P($G(^DPT(+DFN,0)),U)
"RTN","GMTSPL",86,0)
 . . N X
"RTN","GMTSPL",87,0)
 . . S X=+GMBEG D REGDT4^GMTSU S GMDT=X
"RTN","GMTSPL",88,0)
 . . S ^TMP("GMTSPL",$J,GMPNM,+DFN)=$S($D(^TMP("GMTSPL",$J,GMPNM,+DFN)):^(+DFN)_", "_GMDT,1:GMDT)
"RTN","GMTSPL",89,0)
ORX Q
"RTN","GMTSPL",90,0)
DRIVER ; Sets variables necessary for GMTS1 and calls ^%ZTLOAD
"RTN","GMTSPL",91,0)
 N %T,C,D0,GMTS,GMTS0,GMTS1,GMTS2,GMTSDOB,GMTSDTM,GMTSLO,GMTSLOCK,GMTSLPG
"RTN","GMTSPL",92,0)
 N GMTSEG,GMTSEGC,GMTSEGI,GMTSPNM,GMTSRB,GMTSSN,GMTSTITL,GMTSWARD,GMTSX
"RTN","GMTSPL",93,0)
 N GMTSPHDR,GMTSAGE,GMTSTOF,GMW,I,SEX,VA,VADM,VAIN,VAINDT,VAROOT,X,Y
"RTN","GMTSPL",94,0)
 S GMTSCDT(0)=^TMP("GMTSPL",$J,GMPNM,+DFN)
"RTN","GMTSPL",95,0)
 S DIC=142,DIC(0)="NXF",X=GMTSTYP D ^DIC K DIC
"RTN","GMTSPL",96,0)
 S GMTSTITL=$S($G(^GMT(142,+Y,"T"))]"":^("T"),1:$P(Y,U,2))
"RTN","GMTSPL",97,0)
 D:$D(GMTSEG)'>9 SELTYP1^GMTS D EN^GMTS1
"RTN","GMTSPL",98,0)
 Q
"RTN","GMTSPLST")
0^35^B10901627
"RTN","GMTSPLST",1,0)
GMTSPLST ; SLC/JER,KER - Problem List ; 11/02/1998
"RTN","GMTSPLST",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSPLST",3,0)
ACTIVE ;Get active problems
"RTN","GMTSPLST",4,0)
 N STATUS
"RTN","GMTSPLST",5,0)
 S STATUS="A"
"RTN","GMTSPLST",6,0)
 D MAIN
"RTN","GMTSPLST",7,0)
 Q
"RTN","GMTSPLST",8,0)
INACT ;Get inactive problems
"RTN","GMTSPLST",9,0)
 N STATUS
"RTN","GMTSPLST",10,0)
 S STATUS="I"
"RTN","GMTSPLST",11,0)
 D MAIN
"RTN","GMTSPLST",12,0)
 Q
"RTN","GMTSPLST",13,0)
ALL ;Get active and inactive problems
"RTN","GMTSPLST",14,0)
 N STATUS
"RTN","GMTSPLST",15,0)
 S STATUS="ALL"
"RTN","GMTSPLST",16,0)
 D MAIN
"RTN","GMTSPLST",17,0)
 Q
"RTN","GMTSPLST",18,0)
MAIN ;Driver
"RTN","GMTSPLST",19,0)
 D GETLIST^GMPLHS(DFN,STATUS)
"RTN","GMTSPLST",20,0)
 Q:'$D(^TMP("GMPLHS",$J))
"RTN","GMTSPLST",21,0)
 D SUBHDR
"RTN","GMTSPLST",22,0)
 D WRT
"RTN","GMTSPLST",23,0)
 K ^TMP("GMPLHS",$J)
"RTN","GMTSPLST",24,0)
 Q
"RTN","GMTSPLST",25,0)
 ;
"RTN","GMTSPLST",26,0)
WRT ; Writes Problem List Component,X
"RTN","GMTSPLST",27,0)
 N GMREC,GMTSICL,GMTAB,LINE1,DIWL
"RTN","GMTSPLST",28,0)
 S GMTSICL=30 ;# of blank columns for problem
"RTN","GMTSPLST",29,0)
 S DIWL=0 ;used in TXTFMT call & to print returned data
"RTN","GMTSPLST",30,0)
 S GMTAB=0 ;Used to offset data from TXTFMT call after 1st line
"RTN","GMTSPLST",31,0)
 S GMREC=0
"RTN","GMTSPLST",32,0)
 F  S GMREC=$O(^TMP("GMPLHS",$J,GMREC)) Q:GMREC'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPLST",33,0)
 . N GMNODE,DIAG,LASTMDT,STAT,ONSETDT,PROV,SERV,RESDT,NARR,GMICD
"RTN","GMTSPLST",34,0)
 . N ADDINFO,GMTSX,X
"RTN","GMTSPLST",35,0)
 . S GMNODE=$G(^TMP("GMPLHS",$J,GMREC,0))
"RTN","GMTSPLST",36,0)
 . Q:GMNODE']""
"RTN","GMTSPLST",37,0)
 . S DIAG=$P(GMNODE,U),LASTMDT=$P(GMNODE,U,2),STAT=$P(GMNODE,U,5)
"RTN","GMTSPLST",38,0)
 . S X=LASTMDT D REGDT4^GMTSU S LASTMDT=X
"RTN","GMTSPLST",39,0)
 . S ONSETDT=$P(GMNODE,U,6),PROV=$P(GMNODE,U,7)
"RTN","GMTSPLST",40,0)
 . S RESDT=$P(GMNODE,U,10),GMICD=""
"RTN","GMTSPLST",41,0)
 . I STAT="A",+ONSETDT S X=ONSETDT D REGDT4^GMTSU S ADDINFO="Onset "_X
"RTN","GMTSPLST",42,0)
 . I STAT="I",+RESDT S X=RESDT D REGDT4^GMTSU S ADDINFO="Resolved "_X
"RTN","GMTSPLST",43,0)
 . S:$G(GMPXNARR)'="N" NARR=$G(^TMP("GMPLHS",$J,GMREC,"N"))
"RTN","GMTSPLST",44,0)
 . I $G(GMPXICDF)]"",$G(GMPXICDF)'="N",DIAG]"" D GETICDDX^GMTSPXU1(.DIAG,$G(GMPXICDF)) S GMICD=DIAG
"RTN","GMTSPLST",45,0)
 . I $G(NARR)]"" S NARR=NARR_$S($G(ADDINFO)]"":", "_ADDINFO,1:"")
"RTN","GMTSPLST",46,0)
 . E  S NARR=$G(ADDINFO)
"RTN","GMTSPLST",47,0)
 . D TXTFMT^GMTSPXU1(GMICD,$G(NARR),GMTSICL,GMTAB,DIWL)
"RTN","GMTSPLST",48,0)
 . I '$D(^UTILITY($J,"W")) Q
"RTN","GMTSPLST",49,0)
 . S GMTSX=0,LINE1=1
"RTN","GMTSPLST",50,0)
 . F  S GMTSX=$O(^UTILITY($J,"W",DIWL,GMTSX)) Q:GMTSX'>0!$D(GMTSQIT)  D
"RTN","GMTSPLST",51,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  I GMTSNPG D SUBHDR2
"RTN","GMTSPLST",52,0)
 . . I LINE1 W:STATUS="ALL" STAT W ?3,$G(^UTILITY($J,"W",DIWL,GMTSX,0)),?55,LASTMDT,?65,$E(PROV,1,15),!
"RTN","GMTSPLST",53,0)
 . . E  W ?3,$G(^UTILITY($J,"W",DIWL,GMTSX,0)),!
"RTN","GMTSPLST",54,0)
 . . S LINE1=0
"RTN","GMTSPLST",55,0)
 . D DSPCOMM
"RTN","GMTSPLST",56,0)
 . W !
"RTN","GMTSPLST",57,0)
 Q
"RTN","GMTSPLST",58,0)
DSPCOMM ;Comments are displayed if there are any
"RTN","GMTSPLST",59,0)
 N LOC,GMR,NODE,DATE,X
"RTN","GMTSPLST",60,0)
 S LOC=""
"RTN","GMTSPLST",61,0)
 F  S LOC=$O(^TMP("GMPLHS",$J,GMREC,"C",LOC)) Q:LOC']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPLST",62,0)
 . S GMR=0
"RTN","GMTSPLST",63,0)
 . F  S GMR=$O(^TMP("GMPLHS",$J,GMREC,"C",LOC,GMR)) Q:GMR'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPLST",64,0)
 . . S NODE=$G(^TMP("GMPLHS",$J,GMREC,"C",LOC,GMR,0))
"RTN","GMTSPLST",65,0)
 . . Q:NODE']""
"RTN","GMTSPLST",66,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  I GMTSNPG D SUBHDR2
"RTN","GMTSPLST",67,0)
 . . W ?5,$P(NODE,U),?68,!
"RTN","GMTSPLST",68,0)
 Q
"RTN","GMTSPLST",69,0)
SUBHDR ; Subheader for Problem List Component
"RTN","GMTSPLST",70,0)
 N NUM,TOT,NODE
"RTN","GMTSPLST",71,0)
 S NODE=$G(^TMP("GMPLHS",$J,STATUS,0))
"RTN","GMTSPLST",72,0)
 S NUM=$P(NODE,U),TOT=$P(NODE,U,2)
"RTN","GMTSPLST",73,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPLST",74,0)
 S:TOT>NUM NUM=NUM_" of "_TOT
"RTN","GMTSPLST",75,0)
 W ?50,NUM_$S(STATUS="A":" Active",STATUS="I":" Inactive",1:"")_" Problems",!
"RTN","GMTSPLST",76,0)
SUBHDR2 ;Will be written on new pages
"RTN","GMTSPLST",77,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPLST",78,0)
 W:STATUS="ALL" "ST"
"RTN","GMTSPLST",79,0)
 W ?3,"PROBLEM",?55,"LAST MOD",?65,"PROVIDER",!
"RTN","GMTSPLST",80,0)
 Q
"RTN","GMTSPN")
0^36^B38309116
"RTN","GMTSPN",1,0)
GMTSPN ; SLC/JER,KER - Progress Note ; 11/02/1998
"RTN","GMTSPN",2,0)
 ;;2.7;Health Summary;**12,28**;Feb 28, 1996
"RTN","GMTSPN",3,0)
PN ;Progress Note Health Summary Component
"RTN","GMTSPN",4,0)
 ;By Patient Name, Date and or Occurrence
"RTN","GMTSPN",5,0)
 N COSGEDBY,SIGNEDBY,PN,TIUSTAT,TIUTYPE,DIC,TIUFPRIV,TIUXREF S TIUFPRIV=1
"RTN","GMTSPN",6,0)
 S TIUSTAT="ALL",TIUXREF="""APT"""
"RTN","GMTSPN",7,0)
 S X="PROGRESS NOTES",DIC="^TIU(8925.1,",DIC(0)="X",DIC("S")="I $P($G(^(0)),U,4)=""CL""" D ^DIC K DIC("S") S:Y>0 TIUTYPE=+Y
"RTN","GMTSPN",8,0)
 D MAIN
"RTN","GMTSPN",9,0)
 Q
"RTN","GMTSPN",10,0)
MAIN ; Control branching
"RTN","GMTSPN",11,0)
 N GMTSI,GMTSJ,GMTSCNT,GMTSREC,PN,DIC
"RTN","GMTSPN",12,0)
 K ^TMP("TIU",$J)
"RTN","GMTSPN",13,0)
 D MAIN^TIULAPIC(DFN,TIUTYPE,GMTS1,GMTS2,GMTSNDM,1)
"RTN","GMTSPN",14,0)
 I '$D(^TMP("TIU",$J)) Q
"RTN","GMTSPN",15,0)
 S GMTSI=0
"RTN","GMTSPN",16,0)
 F  S GMTSI=$O(^TMP("TIU",$J,GMTSI)) Q:+GMTSI'>0!$D(GMTSQIT)  D
"RTN","GMTSPN",17,0)
 . S GMTSJ=0
"RTN","GMTSPN",18,0)
 . F  S GMTSJ=$O(^TMP("TIU",$J,GMTSI,GMTSJ)) Q:+GMTSJ'>0!$D(GMTSQIT)  D
"RTN","GMTSPN",19,0)
 . . N PN
"RTN","GMTSPN",20,0)
 . . D WRTREC(GMTSI,GMTSJ)
"RTN","GMTSPN",21,0)
 . . I $D(^TMP("TIU",$J,GMTSI,GMTSJ,"PROBLEM")) D WRTPROB(GMTSI,GMTSJ)
"RTN","GMTSPN",22,0)
 . . D WRTTEXT(GMTSI,GMTSJ)
"RTN","GMTSPN",23,0)
 . . D WRTSIG(GMTSI,GMTSJ)
"RTN","GMTSPN",24,0)
 . . I +$G(^TMP("TIU",$J,GMTSI,GMTSJ,1601,"I")) D AMENDMNT^GMTSPN1(GMTSI,GMTSJ)
"RTN","GMTSPN",25,0)
 . . I $D(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD")) D ADDEND^GMTSPN1(GMTSI,GMTSJ)
"RTN","GMTSPN",26,0)
 K ^TMP("TIU",$J)
"RTN","GMTSPN",27,0)
 Q
"RTN","GMTSPN",28,0)
WRTREC(GMTSI,GMTSJ) ; Writes record header
"RTN","GMTSPN",29,0)
VARI ;Sets variables
"RTN","GMTSPN",30,0)
 N GMTSXTRA
"RTN","GMTSPN",31,0)
 S GMTSCNT=+$G(GMTSCNT)+1
"RTN","GMTSPN",32,0)
 S PN("DATE")=^TMP("TIU",$J,GMTSI,GMTSJ,1301,"I")
"RTN","GMTSPN",33,0)
 I PN("DATE")]"" S PN("DATE")=$$DATE^TIULS(PN("DATE"),"MM/DD/CCYY HR:MIN")
"RTN","GMTSPN",34,0)
 S PN("DOCTYPE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,.01,"E"))
"RTN","GMTSPN",35,0)
 S PN("AUTHOR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1202,"E"))
"RTN","GMTSPN",36,0)
 S PN("EXPSIGNR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1204,"E"))
"RTN","GMTSPN",37,0)
 S PN("LOC")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1205,"E"))
"RTN","GMTSPN",38,0)
 S PN("EXPCOSNR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1208,"E"))
"RTN","GMTSPN",39,0)
 S PN("SIGDT")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1501,"I"))
"RTN","GMTSPN",40,0)
 I PN("SIGDT")]"" S PN("SIGDT")=$$DATE^TIULS(PN("SIGDT"),"MM/DD/CCYY HR:MIN")
"RTN","GMTSPN",41,0)
 S SIGNEDBY=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1502,"I"))
"RTN","GMTSPN",42,0)
 S PN("SIGBLK")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1503,"E"))
"RTN","GMTSPN",43,0)
 S PN("STITLE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1504,"E"))
"RTN","GMTSPN",44,0)
 S PN("COSDT")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1507,"I"))
"RTN","GMTSPN",45,0)
 I PN("COSDT")]"" S PN("COSDT")=$$DATE^TIULS(PN("COSDT"),"MM/DD/CCYY HR:MIN")
"RTN","GMTSPN",46,0)
 S COSGEDBY=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1508,"I"))
"RTN","GMTSPN",47,0)
 S PN("COBLK")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1509,"E"))
"RTN","GMTSPN",48,0)
 S PN("COTITLE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1510,"E"))
"RTN","GMTSPN",49,0)
 S PN("SUBJ")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1701,"E"))
"RTN","GMTSPN",50,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,1505,"I"))="C" D
"RTN","GMTSPN",51,0)
 . S PN("SCHART")="Signed on Chart",PN("SCHARTBY")="."
"RTN","GMTSPN",52,0)
 . S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1512,"E"))'="" PN("SCHARTBY")=" by:      "_$G(^TMP("TIU",$J,GMTSI,GMTSJ,1512,"E"))
"RTN","GMTSPN",53,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,1511,"I"))="C" D
"RTN","GMTSPN",54,0)
 . S PN("COCHART")="Cosigned on Chart",PN("COCHARTBY")="."
"RTN","GMTSPN",55,0)
 . S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1513,"E"))'="" PN("COCHARTBY")=" by:  "_$G(^TMP("TIU",$J,GMTSI,GMTSJ,1513,"E"))
"RTN","GMTSPN",56,0)
 S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1202,"I"))'=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1502,"I")) PN("AUTH")="AUTHOR:  "_PN("AUTHOR")
"RTN","GMTSPN",57,0)
WRITE ;Header lines
"RTN","GMTSPN",58,0)
 I GMTSCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",59,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W PN("DATE"),?21,"Title:  ",$$UP^XLFSTR(PN("DOCTYPE"))
"RTN","GMTSPN",60,0)
 I $D(PN("AUTH")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?21,PN("AUTH")
"RTN","GMTSPN",61,0)
 I PN("SUBJ")'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !?19,"Subject:  ",PN("SUBJ")
"RTN","GMTSPN",62,0)
 Q
"RTN","GMTSPN",63,0)
WRTTEXT(GMTSI,GMTSJ) ; Write Progress Note text
"RTN","GMTSPN",64,0)
 N GMTSK S GMTSK=0
"RTN","GMTSPN",65,0)
 F  S GMTSK=$O(^TMP("TIU",$J,GMTSI,GMTSJ,"TEXT",GMTSK)) Q:+GMTSK'>0  D
"RTN","GMTSPN",66,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$G(^TMP("TIU",$J,GMTSI,GMTSJ,"TEXT",GMTSK,0))
"RTN","GMTSPN",67,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",68,0)
 Q
"RTN","GMTSPN",69,0)
WRTSIG(GMTSI,GMTSJ) ;Writes Signatures 
"RTN","GMTSPN",70,0)
 I ^TMP("TIU",$J,GMTSI,GMTSJ,1501,"I")="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"**DRAFT COPY - DRAFT COPY -- ABOVE NOTE IS UNSIGNED --"
"RTN","GMTSPN",71,0)
 I  W " DRAFT COPY - DRAFT COPY**"
"RTN","GMTSPN",72,0)
 I $D(PN("SCHART")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J(PN("SCHART"),21),PN("SCHARTBY")
"RTN","GMTSPN",73,0)
 I PN("SIGBLK")'="" D
"RTN","GMTSPN",74,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Signed by:",21) W:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1505,"I"))="E" " /es/ " W ?27,PN("SIGBLK")
"RTN","GMTSPN",75,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?27,PN("STITLE")
"RTN","GMTSPN",76,0)
 . I $L(PN("STITLE"))>37 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I 1
"RTN","GMTSPN",77,0)
 . E  W " "
"RTN","GMTSPN",78,0)
 . W $G(PN("SIGDT"))
"RTN","GMTSPN",79,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",80,0)
 . I $P($$BEEP^TIULC1(+SIGNEDBY),U) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$P($$BEEP^TIULC1(+SIGNEDBY),U)
"RTN","GMTSPN",81,0)
 . I $P($$BEEP^TIULC1(+SIGNEDBY),U,2) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",$P($$BEEP^TIULC1(+SIGNEDBY),U,2)
"RTN","GMTSPN",82,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,.05,"E"))="UNCOSIGNED" D
"RTN","GMTSPN",83,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?27,"** REQUIRES COSIGNATURE **"
"RTN","GMTSPN",84,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",85,0)
 I $D(PN("COCHART")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J(PN("COCHART"),21),PN("COCHARTBY")
"RTN","GMTSPN",86,0)
 I PN("COBLK")'="" D
"RTN","GMTSPN",87,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Cosigned By:",21)
"RTN","GMTSPN",88,0)
 . W:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1511,"I"))="E" " /es/ " W PN("COBLK")
"RTN","GMTSPN",89,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?27,PN("COTITLE")
"RTN","GMTSPN",90,0)
 . I $L(PN("COTITLE"))>37 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I 1
"RTN","GMTSPN",91,0)
 . E  W " "
"RTN","GMTSPN",92,0)
 . W $G(PN("COSDT"))
"RTN","GMTSPN",93,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",94,0)
 . I $P($$BEEP^TIULC1(+COSGEDBY),U) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$P($$BEEP^TIULC1(+COSGEDBY),U)
"RTN","GMTSPN",95,0)
 . I $P($$BEEP^TIULC1(+COSGEDBY),U,2) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",$P($$BEEP^TIULC1(+COSGEDBY),U,2)
"RTN","GMTSPN",96,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",97,0)
 I +$O(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",0)) D
"RTN","GMTSPN",98,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Concurrence:",21)
"RTN","GMTSPN",99,0)
 S GMTSXTRA=0
"RTN","GMTSPN",100,0)
 F  S GMTSXTRA=+$O(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA)) Q:+GMTSXTRA'>0  D
"RTN","GMTSPN",101,0)
 . I +$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"DATE"))'>0 Q
"RTN","GMTSPN",102,0)
 . I +GMTSXTRA>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",103,0)
 . W ?22,"/es/ ",$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"NAME"))
"RTN","GMTSPN",104,0)
 . W !?27,$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"TITLE"))
"RTN","GMTSPN",105,0)
 . I $L($G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"TITLE")))>51 D
"RTN","GMTSPN",106,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?28
"RTN","GMTSPN",107,0)
 . E  W " "
"RTN","GMTSPN",108,0)
 . W $$DATE^TIULS($G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"DATE")),"MM/DD/CCYY HR:MIN")
"RTN","GMTSPN",109,0)
 . N BEEP
"RTN","GMTSPN",110,0)
 . S BEEP=$$BEEP^TIULC1(+$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"EXTRA")))
"RTN","GMTSPN",111,0)
 . I +BEEP D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$P(BEEP,U)
"RTN","GMTSPN",112,0)
 . I +$P(BEEP,U,2) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager: ",$P(BEEP,U,2)
"RTN","GMTSPN",113,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",114,0)
 Q
"RTN","GMTSPN",115,0)
WRTPROB(GMTSI,GMTSJ) ;Writes list of problems associated with this document
"RTN","GMTSPN",116,0)
 N GMTSPR
"RTN","GMTSPN",117,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"PROBLEM(S):  "
"RTN","GMTSPN",118,0)
 S GMTSPR=0
"RTN","GMTSPN",119,0)
 F  S GMTSPR=$O(^TMP("TIU",$J,GMTSI,GMTSJ,"PROBLEM",GMTSPR)) Q:+GMTSPR'>0  D
"RTN","GMTSPN",120,0)
 .  D:GMTSPR>1 CKP^GMTSUP Q:$D(GMTSQIT)  W !?15,^TMP("TIU",$J,GMTSI,GMTSJ,"PROBLEM",GMTSPR,0)
"RTN","GMTSPN",121,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",122,0)
 Q
"RTN","GMTSPNB")
0^37^B5274247
"RTN","GMTSPNB",1,0)
GMTSPNB ; SLC/JER/KER TIU Brief Progress Notes ; 11/02/1998
"RTN","GMTSPNB",2,0)
 ;;2.7;Health Summary;**12,28**;Feb 28, 1996
"RTN","GMTSPNB",3,0)
MAIN ; Controls branching and execution
"RTN","GMTSPNB",4,0)
 N PN,GMTSI,GMTSJ,TIUFPRIV,TIUSTAT,TIUTYPE,X,DIWF,DIWL,DIWR
"RTN","GMTSPNB",5,0)
 K ^TMP("TIU",$J)
"RTN","GMTSPNB",6,0)
 S TIUSTAT="COMPLETED",TIUFPRIV=1
"RTN","GMTSPNB",7,0)
 S X="PROGRESS NOTES",DIC="^TIU(8925.1,",DIC(0)="X",DIC("S")="I $P($G(^(0)),U,4)=""CL""" D ^DIC S:Y>0 TIUTYPE=+Y
"RTN","GMTSPNB",8,0)
 D MAIN^TIULAPIC(DFN,TIUTYPE,GMTS1,GMTS2,GMTSNDM,0)
"RTN","GMTSPNB",9,0)
 I '$D(^TMP("TIU",$J)) Q
"RTN","GMTSPNB",10,0)
 D HEADER
"RTN","GMTSPNB",11,0)
 S GMTSI=0
"RTN","GMTSPNB",12,0)
 F  S GMTSI=$O(^TMP("TIU",$J,GMTSI)) Q:+GMTSI'>0!$D(GMTSQIT)  D
"RTN","GMTSPNB",13,0)
 . S GMTSJ=0
"RTN","GMTSPNB",14,0)
 . F  S GMTSJ=$O(^TMP("TIU",$J,GMTSI,GMTSJ)) Q:+GMTSJ'>0!$D(GMTSQIT)  D
"RTN","GMTSPNB",15,0)
 . . D VARI(GMTSI,GMTSJ)
"RTN","GMTSPNB",16,0)
 . . I $D(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD")) D ADDEND(GMTSI,GMTSJ)
"RTN","GMTSPNB",17,0)
 . . D WRT
"RTN","GMTSPNB",18,0)
 K ^TMP("TIU",$J)
"RTN","GMTSPNB",19,0)
 Q
"RTN","GMTSPNB",20,0)
 ;
"RTN","GMTSPNB",21,0)
HEADER ; Prints header
"RTN","GMTSPNB",22,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Prog Note DT",?16,"Title",?48,"Author",?64,"Last Corr DT",!!
"RTN","GMTSPNB",23,0)
 Q
"RTN","GMTSPNB",24,0)
 ;
"RTN","GMTSPNB",25,0)
VARI(GMTSI,GMTSJ) ;Sets variables for display
"RTN","GMTSPNB",26,0)
 S GMTSCNT=+$G(GMTSCNT)+1
"RTN","GMTSPNB",27,0)
 S X=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1301,"I")) D REGDT4^GMTSU S PN("DATE")=X
"RTN","GMTSPNB",28,0)
 S PN("AUTHOR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1202,"E"))
"RTN","GMTSPNB",29,0)
 S PN("DOCTYPE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,.01,"E"))
"RTN","GMTSPNB",30,0)
 I $L(PN("DOCTYPE"))>30 D FORMAT S PN("DOCTYPE")=^UTILITY($J,"W",1,1,0)
"RTN","GMTSPNB",31,0)
 S PN("CORRDT")=""
"RTN","GMTSPNB",32,0)
 Q
"RTN","GMTSPNB",33,0)
 ;
"RTN","GMTSPNB",34,0)
ADDEND(GMTSI,GMTSJ) ;Addenda date display
"RTN","GMTSPNB",35,0)
 N GMTSAD
"RTN","GMTSPNB",36,0)
 S GMTSAD=0
"RTN","GMTSPNB",37,0)
 S GMTSAD=$O(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",GMTSAD)) Q:+GMTSAD'>0 
"RTN","GMTSPNB",38,0)
 S X=^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",GMTSAD,1301,"I")
"RTN","GMTSPNB",39,0)
 D REGDT4^GMTSU S PN("CORRDT")=X
"RTN","GMTSPNB",40,0)
 Q
"RTN","GMTSPNB",41,0)
 ;
"RTN","GMTSPNB",42,0)
WRT ; Writes the component data
"RTN","GMTSPNB",43,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPNB",44,0)
 D:GMTSNPG HEADER W PN("DATE"),?16,PN("DOCTYPE"),?48,PN("AUTHOR"),?64,PN("CORRDT"),!
"RTN","GMTSPNB",45,0)
 I $D(^UTILITY($J,"W",1,2,0)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?16,^UTILITY($J,"W",1,2,0),!
"RTN","GMTSPNB",46,0)
 K PN,^UTILITY($J)
"RTN","GMTSPNB",47,0)
 Q
"RTN","GMTSPNB",48,0)
 ;
"RTN","GMTSPNB",49,0)
FORMAT ; Calls ^DIWP to format Title
"RTN","GMTSPNB",50,0)
 N DIWF,DIWL,DIWR,X
"RTN","GMTSPNB",51,0)
 S DIWF="C30",DIWL=1,DIWR=30,X=PN("DOCTYPE") D ^DIWP
"RTN","GMTSPNB",52,0)
 Q
"RTN","GMTSPSG")
0^38^B3644828
"RTN","GMTSPSG",1,0)
GMTSPSG ; SLC/JER,KER - UD Rx Summary Component (V4.5) ; 11/02/1998
"RTN","GMTSPSG",2,0)
 ;;2.7;Health Summary;**15,28**;Oct 20, 1995
"RTN","GMTSPSG",3,0)
MAIN ;
"RTN","GMTSPSG",4,0)
 I $$VERSION^XPDUTL("PSJ")'<5 G MAIN^GMTSPSG5
"RTN","GMTSPSG",5,0)
 N GMI,IX,ON,PS,PSIVREA,PSJEDT,PSJNKF,PSJPFWD,GMR,TN,UDS
"RTN","GMTSPSG",6,0)
 S PSJEDT=$S(GMTS2'=9999999:(9999999-GMTS2),1:""),PSJNKF=1
"RTN","GMTSPSG",7,0)
 K ^UTILITY("PSG",$J) I '$L($T(ENHS^PSJEEU0)) D NOPSJ Q
"RTN","GMTSPSG",8,0)
 D ENHS^PSJEEU0
"RTN","GMTSPSG",9,0)
 I '$D(^UTILITY("PSG",$J)) Q
"RTN","GMTSPSG",10,0)
 S IX=-9999999,GMI=0
"RTN","GMTSPSG",11,0)
 F  S IX=$O(^UTILITY("PSG",$J,IX)) Q:'IX  S GMR=^(IX) D WRT  Q:$D(GMTSQIT)
"RTN","GMTSPSG",12,0)
 W !
"RTN","GMTSPSG",13,0)
 K ^UTILITY("PSG",$J),^UTILITY("PSIV",$J)
"RTN","GMTSPSG",14,0)
 Q
"RTN","GMTSPSG",15,0)
NOPSJ ; Handles case where routine ^PSJEEU0 not installed
"RTN","GMTSPSG",16,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Inpatient Pharmacy version 3.2 or greater is required.",!
"RTN","GMTSPSG",17,0)
 Q
"RTN","GMTSPSG",18,0)
WRT ; Writes the Unit Dose Component
"RTN","GMTSPSG",19,0)
 N SD,FD,DRG,DOSE,GMV,RT,STAT,SIG
"RTN","GMTSPSG",20,0)
 S SD=$P(GMR,U),FD=$P(GMR,U,2),DRG=$P($P(GMR,U,3),";",2),STAT=$P($P(GMR,U,5),";")
"RTN","GMTSPSG",21,0)
 ; Don't display data when start date is after Date Range To Date and 
"RTN","GMTSPSG",22,0)
 ; stop date is before Date Range End Date. (Need end date because of
"RTN","GMTSPSG",23,0)
 ; FOR LOOP on $O(^PS(53.1,"AC",DFN,Y)) in PSJEEU0
"RTN","GMTSPSG",24,0)
 I +$G(GMRANGE),(SD>(9999999-GMTS1))!(FD<(9999999-GMTS2)) Q
"RTN","GMTSPSG",25,0)
 F GMV="SD","FD" S X=@GMV D REGDT4^GMTSU S @GMV=X
"RTN","GMTSPSG",26,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>0&('GMTSNPG) !
"RTN","GMTSPSG",27,0)
 I GMTSNPG!(GMI'>0) D HEAD
"RTN","GMTSPSG",28,0)
 S GMI=1
"RTN","GMTSPSG",29,0)
 S DOSE=$P(GMR,U,6),RT=$P($P(GMR,U,7),";",3),SIG=$P(GMR,U,8)
"RTN","GMTSPSG",30,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E(DRG,1,36),?38,DOSE,?50,STAT,?57,SD,?69,FD,!
"RTN","GMTSPSG",31,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG WRT W ?2,SIG," ",RT
"RTN","GMTSPSG",32,0)
 Q
"RTN","GMTSPSG",33,0)
HEAD ; Prints Header
"RTN","GMTSPSG",34,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSG",35,0)
 W "Drug",?38,"Dose",?50,"Status",?59,"Start",?71,"Stop",! W:$Y'>(IOSL-GMTSLO) !
"RTN","GMTSPSG",36,0)
 Q
"RTN","GMTSPSG5")
0^39^B3439746
"RTN","GMTSPSG5",1,0)
GMTSPSG5 ; SLC/JER,KER - UD Rx Summary Component (V5) ; 11/02/1998
"RTN","GMTSPSG5",2,0)
 ;;2.7;Health Summary;**15,28**;Oct 20, 1995
"RTN","GMTSPSG5",3,0)
MAIN N GMI,IX,ON,PS,PSIVREA,PSJEDT,PSJNKF,PSJPFWD,GMR,TN,UDS
"RTN","GMTSPSG5",4,0)
 S PSJEDT=$S(GMTS2'=9999999:(9999999-GMTS2),1:""),PSJNKF=1
"RTN","GMTSPSG5",5,0)
 K ^UTILITY("PSG",$J) I '$L($T(ENHS^PSJEEU0)) D NOPSJ Q
"RTN","GMTSPSG5",6,0)
 D ENHS^PSJEEU0
"RTN","GMTSPSG5",7,0)
 I '$D(^UTILITY("PSG",$J)) Q
"RTN","GMTSPSG5",8,0)
 S IX=-9999999,GMI=0
"RTN","GMTSPSG5",9,0)
 F  S IX=$O(^UTILITY("PSG",$J,IX)) Q:'IX  S GMR=^(IX) D WRT  Q:$D(GMTSQIT)
"RTN","GMTSPSG5",10,0)
 W !
"RTN","GMTSPSG5",11,0)
 K ^UTILITY("PSG",$J),^UTILITY("PSIV",$J)
"RTN","GMTSPSG5",12,0)
 Q
"RTN","GMTSPSG5",13,0)
NOPSJ ; Handles case where routine ^PSJEEU0 not installed
"RTN","GMTSPSG5",14,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Inpatient Pharmacy version 3.2 or greater is required.",!
"RTN","GMTSPSG5",15,0)
 Q
"RTN","GMTSPSG5",16,0)
WRT ; Writes the Unit Dose Component
"RTN","GMTSPSG5",17,0)
 N SD,FD,DRG,DOSE,GMV,RT,STAT,SIG
"RTN","GMTSPSG5",18,0)
 S SD=$P(GMR,U),FD=$P(GMR,U,2),DRG=$P($P(GMR,U,3),";",2),STAT=$P($P(GMR,U,5),";")
"RTN","GMTSPSG5",19,0)
 ; Don't display data when start date is after Date Range To Date and 
"RTN","GMTSPSG5",20,0)
 ; stop date is before Date Range End Date. (Need end date because of
"RTN","GMTSPSG5",21,0)
 ; FOR LOOP on $O(^PS(53.1,"AC",DFN,Y)) in PSJEEU0
"RTN","GMTSPSG5",22,0)
 I +$G(GMRANGE),(SD>(9999999-GMTS1))!(FD<(9999999-GMTS2)) Q
"RTN","GMTSPSG5",23,0)
 F GMV="SD","FD" S X=@GMV D REGDT4^GMTSU S @GMV=X
"RTN","GMTSPSG5",24,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>0&('GMTSNPG) !
"RTN","GMTSPSG5",25,0)
 I GMTSNPG!(GMI'>0) D HEAD
"RTN","GMTSPSG5",26,0)
 S GMI=1
"RTN","GMTSPSG5",27,0)
 S DOSE=$P(GMR,U,6),RT=$P($P(GMR,U,7),";",3),SIG=$P(GMR,U,8)
"RTN","GMTSPSG5",28,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E(DRG,1,36),?38,DOSE,?50,STAT,?57,SD,?69,FD,!
"RTN","GMTSPSG5",29,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG WRT W ?2,SIG," ",RT
"RTN","GMTSPSG5",30,0)
 Q
"RTN","GMTSPSG5",31,0)
HEAD ; Prints Header
"RTN","GMTSPSG5",32,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSG5",33,0)
 W "Drug",?38,"Dose",?50,"Status",?58,"Start",?68,"Stop",! W:$Y'>(IOSL-GMTSLO) !
"RTN","GMTSPSG5",34,0)
 Q
"RTN","GMTSPSI")
0^40^B6886817
"RTN","GMTSPSI",1,0)
GMTSPSI ; SLC/JER,KER - IV Rx Summary Component (V4.5) ; 11/02//1998
"RTN","GMTSPSI",2,0)
 ;;2.7;Health Summary;**15,28**;Oct 20, 1995
"RTN","GMTSPSI",3,0)
MAIN ;
"RTN","GMTSPSI",4,0)
 I $$VERSION^XPDUTL("PSJ")'<5 G MAIN^GMTSPSI5
"RTN","GMTSPSI",5,0)
 N GMI,GMTSIDT,MAX,ON,PS,PSIVREA,PSJEDT,PSJNKF,PSJPFWD,TN
"RTN","GMTSPSI",6,0)
 S PSJEDT=$S(GMTS2'=9999999:(9999999-GMTS2),1:""),PSJNKF=1
"RTN","GMTSPSI",7,0)
 K ^UTILITY("PSIV",$J) I '$L($T(ENHS^PSJEEU0)) D NOPSJ Q
"RTN","GMTSPSI",8,0)
 D ENHS^PSJEEU0
"RTN","GMTSPSI",9,0)
 I '$D(^UTILITY("PSIV",$J)) Q
"RTN","GMTSPSI",10,0)
 S GMI=0
"RTN","GMTSPSI",11,0)
 S GMTSIDT=-9999999 F  S GMTSIDT=$O(^UTILITY("PSIV",$J,GMTSIDT)) Q:'GMTSIDT  D WRT  Q:$D(GMTSQIT)
"RTN","GMTSPSI",12,0)
 K ^UTILITY("PSIV",$J),^UTILITY("PSG",$J)
"RTN","GMTSPSI",13,0)
 Q
"RTN","GMTSPSI",14,0)
NOPSJ ; Handles case where ^PSJEEU0 not present
"RTN","GMTSPSI",15,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Inpatient Pharmacy version 3.2 or greater is required.",!
"RTN","GMTSPSI",16,0)
 Q
"RTN","GMTSPSI",17,0)
WRT ; Prints IV Pharmacy order
"RTN","GMTSPSI",18,0)
 N GMV,GMW,GMTSAD,GMTSDRUG,SOL,SD,SLN,FD,STAT,IR,SCH
"RTN","GMTSPSI",19,0)
 S SD=$P(^UTILITY("PSIV",$J,GMTSIDT,0),U),FD=$P(^(0),U,2),STAT=$P($P(^(0),U,4),";"),IR=$P(^(0),U,5),SCH=$P(^(0),U,6)
"RTN","GMTSPSI",20,0)
 ; Don't display data when start date is after To Date for Date Range
"RTN","GMTSPSI",21,0)
 Q:+$G(GMRANGE)&(SD>(9999999-GMTS1))
"RTN","GMTSPSI",22,0)
 F GMV="SD","FD" S X=@GMV D REGDT4^GMTSU S @GMV=X K X
"RTN","GMTSPSI",23,0)
 I GMI'>0 D HEAD
"RTN","GMTSPSI",24,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>0&('GMTSNPG) !
"RTN","GMTSPSI",25,0)
 S GMI=1
"RTN","GMTSPSI",26,0)
 I $D(^UTILITY("PSIV",$J,GMTSIDT,"A",1)) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E($P($P(^UTILITY("PSIV",$J,GMTSIDT,"A",1),";",2),U),1,36),?38,$P(^(1),U,2),?50,STAT,?57,SD,?69,FD,!
"RTN","GMTSPSI",27,0)
 S GMTSAD=1
"RTN","GMTSPSI",28,0)
 F  S GMTSAD=$O(^UTILITY("PSIV",$J,GMTSIDT,"A",GMTSAD)) Q:GMTSAD'>0  S GMTSDRUG=^(GMTSAD) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E($P($P(GMTSDRUG,";",2),U),1,36),?38,$P(GMTSDRUG,U,2),!
"RTN","GMTSPSI",29,0)
LSTSOL ;Write solutions
"RTN","GMTSPSI",30,0)
 S SOL=0
"RTN","GMTSPSI",31,0)
 F  S SOL=$O(^UTILITY("PSIV",$J,GMTSIDT,"S",SOL)) Q:SOL'>0  S SLN=^(SOL) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSPSI",32,0)
 . D:GMTSNPG HEAD
"RTN","GMTSPSI",33,0)
 . W ?3,$S(SOL=1!GMTSNPG:"In: ",1:"    ")
"RTN","GMTSPSI",34,0)
 . W $P($P(SLN,";",2),U)," ",$P(SLN,U,2)," ",IR," ",SCH,!
"RTN","GMTSPSI",35,0)
 Q
"RTN","GMTSPSI",36,0)
HEAD ; Prints Header
"RTN","GMTSPSI",37,0)
 I 'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSI",38,0)
 W "Drug",?38,"Dose",?50,"Status",?58,"Start",?68,"Stop",! W:$Y'>(IOSL-GMTSLO) !
"RTN","GMTSPSI",39,0)
 Q
"RTN","GMTSPSI5")
0^41^B6625036
"RTN","GMTSPSI5",1,0)
GMTSPSI5 ; SLC/JER,KER - IV Rx Summary Component (V5) ; 11/02/1998
"RTN","GMTSPSI5",2,0)
 ;;2.7;Health Summary;**15,28**;Oct 20, 1995
"RTN","GMTSPSI5",3,0)
MAIN N GMI,GMTSIDT,MAX,ON,PS,PSIVREA,PSJEDT,PSJNKF,PSJPFWD,TN
"RTN","GMTSPSI5",4,0)
 S PSJEDT=$S(GMTS2'=9999999:(9999999-GMTS2),1:""),PSJNKF=1
"RTN","GMTSPSI5",5,0)
 K ^UTILITY("PSIV",$J) I '$L($T(ENHS^PSJEEU0)) D NOPSJ Q
"RTN","GMTSPSI5",6,0)
 D ENHS^PSJEEU0
"RTN","GMTSPSI5",7,0)
 I '$D(^UTILITY("PSIV",$J)) Q
"RTN","GMTSPSI5",8,0)
 S GMI=0
"RTN","GMTSPSI5",9,0)
 S GMTSIDT=-9999999 F  S GMTSIDT=$O(^UTILITY("PSIV",$J,GMTSIDT)) Q:'GMTSIDT  D WRT  Q:$D(GMTSQIT)
"RTN","GMTSPSI5",10,0)
 K ^UTILITY("PSIV",$J),^UTILITY("PSG",$J)
"RTN","GMTSPSI5",11,0)
 Q
"RTN","GMTSPSI5",12,0)
NOPSJ ; Handles case where ^PSJEEU0 not present
"RTN","GMTSPSI5",13,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Inpatient Pharmacy version 3.2 or greater is required.",!
"RTN","GMTSPSI5",14,0)
 Q
"RTN","GMTSPSI5",15,0)
WRT ; Prints IV Pharmacy order
"RTN","GMTSPSI5",16,0)
 N GMV,GMW,GMTSAD,GMTSDRUG,SOL,SD,SLN,FD,STAT,IR,SCH
"RTN","GMTSPSI5",17,0)
 S SD=$P(^UTILITY("PSIV",$J,GMTSIDT,0),U),FD=$P(^(0),U,2),STAT=$P($P(^(0),U,4),";"),IR=$P(^(0),U,5),SCH=$P(^(0),U,6)
"RTN","GMTSPSI5",18,0)
 ; Don't display data when start date is after To Date for Date Range
"RTN","GMTSPSI5",19,0)
 Q:+$G(GMRANGE)&(SD>(9999999-GMTS1))
"RTN","GMTSPSI5",20,0)
 F GMV="SD","FD" S X=@GMV D REGDT4^GMTSU S @GMV=X K X
"RTN","GMTSPSI5",21,0)
 I GMI'>0 D HEAD
"RTN","GMTSPSI5",22,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>0&('GMTSNPG) !
"RTN","GMTSPSI5",23,0)
 S GMI=1
"RTN","GMTSPSI5",24,0)
 I $D(^UTILITY("PSIV",$J,GMTSIDT,"A",1)) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E($P($P(^UTILITY("PSIV",$J,GMTSIDT,"A",1),";",2),U),1,36),?38,$P(^(1),U,2),?50,STAT,?57,SD,?69,FD,!
"RTN","GMTSPSI5",25,0)
 S GMTSAD=1
"RTN","GMTSPSI5",26,0)
 F  S GMTSAD=$O(^UTILITY("PSIV",$J,GMTSIDT,"A",GMTSAD)) Q:GMTSAD'>0  S GMTSDRUG=^(GMTSAD) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E($P($P(GMTSDRUG,";",2),U),1,36),?38,$P(GMTSDRUG,U,2),!
"RTN","GMTSPSI5",27,0)
LSTSOL ;Write solutions
"RTN","GMTSPSI5",28,0)
 S SOL=0
"RTN","GMTSPSI5",29,0)
 F  S SOL=$O(^UTILITY("PSIV",$J,GMTSIDT,"S",SOL)) Q:SOL'>0  S SLN=^(SOL) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSPSI5",30,0)
 . D:GMTSNPG HEAD
"RTN","GMTSPSI5",31,0)
 . W ?3,$S(SOL=1!GMTSNPG:"In: ",1:"    ")
"RTN","GMTSPSI5",32,0)
 . W $P($P(SLN,";",2),U)," ",$P(SLN,U,2)," ",IR," ",SCH,!
"RTN","GMTSPSI5",33,0)
 Q
"RTN","GMTSPSI5",34,0)
HEAD ; Prints Header
"RTN","GMTSPSI5",35,0)
 I 'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSI5",36,0)
 W "Drug",?38,"Dose",?50,"Status",?58,"Start",?68,"Stop",! W:$Y'>(IOSL-GMTSLO) !
"RTN","GMTSPSI5",37,0)
 Q
"RTN","GMTSPSO")
0^42^B9444232
"RTN","GMTSPSO",1,0)
GMTSPSO ; SLC/JER,KER/NDBI - OP Rx Summary Component (V6) ; 11/02/1998
"RTN","GMTSPSO",2,0)
 ;;2.7;Health Summary;**15,28**;Oct 20, 1995
"RTN","GMTSPSO",3,0)
MAIN ; OP Rx HS Comp
"RTN","GMTSPSO",4,0)
 ; Check for version 7   GMTSPSO7
"RTN","GMTSPSO",5,0)
 I $$VERSION^XPDUTL("PSO")'<7 G MAIN^GMTSPSO7
"RTN","GMTSPSO",6,0)
 ; If not version 7      GMTSPSO
"RTN","GMTSPSO",7,0)
 N ECD,GMR,IX,PSOBEGIN,PSOACT,GMX,GMTOP
"RTN","GMTSPSO",8,0)
 S PSOBEGIN=$S(GMTS2'=9999999:(9999999-GMTS2),1:"")
"RTN","GMTSPSO",9,0)
 I PSOBEGIN="" S PSOACT=1 K PSOBEGIN
"RTN","GMTSPSO",10,0)
 K ^TMP("PSOO",$J) D:$$ROK^GMTSU("A7RPSOHS")&($$NDBI^GMTSU) HS^A7RPSOHS(DFN) I '$D(^PS(55,DFN,"P")),'$D(^("ARC")),'$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO",11,0)
 I '$O(^PS(55,DFN,"P",0)),$D(^PS(55,DFN,"ARC")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Patient Has Archived OP Prescriptions",!
"RTN","GMTSPSO",12,0)
 D ^PSOHCSUM D:$$ROK^GMTSU("A7RPSOHS")&($$NDBI^GMTSU) HS^A7RPSOHS(DFN) I '$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO",13,0)
 S GMTSLO=GMTSLO+3
"RTN","GMTSPSO",14,0)
 S (GMX,GMTOP,IX)=0
"RTN","GMTSPSO",15,0)
 F  S IX=$O(^TMP("PSOO",$J,IX)) Q:IX'>0  S GMR=$G(^(IX,0)) D WRT
"RTN","GMTSPSO",16,0)
 S GMTSLO=GMTSLO-3
"RTN","GMTSPSO",17,0)
 K ^TMP("PSOO",$J)
"RTN","GMTSPSO",18,0)
 Q
"RTN","GMTSPSO",19,0)
WRT ; Writes OP Pharmacy Segment Record
"RTN","GMTSPSO",20,0)
 N ID,LFD,X,MI,NL,CF,GMD,GMV,GMI
"RTN","GMTSPSO",21,0)
 S ID=$P(GMR,U),LFD=$P(GMR,U,2),ECD=$P(GMR,U,11),CF=$P(GMR,U,10)
"RTN","GMTSPSO",22,0)
 ; Don't display when issue date is after To Date
"RTN","GMTSPSO",23,0)
 Q:+$G(GMRANGE)&(ID>(9999999-GMTS1))
"RTN","GMTSPSO",24,0)
 F GMV="ID","LFD","ECD" S X=@GMV D REGDT4^GMTSU S @GMV=X K X
"RTN","GMTSPSO",25,0)
 S MI=$G(^TMP("PSOO",$J,IX,1)),NL=0 I $L(MI)>73 D PARSE
"RTN","GMTSPSO",26,0)
 S GMD=$P($P(GMR,U,4),";",2)
"RTN","GMTSPSO",27,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO",28,0)
 D:GMTSNPG!(GMX'>0) HEAD W:'GMTOP ! S GMTOP=0 W $P($P(GMR,U,3),";",2)
"RTN","GMTSPSO",29,0)
 W !,?27,$P(GMR,U,6),?35,$P($P(GMR,U,5),";"),?39,$P(GMR,U,7),?54,ID,?65,LFD,?76,"("_$P(GMR,U,8)_")",!
"RTN","GMTSPSO",30,0)
 S GMX=1 I 'NL D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?2,"SIG: ",MI,! S GMTOP=0
"RTN","GMTSPSO",31,0)
 F GMI=1:1:NL D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W:GMI=1 ?2,"SIG: " W ?7,MI(GMI),! S GMTOP=0
"RTN","GMTSPSO",32,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?4,"Provider: ",$E(GMD,1,22) W:CF ?37,"Cost/Fill: $",$J(CF,6,2)
"RTN","GMTSPSO",33,0)
 I "EC"[$P($P(GMR,U,5),";"),ECD]"" W ?57,"Exp/Can Dt: "_ECD
"RTN","GMTSPSO",34,0)
 W ! S GMTOP=0
"RTN","GMTSPSO",35,0)
 Q
"RTN","GMTSPSO",36,0)
PARSE ; Parses Medication Instructions
"RTN","GMTSPSO",37,0)
 N GMI,NW,WPL
"RTN","GMTSPSO",38,0)
 S NL=$S(($L(MI)/73)>($L(MI)\73):($L(MI)\73)+1,1:$L(MI)\73)
"RTN","GMTSPSO",39,0)
 S NW=$L(MI," "),WPL=$S((NW/NL)>(NW\NL):(NW\NL)+1,1:NW\NL)
"RTN","GMTSPSO",40,0)
 F GMI=1:1:NL S MI(GMI)=$P(MI," ",(GMI-1)*WPL+1,GMI*WPL)
"RTN","GMTSPSO",41,0)
 Q
"RTN","GMTSPSO",42,0)
HEAD ; Prints Header
"RTN","GMTSPSO",43,0)
 S GMTOP=1 I GMX'>0,$D(^DPT(DFN,.1)),^(.1)]"",$D(^PS(59,+$O(^PS(59,0)),1)),$P(^(1),"^",8) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient prescriptions are cancelled 72 hours after admission",!
"RTN","GMTSPSO",44,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Drug....................................",?65,"Last",!
"RTN","GMTSPSO",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO",46,0)
 W ?27,"Rx #",?34,"Stat",?39,"Qty",?54,"Issued",?65,"Filled",?76,"Rem" W:$Y'>(IOSL-GMTSLO) !
"RTN","GMTSPSO",47,0)
 Q
"RTN","GMTSPSO7")
0^43^B7867729
"RTN","GMTSPSO7",1,0)
GMTSPSO7 ; SLC/JER/KER - OP Rx Summary Component (V6) ; 09/21/1998
"RTN","GMTSPSO7",2,0)
 ;;2.7;Health Summary;**15,28**;Oct 20, 1995
"RTN","GMTSPSO7",3,0)
MAIN ; OP Rx HS Component
"RTN","GMTSPSO7",4,0)
 N ECD,GMR,IX,PSOBEGIN,PSOACT,GMX,GMTOP
"RTN","GMTSPSO7",5,0)
 S PSOBEGIN=$S(GMTS2'=9999999:(9999999-GMTS2),1:"")
"RTN","GMTSPSO7",6,0)
 I PSOBEGIN="" S PSOACT=1 K PSOBEGIN
"RTN","GMTSPSO7",7,0)
 K ^TMP("PSOO",$J) I '$D(^PS(55,DFN,"P")),'$D(^("ARC")) Q
"RTN","GMTSPSO7",8,0)
 I '$O(^PS(55,DFN,"P",0)),$D(^PS(55,DFN,"ARC")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Patient Has Archived OP Prescriptions",!
"RTN","GMTSPSO7",9,0)
 D ^PSOHCSUM I '$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO7",10,0)
 S GMTSLO=GMTSLO+3
"RTN","GMTSPSO7",11,0)
 S (GMTOP,GMX,IX)=0
"RTN","GMTSPSO7",12,0)
 F  S IX=$O(^TMP("PSOO",$J,IX)) Q:IX'>0  S GMR=$G(^(IX,0)) D WRT
"RTN","GMTSPSO7",13,0)
 S GMTSLO=GMTSLO-3
"RTN","GMTSPSO7",14,0)
 K ^TMP("PSOO",$J),^UTILITY($J,"W")
"RTN","GMTSPSO7",15,0)
 Q
"RTN","GMTSPSO7",16,0)
WRT ; Writes OP Pharmacy Segment Record
"RTN","GMTSPSO7",17,0)
 N ID,LFD,X,MI,NL,CF,GMD,GMV,GMI,DIWL,DIWR,DIWF,GMSIG
"RTN","GMTSPSO7",18,0)
 S ID=$P(GMR,U),LFD=$P(GMR,U,2),ECD=$P(GMR,U,11),CF=$P(GMR,U,10)
"RTN","GMTSPSO7",19,0)
 ; Don't display when issue date is after To Date
"RTN","GMTSPSO7",20,0)
 Q:+$G(GMRANGE)&(ID>(9999999-GMTS1))
"RTN","GMTSPSO7",21,0)
 F GMV="ID","LFD","ECD" S X=@GMV D REGDT4^GMTSU S @GMV=X K X
"RTN","GMTSPSO7",22,0)
 S NL=0,DIWL=1,DIWR=73,DIWF="" K ^UTILITY($J,"W")
"RTN","GMTSPSO7",23,0)
 F  S NL=$O(^TMP("PSOO",$J,IX,NL)) Q:NL'>0  D
"RTN","GMTSPSO7",24,0)
 . S X=$G(^TMP("PSOO",$J,IX,NL,0)) D ^DIWP
"RTN","GMTSPSO7",25,0)
 S GMD=$P($P(GMR,U,4),";",2)
"RTN","GMTSPSO7",26,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO7",27,0)
 D:GMTSNPG!(GMX'>0) HEAD W:'GMTOP ! S GMTOP=0 W $P($P(GMR,U,3),";",2)
"RTN","GMTSPSO7",28,0)
 W !,?27,$P(GMR,U,6),?35,$P($P(GMR,U,5),";"),?39,$P(GMR,U,7),?54,ID,?65,LFD,?76,"("_$P(GMR,U,8)_")",!
"RTN","GMTSPSO7",29,0)
 S GMX=1,GMI=0,GMSIG=1
"RTN","GMTSPSO7",30,0)
 F  S GMI=$O(^UTILITY($J,"W",DIWL,GMI)) Q:GMI'>0!$D(GMTSQIT)  D
"RTN","GMTSPSO7",31,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD
"RTN","GMTSPSO7",32,0)
 . S MI=$G(^UTILITY($J,"W",DIWL,GMI,0))
"RTN","GMTSPSO7",33,0)
 . W:GMSIG=1 ?2,"SIG: " S:GMSIG=1 GMSIG=0 W ?7,MI,! S GMTOP=0
"RTN","GMTSPSO7",34,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?4,"Provider: ",$E(GMD,1,22) W:CF ?37,"Cost/Fill: $",$J(CF,6,2)
"RTN","GMTSPSO7",35,0)
 I "EC"[$P($P(GMR,U,5),";"),ECD]"" W ?57,"Exp/Can Dt: "_ECD
"RTN","GMTSPSO7",36,0)
 W ! S GMTOP=0
"RTN","GMTSPSO7",37,0)
 Q
"RTN","GMTSPSO7",38,0)
HEAD ; Prints Header
"RTN","GMTSPSO7",39,0)
 ; Only write the next line when there is data
"RTN","GMTSPSO7",40,0)
 S GMTOP=1 I GMX'>0,$D(^DPT(DFN,.1)),^(.1)]"",$D(^PS(59,+$O(^PS(59,0)),1)),$P(^(1),"^",8) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient prescriptions are cancelled 72 hours after admission",!
"RTN","GMTSPSO7",41,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Drug....................................",?65,"Last",!
"RTN","GMTSPSO7",42,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO7",43,0)
 W ?27,"Rx #",?34,"Stat",?39,"Qty",?54,"Issued",?65,"Filled",?76,"Rem" W:$Y'>(IOSL-GMTSLO) !
"RTN","GMTSPSO7",44,0)
 Q
"RTN","GMTSPXEP")
0^45^B9596650
"RTN","GMTSPXEP",1,0)
GMTSPXEP ; SLC/SBW,KER - PCE Patient Education comp ; 11/02/1998
"RTN","GMTSPXEP",2,0)
 ;;2.7;Health Summary;**8,10,28**;Oct 20, 1995
"RTN","GMTSPXEP",3,0)
 ;
"RTN","GMTSPXEP",4,0)
PTED ; Patient education
"RTN","GMTSPXEP",5,0)
 N GMTSOVT
"RTN","GMTSPXEP",6,0)
 K ^TMP("PXPE",$J)
"RTN","GMTSPXEP",7,0)
 ;
"RTN","GMTSPXEP",8,0)
 S GMTSOVT="AICTSORXHDE" ; NOTE: This is the set of Service Categories
"RTN","GMTSPXEP",9,0)
 ; for "Ambulatory (A), Inpatient (I), Chart Review (C),
"RTN","GMTSPXEP",10,0)
 ; Telecommunications (T), Day Surgery (S), Observation (O),
"RTN","GMTSPXEP",11,0)
 ; Nursing Home (R), Ancillary (X), Hospitalization (H), 
"RTN","GMTSPXEP",12,0)
 ; Daily Hospitalization ancillary (D) encounters, and
"RTN","GMTSPXEP",13,0)
 ; Event-Historical (E)
"RTN","GMTSPXEP",14,0)
 ;
"RTN","GMTSPXEP",15,0)
 D EDUC^PXRHS08(DFN,GMTSEND,GMTSBEG,GMTSNDM,GMTSOVT)
"RTN","GMTSPXEP",16,0)
 ;D:+$D(^TMP("PXPE",$J)) EDMAIN
"RTN","GMTSPXEP",17,0)
 Q:'$D(^TMP("PXPE",$J))
"RTN","GMTSPXEP",18,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR
"RTN","GMTSPXEP",19,0)
 D EDMAIN
"RTN","GMTSPXEP",20,0)
 Q
"RTN","GMTSPXEP",21,0)
MRPTED ; Most recent patient education
"RTN","GMTSPXEP",22,0)
 N GMTSOVT,LATEST
"RTN","GMTSPXEP",23,0)
 K ^TMP("PXPE",$J)
"RTN","GMTSPXEP",24,0)
 S LATEST="R" ;Returns most recent Pat. Ed. Topic Types for time period.
"RTN","GMTSPXEP",25,0)
 ;
"RTN","GMTSPXEP",26,0)
 S GMTSOVT="AICTSORXHDE" ; NOTE: This is the set of Service Categories
"RTN","GMTSPXEP",27,0)
 ; for "Ambulatory (A), Inpatient (I), Chart Review (C),
"RTN","GMTSPXEP",28,0)
 ; Telecommunications (T), Day Surgery (S), Observation (O),
"RTN","GMTSPXEP",29,0)
 ; Nursing Home (R), Ancillary (X), Hospitalization (H), 
"RTN","GMTSPXEP",30,0)
 ; Daily Hospitalization ancillary (D) encounters, and
"RTN","GMTSPXEP",31,0)
 ; Event-Historical (E)
"RTN","GMTSPXEP",32,0)
 ;
"RTN","GMTSPXEP",33,0)
 D EDUC^PXRHS08(DFN,GMTSEND,GMTSBEG,LATEST,GMTSOVT)
"RTN","GMTSPXEP",34,0)
 Q:'$D(^TMP("PXPE",$J))
"RTN","GMTSPXEP",35,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR
"RTN","GMTSPXEP",36,0)
 D EDMAIN
"RTN","GMTSPXEP",37,0)
 Q
"RTN","GMTSPXEP",38,0)
HDR ;Header
"RTN","GMTSPXEP",39,0)
 W ?2,"Date",?12,"Facility",?25,"Topic - Understanding Level",!!
"RTN","GMTSPXEP",40,0)
 Q
"RTN","GMTSPXEP",41,0)
EDMAIN ;
"RTN","GMTSPXEP",42,0)
 N GMDT,GMED,GMIFN,GMN0,GMN1,X,GMTSDAT,ED,LEVEL,GMSITE,PSITE,PDT,LTXT
"RTN","GMTSPXEP",43,0)
 N COMMENT,GMICL,GMTSLN,GMTAB
"RTN","GMTSPXEP",44,0)
 S GMDT=0
"RTN","GMTSPXEP",45,0)
 F  S GMDT=$O(^TMP("PXPE",$J,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXEP",46,0)
 . S GMED=""
"RTN","GMTSPXEP",47,0)
 . F  S GMED=$O(^TMP("PXPE",$J,GMDT,GMED)) Q:GMED']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXEP",48,0)
 . . S GMIFN=0
"RTN","GMTSPXEP",49,0)
 . . F  S GMIFN=$O(^TMP("PXPE",$J,GMDT,GMED,GMIFN)) Q:GMIFN'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXEP",50,0)
 . . . S GMN0=$G(^TMP("PXPE",$J,GMDT,GMED,GMIFN,0))
"RTN","GMTSPXEP",51,0)
 . . . Q:GMN0']""
"RTN","GMTSPXEP",52,0)
 . . . S GMN1=$G(^TMP("PXPE",$J,GMDT,GMED,GMIFN,1))
"RTN","GMTSPXEP",53,0)
 . . . S GMSITE=$S($P(GMN1,U,3)]"":$E($P(GMN1,U,3),1,10),$P(GMN1,U,4)]"":$E($P(GMN1,U,4),1,10),1:"No Site")
"RTN","GMTSPXEP",54,0)
 . . . S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXEP",55,0)
 . . . S ED=$P(GMN0,U),LEVEL=$P(GMN0,U,3)
"RTN","GMTSPXEP",56,0)
 . . . I LEVEL]"" S LTXT=" - "_LEVEL
"RTN","GMTSPXEP",57,0)
 . . . I LEVEL="POOR"!(LEVEL="FAIR")!(LEVEL="GOOD") S LTXT=LTXT_" UNDERSTANDING"
"RTN","GMTSPXEP",58,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR
"RTN","GMTSPXEP",59,0)
 . . . I GMTSDAT'=$G(PDT)!GMTSNPG W GMTSDAT S PDT=GMTSDAT,PSITE=""
"RTN","GMTSPXEP",60,0)
 . . . I GMSITE'=$G(PSITE) W ?12,GMSITE S PSITE=GMSITE
"RTN","GMTSPXEP",61,0)
 . . . W ?25,ED,$G(LTXT),!
"RTN","GMTSPXEP",62,0)
 . . . S COMMENT="",COMMENT=$P(^TMP("PXPE",$J,GMDT,GMED,GMIFN,"COM"),U)
"RTN","GMTSPXEP",63,0)
 . . . I COMMENT]"" S GMICL=26,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D 
"RTN","GMTSPXEP",64,0)
 . . . . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXEP",65,0)
 K ^TMP("PXPE",$J)
"RTN","GMTSPXEP",66,0)
 Q
"RTN","GMTSPXEP",67,0)
FORMAT ;formats line of text
"RTN","GMTSPXEP",68,0)
 N DIWR,DIWF,X
"RTN","GMTSPXEP",69,0)
 S DIWL=3,DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXEP",70,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXEP",71,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXEP",72,0)
 Q
"RTN","GMTSPXEP",73,0)
LINE ;writes  formatted lines of text
"RTN","GMTSPXEP",74,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?26,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXEP",75,0)
 Q
"RTN","GMTSPXFP")
0^46^B6801919
"RTN","GMTSPXFP",1,0)
GMTSPXFP ; SLC/SBW,KER - PCE Health Factors Component ; 11/02/1998
"RTN","GMTSPXFP",2,0)
 ;;2.7;Health Summary;**8,10,28**;Oct 20, 1995
"RTN","GMTSPXFP",3,0)
 ;
"RTN","GMTSPXFP",4,0)
HFSEL ; Health Factors Selected
"RTN","GMTSPXFP",5,0)
 N HFSEG,GMTSFC,GMW
"RTN","GMTSPXFP",6,0)
 Q:$O(GMTSEG(GMTSEGN,9999999.64,0))'>0
"RTN","GMTSPXFP",7,0)
 S GMTSFC=0,GMW=0
"RTN","GMTSPXFP",8,0)
 F  S GMTSFC=$O(GMTSEG(GMTSEGN,9999999.64,GMTSFC)) Q:'GMTSFC  D
"RTN","GMTSPXFP",9,0)
 . S HFSEG(GMTSEG(GMTSEGN,9999999.64,GMTSFC))=""
"RTN","GMTSPXFP",10,0)
 K ^TMP("PXF",$J)
"RTN","GMTSPXFP",11,0)
 D HF^PXRHS07(DFN,GMTSEND,GMTSBEG,GMTSNDM,.HFSEG)
"RTN","GMTSPXFP",12,0)
 ;D:+$D(^TMP("PXF",$J)) HFMAIN
"RTN","GMTSPXFP",13,0)
 Q:'$D(^TMP("PXF",$J))
"RTN","GMTSPXFP",14,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR
"RTN","GMTSPXFP",15,0)
 D HFMAIN
"RTN","GMTSPXFP",16,0)
 Q
"RTN","GMTSPXFP",17,0)
HFACT ; Control Health Factor retrieval and display
"RTN","GMTSPXFP",18,0)
 K ^TMP("PXF",$J)
"RTN","GMTSPXFP",19,0)
 D HF^PXRHS07(DFN,GMTSEND,GMTSBEG,GMTSNDM)
"RTN","GMTSPXFP",20,0)
 Q:'$D(^TMP("PXF",$J))
"RTN","GMTSPXFP",21,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR
"RTN","GMTSPXFP",22,0)
 D HFMAIN
"RTN","GMTSPXFP",23,0)
 Q
"RTN","GMTSPXFP",24,0)
HFMAIN ;
"RTN","GMTSPXFP",25,0)
 N GMHFC,GMHF,GMDT,GMIFN,GMN0,GMW,X,GMTSDAT,HF,LEVEL,PHFC,COMMENT
"RTN","GMTSPXFP",26,0)
 N GMICL,GMTAB,GMTSLN
"RTN","GMTSPXFP",27,0)
 S GMHFC="",GMW=0
"RTN","GMTSPXFP",28,0)
 F  S GMHFC=$O(^TMP("PXF",$J,GMHFC)) Q:GMHFC=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",29,0)
 . S GMHF=""
"RTN","GMTSPXFP",30,0)
 . F  S GMHF=$O(^TMP("PXF",$J,GMHFC,GMHF)) Q:GMHF=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",31,0)
 . . S GMDT=0
"RTN","GMTSPXFP",32,0)
 . . F  S GMDT=$O(^TMP("PXF",$J,GMHFC,GMHF,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",33,0)
 . . . S GMIFN=0
"RTN","GMTSPXFP",34,0)
 . . . F  S GMIFN=$O(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN)) Q:GMIFN'>0  D HFDSP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",35,0)
 K ^TMP("PXF",$J)
"RTN","GMTSPXFP",36,0)
 Q
"RTN","GMTSPXFP",37,0)
HDR ; Display Header
"RTN","GMTSPXFP",38,0)
 W "Category",!
"RTN","GMTSPXFP",39,0)
 W "  Health Factor ",?50,"Date",!
"RTN","GMTSPXFP",40,0)
 Q
"RTN","GMTSPXFP",41,0)
HFDSP ; Display Health Factor data
"RTN","GMTSPXFP",42,0)
 S GMN0=$G(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN,0))
"RTN","GMTSPXFP",43,0)
 Q:GMN0']""
"RTN","GMTSPXFP",44,0)
 S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXFP",45,0)
 S HF=$P(GMN0,U),LEVEL=$P(GMN0,U,4)
"RTN","GMTSPXFP",46,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR D
"RTN","GMTSPXFP",47,0)
 . I GMHFC'=$G(PHFC)!GMTSNPG D
"RTN","GMTSPXFP",48,0)
 . . I $G(PHFC)="",'GMTSNPG W ! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",49,0)
 . . W GMHFC,!
"RTN","GMTSPXFP",50,0)
 . . S PHFC=GMHFC
"RTN","GMTSPXFP",51,0)
 . S GMW=1
"RTN","GMTSPXFP",52,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",53,0)
 W ?2,HF
"RTN","GMTSPXFP",54,0)
 W:LEVEL]"" " (",LEVEL,")"
"RTN","GMTSPXFP",55,0)
 W ?50,GMTSDAT,!
"RTN","GMTSPXFP",56,0)
 S COMMENT="",COMMENT=$P(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN,"COM"),U)
"RTN","GMTSPXFP",57,0)
 I COMMENT]"" S GMICL=13,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSPXFP",58,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXFP",59,0)
 Q
"RTN","GMTSPXFP",60,0)
FORMAT ;formats line of text
"RTN","GMTSPXFP",61,0)
 N DIWR,DIWF,X
"RTN","GMTSPXFP",62,0)
 S DIWL=3,DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXFP",63,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXFP",64,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXFP",65,0)
 Q
"RTN","GMTSPXFP",66,0)
LINE ; writes formatted lines
"RTN","GMTSPXFP",67,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?13,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXFP",68,0)
 Q
"RTN","GMTSPXHR")
0^47^B7925121
"RTN","GMTSPXHR",1,0)
GMTSPXHR ; SLC/SBW,KER - PCE Clinical Reminders/Maint ; 11/02/1998
"RTN","GMTSPXHR",2,0)
 ;;2.7;Health Summary;**8,22,23,28**;Oct 20, 1995
"RTN","GMTSPXHR",3,0)
 ; Main driver for Clinical Reminder Components
"RTN","GMTSPXHR",4,0)
 ;
"RTN","GMTSPXHR",5,0)
MAIN ;Entry Point for Clinical Reminders
"RTN","GMTSPXHR",6,0)
 N CM,GMFLAG
"RTN","GMTSPXHR",7,0)
 S CM=0
"RTN","GMTSPXHR",8,0)
 I GMTSEGH["CR" S GMFLAG=0
"RTN","GMTSPXHR",9,0)
 I GMTSEGH["CRS" S GMFLAG=1
"RTN","GMTSPXHR",10,0)
 I GMTSEGH["CM" S GMFLAG=5,CM=1
"RTN","GMTSPXHR",11,0)
 Q:+$G(GMTSAGE)'>0!($G(SEX)="")!($G(DFN)'>0)
"RTN","GMTSPXHR",12,0)
 Q:$O(GMTSEG(GMTSEGN,811.9,0))'>0
"RTN","GMTSPXHR",13,0)
 N GMCR,GMFIRST,CRSEG,GMDISP
"RTN","GMTSPXHR",14,0)
 S GMCR=0,GMFIRST=1
"RTN","GMTSPXHR",15,0)
 F  S GMCR=$O(GMTSEG(GMTSEGN,811.9,GMCR)) Q:'GMCR  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",16,0)
 . S CRSEG=GMTSEG(GMTSEGN,811.9,GMCR)
"RTN","GMTSPXHR",17,0)
 . K ^TMP("PXRHM",$J),^TMP("PXRM",$J)
"RTN","GMTSPXHR",18,0)
 . D MAIN^PXRM(DFN,CRSEG,+$G(GMFLAG))
"RTN","GMTSPXHR",19,0)
 . D:+$D(^TMP("PXRHM",$J)) GETCR
"RTN","GMTSPXHR",20,0)
 I +$G(GMDISP)'>0 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Selected Clinical Reminders not due.",!
"RTN","GMTSPXHR",21,0)
 K ^TMP("PXRHM",$J),^TMP("PXRM",$J)
"RTN","GMTSPXHR",22,0)
 Q
"RTN","GMTSPXHR",23,0)
GETCR ;Get reminders that were returned
"RTN","GMTSPXHR",24,0)
 N ITEM,GMDT,GMN0,X,GMTSDAT,GMTSDUE,GMREM
"RTN","GMTSPXHR",25,0)
 S ITEM=0
"RTN","GMTSPXHR",26,0)
 F  S ITEM=$O(^TMP("PXRHM",$J,ITEM)) Q:ITEM'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",27,0)
 . S GMREM=""
"RTN","GMTSPXHR",28,0)
 . F  S GMREM=$O(^TMP("PXRHM",$J,ITEM,GMREM)) Q:GMREM=""  D CRDISP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",29,0)
 Q
"RTN","GMTSPXHR",30,0)
CRDISP ; Display reminder data
"RTN","GMTSPXHR",31,0)
 N HIST
"RTN","GMTSPXHR",32,0)
 S GMN0=$G(^TMP("PXRHM",$J,ITEM,GMREM))
"RTN","GMTSPXHR",33,0)
 Q:GMN0']""
"RTN","GMTSPXHR",34,0)
 I $P(GMN0,U,2) S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDUE=X
"RTN","GMTSPXHR",35,0)
 S GMTSDUE=$S($P(GMN0,U)]"":$P(GMN0,U),1:$G(GMTSDUE))
"RTN","GMTSPXHR",36,0)
 I $P(GMN0,U,3) S X=$P(GMN0,U,3) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXHR",37,0)
 S:$P(GMN0,U,3)'>0 GMTSDAT=$P(GMN0,U,3)
"RTN","GMTSPXHR",38,0)
 I $P(GMN0,U,4)="E" S HIST="(E) Historical"
"RTN","GMTSPXHR",39,0)
 S GMDISP=1
"RTN","GMTSPXHR",40,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",41,0)
 I GMTSNPG D HDR,CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",42,0)
 W GMREM,?36,$G(GMTSDUE),?47,$G(GMTSDAT),?58,$G(HIST),!
"RTN","GMTSPXHR",43,0)
 ;Q:+$G(GMFLAG)'>0
"RTN","GMTSPXHR",44,0)
 I 'CM Q
"RTN","GMTSPXHR",45,0)
 ; Display activity data on reminder
"RTN","GMTSPXHR",46,0)
 S GMDT=0
"RTN","GMTSPXHR",47,0)
 F  S GMDT=$O(^TMP("PXRHM",$J,ITEM,GMREM,GMDT)) Q:+GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",48,0)
 . S GMN0=$G(^TMP("PXRHM",$J,ITEM,GMREM,GMDT))
"RTN","GMTSPXHR",49,0)
 . Q:GMN0']""
"RTN","GMTSPXHR",50,0)
 . I $P(GMN0,U,2) S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXHR",51,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",52,0)
 . I GMTSNPG D HDR
"RTN","GMTSPXHR",53,0)
 . W ?5,$P(GMN0,U)," on record - ",$G(GMTSDAT),", ",$P(GMN0,U,3),!
"RTN","GMTSPXHR",54,0)
 ; Display maintenance criteria for reminder
"RTN","GMTSPXHR",55,0)
 S GMDT=0
"RTN","GMTSPXHR",56,0)
 F  S GMDT=$O(^TMP("PXRHM",$J,ITEM,GMREM,"TXT",GMDT)) Q:+GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",57,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",58,0)
 . I GMTSNPG D HDR
"RTN","GMTSPXHR",59,0)
 . W ?5,$G(^TMP("PXRHM",$J,ITEM,GMREM,"TXT",GMDT)),!
"RTN","GMTSPXHR",60,0)
 W !
"RTN","GMTSPXHR",61,0)
 Q
"RTN","GMTSPXHR",62,0)
HDR ;Header
"RTN","GMTSPXHR",63,0)
 I GMFIRST D FIRST Q:$D(GMTSQIT)  S GMFIRST=0
"RTN","GMTSPXHR",64,0)
 W ?36,"--NEXT--",?45,"--LAST--",!
"RTN","GMTSPXHR",65,0)
 Q
"RTN","GMTSPXHR",66,0)
 ;
"RTN","GMTSPXHR",67,0)
FIRST ;Display Disclaimer
"RTN","GMTSPXHR",68,0)
 N GMREC
"RTN","GMTSPXHR",69,0)
 S GMREC=0
"RTN","GMTSPXHR",70,0)
 F  S GMREC=$O(^TMP("PXRM",$J,"DISC",GMREC)) Q:+GMREC'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",71,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",72,0)
 . W ?1,$G(^TMP("PXRM",$J,"DISC",GMREC)),!
"RTN","GMTSPXHR",73,0)
 W !
"RTN","GMTSPXHR",74,0)
 Q
"RTN","GMTSPXIM")
0^48^B6113228
"RTN","GMTSPXIM",1,0)
GMTSPXIM ; SLC/SBW,KER - PCE Immunization component ; 11/02/1998
"RTN","GMTSPXIM",2,0)
 ;;2.7;Health Summary;**8,10,28**;Oct 20, 1995
"RTN","GMTSPXIM",3,0)
 ;
"RTN","GMTSPXIM",4,0)
IMMUN ; Main Entry Point
"RTN","GMTSPXIM",5,0)
 K ^TMP("PXI",$J)
"RTN","GMTSPXIM",6,0)
 D IMMUN^PXRHS03(DFN)
"RTN","GMTSPXIM",7,0)
 Q:'$D(^TMP("PXI",$J))
"RTN","GMTSPXIM",8,0)
 N GMIMM,GMDT,GMIFN,GMW,GMSITE,GMN0,GMN1,GMSIR,GMSIC,X,GMTSDAT,GML
"RTN","GMTSPXIM",9,0)
 N GMTSX,GMCKP,GMTAB,COMMENT,GMTSLN,GMICL
"RTN","GMTSPXIM",10,0)
 S GMIMM="" D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR
"RTN","GMTSPXIM",11,0)
 F  S GMIMM=$O(^TMP("PXI",$J,GMIMM)) Q:GMIMM=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXIM",12,0)
 . S (GMDT,GMW)=0
"RTN","GMTSPXIM",13,0)
 . F  S GMDT=$O(^TMP("PXI",$J,GMIMM,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXIM",14,0)
 . . S GMIFN=0
"RTN","GMTSPXIM",15,0)
 . . F  S GMIFN=$O(^TMP("PXI",$J,GMIMM,GMDT,GMIFN)) Q:GMIFN'>0  D IMMDSP Q:$D(GMTSQIT)
"RTN","GMTSPXIM",16,0)
 K ^TMP("PXI",$J)
"RTN","GMTSPXIM",17,0)
 Q
"RTN","GMTSPXIM",18,0)
IMMDSP ; Display Immunization data
"RTN","GMTSPXIM",19,0)
 ;S GMICL=47,GMTAB=2,DIWL=0
"RTN","GMTSPXIM",20,0)
 S DIWL=0,CNT=0,COMMENT=""
"RTN","GMTSPXIM",21,0)
 S GMN0=$G(^TMP("PXI",$J,GMIMM,GMDT,GMIFN,0))
"RTN","GMTSPXIM",22,0)
 Q:GMN0']""
"RTN","GMTSPXIM",23,0)
 S GMN1=$G(^TMP("PXI",$J,GMIMM,GMDT,GMIFN,1))
"RTN","GMTSPXIM",24,0)
 S GMSITE=$S($P(GMN1,U,3)]"":$E($P(GMN1,U,3),1,10),$P(GMN1,U,4)]"":$E($P(GMN1,U,4),1,10),1:"No Site")
"RTN","GMTSPXIM",25,0)
 S X=$P(GMN0,U,3) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXIM",26,0)
 S GMSIR=$P(GMN0,U,6)
"RTN","GMTSPXIM",27,0)
 S GMSIC=$S(+$P(GMN0,U,7):"DO NOT REPEAT",1:"")
"RTN","GMTSPXIM",28,0)
 I GMSIC]"",GMSIR]"" S GMSIR=GMSIR_"; "
"RTN","GMTSPXIM",29,0)
 S GMSIR=GMSIR_GMSIC
"RTN","GMTSPXIM",30,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR I GMW'>0!GMTSNPG W $P(GMN0,U,2) S GML=$L($P(GMN0,U,2))+1
"RTN","GMTSPXIM",31,0)
 W ?16,$P(GMN0,U,4),?23,GMTSDAT,?34,GMSITE
"RTN","GMTSPXIM",32,0)
 I GMSIR']"" W ! G COM
"RTN","GMTSPXIM",33,0)
 I GMSIR]"" S GMICL=47,GMTAB=2,CNT=1 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXIM",34,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXIM",35,0)
COM S COMMENT=$P(^TMP("PXI",$J,GMIMM,GMDT,GMIFN,"COM"),U)
"RTN","GMTSPXIM",36,0)
 I COMMENT]"" S GMICL=33,GMTAB=2,CNT=2 D FORMAT I $D(^UTILITY($J,"W")) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSPXIM",37,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXIM",38,0)
 S GMW=1
"RTN","GMTSPXIM",39,0)
 Q
"RTN","GMTSPXIM",40,0)
HDR ;Header
"RTN","GMTSPXIM",41,0)
 W "Immunization",?14,"Series",?25,"Date",?33,"Facility",?47,"Reaction",!!
"RTN","GMTSPXIM",42,0)
 Q
"RTN","GMTSPXIM",43,0)
FORMAT ;formats line of text
"RTN","GMTSPXIM",44,0)
 N DIWR,DIWF,X
"RTN","GMTSPXIM",45,0)
 S DIWL=3,DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXIM",46,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXIM",47,0)
 S X=$S(CNT=1:GMSIR,CNT=2:COMMENT) D ^DIWP
"RTN","GMTSPXIM",48,0)
 Q
"RTN","GMTSPXIM",49,0)
LINE ;Writes formatted lines of text
"RTN","GMTSPXIM",50,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXIM",51,0)
  W ?($S(CNT=1:47,CNT=2:33,1:0)),^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXIM",52,0)
 Q
"RTN","GMTSPXM")
0^49^B1926599
"RTN","GMTSPXM",1,0)
GMTSPXM ; SLC/SBW,KER - PCE Non Tabular Measurement comp ; 11/02/1998
"RTN","GMTSPXM",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSPXM",3,0)
 ;
"RTN","GMTSPXM",4,0)
MEAS ; Measurements provided within a date range
"RTN","GMTSPXM",5,0)
 K ^TMP("PXM",$J) Q:'$$ROK^GMTSU("PXRHS09")
"RTN","GMTSPXM",6,0)
 D MEAS^PXRHS09(DFN,GMTSEND,GMTSBEG,GMTSNDM)
"RTN","GMTSPXM",7,0)
 Q:'$D(^TMP("PXM",$J))
"RTN","GMTSPXM",8,0)
 N GMTYP,GMDT,GMIFN,GMN0,X,MTYPE,VALUE,PMTYPE
"RTN","GMTSPXM",9,0)
 S GMTYP=""
"RTN","GMTSPXM",10,0)
 F  S GMTYP=$O(^TMP("PXM",$J,GMTYP)) Q:GMTYP']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXM",11,0)
 . N GMTSDAT,PDT
"RTN","GMTSPXM",12,0)
 . S GMDT=0
"RTN","GMTSPXM",13,0)
 . F  S GMDT=$O(^TMP("PXM",$J,GMTYP,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXM",14,0)
 . . S GMIFN=0
"RTN","GMTSPXM",15,0)
 . . F  S GMIFN=$O(^TMP("PXM",$J,GMTYP,GMDT,GMIFN)) Q:GMIFN'>0  D MEASDSP Q:$D(GMTSQIT)
"RTN","GMTSPXM",16,0)
 K ^TMP("PXM",$J)
"RTN","GMTSPXM",17,0)
 Q
"RTN","GMTSPXM",18,0)
MEASDSP ; Display Measurement data
"RTN","GMTSPXM",19,0)
 S GMN0=$G(^TMP("PXM",$J,GMTYP,GMDT,GMIFN,0))
"RTN","GMTSPXM",20,0)
 Q:GMN0']""
"RTN","GMTSPXM",21,0)
 S X=$P(GMN0,U,2)
"RTN","GMTSPXM",22,0)
 D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXM",23,0)
 S MTYPE=$P(GMN0,U),VALUE=$P(GMN0,U,4)
"RTN","GMTSPXM",24,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXM",25,0)
 I GMTSNPG!(MTYPE'=$G(PMTYPE)) W MTYPE S PMTYPE=MTYPE
"RTN","GMTSPXM",26,0)
 I GMTSDAT'=$G(PDT)!GMTSNPG W ?5,GMTSDAT S PDT=GMTSDAT
"RTN","GMTSPXM",27,0)
 W ?17,VALUE,!
"RTN","GMTSPXM",28,0)
 Q
"RTN","GMTSPXMP")
0^50^B8482993
"RTN","GMTSPXMP",1,0)
GMTSPXMP ; SLC/SBW,KER - PCE Selected Measurement Comp ; 11/02/1998
"RTN","GMTSPXMP",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSPXMP",3,0)
 ;
"RTN","GMTSPXMP",4,0)
MEASP ; Get and Display Measurement data for Selected Measurement Panels
"RTN","GMTSPXMP",5,0)
 Q:'$$ROK^GMTSU("PXRHS20")  Q:+$O(GMTSEG(GMTSEGN,9001017,0))'>0
"RTN","GMTSPXMP",6,0)
 N GMM,GMW1,MPNAME,PORDER
"RTN","GMTSPXMP",7,0)
 S GMM=0,GMW1=0
"RTN","GMTSPXMP",8,0)
 F  S GMM=$O(GMTSEG(GMTSEGN,9001017,GMM)) Q:'GMM  D
"RTN","GMTSPXMP",9,0)
 . N MPANEL,FORMAT,MNOTE
"RTN","GMTSPXMP",10,0)
 . S MPANEL=GMTSEG(GMTSEGN,9001017,GMM)
"RTN","GMTSPXMP",11,0)
 . K ^TMP("PXM",$J),^TMP("PXF",$J)
"RTN","GMTSPXMP",12,0)
 . D MEAS^PXRHS20(DFN,GMTSDOB,SEX,GMTSEND,GMTSBEG,GMTSNDM,MPANEL)
"RTN","GMTSPXMP",13,0)
 . Q:+$D(^TMP("PXM",$J))'>0!(+$D(^TMP("PXM",$J))'>0)
"RTN","GMTSPXMP",14,0)
 . S MPNAME=$O(^TMP("PXF",$J,""))
"RTN","GMTSPXMP",15,0)
 . Q:MPNAME']""
"RTN","GMTSPXMP",16,0)
 . S PORDER=0
"RTN","GMTSPXMP",17,0)
 . F  S PORDER=$O(^TMP("PXF",$J,MPNAME,PORDER)) Q:PORDER'>0  D
"RTN","GMTSPXMP",18,0)
 . . N GMNODE,MNAME,MLABEL,FWIDTH,X
"RTN","GMTSPXMP",19,0)
 . . S GMNODE=^TMP("PXF",$J,MPNAME,PORDER)
"RTN","GMTSPXMP",20,0)
 . . S MNAME=$P(GMNODE,U)
"RTN","GMTSPXMP",21,0)
 . . S FWIDTH=$P(GMNODE,U,2)
"RTN","GMTSPXMP",22,0)
 . . S MLABEL=$P(GMNODE,U,3)
"RTN","GMTSPXMP",23,0)
 . . S X=$P(GMNODE,U,4) S:X]"" MNOTE(X)=""
"RTN","GMTSPXMP",24,0)
 . . S:FWIDTH'>0 FWIDTH=10
"RTN","GMTSPXMP",25,0)
 . . S FORMAT(PORDER,0)=$P(GMNODE,U)
"RTN","GMTSPXMP",26,0)
 . . S FORMAT(PORDER,1)=$S(MLABEL]"":MLABEL,1:MNAME)
"RTN","GMTSPXMP",27,0)
 . . S FORMAT(PORDER,2)=FWIDTH
"RTN","GMTSPXMP",28,0)
 . D MEASDSP
"RTN","GMTSPXMP",29,0)
 K ^TMP("PXM",$J),^TMP("PXF",$J)
"RTN","GMTSPXMP",30,0)
 Q
"RTN","GMTSPXMP",31,0)
MEASDSP ; Display Measurement Data in columns
"RTN","GMTSPXMP",32,0)
 N GMTSIDT,GMW,GMCOL,ORDER,LABEL,WIDTH,NAME,GMTSDAT,IFN
"RTN","GMTSPXMP",33,0)
 N VALUE,TVALUE
"RTN","GMTSPXMP",34,0)
 S GMW=1,GMTSIDT=0
"RTN","GMTSPXMP",35,0)
 F  S GMTSIDT=$O(^TMP("PXM",$J,GMTSIDT)) Q:GMTSIDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXMP",36,0)
 . S X=9999999-GMTSIDT D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXMP",37,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXMP",38,0)
 . I GMTSNPG!GMW D PHDR D CKP^GMTSUP Q:$D(GMTSQIT)  I GMTSNPG D PHDR
"RTN","GMTSPXMP",39,0)
 . D PLINE
"RTN","GMTSPXMP",40,0)
 . S GMW=0
"RTN","GMTSPXMP",41,0)
 I $O(MNOTE(0))]"" D
"RTN","GMTSPXMP",42,0)
 . ;D CKP^GMTSUP Q:$D(GMTSQIT)  W:'GMTSNPG !
"RTN","GMTSPXMP",43,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Notes:",!
"RTN","GMTSPXMP",44,0)
 . S X=""
"RTN","GMTSPXMP",45,0)
 . F  S X=$O(MNOTE(X)) Q:X=""  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,X,!
"RTN","GMTSPXMP",46,0)
 Q
"RTN","GMTSPXMP",47,0)
PLINE ;
"RTN","GMTSPXMP",48,0)
 W GMTSDAT
"RTN","GMTSPXMP",49,0)
 S GMCOL=12,ORDER=0
"RTN","GMTSPXMP",50,0)
 F  S ORDER=$O(FORMAT(ORDER)) Q:ORDER'>0  D
"RTN","GMTSPXMP",51,0)
 . S VALUE=""
"RTN","GMTSPXMP",52,0)
 . S WIDTH=FORMAT(ORDER,2)
"RTN","GMTSPXMP",53,0)
 . S NAME=FORMAT(ORDER,0)
"RTN","GMTSPXMP",54,0)
 . ;Only get one entry for an ordered item.
"RTN","GMTSPXMP",55,0)
 . S IFN=+$O(^TMP("PXM",$J,GMTSIDT,ORDER,""))
"RTN","GMTSPXMP",56,0)
 . S TVALUE=$G(^TMP("PXM",$J,GMTSIDT,ORDER,IFN))
"RTN","GMTSPXMP",57,0)
 . I TVALUE]""  S VALUE=$P(TVALUE,U),X=$P(TVALUE,U,2) S:X]"" MNOTE(X)=""
"RTN","GMTSPXMP",58,0)
 . S:VALUE]"" VALUE=$S($P(WIDTH,".",2)="":$J(VALUE,$P(WIDTH,".",1)),1:$J(VALUE,$P(WIDTH,".",1),$P(WIDTH,".",2)))
"RTN","GMTSPXMP",59,0)
 . W ?GMCOL,VALUE S GMCOL=GMCOL+WIDTH+2
"RTN","GMTSPXMP",60,0)
 W !
"RTN","GMTSPXMP",61,0)
 Q
"RTN","GMTSPXMP",62,0)
PHDR ;Write Measurement Panel Header
"RTN","GMTSPXMP",63,0)
 I GMW1,'GMTSNPG W ! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXMP",64,0)
 I MPNAME]"" W MPNAME," Measurement Panel",!
"RTN","GMTSPXMP",65,0)
 S GMCOL=10,ORDER=0
"RTN","GMTSPXMP",66,0)
 F  S ORDER=$O(FORMAT(ORDER)) Q:ORDER'>0  D
"RTN","GMTSPXMP",67,0)
 . S LABEL=FORMAT(ORDER,1),WIDTH=FORMAT(ORDER,2)
"RTN","GMTSPXMP",68,0)
 . W ?(GMCOL+1+(WIDTH-$L(LABEL)\2)),LABEL
"RTN","GMTSPXMP",69,0)
 . S GMCOL=GMCOL+WIDTH+2
"RTN","GMTSPXMP",70,0)
 W !
"RTN","GMTSPXMP",71,0)
 S GMW1=1
"RTN","GMTSPXMP",72,0)
 Q
"RTN","GMTSPXOP")
0^51^B29643037
"RTN","GMTSPXOP",1,0)
GMTSPXOP ; SLC/SBW,KER - PCE Outpatient Encounter comp ; 11/02/1998
"RTN","GMTSPXOP",2,0)
 ;;2.7;Health Summary;**8,10,28**;Oct 20, 1995
"RTN","GMTSPXOP",3,0)
 ;
"RTN","GMTSPXOP",4,0)
PURPOSE ; Entry point to show outpatient encounters with ICD9 data
"RTN","GMTSPXOP",5,0)
 ; and providers
"RTN","GMTSPXOP",6,0)
 N DTYPE
"RTN","GMTSPXOP",7,0)
 S DTYPE="DP"
"RTN","GMTSPXOP",8,0)
 D MAIN
"RTN","GMTSPXOP",9,0)
 Q
"RTN","GMTSPXOP",10,0)
OUTPT ; Entry point to show outpatient encounters with ICD9 data,
"RTN","GMTSPXOP",11,0)
 ; CPT data, and providers
"RTN","GMTSPXOP",12,0)
 N DTYPE
"RTN","GMTSPXOP",13,0)
 S DTYPE="CDP"
"RTN","GMTSPXOP",14,0)
 D MAIN
"RTN","GMTSPXOP",15,0)
 Q
"RTN","GMTSPXOP",16,0)
MAIN ;
"RTN","GMTSPXOP",17,0)
 N GMTSIVD,GMTSDAT,GMTSDTU,GMTSOVT,GMTSLOC,DIWL,GMTAB,GMTSN,GMCKP,GMTSX
"RTN","GMTSPXOP",18,0)
 N GMTSITE,GMTSICL,GMTSLOC,GMTSELIG,X,GMTSVDF
"RTN","GMTSPXOP",19,0)
 S GMTSICL=14 ;# of blank left columns for support data of a visit
"RTN","GMTSPXOP",20,0)
 S DIWL=0 ;used in TXTFMT call & to print returned data
"RTN","GMTSPXOP",21,0)
 S GMTAB=2 ;Used to offset data from TXTFMT call after 1st line
"RTN","GMTSPXOP",22,0)
 ;
"RTN","GMTSPXOP",23,0)
 S GMTSOVT="AICTSORE" ; NOTE: This is the set of Service Categories
"RTN","GMTSPXOP",24,0)
 ; for "Ambulatory (A), Inpatient (I), Chart Review (C),
"RTN","GMTSPXOP",25,0)
 ; Telecommunications (T), Day Surgery (S), Observation (O),
"RTN","GMTSPXOP",26,0)
 ; Nursing Home (R) encounters, (E) Event - Historical. 
"RTN","GMTSPXOP",27,0)
 ; Note: Hospitalization and Ancillary encounters are not included
"RTN","GMTSPXOP",28,0)
 ;
"RTN","GMTSPXOP",29,0)
 D VISIT^PXRHS01(DFN,GMTSEND,GMTSBEG,GMTSNDM,GMTSOVT,DTYPE,1)
"RTN","GMTSPXOP",30,0)
 Q:'$D(^TMP("PXHSV",$J))
"RTN","GMTSPXOP",31,0)
 S GMTSIVD=0
"RTN","GMTSPXOP",32,0)
 F  S GMTSIVD=$O(^TMP("PXHSV",$J,GMTSIVD)) Q:GMTSIVD']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",33,0)
 . S GMTSVDF=0
"RTN","GMTSPXOP",34,0)
 . F  S GMTSVDF=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF)) Q:GMTSVDF'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",35,0)
 . . S GMTSN=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,0))
"RTN","GMTSPXOP",36,0)
 . . S X=$P(GMTSN,U,1) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXOP",37,0)
 . . S GMTSDTU=0
"RTN","GMTSPXOP",38,0)
 . . S GMTSLOC=""
"RTN","GMTSPXOP",39,0)
 . . S GMTSITE=$S($P(GMTSN,U,3)]"":$E($P(GMTSN,U,3),1,10),$P(GMTSN,U,8)]"":$E($P(GMTSN,U,8),1,10),1:"No Site")
"RTN","GMTSPXOP",40,0)
 . . I $G(GMPXHLOC)="Y" S GMTSLOC=$E($P(GMTSN,U,6),1,30)
"RTN","GMTSPXOP",41,0)
 . . I '$L(GMTSLOC) S GMTSLOC=$P(GMTSN,U,9)
"RTN","GMTSPXOP",42,0)
 . . S GMTSELIG=$E($P(GMTSN,U,12),1,17)
"RTN","GMTSPXOP",43,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS
"RTN","GMTSPXOP",44,0)
 . . D DSPPROV Q:$D(GMTSQIT)
"RTN","GMTSPXOP",45,0)
 . . D DSPPOV Q:$D(GMTSQIT)
"RTN","GMTSPXOP",46,0)
 . . D DSPCPT
"RTN","GMTSPXOP",47,0)
 . . W !
"RTN","GMTSPXOP",48,0)
 K ^TMP("PXHSV",$J)
"RTN","GMTSPXOP",49,0)
 Q
"RTN","GMTSPXOP",50,0)
 ;
"RTN","GMTSPXOP",51,0)
DSPPOV ; Display Purpose of visit
"RTN","GMTSPXOP",52,0)
 Q:$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",""))=""
"RTN","GMTSPXOP",53,0)
 Q:$G(GMPXICDF)="N"&($G(GMPXNARR)="N")
"RTN","GMTSPXOP",54,0)
 N GMTSN,GMTSMOD,GMTSICD,GMTSNARR,GMTSPDN,GMTS,GMTSQTY,GMTSPRI,COMMENT
"RTN","GMTSPXOP",55,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS W ?3,"Diagnosis:"
"RTN","GMTSPXOP",56,0)
 S GMCKP=0,GMTSPDN="",GMTSQTY=""
"RTN","GMTSPXOP",57,0)
 F  S GMTSPDN=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN)) Q:GMTSPDN'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",58,0)
 . S GMTSN=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN))
"RTN","GMTSPXOP",59,0)
 . S GMTSMOD=$P(GMTSN,U,2)
"RTN","GMTSPXOP",60,0)
 . S GMTSICD=$P(GMTSN,U) D GETICDDX^GMTSPXU1(.GMTSICD,$G(GMPXICDF),GMTSMOD)
"RTN","GMTSPXOP",61,0)
 . S GMTSNARR=""
"RTN","GMTSPXOP",62,0)
 . S:$G(GMPXNARR)'="N" GMTSNARR=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN,"N"))
"RTN","GMTSPXOP",63,0)
 . I $P(GMTSICD,"-",2,10)=$G(GMTSNARR) S GMTSNARR=""
"RTN","GMTSPXOP",64,0)
 . S GMTSPRI="" I $P(GMTSN,U,5)]"",$E($P(GMTSN,U,5),1)="P" S GMTSPRI=" (P)"
"RTN","GMTSPXOP",65,0)
 . D TXTFMT^GMTSPXU1(GMTSICD,$G(GMTSNARR),GMTSICL,GMTAB,DIWL,GMTSQTY,GMTSPRI)
"RTN","GMTSPXOP",66,0)
 . I '$D(^UTILITY($J,"W")) Q
"RTN","GMTSPXOP",67,0)
 . S GMTSX=0
"RTN","GMTSPXOP",68,0)
 . F  S GMTSX=$O(^UTILITY($J,"W",DIWL,GMTSX)) Q:GMTSX'>0!$D(GMTSQIT)  D
"RTN","GMTSPXOP",69,0)
 . . I GMCKP>0 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS
"RTN","GMTSPXOP",70,0)
 . . S GMCKP=1
"RTN","GMTSPXOP",71,0)
 . . W ?GMTSICL+$S(GMTSX>1:GMTAB,1:0),$G(^UTILITY($J,"W",DIWL,GMTSX,0)),!
"RTN","GMTSPXOP",72,0)
 . S COMMENT="",COMMENT=$P($G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN,"COM")),U)
"RTN","GMTSPXOP",73,0)
 . I COMMENT]"" S GMICL=20,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXOP",74,0)
 . . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXOP",75,0)
 Q
"RTN","GMTSPXOP",76,0)
DSPCPT ; Display Procedures performed during the visit
"RTN","GMTSPXOP",77,0)
 Q:$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",""))=""
"RTN","GMTSPXOP",78,0)
 N GMTSNARR,GMTSPDN,GMTSN,GMTSICD,GMTSNARR,GMTSCPT,GMTSQTY,GMTSPRIM,GMTSPRI
"RTN","GMTSPXOP",79,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS W ?3,"Procedure:"
"RTN","GMTSPXOP",80,0)
 S GMCKP=0,GMTSPDN="",GMTSPRI=""
"RTN","GMTSPXOP",81,0)
 F  S GMTSPDN=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN)) Q:GMTSPDN'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",82,0)
 . S GMTSN=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN))
"RTN","GMTSPXOP",83,0)
 . S GMTSNARR=$P(GMTSN,U,2),GMTSQTY=$P(GMTSN,U,3),GMTSPRIM=$P(GMTSN,U,4)
"RTN","GMTSPXOP",84,0)
 . S GMTSCPT=$$GETCPT^GMTSPXU1($P(GMTSN,U))
"RTN","GMTSPXOP",85,0)
 . I $P(GMTSCPT,"-",2,10)=GMTSNARR S GMTSNARR=""
"RTN","GMTSPXOP",86,0)
 . S GMTSPRI=""
"RTN","GMTSPXOP",87,0)
 . S:$G(GMTSQTY)]"" GMTSQTY=" ("_GMTSQTY_")" S:$G(GMTSPRIM)="Y" GMTSPRI="(P)"
"RTN","GMTSPXOP",88,0)
 . D TXTFMT^GMTSPXU1(GMTSCPT,GMTSNARR,GMTSICL,GMTAB,DIWL,GMTSQTY,GMTSPRI)
"RTN","GMTSPXOP",89,0)
 . I '$D(^UTILITY($J,"W")) Q
"RTN","GMTSPXOP",90,0)
 . S GMTSX=0
"RTN","GMTSPXOP",91,0)
 . F  S GMTSX=$O(^UTILITY($J,"W",DIWL,GMTSX)) Q:GMTSX'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",92,0)
 . . I GMCKP>0 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS
"RTN","GMTSPXOP",93,0)
 . . S GMCKP=1
"RTN","GMTSPXOP",94,0)
 . . W ?GMTSICL+$S(GMTSX>1:GMTAB,1:0),$G(^UTILITY($J,"W",DIWL,GMTSX,0)),!
"RTN","GMTSPXOP",95,0)
 . ;display comments 
"RTN","GMTSPXOP",96,0)
 . I DTYPE="DP" Q
"RTN","GMTSPXOP",97,0)
 . S COMMENT=$P($G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN,"COM")),U)
"RTN","GMTSPXOP",98,0)
 . I COMMENT]"" S GMICL=20,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXOP",99,0)
 . . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXOP",100,0)
 Q
"RTN","GMTSPXOP",101,0)
DSPPROV ; Display Providers for visit
"RTN","GMTSPXOP",102,0)
 Q:$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"P",""))=""
"RTN","GMTSPXOP",103,0)
 N GMCNT,GMPROV
"RTN","GMTSPXOP",104,0)
 D ORDERPRO^GMTSPXU1(.GMPROV,20)
"RTN","GMTSPXOP",105,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS W ?3," Provider:"
"RTN","GMTSPXOP",106,0)
 S GMCNT=0
"RTN","GMTSPXOP",107,0)
 F  S GMCNT=$O(GMPROV(GMCNT)) Q:GMCNT'>0  D  Q:GMCNT'>0!$D(GMTSQIT)
"RTN","GMTSPXOP",108,0)
 . I GMCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS
"RTN","GMTSPXOP",109,0)
 . W ?GMTSICL,GMPROV(GMCNT)
"RTN","GMTSPXOP",110,0)
 . S GMCNT=$O(GMPROV(GMCNT)) Q:GMCNT'>0
"RTN","GMTSPXOP",111,0)
 . W ?37,GMPROV(GMCNT)
"RTN","GMTSPXOP",112,0)
 . S GMCNT=$O(GMPROV(GMCNT)) Q:GMCNT'>0
"RTN","GMTSPXOP",113,0)
 . W ?60,GMPROV(GMCNT)
"RTN","GMTSPXOP",114,0)
 . W:$O(GMPROV(GMCNT)) !
"RTN","GMTSPXOP",115,0)
 W !
"RTN","GMTSPXOP",116,0)
 Q
"RTN","GMTSPXOP",117,0)
DSPVIS ; Display outpatient visit data
"RTN","GMTSPXOP",118,0)
 Q:GMTSNPG'>0&(GMTSDTU>0)
"RTN","GMTSPXOP",119,0)
 D:GMTSNPG HDR I GMTSNPG!(+GMTSDTU'>0) D
"RTN","GMTSPXOP",120,0)
 . W GMTSDAT,?14,GMTSITE,?29,GMTSLOC,?61,GMTSELIG,!
"RTN","GMTSPXOP",121,0)
 . S GMTSDTU=1
"RTN","GMTSPXOP",122,0)
 Q
"RTN","GMTSPXOP",123,0)
HDR ;Display header
"RTN","GMTSPXOP",124,0)
 W ?3,"Date",?14,"Facility",?29,"Hospital Location",?61,"Encounter Elig.",!!
"RTN","GMTSPXOP",125,0)
 Q
"RTN","GMTSPXOP",126,0)
FORMAT ; formats line of text
"RTN","GMTSPXOP",127,0)
 N DIWR,DIWF,X
"RTN","GMTSPXOP",128,0)
 S DIWL=3,DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXOP",129,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXOP",130,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXOP",131,0)
 Q
"RTN","GMTSPXOP",132,0)
LINE ;writes formatted lines
"RTN","GMTSPXOP",133,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXOP",134,0)
 Q
"RTN","GMTSPXSK")
0^52^B5441483
"RTN","GMTSPXSK",1,0)
GMTSPXSK ; SLC/SBW,KER - PCE Skin Test comp ; 11/02/1998
"RTN","GMTSPXSK",2,0)
 ;;2.7;Health Summary;**8,10,28**;Oct 20, 1995
"RTN","GMTSPXSK",3,0)
 ;
"RTN","GMTSPXSK",4,0)
SKIN ; Main entry point
"RTN","GMTSPXSK",5,0)
 K ^TMP("PXS",$J)
"RTN","GMTSPXSK",6,0)
 D SKIN^PXRHS04(DFN)
"RTN","GMTSPXSK",7,0)
 Q:'$D(^TMP("PXS",$J))
"RTN","GMTSPXSK",8,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR
"RTN","GMTSPXSK",9,0)
 N GMSK,GMDT,GMIFN,GMW,GMSITE,GMSKIN,GMN0,GMN1,GMRDG,X,GMTSDAT,GMRES
"RTN","GMTSPXSK",10,0)
 N COMMENT,GMICL,GMRDT,GMTSLN,GMTAB
"RTN","GMTSPXSK",11,0)
 S GMSK=""
"RTN","GMTSPXSK",12,0)
 F  S GMSK=$O(^TMP("PXS",$J,GMSK)) Q:GMSK=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXSK",13,0)
 . S (GMDT,GMW)=0
"RTN","GMTSPXSK",14,0)
 . F  S GMDT=$O(^TMP("PXS",$J,GMSK,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXSK",15,0)
 . . S GMIFN=0
"RTN","GMTSPXSK",16,0)
 . . F  S GMIFN=$O(^TMP("PXS",$J,GMSK,GMDT,GMIFN)) Q:GMIFN'>0  D SKINDSP Q:$D(GMTSQIT)
"RTN","GMTSPXSK",17,0)
 K ^TMP("PXS",$J)
"RTN","GMTSPXSK",18,0)
 Q
"RTN","GMTSPXSK",19,0)
HDR ;Display header
"RTN","GMTSPXSK",20,0)
 W ?38," -  Date  - ",!
"RTN","GMTSPXSK",21,0)
 W "Skin Test",?15,"Reading",?24,"Results",?37,"Admin.",?45,"Reading",?60,"Facility",!!
"RTN","GMTSPXSK",22,0)
 Q
"RTN","GMTSPXSK",23,0)
SKINDSP ; Display Skin Test data
"RTN","GMTSPXSK",24,0)
 S GMN0=$G(^TMP("PXS",$J,GMSK,GMDT,GMIFN,0))
"RTN","GMTSPXSK",25,0)
 Q:GMN0']""
"RTN","GMTSPXSK",26,0)
 S GMN1=$G(^TMP("PXS",$J,GMSK,GMDT,GMIFN,1))
"RTN","GMTSPXSK",27,0)
 S GMSITE=$S($P(GMN1,U,3)]"":$E($P(GMN1,U,3),1,10),$P(GMN1,U,4)]"":$E($P(GMN1,U,4),1,10),1:"No Site")
"RTN","GMTSPXSK",28,0)
 S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXSK",29,0)
 S GMSKIN=$P(GMN0,U)
"RTN","GMTSPXSK",30,0)
 S GMRDG=$P(GMN0,U,5)
"RTN","GMTSPXSK",31,0)
 S X=$P(GMN0,U,6) D REGDT4^GMTSU S GMRDT=X
"RTN","GMTSPXSK",32,0)
 I GMRDG]"" S GMRDG=$J(GMRDG,2)_" mm"
"RTN","GMTSPXSK",33,0)
 S GMRES=$P(GMN0,U,4)
"RTN","GMTSPXSK",34,0)
 I GMRDG']"",GMRES']"" S GMRES="UNREPORTED"
"RTN","GMTSPXSK",35,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR W:GMW'>0!GMTSNPG GMSKIN W ?15,GMRDG,?24,GMRES,?35,GMTSDAT,?47,GMRDT,?62,$E(GMSITE,1,17),!
"RTN","GMTSPXSK",36,0)
 S COMMENT=$P($G(^TMP("PXS",$J,GMSK,GMDT,GMIFN,"COM")),U)
"RTN","GMTSPXSK",37,0)
 I COMMENT]"" S GMICL=15,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXSK",38,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXSK",39,0)
 S GMW=1
"RTN","GMTSPXSK",40,0)
 Q
"RTN","GMTSPXSK",41,0)
FORMAT ;formats line of text
"RTN","GMTSPXSK",42,0)
 N DIWR,DIWF,X
"RTN","GMTSPXSK",43,0)
 S DIWL=3,DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXSK",44,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXSK",45,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXSK",46,0)
 Q
"RTN","GMTSPXSK",47,0)
LINE ;writes formatted lines
"RTN","GMTSPXSK",48,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?15,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXSK",49,0)
 Q
"RTN","GMTSPXTP")
0^53^B9393551
"RTN","GMTSPXTP",1,0)
GMTSPXTP ; SLC/SBW,KER - PCE Treatment Comp ; 11/02/1998
"RTN","GMTSPXTP",2,0)
 ;;2.7;Health Summary;**8,10,28**;Oct 20, 1995
"RTN","GMTSPXTP",3,0)
 ;
"RTN","GMTSPXTP",4,0)
TRTMT ; Treatments provided within a date range and service category
"RTN","GMTSPXTP",5,0)
 N SERCAT
"RTN","GMTSPXTP",6,0)
 ;
"RTN","GMTSPXTP",7,0)
 S SERCAT="AICTSORXHDE" ; NOTE: This is the set of Service Categories
"RTN","GMTSPXTP",8,0)
 ; for "Ambulatory (A), Inpatient (I), Chart Review (C),
"RTN","GMTSPXTP",9,0)
 ; Telecommunications (T), Day Surgery (S), Observation (O),
"RTN","GMTSPXTP",10,0)
 ; Nursing Home (R), Ancillary (X), Hospitalization (H), 
"RTN","GMTSPXTP",11,0)
 ; Daily Hospitalization ancillary (D), (E)Historical event encounters. 
"RTN","GMTSPXTP",12,0)
 ;
"RTN","GMTSPXTP",13,0)
 K ^TMP("PXT",$J)
"RTN","GMTSPXTP",14,0)
 D TREAT^PXRHS06(DFN,GMTSEND,GMTSBEG,GMTSNDM,SERCAT)
"RTN","GMTSPXTP",15,0)
 Q:'$D(^TMP("PXT",$J))
"RTN","GMTSPXTP",16,0)
 N GMDT,GMIFN,GMSITE,GMN0,GMN1,X,GMTSDAT,TREAT,NUM,PDT
"RTN","GMTSPXTP",17,0)
 N GMTXT,GMTSICL,DIWL,GMTAB,GMTSX,GMCKP,PNARR,GMPSITE,GMTR,PSITE
"RTN","GMTSPXTP",18,0)
 N GMTSLN,GMICL,GMTAB,COMMENT
"RTN","GMTSPXTP",19,0)
 S GMTSICL=24 ;# of blank left columns for support data of a visit
"RTN","GMTSPXTP",20,0)
 S DIWL=0 ;used in TXTFMT call & to print returned data
"RTN","GMTSPXTP",21,0)
 S GMTAB=2 ;Used to offset data from TXTFMT call after 1st line
"RTN","GMTSPXTP",22,0)
 S GMDT=0
"RTN","GMTSPXTP",23,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR
"RTN","GMTSPXTP",24,0)
 F  S GMDT=$O(^TMP("PXT",$J,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXTP",25,0)
 . S GMTR=""
"RTN","GMTSPXTP",26,0)
 . F  S GMTR=$O(^TMP("PXT",$J,GMDT,GMTR)) Q:GMTR']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXTP",27,0)
 . . S GMIFN=0
"RTN","GMTSPXTP",28,0)
 . . F  S GMIFN=$O(^TMP("PXT",$J,GMDT,GMTR,GMIFN)) Q:GMIFN'>0  D TREATDSP Q:$D(GMTSQIT)
"RTN","GMTSPXTP",29,0)
 K ^TMP("PXT",$J)
"RTN","GMTSPXTP",30,0)
 Q
"RTN","GMTSPXTP",31,0)
HDR ;Display Header
"RTN","GMTSPXTP",32,0)
 W ?2,"Date",?10,"Facility",?22,"Treatment (Qty) ; Provider Narrative",!!
"RTN","GMTSPXTP",33,0)
 Q
"RTN","GMTSPXTP",34,0)
TREATDSP ; Display treatment data
"RTN","GMTSPXTP",35,0)
 S GMN0=$G(^TMP("PXT",$J,GMDT,GMTR,GMIFN,0))
"RTN","GMTSPXTP",36,0)
 Q:GMN0']""
"RTN","GMTSPXTP",37,0)
 S GMN1=$G(^TMP("PXT",$J,GMDT,GMTR,GMIFN,1))
"RTN","GMTSPXTP",38,0)
 S GMSITE=$S($P(GMN1,U,3)]"":$E($P(GMN1,U,3),1,10),$P(GMN1,U,4)]"":$E($P(GMN1,U,4),1,10),1:"No Site")
"RTN","GMTSPXTP",39,0)
 S X=$P(GMN0,U,2)
"RTN","GMTSPXTP",40,0)
 D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXTP",41,0)
 S TREAT=$P(GMN0,U),NUM=$P(GMN0,U,3)
"RTN","GMTSPXTP",42,0)
 S PNARR=$G(^TMP("PXT",$J,GMDT,GMTR,GMIFN,"P")) S:PNARR=TREAT PNARR=""
"RTN","GMTSPXTP",43,0)
 S GMTXT=TREAT_$S(NUM]"":" ("_NUM_")",1:"")_$S(PNARR]"":"; "_PNARR,1:"")
"RTN","GMTSPXTP",44,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR
"RTN","GMTSPXTP",45,0)
 I GMTSDAT'=$G(PDT)!GMTSNPG W GMTSDAT S PDT=GMTSDAT,PSITE=""
"RTN","GMTSPXTP",46,0)
 I GMSITE'=$G(PSITE) W ?12,GMSITE S PSITE=GMSITE
"RTN","GMTSPXTP",47,0)
 D TXTFMT^GMTSPXU1(GMTXT,"",GMTSICL,GMTAB,DIWL)
"RTN","GMTSPXTP",48,0)
 I '$D(^UTILITY($J,"W")) Q
"RTN","GMTSPXTP",49,0)
 S (GMTSX,GMCKP)=0
"RTN","GMTSPXTP",50,0)
 F  S GMTSX=$O(^UTILITY($J,"W",DIWL,GMTSX)) Q:GMTSX'>0!$D(GMTSQIT)  D
"RTN","GMTSPXTP",51,0)
 . I GMCKP>0 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR W:GMTSNPG GMTSDAT,?10,GMSITE
"RTN","GMTSPXTP",52,0)
 . S GMCKP=1
"RTN","GMTSPXTP",53,0)
 . W ?GMTSICL+$S(GMTSX>1:GMTAB,1:0),$G(^UTILITY($J,"W",DIWL,GMTSX,0)),!
"RTN","GMTSPXTP",54,0)
 S COMMENT=$P($G(^TMP("PXT",$J,GMDT,GMTR,GMIFN,"COM")),U)
"RTN","GMTSPXTP",55,0)
 I COMMENT]"" S GMICL=26,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXTP",56,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXTP",57,0)
 Q
"RTN","GMTSPXTP",58,0)
FORMAT ;formats lines of text
"RTN","GMTSPXTP",59,0)
 N DIWR,DIWF,X
"RTN","GMTSPXTP",60,0)
 S DIWL=3,DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXTP",61,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXTP",62,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXTP",63,0)
 Q
"RTN","GMTSPXTP",64,0)
LINE ;writes formatted lines
"RTN","GMTSPXTP",65,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?26,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXTP",66,0)
 Q
"RTN","GMTSPXXP")
0^54^B4889825
"RTN","GMTSPXXP",1,0)
GMTSPXXP ; SLC/SBW,KER - PCE Examination Comp ; 11/02/1998
"RTN","GMTSPXXP",2,0)
 ;;2.7;Health Summary;**8,10,28**;Oct 20, 1995
"RTN","GMTSPXXP",3,0)
 ;
"RTN","GMTSPXXP",4,0)
MRE ; MOST RECENT EXAMINATION OF EACH TYPE WITHIN DATE RANGE
"RTN","GMTSPXXP",5,0)
 K ^TMP("PXE",$J)
"RTN","GMTSPXXP",6,0)
 N MAX
"RTN","GMTSPXXP",7,0)
 S MAX=1 ;This routine could be expanded to included occurrence
"RTN","GMTSPXXP",8,0)
 ;        limits by setting max to GMTSNDM and enabling occurrence
"RTN","GMTSPXXP",9,0)
 ;        limit for the component. Component name would have to 
"RTN","GMTSPXXP",10,0)
 ;        change also.
"RTN","GMTSPXXP",11,0)
 D EXAM^PXRHS05(DFN,GMTSEND,GMTSBEG,MAX)
"RTN","GMTSPXXP",12,0)
 Q:'$D(^TMP("PXE",$J))
"RTN","GMTSPXXP",13,0)
 N GMEXAM,GMDT,GMIFN,GMW,GMSITE,GMN0,GMN1,X,GMTSDAT,EXAM,RESULT
"RTN","GMTSPXXP",14,0)
 N COMMENT,GMICL,GMTAB,GMTSLN
"RTN","GMTSPXXP",15,0)
 S GMEXAM=""
"RTN","GMTSPXXP",16,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR
"RTN","GMTSPXXP",17,0)
 F  S GMEXAM=$O(^TMP("PXE",$J,GMEXAM)) Q:GMEXAM=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXXP",18,0)
 . S (GMDT,GMW)=0
"RTN","GMTSPXXP",19,0)
 . F  S GMDT=$O(^TMP("PXE",$J,GMEXAM,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXXP",20,0)
 . . S GMIFN=0
"RTN","GMTSPXXP",21,0)
 . . F  S GMIFN=$O(^TMP("PXE",$J,GMEXAM,GMDT,GMIFN)) Q:GMIFN'>0  D EXAMDSP Q:$D(GMTSQIT)
"RTN","GMTSPXXP",22,0)
 K ^TMP("PXE",$J)
"RTN","GMTSPXXP",23,0)
 Q
"RTN","GMTSPXXP",24,0)
HDR ; Header
"RTN","GMTSPXXP",25,0)
 W ?5,"Exam",?32,"Result",?47,"Date",?55,"Facility",!!
"RTN","GMTSPXXP",26,0)
 Q
"RTN","GMTSPXXP",27,0)
EXAMDSP ; Display Exam data
"RTN","GMTSPXXP",28,0)
 S GMN0=$G(^TMP("PXE",$J,GMEXAM,GMDT,GMIFN,0))
"RTN","GMTSPXXP",29,0)
 Q:GMN0']""
"RTN","GMTSPXXP",30,0)
 S GMN1=$G(^TMP("PXE",$J,GMEXAM,GMDT,GMIFN,1))
"RTN","GMTSPXXP",31,0)
 S GMSITE=$S($P(GMN1,U,3)]"":$E($P(GMN1,U,3),1,10),$P(GMN1,U,4)]"":$E($P(GMN1,U,4),1,10),1:"No Site")
"RTN","GMTSPXXP",32,0)
 S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXXP",33,0)
 S EXAM=$P(GMN0,U),RESULT=$P(GMN0,U,4)
"RTN","GMTSPXXP",34,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR W:GMW'>0!GMTSNPG EXAM
"RTN","GMTSPXXP",35,0)
 W ?32,RESULT,?45,GMTSDAT,?57,GMSITE,!
"RTN","GMTSPXXP",36,0)
 S COMMENT=$P($G(^TMP("PXE",$J,GMEXAM,GMDT,GMIFN,"COM")),U)
"RTN","GMTSPXXP",37,0)
 I COMMENT]"" S GMICL=13,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXXP",38,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXXP",39,0)
 S GMW=1
"RTN","GMTSPXXP",40,0)
 Q
"RTN","GMTSPXXP",41,0)
FORMAT ;formats line of text
"RTN","GMTSPXXP",42,0)
 N DIWR,DIWF,X
"RTN","GMTSPXXP",43,0)
 S DIWL=3,DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXXP",44,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXXP",45,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXXP",46,0)
 Q
"RTN","GMTSPXXP",47,0)
LINE ;writes formatted lines
"RTN","GMTSPXXP",48,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?13,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXXP",49,0)
 Q
"RTN","GMTSRAD")
0^55^B18600992
"RTN","GMTSRAD",1,0)
GMTSRAD ; SLC/JER,KER HIN/GJC - Radiology Request Status ; 11/02/1998
"RTN","GMTSRAD",2,0)
 ;;2.7;Health Summary;**14,28**;Oct 20, 1995
"RTN","GMTSRAD",3,0)
ENRAD ; Entry Point for HS only
"RTN","GMTSRAD",4,0)
 N MAX K ^TMP("GMTSRAD",$J)
"RTN","GMTSRAD",5,0)
 S MAX=$S(+$G(GMTSNDM)>0:GMTSNDM,1:999)
"RTN","GMTSRAD",6,0)
 I '$D(^RAO(75.1,"AS",DFN)) Q
"RTN","GMTSRAD",7,0)
 D GET
"RTN","GMTSRAD",8,0)
 I '$D(^TMP("GMTSRAD",$J)) Q
"RTN","GMTSRAD",9,0)
 D LOOP
"RTN","GMTSRAD",10,0)
 K ^TMP("GMTSRAD",$J)
"RTN","GMTSRAD",11,0)
 Q
"RTN","GMTSRAD",12,0)
GET ; Extract radiology orders
"RTN","GMTSRAD",13,0)
 N DA,DIC,DIQ,DR,GMI,GMOUT,GMP,GMRDT,GMSTAT,GMPRC,GMSDT,GMDOC S GMI=0
"RTN","GMTSRAD",14,0)
 F  S GMI=$O(^RAO(75.1,"AS",DFN,GMI)) Q:+GMI'>0!+$G(GMOUT)  D
"RTN","GMTSRAD",15,0)
 . S DA=0 F  S DA=$O(^RAO(75.1,"AS",DFN,GMI,DA)) Q:+DA'>0!+$G(GMOUT)  D
"RTN","GMTSRAD",16,0)
 . . N GMORD
"RTN","GMTSRAD",17,0)
 . . S DIC="^RAO(75.1,",DIQ="GMORD(",DIQ(0)="IE",DR="2;5;14;16;23"
"RTN","GMTSRAD",18,0)
 . . D EN^DIQ1
"RTN","GMTSRAD",19,0)
 . . S GMRDT=$G(GMORD(75.1,DA,16,"I")),GMSTAT=$G(GMORD(75.1,DA,5,"E"))
"RTN","GMTSRAD",20,0)
 . . I $S(GMRDT>GMTSEND:1,GMRDT<GMTSBEG:1,1:0) Q
"RTN","GMTSRAD",21,0)
 . . S GMPRC=$G(GMORD(75.1,DA,2,"E")),GMP=$G(GMORD(75.1,DA,2,"I"))
"RTN","GMTSRAD",22,0)
 . . S GMSDT=$G(GMORD(75.1,DA,23,"I")),GMDOC=$E($G(GMORD(75.1,DA,14,"E")),1,14)
"RTN","GMTSRAD",23,0)
 . . I $L(GMPRC)>24 S GMPRC=$$WRAP^GMTSORC(GMPRC,24)
"RTN","GMTSRAD",24,0)
 . . S GMSTAT=$E($$LOW^XLFSTR(GMSTAT))
"RTN","GMTSRAD",25,0)
 . . S ^TMP("GMTSRAD",$J,9999999-GMRDT,DA,+GMP,0)="" ; save order ien
"RTN","GMTSRAD",26,0)
 . . S ^TMP("GMTSRAD",$J,9999999-GMRDT,DA,+GMP)=GMRDT_U_GMSTAT_U_GMPRC_U_GMSDT_U_GMDOC
"RTN","GMTSRAD",27,0)
 . . D REG(DA,GMP) ; find out if registered, if parent, or ordered
"RTN","GMTSRAD",28,0)
 . . ;               procedure differs from reg'ed procedure
"RTN","GMTSRAD",29,0)
 Q
"RTN","GMTSRAD",30,0)
HDR ; Write column header
"RTN","GMTSRAD",31,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Req DT",?11,"Status",?22,"Procedure",?48,"Scheduled DT",?66,"Provider",!
"RTN","GMTSRAD",32,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSRAD",33,0)
 Q
"RTN","GMTSRAD",34,0)
LOOP ; Loops through ^TMP("GMTSRAD",$J,
"RTN","GMTSRAD",35,0)
 N GMCNT,GMI,GMORD,GMRDT,GMREC S (GMCNT,GMRDT)=0
"RTN","GMTSRAD",36,0)
 D HDR
"RTN","GMTSRAD",37,0)
 F  S GMRDT=$O(^TMP("GMTSRAD",$J,GMRDT)) Q:+GMRDT'>0!(GMCNT=MAX)  D
"RTN","GMTSRAD",38,0)
 . S GMORD=0
"RTN","GMTSRAD",39,0)
 . F  S GMORD=$O(^TMP("GMTSRAD",$J,GMRDT,GMORD)) Q:+GMORD'>0!(GMCNT=MAX)  D
"RTN","GMTSRAD",40,0)
 . . S GMI=0
"RTN","GMTSRAD",41,0)
 . . F  S GMI=$O(^TMP("GMTSRAD",$J,GMRDT,GMORD,GMI)) Q:+GMI'>0!(GMCNT=MAX)  D
"RTN","GMTSRAD",42,0)
 . . . S GMREC(0)=$G(^TMP("GMTSRAD",$J,GMRDT,GMORD,GMI,0))
"RTN","GMTSRAD",43,0)
 . . . S GMREC=$G(^TMP("GMTSRAD",$J,GMRDT,GMORD,GMI)),GMCNT=GMCNT+1 D WRT
"RTN","GMTSRAD",44,0)
 Q
"RTN","GMTSRAD",45,0)
WRT ; Write record
"RTN","GMTSRAD",46,0)
 N GMII,GMRDT1,GMSTAT,GMPRC,GMSDT,GMDOC,GMPRO,X
"RTN","GMTSRAD",47,0)
 S X=+GMREC D REGDT4^GMTSU S GMRDT1=X,GMSTAT=$P(GMREC,U,2)
"RTN","GMTSRAD",48,0)
 S GMPRC=$P(GMREC,U,3)
"RTN","GMTSRAD",49,0)
 S X=$P(GMREC,U,4) D REGDTM4^GMTSU S GMSDT=X,GMDOC=$P(GMREC,U,5)
"RTN","GMTSRAD",50,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSRAD",51,0)
 . I GMTSNPG D HDR
"RTN","GMTSRAD",52,0)
 . W GMRDT1,?13,GMSTAT W:+$G(GMREC(0)) ?17,"Ord: "
"RTN","GMTSRAD",53,0)
 . W ?22,$P(GMPRC,"|"),?48,GMSDT,?66,GMDOC,!
"RTN","GMTSRAD",54,0)
 F GMII=2:1:$L(GMPRC,"|") D
"RTN","GMTSRAD",55,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR W ?22,$P(GMPRC,"|",GMII),!
"RTN","GMTSRAD",56,0)
 I +$G(GMREC(0)) D
"RTN","GMTSRAD",57,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR
"RTN","GMTSRAD",58,0)
 . S GMRCNT=0 W ?13,"Actual: "
"RTN","GMTSRAD",59,0)
 . F  S GMRCNT=$O(^TMP("GMTSRAD",$J,GMRDT,GMORD,GMI,GMRCNT)) Q:GMRCNT'>0  D
"RTN","GMTSRAD",60,0)
 .. S GMPRO=$G(^TMP("GMTSRAD",$J,GMRDT,GMORD,GMI,GMRCNT))
"RTN","GMTSRAD",61,0)
 .. D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$P(GMPRO,"|"),!
"RTN","GMTSRAD",62,0)
 .. F GMII=2:1:$L(GMPRO,"|") D
"RTN","GMTSRAD",63,0)
 ... D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR W ?22,$P(GMPRO,"|",GMII),!
"RTN","GMTSRAD",64,0)
 ... Q
"RTN","GMTSRAD",65,0)
 .. Q
"RTN","GMTSRAD",66,0)
 . Q
"RTN","GMTSRAD",67,0)
 Q
"RTN","GMTSRAD",68,0)
 ;
"RTN","GMTSRAD",69,0)
REG(DA,GMP) ; If the order has been registered, check to see if the
"RTN","GMTSRAD",70,0)
 ; procedure ordered is a parent or if the ordered procedure differs
"RTN","GMTSRAD",71,0)
 ; from the registered procedure.
"RTN","GMTSRAD",72,0)
 ; Input: DA  -> ien of the order in file 75.1
"RTN","GMTSRAD",73,0)
 ;      : GMP -> ien of the ordered procedure
"RTN","GMTSRAD",74,0)
 Q:'$D(^RADPT("AO",DA))  ; quit if not registered
"RTN","GMTSRAD",75,0)
 N GMCNI,GMDFN,GMDTI,GMREG,GMRCNT,GMY2 S GMRCNT=0
"RTN","GMTSRAD",76,0)
 S GMDFN=+$O(^RADPT("AO",DA,0)) Q:'GMDFN
"RTN","GMTSRAD",77,0)
 S GMDTI=+$O(^RADPT("AO",DA,GMDFN,0)) Q:'GMDTI
"RTN","GMTSRAD",78,0)
 S GMY2=$G(^RADPT(GMDFN,"DT",GMDTI,0))
"RTN","GMTSRAD",79,0)
 I '$P(GMY2,"^",5) D  Q
"RTN","GMTSRAD",80,0)
 . S GMCNI=+$O(^RADPT("AO",DA,GMDFN,GMDTI,0)) Q:GMCNI'>0
"RTN","GMTSRAD",81,0)
 . D REG1(DA,GMDFN,GMDTI,GMCNI,GMP)
"RTN","GMTSRAD",82,0)
 . Q
"RTN","GMTSRAD",83,0)
 S GMCNI=0
"RTN","GMTSRAD",84,0)
 F  S GMCNI=$O(^RADPT(GMDFN,"DT",GMDTI,"P",GMCNI)) Q:GMCNI'>0  D
"RTN","GMTSRAD",85,0)
 . D REG1(DA,GMDFN,GMDTI,GMCNI,GMP)
"RTN","GMTSRAD",86,0)
 . Q
"RTN","GMTSRAD",87,0)
 Q
"RTN","GMTSRAD",88,0)
REG1(DA,GMDFN,GMDTI,GMCNI,GMP) ; Check if the ordered procedure
"RTN","GMTSRAD",89,0)
 ; differs from the registered procedure.
"RTN","GMTSRAD",90,0)
 ; Input: DA    -> Order (75.1) ien
"RTN","GMTSRAD",91,0)
 ;        GMDFN -> ien of the patient
"RTN","GMTSRAD",92,0)
 ;        GMDTI -> inv. date/time of exam
"RTN","GMTSRAD",93,0)
 ;        GMCNI -> ien of each case
"RTN","GMTSRAD",94,0)
 ;        GMP   -> ien of the procedure for the order
"RTN","GMTSRAD",95,0)
 ;
"RTN","GMTSRAD",96,0)
 ; Sets: ^TMP("GMTSRAD",$J,inv Req Entered Date/Time,order ien,proc ien
"RTN","GMTSRAD",97,0)
 ;            ,0)=1 if one of the following conditions exist:
"RTN","GMTSRAD",98,0)
 ;                    1) the procedure ordered is not the procedure
"RTN","GMTSRAD",99,0)
 ;                       registered (exam not cancelled)
"RTN","GMTSRAD",100,0)
 ;                    2) the ordered procedure is a parent and the
"RTN","GMTSRAD",101,0)
 ;                       descendent procedure(s) have been registered
"RTN","GMTSRAD",102,0)
 ;                       (exam not cancelled)
"RTN","GMTSRAD",103,0)
 ; Sets: ^TMP("GMTSRAD",$J,inv Req Entered Date/Time,order ien,proc ien
"RTN","GMTSRAD",104,0)
 ;            ,seq #)=Registered Procedure
"RTN","GMTSRAD",105,0)
 ;
"RTN","GMTSRAD",106,0)
 N GMIEN,GMPRO,GMREG S GMRCNT=GMRCNT+1
"RTN","GMTSRAD",107,0)
 S GMIEN=GMCNI_","_GMDTI_","_GMDFN_","
"RTN","GMTSRAD",108,0)
 D GETS^DIQ(70.03,GMIEN,"2;3","IE","GMREG")
"RTN","GMTSRAD",109,0)
 S GMPRO=GMREG(70.03,GMIEN,2,"E")
"RTN","GMTSRAD",110,0)
 Q:GMPRO=""  ; quit if procedure data is missing
"RTN","GMTSRAD",111,0)
 Q:GMREG(70.03,GMIEN,3,"I")=""  ; quit if exam status data missing
"RTN","GMTSRAD",112,0)
 Q:$$GET1^DIQ(72,GMREG(70.03,GMIEN,3,"I"),3,"I")=0  ; cancelled exam
"RTN","GMTSRAD",113,0)
 Q:GMP=GMREG(70.03,GMIEN,2,"I")  ; same procedure
"RTN","GMTSRAD",114,0)
 S ^TMP("GMTSRAD",$J,9999999-GMRDT,DA,+GMP,0)=1
"RTN","GMTSRAD",115,0)
 S:$L(GMPRO)>24 GMPRO=$$WRAP^GMTSORC(GMPRO,24)
"RTN","GMTSRAD",116,0)
 S ^TMP("GMTSRAD",$J,9999999-GMRDT,DA,+GMP,GMRCNT)=GMPRO
"RTN","GMTSRAD",117,0)
 Q
"RTN","GMTSRAI")
0^56^B3408435
"RTN","GMTSRAI",1,0)
GMTSRAI ; SLC/JER,KER - Radiology Impression Comp ; 11/02/1998
"RTN","GMTSRAI",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSRAI",3,0)
ENSRA ; Controls branching
"RTN","GMTSRAI",4,0)
 N GMDATA,GMTSI,GMW,MAX,TEST
"RTN","GMTSRAI",5,0)
 S MAX=$S(+$G(GMTSNDM)>0:GMTSNDM,1:999)
"RTN","GMTSRAI",6,0)
 I '$D(^RADPT(DFN,0)) Q
"RTN","GMTSRAI",7,0)
 D MAIN^GMTSRAE(1)
"RTN","GMTSRAI",8,0)
 I '$D(^TMP("RAE",$J)) Q
"RTN","GMTSRAI",9,0)
 D LOOP
"RTN","GMTSRAI",10,0)
 K ^TMP("RAE",$J)
"RTN","GMTSRAI",11,0)
 Q
"RTN","GMTSRAI",12,0)
LOOP ; Loops through ^TMP("RAE",$J,
"RTN","GMTSRAI",13,0)
 N GMW,GMIDT,GMPN,GMLN
"RTN","GMTSRAI",14,0)
 S GMIDT=0 F  S GMIDT=$O(^TMP("RAE",$J,GMIDT)) Q:GMIDT'>0  S GMPN=0 F  S GMPN=$O(^TMP("RAE",$J,GMIDT,GMPN)) Q:GMPN'>0  D WRT
"RTN","GMTSRAI",15,0)
 Q
"RTN","GMTSRAI",16,0)
WRT ; Writes component data
"RTN","GMTSRAI",17,0)
 N X,GMEDT,GMPROC,GMTSCPT,GMRSTAT,GMTXT
"RTN","GMTSRAI",18,0)
 S GMDATA=1
"RTN","GMTSRAI",19,0)
 S X=+^TMP("RAE",$J,GMIDT,GMPN,0) D REGDT4^GMTSU S GMEDT=X
"RTN","GMTSRAI",20,0)
 S GMPROC=$P(^TMP("RAE",$J,GMIDT,GMPN,0),U,2),GMRSTAT=$P(^(0),U,4),GMTSCPT=$P(^(0),U,7)
"RTN","GMTSRAI",21,0)
 I $L(GMPROC)>35 S GMPROC=$$WRAP^GMTSORC(GMPROC,35)
"RTN","GMTSRAI",22,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W GMEDT,?12,$P(GMPROC,"|"),?52,"CPT ",GMTSCPT,?62,$E(GMRSTAT,1,17),!
"RTN","GMTSRAI",23,0)
 F GMI=2:1:$L(GMPROC,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMPROC,"|",GMI)]"" ?23,$P(GMPROC,"|",GMI),!
"RTN","GMTSRAI",24,0)
 S GMTXT=0 F  S GMTXT=$O(^TMP("RAE",$J,GMIDT,GMPN,"I",GMTXT)) Q:GMTXT'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,^TMP("RAE",$J,GMIDT,GMPN,"I",GMTXT),!
"RTN","GMTSRAI",25,0)
 Q
"RTN","GMTSRAS")
0^57^B17560475
"RTN","GMTSRAS",1,0)
GMTSRAS ; SLC/JER,KER HIN/GJC - Radiology Profile Comp ; 11/02/1998
"RTN","GMTSRAS",2,0)
 ;;2.7;Health Summary;**14,25,28**;Oct 20, 1995
"RTN","GMTSRAS",3,0)
ENSRA ; Controls branching
"RTN","GMTSRAS",4,0)
 N GMDATA,GMTSI,GMW,MAX,TEST
"RTN","GMTSRAS",5,0)
 S MAX=$S(+$G(GMTSNDM)>0:GMTSNDM,1:999)
"RTN","GMTSRAS",6,0)
 I '$D(^RADPT(DFN,0)) Q
"RTN","GMTSRAS",7,0)
 D MAIN^GMTSRAE(2)
"RTN","GMTSRAS",8,0)
 I '$D(^TMP("RAE",$J)) Q
"RTN","GMTSRAS",9,0)
 D LOOP
"RTN","GMTSRAS",10,0)
 K ^TMP("RAE",$J)
"RTN","GMTSRAS",11,0)
 Q
"RTN","GMTSRAS",12,0)
LOOP ; Loops through ^TMP("RAE",$J,
"RTN","GMTSRAS",13,0)
 N GMW,GMIDT,GMPN,GMLN,GMPSET,GMXSET
"RTN","GMTSRAS",14,0)
 S GMIDT=0 F  S GMIDT=$O(^TMP("RAE",$J,GMIDT)) Q:GMIDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSRAS",15,0)
 . S GMPSET=$S($D(^TMP("RAE",$J,GMIDT,"PRINTSET")):1,1:0)
"RTN","GMTSRAS",16,0)
 . S GMXSET=$S($D(^TMP("RAE",$J,GMIDT,"EXAMSET")):1,1:0)
"RTN","GMTSRAS",17,0)
 . S GMPN=0 F  S GMPN=$O(^TMP("RAE",$J,GMIDT,GMPN)) Q:GMPN'>0  D
"RTN","GMTSRAS",18,0)
 . . D WRT
"RTN","GMTSRAS",19,0)
 . . I +$O(^TMP("RAE",$J,GMIDT,GMPN)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSRAS",20,0)
 . I +$O(^TMP("RAE",$J,GMIDT)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSRAS",21,0)
 Q
"RTN","GMTSRAS",22,0)
WRT ; Writes component data
"RTN","GMTSRAS",23,0)
 N X,GMEDT,GMI,GMPROC,GMRCPT,GMSTAT,GMTXT,GMRSTAT,GMRRAD,GMSRAD
"RTN","GMTSRAS",24,0)
 N GMTECH,GMTMP S GMDATA=1,GMTMP=$G(^TMP("RAE",$J,GMIDT,GMPN,0))
"RTN","GMTSRAS",25,0)
 S X=+GMTMP D REGDT4^GMTSU S GMEDT=X
"RTN","GMTSRAS",26,0)
 S GMPROC=$P(GMTMP,U,2),GMSTAT=$P(GMTMP,U,3)
"RTN","GMTSRAS",27,0)
 S GMRCPT=$P(GMTMP,U,7),GMTECH=$P(GMTMP,U,8)
"RTN","GMTSRAS",28,0)
 S GMRSTAT=$P(GMTMP,U,4),GMRRAD=$P(GMTMP,U,5)
"RTN","GMTSRAS",29,0)
 S GMSRAD=$P(GMTMP,U,6)
"RTN","GMTSRAS",30,0)
 I $L(GMPROC)>35 S GMPROC=$$WRAP^GMTSORC(GMPROC,35)
"RTN","GMTSRAS",31,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",32,0)
 W:'GMXSET GMEDT ; for non-examsets
"RTN","GMTSRAS",33,0)
 W:GMXSET&(GMPN=$O(^TMP("RAE",$J,GMIDT,0))) GMEDT
"RTN","GMTSRAS",34,0)
 W ?12,GMPROC,! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",35,0)
 I 'GMPSET D  ; handle output for single exams/examsets (non-printsets)
"RTN","GMTSRAS",36,0)
 . W ?12,"CPT Code: ",GMRCPT,?39,"Interpreting Staff: ",GMSRAD,!
"RTN","GMTSRAS",37,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",38,0)
 . W ?12,"Status: ",$E(GMSTAT,1,18),?39,"Interpreting Res. : ",GMRRAD,!
"RTN","GMTSRAS",39,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",40,0)
 . W ?12,"Rpt Status: ",$E(GMRSTAT,1,18),?45,"Technologist: ",GMTECH,!
"RTN","GMTSRAS",41,0)
 . I $D(^TMP("RAE",$J,GMIDT,GMPN,"M")) D MODS
"RTN","GMTSRAS",42,0)
 . Q
"RTN","GMTSRAS",43,0)
 E  D  Q  ; GMPSET=1 handle output for printsets
"RTN","GMTSRAS",44,0)
 . W ?12,"CPT Code: ",GMRCPT,?39,"Status: ",$E(GMSTAT,1,18),!
"RTN","GMTSRAS",45,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Technologist: ",GMTECH
"RTN","GMTSRAS",46,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D MODS W:'$D(^TMP("RAE",$J,GMIDT,GMPN,"M")) ! ;Line feed if no mods
"RTN","GMTSRAS",47,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",48,0)
 . I '+$O(^TMP("RAE",$J,GMIDT,GMPN)) D
"RTN","GMTSRAS",49,0)
 .. ;last case in printset display rpt status, int'g staff/resident data 
"RTN","GMTSRAS",50,0)
 .. W ?12,"Rpt Status: ",$E(GMRSTAT,1,18),!
"RTN","GMTSRAS",51,0)
 .. D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",52,0)
 .. W ?12,"Interpreting Staff: ",GMSRAD,!
"RTN","GMTSRAS",53,0)
 .. D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",54,0)
 .. W ?12,"Interpreting Res. : ",GMRRAD,!
"RTN","GMTSRAS",55,0)
 .. N GMPN S GMPN=$O(^TMP("RAE",$J,GMIDT,0)) D:GMPN RPTXT
"RTN","GMTSRAS",56,0)
 .. Q
"RTN","GMTSRAS",57,0)
 . Q
"RTN","GMTSRAS",58,0)
RPTXT ; Display word processing fields associated with a Rad/Nuc Med Report
"RTN","GMTSRAS",59,0)
 ; Such fields are Clinical History, Report Text and Impression Text.
"RTN","GMTSRAS",60,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  I $D(^TMP("RAE",$J,GMIDT,GMPN,"H")) W "History: ",! D
"RTN","GMTSRAS",61,0)
 . S GMTXT=0 F  S GMTXT=$O(^TMP("RAE",$J,GMIDT,GMPN,"H",GMTXT)) Q:GMTXT'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,^TMP("RAE",$J,GMIDT,GMPN,"H",GMTXT),!
"RTN","GMTSRAS",62,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  I $D(^TMP("RAE",$J,GMIDT,GMPN,"R")) W !,"Report: ",! D
"RTN","GMTSRAS",63,0)
 . S GMTXT=0 F  S GMTXT=$O(^TMP("RAE",$J,GMIDT,GMPN,"R",GMTXT)) Q:GMTXT'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,^TMP("RAE",$J,GMIDT,GMPN,"R",GMTXT),!
"RTN","GMTSRAS",64,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  I $D(^TMP("RAE",$J,GMIDT,GMPN,"I")) W !,"Impression: ",! D
"RTN","GMTSRAS",65,0)
 . S GMTXT=0 F  S GMTXT=$O(^TMP("RAE",$J,GMIDT,GMPN,"I",GMTXT)) Q:GMTXT'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,^TMP("RAE",$J,GMIDT,GMPN,"I",GMTXT),!
"RTN","GMTSRAS",66,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  I $D(^TMP("RAE",$J,GMIDT,GMPN,"D")) W !,"DX Codes: ",! D
"RTN","GMTSRAS",67,0)
 . S GMTXT=0 F  S GMTXT=$O(^TMP("RAE",$J,GMIDT,GMPN,"D",GMTXT)) Q:GMTXT'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,^TMP("RAE",$J,GMIDT,GMPN,"D",GMTXT),!
"RTN","GMTSRAS",68,0)
 . Q
"RTN","GMTSRAS",69,0)
 Q
"RTN","GMTSRAS",70,0)
MODS ; Display modifiers
"RTN","GMTSRAS",71,0)
 W ! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",72,0)
 W:+$G(GMPSET) ?12 W "Modifier: " S GMI=0
"RTN","GMTSRAS",73,0)
 F  S GMI=$O(^TMP("RAE",$J,GMIDT,GMPN,"M",GMI)) Q:+GMI'>0  D
"RTN","GMTSRAS",74,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",75,0)
 . W ?$S('+$G(GMPSET):10,1:22),^TMP("RAE",$J,GMIDT,GMPN,"M",GMI),!
"RTN","GMTSRAS",76,0)
 Q
"RTN","GMTSRASP")
0^58^B3989885
"RTN","GMTSRASP",1,0)
GMTSRASP ; SLC/JER,KER - Selected Radiology ; 11/02/1998
"RTN","GMTSRASP",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSRASP",3,0)
MAIN ; Controls branching
"RTN","GMTSRASP",4,0)
 N GMTSI,GMW,MAX,TEST
"RTN","GMTSRASP",5,0)
 S MAX=$S(+$G(GMTSNDM)>0:GMTSNDM,1:999)
"RTN","GMTSRASP",6,0)
 I '$D(^RADPT(DFN,0)) Q
"RTN","GMTSRASP",7,0)
 I '$O(GMTSEG(GMTSEGN,71,0)) Q
"RTN","GMTSRASP",8,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,71,GMTSI)) Q:GMTSI'>0  S TEST=GMTSEG(GMTSEGN,71,GMTSI) D MAINSEL^GMTSRAE(1,TEST),LOOP:$D(^TMP("RAE",$J))
"RTN","GMTSRASP",9,0)
 K ^TMP("RAE",$J)
"RTN","GMTSRASP",10,0)
 Q
"RTN","GMTSRASP",11,0)
LOOP ; Loops through ^TMP("RAE",$J,
"RTN","GMTSRASP",12,0)
 N GMW,GMIDT,GMPN,GMLN
"RTN","GMTSRASP",13,0)
 S GMIDT=0 F  S GMIDT=$O(^TMP("RAE",$J,GMIDT)) Q:GMIDT'>0  S GMPN=0 F  S GMPN=$O(^(GMIDT,GMPN)) Q:GMPN'>0  D WRT
"RTN","GMTSRASP",14,0)
 Q
"RTN","GMTSRASP",15,0)
WRT ; Writes component data
"RTN","GMTSRASP",16,0)
 N X,GMEDT,GMPROC,GMTSCPT,GMRSTAT,GMTXT
"RTN","GMTSRASP",17,0)
 S GMDATA=1
"RTN","GMTSRASP",18,0)
 S X=+^TMP("RAE",$J,GMIDT,GMPN,0) D REGDT4^GMTSU S GMEDT=X
"RTN","GMTSRASP",19,0)
 S GMPROC=$P(^TMP("RAE",$J,GMIDT,GMPN,0),U,2),GMRSTAT=$P(^(0),U,4),GMTSCPT=$P(^(0),U,7)
"RTN","GMTSRASP",20,0)
 I $L(GMPROC)>35 S GMPROC=$$WRAP^GMTSORC(GMPROC,35)
"RTN","GMTSRASP",21,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W GMEDT,?12,"CPT ",GMTSCPT,?23,$P(GMPROC,"|"),?63,$E(GMRSTAT,1,17),!
"RTN","GMTSRASP",22,0)
 F GMI=2:1:$L(GMPROC,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMPROC,"|",GMI)]"" ?23,$P(GMPROC,"|",GMI),!
"RTN","GMTSRASP",23,0)
 S GMTXT=0 F  S GMTXT=$O(^TMP("RAE",$J,GMIDT,GMPN,"I",GMTXT)) Q:GMTXT'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,^TMP("RAE",$J,GMIDT,GMPN,"I",GMTXT),!
"RTN","GMTSRASP",24,0)
 Q
"RTN","GMTSRO")
0^59^B22240585
"RTN","GMTSRO",1,0)
GMTSRO ; SLC/JER,KER - All Surgery Reports ; 11/02/1998
"RTN","GMTSRO",2,0)
 ;;2.7;Health Summary;**9,11,28**;Oct 20, 1995
"RTN","GMTSRO",3,0)
ENSRO ;Entry point for Surgery Only Component
"RTN","GMTSRO",4,0)
 S GMTSSO=1
"RTN","GMTSRO",5,0)
ENSR ; Entry point for SURGERY REPORT component, includes NON-OR procedures
"RTN","GMTSRO",6,0)
 N MAX,GMCOUNT,GMIDT,GMN,SURG
"RTN","GMTSRO",7,0)
 I '$D(^SRF("B",DFN)) Q
"RTN","GMTSRO",8,0)
 S MAX=999 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSRO",9,0)
 S GMN=0 F  S GMN=$O(^SRF("B",DFN,GMN)) Q:GMN'>0  D SORT
"RTN","GMTSRO",10,0)
 I '$D(SURG) Q
"RTN","GMTSRO",11,0)
 S (GMCOUNT,GMIDT)=0 F  S GMIDT=$O(SURG(GMIDT)) Q:GMIDT'>0!(GMCOUNT'<MAX)  S GMN=SURG(GMIDT) D WRT Q:$D(GMTSQIT)
"RTN","GMTSRO",12,0)
 K ^UTILITY($J,"W"),GMTSSO
"RTN","GMTSRO",13,0)
 Q
"RTN","GMTSRO",14,0)
SORT ; Sort surgeries by inverted date
"RTN","GMTSRO",15,0)
 N GMDT
"RTN","GMTSRO",16,0)
 S GMDT=$P(^SRF(GMN,0),U,9) I GMDT>GMTSBEG&(GMDT<GMTSEND) D
"RTN","GMTSRO",17,0)
 . F  Q:'$D(SURG(9999999-GMDT))  S GMDT=GMDT+.0001
"RTN","GMTSRO",18,0)
 . S SURG(9999999-GMDT)=GMN
"RTN","GMTSRO",19,0)
 Q
"RTN","GMTSRO",20,0)
WRT ; Write surgical case record
"RTN","GMTSRO",21,0)
 N X,GMI,GMDT,OPPRC,PAN,POSDX,PREDX,SPEC,STATUS,SURGEON,VER
"RTN","GMTSRO",22,0)
 N DCTDTM,TRSDTM
"RTN","GMTSRO",23,0)
 I $P($G(^SRF(GMN,"NON")),U)="Y" Q:$G(GMTSSO)  D WRT^GMTSRON Q
"RTN","GMTSRO",24,0)
 S GMCOUNT=GMCOUNT+1
"RTN","GMTSRO",25,0)
 S X=$P(^SRF(GMN,0),U,9) D REGDT4^GMTSU S GMDT=X
"RTN","GMTSRO",26,0)
 D STATUS^GMTSROB S:'$D(STATUS) STATUS="UNKNOWN"
"RTN","GMTSRO",27,0)
 S X=$P(^SRF(GMN,0),U,4) I X>0 S Y=X,C=$P(^DD(130,.04,0),U,2) D Y^DIQ S SPEC=Y K Y
"RTN","GMTSRO",28,0)
 I $L($G(SPEC))>25 S SPEC=$$WRAP^GMTSORC(SPEC,25)
"RTN","GMTSRO",29,0)
 I $D(^SRF(GMN,.1)) S X=$P(^SRF(GMN,.1),U,4) I X>0 S Y=X,C=$P(^DD(130,.14,0),U,2) D Y^DIQ S SURGEON=Y K Y
"RTN","GMTSRO",30,0)
 S X=$P($G(^SRF(GMN,.3)),U) I X>0 S Y=X,C=$P(^DD(130,.31,0),U,2) D Y^DIQ S PAN=Y K Y
"RTN","GMTSRO",31,0)
 S VER=$S($G(^SRF(GMN,"VER"))'="Y":"(Unverified)",1:"")
"RTN","GMTSRO",32,0)
 S PREDX(0)=$S($G(^SRF(GMN,33))]"":$P(^(33),U),1:"") S GMI=0 F  S GMI=$O(^SRF(GMN,14,GMI)) Q:GMI'>0  S PREDX(GMI)=$P(^SRF(GMN,14,GMI,0),U)
"RTN","GMTSRO",33,0)
 S POSDX(0)=$S($G(^SRF(GMN,34))]"":$P(^(34),U),1:"") S GMI=0 F  S GMI=$O(^SRF(GMN,15,GMI)) Q:GMI'>0  S POSDX(GMI)=$P(^SRF(GMN,15,GMI,0),U)
"RTN","GMTSRO",34,0)
 S OPPRC(0)=$P($G(^SRF(GMN,"OP")),U,1,2) S:$P(OPPRC(0),U,2)]"" $P(OPPRC(0),U,2)=$P($$CPT^ICPTCOD($P($G(^SRF(GMN,"OP")),U,2),""),U,3) D
"RTN","GMTSRO",35,0)
 . S GMI=0 F  S GMI=$O(^SRF(GMN,13,GMI)) Q:GMI'>0  S OPPRC(GMI)=$P($G(^SRF(GMN,13,GMI,0)),U)_U_$G(^SRF(GMN,13,GMI,2)) S:$P(OPPRC(GMI),U,2)]"" $P(OPPRC(GMI),U,2)=$P($$CPT^ICPTCOD($P($G(^SRF(GMN,13,GMI,2)),U),""),U,3)
"RTN","GMTSRO",36,0)
 S X=$P($G(^SRF(GMN,31)),U,6) I X>0 D REGDTM4^GMTSU S DCTDTM=X
"RTN","GMTSRO",37,0)
 S X=$P($G(^SRF(GMN,31)),U,7) I X>0 D REGDTM4^GMTSU S TRSDTM=X
"RTN","GMTSRO",38,0)
 S DIWL=0,DIWF="N"
"RTN","GMTSRO",39,0)
 K ^UTILITY($J,"W")
"RTN","GMTSRO",40,0)
 I $D(^SRF(GMN,12)) F GMI=1:1:$P(^SRF(GMN,12,0),U,4) S X=^SRF(GMN,12,GMI,0) D ^DIWP
"RTN","GMTSRO",41,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W GMDT,?21,$P($G(SPEC),"|"),?47,"Surgeon:",?56,$G(SURGEON),!
"RTN","GMTSRO",42,0)
 F GMI=2:1:$L($G(SPEC),"|") D
"RTN","GMTSRO",43,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,$P($G(SPEC),"|",GMI),!
"RTN","GMTSRO",44,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?13,"Status:",?21,STATUS,?42,"Prin. Anest.:",?56,$G(PAN),!
"RTN","GMTSRO",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?5,"Pre-op Diag(s):"
"RTN","GMTSRO",46,0)
 S GMI="" F  S GMI=$O(PREDX(GMI)) Q:GMI=""  S PREDX=$S($L(PREDX(GMI))'>58:PREDX(GMI),1:$$WRAP^GMTSORC(PREDX(GMI),58)) F GMJ=1:1:$L(PREDX,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:21,1:22),$P(PREDX,"|",GMJ) W:GMJ=1&(PREDX?1.A.E) " ",VER W !
"RTN","GMTSRO",47,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"Post-op Diag(s):"
"RTN","GMTSRO",48,0)
 S GMI="" F  S GMI=$O(POSDX(GMI)) Q:GMI=""  S POSDX=$S($L(POSDX(GMI))'>58:POSDX(GMI),1:$$WRAP^GMTSORC(POSDX(GMI),58)) F GMJ=1:1:$L(POSDX,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:21,1:22),$P(POSDX,"|",GMJ) W:GMJ=1&(POSDX?1.A.E) " ",VER W !
"RTN","GMTSRO",49,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,"Operative Proc(s):"
"RTN","GMTSRO",50,0)
 S GMI="" F  S GMI=$O(OPPRC(GMI)) Q:GMI=""  S OPPRC=$S($L($P(OPPRC(GMI),U))'>58:OPPRC(GMI),1:$$WRAP^GMTSORC($P(OPPRC(GMI),U),58)_U_$P(OPPRC(GMI),U,2)) F GMJ=1:1:$L($P(OPPRC,U),"|") D WRTPRC Q:$D(GMTSQIT)
"RTN","GMTSRO",51,0)
 I $O(^SRF(GMN,9,0)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Lab Work: YES",!
"RTN","GMTSRO",52,0)
 I $D(DCTDTM) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?5,"Dictation Time:",?22,DCTDTM
"RTN","GMTSRO",53,0)
 I $D(TRSDTM) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?40,"Transcription Time:",?61,TRSDTM
"RTN","GMTSRO",54,0)
 W:$D(DCTDTM)!($D(TRSDTM)) !
"RTN","GMTSRO",55,0)
 I $D(^UTILITY($J,"W")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Surgeon's Dictation:",! F GMI=1:1:^UTILITY($J,"W",DIWL) D CKP^GMTSUP Q:$D(GMTSQIT)  W ^UTILITY($J,"W",DIWL,GMI,0),!
"RTN","GMTSRO",56,0)
 K ^UTILITY($J,"W") W !
"RTN","GMTSRO",57,0)
 Q
"RTN","GMTSRO",58,0)
WRTPRC ; Writes operative procedures
"RTN","GMTSRO",59,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:21,1:22),$P($P(OPPRC,U),"|",GMJ) W:GMJ=1&($P(OPPRC,U,2)]"") " - ",$P(OPPRC,U,2) W !
"RTN","GMTSRO",60,0)
 Q
"RTN","GMTSROB")
0^60^B5580690
"RTN","GMTSROB",1,0)
GMTSROB ; SLC/JER,KER - Surgery Reports Brief ; 11/02/1998
"RTN","GMTSROB",2,0)
 ;;2.7;Health Summary;**9,11,28**;Oct 20, 1995
"RTN","GMTSROB",3,0)
ENSR ; Entry point for component
"RTN","GMTSROB",4,0)
 N MAX,GMCOUNT,GMIDT,GMN,SURG
"RTN","GMTSROB",5,0)
 I '$D(^SRF("B",DFN)) Q
"RTN","GMTSROB",6,0)
 S MAX=999 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSROB",7,0)
 S GMN=0 F  S GMN=$O(^SRF("B",DFN,GMN)) Q:GMN'>0  D SORT
"RTN","GMTSROB",8,0)
 I '$D(SURG) Q
"RTN","GMTSROB",9,0)
 S (GMCOUNT,GMIDT)=0 F  S GMIDT=$O(SURG(GMIDT)) Q:GMIDT'>0!(GMCOUNT'<MAX)  S GMN=SURG(GMIDT) D WRT
"RTN","GMTSROB",10,0)
 Q
"RTN","GMTSROB",11,0)
SORT ; Sort surgeries by inverted date
"RTN","GMTSROB",12,0)
 N GMDT
"RTN","GMTSROB",13,0)
 S GMDT=$P(^SRF(GMN,0),U,9) I GMDT>GMTSBEG&(GMDT<GMTSEND) D
"RTN","GMTSROB",14,0)
 . F  Q:'$D(SURG(9999999-GMDT))  S GMDT=GMDT+.0001
"RTN","GMTSROB",15,0)
 . S SURG(9999999-GMDT)=GMN
"RTN","GMTSROB",16,0)
 Q
"RTN","GMTSROB",17,0)
WRT ; Write surgical case record
"RTN","GMTSROB",18,0)
 N X,GMI,GMDT,STATUS K ^UTILITY($J,"W")
"RTN","GMTSROB",19,0)
 S GMCOUNT=GMCOUNT+1
"RTN","GMTSROB",20,0)
 S X=$P(^SRF(GMN,0),U,9) D REGDT4^GMTSU S GMDT=X
"RTN","GMTSROB",21,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W GMDT
"RTN","GMTSROB",22,0)
 D STATUS S:'$D(STATUS) STATUS="UNKNOWN"
"RTN","GMTSROB",23,0)
 S X=$P(^SRF(GMN,"OP"),"^") D FORMAT
"RTN","GMTSROB",24,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:$D(^UTILITY($J,"W",1,1,0)) ?21,^(0) W ?61,STATUS,!
"RTN","GMTSROB",25,0)
 S GMI=1 F  S GMI=$O(^UTILITY($J,"W",1,GMI)) Q:GMI'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,^UTILITY($J,"W",1,GMI,0),!
"RTN","GMTSROB",26,0)
 K ^UTILITY($J,"W")
"RTN","GMTSROB",27,0)
 S GMI=0 F  S GMI=$O(^SRF(GMN,13,GMI)) Q:GMI'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  D 
"RTN","GMTSROB",28,0)
 . S X(GMI)=$P($G(^SRF(GMN,13,GMI,0)),U) W ?21,X(GMI),!
"RTN","GMTSROB",29,0)
 Q
"RTN","GMTSROB",30,0)
STATUS ; case status
"RTN","GMTSROB",31,0)
 I $P($G(^SRF(GMN,"NON")),U)="Y" D NONORST Q
"RTN","GMTSROB",32,0)
 I $D(^SRF(GMN,30)) S STATUS=$S(+$P($G(^SRF(GMN,.2)),U,10):"(ABORTED)",1:"CANCELLED") Q
"RTN","GMTSROB",33,0)
 I +$P($G(^SRF(GMN,.2)),U,3) S STATUS="(COMPLETED)" Q
"RTN","GMTSROB",34,0)
 I +$P($G(^SRF(GMN,.2)),U,2),'(+$P(^(.2),U,3)) S STATUS="INCOMPLETE" Q
"RTN","GMTSROB",35,0)
 I +$P($G(^SRF(GMN,31)),U,4) S STATUS="SCHEDULED" Q
"RTN","GMTSROB",36,0)
 I +$G(^SRF(GMN,"REQ")),'(+$P($G(^SRF(GMN,.2)),U,2)) S STATUS="REQUESTED"
"RTN","GMTSROB",37,0)
 Q
"RTN","GMTSROB",38,0)
FORMAT ; format surgery name
"RTN","GMTSROB",39,0)
 N DIWF,DIWL,DIWR
"RTN","GMTSROB",40,0)
 S DIWF="C35R",DIWL=1,DIWR=36 D ^DIWP
"RTN","GMTSROB",41,0)
 Q
"RTN","GMTSROB",42,0)
NONORST ;Obtains status for NON-OR procedures.
"RTN","GMTSROB",43,0)
 S STATUS="UNKNOWN"
"RTN","GMTSROB",44,0)
 N GMTSNON S GMTSNON=$G(^SRF(GMN,"NON"))
"RTN","GMTSROB",45,0)
 I +$P(GMTSNON,U,5) S STATUS="(COMPLETED)" Q
"RTN","GMTSROB",46,0)
 I +$P(GMTSNON,U,4)&'+$P(GMTSNON,U,5) S STATUS="INCOMPLETE" Q
"RTN","GMTSROB",47,0)
 Q
"RTN","GMTSRON")
0^61^B18902485
"RTN","GMTSRON",1,0)
GMTSRON ; SLC/JER,KER - Surgery Reports ; 11/02/1998
"RTN","GMTSRON",2,0)
 ;;2.7;Health Summary;**11,28**;Oct 20, 1995
"RTN","GMTSRON",3,0)
ENSR ; Entry point for component
"RTN","GMTSRON",4,0)
 N MAX,GMCOUNT,GMIDT,GMJ,GMN,SURG
"RTN","GMTSRON",5,0)
 I '$D(^SRF("B",DFN)) Q
"RTN","GMTSRON",6,0)
 S MAX=999 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSRON",7,0)
 S GMN=0 F  S GMN=$O(^SRF("B",DFN,GMN)) Q:GMN'>0  D SORT
"RTN","GMTSRON",8,0)
 I '$D(SURG) Q
"RTN","GMTSRON",9,0)
 S (GMCOUNT,GMIDT)=0 F  S GMIDT=$O(SURG(GMIDT)) Q:GMIDT'>0!(GMCOUNT'<MAX)  S GMN=SURG(GMIDT) D WRT:$$CHK
"RTN","GMTSRON",10,0)
 Q
"RTN","GMTSRON",11,0)
SORT ; Sort surgeries by inverted date
"RTN","GMTSRON",12,0)
 N GMDT
"RTN","GMTSRON",13,0)
 S GMDT=$P(^SRF(GMN,0),U,9) I GMDT>GMTSBEG&(GMDT<GMTSEND) D
"RTN","GMTSRON",14,0)
 . F  Q:'$D(SURG(9999999-GMDT))  S GMDT=GMDT+.0001
"RTN","GMTSRON",15,0)
 . S SURG(9999999-GMDT)=GMN
"RTN","GMTSRON",16,0)
 Q
"RTN","GMTSRON",17,0)
WRT ; Write surgical case record
"RTN","GMTSRON",18,0)
 N X,GMI,GMDT,ICD,ICD9,OPPRC,PAN,PRDX,PROVIDER,SPEC,STATUS,VER,ATTENDNG,Y
"RTN","GMTSRON",19,0)
 I $P($G(^SRF(GMN,"NON")),U)'="Y" Q
"RTN","GMTSRON",20,0)
 S GMCOUNT=GMCOUNT+1
"RTN","GMTSRON",21,0)
NONOR ;Get NON-OR information
"RTN","GMTSRON",22,0)
 S X=$P(^SRF(GMN,"NON"),U,3) D REGDT4^GMTSU S GMDT=X
"RTN","GMTSRON",23,0)
 D STATUS^GMTSROB S:'$D(STATUS) STATUS="UNKNOWN"
"RTN","GMTSRON",24,0)
 S X=$P(^SRF(GMN,"NON"),U,8) I X>0 D
"RTN","GMTSRON",25,0)
 . S Y=X,C=$P(^DD(130,125,0),U,2) D Y^DIQ S SPEC=Y K Y
"RTN","GMTSRON",26,0)
 . I $L($G(SPEC))>25 S SPEC=$$WRAP^GMTSORC(SPEC,25)
"RTN","GMTSRON",27,0)
 S X=$P(^SRF(GMN,"NON"),U,6) I X>0 D
"RTN","GMTSRON",28,0)
 . S Y=X,C=$P(^DD(130,123,0),U,2) D Y^DIQ S PROVIDER=Y K Y
"RTN","GMTSRON",29,0)
 S X=$P(^SRF(GMN,"NON"),U,7) I X>0 D
"RTN","GMTSRON",30,0)
 . S Y=X,C=$P(^DD(130,124,0),U,2) D Y^DIQ S ATTENDNG=Y K Y
"RTN","GMTSRON",31,0)
 S X=$P($G(^SRF(GMN,.3)),U) I X>0 S Y=X,C=$P(^DD(130,.31,0),U,2) D Y^DIQ S PAN=Y K Y
"RTN","GMTSRON",32,0)
WRT1 S VER=$S($G(^SRF(GMN,"VER"))'="Y":"(Unverified)",1:"")
"RTN","GMTSRON",33,0)
 S PRDX=$S($G(^SRF(GMN,33))]"":$P(^(33),U,2),1:"")
"RTN","GMTSRON",34,0)
 S ICD9="Unknown" S ICD=$S($G(^SRF(GMN,34))]"":$P(^(34),U,2),1:"") S:ICD]"" ICD9=" (ICD9 Code: "_$P($G(^ICD9(ICD,0)),U)_")"
"RTN","GMTSRON",35,0)
 S OPPRC(0)=$P($G(^SRF(GMN,"OP")),U) S:$P(^SRF(GMN,"OP"),U,2)]"" OPPRC(0)=OPPRC(0)_" - "_$P($$CPT^ICPTCOD($P($G(^SRF(GMN,"OP")),U,2),""),U,3)_" (CPT Code: "_$P(^SRF(GMN,"OP"),U,2)_")" D
"RTN","GMTSRON",36,0)
 . S GMI=0 F  S GMI=$O(^SRF(GMN,13,GMI)) Q:GMI'>0  S OPPRC(GMI)=$P($G(^SRF(GMN,13,GMI,0)),U) D
"RTN","GMTSRON",37,0)
 . . S:$P($G(^SRF(GMN,13,GMI,2)),U)]"" OPPRC(GMI)=OPPRC(GMI)_" - "_$P($$CPT^ICPTCOD($P($G(^SRF(GMN,13,GMI,2)),U),""),U,3)_" (CPT Code: "_$P(^SRF(GMN,13,GMI,2),U)_")"
"RTN","GMTSRON",38,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W GMDT,?21,$P($G(SPEC),"|"),?47,"Provider: ",?56,$G(PROVIDER),!
"RTN","GMTSRON",39,0)
 F GMI=2:1:$L($G(SPEC),"|") D
"RTN","GMTSRON",40,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,$P($G(SPEC),"|",GMI),!
"RTN","GMTSRON",41,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?13,"Status:",?21,STATUS
"RTN","GMTSRON",42,0)
 W ?46,"Attending: ",?56,$G(ATTENDNG),!
"RTN","GMTSRON",43,0)
 W ?43,"Prin. Anest.: ",?56,$G(PAN),!
"RTN","GMTSRON",44,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Princ. Diag: " D
"RTN","GMTSRON",45,0)
 . I $L(PRDX)<40 W ?21,PRDX_ICD9,!
"RTN","GMTSRON",46,0)
 . E  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,PRDX,!,?21,ICD9,!
"RTN","GMTSRON",47,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"Proc. Performed: "
"RTN","GMTSRON",48,0)
 S GMI="" F  S GMI=$O(OPPRC(GMI)) Q:GMI=""  D
"RTN","GMTSRON",49,0)
 . S OPPRC=$S($L(OPPRC(GMI))'>55:OPPRC(GMI),1:$$WRAP^GMTSORC($P(OPPRC(GMI),U),55)) F GMJ=1:1:$L($P(OPPRC,U),"|") D WRTPRC Q:$D(GMTSQIT)
"RTN","GMTSRON",50,0)
IND S DIWL=1,DIWF="C58"
"RTN","GMTSRON",51,0)
 K ^UTILITY($J,"W")
"RTN","GMTSRON",52,0)
 I $D(^SRF(GMN,40)) F GMI=1:1:$P(^SRF(GMN,40,0),U,4) S X=^SRF(GMN,40,GMI,0) D ^DIWP
"RTN","GMTSRON",53,0)
 I $D(^UTILITY($J,"W")) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSRON",54,0)
 . W "Indication for Proc:" F GMI=1:1:^UTILITY($J,"W",DIWL) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,^UTILITY($J,"W",DIWL,GMI,0),!
"RTN","GMTSRON",55,0)
 K ^UTILITY($J,"W")
"RTN","GMTSRON",56,0)
FIND S DIWL=1,DIWF="C58"
"RTN","GMTSRON",57,0)
 I $D(^SRF(GMN,38)) F GMI=1:1:$P(^SRF(GMN,38,0),U,4) S X=^SRF(GMN,38,GMI,0) D ^DIWP
"RTN","GMTSRON",58,0)
 I $D(^UTILITY($J,"W")) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSRON",59,0)
 . W "Operative Findings :" F GMI=1:1:^UTILITY($J,"W",DIWL) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,^UTILITY($J,"W",DIWL,GMI,0),!
"RTN","GMTSRON",60,0)
 K ^UTILITY($J,"W")
"RTN","GMTSRON",61,0)
 S DIWL=0,DIWF="N"
"RTN","GMTSRON",62,0)
 I $D(^SRF(GMN,12)) F GMI=1:1:$P(^SRF(GMN,12,0),U,4) S X=^SRF(GMN,12,GMI,0) D ^DIWP
"RTN","GMTSRON",63,0)
 I $D(^UTILITY($J,"W")) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSRON",64,0)
  . W "Surgeon's Dictation:",! F GMI=1:1:(^UTILITY($J,"W",DIWL)-1) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,^UTILITY($J,"W",DIWL,GMI,0),!
"RTN","GMTSRON",65,0)
 K ^UTILITY($J,"W")
"RTN","GMTSRON",66,0)
 W !
"RTN","GMTSRON",67,0)
 Q
"RTN","GMTSRON",68,0)
WRTPRC ; Writes operative procedures
"RTN","GMTSRON",69,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?$S(GMJ=1:21,1:22),$P($P(OPPRC,U),"|",GMJ) W:GMJ=1&($P(OPPRC,U,2)]"") " - ",$P(OPPRC,U,2) W !
"RTN","GMTSRON",70,0)
 Q
"RTN","GMTSRON",71,0)
CHK() ;For selected procedures see if you have a match
"RTN","GMTSRON",72,0)
 N J,FND
"RTN","GMTSRON",73,0)
 I '$D(GMTSEG(GMTSEGN,81)) Q 1
"RTN","GMTSRON",74,0)
 S FND=0 F J=0:0 S J=$O(GMTSEG(GMTSEGN,81,J)) Q:'+J!FND  I GMTSEG(GMTSEGN,81,J)=$P($G(^SRF(GMN,"OP")),U,2) S FND=1
"RTN","GMTSRON",75,0)
 Q FND
"RTN","GMTSSCD")
0^62^B7085256
"RTN","GMTSSCD",1,0)
GMTSSCD ; HIN/JCC,SLC/SBW,KER - Spinal Cord Dysfunction ; 11/02/1998
"RTN","GMTSSCD",2,0)
 ;;2.7;Health Summary;**13,28**;Oct 20, 1995
"RTN","GMTSSCD",3,0)
MAIN ; Control branching
"RTN","GMTSSCD",4,0)
 N GMCB,GMCI,GMCOR,GMD0,GMD1,GMDATA,GMDATE,GMDCS,GMDMS,GMDTS,GMDTY
"RTN","GMTSSCD",5,0)
 N GMEP,GMET,GMHI,GMIS,GMON,GMPC,GMRS,GMWRT,X
"RTN","GMTSSCD",6,0)
 K ^TMP("SPN",$J)
"RTN","GMTSSCD",7,0)
 D EN^SPNHS0(DFN,GMTSBEG,GMTSEND,$G(GMTSNDM))
"RTN","GMTSSCD",8,0)
 Q:'$D(^TMP("SPN",$J))
"RTN","GMTSSCD",9,0)
 D WRT
"RTN","GMTSSCD",10,0)
 K ^TMP("SPN",$J)
"RTN","GMTSSCD",11,0)
 Q
"RTN","GMTSSCD",12,0)
WRT ;Print data
"RTN","GMTSSCD",13,0)
 S GMDATA=^TMP("SPN",$J,0),GMRS=$P(GMDATA,U,1),GMHI=$P(GMDATA,U,2)
"RTN","GMTSSCD",14,0)
 S GMIS=$P(GMDATA,U,3),GMCI=$P(GMDATA,U,4),GMEP=$P(GMDATA,U,5)
"RTN","GMTSSCD",15,0)
 S GMPC=$P(GMDATA,U,6),GMCOR=$P(GMDATA,U,7)
"RTN","GMTSSCD",16,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSSCD",17,0)
 W "Registration Status:",?29,GMRS,!
"RTN","GMTSSCD",18,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSSCD",19,0)
 W "Highest Level of Injury:",?29,GMHI,!
"RTN","GMTSSCD",20,0)
 ;D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSSCD",21,0)
 ;W "Information Source for SCD:",?29,GMIS,!
"RTN","GMTSSCD",22,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSSCD",23,0)
 W "Primary Care Provider:",?29,GMPC,!
"RTN","GMTSSCD",24,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSSCD",25,0)
 W "SCI/SCD Coordinator:",?29,GMCOR,!
"RTN","GMTSSCD",26,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSSCD",27,0)
 W "Completeness of Injury:",?29,GMCI,!
"RTN","GMTSSCD",28,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSSCD",29,0)
 W "Extent of Paralysis:",?29,GMEP,!
"RTN","GMTSSCD",30,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSSCD",31,0)
 S GMD0="",GMWRT=1
"RTN","GMTSSCD",32,0)
 F  S GMD0=$O(^TMP("SPN",$J,154,GMD0)) Q:GMD0=""!$D(GMTSQIT)  D
"RTN","GMTSSCD",33,0)
 . S GMDATA=^TMP("SPN",$J,154,GMD0)
"RTN","GMTSSCD",34,0)
 . S X=$P(GMDATA,U) D REGDTM4^GMTSU S GMON=X
"RTN","GMTSSCD",35,0)
 . S GMET=$P(GMDATA,U,2)
"RTN","GMTSSCD",36,0)
 . S GMCB=$P(GMDATA,U,3)
"RTN","GMTSSCD",37,0)
 . D:GMWRT HDR1
"RTN","GMTSSCD",38,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR1
"RTN","GMTSSCD",39,0)
 . W GMON,?18,GMET,?50,$E(GMCB,1,29),!
"RTN","GMTSSCD",40,0)
 . S GMWRT=0
"RTN","GMTSSCD",41,0)
 S GMD0=0,GMWRT=1
"RTN","GMTSSCD",42,0)
 F  S GMD0=$O(^TMP("SPN",$J,154.1,GMD0)) Q:GMD0'>0!$D(GMTSQIT)  D
"RTN","GMTSSCD",43,0)
 . S GMD1=0
"RTN","GMTSSCD",44,0)
 . F  S GMD1=$O(^TMP("SPN",$J,154.1,GMD0,GMD1)) Q:GMD1'>0!$D(GMTSQIT)  D
"RTN","GMTSSCD",45,0)
 . . S GMDATA=^TMP("SPN",$J,154.1,GMD0,GMD1)
"RTN","GMTSSCD",46,0)
 . . S X=$P(GMDATA,U) D REGDTM4^GMTSU S GMDATE=X
"RTN","GMTSSCD",47,0)
 . . S GMDMS=$P(GMDATA,U,2),GMDCS=$P(GMDATA,U,3),GMDTS=$P(GMDATA,U,4),GMDTY=$P(GMDATA,U,5)
"RTN","GMTSSCD",48,0)
 . . D:+GMWRT HDR2
"RTN","GMTSSCD",49,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR2
"RTN","GMTSSCD",50,0)
 . . W GMDATE,?18,GMDMS,?32,GMDCS,?50,GMDTS,?64,$E(GMDTY,1,15),!
"RTN","GMTSSCD",51,0)
 . . S GMWRT=0
"RTN","GMTSSCD",52,0)
 Q
"RTN","GMTSSCD",53,0)
HDR1 ; 1st header
"RTN","GMTSSCD",54,0)
 W:+GMTSNPG'>0 !
"RTN","GMTSSCD",55,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSSCD",56,0)
 W "Date of Onset ",?16,"Etiology ",?48,"Onset of SCD Caused by Trauma",!
"RTN","GMTSSCD",57,0)
 ;W "------------- ",?16,"-------- ",?48,"-----------------------------",!
"RTN","GMTSSCD",58,0)
 Q
"RTN","GMTSSCD",59,0)
HDR2 ; 2nd header
"RTN","GMTSSCD",60,0)
 W:+GMTSNPG'>0 !
"RTN","GMTSSCD",61,0)
 W "Date Recorded",?16,"Motor Score",?30,"Cognitive Score",?48,"Total Score",?62,"Record Type",!
"RTN","GMTSSCD",62,0)
 ;W "-------------",?16,"-----------",?30,"---------------",?48,"-----------",?62,"-----------",!
"RTN","GMTSSCD",63,0)
 Q
"RTN","GMTSSOWK")
0^72^B586621
"RTN","GMTSSOWK",1,0)
GMTSSOWK ; SLC/SBW,KER/NDBI - Social Work Comp Dvr ; 11/02/1998
"RTN","GMTSSOWK",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSSOWK",3,0)
MAIN ; Control branching
"RTN","GMTSSOWK",4,0)
 N GMTSI
"RTN","GMTSSOWK",5,0)
 K ^TMP("SOWK",$J)
"RTN","GMTSSOWK",6,0)
 ; DFN is used that currently exists is used by ^SOWKHSUM
"RTN","GMTSSOWK",7,0)
 D ^SOWKHSUM
"RTN","GMTSSOWK",8,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU)&('$D(^TMP("SOWK",$J))) SW^A7RHSM
"RTN","GMTSSOWK",9,0)
 I '$D(^TMP("SOWK",$J)) Q
"RTN","GMTSSOWK",10,0)
 S GMTSI=0
"RTN","GMTSSOWK",11,0)
 F  S GMTSI=$O(^TMP("SOWK",$J,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSSOWK",12,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W $G(^TMP("SOWK",$J,GMTSI)),!
"RTN","GMTSSOWK",13,0)
 K ^TMP("SOWK",$J)
"RTN","GMTSSOWK",14,0)
 Q
"RTN","GMTSU")
0^63^B12206941
"RTN","GMTSU",1,0)
GMTSU ; SLC/JER,KER/NDBI - Health Summary Utilities ; 11/02/1998
"RTN","GMTSU",2,0)
 ;;2.7;Health Summary;**27,28**;Oct 20, 1995
"RTN","GMTSU",3,0)
MTIM ;CONVERT TIME from X=2890313.1304 INTO X=13:04
"RTN","GMTSU",4,0)
 S X=$P(X,".",2) Q:'$L(X)
"RTN","GMTSU",5,0)
 S X=$S(X:$E(X,1,2)_$E("00",0,2-$L($E(X,1,2)))_":"_$E(X,3,4)_$E("00",0,2-$L($E(X,3,4))),1:"")
"RTN","GMTSU",6,0)
 Q
"RTN","GMTSU",7,0)
ROK(X) ; Routine OK (in UCI) (NDBI)
"RTN","GMTSU",8,0)
 S X=$G(X) Q:'$L(X) 0 Q:$L(X)>8 0 X ^%ZOSF("TEST") Q:$T 1 Q 0
"RTN","GMTSU",9,0)
NDBI(X) ; National Database Integration site 1 = yes  0 = no
"RTN","GMTSU",10,0)
 N R,G S X="A7RDUP" X ^%ZOSF("TEST") S R=$T,G=$S($D(^A7RCP):1,1:0),X=R+G,X=$S(X=2:1,1:0) Q X
"RTN","GMTSU",11,0)
REGDT ; Receives X in internal date.time, and returns X in MM/DD/YY format
"RTN","GMTSU",12,0)
 S X=$TR($$FMTE^XLFDT(X,"2DZ"),"@"," ") Q
"RTN","GMTSU",13,0)
REGDT4 ; Receives X in internal date.time, and returns X in MM/DD/YYYY format
"RTN","GMTSU",14,0)
 S X=$TR($$FMTE^XLFDT(X,"5DZ"),"@"," ") Q
"RTN","GMTSU",15,0)
REGDTM ;Receives X in internal date.time, and returns X in MM/DD/YY TT:TT
"RTN","GMTSU",16,0)
 S X=$TR($$FMTE^XLFDT(X,"2ZM"),"@"," ") Q
"RTN","GMTSU",17,0)
REGDTM4 ;Receives X in internal date.time, and returns X in MM/DD/YYYY TT:TT
"RTN","GMTSU",18,0)
 S X=$TR($$FMTE^XLFDT(X,"5ZM"),"@"," ") Q
"RTN","GMTSU",19,0)
SIDT ; Receives X as internal date/time and returns X in DD MMM YY
"RTN","GMTSU",20,0)
 N MON,MM
"RTN","GMTSU",21,0)
 S X=$P(X,".") I 'X S X="" Q
"RTN","GMTSU",22,0)
 S MON="JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC"
"RTN","GMTSU",23,0)
 S MM=$E(X,4,5),MM=$S(MM:$P(MON,U,MM),1:"")
"RTN","GMTSU",24,0)
 S X=$E(X,6,7)_" "_MM_" "_$E(X,2,3)
"RTN","GMTSU",25,0)
 Q
"RTN","GMTSU",26,0)
FMHL7DTM ; Recieves X as internal date/time and returns X in CCYYMMDDHHMM
"RTN","GMTSU",27,0)
 N T
"RTN","GMTSU",28,0)
 S T=$P(X,".",2)
"RTN","GMTSU",29,0)
 S T=$S(T:$E(T,1,2)_$E("00",0,2-$L($E(T,1,2)))_$E(T,3,4)_$E("00",0,2-$L($E(T,3,4))),1:"0000")
"RTN","GMTSU",30,0)
 S X=($E($P(X,"."),1,3)+1700)_$E($P(X,"."),4,7)_T
"RTN","GMTSU",31,0)
 Q
"RTN","GMTSU",32,0)
HL7FMDTM ; Recieves X as CCYYMMDDHHMM and returns X as internal date/time
"RTN","GMTSU",33,0)
 N DATE,TIME
"RTN","GMTSU",34,0)
 S DATE=$E(X,1,8),TIME=$E(X,9,12)
"RTN","GMTSU",35,0)
 S DATE=DATE-17000000,X=DATE_"."_TIME
"RTN","GMTSU",36,0)
 Q
"RTN","GMTSU",37,0)
DEM ; Gets Demographic Data from VADPT
"RTN","GMTSU",38,0)
 ; Receives: DFN
"RTN","GMTSU",39,0)
 ; Returns: GMTSPNM,GMTSSN,GMTSDOB,SEX,GMTSWARD,GMTSRB,GMTSAGE
"RTN","GMTSU",40,0)
 K VAHOW D OERR^VADPT
"RTN","GMTSU",41,0)
 S GMTSPNM=VADM(1)
"RTN","GMTSU",42,0)
 S GMTSSN=$S($D(VA("PID")):VA("PID"),1:$P(VADM(2),"^",2))
"RTN","GMTSU",43,0)
 S GMTSAGE=$S(+VADM(4)>0:+VADM(4),1:99),SEX=$P(VADM(5),"^")
"RTN","GMTSU",44,0)
 S GMTSWARD=$P(VAIN(4),"^",2),GMTSRB=VAIN(5)
"RTN","GMTSU",45,0)
 S X=$P(VADM(3),"^") D REGDT4 S GMTSDOB=X
"RTN","GMTSU",46,0)
 K VA
"RTN","GMTSU",47,0)
 ;Establish the information for the patient header.
"RTN","GMTSU",48,0)
 K GMTSPHDR
"RTN","GMTSU",49,0)
 N DOB,LWARDRB,NMSSN,NMSSNE,WARDRB,WARDRBE,WARDRBS
"RTN","GMTSU",50,0)
 S NMSSN=GMTSPNM_"    "_GMTSSN
"RTN","GMTSU",51,0)
 S NMSSNE=$L(NMSSN)+2
"RTN","GMTSU",52,0)
 S WARDRB=GMTSWARD_" "_GMTSRB
"RTN","GMTSU",53,0)
 S LWARDRB=$L(WARDRB)
"RTN","GMTSU",54,0)
 S WARDRBS=40-(LWARDRB/2),WARDRBE=WARDRBS+LWARDRB
"RTN","GMTSU",55,0)
 S DOB="DOB: "_GMTSDOB
"RTN","GMTSU",56,0)
 S GMTSPHDR("NMSSN")=NMSSN
"RTN","GMTSU",57,0)
 S GMTSPHDR("WARDRB")=WARDRB
"RTN","GMTSU",58,0)
 S GMTSPHDR("WARDRBS")=WARDRBS
"RTN","GMTSU",59,0)
 S GMTSPHDR("DOB")=DOB
"RTN","GMTSU",60,0)
 S GMTSPHDR("DOBS")=64
"RTN","GMTSU",61,0)
 I (NMSSNE'<WARDRBS)!(WARDRBE'<64) S GMTSPHDR("TWO")=1
"RTN","GMTSU",62,0)
 Q
"RTN","GMTSU",63,0)
NAME ; Format names ;6/30/89  11:20 ;
"RTN","GMTSU",64,0)
 ; Recieves: FILE (3 for User, 16 for Person, 6 for Provider)
"RTN","GMTSU",65,0)
 ;           IFN (Internal file # for above file),
"RTN","GMTSU",66,0)
 ;           NML (Desired length for name to be returned)
"RTN","GMTSU",67,0)
 ;           FNF (Flag to specify first name format: 0 for FI, 1 for FN)
"RTN","GMTSU",68,0)
 ; Returns: Lastname,First(name/initial) to specified length as NM
"RTN","GMTSU",69,0)
 ;
"RTN","GMTSU",70,0)
 N DIC,RAWNM,LN,FN,FA,NI,CH,X,Y
"RTN","GMTSU",71,0)
 S DIC=FILE,DIC(0)="NXZ",X=IFN D ^DIC S RAWNM=$S($D(Y(0,0)):Y(0,0),1:"UNKNOWN")
"RTN","GMTSU",72,0)
 S LN=$P(RAWNM,","),FN=$P(RAWNM,",",2)
"RTN","GMTSU",73,0)
 S FA=0 I $L(FN) F NI=1:1 S CH=$E(FN,NI) Q:CH?1A  S FA=NI
"RTN","GMTSU",74,0)
 I FA S FN=$E(FN,FA+1,$L(FN))
"RTN","GMTSU",75,0)
 I 'FNF S FN=$E(FN,1)
"RTN","GMTSU",76,0)
 S NM=$S($L(FN):LN_","_FN,1:LN),NM=$E(NM,1,NML)
"RTN","GMTSU",77,0)
 K FILE,IFN,NML,FNF
"RTN","GMTSU",78,0)
 Q
"RTN","GMTSU",79,0)
GETRANGE(FROMDATE,TODATE) ; Selection by Date Range (from and to dates)
"RTN","GMTSU",80,0)
 ;      VARIABLES LIST (OUTPUT)
"RTN","GMTSU",81,0)
 ; FROMDATE = FROM DATE
"RTN","GMTSU",82,0)
 ; TODATE = TO DATE
"RTN","GMTSU",83,0)
 N DIR,X,Y,DTOUT,DIRUT S DIR(0)="DO^:DT",DIR("A")="Enter Beginning Date (MM/DD/YY)"
"RTN","GMTSU",84,0)
 W ! D ^DIR I $D(DIROUT)!$D(DUOUT)!$D(DTOUT)!$D(DIRUT) W ! Q
"RTN","GMTSU",85,0)
 S FROMDATE=Y I +FROMDATE>0 D
"RTN","GMTSU",86,0)
 . W "  (",$$UP^XLFSTR($$FMTE^XLFDT(+FROMDATE,1)),")"
"RTN","GMTSU",87,0)
 . N DIR,X,Y
"RTN","GMTSU",88,0)
 . S DIR(0)="DO^::EX",DIR("A")="Enter Ending Date (MM/DD/YY)"
"RTN","GMTSU",89,0)
 . S DIR("B")="TODAY"
"RTN","GMTSU",90,0)
 . D ^DIR
"RTN","GMTSU",91,0)
 . I $D(DIROUT)!$D(DUOUT)!$D(DTOUT)!$D(DIRUT) K FROMDATE Q
"RTN","GMTSU",92,0)
 . I Y'>0 K FROMDATE Q
"RTN","GMTSU",93,0)
 . S TODATE=Y Q:TODATE>FROMDATE!(TODATE=FROMDATE) 
"RTN","GMTSU",94,0)
 . ; If 2nd date older than 1st date entered (Dates entered in reverse order)
"RTN","GMTSU",95,0)
 . N FRDT S FRDT=FROMDATE,FROMDATE=TODATE,TODATE=FRDT
"RTN","GMTSU",96,0)
 W !
"RTN","GMTSU",97,0)
 Q
"RTN","GMTSUP")
0^64^B16837679
"RTN","GMTSUP",1,0)
GMTSUP ; SLC/JER,KER - Utilities for Paging HS ; 11/02/1998
"RTN","GMTSUP",2,0)
 ;;2.7;Health Summary;**2,7,21,27,28**;Oct 20, 1995
"RTN","GMTSUP",3,0)
 ;
"RTN","GMTSUP",4,0)
CKP ; Check page position, pause and prompt
"RTN","GMTSUP",5,0)
 Q:$D(GMTSQIT)
"RTN","GMTSUP",6,0)
 S GMTSNPG=0
"RTN","GMTSUP",7,0)
 I $G(GMTSWRIT)=1 D
"RTN","GMTSUP",8,0)
 . D BREAK
"RTN","GMTSUP",9,0)
 . S GMTSWRIT=0
"RTN","GMTSUP",10,0)
 I IOT="HFS" D BREAK:(GMTSEGN'=$G(GMTSLCMP)) Q
"RTN","GMTSUP",11,0)
 Q:+$G(GMTSLPG)'>0&($Y'>(IOSL-GMTSLO))
"RTN","GMTSUP",12,0)
 I $E(IOST,1)="C" S:'$D(GMTSTOF) GMTSTOF=1 D CKP1
"RTN","GMTSUP",13,0)
 I '$D(GMTSQIT) W @IOF D HEADER,BREAK S GMTSNPG=1,GMTSTOF=GMTSEGN
"RTN","GMTSUP",14,0)
 I $D(GMTSQIT),(GMTSQIT]""),($D(GMTSTYP)) W @IOF D HEADER S GMTSTOF=GMTSEGN
"RTN","GMTSUP",15,0)
 Q
"RTN","GMTSUP",16,0)
CKP1 ;Help Display of Optional Components for Navigation
"RTN","GMTSUP",17,0)
 N DA,I,J,K,L,X,XQORM,Y,GMTSY,TYP,DIC
"RTN","GMTSUP",18,0)
 I $S('$D(GMTSTYP):1,$D(GMTOPT):1,1:0) N DIR S DIR(0)="E" D ^DIR K DIR S:$D(DUOUT)!(GMTSLPG) GMTSQIT="" Q
"RTN","GMTSUP",19,0)
 S TYP=GMTSTYP
"RTN","GMTSUP",20,0)
 S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION" D ^DIC S GMTSTYP=+Y K DIC,X,Y
"RTN","GMTSUP",21,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="1AF\+",XQORM("A")="Press <RET> to continue, ^ to exit, or select component: "
"RTN","GMTSUP",22,0)
 S XQORM("??")="D HELP^GMTSUP1" I GMTSLPG W "* END * "
"RTN","GMTSUP",23,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""T"")"
"RTN","GMTSUP",24,0)
 D ^XQORM W ! D @$S(Y=1:"BRNCH",1:"EVAL")
"RTN","GMTSUP",25,0)
 I $D(GMTSY),(GMTSY=0) K GMTSY G CKP1
"RTN","GMTSUP",26,0)
 S GMTSTYP=TYP
"RTN","GMTSUP",27,0)
 Q
"RTN","GMTSUP",28,0)
BREAK ; Writes the component header
"RTN","GMTSUP",29,0)
 S:'$D(GMTSLCMP) GMTSLCMP=0
"RTN","GMTSUP",30,0)
 S GMTS="",GMTSNPG=1,$P(GMTS,"-",79-$L(GMTSEGH_GMTSEGL)/2)="",GMTS=GMTS_" "_GMTSEGH_GMTSEGL_" "_GMTS I $Y'>(IOSL-GMTSLO)!(IOT="HFS") W !,GMTS,! W:$Y'>(IOSL-GMTSLO) ?34,$S(GMTSEGN=GMTSLCMP:"(continued)",1:""),! S GMTSLCMP=GMTSEGN
"RTN","GMTSUP",31,0)
 Q
"RTN","GMTSUP",32,0)
HEADER ; Print Running Header
"RTN","GMTSUP",33,0)
 N GMTSVDT,DATA
"RTN","GMTSUP",34,0)
 ; GMTSCDT(0) may contain multiple dates that could cause a line to
"RTN","GMTSUP",35,0)
 ; wrap inappropriately. If this creates a problem, a change will be
"RTN","GMTSUP",36,0)
 ; required to accommodate it.
"RTN","GMTSUP",37,0)
 S DATA=""
"RTN","GMTSUP",38,0)
 I +$G(GMTSPXD1)&+$G(GMTSPXD2) D
"RTN","GMTSUP",39,0)
 . S DATA="Printed for data "
"RTN","GMTSUP",40,0)
 . I GMTSPXD1=GMTSPXD2 S DATA=DATA_"on "_GMTSPXD1 Q
"RTN","GMTSUP",41,0)
 . S DATA=DATA_"from "_GMTSPXD2_" to "_GMTSPXD1
"RTN","GMTSUP",42,0)
 I $D(GMTSCDT(0)) S GMTSVDT=GMTSCDT(0) S:GMTSDTM'["Printed:" GMTSDTM="Printed: "_GMTSDTM
"RTN","GMTSUP",43,0)
 W !,$S($L($P($G(GMTSSC),U,2)):"Location: "_$P(GMTSSC,U,2)_" ",1:""),$S($D(GMTSVDT):GMTSVDT,1:""),DATA,?(79-$L(GMTSDTM)),GMTSDTM
"RTN","GMTSUP",44,0)
 S:'$D(GMTSPG) GMTSPG=0 S GMTSPG=GMTSPG+1,GMTSHDR=" CONFIDENTIAL "_GMTSTITL_" SUMMARY "_$S($E(IOST,1)="C":"",1:"  pg. "_GMTSPG) S GMTS="",$P(GMTS,"*",(77-$L(GMTSHDR))\2)="*" S GMTSHDR=GMTS_" "_GMTSHDR_" "_GMTS
"RTN","GMTSUP",45,0)
 W !,GMTSHDR,"*"
"RTN","GMTSUP",46,0)
 I '$D(GMTSLFG) D
"RTN","GMTSUP",47,0)
 . ;GMTSPHDR (patient header) is setup in DEM^GMTSU.
"RTN","GMTSUP",48,0)
 . I $G(GMTSPHDR("TWO")) D
"RTN","GMTSUP",49,0)
 .. W !,GMTSPHDR("NMSSN"),?GMTSPHDR("DOBS"),GMTSPHDR("DOB"),!?GMTSPHDR("WARDRBS"),GMTSPHDR("WARDRB"),!
"RTN","GMTSUP",50,0)
 . E  W !,GMTSPHDR("NMSSN"),?GMTSPHDR("WARDRBS"),GMTSPHDR("WARDRB"),?GMTSPHDR("DOBS"),GMTSPHDR("DOB"),!
"RTN","GMTSUP",51,0)
 W:+$G(VADM(6)) ?26,"** DECEASED   "_$P(VADM(6),U,2)_" **"
"RTN","GMTSUP",52,0)
 Q
"RTN","GMTSUP",53,0)
BRNCH ;Checks for appropriate abbreviation to branch to a different component
"RTN","GMTSUP",54,0)
 N GMTINX,LIM,CREC,SBS
"RTN","GMTSUP",55,0)
 I Y,("+-"[X) S:X="-" GMTSEGN=GMTSTOF-1 S (GMTSY,GMTSQIT)=1,GMTSLPG=0 Q
"RTN","GMTSUP",56,0)
 I X="^^" S DIROUT=1,GMTSQIT="" Q
"RTN","GMTSUP",57,0)
 I Y,(X?1"^^".E) D  Q
"RTN","GMTSUP",58,0)
 .N GMTSAV
"RTN","GMTSUP",59,0)
 .S GMTSAV=X D RJUMP^GMTSUP1
"RTN","GMTSUP",60,0)
 .I GMTSAV'["?" S (GMTSQIT,GMTSY)=1,GMTSEGN=GMTSTOF-1,GMTSLPG=0
"RTN","GMTSUP",61,0)
 .E  S GMTSY=0
"RTN","GMTSUP",62,0)
 S GMTINX=$S($D(^GMT(142,GMTSTYP,1,+Y(1),0)):$P(^(0),U,2),1:"")
"RTN","GMTSUP",63,0)
 I 'GMTINX S GMTSY=0 Q
"RTN","GMTSUP",64,0)
 I '$D(GMTSEGI(GMTINX)) N GMI,GMJ,GMTSDFLT S GMI=1,GMJ=GMTSEGC,GMTSDFLT=1 D LOAD^GMTSADH S GMTSEGC=GMTSEGC+1
"RTN","GMTSUP",65,0)
 I '$D(GMTSEGI(GMTINX)) S GMTINX="",GMTSY=0 Q
"RTN","GMTSUP",66,0)
 S LIM=$P(Y(1),U,4) I LIM'["=" G NOLIM
"RTN","GMTSUP",67,0)
 S CREC=^GMT(142.1,GMTINX,0),SBS=GMTSEGI(GMTINX) D CMPLIM^GMTSADH2
"RTN","GMTSUP",68,0)
 I $D(DIROUT) S GMTSQIT="" Q
"RTN","GMTSUP",69,0)
NOLIM S GMTSEGN=GMTSEGI(GMTINX)-1,(GMTSY,GMTSQIT)=1,GMTSLPG=0
"RTN","GMTSUP",70,0)
 Q
"RTN","GMTSUP",71,0)
 ;
"RTN","GMTSUP",72,0)
EVAL ; Evaluate input to determine quit or continue
"RTN","GMTSUP",73,0)
 Q:'$D(X)
"RTN","GMTSUP",74,0)
 S:$D(DTOUT) DIROUT=1 I $S(X="^^":1,GMTSLPG:1,$D(DIROUT):1,X="^":1,1:0) S GMTSQIT=""
"RTN","GMTSUP",75,0)
 I +$G(GMPSAP),(X="^") S GMDUOUT=1
"RTN","GMTSUP",76,0)
 Q
"RTN","GMTSUP1")
0^65^B20015279
"RTN","GMTSUP1",1,0)
GMTSUP1 ; SLC/JER,KER - Utilities for Paging HS ; 11/02/1998
"RTN","GMTSUP1",2,0)
 ;;2.7;Health Summary;**28**;Oct 20, 1995
"RTN","GMTSUP1",3,0)
RJUMP ; Set-up and call to XQOR for "^^"-jump
"RTN","GMTSUP1",4,0)
 N GMDFN,GMTS,GMTSLO,GMTSPNM,GMTSRB,GMTSWARD,GMTSDOB,GMTSLPG,GMTSDTM,ORVP,XQOR
"RTN","GMTSUP1",5,0)
 N GMTSSN,GMTS0,GMTS1,GMTS2,GMTSTIM,GMTSEGN,GMTSEGH,GMTSEGL,GMTSHDR,XQORM
"RTN","GMTSUP1",6,0)
 N GMTSNPG,GMTSPG,GMTSQIT,GMTSX,GMTSLOC,GMTSTOF,GMTSQ,GMTSTYP,GMTSTITL,GMTSEG
"RTN","GMTSUP1",7,0)
 N GMTSEGC,LRDFN,TYP
"RTN","GMTSUP1",8,0)
 I $S('$L($T(EN^OR2)):1,$$VERSION^XPDUTL("OR")<2.2:1,1:0) W !,"OE/RR version 2 must be installed.",! H 1 G RETURN
"RTN","GMTSUP1",9,0)
 I $S('$D(DFN):1,DFN'>0:1,1:0) N GMP S GMTSX=X D SELPT^GMTS S DFN=+($G(GMP(1))) G:DFN'>0 RETURN S X=GMTSX
"RTN","GMTSUP1",10,0)
 S X=$P(X,U,3),ORVP=DFN_";DPT(",GMDFN=DFN
"RTN","GMTSUP1",11,0)
 D EN^OR2
"RTN","GMTSUP1",12,0)
RETURN S:$D(GMDFN) DFN=GMDFN W:$G(GMTSAV)'["?" !,">>>  Returning to Health Summary",! H 1
"RTN","GMTSUP1",13,0)
 Q
"RTN","GMTSUP1",14,0)
HELP ; Offers help to confused individuals
"RTN","GMTSUP1",15,0)
 N GMQUIT
"RTN","GMTSUP1",16,0)
 W @IOF
"RTN","GMTSUP1",17,0)
 I X="?",GMTSTYP=TYP W "These components have been selected for Ad Hoc.",! S FLG=1 D LIST K FLG Q:$D(DTOUT)  D HELP1 W ! Q
"RTN","GMTSUP1",18,0)
 I X="?",GMTSTYP'=TYP W "These components are part of ",GMTSTITL," Health Summary Type",!,"or have been temporarily added.  Added components are indicated by *.",! S FLG=2 D LIST K FLG Q:$D(DTOUT)  D HELP1 W ! Q
"RTN","GMTSUP1",19,0)
 I X="??" W "These components may be temporarily added (use ""=C"" to change limits)." D DISP^XQORM1 W !!
"RTN","GMTSUP1",20,0)
 I X="???" D HELP2
"RTN","GMTSUP1",21,0)
 Q
"RTN","GMTSUP1",22,0)
HELP1 ; Writes part of help prompt
"RTN","GMTSUP1",23,0)
 D SCRNLNTH Q:$D(GMQUIT)  W !!
"RTN","GMTSUP1",24,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "To leave display order and jump to a different component, select any component",!
"RTN","GMTSUP1",25,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "from the  above list,  or select  any additional  component to  be temporarily",!
"RTN","GMTSUP1",26,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "added  to the display.   Add ""=C"" to  component to change  limits or selection",!
"RTN","GMTSUP1",27,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "items.  EXAMPLE: LO=C",!!
"RTN","GMTSUP1",28,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "Enter: ??    to see additional components.",!
"RTN","GMTSUP1",29,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?7,"???   to see HELP for ""^^""-jump.",!
"RTN","GMTSUP1",30,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?7,"<RET> to continue display.",!
"RTN","GMTSUP1",31,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?7,"+     to proceed to next component.",!
"RTN","GMTSUP1",32,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?7,"-     to return to preceeding component.",!
"RTN","GMTSUP1",33,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?7,"^     to quit present patient's summary.",!
"RTN","GMTSUP1",34,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?7,"^^    to quit and return to menu.",!!
"RTN","GMTSUP1",35,0)
 Q
"RTN","GMTSUP1",36,0)
HELP2 ; Help for "^^"-jump
"RTN","GMTSUP1",37,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?22,"Navigation OUTSIDE of Health Summary",!!
"RTN","GMTSUP1",38,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "You may also enter ""^^"" followed by the name, partial name or synonym for",!
"RTN","GMTSUP1",39,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "any of a  variety of options  OUTSIDE of Health Summary  to which you can",!
"RTN","GMTSUP1",40,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "jump.  Partial matches will allow you to select from a subset of options.",!!
"RTN","GMTSUP1",41,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "For example:  ^^?    will list ALL available options.",!
"RTN","GMTSUP1",42,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?14,"^^PN   will show you all of the PROGRESS NOTES options, or",!
"RTN","GMTSUP1",43,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?14,"^^OR   will show you all of the ORDER ENTRY options.",!!
"RTN","GMTSUP1",44,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "You may also  order a wide variety of LABORATORY tests using this syntax.",!
"RTN","GMTSUP1",45,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "e.g., ^^CHEM 7 will allow you to ADD an order for that test.",!!
"RTN","GMTSUP1",46,0)
 Q
"RTN","GMTSUP1",47,0)
LIST ; List components
"RTN","GMTSUP1",48,0)
 N GMI,DUOUT
"RTN","GMTSUP1",49,0)
 S GMI=0 F  S GMI=$O(GMTSEG(GMI)) Q:GMI'>0  D SCRNLNTH Q:$D(DUOUT)!($D(DTOUT))  D LIST1 Q:$D(DUOUT)!($D(DTOUT))
"RTN","GMTSUP1",50,0)
 Q
"RTN","GMTSUP1",51,0)
SCRNLNTH ; Checks screen length
"RTN","GMTSUP1",52,0)
 N DIR
"RTN","GMTSUP1",53,0)
 Q:$Y'>(IOSL-4)
"RTN","GMTSUP1",54,0)
 S DIR(0)="E"
"RTN","GMTSUP1",55,0)
 D ^DIR I $S($D(DUOUT):1,$D(DTOUT):1,1:0) S GMQUIT=""
"RTN","GMTSUP1",56,0)
 W:'$D(GMQUIT) @IOF
"RTN","GMTSUP1",57,0)
 Q
"RTN","GMTSUP1",58,0)
LIST1 ; Lists component information
"RTN","GMTSUP1",59,0)
 N CREC S CREC=^GMT(142.1,$P(GMTSEG(GMI),U,2),0)
"RTN","GMTSUP1",60,0)
 W:GMI#2 ! W ?$S(GMI#2:0,1:40) D:FLG=2 STAR W $P(CREC,U,4),?$S(GMI#2:8,1:48),$E($S($L($P(GMTSEG(GMI),U,5)):$P(GMTSEG(GMI),U,5),$L($P(CREC,U,9)):$P(CREC,U,9),1:$P(CREC,U)),1,24)
"RTN","GMTSUP1",61,0)
 Q
"RTN","GMTSUP1",62,0)
STAR ; Writes * to indicate added component when called by GMTSUP
"RTN","GMTSUP1",63,0)
 ; for HST other than AD HOC
"RTN","GMTSUP1",64,0)
 W $S($D(^GMT(142,TYP,1,"C",$P(GMTSEG(GMI),U,2))):" ",1:"*")
"RTN","GMTSUP1",65,0)
 Q
"RTN","GMTSVS")
0^66^B27423067
"RTN","GMTSVS",1,0)
GMTSVS ; SLC/TRS,KER/HIN/FT - Vital Signs Component ; 11/02/1998
"RTN","GMTSVS",2,0)
 ;;2.7;Health Summary;**8,20,28**;Oct 20, 1995
"RTN","GMTSVS",3,0)
 ;
"RTN","GMTSVS",4,0)
 ; This routine was modified by Frank Traxler@Hines CIOFO to print
"RTN","GMTSVS",5,0)
 ; new values, Body Mass Index (BMI) which will be computed, 
"RTN","GMTSVS",6,0)
 ; Central Venous Pressure (CVP), Circumference/Girth (CG) and
"RTN","GMTSVS",7,0)
 ; Pulse Oximetry (POx), if Vitals/Measurements v4.0 is installed.
"RTN","GMTSVS",8,0)
 ;
"RTN","GMTSVS",9,0)
OUTPAT ;Outpatient Vital Signs main control
"RTN","GMTSVS",10,0)
 N GMRVSTR
"RTN","GMTSVS",11,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSVS",12,0)
 E  S CNTR=100
"RTN","GMTSVS",13,0)
 K ^UTILITY($J,"GMRVD"),ARRAY
"RTN","GMTSVS",14,0)
 S T1=GMTSEND,T2=GMTSBEG,END=0
"RTN","GMTSVS",15,0)
 S TN=0,LF=0,GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG",GMRVSTR(0)=T2_"^"_T1_"^"_CNTR_"^"_1
"RTN","GMTSVS",16,0)
 S GMRVSTR("LT")="^C^" ;Set to only get Vital Sign for Clinics
"RTN","GMTSVS",17,0)
 D EN1^GMRVUT0
"RTN","GMTSVS",18,0)
 ;If no data, display message and get most recent inpatient measurements
"RTN","GMTSVS",19,0)
 I '$D(^UTILITY($J,"GMRVD")) D  Q
"RTN","GMTSVS",20,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "*** No Outpatient measurements ***",!
"RTN","GMTSVS",21,0)
 . S GMTSNDM=1
"RTN","GMTSVS",22,0)
 . D ENVS
"RTN","GMTSVS",23,0)
 D OUT,OUT5:GMTSVMVR>3,KILLVS Q
"RTN","GMTSVS",24,0)
ENVS ;SET UP FOR EXTRACTION ROUTINE
"RTN","GMTSVS",25,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSVS",26,0)
 E  S CNTR=100
"RTN","GMTSVS",27,0)
 K ^UTILITY($J,"GMRVD"),ARRAY
"RTN","GMTSVS",28,0)
 S T1=GMTSEND,T2=GMTSBEG,END=0
"RTN","GMTSVS",29,0)
 S TN=0,LF=0,GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG",GMRVSTR(0)=T2_"^"_T1_"^"_CNTR_"^"_1
"RTN","GMTSVS",30,0)
 D EN1^GMRVUT0
"RTN","GMTSVS",31,0)
 I '$D(^UTILITY($J,"GMRVD")) D KILLVS Q
"RTN","GMTSVS",32,0)
 D OUT,OUT5:GMTSVMVR>3,KILLVS Q
"RTN","GMTSVS",33,0)
OUT ;OUT-PUT
"RTN","GMTSVS",34,0)
 N GMW,GMTSCCNT,GMTSCTL
"RTN","GMTSVS",35,0)
 S CNTR("HOLDER")=CNTR
"RTN","GMTSVS",36,0)
 S GMTSVMVR=$$VERSION^XPDUTL("GMRV") ;get vitals package version #
"RTN","GMTSVS",37,0)
 I GMTSVMVR'>3 D  Q:$D(GMTSQIT)
"RTN","GMTSVS",38,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT",?20,"TEMP",?29,"PULSE",?36,"RESP",?45,"BP",?55,"HT",?68,"WT",!
"RTN","GMTSVS",39,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,"F(C)",?55,"IN(CM)",?68,"LB(KG)",!
"RTN","GMTSVS",40,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,"----",?29,"-----",?36,"----",?45,"--",?55,"------",?68,"------",!!
"RTN","GMTSVS",41,0)
 .Q
"RTN","GMTSVS",42,0)
 I GMTSVMVR>3 D  Q:$D(GMTSQIT)
"RTN","GMTSVS",43,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT",?18,"TEMP",?30,"PULSE",?37,"RESP",?42,"BP",?51,"HT",?62,"WT",!
"RTN","GMTSVS",44,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W ?18,"F(C)",?51,"IN(CM)",?62,"LB(KG)[BMI]",!
"RTN","GMTSVS",45,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W ?18,"----",?30,"-----",?37,"----",?42,"--",?51,"------",?62,"-----------",!!
"RTN","GMTSVS",46,0)
 .Q
"RTN","GMTSVS",47,0)
 S GMTSCCNT=0,GMT="" F  S GMT=$O(^UTILITY($J,"GMRVD",GMT)) Q:GMT<0!(GMT="")!(END=1)  D OUT1,OUT4
"RTN","GMTSVS",48,0)
 W:GMTSCCNT=0 "No data",!
"RTN","GMTSVS",49,0)
 Q
"RTN","GMTSVS",50,0)
OUT1 S (GMTSCTL,GMTSVT)="" F  S GMTSVT=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT)) Q:GMTSVT=""  S IEN=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT,0)) D OUT3
"RTN","GMTSVS",51,0)
 Q
"RTN","GMTSVS",52,0)
OUT3 S GMTSVS=^UTILITY($J,"GMRVD",GMT,GMTSVT,IEN)
"RTN","GMTSVS",53,0)
 S X=$P(GMTSVS,U,1) D REGDT4^GMTSU S TDT=X
"RTN","GMTSVS",54,0)
 S X=$P(GMTSVS,U,1) D MTIM^GMTSU S TI=X
"RTN","GMTSVS",55,0)
 S TDT=TDT_" "_TI
"RTN","GMTSVS",56,0)
 ; 1     2      3     4   5     6       7         8
"RTN","GMTSVS",57,0)
 ;DATE^TEMP()^PULSE^RESPT^BP^HEIGHT()^WEIGHT()^CONTROL
"RTN","GMTSVS",58,0)
 S $P(ARRAY,U,1)=TDT
"RTN","GMTSVS",59,0)
 S GMTAB=$S(GMTSVT="T":2,GMTSVT="P":3,GMTSVT="R":4,GMTSVT="BP":5,GMTSVT="HT":6,GMTSVT="WT":7,1:0)
"RTN","GMTSVS",60,0)
 I GMTAB="2"!(GMTAB="6")!(GMTAB="7") S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)_"("_$P(GMTSVS,U,13)_")"
"RTN","GMTSVS",61,0)
 E  S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",62,0)
 I GMTAB=7,$P(GMTSVS,U,14)]"" S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"["_$P(GMTSVS,U,14)_"]"
"RTN","GMTSVS",63,0)
 S:GMTAB>1 GMTSCTL=GMTSCTL_$P(ARRAY,U,GMTAB),$P(ARRAY,U,8)=GMTSCTL
"RTN","GMTSVS",64,0)
 Q
"RTN","GMTSVS",65,0)
OUT4 ;
"RTN","GMTSVS",66,0)
 Q:$P($G(ARRAY),U,8)=""  S GMTSCCNT=$G(GMTSCCNT)+1
"RTN","GMTSVS",67,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",68,0)
 I GMTSVMVR'>3 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?37,$P(ARRAY,U,4),?42,$P(ARRAY,U,5),?54,$P(ARRAY,U,6),?67,$P(ARRAY,U,7),!
"RTN","GMTSVS",69,0)
 I GMTSVMVR>3 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?37,$P(ARRAY,U,4),?42,$P(ARRAY,U,5),?51,$P(ARRAY,U,6),?62,$P(ARRAY,U,7),!
"RTN","GMTSVS",70,0)
 S CNTR=CNTR-1 I CNTR=0 S END=1
"RTN","GMTSVS",71,0)
 K ARRAY
"RTN","GMTSVS",72,0)
 Q
"RTN","GMTSVS",73,0)
OUT5 ; display new v/m that came out with V/M v4.0
"RTN","GMTSVS",74,0)
 N GMW,GMTSCCNT,GMTSCTL S (GMTSCCNT,END)=0,CNTR=CNTR("HOLDER")
"RTN","GMTSVS",75,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",76,0)
 W !,"Measurement DT",?18,"CVP",?30,"PO2",?42,"CG"
"RTN","GMTSVS",77,0)
 W !,?18,"CMH20(MMHG)",?30,"(L/MIN)(%)",?42,"IN(CM)",!,?18,"-----------",?30,"----------",?42,"------",!!
"RTN","GMTSVS",78,0)
 S GMT="" F  S GMT=$O(^UTILITY($J,"GMRVD",GMT)) Q:GMT<0!(GMT="")!(END=1)  D OUT6,OUT8
"RTN","GMTSVS",79,0)
 W:GMTSCCNT=0 "No data",!
"RTN","GMTSVS",80,0)
 Q
"RTN","GMTSVS",81,0)
OUT6 S (GMTSCTL,GMTSVT)="" F  S GMTSVT=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT)) Q:GMTSVT=""  S IEN=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT,0)) D OUT7
"RTN","GMTSVS",82,0)
 Q
"RTN","GMTSVS",83,0)
OUT7 S GMTSVS=^UTILITY($J,"GMRVD",GMT,GMTSVT,IEN)
"RTN","GMTSVS",84,0)
 S X=$P(GMTSVS,U,1) D REGDT4^GMTSU S TDT=X
"RTN","GMTSVS",85,0)
 S X=$P(GMTSVS,U,1) D MTIM^GMTSU S TI=X
"RTN","GMTSVS",86,0)
 S TDT=TDT_" "_TI
"RTN","GMTSVS",87,0)
 S $P(ARRAY,U,1)=TDT
"RTN","GMTSVS",88,0)
 S GMTAB=$S(GMTSVT="CVP":2,GMTSVT="PO2":3,GMTSVT="CG":4,1:0)
"RTN","GMTSVS",89,0)
 S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",90,0)
 I GMTAB=2 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"("_$P(GMTSVS,U,13)_")"
"RTN","GMTSVS",91,0)
 I GMTAB=3 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"("_$P(GMTSVS,U,15)_")("_$P(GMTSVS,U,16)_")"
"RTN","GMTSVS",92,0)
 I GMTAB=4 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"("_$P(GMTSVS,U,13)_")"_$S($P(GMTSVS,U,17)]"":"["_$P(GMTSVS,U,17)_"]",1:"")
"RTN","GMTSVS",93,0)
 S:GMTAB>1 GMTSCTL=$G(GMTSCTL)_$P($G(ARRAY),U,GMTAB),$P(ARRAY,U,5)=GMTSCTL
"RTN","GMTSVS",94,0)
 Q
"RTN","GMTSVS",95,0)
OUT8 ;
"RTN","GMTSVS",96,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",97,0)
 I GMTSNPG=1 D
"RTN","GMTSVS",98,0)
 .W !,"Measurement DT",?18,"CVP",?30,"PO2",?42,"CG"
"RTN","GMTSVS",99,0)
 .W !,?18,"CMH20(MMHG)",?30,"(L/MIN)(%)",?42,"IN(CM)",!,?18,"-----------",?30,"----------",?42,"------",!!
"RTN","GMTSVS",100,0)
 .Q
"RTN","GMTSVS",101,0)
 Q:$P($G(ARRAY),U,5)=""  S GMTSCCNT=$G(GMTSCCNT)+1
"RTN","GMTSVS",102,0)
 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?42,$P(ARRAY,U,4),!
"RTN","GMTSVS",103,0)
 S CNTR=CNTR-1 I CNTR=0 S END=1
"RTN","GMTSVS",104,0)
 K ARRAY
"RTN","GMTSVS",105,0)
 Q
"RTN","GMTSVS",106,0)
KILLVS ;Kills variables
"RTN","GMTSVS",107,0)
 K CNTR,T1,T2,TDT,TI,END,TN,IEN,LF,GMTSVMVR,GMTSVS,GMTSVT,GMT,ARRAY,GMTAB,X
"RTN","GMTSVS",108,0)
 K ^UTILITY($J,"GMRVD")
"RTN","GMTSVS",109,0)
 Q
"RTN","GMTSVSS")
0^67^B40369683
"RTN","GMTSVSS",1,0)
GMTSVSS ; SLC/TRS,KER/HIN/FT - Selected Vital Signs ; 11/02/1998
"RTN","GMTSVSS",2,0)
 ;;2.7;Health Summary;**8,20,28**;Oct 20, 1995
"RTN","GMTSVSS",3,0)
 ; 
"RTN","GMTSVSS",4,0)
 ; This routine was modified by Frank Traxler@Hines CIOFO for changes
"RTN","GMTSVSS",5,0)
 ; made in V/M v4.0. The Health Summary will print Body Mass Index (BMI)
"RTN","GMTSVSS",6,0)
 ; which will be computed whenever WEIGHT is selected, Central Venous
"RTN","GMTSVSS",7,0)
 ; Pressure (CVP), Circumference/Girth (CG) and Pulse Oximetry (POx).
"RTN","GMTSVSS",8,0)
 ;
"RTN","GMTSVSS",9,0)
OUTPAT ; Outpatient Select Vitals Signs Main control
"RTN","GMTSVSS",10,0)
 N CNT,COL,COLL,HDR,GMTSDA,GMTSDT,GMTSF,GMTSI,GMW,GMRVSTR,LOOP,MAX,ROW,WIDTH
"RTN","GMTSVSS",11,0)
 K ^UTILITY($J,"GMRVD")
"RTN","GMTSVSS",12,0)
 I $D(GMTSNDM),GMTSNDM>0 S MAX=GMTSNDM
"RTN","GMTSVSS",13,0)
 E  S MAX=100
"RTN","GMTSVSS",14,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,120.51,GMTSI)) Q:GMTSI'>0  S GMTSDA=GMTSEG(GMTSEGN,120.51,GMTSI) D BLDSTR
"RTN","GMTSVSS",15,0)
 I '$D(GMRVSTR) Q
"RTN","GMTSVSS",16,0)
 S GMRVSTR(0)=GMTSBEG_U_GMTSEND_U_MAX_U_1
"RTN","GMTSVSS",17,0)
 S GMRVSTR("LT")="^C^" ;Set to only get Vital Sign for Clinics
"RTN","GMTSVSS",18,0)
 D BLDHDR,EN1^GMRVUT0
"RTN","GMTSVSS",19,0)
 ; If no data, display message and get most recent inpatient measurements
"RTN","GMTSVSS",20,0)
 I '$D(^UTILITY($J,"GMRVD")) D  Q
"RTN","GMTSVSS",21,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W "*** No Outpatient measurements ***",!
"RTN","GMTSVSS",22,0)
 .S GMTSNDM=1
"RTN","GMTSVSS",23,0)
 .D ENVS
"RTN","GMTSVSS",24,0)
 .Q
"RTN","GMTSVSS",25,0)
 S ROW=1 D NXTROW
"RTN","GMTSVSS",26,0)
 D WRTHDR,WRTHDR1
"RTN","GMTSVSS",27,0)
 S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",28,0)
 I $O(COL(ROW)) F ROW=2:1 Q:'$D(COL(ROW))!($D(GMTSQIT))  D
"RTN","GMTSVSS",29,0)
 .D NXTROW
"RTN","GMTSVSS",30,0)
 .W !! D WRTHDR,WRTHDR1
"RTN","GMTSVSS",31,0)
 .S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",32,0)
 .Q
"RTN","GMTSVSS",33,0)
 K ^UTILITY($J,"GMRVD"),GMTSVMVR
"RTN","GMTSVSS",34,0)
 Q
"RTN","GMTSVSS",35,0)
ENVS ; Set up for extraction routine
"RTN","GMTSVSS",36,0)
 N CNT,COL,COLL,HDR,HDR1,GMTSDA,GMTSDT,GMTSF,GMTSI,GMW,LOOP,MAX,ROW,WIDTH
"RTN","GMTSVSS",37,0)
 K ^UTILITY($J,"GMRVD")
"RTN","GMTSVSS",38,0)
 I $D(GMTSNDM),GMTSNDM>0 S MAX=GMTSNDM
"RTN","GMTSVSS",39,0)
 E  S MAX=100
"RTN","GMTSVSS",40,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,120.51,GMTSI)) Q:GMTSI'>0  S GMTSDA=GMTSEG(GMTSEGN,120.51,GMTSI) D BLDSTR
"RTN","GMTSVSS",41,0)
 I '$D(GMRVSTR) Q
"RTN","GMTSVSS",42,0)
 S GMRVSTR(0)=GMTSBEG_U_GMTSEND_U_MAX_U_1
"RTN","GMTSVSS",43,0)
 D BLDHDR,EN1^GMRVUT0
"RTN","GMTSVSS",44,0)
 I '$D(^UTILITY($J,"GMRVD")) Q
"RTN","GMTSVSS",45,0)
 S ROW=1 D NXTROW
"RTN","GMTSVSS",46,0)
 D WRTHDR,WRTHDR1
"RTN","GMTSVSS",47,0)
 S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",48,0)
 I $O(COL(ROW)) F ROW=2:1 Q:'$D(COL(ROW))!($D(GMTSQIT))  D
"RTN","GMTSVSS",49,0)
 .D NXTROW
"RTN","GMTSVSS",50,0)
 .W !! D WRTHDR,WRTHDR1
"RTN","GMTSVSS",51,0)
 .S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",52,0)
 .Q
"RTN","GMTSVSS",53,0)
 K ^UTILITY($J,"GMRVD"),GMTSVMVR
"RTN","GMTSVSS",54,0)
 Q
"RTN","GMTSVSS",55,0)
BLDSTR ; Builds GMRVSTR string for extract call
"RTN","GMTSVSS",56,0)
 N DA,DIC,DIQ,DR,VIT
"RTN","GMTSVSS",57,0)
 S GMTSVMVR=+$$VERSION^XPDUTL("GMRV") ;get vitals package version #
"RTN","GMTSVSS",58,0)
 S DIQ="VIT(",DIQ(0)="E",DIC=120.51,DR="1",DA=GMTSDA
"RTN","GMTSVSS",59,0)
 D EN^DIQ1 S VIT=VIT(120.51,DA,1,"E")
"RTN","GMTSVSS",60,0)
 S GMRVSTR=$S($D(GMRVSTR):GMRVSTR_";"_VIT,1:VIT)
"RTN","GMTSVSS",61,0)
 Q
"RTN","GMTSVSS",62,0)
BLDHDR ; Builds the HDR array
"RTN","GMTSVSS",63,0)
 N ABB,GMTSI S COL=18
"RTN","GMTSVSS",64,0)
 F GMTSI=1:1:$L(GMRVSTR,";") D
"RTN","GMTSVSS",65,0)
 .S (HDR(GMTSI-1),ABB)=$P(GMRVSTR,";",GMTSI)
"RTN","GMTSVSS",66,0)
 .S HDR(GMTSI-1)=HDR(GMTSI-1)_U
"RTN","GMTSVSS",67,0)
 .S HDR(GMTSI-1)=HDR(GMTSI-1)_$S(ABB="BP":"BP",ABB="HT":"HEIGHT",ABB="WT":"WEIGHT",ABB="P":"PULSE",ABB="R":"RESP",ABB="T":"TEMP",1:ABB)
"RTN","GMTSVSS",68,0)
 .S WIDTH=$S($P(HDR(GMTSI-1),U)="T":13,$P(HDR(GMTSI-1),U)="P":7,$P(HDR(GMTSI-1),U)="R":6,$P(HDR(GMTSI-1),U)="WT":20,$P(HDR(GMTSI-1),U)="CG":20,1:12)
"RTN","GMTSVSS",69,0)
 .S COLL=$P(COL,U,GMTSI)+WIDTH
"RTN","GMTSVSS",70,0)
 .S COL=COL_U
"RTN","GMTSVSS",71,0)
 .S COL=COL_COLL
"RTN","GMTSVSS",72,0)
 .S HDR(GMTSI-1)=HDR(GMTSI-1)_U_COLL_U_WIDTH
"RTN","GMTSVSS",73,0)
 .Q
"RTN","GMTSVSS",74,0)
 S ROW=1,COL(ROW)=18,COLL=18,CNT=0
"RTN","GMTSVSS",75,0)
 F LOOP=0:1 Q:'$D(HDR(LOOP))  D
"RTN","GMTSVSS",76,0)
 .I $P(HDR(LOOP),U,4)+COLL'>80 D  Q
"RTN","GMTSVSS",77,0)
 ..S COLL=$P(HDR(LOOP),U,4)+COLL
"RTN","GMTSVSS",78,0)
 ..S COL(ROW)=COL(ROW)_U_COLL
"RTN","GMTSVSS",79,0)
 ..S HDR1(ROW,CNT)=HDR(LOOP)
"RTN","GMTSVSS",80,0)
 ..S CNT=CNT+1
"RTN","GMTSVSS",81,0)
 ..K HDR(LOOP)
"RTN","GMTSVSS",82,0)
 ..Q
"RTN","GMTSVSS",83,0)
 .S ROW=ROW+1,COL(ROW)=18,COLL=18,CNT=0
"RTN","GMTSVSS",84,0)
 .S COLL=$P(HDR(LOOP),U,4)+COLL
"RTN","GMTSVSS",85,0)
 .S COL(ROW)=COL(ROW)_U_COLL
"RTN","GMTSVSS",86,0)
 .S HDR1(ROW,CNT)=HDR(LOOP)
"RTN","GMTSVSS",87,0)
 .S CNT=CNT+1
"RTN","GMTSVSS",88,0)
 .K HDR(LOOP)
"RTN","GMTSVSS",89,0)
 .Q
"RTN","GMTSVSS",90,0)
 Q
"RTN","GMTSVSS",91,0)
WRTHDR ; Writes Header
"RTN","GMTSVSS",92,0)
 N GMI
"RTN","GMTSVSS",93,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT"
"RTN","GMTSVSS",94,0)
 I GMTSVMVR'>3 F GMI=0:1:5 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  D
"RTN","GMTSVSS",95,0)
 .W ?$P(COL,U,GMI+1),$P(HDR(GMI),U,2)
"RTN","GMTSVSS",96,0)
 .Q
"RTN","GMTSVSS",97,0)
 I GMTSVMVR>3 S GMI="" F  S GMI=$O(HDR(GMI)) Q:(GMI="")  Q:('$D(HDR(GMI)))!($D(GMTSQIT))  D CKP^GMTSUP D
"RTN","GMTSVSS",98,0)
 .W ?$P(COL,U,GMI+1),$P(HDR(GMI),U,2)
"RTN","GMTSVSS",99,0)
 .Q
"RTN","GMTSVSS",100,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",101,0)
 Q
"RTN","GMTSVSS",102,0)
WRTHDR1 ;Writes 2nd line of header
"RTN","GMTSVSS",103,0)
 N GMI
"RTN","GMTSVSS",104,0)
 I GMTSVMVR'>3 F GMI=0:1:5 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  D
"RTN","GMTSVSS",105,0)
 .I $P(HDR(GMI),U)="HT" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",106,0)
 .I $P(HDR(GMI),U)="WT" W ?$P(COL,U,GMI+1),"LB(KG)"
"RTN","GMTSVSS",107,0)
 .I $P(HDR(GMI),U)="T" W ?$P(COL,U,GMI+1),"F(C)"
"RTN","GMTSVSS",108,0)
 .Q
"RTN","GMTSVSS",109,0)
 I GMTSVMVR>3 S GMI="" F  S GMI=$O(HDR(GMI)) Q:(GMI="")  Q:('$D(HDR(GMI)))!($D(GMTSQIT))  D CKP^GMTSUP D
"RTN","GMTSVSS",110,0)
 .I $P(HDR(GMI),U)="HT" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",111,0)
 .I $P(HDR(GMI),U)="WT" W ?$P(COL,U,GMI+1),"LB(KG)[BMI]"
"RTN","GMTSVSS",112,0)
 .I $P(HDR(GMI),U)="T" W ?$P(COL,U,GMI+1),"F(C)"
"RTN","GMTSVSS",113,0)
 .I $P(HDR(GMI),U)="CVP" W ?$P(COL,U,GMI+1),"CMH20(MMHG)"
"RTN","GMTSVSS",114,0)
 .I $P(HDR(GMI),U)="PO2" W ?$P(COL,U,GMI+1),"(L/MIN)(%)"
"RTN","GMTSVSS",115,0)
 .I $P(HDR(GMI),U)="CG" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",116,0)
 .Q
"RTN","GMTSVSS",117,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!
"RTN","GMTSVSS",118,0)
 Q
"RTN","GMTSVSS",119,0)
WRT ; Writes vitals record for one observation time
"RTN","GMTSVSS",120,0)
 N GMLEN,GMTSBMI,GMTSI,GMTDT,GMTSVI,GMTSVT,GMTSMET,GMTSPERC,GMTSLMIN,GMTSQUAL,IEN,X
"RTN","GMTSVSS",121,0)
 S GMTSVI="",X=9999999-GMTSDT D REGDTM4^GMTSU S GMTDT=X
"RTN","GMTSVSS",122,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR,WRTHDR1 W GMTDT
"RTN","GMTSVSS",123,0)
 I GMTSVMVR'>3 F GMTSI=0:1:5 S GMTSVI=$O(HDR(GMTSVI)) Q:GMTSVI=""!($D(GMTSQIT))  D
"RTN","GMTSVSS",124,0)
 .S GMTSVT=$P(HDR(GMTSVI),U),IEN=$O(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,0))
"RTN","GMTSVSS",125,0)
 .I +IEN D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSVSS",126,0)
 ..W ?$P(COL,U,GMTSI+1),$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,8)
"RTN","GMTSVSS",127,0)
 ..S GMTSMET=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,13) I GMTSMET'="" W "("_$P(^(+IEN),U,13)_")"
"RTN","GMTSVSS",128,0)
 ..Q
"RTN","GMTSVSS",129,0)
 .Q
"RTN","GMTSVSS",130,0)
 I GMTSVMVR>3 F GMTSI=0:1 S GMTSVI=$O(HDR(GMTSVI)) Q:GMTSVI=""!($D(GMTSQIT))  D
"RTN","GMTSVSS",131,0)
 .S GMTSVT=$P(HDR(GMTSVI),U),IEN=$O(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,0))
"RTN","GMTSVSS",132,0)
 .I +IEN D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSVSS",133,0)
 ..W ?$P(COL,U,GMTSI+1),$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,8)
"RTN","GMTSVSS",134,0)
 ..S GMTSMET=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,13,17)
"RTN","GMTSVSS",135,0)
 ..S GMTSLMIN=$P(GMTSMET,U,3),GMTSPERC=$P(GMTSMET,U,4)
"RTN","GMTSVSS",136,0)
 ..S GMTSQUAL=$P(GMTSMET,U,5) S:GMTSQUAL]"" GMTSQUAL=$E(GMTSQUAL,1,5)
"RTN","GMTSVSS",137,0)
 ..S GMTSBMI=$P(GMTSMET,U,2),GMTSMET=$P(GMTSMET,U,1)
"RTN","GMTSVSS",138,0)
 ..I GMTSMET'="" W "("_GMTSMET_")" ;centigrade/kilos/centimeters
"RTN","GMTSVSS",139,0)
 ..I GMTSBMI'="" W "["_GMTSBMI_"]" ;body mass index
"RTN","GMTSVSS",140,0)
 ..I GMTSLMIN'="" W "["_GMTSLMIN_"]" ;liters/min supplemental O2
"RTN","GMTSVSS",141,0)
 ..I GMTSPERC'="" W "["_GMTSPERC_"]" ;% supplemental O2
"RTN","GMTSVSS",142,0)
 ..I GMTSVT="CG",GMTSQUAL]"" W "["_GMTSQUAL_"]" ;qualifiers
"RTN","GMTSVSS",143,0)
 ..Q
"RTN","GMTSVSS",144,0)
 .Q
"RTN","GMTSVSS",145,0)
 Q
"RTN","GMTSVSS",146,0)
NXTROW ; get the next row of vital signs
"RTN","GMTSVSS",147,0)
 Q:$G(ROW)'>0
"RTN","GMTSVSS",148,0)
 K HDR
"RTN","GMTSVSS",149,0)
 S %X="HDR1(ROW,",%Y="HDR(" D %XY^%RCR
"RTN","GMTSVSS",150,0)
 S COL=COL(ROW)
"RTN","GMTSVSS",151,0)
 K %X,%Y
"RTN","GMTSVSS",152,0)
 Q
"VER")
8.0^21.0
**END**
**END**
