$TXT Created by ORMSBY,SKIP at FM22-PATCH.FO-OAKLAND.MED.VA.GOV  (KIDS) on Friday, 04/28/06 at 10:14
=============================================================================
Run Date: MAY 15, 2006                     Designation: DI*22*147
Package : DI - VA FILEMAN                     Priority: Mandatory
Version : 22       SEQ #131                     Status: Released
                  Compliance Date: JUN 15, 2006
=============================================================================

Associated patches: (v)DI*22*8     <<= must be installed BEFORE `DI*22*147'
                    (v)DI*22*11    <<= must be installed BEFORE `DI*22*147'
                    (v)DI*22*56    <<= must be installed BEFORE `DI*22*147'
                    (v)DI*22*129   <<= must be installed BEFORE `DI*22*147'

Subject: Lock TimeOuts & Cache v5

Category: 
  - Routine

Description:
============

 ** Notice: See "Installation Instructions" section for Installation
            Warning **
  
 This patch corrects the following issue:
 With Cache v5, ECP data channel(s) were introduced that in turn caused
 the time out for a Lock to behave differently than it did in Cache v4 
 using DCP data channel(s).  The following is from Intersystems problem 
 ticket:
  
  Problem No: 634127
  Open Date: 14 Mar 2006 Open Time: 05:38PM
  Advisor: Thomas Salander
  Product: Cache 5.0.18
  End User: VA CIOFO Oakland
  Application Provider: Hewlett-Packard Company 
  Classification: Programming
  
 "With DCP a timed lock always waited for a response from the server 
 regardless of the length of the timeout. At times when the server was slow
 or the network was slow, a L^X:1 may actually take significantly longer
 than 1 second to complete because the local process always waited for a
 response."
  
 "With ECP the timeout is more strictly observed. Short timeouts can, 
 depending on the network load and server load, timeout before receiving a
 response. I believe this is the origin of the suggestion to increase the
 length of the timeout."
  
 VA FileMan will now use lock times outs based upon if ^DD("DILOCKTM") 
 exists.  If it exists then ^DD("DILOCKTM") value will be used.  On the
 other hand, if ^DD("DILOCKTM") does not exist, then the value will be 1.  
 Post install Routine, DI147POS, will use the value in ^DD("OS"), the
 Internal Entry Number(IEN) of the entry in the MUMPS OPERATING SYSTEM
 FILE(#.7) to determine what the value should be.  If the NAME(#.01)
 contains CACHE, then the value will be 3.  Cache sites should NEVER 
 modify this value to less than 3!
  
 Documentation Changes
 =====================
 Supported API
 =============
 LOCK^DILF()
 The purpose is to lock a global reference using VA FileMan's Lock time 
 out value(DILOCKTM).
 Format:
 LOCK^DILF(resolved global reference)
 Input:
 RESOLVED GLOBAL REFERENCE - (Required)This is the fully resolved global
 reference.
 Output:
 $Truth value - 1 equals lock obtained; 0 equals lock failed
 Example:
 >S REF="^MYFILE(123,1,0)"
 >D LOCK^DILF(REF)
 >W $T
 1
 >W DILOCKTM
 3
  
 Blood Bank Clearance
 ====================
 Clearance - Apr 28, 2006
 EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch DI*22*147 contains 
 changes to a package referenced in VHA OI SEPG SOP 192-023 Review of 
 VISTA Patches for Effects on VISTA Blood Bank Software. This patch does 
 not alter or modify any VistA Blood Bank software design safeguards or 
 safety critical elements functions.
  
 RISK ANALYSIS: Changes made by patch DI*22*147 have no effect on Blood 
 Bank software functionality, therefore RISK is none.
  
 Remedy Ticket
 =============
 129984 - Primary
  111079; 111799; 136190; 136250; 136340; 142304
  
 Thanks to Test Site 
 ====================
 BRONX, NY                   
 CLARKSBURG, WV  
 FRESNO, CA  
 LAS VEGAS, NV 
 LOMA LINDA, CA 
 MINNEAPOLIS, MN
 NORTHERN CALIFORNIA HCS
 PUGET SOUND HCS
 SAN DIEGO, CA 
 VA GREATER LOS ANGELES HCS
 WHITE RIVER JUNCTION, VT 
  
 Routine Summary
 ===============
 CHECK^XTSUMBLD results: 
   
   Routine Name   Before Patch    After Patch     Patch List 
   ============   ============    ===========     ==========
   DDS10          2626414         2667334         147
   DI147POS       *NEW*           189310          147
   DIA2           3778793         3804898         147
   DICA3          1604228         1644260         147
   DICN0          4213076         4305927         31,48,56,147
   DIEF1          9263233         9297659         11,147
   DIEFW          3100237         3124597         1,8,147
   DIENVWRN       2617370         3205436         147
   DIET           3560691         3666685         69,49,104,129,147
   DILF           2130649         2353909         147
  
 CHECK1^XTSUMBLD 
 ===============
  See the "Routine Information" section for details.  The "B" in front of 
 the checksum denotes that the value was derived by using CHECK1^XTSUMBLD.
  
 Installation Instructions:
 =========================
 ** Although queuing of this patch is allowed, it is HIGHLY recommended 
 that ALL Users be off the system and VISTA Background jobs be STOPPED 
 before this patch is installed. Failure to do so may result in 'source 
 routine edited' errors during a database update. Edits may be lost and 
 records may be left in an inconsistent state. An error that occurs before 
 a cross-reference is executed, for example, may lead to corrupted data or 
 hard errors in the future. **
  
 The following installation instructions are based upon the premise that 
 the installer has heeded the above warning.
  
 Installation should take less than a minute.
  
      1.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This 
 option will load the KIDS package onto your system.
  
      2.  The patch has now been loaded into a transport global on your 
 system. You now need to use KIDS to install the transport global.
  
      3.  On the KIDS menu, under the 'Installation' menu, use the 
 following options:
  
            Print Transport Global
            Compare Transport Global to Current System
            Verify Checksums in Transport Global
            Backup a Transport Global
  
      4.  In accordance with the warning at the beginning of the 
 installation instructions, make sure ALL interactive processes, and ALL 
 non-interactive background jobs are stopped following your site specific 
 procedures.  NOT performing this step could result in 'source routine
 edited' errors during database updates, and records may be left in an
 inconsistent state.
  
      5.  On the KIDS menu, under the 'Installation' menu, use the 
 following option:
  
            Select Installation Option: Install Package(s)
            Select INSTALL NAME: DI*22.0*147
                                 ===========
  
 The Environment Check Routine DIENVWRN runs automatically during this
 step. DIENVWRN issues a warning if it appears that TaskMan is still 
 running or logons have not been inhibited.
  
            Answer 'YES' to 'Want KIDS to INHIBIT LOGONs during the 
 install?'
            Answer 'NO' to 'Want to DISABLE Scheduled Options, Menu 
 Options, and Protocols?
  
      6.  Reenable all processes stopped in step 4 above.

Routine Information:
====================
The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: DDS10
    Before:  B9389024  After:  B9505384  **147**
Routine Name: DI147POS
    Before:       n/a  After:   B223949  **147**
Routine Name: DIA2
    Before:  B5563345  After:  B5595456  **147**
Routine Name: DICA3
    Before:  B3530796  After:  B3603882  **147**
Routine Name: DICN0
    Before: B14094599  After: B14460486  **31,48,56,147**
Routine Name: DIEF1
    Before: B37372124  After: B37487550  **11,147**
Routine Name: DIEFW
    Before:  B5919700  After:  B5964760  **1,8,147**
Routine Name: DIENVWRN
    Before:  B3680036  After:  B5804254  **147**
Routine Name: DIET
    Before:  B6605913  After:  B6774952  **69,49,104,129,147**
Routine Name: DILF
    Before:  B7130763  After:  B8456514  **147**

=============================================================================
User Information:
Entered By  : ORMSBY,SKIP                   Date Entered  : MAR 16, 2006
Completed By: SINGH,GURBIR                  Date Completed: MAY 12, 2006
Released By : HARROD,PAUL                   Date Released : MAY 15, 2006
=============================================================================


Packman Mail Message:
=====================

$END TXT
