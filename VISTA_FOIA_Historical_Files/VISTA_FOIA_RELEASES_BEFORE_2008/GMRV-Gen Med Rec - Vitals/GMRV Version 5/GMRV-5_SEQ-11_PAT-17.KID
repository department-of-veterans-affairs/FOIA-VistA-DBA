EMERGENCY Released GMRV*5*17 SEQ #11
Extracted from mail message
**KIDS**:GMRV*5.0*17^

**INSTALL NAME**
GMRV*5.0*17
"BLD",5866,0)
GMRV*5.0*17^GEN. MED. REC. - VITALS^0^3060417^y
"BLD",5866,1,0)
^^1^1^3051130^
"BLD",5866,1,1,0)
HL7 MESSAGE CHANGES
"BLD",5866,4,0)
^9.64PA^^
"BLD",5866,6.3)
6
"BLD",5866,"KRN",0)
^9.67PA^8989.52^19
"BLD",5866,"KRN",.4,0)
.4
"BLD",5866,"KRN",.401,0)
.401
"BLD",5866,"KRN",.402,0)
.402
"BLD",5866,"KRN",.403,0)
.403
"BLD",5866,"KRN",.5,0)
.5
"BLD",5866,"KRN",.84,0)
.84
"BLD",5866,"KRN",3.6,0)
3.6
"BLD",5866,"KRN",3.8,0)
3.8
"BLD",5866,"KRN",9.2,0)
9.2
"BLD",5866,"KRN",9.8,0)
9.8
"BLD",5866,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5866,"KRN",9.8,"NM",1,0)
GMVVDEF1^^0^49050672
"BLD",5866,"KRN",9.8,"NM",2,0)
GMVHDR^^0^11333254
"BLD",5866,"KRN",9.8,"NM","B","GMVHDR",2)

"BLD",5866,"KRN",9.8,"NM","B","GMVVDEF1",1)

"BLD",5866,"KRN",19,0)
19
"BLD",5866,"KRN",19.1,0)
19.1
"BLD",5866,"KRN",101,0)
101
"BLD",5866,"KRN",409.61,0)
409.61
"BLD",5866,"KRN",771,0)
771
"BLD",5866,"KRN",870,0)
870
"BLD",5866,"KRN",8989.51,0)
8989.51
"BLD",5866,"KRN",8989.52,0)
8989.52
"BLD",5866,"KRN",8994,0)
8994
"BLD",5866,"KRN","B",.4,.4)

"BLD",5866,"KRN","B",.401,.401)

"BLD",5866,"KRN","B",.402,.402)

"BLD",5866,"KRN","B",.403,.403)

"BLD",5866,"KRN","B",.5,.5)

"BLD",5866,"KRN","B",.84,.84)

"BLD",5866,"KRN","B",3.6,3.6)

"BLD",5866,"KRN","B",3.8,3.8)

"BLD",5866,"KRN","B",9.2,9.2)

"BLD",5866,"KRN","B",9.8,9.8)

"BLD",5866,"KRN","B",19,19)

"BLD",5866,"KRN","B",19.1,19.1)

"BLD",5866,"KRN","B",101,101)

"BLD",5866,"KRN","B",409.61,409.61)

"BLD",5866,"KRN","B",771,771)

"BLD",5866,"KRN","B",870,870)

"BLD",5866,"KRN","B",8989.51,8989.51)

"BLD",5866,"KRN","B",8989.52,8989.52)

"BLD",5866,"KRN","B",8994,8994)

"BLD",5866,"QUES",0)
^9.62^^
"BLD",5866,"REQB",0)
^9.611^2^2
"BLD",5866,"REQB",1,0)
GMRV*5.0*2^1
"BLD",5866,"REQB",2,0)
GMRV*5.0*12^1
"BLD",5866,"REQB","B","GMRV*5.0*12",2)

"BLD",5866,"REQB","B","GMRV*5.0*2",1)

"MBREQ")
0
"PKG",44,-1)
1^1
"PKG",44,0)
GEN. MED. REC. - VITALS^GMRV^Vitals/Measurements Module of General Medical Record.
"PKG",44,20,0)
^9.402P^^
"PKG",44,22,0)
^9.49I^1^1
"PKG",44,22,1,0)
5.0^3021029
"PKG",44,22,1,"PAH",1,0)
17^3060417
"PKG",44,22,1,"PAH",1,1,0)
^^1^1^3060417
"PKG",44,22,1,"PAH",1,1,1,0)
HL7 MESSAGE CHANGES
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMVHDR")
0^2^B11333254^B10470656
"RTN","GMVHDR",1,0)
GMVHDR ;HIOFO/FT-HEALTH DATA REPOSITORY API ;10/21/04  13:03
"RTN","GMVHDR",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**2,17**;Oct 31, 2002
"RTN","GMVHDR",3,0)
 ;11/30/2005 KAM/BAY Remedy Call 121661 changes for HL7 message
"RTN","GMVHDR",4,0)
 ;
"RTN","GMVHDR",5,0)
 ; This routine uses the following IAs:
"RTN","GMVHDR",6,0)
 ; <None>
"RTN","GMVHDR",7,0)
 ;
"RTN","GMVHDR",8,0)
 ; This routine supports the following IAs:
"RTN","GMVHDR",9,0)
 ; EN - #4583           (Private)
"RTN","GMVHDR",10,0)
 ;
"RTN","GMVHDR",11,0)
EN(GMVIEN) ; This function returns a string containing the values
"RTN","GMVHDR",12,0)
 ; for the record number provided.
"RTN","GMVHDR",13,0)
 ;
"RTN","GMVHDR",14,0)
 ;  Input: GMVIEN - FILE 120.5 Internal Entry Number (IEN)
"RTN","GMVHDR",15,0)
 ; Output: A string of data where:
"RTN","GMVHDR",16,0)
 ;         piece 1 = (#.01) DATE/TIME VITALS TAKEN (internal)
"RTN","GMVHDR",17,0)
 ;         piece 2 = (#.02) PATIENT (internal)
"RTN","GMVHDR",18,0)
 ;         piece 3 = (#.03) VITAL TYPE (external)
"RTN","GMVHDR",19,0)
 ;         piece 4 = (#.04) DATE/TIME VITALS ENTERED (internal)
"RTN","GMVHDR",20,0)
 ;         piece 5 = (#.05) HOSPITAL LOCATION (internal)
"RTN","GMVHDR",21,0)
 ;         piece 6 = (#.06) ENTERED BY (internal)
"RTN","GMVHDR",22,0)
 ;         piece 7 = (#.03) VITAL TYPE (internal)
"RTN","GMVHDR",23,0)
 ;         piece 8 = (#1.2) RATE
"RTN","GMVHDR",24,0)
 ;         piece 9 = UNITS (value is computed by this routine)
"RTN","GMVHDR",25,0)
 ;         piece 10 = (#1.4) SUPPLEMENTAL O2 (internal)
"RTN","GMVHDR",26,0)
 ;         piece 11 = (#2) ENTERED IN ERROR (internal)
"RTN","GMVHDR",27,0)
 ;         piece 12 = (#3) ERROR ENTERED BY (internal)
"RTN","GMVHDR",28,0)
 ;         piece 13 = (#4) REASON ENTERED IN ERROR (multiple) (external)
"RTN","GMVHDR",29,0)
 ;                    Values are separated by a tilde (~).
"RTN","GMVHDR",30,0)
 ;         piece 14 = (#5) QUALIFIER (multiple) (external)
"RTN","GMVHDR",31,0)
 ;                    Values are separated by a tilde (~).
"RTN","GMVHDR",32,0)
 ;
"RTN","GMVHDR",33,0)
 ; Returns a null value if the entry does not exist.
"RTN","GMVHDR",34,0)
 ;
"RTN","GMVHDR",35,0)
 I '$G(GMVIEN) Q ""
"RTN","GMVHDR",36,0)
 N GMVA,GMVLIST,GMVLOOP,GMVNODE,GMVNODE2,GMVQUALE,GMVQUALI,GMVUNIT,GMVVTE,GMVVTI,GMVX
"RTN","GMVHDR",37,0)
 S GMVNODE=$G(^GMR(120.5,+GMVIEN,0)) ; zero node of patient record
"RTN","GMVHDR",38,0)
 ; check if record is complete
"RTN","GMVHDR",39,0)
 F GMVLOOP=1,2,3,4,5,6,8 I $P(GMVNODE,U,GMVLOOP)="" D
"RTN","GMVHDR",40,0)
 .H 1
"RTN","GMVHDR",41,0)
 .S GMVNODE=$G(^GMR(120.5,+GMVIEN,0)) ;get zero node again
"RTN","GMVHDR",42,0)
 .Q
"RTN","GMVHDR",43,0)
 I GMVNODE="" Q ""
"RTN","GMVHDR",44,0)
 I $P(GMVNODE,U,1)'>0 Q ""  ;date/time vitals taken
"RTN","GMVHDR",45,0)
 I $P(GMVNODE,U,2)'>0 Q ""  ;dfn
"RTN","GMVHDR",46,0)
 S GMVVTI=+$P(GMVNODE,U,3) ;vital type ien
"RTN","GMVHDR",47,0)
 S GMVVTE=$P($G(^GMRD(120.51,GMVVTI,0)),U,1) ;vital type name
"RTN","GMVHDR",48,0)
 I GMVVTE="" Q ""
"RTN","GMVHDR",49,0)
 I $$ACTIVE^GMVUID(120.51,"",GMVVTI_",","") Q ""  ; not active vuid
"RTN","GMVHDR",50,0)
 S GMVA=$P($G(^GMRD(120.51,GMVVTI,0)),U,2) ;vital abbreviation
"RTN","GMVHDR",51,0)
 S $P(GMVNODE,U,3)=GMVVTE,$P(GMVNODE,U,7)=GMVVTI
"RTN","GMVHDR",52,0)
 S GMVUNIT=$S(GMVA="BP":"mmHg",GMVA="T":"F",GMVA="R":"/min",GMVA="P":"/min",GMVA="HT":"in",GMVA="WT":"lb",GMVA="CVP":"cmH2O",GMVA="CG":"in",GMVA="PO2":"%SpO2",1:"")
"RTN","GMVHDR",53,0)
 S $P(GMVNODE,U,9)=GMVUNIT
"RTN","GMVHDR",54,0)
 S:+$P(GMVNODE,U,5)'>0 $P(GMVNODE,U,5)="" ;hospital location
"RTN","GMVHDR",55,0)
 S:+$P(GMVNODE,U,6)'>0 $P(GMVNODE,U,6)="" ;entered by
"RTN","GMVHDR",56,0)
 S GMVNODE2=$G(^GMR(120.5,GMVIEN,2))
"RTN","GMVHDR",57,0)
 S $P(GMVNODE,U,11)=$S($P(GMVNODE2,U,1)=1:"YES",1:"")
"RTN","GMVHDR",58,0)
 S $P(GMVNODE,U,12)=$S($P(GMVNODE2,U,2)>0:$P(GMVNODE2,U,2),1:"")
"RTN","GMVHDR",59,0)
 ; reason (multiple)
"RTN","GMVHDR",60,0)
 S GMVLOOP=0,GMVLIST=""
"RTN","GMVHDR",61,0)
 F  S GMVLOOP=$O(^GMR(120.5,GMVIEN,2.1,GMVLOOP)) Q:'GMVLOOP  D
"RTN","GMVHDR",62,0)
 .S GMVX=$P($G(^GMR(120.5,GMVIEN,2.1,GMVLOOP,0)),U,1)
"RTN","GMVHDR",63,0)
 .Q:GMVX=""
"RTN","GMVHDR",64,0)
 .S GMVX=GMVX_"-"_$S(GMVX=1:"INCORRECT DATE/TIME",GMVX=2:"INCORRECT READING",GMVX=3:"INCORRECT PATIENT",GMVX=4:"INVALID RECORD",1:"")
"RTN","GMVHDR",65,0)
 .S GMVLIST=GMVLIST_GMVX_"~"
"RTN","GMVHDR",66,0)
 .Q
"RTN","GMVHDR",67,0)
 I $E(GMVLIST,$L(GMVLIST))="~" S GMVLIST=$E(GMVLIST,1,($L(GMVLIST)-1))
"RTN","GMVHDR",68,0)
 S $P(GMVNODE,U,13)=GMVLIST
"RTN","GMVHDR",69,0)
 ;qualifiers (multiple)
"RTN","GMVHDR",70,0)
 S GMVLOOP=0,GMVLIST=""
"RTN","GMVHDR",71,0)
 F  S GMVLOOP=$O(^GMR(120.5,GMVIEN,5,GMVLOOP)) Q:'GMVLOOP  D
"RTN","GMVHDR",72,0)
 .S GMVQUALI=$P($G(^GMR(120.5,GMVIEN,5,GMVLOOP,0)),U,1)
"RTN","GMVHDR",73,0)
 .S GMVQUALE=$P($G(^GMRD(120.52,+GMVQUALI,0)),U,1)
"RTN","GMVHDR",74,0)
 .Q:GMVQUALE=""
"RTN","GMVHDR",75,0)
 .S GMVLIST=GMVLIST_GMVQUALE_"~"
"RTN","GMVHDR",76,0)
 .Q
"RTN","GMVHDR",77,0)
 I $E(GMVLIST,$L(GMVLIST))="~" S GMVLIST=$E(GMVLIST,1,($L(GMVLIST)-1))
"RTN","GMVHDR",78,0)
 S $P(GMVNODE,U,14)=GMVLIST
"RTN","GMVHDR",79,0)
 Q GMVNODE
"RTN","GMVHDR",80,0)
 ;
"RTN","GMVVDEF1")
0^1^B49050672^B40198875
"RTN","GMVVDEF1",1,0)
GMVVDEF1 ;BPOIFO/JG,HIOFO/FT - BUILD HL7 ORU^R01 MESSAGE FOR VITALS ; 20 Sep 2005  4:36 PM
"RTN","GMVVDEF1",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**5,8,12,17**;Oct 31, 2002
"RTN","GMVVDEF1",3,0)
 ;11/30/2005 KAM/BAY Remedy Calls 121661 and 122742 changes for HL7 message
"RTN","GMVVDEF1",4,0)
VALID ;;VDEF HL7 MESSAGE BUILDER
"RTN","GMVVDEF1",5,0)
 ; Creates HL7 V2.4 ORU^R01 message for vitals
"RTN","GMVVDEF1",6,0)
 ;
"RTN","GMVVDEF1",7,0)
 ; This routine uses the following IAs:
"RTN","GMVVDEF1",8,0)
 ;    #93 - FILE 44 references   (controlled)
"RTN","GMVVDEF1",9,0)
 ;   #557 - FILE 40.7 references (controlled)
"RTN","GMVVDEF1",10,0)
 ;  #2432 - FILE 44 references   (controlled)
"RTN","GMVVDEF1",11,0)
 ;  #3630 - VAFCQRY calls        (controlled)
"RTN","GMVVDEF1",12,0)
 ;  #4248 - VDEFEL calls         (controlled)
"RTN","GMVVDEF1",13,0)
 ;  #4571 - VDEFREQ calls        (controlled)
"RTN","GMVVDEF1",14,0)
 ; #10035 - DPT( references      (supported)
"RTN","GMVVDEF1",15,0)
 ; #10040 - FILE 44 references   (supported)
"RTN","GMVVDEF1",16,0)
 ; #10112 - VASITE calls         (supported)
"RTN","GMVVDEF1",17,0)
 ;
"RTN","GMVVDEF1",18,0)
 ; This routine is called at tag EN as a Function by VDEFREQ1
"RTN","GMVVDEF1",19,0)
 ;
"RTN","GMVVDEF1",20,0)
 Q
"RTN","GMVVDEF1",21,0)
 ;
"RTN","GMVVDEF1",22,0)
EN(EVIEN,KEY,VFLAG,OUT,MSHP) ; Entry point
"RTN","GMVVDEF1",23,0)
 ;
"RTN","GMVVDEF1",24,0)
 ; Inputs: EVIEN = IEN of VDEF Event in file 577
"RTN","GMVVDEF1",25,0)
 ;         KEY - IEN of file to create message from
"RTN","GMVVDEF1",26,0)
 ;         VFLAG - "V" for VistA HL7 destination (default)
"RTN","GMVVDEF1",27,0)
 ;         OUT - target array, passed by reference
"RTN","GMVVDEF1",28,0)
 ;         MSHP - Piece 4 contains message subtype
"RTN","GMVVDEF1",29,0)
 ;
"RTN","GMVVDEF1",30,0)
 ; Output: Two part string with parts separated by "^"
"RTN","GMVVDEF1",31,0)
 ;         Part 1: "LM" - output in local array passed in "OUT" parameter
"RTN","GMVVDEF1",32,0)
 ;                 "GM" - output in ^TMP("HLS",$J)
"RTN","GMVVDEF1",33,0)
 ;         Part 2: No longer used
"RTN","GMVVDEF1",34,0)
 ;
"RTN","GMVVDEF1",35,0)
 N DFN,HLFS,HLCM,HLSC,HLRP,HLES,HLQ,VTLDAT,UM,VTLTYP,DTE,DTP
"RTN","GMVVDEF1",36,0)
 N VTLERR,VAL,I,S,X,XX,Y,QUALS,HL7RC,PIDSEG,IEN1,SEQ,STOPCD,EIEVUID
"RTN","GMVVDEF1",37,0)
 N SEPF,SEPC,SEPR,SEPE,SEPS,VTLNAM,ARRAY,O2SUP,OUTX,ADD,VTLVUID
"RTN","GMVVDEF1",38,0)
 ;
"RTN","GMVVDEF1",39,0)
 ; Initialize stuff
"RTN","GMVVDEF1",40,0)
 K ^TMP("HLS",$J) S S=0,ARRAY="OUT("_"""HLS"""_",S)",TARGET="LM^"
"RTN","GMVVDEF1",41,0)
 ;
"RTN","GMVVDEF1",42,0)
 ; Set up HL7 delimiters
"RTN","GMVVDEF1",43,0)
 S HLCM=$E(VDEFHL("ECH")),HLRP=$E(VDEFHL("ECH"),2),HLSC=$E(VDEFHL("ECH"),4),HLES=$E(VDEFHL("ECH"),3)
"RTN","GMVVDEF1",44,0)
 S HLFS=VDEFHL("FS"),HLQ=VDEFHL("Q"),HL7RC=HLES_HLFS_HLCM_HLRP_HLSC
"RTN","GMVVDEF1",45,0)
 D SETDLMS^VDEFEL
"RTN","GMVVDEF1",46,0)
 ;
"RTN","GMVVDEF1",47,0)
 ; Get the vitals measurement record & patient ID
"RTN","GMVVDEF1",48,0)
 S VTLDAT=$$EN^GMVHDR(KEY)
"RTN","GMVVDEF1",49,0)
 I 'VTLDAT D ERR^VDEFREQ("Invalid data in file GMR(120.5) for IEN "_KEY) S ZTSTOP=1 G EXIT
"RTN","GMVVDEF1",50,0)
 S DFN=$P(VTLDAT,U,2),VTLTYP=$P(VTLDAT,U,7)
"RTN","GMVVDEF1",51,0)
 S VTLVUID=$$GET^GMVUID(120.51,.01,+VTLTYP_",") ;vital type vuid
"RTN","GMVVDEF1",52,0)
 S O2SUP=$P(VTLDAT,U,10),VTLERR=$P(VTLDAT,U,11)
"RTN","GMVVDEF1",53,0)
 S X=$P(VTLDAT,U,5) I +X'=X!(X<0) S $P(VTLDAT,U,5)=""
"RTN","GMVVDEF1",54,0)
 S STOPCD=""
"RTN","GMVVDEF1",55,0)
 I $P(VTLDAT,U,5)'="" D
"RTN","GMVVDEF1",56,0)
 . S STOPCD=$P($G(^SC($P(VTLDAT,U,5),0)),U,7) Q:STOPCD=""
"RTN","GMVVDEF1",57,0)
 . S STOPCD=$G(^DIC(40.7,STOPCD,0))
"RTN","GMVVDEF1",58,0)
 . S STOPCD=$$HL7RC($P(STOPCD,U,2))_";"_$$HL7RC($P(STOPCD,U))
"RTN","GMVVDEF1",59,0)
 ;
"RTN","GMVVDEF1",60,0)
 ; Build segments for message in OUTX, $P # = HL7 field #
"RTN","GMVVDEF1",61,0)
 ;
"RTN","GMVVDEF1",62,0)
 ; PID - Use MPI PID builder
"RTN","GMVVDEF1",63,0)
PID K PIDSEG S OUTX="",S=1,SEQ=""
"RTN","GMVVDEF1",64,0)
 I $G(^DPT(DFN,0))="" D ERR^VDEFREQ("No entry in file DPT for DFN "_DFN) S ZTSTOP=1 G EXIT
"RTN","GMVVDEF1",65,0)
 D BLDPID^VAFCQRY(DFN,1,SEQ,.PIDSEG,.VDEFHL)
"RTN","GMVVDEF1",66,0)
 F I=2:1 Q:$G(PIDSEG(I))=""  S PIDSEG(1,I-1)=PIDSEG(I) K PIDSEG(I)
"RTN","GMVVDEF1",67,0)
 M OUTX=PIDSEG(1) K PIDSEG D SAVE
"RTN","GMVVDEF1",68,0)
 ;
"RTN","GMVVDEF1",69,0)
 ; ORC
"RTN","GMVVDEF1",70,0)
ORC S S=S+1,OUTX="RE"
"RTN","GMVVDEF1",71,0)
 ;
"RTN","GMVVDEF1",72,0)
 ; Filler ID
"RTN","GMVVDEF1",73,0)
 S X=KEY_HLCM_$$HL7RC($P(SITEPARM,U,6))_"_120.5",$P(OUTX,HLFS,3)=X
"RTN","GMVVDEF1",74,0)
 ;
"RTN","GMVVDEF1",75,0)
 ; Enterer's location
"RTN","GMVVDEF1",76,0)
 I $P(VTLDAT,U,5)'="" D
"RTN","GMVVDEF1",77,0)
 . S X=$G(^SC($P(VTLDAT,U,5),0)),VAL=$$HL7RC($P(X,U,2))
"RTN","GMVVDEF1",78,0)
 . S $P(VAL,HLCM,9)=$$HL7RC($P(X,U)),$P(OUTX,HLFS,13)=VAL
"RTN","GMVVDEF1",79,0)
 . I +$P(X,U,15) S X=$$SITE^VASITE($P(VTLDAT,U),$P(X,U,15)) S:X=-1 X=""
"RTN","GMVVDEF1",80,0)
 . E  S X=""
"RTN","GMVVDEF1",81,0)
 . S VAL=$$HL7RC($P(X,U,3))_HLCM_$$HL7RC($P(X,U,2))_HLCM_"L",$P(OUTX,HLFS,17)=VAL
"RTN","GMVVDEF1",82,0)
 ; Parent Facility (Added 04/17/2006)
"RTN","GMVVDEF1",83,0)
 S $P(OUTX,HLFS,21)=$P($$SITE^VASITE(),"^",2)
"RTN","GMVVDEF1",84,0)
 ;
"RTN","GMVVDEF1",85,0)
 S VAL=$P(OUTX,HLFS,3),OUTX="ORC"_HLFS_OUTX D SAVE
"RTN","GMVVDEF1",86,0)
 ;
"RTN","GMVVDEF1",87,0)
 ; OBR
"RTN","GMVVDEF1",88,0)
OBR S S=S+1,OUTX="",VTLNAM=$$HL7RC($P(^GMRD(120.51,VTLTYP,0),U))
"RTN","GMVVDEF1",89,0)
 S X=VTLVUID_HLCM_VTLNAM_HLCM_$$HL7RC("99VA120.51")
"RTN","GMVVDEF1",90,0)
 ;
"RTN","GMVVDEF1",91,0)
 ; Add filler ID from ORC-3 & Procedure name
"RTN","GMVVDEF1",92,0)
 S $P(OUTX,HLFS,3)=VAL,$P(OUTX,HLFS,4)=X
"RTN","GMVVDEF1",93,0)
 ;
"RTN","GMVVDEF1",94,0)
 ; Dates/times vital taken & entered
"RTN","GMVVDEF1",95,0)
 S DTP=$$HL7RC($$TS^VDEFEL($P(VTLDAT,U))),$P(OUTX,HLFS,7)=DTP
"RTN","GMVVDEF1",96,0)
 S DTE=$$HL7RC($$TS^VDEFEL($P(VTLDAT,U,4))),$P(OUTX,HLFS,8)=DTE
"RTN","GMVVDEF1",97,0)
 ;
"RTN","GMVVDEF1",98,0)
 ; Use date/time vital entered for results reported
"RTN","GMVVDEF1",99,0)
 S $P(OUTX,HLFS,22)=DTE
"RTN","GMVVDEF1",100,0)
 ;
"RTN","GMVVDEF1",101,0)
 ; Set result status to Final or Error if entered in error
"RTN","GMVVDEF1",102,0)
 S $P(OUTX,HLFS,25)=$E("FE",VTLERR'=""+1)
"RTN","GMVVDEF1",103,0)
 ;
"RTN","GMVVDEF1",104,0)
 ; Technician name
"RTN","GMVVDEF1",105,0)
 S XX=$$XCN200^VDEFEL($P(VTLDAT,U,6))
"RTN","GMVVDEF1",106,0)
 F II=2:1:7 S $P(XX,SEPC,II)=$$HL7RC($P(XX,SEPC,II))
"RTN","GMVVDEF1",107,0)
 S $P(OUTX,HLFS,34)=XX
"RTN","GMVVDEF1",108,0)
 S OUTX="OBR"_HLFS_OUTX D SAVE
"RTN","GMVVDEF1",109,0)
 ;
"RTN","GMVVDEF1",110,0)
 ; OBX 1 - Vital name
"RTN","GMVVDEF1",111,0)
OBX1 S S=S+1,OUTX=HLFS_"ST"
"RTN","GMVVDEF1",112,0)
 ;
"RTN","GMVVDEF1",113,0)
 ; Observation ID - Vital name
"RTN","GMVVDEF1",114,0)
 S X=VTLVUID_HLCM_VTLNAM_HLCM_$$HL7RC("99VA120.51"),$P(OUTX,HLFS,3)=X
"RTN","GMVVDEF1",115,0)
 ;
"RTN","GMVVDEF1",116,0)
 ; Unit of measure
"RTN","GMVVDEF1",117,0)
 ; If vital not performed, set units to null
"RTN","GMVVDEF1",118,0)
 S UM=$$HL7RC($P(VTLDAT,U,9)) S:$F("Pass Refused Unavailable",$P(VTLDAT,U,8))>0 UM=""
"RTN","GMVVDEF1",119,0)
 S UM=UM_HLCM_UM_HLCM_"L"
"RTN","GMVVDEF1",120,0)
 ;
"RTN","GMVVDEF1",121,0)
 ; Set sub-id if O2 supplements to follow
"RTN","GMVVDEF1",122,0)
 S:O2SUP'="" $P(OUTX,HLFS,4)=1
"RTN","GMVVDEF1",123,0)
 S $P(OUTX,HLFS,5)=$$HL7RC($P(VTLDAT,U,8)),$P(OUTX,HLFS,6)=UM
"RTN","GMVVDEF1",124,0)
 ;
"RTN","GMVVDEF1",125,0)
 ; Set result status to Final or Wrong if errors entered
"RTN","GMVVDEF1",126,0)
 S $P(OUTX,HLFS,11)=$E("FW",VTLERR'=""+1)
"RTN","GMVVDEF1",127,0)
 S XX=$$XCN200^VDEFEL($P(VTLDAT,U,6))
"RTN","GMVVDEF1",128,0)
 F II=2:1:7 S $P(XX,SEPC,II)=$$HL7RC($P(XX,SEPC,II))
"RTN","GMVVDEF1",129,0)
 S $P(OUTX,HLFS,16)=XX
"RTN","GMVVDEF1",130,0)
 S OUTX="OBX"_HLFS_OUTX D SAVE
"RTN","GMVVDEF1",131,0)
 ;
"RTN","GMVVDEF1",132,0)
 ; OBX2 - O2 Supplement
"RTN","GMVVDEF1",133,0)
OBX2 G QUALS:O2SUP="" S (VAL,UM)=""
"RTN","GMVVDEF1",134,0)
 S S=S+1,OUTX=HLFS_"ST"_HLFS_"O2 Supplement" D
"RTN","GMVVDEF1",135,0)
 . I O2SUP["%",O2SUP'["l/min" S VAL=+O2SUP,UM="%" Q
"RTN","GMVVDEF1",136,0)
 . I O2SUP'["%",O2SUP["l/min" S VAL=+O2SUP,UM="l/min"
"RTN","GMVVDEF1",137,0)
 . I O2SUP["%",O2SUP["l/min" S $P(VAL,U)=$P(O2SUP," "),$P(UM,U)="l/min",$P(VAL,U,2)=+$P(O2SUP," ",3),$P(UM,U,2)="%"
"RTN","GMVVDEF1",138,0)
 S X=$P(UM,U),X=X_HLCM_X_HLCM_"L",$P(UM,U)=X
"RTN","GMVVDEF1",139,0)
 I $P(UM,U,2)'="" S X=$P(UM,U,2),X=X_HLCM_X_HLCM_"L",$P(UM,U,2)=X
"RTN","GMVVDEF1",140,0)
 S $P(OUTX,HLFS,4)=2,$P(OUTX,HLFS,5)=$P(VAL,U,1),$P(OUTX,HLFS,6)=$P(UM,U)
"RTN","GMVVDEF1",141,0)
 ;
"RTN","GMVVDEF1",142,0)
 ; Set result status to Final or Wrong if errors entered
"RTN","GMVVDEF1",143,0)
 S $P(OUTX,HLFS,11)=$E("FW",VTLERR'=""+1)
"RTN","GMVVDEF1",144,0)
 S OUTX="OBX"_HLFS_OUTX,X=OUTX D SAVE
"RTN","GMVVDEF1",145,0)
 ; If more than one O2 supplement, add another OBX
"RTN","GMVVDEF1",146,0)
 ; Field offset in OUT is now +1 because OBX has been added
"RTN","GMVVDEF1",147,0)
 S OUTX=X I $P(VAL,U,2)'="" D
"RTN","GMVVDEF1",148,0)
 . S S=S+1,$P(OUTX,HLFS,5)=3,$P(OUTX,HLFS,6)=$P(VAL,U,2),$P(OUTX,HLFS,7)=$P(UM,U,2)
"RTN","GMVVDEF1",149,0)
 . D SAVE
"RTN","GMVVDEF1",150,0)
 ;
"RTN","GMVVDEF1",151,0)
 ; Qualifiers
"RTN","GMVVDEF1",152,0)
QUALS S QUALS="",X=$O(^GMR(120.5,KEY,5,0)) G ERRS:X=""
"RTN","GMVVDEF1",153,0)
 S S=S+1,OUTX=HLFS_"CE"_HLFS_"Qualifiers"_HLFS_HLFS
"RTN","GMVVDEF1",154,0)
 ;
"RTN","GMVVDEF1",155,0)
 ; Get qualifiers
"RTN","GMVVDEF1",156,0)
 S IEN1=0 F  S IEN1=$O(^GMR(120.5,KEY,5,IEN1)) Q:'+IEN1  D
"RTN","GMVVDEF1",157,0)
 . S X=^GMR(120.5,KEY,5,IEN1,0),VAL=$$HL7RC($P(^GMRD(120.52,X,0),U))
"RTN","GMVVDEF1",158,0)
 . S X=$$GET^GMVUID(120.52,.01,+X_",") ;qualifier vuid
"RTN","GMVVDEF1",159,0)
 . S VAL=X_HLCM_VAL_HLCM_$$HL7RC("99VA120.52"),QUALS=QUALS_VAL_HLRP
"RTN","GMVVDEF1",160,0)
 ;
"RTN","GMVVDEF1",161,0)
 ; Set result
"RTN","GMVVDEF1",162,0)
 S $P(OUTX,HLFS,5)=$E(QUALS,1,$L(QUALS)-1)
"RTN","GMVVDEF1",163,0)
 ;
"RTN","GMVVDEF1",164,0)
 ; Set result status to Final or Wrong if errors entered
"RTN","GMVVDEF1",165,0)
 S $P(OUTX,HLFS,11)=$E("FW",VTLERR'=""+1)
"RTN","GMVVDEF1",166,0)
 S OUTX="OBX"_HLFS_OUTX D SAVE
"RTN","GMVVDEF1",167,0)
 ;
"RTN","GMVVDEF1",168,0)
 ; Entered in Error
"RTN","GMVVDEF1",169,0)
ERRS G ZSC:VTLERR="" S S=S+1,OUTX=HLFS_"CE"_HLFS_"Error Reasons"_HLFS_HLFS
"RTN","GMVVDEF1",170,0)
 ;
"RTN","GMVVDEF1",171,0)
 ; Error data reason(s)
"RTN","GMVVDEF1",172,0)
 S X=$P(VTLDAT,U,13),VAL=""
"RTN","GMVVDEF1",173,0)
 F I=1:1:$L(X,"~") D
"RTN","GMVVDEF1",174,0)
 .S Y=$P(X,"~",I)
"RTN","GMVVDEF1",175,0)
 .S EIEVUID=$$GET^GMVUID(120.506,.01,$P(Y,"-",1)) ;error vuid
"RTN","GMVVDEF1",176,0)
 .S VAL=VAL_$$HL7RC(EIEVUID)_HLCM_$$HL7RC($P(Y,"-",2))_HLCM_$$HL7RC("99VA8985.1")_HLRP
"RTN","GMVVDEF1",177,0)
 S VAL=$E(VAL,1,$L(VAL)-1),$P(OUTX,HLFS,5)=VAL
"RTN","GMVVDEF1",178,0)
 ;
"RTN","GMVVDEF1",179,0)
 ; Set result status to Final or Wrong if errors entered
"RTN","GMVVDEF1",180,0)
 S $P(OUTX,HLFS,11)=$E("FW",VTLERR'=""+1)
"RTN","GMVVDEF1",181,0)
 ;
"RTN","GMVVDEF1",182,0)
 ; Entered in error by technician
"RTN","GMVVDEF1",183,0)
 S XX=$$XCN200^VDEFEL($P(VTLDAT,U,12))
"RTN","GMVVDEF1",184,0)
 F II=2:1:7 S $P(XX,SEPC,II)=$$HL7RC($P(XX,SEPC,II))
"RTN","GMVVDEF1",185,0)
 S $P(OUTX,HLFS,16)=XX
"RTN","GMVVDEF1",186,0)
 S OUTX="OBX"_HLFS_OUTX D SAVE
"RTN","GMVVDEF1",187,0)
 ;
"RTN","GMVVDEF1",188,0)
 ; Stop Code & Name
"RTN","GMVVDEF1",189,0)
ZSC G EXIT:STOPCD=""
"RTN","GMVVDEF1",190,0)
 S S=S+1,OUTX=HLFS_$P(STOPCD,";")_HLFS_$P(STOPCD,";",2)
"RTN","GMVVDEF1",191,0)
 S OUTX="ZSC"_HLFS_OUTX D SAVE
"RTN","GMVVDEF1",192,0)
 ;
"RTN","GMVVDEF1",193,0)
 ; Done building segments
"RTN","GMVVDEF1",194,0)
EXIT Q TARGET
"RTN","GMVVDEF1",195,0)
 ;
"RTN","GMVVDEF1",196,0)
 ;
"RTN","GMVVDEF1",197,0)
 ; Place current string into message array.
"RTN","GMVVDEF1",198,0)
 ; Turn string into array if length >245.
"RTN","GMVVDEF1",199,0)
 ; Move local array to global if needed.
"RTN","GMVVDEF1",200,0)
SAVE N I
"RTN","GMVVDEF1",201,0)
 I $P(OUTX,HLFS)'="PID",$L(OUTX)>245 D
"RTN","GMVVDEF1",202,0)
 . K ADD S ADD=$E(OUTX,1,245),OUTX=$E(OUTX,246,$L(OUTX))
"RTN","GMVVDEF1",203,0)
 . F I=1:1 S ADD(I)=$E(OUTX,1,245),OUTX=$E(OUTX,246,$L(OUTX)) Q:OUTX=""
"RTN","GMVVDEF1",204,0)
 . K OUTX M OUTX=ADD
"RTN","GMVVDEF1",205,0)
 M @ARRAY=OUTX
"RTN","GMVVDEF1",206,0)
 ;
"RTN","GMVVDEF1",207,0)
 ; Move local array to global if it's getting big.
"RTN","GMVVDEF1",208,0)
 I $P(TARGET,U)="LM",$S<16000 D
"RTN","GMVVDEF1",209,0)
 . K ^TMP("HLS",$J) M ^TMP("HLS",$J)=OUT("HLS") K OUT("HLS")
"RTN","GMVVDEF1",210,0)
 . S $P(TARGET,U)="GM",ARRAY="^TMP("_"""HLS"""_",$J,S)"
"RTN","GMVVDEF1",211,0)
 K OUTX,ADD
"RTN","GMVVDEF1",212,0)
 Q
"RTN","GMVVDEF1",213,0)
 ;
"RTN","GMVVDEF1",214,0)
 ; Replace any HL7 coding chars. in strings with HL7 escape sequence
"RTN","GMVVDEF1",215,0)
 ; Input: X = data string
"RTN","GMVVDEF1",216,0)
HL7RC(X) N OCHR,RCHR,RCHRI,TYPE,I F TYPE="E","F","C","R","S" D
"RTN","GMVVDEF1",217,0)
 . S RCHRI=$S(TYPE="E":1,TYPE="F":2,TYPE="C":3,TYPE="R":4,TYPE="S":5)
"RTN","GMVVDEF1",218,0)
 . S OCHR=$E(HL7RC,RCHRI),RCHR=$E("EFSRT",RCHRI)
"RTN","GMVVDEF1",219,0)
 . Q:'$F(X,OCHR)
"RTN","GMVVDEF1",220,0)
 . F I=1:1 Q:$E(X,I)=""  I $E(X,I)=OCHR S X=$E(X,1,I-1)_HLES_RCHR_HLES_$E(X,I+1,999),I=I+2
"RTN","GMVVDEF1",221,0)
 Q X
"VER")
8.0^22.0
"BLD",5866,6)
^11
**END**
**END**
