KIDS Distribution saved on Jun 07, 2006@09:46:53
GUI 26.68 RELEASED
**KIDS**:OR*3.0*258^

**INSTALL NAME**
OR*3.0*258
"BLD",17726,0)
OR*3.0*258^ORDER ENTRY/RESULTS REPORTING^0^3060607^y
"BLD",17726,4,0)
^9.64PA^^
"BLD",17726,6.3)
7
"BLD",17726,"INID")
^n
"BLD",17726,"INIT")
POST^ORY258
"BLD",17726,"KRN",0)
^9.67PA^8989.52^19
"BLD",17726,"KRN",.4,0)
.4
"BLD",17726,"KRN",.401,0)
.401
"BLD",17726,"KRN",.402,0)
.402
"BLD",17726,"KRN",.403,0)
.403
"BLD",17726,"KRN",.5,0)
.5
"BLD",17726,"KRN",.84,0)
.84
"BLD",17726,"KRN",3.6,0)
3.6
"BLD",17726,"KRN",3.8,0)
3.8
"BLD",17726,"KRN",9.2,0)
9.2
"BLD",17726,"KRN",9.8,0)
9.8
"BLD",17726,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",17726,"KRN",9.8,"NM",1,0)
ORY258^^0^B1830631
"BLD",17726,"KRN",9.8,"NM",2,0)
ORWDPS2^^0^B56911392
"BLD",17726,"KRN",9.8,"NM","B","ORWDPS2",2)

"BLD",17726,"KRN",9.8,"NM","B","ORY258",1)

"BLD",17726,"KRN",19,0)
19
"BLD",17726,"KRN",19.1,0)
19.1
"BLD",17726,"KRN",101,0)
101
"BLD",17726,"KRN",409.61,0)
409.61
"BLD",17726,"KRN",771,0)
771
"BLD",17726,"KRN",870,0)
870
"BLD",17726,"KRN",8989.51,0)
8989.51
"BLD",17726,"KRN",8989.52,0)
8989.52
"BLD",17726,"KRN",8994,0)
8994
"BLD",17726,"KRN","B",.4,.4)

"BLD",17726,"KRN","B",.401,.401)

"BLD",17726,"KRN","B",.402,.402)

"BLD",17726,"KRN","B",.403,.403)

"BLD",17726,"KRN","B",.5,.5)

"BLD",17726,"KRN","B",.84,.84)

"BLD",17726,"KRN","B",3.6,3.6)

"BLD",17726,"KRN","B",3.8,3.8)

"BLD",17726,"KRN","B",9.2,9.2)

"BLD",17726,"KRN","B",9.8,9.8)

"BLD",17726,"KRN","B",19,19)

"BLD",17726,"KRN","B",19.1,19.1)

"BLD",17726,"KRN","B",101,101)

"BLD",17726,"KRN","B",409.61,409.61)

"BLD",17726,"KRN","B",771,771)

"BLD",17726,"KRN","B",870,870)

"BLD",17726,"KRN","B",8989.51,8989.51)

"BLD",17726,"KRN","B",8989.52,8989.52)

"BLD",17726,"KRN","B",8994,8994)

"BLD",17726,"QUES",0)
^9.62^^
"BLD",17726,"REQB",0)
^9.611^2^2
"BLD",17726,"REQB",1,0)
OR*3.0*215^2
"BLD",17726,"REQB",2,0)
PSS*1.0*113^2
"BLD",17726,"REQB","B","OR*3.0*215",1)

"BLD",17726,"REQB","B","PSS*1.0*113",2)

"INIT")
POST^ORY258
"MBREQ")
0
"PKG",22,-1)
1^1
"PKG",22,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",22,20,0)
^9.402P^^
"PKG",22,22,0)
^9.49I^1^1
"PKG",22,22,1,0)
3.0^2971217^2980204^64
"PKG",22,22,1,"PAH",1,0)
258^3060607
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ORWDPS2")
0^2^B56911392
"RTN","ORWDPS2",1,0)
ORWDPS2 ; SLC/KCM/JLI - Pharmacy Calls for Windows Dialog
"RTN","ORWDPS2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,116,125,131,132,148,141,195,215,258**;Dec 17, 1997;Build 7
"RTN","ORWDPS2",3,0)
 ;
"RTN","ORWDPS2",4,0)
OISLCT(LST,OI,PSTYPE,ORVP,NEEDPI,PKIACTIV) ; return for defaults for pharmacy orderable item
"RTN","ORWDPS2",5,0)
 N ILST,ORDOSE,ORWPSOI,ORWDOSES,X1,X2
"RTN","ORWDPS2",6,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS2",7,0)
 S ILST=0
"RTN","ORWDPS2",8,0)
 S ORWPSOI=0
"RTN","ORWDPS2",9,0)
 S:+OI ORWPSOI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS2",10,0)
 D START^PSSJORDF(ORWPSOI,$S(PSTYPE="U":"I",1:"O")) ; dflt route, schedule, etc.
"RTN","ORWDPS2",11,0)
 I '$L($T(DOSE^PSSOPKI1)) D DOSE^PSSORUTL(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses
"RTN","ORWDPS2",12,0)
 I $L($T(DOSE^PSSOPKI1)) D DOSE^PSSOPKI1(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses NEW PKI CODE from pharmacy
"RTN","ORWDPS2",13,0)
 D EN^PSSDIN(ORWPSOI)                               ; nfi text
"RTN","ORWDPS2",14,0)
 S ILST=ILST+1,LST(ILST)="~Medication"
"RTN","ORWDPS2",15,0)
 S ILST=ILST+1,LST(ILST)="d"_OI_U_$S(+OI:$P(^ORD(101.43,OI,0),U),1:"")
"RTN","ORWDPS2",16,0)
 S ILST=ILST+1,LST(ILST)="~Verb"
"RTN","ORWDPS2",17,0)
 S ILST=ILST+1,LST(ILST)="d"_$P($G(ORDOSE("MISC")),U)
"RTN","ORWDPS2",18,0)
 S ILST=ILST+1,LST(ILST)="~Preposition"
"RTN","ORWDPS2",19,0)
 S ILST=ILST+1,LST(ILST)="d"_$P($G(ORDOSE("MISC")),U,2)
"RTN","ORWDPS2",20,0)
 I $D(NEEDPI),(NEEDPI="Y") S ILST=ILST+1,LST(ILST)="~PtInstr" D PTINSTR
"RTN","ORWDPS2",21,0)
 ;S:NEEDPI="Y" ILST=ILST+1,LST(ILST)="~PtInstr"   D PTINSTR
"RTN","ORWDPS2",22,0)
 S ILST=ILST+1,LST(ILST)="~AllDoses"  D ALLDOSE ; must do before DOSAGE
"RTN","ORWDPS2",23,0)
 S ILST=ILST+1,LST(ILST)="~Dosage"    D DOSAGE
"RTN","ORWDPS2",24,0)
 S ILST=ILST+1,LST(ILST)="~Dispense"  D DISPLST
"RTN","ORWDPS2",25,0)
 S ILST=ILST+1,LST(ILST)="~Route"     D ROUTE
"RTN","ORWDPS2",26,0)
 S ILST=ILST+1,LST(ILST)="~Schedule"  D SCHED
"RTN","ORWDPS2",27,0)
 S ILST=ILST+1,LST(ILST)="~Guideline" D GUIDE
"RTN","ORWDPS2",28,0)
 S ILST=ILST+1,LST(ILST)="~Message"   D OIMSG
"RTN","ORWDPS2",29,0)
 S ILST=ILST+1,LST(ILST)="~DEASchedule" ;PKI
"RTN","ORWDPS2",30,0)
 ;S ILST=ILST+1,LST(ILST)="d"_$P($G(ORDOSE("DEA")),U) ;PKI
"RTN","ORWDPS2",31,0)
 S ILST=ILST+1,LST(ILST)="d" ;PKI
"RTN","ORWDPS2",32,0)
 I $D(ORDOSE("DEA")) S X="",X1=$P(ORDOSE("DEA"),";"),X2=$P(ORDOSE("DEA"),";",2) D
"RTN","ORWDPS2",33,0)
 . I '$L(X2) Q
"RTN","ORWDPS2",34,0)
 . I $G(PKIACTIV)="Y" S X=X2
"RTN","ORWDPS2",35,0)
 S LST(ILST)=LST(ILST)_X
"RTN","ORWDPS2",36,0)
 I PSTYPE="U" D
"RTN","ORWDPS2",37,0)
 . ; start, expires, next admin
"RTN","ORWDPS2",38,0)
 I PSTYPE="O" D
"RTN","ORWDPS2",39,0)
 . ; days supply, quantity, refills
"RTN","ORWDPS2",40,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS2",41,0)
 Q
"RTN","ORWDPS2",42,0)
 ;
"RTN","ORWDPS2",43,0)
PTINSTR ; from OISLCT, set up patient instructions
"RTN","ORWDPS2",44,0)
 N I
"RTN","ORWDPS2",45,0)
 S I=0 F  S I=$O(ORDOSE("PI",I)) Q:I'>0  S ILST=ILST+1,LST(ILST)="t"_ORDOSE("PI",I)
"RTN","ORWDPS2",46,0)
 Q
"RTN","ORWDPS2",47,0)
DOSAGE ; from OISLCT, set up the list of dosages
"RTN","ORWDPS2",48,0)
 ; LST(n)=iDrugName^Strength^NF^... (see BLDDOSE)
"RTN","ORWDPS2",49,0)
 ; must be called after ALLDOSE so ORWDOSES is set up
"RTN","ORWDPS2",50,0)
 N I
"RTN","ORWDPS2",51,0)
 S I=0 F  S I=$O(ORWDOSES(I)) Q:I'>0  S ILST=ILST+1,LST(ILST)=ORWDOSES(I)
"RTN","ORWDPS2",52,0)
 Q
"RTN","ORWDPS2",53,0)
DISPLST ; from OISLCT, set up list of dispense drugs
"RTN","ORWDPS2",54,0)
 ; DrugIEN^Strength^Units^Name^Split
"RTN","ORWDPS2",55,0)
 N DD
"RTN","ORWDPS2",56,0)
 S DD=0 F  S DD=$O(ORDOSE("DD",DD)) Q:'DD  D
"RTN","ORWDPS2",57,0)
 . S ILST=ILST+1
"RTN","ORWDPS2",58,0)
 . S LST(ILST)="i"_DD_U_$P(ORDOSE("DD",DD),U,5,6)_U_$P(ORDOSE("DD",DD),U)_U_$P(ORDOSE("DD",DD),U,11)
"RTN","ORWDPS2",59,0)
 Q
"RTN","ORWDPS2",60,0)
ALLDOSE ; from OISLCT, set up a list of all possible doses
"RTN","ORWDPS2",61,0)
 ; LST(n)=iDrugName^Strength^NF^... (see BLDDOSE)
"RTN","ORWDPS2",62,0)
 N I,J,CONJ,DD,DRUG,DDNM,LDOSE,TEXT,STREN,UD,COST,NF,ID,X
"RTN","ORWDPS2",63,0)
 S CONJ=$P($G(ORDOSE("MISC")),U,3),ORWDOSES=0
"RTN","ORWDPS2",64,0)
 S:$L(CONJ) CONJ=" "_CONJ_" " S:'$L(CONJ) CONJ=" "
"RTN","ORWDPS2",65,0)
 S I=0 F  S I=$O(ORDOSE(I)) Q:I'>0  D
"RTN","ORWDPS2",66,0)
 . S X=$$BLDDOSE(ORDOSE(I))
"RTN","ORWDPS2",67,0)
 . S ORWDOSES=ORWDOSES+1,ORWDOSES(ORWDOSES)=X
"RTN","ORWDPS2",68,0)
 . S ILST=ILST+1
"RTN","ORWDPS2",69,0)
 . S LST(ILST)="i"_$P(X,U,5)_U_$P($P(X,U,4),"&",6)_U_$P(X,U,4)
"RTN","ORWDPS2",70,0)
 . S J=0 F  S J=$O(ORDOSE(I,J)) Q:J'>0  D
"RTN","ORWDPS2",71,0)
 . . S X=$$BLDDOSE(ORDOSE(I,J))
"RTN","ORWDPS2",72,0)
 . . S ILST=ILST+1
"RTN","ORWDPS2",73,0)
 . . S LST(ILST)="i"_$P(X,U,5)_U_$P($P(X,U,4),"&",6)_U_$P(X,U,4)
"RTN","ORWDPS2",74,0)
 Q
"RTN","ORWDPS2",75,0)
BLDDOSE(X) ; build dose info where X is ORDOSE node
"RTN","ORWDPS2",76,0)
 ; from ALLDOSE
"RTN","ORWDPS2",77,0)
 ;    X=TotalDose^Units^U/D^Noun^LocalDose^DispDrugIEN
"RTN","ORWDPS2",78,0)
 ;    Y=iDrugName^Strength^NF^TDose&Units&U/D&Noun&LDose&Drug&Stren&Units^
"RTN","ORWDPS2",79,0)
 ;      DoseText^CostText^MaxRefills^DispUnits^CanSplit
"RTN","ORWDPS2",80,0)
 ; DRUG=Name^Cost^NF^DispUnit^Strength^Units^DoseForm^MaxRefills^
"RTN","ORWDPS2",81,0)
 ; No TotalDose,           use LocalDose
"RTN","ORWDPS2",82,0)
 ; TotalDose & Strength,   use LocalDose+Conjunction+Strength+Units
"RTN","ORWDPS2",83,0)
 ; TotalDose, No Strength, use LocalDose+Conjunction+DispenseName
"RTN","ORWDPS2",84,0)
 S DD=+$P(X,U,6),DRUG=ORDOSE("DD",DD),DDNM=$P(DRUG,U),ID=$P(X,U,1,6)
"RTN","ORWDPS2",85,0)
 S LDOSE=$P(X,U,5),TEXT=LDOSE,STREN=$P(DRUG,U,5)_$P(DRUG,U,6)
"RTN","ORWDPS2",86,0)
 S $P(ID,U,7)=$P(DRUG,U,5) S $P(ID,U,8)=$P(DRUG,U,6) ; add strength
"RTN","ORWDPS2",87,0)
 I '$L($P(X,U)),$L($P(DRUG,U,5))  S TEXT=TEXT_CONJ_STREN
"RTN","ORWDPS2",88,0)
 I '$L($P(X,U)),'$L($P(DRUG,U,5)) S TEXT=TEXT_CONJ_$P(DRUG,U)
"RTN","ORWDPS2",89,0)
 S UD=$P(X,U,3),COST=$P(X,U,7),NF=$S($P(DRUG,U,3):"NF",1:"")
"RTN","ORWDPS2",90,0)
 ;I UD S COST="$"_$J(UD*$P(DRUG,U,2),1,3) ;_" per "_UD_" "_$P(X,U,4)
"RTN","ORWDPS2",91,0)
 S Y="i"_DDNM_U_STREN_U_NF_U_$TR(ID,U,"&")_U_TEXT_U_COST_U_$P(DRUG,U,8)_U_$P(DRUG,U,4)
"RTN","ORWDPS2",92,0)
 Q Y
"RTN","ORWDPS2",93,0)
ROUTE ; from OISLCT, get list of routes for the drug form
"RTN","ORWDPS2",94,0)
 ; ** NEED BOTH ABBREVIATION & NAME IN LIST BOX
"RTN","ORWDPS2",95,0)
 N I,CNT,ABBR,IEN,ROUT,EXP,X
"RTN","ORWDPS2",96,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS2",97,0)
 . S X=^TMP("PSJMR",$J,I)
"RTN","ORWDPS2",98,0)
 . S ROUT=$P(X,U),ABBR=$P(X,U,2),IEN=$P(X,U,3),EXP=$P(X,U,4)
"RTN","ORWDPS2",99,0)
 . S ILST=ILST+1,LST(ILST)="i"_IEN_U_ROUT_U_ABBR_U_EXP_U_$P(X,U,5)
"RTN","ORWDPS2",100,0)
 . I $P(X,U,6)="D",IEN S ILST=ILST+1,LST(ILST)="d"_IEN_U_ROUT ;_U_ABBR ; assume first always default
"RTN","ORWDPS2",101,0)
 ; add abbreviations to list of routes, commented out for 15.5 on
"RTN","ORWDPS2",102,0)
 ; S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS2",103,0)
 ; . S X=^TMP("PSJMR",$J,I)
"RTN","ORWDPS2",104,0)
 ; . S ROUT=$P(X,U),ABBR=$P(X,U,2),IEN=$P(X,U,3),EXP=$P(X,U,4)
"RTN","ORWDPS2",105,0)
 ; . I $L(ABBR),(ABBR'=ROUT) S ILST=ILST+1,LST(ILST)="i"_IEN_U_ABBR_" ("_ROUT_")"_U_ABBR_U_EXP
"RTN","ORWDPS2",106,0)
 Q
"RTN","ORWDPS2",107,0)
SCHED ; from OISLCT, get default schedule for this medication
"RTN","ORWDPS2",108,0)
 I $L($G(^TMP("PSJSCH",$J))) S ILST=ILST+1,LST(ILST)="d"_^($J)
"RTN","ORWDPS2",109,0)
 Q
"RTN","ORWDPS2",110,0)
GUIDE ; from OISLCT, get guidelines associated with this medication
"RTN","ORWDPS2",111,0)
 N IEN,I
"RTN","ORWDPS2",112,0)
 S IEN=0 F  S IEN=$O(^TMP("PSSDIN",$J,"OI",ORWPSOI,IEN)) Q:'IEN  D
"RTN","ORWDPS2",113,0)
 . S I=0 F  S I=$O(^TMP("PSSDIN",$J,"OI",ORWPSOI,IEN,I)) Q:'I  D
"RTN","ORWDPS2",114,0)
 . . S ILST=ILST+1,LST(ILST)="t"_^TMP("PSSDIN",$J,"OI",ORWPSOI,IEN,I)
"RTN","ORWDPS2",115,0)
 Q
"RTN","ORWDPS2",116,0)
OIMSG ; from OISLCT, get the orderable item message for this medication
"RTN","ORWDPS2",117,0)
 S I=0 F  S I=$O(^ORD(101.43,OI,8,I)) Q:I'>0  S ILST=ILST+1,LST(ILST)="t"_^(I,0)
"RTN","ORWDPS2",118,0)
 Q
"RTN","ORWDPS2",119,0)
ADMIN(REC,DFN,SCH,OI,LOC) ; return administration time info
"RTN","ORWDPS2",120,0)
 ; REC: StartText^StartTime^Duration^FirstAdmin
"RTN","ORWDPS2",121,0)
 S OI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS2",122,0)
 S LOC=+$G(^SC(LOC,42)),REC=""
"RTN","ORWDPS2",123,0)
 I $L($G(^DPT(DFN,.1))) S REC=$$FIRST^ORCDPS3(DFN,LOC,OI,SCH)
"RTN","ORWDPS2",124,0)
 Q
"RTN","ORWDPS2",125,0)
REQST(VAL,DFN,SCH,OI,LOC,TXT) ; return requested start time
"RTN","ORWDPS2",126,0)
 ; VAL: FirstAdmin time
"RTN","ORWDPS2",127,0)
 S VAL=""
"RTN","ORWDPS2",128,0)
 Q:'$L($G(SCH))  Q:'$G(OI)
"RTN","ORWDPS2",129,0)
 S OI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS2",130,0)
 S LOC=+$G(^SC(LOC,42))
"RTN","ORWDPS2",131,0)
 S VAL=$P($$RESOLVE^PSJORPOE(DFN,SCH,OI,TXT,LOC),U,2)
"RTN","ORWDPS2",132,0)
 Q
"RTN","ORWDPS2",133,0)
DAY2QTY(VAL,DAY,UPD,SCH,DUR,PAT,DRG) ; return qty for days supply
"RTN","ORWDPS2",134,0)
 ; VAL: quantity
"RTN","ORWDPS2",135,0)
 N ORWX,I,X,ADUR,ADURNM
"RTN","ORWDPS2",136,0)
 S ORWX("DAYS SUPPLY")=DAY
"RTN","ORWDPS2",137,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS2",138,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORWDPS2",139,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORWDPS2",140,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORWDPS2",141,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORWDPS2",142,0)
 . S ADUR=$P(DUR,U,I),ADURNM=$P($P(ADUR," ",2),"~")
"RTN","ORWDPS2",143,0)
 . S:ADURNM="MONTHS" X=+ADUR_"L"
"RTN","ORWDPS2",144,0)
 . S:ADURNM'="MONTHS" X=+ADUR_$E($P(ADUR," ",2))
"RTN","ORWDPS2",145,0)
 . I $L(X) S ORWX("DURATION",I)=X
"RTN","ORWDPS2",146,0)
 . S X=$E($P(ADUR,"~",2))
"RTN","ORWDPS2",147,0)
 . I $L(X) S ORWX("CONJUNCTION",I)=X
"RTN","ORWDPS2",148,0)
 D QTYX^PSOSIG(.ORWX)
"RTN","ORWDPS2",149,0)
 S VAL=$G(ORWX("QTY"))
"RTN","ORWDPS2",150,0)
 Q
"RTN","ORWDPS2",151,0)
QTY2DAY(VAL,QTY,UPD,SCH,DUR,PAT,DRG) ; return days supply given quantity
"RTN","ORWDPS2",152,0)
 ; VAL: days supply
"RTN","ORWDPS2",153,0)
 N ORWX,I,X,ADUR
"RTN","ORWDPS2",154,0)
 S ORWX("QTY")=QTY
"RTN","ORWDPS2",155,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS2",156,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORWDPS2",157,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORWDPS2",158,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORWDPS2",159,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORWDPS2",160,0)
 . S ADUR=$P(DUR,U,I),X=+ADUR_$E($P(ADUR," ",2))
"RTN","ORWDPS2",161,0)
 . I $L(X) S ORWX("DURATION",I)=X
"RTN","ORWDPS2",162,0)
 . S X=$E($P(ADUR,"~",2))
"RTN","ORWDPS2",163,0)
 . I $L(X) S ORWX("CONJUNCTION",I)=X
"RTN","ORWDPS2",164,0)
 D QTYX^PSOSIG(.ORWX)
"RTN","ORWDPS2",165,0)
 S VAL=$G(ORWX("DAYS SUPPLY"))
"RTN","ORWDPS2",166,0)
 Q
"RTN","ORWDPS2",167,0)
MAXREF(VAL,PAT,DRG,SUP,OI,OUT) ; return the maximum number of refills
"RTN","ORWDPS2",168,0)
 ; PAT=Patient DFN, DRG=ptr50, SUP=days supply, OI=orderable item
"RTN","ORWDPS2",169,0)
 ; VAL: maximum refills allowed
"RTN","ORWDPS2",170,0)
 N ORWX
"RTN","ORWDPS2",171,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS2",172,0)
 I $G(DRG) S ORWX("DRUG")=+DRG
"RTN","ORWDPS2",173,0)
 I $G(SUP) S ORWX("DAYS SUPPLY")=SUP
"RTN","ORWDPS2",174,0)
 I $G(OI)  S ORWX("ITEM")=+$P(^ORD(101.43,+OI,0),U,2)
"RTN","ORWDPS2",175,0)
 I $G(OUT) S ORWX("DISCHARGE")=1
"RTN","ORWDPS2",176,0)
 D MAX^PSOSIGDS(.ORWX)
"RTN","ORWDPS2",177,0)
 S VAL=$G(ORWX("MAX"))
"RTN","ORWDPS2",178,0)
 Q
"RTN","ORWDPS2",179,0)
SCHREQ(VAL,OI,RTE,DRG) ; return 1 if schedule is required
"RTN","ORWDPS2",180,0)
 ; OI=orderable item, RTE=ptr route, DRG=ptr dispense drug
"RTN","ORWDPS2",181,0)
 S VAL=1
"RTN","ORWDPS2",182,0)
 Q:'$G(OI)  Q:'$G(RTE)
"RTN","ORWDPS2",183,0)
 S VAL=$$SCHREQ^PSJORPOE(RTE,OI,+$G(DRG))
"RTN","ORWDPS2",184,0)
 Q
"RTN","ORWDPS2",185,0)
CHKPI(VAL,ODIFN) ; return pre-existing patient instruct
"RTN","ORWDPS2",186,0)
 N IDNUM,IDPI
"RTN","ORWDPS2",187,0)
 S (IDNUM,IDPI)=0,VAL=""
"RTN","ORWDPS2",188,0)
 I '$D(^OR(100,ODIFN,4.5,"ID","PI")) S VAL="" Q
"RTN","ORWDPS2",189,0)
 F  S IDNUM=$O(^OR(100,ODIFN,4.5,"ID","PI",IDNUM)) Q:'IDNUM  D
"RTN","ORWDPS2",190,0)
 . F  S IDPI=$O(^OR(100,ODIFN,4.5,IDNUM,2,IDPI)) Q:'IDPI  D
"RTN","ORWDPS2",191,0)
 .. S VAL=VAL_^OR(100,ODIFN,4.5,IDNUM,2,IDPI,0)
"RTN","ORWDPS2",192,0)
 K IDNUM,IDPI
"RTN","ORWDPS2",193,0)
 Q
"RTN","ORWDPS2",194,0)
CHKGRP(VAL,ORIFN) ;
"RTN","ORWDPS2",195,0)
 ;Inpatient Med Order Group or Clin Meds Group: return 1
"RTN","ORWDPS2",196,0)
 ;If order belong to Outpatient Med Order Grpoup: return 2 
"RTN","ORWDPS2",197,0)
 ;Otherwise, return 0
"RTN","ORWDPS2",198,0)
 S VAL=0
"RTN","ORWDPS2",199,0)
 I '$L(ORIFN) Q
"RTN","ORWDPS2",200,0)
 N UDGRP,IPGRP,OPGRP,ODGRP,ODID,CLMED
"RTN","ORWDPS2",201,0)
 S ODID=+ORIFN
"RTN","ORWDPS2",202,0)
 Q:ODID<1
"RTN","ORWDPS2",203,0)
 S (UDGRP,IPGRP,OPGRP,ODGRP,CLMED)=0
"RTN","ORWDPS2",204,0)
 S UDGRP=$O(^ORD(100.98,"B","UD RX",UDGRP))
"RTN","ORWDPS2",205,0)
 S OPGRP=$O(^ORD(100.98,"B","OUTPATIENT MEDICATIONS",OPGRP))
"RTN","ORWDPS2",206,0)
 S IPGRP=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",IPGRP))
"RTN","ORWDPS2",207,0)
 S CLMED=$O(^ORD(100.98,"B","CLINIC ORDERS",CLMED))
"RTN","ORWDPS2",208,0)
 S:IPGRP=0 IPGRP=$O(^ORD(100.98,"B","I RX",IPGRP))
"RTN","ORWDPS2",209,0)
 I $L($G(^OR(100,ODID,0)))<1 Q
"RTN","ORWDPS2",210,0)
 S ODGRP=$P(^OR(100,ODID,0),U,11)
"RTN","ORWDPS2",211,0)
 I (UDGRP=ODGRP)!(CLMED=ODGRP) S VAL=1
"RTN","ORWDPS2",212,0)
 I IPGRP=ODGRP S VAL=1
"RTN","ORWDPS2",213,0)
 I OPGRP=ODGRP S VAL=2
"RTN","ORWDPS2",214,0)
 K UDGRP,ODGRP,OPGRP,IPGRP,ODID,CLMED
"RTN","ORWDPS2",215,0)
 Q
"RTN","ORWDPS2",216,0)
QOGRP(VAL,QOIFN) ;
"RTN","ORWDPS2",217,0)
 ;If quick order belong to Inpatient Med Order Group: return 1
"RTN","ORWDPS2",218,0)
 ;Otherwise, return 0
"RTN","ORWDPS2",219,0)
 S VAL=0
"RTN","ORWDPS2",220,0)
 I '$L(QOIFN) Q
"RTN","ORWDPS2",221,0)
 N UDGRP,IPGRP,QOGRP,QOID,CLMED
"RTN","ORWDPS2",222,0)
 S QOID=+QOIFN
"RTN","ORWDPS2",223,0)
 Q:QOID<1
"RTN","ORWDPS2",224,0)
 S (UDGRP,IPGRP,QOGRP,CLMED)=0
"RTN","ORWDPS2",225,0)
 S UDGRP=$O(^ORD(100.98,"B","UD RX",UDGRP))
"RTN","ORWDPS2",226,0)
 S IPGRP=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",IPGRP))
"RTN","ORWDPS2",227,0)
 S CLMED=$O(^ORD(100.98,"B","CLINIC ORDERS",CLMED))
"RTN","ORWDPS2",228,0)
 S:IPGRP=0 IPGRP=$O(^ORD(100.98,"B","I RX",IPGRP))
"RTN","ORWDPS2",229,0)
 I $L($G(^ORD(101.41,QOID,0)))<1 Q
"RTN","ORWDPS2",230,0)
 S QOGRP=$P(^ORD(101.41,QOID,0),U,5)
"RTN","ORWDPS2",231,0)
 I UDGRP=QOGRP S VAL=1
"RTN","ORWDPS2",232,0)
 I (IPGRP=QOGRP)!(CLMED=QOGRP) S VAL=1
"RTN","ORWDPS2",233,0)
 K UDGRP,QOGRP,QOID,IPGRP,CLMED
"RTN","ORWDPS2",234,0)
 Q
"RTN","ORY258")
0^1^B1830631
"RTN","ORY258",1,0)
ORY258 ;SLCOIFO - Post-init for patch OR*3*258 ;5/30/06  11:36
"RTN","ORY258",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**258**;Dec 17, 1997;Build 7
"RTN","ORY258",3,0)
 ;
"RTN","ORY258",4,0)
PRE ; initiate pre-init processes
"RTN","ORY258",5,0)
 ;
"RTN","ORY258",6,0)
 Q
"RTN","ORY258",7,0)
 ;
"RTN","ORY258",8,0)
POST ; initiate post-init processes
"RTN","ORY258",9,0)
 ;
"RTN","ORY258",10,0)
 D MAIL
"RTN","ORY258",11,0)
 Q
"RTN","ORY258",12,0)
 ;
"RTN","ORY258",13,0)
MAIL ; send bulletin of installation time
"RTN","ORY258",14,0)
 N DA,DIE,DR,VERSNUM,NAME,OPTIEN
"RTN","ORY258",15,0)
 S DA=$O(^DIC(19,"B","OR CPRS GUI CHART","")) Q:DA'>0
"RTN","ORY258",16,0)
 ;Change to versnum to store the new version number
"RTN","ORY258",17,0)
 S VERSNUM="CPRSChart version 1.0.26.68"
"RTN","ORY258",18,0)
 S DIE="^DIC(19,",DR="1////^S X=VERSNUM" D ^DIE
"RTN","ORY258",19,0)
 ;
"RTN","ORY258",20,0)
 N COUNT,DIFROM,I,START,TEXT,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","ORY258",21,0)
 S COUNT=0,XMDUZ="CPRS PACKAGE",XMTEXT="TEXT("
"RTN","ORY258",22,0)
 S XMSUB="Version "_$P($T(VERSION),";;",2)_" Installed"
"RTN","ORY258",23,0)
 F I="G.CPRS GUI INSTALL@ISC-SLC.VA.GOV",DUZ S XMY(I)=""
"RTN","ORY258",24,0)
 ;
"RTN","ORY258",25,0)
 S X=$P($T(VERSION),";;",2)
"RTN","ORY258",26,0)
 D LINE("Version "_X_" has been installed.")
"RTN","ORY258",27,0)
 D LINE(" ")
"RTN","ORY258",28,0)
 D LINE("Install complete:  "_$$FMTE^XLFDT($$NOW^XLFDT()))
"RTN","ORY258",29,0)
 ;
"RTN","ORY258",30,0)
 D ^XMD
"RTN","ORY258",31,0)
 Q
"RTN","ORY258",32,0)
 ;
"RTN","ORY258",33,0)
LINE(DATA) ; set text into array
"RTN","ORY258",34,0)
 S COUNT=COUNT+1
"RTN","ORY258",35,0)
 S TEXT(COUNT)=DATA
"RTN","ORY258",36,0)
 Q
"RTN","ORY258",37,0)
 ;
"RTN","ORY258",38,0)
VERSION ;;26.68
"VER")
8.0^22.0
**END**
**END**
