Released PSU*3*31 SEQ #28
Extracted from mail message
**KIDS**:PSU*3.0*31^

**INSTALL NAME**
PSU*3.0*31
"BLD",5064,0)
PSU*3.0*31^PHARMACY BENEFITS MANAGEMENT^0^3031030^y
"BLD",5064,1,0)
^^2^2^3031002^
"BLD",5064,1,1,0)
MISSING DIVISION NAMES ON OUTPATIENT DATA WHEN THERE ARE MULTIPLE ENTRIES 
"BLD",5064,1,2,0)
IN FILE 59 (OUTPATIENT SITE) WITH THE SAME SITE NUMBER.
"BLD",5064,4,0)
^9.64PA^^0
"BLD",5064,"ABPKG")
n
"BLD",5064,"KRN",0)
^9.67PA^8989.52^19
"BLD",5064,"KRN",.4,0)
.4
"BLD",5064,"KRN",.401,0)
.401
"BLD",5064,"KRN",.402,0)
.402
"BLD",5064,"KRN",.403,0)
.403
"BLD",5064,"KRN",.5,0)
.5
"BLD",5064,"KRN",.84,0)
.84
"BLD",5064,"KRN",3.6,0)
3.6
"BLD",5064,"KRN",3.8,0)
3.8
"BLD",5064,"KRN",9.2,0)
9.2
"BLD",5064,"KRN",9.8,0)
9.8
"BLD",5064,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",5064,"KRN",9.8,"NM",1,0)
PSULR5^^0^B25978190
"BLD",5064,"KRN",9.8,"NM",2,0)
PSUOP3^^0^B24094388
"BLD",5064,"KRN",9.8,"NM",3,0)
PSUOP4^^0^B15215079
"BLD",5064,"KRN",9.8,"NM",4,0)
PSUOP6^^0^B14153770
"BLD",5064,"KRN",9.8,"NM","B","PSULR5",1)
 
"BLD",5064,"KRN",9.8,"NM","B","PSUOP3",2)
 
"BLD",5064,"KRN",9.8,"NM","B","PSUOP4",3)
 
"BLD",5064,"KRN",9.8,"NM","B","PSUOP6",4)
 
"BLD",5064,"KRN",19,0)
19
"BLD",5064,"KRN",19,"NM",0)
^9.68A^^0
"BLD",5064,"KRN",19.1,0)
19.1
"BLD",5064,"KRN",101,0)
101
"BLD",5064,"KRN",409.61,0)
409.61
"BLD",5064,"KRN",771,0)
771
"BLD",5064,"KRN",771,"NM",0)
^9.68A^^0
"BLD",5064,"KRN",870,0)
870
"BLD",5064,"KRN",8989.51,0)
8989.51
"BLD",5064,"KRN",8989.52,0)
8989.52
"BLD",5064,"KRN",8994,0)
8994
"BLD",5064,"KRN","B",.4,.4)
 
"BLD",5064,"KRN","B",.401,.401)
 
"BLD",5064,"KRN","B",.402,.402)
 
"BLD",5064,"KRN","B",.403,.403)
 
"BLD",5064,"KRN","B",.5,.5)
 
"BLD",5064,"KRN","B",.84,.84)
 
"BLD",5064,"KRN","B",3.6,3.6)
 
"BLD",5064,"KRN","B",3.8,3.8)
 
"BLD",5064,"KRN","B",9.2,9.2)
 
"BLD",5064,"KRN","B",9.8,9.8)
 
"BLD",5064,"KRN","B",19,19)
 
"BLD",5064,"KRN","B",19.1,19.1)
 
"BLD",5064,"KRN","B",101,101)
 
"BLD",5064,"KRN","B",409.61,409.61)
 
"BLD",5064,"KRN","B",771,771)
 
"BLD",5064,"KRN","B",870,870)
 
"BLD",5064,"KRN","B",8989.51,8989.51)
 
"BLD",5064,"KRN","B",8989.52,8989.52)
 
"BLD",5064,"KRN","B",8994,8994)
 
"BLD",5064,"QUES",0)
^9.62^^
"BLD",5064,"REQB",0)
^9.611^2^2
"BLD",5064,"REQB",1,0)
PSU*3.0*24^1
"BLD",5064,"REQB",2,0)
PSU*3.0*26^1
"BLD",5064,"REQB","B","PSU*3.0*24",1)
 
"BLD",5064,"REQB","B","PSU*3.0*26",2)
 
"MBREQ")
0
"PKG",541,-1)
1^1
"PKG",541,0)
PHARMACY BENEFITS MANAGEMENT^PSU^PHARMACY BENEFITS MANAGEMENT
"PKG",541,20,0)
^9.402P^^
"PKG",541,22,0)
^9.49I^1^1
"PKG",541,22,1,0)
3.0^2981015^3010116^66481
"PKG",541,22,1,"PAH",1,0)
31^3031030
"PKG",541,22,1,"PAH",1,1,0)
^^2^2^3031030
"PKG",541,22,1,"PAH",1,1,1,0)
MISSING DIVISION NAMES ON OUTPATIENT DATA WHEN THERE ARE MULTIPLE ENTRIES 
"PKG",541,22,1,"PAH",1,1,2,0)
IN FILE 59 (OUTPATIENT SITE) WITH THE SAME SITE NUMBER.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSULR5")
0^1^B25978190
"RTN","PSULR5",1,0)
PSULR5 ;BIR/PDW - LAB extract summary message generator ;10 JUL 1999
"RTN","PSULR5",2,0)
 ;;3.0;PHARMACY BENEFITS MANAGEMENT;**1,7,19,20,31**;Oct 15, 1998
"RTN","PSULR5",3,0)
 ;DBIA(s)
"RTN","PSULR5",4,0)
 ; Reference to file 40.8 supported by DBIA 2438
"RTN","PSULR5",5,0)
 ;
"RTN","PSULR5",6,0)
EN ;EP generate Total & Cost summary
"RTN","PSULR5",7,0)
EN1 N PSUITT,PSUREC
"RTN","PSULR5",8,0)
 S:'$D(PSULRJOB) PSULRJOB=PSUJOB
"RTN","PSULR5",9,0)
 S:'$D(PSULRSUB) PSULRSUB="PSULR_"_PSULRJOB
"RTN","PSULR5",10,0)
 ;
"RTN","PSULR5",11,0)
 ;S PSUSDT=2970101
"RTN","PSULR5",12,0)
 ;S PSUEDT=2980501
"RTN","PSULR5",13,0)
 I '$D(^XTMP(PSULRSUB,"RECORDS")) G NODATA
"RTN","PSULR5",14,0)
DIV ;EP Loop by Division
"RTN","PSULR5",15,0)
 S PSUDIV="" F  S PSUDIV=$O(^XTMP(PSULRSUB,"SUMMARY",PSUDIV)) Q:PSUDIV=""  D MESSAGE
"RTN","PSULR5",16,0)
 Q
"RTN","PSULR5",17,0)
 ;
"RTN","PSULR5",18,0)
MESSAGE ;EP Generate Summary Messages for a Division
"RTN","PSULR5",19,0)
 ;
"RTN","PSULR5",20,0)
 ;S X=PSUDIV,DIC=40.8,DIC(0)="X",D="C" D IX^DIC ;**1
"RTN","PSULR5",21,0)
 ;S X=+Y S PSUDIVNM=$$VAL^PSUTL(40.8,X,.01)
"RTN","PSULR5",22,0)
MSG1 ;  Generate 1st summary message
"RTN","PSULR5",23,0)
 ;
"RTN","PSULR5",24,0)
 S PSUT=0,PSUP=0 ; test & patient counters
"RTN","PSULR5",25,0)
 ;   loop to get totals from records stored
"RTN","PSULR5",26,0)
 S DFN=0
"RTN","PSULR5",27,0)
 F  S DFN=$O(^XTMP(PSULRSUB,"SUMMARY",PSUDIV,DFN)) Q:DFN'>0  S PSUP=PSUP+1 D
"RTN","PSULR5",28,0)
 . S PSUDC="" F  S PSUDC=$O(^XTMP(PSULRSUB,"SUMMARY",PSUDIV,DFN,PSUDC)) Q:PSUDC=""  D
"RTN","PSULR5",29,0)
 .. S PSUND=0
"RTN","PSULR5",30,0)
 .. F  S PSUND=$O(^XTMP(PSULRSUB,"SUMMARY",PSUDIV,DFN,PSUDC,PSUND)) Q:PSUND'>0  S PSUT=PSUT+1
"RTN","PSULR5",31,0)
 ;
"RTN","PSULR5",32,0)
 S XMDUZ=DUZ
"RTN","PSULR5",33,0)
 M XMY=PSUXMYS1
"RTN","PSULR5",34,0)
 ;
"RTN","PSULR5",35,0)
 S Y=PSUSDT X ^DD("DD") S PSUDTS=Y ;    start date
"RTN","PSULR5",36,0)
 S Y=PSUEDT X ^DD("DD") S PSUDTE=Y ;    end date
"RTN","PSULR5",37,0)
 N PSUMSG
"RTN","PSULR5",38,0)
 S X=PSUDIV,DIC=40.8,DIC(0)="X",D="C" D IX^DIC ;**1
"RTN","PSULR5",39,0)
 S X=+Y S PSUDIVNM=$$VAL^PSUTL(40.8,X,.01)
"RTN","PSULR5",40,0)
 ;
"RTN","PSULR5",41,0)
 I $D(^XTMP("PSU_"_PSUJOB,"DIV",PSUDIV)) D
"RTN","PSULR5",42,0)
 .;VMP OIFO BAY PINES;ELR;PSU*3.0*31
"RTN","PSULR5",43,0)
 .I '$L($P($G(^XTMP("PSU_"_PSUJOB,"DIV",PSUDIV)),U,1)) Q
"RTN","PSULR5",44,0)
 .S PSUDIVNM=$P(^XTMP("PSU_"_PSUJOB,"DIV",PSUDIV),U,1)
"RTN","PSULR5",45,0)
 ;
"RTN","PSULR5",46,0)
 S PSUMSG(1)="               Laboratory Statistical Summary"
"RTN","PSULR5",47,0)
 S PSUMSG(2)="               "_PSUDTS_" through "_PSUDTE_" for "_PSUDIVNM
"RTN","PSULR5",48,0)
 S PSUMSG(3)="      "
"RTN","PSULR5",49,0)
 S PSUMSG(4)="Total Patients          "_PSUP
"RTN","PSULR5",50,0)
 S PSUMSG(5)="Total Laboratory Tests  "_PSUT
"RTN","PSULR5",51,0)
 S PSUMSG(6)="   "
"RTN","PSULR5",52,0)
 S XMSUB="V. 3.0P1 PBMLR "_$G(PSUMON)_"  "_PSUDIV_" "_PSUDIVNM
"RTN","PSULR5",53,0)
 S XMTEXT="PSUMSG("
"RTN","PSULR5",54,0)
 S XMCHAN=1
"RTN","PSULR5",55,0)
 D ^XMD
"RTN","PSULR5",56,0)
 M ^XTMP(PSULRSUB,"REPORT1",PSUDIV)=PSUMSG
"RTN","PSULR5",57,0)
 K PSUMSG
"RTN","PSULR5",58,0)
 ;
"RTN","PSULR5",59,0)
MSG2 ; SUMMARY BY PATIENT
"RTN","PSULR5",60,0)
 ;
"RTN","PSULR5",61,0)
 ;
"RTN","PSULR5",62,0)
 S PSUG="^XTMP(PSULRSUB,""REPORT2"",PSUDIV)"
"RTN","PSULR5",63,0)
 K @PSUG
"RTN","PSULR5",64,0)
 S @PSUG@(1)="               Laboratory Data Summary"
"RTN","PSULR5",65,0)
 S @PSUG@(2)="               "_PSUDTS_" through "_PSUDTE_" for "_PSUDIVNM
"RTN","PSULR5",66,0)
 S @PSUG@(3)=" "
"RTN","PSULR5",67,0)
 S X="Patient SSN"
"RTN","PSULR5",68,0)
 S X=$$SETSTR^VALM1("VA CODE",X,15,7)
"RTN","PSULR5",69,0)
 S X=$$SETSTR^VALM1("Laboratory",X,24,10)
"RTN","PSULR5",70,0)
 S X=$$SETSTR^VALM1("Results",X,42,7)
"RTN","PSULR5",71,0)
 S X=$$SETSTR^VALM1("Flag",X,57,4)
"RTN","PSULR5",72,0)
 S X=$$SETSTR^VALM1("Date/Time Taken",X,63,15)
"RTN","PSULR5",73,0)
 S @PSUG@(4)=X
"RTN","PSULR5",74,0)
 S X="",$P(X,"-",79)=""
"RTN","PSULR5",75,0)
 S @PSUG@(5)=X
"RTN","PSULR5",76,0)
 S PSULC=5
"RTN","PSULR5",77,0)
 ;  loop records stored
"RTN","PSULR5",78,0)
 S DFN=0,DFN1="",PSUCD1=""
"RTN","PSULR5",79,0)
 F  S DFN=$O(^XTMP(PSULRSUB,"SUMMARY",PSUDIV,DFN)) Q:DFN'>0  D  S DFN1=DFN
"RTN","PSULR5",80,0)
 . ;  loop drug codes
"RTN","PSULR5",81,0)
 . S PSUCD=""
"RTN","PSULR5",82,0)
 . F  S PSUCD=$O(^XTMP(PSULRSUB,"SUMMARY",PSUDIV,DFN,PSUCD)) Q:PSUCD=""  D  S PSUCD1=PSUCD
"RTN","PSULR5",83,0)
 .. ; loop tests  
"RTN","PSULR5",84,0)
 .. S PSUND=0
"RTN","PSULR5",85,0)
 .. F  S PSUND=$O(^XTMP(PSULRSUB,"SUMMARY",PSUDIV,DFN,PSUCD,PSUND)) Q:PSUND'>0  D SET
"RTN","PSULR5",86,0)
 ;
"RTN","PSULR5",87,0)
 S @PSUG@(PSULC+1)="   "
"RTN","PSULR5",88,0)
 S XMSUB="V. 3.0P1 PBMLR "_$G(PSUMON)_"  "_PSUDIV_" "_PSUDIVNM
"RTN","PSULR5",89,0)
 S XMTEXT="^XTMP(PSULRSUB,""REPORT2"",PSUDIV,"
"RTN","PSULR5",90,0)
 S XMCHAN=1
"RTN","PSULR5",91,0)
 M XMY=PSUXMYS2
"RTN","PSULR5",92,0)
 I '$G(PSUSMRY) D ^XMD
"RTN","PSULR5",93,0)
 Q
"RTN","PSULR5",94,0)
 ;
"RTN","PSULR5",95,0)
SET ;EP  Set data into message
"RTN","PSULR5",96,0)
 ;
"RTN","PSULR5",97,0)
 S X=^XTMP(PSULRSUB,"SUMMARY",PSUDIV,DFN,PSUCD,PSUND)
"RTN","PSULR5",98,0)
 S PSULRT=$P(X,U),PSULRR=$P(X,U,2)
"RTN","PSULR5",99,0)
 S PSULD=$P(X,U,3),PSULRF=$P(X,U,4)
"RTN","PSULR5",100,0)
 S PSULD0=$E(PSULD,4,5)_"/"_$E(PSULD,6,7)_"/"_$E(PSULD,2,3)
"RTN","PSULR5",101,0)
 S X=$P(PSULD,".",2),X=$E(X,1,4) F  Q:$L(X)=4  S X=X_0 ; fill time
"RTN","PSULR5",102,0)
 S PSULD=PSULD0_" "_X
"RTN","PSULR5",103,0)
 S X=""
"RTN","PSULR5",104,0)
 I DFN=DFN1
"RTN","PSULR5",105,0)
 E  D PID^VADPT S X=$TR(VA("PID"),"-",""),DFN1=DFN,PSUCD1="" K VA
"RTN","PSULR5",106,0)
 I PSUCD1=PSUCD
"RTN","PSULR5",107,0)
 E  S X=$$SETSTR^VALM1(PSUCD,X,15,5) S PSUCD1=PSUCD
"RTN","PSULR5",108,0)
 S X=$$SETSTR^VALM1(PSULRT,X,24,$L(PSULRT))
"RTN","PSULR5",109,0)
 S X=$$SETSTR^VALM1(PSULRR,X,42,$L(PSULRR))
"RTN","PSULR5",110,0)
 S X=$$SETSTR^VALM1(PSULRF,X,57,$L(PSULRF))
"RTN","PSULR5",111,0)
 S X=$$SETSTR^VALM1(PSULD,X,63,$L(PSULD))
"RTN","PSULR5",112,0)
 S PSULC=PSULC+1
"RTN","PSULR5",113,0)
 S @PSUG@(PSULC)=X
"RTN","PSULR5",114,0)
 ;
"RTN","PSULR5",115,0)
 Q
"RTN","PSULR5",116,0)
NODATA ;EP SEND NO DATA MESSAGE
"RTN","PSULR5",117,0)
 S XMDUZ=DUZ
"RTN","PSULR5",118,0)
 M XMY=PSUXMYS1
"RTN","PSULR5",119,0)
 ;
"RTN","PSULR5",120,0)
 S Y=PSUSDT X ^DD("DD") S PSUDTS=Y ;    start date
"RTN","PSULR5",121,0)
 S Y=PSUEDT X ^DD("DD") S PSUDTE=Y ;    end date
"RTN","PSULR5",122,0)
 S PSUDIV=PSUSNDR
"RTN","PSULR5",123,0)
 S X=PSUDIV,DIC=40.8,DIC(0)="X",D="C" D IX^DIC ;**1
"RTN","PSULR5",124,0)
 S X=+Y S PSUDIVNM=$$VAL^PSUTL(40.8,X,.01)
"RTN","PSULR5",125,0)
 S XMSUB="V. 3.0P1 PBMLR "_$G(PSUMON)_"  "_PSUDIV_" "_PSUDIVNM
"RTN","PSULR5",126,0)
 S XMTEXT="^XTMP(PSULRSUB,""REPORT2"",PSUDIV,"
"RTN","PSULR5",127,0)
 S XMCHAN=1
"RTN","PSULR5",128,0)
 K X
"RTN","PSULR5",129,0)
 S X(1)="               Laboratory Statistical Summary"
"RTN","PSULR5",130,0)
 S X(2)="               "_PSUDTS_" through "_PSUDTE_" for "_PSUDIVNM
"RTN","PSULR5",131,0)
 S X(3)="    "
"RTN","PSULR5",132,0)
 S X(4)="No data to report"
"RTN","PSULR5",133,0)
 S X(5)="     "
"RTN","PSULR5",134,0)
 S XMTEXT="X("
"RTN","PSULR5",135,0)
 S:$G(PSUDUZ) XMY(PSUDUZ)=""
"RTN","PSULR5",136,0)
 D ^XMD
"RTN","PSULR5",137,0)
 M ^XTMP(PSULRSUB,"REPORT1",PSUDIV)=X
"RTN","PSULR5",138,0)
 S XMSUB="V. 3.0P1 PBMPR "_$G(PSUMON)_"  "_PSUDIV_" "_PSUDIVNM
"RTN","PSULR5",139,0)
 S X(1)="               Laboratory Data Summary"
"RTN","PSULR5",140,0)
 M ^XTMP(PSULRSUB,"REPORT2",PSUDIV)=X ;store for print cycle
"RTN","PSULR5",141,0)
 Q
"RTN","PSUOP3")
0^2^B24094388
"RTN","PSUOP3",1,0)
PSUOP3 ;BIR/CFL,TJH,PDW-PSU PBM Outpatient Pharmacy shared variables for vers. 6 & 7 ;08/25/2003
"RTN","PSUOP3",2,0)
 ;;3.0;PHARMACY BENEFITS MANAGEMENT;**14,19,20,28,30,24,31**;Oct 15, 1998
"RTN","PSUOP3",3,0)
 ;
"RTN","PSUOP3",4,0)
 ; Reference to file #7 supported by DBIA 2495
"RTN","PSUOP3",5,0)
 ; Reference to file #50 supported by DBIA 221
"RTN","PSUOP3",6,0)
 ; Reference to file #53 supported by DBIA 2511
"RTN","PSUOP3",7,0)
 ; Reference to file #59 supported by DBIA 2510
"RTN","PSUOP3",8,0)
 ; Reference to file #200 supported by DBIA 10060
"RTN","PSUOP3",9,0)
 ; Reference to file #49  supported by DBIA 10093
"RTN","PSUOP3",10,0)
 ; Reference to file #52  supported by DBIA 2512
"RTN","PSUOP3",11,0)
 ;
"RTN","PSUOP3",12,0)
PROVDR ;Get provider data, site number and AMIS category
"RTN","PSUOP3",13,0)
 S PSUSITE=$S(PSUDIVP="":PSUSNDR,1:$$VALI^PSUTL(59,PSUDIVP,.06))
"RTN","PSUOP3",14,0)
 ;
"RTN","PSUOP3",15,0)
 ;Create storage global of division numbers and names for lab msgs.
"RTN","PSUOP3",16,0)
 S X=PSUSITE,DIC=59,DIC(0)="XM" D ^DIC
"RTN","PSUOP3",17,0)
 S X=+Y,PSUDIVNM=$$VAL^PSUTL(59,X,.01)
"RTN","PSUOP3",18,0)
 ;VMP OIFO BAY PINES;ELR;PSU*3.0*31
"RTN","PSUOP3",19,0)
 I '$L(PSUDIVNM) S X=PSUSITE D DIVNM^PSUOP6
"RTN","PSUOP3",20,0)
 S ^XTMP("PSU_"_PSUJOB,"DIV",PSUSITE)=PSUDIVNM
"RTN","PSUOP3",21,0)
 ;
"RTN","PSUOP3",22,0)
GETVAR ;Get shared variables
"RTN","PSUOP3",23,0)
 ;Get AMIS workload category
"RTN","PSUOP3",24,0)
 S PSUPST=$$VALI^PSUTL(53,PSURXP,6)
"RTN","PSUOP3",25,0)
 S PSUSC=$S(PSUPST=1:"SC",PSUPST=2:"AA",PSUPST=3:"OT",PSUPST=4:"IP",1:"")
"RTN","PSUOP3",26,0)
 S:$$GET1^DIQ(52,PSURXIEN,201)="YES" PSUSC="NVA"
"RTN","PSUOP3",27,0)
 K PSUPROV
"RTN","PSUOP3",28,0)
 D GETS^PSUTL(200,PSUPRID,"9;29;53.5;53.6","PSUPROV","I")
"RTN","PSUOP3",29,0)
 I '$D(PSUPROV) D NOPROV Q
"RTN","PSUOP3",30,0)
 D MOVEI^PSUTL("PSUPROV")
"RTN","PSUOP3",31,0)
 S PSUPRSSN=PSUPROV(9)
"RTN","PSUOP3",32,0)
 I PSUPRSSN="" S PSUPRSSN=999999999
"RTN","PSUOP3",33,0)
 S ^XTMP("PSU_"_PSUJOB,"PSUPDR",PSUPRSSN,PSUPRID)=""
"RTN","PSUOP3",34,0)
 S PSUDOC(9)=PSUPRSSN
"RTN","PSUOP3",35,0)
 S PSUPTYP=$S(PSUPROV(53.6)=4:"F",1:"S")
"RTN","PSUOP3",36,0)
 S:$$GET1^DIQ(52,PSURXIEN,201)="YES" PSUPTYP="NVA"
"RTN","PSUOP3",37,0)
 S PSUPCLS="" I PSUPROV(53.5)'="" D
"RTN","PSUOP3",38,0)
 .S PSUPCLS=$$VALI^PSUTL(7,PSUPROV(53.5),1)
"RTN","PSUOP3",39,0)
 .I PSUPCLS="" S PSUPCLS=$$VALI^PSUTL(7,PSUPROV(53.5),.01)
"RTN","PSUOP3",40,0)
 S PSUPSV=$S($L(PSUPROV(29)):$$VAL^PSUTL(49,PSUPROV(29),.01),1:"")
"RTN","PSUOP3",41,0)
 S PSUPSV=$$UPPER^PSUTL(PSUPSV),PSUPSERV=""
"RTN","PSUOP3",42,0)
 I $L(PSUPSV),$D(PSECT(PSUPSV)) S PSUPSERV=PSECT(PSUPSV)
"RTN","PSUOP3",43,0)
 S PSUSPTY=$$GET^XUA4A72(PSUPRID,PSUFDT)
"RTN","PSUOP3",44,0)
 S PSUSP1=$P(PSUSPTY,U,3),PSUSP2=$P(PSUSPTY,U,4)
"RTN","PSUOP3",45,0)
 ;
"RTN","PSUOP3",46,0)
 Q
"RTN","PSUOP3",47,0)
 ;
"RTN","PSUOP3",48,0)
NOPROV ; set up PSUPROV array when provider isn't found in ^VA(200
"RTN","PSUOP3",49,0)
 F I=9,29,53.5,53.6 S PSUPROV(I)=""
"RTN","PSUOP3",50,0)
 S (PSUPRSSN,PSUPTYP,PSUPCLS,PSUPSERV,PSUSP1,PSUSP2)=""
"RTN","PSUOP3",51,0)
 Q
"RTN","PSUOP3",52,0)
GETDRUG ;Get drug data
"RTN","PSUOP3",53,0)
 K PSUDRUG
"RTN","PSUOP3",54,0)
 D GETS^PSUTL(50,PSUDR,".01;2;3;14.5;20;21;22;25;31;51;52","PSUDRUG","I")
"RTN","PSUOP3",55,0)
 D MOVEI^PSUTL("PSUDRUG")
"RTN","PSUOP3",56,0)
 I '$D(PSUDRUG) F I=.01,2,3,14.5,20,21,22,25,31,51,52 S PSUDRUG(I)=""
"RTN","PSUOP3",57,0)
 S PSUGNM=PSUDRUG(.01)
"RTN","PSUOP3",58,0)
 I PSUGNM="" S PSUGNM="Unknown Generic Name"
"RTN","PSUOP3",59,0)
 S PSUVANM=PSUDRUG(21)
"RTN","PSUOP3",60,0)
 I PSUVANM="" S PSUVANM="Unknown VA Product Name"
"RTN","PSUOP3",61,0)
 S PSUDEA=PSUDRUG(3)
"RTN","PSUOP3",62,0)
 S PSUNFI=$S(PSUDRUG(51)=1:"N/F",1:"")
"RTN","PSUOP3",63,0)
 S PSUDUN=PSUDRUG(14.5)
"RTN","PSUOP3",64,0)
 S PSUVACLS=PSUDRUG(2)
"RTN","PSUOP3",65,0)
 S PSUNDCL=PSUDRUG(22)
"RTN","PSUOP3",66,0)
 S PSUNAF=$S(PSUDRUG(52):"N/F",1:"")
"RTN","PSUOP3",67,0)
 S PSUNADR=PSUDRUG(20)
"RTN","PSUOP3",68,0)
 ;Get the National Formulary Indicator and Restriction
"RTN","PSUOP3",69,0)
 S (PSOPNFI,PSOPNFR)=""
"RTN","PSUOP3",70,0)
 I $$VERSION^XPDUTL("PSN")'<4 D
"RTN","PSUOP3",71,0)
 .S PSOPNFI=$$FORMI^PSNAPIS(PSUNADR,PSUNDCL)
"RTN","PSUOP3",72,0)
 .S PSOPNFR=$$FORMR^PSNAPIS(PSUNADR,PSUNDCL)
"RTN","PSUOP3",73,0)
GETDRUGQ Q
"RTN","PSUOP3",74,0)
 ;
"RTN","PSUOP3",75,0)
SETREC ;Set the record into the ^XTMP global
"RTN","PSUOP3",76,0)
 S:PSUDIVP="" PSUDIVP=PSUSNDR
"RTN","PSUOP3",77,0)
 S REC1="^",REC2="*",PSU2U="^"
"RTN","PSUOP3",78,0)
 S REC1=REC1_$TR(PSUSITE,"^","'")_PSU2U_$TR(PSUFD,"^","'")_PSU2U
"RTN","PSUOP3",79,0)
 S REC1=REC1_$TR(PSURELDT,"^","'")_PSU2U_$TR(PSURXN,"^","'")_PSU2U
"RTN","PSUOP3",80,0)
 S REC1=REC1_$TR(PSUSC,"^","'")_PSU2U_PSUSSN_PSU2U_$TR(PSUVANM,"^","'")_PSU2U
"RTN","PSUOP3",81,0)
 S REC1=REC1_$TR(PSUVACLS,"^","'")_PSU2U_$TR(PSUGNM,"^","'")_PSU2U
"RTN","PSUOP3",82,0)
 S REC1=REC1_$TR(PSUNDC,"^","'")_PSU2U_$TR(PSUNFI,"^","'")_PSU2U
"RTN","PSUOP3",83,0)
 S REC1=REC1_$TR(PSOPNFI,"^","'")_PSU2U_$TR(PSOPNFR,"^","'")_PSU2U
"RTN","PSUOP3",84,0)
 S REC1=REC1_$TR(PSUDEA,"^","'")_PSU2U_$TR(PSUTYP,"^","'")_PSU2U
"RTN","PSUOP3",85,0)
 S REC1=REC1_$TR(PSUCMOP,"^","'")_PSU2U_$TR(PSUMW,"^","'")_PSU2U
"RTN","PSUOP3",86,0)
 S REC1=REC1_$TR(PSUPRSSN,"^","'")_PSU2U_$TR(PSUPTYP,"^","'")_PSU2U
"RTN","PSUOP3",87,0)
 ;S REC1=REC1_$TR(PSUPCLS,"^","'")_PSU2U_$TR(PSUPSERV,"^","'")_PSU2U
"RTN","PSUOP3",88,0)
 ;S REC2=REC2_$TR(PSUSP1,"^","'")_PSU2U_$TR(PSUSP2,"^","'")_PSU2U
"RTN","PSUOP3",89,0)
 S REC2=REC2_$TR(PSUSIG,"^","'")_PSU2U_$TR(PSUWPC,"^","'")_PSU2U
"RTN","PSUOP3",90,0)
 S REC2=REC2_$TR(PSUDUN,"^","'")_PSU2U_$TR(PSUDRCT,"^","'")_PSU2U
"RTN","PSUOP3",91,0)
 S REC2=REC2_$TR(PSUDS,"^","'")_PSU2U_$TR(PSUQTY,"^","'")_PSU2U_PSUNAF_U
"RTN","PSUOP3",92,0)
 ;VMP OIFO BAY PINES;ELR;PSU*3.0*24
"RTN","PSUOP3",93,0)
 D ICN^PSUIV1 S PSUPICN=$G(^XTMP("PSU_"_PSUJOB,"PSUPICN"))
"RTN","PSUOP3",94,0)
 S REC2=REC2_$G(PSUPICN)_PSU2U_PSUPRID_PSU2U_$G(PSUCAN)_"^"
"RTN","PSUOP3",95,0)
 S PSURCT=1+$P($G(^XTMP(PSUOPSUB,"DATA",PSUSITE,PSURXIEN,0)),U,1)
"RTN","PSUOP3",96,0)
 S ^XTMP(PSUOPSUB,"DATA",PSUSITE,PSURXIEN,PSURCT,1)=REC1
"RTN","PSUOP3",97,0)
 S ^XTMP(PSUOPSUB,"DATA",PSUSITE,PSURXIEN,PSURCT,2)=REC2
"RTN","PSUOP3",98,0)
 S $P(^XTMP(PSUOPSUB,"DATA",PSUSITE,PSURXIEN,0),U,1)=PSURCT
"RTN","PSUOP3",99,0)
 I (($E(OPVER)=6)&(PSUTYP="P"))!($E(OPVER)>6) S ^XTMP(PSUOPSUB,"RXIEN",PSURXIEN)=""
"RTN","PSUOP3",100,0)
 I '$D(^XTMP("PSU_"_PSUJOB,"PSUOPFLG")) D
"RTN","PSUOP3",101,0)
 .D LAB^PSULR0("OP",PSUSITE,PSURXIEN,DFN,PSUGNM,PSUVACLS)
"RTN","PSUOP3",102,0)
SUMDRUG ; total drug info for summary report
"RTN","PSUOP3",103,0)
 S PSUVARS="PSUTPART,PSUTFIL,PSUTRFIL,PSUTCST,PSUTQTY"
"RTN","PSUOP3",104,0)
 S PSUREC=$G(^XTMP(PSUOPSUB,"DRUG",PSUSITE,PSUGNM,PSUCMOP))
"RTN","PSUOP3",105,0)
 F I=1:1:5 S @$P(PSUVARS,",",I)=+$P(PSUREC,U,I)
"RTN","PSUOP3",106,0)
 I PSUTYP="P" S PSUTPART=PSUTPART+1
"RTN","PSUOP3",107,0)
 I PSUTYP="N" S PSUTFIL=PSUTFIL+1
"RTN","PSUOP3",108,0)
 I PSUTYP="R" S PSUTRFIL=PSUTRFIL+1
"RTN","PSUOP3",109,0)
 S PSUTQTY=PSUQTY+PSUTQTY
"RTN","PSUOP3",110,0)
 S PSUTCST=(PSUDRCT*PSUQTY)+PSUTCST
"RTN","PSUOP3",111,0)
 S REC=PSUTPART_U_PSUTFIL_U_PSUTRFIL_U_$J(PSUTCST,0,2)_U_$J(PSUTQTY,0,2)
"RTN","PSUOP3",112,0)
 S $P(REC,U,6)=$S(PSUNFI="N/F":"*",1:"")
"RTN","PSUOP3",113,0)
 S $P(REC,U,7)=$S(PSOPNFI="0":"#",1:"")
"RTN","PSUOP3",114,0)
 S ^XTMP(PSUOPSUB,"DRUG",PSUSITE,PSUGNM,PSUCMOP)=REC
"RTN","PSUOP3",115,0)
 Q
"RTN","PSUOP4")
0^3^B15215079
"RTN","PSUOP4",1,0)
PSUOP4 ;BIR/CFL - PSU PBM Outpatient Pharmacy create mailman messages ;10 JUL 1999
"RTN","PSUOP4",2,0)
 ;;3.0;PHARMACY BENEFITS MANAGEMENT;**1,7,19,31**;Oct 15, 1998
"RTN","PSUOP4",3,0)
 ;
"RTN","PSUOP4",4,0)
 ;DBIA(s)
"RTN","PSUOP4",5,0)
 ; Reference to file #4.3 supported by DBIA 2496
"RTN","PSUOP4",6,0)
 ; Reference to file #59  supported by DBIA 2510
"RTN","PSUOP4",7,0)
 ; Reference to file #4   supported by DBIA 10090
"RTN","PSUOP4",8,0)
 ;
"RTN","PSUOP4",9,0)
EN ;
"RTN","PSUOP4",10,0)
 ;
"RTN","PSUOP4",11,0)
 S $P(PSUDASH,"-",100)=""
"RTN","PSUOP4",12,0)
 S $P(PSUFILL," ",100)=""
"RTN","PSUOP4",13,0)
 ;Organize index of ^XTMP("DATA") global
"RTN","PSUOP4",14,0)
 S (PSUDV,PSUTMP)=""
"RTN","PSUOP4",15,0)
 F  S PSUDV=$O(^XTMP(PSUOPSUB,"DATA",PSUDV)) Q:PSUDV=""  D
"RTN","PSUOP4",16,0)
 .S PSULCT=0
"RTN","PSUOP4",17,0)
 .S PSURXIEN=""
"RTN","PSUOP4",18,0)
 .F  S PSURXIEN=$O(^XTMP(PSUOPSUB,"DATA",PSUDV,PSURXIEN)) Q:PSURXIEN=""  D
"RTN","PSUOP4",19,0)
 ..S PSURCT=0
"RTN","PSUOP4",20,0)
 ..F  S PSURCT=$O(^XTMP(PSUOPSUB,"DATA",PSUDV,PSURXIEN,PSURCT)) Q:PSURCT=""  D
"RTN","PSUOP4",21,0)
 ...S PSULCT=PSULCT+1
"RTN","PSUOP4",22,0)
 ...S ^XTMP(PSUOPSUB,"RECORDS",PSUDV,PSULCT)=^XTMP(PSUOPSUB,"DATA",PSUDV,PSURXIEN,PSURCT,1)
"RTN","PSUOP4",23,0)
 ...S PSULCT=PSULCT+1
"RTN","PSUOP4",24,0)
 ...S ^XTMP(PSUOPSUB,"RECORDS",PSUDV,PSULCT)=^XTMP(PSUOPSUB,"DATA",PSUDV,PSURXIEN,PSURCT,2)
"RTN","PSUOP4",25,0)
 ;
"RTN","PSUOP4",26,0)
 ;Create global for Patient Demographics summary message
"RTN","PSUOP4",27,0)
 M ^XTMP("PSU_"_PSUJOB,"PSUDIVPT")=^XTMP(PSUOPSUB,"RECORDS")
"RTN","PSUOP4",28,0)
 S PSUST=0
"RTN","PSUOP4",29,0)
 F  S PSUST=$O(^XTMP("PSU_"_PSUJOB,"PSUDIVPT",PSUST)) Q:PSUST=""  D
"RTN","PSUOP4",30,0)
 .S PSUST1=0
"RTN","PSUOP4",31,0)
 .F  S PSUST1=$O(^XTMP("PSU_"_PSUJOB,"PSUDIVPT",PSUST,PSUST1)) Q:PSUST1=""  D
"RTN","PSUOP4",32,0)
 ..I $P(^XTMP("PSU_"_PSUJOB,"PSUDIVPT",PSUST,PSUST1),U,1)["*" D
"RTN","PSUOP4",33,0)
 ...K ^XTMP("PSU_"_PSUJOB,"PSUDIVPT",PSUST,PSUST1)
"RTN","PSUOP4",34,0)
 ;
"RTN","PSUOP4",35,0)
MSG ;Set up the number of lines and messages for mailman
"RTN","PSUOP4",36,0)
 ;
"RTN","PSUOP4",37,0)
 S PSUNOREC="",NONE=""
"RTN","PSUOP4",38,0)
 S PSUMSGT("M")=0,PSUMSGT("L")=0
"RTN","PSUOP4",39,0)
 I '$D(^XTMP(PSUOPSUB,"RECORDS")) D NODATA Q  ;Do not go any further if there is no data to report
"RTN","PSUOP4",40,0)
 S PSUDIV=0,Z=0
"RTN","PSUOP4",41,0)
 F  S PSUDIV=$O(^XTMP(PSUOPSUB,"RECORDS",PSUDIV)) Q:PSUDIV=""  D
"RTN","PSUOP4",42,0)
 .S X=PSUDIV,DIC=59,DIC(0)="XM" D ^DIC ;**1
"RTN","PSUOP4",43,0)
 .S X=+Y,PSUDIVNM=$$VAL^PSUTL(59,X,.01)
"RTN","PSUOP4",44,0)
 .;VMP OIFO BAY PINES;ELR;PSU*3.0*31
"RTN","PSUOP4",45,0)
 .I '$L(PSUDIVNM) S X=PSUDIV D DIVNM^PSUOP6
"RTN","PSUOP4",46,0)
 .I PSUMASF!PSUDUZ!PSUPBMG D 
"RTN","PSUOP4",47,0)
 ..I 'PSUSMRY D XMD,SETCNT     ;DAM
"RTN","PSUOP4",48,0)
 .D RECLOOP^PSUOP5,RECSUM^PSUOP5 ; send statistical summary
"RTN","PSUOP4",49,0)
 .I 'PSUSMRY D DRUGSUM^PSUOP5 ; send drug summary on condition
"RTN","PSUOP4",50,0)
 Q
"RTN","PSUOP4",51,0)
XMD ;
"RTN","PSUOP4",52,0)
 NEW PSUMAX,PSULC,PSUTMC,PSUTLC,PSUMC
"RTN","PSUOP4",53,0)
 S PSUMAX=$$VAL^PSUTL(4.3,1,8.3)
"RTN","PSUOP4",54,0)
 S PSUMAX=$S(PSUMAX="":10000,PSUMAX>10000:10000,1:PSUMAX)
"RTN","PSUOP4",55,0)
 K ^XTMP(PSUOPSUB,"XMD")
"RTN","PSUOP4",56,0)
 S PSUMC=1,PSUMLC=0
"RTN","PSUOP4",57,0)
 F PSULC=1:1 S X=$G(^XTMP(PSUOPSUB,"RECORDS",PSUDIV,PSULC)) Q:X=""  D
"RTN","PSUOP4",58,0)
 .S PSUMLC=PSUMLC+1
"RTN","PSUOP4",59,0)
 .I PSUMLC>PSUMAX S PSUMC=PSUMC+1,PSUMLC=0,PSULC=PSULC-1 Q  ; +  message
"RTN","PSUOP4",60,0)
 .I $L(X)<235 S ^XTMP(PSUOPSUB,"XMD",PSUMC,PSUMLC)=X Q
"RTN","PSUOP4",61,0)
 .F I=235:-1:1 S Z=$E(X,I) Q:Z="^"
"RTN","PSUOP4",62,0)
 .S ^XTMP(PSUOPSUB,"XMD",PSUMC,PSUMLC)=$E(X,1,I)
"RTN","PSUOP4",63,0)
 .S PSUMLC=PSUMLC+1
"RTN","PSUOP4",64,0)
 .S ^XTMP(PSUOPSUB,"XMD",PSUMC,PSUMLC)="*"_$E(X,I+1,999)
"RTN","PSUOP4",65,0)
 ;
"RTN","PSUOP4",66,0)
 ;   Count Lines sent
"RTN","PSUOP4",67,0)
 S PSUTLC=0
"RTN","PSUOP4",68,0)
 F PSUM=1:1:PSUMC S X=$O(^XTMP(PSUOPSUB,"XMD",PSUM,""),-1),PSUTLC=PSUTLC+X
"RTN","PSUOP4",69,0)
 ;
"RTN","PSUOP4",70,0)
 ;   Transmit Messages
"RTN","PSUOP4",71,0)
VARS ; Setup variables for contents
"RTN","PSUOP4",72,0)
 F PSUM=1:1:PSUMC D
"RTN","PSUOP4",73,0)
 .S XMSUB="V. 3.0P1 PBMOP "_PSUMON_" "_PSUM_"/"_PSUMC_" "_PSUDIV_" "_PSUDIVNM
"RTN","PSUOP4",74,0)
 .S XMTEXT="^XTMP(PSUOPSUB,""XMD"",PSUM,"
"RTN","PSUOP4",75,0)
 .S XMCHAN=1
"RTN","PSUOP4",76,0)
 .I PSUMASF!PSUDUZ!PSUPBMG D
"RTN","PSUOP4",77,0)
 ..M XMY=PSUXMYH
"RTN","PSUOP4",78,0)
 .I 'PSUMASF M XMY=PSUXMYS1
"RTN","PSUOP4",79,0)
 .D ^XMD
"RTN","PSUOP4",80,0)
 ;
"RTN","PSUOP4",81,0)
 S:NONE PSUTLC=0
"RTN","PSUOP4",82,0)
 S PSUMSG("M")=PSUMC
"RTN","PSUOP4",83,0)
 S PSUMSG("L")=PSUTLC
"RTN","PSUOP4",84,0)
 Q
"RTN","PSUOP4",85,0)
NODATA ;Send "No data to report" message
"RTN","PSUOP4",86,0)
 S ^XTMP(PSUOPSUB,"RECORDS",PSUSNDR,1)="No data to report"
"RTN","PSUOP4",87,0)
 S NONE=1,PSUDIV=PSUSNDR
"RTN","PSUOP4",88,0)
 S ^XTMP("PSU_"_PSUJOB,"PSUNONE","RX")=""
"RTN","PSUOP4",89,0)
 ;VMP OIFO BAY PINES;ELR;PSU*3.0*31
"RTN","PSUOP4",90,0)
 S X=PSUDIV D DIVNM^PSUOP6
"RTN","PSUOP4",91,0)
 D XMD
"RTN","PSUOP4",92,0)
SETCNT ;Set message count and line count
"RTN","PSUOP4",93,0)
 S PSUMSGT(PSUDIV,"M")=$G(PSUMSGT(PSUDIV,"M"))+PSUMSG("M")
"RTN","PSUOP4",94,0)
 S PSUMSGT(PSUDIV,"L")=$G(PSUMSGT(PSUDIV,"L"))+PSUMSG("L")
"RTN","PSUOP4",95,0)
 S ^XTMP("PSU_"_PSUJOB,"CONFIRM",PSUDIV,PSUOPTN,"M")=PSUMSGT(PSUDIV,"M")
"RTN","PSUOP4",96,0)
 S ^XTMP("PSU_"_PSUJOB,"CONFIRM",PSUDIV,PSUOPTN,"L")=PSUMSGT(PSUDIV,"L")
"RTN","PSUOP4",97,0)
 Q
"RTN","PSUOP6")
0^4^B14153770
"RTN","PSUOP6",1,0)
PSUOP6 ;BIR/REG - PSU PBM Outpatient Pharmacy Printer Output ;10 JUL 1999
"RTN","PSUOP6",2,0)
 ;;3.0;PHARMACY BENEFITS MANAGEMENT;**1,7,19,26,31**;Oct 15, 1998
"RTN","PSUOP6",3,0)
 ;
"RTN","PSUOP6",4,0)
 ;DBIA(s)
"RTN","PSUOP6",5,0)
 ; Reference to file #59 supported by DBIA 2510
"RTN","PSUOP6",6,0)
 ; Reference to file 40.8 supported by DBIA 2438
"RTN","PSUOP6",7,0)
 ;
"RTN","PSUOP6",8,0)
 ;PRINT CYCLE CONTROLLER FOR OUTPATIENT PHARMACY SUMMARY REPORT
"RTN","PSUOP6",9,0)
 ;
"RTN","PSUOP6",10,0)
EP ;
"RTN","PSUOP6",11,0)
 NEW PSUI,PSUH,PSUL,PSUM,PSUPGS
"RTN","PSUOP6",12,0)
 D DT^DILF("E",PSUSDT,.EXTD)
"RTN","PSUOP6",13,0)
 S PSURP("START")=EXTD(0)
"RTN","PSUOP6",14,0)
 D DT^DILF("E",PSUEDT,.EXTD)
"RTN","PSUOP6",15,0)
 S PSURP("END")=EXTD(0)
"RTN","PSUOP6",16,0)
 U IO
"RTN","PSUOP6",17,0)
 ;
"RTN","PSUOP6",18,0)
PRTSUMS ;
"RTN","PSUOP6",19,0)
 ; Find first Division/Facility in the summary by division
"RTN","PSUOP6",20,0)
 ; then DO the PRTALL routine
"RTN","PSUOP6",21,0)
 S PSUOPSUB="PSUOP_"_PSUJOB
"RTN","PSUOP6",22,0)
 I '$D(^XTMP(PSUOPSUB,"STATSUM")) D
"RTN","PSUOP6",23,0)
 .S ^XTMP("PSU_"_PSUJOB,"PSUNONE2")=""
"RTN","PSUOP6",24,0)
 .S ^XTMP(PSUOPSUB,"STATSUM",PSUSNDR,1)="Outpatient Statistical Data Summary for "_PSURP("START")_" through "_PSURP("END")
"RTN","PSUOP6",25,0)
 .S ^XTMP(PSUOPSUB,"STATSUM",PSUSNDR,2)=" "
"RTN","PSUOP6",26,0)
 .S ^XTMP(PSUOPSUB,"STATSUM",PSUSNDR,3)="No data to report"
"RTN","PSUOP6",27,0)
 ;
"RTN","PSUOP6",28,0)
 S PSUFACN=""
"RTN","PSUOP6",29,0)
 ;VMP-IOFO BAY PINES;ELR;PSU*3.0*26
"RTN","PSUOP6",30,0)
 NEW PSUFIRST
"RTN","PSUOP6",31,0)
 F  S PSUFACN=$O(^XTMP(PSUOPSUB,"STATSUM",PSUFACN)) Q:PSUFACN=""  D PRTALL
"RTN","PSUOP6",32,0)
 ;
"RTN","PSUOP6",33,0)
 D PULL^PSUCP
"RTN","PSUOP6",34,0)
 F I=1:1:$L(PSUOPTS,",") S PSUMOD($P(PSUOPTS,",",I))=""
"RTN","PSUOP6",35,0)
 ;
"RTN","PSUOP6",36,0)
 ;Call Pt. Demographics summary report/No data when user selects
"RTN","PSUOP6",37,0)
 ;(1)IV and (2)UD and (4)Rx
"RTN","PSUOP6",38,0)
 ;(1)IV and (4)Rx
"RTN","PSUOP6",39,0)
 ;(2)UD and (4)Rx
"RTN","PSUOP6",40,0)
 I $D(PSUMOD(1))!$D(PSUMOD(2)) D IVSUM^PSUDEM0
"RTN","PSUOP6",41,0)
 ;
"RTN","PSUOP6",42,0)
 ;Call Pt. Demographics summary report/No data when user selects
"RTN","PSUOP6",43,0)
 ;(4)IV alone.
"RTN","PSUOP6",44,0)
 I '$D(PSUMOD(1))&'$D(PSUMOD(2)) D IVSUM^PSUDEM0
"RTN","PSUOP6",45,0)
 ;
"RTN","PSUOP6",46,0)
 ; Find the first Division/Facility in the summary by drug by division
"RTN","PSUOP6",47,0)
 ; then DO the PRTDRUG routine
"RTN","PSUOP6",48,0)
 Q:PSUSMRY  ; 'summary only' was selected don't print 'by drug'
"RTN","PSUOP6",49,0)
 S PSUFACN=""
"RTN","PSUOP6",50,0)
 I '$D(^XTMP(PSUOPSUB,"DRUGSUM")) D
"RTN","PSUOP6",51,0)
 .S ^XTMP(PSUOPSUB,"DRUGSUM",PSUSNDR,1)="Outpatient Statistical Data for "_PSURP("START")_" through "_PSURP("END")
"RTN","PSUOP6",52,0)
 .S ^XTMP(PSUOPSUB,"DRUGSUM",PSUSNDR,2)="                                                                        Page"
"RTN","PSUOP6",53,0)
 .S ^XTMP(PSUOPSUB,"DRUGSUM",PSUSNDR,3)="No data to report"
"RTN","PSUOP6",54,0)
 F  S PSUFACN=$O(^XTMP(PSUOPSUB,"DRUGSUM",PSUFACN)) Q:PSUFACN=""  D PRTDRUG
"RTN","PSUOP6",55,0)
PRTSUMX ; EXIT PSUOP6
"RTN","PSUOP6",56,0)
 W @IOF
"RTN","PSUOP6",57,0)
 ;
"RTN","PSUOP6",58,0)
 Q 
"RTN","PSUOP6",59,0)
 ;
"RTN","PSUOP6",60,0)
PRTALL ; Print the Drug summary of all drugs by Division/Facility
"RTN","PSUOP6",61,0)
 S X=PSUFACN,DIC=59,DIC(0)="XM" D ^DIC ;**1
"RTN","PSUOP6",62,0)
 S X=+Y S PSUDIVNM=$$VAL^PSUTL(59,X,.01)
"RTN","PSUOP6",63,0)
 ;VMP OIFO BAY PINES;ELR;PSU*3.0*31
"RTN","PSUOP6",64,0)
 I '$L(PSUDIVNM) S X=PSUFACN D DIVNM
"RTN","PSUOP6",65,0)
 ;VMP-IOFO BAY PINES;ELR;PSU*3.0*26; REMOVE FORM FEED FIRST TIME THROUGH
"RTN","PSUOP6",66,0)
 I $G(PSUFIRST) W @IOF
"RTN","PSUOP6",67,0)
 S PSUFIRST=1
"RTN","PSUOP6",68,0)
 F I=1:1:3 W !
"RTN","PSUOP6",69,0)
 S PSUL=""
"RTN","PSUOP6",70,0)
 F  S PSUL=$O(^XTMP(PSUOPSUB,"STATSUM",PSUFACN,PSUL)) Q:PSUL=""  D
"RTN","PSUOP6",71,0)
 .W !,^XTMP(PSUOPSUB,"STATSUM",PSUFACN,PSUL)
"RTN","PSUOP6",72,0)
 .I PSUL=1 W " for ",PSUDIVNM,!,?72,"Page: 1" ; will only ever be one page
"RTN","PSUOP6",73,0)
 Q
"RTN","PSUOP6",74,0)
 ; 
"RTN","PSUOP6",75,0)
PRTDRUG ; Print the Drug summary by Drug by Division/Facility
"RTN","PSUOP6",76,0)
 ; Set page number to 0
"RTN","PSUOP6",77,0)
 S PSUPGS("PG")=0
"RTN","PSUOP6",78,0)
 S X=PSUFACN,DIC=59,DIC(0)="XM" D ^DIC
"RTN","PSUOP6",79,0)
 S X=+Y S PSUDIVNM=$$VAL^PSUTL(59,X,.01)
"RTN","PSUOP6",80,0)
 ;VMP OIFO BAY PINES;ELR;PSU*3.0*31
"RTN","PSUOP6",81,0)
 I '$L(PSUDIVNM) S X=PSUFACN D DIVNM
"RTN","PSUOP6",82,0)
 D PGHDR ; Perform 1st page heading
"RTN","PSUOP6",83,0)
 S PSUL=6 ; Report body starts at line 7
"RTN","PSUOP6",84,0)
 F  S PSUL=$O(^XTMP(PSUOPSUB,"DRUGSUM",PSUFACN,PSUL)) Q:PSUL=""  D
"RTN","PSUOP6",85,0)
 .I $Y+4>IOSL D PGHDR
"RTN","PSUOP6",86,0)
 .W !,^XTMP(PSUOPSUB,"DRUGSUM",PSUFACN,PSUL)
"RTN","PSUOP6",87,0)
 ;
"RTN","PSUOP6",88,0)
 Q
"RTN","PSUOP6",89,0)
 ;
"RTN","PSUOP6",90,0)
PGHDR ;Increment page number and Write Page Heading
"RTN","PSUOP6",91,0)
 ; Writes header lines 1 & 2, then page number, then lines 3 through 6
"RTN","PSUOP6",92,0)
 U IO W @IOF
"RTN","PSUOP6",93,0)
 F I=1:1:3 W !
"RTN","PSUOP6",94,0)
 W !,^XTMP(PSUOPSUB,"DRUGSUM",PSUFACN,1) ;Print 1st line
"RTN","PSUOP6",95,0)
 W " for ",PSUDIVNM ; add division name
"RTN","PSUOP6",96,0)
 S PSUPGS("PG")=PSUPGS("PG")+1
"RTN","PSUOP6",97,0)
 W !,$P(^XTMP(PSUOPSUB,"DRUGSUM",PSUFACN,2),":",1),": ",PSUPGS("PG"),! ;Print page number
"RTN","PSUOP6",98,0)
 F PSUH=3:1:6 W !,$G(^XTMP(PSUOPSUB,"DRUGSUM",PSUFACN,PSUH)) ;Print next 5 lines  
"RTN","PSUOP6",99,0)
 Q
"RTN","PSUOP6",100,0)
DIVNM ;S PSUDIVNM FROM FILE 40.8 IF NOT IN FILE 59
"RTN","PSUOP6",101,0)
 S DIC=40.8,DIC(0)="X",D="C" D IX^DIC
"RTN","PSUOP6",102,0)
 S X=+Y S PSUDIVNM=$$VAL^PSUTL(40.8,X,.01)
"RTN","PSUOP6",103,0)
 Q
"VER")
8.0^22
**END**
**END**
