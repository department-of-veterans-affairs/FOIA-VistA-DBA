EMERGENCY Released PSO*7*242 SEQ #209
Extracted from mail message
**KIDS**:PSO*7.0*242^

**INSTALL NAME**
PSO*7.0*242
"BLD",6412,0)
PSO*7.0*242^OUTPATIENT PHARMACY^0^3060330^y
"BLD",6412,1,0)
^^3^3^3060330^
"BLD",6412,1,1,0)
CORRECT THE OPTION PSO INTERNET REFILL, THE "Q" OPTION FROM SENDING
"BLD",6412,1,2,0)
MULTIPLE RX #'S FROM DIFFERENT PATIENTS TO THE LABEL PRINT ROUTINES.  ALSO
"BLD",6412,1,3,0)
CHANGE THE DEFAULT "Q" OPTION TO "S" FOR SUSPEND.
"BLD",6412,4,0)
^9.64PA^^
"BLD",6412,"KRN",0)
^9.67PA^8989.52^19
"BLD",6412,"KRN",.4,0)
.4
"BLD",6412,"KRN",.401,0)
.401
"BLD",6412,"KRN",.402,0)
.402
"BLD",6412,"KRN",.403,0)
.403
"BLD",6412,"KRN",.5,0)
.5
"BLD",6412,"KRN",.84,0)
.84
"BLD",6412,"KRN",3.6,0)
3.6
"BLD",6412,"KRN",3.8,0)
3.8
"BLD",6412,"KRN",9.2,0)
9.2
"BLD",6412,"KRN",9.8,0)
9.8
"BLD",6412,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6412,"KRN",9.8,"NM",1,0)
PSOBBC^^0^B87363308
"BLD",6412,"KRN",9.8,"NM",2,0)
PSOPRI^^0^B22700966
"BLD",6412,"KRN",9.8,"NM","B","PSOBBC",1)

"BLD",6412,"KRN",9.8,"NM","B","PSOPRI",2)

"BLD",6412,"KRN",19,0)
19
"BLD",6412,"KRN",19.1,0)
19.1
"BLD",6412,"KRN",101,0)
101
"BLD",6412,"KRN",409.61,0)
409.61
"BLD",6412,"KRN",771,0)
771
"BLD",6412,"KRN",870,0)
870
"BLD",6412,"KRN",8989.51,0)
8989.51
"BLD",6412,"KRN",8989.52,0)
8989.52
"BLD",6412,"KRN",8994,0)
8994
"BLD",6412,"KRN","B",.4,.4)

"BLD",6412,"KRN","B",.401,.401)

"BLD",6412,"KRN","B",.402,.402)

"BLD",6412,"KRN","B",.403,.403)

"BLD",6412,"KRN","B",.5,.5)

"BLD",6412,"KRN","B",.84,.84)

"BLD",6412,"KRN","B",3.6,3.6)

"BLD",6412,"KRN","B",3.8,3.8)

"BLD",6412,"KRN","B",9.2,9.2)

"BLD",6412,"KRN","B",9.8,9.8)

"BLD",6412,"KRN","B",19,19)

"BLD",6412,"KRN","B",19.1,19.1)

"BLD",6412,"KRN","B",101,101)

"BLD",6412,"KRN","B",409.61,409.61)

"BLD",6412,"KRN","B",771,771)

"BLD",6412,"KRN","B",870,870)

"BLD",6412,"KRN","B",8989.51,8989.51)

"BLD",6412,"KRN","B",8989.52,8989.52)

"BLD",6412,"KRN","B",8994,8994)

"BLD",6412,"QUES",0)
^9.62^^
"BLD",6412,"REQB",0)
^9.611^2^2
"BLD",6412,"REQB",1,0)
PSO*7.0*185^2
"BLD",6412,"REQB",2,0)
PSO*7.0*204^2
"BLD",6412,"REQB","B","PSO*7.0*185",1)

"BLD",6412,"REQB","B","PSO*7.0*204",2)

"MBREQ")
0
"PKG",170,-1)
1^1
"PKG",170,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",170,20,0)
^9.402P^^
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
7.0^2971216^2981113^1
"PKG",170,22,1,"PAH",1,0)
242^3060330
"PKG",170,22,1,"PAH",1,1,0)
^^3^3^3060330
"PKG",170,22,1,"PAH",1,1,1,0)
CORRECT THE OPTION PSO INTERNET REFILL, THE "Q" OPTION FROM SENDING
"PKG",170,22,1,"PAH",1,1,2,0)
MULTIPLE RX #'S FROM DIFFERENT PATIENTS TO THE LABEL PRINT ROUTINES.  ALSO
"PKG",170,22,1,"PAH",1,1,3,0)
CHANGE THE DEFAULT "Q" OPTION TO "S" FOR SUSPEND.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSOBBC")
0^1^B87363308^B86773109
"RTN","PSOBBC",1,0)
PSOBBC ;IHS/DSD/JCM-BATCH BARCODE DRIVER ;3/30/06 10:10am
"RTN","PSOBBC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,22,27,34,46,130,146,185,242**;DEC 1997
"RTN","PSOBBC",3,0)
 ;External reference to ^IBE(350.1,"ANEW" supported by DBIA 592
"RTN","PSOBBC",4,0)
 ;External references CHPUS^IBACUS and TRI^IBACUS supported by DBIA 2030
"RTN","PSOBBC",5,0)
 ;External reference PDA^PPPPDA1 supported by DBIA 1374
"RTN","PSOBBC",6,0)
 ;External references LK^ORX2 and ULK^ORX2 supported by DBIA 867
"RTN","PSOBBC",7,0)
 ;External references ^PS(55 supported by DBIA 2228
"RTN","PSOBBC",8,0)
 ;External references U, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOBBC",9,0)
 ;PSO*242 change default to from Q to S
"RTN","PSOBBC",10,0)
 ;-------------------------------------------------------------------
"RTN","PSOBBC",11,0)
START ;
"RTN","PSOBBC",12,0)
 N PSODFN,PSOBBCNO
"RTN","PSOBBC",13,0)
 D INIT I '$D(PSOPAR) D ^PSOLSET G:'$D(PSOPAR) EOJ
"RTN","PSOBBC",14,0)
 I $G(PSOSITE) S PSOBARID=$G(^PS(59,PSOSITE,"IB")) I '$D(^IBE(350.1,"ANEW",+PSOBARID,1,1)) D  S PSORX("QFLG")=1 K PSOBARID G END
"RTN","PSOBBC",15,0)
 .W $C(7),!!,"WARNING: Pharmacy Copay not working,",!,?10,"Check IB SERVICE/SECTION in Pharmacy Site File.",!!!,"You will not be able to enter any new prescriptions until this is corrected!"
"RTN","PSOBBC",16,0)
 S PSOBBC("QFLG")=0,PSORX("BAR CODE")=1
"RTN","PSOBBC",17,0)
 D FROM I PSOBBC("QFLG") S PSORX("QFLG")=1 G END
"RTN","PSOBBC",18,0)
 D ASK I PSOBBC("QFLG") S PSORX("QFLG")=1 G END
"RTN","PSOBBC",19,0)
 D PROCESS
"RTN","PSOBBC",20,0)
END D EOJ
"RTN","PSOBBC",21,0)
 Q
"RTN","PSOBBC",22,0)
 ;--------------------------------------------------------------------
"RTN","PSOBBC",23,0)
INIT ;
"RTN","PSOBBC",24,0)
 S PSOBBC("QFLG")=0,PSORX("BAR CODE")=1 K PPL
"RTN","PSOBBC",25,0)
 I '$G(PSOINST) D
"RTN","PSOBBC",26,0)
 .K DIC,DR,DIQ S DA=$P($$SITE^VASITE(),"^") I DA D
"RTN","PSOBBC",27,0)
 ..K PSOINST S DIC=4,DIQ(0)="I",DR=99,DIQ="PSOINST" D EN^DIQ1
"RTN","PSOBBC",28,0)
 ..S PSOINST=PSOINST(4,DA,99,"I") K DIC,DA,DIQ,PSOINST(4)
"RTN","PSOBBC",29,0)
 Q
"RTN","PSOBBC",30,0)
FROM ;
"RTN","PSOBBC",31,0)
 S DIR(0)="S^1:REFILLS;2:RENEWS;"
"RTN","PSOBBC",32,0)
 S DIR("A")="Batch Barcode for",DIR("B")="REFILLS"
"RTN","PSOBBC",33,0)
 D DIR G:'Y FROMX
"RTN","PSOBBC",34,0)
 S PSOBBC1("FROM")=$S(Y=1:"REFILL",1:"NEW")
"RTN","PSOBBC",35,0)
FROMX K X,Y,DIR
"RTN","PSOBBC",36,0)
 Q
"RTN","PSOBBC",37,0)
 ;
"RTN","PSOBBC",38,0)
ASK ;
"RTN","PSOBBC",39,0)
 K BINGCRT,BINGRTE,BBRX
"RTN","PSOBBC",40,0)
 W !,"Please answer the following for this session of prescriptions",!
"RTN","PSOBBC",41,0)
 D EN^PSOREF2(.PSOBBC) I PSOBBC("DFLG") S PSOBBC("QFLG")=1 G ASKX
"RTN","PSOBBC",42,0)
 D SUSP
"RTN","PSOBBC",43,0)
 D INPT
"RTN","PSOBBC",44,0)
 D:'$P($G(PSOPAR),"^",6) EARLY
"RTN","PSOBBC",45,0)
 D SET
"RTN","PSOBBC",46,0)
 D:PSOBBC1("FROM")="NEW" NOORE^PSONEW(.PSOBBC) S:$G(PSOBBC("NOO"))'="" PSOBBCNO=$G(PSOBBC("NOO")) S:$G(PSOBBC("DFLG")) PSOBBC("QFLG")=1
"RTN","PSOBBC",47,0)
ASKX Q
"RTN","PSOBBC",48,0)
 ;
"RTN","PSOBBC",49,0)
SUSP ;
"RTN","PSOBBC",50,0)
 S DIR(0)="SAB^Q:QUEUED;S:SUSPENDED"
"RTN","PSOBBC",51,0)
 S DIR("A")="Will these refills be Queued or Suspended ? "
"RTN","PSOBBC",52,0)
 S DIR("B")="S"   ;PSO*242
"RTN","PSOBBC",53,0)
 D DIR G:PSOBBC("QFLG") SUSPX
"RTN","PSOBBC",54,0)
 S (PSOBBC1("QS"),PSOBBC("QS"))=Y S:PSOBBC1("QS")="S" BINGCRT=0
"RTN","PSOBBC",55,0)
SUSPX K X,Y,DIR
"RTN","PSOBBC",56,0)
 Q
"RTN","PSOBBC",57,0)
 ;
"RTN","PSOBBC",58,0)
INPT ;
"RTN","PSOBBC",59,0)
 S DIR(0)="YA"
"RTN","PSOBBC",60,0)
 S DIR("A")="Allow fills for inpatient and CNH ? "
"RTN","PSOBBC",61,0)
 S DIR("B")="N"
"RTN","PSOBBC",62,0)
 D DIR G:PSOBBC("QFLG") INPTX
"RTN","PSOBBC",63,0)
 S (PSOBBC1("INOK"),PSOBBC("INOK"))=Y
"RTN","PSOBBC",64,0)
INPTX K X,Y,DIR
"RTN","PSOBBC",65,0)
 Q
"RTN","PSOBBC",66,0)
 ;
"RTN","PSOBBC",67,0)
EARLY ;
"RTN","PSOBBC",68,0)
 S DIR(0)="YA"
"RTN","PSOBBC",69,0)
 S DIR("A")="Allow early refills ? "
"RTN","PSOBBC",70,0)
 S DIR("B")="N"
"RTN","PSOBBC",71,0)
 D DIR G:PSOBBC("QFLG") EARLYX
"RTN","PSOBBC",72,0)
 S (PSOBBC1("EAOK"),PSOBBC("EAOK"))=Y
"RTN","PSOBBC",73,0)
EARLYX K X,Y,DIR
"RTN","PSOBBC",74,0)
 Q
"RTN","PSOBBC",75,0)
 ;
"RTN","PSOBBC",76,0)
SET ;
"RTN","PSOBBC",77,0)
 S PSOBBC1("MAIL/WINDOW")=PSOBBC("MAIL/WINDOW") S:PSOBBC1("MAIL/WINDOW")="W" BINGRTE="W"
"RTN","PSOBBC",78,0)
 S PSOBBC1("FILL DATE")=PSOBBC("FILL DATE")
"RTN","PSOBBC",79,0)
 S:$G(PSOBBC("CLERK CODE")) PSOBBC1("CLERK CODE")=PSOBBC("CLERK CODE")
"RTN","PSOBBC",80,0)
 S:$G(PSOBBC("EXPIRATION DATE")) PSOBBC1("EXPIRATION DATE")=PSOBBC("EXPIRATION DATE")
"RTN","PSOBBC",81,0)
 Q
"RTN","PSOBBC",82,0)
DIR ;
"RTN","PSOBBC",83,0)
 D ^DIR
"RTN","PSOBBC",84,0)
 S:$D(DIRUT) PSOBBC("QFLG")=1,PSORX("QFLG")=1
"RTN","PSOBBC",85,0)
 K DIRUT,DUOUT,DTOUT,DIROUT
"RTN","PSOBBC",86,0)
 Q
"RTN","PSOBBC",87,0)
 ;
"RTN","PSOBBC",88,0)
PROCESS ;
"RTN","PSOBBC",89,0)
 S PSOBBC("DFLG")=0 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2)
"RTN","PSOBBC",90,0)
 S RXN=$O(^TMP("PSORXN",$J,0)) I RXN D
"RTN","PSOBBC",91,0)
 .S RXN1=^TMP("PSORXN",$J,RXN) D EN^PSOHLSN1(RXN,$P(RXN1,"^"),$P(RXN1,"^",2),"",$P(RXN1,"^",3))
"RTN","PSOBBC",92,0)
 .I $P(^PSRX(RXN,"STA"),"^")=5 D EN^PSOHLSN1(RXN,"SC","ZS","")
"RTN","PSOBBC",93,0)
 K RXN,RXN1,^TMP("PSORXN",$J) D CLEAN^PSOVER1 K ^TMP("PSORXDC",$J)
"RTN","PSOBBC",94,0)
 D GETRXM D:PSOBBC("QFLG") ULK,ULP,ULRX G:PSOBBC("QFLG") PROCESSX
"RTN","PSOBBC",95,0)
 I $G(PSODFN)'=$P(^PSRX(PSOBBC("IRXN"),0),"^",2) D  G:PSOBBC("DFLG") PROCESS
"RTN","PSOBBC",96,0)
 .I $G(PSODFN) D ULK,ULP
"RTN","PSOBBC",97,0)
 .D PT Q:PSOBBC("DFLG")
"RTN","PSOBBC",98,0)
 .D PROFILE^PSORX1 S X="PPPPDA1" X ^%ZOSF("TEST") I  S X=$$PDA^PPPPDA1(PSODFN) W !!
"RTN","PSOBBC",99,0)
 E  D PTC G:PSOBBC("DFLG") PROCESS
"RTN","PSOBBC",100,0)
 D:'$G(PSOSD) ^PSOBUILD
"RTN","PSOBBC",101,0)
 S PSOBBC("DONE")=PSOBBC("IRXN")_","
"RTN","PSOBBC",102,0)
 D @PSOBBC1("FROM") S:$G(PPL)&$D(BINGRTE) BBRX(1)=$S($D(PSOBBC("DONE")):PSOBBC("DONE"),1:BBRX) D:$D(BINGCRT)&($D(BINGRTE)&($D(DISGROUP))) ^PSOBING1 K BBRX D ULRX G PROCESS
"RTN","PSOBBC",103,0)
PROCESSX I $G(PPL) D SETX,TRI,Q^PSORXL K PPL,RXFL
"RTN","PSOBBC",104,0)
 Q
"RTN","PSOBBC",105,0)
GETRXM ;
"RTN","PSOBBC",106,0)
 K DIR,PSOBBC("IRXN"),PSOREFXM
"RTN","PSOBBC",107,0)
 S DIR(0)="FO^5:245^K:X'?3N1""-""1.N X"
"RTN","PSOBBC",108,0)
 S DIR("A")="WAND BARCODE"
"RTN","PSOBBC",109,0)
 S DIR("?",1)="Wand the barcoded number of the prescription to be processed."
"RTN","PSOBBC",110,0)
 S DIR("?",2)="The number should be of the form NNN-NNNNNN"
"RTN","PSOBBC",111,0)
 S DIR("?",3)="where the number before the dash is your station number."
"RTN","PSOBBC",112,0)
 S DIR("?")="Enter ""^"", or a RETURN to quit."
"RTN","PSOBBC",113,0)
 D DIR G:PSOBBC("QFLG") GETRXMX
"RTN","PSOBBC",114,0)
 I $P(X,"-")'=PSOINST W !?7,$C(7),$C(7),$C(7),"Not From this Institution" G GETRXM
"RTN","PSOBBC",115,0)
 S (PSOBBC("IRXN"),PSOBBC("OIRXN"),BBRX)=$P(X,"-",2)
"RTN","PSOBBC",116,0)
 I $G(^PSRX(PSOBBC("IRXN"),0))']"" W !,$C(7),"Rx data is not on file !",! G GETRXM
"RTN","PSOBBC",117,0)
 S PSOXDFN=+$P($G(^PSRX(PSOBBC("IRXN"),0)),"^",2) I PSOXDFN S PSOLOUD=1 D:$P($G(^PS(55,PSOXDFN,0)),"^",6)'=2 EN^PSOHLUP(PSOXDFN) K PSOLOUD
"RTN","PSOBBC",118,0)
 K PSOXDFN I $P($G(^PSRX(PSOBBC("IRXN"),"STA")),"^")=13 W !,$C(7),"Rx has already been deleted." G GETRXM
"RTN","PSOBBC",119,0)
 I $G(PSOBBC("DONE"))[PSOBBC("IRXN")_"," W !,$C(7),"Rx has already been entered" G GETRXM
"RTN","PSOBBC",120,0)
 I $G(PSOBBC1("FROM"))="REFILL" S PSOREFXM=$G(PSOBBC("IRXN")) I PSOREFXM D PSOL^PSSLOCK(PSOREFXM) I '$G(PSOMSG) D  K PSOMSG G GETRXM
"RTN","PSOBBC",121,0)
 .I $P($G(PSOMSG),"^",2)'="" W $C(7),!!?5,$P(PSOMSG,"^",2),! Q
"RTN","PSOBBC",122,0)
 .W $C(7),!!?5,"Another person is editing Rx "_$P($G(^PSRX(+$G(PSOBBC("IRXN")),0)),"^"),!
"RTN","PSOBBC",123,0)
 I '$D(PSODFNX(+$P(^PSRX(PSOBBC("IRXN"),0),"^",2))),$G(PSOBBC1("FROM"))="NEW" K PSONOERR D  G:'$G(PSOPLCK)!($G(PSONOERR)) GETRXM
"RTN","PSOBBC",124,0)
 .S PSOPLCK=$$L^PSSLOCK(+$P(^PSRX(PSOBBC("IRXN"),0),"^",2),0) I '$G(PSOPLCK) D LOCK^PSOORCPY Q
"RTN","PSOBBC",125,0)
 .S X=+$P(^PSRX(PSOBBC("IRXN"),0),"^",2)_";DPT(" D LK^ORX2 I 'Y S PSONOERR=1 D UL^PSSLOCK(+$P(^PSRX(PSOBBC("IRXN"),0),"^",2)) Q
"RTN","PSOBBC",126,0)
 .S PSODFNX(+$P(^PSRX(PSOBBC("IRXN"),0),"^",2))=""
"RTN","PSOBBC",127,0)
GETRXMX K X,Y,DIR,PSOOPT
"RTN","PSOBBC",128,0)
 Q
"RTN","PSOBBC",129,0)
 ;
"RTN","PSOBBC",130,0)
PT ;
"RTN","PSOBBC",131,0)
 S PSOBBC("DFLG")=0
"RTN","PSOBBC",132,0)
 W !,$C(7),"New Patient, please pause"
"RTN","PSOBBC",133,0)
 I $G(PPL) D SETX,TRI,Q^PSORXL K PPL
"RTN","PSOBBC",134,0)
 K RXFL
"RTN","PSOBBC",135,0)
 S (DFN,PSODFN)=$P(^PSRX(PSOBBC("IRXN"),0),"^",2),PSORX("NAME")=$P(^DPT(PSODFN,0),"^")
"RTN","PSOBBC",136,0)
 D ICN^PSODPT(DFN)
"RTN","PSOBBC",137,0)
 ;CHECK FOR BAD ADDRESS/SAB
"RTN","PSOBBC",138,0)
 S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSOBBC",139,0)
 D ^PSOBUILD
"RTN","PSOBBC",140,0)
 S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^")
"RTN","PSOBBC",141,0)
 K PSOX
"RTN","PSOBBC",142,0)
PTC S (DFN,PSODFN)=$P(^PSRX(PSOBBC("IRXN"),0),"^",2)
"RTN","PSOBBC",143,0)
 S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSOBBC",144,0)
 S PSOBBC("DFLG")=0 D GET^PSOPTPST
"RTN","PSOBBC",145,0)
 I $G(PSOPTPST(2,PSODFN,.351))]"" S PSOBBC("DFLG")=1 D DEAD^PSOPTPST G PTX
"RTN","PSOBBC",146,0)
 N PSOTPEXT I $G(PSOBBC1("FROM"))="NEW",$D(^PS(52.91,PSODFN,0)) I '$P(^PS(52.91,PSODFN,0),"^",3)!($P(^(0),"^",3)>DT) D PDIR^PSOTPCAN(PSODFN) I $G(PSOTPEXT) K PSOTPEXT S PSOBBC("DFLG")=1 G PTX
"RTN","PSOBBC",147,0)
 K PSOTPEXT
"RTN","PSOBBC",148,0)
 I $G(PSOPTPST(2,PSODFN,.1))]"" D:'PSOBBC("INOK") PID W !,$C(7),?10,"PATIENT IS AN INPATIENT ON WARD ",PSOPTPST(2,PSODFN,.1)," !!" I 'PSOBBC("INOK") S PSOBBC("DFLG")=1 G PTX
"RTN","PSOBBC",149,0)
 K PSORX("CNH")
"RTN","PSOBBC",150,0)
 I $G(PSOPTPST(2,PSODFN,148))="YES" D:'PSOBBC("INOK") PID W !,$C(7),?10,"PATIENT IS IN A CONTRACT NURSING HOME !!" S:PSOBBC("INOK") PSORX("CNH")=1 I 'PSOBBC("INOK") S PSOBBC("DFLG")=1 G PTX
"RTN","PSOBBC",151,0)
 D:PSOBBC1("FROM")="NEW" COPAY^PSOPTPST
"RTN","PSOBBC",152,0)
PTX K PSOPTPST W:PSOBBC("DFLG") !!,$C(7),"Rx not filled"
"RTN","PSOBBC",153,0)
 Q
"RTN","PSOBBC",154,0)
 ;
"RTN","PSOBBC",155,0)
REFILL ;
"RTN","PSOBBC",156,0)
 N PSOFROM S PSOFROM="REFILL",XFROM="BATCH"
"RTN","PSOBBC",157,0)
 D EN^PSOREF0(.PSOBBC)
"RTN","PSOBBC",158,0)
 Q
"RTN","PSOBBC",159,0)
REFILLX ;
"RTN","PSOBBC",160,0)
 Q
"RTN","PSOBBC",161,0)
 ;
"RTN","PSOBBC",162,0)
NEW ;
"RTN","PSOBBC",163,0)
 N PSOFROM S (PSOFROM,XFROM)="BATCH"
"RTN","PSOBBC",164,0)
 S PSOBBC("OIRXN")=PSOBBC("IRXN")
"RTN","PSOBBC",165,0)
 S PSORNW("FILL DATE")=PSOBBC1("FILL DATE"),PSOOPT=3
"RTN","PSOBBC",166,0)
 S PSORX("DFLG")=0,PSOBBC("NOO")=$G(PSOBBCNO) D EN^PSORENW0(.PSOBBC)
"RTN","PSOBBC",167,0)
 S PSOBBC("MAIL/WINDOW")=PSOBBC1("MAIL/WINDOW")
"RTN","PSOBBC",168,0)
 S PSOBBC("EAOK")=$G(PSOBBC1("EAOK"))
"RTN","PSOBBC",169,0)
 S PSOBBC("QS")=PSOBBC1("QS")
"RTN","PSOBBC",170,0)
 S PSOBBC("INOK")=PSOBBC1("INOK")
"RTN","PSOBBC",171,0)
 S:$G(PSOBBC1("CLERK CODE")) PSOBBC("CLERK CODE")=PSOBBC1("CLERK CODE")
"RTN","PSOBBC",172,0)
 S:$G(PSOBBC1("EXPIRATION DATE")) PSOBBC("EXPIRATION DATE")=PSOBBC1("EXPIRATION DATE")
"RTN","PSOBBC",173,0)
 K PSORNW,PSOOPT
"RTN","PSOBBC",174,0)
 Q
"RTN","PSOBBC",175,0)
 ;
"RTN","PSOBBC",176,0)
EOJ ;
"RTN","PSOBBC",177,0)
 K PSOMSG,PSOREFXM,PSONOERR,PSOPLCK,PSOSD,PSOBBC,PSOBBC1,PSOBARID,Y,X,XFROM,PSOCOUU,PSOCOU,ACNT,ADFN,CLS,CMOP,CNT,FDR,HDR,PSCAN,JJ,POERR,PSOBCK,PSONEW3,PSORENW3,RXFL,PSOOPT
"RTN","PSOBBC",178,0)
 K PSORX,RFDT,RX1,RXS,SDA,PSONOOR,VALMBCK,VALMSG,SIG,SIGOK,STA,TM,TM1,VA,VADM,VAEL,VAPA
"RTN","PSOBBC",179,0)
 D CLEAN^PSOVER1 K ^TMP("PSORXDC",$J)
"RTN","PSOBBC",180,0)
 Q
"RTN","PSOBBC",181,0)
TRI ;Check for Tricare Rx's
"RTN","PSOBBC",182,0)
 S X="IBACUS" X ^%ZOSF("TEST") I '$T Q
"RTN","PSOBBC",183,0)
 I '$$TRI^IBACUS Q
"RTN","PSOBBC",184,0)
 Q:'$G(PPL)
"RTN","PSOBBC",185,0)
 ;PREV LINE, IN V 7 D ZOSF FIRST
"RTN","PSOBBC",186,0)
 N DA,NEWPPL,WWFLAG,PSOWRX,PSOWW,WWNEXT,WXRX,WPAT,WSITE,WDUZ,WFILL,WLOOP,WBILL,WPPLFLG,WWW
"RTN","PSOBBC",187,0)
 D DEV^PSOCPTRI
"RTN","PSOBBC",188,0)
 S NEWPPL=PPL S PPL=""
"RTN","PSOBBC",189,0)
 S (WWFLAG,WPPLFLG)=0 F PSOWW=1:1 S PSOWRX=$P(NEWPPL,",",PSOWW) D  Q:$G(WWFLAG)
"RTN","PSOBBC",190,0)
 .S WWNEXT=$P(NEWPPL,",",(PSOWW+1)) I WWNEXT=""!(WWNEXT=",") S WWFLAG=1
"RTN","PSOBBC",191,0)
 .I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOBBC",192,0)
 .S WPAT=$P($G(^PSRX(+PSOWRX,0)),"^",2),WSITE=+$G(PSOSITE),WDUZ=+$G(DUZ)
"RTN","PSOBBC",193,0)
 .S WFILL=0 F WLOOP=0:0 S WLOOP=$O(^PSRX(+PSOWRX,1,WLOOP)) Q:'WLOOP  S WFILL=WLOOP
"RTN","PSOBBC",194,0)
 .S WBILL=$$CHPUS^IBACUS(WPAT,DT,PSOWRX,WFILL,PSOLAP,WSITE,WDUZ)
"RTN","PSOBBC",195,0)
 .I '$G(WBILL) S WXRX(PSOWW,PSOWRX)="" Q
"RTN","PSOBBC",196,0)
 .S WPPLFLG=1
"RTN","PSOBBC",197,0)
 .S FLD(99)="99",FLD(99.1)="Awaiting CHAMPUS billing approval"
"RTN","PSOBBC",198,0)
 .N RSDT,ACT,PSUS,RXF,I,PSDA,NOW,IR,FDA,RFN S DA=PSOWRX D H^PSOCPTRH Q
"RTN","PSOBBC",199,0)
 I '$G(WPPLFLG) S PPL=NEWPPL Q
"RTN","PSOBBC",200,0)
 S WWW="" F  S WWW=$O(WXRX(WWW)) Q:WWW=""  D
"RTN","PSOBBC",201,0)
 .I $G(PPL)="" S PPL=$O(WXRX(WWW,0))_"," Q
"RTN","PSOBBC",202,0)
 .S PPL=PPL_$O(WXRX(WWW,0))_","
"RTN","PSOBBC",203,0)
 Q
"RTN","PSOBBC",204,0)
ULK ;
"RTN","PSOBBC",205,0)
 Q:$G(PSOBBC1("FROM"))'="NEW"
"RTN","PSOBBC",206,0)
 I '$G(PSODFN) Q
"RTN","PSOBBC",207,0)
 S X=PSODFN_";DPT(" D ULK^ORX2 K PSODFNX(PSODFN) Q
"RTN","PSOBBC",208,0)
ULP Q:$G(PSOBBC1("FROM"))'="NEW"
"RTN","PSOBBC",209,0)
 Q:'$G(PSODFN)
"RTN","PSOBBC",210,0)
 D UL^PSSLOCK(PSODFN)
"RTN","PSOBBC",211,0)
 Q
"RTN","PSOBBC",212,0)
ULRX ;
"RTN","PSOBBC",213,0)
 Q:$G(PSOBBC1("FROM"))'="REFILL"
"RTN","PSOBBC",214,0)
 Q:'$G(PSOREFXM)
"RTN","PSOBBC",215,0)
 D PSOUL^PSSLOCK(PSOREFXM)
"RTN","PSOBBC",216,0)
 K PSOREFXM
"RTN","PSOBBC",217,0)
 Q
"RTN","PSOBBC",218,0)
 ;
"RTN","PSOBBC",219,0)
SETX ;
"RTN","PSOBBC",220,0)
 S:$G(PSOBBC1("FROM"))="REFILL" XFROM="BATCH"
"RTN","PSOBBC",221,0)
 S:$G(PSOBBC1("FROM"))="NEW" XFROM="BATCH"
"RTN","PSOBBC",222,0)
 Q
"RTN","PSOBBC",223,0)
PID ;
"RTN","PSOBBC",224,0)
 I '$G(DFN) S DFN=+$G(PSODFN)
"RTN","PSOBBC",225,0)
 Q:'$G(DFN)
"RTN","PSOBBC",226,0)
 K VAPTYP D PID^VADPT
"RTN","PSOBBC",227,0)
 W !!,?9,$G(PSORX("NAME"))_"    ",$G(VA("BID"))
"RTN","PSOBBC",228,0)
 K VA("BID"),VA("PID")
"RTN","PSOBBC",229,0)
 Q
"RTN","PSOPRI")
0^2^B22700966^B22681827
"RTN","PSOPRI",1,0)
PSOPRI ;BIR/JLC - INTERNET PRESCRIPTION REFILL PROCESSOR ;3/27/06 2:23pm
"RTN","PSOPRI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**116,204,242**;DEC 1997
"RTN","PSOPRI",3,0)
 ;
"RTN","PSOPRI",4,0)
 ;Reference to ^PPPPDA1 supported by DBIA 1374
"RTN","PSOPRI",5,0)
 ;Reference to ^PSSLOCK supported by DBIA 2789
"RTN","PSOPRI",6,0)
 ;
"RTN","PSOPRI",7,0)
 ;PSO*242 do not init PSODFN, it should only be set by label print
"RTN","PSOPRI",8,0)
 ;
"RTN","PSOPRI",9,0)
START S PSOVEX=1
"RTN","PSOPRI",10,0)
 K PSOVEXI,PSOISITE,PSOVEXFL,PSONOF
"RTN","PSOPRI",11,0)
 S PSOVX=0 F  S PSOVX=$O(^PS(59,PSOVX)) Q:'PSOVX  I $P($G(^PS(59,PSOVX,"I")),"^"),DT>$P($G(^("I")),"^") S PSOVEXI(PSOVX)=""
"RTN","PSOPRI",12,0)
 I $O(PSOVEXI(0)) W !,"Looking for refill requests for inactive Outpatient divisions..." D
"RTN","PSOPRI",13,0)
 . S PSOVIN=0 F  S PSOVIN=$O(^PS(52.43,"AINST",PSOVIN)) Q:'PSOVIN  S PSOVXLP="" F  S PSOVXLP=$O(^PS(52.43,"AINST",PSOVIN,PSOVXLP)) Q:PSOVXLP=""  D
"RTN","PSOPRI",14,0)
 .. S PSOIEN=$O(^PS(52.43,"AINST",PSOVIN,PSOVXLP,""))
"RTN","PSOPRI",15,0)
 .. S PSOISITE=$P($G(^PSRX(PSOVXLP,2)),"^",9) Q:$G(PSOVEXI(+$G(PSOISITE)))
"RTN","PSOPRI",16,0)
 .. I PSOISITE,$D(PSOVEXI(PSOISITE)),$P($G(^PS(52.43,PSOIEN,0)),"^",5)="" S PSOVEXI(PSOISITE)=1,PSOVEXFL=1
"RTN","PSOPRI",17,0)
 . I '$G(PSOVEXFL) W ".none found.",!
"RTN","PSOPRI",18,0)
 I $G(PSOVEXFL) W !!,"The following Inactive Outpatient sites have refill requests:",! D  I Y'=1 G END
"RTN","PSOPRI",19,0)
 . S PSOVX=0 F  S PSOVX=$O(PSOVEXI(PSOVX)) Q:'PSOVX  I $G(PSOVEXI(PSOVX)) W !?5,$P($G(^PS(59,+$G(PSOVX),0)),"^")
"RTN","PSOPRI",20,0)
 . K DIR W ! S DIR(0)="E",DIR("A")="Press Return to Continue, '^' to exit" D ^DIR W ! I Y'=1 Q
"RTN","PSOPRI",21,0)
 D:'$D(PSOPAR) ^PSOLSET G:'$D(PSOPAR) END
"RTN","PSOPRI",22,0)
 W !!!?20,"Division: "_$P(^PS(59,PSOSITE,0),"^"),!!
"RTN","PSOPRI",23,0)
 S PSOBBC1("FROM")="REFILL",PSOBBC("QFLG")=0,PSOBBC("DFLG")=0
"RTN","PSOPRI",24,0)
 I '$D(^PS(52.43,"AINST",PSOINST)) S PSOANS="N" W !!?7,$C(7),"There are no internet refills to process." G END
"RTN","PSOPRI",25,0)
 D ASK^PSOBBC W:PSOBBC("QFLG")=1 !?7,$C(7),"No internet refills were processed." G:PSOBBC("QFLG")=1 END
"RTN","PSOPRI",26,0)
IPR W ! S DIR("B")="YES",DIR("A")="Process internet refill requests at this time",DIR(0)="Y" D ^DIR K DIR S PSOANS="N" I $G(DIRUT) S PSOPTRX="" G END
"RTN","PSOPRI",27,0)
 G:Y=0 END S PSOPTRX="" I Y=1 S PSOANS="Y"
"RTN","PSOPRI",28,0)
 I PSOANS["Y" S DIR("B")="NO",DIR("A")="Process internet refills for all divisions",DIR(0)="Y" D ^DIR K DIR S PSOANS2="S" S:Y=1 PSOANS2="M" I $G(DIRUT) S PSOANS="N" G END
"RTN","PSOPRI",29,0)
IPR6 I PSOANS["Y",$G(PSOPTRX),'$G(PSOMHV) D IPR5 ;MARK PROCESSED NODES
"RTN","PSOPRI",30,0)
 D IPR3 I $G(PSOANS)="N" D ULK G END
"RTN","PSOPRI",31,0)
 ;I $P(X,"-")'=PSOINST W !?7,$C(7),$C(7),$C(7),"Not from this institution.",! D ULK G IPR6
"RTN","PSOPRI",32,0)
 S (PSOBBC("IRXN"),PSOBBC("OIRXN"))=$P(X,"-",2)
"RTN","PSOPRI",33,0)
 I $G(^PSRX(PSOBBC("IRXN"),0))']"" W !,$C(7),"Rx data is not on file!",! D ULK G IPR6
"RTN","PSOPRI",34,0)
 I $P($G(^PSRX(PSOBBC("IRXN"),"STA")),"^")=13 W !,$C(7),"Rx has already been deleted." D ULK G IPR6
"RTN","PSOPRI",35,0)
 I $G(PSOBBC("DONE"))[PSOBBC("IRXN")_"," W !,$C(7),"Rx has already been entered." D ULK G IPR6
"RTN","PSOPRI",36,0)
 K X,Y D:PSOBBC("QFLG") PROCESSX^PSOBBC
"RTN","PSOPRI",37,0)
 S PSOSELSE=0 I $G(PSODFN)'=$P(^PSRX(PSOBBC("IRXN"),0),"^",2) S PSOSELSE=1 D PT^PSOBBC I $G(PSOBBC("DFLG")) K PSOSELSE D ULK G IPR6
"RTN","PSOPRI",38,0)
 I '$G(PSOSELSE) D PTC^PSOBBC I $G(PSOBBC("DFLG")) K PSOSELSE D ULK G IPR6
"RTN","PSOPRI",39,0)
 K PSOSELSE D PROFILE^PSORX1 S X="PPPPDA1" X ^%ZOSF("TEST") I  S X=$$PDA^PPPPDA1(PSODFN) W !!
"RTN","PSOPRI",40,0)
 S PSOBBC("DONE")=PSOBBC("IRXN")_",",PSOMHV=0 D REFILL^PSOBBC D ULK G IPR6
"RTN","PSOPRI",41,0)
 Q
"RTN","PSOPRI",42,0)
IPR3 K PSOBBC("IRXN"),PSOXFLAG F  S PSOPTRX=$O(^PS(52.43,"AINST",PSOINST,PSOPTRX)) D  Q:PSOANS="N"!($G(PSOXFLAG))
"RTN","PSOPRI",43,0)
 .I PSOPTRX="" S PSOANS="N" Q
"RTN","PSOPRI",44,0)
 .S PSOIEN=$O(^PS(52.43,"AINST",PSOINST,PSOPTRX,""))
"RTN","PSOPRI",45,0)
 .I '$D(^PSRX(+PSOPTRX,0)),$P(^PS(52.43,PSOIEN,0),"^",5)="" S PSONOF=1 D IPR5 K PSONOF Q  ;SKIPS ERRONEOUS ENTRIES
"RTN","PSOPRI",46,0)
IPR4 .I PSOANS["Y" Q:$P(^PS(52.43,PSOIEN,0),"^",5)'=""  S X=PSOINST_"-"_PSOPTRX     ;SKIPS ENTRIES ALREADY PROCESSED AND FORMATS VARIABLE X
"RTN","PSOPRI",47,0)
IPR10 .I PSOANS2["S",$D(^PSRX(+PSOPTRX,0)),PSOSITE'=$P($G(^PSRX(+PSOPTRX,2)),"^",9) Q
"RTN","PSOPRI",48,0)
 .S PSOPSORX=+$G(PSOPTRX) I PSOPSORX D PSOL^PSSLOCK(PSOPSORX) I '$G(PSOMSG) K PSOPSORX,PSOMSG Q
"RTN","PSOPRI",49,0)
 .K PSOMSG S PSOXFLAG=1
"RTN","PSOPRI",50,0)
 Q
"RTN","PSOPRI",51,0)
 ;LINES CALLED TO MARK PROCESSED NODES
"RTN","PSOPRI",52,0)
IPR5 K DA,DR,DIE S DA=$O(^PS(52.43,"AINST",PSOINST,PSOPTRX,""))
"RTN","PSOPRI",53,0)
 S DIE="^PS(52.43,",DR="5////"_DT_";6///"_$S($G(PSOBBC("DFLG"))=1:"NOT FILLED",$G(PSONOF)=1:"NOT FILLED",1:"FILLED") D ^DIE ; MARKS NODE AS PROCESSED
"RTN","PSOPRI",54,0)
 K ^PS(52.43,"AINST",PSOINST,PSOPTRX,DA)
"RTN","PSOPRI",55,0)
 Q
"RTN","PSOPRI",56,0)
END D PROCESSX^PSOBBC
"RTN","PSOPRI",57,0)
 I $P($G(^PS(59,+$G(PSOSITE),"I")),"^"),DT>$P($G(^("I")),"^") D FINAL^PSOLSET W !!,"Your Outpatient Site parameters have been deleted because you selected an",!,"inactive Outpatient Site!",!
"RTN","PSOPRI",58,0)
 K DIR,PSOBBC,PSOBBC1,PSOVIN,PSOISITE,PSOVEXFL,PSOVXLP,PSOVEX,PSOVX,PSOVEXI,PSOANS,PSOANS2,PSOPTRX,PSOXFLAG,PSOPSORX,X,Y,PSODFN,PSOMHV
"RTN","PSOPRI",59,0)
 Q
"RTN","PSOPRI",60,0)
ULK ;
"RTN","PSOPRI",61,0)
 I '$G(PSOPSORX) Q
"RTN","PSOPRI",62,0)
 D PSOUL^PSSLOCK(PSOPSORX)
"RTN","PSOPRI",63,0)
 K PSOPSORX
"RTN","PSOPRI",64,0)
 Q
"VER")
8.0^22.0
"BLD",6412,6)
^209
**END**
**END**
