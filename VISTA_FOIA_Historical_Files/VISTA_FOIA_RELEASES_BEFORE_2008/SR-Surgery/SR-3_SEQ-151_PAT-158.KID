Released SR*3*158 SEQ #151
Extracted from mail message
**KIDS**:SR*3.0*158^

**INSTALL NAME**
SR*3.0*158
"BLD",5944,0)
SR*3.0*158^SURGERY^0^3060622^y
"BLD",5944,1,0)
^^12^12^3060622^
"BLD",5944,1,1,0)
After installing patch SR*3*144, if the SURGICAL RESIDENTS (Y/N) field 
"BLD",5944,1,2,0)
(#33) in the SURGERY SITE PARAMETERS file (#133) is NO, surgical cases for
"BLD",5944,1,3,0)
that division created using the Schedule Unrequested Operations [SROSRES]
"BLD",5944,1,4,0)
option will contain the textual name of the attending surgeon instead of 
"BLD",5944,1,5,0)
the pointer value in the ATTEND SURG field (#.164) in the SURGERY file
"BLD",5944,1,6,0)
(#130).
"BLD",5944,1,7,0)
 
"BLD",5944,1,8,0)
This patch modifies the Schedule Unrequested Operations [SROSRES] option 
"BLD",5944,1,9,0)
so that the ATTEND SURG field (#.164) in the SURGERY file (#130) is set
"BLD",5944,1,10,0)
correctly. This patch includes a post-installation process that will check
"BLD",5944,1,11,0)
each surgical case and correct any textual entries that may exist in the
"BLD",5944,1,12,0)
ATTEND SURG field (#.164) in the SURGERY file (#130).
"BLD",5944,4,0)
^9.64PA^^
"BLD",5944,6.3)
2
"BLD",5944,"INID")
^y
"BLD",5944,"INIT")
POST^SR158UTL
"BLD",5944,"KRN",0)
^9.67PA^8989.52^19
"BLD",5944,"KRN",.4,0)
.4
"BLD",5944,"KRN",.401,0)
.401
"BLD",5944,"KRN",.402,0)
.402
"BLD",5944,"KRN",.403,0)
.403
"BLD",5944,"KRN",.5,0)
.5
"BLD",5944,"KRN",.84,0)
.84
"BLD",5944,"KRN",3.6,0)
3.6
"BLD",5944,"KRN",3.8,0)
3.8
"BLD",5944,"KRN",9.2,0)
9.2
"BLD",5944,"KRN",9.8,0)
9.8
"BLD",5944,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5944,"KRN",9.8,"NM",1,0)
SRSCHUN^^0^B27047120
"BLD",5944,"KRN",9.8,"NM","B","SRSCHUN",1)

"BLD",5944,"KRN",19,0)
19
"BLD",5944,"KRN",19.1,0)
19.1
"BLD",5944,"KRN",101,0)
101
"BLD",5944,"KRN",409.61,0)
409.61
"BLD",5944,"KRN",771,0)
771
"BLD",5944,"KRN",870,0)
870
"BLD",5944,"KRN",8989.51,0)
8989.51
"BLD",5944,"KRN",8989.52,0)
8989.52
"BLD",5944,"KRN",8994,0)
8994
"BLD",5944,"KRN","B",.4,.4)

"BLD",5944,"KRN","B",.401,.401)

"BLD",5944,"KRN","B",.402,.402)

"BLD",5944,"KRN","B",.403,.403)

"BLD",5944,"KRN","B",.5,.5)

"BLD",5944,"KRN","B",.84,.84)

"BLD",5944,"KRN","B",3.6,3.6)

"BLD",5944,"KRN","B",3.8,3.8)

"BLD",5944,"KRN","B",9.2,9.2)

"BLD",5944,"KRN","B",9.8,9.8)

"BLD",5944,"KRN","B",19,19)

"BLD",5944,"KRN","B",19.1,19.1)

"BLD",5944,"KRN","B",101,101)

"BLD",5944,"KRN","B",409.61,409.61)

"BLD",5944,"KRN","B",771,771)

"BLD",5944,"KRN","B",870,870)

"BLD",5944,"KRN","B",8989.51,8989.51)

"BLD",5944,"KRN","B",8989.52,8989.52)

"BLD",5944,"KRN","B",8994,8994)

"BLD",5944,"QUES",0)
^9.62^^
"BLD",5944,"REQB",0)
^9.611^1^1
"BLD",5944,"REQB",1,0)
SR*3.0*144^1
"BLD",5944,"REQB","B","SR*3.0*144",1)

"INIT")
POST^SR158UTL
"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
SURGERY^SR^SURGICAL DATA COLLECTION AND OPERATIONS SCHEDULING
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2930624^2930811
"PKG",167,22,1,"PAH",1,0)
158^3060622
"PKG",167,22,1,"PAH",1,1,0)
^^12^12^3060622
"PKG",167,22,1,"PAH",1,1,1,0)
After installing patch SR*3*144, if the SURGICAL RESIDENTS (Y/N) field 
"PKG",167,22,1,"PAH",1,1,2,0)
(#33) in the SURGERY SITE PARAMETERS file (#133) is NO, surgical cases for
"PKG",167,22,1,"PAH",1,1,3,0)
that division created using the Schedule Unrequested Operations [SROSRES]
"PKG",167,22,1,"PAH",1,1,4,0)
option will contain the textual name of the attending surgeon instead of 
"PKG",167,22,1,"PAH",1,1,5,0)
the pointer value in the ATTEND SURG field (#.164) in the SURGERY file
"PKG",167,22,1,"PAH",1,1,6,0)
(#130).
"PKG",167,22,1,"PAH",1,1,7,0)
 
"PKG",167,22,1,"PAH",1,1,8,0)
This patch modifies the Schedule Unrequested Operations [SROSRES] option 
"PKG",167,22,1,"PAH",1,1,9,0)
so that the ATTEND SURG field (#.164) in the SURGERY file (#130) is set
"PKG",167,22,1,"PAH",1,1,10,0)
correctly. This patch includes a post-installation process that will check
"PKG",167,22,1,"PAH",1,1,11,0)
each surgical case and correct any textual entries that may exist in the
"PKG",167,22,1,"PAH",1,1,12,0)
ATTEND SURG field (#.164) in the SURGERY file (#130).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","SR158UTL")
0^^B666091^n/a
"RTN","SR158UTL",1,0)
SR158UTL ;BIR/ADM - CONVERSION ROUTINE FOR SR*3*158 ;06/22/06
"RTN","SR158UTL",2,0)
 ;;3.0; Surgery ;**158**;24 Jun 93;Build 2
"RTN","SR158UTL",3,0)
 Q
"RTN","SR158UTL",4,0)
POST ; post-install entry for patch SR*3*158
"RTN","SR158UTL",5,0)
 N SRATT,SRCASE,SREQ,SRP1,X S SRCASE=0
"RTN","SR158UTL",6,0)
 F  S SRCASE=$O(^SRF(SRCASE)) Q:'SRCASE  S SRP1=$G(^SRF(SRCASE,.1)) I SRP1'="" D
"RTN","SR158UTL",7,0)
 .S SRATT=$P(SRP1,"^",13) I $L(SRATT),SRATT'=+SRATT S X=$P(SRP1,"^",4) D
"RTN","SR158UTL",8,0)
 ..S SREQ(130,SRCASE_",",.164)=X D FILE^DIE("","SREQ","^TMP(""SR"",$J)")
"RTN","SR158UTL",9,0)
 Q
"RTN","SRSCHUN")
0^1^B27047120^B27018282
"RTN","SRSCHUN",1,0)
SRSCHUN ;BIR/ADM - MAKE UNREQUESTED OPERATION ;06/20/06
"RTN","SRSCHUN",2,0)
 ;;3.0; Surgery ;**3,67,68,88,103,100,144,158**;24 Jun 93;Build 2
"RTN","SRSCHUN",3,0)
MUST S SRLINE="" F I=1:1:80 S SRLINE=SRLINE_"="
"RTN","SRSCHUN",4,0)
 W @IOF W:$D(SRCC) !,?29,$S(SRSCON=1:"FIRST",1:"SECOND")_" CONCURRENT CASE" W !,?14,"SCHEDULE UNREQUESTED OPERATION: REQUIRED INFORMATION",!!,SRNM_" ("_$G(SRSSN)_")",?65,SREQDT,!,SRLINE,!
"RTN","SRSCHUN",5,0)
SURG ; surgeon
"RTN","SRSCHUN",6,0)
 K DIR S DIR(0)="130,.14",DIR("A")="Surgeon" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G END
"RTN","SRSCHUN",7,0)
 I Y=""!(X["^") W !!,"To create a surgical case, a surgeon MUST be selected.  Enter '^' to exit.",! G SURG
"RTN","SRSCHUN",8,0)
 S SRSDOC=+Y
"RTN","SRSCHUN",9,0)
CASE ; create case in SURGERY file
"RTN","SRSCHUN",10,0)
 K DA,DIC,DD,DO,DINUM,SRTN S X=SRSDPT,DIC="^SRF(",DIC(0)="L",DLAYGO=130 D FILE^DICN K DD,DO,DIC,DLAYGO S SRTN=+Y,SRLCK=$$LOCK^SROUTL(SRTN)
"RTN","SRSCHUN",11,0)
 S ^SRF(SRTN,8)=SRSITE("DIV"),^SRF(SRTN,"OP")=""
"RTN","SRSCHUN",12,0)
 D NOW^%DTC S SREQDAY=+$E(%,1,12),SRNOCON=1 K DR,DIE
"RTN","SRSCHUN",13,0)
 S DA=SRTN,DIE=130,DR=".09////"_SRSDATE_";.14////"_SRSDOC_";1.098////"_+SREQDAY_";1.099////"_DUZ_";Q;.02////"_SRSOR_";10////"_SRSDT1_";11////"_SRSDT2 D ^DIE K DR
"RTN","SRSCHUN",14,0)
ASURG ; attending surgeon
"RTN","SRSCHUN",15,0)
 K DA,DIC,DIQ,DR,SRY S DIC="^SRF(",DA=SRTN,DIQ="SRY",DIQ(0)="E",DR=.164 D EN^DIQ1 K DA,DIC,DIQ,DR
"RTN","SRSCHUN",16,0)
 I $G(SRY(130,SRTN,.164,"E"))'="" S SRATTND=SRY(130,SRTN,.164,"E") W !,"Attending Surgeon: "_SRATTND,! G SPEC
"RTN","SRSCHUN",17,0)
 K DIR S DIR(0)="130,.164",DIR("A")="Attending Surgeon" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRSCHUN",18,0)
 I Y=""!(X["^") W !!,"An Attending Surgeon must be entered when creating a case. Enter '^' to exit.",! G ASURG
"RTN","SRSCHUN",19,0)
 S SRATTND=+Y,DA=SRTN,DIE=130,DR=".164////"_SRATTND D ^DIE K DA,DIE,DR
"RTN","SRSCHUN",20,0)
SPEC ; surgical specialty
"RTN","SRSCHUN",21,0)
 K DIR S DIR(0)="130,.04",DIR("A")="Surgical Specialty" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRSCHUN",22,0)
 I Y=""!(X["^") W !!,"To create a surgical case, a surgical specialty MUST be selected.  Enter '^'",!,"to exit.",! G SPEC
"RTN","SRSCHUN",23,0)
 S SRSS=+Y
"RTN","SRSCHUN",24,0)
OP ; principal operative procedure
"RTN","SRSCHUN",25,0)
 K DIR S DIR(0)="130,26",DIR("A")="Principal Operative Procedure" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRSCHUN",26,0)
 I X["^" W !!,"Principal procedure must not contain an up-arrow (^).",! G OP
"RTN","SRSCHUN",27,0)
 S SRSOP=Y I SRSOP="" G OP
"RTN","SRSCHUN",28,0)
OPD ; Principal Preoperative Diagnosis
"RTN","SRSCHUN",29,0)
 K DIR S DIR(0)="130,32",DIR("A")="Principal Preoperative Diagnosis" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRSCHUN",30,0)
 I Y=""!(X["^") W !!,"A Principal Preoperative Diagnosis must be entered",!,"when creating a new case. Enter '^' to exit.",! G OPD
"RTN","SRSCHUN",31,0)
 I X[";" W !,"The Principal Preoperative Diagnosis cannot contain a semicolon (;).",!,"Please re-enter the Diagnosis, using commas in place of the semicolons." G OPD
"RTN","SRSCHUN",32,0)
 S SRSOPD=Y
"RTN","SRSCHUN",33,0)
 W !!,"The information entered into the Principal Preoperative Diagnosis field",!,"has been transferred into the Indications for Operation field.",!,"The Indications for Operation field can be updated later if necessary.",!
"RTN","SRSCHUN",34,0)
 W !!,"Press RETURN to continue  " R X:DTIME
"RTN","SRSCHUN",35,0)
UPDATE ; update case in SURGERY file
"RTN","SRSCHUN",36,0)
 S DA=SRTN,DIE=130,DR="26////"_SRSOP_";68////"_SRSOP_";36////0;Q;.04////"_SRSS_";32////"_SRSOPD D ^DIE
"RTN","SRSCHUN",37,0)
 K DR,DA S DR="[SRO-NOCOMP]",DA=SRTN,DIE=130 D ^DIE K DR
"RTN","SRSCHUN",38,0)
 D ^SROXRET K SRNOCON
"RTN","SRSCHUN",39,0)
OTHER ; other required fields
"RTN","SRSCHUN",40,0)
 S SRFLD=0 F  S SRFLD=$O(^SRO(133,SRSITE,4,SRFLD)) Q:'SRFLD!(SRSOUT)  D OTHDIR Q:SRSOUT
"RTN","SRSCHUN",41,0)
 I SRSOUT G DEL
"RTN","SRSCHUN",42,0)
 S SRSOPD(1)=SRSOPD D WP^DIE(130,SRTN_",",55,"A","SRSOPD")
"RTN","SRSCHUN",43,0)
 D:$G(SRLCK) UNLOCK^SROUTL(SRTN)
"RTN","SRSCHUN",44,0)
 S SROERR=SRTN D ^SROERR I $D(SRDUOUT) S SRSOUT=1
"RTN","SRSCHUN",45,0)
 I $D(SRCC),SRSCON=2 S DIE=130,DR="35////"_SRSCON(1),DA=SRTN D ^DIE K DR S DR="35////"_SRTN,DA=SRSCON(1),DIE=130 D ^DIE K DR,DA S SROERR=SRSCON(1) D ^SROERR0
"RTN","SRSCHUN",46,0)
 Q
"RTN","SRSCHUN",47,0)
DEL S DA=SRTN,DIK="^SRF(" D ^DIK G END
"RTN","SRSCHUN",48,0)
CON ; request concurrent case
"RTN","SRSCHUN",49,0)
 D MUST Q:SRSOUT  S SRSCON(SRSCON,"DOC")=$P(^VA(200,SRSDOC,0),"^"),SRSCON(SRSCON,"SS")=$P(^SRO(137.45,SRSS,0),"^"),SRSCON(SRSCON,"OP")=$P(^SRF(SRTN,"OP"),"^"),SRSCON(SRSCON)=SRTN K DA
"RTN","SRSCHUN",50,0)
 Q
"RTN","SRSCHUN",51,0)
OTHDIR ; call to reader for site specific required fields
"RTN","SRSCHUN",52,0)
 K DIR,SREQ,SRY S FLD=$P(^SRO(133,SRSITE,4,SRFLD,0),"^") D FIELD^DID(130,FLD,"","TITLE","SRY") S DIR(0)="130,"_FLD,DIR("A")=SRY("TITLE") D ^DIR I $D(DTOUT)!(X="^") S SRSOUT=1 Q
"RTN","SRSCHUN",53,0)
 I Y=""!(X["^") W !!,"It is mandatory that you provide this information before proceeding with this",!,"option.",! D ASK Q:SRSOUT  G OTHDIR
"RTN","SRSCHUN",54,0)
 S SREQ(130,SRTN_",",FLD)=$P(Y,"^") D FILE^DIE("","SREQ","^TMP(""SR"",$J)")
"RTN","SRSCHUN",55,0)
 Q
"RTN","SRSCHUN",56,0)
ASK K DIR S DIR(0)="Y",DIR("A")="Do you want to continue with this option ",DIR("B")="YES"
"RTN","SRSCHUN",57,0)
 S DIR("?")="Enter RETURN to continue with this option, or 'NO' to discontinue this option." D ^DIR S:'Y SRSOUT=1
"RTN","SRSCHUN",58,0)
 Q
"RTN","SRSCHUN",59,0)
END D:$G(SRLCK) UNLOCK^SROUTL(SRTN)
"RTN","SRSCHUN",60,0)
 I '$D(SRCC),SRSOUT W !!,"No surgical case has been scheduled.",! S SRTN("OR")=SRSOR,SRTN("START")=SRSDT1,SRTN("END")=SRSDT2,SRSEDT=$E(SRSDT2,1,7) D ^SRSCG
"RTN","SRSCHUN",61,0)
 Q
"VER")
8.0^22.0
"BLD",5944,6)
^151
**END**
**END**
