Released PRPF*3*9 SEQ #9
Extracted from mail message
**KIDS**:PRPF*3.0*9^

**INSTALL NAME**
PRPF*3.0*9
"BLD",991,0)
PRPF*3.0*9^INTEGRATED PATIENT FUNDS^0^2980206^y
"BLD",991,1,0)
^^16^16^2980807^
"BLD",991,1,1,0)
This patch prevents a possible future management error.  The default and
"BLD",991,1,2,0)
maximum date for archieving and purging was "TODAY" when logically one
"BLD",991,1,3,0)
should be purging or archieving "recent" data.  To prevent recurrance of
"BLD",991,1,4,0)
this, the maximum date for these two events has been changed to TODAY-400.
"BLD",991,1,5,0)
 
"BLD",991,1,6,0)
 
"BLD",991,1,7,0)
 
"BLD",991,1,8,0)
 Overview of NOIS MESSAGES:
"BLD",991,1,9,0)
 
"BLD",991,1,10,0)
 -------------------------
"BLD",991,1,11,0)
 
"BLD",991,1,12,0)
 MAR-0798-20011   How to restore unintentionally deleted records.
"BLD",991,1,13,0)
 
"BLD",991,1,14,0)
 
"BLD",991,1,15,0)
 
"BLD",991,1,16,0)
 There are no E3R messages associated with this patch.
"BLD",991,4,0)
^9.64PA^^0
"BLD",991,"KRN",0)
^9.67PA^19^18
"BLD",991,"KRN",.4,0)
.4
"BLD",991,"KRN",.401,0)
.401
"BLD",991,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",991,"KRN",.402,0)
.402
"BLD",991,"KRN",.403,0)
.403
"BLD",991,"KRN",.5,0)
.5
"BLD",991,"KRN",.84,0)
.84
"BLD",991,"KRN",3.6,0)
3.6
"BLD",991,"KRN",3.8,0)
3.8
"BLD",991,"KRN",9.2,0)
9.2
"BLD",991,"KRN",9.8,0)
9.8
"BLD",991,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",991,"KRN",9.8,"NM",1,0)
PRPFARC^^0^B14475988
"BLD",991,"KRN",9.8,"NM",2,0)
PRPFPURG^^0^B9558627
"BLD",991,"KRN",9.8,"NM","B","PRPFARC",1)

"BLD",991,"KRN",9.8,"NM","B","PRPFPURG",2)

"BLD",991,"KRN",19,0)
19
"BLD",991,"KRN",19.1,0)
19.1
"BLD",991,"KRN",101,0)
101
"BLD",991,"KRN",409.61,0)
409.61
"BLD",991,"KRN",771,0)
771
"BLD",991,"KRN",869.2,0)
869.2
"BLD",991,"KRN",870,0)
870
"BLD",991,"KRN",8994,0)
8994
"BLD",991,"KRN","B",.4,.4)

"BLD",991,"KRN","B",.401,.401)

"BLD",991,"KRN","B",.402,.402)

"BLD",991,"KRN","B",.403,.403)

"BLD",991,"KRN","B",.5,.5)

"BLD",991,"KRN","B",.84,.84)

"BLD",991,"KRN","B",3.6,3.6)

"BLD",991,"KRN","B",3.8,3.8)

"BLD",991,"KRN","B",9.2,9.2)

"BLD",991,"KRN","B",9.8,9.8)

"BLD",991,"KRN","B",19,19)

"BLD",991,"KRN","B",19.1,19.1)

"BLD",991,"KRN","B",101,101)

"BLD",991,"KRN","B",409.61,409.61)

"BLD",991,"KRN","B",771,771)

"BLD",991,"KRN","B",869.2,869.2)

"BLD",991,"KRN","B",870,870)

"BLD",991,"KRN","B",8994,8994)

"BLD",991,"QUES",0)
^9.62^^
"BLD",991,"REQB",0)
^9.611^^
"PKG",466,-1)
1^1
"PKG",466,0)
INTEGRATED PATIENT FUNDS^PRPF^PATIENT FUNDS.  INTEGRATED WITH PATIENT FILE
"PKG",466,20,0)
^9.402P^^
"PKG",466,22,0)
^9.49I^1^1
"PKG",466,22,1,0)
3.0^2970224
"PKG",466,22,1,"PAH",1,0)
9^2980206
"PKG",466,22,1,"PAH",1,1,0)
^^16^16^2980916
"PKG",466,22,1,"PAH",1,1,1,0)
This patch prevents a possible future management error.  The default and
"PKG",466,22,1,"PAH",1,1,2,0)
maximum date for archieving and purging was "TODAY" when logically one
"PKG",466,22,1,"PAH",1,1,3,0)
should be purging or archieving "recent" data.  To prevent recurrance of
"PKG",466,22,1,"PAH",1,1,4,0)
this, the maximum date for these two events has been changed to TODAY-400.
"PKG",466,22,1,"PAH",1,1,5,0)
 
"PKG",466,22,1,"PAH",1,1,6,0)
 
"PKG",466,22,1,"PAH",1,1,7,0)
 
"PKG",466,22,1,"PAH",1,1,8,0)
 Overview of NOIS MESSAGES:
"PKG",466,22,1,"PAH",1,1,9,0)
 
"PKG",466,22,1,"PAH",1,1,10,0)
 -------------------------
"PKG",466,22,1,"PAH",1,1,11,0)
 
"PKG",466,22,1,"PAH",1,1,12,0)
 MAR-0798-20011   How to restore unintentionally deleted records.
"PKG",466,22,1,"PAH",1,1,13,0)
 
"PKG",466,22,1,"PAH",1,1,14,0)
 
"PKG",466,22,1,"PAH",1,1,15,0)
 
"PKG",466,22,1,"PAH",1,1,16,0)
 There are no E3R messages associated with this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PRPFARC")
0^1^B14475988
"RTN","PRPFARC",1,0)
PRPFARC ;CTB/ALTOONA   PATIENT FUNDS ARCHIVE  ;1/7/98  12:25 PM
"RTN","PRPFARC",2,0)
V ;;3.0;PATIENT FUNDS;**6,7,9**;JUNE 1, 1989
"RTN","PRPFARC",3,0)
 N X,MTIO,NAME,PGCOUNT,XPDNM,ZTQUEUED
"RTN","PRPFARC",4,0)
 S X="This option will cause all transactions of all cards to be written to tape in alphabetical order" D MSG^PRPFU1
"RTN","PRPFARC",5,0)
 K ^TMP($J,"PRPFARC")
"RTN","PRPFARC",6,0)
 S PGCOUNT=0
"RTN","PRPFARC",7,0)
 S %A="Are You Ready to Begin",%B="",%=1 D ^PRPFYN Q:%'=1
"RTN","PRPFARC",8,0)
 S MESSAGE="BUILDING ALPHABETIC CROSS REFERENCE IN ^TMP.  ITEMS=PATIENTS"
"RTN","PRPFARC",9,0)
 S TREC=$P(^PRPF(470,0),"^",4)
"RTN","PRPFARC",10,0)
 G DONE:TREC<1 ;  By REW 3*9   QUIT:TREC=0
"RTN","PRPFARC",11,0)
 D BEGIN^PRPFU
"RTN","PRPFARC",12,0)
 S DA=0 F  D  S XCOUNT=XCOUNT+COUNT D:'$D(ZTQUEUED) PERCENT^PRPFU Q:'DA
"RTN","PRPFARC",13,0)
 . F COUNT=1:1:LREC S DA=$O(^PRPF(470,DA)) Q:'DA  S:$D(^DPT(DA,0)) ^TMP($J,"PRPFARC",$P(^DPT(DA,0),"^"),DA)=""
"RTN","PRPFARC",14,0)
 . QUIT
"RTN","PRPFARC",15,0)
 K X S $P(X," ",40)=""
"RTN","PRPFARC",16,0)
 W !!!!,"100% complete."_$P(X," ",1,40),!
"RTN","PRPFARC",17,0)
 D:$G(XPDNM)="" KILL^%ZISS
"RTN","PRPFARC",18,0)
HDR W !!,"You now need to enter the header information:"
"RTN","PRPFARC",19,0)
 S DIR(0)="FA^3:30",DIR("A")="Select Header Line 1: ",DIR("B")=$S($D(LINE(1)):LINE(1),1:"VA MEDICAL CENTER"),DIR("?")="Enter the first line of the header to be printed on the archive record tape or an '^' to quit"
"RTN","PRPFARC",20,0)
 D ^DIR K DIR I $$DIR^PRPFU2 D TERM QUIT
"RTN","PRPFARC",21,0)
 S LINE(1)=Y
"RTN","PRPFARC",22,0)
 S DIR(0)="FA^3:30",DIR("A")="Select Header Line 2: ",DIR("?")="Enter the second line of the header to be printed on the archive record tape or an '^' to quit" S:$D(LINE(2)) DIR("B")=LINE(2)
"RTN","PRPFARC",23,0)
 D ^DIR K DIR I $$DIR^PRPFU2 D TERM QUIT
"RTN","PRPFARC",24,0)
 S LINE(2)=Y
"RTN","PRPFARC",25,0)
 S DIR(0)="FOA^3:30",DIR("A")="Select Header Line 3: ",DIR("?")="Enter the third line of the header to be printed on the archive record tape or an '^' to quit" S:$D(LINE(3)) DIR("B")=LINE(3)
"RTN","PRPFARC",26,0)
 D ^DIR K DIR I Y]"",$$DIR^PRPFU2 D TERM QUIT
"RTN","PRPFARC",27,0)
 S LINE(3)=Y
"RTN","PRPFARC",28,0)
 W !! F I=1:1:3 W LINE(I),!
"RTN","PRPFARC",29,0)
 D NOW^PRPFQ S LINE(4)=%X
"RTN","PRPFARC",30,0)
 S DIR("A")="IS THIS OK",DIR(0)="Y" D ^DIR I $$DIR^PRPFU2 D TERM QUIT
"RTN","PRPFARC",31,0)
 I 'Y W !!,"OK, you may now edit this information.",! G HDR
"RTN","PRPFARC",32,0)
 S %ZIS("A")="Select Tape/HFS Device: "
"RTN","PRPFARC",33,0)
 D ^%ZIS I POP D TERM QUIT
"RTN","PRPFARC",34,0)
 S MTIO=IO D HOME^%ZIS
"RTN","PRPFARC",35,0)
 S PRPF("ARCHIVE")=""
"RTN","PRPFARC",36,0)
 U MTIO W "1^PATIENT FUNDS ARCHIVE^"_$$DATE^PRPFU1(DT),!,"2^"_LINE(1),!,"2^"_LINE(2)
"RTN","PRPFARC",37,0)
 U MTIO I $G(LINE(3))]"" W !,"2^"_LINE(3)
"RTN","PRPFARC",38,0)
 U MTIO W !,"3^~~PRPF~~^"_$P(^PRPF(470,0),"^",4)_"^^"
"RTN","PRPFARC",39,0)
 U MTIO W !,"4^NAME^CLAIM^SSN"
"RTN","PRPFARC",40,0)
 U MTIO W !,"5^LANDSCAPE^COURIER NEW^24",!
"RTN","PRPFARC",41,0)
 S MESSAGE="ARCHIVING PATIENT FUNDS CARDS.  ITEMS=PATIENT NAME"
"RTN","PRPFARC",42,0)
 S NAME="" F I=0:1 S NAME=$O(^TMP($J,"PRPFARC",NAME)) Q:NAME=""
"RTN","PRPFARC",43,0)
 S TREC=I
"RTN","PRPFARC",44,0)
 QUIT:TREC=0
"RTN","PRPFARC",45,0)
 U IO D BEGIN^PRPFU
"RTN","PRPFARC",46,0)
 S NAME="" F  U MTIO D  S XCOUNT=XCOUNT+COUNT U IO D:'$D(ZTQUEUED) PERCENT^PRPFU Q:NAME=""
"RTN","PRPFARC",47,0)
 . F COUNT=1:1:LREC S NAME=$O(^TMP($J,"PRPFARC",NAME)) Q:NAME=""  D
"RTN","PRPFARC",48,0)
 . . S DA=0 F  S DA=$O(^TMP($J,"PRPFARC",NAME,DA)) Q:'DA  D
"RTN","PRPFARC",49,0)
 . . . S DFN=DA
"RTN","PRPFARC",50,0)
 . . . U MTIO D EN2^PRPFCD
"RTN","PRPFARC",51,0)
 . . . QUIT
"RTN","PRPFARC",52,0)
 . . QUIT
"RTN","PRPFARC",53,0)
 . QUIT
"RTN","PRPFARC",54,0)
 U MTIO W !!,"ARCHIVE COMPLETED*^^*"
"RTN","PRPFARC",55,0)
 D:$G(XPDNM)="" KILL^%ZISS
"RTN","PRPFARC",56,0)
 D CLOSE^PRPFU,END^PRPFU
"RTN","PRPFARC",57,0)
DONE D ADD("ARCHIVE",DT)
"RTN","PRPFARC",58,0)
 U IO W !!,"ARCHIVE COMPLETED",$C(7)
"RTN","PRPFARC",59,0)
 QUIT
"RTN","PRPFARC",60,0)
TERM ;
"RTN","PRPFARC",61,0)
 U IO W "  OPTION TERMINATED",$C(7) Q
"RTN","PRPFARC",62,0)
ADD(TYPE,THRU) ;ADD ENTRY TO ARCHIVE HISTORY FILE
"RTN","PRPFARC",63,0)
 NEW DIC,X,%,%H,%I,DA,DR,DLAYGO
"RTN","PRPFARC",64,0)
 D NOW^%DTC S X=%
"RTN","PRPFARC",65,0)
 K DD,D0 S DIC="^PRPF(470.9,",DIC(0)="ML",DLAYGO=470.9
"RTN","PRPFARC",66,0)
 S DIC("DR")="1///"_TYPE I $D(THRU) S DIC("DR")=DIC("DR")_";2///"_THRU
"RTN","PRPFARC",67,0)
 D FILE^DICN
"RTN","PRPFARC",68,0)
 QUIT
"RTN","PRPFPURG")
0^2^B9558627
"RTN","PRPFPURG",1,0)
PRPFPURG ;CTB/WASH-ISC@ALTOONA  PATIENT FUNDS PURGE ;3/18/97  1:49 PM
"RTN","PRPFPURG",2,0)
V ;;3.0;PATIENT FUNDS;**6,9**;JUNE 1, 1989
"RTN","PRPFPURG",3,0)
 N PERCENT,MIN,SEC,TIME,DX,DY,HOURS,TREC,LREC,LINE,DA,LASTENT,XPOS,A,BTIME,XCOUNT,COUNT,LASTARCH,PURGDATE,RETURN,LY
"RTN","PRPFPURG",4,0)
 W @IOF,!!!
"RTN","PRPFPURG",5,0)
 S %A="This program will summarize and remove entries from the Patient Funds card and",%A(1)="make a BALANCE CARRIED FORWARD entry for the summarized amount.",%A(2)="OK to Continue",%=1 D ^PRPFYN
"RTN","PRPFPURG",6,0)
 Q:%'=1
"RTN","PRPFPURG",7,0)
 S LASTARCH=$O(^PRPF(470.9,"AC",0))
"RTN","PRPFPURG",8,0)
 I LASTARCH="" S X="This data has never been archived, purging cannot be accomplished until the archive is completed.*7" D MSG^PRPFU1 S X="No action taken.*7" D MSG^PRPFU1 QUIT
"RTN","PRPFPURG",9,0)
 S LASTARCH=10000000-LASTARCH,Y=LASTARCH,LY=$$FMADD^XLFDT(DT,-400) S:Y>LY Y=LY S %DT(0)=-Y D D^PRPFU1 ; By REW for 3*9
"RTN","PRPFPURG",10,0)
DT S %DT("B")=$P(Y,"@") W !!,"The Summarize Through date must be no later than "_%DT("B"),!,"  --  the earlier of 400 days before today and the date of the latest archive.",!
"RTN","PRPFPURG",11,0)
 S %DT="AEXP",%DT("A")="Select the desired Summarize Through date: "
"RTN","PRPFPURG",12,0)
 D ^%DT K %DT(0) Q:Y<0  ; By REW for 3*9
"RTN","PRPFPURG",13,0)
DTZ ;W !! S %DT="AEXP",%DT("A")="Select ending date for summarization: ",%DT("B")=$P(Y,"@") D ^%DT Q:Y<0
"RTN","PRPFPURG",14,0)
 ; I Y>LASTARCH S Y=LASTARCH D D^PRPFU1 S X="The date you selected exceeds the last archive date of "_Y_".  You may NOT purge data that has not been archived.*7" D MSG^PRPFU1 G DT ; can no longer happen! rew 3*9
"RTN","PRPFPURG",15,0)
 S PURGDATE=$P(Y,".")
"RTN","PRPFPURG",16,0)
 S TREC=$P(^PRPF(470,0),"^",4)
"RTN","PRPFPURG",17,0)
 ; G DONE???? rather than Q: ????????? why did I ever want to ??????
"RTN","PRPFPURG",18,0)
 Q:TREC<1  ; By REW for 3*9  QUIT:TREC=0
"RTN","PRPFPURG",19,0)
 S MESSAGE="Loading Purgemaster for Patient Funds purge.  ITEMS BEING PROCESSED = DAYS"
"RTN","PRPFPURG",20,0)
 D BEGIN^PRPFU
"RTN","PRPFPURG",21,0)
 S DA=0 F  D  S XCOUNT=XCOUNT+COUNT D:'$D(ZTQUEUED) PERCENT^PRPFU Q:'DA
"RTN","PRPFPURG",22,0)
 . F COUNT=1:1:LREC S DA=$O(^PRPF(470,DA)) S:'DA COUNT=COUNT-1 Q:'DA  D ADD^PRCGPM1("ONE^PRPFPUR1",DA_","_PURGDATE,.RETURN)
"RTN","PRPFPURG",23,0)
 . QUIT
"RTN","PRPFPURG",24,0)
 K X S $P(X," ",40)=""
"RTN","PRPFPURG",25,0)
 W !!!!,"100% complete."_$P(X," ",1,40),!
"RTN","PRPFPURG",26,0)
 D:$G(XPDNM)="" KILL^%ZISS
"RTN","PRPFPURG",27,0)
X W !! S X="For PurgeMaster to run, you must execute the PRCG PURGEMASTER SITE EDIT option and then schedule the PRCG PURGEMASTER (TASKMANAGER) option to run daily."
"RTN","PRPFPURG",28,0)
 D MSG^PRPFQ
"RTN","PRPFPURG",29,0)
 ;DONE  --  was label of next line
"RTN","PRPFPURG",30,0)
 D ADD^PRPFARC("PURGE",PURGDATE)
"RTN","PRPFPURG",31,0)
 QUIT
"RTN","PRPFPURG",32,0)
 ;
"RTN","PRPFPURG",33,0)
OT ;OPTION TERMINATED
"RTN","PRPFPURG",34,0)
 S X="  <Option Terminated, No Action Taken.>*" D MSG^PRPFU1
"RTN","PRPFPURG",35,0)
 Q
"VER")
8.0^21.0
**END**
**END**
