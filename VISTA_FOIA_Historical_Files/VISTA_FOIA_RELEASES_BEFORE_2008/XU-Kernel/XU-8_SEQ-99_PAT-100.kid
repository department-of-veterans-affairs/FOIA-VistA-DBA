Released XU*8*100 SEQ #99
Extracted from mail message
**KIDS**:XU*8.0*100^

**INSTALL NAME**
XU*8.0*100
"BLD",116,0)
XU*8.0*100^KERNEL^0^^y
"BLD",116,4,0)
^9.64PA^9.7^2
"BLD",116,4,9.6,0)
9.6
"BLD",116,4,9.6,2,0)
^9.641^9.63^1
"BLD",116,4,9.6,2,9.63,0)
MULTIPLE BUILD  (sub-file)
"BLD",116,4,9.6,2,9.63,1,0)
^9.6411^.001^2
"BLD",116,4,9.6,2,9.63,1,.001,0)
INSTALL ORDER
"BLD",116,4,9.6,2,9.63,1,.02,0)
REQUIRED TO CONTINUE
"BLD",116,4,9.6,222)
y^n^p^^^^n
"BLD",116,4,9.7,0)
9.7
"BLD",116,4,9.7,2,0)
^9.641^9.7^1
"BLD",116,4,9.7,2,9.7,0)
INSTALL  (File-top level)
"BLD",116,4,9.7,2,9.7,1,0)
^9.6411^6.5^1
"BLD",116,4,9.7,2,9.7,1,6.5,0)
REQUIRED TO CONTINUE
"BLD",116,4,9.7,222)
y^n^p^^^^n
"BLD",116,4,"APDD",9.6,9.63)

"BLD",116,4,"APDD",9.6,9.63,.001)

"BLD",116,4,"APDD",9.6,9.63,.02)

"BLD",116,4,"APDD",9.7,9.7)

"BLD",116,4,"APDD",9.7,9.7,6.5)

"BLD",116,4,"B",9.6,9.6)

"BLD",116,4,"B",9.7,9.7)

"BLD",116,"KRN",0)
^9.67PA^19^18
"BLD",116,"KRN",.4,0)
.4
"BLD",116,"KRN",.401,0)
.401
"BLD",116,"KRN",.402,0)
.402
"BLD",116,"KRN",.403,0)
.403
"BLD",116,"KRN",.403,"NM",0)
^9.68A^1^1
"BLD",116,"KRN",.403,"NM",1,0)
XPD EDIT MP    FILE #9.6^9.6^0
"BLD",116,"KRN",.403,"NM","B","XPD EDIT MP    FILE #9.6",1)

"BLD",116,"KRN",.5,0)
.5
"BLD",116,"KRN",.84,0)
.84
"BLD",116,"KRN",3.6,0)
3.6
"BLD",116,"KRN",3.8,0)
3.8
"BLD",116,"KRN",9.2,0)
9.2
"BLD",116,"KRN",9.8,0)
9.8
"BLD",116,"KRN",9.8,"NM",0)
^9.68A^7^6
"BLD",116,"KRN",9.8,"NM",1,0)
XPDDP^^0^B29288964
"BLD",116,"KRN",9.8,"NM",2,0)
XPDIP^^0^B36444749
"BLD",116,"KRN",9.8,"NM",3,0)
XPDUTL^^0^B11869701
"BLD",116,"KRN",9.8,"NM",4,0)
XPDT^^0^B57451355
"BLD",116,"KRN",9.8,"NM",5,0)
XPDTC^^0^B38539825
"BLD",116,"KRN",9.8,"NM",7,0)
XPDIL1^^0^B32640563
"BLD",116,"KRN",9.8,"NM","B","XPDDP",1)

"BLD",116,"KRN",9.8,"NM","B","XPDIL1",7)

"BLD",116,"KRN",9.8,"NM","B","XPDIP",2)

"BLD",116,"KRN",9.8,"NM","B","XPDT",4)

"BLD",116,"KRN",9.8,"NM","B","XPDTC",5)

"BLD",116,"KRN",9.8,"NM","B","XPDUTL",3)

"BLD",116,"KRN",19,0)
19
"BLD",116,"KRN",19.1,0)
19.1
"BLD",116,"KRN",101,0)
101
"BLD",116,"KRN",409.61,0)
409.61
"BLD",116,"KRN",771,0)
771
"BLD",116,"KRN",869.2,0)
869.2
"BLD",116,"KRN",870,0)
870
"BLD",116,"KRN",8994,0)
8994
"BLD",116,"KRN","B",.4,.4)

"BLD",116,"KRN","B",.401,.401)

"BLD",116,"KRN","B",.402,.402)

"BLD",116,"KRN","B",.403,.403)

"BLD",116,"KRN","B",.5,.5)

"BLD",116,"KRN","B",.84,.84)

"BLD",116,"KRN","B",3.6,3.6)

"BLD",116,"KRN","B",3.8,3.8)

"BLD",116,"KRN","B",9.2,9.2)

"BLD",116,"KRN","B",9.8,9.8)

"BLD",116,"KRN","B",19,19)

"BLD",116,"KRN","B",19.1,19.1)

"BLD",116,"KRN","B",101,101)

"BLD",116,"KRN","B",409.61,409.61)

"BLD",116,"KRN","B",771,771)

"BLD",116,"KRN","B",869.2,869.2)

"BLD",116,"KRN","B",870,870)

"BLD",116,"KRN","B",8994,8994)

"BLD",116,"QUES",0)
^9.62^^
"BLD",116,"REQB",0)
^9.611^^
"FIA",9.6)
BUILD
"FIA",9.6,0)
^XPD(9.6,
"FIA",9.6,0,0)
9.6I
"FIA",9.6,0,1)
y^n^p^^^^n
"FIA",9.6,0,10)

"FIA",9.6,0,11)

"FIA",9.6,0,"RLRO")

"FIA",9.6,0,"VR")
8.0^XU
"FIA",9.6,9.6)
1
"FIA",9.6,9.63)
1
"FIA",9.6,9.63,.001)

"FIA",9.6,9.63,.02)

"FIA",9.7)
INSTALL
"FIA",9.7,0)
^XPD(9.7,
"FIA",9.7,0,0)
9.7I
"FIA",9.7,0,1)
y^n^p^^^^n
"FIA",9.7,0,10)

"FIA",9.7,0,11)

"FIA",9.7,0,"RLRO")

"FIA",9.7,0,"VR")
8.0^XU
"FIA",9.7,9.7)
1
"FIA",9.7,9.7,6.5)

"KRN",.403,17,-1)
0^1
"KRN",.403,17,0)
XPD EDIT MP^@^@^^2960906.0824^^^9.6^0^0^1
"KRN",.403,17,40,0)
^.4031I^1^1
"KRN",.403,17,40,1,0)
1^^1,1
"KRN",.403,17,40,1,1)
Page 1
"KRN",.403,17,40,1,40,0)
^.4032IP^68^3
"KRN",.403,17,40,1,40,66,0)
XPD EDIT MP1^2^1,1^e
"KRN",.403,17,40,1,40,67,0)
XPD EDIT HDR^1^1,1^e
"KRN",.403,17,40,1,40,68,0)
XPD EDIT MP2^3^13,1^e
"KRN",.403,17,40,1,40,68,2)
4^!IEN^n
"KRN",.404,66,0)
XPD EDIT MP1^9.6
"KRN",.404,66,40,0)
^.4044I^7^7
"KRN",.404,66,40,1,0)
1^1 OF 1^1
"KRN",.404,66,40,1,2)
^^1,71
"KRN",.404,66,40,2,0)
4^Description^3
"KRN",.404,66,40,2,1)
3
"KRN",.404,66,40,2,2)
9,26^1^9,13
"KRN",.404,66,40,3,0)
6^Packages or Patches^1
"KRN",.404,66,40,3,2)
^^12,22
"KRN",.404,66,40,4,0)
5^Install Order^1
"KRN",.404,66,40,4,2)
^^12,1
"KRN",.404,66,40,5,0)
2^Name^3
"KRN",.404,66,40,5,1)
.01
"KRN",.404,66,40,5,2)
5,26^50^5,20
"KRN",.404,66,40,6,0)
3^Date Distributed^3
"KRN",.404,66,40,6,1)
.02
"KRN",.404,66,40,6,2)
7,26^11^7,8
"KRN",.404,66,40,7,0)
7^Continue^1
"KRN",.404,66,40,7,2)
^^12,68
"KRN",.404,67,0)
XPD EDIT HDR^9.6
"KRN",.404,67,40,0)
^.4044I^6^6
"KRN",.404,67,40,1,0)
1^Edit a Build^1
"KRN",.404,67,40,1,2)
^^1,28
"KRN",.404,67,40,2,0)
3^Name^3
"KRN",.404,67,40,2,1)
.01
"KRN",.404,67,40,2,2)
2,7^30^2,1
"KRN",.404,67,40,2,4)
^^^1
"KRN",.404,67,40,3,0)
2^PAGE^1
"KRN",.404,67,40,3,2)
^^1,66^1
"KRN",.404,67,40,4,0)
5^!M^1
"KRN",.404,67,40,4,.1)
S $P(Y,"-",80)=""
"KRN",.404,67,40,4,2)
^^3,1
"KRN",.404,67,40,5,0)
4^TYPE^3
"KRN",.404,67,40,5,1)
2
"KRN",.404,67,40,5,2)
2,51^14^2,45
"KRN",.404,67,40,5,4)
^^^1
"KRN",.404,67,40,6,0)
6^Required to^1
"KRN",.404,67,40,6,2)
^^11,68
"KRN",.404,68,0)
XPD EDIT MP2^9.63
"KRN",.404,68,40,0)
^.4044I^5^3
"KRN",.404,68,40,1,0)
1^^3
"KRN",.404,68,40,1,1)
.001
"KRN",.404,68,40,1,2)
1,3^6
"KRN",.404,68,40,1,4)
1^^^1
"KRN",.404,68,40,2,0)
2^^3
"KRN",.404,68,40,2,1)
.01
"KRN",.404,68,40,2,2)
1,22^43
"KRN",.404,68,40,5,0)
3^^3
"KRN",.404,68,40,5,1)
.02
"KRN",.404,68,40,5,2)
1,71^3
"MBREQ")
0
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
100
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","XPDDP")
0^1^B29288964
"RTN","XPDDP",1,0)
XPDDP ;SFISC/RSD - Display a package ;02/19/99  08:20
"RTN","XPDDP",2,0)
 ;;8.0;KERNEL;**21,28,44,68,100**;Jul 05, 1995
"RTN","XPDDP",3,0)
EN1 ;print from Build file
"RTN","XPDDP",4,0)
 N DIC,D0,XPD,Y,Z
"RTN","XPDDP",5,0)
 S DIC="^XPD(9.6,",DIC(0)="AEMQZ" D ^DIC Q:Y'>0
"RTN","XPDDP",6,0)
 S D0=+Y,XPD("D0")="",Y="PNT^XPDDP(""XPD(9.6,D0)"")",Z="Build File Print"
"RTN","XPDDP",7,0)
 D EN^XUTMDEVQ(Y,Z,.XPD)
"RTN","XPDDP",8,0)
 Q
"RTN","XPDDP",9,0)
EN2 ;print from Distribution
"RTN","XPDDP",10,0)
 N D0,DIC,POP,XPD,XPDA,XPDNM,Y,Z,%ZIS
"RTN","XPDDP",11,0)
 S DIC="^XPD(9.7,",DIC(0)="AEQMZ",DIC("S")="I $D(^XTMP(""XPDI"",Y))"
"RTN","XPDDP",12,0)
 D ^DIC Q:Y<0
"RTN","XPDDP",13,0)
 S XPD("D0")="",XPD("XPDA")="",XPDA=+Y,Y="PNT^XPDDP(""XTMP(""""XPDI"""",XPDA,""""BLD"""",D0)"")",Z="Transport Global Print",D0=$O(^XTMP("XPDI",XPDA,"BLD",0))
"RTN","XPDDP",14,0)
 Q:'D0
"RTN","XPDDP",15,0)
 D EN^XUTMDEVQ(Y,Z,.XPD)
"RTN","XPDDP",16,0)
 Q
"RTN","XPDDP",17,0)
 ;
"RTN","XPDDP",18,0)
PNT(XPDGR) ;print a package, XPDGR=global root
"RTN","XPDDP",19,0)
 ;XPDFL=0 - Build - ^XPD(9.7 global root, 1 - Install - ^XTMP global root
"RTN","XPDDP",20,0)
 ;2 - Packman ^TMP($J, global root
"RTN","XPDDP",21,0)
 N I,J,K,X,XPD,XPDDT,XPDI,XPD0,XPDFL,XPDPG,XPDUL,XPDTYPE,XPDTRACK
"RTN","XPDDP",22,0)
 Q:$G(XPDGR)=""  S XPDGR="^"_XPDGR
"RTN","XPDDP",23,0)
 Q:'$D(@XPDGR@(0))
"RTN","XPDDP",24,0)
 S XPD0=^(0),XPDPG=1,XPDFL=$S($E(XPDGR,1,5)="^TMP(":2,1:$E(XPDGR,1,5)="^XTMP"),$P(XPDUL,"-",IOM)="",XPDDT=$$HTE^XLFDT($H,"1PM"),XPDTYPE=+$P(XPD0,U,3),XPDTRACK=$P(XPD0,U,5)
"RTN","XPDDP",25,0)
 W:$E(IOST,1,2)="C-" @IOF D HDR W XPDUL,!
"RTN","XPDDP",26,0)
 W "TYPE: ",$$EXTERNAL^DILFD(9.6,2,"",XPDTYPE)
"RTN","XPDDP",27,0)
 W !,"TRACK NATIONALLY: ",$$EXTERNAL^DILFD(9.6,5,"",XPDTRACK)
"RTN","XPDDP",28,0)
 W !,"NATIONAL PACKAGE: ",$P($G(^DIC(9.4,+$P(XPD0,U,2),0),$P(XPD0,U,2)),U)
"RTN","XPDDP",29,0)
 W !,"DESCRIPTION:",!
"RTN","XPDDP",30,0)
 S XPDI=0 F  S XPDI=$O(@XPDGR@(1,XPDI)) Q:'XPDI  I $D(^(XPDI,0)) W ^(0),! Q:$$CHK(4)
"RTN","XPDDP",31,0)
 Q:$D(DIRUT)  G:XPDTYPE=1 MULT
"RTN","XPDDP",32,0)
 W !,"ENVIRONMENT CHECK : ",$G(@XPDGR@("PRE")),!
"RTN","XPDDP",33,0)
 W:'XPDTYPE " PRE-INIT ROUTINE : ",$G(@XPDGR@("INI")),!
"RTN","XPDDP",34,0)
 Q:$$CHK(4)  W "POST-INIT ROUTINE : ",$G(@XPDGR@("INIT")),!
"RTN","XPDDP",35,0)
 W:'XPDTYPE "PRE-TRANSPORT RTN : ",$G(@XPDGR@("PRET")),!
"RTN","XPDDP",36,0)
 G:XPDTYPE=2 GLOBAL
"RTN","XPDDP",37,0)
 I '$O(@XPDGR@(4,0)) Q:$$CHK(4)  G COMP
"RTN","XPDDP",38,0)
 S I=$$CHK(10,1) Q:I  I '$P(I,"^",2) W !! D HDR1 W XPDUL,!
"RTN","XPDDP",39,0)
PNT2 S XPDI=0 F  S XPDI=$O(@XPDGR@(4,XPDI)) Q:'XPDI  S XPD=$G(^(XPDI,222)) Q:$$CHK(4,1)  D
"RTN","XPDDP",40,0)
 .;file number, file name, partial DD
"RTN","XPDDP",41,0)
 .W !,XPDI,?12,$S('XPDFL:$P($G(^DIC(XPDI,0),"**unknown**"),U),1:$G(^XTMP("XPDI",XPDA,"FIA",XPDI)))
"RTN","XPDDP",42,0)
 .W ?41,$$EXTERNAL^DILFD(9.64,222.1,"",$P(XPD,U)),?47,$$EXTERNAL^DILFD(9.64,222.2,"",$P(XPD,U,2)),?53,$$EXTERNAL^DILFD(9.64,222.7,"",$P(XPD,U,7))
"RTN","XPDDP",43,0)
 .W ?60,$E($$EXTERNAL^DILFD(9.64,222.8,"",$P(XPD,U,8)),1,4),?67,$$EXTERNAL^DILFD(9.64,222.5,"",$P(XPD,U,5)),?73,$$EXTERNAL^DILFD(9.64,222.9,"",$P(XPD,U,9)),!
"RTN","XPDDP",44,0)
 .;print partial DD information
"RTN","XPDDP",45,0)
 .I $P(XPD,U,3)="p" S J=0 D
"RTN","XPDDP",46,0)
 ..W "Partial DD:"
"RTN","XPDDP",47,0)
 ..F  S J=$O(@XPDGR@(4,"APDD",XPDI,J)) Q:'J  W ?12,"subDD: ",J D  Q:$$CHK(4,1)
"RTN","XPDDP",48,0)
 ...I '$O(@XPDGR@(4,"APDD",XPDI,J,0)) W ! Q
"RTN","XPDDP",49,0)
 ...S I=0 F  S I=$O(@XPDGR@(4,"APDD",XPDI,J,I)) Q:'I  W ?30,"fld: ",I,!
"RTN","XPDDP",50,0)
 .I $D(@XPDGR@(4,XPDI,223)) W ?2,"DD SCREEN  : ",^(223),!
"RTN","XPDDP",51,0)
 .I $D(@XPDGR@(4,XPDI,224)) W ?2,"DATA SCREEN: ",^(224),!
"RTN","XPDDP",52,0)
COMP Q:$D(DIRUT)  W ! Q:$$CHK(3)  S I=0,XPD=$P(^DD(9.68,.03,0),U,3)
"RTN","XPDDP",53,0)
 ;print build components
"RTN","XPDDP",54,0)
 F  S I=$O(@XPDGR@("KRN",I)),K=0,J="" Q:$D(DIRUT)!'I  F  S J=$O(@XPDGR@("KRN",I,"NM","B",J)) Q:J=""  S X=$O(^(J,0)) Q:$$CHK(4)  D:X
"RTN","XPDDP",55,0)
 .S X=$G(@XPDGR@("KRN",I,"NM",X,0)) Q:X=""
"RTN","XPDDP",56,0)
 .;K is flag to write type of component
"RTN","XPDDP",57,0)
 .I 'K W !,$S($D(^DIC(I,0)):$P(^(0),U),XPDFL:$G(^XTMP("XPDI",XPDA,"FIA",I),"UNKNOWN"),1:"UNKNOWN")_":",! S K=1
"RTN","XPDDP",58,0)
 .;write the entry name and write the action
"RTN","XPDDP",59,0)
 .W ?3,$P(X,U),?50,$P($P(XPD,";",$P(X,U,3)+1),":",2),!
"RTN","XPDDP",60,0)
 Q:XPDFL=2
"RTN","XPDDP",61,0)
 ;XPDFL=2 this is a Packman message, called from XMP2 - Summarize
"RTN","XPDDP",62,0)
 ;XPDFL=1 this is a Install, the call backs are already Build Components
"RTN","XPDDP",63,0)
 Q:$D(DIRUT)  Q:$$CHK(3)
"RTN","XPDDP",64,0)
 I $O(@XPDGR@("QUES",0)) W !,"INSTALL QUESTIONS: " S I=0 D
"RTN","XPDDP",65,0)
 .F  S I=$O(@XPDGR@("QUES",I)) Q:'I  S X=$P(^(I,0),U),J=$G(^(1)),K=$G(^("A")) Q:$$CHK(5)  D
"RTN","XPDDP",66,0)
 ..W !?5,"SUBSCIRPT: ",X,!,"DIR(0)=",J W:K]"" !,"DIR(""A"")=",K,!
"RTN","XPDDP",67,0)
 ..F J=1:1 Q:'$D(@XPDGR@("QUES",I,"A1",J,0))  W "DIR(""A"",",J,")=",^(0),!
"RTN","XPDDP",68,0)
 ..I $G(@XPDGR@("QUES",I,"B"))]"" W "DIR(""B"")=",^("B"),!
"RTN","XPDDP",69,0)
 ..I $G(@XPDGR@("QUES",I,"Q"))]"" W "DIR(""?"")=",^("Q"),!
"RTN","XPDDP",70,0)
 ..F J=1:1 Q:'$D(@XPDGR@("QUES",I,"Q1",J,0))  W "DIR(""?"",",J,")=",^(0),!
"RTN","XPDDP",71,0)
 ..I $G(@XPDGR@("QUES",I,"QQ"))]"" W "DIR(""??"")=",^("QQ"),!
"RTN","XPDDP",72,0)
 ..I $G(@XPDGR@("QUES",I,"M"))]"" W "M CODE: ",^("M"),!
"RTN","XPDDP",73,0)
 Q:$D(DIRUT)  Q:$$CHK(3)
"RTN","XPDDP",74,0)
 I $L($G(@XPDGR@("ABPKG"))) S XPD=^("ABPKG") D:$P(XPD,U)="y"
"RTN","XPDDP",75,0)
 .W !,"ALPHA/BETA TESTING:",$$EXTERNAL^DILFD(9.6,20,"",$P(XPD,U)),?40,"INSTALLATION MESSAGE: ",$$EXTERNAL^DILFD(9.6,21,"",$P(XPD,U,2))
"RTN","XPDDP",76,0)
 .W !,"ADDRESS: ",$P(XPD,U,3),!!,"INCLUDE NAMESPACE",?30,"EXCLUDE NAMESPACE" S I=0
"RTN","XPDDP",77,0)
 .F  S I=$O(@XPDGR@("ABNS",I)),J=0 Q:'I  W !?5,^(I,0) F  S J=$O(@XPDGR@("ABNS",I,1,J)) Q:'J  W ?35,^(J,0),! Q:$$CHK(3)
"RTN","XPDDP",78,0)
REQB Q:$D(DIRUT)  Q:$$CHK(4)
"RTN","XPDDP",79,0)
 I $O(@XPDGR@("REQB",0)) W !,"REQUIRED BUILDS:",?50,"ACTION:" D
"RTN","XPDDP",80,0)
 .S XPDI=0 F  S XPDI=$O(@XPDGR@("REQB",XPDI)) Q:'XPDI  S XPD=$G(^(XPDI,0)) Q:$$CHK(4,1)  D
"RTN","XPDDP",81,0)
 ..W !?3,$P(XPD,U),?50,$$EXTERNAL^DILFD(9.611,1,"",$P(XPD,U,2))
"RTN","XPDDP",82,0)
 Q
"RTN","XPDDP",83,0)
GLOBAL ;globals listing
"RTN","XPDDP",84,0)
 S I=$$CHK(8,1) Q:I  I '$P(I,"^",2) W !!,"GLOBAL:",?20,"KILL GLOBAL BEFORE INSTALL:"
"RTN","XPDDP",85,0)
 S XPDI=0 F  S XPDI=$O(@XPDGR@("GLO",XPDI)) Q:'XPDI  S XPD=$G(^(XPDI,0)) Q:$$CHK(4,1)  D
"RTN","XPDDP",86,0)
 .W !?3,$P(XPD,U),?33,$$EXTERNAL^DILFD(9.65,1,"",$P(XPD,U,2))
"RTN","XPDDP",87,0)
 W ! Q
"RTN","XPDDP",88,0)
 ;
"RTN","XPDDP",89,0)
MULT ;multiple-package
"RTN","XPDDP",90,0)
 S I=$$CHK(10,0) Q:I  I '$P(I,"^",2) W !,"SEQUENCE OF BUILDS:"
"RTN","XPDDP",91,0)
 S XPDI=0 F  S XPDI=$O(@XPDGR@(10,XPDI)) Q:'XPDI  S XPD=$G(^(XPDI,0)) Q:$$CHK(4,0)  D
"RTN","XPDDP",92,0)
 .W !?2,XPDI,?8,$E($P(XPD,U),1,44),?54,$S($P(XPD,U,2)=1:"",1:"Not ")_"Required to Continue"
"RTN","XPDDP",93,0)
 W ! Q
"RTN","XPDDP",94,0)
 ;
"RTN","XPDDP",95,0)
 ;return 0 if header was not written, else "0^1"
"RTN","XPDDP",96,0)
CHK(Y,XPD) ;Y=excess lines XPD=1 print file header, return 1 to exit
"RTN","XPDDP",97,0)
 Q:$Y<(IOSL-Y) 0
"RTN","XPDDP",98,0)
 I $E(IOST,1,2)="C-" D  Q:'Y 1
"RTN","XPDDP",99,0)
 .N DIR,I,J,K,X
"RTN","XPDDP",100,0)
 .S DIR(0)="E" D ^DIR
"RTN","XPDDP",101,0)
 S XPD=$G(XPD),XPDPG=XPDPG+1
"RTN","XPDDP",102,0)
 W @IOF D HDR,HDR1:XPD
"RTN","XPDDP",103,0)
 W XPDUL,!
"RTN","XPDDP",104,0)
 Q "0^1"
"RTN","XPDDP",105,0)
 ;
"RTN","XPDDP",106,0)
XMP2(X,D0) ;called from ^XMP2
"RTN","XPDDP",107,0)
 N XPDA S XPDA=-1
"RTN","XPDDP",108,0)
 D PNT(X) Q
"RTN","XPDDP",109,0)
 ;
"RTN","XPDDP",110,0)
HDR W !,"PACKAGE: ",$P(XPD0,U),"     ",XPDDT,?70,"PAGE ",XPDPG,!
"RTN","XPDDP",111,0)
 Q
"RTN","XPDDP",112,0)
HDR1 W ?41,"UP",?47,"SEND",?53,"DATA",?73,"USER",!,?41,"DATE",?47,"SEC.",?53,"COMES",?60,"SITE",?67,"RSLV",?73,"OVER"
"RTN","XPDDP",113,0)
 W !,"FILE #",?12,"NAME",?41,"DD",?47,"CODE",?53,"W/FILE",?60,"DATA",?67,"PTS",?73,"RIDE",!
"RTN","XPDDP",114,0)
 Q
"RTN","XPDIL1")
0^7^B32640563
"RTN","XPDIL1",1,0)
XPDIL1 ;SFISC/RSD - cont. of load Distribution Global ;12/01/98  12:46
"RTN","XPDIL1",2,0)
 ;;8.0;KERNEL;**15,17,39,41,44,66,68,76,85,100**;Jul 10, 1995
"RTN","XPDIL1",3,0)
 ;
"RTN","XPDIL1",4,0)
PKG(XPDA) ;check Package file
"RTN","XPDIL1",5,0)
 N XPD,XPDCP,XPDNM,XPDNOQUE,XPDPKG,X,Y,%
"RTN","XPDIL1",6,0)
 S XPDNM=$P(XPDT(XPDIT),U,2) W !?3,XPDNM
"RTN","XPDIL1",7,0)
 ;check KIDS version against sites version, skip if package is Kernel
"RTN","XPDIL1",8,0)
 I $$PKG^XPDUTL(XPDNM)'["KERNEL" D  I $D(XPDQUIT) D ABORT^XPDI(XPDA,1) Q
"RTN","XPDIL1",9,0)
 .;this is part of a Kernel multi package
"RTN","XPDIL1",10,0)
 .Q:$O(XPDT("NM","KERNEL"))["KERNEL"
"RTN","XPDIL1",11,0)
 .S Y=$G(^XTMP("XPDI",XPDA,"VER"))
"RTN","XPDIL1",12,0)
 .I $$VERSION^XPDUTL("XU")<Y W !!,"But I need Version ",+Y," of KERNEL!"  S XPDQUIT=1
"RTN","XPDIL1",13,0)
 .I $$VERSION^XPDUTL("VA FILEMAN")<$P(Y,U,2) W !,"But I Need Version ",+$P(Y,U,2)," of VA FILEMAN!" S XPDQUIT=1
"RTN","XPDIL1",14,0)
 ;get national package name
"RTN","XPDIL1",15,0)
 S %=$O(^XTMP("XPDI",XPDA,"PKG",0)),XPDPKG(0)=$G(^(+%,0)),XPDPKG=%
"RTN","XPDIL1",16,0)
 ;XPDPKG=new ien^old ien
"RTN","XPDIL1",17,0)
 I XPDPKG D  S XPDPKG=+Y_U_XPDPKG
"RTN","XPDIL1",18,0)
 .N D,DIC
"RTN","XPDIL1",19,0)
 .S DIC="^DIC(9.4,",DIC(0)="X",X=$P(XPDPKG(0),U)
"RTN","XPDIL1",20,0)
 .D ^DIC Q:Y>0
"RTN","XPDIL1",21,0)
 .;if lookup fails try Prefix, C x-ref
"RTN","XPDIL1",22,0)
 .S X=$P(XPDPKG(0),U,2),D="C" D IX^DIC
"RTN","XPDIL1",23,0)
 ;add package to Install file
"RTN","XPDIL1",24,0)
 I XPDPKG>0 S XPD(9.7,XPDA_",",1)=+XPDPKG D FILE^DIE("","XPD")
"RTN","XPDIL1",25,0)
 ;XPDSKPE= does site want to run Environ. Check
"RTN","XPDIL1",26,0)
 I '$G(XPDSKPE) Q:$$ENV(0)=1
"RTN","XPDIL1",27,0)
 ;global package can't have pre or post inits
"RTN","XPDIL1",28,0)
 Q:$D(XPDGP)
"RTN","XPDIL1",29,0)
 ;create pre-init checkpoint
"RTN","XPDIL1",30,0)
 S XPDCP="INI" I '$$NEWCP^XPDUTL("XPD PREINSTALL COMPLETED") D ABORT^XPDI(XPDA,1) Q
"RTN","XPDIL1",31,0)
 S %=$$INRTN("INI")
"RTN","XPDIL1",32,0)
 ;check for routine, use as call back
"RTN","XPDIL1",33,0)
 I $L(%),'$$NEWCP^XPDUTL("XPD PREINSTALL STARTED",%) D ABORT^XPDI(XPDA,1) Q
"RTN","XPDIL1",34,0)
 ;create post-init checkpoint
"RTN","XPDIL1",35,0)
 S XPDCP="INIT" I '$$NEWCP^XPDUTL("XPD POSTINSTALL COMPLETED") D ABORT^XPDI(XPDA,1) Q
"RTN","XPDIL1",36,0)
 S %=$$INRTN("INIT")
"RTN","XPDIL1",37,0)
 I $L(%),'$$NEWCP^XPDUTL("XPD POSTINSTALL STARTED",%) D ABORT^XPDI(XPDA,1) Q
"RTN","XPDIL1",38,0)
 ;create fileman and components check points and file rest of data
"RTN","XPDIL1",39,0)
 D XPCK^XPDIK("FIA"),XPCK^XPDIK("KRN")
"RTN","XPDIL1",40,0)
 Q
"RTN","XPDIL1",41,0)
INST(XPDNM) ;add to Install file
"RTN","XPDIL1",42,0)
 N DIC,DIR,DIRUT,DLAYGO,X,XPD,XPDA,XPDIE,XPDDIQ,Y
"RTN","XPDIL1",43,0)
 ;check if Build was already installed
"RTN","XPDIL1",44,0)
 ;XPD=0 abort install, else XPD=ien in Install file
"RTN","XPDIL1",45,0)
 I $D(^XPD(9.7,"B",XPDNM)) S Y=0 D  Q:$D(XPD) XPD
"RTN","XPDIL1",46,0)
 .W !,"The following Entries already exist in the INSTALL file: ",!
"RTN","XPDIL1",47,0)
 .F  S Y=$O(^XPD(9.7,"B",XPDNM,Y)) Q:'Y  D
"RTN","XPDIL1",48,0)
 ..Q:'$D(^XPD(9.7,Y,0))  S %=^(0)
"RTN","XPDIL1",49,0)
 ..W !,$P(%,U),"   "
"RTN","XPDIL1",50,0)
 ..I $P(%,U,9)<3,$D(^XTMP("XPDI",Y)) W "**Transport Global already exists**",*7 S XPD=0 Q
"RTN","XPDIL1",51,0)
 ..W $$EXTERNAL^DILFD(9.7,.02,"",$P(%,U,9)),!,"was loaded on ",$$FMTE^XLFDT($P($G(^XPD(9.7,Y,1)),U))
"RTN","XPDIL1",52,0)
 .;quit if transport global exist
"RTN","XPDIL1",53,0)
 .Q:$D(XPD)
"RTN","XPDIL1",54,0)
 .S DIR(0)="Y",DIR("A")="OK to continue",DIR("B")="NO"
"RTN","XPDIL1",55,0)
 .D ^DIR I $D(DIRUT)!'Y S XPD=0 Q
"RTN","XPDIL1",56,0)
 S DIC="^XPD(9.7,",DIC(0)="XL",DLAYGO=9.7,X=""""_XPDNM_""""
"RTN","XPDIL1",57,0)
 ;add to Install file, must be new
"RTN","XPDIL1",58,0)
 D ^DIC
"RTN","XPDIL1",59,0)
 I Y<0 W !,"Can't add Build ",XPDNM," to Install File" Q 0
"RTN","XPDIL1",60,0)
 ;set starting package to Y, if it is not already defined
"RTN","XPDIL1",61,0)
 S:'XPDST XPDST=+Y
"RTN","XPDIL1",62,0)
 ;XPDT array keeps track of all packages in this distribution
"RTN","XPDIL1",63,0)
 S XPDA=+Y,XPDT(XPDIT)=XPDA_U_XPDNM,(XPDT("DA",XPDA),XPDT("NM",XPDNM))=XPDIT
"RTN","XPDIL1",64,0)
 S %="XPDIE(9.7,"""_XPDA_","")",@%@(.02)=0,@%@(2)=$$NOW^XLFDT,@%@(3)=XPDST,@%@(4)=XPDIT,@%@(5)="",@%@(6)=XPDST("H1")
"RTN","XPDIL1",65,0)
 D FILE^DIE("","XPDIE")
"RTN","XPDIL1",66,0)
 Q XPDA
"RTN","XPDIL1",67,0)
 ;
"RTN","XPDIL1",68,0)
 ;XPDQUIT quit current package install, 1=kill global, 2=leave global
"RTN","XPDIL1",69,0)
 ;XPDQUIT(package) quit package install, 1=kill, 2=leave
"RTN","XPDIL1",70,0)
 ;XPDABORT quit the entire distribution, 1=kill, 2=leave
"RTN","XPDIL1",71,0)
 ;XPDENV 0=loading distribution, 1=installing
"RTN","XPDIL1",72,0)
ENV(XPDENV) ;enviroment check & version check
"RTN","XPDIL1",73,0)
 ;returns 0=ok, 1=rejected kill global, 2=rejected leave global
"RTN","XPDIL1",74,0)
 N %,DIR,XPDI,XPDQUIT,XPDABORT,XPDDONE,XPDGREF,XPDMBREQ
"RTN","XPDIL1",75,0)
 S XPDGREF="^XTMP(""XPDI"","_XPDA_",""TEMP"")"
"RTN","XPDIL1",76,0)
 S XPDMBREQ=$G(^XTMP("XPDI",XPDA,"MBREQ"))
"RTN","XPDIL1",77,0)
 S $P(^XPD(9.7,XPDA,0),U,7)=XPDMBREQ
"RTN","XPDIL1",78,0)
 ;check version number
"RTN","XPDIL1",79,0)
 I XPDPKG>0 D  I $G(XPDQUIT) D ABORT^XPDI(XPDA,1) Q 1
"RTN","XPDIL1",80,0)
 .N DIR,DIRUT,X,Y
"RTN","XPDIL1",81,0)
 .S %=+$$VER^XPDUTL(XPDNM),Y=+$G(^DIC(9.4,+XPDPKG,"VERSION")),X=XPDNM["*"
"RTN","XPDIL1",82,0)
 .;if patch, version must be the same
"RTN","XPDIL1",83,0)
 .I X,%'=Y W !,"This Patch is for Version ",%,", you are running Version ",Y,! S XPDQUIT=1
"RTN","XPDIL1",84,0)
 .;if package, version must be greater or equal
"RTN","XPDIL1",85,0)
 .I 'X,%<Y W !,"You have a Version greater than mine!",! S XPDQUIT=1
"RTN","XPDIL1",86,0)
 .Q:'$G(XPDQUIT)
"RTN","XPDIL1",87,0)
 .I $G(XPDMBREQ) D ABRTALL^XPDI(1),NONE^XPDI S XPDQUIT=0,XPDDONE=1 Q
"RTN","XPDIL1",88,0)
 .S DIR(0)="Y",DIR("A")="Want to continue installing this build",DIR("B")="NO"
"RTN","XPDIL1",89,0)
 .D ^DIR I Y K XPDQUIT
"RTN","XPDIL1",90,0)
 .Q
"RTN","XPDIL1",91,0)
 Q:$G(XPDDONE) 1
"RTN","XPDIL1",92,0)
 S %=$$REQB I % S (XPDABORT,XPDREQAB)=% G ABORT
"RTN","XPDIL1",93,0)
 S %=$G(^XTMP("XPDI",XPDA,"PRE")) D:%]""
"RTN","XPDIL1",94,0)
 .W !,"Will first run the Environment Check Routine, ",%,!
"RTN","XPDIL1",95,0)
 .D SAVE^XPDIJ(%),@("^"_%)
"RTN","XPDIL1",96,0)
ABORT I $G(XPDABORT) D  Q XPDABORT
"RTN","XPDIL1",97,0)
 .;if during load & leave global quit
"RTN","XPDIL1",98,0)
 .I 'XPDENV,XPDABORT=2 Q
"RTN","XPDIL1",99,0)
 .D ABRTALL^XPDI(XPDABORT)
"RTN","XPDIL1",100,0)
 Q:'$D(XPDQUIT) 0
"RTN","XPDIL1",101,0)
 I $G(XPDQUIT) D ABORT^XPDI(XPDA,XPDQUIT)
"RTN","XPDIL1",102,0)
 S XPDI=""
"RTN","XPDIL1",103,0)
 ;don't do if loading & leave global, need to keep XPDT(array)
"RTN","XPDIL1",104,0)
 F  S XPDI=$O(XPDQUIT(XPDI)) Q:XPDI=""  D:'(XPDQUIT(XPDI)=2&'XPDENV)
"RTN","XPDIL1",105,0)
 .S %=$G(XPDT("NM",XPDI)) D:% ABORT^XPDI(+XPDT(%),XPDQUIT(XPDI))
"RTN","XPDIL1",106,0)
 S XPDQUIT=$S($G(XPDQUIT):XPDQUIT,'$O(XPDT(0))!'$D(^XTMP("XPDI",XPDA)):1,1:0)
"RTN","XPDIL1",107,0)
 Q XPDQUIT
"RTN","XPDIL1",108,0)
 ;
"RTN","XPDIL1",109,0)
REQB() ;check for Required Builds
"RTN","XPDIL1",110,0)
 ;returns 0=ok, 1=failed kill global, 2=failed leave global
"RTN","XPDIL1",111,0)
 N XPDACT,XPDBLD,XPDI,XPDQ,XPDQUIT,XPDX,XPDX0,X,Y
"RTN","XPDIL1",112,0)
 S XPDBLD=$O(^XTMP("XPDI",XPDA,"BLD",0)),XPDQUIT=0,XPDI=0
"RTN","XPDIL1",113,0)
 Q:'$D(^XTMP("XPDI",XPDA,"BLD",XPDBLD,"REQB")) 0
"RTN","XPDIL1",114,0)
 F  S XPDI=$O(^XTMP("XPDI",XPDA,"BLD",XPDBLD,"REQB",XPDI)) Q:'XPDI  S XPDX0=^(XPDI,0) D
"RTN","XPDIL1",115,0)
 .S XPDQ=0,XPDX=$P(XPDX0,U),XPDACT=$P(XPDX0,U,2),X=$$PKG^XPDUTL(XPDX),Y=$$VER^XPDUTL(XPDX),Z=$$VERSION^XPDUTL(X)
"RTN","XPDIL1",116,0)
 .;quit if current version is greater than what we are checking for
"RTN","XPDIL1",117,0)
 .Q:Z>Y
"RTN","XPDIL1",118,0)
 .I XPDX'["*" S:Z<Y XPDQ=2
"RTN","XPDIL1",119,0)
 .E  S:'$$PATCH^XPDUTL(XPDX) XPDQ=1
"RTN","XPDIL1",120,0)
 .;quit if patch is already on system
"RTN","XPDIL1",121,0)
 .Q:'XPDQ
"RTN","XPDIL1",122,0)
 .;quit if patch is sequenced prior within this build 
"RTN","XPDIL1",123,0)
 .I $D(XPDT("NM",XPDX)),(XPDT("NM",XPDX)<XPDT("NM",XPDNM)) S XPDQ=0 Q
"RTN","XPDIL1",124,0)
 .S XPDQUIT=$S(XPDACT>XPDQUIT:XPDACT,1:XPDQUIT)
"RTN","XPDIL1",125,0)
 .;XPDACT=0 warning, =1 abort & kill global, =2 abort
"RTN","XPDIL1",126,0)
 .W !!,$S(XPDACT:"**INSTALL ABORTED**",1:"**WARNING**")_$S(XPDQ=1:" Patch ",1:" Package ")_XPDX_" is Required "_$S(XPDACT:"to install",1:"for")_" this package!!",!
"RTN","XPDIL1",127,0)
 Q:'XPDQUIT 0
"RTN","XPDIL1",128,0)
 ;don't do if leave global and loading
"RTN","XPDIL1",129,0)
 D:'(XPDQUIT=2&'XPDENV) ABORT^XPDI(XPDA,XPDQUIT)
"RTN","XPDIL1",130,0)
 Q XPDQUIT
"RTN","XPDIL1",131,0)
 ;
"RTN","XPDIL1",132,0)
 ;return a routine that can be run
"RTN","XPDIL1",133,0)
INRTN(X) N Y
"RTN","XPDIL1",134,0)
 S Y=$G(^XTMP("XPDI",XPDA,X)) Q:Y="" ""
"RTN","XPDIL1",135,0)
 S Y=$S(Y["^":Y,1:"^"_Y)
"RTN","XPDIL1",136,0)
 Q Y
"RTN","XPDIP")
0^2^B36444749
"RTN","XPDIP",1,0)
XPDIP ;SFISC/RSD - Install Package & Routine file ;11/25/98  14:03
"RTN","XPDIP",2,0)
 ;;8.0;KERNEL;**15,21,28,30,41,44,51,58,83,92,100**;Jul 10, 1995
"RTN","XPDIP",3,0)
 Q
"RTN","XPDIP",4,0)
PKG ;
"RTN","XPDIP",5,0)
 N %,OLDA,DA,DIK,XPD,XPDFIL,XPDPKG,XPDBLDA,Y
"RTN","XPDIP",6,0)
 ;update variable for graphic display
"RTN","XPDIP",7,0)
 I $D(XPDIDVT) S XPDIDTOT=10,XPDIDMOD=1,XPDIDCNT=0 D:XPDIDVT UPDATE^XPDID(0)
"RTN","XPDIP",8,0)
 ;XPDPKG=ien of Package file, OLDA=old Package ien
"RTN","XPDIP",9,0)
 S Y=$$PKGADD,XPDPKG=$P(Y,U),OLDA=$P(Y,U,2)
"RTN","XPDIP",10,0)
 ;Package file entry not sent, XPDPKG=0
"RTN","XPDIP",11,0)
 G:'XPDPKG PKGEND
"RTN","XPDIP",12,0)
 ;update version multiple
"RTN","XPDIP",13,0)
 S DA=XPDPKG D PKGV
"RTN","XPDIP",14,0)
PKGH I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+2 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",15,0)
 S %=$P(^DIC(9.4,XPDPKG,0),U,4)
"RTN","XPDIP",16,0)
 ;repoint Help Frame (0;4)
"RTN","XPDIP",17,0)
 I $L(%),'% S $P(^DIC(9.4,XPDPKG,0),U,4)=$$LK^XPDIA("^DIC(9.2)",%),DIK="^DIC(9.4," D IX1^DIK
"RTN","XPDIP",18,0)
 ;update node 20 for Patient Merge
"RTN","XPDIP",19,0)
 N REC,IEN
"RTN","XPDIP",20,0)
 S REC=0
"RTN","XPDIP",21,0)
 F  S REC=$O(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC)) Q:'REC  D
"RTN","XPDIP",22,0)
 .S IEN(9.402,"?+1,"_XPDPKG_",",.01)=$P($G(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC,0)),U,1)
"RTN","XPDIP",23,0)
 .S IEN(9.402,"?+1,"_XPDPKG_",",3)=$P($G(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC,0)),U,3)
"RTN","XPDIP",24,0)
 .S IEN(9.402,"?+1,"_XPDPKG_",",4)=$G(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC,1))
"RTN","XPDIP",25,0)
 .D UPDATE^DIE("","IEN")
"RTN","XPDIP",26,0)
 .Q
"RTN","XPDIP",27,0)
 ;
"RTN","XPDIP",28,0)
PKGEND S XPDBLDA=$$BLD(XPDBLD) Q:'XPDBLDA
"RTN","XPDIP",29,0)
 ;move Alpha/Beta testing info to Kernel site para file
"RTN","XPDIP",30,0)
 I XPDPKG S %=$G(^XPD(9.6,XPDBLDA,"ABPKG")) D
"RTN","XPDIP",31,0)
 .;Install message and they have an address, set flag in XPDIST
"RTN","XPDIP",32,0)
 .I $P(%,U)="y",$P(%,U,2)="y",$L($P(%,U,3)) S $P(XPDIST,U,2)=$P(%,U,3)
"RTN","XPDIP",33,0)
 .D EN^XQABLOAD(XPDBLDA)
"RTN","XPDIP",34,0)
 Q
"RTN","XPDIP",35,0)
PKGADD() ;check Package file, add if not there
"RTN","XPDIP",36,0)
 ;return new Package file ien^old ien
"RTN","XPDIP",37,0)
 N DA,DIK,XPD,XPDFIL,XPDO,X,Y
"RTN","XPDIP",38,0)
 S DA=+$P(^XPD(9.7,XPDA,0),U,2),XPDO=+$O(^XTMP("XPDI",XPDA,"PKG",0)),X=$P($G(^(XPDO,0)),U)
"RTN","XPDIP",39,0)
 I DA,$D(^DIC(9.4,DA,0)) Q DA_U_XPDO
"RTN","XPDIP",40,0)
 ;quit if there was no package entry sent
"RTN","XPDIP",41,0)
 Q:'XPDO "0^0"
"RTN","XPDIP",42,0)
 S XPDFIL=9.4,Y=$$DIC^XPDIK(9.4,X) Q:'Y "0^0"
"RTN","XPDIP",43,0)
 S DA=+Y
"RTN","XPDIP",44,0)
 ;if new entry in package file, bring in everything
"RTN","XPDIP",45,0)
 I $P(Y,U,3) D
"RTN","XPDIP",46,0)
 .M ^DIC(9.4,DA)=^XTMP("XPDI",XPDA,"PKG",XPDO)
"RTN","XPDIP",47,0)
 .;kill the -1 flag node first
"RTN","XPDIP",48,0)
 .K ^DIC(9.4,DA,-1)
"RTN","XPDIP",49,0)
 .;re-cross ref after adding a new package
"RTN","XPDIP",50,0)
 .S DIK="^DIC(9.4," D IX1^DIK
"RTN","XPDIP",51,0)
 ;add package to file 9.7
"RTN","XPDIP",52,0)
 S XPD(9.7,XPDA_",",1)=DA D FILE^DIE("","XPD")
"RTN","XPDIP",53,0)
 Q DA_U_XPDO
"RTN","XPDIP",54,0)
 ;
"RTN","XPDIP",55,0)
BLD(XPDBLD) ;add Build entry, XPDBLD=Build ien in ^XTMP("XPDI",XPDA,"BLD",
"RTN","XPDIP",56,0)
 N %,DA,DIK,XPDFIL,Y
"RTN","XPDIP",57,0)
 I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+4 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",58,0)
 ;XPDBLD=Build ien in ^XTMP, set in XPDIJ
"RTN","XPDIP",59,0)
 S XPDFIL=9.6,Y=$$DIC^XPDIK(9.6,XPDNM) Q:'Y ""
"RTN","XPDIP",60,0)
 S DA=+Y
"RTN","XPDIP",61,0)
 ;Build entry not new, remove old data
"RTN","XPDIP",62,0)
 I '$P(Y,U,3) S %=$P(^XPD(9.6,DA,0),U,2) K ^XPD(9.6,DA) K:% ^XPD(9.6,"C",%,DA)
"RTN","XPDIP",63,0)
 M ^XPD(9.6,DA)=^XTMP("XPDI",XPDA,"BLD",XPDBLD)
"RTN","XPDIP",64,0)
 ;reset Package File Link (0;2)
"RTN","XPDIP",65,0)
 ;XPDIST = national site tracking^A/B install message address
"RTN","XPDIP",66,0)
 S $P(^XPD(9.6,DA,0),U,2)=$S(XPDPKG:XPDPKG,1:"") S:$P(^(0),U,5)="y" XPDIST=1
"RTN","XPDIP",67,0)
 ;re-index cross-ref. on fields .01 and 1
"RTN","XPDIP",68,0)
 S DIK="^XPD(9.6," F Y=.01,1 S DIK(1)=Y D EN1^DIK
"RTN","XPDIP",69,0)
 I $D(XPDIDVT) D UPDATE^XPDID(XPDIDTOT)
"RTN","XPDIP",70,0)
 Q DA
"RTN","XPDIP",71,0)
 ;
"RTN","XPDIP",72,0)
 ;update the version multiple in the package file
"RTN","XPDIP",73,0)
PKGV N %
"RTN","XPDIP",74,0)
 I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+2 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",75,0)
 ;%=ien in the Version multiple_U_ien in Patch multiple in ^XTMP
"RTN","XPDIP",76,0)
 S %=$G(^XTMP("XPDI",XPDA,"PKG",OLDA,-1))
"RTN","XPDIP",77,0)
 I XPDNM'["*" D  Q
"RTN","XPDIP",78,0)
 .S %=+% Q:'$D(^XTMP("XPDI",XPDA,"PKG",OLDA,22,%,0))  S %=^(0) S:$D(^(1)) %(1)=$NA(^(1))
"RTN","XPDIP",79,0)
 .S $P(%,U,3,4)=DT_U_DUZ,%=$$PKGVER(DA,.%)
"RTN","XPDIP",80,0)
 ;update patch history multiple
"RTN","XPDIP",81,0)
 Q:'$D(^XTMP("XPDI",XPDA,"PKG",OLDA,22,+%,"PAH",+$P(%,U,2),0))  S %=$P(^(0),U) S:$D(^(1)) %(1)=$NA(^(1))
"RTN","XPDIP",82,0)
 ;check File Comment, %=patch number
"RTN","XPDIP",83,0)
 S:^XPD(9.7,XPDA,2)[" SEQ #" %=%_$P(^(2),%,2,99)
"RTN","XPDIP",84,0)
 S $P(%,U,2,3)=DT_U_DUZ,%=$$PKGPAT(DA,$$VER^XPDUTL(XPDNM),.%)
"RTN","XPDIP",85,0)
 Q
"RTN","XPDIP",86,0)
 ;
"RTN","XPDIP",87,0)
PKGVER(XPDPDA,XPDI) ;update version in package file, XPDPDA=Package file ien, return ien
"RTN","XPDIP",88,0)
 ;XPDI=version^date distr.^date installed^install by
"RTN","XPDIP",89,0)
 ;XPDI(1)=root of description field
"RTN","XPDIP",90,0)
 N I,X,XPD,XPDIEN,XPDJ,XPDV
"RTN","XPDIP",91,0)
 S XPDIEN=","_XPDPDA_",",XPDV=$$MDIC(9.49,XPDIEN,$P(XPDI,U)) Q:'XPDV 0
"RTN","XPDIP",92,0)
 S XPD(9.4,XPDPDA_",",13)=$P(XPDI,U),X="XPD(9.49,"""_XPDV_XPDIEN_""")"
"RTN","XPDIP",93,0)
 F I=1:1:3 S:$P(XPDI,U,I+1)]"" @X@(I)=$P(XPDI,U,I+1)
"RTN","XPDIP",94,0)
 S:$D(XPDI(1)) @X@(41)=XPDI(1)
"RTN","XPDIP",95,0)
 D FILE^DIE("","XPD")
"RTN","XPDIP",96,0)
 Q XPDV
"RTN","XPDIP",97,0)
 ;
"RTN","XPDIP",98,0)
PKGPAT(XPDPDA,XPDV,XPDI) ;update patch history
"RTN","XPDIP",99,0)
 ;INPUT: XPDPDA=Package file ien, XPDV=version
"RTN","XPDIP",100,0)
 ;XPDI=patch^date installed^install by,   returns version ien^patch ien
"RTN","XPDIP",101,0)
 N I,X,XPD,XPDP,XPDIEN
"RTN","XPDIP",102,0)
 ;quit if we can't find the version multiple, resets XPDV=ien of version
"RTN","XPDIP",103,0)
 S XPDIEN=","_XPDPDA_",",XPDV=$$MDIC(9.49,XPDIEN,XPDV) Q:'XPDV 0
"RTN","XPDIP",104,0)
 S XPDIEN=","_XPDV_XPDIEN,XPDP=$$MDIC(9.4901,XPDIEN,$P(XPDI,U)) Q:'XPDP 0
"RTN","XPDIP",105,0)
 S X="XPD(9.4901,"""_XPDP_XPDIEN_""")"
"RTN","XPDIP",106,0)
 F I=.02,.03 S:$P(XPDI,U,I*100)]"" @X@(I)=$P(XPDI,U,I*100)
"RTN","XPDIP",107,0)
 S:$D(XPDI(1)) @X@(1)=XPDI(1)
"RTN","XPDIP",108,0)
 D FILE^DIE("","XPD")
"RTN","XPDIP",109,0)
 Q XPDV_U_XPDP
"RTN","XPDIP",110,0)
 ;
"RTN","XPDIP",111,0)
 ;XPDF=subfile #,XPDIEN=ien string, X=input
"RTN","XPDIP",112,0)
MDIC(XPDF,XPDIEN,XPDX) ;
"RTN","XPDIP",113,0)
 N DIERR,XPD,XPDN
"RTN","XPDIP",114,0)
 D FIND^DIC(XPDF,XPDIEN,"","XQf",XPDX,5,"","","","XPD")
"RTN","XPDIP",115,0)
 ;one or more matches, just return first one
"RTN","XPDIP",116,0)
 I $G(XPD(0)) D:XPD(0)>1  Q XPD(1)
"RTN","XPDIP",117,0)
 .N %
"RTN","XPDIP",118,0)
 .S %(1)=$P(^DD(XPDF,.01,0),U)_"  "_XPDX_"  is Duplicated,",%(2)=" only ien #"_XPD(1)_" was updated."
"RTN","XPDIP",119,0)
 .D MES^XPDUTL(.%)
"RTN","XPDIP",120,0)
 ;add a new entry
"RTN","XPDIP",121,0)
 S XPDN(XPDF,"+1"_XPDIEN,.01)=XPDX K XPD
"RTN","XPDIP",122,0)
 D UPDATE^DIE("","XPDN","XPD")
"RTN","XPDIP",123,0)
 I '$G(XPD(1)) D BMES^XPDUTL(" "_$P(^DD(XPDF,.01,0),U)_" "_XPDX_" **Couldn't Add to file**") Q 0
"RTN","XPDIP",124,0)
 Q XPD(1)
"RTN","XPDIP",125,0)
 ;
"RTN","XPDIP",126,0)
RTN ;move rtns to install file
"RTN","XPDIP",127,0)
 N XPD,XPDC,XPDCR,XPDI,XPDJ,XPDK,XPDL,XPDM,XPDR,XPDRH,X
"RTN","XPDIP",128,0)
 K ^XPD(9.7,XPDA,"RTN"),^TMP($J)
"RTN","XPDIP",129,0)
 S (XPDC,XPDCR,XPDRH)=0,XPDJ=""
"RTN","XPDIP",130,0)
 ;get all routines that were loaded, XPDM=action
"RTN","XPDIP",131,0)
 ;actions are 0=load, 1=delete, 2=skip
"RTN","XPDIP",132,0)
 F  S XPDJ=$O(^XTMP("XPDI",XPDA,"RTN",XPDJ)) Q:XPDJ=""  S XPDM=^(XPDJ) D:'XPDM
"RTN","XPDIP",133,0)
 .;XPD, build array to update ROUTINE multiple in INSTALL file
"RTN","XPDIP",134,0)
 .S XPDC=XPDC+1,^TMP($J,"XPDL",XPDC)=XPDC,^TMP($J,"XPD",9.704,"+"_XPDC_","_XPDA_",",.01)=XPDJ
"RTN","XPDIP",135,0)
 .;XPDR, build array to update ROUTINE file
"RTN","XPDIP",136,0)
 .S:'$D(^DIC(9.8,"B",XPDJ)) XPDCR=XPDCR+1,^TMP($J,"XPDR",9.8,"?+"_XPDCR_",",.01)=XPDJ,^(1)="R"
"RTN","XPDIP",137,0)
 ;if we are doing VT graphic display, update only 40%
"RTN","XPDIP",138,0)
 I $D(XPDIDVT) S XPDIDCNT=XPDIDTOT*.4 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",139,0)
 F XPDK="DIKZ","DIEZ","DIPZ" D
"RTN","XPDIP",140,0)
 .S XPDI=0
"RTN","XPDIP",141,0)
 .;loop thru list of compile template routines
"RTN","XPDIP",142,0)
 .;XTMP("XPDI",XPDA,"DIKZ",ien,routine name)
"RTN","XPDIP",143,0)
 .F  S XPDI=$O(^XTMP("XPDI",XPDA,XPDK,XPDI)),XPDJ="" Q:'XPDI  D
"RTN","XPDIP",144,0)
 ..I 'XPDRH D BMES^XPDUTL(" The following Routines were created during this install:") S XPDRH=1
"RTN","XPDIP",145,0)
 ..F  S XPDJ=$O(^XTMP("XPDI",XPDA,XPDK,XPDI,XPDJ)) Q:XPDJ=""  D:'$D(^XTMP("XPDI",XPDA,"RTN",XPDJ))
"RTN","XPDIP",146,0)
 ...S XPDC=XPDC+1,^TMP($J,"XPDL",XPDC)=XPDC,^TMP($J,"XPD",9.704,"+"_XPDC_","_XPDA_",",.01)=XPDJ
"RTN","XPDIP",147,0)
 ...D MES^XPDUTL("     "_XPDJ)
"RTN","XPDIP",148,0)
 ;update routine multiple in Install file with routines and
"RTN","XPDIP",149,0)
 ;compile template routines
"RTN","XPDIP",150,0)
 I $D(^TMP($J,"XPD"))>9 D
"RTN","XPDIP",151,0)
 .D UPDATE^DIE("","^TMP($J,""XPD"")","^TMP($J,""XPDL"")")
"RTN","XPDIP",152,0)
 .;if we are doing VT graphic display, update only 40%
"RTN","XPDIP",153,0)
 .I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+(XPDIDTOT*.40) D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",154,0)
 ;update Routine file
"RTN","XPDIP",155,0)
 D:$D(^TMP($J,"XPDR"))>9 UPDATE^DIE("","^TMP($J,""XPDR"")")
"RTN","XPDIP",156,0)
 ;if we are doing VT graphic display, update 100%
"RTN","XPDIP",157,0)
 I $D(XPDIDVT) D UPDATE^XPDID(XPDIDTOT)
"RTN","XPDIP",158,0)
 Q
"RTN","XPDT")
0^4^B57451355
"RTN","XPDT",1,0)
XPDT ;SFISC/RSD - Transport a package; 15 Apr 96 10:15 ;11/25/98  14:03
"RTN","XPDT",2,0)
 ;;8.0;KERNEL;**2,10,28,41,44,51,58,66,68,85,100**;Jul 10, 1995
"RTN","XPDT",3,0)
EN ;build XTMP("XPDT",ien, XPDA=ien,XPDNM=name
"RTN","XPDT",4,0)
 ;XPDT(seq #)=ien^name^1=use current transport global on system
"RTN","XPDT",5,0)
 ;XPDT("DA",ien)=seq #
"RTN","XPDT",6,0)
 ;XPDVER=version number^package name
"RTN","XPDT",7,0)
 ;XPDGP=flag;global^flag;global^...  flag=1 replace global at site
"RTN","XPDT",8,0)
 N DIR,DIRUT,I,POP,XPD,XPDA,XPDERR,XPDGP,XPDGREF,XPDH,XPDH1,XPDHD,XPDI,XPDNM,XPDSEQ,XPDSIZ,XPDSIZA,XPDT,XPDTP,XPDVER,X,Y,Z
"RTN","XPDT",9,0)
 K ^TMP($J,"XPD")
"RTN","XPDT",10,0)
 S XPD="First Package Name: ",DIR(0)="Y",DIR("A")="   Use this Transport Global",DIR("?")="Yes, will use the current Transport Global on your system. No, will create a new one.",XPDT=0
"RTN","XPDT",11,0)
 W !!,"Enter the Package Names to be transported. The order in which",!,"they are entered will be the order in which they are installed.",!!
"RTN","XPDT",12,0)
 F  S XPDA=$$DIC^XPDE("AEMQZ",XPD) Q:'XPDA  D  Q:$D(DIRUT)!$D(XPDERR)
"RTN","XPDT",13,0)
 .S:'XPDT XPD="Another Package Name: "
"RTN","XPDT",14,0)
 .;XPDI=name^1=use current transport global
"RTN","XPDT",15,0)
 .S XPDI=$P(Y(0),U)_"^"
"RTN","XPDT",16,0)
 .I $D(XPDT("DA",XPDA)) W "   ",$P(Y(0),U)," already listed",! Q
"RTN","XPDT",17,0)
 .;if type is Global Package, set DIRUT if there is other packages
"RTN","XPDT",18,0)
 .I $P(Y(0),U,3)=2 W "   GLOBAL PACKAGE" D  Q
"RTN","XPDT",19,0)
 ..;if there is already a package in distribution, abort
"RTN","XPDT",20,0)
 ..I XPDT S DIRUT=1 W !,"A GLOBAL PACKAGE cannot be sent with any other packages" Q
"RTN","XPDT",21,0)
 ..I $D(^XTMP("XPDT",XPDA)) W "  **Cannot have a pre-existing Transport Global**" S DIRUT=1 Q
"RTN","XPDT",22,0)
 ..W !?10,"will transport the following globals:",! S X=0,XPDGP=""
"RTN","XPDT",23,0)
 ..F  S X=$O(^XPD(9.6,XPDA,"GLO",X)) Q:'X  S Z=$G(^(X,0)) I $P(Z,U)]"" S XPDGP=XPDGP_($P(Z,U,2)="y")_";"_$P(Z,U)_"^" W ?12,$P(Z,U),!
"RTN","XPDT",24,0)
 ..;XPDERR is set to quit loop, so no other packages can be added
"RTN","XPDT",25,0)
 ..S XPDERR=1,XPDT=XPDT+1,XPDT(XPDT)=XPDA_U_XPDI,XPDT("DA",XPDA)=XPDT
"RTN","XPDT",26,0)
 .Q:$D(XPDERR)
"RTN","XPDT",27,0)
 .D PCK(XPDA,XPDI)
"RTN","XPDT",28,0)
 .;multi-package
"RTN","XPDT",29,0)
 .Q:$P(Y(0),U,3)'=1
"RTN","XPDT",30,0)
 .W "   (Multi-Package)" S X=0
"RTN","XPDT",31,0)
 .F  S X=$O(^XPD(9.6,XPDA,10,X)) Q:'X  S Z=$P($G(^(X,0)),U),Z1=$P($G(^(0)),U,2) D:Z]""
"RTN","XPDT",32,0)
 ..N XPDA,X
"RTN","XPDT",33,0)
 ..W !?3,Z S XPDA=$O(^XPD(9.6,"B",Z,0))
"RTN","XPDT",34,0)
 ..I 'XPDA W "  **Can't find definition in Build file**" Q
"RTN","XPDT",35,0)
 ..I $D(XPDT("DA",XPDA)) W "  already listed" Q
"RTN","XPDT",36,0)
 ..D PCK(XPDA,Z,Z1)
"RTN","XPDT",37,0)
 .Q
"RTN","XPDT",38,0)
 G:'XPDT!$D(DIRUT) QUIT K XPDERR
"RTN","XPDT",39,0)
 W !!,"ORDER   PACKAGE",!
"RTN","XPDT",40,0)
 F XPDT=1:1:XPDT S Y=$P(XPDT(XPDT),U,2) W ?2,XPDT,?7,Y D  W !
"RTN","XPDT",41,0)
 .W:$P(XPDT(XPDT),U,3) "     **will use current Transport Global**"
"RTN","XPDT",42,0)
 S DIR(0)="Y",DIR("A")="OK to continue",DIR("B")="NO",XPDH=""
"RTN","XPDT",43,0)
 W !! D ^DIR G:$D(DIRUT)!'Y QUIT K DIR
"RTN","XPDT",44,0)
 S DIR(0)="SAO^HF:Host File;PM:PackMan",DIR("A")="Transport through (HF)Host File or (PM)PackMan: ",DIR("?")="Enter the method of transport for the package(s)."
"RTN","XPDT",45,0)
 D ^DIR G:$D(DTOUT)!$D(DUOUT) QUIT K DIR
"RTN","XPDT",46,0)
 I Y="" W !,"No Transport Method selected, will only write Transport Global to ^XTMP." S XPDH=""
"RTN","XPDT",47,0)
 ;XPDTP = transports using Packman
"RTN","XPDT",48,0)
 S:Y="PM" XPDTP=1
"RTN","XPDT",49,0)
 I $D(XPDGP),Y'="HF" W !,"**Global Package can only be sent with a Host File, Transport ABORTED**" Q
"RTN","XPDT",50,0)
 I Y="HF" D DEV G:POP QUIT
"RTN","XPDT",51,0)
 I $G(XPDTP),XPDT>1 W !!,"You cannot send multiple Builds through PackMan." G QUIT
"RTN","XPDT",52,0)
 W !!
"RTN","XPDT",53,0)
 F XPDT=1:1:XPDT S XPDA=XPDT(XPDT),XPDNM=$P(XPDA,U,2) D  G:$D(XPDERR) ABORT
"RTN","XPDT",54,0)
 .W !?5,XPDNM,"..." S XPDGREF="^XTMP(""XPDT"","_+XPDA_",""TEMP"")"
"RTN","XPDT",55,0)
 .;if using current transport global, run pre-transp routine and quit
"RTN","XPDT",56,0)
 .I $P(XPDA,U,3) S XPDA=+XPDA D PRET Q
"RTN","XPDT",57,0)
 .;if package file link then set XPDVER=version number^package name
"RTN","XPDT",58,0)
 .S XPDA=+XPDA,XPDVER=$S($P(^XPD(9.6,XPDA,0),U,2):$$VER^XPDUTL(XPDNM)_U_$$PKG^XPDUTL(XPDNM),1:"")
"RTN","XPDT",59,0)
 .K ^XTMP("XPDT",XPDA)
"RTN","XPDT",60,0)
 .;GLOBAL PACKAGE
"RTN","XPDT",61,0)
 .I $D(XPDGP) D  S XPDT=1 Q
"RTN","XPDT",62,0)
 ..;can't send global package in packman message
"RTN","XPDT",63,0)
 ..I $G(XPDTP) S XPDERR=1 Q
"RTN","XPDT",64,0)
 ..;verify global package
"RTN","XPDT",65,0)
 ..I '$$GLOPKG^XPDV(XPDA) S XPDERR=1 Q
"RTN","XPDT",66,0)
 ..;get Environment check and Post Install routines
"RTN","XPDT",67,0)
 ..F Y="PRE","INIT" I $G(^XPD(9.6,XPDA,Y))]"" S X=^(Y) D
"RTN","XPDT",68,0)
 ...S ^XTMP("XPDT",XPDA,Y)=X,X=$P(X,U,$L(X,U)),%=$$LOAD^XPDTA(X,"0^")
"RTN","XPDT",69,0)
 ..D BLD^XPDTC,PRET
"RTN","XPDT",70,0)
 .F X="DD^XPDTC","KRN^XPDTC","QUES^XPDTC","INT^XPDTC","BLD^XPDTC" D @X Q:$D(XPDERR)
"RTN","XPDT",71,0)
 .D:'$D(XPDERR) PRET
"RTN","XPDT",72,0)
 ;XPDTP - call ^XPDTP to build Packman message
"RTN","XPDT",73,0)
 I $G(XPDTP) S XPDA=+XPDT(XPDT) D ^XPDTP G QUIT
"RTN","XPDT",74,0)
 I $L(XPDH) D GO G QUIT
"RTN","XPDT",75,0)
 ;if no device then just create transport global
"RTN","XPDT",76,0)
 W !! F XPDT=1:1:XPDT W "Transport Global ^XTMP(""XPDT"","_+XPDT(XPDT)_") created for ",$P(XPDT(XPDT),U,2),!
"RTN","XPDT",77,0)
 Q
"RTN","XPDT",78,0)
DEV N FIL,DIR,IOP,X,Y,%ZIS W !
"RTN","XPDT",79,0)
 D HOME^%ZIS
"RTN","XPDT",80,0)
 S DIR(0)="F^3:45",DIR("A")="Enter a Host File",DIR("?")="Enter a filename and/or path to output package(s).",POP=0
"RTN","XPDT",81,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) S POP=1 Q
"RTN","XPDT",82,0)
 ;if no file, then quit
"RTN","XPDT",83,0)
 Q:Y=""  S FIL=Y
"RTN","XPDT",84,0)
 S DIR(0)="F^3:80",DIR("A")="Header Comment",DIR("?")="Enter a comment between 3 and 80 charaters."
"RTN","XPDT",85,0)
 D ^DIR I $D(DIRUT) S POP=1 Q
"RTN","XPDT",86,0)
 S XPDH=Y,%ZIS="",%ZIS("HFSNAME")=FIL,%ZIS("HFSMODE")="W",IOP="HFS",(XPDSIZ,XPDSIZA)=0,XPDSEQ=1
"RTN","XPDT",87,0)
 ;if MSM and HFS file is on device A or B, then get size for floppy disk
"RTN","XPDT",88,0)
 ;XPDSIZ=disk size, XPDSIZA=accummulated size,XPDSEQ=disk sequence number
"RTN","XPDT",89,0)
 I ^%ZOSF("OS")["MSM",FIL?1(1"A",1"B")1":"1.E D  Q:POP
"RTN","XPDT",90,0)
 .S DIR(0)="N^0:5000",DIR("A")="Size of Diskette (1K blocks)",DIR("B")=1400,DIR("?")="Enter the number of 1K blocks which each diskette will hold, 0 means unlimited space"
"RTN","XPDT",91,0)
 .D ^DIR I $D(DIRUT) S POP=1 Q
"RTN","XPDT",92,0)
 .S XPDSIZ=$S(Y:Y*1024,1:0)
"RTN","XPDT",93,0)
 D ^%ZIS I POP W !!,"**Incorrect Host File name**",!,$C(7) Q
"RTN","XPDT",94,0)
 ;write date and comment header
"RTN","XPDT",95,0)
 S XPDHD="KIDS Distribution saved on "_$$HTE^XLFDT($H)
"RTN","XPDT",96,0)
 U IO W $$SUM(XPDHD),!,$$SUM(XPDH),!
"RTN","XPDT",97,0)
 ;U IO(0) is to insure I am writing to the terminal
"RTN","XPDT",98,0)
 U IO(0) Q
"RTN","XPDT",99,0)
 ;
"RTN","XPDT",100,0)
GO S I=1,Y="",XPDH1="**KIDS**:" U IO
"RTN","XPDT",101,0)
 ;Global Package, header is different and there is only 1 package
"RTN","XPDT",102,0)
 I $D(XPDGP) W $$SUM("**KIDS**GLOBALS:"_$P(XPDT(1),U,2)_U_XPDGP),! G GO1
"RTN","XPDT",103,0)
 ;write header that maintains package list, keep less than 255 char
"RTN","XPDT",104,0)
 F  D  W $$SUM(XPDH1_Y),! Q:I=XPDT  S Y="",I=I+1,XPDH1="**KIDS**"
"RTN","XPDT",105,0)
 .F I=I:1 S Y=Y_$P(XPDT(I),U,2)_"^" Q:$L(Y)>200!(I=XPDT)
"RTN","XPDT",106,0)
 ;after the package list write an extra line feed
"RTN","XPDT",107,0)
GO1 W ! S XPDSIZA=XPDSIZA+2
"RTN","XPDT",108,0)
 ;loop thru & write global, don't kill if set to permanent, set in XPDIU
"RTN","XPDT",109,0)
 F XPDT=1:1:XPDT S XPDA=+XPDT(XPDT),XPDNM=$P(XPDT(XPDT),U,2) D GW K:'$G(^XTMP("XPDT",XPDA)) ^(XPDA)
"RTN","XPDT",110,0)
 W "**END**",!
"RTN","XPDT",111,0)
 ;GLOBAL PACKAGE there could only be one package, write globals
"RTN","XPDT",112,0)
 I $D(XPDGP) D GPW W "**END**",!
"RTN","XPDT",113,0)
 ;we're done with device, close it
"RTN","XPDT",114,0)
 W "**END**",! D ^%ZISC
"RTN","XPDT",115,0)
 W !!,"Package Transported Successfully",!
"RTN","XPDT",116,0)
 Q
"RTN","XPDT",117,0)
GW ;global write
"RTN","XPDT",118,0)
 N GR,GCK,GL
"RTN","XPDT",119,0)
 S GCK="^XTMP(""XPDT"","_XPDA,GR=GCK_")",GCK=GCK_",",GL=$L(GCK)
"RTN","XPDT",120,0)
 ;INSTALL NAME line will mark the begining of global for all lines until
"RTN","XPDT",121,0)
 ;the next INSTALL NAME
"RTN","XPDT",122,0)
 W $$SUM("**INSTALL NAME**",1),!,$$SUM(XPDNM),!
"RTN","XPDT",123,0)
 F  Q:$D(DIRUT)  S GR=$Q(@GR) Q:GR=""!($E(GR,1,GL)'=GCK)  W $$SUM($P(GR,GCK,2),1),!,$$SUM(@GR),!
"RTN","XPDT",124,0)
 Q
"RTN","XPDT",125,0)
GPW ;global package write
"RTN","XPDT",126,0)
 N I,G,GR,GCK,GL
"RTN","XPDT",127,0)
 W !
"RTN","XPDT",128,0)
 F I=1:1 S G=$P(XPDGP,U,I) Q:G=""  D
"RTN","XPDT",129,0)
 .S GR="^"_$P(G,";",2),GCK=$S(GR[")":$E(GR,1,$L(GR)-1)_",",1:GR_"("),GL=$L(GCK)
"RTN","XPDT",130,0)
 .;GLOBAL line will mark the begining of global for all lines until
"RTN","XPDT",131,0)
 .;the next GLOBAL
"RTN","XPDT",132,0)
 .W $$SUM("**GLOBAL**",1),!,$$SUM(GR),!
"RTN","XPDT",133,0)
 .F  Q:$D(DIRUT)  S GR=$Q(@GR) Q:GR=""!($E(GR,1,GL)'=GCK)  W $$SUM($P(GR,GCK,2),1),!,$$SUM(@GR),!
"RTN","XPDT",134,0)
 Q
"RTN","XPDT",135,0)
QUIT F XPDT=1:1:XPDT L -^XPD(9.6,+XPDT(XPDT))
"RTN","XPDT",136,0)
 Q
"RTN","XPDT",137,0)
ABORT W !!,"**TRANSPORT ABORTED**",*7
"RTN","XPDT",138,0)
 D QUIT
"RTN","XPDT",139,0)
 F XPDT=1:1:XPDT K ^XTMP("XPDT",+XPDT(XPDT))
"RTN","XPDT",140,0)
 D ^%ZISC
"RTN","XPDT",141,0)
 Q
"RTN","XPDT",142,0)
 ;
"RTN","XPDT",143,0)
PCK(XPDA,XPDNM,XPDREQ) ;XPDA=Build ien, XPDNM=Build name, XPDREQ=Required
"RTN","XPDT",144,0)
 N Y
"RTN","XPDT",145,0)
 S XPDT=XPDT+1,XPDT(XPDT)=XPDA_U_XPDNM,XPDT("DA",XPDA)=XPDT
"RTN","XPDT",146,0)
 S:'$G(XPDREQ) XPDREQ=0
"RTN","XPDT",147,0)
 S $P(XPDT(XPDT),U,4)=XPDREQ
"RTN","XPDT",148,0)
 Q:'$D(^XTMP("XPDT",XPDA))  S Y=$G(^(XPDA))
"RTN","XPDT",149,0)
 W "     **Transport Global exists**"
"RTN","XPDT",150,0)
 ;Y=1 if TG is permanet
"RTN","XPDT",151,0)
 I Y S $P(XPDT(XPDT),U,3)=1 Q
"RTN","XPDT",152,0)
 ;ask if they want to use TG
"RTN","XPDT",153,0)
 D ^DIR S $P(XPDT(XPDT),U,3)=Y
"RTN","XPDT",154,0)
 Q
"RTN","XPDT",155,0)
 ;
"RTN","XPDT",156,0)
SUM(X,Z) ;X=string to write, Z 0=don't check size
"RTN","XPDT",157,0)
 S XPDSIZA=XPDSIZA+$L(X)+2
"RTN","XPDT",158,0)
 ;ask for next disk
"RTN","XPDT",159,0)
 ;this code is for MSM system only
"RTN","XPDT",160,0)
 I $G(Z),XPDSIZ,XPDSIZ-XPDSIZA<1024 D
"RTN","XPDT",161,0)
 .;write continue flag at end of this file
"RTN","XPDT",162,0)
 .W "**CONTINUE**",!,"**END**",!
"RTN","XPDT",163,0)
 .;should call %ZIS HFS utilities to close and open file
"RTN","XPDT",164,0)
 .C IO U IO(0)
"RTN","XPDT",165,0)
 .N DIR,G,GR,GCK,GL,I,X,Y
"RTN","XPDT",166,0)
 .W !!,"Diskette #",XPDSEQ," is full."
"RTN","XPDT",167,0)
 .S DIR(0)="E",DIR("A")="Insert the next diskette and Press the return key",DIR("?")="The current diskette is full, insert a new diskette to continue."
"RTN","XPDT",168,0)
 .;$D(DIRUT)=the user aborted the distribution
"RTN","XPDT",169,0)
 .D ^DIR I $D(DIRUT) D ABORT Q
"RTN","XPDT",170,0)
 .W ! S XPDSEQ=XPDSEQ+1,XPDSIZA=0
"RTN","XPDT",171,0)
 .;MSM specific code to open HFS
"RTN","XPDT",172,0)
 .O @(""""_IO_""":"_IOPAR) U IO
"RTN","XPDT",173,0)
 .W $$SUM("Continuation #"_XPDSEQ_" of "_XPDHD),!,$$SUM(XPDH),!,$$SUM("**SEQ**:"_XPDSEQ),!!
"RTN","XPDT",174,0)
 .S XPDSIZA=XPDSIZA+2
"RTN","XPDT",175,0)
 Q X
"RTN","XPDT",176,0)
 ;
"RTN","XPDT",177,0)
PRET ;Pre-Transport Routine
"RTN","XPDT",178,0)
 N Y S Y=$G(^XPD(9.6,XPDA,"PRET")) Q:Y=""
"RTN","XPDT",179,0)
 I '$$RTN^XPDV(Y) W !!,"Pre-Transportation Routine DOESN'T EXIST!!",*7 Q
"RTN","XPDT",180,0)
 S Y=$S(Y["^":Y,1:"^"_Y) W !,"Running Pre-Transportation Routine ",Y
"RTN","XPDT",181,0)
 D @Y Q
"RTN","XPDTC")
0^5^B38539825
"RTN","XPDTC",1,0)
XPDTC ;SFISC/RSD - Transport calls ;11/24/98  08:37
"RTN","XPDTC",2,0)
 ;;8.0;KERNEL;**10,15,21,39,41,44,58,83,92,95,100**;Jul 10, 1995
"RTN","XPDTC",3,0)
 Q
"RTN","XPDTC",4,0)
 ;^XTMP("XPDT",XPDA,data type,file #,
"RTN","XPDTC",5,0)
 ;XPDA=ien of File 9.6, XPDNM=.01 field
"RTN","XPDTC",6,0)
DD ;build DD
"RTN","XPDTC",7,0)
 N FILE,FGR,FNAM,Z2,Z3,Z4
"RTN","XPDTC",8,0)
 S FILE=0,FGR="^XTMP(""XPDT"",XPDA)",FNAM=$NA(^XPD(9.6,XPDA,4,"APDD"))
"RTN","XPDTC",9,0)
 F  S FILE=$O(^XPD(9.6,XPDA,4,FILE)) Q:'FILE  D
"RTN","XPDTC",10,0)
 .S Z2=$G(^XPD(9.6,XPDA,4,FILE,222)),Z3=$G(^(223)),Z4=$G(^(224))
"RTN","XPDTC",11,0)
 .Q:'$$DATA^XPDV(FILE,Z2)
"RTN","XPDTC",12,0)
 .D FIA^DIFROMSU(FILE,"",FNAM,FGR,Z2,Z3,Z4,XPDVER),DIERR:$D(DIERR)
"RTN","XPDTC",13,0)
 Q:'$D(^XTMP("XPDT",XPDA,"FIA"))
"RTN","XPDTC",14,0)
 ;send DD and Data
"RTN","XPDTC",15,0)
 D DDOUT^DIFROMS("","","",FGR),DIERR:$D(DIERR),DATAOUT^DIFROMS("","","",FGR),DIERR:$D(DIERR)
"RTN","XPDTC",16,0)
 Q
"RTN","XPDTC",17,0)
 ;XPDERR is checked in XPDT and will abort transport
"RTN","XPDTC",18,0)
DIERR ;record error
"RTN","XPDTC",19,0)
 D MSG^DIALOG("EW",.XPD) S XPDERR=1
"RTN","XPDTC",20,0)
 Q
"RTN","XPDTC",21,0)
KRN ;build Kernel Files
"RTN","XPDTC",22,0)
 ;XPDFILE=file #, XPDOLDA=ien in Build file
"RTN","XPDTC",23,0)
 N %,%1,%2,DA,EACT,FACT,FGR,XPDFILE,XPDFL,XPDOLDA,XPDI
"RTN","XPDTC",24,0)
 F XPDFILE=1:1 S Y0=$P($T(FILES+XPDFILE^XPDE),";;",2,99) Q:Y0=""  S XPDI(+Y0)=Y0
"RTN","XPDTC",25,0)
 ;XPDI(XPDFILE)=file;order;x-ref;fact;eact;fpre;epre;fpos;epos;fdel
"RTN","XPDTC",26,0)
 S XPDFILE=0
"RTN","XPDTC",27,0)
 F  S XPDFILE=$O(^XPD(9.6,XPDA,"KRN",XPDFILE)) Q:'XPDFILE  S XPDI=$G(XPDI(XPDFILE)),FACT=$P(XPDI,";",4),EACT=$P(XPDI,";",5) D  Q:$D(XPDERR)  D:FACT]"" ACT(FACT)
"RTN","XPDTC",28,0)
 .;need to add code to check if File and data is already being sent in the File
"RTN","XPDTC",29,0)
 .;mult. If it is, don't bother sending it again.  DTL(XPDFILE)
"RTN","XPDTC",30,0)
 .S XPDOLDA=0,FGR=$$FILE^XPDV(XPDFILE) I FGR="" S XPDERR=1 Q
"RTN","XPDTC",31,0)
 .K ^TMP($J,"XPD")
"RTN","XPDTC",32,0)
 .F  S XPDOLDA=$O(^XPD(9.6,XPDA,"KRN",XPDFILE,"NM",XPDOLDA)) Q:'XPDOLDA  S Y0=$G(^(XPDOLDA,0)) D
"RTN","XPDTC",33,0)
 ..;XPDFL= 0-send,1-delete,2-link,3-merge,4-attach,5-disable
"RTN","XPDTC",34,0)
 ..S XPDFL=$P(Y0,U,3)
"RTN","XPDTC",35,0)
 ..;If deleting at site get an unused DA
"RTN","XPDTC",36,0)
 ..I XPDFL=1 S DA=$O(@FGR@(" "),-1)+1 F DA=DA:1 Q:'$D(^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA))
"RTN","XPDTC",37,0)
 ..;$P(Y0,U,2) is file # for this template, reset Y0 before getting DA
"RTN","XPDTC",38,0)
 ..E  S:$P(Y0,U,2) $P(Y0,U)=$P(Y0,"    FILE #") S DA=$$ENTRY^XPDV(Y0)
"RTN","XPDTC",39,0)
 ..I 'DA S XPDERR=1 Q
"RTN","XPDTC",40,0)
 ..;(-1)=action ^ ien in Build file
"RTN","XPDTC",41,0)
 ..S ^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA,-1)=+XPDFL_"^"_XPDOLDA
"RTN","XPDTC",42,0)
 ..;action 2 - verify children, 4 - verify parent
"RTN","XPDTC",43,0)
 ..I XPDFL=2!(XPDFL=4),'$$MENU^XPDV(XPDFILE,DA,XPDFL) S XPDERR=1 Q
"RTN","XPDTC",44,0)
 ..;if action is 1,4 or 5 then only send .01 field and set checksum to ""
"RTN","XPDTC",45,0)
 ..I XPDFL=1!(XPDFL>3) S ^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA,0)=$P(Y0,U),$P(^XPD(9.6,XPDA,"KRN",XPDFILE,"NM",XPDOLDA),U,4)="" Q
"RTN","XPDTC",46,0)
 ..M ^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA)=@FGR@(DA)
"RTN","XPDTC",47,0)
 ..;execute entry build action
"RTN","XPDTC",48,0)
 ..D:EACT]"" ACT(EACT)
"RTN","XPDTC",49,0)
 .;quit if no entries were saved
"RTN","XPDTC",50,0)
 .Q:'$O(^XTMP("XPDT",XPDA,"KRN",XPDFILE,0))
"RTN","XPDTC",51,0)
 .;XPDI=XPDI(XPDFILE), build x-ref of order to install
"RTN","XPDTC",52,0)
 .S %=$P(^DIC(XPDFILE,0),U),^XTMP("XPDT",XPDA,"ORD",+$P(XPDI,";",2),XPDFILE)=XPDI,^(XPDFILE,0)=%
"RTN","XPDTC",53,0)
 .Q
"RTN","XPDTC",54,0)
 Q
"RTN","XPDTC",55,0)
QUES ;build from Install Questions multiple
"RTN","XPDTC",56,0)
 N I,J,X,%
"RTN","XPDTC",57,0)
 S X=""
"RTN","XPDTC",58,0)
 ;the "B" x-ref will give me the order of the questions
"RTN","XPDTC",59,0)
 F  S X=$O(^XPD(9.6,XPDA,"QUES","B",X)) Q:X=""  S I=$$QUES^XPDV(X) S:'I XPDERR=1 D:I
"RTN","XPDTC",60,0)
 .S J=0 F  S J=$O(^XPD(9.6,XPDA,"QUES",I,J)) Q:J=""  D
"RTN","XPDTC",61,0)
 ..;tranform J to DIR subscripts
"RTN","XPDTC",62,0)
 ..I $L(J)=1!(J="QQ") S ^XTMP("XPDT",XPDA,"QUES",X,$TR(J,"1ABQ","0AB?"))=^(J) Q  ;^(J) ref to ^XPD(9.6,XPDA,"QUES",I,J)
"RTN","XPDTC",63,0)
 ..;set the word processing fields into DIR("?",#) structure
"RTN","XPDTC",64,0)
 ..F %=1:1 Q:'$D(^XPD(9.6,XPDA,"QUES",I,J,%,0))  S ^XTMP("XPDT",XPDA,"QUES",X,$TR(J,"AQ10","A?"),%)=^(0)
"RTN","XPDTC",65,0)
 ;send the File questions
"RTN","XPDTC",66,0)
 F I=1:2 S X=$P($T(QUESTION+I),";;",2,99) Q:X=""  S Y=$P($T(QUESTION+I+1),";;",2) D
"RTN","XPDTC",67,0)
 .S ^XTMP("XPDT",XPDA,"QUES",$P(X,";"),0)=$P(X,";",2),^("A")=$P(X,";",3),^("B")=$P(X,";",4),^("??")=$P(X,";",5) S:Y]"" ^("M")=Y
"RTN","XPDTC",68,0)
 Q
"RTN","XPDTC",69,0)
INT ;build pre,post, & enviroment init routines
"RTN","XPDTC",70,0)
 N %,I,X
"RTN","XPDTC",71,0)
 F I="PRE","INI","INIT" I $G(^XPD(9.6,XPDA,I))]"" S X=^(I) D
"RTN","XPDTC",72,0)
 .S ^XTMP("XPDT",XPDA,I)=X,X=$P(X,U,$L(X,U)) Q:$D(^("RTN",X))
"RTN","XPDTC",73,0)
 .I '$$RTN^XPDV(X) W !,"Routine ",X," **NOT FOUND**" S XPDERR=1 Q
"RTN","XPDTC",74,0)
 .S %=$$LOAD^XPDTA(X,"0^")
"RTN","XPDTC",75,0)
 Q
"RTN","XPDTC",76,0)
BLD ;build Build file, Package file and Order Parameter file
"RTN","XPDTC",77,0)
 N %,DIC,X,XPD,XPDI,XPDV,Y
"RTN","XPDTC",78,0)
 ;save version of kernel and fm
"RTN","XPDTC",79,0)
 S ^XTMP("XPDT",XPDA,"VER")=$$VERSION^XPDUTL("XU")_U_$$VERSION^XPDUTL("VA FILEMAN")
"RTN","XPDTC",80,0)
 S ^XTMP("XPDT",XPDA,"MBREQ")=$P($G(XPDT(XPDT)),U,4)
"RTN","XPDTC",81,0)
 M ^XTMP("XPDT",XPDA,"BLD",XPDA)=^XPD(9.6,XPDA)
"RTN","XPDTC",82,0)
 ;check national package file pointer
"RTN","XPDTC",83,0)
 S XPDI=$P(^XPD(9.6,XPDA,0),U,2)
"RTN","XPDTC",84,0)
 I XPDI="" W !,"No Package File Link" Q
"RTN","XPDTC",85,0)
 S $P(^XTMP("XPDT",XPDA,"BLD",XPDA,0),U,2)=$$PT^XPDTA("^DIC(9.4)",XPDI)
"RTN","XPDTC",86,0)
 ;quit if no pointer to package file
"RTN","XPDTC",87,0)
 I '$D(^DIC(9.4,XPDI)) W !,"Package File Link is corrupted" S XPDERR=1 Q
"RTN","XPDTC",88,0)
 ;update version multiple in package file,XPD=version^date distributed
"RTN","XPDTC",89,0)
 S XPD=$$VER^XPDUTL(XPDNM)_U_$P(^XTMP("XPDT",XPDA,"BLD",XPDA,0),U,4)
"RTN","XPDTC",90,0)
 ;XPD(1)=root of description field
"RTN","XPDTC",91,0)
 S:$D(^XTMP("XPDT",XPDA,"BLD",XPDA,1)) XPD(1)=$NA(^(1))
"RTN","XPDTC",92,0)
 S ^XTMP("XPDT",XPDA,"PKG",XPDI,0)=^DIC(9.4,XPDI,0),^XTMP("XPDT",XPDA,"PKG",XPDI,22,0)="^"_$P(^DD(9.4,22,0),U,2)_"^1^1"
"RTN","XPDTC",93,0)
 ;add node 20 to XTMP for Patient Merge
"RTN","XPDTC",94,0)
 M ^XTMP("XPDT",XPDA,"PKG",XPDI,20)=^DIC(9.4,XPDI,20)
"RTN","XPDTC",95,0)
 ;XPDNM'["*" is a version release
"RTN","XPDTC",96,0)
 I XPDNM'["*" D
"RTN","XPDTC",97,0)
 .S XPDV=$$PKGVER^XPDIP(XPDI,.XPD)
"RTN","XPDTC",98,0)
 .;Merge is used to set single nodes and merge multiples
"RTN","XPDTC",99,0)
 .F %=1,5,7,20,"DEV","VERSION" M ^XTMP("XPDT",XPDA,"PKG",XPDI,%)=^DIC(9.4,XPDI,%)
"RTN","XPDTC",100,0)
 .;XPDV=ien of Version Multiple
"RTN","XPDTC",101,0)
 .I $D(^DIC(9.4,XPDI,22,XPDV))'>9 W !!,"**Version multiple in Package file wasn't updated**",!! S XPDERR=1 Q
"RTN","XPDTC",102,0)
 .M ^XTMP("XPDT",XPDA,"PKG",XPDI,22,1)=^DIC(9.4,XPDI,22,XPDV)
"RTN","XPDTC",103,0)
 ;this is a patch, %=version number, $P(XPD,U)=patch number
"RTN","XPDTC",104,0)
 E  D
"RTN","XPDTC",105,0)
 .S %=$P(XPD,U),$P(XPD,U)=$P(XPDNM,"*",3),XPDV=$$PKGPAT^XPDIP(XPDI,%,.XPD)
"RTN","XPDTC",106,0)
 .S ^XTMP("XPDT",XPDA,"PKG",XPDI,22,1,0)=^DIC(9.4,XPDI,22,+XPDV,0)
"RTN","XPDTC",107,0)
 .I $D(^DIC(9.4,XPDI,22,+XPDV,"PAH",+$P(XPDV,U,2)))'>9 W !!,"**Patch multiple in Package file wasn't updated**",!! S XPDERR=1 Q
"RTN","XPDTC",108,0)
 .M ^XTMP("XPDT",XPDA,"PKG",XPDI,22,1,"PAH",1)=^DIC(9.4,XPDI,22,+XPDV,"PAH",+$P(XPDV,U,2))
"RTN","XPDTC",109,0)
 ;M ^XTMP("XPDT",XPDA,"PKG",XPDI)=^DIC(9.4,XPDI)
"RTN","XPDTC",110,0)
 ;save the version ien^patch ien on -1 node
"RTN","XPDTC",111,0)
 S ^XTMP("XPDT",XPDA,"PKG",XPDI,-1)="1^1"
"RTN","XPDTC",112,0)
 ;resolve Primary Help Frame (0;4)
"RTN","XPDTC",113,0)
 S %=+$P(^DIC(9.4,XPDI,0),U,4) S:% $P(^XTMP("XPDT",XPDA,"PKG",XPDI,0),U,4)=$$PT^XPDTA("^DIC(9.2)",%)
"RTN","XPDTC",114,0)
 Q
"RTN","XPDTC",115,0)
 ;
"RTN","XPDTC",116,0)
ACT(%) ;execute action
"RTN","XPDTC",117,0)
 ;user can count on DA,XPDFILE,XPDFL,XPDNM,XPDOLDA being around
"RTN","XPDTC",118,0)
 ;DA=ien in ^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA)
"RTN","XPDTC",119,0)
 ;XPDOLDA=ien in ^XPD(9.6,XPDA,"KRN",XPDIFLE,"NM",XPDOLDA)
"RTN","XPDTC",120,0)
 N EACT,FACT,FGR,K0,Y0
"RTN","XPDTC",121,0)
 S:%'["^" %="^"_%
"RTN","XPDTC",122,0)
 D @% Q
"RTN","XPDTC",123,0)
 ;
"RTN","XPDTC",124,0)
 ;the following are the default questions for the INSTALL QUESTIONS
"RTN","XPDTC",125,0)
 ;in file 9.6, the format is:
"RTN","XPDTC",126,0)
 ;;field .01;field 1;field 2;field 4;field 7
"RTN","XPDTC",127,0)
 ;;field 10
"RTN","XPDTC",128,0)
QUESTION ;package install questions
"RTN","XPDTC",129,0)
 ;;XPF1;Y;Shall I write over your |FLAG| File;YES;^D REP^XPDH
"RTN","XPDTC",130,0)
 ;;D XPF1^XPDIQ
"RTN","XPDTC",131,0)
 ;;XPF2;Y;Want my data |FLAG| yours;YES;^D DTA^XPDH
"RTN","XPDTC",132,0)
 ;;D XPF2^XPDIQ
"RTN","XPDTC",133,0)
 ;;XPM1;PO^VA(200,:EM;Enter the Coordinator for Mail Group '|FLAG|';;^D MG^XPDH
"RTN","XPDTC",134,0)
 ;;D XPM1^XPDIQ
"RTN","XPDTC",135,0)
 ;;XPO1;Y;Want KIDS to Rebuild Menu Trees Upon Completion of Install;YES;^D MENU^XPDH
"RTN","XPDTC",136,0)
 ;;D XPO1^XPDIQ
"RTN","XPDTC",137,0)
 ;;XPZ1;Y;Want to DISABLE Scheduled Options, Menu Options, and Protocols;YES;^D OPT^XPDH
"RTN","XPDTC",138,0)
 ;;D XPZ1^XPDIQ
"RTN","XPDTC",139,0)
 ;;XPZ2;Y;Want to MOVE routines to other CPUs;NO;^D RTN^XPDH
"RTN","XPDTC",140,0)
 ;;D XPZ2^XPDIQ
"RTN","XPDUTL")
0^3^B11869701
"RTN","XPDUTL",1,0)
XPDUTL ;SFISC/RSD - KIDS utilities ;11/25/98  14:02
"RTN","XPDUTL",2,0)
 ;;8.0;KERNEL;**21,28,39,81,100**;Jul 10, 1995
"RTN","XPDUTL",3,0)
 Q
"RTN","XPDUTL",4,0)
VERSION(X) ;Get current version from Package file, X=package name or
"RTN","XPDUTL",5,0)
 ;package namespace
"RTN","XPDUTL",6,0)
 N I
"RTN","XPDUTL",7,0)
 S I=$O(^DIC(9.4,"C",X,0)) S:I'>0 I=$O(^DIC(9.4,"B",X,0))
"RTN","XPDUTL",8,0)
 Q $P($G(^DIC(9.4,+I,"VERSION")),"^")
"RTN","XPDUTL",9,0)
 ;
"RTN","XPDUTL",10,0)
VER(X) ;returns version number from Build file, X=build name
"RTN","XPDUTL",11,0)
 Q:X["*" $P(X,"*",2)
"RTN","XPDUTL",12,0)
 Q $P(X," ",$L(X," "))
"RTN","XPDUTL",13,0)
 ;
"RTN","XPDUTL",14,0)
PKG(X) ;returns package name from Build file, X=build name
"RTN","XPDUTL",15,0)
 Q $S(X["*":$P(X,"*"),1:$P(X," ",1,$L(X," ")-1))
"RTN","XPDUTL",16,0)
 ;
"RTN","XPDUTL",17,0)
PATCH(X) ;return 1 if patch X was installed, X=aaaa*nn.nn*nnn
"RTN","XPDUTL",18,0)
 Q:X'?1.4U1"*"1.2N1"."1.2N.1(1"V",1"T").2N1"*"1.3N 0
"RTN","XPDUTL",19,0)
 N %,I,J
"RTN","XPDUTL",20,0)
 S I=$O(^DIC(9.4,"C",$P(X,"*"),0)) Q:'I 0
"RTN","XPDUTL",21,0)
 S J=$O(^DIC(9.4,I,22,"B",$P(X,"*",2),0)),X=$P(X,"*",3) Q:'J 0
"RTN","XPDUTL",22,0)
 ;check if patch is just a number
"RTN","XPDUTL",23,0)
 Q:$O(^DIC(9.4,I,22,J,"PAH","B",X,0)) 1
"RTN","XPDUTL",24,0)
 S %=$O(^DIC(9.4,I,22,J,"PAH","B",X_" SEQ"))
"RTN","XPDUTL",25,0)
 Q (X=+%)
"RTN","XPDUTL",26,0)
 ;
"RTN","XPDUTL",27,0)
NEWCP(XPD,XPDC,XPDP) ;create new check point, returns 0=error or ien
"RTN","XPDUTL",28,0)
 ;XPD=name, XPDC=call back, XPDP=parameters
"RTN","XPDUTL",29,0)
 Q:$G(XPD)="" 0
"RTN","XPDUTL",30,0)
 N %,XPDI,XPDJ,XPDF,XPDY
"RTN","XPDUTL",31,0)
 ;XPDCP="INI"=Pre-init, "INIT"=Post-init
"RTN","XPDUTL",32,0)
 S XPDI=$S(XPDCP="INIT":9.716,1:9.713)
"RTN","XPDUTL",33,0)
 S %=$$FIND1^DIC(XPDI,","_XPDA_",","X",XPD) Q:% %
"RTN","XPDUTL",34,0)
 S XPDF="+1,"_XPDA_",",XPDJ(XPDI,XPDF,.01)=XPD
"RTN","XPDUTL",35,0)
 S:$D(XPDC) XPDJ(XPDI,XPDF,2)=XPDC
"RTN","XPDUTL",36,0)
 S:$D(XPDP) XPDJ(XPDI,XPDF,3)=XPDP
"RTN","XPDUTL",37,0)
 D UPDATE^DIE("","XPDJ","XPDY")
"RTN","XPDUTL",38,0)
 Q $G(XPDY(1))
"RTN","XPDUTL",39,0)
 ;
"RTN","XPDUTL",40,0)
UPCP(XPD,XPDP) ;update check point, returns 0=error or ien
"RTN","XPDUTL",41,0)
 ;XPD=name, XPDP=parameters
"RTN","XPDUTL",42,0)
 N XPDI,XPDJ,XPDF,XPDY
"RTN","XPDUTL",43,0)
 ;XPDCP="INI"=Pre-init, "INIT"=Post-init
"RTN","XPDUTL",44,0)
 S XPDI=$S(XPDCP="INIT":9.716,1:9.713),XPDY=$$DICCP($G(XPD))
"RTN","XPDUTL",45,0)
 Q:'XPDY 0
"RTN","XPDUTL",46,0)
 S XPDF=XPDY_","_XPDA_","
"RTN","XPDUTL",47,0)
 S:$D(XPDP) XPDJ(XPDI,XPDF,3)=XPDP
"RTN","XPDUTL",48,0)
 D FILE^DIE("","XPDJ")
"RTN","XPDUTL",49,0)
 Q XPDY
"RTN","XPDUTL",50,0)
 ;
"RTN","XPDUTL",51,0)
COMCP(XPD) ;complete check point, returns 0=error or date/time
"RTN","XPDUTL",52,0)
 ;XPD=name
"RTN","XPDUTL",53,0)
 N XPDD,XPDI,XPDJ,XPDY
"RTN","XPDUTL",54,0)
 S XPDI=$S(XPDCP="INIT":9.716,1:9.713),XPDY=$$DICCP($G(XPD))
"RTN","XPDUTL",55,0)
 Q:'XPDY 0
"RTN","XPDUTL",56,0)
 S XPDD=$$NOW^XLFDT,XPDJ(XPDI,XPDY_","_XPDA_",",1)=XPDD
"RTN","XPDUTL",57,0)
 D FILE^DIE("","XPDJ")
"RTN","XPDUTL",58,0)
 Q XPDD
"RTN","XPDUTL",59,0)
 ;
"RTN","XPDUTL",60,0)
VERCP(XPD) ;verify check point, returns 1=completed, 0=not
"RTN","XPDUTL",61,0)
 ;-1=doesn't exist
"RTN","XPDUTL",62,0)
 ;XPD=name
"RTN","XPDUTL",63,0)
 N XPDI,XPDY
"RTN","XPDUTL",64,0)
 S XPDI=$S(XPDCP="INIT":9.716,1:9.713),XPDY=$$DICCP($G(XPD))
"RTN","XPDUTL",65,0)
 Q:'XPDY -1
"RTN","XPDUTL",66,0)
 Q ''$$GET1^DIQ(XPDI,XPDY_","_XPDA_",",1,"I")
"RTN","XPDUTL",67,0)
 ;
"RTN","XPDUTL",68,0)
PARCP(XPD,XPDF) ;returns parameters of check point
"RTN","XPDUTL",69,0)
 ;XPD=name, XPDF="PRE"
"RTN","XPDUTL",70,0)
 N XPDI,XPDY
"RTN","XPDUTL",71,0)
 I $G(XPDF)="PRE" N XPDCP S XPDCP="INI"
"RTN","XPDUTL",72,0)
 S XPDI=$S(XPDCP="INIT":9.716,1:9.713),XPDY=$$DICCP($G(XPD))
"RTN","XPDUTL",73,0)
 Q:'XPDY 0
"RTN","XPDUTL",74,0)
 Q $$GET1^DIQ(XPDI,XPDY_","_XPDA_",",3,"I")
"RTN","XPDUTL",75,0)
 ;
"RTN","XPDUTL",76,0)
CURCP(XPDF) ;returns current check point
"RTN","XPDUTL",77,0)
 ;XPDF flag - 0=externel, 1=internal
"RTN","XPDUTL",78,0)
 Q $S($G(XPDF):XPDCHECK,1:XPDCHECK(0))
"RTN","XPDUTL",79,0)
 ;
"RTN","XPDUTL",80,0)
WP(X) ;X=global ref
"RTN","XPDUTL",81,0)
 N %
"RTN","XPDUTL",82,0)
 Q:'$D(@X)
"RTN","XPDUTL",83,0)
 F %=1:1 Q:'$D(@X@(%))  W !,@X@(%)
"RTN","XPDUTL",84,0)
 Q:'$G(XPDA)  D WP^DIE(9.7,XPDA_",",20,"A",X)
"RTN","XPDUTL",85,0)
 Q
"RTN","XPDUTL",86,0)
MES(X) ;record message, X=message or an array passed by reference
"RTN","XPDUTL",87,0)
 N %
"RTN","XPDUTL",88,0)
 I $D(X)#2 S %=X K X S X(1)=%
"RTN","XPDUTL",89,0)
 ;write message
"RTN","XPDUTL",90,0)
 F %=1:1 Q:'$D(X(%))  W !,X(%)
"RTN","XPDUTL",91,0)
 Q:'$G(XPDA)  D WP^DIE(9.7,XPDA_",",20,"A","X")
"RTN","XPDUTL",92,0)
 Q
"RTN","XPDUTL",93,0)
BMES(X) ;add blank line before message
"RTN","XPDUTL",94,0)
 N %
"RTN","XPDUTL",95,0)
 I $D(X)#2 S %=X K X S X(1)=" ",X(2)=%
"RTN","XPDUTL",96,0)
 D MES(.X)
"RTN","XPDUTL",97,0)
 Q
"RTN","XPDUTL",98,0)
RTNUP(X,Y) ;update routine action, X=routine, Y=action
"RTN","XPDUTL",99,0)
 ;actions:  1=delete, 2=skip
"RTN","XPDUTL",100,0)
 N %
"RTN","XPDUTL",101,0)
 ;set action to Y
"RTN","XPDUTL",102,0)
 Q:'$G(Y)!'$D(^XTMP("XPDI",$G(XPDA),"RTN",X)) 0 S $P(^(X),U)=+Y
"RTN","XPDUTL",103,0)
 Q 1
"RTN","XPDUTL",104,0)
 ;get Build ien
"RTN","XPDUTL",105,0)
 S Y=$O(^XTMP("XPDI",XPDA,"BLD",0))
"RTN","XPDUTL",106,0)
 ;remove checksum when updating action, since action can only be
"RTN","XPDUTL",107,0)
 ;delete or skip, not sure if we want to do this
"RTN","XPDUTL",108,0)
 S:$P(%,U,2) $P(^XTMP("XPDI",XPDA,"BLD",Y,"KRN",9.8,"NM",$P(%,U,2),0),U,4)=""
"RTN","XPDUTL",109,0)
 Q 1
"RTN","XPDUTL",110,0)
DICCP(X) ;lookup check point, returns ien or 0
"RTN","XPDUTL",111,0)
 Q:$G(X)="" 0
"RTN","XPDUTL",112,0)
 ;if they pass ien, fail if can't find
"RTN","XPDUTL",113,0)
 I X=+X S Y=X Q:'$D(^XPD(9.7,XPDA,XPDCP,Y,0)) 0
"RTN","XPDUTL",114,0)
 E  S Y=$$FIND1^DIC(XPDI,","_XPDA_",","X",X)
"RTN","XPDUTL",115,0)
 Q Y
"RTN","XPDUTL",116,0)
 ;
"RTN","XPDUTL",117,0)
PRODE(XPDN,XPD) ;enable/disable protocols, return 1 for success
"RTN","XPDUTL",118,0)
 ;XPDN=protocol name, XPD=1-enable, 0-disable
"RTN","XPDUTL",119,0)
 Q:$G(XPDN)="" 0
"RTN","XPDUTL",120,0)
 S XPD=+$G(XPD)
"RTN","XPDUTL",121,0)
 D KIDS^XQOO1($P(XPDSET,U,2),101,XPDN,.XPD)
"RTN","XPDUTL",122,0)
 Q $S(XPD<0:0,1:1)
"RTN","XPDUTL",123,0)
 ;
"RTN","XPDUTL",124,0)
OPTDE(XPDN,XPD) ;enable/disable options, return 1 for success
"RTN","XPDUTL",125,0)
 ;XPDN=protocol name, XPD=1-enable, 0-disable
"RTN","XPDUTL",126,0)
 Q:$G(XPDN)="" 0
"RTN","XPDUTL",127,0)
 S XPD=+$G(XPD)
"RTN","XPDUTL",128,0)
 D KIDS^XQOO1($P(XPDSET,U,2),19,XPDN,.XPD)
"RTN","XPDUTL",129,0)
 Q $S(XPD<0:0,1:1)
"RTN","XPDUTL",130,0)
 ;
"RTN","XPDUTL",131,0)
BUILD(XPDN,XPD) ;check if a build exists, return 1 for success
"RTN","XPDUTL",132,0)
 ;XPDN=build name, XPD=1-exist, 0-been removed
"RTN","XPDUTL",133,0)
 S XPD=$D(XPDT("NM",XPDN))
"RTN","XPDUTL",134,0)
 Q XPD
"RTN","XPDUTL",135,0)
 ;
"UP",9.6,9.63,-1)
9.6^10
"UP",9.6,9.63,0)
9.63
"VER")
8.0^21.0
"^DD",9.6,9.63,.001,0)
INSTALL ORDER^NJ6,2^^ ^K:+X'=X!(X>999)!(X<1)!(X?.E1"."3N.N) X
"^DD",9.6,9.63,.001,3)
Type a Number between 1 and 999, 2 Decimal Digits
"^DD",9.6,9.63,.001,21,0)
^^1^1^2940503^
"^DD",9.6,9.63,.001,21,1,0)
This is the order in which this package will be installed.
"^DD",9.6,9.63,.001,"DT")
2981117
"^DD",9.6,9.63,.02,0)
REQUIRED TO CONTINUE^S^1:YES;0:NO;^0;2^Q
"^DD",9.6,9.63,.02,21,0)
^^6^6^2990217^^^^
"^DD",9.6,9.63,.02,21,1,0)
YES: If this distribution fails KID's internal checks it will be unloaded 
"^DD",9.6,9.63,.02,21,2,0)
automatically along with all other distributions in this multi-build.  No user 
"^DD",9.6,9.63,.02,21,3,0)
interaction will take place.
"^DD",9.6,9.63,.02,21,4,0)

"^DD",9.6,9.63,.02,21,5,0)
NO: If this distributuion fails KID's internal checks the user will choose to 
"^DD",9.6,9.63,.02,21,6,0)
either 'load it' or 'skip it' and continue with the other distributions.
"^DD",9.6,9.63,.02,"DT")
2981118
"^DD",9.7,9.7,6.5,0)
REQUIRED TO CONTINUE^S^1:YES;0:NO;^0;7^Q
"^DD",9.7,9.7,6.5,21,0)
^^4^4^2981118^
"^DD",9.7,9.7,6.5,21,1,0)
If required (answer = YES) the entire build will be aborted if this build does 
"^DD",9.7,9.7,6.5,21,2,0)
not successfully load.  If not required (answer = NO) the other builds within 
"^DD",9.7,9.7,6.5,21,3,0)
this build will continue to be processed.
"^DD",9.7,9.7,6.5,21,4,0)

"^DD",9.7,9.7,6.5,"DT")
2981118
**END**
**END**
