$TXT Created by DESMOND,LINDA at DEVVDD.FO-ALBANY.MED.VA.GOV  (KIDS) on Thursday, 07/12/07 at 21:18
=============================================================================
Run Date: JUL 17, 2007                     Designation: IVM*2*124
Package : IVM - INCOME VERIFICATION MATCH     Priority: EMERGENCY
Version : 2       SEQ #104                      Status: Released
                  Compliance Date: JUL 18, 2007
=============================================================================

Associated patches: (v)IVM*2*105   <<= must be installed BEFORE `IVM*2*124'

Subject: PREVENT DELETION OF ADDRESS DURING Z05 UPLOAD

Category: 
  - PATCH FOR A PATCH
  - Routine

Description:
============

  
 I. OVERVIEW
  
 This patch corrects a problem found after the implementation of the 
 changes and enhancements to the Income Verification Match package v2.0 in 
 support of the Enrollment VistA Changes Release 1 project in patch 
 IVM*2*105.  The problem was related to the deletion of a patient's address
 when a Z05 from the HEC is uploaded for a patient with an active
 prescription.  The problem was restricted to a short timeframe beginning
 after the installation of the DG_53_653 hostfile which was released
 7/11/07 containing patch IVM*2*105 and ending when the HEC shut down their
 filers at approximately 8:30 am EDT on 7/12/06.
  
 NOTE:  This is being released as an Emergency patch due to Patient Safety 
 issues.
  
  
  
 II. ASSOCIATED REMEDY TICKETS & NEW SERVICE REQUESTS
  
 1. Associated Remedy Tickets:
    -----------------------------------------
    HD0000000198082 Patient Address is Deleted By Z05 Upload
    
 2. Associated New Service Request(s):
    -----------------------------------------
    NONE 
  
  
 III. FUNCTIONAL OVERVIEW
  
 Problem:
 When a Z05 is sent with an address change for a patient that has an active
 prescription, the old address is deleted but the new address is not added.
  
 Solution:
 Modifications were made to routine IVMLDEM6 to first check if patient has 
 an active prescription and, if so, do not delete the old address.
  
 The patient records that were affected by this problem can be identified 
 by running a Fileman report using the Search option.  See the 
 instructions in section VI below. 
               
 IV. TECHNICAL COMPONENTS
  
  
  ROUTINE SUMMARY:
  ================
  The following is a list of the routine(s) included in this patch.  The
  second line of each of these routine(s) will look like:
  
    OLD CHECKSUM METHOD RESULTS:
  
      <tab>;;5.3;Registration;**[patch list]**;Aug 13, 1993
  
                             CHECK^XTSUMBLD results
  
  Routine name   Before Patch   After Patch          Patch List
  ============   ============   ===========      ===================
  IVMLDEM6           13580976      13630191      10,58,73,79,108,106,
                                                       105,124
  
    
  
  
 V. INSTALLATION INSTRUCTIONS
  
 The IVM Background Job should have been unscheduled as per previous 
 instructions and remain unscheduled until further notice.
  
 This patch may be installed with users on the system.  The estimated 
 installation time is less than 5 minutes.
  
  
  
  Installation Steps:
  ===================
  
   1. Use the INSTALL/CHECK MESSAGE option on the PackMan menu to unload
      the KIDS distribution included with this message.
  
   2. From the 'Kernel Installation & Distribution System' menu, select the
      Installation menu.
  
   3. From this menu, you may now elect to use the following options (when
      prompted for INSTALL NAME, enter IVM*2.0*124).
  
      a. Backup a Transport Global - This option will create a backup
         message of any routines exported with the patch.  It will NOT
         backup any changes such as DDs or templates.
  
      b. Compare Transport Global to Current System - This option will
         allow you to view all changes that will be made when the patch is
         installed.  It compares all components of the patch (routines,
         DDs, templates, etc.).
  
      c. Verify Checksums in Transport Global - This option will allow you
         to ensure the integrity of the routines that are in the transport
         global.
          NOTE: This option may display an expected value of 60562553 for
          the Before checksum.  This is due to a problem in the National
          Patch Module on Forum.  Just verify that the After checksum is
          Correct.
  
      d. Print Transport Global - this option will allow you to view the
         components of the KIDS build.
  
   4. Use the Install Package(s) option and select package IVM*2.0*124.
  
   5. When prompted 'Want KIDS to INHIBIT LOGONs during the install?
      YES//', it is recommended you answer NO.
  
   6. When prompted to 'Want to DISABLE Scheduled Options, Menu Options,
      and Protocols? YES//', respond NO. 
  
  
 VI. IDENTIFYING THE AFFECTED PATIENT RECORDS
  
 A Fileman report can be run to identify the records in the Patient file 
 that may have had the address deleted.  This report can be given to the 
 ADPAC to use with the Demographics Upload option to restore the missing 
 addresses.
  
 Select VA FileMan (local) Option: SEARCH File Entries
  
 OUTPUT FROM WHAT FILE: PATIENT//
  
   -A- SEARCH FOR PATIENT FIELD: ADDRESS CHANGE USER
   -A- CONDITION: =  EQUALS
   -A- EQUALS NEW PERSON: POSTMASTER
  
   -B- SEARCH FOR PATIENT FIELD:    ADDRESS CHANGE USER
   -B- CONDITION: NULL
  
   -C- SEARCH FOR PATIENT FIELD:
  
 IF: A    ADDRESS CHANGE USER EQUALS .5 (POSTMASTER)
 OR: B     Or ADDRESS CHANGE USER NULL
 OR:
  
 STORE RESULTS OF SEARCH IN TEMPLATE:
  
 SORT BY: NAME// 'ADDRESS CHANGE DT/TM
 START WITH ADDRESS CHANGE DT/TM: FIRST// 7 11  (JUL 11, 2007)
 GO TO ADDRESS CHANGE DT/TM: LAST// 7 13  (JUL 13, 2007)
   WITHIN ADDRESS CHANGE DT/TM, SORT BY: 'STREET ADDRESS [LINE 1]
 START WITH STREET ADDRESS [LINE 1]: FIRST// @
   GO TO STREET ADDRESS [LINE 1]: LAST// @
     WITHIN STREET ADDRESS [LINE 1], SORT BY: @NAME
      1   NAME
      2   NAME COMPONENTS
 CHOOSE 1-2: 1  NAME
     START WITH NAME: FIRST//
       WITHIN NAME, SORT BY:
 STORE IN 'SORT' TEMPLATE: 
 FIRST PRINT FIELD: NAME
      1   NAME  
      2   NAME COMPONENTS  
 CHOOSE 1-2: 1  NAME
 THEN PRINT FIELD: SSN  SOCIAL SECURITY NUMBER
 THEN PRINT FIELD: ADDRESS CHANGE USER  
 THEN PRINT FIELD: 
 Heading (S/C): PATIENT SEARCH// 
 START AT PAGE: 1// 
 DEVICE:
  
 The output will look like this:
                                  SOCIAL
                                 SECURITY
 NAME                            NUMBER      ADDRESS CHANGE USER
 -----------------------------------------------------------------------
 PATIENT,NUMBER A                111111111   IVM AUTO ADDR JOB
 PATIENT,NUMBER B                222222222   IVM AUTO ADDR JOB
 PATIENT,NUMBER C                333333333   POSTMASTER
 PATIENT,NUMBER D                444444444   IVM AUTO ADDR JOB
 PATIENT,NUMBER E                555555555   POSTMASTER

Routine Information:
====================
The second line of each of these routines now looks like:
 ;;2.0;INCOME VERIFICATION MATCH;**[Patch List]**; 21-OCT-94;Build 1

The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: IVMLDEM6
    Before: B60562553   After: B62806178  **10,58,73,79,108,106,105,124**
 Description of Changes:
  AUTOADDR+19
  Before:
           N IVMFLAG,IVMI,IVMJ,IVMNODE,IVMPTR,Y
           ;
           ; - initialize flags
           S IVMFLAG=0
           S:'$G(NOUPDT) NOUPDT=0
           ;
           ; - check for required parameters
           Q:'$G(DFN) IVMFLAG
           ;
           N DGPRIOR D GETPRIOR^DGADDUTL(DFN,.DGPRIOR)
           I 'NOUPDT D EN^DGCLEAR(DFN) ;Deleting existing address before 
  updating
           
  After:
           N IVMFLAG,IVMI,IVMJ,IVMNODE,IVMPTR,Y,DELFLG
           ;
           ; - initialize flags
           S IVMFLAG=0,DELFLG=1
           ;
           ; - check for required parameters
           Q:'$G(DFN) IVMFLAG
           ;
           N DGPRIOR D GETPRIOR^DGADDUTL(DFN,.DGPRIOR)
           ; Set the flag to don't auto-update if there is an active 
  Prescription record 
           ; and the Bad Address Indicator is null
           I ('NOUPDT),$$PHARM(+DFN),'$$BADADR^DGUTL3(+DFN) S DELFLG=0
           I ('NOUPDT),DELFLG D EN^DGCLEAR(DFN) ;Deleting existing address 
  before update
           ;
   
   
  AUTOADDR+48
  Before:
           ..; don't auto-update if there is an active Prescription record 
  and
           ..; the Bad Address Indicator is null
           ..I ('NOUPDT),$$PHARM(+DFN),'$$BADADR^DGUTL3(+DFN) D 
  DEMBULL^IVMPREC6 Q
           ..;
   
  After:
           ..; don't auto-update if there is an active Prescription record 
  and
           ..; the Bad Address Indicator is null
           ..I 'DELFLG D DEMBULL^IVMPREC6 Q
           ..;

 
Routine list of preceding patches: 105

=============================================================================
User Information:
Entered By  : DESMOND,LINDA                 Date Entered  : JUL 12, 2007
Completed By: MOORE,TERRY D                 Date Completed: JUL 17, 2007
Released By : GANUS,MAUNETTE                Date Released : JUL 17, 2007
=============================================================================


Packman Mail Message:
=====================

$END TXT
