Released ECX*3*93 SEQ #87
Extracted from mail message
**KIDS**:ECX*3.0*93^

**INSTALL NAME**
ECX*3.0*93
"BLD",6681,0)
ECX*3.0*93^DSS EXTRACTS^0^3060418^y
"BLD",6681,1,0)
^^1^1^3060411^
"BLD",6681,1,1,0)
This patch provide a fix to routine ECXUSUR.
"BLD",6681,4,0)
^9.64PA^^
"BLD",6681,"KRN",0)
^9.67PA^8989.52^19
"BLD",6681,"KRN",.4,0)
.4
"BLD",6681,"KRN",.401,0)
.401
"BLD",6681,"KRN",.402,0)
.402
"BLD",6681,"KRN",.403,0)
.403
"BLD",6681,"KRN",.5,0)
.5
"BLD",6681,"KRN",.84,0)
.84
"BLD",6681,"KRN",3.6,0)
3.6
"BLD",6681,"KRN",3.8,0)
3.8
"BLD",6681,"KRN",9.2,0)
9.2
"BLD",6681,"KRN",9.8,0)
9.8
"BLD",6681,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6681,"KRN",9.8,"NM",1,0)
ECXUSUR^^0^B28206456
"BLD",6681,"KRN",9.8,"NM","B","ECXUSUR",1)

"BLD",6681,"KRN",19,0)
19
"BLD",6681,"KRN",19.1,0)
19.1
"BLD",6681,"KRN",101,0)
101
"BLD",6681,"KRN",409.61,0)
409.61
"BLD",6681,"KRN",771,0)
771
"BLD",6681,"KRN",870,0)
870
"BLD",6681,"KRN",8989.51,0)
8989.51
"BLD",6681,"KRN",8989.52,0)
8989.52
"BLD",6681,"KRN",8994,0)
8994
"BLD",6681,"KRN","B",.4,.4)

"BLD",6681,"KRN","B",.401,.401)

"BLD",6681,"KRN","B",.402,.402)

"BLD",6681,"KRN","B",.403,.403)

"BLD",6681,"KRN","B",.5,.5)

"BLD",6681,"KRN","B",.84,.84)

"BLD",6681,"KRN","B",3.6,3.6)

"BLD",6681,"KRN","B",3.8,3.8)

"BLD",6681,"KRN","B",9.2,9.2)

"BLD",6681,"KRN","B",9.8,9.8)

"BLD",6681,"KRN","B",19,19)

"BLD",6681,"KRN","B",19.1,19.1)

"BLD",6681,"KRN","B",101,101)

"BLD",6681,"KRN","B",409.61,409.61)

"BLD",6681,"KRN","B",771,771)

"BLD",6681,"KRN","B",870,870)

"BLD",6681,"KRN","B",8989.51,8989.51)

"BLD",6681,"KRN","B",8989.52,8989.52)

"BLD",6681,"KRN","B",8994,8994)

"BLD",6681,"QUES",0)
^9.62^^
"BLD",6681,"REQB",0)
^9.611^1^1
"BLD",6681,"REQB",1,0)
ECX*3.0*84^2
"BLD",6681,"REQB","B","ECX*3.0*84",1)

"MBREQ")
0
"PKG",535,-1)
1^1
"PKG",535,0)
DSS EXTRACTS^ECX
"PKG",535,20,0)
^9.402P^^
"PKG",535,22,0)
^9.49I^1^1
"PKG",535,22,1,0)
3.0^2971222^3000224^66481
"PKG",535,22,1,"PAH",1,0)
93^3060418
"PKG",535,22,1,"PAH",1,1,0)
^^1^1^3060418
"PKG",535,22,1,"PAH",1,1,1,0)
This patch provide a fix to routine ECXUSUR.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ECXUSUR")
0^1^B28206456^B28150599
"RTN","ECXUSUR",1,0)
ECXUSUR ;ALB/TJL-Surgery Extract Unusual Volume Report ; 4/11/06 10:44AM
"RTN","ECXUSUR",2,0)
 ;;3.0;DSS EXTRACTS;**49,71,84,93**;July 1, 2003
"RTN","ECXUSUR",3,0)
 ;
"RTN","ECXUSUR",4,0)
EN ; entry point
"RTN","ECXUSUR",5,0)
 N X,Y,DATE,ECRUN,ECXDESC,ECXSAVE,ECXTL,ECTHLD
"RTN","ECXUSUR",6,0)
 N ECSD,ECSD1,ECSTART,ECED,ECEND,ECXERR,QFLG,ECXFLAG
"RTN","ECXUSUR",7,0)
 S QFLG=0,ECTHLD="",ECXFLAG=$G(FLAG)
"RTN","ECXUSUR",8,0)
 ; get today's date
"RTN","ECXUSUR",9,0)
 D NOW^%DTC S DATE=X,Y=$E(%,1,12) D DD^%DT S ECRUN=$P(Y,"@") K %DT
"RTN","ECXUSUR",10,0)
 I 'ECXFLAG D BEGIN Q:QFLG
"RTN","ECXUSUR",11,0)
 D SELECT Q:QFLG
"RTN","ECXUSUR",12,0)
 S ECXDESC=$S(ECXFLAG:"SUR Volume Report",1:"Surgery Extract Unusual Volume Report")
"RTN","ECXUSUR",13,0)
 S ECXSAVE("EC*")=""
"RTN","ECXUSUR",14,0)
 W !!,"This report requires 132-column format."
"RTN","ECXUSUR",15,0)
 D EN^XUTMDEVQ("PROCESS^ECXUSUR",ECXDESC,.ECXSAVE)
"RTN","ECXUSUR",16,0)
 I POP W !!,"No device selected...exiting.",! Q
"RTN","ECXUSUR",17,0)
 I IO'=IO(0) D ^%ZISC
"RTN","ECXUSUR",18,0)
 D HOME^%ZIS
"RTN","ECXUSUR",19,0)
 D AUDIT^ECXKILL
"RTN","ECXUSUR",20,0)
 Q
"RTN","ECXUSUR",21,0)
 ;
"RTN","ECXUSUR",22,0)
BEGIN ; display report description
"RTN","ECXUSUR",23,0)
 W @IOF
"RTN","ECXUSUR",24,0)
 W !,"This report prints a listing of unusual volumes that would be"
"RTN","ECXUSUR",25,0)
 W !,"generated by the Surgery extract (SUR) as determined by a"
"RTN","ECXUSUR",26,0)
 W !,"user-defined threshold value.  It should be run prior to the"
"RTN","ECXUSUR",27,0)
 W !,"generation of the actual extract(s) to identify and fix, as"
"RTN","ECXUSUR",28,0)
 W !,"necessary, any volumes determined to be erroneous."
"RTN","ECXUSUR",29,0)
 W !!,"Unusual volumes are those where either the Operation Time,"
"RTN","ECXUSUR",30,0)
 W !,"Patient Time, Anesthesia Time, Recovery Room Time, OR Clean Time"
"RTN","ECXUSUR",31,0)
 W !,"or Pt Holding Time field is greater than the threshold value."
"RTN","ECXUSUR",32,0)
 W !!,"Note: The threshold can be set after a report is selected."
"RTN","ECXUSUR",33,0)
 W !!,"Run times for this report will vary depending upon the size of"
"RTN","ECXUSUR",34,0)
 W !,"the extract and could take as long as 30 minutes or more to"
"RTN","ECXUSUR",35,0)
 W !,"complete.  This report has no effect on the actual extracts and"
"RTN","ECXUSUR",36,0)
 W !,"can be run as needed."
"RTN","ECXUSUR",37,0)
 W !!,"The report is sorted by descending Volume and Case Number."
"RTN","ECXUSUR",38,0)
 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","ECXUSUR",39,0)
 W:$Y!($E(IOST)="C") @IOF,!!
"RTN","ECXUSUR",40,0)
 Q
"RTN","ECXUSUR",41,0)
 ;
"RTN","ECXUSUR",42,0)
SELECT ; user inputs for threshold volume and date range
"RTN","ECXUSUR",43,0)
 N DONE,OUT
"RTN","ECXUSUR",44,0)
 ; allow user to set threshold volume
"RTN","ECXUSUR",45,0)
 I 'ECXFLAG D
"RTN","ECXUSUR",46,0)
 .S ECTHLD=25
"RTN","ECXUSUR",47,0)
 .W !!,"The default threshold volume for the Surgery extract is "_ECTHLD_"."
"RTN","ECXUSUR",48,0)
 .W !,"The default threshold volume ("_ECTHLD_") equates to 6 hours."
"RTN","ECXUSUR",49,0)
 .S DIR(0)="Y",DIR("A")="Would you like to change the threshold?",DIR("B")="NO" D ^DIR K DIR I X["^" S QFLG=1 Q
"RTN","ECXUSUR",50,0)
 .I Y D
"RTN","ECXUSUR",51,0)
 ..W !!,"Volume > threshold"
"RTN","ECXUSUR",52,0)
 ..S DIR(0)="N^0:99",DIR("A")="Enter the new threshold volume" D ^DIR K DIR S ECTHLD=Y I X["^" S QFLG=1 Q
"RTN","ECXUSUR",53,0)
 ; get date range from user
"RTN","ECXUSUR",54,0)
 Q:QFLG
"RTN","ECXUSUR",55,0)
 W !!,"Enter the date range for which you would like to scan the"
"RTN","ECXUSUR",56,0)
 W !,"Surgery Extract records.",!
"RTN","ECXUSUR",57,0)
 S DONE=0 F  S (ECED,ECSD)="" D  Q:QFLG!DONE
"RTN","ECXUSUR",58,0)
 .K %DT S %DT="AEX",%DT("A")="Starting with Date: ",%DT(0)=-DATE D ^%DT
"RTN","ECXUSUR",59,0)
 .I Y<0 S QFLG=1 Q
"RTN","ECXUSUR",60,0)
 .S ECSD=Y,ECSD1=ECSD-.1
"RTN","ECXUSUR",61,0)
 .D DD^%DT S ECSTART=Y
"RTN","ECXUSUR",62,0)
 .K %DT S %DT="AEX",%DT("A")="Ending with Date: ",%DT(0)=-DATE D ^%DT
"RTN","ECXUSUR",63,0)
 .I Y<0 S QFLG=1 Q
"RTN","ECXUSUR",64,0)
 .I Y<ECSD D  Q
"RTN","ECXUSUR",65,0)
 ..W !!,"The ending date cannot be earlier than the starting date."
"RTN","ECXUSUR",66,0)
 ..W !,"Please try again.",!!
"RTN","ECXUSUR",67,0)
 .I $E(Y,1,5)'=$E(ECSD,1,5) D  Q
"RTN","ECXUSUR",68,0)
 ..W !!,"Beginning and ending dates must be in the same month and year"
"RTN","ECXUSUR",69,0)
 ..W !,"Please try again.",!!
"RTN","ECXUSUR",70,0)
 .S ECED=Y
"RTN","ECXUSUR",71,0)
 .D DD^%DT S ECEND=Y
"RTN","ECXUSUR",72,0)
 .S DONE=1
"RTN","ECXUSUR",73,0)
 Q
"RTN","ECXUSUR",74,0)
 ;
"RTN","ECXUSUR",75,0)
PROCESS ; entry point for queued report
"RTN","ECXUSUR",76,0)
 S ZTREQ="@"
"RTN","ECXUSUR",77,0)
 S ECXERR=0 D EN^ECXUSUR1 Q:ECXERR
"RTN","ECXUSUR",78,0)
 S QFLG=0 D PRINT
"RTN","ECXUSUR",79,0)
 Q
"RTN","ECXUSUR",80,0)
 ;
"RTN","ECXUSUR",81,0)
PRINT ; process temp file and print report
"RTN","ECXUSUR",82,0)
 N PG,QFLG,GTOT,LN,COUNT,VOL,SUB,REC
"RTN","ECXUSUR",83,0)
 U IO
"RTN","ECXUSUR",84,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1 K ZTREQ Q
"RTN","ECXUSUR",85,0)
 S (PG,QFLG,GTOT,COUNT)=0,$P(LN,"-",132)=""
"RTN","ECXUSUR",86,0)
 D HEADER Q:QFLG
"RTN","ECXUSUR",87,0)
 S VOL=-999999 F  S VOL=$O(^TMP($J,VOL)) Q:VOL=""!QFLG  D
"RTN","ECXUSUR",88,0)
 .S SUB="" F  S SUB=$O(^TMP($J,VOL,SUB)) Q:SUB=""!QFLG  S REC=^(SUB)  D
"RTN","ECXUSUR",89,0)
 ..S COUNT=COUNT+1
"RTN","ECXUSUR",90,0)
 ..I $Y+3>IOSL D HEADER Q:QFLG
"RTN","ECXUSUR",91,0)
 ..W !,$P(REC,U),?6,$P(REC,U,2),?17,$P(REC,U,3),?26,$P(REC,U,4)
"RTN","ECXUSUR",92,0)
 ..W ?33,$P(REC,U,5),?55,$$RJ^XLFSTR($P(REC,U,9),4)
"RTN","ECXUSUR",93,0)
 ..W ?63,$$RJ^XLFSTR($P(REC,U,10),4),?74,$$RJ^XLFSTR($P(REC,U,11),4)
"RTN","ECXUSUR",94,0)
 ..W ?83,$$RJ^XLFSTR($P(REC,U,6),4),?90,$$RJ^XLFSTR($P(REC,U,8),4)
"RTN","ECXUSUR",95,0)
 ..W ?101,$$RJ^XLFSTR($P(REC,U,7),4),?114,$P(REC,U,13)
"RTN","ECXUSUR",96,0)
 Q:QFLG
"RTN","ECXUSUR",97,0)
 I COUNT=0 W !!,?8,$S(ECXFLAG=1:"No surgery volumes to report for this extract",1:"No unusual volumes to report for this extract")
"RTN","ECXUSUR",98,0)
CLOSE ;
"RTN","ECXUSUR",99,0)
 I $E(IOST)="C",'QFLG D
"RTN","ECXUSUR",100,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXUSUR",101,0)
 .S DIR(0)="E" W ! D ^DIR K DIR
"RTN","ECXUSUR",102,0)
 Q
"RTN","ECXUSUR",103,0)
 ;
"RTN","ECXUSUR",104,0)
HEADER ;header and page control
"RTN","ECXUSUR",105,0)
 N SS,JJ
"RTN","ECXUSUR",106,0)
 I $E(IOST)="C" D
"RTN","ECXUSUR",107,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXUSUR",108,0)
 .I PG>0 S DIR(0)="E" W ! D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXUSUR",109,0)
 Q:QFLG
"RTN","ECXUSUR",110,0)
 W:$Y!($E(IOST)="C") @IOF S PG=PG+1
"RTN","ECXUSUR",111,0)
 W !,$S(ECXFLAG:"SUR Volume Report",1:"Surgery Extract Unusual Volume Report"),?124,"Page: "_PG
"RTN","ECXUSUR",112,0)
 W !,"Start Date: ",ECSTART,?97,"Report Run Date/Time: "_ECRUN
"RTN","ECXUSUR",113,0)
 W !,"  End Date: ",ECEND I 'ECXFLAG W ?97,"     Threshold Value: ",ECTHLD
"RTN","ECXUSUR",114,0)
 W !!,?27,"Case",?37,"Encounter",?53,"Patient",?61,"Operation",?71,"Anesthesia",?83,"PACU",?89,"OR Clean",?99,"Pt Holding",?114,"Principal"
"RTN","ECXUSUR",115,0)
 W !,"Name",?9,"SSN",?19,"Day",?26,"Number",?39,"Number"
"RTN","ECXUSUR",116,0)
 W ?55,"Time",?63,"Time",?74,"Time",?83,"Time",?90,"Time",?101,"Time"
"RTN","ECXUSUR",117,0)
 W ?114,"Procedure"
"RTN","ECXUSUR",118,0)
 W !,LN,!
"RTN","ECXUSUR",119,0)
 Q
"RTN","ECXUSUR",120,0)
 ;
"VER")
8.0^22.0
"BLD",6681,6)
^87
**END**
**END**
