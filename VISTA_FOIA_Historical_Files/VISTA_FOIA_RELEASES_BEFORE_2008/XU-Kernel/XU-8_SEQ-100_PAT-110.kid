Released XU*8*110 SEQ #100
Extracted from mail message
**KIDS**:XU*8.0*110^

**INSTALL NAME**
XU*8.0*110
"BLD",124,0)
XU*8.0*110^KERNEL^0^^y
"BLD",124,1,0)
^^1^1^2990126^
"BLD",124,1,1,0)
See Patch Module for details.
"BLD",124,4,0)
^9.64PA^^
"BLD",124,"KRN",0)
^9.67PA^19^18
"BLD",124,"KRN",.4,0)
.4
"BLD",124,"KRN",.401,0)
.401
"BLD",124,"KRN",.402,0)
.402
"BLD",124,"KRN",.403,0)
.403
"BLD",124,"KRN",.5,0)
.5
"BLD",124,"KRN",.84,0)
.84
"BLD",124,"KRN",3.6,0)
3.6
"BLD",124,"KRN",3.8,0)
3.8
"BLD",124,"KRN",9.2,0)
9.2
"BLD",124,"KRN",9.8,0)
9.8
"BLD",124,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",124,"KRN",9.8,"NM",1,0)
XQCHK^^0^B70122209
"BLD",124,"KRN",9.8,"NM","B","XQCHK",1)

"BLD",124,"KRN",19,0)
19
"BLD",124,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",124,"KRN",19,"NM",1,0)
XUMAINT^^2
"BLD",124,"KRN",19,"NM",2,0)
XQOPACCESS^^0
"BLD",124,"KRN",19,"NM","B","XQOPACCESS",2)

"BLD",124,"KRN",19,"NM","B","XUMAINT",1)

"BLD",124,"KRN",19.1,0)
19.1
"BLD",124,"KRN",101,0)
101
"BLD",124,"KRN",409.61,0)
409.61
"BLD",124,"KRN",771,0)
771
"BLD",124,"KRN",869.2,0)
869.2
"BLD",124,"KRN",870,0)
870
"BLD",124,"KRN",8994,0)
8994
"BLD",124,"KRN","B",.4,.4)

"BLD",124,"KRN","B",.401,.401)

"BLD",124,"KRN","B",.402,.402)

"BLD",124,"KRN","B",.403,.403)

"BLD",124,"KRN","B",.5,.5)

"BLD",124,"KRN","B",.84,.84)

"BLD",124,"KRN","B",3.6,3.6)

"BLD",124,"KRN","B",3.8,3.8)

"BLD",124,"KRN","B",9.2,9.2)

"BLD",124,"KRN","B",9.8,9.8)

"BLD",124,"KRN","B",19,19)

"BLD",124,"KRN","B",19.1,19.1)

"BLD",124,"KRN","B",101,101)

"BLD",124,"KRN","B",409.61,409.61)

"BLD",124,"KRN","B",771,771)

"BLD",124,"KRN","B",869.2,869.2)

"BLD",124,"KRN","B",870,870)

"BLD",124,"KRN","B",8994,8994)

"BLD",124,"QUES",0)
^9.62^^
"KRN",19,8,-1)
2^1
"KRN",19,8,0)
XUMAINT^Menu Management^^M^.5^^14^^^n^n^^n^^^^
"KRN",19,8,10,0)
^19.01PI^22^22
"KRN",19,8,10,22,0)
746
"KRN",19,8,10,22,"^")
XQOPACCESS
"KRN",19,8,"U")
MENU MANAGEMENT
"KRN",19,746,-1)
0^2
"KRN",19,746,0)
XQOPACCESS^See if a User Has Access to a Particular Option^^R^^^^^^^y^^y
"KRN",19,746,1,0)
^^4^4^2981222^
"KRN",19,746,1,1,0)
     This option prompts for an option name and the name of a user and
"KRN",19,746,1,2,0)
then searches the users menu tree(s) to see if the user has access to the
"KRN",19,746,1,3,0)
option.  It also checks to see if the user has the key for a locked
"KRN",19,746,1,4,0)
option.
"KRN",19,746,25)
OPACCES^XQCHK
"KRN",19,746,"U")
SEE IF A USER HAS ACCESS TO A 
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
110
"PKG",3,22,1,"PAH",1,1,0)
^^1^1^2990301
"PKG",3,22,1,"PAH",1,1,1,0)
See Patch Module for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XQCHK")
0^1^B70122209
"RTN","XQCHK",1,0)
XQCHK ; SEA/MJM - Check security on option # XQCY ;03/01/99  11:25
"RTN","XQCHK",2,0)
 ;;8.0;KERNEL;**47,110**;Jul 10, 1995
"RTN","XQCHK",3,0)
 Q:'$D(XQCY)!(XQCY<1)  S:'$D(XQJMP) XQJMP=0
"RTN","XQCHK",4,0)
 I '$D(XQY0) S XQY0=^DIC(19,+XQCY,0)
"RTN","XQCHK",5,0)
 I '$D(XQCY0) S XQSAV=XQY0,XQY=XQCY D SET Q:XQCY<0  S XQCY0=XQY0,XQY0=XQSAV
"RTN","XQCHK",6,0)
CHK I XQCY0="" S XQCY=-1 G OUT
"RTN","XQCHK",7,0)
 I $P(XQCY0,U,3)'="" S XQCY=-1 G OUT
"RTN","XQCHK",8,0)
 I $L($P(XQCY0,U,6)) S %="" F %XQI=1:1 S %=$P($P(XQCY0,U,6),",",%XQI) Q:%=""  I '$D(^XUSEC(%,DUZ)) S XQCY=-2 G OUT
"RTN","XQCHK",9,0)
 I $L($P(XQCY0,U,16)) S %="" F %XQI=1:1 S %=$P($P(XQCY0,U,16),",",%XQI) Q:%=""  I $D(^XUSEC(%,DUZ)) S XQCY=-3 G OUT
"RTN","XQCHK",10,0)
 I $L($P(XQCY0,U,9)) S XQZ=$P(XQCY0,U,9) D ^XQDATE S X=% D XQO^XQ92 I X="" S XQCY=-4 G OUT
"RTN","XQCHK",11,0)
 G:$P(XQCY0,U,10)'["y" OUT
"RTN","XQCHK",12,0)
 S %=0 F %XQI=1:1 S %=$O(^DIC(19,XQCY,3.96,%,0)) Q:%=""  I IOS=% G OUT
"RTN","XQCHK",13,0)
 S XQCY=-5 G OUT
"RTN","XQCHK",14,0)
 Q
"RTN","XQCHK",15,0)
 ;
"RTN","XQCHK",16,0)
OUT K %,%XQI,XQCY0,%Y,XQZ
"RTN","XQCHK",17,0)
 Q
"RTN","XQCHK",18,0)
 ;
"RTN","XQCHK",19,0)
JMP ;Check all options in jump path in %XQJP returned as "" if not OK
"RTN","XQCHK",20,0)
 S XQJMP=1
"RTN","XQCHK",21,0)
 F %XQCI=1:1 S XQCY=$P(%XQJP,",",%XQCI) Q:XQCY=""  S XQCY0=$G(^XUTL("XQO",XQDIC,"^",XQCY)),XQCY0=$P(XQCY0,U,2,99) D CHK S:XQCY<0 %XQJP=""
"RTN","XQCHK",22,0)
 K %XQCI,XQCY,XQCY0
"RTN","XQCHK",23,0)
 Q
"RTN","XQCHK",24,0)
 ;
"RTN","XQCHK",25,0)
SET ;Produce the same XQY0 as SET1^XQ7 without the synonym
"RTN","XQCHK",26,0)
 I '$D(^DIC(19,+XQY,0)) S XQY=-1 Q
"RTN","XQCHK",27,0)
S1 Q:XQY'>0  S XQY0=^DIC(19,+XQY,0),XQY0=$P(XQY0,U,1,2)_U_$S($P(XQY0,U,3)]"":1,1:"")_U_$P(XQY0,U,4)_U_U_$P(XQY0,U,6,99)
"RTN","XQCHK",28,0)
 S %="" I $D(^DIC(19,+XQY,3.91)) F %XQI=0:0 S %XQI=$O(^DIC(19,+XQY,3.91,%XQI)) Q:%XQI=""!(%XQI'=+%XQI)  I ^(%XQI,0)]"" S %=$S(%'="":%_";",1:"")_$P(^(0),U,1)_$P(^(0),U,2)
"RTN","XQCHK",29,0)
 I %]"" S XQY0=$P(XQY0,U,1,8)_U_%_U_$P(XQY0,U,10,99)
"RTN","XQCHK",30,0)
 I $P(XQY0,U,16),$D(^DIC(19,XQY,3)) S %=$P(^(3),U) I %'="" S XQY0=$P(XQY0,U,1,15)_U_%_U_$P(XQY0,U,17,99)
"RTN","XQCHK",31,0)
 K %,%XQI
"RTN","XQCHK",32,0)
 Q
"RTN","XQCHK",33,0)
 ;
"RTN","XQCHK",34,0)
MES ;Messages for rejected options from a call to XQCHK
"RTN","XQCHK",35,0)
 W *7
"RTN","XQCHK",36,0)
 I XQCY=-1 W !!?5,"==> Sorry, ",$S($D(XQPRMN):"your Primary Menu",1:"this option")," is out of order with the message:",!?10,$P(^DIC(19,XQY,0),U,3)
"RTN","XQCHK",37,0)
 I XQCY=-2 W !!?5,"==> Sorry, ",$S($D(XQPRMN):"your Primary Menu",1:"this option")," is locked."
"RTN","XQCHK",38,0)
 I XQCY=-3 W !!?5,"==> Sorry, ",$S($D(XQPRMN):"your Primary Menu",1:"this option")," has a reverse lock on it."
"RTN","XQCHK",39,0)
 I XQCY=-4 W !!?5,"==> Sorry, ",$S($D(XQPRMN):"your Primary Menu",1:"this option")," not allowed right now."
"RTN","XQCHK",40,0)
 I XQCY=-5 W !!?5,"==> Sorry, ",$S($D(XQPRMN):"your Primary Menu",1:"this option")," not allowed on this device."
"RTN","XQCHK",41,0)
 Q
"RTN","XQCHK",42,0)
 ;
"RTN","XQCHK",43,0)
OP ;Find out what option or protocol is in charge right now
"RTN","XQCHK",44,0)
 ;Returns option or protocol name and text in XQOPT
"RTN","XQCHK",45,0)
 S U="^",%XQ=0
"RTN","XQCHK",46,0)
 I $D(XQORNOD) S %XQ=+XQORNOD,%XQ1=U_$P(XQORNOD,";",2),%XQ=@(%XQ1_%XQ_",0)"),XQOPT=$P(%XQ,U)_U_$P(%XQ,U,2)
"RTN","XQCHK",47,0)
 I '$D(XQORNOD) S %XQ=$S($D(XQY)#2:XQY,1:0) I %XQ S %XQ1=^DIC(19,+%XQ,0),XQOPT=$P(%XQ1,U)_U_$P(%XQ1,U,2)
"RTN","XQCHK",48,0)
 I '$D(XQOPT) S XQOPT="-1^Unknown"
"RTN","XQCHK",49,0)
 K %XQ,%XQ1
"RTN","XQCHK",50,0)
 Q
"RTN","XQCHK",51,0)
 ;
"RTN","XQCHK",52,0)
OP1() ;Extrinsic function call returns 3 pieces: 1. "P", "O", or "U" for
"RTN","XQCHK",53,0)
 ;Protocol, Option, or Unknown.  2: The Option or Protocol's name. 3:
"RTN","XQCHK",54,0)
 ;3: Text name of the Protocol or Option.  For example:
"RTN","XQCHK",55,0)
 ;
"RTN","XQCHK",56,0)
 ;           O^EVE^System Manager's Menu
"RTN","XQCHK",57,0)
 ;
"RTN","XQCHK",58,0)
 N %,%XQ,%XQ1
"RTN","XQCHK",59,0)
 S U="^",%XQ=0
"RTN","XQCHK",60,0)
 I $D(XQORNOD) S %XQ=+XQORNOD,%XQ1=U_$P(XQORNOD,";",2),%XQ=@(%XQ1_%XQ_",0)"),%="P"_U_$P(%XQ,U)_U_$P(%XQ,U,2)
"RTN","XQCHK",61,0)
 I '$D(XQORNOD) S %XQ=$S($D(XQY)#2:XQY,1:0) I %XQ S %XQ1=^DIC(19,+%XQ,0),%="O"_U_$P(%XQ1,U)_U_$P(%XQ1,U,2)
"RTN","XQCHK",62,0)
 I '$D(%) S %="U"_U_"Unknown"_U_"No option or protocol data available"
"RTN","XQCHK",63,0)
 Q %
"RTN","XQCHK",64,0)
 ;
"RTN","XQCHK",65,0)
 ;
"RTN","XQCHK",66,0)
ACCESS(%XQUSR,%XQOP) ;Find out if a user has access to a particular option
"RTN","XQCHK",67,0)
 ;
"RTN","XQCHK",68,0)
 ;    W $$ACCESS(DUZ,Option IEN) returns:
"RTN","XQCHK",69,0)
 ;
"RTN","XQCHK",70,0)
 ;-1:no such user in the New Person File
"RTN","XQCHK",71,0)
 ;-2: User terminated or has no access code
"RTN","XQCHK",72,0)
 ;-3: no such option in the Option File
"RTN","XQCHK",73,0)
 ;0: no access found in any menu tree the user owns
"RTN","XQCHK",74,0)
 ;
"RTN","XQCHK",75,0)
 ;    All other cases return a 4-piece string stating
"RTN","XQCHK",76,0)
 ;    access ^ menu tree IEN ^ a set of codes ^ key
"RTN","XQCHK",77,0)
 ;
"RTN","XQCHK",78,0)
 ;O^tree^codes^key: No access because of locks (see XQCODES below)
"RTN","XQCHK",79,0)
 ;  where 'tree' is the menu where access WOULD be allowed
"RTN","XQCHK",80,0)
 ;  and 'key' is the key preventing access
"RTN","XQCHK",81,0)
 ;1^OpIEN^^: Access allowed through Primary Menu
"RTN","XQCHK",82,0)
 ;2^OpIEN^codes^: Access found in the Common Options
"RTN","XQCHK",83,0)
 ;3^OpIEN^codes^: Access found in top level of secondary option
"RTN","XQCHK",84,0)
 ;4^OpIEN^codes^: Access through a the secondary menu tree OpIEN.
"RTN","XQCHK",85,0)
 ;
"RTN","XQCHK",86,0)
 ;XQCODES can contain:
"RTN","XQCHK",87,0)
 ;  N=No Primary Menu in the User File (warning only)
"RTN","XQCHK",88,0)
 ;  L=Locked and the user does not have the key (forces 0 in first piece)
"RTN","XQCHK",89,0)
 ;  R=Reverse lock and user has the key (forces 0 in first piece)
"RTN","XQCHK",90,0)
 ;
"RTN","XQCHK",91,0)
 I '$D(^VA(200,%XQUSR,0)) Q -1
"RTN","XQCHK",92,0)
 N %,DT
"RTN","XQCHK",93,0)
 S DT=$$HTFM^XLFDT($H,1)
"RTN","XQCHK",94,0)
 S %=^VA(200,%XQUSR,0) I ($P(%,U,3)']"")!($L($P(%,U,11))&($P(%,U,11)'>DT)) Q -2
"RTN","XQCHK",95,0)
 ;
"RTN","XQCHK",96,0)
 ;Convert %XQOP to its IEN if the name is passed
"RTN","XQCHK",97,0)
 I +%XQOP'=%XQOP D
"RTN","XQCHK",98,0)
 .I $D(^DIC(19,"B",%XQOP))<1 S %XQOP=0 Q
"RTN","XQCHK",99,0)
 .E  S %XQOP=$O(^DIC(19,"B",%XQOP,0))
"RTN","XQCHK",100,0)
 .Q
"RTN","XQCHK",101,0)
 I '%XQOP Q -3
"RTN","XQCHK",102,0)
 I '$D(^DIC(19,%XQOP,0)) Q -3
"RTN","XQCHK",103,0)
 ;
"RTN","XQCHK",104,0)
 N XQCODES,XQCOM,XQDIC,XQDONE,XQI,XQJ,XQKEY,XQOK,XQPM,XQRSLT,XQSEC,XQTREE
"RTN","XQCHK",105,0)
 S (%,XQDONE,XQOK)=0,(XQRSLT,XQCODES,XQTREE)=""
"RTN","XQCHK",106,0)
 ;
"RTN","XQCHK",107,0)
 ;
"RTN","XQCHK",108,0)
 ;Look in the user's primary menu tree
"RTN","XQCHK",109,0)
 S XQPM=$G(^VA(200,%XQUSR,201))
"RTN","XQCHK",110,0)
 I 'XQPM S XQCODES=XQCODES_"N"
"RTN","XQCHK",111,0)
 ;
"RTN","XQCHK",112,0)
 I XQPM S XQDIC="P"_XQPM I $D(^XUTL("XQO",XQDIC,"^",%XQOP)) D
"RTN","XQCHK",113,0)
 .D KEYS
"RTN","XQCHK",114,0)
 .I XQCODES'["L"&(XQCODES'["M") S XQOK=1
"RTN","XQCHK",115,0)
 .Q
"RTN","XQCHK",116,0)
 I XQOK Q "1^"_XQPM_"^"_XQCODES
"RTN","XQCHK",117,0)
 I XQCODES["L"!(XQCODES["R") S XQRSLT="0^"_XQPM_"^"_XQCODES_"^"_XQKEY
"RTN","XQCHK",118,0)
 ;
"RTN","XQCHK",119,0)
 ; Search the common options
"RTN","XQCHK",120,0)
 S XQCOM=$O(^DIC(19,"B","XUCOMMAND",0))
"RTN","XQCHK",121,0)
 S XQDIC="PXU"
"RTN","XQCHK",122,0)
 I $D(^XUTL("XQO",XQDIC,"^",%XQOP)) D
"RTN","XQCHK",123,0)
 .D KEYS
"RTN","XQCHK",124,0)
 .I XQCODES'["L"&(XQCODES'["R") S XQOK=1
"RTN","XQCHK",125,0)
 .Q
"RTN","XQCHK",126,0)
 I XQOK Q "2^"_XQCOM_"^"_XQCODES
"RTN","XQCHK",127,0)
 I XQRSLT="" I XQCODES["L"!(XQCODES["R") S XQRSLT="0^"_XQCOM_"^"_XQCODES_"^"_XQKEY
"RTN","XQCHK",128,0)
 ;
"RTN","XQCHK",129,0)
 ;Check the top level of the secondary options
"RTN","XQCHK",130,0)
 S XQDIC="U"_%XQUSR
"RTN","XQCHK",131,0)
 I $D(^VA(200,%XQUSR,203,0)),$P(^(0),U,4)>0 D
"RTN","XQCHK",132,0)
 .S XQJ=0,XQDONE=0
"RTN","XQCHK",133,0)
 .F XQI=1:1 D  Q:XQDONE
"RTN","XQCHK",134,0)
 ..S XQJ=$O(^VA(200,%XQUSR,203,XQJ))
"RTN","XQCHK",135,0)
 ..I (XQJ'=+XQJ)!('XQJ) S XQDONE=1 Q
"RTN","XQCHK",136,0)
 ..S XQSEC(XQI)=+^VA(200,%XQUSR,203,XQJ,0)
"RTN","XQCHK",137,0)
 ..Q:XQSEC(XQI)'=%XQOP
"RTN","XQCHK",138,0)
 ..D KEYS
"RTN","XQCHK",139,0)
 ..I XQCODES'["L"&(XQCODES'["R") S XQOK=1
"RTN","XQCHK",140,0)
 ..I XQRSLT="" I XQCODES["L"!(XQCODES["R") S XQRSLT="0^"_XQSEC(XQI)_"^"_XQCODES_"^"_XQKEY
"RTN","XQCHK",141,0)
 ..Q
"RTN","XQCHK",142,0)
 .Q
"RTN","XQCHK",143,0)
 I XQOK Q "3^"_%XQOP_"^"_XQCODES
"RTN","XQCHK",144,0)
 ;
"RTN","XQCHK",145,0)
 ;If there are no secondaries quit here
"RTN","XQCHK",146,0)
 I '$D(XQI)&((XQCODES["L")!(XQCODES["R")) Q XQRSLT
"RTN","XQCHK",147,0)
 I '$D(XQI) Q 0
"RTN","XQCHK",148,0)
 ;
"RTN","XQCHK",149,0)
 ;Check each secondary menu tree
"RTN","XQCHK",150,0)
 F XQK=1:1:XQI-1 Q:XQOK  D
"RTN","XQCHK",151,0)
 .S XQDIC="P"_XQSEC(XQK)
"RTN","XQCHK",152,0)
 .Q:'$D(^XUTL("XQO",XQDIC,"^",%XQOP))
"RTN","XQCHK",153,0)
 .S XQTREE=$P(XQDIC,"P",2)
"RTN","XQCHK",154,0)
 .D KEYS
"RTN","XQCHK",155,0)
 .I XQCODES'["L"&(XQCODES'["R") S XQOK=1
"RTN","XQCHK",156,0)
 .I XQRSLT="" I XQCODES["L"!(XQCODES["R") S XQRSLT="0^"_XQTREE_"^"_XQCODES_"^"_XQKEY
"RTN","XQCHK",157,0)
 .Q
"RTN","XQCHK",158,0)
 I XQOK Q "4^"_XQTREE_"^"_XQCODES
"RTN","XQCHK",159,0)
 I XQRSLT]"" Q XQRSLT
"RTN","XQCHK",160,0)
 ;
"RTN","XQCHK",161,0)
 ;We doan find nothing nowhere
"RTN","XQCHK",162,0)
 Q "0^^"_XQCODES
"RTN","XQCHK",163,0)
 ;
"RTN","XQCHK",164,0)
KEYS ;Check for keys, reverse keys...
"RTN","XQCHK",165,0)
 N XQK,XQN,XQOPIQ
"RTN","XQCHK",166,0)
 I $D(^XUTL("XQO",XQDIC,"^",%XQOP)) S XQOPIQ=^(%XQOP)
"RTN","XQCHK",167,0)
 E  S XQOPIQ=U_^DIC(19,%XQOP,0)
"RTN","XQCHK",168,0)
 ;
"RTN","XQCHK",169,0)
 I $P(XQOPIQ,U,7)]"" D
"RTN","XQCHK",170,0)
 .S %=$P(XQOPIQ,U,7)
"RTN","XQCHK",171,0)
 .F XQN=1:1 S XQK=$P(%,",",XQN) Q:XQK=""  D
"RTN","XQCHK",172,0)
 ..I '$D(^XUSEC(XQK,%XQUSR)) S XQCODES=XQCODES_"L",XQKEY=XQK
"RTN","XQCHK",173,0)
 ..Q
"RTN","XQCHK",174,0)
 .Q
"RTN","XQCHK",175,0)
 ;
"RTN","XQCHK",176,0)
 I $P(XQOPIQ,U,17)]"" D
"RTN","XQCHK",177,0)
 .S %=$P(XQOPIQ,U,17)
"RTN","XQCHK",178,0)
 .F XQN=1:1 S XQK=$P(%,",",XQN) Q:XQK=""  D
"RTN","XQCHK",179,0)
 ..I $D(^XUSEC(XQK,%XQUSR)) S XQCODES=XQCODES_"R",XQKEY=XQK
"RTN","XQCHK",180,0)
 ..Q
"RTN","XQCHK",181,0)
 .Q
"RTN","XQCHK",182,0)
 Q
"RTN","XQCHK",183,0)
 ;
"RTN","XQCHK",184,0)
OPACCES ;Entry point for the option that checks to see if a user has
"RTN","XQCHK",185,0)
 ;access to a particular option by calling the above function.
"RTN","XQCHK",186,0)
 N %,DIC,X,XQANS,XQCODES,XQK,XQKEY,XQOPT,XQOPN,XQPTR,XQRSLT,XQTREE,XQUSER,XQUSN,Y
"RTN","XQCHK",187,0)
 ;
"RTN","XQCHK",188,0)
 S DIC(0)="AEMNQ",DIC="^VA(200,",DIC("A")="Please enter the user's name: " D ^DIC
"RTN","XQCHK",189,0)
 I $D(DUOUT)!($D(DTOUT)) D KILLFM Q
"RTN","XQCHK",190,0)
 I Y=-1 W !!?5,"Sorry we couldn't find that user in the New Person File.",!
"RTN","XQCHK",191,0)
 E  S XQUSN=+Y,XQUSER=$P(Y,U,2)
"RTN","XQCHK",192,0)
 I Y=-1 D KILLFM Q
"RTN","XQCHK",193,0)
 D KILLFM
"RTN","XQCHK",194,0)
 ;
"RTN","XQCHK",195,0)
 S DIC(0)="AEMNQ",DIC="^DIC(19,",DIC("A")="Please enter the name of the option: " D ^DIC
"RTN","XQCHK",196,0)
 I $D(DUOUT)!($D(DTOUT)) D KILLFM Q
"RTN","XQCHK",197,0)
 I Y=-1 W !!?5,"Sorry we couldn't find that option.",!
"RTN","XQCHK",198,0)
 E  S XQOPN=+Y,XQOPT=$P(Y,U,2)
"RTN","XQCHK",199,0)
 I Y=-1 D KILLFM Q
"RTN","XQCHK",200,0)
 D KILLFM
"RTN","XQCHK",201,0)
 ;
"RTN","XQCHK",202,0)
 S XQANS=$$ACCESS(XQUSN,XQOPN)
"RTN","XQCHK",203,0)
 ;W !,XQANS,!
"RTN","XQCHK",204,0)
 ;
"RTN","XQCHK",205,0)
 S XQRSLT=+XQANS,XQTREE=""
"RTN","XQCHK",206,0)
 S XQPTR=$P(XQANS,U,2) I XQPTR>0 S XQTREE=$P(^DIC(19,$P(XQANS,U,2),0),U)
"RTN","XQCHK",207,0)
 S XQCODES=$P(XQANS,U,3),XQKEY=$P(XQANS,U,4)
"RTN","XQCHK",208,0)
 ;
"RTN","XQCHK",209,0)
 I XQRSLT=-1 W !!?5,"User ",XQUSER," is not in the New Person File."
"RTN","XQCHK",210,0)
 I XQRSLT=-2 W !!?5,"User ",XQUSER," has an active termination date,",!?5,"or no verify code."
"RTN","XQCHK",211,0)
 I XQRSLT=-3 W !!?5,"Option ",XQOPT," is not in the Option File."
"RTN","XQCHK",212,0)
 I XQRSLT=0 D
"RTN","XQCHK",213,0)
 .W !!?5,"User ",XQUSER," does not have access to the option",!?5,XQOPT,"."
"RTN","XQCHK",214,0)
 .I XQCODES["L" W !!?5,"There is a lock somewhere in the menu tree "_XQTREE,!?5,"and the user does not hold the key "_XQKEY_"."
"RTN","XQCHK",215,0)
 .I XQCODES["R" W !!?5,"There is a reverse lock somewhere in the menu tree "_XQTREE,!?5,"and the user holds the key "_XQKEY_"."
"RTN","XQCHK",216,0)
 .Q
"RTN","XQCHK",217,0)
 I XQRSLT=1 W !!?5,"User ",XQUSER," has access to the option ",XQOPT,!?5,"through the primary menu ",XQTREE," (",$P(^DIC(19,XQPTR,0),U,2),")."
"RTN","XQCHK",218,0)
 I XQRSLT=2 W !!?5,"User ",XQUSER," has access to the option ",XQOPT,!?5,"through the Common Options (XUCOMMAND)."
"RTN","XQCHK",219,0)
 I XQRSLT=3 W !!?5,"User ",XQUSER," has access to the option ",XQOPT,!?5,"as a top-level secondary menu option."
"RTN","XQCHK",220,0)
 I XQRSLT=4 W !!?5,"User ",XQUSER," has access to the option ",XQOPT,!?5,"through the secondary menu tree ",XQTREE," (",$P(^DIC(19,XQPTR,0),U,2),")."
"RTN","XQCHK",221,0)
 W !
"RTN","XQCHK",222,0)
 ;W !!,%,"  ",XQUSER,"  ",XQOPT
"RTN","XQCHK",223,0)
 Q
"RTN","XQCHK",224,0)
 ;
"RTN","XQCHK",225,0)
KILLFM ;Kill off the FileMan variables
"RTN","XQCHK",226,0)
 K D0,DI,DIC,DIE,DISYS,DQ,DR,DUOUT,DTOUT,X,Y
"RTN","XQCHK",227,0)
 Q
"VER")
8.0^21.0
**END**
**END**
