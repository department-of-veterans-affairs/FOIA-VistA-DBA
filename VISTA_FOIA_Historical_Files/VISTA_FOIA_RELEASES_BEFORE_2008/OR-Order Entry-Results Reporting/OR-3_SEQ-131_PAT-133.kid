Released OR*3*133 SEQ #131
Extracted from mail message
**KIDS**:OR*3.0*133^

**INSTALL NAME**
OR*3.0*133
"BLD",3465,0)
OR*3.0*133^ORDER ENTRY/RESULTS REPORTING^0^3020506^y
"BLD",3465,1,0)
^^1^1^3020122^
"BLD",3465,1,1,0)
BCMA ORDER COM V1.1
"BLD",3465,4,0)
^9.64PA^^
"BLD",3465,"ABPKG")
n
"BLD",3465,"INIT")
POST^ORY133
"BLD",3465,"KRN",0)
^9.67PA^8989.52^19
"BLD",3465,"KRN",.4,0)
.4
"BLD",3465,"KRN",.401,0)
.401
"BLD",3465,"KRN",.402,0)
.402
"BLD",3465,"KRN",.403,0)
.403
"BLD",3465,"KRN",.5,0)
.5
"BLD",3465,"KRN",.84,0)
.84
"BLD",3465,"KRN",3.6,0)
3.6
"BLD",3465,"KRN",3.8,0)
3.8
"BLD",3465,"KRN",9.2,0)
9.2
"BLD",3465,"KRN",9.8,0)
9.8
"BLD",3465,"KRN",9.8,"NM",0)
^9.68A^10^6
"BLD",3465,"KRN",9.8,"NM",1,0)
ORWUBCMA^^0^B6025108
"BLD",3465,"KRN",9.8,"NM",3,0)
ORMBLD^^0^B30961474
"BLD",3465,"KRN",9.8,"NM",7,0)
ORY133^^0^B214325
"BLD",3465,"KRN",9.8,"NM",8,0)
ORBCMA1^^0^B14819294
"BLD",3465,"KRN",9.8,"NM",9,0)
ORBCMA5^^0^B3393504
"BLD",3465,"KRN",9.8,"NM",10,0)
ORBCMA32^^0^B72612534
"BLD",3465,"KRN",9.8,"NM","B","ORBCMA1",8)

"BLD",3465,"KRN",9.8,"NM","B","ORBCMA32",10)

"BLD",3465,"KRN",9.8,"NM","B","ORBCMA5",9)

"BLD",3465,"KRN",9.8,"NM","B","ORMBLD",3)

"BLD",3465,"KRN",9.8,"NM","B","ORWUBCMA",1)

"BLD",3465,"KRN",9.8,"NM","B","ORY133",7)

"BLD",3465,"KRN",19,0)
19
"BLD",3465,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",3465,"KRN",19,"NM",1,0)
OR BCMA ORDER COM^^0
"BLD",3465,"KRN",19,"NM","B","OR BCMA ORDER COM",1)

"BLD",3465,"KRN",19.1,0)
19.1
"BLD",3465,"KRN",101,0)
101
"BLD",3465,"KRN",409.61,0)
409.61
"BLD",3465,"KRN",771,0)
771
"BLD",3465,"KRN",870,0)
870
"BLD",3465,"KRN",8989.51,0)
8989.51
"BLD",3465,"KRN",8989.52,0)
8989.52
"BLD",3465,"KRN",8994,0)
8994
"BLD",3465,"KRN",8994,"NM",0)
^9.68A^20^20
"BLD",3465,"KRN",8994,"NM",1,0)
ORWUBCMA USERINFO^^0
"BLD",3465,"KRN",8994,"NM",2,0)
ORBCMA1 CHK94^^0
"BLD",3465,"KRN",8994,"NM",3,0)
ORBCMA1 DOSEALT^^0
"BLD",3465,"KRN",8994,"NM",4,0)
ORBCMA1 FAILDEA^^0
"BLD",3465,"KRN",8994,"NM",5,0)
ORBCMA1 FORMALT^^0
"BLD",3465,"KRN",8994,"NM",6,0)
ORBCMA1 ODSLCT^^0
"BLD",3465,"KRN",8994,"NM",7,0)
ORBCMA1 SCHALL^^0
"BLD",3465,"KRN",8994,"NM",8,0)
ORBCMA5 GETIVID^^0
"BLD",3465,"KRN",8994,"NM",9,0)
ORBCMA5 GETUD^^0
"BLD",3465,"KRN",8994,"NM",10,0)
ORBCMA5 GETUDID^^0
"BLD",3465,"KRN",8994,"NM",11,0)
ORBCMA5 ODITMBC^^0
"BLD",3465,"KRN",8994,"NM",12,0)
ORBCMA32 AUTH^^0
"BLD",3465,"KRN",8994,"NM",13,0)
ORBCMA32 DLGSLCT^^0
"BLD",3465,"KRN",8994,"NM",14,0)
ORBCMA32 DRUGMSG^^0
"BLD",3465,"KRN",8994,"NM",15,0)
ORBCMA32 FORMALT^^0
"BLD",3465,"KRN",8994,"NM",16,0)
ORBCMA32 ISSPLY^^0
"BLD",3465,"KRN",8994,"NM",17,0)
ORBCMA32 IVAMT^^0
"BLD",3465,"KRN",8994,"NM",18,0)
ORBCMA32 VALRATE^^0
"BLD",3465,"KRN",8994,"NM",19,0)
ORBCMA32 VALROUTE^^0
"BLD",3465,"KRN",8994,"NM",20,0)
ORBCMA32 VALSCH^^0
"BLD",3465,"KRN",8994,"NM","B","ORBCMA1 CHK94",2)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA1 DOSEALT",3)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA1 FAILDEA",4)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA1 FORMALT",5)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA1 ODSLCT",6)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA1 SCHALL",7)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA32 AUTH",12)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA32 DLGSLCT",13)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA32 DRUGMSG",14)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA32 FORMALT",15)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA32 ISSPLY",16)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA32 IVAMT",17)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA32 VALRATE",18)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA32 VALROUTE",19)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA32 VALSCH",20)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA5 GETIVID",8)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA5 GETUD",9)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA5 GETUDID",10)

"BLD",3465,"KRN",8994,"NM","B","ORBCMA5 ODITMBC",11)

"BLD",3465,"KRN",8994,"NM","B","ORWUBCMA USERINFO",1)

"BLD",3465,"KRN","B",.4,.4)

"BLD",3465,"KRN","B",.401,.401)

"BLD",3465,"KRN","B",.402,.402)

"BLD",3465,"KRN","B",.403,.403)

"BLD",3465,"KRN","B",.5,.5)

"BLD",3465,"KRN","B",.84,.84)

"BLD",3465,"KRN","B",3.6,3.6)

"BLD",3465,"KRN","B",3.8,3.8)

"BLD",3465,"KRN","B",9.2,9.2)

"BLD",3465,"KRN","B",9.8,9.8)

"BLD",3465,"KRN","B",19,19)

"BLD",3465,"KRN","B",19.1,19.1)

"BLD",3465,"KRN","B",101,101)

"BLD",3465,"KRN","B",409.61,409.61)

"BLD",3465,"KRN","B",771,771)

"BLD",3465,"KRN","B",870,870)

"BLD",3465,"KRN","B",8989.51,8989.51)

"BLD",3465,"KRN","B",8989.52,8989.52)

"BLD",3465,"KRN","B",8994,8994)

"BLD",3465,"QUES",0)
^9.62^^
"BLD",3465,"REQB",0)
^9.611^1^1
"BLD",3465,"REQB",1,0)
OR*3.0*131^0
"BLD",3465,"REQB","B","OR*3.0*131",1)

"INIT")
POST^ORY133
"KRN",19,8806,-1)
0^1
"KRN",19,8806,0)
OR BCMA ORDER COM^OR BCMA ORDER COM VERSION 1.0^^B^^^^^^^^
"KRN",19,8806,99.1)
58861,31872
"KRN",19,8806,"RPC",0)
^19.05P^108^90
"KRN",19,8806,"RPC",1,0)
ORBCMA32 DLGSLCT
"KRN",19,8806,"RPC",2,0)
ORBCMA5 GETIVID
"KRN",19,8806,"RPC",3,0)
ORBCMA5 GETUD
"KRN",19,8806,"RPC",4,0)
ORBCMA5 GETUDID
"KRN",19,8806,"RPC",5,0)
ORBCMA5 ODITMBC
"KRN",19,8806,"RPC",6,0)
ORWUBCMA USERINFO
"KRN",19,8806,"RPC",7,0)
ORWDXA DC
"KRN",19,8806,"RPC",8,0)
ORWDXA VALID
"KRN",19,8806,"RPC",16,0)
ORWCH SAVESIZ
"KRN",19,8806,"RPC",17,0)
ORWU DT
"KRN",19,8806,"RPC",18,0)
ORWU VALDT
"KRN",19,8806,"RPC",19,0)
ORWU EXTNAME
"KRN",19,8806,"RPC",20,0)
ORWU NPHASKEY
"KRN",19,8806,"RPC",21,0)
ORWU GBLREF
"KRN",19,8806,"RPC",22,0)
ORWU PARAM
"KRN",19,8806,"RPC",23,0)
ORWU HASKEY
"KRN",19,8806,"RPC",24,0)
ORWU HAS OPTION ACCESS
"KRN",19,8806,"RPC",25,0)
ORWU VALIDSIG
"KRN",19,8806,"RPC",26,0)
ORWUL FV4DG
"KRN",19,8806,"RPC",27,0)
ORWUL FVSUB
"KRN",19,8806,"RPC",28,0)
ORWUL FVIDX
"KRN",19,8806,"RPC",29,0)
ORWUL QV4DG
"KRN",19,8806,"RPC",30,0)
ORWUL QVSUB
"KRN",19,8806,"RPC",31,0)
ORWUL QVIDX
"KRN",19,8806,"RPC",32,0)
ORWORB KILL UNSIG ORDERS ALERT
"KRN",19,8806,"RPC",33,0)
ORWORB UNSIG ORDERS FOLLOWUP
"KRN",19,8806,"RPC",34,0)
ORWORB KILL EXPIR MED ALERT
"KRN",19,8806,"RPC",35,0)
ORWORB KILL EXPIR OI ALERT
"KRN",19,8806,"RPC",36,0)
ORWORB KILL UNVER MEDS ALERT
"KRN",19,8806,"RPC",37,0)
ORWORB KILL UNVER ORDERS ALERT
"KRN",19,8806,"RPC",38,0)
ORWORB AUTOUNFLAG ORDERS
"KRN",19,8806,"RPC",39,0)
ORWORB GETDATA
"KRN",19,8806,"RPC",40,0)
ORB DELETE ALERT
"KRN",19,8806,"RPC",41,0)
ORWPT DIEDON
"KRN",19,8806,"RPC",42,0)
ORWPT SELECT
"KRN",19,8806,"RPC",43,0)
ORWPT INPLOC
"KRN",19,8806,"RPC",44,0)
ORWPT ENCTITL
"KRN",19,8806,"RPC",45,0)
ORWPT1 PRCARE
"KRN",19,8806,"RPC",46,0)
ORWRP GET DEFAULT PRINTER
"KRN",19,8806,"RPC",48,0)
ORWDX DGNM
"KRN",19,8806,"RPC",49,0)
ORWDX DLGDEF
"KRN",19,8806,"RPC",50,0)
ORWDX LOADRSP
"KRN",19,8806,"RPC",51,0)
ORWDX SAVE
"KRN",19,8806,"RPC",52,0)
ORWDX MSG
"KRN",19,8806,"RPC",53,0)
ORWDX ORDITM
"KRN",19,8806,"RPC",54,0)
ORWDX WRLST
"KRN",19,8806,"RPC",55,0)
ORWDX DISMSG
"KRN",19,8806,"RPC",56,0)
ORWDX SEND
"KRN",19,8806,"RPC",57,0)
ORWDX SENDP
"KRN",19,8806,"RPC",58,0)
ORWDX DLGID
"KRN",19,8806,"RPC",59,0)
ORWDX FORMID
"KRN",19,8806,"RPC",60,0)
ORWDX LOCK
"KRN",19,8806,"RPC",61,0)
ORWDX UNLOCK
"KRN",19,8806,"RPC",62,0)
ORWDX LOCK ORDER
"KRN",19,8806,"RPC",63,0)
ORWDX UNLOCK ORDER
"KRN",19,8806,"RPC",64,0)
ORWDPS2 SCHREQ
"KRN",19,8806,"RPC",65,0)
ORWDPS2 OISLCT
"KRN",19,8806,"RPC",76,0)
ORWDXC ON
"KRN",19,8806,"RPC",77,0)
ORWDXC DISPLAY
"KRN",19,8806,"RPC",78,0)
ORWDXC ACCEPT
"KRN",19,8806,"RPC",79,0)
ORWDXC SESSION
"KRN",19,8806,"RPC",80,0)
ORWDXC SAVECHK
"KRN",19,8806,"RPC",81,0)
ORWDXC DELORD
"KRN",19,8806,"RPC",82,0)
ORWD1 SIG4ANY
"KRN",19,8806,"RPC",83,0)
ORWORR GET
"KRN",19,8806,"RPC",84,0)
ORWORR GETTXT
"KRN",19,8806,"RPC",85,0)
ORWDXM DLGNAME
"KRN",19,8806,"RPC",86,0)
ORWDXM PROMPTS
"KRN",19,8806,"RPC",87,0)
ORWDXM AUTOACK
"KRN",19,8806,"RPC",88,0)
ORWDXM MSTYLE
"KRN",19,8806,"RPC",89,0)
ORWDXM FORMID
"KRN",19,8806,"RPC",90,0)
ORWDXM1 BLDQRSP
"KRN",19,8806,"RPC",91,0)
ORWDXM2 CLRRCL
"KRN",19,8806,"RPC",92,0)
ORWORDG MAPSEQ
"KRN",19,8806,"RPC",93,0)
ORWORDG IEN
"KRN",19,8806,"RPC",94,0)
ORWOR UNSIGN
"KRN",19,8806,"RPC",95,0)
ORBCMA1 ODSLCT
"KRN",19,8806,"RPC",96,0)
ORBCMA1 CHK94
"KRN",19,8806,"RPC",97,0)
ORBCMA1 DOSEALT
"KRN",19,8806,"RPC",98,0)
ORBCMA1 FORMALT
"KRN",19,8806,"RPC",99,0)
ORBCMA1 FAILDEA
"KRN",19,8806,"RPC",100,0)
ORBCMA1 SCHALL
"KRN",19,8806,"RPC",101,0)
ORBCMA32 AUTH
"KRN",19,8806,"RPC",102,0)
ORBCMA32 DRUGMSG
"KRN",19,8806,"RPC",103,0)
ORBCMA32 FORMALT
"KRN",19,8806,"RPC",104,0)
ORBCMA32 ISSPLY
"KRN",19,8806,"RPC",105,0)
ORBCMA32 IVAMT
"KRN",19,8806,"RPC",106,0)
ORBCMA32 VALRATE
"KRN",19,8806,"RPC",107,0)
ORBCMA32 VALROUTE
"KRN",19,8806,"RPC",108,0)
ORBCMA32 VALSCH
"KRN",19,8806,"U")
OR BCMA ORDER COM VERSION 1.0
"KRN",8994,1800,-1)
0^9
"KRN",8994,1800,0)
ORBCMA5 GETUD^GETUD^ORBCMA5^1
"KRN",8994,1801,-1)
0^10
"KRN",8994,1801,0)
ORBCMA5 GETUDID^GETUDID^ORBCMA5^1
"KRN",8994,1802,-1)
0^8
"KRN",8994,1802,0)
ORBCMA5 GETIVID^GETIVID^ORBCMA5^1
"KRN",8994,1804,-1)
0^11
"KRN",8994,1804,0)
ORBCMA5 ODITMBC^ODITMBC^ORBCMA5^2^^^^1
"KRN",8994,1809,-1)
0^1
"KRN",8994,1809,0)
ORWUBCMA USERINFO^USERINFO^ORWUBCMA^1
"KRN",8994,1809,2,0)
^8994.02A^1^1
"KRN",8994,1809,2,1,0)
ORWDPS5
"KRN",8994,1809,2,"B","ORWDPS5",1)

"KRN",8994,1810,-1)
0^13
"KRN",8994,1810,0)
ORBCMA32 DLGSLCT^DLGSLCT^ORBCMA32^2
"KRN",8994,1816,-1)
0^6
"KRN",8994,1816,0)
ORBCMA1 ODSLCT^ODSLCT^ORBCMA1^2
"KRN",8994,1817,-1)
0^2
"KRN",8994,1817,0)
ORBCMA1 CHK94^CHK94^ORBCMA1^1
"KRN",8994,1818,-1)
0^4
"KRN",8994,1818,0)
ORBCMA1 FAILDEA^FAILDEA^ORBCMA1^1
"KRN",8994,1819,-1)
0^5
"KRN",8994,1819,0)
ORBCMA1 FORMALT^FORMALT^ORBCMA1^2^^^^1
"KRN",8994,1820,-1)
0^3
"KRN",8994,1820,0)
ORBCMA1 DOSEALT^DOSEALT^ORBCMA1^2^^^^1
"KRN",8994,1820,2,0)
^8994.02A^^0
"KRN",8994,1821,-1)
0^7
"KRN",8994,1821,0)
ORBCMA1 SCHALL^SCHALL^ORBCMA1^2^^^^1
"KRN",8994,1822,-1)
0^12
"KRN",8994,1822,0)
ORBCMA32 AUTH^AUTH^ORBCMA32^1
"KRN",8994,1823,-1)
0^14
"KRN",8994,1823,0)
ORBCMA32 DRUGMSG^DRUGMSG^ORBCMA32^1^^^^1
"KRN",8994,1823,2,0)
^8994.02A^1^1
"KRN",8994,1823,2,1,0)
BOWDPS32 FORMALT
"KRN",8994,1823,2,"B","BOWDPS32 FORMALT",1)

"KRN",8994,1824,-1)
0^15
"KRN",8994,1824,0)
ORBCMA32 FORMALT^FORMALT^ORBCMA32^2^^^^1
"KRN",8994,1825,-1)
0^19
"KRN",8994,1825,0)
ORBCMA32 VALROUTE^VALROUTE^ORBCMA32^1^^^^1
"KRN",8994,1826,-1)
0^16
"KRN",8994,1826,0)
ORBCMA32 ISSPLY^ISSPLY^ORBCMA32^1^^^^1
"KRN",8994,1827,-1)
0^17
"KRN",8994,1827,0)
ORBCMA32 IVAMT^IVAMT^ORBCMA32^1^^^^1
"KRN",8994,1828,-1)
0^18
"KRN",8994,1828,0)
ORBCMA32 VALRATE^VALRATE^ORBCMA32^1^^^^1
"KRN",8994,1829,-1)
0^20
"KRN",8994,1829,0)
ORBCMA32 VALSCH^VALSCH^ORBCMA32^1^^^^1
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
133^3020506
"PKG",110,22,1,"PAH",1,1,0)
^^1^1^3020506
"PKG",110,22,1,"PAH",1,1,1,0)
BCMA ORDER COM V1.1
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","ORBCMA1")
0^8^B14819294
"RTN","ORBCMA1",1,0)
ORBCMA1 ; SLC/JLI - Pharmacy Calls for Windows Dialog [ 2/11/02 4:30PM ]
"RTN","ORBCMA1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**133**;Dec 17, 1997
"RTN","ORBCMA1",3,0)
 ;;OR BCMA ORDER COM V1.0 ;**133**; Jan 19, 2002
"RTN","ORBCMA1",4,0)
 ;
"RTN","ORBCMA1",5,0)
ODSLCT(LST,PSTYPE,DFN,LOC) ; return default lists for dialog
"RTN","ORBCMA1",6,0)
 ; PSTYPE: pharmacy type (U=unit dose, F=IV fluids, O=outpatient)
"RTN","ORBCMA1",7,0)
 N ILST S ILST=0
"RTN","ORBCMA1",8,0)
 S ILST=ILST+1,LST(ILST)="~Priority" D PRIOR
"RTN","ORBCMA1",9,0)
 S ILST=ILST+1,LST(ILST)="~DispMsg"
"RTN","ORBCMA1",10,0)
 S ILST=ILST+1,LST(ILST)="d"_$$DISPMSG
"RTN","ORBCMA1",11,0)
 ;
"RTN","ORBCMA1",12,0)
 ; I PSTYPE="F" D  Q                           ; IV Fluids
"RTN","ORBCMA1",13,0)
 ; . S ILST=ILST+1,LST(ILST)="~ShortList" D SHORT
"RTN","ORBCMA1",14,0)
 ;
"RTN","ORBCMA1",15,0)
 I PSTYPE="O" D                                ; Outpatient
"RTN","ORBCMA1",16,0)
 . S ILST=ILST+1,LST(ILST)="~Refills"
"RTN","ORBCMA1",17,0)
 . S ILST=ILST+1,LST(ILST)="d0^0"
"RTN","ORBCMA1",18,0)
 . S ILST=ILST+1,LST(ILST)="~Pickup"
"RTN","ORBCMA1",19,0)
 . S ILST=ILST+1,LST(ILST)="d"_$$DEFPICK($G(LOC))
"RTN","ORBCMA1",20,0)
 . ; S ILST=ILST+1,LST(ILST)="~Supply"
"RTN","ORBCMA1",21,0)
 . ; S ILST=ILST+1,LST(ILST)="d^"_$$DEFSPLY(DFN)
"RTN","ORBCMA1",22,0)
 Q
"RTN","ORBCMA1",23,0)
PRIOR ; from DLGSLCT, get list of allowed priorities
"RTN","ORBCMA1",24,0)
 N X,XREF
"RTN","ORBCMA1",25,0)
 S X=0
"RTN","ORBCMA1",26,0)
 S X=$O(^ORD(101.42,"B","DONE",X))
"RTN","ORBCMA1",27,0)
 S ILST=ILST+1,LST(ILST)="d"_X_U_$P(^ORD(101.42,X,0),U,2)
"RTN","ORBCMA1",28,0)
 Q
"RTN","ORBCMA1",29,0)
DEFPICK(LOC)       ; return default routing
"RTN","ORBCMA1",30,0)
 N X,DLG,PRMT
"RTN","ORBCMA1",31,0)
 S DLG=$O(^ORD(101.41,"AB","PSO OERR",0)),X=""
"RTN","ORBCMA1",32,0)
 S PRMT=$O(^ORD(101.41,"AB","OR GTX ROUTING",0))
"RTN","ORBCMA1",33,0)
 I $D(^TMP("ORECALL",$J,+DLG,+PRMT,1)) S X=^(1)
"RTN","ORBCMA1",34,0)
 I X'="" S EDITONLY=1 Q X  ; EDITONLY used by default action
"RTN","ORBCMA1",35,0)
 ;
"RTN","ORBCMA1",36,0)
 S X=$$GET^XPAR("ALL^"_"LOC.`"_LOC,"ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORBCMA1",37,0)
 I X="C" S X="C^in Clinic" G XPICK
"RTN","ORBCMA1",38,0)
 I X="M" S X="M^by Mail"   G XPICK
"RTN","ORBCMA1",39,0)
 I X="W" S X="W^at Window" G XPICK
"RTN","ORBCMA1",40,0)
 I X="N" S X=""            G XPICK
"RTN","ORBCMA1",41,0)
 I X=""  S X=$S($D(^PSX(550,"C")):"M^by Mail",1:"W^at Window")
"RTN","ORBCMA1",42,0)
XPICK Q X
"RTN","ORBCMA1",43,0)
 ;
"RTN","ORBCMA1",44,0)
DEFSPLY(DFN)    ; return default days supply for this patient
"RTN","ORBCMA1",45,0)
 N ORWX
"RTN","ORBCMA1",46,0)
 S ORWX("PATIENT")=DFN
"RTN","ORBCMA1",47,0)
 D DSUP^PSOSIGDS(.ORWX)
"RTN","ORBCMA1",48,0)
 Q $G(ORWX("DAYS SUPPLY"))
"RTN","ORBCMA1",49,0)
 ;
"RTN","ORBCMA1",50,0)
DFLTSPLY(VAL,UPD,SCH,PAT,DRG)        ; return days supply given quantity
"RTN","ORBCMA1",51,0)
 ; VAL: default days supply
"RTN","ORBCMA1",52,0)
 N ORWX,I
"RTN","ORBCMA1",53,0)
 S ORWX("PATIENT")=PAT
"RTN","ORBCMA1",54,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORBCMA1",55,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORBCMA1",56,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORBCMA1",57,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORBCMA1",58,0)
 D DSUP^PSOSIGDS(.ORWX)
"RTN","ORBCMA1",59,0)
 S VAL=$G(ORWX("DAYS SUPPLY"))
"RTN","ORBCMA1",60,0)
 Q
"RTN","ORBCMA1",61,0)
DISPMSG()       ; return 1 to suppress dispense message
"RTN","ORBCMA1",62,0)
 Q +$$GET^XPAR("ALL","ORWDPS SUPPRESS DISPENSE MSG",1,"I")
"RTN","ORBCMA1",63,0)
 ;
"RTN","ORBCMA1",64,0)
SCHALL(LST) ; return all schedules
"RTN","ORBCMA1",65,0)
 N ILST,SCH,IEN,EXP,TYP,X0
"RTN","ORBCMA1",66,0)
 S ILST=0,SCH=""
"RTN","ORBCMA1",67,0)
 F  S SCH=$O(^PS(51.1,"APPSJ",SCH)) Q:SCH=""  D
"RTN","ORBCMA1",68,0)
 . I (SCH="STAT")!(SCH="NOW") D
"RTN","ORBCMA1",69,0)
 .. S IEN=$O(^PS(51.1,"APPSJ",SCH,0))
"RTN","ORBCMA1",70,0)
 .. S X0=$G(^PS(51.1,IEN,0)),EXP=$P(X0,U,8),TYP=$P(X0,U,5)
"RTN","ORBCMA1",71,0)
 .. S ILST=ILST+1,LST(ILST)=SCH_U_EXP_U_TYP
"RTN","ORBCMA1",72,0)
 Q
"RTN","ORBCMA1",73,0)
FORMALT(ORLST,IEN,PSTYPE) ; return a list of formulary alternatives
"RTN","ORBCMA1",74,0)
 N PSID,I
"RTN","ORBCMA1",75,0)
 S IEN=+$P(^ORD(101.43,IEN,0),U,2)
"RTN","ORBCMA1",76,0)
 D EN1^PSSUTIL1(.IEN,PSTYPE)
"RTN","ORBCMA1",77,0)
 S PSID=0,I=0
"RTN","ORBCMA1",78,0)
 F  S PSID=$O(IEN(PSID)) Q:'PSID  D
"RTN","ORBCMA1",79,0)
 . S OI=+$O(^ORD(101.43,"ID",PSID_";99PSP",0))
"RTN","ORBCMA1",80,0)
 . I OI S I=I+1,ORLST(I)=OI,$P(ORLST(I),U,2)=$P(^ORD(101.43,OI,0),U)
"RTN","ORBCMA1",81,0)
 Q
"RTN","ORBCMA1",82,0)
DOSEALT(LST,DDRUG,CUROI,PSTYPE) ; return a list of formulary alternatives for dose
"RTN","ORBCMA1",83,0)
 N I,OI,ORWLST,ILST S ILST=0
"RTN","ORBCMA1",84,0)
 D ENRFA^PSJORUTL(DDRUG,PSTYPE,.ORWLST)
"RTN","ORBCMA1",85,0)
 S I=0 F  S I=$O(ORWLST(I)) Q:'I  D
"RTN","ORBCMA1",86,0)
 . S OI=+$O(^ORD(101.43,"ID",+$P(ORWLST(I),U,4)_";99PSP",0))
"RTN","ORBCMA1",87,0)
 . I OI,OI'=CUROI S ILST=ILST+1,LST(ILST)=OI_U_$P(^ORD(101.43,OI,0),U)
"RTN","ORBCMA1",88,0)
 Q
"RTN","ORBCMA1",89,0)
FAILDEA(FAIL,OI,ORNP,PSTYPE)    ; return 1 if DEA check fails for this provider
"RTN","ORBCMA1",90,0)
 N DEAFLG,PSOI
"RTN","ORBCMA1",91,0)
 S FAIL=0,PSOI=+$P($G(^ORD(101.43,+$G(OI),0)),U,2) Q:PSOI'>0
"RTN","ORBCMA1",92,0)
 I '$L($T(OIDEA^PSSUTLA1)) Q
"RTN","ORBCMA1",93,0)
 S DEAFLG=$$OIDEA^PSSUTLA1(PSOI,PSTYPE) Q:DEAFLG'>0
"RTN","ORBCMA1",94,0)
 I '$L($P($G(^VA(200,+$G(ORNP),"PS")),U,2)),'$L($P($G(^("PS")),U,3)) S FAIL=1
"RTN","ORBCMA1",95,0)
 Q
"RTN","ORBCMA1",96,0)
CHK94(VAL)      ; return 1 if patch 94 has been installed
"RTN","ORBCMA1",97,0)
 S VAL=0
"RTN","ORBCMA1",98,0)
 I $O(^ORD(101.41,"B","PS MEDS",0)) S VAL=1
"RTN","ORBCMA1",99,0)
 Q
"RTN","ORBCMA32")
0^10^B72612534
"RTN","ORBCMA32",1,0)
ORBCMA32 ; SLC/JLI - Pharmacy Calls for GUI Dialog 1/17/02
"RTN","ORBCMA32",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**133**;Dec 17, 1997
"RTN","ORBCMA32",3,0)
 ;;BCMA ORDER V1.0 ;**133**;Jan 17, 2002
"RTN","ORBCMA32",4,0)
 ;
"RTN","ORBCMA32",5,0)
NXT() ; -- returns next available index in return data array
"RTN","ORBCMA32",6,0)
 S ILST=ILST+1
"RTN","ORBCMA32",7,0)
 Q ILST
"RTN","ORBCMA32",8,0)
 ;
"RTN","ORBCMA32",9,0)
DLGSLCT(LST,PSTYPE) ; return default lists for dialog
"RTN","ORBCMA32",10,0)
 ; PSTYPE: pharmacy type (U=unit dose, F=IV fluids, O=outpatient)
"RTN","ORBCMA32",11,0)
 N ILST S ILST=0
"RTN","ORBCMA32",12,0)
 I PSTYPE="F" D  Q                       ; IV Fluids
"RTN","ORBCMA32",13,0)
 . S LST($$NXT)="~ShortList"  D SHORT
"RTN","ORBCMA32",14,0)
 . S LST($$NXT)="~Priorities" D PRIOR
"RTN","ORBCMA32",15,0)
 ;
"RTN","ORBCMA32",16,0)
 S LST($$NXT)="~ShortList"  D SHORT      ; Unit Dose & Outpatient
"RTN","ORBCMA32",17,0)
 S LST($$NXT)="~Schedules"  D SCHED
"RTN","ORBCMA32",18,0)
 S LST($$NXT)="~Priorities" D PRIOR
"RTN","ORBCMA32",19,0)
 I PSTYPE="O" D                          ; Outpatient
"RTN","ORBCMA32",20,0)
 . S LST($$NXT)="~Pickup"   D PICKUP
"RTN","ORBCMA32",21,0)
 . S LST($$NXT)="~SCStatus" D SCLIST
"RTN","ORBCMA32",22,0)
 Q
"RTN","ORBCMA32",23,0)
SHORT ; from DLGSLCT, get short list of med quick orders
"RTN","ORBCMA32",24,0)
 ; !!! change this so that it uses the ORWDXQ call!!!
"RTN","ORBCMA32",25,0)
 N I,X,TMP
"RTN","ORBCMA32",26,0)
 I PSTYPE="U" S X="UD RX"
"RTN","ORBCMA32",27,0)
 I PSTYPE="F" S X="IV RX"
"RTN","ORBCMA32",28,0)
 I PSTYPE="O" S X="O RX"
"RTN","ORBCMA32",29,0)
 D GETQLST^ORWDXQ(.TMP,X,"iQ")
"RTN","ORBCMA32",30,0)
 S I=0 F  S I=$O(TMP(I)) Q:'I  S LST($$NXT)=TMP(I)
"RTN","ORBCMA32",31,0)
 Q
"RTN","ORBCMA32",32,0)
SCHED ; from DLGSLCT, get all pharmacy administration schedules
"RTN","ORBCMA32",33,0)
 N X
"RTN","ORBCMA32",34,0)
 S X="" F  S X=$O(^PS(51.1,"APPSJ",X)) Q:X=""  S LST($$NXT)="i"_X
"RTN","ORBCMA32",35,0)
 Q
"RTN","ORBCMA32",36,0)
SCHEDA ; (similar to SCHED, but also returns administration times)
"RTN","ORBCMA32",37,0)
 N X,IEN,SCH
"RTN","ORBCMA32",38,0)
 S SCH="" F  S SCH=$O(^PS(51.1,"APPSJ",SCH)) Q:SCH=""  D
"RTN","ORBCMA32",39,0)
 . S IEN=0 F  S IEN=$O(^PS(51.1,"APPSJ",SCH,IEN)) Q:IEN'>0  D
"RTN","ORBCMA32",40,0)
 . . S X=^PS(51.1,IEN,0) S X=$S($L($P(X,U,2)):"  ("_$P(X,U,2)_")",1:"")
"RTN","ORBCMA32",41,0)
 . . S LST($$NXT)="i"_IEN_U_SCH_X
"RTN","ORBCMA32",42,0)
 Q
"RTN","ORBCMA32",43,0)
PRIOR ; from DLGSLCT, get list of allowed priorities
"RTN","ORBCMA32",44,0)
 N X,XREF
"RTN","ORBCMA32",45,0)
 S X=0
"RTN","ORBCMA32",46,0)
 S X=$O(^ORD(101.42,"B","DONE",X))
"RTN","ORBCMA32",47,0)
 S LST($$NXT)="i"_X_U_$P(^ORD(101.42,X,0),U,2)
"RTN","ORBCMA32",48,0)
 Q
"RTN","ORBCMA32",49,0)
PICKUP ; from DLGSLCT, get prescription routing
"RTN","ORBCMA32",50,0)
 N X,EDITONLY
"RTN","ORBCMA32",51,0)
 F X="W^at Window","M^by Mail","C^in Clinic" S LST($$NXT)="i"_X
"RTN","ORBCMA32",52,0)
 S X=$$DEFPICK I $L(X) S LST($$NXT)="d"_X
"RTN","ORBCMA32",53,0)
 Q
"RTN","ORBCMA32",54,0)
DEFPICK()       ; return default routing
"RTN","ORBCMA32",55,0)
 N X,DLG,PRMT
"RTN","ORBCMA32",56,0)
 S DLG=$O(^ORD(101.41,"AB","PSO OERR",0)),X=""
"RTN","ORBCMA32",57,0)
 S PRMT=$O(^ORD(101.41,"AB","OR GTX ROUTING",0))
"RTN","ORBCMA32",58,0)
 I $D(^TMP("ORECALL",$J,+DLG,+PRMT,1)) S X=^(1)
"RTN","ORBCMA32",59,0)
 I X'="" S EDITONLY=1 Q X  ; EDITONLY used by default action
"RTN","ORBCMA32",60,0)
 ;
"RTN","ORBCMA32",61,0)
 S X=$$GET^XPAR("ALL","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORBCMA32",62,0)
 I X="C" S X="C^in Clinic" G XPICK
"RTN","ORBCMA32",63,0)
 I X="M" S X="M^by Mail"   G XPICK
"RTN","ORBCMA32",64,0)
 I X="W" S X="W^at Window" G XPICK
"RTN","ORBCMA32",65,0)
 I X="N" S X=""             G XPICK
"RTN","ORBCMA32",66,0)
 I X=""  S X=$S($D(^PSX(550,"C")):"M^by Mail",1:"W^at Window")
"RTN","ORBCMA32",67,0)
XPICK Q X
"RTN","ORBCMA32",68,0)
 ;
"RTN","ORBCMA32",69,0)
SCLIST ; from DLGSLCT, get options for service connected
"RTN","ORBCMA32",70,0)
 F X="0^No","1^Yes" S LST($$NXT)="i"_X
"RTN","ORBCMA32",71,0)
 Q
"RTN","ORBCMA32",72,0)
 ;
"RTN","ORBCMA32",73,0)
OISLCT(LST,OI,PSTYPE,ORVP) ; return for defaults for pharmacy orderable item
"RTN","ORBCMA32",74,0)
 N ILST S ILST=0
"RTN","ORBCMA32",75,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORBCMA32",76,0)
 S LST($$NXT)="~Dispense" D DISPDRG
"RTN","ORBCMA32",77,0)
 S LST($$NXT)="~Instruct" D INSTRCT
"RTN","ORBCMA32",78,0)
 S LST($$NXT)="~Route"    D ROUTE
"RTN","ORBCMA32",79,0)
 S LST($$NXT)="~Message"  D MESSAGE
"RTN","ORBCMA32",80,0)
 I $L($G(^TMP("PSJSCH",$J))) S LST($$NXT)="~DefSched",LST($$NXT)="d"_^($J)
"RTN","ORBCMA32",81,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORBCMA32",82,0)
 Q
"RTN","ORBCMA32",83,0)
 ;
"RTN","ORBCMA32",84,0)
DISPDRUG(LST,OI) ; list dispense drugs for an orderable item
"RTN","ORBCMA32",85,0)
 N ILST,PSTYPE S ILST=0,PSTYPE="U" D DISPDRG
"RTN","ORBCMA32",86,0)
 Q
"RTN","ORBCMA32",87,0)
 ;
"RTN","ORBCMA32",88,0)
DISPDRG ; from OISLCT, get dispense drugs for this pharmacy orderable item
"RTN","ORBCMA32",89,0)
 N I,ORTMP,ORX
"RTN","ORBCMA32",90,0)
 S ORX=$T(ENDD^PSJORUTL),ORX=$L($P(ORX,";"),",")
"RTN","ORBCMA32",91,0)
 I ORX>3 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP,+ORVP)
"RTN","ORBCMA32",92,0)
 I ORX'>3 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP)
"RTN","ORBCMA32",93,0)
 S I="" F  S I=$O(ORTMP(I)) Q:I=""  D
"RTN","ORBCMA32",94,0)
 . I $P(ORTMP(I),U,4)="1" S $P(ORTMP(I),U,4)="NF"
"RTN","ORBCMA32",95,0)
 . S $P(ORTMP(I),U,3)="$"_$P(ORTMP(I),U,3)_" per "_$P(ORTMP(I),U,5)
"RTN","ORBCMA32",96,0)
 . S LST($$NXT)="i"_ORTMP(I)
"RTN","ORBCMA32",97,0)
 Q
"RTN","ORBCMA32",98,0)
INSTRCT ; from OISLCT, get list of potential instructions (based on drug form)
"RTN","ORBCMA32",99,0)
 N INOUN,NOUN,IINS,INS,VERB,INSREC
"RTN","ORBCMA32",100,0)
 D START^PSSJORDF(+$P(^ORD(101.43,OI,0),U,2))
"RTN","ORBCMA32",101,0)
 I PSTYPE="U" Q  ; don't use the instructions list for inpatients
"RTN","ORBCMA32",102,0)
 S IINS=0 F  S IINS=$O(^TMP("PSJINS",$J,IINS)) Q:'IINS  D
"RTN","ORBCMA32",103,0)
 . S INSREC=$G(^TMP("PSJINS",$J,IINS))
"RTN","ORBCMA32",104,0)
 . I '$D(VERB) S VERB=$P(INSREC,U)
"RTN","ORBCMA32",105,0)
 . I $L($P(INSREC,U,2)) S LST($$NXT)="i"_$P(INSREC,U,2)
"RTN","ORBCMA32",106,0)
 S LST($$NXT)="~Nouns"
"RTN","ORBCMA32",107,0)
 S INOUN=0 F  S INOUN=$O(^TMP("PSJNOUN",$J,INOUN)) Q:'INOUN  D
"RTN","ORBCMA32",108,0)
 . S LST($$NXT)="i"_$P(^TMP("PSJNOUN",$J,INOUN),U)
"RTN","ORBCMA32",109,0)
 I $D(VERB) S LST($$NXT)="~Verb",LST($$NXT)="d"_VERB
"RTN","ORBCMA32",110,0)
 ;
"RTN","ORBCMA32",111,0)
 Q
"RTN","ORBCMA32",112,0)
MIXED(X)   ; Return mixed case
"RTN","ORBCMA32",113,0)
 Q X  ;$E(X)_$TR($E(X,2,$L(X)),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","ORBCMA32",114,0)
 ;
"RTN","ORBCMA32",115,0)
ROUTE ; from OISLCT, get list of routes for the drug form
"RTN","ORBCMA32",116,0)
 ; ** NEED BOTH ABBREVIATION & NAME IN LIST BOX
"RTN","ORBCMA32",117,0)
 N I,CNT,ABBR,IEN,ROUT,X
"RTN","ORBCMA32",118,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORBCMA32",119,0)
 . S ROUT=$P(^TMP("PSJMR",$J,I),U),ABBR=$P(^(I),U,2),IEN=$P(^(I),U,3)
"RTN","ORBCMA32",120,0)
 . S LST($$NXT)="i"_IEN_U_ROUT_U_ABBR
"RTN","ORBCMA32",121,0)
 . I I=1,IEN S LST($$NXT)="d"_IEN_U_ROUT ;_U_ABBR ; assume first always default
"RTN","ORBCMA32",122,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORBCMA32",123,0)
 . S ROUT=$P(^TMP("PSJMR",$J,I),U),ABBR=$P(^(I),U,2),IEN=$P(^(I),U,3)
"RTN","ORBCMA32",124,0)
 . I $L(ABBR),(ABBR'=ROUT) S LST($$NXT)="i"_IEN_U_ABBR_" ("_ROUT_")"_U_ABBR
"RTN","ORBCMA32",125,0)
 Q
"RTN","ORBCMA32",126,0)
MESSAGE ; message
"RTN","ORBCMA32",127,0)
 S I=0 F  S I=$O(^ORD(101.43,OI,8,I)) Q:I'>0  S LST($$NXT)="t"_^(I,0)
"RTN","ORBCMA32",128,0)
 Q
"RTN","ORBCMA32",129,0)
ALLROUTE(LST) ; returns a list of all available med routes
"RTN","ORBCMA32",130,0)
 N I,X,ILST S ILST=0
"RTN","ORBCMA32",131,0)
 S I=0 F  S I=$O(^PS(51.2,I)) Q:'I  S X=^(I,0) D
"RTN","ORBCMA32",132,0)
 . I $P(X,U,4) S LST($$NXT)=I_U_$P(X,U)_U_$P(X,U,3)
"RTN","ORBCMA32",133,0)
 Q
"RTN","ORBCMA32",134,0)
VALROUTE(REC,X)        ; validates route name & returns IEN + abbreviation
"RTN","ORBCMA32",135,0)
 N ORLST,ABBR
"RTN","ORBCMA32",136,0)
 D FIND^DIC(51.2,"",1,"MO",X,1,,"I $P(^(0),U,4)=1",,"ORLST")
"RTN","ORBCMA32",137,0)
 I 'ORLST("DILIST",0) S REC=0 Q
"RTN","ORBCMA32",138,0)
 S X=$$UPPER(X),ABBR=ORLST("DILIST","ID",1,1)
"RTN","ORBCMA32",139,0)
 I '$L(ABBR) S ABBR=ORLST("DILIST",1,1)
"RTN","ORBCMA32",140,0)
 I ($$UPPER(ORLST("DILIST",1,1))'=X),($$UPPER(ABBR)'=X) S REC=0 Q
"RTN","ORBCMA32",141,0)
 S REC=ORLST("DILIST",2,1)_U_ABBR
"RTN","ORBCMA32",142,0)
 Q
"RTN","ORBCMA32",143,0)
AUTH(VAL,PRV) ; For inpatient meds, check restrictions
"RTN","ORBCMA32",144,0)
 N NAME,AUTH,INACT,X S VAL=0
"RTN","ORBCMA32",145,0)
 S NAME=$P($G(^VA(200,PRV,20)),U,2) S:'$L(NAME) NAME=$P(^(0),U)
"RTN","ORBCMA32",146,0)
 S X=$G(^VA(200,PRV,"PS")),AUTH=$P(X,U),INACT=$P(X,U,4)
"RTN","ORBCMA32",147,0)
 I 'AUTH!(INACT&(DT>INACT)) D  Q
"RTN","ORBCMA32",148,0)
 . S VAL="1^"_NAME_" is not authorized to write medication orders."
"RTN","ORBCMA32",149,0)
 I $D(^XUSEC("OREMAS",DUZ)),'$$GET^XPAR("ALL","OR OREMAS MED ORDERS") D  Q
"RTN","ORBCMA32",150,0)
 . S VAL="1^OREMAS key holders may not enter medication orders."
"RTN","ORBCMA32",151,0)
 Q
"RTN","ORBCMA32",152,0)
DRUGMSG(VAL,IEN)        ; return any message associated with a dispense drug
"RTN","ORBCMA32",153,0)
 N X S X=$$ENDCM^PSJORUTL(IEN)
"RTN","ORBCMA32",154,0)
 S VAL=$P(X,U,2)_U_$P(X,U,4)
"RTN","ORBCMA32",155,0)
 Q
"RTN","ORBCMA32",156,0)
MEDISIV(VAL,IEN)        ; return true if orderable item is IV medication
"RTN","ORBCMA32",157,0)
 S VAL=0
"RTN","ORBCMA32",158,0)
 I $P($G(^ORD(101.43,IEN,"PS")),U)=2 S VAL=1
"RTN","ORBCMA32",159,0)
 Q
"RTN","ORBCMA32",160,0)
ISSPLY(VAL,IEN) ; return true if orderable item is a supply
"RTN","ORBCMA32",161,0)
 S VAL=0
"RTN","ORBCMA32",162,0)
 I $P($G(^ORD(101.43,IEN,"PS")),U,5)=1 S VAL=1
"RTN","ORBCMA32",163,0)
 Q
"RTN","ORBCMA32",164,0)
IVAMT(VAL,OI,ORWTYP)     ; return UNITS^AMOUNT |^AMOUNT^AMOUNT...| for IV soln
"RTN","ORBCMA32",165,0)
 N I,PSOI,ORWY,AMT,IVFLAG
"RTN","ORBCMA32",166,0)
 S IVFLAG=$P(OI,U,2)
"RTN","ORBCMA32",167,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2)_ORWTYP,VAL=""
"RTN","ORBCMA32",168,0)
 I IVFLAG="NF" D ENVOL2^PSJORUT2(PSOI,.ORWY)
"RTN","ORBCMA32",169,0)
 I IVFLAG="" D ENVOL^PSJORUT2(PSOI,.ORWY)
"RTN","ORBCMA32",170,0)
 I ORWTYP="B" D
"RTN","ORBCMA32",171,0)
 . S I=0 F  S I=$O(ORWY(I)) Q:I'>0  S AMT(+ORWY(I))=""
"RTN","ORBCMA32",172,0)
 . S AMT=0,VAL="ML" F  S AMT=$O(AMT(AMT)) Q:AMT'>0  S VAL=VAL_U_AMT
"RTN","ORBCMA32",173,0)
 I ORWTYP="A" D
"RTN","ORBCMA32",174,0)
 . S I=+$O(ORWY(0)) S VAL=$P($G(ORWY(I)),U,2)
"RTN","ORBCMA32",175,0)
 . I '$L(VAL) S VAL="ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU"
"RTN","ORBCMA32",176,0)
 Q
"RTN","ORBCMA32",177,0)
VALRATE(VAL,X)   ; return "1" (true) if IV rate text is valid
"RTN","ORBCMA32",178,0)
 I $E($RE($$UPPER(X)),1,5)="RH/LM"  S X=$E(X,1,$L(X)-5)
"RTN","ORBCMA32",179,0)
 S X=$$TRIM(X)
"RTN","ORBCMA32",180,0)
 D ORINF^PSIVSP S VAL=$G(X) ;S OK=$S($D(X):1,1:0)
"RTN","ORBCMA32",181,0)
 Q
"RTN","ORBCMA32",182,0)
UPPER(X) ; return uppercase
"RTN","ORBCMA32",183,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ORBCMA32",184,0)
 ;
"RTN","ORBCMA32",185,0)
TRIM(X) ; trim leading and trailing spaces
"RTN","ORBCMA32",186,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;trail
"RTN","ORBCMA32",187,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;lead
"RTN","ORBCMA32",188,0)
 Q X
"RTN","ORBCMA32",189,0)
SCSTS(VAL,ORVP,ORDRUG)  ; return service connected eligibility for patient
"RTN","ORBCMA32",190,0)
 N ORWP94 S ORWP94=$O(^ORD(101.41,"AB","PS MEDS",0))>0
"RTN","ORBCMA32",191,0)
 I $L($T(SC^PSOCP)),$$SC^PSOCP(+ORVP,+$G(ORDRUG)) S VAL=0 G XSCSTS
"RTN","ORBCMA32",192,0)
 I 'ORWP94,(+$$RXST^IBARXEU(+ORVP)>0) S VAL=0 G XSCSTS
"RTN","ORBCMA32",193,0)
 S VAL=1
"RTN","ORBCMA32",194,0)
XSCSTS Q
"RTN","ORBCMA32",195,0)
FORMALT(ORLST,IEN,PSTYPE) ; return a list of formulary alternatives
"RTN","ORBCMA32",196,0)
 D ENRFA^PSJORUTL(IEN,PSTYPE,.ORLST)
"RTN","ORBCMA32",197,0)
 S I=0 F  S I=$O(ORLST(I)) Q:'I  D
"RTN","ORBCMA32",198,0)
 . S OI=+$O(^ORD(101.43,"ID",+$P(ORLST(I),U,4)_";99PSP",0))
"RTN","ORBCMA32",199,0)
 . S $P(ORLST(I),U,4)=OI I OI S $P(ORLST(I),U,5)=$P(^ORD(101.43,OI,0),U)
"RTN","ORBCMA32",200,0)
 Q
"RTN","ORBCMA32",201,0)
VALSCH(OK,X,PSTYPE)    ; validate a schedule, return 1 if valid, 0 if not
"RTN","ORBCMA32",202,0)
 I '$L($T(EN^PSSGSGUI)) S OK=-1 Q
"RTN","ORBCMA32",203,0)
 I $E($T(EN^PSSGSGUI),1,4)="EN(X" D
"RTN","ORBCMA32",204,0)
 . N ORX S ORX=$G(X) D EN^PSSGSGUI(.ORX,$G(PSTYPE,"I"))
"RTN","ORBCMA32",205,0)
 . K X S:$D(ORX) X=ORX
"RTN","ORBCMA32",206,0)
 E  D
"RTN","ORBCMA32",207,0)
 . D EN^PSSGSGUI
"RTN","ORBCMA32",208,0)
 S OK=$S($D(X):1,1:0)
"RTN","ORBCMA32",209,0)
 Q
"RTN","ORBCMA32",210,0)
VALQTY(OK,X)    ; validate a quantity, return 1 if valid, 0 if not
"RTN","ORBCMA32",211,0)
 ; to be compatible with LM, make sure X is integer from 1 to 240
"RTN","ORBCMA32",212,0)
 ; this is based on the input transform from 52,7
"RTN","ORBCMA32",213,0)
 K:(+X'>0)!(+X>99999999)!(X'?.8N.1".".2N)!($L(X)>12) X
"RTN","ORBCMA32",214,0)
 S OK=$S($D(X):1,1:0)
"RTN","ORBCMA32",215,0)
 Q
"RTN","ORBCMA32",216,0)
DOSES(LST,OI) ; return doses for an orderable item  -  TEST ONLY
"RTN","ORBCMA32",217,0)
 N ORTMP,ORI,ORJ,ILST,NDF,VAPN,X,PSTYPE S PSTYPE="O"
"RTN","ORBCMA32",218,0)
 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP)
"RTN","ORBCMA32",219,0)
 S ORI=0 F  S ORI=$O(ORTMP(ORI)) Q:'ORI  S ORWDRG=+ORTMP(ORI) D
"RTN","ORBCMA32",220,0)
 . S NDF=$G(^PSDRUG(+ORWDRG,"ND")),VAPN=$P(NDF,U,3),NDF=+NDF
"RTN","ORBCMA32",221,0)
 . S X=$$DFSU^PSNAPIS(NDF,VAPN)
"RTN","ORBCMA32",222,0)
 . S LSTA($P(X,U,4),$P(X,U,6))=""
"RTN","ORBCMA32",223,0)
 . I +$P(X,U,4)=$P(X,U,4) S LSTA($P(X,U,4)*2,$P(X,U,6))=""
"RTN","ORBCMA32",224,0)
 S ORI="",ILST=0 F  S ORI=$O(LSTA(ORI)) Q:ORI=""  D
"RTN","ORBCMA32",225,0)
 . S ORJ="" F  S ORJ=$O(LSTA(ORI,ORJ)) Q:ORJ=""  D
"RTN","ORBCMA32",226,0)
 . . S ILST=ILST+1,LST(ILST)=ORI_" "_ORJ
"RTN","ORBCMA32",227,0)
 Q
"RTN","ORBCMA5")
0^9^B3393504
"RTN","ORBCMA5",1,0)
ORBCMA5 ; SLC/JDL - BCMA Order utility ;2/18/02  13:37
"RTN","ORBCMA5",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**133**;Dec 17, 1997
"RTN","ORBCMA5",3,0)
 ;;BCMA ORDER UTITLITY;**133**;12/12/2001 
"RTN","ORBCMA5",4,0)
 ;
"RTN","ORBCMA5",5,0)
GETUDID(Y,INFO) ; Get Unit/Dose Order Form ID
"RTN","ORBCMA5",6,0)
 S Y=$O(^ORD(101.41,"B","PSJ OR PAT OE",0))
"RTN","ORBCMA5",7,0)
 S:$L(Y)<1 Y=0
"RTN","ORBCMA5",8,0)
 Q
"RTN","ORBCMA5",9,0)
GETIVID(Y,INFO) ; Get IV Order Form ID
"RTN","ORBCMA5",10,0)
 S Y=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE",0))
"RTN","ORBCMA5",11,0)
 S:$L(Y)<1 Y=0
"RTN","ORBCMA5",12,0)
 Q
"RTN","ORBCMA5",13,0)
GETUD(Y,ODITM) ; get unit dose orderable item
"RTN","ORBCMA5",14,0)
 ; ODITM: Orderable item ien
"RTN","ORBCMA5",15,0)
 N DGIDX,OIIEN,UDIEN
"RTN","ORBCMA5",16,0)
 S DGIDX=0
"RTN","ORBCMA5",17,0)
 S UDIEN=$O(^ORD(101.44,"B","ORWDSET UD RX",0))
"RTN","ORBCMA5",18,0)
 F  S DGIDX=$O(^ORD(101.44,UDIEN,20,DGIDX)) Q:'DGIDX  D
"RTN","ORBCMA5",19,0)
 . S OIIEN=$P(^ORD(101.44,UDIEN,20,DGIDX,0),U,1)
"RTN","ORBCMA5",20,0)
 . I OIIEN=ODITM S Y=^ORD(101.44,UDIEN,20,DGIDX,0)
"RTN","ORBCMA5",21,0)
 K DGIDX,OIIEN,UDIEN
"RTN","ORBCMA5",22,0)
 Q
"RTN","ORBCMA5",23,0)
ODITMBC(Y,XREF,ODLST) ; --Return orderable items info based on ItemIen
"RTN","ORBCMA5",24,0)
 N CNT,NUM,XRF
"RTN","ORBCMA5",25,0)
 S CNT=0,NUM=0,XRF=""
"RTN","ORBCMA5",26,0)
 S:$L(XREF) XRF=XREF
"RTN","ORBCMA5",27,0)
 F  S CNT=$O(ODLST(CNT)) Q:'CNT  D FNDINFO(.Y,ODLST(CNT))
"RTN","ORBCMA5",28,0)
 Q
"RTN","ORBCMA5",29,0)
FNDINFO(Y,ODIEN) ;
"RTN","ORBCMA5",30,0)
 N ODI,CRTM,FRM,XX,FINDIT
"RTN","ORBCMA5",31,0)
 S XX="",FINDIT=0
"RTN","ORBCMA5",32,0)
 S FRM="",CRTM=$$NOW^XLFDT
"RTN","ORBCMA5",33,0)
 F  S FRM=$O(^ORD(101.43,XRF,FRM)) Q:FRM=""  D
"RTN","ORBCMA5",34,0)
 . S ODI=0 F  S ODI=$O(^ORD(101.43,XRF,FRM,ODI)) Q:'ODI  D
"RTN","ORBCMA5",35,0)
 .. S XX=^ORD(101.43,XRF,FRM,ODI)
"RTN","ORBCMA5",36,0)
 .. I +$P(XX,U,3),$P(XX,U,3)<CRTM Q
"RTN","ORBCMA5",37,0)
 .. I ODI=+ODIEN D
"RTN","ORBCMA5",38,0)
 ... S NUM=NUM+1,FINDIT=1
"RTN","ORBCMA5",39,0)
 ... I 'XX S Y(NUM)=ODIEN_U_$P(XX,U,2)_U_$P(XX,U,2)
"RTN","ORBCMA5",40,0)
 ... E  S Y(NUM)=ODIEN_U_$P(XX,U,2)_$C(9)_"<"_$P(XX,U,4)_">"_U_$P(XX,U,4)
"RTN","ORBCMA5",41,0)
 I FINDIT=0 D
"RTN","ORBCMA5",42,0)
 . S:$D(^ORD(101.43,+ODIEN,0)) XX=^ORD(101.43,+ODIEN,0)
"RTN","ORBCMA5",43,0)
 . S NUM=NUM+1
"RTN","ORBCMA5",44,0)
 . S:$L(XX) Y(NUM)=ODIEN_U_$P(XX,U)_U_$P(XX,U)_U_"NF"
"RTN","ORBCMA5",45,0)
 Q
"RTN","ORMBLD")
0^3^B30961474
"RTN","ORMBLD",1,0)
ORMBLD ; SLC/MKB - Build outgoing ORM msgs ;11/24/00  13:09
"RTN","ORMBLD",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,33,26,45,79,97,133**;Dec 17, 1997
"RTN","ORMBLD",3,0)
NEW(IFN,CODE) ; -- Send NW order message to pkg
"RTN","ORMBLD",4,0)
 ;I $P($G(^ORD(101.42,+$$VALUE^ORCSAVE2(IFN,"URGENCY"),0)),U)="DONE" D STATUS^ORCSAVE2(IFN,2) Q  ; complete -> don't send to pkg
"RTN","ORMBLD",5,0)
 N ORPKG,ORMSG,DGQUIET K ^TMP("ORWORD",$J)
"RTN","ORMBLD",6,0)
 S DGQUIET=1 D  Q:'$O(ORMSG(0))  ;build msg, ORDIALOG gone when posted
"RTN","ORMBLD",7,0)
 . N OR0,OR8,ORVP,ORDG,ORDIALOG S:'$D(CODE) CODE="NW"
"RTN","ORMBLD",8,0)
 . S OR0=$G(^OR(100,IFN,0)) Q:'$L(OR0)  S OR8=$G(^(8,1,0))
"RTN","ORMBLD",9,0)
 . S ORVP=$P(OR0,U,2),ORDG=$P(OR0,U,11),ORPKG=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORMBLD",10,0)
 . Q:"^GMRA^GMRC^FH^LR^PS^RA^OR^"'[(U_ORPKG_U)
"RTN","ORMBLD",11,0)
 . S ORDIALOG=+$P(OR0,U,5) Q:'ORDIALOG
"RTN","ORMBLD",12,0)
 . D GETDLG1^ORCD(ORDIALOG),GETORDER^ORCD(IFN)
"RTN","ORMBLD",13,0)
 . S ORMSG(1)=$$MSH("ORM",ORPKG),ORMSG(2)=$$PID(ORVP)
"RTN","ORMBLD",14,0)
 . S ORMSG(3)=$$PV1(ORVP,$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORMBLD",15,0)
 . S ORMSG(4)="ORC|"_CODE_"|"_+OR0_";1^OR|||||||"_$$HL7DATE($P(OR0,U,7))_"|"_+$P(OR0,U,6)_"||"_+$P(OR0,U,4)_"|||"_$$HL7DATE($$NOW^XLFDT)_"|"_$$NATURE($P(OR8,U,12))_"^^^"
"RTN","ORMBLD",16,0)
 . D @ORPKG K ^TMP("ORWORD",$J)
"RTN","ORMBLD",17,0)
 I $G(ORZTEST) M ORZTEST=ORMSG Q  ;testing only
"RTN","ORMBLD",18,0)
 D MSG^XQOR("OR EVSEND "_ORPKG,.ORMSG)
"RTN","ORMBLD",19,0)
 Q
"RTN","ORMBLD",20,0)
 ;
"RTN","ORMBLD",21,0)
MSG(IFN,CODE,REASON) ; -- Send all other order msgs
"RTN","ORMBLD",22,0)
 N ORPKG,ORMSG,DGQUIET K ^TMP("ORWORD",$J)
"RTN","ORMBLD",23,0)
 S DGQUIET=1 D  Q:'$O(ORMSG(0))  ; build message
"RTN","ORMBLD",24,0)
 . N OR0,OR8,DG,PKGID,I,TYPE,DA,PROV,NATR,STS,OI
"RTN","ORMBLD",25,0)
 . S OR0=$G(^OR(100,+IFN,0)),PKGID=$G(^(4)),STS=$P($G(^(3)),U,3)
"RTN","ORMBLD",26,0)
 . S ORPKG=$$NMSP^ORCD($P(OR0,U,14)) Q:"^GMRA^GMRC^FH^LR^PS^RA^OR^"'[(U_ORPKG_U)  S:ORPKG="LR" ORPKG="LRCH"
"RTN","ORMBLD",27,0)
 . S DA=+$P(IFN,";",2),OR8=$G(^OR(100,+IFN,8,DA,0))
"RTN","ORMBLD",28,0)
 . S PROV=$P(OR8,U,3),NATR=$P(OR8,U,12) S:'PROV PROV=$G(ORNP)
"RTN","ORMBLD",29,0)
 . S TYPE=$S(CODE="NA"!(CODE="DE"):"ORR",1:"ORM")
"RTN","ORMBLD",30,0)
 . S ORMSG(1)=$$MSH(TYPE,ORPKG),ORMSG(2)=$$PID($P(OR0,U,2)),I=2
"RTN","ORMBLD",31,0)
 . I ORPKG="PS" S I=I+1,ORMSG(I)=$$PV1($P(OR0,U,2),$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORMBLD",32,0)
 . S I=I+1,ORMSG(I)="ORC|"_CODE_"|"_IFN_"^OR|"_PKGID_U_ORPKG_"|||||||"_DUZ_"||"_PROV_"|||"_$$HL7DATE($$NOW^XLFDT)_"|"_$$REASON(+$G(REASON),NATR)
"RTN","ORMBLD",33,0)
 . I ORPKG="FH",CODE="SS" S $P(ORMSG(I),"|",6)=$S(STS=8:"SC",STS=6:"IP",1:"")
"RTN","ORMBLD",34,0)
 . I $E(ORPKG,1,2)="LR" S OI=+$O(^OR(100,+IFN,.1,0)),OI=+$G(^(OI,0)) S:OI I=I+1,ORMSG(I)="OBR||||"_$$USID(OI)
"RTN","ORMBLD",35,0)
 . K ^TMP("ORWORD",$J)
"RTN","ORMBLD",36,0)
 D MSG^XQOR("OR EVSEND "_ORPKG,.ORMSG)
"RTN","ORMBLD",37,0)
 Q
"RTN","ORMBLD",38,0)
 ;
"RTN","ORMBLD",39,0)
BHS(PAT) ; -- Send batch header segment/message to Lab
"RTN","ORMBLD",40,0)
 N ORMSG S ORMSG(1)="BHS|^~\&|ORDER ENTRY|"_$G(DUZ(2))_"|LABORATORY|"_$G(DUZ(2))_"|"_$$HL7DATE($$NOW^XLFDT)
"RTN","ORMBLD",41,0)
 S ORMSG(2)=$$PID($G(PAT))
"RTN","ORMBLD",42,0)
 D MSG^XQOR("OR EVSEND LRCH",.ORMSG)
"RTN","ORMBLD",43,0)
 Q
"RTN","ORMBLD",44,0)
 ;
"RTN","ORMBLD",45,0)
BTS(PAT) ; -- Send batch trailer segment/message to Lab
"RTN","ORMBLD",46,0)
 N ORMSG S ORMSG(1)="BTS",ORMSG(2)=$$PID($G(PAT))
"RTN","ORMBLD",47,0)
 D MSG^XQOR("OR EVSEND LRCH",.ORMSG)
"RTN","ORMBLD",48,0)
 Q
"RTN","ORMBLD",49,0)
 ;
"RTN","ORMBLD",50,0)
MSH(TYPE,TO) ; -- MSH segment
"RTN","ORMBLD",51,0)
 N MSH
"RTN","ORMBLD",52,0)
 S MSH="MSH|^~\&|ORDER ENTRY|"_$G(DUZ(2))_"|"_$$NAME(TO)_"|"_$G(DUZ(2))_"|"_$$HL7DATE($$NOW^XLFDT)_"||"_TYPE
"RTN","ORMBLD",53,0)
 Q MSH
"RTN","ORMBLD",54,0)
 ;
"RTN","ORMBLD",55,0)
NAME(NMSP) ; -- Returns name of pkg NMSP
"RTN","ORMBLD",56,0)
 I NMSP="GMRA" Q "ALLERGIES"
"RTN","ORMBLD",57,0)
 I NMSP="GMRC" Q "CONSULTS"
"RTN","ORMBLD",58,0)
 I NMSP="FH" Q "DIETETICS"
"RTN","ORMBLD",59,0)
 I NMSP?1"LR".E Q "LABORATORY"
"RTN","ORMBLD",60,0)
 I NMSP="PS" Q "PHARMACY"
"RTN","ORMBLD",61,0)
 I NMSP="RA" Q "RADIOLOGY"
"RTN","ORMBLD",62,0)
 I NMSP="OR" Q "ORDER ENTRY"
"RTN","ORMBLD",63,0)
 Q ""
"RTN","ORMBLD",64,0)
 ;
"RTN","ORMBLD",65,0)
PID(DFN) ; -- PID segment
"RTN","ORMBLD",66,0)
 N PID,PTR,ROOT
"RTN","ORMBLD",67,0)
 S PTR=+$P(DFN,";"),ROOT=$P(DFN,";",2),PID="PID|||"
"RTN","ORMBLD",68,0)
 I ROOT="DPT(" S PID=PID_PTR_"||"_$P($G(^DPT(PTR,0)),U)
"RTN","ORMBLD",69,0)
 E  S PID=PID_"|"_DFN_"|"_$S($L(ROOT):$P($G(@(U_ROOT_PTR_",0)")),U),1:"")
"RTN","ORMBLD",70,0)
 Q PID
"RTN","ORMBLD",71,0)
 ;
"RTN","ORMBLD",72,0)
PV1(OBJ,TYPE,LOC,VISIT) ; -- PV1 segment
"RTN","ORMBLD",73,0)
 N PV1,RB S RB=""
"RTN","ORMBLD",74,0)
 I TYPE="I",+OBJ,$P(OBJ,";",2)="DPT(" S RB=$P($G(^DPT(+OBJ,.101)),U)
"RTN","ORMBLD",75,0)
 S PV1="PV1||"_TYPE_"|"_LOC_$S($L(RB):U_RB,1:"")_"||||||||||||||||"_$G(VISIT)
"RTN","ORMBLD",76,0)
 Q PV1
"RTN","ORMBLD",77,0)
 ;
"RTN","ORMBLD",78,0)
HL7DATE(DATE) ; -- FM -> HL7 format
"RTN","ORMBLD",79,0)
 Q $$FMTHL7^XLFDT(DATE)  ;**97
"RTN","ORMBLD",80,0)
 ;
"RTN","ORMBLD",81,0)
USID(OI) ; -- Returns Univ Serv ID for Orderable Item
"RTN","ORMBLD",82,0)
 N OITEM,NATL,LOCAL S OITEM=$G(^ORD(101.43,+OI,0))
"RTN","ORMBLD",83,0)
 S NATL=$P(OITEM,U,3)_U_U_$P(OITEM,U,4)
"RTN","ORMBLD",84,0)
 S LOCAL=$P($P(OITEM,U,2),";")_U_$P(OITEM,U)_U_$P($P(OITEM,U,2),";",2)
"RTN","ORMBLD",85,0)
 Q NATL_U_LOCAL
"RTN","ORMBLD",86,0)
 ;
"RTN","ORMBLD",87,0)
NATURE(X) ; -- Returns 3 ^-piece identifier for nature X
"RTN","ORMBLD",88,0)
 N ORN,Y S ORN=$G(^ORD(100.02,+$G(X),0))
"RTN","ORMBLD",89,0)
 S Y=$P(ORN,U,2)_U_$P(ORN,U)_"^99ORN"
"RTN","ORMBLD",90,0)
 Q Y
"RTN","ORMBLD",91,0)
 ;
"RTN","ORMBLD",92,0)
REASON(X,N) ; -- Returns 6 ^-piece format of reason X
"RTN","ORMBLD",93,0)
 ;    N ^ NATURE ^ 99ORN ^ # ^ Reason ^ 99ORR
"RTN","ORMBLD",94,0)
 N Y,ORR S ORR=$G(^ORD(100.03,+$G(X),0))
"RTN","ORMBLD",95,0)
 S:'$G(N) N=+$P(ORR,U,7) S Y=$$NATURE(N)
"RTN","ORMBLD",96,0)
 S:$G(X) Y=Y_U_$S(ORPKG'="RA":+X,1:"")_U_$P(ORR,U)_"^99ORR"
"RTN","ORMBLD",97,0)
 Q Y
"RTN","ORMBLD",98,0)
 ;
"RTN","ORMBLD",99,0)
IP() ; -- Returns ORIFN^Type if pt has active isolation order (or 0 if not)
"RTN","ORMBLD",100,0)
 N TYPE,START,ORIFN,Y
"RTN","ORMBLD",101,0)
 S TYPE=$O(^ORD(100.98,"B","PREC",0)),START=$$NOW^XLFDT,Y=0
"RTN","ORMBLD",102,0)
 F  S START=$O(^OR(100,"AW",ORVP,TYPE,START),-1) Q:START'>0  S ORIFN=$O(^(START,0)) I $P($G(^OR(100,ORIFN,3)),U,3)=6 S Y=ORIFN Q
"RTN","ORMBLD",103,0)
 I Y S TYPE=$$VALUE^ORCSAVE2(ORIFN,"ISOLATION"),Y=Y_U_$$GET1^DIQ(119.4,+TYPE_",",.01)
"RTN","ORMBLD",104,0)
 Q Y
"RTN","ORMBLD",105,0)
 ;
"RTN","ORMBLD",106,0)
OR ; -- new Generic order
"RTN","ORMBLD",107,0)
 I ORDG=$O(^ORD(100.98,"B","M.A.S.",0)) D ADT^ORMBLDOR Q
"RTN","ORMBLD",108,0)
 D EN^ORMBLDOR
"RTN","ORMBLD",109,0)
 Q
"RTN","ORMBLD",110,0)
 ;
"RTN","ORMBLD",111,0)
GMRA ; -- new Allergy order
"RTN","ORMBLD",112,0)
 D ALG^ORMBLDAL
"RTN","ORMBLD",113,0)
 Q
"RTN","ORMBLD",114,0)
 ;
"RTN","ORMBLD",115,0)
GMRC ; -- new Consult order
"RTN","ORMBLD",116,0)
 D CSLT^ORMBLDGM
"RTN","ORMBLD",117,0)
 Q
"RTN","ORMBLD",118,0)
 ;
"RTN","ORMBLD",119,0)
FH ; -- new Diet order
"RTN","ORMBLD",120,0)
 N ORPARAM D EN^FHWOR8(+ORVP,.ORPARAM) ; set parameters
"RTN","ORMBLD",121,0)
 S:'$L($G(ORPARAM(3))) ORPARAM(3)="T"
"RTN","ORMBLD",122,0)
 I ORDG=$O(^ORD(100.98,"B","PRECAUTIONS",0)) D IP^ORMBLDFH Q
"RTN","ORMBLD",123,0)
 I ORDG=$O(^ORD(100.98,"B","EARLY/LATE TRAYS",0)) D TRAY^ORMBLDFH Q
"RTN","ORMBLD",124,0)
 I ORDG=$O(^ORD(100.98,"B","TUBEFEEDINGS",0)) D TF^ORMBLDFH Q
"RTN","ORMBLD",125,0)
 I ORDG=$O(^ORD(100.98,"B","DIET ADDITIONAL ORDERS",0)) D ADDN^ORMBLDFH Q
"RTN","ORMBLD",126,0)
 D DIET^ORMBLDFH
"RTN","ORMBLD",127,0)
 Q
"RTN","ORMBLD",128,0)
 ;
"RTN","ORMBLD",129,0)
LR ; -- new Lab order
"RTN","ORMBLD",130,0)
 I CODE="XO" D XO^ORMBLDLR Q  ; change
"RTN","ORMBLD",131,0)
 D CH^ORMBLDLR S ORPKG="LRCH" Q  ;no difference by subscript at this time
"RTN","ORMBLD",132,0)
 N SUB S SUB=$P($G(^ORD(100.98,ORDG,0)),U,3)
"RTN","ORMBLD",133,0)
 S:(SUB="SP")!(SUB="EM")!(SUB="AU")!(SUB="CY") SUB="AP"
"RTN","ORMBLD",134,0)
 S:(SUB="LAB")!(SUB="MI")!(SUB="HEMA") SUB="CH"
"RTN","ORMBLD",135,0)
 D @(SUB_"^ORMBLDLR") S ORPKG=ORPKG_SUB
"RTN","ORMBLD",136,0)
 Q
"RTN","ORMBLD",137,0)
 ;
"RTN","ORMBLD",138,0)
PS ; -- new Pharmacy order
"RTN","ORMBLD",139,0)
 ;I ORDG=$O(^ORD(100.98,"B","OUTPATIENT MEDICATIONS",0)) D OUT^ORMBLDPS Q
"RTN","ORMBLD",140,0)
 ;I ORDG=$O(^ORD(100.98,"B","IV MEDICATIONS",0)) D IV^ORMBLDPS Q
"RTN","ORMBLD",141,0)
 ;D UD^ORMBLDPS
"RTN","ORMBLD",142,0)
 N PKG S PKG=$P(OR0,U,14),PKG=$$GET1^DIQ(9.4,+PKG_",",1)
"RTN","ORMBLD",143,0)
 I PKG="PSO",+$$VALUE^ORCSAVE2(IFN,"URGENCY")=99 D STATUS^ORCSAVE2(IFN,2) K ORMSG Q  ;complete, don't send
"RTN","ORMBLD",144,0)
 D @($S(PKG="PSIV":"IV",PKG="PSO":"OUT",1:"UD")_"^ORMBLDPS")
"RTN","ORMBLD",145,0)
 Q
"RTN","ORMBLD",146,0)
 ;
"RTN","ORMBLD",147,0)
RA ; -- new Radiology order
"RTN","ORMBLD",148,0)
 D EN^ORMBLDRA
"RTN","ORMBLD",149,0)
 Q
"RTN","ORMBLD",150,0)
 ;
"RTN","ORMBLD",151,0)
TEST(ORIFN) ; -- Build/display HL7 msgs w/o sending
"RTN","ORMBLD",152,0)
 K ORZTEST S ORZTEST=1 D NEW(ORIFN) ; leaves msg in ORZTEST() on exit
"RTN","ORMBLD",153,0)
 Q
"RTN","ORWUBCMA")
0^1^B6025108
"RTN","ORWUBCMA",1,0)
ORWUBCMA ; SLC/KCM/JLI - General Utilites for Windows Calls; 1/12/02
"RTN","ORWUBCMA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**133**;Dec 17, 1997
"RTN","ORWUBCMA",3,0)
 ;;OR BCMA ORDER COM;**133**;1/10/2002
"RTN","ORWUBCMA",4,0)
 ;
"RTN","ORWUBCMA",5,0)
USERINFO(REC) ; return relevant info for current user
"RTN","ORWUBCMA",6,0)
 ; return DUZ^NAME^USRCLS^CANSIGN^ISPROVIDER^ORDERROLE^NOORDER^DTIME^
"RTN","ORWUBCMA",7,0)
 ;        COUNTDOWN^ENABLEVERIFY^NOTIFYAPPS^MSGHANG^DOMAIN^SERVICE^
"RTN","ORWUBCMA",8,0)
 ;        AUTOSAVE^INITTAB^LASTTAB
"RTN","ORWUBCMA",9,0)
 N X
"RTN","ORWUBCMA",10,0)
 S REC=DUZ_U_$P(^VA(200,DUZ,0),U)
"RTN","ORWUBCMA",11,0)
 S $P(REC,U,3)=$S($D(^XUSEC("ORES",DUZ)):3,$D(^XUSEC("ORELSE",DUZ)):2,$D(^XUSEC("OREMAS",DUZ)):1,1:0)
"RTN","ORWUBCMA",12,0)
 S $P(REC,U,4)=$D(^XUSEC("ORES",DUZ))&$D(^XUSEC("PROVIDER",DUZ))
"RTN","ORWUBCMA",13,0)
 S $P(REC,U,5)=$D(^XUSEC("PROVIDER",DUZ))
"RTN","ORWUBCMA",14,0)
 S $P(REC,U,6)=$$ORDROLE
"RTN","ORWUBCMA",15,0)
 S $P(REC,U,7)=$$GET^XPAR("USR^SYS^PKG","ORWOR DISABLE ORDERING",1,"I")
"RTN","ORWUBCMA",16,0)
 S $P(REC,U,8)=$$GET^XPAR("USR^SYS","ORWOR TIMEOUT CHART",1,"I")
"RTN","ORWUBCMA",17,0)
 I '$P(REC,U,8),$G(DTIME) S $P(REC,U,8)=DTIME
"RTN","ORWUBCMA",18,0)
 S $P(REC,U,9)=$$GET^XPAR("USR^SYS^PKG","ORWOR TIMEOUT COUNTDOWN",1,"I")
"RTN","ORWUBCMA",19,0)
 S X=$$GET^XPAR("USR^SYS^PKG","ORWOR ENABLE VERIFY",1,"I")
"RTN","ORWUBCMA",20,0)
 S $P(REC,U,10)=$S(X=1:1,X=2:0,1:'$P(REC,U,7))
"RTN","ORWUBCMA",21,0)
 S $P(REC,U,11)=$$GET^XPAR("USR^SYS^PKG","ORWOR BROADCAST MESSAGES",1,"I")
"RTN","ORWUBCMA",22,0)
 S $P(REC,U,12)=$$GET^XPAR("USR^SYS^PKG","ORWOR AUTO CLOSE PT MSG",1,"I")
"RTN","ORWUBCMA",23,0)
 S $P(REC,U,13)=$$KSP^XUPARAM("WHERE")  ; domain
"RTN","ORWUBCMA",24,0)
 S $P(REC,U,14)=+$G(^VA(200,DUZ,5))     ; service/section
"RTN","ORWUBCMA",25,0)
 S $P(REC,U,15)=$$GET^XPAR("USR^SYS^PKG","ORWOR AUTOSAVE NOTE",1,"I")
"RTN","ORWUBCMA",26,0)
 S $P(REC,U,16)=$$GET^XPAR("USR^DIV^SYS^PKG","ORCH INITIAL TAB",1,"I")
"RTN","ORWUBCMA",27,0)
 S $P(REC,U,17)=$$GET^XPAR("USR^DIV^SYS^PKG","ORCH USE LAST TAB",1,"I")
"RTN","ORWUBCMA",28,0)
 S $P(REC,U,18)=$$GET^XPAR("USR^DIV^SYS^PKG","ORWOR DISABLE WEB ACCESS",1,"I")
"RTN","ORWUBCMA",29,0)
 S $P(REC,U,19)=$$GET^XPAR("SYS^PKG","ORWOR DISABLE HOLD ORDERS",1,"I")
"RTN","ORWUBCMA",30,0)
 Q
"RTN","ORWUBCMA",31,0)
ORDROLE()    ; returns the role a person takes in ordering
"RTN","ORWUBCMA",32,0)
 ; VAL: 0=nokey, 1=clerk, 2=nurse, 3=physician, 4=student, 5=bad keys
"RTN","ORWUBCMA",33,0)
 I ($D(^XUSEC("OREMAS",DUZ))+$D(^XUSEC("ORELSE",DUZ))+$D(^XUSEC("ORES",DUZ)))>1 Q 5
"RTN","ORWUBCMA",34,0)
 I $D(^XUSEC("OREMAS",DUZ)) Q 1                           ; clerk
"RTN","ORWUBCMA",35,0)
 I $D(^XUSEC("ORELSE",DUZ)) Q 2                           ; nurse
"RTN","ORWUBCMA",36,0)
 I $D(^XUSEC("ORES",DUZ)),$D(^XUSEC("PROVIDER",DUZ)) Q 3  ; doctor
"RTN","ORWUBCMA",37,0)
 I $D(^XUSEC("PROVIDER",DUZ)) Q 4                         ; student
"RTN","ORWUBCMA",38,0)
 Q 0
"RTN","ORY133")
0^7^B214325
"RTN","ORY133",1,0)
ORY133 ;SLC/MKB - Postinit for patch OR*3*133 ;1/18/02  12:20
"RTN","ORY133",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**133**;Dec 17, 1997
"RTN","ORY133",3,0)
 ;
"RTN","ORY133",4,0)
POST ; -- postinit
"RTN","ORY133",5,0)
 S ^ORD(101.42,99,0)="DONE^ZD",^ORD(101.42,"C","ZD",99)="" ;+abbreviation
"RTN","ORY133",6,0)
 Q
"VER")
8.0^22.0
**END**
**END**
