Released PSO*7*233 SEQ #218
Extracted from mail message
**KIDS**:PSO*7.0*233^

**INSTALL NAME**
PSO*7.0*233
"BLD",5807,0)
PSO*7.0*233^OUTPATIENT PHARMACY^0^3060901^y
"BLD",5807,1,0)
^^195^195^3060901^
"BLD",5807,1,1,0)
This patch enhances the usage of Application Program Interfaces (APIs) to
"BLD",5807,1,2,0)
the Registration Package V. 5.3 to check the setting of the BAD ADDRESS
"BLD",5807,1,3,0)
INDICATOR field (#.121) in the PATIENT file (#2) and to update the
"BLD",5807,1,4,0)
permanent and temporary addresses. The BAD ADDRESS INDICATOR (referred to
"BLD",5807,1,5,0)
as BAI in this description) is one of the fields presented when using the
"BLD",5807,1,6,0)
API to update permanent address fields.
"BLD",5807,1,7,0)
 
"BLD",5807,1,8,0)
Outpatient Pharmacy V. 7.0 options are modified to not print the 
"BLD",5807,1,9,0)
patient's address if a bad address is indicated and to prompt to update
"BLD",5807,1,10,0)
the patient's address when appropriate. If the patient has the BAD ADDRESS
"BLD",5807,1,11,0)
INDICATOR field set and no active temporary address, this is referred to
"BLD",5807,1,12,0)
as a BAI condition in this description.
"BLD",5807,1,13,0)
 
"BLD",5807,1,14,0)
Note: Related changes for the Outpatient Pharmacy Automation Interface
"BLD",5807,1,15,0)
(OPAI) and Consolidated Mail Outpatient Pharmacy (CMOP) will be done in
"BLD",5807,1,16,0)
patches PSO*7*200 and PSX*2*54.
"BLD",5807,1,17,0)
 
"BLD",5807,1,18,0)
 
"BLD",5807,1,19,0)
The following changes are made in this patch:
"BLD",5807,1,20,0)
 
"BLD",5807,1,21,0)
1. A new security key PSO ADDRESS UPDATE is added. Either the EDIT 
"BLD",5807,1,22,0)
PATIENT DATA field (#.123) in the PSO SITE file (#59) must be set to 
"BLD",5807,1,23,0)
"Yes" or the user must have this new security key in order to be
"BLD",5807,1,24,0)
prompted to update the address (permanent and/or temporary addresses).
"BLD",5807,1,25,0)
 
"BLD",5807,1,26,0)
2. When selecting a patient name in the Patient Prescription Processing 
"BLD",5807,1,27,0)
[PSO LM BACKDOOR ORDERS] option, if the patient's address is flagged with
"BLD",5807,1,28,0)
a Bad Address Indicator, then a warning message is displayed. If the 
"BLD",5807,1,29,0)
EDIT PATIENT DATA is set to Yes or the user holds the new
"BLD",5807,1,30,0)
PSO ADDRESS UPDATE security key, he will be asked if he wants to update
"BLD",5807,1,31,0)
the patient's address. If there is a valid temporary address, a message to
"BLD",5807,1,32,0)
that effect is displayed before the prompt to update the address.
"BLD",5807,1,33,0)
 
"BLD",5807,1,34,0)
Example:
"BLD",5807,1,35,0)
  PSOOUTPATIENT,ONE (000-00-0777)
"BLD",5807,1,36,0)
 
"BLD",5807,1,37,0)
        WARNING: The patient address is indicated as a bad
"BLD",5807,1,38,0)
                 address (UNDELIVERABLE).
"BLD",5807,1,39,0)
                 * Temporary address is active *
"BLD",5807,1,40,0)
Do you want to update the address/phone? N// YES
"BLD",5807,1,41,0)
Update (P)ermanent address, (T)emporary, or (B)oth: BOTH// 
"BLD",5807,1,42,0)
 
"BLD",5807,1,43,0)
3. In the Medication Profile [PSO P] option, the Patient Prescription 
"BLD",5807,1,44,0)
Processing [PSO LM BACKDOOR ORDERS] option, and the Complete Orders from
"BLD",5807,1,45,0)
OERR [PSO LMOE FINISH] option, the following changes were made:
"BLD",5807,1,46,0)
a. When the medication profile is displayed, the letter "B" (for bad
"BLD",5807,1,47,0)
address) is added to the status column if the last label activity for that
"BLD",5807,1,48,0)
prescription indicated a BAI condition. If the address is corrected and
"BLD",5807,1,49,0)
label reprinted, "B" no longer appears on the profile.
"BLD",5807,1,50,0)
 
"BLD",5807,1,51,0)
Example:
"BLD",5807,1,52,0)
 
"BLD",5807,1,53,0)
                    Medication Profile Sorted by ISSUE DATE
"BLD",5807,1,54,0)
                                                         REF
"BLD",5807,1,55,0)
 Rx#         Drug                                     ST REM  Issued  
"BLD",5807,1,56,0)
Last Fill
"BLD",5807,1,57,0)
--------------------------------------------------------------------------
"BLD",5807,1,58,0)
-----
"BLD",5807,1,59,0)
$300920A     ACETIC ACID 2% OTIC SOL 15 ML            DCB  5 07-20-06 
"BLD",5807,1,60,0)
07-20-06
"BLD",5807,1,61,0)
     QTY: 1             SIG: INSTILL 2 DROPS AD AS NEEDED  
"BLD",5807,1,62,0)
$100002514C  SIMVASTATIN                               S   5 06-29-06 
"BLD",5807,1,63,0)
12-10-06
"BLD",5807,1,64,0)
     QTY: 150           SIG: ONE IV TWICE A DAY
"BLD",5807,1,65,0)
$300927      UREA 10% LOTION                          AB   5 06-29-06 
"BLD",5807,1,66,0)
06-29-06
"BLD",5807,1,67,0)
     QTY: 1             SIG: APPLY SPARINGLY TO AFFECTED AREA AS NEEDED
"BLD",5807,1,68,0)
 
"BLD",5807,1,69,0)
b. If there is no ending date for the temporary address, the fact that the
"BLD",5807,1,70,0)
address was temporary was not being displayed in the patient profile.
"BLD",5807,1,71,0)
This patch adds the temporary indication including the text "(no end
"BLD",5807,1,72,0)
date)" if no ending temporary date exists.
"BLD",5807,1,73,0)
 
"BLD",5807,1,74,0)
Example:
"BLD",5807,1,75,0)
 
"BLD",5807,1,76,0)
Disabilities:                                                             
"BLD",5807,1,77,0)
     
"BLD",5807,1,78,0)
      (Temp Address from AUG 28,2006 till (no end date))
"BLD",5807,1,79,0)
LINE1                  
"BLD",5807,1,80,0)
ANYTOWN                                       PHONE: 
"BLD",5807,1,81,0)
555-1212                   
"BLD",5807,1,82,0)
TEXAS  
"BLD",5807,1,83,0)
77379                                                                    
"BLD",5807,1,84,0)
 
"BLD",5807,1,85,0)
 
"BLD",5807,1,86,0)
4. The Input Template [PSO OUTPT] is modified to remove temporary
"BLD",5807,1,87,0)
address update prompts. Instead, a new API to the Registration Package 
"BLD",5807,1,88,0)
V. 5.3 is used for updating temporary address for the Update Patient
"BLD",5807,1,89,0)
Record [PSO PAT] option and the Patient Record Update [PU] action (within
"BLD",5807,1,90,0)
the patient profile). This option and action are also changed to check for
"BLD",5807,1,91,0)
the user holding the PSO ADDRESS UPDATE security key or the EDIT PATIENT
"BLD",5807,1,92,0)
DATA field is set to "Yes" before the user is prompted to update the
"BLD",5807,1,93,0)
addresses.
"BLD",5807,1,94,0)
 
"BLD",5807,1,95,0)
5. The following changes are made to laser label printing:
"BLD",5807,1,96,0)
a. If BAD ADDRESS INDICATOR is set and there is no active temporary
"BLD",5807,1,97,0)
address, the Mailing label prints ** BAD ADDRESS INDICATED ** and does not
"BLD",5807,1,98,0)
print the rest of the mailing address.
"BLD",5807,1,99,0)
b. An additional label log entry added for bad address indicated at the
"BLD",5807,1,100,0)
time the label printed.
"BLD",5807,1,101,0)
 
"BLD",5807,1,102,0)
6. In the Complete Orders from OERR [PSO LMOE FINISH] option, after the 
"BLD",5807,1,103,0)
prompt to display the medication profile and after the patient name and 
"BLD",5807,1,104,0)
social security number are shown, if the patient's address is flagged 
"BLD",5807,1,105,0)
with a Bad Address Indicator, a warning message is displayed. If the 
"BLD",5807,1,106,0)
temporary address is active, that information is displayed. The user
"BLD",5807,1,107,0)
will not be prompted to update the address.
"BLD",5807,1,108,0)
 
"BLD",5807,1,109,0)
Example:
"BLD",5807,1,110,0)
Do you want to see Medication Profile? Yes// NO
"BLD",5807,1,111,0)
 
"BLD",5807,1,112,0)
          PERPATNM,FRED (666-00-0777)
"BLD",5807,1,113,0)
 
"BLD",5807,1,114,0)
        WARNING: The patient address is indicated as a bad
"BLD",5807,1,115,0)
                 address (UNDELIVERABLE).
"BLD",5807,1,116,0)
                 * Temporary address is active *
"BLD",5807,1,117,0)
 
"BLD",5807,1,118,0)
Press Return to continue: 
"BLD",5807,1,119,0)
 
"BLD",5807,1,120,0)
7. The Action Profile (132 COLUMN PRINTOUT) [PSO ACTION PROFILE] option 
"BLD",5807,1,121,0)
is modified to display **BAD ADDRESS INDICATED-(REASON)" where REASON is 
"BLD",5807,1,122,0)
UNDELIVERABLE, HOMELESS, or OTHER.
"BLD",5807,1,123,0)
 
"BLD",5807,1,124,0)
8. Although the Transitional Pharmacy Benefits (TPB) options have been 
"BLD",5807,1,125,0)
disabled, to keep the changes consistent, the routine to print TPB letters
"BLD",5807,1,126,0)
is modified to look at the BAI condition and print "** BAD ADDRESS
"BLD",5807,1,127,0)
INDICATED ** if applicable.
"BLD",5807,1,128,0)
 
"BLD",5807,1,129,0)
9.The Patient Address Changes Report [PSO ADDRESS CHANGE REPORT] option 
"BLD",5807,1,130,0)
is modified to display additional mailing address-related fields from the
"BLD",5807,1,131,0)
PATIENT file (#2) and some fields related to the mail setting from the
"BLD",5807,1,132,0)
PHARMACY PATIENT file (#55). The user should use FileMan to turn 
"BLD",5807,1,133,0)
on auditing for the following fields in order for them to be displayed 
"BLD",5807,1,134,0)
in this report. (Fields added to this report by this patch are indicated
"BLD",5807,1,135,0)
with a "*" in front of the field name).
"BLD",5807,1,136,0)
 
"BLD",5807,1,137,0)
a. For the PATIENT file (#2), turn on auditing for:
"BLD",5807,1,138,0)
 
"BLD",5807,1,139,0)
STREET ADDRESS [LINE 1] field (#.111)
"BLD",5807,1,140,0)
ZIP+4 field (#.1112)
"BLD",5807,1,141,0)
STREET ADDRESS [LINE 2] field (#.112)
"BLD",5807,1,142,0)
STREET ADDRESS [LINE 3] field (#.113)
"BLD",5807,1,143,0)
CITY field (#.114)
"BLD",5807,1,144,0)
STATE field (#.115)
"BLD",5807,1,145,0)
ZIP CODE field (#.116)
"BLD",5807,1,146,0)
* BAD ADDRESS INDICATOR field (#.121)
"BLD",5807,1,147,0)
* TEMPORARY ADDRESS ACTIVE? field (#.12105)
"BLD",5807,1,148,0)
TEMPORARY STREET [LINE 1] field (#.1211)
"BLD",5807,1,149,0)
TEMPORARY ZIP+4 field (#.12112)
"BLD",5807,1,150,0)
TEMPORARY STREET [LINE 2] field (#.1212)
"BLD",5807,1,151,0)
TEMPORARY STREET [LINE 3] field (#.1213)
"BLD",5807,1,152,0)
TEMPORARY CITY field (#.1214)
"BLD",5807,1,153,0)
TEMPORARY STATE field (#.1215)
"BLD",5807,1,154,0)
TEMPORARY ZIP CODE field (#.1216)
"BLD",5807,1,155,0)
* TEMPORARY ADDRESS START DATE field (#.1217)
"BLD",5807,1,156,0)
* TEMPORARY ADDRESS END DATE field (#.1218)
"BLD",5807,1,157,0)
 
"BLD",5807,1,158,0)
b. For the PHARMACY PATIENT file (#55), turn on auditing for:
"BLD",5807,1,159,0)
* MAIL field (#.03)
"BLD",5807,1,160,0)
* MAIL STATUS EXPIRATION DATE field (#.05)
"BLD",5807,1,161,0)
 
"BLD",5807,1,162,0)
10. By request of a pharmacy workgroup, two new codes were added to the
"BLD",5807,1,163,0)
PRESCRIPTION file (#52) HOLD REASON field (#99):
"BLD",5807,1,164,0)
                                '7' FOR BAD ADDRESS; 
"BLD",5807,1,165,0)
                                '8' FOR PER PATIENT REQUEST; 
"BLD",5807,1,166,0)
 
"BLD",5807,1,167,0)
 
"BLD",5807,1,168,0)
11. A Bad Address Reporting Main Menu [PSO BAI REPORT] option is added 
"BLD",5807,1,169,0)
under the Output Reports [PSO OUTPUTS] option which includes the
"BLD",5807,1,170,0)
following:
"BLD",5807,1,171,0)
a. Bad Address Suspended List [PSO BAI SUSPENDED] option
"BLD",5807,1,172,0)
This option identifies prescriptions for veterans with a BAI Condition
"BLD",5807,1,173,0)
giving the opportunity to be proactive regarding prescriptions that when
"BLD",5807,1,174,0)
Printed or Pulled Early from Suspense, would be unable to be mailed.
"BLD",5807,1,175,0)
 
"BLD",5807,1,176,0)
b. List Prescriptions Not Mailed [PSO BAI NOT MAILED] option  
"BLD",5807,1,177,0)
This option provides a report of prescriptions with a routing of Mail that
"BLD",5807,1,178,0)
were not mailed due to a bad address. This is based on the last label
"BLD",5807,1,179,0)
activity entry being flagged as a bad address and a route other than
"BLD",5807,1,180,0)
"WINDOW". If the address is corrected and a label reprinted, this
"BLD",5807,1,181,0)
prescription would no longer show on the report.
"BLD",5807,1,182,0)
 
"BLD",5807,1,183,0)
12. The View Prescriptions [PSO VIEW] option is changed to show Bad 
"BLD",5807,1,184,0)
Address Indicated if BAI flag is set and no active temporary address. 
"BLD",5807,1,185,0)
Example:
"BLD",5807,1,186,0)
VIEW PRESCRIPTION:    713449A     ACETAMINOPHEN 325MG TAB  
"BLD",5807,1,187,0)
 
"BLD",5807,1,188,0)
                         
"BLD",5807,1,189,0)
Rx View (Active)              Aug 30, 2006@18:44:09          Page:    1 
"BLD",5807,1,190,0)
of    5 
"BLD",5807,1,191,0)
OUTPATIENT,ONE ** BAD ADDRESS INDICATED-(UNDELIVERABLE)
"BLD",5807,1,192,0)
  PID: 666-00-0146                                 Ht(cm): _______ 
"BLD",5807,1,193,0)
(______)   
"BLD",5807,1,194,0)
  DOB: DEC 00,1953 (52)                             Wt(kg): _______ 
"BLD",5807,1,195,0)
(______)   
"BLD",5807,4,0)
^9.64PA^52^1
"BLD",5807,4,52,0)
52
"BLD",5807,4,52,2,0)
^9.641^52^1
"BLD",5807,4,52,2,52,0)
PRESCRIPTION  (File-top level)
"BLD",5807,4,52,2,52,1,0)
^9.6411^99^1
"BLD",5807,4,52,2,52,1,99,0)
HOLD REASON
"BLD",5807,4,52,222)
y^n^p^^^^n^^n
"BLD",5807,4,52,224)

"BLD",5807,4,"APDD",52,52)

"BLD",5807,4,"APDD",52,52,99)

"BLD",5807,4,"B",52,52)

"BLD",5807,6)
1^
"BLD",5807,6.3)
8
"BLD",5807,"KRN",0)
^9.67PA^8989.52^19
"BLD",5807,"KRN",.4,0)
.4
"BLD",5807,"KRN",.401,0)
.401
"BLD",5807,"KRN",.402,0)
.402
"BLD",5807,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",5807,"KRN",.402,"NM",1,0)
PSO OUTPT    FILE #2^2^0
"BLD",5807,"KRN",.402,"NM","B","PSO OUTPT    FILE #2",1)

"BLD",5807,"KRN",.403,0)
.403
"BLD",5807,"KRN",.5,0)
.5
"BLD",5807,"KRN",.84,0)
.84
"BLD",5807,"KRN",3.6,0)
3.6
"BLD",5807,"KRN",3.8,0)
3.8
"BLD",5807,"KRN",9.2,0)
9.2
"BLD",5807,"KRN",9.8,0)
9.8
"BLD",5807,"KRN",9.8,"NM",0)
^9.68A^24^20
"BLD",5807,"KRN",9.8,"NM",1,0)
PSOADDR^^0^B66739832
"BLD",5807,"KRN",9.8,"NM",2,0)
PSOBAI^^0^B9247866
"BLD",5807,"KRN",9.8,"NM",3,0)
PSOBAIRP^^0^B25852563
"BLD",5807,"KRN",9.8,"NM",4,0)
PSOBAIR2^^0^B20289266
"BLD",5807,"KRN",9.8,"NM",8,0)
PSOLBL4^^0^B55680785
"BLD",5807,"KRN",9.8,"NM",9,0)
PSOLBLN^^0^B33988152
"BLD",5807,"KRN",9.8,"NM",10,0)
PSOLLL1^^0^B68811499
"BLD",5807,"KRN",9.8,"NM",11,0)
PSOLMPAT^^0^B2889666
"BLD",5807,"KRN",9.8,"NM",13,0)
PSOORUT1^^0^B66632962
"BLD",5807,"KRN",9.8,"NM",14,0)
PSOP1^^0^B26993923
"BLD",5807,"KRN",9.8,"NM",15,0)
PSOPAT^^0^B4414039
"BLD",5807,"KRN",9.8,"NM",16,0)
PSORX1^^0^B48416353
"BLD",5807,"KRN",9.8,"NM",17,0)
PSORXVW^^0^B61807519
"BLD",5807,"KRN",9.8,"NM",18,0)
PSOSD1^^0^B49042577
"BLD",5807,"KRN",9.8,"NM",19,0)
PSOSD2^^0^B31994464
"BLD",5807,"KRN",9.8,"NM",20,0)
PSOSD3^^0^B40297338
"BLD",5807,"KRN",9.8,"NM",21,0)
PSOSDP^^0^B31980684
"BLD",5807,"KRN",9.8,"NM",22,0)
PSOTPCLP^^0^B65137821
"BLD",5807,"KRN",9.8,"NM",23,0)
PSODEM^^0^B13922974
"BLD",5807,"KRN",9.8,"NM",24,0)
PSOORUT2^^0^B24070552
"BLD",5807,"KRN",9.8,"NM","B","PSOADDR",1)

"BLD",5807,"KRN",9.8,"NM","B","PSOBAI",2)

"BLD",5807,"KRN",9.8,"NM","B","PSOBAIR2",4)

"BLD",5807,"KRN",9.8,"NM","B","PSOBAIRP",3)

"BLD",5807,"KRN",9.8,"NM","B","PSODEM",23)

"BLD",5807,"KRN",9.8,"NM","B","PSOLBL4",8)

"BLD",5807,"KRN",9.8,"NM","B","PSOLBLN",9)

"BLD",5807,"KRN",9.8,"NM","B","PSOLLL1",10)

"BLD",5807,"KRN",9.8,"NM","B","PSOLMPAT",11)

"BLD",5807,"KRN",9.8,"NM","B","PSOORUT1",13)

"BLD",5807,"KRN",9.8,"NM","B","PSOORUT2",24)

"BLD",5807,"KRN",9.8,"NM","B","PSOP1",14)

"BLD",5807,"KRN",9.8,"NM","B","PSOPAT",15)

"BLD",5807,"KRN",9.8,"NM","B","PSORX1",16)

"BLD",5807,"KRN",9.8,"NM","B","PSORXVW",17)

"BLD",5807,"KRN",9.8,"NM","B","PSOSD1",18)

"BLD",5807,"KRN",9.8,"NM","B","PSOSD2",19)

"BLD",5807,"KRN",9.8,"NM","B","PSOSD3",20)

"BLD",5807,"KRN",9.8,"NM","B","PSOSDP",21)

"BLD",5807,"KRN",9.8,"NM","B","PSOTPCLP",22)

"BLD",5807,"KRN",19,0)
19
"BLD",5807,"KRN",19,"NM",0)
^9.68A^4^4
"BLD",5807,"KRN",19,"NM",1,0)
PSO BAI REPORT^^0
"BLD",5807,"KRN",19,"NM",2,0)
PSO BAI SUSPENDED^^0
"BLD",5807,"KRN",19,"NM",3,0)
PSO BAI NOT MAILED^^0
"BLD",5807,"KRN",19,"NM",4,0)
PSO OUTPUTS^^2
"BLD",5807,"KRN",19,"NM","B","PSO BAI NOT MAILED",3)

"BLD",5807,"KRN",19,"NM","B","PSO BAI REPORT",1)

"BLD",5807,"KRN",19,"NM","B","PSO BAI SUSPENDED",2)

"BLD",5807,"KRN",19,"NM","B","PSO OUTPUTS",4)

"BLD",5807,"KRN",19.1,0)
19.1
"BLD",5807,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",5807,"KRN",19.1,"NM",1,0)
PSO ADDRESS UPDATE^^0
"BLD",5807,"KRN",19.1,"NM","B","PSO ADDRESS UPDATE",1)

"BLD",5807,"KRN",101,0)
101
"BLD",5807,"KRN",101,"NM",0)
^9.68A^^
"BLD",5807,"KRN",409.61,0)
409.61
"BLD",5807,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",5807,"KRN",771,0)
771
"BLD",5807,"KRN",870,0)
870
"BLD",5807,"KRN",8989.51,0)
8989.51
"BLD",5807,"KRN",8989.52,0)
8989.52
"BLD",5807,"KRN",8994,0)
8994
"BLD",5807,"KRN","B",.4,.4)

"BLD",5807,"KRN","B",.401,.401)

"BLD",5807,"KRN","B",.402,.402)

"BLD",5807,"KRN","B",.403,.403)

"BLD",5807,"KRN","B",.5,.5)

"BLD",5807,"KRN","B",.84,.84)

"BLD",5807,"KRN","B",3.6,3.6)

"BLD",5807,"KRN","B",3.8,3.8)

"BLD",5807,"KRN","B",9.2,9.2)

"BLD",5807,"KRN","B",9.8,9.8)

"BLD",5807,"KRN","B",19,19)

"BLD",5807,"KRN","B",19.1,19.1)

"BLD",5807,"KRN","B",101,101)

"BLD",5807,"KRN","B",409.61,409.61)

"BLD",5807,"KRN","B",771,771)

"BLD",5807,"KRN","B",870,870)

"BLD",5807,"KRN","B",8989.51,8989.51)

"BLD",5807,"KRN","B",8989.52,8989.52)

"BLD",5807,"KRN","B",8994,8994)

"BLD",5807,"QUES",0)
^9.62^^
"BLD",5807,"REQB",0)
^9.611^9^7
"BLD",5807,"REQB",1,0)
PSO*7.0*127^2
"BLD",5807,"REQB",3,0)
PSO*7.0*148^2
"BLD",5807,"REQB",4,0)
PSO*7.0*149^2
"BLD",5807,"REQB",6,0)
PSO*7.0*195^2
"BLD",5807,"REQB",7,0)
PSO*7.0*176^2
"BLD",5807,"REQB",8,0)
PSO*7.0*227^2
"BLD",5807,"REQB",9,0)
PSO*7.0*244^2
"BLD",5807,"REQB","B","PSO*7.0*127",1)

"BLD",5807,"REQB","B","PSO*7.0*148",3)

"BLD",5807,"REQB","B","PSO*7.0*149",4)

"BLD",5807,"REQB","B","PSO*7.0*176",7)

"BLD",5807,"REQB","B","PSO*7.0*195",6)

"BLD",5807,"REQB","B","PSO*7.0*227",8)

"BLD",5807,"REQB","B","PSO*7.0*244",9)

"FIA",52)
PRESCRIPTION
"FIA",52,0)
^PSRX(
"FIA",52,0,0)
52Is
"FIA",52,0,1)
y^n^p^^^^n^^n
"FIA",52,0,10)

"FIA",52,0,11)

"FIA",52,0,"RLRO")

"FIA",52,0,"VR")
7.0^PSO
"FIA",52,52)
1
"FIA",52,52,99)

"KRN",.402,504,-1)
0^1
"KRN",.402,504,0)
PSO OUTPT^3060813.1356^^2^^^3060901
"KRN",.402,504,"DR",1,2)
148;.172;.091;
"KRN",19,254,-1)
2^4
"KRN",19,254,0)
PSO OUTPUTS^Output Reports^^M^5^^^^^^^141
"KRN",19,254,10,0)
^19.01IP^24^24
"KRN",19,254,10,24,0)
13107
"KRN",19,254,10,24,"^")
PSO BAI REPORT
"KRN",19,254,10,"A6359",1)
Formulary Listing^461^^
"KRN",19,254,10,"A6359",2)
Alpha Drug List and Synonyms^462^^
"KRN",19,254,10,"A6359",3)
Drug List By Synonym^463^^
"KRN",19,254,10,"A6359",4)
Commonly Dispensed Drugs^464^^
"KRN",19,254,10,"A6359",5)
Inactive Drug List^465^^
"KRN",19,254,10,"A6359",6)
Non-Formulary List^466^^
"KRN",19,254,10,"A6359",7)
Narcotic Prescription List^467^^
"KRN",19,254,10,"A6359",8)
Cost Analysis Reports^1135^^
"KRN",19,254,10,"A6359",9)
Amis Report^481^^
"KRN",19,254,10,"A6359",10)
Prescriptions on Hold^487^^
"KRN",19,254,10,"A6359",11)
Action Profile^509^^
"KRN",19,254,"U")
OUTPUT REPORTS
"KRN",19,13107,-1)
0^1
"KRN",19,13107,0)
PSO BAI REPORT^Bad Address Reporting Main Menu^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,13107,10,0)
^19.01IP^2^2
"KRN",19,13107,10,1,0)
13108
"KRN",19,13107,10,1,"^")
PSO BAI SUSPENDED
"KRN",19,13107,10,2,0)
13109
"KRN",19,13107,10,2,"^")
PSO BAI NOT MAILED
"KRN",19,13107,99)
60494,26545
"KRN",19,13107,"U")
BAD ADDRESS REPORTING MAIN MEN
"KRN",19,13108,-1)
0^2
"KRN",19,13108,0)
PSO BAI SUSPENDED^Bad Address Suspended List^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,13108,25)
PSOBAIR2
"KRN",19,13108,"U")
BAD ADDRESS SUSPENDED LIST
"KRN",19,13109,-1)
0^3
"KRN",19,13109,0)
PSO BAI NOT MAILED^List Prescriptions Not Mailed^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,13109,25)
PSOBAIRP
"KRN",19,13109,"U")
LIST PRESCRIPTIONS NOT MAILED
"KRN",19.1,531,-1)
0^1
"KRN",19.1,531,0)
PSO ADDRESS UPDATE^Mailing address update (OP)
"KRN",19.1,531,1,0)
^^3^3^3060524^
"KRN",19.1,531,1,1,0)
This key can be assigned to Outpatient Pharmacy users who can enter/edit 
"KRN",19.1,531,1,2,0)
patient address information even when the PSO SITE parameter EDIT PATIENT 
"KRN",19.1,531,1,3,0)
DATA is set to N.
"MBREQ")
0
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
233^3060901^10000000010
"PKG",141,22,1,"PAH",1,1,0)
^^195^195^3060901
"PKG",141,22,1,"PAH",1,1,1,0)
This patch enhances the usage of Application Program Interfaces (APIs) to
"PKG",141,22,1,"PAH",1,1,2,0)
the Registration Package V. 5.3 to check the setting of the BAD ADDRESS
"PKG",141,22,1,"PAH",1,1,3,0)
INDICATOR field (#.121) in the PATIENT file (#2) and to update the
"PKG",141,22,1,"PAH",1,1,4,0)
permanent and temporary addresses. The BAD ADDRESS INDICATOR (referred to
"PKG",141,22,1,"PAH",1,1,5,0)
as BAI in this description) is one of the fields presented when using the
"PKG",141,22,1,"PAH",1,1,6,0)
API to update permanent address fields.
"PKG",141,22,1,"PAH",1,1,7,0)
 
"PKG",141,22,1,"PAH",1,1,8,0)
Outpatient Pharmacy V. 7.0 options are modified to not print the 
"PKG",141,22,1,"PAH",1,1,9,0)
patient's address if a bad address is indicated and to prompt to update
"PKG",141,22,1,"PAH",1,1,10,0)
the patient's address when appropriate. If the patient has the BAD ADDRESS
"PKG",141,22,1,"PAH",1,1,11,0)
INDICATOR field set and no active temporary address, this is referred to
"PKG",141,22,1,"PAH",1,1,12,0)
as a BAI condition in this description.
"PKG",141,22,1,"PAH",1,1,13,0)
 
"PKG",141,22,1,"PAH",1,1,14,0)
Note: Related changes for the Outpatient Pharmacy Automation Interface
"PKG",141,22,1,"PAH",1,1,15,0)
(OPAI) and Consolidated Mail Outpatient Pharmacy (CMOP) will be done in
"PKG",141,22,1,"PAH",1,1,16,0)
patches PSO*7*200 and PSX*2*54.
"PKG",141,22,1,"PAH",1,1,17,0)
 
"PKG",141,22,1,"PAH",1,1,18,0)
 
"PKG",141,22,1,"PAH",1,1,19,0)
The following changes are made in this patch:
"PKG",141,22,1,"PAH",1,1,20,0)
 
"PKG",141,22,1,"PAH",1,1,21,0)
1. A new security key PSO ADDRESS UPDATE is added. Either the EDIT 
"PKG",141,22,1,"PAH",1,1,22,0)
PATIENT DATA field (#.123) in the PSO SITE file (#59) must be set to 
"PKG",141,22,1,"PAH",1,1,23,0)
"Yes" or the user must have this new security key in order to be
"PKG",141,22,1,"PAH",1,1,24,0)
prompted to update the address (permanent and/or temporary addresses).
"PKG",141,22,1,"PAH",1,1,25,0)
 
"PKG",141,22,1,"PAH",1,1,26,0)
2. When selecting a patient name in the Patient Prescription Processing 
"PKG",141,22,1,"PAH",1,1,27,0)
[PSO LM BACKDOOR ORDERS] option, if the patient's address is flagged with
"PKG",141,22,1,"PAH",1,1,28,0)
a Bad Address Indicator, then a warning message is displayed. If the 
"PKG",141,22,1,"PAH",1,1,29,0)
EDIT PATIENT DATA is set to Yes or the user holds the new
"PKG",141,22,1,"PAH",1,1,30,0)
PSO ADDRESS UPDATE security key, he will be asked if he wants to update
"PKG",141,22,1,"PAH",1,1,31,0)
the patient's address. If there is a valid temporary address, a message to
"PKG",141,22,1,"PAH",1,1,32,0)
that effect is displayed before the prompt to update the address.
"PKG",141,22,1,"PAH",1,1,33,0)
 
"PKG",141,22,1,"PAH",1,1,34,0)
Example:
"PKG",141,22,1,"PAH",1,1,35,0)
  PSOOUTPATIENT,ONE (000-00-0777)
"PKG",141,22,1,"PAH",1,1,36,0)
 
"PKG",141,22,1,"PAH",1,1,37,0)
        WARNING: The patient address is indicated as a bad
"PKG",141,22,1,"PAH",1,1,38,0)
                 address (UNDELIVERABLE).
"PKG",141,22,1,"PAH",1,1,39,0)
                 * Temporary address is active *
"PKG",141,22,1,"PAH",1,1,40,0)
Do you want to update the address/phone? N// YES
"PKG",141,22,1,"PAH",1,1,41,0)
Update (P)ermanent address, (T)emporary, or (B)oth: BOTH// 
"PKG",141,22,1,"PAH",1,1,42,0)
 
"PKG",141,22,1,"PAH",1,1,43,0)
3. In the Medication Profile [PSO P] option, the Patient Prescription 
"PKG",141,22,1,"PAH",1,1,44,0)
Processing [PSO LM BACKDOOR ORDERS] option, and the Complete Orders from
"PKG",141,22,1,"PAH",1,1,45,0)
OERR [PSO LMOE FINISH] option, the following changes were made:
"PKG",141,22,1,"PAH",1,1,46,0)
a. When the medication profile is displayed, the letter "B" (for bad
"PKG",141,22,1,"PAH",1,1,47,0)
address) is added to the status column if the last label activity for that
"PKG",141,22,1,"PAH",1,1,48,0)
prescription indicated a BAI condition. If the address is corrected and
"PKG",141,22,1,"PAH",1,1,49,0)
label reprinted, "B" no longer appears on the profile.
"PKG",141,22,1,"PAH",1,1,50,0)
 
"PKG",141,22,1,"PAH",1,1,51,0)
Example:
"PKG",141,22,1,"PAH",1,1,52,0)
 
"PKG",141,22,1,"PAH",1,1,53,0)
                    Medication Profile Sorted by ISSUE DATE
"PKG",141,22,1,"PAH",1,1,54,0)
                                                         REF
"PKG",141,22,1,"PAH",1,1,55,0)
 Rx#         Drug                                     ST REM  Issued  
"PKG",141,22,1,"PAH",1,1,56,0)
Last Fill
"PKG",141,22,1,"PAH",1,1,57,0)
--------------------------------------------------------------------------
"PKG",141,22,1,"PAH",1,1,58,0)
-----
"PKG",141,22,1,"PAH",1,1,59,0)
$300920A     ACETIC ACID 2% OTIC SOL 15 ML            DCB  5 07-20-06 
"PKG",141,22,1,"PAH",1,1,60,0)
07-20-06
"PKG",141,22,1,"PAH",1,1,61,0)
     QTY: 1             SIG: INSTILL 2 DROPS AD AS NEEDED  
"PKG",141,22,1,"PAH",1,1,62,0)
$100002514C  SIMVASTATIN                               S   5 06-29-06 
"PKG",141,22,1,"PAH",1,1,63,0)
12-10-06
"PKG",141,22,1,"PAH",1,1,64,0)
     QTY: 150           SIG: ONE IV TWICE A DAY
"PKG",141,22,1,"PAH",1,1,65,0)
$300927      UREA 10% LOTION                          AB   5 06-29-06 
"PKG",141,22,1,"PAH",1,1,66,0)
06-29-06
"PKG",141,22,1,"PAH",1,1,67,0)
     QTY: 1             SIG: APPLY SPARINGLY TO AFFECTED AREA AS NEEDED
"PKG",141,22,1,"PAH",1,1,68,0)
 
"PKG",141,22,1,"PAH",1,1,69,0)
b. If there is no ending date for the temporary address, the fact that the
"PKG",141,22,1,"PAH",1,1,70,0)
address was temporary was not being displayed in the patient profile.
"PKG",141,22,1,"PAH",1,1,71,0)
This patch adds the temporary indication including the text "(no end
"PKG",141,22,1,"PAH",1,1,72,0)
date)" if no ending temporary date exists.
"PKG",141,22,1,"PAH",1,1,73,0)
 
"PKG",141,22,1,"PAH",1,1,74,0)
Example:
"PKG",141,22,1,"PAH",1,1,75,0)
 
"PKG",141,22,1,"PAH",1,1,76,0)
Disabilities:                                                             
"PKG",141,22,1,"PAH",1,1,77,0)
     
"PKG",141,22,1,"PAH",1,1,78,0)
      (Temp Address from AUG 28,2006 till (no end date))
"PKG",141,22,1,"PAH",1,1,79,0)
LINE1                  
"PKG",141,22,1,"PAH",1,1,80,0)
ANYTOWN                                       PHONE: 
"PKG",141,22,1,"PAH",1,1,81,0)
555-1212                   
"PKG",141,22,1,"PAH",1,1,82,0)
TEXAS  
"PKG",141,22,1,"PAH",1,1,83,0)
77379                                                                    
"PKG",141,22,1,"PAH",1,1,84,0)
 
"PKG",141,22,1,"PAH",1,1,85,0)
 
"PKG",141,22,1,"PAH",1,1,86,0)
4. The Input Template [PSO OUTPT] is modified to remove temporary
"PKG",141,22,1,"PAH",1,1,87,0)
address update prompts. Instead, a new API to the Registration Package 
"PKG",141,22,1,"PAH",1,1,88,0)
V. 5.3 is used for updating temporary address for the Update Patient
"PKG",141,22,1,"PAH",1,1,89,0)
Record [PSO PAT] option and the Patient Record Update [PU] action (within
"PKG",141,22,1,"PAH",1,1,90,0)
the patient profile). This option and action are also changed to check for
"PKG",141,22,1,"PAH",1,1,91,0)
the user holding the PSO ADDRESS UPDATE security key or the EDIT PATIENT
"PKG",141,22,1,"PAH",1,1,92,0)
DATA field is set to "Yes" before the user is prompted to update the
"PKG",141,22,1,"PAH",1,1,93,0)
addresses.
"PKG",141,22,1,"PAH",1,1,94,0)
 
"PKG",141,22,1,"PAH",1,1,95,0)
5. The following changes are made to laser label printing:
"PKG",141,22,1,"PAH",1,1,96,0)
a. If BAD ADDRESS INDICATOR is set and there is no active temporary
"PKG",141,22,1,"PAH",1,1,97,0)
address, the Mailing label prints ** BAD ADDRESS INDICATED ** and does not
"PKG",141,22,1,"PAH",1,1,98,0)
print the rest of the mailing address.
"PKG",141,22,1,"PAH",1,1,99,0)
b. An additional label log entry added for bad address indicated at the
"PKG",141,22,1,"PAH",1,1,100,0)
time the label printed.
"PKG",141,22,1,"PAH",1,1,101,0)
 
"PKG",141,22,1,"PAH",1,1,102,0)
6. In the Complete Orders from OERR [PSO LMOE FINISH] option, after the 
"PKG",141,22,1,"PAH",1,1,103,0)
prompt to display the medication profile and after the patient name and 
"PKG",141,22,1,"PAH",1,1,104,0)
social security number are shown, if the patient's address is flagged 
"PKG",141,22,1,"PAH",1,1,105,0)
with a Bad Address Indicator, a warning message is displayed. If the 
"PKG",141,22,1,"PAH",1,1,106,0)
temporary address is active, that information is displayed. The user
"PKG",141,22,1,"PAH",1,1,107,0)
will not be prompted to update the address.
"PKG",141,22,1,"PAH",1,1,108,0)
 
"PKG",141,22,1,"PAH",1,1,109,0)
Example:
"PKG",141,22,1,"PAH",1,1,110,0)
Do you want to see Medication Profile? Yes// NO
"PKG",141,22,1,"PAH",1,1,111,0)
 
"PKG",141,22,1,"PAH",1,1,112,0)
          PERPATNM,FRED (666-00-0777)
"PKG",141,22,1,"PAH",1,1,113,0)
 
"PKG",141,22,1,"PAH",1,1,114,0)
        WARNING: The patient address is indicated as a bad
"PKG",141,22,1,"PAH",1,1,115,0)
                 address (UNDELIVERABLE).
"PKG",141,22,1,"PAH",1,1,116,0)
                 * Temporary address is active *
"PKG",141,22,1,"PAH",1,1,117,0)
 
"PKG",141,22,1,"PAH",1,1,118,0)
Press Return to continue: 
"PKG",141,22,1,"PAH",1,1,119,0)
 
"PKG",141,22,1,"PAH",1,1,120,0)
7. The Action Profile (132 COLUMN PRINTOUT) [PSO ACTION PROFILE] option 
"PKG",141,22,1,"PAH",1,1,121,0)
is modified to display **BAD ADDRESS INDICATED-(REASON)" where REASON is 
"PKG",141,22,1,"PAH",1,1,122,0)
UNDELIVERABLE, HOMELESS, or OTHER.
"PKG",141,22,1,"PAH",1,1,123,0)
 
"PKG",141,22,1,"PAH",1,1,124,0)
8. Although the Transitional Pharmacy Benefits (TPB) options have been 
"PKG",141,22,1,"PAH",1,1,125,0)
disabled, to keep the changes consistent, the routine to print TPB letters
"PKG",141,22,1,"PAH",1,1,126,0)
is modified to look at the BAI condition and print "** BAD ADDRESS
"PKG",141,22,1,"PAH",1,1,127,0)
INDICATED ** if applicable.
"PKG",141,22,1,"PAH",1,1,128,0)
 
"PKG",141,22,1,"PAH",1,1,129,0)
9.The Patient Address Changes Report [PSO ADDRESS CHANGE REPORT] option 
"PKG",141,22,1,"PAH",1,1,130,0)
is modified to display additional mailing address-related fields from the
"PKG",141,22,1,"PAH",1,1,131,0)
PATIENT file (#2) and some fields related to the mail setting from the
"PKG",141,22,1,"PAH",1,1,132,0)
PHARMACY PATIENT file (#55). The user should use FileMan to turn 
"PKG",141,22,1,"PAH",1,1,133,0)
on auditing for the following fields in order for them to be displayed 
"PKG",141,22,1,"PAH",1,1,134,0)
in this report. (Fields added to this report by this patch are indicated
"PKG",141,22,1,"PAH",1,1,135,0)
with a "*" in front of the field name).
"PKG",141,22,1,"PAH",1,1,136,0)
 
"PKG",141,22,1,"PAH",1,1,137,0)
a. For the PATIENT file (#2), turn on auditing for:
"PKG",141,22,1,"PAH",1,1,138,0)
 
"PKG",141,22,1,"PAH",1,1,139,0)
STREET ADDRESS [LINE 1] field (#.111)
"PKG",141,22,1,"PAH",1,1,140,0)
ZIP+4 field (#.1112)
"PKG",141,22,1,"PAH",1,1,141,0)
STREET ADDRESS [LINE 2] field (#.112)
"PKG",141,22,1,"PAH",1,1,142,0)
STREET ADDRESS [LINE 3] field (#.113)
"PKG",141,22,1,"PAH",1,1,143,0)
CITY field (#.114)
"PKG",141,22,1,"PAH",1,1,144,0)
STATE field (#.115)
"PKG",141,22,1,"PAH",1,1,145,0)
ZIP CODE field (#.116)
"PKG",141,22,1,"PAH",1,1,146,0)
* BAD ADDRESS INDICATOR field (#.121)
"PKG",141,22,1,"PAH",1,1,147,0)
* TEMPORARY ADDRESS ACTIVE? field (#.12105)
"PKG",141,22,1,"PAH",1,1,148,0)
TEMPORARY STREET [LINE 1] field (#.1211)
"PKG",141,22,1,"PAH",1,1,149,0)
TEMPORARY ZIP+4 field (#.12112)
"PKG",141,22,1,"PAH",1,1,150,0)
TEMPORARY STREET [LINE 2] field (#.1212)
"PKG",141,22,1,"PAH",1,1,151,0)
TEMPORARY STREET [LINE 3] field (#.1213)
"PKG",141,22,1,"PAH",1,1,152,0)
TEMPORARY CITY field (#.1214)
"PKG",141,22,1,"PAH",1,1,153,0)
TEMPORARY STATE field (#.1215)
"PKG",141,22,1,"PAH",1,1,154,0)
TEMPORARY ZIP CODE field (#.1216)
"PKG",141,22,1,"PAH",1,1,155,0)
* TEMPORARY ADDRESS START DATE field (#.1217)
"PKG",141,22,1,"PAH",1,1,156,0)
* TEMPORARY ADDRESS END DATE field (#.1218)
"PKG",141,22,1,"PAH",1,1,157,0)
 
"PKG",141,22,1,"PAH",1,1,158,0)
b. For the PHARMACY PATIENT file (#55), turn on auditing for:
"PKG",141,22,1,"PAH",1,1,159,0)
* MAIL field (#.03)
"PKG",141,22,1,"PAH",1,1,160,0)
* MAIL STATUS EXPIRATION DATE field (#.05)
"PKG",141,22,1,"PAH",1,1,161,0)
 
"PKG",141,22,1,"PAH",1,1,162,0)
10. By request of a pharmacy workgroup, two new codes were added to the
"PKG",141,22,1,"PAH",1,1,163,0)
PRESCRIPTION file (#52) HOLD REASON field (#99):
"PKG",141,22,1,"PAH",1,1,164,0)
                                '7' FOR BAD ADDRESS; 
"PKG",141,22,1,"PAH",1,1,165,0)
                                '8' FOR PER PATIENT REQUEST; 
"PKG",141,22,1,"PAH",1,1,166,0)
 
"PKG",141,22,1,"PAH",1,1,167,0)
 
"PKG",141,22,1,"PAH",1,1,168,0)
11. A Bad Address Reporting Main Menu [PSO BAI REPORT] option is added 
"PKG",141,22,1,"PAH",1,1,169,0)
under the Output Reports [PSO OUTPUTS] option which includes the
"PKG",141,22,1,"PAH",1,1,170,0)
following:
"PKG",141,22,1,"PAH",1,1,171,0)
a. Bad Address Suspended List [PSO BAI SUSPENDED] option
"PKG",141,22,1,"PAH",1,1,172,0)
This option identifies prescriptions for veterans with a BAI Condition
"PKG",141,22,1,"PAH",1,1,173,0)
giving the opportunity to be proactive regarding prescriptions that when
"PKG",141,22,1,"PAH",1,1,174,0)
Printed or Pulled Early from Suspense, would be unable to be mailed.
"PKG",141,22,1,"PAH",1,1,175,0)
 
"PKG",141,22,1,"PAH",1,1,176,0)
b. List Prescriptions Not Mailed [PSO BAI NOT MAILED] option  
"PKG",141,22,1,"PAH",1,1,177,0)
This option provides a report of prescriptions with a routing of Mail that
"PKG",141,22,1,"PAH",1,1,178,0)
were not mailed due to a bad address. This is based on the last label
"PKG",141,22,1,"PAH",1,1,179,0)
activity entry being flagged as a bad address and a route other than
"PKG",141,22,1,"PAH",1,1,180,0)
"WINDOW". If the address is corrected and a label reprinted, this
"PKG",141,22,1,"PAH",1,1,181,0)
prescription would no longer show on the report.
"PKG",141,22,1,"PAH",1,1,182,0)
 
"PKG",141,22,1,"PAH",1,1,183,0)
12. The View Prescriptions [PSO VIEW] option is changed to show Bad 
"PKG",141,22,1,"PAH",1,1,184,0)
Address Indicated if BAI flag is set and no active temporary address. 
"PKG",141,22,1,"PAH",1,1,185,0)
Example:
"PKG",141,22,1,"PAH",1,1,186,0)
VIEW PRESCRIPTION:    713449A     ACETAMINOPHEN 325MG TAB  
"PKG",141,22,1,"PAH",1,1,187,0)
 
"PKG",141,22,1,"PAH",1,1,188,0)
                         
"PKG",141,22,1,"PAH",1,1,189,0)
Rx View (Active)              Aug 30, 2006@18:44:09          Page:    1 
"PKG",141,22,1,"PAH",1,1,190,0)
of    5 
"PKG",141,22,1,"PAH",1,1,191,0)
OUTPATIENT,ONE ** BAD ADDRESS INDICATED-(UNDELIVERABLE)
"PKG",141,22,1,"PAH",1,1,192,0)
  PID: 666-00-0146                                 Ht(cm): _______ 
"PKG",141,22,1,"PAH",1,1,193,0)
(______)   
"PKG",141,22,1,"PAH",1,1,194,0)
  DOB: DEC 00,1953 (52)                             Wt(kg): _______ 
"PKG",141,22,1,"PAH",1,1,195,0)
(______)   
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
20
"RTN","PSOADDR")
0^1^B66739832^B59755103
"RTN","PSOADDR",1,0)
PSOADDR ;BIR/RTR-Print address changes from Audit file ;10/17/01
"RTN","PSOADDR",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**127,233**;DEC 1997;Build 8
"RTN","PSOADDR",3,0)
 ;External reference to ^DIA supported by DBIA 2602
"RTN","PSOADDR",4,0)
 ;
"RTN","PSOADDR",5,0)
EN ;
"RTN","PSOADDR",6,0)
 N PSOFORM,PSOAPAT,PSOSDT,PSOEDT,PSOSDTX,PSOEDTX,X,Y,X1,X2
"RTN","PSOADDR",7,0)
 W !!,"This option provides a report that displays changes made to permanent and"
"RTN","PSOADDR",8,0)
 W !,"temporary mailing address information in the PATIENT file (#2). Also changes"
"RTN","PSOADDR",9,0)
 W !,"to the MAIL field (#.03) and the MAIL STATUS EXPIRATION DATE field (#.05)"
"RTN","PSOADDR",10,0)
 W !,"in the PHARMACY PATIENT file (#55) will be displayed."
"RTN","PSOADDR",11,0)
 W !,"Changes can only be displayed if the edits were made using VA FileMan, and the"
"RTN","PSOADDR",12,0)
 W !,"Audit function was turned on for the field(s) at the time of the edit.",!!
"RTN","PSOADDR",13,0)
 K DIR S DIR(0)="SB^S:Single;A:All",DIR("A")="Print report for a Single patient, or All patients",DIR("B")="Single",DIR("?")=" ",DIR("?",1)="Enter 'S' to print address changes for one patient over the selected"
"RTN","PSOADDR",14,0)
 S DIR("?",2)="date range, enter 'A' to print address changes for all patients",DIR("?",3)="over the selected date range."
"RTN","PSOADDR",15,0)
 D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOADDR",16,0)
 S PSOFORM=$S(Y="S":1,1:0)
"RTN","PSOADDR",17,0)
 I 'PSOFORM G DATE
"RTN","PSOADDR",18,0)
 K DIC W ! S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: " D ^DIC K DIC I Y<1!($D(DUOUT))!($D(DTOUT)) D MESS Q
"RTN","PSOADDR",19,0)
 S PSOAPAT=+Y
"RTN","PSOADDR",20,0)
DATE ;
"RTN","PSOADDR",21,0)
 W !!
"RTN","PSOADDR",22,0)
 I PSOFORM W !,"This report will be sorted by Date/time of edit."
"RTN","PSOADDR",23,0)
 I 'PSOFORM W !,"This report will be sorted by Patient Name, and within Patient Name will be",!,"sorted by Date/time of edit."
"RTN","PSOADDR",24,0)
 W !,"A beginning and ending date must now be entered for the search."
"RTN","PSOADDR",25,0)
 K DIR W ! S DIR(0)="DAO^:DT:APEX",DIR("A")="Beginning Date: ",DIR("?")=" ",DIR("?",1)="Enter the date to begin searching for changes to address fields.",DIR("?",2)="A future date cannot be entered." D ^DIR K DIR
"RTN","PSOADDR",26,0)
 I 'Y!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOADDR",27,0)
 S PSOSDT=Y D DD^%DT S PSOSDTX=Y
"RTN","PSOADDR",28,0)
 S X1=PSOSDT,X2=-1 D C^%DTC S PSOSDT=X_".9999"
"RTN","PSOADDR",29,0)
 W ! K DIR S DIR(0)="DAO^"_PSOSDT_"::APEX",DIR("A")="Ending Date: ",DIR("?")=" ",DIR("?",1)="Enter the ending date of the search for changes to address fields.",DIR("?",2)="This date cannot be before the beginning date." D ^DIR K DIR
"RTN","PSOADDR",30,0)
 I 'Y!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOADDR",31,0)
 S PSOEDT=Y D DD^%DT S PSOEDTX=Y
"RTN","PSOADDR",32,0)
 S X1=PSOEDT,X2=+1 D C^%DTC S PSOEDT=X
"RTN","PSOADDR",33,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS I $G(POP) D MESS Q
"RTN","PSOADDR",34,0)
 I $D(IO("Q")) D  Q
"RTN","PSOADDR",35,0)
 .S ZTRTN="REP^PSOADDR",ZTDESC="Pharmacy Address change report",ZTSAVE("PSOFORM")="",ZTSAVE("PSOAPAT")="",ZTSAVE("PSOSDT")="",ZTSAVE("PSOEDT")="",ZTSAVE("PSOEDTX")="",ZTSAVE("PSOSDTX")="" D ^%ZTLOAD K %ZIS W !!,"Report queued to print.",!
"RTN","PSOADDR",36,0)
REP ;
"RTN","PSOADDR",37,0)
 K ^TMP("PSOADD",$J)
"RTN","PSOADDR",38,0)
 N PSODEV,PSOUT,PSOLINE,PSOPAGE,PSOADND,PSOADUSR,PSOADF,PSOADFF,PSOAOPT,PSOAOPTA,PSOAOPTZ,PSOAOPTB,PSOAOPTC,PSOADLP,PSOANODE,PSOADX,PSOADXX,PSOADATE,PSOC,PSOAALL,PSOADFN,PSOANAME,PSONI,PSONX,PSONB,PSOASN,VA,DFN,PSONSSN,PSOAFLAG
"RTN","PSOADDR",39,0)
 U IO
"RTN","PSOADDR",40,0)
 S (PSOUT,PSOAFLAG)=0,PSODEV=$S($E(IOST,1,2)'="C-":0,1:1),PSOPAGE=1
"RTN","PSOADDR",41,0)
 S $P(PSOLINE,"-",78)=""
"RTN","PSOADDR",42,0)
 I $G(PSOFORM) G ONE
"RTN","PSOADDR",43,0)
ALL ;Print report for all patients
"RTN","PSOADDR",44,0)
 N PSOFILE
"RTN","PSOADDR",45,0)
 F PSOFILE=2,55 F PSOAALL=PSOSDT:0 S PSOAALL=$O(^DIA(PSOFILE,"C",PSOAALL)) Q:'PSOAALL!(PSOEDT'>PSOAALL)  S PSOADLP="" F  S PSOADLP=$O(^DIA(PSOFILE,"C",PSOAALL,PSOADLP)) Q:PSOADLP=""  D
"RTN","PSOADDR",46,0)
 .S PSOADFN=$P($G(^DIA(PSOFILE,PSOADLP,0)),"^"),PSOC=$P($G(^(0)),"^",3) Q:'PSOADFN
"RTN","PSOADDR",47,0)
 .S PSOANAME=$P($G(^DPT(PSOADFN,0)),"^") Q:PSOANAME=""
"RTN","PSOADDR",48,0)
 .I PSOFILE=2 I PSOC=.111!(PSOC=.112)!(PSOC=.113)!(PSOC=.114)!(PSOC=.115)!(PSOC=.116)!(PSOC=.1211)!(PSOC=.1212)!(PSOC=.1213)!(PSOC=.1214)!(PSOC=.1215)!(PSOC=.1216)!(PSOC=.1112)!(PSOC=.12112)!(PSOC=.121)!(PSOC=.1217)!(PSOC=.1218)!(PSOC=.12105) D
"RTN","PSOADDR",49,0)
 ..S ^TMP("PSOADD",$J,PSOANAME,PSOADFN,PSOAALL,PSOFILE,PSOADLP)=$G(^DIA(2,PSOADLP,0))
"RTN","PSOADDR",50,0)
 .I PSOFILE=55 I PSOC=.03!(PSOC=.05) D
"RTN","PSOADDR",51,0)
 ..S ^TMP("PSOADD",$J,PSOANAME,PSOADFN,PSOAALL,PSOFILE,PSOADLP)=$G(^DIA(55,PSOADLP,0))
"RTN","PSOADDR",52,0)
 D HD
"RTN","PSOADDR",53,0)
 I '$D(^TMP("PSOADD",$J)) W !!,"No data found to print for this date range.",! G END
"RTN","PSOADDR",54,0)
 S PSONI="" F  S PSONI=$O(^TMP("PSOADD",$J,PSONI)) Q:PSONI=""!(PSOUT)  S PSONX="" F  S PSONX=$O(^TMP("PSOADD",$J,PSONI,PSONX)) Q:PSONX=""!(PSOUT)  D NAME S PSONB="" F  S PSONB=$O(^TMP("PSOADD",$J,PSONI,PSONX,PSONB)) Q:PSONB=""!(PSOUT)  D
"RTN","PSOADDR",55,0)
 .F PSOFILE=2,55 S PSOADXX="" F  S PSOADXX=$O(^TMP("PSOADD",$J,PSONI,PSONX,PSONB,PSOFILE,PSOADXX)) Q:PSOADXX=""!(PSOUT)  D
"RTN","PSOADDR",56,0)
 ..I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",57,0)
 ..S Y=PSONB D DD^%DT S PSOADATE=Y
"RTN","PSOADDR",58,0)
 ..S PSOADND=$G(^TMP("PSOADD",$J,PSONI,PSONX,PSONB,PSOFILE,PSOADXX))
"RTN","PSOADDR",59,0)
 ..D FLD
"RTN","PSOADDR",60,0)
 ..D PRALL
"RTN","PSOADDR",61,0)
 G END
"RTN","PSOADDR",62,0)
ONE ;Print report for one patient
"RTN","PSOADDR",63,0)
 N PSOFILE
"RTN","PSOADDR",64,0)
 F PSOFILE=2,55 S PSOADLP="" F  S PSOADLP=$O(^DIA(PSOFILE,"B",PSOAPAT,PSOADLP)) Q:PSOADLP=""  S PSOC=$P($G(^DIA(PSOFILE,PSOADLP,0)),"^",3) D
"RTN","PSOADDR",65,0)
 .S PSOANODE=$G(^DIA(PSOFILE,PSOADLP,0))
"RTN","PSOADDR",66,0)
 .I +$P($G(PSOANODE),"^",2)>PSOSDT,+$P($G(PSOANODE),"^",2)<PSOEDT D
"RTN","PSOADDR",67,0)
 ..I PSOFILE=2 I PSOC=.111!(PSOC=.112)!(PSOC=.113)!(PSOC=.114)!(PSOC=.115)!(PSOC=.116)!(PSOC=.1211)!(PSOC=.1212)!(PSOC=.1213)!(PSOC=.1214)!(PSOC=.1215)!(PSOC=.1216)!(PSOC=.1112)!(PSOC=.12112)!(PSOC=.121)!(PSOC=.1217)!(PSOC=.1218)!(PSOC=.12105) D
"RTN","PSOADDR",68,0)
 ...S ^TMP("PSOADD",$J,+$P(PSOANODE,"^",2),PSOFILE,PSOADLP)=PSOANODE
"RTN","PSOADDR",69,0)
 ..I PSOFILE=55 I PSOC=.03!(PSOC=.05) D
"RTN","PSOADDR",70,0)
 ...S ^TMP("PSOADD",$J,+$P(PSOANODE,"^",2),PSOFILE,PSOADLP)=PSOANODE
"RTN","PSOADDR",71,0)
 K VA S DFN=PSOAPAT D PID^VADPT6 S PSOASN=$P($G(^DPT(+$G(PSOAPAT),0)),"^")_"  ("_$E(VA("PID"),5,12)_")"
"RTN","PSOADDR",72,0)
 K VA
"RTN","PSOADDR",73,0)
 D HD
"RTN","PSOADDR",74,0)
 I '$D(^TMP("PSOADD",$J)) W !!,"No data found to print for this date range.",! G END
"RTN","PSOADDR",75,0)
 S PSOADX="" F  S PSOADX=$O(^TMP("PSOADD",$J,PSOADX)) Q:PSOADX=""!(PSOUT)  F PSOFILE=2,55 S PSOADXX="" F  S PSOADXX=$O(^TMP("PSOADD",$J,PSOADX,PSOFILE,PSOADXX)) Q:PSOADXX=""!(PSOUT)  D
"RTN","PSOADDR",76,0)
 .I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",77,0)
 .S Y=PSOADX D DD^%DT S PSOADATE=Y
"RTN","PSOADDR",78,0)
 .S PSOADND=$G(^TMP("PSOADD",$J,PSOADX,PSOFILE,PSOADXX))
"RTN","PSOADDR",79,0)
 .D FLD
"RTN","PSOADDR",80,0)
 .W ! D PRONE
"RTN","PSOADDR",81,0)
END ;
"RTN","PSOADDR",82,0)
 K ^TMP("PSOADD",$J)
"RTN","PSOADDR",83,0)
 I '$G(PSOUT),PSODEV W !!,"End of Report." K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOADDR",84,0)
 I 'PSODEV W !!,"End of Report."
"RTN","PSOADDR",85,0)
 I PSODEV W !
"RTN","PSOADDR",86,0)
 E  W @IOF
"RTN","PSOADDR",87,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOADDR",88,0)
 Q
"RTN","PSOADDR",89,0)
HD ;
"RTN","PSOADDR",90,0)
 I '$G(PSOFORM) S PSOAFLAG=1
"RTN","PSOADDR",91,0)
 I PSODEV,PSOPAGE'=1 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S PSOUT=1 Q
"RTN","PSOADDR",92,0)
 I PSOPAGE=1,'PSODEV W ! I 1
"RTN","PSOADDR",93,0)
 E  W @IOF
"RTN","PSOADDR",94,0)
 D  W ?67,"PAGE: "_PSOPAGE S PSOPAGE=PSOPAGE+1
"RTN","PSOADDR",95,0)
 .I PSOFORM W !,"Address changes for "_$G(PSOASN) Q
"RTN","PSOADDR",96,0)
 .W !,"Address changes for ALL Patients"
"RTN","PSOADDR",97,0)
 W !,"made between "_$G(PSOSDTX)_" and "_$G(PSOEDTX)
"RTN","PSOADDR",98,0)
 W !,PSOLINE
"RTN","PSOADDR",99,0)
 Q
"RTN","PSOADDR",100,0)
MESS ;
"RTN","PSOADDR",101,0)
 W !!,"Nothing queued to print.",!
"RTN","PSOADDR",102,0)
 Q
"RTN","PSOADDR",103,0)
NAME ;Set name(ssn)
"RTN","PSOADDR",104,0)
 K VA S DFN=PSONX D PID^VADPT6
"RTN","PSOADDR",105,0)
 S PSONSSN=$G(PSONI)_"   ("_$E(VA("PID"),5,12)_")"
"RTN","PSOADDR",106,0)
 K VA
"RTN","PSOADDR",107,0)
 Q
"RTN","PSOADDR",108,0)
PRALL ;Print data for all patients
"RTN","PSOADDR",109,0)
 S PSOAFLAG=0
"RTN","PSOADDR",110,0)
 W !!,"          Patient: ",$G(PSONSSN) I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",111,0)
PRONE ;Print data for one patient
"RTN","PSOADDR",112,0)
 D CON W !,"Date/time of edit: ",$G(PSOADATE) I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",113,0)
 D CON W !,"     Field edited: ",$G(PSOADFF) I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",114,0)
 D CON W !,"        Edited by: ",$G(PSOADUSR) I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",115,0)
 D CON W !,"  Option/Protocol: ",$G(PSOAOPT) I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",116,0)
 D CON W !,"        Old Value: ",$S($P($G(^DIA(PSOFILE,PSOADXX,2)),"^")'="":$P($G(^(2)),"^"),1:"<no previous value>") I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",117,0)
 D CON W !,"        New Value: ",$S($P($G(^DIA(PSOFILE,PSOADXX,3)),"^")'="":$P($G(^(3)),"^"),1:"<no current value>") I ($Y+5)>IOSL D HD
"RTN","PSOADDR",118,0)
 Q
"RTN","PSOADDR",119,0)
CON ;
"RTN","PSOADDR",120,0)
 I PSOAFLAG,'PSOFORM W !,"  Patient (cont.): ",$G(PSONSSN) S PSOAFLAG=0
"RTN","PSOADDR",121,0)
 Q
"RTN","PSOADDR",122,0)
FLD ;Set field value
"RTN","PSOADDR",123,0)
 K PSOADF D FIELD^DID(PSOFILE,$P(PSOADND,"^",3),"","LABEL","PSOADF")
"RTN","PSOADDR",124,0)
 S PSOADFF=$G(PSOADF("LABEL"))
"RTN","PSOADDR",125,0)
USR ;Set user value
"RTN","PSOADDR",126,0)
 S PSOADUSR=$P(PSOADND,"^",4) I 'PSOADUSR S PSOADUSR="UNKNOWN"
"RTN","PSOADDR",127,0)
 I PSOADUSR'="UNKNOWN" K DIC S DIC="^VA(200,",DIC(0)="MZO",X="`"_PSOADUSR D ^DIC S PSOADUSR=$P($G(Y),"^",2) K DIC
"RTN","PSOADDR",128,0)
 I $G(PSOADUSR)="" S PSOADUSR="UNKNOWN"
"RTN","PSOADDR",129,0)
PROT ;Set value of protocol or option
"RTN","PSOADDR",130,0)
 S (PSOAOPT,PSOAOPTB,PSOAOPTC)=""
"RTN","PSOADDR",131,0)
 I $G(^DIA(PSOFILE,PSOADXX,4.1))="" S PSOAOPT="/" Q
"RTN","PSOADDR",132,0)
 S PSOAOPTA=$P($G(^DIA(PSOFILE,PSOADXX,4.1)),"^")
"RTN","PSOADDR",133,0)
 I PSOAOPTA K DIQ,DIC,PSOAOPTZ S DIC=19,DR=".01",DA=PSOAOPTA,DIQ(0)="E",DIQ="PSOAOPTZ" D EN^DIQ1 S PSOAOPTB=$G(PSOAOPTZ(19,PSOAOPTA,.01,"E")) K DIQ,DA,DR,PSOAOPTZ
"RTN","PSOADDR",134,0)
 S PSOAOPTA=$P($G(^DIA(PSOFILE,PSOADXX,4.1)),"^",2)
"RTN","PSOADDR",135,0)
 K PSOAOPTZ I $P(PSOAOPTA,";",2)="ORD(101," K DIC S DIC=101,DR=".01",DA=+PSOAOPTA,DIQ(0)="E",DIQ="PSOAOPTZ" D EN^DIQ1 S PSOAOPTC=$G(PSOAOPTZ(101,+PSOAOPTA,.01,"E")) K DA,DR,DIC,DIQ,PSOAOPTZ
"RTN","PSOADDR",136,0)
 I $P(PSOAOPTA,";",2)'="ORD(101,",+PSOAOPTA K DIC,DIQ S DIC=19,DR=".01",DA=+PSOAOPTA,DIQ(0)="E",DIQ="PSOAOPTZ" D EN^DIQ1 S PSOAOPTC=$G(PSOAOPTZ(19,+PSOAOPTA,.01,"E")) K PSOAOPTZ,DIC,DA,DR,DIQ
"RTN","PSOADDR",137,0)
 S PSOAOPT=$G(PSOAOPTB)_"/"_$G(PSOAOPTC)
"RTN","PSOADDR",138,0)
 Q
"RTN","PSOBAI")
0^2^B9247866^n/a
"RTN","PSOBAI",1,0)
PSOBAI ;BIR/EJW - BAD ADDRESS PROCESSING ;02/02/2006
"RTN","PSOBAI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**233**;DEC 1997;Build 8
"RTN","PSOBAI",3,0)
 ;
"RTN","PSOBAI",4,0)
 ;External reference EN^DGREGAED supported by DBIA 4198
"RTN","PSOBAI",5,0)
 ;External reference UPDATE^DGADDUTL supported by DBIA 4886
"RTN","PSOBAI",6,0)
 ;
"RTN","PSOBAI",7,0)
CHKADDR(PSODFN,WARN,UPDATE) ; CHECK ADDRESS BY PATIENT
"RTN","PSOBAI",8,0)
 ;Input: PSODFN - PATIENT file (#2) IEN
"RTN","PSOBAI",9,0)
 ;       WARN - Display warning (optional)
"RTN","PSOBAI",10,0)
 ;       UPDATE - If bad address flagged, prompt to update patient address (optional)
"RTN","PSOBAI",11,0)
 ;If calling from patient selection, if bad, even if there is an active temporary address, prompt to update the address
"RTN","PSOBAI",12,0)
 N PSOBADR,PSOTEMP
"RTN","PSOBAI",13,0)
 I PSODFN="" Q
"RTN","PSOBAI",14,0)
 S PSOBADR=$$BADADR^DGUTL3(PSODFN)
"RTN","PSOBAI",15,0)
 I PSOBADR D
"RTN","PSOBAI",16,0)
 .S PSOTEMP=$$CHKTEMP(PSODFN)
"RTN","PSOBAI",17,0)
 .I $G(WARN) D
"RTN","PSOBAI",18,0)
 ..D WARN1
"RTN","PSOBAI",19,0)
 ..I $G(UPDATE) D UPDATE Q
"RTN","PSOBAI",20,0)
 ..D PAUSE
"RTN","PSOBAI",21,0)
 Q
"RTN","PSOBAI",22,0)
 ;
"RTN","PSOBAI",23,0)
CHKRX(PSORX) ;CHECK ADDRESS BY RX
"RTN","PSOBAI",24,0)
 ;Input: PSORX - PRESCRIPTION file (#52) IEN
"RTN","PSOBAI",25,0)
 ;Output: PSOBADR - Bad Address Indicator_"^"_temporary address or not
"RTN","PSOBAI",26,0)
 N PSOBADR,PSODFN,PSOTEMP
"RTN","PSOBAI",27,0)
 S PSOBADR=""
"RTN","PSOBAI",28,0)
 I PSORX="" Q
"RTN","PSOBAI",29,0)
 S PSODFN=$P($G(^PSRX(PSORX,0)),"^",2) I PSODFN="" Q
"RTN","PSOBAI",30,0)
 S PSOBADR=$$BADADR^DGUTL3(PSODFN)
"RTN","PSOBAI",31,0)
 I PSOBADR S PSOTEMP=$$CHKTEMP(PSODFN)
"RTN","PSOBAI",32,0)
 S PSOBADR=PSOBADR_"^"_$G(PSOTEMP)
"RTN","PSOBAI",33,0)
 Q PSOBADR
"RTN","PSOBAI",34,0)
 ;
"RTN","PSOBAI",35,0)
WARN1 ;
"RTN","PSOBAI",36,0)
 W !!,?8,"WARNING: The patient address is indicated as a bad"
"RTN","PSOBAI",37,0)
 W !,?17,"address (",$S(PSOBADR=1:"UNDELIVERABLE",PSOBADR=2:"HOMELESS",1:"OTHER"),")."
"RTN","PSOBAI",38,0)
 I $G(PSOTEMP) W !,?17,"* Temporary address is active *" Q
"RTN","PSOBAI",39,0)
 W !,?17,"Medication will not be mailed to"
"RTN","PSOBAI",40,0)
 W !,?17,"the patient until the address has been"
"RTN","PSOBAI",41,0)
 W !,?17,"corrected.",!
"RTN","PSOBAI",42,0)
 Q
"RTN","PSOBAI",43,0)
CHKTEMP(PSODFN) ; see if active temporary address
"RTN","PSOBAI",44,0)
 ;Input: PSODFN - PATIENT file (#2) IEN
"RTN","PSOBAI",45,0)
 N DFN,VAPA
"RTN","PSOBAI",46,0)
 S DFN=PSODFN,PSOTEMP=0
"RTN","PSOBAI",47,0)
 D 6^VADPT I +VAPA(9) S PSOTEMP=1
"RTN","PSOBAI",48,0)
 Q PSOTEMP
"RTN","PSOBAI",49,0)
 ;
"RTN","PSOBAI",50,0)
UPDATE ;
"RTN","PSOBAI",51,0)
 N PSOSEL
"RTN","PSOBAI",52,0)
 I '$D(PSOPAR) D ^PSOLSET
"RTN","PSOBAI",53,0)
 I '$P($G(PSOPAR),"^",22),'$D(^XUSEC("PSO ADDRESS UPDATE",+$G(DUZ))) D PAUSE Q
"RTN","PSOBAI",54,0)
 K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Do you want to update the address/phone"
"RTN","PSOBAI",55,0)
 D ^DIR K DIR
"RTN","PSOBAI",56,0)
 I Y'=1 Q
"RTN","PSOBAI",57,0)
 L +^DPT(PSODFN):1 I '$T D MSG,PAUSE Q
"RTN","PSOBAI",58,0)
 K DIR S DIR(0)="SAO^P:PERMANENT;T:TEMPORARY;B:BOTH"
"RTN","PSOBAI",59,0)
 S DIR("A")=" Update (P)ermanent address, (T)emporary, or (B)oth: "
"RTN","PSOBAI",60,0)
 S DIR("B")="BOTH" D ^DIR
"RTN","PSOBAI",61,0)
 I $D(DIRUT) G ULK
"RTN","PSOBAI",62,0)
 S PSOSEL=Y
"RTN","PSOBAI",63,0)
 I PSOSEL="P"!(PSOSEL="B") D
"RTN","PSOBAI",64,0)
 .;D UPDATE^DGADDUTL(PSODFN,"PERM") - THIS CALL CLEARS BAI FLAG INAPPROPRIATELY SO USE FOLLOWING TO UPDATE PERMANENT ADDRESS/PHONE INSTEAD 5/29/06
"RTN","PSOBAI",65,0)
 .N PSOFLG
"RTN","PSOBAI",66,0)
 .S PSOFLG(1)=1 D EN^DGREGAED(PSODFN,.PSOFLG) W !
"RTN","PSOBAI",67,0)
 I PSOSEL="P" D ULK Q
"RTN","PSOBAI",68,0)
 I PSOSEL="B"!(PSOSEL="T") D UPDATE^DGADDUTL(PSODFN,"TEMP"),ULK,PAUSE
"RTN","PSOBAI",69,0)
 Q
"RTN","PSOBAI",70,0)
ULK ;
"RTN","PSOBAI",71,0)
 L -^DPT(PSODFN)
"RTN","PSOBAI",72,0)
 Q
"RTN","PSOBAI",73,0)
 ;
"RTN","PSOBAI",74,0)
PAUSE ;
"RTN","PSOBAI",75,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOBAI",76,0)
 Q
"RTN","PSOBAI",77,0)
 ;
"RTN","PSOBAI",78,0)
MSG ;
"RTN","PSOBAI",79,0)
 S VALMSG="Patient Data is being edited by another user!"
"RTN","PSOBAI",80,0)
 Q
"RTN","PSOBAI",81,0)
 ;
"RTN","PSOBAIR2")
0^4^B20289266^n/a
"RTN","PSOBAIR2",1,0)
PSOBAIR2 ;BIR/RTR-Report of suspended prescriptions with bad address ;08/16/2006
"RTN","PSOBAIR2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**233**;DEC 1997;Build 8
"RTN","PSOBAIR2",3,0)
 ;
"RTN","PSOBAIR2",4,0)
EN ;
"RTN","PSOBAIR2",5,0)
 N PSOAPAT,PSOSDT,PSOEDT,PSOSDTX,PSOEDTX,X,Y,X1,X2
"RTN","PSOBAIR2",6,0)
 W !!,"This option shows patients who have unprinted active prescriptions"
"RTN","PSOBAIR2",7,0)
 W !,"on suspense who do not have a valid permanent or temporary address.",!!
"RTN","PSOBAIR2",8,0)
DATE ;
"RTN","PSOBAIR2",9,0)
 W ! K %DT S %DT="AEX",%DT("A")="Starting suspense date: " D ^%DT K %DT I Y<0!($D(DTOUT))!($D(DUOUT)) D MESS Q 
"RTN","PSOBAIR2",10,0)
 S (%DT(0),PSOSDT)=Y D DD^%DT S PSOSDTX=Y
"RTN","PSOBAIR2",11,0)
 W ! S %DT="AEX",%DT("A")="Ending suspense date: " D ^%DT K %DT I Y<0!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOBAIR2",12,0)
 S PSOEDT=Y D DD^%DT S PSOEDTX=Y
"RTN","PSOBAIR2",13,0)
 S X1=PSOSDT,X2=-1 D C^%DTC S PSOSDT=X_".9999"
"RTN","PSOBAIR2",14,0)
 S X1=PSOEDT,X2=+1 D C^%DTC S PSOEDT=X
"RTN","PSOBAIR2",15,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) D MESS Q
"RTN","PSOBAIR2",16,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS I $G(POP) D MESS Q
"RTN","PSOBAIR2",17,0)
 I $D(IO("Q")) D  Q
"RTN","PSOBAIR2",18,0)
 .S ZTRTN="REP^PSOBAIR2",ZTDESC="Pharmacy bad address suspense report",ZTSAVE("PSOSITE")="",ZTSAVE("PSOAPAT")="",ZTSAVE("PSOSDT")="",ZTSAVE("PSOEDT")="",ZTSAVE("PSOEDTX")="",ZTSAVE("PSOSDTX")="" D ^%ZTLOAD K %ZIS
"RTN","PSOBAIR2",19,0)
 .W !!,"Report queued to print.",!
"RTN","PSOBAIR2",20,0)
REP ;
"RTN","PSOBAIR2",21,0)
 K ^TMP("PSOBADL",$J)
"RTN","PSOBAIR2",22,0)
 N PSODEV,PSOUT,PSOLINE,PSOPAGE,PSOADND,PSOADF,PSOADFF,PSOAOPT,PSOAOPTA,PSOAOPTZ,PSOAOPTB,PSOAOPTC,PSOADLP,PSOANODE,PSOADX,SFN,PSOADATE,PSOC,PSOAALL,PSODFN,PSOANAME,PSONI,PSONX,PSONB,PSOASN,VA,DFN,PSONSSN,PSOAFLAG
"RTN","PSOBAIR2",23,0)
 U IO
"RTN","PSOBAIR2",24,0)
 S (PSOUT,PSOAFLAG)=0,PSODEV=$S($E(IOST,1,2)'="C-":0,1:1),PSOPAGE=1
"RTN","PSOBAIR2",25,0)
 S $P(PSOLINE,"-",78)=""
"RTN","PSOBAIR2",26,0)
ALL ;
"RTN","PSOBAIR2",27,0)
 N PSORD,SFN,PSOLBL,PSOX,PSODFN,RXIEN,PRINTED,RXSITE,RXSTS,PARTIAL
"RTN","PSOBAIR2",28,0)
 S PSODFN=0 F  S PSODFN=$O(^PS(52.5,"AC",PSODFN)) Q:'PSODFN  D
"RTN","PSOBAIR2",29,0)
 .S PSOBAI=0 D CHKADDR I 'PSOBAI Q
"RTN","PSOBAIR2",30,0)
 .S PSORD=PSOSDT F  S PSORD=$O(^PS(52.5,"AC",PSODFN,PSORD)) Q:'PSORD!(PSORD>PSOEDT)  D
"RTN","PSOBAIR2",31,0)
 ..S SFN=0 F  S SFN=$O(^PS(52.5,"AC",PSODFN,PSORD,SFN)) Q:'SFN  D
"RTN","PSOBAIR2",32,0)
 ...I '$D(^PS(52.5,SFN,0))!'$D(^DPT(+PSODFN,0)) Q
"RTN","PSOBAIR2",33,0)
 ...S RXIEN=+$$GET1^DIQ(52.5,SFN,.01,"I"),RXSITE=+$$GET1^DIQ(52.5,SFN,.06,"I")
"RTN","PSOBAIR2",34,0)
 ...I RXSITE'=$G(PSOSITE) Q
"RTN","PSOBAIR2",35,0)
 ...S RXSTS=$$GET1^DIQ(52,RXIEN,100,"I") I RXSTS>8 Q
"RTN","PSOBAIR2",36,0)
 ...S PARTIAL=+$$GET1^DIQ(52.5,SFN,.05,"I")
"RTN","PSOBAIR2",37,0)
 ...I PARTIAL,'$D(^PSRX(RXIEN,"P",PARTIAL)) Q
"RTN","PSOBAIR2",38,0)
 ...S PSOANAME=$P($G(^DPT(PSODFN,0)),"^") Q:PSOANAME=""
"RTN","PSOBAIR2",39,0)
 ...S ^TMP("PSOBADL",$J,PSOANAME,PSODFN,PSORD,RXIEN)=""
"RTN","PSOBAIR2",40,0)
 D HD
"RTN","PSOBAIR2",41,0)
 I '$D(^TMP("PSOBADL",$J)) W !!,"No data found to print for this date range.",! G END
"RTN","PSOBAIR2",42,0)
 S PSONI="" F  S PSONI=$O(^TMP("PSOBADL",$J,PSONI)) Q:PSONI=""!(PSOUT)  D
"RTN","PSOBAIR2",43,0)
 .S PSONX="" F  S PSONX=$O(^TMP("PSOBADL",$J,PSONI,PSONX)) Q:PSONX=""!(PSOUT)  D NAME,PRALL D
"RTN","PSOBAIR2",44,0)
 ..S PSONB="" F  S PSONB=$O(^TMP("PSOBADL",$J,PSONI,PSONX,PSONB)) Q:PSONB=""!(PSOUT)  D
"RTN","PSOBAIR2",45,0)
 ...S SFN="" F  S SFN=$O(^TMP("PSOBADL",$J,PSONI,PSONX,PSONB,SFN)) Q:SFN=""!(PSOUT)  D
"RTN","PSOBAIR2",46,0)
 ....I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIR2",47,0)
 ....S Y=PSONB D DD^%DT S PSOADATE=Y
"RTN","PSOBAIR2",48,0)
 ....D PRONE
"RTN","PSOBAIR2",49,0)
END ;
"RTN","PSOBAIR2",50,0)
 K ^TMP("PSOBADL",$J)
"RTN","PSOBAIR2",51,0)
 K DTOUT,DUOUT,PSOBAI
"RTN","PSOBAIR2",52,0)
 I '$G(PSOUT),PSODEV W !!,"End of Report." K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOBAIR2",53,0)
 I 'PSODEV W !!,"End of Report."
"RTN","PSOBAIR2",54,0)
 I PSODEV W !
"RTN","PSOBAIR2",55,0)
 E  W @IOF
"RTN","PSOBAIR2",56,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOBAIR2",57,0)
 Q
"RTN","PSOBAIR2",58,0)
HD ;
"RTN","PSOBAIR2",59,0)
 S PSOAFLAG=1
"RTN","PSOBAIR2",60,0)
 I PSODEV,PSOPAGE'=1 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S PSOUT=1 Q
"RTN","PSOBAIR2",61,0)
 I PSOPAGE=1,'PSODEV W ! I 1
"RTN","PSOBAIR2",62,0)
 E  W @IOF
"RTN","PSOBAIR2",63,0)
 D  W ?67,"PAGE: "_PSOPAGE S PSOPAGE=PSOPAGE+1
"RTN","PSOBAIR2",64,0)
 .W !,"Suspense bad address report - division=",$P($G(^PS(59,+$G(PSOSITE),0)),"^")
"RTN","PSOBAIR2",65,0)
 W !,"for suspense dates between "_$G(PSOSDTX)_" and "_$G(PSOEDTX)
"RTN","PSOBAIR2",66,0)
 W !,PSOLINE
"RTN","PSOBAIR2",67,0)
 Q
"RTN","PSOBAIR2",68,0)
MESS ;
"RTN","PSOBAIR2",69,0)
 W !!,"Nothing queued to print.",!
"RTN","PSOBAIR2",70,0)
 Q
"RTN","PSOBAIR2",71,0)
NAME ;Set name(ssn)
"RTN","PSOBAIR2",72,0)
 K VA S DFN=PSONX D PID^VADPT6
"RTN","PSOBAIR2",73,0)
 S PSONSSN=$G(PSONI)_"   ("_$E(VA("PID"),5,12)_")"
"RTN","PSOBAIR2",74,0)
 K VA
"RTN","PSOBAIR2",75,0)
 Q
"RTN","PSOBAIR2",76,0)
PRALL ;Print data for all patients
"RTN","PSOBAIR2",77,0)
 N PSOADDR
"RTN","PSOBAIR2",78,0)
 S PSOADDR=""
"RTN","PSOBAIR2",79,0)
 S PSOAFLAG=0
"RTN","PSOBAIR2",80,0)
 W !!,$G(PSONSSN) D CHKADDR W ?30,"  ",PSOADDR I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIR2",81,0)
 Q
"RTN","PSOBAIR2",82,0)
PRONE ;Print data for one patient
"RTN","PSOBAIR2",83,0)
 N SFN0
"RTN","PSOBAIR2",84,0)
 S SFN0=$G(^PSRX(SFN,0)) I SFN0=""!($P(SFN0,"^",6)="") Q
"RTN","PSOBAIR2",85,0)
 D CON W !,$G(PSOADATE),?15," Rx#: ",$P(SFN0,"^"),?30,"  ",$P($G(^PSDRUG($P(SFN0,"^",6),0)),"^")
"RTN","PSOBAIR2",86,0)
 I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIR2",87,0)
 Q
"RTN","PSOBAIR2",88,0)
CON ;
"RTN","PSOBAIR2",89,0)
 I PSOAFLAG W !,$G(PSONSSN) S PSOAFLAG=0
"RTN","PSOBAIR2",90,0)
 Q
"RTN","PSOBAIR2",91,0)
 ;
"RTN","PSOBAIR2",92,0)
CHKADDR ;
"RTN","PSOBAIR2",93,0)
 N PSOBADR,PSOTEMP
"RTN","PSOBAIR2",94,0)
 S PSOBADR=$$BADADR^DGUTL3(PSODFN)
"RTN","PSOBAIR2",95,0)
 I PSOBADR D
"RTN","PSOBAIR2",96,0)
 .S PSOTEMP=$$CHKTEMP^PSOBAI(PSODFN)
"RTN","PSOBAIR2",97,0)
 I PSOBADR,'PSOTEMP S PSOBAI=1 Q
"RTN","PSOBAIR2",98,0)
 Q
"RTN","PSOBAIRP")
0^3^B25852563^n/a
"RTN","PSOBAIRP",1,0)
PSOBAIRP ;BIR/RTR-Report of prescription mail labels with bad address ;08/16/2006
"RTN","PSOBAIRP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**233**;DEC 1997;Build 8
"RTN","PSOBAIRP",3,0)
 ;
"RTN","PSOBAIRP",4,0)
EN ;
"RTN","PSOBAIRP",5,0)
 N PSOFORM,PSOAPAT,PSOSDT,PSOEDT,PSOSDTX,PSOEDTX,X,Y,X1,X2
"RTN","PSOBAIRP",6,0)
 W !!,"This option provides a report that shows patients and prescriptions whose last"
"RTN","PSOBAIRP",7,0)
 W !,"label activity had a routing of mail and no valid permanent or temporary"
"RTN","PSOBAIRP",8,0)
 W !,"address. It will also indicate whether the patient now has a good address.",!!
"RTN","PSOBAIRP",9,0)
 K DIR S DIR(0)="SB^S:Single;A:All",DIR("A")="Print report for a Single patient, or All patients",DIR("B")="Single",DIR("?")=" ",DIR("?",1)="Enter 'S' to print address changes for one patient over the selected"
"RTN","PSOBAIRP",10,0)
 S DIR("?",2)="date range, enter 'A' to print address changes for all patients",DIR("?",3)="over the selected date range."
"RTN","PSOBAIRP",11,0)
 D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOBAIRP",12,0)
 S PSOFORM=$S(Y="S":1,1:0)
"RTN","PSOBAIRP",13,0)
 I 'PSOFORM G DATE
"RTN","PSOBAIRP",14,0)
 K DIC W ! S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: " D ^DIC K DIC I Y<1!($D(DUOUT))!($D(DTOUT)) D MESS Q
"RTN","PSOBAIRP",15,0)
 S PSOAPAT=+Y
"RTN","PSOBAIRP",16,0)
DATE ;
"RTN","PSOBAIRP",17,0)
 W !!
"RTN","PSOBAIRP",18,0)
 W ! K %DT S %DT="AEX",%DT("A")="Start fill date: " D ^%DT K %DT I Y<0!($D(DTOUT))!($D(DUOUT)) D MESS Q 
"RTN","PSOBAIRP",19,0)
 S (%DT(0),PSOSDT)=Y D DD^%DT S PSOSDTX=Y
"RTN","PSOBAIRP",20,0)
 W ! S %DT="AEX",%DT("A")="End fill date: " D ^%DT K %DT I Y<0!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOBAIRP",21,0)
 S PSOEDT=Y D DD^%DT S PSOEDTX=Y
"RTN","PSOBAIRP",22,0)
 S X1=PSOSDT,X2=-1 D C^%DTC S PSOSDT=X_".9999"
"RTN","PSOBAIRP",23,0)
 S X1=PSOEDT,X2=+1 D C^%DTC S PSOEDT=X
"RTN","PSOBAIRP",24,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS I $G(POP) D MESS Q
"RTN","PSOBAIRP",25,0)
 I $D(IO("Q")) D  Q
"RTN","PSOBAIRP",26,0)
 .S ZTRTN="REP^PSOBAIRP",ZTDESC="Pharmacy bad address mail label report",ZTSAVE("PSOFORM")="",ZTSAVE("PSOAPAT")="",ZTSAVE("PSOSDT")="",ZTSAVE("PSOEDT")="",ZTSAVE("PSOEDTX")="",ZTSAVE("PSOSDTX")="" D ^%ZTLOAD K %ZIS
"RTN","PSOBAIRP",27,0)
 .W !!,"Report queued to print.",!
"RTN","PSOBAIRP",28,0)
REP ;
"RTN","PSOBAIRP",29,0)
 K ^TMP("PSOBADL",$J)
"RTN","PSOBAIRP",30,0)
 N PSODEV,PSOUT,PSOLINE,PSOPAGE,PSOADND,PSOADF,PSOADFF,PSOAOPT,PSOAOPTA,PSOAOPTZ,PSOAOPTB,PSOAOPTC,PSOADLP,PSOANODE,PSOADX,PSORX,PSOADATE,PSOC,PSOAALL,PSOADFN,PSOANAME,PSONI,PSONX,PSONB,PSOASN,VA,DFN,PSONSSN,PSOAFLAG
"RTN","PSOBAIRP",31,0)
 U IO
"RTN","PSOBAIRP",32,0)
 S (PSOUT,PSOAFLAG)=0,PSODEV=$S($E(IOST,1,2)'="C-":0,1:1),PSOPAGE=1
"RTN","PSOBAIRP",33,0)
 S $P(PSOLINE,"-",78)=""
"RTN","PSOBAIRP",34,0)
ALL ;Print report for all patients
"RTN","PSOBAIRP",35,0)
 N PSORD,PSORX,PSOLBL,PSOX
"RTN","PSOBAIRP",36,0)
 S PSORD=PSOSDT F  S PSORD=$O(^PSRX("AD",PSORD)) Q:'PSORD!(PSORD>PSOEDT)  D
"RTN","PSOBAIRP",37,0)
 .S PSORX=0 F  S PSORX=$O(^PSRX("AD",PSORD,PSORX)) Q:'PSORX  D
"RTN","PSOBAIRP",38,0)
 ..S PSOLBL=$O(^PSRX(PSORX,"L",999999),-1) I 'PSOLBL Q
"RTN","PSOBAIRP",39,0)
 ..S PSOX=$G(^PSRX(PSORX,"L",PSOLBL,0)) I PSOX["(BAD ADDRESS",PSOX'["WINDOW" D
"RTN","PSOBAIRP",40,0)
 ...S PSOADFN=$P($G(^PSRX(PSORX,0)),"^",2) Q:'PSOADFN
"RTN","PSOBAIRP",41,0)
 ...I $G(PSOFORM),PSOADFN'=PSOAPAT Q
"RTN","PSOBAIRP",42,0)
 ...S PSOANAME=$P($G(^DPT(PSOADFN,0)),"^") Q:PSOANAME=""
"RTN","PSOBAIRP",43,0)
 ...S ^TMP("PSOBADL",$J,PSOANAME,PSOADFN,PSORD,PSORX)=""
"RTN","PSOBAIRP",44,0)
 D HD
"RTN","PSOBAIRP",45,0)
 I '$D(^TMP("PSOBADL",$J)) W !!,"No data found to print for this date range.",! G END
"RTN","PSOBAIRP",46,0)
 S PSONI="" F  S PSONI=$O(^TMP("PSOBADL",$J,PSONI)) Q:PSONI=""!(PSOUT)  D
"RTN","PSOBAIRP",47,0)
 .S PSONX="" F  S PSONX=$O(^TMP("PSOBADL",$J,PSONI,PSONX)) Q:PSONX=""!(PSOUT)  D NAME,PRALL D
"RTN","PSOBAIRP",48,0)
 ..S PSONB="" F  S PSONB=$O(^TMP("PSOBADL",$J,PSONI,PSONX,PSONB)) Q:PSONB=""!(PSOUT)  D
"RTN","PSOBAIRP",49,0)
 ...S PSORX="" F  S PSORX=$O(^TMP("PSOBADL",$J,PSONI,PSONX,PSONB,PSORX)) Q:PSORX=""!(PSOUT)  D
"RTN","PSOBAIRP",50,0)
 ....I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIRP",51,0)
 ....S Y=PSONB D DD^%DT S PSOADATE=Y
"RTN","PSOBAIRP",52,0)
 ....D PRONE
"RTN","PSOBAIRP",53,0)
END ;
"RTN","PSOBAIRP",54,0)
 K ^TMP("PSOBADL",$J)
"RTN","PSOBAIRP",55,0)
 K DTOUT,DUOUT
"RTN","PSOBAIRP",56,0)
 I '$G(PSOUT),PSODEV W !!,"End of Report." K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOBAIRP",57,0)
 I 'PSODEV W !!,"End of Report."
"RTN","PSOBAIRP",58,0)
 I PSODEV W !
"RTN","PSOBAIRP",59,0)
 E  W @IOF
"RTN","PSOBAIRP",60,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOBAIRP",61,0)
 Q
"RTN","PSOBAIRP",62,0)
HD ;
"RTN","PSOBAIRP",63,0)
 I '$G(PSOFORM) S PSOAFLAG=1
"RTN","PSOBAIRP",64,0)
 I PSODEV,PSOPAGE'=1 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S PSOUT=1 Q
"RTN","PSOBAIRP",65,0)
 I PSOPAGE=1,'PSODEV W ! I 1
"RTN","PSOBAIRP",66,0)
 E  W @IOF
"RTN","PSOBAIRP",67,0)
 D  W ?67,"PAGE: "_PSOPAGE S PSOPAGE=PSOPAGE+1
"RTN","PSOBAIRP",68,0)
 .I PSOFORM W !,"Bad address mail label report for "_$G(PSOANAME) Q
"RTN","PSOBAIRP",69,0)
 .W !,"Bad address mail label report for ALL Patients"
"RTN","PSOBAIRP",70,0)
 W !,"for fill date between "_$G(PSOSDTX)_" and "_$G(PSOEDTX)
"RTN","PSOBAIRP",71,0)
 W !,PSOLINE
"RTN","PSOBAIRP",72,0)
 Q
"RTN","PSOBAIRP",73,0)
MESS ;
"RTN","PSOBAIRP",74,0)
 W !!,"Nothing queued to print.",!
"RTN","PSOBAIRP",75,0)
 Q
"RTN","PSOBAIRP",76,0)
NAME ;Set name(ssn)
"RTN","PSOBAIRP",77,0)
 K VA S DFN=PSONX D PID^VADPT6
"RTN","PSOBAIRP",78,0)
 S PSONSSN=$G(PSONI)_"   ("_$E(VA("PID"),5,12)_")"
"RTN","PSOBAIRP",79,0)
 K VA
"RTN","PSOBAIRP",80,0)
 Q
"RTN","PSOBAIRP",81,0)
PRALL ;Print data for all patients
"RTN","PSOBAIRP",82,0)
 N PSOADDR
"RTN","PSOBAIRP",83,0)
 S PSOADDR=""
"RTN","PSOBAIRP",84,0)
 S PSOAFLAG=0
"RTN","PSOBAIRP",85,0)
 W !!,$G(PSONSSN) D CHKADDR W ?30,"  ",PSOADDR I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIRP",86,0)
 Q
"RTN","PSOBAIRP",87,0)
PRONE ;Print data for one patient
"RTN","PSOBAIRP",88,0)
 N PSORX0
"RTN","PSOBAIRP",89,0)
 S PSORX0=$G(^PSRX(PSORX,0)) I PSORX0=""!($P(PSORX0,"^",6)="") Q
"RTN","PSOBAIRP",90,0)
 D CON W !,$G(PSOADATE),?15," Rx#: ",$P(PSORX0,"^"),?30,"  ",$P($G(^PSDRUG($P(PSORX0,"^",6),0)),"^")
"RTN","PSOBAIRP",91,0)
 I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIRP",92,0)
 Q
"RTN","PSOBAIRP",93,0)
CON ;
"RTN","PSOBAIRP",94,0)
 I PSOAFLAG,'PSOFORM W !,$G(PSONSSN) S PSOAFLAG=0
"RTN","PSOBAIRP",95,0)
 Q
"RTN","PSOBAIRP",96,0)
 ;
"RTN","PSOBAIRP",97,0)
CHKADDR ;
"RTN","PSOBAIRP",98,0)
 N PSOBADR,PSOTEMP
"RTN","PSOBAIRP",99,0)
 I $G(PSONX)="" Q
"RTN","PSOBAIRP",100,0)
 S PSOBADR=$$BADADR^DGUTL3(PSONX)
"RTN","PSOBAIRP",101,0)
 I PSOBADR D
"RTN","PSOBAIRP",102,0)
 .S PSOTEMP=$$CHKTEMP^PSOBAI(PSONX)
"RTN","PSOBAIRP",103,0)
 I PSOBADR,'PSOTEMP S PSOADDR="** BAD ADDRESS **" Q
"RTN","PSOBAIRP",104,0)
 S PSOADDR="PATIENT NOW HAS A VALID ADDRESS"
"RTN","PSOBAIRP",105,0)
 Q
"RTN","PSODEM")
0^23^B13922974^B13668048
"RTN","PSODEM",1,0)
PSODEM ;BHAM ISC/SAB - PATIENT DEMOGRAPHICS ; 02/17/93 12:29
"RTN","PSODEM",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**5,19,233**;DEC 1997;Build 8
"RTN","PSODEM",3,0)
GET S DFN=DA D 6^VADPT,PID^VADPT U IO W @IOF,!,VADM(1),?40,"ID#:   "_VA("PID")
"RTN","PSODEM",4,0)
 I +VAPA(9) W !?5,"(TEMP ADDRESS from "_$P(VAPA(9),"^",2)_" till "_$S($P(VAPA(10),"^",2)]"":$P(VAPA(10),"^",2),1:"(no end date)")_")"
"RTN","PSODEM",5,0)
 W !,VAPA(1),?40,"DOB:   ",$S(+VADM(3):$P(VADM(3),"^",2),1:"UNKNOWN") W:VAPA(2)]"" !,VAPA(2) W:VAPA(3)]"" !,VAPA(3)
"RTN","PSODEM",6,0)
 W !,VAPA(4),?40,"PHONE: "_VAPA(8),!,$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6)),?40,"ELIG:  "_$P(VAEL(1),"^",2) W:+VAEL(3) !?40,"SC%:   "_$P(VAEL(3),"^",2)
"RTN","PSODEM",7,0)
 I $D(^PS(55,DFN,0)) W:$P(^(0),"^",2) !,"CANNOT USE SAFETY CAPS." I +$P(^(0),"^",4) W ?40,"DIALYSIS PATIENT."
"RTN","PSODEM",8,0)
 I $G(^PS(55,DFN,1))]"" S X=^(1) W !!?5,"Pharmacy Narrative: " F I=1:1 Q:$P(X," ",I,99)=""  W:$X+$L($P(X," ",I))+$L(" ")>IOM ! W $P(X," ",I)," "
"RTN","PSODEM",9,0)
RE S (WT,HT)="",X="GMRVUTL" X ^%ZOSF("TEST") I $T D
"RTN","PSODEM",10,0)
 .F GMRVSTR="WT","HT" S VM=GMRVSTR D EN6^GMRVUTL S @VM=X,$P(@VM,"^")=$E($P(@VM,"^"),4,5)_"/"_$E($P(@VM,"^"),6,7)_"/"_($E($P(@VM,"^"),1,3)+1700)
"RTN","PSODEM",11,0)
 .S X=$P(WT,"^",8),Y=$J(X/2.2,0,2),$P(WT,"^",9)=Y,X=$P(HT,"^",8),Y=$J(2.54*X,0,2),$P(HT,"^",9)=Y
"RTN","PSODEM",12,0)
 Q:$G(POERR)
"RTN","PSODEM",13,0)
 W !!,"WEIGHT(Kg): " W:+$P(WT,"^",8) $P(WT,"^",9)_" ("_$P(WT,"^")_")" W ?41,"HEIGHT(cm): " W:$P(HT,"^",8) $P(HT,"^",9)_" ("_$P(HT,"^")_")" K VM,WT,HT
"RTN","PSODEM",14,0)
 S PSLC=0 G MA:$P($G(^DPT(DFN,.17)),"^",2)'="I"
"RTN","PSODEM",15,0)
 I '$D(VAEL(1)) D ELIG^VADPT W !!,"ELIGIBILITY: ",$P(VAEL(1),"^",2) W:+VAEL(3) ?$X+5,"SC%: "_$P(VAEL(3),"^",2) S PSLC=PSLC+2
"RTN","PSODEM",16,0)
MA K SC W !,"DISABILITIES: " S PSLC=PSLC+2
"RTN","PSODEM",17,0)
 F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSODEM",18,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSODEM",19,0)
 .X:($X+$L(PSDIS)+7)>(IOM-8) "W !?14 S PSLC=PSLC+1" W PSDIS,"-",PSCNT,"% (",$S($P(I1,"^",3):"SC",1:"NSC"),"), "
"RTN","PSODEM",20,0)
 .I $E(IOST)="C",$Y+4>IOSL,$D(PSTYPE) K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DTOUT W @IOF,?13
"RTN","PSODEM",21,0)
 X "N X S X=""GMRADPT"" X ^%ZOSF(""TEST"") Q" I $T D:'$D(PSOPTPST) GMRA
"RTN","PSODEM",22,0)
Q K SC,I1,VAROOT,Y,AL,I,X,Y,PSCNT,PSLC,PSDIS D:$G(PSTYPE)']"" KVA^VADPT Q
"RTN","PSODEM",23,0)
GMRA K ^TMP($J,"AL") S GMRA="0^0^111" D ^GMRADPT I GMRAL D
"RTN","PSODEM",24,0)
 .F DR=0:0 S DR=$O(GMRAL(DR)) Q:'DR  S ^TMP($J,"AL",$S('$P(GMRAL(DR),"^",5):1,1:2),$P(GMRAL(DR),"^",7),$P(GMRAL(DR),"^",2))=""
"RTN","PSODEM",25,0)
 .W !!,"ALLERGIES: " S (DR,TY)="" F I=0:0 S TY=$O(^TMP($J,"AL",1,TY)) Q:TY=""  F D=0:0 S DR=$O(^TMP($J,"AL",1,TY,DR)) Q:DR=""  W:$X+$L(DR)+$L(", ")>IOM !?11 W DR_", " D
"RTN","PSODEM",26,0)
 ..I $E(IOST)="C",$Y+4>IOSL,$D(PSTYPE) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DTOUT W @IOF,?18
"RTN","PSODEM",27,0)
 .W !!,"ADVERSE REACTIONS: " S (DR,TY)="" F I=0:0 S TY=$O(^TMP($J,"AL",2,TY)) Q:TY=""  F D=0:0 S DR=$O(^TMP($J,"AL",2,TY,DR)) Q:DR=""  W:$X+$L(DR)+$L(", ")>IOM !?19 W DR_", " D
"RTN","PSODEM",28,0)
 ..I $E(IOST)="C",$Y+4>IOSL,$D(PSTYPE) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DTOUT W @IOF,?18
"RTN","PSODEM",29,0)
 I $G(GMRAL)']"" F AD="ALLERGIES:","ADVERSE REACTIONS:" W !!,AD I $G(PSOFROM)="" F ADL=1:1:IOM-($L(AD)+5) W "_"
"RTN","PSODEM",30,0)
 I GMRAL=0 W !!,"ALLERGIES: NKA",!!,"ADVERSE REACTIONS:"
"RTN","PSODEM",31,0)
 W ! K TY,D,I,GMRA,GMRAL,DR,AD,ADL,^TMP($J,"AL") Q
"RTN","PSOLBL4")
0^8^B55680785^B52469710
"RTN","PSOLBL4",1,0)
PSOLBL4 ;BIR/RTR-Set up routine for HL7 interface ;10/20/96
"RTN","PSOLBL4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**26,70,156,244,233**;DEC 1997;Build 8
"RTN","PSOLBL4",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLBL4",4,0)
 ;
"RTN","PSOLBL4",5,0)
 ;*244 - ignore RX's with a status > 11
"RTN","PSOLBL4",6,0)
 ;
"RTN","PSOLBL4",7,0)
 N DIC,AP,X,Y,DPRT,QPRT
"RTN","PSOLBL4",8,0)
 I $G(ZTIO)]"" D
"RTN","PSOLBL4",9,0)
 .Q:'$O(^PS(59,PSOSITE,"P",0))
"RTN","PSOLBL4",10,0)
 .S DIC=3.5,DIC(0)="",X=ZTIO D ^DIC K DIC,X Q:Y=-1
"RTN","PSOLBL4",11,0)
 .S DPRT=+Y
"RTN","PSOLBL4",12,0)
 .F AP=0:0 S AP=$O(^PS(59,PSOSITE,"P",AP)) Q:'AP  I +$P(^PS(59,PSOSITE,"P",AP,0),"^")=DPRT S QPRT=1
"RTN","PSOLBL4",13,0)
 .I '$G(QPRT) S $P(PSOPAR,"^",30)=0
"RTN","PSOLBL4",14,0)
 Q:'$P($G(PSOPAR),"^",30)
"RTN","PSOLBL4",15,0)
 Q:$G(PSOEXREP)
"RTN","PSOLBL4",16,0)
HL N PSODTM,HHHH,HLCOT,HLFLAG,HLFOUR,HLINGF,HLINRX,HLINRX0,HLLOOP,HLNEXT,HLRR,HLRX,HLRXY,LL,PPLHL,PSHALP,HDFN,HLDFN,HNEWDFN,HLDAI,HLOSITE,HLJUST,HLRXYZ,PSOLLN,PSOLLL,PSFLG,HDFN1
"RTN","PSOLBL4",17,0)
 S HLOSITE=$P($G(PSOPAR),"^",30)
"RTN","PSOLBL4",18,0)
 K ^UTILITY($J,"PSOHL"),^UTILITY($J,"PSOHLL"),HLRXY
"RTN","PSOLBL4",19,0)
 S PPLHL=PPL G:HLOSITE=4 SOMD
"RTN","PSOLBL4",20,0)
 S HLFLAG=0 F HLLOOP=1:1 S HLRX=$P(PPLHL,",",HLLOOP) D  Q:$G(HLFLAG)
"RTN","PSOLBL4",21,0)
 .S HLNEXT=$P(PPLHL,",",(HLLOOP+1)) I HLNEXT=""!(HLNEXT=",") S HLFLAG=1
"RTN","PSOLBL4",22,0)
 .Q:'$G(HLRX)
"RTN","PSOLBL4",23,0)
 .Q:'$D(^PSRX(HLRX,0))
"RTN","PSOLBL4",24,0)
 .Q:$P($G(^PSRX(HLRX,"STA")),"^")=4
"RTN","PSOLBL4",25,0)
 .Q:$G(RXRP(HLRX,"RP"))
"RTN","PSOLBL4",26,0)
 .I $P($G(^PSRX(HLRX,"STA")),"^")>11!('$P(^PSRX(HLRX,0),"^",2)) Q
"RTN","PSOLBL4",27,0)
 .I $G(PSODBQ) S HLRR=$O(^PS(52.5,"B",HLRX,0)) Q:'HLRR  I $G(^PS(52.5,+HLRR,"P"))=1 Q
"RTN","PSOLBL4",28,0)
 .;Here, if Site Parameter is 3, check entry in Drug File for National Id
"RTN","PSOLBL4",29,0)
 .I $G(HLOSITE)=3 S HLJUST=+$P($G(^PSRX(HLRX,0)),"^",6) I '$P($G(^PSDRUG(HLJUST,6)),"^") Q
"RTN","PSOLBL4",30,0)
 .S HLRXY(HLLOOP,HLRX)="" ; VALID RXS
"RTN","PSOLBL4",31,0)
 .S:$G(HLOSITE)=3 HLRXYZ(HLRX)=""
"RTN","PSOLBL4",32,0)
 I $G(HLOSITE)=3,$D(HLRXY) D
"RTN","PSOLBL4",33,0)
 .N HLZFLAG,HLZ,HLZRX,HLZNEXT
"RTN","PSOLBL4",34,0)
 .S HLZFLAG=0 K PPL F HLZ=1:1 S HLZRX=$P(PPLHL,",",HLZ) D  Q:$G(HLZFLAG)
"RTN","PSOLBL4",35,0)
 ..S HLZNEXT=$P(PPLHL,",",(HLZ+1)) I HLZNEXT=""!(HLZNEXT=",") S HLZFLAG=1
"RTN","PSOLBL4",36,0)
 ..Q:'$G(HLZRX)
"RTN","PSOLBL4",37,0)
 ..Q:$D(HLRXYZ(HLZRX))
"RTN","PSOLBL4",38,0)
 ..I $G(RXRP(HLZRX,"RP")) D  Q
"RTN","PSOLBL4",39,0)
 ...I $G(PPL)="" S PPL=HLZRX_"," Q
"RTN","PSOLBL4",40,0)
 ...S PPL=PPL_HLZRX_","
"RTN","PSOLBL4",41,0)
 ..I $G(PPL)="" S PPL=HLZRX_"," Q
"RTN","PSOLBL4",42,0)
 ..S PPL=PPL_HLZRX_","
"RTN","PSOLBL4",43,0)
SOMDQ S HLCOT=1,PSHALP="" F  S PSHALP=$O(HLRXY(PSHALP)) Q:PSHALP=""  S ^UTILITY($J,"PSOHLL",HLCOT)=$O(HLRXY(PSHALP,0)),HLCOT=HLCOT+1
"RTN","PSOLBL4",44,0)
 I HLCOT=1 G ENDHL ; NOTHING SET, BYPASS CALL TO QUEUE
"RTN","PSOLBL4",45,0)
 F HLCOT=0:0 S HLCOT=$O(^UTILITY($J,"PSOHLL",HLCOT)) Q:'HLCOT  S HLINRX=^(HLCOT),HLINRX0=$G(^PSRX(HLINRX,0)) D
"RTN","PSOLBL4",46,0)
 .S ^UTILITY($J,"PSOHLL",HLCOT)=HLINRX_"^"_+$P(HLINRX0,"^",6)_"^"_$S($G(RXPR(HLINRX)):"P",1:"F")
"RTN","PSOLBL4",47,0)
 .I '$G(RXPR(HLINRX)) S HLFOUR=0 F HHHH=0:0 S HHHH=$O(^PSRX(HLINRX,1,HHHH)) Q:'HHHH  I +^(HHHH,0) S HLFOUR=HHHH
"RTN","PSOLBL4",48,0)
 .I '$G(RXPR(HLINRX)),$G(RXFL(HLINRX))'="" S HLFOUR=$S($G(RXFL(HLINRX))=0:0,$D(^PSRX(HLINRX,1,+$G(RXFL(HLINRX)),0)):+$G(RXFL(HLINRX)),1:$G(HLFOUR))
"RTN","PSOLBL4",49,0)
 .S ^UTILITY($J,"PSOHLL",HLCOT)=^UTILITY($J,"PSOHLL",HLCOT)_"^"_$S($G(RXPR(HLINRX)):RXPR(HLINRX),1:HLFOUR)_"^"_$S($P($G(^PSRX(HLINRX,3)),"^",6)&('$G(RXPR(HLINRX)))&('$G(RXFL(HLINRX))):1,1:0) D ACLOG
"RTN","PSOLBL4",50,0)
 .S HLINGF=0 I $P(^UTILITY($J,"PSOHLL",HLCOT),"^",5),$O(^PSRX(HLINRX,"DAI",0)) S HLINGF=1 D
"RTN","PSOLBL4",51,0)
 ..F LL=0:0 S LL=$O(^PSRX(HLINRX,"DAI",LL)) Q:'LL  S ^UTILITY($J,"PSOHLL",HLCOT,HLINGF)=$G(^PSRX(HLINRX,"DAI",LL,0)),HLINGF=HLINGF+1
"RTN","PSOLBL4",52,0)
 .S $P(^UTILITY($J,"PSOHLL",HLCOT),"^",6)=$S($G(HLINGF):1,1:0)
"RTN","PSOLBL4",53,0)
 .I $D(^PSRX(HLINRX,"DRI")),'$G(RXPR(HLINRX)),'$G(RXFL(HLINRX)) S ^UTILITY($J,"PSOHLL",HLCOT,"DRI")=^PSRX(HLINRX,"DRI"),$P(^UTILITY($J,"PSOHLL",HLCOT),"^",7)=1
"RTN","PSOLBL4",54,0)
 .E  S $P(^UTILITY($J,"PSOHLL",HLCOT),"^",7)=0
"RTN","PSOLBL4",55,0)
 .S $P(^UTILITY($J,"PSOHLL",HLCOT),"^",8)=0 D RPT Q:'$G(^PSRX(HLINRX,"IB"))
"RTN","PSOLBL4",56,0)
 .I $P(^PSRX(HLINRX,"STA"),"^")>0,$P(^("STA"),"^")'=2,'$G(PSODBQ) Q
"RTN","PSOLBL4",57,0)
 .S $P(^UTILITY($J,"PSOHLL",HLCOT),"^",8)=1
"RTN","PSOLBL4",58,0)
 ;
"RTN","PSOLBL4",59,0)
AAA D STRT^PSOHLSG5
"RTN","PSOLBL4",60,0)
 S (HDFN,HDFN1)=$O(^UTILITY($J,"PSOHLL",0)),HDFN=$P(^PSRX($P(^(HDFN),"^"),0),"^",2),PSOLLL=$P(^UTILITY($J,"PSOHLL",HDFN1),"^",12)
"RTN","PSOLBL4",61,0)
 F HLDFN=0:0 S HLDFN=$O(^UTILITY($J,"PSOHLL",HLDFN)) Q:'HLDFN  D  S ^UTILITY($J,"PSOHL",HLDFN)=^UTILITY($J,"PSOHLL",HLDFN) D OTHER
"RTN","PSOLBL4",62,0)
 .S PSFLG=0,PSOLLN=$P(^UTILITY($J,"PSOHLL",HLDFN),"^",12),HNEWDFN=$P(^PSRX($P(^UTILITY($J,"PSOHLL",HLDFN),"^"),0),"^",2) D
"RTN","PSOLBL4",63,0)
 ..I HDFN'=HNEWDFN S HDFN=HNEWDFN,PSFLG=1
"RTN","PSOLBL4",64,0)
 ..I PSOLLL'=PSOLLN S PSOLLL=PSOLLN,PSFLG=1
"RTN","PSOLBL4",65,0)
 ..I PSFLG=1 D SETZ
"RTN","PSOLBL4",66,0)
 I '$D(^UTILITY($J,"PSOHL")) G ENDHL
"RTN","PSOLBL4",67,0)
CALL D SETZ
"RTN","PSOLBL4",68,0)
ENDHL K ^UTILITY($J,"PSOHL"),^UTILITY($J,"PSOHLL"),HLRXY
"RTN","PSOLBL4",69,0)
 Q
"RTN","PSOLBL4",70,0)
OTHER I $G(^UTILITY($J,"PSOHLL",HLDFN,"DRI"))'="" S ^UTILITY($J,"PSOHL",HLDFN,"DRI")=^UTILITY($J,"PSOHLL",HLDFN,"DRI")
"RTN","PSOLBL4",71,0)
 F HLDAI=0:0 S HLDAI=$O(^UTILITY($J,"PSOHLL",HLDFN,HLDAI)) Q:'HLDAI  S ^UTILITY($J,"PSOHL",HLDFN,HLDAI)=^UTILITY($J,"PSOHLL",HLDFN,HLDAI)
"RTN","PSOLBL4",72,0)
 Q
"RTN","PSOLBL4",73,0)
ACLOG ;Activity log (sending to Hl7 interface)
"RTN","PSOLBL4",74,0)
 N DTTM,HCOM,HCNT,HJJ
"RTN","PSOLBL4",75,0)
 D NOW^%DTC S DTTM=%,HCOM="Prescription"_$S($G(RXPR(HLINRX)):" (Partial)",1:"")_$S($G(PSOSUREP)!($G(RXRP(HLINRX))):" (Reprint)",1:"")_" sent to external interface."
"RTN","PSOLBL4",76,0)
 S HCNT=0 F HJJ=0:0 S HJJ=$O(^PSRX(HLINRX,"A",HJJ)) Q:'HJJ  S HCNT=HJJ
"RTN","PSOLBL4",77,0)
 S HCNT=HCNT+1,^PSRX(HLINRX,"A",0)="^52.3DA^"_HCNT_"^"_HCNT S ^PSRX(HLINRX,"A",HCNT,0)=DTTM_"^X^"_$G(PDUZ)_"^"_$S($G(RXPR(HLINRX)):6,$G(HLFOUR)<6:$G(HLFOUR),1:(HLFOUR+1))_"^"_HCOM
"RTN","PSOLBL4",78,0)
 Q
"RTN","PSOLBL4",79,0)
SUS(HSREX,HSFL,HSFILL,HSRP) ;
"RTN","PSOLBL4",80,0)
 N DA,DIK,DTTM,HSCOM,HSCNT,HSJJ,HSLDUZ,PSHLCPRS
"RTN","PSOLBL4",81,0)
 I $P($G(^PSRX(HSREX,"STA")),"^")=5 S $P(^PSRX(HSREX,"STA"),"^")=0 S PSHLCPRS="Removed from Suspense, External Interface." D EN^PSOHLSN1(HSREX,"SC","ZU",PSHLCPRS)
"RTN","PSOLBL4",82,0)
 S DA=$O(^PS(52.5,"B",HSREX,0)) I DA K DIK S DIK="^PS(52.5," D ^DIK
"RTN","PSOLBL4",83,0)
 I $G(HSFL)="P" S HSLDUZ=+$P($G(^PSRX(HSREX,"P",HSFILL,0)),"^",7)
"RTN","PSOLBL4",84,0)
 E  S HSLDUZ=$S('HSFILL:+$P($G(^PSRX(HSREX,0)),"^",16),1:+$P($G(^PSRX(HSREX,1,HSFILL,0)),"^",7))
"RTN","PSOLBL4",85,0)
 D NOW^%DTC S DTTM=%,HSCOM="Removed from Suspense"_$S($G(HSFL)="P":" (Partial)",1:"")_$S($G(HSRP):" (Reprint)",1:"")_" (External Interface)"
"RTN","PSOLBL4",86,0)
 S HSCNT=0 F HSJJ=0:0 S HSJJ=$O(^PSRX(HSREX,"A",HSJJ)) Q:'HSJJ  S HSCNT=HSJJ
"RTN","PSOLBL4",87,0)
 S HSCNT=HSCNT+1,^PSRX(HSREX,"A",0)="^52.3DA^"_HSCNT_"^"_HSCNT S ^PSRX(HSREX,"A",HSCNT,0)=DTTM_"^X^"_$G(HSLDUZ)_"^"_$S($G(HSFL)="P":6,$G(HSFILL)<6:$G(HSFILL),1:(HSFILL+1))_"^"_$G(HSCOM)
"RTN","PSOLBL4",88,0)
 Q
"RTN","PSOLBL4",89,0)
LAB(HLREX,HLFL,HLFILL,HLREPT) ;
"RTN","PSOLBL4",90,0)
 N HLDUZ,NOW,DA,HCT,HFF
"RTN","PSOLBL4",91,0)
 D NOW^%DTC S NOW=% S HCT=0 F HFF=0:0 S HFF=$O(^PSRX(HLREX,"L",HFF)) Q:'HFF  S HCT=HFF
"RTN","PSOLBL4",92,0)
 I HLFL="F" S HLDUZ=$S('HLFILL:+$P($G(^PSRX(HLREX,0)),"^",16),1:+$P($G(^PSRX(HLREX,1,HLFILL,0)),"^",7))
"RTN","PSOLBL4",93,0)
 I HLFL="P" S HLDUZ=+$P($G(^PSRX(HLREX,"P",HLFILL,0)),"^",7)
"RTN","PSOLBL4",94,0)
 S HCT=HCT+1,^PSRX(HLREX,"L",0)="^52.032DA^"_HCT_"^"_HCT
"RTN","PSOLBL4",95,0)
 S ^PSRX(HLREX,"L",HCT,0)=NOW_"^"_$S($G(HLFL)="F":HLFILL,1:(99-HLFILL))_"^"_"From Rx number "_$P(^PSRX(HLREX,0),"^")_$S($G(HLFL)="P":" (Partial)",1:"")_$S($G(HLREPT):" (Reprint)",1:"")_" (External Interface)"_"^"_$G(HLDUZ)
"RTN","PSOLBL4",96,0)
 N PSOBADR,PSOTEMP
"RTN","PSOLBL4",97,0)
 S PSOBADR=$$CHKRX^PSOBAI(HLREX)
"RTN","PSOLBL4",98,0)
 I $G(PSOBADR) S PSOTEMP=$P(PSOBADR,"^",2),PSOBADR=$P(PSOBADR,"^")
"RTN","PSOLBL4",99,0)
 I $G(PSOBADR),'$G(PSOTEMP) D
"RTN","PSOLBL4",100,0)
 .S HCT=HCT+1,^PSRX(HLREX,"L",0)="^52.032DA^"_HCT_"^"_HCT
"RTN","PSOLBL4",101,0)
 .S ^PSRX(HLREX,"L",HCT,0)=NOW_"^"_$S($G(HLFL)="F":HLFILL,1:(99-HLFILL))_"^"_"ROUTING="_$G(MW)_" (BAD ADDRESS)"_"^"_$G(HLDUZ)
"RTN","PSOLBL4",102,0)
 Q
"RTN","PSOLBL4",103,0)
RPT ;
"RTN","PSOLBL4",104,0)
 S $P(^UTILITY($J,"PSOHLL",HLCOT),"^",9)=$S($G(PSOSUREP)!($G(RXRP(HLINRX))):1,1:0)
"RTN","PSOLBL4",105,0)
 S $P(^UTILITY($J,"PSOHLL",HLCOT),"^",10)=+$G(PDUZ)
"RTN","PSOLBL4",106,0)
 Q
"RTN","PSOLBL4",107,0)
SETZ ;
"RTN","PSOLBL4",108,0)
 D NOW^%DTC S PSODTM=%
"RTN","PSOLBL4",109,0)
 S ZTRTN=$S($$GET1^DIQ(59,PSOSITE_",",105,"I")=2.4:"INIT^PSOHLDS",1:"INIT^PSOHLSG")
"RTN","PSOLBL4",110,0)
 S ZTIO="",ZTDTH=$H,ZTSAVE("^UTILITY($J,""PSOHL"",")="",ZTSAVE("PSOPAR")="",ZTSAVE("PSOSITE")="",ZTSAVE("PSODTM")="",ZTSAVE("PSOLAP")=""
"RTN","PSOLBL4",111,0)
 S ZTSAVE("RXRP(")="",ZTSAVE("RXPR(")="",ZTSAVE("RXFL(")="",ZTSAVE("RXRS(")=""
"RTN","PSOLBL4",112,0)
 S ZTDESC=$S($$GET1^DIQ(59,PSOSITE_",",105,"I")=2.4:"Outpatient Automation External Interface",1:"GENERIC INTERFACE LABEL INFORMATION")
"RTN","PSOLBL4",113,0)
 D ^%ZTLOAD
"RTN","PSOLBL4",114,0)
 Q
"RTN","PSOLBL4",115,0)
SOMD ;send only mark drugs to external interface and print in vista
"RTN","PSOLBL4",116,0)
 S HLFLG=0 F HLLP=1:1 S HLRX=$P(PPLHL,",",HLLP) D  Q:$G(HLFLG)
"RTN","PSOLBL4",117,0)
 .S HLNEXT=$P(PPLHL,",",(HLLP+1)) I HLNEXT=""!(HLNEXT=",") S HLFLG=1
"RTN","PSOLBL4",118,0)
 .Q:'$G(HLRX)
"RTN","PSOLBL4",119,0)
 .Q:'$D(^PSRX(HLRX,0))
"RTN","PSOLBL4",120,0)
 .Q:$P($G(^PSRX(HLRX,"STA")),"^")=4
"RTN","PSOLBL4",121,0)
 .I $P($G(^PSRX(HLRX,"STA")),"^")>11!('$P(^PSRX(HLRX,0),"^",2)) Q
"RTN","PSOLBL4",122,0)
 .Q:$G(RXRP(HLRX,"RP"))
"RTN","PSOLBL4",123,0)
 .S HLRR=$O(^PS(52.5,"B",HLRX,0)) Q:'HLRR  I $G(^PS(52.5,+HLRR,"P"))=1 K HLRR Q
"RTN","PSOLBL4",124,0)
 .S DRG=+$P($G(^PSRX(HLRX,0)),"^",6) I '$P($G(^PSDRUG(DRG,6)),"^") Q
"RTN","PSOLBL4",125,0)
 .S HLRXY(HLRX)="" ; VALID RXS
"RTN","PSOLBL4",126,0)
 I $D(HLRXY) G SOMDQ
"RTN","PSOLBL4",127,0)
 Q
"RTN","PSOLBLN")
0^9^B33988152^B31960484
"RTN","PSOLBLN",1,0)
PSOLBLN ;BIR/RTR-NEW PRINTS LABEL ;11/18/92
"RTN","PSOLBLN",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**16,36,71,107,110,117,135,233**;DEC 1997;Build 8
"RTN","PSOLBLN",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLBLN",4,0)
 ;External reference to ^VA(200 supported by DBIA 224
"RTN","PSOLBLN",5,0)
 K PSOSTLK,ZTKDRUG I $L($T(PSOSTALK^PSOTALK1)) D PSOSTALK^PSOTALK1 S PSOSTLK=1 ; PRINT SCRIPTALK LABEL IF APPLICABLE
"RTN","PSOLBLN",6,0)
 I $G(IOS),$G(PSOBARS) I $G(PSOBAR0)=""!($G(PSOBAR1)="") S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSOLBLN",7,0)
 I $G(DFN) D ADD^VADPT
"RTN","PSOLBLN",8,0)
 S ADDR(33)=$G(VAPA(4))_", "_$P($G(VAPA(5)),"^",2)_"  "_$S($G(VAPA(11))]"":$P($G(VAPA(11)),"^",2),1:$G(VAPA(6))),ADDR(22)=""
"RTN","PSOLBLN",9,0)
 S:$G(VAPA(2))]"" ADDR(22)=$G(VAPA(2))_" "_$G(VAPA(3)),ADDR(22)=$E(ADDR(22),1,46) S:ADDR(22)="" ADDR(22)=ADDR(33),ADDR(33)=""
"RTN","PSOLBLN",10,0)
 S ADDR(4)=$S(ADDR(33)="":ADDR(22),1:ADDR(33)) I $G(VAPA(2))="",$G(VAPA(3))="" S ADDR(2)=ADDR(4),ADDR(3)="",ADDR(4)="" G ST
"RTN","PSOLBLN",11,0)
 I $G(VAPA(2))'="",$G(VAPA(3))="" S ADDR(2)=VAPA(2),ADDR(3)=ADDR(4),ADDR(4)="" G ST
"RTN","PSOLBLN",12,0)
 I $G(VAPA(2))="",$G(VAPA(3))'="" S ADDR(2)=VAPA(3),ADDR(3)=ADDR(4),ADDR(4)="" G ST
"RTN","PSOLBLN",13,0)
 S ADDR(2)=$G(VAPA(2)),ADDR(3)=$G(VAPA(3))
"RTN","PSOLBLN",14,0)
ST I $P($G(^PSRX(RX,3)),"^",3) S PSOPROV=+$P(^(0),"^",4) S PSOPROV=$S($G(RXP):+$P($G(RXP),"^",17),$G(RXF):+$P($G(^PSRX(RX,1,RXF,0)),"^",17),1:PSOPROV) S:'$G(PSOPROV) PSOPROV=+$P(^PSRX(RX,0),"^",4) D
"RTN","PSOLBLN",15,0)
 .I +$P($G(^VA(200,PSOPROV,"PS")),"^",7) S:'$P($G(PHYS),"/",2) PHYS=$G(PHYS)_"/"_+$P($G(^PSRX(RX,3)),"^",3)
"RTN","PSOLBLN",16,0)
 S COPIES=COPIES-1,$P(ULN,"_",34)="",PSOTRAIL=1 I $G(SIDE) D REP^PSOLBL2 G REP
"RTN","PSOLBLN",17,0)
 S (Y,X1)=EXPDT X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y,X2=DT D ^%DTC S DIFF=X
"RTN","PSOLBLN",18,0)
 S Y=DATE X ^DD("DD") S DATE=Y D NOW^%DTC S Y=% X ^DD("DD") S NOW=Y
"RTN","PSOLBLN",19,0)
 S TECH="("_$S($P($G(^PSRX(+$G(RX),"OR1")),"^",5):$P($G(^PSRX(+$G(RX),"OR1")),"^",5),1:$P(RXY,"^",16))_"/"_$S($G(VRPH)&($P(PSOPAR,"^",32)):VRPH,1:" ")_")"
"RTN","PSOLBLN",20,0)
 S PSZIP=$P(PS,"^",5) S PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLBLN",21,0)
L1 W ?3,"VAMC ",$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP),?54,"VAMC ",$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP),?102 W $S($D(REPRINT)&($G(PSOBLALL)):"(GROUP REPRINT)",$D(REPRINT):"(REPRINT)",1:"") W:$G(RXP) "(PARTIAL)"
"RTN","PSOLBLN",22,0)
 W !?3,$P(PS2,"^",2),"  ",$P(PS,"^",3),"-",$P(PS,"^",4),"   ",TECH,?54,$P(PS2,"^",2),"  ",$P(PS,"^",3),"-",$P(PS,"^",4),"   ",TECH,?102,$P(PS2,"^",2)," ",TECH," ",NOW
"RTN","PSOLBLN",23,0)
 W !,"Rx# ",RXN,"  ",DATE,"  Fill ",RXF+1," of ",1+$P(RXY,"^",9),?54,"Rx# ",RXN,"  ",DATE,"  Fill ",RXF+1," of ",1+$P(RXY,"^",9),?102,"Rx# ",RXN,"  ",DATE,"  Fill ",RXF+1," of ",1+$P(RXY,"^",9)
"RTN","PSOLBLN",24,0)
 W !,PNM,"  ",$G(SSNPN),?54,PNM,"  ",$G(SSNPN),?102,PNM,"  ",$G(SSNPN)
"RTN","PSOLBLN",25,0)
 F DR=1:1 Q:$G(SGY(DR))=""  D:DR=4!(DR=7)!(DR=10)!(DR=13)  W !,$G(SGY(DR)),?54,$G(SGY(DR)),?102,$S($G(OSGY(DR))]"":OSGY(DR),1:$G(SGY(DR)))
"RTN","PSOLBLN",26,0)
 .F GG=1:1:27 W !
"RTN","PSOLBLN",27,0)
 I DR>4 S KK=$S(DR=5!(DR=8)!(DR=11):2,(DR=6)!(DR=9)!(DR=12):1,1:0) I KK F HH=1:1:KK W !
"RTN","PSOLBLN",28,0)
 I DR=2 W !!
"RTN","PSOLBLN",29,0)
 I DR=3 W !
"RTN","PSOLBLN",30,0)
 W !,$G(PHYS),?54,$G(PHYS),?102,$G(PHYS)
"RTN","PSOLBLN",31,0)
 S PSMF=$S($G(NURSE):"Mfg______Exp______",1:""),PSDU=$P($G(^PSDRUG($P($G(^PSRX(RX,0)),"^",6),660)),"^",8),PSDU=$S(PSDU="":"      "_PSMF,1:PSDU_" "_PSMF)
"RTN","PSOLBLN",32,0)
 W !,"Qty: "_$G(QTY),"  ",$G(PSDU),?54,"Qty: "_$G(QTY),"  ",$G(PSDU),?102,"Qty: "_$G(QTY),"  ",$G(PSDU)
"RTN","PSOLBLN",33,0)
 S ZTKDRUG="XXXXXX   SCRIPTALK RX   XXXXXX"
"RTN","PSOLBLN",34,0)
 I '$G(PSOSTLK) K PSDU,PSMF W !,DRUG,?54,DRUG,?102,DRUG
"RTN","PSOLBLN",35,0)
 I $G(PSOSTLK) K PSDU,PSMF W !,$S($G(PSOSTALK):ZTKDRUG,1:DRUG),?54,DRUG,?102,DRUG
"RTN","PSOLBLN",36,0)
 I $P(RXY,"^",9)-RXF'>0 D ^PSOLBLN1 G L13
"RTN","PSOLBLN",37,0)
 G:DIFF<30 L11
"RTN","PSOLBLN",38,0)
 W !?54,$P(RXY,"^",9)-RXF," Refills remain prior to ",EXPDT,?102,"Mfg "_$G(MFG)_" Lot# "_$G(LOT) G L12
"RTN","PSOLBLN",39,0)
L11 W !?54,"Last fill prior to ",$G(EXPDT),?102,"Mfg "_$G(MFG)_" Lot# "_$G(LOT)
"RTN","PSOLBLN",40,0)
L12 W !,$P(PS,"^",2),?54,$S($L($G(COPAYVAR)):$G(COPAYVAR)_"     ",1:""),"Days Supply: ",$G(DAYS),?102,"Tech__________RPh_________",!,$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP)
"RTN","PSOLBLN",41,0)
 ;send a CR for OPTIFIL (P-MT661BC)
"RTN","PSOLBLN",42,0)
 I $G(PSOBARS),$P(PSOPAR,"^",19)'=1 S X="S",X2=PSOINST_"-"_RX S X1=$X W ?54,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0 W:IOST["P-MT661BC" !
"RTN","PSOLBLN",43,0)
 E  W !!!
"RTN","PSOLBLN",44,0)
 W !,"FORWARDING SERVICE REQUESTED" W:"C"[$E(MW) !,?21,"CERTIFIED MAIL" W !?54,$G(VAPA(1))
"RTN","PSOLBLN",45,0)
 W !,$S($G(PS55)=2:"***DO NOT MAIL***",1:"***CRITICAL MEDICAL SHIPMENT***"),?54,$G(ADDR(2)),?102,"Routing: "_$S("W"[$E(MW):MW,1:MW_" MAIL")
"RTN","PSOLBLN",46,0)
 W !?54,$G(ADDR(3)),?102,"Days supply: ",$G(DAYS)," Cap: ",$S(PSCAP:"**NON-SFTY**",1:"SAFETY")
"RTN","PSOLBLN",47,0)
 W !?54,$G(ADDR(4)),?102,"Isd: ",ISD," Exp: ",EXPDT
"RTN","PSOLBLN",48,0)
 W !,PNM,?54,"*Indicate address change on back of this form",?102,"Last Fill: ",$G(PSOLASTF)
"RTN","PSOLBLN",49,0)
 W !,$S($D(PSMP(1)):PSMP(1),1:$G(VAPA(1))),?54,"[ ] Permanent",?102,"Pat. Stat ",PATST," Clinic: ",PSCLN
"RTN","PSOLBLN",50,0)
 W !,$S($D(PSMP(2)):PSMP(2),$D(PSMP(1)):"",1:$G(ADDR(2))),?54,"[ ] Temporary until ",$S($P($G(VAPA(10)),"^",2)]"":$P($G(VAPA(10)),"^",2),1:"__/__/__"),?102,$S($G(WARN)'="":"DRUG WARNING "_$G(WARN),1:"")
"RTN","PSOLBLN",51,0)
 W !,$S($D(PSMP(3)):PSMP(3),$D(PSMP(1)):"",1:$G(ADDR(3))),!,$S($D(PSMP(4)):PSMP(4),$D(PSMP(1)):"",1:$G(ADDR(4))),?54,"Signature",ULN
"RTN","PSOLBLN",52,0)
 I $G(PSOBARS) S X="S",X2=PSOINST_"-"_RX S X1=$X W ?102,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0
"RTN","PSOLBLN",53,0)
L13 I $G(WARN)'="",'$G(PSOBLALL) I '$G(PSDFNFLG),'$G(PSOLAPPL) D WARN^PSOLBL2
"RTN","PSOLBLN",54,0)
 W @IOF
"RTN","PSOLBLN",55,0)
REP I COPIES>0 S SIDE=1 G ST
"RTN","PSOLBLN",56,0)
 D NOW^%DTC S NOW=% K %,%H,%I I $G(RXF)="" S RXF=0 F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=I
"RTN","PSOLBLN",57,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLBLN",58,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLBLN",59,0)
 S ^PSRX(RX,"L",IR,0)=NOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_$S($G(PCOMX)]"":$G(PCOMX),$G(PCOMH(RX))]"":PCOMH(RX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_$S($G(RXP):" (Partial)",1:"")_$S($D(REPRINT):" (Reprint)",1:"")_"^"_PDUZ
"RTN","PSOLBLN",60,0)
 N PSOBADR,PSOTEMP
"RTN","PSOLBLN",61,0)
 S PSOBADR=$$CHKRX^PSOBAI(RX)
"RTN","PSOLBLN",62,0)
 I $G(PSOBADR) S PSOTEMP=$P(PSOBADR,"^",2),PSOBADR=$P(PSOBADR,"^")
"RTN","PSOLBLN",63,0)
 I $G(PSOBADR),'$G(PSOTEMP) D
"RTN","PSOLBLN",64,0)
 .S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLBLN",65,0)
 .S ^PSRX(RX,"L",IR,0)=NOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_"ROUTING="_$G(MW)_" (BAD ADDRESS)"_"^"_PDUZ
"RTN","PSOLBLN",66,0)
 S ^PSRX(RX,"TYPE")=0 K RXF,IR,FDA,NOW,I,PCOMH(RX)
"RTN","PSOLBLN",67,0)
 I $G(WARN)'="" I $G(PSDFNFLG)!($G(PSOLAPPL)) D ALLWARN^PSOLBLN1
"RTN","PSOLBLN",68,0)
 I $G(WARN)="" I $G(PSDFNFLG)!($G(PSOLAPPL)) D ALL^PSOLBLS
"RTN","PSOLBLN",69,0)
 I $G(PSOBLALL) D:$G(WARN)="" ALL^PSOLBLS D:$G(WARN)'="" ALLWARN^PSOLBLN1
"RTN","PSOLBLN",70,0)
 I '$D(PSSPND),$P(PSOPAR,"^",18) I $G(PSDFNFLG)!($G(PSOLAPPL))!($G(PSOBLALL)) D CHCK2^PSOTRLBL
"RTN","PSOLBLN",71,0)
 D:$G(PSOBLALL) TRAIL^PSOLBL2
"RTN","PSOLBLN",72,0)
END ;
"RTN","PSOLBLN",73,0)
 I $D(RXFLX(RX)) S RXFL(RX)=$G(RXFLX(RX)) K RXFLX
"RTN","PSOLBLN",74,0)
 D KILL^PSOLBL2 Q
"RTN","PSOLLL1")
0^10^B68811499^B61663989
"RTN","PSOLLL1",1,0)
PSOLLL1 ;BIR/BHW - LASER LABELS ;10/24/2002
"RTN","PSOLLL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,141,135,162,161,233**;DEC 1997;Build 8
"RTN","PSOLLL1",3,0)
 ;
"RTN","PSOLLL1",4,0)
 ;Reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLLL1",5,0)
 ;Reference ^VA(200,D0,"PS" supported by DBIA 224
"RTN","PSOLLL1",6,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOLLL1",7,0)
 ;
"RTN","PSOLLL1",8,0)
ST I $P($G(^PSRX(RX,3)),"^",3) S PSOPROV=+$P(^(0),"^",4),PSOPROV=$S($G(RXP):+$P($G(RXP),"^",17),$G(RXF):+$P($G(^PSRX(RX,1,RXF,0)),"^",17),1:PSOPROV) S:'$G(PSOPROV) PSOPROV=+$P(^PSRX(RX,0),"^",4) D
"RTN","PSOLLL1",9,0)
 . I +$P($G(^VA(200,PSOPROV,"PS")),"^",7) S:'$P($G(PHYS),"/",2) PHYS=$G(PHYS)_"/"_+$P($G(^PSRX(RX,3)),"^",3)
"RTN","PSOLLL1",10,0)
 S $P(ULN,"_",34)="",PSOTRAIL=1
"RTN","PSOLLL1",11,0)
 S (Y,X1)=EXPDT X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y,X2=DT D ^%DTC S DIFF=X
"RTN","PSOLLL1",12,0)
 S Y=DATE X ^DD("DD") S DATE=Y
"RTN","PSOLLL1",13,0)
 S TECH="("_$S($P($G(^PSRX(+$G(RX),"OR1")),"^",5):$P($G(^PSRX(+$G(RX),"OR1")),"^",5),1:$P(RXY,"^",16))_"/"_$S($G(VRPH)&($P(PSOPAR,"^",32)):VRPH,1:" ")_")"
"RTN","PSOLLL1",14,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",15,0)
L1 I $G(PSOIO("BLH"))]"" X PSOIO("BLH")
"RTN","PSOLLL1",16,0)
 I 'SIGF,'SIGM,'PMIM K PSOSTLK,ZTKDRUG I $L($T(PSOSTALK^PSOTALK1)) D PSOSTALK^PSOTALK1 D  S PSOSTLK=1 ; PRINT ONE SCRIPTALK LABEL IF APPLICABLE
"RTN","PSOLLL1",17,0)
 .D 6^VADPT,PID^VADPT6 S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLLL1",18,0)
 S T="VAMC "_$P(PS,"^",7)_", "_STATE_" "_$G(PSOHZIP) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",19,0)
 S T=$P(PS2,"^",2)_"  "_TECH_"  Ph: "_$P(PS,"^",3)_"-"_$P(PS,"^",4) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",20,0)
 S PSDU=$P($G(^PSDRUG($P($G(^PSRX(RX,0)),"^",6),660)),"^",8)
"RTN","PSOLLL1",21,0)
 I $G(PSOIO("BLB"))]"" X PSOIO("BLB")
"RTN","PSOLLL1",22,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",23,0)
 S T="Rx# "_RXN_"  " S:SIGF!($G(FILLCONT)) T=" " D PRINT(T,1)
"RTN","PSOLLL1",24,0)
 D STRT^PSOLLU1("RX#",T,.L) S PSOY=PSOY-PSOYI,OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX
"RTN","PSOLLL1",25,0)
 S DR=$G(SIGF("DR"))
"RTN","PSOLLL1",26,0)
 S T="  "_DATE_"  "_$S('SIGF:"Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),1:"(label continued)") S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",27,0)
 S PSOX=OPSOX,T=PNM S:SIGF!($G(FILLCONT)) T=" " I T'=" " D PRINT(T,1)
"RTN","PSOLLL1",28,0)
 I DR>1 S PSOX=OPSOX,T="Rx# "_RXN_"  (label continued)" D PRINT(T)
"RTN","PSOLLL1",29,0)
 D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSOLLL1",30,0)
 S OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX,PSOY=PSOY-PSOYI,T="  "_$G(SSNPN) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",31,0)
 S PSOX=OPSOX,LENGTH=0,PTEXT="",SIGF=0,XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",32,0)
 N DP,TEXTP,TEXTL,MORE
"RTN","PSOLLL1",33,0)
 I 'SIGM,'$G(FILLCONT) D COUNTSG^PSOLLLW
"RTN","PSOLLL1",34,0)
 S DR=SIGF("DR")
"RTN","PSOLLL1",35,0)
 I DR>1,'$D(NSGY(DR,4)) D
"RTN","PSOLLL1",36,0)
 .F I=4:-1:1 Q:$D(NSGY(DR,I))  S T=" " D PRINT(T) ; BOTTOM-JUSTIFY CONTINUED BOTTLE SIG JUST ABOVE 'DISCARD' LINE
"RTN","PSOLLL1",37,0)
 F I=1:1 Q:'$D(NSGY(DR,I))  S TEXT=NSGY(DR,I) D PRINT(TEXT)
"RTN","PSOLLL1",38,0)
 I I>4,$D(NSGY(DR,5)) S SIGF=1,SIGF("DR")=DR+1
"RTN","PSOLLL1",39,0)
 I $G(PSOIO("BLF"))]"" X PSOIO("BLF")
"RTN","PSOLLL1",40,0)
 S PSOY=PSODY-PSOYI,PSOFONT=PSODFONT
"RTN","PSOLLL1",41,0)
 I SIGF G WARN:'SIGM&('$G(FILLCONT)),CONT
"RTN","PSOLLL1",42,0)
 I '$D(NSGY) G CONT
"RTN","PSOLLL1",43,0)
 K NSGY,^TMP($J,"PSOSIG",RX)
"RTN","PSOLLL1",44,0)
 D NOW^%DTC S X1=X,X2=365 D C^%DTC S Y=X X ^DD("DD")
"RTN","PSOLLL1",45,0)
 S DEA=$P($G(^PSDRUG($P(RXY,"^",6),0)),"^",3),T=""
"RTN","PSOLLL1",46,0)
 I DEA'["S" S T="Discard after "_$S(DEA[0!(DEA["M"):"_________",1:Y)_"__________   "
"RTN","PSOLLL1",47,0)
 S T=T_"Mfr_________" D PRINT(T)
"RTN","PSOLLL1",48,0)
 S PSOY=PSOY-5
"RTN","PSOLLL1",49,0)
 D  S PSOFONT="F8"  D PRINT(T)
"RTN","PSOLLL1",50,0)
 . S NOR=$P(RXY,"^",9)-RXF
"RTN","PSOLLL1",51,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL" Q
"RTN","PSOLLL1",52,0)
 . I NOR=0 S T="NO REFILLS LEFT" Q
"RTN","PSOLLL1",53,0)
 . S T="May refill "_NOR_"X by "_EXPDT
"RTN","PSOLLL1",54,0)
 S PPHYS=$G(PHYS)
"RTN","PSOLLL1",55,0)
 S XFONT=$E(PSOQFONT,2,99)
"RTN","PSOLLL1",56,0)
 S TEXT="Qty: " D STRT^PSOLLU1("SIG",TEXT,.L) S Q(1)=L(XFONT)
"RTN","PSOLLL1",57,0)
 S TEXT=" "_PSDU D STRT^PSOLLU1("SIG",TEXT,.L) S Q(2)=L(XFONT)
"RTN","PSOLLL1",58,0)
 S TEXT="       "_$G(PHYS) D STRT^PSOLLU1("SIG",TEXT,.L) S Q(3)=L(XFONT)
"RTN","PSOLLL1",59,0)
 S TEXT=$G(QTY) D STRT^PSOLLU1("SIG",TEXT,.L) S LENGTH=Q(1)+Q(2)+Q(3)+L(XFONT+2),Q(4)=L(XFONT+2)
"RTN","PSOLLL1",60,0)
 I LENGTH>3 F I=$L(PHYS)-1:-1:1 S PPHYS=$E(PHYS,1,I),TEXT="       "_PPHYS D STRT^PSOLLU1("SIG",TEXT,.L) I Q(1)+Q(2)+Q(4)+L(XFONT)<3.3 Q 
"RTN","PSOLLL1",61,0)
 S PSOFONT=PSOTFONT,OPSOX=PSOX,PSOX=PSOX+(Q(1)*300),PSOY=PSOQY-PSOYI,T=$G(QTY) D PRINT(T)
"RTN","PSOLLL1",62,0)
 S PSOX=OPSOX,PSOFONT=PSOQFONT,PSOY=PSOY-PSOYI,T="Qty: " D PRINT(T)
"RTN","PSOLLL1",63,0)
 S PSOX=PSOX+(Q(1)+Q(4)*300),PSOY=PSOY-PSOYI,T=" "_$G(PSDU)_"       "_$G(PPHYS) D PRINT(T)
"RTN","PSOLLL1",64,0)
 S PSOFONT=PSOTFONT,PSOX=OPSOX,PSOY=PSOTY-PSOYI,T=DRUG D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSOLLL1",65,0)
 I L($E(PSOFONT,2,99))>3 S PSOFONT=$S(PSOFONT="F12":"F10",PSOFONT="F10":"F9",PSOFONT="F9":F8,PSOFONT="F8":"F6")
"RTN","PSOLLL1",66,0)
 S ZTKDRUG="XXXXXX   SCRIPTALK RX   XXXXXX"
"RTN","PSOLLL1",67,0)
 I $G(PSOSTLK) S T=$S($G(PSOSTALK):ZTKDRUG,1:DRUG)
"RTN","PSOLLL1",68,0)
 D PRINT(T,1)
"RTN","PSOLLL1",69,0)
 I SIGM G CONT
"RTN","PSOLLL1",70,0)
 S ^PSRX(RX,"TYPE")=0
"RTN","PSOLLL1",71,0)
WARN ;PRINT WARNING LABELS
"RTN","PSOLLL1",72,0)
 I $G(PSOIO("WLI"))]"" X PSOIO("WLI")
"RTN","PSOLLL1",73,0)
 ; IF <5 WARNINGS, PRINT LABELS BOTTOM-JUSTIFIED
"RTN","PSOLLL1",74,0)
 S PSOLAN=$P($G(^PS(55,DFN,"LAN")),"^",2)
"RTN","PSOLLL1",75,0)
 S WARN5=WARN F  Q:$L(WARN5,",")>4  S WARN5=" ,"_WARN5
"RTN","PSOLLL1",76,0)
 F WWW=1:1:5 S PSOWARN=$P(WARN5,",",WWW) I PSOWARN'="" D
"RTN","PSOLLL1",77,0)
 . I PSOWARN["N" D NEWWARN^PSOLLLW Q
"RTN","PSOLLL1",78,0)
 . D WARN54^PSOLLLW
"RTN","PSOLLL1",79,0)
 ;RETURN MAIL
"RTN","PSOLLL1",80,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"") I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLL1",81,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",82,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",83,0)
 I $G(PSOIO("RMI"))]"" X PSOIO("RMI")
"RTN","PSOLLL1",84,0)
 S PSOYI=$G(PSOHYI,40),OFONT=PSOFONT,PSOFONT=$G(PSOHFONT)
"RTN","PSOLLL1",85,0)
 S BLNKLIN="",$P(BLNKLIN," ",40)=" "
"RTN","PSOLLL1",86,0)
 S T="Attn: (119)"_BLNKLIN_$$FMTE^XLFDT(DT) D PRINT(T,0)
"RTN","PSOLLL1",87,0)
 S T=$G(VASTREET) D PRINT(T,0)
"RTN","PSOLLL1",88,0)
 S T=$P(PS,"^",7)_", "_$G(STATE)_"  "_$G(PSOHZIP) D PRINT(T,0)
"RTN","PSOLLL1",89,0)
 S PSOY=PSOY+PSOYI,T=$S(PS55=2:"***DO NOT MAIL***",1:"") I T'="" D PRINT(T,0)
"RTN","PSOLLL1",90,0)
 I T'="***DO NOT MAIL***" S T=$S(PS55[0!(PS55[3)!(PS55=""):"REGULAR MAIL",1:"CERTIFIED MAIL") S T=T_"-"_$G(MAILCOM) S:$L(T)>25 PSOFONT="F8" D PRINT(T,0)
"RTN","PSOLLL1",91,0)
 S PSOFONT=OFONT
"RTN","PSOLLL1",92,0)
 D FNAM
"RTN","PSOLLL1",93,0)
 S PSOY=PSOY+PSOYI,PSOYI=PSORYI D PRINT(PTNAME,0)
"RTN","PSOLLL1",94,0)
 I $G(VAPA(1))=""!(PS55=2) G W
"RTN","PSOLLL1",95,0)
 ; ADD CHECK FOR BAD ADDRESS INDICATOR
"RTN","PSOLLL1",96,0)
 N PSOBADR,PSOTEMP
"RTN","PSOLLL1",97,0)
 S PSOBADR=$$BADADR^DGUTL3(DFN)
"RTN","PSOLLL1",98,0)
 I PSOBADR S PSOTEMP=$$CHKTEMP^PSOBAI(DFN)
"RTN","PSOLLL1",99,0)
 F I=1:1:3 I $G(VAPA(I))]"" D
"RTN","PSOLLL1",100,0)
 . S T="" I I=1,PSOBADR,'$G(PSOTEMP) S T="** BAD ADDRESS INDICATED **"
"RTN","PSOLLL1",101,0)
 . I T="" I 'PSOBADR!$G(PSOTEMP) S T=$G(VAPA(I))
"RTN","PSOLLL1",102,0)
 . D STRT^PSOLLU1("ML",T,.L) I L($E(PSOFONT,2,99))<2.37 D PRINT(T,0) Q
"RTN","PSOLLL1",103,0)
 . F F=12,10,9,8,6 I L(F)<2.37 S OFONT=PSOFONT,PSOFONT="F"_F D PRINT(T,0) S PSOFONT=OFONT Q
"RTN","PSOLLL1",104,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",105,0)
 S T="" I 'PSOBADR!$G(PSOTEMP) S T=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6)))
"RTN","PSOLLL1",106,0)
 D PRINT(T,0)
"RTN","PSOLLL1",107,0)
W ;
"RTN","PSOLLL1",108,0)
 S T=$S(MW="WINDOW":"WINDOW -",1:"MAIL -")
"RTN","PSOLLL1",109,0)
 N XFONT
"RTN","PSOLLL1",110,0)
 S OFONT=PSOFONT,PSOYI=$G(PSOTYI,40),PSOFONT=PSOTFONT,XFONT=$E(PSOFONT,2,99),PSOY=PSOTY
"RTN","PSOLLL1",111,0)
 I T["WINDOW" D
"RTN","PSOLLL1",112,0)
 . I $G(^PSRX(RX,"MP"))'="" S PSOY=PSOY-PSOYI ; START 1 LINE HIGHER IF METHOD OF PICK-UP
"RTN","PSOLLL1",113,0)
 . S OPSOX=PSOX D PRINT(T,1) S PSOX=PSOX+200,PSOY=PSOY-PSOYI
"RTN","PSOLLL1",114,0)
 . S T=$G(^PSRX(RX,"MP")) I T="" S PSOFONT=OFONT,PSOX=OPSOX Q
"RTN","PSOLLL1",115,0)
 . N FIRST
"RTN","PSOLLL1",116,0)
 . S FIRST=1
"RTN","PSOLLL1",117,0)
 . D STRT^PSOLLU1("ML",T,.L)
"RTN","PSOLLL1",118,0)
 . I L(XFONT)<1.75 D PRINT(T,0) S PSOFONT=OFONT,PSOX=OPSOX Q
"RTN","PSOLLL1",119,0)
 . F F=10,9,8,6 I L(F)<4.5 Q
"RTN","PSOLLL1",120,0)
 . S XFONT=F,PSOFONT="F"_F,PSOYI=$S(PSOFONT="F12":40,PSOFONT="F10":35,PSOFONT="F9":30,PSOFONT="F8":25,1:20)
"RTN","PSOLLL1",121,0)
 . F J=$L(T," "):-1:1 S PTEXT=$P(T," ",1,J) D STRT^PSOLLU1("ML",PTEXT,.L) D  Q:T=""
"RTN","PSOLLL1",122,0)
 .. I FIRST I L(XFONT)<1.75 D PRINT(PTEXT,0) S T=$P(T," ",J+1,512),J=$L(T," ")+1,PTEXT="",FIRST=0,PSOX=OPSOX,PSOY=PSOY+20 Q
"RTN","PSOLLL1",123,0)
 .. I 'FIRST I L(XFONT)<2.3 D PRINT(PTEXT,0) S T=$P(T," ",J+1,512),J=$L(T," ")+1,PTEXT=""
"RTN","PSOLLL1",124,0)
 . D:PTEXT]"" PRINT(PTEXT,0)
"RTN","PSOLLL1",125,0)
 I T="MAIL -" D PRINT(T,1)
"RTN","PSOLLL1",126,0)
 S PSOFONT=OFONT
"RTN","PSOLLL1",127,0)
CONT I $G(SIDE) G BARC:'L5,CONT2
"RTN","PSOLLL1",128,0)
 I $G(COPIES)>1 G BARC
"RTN","PSOLLL1",129,0)
 I 'L2!PFM D ^PSOLLL2 S L2=1
"RTN","PSOLLL1",130,0)
 I 'L3 D ^PSOLLL3 S L3=1
"RTN","PSOLLL1",131,0)
 I 'L4!PMIM S PIMI=0 D ^PSOLLL4 S L4=1
"RTN","PSOLLL1",132,0)
 I L5 W @IOF G CONT2
"RTN","PSOLLL1",133,0)
BARC I $G(BOTTLBL) G BARCE ; ONLY PRINT BARCODE ON 1ST BOTTLE LABEL
"RTN","PSOLLL1",134,0)
 S BOTTLBL=1
"RTN","PSOLLL1",135,0)
 I $G(PSOIO("BLBC"))]"" X PSOIO("BLBC") I $G(NOBARC) G BARCE
"RTN","PSOLLL1",136,0)
 S X2=PSOINST_"-"_RX W X2
"RTN","PSOLLL1",137,0)
 I $G(PSOIO("EBLBC"))]"" X PSOIO("EBLBC")
"RTN","PSOLLL1",138,0)
BARCE W @IOF
"RTN","PSOLLL1",139,0)
COPY I SIGF S SIGM=1 G L1 ; NEED TO FINISH PRINTING CONTINUED BOTTLE LABEL
"RTN","PSOLLL1",140,0)
 S FILLCONT=0 I PFM!PMIM S FILLCONT=1 G L1
"RTN","PSOLLL1",141,0)
 I $G(COPIES)>1 D  G L1
"RTN","PSOLLL1",142,0)
 . S COPIES=COPIES-1
"RTN","PSOLLL1",143,0)
 . S (SIGM,PFM,PMIM,L2,L3,L4,L5,BOTTLBL)=0
"RTN","PSOLLL1",144,0)
 . K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSOLLL1",145,0)
 . F I="A","B","I" S PMIF(I)=1
"RTN","PSOLLL1",146,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLLL1",147,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLLL1",148,0)
 S ^PSRX(RX,"L",IR,0)=PSOFNOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_$S($G(PCOMX)]"":$G(PCOMX),$G(PCOMH(RX))]"":PCOMH(RX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_$S($G(RXP):" (Partial)",1:"")_$S($D(REPRINT):" (Reprint)",1:"")_"^"_PDUZ
"RTN","PSOLLL1",149,0)
 N PSOBADR,PSOTEMP
"RTN","PSOLLL1",150,0)
 S PSOBADR=$$CHKRX^PSOBAI(RX)
"RTN","PSOLLL1",151,0)
 I $G(PSOBADR) S PSOTEMP=$P(PSOBADR,"^",2),PSOBADR=$P(PSOBADR,"^")
"RTN","PSOLLL1",152,0)
 I $G(PSOBADR),'$G(PSOTEMP) D
"RTN","PSOLLL1",153,0)
 .S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLLL1",154,0)
 .S ^PSRX(RX,"L",IR,0)=PSOFNOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_"ROUTING="_$G(MW)_" (BAD ADDRESS)"_"^"_PDUZ
"RTN","PSOLLL1",155,0)
 S L5=1
"RTN","PSOLLL1",156,0)
CONT2 I SIGF S SIGM=1 G L1 ; MORE BOTTLE LABEL SIG TO PRINT
"RTN","PSOLLL1",157,0)
 I PMIM G CONT ; MORE PMI INFO TO PRINT
"RTN","PSOLLL1",158,0)
 I $G(PSOBLALL)=1,$P(PPL,",",PI+1)="" D TRAIL
"RTN","PSOLLL1",159,0)
 Q
"RTN","PSOLLL1",160,0)
PRINT(T,B) ;
"RTN","PSOLLL1",161,0)
 S BOLD=$G(B)
"RTN","PSOLLL1",162,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",163,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL1",164,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",165,0)
 W T,!
"RTN","PSOLLL1",166,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",167,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL1",168,0)
 Q
"RTN","PSOLLL1",169,0)
TRAIL I $G(SIDE) G END
"RTN","PSOLLL1",170,0)
 D ^PSOLLL5
"RTN","PSOLLL1",171,0)
 D ^PSOLLLH
"RTN","PSOLLL1",172,0)
 D ^PSOLLL6
"RTN","PSOLLL1",173,0)
 I '$P($G(^PS(59,PSOSITE,1)),"^",18) Q
"RTN","PSOLLL1",174,0)
 I '$G(REPRINT) D ^PSOLLL7
"RTN","PSOLLL1",175,0)
END I '$P(PSOPAR,"^",31) Q
"RTN","PSOLLL1",176,0)
 W @IOF
"RTN","PSOLLL1",177,0)
 I $G(PSOIO("PMII"))]"" X PSOIO("PMII")
"RTN","PSOLLL1",178,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",179,0)
 S T="NEXT PATIENT"
"RTN","PSOLLL1",180,0)
 S PSOX=1100-(L($E(PSOFONT,2,99))*300/2)
"RTN","PSOLLL1",181,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",182,0)
 W T,!
"RTN","PSOLLL1",183,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",184,0)
 Q
"RTN","PSOLLL1",185,0)
 ;
"RTN","PSOLLL1",186,0)
FNAM ;
"RTN","PSOLLL1",187,0)
 N NAME
"RTN","PSOLLL1",188,0)
 S NAME=VADM(1)
"RTN","PSOLLL1",189,0)
 D STDNAME^XLFNAME(.NAME,"CP")
"RTN","PSOLLL1",190,0)
 S PTNAME=$$NAMEFMT^XLFNAME(.NAME,"G","S")
"RTN","PSOLLL1",191,0)
 Q
"RTN","PSOLLL1",192,0)
 ;
"RTN","PSOLMPAT")
0^11^B2889666^B3678258
"RTN","PSOLMPAT",1,0)
PSOLMPAT ;BHAM ISC/SAB - update pharmacy patient data using listman ;03/08/93 8:35
"RTN","PSOLMPAT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,117,149,233**;DEC 1997;Build 8
"RTN","PSOLMPAT",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOLMPAT",4,0)
 ;
"RTN","PSOLMPAT",5,0)
EN I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) S VALMSG="Site Parameters must be Defined!" G EX
"RTN","PSOLMPAT",6,0)
 D HLDHDR^PSOLMUTL S DA=DFN,PI=""
"RTN","PSOLMPAT",7,0)
 I '$P($G(PSOPAR),"^",22),'$D(^XUSEC("PSO ADDRESS UPDATE",+$G(DUZ))) G P55
"RTN","PSOLMPAT",8,0)
 L +^PS(55,DA):0 I '$T D MSG G EX
"RTN","PSOLMPAT",9,0)
 S PSODFN=DA D UPDATE^PSOBAI S DA=PSODFN
"RTN","PSOLMPAT",10,0)
 W !
"RTN","PSOLMPAT",11,0)
 L +^DPT(DA):0 I '$T D MSG G EX
"RTN","PSOLMPAT",12,0)
 S DIE="^DPT(",DR="[PSO OUTPT]"
"RTN","PSOLMPAT",13,0)
 D FULL^VALM1,^DIE L -^DPT(DA)
"RTN","PSOLMPAT",14,0)
P55 I '$D(^PS(55,DFN)) K DIC S DIC="^PS(55,",DIC(0)="LZ",(X,DINUM)=DFN K DD,DO D FILE^DICN K DIC
"RTN","PSOLMPAT",15,0)
 I $G(DFN),$P($G(^PS(55,DFN,0)),"^")="" S $P(^PS(55,DFN,0),"^")=DFN K DIK S DA=DFN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK S DA=DFN
"RTN","PSOLMPAT",16,0)
 S DIE="^PS(55,",DR=".02;.03;.05;.04;1;3;40:41.1;106;106.1" W !!?5,">>PHARMACY PATIENT DATA<<",! D ^DIE
"RTN","PSOLMPAT",17,0)
EX L -^PS(55,DA),-^DPT(DA) D ^PSOORUT2 S VALMBCK="R"
"RTN","PSOLMPAT",18,0)
 K DIC,X,Y,DIE,D0,DA,DFN,PI,DR,%,%Y,%X,C,DI,DIPGM,DQ,PSOFROM
"RTN","PSOLMPAT",19,0)
 Q
"RTN","PSOLMPAT",20,0)
MSG S VALMSG="Patient Data is Being Edited by Another User!" Q
"RTN","PSOORUT1")
0^13^B66632962^B65051729
"RTN","PSOORUT1",1,0)
PSOORUT1 ;BIR/SAB - Utility routine for oerr interface ;02/22/95
"RTN","PSOORUT1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,14,30,46,132,148,233**;DEC 1997;Build 8
"RTN","PSOORUT1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORUT1",4,0)
 ;External reference to ^PSXOPUTL supported by DBIA 2203
"RTN","PSOORUT1",5,0)
 ;called from HD^PSOORUTL
"RTN","PSOORUT1",6,0)
REL ;removed order from hold
"RTN","PSOORUT1",7,0)
 S ACT=1,ORS=0
"RTN","PSOORUT1",8,0)
 I POERR("PSOFILNM")["S" S DA=+POERR("PSOFILNM") D  G EXIT^PSOORUTL
"RTN","PSOORUT1",9,0)
 .Q:'$D(^PS(52.41,DA,0))  Q:$P(^PS(52.41,DA,0),"^",3)="RF"
"RTN","PSOORUT1",10,0)
 .S $P(^PS(52.41,DA,0),"^",3)="NW",POERR("STAT")="OR",POERR("FILLER")=DA_"^P"
"RTN","PSOORUT1",11,0)
 .S:$G(POERR("COMM"))']"" POERR("COMM")="Order RELEASED from HOLD by OE/RR before finished." S $P(^PS(52.41,DA,4),"^")=POERR("COMM"),ORS=1
"RTN","PSOORUT1",12,0)
 S DA=POERR("PSOFILNM") I $D(^PSRX(DA,0)) S ORS=1,PSDA=DA D  G EXIT^PSOORUTL
"RTN","PSOORUT1",13,0)
 .S POERR("FILLER")=DA_"^R",POERR("STAT")="OR"
"RTN","PSOORUT1",14,0)
 .S:'$D(POERR("COMM")) POERR("COMM")="Prescription Released from HOLD by OE/RR"
"RTN","PSOORUT1",15,0)
 .I DT>$P(^PSRX(DA,2),"^",6) D
"RTN","PSOORUT1",16,0)
 ..S EXP=$P(^PSRX(DA,2),"^",6) S:$P(^PSRX(DA,"STA"),"^")<12 $P(^PSRX(DA,"STA"),"^")=11,PSOEXFLG=1 S POERR("STAT")="UR",POERR("COMM")="Medication Expired on "_$E(EXP,4,5)_"/"_$E(EXP,6,7)_"/"_$E(EXP,2,3)_".",POERR("PHARMST")="" D ECAN^PSOUTL(DA) Q
"RTN","PSOORUT1",17,0)
 .I $P(^PSRX(DA,"STA"),"^")'=16 S POERR("STAT")="UR",POERR("COMM")="Unable to Release from Hold" Q
"RTN","PSOORUT1",18,0)
 .S RXFL(DA)=0,FDT=$P(^PSRX(DA,2),"^",2)
"RTN","PSOORUT1",19,0)
 .I $O(^PSRX(DA,1,0)) F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S FDT=$P(^PSRX(DA,1,I,0),"^"),RXFL(DA)=I
"RTN","PSOORUT1",20,0)
 .I FDT>DT N PSOSITEZ,ZPSOPAR6 S PSOSITEZ=$S($P($G(^PSRX(DA,2)),"^",9):$P(^(2),"^",9),1:$O(^PS(59,0))),ZPSOPAR6=$P($G(^PS(59,PSOSITEZ,1)),"^",6) I ZPSOPAR6 D  Q
"RTN","PSOORUT1",21,0)
 ..S RXXDA=DA,DA=$O(^PS(52.5,"B",RXXDA,0)) I DA S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOORUT1",22,0)
 ..S DA=RXXDA
"RTN","PSOORUT1",23,0)
 ..S DIC="^PS(52.5,",DIC(0)="L",DLAYGO=52.5,X=RXXDA,DIC("DR")=".02///"_FDT_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04///M;.05///0;.06////"_PSOSITEZ_";2///0;9///"_RXFL(DA) K DD,DO D FILE^DICN K RXFL,DD,DO
"RTN","PSOORUT1",24,0)
 ..S DA=RXXDA K RXXDA S $P(^PSRX(DA,"STA"),"^")=5,LFD=$E(FDT,4,5)_"-"_$E(FDT,6,7)_"-"_$E(FDT,2,3) D ACT1
"RTN","PSOORUT1",25,0)
 ..S PSOSUSZ=1
"RTN","PSOORUT1",26,0)
 .E  S $P(^PSRX(DA,"STA"),"^")=0
"RTN","PSOORUT1",27,0)
 .S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",28,0)
 .D ACT^PSOORUTL
"RTN","PSOORUT1",29,0)
 .I $$SUBMIT^PSOBPSUT(DA) D ECMESND^PSOBPSU1(DA,,$$RXFLDT^PSOBPSUT(DA),$S('$O(^PSRX(DA,1,0)):"OF",1:"RF"))
"RTN","PSOORUT1",30,0)
 G EXIT^PSOORUTL
"RTN","PSOORUT1",31,0)
ACT1 I '$D(RXF) S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",32,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOORUT1",33,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOORUT1",34,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^S^"_POERR("USER")_"^"_RXF_"^"_"RX Placed on Suspense until "_LFD
"RTN","PSOORUT1",35,0)
 Q
"RTN","PSOORUT1",36,0)
SUS ;
"RTN","PSOORUT1",37,0)
 I $P($G(^PSRX(+$G(FILLER),"STA")),"^")=5 N PSOMSORR,PLACERXX D EN^PSOHLSN1(+$G(FILLER),"SC","ZS","")
"RTN","PSOORUT1",38,0)
 Q
"RTN","PSOORUT1",39,0)
BLD ;builds med profile for Listman
"RTN","PSOORUT1",40,0)
 K ^TMP("PSOPF",$J),PSOLST S:$G(PSOOPT)'=3 PSOOPT=0 I '$G(PSOSD) S ^TMP("PSOPF",$J,1,0)="This patient has no prescriptions" S PSOCNT=0,PSOPF=1 Q
"RTN","PSOORUT1",41,0)
 D EOJ,SHOW
"RTN","PSOORUT1",42,0)
EOJ ;
"RTN","PSOORUT1",43,0)
 K PSOQFLG,PSODRG,PSODATA,PSOLF
"RTN","PSOORUT1",44,0)
 Q
"RTN","PSOORUT1",45,0)
 ;-----------------------------------------------------------------
"RTN","PSOORUT1",46,0)
SHOW ;
"RTN","PSOORUT1",47,0)
 ; - ePharmacy modification to create a section for Rx with REJECTs
"RTN","PSOORUT1",48,0)
 N PSOTMP,PSOSTS,PSODRNM,I,PSORX
"RTN","PSOORUT1",49,0)
 S (PSOSTS,PSODRNM)=""
"RTN","PSOORUT1",50,0)
 F  S PSOSTS=$O(PSOSD(PSOSTS)) Q:PSOSTS=""  D
"RTN","PSOORUT1",51,0)
 . F  S PSODRNM=$O(PSOSD(PSOSTS,PSODRNM)) Q:PSODRNM=""  D
"RTN","PSOORUT1",52,0)
 . . S PSORX=+$G(PSOSD(PSOSTS,PSODRNM))
"RTN","PSOORUT1",53,0)
 . . I PSOSTS="ACTIVE",$$FIND^PSOREJUT(PSORX) D  Q
"RTN","PSOORUT1",54,0)
 . . . S PSOTMP(" REJECT",PSODRNM)=PSOSTS
"RTN","PSOORUT1",55,0)
 . . S PSOTMP(PSOSTS,PSODRNM)=PSOSTS
"RTN","PSOORUT1",56,0)
 ;
"RTN","PSOORUT1",57,0)
 S (PSOSTS,PSODRG)="",(PSOCNT,PSOQFLG,IEN)=0
"RTN","PSOORUT1",58,0)
 K RN,DL S $P(RN," ",12)=" ",$P(DL," ",40)=" "
"RTN","PSOORUT1",59,0)
 F PSCNT=0:0 S PSOSTS=$O(PSOTMP(PSOSTS)) Q:PSOSTS=""  D
"RTN","PSOORUT1",60,0)
 . D STA
"RTN","PSOORUT1",61,0)
 . F PSOCT=0:0 S PSODRG=$O(PSOTMP(PSOSTS,PSODRG)) Q:PSODRG=""  Q:PSOCNT>1000!PSOQFLG  D
"RTN","PSOORUT1",62,0)
 . . S PSOSTA=PSOTMP(PSOSTS,PSODRG)
"RTN","PSOORUT1",63,0)
 . . S PSODATA=PSOSD(PSOSTA,PSODRG) I PSOSTA="ZNONVA" D NVA Q
"RTN","PSOORUT1",64,0)
 . . S PSOCNT=PSOCNT+1 I PSOSTA="PENDING" D PEN Q
"RTN","PSOORUT1",65,0)
 . . S:'$D(^PSRX(+PSODATA,0)) PSOCNT=PSOCNT-1 D:$D(^(0)) DISPL
"RTN","PSOORUT1",66,0)
 S (VALMCNT,PSOPF)=IEN
"RTN","PSOORUT1",67,0)
SHOWX K DIRUT,DTOUT,DUOUT,DIROUT,PSODRG
"RTN","PSOORUT1",68,0)
 Q
"RTN","PSOORUT1",69,0)
 ;
"RTN","PSOORUT1",70,0)
DISPL S IEN=IEN+1 N PSOID,PSOCMOP,STATLTH,ECME
"RTN","PSOORUT1",71,0)
 K PSOLNT,PSOQTL,PSOLSP S PSOLRX=$S($G(^PSRX(+PSODATA,"IB")):13,1:14)-$L($P(^PSRX(+PSODATA,0),"^")),$P(PSOLNT," ",PSOLRX)=" ",PSODQL=$L($P(PSODRG,"^"))+$L($P(^PSRX(+PSODATA,0),"^",7))
"RTN","PSOORUT1",72,0)
 I PSODQL<39 S $P(PSOQTL," ",(40-PSODQL))=" "
"RTN","PSOORUT1",73,0)
 E  S $P(PSOQTL," ",(52-$L($P(^PSRX(+PSODATA,0),"^",7))))=" ",$P(PSOLSP," ",(41-$L($P(PSODRG,"^"))))=" "
"RTN","PSOORUT1",74,0)
 S ECME=$$ECME^PSOBPSUT(+PSODATA) I ECME'="" S PSOLNT=$E(PSOLNT,1,$L(PSOLNT)-1)
"RTN","PSOORUT1",75,0)
 S ^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(^PSRX(+PSODATA,0),"^")_$S($G(^PSRX(+PSODATA,"IB")):"$",1:"")_ECME_PSOLNT_$P(PSODRG,"^")_$S(PSODQL<39:PSOQTL_$P(^PSRX(+PSODATA,0),"^",7)_" ",1:$G(PSOLSP))
"RTN","PSOORUT1",76,0)
 S STA="A^N^R^H^N^S^^^^^^E^DC^^DC^DE^H^P^"
"RTN","PSOORUT1",77,0)
 S PSOCMOP=""
"RTN","PSOORUT1",78,0)
 I $D(^PSDRUG("AQ",$P(^PSRX(+PSODATA,0),"^",6))) S PSOCMOP=">"
"RTN","PSOORUT1",79,0)
 N X S X="PSXOPUTL" X ^%ZOSF("TEST") K X I $T D
"RTN","PSOORUT1",80,0)
 .N DA S DA=+PSODATA D ^PSXOPUTL K DA
"RTN","PSOORUT1",81,0)
 .I $G(PSXZ(PSXZ("L")))=0!($G(PSXZ(PSXZ("L")))=2) S PSOCMOP="T"
"RTN","PSOORUT1",82,0)
 .K PSXZ
"RTN","PSOORUT1",83,0)
 N PSOBADR
"RTN","PSOORUT1",84,0)
 S PSOBADR=$O(^PSRX(+PSODATA,"L",9999),-1)
"RTN","PSOORUT1",85,0)
 I PSOBADR'="" S PSOBADR=$G(^PSRX(+PSODATA,"L",PSOBADR,0)) I PSOBADR["(BAD ADDRESS)" S PSOBADR="B"
"RTN","PSOORUT1",86,0)
 I PSOBADR'="B" S PSOBADR=""
"RTN","PSOORUT1",87,0)
 S STAPRT=$P(STA,"^",$P(PSODATA,"^",2)+1)_PSOCMOP_PSOBADR
"RTN","PSOORUT1",88,0)
 S STATLTH=$L(STAPRT)
"RTN","PSOORUT1",89,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_STAPRT_$S(STATLTH=0:"   ",STATLTH=1:"  ",STATLTH=2:" ",1:"")
"RTN","PSOORUT1",90,0)
 S PSOID=$P(^PSRX(+PSODATA,0),"^",13),PSOLF=+$G(^(3)),^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$E(PSOID,4,5)_"-"_$E(PSOID,6,7)_" "
"RTN","PSOORUT1",91,0)
 F PSOX=0:0 S PSOX=$O(^PSRX(+PSODATA,1,PSOX)) Q:'PSOX  D
"RTN","PSOORUT1",92,0)
 . I +$G(^PSRX(+PSODATA,1,PSOX,0))=PSOLF,$P($G(^PSRX(+PSODATA,1,PSOX,0)),"^",16) S PSOLF=PSOLF_"^R"
"RTN","PSOORUT1",93,0)
 K PSOX
"RTN","PSOORUT1",94,0)
 I '$O(^PSRX(+PSODATA,1,0)),$P(^PSRX(+PSODATA,2),"^",15) S PSOLF=PSOLF_"^R"
"RTN","PSOORUT1",95,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$S($G(PSOLF):$E(PSOLF,4,5),1:"  ")_"-"_$S($G(PSOLF):$E(PSOLF,6,7),1:"  ")_$S($P(PSOLF,"^",2)="R":"R ",1:"  ")
"RTN","PSOORUT1",96,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$J($P(PSODATA,"^",6),2)_" "_$J($P(PSODATA,"^",8),3)
"RTN","PSOORUT1",97,0)
 I PSODQL>38 S IEN=IEN+1 S ^TMP("PSOPF",$J,IEN,0)=PSOQTL_"Qty: "_$P(^PSRX(+PSODATA,0),"^",7)
"RTN","PSOORUT1",98,0)
 K PSOLNT,PSOQTL,PSOLSP,PSOLRX,PSODQL
"RTN","PSOORUT1",99,0)
 S PSOLST(PSOCNT)="52^"_+PSODATA_"^"_PSOSTA
"RTN","PSOORUT1",100,0)
 K PSODATA,PSOLF S PSOPF=IEN
"RTN","PSOORUT1",101,0)
 Q
"RTN","PSOORUT1",102,0)
 ;
"RTN","PSOORUT1",103,0)
STA N LABEL,LINE,POS
"RTN","PSOORUT1",104,0)
 S LABEL=PSOSTS,IEN=IEN+1
"RTN","PSOORUT1",105,0)
 I PSOSTS="ZNONVA" S LABEL="Non-VA MEDS (Not dispensed by VA)"
"RTN","PSOORUT1",106,0)
 I PSOSTS=" REJECT" S LABEL="REFILL TOO SOON/DUR REJECTS (Third Party)"
"RTN","PSOORUT1",107,0)
 S POS=80-$L(LABEL)/2,$P(LINE,"-",81)="",$E(LINE,POS+1,POS+$L(LABEL))=LABEL
"RTN","PSOORUT1",108,0)
 S ^TMP("PSOPF",$J,IEN,0)=LINE
"RTN","PSOORUT1",109,0)
 Q
"RTN","PSOORUT1",110,0)
PENX S PSOLST(PSOCNT)="52.41^"_$P(PSODATA,"^",10)_"^"_PSOSTA
"RTN","PSOORUT1",111,0)
 K PSODATA,PSOLF,RN,PSOLSP,PSOQTL,PSOLNT
"RTN","PSOORUT1",112,0)
 Q
"RTN","PSOORUT1",113,0)
PEN ;
"RTN","PSOORUT1",114,0)
 N PSOQTL,PSOLNT,PSOLNTZ,PSOQTLX,PSCMOPF,SPACEZ
"RTN","PSOORUT1",115,0)
 Q:'$D(^PS(52.41,$P(PSODATA,"^",10),0))
"RTN","PSOORUT1",116,0)
 S PSCMOPF=0 I $P($G(PSODATA),"^",11),$D(^PSDRUG("AQ",$P(PSODATA,"^",11))) S PSCMOPF=1
"RTN","PSOORUT1",117,0)
 S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(PSODRG,"^")
"RTN","PSOORUT1",118,0)
 S PSOLNT=$L($P(PSODRG,"^")),PSOLNTZ=$L($P(PSODATA,"^",8))
"RTN","PSOORUT1",119,0)
 S $P(PSOQTLX," ",(11-PSOLNTZ))=" "
"RTN","PSOORUT1",120,0)
 S:PSOLNT<37 $P(PSOQTL," ",(37-PSOLNT))=" "
"RTN","PSOORUT1",121,0)
 I PSOLNT<38 D  G PENX
"RTN","PSOORUT1",122,0)
 .I PSOLNT=37 S PSOQTL=""
"RTN","PSOORUT1",123,0)
 .I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") Q
"RTN","PSOORUT1",124,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  "_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")
"RTN","PSOORUT1",125,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")_$P(PSODATA,"^",6)
"RTN","PSOORUT1",126,0)
 S IEN=IEN+1,$P(SPACEZ," ",42)=" "
"RTN","PSOORUT1",127,0)
 I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") G PENX
"RTN","PSOORUT1",128,0)
 S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")
"RTN","PSOORUT1",129,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)
"RTN","PSOORUT1",130,0)
 G PENX
"RTN","PSOORUT1",131,0)
 ;
"RTN","PSOORUT1",132,0)
NVA ; Setting the Non-VA Meds on the Medication Profile Screen (ListMan)
"RTN","PSOORUT1",133,0)
 S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="  "_$P(PSODRG,"^")_" "
"RTN","PSOORUT1",134,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",6))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",135,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)_" "
"RTN","PSOORUT1",136,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",8))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",137,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",8)
"RTN","PSOORUT1",138,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+20)>70 D  Q
"RTN","PSOORUT1",139,0)
 . S IEN=IEN+1,$P(^TMP("PSOPF",$J,IEN,0)," ",51)="Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSOORUT1",140,0)
 F I=0:0 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_" " Q:$L(^TMP("PSOPF",$J,IEN,0))>49
"RTN","PSOORUT1",141,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSOORUT1",142,0)
 Q
"RTN","PSOORUT2")
0^24^B24070552^B23696740
"RTN","PSOORUT2",1,0)
PSOORUT2 ;ISC BHAM/SAB - build listman screen ;02/22/95
"RTN","PSOORUT2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,146,132,182,233**;DEC 1997;Build 8
"RTN","PSOORUT2",3,0)
 ;External reference to SDPHARM1 supported by DBIA 4196
"RTN","PSOORUT2",4,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOORUT2",5,0)
 ;External reference ^DIC(31 supported by DBIA 658
"RTN","PSOORUT2",6,0)
 ;External reference ^DPT(D0,.372 supported by DBIA 1476
"RTN","PSOORUT2",7,0)
 ;
"RTN","PSOORUT2",8,0)
 K ^TMP("PSOHDR",$J),^TMP("PSOPI",$J) S DFN=PSODFN D ^VADPT,ADD^VADPT
"RTN","PSOORUT2",9,0)
 S ^TMP("PSOHDR",$J,1,0)=VADM(1),^TMP("PSOHDR",$J,2,0)=$P(VADM(2),"^",2)
"RTN","PSOORUT2",10,0)
 S ^TMP("PSOHDR",$J,3,0)=$P(VADM(3),"^",2),^TMP("PSOHDR",$J,4,0)=VADM(4),^TMP("PSOHDR",$J,5,0)=$P(VADM(5),"^",2)
"RTN","PSOORUT2",11,0)
 D NVA
"RTN","PSOORUT2",12,0)
 S POERR=1 D RE^PSODEM K POERR
"RTN","PSOORUT2",13,0)
 S ^TMP("PSOHDR",$J,6,0)=$S($P(WT,"^",8):$P(WT,"^",9)_" ("_$P(WT,"^")_")",1:"_______ (______)")
"RTN","PSOORUT2",14,0)
 S ^TMP("PSOHDR",$J,7,0)=$S($P(HT,"^",8):$P(HT,"^",9)_" ("_$P(HT,"^")_")",1:"_______ (______)") K VM,WT,HT S PSOHD=7
"RTN","PSOORUT2",15,0)
 S GMRA="0^0^111" D ^GMRADPT S ^TMP("PSOHDR",$J,8,0)=+$G(GMRAL)
"RTN","PSOORUT2",16,0)
 S $P(^TMP("PSOHDR",$J,9,0)," ",62)="ISSUE  LAST REF DAY"
"RTN","PSOORUT2",17,0)
 S ^TMP("PSOHDR",$J,10,0)=" #  RX #         DRUG                                 QTY ST  DATE  FILL REM SUP"
"RTN","PSOORUT2",18,0)
 D ELIG^VADPT S IEN=1,^TMP("PSOPI",$J,IEN,0)="Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:""),IEN=IEN+1
"RTN","PSOORUT2",19,0)
 S N=0 F  S N=$O(VAEL(1,N)) Q:'N  S $P(^TMP("PSOPI",$J,IEN,0)," ",14)=$P(VAEL(1,N),"^",2),IEN=IEN+1
"RTN","PSOORUT2",20,0)
 S ^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Disabilities: "
"RTN","PSOORUT2",21,0)
 F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSOORUT2",22,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSOORUT2",23,0)
 .S:$L(^TMP("PSOPI",$J,IEN,0)_PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 IEN=IEN+1,$P(^TMP("PSOPI",$J,IEN,0)," ",14)=" "
"RTN","PSOORUT2",24,0)
 .S ^TMP("PSOPI",$J,IEN,0)=$G(^TMP("PSOPI",$J,IEN,0))_PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSOORUT2",25,0)
 S IEN=IEN+1 S ^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1
"RTN","PSOORUT2",26,0)
 I +VAPA(9) S ^TMP("PSOPI",$J,IEN,0)="      (Temp Address from "_$P(VAPA(9),"^",2)_" till "_$S($P(VAPA(10),"^",2)]"":$P(VAPA(10),"^",2),1:"(no end date)")_")",IEN=IEN+1
"RTN","PSOORUT2",27,0)
 S ^TMP("PSOPI",$J,IEN,0)=VAPA(1) S:VAPA(2)]"" IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=VAPA(2) S:VAPA(3)]"" IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=VAPA(3)
"RTN","PSOORUT2",28,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=VAPA(4),$P(^TMP("PSOPI",$J,IEN,0)," ",40)="PHONE: "_VAPA(8)
"RTN","PSOORUT2",29,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6))
"RTN","PSOORUT2",30,0)
 S MAILD=+$P($G(^PS(55,DFN,0)),"^",3) D  K MAILD
"RTN","PSOORUT2",31,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Prescription Mail Delivery: "_$S(MAILD=1:"Certified Mail",MAILD=2:"DO NOT MAIL",MAILD=3:"Local - Regular Mail",MAILD=4:"Local - Certified Mail",1:"Regular Mail")
"RTN","PSOORUT2",32,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=$S($P($G(^PS(55,DFN,0)),"^",2):"Cannot use safety caps.",1:"") S $P(^TMP("PSOPI",$J,IEN,0)," ",40)=$S($P($G(^PS(55,DFN,0)),"^",4):"Dialysis Patient.",1:"")
"RTN","PSOORUT2",33,0)
 I $G(^PS(55,DFN,1))]"" S PSON=^(1),IEN=IEN+1 D
"RTN","PSOORUT2",34,0)
 .S ^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="     Outpatient Narrative: "
"RTN","PSOORUT2",35,0)
 .F I=1:1 Q:$P(PSON," ",I,99)=""  S:$L(^TMP("PSOPI",$J,IEN,0)_$P(PSON," ",I)_" ")>80 IEN=IEN+1 S ^TMP("PSOPI",$J,IEN,0)=$G(^TMP("PSOPI",$J,IEN,0))_$P(PSON," ",I)_" "
"RTN","PSOORUT2",36,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" "
"RTN","PSOORUT2",37,0)
 I $D(^PS(52.91,DFN,0)) I '$P(^(0),"^",3)!($P(^(0),"^",3)>DT) D
"RTN","PSOORUT2",38,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Primary Care Appointment: "_$$PRIAPT^SDPHARM1(DFN)
"RTN","PSOORUT2",39,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" "
"RTN","PSOORUT2",40,0)
 I 'GMRAL D
"RTN","PSOORUT2",41,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Allergies: "_$S(GMRAL=0:"NKA",1:""),IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" "
"RTN","PSOORUT2",42,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Adverse Reactions:"
"RTN","PSOORUT2",43,0)
 D:$G(GMRAL) ^PSOORUT3
"RTN","PSOORUT2",44,0)
 K ^UTILITY("VASD",$J),VASD S DFN=PSODFN,VASD("F")=DT,VASD("T")=9999999,VASD("W")="123456789" D SDA^VADPT K VASD I $D(^UTILITY("VASD",$J)) D
"RTN","PSOORUT2",45,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Pending Clinic Appointments:"
"RTN","PSOORUT2",46,0)
 .F PSOAPP=0:0 S PSOAPP=$O(^UTILITY("VASD",$J,PSOAPP)) Q:'PSOAPP  S PSOAPPE=$G(^UTILITY("VASD",$J,PSOAPP,"E")),PSOAPPI=$G(^("I")) D
"RTN","PSOORUT2",47,0)
 ..K X S X2=DT,X1=$P($P($G(PSOAPPI),"^"),".") I $G(X1) D ^%DTC
"RTN","PSOORUT2",48,0)
 ..S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="    "_$P(PSOAPPE,"^")_"  "_$P(PSOAPPE,"^",2)_$S($P(PSOAPPI,"^",3)["C":"   *** Canceled ***",1:" ("_$G(X)_" days)")
"RTN","PSOORUT2",49,0)
 K ^UTILITY("VASD",$J),X,PSOAPPI,PSOAPPE,PSOAPP,N
"RTN","PSOORUT2",50,0)
 S PSOPI=IEN K IEN
"RTN","PSOORUT2",51,0)
 Q
"RTN","PSOORUT2",52,0)
NVA ;
"RTN","PSOORUT2",53,0)
 Q:'$O(^PS(55,PSODFN,"NVA",0))
"RTN","PSOORUT2",54,0)
 K LSTDT F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",I)) Q:'I  D
"RTN","PSOORUT2",55,0)
 .Q:$P(^PS(55,PSODFN,"NVA",I,0),"^",7)  Q:'$P(^PS(55,PSODFN,"NVA",I,0),"^")
"RTN","PSOORUT2",56,0)
 .I $P(^PS(55,PSODFN,"NVA",I,0),"^",10)>+$G(LSTDT) S LSTDT=$P(^(0),"^",10)
"RTN","PSOORUT2",57,0)
 I $G(LSTDT)]"" D
"RTN","PSOORUT2",58,0)
 .S LSTDT="Non-VA Meds on File - Last entry on "_$E(LSTDT,4,5)_"/"_$E(LSTDT,6,7)_"/"_$E(LSTDT,2,3)
"RTN","PSOORUT2",59,0)
 .I $G(^TMP("PSOHDR",$J,5,0))="MALE" S $P(^TMP("PSOHDR",$J,5,0)," ",22)=LSTDT K LSTDT Q
"RTN","PSOORUT2",60,0)
 .S $P(^TMP("PSOHDR",$J,5,0)," ",20)=LSTDT K LSTDT
"RTN","PSOORUT2",61,0)
 K I
"RTN","PSOORUT2",62,0)
 Q
"RTN","PSOP1")
0^14^B26993923^B25363822
"RTN","PSOP1",1,0)
PSOP1 ;BHAM ISC/SAB - prints short medication profile ;02/25/94
"RTN","PSOP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,46,103,132,148,233**;DEC 1997;Build 8
"RTN","PSOP1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOP1",4,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSOP1",5,0)
 K RX,DTOUT,DIRUT,DIROUT,DUOUT
"RTN","PSOP1",6,0)
 D HD S DRUG="" F I=0:0 S DRUG=$O(^TMP($J,DRUG)) Q:DRUG=""!($G(PQT))  D  G:$D(DTOUT)!($D(DUOUT))!($D(DIROUT)) Q
"RTN","PSOP1",7,0)
 .F J=0:0 S J=$O(^TMP($J,DRUG,J)) Q:'J!($G(PQT))  S RX0=^(J),RX2=$G(^PSRX(J,2)),$P(RX0,"^",15)=$G(^("STA")),CP=$S(+$G(^PSRX(J,"IB")):"$",1:" ") S:$P(RX2,"^",15)&($P(RX2,"^",2)) RST($P(RX2,"^",2))=1 S:$P(RX0,"^",15)="" $P(RX0,"^",15)=-1 D W
"RTN","PSOP1",8,0)
 D:'$G(PQT) PEND^PSOP2,NVA^PSOP2
"RTN","PSOP1",9,0)
Q D ^%ZISC K ^TMP($J),PQT,PSODTCT,ST,D0,DIC,DIR,DIRUT,DUOUT,G,II,K,RXD,RXF,ZX,DRUG,X,DFN,PHYS,PSRT,CT,AL,I1,PLS,REF,LMI,PI,FN,Y,I,J,RX,DRX,ST,RX0,RX2,DA,PPPSTAT,PPP,EEEE,PPPCNT,PENDREX,PSOPEND,PPDIS,PPOI,PCOUNT,PP,FSIG S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOP1",10,0)
 K ZZZZ Q
"RTN","PSOP1",11,0)
W I $Y+6>IOSL,$E(IOST)="C" D DIR W @IOF Q:$D(PQT)  D HD
"RTN","PSOP1",12,0)
 N PSOBADR
"RTN","PSOP1",13,0)
 U IO I IO'=IO(0),$Y+6>IOSL W @IOF D HD
"RTN","PSOP1",14,0)
 I $E(IOST)'="C",$Y+6>IOSL W @IOF D HD
"RTN","PSOP1",15,0)
 D STAT^PSOFUNC S STA="A^N^R^H^P^S^^^^^^E^DC^^DC^DE^PH",ST=$P(STA,"^",(ST0+1)) K STA
"RTN","PSOP1",16,0)
 S PSOBADR=$O(^PSRX(J,"L",9999),-1)
"RTN","PSOP1",17,0)
 I PSOBADR'="" S PSOBADR=$G(^PSRX(J,"L",PSOBADR,0)) I PSOBADR["(BAD ADDRESS)" S PSOBADR="B"
"RTN","PSOP1",18,0)
 I PSOBADR'="B" S PSOBADR=""
"RTN","PSOP1",19,0)
 S ST=ST_PSOBADR
"RTN","PSOP1",20,0)
 W !,CP_$P(RX0,"^"),$$ECME^PSOBPSUT(J),?13,$S($D(^PSDRUG(+$P(RX0,"^",6),0)):$P(^(0),"^"),1:"NOT ON FILE"),?54,$S($L(ST)=1:" "_ST,1:ST)
"RTN","PSOP1",21,0)
 S RXD=$P($G(^PSRX(J,3)),"^"),RXF=$P(RX0,"^",9) F II=0:0 S II=$O(^PSRX(J,1,II)) Q:'II  S RXF=RXF-1 S:$P(^PSRX(J,1,II,0),"^",16) RST($P(^(0),"^"))=1
"RTN","PSOP1",22,0)
 W ?58,$S($L(RXF)=1:" "_RXF,1:RXF)
"RTN","PSOP1",23,0)
 W ?61,$E($P(RX0,"^",13),4,5)_"-"_$E($P(RX0,"^",13),6,7)_"-"_$E($P(RX0,"^",13),2,3) W:RXD ?70,$E(RXD,4,5)_"-"_$E(RXD,6,7)_"-"_$E(RXD,2,3)_$S($G(RST(RXD)):"R",1:"")
"RTN","PSOP1",24,0)
 S PSOPRSIG=$P($G(^PSRX(J,"SIG")),"^",2) K FSIG,BSIG D
"RTN","PSOP1",25,0)
 .I PSOPRSIG D FSIG^PSOUTLA("R",J,50) Q
"RTN","PSOP1",26,0)
 .D EN2^PSOUTLA1(J,50) F GGGG=0:0 S GGGG=$O(BSIG(GGGG)) Q:'GGGG  S FSIG(GGGG)=BSIG(GGGG)
"RTN","PSOP1",27,0)
 K PSOPRSIG,GGGG,BSIG
"RTN","PSOP1",28,0)
 W !?5,"QTY: ",$P(RX0,"^",7),?24,"SIG: ",$G(FSIG(1)) D:$O(FSIG(1))
"RTN","PSOP1",29,0)
 .F GGGG=1:0 S GGGG=$O(FSIG(GGGG)) Q:'GGGG!($G(PQT))  W !,?29,$G(FSIG(GGGG)) D:$Y+5>IOSL&($E(IOST)="C") DIR Q:$G(PQT)  I '$G(PQT),($Y+5>IOSL) W @IOF D HD
"RTN","PSOP1",30,0)
 K GGGG,FSIG Q:$G(PQT)
"RTN","PSOP1",31,0)
 ;D SIG
"RTN","PSOP1",32,0)
 K RST Q
"RTN","PSOP1",33,0)
HD D:PAGE>1
"RTN","PSOP1",34,0)
 .W !,"Patient: "_$P(^DPT(DFN,0),"^")_" ("_$E($P(^DPT(DFN,0),"^",9),6,9)_")",?70,"Page: "_PAGE
"RTN","PSOP1",35,0)
 .W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP1",36,0)
 W !?57,"REF",!?1,"Rx#",?13,"Drug",?54,"ST",?57,"REM",?62,"Issued",?70,"Last Fill",!,PSOPLINE S PAGE=PAGE+1
"RTN","PSOP1",37,0)
 Q
"RTN","PSOP1",38,0)
SORT K DIR,DUOUT,DTOUT
"RTN","PSOP1",39,0)
 S DIR("B")="All",DIR("A",1)=" ",DIR("A")="All Medications or Selection (A/S): ",DIR(0)="SAM^A:All;S:Select Range",DIR("?",1)="Enter 'A' to Print Entire Medication Profile",DIR("?")="   or 'S' for Selection Range" D ^DIR
"RTN","PSOP1",40,0)
 K DIR Q:$D(DIRUT)!(Y="A")!(Y="E")  D @PSRT
"RTN","PSOP1",41,0)
 Q
"RTN","PSOP1",42,0)
DATE ;asks date range
"RTN","PSOP1",43,0)
 W ! K %DT S %DT="AEX",%DT("A")="Starting Date: " D ^%DT  I "^"[X S DUOUT=1 Q
"RTN","PSOP1",44,0)
 G:Y<0 DATE S SDT=+Y,%DT(0)=SDT,FR=$E(SDT,4,5)_"/"_$E(SDT,6,7)_"/"_$E(SDT,2,3)
"RTN","PSOP1",45,0)
EDT S %DT("A")="Ending Date: " D ^%DT  I "^"[X S DUOUT=1 Q
"RTN","PSOP1",46,0)
 G:Y<0 EDT S EDT=+Y,DTS=1,TO=$E(EDT,4,5)_"/"_$E(EDT,6,7)_"/"_$E(EDT,2,3)
"RTN","PSOP1",47,0)
 K %DT Q
"RTN","PSOP1",48,0)
DRUG ;asks drug list
"RTN","PSOP1",49,0)
 W ! S DIC("A")="Start with Drug: ",DIC(0)="AEMQ",DIC=50
"RTN","PSOP1",50,0)
 S DIC("S")="I $S('$D(^PSDRUG(Y,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0),$S('$D(^PSDRUG(Y,2)):1,$P(^(2),""^"",3)'[""O"":0,1:1)"
"RTN","PSOP1",51,0)
 D ^DIC I "^"[X S DUOUT=1 K DIC Q
"RTN","PSOP1",52,0)
 G:Y<0 DRUG S FR=$P(Y,"^",2)
"RTN","PSOP1",53,0)
 F %=$L($E(FR,1,30)):-1:1 S M=$A(FR,%) I M>32 S Y1=$E(FR,1,%-1)_$C(M-1)_$C(122) Q
"RTN","PSOP1",54,0)
 S PSFR=Y1 K Y1,Y,X
"RTN","PSOP1",55,0)
TO S DIC("A")="To Drug: " D ^DIC I "^"[X S DUOUT=1 K DIC Q
"RTN","PSOP1",56,0)
 G:Y<0 TO I FR]$P(Y,"^",2) W !,$C(7),"Less Than 'Start' Value" K X,Y G TO
"RTN","PSOP1",57,0)
 S TO=$P(Y,"^",2),DRS=1
"RTN","PSOP1",58,0)
 F %=$L($E(TO,1,30)):-1:1 S M=$A(TO,%) I M>32 S Y1=$E(TO,1,%-1)_$C(M+1)_$C(122) Q
"RTN","PSOP1",59,0)
 S PSTO=Y1 K Y1,Y,X,DIC
"RTN","PSOP1",60,0)
 Q
"RTN","PSOP1",61,0)
CLSS ;asks drug class list
"RTN","PSOP1",62,0)
 W ! S DIC("A")="Start with Drug Class: ",DIC(0)="AEQ",DIC=50.605 D ^DIC I "^"[X S DUOUT=1 Q
"RTN","PSOP1",63,0)
 G:Y<0 CLSS S FR=$P(Y,"^",2)
"RTN","PSOP1",64,0)
 F %=$L($E(FR,1,30)):-1:1 S M=$A(FR,%) I M>32 S Y1=$E(FR,1,%-1)_$C(M-1)_$C(122) Q
"RTN","PSOP1",65,0)
 S PSFR=Y1 K Y1,Y,X
"RTN","PSOP1",66,0)
TO1 S DIC("A")="To Drug Class: " D ^DIC I "^"[X S DUOUT=1 Q
"RTN","PSOP1",67,0)
 G:Y<0 TO1 I FR]$P(Y,"^",2) W !,$C(7),"Less Than 'Start' Value" K X,Y G TO1
"RTN","PSOP1",68,0)
 S TO=$P(Y,"^",2)
"RTN","PSOP1",69,0)
 F %=$L($E(TO,1,30)):-1:1 S M=$A(TO,%) I M>32 S Y1=$E(TO,1,%-1)_$C(M+1)_$C(122) Q
"RTN","PSOP1",70,0)
 S PSTO=Y1,CLS=1 K Y,Y1,X
"RTN","PSOP1",71,0)
 Q
"RTN","PSOP1",72,0)
DIR K PQT,DTOUT,DUOUT,DIR,DIRUT S DIR(0)="E" D ^DIR S:$D(DUOUT)!($D(DTOUT)) PQT=1 Q
"RTN","PSOP1",73,0)
SIG I '$P(^PSRX(J,"SIG"),"^",2) D  Q
"RTN","PSOP1",74,0)
 .S X=$P(^PSRX(J,"SIG"),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOP1",75,0)
 .F SG=1:1:$L(SIG) W:($X+$L($P(SIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W:$P(SIG," ",SG)]"" $P(SIG," ",SG)_" "
"RTN","PSOP1",76,0)
 S MIG=$P(^PSRX(J,"SIG"),"^"),SIGOK=1 D
"RTN","PSOP1",77,0)
 .F SG=1:1:$L(MIG) Q:$P(MIG," ",SG)=""  W:($X+$L($P(MIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W $P(MIG," ",SG)_" "
"RTN","PSOP1",78,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  S MIG=$P(^PSRX(RXN,"SIG1",I,0),"^") D
"RTN","PSOP1",79,0)
 .F SG=1:1:$L(MIG) Q:$P(MIG," ",SG)=""  W:($X+$L($P(MIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W $P(MIG," ",SG)_" "
"RTN","PSOP1",80,0)
 Q
"RTN","PSOPAT")
0^15^B4414039^B5159102
"RTN","PSOPAT",1,0)
PSOPAT ;BHAM ISC/SAB - update pharmacy patient data ;03/08/93 8:35
"RTN","PSOPAT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**74,117,149,233**;DEC 1997;Build 8
"RTN","PSOPAT",3,0)
 ;Reference to ^PS(55, is supported by IA 2228
"RTN","PSOPAT",4,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) W $C(7),!,"Site Parameters must be Defined!",! G EX
"RTN","PSOPAT",5,0)
2 W ! S PSOFROM=1,DIC("A")="Select Patient: ",DIC=2,DIC(0)="AEQMZ" D ^DIC G:"^"[X EX G:Y<0 2 S DFN=+Y S PSOLOUD=1 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN) K PSOLOUD
"RTN","PSOPAT",6,0)
 S DA=DFN,PI="" D ^PSODEM G 2:PI="^"
"RTN","PSOPAT",7,0)
 I '$P($G(PSOPAR),"^",22),'$D(^XUSEC("PSO ADDRESS UPDATE",+$G(DUZ))) G P55
"RTN","PSOPAT",8,0)
 L +^PS(55,DA):0 I '$T D MSG D EX G 2
"RTN","PSOPAT",9,0)
 S PSODFN=DA D UPDATE^PSOBAI S DA=PSODFN
"RTN","PSOPAT",10,0)
 W !
"RTN","PSOPAT",11,0)
 L +^DPT(DA):0 I '$T D MSG D EX G 2
"RTN","PSOPAT",12,0)
 S DIE="^DPT(",DR="[PSO OUTPT]" D ^DIE L -^DPT(DA)
"RTN","PSOPAT",13,0)
P55 I '$D(^PS(55,DFN)) K DIC S DIC="^PS(55,",DIC(0)="LZ",(X,DINUM)=DFN K DD,DO D FILE^DICN D:$G(DFN)&($P($G(^PS(55,DFN,0)),"^",6)'=2) EN^PSOHLUP(DFN) K DIC
"RTN","PSOPAT",14,0)
 I $G(DFN),$P($G(^PS(55,DFN,0)),"^")="" S $P(^PS(55,DFN,0),"^")=DFN K DIK S DA=DFN,DIK="^PS(55,",DIK(1)=".01^B" D EN^DIK K DIK S DA=DFN
"RTN","PSOPAT",15,0)
 S DIE="^PS(55,",DR=".02;.03;.05;.04;1;D ELIG^PSORX1;3;40:41.1;106;106.1" W !!?5,">>PHARMACY PATIENT DATA<<",!
"RTN","PSOPAT",16,0)
 D ^DIE,EX W !! G 2
"RTN","PSOPAT",17,0)
 Q
"RTN","PSOPAT",18,0)
EX L -^PS(55,+$G(DA)),-^DPT(+$G(DA))
"RTN","PSOPAT",19,0)
 K DIC,X,Y,DIE,D0,DA,DFN,PI,DR,%,%Y,%X,C,DI,DIPGM,DQ,PSOFROM
"RTN","PSOPAT",20,0)
 Q
"RTN","PSOPAT",21,0)
MSG W $C(7),!,"Patient Data is Being Edited by Another User!",! Q
"RTN","PSORX1")
0^16^B48416353^B46792556
"RTN","PSORX1",1,0)
PSORX1 ;BIR/SAB-medication processing driver ;3/28/05 1:14pm
"RTN","PSORX1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,22,23,57,62,46,74,71,90,95,115,117,146,139,135,182,195,233**;DEC 1997;Build 8
"RTN","PSORX1",3,0)
 ;External reference PDA^PPPPDA1 supported by DBIA 1374
"RTN","PSORX1",4,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSORX1",5,0)
 ;External reference ^DIC(31 supported by DBIA 658
"RTN","PSORX1",6,0)
 ;External reference ^DPT(D0,.372 supported by DBIA 1476
"RTN","PSORX1",7,0)
 ;External reference DISPPRF^DGPFAPI supported by DBIA #4563
"RTN","PSORX1",8,0)
 ;
"RTN","PSORX1",9,0)
 ;PSO*195 add call to display Patient Record Flag (DISPPRF^DGPFAPI)
"RTN","PSORX1",10,0)
 ;
"RTN","PSORX1",11,0)
START K PSOQFLG,PSOID,PSOFIN,PSOQUIT,PSODRUG S (PSOBCK,PSOERR)=1 D INIT G:PSORX("QFLG") END
"RTN","PSORX1",12,0)
 D PT G:$G(PSORX("QFLG")) END D FULL^VALM1 I $G(NOPROC) K NOPROC G NX
"RTN","PSORX1",13,0)
 ;call to add bingo board data to file 52.11
"RTN","PSORX1",14,0)
 F SLPPL=0:0 S SLPPL=$O(RXRS(SLPPL)) Q:'SLPPL  D
"RTN","PSORX1",15,0)
 .I $P($G(^PSRX(SLPPL,"STA")),"^")'=5 K RXRS(SLPPL) Q
"RTN","PSORX1",16,0)
 .S RXREC=SLPPL D WIND^PSOSUPOE I $G(PBINGRTE) D BBADD^PSOSUPOE S (BINGCRT,BINGRTE)=1 S:$G(PSOFROM)'="NEW" PSOFROM="REFILL"
"RTN","PSORX1",17,0)
 K TM,TM1 I $G(PSORX("PSOL",1))]""!($D(RXRS)) D ^PSORXL K PSORX S PSOPBM1=1
"RTN","PSORX1",18,0)
 G:$G(NOBG) NX
"RTN","PSORX1",19,0)
 S TM=$P(^TMP("PSOBB",$J),"^"),TM1=$P(^TMP("PSOBB",$J),"^",2) K ^TMP("PSOBB",$J)
"RTN","PSORX1",20,0)
 I $G(PSOFROM)="NEW"!($G(PSOFROM)="REFILL")!($G(PSOFROM)="PARTIAL") D:$D(BINGCRT)&($D(BINGRTE)&($D(DISGROUP))) ^PSOBING1 K BINGCRT,BINGRTE,BBRX,BBFLG
"RTN","PSORX1",21,0)
 I $G(PSOPBM),$G(PSOPBM1) S $P(^PS(55,PSODFN,0),"^",7)=PSOPBM,$P(^(0),"^",8)="A" K PSOPBM,PSOPBM1
"RTN","PSORX1",22,0)
NX I $G(POERR("DEAD"))!$G(PSOQFLG) D EOJ G START
"RTN","PSORX1",23,0)
 D EOJ G START
"RTN","PSORX1",24,0)
END Q
"RTN","PSORX1",25,0)
 ;---------------------------------------------------------
"RTN","PSORX1",26,0)
INIT ;
"RTN","PSORX1",27,0)
 S PSORX("QFLG")=0
"RTN","PSORX1",28,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) S PSORX("QFLG")=1
"RTN","PSORX1",29,0)
 I $P($G(PSOPAR),"^",2),'$D(^XUSEC("PSORPH",DUZ)) S PSORX("VERIFY")=1
"RTN","PSORX1",30,0)
INITX Q
"RTN","PSORX1",31,0)
 ;
"RTN","PSORX1",32,0)
PT ;
"RTN","PSORX1",33,0)
 K ^TMP("PSORXDC",$J),CLOZPAT,DIC,PSODFN,PSOPBM,PSOPBM1 S PSORX("QFLG")=0,DIC=2,DIC(0)="QEAM" D ^DIC K DIC,DA
"RTN","PSORX1",34,0)
 I +Y'>0 S PSORX("QFLG")=1 G PTX
"RTN","PSORX1",35,0)
OERR N:$G(MEDP) PAT,POERR K PSOXFLG S (DFN,PSODFN)=+Y,PSORX("NAME")=$P(Y,"^",2)
"RTN","PSORX1",36,0)
 K NPPROC,PSOQFLG,DIC,DR,DIQ S DIC=2,DA=PSODFN,DR=.351,DIQ="PSOPTPST" D EN^DIQ1 K DIC,DA,DR,DIQ D DEAD^PSOPTPST I $G(PSOQFLG) S NOPROC=1 Q
"RTN","PSORX1",37,0)
 ;PSO*195 move SSN write to here and add DISPPRF call
"RTN","PSORX1",38,0)
 S SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")
"RTN","PSORX1",39,0)
 W " ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")" K SSN
"RTN","PSORX1",40,0)
 N PSOUPDT
"RTN","PSORX1",41,0)
 S PSOUPDT=1
"RTN","PSORX1",42,0)
 I XQY0["PSO LMOE FINISH" S PSOUPDT=0
"RTN","PSORX1",43,0)
 D CHKADDR^PSOBAI(PSODFN,1,PSOUPDT)
"RTN","PSORX1",44,0)
 D:(XQY0["PSO LMOE FINISH")&('$G(SNGLPAT)) DISPPRF^DGPFAPI(PSODFN)
"RTN","PSORX1",45,0)
 ;
"RTN","PSORX1",46,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") W !?10,"Patient has another language preference!",! H 3
"RTN","PSORX1",47,0)
 I $G(^PS(55,"ASTALK",PSODFN)) W !,"Patient is enrolled to receive ScripTalk 'talking' prescription labels.",! H 2 D MAIL
"RTN","PSORX1",48,0)
 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2) S ^TMP("PSOBB",$J)=TM_"^"_TM1
"RTN","PSORX1",49,0)
 I '$G(MEDP) S X="PPPPDA1" X ^%ZOSF("TEST") S:$T X=$$PDA^PPPPDA1(PSODFN)
"RTN","PSORX1",50,0)
 S PSOQFLG=0,DIC="^PS(55,",DLAYGO=55
"RTN","PSORX1",51,0)
 K PSOPBM ; KILL SO THAT WON'T CARRY OVER PRIOR PATIENT'S VALUE
"RTN","PSORX1",52,0)
 I '$D(^PS(55,PSODFN,0)) D
"RTN","PSORX1",53,0)
 .S PSOPBM=$P(TM,".")
"RTN","PSORX1",54,0)
 .K DD,DO S DIC(0)="L",(DINUM,X)=PSODFN D FILE^DICN D:Y<1  K DIC,DA,DR,DD,DO
"RTN","PSORX1",55,0)
 ..S $P(^PS(55,PSODFN,0),"^")=PSODFN K DIK S DA=PSODFN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK
"RTN","PSORX1",56,0)
 S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSORX1",57,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",58,0)
 .L +^PS(55,PSODFN):0 I '$T W $C(7),!!,"Patient Data is Being Edited by Another User!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1 Q
"RTN","PSORX1",59,0)
 .S PSOXFLG=1,SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")",! K SSN
"RTN","PSORX1",60,0)
 .S DIE=55,DR=".02;.03;.04;.05;1;D ELIG^PSORX1;3;50;106;106.1",DA=PSODFN W !!,?5,">>PHARMACY PATIENT DATA<<",! D ^DIE L -^PS(55,PSODFN)
"RTN","PSORX1",61,0)
 S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^")
"RTN","PSORX1",62,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",63,0)
 .W !!,"Patient Status Required!!",! D ELIG
"RTN","PSORX1",64,0)
 .W ! K POERR("QFLG"),DIC,DR,DIE S DIC("A")="PATIENT STATUS: ",DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSORX1",65,0)
 .I $D(DIRUT)!(Y=-1) D  Q
"RTN","PSORX1",66,0)
 ..W $C(7),"Required Data!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1
"RTN","PSORX1",67,0)
 ..I $G(PSOPBM) D  K PSOPBM
"RTN","PSORX1",68,0)
 ...I $O(^PS(55,PSODFN,0))="" S DA=PSODFN,DIK="^PS(55," D ^DIK
"RTN","PSORX1",69,0)
 .S ^PS(55,PSODFN,"PS")=+Y,PSORX("PATIENT STATUS")=$P(^PS(53,+Y,0),"^")
"RTN","PSORX1",70,0)
 .K DIRUT,DTOUT,DUOUT,X,Y,DA
"RTN","PSORX1",71,0)
 Q:$G(PSOFIN)
"RTN","PSORX1",72,0)
 I '$G(PSOPBM),'$P(^PS(55,PSODFN,0),"^",7),$P(^(0),"^",8)']"" S PSOPBM=$P(TM,".")
"RTN","PSORX1",73,0)
 D ^PSOBUILD
"RTN","PSORX1",74,0)
 F PT="GET","DEAD","INP","CNH","TPB","ADDRESS","COPAY" S RTN=PT_"^PSOPTPST" D @RTN Q:$G(POERR("DEAD"))!($G(PSOQFLG))
"RTN","PSORX1",75,0)
 I $G(POERR("DEAD")) S POERR("QFLG")=1 F II=0:0 S II=$O(^PS(52.41,"P",PSODFN,II)) D:$P($G(^PS(52.41,II,0)),"^",3)'="DC"&($P($G(^(0)),"^",3)'="DE") DC^PSOORFI2
"RTN","PSORX1",76,0)
 K PSOERR("DEAD"),II I $G(PSOQFLG) S POERR("QFLG")=1 G EOJ Q
"RTN","PSORX1",77,0)
 S (PAT,PSOXXDFN)=PSODFN,POERR=1 D ^PSOORUT2,BLD^PSOORUT1,EN^PSOLMUTL
"RTN","PSORX1",78,0)
 D CLEAR^VALM1 G:$G(PSOQUIT) PTX D EN^PSOLMAO
"RTN","PSORX1",79,0)
 S (DFN,PSODFN)=PSOXXDFN K DIE,DIC,DLAYGO,DR,DA,PSOX,PSORXED
"RTN","PSORX1",80,0)
PTX ;
"RTN","PSORX1",81,0)
 K X,Y,^TMP("PS",$J),C,DEA,PRC,PSCNT,PSOACT,PSOCLC,PSOCS,PSOCT,PSOFINFL,PSOHD,PSOLST,PSOOPT,PSOPF,PSOX,PSOX1,PSOXXDFN,SIGOK,STP,STR
"RTN","PSORX1",82,0)
 Q
"RTN","PSORX1",83,0)
EOJ ;
"RTN","PSORX1",84,0)
 K PSOERR,PSOMED,PSORX,PSOSD,PSODRUG,PSODFN,PSOOPT,PSOBILL,PSOIBQS,PSOCPAY,PSOPF,PSOPI,COMM,DGI,DGS,PT,PTDY,PTRF,RN,RTN,SERS,ST0,STAT,DFN,STOP,SLPPL,RXREC,PSOPBM
"RTN","PSORX1",85,0)
 K:'$G(MEDP) PSOQFLG
"RTN","PSORX1",86,0)
 D KVA^VADPT,FULL^VALM1 K PSOLST,PSOXFLG,PSCNT,PSDIS,PSOAL,P1,LOG,%,%DT,%I,D0,DAT,DFN,DRG,ORX,PSON,PSOPTPST,PSORX,PTST,PSOBCK,PSOID,PSOBXPUL
"RTN","PSORX1",87,0)
 K INCOM,SIG,SG,STP,RX0,RXN,RX2,RX3,RTS,C,DEAD,PS,PSOCLC,PSOCNT,PSOCT,PSODA,PSOFROM,PSOHD,R3,REA,RF,RFD,RFM,RLD,RXNUM,RXP,RXPR,RXRP,RXRS,STR,POERR,VALMSG
"RTN","PSORX1",88,0)
 K ^TMP("PSORXDC",$J),^TMP("PSOAL",$J),^TMP("PSOAO",$J),^TMP("PSOSF",$J),^TMP("PSOPF",$J),^TMP("PSOPI",$J),^TMP("PSOPO",$J),^TMP("PSOHDR",$J) I '$G(MEDP),'$G(PSOQUIT) K PAT
"RTN","PSORX1",89,0)
 K PSORX,RFN,PSOXXDFN,VALM,VALMKEY,PSOBCK,SPOERR,PSOFLAG,VALMBCK,D,GMRA,GMRAL,GMRAREC,PSOSTA,PSODT,RXFL,NOBG,BBRX,BBFLG
"RTN","PSORX1",90,0)
 Q
"RTN","PSORX1",91,0)
ELIG ; shows eligibility and disabilities
"RTN","PSORX1",92,0)
 D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"") S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSORX1",93,0)
 W !,"Disabilities: " F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSORX1",94,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSORX1",95,0)
 .W:$L(PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 !,?15
"RTN","PSORX1",96,0)
 .W $S($G(PSDIS)]"":PSDIS_"-",1:"")_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSORX1",97,0)
 K N
"RTN","PSORX1",98,0)
 Q
"RTN","PSORX1",99,0)
PROFILE ;
"RTN","PSORX1",100,0)
 S (PSORX("REFILL"),PSORX("RENEW"))=0,PSOX="" D ^PSOBUILD
"RTN","PSORX1",101,0)
 I '$G(PSOSD) W !,"This patient has no prescriptions" S:'$D(DFN) DFN=PSODFN D GMRA^PSODEM G PROFILEX
"RTN","PSORX1",102,0)
 S (PSODRG,PSOX)="" F  S PSODRG=$O(PSOSD(PSODRG)) Q:PSODRG=""  F  S PSOX=$O(PSOSD(PSODRG,PSOX)) Q:PSOX=""  S:$P(PSOSD(PSODRG,PSOX),"^",3)="" PSORX("RENEW")=1 S:$P(PSOSD(PSODRG,PSOX),"^",4)="" PSORX("REFILL")=1
"RTN","PSORX1",103,0)
 K PSOX
"RTN","PSORX1",104,0)
PROFILEX Q
"RTN","PSORX1",105,0)
 ;
"RTN","PSORX1",106,0)
MAIL ; MAKE SURE MAIL STATUS IS COMPATIBLE WITH SCRIPTALK PATIENT
"RTN","PSORX1",107,0)
 I $P($G(^PS(59,PSOSITE,"STALK")),"^")="" Q  ; NO SCRIPTALK PRINTER SET UP FOR THIS DIVISION
"RTN","PSORX1",108,0)
 N MAIL
"RTN","PSORX1",109,0)
 S MAIL=$G(^PS(55,PSODFN,0)) I $P(MAIL,"^",3)>1 Q
"RTN","PSORX1",110,0)
MAILP W !!,"REMINDER: CMOP does not fill ScripTalk prescriptions.Please select mail"
"RTN","PSORX1",111,0)
 W !,"status:  2 (DO NOT MAIL), 3 (LOCAL REGULAR MAIL) or 4 (LOCAL CERTFIED MAIL)."
"RTN","PSORX1",112,0)
 R !,"MAIL: ",MAIL:120
"RTN","PSORX1",113,0)
 I MAIL?1"^".E Q
"RTN","PSORX1",114,0)
 I MAIL<2!(MAIL>4) W !,"INVALID MAIL SETTING - ENTER 2,3, OR 4" G MAILP
"RTN","PSORX1",115,0)
 W "  ",$S(MAIL=2:"DO NOT MAIL",MAIL=3:"LOCAL REGULAR MAIL",1:"LOCAL CERTIFIED MAIL")
"RTN","PSORX1",116,0)
 S $P(^PS(55,PSODFN,0),"^",3)=MAIL
"RTN","PSORX1",117,0)
 Q
"RTN","PSORXVW")
0^17^B61807519^B58205807
"RTN","PSORXVW",1,0)
PSORXVW ;BHAM ISC/SAB - listman view of a prescription ;5/25/05 2:10pm
"RTN","PSORXVW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**14,35,46,96,103,88,117,131,146,156,185,210,148,233**;DEC 1997;Build 8
"RTN","PSORXVW",3,0)
 ;External reference to File ^PS(55 supported by DBIA 2228
"RTN","PSORXVW",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSORXVW",5,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSORXVW",6,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSORXVW",7,0)
 ;External reference to ^SC supported by DBIA 10040
"RTN","PSORXVW",8,0)
 ;External reference to ^DPT supported by DBIA 10035
"RTN","PSORXVW",9,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSORXVW",10,0)
 ;External reference to GMRADPT supported by DBIA 10099
"RTN","PSORXVW",11,0)
 ;PSO*210 add call to WORDWRAP^PSOUTLA2 api
"RTN","PSORXVW",12,0)
 ;
"RTN","PSORXVW",13,0)
 S PS="VIEW"
"RTN","PSORXVW",14,0)
A1 W ! S DIC("S")="I $P($G(^(0)),""^"",2),$D(^(""STA"")),$P($G(^(""STA"")),""^"")'=13",DIC=52,DIC(0)="QEA",DIC("A")=PS_" PRESCRIPTION: " D ^DIC K DIC("A") G:"^"[$E(X) KILL G A1:Y<0 S (DA,PSOVDA)=+Y K DIC
"RTN","PSORXVW",15,0)
DP S (PSODFN,DFN)=+$P(^PSRX(DA,0),"^",2) S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSORXVW",16,0)
 D ICN^PSODPT(PSODFN)
"RTN","PSORXVW",17,0)
 K ^TMP("PSOHDR",$J) D ^VADPT,ADD^VADPT
"RTN","PSORXVW",18,0)
 S ^TMP("PSOHDR",$J,1,0)=VADM(1)
"RTN","PSORXVW",19,0)
 N PSOBADR,PSOTEMP
"RTN","PSORXVW",20,0)
 S PSOBADR=$$BADADR^DGUTL3(DFN) I PSOBADR S PSOTEMP=$$CHKTEMP^PSOBAI(DFN) D
"RTN","PSORXVW",21,0)
 .S ^TMP("PSOHDR",$J,1,0)=^TMP("PSOHDR",$J,1,0)_" ** BAD ADDRESS INDICATED-("_$S(PSOBADR=1:"UNDELIVERABLE",PSOBADR=2:"HOMELESS",1:"OTHER")_")"_$S(PSOTEMP:" Active Temporary Address",1:"")
"RTN","PSORXVW",22,0)
 S ^TMP("PSOHDR",$J,2,0)=$P(VADM(2),"^",2)
"RTN","PSORXVW",23,0)
 S ^TMP("PSOHDR",$J,3,0)=$P(VADM(3),"^",2),^TMP("PSOHDR",$J,4,0)=VADM(4),^TMP("PSOHDR",$J,5,0)=$P(VADM(5),"^",2)
"RTN","PSORXVW",24,0)
 S POERR=1 D RE^PSODEM K PSOERR
"RTN","PSORXVW",25,0)
 S ^TMP("PSOHDR",$J,6,0)=$S(+$P(WT,"^",8):$P(WT,"^",9)_" ("_$P(WT,"^")_")",1:"_______ (______)")
"RTN","PSORXVW",26,0)
 S ^TMP("PSOHDR",$J,7,0)=$S($P(HT,"^",8):$P(HT,"^",9)_" ("_$P(HT,"^")_")",1:"_______ (______)") K VM,WT,HT S PSOHD=7
"RTN","PSORXVW",27,0)
 S GMRA="0^0^111" D EN1^GMRADPT S ^TMP("PSOHDR",$J,8,0)=+$G(GMRAL)
"RTN","PSORXVW",28,0)
 D DEM^VADPT I +VADM(6) D
"RTN","PSORXVW",29,0)
 .S SSN=$P(^DPT(PSODFN,0),"^",9) W !,$C(7),?10,$P(^DPT(PSODFN,0),"^")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_") DIED "_$P(VADM(6),"^",2),!
"RTN","PSORXVW",30,0)
 .W "All Active Medications will be Autocanceled!",! H 2 S PSODEATH=1
"RTN","PSORXVW",31,0)
 .S ACOM="Date of Death "_$P(VADM(6),"^",2)_".",ZTRTN="CAN^PSOCAN3",ZTDESC="Outpatient Pharmacy Autocancel Due to Death of Patient",ZTSAVE("ACOM")="",ZTSAVE("PSODFN")="",ZTSAVE("PSODEATH")=""
"RTN","PSORXVW",32,0)
 .S ZTIO="",PSOCLC=DUZ,ZTSAVE("PSOCLC")="",ZTDTH=$H D ^%ZTLOAD K ACOM,ZTSK,PSODEATH
"RTN","PSORXVW",33,0)
 K ^TMP("PSOAL",$J),PCOMX,PDA,PHI,PRC,ACOM,ANS
"RTN","PSORXVW",34,0)
 S (DA,RXN)=PSOVDA K PSOVDA S RX0=^PSRX(RXN,0),RX2=$G(^(2)),RX3=$G(^(3)),ST=+$G(^("STA")),RXOR=$G(^("OR1"))
"RTN","PSORXVW",35,0)
 I 'RXOR,$P(^PSDRUG($P(RX0,"^",6),2),"^") S $P(^PSRX(RXN,"OR1"),"^")=$P(^PSDRUG($P(RX0,"^",6),2),"^"),RXOR=$P(^PSDRUG($P(RX0,"^",6),2),"^")
"RTN","PSORXVW",36,0)
 S IEN=0,$P(RN," ",12)=" "
"RTN","PSORXVW",37,0)
 N APPND S APPND=$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN)
"RTN","PSORXVW",38,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$S($P($G(^PSRX(RXN,"TPB")),"^"):"            TPB Rx #: ",1:"                Rx #: ")_$P(RX0,"^")_APPND_$E(RN,$L($P(RX0,"^")_APPND)+1,12)
"RTN","PSORXVW",39,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="      Orderable Item: "_$S($D(^PS(50.7,$P(+RXOR,"^"),0)):$P(^PS(50.7,$P(+RXOR,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:"No Pharmacy Orderable Item")
"RTN","PSORXVW",40,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$S($D(^PSDRUG("AQ",$P(RX0,"^",6))):"           CMOP ",1:"                ")_"Drug: "_$P(^PSDRUG($P(RX0,"^",6),0),"^")
"RTN","PSORXVW",41,0)
 S:$G(^PSRX(RXN,"TN"))]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Trade Name: "_$G(^PSRX(RXN,"TN"))
"RTN","PSORXVW",42,0)
 D DOSE^PSORXVW1
"RTN","PSORXVW",43,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Patient Instructions:" I $O(^PSRX(RXN,"INS1",0)) D
"RTN","PSORXVW",44,0)
 . F I=0:0 S I=$O(^PSRX(RXN,"INS1",I)) Q:'I  D                ;PSO*210
"RTN","PSORXVW",45,0)
 .. S MIG=^PSRX(RXN,"INS1",I,0)
"RTN","PSORXVW",46,0)
 .. D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW",47,0)
 K MIG,SG
"RTN","PSORXVW",48,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  Other Pat. Instruc: "_$S($G(^PSRX(RXN,"INSS"))]"":^PSRX(RXN,"INSS"),1:"")
"RTN","PSORXVW",49,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="                 SIG:"
"RTN","PSORXVW",50,0)
 I '$P($G(^PSRX(RXN,"SIG")),"^",2) D  G PTST
"RTN","PSORXVW",51,0)
 . S X=$P($G(^PSRX(RXN,"SIG")),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSORXVW",52,0)
 . D WORDWRAP^PSOUTLA2(SIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW",53,0)
 S SIGOK=1
"RTN","PSORXVW",54,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  D                ;PSO*210
"RTN","PSORXVW",55,0)
 . S MIG=^PSRX(RXN,"SIG1",I,0)
"RTN","PSORXVW",56,0)
 . D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW",57,0)
 S SIGOK=1 K MIG,SG
"RTN","PSORXVW",58,0)
PTST S $P(RN," ",25)=" ",PTST=$S($G(^PS(53,+$P(RX0,"^",3),0))]"":$P($G(^PS(53,+$P(RX0,"^",3),0)),"^"),1:""),IEN=IEN+1
"RTN","PSORXVW",59,0)
 S ^TMP("PSOAL",$J,IEN,0)="      Patient Status: "_PTST_$E(RN,$L(PTST)+1,25)
"RTN","PSORXVW",60,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Issue Date: "_$E($P(RX0,"^",13),4,5)_"/"_$E($P(RX0,"^",13),6,7)_"/"_$E($P(RX0,"^",13),2,3)
"RTN","PSORXVW",61,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                 Fill Date: "_$E($P(RX2,"^",2),4,5)_"/"_$E($P(RX2,"^",2),6,7)_"/"_$E($P(RX2,"^",2),2,3)
"RTN","PSORXVW",62,0)
 S ROU=$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSORXVW",63,0)
 S REFL=$P(RX0,"^",9),I=0 F  S I=$O(^PSRX(RXN,1,I)) Q:'I  S REFL=REFL-1,ROU=$S($P(^PSRX(RXN,1,I,0),"^",2)="W":"Window",1:"Mail")
"RTN","PSORXVW",64,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="      Last Fill Date: "_$E($P(RX3,"^"),4,5)_"/"_$E($P(RX3,"^"),6,7)_"/"_$E($P(RX3,"^"),2,3)
"RTN","PSORXVW",65,0)
  D CMOP^PSOORNE3 S DA=RXN
"RTN","PSORXVW",66,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_" ("_ROU_$S($G(PSOCMOP)]"":", "_PSOCMOP,1:"")_")" K ROU,PSOCMOP
"RTN","PSORXVW",67,0)
 S IEN=IEN+1 I $P(RX2,"^",15) S ^TMP("PSOAL",$J,IEN,0)="   Returned to Stock: "_$E($P(RX2,"^",15),4,5)_"/"_$E($P(RX2,"^",15),6,7)_"/"_$E($P(RX2,"^",15),2,3)
"RTN","PSORXVW",68,0)
 E  S ^TMP("PSOAL",$J,IEN,0)="   Last Release Date: " D
"RTN","PSORXVW",69,0)
 .S RLD=$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"/"_$E($P(RX2,"^",13),6,7)_"/"_$E($P(RX2,"^",13),2,3),1:"")
"RTN","PSORXVW",70,0)
 .I $O(^PSRX(RXN,1,0)) F I=0:0 S I=$O(^PSRX(RXN,1,I)) Q:'I  D
"RTN","PSORXVW",71,0)
 ..I $P(^PSRX(RXN,1,I,0),"^",18) S RLD=$E($P(^(0),"^",18),4,5)_"/"_$E($P(^(0),"^",18),6,7)_"/"_$E($P(^(0),"^",18),2,3)
"RTN","PSORXVW",72,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_$S($G(RLD)]"":RLD,1:"        ")
"RTN","PSORXVW",73,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                     Lot #: "_$P(RX2,"^",4)
"RTN","PSORXVW",74,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             Expires: "_$E($P(RX2,"^",6),4,5)_"/"_$E($P(RX2,"^",6),6,7)_"/"_$E($P(RX2,"^",6),2,3)
"RTN","PSORXVW",75,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                       MFG: "_$P($G(RX2),"^",8)
"RTN","PSORXVW",76,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="         Days Supply: "_$P(RX0,"^",8)_$S($L($P(RX0,"^",8))=1:" ",1:"")
"RTN","PSORXVW",77,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                           QTY"_$S($P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)]"":" ("_$P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)_")",1:" (  )")_": "_$P(RX0,"^",7)
"RTN","PSORXVW",78,0)
 I $P($G(^PSDRUG($P(RX0,"^",6),5)),"^")]"" D
"RTN","PSORXVW",79,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSORXVW",80,0)
 .S ^TMP("PSOAL",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^") K RN
"RTN","PSORXVW",81,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        # of Refills: "_$P(RX0,"^",9)_$S($L($P(RX0,"^",9))=1:" ",1:"")_"                       Remaining: "_REFL
"RTN","PSORXVW",82,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="            Provider: "_$S($D(^VA(200,$P(RX0,"^",4),0)):$P(^VA(200,$P(RX0,"^",4),0),"^"),1:"UNKNOWN")
"RTN","PSORXVW",83,0)
 I $P(RX3,"^",3) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        Cos-Provider: "_$P(^VA(200,$P(RX3,"^",3),0),"^")
"RTN","PSORXVW",84,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             Routing: "_$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSORXVW",85,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="              Copies: "_$S($P(RX0,"^",18):$P(RX0,"^",18),1:1)
"RTN","PSORXVW",86,0)
 S:$P(RX0,"^",11)="W" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="    Method of Pickup: "_$G(^PSRX(RXN,"MP"))
"RTN","PSORXVW",87,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="              Clinic: "_$S($D(^SC(+$P(RX0,"^",5),0)):$P(^SC($P(RX0,"^",5),0),"^"),1:"Not on File")
"RTN","PSORXVW",88,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="            Division: "_$P(^PS(59,$P(RX2,"^",9),0),"^")_" ("_$P(^(0),"^",6)_")"
"RTN","PSORXVW",89,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Pharmacist: "_$S($P(RX2,"^",3):$P(^VA(200,$P(RX2,"^",3),0),"^"),1:"")
"RTN","PSORXVW",90,0)
 S:$P(RX2,"^",10)&('$G(PSOCOPY)) IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="         Verified By: "_$P(^VA(200,$P(RX2,"^",10),0),"^")
"RTN","PSORXVW",91,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  Patient Counseling: "_$S($P($G(^PSRX(RXN,"PC")),"^"):"YES",1:"NO")_"                      "_$S($P($G(^PSRX(RXN,"PC")),"^"):"Was Counseling Understood: "_$S($P($G(^PSRX(RXN,"PC")),"^",2):"YES",1:"NO"),1:"")
"RTN","PSORXVW",92,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             Remarks: "_$P(RX3,"^",7)
"RTN","PSORXVW",93,0)
 D PC^PSORXVW1
"RTN","PSORXVW",94,0)
 I $P($G(^PSRX(DA,"OR1")),"^",5) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="         Finished By: "_$P(^VA(200,$P(^PSRX(DA,"OR1"),"^",5),0),"^")
"RTN","PSORXVW",95,0)
 D ^PSORXVW1 S PSOAL=IEN K IEN,ACT,LBL,LOG
"RTN","PSORXVW",96,0)
 I ST<12,$P(RX2,"^",6)<DT S ST=11
"RTN","PSORXVW",97,0)
 S VALM("TITLE")="Rx View "_"("_$P("Error^Active^Non-Verified^Refill^Hold^Non-Verified^Suspended^^^^^Done^Expired^Discontinued^Deleted^Discontinued^Discontinued (Edit)^Provider Hold^","^",ST+2)_")"
"RTN","PSORXVW",98,0)
 S:$P($G(^PSRX(DA,"PKI")),"^") VALMSG="Digitally Signed Order"
"RTN","PSORXVW",99,0)
 D EN^PSOORAL,KILL G:PS="VIEW" PSORXVW
"RTN","PSORXVW",100,0)
 Q
"RTN","PSORXVW",101,0)
KILL K ^TMP("PSOAL",$J),PSOAL,IEN,^TMP("PSOHDR",$J) K:PS="VIEW" DA
"RTN","PSORXVW",102,0)
 K ST,RFL,RFLL,RFL1,ST,II,J,N,PHYS,L1,DIRUT,PSDIV,PSEXDT,MED,M1,FFX,DTT,DAT,RX0,RX2,R3,RTN,SIG,STA,P1,PL,P0,Z0,Z1,EXDT,IFN,DIR,DUOUT,DTOUT,PSOELSE
"RTN","PSORXVW",103,0)
 K LBL,I,RFDATE,%H,%I,RN,RFT,%,%I,DFN,GMRAL,HDR,POERR,PTST,REFL,RF,RLD,RX3
"RTN","PSORXVW",104,0)
 K RXN,RXOR,SG,VA,VADM,VAERR,VALMBCK,VAPA,X,DIC,REA,ZD,PSOHD,PSOBCK,PSODFN
"RTN","PSORXVW",105,0)
 Q
"RTN","PSOSD1")
0^18^B49042577^B47474708
"RTN","PSOSD1",1,0)
PSOSD1 ;BHAM ISC/SAB/JMB - action or informational profile cont. ;11/18/92
"RTN","PSOSD1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,17,19,22,40,49,66,107,110,132,233**;DEC 1997;Build 8
"RTN","PSOSD1",3,0)
 ;External reference to ^PS(59.7 is supported by DBIA 694
"RTN","PSOSD1",4,0)
 ;
"RTN","PSOSD1",5,0)
INIT S PRF="" F PSOI=0:0 S DIC="^DPT(",DIC(0)="QEAM" D ^DIC Q:Y<0  D
"RTN","PSOSD1",6,0)
 .S PRF=PRF_+Y_",",DFN=+Y D DEM^VADPT I +VADM(6) W !,"Patient Expired on "_$P(VADM(6),"^",2),! S DOD(DFN)=$P(VADM(6),"^",2) K DFN
"RTN","PSOSD1",7,0)
 .I $L(PRF)>240 W !,$C(7),"MAX NUMBER OF PATIENTS HAS BEEN REACHED" Q
"RTN","PSOSD1",8,0)
 Q:'$L(PRF)  D DAYS G:$D(DUOUT)!($D(DTOUT)) EXIT^PSOSD
"RTN","PSOSD1",9,0)
DEV N PSOBARS,PSOBAR0,PSOBAR1 K %ZIS,IOP,ZTSK,ZTQUEUED S PSOION=ION,%ZIS="QM",%ZIS("B")="",%ZIS("A")=$S(PSTYPE:"Select a Printer: ",1:"DEVICE: ") D ^%ZIS K %ZIS I POP S IOP=PSOION D ^%ZIS K IOP,PSOION G EXIT
"RTN","PSOSD1",10,0)
 I $E(IOST)["C",PSTYPE D ^%ZISC W $C(7),!!,"Action Profiles MUST BE SENT TO A PRINTER !!",!,"ONLY INFORMATIONAL PROFILES ARE ALLOWED TO PRINT TO SCREEN !!",! G DEV
"RTN","PSOSD1",11,0)
 S PSOIOS=IOS D DEVBAR^PSOBMST S PSOBAR2=PSOBAR0,PSOBAR3=PSOBAR1
"RTN","PSOSD1",12,0)
 S PSOBAR4=$G(PSOBAR3)]""&($G(PSOBAR2)]"")&(+$P($G(PSOPAR),"^"))
"RTN","PSOSD1",13,0)
 K PSOION I $D(IO("Q")) S ZTDESC="Outpatient Pharmacy Action Profile",ZTRTN="START^PSOSD1",ZTSAVE("ZTREQ")="@" D  D EXIT Q:$G(LM)  G ^PSOSD
"RTN","PSOSD1",14,0)
 .F G="PSORM","PSOPOL","PSONUM","PSOSYS","PSOINST","PSOBAR3","PSOBAR4","PSOBAR2","PSOPAR","PSOPAR7","PRF","PSDAYS","PSDATE","PSTYPE","PSOSITE","PSDATE","PSDAY" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOSD1",15,0)
 .S ZTSAVE("DOD*")="",ZTSAVE("PSOBAR*")="" D ^%ZTLOAD W:$D(ZTSK) !,"Report Queued to Print !!",! K:'$G(LM) ZTSK,IO("Q")
"RTN","PSOSD1",16,0)
 D START G:'$G(LM) ^PSOSD
"RTN","PSOSD1",17,0)
 Q
"RTN","PSOSD1",18,0)
START U IO S PSTYPE=$S($D(PSTYPE):PSTYPE,1:0),$P(LINE,"-",132)="-"
"RTN","PSOSD1",19,0)
 F PSIX=1:1 S DFN=$P(PRF,",",PSIX) G:DFN']"" EXIT D ELIG S PAGE=1 D  G:$G(PSQFLG)!($D(DTOUT))!($D(DUOUT)) EXIT
"RTN","PSOSD1",20,0)
 .D PAT^PSOSD Q:$D(DTOUT)!($D(DUOUT))  D  Q:PSQFLG  D RXPAD:PSTYPE W:'$G(PSTYPE)&('$D(^TMP("PSOD",$J))) @IOF D ENSTUFF^PSODACT
"RTN","PSOSD1",21,0)
 ..Q:$D(DUOUT)!($D(DTOUT))  S PSQFLG=0 D ^PSOSD3,NVA^PSOSD3
"RTN","PSOSD1",22,0)
EXIT I '$D(PSONOPG) W ! D ^%ZISC K DFN
"RTN","PSOSD1",23,0)
 W:$D(PSONOPG)&('$D(ORVP)) @IOF
"RTN","PSOSD1",24,0)
 K ^TMP($J,"PRF"),^("ACT"),ADDR,ADDRFL,CLASS,CNDT,CNT,DRUG,CLAPP,HDFL,I,II,J,L,LINE,P,PAGE,PSDOB,PSIIX,PSNAME,PSOI,PSQFLG,PSSN,DFN,PSIX,PAGE,PGM,LINE,PRF,PSTYPE,PSDATE,PSDAYS,VAL,VAR,RX,RX0,RX3,RX2,ST,ST0,PSDAY,RF,RFS,PSOBAR3,PSOBAR4,PSOBAR2
"RTN","PSOSD1",25,0)
 D KVA^VADPT K DOD,FILL,DIC,PSCNT,PSDT,PCLASS,PHYS,ZCLASS,PSOPRINT,RXNODE,DIR,X1,X2,PSONUM,PSOPOLP
"RTN","PSOSD1",26,0)
 Q
"RTN","PSOSD1",27,0)
 ;
"RTN","PSOSD1",28,0)
DAYS K DIR S DIR("A")="Profile Expiration/Discontinued Cutoff",DIR("B")=120,DIR(0)="N^0:9999:0",DIR("?",1)="Enter the number of days which will cut discontinued and expired Rx's from",DIR("?")="the profile."
"RTN","PSOSD1",29,0)
 D ^DIR Q:$D(DTOUT)!($D(DUOUT))  S PSDAYS=X K DIR S X1=DT,X2=-PSDAYS D C^%DTC S (PSDATE,PSDAY)=X
"RTN","PSOSD1",30,0)
 Q
"RTN","PSOSD1",31,0)
 ;
"RTN","PSOSD1",32,0)
DFN S:'$D(PSORM) PSORM=1
"RTN","PSOSD1",33,0)
 S PSOIOS=IOS D DEVBAR^PSOBMST S PSOBAR2=PSOBAR0,PSOBAR3=PSOBAR1
"RTN","PSOSD1",34,0)
 S PSOBAR4=$G(PSOBAR3)]""&($G(PSOBAR2)]"")&(+$P($G(PSOPAR),"^"))
"RTN","PSOSD1",35,0)
 W:$D(PSONOPG)&($G(PSONOPG)'=2) @IOF I '$G(PSOSITE) S PSOSITE=$O(^PS(59,0))
"RTN","PSOSD1",36,0)
 S PRF=DFN_"," D:'$G(PSDAYS)  G START
"RTN","PSOSD1",37,0)
 .S PSDAYS=120,X1=DT,X2=-PSDAYS D C^%DTC S (PSDATE,PSDAY)=X
"RTN","PSOSD1",38,0)
 Q
"RTN","PSOSD1",39,0)
 ;
"RTN","PSOSD1",40,0)
ELIG S PSOPRINT=""
"RTN","PSOSD1",41,0)
 D ELIG^VADPT
"RTN","PSOSD1",42,0)
 Q:'$D(VAEL(4))
"RTN","PSOSD1",43,0)
 Q:+VAEL(4)'=1
"RTN","PSOSD1",44,0)
 I $D(VAEL(3)),+VAEL(3)=1,($P(VAEL(3),"^",2)<50) S PSOPRINT="SC NSC"
"RTN","PSOSD1",45,0)
 D KVAR^VADPT
"RTN","PSOSD1",46,0)
 Q
"RTN","PSOSD1",47,0)
 ;
"RTN","PSOSD1",48,0)
RXPAD N K Q:$G(DOD(DFN))]""  D HD F CNT=1:1:4 S LF="!?45" D  Q:$Y+14>IOSL
"RTN","PSOSD1",49,0)
 .W !?4,"Name: "_PSNAME,?33,"ID#: "_PSSN,?58,"DOB: "_PSDOB
"RTN","PSOSD1",50,0)
 .W !!,CNT,?4,"Medication: ",LN,$E(LN,1,11),!!?4,"Outpatient Directions: ",LN,!?4
"RTN","PSOSD1",51,0)
 .W $E(LN,1,3),"SC",$E(LN,1,3),"NSC","  Quantity: _____    Days Supply _____   "
"RTN","PSOSD1",52,0)
 .W:'$G(PSORM) @LF W "Refills: 0 1 2 3 4 5 6 7 8 9 10 11"
"RTN","PSOSD1",53,0)
 .W !!?4,$E(LN,1,35)," ",$E(LN,1,14)," ",$E(LN,1,24)
"RTN","PSOSD1",54,0)
 .W !?4,"Provider's Signature",?40,"DEA #",?55,"Date/Time",!!,$E(LINE,1,$S('PSORM:80,1:IOM))
"RTN","PSOSD1",55,0)
 K LF Q
"RTN","PSOSD1",56,0)
 ;
"RTN","PSOSD1",57,0)
HD S FN=DFN S:'$D(PSORM) PSORM=1
"RTN","PSOSD1",58,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9):"Temporary ",1:"")
"RTN","PSOSD1",59,0)
 I +VADM(6) S DOD(DFN)=$P(VADM(6),"^",2)
"RTN","PSOSD1",60,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2) I $D(IOF),$G(PAGE)'=1 W @IOF
"RTN","PSOSD1",61,0)
 W "Action Rx Profile",?47,"Run Date: " S Y=DT D DT^DIO2 W ?71,"Page: "_PAGE S PAGE=PAGE+1,X=$$SITE^VASITE
"RTN","PSOSD1",62,0)
 W !,"Sorted by drug classification for Rx's currently active"_$S('PSDAYS:" only.",1:"") W:PSDAYS !,"and for those Rx's that have been inactive less than "_PSDAYS_" days."
"RTN","PSOSD1",63,0)
 W @$S(PSORM:"?70",1:"!"),"Site: VAMC "_$P(X,"^",2)_" ("_$P(X,"^",3)_")",!,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSD1",64,0)
 I $P(VAIN(4),"^",2)]"",+$P($G(^PS(59.7,1,40.1)),"^") W !,"Outpatient prescriptions are discontinued 72 hours after admission.",!
"RTN","PSOSD1",65,0)
 W !?1,"Name  : ",PSNAME,?30,"ID#: "_PSSN W ?58,"Action Date: ________" W !?1,"DOB   : "_PSDOB
"RTN","PSOSD1",66,0)
 W:ADDRFL]"" ?30,ADDRFL,! W ?30,"Address  :"
"RTN","PSOSD1",67,0)
 I $G(ADDRFL)="" D CHECKBAI
"RTN","PSOSD1",68,0)
 W ?41,VAPA(1) W:VAPA(2)]"" !?41,VAPA(2) W:VAPA(3)]"" !?41,VAPA(3) W !?41,VAPA(4)_", "_$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6)),!?30,"Phone    : "_VAPA(8)
"RTN","PSOSD1",69,0)
 I PSOBAR4 S X="S",X2=PSSN W @$S('PSORM:"!?30",1:"?$X+5") S X1=$X W @PSOBAR3,X2,@PSOBAR2,$C(13) S $X=0
"RTN","PSOSD1",70,0)
 S (WT,HT)="",X="GMRVUTL" X ^%ZOSF("TEST") I $T D
"RTN","PSOSD1",71,0)
 .F GMRVSTR="WT","HT" S VM=GMRVSTR D EN6^GMRVUTL S @VM=X,$P(@VM,"^")=$E($P(@VM,"^"),4,5)_"/"_$E($P(@VM,"^"),6,7)_"/"_($E($P(@VM,"^"),1,3)+1700)
"RTN","PSOSD1",72,0)
 .S X=$P(WT,"^",8),Y=$J(X/2.2,0,2),$P(WT,"^",9)=Y,X=$P(HT,"^",8),Y=$J(2.54*X,0,2),$P(HT,"^",9)=Y
"RTN","PSOSD1",73,0)
 W !!,"WEIGHT(Kg): " W:+$P(WT,"^",8) $P(WT,"^",9)_" ("_$P(WT,"^")_")" W ?41,"HEIGHT(cm): " W:$P(HT,"^",8) $P(HT,"^",9)_" ("_$P(HT,"^")_")" K VM,WT,HT
"RTN","PSOSD1",74,0)
 D GMRA^PSODEM W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1),!,"Instructions to the provider:",!,"A prescription blank (VA FORM 10-2577f) must be used for All Class II NARCOTICS."
"RTN","PSOSD1",75,0)
 S (ELN,LN,LINE)="",$P(LN,"_",53)="",$P(LINE,"-",132)=""
"RTN","PSOSD1",76,0)
 W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1),!?4,"OTHER MEDICATIONS:",!
"RTN","PSOSD1",77,0)
 Q
"RTN","PSOSD1",78,0)
LM ;prints AP from listamn action
"RTN","PSOSD1",79,0)
 S X=$$SITE^VASITE,PSOINST=$P(X,"^",3) K X
"RTN","PSOSD1",80,0)
 K DIR S DIR("A")="Action or Informational (A or I): ",DIR("?",1)="Enter 'A' for action profile",DIR("?",2)="      'I' for informational profile",DIR("?")="      'E' to EXIT process",DIR("B")="A",DIR(0)="SAM^1:Action;0:Informational;E:Exit"
"RTN","PSOSD1",81,0)
 D ^DIR K DIR Q:Y="E"!($D(DIRUT))  S PSTYPE=Y,LM=1
"RTN","PSOSD1",82,0)
 I '$P($G(PSOSYS),"^",6) S PSOPOL=0 G ASK
"RTN","PSOSD1",83,0)
 K DIR S DIR("A")="Do you want generate a Polypharmacy report?: ",DIR("?",1)="Enter 'Y' to generate report",DIR("?",2)="      'N' if you do not want the report",DIR("?")="      'E' to EXIT process",DIR("B")="NO",DIR(0)="SA^1:YES;0:NO;E:Exit"
"RTN","PSOSD1",84,0)
 D ^DIR S PSOPOL=$S(Y:1,1:0) G:Y="E"!($D(DIRUT)) EXIT G:'PSOPOL ASK
"RTN","PSOSD1",85,0)
 K DIR S DIR("A")="Minimum Number of Active Prescriptions",DIR("B")=7,DIR(0)="N^1:100:0" D ^DIR S PSONUM=Y G:$D(DIRUT) EXIT
"RTN","PSOSD1",86,0)
 K DIR,DTOUT,DIRUT,DUOUT S DIR("A")="Do you want this Profile to print in 132 columns or 80 columns: ",DIR("B")="132",DIR(0)="SAM^1:132;8:80;E:Exit"
"RTN","PSOSD1",87,0)
 D ^DIR G:Y="E"!($D(DUOUT))!($D(DIRUT)) EXIT S PSORM=$S(Y=1:1,1:0) K DIR,X,Y
"RTN","PSOSD1",88,0)
ASK D DAYS S PRF=PSODFN_"," D DEV I $D(ZTSK) S VALMSG="Action Profile Queued to Printer."
"RTN","PSOSD1",89,0)
 D EXIT K LM
"RTN","PSOSD1",90,0)
 Q
"RTN","PSOSD1",91,0)
 ;
"RTN","PSOSD1",92,0)
CHECKBAI ;
"RTN","PSOSD1",93,0)
 N PSOBADR
"RTN","PSOSD1",94,0)
 S PSOBADR=$$BADADR^DGUTL3(DFN)
"RTN","PSOSD1",95,0)
 I 'PSOBADR W " " Q
"RTN","PSOSD1",96,0)
 W ?40,"** BAD ADDRESS INDICATED-(",$S(PSOBADR=1:"UNDELIVERABLE",PSOBADR=2:"HOMELESS",1:"OTHER"),")",!
"RTN","PSOSD1",97,0)
         Q
"RTN","PSOSD1",98,0)
 ;
"RTN","PSOSD2")
0^19^B31994464^B32008884
"RTN","PSOSD2",1,0)
PSOSD2 ;BHAM ISC/SAB - action or informational profile cont. ;3/24/93
"RTN","PSOSD2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,19,107,110,176,233**;DEC 1997;Build 8
"RTN","PSOSD2",3,0)
 ;External reference to ^PS(59.7 is supported by DBIA 694
"RTN","PSOSD2",4,0)
 ;
"RTN","PSOSD2",5,0)
1 W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1),!
"RTN","PSOSD2",6,0)
 W !,"Instructions to the provider:"
"RTN","PSOSD2",7,0)
 W !,"   A. A prescription blank (VA FORM 10-2577f) must be used for the"
"RTN","PSOSD2",8,0)
 W !,"      following: 1) any new medication"
"RTN","PSOSD2",9,0)
 W !,"                 2) any changes in dosage, direction or quantity"
"RTN","PSOSD2",10,0)
 W !,"                 3) all class II narcotics."
"RTN","PSOSD2",11,0)
 W !,"   B. To continue a medication as printed:"
"RTN","PSOSD2",12,0)
 W !,"      1.  If ""Remaining Refills"" are sufficient to complete"
"RTN","PSOSD2",13,0)
 W !,"          therapy or last until next scheduled clinic appointment,"
"RTN","PSOSD2",14,0)
 W !,"          no action is required."
"RTN","PSOSD2",15,0)
 W !,"      2.  If ""Remaining Refills"" are not sufficient to complete"
"RTN","PSOSD2",16,0)
 W !,"          therapy or last until next scheduled clinic appointment,"
"RTN","PSOSD2",17,0)
 W !,"          sign ""RENEW/MD"" line, enter VA# and date, and circle"
"RTN","PSOSD2",18,0)
 W !,"          total number of refills needed.  This action creates a"
"RTN","PSOSD2",19,0)
 W !,"          new prescription with refills as indicated."
"RTN","PSOSD2",20,0)
 W !,"   C. To discontinue a medication, sign DISCONTINUE/MD line and enter VA# and",@$S(PSORM:"?$X+1",1:"!?6"),"date."
"RTN","PSOSD2",21,0)
 W !,"   D. Any medications not acted upon will continue to be available"
"RTN","PSOSD2",22,0)
 W !,"      to the patient until all refills are used or until expiration."
"RTN","PSOSD2",23,0)
 W !!,"  NOTE: '(R)' indicates a fill was returned to stock."
"RTN","PSOSD2",24,0)
 Q
"RTN","PSOSD2",25,0)
 ;
"RTN","PSOSD2",26,0)
HD S:'$D(PSORM) PSORM=1 N K S FN=DFN
"RTN","PSOSD2",27,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9):"Temporary ",1:"")
"RTN","PSOSD2",28,0)
 I $G(^TMP($J,DFN)),$D(CLINICX) D ^PSOSDP
"RTN","PSOSD2",29,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2)
"RTN","PSOSD2",30,0)
 I '$D(PSOBAR0)!('$D(PSOBAR1)) S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSOSD2",31,0)
 S PSOBAR2=PSOBAR0,PSOBAR3=PSOBAR1
"RTN","PSOSD2",32,0)
 S PSOBAR4=$G(PSOBAR3)]""&($G(PSOBAR2)]"")&(+$P($G(PSOPAR),"^"))
"RTN","PSOSD2",33,0)
HD1 S RXCNT=0 I $E(IOST)="C",'PSTYPE K DIR S DIR(0)="E",DIR("A")="Press Return to Continue or ""^"" to Exit" D ^DIR Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOSD2",34,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9):"Temporary ",1:"")
"RTN","PSOSD2",35,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2)
"RTN","PSOSD2",36,0)
 I $D(IOF) W @IOF
"RTN","PSOSD2",37,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9):"Temporary ",1:"")
"RTN","PSOSD2",38,0)
 U IO
"RTN","PSOSD2",39,0)
 W $S(PSTYPE:"Action",1:"Informational")_" Rx Profile",?47,"Run Date: " S Y=DT D DT^DIO2 W ?71,"Page: "_PAGE
"RTN","PSOSD2",40,0)
 W !,"Sorted by drug classification for Rx's currently active"_$S('PSDAYS:" only.",1:"") W:PSDAYS !,"and for those Rx's that have been inactive less than "_PSDAYS_" days."
"RTN","PSOSD2",41,0)
 S X=$$SITE^VASITE
"RTN","PSOSD2",42,0)
 W @$S(PSORM:"?70",1:"!"),"Site: VAMC "_$P(X,"^",2)_" ("_$P(X,"^",3)_")",!,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSD2",43,0)
 I $P(VAIN(4),"^",2)]"",+$P($G(^PS(59.7,1,40.1)),"^") W !,"Outpatient prescriptions are discontinued 72 hours after admission.",!
"RTN","PSOSD2",44,0)
 I $D(CLINICX) W !?1,"Clinic: ",$E(CLINICX,1,28),?45,"Date/Time: " S Y=CLDT D DT^DIO2
"RTN","PSOSD2",45,0)
 W !?1,"Name  : ",PSNAME,?30,"ID#: "_PSSN W:PSTYPE ?58,"Action Date: ________" W !?1,"DOB   : "_PSDOB
"RTN","PSOSD2",46,0)
 W:ADDRFL]"" ?30,ADDRFL,! W ?30,"Address  :"
"RTN","PSOSD2",47,0)
 I $G(ADDRFL)="" D CHECKBAI^PSOSD1
"RTN","PSOSD2",48,0)
 W ?41,VAPA(1) W:VAPA(2)]"" !?41,VAPA(2) W:VAPA(3)]"" !?41,VAPA(3)
"RTN","PSOSD2",49,0)
 W !?41,VAPA(4)_", "_$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6)),!?30,"Phone    : "_VAPA(8)
"RTN","PSOSD2",50,0)
 I PSOBAR4 S X="S",X2=PSSN W @$S('PSORM:"!?30",1:"?$X+5") S X1=$X W @PSOBAR3,X2,@PSOBAR2,$C(13) S $X=0
"RTN","PSOSD2",51,0)
 W:$G(DOD(DFN))]"" ?1,"**** Date of Death: "_DOD(DFN)_" ****",!
"RTN","PSOSD2",52,0)
 D:'$D(HDFL)
"RTN","PSOSD2",53,0)
 .K DIRUT,DIR,DUOUT,DTOUT D:'$G(CLAPP) RE^PSODEM Q:$D(DIRUT)
"RTN","PSOSD2",54,0)
 .I $Y+15>IOSL,$E(IOST)="C" K DIR S DIR(0)="E" D ^DIR K DIR,DUOUT,DTOUT
"RTN","PSOSD2",55,0)
 .Q:$D(DIRUT)
"RTN","PSOSD2",56,0)
 .K ^UTILITY("VASD",$J),VASD S VASD("F")=DT,VASD("T")=9999999,VASD("W")="123456789" D:$G(DFN)&('$G(CLAPP)) SDA^VADPT K VASD I '$G(CLAPP)&($D(^UTILITY("VASD",$J))) D  S CLAPP=1 D HD:$G(^TMP($J,DFN))'<$G(PSONUM)&($G(PSOPOL))
"RTN","PSOSD2",57,0)
 ..W:$E(IOST)="C" @IOF
"RTN","PSOSD2",58,0)
 ..W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSD2",59,0)
 ..S FA=DT W !!,"Pending Outpatient Clinic Appointments:"
"RTN","PSOSD2",60,0)
 ..F PSOACPP=0:0 S PSOACPP=$O(^UTILITY("VASD",$J,PSOACPP)) Q:'PSOACPP  S PSOACPPE=$G(^UTILITY("VASD",$J,PSOACPP,"E")),PSOACPPI=$G(^("I")) W !?11,$P(PSOACPPE,"^"),?35,$P(PSOACPPE,"^",2) D CAPP
"RTN","PSOSD2",61,0)
 ..I $E(IOST)="C" K DIR,DIRUT,DTOUT S DIR(0)="E" D ^DIR K DIR
"RTN","PSOSD2",62,0)
 .E  D:$G(PAGE)>1&('$G(PSOPOL))
"RTN","PSOSD2",63,0)
 ..S (WT,HT)="",X="GMRVUTL" X ^%ZOSF("TEST") I $T D
"RTN","PSOSD2",64,0)
 ...F GMRVSTR="WT","HT" S VM=GMRVSTR D EN6^GMRVUTL S @VM=X,$P(@VM,"^")=$E($P(@VM,"^"),4,5)_"/"_$E($P(@VM,"^"),6,7)_"/"_($E($P(@VM,"^"),1,3)+1700)
"RTN","PSOSD2",65,0)
 ...S X=$P(WT,"^",8),Y=$J(X/2.2,0,2),$P(WT,"^",9)=Y,X=$P(HT,"^",8),Y=$J(2.54*X,0,2),$P(HT,"^",9)=Y
"RTN","PSOSD2",66,0)
 ..W !!,"WEIGHT(Kg): " W:+$P(WT,"^",8) $P(WT,"^",9)_" ("_$P(WT,"^")_")" W ?41,"HEIGHT(cm): " W:$P(HT,"^",8) $P(HT,"^",9)_" ("_$P(HT,"^")_")" K VM,WT,HT
"RTN","PSOSD2",67,0)
 D:$D(DIRUT) KLCL Q:$D(DIRUT)  S PAGE=PAGE+1 I $D(^UTILITY("VASD",$J)),PAGE=2!($G(PSOPOLP)) D KLCL S PSOPOLP=0 D HD Q
"RTN","PSOSD2",68,0)
 D KLCL I PSTYPE,'$D(HDFL) D 1 S HDFL=""
"RTN","PSOSD2",69,0)
 W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1),!,"Medication/Supply" Q:'PSORM
"RTN","PSOSD2",70,0)
 W ?74,"Rx#",?85,"Status",?98,"Expiration",?110,"Provider",!,?101,"Date"
"RTN","PSOSD2",71,0)
 Q
"RTN","PSOSD2",72,0)
 ;
"RTN","PSOSD2",73,0)
CAPP ;
"RTN","PSOSD2",74,0)
 K X S X2=DT,X1=$P($P($G(PSOACPPI),"^"),".") I $G(X1) D ^%DTC
"RTN","PSOSD2",75,0)
 W $S($P(PSOACPPI,"^",3)["C":"   *** Canceled ***",1:" ("_$G(X)_" days)")
"RTN","PSOSD2",76,0)
 Q
"RTN","PSOSD2",77,0)
PSRENW D:'$G(PSODTCUT) CUTDATE^PSOFUNC I $P(RX2,"^",6)<PSODTCUT S PSRENW=0 G LN
"RTN","PSOSD2",78,0)
 I $E($P(RX0,"^",15))="D",$P(RX3,"^",5)<PSODTCUT,$P(^PSRX(RXNO,"STA"),"^")=12 S PSRENW=0 G LN
"RTN","PSOSD2",79,0)
 I $E($P(RX0,"^",15))="D",$P(^PSRX(RXNO,"STA"),"^")'=12 S PSRENW=0
"RTN","PSOSD2",80,0)
LN S CS=0 F DEA=1:1 Q:$E(PSODEA,DEA)=""  I $E(+PSODEA,DEA)>2,$E(+PSODEA,DEA)<6 S CS=1
"RTN","PSOSD2",81,0)
 K DEA,PSODEA Q
"RTN","PSOSD2",82,0)
KLCL K ^UTILITY("VASD",$J),PSOACPPI,PSOACPPE,PSOACPP Q
"RTN","PSOSD3")
0^20^B40297338^B40259023
"RTN","PSOSD3",1,0)
PSOSD3 ;BHAM ISC/RTR - Prints pending orders on action profile ;11/20/95
"RTN","PSOSD3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,19,107,110,132,233**;DEC 1997;Build 8
"RTN","PSOSD3",3,0)
 ;External reference ^PS(50.7 - 2223
"RTN","PSOSD3",4,0)
 ;External reference ^PS(50.606 - 2174
"RTN","PSOSD3",5,0)
 ;External reference ^PSDRUG( - 221
"RTN","PSOSD3",6,0)
 ;External reference ^PS(59.7 - 694
"RTN","PSOSD3",7,0)
 ;External reference to ^PS(55 - 2228
"RTN","PSOSD3",8,0)
 ;
"RTN","PSOSD3",9,0)
START Q:$D(DUOUT)!($D(DTOUT))!('$G(DFN))
"RTN","PSOSD3",10,0)
 N MMM,PNDIS,PNDLINE,PNDREX,PNPOI,PPPP,PSOPRVD,PSCONT,PSOEFF,PSOQTY,PSOREFLS,PZSTAT,WWW
"RTN","PSOSD3",11,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9):"Temporary ",1:"")
"RTN","PSOSD3",12,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2)
"RTN","PSOSD3",13,0)
 K ^TMP($J,"PSOPEND") S $P(PNDLINE,"-",33)=""
"RTN","PSOSD3",14,0)
 S PSCONT=1 F MMM=0:0 S MMM=$O(^PS(52.41,"P",DFN,MMM)) Q:'MMM  S PZSTAT=$P($G(^PS(52.41,MMM,0)),"^",3) I PZSTAT="NW"!(PZSTAT="HD")!(PZSTAT="RNW") D
"RTN","PSOSD3",15,0)
 .S ^TMP($J,"PSOPEND",PSCONT)=MMM_"^"_$S(+$P($G(^PS(52.41,MMM,0)),"^",9):"DD",1:"OI") S PSCONT=PSCONT+1
"RTN","PSOSD3",16,0)
 I $Y+6>IOSL D HD1 S:$D(DTOUT)!($D(DUOUT)) PSQFLG=1 G:$G(PSQFLG) END
"RTN","PSOSD3",17,0)
 D HD
"RTN","PSOSD3",18,0)
 I PSCONT=1 W !?10,"No pending orders for this patient!",! G END
"RTN","PSOSD3",19,0)
 F WWW=0:0 S WWW=$O(^TMP($J,"PSOPEND",WWW)) Q:'WWW!($G(PSQFLG))  D
"RTN","PSOSD3",20,0)
 .S PNDREX=$P(^TMP($J,"PSOPEND",WWW),"^"),PNDIS=$P($G(^PS(52.41,PNDREX,0)),"^",9),PNPOI=$P($G(^(0)),"^",8),PSOEFF=$P($G(^(0)),"^",6),PSOQTY=$P($G(^(0)),"^",10),PSOREFLS=$P($G(^(0)),"^",11),PSOPRVD=$P($G(^(0)),"^",5)
"RTN","PSOSD3",21,0)
 .W !,"Drug: ",$S($P(^TMP($J,"PSOPEND",WWW),"^",2)="DD":$P($G(^PSDRUG(+PNDIS,0)),"^"),1:$P($G(^PS(50.7,+PNPOI,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^")),!
"RTN","PSOSD3",22,0)
 .W ?1,"Eff. Date: ",$E(PSOEFF,4,5)_"-"_$E(PSOEFF,6,7)_"-"_($E(PSOEFF,1,3)+1700),?22,"Qty: ",PSOQTY,?40,"Refills: ",PSOREFLS,?52,"Prov: ",$E($P($G(^VA(200,+PSOPRVD,0)),"^"),1,21)
"RTN","PSOSD3",23,0)
 .S PSCONT=1 W !?1,"Sig: " F PPPP=0:0 S PPPP=$O(^PS(52.41,PNDREX,"SIG",PPPP)) Q:'PPPP!($G(PSQFLG))  W:PSCONT>1 ! W ?6,$G(^PS(52.41,PNDREX,"SIG",PPPP,0)) S PSCONT=PSCONT+1
"RTN","PSOSD3",24,0)
 .I $E(IOST)'="C" W !
"RTN","PSOSD3",25,0)
 .I $E(IOST)="C" D HD1 S:$D(DUOUT)!($D(DTOUT)) PSQFLG=1 Q:$G(PSQFLG)  D HD
"RTN","PSOSD3",26,0)
 .I $E(IOST)'="C" I $Y+9>IOSL D HD1 S:$D(DUOUT)!($D(DTOUT)) PSQFLG=1 Q:$G(PSQFLG)  D HD
"RTN","PSOSD3",27,0)
END K ^TMP($J,"PSOPEND") Q
"RTN","PSOSD3",28,0)
HD W !,PNDLINE,"PENDING ORDERS",PNDLINE,! Q
"RTN","PSOSD3",29,0)
 ;
"RTN","PSOSD3",30,0)
HD1 S FN=DFN
"RTN","PSOSD3",31,0)
 I $E(IOST)="C" K DIR S DIR(0)="E",DIR("A")="Press Return to Continue or ""^"" to Exit" D ^DIR Q:$D(DUOUT)!($D(DTOUT))
"RTN","PSOSD3",32,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9):"Temporary ",1:"")
"RTN","PSOSD3",33,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2)
"RTN","PSOSD3",34,0)
 I $D(IOF) W @IOF
"RTN","PSOSD3",35,0)
 W $S(PSTYPE:"Action",1:"Informational")_" Rx Profile",?47,"Run Date: " S Y=DT D DT^DIO2 W ?71,"Page: "_PAGE
"RTN","PSOSD3",36,0)
 W !,"Sorted by drug classification for Rx's currently active"_$S('PSDAYS:" only.",1:"") W:PSDAYS !,"and for those Rx's that have been inactive less than "_PSDAYS_" days."
"RTN","PSOSD3",37,0)
 S X=$$SITE^VASITE
"RTN","PSOSD3",38,0)
 W @$S(PSORM:"?70",1:"!"),"Site: VAMC "_$P(X,"^",2)_" ("_$P(X,"^",3)_")",!,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSD3",39,0)
 I $P(VAIN(4),"^",2)]"",+$P($G(^PS(59.7,1,40.1)),"^") W !,"Outpatient prescriptions are discontinued 72 hours after admission.",!
"RTN","PSOSD3",40,0)
 I $D(CLINICX) W !?1,"Clinic: "_$E(CLINICX,1,28),?45,"Date/Time: " S Y=CLDT D DT^DIO2
"RTN","PSOSD3",41,0)
 W !?1,"Name  : ",PSNAME,?30,"ID#: "_PSSN W:PSTYPE ?58,"Action Date: ________" W !?1,"DOB   : "_PSDOB
"RTN","PSOSD3",42,0)
 W:ADDRFL]"" ?30,ADDRFL,! W ?30,"Address  :"
"RTN","PSOSD3",43,0)
 I $G(ADDRFL)="" D CHECKBAI^PSOSD1
"RTN","PSOSD3",44,0)
 W ?41,VAPA(1) W:VAPA(2)]"" !?41,VAPA(2) W:VAPA(3)]"" !?41,VAPA(3)
"RTN","PSOSD3",45,0)
 W !?41,VAPA(4)_", "_$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6)),!?30,"Phone    : "_VAPA(8)
"RTN","PSOSD3",46,0)
 I PSOBAR4 S X="S",X2=PSSN W @$S('PSORM:"!?30",1:"?$X+5") S X1=$X W @PSOBAR3,X2,@PSOBAR2,$C(13) S $X=0
"RTN","PSOSD3",47,0)
 W:$G(DOD(DFN))]"" ?1,"**** Date of Death: "_DOD(DFN)_" ****",!
"RTN","PSOSD3",48,0)
 S (WT,HT)="",X="GMRVUTL" X ^%ZOSF("TEST") I $T D
"RTN","PSOSD3",49,0)
 .F GMRVSTR="WT","HT" S VM=GMRVSTR D EN6^GMRVUTL S @VM=X,$P(@VM,"^")=$E($P(@VM,"^"),4,5)_"/"_$E($P(@VM,"^"),6,7)_"/"_($E($P(@VM,"^"),1,3)+1700)
"RTN","PSOSD3",50,0)
 .S X=$P(WT,"^",8),Y=$J(X/2.2,0,2),WT=WT_"^"_Y,X=$P(HT,"^",8),Y=$J(2.54*X,0,2),HT=HT_"^"_Y
"RTN","PSOSD3",51,0)
 W !!,"WEIGHT(Kg): " W:+$P(WT,"^",8) $P(WT,"^",9)_" ("_$P(WT,"^")_")" W ?41,"HEIGHT(cm): " W:$P(HT,"^",8) $P(HT,"^",9)_" ("_$P(HT,"^")_")" K VM,WT,HT
"RTN","PSOSD3",52,0)
 S PAGE=PAGE+1 W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSD3",53,0)
 Q
"RTN","PSOSD3",54,0)
NVA ;displays non-va meds
"RTN","PSOSD3",55,0)
 Q:'$O(^PS(55,DFN,"NVA",0))
"RTN","PSOSD3",56,0)
 Q:$D(DUOUT)!($D(DTOUT))!('$G(DFN))
"RTN","PSOSD3",57,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9):"Temporary ",1:"")
"RTN","PSOSD3",58,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2),$P(PNDLINE,"-",IOM)="",PSODFN=DFN
"RTN","PSOSD3",59,0)
 D HD1 W !,PNDLINE,!?25,"Non-VA Meds (Not dispensed by VA)",!,PNDLINE,!
"RTN","PSOSD3",60,0)
 F NVA=0:0 S NVA=$O(^PS(55,DFN,"NVA",NVA)) Q:'NVA  D  Q:$G(PSQFLG)
"RTN","PSOSD3",61,0)
 .I $Y+6>IOSL D HD1 S:$D(DTOUT)!($D(DUOUT)) PSQFLG=1 Q:$G(PSQFLG)
"RTN","PSOSD3",62,0)
 .Q:'$P(^PS(55,PSODFN,"NVA",NVA,0),"^")
"RTN","PSOSD3",63,0)
 .S DUPRX0=^PS(55,PSODFN,"NVA",NVA,0)
"RTN","PSOSD3",64,0)
 .W !,"Orderable Item: "_$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSOSD3",65,0)
 .W !,"Drug: "_$S($P(DUPRX0,"^",2):$P(^PSDRUG($P(DUPRX0,"^",2),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSOSD3",66,0)
 .W !,"Status: "_$S($P(DUPRX0,"^",7):"Discontinued ("_$$FMTE^XLFDT($P($P(DUPRX0,"^",7),"."))_")",1:"Active")
"RTN","PSOSD3",67,0)
 .W !,"Dosage: "_$P(DUPRX0,"^",3)
"RTN","PSOSD3",68,0)
 .W !,"Schedule: "_$P(DUPRX0,"^",5),!,"Route: "_$P(DUPRX0,"^",4)
"RTN","PSOSD3",69,0)
 .W !,"Start Date: "_$$FMTE^XLFDT($P(DUPRX0,"^",9)),?40,"CPRS Oder #: "_$P(DUPRX0,"^",8)
"RTN","PSOSD3",70,0)
 .W !,"Documented By: "_$P(^VA(200,$P(DUPRX0,"^",11),0),"^")_" on "_$$FMTE^XLFDT($P(DUPRX0,"^",10))
"RTN","PSOSD3",71,0)
 .S RMLEN=$S('PSORM:75,1:IOM-5)
"RTN","PSOSD3",72,0)
 .F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",NVA,"OCK",I)) Q:'I  D  W !
"RTN","PSOSD3",73,0)
 ..S ORD=$P(^PS(55,PSODFN,"NVA",NVA,"OCK",I,0),"^"),ORP=$P(^(0),"^",2)
"RTN","PSOSD3",74,0)
 ..W !,"Order Check #"_I_": "
"RTN","PSOSD3",75,0)
 ..K OCK,LEN I $L(ORD)>RMLEN S (LEN,IEN)=1 D
"RTN","PSOSD3",76,0)
 ...F SG=1:1:$L(ORD) S:$L($G(OCK(IEN))_" "_$P(ORD," ",SG))>RMLEN&($P(ORD," ",SG)]"") IEN=IEN+1 S:$P(ORD," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(ORD," ",SG)
"RTN","PSOSD3",77,0)
 ...F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSOSD3",78,0)
 ..W:'$G(LEN) ORD K LEN,SG,IEN,II,OCK,ORD
"RTN","PSOSD3",79,0)
 ..W !,"Overriding Provider: "_$S($G(ORP):$P(^VA(200,ORP,0),"^"),1:"")
"RTN","PSOSD3",80,0)
 ..K ORP,OCK,REA W !,"Reason:" F SS=0:0 S SS=$O(^PS(55,PSODFN,"NVA",NVA,"OCK",I,"OVR",SS)) Q:'SS  S REA(SS)=^PS(55,PSODFN,"NVA",NVA,"OCK",I,"OVR",SS,0)
"RTN","PSOSD3",81,0)
 ..S IEN=1 F II=0:0 S II=$O(REA(II)) Q:'II  D
"RTN","PSOSD3",82,0)
 ...F SG=1:1:$L(REA(II)) S:$L($G(OCK(IEN))_" "_$P(REA(II)," ",SG))>RMLEN&($P(REA(II)," ",SG)]"") IEN=IEN+1 S:$P(REA(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(REA(II)," ",SG)
"RTN","PSOSD3",83,0)
 ...K REA,IEN,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W OCK(II) I $O(OCK(II)) W !?5
"RTN","PSOSD3",84,0)
 .K OCK W !,"Statement/Explanation/Comments:" F SS=0:0 S SS=$O(^PS(55,PSODFN,"NVA",NVA,"DSC",SS)) Q:'SS  S DSC(SS)=^PS(55,PSODFN,"NVA",NVA,"DSC",SS,0)
"RTN","PSOSD3",85,0)
 .S IEN=1 F II=0:0 S II=$O(DSC(II)) Q:'II  D
"RTN","PSOSD3",86,0)
 ..F SG=1:1:$L(DSC(II)) S:$L($G(OCK(IEN))_" "_$P(DSC(II)," ",SG))>RMLEN&($P(DSC(II)," ",SG)]"") IEN=IEN+1 S:$P(DSC(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(DSC(II)," ",SG)
"RTN","PSOSD3",87,0)
 .K IEN,DSC,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSOSD3",88,0)
 .W !! I $E(IOST)'="C" W !
"RTN","PSOSD3",89,0)
 K RMLEN
"RTN","PSOSD3",90,0)
 Q
"RTN","PSOSDP")
0^21^B31980684^B31757521
"RTN","PSOSDP",1,0)
PSOSDP ;BHAM ISC/SAB - poly pharmacy report attached to action/info profile ;12/13/93 8:24
"RTN","PSOSDP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,17,19,107,110,155,176,233**;DEC 1997;Build 8
"RTN","PSOSDP",3,0)
 ;called from PSOSD
"RTN","PSOSDP",4,0)
 Q:+$G(^TMP($J,DFN))<PSONUM!($G(DOD(DFN))]"")  S DRG="",P=0,PSOPOLP=0 D HD K SGY
"RTN","PSOSDP",5,0)
 F  S DRG=$O(^TMP($J,DFN,DRG)) Q:DRG=""  F  S P=$O(^TMP($J,DFN,DRG,P)) Q:'P  I $G(^PSRX(P,0))]"" S RX0=^PSRX(P,0),RX2=$G(^(2)),RX3=$G(^(3)) D  K SGY
"RTN","PSOSDP",6,0)
 .I $Y+6>IOSL D FT,HD
"RTN","PSOSDP",7,0)
 .S SIG=$P($G(^PSRX(P,"SIG")),"^") W !?10,"* "_$E(DRG,1,40),?52 D SIG W $G(BSIG(1)),?79,"*"
"RTN","PSOSDP",8,0)
 .;F PSOGY=2:1 Q:$G(SGY(PSOGY))=""  W !?10,"*",?52,SGY(PSOGY),?79,"*" I $Y+4>IOSL,$O(SGY(PSOGY)) D FT,HD
"RTN","PSOSDP",9,0)
 .I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?10,"*",?52,$G(BSIG(PSREV)),?79,"*" I $Y+4>IOSL,$O(BSIG(PSREV)) D FT,HD
"RTN","PSOSDP",10,0)
 .K BSIG,PSREV
"RTN","PSOSDP",11,0)
 D FT K PSOGY
"RTN","PSOSDP",12,0)
 Q
"RTN","PSOSDP",13,0)
SIG K FSIG,BSIG I $P($G(^PSRX(P,"SIG")),"^",2) D FSIG^PSOUTLA("R",P,26) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSOSDP",14,0)
 K FSIG,PSREV I '$P($G(^PSRX(P,"SIG")),"^",2) D EN3^PSOUTLA1(P,26)
"RTN","PSOSDP",15,0)
 Q
"RTN","PSOSDP",16,0)
HD S FN=DFN
"RTN","PSOSDP",17,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9):"Temporary ",1:"")
"RTN","PSOSDP",18,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2)
"RTN","PSOSDP",19,0)
 W @IOF,!,"Polypharmacy Rx Profile Review",?47,"Run Date: " S Y=DT D DT^DIO2 W ?71,"Page: "_PAGE S PAGE=PAGE+1,X=$$SITE^VASITE
"RTN","PSOSDP",20,0)
 W !,"Sorted by drug name for Rx's currently active",@$S(PSORM:"?70",1:"!"),"Site: VAMC "_$P(X,"^",2)_"( "_$P(X,"^",3)_")",!,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSDP",21,0)
 I $D(CLINICX) W !?1,"Clinic: ",$E(CLINICX,1,28),?45,"Date/Time: " S Y=CLDT D DT^DIO2
"RTN","PSOSDP",22,0)
 W !?1,"Name  : ",PSNAME,?30,"ID#: "_PSSN W ?58,"Review Date: ________" W !?1,"DOB   : "_PSDOB
"RTN","PSOSDP",23,0)
 W:ADDRFL]"" ?30,ADDRFL,! W ?30,"Address  :"
"RTN","PSOSDP",24,0)
 I ADDRFL="" D CHECKBAI^PSOSD1
"RTN","PSOSDP",25,0)
 W ?41,VAPA(1) W:VAPA(2)]"" !?41,VAPA(2) W:VAPA(3)]"" !?41,VAPA(3) W !?41,VAPA(4)_", "_$P(VAPA(5),"^",2)_"  "_VAPA(6),!?30,"Phone    : "_VAPA(8)
"RTN","PSOSDP",26,0)
 S PSOBAR2=PSOBAR0,PSOBAR3=PSOBAR1
"RTN","PSOSDP",27,0)
 S PSOBAR4=$G(PSOBAR3)]""&($G(PSOBAR2)]"")&(+$P($G(PSOPAR),"^"))
"RTN","PSOSDP",28,0)
 I PSOBAR4 S X="S",X2=PSSN W @$S('PSORM:"!?30",1:"?$X+5") S X1=$X W @PSOBAR3,X2,@PSOBAR2,$C(13) S $X=0
"RTN","PSOSDP",29,0)
 F GMRVSTR="WT","HT" S VM=GMRVSTR D EN6^GMRVUTL S @VM=X,$P(@VM,"^")=$E($P(@VM,"^"),4,5)_"/"_$E($P(@VM,"^"),6,7)_"/"_($E($P(@VM,"^"),1,3)+1700)
"RTN","PSOSDP",30,0)
 S X=$P(WT,"^",8),Y=$J(X/2.2,0,2),WT=WT_"^"_Y,X=$P(HT,"^",8),Y=$J(2.54*X,0,2),HT=HT_"^"_Y
"RTN","PSOSDP",31,0)
 W !?1,"WEIGHT(Kg): " W:+$P(WT,"^",8) $P(WT,"^",9)_" ("_$P(WT,"^")_")" W ?41,"HEIGHT(cm): " W:$P(HT,"^",8) $P(HT,"^",9)_" ("_$P(HT,"^")_")" K VM,WT,HT
"RTN","PSOSDP",32,0)
 W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1),!!!?10 F I=1:1:70 W "*"
"RTN","PSOSDP",33,0)
 W !?10,"*",?35,"POLYPHARMACY REVIEW",?79,"*",!?10,"*",?79,"*",!?10,"* Patient:  "_PSNAME,?50,"(ID#: "_VA("PID")_")",?79,"*"
"RTN","PSOSDP",34,0)
 W !?10,"* is identified as having "_PSONUM_" or more active prescriptions",?79,"*",!?10,"* for drugs (excluding supplies).  To avoid unnecessary",?79,"*"
"RTN","PSOSDP",35,0)
 W !?10,"* medications, please review these to ensure that each one",?79,"*",!?10,"* is essential.  Unnecessary medications may be discontinued on",?79,"*"
"RTN","PSOSDP",36,0)
 W !?10,"* the attached Action Profile.",?79,"*",!?10,"*",?79,"*",!?10,"* I have reviewed the medications below and have taken",?79,"*",!?10,"* actions to discontinue those that are no longer required.",?79,"*"
"RTN","PSOSDP",37,0)
 F I=1:1:3 W !?10,"*",?79,"*"
"RTN","PSOSDP",38,0)
 W !?10,"*",?25 F I=1:1:35 W "_"
"RTN","PSOSDP",39,0)
 W ?79,"*",!?10,"*",?25,"(Signature)",?79,"*" F I=1:1:2 W !?10,"*",?79,"*"
"RTN","PSOSDP",40,0)
 W !?10,"*",?25,"Drugs ("_^TMP($J,DFN)_")",?60,"SIG",?79,"*"
"RTN","PSOSDP",41,0)
 W !?10,"* " F I=1:1:30 W "-"
"RTN","PSOSDP",42,0)
 W ?52 F I=1:1:20 W "-"
"RTN","PSOSDP",43,0)
 W ?79,"*"
"RTN","PSOSDP",44,0)
 Q
"RTN","PSOSDP",45,0)
FT W !?10 F I=1:1:70 W "*"
"RTN","PSOSDP",46,0)
 Q
"RTN","PSOSDP",47,0)
CLSG ;clinic group sort and print
"RTN","PSOSDP",48,0)
 S CLSP=1,DIC("A")="Select Clinic Sort Group: "
"RTN","PSOSDP",49,0)
 S DIC="^PS(59.8,",DIC(0)="AEQM" D ^DIC G:"^"[X EXIT^PSOSD G:Y<0 CLSG
"RTN","PSOSDP",50,0)
 S CLSG=+Y
"RTN","PSOSDP",51,0)
 I '$O(^PS(59.8,CLSG,1,0)) W !!,$C(7),"There are no clinics defined for this Clinic Group!",!,$C(7) G CLSG
"RTN","PSOSDP",52,0)
 S %DT="AEFX",%DT("A")="FOR DATE: " D ^%DT G:"^"[X EXIT^PSOSD G CLSG:Y<0 S (APCLDT,CLDT)=Y,$P(LINE,"-",132)="-"
"RTN","PSOSDP",53,0)
 D DAYS^PSOSD1 G:$D(DIRUT) EXIT S X1=DT,X2=-PSDAYS D C^%DTC S PSDATE=X S PSTYPE=$S($D(PSTYPE):PSTYPE,1:0)
"RTN","PSOSDP",54,0)
 K %DT,%ZIS,IOP,ZTSK,ZTQUEUED S PSOION=ION,%ZIS="QM",%ZIS("B")="",%ZIS("A")=$S(PSTYPE:"Select a Printer: ",1:"DEVICE: ")
"RTN","PSOSDP",55,0)
 S %ZIS("S")=$S(PSTYPE:"I $E($G(^%ZIS(2,+$G(^(""SUBTYPE"")),0)),1)=""P""",1:"")
"RTN","PSOSDP",56,0)
 N PSOBARS,PSOBAR0,PSOBAR1
"RTN","PSOSDP",57,0)
 D ^%ZIS I POP S IOP=PSOION K PSOION G EXIT
"RTN","PSOSDP",58,0)
 S APRT=ION ;D ^%ZISC
"RTN","PSOSDP",59,0)
 K DTOUT,DIR,DIRUT
"RTN","PSOSDP",60,0)
 ;S DIR(0)="Y",DIR("B")="NO",DIR("A")="DO YOU WANT YOUR OUTPUT QUEUED" D ^DIR G:$D(DIRUT) EXIT S APQUE=Y K X,Y,DIR,DIRUT,DTOUT
"RTN","PSOSDP",61,0)
 W ! I $G(IO("Q")) D  W:$D(ZTSK) !,"Report Queued to Print !!",!! G EXIT
"RTN","PSOSDP",62,0)
 .S %DT="ERXAFS",%DT("A")="Request Start Time: ",%DT("B")="NOW",%DT(0)="NOW" D ^%DT W ! Q:$D(DIRUT)!(X["^")  S APTM=Y
"RTN","PSOSDP",63,0)
 .F G="LINE","CLDT","CLSG","PSOPOL","PSOSYS","PSOINST","PSOBAR3","PSOBAR4","PSOBAR2","PSOPAR","PSOPAR7","PRF","PSDAYS","PSDATE","PSTYPE","PSOSITE","PSDATE","PSDAY","PSONUM","PSORM" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOSDP",64,0)
 .S ZTSAVE("APCLDT")="",ZTDTH=APTM,ZTDESC="Clinic Sort Group Action Profile (Outpatient Pharmacy).",ZTSAVE("ZTREQ")="@",ZTSAVE("APRT")="",ZTIO=APRT,ZTRTN="EN^PSOSDP" D ^%ZTLOAD
"RTN","PSOSDP",65,0)
 ;
"RTN","PSOSDP",66,0)
EN ;
"RTN","PSOSDP",67,0)
 S APIFLDS="1;2;3;4;5;6;7;8;9;10;11;12",ALL=1
"RTN","PSOSDP",68,0)
 S CLN=0 ;S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSOSDP",69,0)
 F  S CLN=$O(^PS(59.8,CLSG,1,CLN)) Q:'CLN  S FR=CLN_","_CLDT,PSOT=CLDT,TO=CLN_","_CLDT_".2359" D CLIN1^PSOSDRAP S CLDT=APCLDT
"RTN","PSOSDP",70,0)
 D ^%ZISC
"RTN","PSOSDP",71,0)
 ;
"RTN","PSOSDP",72,0)
EXIT K ADDRFL,CAN,CLDT,CLINICX,CLSG,CLSP,CNT,CS,DFN,G,PAGE,PCLASS,PRF,PSDATE
"RTN","PSOSDP",73,0)
 K PSDAY,PSDAYS,PSDT,PIIX,PSNAME,PSONUM,PSOT,PSSN,PSTYPE,RF,RFS,RXNO
"RTN","PSOSDP",74,0)
 K RXNODE,PSORM,PSOUT,PSOION,ZTDESC,DQTIME,F,O,W,CLN,APQUE,APTM,APRT
"RTN","PSOSDP",75,0)
 K APCLDT D KVA^VADPT,EXIT^PSOSD
"RTN","PSOSDP",76,0)
 G:'$D(ZTQUEUED) ^PSOSD
"RTN","PSOSDP",77,0)
 Q
"RTN","PSOSDP",78,0)
 ;
"RTN","PSOSDP",79,0)
COS I $P($G(^PSRX(J,3)),"^",3),$D(^VA(200,+$P($G(^(3)),"^",3),0)) W !?99,"COSIGNER: "_$P($G(^VA(200,$P(^PSRX(J,3),"^",3),0)),"^")
"RTN","PSOSDP",80,0)
 Q
"RTN","PSOTPCLP")
0^22^B65137821^B62400881
"RTN","PSOTPCLP",1,0)
PSOTPCLP ;BIRM/PDW-PRINT PATIENT LETTERS ;AUG 5,2003
"RTN","PSOTPCLP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**145,227,233**;DEC 1997;Build 8
"RTN","PSOTPCLP",3,0)
 Q
"RTN","PSOTPCLP",4,0)
PRINT ; select options
"RTN","PSOTPCLP",5,0)
 Q  ;placed out of order by patch PSO*7*227
"RTN","PSOTPCLP",6,0)
 K ^TMP($J,"TPBLET"),TMP($J,"TPCLW")
"RTN","PSOTPCLP",7,0)
 D EXIT ;INITIALIZE
"RTN","PSOTPCLP",8,0)
 ;build INST to show incompleted Institutions
"RTN","PSOTPCLP",9,0)
 K INST S DIVDA=0 F  S DIVDA=$O(^PS(52.92,DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCLP",10,0)
 . S INST(DIVDA)=$$GET1^DIQ(52.92,DIVDA,.01)
"RTN","PSOTPCLP",11,0)
 S XX=$$INSTCHK^PSOTPCL I $G(PSOSTOP) Q
"RTN","PSOTPCLP",12,0)
 K INST S DIVDA=0 F  S DIVDA=$O(^PS(52.92,DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCLP",13,0)
 . Q:$$CHKINST^PSOTPCL(DIVDA)
"RTN","PSOTPCLP",14,0)
 . S INST(DIVDA)=$$GET1^DIQ(52.92,DIVDA,.01)
"RTN","PSOTPCLP",15,0)
 K PARAM,PATLST
"RTN","PSOTPCLP",16,0)
 K DIR S DIR(0)="SO^A:Print all letters that have not printed;P:Print letter by a patient or multiple patients;I:Print by institution (all, one, or a selection)" D ^DIR
"RTN","PSOTPCLP",17,0)
 I Y="A" S PARAM("SORT")="I",PATLST="",PARAM("LP")="N" G DEVICE
"RTN","PSOTPCLP",18,0)
 I Y="P" G PATIENT
"RTN","PSOTPCLP",19,0)
 I Y="I" G DIVISION
"RTN","PSOTPCLP",20,0)
 W !,"None Selected - Quitting",! H 3
"RTN","PSOTPCLP",21,0)
 G EXIT
"RTN","PSOTPCLP",22,0)
PATIENT ; print by patients
"RTN","PSOTPCLP",23,0)
 S PARAM("SORT")="P",PARAM("LP")="B"
"RTN","PSOTPCLP",24,0)
 D PATSEL ; build PATLST("patient name")=DFN
"RTN","PSOTPCLP",25,0)
 G:($D(PATLST)<10) EXIT
"RTN","PSOTPCLP",26,0)
 G DEVICE
"RTN","PSOTPCLP",27,0)
DIVISION ;print by division
"RTN","PSOTPCLP",28,0)
 K DIR S DIR(0)="SO^N:Letters NOT Printed;P:Letters Printed;B:Both"
"RTN","PSOTPCLP",29,0)
 D ^DIR Q:"NPB"'[Y
"RTN","PSOTPCLP",30,0)
 S PARAM("LP")=Y
"RTN","PSOTPCLP",31,0)
 S PARAM("SORT")="I"
"RTN","PSOTPCLP",32,0)
 K INST D SEL^PSOTPCL
"RTN","PSOTPCLP",33,0)
 I ($D(INST)<10) W !,"No Selection Made - Quitting",! H 3 G EXIT
"RTN","PSOTPCLP",34,0)
 G DEVICE
"RTN","PSOTPCLP",35,0)
PATSEL ; Select one or more patients
"RTN","PSOTPCLP",36,0)
 K PATLST
"RTN","PSOTPCLP",37,0)
 S DIC="^PS(52.91,",DIC(0)="AEQM",DIC("W")="D DSPPAT^PSOTPCLP(+Y)"
"RTN","PSOTPCLP",38,0)
 F  S DIC("W")="D DSPPAT^PSOTPCLP(+Y)" D ^DIC Q:Y'>0  S DFN=+Y,PTNM=$$GET1^DIQ(52.91,DFN,.01),PATLST(PTNM,DFN)="" D
"RTN","PSOTPCLP",39,0)
 . ;test death date
"RTN","PSOTPCLP",40,0)
 . S XX=$$GET1^DIQ(2,DFN,.351) I XX'="" D  Q
"RTN","PSOTPCLP",41,0)
 .. W !!,"Sorry, ",PTNM," died ",XX,!
"RTN","PSOTPCLP",42,0)
 .. K PATLST(PTNM,DFN) H 3
"RTN","PSOTPCLP",43,0)
 . ;test expired date
"RTN","PSOTPCLP",44,0)
 . S EXPDTI=$$GET1^DIQ(52.91,DFN,2,"I")
"RTN","PSOTPCLP",45,0)
 . I EXPDTI,DT>EXPDTI D
"RTN","PSOTPCLP",46,0)
 .. S EXPDT=$$GET1^DIQ(52.91,+DFN,2)
"RTN","PSOTPCLP",47,0)
 .. W !,"Sorry, ",PTNM,"'s eligibility expired ",EXPDT,! K PATLST(PTNM,DFN)
"RTN","PSOTPCLP",48,0)
 . ;check divisions required data
"RTN","PSOTPCLP",49,0)
 . S DIVDA=$$GET1^DIQ(52.91,DFN,7,"I")
"RTN","PSOTPCLP",50,0)
 . S XX=$$CHKINST^PSOTPCL(DIVDA) I XX D
"RTN","PSOTPCLP",51,0)
 .. W !!,"Sorry, ",$$GET1^DIQ(52.91,DFN,7)," is missing required fields.",!!
"RTN","PSOTPCLP",52,0)
 .. K PATLST(PTNM,DFN)
"RTN","PSOTPCLP",53,0)
 ;
"RTN","PSOTPCLP",54,0)
LST I ($D(PATLST)<10) W !,"No Patients Selected - Quitting",! H 3 S PATLST="" Q
"RTN","PSOTPCLP",55,0)
 W !!,"You have selected:",!
"RTN","PSOTPCLP",56,0)
 S PATNM="" F I=1:1 S PATNM=$O(PATLST(PATNM)) Q:'$L(PATNM)  S DFN=0 F  S DFN=$O(PATLST(PATNM,DFN)) Q:DFN'>0  W !,PATNM D DSPPAT(DFN) I '(I#20) D  D ^DIR I X["^" Q
"RTN","PSOTPCLP",57,0)
 .K DIR S DIR(0)="E",DIR("A")="<cr> - Continue ""^"" - Stop Display"
"RTN","PSOTPCLP",58,0)
 ;
"RTN","PSOTPCLP",59,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="Is the above correct ",DIR("B")="YES" D ^DIR
"RTN","PSOTPCLP",60,0)
 I 'Y G PATSEL
"RTN","PSOTPCLP",61,0)
 Q
"RTN","PSOTPCLP",62,0)
DSPPAT(DFN) ; Display Division and expire date
"RTN","PSOTPCLP",63,0)
 N DIVNM,EXPDT,PRTDT
"RTN","PSOTPCLP",64,0)
 S DIVNM=$$GET1^DIQ(52.91,DFN,7) W ?32,$E(DIVNM,1,15)
"RTN","PSOTPCLP",65,0)
 S EXPDT=$$GET1^DIQ(52.91,DFN,2,"I")
"RTN","PSOTPCLP",66,0)
 I EXPDT S EXPDT=$$FMTE^XLFDT(EXPDT,"2D") W ?50,"Inact ",EXPDT
"RTN","PSOTPCLP",67,0)
 S PRTDT=$$GET1^DIQ(52.91,DFN,11,"I")
"RTN","PSOTPCLP",68,0)
 I PRTDT S PRTDT=$$FMTE^XLFDT(PRTDT,"2D") W ?66,"Prt ",PRTDT
"RTN","PSOTPCLP",69,0)
 Q
"RTN","PSOTPCLP",70,0)
DEVICE ;
"RTN","PSOTPCLP",71,0)
 W !,"Queueing is recommended",!
"RTN","PSOTPCLP",72,0)
 S %ZIS="Q" D ^%ZIS
"RTN","PSOTPCLP",73,0)
 Q:POP
"RTN","PSOTPCLP",74,0)
 I $D(IO("Q")) D  K ZTSK G EXIT
"RTN","PSOTPCLP",75,0)
 . S (PATLST,INST,PARAM)=""
"RTN","PSOTPCLP",76,0)
 . S ZTRTN="DEQUE^PSOTPCLP",ZTDESC="TPB PRINT PATIENT LETTERS"
"RTN","PSOTPCLP",77,0)
 . F XX="PATLST*","INST*","PARAM*" S ZTSAVE(XX)=""
"RTN","PSOTPCLP",78,0)
 . ;W ! ZW ZTRTN,ZTDESC,PATLST,INST,PARAM,ZTSAVE
"RTN","PSOTPCLP",79,0)
 . D ^%ZTLOAD
"RTN","PSOTPCLP",80,0)
 . I $G(ZTSK) W !!,"Tasked with "_ZTSK
"RTN","PSOTPCLP",81,0)
 ;  (code falls through if not queued)
"RTN","PSOTPCLP",82,0)
DEQUE ; DEQUE/PRINT LETTERS
"RTN","PSOTPCLP",83,0)
 K ^TMP($J,"TPBLET")
"RTN","PSOTPCLP",84,0)
 I PARAM("SORT")="P" G SORTPAT
"RTN","PSOTPCLP",85,0)
 S DIVDA=0 F  S DIVDA=$O(INST(DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCLP",86,0)
 . S DFN=0 F  S DFN=$O(^PS(52.91,"AC",DIVDA,DFN)) Q:DFN'>0  D
"RTN","PSOTPCLP",87,0)
 .. S PTNM=$$GET1^DIQ(52.91,DFN,.01)
"RTN","PSOTPCLP",88,0)
 .. S EXPDTI=$P(^PS(52.91,DFN,0),"^",3),LTPDTI=$P(^(0),"^",12)
"RTN","PSOTPCLP",89,0)
 .. Q:EXPDTI
"RTN","PSOTPCLP",90,0)
 .. Q:$L($$GET1^DIQ(2,DFN,.351))
"RTN","PSOTPCLP",91,0)
 .. I PARAM("LP")="N",LTPDTI Q
"RTN","PSOTPCLP",92,0)
 .. I PARAM("LP")="P",'LTPDTI Q
"RTN","PSOTPCLP",93,0)
 .. S ^TMP($J,"TPBLET",DIVDA,PTNM,DFN)=""
"RTN","PSOTPCLP",94,0)
 G PRTLET
"RTN","PSOTPCLP",95,0)
SORTPAT ; sort by patient
"RTN","PSOTPCLP",96,0)
 K ^TMP($J,"TPBLET")
"RTN","PSOTPCLP",97,0)
 S PTNM="" F  S PTNM=$O(PATLST(PTNM)) Q:PTNM=""  D
"RTN","PSOTPCLP",98,0)
 . S DFN=0 F  S DFN=$O(PATLST(PTNM,DFN)) Q:DFN'>0  D
"RTN","PSOTPCLP",99,0)
 .. S DA0=^PS(52.91,DFN,0),EXPDTI=$P(DA0,"^",3),LTPDTI=$P(DA0,"^",12),DIVDA=$P(DA0,"^",8)
"RTN","PSOTPCLP",100,0)
 .. Q:EXPDTI
"RTN","PSOTPCLP",101,0)
 .. I PARAM("LP")="N",LTPDTI Q
"RTN","PSOTPCLP",102,0)
 .. I PARAM("LP")="P",'LTPDTI Q
"RTN","PSOTPCLP",103,0)
 .. S ^TMP($J,"TPBLET",DIVDA,PTNM,DFN)=""
"RTN","PSOTPCLP",104,0)
 G PRTLET
"RTN","PSOTPCLP",105,0)
 Q
"RTN","PSOTPCLP",106,0)
PRTLET ; pull DIVDAs and DFNs from ^TMP($J,"TPBLET",
"RTN","PSOTPCLP",107,0)
 D LOADTMP^PSOTPCLW ; load letter body into TMP
"RTN","PSOTPCLP",108,0)
 K DIVCNT
"RTN","PSOTPCLP",109,0)
 S DIVDA=0 F  S DIVDA=$O(^TMP($J,"TPBLET",DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCLP",110,0)
 . S XX=$$CHKINST^PSOTPCL(DIVDA) I XX S DIVCNT(DIVDA)=0 Q
"RTN","PSOTPCLP",111,0)
 . D DIV ;GETDIV(DIVDA) ;load institution/parent data for print
"RTN","PSOTPCLP",112,0)
 . S PTNM="" F  S PTNM=$O(^TMP($J,"TPBLET",DIVDA,PTNM)) Q:PTNM=""  D
"RTN","PSOTPCLP",113,0)
 .. S DFN=0
"RTN","PSOTPCLP",114,0)
 .. F  S DFN=$O(^TMP($J,"TPBLET",DIVDA,PTNM,DFN)) Q:DFN'>0  D
"RTN","PSOTPCLP",115,0)
 ... S DIVCNT(DIVDA)=$G(DIVCNT(DIVDA))+1
"RTN","PSOTPCLP",116,0)
 ... D LETTER(DFN)
"RTN","PSOTPCLP",117,0)
 ... S $P(^PS(52.91,DFN,0),U,12)=DT ;set print date
"RTN","PSOTPCLP",118,0)
 ; summary of printing
"RTN","PSOTPCLP",119,0)
 S Y=DT D D^DIQ S SRDT=Y
"RTN","PSOTPCLP",120,0)
 W @IOF,!!,?10,"SUMMARY of TPB LETTER PRINTING   ",SRDT
"RTN","PSOTPCLP",121,0)
 W !!
"RTN","PSOTPCLP",122,0)
 I '$D(DIVCNT) W !!,"NO DATA TO PRINT",!! G EXIT
"RTN","PSOTPCLP",123,0)
 S DIVDA=0 F  S DIVDA=$O(DIVCNT(DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCLP",124,0)
 . W !,?5,$$GET1^DIQ(52.92,DIVDA,.01),?40,DIVCNT(DIVDA)
"RTN","PSOTPCLP",125,0)
 W !
"RTN","PSOTPCLP",126,0)
 G EXIT
"RTN","PSOTPCLP",127,0)
 ;
"RTN","PSOTPCLP",128,0)
LETTER(DFN) ; print letter , division variables information must be present
"RTN","PSOTPCLP",129,0)
 U IO
"RTN","PSOTPCLP",130,0)
 D GETPAT(DFN)
"RTN","PSOTPCLP",131,0)
 I EXPDT,EXPDT'>DT Q  ; patient inactive on printing date
"RTN","PSOTPCLP",132,0)
 D HEADER
"RTN","PSOTPCLP",133,0)
 F LN=1:1 Q:'$D(^TMP($J,"TPCLW","P1",LN))  W !,^(LN)
"RTN","PSOTPCLP",134,0)
 W ?30,"PHARMACY SERVICE",!,?30,DIVNM
"RTN","PSOTPCLP",135,0)
 I $L(MADD1) D  I 1
"RTN","PSOTPCLP",136,0)
 . W !,?30,MADD1
"RTN","PSOTPCLP",137,0)
 . W:$L(MADD2) !,?30,MADD2
"RTN","PSOTPCLP",138,0)
 . W !,?30,MCITY,", ",MSTATE,"  ",MZIP
"RTN","PSOTPCLP",139,0)
 E  W !,?30,ADD1 D
"RTN","PSOTPCLP",140,0)
 . W:$L(ADD2) !,?30,ADD2
"RTN","PSOTPCLP",141,0)
 . W !,?30,CITY,", ",STATE,"  ",ZIP
"RTN","PSOTPCLP",142,0)
 F LN=1:1 Q:'$D(^TMP($J,"TPCLW","P2",LN))  W !,^(LN)
"RTN","PSOTPCLP",143,0)
 W " ",PHN1 W:$L(PHN2) ", or ",PHN2 W ".",!
"RTN","PSOTPCLP",144,0)
 F LN=1:1 Q:'$D(^TMP($J,"TPCLW","P3",LN))  W:LN>1 ! W ^(LN)
"RTN","PSOTPCLP",145,0)
 W !!!!,?4,SIG1 W:$L(SIG2) !,?4,SIG2 W:$L(SIG3) !,?4,SIG3
"RTN","PSOTPCLP",146,0)
 W !
"RTN","PSOTPCLP",147,0)
 Q
"RTN","PSOTPCLP",148,0)
GETPAT(DFN) ;GET PATIENT DATA
"RTN","PSOTPCLP",149,0)
 K PTNM,EXPDT,SRANAME,TITLE,SRNM,PTSTATE,VADM,VAPA
"RTN","PSOTPCLP",150,0)
 S PTNM=$$GET1^DIQ(52.91,DFN,.01),EXPDT=$$GET1^DIQ(52.91,DFN,2,"I")
"RTN","PSOTPCLP",151,0)
 ;I EXPDT,DT'>EXPDT Q
"RTN","PSOTPCLP",152,0)
 D DEM^VADPT,ADD^VADPT
"RTN","PSOTPCLP",153,0)
 S PTLNM=$P(PTNM,","),PTXNM=$P(PTNM,",")
"RTN","PSOTPCLP",154,0)
 S SRANAME=$P(VADM(1),"^"),X=$P(SRANAME,","),Y=$E(X)_$TR($E(X,2,$L(X)),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","PSOTPCLP",155,0)
 S TITLE=$S($P(VADM(5),"^")="F":"Ms. ",1:"Mr. "),SRANAME=TITLE_Y
"RTN","PSOTPCLP",156,0)
 S Y=DT D D^DIQ S SRDT=Y
"RTN","PSOTPCLP",157,0)
 S SEX=$P(VADM(5),"^")
"RTN","PSOTPCLP",158,0)
 S SRNM=$P(VADM(1),",",2)_" "_$P(VADM(1),",")
"RTN","PSOTPCLP",159,0)
 S PADD1=$G(VAPA(1)),PADD2=$G(VAPA(2)),PADD3=$G(VAPA(3))
"RTN","PSOTPCLP",160,0)
 S PCITY=$G(VAPA(4)),PTSTATE=$P($G(VAPA(5)),U,2),PZIP=$G(VAPA(6))
"RTN","PSOTPCLP",161,0)
 N PSOBADR,PSOTEMP
"RTN","PSOTPCLP",162,0)
 S PSOBADR=$$BADADR^DGUTL3(DFN) I PSOBADR S PSOTEMP=$$CHKTEMP^PSOBAI(DFN) D
"RTN","PSOTPCLP",163,0)
 .I 'PSOTEMP S PADD1="** BAD ADDRESS INDICATED **",PADD2="",PADD3="",PCITY="",PSTATE="",PZIP=""
"RTN","PSOTPCLP",164,0)
CCADD ; Get Confidential Correspondence Address if one is active
"RTN","PSOTPCLP",165,0)
 ; and has the category "all other".
"RTN","PSOTPCLP",166,0)
 ;
"RTN","PSOTPCLP",167,0)
 ; See if CC address exists
"RTN","PSOTPCLP",168,0)
 I '$G(VAPA(12)) Q
"RTN","PSOTPCLP",169,0)
 ; code to check the CC category in the variable array VAPA(22)
"RTN","PSOTPCLP",170,0)
 ; check catagories
"RTN","PSOTPCLP",171,0)
 S XX=0 F CC=1,2,5 I $P($G(VAPA(22,CC)),U,3)="Y" S XX=1
"RTN","PSOTPCLP",172,0)
 Q:'XX
"RTN","PSOTPCLP",173,0)
 S SRCCADD=1
"RTN","PSOTPCLP",174,0)
 S:$G(VAPA(17)) PTSTATE=$P(^DIC(5,$P(VAPA(17),"^"),0),"^",2)
"RTN","PSOTPCLP",175,0)
 S PADD1=$G(VAPA(13)),PADD2=$G(VAPA(14)),PADD3=$G(VAPA(15))
"RTN","PSOTPCLP",176,0)
 S PCITY=$G(VAPA(16)),PTSTAT=$P(VAPA(17),U,2),PZIP=$P(VAPA(18),U,2)
"RTN","PSOTPCLP",177,0)
 Q
"RTN","PSOTPCLP",178,0)
HEADER ; print letter header
"RTN","PSOTPCLP",179,0)
 U IO
"RTN","PSOTPCLP",180,0)
 W @IOF
"RTN","PSOTPCLP",181,0)
 W !!,?(80-$L(DIVNM))\2,DIVNM
"RTN","PSOTPCLP",182,0)
 W !,?(80-$L(ADD1))\2,ADD1
"RTN","PSOTPCLP",183,0)
 W:$L(ADD2) !,?(80-$L(ADD2))\2,ADD2
"RTN","PSOTPCLP",184,0)
 S XX=CITY_", "_STATE_" "_ZIP
"RTN","PSOTPCLP",185,0)
 W !,?(80-$L(XX))\2,XX
"RTN","PSOTPCLP",186,0)
 F Y=$Y:1:10 W !
"RTN","PSOTPCLP",187,0)
 W !,?4,SRNM,?65,SRDT,!,?4,PADD1 I PADD2'="" W !,?4,PADD2 I PADD3'="" W !,?4,VAPA(3)
"RTN","PSOTPCLP",188,0)
 W:PCITY'="" !,?4,PCITY_", "_PTSTATE_" "_PZIP W !!!
"RTN","PSOTPCLP",189,0)
 Q
"RTN","PSOTPCLP",190,0)
DIV D GETDIV(DIVDA)
"RTN","PSOTPCLP",191,0)
 I $L(PARDIV) S DIVDA2=$$GET1^DIQ(52.92,DIVDA,.02,"I") D GETDIV(DIVDA2)
"RTN","PSOTPCLP",192,0)
 Q
"RTN","PSOTPCLP",193,0)
GETDIV(DIVDA) ; GET DIVISIONAL DATA
"RTN","PSOTPCLP",194,0)
 K DIVNM,PARDIV,PHN1,PHN2,ADD1,ADD2,CITY,ZIP,STATE,MADD1,MADD2,MCITY,MZIP,SIG1,SIG2,SIG3
"RTN","PSOTPCLP",195,0)
 ;
"RTN","PSOTPCLP",196,0)
 F FLDX="DIVNM^.01","PARDIV^.02","PHN1^.03","PHN2^.04","ADD1^.05","ADD2^.06","CITY^.07","ZIP^.08","STATE^.09" D GET1(52.92,DIVDA,FLDX)
"RTN","PSOTPCLP",197,0)
 ;
"RTN","PSOTPCLP",198,0)
 F FLDX="MADD1^1.01","MADD2^1.02","MCITY^1.03","MSTATE^1.04","MZIP^1.05","SIG1^2.01","SIG2^2.02","SIG3^2.03" D GET1(52.92,DIVDA,FLDX)
"RTN","PSOTPCLP",199,0)
 ;
"RTN","PSOTPCLP",200,0)
 Q
"RTN","PSOTPCLP",201,0)
GET1(FILE,FLIEN,FLDX) ; "Variable^FLD" load variable = FILE,FLD
"RTN","PSOTPCLP",202,0)
 N VAR S VAR=$P(FLDX,"^"),FLD=$P(FLDX,"^",2),@VAR=$$GET1^DIQ(FILE,FLIEN,FLD)
"RTN","PSOTPCLP",203,0)
 Q
"RTN","PSOTPCLP",204,0)
EXIT ;
"RTN","PSOTPCLP",205,0)
 D ^%ZISC
"RTN","PSOTPCLP",206,0)
 I $G(ZTSK) D KILL^%ZTLOAD
"RTN","PSOTPCLP",207,0)
 K ADD1,ADD2,CHK,CITY,DIV,DIVCNT,DIVDA,DIVDA2,DIVNM,DIVX
"RTN","PSOTPCLP",208,0)
 K EXPDT,EXPDTI,FAC,FDA,FLD,FLDX,FILE,FLD,FLDX,FLIEN
"RTN","PSOTPCLP",209,0)
 K I,INST,LN,LOCDA,LTPDTI,MADD1,MADD2,MCITY,MZIP,PAR,PARAM
"RTN","PSOTPCLP",210,0)
 K PARDIV,PATLST,PATNM,PHN1,PHN2,POP,PRTDT,PSOSTOP,PTLNM,PTNM
"RTN","PSOTPCLP",211,0)
 K PTSTATE,PTXNM,SEX,SIG1,SIG2,SIG3,SRNAME,SRDT,STATE,TITLE
"RTN","PSOTPCLP",212,0)
 K VADM,VAPA,VAR,XFLD,XX,YFLD,YY,ZIP,ZTDESC
"RTN","PSOTPCLP",213,0)
 K ^TMP($J,"TPBLET"),^TMP($J,"TPCLW")
"RTN","PSOTPCLP",214,0)
 Q
"RTN","PSOTPCLP",215,0)
LOAD K PATLST S DFN=0 F  S DFN=$O(^PS(52.91,DFN)) Q:DFN'>0  S PATLST($$GET1^DIQ(52.91,DFN,.01))=DFN
"RTN","PSOTPCLP",216,0)
 Q
"VER")
8.0^22.0
"^DD",52,52,99,0)
HOLD REASON^RS^1:INSUFFICIENT QTY IN STOCK;2:DRUG-DRUG INTERACTION;3:PATIENT REACTION;4:PHYSICIAN TO BE CONTACTED;5:ALLERGY REACTIONS;6:DRUG REACTION;7:BAD ADDRESS;8:PER PATIENT REQUEST;99:OTHER--SEE COMMENTS;^H;1^Q
"^DD",52,52,99,1,0)
^.1^^-1
"^DD",52,52,99,1,1,0)
52^AH
"^DD",52,52,99,1,1,1)
S ^PSRX("AH",$E(X,1,30),DA)=""
"^DD",52,52,99,1,1,2)
K ^PSRX("AH",$E(X,1,30),DA)
"^DD",52,52,99,3)
Enter reason medication is placed in a 'Hold' status.
"^DD",52,52,99,21,0)
^^1^1^3060524^^^
"^DD",52,52,99,21,1,0)
This field tells why the prescription was put on hold.
"^DD",52,52,99,23,0)
^^1^1^3060524^
"^DD",52,52,99,23,1,0)
Enter reason medication is being placed in a 'Hold' status.
"^DD",52,52,99,"DT")
3060524
"BLD",5807,6)
^218
**END**
**END**
